[
    {
        "content": "\u5c06\u95ee\u9898\u62bd\u8c61\u5316\uff1a\n\n\u4e00\u4e2a$n$\u4e2a\u8282\u70b9\u7684\u6811\uff0c\u548c\u4e00\u4e2a$n$\u4e2a\u8282\u70b9\u7684\u56fe\uff0c\u8981\u6c42\u7ed9\u6811\u4e0a\u7684\u6bcf\u4e2a\u8282\u70b9\u7f16\u53f7\uff0c\u4f7f\u5f97\u7f16\u53f7\u662f\u4e00\u4e2a$1$\u5230$n$\u7684\u6392\u5217\uff0c\u5e76\u4e14\u8981\u6ee1\u8db3\u6811\u4e0a\u4efb\u610f\u4e00\u6761\u8fb9$(u,v)$\uff0c\u56fe\u4e2d\u4e00\u5b9a\u8981\u6709\u8fb9$(x_u,x_v)$\uff08$x_u$\u8868\u793a\u70b9$u$\u7684\u7f16\u53f7\uff09\uff0c\u6c42\u65b9\u6848\u6570\u3002\n\n\u66b4\u529b\u7684\u505a\u6cd5\u662f\u5b9a\u4e49\u72b6\u6001$f[i][j][S]$\u8868\u793a\u8282\u70b9$i$\u7f16\u53f7\u4e3a$j$\uff0c$i$\u7684\u5b50\u6811\u5185\u7684\u7f16\u53f7\u96c6\u5408\u4e3a$S$\u7684\u65b9\u6848\u6570\u3002\n\n\u4f46\u662f\u8fd9\u6837\u7684\u74f6\u9888\u5728\u4e8e\u679a\u4e3e\u5b50\u96c6\uff0c\u590d\u6742\u5ea6\u662f$O(n^3\\times 3^n)$\u7684\uff0c\u663e\u7136TLE\u3002\n\nQ\uff1a\u4e3a\u4ec0\u4e48\u8981\u8bb0\u5f55$S$\u8fd9\u4e00\u7ef4\uff1f\n\nA\uff1a\u8981\u6c42\u4e2d\u6709\u300c\u7f16\u53f7\u662f\u4e00\u4e2a$1$\u5230$n$\u7684\u6392\u5217\u300d\u3002\n\n\u5c1d\u8bd5\u628a\u300c\u7f16\u53f7\u662f\u4e00\u4e2a$1$\u5230$n$\u7684\u6392\u5217\u300d\u8fd9\u4e00\u6761\u4ef6\u53bb\u6389\uff0c\u5c31\u4e0d\u7528\u8bb0\u5f55$S$\u4e86\u3002\n\n\u8fd9\u6837\u53ea\u9700\u8981\u5b9a\u4e49$f[i][j]$\u4e3a\u5728$i$\u7684\u5b50\u6811\u5185\uff0c\u70b9$i$\u7684\u7f16\u53f7\u4e3a$j$\u7684\u65b9\u6848\u6570\u3002\n\n\u800c\u8fd9\u65f6\u5019\u4f1a\u51fa\u73b0\u91cd\u590d\u7f16\u53f7\uff0c\u600e\u4e48\u529e\u5462\uff1f\n\n\u5bb9\u65a5\uff01\n\n\u5148$2^n$\u679a\u4e3e$\\{1,2,...,n\\}$\u7684\u4e00\u4e2a\u5b50\u96c6$S$\uff0c\u5f3a\u5236\u89c4\u5b9a\u6811\u4e0a\u6bcf\u4e2a\u70b9\u7684\u7f16\u53f7\u5fc5\u987b\u662f$S$\u7684\u5b50\u96c6\uff0c\u7136\u540e\u6bcf\u6b21$O(n^3)$\u4e00\u6b21DP\uff0c\u603b\u65b9\u6848\u6570\u4e3a\uff1a\n\n$(|S|=n$\u7684\u65b9\u6848\u6570$)-(|S|=n-1$\u7684\u65b9\u6848\u6570$)+(|S|=n-2$\u7684\u65b9\u6848\u6570$)-...$\n\n\u590d\u6742\u5ea6\u964d\u5230$O(n^3\\times 2^n)$\uff0c\u5728UOJ\u4e0a\u9700\u8981\u8fdb\u884c\u4e00\u5b9a\u7684\u5e38\u6570\u4f18\u5316\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\nusing namespace std;\ninline int read() {\n\tint res = 0; bool bo = 0; char c;\n\twhile (((c = getchar()) < '0' || c > '9') && c != '-');\n\tif (c == '-') bo = 1; else res = c - 48;\n\twhile ((c = getchar()) >= '0' && c <= '9')\n\t\tres = (res << 3) + (res << 1) + (c - 48);\n\treturn bo ? ~res + 1 : res;\n}\ntypedef long long ll;\nconst int N = 20, M = 40;\nint n, m, ecnt, nxt[M], adj[N], go[M], tot, whi[N];\nbool g[N][N], vis[N]; ll f[N][N], ans;\ninline void add_edge(const int &u, const int &v) {\n\tnxt[++ecnt] = adj[u]; adj[u] = ecnt; go[ecnt] = v;\n\tnxt[++ecnt] = adj[v]; adj[v] = ecnt; go[ecnt] = u;\n}\ninline void dfs(const int &u, const int &fu) {\n\tint i, j; for (int e = adj[u], v; e; e = nxt[e]) {\n\t\tif ((v = go[e]) == fu) continue; dfs(v, u);\n\t}\n\tfor (i = 1; i <= tot; i++) {\n\t\tint x = whi[i]; f[u][x] = 1;\n\t\tfor (int e = adj[u], v; e; e = nxt[e]) {\n\t\t\tif ((v = go[e]) == fu) continue; ll sum = 0;\n\t\t\tfor (j = 1; j <= tot; j++) {\n\t\t\t\tint y = whi[j]; if (!g[x][y]) continue; sum += f[v][y];\n\t\t\t}\n\t\t\tf[u][x] *= sum;\n\t\t}\n\t}\n}\ninline void solve() {\n\tint i; tot = 0; for (i = 1; i <= n; i++) if (vis[i]) whi[++tot] = i;\n\tdfs(1, 0); for (i = 1; i <= tot; i++)\n\t\tif (n - tot & 1) ans -= f[1][whi[i]]; else ans += f[1][whi[i]];\n}\ninline void Dfs(const int &dep) {\n\tif (dep == n + 1) return solve();\n\tvis[dep] = 0; Dfs(dep + 1);\n\tvis[dep] = 1; Dfs(dep + 1);\n}\nint main() {\n\tint i, x, y; n = read(); m = read();\n\tfor (i = 1; i <= m; i++) x = read(), y = read(), g[x][y] = g[y][x] = 1;\n\tfor (i = 1; i < n; i++) x = read(), y = read(), add_edge(x, y);\n\tDfs(1); cout << ans << endl; return 0;\n}\n```",
        "postTime": 1521292114,
        "uid": 29936,
        "name": "xyz32768",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3349 \u3010[ZJOI2016]\u5c0f\u661f\u661f\u3011"
    },
    {
        "content": "# **\u3010\u9898\u89e3\u3011\u5c0f\u661f\u661f [ZJOI2016] [P3349]**\n\n[$\\mathcal{My}\\ \\mathcal{Blog}$](https://www.cnblogs.com/Xing-Ling/p/13373094.html)\n\n\u4f20\u9001\u95e8\uff1a[\u5c0f\u661f\u661f $\\text{[ZJOI2016] [P3349]}$](https://www.luogu.com.cn/problem/P3349)\n\n## **\u3010\u9898\u76ee\u63cf\u8ff0\u3011**\n\n\u7ed9\u51fa $n$ \u4e2a\u70b9\u7684\u4e00\u5f20\u65e0\u5411\u56fe $(V,E)$ \u548c\u4e00\u9897\u6811\uff0c\u73b0\u9700\u8981\u7ed9\u6bcf\u4e2a\u70b9 $i$ \u5b89\u6392\u4e00\u4e2a\u6620\u5c04 $a_i$\uff0c\u6ee1\u8db3\u5bf9\u4e8e\u6811\u4e0a\u4efb\u610f\u8fb9 $(x,y)$\uff0c\u5747\u6709\u8fb9 $(a_x,a_y)\\in E$\u3002\u8981\u6c42 $a$ \u4e3a\u4e00\u4e2a\u6392\u5217\uff08\u5373\u4e0d\u5b58\u5728\u4e24\u4e2a\u70b9\u7684\u6620\u5c04\u76f8\u540c\uff09\uff0c\u6c42\u65b9\u6848\u6570\u3002\n\n## **\u3010\u5206\u6790\u3011**\n\n> \u7ec4\u5408\u610f\u4e49\u5929\u5730\u706d\uff0c\u4ee3\u6570\u63a8\u5bfc\u4fdd\u5e73\u5b89\u3002 \u2014\u2014 tiger0133\n\n\u5927\u5bb6\u4f3c\u4e4e\u90fd\u662f\u76f4\u63a5\u786c\u627e\u7684\u5bb9\u65a5\u7cfb\u6570\uff0c\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4e2a\u4e0d\u9700\u8981\u8d39\u8111\u5b50\u7684\u5b50\u96c6\u53cd\u6f14\u505a\u6cd5\uff08\u6700\u7ec8\u67ff\u5b50\u662f\u4e00\u6837\u7684\uff09\u3002\n\n\u5148\u8003\u8651\u6700 $\\text{naive}$ \u7684\u66b4\u529b\u72b6\u538b\uff1a\u8bbe $dp(x,j,S)$ \u8868\u793a\u70b9 $x$ \u6620\u5c04\u4e3a $j$\u3001$x$ \u5b50\u6811\u5185\u6240\u6709\u70b9\u5df2\u7ecf\u4f7f\u7528\u4e86 $S$ \u4f5c\u4e3a\u6620\u5c04 \u7684\u65b9\u6848\u6570\uff08$S$ \u4e3a\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6570\uff09\u3002\n\n$dp$ \u6570\u7ec4\u7b2c\u4e00\u3001\u4e09\u7ef4\u7684\u4f5c\u7528\u663e\u7136\uff0c\u7b2c\u4e8c\u7ef4 $j$ \u662f\u4e3a\u4e86\u65b9\u4fbf\u5224\u65ad\u662f\u5426\u6709\u8fde\u8fb9\u3002\n\n\u8f6c\u79fb\u9700\u8981\u679a\u4e3e $S$ \u7684\u5b50\u96c6\uff0c\u590d\u6742\u5ea6 $O(n^33^n)$\uff0c\u7528\u591a\u9879\u5f0f\u79d1\u6280\u4f18\u5316\u5b50\u96c6\u5377\u79ef\u53ef\u4ee5\u505a\u5230 $O(n^42^n)$\uff0c\u663e\u7136\u8fd8\u662f\u8fc7\u4e0d\u4e86\u3002\n\n\u590d\u6742\u5ea6\u74f6\u9888\u5728\u4e8e\u679a\u4e3e\u5b50\u96c6\uff0c\u5fc5\u987b\u628a\u8fd9\u4e2a\u4e1c\u897f\u53bb\u6389\u3002\n\n\u4f18\u5316\u5b50\u96c6 $dp$ \u663e\u7136\u8981\u4e0a\u5bb9\u65a5\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u6211\u4eec\u91c7\u7528\u53e6\u4e00\u4e2a\u601d\u8def\uff1a\u5b50\u96c6\u53cd\u6f14\u3002\n\n\u641e\u53cd\u6f14\u7684\u7b2c\u4e00\u6b65\u662f\u8bbe\u8ba1\u4e24\u4e2a\u72b6\u6001\uff0c\u4e14\u9700\u6ee1\u8db3\u5176\u4e2d\u4e00\u4e2a\u53ef\u4ee5\u65b9\u4fbf\u6c42\u5f97\u3001\u53e6\u4e00\u4e2a\u53ef\u4ee5\u65b9\u4fbf\u5f97\u51fa\u7b54\u6848\u3001\u4e24\u8005\u4e4b\u95f4\u5b58\u5728\u5173\u7cfb\u5f0f\u3002\n\n\u8bbe\u8ba1\u72b6\u6001\u7528\u7c7b\u4f3c\u4e8c\u9879\u5f0f\u53cd\u6f14\u7684\u5957\u8def\u53bb\u601d\u8003\uff0c\u5982\u679c\u5b9e\u5728\u60f3\u4e0d\u51fa\u6765\u5c31\u4e00\u4e2a\u4e00\u4e2a\u679a\u4e3e\u9650\u5236\u6761\u4ef6\uff0c\u9010\u4e2a\u68c0\u9a8c\u662f\u5426\u53ef\u884c\u3002\n\n\u672c\u9898\u7684\u5173\u952e\u9650\u5236\u5728\u4e8e\uff1a\u4efb\u610f\u4e24\u70b9\u7684\u6620\u5c04\u4e0d\u80fd\u76f8\u540c\u3002\u5f53\u5b58\u5728\u8fd9\u4e00\u9650\u5236\u65f6\u65e0\u8bba\u600e\u4e48\u8bbe\u90fd\u4e0d\u597d\u641e\uff0c\u6240\u4ee5\u8bbe\u72b6\u6001\u65f6\u9700\u8981\u628a\u8fd9\u4e2a\u9650\u5236\u53bb\u6389\u3002\n\n$f(S)$\uff1a $n$ \u4e2a\u70b9\u7684\u6620\u5c04**\u6070\u597d**\u4f7f\u7528\u4e86 $S$ \u4e2d\u7684\u6240\u6709\u70b9\uff08\u65e0\u9700\u6ee1\u8db3 $a$ \u4e3a\u6392\u5217\uff09\u3002\n\n$g(S)$\uff1a $n$ \u4e2a\u70b9\u7684\u6620\u5c04**\u81f3\u591a**\u53ea\u80fd\u591f\u4f7f\u7528 $S$ \u4e2d\u7684\u70b9\uff08\u65e0\u9700\u6ee1\u8db3 $a$ \u4e3a\u6392\u5217\uff09\u3002\n\n\u6613\u77e5\uff1a  \n$$g(S)=\\sum_{T\\subseteq S}f(T)$$\n\n\u7531\u5b50\u96c6\u53cd\u6f14\u53ef\u5f97\uff1a  \n$$f(S)=\\sum_{T\\subseteq S}(-1)^{|S|-|T|}g(T)$$\n\n> **\u6ce8\u610f**\uff1a  \n\u5728\u505a\u4e8c\u9879\u5f0f\u53cd\u6f14\u65f6\uff0c\u6211\u4eec\u6240\u8bf4\u7684\u201c\u81f3\u591a\u201d\u548c\u201c\u81f3\u5c11\u201d\u90fd\u662f\u5047\u7684\uff0c\u771f\u6b63\u542b\u4e49\u4e3a\uff1a\u94a6\u5b9a\u67d0\u4e00\u90e8\u5206\u6ee1\u8db3\u67d0\u6761\u4ef6\uff0c\u5176\u4f59\u90e8\u5206\u968f\u610f\u3002\u56e0\u6b64 $f,g$ \u7684\u5173\u7cfb\u5f0f\u4e2d\u4f1a\u5b58\u5728\u4e00\u4e2a\u4e8c\u9879\u5f0f\u7cfb\u6570\uff08\u4e00\u4e2a $f(i)$ \u4f1a\u88ab $g(x)$ \u7edf\u8ba1\u591a\u6b21\uff0c\u5f53\u72b6\u6001\u53ea\u6709\u4e00\u7ef4\u65f6\uff0c\u8fd9\u4e2a\u6b21\u6570\u4e3a $C_{i}^{x}$ \u6216\u8005 $C_{x}^{i}$\uff09\u3002  \n\u4f46\u8fd9\u91cc\u5b50\u96c6\u53cd\u6f14\u5b9a\u4e49\u7684\u201c\u81f3\u591a\u201d\u662f\u771f\u8d27\uff0c\u6bcf\u4e2a $f(T)$ \u53ea\u4f1a\u88ab $g(S)$ \u7edf\u8ba1\u4e00\u6b21\uff0c\u56e0\u6b64 $g(S)$ \u76f4\u63a5\u5c31\u7b49\u4e8e $\\sum_{T\\subseteq S}f(T)$\uff0c\u4e0d\u4f1a\u5e26\u6709\u5947\u602a\u7684\u7cfb\u6570\u3002\n\n\u56de\u5230\u8fd9\u9053\u9898\uff0c\u6700\u7ec8\u7b54\u6848\u4e3a $f(V)$\uff0c\u5176\u4e2d $V$ \u4e3a\u5168\u96c6\uff08\u5373 $2^{n}-1$\uff09\u3002\n\n> Q\uff1a\u4e3a\u4ec0\u55b5\uff1f\u524d\u9762\u505a\u5b9a\u4e49\u65f6\u4e0d\u662f\u8bf4\u7684**\u4e0d\u4e00\u5b9a\u6ee1\u8db3** $a$ \u4e3a\u6392\u5217\u5417\uff1f  \nA: \u7531\u4e8e\u5168\u96c6 $V$ \u4e2d\u7684 $n$ \u4e2a\u70b9\u5168\u90fd\u88ab\u4f5c\u4e3a\u6620\u5c04\u4f7f\u7528\u4e86\uff0c\u800c\u4e00\u4e2a\u70b9\u53ea\u80fd\u6620\u5c04\u4e00\u4e2a\uff0c\u6240\u4ee5 $f(V)$ \u7edf\u8ba1\u7684\u65b9\u6848\u4e2d\u6bcf\u4e2a\u70b9\u7684\u6620\u5c04\u5fc5\u5b9a\u4e24\u4e24\u4e0d\u540c\u3002\n\n\u90a3\u4e48\u6700\u540e\u7684\u95ee\u9898\u5c31\u662f \u5728\u4e0d\u6d89\u53ca $f$ \u7684\u60c5\u51b5\u4e0b\u5feb\u901f\u8ba1\u7b97 $g(S)$ \u4e86\u3002\n\n\u4fee\u6539\u4e00\u4e0b\u524d\u9762\u7684\u66b4\u529b\u72b6\u538b\uff1a\n\n\u7528 $dp(x,j,S)$ \u8868\u793a\u70b9 $x$ \u6620\u5c04\u4e3a $j$\u3001$x$ \u5b50\u6811\u5185\u6240\u6709\u70b9\u81f3\u591a\u53ea\u80fd\u4f7f\u7528 $S$ \u4e2d\u7684\u70b9\u4f5c\u4e3a\u6620\u5c04\u503c \u7684\u65b9\u6848\u6570\uff08\u65e0\u9700\u6ee1\u8db3\u6620\u5c04\u4e24\u4e24\u4e0d\u540c\uff09\u3002\n\n\u8f6c\u79fb\u4e3a\uff1a  \n$$dp(x,j,S)=\\prod\\limits_{to\\in\\{son(x)\\}}\\left(\\sum\\limits_{k\\subseteq S,(j,k)\\in E}dp(to,k,S)\\right)$$\n\n\u53ef\u5f97 $g(S)=\\sum_{j\\subseteq S}dp(rt,j,S)$\uff0c\u5176\u4e2d $rt$ \u4e3a\u6811\u7684\u6839\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a\uff1a$O(n^32^n)$\uff0c\u8981\u51ed\u4fe1\u4ef0\u5361\u5e38....\n\n## **\u3010Code\u3011**\n\n```cpp\n#include<algorithm>\n#include<cstring>\n#include<cstdio>\n#include<cmath>\n#define LL long long\n#define Re register int\nusing namespace std;\nconst int N=18,M=131072+3;\nint n,m,x,y,o,V,v[N],cnt[M],head[N],A[N][N];LL ans,g[M],dp[N][N];\nstruct QAQ{int to,next;}a[N<<1];\ninline void add(Re x,Re y){a[++o].to=y,a[o].next=head[x],head[x]=o;}\ninline void in(Re &x){\n    int f=0;x=0;char ch=getchar();\n    while(ch<'0'||ch>'9')f|=ch=='-',ch=getchar();\n    while(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n    x=f?-x:x;\n}\ninline void dfs(Re x,Re fa,Re S){\n    for(Re i=1;i<=v[0];++i)dp[x][i]=1;\n    for(Re i=head[x],to;i;i=a[i].next)\n        if((to=a[i].to)!=fa){\n            dfs(to,x,S);\n            for(Re j=1;j<=v[0];++j){\n                LL tmp=0;\n                for(Re k=1;k<=v[0];++k)if(A[v[j]][v[k]])tmp+=dp[to][k];\n                dp[x][j]*=tmp;\n            }\n        }\n}\nint main(){\n//    freopen(\"123.txt\",\"r\",stdin);\n    in(n),in(m),V=(1<<n)-1;\n    if(n==1){puts(\"1\");return 0;}\n    while(m--)in(x),in(y),A[x][y]=A[y][x]=1;\n    m=n-1;\n    while(m--)in(x),in(y),add(x,y),add(y,x);\n    for(Re s=0;s<=V;++s){\n        cnt[s]=cnt[s>>1]+(s&1),v[0]=0;\n        for(Re i=1;i<=n;++i)if(s&(1<<i-1))v[++v[0]]=i;\n        dfs(1,0,s);LL g=0;\n        for(Re i=1;i<=v[0];++i)g+=dp[1][i];\n        ans+=(n-cnt[s]&1)?-g:g;\n    }\n    printf(\"%lld\\n\",ans);\n}\n```\n\n\u5b8c\u7ed3\u6d12\u82b1\u82b1~\n\n...\u7b49\u7b49\uff0c\u8fd8\u6ca1\u5b8c\uff01\n\n\u8fd9\u9898\u795e\u5947\u5730\u6ca1\u6709\u8ba9\u53d6\u6a21\uff01\n\n\u867d\u7136\u7b54\u6848\u7684\u6700\u5927\u503c $n!$ \u6ca1\u6709\u7206 $\\text{long long}$\uff0c\u4f46 $\\max(g(V))=n^n$ \u7206\u4e86\u554a\u3002\n\nemm....\u624b\u5199\u9ad8\u7cbe\u591a\u534a\u4f1a $\\text{TLE}$ ....\u5c31\u9171\u5427awa  \n\uff08\u636e\u8bf4\u7528 $\\text{long long}$ \u548c $\\text{int128}$ \u7b97\u51fa\u6765\u7684\u7ed3\u679c\u662f\u4e00\u6837\u7684\uff09\n",
        "postTime": 1595583246,
        "uid": 110985,
        "name": "\u8fb0\u661f\u51cc",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3349 \u3010[ZJOI2016]\u5c0f\u661f\u661f\u3011"
    },
    {
        "content": "## \u4e00\u3001\u9898\u76ee\n[\u70b9\u6b64\u770b\u9898](https://www.luogu.org/problem/P3349)\n\n\n## \u4e8c\u3001\u89e3\u6cd5\n\n**0x01 \u66b4\u529b**\n\n\u4e0d\u591a\u8bf4\uff0c\u76f4\u63a5\u521a\u5168\u6392\uff0c\u7136\u540e\u518d\u66b4\u529b\u68c0\u67e5\uff0c$O(\u5b8c\u5168\u8fc7\u4e0d\u4e86)$\u3002\n\n**0x02 dp**\n\n\u8003\u8651\u7528\u58ee\u538b$dp$\u5bf9\u66b4\u529b\u4f18\u5316\uff0c\u8bbe$dp[i][j][s]$\u4e3a\u6811\u4e0a$i$\u8282\u70b9\u6620\u5c04\u5230\u56fe\u4e0a$j$\u8282\u70b9\uff0c$i$\u7684\u5b50\u6811\uff08\u542b$i$\u672c\u8eab\uff09\u6620\u5c04\u5230\u56fe\u4e0a\uff0c\u72b6\u538b\u6210\u4e8c\u8fdb\u5236$s$\u7684\u65b9\u6848\u6570\uff0c\u7528\u6811\u5f62$dp$\u7684\u65b9\u5f0f\u601d\u8003\uff0c\u5219\u80fd\u5199\u51fa\u4e0b\u5217\u4ee3\u7801\uff08\u6709\u6ce8\u91ca!\uff09\uff1a\n\n\n```cpp\n#include <cstdio>\n#include <vector>\nusing namespace std;\nconst int MAXN = (1<<17);\nint read()\n{\n\tint x=0,flag=1;char c;\n\twhile((c=getchar())<'0' || c>'9') if(c=='-') flag=-1;\n\twhile(c>='0' && c<='9') x=(x<<3)+(x<<1)+(c^48),c=getchar();\n\treturn x*flag;\n}\nint n,m,tot,f[18],siz[18];\nlong long ans,dp[18][18][MAXN];\nvector<int> ve[18],sit[18];\nstruct edge\n{\n\tint v,next;\n}e[40];\nvoid dfs(int u,int fa)\n{\n\tsiz[u]=1;\n\tfor(int i=1;i<=n;i++) dp[u][i][(1<<i-1)]=1;\n\tfor(int i=f[u];i;i=e[i].next)\n\t{\n\t\tint v=e[i].v;\n\t\tif(v==fa) continue;\n\t\tdfs(v,u);\n\t\t//\u770b\u6210\u5408\u5e76\u5b50\u6811\u7684\u8fc7\u7a0b\uff0c\u4e5f\u5c31\u662f\u628a\u5b50\u6811v\u52a0\u5165 \n\t\tfor(int id=1;id<=n;id++)\n\t\t{//\u6bcf\u4e3eu\u6620\u5c04\u5728\u56fe\u4e0a\u7684\u8282\u70b9\u7f16\u53f7 \n\t\t\tfor(int j=0;j<sit[siz[u]].size();j++)\n\t\t\t{\n\t\t\t\tint S=sit[siz[u]][j];\n\t\t\t\tif(!(S&(1<<id-1))) continue;//\u679a\u4e3e\u7684\u96c6\u5408\u5fc5\u987b\u5305\u542bid \n\t\t\t\tfor(int l=0;l<ve[id].size();l++)//\u53ea\u80fd\u53d6\u8ddfid\u5728\u56fe\u4e0a\u76f8\u8fde\u7684\u7f16\u53f7 \n\t\t\t\t{\n\t\t\t\t\tint vid=ve[id][l];\n\t\t\t\t\tif(S&(1<<vid-1)) continue;//\u679a\u4e3e\u7684\u96c6\u5408\u4e0d\u80fd\u5305\u542bvid\uff0c\u56e0\u4e3a\u6211\u4eec\u662f\u52a0\u5165\u5b50\u6811 \n\t\t\t\t\tfor(int k=0;k<sit[siz[v]].size();k++)\n\t\t\t\t\t{\n\t\t\t\t\t\tint vS=sit[siz[v]][k];\n\t\t\t\t\t\tif(S&vS || !(vS&(1<<vid-1))) continue;//\u539f\u96c6\u5408\u548c\u52a0\u5165\u7684\u96c6\u5408\u5fc5\u987b\u4e0d\u4ea4\uff0c \u52a0\u5165\u96c6\u5408\u8981\u5305\u542bvid \n\t\t\t\t\t\tdp[u][id][S|vS]+=dp[u][id][S]*dp[v][vid][vS];//\u4e58\u6cd5\u539f\u7406 \n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsiz[u]+=siz[v];//\u73b0\u5728\u5df2\u5408\u5e76\u5b50\u6811\u7684\u5927\u5c0f \n\t}\n}\nint main()\n{\n\tn=read();m=read();\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint u=read(),v=read();\n\t\tve[u].push_back(v);\n\t\tve[v].push_back(u);\n\t}\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tint u=read(),v=read();\n\t\te[++tot]=edge{v,f[u]},f[u]=tot;\n\t\te[++tot]=edge{u,f[v]},f[v]=tot;//\u524d\u5411\u661f \n\t}\n\tfor(int i=0;i<(1<<n);i++)\n\t{\n\t\tint x=0;\n\t\tfor(int j=0;j<n;j++)\n\t\t\tif(i&(1<<j))\n\t\t\t\tx++;\n\t\tsit[x].push_back(i);//\u9884\u5904\u7406\u51fa\u957f\u5ea6\u4e3ax\u7684\u6bcf\u4e00\u4e2as(\u6811dp\u8981\u7528) \n\t}\n\tdfs(1,0);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tans+=dp[1][i][(1<<n)-1];//\u7edf\u8ba11\u6620\u5c04\u5230i\u7684\u5168\u96c6 \n\t}\n\tprintf(\"%lld\\n\",ans);\n}\n```\n\n**0x03  \u5bb9\u65a5**\n\n\u4e0a\u9762\u7684\u65b9\u6cd5\u5176\u5b9e\u8fd8\u662f\u6bd4\u8f83\u597d\u4e86\uff0c\u53ea\u4e0d\u8fc7\u6570\u636e\u592a\u5927\uff0c\u88ab\u5361\u6210\u4e86\u66b4\u529b\u3002\n\n\u53d1\u73b0\u65f6\u95f4\u4e3b\u8981\u6d88\u8017\u5728\u96c6\u5408\u7684\u679a\u4e3e\u4e0a\uff0c\u5982\u679c\u53bb\u6389\u96c6\u5408\u7684\u679a\u4e3e\uff0c\u7b54\u6848\u4f1a\u504f\u5927\uff08\u56e0\u4e3a\u96c6\u5408\u4f1a\u6620\u5c04\u91cd\uff09\uff0c\u5bf9\u4e8e\u8fd9\u79cd\u95ee\u9898\u6211\u4eec\u8003\u8651\u5bb9\u65a5\uff0c\u90a3\u6211\u4eec\u600e\u4e48\u5bb9\u65a5\u5462\uff1f\n\n\u7531\u4e8e\u6211\u4eec\u6709\u91cd\u590d\u7684\u6620\u5c04\u662f\u4ece\u6570\u4e0a\u6620\u5c04\u5230\u56fe\u4e0a\u7684\uff0c\u6211\u4eec\u8003\u8651\u8ba9\u6811\u4e0a\u7684\u6620\u5c04\u91cd\u590d\uff0c\u5df2\u8fbe\u5230\u53bb\u91cd\u7684\u6548\u679c\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u89c4\u5b9a\u4e00\u4e2a\u56fe\u4e0a\u53ef\u7528\u7684\u96c6\u5408\uff0c\u6811\u5f62$dp$\u65f6\u53ea\u80fd\u6620\u5c04\u5230\u96c6\u5408\u4e2d\u7684\u7f16\u53f7\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u627e\u51fa\u4e86\u91cd\u590d\u65f6\u7684\u60c5\u51b5\u3002\u7b54\u6848\u5373\u4e3a$\u89c4\u5b9a\u5168\u96c6-\u89c4\u5b9a\u4e0d\u90091\u4e2a+\u89c4\u5b9a\u4e0d\u90092\u4e2a...$\u3002\n\n\n\u53e3\u80e1\u4e86\u8fd9\u4e48\u4e45\uff0c\u591a\u591a\u5c11\u5c11\u8fd8\u662f\uff08~~\u6ca1~~ \uff09\u6536\u83b7\u5427\uff0c\u8d34\u4e0a\u6211\u8981\u5438\u6c27\u7684\u4ee3\u7801\u3002:)\n\n\n```cpp\n#include <cstdio>\n#include <vector>\n#include <cstring>\n#define LL long long\nusing namespace std;\nint read()\n{\n\tint x=0,flag=1;char c;\n\twhile((c=getchar())<'0' || c>'9') if(c=='-') flag=-1;\n\twhile(c>='0' && c<='9') x=(x<<3)+(x<<1)+(c^48),c=getchar();\n\treturn x*flag;\n}\nint n,m,tot,f[18],exi[18];\nLL dp[18][18],ans;\nvector<int> ve[18];\nstruct edge\n{\n\tint v,next;\n}e[40];\nvoid dfs(int u,int fa)\n{\n\tfor(int i=1;i<=n;i++) dp[u][i]=1;\n\tfor(int i=f[u];i;i=e[i].next)\n\t{\n\t\tint v=e[i].v;\n\t\tif(v==fa) continue;\n\t\tdfs(v,u);\n\t\tfor(int j=1;j<=n;j++)\n\t\t{\n\t\t\tlong long s=0;\n\t\t\tfor(int l=0;l<ve[j].size();l++)\n\t\t\t{\n\t\t\t\tint k=ve[j][l];\n\t\t\t\ts+=dp[v][k]*(exi[j]&exi[k]);\n\t\t\t}\n\t\t\tdp[u][j]*=s;\n\t\t} \n\t}\n}\nint main()\n{\n\tn=read();m=read();\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint u=read(),v=read();\n\t\tve[u].push_back(v);\n\t\tve[v].push_back(u);\n\t}\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tint u=read(),v=read();\n\t\te[++tot]=edge{v,f[u]},f[u]=tot;\n\t\te[++tot]=edge{u,f[v]},f[v]=tot;\n\t}\n\tfor(int i=0;i<(1<<n);i++)\n\t{\n\t\tint x=n;\n\t\tmemset(dp,0,sizeof dp);\n\t\tmemset(exi,0,sizeof exi);\n\t\tfor(int j=1;j<=n;j++)\n\t\t\tif(i&(1<<j-1))\n\t\t\t\texi[j]=1,x--;\n\t\tdfs(1,0);\n\t\tfor(int j=1;j<=n;j++)\n\t\t{\n\t\t\tans+=dp[1][j]*(x%2?-1:1);\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",ans);\n}\n```\n",
        "postTime": 1570362049,
        "uid": 128239,
        "name": "C20203030",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3349 \u3010[ZJOI2016]\u5c0f\u661f\u661f\u3011"
    },
    {
        "content": "\u672c\u9898\u89e3\u914d\u5408\u6211\u7684 [\u5bb9\u65a5\u539f\u7406\u5b66\u4e60\u7b14\u8bb0](https://renamoe.gitee.io/2021/04/08/%E5%AE%B9%E6%96%A5%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/) \u98df\u7528\u66f4\u4f73\u3002\n\n> \u7ed9\u51fa\u4e00\u5f20\u56fe $G$ \u548c\u4e00\u68f5\u6811 $T$\uff0c\u70b9\u6570\u90fd\u4e3a $n$\uff0c\u6c42\u6709\u591a\u5c11\u4e2a\u957f\u4e3a $n$ \u7684\u6392\u5217 $\\{a_i\\}$\uff0c\u6ee1\u8db3\u82e5\u5b58\u5728 $\\langle u,v\\rangle \\in T$ \u5219\u4e00\u5b9a\u6709 $\\langle a_u,a_v\\rangle \\in G$\u3002\n>\n> $n\\le 17$\u3002\n\n\u9898\u610f\u8f6c\u5316\u4e00\u4e0b\uff0c\u5c31\u662f\u7ed9\u6811\u4e0a\u6bcf\u4e00\u4e2a\u70b9\u5206\u914d\u4e00\u4e2a\u7f16\u53f7\uff0c\u5e76\u4e14\u76f8\u90bb\u7684\u70b9\u6709\u7f16\u53f7\u7684\u9650\u5236\uff0c\u8981\u6c42\u6700\u540e\u7f16\u53f7\u65e0\u91cd\u590d\u3002\n\n\u5176\u5b9e\u4e00\u5f00\u59cb\u4e0d\u592a\u5bb9\u6613\u60f3\u5230\u8981\u5bb9\u65a5\uff0c\u4e0d\u59a8\u5148\u8003\u8651\u66b4\u529b\u72b6\u538b DP\u3002\u8bbe $f(u,i,S)$ \u8868\u793a $u$ \u70b9\u7f16\u53f7\u4e3a $i$\uff0c\u4e14\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u7684\u7f16\u53f7\u96c6\u5408\u4e3a $S$\uff0c\u7684\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u5c31\u662f\u5bf9\u51e0\u4e2a\u4e0d\u76f8\u4ea4\u7684\u96c6\u5408\u7684\u5408\u5e76\u3002\u663e\u7136\u8fd9\u6837\u590d\u6742\u5ea6\u662f\u7206\u70b8\u7684\uff0c\u4f46\u662f\u5df2\u7ecf\u6ca1\u6709\u4f18\u5316\u7684\u4f59\u5730\u4e86\u3002\n\n\u8fd9\u65f6\u5019\u5bb9\u65a5\u7684\u4f5c\u7528\u5c31\u663e\u73b0\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u653e\u5bbd\u9650\u5236\u6765\u964d\u4f4e\u590d\u6742\u5ea6\uff0c\u7136\u540e\u5bb9\u65a5\u6765\u5f97\u5230\u6700\u7ec8\u7b54\u6848\u3002\u6211\u4eec\u53ef\u4ee5\u7785\u51c6\u8f6c\u79fb\u65f6\u201c\u96c6\u5408\u4e0d\u76f8\u4ea4\u201d\u7684\u9650\u5236\uff0c\u4f46\u662f\u53bb\u6389\u4e86\u8fd9\u4e2a\u9650\u5236\u7684\u8bdd\uff0c\u7f16\u53f7\u4f1a\u91cd\u590d\uff0c\u7f16\u53f7\u96c6\u5408\u7684\u5927\u5c0f\u5c0f\u4e8e $n$\u3002\n\n\u8fd9\u65f6\u5019\u6709\u5bb9\u65a5\u7684\u5473\u9053\u4e86\u3002\u6211\u4eec\u53d1\u73b0\u8981\u6c42\u7684\u662f\u7f16\u53f7\u96c6\u5408\u5927\u5c0f**\u7b49\u4e8e** $n$\uff0c\u800c\u73b0\u5728\u53ea\u80fd\u5f97\u5230\u7f16\u53f7\u96c6\u5408\u5927\u5c0f**\u5c0f\u4e8e\u7b49\u4e8e** $n$ \u7684\u65b9\u6848\u6570\u3002\u4e8e\u662f\u6784\u9020\u82e5\u5e72\u4e2a\u9650\u5236\uff1a\u679a\u4e3e\u7f16\u53f7\u96c6\u5408 $S$\uff0c\u94a6\u5b9a\u6574\u68f5\u6811\u7684\u7f16\u53f7\u96c6\u5408\u4e3a $S$ \u7684\u5b50\u96c6\u3002$\\mathcal O(n^3)$ DP \u4e00\u4e0b\u53ef\u4ee5\u5f97\u5230 $s(S)$ \u8868\u793a\u6574\u68f5\u6811\u7f16\u53f7\u96c6\u5408\u4e3a $S$ \u7684\u5b50\u96c6\u7684\u65b9\u6848\u6570\u3002\n\n\u4e0a\u5957\u8def\uff0c\u8bbe\u5927\u5c0f\u4e3a $n$ \u7684\u7f16\u53f7\u96c6\u5408\u4e3a $U$\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u7f16\u53f7\u96c6\u5408\u6070\u597d\u4e3a $S$ \u7684\u65b9\u6848\uff0c\u6b63\u786e\u7684\u8d21\u732e\u5e94\u8be5\u4e3a $[S=U]$\uff0c\u5f97\u5230\u5bb9\u65a5\u7cfb\u6570\u8ba1\u7b97\u5f0f\n\n$$\n\\sum_{T\\supseteq S}f(T)=[S=U]\n$$\n\n\u8bc6\u522b\u4e3a\u96c6\u5408\u5f62\u5f0f\uff0c\u5b50\u96c6\u53cd\u6f14\u53ef\u4ee5\u5f97\u5230\u5bb9\u65a5\u7cfb\u6570\n\n$$\n\\begin{aligned}\nf(S)&=\\sum_{T\\supseteq S}(-1)^{|T|-|S|}[T=U]\\\\\n&=(-1)^{n-|S|}\n\\end{aligned}\n$$\n\n\u6700\u540e\u7b54\u6848\u5c31\u662f $\\sum_{S\\subseteq U}s(S)f(T)$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5f97\u5230\u4e86 $\\mathcal O(n^32^n)$ \u7684\u505a\u6cd5\uff0c\u5b9e\u9645\u4e0a\u8dd1\u7684\u98de\u5feb\u3002\n\n\n```cpp\ntypedef long long LL;\n\nconst int N = 20;\nconst int M = (1 << 17) + 5;\n\nint n, m;\nLL ans;\nint g[N][N], popcnt[M];\nLL f[N][N];\nvector<int> e[N], lst;\n\nvoid dp(int u, int fa) {\n\tfor (auto v: e[u]) {\n\t\tif (v == fa) continue;\n\t\tdp(v, u);\n\t}\n\tfor (auto i: lst) {\n\t\tf[u][i] = 1;\n\t\tfor (auto v: e[u]) {\n\t\t\tif (v == fa) continue;\n\t\t\tLL sum = 0;\n\t\t\tfor (auto j: lst) {\n\t\t\t\tif (!g[i][j]) continue;\n\t\t\t\tsum += f[v][j];\n\t\t\t}\n\t\t\tf[u][i] *= sum;\n\t\t}\n\t}\n}\n\ninline void clear() {\n\tif (lst.empty()) return;\n\tfor (int i = 1; i <= n; ++i)\n\t\tfor (auto j: lst)\n\t\t\tf[i][j] = 0;\n\tlst.clear();\n}\n\ninline void main() {\n\tcin >> n >> m;\n\tfor (int i = 1; i <= m; ++i) {\n\t\tint u, v;\n\t\tcin >> u >> v;\n\t\tg[u][v] = g[v][u] = 1;\n\t}\n\tfor (int i = 1; i < n; ++i) {\n\t\tint u, v;\n\t\tcin >> u >> v;\n\t\te[u].push_back(v);\n\t\te[v].push_back(u);\n\t}\n\tint lim = 1 << n;\n\tfor (int i = 0; i < lim; ++i) popcnt[i] = popcnt[i >> 1] + (i & 1);\n\tfor (int s = 0; s < lim; ++s) {\n\t\tclear();\n\t\tfor (int i = 1; i <= n; ++i)\n\t\t\tif (s & (1 << (i - 1))) lst.push_back(i);\n\t\tdp(1, 0);\n\t\tLL sum = 0;\n\t\tfor (auto i: lst) sum += f[1][i];\n\t\tans += sum * (((n - popcnt[s]) & 1) ? -1 : 1);\n\t}\n\tcout << ans << '\\n';\n}\n```\n",
        "postTime": 1617874108,
        "uid": 52243,
        "name": "RenaMoe",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3349 [ZJOI2016]\u5c0f\u661f\u661f"
    },
    {
        "content": "# \u524d\u8a00\n\u770b\u9898\u89e3\u533a\u5404\u4f4d\u5927\u4f6c\u90fd\u662f\u7528\u7684\u795e\u4ed9\u7684\u5bb9\u65a5 dp \uff0c\u53ef\u662f\u672c\u849f\u84bb\u6839\u672c\u60f3\u4e0d\u5230\u554a... qwq  \n\u6211\u5199\u7684\u65f6\u5019\u7528\u7684\u662f\u4e00\u79cd\u548c\u672c\u9898\u5927\u90e8\u5206\u505a\u6cd5\u90fd\u4e0d\u540c\u7684\u601d\u8def\uff0c\u867d\u7136\u65f6\u95f4\u590d\u6742\u5ea6\u5e76\u6ca1\u6709\u6b63\u89e3\u4f18\u8d8a\uff0c\u4f46\u662f\u601d\u8003\u8d77\u6765\u548c\u4ee3\u7801\u5b9e\u73b0\u90fd\u53d8\u5f97\u66f4\u52a0\u7b80\u5355.  \n\uff08\u7b2c\u4e00\u6b21\u53d1\u9898\u89e3\uff0c\u5e0c\u671b\u7ba1\u7406\u5458\u901a\u8fc7\uff01 OvO \uff09\n\n# \u89e3\u6790\n\u76f4\u63a5\u8003\u8651\u6734\u7d20 dp .  \n$dp_{i,s,j}$ \u8868\u793a $i$ \u7684\u5b50\u6811\u5185\uff0c\u5df2\u7ecf\u88ab\u5bf9\u5e94\u7684\u8282\u70b9\u72b6\u6001\u4e3a $s$ \uff0c$i$ \u5bf9\u5e94\u7684\u8282\u70b9\u662f $j$ \u7684\u5bf9\u5e94\u65b9\u6848\u6570.  \n\u5f53 $x$ \u7684\u5b50\u6811\u5185\u53c8\u7eb3\u5165\u4e86\u4e00\u4e2a\u65b0\u513f\u5b50\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u679a\u4e3e**\u4ea4\u96c6\u4e3a $0$ \u7684 $u$ \u548c $v$ ,\u4ee5\u53ca\u4e24\u4e2a\u96c6\u5408\u4e2d\u6709\u8fde\u8fb9\u7684 $p$ \u548c $q$ ,** \u8fdb\u884c\u8f6c\u79fb\uff1a  \n$$ dp_{x,u|v,q}+=dp_{son,u,p}\\times dp_{x,v,q}  $$\n\u7136\u800c\u8fd9\u4e48\u641e\uff0c\u5373\u4f7f\u52a0\u4e0a\u679a\u4e3e\u5b50\u96c6\u7684\u4f18\u5316\uff0c\u4e5f\u662f\u4f1a T \u98de\u7684.  \n\u4ed4\u7ec6\u60f3\u60f3\uff0c\u8fd9\u91cc\u6709\u5f88\u591a\u7684 dp \u672c\u8eab\u663e\u7136\u4f1a\u662f\u4e0d\u5408\u6cd5\u7684\uff0c\u6211\u4eec\u8fdb\u884c\u4e86\u592a\u591a\u65e0\u7528\u7684\u8f6c\u79fb.  \n\u8003\u8651\u5982\u4f55\u4f18\u5316.  \n\u8bb0 $siz_i$ \u4e3a $i$ \u7684\u5b50\u6811\u5927\u5c0f.  \n\u663e\u7136\uff0c\u5982\u679c $u$ \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u76841\u7684\u4e2a\u6570\u4e0d\u7b49\u4e8e $siz_{son}$ \uff0c\u90a3\u4e48 $dp_{son,u,...}$ \u5fc5\u7136\u662f\u4e0d\u5408\u6cd5\u7684\uff0c\u6ca1\u6709\u5fc5\u8981\u4ece\u90a3\u91cc\u8fdb\u884c\u8f6c\u79fb\uff0c\u6211\u4eec\u53ea\u9700\u8981**\u679a\u4e3e\u4e8c\u8fdb\u5236\u8868\u793a\u4e0b1\u7684\u4e2a\u6570\u7b49\u4e8e $siz_{son}$ \u7684 $u$ \u8fdb\u884c\u8f6c\u79fb\u5373\u53ef**.  \n\u540c\u7406\uff0c\u82e5 $x$ \u5728**\u52a0\u5165 $son$ \u524d**\u7684\u5b50\u6811\u5927\u5c0f\u4e3a $siz_x$ \uff0c\u6211\u4eec\u4e5f\u53ea\u9700\u8981\u679a\u4e3e\u4e8c\u8fdb\u5236\u8868\u793a\u4e0b $1$ \u7684\u4e2a\u6570\u7b49\u4e8e $siz_x$ \u7684 $v$ \u8fdb\u884c\u8f6c\u79fb\u5373\u53ef.  \n\u548c[\u6709\u7ebf\u7535\u89c6\u7f51\uff08\u6811\u4e0a\u80cc\u5305\uff09](https://www.luogu.com.cn/problem/P1273)\u7684\u5b9e\u73b0\u8fc7\u7a0b\u6709\u5f02\u66f2\u540c\u5de5\u4e4b\u5999.  \n\n\u6700\u540e\u7684\u7b54\u6848\u5c31\u662f\uff1a\n$$\\sum\\limits_{i=1}^ndp_{1,2^n-1,i}$$\n\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0c\u4e3a\u4e86\u540e\u9762\u679a\u4e3e\u7684\u65b9\u4fbf\uff0c\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6765\u4e8c\u8fdb\u5236\u8868\u793a\u4e0b $1$ \u7684\u4e2a\u6570\u4e3a $k$ \u7684\u6570\u6709\u54ea\u4e9b.  \n\n\n\u4e8e\u662f\uff0c\u4ec5\u4ec5\u52a0\u5165\u4e86\u8fd9\u4e48\u4e00\u4e2a\u5c0f\u6e05\u65b0\u4e14\u7b80\u5355\u6613\u61c2\u7684\u4f18\u5316\u4e4b\u540e\uff0c\u4f60\u53d1\u73b0\u4f60\u5df2\u7ecf\u5207\u6389\u4e86\u8fd9\u9053\u7d2b\u9898.\n\n\u672c\u4eba\u7684\u4ee3\u7801\u5b8c\u5168\u6ca1\u6709\u5361\u8fc7\u5e38\uff0c\u4e0d\u5438\u6c27\u4f1aT\u4e00\u4e2a\u70b9\uff0c\u5438\u6c27\u540e\u53ef\u4ee5\u901a\u8fc7.  \n~~\u4f46\u662f\u73b0\u5728CSP NOIP\u90fd\u6709\u6c27\u6c14\u4e86\uff0c\u5438\u6c27\u53c8\u6709\u4ec0\u4e48\u5173\u7cfb\u5462.~~  \n~~\u6bd5\u7adf\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u6bd4\u5bb9\u65a5\u597d\u50cf\u591a\u4e86\u554a!~~  \n\u4ee3\u7801\u5199\u8d77\u6765\u4e5f\u5f88\u8212\u9002\uff0c\u4e0d\u4f24\u809d.\n# \u4ee3\u7801\n\uff08\u6709\u6ce8\u91ca\u54e6\uff01\uff09\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define il inline\nconst int N=2e5+100;\nconst double eps=1e-6;\nll read(){\n  ll x=0,f=1;char c=getchar();\n  while(!isdigit(c)){if(c=='-')f=-1;c=getchar();}\n  while(isdigit(c)){x=(x<<1)+(x<<3)+c-'0';c=getchar();}\n  return x*f;\n}\nint n,m;\nstruct node{\n  int to,nxt;\n}p[38];\nint fi[N],cnt;\ninline void addline(int x,int y){\n  p[++cnt]=(node){y,fi[x]};fi[x]=cnt;\n  return;\n}\nint st[18][N],num[18],mi[18];\nint siz[18];\nll dp[18][N][18];\nbool vis[18][18];\nvoid dfs(int x,int f){\n  siz[x]=1;\n  for(int i=0;i<n;i++) dp[x][mi[i]][i+1]=1;//\u4e00\u5f00\u59cbx\u5bf9\u5e94\u4efb\u4f55\u4e00\u4e2a\u8282\u70b9\u7684\u65b9\u6848\u6570\u90fd\u4e3a1\n  for(int i=fi[x];~i;i=p[i].nxt){\n    int to=p[i].to;\n    if(to==f) continue;\n    dfs(to,x);\n    int a=siz[x],b=siz[to];\n    for(int j=1;j<=num[a];j++){//\u679a\u4e3e\u4e8c\u8fdb\u5236\u4e0b\u6709siz[x]\u4e2a1\u7684\u72b6\u6001\n      int u=st[a][j];\n      for(int k=1;k<=num[b];k++){//\u679a\u4e3e\u4e8c\u8fdb\u5236\u4e0b\u6709siz[son]\u4e2a1\u7684\u72b6\u6001\n\tint v=st[b][k];\n\tif(u&v) continue;//\u5982\u679c\u6709\u4ea4\u96c6\uff0c\u4e0d\u80fd\u4ea7\u751f\u8d21\u732e\n\tfor(int p=1;p<=n;p++){\n\t  if(!dp[to][v][p]) continue;//\u5982\u679cdp[to][v][p]=0,\u5fc5\u7136\u4e0d\u4f1a\u518d\u8f6c\u79fb\u4ea7\u751f\u8d21\u732e\n\t  if((v&mi[p-1])==0) continue;//\u679a\u4e3e\u7684p\u5fc5\u987b\u662fv\u96c6\u5408\u5185\u7684\u5143\u7d20\n\t  for(int q=1;q<=n;q++){\n\t    if(!vis[p][q]) continue;//p\u548cq\u4e4b\u95f4\u5fc5\u987b\u6709\u8fde\u8fb9\n\t    if((u&mi[q-1])==0) continue;//\u679a\u4e3e\u7684q\u5fc5\u987b\u662fu\u96c6\u5408\u5185\u7684\u5143\u7d20\n\t    dp[x][u|v][q]+=dp[to][v][p]*dp[x][u][q];\n\t  }\n\t}\n      }\n    }\n    siz[x]+=siz[to];\n  }\n  return;\n}\ninline int calc(int x){\n  int res=0;\n  while(x){\n    res+=x&1;x>>=1;\n  }\n  return res;\n}\nint main(){\n#ifndef ONLINE_JUDGE\n  freopen(\"a.in\",\"r\",stdin);\n  freopen(\"a.out\",\"w\",stdout);\n  #endif\n  memset(fi,-1,sizeof(fi));cnt=-1;\n  n=read();m=read();\n  for(int i=1;i<=m;i++){\n    int x=read(),y=read();\n    vis[x][y]=vis[y][x]=1;\n  }\n  for(int i=1;i<n;i++){\n    int x=read(),y=read();\n    addline(x,y);addline(y,x);\n  }\n  mi[0]=1;\n  for(int i=1;i<=n;i++) mi[i]=mi[i-1]<<1;\n  for(int i=0;i<mi[n];i++){//\u9884\u5904\u7406\u4e8c\u8fdb\u5236\u4e0b\u6709k\u4e2a1\u7684\u6570\u6709\u54ea\u4e9b\n    int o=calc(i);\n    st[o][++num[o]]=i;\n  }\n  dfs(1,0);\n  ll res=0;\n  for(int i=1;i<=n;i++){//\u7edf\u8ba1\u7b54\u6848\n    res+=dp[1][mi[n]-1][i];\n  }\n  printf(\"%lld\\n\",res);\n  return 0;\n}\n/*\n\n*/\n\n\n```\n(\u8fd9\u4e48\u7b80\u5355\u7684\u505a\u6cd5\u4e0d\u70b9\u4e2a\u8d5e\u518d\u8d70\u5417 awa )\n\n",
        "postTime": 1635338205,
        "uid": 449265,
        "name": "wind_whisper",
        "ccfLevel": 10,
        "title": "P3349 \u5c0f\u661f\u661f \u9898\u89e3"
    },
    {
        "content": "\u5df2\u6709\u7684\u9898\u89e3\u90fd\u4e3a\u8f83\u4e3a\u57fa\u7840\u7684\u5bb9\u65a5\u7b97\u6cd5\uff0c\u8fd9\u79cd\u5bb9\u65a5\u7684\u6b63\u786e\u6027\u5b9e\u9645\u4e0a\u5e76\u4e0d\u663e\u7136\u3002\n\n\u5728\u6b64\uff0c\u7ed9\u51fa\u4e00\u79cd\u57fa\u4e8e $\\textsf{FWT}$ \u7684\u505a\u6cd5\u3002\n\n\u8bbe\u8ba1 $f_{i,j,S}$ \u8868\u793a $i$ \u7684\u5b50\u6811\u91cc\uff0c\u70b9 $i$ \u5bf9\u5e94\u70b9\u4e3a $j$\uff0c\u5b50\u6811\u503c\u57df\u4e3a $S$ \u7684\u65b9\u6848\u6570\uff0c\u8f6c\u79fb\u662f\u5b50\u96c6\u5377\u79ef\u7684\u5f62\u5f0f\u3002\n\n\u5bf9\u4e8e\u5b50\u96c6\u5377\u79ef\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5360\u4f4d\u591a\u9879\u5f0f\u5728\u590d\u6742\u5ea6\u591a\u4e58\u4e00\u4e2a $n$ \u7684\u4ee3\u4ef7\u4e0a\u8f6c\u5316\u4e3a\u5f02\u6216\u5377\u79ef\u3002\n\n\u4f46\u5b9e\u9645\u4e0a\u5e76\u4e0d\u9700\u8981\u5360\u4f4d\u591a\u9879\u5f0f\uff0c\u8003\u8651\u76f4\u63a5\u8fdb\u884c\u5f02\u6216\u5377\u79ef\u7684\u8fc7\u7a0b\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u6211\u4eec\u6700\u540e\u6c42\u7684\u662f $f_S$\uff0c\u800c\u6bcf\u4e00\u4e2a\u6811\u4e0a\u7684\u70b9\u6700\u591a\u63d0\u4f9b\u4e00\u4e2a\u6570\uff0c\u82e5\u5728\u5f02\u6216\u65f6\u5b58\u5728\u4e00\u4f4d\u62b5\u6d88\uff0c\u5219\u6700\u540e\u6c42\u51fa\u7684 $|S|<n$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u8bc1\u660e\u4e86\u76f4\u63a5\u5f02\u6216\u5377\u79ef\u7684\u6b63\u786e\u6027\u3002\n\n\u63a5\u4e0b\u6765\u5c06\u8f6c\u79fb\u5199\u51fa\uff0c\u4fbf\u6709\u4e00\u4e2a $\\mathcal{O}(n^32^n)$ \u7684 $\\textsf{FWT}$ \u505a\u6cd5\u3002\u7b14\u8005\u5bf9\u8fd9\u79cd\u505a\u6cd5\u8fdb\u884c\u5b9e\u73b0\u518d\u7ecf\u5386\u6570\u6b21\u5361\u5e38\u540e\u53d1\u73b0\u5e76\u4e0d\u53ef\u8fc7\u3002\n\n\u8fd9\u79cd\u505a\u6cd5\u4f3c\u4e4e\u5df2\u7ecf\u6ca1\u6709\u4f18\u5316\u7a7a\u95f4\u4e86\uff0c\u8ba9\u6211\u4eec\u770b\u4e00\u4e0b\u4ee3\u7801\uff1a\n\n```cpp\nIV dfs(ll u,ll F){\n\tfor(ll v:g[u])if(v^F)dfs(v,u);\n\tF(pu,1,n){\n\t\tf[u][pu][1<<pu-1]=1;FWT(f[u][pu]);//third line\n\t\tfor(ll v:g[u])if(v^F){\n\t\t\tmem(tmp,0);\n\t\t\tF(pv,1,n)if(vis[pu][pv])F(j,0,S)tmp[j]+=f[v][pv][j];\n\t\t\tFWT(tmp);F(i,0,S)f[u][pu][i]=f[u][pu][i]*tmp[i];//first line \n\t\t}\n\t\tIFWT(f[u][pu]);//second line\n\t}\n}\n```\n\n\u6211\u4eec\u53d1\u73b0 `first line` \u6807\u8bb0\u5904\u7684\u4e00\u6b21 $\\textsf{FWT}$  \u53ef\u4ee5\u62c6\u5206\u4e3a\u5bf9 $f_{v,pv}$ \u7684 $\\textsf{FWT}$ \u4e4b\u548c\uff0c\u800c $f_{v,pv}$ \u6b64\u5904\u7684\u503c\u5df2\u7ecf\u5728 `second line` \u5904\u8fdb\u884c\u4e86\u4e00\u6b21 $\\textsf{IFWT}$ \u3002\n\n\u4e8e\u662f\u6211\u4eec\u60f3\u5230\u8bb0\u5f55\u6bcf\u4e2a\u70b9\u7684 $\\textsf{FWT}$ \u5f62\u5f0f\uff0c\u5728\u6839\u5904\u8fdb\u884c\u4e00\u6b21 $\\textsf{FWT}$\u3002\n\n\u4f46\u6211\u4eec\u548c\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u6ca1\u6709\u89e3\u51b3\uff0c\u5728 `third line` \u5904\u7684\u4e00\u884c $\\textsf{FWT}$\u3002\n\n\u6211\u4eec\u56de\u5f52 $\\textsf{FWT}$ \u7684\u5b9a\u4e49\u5f0f\uff0c$[z^A]\\textsf{FWT}(F)=\\sum\\limits_{B\\subseteq S}(-1)^{\\textsf{popcount}(A\\&B)}[z^B]F$\uff0c\u800c\u6b64\u5904 $F$ \u53ea\u6709\u4e00\u4e2a\u4f4d\u7f6e\u6709\u503c\uff0c\u66b4\u529b\u5373\u53ef\u3002\n\n\u6211\u4eec\u5728\u4e00\u7cfb\u5217\u7684\u4f18\u5316\u540e\uff0c\u5c3d\u7ba1\u590d\u6742\u5ea6\u4e0d\u53d8\uff0c\u4f46\u5177\u6709\u66f4\u52a0\u4f18\u7f8e\u7684\u5f62\u5f0f\uff0c\u4e14\u4e0d\u9700\u8981\u7528\u5230 $\\textsf{FWT}$\u3002\n\n\u56e0\u6b64\u5e38\u6570\u6709\u663e\u8457\u7684\u4e0b\u964d\uff0c\u7b14\u8005\u5b9e\u73b0\u540e\u53d1\u73b0\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\n```cpp\nconst int maxn = 20;\nconst int maxS = (1<<17);\nll n,S,f[maxn][maxn][maxS];bool vis[maxn][maxn];\nvector<ll>g[maxn];IV add(ll u,ll v){g[u].push_back(v);}\nll tmp[maxS];IV print(ll S){F(i,0,n-1)putchar((S>>i&1)+'0');}ll tot;\nIV dfs(ll u,ll F){\n\tfor(ll v:g[u])if(v^F)dfs(v,u);\n\tF(pu,1,n){\n\t\tF(k,0,S)f[u][pu][k]=(__builtin_popcount((1<<pu-1)&k)&1)?-1:1;\n\t\tfor(ll v:g[u])if(v^F){\n\t\t\tmem(tmp,0);\n\t\t\tF(pv,1,n)if(vis[pu][pv])F(j,0,S)tmp[j]+=f[v][pv][j];\n\t\t\tF(i,0,S)f[u][pu][i]=f[u][pu][i]*tmp[i];\n\t\t}\n\t}\n}\nint main(){\n\tn=read();S=(1<<n)-1;ll m=read();\n\twhile(m--){ll x=read(),y=read();vis[x][y]=vis[y][x]=1;}\n\tF(i,1,n-1){ll x=read(),y=read();add(x,y);add(y,x);}dfs(1,0);ll ans=0;\n\tF(i,1,n){ll tmp=0;F(j,0,S)tmp+=f[1][i][j]*((__builtin_popcount(S&j)&1)?-1:1);ans+=tmp/(S+1);}\n\treturn cout<<ans,0;\n}\n```\n\n\u95f2\u8bdd\uff1a\u8fd9\u91cc\u7684 FWT \u53ef\u80fd\u5b9e\u9645\u4e0a\u4e25\u8c28\u7684\u8bc1\u660e\u4e86\u5bb9\u65a5\u7684\u6b63\u786e\u6027\uff1f\n\n\n\n\n\n\n\n",
        "postTime": 1678099103,
        "uid": 359952,
        "name": "_lbw_",
        "ccfLevel": 6,
        "title": "\u300cZJOI2016\u300d\u5c0f\u661f\u661f \u9898\u89e3"
    },
    {
        "content": "# \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u68f5$n$\u4e2a\u70b9\u7684\u6811$T$\uff0c\u548c\u4e00\u5f20$n$\u4e2a\u70b9$m$\u6761\u8fb9\u7684\u56fe$S$\uff0c\u6c42\u6709\u591a\u5c11\u79cd\u70b9\u4e4b\u95f4\u7684\u5bf9\u5e94\u5173\u7cfb\u7684\u65b9\u6848\u4f7f\u5f97$T$\u4e3a$S$\u7684\u4e00\u4e2a\u5b50\u56fe(\u7b49\u4ef7\u4e8e$T$\u4e2d\u7684\u6bcf\u6761\u8fb9\u5728\u67d0\u79cd\u70b9\u7684\u5bf9\u5e94\u5173\u7cfb\u4e0b\u5728$S$\u4e2d\u90fd\u5b58\u5728)\n$$n\\leq 17$$\n$\\;$\n# Solution\n## \u66b4\u529b\n\n\u4e00\u79cd\u6734\u7d20\u7684\u60f3\u6cd5\u5c31\u662f\u66b4\u529b\u7684\u679a\u4e3e\u6bcf\u4e00\u79cd\u5bf9\u5e94\u65b9\u5f0f\uff1a\n\n\u5982\u4e0b\u662f$n=3$\u7684\u60c5\u51b5\uff0c\u7bad\u5934\u5de6\u8fb9\u662f\u6811\u4e2d\u7684\u6bcf\u4e2a\u70b9\uff0c\u53f3\u8fb9\u5bf9\u5e94\u7684\u662f\u56fe\u4e2d\u7684\u6bcf\u4e2a\u70b9\n\n1->1, 2->2, 3->3\n\n1->1, 2->3, 3->2\n\n1->2, 2->3, 3->1\n\n1->2, 2->1, 3->3\n\n1->3, 2->1, 3->2\n\n1->3, 2->2, 3->1\n\n\u7136\u540e\u6211\u4eec\u5bf9\u6bcf\u79cd\u60c5\u51b5\u6211\u4eec\u518d\u7528$O(n)$\u7684\u65f6\u95f4\u53bb\u5224\u65ad\u6811\u4e2d\u7684\u6bcf\u6761\u8fb9\u662f\u5426\u5728\u56fe\u4e2d\u90fd\u5b58\u5728\u5373\u53ef\n\n\u65f6\u95f4\u590d\u6742\u5ea6:$O(n!\\times n)$\n\n## \u5b50\u96c6\u679a\u4e3eDP\n\u6211\u4eec\u7531\u9898\u4e2d\u5f97\u51fa$T$\u662f\u4e00\u68f5\u6811\uff0c\u800c\u5176\u5b9e\u5982\u679c$T$\u662f\u4e00\u5f20\u56fe\uff0c\u7528\u4e0a\u9762\u7684\u66b4\u529b\u7b97\u6cd5\u4e5f\u662f\u53ef\u505a\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u601d\u8003\u5982\u4f55\u5229\u7528\u6811\u7684\u7279\u6b8a\u6027\u8d28\u6765\u6316\u6398\u9690\u542b\u7684\u7ec6\u8282\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u9898\u4e2d\u7684\u6700\u5927\u96be\u70b9\u5e76\u4e0d\u662f\u5904\u7406$T$\u662f$S$\u7684\u5b50\u56fe\u8fd9\u4e2a\u9650\u5236\u6761\u4ef6\uff0c\u800c\u662f\u53bb\u8ba1\u7b97\u70b9\u4e4b\u95f4\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u4f7f\u5f97\u65b9\u6848\u6570**\u4e0d\u91cd\u4e0d\u6f0f**\n\n\u6240\u4ee5\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a\u601d\u8def\uff1a\u5728\u6811$T$\u4e0a\u8fdb\u884c\u6811\u5f62DP\n\n\u9996\u5148\u662f\u8bbe\u8ba1\u72b6\u6001\n\n\u7b2c\u4e00\u7ef4\uff1a$i$\uff0c\u5f53\u7136\u5b58\u7684\u662f\u4ee5$i$\u4e3a\u6839\u7684\u5b50\u6811\u7684\u4fe1\u606f\n\n\u7b2c\u4e8c\u7ef4\uff1a$j$\uff0c\u7531\u4e8e\u5b50\u6811\u4e0e\u5916\u754c\u4e4b\u95f4\u8fd8\u6709\u9650\u5236\u6761\u4ef6\uff0c\u5373\uff1a\u6839\u8282\u70b9$i$\u4e0e\u5176\u7236\u4eb2\u5728DP\u4e2d\u5728\u56fe\u4e2d\u5206\u522b\u5bf9\u5e94\u7684\u70b9\u4f1a\u6709\u8fb9\u7684\u9650\u5236\u6761\u4ef6\uff0c\u6240\u4ee5$j$\u8868\u793a\u7684\u662f$i$\u5728\u56fe\u4e2d\u7684\u5bf9\u5e94\u70b9\n\n\u7b2c\u4e09\u7ef4\uff1a$k$\uff0c\u7531\u4e8e\u6811\u4e0a\u7684\u6bcf\u4e2a\u70b9\u53ea\u80fd**\u552f\u4e00**\u5bf9\u5e94\u56fe\u4e2d\u7684\u70b9\uff0c\u6240\u4ee5\u5982\u679c\u53ea\u6709\u524d\u4e24\u7ef4\u72b6\u6001\uff0c\u6211\u5e76\u4e0d\u80fd\u77e5\u9053\u76ee\u524d\u8fd9\u68f5\u5b50\u6811\u4e2d\u6bcf\u4e2a\u70b9\u5df2\u7ecf\u5bf9\u5e94\u5230\u4e86\u56fe\u4e2d\u7684\u54ea\u4e9b\u70b9\uff0c\u6240\u4ee5\u5c31\u53ef\u80fd\u5bfc\u81f4\u6211\u4eec\u4f1a\u7b97\u91cd\uff0c\u5373\uff1a\u6811\u4e0a\u7684\u67d0\u51e0\u4e2a\u70b9\u5bf9\u5e94\u5230\u4e86\u56fe\u4e2d\u7684\u540c\u4e00\u4e2a\u70b9\u4e0a\uff0c\u6240\u4ee5$k$\u662f\u8868\u793a\u6211\u4eec\u76ee\u524d\u9009\u7684\u70b9\u96c6\uff0c\u7528\u4e00\u4e2a\u538b\u7f29\u540e\u7684\u4e8c\u8fdb\u5236\u6570\u6765\u8868\u793a\n\n\u7efc\u4e0a\u6240\u8ff0\uff1a$f_{i,j,k}$\u8868\u793a\u4ee5$i$\u4e3a\u6839\u7684\u5b50\u6811\uff0c\u5176\u4e2d$i$\u5bf9\u5e94\u7684\u662f\u56fe\u4e2d\u7684\u7f16\u53f7\u4e3a$j$\u7684\u70b9\uff0c\u4e14\u5b50\u6811\u4e2d\u5df2\u7ecf\u9009\u4e86\u96c6\u5408\u4e3a$k$\u7684\u70b9\uff0c\u6ee1\u8db3\u8fd9\u68f5\u5b50\u6811\u662f$T$\u4e2d\u628a\u96c6\u5408\u4e3a$k$\u7684\u70b9\u5728\u5176\u4e2d\u7684\u5bf9\u5e94\u70b9\u6311\u51fa\u6765\u6240\u5bf9\u5e94\u7684\u56fe\u7684\u5b50\u56fe\n\n\u5443\uff0c\u53ef\u80fd\u6709\u70b9\u957f\uff0c\u8bfb\u8005\u53ef\u4ee5\u4ed4\u7ec6\u5730\u591a\u8bfb\u51e0\u904d\u518d\u6d88\u5316\u7406\u89e3\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u5b50\u56fe\u4e5f\u5c31\u662f\u8fb9\u7684\u8fd9\u4e2a\u9650\u5236\u6761\u4ef6\uff0c\u6211\u4eec\u53ea\u9700\u5728DP\u7684\u8fc7\u7a0b\u4e2d\u5224\u65ad$i$\u4e0e\u5b83\u7684\u6bcf\u4e2a\u513f\u5b50\u5728\u56fe\u4e2d\u662f\u5426\u6709\u8fb9\u5373\u53ef\u3002\n\n\u56e0\u6b64\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u4e5f\u6613\u5f97\u51fa\uff1a\n\n$$f_{i,j,k}=\\prod_{v\\in son_u} \\sum_{p\\in Edge_{p,j}} \\sum_{q\\in k} f_{v,p,q}$$  \n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n^3\\times 3^n)$  \n$\\;$\n## \u5bb9\u65a5\u539f\u7406\u4f18\u5316\n\u6211\u4eec\u53d1\u73b0\uff0c\u4e0a\u9762\u7684DP\u9650\u5236\u65f6\u95f4\u7684\u4e3b\u8981\u56e0\u7d20\u662f\u6211\u4eec\u679a\u4e3e\u4e86$k$\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u76ee\u524d\u9009\u7684\u70b9\u96c6\u3002\n\n\u8fd9\u6837\u5bfc\u81f4\u65f6\u95f4\u66b4\u589e\u3002\n\n\u6211\u4eec\u8003\u8651\u5982\u4f55\u53bb\u4f18\u5316\u8fd9\u4e2a\u4e1c\u897f\u3002\n\n\u800c\u4ed4\u7ec6\u5206\u6790\u5373\u53ef\u53d1\u73b0\u679a\u4e3e$k$\u662f\u4e3a\u4e86\u9632\u6b62\u7b97\u91cd\uff0c\u90a3\u6211\u4eec\u4e0d\u59a8\u53ef\u4ee5\u5927\u80c6\u7684\u6254\u6389$k$\uff0c\u76f4\u63a5\u8fdb\u884cDP\u3002\n\n\u800c\u8fd9\u6837\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u53ea\u6709$O(n^3)$\n\n\u4f46\u8fd9\u6837\u663e\u7136\u662f\u9519\u7684\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5982\u4f55\u53bb\u51cf\u6389\u91cd\u590d\u7684\u60c5\u51b5\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u56e0\u4e3a\u591a\u4e2a\u70b9\u5bf9\u5e94\u56fe\u4e2d\u7684\u4e00\u4e2a\u70b9\u3002\u90a3\u4e48\u56fe\u4e2d\u4e00\u5b9a\u5b58\u5728\u82e5\u5e72\u4e2a\u70b9\u6ca1\u6709\u4e0e\u6811\u4e2d\u7684\u70b9\u5bf9\u5e94\n\n\u4e8e\u662f\u8fd9\u4e2a\u4e1c\u897f\u5c31\u53ef\u4ee5\u5bb9\u65a5\u4e86\uff1a\u6211\u4eec\u5728\u56fe\u4e2d\u679a\u4e3e\u4e0e\u6811\u4e2d\u5bf9\u5e94\u7684\u70b9\u6709\u54ea\u4e9b\uff0c\u8bb0\u4e3a\u70b9\u96c6$A$\uff0c\u5bb9\u65a5\u7cfb\u6570\u663e\u7136\u4e3a$(-1)^{n-|A|}$\n\n\u5219\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5728DP\u65f6\u53ea\u9700\u9009\u6211\u4eec\u679a\u4e3e\u7684\u70b9\u96c6\u8fdb\u884c\u72b6\u6001\u8f6c\u79fb\u5373\u53ef\u3002\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n^3 \\times 2^n)$\n$\\;$\n## Code\n\n    #include <bits/stdc++.h>\n    const int N = 20;\n    #define LL long long\n    int n, m, mp[N][N], c[N], len;\n    LL res, f[N][N];\n    std::vector<int> G[N];\n    void Dfs(int u, int fa)\n    {\n        for(int i=1;i<=len;i++) f[u][c[i]] = 1;\n        for(int i=0;i<G[u].size();i++)\n        {\n            int v = G[u][i];\n            if(v == fa) continue;\n            Dfs(v, u);\n            for(int j=1;j<=len;j++)\n            {\n                LL now = 0;\n                for(int k=1;k<=len;k++)\n                {\n                    if(mp[c[j]][c[k]]) now += f[v][c[k]];\n                }\n                f[u][c[j]] *= now;\n            }\t\n        }\n    }\n    int main()\n    {\n        scanf(\"%d%d\", &n, &m);\n        for(int i=1;i<=m;i++)\n        {\n            int u, v;\n            scanf(\"%d%d\", &u, &v);\n            mp[u][v] = mp[v][u] = 1;\n        }\n        for(int i=1;i<n;i++)\n        {\n            int u, v;\n            scanf(\"%d%d\", &u, &v);\n            G[u].push_back(v); G[v].push_back(u);\n        }\n        for(int S=1;S<(1<<n);S++)\n        {\n            memset(f, 0, sizeof(f));\n            len = 0; int cnt = 0;\n            for(int i=0;i<n;i++)\n            {\n                if(S >> i & 1) c[++len] = i + 1, cnt ++;\n            }\n            Dfs(1, 0);\n            LL t;\n            if((n - cnt) & 1) t = -1;\n            else t = 1;\n            for(int i=1;i<=len;i++) res += t * f[1][c[i]];\n        }\n        printf(\"%lld\", res);\n        return 0;\n    } ",
        "postTime": 1596861372,
        "uid": 93932,
        "name": "one_cell",
        "ccfLevel": 7,
        "title": "P3349 \u5c0f\u661f\u661f \u3010DP+\u5bb9\u65a5\u539f\u7406\u3011"
    },
    {
        "content": "\u6211\u4eec\u8981\u6c42\u7684\u662f\u6811\u4e2d\u70b9\u7684\u5bf9\u5e94\u7684\u96c6\u5408\u6070\u597d\u4e3an\u4e2a\u70b9\u7684\u65b9\u6848\u6570\uff0c\n\n\u5982\u679c\u8981dp\uff0c\u6211\u4eec\u5fc5\u987b\u8bb0\u5f55\u5bf9\u5e94\u7684\u96c6\u5408\uff0c\n\n\u8003\u8651x\u4ece\u513f\u5b50y\u8f6c\u79fb\u65f6\uff0c\u4e00\u4e2a\u70b9\u8981\u4e48\u5728x\u7684\u96c6\u5408\u4e2d\uff0c\u8981\u4e48\u5728y\u7684\u96c6\u5408\u4e2d\uff0c\u8981\u4e48\u4e24\u4e2a\u4e0d\u5728\uff0c\n\n\u65f6\u95f4\u662fO(3^n)\u7684\u3002\n\n\u800c\u901a\u8fc7\u5bb9\u65a5\uff0c\u53ef\u4ee5\u5c06\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u5bf9\u5e94\u96c6\u5408<=\u67d0i\u4e2a\u70b9\u7684\u65b9\u6848\u6570\uff0c\n\n\u8fd9\u6837dp\u65f6\u5c31\u53ea\u7528\u8bb0\u5f55\u5f53\u524d\u70b9\u5bf9\u5e94\u4e86\u54ea\u4e2a\u70b9\uff0c\u5c31\u662fO(2^n\\*n^3)\u3002\n\n\u600e\u4e48\u5bb9\u65a5\uff1f\n\n\u6bd4\u5982\u6211\u4eec\u4e00\u5f00\u59cb\u6c42\u51fa\u6765\u4e86<=n\u4e2a\u70b9\u7684\uff0c\u8fd9\u6837\u5927\u5c0f\u6070\u597d\u4e3an\u7684\u5df2\u7ecf\u52a0\u4e86\uff0c\n\n\u4f46\u6709\u53ef\u80fd\u5b58\u5728\u5b9e\u9645\u4e0a\u4e2a\u6570\u662f<n\u7684\uff0c\u6211\u4eec\u5c31\u628a<=n-1\u4e2a\u7684\u90fd\u51cf\u6389\uff0c\n\n\u8fd9\u6837\u628a\u6070\u597dn-1\u4e2a\u70b9\u7684\u90fd\u51cf\u4e86\uff0c\u4f46\u8fd9\u6837\u6bcf\u4e2a<=n-2\u4e2a\u7684\u5c31\u4f1a\u88ab\u51cf\u4e24\u6b21\uff0c\u591a\u51cf\u4e86\u4e00\u6b21\uff0c\u6240\u4ee5\u6211\u4eec\u518d\u52a0\u4e0a\u53bb\uff0c\n\n\u7c7b\u4f3c\u8fd9\u6837\uff0c\u76f4\u5230\u96c6\u5408\u5927\u5c0f<=1\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4e0d\u4f1a\u518d\u7b97\u91cd\u4e86\u3002\n",
        "postTime": 1489579495,
        "uid": 9168,
        "name": "kczno1",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3349 \u3010[ZJOI2016]\u5c0f\u661f\u661f\u3011"
    },
    {
        "content": "\u535a\u5ba2\u5185\u98df\u7528\u66f4\u4f73\uff1a[\u849f\u84bb\u306e\u535a\u5ba2](https://blog.csdn.net/The_OIer/article/details/100585941)\n\n\u9898\u76ee\u94fe\u63a5\uff1a[\u4f20\u9001\u95e8](https://www.luogu.org/problem/P3349)\n\n\u9898\u76ee\u5927\u610f\uff1a\n\n\u7ed9\u51fa\u4e00\u4e2a\u56fe\uff0c\u7ed9\u51fa\u4e00\u68f5\u6811\uff0c\u4f60\u9700\u8981\u628a\u6811\u4e0a\u7684\u70b9\u6620\u5c04\u5230\u56fe\u4e0a\uff0c\u4e24\u4e2a\u70b9\u4e0d\u80fd\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u70b9\u3002\n\n\u8981\u6c42\u82e5\u4e24\u4e2a\u70b9\u5728\u6811\u4e0a\u6709\u4e00\u6761\u8fb9\u8fde\u7740\uff0c\u90a3\u4e48\u6620\u5c04\u5230\u7684\u70b9\u5728\u539f\u56fe\u4e0a\u4e5f\u8981\u6709\u4e00\u6761\u8fb9\uff0c\u6c42\u65b9\u6848\u6570\u3002\n\n\u8003\u8651dp\u3002\n\n\u5982\u679c\u76f4\u63a5\u6309\u7167\u4e24\u4e2a\u70b9\u4e0d\u80fd\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u70b9\u7684\u9650\u5236\u6765\u505a\uff0c\u53d1\u73b0\u5b50\u72b6\u6001\u6bd4\u8f83\u96be\u8bbe\u8ba1\uff08$O(3^n*n)$\u73c2\u4ee5\u505a\uff0c\u4f46\u662f\u4f1a\u7206\uff09\n\n\u56e0\u6b64\u5148\u8003\u8651\u73c2\u4ee5\u6709\u4e24\u4e2a\u70b9\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u70b9\u7684\u60c5\u51b5qwq\n\n\u8bbe$dp[i][j]$\u8868\u793a\u4ee5$i$\u4e3a\u6839\uff0c\u4e14$i$\u5bf9\u5e94\u539f\u56fe\u4e2d\u7684$j$\u7684\u65b9\u6848\u6570\u3002\n\n$O(n^3)$\u8f6c\u79fb\uff1a\n\n\u521d\u59cb\u5316\uff1a$dp[x][i]=1$\uff0c\u56e0\u4e3a\u82e5$x$\u7684\u5b50\u6811\u4e2d\u53ea\u6709$x$\uff0c\u90a3\u4e48$x$\u73c2\u4ee5\u5bf9\u5e94\u5230\u539f\u56fe\u4efb\u610f\u4e00\u4e2a\u70b9\u3002\n\n\u5bf9\u4e8edfs\u904d\u5386\u5230\u7684\u8282\u70b9$x$\u548c$x$\u7684\u5b69\u5b50$v$\uff0c\u679a\u4e3e$x$\u6620\u5c04\u5230\u7684\u70b9$j$\u548c$v$\u6620\u5c04\u5230\u7684\u70b9$k$\u3002\n\n\u82e5$j$\u548c$k$\u5728\u539f\u56fe\u4e2d\u8fde\u4e86\u8fb9\uff0c\u90a3\u4e48\u628a$dp[v][k]$\u52a0\u5230$sum$\u4e2d\uff0c\u6700\u540e\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0c\u8ba9$dp[x][j]$\u4e58\u4e0a$sum$\u3002\n\n\u7136\u540e\u53d1\u73b0\u8fd9\u6837\u5b50dp\u51fa\u6765\u7684\u7ed3\u679c\u6709\u91cd\u590dqwq\uff0c\u4e24\u4e2a\u70b9\u73c2\u4ee5\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u70b9\n\n\u6bd4\u5982\u67093\u4e2a\u70b9\uff0c1\u6620\u5c04\u52302\uff0c2\u6620\u5c04\u52302\uff0c3\u6620\u5c04\u52301\u3002\n\n\u89c2\u5bdf\u53d1\u73b0\uff0c\u8fd9\u79cd\u60c5\u51b5\u5c31\u6709\u4e00\u4e2a\u70b9\uff083\uff09\u6ca1\u6709\u88ab\u6620\u5c04\u5230qwq\n\n\u6240\u4ee5\u51cf\u53bb\u8fd9\u79cd\u6709\u4e00\u4e2a\u70b9\u6ca1\u6709\u6620\u5c04\u5230\u7684\u60c5\u51b5\u5c31\u73c2\u4ee5\u4e86\u3002\n\n\u2026\u2026\n\n\u2026\u2026\u2026\u2026\n\n\u2026\u2026\u2026\u2026\u2026\u2026\n\n\u771f\u7684\u662f\u4ecb\u4e2a\u6837\u5b50\u5417\uff1f\n\n\u8003\u8651\u6709\u4e24\u4e2a\u70b9\u6ca1\u88ab\u6620\u5c04\u5230\u7684\u60c5\u51b5\uff1a\n\n\u8fd8\u662f\u4e3e3\u4e2a\u70b9\u7684\u4f8b\u5b50\uff0c1\u6620\u5c04\u52302\uff0c2\u6620\u5c04\u52302\uff0c3\u4e5f\u6620\u5c04\u52302\u3002\n\n\u53d1\u73b0\u8fd9\u6837\u57281\u6ca1\u6709\u6620\u5c04\u5230\u7684\u65f6\u5019\u4f1a\u51cf\u6389\u4e00\u6b21\uff0c3\u6ca1\u6709\u6620\u5c04\u5230\u7684\u65f6\u5019\u4e5f\u4f1a\u51cf\u6389\u4e00\u6b21\uff0c\u6240\u4ee5\u518d\u52a0\u56de\u6765\u5c31\u73c2\u4ee5\u4e86\u3002\n\n\u56e0\u6b64\u7528\u5bb9\u65a5\uff0c\u5982\u679c\u6709\u5947\u6570\u4e2a\u70b9\u6ca1\u6709\u6620\u5c04\u5230\uff0c\u5c31\u51cf\u6389\uff0c\u5076\u6570\u4e2a\u70b9\u6ca1\u6709\u6620\u5c04\u5230\u5c31\u52a0\u4e0aqwq\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(2^nn^3)$\n\n### ~~\u6bd2\u7624~~\u4ee3\u7801\n```cpp\n#include<stdio.h>\n#include<cstring>\n#include<algorithm>\n#include<vector>\n#define re register int\n#define rl register ll\nusing namespace std;\ntypedef long long ll;\nint read() {\n\tre x=0,f=1;\n\tchar ch=getchar();\n\twhile(ch<'0' || ch>'9') {\n\t\tif(ch=='-')\tf=-1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0' && ch<='9') {\n\t\tx=(x<<1)+(x<<3)+ch-'0';\n\t\tch=getchar();\n\t}\n\treturn x*f;\n}\ninline void write(const int x) {\n\tif(x>9)\twrite(x/10);\n\tputchar(x%10+'0');\n}\nconst int Size=18;\nconst int MaxE=145;\nint n,m,cnt,head[Size];\nstruct Edge {\n\tint v,next;\n} w[MaxE<<1];\nvoid AddEdge(int u,int v) {\n\tw[++cnt].v=v;\n\tw[cnt].next=head[u];\n\thead[u]=cnt;\n}\nbool G[Size][Size],del[Size];\nll dp[Size][Size];\t\t//\u4ee5i\u4e3a\u6839\uff0c\u4e14i\u5bf9\u5e94\u539f\u56fe\u4e2d\u7684j\u53f7\u70b9\u7684\u65b9\u6848\u6570 \nvoid dfs(int x,int fa) {\n\tfor(re i=1; i<=n; i++) {\n\t\tdp[x][i]=1;\n\t}\n\tfor(int i=head[x]; i; i=w[i].next) {\n\t\tint nxt=w[i].v;\n\t\tif(nxt!=fa) {\n\t\t\tdfs(nxt,x);\n\t\t\tfor(re j=1; j<=n; j++) {\n\t\t\t\tif(del[j])\tcontinue;\n\t\t\t\tll sum=0;\n\t\t\t\tfor(re k=1; k<=n; k++) {\n\t\t\t\t\tif(del[k] || !G[j][k])\tcontinue;\n\t\t\t\t\tsum+=dp[nxt][k];\n\t\t\t\t}\n\t\t\t\tdp[x][j]*=sum;\n\t\t\t}\n\t\t}\n\t}\n}\ninline void oper(re x) {\n\tmemset(del,0,sizeof(del));\n\tre cnt=1;\n\twhile(x) {\n\t\tif(x&1)\tdel[cnt]=true;\n\t\tx>>=1;\n\t\tcnt++;\n\t}\n}\nint main() {\n\tn=read();\n\tm=read();\n\tfor(re i=1; i<=m; i++) {\n\t\tint u=read();\n\t\tint v=read();\n\t\tG[u][v]=G[v][u]=true;\n\t}\n\tfor(re i=1; i<n; i++) {\n\t\tint u=read();\n\t\tint v=read();\n\t\tAddEdge(u,v);\n\t\tAddEdge(v,u);\n\t}\n\tll ans=0;\n\tfor(re i=0; i<(1<<n); i++) {\n\t\toper(i);\n\t\tdfs(1,0);\n\t\tll sum=0;\n\t\tfor(re j=1; j<=n; j++) {\n\t\t\tsum+=dp[1][j];\n\t\t}\n\t\tif(__builtin_popcount(i)&1) {\n\t\t\tans-=sum;\n\t\t} else {\n\t\t\tans+=sum;\n\t\t}\n\t}\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1567773965,
        "uid": 45108,
        "name": "Peter_Z",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3349 \u3010[ZJOI2016]\u5c0f\u661f\u661f\u3011"
    },
    {
        "content": "[\u539f\u9898\u4f20\u9001\u95e8](https://www.luogu.org/problem/P3349)\n\n[\u66f4\u597d\u7684\u9605\u8bfb](https://www.cnblogs.com/yzhang-rp-inf/p/11262435.html)\n\n\u6211\u4eec\u8003\u8651\u8bbe$dp_{i,j}$\u8868\u793a\u6811\u4e0a\u7684\u70b9$i$\u5728\u56fe\u4e0a\u5bf9\u5e94\u7684\u70b9\u4e3a$j$\u65f6$i$\u548c\u5b50\u6811\u5bf9\u5e94\u5728\u56fe\u4e0a\u7684\u65b9\u6848\u6570\n\n$dp_{u_i}=\\prod_{v \\in u.son} dp_{v,j}*w[i][j]$\uff08w[i][j]\u8868\u793a\u5728\u56fe\u4e2d$i$\u548c$j$\u662f\u5426\u8fde\u901a\uff09\n\n\u8fd9\u4e2adp\u7684\u590d\u6742\u5ea6\u662f$O(n^3)$\uff0c\u4f46\u662f\u4f1a\u53d1\u73b0\u5b83\u4f1a\u591a\u7b97\u7b54\u6848\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u7b97\u6cd5\u6709\u53ef\u80fd\u4f1a\u5c06\u591a\u4e2a\u6811\u4e0a\u7684\u70b9\u5bf9\u5e94\u5230\u4e00\u4e2a\u56fe\u4e0a\u7684\u70b9\n\n\u6211\u4eec\u73c2\u4ee5\u4e8c\u8fdb\u5236\u679a\u4e3e\uff0c\u679a\u4e3e\u54ea\u4e9b\u56fe\u4e0a\u7684\u70b9\u53c2\u4e0edp\uff0c\u6309\u7167\u5bb9\u65a5\u539f\u7406\u52a0\u51cf\uff0c\u8fd9\u6837\u5c31\u73c2\u4ee5\u7b97\u51fa\u7b54\u6848\uff0c\u590d\u6742\u5ea6\u4e3a$O(2^n n^3)$\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\n#define N 20\n#define getchar nc\nusing namespace std;\ninline char nc(){\n    static char buf[100000],*p1=buf,*p2=buf;\n    return p1==p2&&(p2=(p1=buf)+fread(buf,1,100000,stdin),p1==p2)?EOF:*p1++;\n}\ninline int read()\n{\n    register int x=0,f=1;register char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9')x=(x<<3)+(x<<1)+ch-'0',ch=getchar();\n    return x*f;\n}\ninline void write(register ll x)\n{\n    if(!x)putchar('0');if(x<0)x=-x,putchar('-');\n    static int sta[20];register int tot=0;\n    while(x)sta[tot++]=x%10,x/=10;\n    while(tot)putchar(sta[--tot]+48);\n}\nstruct edge{\n    int to,next;\n}e[N<<1];\nint head[N],cnt=0;\ninline void add(register int u,register int v)\n{\n    e[++cnt]=(edge){v,head[u]};\n    head[u]=cnt;\n}\nint n,m,w[N][N],ban[N],vis[N];\nll f[N][N],ans;\ninline void dfs(register int x)\n{\n    vis[x]=1;\n    for(register int i=1;i<=n;++i)\n        f[x][i]=1;\n    for(register int i=head[x];i;i=e[i].next)\n    {\n        int v=e[i].to;\n        if(vis[v])\n            continue;\n        dfs(v);\n        for(register int j=1;j<=n;++j)\n        {\n            ll sum=0;\n            for(register int k=1;k<=n;++k)\n                sum+=f[v][k]*(w[k][j]&ban[k]&ban[j]);\n            f[x][j]*=sum;\n        }\n    }\n}\nint main()\n{\n    n=read(),m=read();\n    for(register int i=1;i<=m;++i)\n    {\n        int u=read(),v=read();\n        w[u][v]=w[v][u]=1;\n    }\n    for(register int i=1;i<n;++i)\n    {\n        int u=read(),v=read();\n        add(u,v),add(v,u);\n    }\n    for(register int k=1,siz;k<=(1<<n)-1;++k)\n    {\n        siz=n;\n        for(register int i=1;i<=n;++i)\n            ban[i]=0;\n        for(register int i=1,p=k;p;p>>=1,++i)\n            ban[i]=p&1,siz-=p&1;\n        for(register int i=1;i<=n;++i)\n            vis[i]=0;\n        dfs(1);\n        ll cnt=0;\n        for(register int i=1;i<=n;++i)\n            cnt+=f[1][i];\n        if(siz%2)\n            ans-=cnt;\n        else\n            ans+=cnt;\n    }\n    write(ans);\n\treturn 0;\n}\n```",
        "postTime": 1564367130,
        "uid": 37881,
        "name": "yzhang",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3349 \u3010[ZJOI2016]\u5c0f\u661f\u661f\u3011"
    },
    {
        "content": "# \u9898\u89e3\n## \u8bbe\u8ba1 DP\n\u770b\u5230\u6570\u636e\u8303\u56f4\u8fd8\u6709\u9898\u76ee\u91cc\u9762\u7384\u5b66\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u53ef\u4ee5\u60f3\u5230\u72b6\u538b\uff0c\u7528\u4e00\u7ef4\u8868\u793a\u5df2\u88ab\u5bf9\u5e94\u7684\u8282\u70b9\u72b6\u6001\u3002\n\n\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8f6c\u79fb\u7684\u7236\u5b50\u70b9\u5bf9 $u,v$\uff0c\u7531\u4e8e\u8f6c\u79fb\u7684\u6761\u4ef6\u5c31\u662f\u6709\u8fde\u8fb9\uff0c\u6240\u4ee5 $u,v$ \u5bf9\u5e94\u7684\u70b9\u5728\u539f\u56fe\u4e2d\u4e00\u5b9a\u6709\u8fde\u8fb9\uff0c\u8f6c\u79fb\u7684\u65f6\u5019\u628a $u$ \u5f53\u524d\u5b50\u6811\u548c $v$ \u5b50\u6811\u7684\u72b6\u6001\u5408\u5e76\uff08\u4e5f\u5c31\u662f\u903b\u8f91\u6216\uff09\uff0c\u5c31\u53ef\u4ee5\u987a\u5229\u8f6c\u79fb\u3002\n\n\u56e0\u6b64\uff0c\u8bbe\u8ba1 $dp(u,stat,p)$ \u8868\u793a $u$ \u8282\u70b9\u5bf9\u5e94\u7684\u8282\u70b9\u662f $p$\uff0c$u$ \u5b50\u6811\u5185\u5bf9\u5e94\u72b6\u6001\u4e3a $stat$\u3002\n\n## \u4f18\u5316 DP\n\n\u53ef\u4ee5\u7528**\u5bb9\u65a5**\u4f18\u5316\uff0c\u4f46\u662f\u6bd4\u8f83\u96be\uff0c\u800c\u4e14\u5176\u4ed6\u9898\u89e3\u5df2\u7ecf\u5199\u7684\u5f88\u597d\u4e86\u3002\n\n\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u79cd\u4e0d\u9700\u8981\u5bb9\u65a5\u7684\u505a\u6cd5\u3002\n\n* \u6700\u7b80\u5355\u7684\u60f3\u6cd5\uff0c\u57fa\u4e8e DP \u672c\u8eab\u7684\u72b6\u6001\uff0c\u6bcf\u4e2a\u5b50\u6811\u5bf9\u5e94\u7684\u72b6\u6001\u91cc $1$ \u7684\u4e2a\u6570\u4e00\u5b9a\u7b49\u4e8e\u5b50\u6811\u5927\u5c0f\uff0c\u9884\u5904\u7406\u51fa\u6765\u53ef\u4ee5\u7701\u53bb\u5927\u91cf\u679a\u4e3e\u3002\n\n* \u5176\u6b21\uff0c\u679a\u4e3e\u5b50\u6811\u7684\u65f6\u5019\u7c7b\u6bd4\u6811\u5f62\u80cc\u5305\uff0c\u6bcf\u6b21\u8f6c\u79fb\u5b8c DP \u4e4b\u540e\u518d ``siz[u]+=siz[v]``\u3002\n\n* \u57fa\u672c\u5c31\u8fd9\u4e9b\uff0c\u8fd8\u53ef\u4ee5\u6709\u4e00\u70b9\u70b9\u65e0\u804a\u7684\u4f18\u5316\uff0c\u6bd4\u5982\u5728 DP \u503c\u4e3a $0$ \u7684\u65f6\u5019\u76f4\u63a5\u8df3\u51fa\u5faa\u73af\u3002\n\n\u5438\u6c27\u80fd\u591f\u5361\u8fc7\uff0c\u6700\u5927\u70b9\u7ea6 $850ms$\u3002\n# \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nconst int INF = 0x3f3f3f3f,N = 20;\ninline ll read()\n{\n\tll ret=0;char ch=' ',c=getchar();\n\twhile(!(c>='0'&&c<='9')) ch=c,c=getchar();\n\twhile(c>='0'&&c<='9') ret=(ret<<1)+(ret<<3)+c-'0',c=getchar();\n\treturn ch=='-'?-ret:ret;\n}\nint n,m,head[N],ecnt=-1;\nbool mp[N][N];\ninline void init_edge(){memset(head,-1,sizeof(head)),ecnt=-1;}\nstruct edge\n{\n\tint nxt,to;\t\n}a[N<<1];\ninline void add_edge(int x,int y)\n{\n\ta[++ecnt]=(edge){head[x],y};\n\thead[x]=ecnt;\n}\nll dp[N][1<<18][N],siz[N];\nint num[N][1<<18],cnt[N];\nvoid dfs(int u,int fa)\n{\n\tsiz[u]=1;\n\tfor(int i=1;i<=n;i++) dp[u][1<<(i-1)][i]=1LL;\n\t//\u521d\u59cb\u5316\uff0cu\u5bf9\u5e94\u4efb\u4f55\u4e00\u4e2a\u70b9\u65b9\u6848\u90fd\u4e3a1\n\tfor(int i=head[u];~i;i=a[i].nxt)\n\t{\n\t\tint v=a[i].to;\n\t\tif(v==fa) continue; \n\t\tdfs(v,u);\n\t\tfor(int j=1;j<=cnt[siz[u]];j++)\t\n\t\t\tfor(int k=1;k<=cnt[siz[v]];k++)\n\t\t\t{\n\t\t\t\tint stat1=num[siz[u]][j];\n\t\t\t\tint stat2=num[siz[v]][k];\n\t\t\t\tif(stat1&stat2) continue;\n\t\t\t\tfor(int p=1;p<=n;p++)\n\t\t\t\t\tif((1<<(p-1))&stat2)\n\t\t\t\t\t{\n\t\t\t\t\t\tif(!dp[v][stat2][p]) continue;\n\t\t\t\t\t\tfor(int q=1;q<=n;q++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(mp[q][p]&& ((1<<(q-1))&stat1) )\n\t\t\t\t\t\t\tdp[u][stat1|stat2][q]+=dp[u][stat1][q]*dp[v][stat2][p];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\tsiz[u]+=siz[v];\n\t}\n}\nint main()\n{\n\tinit_edge();\n\tn=read(),m=read();\n\tfor(int i=1;i<=m;i++)\t\n\t{\n\t\tint u=read(),v=read();\n\t\tmp[u][v]=mp[v][u]=1;\n\t}\n\tfor(int i=1;i<n;i++)\t\n\t{\n\t\tint u=read(),v=read();\n\t\tadd_edge(u,v),add_edge(v,u);\n\t}\n\tfor(int i=0;i<1<<n;i++)\t\n\t{\n\t\tint tcnt=0;\n\t\tfor(int j=1;j<=n;j++)\t\n\t\t\tif((1<<(j-1))&i) tcnt++;\n\t\tnum[tcnt][++cnt[tcnt]]=i;\n\t}\n\tdfs(1,-1);\n\tll ans=0ll;\n\tfor(int i=1;i<=n;i++)\t\t\n\t\tans+=dp[1][(1<<n)-1][i];\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1635594883,
        "uid": 234783,
        "name": "conprour",
        "ccfLevel": 6,
        "title": "P3349 [ZJOI2016]\u5c0f\u661f\u661f"
    },
    {
        "content": "## \u9898\u610f\u7b80\u8ff0\n\n\u7ed9\u5b9a\u4e00\u4e2a $n$ \u4e2a\u70b9\uff0c$m$ \u6761\u8fb9\u7684\u65e0\u5411\u56fe $G$ \u548c\u4e00\u68f5 $n$ \u4e2a\u70b9\u7684\u6811 $T$\uff0c\u6c42\u6709\u591a\u5c11\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217 $p$\uff0c\u4f7f\u5f97 $\\forall (u,v) \\in T$\uff0c$(p_u,p_v) \\in G$\u3002\n\n**\u6570\u636e\u8303\u56f4**\uff1a$1 \\le n \\le 17$\uff0c$0 \\le m \\le \\dfrac{n(n-1)}{2}$\u3002\n\n## \u9898\u89e3\n\n### \u72b6\u538b DP\n\n\u770b\u5230 $n \\le 17$\uff0c\u5bb9\u6613\u60f3\u5230**\u72b6\u538b DP**\u3002\n\n\u8bbe $f(x,k,S)$ \u8868\u793a $p_x=k$ \u4e14 $\\{p_y \\mid y \\in sub_x \\}=S$ \u7684\u65b9\u6848\u6570\uff0c\u5176\u4e2d $sub_x$ \u8868\u793a $x$ \u7684\u5b50\u6811\u3002\uff08\u8bf4\u4eba\u8bdd\uff1a$p_x$ \u4e3a $k$ \u4e14 $x$ \u5b50\u6811\u4e2d\u7684\u70b9\u5bf9\u5e94\u7684 $p$ \u7ec4\u6210\u96c6\u5408 $S$\uff09\n\n$k$ \u7528\u4e8e\u5224\u65ad $x$ \u548c\u5b83\u7684\u7236\u4eb2\u3001\u513f\u5b50\u4e4b\u95f4\u7684\u8fb9\u662f\u5426\u6ee1\u8db3\u9898\u610f\uff0c$S$ \u7528\u4e8e\u4fdd\u8bc1 $p$ \u4e2d $1,2,\\cdots,n$ \u6bcf\u4e2a\u6570\u53ea\u51fa\u73b0\u81f3\u591a\u4e00\u6b21\u3002\n\n\u7b54\u6848\u5373\u4e3a $\\sum_{k=1}^{n}f(\\mathit{root},k,\\{1,2,\\cdots,n\\})$\uff0c\u5176\u4e2d $\\mathit{root}$ \u8868\u793a\u6811\u6839\u3002\n\n\u6b64\u7b97\u6cd5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^3 3^n)$\uff0c\u663e\u7136\u65e0\u6cd5\u901a\u8fc7\u6b64\u9898\u3002\n\n\u8003\u8651\u628a $S$ \u8fd9\u4e00\u7ef4\u53bb\u6389\u3002\u7531\u4e8e\u6b64\u65f6\u6c42\u5f97\u7684 $f$ \u4e2d\u5305\u542b $p$ \u4e2d\u591a\u6b21\u51fa\u73b0\u540c\u4e00\u4e2a\u6570\u7684\u60c5\u51b5\uff0c\u4e8e\u662f\u4f7f\u7528**\u5b50\u96c6\u53cd\u6f14**\u3002\n\n### \u5b50\u96c6\u53cd\u6f14\n\n\u8bbe $F(S)$ \u8868\u793a $p$ \u4e2d\u53ea\u51fa\u73b0 $S$ \u96c6\u5408\u4e2d\u7684\u6570\u7684\u65b9\u6848\u6570\uff08\u81f3\u591a\uff09\uff0c$G(S)$ \u8868\u793a $p$ \u4e2d\u53ea\u51fa\u73b0 $S$ \u96c6\u5408\u4e2d\u7684\u6570\u4e14 $S$ \u96c6\u5408\u4e2d\u7684\u6570\u5747\u51fa\u73b0\u7684\u65b9\u6848\u6570\uff08\u6070\u597d\uff09\uff0c\u5219\u6709\uff1a\n\n$$F(S)=\\sum_{T \\subset S}G(T)$$\n\n\u5217\u51fa**\u521d\u59cb\u6052\u7b49\u5f0f**\uff08\u8fd9\u662f\u53cd\u6f14\u7684\u5957\u8def\uff09\uff1a\n\n$$G(S)=\\sum_{T \\subset S}G(T)[S=T]$$\n\n\u7531\u975e\u7a7a\u96c6\u5408\u7684\u5947\u5b50\u96c6\u548c\u5076\u5b50\u96c6\u4e2a\u6570\u76f8\u7b49\uff08\u7a7a\u96c6\u53ea\u6709\u4e00\u4e2a\u5076\u5b50\u96c6\uff09\u53ef\u77e5\uff1a\n\n$$\\sum_{T \\subset S}(-1)^{|T|}=[S=\\varnothing]$$\n\n\u5c06\u5176\u4ee3\u5165\u524d\u8ff0\u5f0f\u5b50\uff08$S=T$ \u7b49\u4ef7\u4e8e $S \\setminus T=\\varnothing$\uff09\uff1a\n\n$$G(S)=\\sum_{T \\subset S}G(T)\\sum_{R \\subset S \\setminus T}(-1)^{|R|}$$\n\n\u4ea4\u6362\u6c42\u548c\u7b26\u53f7\u5e76\u4ee3\u5165 $F$ \u7684\u5b9a\u4e49\u5f0f\uff1a\n\n$$G(S)=\\sum_{R \\subset S }(-1)^{|R|}\\sum_{T \\subset S \\setminus R}G(T)=\\sum_{R \\subset S }(-1)^{|R|}F(S \\setminus R)$$\n\n\u6362\u5143\uff0c\u5373\uff1a\n\n$$G(S)=\\sum_{T \\subset S}(-1)^{|S|-|T|}F(T)$$\n\nP.S. \u8bf7\u6ce8\u610f\u5b50\u96c6\u53cd\u6f14\u4e0e\u4e8c\u9879\u5f0f\u53cd\u6f14\u7684\u533a\u522b\uff1a\u5b50\u96c6\u53cd\u6f14\u7684\u51fd\u6570\u81ea\u53d8\u91cf\u662f\u96c6\u5408\uff1b**\u4e8c\u9879\u5f0f\u53cd\u6f14**\u7684\u51fd\u6570\u81ea\u53d8\u91cf\u662f\u975e\u8d1f\u6574\u6570\uff0c\u5373**\u5355\u4e2a\u56e0\u53d8\u91cf\u5305\u542b\u4e86\u67d0\u4e00\u56fa\u5b9a\u5927\u5c0f\u7684\u5b50\u96c6\u7684\u6240\u6709\u60c5\u51b5\uff0c\u56e0\u6b64\u8981\u4e58\u4e0a\u4e8c\u9879\u5f0f\u7cfb\u6570**\u3002\n\n------------\n\n\u5bf9\u4e8e\u56fa\u5b9a\u7684 $S$\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u524d\u8ff0\u6811\u5f62 DP \uff08\u53bb\u6389\u96c6\u5408\u90a3\u4e00\u7ef4\uff09\u5728 $O(n^3)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u8ba1\u7b97 $F(S)$\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5728 $O(2^n n^3)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u8ba1\u7b97\u672c\u9898\u7b54\u6848\uff0c\u5373 $G(\\{1,2,\\cdots,n\\})$\u3002\n\n\u6ce8\u610f\uff1a\u672c\u9898\u7684\u7b54\u6848\u663e\u7136\u4e0d\u4f1a\u8d85\u8fc7 $17! < 4 \\times 10^{14}$\uff0c\u4f46 $F$ \u7684\u6700\u5927\u503c\u53ef\u8fbe $17^{17} > 8 \\times 10^{20}$\uff0c\u4e8e\u662f\u5e94\u4f7f\u7528 `unsigned long long` \u5b58\u50a8\u8ba1\u7b97\u4e2d\u7684\u503c\u3002\uff08\u56e0\u4e3a\u7b54\u6848 $\\in [0,2^{64}-1]$\uff0c\u800c\u4f7f\u7528 `unsigned long long` \u76f8\u5f53\u4e8e\u6a21 $2^{64}$\uff09\n\n## \u4ee3\u7801\n\n``` cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int max_n=17+5;\nint End[max_n<<1],Last[max_n],Next[max_n<<1],e;\ninline void add_edge(int x,int y)\n{\n\tEnd[++e]=y,Next[e]=Last[x],Last[x]=e;\n\tEnd[++e]=x,Next[e]=Last[y],Last[y]=e;\n}\nconst int max_m=17*8+5;\nint End1[max_m<<1],Last1[max_n],Next1[max_m<<1],e1;\ninline void add_edge1(int x,int y)\n{\n\tEnd1[++e1]=y,Next1[e1]=Last1[x],Last1[x]=e1;\n\tEnd1[++e1]=x,Next1[e1]=Last1[y],Last1[y]=e1;\n}\nbool Map[max_n][max_n];\nint S[max_n],tot;\nunsigned long long dp[max_n][max_n];\nvoid dfs(int x,int fa)\n{\n\tfor(int i=1;i<=tot;++i)\n\t\tdp[x][i]=1;\n\tfor(int i=Last[x];i;i=Next[i])\n\t{\n\t\tint y=End[i];\n\t\tif(y!=fa)\n\t\t{\n\t\t\tdfs(y,x);\n\t\t\tfor(int j=1;j<=tot;++j)\n\t\t\t{\n\t\t\t\tunsigned long long sum=0;\n\t\t\t\tfor(int k=Last1[j];k;k=Next1[k])\n\t\t\t\t\tsum+=dp[y][End1[k]];\n\t\t\t\tdp[x][j]*=sum;\n\t\t\t}\n\t\t}\n\t}\n}\nint main()\n{\n\tint n,m;\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=m;++i)\n\t{\n\t\tint u,v;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tMap[u][v]=Map[v][u]=true;\n\t}\n\tfor(int i=1;i<=n-1;++i)\n\t{\n\t\tint u,v;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tadd_edge(u,v);\n\t}\n\tint mx=(1<<n)-1;\n\tunsigned long long ans=0;\n\tfor(int s=1;s<=mx;++s)\n\t{\n\t\ttot=0;\n\t\tfor(int i=0;i<n;++i)\n\t\t{\n\t\t\tif(s>>i&1)\n\t\t\t\tS[++tot]=i+1;\n\t\t}\n\t\te1=0;\n\t\tfor(int i=1;i<=tot;++i)\n\t\t\tLast1[i]=0;\n\t\tfor(int i=1;i<=tot;++i)\n\t\t\tfor(int j=i+1;j<=tot;++j)\n\t\t\t{\n\t\t\t\tif(Map[S[i]][S[j]])\n\t\t\t\t\tadd_edge1(i,j);\n\t\t\t}\n\t\tdfs(1,0);\n\t\tunsigned long long sum=0;\n\t\tfor(int i=1;i<=tot;++i)\n\t\t\tsum+=dp[1][i];\n\t\tif((n^tot)&1)\n\t\t\tans-=sum;\n\t\telse\n\t\t\tans+=sum;\n\t}\n\tprintf(\"%llu\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1630054599,
        "uid": 145355,
        "name": "wsyhb",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011\u6d1b\u8c37 P3349 [ZJOI2016]\u5c0f\u661f\u661f"
    },
    {
        "content": "## \u9898\u76ee\n[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P3349)\n\n## \u5206\u6790\n\u9996\u5148\u8003\u8651\u6734\u7d20\u72b6\u538b\u3002\u6211\u4eec\u8981\u6c42\u7684\u7b54\u6848\u662f\u8fd9\u68f5\u6811\u6709\u591a\u5c11\u4e2d\u5728\u56fe\u4e0a\u7684\u8282\u70b9\u6807\u53f7\u6620\u5c04\u65b9\u6848\uff0c\u6240\u4ee5\u6211\u4eec\u8bbe $f[i][j][S]$ \u8868\u793a\u5c06 $i$ \u8282\u70b9\u6620\u5c04\u4e3a $j$ \u8282\u70b9\uff0c\u5176\u5b50\u6811\u5185\u7684\u70b9\u4f7f\u7528\u7684\u6620\u5c04\u96c6\u5408\u4e3a $S$ \u7684\u65b9\u6848\u6570\uff0c\u7b54\u6848\u663e\u7136\u5c31\u662f $\\sum^{n}_{i=1}f[1][i][U]$ \uff0c\u8868\u793a $1$ \u6620\u5c04\u4e3a $i$ \uff0c\u4e14\u5b50\u6811\u6620\u5c04\u4e3a\u5168\u96c6\u7684\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u7684\u65f6\u5019\u6ce8\u610f\u4e00\u4e0b\u5305\u542b\u4e0e\u4e0d\u5305\u542b\u5173\u7cfb\u7684\u5224\u65ad\u5c31\u884c\u4e86\u3002\n\n## Code 20pts\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int L = 1 << 20;\nchar buffer[L],*S,*T;\n#define gc (S == T && (T = (S = buffer) + fread(buffer,1,L,stdin),S == T) ? EOF : *S++)\ninline int read(){\n\tint s = 0,f = 1;char ch = gc;\n\tfor(;!isdigit(ch);ch = gc)if(ch == '-')f = -1;\n\tfor(;isdigit(ch);ch = gc)s = s * 10 + ch - '0';\n\treturn s * f;\n}\n#define rint register int\n#define rll register long long\n#define ll long long\nconst int maxn = 18;\nll ans,f[maxn][maxn][1<<maxn];\nstruct Node{\n\tint v,next;\n}e[maxn<<2];\nvector<int>g[maxn],vec[maxn];\nint head[maxn],tot;\nint n,m;\nint siz[maxn];\ninline void Add(rint x,rint y){\n\te[++tot].v = y;\n\te[tot].next = head[x];\n\thead[x] = tot;\n}\ninline void dfs(rint x,rint fa){\n\tsiz[x] = 1;\n\tfor(rint i = 1;i <= n;++i)f[x][i][1<<(i-1)] = 1;\n\tfor(rint i = head[x];i;i = e[i].next){\n\t\trint v = e[i].v;\n\t\tif(v == fa)continue;\n\t\tdfs(v,x);\n\t\tfor(rint id = 1;id <= n;++id){//\u679a\u4e3e\u5f53\u524d\u70b9\u6620\u5c04\u4e3a\u54ea\u4e2a\u6807\u53f7\n\t\t\trint size = g[siz[x]].size();\n\t\t\tfor(rint j = 0;j < size;++j){//\u679a\u4e3e\u5f53\u524d\u5927\u5c0f\u7684\u6240\u6709\u72b6\u6001\n\t\t\t\trint S = g[siz[x]][j];\n\t\t\t\tif(!(S & (1 << (id - 1))))continue;//\u5982\u679c\u8be5\u72b6\u6001\u4e0d\u5305\u62ec\u6620\u5c04\u7684\u6807\u53f7\u5c31\u76f4\u63a5\u4e0d\u7ba1\n\t\t\t\trint siz2 = vec[id].size();\n\t\t\t\tfor(rint l = 0;l < siz2;++l){//\u627e\u5f53\u524d\u6620\u5c04\u7684\u6807\u53f7\u8fde\u7684\u8fb9\n\t\t\t\t\trint idx = vec[id][l];\n\t\t\t\t\tif(S & (1 << (idx - 1)))continue;//\u5982\u679c\u8be5\u72b6\u6001\u5305\u542b\u4e86\u5b50\u6811\u4e2d\u7684\u8fb9\u5c31\u4e0d\u9009\u3002\n\t\t\t\t\trint siz3 = g[siz[v]].size();\n\t\t\t\t\tfor(rint k = 0;k < siz3;++k){//\u679a\u4e3e\u5927\u5c0f\u4e3a\u5b50\u6811\u5927\u5c0f\u7684\u6240\u6709\u72b6\u6001\n\t\t\t\t\t\trint T = g[siz[v]][k];\n\t\t\t\t\t\tif(S & T || !(T & (1 << (idx - 1))))continue;//\u5f53\u524d\u96c6\u5408\u548c\u5b50\u6811\u96c6\u5408\u7684\u72b6\u6001\u4e0d\u80fd\u6709\u4ea4\uff0c\u4e0d\u7136\u53ef\u80fd\u7b97\u91cd\uff0c\u4e14\u5b50\u6811\u96c6\u5408\u8981\u5305\u542b\u5b50\u6811\u6240\u679a\u4e3e\u7684\u90a3\u4e2a\u6620\u5c04\n\t\t\t\t\t\tf[x][id][S | T] += f[x][id][S] * f[v][idx][T];//\u4e58\u6cd5\u539f\u7406\u8ba1\u7b97\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsiz[x] += siz[v];\n\t}\n}\nint main(){\n\tn = read(),m = read();\n\tfor(rint i = 1;i <= m;++i){\n\t\trint x = read(),y = read();\n\t\tvec[x].push_back(y);\n\t\tvec[y].push_back(x);\n\t}\n\tfor(rint i = 1;i < n;++i){\n\t\trint x = read(),y = read();\n\t\tAdd(x,y);\n\t\tAdd(y,x);\n\t}\n\trint mx = (1 << n) - 1;\n\tfor(rint i = 0;i <= mx;++i){\n\t\trint cnt = 0;\n\t\tfor(rint j = 0;j < n;++j){\n\t\t\tif(i & (1 << j))cnt++;\n\t\t}\n\t\tg[cnt].push_back(i);//\u8ba1\u7b97\u6bcf\u4e2a\u4e2a\u6570\u4e0b\u90fd\u6709\u54ea\u4e9b\u72b6\u6001\u3002\n\t}\n\tdfs(1,0);\n\tfor(rint i = 1;i <= n;++i){\n\t\tans += f[1][i][mx];\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n\u663e\u7136\u8fd9\u4e2a\u66b4\u529b\u4e0d\u53ef\u7528 ~~(\u56e0\u4e3a\u6570\u7ec4\u5f00\u592a\u5927MLE\u4e86)~~ \uff0c\u5f00\u5c0f\u70b9\u5e94\u8be5\u8fd8\u80fd\u8fc7\u4e00\u4e9b\u70b9\u3002\n## Continue\n\u6211\u4eec\u7ee7\u7eed\u8003\u8651\u5bf9\u8fd9\u4e2a\u66b4\u529b\u72b6\u538b\u8fdb\u884c\u4f18\u5316\u3002\u672c\u9898\u7684\u5173\u952e\u70b9\u5c31\u5728\u4e8e\u8981\u6c42\u6620\u5c04\u96c6\u5408\u4e0d\u80fd\u6709\u91cd\u590d\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u76f4\u63a5\u53bb\u9664\u8fd9\u4e2a\u9650\u5236\u3002\u94a6\u5b9a\u6709\u4e14\u4ec5\u6709\u96c6\u5408 $S$ \u80fd\u591f\u51fa\u73b0\u5728\u6620\u5c04\u4e2d\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8bbe $f(S)$ \u4e3a\u6240\u6709\u70b9\u6620\u5c04\u6070\u597d\u662f\u96c6\u5408 $S$ \u7684\u60c5\u51b5\u3002$g(S)$ \u4e3a\u6240\u6709\u70b9\u6620\u5c04\u6700\u591a\u4e3a $S$ \u7684\u60c5\u51b5\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u5f0f\u5b50\uff1a\n$$g(S) = \\sum_{T\\subseteq S}f(T)$$\n\u8bc1\u660e\uff1a\u663e\u7136\u3002$T$ \u662f $S$ \u7684\u5b50\u96c6\uff0c\u6240\u4ee5 $g(S)$ \u4e3a $S$ \u96c6\u5408\u4f7f\u7528\u4e0d\u4e00\u5b9a\u5168\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u5c31\u7b49\u4e8e\u6240\u6709\u5b50\u96c6\u4f7f\u7528\u5b8c\u5168\u7684\u60c5\u51b5\u6c42\u548c\u3002\n\n\u7136\u540e\u5229\u7528\u5b50\u96c6\u53cd\u6f14\uff0c\u5f97\u5230\uff1a\n$$f(S)=\\sum_{T\\subseteq S}(-1)^{|S|-|T|}\\times g(T)$$\n\n\u7b54\u6848\u5c31\u662f $f(\u5168\u96c6)$ \u3002\n\n\u7136\u540e\u6211\u4eec\u5bf9\u4e0a\u8fb9\u7684\u72b6\u538b\u8fdb\u884c\u4fee\u6539\uff0c\u7528\u4e8e\u6c42\u51fa $g(S)$ \uff0c\u91cd\u65b0\u5b9a\u4e49 $f[i][j][S]$ \u4e3a $i$ \u6620\u5c04\u4e3a $j$ \uff0c\u4f7f\u7528\u96c6\u5408\u6700\u5927\u4e3a $S$ \u7684\u65b9\u6848\uff0c\u5176\u8f6c\u79fb\u5c31\u53ef\u4ee5\u8fd9\u6837\uff1a\n$$f[x][j][S]=\\prod _{v\\subseteq \\{son\\{x\\}\\}} (\\sum_{T\\subseteq S ,(x,v)\\subseteq E}f[v][T][S])$$\n\n\u6700\u7ec8\u5f97\u5230\n$$g(S)=\\sum _{j\\subseteq S} f[1][j][S]$$\n\n\u5728\u8fd9\u91cc\u7531\u4e8e\u72b6\u6001\u4e0d\u4f1a\u778e\u53d8\uff0c\u6240\u4ee5\u6211\u4eec\u6539\u4e3a\u679a\u4e3e\u6240\u6709\u72b6\u6001\uff0c\u7136\u540e\u628a\u7b2c\u4e09\u7ef4\u538b\u6389\u5c31\u884c\u4e86\u3002\n\n\u7136\u540e\u5f00\u59cb\u4e71\u4e03\u516b\u7cdf\u6839\u636e\u4e00\u5806\u5f0f\u5b50\u6c42\u4e2a\u548c\u5c31\u884c\u4e86\u3002\u4ee3\u7801\u5361\u5361\u5e38\uff0c\u8dd1\u8fc7\u6beb\u65e0\u538b\u529b\u3002\n\n## Code\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int L = 1 << 20;\nchar buffer[L],*S,*T;\n#define gc (S == T && (T = (S = buffer) + fread(buffer,1,L,stdin),S == T) ? EOF : *S++)\n#define rint register int\n#define rll register long long\n#define reg register\n#define ll long long\n#define read() ({\\\n\trint s = 0,f = 1;reg char ch = gc;\\\n\tfor(;!isdigit(ch);ch = gc)if(ch == '-')f = -1;\\\n\tfor(;isdigit(ch);ch = gc)s = s * 10 + ch - '0';\\\n\ts * f;\\\n})\nconst int maxn = 18;\nll ans,f[maxn][maxn];//\u538b\u6389\u72b6\u6001\u90a3\u4e00\u7ef4\uff0c\u56e0\u4e3a\u679a\u4e3e\u72b6\u6001\u5373\u53ef\u3002\nstruct Node{\n\tint v,next;\n}e[maxn<<2];\nint head[maxn],tot;\nint n,m;\nint vec[maxn][maxn];\nint jl[maxn],cnt[1<<maxn];\ninline void Add(rint x,rint y){\n\te[++tot].v = y;\n\te[tot].next = head[x];\n\thead[x] = tot;\n}\ninline void dfs(rint x,rint fa){\n\tfor(rint i = 1;i <= jl[0];++i)f[x][jl[i]] = 1;//\u521d\u59cb\u5316\n\tfor(rint i = head[x];i;i = e[i].next){\n\t\trint v = e[i].v;\n\t\tif(v == fa)continue;\n\t\tdfs(v,x);//\u9012\u5f52\u56de\u6eaf\n\t\tfor(rint j = 1;j <= jl[0];++j){//\u679a\u4e3e\u96c6\u5408\u5143\u7d20\n\t\t\trll tmp = 0;\n\t\t\tfor(rint k = 1;k <= jl[0];++k){//\u540c\u4e0a\n\t\t\t\tif(vec[jl[j]][jl[k]])tmp += f[v][jl[k]];//\u4e24\u70b9\u4e4b\u95f4\u6709\u8fb9\u5c31\u52a0\u4e0a\u8d21\u732e\n\t\t\t}\n\t\t\tf[x][jl[j]] *= tmp;//\u4e58\u6cd5\u539f\u7406\u8ba1\u7b97\u603b\u8d21\u732e\n\t\t}\n\t}\n}\nint main(){\n\tn = read(),m = read();\n\tfor(rint i = 1;i <= m;++i){//\u8bb0\u5f55\u539f\u56fe\u4e2d\u76f8\u8fde\u7684\u8fb9\n\t\trint x = read(),y = read();\n\t\tvec[x][y] = vec[y][x] = 1;\n\t}\n\tfor(rint i = 1;i < n;++i){\n\t\trint x = read(),y = read();\n\t\tAdd(x,y);\n\t\tAdd(y,x);\n\t}\n\trint mx = (1 << n) - 1;//\u5168\u96c6\n\tfor(rint i = 0;i <= mx;++i){//\u679a\u4e3e\u72b6\u6001\n\t\tcnt[i] = cnt[i>>1] + (i & 1);//\u8ba1\u7b97\u5f53\u524d\u72b6\u6001\u7684\u5143\u7d20\u4e2a\u6570\n\t\tjl[0] = 0;rll tmp = 0;\n\t\tfor(rint j = 1;j <= n;++j)if(i & (1 << (j - 1)))jl[++jl[0]] = j;//\u8bb0\u5f55\u96c6\u5408\u5143\u7d20\u4e2a\u6570\u4ee5\u53ca\u5143\u7d20\n\t\tdfs(1,0);\n\t\tfor(rint j = 1;j <= jl[0];++j)tmp += f[1][jl[j]];//\u6c42\u548c\n\t\tans += ((n - cnt[i]) & 1) ? -tmp : tmp;//\u6839\u636e\u5b50\u96c6\u53cd\u6f14\u7684\u5f0f\u5b50\u6c42\u548c\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n\n```",
        "postTime": 1602055628,
        "uid": 340084,
        "name": "Vocanda",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P3349 \u3010[ZJOI2016]\u5c0f\u661f\u661f\u3011"
    },
    {
        "content": "# [ZJOI2016]\u5c0f\u661f\u661f   \n## \u9898\u76ee\u5927\u610f  \n\u7ed9\u4f60\u4e00\u68f5\u6811\u95ee\u4f60\u628a\u4ed6\u63d2\u5165\u4e00\u4e2a\u56fe\u4e0a\u7684\u65b9\u6848\u6570 \u3002   \n\n## $solution$   \n\u9996\u5148\u6211\u4eec\u80af\u5b9a\u4f1a\u5148\u601d\u8003\u72b6\u538b $dp$ ,$dp[i][j][k]$ \u4e3a\u6811\u4e0a\u7684 $j$ \u6620\u5c04\u5230\u56fe\u4e0a\u7684 $i$\uff0c\u76ee\u524d\u7684\u72b6\u6001\u4e3a $k$ ,\u56e0\u4e3a\u6211\u4eec\u4e0d\u77e5\u9053\u6bcf\u4e2a\u70b9\u7684\u4f4d\u7f6e\uff0c\u6240\u4ee5\u4f3c\u4e4e\u4e0d\u662f\u5f88\u597d\u641e \u3002 \u6211\u4eec\u4e00\u7b97\u590d\u6742\u5ea6\u4e5f\u4f1a\u70b8\u7684\u5440\uff0c\u6240\u4ee5\u6211\u4eec\u601d\u8003\u4e00\u4e0b\uff0c\u6709\u6ca1\u6709\u65b9\u6cd5\u53ef\u4ee5\u5ffd\u7565\u6389\u6bcf\u4e2a\u70b9\u6620\u5c04\u5230\u56fe\u7684\u4f4d\u7f6e \uff0c \u5982\u679c\u6211\u4eec\u5ffd\u7565\u6389\u70b9\u7684\u4f4d\u7f6e\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\u5462\uff0c\u5462\u4e48\u663e\u7136\u4f1a\u6709\u4e00\u5806\u70b9\u805a\u5728\u4e00\u4e2a\u70b9\u4e0a\u9762 \uff0c\u5462\u4e48\u6211\u4eec\u60f3\u5462\u4e48\u6211\u4eec\u53ea\u8981\u628a\u4e24\u4e2a\u70b9\u91cd\u5408\u7684\u51cf\u53bb\u5c31\u597d\u5566 \uff0c\u56e0\u4e3a\u53ef\u80fd\u4f1a\u6709\u4e24\u4e2a\u70b9\u91cd\u5408\uff0c\u6240\u4ee5\u6211\u4eec\u7b97\u51fa\u53ea\u7528 $n-1$ \u4e2a\u70b9\u7684\u7b97\u51fa\u6765\uff0c\u7136\u540e\u51cf\u53bb\uff0c\u4e4b\u540e\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u6837\u6211\u4eec\u6709\u4e00\u4e9b\u65b9\u6848\u663e\u7136\u4f1a\u88ab\u51cf\u4e24\u6b21\uff0c\u6240\u4ee5\u6211\u4e48\u8fd8\u8981\u52a0\u4e0a $n-2$ \u7684 \uff0c$emmm$, \u5f88\u663e\u7136\u54af\uff0c\u5bb9\u65a5\u4e00\u4e0b\u5c31\u597d\u5566 \u3002   \n\n* $code$  \n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst ll maxn=50;\nll f[maxn][maxn],ma[maxn][maxn]; \nll n,m;\nll head[maxn],num;\nstruct Le\n{\n\tll nt,to;\n}edge[maxn];\nll ans,tot,z[maxn];\nvoid add(ll f,ll t){\n\tedge[++num].nt=head[f];\n\tedge[num].to=t;\n\thead[f]=num;\n}\n\nvoid get(ll u,ll fa) {\n\tfor(ll i=1;i<=tot;++i) f[u][z[i]]=1;\n\tfor(ll i=head[u];i;i=edge[i].nt) {\n\t\tll v=edge[i].to;\n\t\tif(v==fa) continue ;\n\t\tget(v,u);\n\t\tfor(ll i=1;i<=tot;++i) {\n\t\t\tll sum=0;\n\t\t\tfor(ll j=1;j<=tot;++j) {\n\t\t\t\tif(ma[z[i]][z[j]]) {\n\t\t\t\t\tsum+=f[v][z[j]];\n\t\t\t\t}\n\t\t\t}\n\t\t\tf[u][z[i]]*=sum;\n\t\t}\n\t}\n}\n\nvoid dfs(ll x,ll sl) {\n\tif(x>n) {\n\t\tget(1,-1);\n\t\tll sum=0;\n\t\tfor(ll i=1;i<=tot;++i) sum+=f[1][z[i]];\n\t\tif((n-sl)%2) ans-=sum;\n\t\telse ans+=sum;\n\t\treturn ;\n\t}\n\tz[++tot]=x;\n\tdfs(x+1,sl+1);\n\t--tot;\n\tdfs(x+1,sl);\n}\nint main() {\n\tscanf(\"%lld%lld\",&n,&m);\n\t//for(ll i=1;i<=n;++i) ma[i][i]=1;\n\tfor(ll i=1;i<=m;++i) {\n\t\tll x,y;\n\t\tscanf(\"%lld%lld\",&x,&y);\n\t\tma[x][y]=ma[y][x]=1;\n\t} \n\tfor(ll i=1;i<n;++i) {\n\t\tll x,y;\n\t\tscanf(\"%lld%lld\",&x,&y);\n\t\tadd(x,y);add(y,x);\n\t} \n\tdfs(1,0);\n\tcout<<ans<<\"\\n\";\n\treturn 0;\n}\n\n```",
        "postTime": 1558529483,
        "uid": 102786,
        "name": "Sym_Je",
        "ccfLevel": 0,
        "title": "[ZJOI2016]\u5c0f\u661f\u661f"
    }
]