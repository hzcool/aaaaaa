[
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\n\u6709\u4e24\u4e2a\u9ed1\u70b9\uff0c\u56f4\u6210\u4e86\u4e00\u4e2a\u5708\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u64cd\u4f5c\u6269\u5145\u8fd9\u4e2a\u5708\u3002\n\n- \u5728\u4e24\u4e2a\u70b9\u4e4b\u95f4\u52a0\u5165\u4e00\u4e2a\u767d\u70b9\uff0c\u5e76\u7ffb\u8f6c\u8fd9\u4e24\u4e2a\u70b9\u7684\u989c\u8272\u3002\n- \u5220\u9664\u4e00\u4e2a\u767d\u70b9\uff0c\u540c\u65f6\u7ffb\u8f6c\u5b83\u76f8\u90bb\u7684\u4e24\u4e2a\u70b9\u7684\u989c\u8272\u3002\n\n\u7ffb\u8f6c\u7684\u542b\u4e49\u662f\uff0c\u5c06\u767d\u8272\u7684\u70b9\u53d8\u6210\u9ed1\u8272\uff0c\u5c06\u9ed1\u8272\u7684\u70b9\u53d8\u6210\u767d\u8272\u3002\n\n\u6bcf\u6b21\u64cd\u4f5c\u65f6\uff0c\u90fd\u5fc5\u987b\u4fdd\u8bc1**\u64cd\u4f5c\u540e\u70b9\u7684\u4e2a\u6570\u4e0d\u5c0f\u4e8e $2$** \u3002\u4f60\u53ef\u4ee5\u8fdb\u884c\u65e0\u6570\u6b21\u64cd\u4f5c\u3002\u73b0\u5728\u7ecf\u8fc7\u82e5\u5e72\u6b21\u64cd\u4f5c\u540e\uff0c\u5f97\u5230\u4e86\u4e00\u4e2a\u5927\u5c0f\u4e3a $n$ \u7684\u5708\u3002\u63a5\u7740**\u4efb\u53d6**\u67d0\u4e2a\u4f4d\u7f6e\u65ad\u5f00\uff0c\u4f1a\u5f62\u6210\u4e00\u4e2a\u94fe\u3002\n\n\u540c\u65f6\uff0c\u53ef\u80fd\u6709 $m$ \u4e2a\u7ea6\u675f\u6761\u4ef6\u3002\u7b2c $i$ \u4e2a\u7ea6\u675f\u6761\u4ef6 $(p_i,c_i)$ \uff0c\u8868\u793a\u8fd9\u6761\u94fe\u7684\u7b2c $p_i$ \u4e2a\u70b9\u5e94\u8be5\u662f $c_i$ \u989c\u8272\u7684\u3002\u5176\u4e2d\uff0c$c_i=0$ \u8868\u793a\u8be5\u70b9\u4e3a\u9ed1\u8272\uff0c $c_i=1$ \u8868\u793a\u8be5\u70b9\u4e3a\u767d\u8272\u3002\n\n\u8be2\u95ee\u6700\u591a\u53ef\u4ee5\u5f97\u5230\u591a\u5c11\u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684\u4e0d\u540c\u7684\u94fe\u3002\u7531\u4e8e\u53ef\u80fd\u7ed3\u679c\u592a\u5927\uff0c\u4f60\u53ea\u9700\u8981\u8f93\u51fa\u5b83\u5bf9 $998244353$ \u53d6\u6a21\u7684\u7ed3\u679c\u3002\n\n\u4e24\u4e2a\u94fe\u4e0d\u540c\uff0c\u5f53\u4e14\u4ec5\u5f53\u5b58\u5728\u4e00\u4e2a\u4f4d\u7f6e\u7684\u70b9\u989c\u8272\u4e0d\u540c\u3002\n\n## \u9898\u89e3\n\n### $\\textbf{Subtask 1}\\ n,m\\le 16$\n\n\u76f4\u63a5\u66b4\u529b\u64cd\u4f5c\uff0c\u5e76\u5224\u65ad\u662f\u5426\u7b26\u5408\u6761\u4ef6\u5373\u53ef\u3002\u590d\u6742\u5ea6$\\mathcal O(2^n\\times n)$ \u3002\n\n### $\\textbf{Subtask 2}\\ n\\le 10^6,m\\le 5\\times 10^3$ \n\n\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u8bc1\u660e\u4e00\u4e2a\u5c0f\u7ed3\u8bba\uff1a**\u9ed1\u70b9\u7684\u4e2a\u6570\u603b\u4e3a\u5076\u6570\u4e2a**\u3002\n\n\u8fd9\u4e2a\u7ed3\u8bba\u975e\u5e38\u7b80\u5355\u3002\u8003\u8651\u6bcf\u6b21\u52a0\u70b9\u64cd\u4f5c\uff0c\u5982\u679c\u5de6\u53f3\u4e24\u4e2a\u70b9\u540c\u8272\uff0c\u90a3\u4e48\u9ed1\u70b9\u4e2a\u6570\u7684\u53d8\u5316\u91cf\u4e3a$\\pm2$\uff1b\u5982\u679c\u5f02\u8272\uff0c\u90a3\u4e48\u76f8\u5f53\u4e8e\u4ea4\u6362\u4e86\u4e24\u70b9\uff0c\u6570\u91cf\u4e0d\u53d8\u3002\u7531\u4e8e\u521d\u59cb\u65f6\u5019\uff0c\u9ed1\u70b9\u6570\u91cf\u4e3a $0$ \uff0c\u56e0\u6b64\u4efb\u4f55\u65f6\u5019\u9ed1\u70b9\u7684\u6570\u91cf\u90fd\u5e94\u8be5\u662f\u5076\u6570\u3002\n\n![pic1.JPG](https://i.loli.net/2020/07/16/zP1nierojSaHZkN.jpg)\n\n\u4e0d\u59a8\u8bbe\u5f53\u524d\u4e00\u5171\u6709 $p$ \u4e2a\u9ed1\u70b9\uff0c\u5219\u8fd9\u4e9b\u9ed1\u70b9\u5c06\u5706\u5f27\u5212\u5206\u4e3a\u4e86 $p$ \u6bb5\u3002\u6211\u4eec\u5bf9\u5176\u8fdb\u884c\u67d3\u8272\u3002\uff08\u5982\u56fe $1$ )\n\n\u6211\u4eec\u5bf9\u5706\u5f27\u8fdb\u884c\u67d3\u8272\uff1a\u767d\u8272\u3001\u9ed1\u8272\u3001\u767d\u8272\u2026\u2026\u7531\u4e8e\u53ea\u6709\u5076\u6570\u6bb5\u5706\u5f27\uff0c\u6240\u4ee5\u6bcf\u4e24\u4e2a\u5f27\u4e4b\u95f4\u7684\u989c\u8272\u4e0d\u540c\u3002\n\n\u6211\u4eec\u5c06\u9ed1\u8272\u5f27\u4e0a\u7684\u767d\u70b9\u8d4b\u503c\u4e3a $+1$ \uff0c\u767d\u8272\u5f27\u4e0a\u7684\u767d\u70b9\u8d4b\u503c\u4e3a $-1$ \uff08\u5982\u56fe $2 $\uff09\u3002\u7edf\u8ba1\u6240\u6709\u767d\u70b9\u7684\u6743\u503c\u548c $S$ \u3002\u7531\u4e8e\u9ed1\u767d\u5f27\u53ef\u4ee5\u4ea4\u6362\uff0c\u6240\u4ee5\u767d\u70b9\u7684\u6743\u503c\u548c\u4ea6\u80fd\u4e3a $-S$ \u3002\u4e0b\u9762\u8ba8\u8bba\u4e24\u79cd\u64cd\u4f5c\u5bf9 $S$ \u7684\u5f71\u54cd\u3002\n\n- \u5f53\u52a0\u5165\u70b9\u7684\u4e24\u4fa7\u90fd\u662f\u9ed1\u70b9\u65f6\uff0c\u9ed1\u70b9\u53d8\u4e3a\u767d\u70b9\u3002\u7531\u4e8e\u8be5\u64cd\u4f5c\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6\u70b9\u7684\u6743\u503c\uff0c\u4e14\u8fd9\u4e09\u4e2a\u70b9\u6743\u503c\u76f8\u540c\u3002\u4e8e\u662f $S\\gets S\\pm 3$ \u3002\n\n- \u5f53\u52a0\u5165\u7684\u70b9\u4e24\u4fa7\u90fd\u662f\u767d\u70b9\u65f6\uff0c\u767d\u70b9\u53d8\u4e3a\u9ed1\u70b9\u3002\u663e\u7136\uff0c\u65b0\u52a0\u5165\u7684\u767d\u70b9\u7684\u6743\u503c\u4e0e\u539f\u5148\u4e24\u70b9\u7684\u6743\u503c\u76f8\u53cd\u3002\u56e0\u6b64\uff0c$S\\gets S\\pm 3$\u3002\n\n- \u5f53\u52a0\u5165\u7684\u70b9\u4e24\u4fa7\u7684\u70b9\u7684\u663e\u8272\u76f8\u5f02\u65f6\uff0c\u4e0d\u59a8\u8bbe\u5176\u4e2d\u767d\u70b9\u6743\u503c\u4e3a $a$ \u3002\u63d2\u5165\u540e\uff0c\u539f\u5148\u4e24\u4fa7\u7684\u70b9\u4f4d\u7f6e\u4ea4\u6362\uff0c\u539f\u6765\u7684\u767d\u70b9\u4ea4\u6362\u540e\u6743\u503c\u53d8\u4e3a\u4e86 $-a$\u3002\u65b0\u7684\u70b9\u6743\u503c\u4e0e\u8be5\u767d\u70b9\u76f8\u540c\uff0c\u4ea6\u4e3a $-a$ \u3002\u4e8e\u662f\uff0c$S\\gets S-3\\times a$\u3002\n\n\u5bf9\u4e8e\u5220\u70b9\u64cd\u4f5c\uff0c\u7531\u4e8e\u5176\u662f\u52a0\u70b9\u64cd\u4f5c\u7684\u4e92\u9006\u64cd\u4f5c\uff0c\u56e0\u6b64 $S$ \u7684\u53d8\u5316\u91cf\u4e5f\u4e3a $3$ \u7684\u500d\u6570\u3002\u53ef\u4ee5\u8fd9\u6837\u7b80\u8981\u8bc1\u660e\uff1a\n\n\u5047\u8bbe\u5220\u53bb\u4e00\u4e2a\u767d\u70b9\u540e\uff0c\u91cd\u65b0\u5728\u8be5\u4f4d\u7f6e\u91cd\u65b0\u52a0\u5165\u767d\u70b9\uff0c\u6b64\u65f6 $S$ \u4e0d\u53d8\uff1b\u800c\u52a0\u5165\u767d\u70b9\uff0c$S$ \u7684\u53d8\u5316\u4e3a $3$ \u7684\u500d\u6570\uff0c\u56e0\u6b64\u5220\u70b9\u64cd\u4f5c\uff0c $S$ \u7684\u53d8\u5316\u91cf\u4ea6\u4e3a $3$ \u7684\u500d\u6570\u3002\n\n\u521d\u59cb\u65f6\uff0c$S=\\pm 2$ \u3002\u56e0\u6b64\u7ec8\u6b62\u72b6\u6001\u7684\u6743\u503c\u548c $S'$ \u5fc5\u6709 \uff1a\n\n$$S'\\not \\equiv 0 \\pmod 3$$\n\n\u5728\u5f00\u5934\uff0c\u6211\u4eec\u5df2\u7ecf\u8bc1\u660e\u9ed1\u70b9\u7684\u4e2a\u6570\u5fc5\u4e3a\u5076\u6570\u3002\u4e0b\u8bc1\u4efb\u4f55\u4e00\u4e2a\u7b26\u5408\u8fd9\u4e24\u4e2a\u6761\u4ef6\u7684\u72b6\u6001\uff0c\u90fd\u80fd\u7531\u521d\u59cb\u72b6\u6001\u8f6c\u79fb\u800c\u6765\u3002\n\n\u7531\u4e8e $S' \\not \\equiv 0 \\pmod 3$ \uff0c\u56e0\u6b64\u65e0\u8bba\u4f55\u65f6\u90fd\u6709\u81f3\u5c11\u4e00\u4e2a\u767d\u70b9\u3002\u6211\u4eec\u4e0d\u65ad\u5220\u53bb\u767d\u70b9\uff0c\u76f4\u5230\u53ea\u5269\u4e0b\u4e24\u4e2a\u70b9\uff0c\u5176\u4e2d\u4e5f\u5fc5\u6709\u767d\u70b9\u3002\u540c\u65f6\uff0c\u7531\u4e8e\u9ed1\u70b9\u4e2a\u6570\u4e3a\u5076\u6570\uff0c\u6240\u4ee5\u53ea\u6709\u53ef\u80fd\u6709 $0$ \u4e2a\u9ed1\u70b9\uff0c\u5373\u521d\u59cb\u72b6\u6001\u3002\u56e0\u6b64\uff0c\u4ece\u4efb\u4f55\u6ee1\u8db3\u8fd9\u4e24\u4e2a\u6761\u4ef6\u7684\u72b6\u6001\u90fd\u80fd\u4ec5\u901a\u8fc7\u5220\u70b9\u56de\u5230\u521d\u59cb\u72b6\u6001\u3002\u53c8\u7531\u4e8e\u52a0\u70b9\u64cd\u4f5c\u662f\u5220\u70b9\u7684\u9006\u64cd\u4f5c\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981\u6309\u7167\u5220\u70b9\u7684\u987a\u5e8f\u5012\u8fc7\u6765\u64cd\u4f5c\uff0c\u5c31\u4e00\u5b9a\u80fd\u83b7\u5f97\u8be5\u72b6\u6001\u3002\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 $\\rm dp$ \u8ba1\u7b97\u51fa\u65b9\u6848\u603b\u6570\u3002\n\n\u7531\u4e8e\u6700\u7ec8\u6211\u4eec\u4f1a\u7ed9\u5706\u73af\u65ad\u94fe\uff0c\u56e0\u6b64\u5c31\u76f8\u5f53\u4e8e\u63d0\u524d\u7ed9\u5927\u5c0f\u4e3a $n$ \u7684\u5706\u73af\u7684\u6bcf\u4e2a\u70b9\u7f16\u4e86\u53f7\u3002\u4e0d\u59a8\u4efb\u53d6\u4e00\u4e2a\u70b9\u5f00\u59cb\uff0c\u7f16\u4e3a $1,2,3\\cdots$ \u6211\u4eec\u8bbe\u8ba1\u72b6\u6001 $dp_{i,j,k}$\uff0c\u8868\u793a\u524d $i$ \u4e2a\u70b9\uff0c\u9ed1\u70b9\u4e2a\u6570$\\mod 2=j$ \u4e14 $S\\mod 3=k$ \u7684\u65b9\u6848\u603b\u6570\u3002\u4e8e\u662f\u6211\u4eec\u80fd\u591f\u5f97\u5230\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$dp_{i,j,k}=\\begin{cases}\ndp_{i-1,0,(k+2)\\mod 3}+dp_{i-1,1,k} & j=0\\cr\ndp_{i-1,1,(k+1)\\mod 3}+dp_{i-1,0,k} & j=1\\end{cases}$$\n\n\u7531\u4e8e\u9ed1\u767d\u53ef\u4ee5\u4ea4\u6362\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u94a6\u5b9a\u7b2c\u4e00\u4e2a\u70b9\u5904\u5728\u767d\u5f27\u4e0a\u3002\u6bcf\u8ba8\u8bba\u4e00\u4e2a\u9ed1\u70b9\uff0c\u9ed1\u767d\u5f27\u7684\u60c5\u51b5\u5c31\u4f1a\u4ea4\u6362\u3002\u521d\u59cb\u65f6\uff0c$dp_{1,0,1}=dp_{1,1,0}=1$\uff0c\u5176\u4ed6\u7684 $i=1$ \u7684\u60c5\u51b5\u90fd\u4e3a $0$ \u3002\u7b54\u6848\u4e3a $dp_{n,0,1}+dp_{n,0,2}$\u3002\n\n\u5173\u4e8e\u9650\u5236\u6761\u4ef6\u7684\u95ee\u9898\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u5230\u9650\u5236\u70b9\u7684\u65f6\u5019\uff0c\u820d\u53bb\u4e0d\u5408\u6cd5\u7684\u8f6c\u79fb\u65b9\u6cd5\u3002\u5982\u9650\u5236\u70b9 $a$ \u4e3a\u767d\u70b9\uff0c\u6211\u4eec\u5c31\u8981\u820d\u5f03\u70b9 $a-1$ \u8f6c\u79fb\u5230\u9ed1\u70b9\u7684\u60c5\u51b5\uff1b\u9650\u5236\u70b9\u4e3a\u767d\u70b9\u540c\u7406\u53ef\u63a8\u3002\n\n### $\\textbf{Subtask 3}\\ n\\le 10^9,m=0$ \n\n\u5982\u679c\u4f60\u5df2\u7ecf\u5199\u51fa\u4e86\u4e0a\u9762\u4e24\u4e2a$\\rm Subtask$\u7684\u4efb\u610f\u4e00\u79cd\uff0c\u7ecf\u8fc7\u7b80\u5355\u6253\u8868\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0c\u8bbe $f(x)$ \u4e3a $n=x,m=0$ \u65f6\u7684\u7ed3\u679c\uff0c\u6709\uff1a\n\n$$f(x)=\\begin{cases}1 & x=2 \\cr f(x-1)\\times 2+1 & x\\text{\u4e3a\u5947\u6570} \\cr f(x-1)\\times 2-1 &x\\text{\u4e3a\u5076\u6570}\\end{cases}$$\n\n\u81f3\u4e8e\u8fd9\u4e2a\u5f0f\u5b50\u600e\u4e48\u8ba1\u7b97\uff0c\u6700\u7b80\u5355\u7684\u65b9\u6cd5\uff0c\u5c31\u662f\u76f4\u63a5\u77e9\u9635\u4e58\u6cd5\u2026\u2026\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u8003\u8651\u5206\u6cbb\u3002\n\n\u9996\u5148\u6211\u4eec\u80fd\u591f\u53d1\u73b0\uff0c \n\n$$\\begin{aligned}f(2k)&=f(2k-1)\\times 2-1\\cr&=(f(2(k-1))\\times 2+1)\\times 2-1\\cr&=f(2(k-1))\\times 4+1\\end{aligned}$$\n\n\u4e0d\u59a8\u8bbe $g(x)=f(2\\times x)$ \u3002\u5219 $g(1)=1,g(n)=4\\times g(n-1)-1$\u3002\n\n\u5047\u8bbe\u6211\u4eec\u8981\u8ba1\u7b97 $g(x)$ \u7528 $g(2)$ \u8868\u793a\u7684\u7ed3\u679c\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u51fa $g(\\lfloor\\frac{x}{2}\\rfloor)$ \u7528 $g(2)$ \u8868\u793a\u7684\u7ed3\u679c\uff0c\u7a0d\u52a0\u4fee\u6539\u5c31\u80fd\u63a8\u51fa\u7528 $g(\\lfloor\\frac{x}{2}\\rfloor)$ \u8868\u793a $g(x)$ \u7684\u7ed3\u679c\u3002\n\n\u5f53\u7136\uff0c\u5982\u679c\u4f60\u6570\u5b66\u529f\u5e95\u8db3\u591f\u597d\uff0c\u4f60\u6216\u8bb8\u80fd\u76f4\u63a5\u63a8\u5bfc\u51fa\u901a\u9879\u516c\u5f0f\uff08\n\n**\u65f6\u95f4\u590d\u6742\u5ea6**\uff1a$\\mathcal O(\\log_2n)$\u3002\n\n### $\\textbf{Subtask 4}\\ n\\le 10^{18},m\\le 5\\times 10^3$ \n\n\u8ba9\u6211\u4eec\u56de\u5230 $\\text{Subtask 2}$ \u7684\u505a\u6cd5\u3002\n\n\u5f88\u663e\u7136\uff0c\u6bcf\u4e2a\u70b9\u7684\u72b6\u6001\u53ea\u4e0e\u4e0a\u4e2a\u70b9\u6709\u5173\uff0c\u56e0\u6b64\u6211\u4eec\u80fd\u591f\u538b\u7f29\u6389\u7b2c\u4e00\u7ef4\u3002\n\n\u6211\u4eec\u80fd\u591f\u53d1\u73b0\uff0c\u8be5\u5f0f\u53ef\u4ee5\u77e9\u9635\u52a0\u901f\u9012\u63a8\u3002\u5177\u4f53\u800c\u8a00\uff0c\u6211\u4eec\u8bbe\u8ba1\u4e00\u4e2a $1\\times 6$ \u7684\u5411\u91cf\u77e9\u9635\uff0c\u5176\u4e2d\u7b2c$(j\\times 3+k+1)$ \u5217\u8868\u793a$dp_{i,j,k}$\uff1b\u7136\u540e\u8bbe\u8ba1\u4e00\u4e2a\u8f6c\u79fb\u77e9\u9635\uff0c\u4f7f\u7528\u77e9\u9635\u5feb\u901f\u5e42\u8fdb\u884c\u52a0\u901f\u8f6c\u5316\u3002\n\n\u521d\u59cb\u77e9\u9635\uff1a\n\n$$\\begin{bmatrix}0 & a & 0 & b & 0 & 0\\end{bmatrix}$$\n\n\u5176\u4e2d\uff0c\u5f53\u70b9 $1$ \u9650\u5236\u4e3a\u767d\u70b9\u65f6\uff0c $a=1$ \uff0c\u5426\u5219 $a=0$ \uff1b\n\n\u5176\u4e2d\uff0c\u5f53\u70b9 $1$ \u9650\u5236\u4e3a\u9ed1\u70b9\u65f6\uff0c $b=1$ \uff0c\u5426\u5219 $b=0$ \u3002\n\n\u8f6c\u79fb\u77e9\u9635\uff1a\n\n$$\\begin{bmatrix}\n0 & 1 & 0 & 1 & 0 & 0 \\cr\n0 & 0 & 1 & 0 & 1 & 0 \\cr\n1 & 0 & 0 & 0 & 0 & 1 \\cr\n1 & 0 & 0 & 0 & 0 & 1 \\cr\n0 & 1 & 0 & 1 & 0 & 0 \\cr\n0 & 0 & 1 & 0 & 1 & 0 \\cr\n\\end{bmatrix}$$\n\n$\\rm PS:$\u5b9e\u9645\u8ba1\u7b97\u8f6c\u79fb\u77e9\u9635\u7684\u65f6\u5019\uff0c\u5b8c\u5168\u53ef\u4ee5\u76f4\u63a5\u7528 $\\rm dp$ \u5f0f\u5b50\u751f\u6210\uff0c\u800c\u4e0d\u9700\u8981\u624b\u63a8\u3002\n\n**\u65f6\u95f4\u590d\u6742\u5ea6**\uff1a$\\mathcal O(m\\times k^3\\times \\log _2 \\frac{n}{m})$\u3002\u5176\u4e2d\uff0c$k$\u4e3a\u77e9\u9635\u5927\u5c0f\uff0c\u5373 $k=6$ \u3002\n\n## \u53c2\u8003\u4ee3\u7801\n\n$\\text{Subtask 1}$\uff0c\u66b4\u529b\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define up(l,r,i) for(int i=l;i<=r;i++)\n#define dn(l,r,i) for(int i=l;i>=r;i--)\nusing namespace std;\n\ntypedef long long LL;\nconst int INF =2147483647;\nint qread(){\n    int w=1,c,ret;\n    while((c=getchar())> '9'||c< '0')\n    w=(c=='-'?-1:1); ret=c-'0';\n    while((c=getchar())>='0'&&c<='9')\n    ret=ret*10+c-'0';\n    return ret*w;\n}\nmap<int,int> T;\nbool chk(int n,int t){\n    dn(n-1,2,i){\n        int x=(t&-t),p=T[x];\n        if(x==0) return false;\n        if(p==i) t^=1,t^=(1<<i-1),t-=1<<p; else\n        if(p==0) t^=2,t^=(1<<i  ),t>>=1;   else{\n            t^=1<<p-1,t^=1<<p+1;\n            t=(t&(1<<p)-1)|(t>>p)<<p-1;\n        }\n    }\n    return t==3;\n}\nint cnt(int n,int t){\n    int c=n; up(0,n-1,i){\n        if(t&(1<<i)) --c;\n    }\n    return c;\n}\n#define pi first\n#define ci second\nint ans; pair<int,int> P[20]; bool made_by_joesSR=true;\nint main(){\n    up(0,20,i) T[1<<i]=i;\n    int n=qread(),m=qread(),p=(1<<n)-1;\n    up(1,m,i){\n        int x=qread(),y=qread(); P[i].pi=x,P[i].ci=y;\n    }\n    up(0,p,i){\n        up(1,m,j){\n            if(!!(i&(1<<P[j].pi-1))!=P[j].ci) goto nxt;\n        }\n        if(cnt(n,i)%2==0&&chk(n,i)) ++ans;\n        nxt:;\n    }\n    printf(\"%d\\n\",ans);\n    return 0;\n}\n```\n\n$\\text{Subtask 1\\~ 3}$\uff0c\u666e\u901a$\\rm dp$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define up(l,r,i) for(int i=l;i<=r;i++)\n#define dn(l,r,i) for(int i=l;i>=r;i--)\nusing namespace std;\n\ntypedef long long LL;\nconst int INF =2147483647;\nint qread(){\n    int w=1,c,ret;\n    while((c=getchar())> '9'||c< '0')\n    w=(c=='-'?-1:1); ret=c-'0';\n    while((c=getchar())>='0'&&c<='9')\n    ret=ret*10+c-'0';\n    return ret*w;\n}\nconst int MAXC =6+3,MAXM=5e3+3;\nint n,m,p=1,A[MAXC],B[MAXC];\nconst int MOD  =998234353;\n#define dp(x,y) ((x)*3+(y))\n#define pi first\n#define ci second\npair<int,int> P[MAXM]; bool made_by_joesSR=true;\nint main(){\n    n=qread(),m=qread();\n    up(1,m,i) P[i].pi=qread(),P[i].ci=qread();\n    sort(P+1,P+1+m);\n    if(P[1].pi==1){\n        ++p;\n        if(P[1].ci==0) A[dp(1,0)]=1;\n        else           A[dp(0,1)]=1;\n    } else A[dp(1,0)]=A[dp(0,1)]=1;\n    up(2,n,i){\n        bool a=true,b=true;\n        if(P[p].pi==i){if(P[p].ci==0) a=false; else b=false;++p;}\n        up(0,1,j) up(0,2,k){\n            B[dp(j,k)]=(A[dp(j,(k+2-j)%3)]*a+A[dp(!j,k)]*b)%MOD;\n        }\n        memcpy(A,B,sizeof(B));\n    }\n    printf(\"%d\\n\",(A[dp(0,1)]+A[dp(0,2)])%MOD);\n    return 0;\n}\n```\n\n$\\text{Subtask 3}$\uff0c\u5206\u6cbb\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define up(l,r,i) for(int i=l;i<=r;i++)\n#define dn(l,r,i) for(int i=l;i>=r;i--)\nusing namespace std;\n\ntypedef long long LL;\nconst int INF =2147483647;\nLL qread(){\n    LL w=1,c,ret;\n    while((c=getchar())> '9'||c< '0') w=(c=='-'?-1:1); ret=c-'0';\n    while((c=getchar())>='0'&&c<='9') ret=ret*10+c-'0';\n    return ret*w;\n}\nconst int MOD=998234353;\nvoid calc(LL n,int &a,int &b){     \n    if(n==1){a=1,b=0;return;}\n    LL m=n/2; int p=0,q=0; calc(m,p,q);\n    q=((LL)p*q+q)%MOD,p=(LL)p*p%MOD;\n    LL t=2ll*m-1; while(t<n){\n        p=(LL)p*4%MOD,q=((LL)4*q+1)%MOD; ++t;\n    }\n    a=p,b=q;\n}\nLL n,m; bool made_by_joesSR=true;\nint main(){\n    n=qread(),m=qread();\n    if(m) puts(\"-1\"),exit(0);\n    if(n%2==0){\n        int a,b; calc(n/2,a,b); printf(\"%d\\n\",(a+b)%MOD);\n    } else{\n        int a,b; calc(n/2,a,b); printf(\"%d\\n\",(2ll*(a+b)+1)%MOD);\n    }\n    return 0;\n}\n```\n\n$\\text{Subtask 4}$\uff0c\u77e9\u9635\u4f18\u5316 $dp$\n\n```cpp\n#include<bits/stdc++.h>\n#define up(l,r,i) for(int i=l;i<=r;i++)\n#define dn(l,r,i) for(int i=l;i>=r;i--)\nusing namespace std;\n\ntypedef long long LL;\nconst int INF =2147483647;\ntypedef unsigned long long u64;\nu64 qread(){\n    u64 w=1,c,ret;\n    while((c=getchar())> '9'||c< '0') w=(c=='-'?-1:1); ret=c-'0';\n    while((c=getchar())>='0'&&c<='9') ret=ret*10+c-'0';\n    return ret*w;\n}\nconst int MOD =998234353;\nconst int MAXC=6+3,MAXN=5e3+3;\nstruct mtx{\n    int dt[MAXC][MAXC],a,b;\n    mtx(int x=0,int y=0):a(x),b(y){memset(dt,0,sizeof(dt));}\n    mtx operator *(mtx t){\n        int n=a,p=b,m=t.b; mtx r(n,m); up(0,p-1,i) up(0,n-1,j) up(0,m-1,k)\n        r.dt[j][k]=((LL)r.dt[j][k]+(LL)dt[j][i]*t.dt[i][k])%MOD;\n        return r;\n    }\n}o(1,6),oo(6,6);\nmtx pwr(mtx x,u64 y){\n    mtx r=x,t=x; --y; while(y){if(y&1) r=r*t; t=t*t,y>>=1;} return r;\n}\n#define pi first\n#define ci second\n#define dp(x,y) ((x)*3+(y))\nu64 n,m,lst,T[MAXC]; bool made_by_joesSR=true; pair<u64,bool> P[MAXN];\nint main(){\n    up(0,1,i) up(0,2,j){\n        oo.dt[dp(!i,j)][dp(i,j)]=oo.dt[dp(i,(j+2-i)%3)][dp(i,j)]=1;\n    }\n    n=qread(),m=qread(); up(1,m,i) P[i].pi=qread(),P[i].ci=qread();\n    sort(P+1,P+1+m);\n    if(P[1].pi==1){\n        if(P[1].ci==0) o.dt[0][dp(1,0)]=1;\n        else           o.dt[0][dp(0,1)]=1;\n    } else o.dt[0][dp(1,0)]=o.dt[0][dp(0,1)]=1;\n    lst=1;\n    up(1,m,i){\n        if(P[i].pi==1) continue;\n        if(lst<P[i].pi-1) o=o*pwr(oo,(P[i].pi-1)-lst);\n        memset(T,0,sizeof(T)); bool a=true,b=true;\n        if(P[i].ci==0) a=false; else b=false;\n        up(0,1,j) up(0,2,k){\n            T[dp(j,k)]=(o.dt[0][dp(j,(k+2-j)%3)]*a+o.dt[0][dp(!j,k)]*b)%MOD;\n        }\n        up(0,5,j) o.dt[0][j]=T[j];\n        lst=P[i].pi;\n    }\n    if(lst!=n) o=o*pwr(oo,n-lst);\n    printf(\"%d\\n\",(o.dt[0][dp(0,1)]+o.dt[0][dp(0,2)])%MOD);\n    return 0;\n}\n```",
        "postTime": 1595053229,
        "uid": 330759,
        "name": "\u56e7\u4ed9",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6734 \u3010\u300cWdsr-2\u300d\u9634\u9633\u7389\u3011"
    },
    {
        "content": "# \u524d\u8a00\n\n\u8ba1\u6570\u7c7b DP, \u96be\u5ea6\u8f83\u5927\u3002\n\n\u5bf9\u4e8e Subtask #1, \u6211\u4eec\u53ea\u9700\u8981\u66b4\u529b\u5224\u65ad\u5373\u53ef\u3002\n\n\u5bf9\u4e8e Subtask #3 ($M = 0$), OEIS \u4e0a\u7684\u901a\u9879\u516c\u5f0f\u63d0\u4f9b\u4e86\u5f02\u4e8e\u56e7\u4ed9\u7684\u505a\u6cd5\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u4e0d\u518d\u9610\u8ff0\u3002\n\n# \u6b63\u6587\n\n\u65e2\u7136\u662f\u4e2a\u8ba1\u6570\u7c7b DP, \u6211\u4eec\u8003\u8651\u8bbe\u8ba1\u72b6\u6001\u3002\n\n\u770b\u8d77\u6765\u4e0d\u592a\u597d\u8bbe\u8ba1\u554a\uff0c\u627e\u627e\u6027\u8d28\uff1f\n\n\u6211\u4eec\u53d1\u73b0\uff1a\u65e0\u8bba\u5982\u4f55\uff0c\u9634\u70b9\u6570\u76ee\u90fd\u662f\u5076\u6570\u3002\n\n**\u8bc1\u660e\uff1a\u9634\u70b9\u4e00\u5f00\u59cb\u6709 $0$ \u4e2a\u3002**\n\n\u82e5\u5728\u4e24\u5f02\u8272\u70b9\u95f4\u52a0\u9633\u70b9\uff0c\u76f8\u5f53\u4e8e\u4e92\u6362\u989c\u8272\uff0c\u6570\u76ee\u4e0d\u53d8\u3002\n\n\u82e5\u5728\u4e24\u540c\u8272\u70b9\u95f4\u52a0\u9633\u70b9\uff0c\u9634\u70b9\u6570\u76ee\u8981\u4e48\u52a0\u4e0a $2$, \u8981\u4e48\u51cf\u53bb $2$.\n\n\u6240\u4ee5\u65e0\u8bba\u8fdb\u884c\u4ec0\u4e48\u64cd\u4f5c\uff0c\u9634\u70b9\u7684\u6570\u76ee\u90fd\u53ea\u4f1a\u52a0\u4e0a $2$, \u51cf\u53bb $2$, \u6216\u8005\u4e0d\u53d8\u3002\n\n\u4e8e\u662f\u9634\u70b9\u6570\u76ee\u4e00\u76f4\u90fd\u662f\u5076\u6570\u3002\n\n\u90a3\u4e48\u8003\u8651\u5230\u8fd9\u4e00\u4e2a\u7279\u6b8a\u6027\u8d28\uff0c\u8bbe\u9634\u70b9\u6570\u76ee\u4e3a $q$. \u8fd9\u4e9b\u9634\u70b9\u5c06\u8fd9\u4e2a\u5706\u5212\u5206\u4e3a $q$ \u6bb5\u3002\u5c06\u6bcf\u4e00\u6bb5\u90fd\u67d3\u4e0a\u8272\uff0c\u6bcf\u6bb5\u989c\u8272\u663e\u7136\u4e0d\u540c\u3002\n\n\u4ee4\u67d0\u4e00\u6bb5\u7684\u989c\u8272\u4e3a $R$, \u4e0e $R$ \u6bb5\u76f8\u90bb\u7684\u6bb5\u989c\u8272\u4e3a $B$. \u7ed9\u4e88 $R$ \u4e0a\u7684\u9633\u70b9\u4e00\u4e2a\u6743\u503c $1$, $B$ \u4e0a\u7684\u9633\u70b9\u4e00\u4e2a\u6743\u503c $-1$. \n\n\u4ee4\u6240\u6709\u9633\u70b9\u7684\u6743\u503c\u4e3a $S$. \u4e0b\u9762\u770b\u6bcf\u79cd\u64cd\u4f5c\u5bf9\u4e8e $S$ \u7684\u5f71\u54cd\u3002\n\n## 1. \u5728\u4e24\u540c\u8272\u70b9\u95f4\u52a0\u9633\u70b9\n\n### 1.1 \u5728\u4e24\u9633\u8272\u70b9\u95f4\u52a0\u9633\u70b9\n\n\u4e24\u9633\u70b9\u53d8\u6210\u4e24\u9633\u70b9\uff0c\u8fd9\u4e00\u6bb5\u989c\u8272\u53d8\u4e86\uff0c\u6d88\u5931\u4e24\u4e2a\u9633\u70b9\uff0c\u591a\u4e86\u4e00\u4e2a\u9633\u70b9\uff0c\u8d21\u732e\u7684\u7b26\u53f7\u4e0e\u6d88\u5931\u4e24\u4e2a\u9633\u70b9\u4ea7\u751f\u7684\u8d21\u732e\u7b26\u53f7\u4e00\u6837\uff0c\u6240\u4ee5\u6743\u503c\u52a0\u4e0a $\\pm 3$.\n\n### 1.2 \u5728\u4e24\u9634\u8272\u70b9\u95f4\u52a0\u9633\u70b9\n\n\u4e24\u9634\u70b9\u53d8\u6210\u4e24\u9633\u70b9\uff0c\u8fd9\u4e00\u6bb5\u989c\u8272\u4e0d\u53d8\uff0c\u6240\u4ee5\u6743\u503c\u52a0\u4e0a $\\pm 3$.\n\n## 2. \u5728\u4e24\u5f02\u8272\u70b9\u95f4\u52a0\u9633\u70b9\n\n\u4e24\u70b9\u989c\u8272\u4e92\u6362\u3002\u8bbe\u6b64\u6bb5\u9633\u70b9\u7684\u6743\u503c\u4e3a $a \\in \\{1, -1\\}$\u3002\n\n\u4e92\u6362\u540e\u8d21\u732e\u4e2d\u4e00\u4e2a\u9633\u70b9\u6743\u503c\u7b26\u53f7\u6539\u4e86\uff0c\u5728\u6b64\u57fa\u7840\u4e0a\u53c8\u52a0\u4e86\u4e00\u4e2a\u9633\u70b9\u3002\n\n\u6240\u4ee5\u6743\u503c\u51cf\u53bb $3a$.\n\n---\n\n\uff08\u6ce8\uff1a\u5220\u70b9\u4e0e\u52a0\u70b9\u6548\u679c\u51e0\u4e4e\u4e00\u6837\uff0c\u4e0d\u8ba8\u8bba\u4e86\u3002\uff09\n\n\u7531\u6b64\u53ef\u5f97 $S$ \u7684\u53d8\u5316\u91cf\u90fd\u4e3a $3$ \u7684\u500d\u6570\u3002\u4e00\u5f00\u59cb $S$ \u4e3a $\\pm 2$. \n\n\u6240\u4ee5\u6613\u77e5\uff1a\n\n$$\nS \\not \\equiv 0 \\pmod{ 3}\n$$\n\n---\n\n\u90a3\u4e48\u8bc1\u660e\u4e86\u8fa3\u4e48\u591a\uff0c\u6709\u5565\u7528\uff1f\n\n\u6211\u4eec\u53ef\u4ee5\u8bc1\u660e\uff0c\u82e5\u67d0\u4e00\u72b6\u6001\u6ee1\u8db3\u4e0a\u8ff0\u4e24\u4e2a\u6761\u4ef6\uff0c\u90a3\u4e48\u90fd\u53ef\u4ee5\u4ece\u521d\u59cb\u72b6\u6001\u8f6c\u79fb\u8fc7\u6765\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u9ed1\u70b9\u5220\u5149\uff0c\u767d\u70b9\u5220\u5f97\u53ea\u5269\u4e0b $2$ \u4e2a\u3002\u8fd9\u662f\u4e00\u5b9a\u80fd\u505a\u5230\u7684\u3002\n\n\u6211\u4eec\u77e5\u9053\u5220\u70b9\u662f\u52a0\u70b9\u7684\u9006\u64cd\u4f5c\uff0c\u4e8e\u662f\uff1a\u4efb\u4f55\u6ee1\u8db3\u4e0a\u8ff0\u4e24\u4e2a\u6761\u4ef6\u7684\u72b6\u6001\u4e00\u5b9a\u53ef\u4ee5\u4ece\u521d\u59cb\u72b6\u6001\u8f6c\u79fb\u8fc7\u6765\u3002\n\n\u7ec8\u4e8e\u53ef\u4ee5\u5199\u65b9\u7a0b\u4e86\u3002\u8bbe $f_{i, j, k}$ \u4e3a\u8003\u8651\u5230\u524d $i$ \u4e2a\u70b9\u65f6\uff0c\u7b26\u5408\u9634\u70b9\u4e2a\u6570\u4e3a $j$, $S \\bmod 3 = k$ \u7684\u65b9\u6848\u603b\u6570\uff0c\u5219\u6709\uff1a\n\n$$\nf_{i, j, k} = \n\n\\begin{cases}\n\nf_{i - 1, 0, (k + 2) \\bmod 3} + f_{i - 1, 1, k} \\quad (j = 0) \\\\\n\nf_{i - 1, 1, (k + 1) \\bmod 3} + f_{i - 1, 0, k} \\quad (j = 1)\n\n\\end{cases}\n$$\n\n\u4e0d\u8fc7\u6211\u4eec\u6ca1\u8003\u8651\u7b2c\u4e00\u4e2a\u70b9\u662f\u4ec0\u4e48\u7684\u95ee\u9898\u3002~~\uff08\u8fb9\u754c\u8fd8\u6562\u5fd8\u8bb0\u554a\uff09~~\n\n\u89c2\u5bdf\u4e00\u4e0b\uff0c\u53d1\u73b0\u7b2c\u4e00\u4e2a\u70b9\u5728 $R$ \u8fd8\u662f $B$ \u597d\u50cf\u5173\u7cfb\u4e0d\u5927\u3002\n\n\u4e8e\u662f\u6307\u5b9a\u7b2c\u4e00\u4e2a\u70b9\u5728 $R$ \u4e0a\uff0c\u8003\u8651\u7b2c\u4e00\u4e2a\u70b9\u7684\u9650\u5b9a\u6761\u4ef6\u3002\n \n\u82e5\u9650\u5b9a\u4e86\u7b2c\u4e00\u4e2a\u70b9\u662f\u9633\u70b9, $f_{1, 0, 1} = 1, f_{1, 1, 0} = 0$.\n\n\u82e5\u9650\u5b9a\u4e86\u7b2c\u4e00\u4e2a\u70b9\u662f\u9634\u70b9, $f_{1, 0, 1} = 0, f_{1, 1, 0} = 1$.\n\n\u82e5\u672a\u9650\u5b9a\u7b2c\u4e00\u4e2a\u70b9, $f_{1, 0, 1} = f_{1, 1, 0} = 1$.\n\n\u7b54\u6848\uff1a\n\n$$\nf_{N, 0, 1} + f_{N, 0, 2}\n$$\n\n\u8bb0\u5f97\u5c06\u4e0d\u7b26\u5408\u7684\u60c5\u51b5\u820d\u53bb\u3002\n\n---\n\n\u5199\u5b8c\u53d1\u73b0\u8fc7\u4e0d\u4e86\uff0c\u53d1\u73b0\uff1a\n\n$$\nN \\le 10^{18}, M \\le 5\u00d710^3\n$$\n\n\u597d\u7684\u76f4\u63a5\u77e9\u9635\u5feb\u901f\u5e42\u52a0\u901f\u3002\n\nDP \u67ff\u5b50\u91cc\u53ea\u8ddf\u524d\u4e00\u884c\u6709\u5173\uff0c\u628a $i$ \u538b\u6389\u3002\n\n\u8bbe\u8ba1\u77e9\u9635\uff1a\n\n$$\n\n\\left [\n\n\\begin{matrix}\n\n&0 &1 &0 &1 &0 &0& \\\\\n\n&0 &0 &1 &0 &1 &0& \\\\ \n\n&1 &0 &0 &0 &0 &1& \\\\\n\n&1 &0 &0 &0 &0 &1& \\\\ \n\n&0 &1 &0 &1 &0 &0& \\\\\n\n&0 &0 &1 &0 &1 &0& \\\\ \n\n\\end{matrix}\n\n\\right ]\n\n$$\n\n\u4e0d\u8fc7\u76f4\u63a5\u7528 DP \u67ff\u5b50\u63a8\u4e5f\u53ef\u4ee5\u3002\n\n\u521d\u59cb\u77e9\u9635\u8981\u8003\u8651\u7b2c\u4e00\u4e2a\u70b9\u7684\u9650\u5b9a\u6761\u4ef6\uff1a\n\n$$\n\n\\left [\n\n\\begin{matrix}\n\n&0 &c1 &0 &c2 &0 &0&\n\n\\end{matrix}\n\n\\right ]\n\n$$\n\n\u82e5\u9650\u5b9a\u4e86\u7b2c\u4e00\u4e2a\u70b9\u662f\u9633\u70b9\uff0c\u90a3\u4e48 $a = 1, b = 0$.\n\n\u82e5\u9650\u5b9a\u4e86\u7b2c\u4e00\u4e2a\u70b9\u662f\u9634\u70b9\uff0c\u90a3\u4e48 $a = 0, b = 1$.\n\n\u590d\u6742\u5ea6 $\\mathcal{O}(M \\log_2 \\dfrac{N}{M})$, \u518d\u4e58\u4e0a $6^3$, \u5927\u6982\u7387\u80fd\u8fc7\u3002\n\n# \u4ee3\u7801\n\n``` cpp\n// Problem: P6734 \u300cWdsr-2\u300d\u9634\u9633\u7389\n// Contest: Luogu\n// URL: https://www.luogu.com.cn/problem/P6734\n// Memory Limit: 128 MB\n// Time Limit: 1000 ms\n\n#include <bits/stdc++.h>\n#define MOD ((long long) (998244353))\nlong long pos(long long x, long long y) { return x * 3ll + y; }\nusing namespace std;\n\nlong long N, M;\n \nstruct Matrix {\n\tlong long mat[15][15];\n\tlong long row, col;\n\tMatrix(long long __row, long long __col);\n};\n\nMatrix::Matrix(long long __row, long long __col)\n{\n\tthis->row = __row;\n\tthis->col = __col;\n\tmemset(this->mat, 0, sizeof(this->mat));\n}\n\nMatrix operator *(Matrix a, Matrix b)\n{\n\tMatrix c(a.row, b.col);\n\tfor(long long k = 0; k < b.col; ++ k)\n\t{\n\t\tfor(long long i = 0; i < a.row; ++ i)\n\t\t{\n\t\t\tfor(long long j = 0; j < a.col; ++ j)\n\t\t\t{\n\t\t\t\tc.mat[i][j] = c.mat[i][j] + a.mat[i][k] * b.mat[k][j];\n\t\t\t\tc.mat[i][j] %= MOD;\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn c;\n}\n\nstruct Rule {\n\tlong long p;\n\tbool c;\n} rule[5005];\n\nbool operator <(Rule a, Rule b)\n{\n\treturn a.p < b.p;\n}\n\nMatrix fastpow(Matrix a, long long x)\n{\n\tMatrix res = a, tmp = a;\n\t-- x;\n\twhile(x)\n\t{\n\t\tif(x & 1)\n\t\t\tres = res * tmp;\n\t\t\t\n\t\ttmp = tmp * tmp;\n\t\tx >>= 1;\n\t}\n\t\n\treturn res;\n}\n\nMatrix base(6, 6), f(1, 6);\n\nsigned main()\n{\n\tfor(long long i = 0; i <= 1; ++ i)\n\t\tfor(long long j = 0; j <= 2; ++ j)\n\t\t\tbase.mat[(pos(!i, j))][pos(i, j)] = base.mat[(pos(i, (j + 2 - i) % 3))][pos(i, j)] = 1;\n\t\t\t\n\tcin >> N >> M;\n\tfor(long long i = 1; i <= M; ++ i)\n\t\tcin >> rule[i].p >> rule[i].c;\n\t\t\n\tsort(rule + 1, rule + M + 1);\n\tif(rule[1].p == 1) //Just the first\n\t{\n\t\tif(rule[1].c == 0) f.mat[0][pos(1, 0)] = 1;\n\t\telse               f.mat[0][pos(0, 1)] = 1;\n\t}\n\telse // Not the first\n\t\tf.mat[0][pos(1, 0)] = f.mat[0][pos(0, 1)] = 1;\n\t\n\tlong long pre = 1; // Start from the first\n\tfor(long long i = 1; i <= M; ++ i)\n\t{\n\t\tif(rule[i].p == 1) continue;\n\t\tif(pre < rule[i].p - 1) // In\n\t\t\tf = f * fastpow(base, rule[i].p - 1 - pre);\n\t\t\t\n\t\tlong long tf[15];\n\t\tmemset(tf, 0, sizeof(tf));\n\t\tbool a, b;\n\t\ta = b = true;\n\t\tif(rule[i].c == 0) a = false;\n\t\telse b = false;\n\t\tfor(long long j = 0; j <= 1; ++ j)\n\t\t\tfor(long long k = 0; k <= 2; ++ k)\n\t\t\t\ttf[pos(j, k)] = (a * f.mat[0][pos(j, (k + 2 - j) % 3)] + b * f.mat[0][pos(!j, k)]) % MOD;\n\t\t\t\t\n\t\tfor(long long j = 0; j <= 5; ++ j)\n\t\t\tf.mat[0][j] = tf[j]; \n\t\t\t\n\t\tpre = rule[i].p;\n\t}\n\t\n\tif(pre != N) // Force!!!\n\t\tf = f * fastpow(base, N - pre);\n\t\t\n\tcout << (f.mat[0][pos(0, 1)] + f.mat[0][pos(0, 2)]) % MOD << endl;\n\treturn 0;\n}\n```\n\n# \u540e\u8a00\n\n\u8fd9\u9898\u601d\u7ef4\u96be\u5ea6\u96c0\u98df\u6bd4\u8f83\u5927\uff0c\u5e0c\u671b\u8bfb\u8005\u597d\u597d\u6d88\u5316\u3002",
        "postTime": 1654083366,
        "uid": 224558,
        "name": "JackMerryYoung",
        "ccfLevel": 5,
        "title": "P6734 \u300cWdsr-2\u300d\u9634\u9633\u7389 \u9898\u89e3"
    }
]