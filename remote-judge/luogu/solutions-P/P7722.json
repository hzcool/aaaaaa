[
    {
        "content": "\u9996\u5148\u8fd9\u4e2a\u95ee\u9898\u592a\u8be1\u5f02\u4e86\uff0c\u6211\u4eec\u628a\u95ee\u9898\u770b\u4f5c\u53ef\u4ee5\u5bf9 $a$\uff0c$b$\uff0c$c$ \u90fd\u5355\u70b9\u4fee\u6539\u3002\u8981\u6c42 $i < j < k$ \u7684 $b_i = a_j = c_k$ \u7684\u5bf9\u6570\u3002\n\n\u8003\u8651\u5bf9\u4e8e $b_i = a_j = c_k = w$ \u7684 $w$ \u8fdb\u884c\u6839\u53f7\u5206\u6cbb\u3002\u8003\u8651 $w$ \u5728 $a,b,c$ \u4e2d\u7684\u603b\u51fa\u73b0\u6b21\u6570\u3002\n\n- \u5bf9\u4e8e\u51fa\u73b0\u4e86 $< B$ \u6b21\u7684\u6570\uff0c\u6bcf\u6b21\u5bf9\u8fd9\u4e2a\u6570\u8fdb\u884c\u4fee\u6539\u7684\u65f6\u5019\u66b4\u529b DP\uff0c\u5728 $k$ \u5904\u52a0\u5373\u53ef\u3002\n\n- \u5bf9\u4e8e\u51fa\u73b0\u4e86 $\\ge B$ \u6b21\u7684\u6570\uff0c\u8fd9\u6837\u7684\u6570\u53ea\u6709 $\\Theta(\\frac{n+q}{B})$ \u4e2a\u3002\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a\u6570\u7ef4\u62a4\u4e2a\u52a8\u6001 DP \u5373\u53ef\u3002\n\n\u53d6 $B = \\Theta(\\sqrt{n+q})$\uff0c\u8fd9\u4e24\u79cd\u60c5\u51b5\u90fd\u5bb9\u6613\u5e73\u8861\u5230\u5355\u6b21 $\\Theta(\\sqrt{n+q})$\uff0c\u6240\u4ee5\u8fd9\u79cd\u505a\u6cd5\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\Theta(q \\sqrt{n+q})$\u3002\n\n\u76ee\u524d\u662f Luogu \u6700\u4f18\u89e3\u3002",
        "postTime": 1645230317,
        "uid": 173660,
        "name": "zhoukangyang",
        "ccfLevel": 0,
        "title": "P7722 tmpq"
    },
    {
        "content": "> \u8ffd\u61b6\u3082\u865a\u3057\u3044\u3060\u3051  \n\u305d\u306e\u6df5\u306b\u4f55\u3082\u7121\u3044\u306a\u3089\u2026  \n\u7d42\u7109\u306e\u679c\u3066\u306b\u7720\u308d\u3046  \n\u3053\u306e\u624b\u306e\u60b2\u5287\u3092\u3000\u62b1\u3044\u3066  \n\u300aSeclusion\u300bby Laur feat. Sennzai\n\n## Brute Force\n\u9996\u5148\u8003\u8651\u4e00\u4e2a\u66b4\u529b\uff0c\u5148\u6c42\u51fa\u4e8c\u5143\u7ec4 $(i,j)$ \u6570\u91cf\uff0c\u518d\u6c42\u51fa $(i,j,k)$ \u6570\u91cf\uff0c\u6700\u540e\u6c42\u548c\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u5355\u6b21 $O(n)$\u3002\n## Solution\n\u76f4\u63a5\u8be2\u95ee\u5206 $\\sqrt m$ \u5757\uff0c\u7136\u540e\u6bcf\u6b21\u4f1a\u6709 $O(n)$ \u4e2a\u4f1a\u88ab\u4fee\u6539\u7684\u6570\u548c $O(\\sqrt m)$ \u4e2a\u4e0d\u4f1a\u88ab\u4fee\u6539\u7684\u6570\u3002\n\n\u4e8e\u662f\u8fd9\u6837\u4e09\u5143\u7ec4\u6839\u636e\u662f\u4e0d\u662f\u4f1a\u88ab\u4fee\u6539\u7684\u6570\u5c31\u5206\u6210\u4e86 $8$ \u7c7b\uff0c\u8003\u8651\u76f4\u63a5\u66b4\u529b\u679a\u4e3e\u3002\n\n\u9996\u5148\u6211\u4eec\u5148\u8bd5\u8bd5\u66b4\u529b\u80fd\u5904\u7406\u4ec0\u4e48 Case\u3002\n## Case 1\n\u9996\u5148\u5168\u662f\u9759\u6001\u5c31\u76f4\u63a5\u6bcf\u6b21\u9884\u5904\u7406\u7136\u540e\u76f4\u63a5\u67e5\u8be2\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt m)$\u3002\n## Case 2\n\u7136\u540e\u5982\u679c\u5168\u662f\u52a8\u6001\u7684\u8bdd\u5c31\u6bcf\u4e2a\u8be2\u95ee\u63d0\u53d6\u8fd9\u4e9b\u4f4d\u7f6e\u8dd1\u4e00\u904d\u66b4\u529b\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(m\\sqrt m)$\u3002\n## Case 3\n\u5982\u679c\u53ea\u6709 $k$ \u662f\u52a8\u6001\u7684\u8bdd\u76f4\u63a5\u8003\u8651\u626b\u4e00\u904d\u7ef4\u62a4 $(i,j)$ \u7684\u6570\u5bf9\u6570\u91cf\u7684\u8fc7\u7a0b\u4e2d\u6c42\uff0c\u626b\u5230\u8fd9 $\\sqrt m$ \u4e2a\u503c\u7684\u65f6\u5019\u5bf9\u4e8e $\\sqrt m$ \u4e2a\u8be2\u95ee\u4f9d\u6b21\u5c06\u8d21\u732e\u52a0\u4e0a\u53bb\u5c31\u53ef\u4ee5\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt m+m\\sqrt m)$\u3002\n## Case 4~6\n\u5982\u679c $i,j$ \u6216\u8005 $j$ \u6216\u8005 $j,k$ \u662f\u52a8\u6001\u7684\u8bdd\uff0c\u6211\u4eec\u5148\u7edf\u8ba1 $(i,j)$ \u4e8c\u5143\u7ec4\u7684\u6570\u91cf\uff0c\u4e8e\u662f\u95ee\u9898\u53d8\u6210\u4e86\u6c42\u9759\u6001\u5e8f\u5217\u7684\u4e00\u4e2a\u524d\u7f00\u4e2d\u67d0\u4e2a\u6570\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u5927\u529b\u79bb\u7ebf\u8be2\u95ee\u6700\u540e\u626b\u4e00\u904d\u5c31\u884c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt m+m\\sqrt m)$\u3002\n## Case 7\n\u5982\u679c $i,k$ \u662f\u52a8\u6001\u7684\u8bdd\uff0c\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u6bd4\u8f83\u96be\u7b97\u3002\u4f46\u662f\u8fd9\u4e24\u4e2a\u4e1c\u897f\u5176\u5b9e\u5f88\u597d\u7b97\uff1a\n\n* $b_{a_i}=a_j=c_{a_k}$\uff0c$i,k$ \u52a8\u6001\uff0c$i<k$\uff0c$j<k$\uff0c$i,j$ \u4e4b\u95f4\u987a\u5e8f\u4e0d\u505a\u8981\u6c42\u3002\n* $a_i=b_{a_j}=c_{a_k}$\uff0c$j,k$ \u52a8\u6001\uff0c$i<j<k$\u3002\n\n\u4e8e\u662f\u76f8\u51cf\u4e00\u4e0b\u5c31\u7b97\u597d\u4e86\u3002\n## Case 7-1\n\u8fd9\u4e2a\u53ef\u4ee5\u5148\u7b97 $i$ \u7684\u6570\u91cf\uff0c\u7136\u540e $j$ \u7684\u6570\u91cf\u79bb\u7ebf\u8ba1\u7b97\u3002\n## Case 7-2\n\u8fd9\u4e2a\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a $j$ \u7b97\u597d $(i,j)$ \u7684\u6570\u91cf\uff0c\u7136\u540e\u626b\u4e00\u904d\u53bb\u7b97 $k$ \u626b\u5230\u524d\u9762\u7684 $j$ \u7684\u8d21\u732e\u3002\n## Case 8\n\u5982\u679c $i$ \u662f\u52a8\u6001\u7684\u8bdd\uff0c\u6211\u4eec\u76f8\u5f53\u4e8e\u8981\u5728 $O(n)$ \u7684\u65f6\u95f4\u5185\u7b97 $O(n)$ \u4e2a\u67e5\u8be2 $[l,r]$ \u5185\u6709\u591a\u5c11 $(i,j)$ \u6ee1\u8db3 $i<j,val=a_i=c_{a_j}$\u3002  \n\n\u7136\u540e\u6211\u4eec\u628a\u8fd9\u4e2a\u4e1c\u897f\u8f6c\u5316\u6210 $[1,r]$ \u7684\u8d21\u732e\u51cf\u53bb $[1,l-1]$ \u7684\u8d21\u732e\u51cf\u53bb $i<l,j\\in[l,r]$ \u7684\u8d21\u732e\uff0c\u5c31\u662f\u7b54\u6848\u4e86\uff0c\u4e8e\u662f\u6211\u4eec\u7ee7\u7eed\u5927\u529b\u79bb\u7ebf\u3002\n## Case 8-1\n$[1,r]$ \u7684\u8d21\u732e\u975e\u5e38\u5e73\u51e1\uff0c\u76f4\u63a5\u626b\u4e00\u904d\u5c31\u884c\u4e86\u3002\n## Case 8-2\n\u540e\u9762\u90a3\u90e8\u5206\u7684\u8d21\u732e\u6211\u4eec\u628a\u4e24\u4e2a\u7684\u65b9\u6848\u6570\u5206\u5f00\u7edf\u8ba1\uff0c\u6700\u540e\u4e58\u5230\u4e00\u8d77\u52a0\u5230\u7b54\u6848\u91cc\u5c31\u884c\u4e86\u3002\n## Code\n\u4e0d\u4f1a\u771f\u7684\u6709\u4eba\u770b\u4ee3\u7801\u5427\uff1f\uff1f\uff1f\n\n\u6211\u8fd9\u8f88\u5b50\u90fd\u4e0d\u4f1a\u518d\u52a8\u8fd9\u4efd\u4ee3\u7801\u4e86\uff0c\n\n```cpp\n//And in that light,I find deliverance.\n//This code is written by Yiran Empty.\n#pragma GCC optimize(\"Ofast\")\n#pragma GCC optimize(\"unroll-loops\")\n#pragma GCC target(\"sse,sse2,sse3,ssse3,sse4,popcnt,abm,mmx,avx,avx2,tune=native\")\n#include<bits/stdc++.h>\n#undef local\n#define ll long long\nusing namespace std;\ninline int read(){\n   int s=0,w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n   return s*w;\n}\nint n=read(),m=read(),k;\nint a[200003],b[200003],c[200003];\nint B[200003],C[200003],cnt[200003],tnc[200003],ntc[200003];\nint tv[200003];\nll v[200003],pre[200003],sum[200003];\nconst int S=230;\nint op[233],x[233],y[233];\nint f[200003];\n//\u8fd9\u4e2a\u4f4d\u7f6e\u662f\u5426\u53ef\u53d8\nint pos[233],len,qs;\n//\u53ef\u53d8\u4f4d\u7f6e\u96c6\u5408\uff0c\u8be2\u95ee\u4e2a\u6570\nint tA[233],tB[233],tC[233],r[233];\nint ta[233][233],tb[233][233],tc[233][233],tf[233][233];\nll ans[233];\n//\u6bcf\u4e2a\u8be2\u95ee\u4f4d\u7f6e\u5bf9\u5e94\u503c\u7684\u96c6\u5408\nstruct node{int id,val,mul;};\nvector<node> qb[200003],qc[200003],qd[200003],qp[200003],qA[200003],qC[200003];\n#ifdef local\nvector<node> qcc[200003];\n#endif\nint ca[200003],cb[200003],cc[200003],cd[200003];\nint resA[100003],resC[100003],resid[100003],rescnt;\ninline void make_query(int id,int val,int l,int r)\n{\n\t(l<r)&&(\n\tqp[r].push_back((node){id,val,1}),qp[l-1].push_back((node){id,val,-1}),\n\t++rescnt,resid[rescnt]=id,resA[rescnt]=resC[rescnt]=0,\n\tqA[l-1].push_back((node){rescnt,val,1}),\n\tqC[r].push_back((node){rescnt,val,1}),qC[l-1].push_back((node){rescnt,val,-1}),0);\n\treturn ;\n}\n#ifdef local\nll Ans[233][8];\n#endif\nint qwq[200003];\ninline void fyyakioi(vector<node>&t){vector<node>g;swap(t,g);return ;}\nvoid solve()\n{\n#ifdef local\n\tmemset(Ans,0,sizeof(Ans));\n#endif\n\tmemset(qwq,0,sizeof(qwq));\n\t//Init\n\tmemset(f,0,sizeof(f)),len=0,rescnt=0,qs=0;\n\tint tmp=0;\n\tfor(int i=1; i<=k; ++i) (op[i]==1&&!f[x[i]])&&(f[x[i]]=1,pos[++len]=x[i]);\n\tfor(int i=1; i<=n; ++i) (f[i])&&(f[i]=++tmp);\n\tsort(pos+1,pos+len+1);\n\tfor(int i=1; i<=len; ++i) tA[i]=a[pos[i]],tB[i]=B[pos[i]],tC[i]=C[pos[i]];\n\tfor(int i=1; i<=k; ++i) \n\t\tif(op[i]==1) tA[f[x[i]]]=y[i],tB[f[x[i]]]=b[y[i]],tC[f[x[i]]]=c[y[i]];\n\t\telse {r[++qs]=x[i],ans[qs]=0;for(int j=1; j<=len; ++j)ta[qs][j]=tA[j],tb[qs][j]=tB[j],tc[qs][j]=tC[j];}\n\t//Case 1 S S S\n\t//Case 2 S S D\n\t//Case 3 S D S (Queries making)\n\tfor(int i=1; i<=n; ++i) \n#ifdef local\n\t\tfyyakioi(qp[i]),\n#endif\n\t\tfyyakioi(qb[i]),fyyakioi(qc[i]),fyyakioi(qd[i]),fyyakioi(qp[i]),fyyakioi(qA[i]),fyyakioi(qC[i]); \n\tmemset(cnt,0,sizeof(cnt)),memset(sum,0,sizeof(sum));\n\tfor(int i=1,id=0; i<=n; ++i) \n\t{\n\t\tpre[i]=pre[i-1];\n\t\tif(f[i])\n\t\t{\n\t\t\t++id;\n\t\t\tfor(int j=1; j<=qs; ++j) \n\t\t\ttf[j][id]=qwq[tb[j][id]],\n#ifdef local\n\t\t\t(r[j]>=i)&&(qcc[r[j]].push_back((node){j,ta[j][id],cnt[ta[j][id]]}),\n\t\t\tqcc[i].push_back((node){j,ta[j][id],-cnt[ta[j][id]]}),\n\t\t\tAns[j][1]+=sum[tc[j][id]]\n#else\n\t\t\t(r[j]>=i)&&(qc[r[j]].push_back((node){j,ta[j][id],cnt[ta[j][id]]}),\n\t\t\tqc[i].push_back((node){j,ta[j][id],-cnt[ta[j][id]]}),\n\t\t\tans[j]+=sum[tc[j][id]]\n#endif\n\t\t\t);\n\t\t}\n\t\telse v[i]=cnt[a[i]],++qwq[a[i]],++cnt[B[i]],pre[i]+=sum[C[i]],sum[a[i]]+=v[i];\n\t}\n\tfor(int i=1; i<=qs; ++i) \n#ifdef local\n\t\tAns[i][0]+=pre[r[i]];\n#else\n\t\tans[i]+=pre[r[i]];\n#endif\n\t//Case 4 D D D\n\t//Case 5 D D S (Queries making)\n\t//Case 6 S D D (Queries making)\n\t//Case 7 D S D (Part 1)\n\t//Case 7 D S D (Part 2 queries making)\n\t//Case 8 D S S (Queries making)\n\tfor(int i=1; i<=qs; ++i) \n\t{\n\t\tfor(int j=1; pos[j]<=r[i]&&j<=len; ++j) \n\t\t\tcnt[ta[i][j]]=cnt[tb[i][j]]=0,\n\t\t\tsum[ta[i][j]]=sum[tc[i][j]]=0,\n\t\t\tntc[tb[i][j]]=ntc[tc[i][j]]=0,\n\t\t\ttnc[tb[i][j]]=tnc[tc[i][j]]=0;\n\t\tint R=0;\n\t\tfor(int j=1; pos[j]<=r[i]&&j<=len; ++j) \n\t\t\tmake_query(i,tb[i][j],pos[j]+1,r[i]),\n\t\t\tR=j,tv[j]=cnt[ta[i][j]],\n\t\t\t(ntc[tc[i][j]])&&(qd[pos[j]].push_back((node){i,tc[i][j],ntc[tc[i][j]]}),0),\n\t\t\t(tv[j])&&(qc[r[i]].push_back((node){i,ta[i][j],tv[j]}),\n\t\t\tqc[pos[j]].push_back((node){i,ta[i][j],-tv[j]}),0),\n#ifdef local\n\t\t\tAns[i][6]-=tnc[tc[i][j]],\n\t\t\tAns[i][3]+=sum[tc[i][j]],\n#else\n\t\t\tans[i]-=tnc[tc[i][j]],\n\t\t\tans[i]+=sum[tc[i][j]],\n#endif\n\t\t\ttnc[tb[i][j]]+=tf[i][j],\n\t\t\t++cnt[tb[i][j]],++ntc[tb[i][j]],\n\t\t\tsum[ta[i][j]]+=tv[j];\n\t\tfor(int j=1; j<=R; ++j) cnt[ta[i][j]]=cnt[tc[i][j]]=0;\n\t\tfor(int j=R; j>=1; --j) \n\t\t\t(cnt[ta[i][j]])&&(qb[pos[j]-1].push_back((node){i,ta[i][j],cnt[ta[i][j]]}),0),\n\t\t\t++cnt[tc[i][j]];\n\t}\n\t//Case 3 S D S (Queries answering)\n\t//Case 5 D D S (Queries answering)\n\t//Case 6 S D D (Queries answering)\n\t//Case 7 D S D (Part 2 queries answering)\n\t//Case 8 D S S (Queries answering)\n\tmemset(ca,0,sizeof(ca)),memset(cb,0,sizeof(cb)),\n\tmemset(cc,0,sizeof(cc)),memset(cd,0,sizeof(cd));\n\tmemset(sum,0,sizeof(sum));\n\tfor(int i=1; i<=n; ++i)\n\t{\n\t\t(!f[i])&&(sum[C[i]]+=ca[C[i]],++ca[a[i]],++cb[B[i]],++cc[C[i]]);\n#ifdef local\n\t\tfor(auto j:qb[i]) Ans[j.id][5]+=1ll*cb[j.val]*j.mul;\n\t\tfor(auto j:qc[i]) Ans[j.id][4]+=1ll*cc[j.val]*j.mul;\n\t\tfor(auto j:qd[i]) Ans[j.id][6]+=1ll*ca[j.val]*j.mul;\n\t\tfor(auto j:qp[i]) Ans[j.id][7]+=1ll*sum[j.val]*j.mul;\n\t\tfor(auto j:qcc[i])Ans[j.id][2]+=1ll*cc[j.val]*j.mul;\n#else\n\t\tfor(auto j:qb[i]) ans[j.id]+=1ll*cb[j.val]*j.mul;\n\t\tfor(auto j:qc[i]) ans[j.id]+=1ll*cc[j.val]*j.mul;\n\t\tfor(auto j:qd[i]) ans[j.id]+=1ll*ca[j.val]*j.mul;\n\t\tfor(auto j:qp[i]) ans[j.id]+=1ll*sum[j.val]*j.mul;\n#endif\n\t\tfor(auto j:qA[i]) resA[j.id]+=ca[j.val]*j.mul;\n\t\tfor(auto j:qC[i]) resC[j.id]+=cc[j.val]*j.mul;\n\t}\n#ifdef local\n\tfor(int i=1; i<=rescnt; ++i) Ans[resid[i]][7]-=1ll*resA[i]*resC[i];\n#else\n\tfor(int i=1; i<=rescnt; ++i) ans[resid[i]]-=1ll*resA[i]*resC[i];\n#endif\n\t//Update & output\n\tfor(int i=1; i<=k; ++i) (op[i]==1)&&(a[x[i]]=y[i],B[x[i]]=b[y[i]],C[x[i]]=c[y[i]]);\n#ifdef local\n\tfor(int i=1; i<=qs; ++i,puts(\"\")) \n\tfor(int j=0; j<8; ++j) printf(\"%lld \",Ans[i][j]);\n#else\n\tfor(int i=1; i<=qs; ++i) printf(\"%lld\\n\",ans[i]);\n#endif\n\treturn ;\n}\nsigned main()\n{\n\tfor(int i=1; i<=n; ++i) a[i]=read();\n\tfor(int i=1; i<=n; ++i) b[i]=read();\n\tfor(int i=1; i<=n; ++i) c[i]=read();\n\tfor(int i=1; i<=n; ++i) B[i]=b[a[i]],C[i]=c[a[i]];\n\tfor(int i=1; i<=m; ++i) op[++k]=read(),x[k]=read(),(op[k]==1)&&(y[k]=read()),(k==S)&&(solve(),k=0);\n\tif(k) solve();\n\treturn 0;\n}\n```",
        "postTime": 1631010603,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P7722"
    },
    {
        "content": "**sol of tmpq**\n\n[link](https://www.luogu.com.cn/problem/P7722)\n\n\u4ee4\u539f\u6765\u7684 $b,c$ \u5e8f\u5217\u4e3a $b',c'$\uff0c\u800c $b_i = b'_{a_i},c_i = c'_{a_i}$\u3002\u663e\u7136\u64cd\u4f5c $1$ \u7b49\u4e8e\u4fee\u6539\u8be5\u4f4d\u7f6e\u4e0a\u7684\u989c\u8272\uff0c\u67e5\u8be2 $2$ \u53d8\u6210\u4e86\u6570\u524d\u7f00\u4e09\u5143\u5c0f Z \u7684\u889c\u5b50\u3002\n\n\u5176\u5b9e\u601d\u8def\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\uff1a\u8003\u8651\u6839\u53f7\u5206\u6cbb\u6bcf\u4e2a\u989c\u8272\u5728\u6240\u6709\u64cd\u4f5c\u5305\u62ec\u521d\u59cb\u72b6\u6001\u5185\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u5982\u679c $|c| \\leq B$\uff0c\u6211\u4eec\u6bcf\u6b21\u66b4\u529b\u8dd1\u4e00\u4e2a\u7ebf\u6027 dp\uff0c\u90a3\u4e48\u88ab\u540c\u4e00\u79cd\u989c\u8272 $c$ \u8d21\u732e\u7684\u80af\u5b9a\u662f\u82e5\u5e72\u4e2a\u8fde\u7eed\u6bb5\uff0c\u4e14\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u4e0a\u8d21\u732e\u7684\u503c\u76f8\u540c\uff0c\u7528\u652f\u6301\u533a\u95f4\u52a0\u5355\u70b9\u67e5\u7684\u4e0d\u5e73\u8861\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\uff0c\u8fd9\u4e2a\u6bcf\u6b21\u64cd\u4f5c\u662f $O(B)$ \u7684\u3002\n\n\u5982\u679c $|c| > B$\uff0c\u5982\u679c\u8be5\u6b21\u4fee\u6539\u5f71\u54cd\u5230\u4e86\u8be5\u79cd\u989c\u8272\uff0c\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a\u52a8\u6001 dp\uff0c\u652f\u6301\u4e0d\u5e73\u8861\u7684\u5355\u70b9\u4fee\u6539\u53ca\u533a\u95f4\u5408\u5e76\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\frac{n + q}{B} \\times (n + q) + q(\\frac{n}{B} + B))$ \u6bcf\u4e2a\u989c\u8272\u90fd\u904d\u5386\u6240\u6709\u8be2\u95ee\u7136\u540e\u53ea\u88ab\u6709\u5f71\u54cd\u7684\u64cd\u4f5c\u4fee\u6539\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002\n\n\u4ee4 $B = \\sqrt {n + q}$\uff0c\u4e24\u90e8\u5206\u90fd\u91c7\u7528\u5206\u5757\u7ef4\u62a4\uff0c$|c| \\leq B$ \u7684\u91c7\u7528 $O(1)$ \u533a\u95f4\u52a0 $O(\\sqrt {n})$ \u5355\u70b9\u4fee\u6539\u7684\u5206\u5757\uff1b$|c| > B$ \u7684\u91c7\u7528 $O(\\sqrt {n})$ \u5355\u70b9\u4fee\u6539 $O(1)$ \u4e8c\u533a\u95f4\u5408\u5e76\u7684\u5206\u5757\u7ef4\u62a4\u3002\n\n\u6ce8\u610f\u5b9e\u73b0\u7684\u7ec6\u8282\uff0c\u5982\u679c\u5728\u968f\u673a\u6570\u636e\u62cd\u4e0d\u51fa\u6765\u7684\u60c5\u51b5\u4e0b\u53ea\u88ab\u5361 wa \u53ef\u80fd\u662f ll \u6ca1\u5f00\u591f\uff1b\u4ee5\u53ca dp \u65f6\u8981\u6bcf\u4e2a\u4f4d\u7f6e\u7684 $a,b,c$ \u4e00\u8d77\u66f4\u65b0\uff1b\u5efa\u8bae\u8fb9\u64cd\u4f5c\u539f\u5e8f\u5217\u8fb9\u505a $|c| \\leq B$ \u548c $|c| > B$ \u8fd9\u4e24\u4e2a\u95ee\u9898\u3002\n\n\u7a7a\u95f4\u5e38\u6570\u5f88\u5927\uff0c\u8bf7\u6ce8\u610f\u5c11\u5f00\u70b9\u6570\u7ec4\u4ee5\u9632\u88ab\u5361\u5e38\u3002\n\n\u7ed9\u51fa $|c| \\leq B$ \u7684\u90e8\u5206\u4f9b\u53c2\u8003\uff1a\n\n```cpp\nstruct block2\n{\n\tint sizt,t,blk[Len],L[Len],R[Len];ll aa[Len],ta[SIZE];\n\tll s102[SIZE],s10[SIZE];int pre[Len][3];\n    \t//\u6570\u7ec4\u7684\u542b\u4e49\u5982\u6570\u7ec4\u540d\n\tinline void init()//\u5206\u5757\n\t{\n\t\tint LL = 1 , RR = 0;\n\t\twhile(LL <= n)\n\t\t{\n\t\t\tRR = min(n , LL + t - 1);sizt ++;\n\t\t\tfor(int j = LL ; j <= RR ; j ++) blk[j] = sizt;\n\t\t\tL[sizt] = LL , R[sizt] = RR;\n\t\t\tLL = RR + 1; \n\t\t}\n\t}\n\tinline void upd(int x,ll w){aa[x] += w , ta[blk[x]] += w;}\n\tinline void qupd(int l,int r,ll w){if(l > r || l < 0 || r > n) return;upd(r , w) , upd(l - 1 , -w);}//\u533a\u95f4\u52a0\n\tinline void dag(int cl)\n\t{\n\t\tfor(int i = 0 ; i < (int)upl[cl].size() ; i ++) qupd(upl[cl][i].l , upl[cl][i].r , -upl[cl][i].idx);//\u5f53\u524d\u989c\u8272\u7684\u51fa\u73b0\u60c5\u51b5\u6709\u6240\u4fee\u6539\uff0c\u64a4\u9500\u4e0a\u4e00\u6b21\u7684\u8d21\u732e\n\t\tvector<ELE> fl;swap(fl , upl[cl]);ELE now;int lstu = 0 , lstadp = 0;ll lstadw = -1;\n\t\tfor(int i = 1 ; i <= (int)vt[cl].size() ; i ++) \n\t\t{\n\t\t\tnow = vt[cl][i - 1];s102[i] = s102[i - 1] , s10[i] = s10[i - 1] , pre[i][0] = pre[i - 1][0] , pre[i][1] = pre[i - 1][1] , pre[i][2] = pre[i - 1][2];\n\t\t\tif(now.l > nt || now.r < nt) continue;\n\t\t\tif(lstu == now.idx) continue;\n\t\t\tlstu = now.idx;\n\t\t\tif(c[lstu] == cl)\n\t\t\t{\n\t\t\t\tpre[i][2] ++;\n\t\t\t\ts102[i] += s10[i - 1];\n\t\t\t}\n\t\t\tif(a[lstu] == cl)\n\t\t\t{\n\t\t\t\tpre[i][0] ++;\n\t\t\t\ts10[i] += pre[i - 1][1];\n\t\t\t}\n\t\t\tif(b[lstu] == cl) pre[i][1] ++;\n\t\t\tif(!lstadp)\n\t\t\t{\n\t\t\t\tlstadp = now.idx;\n\t\t\t\tlstadw = s102[i];\n\t\t\t}\n\t\t\tif(lstadw != -1 && lstadw != s102[i]) \n\t\t\t{\n\t\t\t\tqupd(lstadp , now.idx - 1 , lstadw) , upl[cl].push_back(ELE(0 , lstadp , now.idx - 1 , lstadw));\n\t\t\t\tlstadp = now.idx , lstadw = s102[i];\n\t\t\t}\n\t\t}\n\t\tconst int sz = (int)vt[cl].size();\n\t\tif(lstadw != -1) qupd(lstadp , n , lstadw) , upl[cl].push_back(ELE(0 , lstadp , n , lstadw)); \n\t\tconst int SZ = (int)upl[cl].size();\n\t}//\u7ef4\u62a4\u6bcf\u4e2a\u989c\u8272\u6bb5\u5904\u7684\u8d21\u732e\n\tinline ll qry(int x)\n\t{\n\t\tll res = 0;\n\t\tfor(int i = x ; i <= R[blk[x]] ; i ++) res += aa[i];\n\t\tfor(int i = blk[x] + 1 ; i <= sizt ; i ++) res += ta[i];\n\t\treturn res; \n\t}//\u67e5\u8be2\u5355\u70b9\n}B2;\n```\n\n\u7ed9\u51fa $|c| > B$ \u7684\u90e8\u5206\u4f9b\u53c2\u8003\uff1a\n\n```cpp\nstruct block1\n{\n\tint sizt,t;\n\tll s102[SIZE],s10[SIZE];int s1[SIZE],blk[Len],L[Len],R[Len];\n\tint pre[Len][3],p102[Len],p10[Len],p02[Len];\n\tint pr[3],o102,o10,o02;\n    \t//\u6570\u7ec4\u7684\u542b\u4e49\u5982\u6570\u7ec4\u540d\n   \t/*\n        102+\n        10+2\n        1+02\n        +102\n        \u4e8c\u533a\u95f4\u5408\u5e76\u65f6\u7684\u56db\u79cd\u8d21\u732e\uff0c\u5bf9\u5e94\u6574\u5757\u548c\u6563\u5757\u8981\u7ef4\u62a4\u7684\u4fe1\u606f\n  \t*/\n\tinline void Init()//\u5206\u5757\n\t{\n\t\tint LL = 1 , RR = 0;\n\t\twhile(LL <= n)\n\t\t{\n\t\t\tRR = min(n , LL + t - 1);sizt ++;\n\t\t\tfor(int j = LL ; j <= RR ; j ++) blk[j] = sizt;\n\t\t\tL[sizt] = LL , R[sizt] = RR;\n\t\t\tLL = RR + 1; \n\t\t}\n\t}\n\tinline void UPDB(int t)//\u5bf9\u7b2c t \u4e2a\u5757\u91cd\u65b0\u8dd1\n\t{\n\t\tfor(int j = L[t] ; j <= R[t] ; j ++)\n\t\t{\n\t\t\tif(j != L[t])\n\t\t\t{\n\t\t\t\tpr[0] = pre[j - 1][0] , pr[1] = pre[j - 1][1] , pr[2] = pre[j - 1][2];\n\t\t\t\to102 = p102[j - 1] , o10 = p10[j - 1] , o02 = p02[j - 1];\n\t\t\t}\n\t\t\telse pr[0] = pr[1] = pr[2] = o102 = o10 = o02 = 0;\n\t\t\tpre[j][0] = pr[0] , pre[j][1] = pr[1] , pre[j][2] = pr[2] , p102[j] = o102 , p10[j] = o10 , p02[j] = o02;\n\t\t\tif(c[j] == acl)\n\t\t\t{\n\t\t\t\tpre[j][2] ++;\n\t\t\t\tp02[j] += pr[0];\n\t\t\t\tp102[j] += o10;\n\t\t\t}\n\t\t\tif(a[j] == acl) \n\t\t\t{\n\t\t\t\tpre[j][0] ++;\n\t\t\t\tp10[j] += pr[1];\t\n\t\t\t} \n\t\t\tif(b[j] == acl) pre[j][1] ++;\n\t\t}\n\t}\n\tinline void UPDTB(int l,int r)//\u5bf9\u4e8e\u7b2c l ~ r \u4e2a\u5757\u7684\u6574\u5757\u524d\u7f00\u4fe1\u606f\u91cd\u65b0\u5904\u7406\n\t{\n\t\tfor(int j = l ; j <= r ; j ++)\n\t\t{\n\t\t\ts102[j] = s102[j - 1] , s10[j] = s10[j - 1] , s1[j] = s1[j - 1];\n\t\t\ts102[j] += s10[j - 1] * pre[R[j]][2] + 1ll * s1[j - 1] * p02[R[j]] + p102[R[j]];\n\t\t\ts10[j] += p10[R[j]] + 1ll * s1[j - 1] * pre[R[j]][0];\n\t\t\ts1[j] += pre[R[j]][1];\t\n\t\t}\n\t}\n\tinline void upd(int x)//\u8be5\u4f4d\u7f6e\u88ab\u4fee\u6539\u5f71\u54cd\u5230\u4e86\u5f53\u524d\u989c\u8272\n\t{\n\t\tUPDB(blk[x]);\n\t\tUPDTB(blk[x] , sizt);\n\t}\n\tinline ll qry(int x){return s102[blk[x] - 1] + s10[blk[x] - 1] * pre[x][2] + 1ll * s1[blk[x] - 1] * p02[x] + p102[x];}//\u67e5\u8be2\n\tinline void init()\n\t{\n\t\tfor(int i = 1 ; i <= sizt ; i ++) UPDB(i);\n\t\tUPDTB(1 , sizt);\t\n\t}\n}B1; \n```\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u7c97\u7565\u6765\u7b97\u662f $O(n \\sqrt {n + q})$ \u7684\uff0c\u7a7a\u95f4\u7ebf\u6027\u3002",
        "postTime": 1674788916,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "\u6df1\u85cf\u7684\u79d8\u5bc6\u662f\u5728\u4e45\u8fdc\u7684\u4ece\u524d \u4e92\u76f8\u8bb8\u4e0b\u7684\u8a93\u7ea6"
    },
    {
        "content": "~~\u5e73\u51e1\u7b11\u8bdd\uff1a\u8fd9\u9898\u662f\u5e73\u51e1\u7684~~\n\n\u8003\u8651\u5e8f\u5217\u5206\u5757\u3002\u90a3\u4e48\u4e00\u4e2a\u524d\u7f00\u5c31\u53d8\u6210\u4e86\u6574\u5757\u524d\u7f00\u548c\u6563\u5757\u3002\n\n\u8fd9\u4e2a\u9898\u76ee\u6761\u4ef6\u770b\u8d77\u6765\u5341\u5206\u6076\u5fc3\uff0c\u90a3\u4e48\u8bbe\u539f $b,c$ \u5e8f\u5217\u5206\u522b\u4e3a $B,C$\uff0c\u4ee4 $b_i=B_{a_i},c_i=C_{a_i}$\u3002\n\n\u5bf9\u4e8e\u4e09\u5143\u7ec4 $(i,j,k)$ \u5168\u90e8\u5728\u6574\u5757\u5185\u7684\u56f0\u96be\u5728\u4e8e\u4fee\u6539\u3002\u90a3\u4e48\u67e5\u8be2\u7684\u65f6\u5019\u9700\u8981\u8003\u8651\u7684\u662f\u81f3\u5c11\u6709\u4e00\u4e2a\u5143\u7d20\u5728\u6563\u5757\u5185\u7684\u3002\n\n1.  $i,j,k$ \u5747\u5728\u6563\u5757\u5185\n\n\u8fd9\u4e2a\u7ef4\u62a4\u4e24\u4e2a\u6876\uff0c\u626b\u63cf\u4e00\u904d\u5373\u53ef\u3002\n\n2.  $j,k$ \u5728\u6563\u5757\u5185\n\n\u679a\u4e3e $k$\uff0c\u5bf9\u4e8e\u4e00\u4e2a $k$ \u7684\u8d21\u732e\uff0c\u5c31\u662f\u524d\u9762 $a_j=c_k$ \u7684\u6570\u91cf\u4e58\u4e0a\u6574\u5757\u524d\u7f00\u4e2d $b_i=c_k$ \u7684\u6570\u91cf\uff0c\u8fd9\u4e2a\u5e73\u51e1\u3002\n\n3. $k$ \u5728\u6563\u5757\u5185\n\n\u8003\u8651\u7ef4\u62a4 $presumba_{i,j}$ \u8868\u793a\u524d $i$ \u5757\u4e2d\u4e8c\u5143\u7ec4 $(x,y)$ \u6ee1\u8db3 $b_x=a_y=j$ \u7684\u6570\u91cf\u3002\u8fd9\u4e2a\u5728\u4fee\u6539\u7684\u65f6\u5019\u7ef4\u62a4\u3002\u8fd9\u90e8\u5206\u7684\u8d21\u732e\u901a\u8fc7\u8fd9\u4e2a\u7ef4\u62a4\u5c31\u663e\u7136\u4e86\u3002\n\n\u8003\u8651\u4fee\u6539\u3002\u6211\u4eec\u7684\u5927\u9898\u601d\u8def\u662f\u7ef4\u62a4 $sum_i$ \u8868\u793a\u4e09\u5143\u7ec4\u4e2d $k$ \u5728\u5757 $i$ \u7684\u6570\u91cf\uff0c\u90a3\u4e48\u4e00\u4e2a\u524d\u7f00\u7684\u8d21\u732e\u5c31\u662f $sum$ \u7684\u4e00\u4e2a\u524d\u7f00\u548c\u3002\n\n\u7ef4\u62a4\u9664\u4e86 $sum$ \u4ee5\u5916\u7684\u90fd\u662f\u663e\u7136\u7684\u3002\n\n\u8ba1\u7b97\u4e00\u4e2a\u4f4d\u7f6e\u4fee\u6539\u5bf9 $sum$ \u7684\u8d21\u732e\u3002$a_i$ \u4fee\u6539\u4f1a\u5bfc\u81f4\u540c\u4e00\u4f4d\u7684 $b,c$ \u4fee\u6539\uff0c\u5206\u7c7b\u8ba8\u8bba\uff08$x$ \u5bf9\u5e94\u7684\u6563\u5757\u90fd\u662f\u5e73\u51e1\u7684\uff0c\u4e0d\u5fc5\u8d58\u8ff0\u4e86\uff09\uff0c\u8bbe $x$ \u5728\u7b2c $y$ \u5757\uff1a\n\n1. $b$ \u7684\u8d21\u732e\n\n\u94a6\u5b9a $k$ \u6240\u5728\u5757 $z$\uff0c\u90a3\u4e48\u8ba1\u7b97\u4e8c\u5143\u7ec4 $(j,k)$\uff0c$k\\in z$ \u7684\u4e2a\u6570\u3002$j$ \u5728 $[x,z-1)$ \u4e2d\u90fd\u662f\u5e73\u51e1\u7684\u3002\u7ef4\u62a4\u6bcf\u5757\u5185 $a$ \u7684\u8ba1\u6570\u5373\u53ef\u3002\u8003\u8651 $j$ \u5728\u5757 $z$ \u5185\u7684\u60c5\u51b5\u3002\u8fd9\u90e8\u5206\u7ef4\u62a4\u4e00\u4e2a $pre_{i,j}$ \u8868\u793a\u5757 $i$ \u4e2d\u4e8c\u5143\u7ec4 $(x,y)$ \u6ee1\u8db3 $a_x=c_y=j$ \u7684\u6570\u91cf\u3002\u90a3\u4e48\u8d21\u732e\u5c31\u662f $pre_{z,b_x}$\u3002\n\n2. $a$ \u7684\u8d21\u732e\n\n\u8fd9\u4e2a\u5e73\u51e1\u3002\u5757 $i$ \u5185\u7684\u8d21\u732e\u663e\u7136\u662f\u8fd9\u5757\u5185 $c=a_x$ \u7684\u6570\u91cf\u4e58\u4e0a\u524d\u7f00 $x-1$ \u4e2d $b=a_x$ \u7684\u6570\u91cf\u3002\n\n3. $c$ \u7684\u8d21\u732e\n\n\u8fd9\u90e8\u5206\u5f71\u54cd\u7684\u90fd\u662f $sum_y$\u3002\u6211\u4eec\u524d\u9762\u7ef4\u62a4\u4e86\u4e00\u4e2a\u4e1c\u897f $presumba$\uff0c\u8fd9\u53ef\u4ee5\u89e3\u51b3 $y-1$ \u6574\u5757\u524d\u7f00\u5185\u4e8c\u5143\u7ec4 $(i,j)$ \u7684\u4e2a\u6570\u3002 \u800c $j$ \u5728 $y$ \u5185\u662f\u663e\u7136\u7684\uff0c\u5f00\u6876\u626b\u63cf\u5373\u53ef\u3002\n\n\u5982\u4f55\u7ebf\u6027\u7a7a\u95f4\uff1f\u79bb\u7ebf\u9010\u5757\u5904\u7406\u5373\u53ef\u3002\uff08\u8fd9\u4e2a\u6bd4\u8f83\u6076\u5fc3\n\n[\u6838\u5fc3\u4ee3\u7801\uff08\u975e\u7ebf\u6027\u7a7a\u95f4\uff09\u3002](https://www.luogu.com.cn/paste/rhetub9t)",
        "postTime": 1642291932,
        "uid": 203623,
        "name": "Ntokisq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7722 [Ynoi2007] tmpq"
    }
]