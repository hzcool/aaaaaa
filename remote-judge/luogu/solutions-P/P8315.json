[
    {
        "content": "### [P8315 [COCI2021-2022#4] \u0160arenlist](https://www.luogu.com.cn/blog/Y-ATM-K-NB-666/solution-p8315)\n## \u5206\u6790\n\u9996\u5148\u5408\u6cd5\u8def\u5f84\u4e0a\u81f3\u5c11\u6709\u4e24\u6761\u8fb9\u989c\u8272\u4e0d\u540c\uff0c\u8fd9\u4e0d\u592a\u597d\u7edf\u8ba1\uff0c\u6211\u4eec\u53ef\u4ee5\u53cd\u8fc7\u6765\u60f3\uff1a\n\n**\u5408\u6cd5\u65b9\u6848\u6570 = \u603b\u65b9\u6848\u6570 - \u4e0d\u5408\u6cd5\u7684\u65b9\u6848\u6570**\n\n\u603b\u65b9\u6848\u6570\u663e\u7136\u662f $k^{n-1}$, \u8003\u8651\u8ba1\u7b97\u4e0d\u5408\u6cd5\u65b9\u6848\u6570\u3002\n\n\u5148\u8003\u8651 $m=1$ \u7684\u60c5\u51b5\uff1a\n\n\u663e\u7136\uff0c\u4e0d\u5408\u6cd5\u65b9\u6848\u7684\u8fd9\u4e00\u6761\u8def\u5f84\u4e0a\u7684\u989c\u8272\u90fd\u662f\u76f8\u540c\u7684\uff0c\u6211\u4eec\u5c31\u60f3\u5230\u50cf\u7f29\u70b9\u4e00\u6837\uff0c\u628a\u8fd9\u4e00\u6761\u8def\u5f84\u7684\u8fb9\u7f29\u6210\u4e00\u6761\u8fb9\uff0c\u8fd9\u6837\u4e0d\u5408\u6cd5\u65b9\u6848\u6570\u5c31\u597d\u7b97\u4e86\uff0c\u8bbe\u8fd9\u4e00\u6761\u8def\u5f84\u5305\u542b $c$ \u6761\u8fb9\uff0c\u5219\u4e0d\u5408\u6cd5\u65b9\u6848\u6570\u4e3a $k^{n-c}$\u3002\n\n\u7136\u800c\uff0c\u5982\u679c $m\\geq2$\uff0c\u8fd9\u6837\u7b97\u4f1a\u91cd\u590d\u8ba1\u7b97\u591a\u6761\u8def\u5f84\u540c\u65f6\u4e0d\u5408\u6cd5\u7684\u65b9\u6848\uff0c\u6211\u4eec\u53d1\u73b0 $n\\leq60,m\\leq15$\uff0c\u8fd9\u4e48\u5c0f\uff01\u4e8e\u662f\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u679a\u4e3e\u5bb9\u65a5\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u5c31\u662f\u679a\u4e3e\u4e0d\u5408\u6cd5\u8def\u5f84\u7684\u96c6\u5408 $S$\uff0c\u5bf9\u4e8e\u6bcf\u6761\u8def\u5f84\uff0c\u628a\u5b83\u6240\u6709\u8fb9\u5408\u5e76\u5230\u67d0\u4e00\u6761\u8fb9\u4e0a\uff08\u5982\u679c\u8def\u5f84\u6709\u76f8\u4ea4\uff0c\u5f53\u7136\u662f\u5408\u5e76\u6210\u4e00\u6761\u8fb9\u4e86\uff09\u3002\u7136\u540e\u7edf\u8ba1\u5408\u5e76\u540e\u7684\u8fb9\u6570 $cnt$\uff0c\u5f53 $|S|$ \u4e3a\u5076\u6570\uff0c\u8ba9\u7b54\u6848\u52a0\u4e0a $cnt$\uff0c \u5f53 $|S|$ \u4e3a\u5947\u6570\uff0c\u8ba9\u7b54\u6848\u51cf\u53bb $cnt$\uff0c\u679a\u4e3e\u8def\u5f84\u96c6\u5408\u53ef\u4ee5\u76f4\u63a5\u72b6\u6001\u538b\u7f29\uff0c\u5408\u5e76\u53ef\u4ee5\u7528\u5e76\u67e5\u96c6\u5b9e\u73b0\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(nm2^m)$\uff0c\u5177\u4f53\u7ec6\u8282\u770b\u4ee3\u7801\u3002\n\n## \u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\n#define N 650\n#define M 1500\n#define ll long long//\u8bb0\u5f97\u5f00long long\nusing namespace std;\nconst ll mod=1e9+7;\nint n,m;\nll k;\nint tot,first[N],nxt[M],ver[M];\nvoid add(int s,int e) {\n\tnxt[++tot]=first[s];\n\tfirst[s]=tot;\n\tver[tot]=e;\n}\nint id[M],idc;\nint s[N],t[N];\nvoid init() {\n\tfor(int i=1;i<n;++i) {\n\t\tint s,e;\n\t\tscanf(\"%d%d\",&s,&e);\n\t\tadd(s,e),add(e,s);\n\t\tid[tot]=id[tot-1]=++idc;//\u7ed9\u8fb9\u7f16\u53f7\u65b9\u4fbf\u5b58\u8def\u5f84\n\t}\n\tfor(int i=1;i<=m;++i) {\n\t\tscanf(\"%d%d\",&s[i],&t[i]);\n\t}\n}\nint road[N][N],cr[N];//road\u5b58\u8def\u5f84\nbool dfs(int now,int u,int T,int fa) {\n\tif(now==T) {\n\t\treturn 1;\n\t}\n\tfor(int i=first[now];i;i=nxt[i]) {\n\t\tint v=ver[i];\n\t\tif(v==fa) continue;\n\t\tif(dfs(v,u,T,now)) {\n\t\t\troad[u][++cr[u]]=id[i];\n\t\t\treturn 1;\n\t\t}\n\t}\n\treturn 0;\n}\nint fa[N];//\u5e76\u67e5\u96c6\nvoid reset() {\n\tfor(int i=1;i<=idc;++i) {\n\t\tfa[i]=i;\n\t}\n}\nint get(int p) {\n\tif(fa[p]==p) return p;\n\treturn fa[p]=get(fa[p]);\n}\nvoid merge(int x,int y) {\n\tfa[get(x)]=get(y);\n}\nbitset<N> vis;\nll powk[N],ans;\nint main() {\n\tscanf(\"%d%d%lld\",&n,&m,&k);\n\tinit();\n\tfor(int i=1;i<=m;++i) {\n\t\tdfs(s[i],i,t[i],0);\n\t}\n\tpowk[0]=1;\n\tfor(int i=1;i<=n;++i) {\n\t\tpowk[i]=powk[i-1]*k%mod;//\u9884\u5904\u7406k\u7684\u5e42\n\t}\n\tint ed=1<<m;\n\tans=powk[n-1];\n\tfor(int i=1;i<ed;++i) {//\u72b6\u6001\u538b\u7f29\n\t\tint cnt=0,c1=0;//cnt\u5b58\u7f29\u8fb9\u540e\u8fb9\u6570\uff0cc1\u8868\u793a\u7edf\u8ba1\u4e86\u51e0\u6761\u8def\u5f84\n\t\treset();\n\t\tvis.reset();\n\t\tfor(int j=0;j<m;++j) {\n\t\t\tif((i>>j)&1) {\n\t\t\t\tc1++;\n\t\t\t\tfor(int k=2;k<=cr[j+1];++k) {\n\t\t\t\t\tmerge(road[j+1][k],road[j+1][1]);\n              //\u628a\u8def\u5f84\u4e0a\u7684\u8fb9\u5408\u5e76\u5230\u7b2c\u4e00\u6761\u8fb9\u4e0a\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(int j=1;j<=idc;++j) {\n\t\t\tif(!vis[get(j)]) {\n\t\t\t\tvis[get(j)]=1;\n\t\t\t\tcnt++;\n\t\t\t}\n\t\t}\n\t\tif(c1&1) {\n\t\t\tans=(ans-powk[cnt]+mod)%mod;\n\t\t} else {\n\t\t\tans=(ans+powk[cnt])%mod;\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1659085427,
        "uid": 263112,
        "name": "Y_ATM_K",
        "ccfLevel": 7,
        "title": "P8315 [COCI2021-2022#4] \u0160arenlist"
    },
    {
        "content": "## \u9898\u76ee\u5206\u6790\n\n\u597d\u50cf\u633a\u7b80\u5355\u7684\uff1f\u6b63\u96be\u5219\u53cd\uff0c\u6211\u4eec\u53d1\u73b0\u4e00\u6761\u8def\u5f84\u4e0a\u7684\u8fb9\u989c\u8272\u300c\u5168\u90fd\u76f8\u540c\u300d\u8981\u6bd4\u300c\u4e0d\u5168\u76f8\u540c\u300d\u7b80\u5355\u5f97\u591a\uff0c\u56e0\u4e3a\u524d\u8005\u53ef\u4ee5\u89c6\u4e3a\u8be5\u8def\u5f84\u4e0a\u7684\u6bcf\u6761\u8fb9\u90fd\u4e0e\u8be5\u8def\u5f84\u4e0a\u7684\u7b2c\u4e00\u6761\u8fb9\u989c\u8272\u76f8\u540c\uff0c\u8fd9\u5f88\u65b9\u4fbf\u7528\u5e76\u67e5\u96c6\u7ef4\u62a4\u3002\n\n\u770b\u6570\u636e\u8303\u56f4\u8fd9\u4e48\u5c0f\uff0c\u4e8e\u662f\u5bb9\u65a5\u4e00\u4e0b\uff0c\u8bb0\u8def\u5f84\u96c6\u5408\u4e3a $S$\uff0c\u4e00\u4e2a\u96c6\u5408 $T$ \u4e2d\u6bcf\u6761\u8def\u5f84\u989c\u8272\u5747\u76f8\u540c\u7684\u65b9\u6848\u6570\u4e3a $f_T$\uff0c\u4e8e\u662f\u7b54\u6848\u4e3a $k^{n-1}+\\sum\\limits_{S'\u2208S} (-1)^{|S'|}\\times f_{S'}$\u3002\u800c $f_T$ \u53ea\u9700\u6309\u524d\u9762\u8bf4\u7684\uff0c\u5bf9\u4e8e\u6bcf\u6761\u8def\u5f84\u90fd\u628a\u8be5\u8def\u5f84\u4e0a\u7684\u6bcf\u6761\u8fb9\u4e0e\u7b2c\u4e00\u6761\u8fb9\u5408\u5e76\uff0c\u8868\u793a\u8fd9\u4e9b\u8def\u5f84\u4e0a\u7684\u6bcf\u6761\u8fb9\u989c\u8272\u5fc5\u987b\u4e0e\u7b2c\u4e00\u6761\u8fb9\u76f8\u540c\uff0c\u90a3\u4e48\u5408\u5e76\u4e4b\u540e\u6709\u4e14\u4ec5\u6709 $fa_i=i$ \u7684\u8fb9\u53ef\u4ee5\u4efb\u610f\u53d6\u8272\uff0c\u4e8e\u662f\u7ed3\u675f\u4e86\u3002\u5355\u6b21\u6c42 $f_T$ \u65f6\u95f4\u590d\u6742\u5ea6 $O(nm)$, \u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(nm\\times 2^m)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n## \u4ee3\u7801\n\n\u611f\u89c9\u6211\u4ee3\u7801\u5199\u5f97\u8fd8\u633a\u7b80\u6d01\u7684\u3002\n\n```cpp\n/*\n  author: PEKKA_l  \n */\n#include <iostream>\n#include <cstring>\n#include <algorithm>\n#include <map>\n#include <vector>\nusing namespace std;\n#define int long long\n#define mod 1000000007\n\nint n,m,k,u,v,ans,cf[65],fa[65];\nmap <pair<int,int>,int> mp;\nvector <int> e[65],lj[25];\n\nbool dfs(int x,int to,int fat,int num)\n{\n\tif(x==to) return 1;\n\tfor(auto i:e[x]) {if(i==fat) continue; if(dfs(i,to,x,num)) {lj[num].push_back(mp[make_pair(x,i)]); return 1;}}\n\t\treturn 0;\n}\nint getfa(int x) {return fa[x]==x?x:fa[x]=getfa(fa[x]);}\nint calc(int x)\n{\n\tfor(int i=1;i<=n-1;i++) fa[i]=i; int ncnt=0;\n\tfor(int i=1;i<=m;i++) if(x&(1<<(i-1))) for(auto j:lj[i]) fa[getfa(j)]=getfa(lj[i][0]);\n\tfor(int i=1;i<=n-1;i++) ncnt+=fa[i]==i; return ncnt;\n}\n\nsigned main()\n{\n\tcin>>n>>m>>k; cf[0]=1; for(int i=1;i<=n;i++) cf[i]=cf[i-1]*k%mod;\n\tfor(int i=1;i<=n-1;i++) {cin>>u>>v; mp[make_pair(u,v)]=mp[make_pair(v,u)]=i; e[u].push_back(v); e[v].push_back(u);}\n\tfor(int i=1;i<=m;i++) {cin>>u>>v; dfs(u,v,u,i);}\n\tfor(int i=0;i<(1<<m);i++) {ans+=((__builtin_popcount(i)&1)?-1:1)*cf[calc(i)]+mod; ans%=mod;} cout<<ans<<endl;\n}\n```\n",
        "postTime": 1681905363,
        "uid": 529697,
        "name": "PEKKA_l",
        "ccfLevel": 6,
        "title": "P8315 \u9898\u89e3"
    },
    {
        "content": "# [COCI2021-2022#4] \u0160arenlist\n\n[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P8315)\n\n## \u5206\u6790\n\n#### \u5982\u4f55\u6c42\u89e3\n\n- \u9996\u5148\uff0c\u4e00\u6761\u8def\u5f84\u4e0a\u6709 $2$ \u79cd\u53ca\u4ee5\u4e0a\u989c\u8272\u65f6\u90fd\u662f\u5408\u6cd5\u7684\uff0c\u6362\u8a00\u4e4b\uff0c\u53ea\u6709\u5f53\u4e00\u6761\u8def\u5f84\u4e0a\u53ea\u6709\u4e00\u79cd\u989c\u8272\u65f6\u624d\u4e0d\u5408\u6cd5\uff0c\u4e8e\u662f\u8003\u8651 **\u7528\u6240\u6709\u89e3\u7684\u6570\u91cf\u51cf\u53bb\u975e\u6cd5\u89e3\u7684\u6570\u91cf**\u3002\n- \u6240\u6709\u89e3\u7684\u6570\u91cf\u5c31\u662f\u6bcf\u6761\u8fb9\u90fd\u6709 $k$ \u79cd\u989c\u8272\u53ef\u9009\uff0c\u4e5f\u5c31\u662f $k^{n-1}$ \u79cd\uff0c\u5173\u952e\u5728\u4e8e\u5982\u4f55\u6c42\u975e\u6cd5\u89e3\u3002\n\n#### \u5982\u4f55\u6c42\u975e\u6cd5\u89e3\n\n- \u5148\u8003\u8651 $m=1$ \u7684\u60c5\u51b5\u3002\u6b64\u65f6\u53ea\u9700\u8981\u4f7f\u6307\u5b9a\u7684\u8fd9\u6761\u8def\u5f84\u989c\u8272\u76f8\u540c\uff0c\u6709 $k$ \u79cd\u989c\u8272\u53ef\u9009\uff0c\u5176\u4ed6\u8fb9\u4efb\u610f\u9009\uff0c\u6709 $k^{n-1-cnt}$ \u79cd\u65b9\u6848\uff08$cnt$ \u4e3a\u8def\u5f84\u8986\u76d6\u7684\u8fb9\uff09\uff0c\u60c5\u51b5\u6570 $k^{n-cnt}$\u3002\n\n- \u518d\u8003\u8651 $m>1$ \u7684\u60c5\u51b5\u3002\u6b64\u65f6\u4f9d\u7136\u6309\u7167\u4e0a\u9762\u7684\u601d\u8def\uff0c\u679a\u4e3e\u7b2c $i$ \u6761\u8def\u5f84\u989c\u8272\u76f8\u540c\uff0c\u8bbe\u5bf9\u5e94\u7684\u60c5\u51b5\u6570\u4e3a $W_i$\uff0c\u90a3 $\\sum_{i=1}^m W_i$ \u5c31\u662f\u975e\u6cd5\u89e3\u7684\u6570\u91cf\u3002\u4f46\u6b64\u65f6\u9700\u8981\u8003\u8651 $2$ \u4e2a\u95ee\u9898\u3002\n\n  1. \n\n  - \u5728\u679a\u4e3e\u7b2c $i$ \u6761\u8def\u5f84\u989c\u8272\u76f8\u540c\u5e76\u7d2f\u52a0\u4e0a\u5bf9\u5e94\u60c5\u51b5\u6570\u65f6\uff0c\u6211\u4eec\u4f7f\u5176\u5b83\u8fb9\u989c\u8272\u4efb\u9009\uff0c\u5c31\u4f1a\u51fa\u73b0\u5176\u5b83\u6307\u5b9a\u7684\u8def\u5f84\u989c\u8272\u4e5f\u76f8\u540c\u7684\u60c5\u51b5\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u8ba1\u7b97\u7b2c $i$ \u79cd\u60c5\u51b5\u65f6\uff0c\u4e5f\u4f1a\u7b97\u4e0a\u4e00\u90e8\u5206 $j$ \u7684\u60c5\u51b5\uff08$W_i$ \u548c $W_j$ \u6709\u4ea4\u96c6\uff09\uff0c\u6216\u8005\u8bf4\uff0c$W_i$ \u5b9e\u9645\u4e0a\u662f **\u81f3\u5c11** \u7b2c $i$ \u6761\u8def\u5f84\u989c\u8272\u76f8\u540c\u7684\u60c5\u51b5\u3002\n\n  - \u8981\u6392\u9664\u6389\u591a\u7b97\u7684\u60c5\u51b5\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u5bb9\u65a5\u539f\u7406\uff0c\u603b\u60c5\u51b5\u6570\u4e3a\uff1a\n    $$\n    W_i+W_j+W_k+\\dots-W_{i,j}-W_{i,k}-W_{j,k}-\\dots+W_{i,j,k}+\\dots\n    $$\n\n  2. \n\n  - \u5728\u8ba1\u7b97 $W_{i,j\\dots}$ \u65f6\uff0c\u5982\u4f55\u8ba1\u7b97\u5b83\u7684\u60c5\u51b5\u6570\uff1f\n\n  - \u5148\u8003\u8651 $2$ \u6761\u8def\u5f84\u65f6\u7684\u60c5\u51b5\uff0c\u6b64\u65f6\u53c8\u53ef\u4ee5\u5206\u6210 $2$ \u79cd\u60c5\u51b5\uff1a\n\n    - $2$ \u6761\u8def\u5f84\u6ca1\u6709\u91cd\u53e0\uff0c\u6b64\u65f6\u5b83\u4eec\u7684\u989c\u8272\u53ef\u4ee5\u4e0d\u540c\uff0c\u6240\u4ee5\u6700\u540e\u60c5\u51b5\u6570\u4e3a $k^2\\times k^{n-1-cnt}$\u3002\n\n    - $2$ \u6761\u8def\u5f84\u6709\u91cd\u53e0\uff0c\u6b64\u65f6\u5b83\u4eec\u7684\u989c\u8272\u5fc5\u987b\u76f8\u540c\uff0c\u56e0\u6b64\u53ef\u4ee5\u5c06\u5b83\u4eec\u770b\u4f5c $1$ \u6761\u8def\u5f84\uff0c\u6240\u4ee5\u6700\u540e\u60c5\u51b5\u6570\u4e3a $k\\times k^{n-1-cnt}$\u3002\n\n  - \u5927\u4e8e $2$ \u6761\u8def\u5f84\u65f6\u4e5f\u662f\u4e00\u6837\u7684\uff0c\u6ca1\u6709\u91cd\u53e0\u7684\u8def\u5f84\u5206\u522b\u8d21\u732e\u4e00\u4e2a $k$ \uff0c\u91cd\u53e0\u7684\u8def\u5f84\u5408\u5e76\uff0c\u6700\u540e\u7684\u60c5\u51b5\u6570\u5c31\u662f $k^{num}\\times k^{n-1-cnt}$\uff08$num$ \u4e3a\u5c06\u6240\u6709\u91cd\u53e0\u7684\u8def\u5f84\u5408\u5e76\u540e\u7684\u8def\u5f84\u6570\uff09\u3002\n\n  - \u90a3\u8981\u5982\u4f55\u8ba1\u7b97\u91cd\u53e0\u5462\uff1f\u53ef\u4ee5\u4f7f\u7528\u5e76\u67e5\u96c6\uff0c$n-1-cnt$ \u5176\u5b9e\u5c31\u662f\u5269\u4e0b\u7684\u6ca1\u6709\u8986\u76d6\u7684\u8fb9\u6570\uff0c\u4e5f\u662f\u6ca1\u6709\u91cd\u53e0\u7684\u201d\u8def\u5f84\u201c\uff0c\u6700\u540e\u7684\u60c5\u51b5\u6570\u5b9e\u9645\u4e0a\u5c31\u662f $k^{Fnum}$\uff08$Fnum$ \u4e3a\u5e76\u67e5\u96c6\u7684\u6570\u91cf\uff09\u3002\n\n- \u6240\u4ee5\u6d41\u7a0b\u5c31\u662f\uff1a\n\n  1. \u679a\u4e3e\u6bcf\u6761\u8def\u5f84\u662f\u5426\u9009\u3002\n\n  2. \u5982\u679c\u9009\u5219\u5c06\u8def\u5f84\u4e0a\u7684\u8fb9\u5408\u5e76\uff08\u5e76\u67e5\u96c6\uff09\u3002\n\n  3. \u8ba1\u7b97\u8d21\u732e\uff08\u9009\u7684\u8def\u5f84\u4e3a\u5947\u6570\u5219\u51cf\uff0c\u5426\u5219\u4e3a\u52a0\uff09\u3002\n\n## \u6ce8\u610f\n\n- \u627e\u5230\u8def\u5f84\u4e0a\u7684\u8fb9\u53ef\u4ee5\u76f4\u63a5\u7528\u66b4\u529b LCA\uff0c\u56e0\u4e3a $n\\le 60$\u3002\n\n- \u5e76\u67e5\u96c6\u662f\u8fb9\u7684\u5e76\u67e5\u96c6\uff0c\u53ef\u4ee5\u5c06\u6bcf\u4e2a\u70b9\u5b9a\u4e49\u4e3a\u4ed6\u5230\u7236\u4eb2\u7684\u8fd9\u6761\u8fb9\uff0c\u6240\u4ee5 $Fnum$ \u4f1a\u5927 $1$\u3002\n\n- \u5728\u7b97\u975e\u6cd5\u89e3\u65f6\uff0c\u4f1a\u7b97\u5230\u9009 $0$ \u6761\u8def\u5f84\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u5176\u5b9e\u4e0d\u9700\u8981\u4e00\u5f00\u59cb\u7b97\u6240\u6709\u89e3\u7684\u6570\u91cf\u3002\n\n## \u4ee3\u7801\n\n```c++\n#include<iostream>\n#include<cstdio>\n#include<cstring>\nusing namespace std;\n\nconst int N=65,P=1000000007;\nint n,m,q,tot,head[N],fa[N],dep[N],ans,F[N],Fnum;\nbool vis[N];\npair<int,int>path[20];\n\nstruct Edge\n{\n\tint v,nex;\n}E[N*2];\n\nvoid AddEdge(int u,int v)\n{\n\t++tot;\n\tE[tot].v=v;\n\tE[tot].nex=head[u];\n\thead[u]=tot;\n}\n\nvoid dfs(int x)\t\t\t\t\t//\u521d\u59cb\u5316\u6df1\u5ea6(dep)\u548c\u7236\u4eb2(fa)\n{\n\tfor(int i=head[x];i;i=E[i].nex)\n\t{\n\t\tint v=E[i].v;\n\t\tif(v==fa[x]) continue;\n\t\tfa[v]=x;\n\t\tdep[v]=dep[x]+1;\n\t\tdfs(v);\n\t}\n}\n\nint find(int x)\t\t\t\t\t//\u5e76\u67e5\u96c6\u67e5\u627e\n{\n\tif(x==F[x]) return x;\n\treturn F[x]=find(F[x]);\n}\n\nvoid merge(int x,int y)\t\t\t//\u5e76\u67e5\u96c6\u5408\u5e76\uff0c\u6ce8\u610fFnum\u8981\u51cf\u5c11\n{\n\tif(find(x)==find(y)) return;\n\tF[find(x)]=find(y);\n\t--Fnum;\n}\n\nvoid mark(int a,int b)\t\t\t//\u627e\u5230\u8def\u5f84\u4e0a\u7684\u8fb9\u5e76\u5408\u5e76\u91cd\u53e0\u7684\u8fb9\uff0c\u6ce8\u610f\u5e76\u67e5\u96c6\u7684\u542b\u4e49\n{\n\twhile(dep[a]!=dep[b])\n\t{\n\t\tif(dep[a]<dep[b]) swap(a,b);\n\t\tif(fa[a]!=b) merge(a,fa[a]);\n\t\ta=fa[a];\n\t}\n\tif(a==b) return;\n\twhile(fa[a]!=fa[b])\n\t{\n\t\tmerge(a,fa[a]);\n\t\tmerge(b,fa[b]);\n\t\ta=fa[a],b=fa[b];\n\t}\n\tmerge(a,b);\n\treturn;\n}\n\nint mpow(int a,int b)\n{\n\tint res=1;\n\tfor(;b;b>>=1)\n\t{\n\t\tif(b&1) res=1ll*res*a%P;\n\t\ta=1ll*a*a%P;\n\t}\n\treturn res;\n}\n\nvoid rongchi(int x,int num)\n{\n\tif(x==m+1)\n\t{\n\t\tif(num&1)\n\t\t\tans-=mpow(q,Fnum-1),ans%=P;\t\t//\u5e76\u67e5\u96c6\u5b9e\u9645\u4e0a\u5b58\u7684\u70b9\uff0c\u6240\u4ee5Fnum\u8981\u51cf1\n\t\telse\n\t\t\tans+=mpow(q,Fnum-1),ans%=P;\n\t\treturn;\n\t}\n\tint tF[N],tFnum=Fnum;\t\t\t\t\t//\u6ce8\u610f\u56de\u6eaf\u65f6\u8fd8\u539f\n\tmemcpy(tF,F,sizeof(F));\n\tmark(path[x].first,path[x].second);\n\trongchi(x+1,num+1);\n\tmemcpy(F,tF,sizeof(tF));\n\tFnum=tFnum;\n\trongchi(x+1,num);\n}\n\nint main()\n{\n\tscanf(\"%d%d%d\",&n,&m,&q);\n\tFnum=n;\n\tfor(int i=1;i<=n;++i)\n\t\tF[i]=i;\n\tint u,v;\n\tfor(int i=1;i<n;++i)\n\t{\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tAddEdge(u,v);\n\t\tAddEdge(v,u);\n\t}\n\tfa[1]=dep[1]=1;\n\tdfs(1);\n\tfor(int i=1;i<=m;++i)\n\t\tscanf(\"%d%d\",&path[i].first,&path[i].second);\n\trongchi(1,0);\n\tprintf(\"%d\",(ans+P)%P);\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1666095367,
        "uid": 578358,
        "name": "SuBtitle",
        "ccfLevel": 6,
        "title": "[COCI2021-2022#4] \u0160arenlist"
    }
]