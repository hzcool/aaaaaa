[
    {
        "content": "\u9996\u5148\u5bf9 $a$ \u6392\u5e8f\u3002\n\n- \u82e5\u5b58\u5728 $a_i > i$\uff0c\u5219\u4e00\u5b9a\u65e0\u89e3\u3002\n\n\u8bc1\u660e\uff1a\u5df2\u77e5 $p_i < i$\uff0c\u4f46\u6b64\u65f6\u6784\u9020\u51fa\u7684 $p_{i + 1} > i$\uff0c\u5219\u4e0d\u5408\u6cd5\u3002\n\n- \u6240\u6709 $a_i = i$ \u7684 $i$ \u4e00\u5b9a\u5728 $1 \\to n$ \u7684\u8def\u5f84\u4e0a\u3002\n\n\u8bc1\u660e\uff1a\u6b64\u65f6\u4efb\u4f55\u4ece $\\leq i$ \u7684\u70b9\u5230 $> i$ \u7684\u70b9\u7684\u8def\u5f84\u90fd\u8981\u7ecf\u8fc7 $i$\u3002\n\n- $1 \\to n$ \u7684\u8def\u5f84\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e $a_i = i$ \u7684 $i$ \u7684\u4e2a\u6570\u4e14\u5c0f\u4e8e\u7b49\u4e8e $a$ \u53bb\u91cd\u540e\u7684\u5143\u7d20\u4e2a\u6570\u3002\n\n\u8bc1\u660e\uff1a\u7531\u4e0a\u4e00\u6761\u4ee5\u53ca $p_i < i$ \u53ef\u5f97\u3002\n\n- \u8bbe\u4e0a\u4e00\u6761\u4e2d\u786e\u5b9a\u7684\u4e0a\u4e0b\u754c\u4e3a $[l, r]$\uff0c\u5219 $\\forall k \\in [l, r]$ \u5747\u5b58\u5728\u6ee1\u8db3\u6761\u4ef6\u7684\u6811\u3002\n\n\u8bc1\u660e\uff1a\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u5982\u4e0b\u4e00\u68f5\u6811\uff1a\n\n- $1 \\to n$ \u7684\u8def\u5f84\u7684\u7236\u4eb2\u5e8f\u5217\u7531 $a_i = i$ \u7684 $i$\uff08\u8bbe\u5176\u6709 $i$ \u4e2a\uff09\u3001\u5176\u4ed6\u5143\u7d20\u4e2d\u4e92\u5f02\u4e14\u524d $k - cnt$ \u5c0f\u8005\u7ec4\u6210\u3002\n- $1 \\to n$ \u7684\u8def\u5f84\u7684\u8fb9\u6743\u5e8f\u5217\u7531\u4f59\u4e0b\u5143\u7d20\u4e2d\u524d $k$ \u5927\u7ec4\u6210\u3002\n- \u5176\u4ed6\u4fe1\u606f\u7531\u4f59\u4e0b\u5143\u7d20\u7ec4\u6210\u3002\n\n\u800c\u6211\u4eec\u6784\u9020\u51fa\u7684\u6811\u540c\u6837\u6ee1\u8db3\u6743\u503c\u6700\u5927\u7684\u6027\u8d28\uff0c\u4e8e\u662f\u6211\u4eec\u7ef4\u62a4\u4e00\u68f5\u652f\u6301\u5355\u70b9\u5220\u9664\u3001\u6c42\u524d $k$ \u5927\u7684\u7ebf\u6bb5\u6811\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n \\log n)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <iostream>\n#include <algorithm>\n#include <functional>\n\nusing namespace std;\n\ntypedef long long ll;\n\ntypedef struct {\n\tint l;\n\tint r;\n\tint cnt;\n\tll sum;\n} Node;\n\nint a[200007], b[200007], diff[100007];\nbool mark[100007], vis[100007];\nNode tree[800007];\n\ninline void update(int x){\n\tint ls = x * 2, rs = x * 2 + 1;\n\ttree[x].cnt = tree[ls].cnt + tree[rs].cnt;\n\ttree[x].sum = tree[ls].sum + tree[rs].sum;\n}\n\nvoid build(int x, int l, int r){\n\ttree[x].l = l;\n\ttree[x].r = r;\n\tif (l == r){\n\t\ttree[x].cnt = 1;\n\t\ttree[x].sum = b[l];\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tbuild(x * 2, l, mid);\n\tbuild(x * 2 + 1, mid + 1, r);\n\tupdate(x);\n}\n\nvoid erase(int x, int pos){\n\tif (tree[x].l == tree[x].r){\n\t\ttree[x].cnt = tree[x].sum = 0;\n\t\treturn;\n\t}\n\tif (pos <= ((tree[x].l + tree[x].r) >> 1)){\n\t\terase(x * 2, pos);\n\t} else {\n\t\terase(x * 2 + 1, pos);\n\t}\n\tupdate(x);\n}\n\nll get_sum(int x, int k){\n\tif (tree[x].cnt == k) return tree[x].sum;\n\tint ls = x * 2;\n\tif (k <= tree[ls].cnt) return get_sum(ls, k);\n\treturn get_sum(x * 2 + 1, k - tree[ls].cnt) + tree[ls].sum;\n}\n\nint main(){\n\tint n, m, mink = 0, cnt = 0, maxk = 0;\n\tcin >> n;\n\tm = (n - 1) * 2;\n\tfor (register int i = 1; i <= m; i++){\n\t\tcin >> a[i];\n\t}\n\tsort(a + 1, a + m + 1);\n\tfor (register int i = 1; i <= m; i++){\n\t\tif (a[i] > i){\n\t\t\tfor (register int j = 1; j < n; j++){\n\t\t\t\tcout << -1 << \" \";\n\t\t\t}\n\t\t\treturn 0;\n\t\t}\n\t\tif (a[i] == i){\n\t\t\tmink++;\n\t\t\tmark[a[i]] = true;\n\t\t} else {\n\t\t\tb[++cnt] = a[i];\n\t\t}\n\t\tif (!vis[a[i]]){\n\t\t\tvis[a[i]] = true;\n\t\t\tmaxk++;\n\t\t}\n\t}\n\tif (mink >= n || mink > maxk){\n\t\tfor (register int i = 1; i < n; i++){\n\t\t\tcout << -1 << \" \";\n\t\t}\n\t\treturn 0;\n\t}\n\treverse(b + 1, b + cnt + 1);\n\tfor (register int i = cnt, j = 0; i >= 1; i--){\n\t\tif (!mark[b[i]] && b[i] != b[i + 1]) diff[++j] = i;\n\t}\n\tbuild(1, 1, cnt);\n\tfor (register int i = 1; i < mink; i++){\n\t\tcout << -1 << \" \";\n\t}\n\tfor (register int i = mink; i <= maxk; i++){\n\t\tif (i > mink) erase(1, diff[i - mink]);\n\t\tcout << get_sum(1, i) << \" \";\n\t}\n\tfor (register int i = maxk + 1; i < n; i++){\n\t\tcout << -1 << \" \";\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1676432197,
        "uid": 201007,
        "name": "Leasier",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5803 \u3010[SEERC2019] Tree Permutations\u3011"
    }
]