[
    {
        "content": "\u672c\u9898\u9700\u8981\u6211\u4eec\u4e86\u89e3\u4e00\u4e2a\u5173\u4e8e border \u7684\u6027\u8d28\u3002\n\n***\n**\u5b9a\u7406\uff1a** \n\n\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u6240\u6709 border \u6392\u5e8f\u540e\uff0c\u81f3\u5c11\u5b58\u5728\u4e00\u79cd\u5c06\u5e8f\u5217\u5212\u5206\u4e3a\u82e5\u5e72\u5b50\u5e8f\u5217\u7684\u65b9\u6848\uff0c\u4f7f\u5f97\u6240\u6709\u5b50\u5e8f\u5217\u5747\u4e3a\u7b49\u5dee\u6570\u5217\uff0c\u4e14\u5b50\u5e8f\u5217\u7684\u4e2a\u6570\u4e3a $O(\\log|s|)$\u3002\n\n**\u8bc1\u660e\uff1a** \n\n\u4e00\u4e2a\u663e\u7136\u7684\u7ed3\u8bba\uff1a$s[0..k - 1]$ \u4e3a $s$ \u7684 border $\\rightleftharpoons$ $|s| - k$ \u4e3a $s$ \u7684\u5468\u671f\u3002\n\n\u53e6\u4e00\u4e2a\u663e\u7136\u7684\u7ed3\u8bba\uff1a\u82e5 $p$ , $q$ \u4e3a $s$ \u7684\u5468\u671f\uff0c\u5219 $\\gcd(p, q)$ \u4e5f\u4e3a $s$ \u7684\u5468\u671f\u3002\n\n\u4ee5\u4e0a\u4e24\u4e2a\u7ed3\u8bba\u53ef\u4ee5\u5957\u5b9a\u4e49\u5f97\u5230\u3002\n\n\u8003\u8651\u4e24\u4e2a $|s|$ \u7684 border : $A$\uff0c$B$\uff0c\u5176\u4e2d $B$ \u4e3a\u6700\u957f\u7684 border ( $s$ \u672c\u8eab\u9664\u5916)\uff0c$|A| \\geq \\frac{|s|}{2}$ \u3002\n\n\u4ee4 $p=|s| - |A|$\uff0c$q=|s| - |B|$\u3002\n\n\u82e5\u8fd9\u6837\u7684\u4e24\u4e2a $border$ \u5b58\u5728\uff0c\u5219 $p$ , $q$ , $\\gcd(p,q)$ \u5747\u4e3a $s$ \u7684\u5468\u671f\uff0c\u6240\u4ee5 $s[0..|s| - \\gcd(p, q)]$ \u4e3a $s$ \u7684 border\uff0c\u53c8\u56e0\u4e3a $B$ \u4e3a\u6700\u957f\u7684 border\uff0c\u6240\u4ee5 $\\gcd(p,q)$ = $q$\u3002\n\n\u56e0\u6b64 $q|p$ \u3002\u53c8\u56e0\u4e3a $k \\times q$ \u4e5f\u662f $|s|$ \u7684\u5468\u671f\uff0c\u6240\u4ee5 $s[0..|s| - k \\times q - 1]$ \u90fd\u662f $s$ \u7684 border\u3002\u56e0\u6b64**\u6240\u6709\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e\u5b57\u7b26\u4e32\u4e00\u534a\u7684 border \u6784\u6210\u4e00\u4e2a\u7b49\u5dee\u6570\u5217**\u3002 \n\n\n\u8003\u8651\u4e24\u4e2a $|s|$ \u7684 border : $A$\uff0c$B$ ($|A| < |B|$)\u3002\n\n\u5219 $A$ \u4e5f\u4e3a $B$ \u7684 border\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a border \u5206\u6210\u4e24\u4e2a\u96c6\u5408\uff1a\u7b2c\u4e00\u4e2a\u96c6\u5408\u7684 border \u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e $\\frac{|s|}{2}$\uff0c\u7b2c\u4e8c\u90e8\u5206\u4e3a\u5176\u4ed6\u3002\u7b2c\u4e00\u90e8\u5206\u6784\u6210\u4e86\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\uff0c\u7b2c\u4e8c\u90e8\u5206\u6240\u6709\u5b57\u7b26\u4e32\u4e3a\u5176\u4e2d\u6700\u957f\u7684\u5b57\u7b26\u4e32\u7684 border\uff0c\u53ef\u4ee5\u9012\u5f52\u5904\u7406\uff0c\u81f3\u591a $\\log |s|$ \u5c42\u3002\u5b9a\u7406\u5f97\u8bc1\u3002\n\n***\n\u5f97\u5230\u4e86\u8fd9\u4e2a\u5b9a\u7406\uff0c\u6211\u4eec\u56de\u5230\u9898\u76ee\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5c06\u9898\u610f\u8f6c\u5316\u4e3a\uff1a$\\sum_{i=1}^{cnt}a_ix_i$ \u5728 $[0,w-n]$ \u4e2d\u80fd\u53d6\u5230\u7684\u503c\u7684\u4e2a\u6570\uff0c\u5176\u4e2d $cnt$ \u4e3a $|s|$ \u7684\u5468\u671f\u4e2a\u6570\uff0c$a$ \u4e3a\u5468\u671f\u957f\u5ea6\u3002\n\n\u7531\u6b64\u6211\u4eec\u60f3\u5230\u4e86**\u540c\u4f59\u6700\u77ed\u8def**\u3002\n\n\u6ce8\u610f\uff0c$\\min\\{a_i\\}*cnt$ \u662f $O(n^2)$ \u7684\uff0c\u6784\u9020\u65b9\u6cd5\u4e3a $aaa\\ldots aabaaa\\ldots aa$ \u3002\u5176\u4e2d $b$ \u5904\u5728\u5b57\u7b26\u4e32\u8f83\u4e2d\u95f4\u7684\u4f4d\u7f6e\u3002\n\n\u4f46\u662f\u7531\u4e8e border \u62e5\u6709\u7279\u6b8a\u7684\u6027\u8d28\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u4f18\u5316\u3002\n\n\u6211\u4eec\u628a\u4e0d\u540c\u7684\u7b49\u5dee\u6570\u5217\u5206\u5f00\u5904\u7406\u3002\n\n\u9996\u5148\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u7b49\u5dee\u6570\u5217 $x,x + d,x + 2d, \\ldots x + l\\times d$\uff0c\u6211\u4eec\u5728$\\mod x$ \u4e0b\u8dd1\u540c\u4f59\u6700\u77ed\u8def\u3002\u5176\u4e2d\u5bf9\u4e8e $0 \\leq y  < x$ \u7684 $y$ \u5411 $ (y + d) \\mod x$ \u8fde\u8fb9\uff0c\u4f1a\u5f62\u6210 $\\gcd(x, d)$ \u4e2a\u73af\u3002\u6bcf\u4e2a\u73af\u53ef\u4ee5\u5206\u5f00\u5904\u7406\u3002\n\n\u4f46\u6211\u4eec\u6b64\u65f6\u53d1\u73b0\uff0c\u628a\u7b49\u5dee\u6570\u5217\u5206\u5f00\u5904\u7406\u7684\u574f\u5904\u5c31\u662f\u6b64\u65f6\u6ca1\u6709\u6e90\u70b9\uff0c\u5982\u679c\u7528\u73af\u4e0a\u4efb\u4f55\u4e00\u70b9\u53bb\u4f18\u5316\u53e6\u5916\u4e00\u70b9\uff0c\u9700\u8981 $\\Omega(n^2)$ \uff0c\u8fd9\u6837\u590d\u6742\u5ea6\u5f88\u52a3\u3002\n\n\u4f46\u662f\u6211\u4eec\u53c8\u53ef\u4ee5\u53d1\u73b0\uff0c\u73af\u4e2d $dis$ \u6700\u5c0f\u7684\u4e00\u70b9\u662f\u7edd\u4e0d\u4f1a\u88ab\u66f4\u65b0\u7684\uff0c\u4e14\u76f8\u90bb\u4e24\u70b9\u4e4b\u95f4\u6743\u503c\u76f8\u540c\uff0c\u90fd\u4e3a $d$\u3002\u8fd9\u4e24\u6761\u6027\u8d28\uff0c\u53ef\u4ee5\u8ba9\u6211\u4eec\u4ece $dis$ \u6700\u5c0f\u70b9\u51fa\u53d1\uff0c\u4f7f\u7528\u5355\u8c03\u961f\u5217\u8ba1\u7b97\u3002\n\n\u6211\u4eec\u5728\u5355\u8c03\u961f\u5217\u91cc\u653e\u5165\u79bb\u73b0\u5728\u5904\u7406\u70b9\u8ddd\u79bb\u5c0f\u4e8e\u7b49\u4e8e $l$ \u7684\u70b9\uff0c\u4ee5 $dis_i - pos_i * d$ \u4f5c\u4e3a\u6bd4\u8f83\u65b9\u5f0f\uff08\u56e0\u4e3a\u73af\u4e0a $a$ \u70b9\u5230 $b$ \u70b9\u7684\u4ee3\u4ef7\u662f $-pos_a * d + pos_b * d$)\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u5904\u7406\u73af\u4e0a\u7684\u8f6c\u79fb\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u662f $dis$ \u6570\u7ec4\u5728\u4e0d\u540c\u6a21\u6570\u4e4b\u95f4\u7684\u8f6c\u6362\u3002\u82e5\u539f\u5148\u7684\u6a21\u6570\u4e3a $las$\uff0c\u73b0\u5728\u7684\u6a21\u6570\u4e3a $now$\uff0c\u5f88\u663e\u7136 $dis_i$ \u53ef\u4ee5\u66f4\u65b0 $dis'_{dis_i \\mod now}$\u3002\u4f46 $dis_i$ \u7684\u542b\u4e49\u662f $dis_i + k * las$ ($k \\geq 0$) \u53ef\u4ee5\u88ab\u8bbf\u95ee\u3002\u6240\u4ee5\u6211\u4eec\u5728$\\mod now$ \u610f\u4e49\u4e0b\u518d\u7528 $x$ \u66f4\u65b0$(x + las)\\mod now$ \u8dd1\u4e00\u8fb9\u540c\u4f59\u6700\u77ed\u8def\u5373\u53ef\u3002\n\n\u6ce8\u610f\u5230\u8fd9\u4e2a\u8fc7\u7a0b\u7c7b\u4f3c\u4e8e\u5355\u4e2a\u7b49\u5dee\u6570\u5217\u7684\u5904\u7406\u8fc7\u7a0b\u3002\u540c\u6837\u53ef\u4ee5\u628a\u73af\u5206\u5f00\u5904\u7406\u3002\u4e0d\u8fc7\u7531\u4e8e\u6ca1\u6709 $l$ \u7684\u9650\u5236\uff0c\u4e0d\u9700\u8981\u7528\u5230\u5355\u8c03\u961f\u5217\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(Tn\\log n)$ \u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int Maxn = 500005;\nint now, ct, fail[Maxn], Q[2 * Maxn], seq[Maxn], border[Maxn], pos[Maxn];\nlong long f[Maxn], res[Maxn], sta[Maxn], ans, w;\nstring str;\nvoid get_fail(void)\n{\n\tint siz = str.size();\n\tfail[0] = fail[1] = 0;\n\tfor (int i = 1; i < siz; i++)\n\t{\n\t\tint tmp = fail[i];\n\t\twhile (tmp && str[tmp] != str[i]) tmp = fail[tmp];\n\t\tfail[i + 1] = str[tmp] == str[i] ? tmp + 1 : 0;\n\t}\n\tint now = fail[siz];\n\twhile (now)\n\t{\n\t\tborder[++ct] = siz - now;\n\t\tnow = fail[now];\n\t}\n\tborder[++ct] = siz;\n}\nvoid change_mod(int mod)\n{\n\tint cnt = __gcd(mod, now);\n\tfor (int i = 0; i < now; i++)\n\t\tres[i] = f[i];\n\tfor (int i = 0; i < mod; i++)\n\t\tf[i] = 0x3f3f3f3f3f3f3f3fLL;\n\tfor (int i = 0, tmp; i < now; i++)\n\t\ttmp = res[i] % mod, f[tmp] = min(f[tmp], res[i]);\n\tfor (int i = 0; i < cnt; i++)\n\t{\n\t\tint top = 0;\n\t\tQ[++top] = i;\n\t\tint tmp = (i + now) % mod;\n\t\twhile (tmp != Q[1])\n\t\t\tQ[++top] = tmp, tmp = (tmp + now) % mod;\n\t\tfor (int j = top + 1; j <= 2 * top; j++)\n\t\t\tQ[j] = Q[j - top];\n\t\ttop <<= 1;\n\t\tfor (int j = 2; j <= top; j++)\n\t\t\tf[Q[j]] = min(f[Q[j]], f[Q[j - 1]] + now);\n\t}\n\tnow = mod;\n}\nvoid work(int first, int diff, int siz)\n{\n\tint cnt = __gcd(diff, first);\n\tchange_mod(first);\n\tif (diff < 0) return ;\n\tfor (int i = 0; i < cnt; i++)\n\t{\n\t\tint top = 0;\n\t\tQ[++top] = i;\n\t\tint tmp = (i + diff) % first;\n\t\twhile (tmp != Q[1])\n\t\t\tQ[++top] = tmp, tmp = (tmp + diff) % first;\n\t\tint mini_pos = 1;\n\t\tfor (int j = 1; j <= top; j++)\n\t\t\tif (f[Q[j]] < f[Q[mini_pos]]) mini_pos = j;\n\t\tint tmp_cnt = 0;\n\t\tfor (int j = mini_pos; j <= top; j++)\n\t\t\tseq[++tmp_cnt] = Q[j];\n\t\tfor (int j = 1; j < mini_pos; j++)\n\t\t\tseq[++tmp_cnt] = Q[j];\n\t\tint head = 1, tail = 1;\n\t\tpos[1] = 1, sta[1] = f[seq[1]] - diff;\n\t\tfor (int j = 2; j <= top; j++)\n\t\t{\n\t\t\twhile (head <= tail && pos[head] + siz < j) head++;\n\t\t\tif (head <= tail) f[seq[j]] = min(f[seq[j]], sta[head] + j * (long long) diff + first);\n\t\t\twhile (head <= tail && sta[tail] >= f[seq[j]] - j * (long long) diff) tail--;\n\t\t\tsta[++tail] = f[seq[j]] - j * (long long) diff, pos[tail] = j;\n\t\t}\n\t}\n}\nint T, n;\nint main()\n{\n\tscanf(\"%d\", &T);\n\twhile (T--)\n\t{\n\t\tans = ct = 0;\n\t\tscanf(\"%d%lld\", &n, &w), w -= n;\n\t\tmemset(f, 0x3f, sizeof(long long[n]));\n\t\tf[0] = 0;\n\t\tnow = n;\n\t\tcin >> str;\n\t\tget_fail();\n\t\tfor (int i = 1, j = 1; i <= ct; i = j)\n\t\t{\n\t\t\twhile (border[j + 1] - border[j] == border[i + 1] - border[i]) j++;\n\t\t\twork(border[i], border[i + 1] - border[i], j - i - 1);\n\t\t}\n\t\tfor (int i = 0; i < now; i++)\n\t\t\tif (f[i] <= w) ans += (w - f[i]) / now + 1;\n\t\tprintf(\"%lld\\n\", ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1571926643,
        "uid": 49093,
        "name": "_sys",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4156 \u3010[WC2016]\u8bba\u6218\u6346\u7af9\u7aff\u3011"
    },
    {
        "content": "\u795e\u4ed9\u9898 QAQ\n\n\u5148\u7ed9\u4e2a\u5b9a\u4e49:\n\n\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684 $border$ : \u5982\u679c\u4e00\u4e2a\u6b63\u6574\u6570 $len$ \u5bf9\u4e8e\u5b57\u7b26\u4e32 $S$ \u6765\u8bf4\u6ee1\u8db3 $S_{1} \\dots S_{len} = S_{|S|-len+1} \\dots S_{|S|}$  \u4e14 $len \\leq |S|$,\u5219\u79f0 $len$ \u4e3a $S$ \u7684\u4e00\u4e2a $border$. \u5982 $3$ \u5c31\u662f $ababa$ \u7684\u4e00\u4e2a $border$. \u663e\u7136\u4e00\u4e2a\u5b57\u7b26\u4e32\u53ef\u80fd\u6709\u591a\u4e2a $border$\n\n\u5728\u672c\u9898\u4e2d,\u663e\u7136\u6211\u4eec\u53ef\u4ee5\u9009\u62e9 $S$ \u7684\u4e00\u4e2a $border$ $len$ ,\u628a\u524d\u9762\u4e32\u7ed3\u5c3e\u7684 $len$ \u4e2a\u5b57\u7b26\u548c\u8fd9\u6b21\u5f00\u5934\u7684 $len$ \u4e2a\u5b57\u7b26\u878d\u5408\u8d77\u6765,\u8fd9\u6837\u6574\u4e2a\u4e32\u7684\u957f\u5ea6\u5c31\u589e\u52a0\u4e86 $n-len+1$.\n\n\u90a3\u5c31\u628a\u9898\u76ee\u8f6c\u5316\u4e3a\u4e86\u4e00\u4e2a\u5bb9\u91cf\u4e3a $w$ \u80cc\u5305\u95ee\u9898, \u95ee\u80fd\u653e\u51fa\u591a\u5c11\u79cd\u603b\u91cd\u91cf\u4e0d\u5927\u4e8e $w$ \u7684\u957f\u5ea6.\n\n\u90a3\u4e48\u66b4\u529b\u54c8\u5e0c\u6c42 $border$, \u88f8\u8dd1\u540c\u4f59 BFS, \u5c31\u6709\u66b4\u529b\u5206\u4e86. \n\n\u5565?\u4f60\u4e0d\u77e5\u9053\u4ec0\u4e48\u662f\u540c\u4f59 BFS? \u53ef\u4ee5\u53bb\u770b\u4e00\u4e0b\u6d1b\u8c37\u8fd9\u9053\u9898: \u8df3\u697c\u673a \u518d\u6765\u505a\u8fd9\u9053\u9898qwq\n\n\u7136\u540e\u5c31\u6709\u4e00\u4e2a\u5f88\u795e\u4ed9\u7684\u7ed3\u8bba: \u628a $border$ \u96c6\u5408\u4e2d\u7684\u6240\u6709\u5143\u7d20\u6392\u5e8f, \u6700\u5c11\u53ef\u4ee5\u88ab\u5212\u5206\u6210\u7684 **\u7b49\u5dee\u6570\u5217** \u4e2a\u6570\u4e0d\u4f1a\u8d85\u8fc7 $\\log |S|$ \u4e2a.\n\n\u8bc1\u660e\u8bf7\u770b\u5b98\u65b9\u9898\u89e3, \u6211\u592a\u83dc\u4e86,\u4e0d\u4f1a\u8bc1.\n\n\u5212\u5206\u7b49\u5dee\u6570\u5217\u7684\u610f\u601d\u561b,\u4e3e\u4e2a\u6817\u5b50: $2,3,5,7,9,13,14$ \u6700\u5c11\u53ef\u4ee5\u88ab\u5206\u6210\u4e09\u4e2a\u7b49\u5dee\u6570\u5217.\n\n\u90a3\u4e48\u73b0\u5728\u5c31\u53ea\u7528\u8003\u8651\u5982\u4f55\u7528\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u6765\u8f6c\u79fb\u4ee5\u53ca\u4e0d\u540c\u7b49\u5dee\u6570\u5217\u7684\u5408\u5e76.\n\n\u5047\u8bbe\u6709\u4e00\u4e2a\u9996\u9879\u4e3a $x$ , \u516c\u5dee\u4e3a $d$ , \u9879\u6570\u4e3a $L$ \u7684\u4e00\u4e2a\u7b49\u5dee\u6570\u5217. \u8bbe\u4e00\u4e2a\u72b6\u6001 $f_i$ \u8868\u793a\u5230\u8fbe\u5728\u6a21 $x$ \u610f\u4e49\u4e0b\u4e3a $i$ \u7684\u70b9\u6240\u9700\u8981\u7684\u6700\u77ed\u8def\u7a0b. \n\n\u56e0\u4e3a\u662f\u5728\u6a21 $x$ \u7684\u610f\u4e49\u4e0b,\u6240\u4ee5\u6211\u4eec\u6240\u6709\u7684\u5143\u7d20\u90fd\u53ef\u4ee5\u88ab\u7b49\u4ef7\u5730\u770b\u6210\u662f $0, d,2*d,3*d \\dots (L-1)*d$ . \u76f8\u5f53\u4e8e\u4e00\u6b21\u53ef\u4ee5\u8df3 $d$ \u7684\u500d\u6570\u6b21,\u4e14\u4e00\u6b21\u8df3\u7684\u8def\u7a0b\u4e0d\u80fd\u8d85\u8fc7 $(L-1)*d$.\n\n\u90a3\u4e48\u5728\u6a21 $x$ \u610f\u4e49\u4e0b, \u80fd\u8df3 $d$ \u7684\u500d\u6570\u957f\u5ea6, \u5f88\u81ea\u7136\u5c31\u4f1a\u5f62\u6210 $\\gcd(x,d)$ \u4e2a\u73af.  \u6bcf\u4e2a\u73af\u76f8\u4e92\u4e0d\u5f71\u54cd,\u6240\u4ee5\u5206\u5f00dp. \u6bcf\u4e2a\u73af\u4e2d\u6700\u5c0f\u7684\u5143\u7d20\u80af\u5b9a\u4e0d\u518d\u4f1a\u88ab\u66f4\u65b0,\u6240\u4ee5\u5c31\u4ece\u6bcf\u4e2a\u73af\u4e2d\u6700\u5c0f\u7684\u90a3\u4e2a\u5143\u7d20\u5f00\u59cb dp, \u56e0\u4e3a\u6bcf\u6b21\u4e0d\u80fd\u8df3\u8d85\u8fc7 $d$ \u7684 $L-1$ \u500d\u6b21,\u6240\u4ee5\u5355\u8c03\u961f\u5217\u4e00\u4e0b\u5c31\u597d\u4e86.\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u505a\u5b8c\u4e86\u6bcf\u4e2a\u7b49\u5dee\u6570\u5217\u7684\u8f6c\u79fb. \u4f46\u662f\u8fd8\u9700\u8981\u628a\u6bcf\u6b21\u7b97\u51fa\u6765\u7684 $f$ \u6570\u7ec4\u5408\u5e76\u8d77\u6765. \u4f46\u662f\u6bcf\u4e2a $f$ \u7684\u5269\u4f59\u7cfb $x$ \u5e76\u4e0d\u4e00\u6837, \u8fd9\u5c31\u6d89\u53ca\u5230\u4e86\u4e00\u4e2a\u6a21 $pre$ \u610f\u4e49\u4e0b\u7684 $f$ \u6570\u7ec4\u5982\u4f55\u8f6c\u53d8\u4e3a\u6a21 $now$ \u610f\u4e49\u4e0b\u7684 $f$.\n\n\u6211\u4eec\u628a\u65b0\u7684 $f$ \u770b\u6210 $g$ ,\u90a3\u4e48\u6211\u4eec\u4f1a\u6709\u8fd9\u6837\u4e00\u4e2a\u5f0f\u5b50:\n\n$$g_i=\\min_{f_j\\%now=i} f_j$$ \n\n\u4e3a\u5565? \u6211\u4eec\u5728\u539f\u6765\u7684\u5269\u4f59\u7cfb $pre$ \u4e2d\u6700\u5c11\u8d70 $f_i$ \u5c31\u53ef\u4ee5\u5230\u8fbe $i$, \u5728\u65b0\u7684\u5269\u4f59\u7cfb\u4e2d, \u8d70\u7684\u8fd9 $f_i$ \u6b65\u5e76\u6ca1\u6709\u6539\u53d8, \u4f46\u662f\u56e0\u4e3a\u6a21\u6570\u53d8\u6210\u4e86 $now$, \u5230\u8fbe\u7684\u7ec8\u70b9\u4e0d\u518d\u662f $i$, \u800c\u662f $f_i\\%now$. \u6240\u4ee5\u8fd9\u4e2a\u503c\u5e94\u8be5\u88ab\u52a0\u5230 $g_{f_i\\%now}$ \u4e0a\u9762\u53bb.\n\n\u4f46\u662f\u539f\u6765\u5728\u6a21 $pre$ \u610f\u4e49\u4e0b, \u957f\u5ea6\u4e3a $pre$ \u7684\u8f6c\u79fb\u5e76\u6ca1\u6709\u88ab\u8003\u8651\u5230,\u6240\u4ee5\u6211\u4eec\u8981\u5bf9\u65b0\u5f97\u5230\u7684 $g$ \u6570\u7ec4\u4e0a\u8fdb\u884c\u4e00\u6b21\u957f\u5ea6\u4e3a $pre$ \u7684\u8f6c\u79fb\u624d\u80fd\u5f97\u5230\u6b63\u786e\u7684 $g$.\n\n~~\u522b\u4eba\u5927\u4f6c\u7684\u535a\u5ba2\u4e0a\u5e76\u6ca1\u6709\u8bb2\u4e3a\u5565\u53ef\u4ee5\u8fd9\u6837\u8f6c\u79fb,\u4ee5\u4e0a\u7eaf\u5c5e\u4e2a\u4ebayy,\u5982\u679c\u6709\u9519,\u6b22\u8fce\u6307\u51faqwq~~\n\n\u90a3\u4e48\u8fd9\u6837\u5c31\u5728 $O(n\\log n)$ \u7684\u590d\u6742\u5ea6\u5185\u901a\u8fc7\u4e86\u6b64\u9898\n\n------\n\n\u8d34\u4e0a\u4ee3\u7801:\n\n```\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<algorithm>\n#define int long long\n#define ll long long\n#define maxn 1000005\nusing namespace std;\nll Seed=998244353ll;\nll Ha[maxn],pw[maxn];\nchar s[maxn];\nint n,W,Bo[maxn],f[maxn],pre[maxn],now;\nvoid GetBorder()\n{\n    Bo[0]=0;\n    for(int i=1;i<=n;i++)\n        Ha[i]=Ha[i-1]+pw[i]*s[i];\n    for(int i=1;i<n;i++)\n        if(Ha[i]*pw[n-i]==Ha[n]-Ha[n-i]) Bo[++Bo[0]]=i;\n    for(int i=1;i<=Bo[0];i++) Bo[i]=n-Bo[i];\n    reverse(Bo+1,Bo+Bo[0]+1);\n}\nint seq[maxn];\nvoid ChangeMod(int x)\n{\n    int D=__gcd(x,now),top=0;\n    for(int i=0;i<now;i++) pre[i]=f[i];\n    for(int i=0;i<x;i++) f[i]=1e18;\n    for(int i=0,tmp;i<now;i++)\n        tmp=pre[i]%x,f[tmp]=min(f[tmp],pre[i]);\n    for(int i=0;i<D;i++)\n    {\n        top=0,seq[++top]=i;\n        int tmp=(i+now)%x;\n        while(tmp!=seq[1])\n            seq[++top]=tmp,tmp=(tmp+now)%x; \n        for(int j=1;j<=top;j++)\n            seq[j+top]=seq[j];\n        top<<=1;\n        for(int j=2;j<=top;j++)\n            f[seq[j]]=min(f[seq[j]],f[seq[j-1]]+now);\n    }\n    now=x;\n}\nint dq[maxn],w[maxn];\nvoid Solve(int x0,int d,int len)\n{\n    int D=__gcd(x0,d),top,l,r,N=0;\n    static int Q[maxn];\n    ChangeMod(x0);\n    if(d<0) return;\n    for(int i=0;i<D;i++)\n    {\n        N=0,top=0,Q[++top]=i;\n        int tmp=(i+d)%x0;\n        while(tmp!=Q[1])\n            Q[++top]=tmp,tmp=(tmp+d)%x0;\n        int st=1;\n        for(int i=1;i<=top;i++) if(f[Q[i]]<f[Q[st]]) st=i;\n        for(int i=st;i<=top;i++) seq[++N]=Q[i];\n        for(int i=1;i<st;i++) seq[++N]=Q[i];\n        l=1,r=1,dq[1]=1,w[1]=f[seq[1]]-d;\n        for(int pt=2;pt<=top;pt++)\n        {\n            while(l<=r&&dq[l]+len<pt) l++;\n            if(l<=r) f[seq[pt]]=min(f[seq[pt]],w[l]+pt*d+x0);\n            while(l<=r&&w[r]>=f[seq[pt]]-pt*d) r--;\n            w[++r]=f[seq[pt]]-pt*d,dq[r]=pt;\n        }\n    }\n}\nint T=0;\nsigned main()\n{\n    scanf(\"%lld\",&T),pw[0]=1;\n    for(int i=1;i<maxn;i++) pw[i]=pw[i-1]*Seed;\n    while(T--)\n    {\n    \tmemset(Bo,0,sizeof(Bo));\n        scanf(\"%lld%lld%s\",&n,&W,s+1),W-=n;\n        GetBorder(),now=n;\n        for(int i=1;i<now;i++) f[i]=1e18; f[0]=0;\n        for(int i=1,j=1;i<=Bo[0];i=j)\n        {\n            while(Bo[i+1]-Bo[i]==Bo[j+1]-Bo[j]) j++;\n            Solve(Bo[i],Bo[i+1]-Bo[i],j-i-1);\n        }\n        int ans=0;\n        for(int i=0;i<now;i++)\n            if(W-f[i]>=0) ans+=(W-f[i])/now+1;\n        printf(\"%lld\\n\",ans);\n    }\n    return 0;\n}\n```",
        "postTime": 1553174370,
        "uid": 20815,
        "name": "PhantasmDragon",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4156 \u3010[WC2016]\u8bba\u2642\u6218\u2642\u6346\u7af9\u7aff\u3011"
    },
    {
        "content": "> \u9898\u76ee\u94fe\u63a5\uff1a[P4156 [WC2016]\u8bba\u6218\u6346\u7af9\u7aff](https://www.luogu.com.cn/problem/P4156)\n\n> **\u672c\u9898\u89e3\u540c\u6b65\u53d1\u5e03\u4e8e [My Blog](http://www.cxy07.blog/index.php/archives/118/)**\n\n\u9898\u610f\uff1a\n\n> \u7ed9\u5b9a\u957f\u5ea6\u4e3a $n$ \u7684\u5b57\u7b26\u4e32 $S$\uff0c\u73b0\u6709\u4e00\u4e2a\u7a7a\u4e32 $T$\uff0c\u6bcf\u6b21\u53ef\u5c06 $S$ \u53bb\u6389\u4e00\u4e2a $\\text{border}$ \u540e\u63a5\u5728 $T$ \u4e0a\u3002\u95ee $T$ \u7684\u957f\u5ea6\u53ef\u4ee5\u662f $[n,w]$ \u4e2d\u7684\u591a\u5c11\u4e2a\u6570\u3002\n\n> $1\\le n\\le 5\\times 10^5,1\\le w\\le 10^{18}$\u3002\n\n\u6bcf\u6b21\u53bb\u6389\u4e00\u4e2a $\\text{border}$ \u52a0\u5165\uff0c\u7b49\u4ef7\u4e8e\u52a0\u5165\u4e00\u4e2a $\\text{period}$\u3002\u8bbe $S$ \u7684 $\\text{period}$ \u957f\u5ea6\u6784\u6210\u96c6\u5408 $X$\uff0c\u53d6\u51fa $X$ \u4e2d\u4e00\u4e2a\u5143\u7d20 $x$\u3002\n\n\u501f\u7528\u540c\u4f59\u6700\u77ed\u8def\u7684\u601d\u60f3\uff0c\u8bbe $\\text{mindis}_i$ \u8868\u793a $\\bmod\\ x=i$ \u7684\u6240\u6709\u957f\u5ea6\u4e2d\uff0c\u80fd\u88ab $X$ \u4e2d\u5143\u7d20\u6240\u62fc\u51fa\u7684\u6700\u5c0f\u957f\u5ea6\u3002\u5219\u80fd\u591f\u88ab\u62fc\u51fa\u7684\uff0c\u957f\u5ea6 $\\bmod\\ x=i$ \u7684\u4e32\u957f\u4e3a $\\text{mindis}_i+k\\times x$\u3002\u53ef\u4ee5\u901a\u8fc7\u8be5\u6570\u7ec4\u5feb\u901f\u6c42\u51fa\u7b54\u6848\u3002\n\n\u5219\u73b0\u5728\u9700\u8981\u505a\u7684\u662f\u52a0\u901f\u540c\u4f59\u6700\u77ed\u8def\u7684\u8fc7\u7a0b\uff0c\u5feb\u901f\u6c42\u51fa $\\text{mindis}_i$\u3002\n\n\u8003\u8651\u4ee5\u4e0b\u7ed3\u8bba\uff1a\n\n> \u4e00\u4e2a\u5b57\u7b26\u4e32 $S$ \u7684 $\\text{border}$ \u957f\u5ea6\u6784\u6210 $\\mathcal{O}(\\log n)$ \u4e2a\u7b49\u5dee\u6570\u5217\u3002\n\n\u800c $\\text{period}$ \u5bf9\u5e94 $\\text{border}$\uff0c\u6240\u4ee5\u4e5f\u662f\u7b49\u5dee\u6570\u5217\u3002\u8fd9\u542f\u53d1\u6211\u4eec\u5c06\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u4e2d\u7684 $\\text{border}$ \u653e\u5728\u4e00\u8d77\u8003\u8651\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u7b49\u5dee\u6570\u5217 $a,a+b,a+2b\\cdots a+kb$\uff0c\u82e5\u5f53\u524d\u5df2\u7ecf\u5f97\u5230\u4e4b\u524d\u7684\u7b49\u5dee\u6570\u5217\u6240\u6c42\u51fa\u7684\uff0c$\\bmod\\ a$ \u610f\u4e49\u4e0b\u7684 $\\text{mindis}_i$\uff0c\u8003\u8651\u5982\u4f55\u5feb\u901f\u7528\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u66f4\u65b0\u8be5\u6570\u7ec4\u3002\n\n\u5728 $\\bmod\\ a$ \u610f\u4e49\u4e0b\uff0c\u516c\u5dee\u4e3a $b$ \u7684\u7b49\u5dee\u6570\u5217\u5c06\u6240\u6709 $[0,a-1]$ \u4e2d\u7684\u5143\u7d20\u5212\u5206\u4e3a $\\gcd(a,b)$ \u4e2a\u7b49\u4ef7\u7c7b\uff0c\u6bcf\u4e2a\u7b49\u4ef7\u7c7b\u4e92\u4e0d\u5e72\u6270\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u7b49\u4ef7\u7c7b\uff0c\u627e\u51fa\u5176\u4e2d $\\text{mindis}$ \u503c\u6700\u5c0f\u7684\u4f4d\u7f6e $p$\uff0c\u663e\u7136\u5728\u8fd9\u8f6e\u66f4\u65b0\u4e2d\uff0c$\\text{mindis}_p$ \u4e0d\u6539\u53d8\u3002\u5219\u4ece $p$ \u5f00\u59cb\uff0c\u6bcf\u6b21\u8003\u8651\u4f7f\u7528\u7b49\u5dee\u6570\u5217\u4e2d\u4e00\u4e2a\u5143\u7d20\u6765\u66f4\u65b0\u540e\u9762\u7684\u5143\u7d20\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u4e0b\u6807\u4e3a $q$ \u7684\u4f4d\u7f6e\uff0c\u82e5 $q-p\\le k$\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 $\\text{mindis}_p+(q-p)\\times b$ \u6765\u66f4\u65b0 $\\text{mindis}_q$\u3002\uff08\u6b64\u5904\u5c06\u5728 $\\bmod\\ a$ \u610f\u4e49\u4e0b\u7684\u73af\u5c55\u5f00\uff0c\u5e76\u8ba4\u4e3a $p$ \u662f\u5176\u4e2d\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u5219 $q>p$\uff09\n\n\u8fd9\u663e\u7136\u53ef\u4ee5\u4f7f\u7528\u5355\u8c03\u961f\u5217\u6765\u5b9e\u73b0\u3002 \n\n\u8fd8\u5269\u4e0b\u4e00\u4e2a\u95ee\u9898\uff0c\u6c42\u89e3\u5b8c\u5f53\u524d\u7b49\u5dee\u6570\u5217\u540e\uff0c\u5982\u4f55\u8df3\u8f6c\u5230\u4e0b\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\uff1f\u5bf9\u4e8e\u4e00\u4e2a\u9996\u9879\u4e3a $a_1$ \u7684\u7b49\u5dee\u6570\u5217\uff0c\u6c42\u89e3\u5b8c\u540e $\\text{mindis}$ \u662f\u5728 $\\bmod\\ a_1$ \u7684\u610f\u4e49\u4e0b\uff0c\u800c\u4e0b\u4e00\u4e2a\u9996\u9879\u4e3a $a_2$ \u7684\u7b49\u5dee\u6570\u5217\u4e2d\u9700\u5728 $\\bmod\\ a_2$ \u610f\u4e49\u4e0b\u8fdb\u884c\u3002\n\n\u9996\u5148\uff0c\u53ef\u4ee5\u4f7f\u7528 $\\text{mindis}_x$ \u8f6c\u79fb\u5230 $\\text{mindis'}_{\\text{mindis}_x\\bmod a_2}$\uff0c\u540c\u65f6\uff0c\u8fd8\u9700\u8981\u8003\u8651\u6bcf\u4e00\u4e2a\u957f\u5ea6\u4e3a $a_1$ \u7684\u8f6c\u79fb\uff0c\u5373 $\\text{mindis}_x+k\\times a_1$ \u4e5f\u53ef\u80fd\u66f4\u65b0 $\\text{mindis'}$\u3002\u8fd9\u548c\u4e0a\u9762\u662f\u7c7b\u4f3c\u7684\u95ee\u9898\uff0c\u4f46\u662f\u7531\u4e8e\u6ca1\u6709\u9879\u6570\u9650\u5236\uff0c\u6240\u4ee5\u751a\u81f3\u4e0d\u7528\u5355\u8c03\u961f\u5217\uff0c\u8bb0\u4e00\u4e2a\u524d\u7f00 $\\min$ \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(T\\times n\\log n)$\u3002\n\n```cpp\n//Code By CXY07\n#include<bits/stdc++.h>\nusing namespace std;\n\n//#define FILE\n#define int long long\n#define file(FILENAME) freopen(FILENAME\".in\", \"r\", stdin), freopen(FILENAME\".out\", \"w\", stdout)\n#define randint(l, r) (rand() % ((r) - (l) + 1) + (l))\n#define LINE() cout << \"LINE = \" << __LINE__ << endl\n#define debug(x) cout << #x << \" = \" << x << endl\n#define abs(x) ((x) < 0 ? (-(x)) : (x))\n#define min(a, b) (a < b ? a : b)\n#define inv(x) qpow((x), mod - 2)\n#define lowbit(x) ((x) & (-(x)))\n#define ull unsigned long long\n#define pii pair<int, int>\n#define LL long long\n#define mp make_pair\n#define pb push_back\n#define scd second\n#define vec vector\n#define fst first\n#define endl '\\n'\n\nconst int MAXN = 5e5 + 10;\nconst int INF = 1.1e18;\nconst double PI = acos(-1);\nconst double eps = 1e-6;\n//const int mod = 1e9 + 7;\n//const int mod = 998244353;\n//const int G = 3;\n//const int base = 131;\n\nint T, n, w, mod, Ans;\nint fail[MAXN], period[MAXN], cnt;\nint dis[MAXN];\nchar s[MAXN];\n\ntemplate<typename T> inline bool read(T &a) {\n\ta = 0; char c = getchar(); int f = 1;\n\twhile(c < '0' || c > '9') {if(c == '-') f = -1; c = getchar();}\n\twhile(c >= '0' && c <= '9') {a = a * 10 + (c ^ 48); c = getchar();}\n\ta *= f;\n\treturn 1;\n}\n\ntemplate<typename A, typename ...B>\ninline bool read(A &x, B &...y) {return read(x) && read(y...);}\n\nint Gcd(int x, int y) {\n\tif(!y) return x;\n\treturn Gcd(y, x % y);\n}\n\nvoid clear() {\n\tmemset(dis, 0x3f, sizeof dis);\n\tmemset(fail, 0, sizeof fail);\n}\n\nvoid GetPeriod() {\n\tfail[1] = 0, fail[0] = -1, cnt = 0;\n\tfor(int i = 2, j; i <= n; ++i) {\n\t\tj = fail[i - 1];\n\t\twhile((~j) && s[j + 1] != s[i]) j = fail[j];\n\t\tfail[i] = ++j;\n\t}\n\tfor(int i = fail[n]; ~i; i = fail[i]) period[++cnt] = n - i;\n} \n\nvoid _run(int p, int gap, int c) { // i % mod == p, mod...mod + gap * c\n\tstatic int t[MAXN], m, pos; m = 0, pos = -1;\n\tstatic int q[MAXN], head, tail; head = 1, tail = 0;\n\tfor(int i = p; ;) {\n\t\tif(pos == -1 || dis[i] < dis[pos]) pos = i;\n\t\ti = (i + gap) % mod; if(i == p) break;\n\t}\n\tfor(int i = pos; ;) {\n\t\tt[++m] = i; i = (i + gap) % mod;\n\t\tif(i == pos) break;\n\t} assert(m == mod / Gcd(gap, mod));\n\tq[++tail] = 1;\n\tfor(int i = 2; i <= m; ++i) {\n\t\twhile(head <= tail && i - q[head] > c) head++;\n\t\tif(head <= tail && i - q[head] <= c) dis[t[i]] = min(dis[t[i]], dis[t[q[head]]] + (i - q[head]) * gap + mod);\n\t\twhile(head <= tail && dis[t[i]] - i * gap < dis[t[q[tail]]] - q[tail] * gap) tail--;\n\t\tq[++tail] = i;\n\t}\n}\n\nvoid run(int gap, int c) { // mod...mod + gap * c\n\tint lim = Gcd(gap, mod);\n\tfor(int i = 0; i < lim; ++i) _run(i, gap, c);\n}\n\nvoid trans(int _new) { // mod -> _new\n\tstatic int _d[MAXN]; memset(_d, 0x3f, sizeof _d);\n\tstatic int t[MAXN], m;\n\tint lim = Gcd(mod, _new);\n\tfor(int i = 0; i < mod; ++i) _d[dis[i] % _new] = min(_d[dis[i] % _new], dis[i]);\n\tfor(int p = 0, pos, mn; p < lim; ++p) {\n\t\tpos = -1, m = 0, mn = INF;\n\t\tfor(int i = p; ;) {\n\t\t\tif(pos == -1 || _d[i] < _d[pos]) pos = i;\n\t\t\ti = (i + mod) % _new; if(i == p) break;\n\t\t}\n\t\tfor(int i = pos; ;) {\n\t\t\tt[++m] = i;\n\t\t\ti = (i + mod) % _new; if(i == pos) break;\n\t\t} assert(m == _new / lim);\n\t\tfor(int i = 1; i <= m; ++i) {\n\t\t\t_d[t[i]] = min(_d[t[i]], mn + i * mod);\n\t\t\tmn = min(mn, _d[t[i]] - i * mod);\n\t\t}\n\t}\n\tmod = _new;\n\tmemcpy(dis, _d, sizeof dis);\n}\n\nvoid calc() {\n\tint L = 1, R; mod = period[L];\n\twhile(L < cnt) {\n\t\tR = L + 1;\n\t\twhile(R + 1 <= cnt && period[R + 1] - period[R] == period[R] - period[R - 1]) R++;\n\t\trun(period[L + 1] - period[L], R - L);\n\t\tL = R + 1; if(L <= cnt) trans(period[L]);\n\t}\n}\n\nvoid solve() {\n\tAns = 0;\n\tclear(); read(n), read(w), scanf(\"%s\", s + 1); w -= n;\n\tGetPeriod(); dis[0] = 0; calc();\n\tfor(int i = 0; i < mod; ++i)\n\t\tif(dis[i] <= w) Ans = Ans + (w - dis[i]) / mod + 1;\n\tprintf(\"%lld\\n\", Ans);\n}\n\nsigned main () {\n#ifdef FILE\n\tfreopen(\"P4156.in\", \"r\", stdin);\n\tfreopen(\"P4156.out\", \"w\", stdout);\n#endif\n\tread(T);\n\twhile(T--) solve();\n\treturn 0;\n}\n```",
        "postTime": 1628857795,
        "uid": 53489,
        "name": "CXY07",
        "ccfLevel": 9,
        "title": "\u3010\u9898\u89e3\u3011P4156 [WC2016]\u8bba\u6218\u6346\u7af9\u7aff"
    },
    {
        "content": "\u4e0d\u77e5\u9053\u4e3a\u5565BZOJ\u8fc7\u4e86\uff0c~~UOJ\u88abHack\u4e86~~\uff08\u77e5\u9053\u54ea\u9519\u4e86\uff0c\u4e0d\u80fd\u8dd1$\\log$\u6b21Dijkstra\uff0c\u8fd8\u8981\u52a0\u4e0a\u53d6\u6a21\u4f18\u5316\uff09\uff0c~~\u6d1b\u8c37\u5fc5\u987b\u7279\u5224\u5c0f\u6570\u636e\u624d\u80fdA...~~\uff08\u6211\u662f\u6d1b\u8c37\u6700\u4f18\u89e3\u54e6\uff09\n\n\u4e4b\u524d\u505a\u8fc7\u540c\u4f59\u7c7b\u6700\u77ed\u8def\u7528\u5355\u8c03\u961f\u5217\u4f18\u5316\u7684\u9898\uff0c\u4e5f\u77e5\u9053border\u5f62\u6210\u4e86log\u4e2a\u7b49\u5dee\u6570\u5217\uff0c\u5c31\u662f\u592a\u83dc\u4e86\u6ca1\u60f3\u51fa\u6765\u8fd9\u9053\u9898\u3002zz\u9519\u8bef\u8c03\u4e86\u4e00\u4e0b\u5348...\n\n\u9996\u5148\u8fd9\u9053\u9898\u7684$O(n^2)$\u66b4\u529b\u5f88\u597d\u60f3\uff1a\u6211\u4eec\u5c31\u66b4\u529b\u8dd1\u540c\u4f59\u7c7b\u6700\u77ed\u8def\u3002\n\n\u7136\u540e\u6211\u4eec\u8981\u6316\u6398border\u7684\u6027\u8d28\u2014\u2014**border\u5f62\u6210\u4e86log\u4e2a\u7b49\u5dee\u6570\u5217\uff01** \u8bc1\u660e\u7684\u8bdd\u753b\u56fe\u5c31\u660e\u767d\u4e86\uff0c\u5728\u6bcf\u6b21\u7b49\u5dee\u6570\u5217\u5207\u6362\u7684\u65f6\u5019\u957f\u5ea6\u81f3\u5c11$\\times 2$\n\n\u6211\u4eec\u8003\u8651\u4e00\u7ec4\u7b49\u5dee\u6570\u5217\uff0c\u5f62\u6210\u7684\u51fa\u8fb9\u5f62\u5982$x,x+d,...,x+(len-1)\\times d$\u3002\u8bf6\uff0c\u4f60\u53d1\u73b0\u8fd9\u4e2a\u8f6c\u79fb\u662f\u7c7b\u4f3c\u201c\u533a\u95f4\u6700\u5c0f\u503c\u201d\u7684\u8f6c\u79fb\uff0c\u6216\u8005\u8bf4\u7c7b\u4f3c\u591a\u91cd\u80cc\u5305\u7684\u8f6c\u79fb\u3002\u6211\u4eec\u6ce8\u610f\u5230\u8fd9\u5f62\u6210\u4e86\u4e86$\\gcd(d,md)$\u4e2a\u73af\uff0c\u73af\u4e4b\u95f4\u72ec\u7acb\u3002\u73af\u5185\u90e8\uff0c\u6700\u5c0f\u7684\u70b9\u4e0d\u4f1a\u88ab\u5176\u4ed6\u70b9\u66f4\u65b0\uff0c\u90a3\u4e48\u6211\u4eec\u4ee5\u5b83\u4e3a\u8d77\u70b9\uff0c\u901a\u8fc7\u5355\u8c03\u961f\u5217\u6c42\u6700\u77ed\u8def\u5373\u53ef\u3002\n\n\u5982\u4f55\u4ece$\\bmod~p_1$\u5269\u4f59\u7cfb\u8f6c\u5230$\\bmod~p_2$\u5269\u4f59\u7cfb\u5462\uff1f\u6211\u4eec\u5148\u628a\u8bb0\u5f55\u7684$p_1$\u4e2a\u4fe1\u606f\u8f6c\u5230$p_2$\u4e0a\uff0c\u7136\u540e\u4ece\u4e00\u4e2a\u70b9\u51fa\u53d1\u53ef\u4ee5\u4efb\u610f$+p_1$\uff0c\u6240\u4ee5\u6211\u4eec\u518d\u8dd1\u4e00\u904d\u540c\u4f59\u7c7b\u6700\u77ed\u8def\uff0c\u8fd9\u6b21\u4e0d\u9700\u8981\u7ef4\u62a4\u5355\u8c03\u961f\u5217\u4e86\uff0c\u53ea\u9700\u8981\u7ef4\u62a4\u524d\u7f00\u6700\u5c0f\u503c\u5c31\u884c\u3002\n\n```cpp\n#define N 500005\n#define pli pair<LL,int>\nconst LL llinf=0x3f3f3f3f3f3f3f3f;\nLL d[N];\nint n;\nLL h;\nchar s[N];\nint nx[N],e[N],cnte;\nint md;\nil int fit(const int x) {return x>=md?x-md:x;}\nLL solve()\n{\n\tif(h<n) return 0;\n\tfor(ri i=2,j=0; i<=n; ++i)\n\t{\n\t\twhile(j!=-1&&s[j+1]!=s[i]) j=nx[j];\n\t\tnx[i]=++j;\n\t}\n\tif(!nx[n]) return h/n;\n\te[cnte=1]=nx[n];\n\twhile(e[cnte]) e[cnte+1]=nx[e[cnte]],++cnte;\n\tfor(ri i=1; i<=cnte; ++i) e[i]=n-e[i];\n\tmem(d,0x3f); d[n%e[1]]=n;\n\tint premd=0;\n\tfor(ri l=1; l<=cnte; ++l)\n\t{\n\t\tmd=e[l];\n\t\tif(premd)\n\t\t{\n\t\t\tstatic LL d2[N];\n\t\t\tmemcpy(d2,d,sizeof(LL)*premd);\n\t\t\tmemset(d,0x3f,sizeof(LL)*md);\n\t\t\tfor(ri i=0; i<premd; ++i) if(d2[i]<llinf) ckmin(d[d2[i]%md],d2[i]);\n\t\t\tint g=__gcd(premd,md);\n\t\t\tfor(ri r=0; r<g; ++r)\n\t\t\t{\n\t\t\t\tLL mn=d[r]; int mnk=r;\n\t\t\t\tfor(ri p=fit(r+g); p!=r; p=fit(p+g))\n\t\t\t\t\tif(ckmin(mn,d[p])) mnk=p;\n\t\t\t\tfor(ri p=fit(mnk+premd),i=1; p!=mnk; p=fit(p+premd),++i)\n\t\t\t\t{\n\t\t\t\t\tckmin(d[p],mn+(LL)i*premd);\n\t\t\t\t\tckmin(mn,d[p]-(LL)i*premd);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(l==cnte) {premd=md; break;}\n\t\tint r=l+1,c=e[r]-e[l],g=__gcd(c,md);\n\t\twhile(r<n&&e[r+1]-e[r]==c) ++r;\n\t\tint len=r-l;\n\t\tfor(r=0; r<g; ++r)\n\t\t{\n\t\t\tLL mn=d[r]; int mnk=r;\n\t\t\tfor(ri p=fit(r+g); p!=r; p=fit(p+g))\n\t\t\t\tif(ckmin(mn,d[p])) mnk=p;\n\t\t\tstatic pli q[N]; int hd,tl;\n\t\t\tq[hd=tl=1]=mp(mn,0);\n\t\t\tfor(ri p=fit(mnk+c),i=1; p!=mnk; p=fit(p+c),++i)\n\t\t\t{\n\t\t\t\twhile(hd<=tl&&q[hd].se<i-len) ++hd;\n\t\t\t\tckmin(d[p],q[hd].fi+md+(LL)i*c);\n\t\t\t\twhile(hd<=tl&&q[tl].fi>=d[p]-(LL)i*c) --tl;\n\t\t\t\tq[++tl]=mp(d[p]-(LL)i*c,i);\n\t\t\t}\n\t\t}\n\t\tl+=len,premd=md;\n\t}\n\tLL ans=0;\n\tfor(ri i=0; i<premd; ++i)\n\t\tif(d[i]<=h) ans+=1+(h-d[i])/premd;\n\treturn ans;\n}\nsigned main()\n{\n#ifdef M207\n\tfreopen(\"in.in\",\"r\",stdin);\n\t// freopen(\"ot.out\",\"w\",stdout);\n#endif\n\tint T; in(T);\n\tnx[0]=-1;\n\twhile(T--)\n\t{\n\t\tin(n,h);\n\t\tscanf(\"%s\",s+1);\n\t\tout(solve());\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1561113360,
        "uid": 58302,
        "name": "i207M",
        "ccfLevel": 0,
        "title": "\u540c\u4f59\u7c7b\u6700\u77ed\u8def+\u5355\u8c03\u961f\u5217-[WC2016]\u8bba\u6218\u6346\u7af9\u7aff-\u89e3\u9898\u62a5\u544a"
    },
    {
        "content": "\u770b\u5230\u521d\u4e8c\u7684\u5b66\u5f1f\u5df2\u7ecf\u5f00\u59cb\u5377\u8fd9\u4e9b\u4e86\uff0c\u975e\u5e38\u6050\u6016\u3002\u8fd9\u5c31\u662f\u6211\u6821\u521d\u4e8c\u771f\u5b9e\u5b9e\u529b\u5417\uff1f\n\n[P4156 [WC2016]\u8bba\u6218\u6346\u7af9\u7aff](https://www.luogu.com.cn/problem/P4156)\u89e3\u9898\u62a5\u544a\uff1a\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://zybuluo.com/xiaoziyao/note/1813266)\n\n## \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5b57\u7b26\u4e32 $S$\uff0c\u4e00\u5f00\u59cb\u6709\u4e00\u4e2a\u7a7a\u4e32\uff0c\u6bcf\u6b21\u53ef\u4ee5\u5c06\u4e00\u4e2a\u65b0\u7684 $S$ \u53bb\u6389\u4e00\u4e2a Border \u540e\u62fc\u4e0a\u53bb\uff0c\u6c42\u957f\u5ea6\u533a\u95f4 $[n,w]$ \u5185\u6709\u591a\u5c11\u957f\u5ea6\u53ef\u4ee5\u88ab\u62fc\u51fa\u6765\u3002\uff08$1\\leqslant n\\leqslant 5\\times 10^5,1\\leqslant 10^{18}$\uff09\n\n## \u5206\u6790\n\n\u5999\u5999\u9898\u3002\n\n\u90a3\u4e48\u6211\u4eec\u7528 kmp \u6c42\u51fa\u6240\u6709 Border\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5f97\u5230\u6240\u6709\u5468\u671f $c_{1\\cdots k}$\uff0c\u6211\u4eec\u7684\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42 $\\sum_{i=1}^k a_ic_i$ \u5728\u533a\u95f4 $[0,n-w]$ \u4e2d\u53ef\u4ee5\u6709\u591a\u5c11\u53d6\u503c\u3002\n\n\u6211\u4eec\u8003\u8651\u968f\u4fbf\u53d6\u4e00\u4e2a\u4e0d\u5c0f\u4e8e\u6240\u6709 $c_i$ \u7684\u6a21\u6570 $mod$\uff0c\u5bf9\u4e8e\u6240\u6709 $i\\in[0,mod-1]$\uff0c\u6c42\u51fa\u6700\u5c0f\u7684 $k$ \u4f7f\u5f97 $k\\equiv i\\pmod{mod}$\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u7b97\u4e86\u3002\n\n\u8fd9\u660e\u663e\u662f\u540c\u4f59\u6700\u77ed\u8def\u6a21\u578b\uff0c\u6211\u4eec\u5982\u679c\u76f4\u63a5\u53d6\u6240\u6709 $c_i$ \u7684\u6700\u5927\u503c\u4e3a\u6a21\u6570\uff0c\u8ba9\u6240\u6709\u70b9 $x$ \u90fd\u8fde\u82e5\u5e72\u6761\u8fb9\u5230 $x+c_1,x+c_2,\\cdots,x+c_k$ \u8dd1\u4e00\u904d\u6700\u77ed\u8def\u590d\u6742\u5ea6\u5c31\u662f $O(n^2)$\uff0c\u6709\u66b4\u529b\u5206\u3002\n\n\u6211\u4eec\u80af\u5b9a\u4e0d\u4f1a\u628a\u6240\u6709\u8fb9\u5efa\u51fa\u6765\uff0c\u4e8e\u662f\u6211\u4eec\u8003\u8651\u53e6\u4e00\u79cd\u66b4\u529b\uff0c\u5bf9\u4e8e\u6bcf\u4e2a $c_i$ \u5355\u72ec\u5c06\u5b83\u7684\u8fb9\u66f4\u65b0\uff0c\u6bcf\u6b21\u7ee7\u627f\u4e0a\u4e00\u6b21\u7684\u6700\u77ed\u8def\u6570\u7ec4\u3002\n\n\u4f46\u662f\u5982\u4f55\u66f4\u65b0\u4ecd\u7136\u662f\u95ee\u9898\uff0c\u4e0d\u96be\u53d1\u73b0\u5bf9\u4e8e\u4e32\u957f $len$ \u6700\u77ed\u8def\u56fe\u53ef\u4ee5\u5206\u6210 $\\gcd(n,len)$ \u4e2a\u90e8\u5206\uff0c\u6bcf\u4e2a\u90e8\u5206\u4e4b\u95f4\u6ca1\u6709\u8fb9\u76f8\u8fde\uff0c\u4e14\u6bcf\u4e2a\u90e8\u5206\u4e8b\u5b9e\u4e0a\u5c31\u662f\u4ece\u6bcf\u4e2a\u4f4d\u7f6e\u5f00\u59cb\u6bcf\u6b21\u5411\u540e\u8d70 $len$ \u6b65\u7684\u6240\u6709\u70b9\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u6574\u4e2a\u56fe\u53d8\u6210\u82e5\u5e72\u4e2a\u90e8\u5206\uff0c\u6bcf\u4e2a\u90e8\u5206\u4ece\u6700\u5c0f\u7684\u4f4d\u7f6e\u4e00\u6b65\u6b65\u66f4\u65b0\u5230\u540e\u9762\u76f4\u5230\u91cd\u5408\u5c31\u597d\u4e86\uff0c\u4f46\u8fd9\u6837\u4ecd\u7136\u662f $O(n^2)$ \u7684\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0c\u4e00\u4e2a\u7b80\u5355\u7684\u7ed3\u8bba\u53ef\u4ee5\u5927\u5927\u964d\u4f4e\u590d\u6742\u5ea6\uff1a\u4e00\u4e2a\u5b57\u7b26\u4e32\u6240\u6709\u7684 Border \u6392\u5e8f\u540e\uff0c\u957f\u5ea6\u4f1a\u5f62\u6210 $O(\\log n)$ \u4e2a\u7b49\u5dee\u6570\u5217\u3002\n\n\u8fd9\u542f\u53d1\u6211\u4eec\u5c06\u7b49\u5dee\u6570\u5217\u653e\u5728\u4e00\u8d77\u8dd1\u6700\u77ed\u8def\uff0c\u5177\u4f53\u5730\uff0c\u6211\u4eec\u53d1\u73b0\u5bf9\u4e8e\u4e00\u4e2a\u9996\u9879\u4e3a $len$\uff0c\u516c\u5dee\u4e3a $dif$\uff0c\u9879\u6570\u4e3a $tot$ \u7684\u7b49\u5dee\u6570\u5217\uff0c\u6211\u4eec\u5e76\u4e0d\u597d\u5904\u7406\u9996\u9879\uff0c\u4e8e\u662f\u53ef\u4ee5\u76f4\u63a5\u628a\u9996\u9879\u5f53\u6210\u4e00\u4e2a\u516c\u5dee\u4e3a $len$\uff0c\u9879\u6570\u4e3a $1$ \u7684\u7b49\u5dee\u6570\u5217\u7684\u516c\u5dee\u5904\u7406\u3002\n\n\u6b64\u65f6\u4e0d\u96be\u53d1\u73b0\u5ffd\u7565\u4e86\u9996\u9879\u957f\u5ea6\u540e\uff0c\u4e00\u4e2a\u957f\u5ea6\u4e3a $tot$ \u7684\u7b49\u5dee\u6570\u5217\u5c31\u662f\u5411\u524d\u8fde $tot$ \u6761\u8fb9\uff0c\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u76f4\u63a5\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u3002\n\n\u4ee3\u7801\u4e5f\u5f88\u597d\u5199\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(Tn\\log n)$\u3002\n\n## \u4ee3\u7801\n\n```\n#include<stdio.h>\n#include<iostream>\nusing namespace std;\nconst int maxn=500005;\nint T,n,cs,pos;\nint p[maxn],c[maxn];\nlong long w,ans;\nlong long dis[maxn],tmp[maxn];\npair<int,long long>q[maxn];\nstring s; \nint gcd(int a,int b){\n\treturn b==0? a:gcd(b,a%b);\n}\nvoid getborder(){\n\tcs=0,p[0]=0;\n\tfor(int i=1;i<n;i++){\n\t\tint j=p[i-1];\n\t\twhile(j&&s[i]!=s[j])\n\t\t\tj=p[j-1];\n\t\tif(s[i]==s[j])\n\t\t\tj++;\n\t\tp[i]=j;\n\t}\n\tfor(int i=p[n-1];i;i=p[i-1])\n\t\tc[++cs]=n-i;\n\tc[++cs]=n;\n}\nvoid getdis(int newpos,int len,int dif,int tot){\n\tint mod=c[newpos],g=gcd(dif,mod);\n\tfor(int i=0;i<g;i++){\n\t\tint st=i;\n\t\tfor(int j=(i+dif)%mod;j!=i;j=(j+dif)%mod)\n\t\t\tif(dis[j]<dis[st])\n\t\t\t\tst=j;\n\t\tint l=1,r=0;\n\t\tq[++r]=make_pair(0,dis[st]);\n\t\tfor(int j=(st+dif)%mod,k=1;j!=st;j=(j+dif)%mod,k++){\n\t\t\twhile(l<=r&&k-q[l].first>tot)\n\t\t\t\tl++;\n\t\t\tdis[j]=min(dis[j],q[l].second+1ll*(k-q[l].first)*dif+len);\n\t\t\twhile(l<=r&&q[r].second+1ll*(k-q[r].first)*dif>=dis[j])\n\t\t\t\tr--;\n\t\t\tq[++r]=make_pair(k,dis[j]);\n\t\t}\n\t}\n\tpos=newpos;\n}\nvoid solve(){\n\tfor(int i=0;i<c[1];i++)\n\t\tdis[i]=w+1;\n\tpos=1,dis[n%c[1]]=n;\n\tint l=1,r;\n\twhile(l<cs){\n\t\tfor(r=l+1;r<=cs&&c[r]-c[r-1]==c[l+1]-c[l];r++);\n\t\tr--;\n\t\tif(l<r)\n\t\t\tgetdis(l,c[l],c[l+1]-c[l],r-l);\n\t\tif(r+1<=cs){\n\t\t\tfor(int i=0;i<c[r+1];i++)\n\t\t\t\ttmp[i]=w+1;\n\t\t\tfor(int i=0;i<c[l];i++)\n\t\t\t\ttmp[dis[i]%c[r+1]]=min(tmp[dis[i]%c[r+1]],dis[i]);\n\t\t\tfor(int i=0;i<c[r+1];i++)\n\t\t\t\tdis[i]=tmp[i];\n\t\t\tgetdis(r+1,0,c[l],1);\n\t\t}\n\t\tl=r+1;\n\t}\n}\nint main(){\n\tscanf(\"%d\",&T);\n\twhile(T--){\n\t\tscanf(\"%d%lld\",&n,&w),cin>>s;\n\t\tgetborder(),solve();\n\t\tans=0;\n\t\tfor(int i=0;i<c[pos];i++)\n\t\t\tif(dis[i]<=w)\n\t\t\t\tans+=(w-dis[i])/c[pos]+1;\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1628002723,
        "uid": 35754,
        "name": "Verdandi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4156\u3010[WC2016]\u8bba\u6218\u6346\u7af9\u7aff\u3011"
    },
    {
        "content": "- [uoj](https://uoj.ac/problem/172)\n\n- [\u6d1b\u8c37](https://www.luogu.com.cn/problem/P4156)\n\n- [\u53ef\u80fd\u66f4\u597d\u7684\u4f53\u9a8c](https://www.cnblogs.com/tqxboomzero/p/14686995.html)\n\n## Description\n\n\u7ed9\u5b9a\u5b57\u7b26\u4e32 $S$\uff0c\u4f60\u53ef\u4ee5\u6267\u884c\u4e00\u79cd\u64cd\u4f5c\uff0c\u5c06 $S$ \u62fc\u63a5\u5230\u5f53\u524d\u5b57\u7b26\u4e32\u540e\uff0c\u53ef\u4ee5\u91cd\u53e0\uff0c\u4f46\u91cd\u53e0\u7684\u4f4d\u7f6e\u5fc5\u987b\u5bf9\u4f4d\u76f8\u7b49\uff0c\u8981\u6c42\u6700\u7ec8\u5b57\u7b26\u4e32\u957f\u5ea6\u4e0d\u8d85\u8fc7 $m$\uff0c\u73b0\u5728\u8bf7\u4f60\u8ba1\u7b97\u6700\u7ec8\u5f97\u5230\u5b57\u7b26\u4e32\u7684\u6240\u6709\u53ef\u80fd\u957f\u5ea6\u6570\u91cf\u3002$|S|\\le 5\\times 10^5,m\\le 10^{18}$\n\n## Solution\n\n\u9996\u5148\u91cd\u53e0\u7684\u90e8\u5206\u4e00\u5b9a\u662f $s$ \u7684\u4e00\u4e2a $border$\uff0c\u56e0\u6b64\u6bcf\u6b21\u64cd\u4f5c\u5c31\u7b49\u4e8e\u662f\u7ed9\u539f\u4e32\u589e\u52a0 $|s|-$ \u539f\u4e32\u7684\u4e00\u4e2a $border$ \u7684\u957f\u5ea6\u3002\u5148 $kmp$ \u6c42\u51fa\u6240\u6709\u7684 $|s|-border$ \u957f\u5ea6\uff0c\u8bbe\u4e3a $\\{x_i\\}$\uff0c\u90a3\u4e48\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u89e3 $\\sum_{i=1}^{sum}a_ix_i$ \u5728 $[0,m-|s|]$ \u8303\u56f4\u5185\u80fd\u53d6\u5230\u591a\u5c11\u4e2a\u4e0d\u540c\u7684\u503c\u3002\n\n\u5bb9\u6613\u770b\u51fa\uff0c\u8fd9\u662f\u540c\u4f59\u6700\u77ed\u8def\u7684\u5f62\u5f0f\uff0c\u7528\u540c\u4f59\u6700\u77ed\u8def\u89e3\u51b3\u8fd9\u6837\u7684\u95ee\u9898\uff0c\u5c31\u662f\u5c06 $x$ \u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u4ee5 $x_1$ \u4f5c\u4e3a\u6a21\u6570\uff0c\u5bf9 $0\\sim x_1-1$\u5206\u522b\u5efa\u70b9\uff0c\u5bf9 $\\forall i\\in [2,sum],j\\in [0,x_1-1]$ \uff0c\u4ece $j$ \u5411 $(x_i+j)\\bmod x_1$ \u5efa\u4e00\u6761\u8fb9\u6743\u4e3a $x_i$ \u7684\u8fb9\uff0c\u7136\u540e\u8dd1\u6700\u77ed\u8def\uff0c$dis_i$ \u5c31\u8868\u793a\u7528 $x_2\\dots x_{sum}$ \u80fd\u8868\u793a\u51fa\u7684\u6700\u5c0f\u7684 $\\bmod x_1=i$ \u7684\u6570\uff0c\u90a3\u4e48$\\le dis_i$ \u7684\u6240\u6709 $\\bmod x_1=i$ \u7684\u6570\u90fd\u80fd\u88ab\u8868\u793a\u51fa\u6765\uff0c\u5c31\u53ef\u4ee5\u6c42\u51fa\u7b54\u6848\u4e86\u3002\n\n\u66b4\u529b\u505a\u540c\u4f59\u6700\u77ed\u8def\uff0c\u590d\u6742\u5ea6\u662f $\\mathcal O(n^2\\log n)$\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u9996\u5148\u5f15\u5165\u5b57\u7b26\u4e32\u7684\u4e00\u4e2a\u91cd\u8981\u6027\u8d28\uff1a**\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5b83\u7684 $border$ \u957f\u5ea6\u4e00\u5b9a\u4f1a\u6784\u6210 $\\mathcal O(\\log n)$\u4e2a\u7b49\u5dee\u6570\u5217\u3002**\n\n\u7531\u4e8e\u535a\u4e3b\u592a\u83dc\uff0c\u5728\u6b64\u5c31\u4e0d\u7ed9\u51fa\u8bc1\u660e\u4e86\u3002\n\n\u73b0\u5728\u6211\u4eec\u5047\u8bbe $\\{x_i\\}$ \u662f\u4e00\u4e2a\u9996\u9879\u4e3a $x$ \uff0c\u516c\u5dee\u4e3a $d$ \uff0c\u957f\u5ea6\u4e3a $len$ \u7684\u7b49\u5dee\u6570\u5217\uff0c\u8003\u8651\u6c42\u51fa\u5176\u7b54\u6848\u3002\n\n\u6309\u540c\u4f59\u6700\u77ed\u8def\u7684\u65b9\u5f0f\u5efa\u8fb9\uff0c\u6700\u7ec8\u4e00\u5b9a\u4f1a\u8fde\u51fa $\\gcd(d,x)$ \u4e2a\u73af\uff0c\u6bcf\u4e2a\u73af\u4e92\u76f8\u72ec\u7acb\u3002\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u73af\uff0c\u73af\u4e0a $dis$ \u6700\u5c0f\u7684\u70b9\u4e00\u5b9a\u4e0d\u4f1a\u88ab\u5176\u4ed6\u70b9\u677e\u5f1b\uff0c\u56e0\u6b64\u4ee5\u5b83\u4f5c\u4e3a\u8d77\u70b9\uff0c\u4f9d\u6b21\u8003\u8651\u73af\u4e0a\u6bcf\u4e2a\u70b9\uff0c\u4f1a\u677e\u5f1b\u5230\u5b83\u7684\u70b9\u4e0e\u5b83\u7684\u8ddd\u79bb\u5e94\u5f53\u4e0d\u8d85\u8fc7 $len-1$\uff0c\u56e0\u6b64\u5982\u679c\u70b9 $j$ \u6bd4\u70b9 $i$ \u8ddd\u79bb\u63a5\u4e0b\u6765\u7684\u70b9\u66f4\u8fd1\uff0c\u4e14 $dis_j>dis_i+w(i,j)$\uff0c\u90a3\u4e48 $i$ \u7684\u677e\u5f1b\u4e00\u5b9a\u52a3\u4e8e $j$\uff0c\u53ef\u4ee5\u5f39\u51fa $j$\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\uff0c\u81f3\u6b64\u6211\u4eec\u5c31\u5b8c\u6210\u4e86 $\\mathcal O(n)$ \u6c42\u51fa\u8fd9\u79cd\u60c5\u51b5\u4e0b\u7684\u7b54\u6848\u3002\n\n\u56de\u5230\u539f\u95ee\u9898\uff0c\u73b0\u5728\u6211\u4eec\u80fd\u591f\u5b8c\u6210\u6bcf\u4e2a\u7b49\u5dee\u6570\u5217\u5185\u90e8\u7684\u8f6c\u79fb\u4e86\uff0c\u8fd8\u6709\u8003\u8651\u524d\u540e\u4e24\u4e2a\u7b49\u5dee\u6570\u5217\u7684\u7ec4\u5408\uff0c\u8bbe\u524d\u4e00\u4e2a\u7684\u9996\u9879\u4e3a $u$\uff0c\u540e\u4e00\u4e2a\u7684\u9996\u9879\u4e3a $v$\uff0c\u73b0\u5728\u8981\u4ece $\\bmod u$ \u7684\u7b54\u6848\u8f6c\u79fb\u5230 $\\bmod v$ \u7684\u7b54\u6848\u4e0a\uff0c\u9996\u5148\u53ef\u4ee5\u5c06 $dis_x$ \u8f6c\u79fb\u5230\u65b0\u7684 $dis_{dis_x\\bmod v}$ \u4e0a\uff0c\u4f46\u540c\u65f6\u6211\u4eec\u8fd8\u8981\u8003\u8651\u957f\u4e3a $u$ \u7684\u8f6c\u79fb\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u770b\u4f5c\u9996\u9879\u4e3a $0$\uff0c\u516c\u5dee\u4e3a $u$\uff0c\u957f\u5ea6\u4e3a $1$ \u7684\u7b49\u5dee\u6570\u5217\uff0c\u7528\u4e0a\u9762\u7684\u65b9\u6cd5\u5b8c\u6210\u5373\u53ef\u3002\n\n\u603b\u590d\u6742\u5ea6 $\\mathcal O(n \\log n)$\n\n## Code\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=2e6+10;\nint n,fail[N];\nchar s[N];\nint stk[N],top;\ninline void getborder(){\n\tfail[1]=0;\n\tfor(int i=2;i<=n;++i){\n\t\tfor(int j=fail[i-1];;j=fail[j]){\n\t\t\tif(s[j+1]==s[i]&&j+1!=i){fail[i]=j+1;break;}\n\t\t\tif(j==0){fail[i]=0;break;}\n\t\t}\n\t}\n\tint now=fail[n];top=0;\n\twhile(now){\n\t\tstk[++top]=n-now;\n\t\tnow=fail[now];\n\t}stk[++top]=n;\n}\n\nll m,dp[N],tmp[N],q[N][2];\nint l,r;\ninline void trans(int mod,int x,int del,int mxtrans){\n\tint g=__gcd(del,mod);\n\tfor(int T=0;T<g;++T){\n\t\tll mn=m+1,pos=-1;int cnt=0;\n\t\tfor(int j=T;;){\n\t\t\tif(j==T) if((++cnt)>1) break;\n\t\t\tif(dp[j]<mn) mn=dp[j],pos=j;\n\t\t\tj+=del;while(j>=mod) j-=mod;\n\t\t}\n\t\tcnt=0;\n\t\tif(pos==-1) continue;\n\t\tif(mxtrans==1){\n\t\t\tfor(int i=1,j=(pos+del)%mod,last=pos;j!=pos;++i){\n\t\t\t\tdp[j]=min(dp[j],dp[last]+del+x);\n\t\t\t\tlast=j;j+=del;while(j>=mod) j-=mod;\n\t\t\t}\n\t\t\tcontinue;\n\t\t}\n\t\tl=1;r=0;\n\t\tq[++r][0]=0;q[r][1]=mn;\n\t\tfor(int i=1,j=(pos+del)%mod;j!=pos;++i){\n\t\t\twhile(l<=r&&i-q[l][0]>mxtrans) ++l;\n\t\t\tdp[j]=min(dp[j],q[l][1]+1ll*(i-q[l][0])*del+x);\n\t\t\twhile(l<=r&&q[r][1]+1ll*(i-q[r][0])*del>dp[j]) --r;\n\t\t\tq[++r][0]=i;q[r][1]=dp[j];\n\t\t\tj+=del;while(j>=mod) j-=mod;\n\t\t}\n\t}\n}\nint main(){\n\tint tt;scanf(\"%d\",&tt);\n\twhile(tt--){\n\t\tscanf(\"%d%lld\",&n,&m);\n\t\tscanf(\"%s\",s+1);\n\t\tgetborder();\n\t\tfor(int j=0;j<stk[1];++j) dp[j]=m+1;\n\t\tdp[n%stk[1]]=n;\n\t\tint res=1;\n\t\tll ans=0;\n\t\tfor(int i=1,j=0;i<top;i=j+1){\n\t\t\tint del=stk[i+1]-stk[i];j=i+1;\n\t\t\twhile(j<=top&&stk[j]-stk[j-1]==del) ++j;--j;\n\t\t\tif(j>i) trans(stk[i],stk[i],del,j-i),res=i;\n\t\t\tif(j<top){\n\t\t\t\tfor(int k=0;k<stk[j+1];++k) tmp[k]=m+1;\n\t\t\t\tfor(int k=0;k<stk[i];++k){\n\t\t\t\t\tll x=dp[k]%stk[j+1];\n\t\t\t\t\ttmp[x]=min(tmp[x],dp[k]);\n\t\t\t\t}\n\t\t\t\tmemcpy(dp,tmp,sizeof(ll)*(stk[j+1]));\n\t\t\t\ttrans(stk[j+1],0,stk[i],1);res=j+1;\n\t\t\t}\n\t\t}\n\t\tfor(int i=0;i<stk[res];++i)\n\t\t\tif(dp[i]<=m) ans+=(m-dp[i])/stk[res]+1;\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1619145334,
        "uid": 66831,
        "name": "T_Q_X",
        "ccfLevel": 10,
        "title": "\u6d1b\u8c37P4156 [WC2016]\u8bba\u6218\u6346\u7af9\u7aff"
    },
    {
        "content": "\n\u9898\u76ee\uff1a\n\n> \u7af9\u6797\u91cc\u6709\u65e0\u6570\u6839\u5b8c\u5168\u4e00\u6837\u7684\u77ed\u7af9\u5b50,\u6bcf\u4e00\u6839\u7af9\u5b50\u7531 n \u8282\u7ec4\u6210,\u6bcf\u4e00\u8282\u90fd\u88ab\u67d3\u4e0a\u4e86\u989c\u8272,\u7af9\u5b50\u4e0d\u53ef\u4ee5\u98a0\u5012\u3002\n> \u6bcf\u6b21\u4f60\u53ef\u4ee5\u9009\u62e9\u4e00\u6839\u77ed\u7af9\u5b50,\u77ed\u7af9\u5b50\u5e95\u7aef\u82e5\u5e72\u8282(\u53ef\u4ee5\u662f 0\u8282)\u4e0e\u7af9\u7aff\u7684\u6700\u4e0a\u9762\u82e5\u5e72\u8282\u5bf9\u5e94\u5730\u4e00\u8282\u4e00\u8282\u6346\u8d77\u6765,\u800c\u77ed\u7af9\u5b50\u524d\u9762\u5269\u4e0b\u7684\u8282\u4f38\u51fa\u53bb,\u8fd9\u6837\u5c31\u5f97\u5230\u4e86\u4e00\u6839\u66f4\u957f\u7684\u7af9\u7aff\u3002\u5c0f W \u5bf9\u7af9\u7aff\u7684\u5ba1\u7f8e\u8981\u6c42\u5f88\u9ad8,\u4ed6\u6346\u7af9\u7aff\u65f6\u6709\u4e00\u4e2a\u7656\u597d:\u5982\u679c\u4e24\u6839\u7af9\u5b50\u7684\u67d0\u4e24\u8282\u88ab\u6346\u5728\u4e86\u4e00\u8d77,\u90a3\u4e48\u5b83\u4eec\u7684\u989c\u8272\u5fc5\u987b\u76f8\u540c\u3002\u73b0\u5728\u8bf7\u4f60\u6c42\u51fa\u5728\u7af9\u7aff\u957f\u5ea6\u8d85\u8fc7 w \u7684\u60c5\u51b5\u4e0b,\u5c0f W \u53ef\u4ee5\u6346\u51fa\u591a\u5c11\u79cd\u957f\u5ea6\u4e0d\u540c\u7684\u7af9\u7aff\u3002\u5176\u4e2d,\u7af9\u7aff\u7684\u957f\u5ea6\u6307\u4ece\u5e95\u7aef\u5230\u9876\u7aef\u7684\n> \u7af9\u5b50\u7684\u8282\u7684\u4e2a\u6570\u3002\n> $n \\le 5 \\cdot 10^5 ,w \\le 10^{18}$\u3002\n\n\u4f17\u6240\u5468\u77e5 $border$ \u6709\u4e00\u4e2a\u6027\u8d28\uff1a\n\n\u5b57\u7b26\u4e32  $S$ \u7684\u6240\u6709 border \u53ef\u4ee5\u88ab\u5212\u5206\u6210\u4e0d\u8d85\u8fc7 $\\log_2|S|$ \u6bb5\uff0c\u6bcf\u4e00\u6bb5\u7684\u957f\u5ea6\u662f\u7b49\u5dee\u6570\u5217\u3002\n\n\u5047\u8bbe\u73b0\u5728\u6709 $k$ \u4e2a\u7b49\u5dee\u6570\u5217\u3002\n\n\u4e0d\u59a8\uff0c\u5148\u8003\u8651\u5176\u4e2d\u7684\u4e00\u4e2a\uff1a$x_1,x_1+d_1,x_1+2d_1,\\cdots,x_1+len*d_1$\u3002\n\n\u8003\u8651\u6c42\u51fa\u5728 $\\bmod x_1$ \u610f\u4e49\u4e0b\u7684\u540c\u4f59\u6700\u77ed\u8def\u3002\u5176\u5b9e\u53ef\u4ee5\u53d1\u73b0\uff0c\u6240\u6709\u7684\u8f6c\u79fb\u4f1a\u5c06\u5e8f\u5217\u5206\u4e3a $\\gcd(x_1,d_1)$ \u4e2a\u73af\u3002\u4ece\u73af\u4e0a $dis$ \u6700\u5c0f\u7684\u70b9\u5f00\u59cb\u8f6c\u79fb\u5373\u53ef\u3002\n\n\u8003\u8651\u73b0\u5728\u65b0\u52a0\u5165\u4e86\uff1a$x_2,x_2+d_2,x_2+2d_2,\\cdots,x_2+len*d_2$\u3002\n\n\u90a3\u4e48\u73b0\u5728\u7684\u6a21\u6570\u8981\u5207\u6362\u5230 $x_2$\u3002\u53ef\u4ee5\u53d1\u73b0\u9996\u5148\u6709  $dis'_{dis_i \\bmod x2}=dis_i$ \u4f46\u8fd9\u6837\u8f6c\u79fb\u662f\u4f1a\u6f0f\u60c5\u51b5\u7684\uff0c\u56e0\u4e3a\u8fd8\u6709 $dis_i+k*x_1$ \u7684\u8f6c\u79fb\u3002\u8fd9\u6837\u76f4\u63a5\u518d\u5728 $\\bmod x_2$ \u610f\u4e49\u4e0b\u8dd1\u4e00\u904d\u540c\u4f59\u6700\u77ed\u8def\u5c31\u884c\u4e86\u3002\n\n\u4e4b\u540e\u7ee7\u7eed\u50cf\u4e4b\u524d\u90a3\u6837\u8003\u8651 $\\bmod x_2$ \u610f\u4e49\u4e0b\u7684\u540c\u4f59\u6700\u77ed\u8def\u5373\u53ef\u3002\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\n#define il inline\n#define rg register\n#define int long long\nil int read()\n{\n\tint k=1,re=0;char ch=getchar();\n\twhile(ch>'9'||ch<'0'){if(ch=='-')k=-1;ch=getchar();}\n\twhile(ch<='9'&&ch>='0'){re=re*10+ch-48;ch=getchar();}\n\treturn re*k;\n}\nil void write(int x)\n{\n\tif(x<0)return putchar('-'),write(-x),void();\n\tif(x<=9)return putchar(x+48),void();\n\treturn write(x/10),write(x%10),void();\n}\nint n,T,W,nxt[500005],f[500005],las;\nchar s[500005];\nint b[500005],lb;\nconst int M=998244353;\nvoid getb()\n{\n\tint k=0;\n\tfor(rg int i=2;i<=n;i++)\n\t{\n\t\twhile(k&&s[i]!=s[k+1])k=nxt[k];\n\t\tnxt[i]=(s[i]==s[k+1])?++k:0;\n\t}\n\twhile(k)\n\t{\n\t\tb[++lb]=n-k;\n\t\tk=nxt[k];\n\t}\n}\nint gcd(int u,int v)\n{\n\tif(!v)return u;\n\treturn gcd(v,u%v);\n}\nint st[1000005],ls,p[500005],Q[500005],lq,w[500005],tl,hd,pos[500005];\nvoid tomod(int x)\n{\n\tint g=gcd(x,las);\n\tfor(rg int i=0;i<las;i++)\n\t\tp[i]=f[i];\n\tfor(rg int i=0;i<x;i++)\n\t\tf[i]=0x3f3f3f3f3f3f3f3f;\n\tfor(rg int i=0;i<las;i++)\n\t\tf[p[i]%x]=min(p[i],f[p[i]%x]);\n\tfor(rg int i=0;i<g;i++)\n\t{\n\t\tls=0;st[++ls]=i;int now=(i+las)%x;\n\t\twhile(st[1]!=now)\n\t\t{\n\t\t\tst[++ls]=now;\n\t\t\tnow=(now+las)%x;\n\t\t}\n\t\tfor(rg int j=1;j<=ls;j++)\n\t\t{\n\t\t\tst[ls+j]=st[j];\n\t\t}\n\t\tls<<=1;\n\t\tfor(rg int j=2;j<=ls;j++)\n\t\t\tf[st[j]]=min(f[st[j-1]]+las,f[st[j]]);\n\t}\n\tlas=x;\n}\nvoid sol(int x,int sz,int d)\n{\n\tint g=gcd(x,d);\n\ttomod(x);\n\t\n\tif(d<0)return;\n\tfor(rg int i=0;i<g;i++)\n\t{\n\t\tls=lq=0;Q[++lq]=i;int now=(i+d)%x,tt=1;\n\t\twhile(Q[1]!=now)\n\t\t{\n\t\t\tif(f[Q[tt]]>f[now])tt=lq+1;\n\t\t\tQ[++lq]=now;now=(now+d)%x;\n\t\t}\n\t\tfor(rg int j=tt;j<=lq;j++)\n\t\t\tst[++ls]=Q[j];\n\t\tfor(rg int j=1;j<tt;j++)\n\t\t\tst[++ls]=Q[j];\n\t\thd=tl=0;\n\t\tw[0]=f[st[1]]-d;pos[0]=1;\n\t\tfor(rg int j=2;j<=ls;j++)\n\t\t{\n\t\t\twhile(hd<=tl&&pos[hd]<j-sz)hd++;\n\t\t\tif(hd<=tl)f[st[j]]=min(f[st[j]],w[hd]+j*d+x);\n\t\t\twhile(hd<=tl&&w[tl]>f[st[j]]-j*d)tl--;\n\t\t\tw[++tl]=f[st[j]]-j*d;pos[tl]=j;\n\t\t}\n\t}\n}\nsigned main()\n{\n\tT=read();\n\twhile(T--)\n\t{\n\t\tn=read();W=read()-n;\n\t\tscanf(\"%s\",s+1);lb=0;\n\t\tgetb();memset(f,0x3f,sizeof(f));memset(nxt,0,sizeof(nxt));las=n;\n\t\tf[0]=0;b[lb+1]=0;\n\t\tfor(rg int i=1,j=1;i<=lb;i=j)\n\t\t{\n\t\t\twhile(b[i+1]-b[i]==b[j+1]-b[j])j++;\n\t\t\tsol(b[i],j-i-1,b[i+1]-b[i]);\n\t\t}\n\t\tint ans=0;\n\t\tfor(rg int i=0;i<las;i++)\n\t\t{\n\t\t\tif(f[i]<=W)\n\t\t\t\tans+=(W-f[i])/las+1;\n\t\t}\n\t\twrite(ans);puts(\"\");\n\t}\n}\n```\n\n",
        "postTime": 1609589326,
        "uid": 55201,
        "name": "clamee",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4156 \u3010[WC2016]\u8bba\u6218\u6346\u7af9\u7aff\u3011"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/eastcloud/p/17272391.html)\n\n## \u9898\u610f\u63cf\u8ff0\n\n\u7ed9\u5b9a\u4e00\u4e2a\u5b57\u7b26\u4e32 $s$\uff0c\u4f60\u521d\u59cb\u62e5\u6709\u4e00\u4e2a\u7a7a\u4e32 $t$\uff0c\u6bcf\u6b21\u53ef\u4ee5\u9009\u62e9\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7684\u4e00\u4e2a Border\uff0c\u53bb\u6389\u5b83\u540e\u63a5\u5728 $t$ \u7684\u540e\u9762\uff0c\u64cd\u4f5c\u540e $s$ \u4e0d\u53d8\uff0c\u7ed9\u51fa\u4e00\u4e2a\u4e0a\u9650 $w$\uff0c\u6c42\u51fa\u5728 $[1,w]$ \u4e2d\u6709\u591a\u5c11\u957f\u5ea6\u53ef\u4ee5\u88ab\u62fc\u51fa\u3002\n\n## \u9898\u76ee\u5206\u6790\n\n\u9996\u5148\u53ef\u4ee5\u770b\u51fa\uff0c\u629b\u5f00\u5b57\u7b26\u4e32\uff0c\u628a\u6bcf\u4e2a\u53ef\u4ee5\u62fc\u4e0a\u53bb\u7684\u957f\u5ea6\u7b5b\u9009\u51fa\u6765\uff0c\u95ee\u9898\u5c31\u8f6c\u5316\u4e3a\u6709 $k$ \u4e2a\u4e0d\u540c\u7684\u6570\uff0c\u901a\u8fc7\u52a0\u6cd5\u64cd\u4f5c\u53ef\u4ee5\u8868\u793a\u51fa\u8303\u56f4\u5185\u7684\u591a\u5c11\u4e2a\u6570\uff0c\u8fd9\u663e\u7136\u662f\u4e00\u4e2a\u540c\u4f59\u6700\u77ed\u8def\u7684\u95ee\u9898\u3002\n\n\u6a21\u4eff\u901a\u5e38\u540c\u4f59\u6700\u77ed\u8def\u7684\u64cd\u4f5c\uff0c\u4ece\u6bcf\u4e2a\u70b9\u5ef6\u4f38 $k$ \u6761\u8fb9\u540e\u8dd1\u4e00\u8fb9\u6700\u77ed\u8def\u5373\u53ef\uff0c\u4f46\u662f\u8fd9\u6837\u53ea\u80fd\u5f97\u5230 30 \u5206\uff0c\u539f\u56e0\u5728\u4e8e\u8fb9\u6570\u8fc7\u5927\u3002\n\n\u6211\u4eec\u8003\u8651\u4f18\u5316\uff0c\u65e2\u7136\u8fb9\u8fd9\u4e48\u591a\uff0c\u80fd\u4e0d\u80fd\u53bb\u6389\u4e00\u4e9b\u6ca1\u6709\u7528\u7684\u90e8\u5206\uff0c\u53cd\u8fc7\u6765\u8003\u8651\u5b57\u7b26\u4e32 Border \u7684\u4e00\u4e9b\u6027\u8d28\uff0c\u6ce8\u610f\u5230\u5468\u671f\u597d\u50cf\u662f\u4e2a\u5f88\u6709\u7528\u7684\u90e8\u5206\uff0c\u80fd\u628a\u5197\u4f59\u90e8\u5206\u538b\u7f29\uff0c\u6211\u4eec\u8bd5\u56fe\u4ece\u8fd9\u65b9\u9762\u8003\u8651\u3002\n\n\u5bf9\u4e8e\u5468\u671f\u548c Border\uff0c\u6211\u4eec\u6709\u4e00\u4e2a\u5f88\u663e\u7136\u7684\u6027\u8d28\uff1a\u6bcf\u4e2a\u957f\u5ea6\u5927\u4e8e  $\\frac{|s|}{2}$ \u7684 Border \u5269\u4e0b\u90a3\u90e8\u5206\u5982\u679c\u957f\u5ea6\u662f $|s|$ \u7684\u56e0\u5b50\uff0c\u90a3\u4e48\u5b83\u662f\u539f\u5b57\u7b26\u4e32\u7684\u4e00\u4e2a\u5468\u671f\uff0c\u800c\u4efb\u610f\u4e00\u4e2a\u5468\u671f\u4e0e\u4e00\u4e2a\u6700\u77ed\u5468\u671f\uff0c\u8bb0\u4e3a $p$\uff0c$q$\uff08$p>q$\uff09\uff0c$\\gcd(p,q)$ \u4e5f\u662f\u539f\u5b57\u7b26\u4e32\u7684\u4e00\u4e2a\u5468\u671f\u3002\n\n\u56e0\u4e3a $p$ \u548c $q$ \u7684\u6700\u5927\u516c\u56e0\u6570\u4e5f\u662f\u4e00\u4e2a\u5468\u671f\uff0c\u800c $\\gcd(p,q)\\leq\\min(p,q)$\uff0c\u4ece\u4e0a\u8ff0\u5b9a\u4e49\u53ef\u4ee5\u770b\u51fa $q=\\gcd(p,q)$\uff0c\u56e0\u6b64 $q|p$\uff0c\u5f53 $p$ \u6240\u5bf9\u5e94\u7684 Border \u53d6\u6700\u5c0f\u7684\u65f6\uff0c\u5373 $p$ \u6700\u5927\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u53d1\u73b0 $q$ \u590d\u5236\u540e\u53ea\u8981\u4e0d\u8d85\u8fc7 $p$\uff0c\u4e00\u5b9a\u5bf9\u5e94\u4e00\u4e2a Border\uff0c**\u800c\u8fd9\u4e9b Border \u521a\u597d\u7ec4\u6210\u4e00\u4e2a\u7b49\u5dee\u6570\u5217**\u3002\n\n\u56e0\u4e3a\u6240\u6709\u7684\u5468\u671f\u90fd\u80fd\u7531\u6700\u5c0f\u5468\u671f\u7ec4\u6210\uff0c\u6240\u4ee5\u6240\u6709\u5927\u4e8e $\\frac{|s|}{2}$ \u7684 Border \u90fd\u6784\u6210\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\uff0c\u800c\u628a\u5c0f\u4e8e\u7684\u6700\u5927\u7684 Border \u63d0\u51fa\u6765\u53d8\u6210\u4e00\u4e2a\u65b0\u5b57\u7b26\u4e32\u7ee7\u7eed\u9012\u5f52\uff0c\u53ef\u4ee5\u5f97\u5230\u6700\u591a\u4e0d\u8d85\u8fc7 $\\log(n)$ \u6761\u7b49\u5dee\u6570\u5217\u3002\n\n\u8fd9\u4e2a\u6027\u8d28\u5f88\u6709\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u6761\u6570\u5217\u5355\u72ec\u62c9\u51fa\u6765\u8dd1\u540c\u4f59\u6700\u77ed\u8def\uff0c\u4f18\u5316\u8fb9\u6570\u5373\u53ef\u8fbe\u5230\u76ee\u7684\u3002\n\n## \u5177\u4f53\u5b9e\u73b0\n\n\u628a\u6700\u5c0f\u7684\u5f53\u6210\u6a21\u6570\uff0c\u6bcf\u4e2a\u70b9\u5c31\u53ea\u6709\u4e00\u6761\u51fa\u8fb9\uff0c\u6574\u4e2a\u56fe\u603b\u5171\u4f1a\u5f62\u6210  $\\gcd(a,d)$ \u4e2a\u7b80\u5355\u73af\uff08$a$ \u4e3a \u6700\u5c0f\u503c\uff0c$d$\uff0c\u4e3a\u516c\u5dee\uff09\u3002\n\n\u63a5\u7740\u628a\u73af\u5206\u79bb\uff0c\u4ece\u6700\u5c0f\u503c\u5f00\u59cb\u8f6c\u5708\u8dd1\u6700\u77ed\u8def\uff0c\u6700\u540e\u8dd1\u4e0b\u4e00\u6761\u7b49\u5dee\u6570\u5217\u7684\u65f6\u5019\u6539\u53d8\u4e00\u4e0b\u6a21\u6570\u5373\u53ef\uff08\u5982\u679c\u4ece\u5c0f\u5230\u5927\u8dd1\u53ea\u7528\u628a\u6bcf\u4e2a\u6700\u5c0f\u503c\u6240\u5728\u4f4d\u7f6e\uff0c\u6539\u6210\u6a21\u65b0\u6a21\u6570\u7684\u4f4d\u7f6e\uff0c\u5e76\u67e5\u770b\u524d\u9762\u4f1a\u4e0d\u4f1a\u5bf9\u540e\u9762\u589e\u52a0\u7684\u540c\u4f59\u7c7b\u4ea7\u751f\u5f71\u54cd\u5373\u53ef\uff09\u3002\n\n\u4e00\u5171\u6709 $\\log(n)$ \u6761\u6570\u5217\uff0c\u6bcf\u6761\u6570\u5217\u8dd1\u6700\u77ed\u8def\u590d\u6742\u5ea6\u4e3a $O(n)$\uff0c\u6574\u4f53\u65f6\u95f4\u4e3a $ O(n \\log n)$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<set>\n#include<cstring>\n#include<queue>\n#define N 500005\nusing namespace std;\ntypedef unsigned long long ll;\nll cnt,bor[N<<3],nex[N<<3];\nll res[N<<3];\nll dis[N<<3],lim;\nstruct Node{\n\tll num,val;\n};\nll top,Q[N<<3],q2[N<<3];\nchar s[N];\nll gcd(ll x,ll y){\n\tif(!y) return x;\n\telse return gcd(y,x%y);\n}\nvoid get_border(ll n){\n\tll ans=0;\n\tfor(ll i=2;i<=n;i++){\n\t\twhile(ans && s[ans+1]!=s[i]) ans=nex[ans];\n\t\tif(s[ans+1]==s[i]) ans++;\n\t\tnex[i]=ans;\n\t}\n\t\n\twhile(ans){bor[++cnt]=n-ans;ans=nex[ans];}\n\t\n\tbor[++cnt]=n;\n}\nvoid rfs(ll len){\n\tll siz=gcd(lim,len);\n\tfor(ll i=0;i<lim;i++)res[i]=dis[i];\n\tfor(ll i=0;i<len;i++)dis[i]=0x7f7f7f7f7f7f7f7f;\n\tfor(ll i=0;i<lim;i++){\n\t\tll tmp=res[i]%len;\n\t\tdis[tmp]=min(dis[tmp],res[i]);\n\t}\n\tfor(ll i=0;i<siz;i++){\n\t\ttop=0;Q[++top]=i;ll tmp=(i+lim)%len;\n\t\twhile(tmp!=i){Q[++top]=tmp;tmp=(tmp+lim)%len;}\n\t\tfor(ll j=top+1;j<=top*2;j++) Q[j]=Q[j-top];\n\t\tfor(ll j=2;j<=(top<<1);j++) dis[Q[j]]=min(dis[Q[j]],dis[Q[j-1]]+lim);\n\t}\n\tlim=len;\n\t\n}\nvoid update(ll a,ll d,ll num){\n\tif(d<0) return;\n\tll siz=gcd(lim,d);\n\tfor(ll i=0;i<siz;i++){\n\t\ttop=0;ll tmp=(i+d)%lim;Q[++top]=i;\n\t\twhile(tmp!=i){Q[++top]=tmp;tmp=(tmp+d)%lim;}\n\t\ttmp=1;\n\t\tfor(ll j=2;j<=top;j++) if(dis[Q[j]]<dis[Q[tmp]]) tmp=j;\n\t\tfor(ll j=1;j<=top;j++) res[j]=Q[j];\n\t\tfor(ll j=tmp;j<=top;j++) Q[j-tmp+1]=res[j];\n\t\tfor(ll j=1;j<tmp;j++) {Q[j+(top-tmp+1)]=res[j];}\n\t\tll head=1,tail=1;q2[1]=1;\n\t\tfor(ll j=2;j<=top;j++){\n\t\t\t\n\t\t\twhile(head<=tail && j-q2[head]>num) head++;\n\t\t\t\n\t\t\tdis[Q[j]]=min(dis[Q[j]],dis[Q[q2[head]]]+a+d*(j-q2[head]));\n\t\t\t\n\t\t\twhile(tail>=head && dis[Q[q2[tail]]]+d*(j-q2[head])>dis[Q[j]]) tail--;\n\t\t\tq2[++tail]=j;\n\t\t\t\n\t\t}\n\t}\n}\nll solve(ll n,ll w){\n\tll L=1;\n\twhile(L<=cnt){\n\t\tll R=L;\n\t\twhile(bor[R+1]-bor[R]==bor[L+1]-bor[L]) R++;\n\t\trfs(bor[L]);\n\t\tif(R>cnt) {L=R;continue;}\n\t\tupdate(bor[L],(L==R?0:bor[L+1]-bor[L]),R-L);\n\t\tL=R;\n\t}\n\tll ans=0;\n\tfor(ll i=0;i<lim;i++){\n\t\tif(dis[i]>w) continue;\n\t\tans+=(w-dis[i])/lim+1;\n\t}\n\treturn ans;\n}\nint main(){\n\tll t;\n\tcin>>t;\n\twhile(t--){\n\t\tll n,w;\n\t\tcin>>n>>w>>(s+1);if(w<n){cout<<0<<endl;continue;}cnt=0;w-=n;\n\t\tlim=n;dis[0]=0;\n\t\tget_border(n);\n\t\tcout<<solve(n,w)<<endl;\n\t\tfor(ll i=0;i<n;i++) dis[i]=0x7f7f7f7f7f7f7f7f;\n\t}\n}\n```\n\n\n",
        "postTime": 1680154800,
        "uid": 421265,
        "name": "eastcloud",
        "ccfLevel": 4,
        "title": "P4156 [WC2016]\u8bba\u6218\u6346\u7af9\u7aff \u9898\u89e3"
    },
    {
        "content": "## \u524d\u7f6e\u77e5\u8bc6\n\n1.\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u6240\u6709 border \u6392\u5e8f\u540e\uff0c\u4e00\u5b9a\u5b58\u5728\u4e00\u79cd\u5212\u5206\u5b50\u5e8f\u5217\u7684\u65b9\u6848\u4f7f\u5f97\u5176\u88ab\u5212\u5206\u4e3a $O(logn)$ \u4e2a\u7b49\u5dee\u6570\u5217\u3002\n\n\u5728\u8bc1\u660e\u4e4b\u524d\u6211\u4eec\u9700\u8981\u77e5\u9053\u51e0\u4e2a\u5173\u4e8e border \u548c\u5468\u671f\u7684\u6027\u8d28\uff1a\n\n\u6027\u8d28\u4e00\uff1a\u5982\u679c $s$ \u5b58\u5728\u4e00\u4e2a\u957f\u5ea6\u4e3a $x$ \u7684 border \uff0c\u90a3\u4e48 $s$ \u5b58\u5728\u4e00\u4e2a\u957f\u5ea6\u4e3a $|s|-x$ \u7684\u5468\u671f\u3002\uff08\u7531\u5b9a\u4e49\u53ef\u5f97\uff09\n\n\u6027\u8d28\u4e8c\uff1a\u5982\u679c $s$ \u5b58\u5728\u4e24\u4e2a\u5468\u671f $x,y$ \uff0c\u5e76\u4e14 $x+y\\le |s|$ \uff0c\u90a3\u4e48 $s$ \u4e00\u5b9a\u5b58\u5728\u4e00\u4e2a\u5468\u671f\u4e3a $\\gcd(x,y)$ \u3002\n\n\u8bc1\u660e\uff1a\n\n\u4e0d\u59a8\u8bbe $x<y$ \uff0c\u7531\u5468\u671f\u7684\u5b9a\u4e49\u6211\u4eec\u6709 $s_i=s_{i+x}=s_{i+y}$ \uff0c\u5219 $s_{i}=s_{i+y-x}(x+1\\le i\\le |s|-y+x)$ \uff0c\u7531\u4e8e $x+y\\le |s|$ \uff0c\u56e0\u6b64 $x\\le \\lfloor\\tfrac{|s|}{2}\\rfloor$ \uff0c\u90a3\u4e48 $i$ \u7684\u8303\u56f4\u4e00\u5b9a\u5305\u62ec\u4e86 $[\\lfloor\\tfrac{|s|}{2}\\rfloor,|s|-y+x]$ \uff0c\u5982\u679c\u6211\u4eec\u518d\u7528 $s_i=s_{i-x}=s_{i-y}$ \u8fdb\u884c\u4e00\u6b21\u63a8\u5bfc\u7136\u540e\u548c\u4e0a\u8ff0\u8303\u56f4\u5408\u5e76\uff0c\u53ef\u4ee5\u53d1\u73b0 $i$ \u7684\u8303\u56f4\u4e00\u5b9a\u53ef\u4ee5\u8986\u76d6\u6574\u4e2a\u5b57\u7b26\u4e32\uff0c\u76f8\u5bf9\u7684 $x+y>|s|$ \u65f6\u53ef\u80fd\u65e0\u6cd5\u8986\u76d6\u6574\u4e2a\u5b57\u7b26\u4e32\uff0c\u8fd9\u6837\u6211\u4eec\u8bc1\u660e\u4e86 $y-x$ \u4e5f\u662f\u5b57\u7b26\u4e32\u7684\u4e00\u4e2a\u5468\u671f\u3002\n\n\u6211\u4eec\u4ee4 $y-x$ \u4f5c\u4e3a\u65b0\u7684 $y$ \uff0c\u5bb9\u6613\u53d1\u73b0\u6b64\u65f6\u4ecd\u7136\u6ee1\u8db3 $x+y\\le |s|$ \uff0c\u5982\u679c\u7ee7\u7eed\u9012\u5f52\u5904\u7406\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a\u66f4\u76f8\u51cf\u635f\u672f\u6c42\u89e3 gcd \u7684\u8fc7\u7a0b\uff0c\u4e0d\u96be\u53d1\u73b0 $\\gcd(x,y)$ \u4e5f\u662f $s$ \u7684\u4e00\u4e2a\u5468\u671f\u3002\n\n\u5047\u8bbe\u5f53\u524d\u5b57\u7b26\u4e32 $s$ \u5b58\u5728\u4e24\u4e2a border \u5206\u522b\u4e3a $x,y$ \uff0c\u6ee1\u8db3 $x,y\\ge \\tfrac{|s|}{2}$ \u5e76\u4e14 $y$ \u4e3a $s$ \u6700\u5927\u7684 border \uff0c\u8bbe $p=|s|-x,q=|s|-y$ \uff0c\u663e\u7136 $p+q\\le |s|$ \uff0c\u90a3\u4e48\u6709 $\\gcd(p,q)$ \u4e3a $s$ \u7684\u4e00\u4e2a\u5468\u671f\uff0c\u7531\u4e8e $\\gcd(p,q)\\le q$ \u5e76\u4e14 $q$ \u4e3a\u6700\u5c0f\u7684\u5468\u671f\uff0c\u56e0\u6b64 $\\gcd(p,q)=q$\u3002\n\n\u7531\u4e8e $k\\times q$ \u4e5f\u662f $s$ \u7684\u5468\u671f\uff0c\u5e76\u4e14 $q|p$ \uff0c\u53ef\u4ee5\u53d1\u73b0\u6240\u6709\u957f\u5ea6\u5c0f\u4e8e\u7b49\u4e8e $\\tfrac{|s|}{2}$ \u7684\u5468\u671f\u6784\u6210\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\uff0c\u4e5f\u5c31\u662f\u8bf4\u6240\u6709\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e $\\tfrac{|s|}{2}$ \u7684 border \u6784\u6210\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u6392\u5e8f\u540e\u7684 border \u53ef\u4ee5\u5212\u5206\u4e3a $O(logn)$ \u4e2a\u7b49\u5dee\u6570\u5217\u3002\n\n2.\u540c\u4f59\u6700\u77ed\u8def\uff08P3403 \u8df3\u697c\u673a\uff09\n\n\u9898\u76ee\u5927\u610f\uff1a\u8bbe $p=k_1x+k_2y+k_3z(k_1,k_2,k_3\\ge 0)$ \uff0c\u6c42\u89e3\u5c0f\u4e8e\u7b49\u4e8e $lim$ \u7684 $p$ \u7684\u4e2a\u6570\u3002\n\n\u8bbe $f_i$ \u8868\u793a $k_1=0$ \u65f6\uff0c\u6700\u5c0f\u7684\u53ef\u4ee5\u88ab\u8868\u793a\u7684 $mod\\ x=i$ \u7684\u6570\uff0c\u663e\u7136\u6709\u8f6c\u79fb\uff1a\n\n$$\nf_{i}+y\\to f_{(i+y)mod\\ x}\\\\\nf_{i}+z\\to f_{(i+z)mod\\ x}\n$$\n\n\u53ef\u4ee5\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a\u6700\u77ed\u8def\u7684\u5f62\u5f0f\uff0c\u53ef\u4ee5\u7528 Dijikstra \u8fdb\u884c\u8f6c\u79fb\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u7b54\u6848\u4e3a $\\sum_{i=0}^{x-1}\\lfloor\\tfrac{lim-f_i}{x}\\rfloor+1$ \u3002\n\n## \u9898\u89e3\n\n\u6211\u4eec\u4ee4 $w=w-|s|$ \uff0c\u8bbe $x$ \u4e3a $s$ \u7684\u6240\u6709\u5468\u671f\uff0c\u8bbe $p=\\sum k_ix_i$\uff0c\u90a3\u4e48\u6211\u4eec\u9700\u8981\u6c42\u89e3 $p\\le w$ \u65f6 $p$ \u7684\u6570\u76ee\u3002\n\n\u9996\u5148\u6709\u4e00\u4e2a\u66b4\u529b\u7684\u540c\u4f59\u6700\u77ed\u8def\u7684\u601d\u8def\uff0c\u53ef\u4ee5 $O(n^2logn)$ \u89e3\u51b3\u3002\n\n\u8003\u8651\u5229\u7528\u5b57\u7b26\u4e32\u5468\u671f\u7684\u6027\u8d28\uff0c\u6211\u4eec\u5c06 $x$ \u8fdb\u884c\u5206\u7ec4\uff0c\u6bcf\u4e00\u4e2a\u7ec4\u4e2d\u7684 $x_i$ \u6784\u6210\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\uff0c\u8bbe $first$ \u4e3a\u7b49\u5dee\u6570\u5217\u7684\u9996\u9879\uff0c $diff$ \u4e3a\u516c\u5dee\uff0c $len$ \u4e3a\u9879\u6570\u4e2a\u6570 $-1$ \uff0c\u8003\u8651\u5c06\u540c\u4f59\u6700\u77ed\u8def\u4e2d\u7684\u6a21\u6570\u8bbe\u4e3a $first$ \uff0c\u8003\u8651\u6c42\u89e3\u8fd9\u4e2a\u7ec4\u4e2d\u7684 $f$ \u503c\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u5bf9\u4e8e\u4e00\u4e2a\u7b49\u5dee\u6570\u5217 $first+k\\times diff$ \uff0c\u5728 $mod\\ first$ \u65f6\u8fdb\u884c\u8fde\u8fb9\uff0c\u4f1a\u5f62\u6210 $\\gcd(diff,first)$ \u4e2a\u73af\uff0c\u6bcf\u4e00\u4e2a\u73af\u4e4b\u95f4\u4e92\u4e0d\u5f71\u54cd\uff0c\u53ef\u4ee5\u5c06\u73af\u5355\u72ec\u62ff\u51fa\u8fdb\u884c\u8f6c\u79fb\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u73af\uff0c\u7531\u4e8e $f$ \u503c\u6700\u5c0f\u7684\u5730\u65b9\u4e00\u5b9a\u4e0d\u4f1a\u88ab\u66f4\u65b0\uff0c\u56e0\u6b64\u6211\u4eec\u4ece\u8fd9\u4e2a\u5730\u65b9\u5c06\u73af\u65ad\u5f00\uff0c\u5e76\u5c06\u73af\u4e0a\u7684\u70b9\u4f9d\u6b21\u653e\u8fdb\u4e00\u4e2a\u6570\u7ec4 $pos$ \u4e2d\uff0c\u5bf9\u4e8e $pos_i$ \u548c $pos_j$ \uff0c\u53ef\u4ee5\u53d1\u73b0\u5f53 $i-j\\le len$ \u65f6 $pos_j$ \u53ef\u4ee5\u5bf9 $pos_i$ \u4ea7\u751f\u8d21\u732e\uff0c\u8d21\u732e\u4e3a $f_{pos_j}+first+diff\\times (i-j)$ \uff0c\u663e\u7136\u53ef\u4ee5\u62c6\u6210 $f_{pos_j}-j\\times diff+first+i\\times diff$ \uff0c\u5c06 $f_{pos_j}-j\\times diff$ \u7528\u5355\u8c03\u961f\u5217\u8fdb\u884c\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u7136\u540e\u8003\u8651\u4e24\u4e2a\u7b49\u5dee\u6570\u5217\u7684\u5408\u5e76\uff0c\u5bf9\u4e8e\u4e24\u4e2a\u6a21\u6570 $now\\_mod,mod$ \uff0c\u5f53\u524d $f$ \u7684\u6a21\u6570\u4e3a $now\\_mod$ \uff0c\u6211\u4eec\u9700\u8981\u5c06\u6a21\u6570\u53d8\u4e3a $mod$ \uff0c\u9996\u5148\u5c06 $f$ \u590d\u5236\u5230 $tmp$ \u6570\u7ec4\u4e2d\uff0c\u90a3\u4e48\u663e\u7136\u6709\u8f6c\u79fb\uff1a\n\n$$\ntmp_i\\to f_{tmp_i \\% mod}\n$$\n\n\u7531\u4e8e\u5728\u8ba1\u7b97\u7b49\u5dee\u6570\u5217\u65f6\u6a21\u6570\u4e3a $now\\_mod$ \uff0c\u6539\u53d8\u6a21\u6570\u540e\u6211\u4eec\u9700\u8981\u8003\u8651 $now\\_mod$ \u8fb9\u6240\u9020\u6210\u7684\u8d21\u732e\uff0c\u4ecd\u7136\u5c06\u8fd9\u4e9b\u8fb9\u7ec4\u6210\u7684 $\\gcd(now\\_mod,mod)$ \u4e2a\u73af\u5355\u72ec\u62ff\u51fa\u6765\uff0c\u53ef\u4ee5\u5c06\u73af\u65ad\u5f00\u5f62\u6210\u7684\u94fe\u500d\u957f\u540e\u76f4\u63a5\u8f6c\u79fb\u3002\n\n## code\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n#include <cstring>\nusing namespace std;\nconst int max1 = 5e5;\nint T, n;\nlong long w, ans;\nchar s[max1 + 5];\nint pi[max1 + 5], border[max1 + 1], cnt;\nint now_mod;\nlong long f[max1 + 5], tmp[max1 + 5];\nlong long q[max1 + 5];\nint pos[max1 * 2 + 5], head, tail;\nint seq[max1 + 5], top;\ninline int Gcd ( int a, int b )\n{\n    int t;\n    while ( b ) { t = a; a = b; b = t % b; }\n    return a;\n}\ninline void KMP ()\n{\n    pi[1] = 0;\n    for ( int i = 2, j = 0; i <= n; i ++ )\n    {\n        while ( j && s[i] != s[j + 1] ) j = pi[j];\n        if ( s[i] == s[j + 1] ) ++j;\n        pi[i] = j;\n    }\n    int now = pi[n];\n    cnt = 0;\n    while ( now )\n    {\n        border[++cnt] = n - now;\n        now = pi[now];\n    }\n    border[++cnt] = n;\n    return;\n}\ninline void Change_Mod ( int mod )\n{\n    memcpy(tmp, f, sizeof(long long) * ( now_mod + 2 ));\n    memset(f, 0x3f, sizeof(long long) * ( mod + 2 ));\n    for ( int i = 0; i < now_mod; i ++ ) f[tmp[i] % mod] = min(f[tmp[i] % mod], tmp[i]);\n    int p = Gcd(now_mod, mod);\n    for ( int i = 0; i < p; i ++ )\n    {\n        top = 0;\n        pos[++top] = i;\n        int x = ( i + now_mod ) % mod;\n        while ( x != pos[1] ) pos[++top] = x, x = ( x + now_mod ) % mod;\n        for ( int j = top + 1; j <= top * 2; j ++ ) pos[j] = pos[j - top];\n        top = top << 1;\n        for ( int j = 2; j <= top; j ++ ) f[pos[j]] = min(f[pos[j]], f[pos[j - 1]] + now_mod);\n    }\n    now_mod = mod;\n    return;\n}\ninline void Solve ( int first, int diff, int len )\n{\n    int p = Gcd(first, diff);\n    Change_Mod(first);\n    if ( diff < 0 ) return;\n    for ( int i = 0; i < p; i ++ )\n    {\n        top = 0;\n        pos[++top] = i;\n        int x = ( i + diff ) % first;\n        while ( x != pos[1] ) pos[++top] = x, x = ( x + diff ) % first;\n        int min_pos = 1;\n        for ( int j = 1; j <= top; j ++ ) if ( f[pos[j]] < f[pos[min_pos]] ) min_pos = j;\n        for ( int j = min_pos; j <= top; j ++ ) seq[j - min_pos + 1] = pos[j];\n        for ( int j = 1; j < min_pos; j ++ ) seq[j + top - min_pos + 1] = pos[j];\n        head = tail = 1, pos[1] = 1, q[1] = f[seq[1]] - diff;\n        for ( int j = 2; j <= top; j ++ )\n        {\n            while ( head <= tail && pos[head] + len < j ) ++head;\n            if ( head <= tail ) f[seq[j]] = min(f[seq[j]], q[head] + 1ll * j * diff + first);\n            while ( head <= tail && q[tail] >= f[seq[j]] - 1ll * j * diff ) --tail;\n            q[++tail] = f[seq[j]] - 1ll * j * diff, pos[tail] = j;\n        }\n    }\n    return;\n}\ninline void Work ()\n{\n    scanf(\"%d%lld%s\", &n, &w, s + 1);\n    if ( w < n ) { printf(\"0\\n\"); return; }\n    w = w - n;\n    KMP();\n    now_mod = n;\n    memset(f, 0x3f, sizeof(long long) * ( now_mod + 2 ));\n    f[0] = 0;\n    border[cnt + 1] = 0;\n    for ( int i = 1, j = 1; i <= cnt; i = j )\n    {\n        while ( border[i + 1] - border[i] == border[j + 1] - border[j] ) ++j;\n        Solve(border[i], border[i + 1] - border[i], j - i - 1);\n    }\n    ans = 0;\n    for ( int i = 0; i < now_mod; i ++ ) if ( f[i] <= w ) ans += ( w - f[i] ) / now_mod + 1;\n    printf(\"%lld\\n\", ans);\n    return;\n}\nint main ()\n{\n    scanf(\"%d\", &T);\n    while ( T -- ) Work();\n    return 0;\n}\n```",
        "postTime": 1672105370,
        "uid": 655050,
        "name": "KafuuChinocpp",
        "ccfLevel": 0,
        "title": "[WC2016]\u8bba\u6218\u6346\u7af9\u7aff"
    },
    {
        "content": "\u8fd9\u9898\u592a\u96be\u4e86\uff0c\u770b\u9898\u89e3\u770b\u4e86\u6211\u4e00\u4e0b\u5348\u3002\u3002\u3002\n\n\u9996\u5148\u770b\u5230\u5b57\u7b26\u4e32\u524d\u540e\u7f00\u5339\u914d\uff0c\u80af\u5b9a\u80fd\u60f3\u5230 $\\text{kmp}$\uff0c\u6211\u4eec\u90a3\u4e48\u7b54\u6848\u5c31\u662f\u6240\u6709 $[0,w-n]$ \u7684\u6570\u5207\u53ef\u4ee5\u88ab $\\sum_{i=1}^k t_i\\times x_i$\uff0c\u5176\u4e2d\u4e00\u4e2a\u6570 $\\in [1,n]$ \u5728 $t_i$ \u4e2d\u7684\u6761\u4ef6\u662f $i$ \u662f\u9898\u76ee\u4e2d\u7ed9\u7684\u5b57\u7b26\u4e32\u7684\u5468\u671f\u3002\u5982\u679c\u66b4\u529b\u540c\u4f59\u6700\u77ed\u8def\u7684\u8bdd\u6700\u574f\u662f $n^2$ \u7684\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8003\u8651\u4f18\u5316\uff0c\u7528\u4e00\u4e2a\u5b9a\u7406\uff0c\u4e5f\u5c31\u662f\u5bf9\u4e8e\u4e00\u4e2a\u5b57\u7b26\u4e32\u6240\u6709\u5468\u671f\u7684\uff0c\u53ef\u4ee5\u5206\u6210 $\\log$ \u7ea7\u522b\u4efd\uff0c\u5176\u4e2d\u6bcf\u4e00\u4efd\u90fd\u662f\u8fde\u7eed\u7684\u4e14\u662f\u7b49\u5dee\u7684\uff0c\u8fd9\u4e2a\u8bc1\u660e\u5176\u4ed6\u9898\u89e3\u8bb2\u7684\u5f88\u8be6\u7ec6\u4e86\uff0c\u6211\u4e3b\u8981\u8bf4\u4e4b\u540e\u7684\u505a\u6cd5\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u6211\u4eec\u8981\u66f4\u65b0 $dis$ \u6570\u7ec4\uff0c\u5047\u8bbe\u8fd9\u4e2a\u7b49\u5dee\u6570\u5217\u7684\u516c\u5dee\u662f $d$\uff0c\u90a3\u4e48\u6211\u4eec\u5047\u8bbe\u8fde $x\\rightarrow (x+d)$\uff0c\u5e76\u4e14\u5982\u679c\u5927\u4e8e $mod$ \u5c31\u53d6\u6a21\uff08\u5176\u5b9e\u662f (x+d)%mod\uff0c\u4f46\u662f $\\LaTeX$ \u6253\u4e0d\u51fa\u6765\uff09\uff0c\u90a3\u4e48\u4e00\u5b9a\u4f1a\u5f62\u6210 $\\gcd(mod,d)$ \u4e2a\u73af\uff0c\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u73af\u5206\u522b\u5904\u7406\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u4e00\u4e2a\u73af\uff0c\u6211\u4eec\u8981\u600e\u4e48\u5904\u7406\u5462\uff1f\u9996\u5148\u6211\u4eec\u53d1\u73b0\u8fd9\u4e9b\u73af\u662f\u4e24\u4e24\u4e92\u4e0d\u5e72\u6270\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u7684\u66f4\u65b0\u662f\u5728\u4e00\u6761\u94fe\u4e0a\u7684\uff08\u6211\u4eec\u5c06\u73af\u4ece $dis$ \u503c\u6700\u5c0f\u7684\u90a3\u4e2a\u70b9\u65ad\u5f00\uff0c\u56e0\u4e3a\u6ca1\u6709\u5176\u4ed6\u70b9\u80fd\u66f4\u65b0\u90a3\u4e2a $dis$ \u6700\u5c0f\u7684\u90a3\u4e2a\u70b9\uff09\u7136\u540e\u6211\u4eec\u5c31\u4e0d\u518d\u662f\u6700\u77ed\u8def\u4e86\uff0c\u800c\u662f\u8f6c\u5316\u6210\u4e86\u4e00\u4e2a\u5e8f\u5217\u4e0a\u7684 $dp$\uff0c\u53d1\u73b0\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a $l$ \u7684\u9650\u5236\uff08$l$ \u8868\u793a\u90a3\u4e2a\u7b49\u5dee\u6570\u5217\u6700\u5927\u9879\u662f $x+l\\times d$\uff09\uff0c\u6240\u4ee5\u8003\u8651\u5355\u8c03\u961f\u5217\u4f18\u5316\u3002\n\n\u7136\u540e\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u5b83\u7684\u6a21\u6570\u662f\u4f1a\u6539\u53d8\u7684\u3002\u5f88\u660e\u663e\u53ef\u4ee5\u7528 $dis_i$ \u66f4\u65b0 $Dis_{i\\ mod\\ new}$\uff0c\u5176\u4e2d $mod$ \u4ee3\u8868 %\uff0c\u800c $new$ \u8868\u793a\u65b0\u7684\u6a21\u6570\u3002\u7136\u540e\u53d1\u73b0\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u66f4\u65b0\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u518d\u8dd1\u4e00\u904d\u540c\u4f59\u6700\u77ed\u8def\u3002\u6ce8\u610f\u7531\u4e8e\u8fd9\u56de\u6ca1\u6709 $l$ \u7684\u9650\u5236\u4e86\uff0c\u53ef\u4ee5\u4e0d\u7528\u5355\u8c03\u961f\u5217\u4e86\uff0c\u76f4\u63a5\u590d\u5236\u4e00\u904d\u7136\u540e\u8dd1\u5c31\u597d\u4e86\u3002\n\n\u6700\u540e\u603b\u7ed3\u4e00\u4e0b\uff0c\u6211\u4eec\u7684\u8ba1\u7b97\u7b49\u5dee\u7684\u51fd\u6570\u5206\u4e3a $4$ \u90e8\u5206\uff0c\u5206\u522b\u662f\u66f4\u6362\u6a21\u6570\uff0c\u627e\u5230\u6700\u5c0f\u70b9\uff0c\u62c6\u73af\u53d8\u5e8f\u5217\uff0c\u5355\u8c03\u961f\u5217 $dp$\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int NR=1e6+10;\nconst int INF=0x3f3f3f3f3f3f3f3fll;\nvoid Min(int& x,int y){x=min(x,y);}\nvoid Max(int& x,int y){x=max(x,y);}\nint n,w;\nchar a[NR];\nint pi[NR];\nint gcd(int a,int b){\n\treturn !b?a:gcd(b,a%b);\n}\nint getnxt(int x,char ch){\n\tif(a[x+1]==ch)return x+1;\n\treturn x?getnxt(pi[x],ch):0;\n}\nint dis[NR];\nint num[NR],tot;\nint now,res[NR];\nint q[NR],all,Q[NR];\nvoid Init()\n{\n\tmemset(num,0,sizeof(num));tot=0;\n\tmemset(res,0,sizeof(res));\n\tmemset(q,0,sizeof(q));\n\tmemset(Q,0,sizeof(Q));\n\tmemset(pi,0,sizeof(pi));\n}\nvoid tomod(int x)\n{\n\tint cnt=gcd(x,now);\n\tfor(int i=0;i<now;i++)res[i]=dis[i];\n\tfor(int i=0;i<x;i++)dis[i]=INF;\n\tfor(int i=0;i<now;i++)\n\t{\n\t\tint tmp=res[i]%x;\n\t\tMin(dis[tmp],res[i]);\n\t}\n\tfor(int t=0;t<cnt;t++)\n\t{\n\t\tall=0;q[++all]=t;int tmp=(t+now)%x;\n\t\twhile(tmp!=t){q[++all]=tmp;tmp=(tmp+now)%x;}\n\t\tfor(int i=1;i<=all;i++)q[i+all]=q[i];\n\t\tfor(int i=2;i<=all*2;i++)Min(dis[q[i]],dis[q[i-1]]+now);\n\t}now=x;\n}\nstruct Nd{int id,x;};\nNd Md(int id,int x){Nd tmp;tmp.id=id,tmp.x=x;return tmp;}\nvoid doit(int fir,int siz,int d)\n{\n\tint cnt=gcd(d,fir);tomod(fir);if(d<0)return;\n\tfor(int t=0;t<cnt;t++)\n\t{\n\t\tall=0;q[++all]=t;int tmp=(t+d)%fir,pos=1,all2=all;\n\t\twhile(tmp!=t){q[++all]=tmp;tmp=(tmp+d)%fir;}all2=all;\n\t\tfor(int i=2;i<=all;i++)if(dis[q[i]]<dis[q[pos]])pos=i;\n\t\tall=0;for(int i=pos;i<=all2;i++)Q[++all]=q[i];\n\t\tfor(int i=1;i<=pos-1;i++)Q[++all]=q[i];\n\t\tdeque<Nd>p;p.push_front(Md(1,dis[Q[1]]-d));\n\t\tfor(int i=2;i<=all;i++)\n\t\t{\n\t\t\twhile(!p.empty()&&p.front().id<i-siz)p.pop_front();\n\t\t\tif(!p.empty())Min(dis[Q[i]],p.front().x+i*d+fir);\n\t\t\twhile(!p.empty()&&p.back().x>=dis[Q[i]]-i*d)p.pop_back();\n\t\t\tp.push_back(Md(i,dis[Q[i]]-i*d));\n\t\t}\n\t}\n}\nint read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=(x<<3)+(x<<1)+(ch^48);ch=getchar();}\n\treturn x*f;\n}\nsigned main()\n{\n\tint T=read();\n\twhile(T--)\n\t{\n\t\tn=read(),w=read();scanf(\"%s\",a+1);now=n;w-=n;\n\t\tmemset(dis,0x3f,sizeof(dis));dis[0]=0;Init();\n\t\tfor(int i=2;i<=n;i++)pi[i]=getnxt(pi[i-1],a[i]);\n\t\tint j=pi[n];while(j)num[++tot]=n-j,j=pi[j];j=1;num[++tot]=n;\n\t\tfor(int i=1;i<=tot;i=j)\n\t\t{\n\t\t\twhile(num[i+1]-num[i]==num[j+1]-num[j])j++;\n\t\t\tdoit(num[i],j-i-1,num[i+1]-num[i]);\n\t\t}int ans=0;\n\t\tfor(int i=0;i<now;i++)if(dis[i]<=w)\n\t\t\tans+=(w-dis[i])/now+1;\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}",
        "postTime": 1614776009,
        "uid": 97136,
        "name": "chenzida",
        "ccfLevel": 0,
        "title": "\u8bba\u6218\u6346\u7af9\u7aff"
    }
]