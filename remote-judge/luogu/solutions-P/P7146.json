[
    {
        "content": "\u778e\u51e0\u628a\u5199\u7684\u4e71\u641e\u3002\n\n\u9996\u5148\u62ff\u90a3\u4e2a maker \u73a9\u4e00\u73a9\uff0c\u53ef\u4ee5\u53d1\u73b0\u73af\u6570\u4e00\u822c\u90fd\u5f88\u5c0f\uff0c\u968f\u4e86\u86ee\u4e45\u597d\u50cf\u6700\u5927\u5c31 7 \u7684\u6837\u5b50\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u628a\u6d89\u53ca\u5230\u7684 14 \u4e2a\u70b9\u62ff\u51fa\u6765\uff0c\u679a\u4e3e\u9009/\u4e0d\u9009\uff0c\u6811\u5f62\u80cc\u5305\u3002\n\n\u7136\u540e\u8fd9\u6837\u662f $\\mathcal O(4^{cnt}\\cdot n)$ \u7684\uff0c\u8fc7\u4e0d\u53bb\u3002\n\n\u7136\u540e\u53ef\u4ee5\u53d1\u73b0\u4e00\u822c\u662f\u4e0d\u8fde\u901a\u7684\uff0c\u6709\u6548\u7684\u8fde\u901a\u5757\u5927\u5c0f\u5927\u6982\u662f\u51e0\u5343\u7684\u6837\u5b50\uff08\u5177\u4f53\u591a\u5c11\u6211\u4e0d\u8bb0\u5f97\u4e86\uff09\u7136\u540e\u53ea\u5bf9\u8fd9\u4e9b\u8fde\u901a\u5757 dp\uff0c\u5370\u8c61\u4e2d\u53ef\u4ee5\u8dd1\u5230\u6bd4\u8f83\u540e\u7684\u70b9\u4e86\uff0c\u4f46\u8fd8\u662f\u8fc7\u4e0d\u53bb\u3002\n\n\u7136\u540e\u53ef\u4ee5\u53d1\u73b0\u6bcf\u6761\u73af\u8fb9\u90fd\u662f\u8fd4\u7956\u8fb9\u7684\uff0c\u90a3\u4e48\u6709\u6548\u679a\u4e3e\u91cf\u53ea\u6709 $3^{cnt}$ \u7684\uff0c\u5148\u679a\u4e3e\u6bcf\u6761\u8fd4\u7956\u8fb9\u8d21\u732e/\u4e0d\u8d21\u732e\uff0c\u5bf9\u4e8e\u4e0d\u8d21\u732e\u7684\u60c5\u51b5\u53ea\u9700\u8981\u679a\u4e3e\u513f\u5b50\u7684\u9009\u62e9\u60c5\u51b5\u3002\n\n\u590d\u6742\u5ea6\u5c31\u662f $\\mathcal O(3^{cnt}\\cdot \\textrm{size})$ \u4e86\u3002$\\rm size$ \u662f\u6d89\u53ca\u5230\u7684\u6811\u7684\u5927\u5c0f\uff0c$cnt$ \u662f\u73af\u6570\u3002\n\n\u4ee3\u7801\u5f88\u4e11\uff0c\u4fee\u4fee\u8865\u8865\u8fc7\u7684\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std ;\n#define Next( i, x ) for( register int i = head[x]; i; i = e[i].next )\n#define rep( i, s, t ) for( register int i = (s); i <= (t); ++ i )\n#define drep( i, s, t ) for( register int i = (t); i >= (s); -- i )\n#define re register\n#define mp make_pair\n#define pi pair<int, int>\n#define pb push_back\n#define vi vector<int>\n#define int long long\nint gi() {\n\tchar cc = getchar() ; int cn = 0, flus = 1 ;\n\twhile( cc < '0' || cc > '9' ) {  if( cc == '-' ) flus = - flus ; cc = getchar() ; }\n\twhile( cc >= '0' && cc <= '9' )  cn = cn * 10 + cc - '0', cc = getchar() ;\n\treturn cn * flus ;\n}\nconst int inf = 1e14 + 7 ; \nconst int P = 1e9 + 7 ; \nconst int N = 2e5 + 5 ; \nconst int M = 30 ; \nint n, m, cnt, A[N], Ans, dp[N][2], zk[N], zt[N], g[N], rt[N] ; \nint head[N], fa[N], st[M], top, c[M], zmy, f[N] ;\nint ban[N] ; \nstruct E {\n\tint to, next, w ; \n} e[N] ; \nmap<pi, int> S ;\nstruct node {\n\tint x, y, z ; \n};\nnode ST[15] ; int num ; \nint fd(int x) {\n\treturn (fa[x] == x) ? fa[x] : fa[x] = fd(fa[x]) ; \n}\nvoid add(int x, int y, int z) {\n\te[++ cnt] = (E){ y, head[x], z }, head[x] = cnt,\n\te[++ cnt] = (E){ x, head[y], z }, head[y] = cnt ; \n}\nvoid merge(int x, int y, int zz) {\t\n\tint u = fd(x), v = fd(y) ;\n\tfa[u] = v, add(x, y, zz) ; \n} \nint dfn[N], color ; \nvoid dfs(int x, int ff) {\n\tzk[x] = 1 ; \n\tNext( i, x ) {\n\t\tint v = e[i].to ; if(v == ff) continue ; \n\t\tif(ban[i]) continue ; \n\t\tdfs(v, x) ; \n\t\tdp[x][0] += max(dp[v][1], dp[v][0]) ;\n\t\tdp[x][1] += max(dp[v][1] - e[i].w, dp[v][0]) ; \n\t}\n}\nvoid Dfs(int x, int ff) {\n\tdfn[x] = ++ color ;\n\tif(x == ff) rt[x] = 1 ;  \n\tNext( i, x ) {\n\t\tint v = e[i].to ; if(v == ff) continue ; \n\t\tif( !dfn[v] ) Dfs( v, x ), g[x] |= g[v] ;\n\t\telse if(dfn[v] < dfn[x]) \n\t\tST[++ num] = (node){v, x, e[i].w}, ban[i] = 1, ban[i ^ 1] = 1, g[x] = 1 ; \n\t}\n}\nint h[N], qls, cc[100], ttop ; \nint root[N], fgo ; \nsigned main()\n{\n\tint xx, yy, zz ; cnt = 1 ; \n\tn = gi(), m = gi(), xx = gi(), yy = gi(), A[0] = gi(), zz = gi() ; \n\trep( i, 1, n ) A[i] = (A[i - 1] * 101 + 137) % P ; \n\trep( i, 1, n ) fa[i] = i ; \n\trep( i, 1, m ) {\n\t\txx = (xx * 101 + 137) % P, yy = (yy * 101 + 137) % P,\n\t\tzz = (zz * 101 + 137) % P ; \n\t\tint x = xx % n + 1, y = yy % n + 1 ; \n\t\tif(!S[mp(x, y)] && (x != y)) \n\t\t\tS[mp(x, y)] = S[mp(y, x)] = 1, merge(x, y, zz) ; \n\t}\n\trep( i, 1, n ) if(!dfn[i]) Dfs(i, i) ; \n\tfor(re int i = 1; i <= num; ++ i)\n\tst[++ top] = ST[i].x, st[++ top] = ST[i].y ; \n\tsort(st + 1, st + top + 1) ; \n\trep( i, 1, top ) if(st[i] != st[i - 1]) c[++ zmy] = st[i] ; \n\tint limit = (1 << zmy) - 1 ; \n\trep( i, 1, zmy ) f[c[i]] = 1 ; \n\tint SA = 0 ; \n\trep( i, 1, n ) dp[i][0] = 0, dp[i][1] = A[i] ;\n\trep( i, 1, n ) if(rt[i] && (!g[i])) dfs(i, i), SA += max(dp[i][0], dp[i][1]) ; \n\trep( i, 1, n ) if(!zk[i]) h[++ qls] = i ; \n\trep( i, 1, n ) if(!zk[i] && rt[i]) root[++ fgo] = i ; \n\tlimit = (1 << num) - 1 ; \n\tfor(re int AC = 0; AC <= limit; ++ AC) {\n\t\tint fSA = SA ; \n\t\trep( j, 1, zmy ) zt[c[j]] = 0 ;\n\t\tfor(re int j = 1; j <= num; ++ j) {\n\t\t\tif(AC & (1 << (j - 1))) \n\t\t\tfSA -= ST[j].z, zt[ST[j].x] = 1, zt[ST[j].y] = 1 ; \n\t\t}\n\t\tint lim = (AC ^ limit) ; \n\t\tfor(re int T = lim; ; T = (T - 1) & lim) {\n\t\t\trep( i, 1, qls ) zk[h[i]] = 0, dp[h[i]][1] = A[h[i]], dp[h[i]][0] = 0 ; \n\t\t\trep( j, 1, zmy ) if(zt[h[j]]) dp[h[j]][0] = -inf ; \n\t\t\trep( j, 1, num ) {\n\t\t\t\tif(!((1 << (j - 1)) & lim)) continue ; \n\t\t\t\tif((1 << (j - 1)) & T) \n\t\t\t\tdp[ST[j].x][0] = -inf, dp[ST[j].y][1] = -inf ; \n\t\t\t\telse \n\t\t\t\tdp[ST[j].x][1] = -inf ; \n\t\t\t}\n\t\t\tint ans = fSA ; \n\t\t\trep( i, 1, fgo ) dfs(root[i], root[i]), ans += max( dp[root[i]][0], dp[root[i]][1] ) ; \n\t\t\tAns = max(Ans, ans) ; \n\t\t\tif(!T) break ; \n\t\t}\n\t}\n\tcout << Ans << endl ; \n\treturn 0 ;\n}\n```",
        "postTime": 1608885209,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P7146 \u3010[THUPC2021 \u521d\u8d5b]\u72ec\u7acb\u3011"
    },
    {
        "content": "## P7146\n\n\u9996\u5148\u5173\u6ce8\u8fb9\u5f88\u5c11\uff0c\u800c\u4e14\u6570\u636e\u968f\u673a\uff0c\u8fd9\u63d0\u793a\u6211\u4eec\u8fd9\u9053\u9898\u53ef\u4ee5\u4e71\u641e\uff0c\u7ecf\u8fc7\u968f\u673a\u53ef\u4ee5\u77e5\u9053\u73af\u7684\u4e2a\u6570\u4e0d\u4f1a\u5f88\u591a\uff0c\u6211\u4eec\u628a\u6240\u6709\u7684\u73af\u627e\u51fa\u6765\uff0c\u5220\u6389\u4e00\u4e2a\u70b9\uff0c\u8fd9\u6837\u6574\u5f20\u56fe\u53d8\u6210\u68ee\u6797\uff0c\u7136\u540e\u5728\u68ee\u6797\u4e0a\u8fdb\u884c dp\uff0c\u5bf9\u4e8e\u8fd9\u4e9b\u5220\u9664\u7684\u70b9\uff0c\u76f4\u63a5\u66b4\u529b\u679a\u4e3e\u9009\u4e0d\u9009\u5373\u53ef\u3002\n\n\u6ce8\u610f\uff0c\u5220\u70b9\u7684\u65f6\u5019\u6ce8\u610f\u5220\u6389\u4e86\u4e00\u4e2a\u70b9\uff0c\u5c31\u66f4\u65b0\u4e00\u4e0b\u6574\u5f20\u56fe\uff0c\u5426\u5219\u53ef\u80fd\u4f1a\u91cd\u590d\u5220\u4e00\u4e2a\u73af\u4e0a\u7684\u70b9\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u4e0d\u8fd9\u6837\u505a\uff0c\u4e00\u6761\u975e\u6811\u8fb9\u7684\u4e24\u8fb9\u8282\u70b9\u90fd\u4f1a\u88ab\u5220\u6389\u4e00\u6b21\uff0c\u6240\u4ee5\u5220\u7684\u70b9\u6570\u5c31\u7ffb\u500d\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n\n```\n\n#include<bits/stdc++.h>\n#define mset(a,b) memset((a),(b),sizeof((a)))\n#define rep(i,l,r) for(int i=(l);i<=(r);i++)\n#define dec(i,l,r) for(int i=(r);i>=(l);i--)\n#define inc(a,b) (((a)+(b))>=mod?(a)+(b)-mod:(a)+(b))\n#define sub(a,b) (((a)-(b))<0?(a)-(b)+mod:(a)-(b))\n#define mul(a,b) 1ll*(a)*(b)%mod\n#define sgn(a) (((a)&1)?(mod-1):1)\n#define cmax(a,b) (((a)<(b))?(a=b):(a))\n#define cmin(a,b) (((a)>(b))?(a=b):(a))\n#define Next(k) for(int x=head[k];x;x=li[x].next)\n#define fi first\n#define se second\n#define mp make_pair\n#define pb push_back\n#define N 100010\n#define M number\nusing namespace std;\n\ntypedef double dd;\ntypedef long double ld;\ntypedef long long ll;\ntypedef unsigned int uint;\ntypedef unsigned long long ull;\n#define int long long\ntypedef pair<int,int> P;\ntypedef vector<int> vi;\n\nconst int INF=0x3f3f3f3f;\nconst dd eps=1e-9;\n\ntemplate<typename T> inline void read(T &x) {\n    x=0; int f=1;\n    char c=getchar();\n    for(;!isdigit(c);c=getchar()) if(c == '-') f=-f;\n    for(;isdigit(c);c=getchar()) x=x*10+c-'0';\n    x*=f;\n}\n\nint n,m,x,y,z,a[N],q=101,b=137,p=1e9+7;\nstruct edge{\n    int to,next,w;\n    inline void Init(int to_,int ne_,int w_){\n        to=to_;next=ne_;w=w_;\n    }\n}li[N<<1];\nint head[N],tail=1,sp[N],st,cho[N],ans,nowans;\nint ft;\nmap<P,bool> Map;\nbool vis[N],ban[N];\n\ninline void Add(int from,int to,int w){\n    // printf(\"from=%d to=%d w=%d\\n\",from,to,w);\n    li[++tail].Init(to,head[from],w);head[from]=tail;\n}\ninline void PreWork(){\n    read(n);read(m);read(x);read(y);read(a[0]);read(z);\n    rep(i,1,n) a[i]=(1ll*q*a[i-1]%p+b)%p;\n    // rep(i,1,n) printf(\"%d \",a[i]);puts(\"\");\n    rep(i,1,m){\n        x=(1ll*q*x%p+b)%p;y=(1ll*q*y%p+b)%p;z=(1ll*q*z%p+b)%p;\n        int nx=x%n+1,ny=y%n+1;\n        if(Map[mp(nx,ny)]||nx==ny) continue;Map[mp(nx,ny)]=Map[mp(ny,nx)]=1;\n        Add(nx,ny,z);Add(ny,nx,z);\n    }\n}\ninline void dfs(int k,int fa){\n    vis[k]=1;\n    // for(int x=head[k];x;x=li[x].next){\n    //     int to=li[x].to,w=li[x].w;if(to==fa) continue;\n    //     if(vis[to]) sp[++st]=to;\n    //     else dfs(to,k);\n    // }\n    Next(k){\n        int to=li[x].to,w=li[x].w;if(to==fa||ban[to]) continue;\n        if(vis[to]){sp[++st]=k,ban[k]=1;}\n    }\n    if(ban[k]) return;\n    Next(k){\n        int to=li[x].to,w=li[x].w;if(to==fa||ban[to]) continue;\n        dfs(to,k);\n    }\n}\nnamespace s1{\n    int f[N][2];\n    inline void dp(int k,int fa){\n        f[k][1]=a[k];f[k][0]=0;vis[k]=1;\n        for(int x=head[k];x;x=li[x].next){\n            int to=li[x].to;if(to==fa) continue;\n            if(!ban[to]) dp(to,k);\n        }\n        for(int x=head[k];x;x=li[x].next){\n            int to=li[x].to;if(to==fa) continue;\n            if(!ban[to]){\n                f[k][1]+=max(f[to][0],f[to][1]-li[x].w);\n                f[k][0]+=max(f[to][0],f[to][1]);\n            }\n            else{\n                if(cho[to]) f[k][1]-=li[x].w;\n            }\n        }\n    }\n    inline void dfs(int k){\n        // if(((dd)clock()-(dd)ft)/CLOCKS_PER_SEC>=0.95){\n        //     printf(\"%lld\\n\",ans);exit(0);\n        // }\n        if(k==st+1){\n            nowans=0;rep(i,1,st) if(cho[sp[i]]) nowans+=a[sp[i]];\n            rep(i,1,st) if(cho[sp[i]]){\n                for(int x=head[sp[i]];x;x=li[x].next){\n                    int to=li[x].to;if(cho[to]&&to>sp[i]) nowans-=li[x].w;\n                }\n            }\n            mset(vis,0);\n            // mset(f,0);\n            rep(i,1,n) if(!vis[i]&&!ban[i]) dp(i,0),nowans+=max(f[i][0],f[i][1]);\n            ans=max(ans,nowans);\n            return;\n        }\n        int now=random()%2;\n        cho[sp[k]]=now;dfs(k+1);cho[sp[k]]=now^1;dfs(k+1);\n    }\n}\ninline void Solve(){\n    rep(i,1,n) if(!vis[i]) dfs(i,0);\n    // printf(\"st=%d\\n\",st);\n    // st=min(st,10ll);\n    // st=unique(sp+1,sp+st+1)-sp-1;\n    rep(i,1,st) ban[sp[i]]=1;\n    s1::dfs(1);printf(\"%lld\\n\",ans);\n}\n\nsigned main(){\n    srand(time(0));\n    // assert(freopen(\"my.in\",\"r\",stdin));\n    // assert(freopen(\"my.out\",\"w\",stdout));\n    ft=clock();\n    PreWork();Solve();return 0;\n}\n\n```",
        "postTime": 1648644267,
        "uid": 194093,
        "name": "\u5929\u68a6",
        "ccfLevel": 6,
        "title": "P7146"
    }
]