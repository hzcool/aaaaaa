[
    {
        "content": "### \u89e3\u9898\u601d\u8def\n\n\u9996\u5148\uff0c**\u6bcf\u4e2a\u70b9\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\u51fa\u8fb9\u7684\u56fe\u6784\u6210\u5185\u5411\u57fa\u73af\u68ee\u6797**\u3002\n\n\u8bbe\u4e00\u5171\u6709 $n$ \u4e2a\u70b9\uff0c\u4e0d\u96be\u8bc1\u660e\uff1a**\u5728\u5185\u5411\u57fa\u73af\u68ee\u6797\u4e0a\u8d70** $n$ **\u6b21\u51fa\u8fb9\uff0c\u6b64\u65f6\u4e00\u5b9a\u505c\u7559\u5728\u73af\u4e0a**\u3002\n\n\u660e\u767d\u8fd9\u4e24\u4e2a\u5957\u8def\u540e\uff0c\u8fd9\u9898\u5c31\u7b80\u5355\u8bb8\u591a\u4e86\u3002\n\n\u8003\u8651\u5efa\u7acb\u500d\u589e\u6570\u7ec4 $e_{i,\\,u}$ \uff0c\u8868\u793a\u4ece\u70b9 $u$ \u51fa\u53d1\u8d70 $2^i$ \u6b21\u51fa\u8fb9\u505c\u7559\u7684\u4f4d\u7f6e\u3002\u4ee5\u4fbf\u6211\u4eec\u5728 $O(\\log n)$ \u7684\u65f6\u95f4\u91cc\u67e5\u8be2\u8d70\u4efb\u610f $\\le n$ \u6b21\u51fa\u8fb9\u505c\u7559\u7684\u4f4d\u7f6e\u3002\n\n\u56e0\u4e3a\u8d70\u5230\u73af\u4e0a\u65f6\uff0c\u60f3\u4e00\u76f4\u8d70\u5fc5\u7136\u662f\u7ed5\u7740\u8fd9\u4e2a\u73af\u8f6c\u5708\uff0c\u81ea\u7136\u60f3\u5230\u5e94\u8be5\u5b58\u4e0b\u6bcf\u4e2a\u73af\u7684\u4fe1\u606f\uff08\u4f8b\u5982\u5927\u5c0f\uff0c\u4e0a\u9762\u6709\u54ea\u4e9b\u70b9\uff0c\u6bcf\u4e2a\u70b9\u5728\u4f55\u4f4d\u7f6e\u7b49\uff09\u3002\n\n\u56e0\u6b64\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u6211\u4eec\u5148\u8d70 $n$ \u6b65\uff0c\u5982\u5f15\u7406\u6240\u8ff0\uff0c\u6211\u4eec\u6b64\u65f6\u6b63\u5728\u67d0\u4e2a\u73af\u4e0a\uff0c\u5982\u679c\u8fd9\u4e2a\u73af\u5c1a\u672a\u88ab\u8bb0\u5f55\uff0c\u6211\u4eec\u7ed5\u7740\u73af\u8d70\u76f4\u5230\u56de\u5230\u51fa\u53d1\u7684\u4f4d\u7f6e\u987a\u4fbf\u8bb0\u5f55\u4fe1\u606f\u3002\n\n\u5982\u4f55\u5904\u7406\u8be2\u95ee\uff1f\u8fd8\u662f\u57fa\u4e8e\u90a3\u4e2a\u5f15\u7406\u3002\u5982\u679c\u8be2\u95ee\u7684 $t$ \u5f88\u5c0f\uff08$< n$\uff09\uff0c\u4ee5\u81f3\u4e8e\u6211\u4eec\u65e0\u6cd5\u5224\u65ad\u7ec8\u70b9\u662f\u5426\u5904\u4e8e\u73af\u4e0a\uff0c\u6b64\u65f6\u6070\u597d\u500d\u589e\u6570\u7ec4\u6b63\u662f\u4e3a\u8fd9\u4e2a\u8303\u56f4\u670d\u52a1\u7684\u3002\u5426\u5219\u4ee4 $t' = t - n$ \uff0c\u5373\u5148\u8d70 $n$ \u6b65\u518d\u8d70 $t'$ \u6b65\uff0c\u6211\u4eec\u6c42\u51fa $n$ \u6b65\u540e\u4f4d\u4e8e\u73af\u4e0a\u7684\u4f4d\u7f6e\uff0c\u800c $t'$ \u6b65\u90fd\u662f\u5728\u7ed5\u5708\uff08\u5468\u671f\u4e3a\u73af\u7684\u5927\u5c0f\uff0c\u8bbe\u5176\u4e3a $s$\uff09\u3002\u53ea\u6709 $t'\\ \\text{mod}\\ s = (t_1^{t_2} - n)\\ \\text{mod}\\ s$ \u6b65\u662f\u6709\u7528\u7684\uff0c\u5feb\u901f\u5e42\u53ca\u51cf\u6cd5\u7684\u5f97\u5230\u8be5\u4f59\u6570\uff0c\u7136\u540e\u76f4\u63a5\u4f7f\u7528\u4e4b\u524d\u9884\u5904\u7406\u73af\u7684\u4fe1\u606f\u6765\u67e5\u8be2\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n \\log n + m \\log t)$ \u3002\n\n---\n\n### \u4ee3\u7801\u5b9e\u73b0\n\n```cpp\n#include <bits/stdc++.h>\n\ninline int read() {\n    char c; int x; for (c = getchar(); !isdigit(c); c = getchar());\n    for (x = 0; isdigit(c); c = getchar()) { x = x * 10 + c - '0'; } return x;\n}\n\ninline int power(int x, int y, int mod, int res = 1) {\n    for (; y; y >>= 1, x = 1ll * x * x % mod) {\n        if (y & 1) { res = 1ll * res * x % mod; }\n    } return res;\n}\n\nconst int N = 5e5 + 5, L = 19;\n\nint n, m, q, lgn, e[L][N], bln[N], pos[N];\nstd::vector<int> cyc[N];\n\nint check(int x, int y) {\n    if (x == 1) { return 1; }\n    long long tmp = 1;\n    for (; y; y--) {\n        tmp *= x;\n        if (tmp > n) { return -1; }\n    } return tmp;\n}\n\nint jump(int u, int x) {\n    for (int i = 0; i <= lgn; i++) {\n        if (1 << i & x) { u = e[i][u]; }\n    } return u;\n}\n\nint main() {\n    n = read(); lgn = log(n) / log(2) + 1e-7;\n    for (int i = 1; i <= n; i++) {\n        e[0][i] = read(); bln[i] = -1;\n    }\n    for (int j = 1; j <= lgn; j++) {\n        for (int i = 1; i <= n; i++) {\n            e[j][i] = e[j - 1][e[j - 1][i]];\n        }\n    }\n    for (int i = 1; i <= n; i++) {\n        int u = e[lgn][e[lgn][i]];\n        if (bln[u] == -1) {\n            for (; bln[u] == -1; u = e[0][u]) {\n                bln[u] = m; pos[u] = cyc[m].size();\n                cyc[m].push_back(u);\n            }\n            m++;\n        }\n    }\n    for (q = read(); q; q--) {  \n        int u = read(), x = read(), y = read(), z = check(x, y);\n        if (z == -1) {\n            u = jump(u, n);\n            int s = cyc[bln[u]].size();\n            z = (power(x, y, s) + s - n % s) % s;\n            u = cyc[bln[u]][(pos[u] + z) % s];\n        } else {\n            u = jump(u, z);\n        } printf(\"%d\\n\", u);\n    }\n    return 0;\n}\n```",
        "postTime": 1568432293,
        "uid": 26673,
        "name": "Sooke",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5557 \u3010\u65c5\u884c\u3011"
    },
    {
        "content": "\u6309\u7167\u9898\u610f\u628a\u6bcf\u4e2a\u70b9 $i$ \u8fde\u5230 $a_i$ \u5efa\u56fe\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u6bcf\u4e2a\u70b9\u53ea\u6709\u4e00\u4e2a\u51fa\u8fb9\u7684 DAG\u3002\n\n\u56fe\u4e0d\u4e00\u5b9a\u8054\u901a\uff0c\u8003\u8651\u7528 tarjan \u627e\u5230\u6bcf\u4e2a\u8054\u901a\u5757\u5185\u7684\u73af\uff0c\u90a3\u4e48\u5bf9\u4e8e\u8be2\u95ee\u7684\u70b9 $s$\uff0c\u8ba8\u8bba\u5176\u662f\u5426\u5728\u5b83\u6240\u5728\u8054\u901a\u5757\u7684\u73af\u4e0a\u3002\n\n\u5047\u8bbe\u73af\u7684\u5927\u5c0f\u4e3a $l$\u3002\n\n1. \u5982\u679c\u5728\u73af\u4e0a\uff0c\u90a3\u4e48\u5fc5\u7136\u8d70\u7684\u662f\u4e2a\u4ee5\u73af\u4e0a\u70b9\u4e2a\u6570\u4e3a\u5468\u671f\u7684\u8def\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u4ece $s$ \u8d70 $len=t1^{t2}\\bmod l$\u3002\n2. \u5982\u679c\u4e0d\u5728\uff0c\u90a3\u4e48\u6c42\u51fa $s$ \u5230\u73af\u7684\u8ddd\u79bb $a$\uff0c\u56e0\u4e3a\u51fa\u8fb9\u552f\u4e00\uff0c\u6240\u4ee5 $s$ \u5230\u73af\u8fd9\u6761\u8def\u5f84\u662f\u4e00\u6761\u552f\u4e00\u7684\u94fe\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u4ece $s$ \u8d70 $len=(t1^{t2}+a) \\bmod l$ \u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O(nm)}$\uff0c\u5c31\u6709 $70\\ pts$ \u4e86\u3002\n\n\u53d1\u73b0\u8fd9\u91cc\u4e86\u8981\u4f18\u5316\u4ece $s$ \u8d70 $len$ \u7684\u957f\u5ea6\uff0c\u53ef\u4ee5\u8003\u8651\u500d\u589e\u3002\n\n\u5047\u8bbe $f[i][j]$ \u8868\u793a\u4ece\u70b9 $i$ \u8d70 $2^j-1$ \u8ddd\u79bb\u540e\u7684\u70b9\u3002\n\n\u90a3\u4e48\u4fbf\u6709\u8f6c\u79fb $f[i][j]=f[\\ a[\\ f[i][j-1]\\ ]\\ ][j-1]$\u3002\n\n\u521d\u59cb\u6761\u4ef6 $f[i][0]=a[i]$\n\n\u7531\u4e8e\u4efb\u4f55\u6570\u90fd\u53ef\u4ee5\u8868\u793a\u4e3a $2$ \u8fdb\u5236\u6570\uff0c\u90a3\u4e48\u5c31\u6709\u4efb\u4f55\u4e00\u4e2a\u6570\u53ef\u4ee5\u8868\u793a\u4e3a $2$ \u7684\u5e42\u7684\u548c ~~(CSP2020 J T1)~~\u3002\u540c\u7406 $len$ \u53ef\u4ee5\u8868\u793a\u4e00\u4e9b $2$ \u7684\u5e42\u7684\u548c\uff0c\u90a3\u4e48\u5c06\u5176 $2$ \u8fdb\u5236\u62c6\u5206\uff0c\u5f53 $len$ \u7684\u4e8c\u8fdb\u5236\u7b2c $i$ \u4f4d\u4e3a $1$ \u5c31\u8df3\u5230 $a[f[now][i]]$\uff08$now$ \u4e3a\u5f53\u524d\u8df3\u5230\u7684\u4f4d\u7f6e\uff09\n\n\u7136\u540e\u5c31\u505a\u5b8c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O(n\\log n+m\\log len)}$",
        "postTime": 1605797878,
        "uid": 119062,
        "name": "Lates",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5557 \u3010\u65c5\u884c\u3011"
    }
]