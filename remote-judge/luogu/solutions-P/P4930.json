[
    {
        "content": "[P4930 [PA2013]Euler](https://www.luogu.com.cn/problem/P4930)\u89e3\u9898\u62a5\u544a\uff1a\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://zybuluo.com/xiaoziyao/note/1784346)\n\n## \u9898\u610f\n$T$\u7ec4\u6570\u636e\uff0c\u7ed9\u5b9a$n$\uff0c\u6c42$\\varphi(m)=n$\u7684\u6240\u6709$m$\u3002\uff08$1\\leqslant n\\leqslant 10^{10}$\uff09\n\n## \u5206\u6790\n\n\u539f\u6765\u7684\u9898\u76ee\u6570\u636e\u6709\u9505\uff0c\u4fee\u5b8c\u6570\u636e\u540e\u62ff\u5230\u4e86\u9996\u6740\u3002\n\n\u641c\u7d22\u9898\u3002\n\n\u9996\u5148$O(\\sqrt{n})$\u6c42\u51fa$n$\u7684\u6240\u6709\u56e0\u5b50\u8ba1\u5165$D_{1\\cdots Ds}$\uff0c\u7136\u540e\u628a\u6240\u6709$D_i+1$\u4e2d\u4e3a\u8d28\u6570\u7684\u503c\u5b58\u5165$P_{1\\cdots Ps}$\uff0c\u4e0d\u96be\u53d1\u73b0$Ds$\u548c$Ps$\u5f88\u5c0f\uff0c\u968f\u4fbf~~\u4ea4\u51e0\u53d1~~\u8ba8\u8bba\u4e00\u4e0b\u5c31\u53ef\u4ee5\u77e5\u9053$Ds$\u6700\u5927\u662f$2500$\uff0c$Ps$\u6700\u5927\u662f$700$\u3002\n\n\u8bb0$ord_i$\u4e3a\u6570\u5b57$i$\u5728$n$\u8d28\u56e0\u6570\u4e2d\u7684\u6392\u540d\uff0c\u4f46\u7531\u4e8e\u8fd9\u91cc\u53ef\u80fd\u5b58\u4e0d\u4e0b\uff0c\u56e0\u6b64\u8003\u8651\u5bf9\u4e8e$i$\u7684\u5927\u5c0f\u8ba8\u8bba\uff1a\u5982\u679c$i\\leqslant \\sqrt{n}$\u5219\u5c06$i$\u7684\u6392\u540d\u5b58\u5165$ord_i$\uff0c\u5426\u5219\u5c06$i$\u7684\u6392\u540d\u5b58\u5165$nord_{\\frac{n}{i}}$\uff0c\u8fd9\u6837\u5c31\u53ea\u9700\u8981\u5f00$O(\\sqrt{n})$\u7684\u6570\u7ec4\u4e86\u3002\n\n\u7136\u540e\u5c31\u5f00\u59cb\u7384\u5b66\u8d77\u6765\u4e86\u3002\n\n\u8bbe$f_{i,j}$\u4ee3\u8868$P_j\\cdots P_{Ps}$\u4e2d\u7b2c\u4e00\u4e2a\u662f$D_i$\u56e0\u5b50\u7684\u6570\u7684\u7f16\u53f7\uff0c\uff08\u5982\u679c\u4e0d\u5b58\u5728\u5219\u4e3a$Ps+1$\uff09\n\n\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e2a\u4f17\u6240\u5468\u77e5\u7684\u7ed3\u8bba\uff1a\u5bf9\u4e8e$n=\\prod_{i=1}^s p_i^k$\uff0c\u6ee1\u8db3$\\varphi(n)=n\\times\\prod_{i=1}^s\\frac{p_i-1}{p_i}$\uff08\u4e0b\u9762\u6709\u8bc1\u660e\uff09\u3002\n\n\u7136\u540e\u8fdb\u884c\u641c\u7d22\uff1a$dfs(pos,val,now)$\u8868\u793a\u73b0\u5728\u641c\u7d22\u5230\u7b2c$pos$\u4e2a$P$\u4e86\uff0c\u5c06$n$\u9664\u5230\u4e86$now$\uff08\u8fd9\u4e2a$now$\u4e3a\u503c\uff09\uff0c\u5e76\u628a\u7b54\u6848\u4e58\u5230\u4e86$val$\uff0c\u8fb9\u754c\u5c31\u662f$now=1$\u7684\u65f6\u5019\u76f4\u63a5\u628a$val$\u653e\u5165\u7b54\u6848\u3002\n\n\u4e0d\u96be\u53d1\u73b0$now$\u4e00\u5b9a\u5728$D$\u91cc\uff08\u53ef\u4ee5\u901a\u8fc7$ord$\u548c$nord$\u627e\u5230\uff09\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7$f$\u8df3\u8fc7\u90a3\u4e9b\u4e0d\u80fd\u6574\u9664$now$\u7684$P$\u3002\n\n\u7136\u540e\u518d\u5206\u7c7b\u8ba8\u8bba\u5c31\u597d\u4e86\uff1a\n\n- \u4e0e\u5f53\u524d\u8d28\u6570\u65e0\u5173\u7cfb\uff0c\u76f4\u63a5$dfs(pos+1,val,now)$\u3002\n- \u53ea\u6709$1$\u6b21\u5e42\uff0c\u628a$now$\u9664\u53bb$P_{pos}-1$\uff0c\u628a$val$\u4e58\u4e0a$P_{pos}$\uff0c\u7136\u540e$dfs(pos+1,val,now)$\u3002\n- \u6709\u9ad8\u6b21\u5e42\uff0c\u90a3\u4e48\u5728$1$\u6b21\u5e42\u7684\u57fa\u7840\u4e0a\u5c06$now$\u9664\u53bb\u82e5\u5e72\u6b21$P_pos$\uff0c\u628a$val$\u4e58\u4e0a\u82e5\u5e72\u6b21$P_{pos}$\uff0c\u7136\u540e$dfs(pos+1,val,now)$\u3002\n\n\u590d\u6742\u5ea6\u5f88\u7384\u5b66\uff0c\u4f46\u8dd1\u7684\u5f88\u7a33\u3002\n\n## \u4ee3\u7801\n\u8bb0\u5f97\u7279\u5224$n=1$\uff0c\u8fd8\u6709\u6709\u4e9b\u5730\u65b9\u9700\u8981\u6392\u5e8f\u3002\n```\n#include<stdio.h>\n#include<algorithm>\n#define int long long\nusing namespace std;\nconst int maxn=1000005,maxm=2505,maxk=700;\nint T,n,cnt,m,Ps,Ds,anss;\nint p[maxn],a[maxn],P[maxk],D[maxm],ans[maxn],ord[maxn],nord[maxn],f[maxm][maxk];\nvoid sieve(int n){\n\tfor(int i=2;i<=n;i++){\n\t\tif(p[i]==0)\n\t\t\ta[++cnt]=i;\n\t\tfor(int j=1;j<=cnt;j++){\n\t\t\tif(i*a[j]>n)\n\t\t\t\tbreak;\n\t\t\tp[i*a[j]]=1;\n\t\t\tif(i%a[j]==0)\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\nint check(int x){\n\tif(x<=1000000)\n\t\treturn p[x]==0;\n\tfor(int i=2;i*i<=x;i++)\n\t\tif(x%i==0)\n\t\t\treturn 0;\n\treturn 1;\n}\nvoid dfs(int pos,int val,int now){\n\tif(now==1){\n\t\tans[++anss]=val;\n\t\treturn ;\n\t}\n\tif(now<=m)\n\t\tpos=f[ord[now]][pos];\n\telse pos=f[nord[n/now]][pos];\n\tif(pos==Ps+1)\n\t\treturn ;\n\tdfs(pos+1,val,now);\n\tval*=P[pos],now/=P[pos]-1,dfs(pos+1,val,now);\n\twhile(now%P[pos]==0)\n\t\tval*=P[pos],now/=P[pos],dfs(pos+1,val,now);\n}\nsigned main(){\n\tscanf(\"%lld\",&T),sieve(1000000);\n\twhile(T--){\n\t\tscanf(\"%lld\",&n);\n\t\tif(n==1){\n\t\t\tputs(\"2\\n1 2\");\n\t\t\tcontinue;\n\t\t}\n\t\tfor(m=1;1ll*(m+1)*(m+1)<=n;m++);\n\t\tfor(int i=1;i<=m;i++)\n\t\t\tif(n%i==0){\n\t\t\t\tD[++Ds]=i;\n\t\t\t\tif(check(i+1))\n\t\t\t\t\tP[++Ps]=i+1;\n\t\t\t\tif(1ll*i*i!=n){\n\t\t\t\t\tD[++Ds]=n/i;\n\t\t\t\t\tif(check(n/i+1))\n\t\t\t\t\t\tP[++Ps]=n/i+1;\n\t\t\t\t}\n\t\t\t}\n\t\tsort(P+1,P+1+Ps),sort(D+1,D+1+Ds);\n\t\tfor(int i=1;i<=Ds;i++){\n\t\t\tif(D[i]<=m)\n\t\t\t\tord[D[i]]=i;\n\t\t\telse nord[n/D[i]]=i;\n\t\t\tf[i][Ps+1]=Ps+1;\n\t\t\tfor(int j=Ps;j>=0;j--)\n\t\t\t\tf[i][j]=D[i]%(P[j]-1)==0? j:f[i][j+1];\n\t\t}\n\t\tdfs(1,1,n),sort(ans+1,ans+1+anss);\n\t\tprintf(\"%lld\\n\",anss);\n\t\tfor(int i=1;i<=anss;i++)\n\t\t\tprintf(\"%lld%c\",ans[i],i==anss? '\\n':' ');\n\t\tif(anss==0)\n\t\t\tputs(\"\");\n\t\tfor(int i=1;i<=Ds;i++){\n\t\t\tif(D[i]<=m)\n\t\t\t\tord[D[i]]=0;\n\t\t\telse nord[n/D[i]]=0;\n\t\t}\n\t\tanss=Ds=Ps=0;\n\t}\n\treturn 0;\n}\n```\n\n## \u8bc1\u660e\n\n\u8fd9\u91cc\u6709\u4e00\u4efd\u65f6\u4ee3\u4e45\u8fdc\u7684\u5173\u4e8e\u4e0a\u9762\u5f0f\u5b50\u7684\u8bc1\u660e\uff1a\n\n> \u5f15\u7406\uff1a\u6b27\u62c9\u51fd\u6570\u7684\u79ef\u6027\n\u6784\u9020\u4e00\u4e2a$n\\times m$\uff08$\\gcd(n,m)=1$\uff09\u7684\u77e9\u9635\uff1a\n$$\n\\begin{bmatrix}\n1&2&\\cdots&m\\\\\nm+1&m+2&\\cdots&2m\\\\\n\\vdots&\\vdots&&\\vdots\\\\\n(n-1)m+1&(n-1)m+2&\\cdots&nm\n\\end{bmatrix}\n$$\n\u6613\u77e5\u6bcf\u4e00\u884c\u90fd\u662fm\u7684\u5b8c\u5168\u5269\u4f59\u7cfb\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6240\u6709$a_{i,j}$\uff0c\u90fd\u6709$a_{i,j}\\bmod m=(i-1)*m+j-(i-1)*m=j$\u3002\n\u56e0\u6b64\u6709$\\forall_{1\\leqslant i\\leqslant n}\\left\\{a_{i,1},a_{i,2},\\cdots,a_{i,m}\\right\\}\\in\\left\\{km,km+1,km+2,\\cdots,(k+1)m-1\\right\\}(k\\in\\mathbb{N})$\u3002\n\u4e5f\u5f88\u5bb9\u6613\u8bc1\u660e\u6bcf\u4e00\u5217\u90fd\u662f$n$\u7684\u5b8c\u5168\u5269\u4f59\u7cfb\u3002\n\u53cd\u8bc1\u6cd5\uff1a\u8bbe$(i_1,j)$\u4e0e$(i_2,j)$\u6a21$n$\u540c\u4f59\uff0c\u4e14$i_1\\not=i_2$\uff0c\u90a3\u4e48$(i_1-1)\\times m+j\\equiv (i_2-1)\\times m+j(mod\\ n)$\u3002\n\u4e5f\u5c31\u662f$(i_1-1)\\times m+j=k_1\\times n+r,(i_2-1)\\times m+j=k_2\\times n+r$\u3002\n\u4e24\u5f0f\u76f8\u51cf\u5f97$(i_1-i_2)\\times m=(k_1-k_2)\\times n$\u3002\n\u53c8\u56e0\u4e3a$\\gcd(n,m)=1$\uff0c\u6240\u4ee5$(i_1-i_2)\\mid n$\u90a3\u4e48\u4e0d\u96be\u53d1\u73b0$i_1=i_2$\uff0c\u6240\u4ee5\u6bcf\u4e00\u5217\u90fd\u662f$n$\u7684\u5b8c\u5168\u5269\u4f59\u7cfb\u3002\n\u7531\u6b27\u62c9\u51fd\u6570\u7684\u5b9a\u4e49\u5f97\u77e9\u9635\u5185\u53ef\u4ee5\u627e\u5230$\\varphi(m)$\u5217\uff0c\u5176\u4e2d\u6709$\\varphi(n)$\u4e2a\u5143\u7d20\u540c\u65f6\u4e0em\u548cn\u4e92\u7d20\uff0c\u5373\u5171$\\varphi(m)\\times\\varphi(n)$\u4e2a\u5143\u7d20\u4e0e$m$\u548c$n$\u4e92\u7d20\uff0c\u4e5f\u5c31\u662f\u4e0e$n\\times m$\u4e92\u7d20\u3002\n\n\u7136\u540e\u8bc1\u660e\u6b27\u62c9\u51fd\u6570\u7684\u516c\u5f0f\uff1a\u5bf9\u4e8e$n=\\prod_{i=1}^s p_i^k$\uff0c\u6ee1\u8db3$\\varphi(n)=n\\times\\prod_{i=1}^s\\frac{p_i-1}{p_i}$\u3002\n\n\u9996\u5148\u5f88\u663e\u7136$n$\u4e3a\u8d28\u6570\u7684\u65f6\u5019\uff0c$\\varphi(n)=n\\times\\frac{n-1}{n}$\u3002\n\n\u7136\u540e\u662f$n=p^k$\u65f6\uff08$p$\u4e3a\u8d28\u6570\uff0c$k\\in\\mathbb{N^{+}}$\uff09\uff1a\n\n\u5f88\u5bb9\u6613\u8bc1\u660e$\\forall 1\\leqslant m\\leqslant n$\uff0c$p\\not\\mid m$\u4e0e$\\gcd(m,n)=1$\u7b49\u4ef7\uff0c\u90a3\u4e48\u53ef\u4ee5\u53d1\u73b0\u4e0e$n$\u4e0d\u4e92\u7d20\u7684\u6570\u53ea\u6709$p,2p,\\cdots p^k$\u8fd9$p^{k-1}$\u4e2a\u6570\u3002\n\n\u90a3\u4e48$\\varphi(n)=n-p^{k-1}=p^k\\times\\frac{p-1}{p}=n\\times\\frac{p-1}{p}$\u3002\n\n\u5f53$n$\u4e3a\u4efb\u610f\u6b63\u6574\u6570\u65f6\uff0c\u8bbe$n=\\prod_{i=1}^s p_i^{k_i}$\uff0c\u7531$\\varphi$\u7684\u79ef\u6027\u53ef\u77e5$n=\\prod_{i=1}^s \\varphi(p_i^{k_i})=\\prod_{i=1}^s(p^{k_i}\\times\\frac{p-1}{p})=n\\times\\prod_{i=1}^s\\frac{p_{i-1}}{p_i}$\u3002",
        "postTime": 1616391693,
        "uid": 35754,
        "name": "Verdandi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4930\u3010[PA2013]Euler\u3011"
    }
]