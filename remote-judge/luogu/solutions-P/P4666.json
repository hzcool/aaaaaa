[
    {
        "content": "\u5e73\u8861\u6811\u597d\u9898\uff0c\u8003\u9a8c\u7ec6\u8282\uff08\u6211 `getval` \u51fd\u6570\u6ca1 `push_down` \u8c03\u4e86\u4e24\u4e2a\u5c0f\u65f6\u2026\u2026\uff09\u3002  \n\u672c\u9898\u89e3\u7ed9\u51fa fhq-treap \u7684\u505a\u6cd5\u3002  \nPS\uff1a\u672c\u4eba\u7684 fhq \u5c06\u6743\u503c\u76f8\u540c\u7684\u7ed3\u70b9\u5206\u5f00\u5b58\u50a8\uff0csplit \u65f6 $< key$ \u7684\u4e3a\u5de6\u5b50\u6811\uff0c$\\geqslant key$ \u7684\u4e3a\u53f3\u5b50\u6811\u3002  \n\u6211\u4eec\u4f9d\u6b21\u8003\u8651\u6bcf\u4e2a\u64cd\u4f5c\u5e94\u5f53\u5982\u4f55\u5904\u7406\u3002  \n\u5148\u8003\u8651\u67e5\u8be2\u3002\n\n***\n\n$\\texttt{C}\\ mn\\ mx$\n\n\u8fd9\u4e2a\u76f8\u5bf9\u6bd4\u8f83\u7b80\u5355\uff0c\u5206\u522b\u5c06 $mn$ \u4e0e $mx+1$ \u4f5c\u4e3a $key$ \u5206\u88c2\u5373\u53ef\u3002\n\n***\n\n$\\texttt{F}\\ c\\ h$\n\n\u6211\u4eec\u8003\u8651\u5148\u5c06 $\\geqslant key$ \u7684\u90e8\u5206\u5206\u88c2\u51fa\u6765\u3002  \n\u5bf9\u4e8e\u8fd9\u90e8\u5206\uff0c\u56e0\u4e3a\u4f1a\u6709\u91cd\u590d\u7684\u5143\u7d20\u51fa\u73b0\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u67e5\u8be2\u7b2c $c$ \u5927\u7684\u5143\u7d20\u7136\u540e\u5206\u88c2\uff0c\u5e94\u5f53\u6839\u636e\u6392\u540d\u5206\u88c2\uff08\u518d\u5199\u4e00\u4e2a\u5206\u88c2\u51fd\u6570\uff0c\u6211\u540d\u5b57\u53d6\u4f5c splitt\uff09\u3002\u8bbe\u5206\u88c2\u4ee5\u540e\u5de6\u5b50\u6811\u4e3a $\\text{l}$\uff0c\u53f3\u5b50\u6811\u4e3a $\\text{r}$\u3002  \n\u5982\u679c\u6211\u4eec\u5c06 $\\text{l}$ \u7684 lazytag \u76f4\u63a5\u589e\u52a0\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u65e0\u6cd5\u5c06 $\\text{l}$ \u548c $\\text{r}$ \u5408\u5e76\u8d77\u6765\uff08\u56e0\u4e3a\u8981\u6ee1\u8db3 $\\text{l}$ \u4e2d\u6240\u6709\u5143\u7d20\u90fd $\\leqslant \\text{r}$ \u4e2d\u6240\u6709\u5143\u7d20\uff09\u3002  \n\u8003\u8651\u4eba\u7c7b\u667a\u6167\u3002  \n\u6211\u4eec\u8bbe\u4e4b\u524d\u6839\u636e\u6392\u540d\u5206\u88c2\u65f6\u8be5\u5206\u88c2\u7684\u4f4d\u7f6e\u7684\u5143\u7d20\u503c\u4e3a $val$\u3002  \n\u4e0d\u96be\u53d1\u73b0 $\\text{l}$ \u4e2d\u6700\u5927\u7684\u5143\u7d20\u4e3a $val+1$\uff0c\u800c $\\text{r}$ \u4e2d\u6700\u5c0f\u7684\u5143\u7d20 $\\geqslant val$\u3002  \n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5c06 $\\text{l}$ \u6839\u636e $val+1$ \u5206\u88c2\uff0c\u8bbe\u5206\u88c2\u6210\u4e86 $\\text{ll}$ \u548c $\\text{lr}$\u3002  \n\u5219 $\\text{lr}$ \u4e2d\u7684\u5143\u7d20\u8981\u4e48\u4e3a\u7a7a\uff0c\u8981\u4e48\u90fd\u662f $val+1$ \u3002  \n\u6211\u4eec\u518d\u5c06 $\\text{r}$ \u6839\u636e $val+2$ \u5206\u88c2\uff0c\u8bbe\u5206\u88c2\u6210\u4e86 $\\text{rl}$ \u548c $\\text{rr}$\u3002  \n\u5219 $\\text{rl}$ \u4e2d\u7684\u5143\u7d20 $x$ \u4e00\u5b9a\u6ee1\u8db3 $val \\leqslant x \\leqslant val+1$\u3002\n\u7efc\u5408\u4e00\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 $\\text{ll} \\leqslant \\text{rl} \\leqslant \\text{lr} \\leqslant \\text{rr}$\u3002  \n\u4f9d\u6b21\u5408\u5e76\u5373\u53ef\u3002\uff08\u505a\u5b8c\u4e86\uff09\n\n**code**  \n\n```cpp\n#include <bits/stdc++.h>\n#define fq(i,a,b) for (int i = a; i <= b; i++)\nusing namespace std;\n#define int long long\ninline int rd () {//\u5feb\u8bfb\n\tint f = 1;\n\tchar ch = getchar ();\n\twhile (!isdigit (ch)) {if (ch == '-') f *= -1; ch = getchar ();}\n\tint num = 0;\n\twhile (isdigit (ch)) num = num * 10 + ch - '0', ch = getchar ();\n\treturn num * f;\n}\n#define d rd ()\n\nconst int maxn = 100500;\nstruct node {//fhq\u8282\u70b9\n\tint l, r, key, pri, sz, tag;\n\tnode () {}\n\tnode (int k) {\n\t\tl = r = 0;\n\t\tsz = 1;\n\t\tpri = rand ();\n\t\tkey = k;\n\t\ttag = 0;\n\t}\n} p[maxn]; int cnt;\nint addnode (int key) {p[++cnt] = node (key); return cnt;}\nvoid push_up (int rt) {p[rt].sz = p[p[rt].l].sz + p[p[rt].r].sz + 1;}\nvoid push_down (int rt) {\n\tif (p[rt].l) p[p[rt].l].key += p[rt].tag, p[p[rt].l].tag += p[rt].tag;\n\tif (p[rt].r) p[p[rt].r].key += p[rt].tag, p[p[rt].r].tag += p[rt].tag;\n\tp[rt].tag = 0;\n}\n\npair <int, int> split (int rt, int key) {//\u6309\u6743\u503c\u5206\u88c2\n\tif (!rt) return make_pair (0, 0);\n\tpush_down (rt);\n\tif (key <= p[rt].key) {\n\t\tpair <int, int> q = split (p[rt].l, key);\n\t\tp[rt].l = q.second;\n\t\tpush_up (rt);\n\t\treturn make_pair (q.first, rt);\n\t} else {\n\t\tpair <int, int> q = split (p[rt].r, key);\n\t\tp[rt].r = q.first;\n\t\tpush_up (rt);\n\t\treturn make_pair (rt, q.second);\n\t}\n}\n\npair <int, int> splitt (int rt, int k) {//\u6309\u6392\u540d\u5206\u88c2\n\tpush_down (rt);\n\tif (k <= p[p[rt].l].sz) {\n\t\tpair <int, int> q = splitt (p[rt].l, k);\n\t\tp[rt].l = q.second;\n\t\tpush_up (rt);\n\t\treturn make_pair (q.first, rt);\n\t} else if (k == p[p[rt].l].sz + 1) {\n\t\tint rr = p[rt].r;\n\t\tp[rt].r = 0;\n\t\tpush_up (rt);\n\t\treturn make_pair (rt, rr);\n\t} else {\n\t\tpair <int, int> q = splitt (p[rt].r, k - p[p[rt].l].sz - 1);\n\t\tp[rt].r = q.first;\n\t\tpush_up (rt);\n\t\treturn make_pair (rt, q.second);\n\t}\n}\n\nint merge (int l, int r) {//\u5408\u5e76\n\tif (!l || !r) return l | r;\n\tpush_down (l); push_down (r);\n\tif (p[l].pri < p[r].pri) {\n\t\tp[l].r = merge (p[l].r, r);\n\t\tpush_up (l);\n\t\treturn l;\n\t} else {\n\t\tp[r].l = merge (l, p[r].l);\n\t\tpush_up (r);\n\t\treturn r;\n\t}\n}\n\n\nint getval (int rt, int k) {//\u67e5\u8be2\u6392\u540d\u4e3ak\u7684\u8282\u70b9\u7684\u6743\u503c\n\tpush_down (rt);\n\tif (k <= p[p[rt].l].sz) return getval (p[rt].l, k);\n\tk -= p[p[rt].l].sz + 1;\n\tif (!k) return p[rt].key;\n\treturn getval (p[rt].r, k);\n}\n\nint rt;\nvoid insert (int key) {\n\tpair <int, int> q = split (rt, key);\n\trt = merge (q.first, merge (addnode (key), q.second));\n}\n\nint n;\nsigned main () {\n//\tsrand(time(NULL));\n\tn = d;\n\tint q = d;\n\tfq (i, 1, n) insert (d);\n\twhile (q--) {\n\t\tstring op; cin >> op;\n\t\tif (op[0] == 'F') {\n\t\t\tint c = d, k = d;\n\t\t\tpair <int, int> q = split (rt, k);\n\t\t\tif (!q.second) continue;//\u5982\u679c\u6ca1\u6709\u7b26\u5408\u6761\u4ef6\u7684\u5143\u7d20\u5c31\u8df3\u8fc7\n\t\t\tint vl = getval (q.second, min (p[q.second].sz, c));\n\t\t\t//\u8fdb\u884c\u82e5\u5e72\u6b21\u5206\u88c2\n\t\t\tpair <int, int> r = splitt (q.second, min (p[q.second].sz, c));\n\t\t\tp[r.first].tag++;\n\t\t\tp[r.first].key++;\n\t\t\tpair <int, int> s = split (r.first, vl + 1);\n\t\t\tpair <int, int> t = split (r.second, vl + 2);\n\t\t\t//\u7136\u540e\u5408\u5e76\n\t\t\trt = merge (q.first, merge (s.first, merge (merge (t.first, s.second), t.second)));\n\t\t} else {\n\t\t\tint mn = d, mx = d;\n\t\t\tpair <int, int> q = split (rt, mn);\n\t\t\tpair <int, int> r = split (q.second, mx + 1);\n\t\t\tcout << p[r.first].sz << endl;\n\t\t\trt = merge (q.first, merge (r.first, r.second));\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1651837908,
        "uid": 300313,
        "name": "_luanyi_",
        "ccfLevel": 6,
        "title": "P4666"
    },
    {
        "content": "## Start\n\n[\u6811\u72b6\u6570\u7ec4](https://www.luogu.com.cn/problem/P3368)\n\n\u533a\u95f4\u4fee\u6539\uff0c\u5355\u70b9\u67e5\u8be2\u3002\n\n&nbsp;\n## 1.\u601d\u8def\n\n\u770b\u5230\u5404\u4e2a\u5927\u4f6c\u4eec\u7528\u7684\u90fd\u662f fhq\u3001Splay\u3001\u6743\u503c\u7ebf\u6bb5\u6811\u7b49\u9ad8\u7ea7\u6570\u636e\u7ed3\u6784\uff0c\u6211\u81ea\u6127\u5f17\u5982\u3002\n\n\u4e8e\u662f\u6211\u60f3\u5230\u6211\u53ef\u4ee5\u7528\u7b80\u5355\u57fa\u672c\u7684\u7b97\u6cd5~~\u540a\u6253~~\uff1a\u6811\u72b6\u6570\u7ec4\u3002\n\n\u73b0\u5728\u6240\u6709\u901a\u8fc7\u7684 [\u7a0b\u5e8f](https://www.luogu.com.cn/record/list?pid=P4666&orderBy=1&status=&page=1) \u4e2d\uff0c\u6700\u4f18\u89e3\u901f\u5ea6\u7b2c 4\uff08\u6ca1\u6709\u5f00 O2\uff0c\u5feb\u8bfb\u7b49\u4f18\u5316\uff09\uff0c\u7a7a\u95f4 & \u7801\u91cf\u90fd\u662f\u6700\u5c0f\u7684\u3002\n\n\u6211\u600e\u4e48\u60f3\u5230\u7684\uff1f\n\n\u770b\u5230\u5728\u533a\u95f4 $[\\min,\\max]$ \u91cc\u7684\u503c\uff0c\u5f88\u81ea\u7136\u7684\u60f3\u5230\u524d\u7f00\u548c\uff08\u6811\u72b6\u6570\u7ec4\uff09\uff0c`sum(max) - sum(min - 1)` \u5c31\u53ef\u4ee5 $\\mathcal O(1)$ \u7684\u67e5\u8be2\u3002\n\n\u53e6\u5916\u5bf9\u4e8e\u4fee\u6539\uff0c\u6839\u636e\u6570\u636e\u8303\u56f4\u60f3\u5230 $\\mathcal O(n\\log n)$ \u7684\u4fee\u6539\uff0c\u4e8e\u662f\u5bf9\u4e8e\u524d\u7f00\u548c\u7684 $\\mathcal O(n\\log n)$ \u4fee\u6539\uff0c\u4e00\u773c\u6811\u72b6\u6570\u7ec4\u3002\n\n&nbsp;\n## 2.\u5efa\u6811\n\n\u6839\u636e\u5dee\u5206\uff0c\u6811\u72b6\u6570\u7ec4 $b[i] = a[i] - a[i-1]$\uff0c\u5148\u628a $a[i]$ \u6570\u7ec4\u6392\u5e8f\uff0c\u7136\u540e\u4f9d\u6b21\u5355\u70b9\u4fee\u6539 \uff1a `add(i, a[i] - a[i - 1])`\u3002\u4f46\u662f\u6211\u4eec\u5728\u67e5\u8be2\u4e2d\u5c31\u4f1a\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u6211\u4eec\u65e0\u6cd5\u77e5\u9053 $\\min$ \u548c $\\max$ \u5728 $b$ \u8fd9\u4e2a **\u4e0d\u4e0b\u964d\u6570\u7ec4** \u7684\u4f4d\u7f6e\uff1f\u4e8e\u662f\uff1a\u6211\u4eec\u5199\u4e24\u4e2a\u4e8c\u5206\u51fd\u6570 `left(x)` \u548c `right(x)`\u3002\n\n`left`\uff1a\u67e5\u8be2 `sum(i) >= x` \u65f6 $i$ \u7684\u6700\u5927\u503c\uff0c\u5373\u6700\u540e\u4e00\u4e2a\u524d\u7f00\u548c $\\geqslant x$ \u7684\u4f4d\u7f6e\u3002\n\n`right`\uff1a\u67e5\u8be2 `sum(i) <= x` \u65f6 $i$ \u7684\u6700\u5c0f\u503c\uff0c\u5373\u7b2c\u4e00\u4e2a\u524d\u7f00\u548c $\\leqslant x$ \u7684\u4f4d\u7f6e\u3002\n\n\u8fd9\u4e24\u4e2a\u51fd\u6570\u5728\u4fee\u6539\u4e2d\u5fc5\u4e0d\u53ef\u5c11\u3002  \n\n&nbsp;\n## 3.\u5982\u4f55\u4fee\u6539\n\n\u67e5\u8be2\u5f88\u7b80\u5355\uff0c\u524d\u9762\u8bf4\u4e86\uff0c\u8003\u8651\u5982\u4f55\u4fee\u6539\u3002\n\n\u4fee\u6539\u6700\u91cd\u8981\u7684\u5c31\u662f\u6709\u4e00\u4e9b\u9ad8\u5ea6\u76f8\u540c\u7684\u6811\uff0c\u53ea\u6709 **\u4e00\u90e8\u5206** \u4fee\u6539\uff0c\u53e6\u4e00\u90e8\u5206\u4e0d\u4fee\u6539\uff08\u6837\u4f8b\u7b2c\u4e00\u4e2a\u8f93\u51fa\uff09\uff0c\u5982\u4f55\u5904\u7406\uff1f\n\n\u5047\u8bbe\u4fee\u6539\u64cd\u4f5c\u7684\u4e24\u4e2a\u8f93\u5165\u5206\u522b\u662f $x,y$\uff0c\u90a3\u4e48\u6211\u4eec\u5148\u7b97\u51fa\u627e\u5230\u8981\u4fee\u6539\u7684\u6570\u7684\u503c\u5f97\u533a\u95f4 $[x,s]$\uff0c`s = sum(x + left(y) - 1)`\uff0c\u5f88\u597d\u7406\u89e3\u3002\n\n\u63a5\u4e0b\u6765\u5206\u6210\u4e24\u6bb5\u5904\u7406\uff0c\u4e00\u6bb5\u662f\u503c\u5728 $[x,s-1]$ \u4e2d\u7684\uff0c\u53e6\u4e00\u6bb5\u662f\u503c\u4e3a $s$ \u7684\u3002\u5177\u4f53\u4ee3\u7801\uff1a\n\n```cpp\nint z = left(y), s = sum(x + z - 1), l = left(s), r = right(s);\nadd(z, 1), add(l, -1);\nadd(l + r - x - z + 1, 1), add(r + 1, -1);\n```\n\n&nbsp;\n## End\n\u7279\u5224\uff1a\n1. \u67e5\u8be2\u7684\u8303\u56f4\u5728 $a$ \u4e2d\u6700\u5927\u503c\u4e0e\u6700\u5c0f\u503c\u4e4b\u5916\n2. \u9700\u8981\u4fee\u6539\u7684\u6570\u7684\u6570\u91cf\u5927\u4e8e\u7b26\u5408\u8303\u56f4\u7684\u6570\u7684\u6570\u91cf\n\n[\u4ee3\u7801](https://www.luogu.com.cn/paste/85efkn8x)",
        "postTime": 1651839582,
        "uid": 282929,
        "name": "\u67f3\u6613\u8fb0",
        "ccfLevel": 0,
        "title": "P4666 \u9898\u89e3"
    },
    {
        "content": "[\u70b9\u6b64\u4f7f\u7528\u66f4\u4f73](https://www.lu-anlai.com/oi/solution/balticoi-2011-d1t1/)\u3002\n\n\u4e00\u9053\u7b80\u5355\u7684 Splay \u9898\u76ee\u3002\n\n\u9898\u76ee\u94fe\u63a5\uff1a[Luogu P4666](https://www.luogu.com.cn/problem/P4666)/[LibreOJ 2630](https://loj.ac/problem/2630)/BalticOI 2011 D1T1\u3002\n\n\u5f53\u5e74\u6bd4\u8d5b\u7684\u5b98\u7f51\u94fe\u63a5\uff08\u5df2\u6302\uff09\uff1ahttps://www.boi2011.dk/ \u3002\n\n# \u9898\u76ee\n\n## \u9898\u76ee\u63cf\u8ff0\n\n\u7ed9\u51fa\u4e00\u4e2a\u957f\u5ea6\u4e3a $N$ \u7684\u6570\u7ec4 $a$\uff0c\u6570\u7ec4\u4e2d\u6bcf\u4e2a\u6570\u7684\u53d6\u503c\u8303\u56f4\u5747\u4e3a $[1,N]$\u3002 \u63a5\u4e0b\u6765\u6709 $M$ \u7ec4\u64cd\u4f5c\uff0c\u64cd\u4f5c\u5206\u4e3a\u4e24\u79cd\uff1a\n\n- $\\texttt{F}\\quad\\texttt{c}\\quad\\texttt{h}$\n\n\t\u5c06\u6ee1\u8db3 $a[i]\\geq h$ \u7684\u6240\u6709 $a[i]$ \u4e2d\u6700\u5c0f\u7684 $c$ \u4e2a\u6570\u90fd $+1$\uff1b\n    \n- $\\texttt{C}\\quad\\texttt{max}\\quad\\texttt{min}$\n\n\t\u8f93\u51fa\u6ee1\u8db3 $\\texttt{min}\\leq a[i]\\leq\\texttt{max}$ \u7684\u4e2a\u6570\u3002\n\n## \u6570\u636e\u8303\u56f4\n\n$$1\\leq n,m\\leq 10^5$$\n\n## \u65f6\u7a7a\u9650\u5236\n\n|\u9898\u76ee|\u65f6\u95f4\u9650\u5236|\u7a7a\u95f4\u9650\u5236|\n|:-:|:-:|:-:|\n|[Luogu P4666](https://www.luogu.com.cn/problem/P4666)|$$1\\text{s}$$|$$250\\text{MiB}$$|\n|[LibreOJ 2630](https://loj.ac/problem/2630)|$$1\\text{s}$$|$$256\\text{MiB}$$|\n|BalticOI 2011 D1T1|$$1\\text{s}$$|$$256\\text{MiB}$$|\n\n# \u9898\u89e3\n\n## \u601d\u8def\n\n\u53d1\u73b0\u8fd9\u9053\u9898\u76ee\u8981\u6c42\u6211\u4eec\u7ef4\u62a4\u6570\u5217\uff0c\u4e8e\u662f\u8003\u8651\u4f7f\u7528\u6570\u636e\u7ed3\u6784\u3002\n\n\u9996\u5148\u7528\u6392\u9664\u6cd5\uff1a~~\u66b4\u529b~~\u3001~~\u6811\u72b6\u6570\u7ec4~~\u3001~~\u7ebf\u6bb5\u6811~~\u3001$\\text{Splay}$\u3002\n\n\u6211\u4eec\u53d1\u73b0 $\\text{Splay}$ \u53ef\u4ee5\u89e3\u51b3\u8fd9\u9053\u9898\u76ee\uff0c\u4e0b\u9762\u5c31\u4ecb\u7ecd\u4e00\u4e0b\u5982\u4f55\u7528 $\\text{Splay}$ \u89e3\u51b3\u8fd9\u9053\u9898\u76ee\u3002\n\n### \u64cd\u4f5c\u4e00\n\n$$\\texttt{F}\\quad\\texttt{c}\\quad\\texttt{h}$$\n\n\u5c06\u6ee1\u8db3 $a[i]\\geq h$ \u7684\u6240\u6709 $a[i]$ \u4e2d\u6700\u5c0f\u7684 $c$ \u4e2a\u6570\u90fd $+1$\uff1b\n\n\u8003\u8651\u627e\u5230 $\\text{Splay}$ \u4e2d\u6743\u503c\u4e3a $h$ \u7684\u4f4d\u7f6e\uff0c\u65cb\u8f6c\u5230\u6839\uff0c\u518d\u4ece\u5de6\u5b50\u6811\u4e2d\u627e\u5230\u6392\u540d\u4e3a $c$ \u7684\u4f4d\u7f6e\uff0c\uff08\u5982\u679c\u5de6\u5b50\u6811\u5927\u5c0f\u5c0f\u4e8e $c$ \u5219\u5bf9\u5de6\u5b50\u6811\u5927\u5c0f\u53d6 $\\min$\uff09\u3002\u518d\u4fee\u6539 $\\text{tag}$\u5373\u53ef\u3002\n\n### \u64cd\u4f5c\u4e8c\n\n$$\\texttt{C}\\quad\\texttt{max}\\quad\\texttt{min}$$\n\n\u8f93\u51fa\u6ee1\u8db3 $\\texttt{min}\\leq a[i]\\leq\\texttt{max}$ \u7684\u4e2a\u6570\u3002\n\n\u627e\u5230 $\\texttt{min}$ \u7684\u4f4d\u7f6e\uff0c\u65cb\u8f6c\u5230\u6839\uff0c\u518d\u628a $\\texttt{max}$ \u8f6c\u5230\u6839\u7684\u53f3\u8282\u70b9\uff0c\u7edf\u8ba1\u6839\u8282\u70b9\u7684\u53f3\u8282\u70b9\u7684\u5de6\u5b50\u6811\u5927\u5c0f\u5373\u4e3a\u7b54\u6848\u3002\n\n### \u7ec6\u8282\n\n\u53e6\u5916\uff0c\u6ce8\u610f\u4e00\u4e9b\u7ec6\u8282\uff0c\u8bb0\u5f97\u63d2\u5165\u54e8\u5175\u8282\u70b9\uff08\u6b63\u8d1f\u65e0\u7a77\uff09\uff0c\u540c\u65f6\u8bb0\u5f97\u628a\u4e0d\u5b58\u5728\u7684\u8282\u70b9\u7684\u5185\u90e8\u6700\u5927\u503c\uff08\u67e5\u8be2\u65f6\u7528\uff09\u8bbe\u4e3a $-\\infty$\uff08\u6211\u5c31\u88ab\u8fd9\u91cc\u5361\u4e86\uff09\u3002\n\n## \u4ee3\u7801\n\n$\\text{Splay}$ \u7684\u6e10\u8fd1\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(n\\log_2n)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define reg register\n#define INF 0X3F3F3F3F //\u5b9a\u4e49\u6b63\u65e0\u7a77\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,100000,stdin),p1==p2)?EOF:*p1++)\nstatic char buf[100000],*p1=buf,*p2=buf;\ninline int read(void){ //\u5feb\u8bfb\n\treg bool f=false;\n\treg char ch=getchar();\n\treg int res=0;\n\twhile(ch<'0'||'9'<ch)f|=(ch=='-'),ch=getchar();\n\twhile('0'<=ch&&ch<='9')res=10*res+ch-'0',ch=getchar();\n\treturn f?-res:res;\n}\n\nconst int MAXN=100000+100;\n\ninline void Read(void);\ninline void Work(void);\n\nint main(void){\n\tRead();\n\tWork();\n\treturn 0;\n}\n\nint n,m;\nint a[MAXN];\n\ninline void Read(void){\n\tn=read(),m=read(); // \u8bfb\u5165 n,m\n\tfor(reg int i=1;i<=n;++i)\n\t\ta[i]=read(); //\u8bfb\u5165 a[]\n\treturn;\n}\n\nstruct Splay{ //Splay\n\tint root;\n\tint val[MAXN],Max[MAXN],tag[MAXN];\n\tint fa[MAXN],ch[MAXN][2];\n\tint size[MAXN];\n\tinline bool get(const int& x){\n\t\treturn x==ch[fa[x]][1];\n\t}\n\tinline void pushup(const int& ID){\n\t\tMax[ID]=max(val[ID],max(Max[ch[ID][0]],Max[ch[ID][1]]));\n\t\tsize[ID]=size[ch[ID][0]]+size[ch[ID][1]]+1;\n\t\treturn;\n\t}\n\tinline int Build(const int& father,const int& l,const int& r,reg int a[]){\n\t\tif(l>r)\n\t\t\treturn 0;\n\t\tint mid=(l+r)>>1;\n\t\tval[mid]=Max[mid]=a[mid];\n\t\tfa[mid]=father;\n\t\tsize[mid]=1;\n\t\tch[mid][0]=Build(mid,l,mid-1,a);\n\t\tch[mid][1]=Build(mid,mid+1,r,a);\n\t\tpushup(mid);\n\t\treturn mid;\n\t}\n\tinline void rotate(const int& x){\n\t\tint f=fa[x],ff=fa[f];\n\t\treg bool wh=get(x);\n\t\tif(ff)\n\t\t\tch[ff][get(f)]=x;\n\t\tfa[f]=x;\n\t\tch[f][wh]=ch[x][wh^1];\n\t\tif(ch[f][wh])\n\t\t\tfa[ch[f][wh]]=f;\n\t\tfa[x]=ff;\n\t\tch[x][wh^1]=f;\n\t\tpushup(f);\n\t\tpushup(x);\n\t\treturn;\n\t}\n\tinline void add(const int& ID,const int& Val){\n\t\tval[ID]+=Val,Max[ID]+=Val,tag[ID]+=Val;\n\t\treturn;\n\t}\n\tinline void pushdown(const int& ID){\n\t\tif(tag[ID]){\n\t\t\tif(ch[ID][0])\n\t\t\t\tadd(ch[ID][0],tag[ID]);\n\t\t\tif(ch[ID][1])\n\t\t\t\tadd(ch[ID][1],tag[ID]);\n\t\t\ttag[ID]=0;\n\t\t}\n\t\treturn;\n\t}\n\tinline void push(const int& x){\n\t\tif(fa[x])\n\t\t\tpush(fa[x]);\n\t\tpushdown(x);\n\t\treturn;\n\t}\n\tinline void splay(const int& x,const int& goal){\n\t\tpush(x);\n\t\tfor(int qwq;(qwq=fa[x])!=goal;rotate(x)){\n\t\t\tif(fa[qwq]!=goal){\n\t\t\t\trotate(get(x)==get(qwq)?qwq:x);\n\t\t\t}\n\t\t}\n\t\tif(goal==0)\n\t\t\troot=x;\n\t\treturn;\n\t}\n\tinline int find(const int& x){\n\t\tint now=root,res=0;\n\t\twhile(true){\n\t\t\tpushdown(now);\n\t\t\tif(x<=Max[ch[now][0]])\n\t\t\t    now=ch[now][0];\n\t\t\telse{\n\t\t\t\tres+=size[ch[now][0]];\n\t\t\t\tif(x<=val[now])\n\t\t\t\t\treturn res+1;\n\t\t\t\t++res;\n\t\t\t\tnow=ch[now][1];\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\tinline int kth(reg int x){\n\t\tint now=root;\n\t\twhile(true){\n\t\t\tpushdown(now);\n\t\t\tif(x<=size[ch[now][0]])\n\t\t\t    now=ch[now][0];\n\t\t\telse{\n\t\t\t\tx-=size[ch[now][0]];\n\t\t\t\tif(x==1){\n\t\t\t\t\tsplay(now,0);\n\t\t\t\t\treturn now;\n\t\t\t\t}\n\t\t\t\t--x;\n\t\t\t\tnow=ch[now][1];\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\tinline int split(const int& l,const int& r){ //\u628a l,r \u65cb\u8f6c\u5230\u6839\u3001\u6839\u7684\u53f3\u513f\u5b50\n\t\tint x=kth(l),y=kth(r+2);\n\t\tsplay(x,0),splay(y,x);\n\t\treturn y;\n\t}\n\tinline void F(const int& c,const int& h){ //\u9898\u76ee\u4e2d\u7684\u64cd\u4f5c\u4e00\n\t\tint l=find(h)-1,r=min(n,l+c-1);\n\t\tif(l>n)\n\t\t\treturn;\n\t\tint mid=find(val[kth(r+1)])-1,tr=ch[split(mid,r)][0];\n\t\tfa[tr]=ch[fa[tr]][0]=0;\n\t\t++tag[tr],++val[tr],++Max[tr]; //\u7edf\u8ba1\u4fe1\u606f\n\t\tif(mid>l){\n\t\t\treg int now=ch[split(l,mid-1)][0];\n\t\t\t++tag[now],++val[now],++Max[now];\n\t\t}\n\t\tint p=find(val[tr])-1,u=split(p,p-1);\n\t\tfa[tr]=u,ch[u][0]=tr;\n\t\tsplay(tr,0);\n\t\treturn;\n\t}\n\tinline int C(const int& Max,const int& Min){ //\u64cd\u4f5c\u4e8c\n\t\tint l=find(Max)-1,r=find(Min+1)-2; //\u5148\u65cb\u8f6c\uff0c\u8bb0\u5f97\u4e0d\u8981\u5fd8\u4e86\u54e8\u5175\u8282\u70b9\u5bf9\u7f16\u53f7\u7684\u5f71\u54cd\n\t\treturn size[ch[split(l,r)][0]]; //\u8fd4\u56de\u7b54\u6848\n\t}\n};\n\nSplay S;\n\ninline void Work(void){\n\tS.Max[0]=-INF; //\u6ce8\u610f\u7ec6\u8282\n\ta[n+1]=-INF,a[n+2]=INF; //\u63d2\u5165\u54e8\u5175\u8282\u70b9\n\tsort(a+1,a+n+3); //\u6392\u5e8f\n\tS.root=S.Build(0,1,n+2,a); //\u5efa\u6811\n\twhile(m--){\n\t\tstatic char opt;\n\t\tstatic int c,h,max,min;\n\t\tdo\n\t\t\topt=getchar();\n\t\twhile(opt!='F'&&opt!='C');\n\t\tswitch(opt){\n\t\t\tcase 'F':{\n\t\t\t\tc=read(),h=read();\n\t\t\t\tS.F(c,h);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'C':{\n\t\t\t\tmax=read(),min=read();\n\t\t\t\tprintf(\"%d\\n\",S.C(max,min));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:break;\n\t\t}\n\t}\n\treturn;\n}\n```",
        "postTime": 1584763889,
        "uid": 38502,
        "name": "agicy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4666 \u3010[BalticOI 2011 Day1]Growing Trees\u3011"
    },
    {
        "content": "\n# \u9898\u610f\n\u7ed9\u51fa\u4e00\u4e2a\u957f\u5ea6\u4e3a $N$ \u7684\u6570\u7ec4 $a$\uff0c\u6570\u7ec4\u4e2d\u6bcf\u4e2a\u6570\u7684\u53d6\u503c\u8303\u56f4\u5747\u4e3a $[1,N]$\uff08\u6ca1\u8bf4\u4e92\u4e0d\u76f8\u540c\uff09\u3002\n\u63a5\u4e0b\u6765\u6709 $M$ \u7ec4\u64cd\u4f5c\uff0c\u64cd\u4f5c\u5206\u4e3a\u4e24\u79cd\uff1a\n1. $\\texttt{F}\\:\\:c\\:\\:h$  \n\u5c06\u6ee1\u8db3 $a[i] \\ge h$ \u7684\u6240\u6709 $a[i]$ \u4e2d\u6700\u5c0f\u7684 $c$ \u4e2a\u6570\u90fd $+1$\u3002\n2. $\\texttt{C}\\:\\:\\min\\:\\:\\max$  \n\u8f93\u51fa\u6ee1\u8db3 $\\min \\le a[i] \\le \\max$ \u7684 $a[i]$ \u7684\u4e2a\u6570\u3002\n\n### \u8f93\u5165\u683c\u5f0f\n\n\u7b2c\u4e00\u884c\u6709\u4e24\u4e2a\u6574\u6570 $N$ \u548c $M$\u3002   \n\u7b2c\u4e8c\u884c\u6709 $N$ \u4e2a\u6574\u6570\uff0c\u8868\u793a\u6570\u7ec4 $a$\u3002 \n\u5728\u63a5\u4e0b\u6765\u7684 $M$ \u884c\u4e2d\uff0c\u6bcf\u884c\u6709\u4e00\u7ec4\u64cd\u4f5c\u3002\n\n### \u8f93\u51fa\u683c\u5f0f\n\n\u5bf9\u4e8e\u6bcf\u7ec4 $\\texttt{C}\\:\\:\\min\\:\\:\\max$ \u64cd\u4f5c\u8f93\u51fa\u4e00\u884c\uff0c\u6bcf\u884c\u4e00\u4e2a\u6574\u6570\uff0c\u8868\u793a\u6ee1\u8db3 $\\min \\le a[i] \\le \\max$ \u7684 $a[i]$ \u7684\u4e2a\u6570\u3002\n\n# \u505a\u6cd5\n\n### 1.\u601d\u8def\n\n\u4e0d\u60f3\u5199\u5e73\u8861\u6811\uff1f\u4f60\u53ef\u4ee5\u8bd5\u8bd5\u6811\u72b6\u6570\u7ec4\uff01\u672c\u9898\u4e3a\u4e00\u9053\u6811\u72b6\u6570\u7ec4\u7684\u533a\u95f4\u4fee\u6539\uff0c\u5355\u70b9\u67e5\u8be2\u3002\n\n### 2.\u67e5\u8be2\n\n\u5bf9\u4e8e  $\\texttt{C}$ \u64cd\u4f5c\uff0c\u6211\u4eec\u9700\u8981\u8865\u5145\u4e24\u4e2a\u51fd\u6570\uff1a\n\n1.\u67e5\u8be2 $sum_i$ \uff08\u5373\u7b2c $i$ \u4f4d\u7684\u524d\u7f00\u548c\uff09 $\\ge x$ \u7684\u6700\u5c0f\u503c\u7684\n\u51fd\u6570 $l$\uff0c\u9700\u8981\u7279\u5224 $sum_n<x$ \u7684\u60c5\u51b5\u3002\n\n2.\u67e5\u8be2 $sum_i$ \uff08\u5373\u7b2c $i$ \u4f4d\u7684\u524d\u7f00\u548c\uff09 $\\le x$ \u7684\u6700\u5927\u503c\u7684\n\u51fd\u6570 $r$\uff0c\u9700\u8981\u7279\u5224 $sum_1>x$ \u7684\u60c5\u51b5\u3002\n\n\u4e3a\u4e86\u8282\u7701\u65f6\u95f4\uff0c\u6211\u4eec\u8003\u8651\u4e8c\u5206\uff0c\u56e0\u6b64\u9700\u8981\u5c06\u521d\u59cb\u6570\u7ec4\u8fdb\u884c\u6392\u5e8f\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u53ea\u9700\u8981\u67e5\u8be2 $\\max(0,r_{y}-l_x+1)$ \u5c31\u597d\u4e86\uff08\u5927\u4e8e\u7b49\u4e8e $\\min$ \u4e14\u5c0f\u4e8e\u7b49\u4e8e $\\max$ \u7684\u4e2a\u6570\uff09 \u3002\n\n### 3.\u4fee\u6539\n\n\u5bf9\u4e8e $\\texttt{F}$ \u64cd\u4f5c\uff0c\u9700\u8981\u5148\u6c42\u51fa\u4fee\u6539\u7684\u503c\u57df $(y,aim)$\uff0c$aim=c+l_y-1$\uff0c\u5373\u4fee\u6539\u5bf9\u8c61\u3002\n\n\u7136\u540e\u5206\u4e24\u6bb5\u4fee\u6539\uff1a\n\n1.\u4fee\u6539\u5c0f\u4e8e $aim$ \u7684\u90e8\u5206\u3002\n```cpp\nint tmp=_l(y);\nint l=_l(aim);\nadd(tmp,1);\nadd(l,-1);\n```\n2.\u4fee\u6539\u7b49\u4e8e $aim$ \u7684\u90e8\u5206\u3002\n\n```cpp\nint l=_l(aim);\nint tmp=_l(y);\nint r=_r(aim);\nadd(l+r-tmp-x+1,1);\nadd(r+1,-1);\n```\n$x$,$y$ \u4e3a\u8f93\u5165\u6570\u636e\uff0c\u5206\u522b\u5bf9\u5e94 $c$, $h$\u3002\n\n\u9700\u8981\u7279\u5224 $x+tmp>n$ \u7684\u60c5\u51b5\uff0c\u6b64\u65f6\u4fee\u6539 $add(tmp,1)$ \u5373\u53ef\u3002\n\n# \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m,va[100005],a[100005];\nint lowbit(int x)\n{\n\treturn x&(-x);\n}\nvoid add(int now,int add)\n{\n\twhile(now<=n)\n\t{\n\t\ta[now]+=add;\n\t\tnow+=lowbit(now);\n\t}\n}\nint sum(int now)\n{\n\tint summ=0;\n\twhile(now)\n\t{\n\t\tsumm+=a[now];\n\t\tnow-=lowbit(now);\n\t}\n\treturn summ;\n}\nint _l(int x)\n{\n\tif(sum(n)<x) return n+1;\n\tint l=1,r=n,mid,ans;\n\twhile(l<=r)\n\t{\n\t\tmid=(l+r)/2;\n\t\tif(sum(mid)>=x)\n\t\t{\n\t\t\tans=mid;\n\t\t\tr=mid-1;\n\t\t}\n\t\telse l=mid+1;\n\t}\n\treturn ans;\n}\nint _r(int x)\n{\n\tif(sum(1)>x) return 0;\n\tint l=1,r=n,mid,ans;\n\twhile(l<=r)\n\t{\n\t\tmid=(l+r)/2;\n\t\tif(sum(mid)<=x)\n\t\t{\n\t\t\tans=mid;\n\t\t\tl=mid+1;\n\t\t}\n\t\telse r=mid-1;\n\t}\n\treturn ans;\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&va[i]);\n\tsort(va+1,va+n+1);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tadd(i,va[i]-va[i-1]);\n\t}\n\twhile(m--)\n\t{\n\t\tchar op;\n\t\tint x,y;\n\t\t//scanf(\"%c%d%d\",&op,&x,&y);\n\t\tcin>>op>>x>>y;\n\t\tif(op=='C')\n\t\t{\n\t\t\tprintf(\"%d\\n\",max(0,_r(y)-_l(x)+1));\n\t\t}\n\t\telse{\n\t\t\tint tmp=_l(y);\n\t\t\tif(x+tmp>n) add(tmp,1);\n\t\t\telse{\n\t\t\t\tint aim=sum(x+tmp-1);\n\t\t\t\tint l=_l(aim);\n\t\t\t\tint r=_r(aim);\n\t\t\t\tadd(tmp,1);\n\t\t\t\tadd(l,-1);\n\t\t\t\tadd(l+r-tmp-x+1,1);\n\t\t\t\tadd(r+1,-1);\n\t\t\t}\n\t\t}\n\t}\n} \n```\n",
        "postTime": 1675476529,
        "uid": 752706,
        "name": "hyfzelda",
        "ccfLevel": 4,
        "title": "P4666 \u9898\u89e3"
    },
    {
        "content": "### Solutions\n\n\u8fd9\u9898\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u6216\u8005\u5e73\u8861\u6811\u6765\u505a\uff0c\u5728\u8fd9\u7bc7\u9898\u89e3\u4e2d\u5c06\u4f7f\u7528 fhq_treap \u6765\u5b9e\u73b0\u3002\n\n\u5bf9\u4e8e\u64cd\u4f5c\u4e00\uff1a\n\n\u8bbe $v$ \u4e3a\u5927\u4e8e\u7b49\u4e8e $h$ \u7684\u6570\u4e2d\u7b2c $c$ \u5c0f\u7684\u6570\uff0c\u6211\u4eec\u76f4\u63a5\u5220\u6389 $v$\uff0c\u7136\u540e\u5728\u6811\u4e2d\u63d2\u5165 $v+1$\u3002\u7136\u540e\u5bf9\u4e8e\u5927\u4e8e\u7b49\u4e8e $h$ \u5e76\u4e14\u5c0f\u4e8e $v$ \u7684\u6570\uff0c\u6211\u4eec\u5c06\u5176\u76f4\u63a5\u52a0\u4e0a $1$ \u5373\u53ef\u3002\u8fd9\u4e00\u90e8\u5206\u6574\u4f53\u52a0\u4e0a $1$ \u540e\uff0c\u5b83\u4eec\u7684\u76f8\u5bf9\u5927\u5c0f\u5e76\u4e0d\u6539\u53d8\uff0c\u6240\u4ee5\u8fd9\u5e76\u4e0d\u7834\u574f\u5e73\u8861\u6811\u7684\u7ed3\u6784\uff0c\u56e0\u6b64\u76f4\u63a5\u52a0 $1$ \u662f\u6ca1\u95ee\u9898\u7684\u3002\n\n\u5bf9\u4e8e\u64cd\u4f5c\u4e8c\uff1a\n\n\u6309\u503c\u5206\u88c2\uff0c\u5c06\u6240\u6709\u5927\u4e8e\u7b49\u4e8e $\\min$ \u5e76\u4e14\u5c0f\u4e8e\u7b49\u4e8e $\\max$ \u7684\u6570\u5206\u88c2\u6210\u4e00\u68f5\u5b50\u6811\uff0c\u7136\u540e\u76f4\u63a5\u8f93\u51fa\u5b50\u6811\u7684\u5927\u5c0f\u5373\u53ef\u3002\n\n### code\n\n```cpp\n#include<bits/stdc++.h>\n#define endl '\\n'\nusing namespace std;\nconst int N=1e5+5;\nstruct fhq_treap{\n\tint ls,rs,sz,val,rd,w,tag;\n}tr[N<<2];\nint n,m,rt,idx;\nint New(int v,int len){\n\ttr[++idx]=((fhq_treap){0,0,len,v,rand(),len,0});\n\treturn idx;\n}\nvoid push_up(int k){\n\ttr[k].sz=tr[tr[k].ls].sz+tr[tr[k].rs].sz+tr[k].w;\n}\nvoid add(int k,int v){\n\ttr[k].val+=v;\n\ttr[k].tag+=v;\n}\nvoid push_down(int k){\n\tif(!tr[k].tag) return;\n\tif(tr[k].ls) add(tr[k].ls,tr[k].tag);\n\tif(tr[k].rs) add(tr[k].rs,tr[k].tag);\n\ttr[k].tag=0;\n}\nvoid split(int k,int v,int &lrt,int &rrt){\n\tif(!k){\n\t\tlrt=rrt=0;\n\t\treturn;\n\t}\n\tpush_down(k);\n\tif(tr[k].val<=v){\n\t\tlrt=k;\n\t\tsplit(tr[k].rs,v,tr[k].rs,rrt);\n\t}else{\n\t\trrt=k;\n\t\tsplit(tr[k].ls,v,lrt,tr[k].ls);\n\t}\n\tpush_up(k);\n}\nint merge(int x,int y){\n\tif(x) push_down(x);\n\tif(y) push_down(y);\n\tif(!x || !y) return x|y;\n\tif(tr[x].rd>tr[y].rd){\n\t\ttr[x].rs=merge(tr[x].rs,y);\n\t\tpush_up(x);\n\t\treturn x;\n\t}else{\n\t\ttr[y].ls=merge(x,tr[y].ls);\n\t\tpush_up(y);\n\t\treturn y;\n\t}\n}\nvoid Insert(int v,int len){\n\tint r1,r2,r3;\n\tsplit(rt,v,r1,r2);\n\tsplit(r1,v-1,r1,r3);\n\tif(!r3) rt=merge(merge(r1,New(v,len)),r2);\n\telse{\n\t\ttr[r3].w+=len,tr[r3].sz+=len;\n\t\trt=merge(merge(r1,r3),r2);\n\t}\n}\nvoid Delete(int v,int len){\n\tint r1,r2,r3;\n\tsplit(rt,v,r1,r2);\n\tsplit(r1,v-1,r1,r3);\n\ttr[r3].sz-=len,tr[r3].w-=len;\n\tif(!tr[r3].w) r3=merge(tr[r3].ls,tr[r3].rs);\n\trt=merge(merge(r1,r3),r2);\n}\nint Num(int k,int v){\n\twhile(k){\n\t\tpush_down(k);\n\t\tif(tr[tr[k].ls].sz+tr[k].w<v){\n\t\t\tv-=tr[tr[k].ls].sz+tr[k].w;\n\t\t\tk=tr[k].rs;\n\t\t}else if(tr[tr[k].ls].sz>=v) k=tr[k].ls;\n\t\telse break;\n\t}\n\treturn tr[k].val;\n}\nint C(int mn,int mx){\n\tint r1,r2,r3;\n\tsplit(rt,mx,r1,r2);\n\tsplit(r1,mn-1,r1,r3);\n\tcout<<tr[r3].sz<<endl;\n\trt=merge(merge(r1,r3),r2);\n}\nvoid F(int c,int h){\n\t int r1,r2,r3;\n\t split(rt,h-1,r1,r2);\n\t c=min(c,tr[r2].sz);\n\t int v=Num(r2,c),r4;\n\t split(r2,v-2,r3,r2);\n\t split(r2,v-1,r4,r2);\n\t int siz=tr[r4].sz;\n\t r2=merge(r4,r2);\n\t rt=merge(r1,merge(r3,r2));\n\t c-=siz;\n\t Delete(v-1,siz);\n\t Insert(v,siz);\n\t split(rt,h-1,r1,r2);\n\t c=min(c,tr[r2].sz);\n\t split(r2,v-2,r3,r2);\n\t c-=tr[r3].sz;\n\t if(r3) add(r3,1);\n\t rt=merge(r1,merge(r3,r2));\n\t if(!c) return;\n\t Delete(v,c);\n\t Insert(v+1,c);\n}\nsigned main(){\n\tios::sync_with_stdio(false);\n\tcin.tie(0),cout.tie(0);\n\tsrand(time(0));\n\tcin>>n>>m;\n\tfor(int i=1,x;i<=n;++i){\n\t\tcin>>x;\n\t\tInsert(x,1);\n\t}\n\tfor(int i=1,c,h;i<=m;++i){\n\t\tchar op[5];\n\t\tcin>>op+1>>c>>h;\n\t\tif(op[1]=='F') F(c,h);\n\t\telse if(op[1]=='C') C(c,h);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1682314314,
        "uid": 491321,
        "name": "Erotate",
        "ccfLevel": 0,
        "title": "[BalticOI 2011 Day1]Growing Trees \u9898\u89e3"
    },
    {
        "content": "\u9ebb\u4e86\uff0c\u5c11\u5199\u4e2a\u6807\u8bb0\u4e0b\u4f20\u8c03\u4e86\u5c06\u8fd1\u4e00\u6574\u5929\u3002\n\n\u653e\u4e00\u624b [$Link$](https://www.luogu.com.cn/problem/P4666)\u3002\n\n## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u96c6\u5408\uff0c$m$ \u6b21\u64cd\u4f5c\u3002\n\n- \u5c06 $\\geq h$ \u7684\u6700\u5c0f\u7684 $c$ \u4e2a\u6570\u7684\u503c $+1$\u3002\n\n- \u67e5\u8be2\u6743\u503c\u5728 $[min,max]$ \u533a\u95f4\u7684\u6570\u7684\u4e2a\u6570\u3002\n\n\n$1\\leq n,m \\leq 10^5,c\\leq n$\uff0c\u503c\u57df $10^9$\u3002\n\n## \u9898\u76ee\u5206\u6790\n\n\u8fd9\u9053\u9898\u7684\u7b97\u6cd5\u6807\u7b7e\u8fd8\u662f\u633a\u597d\u731c\u7684\uff0c\u770b\u5230\u50cf\u8fd9\u79cd\u7ef4\u62a4\u533a\u95f4\u503c\u57df\uff0c\u533a\u95f4\u6253\u6807\u8bb0\u7684\uff0c\u591a\u534a\u662f\u503c\u57df\u7ebf\u6bb5\u6811\u6216\u8005\u5e73\u8861\u6811\uff0c\u6211\u89c9\u5f97\u5e73\u8861\u6811\u5b9e\u73b0\u66f4\u4e3a\u597d\u5199\uff0c\u4e8e\u662f\u7528\u7684 FHQ\u3002\n\n\u8bf4\u5b9e\u8bdd\uff0c\u6211\u4e0d\u6e05\u695a\u7ebf\u6bb5\u6811\u6807\u7b7e\u662f\u54ea\u6765\u7684\uff0c\u6743\u503c\u7ebf\u6bb5\u6811\u5b9e\u73b0\u5e73\u8861\u6811\u7684\u64cd\u4f5c\uff1f\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\uff0c\u82e5\u80fd\u591f\u7ef4\u62a4\u597d\u503c\u57df\uff0c\u90a3\u4e48\u76f4\u63a5\u5728\u5e73\u8861\u6811\u4e0a\u5c06 \u67e5\u8be2\u7684\u533a\u95f4\u5206\u88c2\u51fa\u6765\u7edf\u8ba1\u5927\u5c0f\u5373\u53ef\u3002\n\n\u6240\u4ee5\u73b0\u5728\u7684\u95ee\u9898\u5c31\u53d8\u6210\u4e86\uff0c\u600e\u6837\u7ef4\u62a4\u4e00\u4e2a\u533a\u95f4\u4fee\u6539\u7684\u5e73\u8861\u6811\u7684\u6743\u503c\u3002\n\n\u8fd9\u5c31\u6709\u4e00\u4e2a\u6709\u7528\u7684\u5c0f\u6280\u5de7\uff0c\u6211\u4eec\u8003\u8651\u5c06\u4e00\u4e2a\u503c\u57df\u533a\u95f4 $[l,r]$ \u6574\u4f53\u52a0\u4f1a\u600e\u6837\uff1f\n\n\u5e73\u8861\u6811\u4e0a\u5bf9\u5e94\u7684 $[l,r-1]$ \u4f1a\u6574\u4f53\u53d8\u6210 $[l+1,r]$\uff0c\u5176\u76f8\u5bf9\u7684\u5927\u5c0f\u5173\u7cfb\u5e76\u6ca1\u6709\u53d1\u751f\u53d8\u5316\uff0c\u6211\u4eec\u77e5\u9053\u5e73\u8861\u6811\u662f\u5229\u7528\u76f8\u5bf9\u5927\u5c0f\u5173\u7cfb\u7ef4\u62a4\u5de6\u53f3\u513f\u5b50\u7684\uff0c\u6240\u4ee5\u6b64\u65f6\u8fd9\u90e8\u5206\u7684\u5e73\u8861\u6811\u7ed3\u6784\u5e76\u672a\u53d1\u751f\u53d8\u5316\uff0c\u76f4\u63a5\u6253\u4e0a\u6807\u8bb0\u5373\u53ef\u3002\u53ea\u6709 $r$ \u8fd9\u4e00\u90e8\u5206\uff0c\u589e\u52a0\u540e\u4f1a\u4e0e\u539f\u672c\u7684 $r+1$ \u5bf9\u5e94\u7684\u8282\u70b9\u4ea7\u751f\u51b2\u7a81\uff0c\u600e\u4e48\u529e\u5462\uff1f\u6211\u4eec\u76f4\u63a5\u5220\u9664\u6389\u5f53\u524d\u7684 $r$ \u8282\u70b9\uff0c\u7136\u540e\u5c06\u8d21\u732e\u7d2f\u52a0\u5230 $r+1$ \u8fd9\u4e2a\u8282\u70b9\u4e0a\u5373\u53ef\u3002\n\n\u600e\u4e48\u7d2f\u52a0\u5462\uff1f\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\u591a\u7ef4\u62a4\u4e00\u4e2a\u503c $len$\uff0c\u8868\u793a\u8fd9\u4e2a\u5e73\u8861\u6811\u8282\u70b9\u5bf9\u5e94\u7684\u6743\u503c\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u6ce8\u610f\u8fd9\u4e2a\u4e0d\u80fd\u7528\u539f\u672c\u7684 $siz$ \u6765\u8868\u793a\uff0c\u4e0d\u7136\u7684\u8bdd\u4f1a\u5bfc\u81f4 $siz$ \u7684\u66f4\u65b0\u51fa\u95ee\u9898\u3002\n\n\u653e\u4e00\u4e0b\u8fd9\u4e2a\u6280\u5de7\u7684\u7684\u7c7b\u4f3c\u7528\u6cd5\uff0c\u601d\u60f3\u8fd8\u662f\u57fa\u672c\u4e00\u81f4\u7684 [$Link$](https://www.luogu.com.cn/problem/CF702F)\uff0c\u5982\u679c\u8fd9\u9053\u9898\u505a\u4e0d\u660e\u767d\uff0c\u6211\u63a8\u9500\u4e00\u4e0b\u6211\u7684 [\u535a\u5ba2](https://www.luogu.com.cn/blog/yizhiming/shuo-ju-jie-gou-di-shi-yong)\uff0c\u56e0\u4e3a\u662f\u505a\u9898\u8bb0\u5f55\uff0c\u5efa\u8bae\u76f4\u63a5\u5168\u5c40\u67e5\u627e\u8fd9\u9053\u9898\u3002\n\n\u56de\u5230\u73b0\u5728\u8fd9\u9053\u9898\uff0c\u6211\u4eec\u53d1\u73b0\u4fee\u6539\u64cd\u4f5c\u8981\u67e5\u627e\u524d $c$ \u5c0f\u7684\u6570\uff0c\u96be\u9053\u8fd8\u8981\u518d\u5199\u4e00\u4efd\u6309\u533a\u95f4\u5927\u5c0f\u5206\u88c2\u7684\u5e73\u8861\u6811\u5417\uff1f\n\n\u5f53\u7136\u4e0d\uff0c\u6211\u4eec\u8fd8\u662f\u521a\u624d\u90a3\u79cd\u60f3\u6cd5\uff0c\u6211\u4eec\u8bbe\u6700\u5927\u7684\u80fd\u88ab\u4fee\u6539\u7684\u6743\u503c\u4e3a $val$\uff0c\u90a3\u4e48\u6b64\u65f6 $val$ \u7684\u5904\u5883\u5c31\u548c\u4e4b\u524d $r$ \u4e00\u6837\u4e86\uff0c\u628a\u8fd9\u4e2a\u8282\u70b9\u66b4\u529b\u4fee\u6539\u6389\uff0c\u7136\u540e\u8d21\u732e\u7d2f\u52a0\u5373\u53ef\u3002\u90a3\u4e48 $val$ \u7684\u503c\u662f\u4ec0\u4e48\u5462\uff1f\u663e\u7136\u662f $\\geq h$ \u7684\u6570\u4e2d\u7b2c $c$ \u5c0f\u7684\u6570\uff0c\u76f4\u63a5\u5728\u5e73\u8861\u6811\u4e0a\u67e5\u8be2\u7b2c $c$ \u5c0f\u5373\u53ef\u3002\n\n\u4f46\u662f\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u6743\u503c\u4e3a $val$ \u7684\u8282\u70b9\u4e0d\u4e00\u5b9a\u5220\u5e72\u51c0\uff0c\u6240\u4ee5 $val-1$ \u5728\u589e\u52a0\u7684\u65f6\u5019\u4e5f\u4f1a\u7834\u574f\u7a7a\u95f4\u7ed3\u6784\uff0c$val-1$ \u4e5f\u8981\u7279\u6b8a\u5904\u7406\u3002\n\n\u5230\u8fd9\u91cc\u5c31\u5df2\u7ecf\u5b8c\u5168\u89e3\u51b3\u4e86\uff0c\u6bcf\u6b21\u4fee\u6539\u6700\u591a\u53ea\u6709\u56db\u6b21\u63d2\u5165/\u5220\u9664\u64cd\u4f5c\uff0c\u5355\u6b21 $\\log n$ \u590d\u6742\u5ea6\u6b63\u786e\u3002\n\n## Code\n\n\u8fd9\u73a9\u610f\u7684\u7ec6\u8282\u7279\u522b\u591a\uff0c\u6ce8\u610f\u5728\u5408\u5e76\u3001\u5206\u88c2\u4ee5\u53ca\u67e5\u8be2\u7b2c $k$ \u5927\u7684\u65f6\u5019\u90fd\u8981\u4e0b\u4f20\u6807\u8bb0\uff0c\u4e0d\u7136\u4f60\u53ef\u80fd\u50cf\u67d0\u4e2a\u849f\u84bb\u4e00\u6837\u8c03\u4e00\u6574\u5929\u3002\n\n\u67e5\u8be2\u7b2c $k$ \u5927\u7684\u65f6\u5019\u56e0\u4e3a\u5355\u70b9\u7684\u51fa\u73b0\u6b21\u6570\u4e0d\u4e3a $1$\uff0c\u6240\u4ee5\u8981\u9b54\u6539\u67e5\u8be2\uff0c\u5177\u4f53\u5c31\u662f $siz_{ls}<rank\\leq siz_{ls}+len_{u}$ \u5219\u8bf4\u660e $u$ \u8fd9\u4e2a\u8282\u70b9\u5b58\u7684\u503c\u662f\u7b54\u6848\u3002\n\n\u5220\u9664\u7684\u65f6\u5019\uff0c\u82e5\u5df2\u7ecf\u5c06\u5f53\u524d\u8282\u70b9\u7684\u51fa\u73b0\u6b21\u6570\u5220\u6210 $0$ \u4e86\uff0c\u5219\u5c06\u5176\u771f\u6b63\u5220\u9664\uff0c\u5426\u5219\u53ea\u4fee\u6539\u5f53\u524d\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u63d2\u5165\u540c\u7406\u3002\n\n\u63d2\u5165\u5220\u9664\u90fd\u8981\u9b54\u6539\u6210\u4fee\u6539 $k$ \u4e2a\u76f8\u540c\u7684\u6570\u7684\u5f62\u5f0f\u3002\n\n\u4fee\u6539\u5355\u4e2a\u8282\u70b9\u7684\u51fa\u73b0\u6b21\u6570\u65f6\u8bb0\u5f97\u5c06 $siz$ \u548c $len$ \u7684\u503c\u90fd\u8fdb\u884c\u66f4\u6539\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <cmath>\n#include <algorithm>\n#include <queue>\nusing namespace std;\nint read(){\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\treturn x*f;\n}\nconst int N = 1e5+5; \nstruct aa{\n\tint lc,rc,siz,val,tag,rnd,len;\n}node[N*4];\nvoid lazy_tag(int u,int k){\n\tif(!u){\n\t\treturn;\n\t}\n\tnode[u].val+=k;\n\tnode[u].tag+=k;\n}\nvoid pushdown(int u){\n\tif(!node[u].tag){\n\t\treturn;\n\t}\n\tlazy_tag(node[u].lc,node[u].tag);\n\tlazy_tag(node[u].rc,node[u].tag);\n\tnode[u].tag = 0;\n}\nvoid pushup(int u){\n\tnode[u].siz = node[node[u].lc].siz+node[node[u].rc].siz+node[u].len;\n} \nint rt,tot;\nint newnode(int val,int k){\n\tnode[++tot].val = val;\n\tnode[tot].rnd = rand();\n\tnode[tot].siz = k;\n\tnode[tot].len = k;\n\treturn tot;\n}\nvoid split(int u,int val,int &x,int &y){\n\tif(!u){\n\t\tx = 0;y = 0;\n\t\treturn;\n\t}\n\tpushdown(u);\n\tif(node[u].val<=val){\n\t\tx = u;\n\t\tsplit(node[u].rc,val,node[u].rc,y);\n\t}else{\n\t\ty = u;\n\t\tsplit(node[u].lc,val,x,node[u].lc);\n\t}\n\tpushup(u);\n}\nint merge(int u,int v){\n\tif(!u||!v){\n\t\treturn u+v;\n\t}\n\tpushdown(u);pushdown(v);\n\tif(node[u].rnd>node[v].rnd){\n\t\tnode[u].rc = merge(node[u].rc,v);\n\t\tpushup(u);\n\t\treturn u;\n\t}else{\n\t\tnode[v].lc = merge(u,node[v].lc);\n\t\tpushup(v);\n\t\treturn v;\n\t}\n}\nint x,y,z;\nvoid ins(int val,int k){\n\tsplit(rt,val,x,y);\n\tsplit(x,val-1,x,z);\n\tif(!z){\n\t\trt = merge(merge(x,newnode(val,k)),y);\n\t}else{\n\t\tnode[z].siz+=k;\n\t\tnode[z].len+=k;\n\t\trt = merge(merge(x,z),y);\n\t}\n}\nvoid del(int val,int k){\n\tsplit(rt,val,x,y);\n\tsplit(x,val-1,x,z);\n\tnode[z].siz-=k;\n\tnode[z].len-=k;\n\tif(!node[z].len){\n\t\tz = merge(node[z].lc,node[z].rc);\n\t}\n\trt = merge(merge(x,z),y);\n}\nint query(int l,int r){\n\tsplit(rt,r,x,y);\n\tsplit(x,l-1,x,z);\n\tint ans = node[z].siz;\n\trt = merge(merge(x,z),y);\n\treturn ans;\n}\n\nint getnum(int rank,int now){\n\twhile(now){\n\t\tpushdown(now);\n\t\tif(node[node[now].lc].siz<rank&&rank<=node[now].len+node[node[now].lc].siz){\n\t\t\tbreak;\n\t\t}else if(node[node[now].lc].siz>=rank){\n\t\t\tnow = node[now].lc;\n\t\t}else{\n\t\t\trank-=node[node[now].lc].siz+node[now].len;\n\t\t\tnow = node[now].rc;\n\t\t}\n\t}\n\treturn node[now].val;\n}\nint xx;\nvoid upd(int c,int h){\n\tsplit(rt,h-1,x,y);\n\tc = min(c,node[y].siz);\n\tint val = getnum(c,y);\n\tsplit(y,val-2,z,y);\n\tsplit(y,val-1,xx,y);\n\tint sum = node[xx].siz;\n\ty = merge(xx,y);\n\trt = merge(x,merge(z,y));\n\tc-=sum;\n\tdel(val-1,sum);\n\tins(val,sum);\n\tsplit(rt,h-1,x,y);\n\tc = min(c,node[y].siz);\n\tsplit(y,val-2,z,y);\n\tc-=node[z].siz;\n\tlazy_tag(z,1);\n\trt = merge(x,merge(z,y));\n\tif(!c){\n\t\treturn;\n\t}\n\tdel(val,c);\n\tins(val+1,c);\n}\nchar s[5];\nint main(){\n\tint n,m,l,r;\n\tn = read();m = read();\n\tfor(int i=1;i<=n;i++){\n\t\tl = read();\n\t\tins(l,1);\n\t}\n\twhile(m--){\n\t\tscanf(\"%s\",s);\n\t\tif(s[0]=='F'){\n\t\t\tl = read();r = read();\n\t\t\tupd(l,r);\n\t\t}else{\n\t\t\tl = read();r = read();\n\t\t\tcout<<query(l,r)<<'\\n';\n\t\t}\n\t}\n\treturn 0;\n}\n```\n\n\u7a81\u7136\u53d1\u73b0\u81ea\u5df1\u662f\u4ee3\u7801\u957f\u5ea6\u548c\u9898\u89e3\u957f\u5ea6\u90fd\u6700\u957f\u7684\u4e00\u7bc7\u3002",
        "postTime": 1673312300,
        "uid": 369399,
        "name": "yizhiming",
        "ccfLevel": 0,
        "title": "\u9898\u89e3\u3010P4666 [BalticOI 2011 Day1]Growing Trees\u3011"
    },
    {
        "content": "\u4e00\u79cd\u7ebf\u6bb5\u6811\u7684\u89e3\u6cd5\uff0c\u6548\u7387\u76f8\u6bd4\u5e73\u8861\u6811\u7a0d\u597d\uff0c\u5b9e\u73b0\u4e5f\u66f4\u4e3a\u65b9\u4fbf\u3002\n\n\u9996\u5148\u8003\u8651\u5230\u6bcf\u6b21\u64cd\u4f5c\u90fd\u662f\u57fa\u4e8e\u503c\u57df\uff0c\u8003\u8651\u5f00\u4e00\u9897\u503c\u57df\u7ebf\u6bb5\u6811\uff0c\u4f46\u662f\u503c\u4f1a\u6709\u53d8\u5316\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65b9\u6cd5\u884c\u4e0d\u901a\uff0c\u8003\u8651\u5230\u6bcf\u6b21\u90fd\u662f\u5bf9\u5168\u5c40\u8fdb\u884c\u4fee\u6539\u67e5\u8be2\uff0c\u6240\u4ee5\u8003\u8651\u7528\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u4e00\u4e2a\u9012\u589e\u7684\u5e8f\u5217\uff0c\u8fd9\u6837\u5c31\u53ef\u901a\u8fc7\u4e8c\u5206\u6765\u89e3\u51b3\u67e5\u8be2\uff0c\u4f46\u662f\u5982\u4f55\u89e3\u51b3\u4fee\u6539\u5462\uff1f\n\n\u8003\u8651\u64cd\u4f5c\u7684\u7279\u6027\uff0c\u53d1\u73b0\u6bcf\u6b21\u90fd\u53ea\u4f1a\u589e\u52a0 $1$ \u3002\u90a3\u4e48\u6700\u5c0f\u7684 $x$ \u6ee1\u8db3 $a_x \\ge h$ \u7684 $x$ \u662f\u53ef\u4ee5\u4e8c\u5206\u627e\u5230\u7684\uff0c\u7136\u540e\u6240\u6709\u5c0f\u4e8e $a_{x+c-1}$ \u7684\u6570\u90fd\u53ef\u4ee5\u76f4\u63a5\u52a0\uff0c\u7136\u540e\u5c31\u662f\u6240\u6709\u7b49\u4e8e $a_{x+c-1}$ \u7684\u6570\u6392\u5728\u540e\u9762\u7684\u4e00\u4e9b\u6570\u52a0\uff0c\u4e00\u5171\u52a0 $k$ \u4e2a\u6570\u5373\u53ef\uff0c\u8fd9\u6837\u5c31\u7ef4\u62a4\u4e86\u4e00\u4e2a\u6709\u5e8f\u5e8f\u5217\u3002\u53ea\u9700\u8981\u7ebf\u6bb5\u6811\u4e8c\u5206\u5373\u53ef\u3002\u590d\u6742\u5ea6 $O(n \\log{n})$ \u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define N 100005\nusing namespace std;\nint n,a[N],m;\nint tag[N<<2],maxn[N<<2],minn[N<<2];\nvoid push_up(int p){\n\tmaxn[p]=max(maxn[p<<1],maxn[p<<1|1]);\n\tminn[p]=min(minn[p<<1],minn[p<<1|1]);\n}\nvoid push_tag(int p,int v){\n\tmaxn[p]+=v;\n\tminn[p]+=v;\n\ttag[p]+=v;\n}\nvoid push_down(int p){\n\tif(tag[p]){\n\t\tpush_tag(p<<1,tag[p]);\n\t\tpush_tag(p<<1|1,tag[p]);\n\t\ttag[p]=0;\n\t}\n}\nvoid build(int p,int l,int r){\n\tif(l==r){\n\t\tminn[p]=maxn[p]=a[l];\n\t\treturn ;\n\t}\n\tint mid=(l+r)>>1;\n\tbuild(p<<1,l,mid);\n\tbuild(p<<1|1,mid+1,r);\n\tpush_up(p);\n}\nvoid modify(int p,int l,int r,int ql,int qr,int v){\n\tif(ql>qr) return ;\n\tif(ql<=l&&qr>=r){\n\t\tpush_tag(p,v);\n\t\treturn ;\n\t}\n\tpush_down(p);\n\tint mid=(l+r)>>1;\n\tif(ql<=mid) modify(p<<1,l,mid,ql,qr,v);\n\tif(qr>mid) modify(p<<1|1,mid+1,r,ql,qr,v);\n\tpush_up(p);\n}\nint queryl(int p,int l,int r,int v){\n\tif(l==r) return l;\n\tpush_down(p);\n\tint mid=(l+r)>>1;\n\tif(maxn[p<<1]>=v) return queryl(p<<1,l,mid,v);\n\telse return queryl(p<<1|1,mid+1,r,v);\n}\nint queryr(int p,int l,int r,int v){\n\tif(l==r) return l;\n\tpush_down(p);\n\tint mid=(l+r)>>1;\n\tif(minn[p<<1|1]<=v) return queryr(p<<1|1,mid+1,r,v);\n\telse return queryr(p<<1,l,mid,v);\n}\nint queryval(int p,int l,int r,int x){\n\tif(l==r) return maxn[p];\n\tpush_down(p);\n\tint mid=(l+r)>>1;\n\tif(x<=mid) return queryval(p<<1,l,mid,x);\n\telse return queryval(p<<1|1,mid+1,r,x);\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\tsort(a+1,a+n+1);\n\tbuild(1,1,n);\t\n\twhile(m--){\n\t\tchar c;\n\t\tcin>>c;\n\t\tint x,y;\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tif(c=='F'){\n\t\t\tif(y>maxn[1]) continue;\n\t\t\tint pos=queryl(1,1,n,y);\n\t\t\tx=min(n-pos+1,x);\n\t\t\tint val=queryval(1,1,n,pos+x-1);\n\t\t\tint l=queryl(1,1,n,val),r=queryr(1,1,n,val);\n\t\t\tint t=l-pos;\n\t\t\tmodify(1,1,n,pos,l-1,1);\n\t\t\tmodify(1,1,n,r-(x-t)+1,r,1);\n\t\t}\n\t\telse{\n\t\t\tif(maxn[1]<x||minn[1]>y){\n\t\t\t\tputs(\"0\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tint l=queryl(1,1,n,x),r=queryr(1,1,n,y);\n\t\t\tprintf(\"%d\\n\",r-l+1);\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1621846953,
        "uid": 128870,
        "name": "chen_qian",
        "ccfLevel": 7,
        "title": "P4666"
    }
]