[
    {
        "content": "# \u4e00\u3001\u9898\u76ee\uff1a\n\n[\u6d1b\u8c37\u539f\u9898](https://www.luogu.com.cn/problem/P7016)\n\n[codeforces\u539f\u9898](https://codeforces.com/gym/100299)\n\n# \u4e8c\u3001\u9898\u76ee\uff1a\n\n\u8fd9\u9053\u9898\u7684\u5b98\u65b9\u9898\u89e3\u79c0\u4e86\u6211\u4e00\u8138\u3002\n\n\u8bbe\u591a\u9879\u5f0f\n$$\n\\begin{aligned}\nA(x)&=(x-1)(x-2)(x-3)(x-5)\\cdots(x-F_k)\\\\\n\t&=x^k+b_1x^{k-1}+b_2x^{k-2}+\\cdots+b_{k-1}x+b_k\n\\end{aligned}\n$$\n\u6ce8\u610f\u5230\n$$\n\\begin{aligned}\nA(1)=1^k+b_1\\times1^{k-1}+b_2\\times1^{k-2}+\\cdots+b_k=0\\\\\nA(2)=2^k+b_1\\times2^{k-1}+b_2\\times2^{k-2}+\\cdots+b_k=0\\\\\nA(3)=3^k+b_1\\times 3^{k-1}+b_2\\times 3^{k-2}+\\cdots +b_k=0\\\\\nA(5)=5^k+b_1\\times 5^{k-1}+b_2\\times 5^{k-2}+\\cdots +b_k=0\\\\\n\n\\end{aligned}\n$$\n\u5373\n$$\n\\forall i\\in[1,k],A(F_i)=F_i^k+b_1F_i^{k-1}+b_2F_i^{k-2}+\\cdots+b_k=0\n$$\n\u7b49\u5f0f\u4e24\u8fb9\u540c\u65f6\u4e58\u4ee5 $a_iF_i$\uff0c\u5f97\n$$\na_iF_iA(F_i)=a_iF_i^{k+1}+b_1a_iF_i^{k}+b_2a_iF_i^{k-1}+\\cdots+b_ka_iF_i=0\n$$\n\u7d2f\u52a0\uff0c\u5f97\n$$\n\\sum\\limits_{i=1}^kF_ia_iA(F_i)=\\sum\\limits_{i=1}^{k}a_iF_i^{k+1}+b_1\\sum\\limits_{i=1}^ka_iF_i^{k}+\\cdots+b_k\\sum\\limits_{i=1}^ka_iF_i=0\n$$\n\u5373\n$$\np(k+1)+b_1p(k)+b_2p(k-1)+\\cdots+b_kp(1)=0\n$$\n\u8fd9\u9898\u7ed3\u675f\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f\u6c42\u51fa $A(x)$ \u7684\u7cfb\u6570 $b$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u5373 $O(k^2)$\u3002\n\n# \u4e09\u3001\u4ee3\u7801\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n\nusing namespace std;\n#define FILEIN(s) freopen(s, \"r\", stdin)\n#define FILEOUT(s) freopen(s, \"w\", stdout)\n#define mem(s, v) memset(s, v, sizeof s)\n\ninline int read(void) {\n    int x = 0, f = 1; char ch = getchar();\n    while (ch < '0' || ch > '9') { if (ch == '-') f = -1; ch = getchar(); }\n    while (ch >= '0' && ch <= '9') { x = x * 10 + ch - '0'; ch = getchar(); }\n    return f * x;\n}\n\nconst int MAXK = 4005;\n\nint MOD, K;\nlong long f[MAXK];\n\nstruct Polynomial {\n    int n;\n    long long a[MAXK];\n    Polynomial() { n = 0; mem(a, 0); }\n    inline friend Polynomial operator *(const Polynomial &A, const Polynomial &B) {\n        Polynomial res; res.n = A.n + B.n;\n        for (int i = 0; i <= A.n; ++ i)\n            for (int j = 0; j <= B.n; ++ j)\n                (res.a[i + j] += A.a[i] * B.a[j] % MOD) %= MOD;\n\n        return res;\n    }\n};\n\ninline void prework(void) {\n    f[1] = 1; f[2] = 2;\n    for (int i = 3; i <= K; ++ i) f[i] = (f[i - 1] + f[i - 2]) % MOD;\n}\n\nint main() {\n    int T = read();\n    while (T --) {\n        K = read(); MOD = read();\n        prework();\n        Polynomial res; res.n = 0; res.a[0] = 1;\n        for (int i = 1; i <= K; ++ i) {\n            Polynomial now; now.n = 1; now.a[0] = -f[i]; now.a[1] = 1;\n            res = res * now;\n        }\n        long long ans = 0;\n        for (int i = 1; i <= K; ++ i) {\n            long long p = read();\n            (ans += p * res.a[i - 1] % MOD) %= MOD;\n        }\n        ans = -ans;\n        if (ans < 0) ans += MOD;\n        printf(\"%lld\\n\", ans);\n    }\n    return 0;\n}\n```\n\n",
        "postTime": 1625301573,
        "uid": 43513,
        "name": "\u5cb8\u82b7\u6c40\u5170",
        "ccfLevel": 8,
        "title": "\u6d1b\u8c37  P7016 [CERC2013]Captain Obvious and the Rabbit-Man \u9898\u89e3"
    },
    {
        "content": "\u4ee3\u7801\u5199\u5f97\u4e11\uff0c\u5728 CF \u4e0a\u8fc7\u4e0d\u53bb\uff0c\u6211\u61d2\u5f97\u6539\u4e86\u3002\n\n---\n\n\u4ece\u7ebf\u4ee3\u89d2\u5ea6\u63cf\u8ff0\u95ee\u9898\uff1a\n\n$$\\begin{bmatrix}F_1^1\\ F_2^1\\ \\cdots\\ F_k^1 \\\\ F_1^2\\ F_2^2\\ \\cdots\\ F_k^2\\\\ F_1^3\\ F_2^3\\ \\cdots\\ F_k^3 \\\\ \\vdots \\quad \\vdots \\quad \\vdots \\quad \\vdots \\end{bmatrix} \\times \\begin{bmatrix}a_1 \\\\ a_2\\\\ \\vdots \\\\ a_k \\end{bmatrix}=\\begin{bmatrix}p_1 \\\\ p_2\\\\ p_3 \\\\ \\vdots \\end{bmatrix}$$\n\n\u6b64\u65f6\u7531\u4e8e\u6211\u4eec\u5df2\u77e5 $p_1,\\ldots,p_k$\uff0c\u6b32\u6c42 $p_{k+1}$\uff0c\u4e0d\u59a8\u76f4\u63a5\u89e3\u51fa $a_1,\\ldots,a_k$\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u7b97\u51fa $p_{k+1}$ \u4e86\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u53d6\u77e9\u9635\u7684\u524d $k$ \u884c\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u5bf9\u5de6\u8fb9\u90a3\u4e2a\u65b9\u9635\u6c42\u9006\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u53f3\u8fb9\u7b97\u5de6\u8fb9\u4e86\u3002\n\n\u800c\u5de6\u8fb9\u662f\u4e2a\u7f3a\u4e00\u884c\u7684\u8303\u5fb7\u8499\u5fb7\u77e9\u9635\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8fdb\u884c\u8303\u5fb7\u8499\u5fb7\u77e9\u9635\u7684\u6c42\u9006\u5373\u53ef\u3002\n\nhttps://ccjou.wordpress.com/2012/06/13/vandermonde-%E7%9F%A9%E9%99%A3%E7%9A%84%E9%80%86%E7%9F%A9%E9%99%A3%E5%85%AC%E5%BC%8F/\n\n\u4e0a\u9762\u7684\u94fe\u63a5\u7ed9\u51fa\u4e86\u8303\u5fb7\u8499\u5fb7\u9006\u77e9\u9635\u7684\u516c\u5f0f\uff1a\n\n$$V^{-1}_{i,j}=(-1)^{j+1}\\times \\Big(\\sum\\limits_{1\\leq p_1<\\ldots<p_{n-j}\\leq n,p_k\\ne i}\\prod F_{p_k}\\Big)/\\Big(\\prod\\limits_{k\\ne i} (F_k-F_i)\\Big)$$\n\n\u4e0a\u9762\u662f\u7528\u4f34\u968f\u77e9\u9635\u548c\u57fa\u672c\u5bf9\u79f0\u51fd\u6570\u63a8\u7684\uff0c\u8fd9\u91cc\u4e0d\u8be6\u7ec6\u5199\u4e00\u904d\u4e86\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0cDFT \u548c IDFT \u4e4b\u95f4\u7684\u5173\u7cfb\u4e5f\u4e0e\u8fd9\u4e2a\u7ed3\u8bba\u6709\u5173\u3002\n\n\u56de\u5230\u8fd9\u9898\uff0c\u4e0a\u9762\u7684\u5206\u5b50\u548c\u5206\u6bcd\u90fd\u53ef\u4ee5\u901a\u8fc7 DP \u9012\u63a8\u6c42\u51fa\uff0c\u6211\u4eec\u76f4\u63a5\u6c42\u5b8c\u9006\u4e4b\u540e\u4e58\u4e0a\u53f3\u8fb9\u7684\u5217\u5411\u91cf\u5c31\u5f97\u5230\u4e86\u6240\u6709 $a_i$\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int MAXN=4010;\nint t,n,m,ans,f[MAXN],w[MAXN],v[MAXN][MAXN],lh[MAXN][MAXN],zlh[MAXN],a[MAXN];\nint qpow (int a,int b,int p) {\n\tint res=1;\n\twhile (b) {\n\t\tif (b&1) {res=(1ll*res*a)%p;}\n\t\ta=(1ll*a*a)%p,b>>=1;\n\t}\n\treturn res;\n}\nint main () {\n\tscanf(\"%d\",&t);\n\tfor (int ii=1;ii<=t;ii++) {\n\t\tscanf(\"%d%d\",&n,&m);\n\t\tfor (int j=1;j<=n;j++) {scanf(\"%d\",&w[j]);}\n\t\tf[1]=1,f[2]=2;\n\t\tfor (int i=3;i<=n;i++) {f[i]=(f[i-1]+f[i-2])%m;}\n\t\tv[0][0]=1;\n\t\tfor (int i=1;i<=n;i++) {\n\t\t\tv[i][0]=1;\n\t\t\tfor (int j=1;j<=i;j++) {\n\t\t\t\tv[i][j]=(v[i-1][j]+(1ll*v[i-1][j-1]*f[i])%m)%m;\n\t\t\t}\n\t\t\tv[i][i+1]=0;\n\t\t}\n\t\tfor (int i=0;i<=n;i++) {zlh[i]=v[n][i];}\n\t\tfor (int i=1;i<=n;i++) {\n\t\t\tlh[i][0]=1;\n\t\t\tfor (int j=1;j<=n;j++) {lh[i][j]=(zlh[j]-(1ll*lh[i][j-1]*f[i])%m+m)%m;}\n\t\t}\n\t\tfor (int i=1;i<=n;i++) {\n\t\t\tint prod=1;\n\t\t\tfor (int j=1;j<=n;j++) {\n\t\t\t\tif (j==i) {continue;}\n\t\t\t\tprod=(1ll*prod*(f[j]-f[i]+m))%m;\n\t\t\t}\n\t\t\tprod=qpow(prod,m-2,m);\n\t\t\t//cout << i << \"  \" << prod << endl;\n\t\t\tfor (int j=1;j<=n;j++) {\n\t\t\t\tv[i][j]=(1ll*prod*lh[i][n-j])%m;\n\t\t\t\tif (j%2==0) {v[i][j]=(m-v[i][j])%m;}\n\t\t\t\t//cout << i << \"  \" << j << \"    \" << lh[i][j] << \"  \" << v[i][j] << endl;\n\t\t\t}\n\t\t}\n\t\tans=0;\n\t\tfor (int i=1;i<=n;i++) {\n\t\t\ta[i]=0;\n\t\t\tfor (int j=1;j<=n;j++) {a[i]=(a[i]+(1ll*w[j]*v[i][j])%m)%m;}\n\t\t\tans=(ans+(1ll*a[i]*qpow(f[i],n,m))%m)%m;\n\t\t}\n\t\tprintf(\"%d\\n\",ans);\n\t}\n\treturn 0;\n}\n\n```\n",
        "postTime": 1623737698,
        "uid": 113546,
        "name": "ix35",
        "ccfLevel": 10,
        "title": "[CERC2013]Captain Obvious and the Rabbit-Man \u9898\u89e3"
    }
]