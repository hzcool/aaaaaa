[
    {
        "content": "\u65b9\u4fbf\u8d77\u89c1\uff0c\u4e0b\u6587\u7528 $n$ \u8868\u793a\u539f\u9898\u4e2d\u7684 $2^n$\u3002\n\n\u6211\u4eec\u6ce8\u610f\u5230 $\\text{DFT}$ \u8fd9\u4e2a\u4e1c\u897f\u5b9e\u9645\u4e0a\u5c31\u662f\u4e58\u4e00\u4e2a\u8303\u5fb7\u8499\u5fb7\u77e9\u9635\uff1a\n\n$$\nV=\n\\begin{bmatrix}\n1&1&1&\\cdots&1\\\\\n1&\\omega&\\omega^2&\\cdots&\\omega^{n-1}\\\\\n1&\\omega^2&\\omega^4&\\cdots&\\omega^{2(n-1)}\\\\\n1&\\omega^3&\\omega^6&\\cdots&\\omega^{3(n-1)}\\\\\n\\vdots&\\vdots&\\vdots&\\ddots&\\vdots\\\\\n1&\\omega^{n-1}&\\omega^{2(n-1)}&\\cdots&\\omega^{(n-1)(n-1)}\\\\\n\\end{bmatrix}\n$$\n\n\u56e0\u6b64\u8ba1\u7b97 $\\text{DFT}^k$ \u5b9e\u9645\u4e5f\u5c31\u662f\u8ba1\u7b97\u8fd9\u4e2a\u77e9\u9635\u7684 $k$ \u6b21\u65b9\u3002\n\n\u6211\u4eec\u5148\u624b\u7b97\u4e00\u4e0b $V^2$ \u8bd5\u8bd5\uff1a\n\n$$\nV^2_{ij}=\\sum_{k=0}^{n-1}\\omega^{ik+kj}=\\left(\\sum_{k=0}^{n-1}\\omega^{k}\\right)\\omega^{i+j}\n$$\n\n\u6ce8\u610f\u5230\u9664\u975e $i+j=n$ \u6216 $i+j=0$\uff0c\u90a3\u4e48\u8fd9\u4e2a $\\sum\\omega^k$ \u5c31\u4f1a\u76f4\u63a5\u53d8\u6210 $0$ \u628a\u6574\u4e2a\u6d88\u6389\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c$V$ \u5e73\u65b9\u4e4b\u540e\u5927\u6982\u662f\u4e2a\u8fd9\u4e2a\u6837\u5b50\uff1a\n\n$$\nV^2=\n\\begin{bmatrix}\nn&0&0&\\cdots&0\\\\\n0&0&0&\\cdots&n\\\\\n\\vdots&\\vdots&\\vdots&\\ddots&\\vdots\\\\\n0&0&n&\\cdots&0\\\\\n0&n&0&\\cdots&0\\\\\n\\end{bmatrix}\n$$\n\n\u6211\u4eec\u60ca\u8bb6\u5730\u53d1\u73b0\u628a\u4e00\u4e2a\u4e1c\u897f\u4e58\u4e0a $V^2$ \u5b9e\u9645\u4e0a\u5c31\u7b49\u4ef7\u4e8e\uff1a\n\n> **\u6bcf\u4e00\u9879\u90fd\u4e58\u4e0a $n$\uff0c\u7136\u540e\u7ffb\u8f6c\u540e $n-1$ \u9879**\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u518d\u4e58\u4e0a $V^4$\uff0c\u540e $n-1$ \u9879\u8f6c\u4e86\u56de\u6765\uff0c\u90a3\u5c31\u76f8\u5f53\u4e8e\u6bcf\u4e00\u9879\u4e58\u4e0a $n^2$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5148\u7b97\u51fa\u6765 $\\left\\lfloor\\dfrac{k}{4}\\right\\rfloor$ \u5148\u4e58\u4e00\u4e0b\uff0c\u518d\u505a $k\\bmod 4$ \u6b21 NTT \u5c31\u884c\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log n+n\\log k)$\u3002\n\n```cpp\n#include<complex>\n#include<iostream>\n#include<cmath>\n#include<cstdlib>\n#include<cstdio>\n#include<algorithm>\n\n#define int long long\n#define MAXN 2100000\n\nusing namespace std;\n\nint x[MAXN],y[MAXN],z[MAXN];\nint N,M;\n\nint read(){\n\tint x=0;char c=getchar();\n\tfor(;(c<'0'||c>'9');c=getchar());\n\tfor(;(c>='0'&&c<='9');c=getchar())x=x*10+(c&15);\n\treturn x;\n}\n\nint rev[MAXN],k,L;\n\nconst int mod=998244353;\nconst int g=3;\nconst int g1=332748118;\n\nvoid init(){\n    rev[0]=0;\n    for(int i=0;i<k;i++)rev[i]=(rev[i>>1]>>1)|((i&1)<<(L-1));\n}\n\nint ksm(int x,int y){\n    x%=mod;int ans=1;\n    for(int i=y;i;i>>=1,x=x*x%mod)if(i&1)ans=ans*x%mod;\n    return ans%mod;\n}\n\nvoid ntt(int *a,int sz,int tag){\n    for(int i=1;i<sz;i++)if(i<rev[i])swap(a[i],a[rev[i]]);\n    int n=log2(sz);\n    for(int i=1;i<=n;i++){\n        int m=1<<i,wn;\n        if(tag==1)wn=ksm(g,(mod-1)/(m));\n        else wn=ksm(g1,(mod-1)/(m));\n        for(int j=0;j<sz;j+=m){\n            int omega=1;\n            for(int l=0;l<m/2;l++){\n                int x=omega*a[j+l+m/2]%mod,y=a[j+l]%mod;\n                a[j+l]=(y+x)%mod;a[j+l+m/2]=(y-x+mod)%mod;\n                omega=omega*wn%mod;\n            }\n        }\n    }\n}\n\nint K,qwq;\n\nsigned main(){\n\n    qwq=read(),K=read();\n    N=(1<<qwq)-1;\n    for(int i=0;i<=N;i++)x[i]=(read()+mod)%mod;\n\n    for(k=1,L=0;k<=N;k<<=1,L++);\n\n    int qwq=(int)(K/4)*2;K%=4;\n    for(int i=0;i<=N;i++)x[i]=x[i]*(ksm((N+1),qwq)%mod)%mod;\n\n    init();\n    for(int i=1;i<=K;i++)ntt(x,k,1);\n\n    for(int i=0;i<=N;i++)cout<<x[i]%mod<<\" \";\n    puts(\"\");\n\n    return 0;\n}\n```",
        "postTime": 1629859575,
        "uid": 307453,
        "name": "\u4e91\u6d45\u77e5\u5904",
        "ccfLevel": 6,
        "title": "P7848"
    },
    {
        "content": "\u4e0b\u9762\u8bb0 $n=2^N$\u3002\n\n\u8003\u8651 NTT \u7684\u5b9e\u9645\u8fc7\u7a0b\u3002\u5c06\u591a\u9879\u5f0f $f$ \u770b\u4f5c\u77e9\u9635 $[f_0,f_1,\\cdots ,f_{n-1}]$\uff0cNTT \u7684\u8fc7\u7a0b\u5b9e\u9645\u4e0a\u5c31\u662f\u4e58\u4e0a\u77e9\u9635 $\\frac{1}{n}M_1M_2$\uff0c\u5176\u4e2d $M_1$ \u4e3a\uff1a\n\n$$\n\\begin{bmatrix}\n\\omega^{0\\times 0}_n & \\omega^{0\\times 1}_n & \\dots & \\omega^{0\\times (n-1)}_n \\\\\n\\omega^{1\\times 0}_n & \\omega^{1\\times 1}_n & \\dots & \\omega^{1\\times (n-1)}_n \\\\\n\\vdots & \\vdots & \\ddots & \\vdots \\\\\n\\omega^{(n-1)\\times 0}_n & \\omega^{(n-1)\\times 1}_n & \\dots & \\omega^{(n-1)\\times (n-1)}_n \\\\\n\\end{bmatrix}\n$$\n\n$M_2$ \u5c31\u662f $M_1$ \u6bcf\u4e2a\u5143\u7d20\u5e42\u6b21\u53d6\u76f8\u53cd\u6570\u3002\u663e\u7136 $M_2 = M_1^{-1}$\u3002\u8fd9\u4e2a\u77e9\u9635\u5728\u8fd0\u7b97\u610f\u4e49\u6765\u8bf4\u662f\u6c42\u51fa\u591a\u9879\u5f0f $f$ \u7684 $n$ \u4e2a\u70b9\u503c\uff0c\u5728\u7ebf\u6027\u4ee3\u6570\u610f\u4e49\u4e0b\u662f\u5728 $M_1$ \u610f\u4e49\u4e0b\u89c2\u5bdf\u4e00\u4e2a\u5411\u91cf\u3002\n\n\u8fd9\u4e2a\u9898\u6211\u4eec\u53ea\u9700\u8981\u6c42 $f \\times M_1^k$ \u5c31\u597d\u4e86\u3002\n\n\u5148\u89c2\u5bdf\u4e00\u4e0b\u3002\u56e0\u4e3a\u6700\u7ec8\u4e58\u56de\u6765\u540e\u8fd8\u6709\u7cfb\u6570 $\\dfrac{1}{n}$\uff0c\u731c\u6d4b\u7ecf\u8fc7\u4e00\u6b21\u7ebf\u6027\u53d8\u6362\u540e $f$ \u7684\u6a21\u957f\u662f\u4e4b\u524d\u7684 $\\sqrt n$ \u500d\uff08\u5e76\u4e14\u4f60\u53ef\u4ee5\u53d1\u73b0\u5728 NTT \u6a21\u6570\u4e0b $n$ \u4e00\u5b9a\u5b58\u5728\u4e8c\u6b21\u5269\u4f59\uff0c\u5947\u5999\u554a\uff09\u3002\n\n\u4f46\u662f\u6211\u4eec\u76f4\u63a5\u5bf9\u6bcf\u9879\u4e58\u4e0a ${\\sqrt n}^k$ \u663e\u7136\u662f\u9519\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u4e58\u5230\u7684\u4f4d\u7f6e\u6bcf\u6b21\u662f\u6709\u533a\u522b\u7684\u3002\u6211\u4eec\u8981\u6df1\u6316\u4e00\u4e9b\u6027\u8d28\u3002\n\n\u5148\u8d34\u4e0a\u4e00\u4efd[\u4ee3\u7801](https://www.luogu.com.cn/paste/ddo6yarn)\uff0c\u8fd9\u4efd\u4ee3\u7801\u53ef\u4ee5\u8f93\u51fa $\\frac{M1}{\\sqrt 8}^i$\uff0c\u6b64\u65f6 $n=8$\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u89c4\u5f8b\uff1a\u5728 $n \\bmod 4=2$ \u7684\u65f6\u5019\u548c $n \\bmod 4=0$ \u7684\u65f6\u5019\uff0c\u7531\u7279\u70b9\u7a81\u51fa\u7684\u77e9\u9635\u6784\u6210\uff0c\u5206\u522b\u6307\u53cd\u8f6c $1 \\sim n-1$ \u9879\u548c\u4e0d\u53d8\u3002\n\n\u6211\u4eec\u8003\u8651\u548c NTT \u8fc7\u7a0b\u6709\u673a\u7ed3\u5408\u3002\u5728\u6ca1\u6709\u8fed\u4ee3\u7684 NTT \u7248\u672c\u4e2d\uff0cIDFT \u662f\u76f4\u63a5\u53cd\u8f6c $1 \\sim n-1$ \u4f4d\uff0c\u90a3\u4e48\u662f\u4e0d\u662f\u6709\u8ff9\u53ef\u5faa\u4e86\u5462\uff1f\n\n\u90a3\u4e48\u8fd9\u4e2a\u95ee\u9898\u7684\u89e3\u51b3\u5c31\u975e\u5e38\u65b9\u4fbf\u4e86\u3002\u6211\u4eec\u505a\u56db\u6b21 NTT \u76f8\u5f53\u4e8e\u5bf9\u6bcf\u9879\u4e58\u4e0a $n^2$\u3002\u90a3\u4e48\u6211\u4eec\u6700\u591a\u505a\u4e09\u904d NTT\u3002\u76f4\u63a5\u505a\u5c31\u597d\u4e86\u3002\n\n\u5f53\u7136\u4f60\u76f4\u63a5\u6253\u8868\u770b\u51fa $n^2$ \u7684\u89c4\u5f8b\u4e5f\u662f\u597d\u7684\u3002\n\n```cpp\nint main(){\n\tN=read(),k=read();\n\tf.resize(n=(1<<N));\n\tfor(LL i=0;i<n;++i)\trev[i]=(rev[i>>1]>>1)|((i&1)*(n>>1));\n\tLL coe=QuickPow(Mul(n,n),k/4);\n\tfor(LL i=0;i<n;++i)\tf[i]=Mul(read(),coe);\n\tk&=3;\n\twhile(k-->0)\tNTT(f);\n\tfor(LL i=0;i<n;++i)\twrite(f[i]),putchar(i+1==n?'\\n':' ');\n\treturn 0;\n}\n```",
        "postTime": 1649758028,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u5206\u5206\u5f39"
    },
    {
        "content": "from DreamWasTaken\u3002\n\n$$\\text{DFT}(b)_i=\\sum_{j=0}^{2^n-1}b_j\\omega^{ij}\\mod{998244353}$$\n\n$\\text{DFT}$ \u672c\u8eab\u6ca1\u53ef\u89c1\u6027\u8d28\uff0c\u8003\u8651\u8fed\u4ee3\uff1a\n\n$$\\text{DFT}^2(b)_i=\\sum_{j=0}^{2^n-1}\\left(\\sum_{k=0}^{2^n-1}b_k\\omega^{jk}\\right)\\omega^{ij}=\\sum_{k=0}^{2^n-1}b_k\\sum_{j=0}^{2^n-1}\\omega^{j(k+i)}$$\n\n\u7531\u5355\u4f4d\u6839\u53cd\u6f14\uff0c\u6709\uff1a\n\n$$\\text{DFT}^2(b)_i=\\sum_{k=0}^{2^n-1}b_k2^n[k+i\\in\\{0,2^n\\}]$$\n$$\\text{DFT}^2(b)_i=2^nb_{2^n-i\\mod2^n}$$\n\n\u518d\u8fed\u4ee3\u4e00\u6b21\u5f97\u5230\uff1a\n\n$$\\text{DFT}^4(b)_i=4^nb_i$$\n\n\u5bf9\u6bcf\u4e00\u9879\u4e58 $4^{\\lfloor \\frac k 4\\rfloor}$\uff0c\u518d\u8fdb\u884c $k\\bmod 4$ \u6b21 DFT \u5373\u53ef\u3002",
        "postTime": 1611485705,
        "uid": 114914,
        "name": "\u4e00\u53ea\u4e66\u866b\u4ed4",
        "ccfLevel": 4,
        "title": "dWoi Round 2 D \u9898\u89e3"
    },
    {
        "content": "\u4ee4 $N=$ \u539f\u6765\u9898\u9762\u4e2d\u7684 $n$\uff0c\u9898\u89e3\u4e2d\u7684 $n=2^N$\u3002\n\n\u56de\u5fc6 IDFT \u7684\u516c\u5f0f\u63a8\u5bfc\uff0c\u7ed3\u8bba\u662f IDFT \u662f DFT \u7684\u67ff\u5b50\u4e2d\u5e8f\u5217\u7ffb\u8f6c\u518d\u4e58 $\\dfrac 1n$\uff0c\u7b49\u4ef7\u5730\u6765\u8bf4\uff0cDFT \u5c31\u662f\u628a IDFT \u7684\u67ff\u5b50\u4e2d\u5e8f\u5217\u7ffb\u8f6c\u518d\u4e58 $n$\u3002  \n\u4e8e\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5947\u6570\u9879\u7684 DFT \u8003\u8651\u6210 DFT\uff0c\u628a\u5076\u6570\u9879\u7684 DFT \u8003\u8651\u6210\u53d8\u6362\u8fc7\u7684  IDFT\u3002\u8003\u8651 $k=4$ \u7684\u60c5\u51b5\uff0c\u7b2c\u4e00\u6b21 DFT $\\to$ IDFT\uff1aDFT \u4e0e IDFT \u62b5\u6d88\uff0c\u7559\u4e0b\u5e8f\u5217\u7ffb\u8f6c\u4e58 $n$\uff1b\u7b2c\u4e8c\u6b21 DFT $\\to$ IDFT\uff1aDFT \u4e0e IDFT \u62b5\u6d88\uff0c\u7ffb\u8f6c\u4e0e\u524d\u9762\u7684\u7ffb\u8f6c\u62b5\u6d88\uff0c\u7559\u4e0b\u4e58 $n^2$\u3002  \n\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u53d1\u73b0\u6267\u884c $4$ \u6b21 DFT \u4f1a\u4f7f\u5f97\u5e8f\u5217\u6574\u4e2a\u4e58 $n^2$\uff0c\u4e8e\u662f\u8003\u8651\u5982\u4e0b\u7684\u7b97\u6cd5\uff1a  \n1. \u628a $b$ \u7684\u6bcf\u4e00\u9879\u4e58 $n^{2\\left\\lfloor k/4\\right\\rfloor}$\u3002\n1. \u5982\u679c $k \\bmod 4 \\in \\{2,3\\}$\uff0c\u5219\u5c06\u5e8f\u5217\u7ffb\u8f6c\uff0c\u7136\u540e\u628a\u6bcf\u4e00\u9879\u4e58 $n$\u3002\n1. \u5982\u679c $k \\bmod 2 = 1$\uff0c\u5219\u5bf9\u5e8f\u5217\u8fdb\u884c\u4e00\u6b21 NTT\u3002\n",
        "postTime": 1661380978,
        "uid": 360265,
        "name": "lhx1048576",
        "ccfLevel": 6,
        "title": "fft"
    },
    {
        "content": "SoyTony \u79d1\u6280 orz\u3002\n\n\u8003\u8651 DFT \u76f8\u5f53\u4e8e\u4ee3\u5165 $\\omega^i$\uff0cIDFT \u76f8\u5f53\u4e8e\u4ee3\u5165 $\\omega^{-i}$ \u540e\u9664\u4ee5\u9879\u6570\u3002\n\n\u663e\u7136 $\\omega^{2^n}=1$\uff0c\u4e8e\u662f\u53ef\u4ee5\u53d1\u73b0\u4ee3\u5165 $\\omega^{-i}$ \u5bf9\u5e94\u5e8f\u5217\u7ffb\u8f6c\uff0c\u8003\u8651\u7ed9\u6070\u4e00\u534a\u7684 DFT \u7ffb\u8f6c\u6539\u6210 IDFT\uff0c\u9664\u4ee5\u9879\u6570\u7684\u90e8\u5206\u53ef\u4ee5\u76f4\u63a5\u63d0\u51fa\u6765\u3002\n\n\u53d1\u73b0\u8fd9\u6837\u64cd\u4f5c\u4f1a\u4ea7\u751f $\\dfrac k2$ \u6b21\u7ffb\u8f6c\uff0c\u4e24\u6b21\u7ffb\u8f6c\u624d\u80fd\u62b5\u6d88\uff0c\u4e8e\u662f\u4e0d\u7ba1\u9664\u4ee5\u9879\u6570\u7684\u90e8\u5206\u5219\u7b54\u6848\u6709\u957f\u4e3a $4$ \u7684\u5faa\u73af\u8282\uff0c\u524d\u9762\u76f4\u63a5\u505a\uff0c\u540e\u9762\u6563\u7684\u90e8\u5206\u66b4\u529b NTT \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n2^n)$\u3002",
        "postTime": 1675411610,
        "uid": 227514,
        "name": "jijidawang",
        "ccfLevel": 0,
        "title": "P7844"
    },
    {
        "content": "Solution for [P7844 dWoi R2 - FFT](https://www.luogu.com.cn/problem/P7844)\u3002\n\n---\n\n\u4e3a\u65b9\u4fbf\u8ba8\u8bba\uff0c\u4e0b\u9762\u4ee4 $m=2^n$\uff0c$p=998244353$\u3002\n\n## Subtask 1\n\n$m\\leq 2^{11}, k\\leq 10$\u3002\n\n\u66b4\u529b\u6a21\u62df\u590d\u6742\u5ea6 $>O(m^2k)$ \u7ea7\u522b\u76f4\u63a5 T \u98de\u3002\n\n\u67d0\u4e9b\u7384\u5b66\u7684\u4f3c\u4e4e\u80fd\u8fc7\uff1f\n\n~~\u5176\u5b9e\u6211\u4e5f\u4e0d\u77e5\u9053\u600e\u4e48\u53ea\u62ff\u8fd9\u4e00\u4e2a subtask\u3002~~\n\n## Subtask 2\n\n\u6ce8\u610f\u5230\u8fd9\u91cc\u7684 $k$ \u975e\u5e38\u5c0f\u3002\u5982\u679c\u4f60\u4f1a NTT \u7684\u8bdd\u5c31\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b $k$ \u6b21 NTT\uff0c\u590d\u6742\u5ea6 $O(km\\log m)=O(kn2^n)$ \u53ef\u4ee5\u76f4\u63a5\u6c34\u8fc7\u3002\n\n## Subtask 3 ~ 5\n\n\u8fd9\u91cc\u5f00\u59cb\u5c31\u8981\u601d\u8003\u6b63\u89e3\u4e86\u3002\n\n\u5982\u679c\u5c06\u539f\u5e8f\u5217\u8868\u793a\u6210\u4e00\u4e2a\u5411\u91cf\n$$\n\\vec a=\\left(\\begin{matrix}a_0\\\\a_1\\\\\\vdots\\\\a_{m-1}\\end{matrix}\\right)\n$$\n\u53ef\u4ee5\u77e5\u9053\u505a\u4e00\u6b21\u8fd9\u4e2a DFT \u76f8\u5f53\u4e8e\u7ed9 $\\vec a$ \u5de6\u4e58\u4e00\u4e2a\u77e9\u9635\n$$\nM=\\left[\\begin{matrix}1&1&1&\\cdots&1\\\\1&\\omega&\\omega^2&\\cdots&\\omega^n\\\\1&\\omega^2&\\omega^4&\\cdots&\\omega^{2n}\\\\\\vdots&\\vdots&\\vdots&\\ddots&\\vdots\\\\1&\\omega^{m-1}&\\omega^{2(m-1)}&\\cdots&\\omega^{(m-1)^2}\\end{matrix}\\right]\n$$\n\u6240\u4ee5\u6240\u6c42\u7684\u5e8f\u5217\uff08\u5982\u679c\u4e5f\u8868\u793a\u6210\u5411\u91cf $\\vec A$ \u7684\u8bdd\uff09\u5c31\u662f $M^k\\cdot\\vec a$\u3002\n\n\u90a3\u4e48\u770b\u5230\u8fd9\u91cc\u6709\u4e00\u4e2a $M^k$\uff0c\u53ef\u4ee5\u8bd5\u8bd5\u77e9\u9635\u5feb\u901f\u5e42\uff1a\u590d\u6742\u5ea6 $O(m^3\\log k)=O(2^{3n}\\log k)$\uff0c\u53ef\u4ee5\u901a\u8fc7 Subtask 3\u3002\n\n\u77e9\u9635\u5feb\u901f\u5e42 $\\log k$ \u8fd8\u662f\u4e0d\u591f\u5feb\uff0c\u600e\u4e48\u529e\uff1f\u5c1d\u8bd5\u4e00\u4e0b\u80fd\u4e0d\u80fd\u641e\u6210 $O(1)$ \u4e4b\u7c7b\u7684\u3002\n\n\u6ce8\u610f\u5230\u8fd9\u4e2a $k$ \u975e\u5e38\u4ee4\u4eba\u96be\u53d7\uff0c\u6211\u4eec\u7ed9\u5b83\u4ee3\u4e00\u4e2a\u7279\u503c $2$\uff0c\u7136\u540e\u624b\u7b97\u4e00\u4e0b $M^2$\uff08\u8bbe\u5176\u7b2c $i$ \u884c $j$ \u5217\u4e3a $(M^2)_{i,j}$\uff0c$i,j$ \u4ece $0$ \u5f00\u59cb\uff09\uff1a\n$$\n\\begin{aligned}\n(M^2)_{i,j}&=\\sum_{k=0}^{m-1}M_{i,k}M_{k,j}&&\\text{\u77e9\u9635\u4e58\u6cd5\u5b9a\u4e49}\\\\\n&=\\sum_{k=0}^{m-1}\\omega^{ik}\\omega^{kj}&&\\text{\u89c2\u5bdf\u4e0a\u9762 }M\\text{ \u7684\u5b9a\u4e49\u53ef\u77e5 }M_{i,j}=\\omega^{ij}\\\\\n&=\\sum_{k=0}^{m-1}\\omega^{k(i+j)}&&\\text{\u663e\u7136}\n\\end{aligned}\n$$\n\u6b64\u65f6\u9700\u8981\u5206\u7c7b\u8ba8\u8bba\u3002\n\n$$\\text{\u2014\u2014\u5206\u7c7b\u8ba8\u8bba\u5f00\u59cb\u2014\u2014}$$\n\n1. \u5f53 $m\\mid (i+j)$ \u65f6\uff0c\u7531 $\\omega=3^{\\frac {p-1}m}$ \u77e5\n\n$$\n\\begin{aligned}\n\\omega^{k(i+j)}&=\\omega^{kdm}&&(d\\in\\mathbb Z)\\\\\n&=3^{(p-1)r}&&(r=kd\\in\\mathbb Z)\\\\\n&=(3^{p-1})^r\\\\\n&\\equiv1^r\\equiv1\\pmod p\n\\end{aligned}\n$$\n\n\uff08\u6700\u540e\u4e00\u6b65\u5c31\u662f\u8d39\u5c0f\u6c42\u9006\u5143\uff09\n\n\u6240\u4ee5\u6b64\u65f6\n$$\n\\begin{aligned}\n(M^2)_{i,j}&=\\sum_{k=0}^{m-1}1=m\n\\end{aligned}\n$$\n\n2. \u5f53 $m\\nmid (i+j)$ \u65f6\uff0c\u53ef\u77e5\n\n$$\n\\begin{aligned}\n(M^2)_{i,j}&=\\sum_{k=0}^{m-1}\\omega^{k(i+j)}\\\\\n&=\\omega^{i+j}\\sum_{k=0}^{m-1}\\omega^k&&\\text{\u63d0\u51fa\u6765}\\\\\n&=\\omega^{i+j}\\dfrac {\\omega^m-1}{\\omega-1}&&\\text{\u7b49\u6bd4\u6570\u5217\u6c42\u548c}\\\\\n\\end{aligned}\n$$\n\n\u6ce8\u610f\u5230\n$$\n\\begin{aligned}\n\\omega^m-1&=(3^{\\frac {p-1}m})^m-1\\\\\n&=3^{p-1}-1\\\\\n&\\equiv 1-1\\equiv0\\pmod p\n\\end{aligned}\n$$\n\u6240\u4ee5\u6b64\u65f6\n$$\n\\begin{aligned}\n(M^2)_{i,j}&=0\n\\end{aligned}\n$$\n$$\\text{\u2014\u2014\u5206\u7c7b\u8ba8\u8bba\u7ed3\u675f\u2014\u2014}$$\n\n\u7ecf\u8fc7\u4e0a\u9762\u7684\u8ba8\u8bba\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa $M^2$ \u5927\u6982\u662f\u8fd9\u6837\u7684\uff1a\n$$\n\\left[\\begin{matrix}m&0&0&\\cdots&0&0\\\\0&0&0&\\cdots&0&m\\\\0&0&0&\\cdots&m&0\\\\\\vdots&\\vdots&\\vdots&\\ddots&\\vdots&\\vdots\\\\0&0&m&\\cdots&0&0\\\\0&m&0&\\cdots&0&0\\end{matrix}\\right]\n$$\n\u7136\u540e\u6211\u4eec\u628a $\\vec a$ \u4e58\u8fc7\u53bb\u5c31\u53ef\u4ee5\u60ca\u5947\u7684\u53d1\u73b0\uff1a\n$$\nM^2\\cdot \\vec a=m\\left(\\begin{matrix}a_0\\\\a_{m-1}\\\\a_{m-2}\\\\\\vdots\\\\a_1\\end{matrix}\\right)\n$$\n\u5c31\u662f\u8bf4\u7ed9 $\\vec a$ \u5de6\u4e58\u4e00\u4e2a $M^2$ \u5c31\u7b49\u4ef7\u4e8e\u5c06 $\\vec a$ \u9664\u7b2c\u4e00\u4e2a\u6570\u5916\u6240\u6709\u6570\u7ffb\u8f6c\uff0c\u7136\u540e\u518d\u4e58\u4e0a\u4e00\u4e2a $m$\u3002\n\n\u597d\u7684\uff0c\u90a3\u4e48\u4e58\u4e0a $M^2$\uff08\u5c31\u662f\u505a\u4e24\u6b21 DFT\uff09\u662f\u8fd9\u6837\uff0c\u90a3\u4e48\u505a\u56db\u6b21\u5c31\u53ef\u4ee5\u76f4\u63a5\u7ed9\u539f\u6765\u5e8f\u5217\u7684\u4e58\u4e2a $m^2$\uff01\n\n\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u5148\u7ed9\u6574\u4e2a\u5e8f\u5217\u7684\u6570\u90fd\u4e58\u4e0a $m^{2\\lfloor\\frac k4\\rfloor}$\uff0c\u7136\u540e\u5bf9\u4e58\u4e86\u4e4b\u540e\u7684\u5e8f\u5217\u8fdb\u884c\u5269\u4e0b\u7684 $k\\bmod 4$ \u6b21 DFT\u3002\n\n\u663e\u7136\u524d\u9762\u7684\u53ef\u4ee5\u7528\u5feb\u901f\u5e42\u5728 $O(m\\log k)$ \u89e3\u51b3\u3002\u90a3\u4e48\u53ea\u9700\u8981\u8003\u8651\u540e\u9762\u7684\u3002\n\n\u5982\u679c\u540e\u9762\u7684 $k\\bmod 4$ \u6b21 DFT \u7528\u66b4\u529b $O(m^2)$ \u7684\u8bdd\uff0c\u53ef\u4ee5\u8fc7\u6389 Subtask 4\uff08\u603b\u590d\u6742\u5ea6 $O(m^2+m\\log k)$\uff09\u3002\n\n\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u505a NTT \u7136\u540e\u5c31\u53ef\u4ee5\u628a\u90a3\u4e2a $O(m^2)$ \u53d8\u6210 $O(m\\log m)$ \u7136\u540e\u6210\u529f\u7684\u8fc7\u6389 Subtask 5\u3002\n\n## Code\n\u6709\u4e86\u601d\u8def\u4ee3\u7801\u5c31\u597d\u5199\u4e86\u3002\n\n\u6ce8\u610f\u7279\u5224 $k<4$ \u7684\u60c5\u51b5\u3002\n\n```cpp\n#include <iostream>\nconst int MOD = 998244353, G = 3, MAXN = 1 << 17;\nusing ll = long long;\nll qpow(ll a, ll b = MOD - 2) // \u5feb\u901f\u5e42\n{\n    ll ans = 1;\n    while (b)\n    {\n        if (b & 1)\n            (ans *= a) %= MOD;\n        (a *= a) %= MOD;\n        b >>= 1;\n    }\n    return ans;\n}\nint InvG = qpow(G), tr[MAXN << 2];\nll f[MAXN << 2];\nvoid NTT(ll *f, int n) // \u677f\u5b50\n{\n    for (int i = 0; i < n; i++)\n        if (i < tr[i])\n            std::swap(f[i], f[tr[i]]);\n    for (int l = 2; l <= n; l <<= 1)\n    {\n        ll root = qpow(G, (MOD - 1) / l);\n        for (int k = 0; k < n; k += l)\n        {\n            ll cur = 1;\n            for (int i = k; i < (l >> 1) + k; i++)\n            {\n                ll qwq = cur * f[i + (l >> 1)] % MOD;\n                f[i + (l >> 1)] = f[i] - qwq;\n                if (f[i + (l >> 1)] < 0)\n                    f[i + (l >> 1)] += MOD;\n                f[i] += qwq;\n                if (f[i] >= MOD)\n                    f[i] -= MOD;\n                (cur *= root) %= MOD;\n            }\n        }\n    }\n}\nint main()\n{\n    int n;\n    long long k;\n    std::cin >> n >> k;\n    int len = 1 << n;\n    for (int i = 0; i < len; i++)\n        std::cin >> f[i];\n    tr[0] = 0;\n    for (int i = 1; i < len; i++)\n        tr[i] = (tr[i >> 1] >> 1) | (i & 1 ? len >> 1 : 0);\n    long long mul = qpow(len, (k / 4) * 2);\n    if (mul) // \u7279\u5224 k < 4\n        for (int i = 0; i < len; i++)\n            (f[i] *= mul) %= MOD;\n    int NTTtimes = k % 4;\n    for (int i = 1; i <= NTTtimes; i++) // \u505a k % 4 \u6b21 NTT\n        NTT(f, len);\n    for (int i = 0; i < len; i++)\n        std::cout << f[i] << ' ';\n    return 0;\n}\n```\n\n$$\\text{\u2014\u2014 The End \u2014\u2014}$$\n\n",
        "postTime": 1634913484,
        "uid": 134519,
        "name": "qwq\u81ea\u52a8\u673a",
        "ccfLevel": 0,
        "title": "P7844 \u9898\u89e3"
    }
]