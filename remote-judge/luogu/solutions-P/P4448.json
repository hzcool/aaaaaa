[
    {
        "content": "\u771f\u662f\u4e00\u9053\u6bd2\u7624\u7684\u597d[\u9898](https://www.luogu.com.cn/problem/P4448)\uff01\n\n### step1 \u9884\u5904\u7406\n\n\u8bbe\u6709\u4e09\u4e2a\u6b63\u6574\u6570 $x,y,z$\uff0c\u6ee1\u8db3 $xy=p^2,xz=q^2$\uff0c\u90a3\u4e48 $yz=(\\frac{pq}x)^2$\uff0c\u4e5f\u662f\u5b8c\u5168\u5e73\u65b9\u6570\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5f97\u5230\uff0c\u82e5 $i,j$ \u548c $j,k$ \u4e0d\u80fd\u76f8\u90bb\uff0c\u5219 $i,k$ \u4e5f\u4e0d\u80fd\u76f8\u90bb\u3002\u6240\u6709\u7403\u4e4b\u95f4\u7684\u4e0d\u80fd\u76f8\u90bb\u7684\u5173\u7cfb\u6784\u6210\u4e86\u591a\u4e2a\u5b8c\u5168\u56fe\u3002\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5e76\u67e5\u96c6\u5408\u5e76\u6bcf\u4e2a\u56fe\u4e0a\u7684\u7403\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c06\u9898\u610f\u8f6c\u5316\u4e3a\uff1a\n\n>\u6709 $m$ \u79cd\u989c\u8272\u7684\u7403\uff0c\u7b2c $i$ \u79cd\u989c\u8272\u7684\u7403\u6709 $s_i$ \u4e2a\uff0c\u6c42\u540c\u8272\u4e0d\u76f8\u90bb\u7684\u6392\u5217\u7684\u6570\u91cf\u3002\n\n<!-- more -->\n\n\u6700\u540e\u5c06\u7403\u6309\u989c\u8272\u6392\u5e8f\uff0c\u672c\u9898\u7684\u9884\u5904\u7406\u5c31\u5b8c\u6210\u4e86\u3002\n### step2 DP\n\u672c\u9898\u7684\u6bd2\u7624\u4e4b\u5904\u5c31\u5728\u4e0e\u72b6\u6001\u548c\u8f6c\u79fb\u3002\n\n\u5148\u770b\u72b6\u6001\u5b9a\u4e49\uff1a\n\n> $f[i][j][k]$ \u8868\u793a\u5728\u524d $i$ \u4e2a\u7403\u7684\u6392\u5217\u4e2d\uff0c\u6ee1\u8db3\u989c\u8272\u4e0d\u7b49\u4e8e\u7b2c $i$ \u4e2a\u7403\u4e14\u540c\u8272\u76f8\u90bb\u7684\u6709 $j$ \u5bf9\uff0c\u989c\u8272\u7b49\u4e8e\u7b2c $i$ \u4e2a\u7403\u4e14\u76f8\u90bb\u7684\u6709 $k$ \u5bf9\u65f6\uff0c\u6392\u5217\u7684\u65b9\u6848\u6570\u3002\n\n\u770b\u5230\u8fd9\u91cc\u6655\u5934\u8f6c\u5411\u7684\u540c\u5b66\uff0c\u8fd9\u91cc\u6709\u56fe\u8ba9\u4f60\u6e05\u9192\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ge5w9z96.png)\n\n\u5bb9\u6613\u5f97\u5230\u7b54\u6848\u5c31\u662f $f[n][0][0]$\u3002\n\n\u4e0b\u9762\u4e3a\u5927\u5bb6\u4e00\u6761\u4e00\u6761\u8bb2\u89e3\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u3002\n\n**\u8f6c\u79fb1**\n\n> \u7b2c $i$ \u4e2a\u7403\u4e0e\u7b2c $i-1$ \u4e2a\u7403\u989c\u8272\u4e0d\u540c\uff0c\u5c06\u8be5\u7403\u653e\u4e8e\u4e24\u4e2a\u5f02\u8272\u7403\u4e4b\u95f4\uff08\u5305\u62ec\u6392\u5217\u7684\u5f00\u5934\u548c\u7ed3\u5c3e\uff09\u3002\n\n\u56e0\u4e3a\u6211\u4eec\u4e4b\u524d\u5df2\u7ecf\u6309\u989c\u8272\u6392\u5e8f\u4e86\uff0c\u6240\u4ee5\u7b2c $i$ \u4e2a\u7403\u7684\u989c\u8272\u8fd8\u662f\u7b2c\u4e00\u6b21\u51fa\u73b0\u3002\u5982\u4e0b\u56fe\uff0c$i=6,j=2,k=0$\uff0c\u6b64\u524d\u7684\u72b6\u6001\u4e3a $i'=5=i-1,j'=1,k'=1=j-j'$\uff08\u4e0e $i-1$ \u4e0d\u540c\u8272\u7684\u8fde\u7eed\u5757\u6570 $=$ \u73b0\u5728\u7684\u8fde\u7eed\u5757\u6570 $-$ \u4e0e $i-1$ \u540c\u8272\u7684\u8fde\u7eed\u5757\u6570\uff09\u3002\u53ef\u4ee5\u63d2\u5165\u7684\u4f4d\u7f6e\u6570\u6709$i-j=4$\u4e2a\u3002\n\n\u6240\u4ee5 $f[i][j][0]+=f[i-1][j'][j-j']*(i-j)\\quad j'\\in[0,j]$\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/xcaof8eo.png)\n\n**\u8f6c\u79fb2**\n\n> \u7b2c $i$ \u4e2a\u7403\u4e0e\u7b2c $i-1$ \u4e2a\u7403\u989c\u8272\u4e0d\u540c\uff0c\u5c06\u8be5\u7403\u653e\u4e8e\u4e24\u4e2a\u540c\u8272\u7403\u4e4b\u95f4\u3002\n\n\u5982\u4e0b\u56fe\uff0c$i=6,j=1,k=0$\uff0c\u6b64\u524d\u7684\u72b6\u6001\u4e3a $i'=5=i-1,j'=1,k'=1=j-j'+1$\uff0c\u53ef\u4ee5\u63d2\u5165\u7684\u4f4d\u7f6e\u6709 $j+1=2$ \u4e2a\u3002\n\n\u6240\u4ee5 $f[i][j][0]+=f[i-1][j'][j-j'+1]*(j+1)\\quad j'\\in[0,j+1]$\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/2ur9u7cq.png)\n\n**\u8f6c\u79fb3**\n\n> \u7b2c $i$ \u4e2a\u7403\u4e0e\u7b2c $i-1$ \u4e2a\u7403\u989c\u8272\u76f8\u540c\uff0c\u5c06\u8be5\u7403\u653e\u4e8e\u4e0e\u8be5\u7403\u989c\u8272\u76f8\u540c\u7684\u7403\u65c1\u8fb9\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u8bbe\u5230\u7b2c $i-1$ \u4e2a\u7403\u6709 $cnt$ \u4e2a\u4e0e $i$ \u7403\u989c\u8272\u76f8\u540c\u7684\u7403\u3002\u5982\u4e0b\u56fe\uff0c$i=7,j=1,k=2,cnt=3$\uff0c\u6b64\u524d\u7684\u72b6\u6001\u4e3a $i'=6=i-1,j'=1=j,k'=1=k-1$\uff0c\u7b26\u5408\u6761\u4ef6\u7684\u4f4d\u7f6e\u6709 $cnt*2=6$ \u4e2a\uff0c\u4f46\u6709 $k'=1$ \u4e2a\u4f4d\u7f6e\u91cd\u590d\u4e86\uff0c\u6240\u4ee5\u53ef\u4ee5\u63d2\u5165\u7684\u4f4d\u7f6e\u6709 $cnt*2-k'=cnt*2-k+1=5$ \u4e2a\u3002\n\n\u6240\u4ee5 $f[i][j][k]+=f[i-1][j][k-1]*(cnt*2-k+1)\\quad k\\in[1,cnt]$\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/9591j8p4.png)\n\n**\u8f6c\u79fb4**\n\n> \u7b2c $i$ \u4e2a\u7403\u4e0e\u7b2c $i-1$ \u4e2a\u7403\u989c\u8272\u76f8\u540c\uff0c\u5c06\u8be5\u7403\u653e\u4e8e\u4e24\u4e2a\u540c\u8272\u7403\u4e4b\u95f4\u3002\n\n\u5982\u4e0b\u56fe\uff0c$i=7,j=0,k=1,cnt=3$\uff0c\u6b64\u524d\u7684\u72b6\u6001\u4e3a $i'=6=i-1,j'=1=j+1,k'=1=k$\uff0c\u53ef\u4ee5\u63d2\u5165\u7684\u4f4d\u7f6e\u6709 $j'=j+1=1$ \u4e2a\u3002\n\n\u6240\u4ee5 $f[i][j][k]+=f[i-1][j+1][k]*(j+1)\\quad k\\in[0,cnt]$\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/sg3esezo.png)\n\n**\u8f6c\u79fb5**\n\n> \u7b2c $i$ \u4e2a\u7403\u4e0e\u7b2c $i-1$ \u4e2a\u7403\u989c\u8272\u76f8\u540c\uff0c\u5c06\u8be5\u7403\u653e\u4e8e\u4e24\u4e2a\u5f02\u8272\u7403\u4e4b\u95f4\u3002\n\n\u5982\u4e0b\u56fe\uff0c$i=7,j=1,k=1,cnt=3$\uff0c\u6b64\u524d\u7684\u72b6\u6001\u4e3a $i'=6=i-1,j'=1=j,k'=1=k$\uff0c\u53ef\u4ee5\u63d2\u5165\u7684\u4f4d\u7f6e\u7b49\u4e8e\u6240\u6709\u4f4d\u7f6e\u51cf\u53bb\u524d\u9762\u4e24\u79cd\uff1a $i-(cnt*2-k')-j'=i-cnt*2+k'-j'=i-cnt*2+k-j=1$\u3002\n\n\u6240\u4ee5 $f[i][j][k]+=f[i-1][j][k]*(i-cnt*2+k-j)\\quad k\\in[0,cnt]$\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/yn1bkj10.png)\n### step3 \u590d\u6742\u5ea6\u3001\u7ec6\u8282\u4e0e\u4ee3\u7801\n\u672c\u9898\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^3)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^3)$\u3002\u4e0b\u9762\u7684\u4ee3\u7801\u4f7f\u7528\u4e86\u6eda\u52a8\u6570\u7ec4\uff0c\u5c06\u7a7a\u95f4\u590d\u6742\u5ea6\u4f18\u5316\u4e3a $O(n^2)$\u3002\n\nCode:\n\n```cpp\n#include<stdio.h>\n#include<math.h>\n#include<string.h>\n#include<algorithm>\n#define ll long long\nint rd(){\n\tint k=0;char c=getchar();\n\twhile(c>'9'||c<'0')c=getchar();\n\twhile(c>='0'&&c<='9')k=k*10+c-'0',c=getchar();\n\treturn k;\n}\nconst int N=301,M=1000000007;\nint n,a[N],b[N],now=1,pre,cnt,f[2][N][N];//now,pre\u8868\u793ai\u548ci-1\u7684\u72b6\u6001\nbool sqr(ll x){ll S=sqrt(x);return S*S==x;}\nint main(){\n\tfreopen(\"data.in\",\"r\",stdin);\n\tfreopen(\"data.out\",\"w\",stdout);\n\tn=rd();\n\tfor(int i=1;i<=n;++i){\n\t\ta[i]=rd(),b[i]=i;\n\t\tfor(int j=1;j<i;++j)if(sqr((ll)a[i]*a[j])){b[i]=j;break;}\n\t}//\u5b9e\u9645\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u5e76\u67e5\u96c6\uff0c\u53ea\u7528\u5c06\u7236\u4eb2\u8bbe\u4e3a\u7b2c\u4e00\u4e2a\u5339\u914d\u6210\u5b8c\u5168\u5e73\u65b9\u6570\u7684\u6570\n\tstd::sort(b+1,b+n+1),f[0][0][0]=1;//\u521d\u59cb\u5316\n\tfor(int i=1;i<=n;++i){\n\t\tmemset(f[now],0,sizeof(f[now]));//\u6eda\u52a8\u6570\u7ec4\u6e05\u7a7a\n\t\tif(b[i]!=b[i-1]){\n\t\t\tcnt=0;//\u5c06\u4e0ei\u76f8\u540c\u7684\u6570\u7684\u4e2a\u6570\u6e05\u7a7a\n\t\t\tfor(int j=0;j<i;++j)\n\t\t\t\tfor(int k=0;k<=j+1;++k){//\u8fd9\u91cc\u672c\u6765\u8981\u679a\u4e3ej'\uff0c\u4e3a\u4e86\u65b9\u4fbf\u5199\u4f5ck\n\t\t\t\t\tif(k<=j)f[now][j][0]=(f[now][j][0]+(ll)f[pre][k][j-k]*(i-j))%M;//\u6ce8\u610f\u8fb9\u754c\n\t\t\t\t\tf[now][j][0]=(f[now][j][0]+(ll)f[pre][k][j-k+1]*(j+1))%M;\n\t\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tfor(int j=0;j<i;++j)\n\t\t\t\tfor(int k=0;k<=cnt;++k){\n\t\t\t\t\tif(k>0)f[now][j][k]=(f[now][j][k]+(ll)f[pre][j][k-1]*(cnt*2-k+1))%M;//\u6ce8\u610f\u8fb9\u754c\n\t\t\t\t\tf[now][j][k]=(f[now][j][k]+(ll)f[pre][j+1][k]*(j+1))%M;\n\t\t\t\t\tf[now][j][k]=(f[now][j][k]+(ll)f[pre][j][k]*(i-cnt*2+k-j))%M;\n\t\t\t\t}\n\t\t}\n\t\tnow^=1,pre^=1,++cnt;//\u6eda\u52a8\n\t}\n\tprintf(\"%d\\n\",f[pre][0][0]);\n\treturn 0;\n}\n\n```\n### step4 \u8fdb\u9636\u7b97\u6cd5\n\u65f6\u9694\u4e00\u5e74\u91cd\u770b\u8fd9\u9898\uff0c\u7ec8\u4e8e\u5b66\u4f1a\u4e86\u5bb9\u65a5\u7684 $O(n^2)$ \u7b97\u6cd5\u3002\n\n\u8bb0\u989c\u8272\u6570\u4e3a $m$\uff0c\u7b2c $t$ \u79cd\u989c\u8272\u7684\u7403\u6570\u91cf\u4e3a $s_t$\u3002\u8003\u8651\u6240\u6709\u5408\u6cd5\u4e0e\u4e0d\u5408\u6cd5\u60c5\u51b5\uff0c\u5c06\u76f8\u540c\u989c\u8272\u7684\u7403\u5408\u5e76\u4e3a\u4e00\u5757\uff0c\u8bbe\u5408\u5e76\u540e\u7b2c $t$ \u79cd\u989c\u8272\u7684\u7403\u5757\u6570\u4e3a $b_t$\uff0c\u8bb0 $B=\\sum\\limits_{t=1}^mb_t$\u3002\n\n\u6b64\u65f6\u7b2c $t$ \u79cd\u989c\u8272\u7684\u5185\u90e8\u65b9\u6848\u6570\u4e3a $s_t!\\binom{s_t-1}{b_t-1}$\uff0c\u5373 $s_t$ \u7684\u4efb\u610f\u6392\u5217\u4e58\u4e0a $s_t$ \u4e2a\u7403\u5206\u4e3a $b_t$ \u5757\u7684\u65b9\u6848\u6570\u3002\u518d\u8003\u8651\u5757\u4e4b\u95f4\u7684\u65b9\u6848\u6570\u91cf\u4e3a $\\dfrac{B!}{\\prod\\limits_{t=1}^m(b_t!)}$\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u4e3a $\\dfrac{B!}{\\prod\\limits_{t=1}^m(b_t!)}\\cdot\\prod\\limits_{t=1}^ms_t!\\binom{s_t-1}{b_t-1}=(\\prod\\limits_{t=1}^m(s_t!))\\cdot B!\\prod\\limits_{t=1}^m\\binom{s_t-1}{b_t-1}\\dfrac{1}{b_t!}$\u3002\n\n\u5728\u8ba1\u7b97\u65f6\u9700\u8981\u679a\u4e3e\u6240\u6709\u7684\u6ee1\u8db3 $B=\\sum\\limits_{t=1}^mb_t$ \u7684 $b_t$\uff0c\u6211\u4eec\u4e0d\u59a8\u8bbe $f(i,j)=\\sum\\limits_{b_i}\\left([\\sum\\limits_{t=1}^ib_t=j]\\prod\\limits_{t=1}^i\\binom{s_t-1}{b_t-1}\\dfrac{1}{b_t!}\\right)$\uff0c\u5219\u7ed3\u679c\u4e3a $(\\prod\\limits_{t=1}^m(s_t!))\\cdot B!f(m,B)$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u6709\u8bb8\u591a\u65b9\u6848\u88ab\u9519\u8bef\u8ba1\u7b97\u4e86\uff0c\u5982 `1 1 2` \u8fd9\u79cd\u65b9\u6848\u4f1a\u88ab $f(2,3)$ \u8ba1\u7b97\u5230\uff0c\u4f46\u8fd9\u5176\u5b9e\u53ea\u5206\u6210\u4e86\u4e24\u5757\u3002\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5bb9\u65a5\uff0c\u6700\u7ec8\u7b54\u6848 $ans=(\\prod\\limits_{t=1}^m(s_t!))\\sum\\limits_{B=m}^nB!f(m,B)(-1)^{n-B}$\u3002\n\n\u63a5\u4e0b\u6765\u53ea\u7528\u8003\u8651\u5982\u4f55\u8ba1\u7b97 $f(i,j)$\uff0c\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e $b_i$\uff0c\u5219 $f(i,j)=\\sum\\limits_{k=1}^{\\min(s_i,j)}f(i-1,j-k)*\\binom{s_t-1}{k-1}\\frac1{k!}$\u3002\n\n\u8003\u8651\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u867d\u7136\u6709\u4e09\u91cd\u5faa\u73af\uff0c\u4f46\u5faa\u73af\u6b21\u6570\u4e3a $\\sum\\limits_{i=1}^ms_i(\\sum\\limits_{j=1}^is_j)$\uff0c\u5b9e\u9645\u4e0a\u662f $O(n^2)$\u3002\n\nCode:\n\n```cpp\n#include<stdio.h>\n#include<math.h>\ntypedef long long ll;\nint rd(){\n\tint k=0;char c=getchar();\n\twhile(c>'9'||c<'0')c=getchar();\n\twhile(c>='0'&&c<='9')k=k*10+c-'0',c=getchar();\n\treturn k;\n}\nconst int N=301,M=1000000007;\nbool sqr(ll x){ll s=sqrt(x);return s*s==x;}\nint Pow(int x,int a){\n\tint s=1;\n\twhile(a){\n\t\tif(a&1)s=(ll)s*x%M;\n\t\tx=(ll)x*x%M,a>>=1;\n\t}\n\treturn s;\n}\nint n,m,ans,a[N],s[N],fac[N],inv[N],f[N][N];\nint C(int n,int m){return(ll)fac[n]*inv[m]%M*inv[n-m]%M;}\nint main(){\n\tn=rd(),fac[0]=inv[0]=f[0][0]=1;\n\tfor(int i=1;i<=n;++i){\n\t\tint _=rd();fac[i]=(ll)fac[i-1]*i%M;\n\t\tfor(int j=1;j<=m;++j)if(sqr((ll)_*a[j])){++s[j];goto End;}\n\t\ta[++m]=_,++s[m];End:;\n\t}\n\tinv[n]=Pow(fac[n],M-2);\n\tfor(int i=n-1;i;--i)inv[i]=(ll)inv[i+1]*(i+1)%M;\n\tfor(int i=1,_=0;i<=m;++i){\n\t\t_+=s[i];\n\t\tfor(int j=1;j<=_;++j)for(int k=1;k<=s[i]&&k<=j;++k)\n\t\t\tf[i][j]=(f[i][j]+(ll)f[i-1][j-k]*C(s[i]-1,k-1)%M*inv[k])%M;\n\t}\n\tfor(int i=m;i<=n;++i){\n\t\tint t=(ll)f[m][i]*fac[i]%M;\n\t\tif((n-i)&1)ans=(ans+M-t)%M;\n\t\telse ans=(ans+t)%M;\n\t}\n\tfor(int i=1;i<=m;++i)ans=(ll)ans*fac[s[i]]%M;\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1570605814,
        "uid": 68467,
        "name": "xcxcli",
        "ccfLevel": 0,
        "title": "[AHOI2018\u521d\u4e2d\u7ec4]\u7403\u7403\u7684\u6392\u5217"
    },
    {
        "content": "\u9996\u5148\u5148\u6765\u8bc1\u660e\u82e5xy\u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\uff0cxz\u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\uff0c\u90a3\u4e48yz\u4e5f\u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\uff0c\u6613\u5f97(x^2)yz\u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\uff0c\u7531\u4e8e\u5b8c\u5168\u5e73\u65b9\u6570\u9664\u4ee5\u5b8c\u5168\u5e73\u65b9\u6570\u8fd8\u662f\u5b8c\u5168\u5e73\u65b9\u6570\uff0c\u53ef\u5f97yz\u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\u3002\n\n\u90a3\u4e48\u901a\u8fc7\u4ee5\u4e0a\u7684\u5b9a\u7406\u53ef\u4ee5\u53d1\u73b0\uff0c\u82e5i\u4e0ej\u4e0d\u80fd\u76f8\u90bb\uff0c\u4e14j\u4e0ek\u4e0d\u80fd\u76f8\u90bb\uff0c\u90a3\u4e48i\u4e0ek\u4e5f\u4e0d\u80fd\u76f8\u90bb\u3002\u4e0d\u5b58\u5728i\u4e0ej\u4e0d\u80fd\u76f8\u90bb\uff0c\u4e14j\u4e0ek\u4e0d\u80fd\u76f8\u90bb\uff0c\u4f46i\u4e0ek\u80fd\u76f8\u90bb\u7684\u60c5\u51b5\u3002\n\n\u90a3\u4e48\u7531\u4ee5\u4e0a\u4fe1\u606f\u53ef\u77e5\uff0c\u5b83\u4eec\u4e4b\u95f4\u6784\u6210\u7684\u60c5\u51b5\u5f62\u6210\u4e86\u591a\u4e2a\u5b8c\u5168\u56fe\uff0c\u4e14\u8fd9\u4e9b\u5b8c\u5168\u56fe\u4e4b\u95f4\u4e92\u4e0d\u5e72\u6270\u3002\n\n\u95ee\u9898\u4fbf\u8f6c\u5316\u4e3a\u7ed9\u51fam\u79cd\u989c\u8272\uff0c\u6bcf\u79cd\u989c\u8272\u7684\u5c0f\u7403\u6709ai\u4e2a\uff0c\u603b\u5171\u6709n\u4e2a\u5c0f\u7403(n<=300)\uff0c\u6c42\u6240\u6709\u5c0f\u7403\u7684\u6392\u5217\u65b9\u6848\u4e2d\uff0c\u4efb\u610f\u76f8\u90bb\u4e24\u4e2a\u5c0f\u7403\u4e0d\u80fd\u4e3a\u540c\u4e00\u79cd\u989c\u8272\u7684\u603b\u65b9\u6848\u6570\u3002\n\n\u90a3\u4e48\u4fbf\u8003\u8651\u52a8\u6001\u89c4\u5212\uff0c\u9996\u5148\u6211\u4eec\u8981\u628a\u8fd9\u4e9b\u7403\u7684\u989c\u8272\u8bb0\u4e0b\u6765\uff0c\u6211\u6709\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u505a\u6cd5\uff0c\u5c31\u662f\u628a\u5728\u540c\u4e00\u4e2a\u8054\u901a\u5757\u4e2d\u7684\u70b9\u7528\u5e76\u67e5\u96c6\u5e76\u8d77\u6765\uff0c\u82e5\u7956\u5b97\u76f8\u540c\uff0c\u5219\u7b97\u540c\u4e00\u79cd\u989c\u8272\u3002\n\n\u6839\u636e\u8fd9\u6837\u7684\u601d\u8def\uff0c\u628a\u6bcf\u4e2a\u7403\u7684\u989c\u8272\u6392\u4e00\u904d\u5e8f\uff0c\u628a\u540c\u4e00\u79cd\u989c\u8272\u7684\u5c0f\u7403\u653e\u5728\u4e00\u6bb5\u6765\u8003\u8651\uff0c\u56e0\u4e3a\u5982\u679c\u4e0d\u662f\u8fd9\u6837\u7684\u8bdd\uff0cdp\u65b9\u7a0b\u5217\u4e0d\u51fa\u6765\u3002\n\n\u5148\u770b\u6837\u4f8b2\uff0c\u5904\u7406\u5b8c\u540e\u6211\u7684\u7a0b\u5e8f\u663e\u793a\u7684\u662f3,3,6,6,6,7,7,8,9\u4ee3\u8868\u7740\u7b2c1\u79cd\u989c\u8272\u67092\u4e2a\uff0c\u7b2c2\u79cd\u989c\u8272\u67093\u4e2a\uff0c\u7b2c3\u79cd\u989c\u8272\u67092\u4e2a\uff0c\u7b2c4\u79cd\u989c\u8272\u67091\u4e2a\uff0c\u7b2c5\u79cd\u989c\u8272\u67091\u4e2a\uff0c\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5dp\u4e86\u3002\n\n\u8bbedp[i][j][k]\u8868\u793a\u8003\u8651\u524di\u4e2a\u7403\uff0c\u6709j\u5bf9\u4e0d\u662f\u5f53\u524d\u989c\u8272\u4f46\u5374\u662f\u540c\u4e00\u79cd\u989c\u8272\u7684\u7403\u6328\u5728\u4e00\u8d77\uff0c\u6709k\u5bf9\u662f\u5f53\u524d\u989c\u8272\u4e5f\u662f\u540c\u4e00\u79cd\u989c\u8272\u7684\u7403\u6328\u5728\u4e00\u8d77\u3002\n\n\u8003\u8651\u82e5\u7b2ci\u4e2a\u7403\u4e0e\u7b2ci-1\u4e2a\u7403\u4e0d\u540c\uff0c\n\n\u82e5\u63d2\u5165\u5230\u4e24\u4e2a\u989c\u8272\u4e0d\u540c\u7684\u7403\u4e2d\u5219dp[i][j][0]+=dp[i-1][k][j-k]\u00d7(i-j);k\u4ece0\u5230j\n\n\u5426\u5219\u82e5\u63d2\u5165\u5230\u4e24\u4e2a\u989c\u8272\u76f8\u540c\u7684\u7403\u4e2ddp[i][j][0]+=dp[i-1][k][j+1-k]\u00d7(j+1);k\u4ece0\u5230j+1\n\n\u63a5\u7740\u8003\u8651\u7b2ci\u4e2a\u7403\u4e0e\u7b2ci-1\u4e2a\u7403\u76f8\u540c\uff0c\u8bbesum\u4e3a\u5f53\u524d\u4e0d\u8003\u8651\u7b2ci\u4e2a\u7403,\u4e00\u5171\u653e\u4e86\u591a\u5c11\u4e2a\u4e0e\u7b2ci\u4e2a\u7403\u989c\u8272\u76f8\u540c\u7684\u7403\uff0c\u8bbel=sum\u00d72-k+1,o=j+1\u3002\n\n\u82e5\u63d2\u5165\u67d0\u4e2a\u4e0e\u7b2ci\u4e2a\u7403\u7684\u989c\u8272\u76f8\u540c\u7684\u7403\u65c1\u8fb9\u5219dp[i][j][k]+=dp[i-1][j][k-1]\u00d7l\n\n\u82e5\u63d2\u5165\u4e24\u4e2a\u989c\u8272\u76f8\u540c\u4f46\u4e0e\u7b2ci\u4e2a\u7403\u989c\u8272\u4e0d\u540c\u7684\u7403\u4e2d\u95f4\u5219dp[i][j][k]+=dp[i-1][j+1][k]\u00d7o\n\n\u5426\u5219\u63d2\u5165\u4e24\u4e2a\u989c\u8272\u4e0d\u540c\u4e14\u4e0e\u7b2ci\u4e2a\u7403\u989c\u8272\u4e5f\u4e0d\u540c\u7684\u7403\u4e2d\u95f4dp[i][j][k]+=dp[i-1][j][k]*(i-l-o+2);\n\n\u7531\u4e8e\u4e09\u7ef4\u6570\u7ec4\u5f00\u4e0d\u4e0b\uff0c\u6240\u4ee5\u8981\u7528\u6eda\u52a8\u6570\u7ec4\u3002\n\n\u4e0a\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#include<cmath>\n#include<cstdlib>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\nlong long n,i,j,k,dp[3][320][320],a[320],zz[320];\nlong long sum,l,o;\nlong long zzz(long long z){\n\tif(zz[z]==z) return z;\n\telse return zz[z]=zzz(zz[z]);\n}\nint main(){\n\tcin>>n;\n\tfor(i=1;i<=n;i++)\n\t\tcin>>a[i];\n\tfor(i=1;i<=n;i++)\n\t\tzz[i]=i;\n\tfor(i=1;i<=n;i++)\n\t\tfor(j=i+1;j<=n;j++){\n\t\t\tl=sqrt(a[i]*a[j]);\n\t\t\tif(l*l==a[i]*a[j])\n\t\t\t\tzz[zzz(i)]=zzz(j);\n\t\t}\n\tfor(i=1;i<=n;i++)\n\t\ta[i]=zzz(i);\n\tsort(a+1,a+n+1);\n   \tdp[1][0][0]=1;\n   \tfor(i=1;i<=n;i++){\n   \t\tif(a[i]!=a[i-1]){\n\t\t\tsum=1;\n\t   \t\tfor(j=0;j<i;j++){\n\t   \t\t\tfor(k=0;k<=j;k++)\n\t   \t\t\t\tdp[2][j][0]+=dp[1][k][j-k]*(i-j);\n\t   \t\t\tfor(k=0;k<=j+1;k++)\n\t   \t\t\t\tdp[2][j][0]+=dp[1][k][j+1-k]*(j+1);\n\t   \t\t\tdp[2][j][0]%=1000000007;\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tfor(j=0;j<i;j++)\n\t   \t\t\tfor(k=0;k<=sum;k++){\t\n\t\t\t\t   \tl=sum*2-k+1;\n\t\t\t\t\to=j+1;\n\t   \t\t\t\tif(k!=0) dp[2][j][k]+=dp[1][j][k-1]*l;\n\t\t\t\t\tdp[2][j][k]+=dp[1][j+1][k]*o;\n\t\t\t\t\tif(i-l-o+2>0) dp[2][j][k]+=dp[1][j][k]*(i-l-o+2);\t\n\t\t\t\t\tdp[2][j][k]%=1000000007;\n\t\t\t\t}\n\t\t\tsum++;\n\t\t}\n\t\tfor(j=0;j<i;j++)\n\t\t\tfor(k=0;k<=i;k++){\n\t\t\t\tdp[1][j][k]=dp[2][j][k];\n\t\t\t\tdp[2][j][k]=0;\n\t\t\t}\n\t}\n\tcout<<dp[1][0][0]<<endl;\n    return 0;\n}\n```\n\n~~(\u4ee3\u7801\u4e11\u964b\uff0c\u4e0d\u559c\u52ff\u55b7)~~",
        "postTime": 1525262778,
        "uid": 20578,
        "name": "ningyuheng",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4448 \u3010[AHOI2018\u521d\u4e2d\u7ec4]\u7403\u7403\u7684\u6392\u5217\u3011"
    },
    {
        "content": "\u673a\u623f\u5927\u54e5\u7528\u751f\u6210\u51fd\u6570\u7206\u641e\u8fd9\u9898\uff0c\u7136\u540e\u53e6\u4e00\u4e2a\u5927\u54e5\u7528\u7b80\u5355\u5bb9\u65a5\u63a8\u51fa\u4e86\u590d\u6742\u5ea6\u76f8\u540c\u7684\u7b80\u6d01\u5f0f\u5b50\u3002\u3002\u3002\n\n\uff08\u6211\u53ea\u80fd\u5728\u4e00\u65c1\u819c\u62dc\uff09\n\n\u4e0d\u96be\u53d1\u73b0 $2$ \u4e2a\u6570\u76f8\u4e58\u7b49\u4e8e\u5b8c\u5168\u5e73\u65b9\u6570\u7b49\u4ef7\u4e8e\u5c06\u4e24\u4e2a\u6570\u7684\u5e73\u65b9\u56e0\u5b50\u90fd\u9664\u53bb\u540e\u4e24\u6570\u76f8\u7b49\u3002\u4e8e\u662f\u6211\u4eec\u8f6c\u5316\u6210\u7ed9\u51fa\u4e00\u4e9b\u7b49\u4ef7\u7c7b\uff0c\u5c06\u6240\u6709\u6570\u5176\u4efb\u610f\u6392\u5217\u4e14\u76f8\u90bb\u7684\u6570\u4e0d\u5728\u540c\u4e00\u7b49\u4ef7\u7c7b\u4e2d\u7684\u65b9\u6848\u3002\n\n\u76f4\u63a5\u505a\u4e0d\u597d\u505a\uff0c\u8003\u8651\u5bb9\u65a5\uff1a\u5047\u8bbe\u6709 $k$ \u4e2a\u7b49\u4ef7\u7c7b\uff0c\u4ee4\u7b2c $i$ \u4e2a\u7b49\u4ef7\u7c7b\u5927\u5c0f\u4e3a $a_i$\uff0c\u8003\u8651\u679a\u4e3e\u81f3\u5c11\u6709 $b_i$ \u4e2a\u76f8\u90bb\uff0c\u90a3\u4e48\u53ef\u4ee5\u63a8\u51fa\uff1a\n\n$$ans=n!\\sum_{b_{1\\dots k}}\\frac{(n-\\sum b_i)!}{\\prod (a_i-b_i)!}\\prod\\binom{a_i-1}{b_i}(-1)^{\\sum b_i}$$\n\n\u5176\u610f\u4e49\u975e\u5e38\u76f4\u89c2\uff1a\n\n- \u4e0b\u5217\u8ba1\u7b97\u65f6\u4ee4\u7b49\u4ef7\u7c7b\u65e0\u5e8f\uff0c\u800c\u9898\u76ee\u8981\u6c42\u7684\u672c\u8d28\u4e0d\u540c\u662f\u5e8f\u53f7\u4e0d\u540c\uff0c\u6240\u4ee5\u7b54\u6848\u8981\u6807\u53f7\u3002\n\n- \u5728 $a_i$ \u4e2a\u70b9\u4e2d\u7528 $b_i$ \u6761\u8fb9\u5c06\u4efb\u610f\u76f8\u90bb\u4e24\u4e2a\u70b9\u56fa\u5b9a\uff0c\u90a3\u4e48\u8fd9\u4e2a\u7b49\u4ef7\u7c7b\u70b9\u6570\u4e3a $a_i-b_i$\uff0c\u603b\u7684\u70b9\u6570\u4e3a $n-\\sum b_i$ \uff0c\u6240\u4ee5\u672c\u8d28\u4e0d\u540c\u7684\u6392\u5217\u6570\u4e3a$\\sum_{b_{1\\dots k}}\\frac{(n-\\sum b_i)!}{\\prod(a_i-b_i)!}$ \n\n- \u5bf9\u4e8e $a_i$ \u4e2a\u6570\uff0c\u4ed6\u4eec\u653e\u5728\u5e8f\u5217\u4e0a\uff0c\u4f60\u8981\u94a6\u5b9a\u5b83\u4eec\u6709\u81f3\u5c11 $b_i$ \u6b21\u51fa\u73b0\u76f8\u90bb\uff0c\u76f8\u5f53\u4e8e\u9009\u62e9\u6240\u6709\u7a7a\u9699\u4e2d\u7684 $b_i$ \u4e2a\uff0c\u800c\u7a7a\u9699\u6709 $a_i-1$ \u4e2a\uff0c\u6240\u4ee5\u6709\u4e2a $\\binom{a_i-1}{b_i}$ \u7684\u7ec4\u5408\u6570\u3002\n\n- \u94a6\u5b9a\u4e86\u81f3\u5c11\uff0c\u6240\u4ee5\u8981\u5bb9\u65a5\uff0c\u5e26\u4e2a $-1$ \u7684\u7cfb\u6570\u3002\n\n\u76f4\u63a5\u505a\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n^2)$ \u7684\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define Mod 1000000007\n#define MN 305\nint n,a[MN],F[MN],siz[MN];\nbool chk(int a){\n\tint b=sqrt(a)+1e-9;\n\treturn b*b==a;\n}\nint fac[MN],dfac[MN],inv[MN];\nint f[MN],tmp[MN],g[MN],ans;\nint C(int m,int n){\n\tif(m<n)return 0;\n\treturn fac[m]*dfac[n]%Mod*dfac[m-n]%Mod;\n}\nsigned main(){\n\tscanf(\"%lld\",&n);\n\tfac[0]=dfac[0]=fac[1]=dfac[1]=inv[1]=1;\n\tfor(int i=2;i<=n;++i){\n\t\tfac[i]=fac[i-1]*i%Mod;\n\t\tinv[i]=(Mod-Mod/i)*inv[Mod%i]%Mod;\n\t\tdfac[i]=dfac[i-1]*inv[i]%Mod;\n\t}\n\tfor(int i=1;i<=n;++i)scanf(\"%lld\",&a[i]);\n\tfor(int i=1;i<=n;++i)F[i]=i;\n\tfor(int i=1;i<=n;++i){\n\t\tsiz[F[i]]++;\n\t\tfor(int j=i+1;j<=n;++j)\n\t\t\tif(chk(a[i]*a[j])){\n\t\t\t\tF[j]=F[i];\t\n\t\t\t}\n\t}\n\tf[0]=1;int sz=0;\n\tfor(int i=1;i<=n;++i){\n\t\tif(!siz[i])continue;\n\t\tfor(int j=0;j<=sz;++j)tmp[j]=f[j],f[j]=0;\n\t\tfor(int j=0;j<siz[i];++j){\n\t\t\tg[j]=dfac[siz[i]-j]*C(siz[i]-1,j)%Mod;\n\t\t\tif(j&1)g[j]=Mod-g[j];\n\t\t\tfor(int k=0;k<=sz;++k){\n\t\t\t\tf[j+k]=(f[j+k]+g[j]*tmp[k])%Mod;\t\n\t\t\t}\n\t\t}\n\t\tsz+=siz[i]-1;\n\t}\n\tfor(int i=0;i<=sz;++i){\n\t\tans=(ans+f[i]*fac[n-i])%Mod;\n\t}\n\tfor(int i=1;i<=n;++i){\n\t\tans=ans*fac[siz[i]]%Mod;\n\t}\n\tsort(a+1,a+1+n);\n\tint lst=0;\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n\n\u540e\u9762\u7684\u90e8\u5206\u53ef\u4ee5\u505a\u5230 $O(n\\log^2n)$\uff0c\u524d\u9762\u7684\u5927\u6982\u80fd\u7528\u7b80\u5355\u505a\u6cd5\u505a\u5230 $O(n\\pi(a^{\\frac{1}{3}}))$ \uff0c\u786c\u4e0a ```pollard-rho``` \u80fd\u505a\u5230 $O(na^{\\frac{1}{4}})$ \u3002\n\n\u800c\u901a\u8fc7\u5206\u6790\u53ef\u4ee5\u83b7\u5f97\u4e00\u4e2a\u671f\u671b\u590d\u6742\u5ea6 $O(na^{\\frac{1}{6}})$ \u7684\u590d\u6742\u5ea6\uff1a\u5148\u628a $a^{\\frac{1}{6}}$ \u4ee5\u5185\u7684\u56e0\u6570\u9664\u53bb\u3002\u518d\u8dd1```pollard-rho```\uff0c\u56e0\u4e3a\u82e5\u5b58\u5728\u4e00\u4e2a\u4e0d\u8d85\u8fc7 $a^{\\frac{1}{3}}$ \u7684\u56e0\u5b50\uff0c```pollard-rho```\u5728\u671f\u671b\u4e0b\u80fd\u5728  $O(a^{\\frac{1}{6}})$ \u7684\u65f6\u95f4\u5185\u627e\u5230\u3002\u800c\u6211\u4eec\u8fd9\u9898\u8981\u9664\u53bb\u7684\u662f\u5e73\u65b9\u56e0\u5b50\uff0c\u4e5f\u5c31\u662f\u8981\u627e\u5230\u7c7b\u4f3c $p^2q$ \u7684\u4e1c\u897f\uff0c\u663e\u7136\u662f\u6709\u4e00\u4e2a\u4e0d\u8d85\u8fc7 $a^{\\frac{1}{3}}$ \u7684\u3002\u4f46\u8fd9\u4e2a\u4e1c\u897f\u7684\u95ee\u9898\u5728\u6211\u4eec\u4e0d\u77e5\u9053\u4f55\u65f6\u4e2d\u6b62\uff0c\u6240\u4ee5\u53ef\u80fd\u6ca1\u6709\u4ec0\u4e48\u5b9e\u9645\u610f\u4e49\uff1f\n\n",
        "postTime": 1605699865,
        "uid": 7480,
        "name": "skydogli",
        "ccfLevel": 10,
        "title": "\u3010\u5bb9\u65a5\u3011 P4448 \u3010[AHOI2018\u521d\u4e2d\u7ec4]\u7403\u7403\u7684\u6392\u5217\u3011"
    },
    {
        "content": "## P4448 [AHOI2018\u521d\u4e2d\u7ec4]\u7403\u7403\u7684\u6392\u5217 \u9898\u89e3\n\n#### upd:\u53bb\u6389\u4e86\u516c\u5f0f\u548c\u6807\u70b9\u4e4b\u95f4\u7684\u7a7a\u683c\n\n#### \u9898\u610f\u4e0d\u518d\u8d58\u8ff0\u5566\u3002\n\n[P4448 [AHOI2018\u521d\u4e2d\u7ec4]\u7403\u7403\u7684\u6392\u5217](https://www.luogu.com.cn/problem/P4448)\n\n#### \u77e5\u8bc6\u70b9\uff1a\n\n\u5bb9\u65a5\u3001\u80cc\u5305\u3001\u7ec4\u5408\u6570\n\n#### \u5bb9\u65a5\u5206\u6790\n\n\u663e\u800c\u6613\u89c1\u5730\uff0c\u8fd9\u4e2a\u9898\u9700\u8981\u8003\u8651\u5bb9\u65a5\uff0c\u6211\u4eec\u8bbe $h_i$ \u8868\u793a\u81f3\u5c11\u6709 $i$ \u5bf9\u5b8c\u5168\u5e73\u65b9\u6570\u7684\u65b9\u6848\u6570\uff0c\u8fd9\u6837\u4f1a\u53d1\u73b0\u6211\u4eec\u7684\u7b54\u6848\u5373\uff1a\n\n$$\nans=\\sum_{i=0}^{n-1}(-1)^ih_i\n$$\n\n\u6211\u4eec\u73b0\u5728\u9700\u8981\u8003\u8651\u600e\u4e48\u6c42\u51fa $h_i$\u3002\n\n#### \u95ee\u9898\u6027\u8d28\n\n\u9996\u5148\uff0c\u56e0\u4e3a $n\\leq 300$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5 $O(n^2)$ \u5730\u6c42\u51fa\u6240\u6709\u53ef\u80fd\u7ec4\u6210\u5b8c\u5168\u5e73\u65b9\u6570\u7684\u6570\u5bf9\uff0c\u4f46\u8fd9\u91cc\u6709\u4e00\u4e2a\u6027\u8d28\uff1a\u5982\u679c $a\\times b$ \u662f\u5b8c\u5168\u5e73\u65b9\u6570\u5e76\u4e14 $c\\times b$ \u4e5f\u662f\u5b8c\u5168\u5e73\u65b9\u6570\uff0c\u90a3\u4e48 $a\\times c$ \u662f\u5b8c\u5168\u5e73\u65b9\u6570\u3002\n\n\u8bc1\u660e\uff1a\u4e00\u4e2a\u6570\u5982\u679c\u662f\u5b8c\u5168\u5e73\u65b9\u6570\uff0c\u5c06\u5176\u5206\u89e3\u8d28\u56e0\u6570\u540e\u6bcf\u4e2a\u56e0\u5b50\u7684\u6b21\u6570\u90fd\u662f\u5076\u6b21\uff0c\u800c\u4e24\u6570\u76f8\u4e58\u662f\u5b8c\u5168\u5e73\u65b9\u6570\u8bf4\u660e\u4e24\u6570\u5bf9\u5e94\u56e0\u5b50\u6b21\u6570\u7684\u5947\u5076\u6027\u76f8\u540c\uff0c\u6240\u4ee5\u76f8\u4e58\u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\u8fd9\u4e2a\u5173\u7cfb\u5177\u6709\u4f20\u9012\u6027\u3002\n\n#### \u5206\u5272\u8ba8\u8bba\u8d21\u732e\n\n\u90a3\u4e48\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u5982\u679c\u6309\u7167\u8fd9\u79cd\u5173\u7cfb\u8fde\u8fb9\uff0c\u4f1a\u5f62\u6210\u82e5\u5e72\u4e2a\u8fde\u901a\u5757\uff0c\u6bcf\u4e2a\u5757\u90fd\u662f\u4e00\u4e2a\u5b8c\u5168\u56fe\uff0c\u800c\u4e14\u8fd9\u6837\u7684\u8bdd\u5404\u5757\u4e4b\u95f4\u4e0d\u4f1a\u76f8\u4e92\u5f71\u54cd\uff0c\u53ef\u4ee5\u5206\u5f00\u8003\u8651\u3002\u90a3\u6211\u4eec\u53ef\u4ee5\u8bbe $g_{i,j}$ \u8868\u793a\u5927\u5c0f\u4e3a $i$ \u7684\u5757\uff0c\u6709 $j$ \u5bf9\u5b8c\u5168\u5e73\u65b9\u6570\u7684\u65b9\u6848\u6570\u3002\n\n\u6ce8\u610f\u8fd9\u91cc\u56e0\u4e3a\u662f\u6392\u5217\uff0c\u6240\u4ee5\u8981\u628a\u4e0d\u540c\u7684\u6392\u5217\u65b9\u5f0f\u7ed9\u8003\u8651\u8fdb\u53bb\u3002\u5177\u4f53\u600e\u4e48\u6c42\u5462\uff1f\u6211\u4eec\u610f\u8bc6\u5230\u8fd9\u4e2a\u95ee\u9898\u76f8\u5f53\u4e8e\u7ed9\u4e00\u4e2a\u5757\u5185\u7684\u5143\u7d20\u5212\u5206\u6210 $i-j$ \u5757\u5e76\u4e14\u6bcf\u5757\u4e0d\u4e3a\u7a7a\uff0c\u90a3\u8fd9\u4e2a\u4e1c\u897f\u5c31\u5df2\u7ecf\u547c\u4e4b\u6b32\u51fa\u4e86\u3002\n\n\u6211\u4eec\u91c7\u7528\u9694\u677f\u6cd5\u5c06\u5176\u5206\u4e3a $j+1$ \u5757\uff0c\u5e76\u4e14\u56e0\u4e3a\u662f\u6392\u5217\uff0c\u6240\u4ee5\u8981\u4e58\u4e0a\u6392\u5217\u6570\uff0c\u5373\uff1a\n\n$$\ng_{i,j}=C_{i-1}^jA_i^j\n$$\n\n\uff08\u6211\u662f\u4e0d\u4f1a\u544a\u8bc9\u4f60\u6211\u662f\u5148\u66b4\u529b\u6253\u8868\u5f97\u51fa\u5f0f\u5b50\u518d\u53bb\u60f3\u4e3a\u4ec0\u4e48\u7684\uff09\n\n#### \u80cc\u5305\u5904\u7406\n\n\u6700\u540e\uff0c\u6211\u4eec\u80fd\u6c42\u51fa\u6bcf\u4e00\u5757\u4ea7\u751f\u82e5\u5e72\u4e0d\u5408\u6cd5\u5bf9\u7684\u65b9\u6848\u6570\uff0c\u8003\u8651\u6700\u7ec8\u5982\u4f55\u8ba1\u7b97\u7b54\u6848\uff0c\u6211\u4eec\u8981\u8ba1\u7b97\u5168\u5c40\u4ea7\u751f\u82e5\u5e72\u4e0d\u5408\u6cd5\u5bf9\u7684\u65b9\u6848\u6570\uff0c\u8fd9\u4e9b\u4e0d\u5408\u6cd5\u5bf9\u8981\u88ab\u5206\u914d\u5230\u5404\u5757\u4e2d\uff0c\u8fd9\u5c31\u5f88\u50cf\u4e00\u4e2a\u80cc\u5305\u3002\n\n\u6211\u4eec\u8bbe $f_{i,j}$ \u4e3a\u8003\u8651\u4e86\u524d $i$ \u4e2a\u5757\uff0c\u4e0d\u5408\u6cd5\u5bf9\u5171\u6709 $j$ \u4e2a\u7684\u65b9\u6848\u6570\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a $i$ \u679a\u4e3e\u4e00\u4e0b\u5f53\u524d\u5757\u7684\u8d21\u732e\uff0c\u76f4\u63a5\u8f6c\u79fb\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u8fd9\u6837\u6211\u4eec\u987a\u4fbf\u89e3\u51b3\u4e86\u7b2c\u4e00\u4e2a\u95ee\u9898\uff0c\u5373 $h_i=f_{tot,i}$\uff0c\u5176\u4e2d $tot$ \u8868\u793a\u603b\u5757\u6570\u3002\n\n\u5177\u4f53\u65b9\u7a0b\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u770b\uff0c**\u53d8\u91cf\u4ee3\u8868\u542b\u4e49\u7565\u6709\u4e0d\u540c**\n\n#### \u5b9e\u73b0\u7ec6\u8282\n\n\u4e0d\u662f\u5f88\u591a\uff0c\u56e0\u4e3a $n$ \u4e0d\u5927\uff0c\u6240\u4ee5\u8ba1\u7b97\u5404\u5757\u5927\u5c0f\u968f\u4fbf\u641e\u641e\u5c31\u53ef\u4ee5\u3002\u539f\u5e8f\u5217\u7ed9\u6211\u4eec\u552f\u4e00\u7684\u5e2e\u52a9\u5c31\u662f\u83b7\u53d6\u5404\u5757\u7684\u5927\u5c0f\uff0c\u8fd9\u4e4b\u540e\u5b83\u5c31\u6ca1\u7528\u4e86\u3002\n\n#### \u5b8c\u7ed3\u6492\u82b1 & \u8d34\u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n#define lint long long\n#define rint register int\n#define sq(x) (lint)(x*x)\nusing namespace std;\ninline lint read(){\n\tchar c;lint f=1,res=0;\n\twhile(c=getchar(),!isdigit(c))if(c=='-')f*=-1;\n\twhile(isdigit(c))res=res*10+c-'0',c=getchar();\n\treturn res*f;\n}\nconst lint N=305,md=1e9+7;\nlint a[N],n,g[N][N],f[N][N];\nlint tot,siz[N],fac[N],iv[N],ans;\n/*\nfac\u5b58\u9636\u4e58,iv\u4e3a\u5bf9\u5e94\u9636\u4e58\u9006\u5143 \ng[i][j]\u4e3a\u5927\u5c0f\u4e3ai\u7684\u5757\u6709j\u5bf9\u51b2\u7a81\u7684\u65b9\u6848\u6570 \nf[i][j]\u8868\u793a\u524di\u4e2a\u5757\u9009\u4e86j\u4e2a\u7684\u65b9\u6848\u6570\ntot\u4e3a\u5757\u6570,siz\u4e3a\u5757\u5927\u5c0f \n*/\ninline lint qpow(lint x,lint y){\n\tlint res=1;\n\twhile(y){\n\t\tif(y&1)res=res*x%md;\n\t\tx=x*x%md;y>>=1;\n\t}return res;\n}\ninline void init(){\n\tbool vis[N]={0};lint _siz[N];\n\tfor(rint i=1;i<=n;++i){\n\t\t_siz[i]=1;\n\t\tfor(rint j=i-1;j>=1;--j){\n\t\t\tif(vis[j])continue;\n\t\t\tif(sq((lint)sqrt(a[i]*a[j]))==a[i]*a[j]){\n\t\t\t\t_siz[i]+=_siz[j];\n\t\t\t\tvis[j]=true;break;\n\t\t\t}\n\t\t}\n\t}\n\tfor(rint i=1;i<=n;++i)\n\t\tif(!vis[i])siz[++tot]=_siz[i];\n\tfac[0]=1;iv[0]=1;\n\tfor(rint i=1;i<=n;++i){\n\t\tfac[i]=fac[i-1]*i%md;\n\t\tiv[i]=iv[i-1]*qpow(i,md-2)%md;\n\t}\n\tfor(rint i=1;i<=n;++i)\n\t\tfor(rint j=0;j<i;++j){\n\t\t\tg[i][j]=fac[i]*fac[i-1]%md;\n\t\t\tg[i][j]=g[i][j]*iv[i-j]%md;\n\t\t\tg[i][j]=g[i][j]*iv[j]%md;\n\t\t\tg[i][j]=g[i][j]*iv[i-j-1]%md;\n\t\t}\n}\nint main(){\n\tn=read();\n\tfor(rint i=1;i<=n;++i)\n\t\ta[i]=read();\n\tinit();\n\tf[0][0]=1;\n\tfor(rint i=1;i<=tot;++i)\n\t\tfor(rint j=0;j<siz[i];++j)\n\t\t\tfor(rint k=0;k<n;++k)\n\t\t\t\tif(k-j>=0)\n\t\t\t\t\tf[i][k]=(f[i][k]+f[i-1][k-j]*g[siz[i]][j]%md)%md;\n\tfor(rint i=0;i<n;++i)\n\t\tans=(ans+fac[n-i]*f[tot][i]*(i&1?-1:1)%md+md)%md;\n\tcout<<ans<<endl;\n\treturn 0;\n}\n\n```\n\n\n",
        "postTime": 1632647786,
        "uid": 206258,
        "name": "SDNetFriend",
        "ccfLevel": 7,
        "title": "P4448 [AHOI2018\u521d\u4e2d\u7ec4]\u7403\u7403\u7684\u6392\u5217 \u9898\u89e3"
    },
    {
        "content": "\u524d\u7f6e\u77e5\u8bc6\uff1a\n\n\u7ec4\u5408\u6570\u5b66\u80fd\u529b\n\n\u5bb9\u65a5\u539f\u7406\n\n\u9996\u5148\u6709\u4e00\u4e2a\u7b80\u5355\u7684\u7ed3\u8bba\uff0c\u5f53 $x \\times y$ \u548c $x \\times z$ \u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\u65f6\uff0c\u663e\u7136 $y \\times z$ \u4e5f\u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u7b80\u5355\u5730\u901a\u8fc7 $O(n^2)$ \u66b4\u529b\u5c06\u8fd9\u4e9b\u7403\u5206\u5757\u3002\n\u95ee\u9898\u8f6c\u5316\u4e3a\uff1a\u5df2\u77e5 $n$ \u4e2a\u7403\u5c5e\u4e8e $m$ \u4e2a\u989c\u8272\uff0c\u540c\u79cd\u989c\u8272\u5c0f\u7403\u4e0d\u80fd\u76f8\u90bb\uff0c\u95ee\u6392\u5217\u65b9\u6848\u6570\u3002\n\n\u8bbe $f(s)$ \u4e3a\u81f3\u5c11\u6709$s$\u5bf9\u540c\u8272\u5c0f\u7403\u76f8\u90bb\u65f6\u7684\u65b9\u6848\u6570\uff0c\u5219\u7531\u5bb9\u65a5\u539f\u7406\u77e5  $ans=\\sum_{i=0}^nf(i) \\times (-1)^i$\n\n\u8003\u8651\u5982\u4f55\u6c42 $f(s)$ \u524d\uff0c\u6211\u4eec\u5148\u5047\u8bbe\u6211\u4eec\u5c06\u76f8\u90bb\u76f8\u540c\u989c\u8272\u7684\u7403\u5408\u5e76\u4e3a\u4e00\u4e2a\u5757\uff0c\u8bbe $b(i)$ \u4e3a\u989c\u8272\u4e3a $i$ \u7684\u7403\u6709\u591a\u5c11\u4e2a\u5757\uff08\u4e5f\u5c31\u662f\u8bf4\u73b0\u5728\u6211\u4eec\u901a\u8fc7\u56fa\u5b9a\u6bcf\u4e00\u989c\u8272\u7684\u5757\u6570\u5f97\u5230\u4e86\u4e00\u79cd\u60c5\u51b5\uff09\uff0c\u5219\u53ef\u5f97\u5f53\u524d\u60c5\u51b5\u7684\u7b54\u6848\u4e3a\n\n$\\frac{(\\sum_{i=1}^{m}b(i))!}{\\prod_{i=1}^mb(i)!} \\cdot \\prod_{i=1}^{m}a(i)! \\cdot C_{a(i)-1}^{b(i)-1}$\n\n\u8bbe\u6709 $s$ \u5bf9\u540c\u8272\u5c0f\u7403\u76f8\u90bb\uff0c\u5219 $\\sum_{i=1}^{m}b(i)=n-s$\n\n\u4ee5\u4e24\u4e2a\u4e58\u53f7\u4e3a\u5206\u754c\u5c06\u5f0f\u5b50\u5206\u4e3a\u4e09\u6bb5\uff0c\u7b2c\u4e00\u6bb5\u4e3a $b$ \u7684\u53ef\u91cd\u6392\u5217\u6570\uff0c\u7b2c\u4e8c\u6bb5\u4e3a\u6bcf\u4e00\u989c\u8272\u5185\u5c0f\u7403\u7684\u5168\u6392\u5217\uff0c\u7b2c\u4e09\u6bb5\u4e3a\u6bcf\u4e00\u989c\u8272\u5185\u5bf9\u5c0f\u7403\u8fdb\u884c\u7684\u5206\u5757\u65b9\u6848\uff08\u9694\u677f\u6cd5\uff09\n\n\u518d\u8f6c\u6362\u4e00\u4e0b\u53ef\u4ee5\u53d8\u6210\n\n$(n-s)!\\prod_{i=1}^{m}\\frac{C_{a(i)-1}^{b(i)-1} \\cdot a(i)!}{b(i)!}$\n\n\u90a3\u4e48\u5b9e\u9645\u4e0a $f(s)$ \u5c31\u662f\u8003\u8651\u4e86\u6240\u6709\u4e0d\u540c\u7684 $b(i)$ \u5206\u914d\u65b9\u6cd5\u7684\u603b\u7b54\u6848\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5c06\u4e0a\u5f0f\u540e\u9762\u8fd9\u4e00\u5768\u6240\u6709\u7684 $b(i)$ \u60c5\u51b5\u6240\u5f97\u5230\u7684\u7ed3\u679c\u76f8\u52a0\u518d\u4e58\u4ee5 $(n-s)!$ \u5c31\u5f97\u5230\u4e86 $f(s)$\n\n\u5047\u8bbe\u603b\u5171\u5206\u6210\u4e86 $n-s$ \u4e2a\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e9b\u5757\u5206\u914d\u5230\u4e0d\u540c\u7684\u989c\u8272\u4e2d\u53bb\uff0c\u5176\u5b9e\u4e5f\u5c31\u662f\u4e00\u4e2aDP\u3002\n\n\u8bbe $H=\\prod_{i=1}^{m}\\frac{C_{a(i)-1}^{b(i)-1} \\cdot a(i)!}{b(i)!}$\n\u5219\u6211\u4eec\u8981\u6c42 $\\sum H$\n\n\u6211\u4eec\u8bbe $g[i][j]$ \u8868\u793a\u8003\u8651\u4e86\u524d $i$ \u79cd\u989c\u8272\uff0c\u81f3\u5c11\u6709 $j$ \u4e2a\u5757\u65f6\uff0c\u4e0d\u540c $b(i)$ \u6240\u5f97\u5230\u7684 $H$ \u7684\u548c\uff0c\u5373 $\\sum H$\n\n\u72b6\u6001\u65b9\u7a0b\u662f\u663e\u7136\u7684\n\n$g[i][j]=\\sum_{k=1}^{min(a(i),j)}g[i-1][j-k] \\cdot \\frac{C_{a(i)-1}^{k-1} \\cdot a(i)!}{k!}$\n\n\u4e8e\u662f\u6700\u7ec8\u7b54\u6848\u4fbf\u662f\n$\\sum_{s=0}^{n-1}g[m][n-s] \\cdot (n-s)! \\cdot (-1)^s$\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\n\nCode:\n\n```cpp\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<cmath>\n#include<iostream>\n#include<iomanip>\n#include<algorithm>\n#define ll long long\nusing namespace std;\nconst ll INF=1e9+7;\nconst ll mod=1e9+7;\nconst ll maxn=305;\ninline ll read()\n{\n\tll x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9')\n\t{\n\t\tif(c=='-') f=-1;\n\t\tc=getchar();\n\t}\n\twhile(c>='0'&&c<='9')\n\t{\n\t\tx=x*10+(c-'0');\n\t\tc=getchar();\n\t}\n\treturn x*f;\n}\nll g[maxn][maxn];\nll n;\nll d[maxn],siz[maxn],vis[maxn],a[maxn],b[maxn],tot;\nll fac[maxn],C[maxn][maxn],inv[maxn],ans;\ninline ll quickpow(ll x,ll tim)\n{\n\tll res=1;\n\twhile(tim)\n\t{\n\t\tif(tim&1) res=res*x%mod;\n\t\tx=x*x%mod;\n\t\ttim>>=1;\n\t}\n\treturn res%mod;\n}\ninline void init()\n{\n\tfac[0]=1;C[0][0]=1;\n\tfor(ll i=1;i<=300;i++) fac[i]=fac[i-1]*i%mod;\n\tfor(ll i=1;i<=300;i++)\n\t{\n\t\tC[i][0]=1;C[i][i]=1;\n\t\tfor(ll j=1;j<i;j++) C[i][j]=(C[i-1][j]+C[i-1][j-1])%mod;\n\t}\n\tinv[300]=quickpow(fac[300],mod-2);\n\tfor(ll i=299;i>=0;i--) inv[i]=inv[i+1]*(i+1)%mod;\n}\nint main()\n{\n\tinit();\n\tn=read();\n\tfor(ll i=1;i<=n;i++) d[i]=read(),siz[i]=1;\n\tfor(ll i=1;i<=n;i++)\n\t{\n\t\tfor(ll j=i-1;j>=1;j--)\n\t\t{\n\t\t\tif(vis[j]) continue;\n\t\t\tif((ll)sqrt(d[i]*d[j])*(ll)sqrt(d[i]*d[j])==d[i]*d[j])\n\t\t\t{\n\t\t\t\tvis[j]=1;\n\t\t\t\tsiz[i]+=siz[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tfor(ll i=1;i<=n;i++)\n\t{\n\t\tif(!vis[i])\n\t\t{\n\t\t\ta[++tot]=siz[i];\n\t\t}\n\t}\n\tg[0][0]=1;\n\tfor(ll i=1;i<=tot;i++)\n\t{\n\t\tfor(ll j=1;j<=n;j++)\n\t\t{\n\t\t\tll len=min(a[i],j);\n\t\t\tfor(ll k=1;k<=len;k++)\n\t\t\t{\n\t\t\t\tg[i][j]=(g[i][j]+g[i-1][j-k]*C[a[i]-1][k-1]%mod*fac[a[i]]%mod*inv[k]%mod)%mod;\n\t\t\t}\n\t\t}\n\t}\n\tfor(ll i=0;i<n;i++)\n\t{\n\t\tll flag=(i%2)?-1:1;\n\t\tans+=g[tot][n-i]*fac[n-i]%mod*flag;\n\t\tans%=mod;\n\t}\n\tans=(ans+mod)%mod;\n\tcout<<ans<<endl;\n\treturn 0;\n} \n```\n",
        "postTime": 1643011452,
        "uid": 182738,
        "name": "ZBHRuaRua",
        "ccfLevel": 6,
        "title": "P4448 \u7403\u7403\u7684\u6392\u5217"
    },
    {
        "content": "## Introduction\n\n\u4e3e\u62a5 $ \\text{AHOI} $ \u6284\u88ad $ \\text{CF} $\u3002\n\n## Solution\n\n\u5982\u679c $ a_i $ \u662f\u5f62\u5982 $ \\prod_{i=1}^{n}{b_i}^{p_i} $\uff0c\u5176\u4e2d $ b_i $ \u662f\u8d28\u6570\uff0c\u90a3\u4e48\u5982\u679c $ p_i\\ge 2 $\uff0c\u90a3\u4e48 $ p_i $ \u53ef\u4ee5\u51cf $ 2 $\uff0c\u56e0\u4e3a\u4ed6\u4e0d\u4f1a\u5f71\u54cd\u6700\u7ec8\u7ed3\u679c\uff0c\u7136\u540e\u95ee\u9898\u5c31\u8f6c\u6362\u6210\u4e86\u4e00\u4e2a\u7ecf\u5178\u9898\u578b\uff0c\u6c42\u6709\u591a\u5c11\u4e2a\u6392\u5217\u6ee1\u8db3 $ a_{pi}\\not=a_{p_{i-1}} $\uff0c\u7528 $ \\text{DP} $ \u89e3\u51b3\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u9694\u677f\u6cd5\u7684\u601d\u60f3\uff0c\u5047\u8bbe $ f[i][j] $ \u8868\u793a\u622a\u6b62\u5230\u524d $ i $ \u4e2a\u4e0d\u540c\u7684\u6570\uff0c\u6709 $ j $ \u4e2a\u4e0d\u5408\u6cd5\u7684\u7a7a\u4f4d\uff0c\u6700\u7ec8\u7b54\u6848\u4e3a $ f[len][0] $\uff0c\u5176\u4e2d $ len $ \u4e3a\u4e0d\u540c\u7684\u6570\u7684\u4e2a\u6570\u3002\n\n\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u65b0\u52a0\u8fdb\u6765 $ fre $ \u4e2a\u76f8\u540c\u7684\u6570\uff0c\u524d\u9762\u603b\u5171\u6709 $ sum $ \u4e2a\u6570\uff0c\u90a3\u4e48\u603b\u5171\u6709 $ sum+1 $ \u4e2a\u7a7a\u4f4d\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u7684\u6709\uff1a\n\n$ lst1 $ \u8868\u793a\u524d\u9762\u4e0d\u5408\u6cd5\u7684\u7a7a\u4f4d\u7684\u6570\u91cf\u3002\n\n$ now $ \u8868\u793a\u5f53\u524d\u8fd9 $ fre $ \u4e2a\u6570\u4f1a\u62b5\u6d88\u591a\u5c11\u4e2a\u4e0d\u5408\u6cd5\u7684\u7a7a\u4f4d\u3002\n\n$ add $ \u8868\u793a\u5f53\u524d\u8fd9 $ fre $ \u4e2a\u6570\u4f1a\u589e\u52a0\u51e0\u4e2a\u4e0d\u5408\u6cd5\u7684\u7a7a\u4f4d\u3002\n\n\u73b0\u5728\u6211\u4eec\u8fd8\u8981\u8003\u8651\u7684\u662f\u5982\u679c\u589e\u52a0\u4e86 $ add $ \u4e2a\u4e0d\u5408\u6cd5\u7684\u7a7a\u4f4d\u4f1a\u5bf9\u8fd9\u65b0\u52a0\u8fdb\u6765\u7684 $ fre $ \u7684\u6570\u4ea7\u751f\u4ec0\u4e48\u5f71\u54cd\uff0c\u6211\u4eec\u5047\u8bbe\u4f1a\u5206\u6210 $ x $ \u6bb5\uff0c\u90a3\u4e48 $ \\sum_{i=1}^x len[x]-1=add $\uff0c\u5c31\u662f $ fre-x=add $\uff0c\u5c31\u662f $ x=fre-add $,\u5c31\u662f\u5982\u679c\u6211\u4eec\u8981\u589e\u52a0 $ add $ \u4e2a\u7a7a\u4f4d\u52bf\u5fc5\u8981\u5206\u6210 $ fre-add $ \u6bb5\uff0c\u800c\u6211\u4eec\u53d1\u73b0\u5982\u679c\u679a\u4e3e\u6709\u591a\u5c11\u4e2a\u7a7a\u4f4d\u4e0d\u597d\u505a\uff0c\u6211\u4eec\u8003\u8651\u679a\u4e3e\u5206\u6210\u51e0\u6bb5\u3002\n\n\u90a3\u4e48\u6709\u5982\u4e0b\u8f6c\u79fb\uff1a\n$$\nf[i][lst1-now+fre-x]+=f[i-1][lst]\\times C(fre-1,fre-x)\\times C(lst1,now)\\times C(sum+1-lst1,x-now)\n$$\n\u7406\u8bba\u4e0a\u4f1a $ \\text{T} $\uff0c\u4f46\u5b9e\u9645\u4e0d\u77e5\u9053\uff0c\u5f85\u6211\u5199\u5b8c\u518d\u8bf4\u3002\n\n## Code\n\n```c++\n#include <bits/stdc++.h>\nusing namespace std;\nlong long len,MOD,lsh[1001010],fac[1001010],sum,dif,lst1,x,c[1010][1010],up,fre[100101],f[1010][1010],a[100100],n,i,j,now,ans;\nint main() {\n    ios::sync_with_stdio(0);cin.tie();cout.tie();\n    cin>>n;MOD=1e9+7;\n    for (i=1;i<=n;i++) \n         {\n         \tcin>>a[i];\n         \tfor (j=2,up=sqrt(a[i]);j<=up;j++)\n         \t     while (a[i] % (j*j)==0) \n         \t          a[i]/=(j*j);\n         \tlsh[i]=a[i];\n\t\t }\n\tc[0][0]=1;fac[0]=1;\n\tfor (i=1;i<=500;i++)\n\t    {\n\t    \tc[i][0]=1;c[i][i]=1;\n\t    \tfor (j=1;j<i;j++)\n\t    \t   c[i][j]=(c[i-1][j-1]+c[i-1][j]) % MOD;\n\t    \tfac[i]=fac[i-1]*i % MOD;\n\t\t}\n\tsort(lsh+1,lsh+n+1);len=unique(lsh+1,lsh+n+1)-lsh-1;\n\tfor (i=1;i<=n;i++) a[i]=lower_bound(lsh+1,lsh+len+1,a[i])-lsh,fre[a[i]]++;\n\tf[1][fre[1]-1]=1;sum=fre[1];\n\tfor (i=1,dif=1;i<=len;i++) dif=dif*fac[fre[i]] % MOD;\n\tfor (i=2;i<=len;sum+=fre[i],i++)\n\t   for (lst1=0;lst1<=sum+1;lst1++)\n\t        if (f[i-1][lst1]!=0)\n\t            for (x=1;x<=fre[i];x++)\n\t                for (now=0;now<=min(lst1,x);now++)\n\t                    { \n\t                    f[i][lst1-now+fre[i]-x]+=f[i-1][lst1]*c[fre[i]-1][fre[i]-x] % MOD*c[lst1][now] % MOD*c[sum+1-lst1][x-now] % MOD;\n\t                    f[i][lst1-now+fre[i]-x]%=MOD;\n\t\t\t\t\t\t}\n    cout<<f[len][0]*dif % MOD<<endl;\n\treturn 0;\n}\n\n```\n\n",
        "postTime": 1632806249,
        "uid": 77615,
        "name": "OIerAlbedo",
        "ccfLevel": 0,
        "title": "P4448"
    },
    {
        "content": "\u5b66\u6821\u6a21\u62df\u8d5b\u7684\u9898\uff0c\u8d5b\u573a\u4e0a\u79d2\u4e86\uff0c\u540e\u6765\u540c\u673a\u623f\u7684\u540c\u5b66\u770b\u9898\u89e3\u53d1\u73b0\u597d\u50cf\u6ca1\u6211\u7684\u505a\u6cd5\u6240\u4ee5\u6765\u5199\u4e00\u4e0b\u3002\n\n\u6700\u666e\u901a\u7684\u52a8\u6001\u89c4\u5212\uff0c\u4e0d\u7528\u5bb9\u65a5\uff0c\u7ec4\u5408\u6570\uff0c\u751f\u6210\u51fd\u6570\u4ec0\u4e48\u7684\uff0c\u77e5\u9053\u4ec0\u4e48\u53eb\u52a8\u6001\u89c4\u5212\u5c31\u80fd\u505a\u51fa\u6765\u3002\n\n**\u9898\u610f\uff1a\u4e00\u4e2a\u5e8f\u5217 $a$ \uff0c\u5c06\u8fd9\u4e2a\u5e8f\u5217\u968f\u673a\u6392\u5217\uff0c\u95ee\u6709\u591a\u5c11\u4e2a\u6392\u5217\u6ee1\u8db3\u5bf9\u4e8e\u4efb\u610f\u7684 $i$ \uff0c\u6ee1\u8db3 $a_i \\times a_{i+1}$ \u90fd\u4e0d\u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\u3002**\n\n\u4e00\u4e2a\u5c0f\u5c0f\u7684\u5b9a\u7406\uff1a\u5982\u679c $a \\times b$ \u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\uff0c $b \\times c$ \u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\uff0c\u90a3\u4e48 $a \\times c$ \u4e00\u5b9a\u4e5f\u4e3a\u5b8c\u5168\u5e73\u65b9\u6570\u3002\n\n\u8bc1\u660e\uff1a\u8bbe $a \\times b = p^2$ , $b \\times c = q^2$ , \u90a3\u4e48 $a \\times b \\times b \\times c = p^2 \\times q^2$ \uff0c \u90a3\u4e48 $a \\times c =\\frac{p^2 \\times q^2}{b^2}=(\\frac{pq}{b})^2$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e9b\u6570\u5206\u6210\u82e5\u5e72\u7ec4\uff0c\u7528\u4e00\u4e2a**\u5e76\u67e5\u96c6**\u7ef4\u62a4\u5373\u53ef\u3002\n\n### upd on 20211014: \u7ecf\u540c\u5b66\u63d0\u9192\uff0c\u5e76\u4e0d\u9700\u8981\u5e76\u67e5\u96c6\uff0c\u66b4\u529b\u7ef4\u62a4\u5373\u53ef\n\n\u8003\u8651\u5bf9\u6bcf\u4e00\u7ec4\u4e00\u4e2a\u4e2a\u6570\u8fdb\u884c\u8003\u8651\uff0c\u8bbe $f_{i,j,k}$ \uff0c\u72b6\u6001\u7684\u610f\u4e49\u5982\u4e0b\uff1a\n\n$i$ \uff1a \u679a\u4e3e\u5230\u7b2c $i$ \u4e2a\u6570\u3002\n\n\u5728\u4ecb\u7ecd $j$ \u548c $k$ \u7684\u5b9a\u4e49\u524d\uff0c\u4e3a\u9632\u6b62\u8fc7\u4e8e\u7ed5\u53e3\uff0c\u5148\u8fdb\u884c\u4e00\u5b9a\u7684\u5b9a\u4e49\u3002\n\n\u968f\u4fbf\u5217\u4e00\u4e2a\u6392\u5217\uff0c\u6bd4\u5982 2 2 2 3 2 \uff08\u8fd9\u91cc\u7684\u6570\u4e3a\u6240\u5c5e\u7684\u7ec4\u6570\uff09\uff0c\u90a3\u4e48\u524d\u4e09\u4e2a 2 \u662f\u4e0d\u5408\u6cd5\u7684\uff0c\u56e0\u4e3a\u5b83\u4eec\u4e4b\u95f4\u8fd8\u6709 2 \u4e2a\u7a7a\u9700\u8981\u63d2\u6570\u8fdb\u53bb\uff0c\u6211\u4eec\u79f0\u8fd9\u79cd\u540e\u9762\u5fc5\u987b\u8fd8\u8981\u63d2\u6570\u8fdb\u53bb\u7684\u7a7a\u4e3a\u5f53\u524d\u6392\u5217\u7684\u4e0d\u5408\u6cd5\u7a7a\u6570\u3002\n\n**\u5047\u8bbe\u73b0\u5728\u679a\u4e3e\u7684\u7b2c $i$ \u4e2a\u6570\uff0c\u4e3a\u7b2c $p$ \u7ec4\u7684\u7b2c $q$ \u4e2a\u6570\uff0c\u8fd9\u53e5\u8bdd\u5728\u4e0b\u9762\u90fd\u901a\u7528\u3002**\n\n$j$ \uff1a \u5728\u63d2\u5165\u4e86\u524d $p-1$ \u7ec4\u6570\u548c\u7b2c $p$ \u7ec4\u7684\u524d $q-1$ \u4e2a\u6570\u4e4b\u540e\uff0c\u524d $p-1$ \u7ec4\u7684\u6570\u4e4b\u95f4\u8fd8\u6709 $j$ \u4e2a\u4e0d\u5408\u6cd5\u7a7a\u6570\u3002\n\n$k$ \uff1a \u5728\u63d2\u5165\u4e86\u524d $p-1$ \u7ec4\u6570\u548c\u7b2c $p$ \u7ec4\u7684\u524d $q-1$ \u4e2a\u6570\u4e4b\u540e\uff0c\u7b2c $p$ \u7ec4\u7684\u524d $q-1$ \u4e2a\u6570\u4e4b\u95f4\u8fd8\u6709 $k$ \u4e2a\u4e0d\u5408\u6cd5\u7a7a\u6570\u3002\n\n\u90a3\u4e48 $f_{i,j,k}$ \u8868\u793a\u7684\u5c31\u662f\u8fd9\u79cd\u72b6\u6001\u4e0b\u7684\u65b9\u6848\u6570\uff0c\u5219\u76ee\u6807\u72b6\u6001\u5373\u7b54\u6848\u4e3a $f_{n,0,0}$ \uff0c\u8003\u8651\u8f6c\u79fb\uff0c\u5206\u7c7b\u8ba8\u8bba\u3002\n\n**\u7b2c\u4e00\u79cd\u60c5\u51b5**\n\n**\u63d2\u5165\u7684\u7b2c $i$ \u4e2a\u6570\u5bf9 $j$ \u548c $k$ \u6beb\u65e0\u5f71\u54cd\u3002**\n\n\u5219\u4ece $f_{i-1,j,k}$ \u8f6c\u79fb\u81f3 $f_{i,j,k}$ \uff0c\u8003\u8651\u7b2c $i$ \u4e2a\u6570\u53ef\u9009\u7684\u7a7a\u6570\u3002\n\n\u7531\u4e8e\u524d\u9762\u5df2\u7ecf\u63d2\u5165\u4e86 $i-1$ \u4e2a\u6570\uff0c\u90a3\u4e48\u4e00\u5171\u6709 $i$ \u4e2a\u7a7a\u53ef\u9009\u3002\n\n\u56e0\u4e3a\u6beb\u65e0\u5f71\u54cd\uff0c\u6211\u4eec\u8003\u8651\u51cf\u53bb\u4f1a\u5bf9 $j$ \u548c $k$ \u9020\u6210\u5f71\u54cd\u7684\u7a7a\u6570\u3002\n\n\u5bf9 $j$ \u9020\u6210\u5f71\u54cd\u7684\u7a7a\u6570\uff1a \u5c31\u662f $j$ \u4e2a\u7a7a\u3002\n\n\u5bf9 $k$ \u9020\u6210\u5f71\u54cd\u7684\u7a7a\u6570\uff1a \u56e0\u4e3a\u8fd9\u7ec4\u5df2\u7ecf\u9009\u4e86 $q-1$ \u4e2a\u6570\uff0c\u6bcf\u4e2a\u6570\u90fd\u6709\u5de6\u53f3\u4e24\u8fb9\u3002\u4e0d\u96be\u53d1\u73b0 $k$ \u5c31\u662f\u8fd9 $q-1$ \u4e2a\u6570\u4e2d\u5de6\u53f3\u91cd\u590d\u7684\u90e8\u5206\uff08\u4e0d\u7406\u89e3\u7684\u53ef\u4ee5\u81ea\u5df1\u624b\u753b\u51e0\u4e2a\u60c5\u51b5\u89c2\u5bdf\u4e00\u4e0b\uff09\uff0c\u6240\u4ee5\u5bf9 $k$ \u9020\u6210\u5f71\u54cd\u7684\u7a7a\u6570\u4e3a\uff1a $2\\times(q-1)-k$ \u4e2a\u7a7a\u3002\n\n\u6240\u4ee5 $i$ \u53ef\u9009\u7684\u7a7a\u6570\u4e3a $i-j-2\\times(q-1)+k$ \u4e2a\u7a7a\u3002\n\n\u6240\u4ee5\u7b2c\u4e00\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u4e3a $f_{i,j,k}=f_{i-1,j,k}\\times(i-j-2\\times(q-1)+k)$ \u3002\n\n**\u7b2c\u4e8c\u79cd\u60c5\u51b5**\n\n**\u63d2\u5165\u7684\u7b2c $i$ \u4e2a\u6570\u5bf9 $j$ \u9020\u6210\u5f71\u54cd\uff0c\u4e5f\u5c31\u662f\u63d2\u5165 $i$ \u540e\u4f7f\u5f97\u524d $p-1$ \u7ec4\u6570\u4e4b\u95f4\u7684\u4e0d\u5408\u6cd5\u7a7a\u6570\u51cf\u5c11\u4e86\u4e00\u4e2a\u3002**\n\n\u5219\u4ece $f_{i-1,j+1,k}$ \u8f6c\u79fb\u81f3 $f_{i,j,k}$ \uff0c\u5f88\u660e\u663e\uff0c\u7b2c $i$ \u4e2a\u6570\u53ef\u9009\u7684\u7a7a\u6570\u5c31\u662f $j+1$ \u4e2a\u7a7a\u3002\n\n\u6240\u4ee5\u7b2c\u4e8c\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u4e3a $f_{i,j,k}=f_{i-1,j+1,k}\\times(j+1)$ \u3002\n\n**\u7b2c\u4e09\u79cd\u60c5\u51b5**\n\n**\u63d2\u5165\u7684\u7b2c $i$ \u4e2a\u6570\u5bf9 $k$ \u9020\u6210\u5f71\u54cd\uff0c\u4e5f\u5c31\u662f\u63d2\u5165 $i$ \u540e\u4f7f\u5f97\u7b2c $p$ \u7ec4\u6570\u4e4b\u95f4\u7684\u4e0d\u5408\u6cd5\u7a7a\u6570\u591a\u4e86\u4e00\u4e2a\u3002**\n\n\u5219\u4ece $f_{i-1,j,k-1}$ \u8f6c\u79fb\u81f3 $f_{i,j,k}$ \uff0c\u4e0e\u7b2c\u4e00\u79cd\u60c5\u51b5\u63a8\u7684\u5bf9 $k$ \u9020\u6210\u5f71\u54cd\u7684\u7a7a\u6570\u4e00\u81f4\uff0c\u4e3a $2\\times(q-1)-k$ \u4e2a\u3002\n\n\u6240\u4ee5\u7b2c\u4e09\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u4e3a $f_{i,j,k}=f_{i-1,j,k-1}\\times (2\\times(q-1)-k)$ \u3002\n\n**\u672b\u5c3e\u5904\u7406**\n\n\u8fd9\u6837\u8f6c\u79fb\u8981\u5206\u7ec4\u8fdb\u884c\u8f6c\u79fb\u3002\u6bcf\u5f04\u5b8c\u4e00\u7ec4\u540e\u8981\u5c06 $f_{i,j,k}$ \u66f4\u65b0\u81f3 $f_{i,j+k,0}$ \uff0c\u56e0\u4e3a\u4e0a\u4e00\u7ec4\u7ed3\u675f\u540e\uff0c\u5b83\u7684 $k$ \u76f8\u5bf9\u4e8e\u4e0b\u4e00\u7ec4\u5c31\u662f $j$ \u4e86\u3002\n\n**\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^3)$ \uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^3)$ \uff0c\u4f46\u662f\u53ef\u4ee5\u628a\u7b2c\u4e00\u7ef4\u7684 $i$ \u6eda\u52a8\u6570\u7ec4\u6eda\u6389\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u4e3a $O(n^2)$**\n\n\u4e00\u4e9b\u5b9e\u73b0\u7ec6\u8282\u89c1\u4ee3\u7801\u6ce8\u91ca\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<cmath>\nconst int N=320;\nconst int Mod=1e9+7;\nint f[N][N],g[N][N],fa[N],siz[N],tot,num[N],n,cnt[N],ss; //f\u548cg\u6eda\u52a8\u6570\u7ec4\ninline int Read(){\n    char ch;\n    while((ch=getchar())<'0'||ch>'9');\n    int x=ch^48;\n    while((ch=getchar())>='0'&&ch<='9')\n        x=(x<<3)+(x<<1)+(ch^48);\n    return x;\n}\ninline int Find(const int x){\n    return fa[x]==x?x:fa[x]=Find(fa[x]);\n}\ninline void Init(){\n    n=Read();\n    for(register int i=1;i<=n;i++){\n        num[i]=Read();\n        fa[i]=i;\n        siz[i]=1;\n    }\n    for(register int i=1;i<n;i++)\n        for(register int j=i+1;j<=n;j++){\n            int sqr=sqrt(1ll*num[i]*num[j]);\n            if(1ll*sqr*sqr!=1ll*num[i]*num[j]) continue ;\n            int fi=Find(i),fj=Find(j);\n            if(fi==fj) continue ;\n            fa[fi]=fj;\n            siz[fj]+=siz[fi]; //\u5e76\u67e5\u96c6\u7ef4\u62a4\u6bcf\u7ec4\u7684\u96c6\u5408\u5927\u5c0f\n        }\n    for(register int i=1;i<=n;i++){\n        if(Find(i)!=i) continue ;\n        cnt[++tot]=siz[i];\n    }\n    return ;\n}\ninline void Solve(){\n    g[0][0]=1;\n    for(register int i=1;i<=tot;i++){ //\u7b2ci\u7ec4\n        for(register int p=1;p<=cnt[i];p++){ //\u7b2cp\u4e2a\u6570\n            ss++; //ss\u5c31\u662f\u5f53\u524d\u6570\u5728\u6574\u4e2a\u5e8f\u5217\u4e2d\u4e3a\u679a\u4e3e\u5230\u7684\u7b2ci\u4e2a\u6570\n            memset(f,0,sizeof(f)); //\u7531\n            for(register int j=0;j<=ss;j++)\n                for(register int k=0;k<=p;k++){\n                    if(ss-j-2*(p-1)+k>=0) f[j][k]=(f[j][k]+1ll*g[j][k]*(ss-j-2*(p-1)+k)%Mod)%Mod;\n                    if(k>=1&&2*(p-1)-k+1>=0) f[j][k]=(f[j][k]+1ll*g[j][k-1]*(2*(p-1)-k+1)%Mod)%Mod;\n                    f[j][k]=(f[j][k]+1ll*g[j+1][k]*(j+1)%Mod)%Mod; //\u8fd9\u4e0a\u9762\u90fd\u662f\u63d0\u5230\u7684\u8f6c\u79fb\n                }\n            memset(g,0,sizeof(g));\n            for(register int j=0;j<=ss;j++)\n                for(register int k=0;k<=p;k++)\n                    g[j][k]=f[j][k];  //\u6eda\u52a8\u6570\u7ec4\n        }\n        memset(g,0,sizeof(g));\n        for(register int j=0;j<=ss;j++)\n            for(register int k=0;k<=cnt[i];k++)\n                if(j+k<=n) g[j+k][0]=(g[j+k][0]+f[j][k])%Mod; \n                //\u6bcf\u5f04\u5b8c\u4e00\u7ec4\u540e\u7684\u7279\u6b8a\u5904\u7406\n    }\n    printf(\"%d\\n\",f[0][0]); \n    return ;\n}\nint main(){\n    Init();\n    Solve();\n    return 0;\n}\n```\n\n**\u5b8c\u7ed3\u6492\u82b1**",
        "postTime": 1634129349,
        "uid": 115936,
        "name": "\u6cf7\u6cfd\u4e09\u6708",
        "ccfLevel": 0,
        "title": "\u7403\u7403\u7684\u6392\u5217\u9898\u89e3"
    },
    {
        "content": "\u5c06\u6bcf\u4e2a\u6570\u7684\u5e73\u65b9\u56e0\u5b50\u9664\u6389\uff0c\u539f\u9898\u5373\u4efb\u610f\u6392\u5217\u4e00\u4e9b\u7403\u4f7f\u540c\u8272\u7403\u4e0d\u76f8\u90bb\u3002\n\n\u5c1d\u8bd5\u6309\u989c\u8272\u6392\u5e8f\u540e\u4f9d\u6b21\u653e\u5165 DP\u3002\u5b9a\u4e49\u4e0d\u5408\u6cd5\u7a7a\u9699\u4e3a\u76f8\u90bb\u4e24\u4e2a\u540c\u8272\u7403\u4e4b\u95f4\u7684\u7a7a\u9699\uff1b\u4e0d\u5408\u6cd5\u7a7a\u9699\u7684\u989c\u8272\u4e3a\u4e24\u4e2a\u540c\u8272\u7403\u7684\u989c\u8272\u3002\u82e5\u4e00\u4e2a\u7403\u653e\u5165\u4e0e\u5176\u540c\u8272\u7684\u4e0d\u5408\u6cd5\u7a7a\u9699\uff0c\u5219\u4f1a\u65b0\u589e\u4e00\u4e2a\u4e0d\u5408\u6cd5\u7a7a\u9699\uff1b\u82e5\u653e\u5165\u4e0e\u5176\u5f02\u8272\u7684\u4e0d\u5408\u6cd5\u7a7a\u9699\uff0c\u5219\u4f1a\u51cf\u5c11\u4e00\u4e2a\u4e0d\u5408\u6cd5\u7a7a\u9699\u3002\n\n\u56e0\u6b64\uff0c\u8bbe $f_x(i,j)$ \u8868\u793a\u5f53\u524d\u6b63\u5728\u653e\u5165\u7b2c $x$ \u4e2a\u7403\uff0c\u6b64\u65f6\u5e8f\u5217\u4e2d\u6709 $i$ \u4e2a\u5f02\u8272\u4e0d\u5408\u6cd5\u7a7a\u9699\uff0c$j$ \u4e2a\u540c\u8272\u4e0d\u5408\u6cd5\u7a7a\u9699\u3002\n\n\u8bb0 $x$ \u524d\u9762\u6709 $q$ \u4e2a\u4e0e $x$ \u540c\u8272\u7684\u7403\uff0c\u5219\u6709\u4ee5\u4e0b\u8f6c\u79fb\uff1a\n\n- \u6d88\u9664\u4e00\u4e2a\u5f02\u8272\u4e0d\u5408\u6cd5\u7a7a\u9699\uff1a$g(i-1,j)\\gets i \\cdot f(i,j)$\u3002\n- \u65b0\u589e\u4e00\u4e2a\u540c\u8272\u4e0d\u5408\u6cd5\u7a7a\u9699\uff1a\u4e00\u6bb5\u540c\u8272\u4e0d\u5408\u6cd5\u7a7a\u9699\u7684\u5de6\u53f3\u4e24\u4fa7\u4e5f\u53ef\u4ee5\u63d2\u5165\u3002\u53ef\u63d2\u7684\u7a7a\u6570\u4e3a $j+2(q-j)=2q-j$\uff1a$g(i,j+1)\\gets (2q-j)f(i,j)$\u3002\n- \u653e\u5728\u5408\u6cd5\u7a7a\u9699\u5185\u3002\u51cf\u53bb\u4ee5\u4e0a\u4e24\u8005\uff1a$g(i,j) \\gets (x - (2q - j) - i)f(i,j)$\u3002\n\n```cpp\nconst int N = 305;\nconst ll P = 1000000007;\n\nint n, a[N];\nmap<int, int> col;\n\nll f[N][N]; // \u6709 i \u4e2a\u975e a_x \u7684\u540c\u8272\u5bf9\uff0cj \u4e2a a_x \u7684\u540c\u8272\u5bf9\n \nint main() {\n\trd(n); if (n == 1) return puts(\"1\") & 0;\n\t\n\tU (i, 1, n) {\n\t\trd(a[i]);\n\t\tD (t, sqrt(a[i]), 1) if (!(a[i] % (t * t))) {\n\t\t\ta[i] /= t * t;\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tsort(a + 1, a + n + 1);\n\tf[0][0] = 1;\n\tint q = 0;\n\tU (x, 1, n) {\n\t\tll g[N][N] {};\n\t\tU (i, 0, x) U (j, 0, x) {\n\t\t\tif (i)\n\t\t\t\t(g[i - 1][j] += ll(i) * f[i][j]) %= P;\n\t\t\t\t\n\t\t\t(g[i][j + 1] += ll(2 * q - j) * f[i][j]) %= P;\n\t\t\t(g[i][j] += ll(x - (2 * q - j) - i) * f[i][j]) %= P;\n\t\t}\n\t\t++q;\n\t\t\n\t\tif (x == n || a[x] != a[x + 1]) {\n\t\t\tms(f, 0);\n\t\t\tU (i, 0, x) U (j, 0, x) if (g[i][j])\n\t\t\t\t(f[i + j][0] += g[i][j]) %= P;\n\t\t\tq = 0;\n\t\t} else {\n\t\t\tswap(f, g);\n\t\t}\n\t}\n\t\n\tprintf(\"%lld\", f[0][0]);\n}\n```",
        "postTime": 1675497960,
        "uid": 120324,
        "name": "Yansuan_HCl",
        "ccfLevel": 7,
        "title": "[\u9898\u89e3] [AHOI2018\u521d\u4e2d\u7ec4]\u7403\u7403\u7684\u6392\u5217"
    },
    {
        "content": "\u9898\u610f\uff1an\u4e2a\u5143\u7d20\u5206\u4e3am\u7c7b\uff0c\u6c42\u6709\u591a\u5c11\u5408\u6cd5\u6392\u5217\uff0c\u5408\u6cd5\u7684\u5b9a\u4e49\u662f\u76f8\u90bb\u5143\u7d20\u4e0d\u80fd\u4e3a\u540c\u7c7b\u5143\u7d20\uff0c$n\\leq 5\\times10^3$\n\nXSY 3156 : \u989d\u5916\u9644\u52a0\u4e86\u7b2c\u4e00\u4e2a\u5143\u7d20\u548c\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u662f\u76f8\u90bb\u7684\u6761\u4ef6\u3002\n\n#### Markdown \u5d29\u4e86 \u5efa\u8bae\u535a\u5ba2\u67e5\u770b\u3002\u3002\nhttps://www.luogu.org/blog/ComeIntoCalm/solution-p4448#\n\nsol\uff1a\n\n\u8003\u8651\u5bb9\u65a5\uff0c\u4e8e\u662f\u53d8\u6210\u6c42\u4e0d\u5408\u6cd5\u7684\u60c5\u51b5\u5373\u81f3\u5c11\u6709$s$\u4e2a\u540c\u79cd\u5143\u7d20\u6784\u6210\u7684\u90e8\u5206\uff0c\u6211\u4eec\u8003\u8651\u5982\u4f55\u5bf9\u6574\u4e2a\u5e8f\u5217\u8fdb\u884c\u8ba1\u6570\uff0c\u5047\u5b9a\u6bcf\u79cd\u5143\u7d20\u6709$a_i$\u4e2a\uff0c\u628a\u76f8\u90bb\u7684\u76f8\u540c\u79cd\u7c7b\u7684\u5143\u7d20\u5408\u5e76\u4e3a\u4e00\u4e2a\u65b0\u5143\u7d20\uff0c\u6bcf\u79cd\u5143\u7d20\u7684\u65b0\u5143\u7d20\u6570\u91cf\u6682\u65f6\u5b9a\u4e49\u4e3a$b_i$\uff0c\u8003\u8651\u65b0\u5143\u7d20\u7684\u6392\u5217\u548c\u5bb9\u65a5\u7cfb\u6570\uff0c\u660e\u663e\u5bf9\u4e8e$a_i=b_i$\u7684\u65f6\u5019\u5408\u6cd5\u65b9\u6848\u88ab\u8ba1\u7b97\u4e00\u6b21\uff0c\u56e0\u6b64\u7cfb\u6570\u4e3a$(-1)^{a_i-b_i}$\n$$\n\\frac{(\\sum_i b_i)!}{\\prod_i b_i!}\\prod_ia_i!\\binom{a_i-1}{b_i-1}(-1)^{a_i-b_i}\n$$\n\n\n\u56e0\u4e3a\u5bb9\u65a5\u7cfb\u6570\u4e3a$(-1)^{a_i-b_i}$\uff0c\u6c42\u79ef\u540e\u4e3a$n-\\sum_i b_i$\uff0c\u56e0\u6b64\u8003\u8651\u94a6\u70b9$\\sum_{i} b_i$\u8fdb\u884c\u5bb9\u65a5\n\n\u8003\u8651\u5bf9$\\sum_i b_i$\u7684\u5408\u6cd5\u65b9\u6848\u8ba1\u6570\uff0c\u8003\u8651$f_{i,j}$\u5b9a\u4e49\u4e3a\u524d$i$\u79cd\u5143\u7d20\u6784\u6210\u4e86$j$\u4e2a\u65b0\u5143\u7d20\uff0c\u5219\u9012\u63a8\u5f0f\u4e3a\n$$\nf_{i,j}=\\sum_{k=1}^{\\min \\{a_i,j\\}}f_{i-1,j-k}\\times (-1)^{a_i-k}\\frac{a_i!\\binom{a_i-1}{k-1}}{k!}\n$$\n\u5b9e\u9645\u4e0a\u5bb9\u65a5\u7cfb\u6570\u5728\u6700\u540e\u5bb9\u65a5\u4e2d\u8ba1\u7b97\u548c\u5728$f$\u4e2d\u8ba1\u7b97\u80fd\u4ea7\u751f\u540c\u6837\u7684\u6548\u679c\u3002\n\n\u81f3\u4e8e\u600e\u4e48\u505a\u76f8\u90bb\u7684\uff0c8\u4f1a\u3002\n\n\u590d\u6742\u5ea6\u4e3a$O((\\sum_{i}a_i)^2)=O(n^2)$\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#include<cmath>\nconst int N = 3e2+7;\ntypedef long long LL;\n#define R register\n#define cerr(x) printf(\"%d\\n\", x)\nconst int p = 1e9+7;\nint n;\nint A[N*N], cnt = 0, k[N*N], sq;\nLL fac[N*N], ifac[N*N];\nbool dis[N][N];\ninline int min(int a, int b) {\n  return a > b ? b : a;\n}\nint vis[N*N];\ninline LL FST(int x, int k) {\n  LL res = 1;\n  if (!k) return 1;\n  if (!x) return 0;\n  while (k) {\n    if (k & 1) res = 1LL * res * x % p;\n    x = 1LL * x * x % p, k >>= 1;\n  } return res % p;\n}\nvoid dfs(int x, int col) {\n  vis[x] = cnt;\n  for (int i = 1; i <= n; i++)\n    if (i != x && dis[x][i] && !vis[i])\n      dfs(i, col);\n}\nvoid init() {\n  scanf(\"%d\", &n);\n  for (R int i = 1; i <= n; i++)\n    scanf(\"%d\", &A[i]);\n  std :: sort(A + 1, A + n + 1);\n  for (R int i = 1; i <= n; i++)\n    for (R int j = i + 1; j <= n; j++) {\n      if (dis[i][j]) continue;\n      LL nx = std :: sqrt(1LL * A[i] * A[j]);\n      if (1LL * nx * nx == 1LL * A[i] * A[j])\n        dis[i][j] |= 1, dis[j][i] |= 1;\n    }\n  for (R int i = 1; i <= n; i++)\n    if (!vis[i]) dfs(i, ++cnt);\n  for (R int i = 1; i <= n; i++) k[vis[i]]++;\n  \n  int up = 5000;\n  fac[0] = 1, ifac[0] = 1;\n  for (R int i = 1; i <= up; i++) fac[i] = 1LL * fac[i - 1] * i % p;\n  ifac[up] = FST(fac[up], p - 2);\n  for (R int i = up - 1; i >= 1; i--) ifac[i] = 1LL * ifac[i + 1] * (i + 1) % p;\n  //for (R int i = 1; i <= n; i++) cerr(ifac[i]);\n}\ninline int cc(int n, int m) {\n  return 1LL * fac[n] * ifac[n - m] % p * ifac[m] % p;\n}\nint f[N][N];\ninline int iep(int a, int b) {\n  return (((a - b) & 1) ? -1 : 1);\n}\nint main() {\n  init();\n  std :: sort(k + 1, k + cnt + 1);\n  f[0][0] = 1;\n  //for (R int i = 1; i <= cnt; i++) cerr(k[i]);\n  for (R int i = 1, S = 0; i <= cnt; i++) {\n    S += k[i];\n    for (R int j = 1; j <= S; j++)\n      for (R int K = 1; K <= k[i] && K <= j; K++)\n        f[i][j] = (f[i][j] + (1LL * f[i - 1][j - K] * iep(k[i], K) * \n          cc(k[i] - 1, K - 1) % p * ifac[K] % p * fac[k[i]]) % p) % p;\n  }\n  LL ans = 0;\n  for (R int i = cnt; i <= n; i++) \n    ans = (ans + 1LL * fac[i] * f[cnt][i] % p) % p;//, cerr(iep(n, i));\n  printf(\"%lld\\n\", (ans % p + p) % p);\n}\n```",
        "postTime": 1573615519,
        "uid": 181849,
        "name": "ComeIntoCalm",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4448 \u3010[AHOI2018\u521d\u4e2d\u7ec4]\u7403\u7403\u7684\u6392\u5217\u3011"
    }
]