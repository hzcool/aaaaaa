[
    {
        "content": "\u51fa\u5b8c\u611f\u89c9\u8fd9\u9898\u592a\u6cb9\u817b\u4e86\uff0c\u4e0b\u6b21\u51fa\u70b9\u5c0f\u6e05\u65b0\u601d\u7ef4\u9898\u3002\n\n\n### \u7b97\u6cd5\u4e00\uff1a\n\n\u679a\u4e3e\u6240\u6709\u5c0f\u4e8e $6$ \u4e2a\u8282\u70b9\u7684\u6811\uff0c\u5224\u65ad\u80dc\u8d1f\u6001\u3002\n\n**\u671f\u671b\u5f97\u5206\uff1a8**\n\n\n\n### \u7b97\u6cd5\u4e8c\uff1a\n\n\u7206\u641c\u3002\n\n**\u671f\u671b\u5f97\u5206\uff1a23**\n\n\n\n### \u7b97\u6cd5\u4e09\uff1a\n\n**\u6211\u4eec\u601d\u8003\u4e00\u4e2a\u66f4\u7b80\u5355\u7684\u95ee\u9898\uff1a**\n\n>\u7ed9\u5b9a\u4e00\u4e2a\u70b9 $r$\u3002\u4e24\u4eba\u4f9d\u6b21\u9009\u8fb9\uff0c\u6ee1\u8db3\u6709\u4e00\u6761 $r\\to x$ \u7684\u8def\u5f84\u8986\u76d6\u9009\u62e9\u8fc7\u7684\u8fb9\u3002\n\n\u56e0\u4e3a\u6211\u4eec\u679a\u4e3e\u5148\u624b\u9009\u62e9\u7684\u90a3\u6761\u8fb9\uff0c\u53ef\u4ee5\u5c06\u539f\u95ee\u9898\u5316\u4e3a\u4e24\u4e2a\u4e0a\u8ff0\u7684\u5b50\u95ee\u9898 $G_1,G_2$\u3002\n\n\u6b64\u65f6\u540e\u624b\u5148\u3002\n\n\u5f53 $\\operatorname{SG}(G_1)\\operatorname{xor}\\operatorname{SG}(G_2)\\ne0$ \u65f6\uff0c\u540e\u624b\u5fc5\u80dc\uff0c\u53cd\u4e4b\u5148\u624b\u5fc5\u80dc\u3002\u4e0b\u9762\u8ba1\u7b97 $\\operatorname{SG}(G)$\uff1a\n\n> \u8bbe\u72b6\u6001 $(u,k)$ \uff0c\u5176\u4e2d $u$ \u4e3a\u9009\u62e9\u7684\u8fb9\u4e2d\u6700\u6df1\u7684\u70b9\u7684\u7f16\u53f7\uff0c$k$ \u4e3a\u9009\u62e9\u7684\u8fb9\u6570\u3002\n>\n> \u56e0\u6b64\uff0c$(u,k)$ \u4f1a\u8fde\u5230\u6240\u6709 $(v,k+1)$ \u4e2d\uff0c\u5176\u4e2d $v$ \u5728 $u$ \u7684\u5b50\u6811\u5185\u3002\n>\n> \u5f97\u5230\uff1a\n>\n> - $\\operatorname{SG}(u,k)=\\operatorname{MEX}_{v\\in u.subtree}\\operatorname{SG}(v,k-1)$ \n> - $\\operatorname{SG}(u,d_u)=0$ \uff08$u$ \u4e3a\u53f6\u5b50\u8282\u70b9\uff09\n>\n> \u8fd9\u4e48\u505a\u662f $O(TN^3)$\u3002\n\n**\u671f\u671b\u5f97\u5206\uff1a40**\n\n\n\n### \u7b97\u6cd5\u56db\uff1a\n\nSubtask 6 \u53ef\u4ee5\u5bf9\u4e24\u70b9\u8fdb\u884c\u5206\u8ba8\u3002\n\n**\u671f\u671b\u5f97\u5206\uff1a46**\n\n\n\n### \u7b97\u6cd5\u4e94\uff1a\n\n\u5728\u7b97\u6cd5\u4e09\u7684\u57fa\u7840\u4e0a\u8fdb\u884c\u6362\u6839 DP\uff0c\u53ef\u4ee5\u964d\u4e3a $O(TN^2)$\u3002\n\n**\u671f\u671b\u5f97\u5206\uff1a70**\n\n\n### \u7b97\u6cd5\u516d\uff1a\n\n**\u89c2\u5bdf\u4e00\u68f5\u6811 SG \u51fd\u6570\u7684\u9012\u63a8\u8fc7\u7a0b\uff1a**\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/t9qb9d6w.png)\n\n\u901a\u8fc7\u89c2\u5bdf\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0 $\\operatorname{SG}$ \u7684\u503c\u662f\u5728 $n,n+1(2|n)$ \u4e24\u6570\u4e4b\u95f4\u9707\u8361\u7684\uff0c\u53ef\u4ee5\u7528 $dp$ \u6c42\u89e3\u3002\n\n\u8003\u8651\u4ece\u5947\u5076\u548c\u5927\u5c0f\u4e24\u4e2a\u65b9\u9762\u8bbe\u8ba1\u72b6\u6001\uff1a\n\n\u6211\u4eec\u53ef\u4ee5\u8bbe $f_u=\\lfloor\\dfrac{\\operatorname{SG}(u,0)}2\\rfloor,g_u=\\operatorname{SG}(u,0)\\bmod2$\u3002\n\n\u4e0d\u96be\u5f97\u5230\uff1a\uff08$v$ \u662f $u$ \u7684\u513f\u5b50\uff0c$d_u$ \u4e3a $u$ \u7684\u6df1\u5ea6\uff0c\u89c4\u5b9a $d_r=0$\uff09\n$$ \n\\begin{cases} \nf_u=1+\\max f_v,g_u=d_u\\bmod2, &  \\exists x,y\\in u.son:f_x=f_y=\\max f_v,g_x=1,g_y=0 \\\\ \nf_u=0,g_u=d_u\\bmod 2&u.son=\\varnothing\\\\\nf_u=\\max f_v,g_u=g_x(f_x=\\max f_v)&otherwise.\n\\end{cases} $$\n$\\operatorname{SG}(G)=\\operatorname{SG}(r,0)=2f_r+g_r$\u3002\n\n$f,g$ \u90fd\u662f\u53ef\u4ee5\u5728 $O(N)$ \u7684\u65f6\u95f4\u5185\u7b97\u51fa\u6765\u7684\uff0c\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5217\u51fa  $\\operatorname{SG}$ \u51fd\u6570\u7684 dp \u5f0f\u3002\n\n\u6b64\u65f6\uff0c\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(TN^2)$\u3002\n\n**\u671f\u671b\u5f97\u5206\uff1a70**\n\n\n### \u7b97\u6cd5\u4e03\uff1a\n\n\u5728\u7b97\u6cd5\u516d\u4e0a\u505a\u4e00\u904d\u6362\u6839 DP\u3002\u53ef\u4ee5\u505a\u5230 $O(\\sum N)$\u3002 \n\n\u5177\u4f53\u6765\u8bf4\uff0c\u5148\u968f\u610f\u94a6\u5b9a\u4e00\u4e2a\u6839\u5ea6\u6570\u4e3a $1$ \u7684\u70b9 $r$\uff0c\u505a\u4e00\u904d\u7b97\u6cd5\u516d\u3002\n\n\u4f60\u53ef\u4ee5\u5f97\u5230 $f_i$ \u8868\u793a $i$ \u7684\u5b50\u6811\u7684 $\\operatorname{SG}$ \u51fd\u6570\u3002\n\n\u63a5\u4e0b\u6765\u8bb0 $g_i$ \u4e3a\u65ad\u6389 $(i,fa_i)$ \u8fd9\u6761\u8fb9\u540e\uff0c\u4ee5 $fa_i$ \u4e3a\u6839\u7684\u6811\u7684 $\\operatorname{SG}$ \u503c\u3002\n\n\u6211\u4eec\u6709 $g_i=calc(g_{fa_i},g_{i.breothers})$\u3002\n\n\u5176\u4e2d\uff0c$clac(a_1,a_2,\\cdots)$ \u662f\u5408\u5e76\u4e00\u4e9b\u6811\u7684 $f$ \u7684\u65b9\u6cd5\u3002\u5177\u4f53\u800c\u8a00\uff0c\u4e0a\u4e00\u4e2a\u89e3\u6cd5\u5df2\u7ecf\u6709\u7c7b\u4f3c\u7684\u5f0f\u5b50\u4e86\u3002\n\n\n$$ calc(A)= \n\\begin{cases} \n2k+1, &  \\exists A_i=2k,A_j=2k-1 \\\\ \n\\max(A_i\\operatorname{xor}1)\n\\end{cases} $$\n\n\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4ece\u7236\u4eb2\u66f4\u65b0\u513f\u5b50\u8282\u70b9\uff0c\u6216\u8005\u5176\u4ed6\u5904\u7406\u65b9\u5f0f\u3002\u7ec6\u8282\u4ed4\u7ec6\u5904\u7406\u5c31\u53ef\u4ee5\u505a\u5230 $O(\\sum n)$\u3002\n\n**\u671f\u671b\u5f97\u5206\uff1a100**\n",
        "postTime": 1614702588,
        "uid": 128448,
        "name": "haze1231",
        "ccfLevel": 0,
        "title": "100%\u4e0d\u516c\u5e73\u7684\u6e38\u620f\u89e3\u7b54"
    },
    {
        "content": "\u662f\u771f\u7684\u6ca1\u6709\u4ee3\u7801\u80fd\u529b\u4e86/ll\n\n~~\u4e00\u9053\u5927\u6bd2\u7624\u9898/baojin~~\n\nSG \u5b9a\u7406 + \u6362\u6839 dp\u3002\n\n\u9996\u5148\u60f3\u5230\u5148\u624b\u6807\u8bb0\u4e86\u4e00\u6761\u8fb9\u540e\uff0c\u95ee\u9898\u8f6c\u5316\u6210\u4e86\u4e24\u4e2a\u5b50\u6e38\u620f\u7684\u548c\uff0c\u6bcf\u4e2a\u6e38\u620f\u90fd\u662f\u4e00\u68f5\u6709\u6839\u6811\uff0c\u8981\u6c42\u53d8\u6210\u5728\u6709\u6839\u6811\u4e2d\u6807\u8bb0\u8fb9\u4e14\u8fd9\u4e9b\u8fb9\u90fd\u8981\u5728\u4e00\u6761\u4ee5\u6839\u4e3a\u4e00\u4e2a\u7aef\u70b9\u7684\u94fe\u4e0a\u3002\n\n\u4e3a\u4ec0\u4e48\u8981\u8f6c\u5316\u6210\u8fd9\u6837\u7684\u6e38\u620f\u5462\uff1f\u8fd9\u662f\u7531\u4e8e\u5728\u8fd9\u4e2a\u6e38\u620f\u4e2d\uff0c\u64cd\u4f5c\u4e00\u6b65\u8f6c\u5316\u51fa\u7684\u5b50\u6e38\u620f\u5f62\u6001\u4e0e\u4e4b\u76f8\u4f3c\u3002\u4ee5\u4e0b\u7528 $\\operatorname{SG}(x)$ \u8868\u793a $x$ \u5b50\u6811\u7684 SG \u503c\u3002\n\n\u5982\u5728\u4ee5\u4e0b\u4e00\u68f5\u6811\u4e2d\uff08\u6839\u4e3a $1$\uff09\uff1a\n\n![pic1](https://cdn.luogu.com.cn/upload/image_hosting/s9wtaest.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n\n\u82e5\u6211\u4eec\u6807\u8bb0\u4e86 $5-9$ \u8fd9\u6761\u8fb9\uff0c\u5373\n\n![pic2](https://cdn.luogu.com.cn/upload/image_hosting/z7pp129v.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n\n\u663e\u7136\u6b64\u65f6\u63a5\u4e0b\u6765\u6807\u8bb0\u7684\u8fb9\u53ea\u53ef\u80fd\u5728 $9$ \u7684\u5b50\u6811\u4e2d\u6216 $1-5$ \u8fd9\u6761\u94fe\u4e0a\u3002\u5728 $9$ \u5b50\u6811\u4e2d\u64cd\u4f5c\u7684\u89c4\u5219\u4e0e\u539f\u95ee\u9898\u662f\u76f8\u540c\u7684\u3002\u6545\u6b64\u540e\u7ee7\u72b6\u6001\u7684 SG \u503c\u4e3a $\\operatorname{SG}(9) \\oplus \\operatorname{SG}(1-5)$\uff08\u8bb0\u53f7\u4e0d\u662f\u5f88\u6807\u51c6\uff09\u3002\n\n\u800c\u94fe\u7684 SG \u503c\u4e3a\u94fe\u957f ${}\\bmod 2$\uff08\u94fe\u957f\u8ba1\u8fb9\u6570\uff09\u3002\u8fd9\u4e2a\u53ef\u4ee5\u8bbe\u957f\u4e3a $n$ \u7684\u94fe\u7684 SG \u503c\u4e3a $f(n)$\uff0c\u7531 $f(0)=0,f(1)=1$\uff0c\u4e14\n\n$$f(n)=\\operatorname{mex}\\{f(i) \\oplus f(n-i-1) :i=0,\\dots,n-1\\}$$\n\n\u5f97\u5230\u3002\n\n\u6545\u7531\u4ee5\u4e0a\u5206\u6790\uff0c\u4efb\u610f\u9009\u5b9a\u6839\u540e\u53ef\u5f97\n\n$$\\operatorname{SG}(x)=\\operatorname{mex}\\{\\operatorname{SG}(v) \\oplus (dep_v-dep_x-1) \\bmod{2} : v \\in subtree_x\\},$$\n\n\u5176\u4e2d $subtree_x$ \u8868\u793a $x$ \u7684\u5b50\u6811\u4e2d\u7684\u6240\u6709\u70b9\u6784\u6210\u7684\u96c6\u5408\u3002\n\n\u4e8e\u662f\u6211\u4eec\u8981\u5173\u6ce8\u7684\u5c31\u662f $\\operatorname{SG}(v) \\oplus (dep_v-dep_x-1) \\bmod{2}$\u3002\u6211\u4eec\u53d1\u73b0\u76f8\u90bb\u4e24\u70b9\u7684\u6df1\u5ea6\u5947\u5076\u6027\u6070\u597d\u76f8\u53cd\uff0c\u4e5f\u5c31\u662f\u5728\u70b9 $u$ \u5904\u9700\u8981 $\\oplus1$ \u7684\u503c\u5728 $u$ \u7684\u7236\u4eb2\u5904\u4e0d\u9700\u8981\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002\u4e8e\u662f\u6211\u4eec\u8bb0\u4e24\u4e2a\u96c6\u5408 $S_{x,0}$ \u4e0e $S_{x,1}$\uff0c$S_{x,0}$ \u662f\u6240\u9700\u8981\u7528\u4e8e\u6c42 SG \u503c\u7684\u96c6\u5408\uff0c$S_{x,1}$ \u662f $S_{x,0}$ \u4e2d\u6240\u6709\u5143\u7d20 $\\oplus 1$ \u4e4b\u540e\u7684\u96c6\u5408\u3002\u5219\u6709\u8f6c\u79fb\uff1a\n\n$$S_{u,0}=\\bigcup_{v \\in son_u}(\\{\\operatorname{SG}(v)\\} \\cup S_{v,1}),$$\n\n$$S_{u,1}=\\bigcup_{v \\in son_u}(\\{\\operatorname{SG}(v)\\} \\cup S_{v,0}),$$\n\n\u4e14\u6709 $\\operatorname{SG}(u)=\\operatorname{mex}(S_{u,0})$\u3002\n\n\u5728\u8fd9\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u7684\u57fa\u7840\u4e0a\u8fdb\u884c\u6362\u6839 dp \u5373\u53ef\u3002\u7528 `bitset` \u7ef4\u62a4\u96c6\u5408\uff0cSG \u503c\u6700\u5927\u53ef\u80fd\u4e3a $37$\uff0c\u5904\u7406 SG \u51fd\u6570\u6240\u9700\u65f6\u95f4 $\\frac{37}{\\omega}$ \u662f\u4e00\u4e2a\u5c0f\u5e38\u6570\uff0c\u6545\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n)$\uff0c\u5b9e\u9645\u8868\u73b0\u4e5f\u8db3\u591f\u4f18\u79c0\uff08\u6700\u6162\u70b9 $1s$ \u5de6\u53f3\uff09\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u4e2d\uff0c\u6211\u4eec\u5bf9\u6bcf\u4e2a\u70b9\u7528\u4e24\u4e2a `bitset` \u7ef4\u62a4\u5b83\u7236\u4eb2\u7684\u513f\u5b50\u4e2d\u6bd4\u5b83\u5148\u904d\u5386\u5230\u7684\u70b9\u7684 $S$ \u4e0e\u6bd4\u5b83\u540e\u904d\u5386\u5230\u7684\u70b9\u7684 $S$ \u7684\u5e76\u96c6\uff0c\u8fd9\u4e2a\u6709\u70b9\u7c7b\u4f3c\u524d\u7f00/\u540e\u7f00\u548c\u3002\u8fd9\u6837\u5728\u6362\u6839\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u76f4\u63a5 $O(1)$ \u8ba1\u7b97\u3002\u7ec6\u8282\u6bd4\u8f83\u591a~~\u6240\u4ee5\u8c03\u6b7b\u6211\u4e86~~\u3002\n\n`bitset` \u5e93\u51fd\u6570 `_Find_first` \u53ef\u4ee5\u5feb\u901f\u627e\u5230\u6700\u4f4e\u4f4d\u7684 $1$\uff0c\u53d6\u53cd\u540e\u8c03\u7528\u5c31\u662f $\\operatorname{mex}$ \u51fd\u6570\u3002\n\n~~\u4e0d\u8981\u50cf\u6211\u4e00\u6837\u53ea\u7528\u8111\u5b50\u60f3\uff0c\u6700\u597d\u7528\u4e0b\u8349\u7a3f\u7eb8\uff0c\u4e0d\u7136\u5c31\u50cf\u6211\u4e00\u6837\u60f3\u9519\u4e86\u90fd\u4e0d\u77e5\u9053~~\n\nCode:\n```cpp\n#include<bitset>\n#include<cstdio>\n#include<vector>\n#define rg register\nusing std::bitset;\nusing std::vector;\nint sg[500003];\nint snm[500003];\nvector<int> e[500003];\nbitset<40> S[500003][2],T;\nbitset<40> lS[500003][2],rS[500003][2];\ninline void add(int x,int y){e[x].push_back(y),e[y].push_back(x);}\nvoid dfs1(int u,int f)\n{\n\tsnm[u]=e[u].size();\n\tbitset<40> tlS0,trS0;\n\tbitset<40> tlS1,trS1;\n\ttlS0.reset(),trS0.reset();\n\ttlS1.reset(),trS1.reset();\n\tfor(rg int i=1,v;i<snm[u];++i)\n\t{\n\t\tv=e[u][i];if(v==f)continue;dfs1(v,u);\n\t\tlS[v][0]=tlS0,tlS0|=S[v][1];\n\t\tlS[v][1]=tlS1,tlS1|=S[v][0];\n\t}\n\tfor(rg int i=1,v;i<snm[u];++i)\n\t{\n\t\tv=e[u][snm[u]-i];if(v==f)continue;\n\t\trS[v][0]=trS0,trS0|=S[v][1];\n\t\trS[v][1]=trS1,trS1|=S[v][0];\n\t}\n\tsg[u]=(~tlS0)._Find_first(),S[u][0]=tlS0,S[u][1]=tlS1;\n\tS[u][0].set(sg[u]^1),S[u][1].set(sg[u]);\n}\nint dfs2(int u,int f,bitset<40> tS0,bitset<40> tS1)\n{\n\tif(f)\n\t{\n\t\tint tsg=(~tS0)._Find_first();\n\t\tif(tsg==sg[u])return 1;\n\t\ttS0.set(tsg^1),tS1.set(tsg);\n\t}\n\tfor(rg int i=1,v;i<snm[u];++i)\n\t{\n\t\tv=e[u][i];if(v==f)continue;\n\t\tif(dfs2(v,u,tS1|lS[v][0]|rS[v][0],tS0|lS[v][1]|rS[v][1]))return 1;\n\t}\n\treturn 0;\n}\ninline void init(int n)\n{\n\tT.reset();\n\tfor(rg int i=1;i<=n;++i)\n\t{\n\t\tsg[i]=snm[i]=0;\n\t\te[i].clear(),e[i].push_back(0);\n\t\tS[i][0].reset(),S[i][1].reset();\n\t\tlS[i][0].reset(),rS[i][0].reset();\n\t\tlS[i][1].reset(),rS[i][1].reset();\n\t}\n}\nint t,n,u,v;\nint main()\n{\n\tscanf(\" %d\",&t);\n\twhile(t--)\n\t{\n\t\tscanf(\" %d\",&n);init(n);\n\t\tfor(rg int i=1;i<n;++i)scanf(\" %d %d\",&u,&v),add(u,v);\n\t\tdfs1(1,0);puts((dfs2(1,0,T,T))?\"Play now\":\"Restart\");\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1630648958,
        "uid": 59388,
        "name": "VinstaG173",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7841 \u3010\u300cC.E.L.U-03\u300d100%\u4e0d\u516c\u5e73\u7684\u6e38\u620f\u3011"
    },
    {
        "content": "\u4ecb\u7ecd\u4e0b\u66f4\u663e\u7136\u7684 multi-sg \u505a\u6cd5\u3002\n\n\u9996\u5148\u9009\u5b8c\u7b2c\u4e00\u6761\u8fb9\u540e\u6e38\u620f\u53d8\u6210\u6bcf\u6b21\u9009\u62e9\u7684\u8fb9\u90fd\u8981\u6784\u6210\u4e00\u6761\u5230\u6839\u7684\u8def\u5f84\u7684\u4e24\u4e2a\u5b50\u6e38\u620f\uff0c\u4e4b\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u6e38\u620f\uff0c\u9009\u62e9\u4e00\u6761\u8fb9\u76f8\u5f53\u4e8e\u628a\u5b83\u5206\u6210\u4e00\u4e2a\u6bcf\u6b21\u53ea\u80fd\u53d6\u4e00\u6761\u8fb9\u7684\u94fe\u548c\u4e00\u4e2a\u89c4\u5219\u76f8\u540c\u7684\u5b50\u6811\u3002\u6839\u636e multi-sg \uff0c\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u5b50\u6811\uff0c\u6211\u4eec\u679a\u4e3e\u5b83\u80fd\u5206\u6210\u4e24\u4e2a\u5b50\u6e38\u620f\u7684\u6240\u6709\u60c5\u51b5\u5e76\u5c06\u5b83\u4eec\u7684 sg \u503c\u5f02\u6216\u8d77\u6765\u5f53\u6210\u540e\u7ee7\u72b6\u6001\u3002\u800c\u94fe\u7684 sg \u503c\u6bd4\u8f83\u663e\u7136\u76f8\u5f53\u4e8e\u94fe\u957f %2 \uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u679a\u4e3e\u5b50\u6811\u5185\u7684\u5b50\u6811\u6765\u8fdb\u884c\u8f6c\u79fb\uff0c\u4e5f\u5c31\u662f\n\n$sg_o=\\text{mex}(sg_{son_o}\\oplus ((dep_o - dep_{son_o} - 1 ) \\% 2))(son_o\\in S_o)$\n\n\u5176\u4e2d $S_o$ \u4ee3\u8868 $o$ \u7684\u5b50\u6811\u3002\n\n\u800c\u6700\u540e\u5148\u624b\u9009\u5b8c\u7b2c\u4e00\u6761\u8fb9\u540e\u7684 sg \u503c\u76f8\u5f53\u4e8e\u5206\u51fa\u4e24\u4e2a\u5b50\u6811\u6240\u5bf9\u5e94 sg \u503c\u7684\u5f02\u6216\u548c\uff0c\u5148\u624b\u83b7\u80dc\u6761\u4ef6\u76f8\u5f53\u4e8e\u5b58\u5728\u4e00\u79cd\u9009\u6cd5\u4f7f\u5f97 sg \u503c\u4e3a $0$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u66b4\u529b\u679a\u4e3e\u7b2c\u4e00\u6761\u8fb9\u5e76\u4e14\u66b4\u529b\u6c42\u51fa\u5b50\u6811 sg \u503c\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^3)$\uff0c\u5982\u679c\u4f7f\u7528\u6362\u6839\u6765\u4ee3\u66ff\u66b4\u529b\u679a\u4e3e\u7b2c\u4e00\u6761\u8fb9\u5219\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2)$\uff0c\u74f6\u9888\u5728\u6c42\u5b50\u6811 sg \u503c\u3002\n\n\u6211\u4eec\u7ee7\u7eed\u5206\u6790\uff0c\u5982\u679c\u4e00\u4e2a\u70b9\u4ed6\u6709\u4e00\u4e2a\u513f\u5b50 $o$ \u7684 sg \u503c\u4e3a $t$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4efb\u4f55\u7684 $0\\leq s < \\left \\lfloor \\dfrac{t}{2}\\right\\rfloor \\times 2$ \u80af\u5b9a\u80fd\u5728\u8fd9\u4e2a\u513f\u5b50\u5185\u90e8\u627e\u5230\u4e00\u4e2a\u70b9\u4f7f\u5f97 $sg_{son_o}\\oplus ((dep_o - dep_{son_o} - 1 ) \\% 2) = s$\uff0c \u56e0\u4e3a\u53ef\u4ee5\u8fd9\u4e9b\u503c\u4e24\u4e24\u914d\u5bf9\uff0c\u6240\u4ee5\u4e5f\u4e00\u5b9a\u80fd\u627e\u5230  $sg_{son_o}\\oplus ((dep_{fa_o} - dep_{son_o} - 1 ) \\% 2) = sg_{son_o}\\oplus ((dep_o - dep_{son_o} ) \\% 2) = s$\u3002\n\n\u800c\u5bf9\u4e8e $t$\uff0c\u5982\u679c $t = \\left \\lfloor \\dfrac{t}{2}\\right\\rfloor \\times 2$\uff0c\u5047\u5982\u5b83\u7684\u5b50\u6811\u5185\u80fd\u627e\u5230\u4e00\u4e2a sg \u503c\u4e3a $t+1$ \u7684\u5b50\u6811\uff0c\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\u8fd9\u4e2a\u513f\u5b50\u80fd\u627e\u5230\u4e00\u4e2a sg \u503c\u4e3a $(t+1)\\oplus 1 = t$\u7684\u5b50\u6811\uff0c\u4e0e\u5176 sg \u503c\u4e3a $t$ \u77db\u76fe\u3002\n\n\u5982\u679c $t = \\left \\lfloor \\dfrac{t}{2}\\right\\rfloor \\times 2 + 1$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u513f\u5b50\u7684\u5b50\u6811\u5185\u627e\u4e0d\u5230\u4e00\u4e2a sg \u503c\u4e3a $t$ \u7684\u72b6\u6001\uff0c\u4e5f\u5c31\u76f8\u5f53\u4e8e\u8fd9\u4e2a\u70b9\u7684\u5b50\u6811\u5185\u627e\u4e0d\u5230\u4e00\u4e2a sg \u503c\u4e3a $t\\oplus 1 = t - 1$ \u7684\u72b6\u6001\u3002\n\n\u6240\u4ee5\u8bf4\u4e00\u4e2a\u70b9\u7684\u4e00\u4e2a\u513f\u5b50 sg \u503c\u4e3a $t$\uff0c\u90a3\u4e48\u5b83\u80fd\u5230\u8fbe\u7684\u540e\u7ee7\u72b6\u6001\u5c31\u591a\u4e86 $0$ \u5230 $\\left \\lfloor \\dfrac{t}{2}\\right\\rfloor \\times 2 - 1$ \u548c $t$\u3002\n\n\u4e8e\u662f\u4e00\u4e2a\u70b9\u7684 sg \u503c\u5c31\u53ef\u4ee5\u5982\u4e0b\u8f6c\u79fb\n\n$$sg_o=\\begin{cases}\\max(sg_{son_o})+ 1&\\max(sg_{son_o}) =\\text{se}(sg_{son_o})+1\\\\0 &son_o = \\varnothing\\\\\\max(sg_{son_o})\\oplus 1&\\text{otherwise}\\end{cases}$$\n\n\u5176\u4e2d $\\text{se}(S)$ \u4ee3\u8868\u96c6\u5408 $S$ \u4e2d\u7684\u4e25\u683c\u6b21\u5927\u503c\u3002\n\n\u4e8e\u662f\u8fd9\u6837\u4fbf\u80fd\u505a\u5230 $O(n)$ \u6c42\u51fa sg \u503c\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\nusing namespace std;\nconst int N = 5e5 + 10;\nstruct bian\n{\n\tint from, to;\n}eg[N << 1];\nint front[N], num;\nvoid add(int x, int y)\n{\n\teg[++ num].to = y;\n\teg[num].from = front[x];\n\tfront[x] = num;\n}\nint sg[N], maxs[N], maxs_tot[N], se[N], se_tot[N], th[N], th_tot[N];\nint T, n;\nvoid dfs1(int o, int from)\n{\n\tmaxs_tot[o] = maxs[o] = se[o] = se_tot[o] = th[o] = th_tot[o] = 0;\n\tfor (int i = front[o]; i; i = eg[i].from)\n\t{\n\t\tint to = eg[i].to;\n\t\tif(to == from)continue;\n\t\tdfs1(to, o);\n\t\tif(maxs[o] == sg[to])\n\t\t++ maxs_tot[o];\n\t\telse\n\t\tif(maxs[o] < sg[to])\n\t\tswap(se[o], th[o]), swap(se_tot[o], th_tot[o]), swap(maxs[o], se[o]), swap(maxs_tot[o], se_tot[o]), maxs[o] = sg[to], maxs_tot[o] = 1;\n\t\telse\n\t\tif(se[o] == sg[to])\n\t\t++ se_tot[o];\n\t\telse\n\t\tif(se[o] < sg[to])\n\t\tswap(se[o], th[o]), swap(se_tot[o], th_tot[o]), se[o] = sg[to], se_tot[o] = 1;\n\t\telse\n\t\tif(th[o] == sg[to])\n\t\t++ th_tot[o];\n\t\telse\n\t\tif(th[o] < sg[to])\n\t\tth[o] = sg[to], th_tot[o] = 1;\n\t}\n\t\tif(maxs[o] == (se[o] ^ 1) && se_tot[o] >= 1)\n\t\tsg[o] = maxs[o] + 1;\n\t\telse\n\t\tsg[o] = maxs_tot[o] == 0 ? 0 : (maxs[o] ^ 1);\n}\nint ans = 0;\nvoid dfs2(int o, int from)\n{\n\tfor (int i = front[o]; i; i = eg[i].from)\n\t{\n\t\tint to = eg[i].to;\n\t\tif(to == from)continue;\n\t\t\n\t\tint sg_o = sg[o], maxs_o = maxs[o], maxs_tot_o = maxs_tot[o], se_o = se[o], se_tot_o = se_tot[o], th_o = th[o], th_tot_o = th_tot[o];\n\t\tint sg_to = sg[to], maxs_to = maxs[to], maxs_tot_to = maxs_tot[to], se_to = se[to], se_tot_to = se_tot[to], th_to = th[to], th_tot_to = th_tot[to];\n\t\t\n\t\tint now = sg[to];\n\t\tif(sg[to] == maxs[o] && maxs_tot[o] == 1)\n\t\tmaxs[o] = se[o], maxs_tot[o] = se_tot[o], se[o] = th[o], se_tot[o] = th_tot[o], th[o] = 0, th_tot[o] = 0;\n\t\telse\n\t\tif(sg[to] == se[o] && se_tot[o] == 1)\n\t\tse[o] = th[o], se_tot[o] = th_tot[o], th[o] = 0, th_tot[o] = 0;\n\t\telse\n\t\tif(sg[to] == th[o] && th_tot[o] == 1)\n\t\tth[o] = 0, th_tot[o] = 0;\n\t\tif(maxs[o] == (se[o] ^ 1) && se_tot[o] >= 1)\n\t\tsg[o] = maxs[o] + 1;\n\t\telse\n\t\tsg[o] = maxs_tot[o] == 0 ? 0 : (maxs[o] ^ 1);\n\t\t\n\t\t\n\t\tif(maxs[to] == sg[o])\n\t\t++ maxs_tot[to];\n\t\telse\n\t\tif(maxs[to] < sg[o])\n\t\tswap(se[to], th[to]), swap(se_tot[to], th_tot[to]), swap(maxs[to], se[to]), swap(maxs_tot[to], se_tot[to]), maxs[to] = sg[o], maxs_tot[to] = 1;\n\t\telse\n\t\tif(se[to] == sg[o])\n\t\t++ se_tot[to];\n\t\telse\n\t\tif(se[to] < sg[o])\n\t\tswap(se[to], th[to]), swap(se_tot[to], th_tot[to]), se[to] = sg[o], se_tot[to] = 1;\n\t\telse\n\t\tif(th[to] == sg[o])\n\t\t++ th_tot[to];\n\t\telse\n\t\tif(th[to] < sg[o])\n\t\tth[to] = sg[o], th_tot[to] = 1;\n\t\t\n\t\t\n\t\tif(maxs[to] == (se[to] ^ 1) && se_tot[to] >= 1)\n\t\tsg[to] = maxs[to] + 1;\n\t\telse\n\t\tsg[to] = maxs_tot[to] == 0 ? 0 : (maxs[to] ^ 1);\n\t\t\n\t\t\n\t\tif(now == sg[o])ans = 1; \n\t\t\n\t\tdfs2(to, o);\n\t\t\n\t\t\n\t\tsg[o] = sg_o, maxs[o] = maxs_o, maxs_tot[o] = maxs_tot_o, se[o] = se_o, se_tot[o] = se_tot_o, th[o] = th_o, th_tot[o] = th_tot_o;\n\t\tsg[to] = sg_to, maxs[to] = maxs_to, maxs_tot[to] = maxs_tot_to, se[to] = se_to, se_tot[to] = se_tot_to, th[to] = th_to, th_tot[to] = th_tot_to;\n\t\t\n\t}\n}\nint main()\n{\n\tscanf(\"%d\", &T);\n\twhile(T --)\n\t{\n\t\tans = 0;\n\t\tnum = 0;\n\t\tfor (int i = 1; i <= n; ++ i)\n\t\tfront[i] = 0;\n\t\tscanf(\"%d\", &n);\n\t\tfor (int i = 1; i < n; ++ i)\n\t\t{\n\t\t\tint x, y;\n\t\t\tscanf(\"%d%d\", &x, &y);\n\t\t\tadd(x, y);\n\t\t\tadd(y, x);\n\t\t}\n\t\tdfs1(1, 0);\n\t\tdfs2(1, 0);\n\t\tprintf(\"%s\\n\", ans ? \"Play now\" : \"Restart\");\n\t}\n}\n```\n",
        "postTime": 1633428607,
        "uid": 111728,
        "name": "\u5e7b\u5f71\u661f\u575a\u5f3a",
        "ccfLevel": 7,
        "title": "P7841 \u300cC.E.L.U-03\u300d100%\u4e0d\u516c\u5e73\u7684\u6e38\u620f"
    }
]