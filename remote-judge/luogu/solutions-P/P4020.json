[
    {
        "content": "\u672c\u7bc7\u9898\u89e3\u7b26\u53f7\u7ea6\u5b9a\uff1a\n\n| \u7269\u7406\u91cf | \u7b26\u53f7 |\n| ----------- | ----------- |\n| \u7535\u6d41 | I |\n| \u7535\u52a8\u52bf | E |\n| \u7535\u963b | R |\n| \u7535\u52bf\u5dee\uff08\u7535\u538b\uff09 | U |\n| \u7535\u52bf | $\\varphi$ |\n\n\u8fd9\u662f\u4e00\u9053\u7535\u5b66\u9898\uff0c\u6211\u4eec\u590d\u4e60\u4e00\u4e9b\u7535\u5b66\u5185\u5bb9\uff1a\n\n### 1.\u6b27\u59c6\u5b9a\u5f8b\n\n\u5728\u540c\u4e00\u7535\u8def\u4e2d\uff0c\u901a\u8fc7\u67d0\u6bb5\u5bfc\u4f53\u7684\u7535\u6d41\u8ddf\u8fd9\u6bb5\u5bfc\u4f53\u4e24\u7aef\u7684\u7535\u538b\u6210\u6b63\u6bd4\uff0c\u8ddf\u8fd9\u6bb5\u5bfc\u4f53\u7684\u7535\u963b\u6210\u53cd\u6bd4\uff0c\u5373\uff1a\n\n$$I=\\frac{U}{R}$$\n\n### 2.\u57fa\u5c14\u970d\u592b\u7b2c\u4e00\u5b9a\u5f8b\n\n\u6c47\u5408\u4e8e\u4efb\u4e00\u8282\u70b9\u5904\u7684\u5404\u7535\u6d41\u7684\u4ee3\u6570\u548c\u7b49\u4e8e0\uff0c\u5373:\n\n$$\\sum I=\\sum I_{in}+\\sum I_{out}=0$$\n\n\u5bf9\u4e8e\u4e00\u4e9b\u7535\u5b66\u9898\u76ee\uff0c\u53ef\u4ee5\u4f9d\u636e\u6b27\u59c6\u5b9a\u5f8b\u548c\u57fa\u5c14\u970d\u592b\u7b2c\u4e00\u5b9a\u5f8b\u5217\u51fa\u65b9\u7a0b\u7ec4\uff0c\u5229\u7528\u9ad8\u65af\u6d88\u5143\u6c42\u89e3\u3002\n\n\u4f46\u662f\u8fd9\u9898\u6570\u636e\u8303\u56f450000\uff0c\u9ad8\u65af\u6d88\u5143\u53ea\u80fd\u83b7\u5f9730pts\u3002\u6211\u4eec\u6ce8\u610f\u5230\u6811\u4e0a\u7684\u6700\u957f\u94fe\u957f\u5ea6\u4e0d\u8d85\u8fc750\uff0c\u5e94\u8003\u8651\u7531\u7236\u4eb2\u5230\u513f\u5b50\u6216\u662f\u513f\u5b50\u5230\u7236\u4eb2\u7684\u9012\u63a8\u5173\u7cfb\uff0c\u66b4\u529b\u9012\u63a8\u7b54\u6848\u3002\n\n\u663e\u7136\uff0c\u53ea\u8981\u672c\u9898\u4e2d\u6240\u6709\u7684\u7535\u963b\u5668\u963b\u503c\u76f8\u540c\uff0c\u4e0d\u8bba\u6bcf\u4e2a\u7535\u963b\u7684\u963b\u503c\u662f$10000\\Omega$\u8fd8\u662f$0.1\\Omega$\uff0c\u7b54\u6848\u90fd\u662f\u4e00\u6837\u7684\u3002\u56e0\u6b64\u6211\u5c06\u6bcf\u4e2a\u7535\u963b\u7684\u963b\u503c\u8bb0\u4e3a$R$\u3002\u4e3a\u4e86\u4fbf\u4e8e\u8ba1\u7b97\uff0c\u94a6\u70b9\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\u4e3a\u6839\u3002\n\n\u8003\u8651\u8282\u70b9$i$\uff1a\n\n\u8bbe$i$\u7684\u7236\u8282\u70b9\u4e3a$fa$\uff0c\u5b50\u8282\u70b9\u96c6\u5408\u4e3a$son$\uff0c$fa$\u5230$i$\u7684\u7535\u6d41\u4e3a$I_i$\u3002\n\n\u7531\u7236\u8282\u70b9$fa$\u5230$i$\u7684\u7535\u8def\u4e2d\uff0c\u7535\u963b\u5904\u7535\u52bf\u7684\u4e0b\u964d\uff0c\u52a0\u4e0a\u7535\u6e90\u5e26\u6765\u7684\u7535\u52bf\u4e0a\u5347\uff0c\u5176\u7ed3\u679c\u5c31\u7b49\u4e8e\u4e24\u70b9\u7684\u7535\u52bf\u5dee\uff1a\n\n$$I_iR+E_i=\\varphi_{fa}-\\varphi_{i}$$\n\n\u79fb\u9879\u5f97\uff1a\n\n$$I_i=\\frac{\\varphi_{fa}-\\varphi_{i}-E_i}{R}$$ \n\n\u540c\u7406\uff0c\u7531$i$\u5230\u6bcf\u4e2a\u5b50\u8282\u70b9$x$\u7684\u7535\u8def\u4e2d\uff0c\u90fd\u6709\uff1a\n\n$$I_xR+E_x=\\varphi_{i}-\\varphi_{x}$$\n\n\u79fb\u9879\uff0c\u5bf9\u6240\u6709\u5b50\u8282\u70b9\u6c42\u548c\u5f97\uff1a\n\n$$\\sum_{x\\in son}I_x=\\sum_{x\\in son}\\frac{\\varphi_{i}-\\varphi_{x}-E_x}{R}$$\n\n$i$\u70b9\u7684\u57fa\u5c14\u970d\u592b\u7b2c\u4e00\u5b9a\u5f8b\uff1a\n\n$$\\sum_{x\\in son}I_x=I_i$$\n\n\u5c06\u5df2\u6c42\u5f97\u7684\u4e24\u4e2a$I$\u5e26\u5165\u7b2c\u4e09\u4e2a\u5f0f\u5b50\uff1a\n\n$$\\sum_{x\\in son}\\frac{\\varphi_{i}-\\varphi_{x}-E_x}{R}=\\frac{\\varphi_{fa}-\\varphi_{i}-E_i}{R}$$\n\n\u6574\u7406\u5f97\uff1a\n\n$$\\varphi_i=\\frac{\\varphi_{fa}-E_i+\\sum_{x\\in son}(\\varphi_x+E_x)}{deg_i}$$\n\n\u4e3a\u4e86\u66b4\u529b\u9012\u63a8\uff0c\u8bbe$\\varphi_i=K_i\\varphi_{fa}+B_i$\uff0c\u5176\u4e2d$K_i$\u548c$B_i$\u90fd\u662f\u53ea\u4e0e$i$\u4e0e$son$\u6709\u5173\u7684\u7cfb\u6570\uff0c\u5c06\u4e0a\u5f0f\u4e2d\u7684$\\varphi_x$\u4ee5\u8fd9\u79cd\u5f62\u5f0f\u8868\u793a\uff0c\u5373\u5f97\uff1a\n\n$$\\varphi_i=\\frac{\\varphi_{fa}-E_i+\\sum_{x\\in son}(K_x\\varphi_i+B_x+E_x)}{deg_i}$$\n\n\u63d0\u51fa\u7cfb\u6570\uff1a\n\n$$K_i=\\frac{1}{deg_i-\\sum_{x\\in son}K_x}$$\n$$B_i=\\frac{\\sum_{x\\in son}(B_x+E_x)-E_i}{deg_i-\\sum_{x\\in son}K_x}=K_i(\\sum_{x\\in son}(B_x+E_x)-E_i)$$\n\n\u8c41\u7136\u5f00\u6717\u4e86\u662f\u4e0d\u662f\uff1f\n\n\u8bf6\u4e0d\u5bf9\u554a\uff0c\u6211\u4eec\u8981\u6c42\u7684\u662f$i$\u5230\u5730\u9762\u7684\u7535\u52bf\u5dee\u554a\uff1f\u6211\u4eec\u8fd8\u8981\u601d\u8003\u4e00\u4e0b\u63a5\u5730\u8282\u70b9\u7684\u8fb9\u754c\u5904\u7406\u3002\n\n\u53f6\u5b50\u8282\u70b9$i$\u5728\u539f\u56fe\u4e2d\u7684\u5ea6\u6570\u4e3a1\uff0c\u7b97\u4e0a\u63a5\u5730\u7684\u4e00\u6761\u8fb9\uff0c\u5ea6\u6570\u4e3a2\u3002\u5730\u9762\u7684\u7535\u52bf\u4e3a$0$\u3002\u56e0\u6b64\uff1a\n\n$$\\varphi_i=\\frac{\\varphi_{fa}-E_i}{2}$$\n\n\u6545\uff1a\n\n$$K_i=\\frac{1}{2}$$\n\n$$B_i=\\frac{-E_i}{2}$$\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u6c42\u5f97\u7684$\\varphi_i$\u5c31\u662f$i$\u70b9\u5230\u5730\u9762\u7684\u7535\u52bf\u5dee\u4e86\u3002\n\n$K$\u4e0e\u7535\u8def\u4e2d\u7684\u7535\u6e90\u65e0\u5173\uff0c\u53ef\u4ee5\u9884\u5904\u7406\u76f4\u63a5\u6c42\u3002\u52a0\u7535\u6e90\u7684\u65f6\u5019\u66b4\u529b\u5411\u4e0a\u4fee\u6539$B$\u5373\u53ef\u3002\u67e5\u8be2\u7535\u52bf\u5dee\u7684\u65f6\u5019\u4e5f\u662f\u5411\u4e0adark\u2642\u529b\u626b\u4e00\u904d\u3002\u7531\u4e8e\u94fe\u957f\u4e0d\u8d85\u8fc750\uff0c\u5176\u590d\u6742\u5ea6\u5b8c\u5168\u6b63\u786e\u3002\n\n```\n#include<cstdio>\n#include<cctype>\n#include<algorithm>\n\nstruct Edge\n{\n    int to,next;\n}edge[100005];\nint head[50005],cnt;\n\nvoid Add_edge(int u,int v)\n{\n    edge[++cnt]=(Edge){v,head[u]};\n    head[u]=cnt;\n    edge[++cnt]=(Edge){u,head[v]};\n    head[v]=cnt;\n}\n\nint root;\n\nint degree[50005],fa[50005];\n\ndouble k[50005],b[50005],sum_b[50005],U[50005],sum_u[50005];\n\nvoid init_k(int u,int f)\n{\n    fa[u]=f;\n    double sum_k=0;\n    for(int i=head[u];i;i=edge[i].next)\n    {\n        int v=edge[i].to;\n        if(v!=f)\n        {\n            init_k(v,u);\n            sum_k+=k[v];\n        }\n    }\n    k[u]=1.0/(degree[u]-sum_k);\n}\n\nvoid Add_b(int u,int e)\n{\n    if(u==0)\n        return;\n    else\n    {\n        sum_b[fa[u]]-=b[u];\n        b[u]=(sum_b[u]+sum_u[u]-U[u])*k[u];\n        sum_b[fa[u]]+=b[u];\n        Add_b(fa[u],e);\n    }\n}\n\nvoid Modify(int u,int v,int e)\n{\n    if(fa[v]==u)\n    {\n        std::swap(u,v);\n        e=-e;\n    }\n    U[u]+=e;\n    sum_u[v]+=e;\n    Add_b(u,e);\n}\n\ndouble Query(int u)\n{\n    if(u==0)\n    {\n        return 0;\n    }\n    return k[u]*Query(fa[u])+b[u];\n}\n\nint main()\n{\n    int n,m,u,v,e;\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1;i<n;++i)\n    {\n        scanf(\"%d%d\",&u,&v);\n        Add_edge(u,v);\n        ++degree[u];\n        ++degree[v];\n    }\n    \n    for(int i=1;i<=n;++i)\n    {\n        if(degree[i]==1)\n        {\n            Add_edge(i,0);\n            degree[0]=1;\n            break;\n        }\n    }\n    for(int i=1;i<=n;++i)\n    {\n        if(degree[i]==1)\n            degree[i]=2;\n    }\n    init_k(0,0);\n    \n    while(m--)\n    {\n        char ch=getchar();\n        while(!isalpha(ch))\n        {\n            ch=getchar();\n        }\n        if(ch=='Q')\n        {\n            scanf(\"%d\",&u);\n            printf(\"%.12lf\\n\",Query(u));\n        }\n        else\n        {\n            scanf(\"%d%d%d\",&u,&v,&e);\n            Modify(u,v,e);\n        }\n    }\n    return 0;\n}\n```",
        "postTime": 1540699546,
        "uid": 53374,
        "name": "SuperJvRuo",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4020 \u3010[CTSC2012]\u7535\u963b\u7f51\u7edc\u3011"
    }
]