[
    {
        "content": "\u8fd9\u662f\u4e00\u9053\u6982\u7387+\u6811\u5f62$dp$\n\n\u9996\u5148\u6211\u4eec\u770b\u5230\u8fd9\u91cc\u6bcf\u4e00\u4e2a\u7684\u8d21\u732e\u90fd\u662f1\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u6c42\u7684**\u671f\u671b\u5c31\u662f\u6982\u7387**\n\n\u6c42\u5f97\u5176\u5b9e\u5c31\u662f\u8fd9\u4e2a\n\n$$\\sum_{i=1}^nP_i$$\n\n$P_i$\u4e3a\u8282\u70b9$i$\u901a\u7535\u7684\u6982\u7387\n\n\u663e\u7136\u8282\u70b9$i$\u901a\u7535\u6709\u4e09\u79cd\u53ef\u80fd\n\n1. \u5b83\u81ea\u5df1\u6765\u7535\u4e86\n\n1. \u5b83\u7684\u5b50\u6811\u91cc\u6709\u4e00\u4e2a\u70b9\u6765\u7535\u4e86\u4f20\u4e86\u8fc7\u6765\n\n1. \u5b83\u7684\u5b50\u6811\u5916\u9762\u6709\u4e00\u4e2a\u70b9\u6765\u7535\u4e86\u4f20\u4e86\u8fc7\u6765\n\n\u7b2c\u4e00\u79cd\u60c5\u51b5\u6700\u597d\u8003\u8651\u4e86\uff0c\u81f3\u4e8e\u7b2c\u4e8c\u79cd\u548c\u7b2c\u4e09\u79cd\u6211\u4eec\u597d\u50cf\u5f88\u96be\u89e3\u51b3\u7684\u6837\u5b50\n\n\u4f46\u662f\u8fd9\u663e\u7136\u4e5f\u544a\u8bc9\u4e86\u6211\u4eec\u8fd9\u662f\u4e00\u4e2a\u5957\u8def\u9898\uff0c\u7b2c\u4e8c\u79cd\u548c\u7b2c\u4e09\u79cd\u6b63\u597d\u5c31\u662f\u6811\u89c4\u91cc\u7684$up$ $and$ $down$\u601d\u60f3\n\n\u4e8e\u662f\u6211\u4eec\u8bbe$h[i]$\u8868\u793a\u7b2c$i$\u4e2a\u8282\u70b9\u901a\u7535\u7684\u6982\u7387\uff0c\u4e4b\u540e\u6211\u4eec\u5229\u7528$up$ $and$ $down$\u601d\u60f3\uff0c\u5728\u7b2c\u4e00\u904ddfs\u7684\u8fc7\u7a0b\u4e2d\uff0c$h[i]$\u8868\u793a$i$\u901a\u7535\u7684\u6982\u7387\uff0c\u4e14\u7535\u4e00\u5b9a\u6765\u81ea\u5b83\u81ea\u5df1\u6216\u8005\u5b83\u7684\u5b50\u6811\u91cc\uff08\u5bf9\u5e94\u7b2c\u4e00\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff09\uff0c\u5728\u7b2c\u4e8c\u904ddfs\u7684\u65f6\u5019\u88ab\u66f4\u65b0\u6210\u4e3a\u7535\u6765\u81ea\u4e8e\u4efb\u4f55\u5730\u65b9\u7684\u6982\u7387\uff08\u5bf9\u5e94\u6240\u6709\u60c5\u51b5\uff09\n\n\u6700\u5f00\u59cb\u521d\u59cb\u5316\uff0c$h[i]=a[i]*0.01$\u7535\u53ea\u80fd\u6765\u81ea\u81ea\u5df1\n\n\u4e4b\u540e\u7b2c\u4e00\u904ddfs\uff0c\u6811\u5f62dp\u91cc\u7684$up$\uff0c\u6211\u4eec\u8981\u5c06\u5b50\u6811\u7684\u4fe1\u606f\u5408\u5e76\u7ed9\u6839\uff0c\u7531\u4e8e\u6839\u901a\u7535\u8fd8\u662f\u6709\u4e24\u79cd\u53ef\u80fd\n\n1. \u6839\u81ea\u5df1\u6765\u7535\u4e86\n\n1. \u513f\u5b50\u6765\u7535\uff0c\u513f\u5b50\u901a\u5411\u6839\u7684\u8fb9\u5bfc\u7535\n\n\u663e\u7136\u8fd9\u4e24\u79cd\u60c5\u51b5\u53ea\u9700\u8981\u6ee1\u8db3\u4e00\u79cd\u5c31\u591f\u4e86\n\n\u4f46\u662f\u5408\u5e76\u4e4b\u540e\u7684\u6982\u7387\u662f\u591a\u5c11\u5462\uff0c\u76f4\u63a5\u52a0\u8d77\u6765\u663e\u7136\u662f\u4e0d\u5bf9\u7684~~\u800c\u6211\u8fd8\u771f\u52a0\u4e86\u8d77\u6765~~\n\n\u6211\u4eec\u8003\u8651\u6709\u4e24\u4e2a\u4e8b\u4ef6$A,B$\uff0c\u53d1\u751f\u7684\u6982\u7387\u5206\u522b\u662f$P(A),P(B)$\uff0c\u90a3\u4e48\u81f3\u5c11\u53d1\u751f\u4e00\u4ef6\u7684\u6982\u7387\u5e94\u8be5\u662f\n\n$$P(A)+P(B)-P(A)*P(B)$$\n\n\u8fd9\u4e2a\u600e\u4e48\u63a8\u51fa\u6765\u7684\uff0c\u5f88\u7b80\u5355\uff0c\u81f3\u5c11\u53d1\u751f\u4e00\u4ef6\uff0c\u90a3\u4e48\u5c31\u6709\u4e09\u79cd\u53ef\u80fd\n\n1. $A$\u53d1\u751f$B$\u4e0d\u53d1\u751f\uff0c\u90a3\u4e48\u5219\u4e3a$P(A)*(1-P(B))$\n\n1. $B$\u53d1\u751f$A$\u4e0d\u53d1\u751f\uff0c\u90a3\u4e48\u5219\u4e3a$P(B)*(1-P(A))$\n\n1. $A,B$\u4e00\u8d77\u53d1\u751f\uff0c\u90a3\u4e48\u5219\u4e3a$P(A)*P(B)$\n\n\u4e09\u9879\u5408\u8d77\u6765\u6700\u540e\u4e00\u5316\u5c31\u662f$P(A)+P(B)-P(A)*P(B)$\n\n\u6240\u4ee5\u6211\u4eec\u5408\u5e76\u6839\u548c\u5b50\u6811\u7684\u4fe1\u606f\u7684\u65f6\u5019\uff0c$P(A)=h[i],P(B)=h[j]*p(i,j)$\uff0c$i$\u662f\u5b50\u6811\u7684\u6839\uff0c$j$\u662f$i$\u7684\u513f\u5b50,$p(i,j)$\u662f\u8fd9\u6761\u8fb9\u5bfc\u7535\u7684\u6982\u7387\n\n\u6240\u4ee5$h[i]=P(A)+P(B)-P(A)*P(B)$\n\n\u4e4b\u540e\u6211\u4eec\u5c31\u8981\u8003\u8651$down$\u4e86\uff0c\u4e00\u4e2a\u8282\u70b9\u6709\u70b9\u4e5f\u6709\u53ef\u80fd\u6765\u81ea\u5b83\u7684\u7236\u4eb2\uff0c\u4e8e\u662f\u6211\u4eec\u91c7\u7528$down$\u7684\u601d\u60f3\u7528\u7236\u4eb2\u66f4\u65b0\u513f\u5b50\n\n\u663e\u7136\u6211\u4eec\u66f4\u65b0\u4e00\u4f4d\u7236\u4eb2\u7684\u67d0\u4e2a\u513f\u5b50\uff0c\u663e\u7136\u6211\u4eec\u53ea\u80fd\u7528\u5176\u4ed6\u70b9\u6765\u7535\u4f20\u5230\u7236\u4eb2\u7684\u6982\u7387\u6765\u66f4\u65b0\u8fd9\u4e2a\u513f\u5b50\n\n\u4e8e\u662f\u6211\u4eec\u8bbe$P(B)=h[j]*p(i,j)$\uff0c\u800c\u4e14\u6709\n\n$$P(A)+P(B)-P(A)*P(B)=h[i]$$\n\n\u6211\u4eec\u8981\u6c42\u7684\u662f$P(A)$\u5373\u9664\u4e86$j$\u8fd9\u68f5\u5b50\u6811\u5176\u4ed6\u70b9\u6765\u7535\u4f7f\u5f97$i$\u6709\u7535\u7684\u6982\u7387\n\n\u4e8e\u662f\u89e3\u4e00\u4e0b\u8fd9\u4e2a\u65b9\u7a0b\n\n$$P(A)-P(A)*P(B)=h[i]-P(B)$$\n\n$$P(A)*(1-P(B))=h[i]-P(B)$$\n\n$$P(A)=\\frac{h[i]-P(B)}{1-P(B)}$$\n\n\u800c\u4e4b\u540e\u6211\u4eec\u53bb\u66f4\u65b0\u513f\u5b50\u7684\u8bdd\u8fd8\u6709\u4e00\u8fb9\u662f\u5426\u5bfc\u7535\u9700\u8981\u8003\u8651\uff0c\u4e8e\u662f\n\n$$h[j]=h[j]+(P(A)*p(i,j))-h[j]*P(A)*p(i,j)$$\n\n\u4e4b\u540e\u5c31\u6ca1\u6709\u5566\uff0c\u540c\u65f6\u8fd8\u6709\u4e00\u4e2a\u975e\u5e38\u5751\u7684\u5730\u65b9\u5c31\u662f\u5982\u679c$P(B)=h[j]*p(i,j)=1$\n\n\u90a3\u4e48\u9664\u4ee5$1-P(B)$\u80af\u5b9a\u4f1a\u51fa\u9519\uff0c\u7531\u4e8e$h[j]$\u90fd\u5df2\u7ecf\u662f1\u4e86\uff0c\u663e\u7136\u6ca1\u6709\u4ec0\u4e48\u5fc5\u8981\u53bb\u66f4\u65b0\u5b83\u4e86\uff0c\u4e8e\u662f\u53ef\u4ee5\u76f4\u63a5\u8df3\u8fc7\u8fd9\u4e00\u5c42\u63a5\u7740\u5f80\u4e0b\u66f4\u65b0\u5c31\u597d\u4e86\n```cpp\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#define re register\n#define maxn 500005\n#define eps 1e-7\nstruct node\n{\n    int v,nxt,w;\n}e[maxn<<1];\nint num,n,m;\nint a[maxn],head[maxn],deep[maxn];\ndouble h[maxn];\ndouble ans;\ninline int read()\n{\n    char c=getchar();\n    int x=0;\n    while(c<'0'||c>'9') c=getchar();\n    while(c>='0'&&c<='9')\n      x=(x<<3)+(x<<1)+c-48,c=getchar();\n    return x;\n}\ninline void add_edge(int x,int y,int z)\n{\n    e[++num].v=y;\n    e[num].nxt=head[x];\n    e[num].w=z;\n    head[x]=num;\n}\nvoid dfs(int x)//up\n{\n    for(re int i=head[x];i;i=e[i].nxt)\n    if(!deep[e[i].v])\n    {\n        deep[e[i].v]=deep[x]+1;\n        dfs(e[i].v);\n        double k=h[e[i].v]*double(e[i].w)/100;\n        h[x]=h[x]+k-h[x]*k;\n    }\n}\ninline int check(double aa,double bb)\n{\n    if(aa+eps>bb&&aa-eps<bb) return 1;\n    return 0;\n}\nvoid redfs(int x)//down\n{\n    ans+=h[x];\n    for(re int i=head[x];i;i=e[i].nxt)\n    if(deep[e[i].v]>deep[x])\n    {\n        if(check(h[e[i].v]*double(e[i].w)/100,1)) \n        {\n            redfs(e[i].v);\n            continue;\n        }\n        double k=(h[x]-h[e[i].v]*double(e[i].w)/100)/(1-h[e[i].v]*double(e[i].w)/100);\n        k*=double(e[i].w)/100;\n        h[e[i].v]=h[e[i].v]+k-k*h[e[i].v];\n        redfs(e[i].v);\n    }\n}\nint main()\n{\n    n=read();\n    int x,y,z;\n    for(re int i=1;i<n;i++)\n    {\n        x=read();\n        y=read();\n        z=read();\n        add_edge(x,y,z),add_edge(y,x,z);\n    }\n    for(re int i=1;i<=n;i++)\n        a[i]=read(),h[i]=a[i]*0.01;\n    deep[1]=1;\n    dfs(1);\n    redfs(1);\n    printf(\"%.6lf\",ans);\n    return 0;\n} \n\n```",
        "postTime": 1535539509,
        "uid": 35178,
        "name": "asuldb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4284 \u3010[SHOI2014]\u6982\u7387\u5145\u7535\u5668\u3011"
    },
    {
        "content": "## \u6982\u7387+\u6811\u578bdp\n\n### Part I\n\n\u62ff\u5230\u8fd9\u9053\u9898\u7684\u4e00\u77ac\u95f4\uff0c\u53cd\u5e94\u4e86\u4e00\u4e0b\u2014\u2014**\u8fd9\u4e0d\u662f\u9053\u5047\u671f\u671b\u9898\u5417\uff1f**\n\n\u4e3a\u4ec0\u4e48\uff1f\u6211\u4eec\u8003\u8651\u8fd9\u9053\u9898\u7684\u7b54\u6848\n\n$$\\sum p_i*w_i$$\n\n\u800c\uff0c$w_i$\u5168TMD\u662f$1$ \uff01\uff01\uff01\u6240\u4ee5\uff0c\u5c31\u5bf9$p_i$**\u6c42\u4e2a\u548c**\u5c31\u884c\u4e86\u3002\n\n**\u6240\u4ee5\u8fd9\u9898\u662f\u6982\u7387dp**\n\n___\n\n### Part II\n\n\u8003\u8651\u8fd9\u4e2adp\u600e\u4e48\u5199,\u4e00\u7247\u4e4c\u9e26\u98de\u8fc7\uff0c\u8fd9TM\u600e\u4e48\u5199\u554a\uff01\uff01\uff01\n\n\u806a\u660e\u7684\u540c\u5b66\u4e0d\u96be\u53d1\u73b0\uff0c\u6211\u4eec\u4efb\u610f\u9009\u53d6\u4e00\u4e2a\u70b9\u4f5c\u4e3a\u6839\uff0c\u7136\u540e\u8003\u8651\u6bcf\u4e2a\u8282\u70b9\uff0c\u4e0d\u4ec5\u5b83\u7684\u5b50\u8282\u70b9\u53ef\u4ee5\u5bf9\u5b83\u4eae\u7684\u6982\u7387\u4ea7\u751f\u8d21\u732e\uff0c\u5b83\u7684**\u7236\u8282\u70b9\u540c\u6837\u53ef\u4ee5\u4ea7\u751f\u8d21\u732e**\u3002\n\n\u8fd9\u548bdp\u554a\uff1f\u8fd9dp\u4e2ap\u554a\uff1f\n\n\u8bf6\uff1f\u597d\u50cf\u6709\u4e2a\u505a\u6cd5\uff1a\u6211\u4eec\u679a\u4e3e\u6bcf\u4e2a\u513f\u5b50\u4e3a\u6839\uff0c\u7136\u540e\u5bf9\u6bcf\u79cd\u60c5\u51b5\u8fdb\u884c\u5904\u7406\uff0c\u6bcf\u6b21\u6839\u8282\u70b9\u7684\u7b54\u6848\u662f\u6b63\u786e\u7684\uff0c\u56e0\u4e3a\u5b83\u6ca1\u6709\u7236\u4eb2~~\uff08\u6ca1\u7239\u7684\u5b69\u5b50\u679c\u7136\u7b80\u5355\u6613\u61c2\u5462\uff09~~\u3002\u590d\u6742\u5ea6$O(n^2)$,\u770b\u4e00\u773c\u6570\u636e\u8303\u56f4\uff0c50w\uff0cemmm\uff0c~~\u677e\u677e\u677en\u65b9\u8fc7\u767e\u4e07~~\u663e\u7136\u8fc7\u4e0d\u53bb\n\n\u8003\u8651\u4f18\u5316\uff0c\u53d1\u73b0\u6bcf\u6b21\u6362\u6839\u7684\u8d21\u732e\u53ea\u6709\u4e00\u90e8\u5206\u70b9\uff0c\u6211\u4eec\u628a\u8fd9\u4e9b\u70b9\u7ef4\u62a4\u4e00\u4e0b\uff0c\u590d\u6742\u5ea6\u3002\u3002\u3002\u7b49\u7b49\uff0c\u8fd9\u548b\u5199\u554a\uff1f\u7136\u540e\uff0c\u6211\u7684\u601d\u8def\u5c31\u79bb\u6b63\u89e3\u8d8a\u6765\u8d8a\u8fdc\u3002\u3002\u3002~~\u601d\u8def\u9010\u6e10\u53d8\u6001~~\n\n___\n\n### Part III\n\n\u4e0a\u56de\u4e66\u8bf4\u5230\uff0c\u6bcf\u4e2a\u70b9\u7684\u6982\u7387\u6765\u6e90\u6709\u4e09\n\n- \u5b83\u7684\u5b50\u8282\u70b9\u5bf9\u5b83\u7684\u8d21\u732e\uff08\u5373\u6574\u68f5\u5b50\u6811\u4e2d\u6709\u8282\u70b9\u8fdb\u5165\u5145\u7535\u72b6\u6001\uff0c\u4e14\u901a\u8fc7\u8fb9\u4f20\u9012\u7ed9\u5b83\u7684\u6982\u7387\uff09\n\n- \u5b83\u81ea\u5df1\u7684\u8d21\u732e\uff08\u5373\u5b83\u6700\u521d\u4e3a\u5145\u7535\u72b6\u6001\u7684\u6982\u7387\uff09\n\n- \u5b83\u7684\u7236\u8282\u70b9\u5bf9\u5b83\u7684\u8d21\u732e\uff08\u5373\u9664\u5b50\u6811\u5916\u7684\u90e8\u5206\u6709\u8282\u70b9\u8fdb\u5165\u5145\u7535\u72b6\u6001\uff0c\u4e14\u901a\u8fc7\u8fb9\u4f20\u9012\u7ed9\u5b83\u7684\u6982\u7387\uff09\n\n\u5982\u679c\u53ea\u8003\u8651\u524d\u4e24\u4e2a\uff0c\u8c8c\u4f3cdp\u65b9\u7a0b\u6bd4\u8f83\u663e\u7136\n\n$$dp[now]+=(1-dp[now])\\times dp[v]\\times e[i].val$$\n\n\u5176\u4e2d\uff0c$dp[x]$\u6307\u70b9$x$\u7684\u6982\u7387\uff0c$v$\u662f$now$\u7684\u5b50\u8282\u70b9\uff0c$e[i].val$\u662f\u8fde\u63a5$now$,$v$\u7684\u8fb9\u8fde\u901a\u7684\u6982\u7387\n\n\u7136\u540e\uff0c\u8003\u8651\u7236\u8282\u70b9\u7684\u8d21\u732e\u3002\u6211\u4eec\u7528\u4e0a\u9762dp\u8f6c\u79fb\u51fa\u7684\u6982\u7387\u4ece\u6839\u8282\u70b9\u5411\u4e0b\u8f6c\u79fb\uff0c\u8fd9\u6837**\u6bcf\u4e2a\u8282\u70b9\u5411\u4e0b\u8f6c\u79fb\u7684\u65f6\u5019\u5df2\u7ecf\u662f\u88ab\u5145\u5206\u8ba1\u7b97\u8fc7\u7684**\uff0c\u6ca1\u6709\u540e\u6548\u6027\u3002\n\n\u611f\u89c9\u54ea\u91cc\u4e0d\u5bf9\u3002\u3002\u3002\n\n\u4ee5\u4e00\u5bf9\u513f\u7236\u5b50\u5173\u7cfb\u4e3a\u4f8b\uff0c$a$\u662f$b$\u7684\u7236\u8282\u70b9\u3002\u7b2c\u4e00\u904ddp\u7684\u65f6\u5019\uff0c**$b$\u5bf9$a$\u4ea7\u751f\u4e86\u8d21\u732e**\uff0c\u7b2c\u4e8c\u904ddp\u65f6**\u8fd9\u4e2a\u8d21\u732e\u53c8\u4f5c\u4e3a$a$\u7684\u4e00\u90e8\u5206\u8d21\u732e\u7ed9\u4e86$b$**\u3002\n\n\u53d1\u73b0\u7edf\u8ba1\u91cd\u590d\u4e86\uff0c\u6211\u4eec\u9700\u8981\u7684\u662f**$b$\u5bf9$a$\u4f5c\u8d21\u732e\u524d$a$\u7684dp\u503c**\uff0c\u6362\u8a00\u4e4b\uff0c\u5373**\u628a$b$\u5bf9$a$\u505a\u7684\u8d21\u732e\u6392\u9664\u51fa\u53bb**\u3002\n\n\u8003\u8651\u7b2c\u4e00\u904d\u7684dp\u65b9\u7a0b\n\n$$dp[a]_{now}=dp[a]_{last}+(1-dp[a]_{last})\\times dp[b]\\times e[i].val$$\n\n\u6bcf\u4e2a\u53d8\u91cf\u7684\u610f\u4e49\u4e0a\u540c\uff0c\u7279\u6b8a\u5730\uff0c\u6211\u4eec\u533a\u5206\u4e86$dp[a]_{now}$\u4e0e$dp[a]_{last}$\uff0c\u5206\u522b\u6307**\u8f6c\u79fb\u540e\u7684dp[a] (\u5373\u73b0\u5728\u5df2\u77e5\u7684dp[a])** \u4e0e **\u8f6c\u79fb\u524d\u7684dp[a] (\u5373\u6240\u6c42\u7684,\u5bf9dp[b] \u5728\u7b2c\u4e8c\u6b21dp\u4e2d\u4ea7\u751f\u8d21\u732e\u7684\u90e8\u5206\uff09**\n\n\u5316\u7b80\u53ef\u5f97\n\n$$dp[a]_{last}=\\dfrac{dp[a]_{now}-dp[b]\\times e[i].val}{1-dp[b]\\times e[i].val}$$\n\n\u6c42\u5f97$dp_{last}$\u540e\uff0c\u6cbf\u7528\u7b2c\u4e00\u6b21\u7684\u8f6c\u79fb\n\n$$dp[b]+=(1-dp[b])\\times dp[a]_{last}\\times e[i].val$$\n\n\u8fdb\u884c\u7b2c\u4e8c\u6b21dp\uff0c\u6240\u5f97\u7684\u7ed3\u679c\u5c31\u662f\u6700\u7ec8\u7b54\u6848\u3002\u6b64\u9898\u5b8c\u7ed3\u3002\n\n\u53e6\u5916\u8fd8\u6709\u4e00\u4e9b\u7ec6\u8282\u89c1\u4ee3\u7801\uff08\u5f53\u7136\uff0c\u770b\u5b8c\u4e0a\u9762\u7684\u90a3\u4e9b\u8981\u662f\u81ea\u5df1\u80fd\u6253\u51fa\u6765\u5c31\u4e0d\u8981\u770b\u4ee3\u7801\u4e86\uff09\n\n___\n\n### Part IV\n\n\u53c8\u5230\u4e86\u559c\u95fb\u4e50\u89c1\u7684\u653e\u4ee3\u7801\u73af\u8282\n\n```\n#include<bits/stdc++.h>\n\nusing namespace std;\n\nconst double eps=1e-7;\n\nstruct Edge\n{\n    int to,nxt;\n    double val;\n    Edge(){}\n    Edge(int to,int nxt,double val):to(to),nxt(nxt),val(val){}\n}e[1000010];\nint head[500010],cnt;\n\nvoid addedge(int u,int v,double val)\n{\n    e[++cnt]=Edge(v,head[u],val);\n    head[u]=cnt;\n}\n\nint n;\ndouble dp[500010];\n\nvoid dfs1(int now,int fa)//\u7b2c\u4e00\u904ddp\n{\n    for(int i=head[now];i;i=e[i].nxt)\n    {\n        int vs=e[i].to;\n        if(fa==vs) continue;\n        dfs1(vs,now);\n        dp[now]+=dp[vs]*(1-dp[now])*e[i].val;\n    }\n}\n\nvoid dfs2(int now,int fa)//\u7b2c\u4e8c\u904ddp\n{\n    for(int i=head[now];i;i=e[i].nxt)\n    {\n        int vs=e[i].to;\n        if(fa==vs) continue;\n        if(fabs(1-dp[vs]*e[i].val)<=eps) \n        //\u5751\uff1a\u5982\u679c\u5206\u6bcd\u4e3a0\u76f4\u63a5\u8df3\u8fc7\u3002\n        //\u539f\u56e0\uff1a\u5206\u6bcd\u4e3a0\u8bf4\u660edp[vs]\u4e3a1\uff0c\u4e0d\u9700\u8981\u8d21\u732e\n        {\n            dfs2(vs,now);\n            continue;\n        }\n        dp[vs]+=(1-dp[vs])*(dp[now]-dp[vs]*e[i].val)/(1-dp[vs]*e[i].val)*e[i].val;\n        dfs2(vs,now);\n    }\n}\n\nint main()\n{\n    cin>>n; \n    for(int i=1;i<n;i++)\n    {\n        int u,v;\n        double val;\n        cin>>u>>v>>val;\n        addedge(u,v,val/100);\n        addedge(v,u,val/100);\n    }\n    for(int i=1;i<=n;i++)\n    {\n        cin>>dp[i];//\u81ea\u5df1\u7684\u8d21\u732e\u4e00\u5f00\u59cb\u5c31\u7b97\u8fdb\u53bb\n        dp[i]/=100;\n    }\n    dfs1(1,0);\n    dfs2(1,0);\n    double ans=0;\n    for(int i=1;i<=n;i++)\n    {\n        ans+=dp[i];\n    }\n    cout<<fixed<<setprecision(6);//\u4fdd\u75596\u4f4d\u5c0f\u6570\n    cout<<ans<<endl;\n}\n```\n\n___\n\n### Part V\n\n\u56de\u8fc7\u5934\u6765\u770b\u8fd9\u9053\u9898\uff0c\u53d1\u73b0\u6211\u4e00\u5f00\u59cb\u7684\u601d\u8def\u5e76\u6ca1\u6709\u95ee\u9898\uff0c\u53ea\u662f\u6ca1\u60f3\u6e05\u695a\u3002\n\n\u6211\u4eec\u7edf\u8ba1\u7236\u8282\u70b9\u8d21\u732e\u7684\u65f6\u5019\uff0c**\u672c\u8d28\u4e0a\u5c31\u662f\u6362\u6839,**\u628a\u539f\u6765\u7684\u7236\u8282\u70b9\u53d8\u6210\u5b50\u8282\u70b9\uff0c\u90a3\u4e48**\u539f\u6765\u5bf9\u7236\u8282\u70b9\u7684\u8d21\u732e\u8981\u8fd8\u539f\uff0c\u800c\u7236\u8282\u70b9\u8981\u5bf9\u5b50\u8282\u70b9\u8fdb\u884c\u8d21\u732e**\u3002\u800c\u7b2c\u4e8c\u904ddp\u7684\u672c\u8d28\u662f\u5bf9\u91cd\u590d\u4fe1\u606f\u7684\u5229\u7528\uff0c\u4ee5\u8fbe\u5230\u6362\u6839\u6548\u7387\u7684\u6700\u4f18\u6548\u679c\u2014\u2014$O(1)$\u6362\u6839\u3002\n\n\u9898\u76ee\u4e0d\u9519\uff0c\u503c\u5f97\u4e00\u505a\u3002",
        "postTime": 1546245791,
        "uid": 53241,
        "name": "partychicken",
        "ccfLevel": 6,
        "title": "\u3010[SHOI2014]\u6982\u7387\u5145\u7535\u5668\u3011\u89e3\u9898\u62a5\u544a"
    },
    {
        "content": "# P4284 [SHOI2014]\u6982\u7387\u5145\u7535\u5668\u9898\u89e3\r\n###  update : 2021/10/13-3 \u82f1\u6587,\u6570\u5b57\u4e4b\u95f4\u589e\u52a0\u7a7a\u683c\uff0c\u5e76\u4f18\u5316\u516c\u5f0f,\u53d8\u91cf\u7684  latex\r\n---\r\n### \u6982\u7387+\u6811\u5f62 DP\r\n### [\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P4284)\r\n---\r\n## \u7b80\u5316\u9898\u76ee\r\n\u7ed9\u51fa\u4e00\u9897\u65e0\u6839\u6811\uff0c\u6811\u4e0a\u6bcf\u4e00\u4e2a\u70b9\u6709\u6982\u7387 $p$\uff0c\u5bf9\u4e8e\u8fb9 $e_i=(u,v)$ \u5b58\u5728 $p_i$ \u6982\u7387\u8054\u901a $u\\,v$\uff0c\u6c42 $\\sum_{i=1}^np_i$\r\n## \u5206\u6790\r\n\u4e0d\u96be\u60f3\u5230\uff0c\u672c\u9898\u9700\u8981\u4f7f\u7528 DP ,\u600e\u4e48\u4f7f\u7528\u5173\u952e\u5728\u4e8e\u8981\u77e5\u9053 DP \u8f6c\u79fb\u7684\u76f8\u5173\u53d8\u91cf\uff0c\u6211\u4eec\u5148\u786e\u5b9a\u53ef\u80fd\u53c2\u52a0 DP \u7684\u53d8\u91cf\uff0c\u5728\u4e00\u6b65\u4e00\u6b65\u7f29\u5708\uff0c\u6700\u540e**\u6839\u636e\u53d8\u91cf\u786e\u5b9a\u65b9\u7a0b**\u3002\r\n\r\n\r\n|\u53d8\u91cf\u540d| \u89e3\u91ca |\r\n|--|--|\r\n|  $ p_i $  |  $i$ \u70b9\u7684\u521d\u59cb\u6982\u7387  |\r\n|  $ P1_i $  |  $i$ \u70b9\u7684son\u4e0a\u4f20\u7684\u6982\u7387  |\r\n|  $ P2_i $  |  $i$ \u70b9\u7684\u96c6\u6210\u6982\u7387  |\r\n|  $ siz_i $  |  $i$ \u70b9\u7684\u5b50\u6811\u5927\u5c0f  |\r\n|  $ v_i $  |  $i$ \u70b9\u7684\u8fde\u8fb9\u5bf9\u5e94\u70b9  |\r\n|  $ w_i $  |  $i$ \u70b9\u7684\u8fde\u8fb9\u8054\u901a\u6982\u7387  |\r\n\r\n\r\n\r\n\u6211\u4eec\u4e00\u4e2a\u4e00\u4e2a\u53d8\u91cf\u5206\u6790\r\n\r\n-  $ p_i $ \u53ef\u80fd\u4f1a\u53c2\u52a0\u65b9\u7a0b\uff0c\u4f46\u662f\u8003\u8651\u5230 DP \u7684\u72b6\u6001\u96c6\u6210\u601d\u60f3\uff0c $P1,P2$  \u66f4\u6709\u53ef\u80fd\u53c2\u52a0\u65b9\u7a0b\u3002\r\n\r\n- \u5bf9\u4e8e\u8fd9\u9053\u9898\u5b50\u6811\u7684\u5927\u5c0f\u4ee5\u53ca\u7c7b\u4f3c(  $ dep,fa $  )\u7b49\u70b9\u7279\u5f81\u53d8\u91cf\u5f88\u96be\u5173\u7cfb\u5230**\u6811\u5f62DP**,\u6240\u4ee5\u6682\u65f6\u4e0d\u8003\u8651\uff0c\u5982\u679c\u9898\u76ee\u9700\u8981\u7279\u5f81\u4f1a\u5728\u540e\u671f\u7a81\u51fa\uff0c\u6682\u65f6\u4e0d\u8003\u8651\u3002\r\n\r\n-  $v,w$ \u660e\u663e\u4f1a\u662f\u8f6c\u79fb\u5bf9\u8c61\r\n\u6240\u4ee5\u6211\u4eec\u5148\u521d\u6b65\u786e\u5b9a\u4e00\u4e2a\u8303\u5f0f:\r\n$$\r\nP2_i=ans(P1_v,w_{i->v},P2_v,P2_i,P1_i)\r\n$$\r\n\r\n## \u601d\u8003\u60c5\u51b5\r\n1.\u81ea\u5df1\u6765\u7535 $p_i$\u3002\r\n\r\n2.\u5b50\u6811\u4e0a\u4f20 $P2_i$\u3002\r\n\r\n3.\u4e0e\u7236\u4eb2\u7684\u5173\u7cfb $ g(P2_fa_i,P1_i) $ (g \u8868\u793a\u5b58\u5728\u51fd\u6570\u5173\u7cfb)\u3002\r\n\r\n(3):\u6765\u81ea\u7236\u8282\u70b9\u6240\u4ee5\u6982\u7387-\u7236\u8282\u70b9\u4ece i \u5f97\u6765\u7684\u6982\u7387\u3002\r\n## \u6982\u7387\u5408\u5e76\r\n$$\r\n\\operatorname{P}(a)\\cup\\operatorname{P}(b)\r\n  =  1-  (  \\neg\\operatorname{P}(a)\\cap\\neg\\operatorname{P}(b))=  \\operatorname{P}(a)+\\operatorname{P}(b)-\\operatorname{P}(a)\\cap\\operatorname{P}(b)\r\n$$\r\n(update: \u683c\u5f0f\u5316\u516c\u5f0f )\r\n\r\n\u4e8e\u662f\u53ef\u4ee5\u6109\u5feb\u7684\u8f6c\u79fb\u4e86\u3002\r\n\r\n\u5bf9\u4e8e\u7b2c3\u79cd\u8f6c\u79fb\u60c5\u51b5\u6709\u4e00\u4e2a\u65b9\u7a0b\u53ef\u4ee5\u624b\u89e3\uff0c\u5efa\u8bae\u81ea\u5df1\u89e3\u4e00\u89e3\uff0c\u4ee3\u7801\u91cc\u4e5f\u6709\u3002\r\n## \u5b8c\u6574\u4ee3\u7801\r\n```c++\r\n#include<bits/stdc++.h>\r\n#define ll long long\r\n#define db double\r\n#define fd(i, a, b) for (ll i = a; i >= b; i--)\r\n#define r(i, a) for (ll i = fir[a]; i; i = e[i].nex)\r\n#define file(a) freopen(#a \".in\", \"r\", stdin);\r\n#define il inline\r\n#define gc getchar()\r\n#define f(i,a,b) for(ll i=a;i<=b;i++)\r\nusing namespace std;\r\nconst ll maxn=5e5+10,INF=1e16;\r\nil ll read(){\r\n    ll x=0,f=1;char ch=gc;\r\n    while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=gc;}\r\n    while(ch>='0'&&ch<='9') x=(x*10)+(ch^48),ch=gc;\r\n    return x*f;}\r\nll n,fir[maxn],cnt;\r\ndb p[maxn];\r\nstruct edge{ll to,nex;db w;}e[maxn<<2];\r\nil void add(ll a,ll b,db P){\r\n\te[++cnt].to=b,e[cnt].nex=fir[a],e[cnt].w=P;\r\n\tfir[a]=cnt;\r\n}\r\nil void dfs1(ll x,ll f){\r\n\tr(i,x){\r\n\t\tll v=e[i].to;\r\n\t\tif(v==f) continue;\r\n\t\tdfs1(v,x);\r\n\t\tdb s=e[i].w;\r\n\t\ts*=p[v];\r\n\t\tp[x]=p[x]+s-p[x]*s;\r\n\t}\r\n}\r\nil void dfs2(ll x,ll f){\r\n\tr(i,x){\r\n\t\tll v=e[i].to;\r\n\t\tif(v==f) continue;\r\n\t\tdb s=e[i].w;\r\n\t\tif(1-s*p[v]) s=(p[x]-s*p[v])/(1-s*p[v]);\r\n\t\telse s=1;\r\n\t\ts*=e[i].w;\r\n\t\tp[v]=p[v]+s-p[v]*s;\r\n\t\tdfs2(v,x);\r\n\t}\r\n}\r\nint main()\r\n{\r\n// \tfile(a);\r\n\tn=read();\r\n\tf(i,1,n-1){\r\n\t\tll a=read(),b=read();\r\n\t\tdb P=read()*0.01;\r\n\t\tadd(a,b,P),add(b,a,P);\r\n\t}\r\n\tf(i,1,n) p[i]=read()*0.01;\r\n\tdfs1(1,0);\r\n\tdfs2(1,0);\r\n\tdb ans=0;\r\n\tf(i,1,n) ans+=p[i];\r\n\tprintf(\"%.6lf\\n\", ans);\r\n}\r\n```",
        "postTime": 1633797716,
        "uid": 109992,
        "name": "\u5927\u670b\u53cb",
        "ccfLevel": 0,
        "title": "P4284 [SHOI2014]\u6982\u7387\u5145\u7535\u5668"
    },
    {
        "content": "[P4284 [SHOI2014]\u6982\u7387\u5145\u7535\u5668](https://www.luogu.com.cn/problem/P4284)\n\n\u6362\u6839 dp\u3002\n\n\u8003\u8651\u7b97\u51fa\u6bcf\u4e2a\u70b9\u7684\u6982\u7387 $P_i$\uff0c\u5229\u7528\u671f\u671b\u7684\u7ebf\u6027\u6027\uff0c$\\sum P_i$ \u5c31\u662f\u7b54\u6848\u3002\n\n\u8003\u8651\u5148\u6c42\u51fa\u6bcf\u4e2a\u70b9\u901a\u8fc7\u81ea\u5df1\u6216\u662f\u5b50\u6811\u7684\u70b9\u901a\u7535\u7684\u6982\u7387\uff0c\u8bbe\u4e3a $f_i$\u3002\n\n\u8003\u8651\u52a0\u4e0a\u4e00\u4e2a\u5b50\u6811\u65f6\uff0c\u6982\u7387\u600e\u4e48\u8f6c\u79fb\uff0c\u8bbe $w$ \u4e3a\u6839 $u$ \u4ece\u5b50\u8282\u70b9 $v$ \u53ca\u5176\u5b50\u6811\u901a\u7535\u7684\u6982\u7387\uff0c\u5373 $w = f_v * p_{u,v}$\uff0c\u8fd9\u91cc $p_{u,v}$ \u8868\u793a\u8fde\u63a5 $u,v$ \u7684\u5bfc\u7ebf\u7684\u901a\u7535\u6982\u7387\u3002\n\u90a3\u4e48 $f_u = f_u +w - f_u \\times w$\u3002\n\n\u8fd9\u91cc\u5229\u7528\u4e86\u4e00\u4e2a\u5c0f\u7684\u5bb9\u65a5\uff0c\u5373 $P(A \\cup B) = P(A) + P(B) \u2212 P(A \\cap B) = P(A) + P(B) \u2212 P(A) \\times P(B)$\u3002\n\n\u7136\u540e\u8003\u8651\u70b9 $u$ \u5982\u4f55\u4ece\u7236\u4eb2 $fa$ \u5904\u8f6c\u79fb\uff0c\u6b64\u65f6\u8981\u7b97\u51fa $fa$ \u4e0d\u4ece $u$ \u8d70\u65f6\u901a\u7535\u7684\u6982\u7387\uff0c\u8bbe\u4e3a $P_a$\u3002\n\n\u4eff\u7167\u5f00\u59cb\u6c42 $f$ \u7684\u8fc7\u7a0b\uff0c\u4ee4 $w = f_u \\times p_{u,fa}$\uff0c\u5219\u6709 $f_{fa} = P_a + w - P_a \\times w$\u3002\n\n\u6240\u4ee5 $P_a = \\frac{f_{fa} - w}{1 - w}$\u3002\uff08\u5f53 $w = 1$ \u65f6\u8be5\u5f0f\u65e0\u610f\u4e49\uff0c\u5f3a\u884c\u8ba1\u7b97\u4f1a\u5bfc\u81f4 RE\uff09\u3002\n\n\u6240\u4ee5 $fa$ \u7684\u5b50\u8282\u70b9 $u$ \u771f\u6b63\u901a\u7535\u7684\u6982\u7387 $P(u) = f_u + (P_a \\times p_{u,fa}) - f_u \\times (P_a \\times p_{u,fa})$\u3002\n\n\u590d\u6742\u5ea6  $O(n)$\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\ninline void read(int &x)\n{\n\tx = 0;\n\tint f = 0;\n\tchar ch = getchar();\n\twhile(ch < '0' || ch > '9')\n\t{\n\t\tf |= ch == '-';\n\t\tch = getchar();\n\t}\n\twhile(ch >= '0' && ch <= '9')\n\t{\n\t\tx = x * 10 + ch - 48;\n\t\tch = getchar();\n\t}\n\tx = f ? -x : x;\n\treturn;\n}\n#define N 500005\nint first[N], Next[N << 1], to[N << 1], tot;\ndouble w[N << 1];\ninline void add(int &x, int &y, double &z)\n{\n\tNext[++tot] = first[x];\n\tfirst[x] = tot;\n\tto[tot] = y;\n\tw[tot] = z;\n\treturn;\n}\ndouble f[N];\nvoid dfs1(int u, int pre)\n{\n\tfor(int i = first[u]; i; i = Next[i])\n\t{\n\t\tint v = to[i];\n\t\tif(v == pre)\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tdfs1(v, u);\n\t\tf[u] = f[u] + w[i] * f[v] - f[u] * w[i] * f[v];\n\t}\n\treturn;\n}\nvoid dfs2(int u, int pre)\n{\n\tfor(int i = first[u]; i; i = Next[i])\n\t{\n\t\tint v = to[i];\n\t\tif(v == pre)\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tif(f[v] * w[i] != 1)\n\t\t{\n\t\t\tdouble Pa = w[i] * (f[u] - f[v] * w[i]) / (1 - f[v] * w[i]);\n\t\t\tf[v] = f[v] + Pa - f[v] * Pa;\n\t\t}\n\t\tdfs2(v, u);\n\t}\n\treturn;\n}\nint n;\nsigned main()\n{\n\tint x, y;\n\tdouble z;\n\tread(n);\n\tfor(int i = 1; i < n; i++)\n\t{\n\t\tread(x), read(y);\n\t\tscanf(\"%lf\", &z);\n\t\tz /= 100.0;\n\t\tadd(x, y, z);\n\t\tadd(y, x, z);\n\t}\n\tfor(int i = 1; i <= n; i++)\n\t{\n\t\tscanf(\"%lf\", &f[i]);\n\t\tf[i] /= 100.0;\n\t}\n\tdfs1(1, 0);\n\tdfs2(1, 0);\n\tdouble ans = 0.0;\n\tfor(int i = 1; i <= n; i++)\n\t{\n\t\tans += f[i];\n\t}\n\tprintf(\"%0.6lf\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1633659400,
        "uid": 90027,
        "name": "GG_jok_er",
        "ccfLevel": 0,
        "title": "P4284 [SHOI2014]\u6982\u7387\u5145\u7535\u5668 \u9898\u89e3"
    },
    {
        "content": "\u663e\u7136\u8fd9\u662f\u4e00\u68f5\u6811\u3002\n\n\u8bbe\u8282\u70b9$i$\u548c$j$\u4e4b\u95f4\u7684\u8fb9\u4e3a$(i,j)$,\u8fb9$(i,j)$\u5bfc\u7535\u7684\u6982\u7387\u4e3a$q_{i,j}$,\u7b2c$i$\u4e2a\u70b9\u81ea\u8eab\u6709\u7535\u7684\u6982\u7387\u4e3a$p_i$\n\n\u8003\u8651\u6811\u5f62dp\u3002\n\n\u663e\u7136\u7b54\u6848\u7b49\u4e8e\u6240\u6709\u8282\u70b9\u6709\u7535\u7684\u6982\u7387\u4e4b\u548c\u3002\n\n\u8003\u8651\u4e00\u4e2a\u8282\u70b9\u4ec0\u4e48\u65f6\u5019\u4f1a\u88ab\u5145\u7535:\n\n1.\u5b83\u81ea\u5df1\u6709\u7535;\n\n2.\u5b83\u7684\u5b69\u5b50\u91cc\u6709\u8282\u70b9\u6709\u7535,\u5e76\u4e14\u8fd9\u4e2a\u5b69\u5b50\u548c\u8fd9\u4e2a\u8282\u70b9\u4e4b\u95f4\u7684\u5bfc\u7ebf\u662f\u5bfc\u7535\u7684;\n\n3.\u5b83\u7684\u7236\u4eb2\u6709\u7535,\u5e76\u4e14\u8fd9\u4e2a\u8282\u70b9\u548c\u7236\u4eb2\u4e4b\u95f4\u7684\u5bfc\u7ebf\u5bfc\u7535\u3002\n\n\u672c\u7740\u6811\u5f62dp\u7684\u601d\u8def,\u5148\u4e0d\u8003\u8651\u7236\u4eb2\u5bf9\u513f\u5b50\u7684\u5f71\u54cd,\u5373\u5148\u4e0d\u8003\u86513\u3002\n\n\u6211\u4eec\u8bbe$dp_i$\u8868\u793a\u7b2c$i$\u4e2a\u8282\u70b9\u5728\u8003\u8651\u81ea\u8eab\u53ca\u5176\u5b50\u6811\u4ee5\u540e,\u6709\u7535\u7684\u6982\u7387\u3002\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u8fd9\u6837\u4e00\u6765\u5f88\u96be\u5f97\u77e5\u67d0\u4e00\u4e2a\u513f\u5b50\u5bf9\u7236\u4eb2\u7684\u6982\u7387\u8d21\u732e\u3002\n\n\u4e8e\u662f\u6211\u4eec\u8bb0$dp_i$\u8868\u793a\u7b2c$i$\u4e2a\u8282\u70b9\u5728\u8003\u8651\u81ea\u8eab\u53ca\u5176\u5b50\u6811\u4ee5\u540e,**\u6ca1\u6709**\u7535\u7684\u6982\u7387\u3002\n\n\u6211\u4eec\u8bbe$i$\u7684\u5b69\u5b50\u4e3a$s_1,s_2,s_3,...,s_m$\u3002\n\n\u5219\u6709$dp_i=(1-p_i)\\Pi_{j=1}^m(dp_{s_j}+(1-dp_{s_j})\\times (1-q_{i,s_j})$\n\n\u89e3\u91ca:\n\n\u6211\u4eec\u77e5\u9053\u4e00\u4e9b\u65f6\u95f4\u540c\u65f6\u53d1\u751f\u7684\u6982\u7387\u4e3a\u8fd9\u4e9b\u65f6\u95f4\u72ec\u7acb\u6982\u7387\u7684\u4e58\u79ef\u3002\n\n\u8981\u8ba9$i$\u6ca1\u7535,\u5c31\u8981\u6c42\u5b83\u81ea\u5df1\u6ca1\u7535,\u5b83\u7684\u513f\u5b50\u4e5f\u5168\u90e8\u6ca1\u7535,\u6216\u8005\u6709\u7535\u7684\u5b69\u5b50\u548c$i$\u4e4b\u95f4\u7684\u5bfc\u7ebf\u4e0d\u5bfc\u7535\u3002\n\n$i$\u672c\u8eab\u6ca1\u7535\u7684\u6982\u7387\u662f$(1-p_i)$;\n\n\u5b69\u5b50$s_j$\u6ca1\u7535\u7684\u6982\u7387\u662f$dp_{s_j}$,\u5b69\u5b50$s_j$\u6709\u7535,\u4e14$(i,s_j)$\u4e0d\u5bfc\u7535\u7684\u6982\u7387\u662f$(1-dp_{s_j})\\times(1-q_{i,s_j})$,\u90a3\u4e48\u5b69\u5b50$s_j$\u5230$i$\u8fd9\u4e00\u6bb5\u6ca1\u7535\u7684\u6982\u7387\u5c31\u662f\u4e24\u8005\u7684\u548c,\u5373$dp_{s_j}+(1-dp_{s_j})\\times(1-q_{i,s_j})$\u3002\n\n\u6240\u4ee5\u4e0a\u9762\u7684\u5f0f\u5b50\u5c31\u662f\u628a\u8fd9\u4e9b\u4e1c\u897f\u4e58\u8d77\u6765\u4e86\u3002\n\n\u53d1\u73b0\u6bcf\u4e2a\u5b69\u5b50\u5bf9\u4e8e\u7b54\u6848\u7684\u8d21\u732e\u662f\u72ec\u7acb\u7684(\u8fd9\u5c31\u662f\u8bbe$dp_i$\u7684\u610f\u4e49\u7684\u7406\u7531)\u3002\n\n\u4e8e\u662f\u70b9$i$\u53bb\u9664\u5b69\u5b50$s_j$\u4ee5\u540e,\u5269\u4e0b\u90e8\u5206\u6ca1\u7535\u7684\u6982\u7387\u5c31\u662f$\\frac{dp_i}{dp_{s_j}+(1-dp_{s_j})\\times(1-q_{i,s_j})}$\u3002\n\n\u6709\u4ec0\u4e48\u7528?\n\n\u4e00\u4f1a\u513f\u5c31\u77e5\u9053\u4e86\u3002\n\n\u4e4b\u540e\u6211\u4eec\u6765\u8003\u8651\u70b9$i$\u7684\u7236\u4eb2$f_i$\u5bf9$i$\u7684\u5f71\u54cd\u3002\n\n\u6211\u4eec\u8bb0$DP_i$\u4e3a\u70b9$i$\u7684\u7236\u4eb2**\u6ca1\u6709**\u7535\u4f20\u5230$i$\u7684\u6982\u7387\u3002\n\n\u6211\u4eec\u8bb0\n\n$T=DP_{f_i}\\times \\frac{dp_{f_i}}{dp_i+(1-dp_i)\\times q_{f_i,i}}$\n\n\u4e5f\u5c31\u662f$f_i$\u4e0d\u7b97$i$\u8fd9\u68f5\u5b50\u6811,\u5269\u4e0b\u7684\u90e8\u5206\u4f7f\u5f97$f_i$\u6ca1\u7535\u7684\u6982\u7387\u3002\n\n\u90a3\u4e48\u6709\n\n$DP_i=T+(1-T)\\times(1-q_{f_i,i})$\n\n\u89e3\u91ca:\n\n\u524d\u4e00\u4e2a\u90e8\u5206\u610f\u4e49\u4e0a\u9762\u5df2\u7ecf\u63d0\u8fc7;\n\n$(1-T)$\u5373$f_i$\u4e0d\u7b97$i$\u8fd9\u68f5\u5b50\u6811,\u5269\u4e0b\u7684\u90e8\u5206\u4f7f\u5f97$f_i$\u6709\u7535\u7684\u6982\u7387,$(1-q_{f_i,i})$\u5373\u8fb9$(f_i,i)$\u4e0d\u5bfc\u7535\u7684\u6982\u7387,\u90a3\u4e48\u6574\u4e2a\u5c31\u662f$f_i$\u6709\u7535\u800c$(f_i,i)$\u6ca1\u7535\u7684\u6982\u7387\u3002\n\n\u4e24\u4e2a\u90e8\u5206\u90fd\u7b97\u5b8c\u4e86\u3002\n\n\u4e8e\u662f\u770b\u770b\u7b54\u6848\u7b49\u4e8e\u4ec0\u4e48\u3002\n\n\u70b9$i$\u6ca1\u7535\u7684\u603b\u6982\u7387\u5c31\u662f$dp_i\\times DP_i$;\n\n\u90a3\u4e48\u70b9$i$\u6709\u7535\u7684\u6982\u7387\u5c31\u662f$1-dp_i\\times DP_i$;\n\n\u7b54\u6848\u5c31\u662f$\\sum_{i=1}^n(1-dp_i\\times DP_i)$\u3002\n\ncode:\n\n```cpp\n#include<bits/stdc++.h>\n#define Merge(x,y,val) (dps[x]*=(g[y]=dps[y]+(1-dps[y])*(1-val)))\nusing namespace std;\nstruct edge{\n    int t,nxt;\n    double v;\n}e[1000010];\nint n,u,v,w,cnt,be[500010],vis[500010],f[500010];\ndouble p[500010],g[500010],fv[500010],dps[500010],dpf[500010],ans;\nvoid add(int x,int y,int val){\n    e[++cnt].t=y,e[cnt].v=val*0.01,e[cnt].nxt=be[x],be[x]=cnt;\n}\nvoid dfs1(int x){\n    vis[x]=1,dps[x]=1-p[x];\n    for(int i=be[x];i;i=e[i].nxt)!vis[e[i].t]?dfs1(e[i].t),Merge(x,e[i].t,e[i].v),0:(f[x]=e[i].t,fv[x]=e[i].v);\n}\nvoid dfs2(int x){\n    dpf[x]=f[x]?(g[x]?dpf[f[x]]*dps[f[x]]/g[x]+(1-dpf[f[x]]*dps[f[x]]/g[x])*(1-fv[x]):0):1;\n    ans+=1-dps[x]*dpf[x];\n    for(int i=be[x];i;i=e[i].nxt)e[i].t!=f[x]?dfs2(e[i].t),0:0;\n}\nint main(){\n    scanf(\"%d\",&n);\n    for(int i=1;i<n;++i)scanf(\"%d%d%d\",&u,&v,&w),add(u,v,w),add(v,u,w);\n    for(int i=1;i<=n;++i)scanf(\"%lf\",&p[i]),p[i]*=0.01;\n    dfs1(1),dfs2(1);\n    printf(\"%.6lf\",ans);\n    return 0;\n}\n```",
        "postTime": 1551956688,
        "uid": 26294,
        "name": "xryjr233",
        "ccfLevel": 9,
        "title": "[2019.3.7]BZOJ3566 [SHOI2014]\u6982\u7387\u5145\u7535\u5668(\u6811\u5f62dp/\u6982\u7387\u4e0e\u671f\u671b)"
    },
    {
        "content": "\u7531\u671f\u671b\u7684\u7ebf\u6027\u6027\uff0c\u7b54\u6848\u5c31\u662f\u6bcf\u4e2a\u70b9\u901a\u7535\u7684\u6982\u7387 .\n\n\u53d1\u73b0\u8fd9\u4e2a\u7684\u5e76\u4e0d\u592a\u597d\u505a\uff0c\u6211\u4eec\u6c42\u4e00\u4e0b\u6bcf\u4e2a\u70b9\u4e0d\u901a\u7535\u7684\u6982\u7387 .\n\n\u5206\u6790\u4e00\u4e0b\u6bcf\u4e2a\u70b9\u53d7\u5230\u54ea\u4e9b\u8d21\u732e\uff1a\n1. \u81ea\u5df1\u901a\u7535\n2. \u5b50\u6811\u5185\u901a\u7535\n3. \u5b50\u6811\u5916\u901a\u7535\n\n\u4ee4 $f(u)$ \u4e3a\u81ea\u5df1\u901a\u7535\u548c\u5b50\u6811\u5185\u901a\u7535\u7684\u6982\u7387\uff0c\u5219\n$$f(u)=(1-p_i)\\prod_{v\\in\\mathrm{son}(u)}(f(v)+(1-f(v)(1-w))$$\n\u4e3a\u5565\uff1f\u56e0\u4e3a\u8d21\u732e\u53ef\u4ee5\u62c6\u6210\uff1a\n- \u5b50\u6811\u6ca1\u7535\n- \u5b50\u6811\u6709\u7535\uff0c\u4f46\u662f\u4e0d\u901a\u7535\n\n\u4ee4 $g(u)$ \u8868\u793a\u5b50\u6811\u5916\u901a\u7535\u6982\u7387\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651 $u$ \u7684\u5b50\u6811\u5916\u5230\u5e95\u662f\u4ec0\u4e48\uff1a\n- $u$ \u7684\u7236\u4eb2\u7684\u5b50\u6811\u5916\n- $u$ \u7684\u7236\u4eb2\u7684\u5b50\u6811\u9664\u4e86 $u$ \u7684\u5b50\u6811\u7684\u90e8\u5206\n\n\u7b2c\u4e00\u4e2a\u8d21\u732e\u663e\u7136 .\n\n\u5173\u4e8e\u7b2c\u4e8c\u4e2a\uff0c\u56e0\u4e3a\u6211\u4eec\u662f\u8fde\u4e58\u79ef\u5f62\u5f0f\uff0c\u6240\u4ee5\u76f4\u63a5\u9664\u6389\u513f\u5b50\u7684\u8d21\u732e\u5c31\u5b8c\u4e86 .\n\n\u4e8e\u662f\u5c31\u6709 $u$ \u7684\u5b50\u6811\u5916\u6709\u7535\u7684\u6982\u7387\uff1a\n$$P=g(fa(u))\\cdot\\dfrac{f(fa(u))}{f(u)+(1-f(u))(1-w)}$$\n\n\u7136\u540e\u7c7b\u4f3c\u7684\u62c6\u8d21\u732e\uff1a\n- \u5b50\u6811\u6ca1\u7535\n- \u5b50\u6811\u6709\u7535\uff0c\u4f46\u662f\u4e0d\u901a\u7535\n\n\u4e8e\u662f\u5c31\u6709\n$$g(u)=P+(1-P)(1-w)$$\n\n\u8fd9\u4e2a\u4ece\u7236\u4eb2\u5230\u513f\u5b50\u7684 dp \u53ef\u4ee5\u81ea\u9876\u5411\u4e0b\u505a dfs .\n\n\u6ce8\u610f\u7279\u5224\u5206\u6bcd\u4e3a $0$ \u7684\u60c5\u51b5\n\nCode:\n```cpp\nusing namespace std;\ntypedef long long ll;\ntypedef double db;\nconst int N = 514114;\nvector<pair<int, db> > g[N];\ninline void addedge(int u, int v, db w){g[u].emplace_back(make_pair(v, w));}\ninline void ade(int u, int v, db w){addedge(u, v, w); addedge(v, u, w);}\nint n;\ndb p[N], dp1[N], dp2[N];\nvoid dfs1(int u, int fa)\n{\n\tdp1[u] = 1 - p[u];\n\tfor (auto e : g[u])\n\t{\n\t\tint v = e.first; db w = e.second;\n\t\tif (v == fa) continue;\n\t\tdfs1(v, u);\n\t\tdp1[u] *= dp1[v] + (1-dp1[v]) * (1-w);\n\t\t//        \u4e0d\u901a\u7535 ; \u901a\u7535\uff0c\u4f46\u662f\u4e0d\u8fde\u8fb9 \n\t}\n}\nvoid dfs2(int u, int fa)\n{\n\tfor (auto e : g[u])\n\t{\n\t\tint v = e.first; db w = e.second;\n\t\tif (v == fa) continue;\n\t\tif (dp1[v] + (1 - dp1[v]) * (1-w) == 0) continue;\n\t\tdb P = dp2[u] * dp1[u] / (dp1[v] + (1 - dp1[v]) * (1-w));\n\t\tdp2[v] = P + (1-P) * (1-w);\n\t\tdfs2(v, u);\n\t}\n}\nint main()\n{\n\tscanf(\"%d\", &n); db w;\n\tfor (int i=1, u, v; i<n; i++) scanf(\"%d%d%lf\", &u, &v, &w), ade(u, v, w/100);\n\tfor (int i=1; i<=n; i++) scanf(\"%lf\", p+i), p[i] /= 100;\n\tdp2[1] = 1;\n\tdfs1(1, 0); dfs2(1, 0);\n\tdb ans = 0;\n\tfor (int i=1; i<=n; i++) ans += 1 - dp1[i] * dp2[i];\n\tprintf(\"%.6f\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1642647346,
        "uid": 227514,
        "name": "jijidawang",
        "ccfLevel": 0,
        "title": "sol of P4284"
    },
    {
        "content": "\u6bcf\u4e2a\u5145\u7535\u5668\u5145\u4e0a\u7535\u7684\u6982\u7387\u8bbe\u4e3a $f_i$ \u7684\u8bdd\uff0c\u663e\u7136\u6211\u4eec\u8981\u6c42\u7684\u7ed3\u679c\u662f $f_1+f_2+\\cdots f_n$\uff0c\u56e0\u6b64\u8fd9\u9053\u9898\u5b9e\u9645\u4e0a\u662f\u6982\u7387\u6811\u5f62 DP\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u8d21\u732e\u5173\u7cfb\u3002\n\n- \u8be5\u8282\u70b9\u81ea\u884c\u5145\u4e0a\u7535\uff1a\u6982\u7387\u4e3a $q_i$\uff0c\u7531\u4e8e\u8f93\u5165\u7684\u662f\u767e\u5206\u6570\uff0c\u8981\u8f6c\u5316\u4e3a\u5b9e\u6570\u8fdb\u884c\u8ba1\u7b97\u3002\n- \u8be5\u8282\u70b9\u7531\u513f\u5b50\u8282\u70b9\u6765\u7535\u3002\n- \u8be5\u8282\u70b9\u7531\u7236\u4eb2\u8282\u70b9\u6765\u7535\u3002\n\n\u8bbe\u4e00\u4e2a\u8282\u70b9\u6709\u7535\u7684\u6982\u7387\u4e3a $f_i$ \u561b\uff0c\u90a3\u4e0d\u8003\u8651\u7236\u4eb2\u65b9\u5411\u7684\u6765\u7535\uff0c\u5c31\u53ef\u4ee5\u5199\u51fa\u6765\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f_i=f_i+(1-f_i)\\cdot f_j\\cdotp(i,j)$$\n\n\u5176\u4e2d $j$ \u662f $i$ \u7684\u5b69\u5b50\uff0c\u800c $p$ \u8868\u793a\u4e24\u70b9\u8fde\u8fb9\u901a\u7535\u7684\u6982\u7387\u3002\u89e3\u91ca\u4e00\u4e0b\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u5373\u8981\u4e48\u8be5\u8282\u70b9\u672c\u8eab\u6765\u7535\uff0c\u8981\u4e48\u6765\u81ea\u5b83\u7684\u5b69\u5b50\uff0c**\u4e24\u8005\u81f3\u5c11\u53d1\u751f\u4e00\u4e2a\u5373\u53ef**\u3002\u90a3\u4e48\u63a5\u4e0b\u6765\u8003\u8651\u7b2c\u4e09\u79cd\u6765\u6e90\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u81ea\u4e0a\u800c\u4e0b\u7684\u64cd\u4f5c\u4e86\u3002\n\n\u7136\u800c\u6211\u4eec\u4f1a\u53d1\u73b0\u51fa\u73b0\u4e86\u91cd\u590d\u64cd\u4f5c\u3002\n\n\u5047\u8bbe\u5b58\u5728\u4e00\u5bf9\u7236\u5b50 $(x,y)$\uff0c\u5411\u4e0a\u66f4\u65b0\u65f6\u6211\u4eec\u5bf9\u4e8e $x\\to y$ \u8fdb\u884c\u4e86\u4e00\u6b21\u66f4\u65b0\uff0c\u800c\u8fd9\u6b21\u66f4\u65b0\u4ea7\u751f\u7684\u8d21\u732e\u4e0d\u5e94\u8be5\u518d\u88ab\u8d21\u732e\u56de\u6765\uff0c\u6211\u4eec\u8981\u7528 $x$ \u6700\u521d\u7684\u503c\u8fdb\u884c\u8ba1\u7b97\u3002\u8ba9\u6211\u4eec\u7528 $f_{i1}$ \u8868\u793a\u539f\u503c\uff0c$f_{i2}$ \u8868\u793a\u65b0\u503c\uff0c\u5199\u51fa\u6765\u4e5f\u5c31\u662f\uff1a\n\n$$f_{i2}=f_{i1}+(1-f_{i1})\\cdot f_j\\cdot p(i,j)$$\n\n\u8ba9\u6211\u4eec\u8fdb\u884c\u4e00\u4e9b\u7b80\u5355\u7684\u4ee3\u6570\u53d8\u5f62\u5427\uff1a\n\n$$f_{i2}=f_j\\cdot p(i,j)+f_{i1}(1-f_j\\cdot p(i,j))$$\n\n$$f_{i2}-f_j\\cdot p(i,j)=f_{i1}(1-f_j\\cdot p(i,j))$$\n\n$$f_{i1}=\\dfrac{f_{i2}-f_j\\cdot p(i,j)}{1-f_j\\cdot p(i,j)}$$\n\n\u4e00\u65e6\u51fa\u73b0\u9664\u6cd5\u5c24\u4e3a\u503c\u5f97\u6ce8\u610f\u7684\u662f\u5206\u6bcd\u4e0d\u53ef\u4e3a\u96f6\uff0c\u6392\u9664\u8be5\u60c5\u51b5\u540e\u8fdb\u884c\u4e8c\u6b21 DP \u5373\u53ef\u89e3\u51fa\u8fd9\u4e00\u9898\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define eps (1e-7)\n#define N 500005\nusing namespace std;\nstruct edge{int v,nxt;double w;}e[N<<1];\nint h[N],cnt,n;double res;\nvoid add(int u,int v,double w){\n\te[++cnt].v=v;e[cnt].w=w;\n\te[cnt].nxt=h[u];h[u]=cnt;\n}double f[N];\nvoid dfs1(int u,int fa){\n\tfor(int i=h[u];i;i=e[i].nxt){\n\t\tif(fa==e[i].v)continue;\n\t\tdfs1(e[i].v,u);\n\t\tf[u]=f[u]+f[e[i].v]*(1-f[u])*e[i].w;\n\t}\n}void dfs2(int u,int fa){\n\tfor(int i=h[u];i;i=e[i].nxt){\n\t\tint v=e[i].v;\n\t\tif(fa==v)continue;\n\t\tif(fabs(1.0-f[v]*e[i].w)<=eps){\n\t\t\tdfs2(v,u);\n\t\t\tcontinue;\n\t\t}\n\t\tf[v]+=(1-f[v])*(f[u]-f[v]*e[i].w)/\n\t\t\t  (1-f[v]*e[i].w)*e[i].w;\n\t\tdfs2(v,u);\n\t}\n}int main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<n;i++){\n\t\tint u,v;double w;\n\t\tscanf(\"%d%d%lf\",&u,&v,&w);\n\t\tadd(u,v,w/100);add(v,u,w/100);\n\t}for(int i=1;i<=n;i++){\n\t\tdouble x;scanf(\"%lf\",&x);\n\t\tf[i]=x/100.0;\n    }dfs1(1,-1);dfs2(1,-1);\n    for(int i=1;i<=n;i++)res+=f[i];\n    printf(\"%.6lf\\n\",res);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1638710369,
        "uid": 212283,
        "name": "Aw\u987f\u987f",
        "ccfLevel": 5,
        "title": "\u3010\u9898\u89e3\u3011P4284 [SHOI2014]\u6982\u7387\u5145\u7535\u5668"
    },
    {
        "content": "~~\u8fd9\u4e2a\u9898\uff0c\u9898\u9762\u662f\u3010\u3011\uff0c\u51fa\u9898\u4eba\u4e5f\u662f\u4e2a\u3010\u3011~~\n\n\u771f\u5c31\u53ea\u653e\u524d\u5411\u661f\u8fc7\uff0c\u628a vector \u548c\u79bb\u7ebf\u5efa\u56fe\u90fd\u5361\u4e86\u3002\u3002\u3002\n\n\u9898\u610f\uff1a\n\n\u4e00\u68f5\u6811\uff0c\u4e00\u6761\u8fb9\u6709 $ p_i $ \u7684\u6982\u7387\u8fde\u63a5\u4e24\u4e2a\u8282\u70b9\uff0c\u4e00\u4e2a\u70b9\u6709 $ P_i $ \u7684\u6982\u7387\u4eae\u7740\uff0c\u95ee\u6240\u6709\u8282\u70b9\u4eae\u7740\u7684\u671f\u671b\u3002\n\n\u9996\u5148\u6839\u636e\u671f\u671b\u7684\u7ebf\u6027\u6027\uff0c\u6240\u6709\u8282\u70b9\u4eae\u7740\u7684\u671f\u671b\u660e\u663e\u53ef\u4ee5\u62c6\u6210\u6bcf\u4e2a\u8282\u70b9\u4eae\u7740\u7684\u671f\u671b\u4e4b\u548c\u3002\u7136\u540e\u4ed4\u7ec6\u60f3\u60f3\uff0c$ E(X)=1 * p +0 * (1-p)=p $\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u6c42\u4eae\u7740\u7684\u6982\u7387\u5373\u53ef\u3002\n\n\u600e\u4e48\u7b97\u5462\uff1f\n\n\u8003\u8651 dp\uff0c\u8bbe $ dp_1[u] $ \u4e3a $ u $ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\uff0c$ u $ \u4eae\u7740\u7684\u6982\u7387\u3002\n\n\u76f4\u63a5\u7b97\u5f88\u56f0\u96be\uff0c\u8003\u8651\u7b97 $ u $ \u4e0d\u4eae\u7740\u7684\u6982\u7387\uff0c\u4e0d\u96be\u53d1\u73b0\u662f $ (1-P_u)\\prod_{\\texttt {v is u son}}(1-dp1[v] \\times p_{(u,v)}) $\uff0c\u7528 $ 1 $ \u51cf\u53bb\u5373\u53ef\u5f97\u5230 $ dp_1[u] $\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u6362\u6839\u3002\u8981\u6c42\u7684\u4e1c\u897f\u8fd8\u662f\u4e00\u6837\u7684\uff0c\u53ea\u662f\u9700\u8981\u7ef4\u62a4\u7236\u8282\u70b9\u7684 $ dp $ \u503c\u3002\n\n\u8bbe $ dp_2[u] $ \u4e3a\u8003\u8651\u6574\u68f5\u6811\u65f6 $ u $ \u4eae\u7740\u7684\u6982\u7387\uff0c\u6b64\u5904\u4e3a\u4e86\u65b9\u4fbf\u8bbe $ f[u] $ \u4e3a\u53bb\u6389 $ u $ \u4e3a\u6839\u7684\u5b50\u6811\u65f6\uff0c\u5176\u7236\u4eb2\u8282\u70b9\u4eae\u7740\u7684\u6982\u7387\u3002\n\n\u5bf9\u4e8e $ u $ \u7684\u4e00\u4e2a\u513f\u5b50 $ v $\uff0c\u6211\u4eec\u5f88\u5bb9\u6613\u80fd\u591f\u53d1\u73b0\u6709 $ f[v]=(1-p_{(u,f[v])}\\prod_{\\texttt {x is u son }\\And x \\ne v } 1-dp1[x] \\times e_{(u,x)}) $\u3002\n\n\u5927\u591a\u6570\u540c\u5b66\u90fd\u662f\u76f4\u63a5\u7528 $ dp2[u] $ \u548c $ dp1[v] $ \u76f4\u63a5\u8fdb\u884c\u8f6c\u79fb\uff0c\u6765\u5f97\u5230\u5176\u503c\uff0c\u4f46\u5176\u5b9e\u53ef\u4ee5\u5bf9\u513f\u5b50\u7ef4\u62a4\u4e00\u4e2a\u524d\u7f00\u79ef\u548c\u540e\u7f00\u79ef\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u51fa\u73b0\u9664\u6cd5\u7684\u95ee\u9898\u4e86\u3002\n```cpp\n#include<cstdio>\n#include<vector>\n#include<cctype>\ntypedef double db;\nconst int M=5e5+5;\nint n,m,cnt,h[M],f[M];db ans,p[M],dp1[M],dp2[M];\ndb v[M],lp[M],rp[M];\nstruct Edge{\n\tint v,nx;db p;\n}e[M<<1];\ninline void Add(const int&u,const int&v,const db&p){\n\te[++cnt]=(Edge){v,h[u],p};h[u]=cnt;\n\te[++cnt]=(Edge){u,h[v],p};h[v]=cnt;\n}\ninline int read(){\n\tint n(0);char s;\n\twhile(!isdigit(s=getchar()));\n\twhile(n=n*10+(s&15),isdigit(s=getchar()));\n\treturn n;\n}\nvoid DFS1(int u){\n\tdp1[u]=1-p[u];\n\tfor(int E=h[u];E;E=e[E].nx)if(e[E].v^f[u])f[e[E].v]=u,DFS1(e[E].v),dp1[u]*=(1-dp1[e[E].v]*e[E].p);dp1[u]=1-dp1[u];\n}\nvoid DFS2(int u){\n\tint e,i,len(0);db p=(dp2[u]*=1-::p[u]);\n\tfor(e=h[u];e;e=::e[e].nx)if(::e[e].v^f[u])v[++len]=1-dp1[::e[e].v]*::e[e].p;\n\tfor(i=1;i<=len;++i)lp[i]=(i==1?1:lp[i-1])*v[i];\n\tfor(i=len;i>=1;--i)rp[i]=(i==len?1:rp[i+1])*v[i];\n\tfor(e=h[u],i=1;e;e=::e[e].nx){\n\t\tif(::e[e].v==f[u])continue;Edge&E=::e[e];dp2[E.v]*=p;dp2[u]*=1-dp1[E.v]*E.p;\n\t\tif(i^1)dp2[E.v]*=lp[i-1];if(i^len)dp2[E.v]*=rp[i+1];\n\t\tdp2[E.v]=1-(1-dp2[E.v])*E.p;++i;\n\t}\n\tfor(e=h[u];e;e=::e[e].nx)if(::e[e].v^f[u])DFS2(::e[e].v);dp2[u]=1-dp2[u];\n}\nsigned main(){\n\tint i,u,v,p;n=read();\n\tfor(i=1;i<n;++i)u=read(),v=read(),p=read(),Add(u,v,.01*p);\n\tfor(i=1;i<=n;++i)::p[i]=.01*read(),dp2[i]=1;DFS1(1);DFS2(1);\n\tfor(i=1;i<=n;++i)ans+=dp2[i];printf(\"%.6f\",ans);\n}\n```",
        "postTime": 1634693162,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u6570\u5b66 DP P4284\u9898\u89e3"
    },
    {
        "content": "\u8bb0 $dp[i]$ \u8868\u793a\u5143\u4ef6 $i$ \u901a\u7535\u7684\u6982\u7387\u3002\u4e00\u4e2a\u5143\u4ef6\u53ef\u4ee5\n\n- \u88ab\u5b83\u7684\u4e34\u8fb9\u7ecf\u5bfc\u7ebf\u5bfc\u5165\n\n- \u81ea\u5df1\u8fde\u7535\n\n\u8fd9\u4e24\u79cd\u65b9\u5f0f\u5fc5\u7136\u65e0\u5173\u3002\n\n\u5047\u5982\u8bf4\u6211\u4eec\u628a\u6761\u4ef6\u7a0d\u7a0d\u6539\u4e00\u4e0b\uff0c\u9664\u6389\u88ab\u81ea\u5df1\u7236\u8282\u70b9\u5f71\u54cd\u7684\u60c5\u51b5\uff0c\u7531\u4e8e\u8fd9\u662f\u4e00\u68f5\u6811\uff0c\u6240\u4ee5\u53ef\u4ee5\u8bc1\u660e\u4e00\u4e2a\u5143\u4ef6\u5468\u56f4\u7ed9\u5b83\u5145\u7535\u7684\u6982\u7387\u65e0\u5173\u3002\u90a3\u4e48\n\n$dp[i]=1-(1-q[i])\u00b7\\prod\\limits_{s\\in son(i)}(1-dp[s]\u00b7p[e(i,s)])$\n\n\u7136\u540e\u628a\u7236\u8282\u70b9\u4f20\u7ed9\u5b50\u8282\u70b9\u7535\u7684\u53ef\u80fd\u52a0\u4e0a\u53bb\u5373\u53ef\u3002\u8fd9\u91cc\u8003\u8651\u4f7f\u7528\u6362\u6839\u6cd5\uff08\u6211\u731c\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u9ad8\u65af\u6d88\u5143\u662f\u56e0\u4e3a\u53ef\u4ee5\u7528\u89e3\u65b9\u7a0b\u7684\u529e\u6cd5\u6c42 $dp$ \u503c\u5427????\uff09\uff1a\n\n- \u7b2c\u4e00\u6b65\uff1a\u6392\u9664\u8be5\u5b50\u8282\u70b9\u7684\u8d21\u732e\n\n$dp_{cancel}[i]=\\frac{dp[i]-dp[s]\u00b7p[e(i,s)]}{1-dp[s]\u00b7p[e(i,s)]}$\n\n- \u7b2c\u4e8c\u6b65\uff1a\u66f4\u65b0\u5b50\u8282\u70b9\n\n$dp_{+father}[s]=1-(1-dp[s])(1-dp_{cancel}[i]\u00b7p[e(i,s)])$\n\n- \u7b2c\u4e09\u6b65\uff1a\u904d\u5386\u5b50\u8282\u70b9\n\n- \u7b2c\u56db\u6b65\uff1a\u8fd8\u539f\n\n\u5b8c\u7ed3\u6563\u82b1\uff01\n\n$ $\n\n$ $\n\n$ $\n\n$ $\n\n$ $\n\n$ $\n\n\u5582\u7b49\u7b49\uff01\u4f60\u4e0d\u611f\u89c9\u90a3\u91cc\u5f88\u602a\u5417\uff01\u8fd8\u6ca1\u6709\u5b8c\u7ed3\u6563\u82b1\u5462\uff01\n\n\u4e0d\u60f3\u6284\u9898\u89e3\u7684\u5c31\u522b\u8d70\uff01\n\n\u5f53\u4f60\u63d0\u4ea4\u4e0a\u53bb\u540e\uff0c\u4f60\u4f1a\u5f97\u5230\u51e0\u4e2a $\\color{white}\\colorbox{red}{WA}$ \u6216\u51e0\u4e2a $\\color{white}\\colorbox{purple}{RE}$ \uff0c\u4f60\u77e5\u9053\u4e3a\u4ec0\u4e48\u5417\uff1f\n\n\u95ee\u9898\u51fa\u5728\u8fd9\uff1a\n\n$dp_{cancel}[i]=\\frac{dp[i]-dp[s]\u00b7p[e(i,s)]}{1-dp[s]\u00b7p[e(i,s)]}$\n\n\u4e07\u4e00 $dp[s]\u00b7p[e(i,s)]=1$ \u548b\u529e\uff1f\n\n~~\u51c9\u62cc\uff0c\u518d\u52a0\u4e2a\u9e21\u86cb~~\n\n\u8fd9\u6837\u5c31\u6ca1\u5fc5\u8981\u66f4\u65b0\u5b50\u8282\u70b9\u4e86\uff0c\u52a0\u4e2a\u7279\u5224\u5373\u53ef\u3002\n\n\u8fd9\u6837\u7684\u8bdd\uff1a\n\n| Subtask #0 |\n| -: |\n| $\\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ $ |\n| $\\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ $ |\n| $\\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{green}{AC}\\ \\color{white}\\colorbox{gray}{NO}\\ $ |\n\n| Subtask #1 |\n| -: |\n| $\\color{white}\\colorbox{green}{AC}\\ $ |\n\n\u5b8c\u7ed3\u6563\u82b1\uff01\n\n\u4ee3\u7801\uff1a\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\n\ntypedef double db;\n\nstruct node{\n\tint nxt;\n\tdb ep;\n};\n\nvector<node>mp[500005];\n\nint n;\ndb eps=1e-10,vp[500005],dp[500005],ans;\n\nvoid dfs(int now,int fa){\n\tfor(int o=0;o<mp[now].size();o++){\n\t\tif(mp[now][o].nxt==fa){\n\t\t\tcontinue;\n\t\t}\n\t\tdfs(mp[now][o].nxt,now);\n\t\tdp[now]+=(1-dp[now])*dp[mp[now][o].nxt]*mp[now][o].ep;//\u6c42\u6982\u7387\n\t}\n}\n\nvoid dfs2(int now,int fa){\n\tdb rem=dp[now];\n\tfor(int o=0;o<mp[now].size();o++){\n\t\tif(mp[now][o].nxt==fa){\n\t\t\tcontinue;\n\t\t}\n\t\tif(dp[mp[now][o].nxt]*mp[now][o].ep<1-eps){//\u4e0d\u52a0\u7279\u5224\u89c1\u7956\u5b97\n\t\t\tdp[now]=(dp[now]-dp[mp[now][o].nxt]*mp[now][o].ep)/(1-dp[mp[now][o].nxt]*mp[now][o].ep);\n\t\t\tdp[mp[now][o].nxt]+=(1-dp[mp[now][o].nxt])*dp[now]*mp[now][o].ep;//\u6362\u6839\n\t\t}\n\t\tdfs2(mp[now][o].nxt,now);\n\t\tdp[now]=rem;\n\t}\n}\n\nint main(){\n\tcin>>n;\n\tfor(int o=1;o<n;o++){\n\t\tint a,b;\n\t\tdb ep;\n\t\tcin>>a>>b>>ep;\n\t\tep/=100;\n\t\tmp[a].push_back((node){b,ep});\n\t\tmp[b].push_back((node){a,ep});\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tcin>>vp[i];\n\t\tvp[i]/=100;\n\t\tdp[i]=vp[i];\n\t}\n   //\u4ee5\u4e0a\u662f\u8f93\u5165\n\tdfs(1,1);//\u666e\u901adfs\n\tdfs2(1,1);//\u6362\u6839dfs\n\tfor(int i=1;i<=n;i++){\n\t\tans+=dp[i];//\u671f\u671b\n\t}\n\tcout<<fixed<<setprecision(6)<<ans;//\u516d\u4f4d\u5c0f\u6570\n\treturn 0;\n}\n$",
        "postTime": 1641436586,
        "uid": 472950,
        "name": "Mr_Terminator",
        "ccfLevel": 4,
        "title": "\u8ddf\u9ad8\u65af\u6d88\u5143\u6ca1\u6709\u6bdb\u5173\u7cfb????"
    },
    {
        "content": "## \u9898\u610f\u89e3\u91ca\n\n\u4e00\u68f5 $n$ \u4e2a\u70b9\u7684\u6811\uff0c\u6bcf\u4e2a\u70b9 $i$ \u6709 $q_i$ \u6982\u7387\u4e3a\u6709\u7535\u72b6\u6001\uff0c$1-q_i$ \u6982\u7387\u4e3a\u65e0\u7535\u72b6\u6001\uff0c\u4e00\u6761\u6811\u8fb9 $e $ \u6709 $p_e$ \u6982\u7387\u53ef\u4ee5\u901a\u7535\uff0c$1-p_e$ \u6982\u7387\u4e0d\u80fd\u901a\u7535\u3002\u4e00\u4e2a\u7531\u53ef\u4ee5\u901a\u7535\u7684\u8fb9\u8fde\u6210\u7684\u8fde\u901a\u5757\u4e2d\u5982\u679c\u81f3\u5c11\u6709\u4e00\u4e2a\u70b9\u6709\u7535\uff0c\u90a3\u4e48\u6574\u4e2a\u8fde\u901a\u5757\u7684\u70b9\u90fd\u4f1a\u6709\u7535\u3002\n\n\u95ee\u671f\u671b\u4e0b\u6709\u591a\u5c11\u4e2a\u70b9\u4f1a\u6700\u7ec8\u6709\u7535\u3002\n\n## \u9898\u89e3\n\n\u5148\u8003\u8651\u6734\u7d20\u7684\u6811\u5f62 DP\u3002\u4e00\u4e2a\u70b9\u9700\u8981\u8003\u8651\u5b83\u5b50\u6811\u4e2d\u4e0e\u5b83\u8fde\u901a\u7684\u70b9\u6709\u591a\u5c11\u4e2a\uff0c\u5e76\u4e14\u8fd9\u4e2a\u8fde\u901a\u5757\u8fd8\u6ca1\u6709\u7535\u3002\u4f1a\u5f97\u5230\u4e00\u4e2a $f_{v,s}$ \uff0c\u8868\u793a $v$ \u5b50\u6811\u4e2d\u6709 $s$ \u4e2a\u70b9\u4e0e\u6839\u8fde\u901a\u8fd8\u6ca1\u6709\u7535\uff0c\u671f\u671b\u4e0b\u5df2\u7ecf\u6709\u7535\u7684\u70b9\u6570\u3002\n\n\u8f6c\u79fb\u8003\u8651\u5b83\u7684\u67d0\u6761\u513f\u5b50\u8fb9\u662f\u5426\u53ef\u4ee5\u901a\u7535\uff08$2^n$ \u7ea7\u522b\u7684\u72b6\u6001\u6570\uff09\uff0c\u5e76\u4e14\u5982\u679c\u8be5\u70b9\u4eae\u8d77\u5c31\u5c06 $s$ \u7f6e $0$\u3002\n\n\u65f6\u7a7a\u590d\u6742\u5ea6\u592a\u9ad8\u3002\u53d1\u73b0\u6211\u4eec\u8003\u8651\u4e86\u4e00\u4e2a\u70b9\u5728\u5176\u5b83\u70b9\u5904\u9020\u6210\u7684\u8d21\u732e\u3002\u5b9e\u9645\u4e0a\uff0c\u6839\u636e\u671f\u671b\u7684\u7ebf\u6027\u6027\uff0c\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u6811\u4e0a\u6bcf\u4e2a\u70b9\u6709\u7535\u7684\u6982\u7387\u3002\u6570\u503c\u4e0a\u4e5f\u7b49\u4e8e\u671f\u671b\u3002\n\n\u6700\u540e\u5c06\u6240\u6709\u70b9\u7684\u671f\u671b\u76f8\u52a0\u5c31\u662f\u7b54\u6848\u3002\n\n\u4e8e\u662f\u4e00\u4e2a\u6362\u6839 DP \u5c31\u547c\u4e4b\u6b32\u51fa\u3002\n\n\u4ee4 $f_v$ \u8868\u793a $v$ \u5b50\u6811\u5185\u4f7f $v$ \u6709\u7535\u7684\u6982\u7387\u3002\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\n\n1. \u8be5\u70b9\u81ea\u5df1\u4eae\u8d77\u3002\n2. \u81f3\u5c11\u4e00\u4e2a\u513f\u5b50\u4eae\u8d77\uff0c\u4e14\u8be5\u513f\u5b50\u7684\u7236\u4eb2\u8fb9\u53ef\u4ee5\u901a\u7535\u3002\n\n\u4ee4\u4e24\u79cd\u60c5\u51b5\u7684\u53cd\u9762\u76f8\u53e0\u52a0\uff0c\u518d\u53d6\u53cd\uff0c\u53ef\u5f97\uff1a\uff08\u4ee5\u4e0b\u8fb9\u96c6\u9ed8\u8ba4\u4e3a\u5355\u5411\u8fb9\uff09\n$$\nf_v = 1 - (1-q_v)\\prod\\limits_{(v,u)\\in E}(1-p_{(v,u)}f_u)\n$$\n\u8003\u8651\u6362\u6839\u3002\n\n\u8981\u8ba1\u7b97\u67d0\u4e2a\u70b9 $v$ \u7684\u7236\u4eb2 $u$ \u8fd9\u68f5\u53cd\u5411\u5b50\u6811\uff08\u70b9\u8865\u96c6\uff09\u7684 $f$ \u503c\uff0c\u8003\u8651\u518d\u8bb0 $g_u$\u200b \u4e3a\u8fd9\u4e2a\u503c\u3002\n\n\u6ce8\u610f\u5230 $g_u$ \u662f\u6839\u636e\u513f\u5b50 $v$ \u53d8\u5316\u7684\u3002\n\n\u8bbe\u6211\u4eec\u8003\u8651\u5230 $v$ \u8fd9\u4e2a\u70b9\u7684 $g_v$ \u503c \uff0c\u5b83\u7684\u7236\u4eb2\u4e3a $u$\uff0c$v$ \u9700\u8981\u5411\u4e0b\u8d70\uff08\u9012\u5f52\u8fdb\u5165\uff09\u7684\u513f\u5b50\u662f $k$\uff0c\u5219\n$$\ng_v=1-(1-q_v)(1-p_{(u,v)}g_u)\\prod\\limits_{(v,s)\\in E,s\\not=k}(1-p_{(v,s)}f_s)\n$$\n\u6bd4\u8f83\u597d\u7406\u89e3\u3002\u5982\u679c\u7b97\u51fa\u6240\u6709\u513f\u5b50\u7684\u4e58\u79ef\u518d\u9664\u53bb $k$\uff0c\u6211\u4eec\u4e0d\u592a\u5bb9\u6613\u5904\u7406\u4e3a $0$ \u7684\u60c5\u51b5\uff08\u4e14\u6709\u7cbe\u5ea6\u95ee\u9898\uff09\uff0c\u6240\u4ee5\u8f83\u7406\u60f3\u7684\u505a\u6cd5\u662f\u5c06\u513f\u5b50\u6709\u5e8f\u5316\uff0c\u8ba1\u7b97\u4e58\u79ef\u7684\u524d\u7f00\u540e\u7f00\u3002\n\n\u8fd8\u6709\u5c31\u662f\uff0c\u5728\u4f7f\u7528\u8fd9\u4e2a\u505a\u6cd5\u7684\u65f6\u5019\u53ef\u80fd\u9700\u8981\u5728\u90bb\u63a5\u8868\u4e2d\u624b\u52a8\u5c06\u7236\u4eb2\u5220\u53bb\uff0c\u4ee5\u514d\u5e72\u6270\u6c42\u524d\u540e\u7f00\u79ef\u3002\n\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <cstring>\n#include <cmath>\n#include <algorithm>\n#include <queue>\n#include <vector>\n\nconst int N = 500001;\n\nchar buf[1 << 25] ,*p1 = buf ,*p2 = buf;\n#define getchar() (p1 == p2 && (p2 = (p1 = buf) + fread(buf ,1 ,1 << 21 ,stdin) ,p1 == p2) ? EOF : *p1++)\ninline int read() {\n    int x = 0, f = 1; char ch = getchar();\n    while(ch > '9' || ch < '0') { if(ch == '-') f = -1; ch = getchar(); }\n    while(ch >= '0' && ch <= '9') x = x * 10 + ch - 48, ch = getchar();\n    return x * f;\n}\n\nint n; double p[N];\nstd::vector <std::pair <int,double> > V[N];\ntypedef std::vector <std::pair <int,double> >::iterator it;\n\ndouble f[N];\n\nvoid Dfs(int v,int fa) {\n    f[v] = 1;\n    for(int i = 0;i < (int)V[v].size();i++) {\n        int u = V[v][i].first; if(u == fa) continue;\n        Dfs(u,v), f[v] *= 1 - V[v][i].second * f[u];\n    }\n    f[v] = p[v] + (1 - p[v]) * (1 - f[v]);\n    return;\n}\n\ndouble g[N],Ans;\nstd::vector <double> P[N],Q[N];\n\nvoid Dfs1(int v,int fa) {\n    double tmp = 1 - g[fa], ans = tmp;\n    \n    it j;\n    for(it i = V[v].begin();i != V[v].end();i++) {\n        int u = i -> first;\n        if(u == fa) j = i;\n        else ans *= 1 - i -> second * f[u];\n    }\n    if(v > 1) V[v].erase(j);\n\n    ans = 1 - (1 - p[v]) * ans;\n    //std::printf(\"%d %lf\\n\",v,ans);\n    Ans += ans;\n\n    for(int i = 0;i < (int)V[v].size();i++) {\n        int u = V[v][i].first; if(u == fa) continue;\n        P[v].push_back(1 - V[v][i].second * f[u]);\n        Q[v].push_back(1 - V[v][i].second * f[u]);\n    }\n    for(int i = 1;i < (int)P[v].size();i++) P[v][i] *= P[v][i - 1];\n    for(int i = (int)Q[v].size() - 2;i >= 0;i--) Q[v][i] *= Q[v][i + 1];\n    for(int i = 0;i < (int)V[v].size();i++) {\n        int u = V[v][i].first; if(u == fa) continue;\n        g[v] = tmp * (!i ? 1 : P[v][i - 1]) * (i == (int)Q[v].size() - 1 ? 1 : Q[v][i + 1]);\n        g[v] = V[v][i].second * (1 - (1 - p[v]) * g[v]);\n        Dfs1(u,v);\n    }\n    return;\n}\n\nint main() {\n    n = read();\n    for(int i = 1;i < n;i++) {\n        int v = read(), u = read();\n        double p = read() / 100.0;\n        V[v].push_back(std::make_pair(u,p));\n        V[u].push_back(std::make_pair(v,p));\n    }\n    for(int i = 1;i <= n;i++) p[i] = read() / 100.0;\n    Dfs(1,0), Dfs1(1,0);\n    //for(int i = 1;i <= n;i++) std::printf(\"%lf \",f[i]);\n    //std::puts(\"\");\n    std::printf(\"%.6lf\\n\",Ans);\n    return 0;\n}\n\n\n```\n\n\n\n",
        "postTime": 1634805766,
        "uid": 219595,
        "name": "Vocalise",
        "ccfLevel": 9,
        "title": "\u6362\u6839 DP--P4284\u3010 [SHOI2014]\u6982\u7387\u5145\u7535\u5668\u3011"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/P4284)\u770b\u9898\u76ee\u3002  \n# \u5206\u6790\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~~\u770b\u5230\u6982\u7387\u548c\u671f\u671b\u6211\u5c31\u4e0d\u4f1a\u4e86\u3002~~  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8bbe\u5145\u7535\u5668$i$\u7684\u5145\u7535\u6982\u7387\u4e3a$P(i)$\uff0c\u5219\u53ef\u4ee5\u5f97\u5230\u7b54\u6848\u4e3a\uff1a  \n$$\\sum_i (P(i)\\times 1) =\\sum_i P(i)$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u6bcf\u4e2a\u5145\u7535\u5668\u6210\u529f\u5145\u7535\u7684\u6982\u7387\u5c31\u53ef\u4ee5\u5566\uff01  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4f46\u662f\u5982\u679c\u66b4\u529b\u5316\u5f0f\u5b50\u7684\u8bdd\uff0c\u4f1a\u53d1\u73b0\u6709\u5f88\u591a$1-P$\u7684\u9879\uff0c\u8f6c\u79fb\u5c31\u4f1a\u975e\u5e38\u5934\u75bc\u3002\u4e8e\u662f\u6211\u4eec\u53cd\u5176\u9053\u800c\u884c\u4e4b\uff0c~~\u653e\u5f03\u8fd9\u9053\u9898~~\u6c42\u5145\u7535\u5668\u5145\u7535\u5931\u8d25\u7684\u6982\u7387\uff0c\u8bbe\u4e3a$p$\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8f6c\u79fb\uff1a  \n$$p(u)=(1-q_u)\\sum_{(u,v)\\in E}(1-p(u,v)(1-p(v)))$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5176\u4e2d$p(u,v)$\u8868\u793a\u8fb9$(u,v)$\u53ef\u4ee5\u901a\u7535\u7684\u6982\u7387\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u770b\u8d77\u6765\u4e0d\u662f\u5f88\u597d\u5440......\u4f3c\u4e4e\u6709\u73af......\u600e\u4e48\u529e\uff1f  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~~\u76ee\u6d4b\u53ef\u4ee5\u9ad8\u65af\u6d88\u5143~~  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e0d\u8fc7\u8fd9\u9053\u9898\u7684\u80cc\u666f\u662f\u6811\uff0c\u76f4\u89c9\u544a\u8bc9\u6211\u4eec\u5e94\u8be5\u662f\u4e24\u6b21$DFS$\u89e3\u51b3\u7684\u95ee\u9898\u3002\u9996\u5148\u8003\u8651\u5b50\u6811\u5185\u7684\u60c5\u51b5\uff1a  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$f(u)$\uff1a\u5728$u$\u7684\u5b50\u6811\u5185\uff0c$u$\u4e0d\u88ab\u70b9\u4eae\u7684\u6982\u7387\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8bbe$son(u)$\u8868\u793a$u$\u7684\u513f\u5b50\u96c6\u5408\uff0c\u8f6c\u79fb\u5c31\u662f\uff1a  \n$$f(u)=(1-q_u)\\sum_{v\\in son(u)}(1-p(u,v)(1-f(v)))$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7136\u540e\u8003\u8651\u7b2c\u4e8c\u904d$DFS$\u8be5\u600e\u4e48\u505a\u3002\u901a\u8fc7\u7b2c\u4e00\u6b21$DFS$\uff0c\u6211\u4eec\u5df2\u7ecf\u5f97\u5230\u4e86\u5b50\u6811\u5185\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u7b2c\u4e8c\u904d$DFS$\u6211\u4eec\u53ea\u9700\u8981\u5c06\u5b50\u6811\u5916\u7684\u4fe1\u606f\u5408\u5e76\u4e0a\u53bb\u5c31\u53ef\u4ee5\u4e86\u3002\u5b50\u6811\u5916\u7684\u4fe1\u606f\u53ef\u4ee5\u901a\u8fc7\u7236\u4eb2\u7684\u771f\u5b9e\u7b54\u6848\uff08\u5408\u5e76\u540e\u7684\u7b54\u6848\uff09\u63a8\u51fa\u6765\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e8e\u662f\u8fd9\u9053\u9898\u5c31\u88ab\u89e3\u51b3\u5566\uff0c\u65f6\u95f4$O(n)$\u3002  \n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n\nconst double eps = 1e-11;\nconst int MAXN = 5e5 + 5;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n    x = 0;char s = getchar();int f = 1;\n    while( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n    while( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n    x *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n    if( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n    if( 9 < x ){ write( x / 10 ); }\n    putchar( x % 10 + '0' );\n}\n\ntemplate<typename _T>\n_T ABS( const _T a ) { return a < 0 ? -a : a; }\n\nstruct edge\n{\n\tint to, nxt; double w;\n}Graph[MAXN << 1];\n\ndouble f[MAXN], q[MAXN], g[MAXN];\nint head[MAXN];\nint N, cnt;\n\ndouble equal( const double x, const double y = 0 ) { return ABS( x - y ) < eps; }\ndouble fix( const double a ) { if( equal( a ) ) return a + eps; if( equal( a, 1 ) ) return a - eps; return a; }\n\nvoid addEdge( const int from, const int to, const double w )\n{\n\tcnt ++;\n\tGraph[cnt].w = fix( w ), Graph[cnt].to = to, Graph[cnt].nxt = head[from];\n\thead[from] = cnt;\n}\nvoid addE( const int from, const int to, const double w ) { addEdge( from, to, w ), addEdge( to, from, w ); }\n\nvoid DFS1( const int u, const int fa )\n{\n\tf[u] = 1 - q[u];\n\tfor( int i = head[u], v ; i ; i = Graph[i].nxt )\n\t\tif( ( v = Graph[i].to ) ^ fa )\n\t\t{\n\t\t\tDFS1( v, u );\n\t\t\tf[u] *= ( 1 - Graph[i].w * ( 1 - f[v] ) );\n\t\t}\n}\n\nvoid DFS2( const int u, const int fa )\n{\n\tdouble w;\n\tfor( int i = head[u], v ; i ; i = Graph[i].nxt )\n\t\tif( ( v = Graph[i].to ) ^ fa )\n\t\t{\n\t\t\tw = Graph[i].w;\n\t\t\tg[v] = f[v] * ( 1 - w * ( 1 - g[u] / ( 1 - w * ( 1 - f[v] ) ) ) );\n\t\t\tDFS2( v, u );\n\t\t}\n}\n\nint main()\n{\n\tread( N );\n\tfor( int i = 1, u, v, w ; i < N ; i ++ ) read( u ), read( v ), read( w ), addE( u, v, w * 0.01 );\n\tfor( int i = 1 ; i <= N ; i ++ ) scanf( \"%lf\", &q[i] ), q[i] /= 100;\n\tDFS1( 1, 0 );\n\tg[1] = f[1], DFS2( 1, 0 );\n\tdouble res = 0;\n\tfor( int i = 1 ; i <= N ; i ++ ) res += 1 - g[i];\n\tprintf( \"%.6f\\n\", res );\n\treturn 0;\n}\n```",
        "postTime": 1575699014,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[SHOI2014]\u6982\u7387\u5145\u7535\u5668"
    },
    {
        "content": "> [\u4f20\u9001](https://www.luogu.org/problem/P4284)\n>\n> \u8003\u573a\u5207\u4e86\u6765\u5199\u9898\u89e3\n\n# \u9898\u610f\n\n\u5df2\u77e5\u6bcf\u4e2a\u70b9\u901a\u7535\u7684\u6982\u7387\uff0c\u6bcf\u6761\u8fb9\u5bfc\u7535\u7684\u6982\u7387\uff0c\u6c42\u6811\u4e0a\u6bcf\u4e2a\u70b9\u6709\u7535\u7684\u6982\u7387\u4e4b\u548c\uff08\u671f\u671b\n\n# \u601d\u8def\n\n\u672c\u9898\u4f5c\u4e3a\u6811\u5f62DP\u6765\u8bf4\u5e76\u4e0d\u96be\uff0c\u4e3b\u8981\u5728\u4e8e\u6982\u7387\u7684\u8f6c\u79fb\n\n\u9996\u5148\u8981\u641e\u6e05\u695a \n\n$P(A+B) = 1-(1-P(A))(1-P(B)) \\dots\\dots1$\n\n$\\therefore P(A)=(1-P(A+B))(1-P(B))\\dots\\dots2$\n\n\u4ece\u4e0b\u5f80\u4e0a\u8f6c\u79fb\u53ef\u4ee5\u7528 1 \u505a\u5230\n\n\u7b97\u51fa\u6839\u8282\u70b9\u6709\u7535\u7684\u6982\u7387\n\n\u8003\u8651\u5c06\u6839\u8282\u70b9\u8f6c\u79fb\u5230\u5b50\u8282\u70b9\n\n\u7531 2 \u5f0f\u6c42\u51fa\uff0c\u7236\u8282\u70b9\u4e0d\u7ecf\u8fc7\u4e00\u4e2a\u5b50\u8282\u70b9\u4f9b\u7535\u800c\u6709\u7535\u7684\u6982\u7387 $P'$\n\n\u5c06 $P'$ \u5411\u8be5\u5b50\u8282\u70b9\u8f6c\u79fb\uff0c\u6c42\u51fa\u5b50\u8282\u70b9\u6709\u7535\u7684\u6982\u7387\n\n---\n\n\u53e6\u5916\uff0c\u8bb0\u5f97\u7279\u5224\u5b50\u8282\u70b9\u7684\u6982\u7387$\\times$\u8fb9\u6982\u7387\u4e3a 1 \u7684\u60c5\u51b5\n\n\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4e0d\u9700\u8981\u53bb\u6389\u5b50\u8282\u70b9\u5bf9\u7236\u8282\u70b9\u7684\u5f71\u54cd\n\n\uff08\u56e0\u4e3a ~~\u4f1a nan~~ \u6b64\u65f6\u5b50\u8282\u70b9\u5fc5\u7136\u4e3a 1\n\n\u6e90\u7a0b\u5e8f\n---\n\n```cpp\n#include<bits/stdc++.h>\n#define db double\nusing namespace std;\n\ninline void io(){\n\tfreopen(\"ProbabilityCharger.in\",\"r\",stdin);\n\tfreopen(\"ProbabilityCharger.ans\",\"w\",stdout);\n}\n\ninline int read(){\n\tint s=0,w=1;char ch;\n\twhile(!isdigit(ch=getchar())) if(ch=='-') w=-1;\n\twhile(isdigit(ch)) s=s*10+ch-'0',ch=getchar();\n\treturn s*w;\n}\n\nconst int N = (int)5e5+9;\nint n;\nint head[N],nxt[N*2],v[N*2],tl;\ndb e[N*2],val[N],final_ans=0.0;\ndb dp[N];\n\ninline void adde(int x,int y,int z){\n\tv[++tl]=y;e[tl]=(db)z/100.0;nxt[tl]=head[x];head[x]=tl; \n}\n\ninline db spl(db a,db b){\n\t// \u6d88\u53bb\u5f71\u54cd\n\treturn 1-(1-a)/(1-b);\n} \ninline db mer(db a,db b){\n\t// \u6c42P(A+B)\n\treturn 1-(1-a)*(1-b);\n}\n\ninline void dfs1(int x,int fr){\n\t// \u521d\u59cb\u5316\u4e3a\u8be5\u8282\u70b9\u76f4\u63a5\u901a\u7535\u7684\u6982\u7387\n\tdp[x]=val[x];\n\tfor(int i=head[x];i;i=nxt[i]){\n\t\tif(v[i]!=fr){\n\t\t\tdfs1(v[i],x);\n            // \u7edf\u8ba1\u8be5\u8282\u70b9\u5728\u5b50\u6811\u4f9b\u7535\u4e0b\u6709\u7535\u7684\u6982\u7387\n\t\t\tdp[x] = mer(dp[x],dp[v[i]]*e[i]);\n\t\t}\n\t}\n}\n\ninline void dfs2(int x,int fr){\n\t// \u7edf\u8ba1\u7b54\u6848\n\tfinal_ans += dp[x];\n\tfor(int i=head[x];i;i=nxt[i]){\n\t\tif(v[i]!=fr){\n        \t// \u7279\u5224\u5b50\u8282\u70b9\u6982\u7387\u4e3a 1 \u7684\u60c5\u51b5\n\t\t\tif(dp[v[i]]*e[i]!=1) dp[v[i]] = mer(dp[v[i]],spl(dp[x],dp[v[i]]*e[i])*e[i]);\n\t\t\tdfs2(v[i],x);\n\t\t}\n\t}\n}\n\nint main(){\n\t//freopen(\"2.in\",\"r\",stdin);\n\tio();\n\tn=read();\n\tfor(int i=1,x,y,z;i<n;++i){\n\t\tx=read(),y=read(),z=read();\n\t\tadde(x,y,z);adde(y,x,z);\n\t}\n\tfor(int i=1;i<=n;++i) val[i]=(db)read()/100.0;\n\tdfs1(1,0);\n\tdfs2(1,0);\n\tprintf(\"%.6lf\",final_ans);\n\t\n\treturn 0;\n}\n```\n\n\u9644\u6570\u636e\u751f\u6210\u5668\n---\n```python\nfrom cyaron import *\nfrom random import *\nfrom  time  import *\n\nseed(time())\nio = IO(input_file=\"23.in\")\nn = 500000\nio.input_writeln(n)\ng = Graph.tree(n,weight_limit=(0,100))\nio.input_writeln(g)\nfor i in range(0,n):\n    io.input_write(randint(0,100))\n\n```\n\n--- \n\n$$Fin$$\n\n[$My~Blog$](https://a-wnico-blog.blog.luogu.org/)\n\n\n\n",
        "postTime": 1572938883,
        "uid": 148352,
        "name": "WNico",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4284 \u3010[SHOI2014]\u6982\u7387\u5145\u7535\u5668\u3011"
    },
    {
        "content": "\u8fd9\u662f\u4e00\u9053\u4e8c\u6b21\u6362\u6839\u9898\uff08\u7b2c\u4e00\u6b21\u5199\u4e8c\u6b21\u6362\u6839\uff09\u3002\n\n[\u6982\u7387\u5145\u7535\u5668](https://www.luogu.org/problem/P4284)\n\n\u9996\u5148\u7b54\u6848\u662f\u6bcf\u4e2a\u5143\u5668\u4ef6\u6709\u7535\u7684\u6982\u7387\u7684\u603b\u548c\u3002\u4e8e\u662f\u9700\u8981\u6c42\u51fa\uff0c\u6bcf\u4e2a\u70b9\u6709\u7535\u7684\u6982\u7387\u3002\u8bbe$p_i$\u8868\u793a\u7b2c$i$\u4e2a\u70b9\u6709\u7535\u7684\u6982\u7387\uff0c\u90a3\u4e48$p_i$\u53ef\u4ee5\u901a\u8fc7\u4e0e$i$\u76f8\u8fde\u7684\u70b9\u8ba1\u7b97\u51fa\u6765\uff0c\u6216\u8005\u8bf4\u53ef\u4ee5\u5217\u51fa\u4e00\u4e2a\u65b9\u7a0b\uff0c\u5728\u8fd9\u91cc\u5927\u6982\u53e3\u80e1\u4e00\u4e0b\uff0c\u5c31\u662f$i$\u6709\u7535\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\n+ \u672c\u8eab\u5c31\u6709\u7535\n+ \u672c\u8eab\u6ca1\u7535\uff0c\u4f46\u662f\u548c\u5b83\u76f8\u8fde\u7684\u70b9\u6709\u7535\uff0c\u5e76\u4e14\u90a3\u6761\u8fb9\u8054\u901a\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u5217\u51fa\u7ebf\u6027\u65b9\u7a0b\u7ec4\uff0c\u5229\u7528\u9ad8\u65af\u6d88\u5143\u89e3\u51b3\u95ee\u9898\u3002\u4f46\u662f\u8fd9\u65f6\u95f4\u590d\u6742\u5ea6$O(n^3)$\u80af\u5b9a\u70b8\u4e86\u554a\u3002\n\n\u8003\u8651\u6362\u65b9\u6cd5\uff0c\u5047\u5982\u73b0\u5728\u6211\u4eec\u9700\u8981\u6c42\u51fa\u7b2c$i$\u4e2a\u7ed3\u70b9\u6709\u7535\u7684\u6982\u7387\u3002\u53d1\u73b0\u4e0d\u597d\u6c42\uff0c\u600e\u4e48\u529e\u5462\uff1f\u53ef\u4ee5\u901a\u8fc7\u53cd\u8fc7\u6765\u89e3\u51b3\u95ee\u9898\uff0c\u5373\u6c42\u51fa\u7b2c $i$ \u4e2a\u70b9\u6ca1\u7535\u5e76\u4e14\u4e0e\u5176\u76f8\u8fde\u7684\u70b9\u8981\u4e48\u8fb9\u4e0d\u8fde\u901a\uff0c\u8981\u4e48\u70b9\u6ca1\u7535\u7684\u6982\u7387\u3002\u90a3\u4e48\u5c31\u8981\u6c42\u51fa\u4e0e\u5176\u76f8\u8fde\u7684\u70b9\u6ca1\u7535\u7684\u6982\u7387\uff08\u56e0\u4e3a\u5176\u4ed6\u7684\u90fd\u662f\u5df2\u77e5\u7684\uff09\uff0c\u73b0\u5728\u5c31\u53ef\u4ee5\u5f00\u59cb $dp$ \u5566\uff08\u56e0\u4e3a\u4e0e\u5176\u76f8\u8fde\u7684\u70b9\u662f\u4e0d\u4e0d\u80fd\u901a\u8fc7\u5f53\u524d\u70b9\u4f20\u5bfc\u7535\u7684\uff09\u3002\u4f46\u590d\u6742\u5ea6$O(n^2)$\uff0c\u4e0d\u53ef\u63a5\u53d7\u3002\n\n\u8003\u8651\u4e8c\u6b21\u6362\u6839\uff0c\u6240\u8c13\u4e8c\u6b21\u6362\u6839\u5c31\u662f\u9996\u5148\u8ba1\u7b97\u51fa$1$\u70b9\u7684\u6982\u7387\uff0c\u7136\u540e\u5728\u8ba1\u7b97\u4e0e$1$\u76f8\u8fde\u901a\u7684$2$\u7ed3\u70b9\u4e3a\u6839\u65f6\u7684\u6982\u7387\u7684\u65f6\u5019\u53ef\u4ee5\u5229\u7528$1$\u70b9\u8ba1\u7b97\u7684\u90e8\u5206\u7ed3\u679c\uff0c\u8ba1\u7b97$2$\u4e3a\u6839\u7684\u65f6\u5019\u7684\u6982\u7387\u3002\u8fd9\u9053\u9898\u4e2d\uff0c\u53ef\u4ee5\u7ed3\u5408\u4e0a\u9762\u66b4\u529b $dp$ \u60f3\u51fa\u6362\u6839\u7684\u5177\u4f53\u64cd\u4f5c\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u591a\u8bf4\u5566\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <cstdio>\n\nusing namespace std;\n\nconst int maxNode = 5e5 + 10;\nint dianN, totBian;\nint head[maxNode], fa[maxNode];\ndouble dp[maxNode], youDian[maxNode], termi[maxNode];\nstruct bian {\n\tint to, next;\n\tdouble lian;\n} edge[maxNode << 1];\n\nvoid addedge(int nodU, int nodV, double lian) {\n\tedge[++totBian].to = nodV;\n\tedge[totBian].next = head[nodU];\n\tedge[totBian].lian = lian;\n\thead[nodU] = totBian;\n}\n\nvoid gengXin(int now) {\n\tdouble meiDian = 1.0 - youDian[now];\n\tfor (int pt = head[now]; pt; pt = edge[pt].next) {\n\t\tint to = edge[pt].to;\n\t\tif (to != fa[now]) {\n\t\t\tmeiDian *= (1.0 - dp[to] * edge[pt].lian);\n\t\t}\n\t}\n\tdp[now] = 1.0 - meiDian;\n}\n\nvoid dfs1(int now, int from) {\n\tfa[now] = from;\n\tfor (int pt = head[now]; pt; pt = edge[pt].next) {\n\t\tint to = edge[pt].to;\n\t\tif (to != from) {\n\t\t\tdfs1(to, now);\n\t\t}\n\t}\n\tgengXin(now);\n}\n\nvoid dfs2(int now, int from) {\n\tfor (int pt = head[now]; pt; pt = edge[pt].next) {\n\t\tint to = edge[pt].to;\n\t\tif (to != from) {\n\t\t\tfa[now] = to;\n\t\t\tfa[to] = 0;\n\t\t\t\n\t\t\tdouble yuanBenNow = dp[now], yuanBenTo = dp[to];\n\t\t\t\n//\t\t\tgengXin(now);\n//\t\t\tgengXin(to);\n\t\t\tfa[now] = to;\n\t\t\tfa[to] = 0;\n\t\t\t\n\t\t\tdp[now] = 1.0 - dp[now];\n\t\t\tif (1.0 - dp[to] * edge[pt].lian < 1e-9)\n\t\t\t\tgengXin(now);\n\t\t\telse dp[now] /= 1.0 - dp[to] * edge[pt].lian;\n\t\t\tdp[now] = 1.0 - dp[now];\n\t\t\tdp[to] = 1.0 - dp[to];\n\t\t\tdp[to] *= 1.0 - dp[now] * edge[pt].lian;\n\t\t\tdp[to] = 1.0 - dp[to];\n\t\t\t\n\t\t\ttermi[to] = dp[to];\n\t\t\tdfs2(to, now);\n\t\t\t\n\t\t\tfa[to] = now;\n\t\t\tfa[now] = 0;\n\t\t\t\n\t\t\tdp[now] = yuanBenNow;\n\t\t\tdp[to] = yuanBenTo;\n\t\t}\n\t}\n}\n\nint main() {\n\tscanf(\"%d\", &dianN);\n\tfor (int bianI = 1; bianI < dianN; ++bianI) {\n\t\tint nodU, nodV, persent;\n\t\tscanf(\"%d%d%d\", &nodU, &nodV, &persent);\n\t\taddedge(nodU, nodV, 1.0 * persent / 100.0);\n\t\taddedge(nodV, nodU, 1.0 * persent / 100.0);\n\t}\n\tfor (int dianI = 1; dianI <= dianN; ++dianI) {\n\t\tint persent;\n\t\tscanf(\"%d\", &persent);\n\t\tyouDian[dianI] = 1.0 * persent / 100.0;\n\t}\n\tdfs1(1, 0);\n\ttermi[1] = dp[1];\n\tdfs2(1, 0);\n\tdouble ans = 0;\n\tfor (int dianI = 1; dianI <= dianN; ++dianI) {\n\t\tans += termi[dianI];\n\t}\n\tprintf(\"%lf\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1572450435,
        "uid": 75715,
        "name": "KokiNiwa",
        "ccfLevel": 0,
        "title": "[SHOI2014]\u6982\u7387\u5145\u7535\u5668"
    },
    {
        "content": "\u6811\u5f62dp\u4e2d\u7684$\\text{up and down}$\n\n\u8fd8\u6709\u4e00\u70b9\u671f\u671b\n\n\u8bbe\u6bcf\u4e2a\u70b9\u80fd\u591f\u901a\u7535\u7684\u6982\u7387\u4e3a$P_i$\n\n\u90a3\u4e48$ans = \\sum_{i=1}^n P_i$\n\n**\u6211\u4eec\u5148\u8003\u8651$up$(\u53ea\u8003\u8651\u5b50\u6811))**\n\n\u5206\u6210\u4e24\u79cd\u60c5\u51b5\uff1a\n\n1. \u76f4\u63a5\u901a\u7535 : $q_i$\n   \n2. \u88ab\u5b50\u8282\u70b9\u901a\u7535 : \n   \n   $(1-q_i) \\times P_{to}(\\text{\u5b50\u8282\u70b9}) \\times e_i.w(\\text{\u8fde\u63a5\u7684\u8fb9\u5bfc\u7535\u7684\u6982\u7387})$\n   \n**\u6211\u4eec\u518d\u8003\u8651$down$(\u8003\u8651\u5b50\u6811\u5916))**\n\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u7236\u8282\u70b9\u7684\u7b54\u6848\u6765\u66f4\u65b0\u5b50\u8282\u70b9\n\n\u7236\u8282\u70b9\u7684\u7b54\u6848\u662f\u5305\u62ec\u5f53\u524d\u5b50\u8282\u70b9\u7684\n\n\u53ef\u4ee5\u628a\u8fd9\u90e8\u5206\u9664\u53bb\u7136\u540e\u6309\u7167$up$\u7684\u65b9\u6cd5\u66f4\u65b0\n\n$P_x= P_x' (1-P_x')*(P_{to}*e_i.w)$($P_x'$\u6307\u6839\u8282\u70b9\u9664\u53bb\u5f53\u524d\u5b50\u8282\u70b9\u7684\u8d21\u732e\u7684\u7b54\u6848)\n\n\u6574\u7406\u5f97\uff1a\n$$P_x'=\\frac{P_x-(P_{to} \\times e_i.w)}{1-(P_{to} \\times e_i.w)}$$\n\n(\u8fd9\u91cc\u6709\u4e2a\u5751\u70b9:\u5f53$1-(P_{to} \\times e_i.w) = 0$\u65f6\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u6ca1\u6709\u610f\u4e49\u4e86)\n\n$\\therefore P_{to} = P_{to} + (1-P_{to}) \\times P_x' \\times e_i.w$\n\n\u6240\u4ee5\u5728\u4e0b\u63a8\u7684\u65f6\u5019\u8981\u7279\u5224\u4e00\u4e0b\n\n\u4e0a\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nnamespace ZDY{\n    #pragma GCC optimize(3)\n    #define il __inline__ __attribute__ ((always_inline))\n    #define rg register\n    #define ll long long\n    #define ull unsigned long long\n    #define db double\n    #define sht short\n    #define MB template <class T>il\n    #define Fur(i,x,y) for(int i=x;i<=y;++i)\n    #define Fdr(i,x,y) for(int i=x;i>=y;--i)\n    #define fl(i,x) for(int i=head[x],to;to=e[i].to,i;i=e[i].nxt)\n    #define clr(x,y) memset(x,y,sizeof(x))\n    #define cpy(x,y) memcpy(x,y,sizeof(x))\n    #define fin(s) freopen(s\".in\",\"r\",stdin)\n    #define fout(s) freopen(s\".out\",\"w\",stdout)\n    #define fcin ios::sync_with_stdio(false)\n    #define l2(n) ((int)(log2(n)))\n    #define inf 0x3f3f3f3f\n    MB T ABS(T x){return x>0?x:-x;}\n    MB T MAX(T x,T y){return x>y?x:y;}\n    MB T MIN(T x,T y){return x<y?x:y;}\n    MB T GCD(T x,T y){return y?GCD(y,x%y):x;}\n    MB void SWAP(T &x,T &y){T t=x;x=y;y=t;}\n}using namespace ZDY;using namespace std;\nnamespace IO{const char* ln=\"\\n\";const int str=1<<20;struct IN{char buf[str],*s,*t;bool _;IN():s(buf),t(buf),_(0){}il char gc(){return s==t&&((t=(s=buf)+fread(buf,1,str,stdin))==s)?EOF:(*s++);}IN&operator>>(char&ch){if(_)return *this;char c;while((c=gc())!=EOF&&isspace(c));if(c==EOF)_=1;else ch=c;return *this;}IN& operator>>(char* ch){clr(ch,0);if(_)return *this;char c;while((c=gc())!=EOF&&isspace(c));if(c==EOF)return _=1,*this;*ch=c;ch++;while((c=gc())!=EOF&&!isspace(c))*ch=c,ch++;if(c==EOF)_=1;return *this;}IN& operator>>(string& ch){if(_)return *this;char c;while((c=gc())!=EOF&&isspace(c));if(c==EOF)return _=1,*this;ch+=c;while((c=gc())!=EOF&&!isspace(c))ch+=c;if(c==EOF)_=1;return *this;}template<typename T>IN&operator>>(T&x){if(_)return *this;char c=gc();bool ff=0;while(c!=EOF&&(c<'0'||c>'9'))ff^=(c=='-'),c=gc();if(c==EOF){_=1;return *this;}x=0;while(c!=EOF&&'0'<=c&&c<='9')x=(x<<3)+(x<<1)+c-48,c=gc();if(c==EOF)_=1;if(ff)x=-x;return *this;}}in;struct OUT{char buf[str],*s,*t;OUT():s(buf),t(buf+str){}~OUT(){fwrite(buf,1,s-buf,stdout);}void pt(char c){(s==t)?(fwrite(s=buf,1,str,stdout),*s++=c):(*s++=c);}OUT&operator<<(const char*s){while(*s)pt(*s++);return *this;}OUT&operator<<(char*s){while(*s)pt(*s++);return *this;}OUT&operator<<(string s){for(int i=0;s[i];i++)pt(s[i]);return *this;}template<typename T>OUT&operator<<(T x){if(!x)return pt('0'),*this;if(x<0)pt('-'),x=-x;char a[30],t=0;while(x)a[t++]=x%10,x/=10;while(t--)pt(a[t]+'0');return *this;}}out;}using namespace IO;\n#define N 500011\nint n,cnt=0,head[N],d[N];\nstruct edge{\n    int to,nxt;\n    db w;\n}e[N*2];\nil void add(int x,int y,db w){\n    e[++cnt].to=y;e[cnt].w=w;e[cnt].nxt=head[x];head[x]=cnt;\n}\ndb s[N],ans=0;\nvoid up(int x){\n    fl(i,x)if(!d[to]){\n        d[to]=d[x]+1;\n        up(to);\n        db t=s[to]*e[i].w;\n        s[x]+=(1-s[x])*t;\n    }\n}\n#define eps 1e-7\nil bool chk(db x){return x+eps>1.0&&x-eps<1.0;}\nvoid down(int x){\n    ans+=s[x];\n    fl(i,x)if(d[to]>d[x]){\n        if(!chk(s[to]*e[i].w)){\n            db t=(s[x]-s[to]*e[i].w)/(1.0-s[to]*e[i].w)*e[i].w;\n            s[to]+=(1-s[to])*t;\n        }\n        down(to);\n    }\n}\nint main(){\n    in>>n;\n    int x,y,w;\n    Fur(i,1,n-1)in>>x>>y>>w,add(x,y,(db)w*0.01),add(y,x,(db)w*0.01);\n    Fur(i,1,n)in>>x,s[i]=(db)x*0.01;\n    d[1]=1;\n    up(1);\n    down(1);\n    printf(\"%.6f\\n\",ans);\n}\n```\n",
        "postTime": 1572416492,
        "uid": 36532,
        "name": "localhost",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4284 \u3010[SHOI2014]\u6982\u7387\u5145\u7535\u5668\u3011"
    }
]