[
    {
        "content": "# \u9898\u610f\u7b80\u5316\n\u7ed9\u5b9a $n$ \u4e2a\u6570 $a_{1\\dots i}$\u3002\u6709\u4e24\u79cd\u64cd\u4f5c\uff1a\n\n\u64cd\u4f5c\u4e00\uff1a\u5bf9\u4e8e\u67d0\u5bf9 $(i,j)$ $(i<j)$\uff0c\u628a $a_{i \\dots j}$ \u53d8\u6210 $a_j$\u3002\n\n\u64cd\u4f5c\u4e8c\uff1a\u5bf9\u4e8e\u67d0\u5bf9 $(i,j)$ $(i<j)$\uff0c\u628a $a_{i \\dots j}$ \u53d8\u6210 $a_i$\u3002\n\n\u8ba1\u7b97\u53ea\u4f7f\u7528\u4e00\u6b21\u64cd\u4f5c\u4e00\u548c\u53ea\u4f7f\u7528\u4e00\u6b21\u64cd\u4f5c\u4e8c\u7684\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u5143\u7d20\u548c\u7684\u6700\u5927\u503c\u3002\n# \u601d\u8def\n\u9996\u5148\uff0c\u8fd9\u662f\u4e00\u7c7b\u7ecf\u5178\u9898\u578b\uff0c\u6267\u884c\u4e00\u6b21\u7b80\u5355\u64cd\u4f5c\uff0c\u95ee\u6781\u503c\u3002\u5957\u8def\u662f\uff1a\u6c42\u589e\u91cf\u6781\u503c\uff0c\u65b9\u6cd5\u662f\u7ebf\u6027\u626b\u63cf\u6bcf\u4e2a\u70b9\uff0c\u6c42\u51fa\u4f7f\u5f97\u589e\u91cf\u53d6\u5f97\u6781\u503c\u7684\u53f3\u7aef\u70b9\u6216\u5de6\u7aef\u70b9\u3002\u6211\u4eec\u5148\u5173\u6ce8\u5230\u64cd\u4f5c\u4e00\u90a3\u4e48\u6211\u4eec\u8bbe\u8ba1 $dp_i$ \u8868\u793a\u4ee5 $i$ \u4e3a\u53f3\u7aef\u70b9\u7684\u6700\u5927\u589e\u91cf\u3002\u90a3\u4e48\u7b54\u6848\u4e3a $dp$ \u6570\u7ec4\u7684\u6700\u5927\u503c\u3002\u6ce8\u610f\u6b64\u65f6\u7684 $dp$ \u6c42\u6cd5\u5e76\u975e\u52a8\u6001\u89c4\u5212\uff0c\u53ef\u4ee5\u76f4\u63a5\u6c42\uff01\u65b9\u7a0b\u5927\u81f4\u5982\u4e0b\uff1a\n$$dp_i=\\max_{j<i}{(a_i \\times (i-j)-sum_{i-1}+sum_{j-1})}$$\n$sum$ \u6570\u7ec4\u662f $a$ \u6570\u7ec4\u7684\u524d\u7f00\u548c\u3002\n\n\u89c2\u5bdf\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u4e58\u79ef\u662f\u5173\u4e8e $i$ \u548c $j$ \u7684\uff0c\u8003\u8651\u659c\u7387\u4f18\u5316\uff01\u8003\u8651\u4e24\u4e2a\u51b3\u7b56\u70b9 $j$\uff0c$k$\uff0c\u6ee1\u8db3 $k<j$\u3002\u5982\u679c $j$ \u4f18\u4e8e $k$\uff0c\u90a3\u4e48\u6709\u5982\u4e0b\u5173\u7cfb\uff1a\n$$a_i \\times (i-j)-sum_{i-1}+sum_{j-1} \\ge a_i \\times (i-k)-sum_{i-1}+sum_{k-1}$$\n\u628a\u548c $i$ \u6709\u5173\u7684\u6254\u53f3\u8fb9\uff0c\u5316\u7b80\u4e00\u4e0b\uff1a\n$$\\dfrac{sum_{j-1}-sum_{k-1}}{j-k} \\ge a_i$$\n\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u9b3c\u4e1c\u897f\u770b\u505a\u7ef4\u62a4\u4e00\u4e2a\u51f8\u5305\uff0c\u6bcf\u4e2a\u70b9\u7684\u5750\u6807\u662f $(i,sum_i)$\u3002\u6ce8\u610f\u5230\u8fd9\u4e2a $a_i$ \u6ca1\u6709\u5355\u8c03\u6027\uff0c\u4e0d\u80fd\u5355\u8c03\u961f\u5217\uff08\u4e0d\u5177\u5907\u51b3\u7b56\u5355\u8c03\u6027\uff0c\u65e0\u6cd5\u5220\u961f\u5934\uff09\u3002\u6240\u4ee5\u8003\u8651\u5230\u659c\u7387\u7684\u5355\u8c03\u6027\uff08\u51f8\u5305\uff09\uff0c\u76f4\u63a5\u4e8c\u5206\u5c31\u597d\u4e86\u3002\n\n\u64cd\u4f5c\u4e8c\u6211\u4eec\u4e5f\u53ef\u4ee5\u7c7b\u4f3c\u7684\u505a\u6cd5\u3002\n$$dp_i=\\max_{j<i}{(a_j \\times (i-j)-sum_{i-1}+sum_{j-1})}$$\n\u6309\u4e0a\u9762\u7684\u6b65\u9aa4\uff1a\n$$(sum_{j-1}-a_j \\times j)-(sum_{k-1}-a_k \\times k) \\ge i \\times (a_k-a_j)$$\n\u7136\u540e\u4f60\u7834\u9632\u4e86\uff0c\u56e0\u4e3a\u4e0d\u77e5\u9053 $i$ \u7684\u7cfb\u6570\u7684\u6b63\u8d1f\uff0c\u4e0d\u80fd\u786e\u5b9a\u4e00\u4e2a\u659c\u7387\u5f0f\u3002\u8fd9\u65f6\u5019\u4e00\u4e2a\u5c0f\u5957\u8def\u5c31\u662f\u628a $i$ \u4f5c\u4e3a\u5de6\u7aef\u70b9\uff08\u770b\u5230\u6700\u5f00\u59cb\u7684\u5957\u8def\uff09\u3002\u7136\u540e\u6211\u4eec\u66f4\u65b0\u4e00\u4e0b\u5f0f\u5b50\uff1a\n$$dp_i=\\max_{j>i}{(a_i \\times (j-i)-sum_{j}+sum_{i})}$$\n\u518d\u6765\u4e00\u6ce2\uff1a\n$$\\dfrac{sum_{j}-sum_{k}}{j-k} \\ge a_i$$\n\u662f\u4e0d\u662f\u5f88\u795e\u5947\uff1f\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log n)$\u3002\n# \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=3e5+10;\nint n,a[N],sum[N];\nint l,r,q[N];\nint dp[N],ans1=-1e18,ans2=-1e18;\ndouble slope1(int k,int j) {\n\treturn (sum[j-1]-sum[k-1])*1.0/(j-k);\n}\ndouble slope2(int k,int j) {\n\treturn (sum[j]-sum[k])*1.0/(j-k);\n}\nint find1(int A) {\n\tif(l==r) return q[l];\n\tint L=l+1,R=r,ret=l;\n\twhile(L<=R) {\n\t\tint mid=L+R>>1;\n\t\tif(slope1(q[mid-1],q[mid])>=A) {\n\t\t\tret=mid;\n\t\t\tL=mid+1;\n\t\t}\n\t\telse R=mid-1;\n\t}\n\treturn q[ret];\n}\nint find2(int A) {\n\tif(l==r) return q[l];\n\tint L=l+1,R=r,ret=l;\n\twhile(L<=R) {\n\t\tint mid=L+R>>1;\n\t\tif(slope2(q[mid-1],q[mid])>=A) {\n\t\t\tret=mid;\n\t\t\tL=mid+1;\n\t\t}\n\t\telse R=mid-1;\n\t}\n\treturn q[ret];\n}\nsigned main() {\n\tios::sync_with_stdio(false);\n\tcin.tie(0);\n\tcout.tie(0);\n\tcin>>n;\n\tfor(int i=1;i<=n;i++) {\n\t\tcin>>a[i];\n\t\tsum[i]=sum[i-1]+a[i];\n\t}\n\tl=1,r=0;\n\tq[++r]=1;\n\tfor(int i=2;i<=n;i++) {\n\t\tint pos=find1(a[i]);\n\t\tdp[i]=a[i]*(i-pos)-sum[i-1]+sum[pos-1];\n\t\tans1=max(ans1,dp[i]);\n\t\twhile(l<r&&slope1(q[r-1],q[r])<=slope1(q[r],i)) r--;\n\t\tq[++r]=i;\n\t}\n\tmemset(q,0,sizeof(q));\n\tmemset(dp,0,sizeof(dp));\n\tl=1,r=0;\n\tq[++r]=n;\n\tfor(int i=n-1;i>=1;i--) {\n\t\tint pos=find2(a[i]);\n\t\tdp[i]=a[i]*(pos-i)-sum[pos]+sum[i];\n\t\tans2=max(ans2,dp[i]);\n\t\twhile(l<r&&slope2(q[r-1],q[r])<=slope2(q[r],i)) r--;\n\t\tq[++r]=i;\n\t}\n\tcout<<ans1+sum[n]<<endl<<ans2+sum[n];\n\treturn 0;\n}\n\n```\n",
        "postTime": 1673525345,
        "uid": 502707,
        "name": "2021hych",
        "ccfLevel": 4,
        "title": "[BalkanOI 2012] balls"
    },
    {
        "content": "\u53ea\u8003\u8651\u4ece\u5de6\u4e0a\u5230\u53f3\u4e0b\u753b\u7ebf\u65f6\u600e\u4e48\u505a\u3002\u56e0\u4e3a\u4ece\u53f3\u4e0a\u5230\u5de6\u4e0b\u7684\u7b54\u6848\uff0c\u5c31\u662f\u628a $c$ \u7ffb\u8f6c\u4e4b\u540e\u518d\u505a\u4e00\u904d\u4ece\u5de6\u4e0a\u5230\u53f3\u4e0b\u753b\u7ebf\u3002\n\n\u6ce8\u610f\u753b\u7ebf\u4ec5\u80fd\u753b\u4e00\u6761\u7ebf\uff0c\u5373\u4e0d\u53ef\u4ee5\u4e0d\u753b\uff0c\u4e5f\u4e0d\u53ef\u4ee5\u753b $2$ \u6761\u5373\u4ee5\u4e0a\u7684\u7ebf\u3002\n\n\u8bbe $ans_i$ \u8868\u793a\u753b\u7684\u7ebf\u7ec8\u70b9\u5728 $i$ \u4e0a\u6240\u80fd\u83b7\u5f97\u7684\u6700\u5927\u503c\uff0c$s_i$ \u8868\u793a $c_i$ \u7684\u524d\u7f00\u548c\u3002\n\n\u8003\u8651\u4ece $j$ \u753b\u7ebf\u5230 $i$ \u5bf9\u603b\u4ef7\u503c\u7684\u8d21\u732e\uff0c\u6211\u4eec\u6709\uff1a\n\n$$ ans_i=\\max_{j=1}^{i-1}\\{(i-j)c_i-s_{i-1}+s_{j-1}\\}+s_n $$\n\n\uff08\u4e5f\u5c31\u662f\u8bf4\u7528 $i-j$ \u4e2a $c_i$ \u53bb\u66ff\u6362 $j\\cdots i-1$ \u7684\u4f4d\u7f6e\uff09\n\n\u5982\u679c\u76f4\u63a5\u8ba1\u7b97\u90a3\u4e48\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\uff0c\u663e\u7136\u4e0d\u884c\u3002\n\n\u5f0f\u5b50\u91cc\u7684 $s_n$ \u5148\u4e0d\u7ba1\uff0c\u6700\u540e\u7b97\uff08\u56e0\u4e3a\u6bcf\u4e2a\u91cc\u9762\u90fd\u6709 $s_n$ \u4e0d\u9020\u6210\u5f71\u54cd\uff09\uff0c\u5c06 $\\max$ \u53bb\u6389\uff0c\n\n\u5219 $ans_i=(i-j)c_i-s_{i-1}+s_{j-1}$\n\n\u62c6\u62ec\u53f7\uff0c\u79fb\u9879\uff0c\u5f97\uff1a\n\n$$s_{j-1}=c_i \\times j + (ans_i+s_{i-1}-i \\times c_i)$$\n\n\u4f17\u6240\u5468\u77e5\uff0c\u4e00\u6b21\u51fd\u6570\u89e3\u6790\u5f0f\u4e3a $y=kx+b$\n\n\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u5f88\u50cf\u4e00\u6b21\u51fd\u6570\u7684\u89e3\u6790\u5f0f\uff0c\u89e3\u6790\u5f0f\u4e2d\u7684 $y$ \u76f8\u5f53\u4e8e\u8fd9\u91cc\u7684 $s_{j-1}$\uff0c$x$ \u76f8\u5f53\u4e8e\u8fd9\u91cc\u7684 $j$\uff0c$k$ \u76f8\u5f53\u4e0e $c_i$\uff0c$b$ \u76f8\u5f53\u4e8e $ans_i+s_{i-1}-i \\times c_i$\u3002\n\n\u8003\u8651\u5230 $x$ \u662f\u5347\u5e8f\u7684\uff0c\u6211\u4eec\u8981\u4f7f $b$ \uff08\u622a\u8ddd\uff09\u5c3d\u91cf\u5927\uff0c\u6240\u4ee5\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a\u70b9 $(x,y)$\uff0c\u4e5f\u5c31\u662f $(j,s_{j-1})$\uff0c\u7ef4\u62a4\u4e00\u4e2a\u4e0a\u51f8\u5305\u3002\u7136\u800c\u8fd9\u91cc\u7684 $k$ \uff08\u659c\u7387\uff09\u662f\u65e0\u5e8f\u7684\uff0c\u6240\u4ee5\u9700\u8981\u4e8c\u5206\u4e34\u754c\u70b9\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define x(rhs) rhs\n#define y(rhs) s[rhs-1]\n#define k(rhs) a[rhs]\nusing namespace std;\ntypedef long long ll;\nconst int N=3e5+5;\nint n,q[N];\nll a[N],s[N],ans[N];\nint main(){\n\tcin>>n;\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%lld\",&a[i]);\n\t\ts[i]=s[i-1]+a[i];\n\t}\n\tint t=0;q[0]=1;\n\tfor(int i=2;i<=n;i++){\n\t\tint l=0,r=t-1,res=t;\n\t\twhile(l<=r){\n\t\t\tint mid=l+r>>1;\n\t\t\tlong double _11=y(q[mid+1])-y(q[mid]);\n\t\t\tlong double _21=x(q[mid+1])-x(q[mid]);\n\t\t\tlong double _31=k(i);\n\t\t\tif(_11/_21<=_31)res=mid,r=mid-1;\n\t\t\telse l=mid+1;\n\t\t}\n\t\tres=q[res],ans[i]=y(res)-k(i)*x(res)+i*a[i]-s[i-1]+s[n];\n\t\tif(t){\n\t\t\tlong double _1,_2,_3,_4;\n\t\t\t_1=y(q[t])-y(q[t-1]);\n\t\t\t_2=x(q[t])-x(q[t-1]);\n\t\t\t_3=y(i)-y(q[t-1]);\n\t\t\t_4=x(i)-x(q[t-1]);\n\t\t\twhile(t&&_1/_2<=_3/_4){\n\t   \t    \tt--;\n\t  \t    \tif(t){\n\t  \t        \t_1=y(q[t])-y(q[t-1]);\n\t \t\t      \t_2=x(q[t])-x(q[t-1]);\n    \t\t    \t_3=y(i)-y(q[t-1]);\n\t        \t\t_4=x(i)-x(q[t-1]);\n\t        \t}\n\t\t\t}\n\t\t}\n\t\tq[++t]=i;\n\t}\n\tll mx=-1e18;\n\tfor(int i=2;i<=n;i++)\n\t\tmx=max(mx,ans[i]);\n    cout<<mx<<endl;\n    for(int i=1;i<=n/2;i++)\n    \ta[i]^=a[n-i+1]^=a[i]^=a[n-i+1];//\u7ffb\u8f6c\n    for(int i=1;i<=n;i++)\n    \ts[i]=s[i-1]+a[i];\n    t=0;q[0]=1;\n\tfor(int i=2;i<=n;i++){\n\t\tint l=0,r=t-1,res=t;\n\t\twhile(l<=r){\n\t\t\tint mid=l+r>>1;\n\t\t\tlong double _11=y(q[mid+1])-y(q[mid]);\n\t\t\tlong double _21=x(q[mid+1])-x(q[mid]);\n\t\t\tlong double _31=k(i);\n\t\t\tif(_11/_21<=_31)res=mid,r=mid-1;\n\t\t\telse l=mid+1;\n\t\t}\n\t\tres=q[res],ans[i]=y(res)-k(i)*x(res)+i*a[i]-s[i-1]+s[n];\n\t\tif(t){\n\t\t\tlong double _1,_2,_3,_4;\n\t\t\t_1=y(q[t])-y(q[t-1]);\n\t\t\t_2=x(q[t])-x(q[t-1]);\n\t\t\t_3=y(i)-y(q[t-1]);\n\t\t\t_4=x(i)-x(q[t-1]);\n\t\t\twhile(t&&_1/_2<=_3/_4){\n\t   \t    \tt--;\n\t  \t    \tif(t){\n\t  \t        \t_1=y(q[t])-y(q[t-1]);\n\t \t\t      \t_2=x(q[t])-x(q[t-1]);\n    \t\t    \t_3=y(i)-y(q[t-1]);\n\t        \t\t_4=x(i)-x(q[t-1]);\n\t        \t}\n\t\t\t}\n\t\t}\n\t\tq[++t]=i;\n\t}\n\tmx=-1e18;\n\tfor(int i=2;i<=n;i++)\n\t\tmx=max(mx,ans[i]);\n    cout<<mx<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1643359002,
        "uid": 115668,
        "name": "y0y68",
        "ccfLevel": 0,
        "title": "P8067 \u9898\u89e3"
    }
]