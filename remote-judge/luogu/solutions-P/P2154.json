[
    {
        "content": "# P2154 \u8654\u8bda\u7684\u5893\u4e3b\u4eba \u9898\u89e3\n[\u539f\u9898\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P2154)\n## \u9898\u610f\n\u5728 $n\\times m$ \u4e00\u4e2a\u65b9\u683c\u4e0a\u7ed9\u4f60 $w$ \u4e2a\u70b9\uff0c\u6c42\u65b9\u683c\u91cc\u6bcf\u4e2a\u70b9\u6b63\u4e0a\u4e0b\u5de6\u53f3\u5404\u9009 $k$ \u4e2a\u70b9\u7684\u65b9\u6848\u6570\u3002\n\n$1\\le N,M\\le 1,000,000,000,0 \\le  x_i \\le  N,0 \\le  y_i \\le  M,1 \\le  W \\le  100,000,1 \\le  k \\le  10$\u3002\n## \u601d\u8def\n\u9996\u5148\u770b\u5230 $N,M$ \u8fd9\u4e48\u5927\uff0c\u80af\u5b9a\u8981\u5148\u79bb\u6563\u5316\u4e00\u4e0b\u3002\n\n\u7136\u540e\u8003\u8651\u600e\u4e48\u6c42\u65b9\u6848\u6570\u3002\n\n\u6211\u4eec\u5148\u5bf9\u79bb\u6563\u5316\u540e\u7684\u70b9\u6392\u4e2a\u5e8f\uff0c\u7136\u540e\u8003\u8651\u4e24\u4e2a $x$ \u76f8\u540c\u7684\u70b9 $x,y1$ \u548c $x,y2$ \u4e4b\u95f4\u7684\u6240\u6709\u70b9\u7684\u65b9\u6848\u6570\u3002\n\n\u663e\u7136\u662f:\n$$\nC_{y1\\_UP}^{k}\\times C_{y2\\_DOWN}^{k}\\times \\sum_{y1<l<y2}C_{l\\_LEFT}^{k}\\times C_{l\\_RIGHT}^{k}\n$$\n~~\u4f60\u4eec\u610f\u4f1a\u4e00\u4e0b\u3002~~\n\n\u89c2\u5bdf\u8fd9\u4e2a\u5f0f\u5b50\uff0c$C_{y1\\_UP}^{k}\\times C_{y2\\_DOWN}^{k}$ \u5f53\u524d\u5df2\u77e5\uff0c\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u7ef4\u62a4 $\\sum C_{l\\_LEFT}^{k}\\times C_{l\\_RIGHT}^{k}$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u5f00\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4\uff0c\u7ef4\u62a4\u524d $i$ \u884c\u7684 $C_{l\\_LEFT}^{k}\\times C_{l\\_RIGHT}^{k}$ \u4e4b\u548c\uff0c\u6bcf\u6b21\u78b0\u5230\u4e00\u4e2a\u70b9 $x,yy$ \u65f6\u628a\u5f53\u524d\u884c\u7684\u5f71\u54cd\u6e05\u9664\uff0c\u518d\u4ee4 $yy\\_LEFT+1,yy\\_RIGHT-1$\uff0c\u518d\u91cd\u65b0\u8ba1\u5165\u524d\u7f00\u548c\u3002\n\n\u53ef\u4ee5\u53c2\u8003\u4ee3\u7801\u4e2d Solve \u51fd\u6570\u4e2d\u53d8\u91cf $u$ \u7684\u6c42\u6cd5\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nlogn)$\u3002\n\n~~\u6211\u8fd9\u4e2a\u83dc\u9e21\u5c45\u7136\u56e0\u4e3a\u53d6\u6a21\u53d6\u9519\u4e86\u8c03\u4e86\u4e24\u8282\u8bfe\u3002~~\n## Code\n```cpp\n#include <bits/stdc++.h>\n#define _for(i,a,b) for(ll i=a;i<=b;++i)\n#define for_(i,a,b) for(ll i=a;i>=b;--i)\n#define ll long long\nusing namespace std;\nconst ll N=1e5+10,P=2147483648;\nll n,m,w,k,q[N],h[N],z[N],y[N],ans;\nstruct tree{ll x,y;}t[N];\ninline ll rnt(){\n\tll x=0,w=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')w=-1;c=getchar();}\n\twhile(c>='0'&&c<='9')x=(x<<3)+(x<<1)+(c^48),c=getchar();\n\treturn x*w;\n}\nnamespace SZSZ{\n\t/*\u6811\u72b6\u6570\u7ec4*/\n\tll b[N];\n\tinline ll lowbit(ll x){return x&-x;}\n\tinline void UpDate(ll x,ll y){\n\t\twhile(x<=w){\n\t\t\tb[x]=(b[x]+y)%P;\n\t\t\tx+=lowbit(x);\n\t\t}\n\t\treturn;\n\t}\n\tinline ll Query(ll x){\n        if(x==0)return 0;\n\t\tll sum=0;\n\t\twhile(x){\n\t\t\tsum=(sum+b[x])%P;\n\t\t\tx-=lowbit(x);\n\t\t}\n\t\treturn sum;\n\t}\n}\nnamespace LISAN{\n\t/*\u79bb\u6563\u5316*/\n\tvector<ll>xx,yy;\n\tinline bool cmp(tree a,tree b){\n\t\tif(a.x==b.x)return a.y<b.y;\n\t\treturn a.x<b.x;\n\t}\n\tinline void Add(ll x,ll y){\n\t\txx.push_back(x);\n\t\tyy.push_back(y);\n\t\treturn;\n\t}\n\tinline void LiSan(){\n\t\tsort(xx.begin(),xx.end());\n\t\tsort(yy.begin(),yy.end());\n\t\txx.erase(unique(xx.begin(),xx.end()),xx.end());\n\t\tyy.erase(unique(yy.begin(),yy.end()),yy.end());\n\t\t_for(i,1,w){\n\t\t\tt[i].x=lower_bound(xx.begin(),xx.end(),t[i].x)-xx.begin()+1;\n\t\t\tt[i].y=lower_bound(yy.begin(),yy.end(),t[i].y)-yy.begin()+1;\n\t\t\t++h[t[i].x],++y[t[i].y];\n\t\t}\n\t\tsort(t+1,t+w+1,cmp);\n\t\treturn;\n\t}\n}\nnamespace SOLVE{\n\tll c[N*20][20]={0};\n\t/*\u9884\u5904\u7406\u7ec4\u5408\u6570*/\n\tinline void PreC(){\n\t\tc[0][0]=1;\n\t\t_for(i,1,w){\n\t\t\tc[i][0]=1;\n\t\t\t_for(j,1,min(k,i))\n\t\t\t\tc[i][j]=(c[i-1][j]+c[i-1][j-1])%P;\n\t\t}\n\t}\n\t/*\u6c42\u89e3*/\n\tinline ll Solve(){\n\t\tPreC();\n\t\t_for(i,1,w-1){\n\t\t\t++q[t[i].x];\n\t\t\t++z[t[i].y];\n\t\t\tif(t[i].x==t[i+1].x&&q[t[i].x]>=k&&h[t[i].x]-q[t[i].x]>=k){\n\t\t\t\tll up=c[q[t[i].x]][k];\n\t\t\t\tll dn=c[h[t[i].x]-q[t[i].x]][k];\n\t\t\t\tll ri=SZSZ::Query(t[i+1].y-1)-SZSZ::Query(t[i].y);\n\t\t\t\tans+=((up*dn+P)%P*ri+P)%P;\n                ans%=P;\n\t\t\t}\n\t\t\tll u=((c[z[t[i].y]][k]*c[y[t[i].y]-z[t[i].y]][k]+P)%P-(SZSZ::Query(t[i].y)-SZSZ::Query(t[i].y-1)+P)%P+P)%P;\n\t\t\tSZSZ::UpDate(t[i].y,u);\n\t\t}\n\t\treturn ans;\n\t}\n}\nint main(){\n\tn=rnt(),m=rnt(),w=rnt();\n\t_for(i,1,w){\n\t\tt[i].x=rnt(),t[i].y=rnt();\n\t\tLISAN::Add(t[i].x,t[i].y);\n\t}\n\tk=rnt();\n\tLISAN::LiSan();\n\tprintf(\"%lld\\n\",SOLVE::Solve());\n\treturn 0;\n}\n/*\n\n*/\n```",
        "postTime": 1649507719,
        "uid": 306045,
        "name": "K8He",
        "ccfLevel": 5,
        "title": "P2154 \u8654\u8bda\u7684\u5893\u4e3b\u4eba \u9898\u89e3"
    },
    {
        "content": "\u5f88\u5bb9\u6613\u770b\u51fa\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u7a7a\u5730$(x,y)$\uff0c\u5982\u679c\u4e0a\u4e0b\u5de6\u53f3\u5206\u522b\u6709$u$\uff0c$d$\uff0c$l$\uff0c$r$\u68f5\u5e38\u9752\u6811\uff0c\u4e14$u,d,l,r>=k$\uff0c\u90a3\u4e48\u8fd9\u5757\u5893\u5730\u7684\u8654\u8bda\u5ea6\u4e3a$C(u,k)*C(d,k)*C(l,k)*C(r,k)$\u3002\n\n\u4f46\u662f\u73b0\u5728\u7684\u95ee\u9898\u5728\u4e8e\u5750\u6807\u7cfb\u5de8\u5927\uff0c\u4e0d\u80fd\u679a\u4e3e\u6240\u6709\u7684\u70b9\u3002\u8003\u8651\u79bb\u6563\u5316\u5750\u6807\u540e\u53ea\u679a\u4e3e\u6709\u6548\u70b9\uff08\u53ef\u4ee5\u4ea7\u751f\u8d21\u732e\u7684\u70b9\uff09\uff0c\u90a3\u4e48\u6709\u6548\u70b9\u4e5f\u6709$O(W^2)$\u4e2a\uff0c\u65e0\u6cd5\u627f\u53d7$W<=10^5$\u7684\u6570\u636e\u8303\u56f4\u3002\u9996\u5148\uff0c\u9884\u5904\u7406\u51fa$C[k~W][k]$\u7684\u503c\u5e76\u79bb\u6563\u5316\u5750\u6807\uff0c\u7136\u540e\u628a\u5e38\u9752\u6811\u4ee5$x$\u5750\u6807\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0c$y$\u5750\u6807\u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u8fd9\u6837$x$\u5750\u6807\u76f8\u540c\u7684\u5e38\u9752\u6811\u5c31\u5728\u4e00\u4e2a\u8fde\u7eed\u533a\u95f4\u91cc\uff0c\u5e76\u4e14\u8fd9\u4e2a\u8fde\u7eed\u533a\u95f4\u5185\u7684$y$\u5750\u6807\u662f\u9012\u589e\u7684\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a$x$\u5750\u6807\u76f8\u540c\u7684\u8fde\u7eed\u533a\u95f4\uff0c\u5e38\u9752\u6811\u4e4b\u95f4\u7684\u7a7a\u5730\u53ea\u8981\u6ee1\u8db3\u4e0a\u9762\u548c\u4e0b\u9762\u7684\u5e38\u9752\u6811\u6570\u91cf\u90fd\u5fc5\u987b$>=k$\uff0c\u5c31\u6709\u53ef\u80fd\u4ea7\u751f\u8d21\u732e\u3002\u800c\u5bf9\u4e8e\u6bcf\u76f8\u90bb\u7684\u4e24\u68f5\u5e38\u9752\u6811\u4e4b\u95f4\u7684\u6240\u6709\u7a7a\u5730\uff0c\u4e0a\u9762\u7684\u5e38\u9752\u6811\u7684\u6570\u91cf\u662f\u4e00\u6837\u7684\uff0c\u4e0b\u9762\u7684\u5e38\u9752\u6811\u7684\u6570\u91cf\u4e5f\u662f\u4e00\u6837\u7684\u3002\u6240\u4ee5\u53ef\u4ee5\u5feb\u901f\u5f97\u5230$C(u,k)*C(d,k)$\u7684\u503c\uff0c\u4f46\u662f\u7531\u4e8e$y$\u5750\u6807\u4e0d\u76f8\u540c\uff0c$C(l,k)*C(r,k)$\u9700\u8981\u8fdb\u884c\u6c42\u548c\u3002\u800c\u6bcf\u9047\u5230\u4e00\u68f5\u5e38\u9752\u6811\uff0c\u5bf9\u5e94\u7684$y$\u5750\u6807\u7684\u4fe1\u606f\u5c31\u9700\u8981\u6539\u53d8\u3002\u6240\u4ee5\uff0c\u8fd9\u91cc\u8003\u8651\u4f7f\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u8fd9\u4e2a\u503c\u3002\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a\n\n```cpp\nfor (i = 1; i <= w; i++) {\n    if (i == 1 || a[i].x != a[i - 1].x) tt = 0;\n    int le = a[i].y, v = (++h[le]) >= K && cnt[le] - h[le] >= K ?\n        1ll * C[h[le]][K] * C[cnt[le] - h[le]][K] % 2147483648ll : 0; tt++;\n    change(le, v - r[le]); r[le] = v;\n    if (i == w || a[i].x != a[i + 1].x || a[i + 1].y - a[i].y <= 1\n        || tt < K || tot[a[i].x] - tt < K) continue;\n    Ans += 1ll * C[tt][K] * C[tot[a[i].x] - tt][K] % 2147483648ll\n        * (ask(a[i + 1].y - 1) - ask(a[i].y)) % 2147483648ll;\n}\n```\n\u5176\u4e2d$C[][]$\u662f\u9884\u5904\u7406\u7684\u7ec4\u5408\u6570\uff0c$change$\u548c$ask$\u4e3a\u6811\u72b6\u6570\u7ec4\u7684\u64cd\u4f5c\uff0c$cnt[]$\u8bb0\u5f55\u6bcf\u4e2a$y$\u5750\u6807\u503c\u7684\u51fa\u73b0\u6b21\u6570\uff0c$tot[]$\u8bb0\u5f55\u6bcf\u4e2a$x$\u5750\u6807\u503c\u7684\u51fa\u73b0\u6b21\u6570\uff0c$Ans$\u4e3a\u7b54\u6848\u3002\n\n\u6700\u540e\u8f93\u51fa\u7b54\u6848$Ans$\u5373\u53ef\u3002\uff08\u5982\u679c\u5bf9\u6a21\u6570$2147483648$\u91c7\u53d6\u81ea\u7136\u6ea2\u51fa\uff0c\u90a3\u4e48\u8981\u6ce8\u610f\u8d1f\u6570\uff09\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\nusing namespace std;\ninline int read() {\n    int res = 0; bool bo = 0; char c;\n    while (((c = getchar()) < '0' || c > '9') && c != '-');\n    if (c == '-') bo = 1; else res = c - 48;\n    while ((c = getchar()) >= '0' && c <= '9')\n        res = (res << 3) + (res << 1) + (c - 48);\n    return bo ? ~res + 1 : res;\n}\nconst int N = 1e5 + 5;\nint w, K, C[N][12], Ans, tmp[N], T[N], col, tot[N], cnt[N], r[N], h[N];\nstruct cyx {int x, y;} a[N];\nbool comp(cyx a, cyx b) {\n    if (a.x != b.x) return a.x < b.x;\n    return a.y < b.y;\n}\nbool cmp2(cyx a, cyx b) {\n    if (a.y != b.y) return a.y < b.y;\n    return a.x < b.x;\n}\nvoid change(int x, int v) {\n    for (; x <= col; x += x & -x)\n        T[x] += v;\n}\nint ask(int x) {\n    int res = 0;\n    for (; x; x -= x & -x)\n        res += T[x];\n    return res;\n}\nint main() {\n    int i, j, tt = 0; read(); read(); w = read();\n    for (i = 1; i <= w; i++) a[i].x = read(), a[i].y = read();\n    K = read(); sort(a + 1, a + w + 1, comp);\n    for (i = 0; i <= w; i++) C[i][0] = 1;\n    for (i = 1; i <= w; i++) for (j = 1; j <= min(i, K); j++)\n        C[i][j] = C[i - 1][j] + C[i - 1][j - 1];\n    for (i = 1; i <= w; i++) {\n        if (i == 1 || a[i].x != a[i - 1].x) tt++;\n        tmp[i] = tt;\n    }\n    for (i = 1; i <= w; i++) tot[a[i].x = tmp[i]]++;\n    sort(a + 1, a + w + 1, cmp2); tt = 0;\n    for (i = 1; i <= w; i++) {\n        if (i == 1 || a[i].y != a[i - 1].y) tt++;\n        tmp[i] = tt;\n    }\n    for (i = 1; i <= w; i++) cnt[a[i].y = tmp[i]]++; col = a[w].y;\n    sort(a + 1, a + w + 1, comp);\n    for (i = 1; i <= w; i++) {\n        if (i == 1 || a[i].x != a[i - 1].x) tt = 0;\n        int le = a[i].y, v = (++h[le]) >= K && cnt[le] - h[le] >= K ?\n            1ll * C[h[le]][K] * C[cnt[le] - h[le]][K] % 2147483648ll\n            : 0; tt++;\n        change(le, v - r[le]); r[le] = v;\n        if (i == w || a[i].x != a[i + 1].x || a[i + 1].y - a[i].y <= 1\n            || tt < K || tot[a[i].x] - tt < K) continue;\n        Ans += 1ll * C[tt][K] * C[tot[a[i].x] - tt][K] % 2147483648ll\n            * (ask(a[i + 1].y - 1) - ask(a[i].y)) % 2147483648ll;\n    }\n    printf(\"%d\\n\", Ans >= 0 ? Ans : (1ll * Ans + 2147483648ll)\n        % 2147483648ll);\n    return 0;\n}\n```",
        "postTime": 1502270386,
        "uid": 29936,
        "name": "xyz32768",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2154 \u3010[SDOI2009]\u8654\u8bda\u7684\u5893\u4e3b\u4eba\u3011"
    },
    {
        "content": "### \u8654\u8bda\u7684\u5893\u4e3b\u4eba\n\n---------------\n\n###### \u89c2\u5bdf\u6570\u636e\u8303\u56f4\u5f97\u601d\u8def\n\n$N,M$\uff08\u5730\u56fe\u5927\u5c0f\uff09\u5982\u6b64\u4e4b\u5927\uff0c\u800c$W$\uff08\u6811\u7684\u4e2a\u6570\uff09\u53ea\u6709$100,000$\n\n\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u7b97\u6cd5\u65f6\u95f4\u590d\u6742\u5ea6\u591a\u534a\u662f\u5173\u4e8e$W$\u7684\u3002\u8fd9\u4e2a\u9898\u4e2d\uff0c\u80fd\u5bb9\u5fcd\u7684\u6700\u5927\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u5c31\u662f$O(WlogW)$\n\n$But$,\u4f46\u77e5\u9053\u7b97\u6cd5\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u6700\u9ad8\u4e0a\u9650\u662f\u4e0d\u80fd\u8fc7\u76f4\u63a5\u76f8\u5904\u5982\u4f55\u53bb\u505a\u7684\uff08\u5f53\u7136\u79bb\u6563\u5316\u662f\u80fd\u591f\u88ab\u60f3\u51fa\u7684\uff09\n\n$So$\uff0c\u5e94\u8be5\u8003\u8651\u4ece\u66b4\u529b\u7b97\u6cd5\u4f18\u5316\n\n-----------\n\n##### \u66b4\u529b\n\n\u66b4\u529b\u65e0\u975e\u5c31\u662f\u6bcf\u4e2a\u70b9\u626b\u4e00\u4e0b\u3002\u770b\u770b\u4e0a\u4e0b\u5de6\u53f3\u6811\u7684\u4e2a\u6570\u591a\u5c11\uff0c\u7136\u540e\u8fdb\u884c\u7ec4\u5408\u6570\u7684\u8ba1\u7b97\n\n\u5047\u8bbe\u4e0a\u4e0b\u5de6\u53f3\u5206\u522b\u6709$t_{op},b_{ottom},l_{eft},r_{right}$\u4e2a\n\n\u90a3\u4e48\u7b54\u6848\u5c31\u662f$C_t^k\\cdot C_b^k\\cdot C_l^k\\cdot C_r^k$\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(N\\cdot M) $\n\n##### \u4f18\u5316\n\n![img](https://s1.ax2x.com/2018/12/17/5QAvCA.png)\n\n\u5982\u56fe\u4e2d\u4e24\u4e2a\u84dd\u70b9\u7684\u4f4d\u7f6e\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u800c\u6613\u4e3e\u7684\u53d1\u73b0\u3002\u8fd9\u4e24\u4e2a\u84dd\u70b9\u4e0a\u9762\u548c\u4e0b\u9762\u7684$t,b$\u5927\u5c0f\u4e0d\u53d8\n\n\u4e5f\u5c31\u662f$C_t^k\\cdot C_{b}^{k}$\u5927\u5c0f\u4e0d\u53d8\uff0c\u6240\u4ee5\u8bf4\u5728\u7edf\u8ba1\u8fd9\u4e24\u4e2a\u84dd\u70b9\u65b9\u6848\u6570\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u8ba1\u7b97\u6bcf\u4e2a\u84dd\u70b9\uff08\u4e5f\u5c31\u662f\u540c\u4e00\u4e2aX\u7684\u4e24\u68f5\u6811\u4e4b\u95f4\u7684\u7a7a\u9699\uff09\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u5173\u6ce8\u6bcf\u4e2a\u84dd\u70b9\u5de6\u53f3\u7684$l,r$\u503c\u3002\u4ece\u4e0b\u5f80\u4e0a\u626b\u63cf\uff0c\u9047\u5230\u4e00\u4e2a\u6570\uff0c\u5c31\u66f4\u65b0\u4e00\u6b21$t$,$b$.\u5c31\u53ef\u4ee5\u4e86\n\n\u53ef\u662f\u8fd9\u6837\u7684\u8bdd\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u5e76\u672a\u6539\u53d8\u3002\n\n~~\u5982\u4f55\u5bf9\u654c\uff1f~~\n\n~~\u5475\u5475\u5475\u5475\uff0c\u660e\u65e5\u53ea\u9700\u8001\u592b\u4e00\u5e2d\u8bdd\u8bed........~~\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5728\u5904\u7406\u84dd\u70b9\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u4f1a\u5bf9\u8fd9\u4e2a\u4e2a\u6570\u8fdb\u884c\u66f4\u6539\u3002\u53ea\u6709\u5728\u6211\u4eec\u4ece\u5de6\u5f80\u53f3\u626b\u7684\u65f6\u5019\uff0c\u626b\u5230\u4e86\u4e00\u68f5\u6811\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6811\u4e0e\u4e0b\u4e00\u4e2a**\u540c\u7eb5\u5750\u6807\u4e4b\u95f4\u7684\u84dd\u70b9**\u7684$l,r$\u624d\u4f1a\u66f4\u6539\uff08\u6df1\u7eff\u6846\u4e2d\u84dd\u70b9\u4e0e\u7d2b\u70b9\u7684$l,r$,~~\u5f53\u7136\u8fd9\u4e2a\u7d2b\u70b9\u7684\u4f4d\u7f6e\u5e76\u4e0d\u4f1a\u8ba1\u7b97\u8d21\u732e~~\uff09\n\n\u8ba9\u6211\u4eec\u56de\u987e\u4e00\u4e0b\uff0c\u73b0\u5728\u7684\u74f6\u9888\u662f\u5728\u4e8e\u7edf\u8ba1\u6bcf\u4e2a\u84dd\u70b9\uff08\u7a7a\u9699\uff0c\u4e0b\u79f0\u84dd\u70b9\uff09\u7684\u5de6\u53f3\u7684\u6811\u7684\u4e2a\u6570\u3002\n\n\u6240\u4ee5\u8bf4\u6211\u4eec\u8981\u4f7f\u7528\u6570\u636e\u7ed3\u6784\u4f18\u5316\u6c42\u548c\uff08\u4ec0\u4e48\u548c\uff1f\u5c31\u662f\u5f53\u524d\u84dd\u70b9\u7684$C_l^k\\cdot C_r^k$\u3002\u4e3a\u4ec0\u4e48\u53ef\u4ee5\uff1f\u5229\u7528\u4e58\u6cd5\u5206\u914d\u5f8b\uff0c\u5206\u89e3\u540c\u4e00X\u7684\u4e24\u68f5\u6811\u4e4b\u95f4\u7684\u8d21\u732e\uff0c\u5bf9\u7b54\u6848\u4e0d\u5f71\u54cd\uff09\n\n\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u652f\u6301\u4ec0\u4e48\uff1f\n\n\u8981\u652f\u6301\u533a\u95f4\u6c42\u548c\u548c\u5355\u70b9\u4fee\u6539\u3002\u6240\u4ee5\u8bf4\u9009\u7528\u6811\u72b6\u6570\u7ec4\u3002\n\n\u5229\u7528\u6811\u72b6\u6570\u7ec4\uff0c\u5feb\u901f\u7b97\u51fa\u4e24\u68f5\u6811\uff08\u540c\u4e00X\uff09\u4e4b\u95f4\u7a7a\u9699\u7684$C_l^k\\cdot C^k_r$\u3002\u7136\u540e\u4e58\u4ee5$C_t^k\\cdot C_b^k$\n\n\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u5728$O(WlogW)$\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u7b97\u51fa\u7b54\u6848\n\n\u522b\u5fd8\u4e86\u79bb\u6563\u5316\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#include<algorithm>\nusing std::sort;\nconst int maxn=101000;\nconst long long mode=2147483648LL;\nstruct node\n{\n    int x,y;//\u539f\u59cb\u4f4d\u7f6e\n    int X,Y;//\u79bb\u6563\u5316\u540e\u4f4d\u7f6e\n    bool operator < (const node &a)const\n    {\n        if(x!=a.x)  return x<a.x;\n        return y<a.y;\n        //\u5176\u5b9e\u8fd9\u91cc\u7528\u79bb\u6563\u540e\u7684\u5750\u6807\u6548\u679c\u662f\u4e00\u6837\u7684\n    }\n};\nnode T[maxn];\nlong long last[maxn],Layt[maxn];\nlong long C[maxn][11];\nlong long ans;\nint totX[maxn],totY[maxn];\nint baseX[maxn],lenX;\nint baseY[maxn],lenY;\nint base[maxn];\nint N,M,w,k;\nint length;\nvoid insert(long long val,int pos)//Begin\uff1a\u6811\u72b6\u6570\u7ec4\n{\n    while(pos<=length)\n    {\n        base[pos]=(base[pos]+val)%mode;\n        pos+=(pos&(-pos));\n    }\n    return ;\n}\nlong long sum(int pos)\n{\n    if(pos==0)  return 0;\n    long long res=0;\n    while(pos)\n    {\n        res=(res+base[pos])%mode;\n        pos-=(pos&(-pos));\n    }\n    return res;\n}\nlong long query(int l,int r)\n{\n    return sum(r)-sum(l-1);\n}//End\uff1a\u6811\u72b6\u6570\u7ec4\n\n//\u4ee5\u4e0a\u662f\u6700\u666e\u901a\u4e0d\u8fc7\u7684\u6811\u72b6\u6570\u7ec4\n//-----------------------------------\nvoid unique(int *A,int &Len)//\u53bb\u91cd\n{\n    sort(A+1,A+Len+1);\n    int len=0,now=0x7fffffff;\n    for(int i=1;i<=Len;i++)\n        if(now!=A[i])\n        {\n            now=A[i];\n            A[++len]=A[i];\n        }\n    Len=len;//\u4e0a\u9762\u7684\u5f15\u7528\uff0c\u95f4\u63a5\u66f4\u6539\n    return;\n}\nint check(int *A,int len,long long val)//\u79bb\u6563\u5316\u67e5\u8be2\n{\n    int l=1,r=len;\n    while(l<r)\n    {\n        int mid=(l+r)>>1;\n        if(A[mid]>=val) r=mid;\n        else    l=mid+1;\n    }\n    return l;\n}\n//\u4ee5\u4e0a\u662f\u79bb\u6563\u5316\u548c\u4e8c\u5206\n//-----------------------------------\nvoid init(int x)//\u7ec4\u5408\u6570\n{\n    C[0][0]=1;\n    for(int i=1;i<=x;i++)\n        for(int j=0;j<=10;j++)\n            C[i][j]=(C[i-1][j]+(j?C[i-1][j-1]:0))%mode;\n    return ;\n}\n//-----------------------------------\nvoid account(int n)//\u7edf\u8ba1\u79bb\u6563\u5316\u540e\u6bcf\u4e00\u5217\uff0c\u6bcf\u4e00\u884c\u5171\u6709\u591a\u5c11\u4e2a\u6811\n{\n    int nowX,nowY;\n    for(int i=1;i<=n;i++)\n    {\n        nowX=check(baseX,lenX,T[i].x);\n        nowY=check(baseY,lenY,T[i].y);\n        totY[nowY]++;\n        totX[nowX]++;\n        T[i].X=nowX;T[i].Y=nowY;//\u8bb0\u5f55\u79bb\u6563\u5316\u540e\u6bcf\u68f5\u6811\u7684\u4f4d\u7f6e\n    }\n    length=lenY;\n}\nvoid add(int Y,int K)//\u5c06\u4e00\u9897\u6811\u586b\u8fdb\u6811\u72b6\u6570\u7ec4\n{\n    if(last[Y])//\u5982\u679c\u8fd9\u68f5\u6811\u7684Y\u4e4b\u524d\u6709\u8fc7\u503c\uff0c\u5e94\u8be5\u5148\u5c06\u8fd9\u4e2a\u503c\u5728\u6811\u72b6\u6570\u7ec4\u4e2d\u51cf\u53bb\n    {\n        //last\u4e3a\u4e0a\u4e00\u6b21\u7684\u503c\n        insert(-last[Y],Y);\n    \tlast[Y]=0;//\u5f52\u96f6\n\t}\n    Layt[Y]++;//\u8fd9\u4e2aY\u4e2d\u5df2\u7ecf\u88ab\u904d\u5386\u8fc7\u7684\u6811\u7684\u6570\u91cf+1\n    if(Layt[Y]>=K&&totY[Y]-Layt[Y]>=K)//\u65b0\u52a0\u7684\u8fd9\u4e00\u68f5\u6811\u5728\u5de6\u53f3\u6ee1\u8db3\u6761\u4ef6\n    {\n        long long pas=(C[Layt[Y]][K]*C[totY[Y]-Layt[Y]][K])%mode;\n        insert(pas,Y);//\u63d2\u5165\n        last[Y]=pas;//\u8bb0\u5f55\n    }\n}\nlong long clac(int l,int r)\n{\n\tif(l>r)\treturn 0;//\u9632\u6b62\u9519\u8bef\uff0c\u9519\u8bef\u7684\u539f\u56e0\u662f\u4e24\u68f5\u6811\u4e4b\u95f4\u6709\u53ef\u80fd\u6ca1\u6709\u7a7a\u9699\n    return query(l,r);//\u6811\u72b6\u6570\u7ec4\u67e5\u8be2\n}\nvoid work(int n,int K)//\u89e3\u51b3\u95ee\u9898\n{\n    int nowX=-1,now;//nowX\u4e3a\u4e0a\u4e00\u6b21\u5904\u7406\u7684X\u4f4d\u7f6e\uff0cnow\u4e3a\u8ba1\u6570\u5668\n    for(int i=1;i<=n;i++)\n    {\n        if(nowX!=T[i].X)//\u548c\u4e0a\u4e00\u6b21\u4e0d\u5728\u540c\u4e00\u4e2aX\u4e2d\n        {\n            now=0;//\u8ba1\u6570\u5668\u5f52\u96f6\n            nowX=T[i].X;//\u8d4b\u503c\n        }\n        now++;//\u8ba1\u6570\u5668++\n        if(totX[nowX]-now>=k&&now>=K&&T[i+1].X==nowX)\n            ans=(ans+(C[now][k]*(clac(T[i].Y+1,T[i+1].Y-1)*C[totX[nowX]-now][k])%mode)%mode)%mode;\n        /*\n        *   totX[nowX]-now>=k\u662f\u5224\u65ad\u662f\u5426\u4e0a\u9762\u6811\u7684\u6570\u91cf\u53ef\u4ee5\u8fdb\u884c\u8ba1\u7b97\n        *   now>=K\u662f\u5224\u65ad\u4e0b\u9762\u7684\u6811\u7684\u6570\u91cf\u662f\u5426\u53ef\u4ee5\u8fdb\u884c\u8ba1\u7b97\n        *   T[i+1].X==nowX \u7279\u5224\u7b2ci\u68f5\u6811\u548c\u7b2ci+1\u68f5\u6811\u5728\u540c\u4e00X\n        *   ------------------------\n        *   clac(T[i].Y+1,T[i+1].Y-1)\u662f\u8ba1\u7b97\u7b2ci\u68f5\u548c\u7b2ci+1\u68f5\u4e4b\u95f4\u7a7a\u9699\u4e2d\u7684\u65b9\u6848\u603b\u6570\n        *   ------------------------\n        */\n        add(T[i].Y,K);  //\u5c06\u8fd9\u68f5\u6811\u7684\u8d21\u732e\u52a0\u5165\u6811\u72b6\u6570\u7ec4\n    }\n}\n//\u89e3\u51b3\u95ee\u9898\n//--------------------------------------\nint main()\n{\n    scanf(\"%d%d%d\",&N,&M,&w);\n    for(int i=1;i<=w;i++)\n    {\n        scanf(\"%d%d\",&T[i].x,&T[i].y);\n        baseX[i]=T[i].x;\n        baseY[i]=T[i].y;\n    }\n    scanf(\"%d\",&k);\n    unique(baseX,lenX=w);//\u624b\u5199\u7684\u53bb\u91cd\u51fd\u6570\n    unique(baseY,lenY=w);\n    sort(T+1,T+1+w);//\u6309\u7167\u89c4\u5219\u6392\u5e8f\n    init(w);//\u521d\u59cb\u5316\u7ec4\u5408\u6570\n    account(w);//\u7edf\u8ba1\u79bb\u6563\u5316\u540e\u6bcf\u4e00\u5217\uff0c\u6bcf\u4e00\u884c\u5171\u6709\u591a\u5c11\u4e2a\u6811\n    work(w,k);//\u89e3\u51b3\u95ee\u9898\n    printf(\"%lld\",(ans+mode)%mode);//\u8f93\u51fa\u7b54\u6848\n}\n//\u4e3b\u51fd\u6570\n\n```\n\n##### Ps\uff1a\u672c\u4eba\u849f\u84bb\uff0c\u5982\u6709\u7eb0\u6f0f\u3002\u8bf7\u5728\u8bc4\u8bba\u533a\u6307\u51fa\u3002\u4e0d\u80dc\u611f\u6fc0\n\n",
        "postTime": 1545038615,
        "uid": 28007,
        "name": "Lance1ot",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P2154 \u3010[SDOI2009]\u8654\u8bda\u7684\u5893\u4e3b\u4eba\u3011"
    },
    {
        "content": "## \u9898\u9762\u63cf\u8ff0\n\n![](http://images.cnblogs.com/cnblogs_com/JCNL666/1434484/o_jjjj.PNG)\n\n## \u6837\u4f8b\u8f93\u5165\n\n>5 6\n>\n>13\n>\n>0 2\n>\n>0 3\n>\n>1 2\n>\n>1 3\n>\n>2 0\n>\n>2 1\n>\n>2 4\n>\n>2 5\n>\n>2 6\n>\n>3 2\n>\n>3 3\n>\n>4 3\n>\n>5 2\n>\n>2\n\n\n## \u6837\u4f8b\u8f93\u51fa\n\n> 6\n\n## \u9898\u89e3\n\n\u8fd9\u9898\u771f\u662f(#@-^%~!*.......)\n\n\u7b80\u76f4\u53d8\u6001\u554a\uff0c\u597d\u597d\u7684\u4e00\u4e2a\u575f\u5934\u975e\u5f97\u6574\u51fa\u4e00\u9053\u9898\u3002\u3002\u3002\n\n\u7b97\u4e86\uff0c\u752d\u8bf4\u4e86\u5206\u6790\u4e00\u4e0b\u9898\u76ee\u5427\u3002\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u9898\u7684 $n,m$ \u8303\u56f4\u662f\u8fbe\u5230\u4e8610\u4ebf\u7684\u7ea7\u522b\u3002\u8fd9\u3002\u3002\u3002\n\n\u597d\u50cf\u76f4\u63a5\u60f3\u4e0d\u51fa\u6b63\u89e3\uff0c\u6211\u4eec\u5148\u53bb\u770b\u770b\u90e8\u5206\u5206\u3002\n\n\u53d1\u73b0 $n,m \\leqslant 1000$ \u7684\u8fd9\u90e8\u5206\u597d\u50cf\u53ef\u505a\u3002\n\n\u6211\u4eec $O(N^2)$ \u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u626b\u8fc7\u53bb\uff0c\u7136\u540e\u5982\u679c\u8fd9\u4e2a\u70b9\u4e0d\u662f\u5e38\u9752\u6811\u5c31\u53ef\u4ee5\u7edf\u8ba1\u4e00\u4e0b\u7b54\u6848\uff0c\u600e\u4e48\u7edf\u8ba1\u5462\uff1f\n\n\u8003\u8651\u7ec4\u5408\u6570\u5b66\uff1a\n\n\u8bbe\u5728\u67d0\u4e2a\u65b9\u5411\u4e0a\u6709 $a$ \u4e2a\u5e38\u9752\u6811\uff0c\u6211\u4eec\u53ea\u8981\u9009 $k$ \u4e2a\u90a3\u4e48\u5c31\u662f $C_{a}^{k}$\uff0c\u8fd9\u4e2a\u70b9\u7684\u65b9\u6848\u6570\u5c31\u662f\u6240\u6709\u65b9\u5411\u7684\u8fd9\u4e9b\u65b9\u6848\u4e58\u8d77\u6765\u3002\n\n\u6109\u5feb\u7684\u89e3\u51b3\u5b50\u95ee\u9898\u4e4b\u540e\u8003\u8651\u89e3\u51b3\u672c\u9898\u3002\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u4e00\u4e2a\u6027\u8d28\uff1a\n\n![](http://images.cnblogs.com/cnblogs_com/JCNL666/1434484/o_aaaa.PNG)\n\n~~\u56fe\u7247\u5168\u90e8\u7531\u777f\u667a\u753b\u56fe\u751f\u6210\uff0c\u89c1\u8c05~~\n\n\u5f53\u70b9\u4f4d\u4e8e\u4e24\u68f5\u6811\u4e4b\u95f4\u65f6\u5176\u5b9e\u4ed6\u4eec\u5728 $y$ \u8f74\u65b9\u5411\u7684\u65b9\u6848\u662f\u4e00\u6837\u7684\u3002\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u5feb\u901f\u76f4\u63a5\u7684\u6c42\u51fa\u4e00\u6bb5\u5e38\u9752\u6811\u4e4b\u95f4\u7684\u533a\u95f4\u7684\u65b9\u6848\u6570\u3002\n\n\u539f\u6765\u7684\u662f\uff1a\n\n$\\sum_{i=tree[l]}^{tree[r]} C_{L[i]}^{k}*C_{R[i]}^{k}*C_{U[i]}^{k}*C_{D[i]}^{k}$\n\n\u6839\u636e\u4e58\u6cd5\u5206\u914d\u7387\u53ef\u4ee5\u76f4\u63a5\u63d0\u51fa\u53d8\u6210\n\n$C_{U[i]}^{k}*C_{D[i]}^{k}*\\sum_{i=tree[l]}^{tree[r]}C_{L[i]}^{k}*C_{R[i]}^{k}$\n\n\u53c8\u60f3\u5230\u521a\u521a\u7684\u6027\u8d28\uff0c\u90a3\u4e48\u6211\u4eec\u662f\u4e0d\u662f\u53ef\u4ee5\u5feb\u901f\u6c42\u51fa\u8fd9\u4e2a\u5f0f\u5b50\u7684\u524d\u534a\u90e8\u5206\uff0c\u540e\u534a\u90e8\u5206\u600e\u4e48\u529e\u5462\uff1f\n\n\u6211\u4eec\u4e0d\u4f46\u8981\u652f\u6301\u67e5\u8be2\u4e00\u6bb5\u533a\u95f4$C_{L[i]}^{k}*C_{R[i]}^{k}$\u7684\u548c,\u8fd8\u8981\u8ba9\u8fd9\u4e2a $L[i],R[i]$ \u53d1\u751f\u53d8\u5316\u3002\n\n\u8fd9\u4e2a\u65f6\u5019\u7075\u5149\u4e00\u95ea\u2014\u2014\u2014\u2014\n\n\u6211\u4eec\u5c06\u9898\u76ee\u7ed9\u6211\u4eec\u7684\u5750\u6807\u4eec\u6392\u4e2a\u5e8f($x$\u7b2c\u4e00\u5173\u952e\u5b57\uff0c$y$\u7b2c\u4e8c\u5173\u952e\u5b57)\u8fd9\u6837\u6240\u6709x\u76f8\u540c\u7684\u70b9\u90fd\u5728\u4e00\u8d77\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u6c42\u51fa\u8fd9\u6bb5\u533a\u95f4\u7684\u90a3\u4e2a\u5f0f\u5b50\u7684\u524d\u534a\u90e8\u5206\uff0c\u540e\u534a\u90e8\u5206\u7684\u7ef4\u62a4\u53c8\u60f3\u5230\u8981\u652f\u6301\u533a\u95f4\u6c42\u548c\u548c\u5355\u70b9\u4fee\u6539\u3002\u60f3\u5230\u6811\u72b6\u6570\u7ec4\u3002\n\n\u8003\u8651\u5230\u5199\u4e00\u4e2a\u4e8c\u7ef4\u7684\u6811\u72b6\u6570\u7ec4\u8fd8\u662f\u5f88\u96be\u7ef4\u62a4\uff0c\u90a3\u4e48\u6211\u4eec\u7d22\u6027\u7528\u4e00\u7ef4\u7684\uff0c\u628a $x$ \u90a3\u4e00\u7ef4\u7edf\u7edf\u4ea4\u7ed9\u6392\u5e8f\u5904\u7406\uff0c\u8fd9\u6837\u6211\u4eec\u53ea\u8981\u8bb0\u5f55\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4 $s[i]$ \u8868\u793a\u5f53\u5728 $y$ \u8f74 $i$ \u65b9\u5411\u7684\u65f6\u5019\u5df2\u7ecf\u653e\u4e86 $s[i]$ \u4e2a\u5e38\u9752\u6811\u5728\u5de6\u8fb9\uff0c\u90a3\u4e48\u53f3\u8fb9\u5c31\u53ef\u4ee5\u52a8\u6001\u5730\u7528\u603b\u7684\u4e2a\u6570\u51cf\u4e00\u51cf\u6216\u8005\u76f4\u63a5\u52a8\u6001\u7ef4\u62a4(\u51cf\u4e00\u51cf\uff0c\u52a0\u4e00\u52a0)\u3002\n\n\u5bf9\u4e8e $x$ \u5750\u6807 \u76f8\u540c\u7684\u6211\u4eec\u6bcf\u6b21\u53ea\u8981\u540c\u6837\u52a8\u6001\u7ef4\u62a4\u4e0b\u9762\u6709\u51e0\u4e2a\u5e38\u9752\u6811\u4e86\u3002\n\n\u81f3\u4e8e\u4ee3\u7801\u5e94\u8be5\u86ee\u597d\u5199\u4e86\uff0c\u4ee3\u7801\u4e0d\u61c2\u7684\u53ef\u4ee5\u770b\u770b\u4ee3\u7801\u6ce8\u91ca\u3002\n\n\u8fd8\u662f\u86ee\u597d\u7684\u4e00\u9053\u9898\u53ef\u4ee5\u953b\u70bc\u601d\u7ef4\uff0c\u4e0d\u61c2\u7684\u6b22\u8fce\u79c1\u4fe1(\u5927\u6982\u610f\u4e00\u65f6\u534a\u4f1a\u4e8c\u4e0d\u4f1aAFO)\u3002\n\n~~\u6276\u6211\u8d77\u6765\u6211\u8fd8\u80fd\u82df,~~\n\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long \n#define x first\n#define y second\n\ninline char gc(){\n\tstatic char buf[1<<20],*p1=buf,*p2=buf;\n\tif(p1==p2){\n\t\tp2=(p1=buf)+fread(buf,1,1<<20,stdin);\n\t\tif(p1==p2) return EOF;\n\t}\n\treturn *p1++;\n}\n\ninline int read(){\n    int x=0;char ch=gc();\n    while(!isdigit(ch)) ch=gc();\n    while(isdigit(ch)) x=x*10+ch-'0',ch=gc();\n    return x;\n}\n\nint w;\ntypedef pair<int,int> PII;\nconst int N=1e5+5,P=2147483648LL;\nint x[N],y[N],c[N][15];// c\u662f\u7ec4\u5408\u6570\nint t[N],s[N];// t\u4e3a\u5f53\u7eb5\u5750\u6807\u662ft\u65f6\u5de6\u8fb9\u5e38\u9752\u6811\u7684\u4e2a\u6570\nint NumOfX[N],NumOfY[N];// \u8fd9\u4e24\u4e2a\u5206\u522b\u8868\u793a\u6a2a\u5750\u6807\u4e3ax\u7684\u70b9\u7684\u4e2a\u6570\u548c\u7eb5\u5750\u6807\u4e3ay\u7684\u4e2a\u6570\uff08\u603b\u4e2a\u6570\uff09\nPII p[N];// \u7528\u6765\u5b58\u4e00\u4e0b\u79bb\u6563\u4e4b\u540e\u7684\u5750\u6807\uff0cpair\u771f\u597d\u7528\n\ninline int lowbit(int x){\n    return x&(-x);\n}\n\ninline void update(int x,int plus){\n\tplus%=P;\n    while(x<=w){\n        s[x]=(s[x]+plus)%P;\n        x+=lowbit(x);\n    }\n}\n\ninline int query(int x){\n    int ret=0;\n    while(x){\n        ret=(ret+s[x])%P;\n        x-=lowbit(x);\n    }\n    return ret;\n}\n// \u6811\u72b6\u6570\u7ec4\nsigned main(){\n    read();read();\n    w=read();\n    for(int i=1;i<=w;++i) x[i]=p[i].x=read(),y[i]=p[i].y=read();\n    int k=read();\n\tc[0][0]=1;\n    for(int i=1;i<=w;++i){\n        c[i][0]=1;\n        for(int j=1;j<=k;++j)\n            c[i][j]=(c[i-1][j]+c[i-1][j-1])%P;\n    }\n    sort(x+1,x+w+1);\n    sort(y+1,y+w+1);\n    for(int i=1;i<=w;++i) \n\t\tp[i].x=lower_bound(x+1,x+w+1,p[i].x)-x,NumOfX[p[i].x]++;\n    for(int i=1;i<=w;++i) \n\t\tp[i].y=lower_bound(y+1,y+w+1,p[i].y)-y,NumOfY[p[i].y]++;\n\t// \u79bb\u6563\u548c\u521d\u59cb\u5316\u7ec4\u5408\u6570\n    sort(p+1,p+w+1);\n    int DOWN=1,ans=0;// DOWN\u8bb0\u5f55\u5f53\u524d\u5e38\u9752\u6811\u7684\u4e0b\u9762\uff08\u5305\u62ec\u5f53\u524d\uff09\u6709\u51e0\u68f5\u5e38\u9752\u6811\n    for(int i=1;i<w;++i){\n        if(p[i].x==p[i-1].x) DOWN++;\n        else DOWN=1;\n        int UP=NumOfX[p[i].x]-DOWN;// UP\u8bb0\u5f55\u5f53\u524d\u5e38\u9752\u6811\u4e0a\u9762\uff08\u4e0d\u5305\u62ec\u5f53\u524d\uff09\u6709\u51e0\u68f5\u5e38\u9752\u6811\n        if(UP){\n            int Ceil=p[i+1].y-1;// ceil\u8868\u793a\u4e0b\u4e00\u68f5\u6709\u79cd\u76f8\u540cx\u5750\u6807\u7684\u5e38\u9752\u6811\u7684\u5750\u6807\u51cf1\uff08\u6bd5\u7adf\u6c42\u533a\u95f4\u548c\u4e0d\u80fd\u5305\u62ec\u4e0b\u4e00\u68f5\u5e38\u9752\u6811\uff09\n            ans+=c[DOWN][k]*c[UP][k]%P*(((query(Ceil)-query(p[i].y)%P+P)%P))%P;\n\t\t\t// \u5e26\u8fdb\u516c\u5f0f\u91cc\u5934\u7b97\u4e00\u7b97\n        }\n        ++t[p[i].y];// \u66f4\u65b0\u4e00\u4e0b\u7eb5\u5750\u6807\u4e3ap[i].y\u7684\u5df2\u7ecf\u653e\u4e86\u7684\u5904\u4e8e\u5de6\u8fb9\u7684\u5e38\u9752\u6811\n        int now=c[t[p[i].y]][k]*c[NumOfY[p[i].y]-t[p[i].y]][k]%P;\n        int pre=((query(p[i].y)-query(p[i].y-1))%P+P)%P;\n        update(p[i].y,((now-pre)%P+P)%P);\n\t\t// \u66f4\u65b0\u6811\u72b6\u6570\u7ec4\u4e2d\u8fd9\u4e2a\u8282\u70b9\u7684\u5de6\u53f3\u65b9\u6848\u6570\u4e58\u79ef\n    }\n    printf(\"%lld\\n\",(ans%P+P)%P);\n    return 0;\n}\n```",
        "postTime": 1559226019,
        "uid": 87075,
        "name": "\u4e8c\u54e5\u5543\u83dc\u5305",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2154 \u3010[SDOI2009]\u8654\u8bda\u7684\u5893\u4e3b\u4eba\u3011"
    },
    {
        "content": "## \u626b\u63cf\u7ebf+\u79bb\u6563\u6570\u5b66\n\n\u5176\u5b9e\u53bb\u6389\u6c42\u7ec4\u5408\u6570\u8fd8\u771f\u5c31\u662f\u4e2a\u626b\u63cf\u7ebf\u7684\u6a21\u677f\u9898\n\n\u8fd9\u91cc\u662f\u7ebf\u6bb5\u6811\u5199\u6cd5\n\n------\n### \u4e00\u4e9b\u95f2\u8bdd\n\n~~\u505a\u8fd9\u9898\u65f6\u8111\u6d77\u4e2d\u59cb\u7ec8\u6d6e\u73b0\u51fa\u591a\u5e74\u524dCCTV10\u64ad\u51fa\u8fc7\u7684\u4e00\u4e2a\u680f\u76ee\u7684\u67d0\u4e00\u671f\u300a\u9009\u62e9\u8ba9\u5386\u53f2\u9057\u5fd8\u7684\u5893\u4e3b\u4eba\u300b,\u7b80\u76f4\u662f\u7ae5\u5e74\u9634\u5f71~~\n\n-----\n\n\u89c2\u5bdf$n$\uff0c$m$\u7684\u8303\u56f4\u663e\u7136\u592a\u5927\u4e86\uff0c\u8003\u8651\u79bb\u6563\u5316\uff0c\u624b\u73a9\u4e00\u4e0b\u53ef\u4ee5\u77e5\u9053\u628a\u5893\u56ed\u79bb\u6563\u5316\u662f\u4e0d\u5f71\u54cd\u7b54\u6848\u7684\u3002\n\n\u7136\u540e\u628a\u5e38\u9752\u6811\u4ee5$x$\u5750\u6807\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0c$y$\u5750\u6807\u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\u6392\u5e8f\u3002\u4f9d\u6b21\u5904\u7406\u6bcf\u4e00\u9897\u5e38\u9752\u6811\u3002\n\n\u6211\u4eec\u5efa\u7acb\u4e00\u6839\u4e0e$y$\u8f74\u5e73\u884c\u7684\u626b\u63cf\u7ebf\uff0c\u4ece\u6700\u5de6\u4e0b\u89d2\u7684\u5e38\u9752\u6811\u4f9d\u6b21\u5411\u4e0a\u5411\u53f3\u626b\u63cf\u3002\u6bcf\u5f53\u6211\u4eec\u53d1\u73b0\u67d0\u4e00\u4e2a\u5e38\u9752\u6811\u4e0e\u4e0a\u4e00\u68f5\u7684$x$\u5750\u6807\u76f8\u540c\u65f6\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e24\u68f5\u6811\u4e4b\u95f4\u7684\u7a7a\u5730\u7684\u4e0a\u4e0b\u7684\u5e38\u9752\u6811\u68f5\u6811 \u662f\u4e00\u6837\u7684\uff0c\u90a3\u6211\u4eec\u53ea\u9700\u8981\u7edf\u8ba1\u8fd9\u4e9b\u7a7a\u5730\u7684\u5de6\u53f3\u5404\u6709\u591a\u5c11\u5e38\u9752\u6811\u5373\u53ef\u3002\u5173\u4e8e\u8fd9\u4e00\u70b9\uff0c\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6bcf\u4e00\u884c\u3001\u6bcf\u4e00\u5217\u5404\u6709\u591a\u5c11\u6811\u5373\u53ef\u3002\n\n\u56e0\u4e3a\u662f\u4ece\u5de6\u81f3\u53f3\u626b\u63cf\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u5904\u7406\u67d0\u4e00\u5217\u7684\u65f6\u5019\uff0c\u8fd9\u4e00\u5217\u5750\u6807\u7684\u5e38\u9752\u6811\u68f5\u6811\u90fd\u5df2\u7ecf\u5728\u7ebf\u6bb5\u6811\u91cc\u9762\u4e86\uff0c\u76f4\u63a5\u53d6\u51fa\u6765\u7528\u5373\u53ef\u3002\u6700\u540e\u518d\u628a\u8fd9\u4e00\u884c\u7684\u5e38\u9752\u6811\u68f5\u6811\u66f4\u65b0\u3002\n\n\u5f53\u7136\u9700\u8981\u6ce8\u610f\uff0c\u53ea\u6709\u5e38\u9752\u6811\u68f5\u6811\u90fd\u4e0d\u5c0f\u4e8e$K$\u624d\u53ef\u4ee5\u88ab\u8ba1\u5165\u7b54\u6848\n\n\u5173\u4e8e\u7b97\u7ec4\u5408\u6570\u7684\u90e8\u5206\uff0c\u6b63\u786e\u7406\u89e3\u9898\u610f\u5c31\u597d\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u8bb2\u7684\u6bd4\u8f83\u62bd\u8c61\uff0c\u5177\u4f53\u53c2\u89c1\u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int maxn = 1e+5+100;\nstruct Data{\n\tint x,y;\n};\nint n,m,K,w,ans;\nData a[maxn];\nint A[maxn<<1];\nint lne[maxn],qee[maxn],lft[maxn],dwn[maxn];\n//qee\u548clne\u8868\u793a\u67d0\u4e00\u5217\u67d0\u4e00\u884c\u5171\u6709\u591a\u5c11\u68f5\u5e38\u9752\u6811\n//lft\u548cdwn\u8868\u793a\u8ba1\u7b97\u5230\u5f53\u524d\u4f4d\u7f6e\u5de6\u4fa7\u548c\u4e0b\u65b9\u6709\u591a\u5c11\u68f5\u5e38\u9752\u6811\nint C[maxn][20];\nint sumv[maxn<<2];\nbool cmp(Data x,Data y){\n\treturn x.x==y.x?x.y<y.y:x.x<y.x;\n}\n\ninline void optset(int o,int l,int r,int q,int v){\n\tif(l==r){\n\t\tsumv[o] = v;\n\t\treturn;\n\t}\n\tint mid=l+r>>1;\n\tif(q<=mid) optset(o<<1,l,mid,q,v);\n\telse optset(o<<1|1,mid+1,r,q,v);\n\tsumv[o] = sumv[o<<1] + sumv[o<<1|1];\n\treturn ;\n}\ninline int query(int o,int l,int r,int ql,int qr){\n\tif(ql<=l&&r<=qr) return sumv[o];\n\tint mid=l+r>>1,res=0;\n\tif(ql<=mid) res = query(o<<1,l,mid,ql,qr);\n\tif(qr>mid) res+= query(o<<1|1,mid+1,r,ql,qr);\n\treturn res;\n}\nint main(){\n\tcin>>n>>m>>w;\n\tfor(int i=1;i<=w;++i){\n\t\tcin>>a[i].x>>a[i].y;\n\t\ta[i].x;a[i].y;\n\t\tA[i<<1] = a[i].x;\n\t\tA[i<<1|1] = a[i].y;\n\t}\n\tcin>>K;\n\tsort(A+1,A+2*w+1);\n\tint cnt = unique(A+1,A+2*w+1) - A - 1;\n\tfor(int i=1;i<=w;++i){\n\t\ta[i].x=lower_bound(A+1,A+cnt+1,a[i].x)-A;\n\t\ta[i].y=lower_bound(A+1,A+cnt+1,a[i].y)-A;\n\t}\n\tsort(a+1,a+w+1,cmp);\n\tfor(int i=1;i<=w;++i){\n\t\tlne[a[i].y] ++ ;\n\t\tqee[a[i].x] ++ ;\n\t}\n\tfor(int i=0;i<=w;++i) C[i][0] = 1;\n\tfor(int i=1;i<=w;++i){\n\t\tfor(int j=1;j<=10&&j<=i;++j){\n\t\t\tC[i][j] = C[i-1][j-1]+C[i-1][j];\n\t\t\t//printf(\"C[%d][%d] = %d\\n\",i,j,C[i][j]);\n\t\t}\n\t}\n\tfor(int i=1;i<=w;++i){\n\t\tint x=a[i].x,y=a[i].y;\n\t\t//printf(\"myc %d %d\\n\",x,a[i-1].x);\n\t\tif(x==a[i-1].x){\n\t\t\t++dwn[x];\n\t\t\tif(dwn[x]>=K&&qee[x]-dwn[x]>=K){\n\t\t\t\tint delta = y-a[i-1].y;\n\t\t\t\tif(delta>1){\n\t\t\t\t\tans += C[dwn[x]][K]*C[qee[x]-dwn[x]][K]*query(1,1,w,a[i-1].y+1,y-1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t++lft[y];\n\t\tif(lft[y]>=K&&lne[y]-lft[y]>=K){\n\t\t\toptset(1,1,w,y,C[lft[y]][K]*C[lne[y]-lft[y]][K]);\n\t\t}else{\n\t\t\toptset(1,1,w,y,0);\n\t\t}\n\t}\n\tif(ans<0) ans += 2147483648ll;\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n\n```",
        "postTime": 1604155468,
        "uid": 218405,
        "name": "_CHO",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2154 \u3010[SDOI2009]\u8654\u8bda\u7684\u5893\u4e3b\u4eba\u3011"
    },
    {
        "content": "# [SDOI2009]\u8654\u8bda\u7684\u5893\u4e3b\u4eba\u9898\u89e3  \n### \u66b4\u529b\u505a\u6cd5\uff1a\n\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u8bb0\u4e0a\u4e0b\u5de6\u53f3\u5404\u6709\u591a\u5c11\u68f5\u6811\uff0c$a$\uff0c$b$\uff0c$c$\uff0c$d$\uff0c\u7b54\u6848\u5c31\u52a0\u4e0a $C_{a}^{k} \\times C_{b}^{k} \\times C_{c}^{k} \\times C_{d}^{k}$ \n### \u89e3\u9898\u601d\u8def\uff1a\n\u4f46\u662f\u8fd9\u6837\u80af\u5b9a\u4e0d\u884c\uff0c\u770b\u5230\u8fd9\u9898\u5148\u60f3\u80fd\u4e0d\u80fd\u4e00\u884c\u4e00\u884c\u5904\u7406\uff0c\u5c06\u6811\u5750\u6807\u79bb\u6563\u5316\uff0c\u6211\u4eec\u53d1\u73b0\u6bcf\u4e00\u884c\u4e24\u68f5\u6811\u4e4b\u95f4\u7684 $C_{a}^{k}\\times C_{b}^{k}$ \u662f\u4e00\u6837\u7684\uff0c  \n\u90a3\u4e48\u7b54\u6848\u5c31\u53ef\u4ee5\u52a0\u4e0a $\\sum_{i=y1+1}^{y2}C_{c}^{k}\\times C_{d}^{k}$ \u8fd9\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u6765\u7ef4\u62a4  \n\u4ee4\u5f53\u524d\u8003\u8651\u5230\u6811 $\\left ( x,y \\right ) $\uff0c\u8bb0 $cntx[i][0]$ \u4e3a\u7b2c$i$\u884c\u7684\u524d\u7f00\u548c\uff0c$cntx[i][1]$ \u4e3a\u540e\u7f00\u548c\uff0c$cnty[i][0]$ \u4e3a\u7b2c$i$\u5217\u7684\u524d\u7f00\u548c\uff0c$cnty[i][1]$ \u4e3a\u540e\u7f00\u548c   \n\u6bcf\u9047\u5230\u4e00\u68f5\u6811\u65f6\uff0c\u66f4\u65b0 $cntx$ \u548c $cnty$ ,\u518d\u8ba1\u7b97\u51fa\u5f53\u524d\u5217\u4e0a\u4e0b\u7684\u4e58\u79ef\u66f4\u65b0\u5230\u6811\u72b6\u6570\u7ec4\u91cc\uff0c\u518d\u67e5\u8be2\u4e24\u68f5\u6811\u4e4b\u95f4\u7684\u548c\u4e58\u4e0a $C_{a}^{k}\\times C_{b}^{k}$ ,\u7d2f\u52a0\u7b54\u6848\uff0c\u8fd9\u9898\u5c31\u7ed3\u675f\u4e86    \n\u8fd9\u79cd\u9898\u76ee\u62ff\u5230\u5148\u6392\u5e8f\uff0c\u770b\u770b\u80fd\u4e0d\u80fd\u4e00\u884c\u4e00\u884c\u5904\u7406\uff0c\u627e\u5230\u4e0d\u53d8\u7684\u91cf\u5c31\u597d\u529e\u4e86  \n### \u4ee3\u7801\uff1a \n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define lowbit(x) x&-x\nusing namespace std;\nconst int N=1e5+5;\nconst int mod=2147483648;\nstruct P{\n\tint x,y;\n\tbool operator<(const P&o)const{\n\t\tif(x==o.x)return y<o.y;\n\t\treturn x<o.x;\n\t}\n}a[N];\nint n,m,w,k,b[N],d[N],ans,C[N][15],tmp[N],cnt1,cnt2,cntx[N][2],cnty[N][2];//cntx 0\u5de6\u524d\u7f00 cnty 0\u4e0a\u524d\u7f00 \nstruct BIT{\n\tint c[N];\n\tvoid add(int x,int y){\n\t\tfor(int i=x;i<=cnt2;i+=lowbit(i))(c[i]+=y)%=mod;\n\t}\n\tint query(int x){\n\t\tint res=0;\n\t\tfor(int i=x;i;i-=lowbit(i))(res+=c[i])%=mod;\n\t\treturn res;\n\t}\n\tint query(int l,int r){\n\t\treturn ((query(r)-query(l-1))%mod+mod)%mod;\n\t}\n}bit;\nsigned main() {\n\tcin>>n>>m>>w;\n\t++n,++m;\n\tfor(int i=1; i<=w; i++) {\n\t\tcin>>a[i].x>>a[i].y;\n\t\t++a[i].x,++a[i].y;\n\t\tb[i]=a[i].x,d[i]=a[i].y;\n\t}\n\tcin>>k;\n\tC[0][0]=1;\n\tfor(int i=1;i<=w;i++){\n\t\tC[i][0]=1;\n\t\tfor(int j=1;j<=k;j++){\n\t\t\tC[i][j]=(C[i-1][j]+C[i-1][j-1])%mod;\n\t\t}\n\t}\n\tsort(b+1,b+w+1);\n\tsort(d+1,d+w+1);\n\tcnt1=unique(b+1,b+w+1)-b-1;\n\tcnt2=unique(d+1,d+w+1)-d-1;\n\tfor(int i=1;i<=w;i++){\n\t\ta[i].x=lower_bound(b+1,b+cnt1+1,a[i].x)-b;\n\t\ta[i].y=lower_bound(d+1,d+cnt2+1,a[i].y)-d;\n\t\t++cntx[a[i].x][1],++cnty[a[i].y][1];\n\t}\n\tsort(a+1,a+w+1);\n\tfor(int i=1,nxt;i<=w;i++){\n\t\tint x=a[i].x,y=a[i].y;\n\t\t++cntx[x][0],--cntx[x][1];\n\t\tbit.add(y,-tmp[y]);\n\t\t++cnty[y][0],--cnty[y][1];\n\t\ttmp[y]=C[cnty[y][0]][k]*C[cnty[y][1]][k]%mod;\n\t\tbit.add(y,tmp[y]);\n\t\tif(a[i+1].x==x)nxt=i+1;\n\t\telse continue;\n\t\tans+=bit.query(a[i].y+1,a[nxt].y-1)*C[cntx[x][0]][k]%mod*C[cntx[x][1]][k]%mod;\n\t\tans%=mod;\n\t}\n\tcout<<ans<<endl;\n\treturn 0;\n}\n```\n ",
        "postTime": 1683721010,
        "uid": 780575,
        "name": "zzh20071105",
        "ccfLevel": 0,
        "title": "[SDOI2009]\u8654\u8bda\u7684\u5893\u4e3b\u4eba"
    },
    {
        "content": "\u9996\u5148\uff0c\u89c2\u5bdf\u6570\u636e\u8303\u56f4\u3010\u9707\u60ca\u3011\n\nn\\*m\u7684\u77e9\u9635\u53ef\u8fbe10^18\u4e2a\u70b9\uff01\uff01\uff01\n\n\u800c\u5e38\u9752\u6811\u6700\u591a\u53ea\u670910^5\u4e2a\u70b9\uff01\uff01\uff01\n\n\u5047\u5982\u6211\u4eec\u679a\u4e3e\u5893\u5730\u6240\u5728\u7684\u4f4d\u7f6e\uff0c\u663e\u7136\u679a\u4e3e\u91cf\u4f1a\u975e\u5e38\u5927\n\n\u76f8\u5bf9\u800c\u8a00\uff0c\u6211\u4eec\u53bb\u679a\u4e3e\u6bcf\u4e00\u68f5\u5e38\u9752\u6811\u4f1a\u66f4\u5bb9\u6613\n\n\u5bf9\u4e8e\u9898\u4e2d\u7684\u8654\u8bda\u5ea6\uff0c\u662f\u4e00\u79cd\u65b9\u6848\u6570\uff0c\u6211\u4eec\u5c06\u5176\u7528\u65b9\u6848\u6570\u66ff\u4ee3\n\n\u5f53\u7136\uff0c\u5bf9\u4e8e\u5982\u6b64\u4e4b\u5927\u5982\u6b64\u4e4b\u96f6\u6563\u7684\u5750\u6807\uff0c\u679c\u65ad\u91c7\u53d6\u79bb\u6563\u5316\n\n\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u60f3\uff0c\u5bf9\u4e8e\u4f4d\u4e8e\u540c\u4e00\u884c\u7684\u4e24\u68f5\u5e38\u9752\u6811\u4e4b\u95f4\u7684\u7a7a\u5730\uff0c\u6211\u4eec\u5728\u4efb\u610f\u4e00\u4e2a\u4f4d\u7f6e\u5b89\u7f6e\u5893\u5730\uff0c\u5bf9\u4e8e\u8fd9\u4e00\u884c\u7684\u72b6\u6001\u6240\u4ea7\u751f\u7684\u65b9\u6848\u6570\u5e76\u6ca1\u6709\u5f71\u54cd\uff0c\u53cd\u800c\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u5f97\u5230\u6b64\u65f6\u7684\u7ed3\u679c\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u56fa\u5b9a\u4e00\u7ef4\u3001\u79fb\u52a8\u53e6\u4e00\u7ef4\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u53ef\u4ee5\u66f4\u5feb\u7684\u7edf\u8ba1\u548c\u7ef4\u62a4\u72b6\u6001\n\n\u53e6\u5916\uff0c\u6839\u636e\u9898\u610f\uff0c\u8fd9\u662f\u4e00\u4e2a\u5750\u6807\u7cfb\u56fe\uff0c\u6240\u4ee5\u6211\u4eec\u7684x\u3001y\u662f\u4e25\u683c\u6309\u7167\u5750\u6807\u7cfb\u56fe\u5b9a\u4e49\u7684\n\n```cpp\nscanf(\"%d%d%d\",&n,&m,&w);\nfor(int i=1;i<=w;++i){\n    scanf(\"%d%d\",&tree[i].x,&tree[i].y);\n    p[2*i-1]=tree[i].x;\n    p[2*i]=tree[i].y;\n}\nsort(p+1,p+1+2*w);//\u79bb\u6563\u5316\n```\n\u5f53\u7136\uff0c\u5bf9\u4e8e\u9009\u62e9\uff0c\u65e0\u7591\u662f\u7ec4\u5408\u6570\uff0c\u5bf9\u4e8e\u6b64\u65f6\u7684\u6570\u636e\u8303\u56f4\uff0c\u5b8c\u5168\u53ef\u4ee5\u9012\u63a8\u5f97\u51fa\n\n```cpp\nvoid getC(){//\u8ba1\u7b97\u7ec4\u5408\u6570C      c[i][j] C(i,j)\n    c[0][0]=1;\n    for(int i=1;i<=w;++i){\n        c[i][0]=1;\n        for(int j=1;j<=min(k,i);++j)//\u4e00\u5b9a\u8981\u53d6min,\u53ef\u4ee5\u7701\u53bb\u5f88\u591a\u4e0d\u5fc5\u8981\u7684\u8ba1\u7b97\uff0c\u4e0d\u7136\u4f1aT\uff0c\u6559\u8bad\u4e4b\u60e8\u75dbQAQ\n            c[i][j]=(c[i-1][j]+c[i-1][j-1])%mod;\n    }\n}\n```\n\u7edf\u8ba1\u51fa\u6bcf\u4e00\u884c\uff0c\u6bcf\u4e00\u5217\u5206\u522b\u51fa\u73b0\u4e86\u591a\u5c11\u68f5\u6811\n\n```cpp\nint find(int x){//\u4e8c\u5206\u67e5\u627e,\u5c31\u662f\u624b\u5199\u7684lower_bound\n    int l=1,r=2*w,mid;\n    while(l<=r){\n        mid=l+(r-l)/2;\n        if(p[mid]<x)l=mid+1;\n        else if(p[mid]>x)r=mid-1;\n        else return mid;\n    }\n}\nfor(int i=1;i<=w;++i)\n    a[find(tree[i].x)]++,b[find(tree[i].y)]++;\n```\n\u5c06\u5e38\u9752\u6811\u8fdb\u884c\u6392\u5e8f\uff0c\u6765\u7ef4\u62a4\u6211\u4eec\u7b97\u6cd5\u7684\u6b63\u786e\u6027\n\n\u6392\u5e8f\u786e\u4fdd\u4e86\u6211\u4eec\u91c7\u53d6\u8fd9\u79cd\u7b56\u7565\u7684\u6b63\u786e\u6027\n\n```cpp\nbool cmp(node i,node j){\n//\u4ee5\u7eb5\u5750\u6807\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\u4ece\u5c0f\u5230\u5927\uff0c\u4ee5\u6a2a\u5750\u6807\u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\u4ece\u5c0f\u5230\u5927\n    if(i.y==j.y)return i.x<j.x;\n    else return i.y<j.y;\n}\nsort(tree+1,tree+1+w,cmp);\n```\n\u679a\u4e3e\u6bcf\u4e00\u68f5\u6811\uff0c\u66f4\u786e\u5207\u7684\u8bf4\u662f\uff0c\u6211\u4eec\u53bb\u626b\u4e00\u904d\u6bcf\u4e00\u884c\u7684\u6811\uff0c\u5f97\u5230\u6b64\u65f6\u7684\u72b6\u6001\u6240\u5bf9\u5e94\u7684\u884c\u7684\u65b9\u6848\u6570\uff0c\u901a\u8fc7\u7ef4\u62a4\u6811\u72b6\u6570\u7ec4\u5f97\u5230\u5f53\u524d\u72b6\u6001\u5217\u6240\u5bf9\u5e94\u7684\u65b9\u6848\u6570\uff0c\u7531\u4e58\u6cd5\u539f\u7406\u53ef\u77e5\uff0c\u65b9\u6848\u6570\u76f8\u4e58\u4e3a\u6b64\u65f6\u7684\u65b9\u6848\u6570\uff0c\u7d2f\u8ba1\u7b54\u6848\n\n```cpp\nfor(int i=1;i<=w;++i){\n    if(i>1&&tree[i].y==tree[i-1].y){//\u8fd9\u4e24\u68f5\u5e38\u9752\u6811\u5728\u540c\u4e00\u884c\n        this_hang++;//\u8bb0\u5f55\u6bcf\u884c\u7684\u5e38\u9752\u6811\u6709\u591a\u5c11\u68f5 \n        R ll t1=query(find(tree[i].x)-1)-query(find(tree[i-1].x));//\u4e24\u68f5\u5e38\u9752\u6811\u4e4b\u95f4\u7684\u7a7a\u5730\uff0c\u7eb5\u5411\u7684\u5217\u6709\u591a\u5c11\u79cd\u65b9\u6848\u6570\n        R ll t2=c[this_hang][k]*c[b[find(tree[i].y)]-this_hang][k];//\u5728\u8fd9\u4e24\u68f5\u5e38\u9752\u6811\u4e4b\u95f4\u5b89\u7f6e\u5893\u5730\u7684\u8bdd\uff0c\u8fd9\u4e00\u884c\u7684\u65b9\u6848\u6570\n        ans=(ans+t1*t2%mod)%mod;\n    }\n    else this_hang=0;//\u626b\u5230\u4e86\u65b0\u4e00\u884c\u7684\u5e38\u9752\u6811\n    R int d=find(tree[i].x);\n    now[d]++;//now[d]\u8bb0\u5f55\u8be5\u5217\u5df2\u7ecf\u8bb0\u5f55\u4e86\u591a\u5c11\u68f5\u5e38\u9752\u6811 \n    R int change=(c[now[d]][k]*c[a[d]-now[d]][k]-c[now[d]-1][k]*c[a[d]-now[d]+1][k])%mod;//\u5f53\u524d\u72b6\u6001\u7684\u65b9\u6848\u6570-\u4e0a\u4e00\u72b6\u6001\u7684\u65b9\u6848\u6570\uff0c\u6765\u66f4\u65b0\u7ef4\u62a4\u5f53\u524d\u7684\u72b6\u6001\u6240\u5bf9\u5e94\u7684\u65b9\u6848\u6570\n    add(d,change);\n}\n```\n\u5f53\u7136\uff0c\u5728\u6700\u540e\u8f93\u51fa\u7b54\u6848\u7684\u65f6\u5019\uff0c\u51fa\u4e9b\u5c0f\u4e71\u5b50\u662f\u4e0d\u662f\u8ba9\u4eba\u5f02\u5e38\u706b\u5927\uff1f\uff1f\uff1f\n\n```printf(\"%lld\",ans>=0?ans:ans+mod);```\n\u5bf9\u4e8e\u7a0b\u5e8f\u4e2d\u7684query\u548cadd\u64cd\u4f5c\uff0c\u5c31\u662f\u57fa\u672c\u7684\u6811\u72b6\u6570\u7ec4\u7684\u64cd\u4f5c\uff0c\u8fd9\u91cc\u4e0d\u4e88\u8bb2\u8ff0\n\u5bf9\u4e8e\u8fd9\u79cd\u56fa\u5b9a\u4e00\u7ef4\uff0c\u79fb\u52a8\u53e6\u4e00\u7ef4\u7684\u65b9\u6cd5\uff0c\u5728\u6ca1\u6709\u7ecf\u8fc7\u5927\u91cf\u5237\u9898\u548c\u5efa\u6a21\u601d\u60f3\uff0c\u786e\u5b9e\u4e0d\u592a\u5bb9\u6613\u4f1a\u60f3\u5230\uff0c\u5f53\u7136\uff0c\u4f5c\u4e3a\u6570\u636e\u7ed3\u6784\u7684\u6811\u72b6\u6570\u7ec4\u7684\u7279\u6027\uff0c\u4e5f\u5f97\u5230\u4e86\u5f88\u597d\u7684\u5e94\u7528\n",
        "postTime": 1500551702,
        "uid": 36080,
        "name": "\u51cc\u5e7d",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2154 \u3010[SDOI2009]\u8654\u8bda\u7684\u5893\u4e3b\u4eba\u3011"
    },
    {
        "content": "[\u70b9\u51fb\u9605\u8bfb\u4f53\u9a8c\u4e0d\u4e00\u5b9a\u4f1a\u66f4\u597d](https://ctz45562.github.io/2019/03/15/%E9%A2%98%E8%A7%A3-%E6%B4%9B%E8%B0%B7-P2154-%E3%80%90-SDOI2009-%E8%99%94%E8%AF%9A%E7%9A%84%E5%A2%93%E4%B8%BB%E4%BA%BA%E3%80%91/)\n\n[\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P2154)\n\n\u6765\u4e00\u53d1\u4f18\u7f8e\u7684\u7ebf\u6bb5\u6811\u7248\u9898\u89e3$QwQ$\u3002\n\n\u5bf9\u4e8e\u4e00\u5757\u5893\u7891\uff0c\u5b83\u7684\u8d21\u732e\u662f\u4e0a\u65b9\u53d6$k$\u68f5\u6811\u3001\u4e0b\u65b9\u53d6$k$\u68f5\u6811\u3001\u5de6\u8fb9\u53d6$k$\u68f5\u6811\u3001\u53f3\u8fb9\u53d6$k$\u68f5\u6811\u65b9\u6848\u6570\u7684\u4e58\u79ef\u3002\n\n\u5373\uff1a\u5047\u8bbe\u4e00\u5757\u5893\u7891\u4e0a\u3001\u4e0b\u3001\u5de6\u3001\u53f3\u5206\u522b\u6709$u,d,l,r$\u68f5\u6811\uff08\u4e0b\u540c\uff09\uff0c\u5176\u8d21\u732e\u4e3a$C(u,k)*C(d,k)*C(l,k)*C(r,k)$\u3002\n\n\u9884\u5904\u7406\u51fa\u7ec4\u5408\u6570\uff0c\u79bb\u6563\u5316\u540e\u626b\u63cf\u7ebf\u626b$x$\u8f74\uff0c\u6ce8\u610f\u5230**y\u8f74\u4e0a\u7684\u4e24\u68f5\u6811\u4e4b\u95f4\u7684\u70b9\u5b83\u4eec\u7684u\u548cd\u662f\u76f8\u540c\u7684**\n\n\u5c31\u50cf\u8fd9\u6837\uff1a\n\n![](https://cdn.luogu.com.cn/upload/pic/54071.png )\n\n\u4e5f\u5c31\u662f\u8bf4\u5b83\u4eec\u7684$C(u,k)*C(d,k)$\u662f\u53ef\u4ee5$O(1)$\u7b97\u51fa\u6765\u7684\u3002\u90a3\u4e48\u5c31\u80fd\u7ef4\u62a4\u4e00\u4e0b$\\sum C(l_i,k)*C(r_i,k)$\u4e58\u8d77\u6765\u7b97\u8fdb\u7b54\u6848\u91cc\u3002\n\n\u9996\u5148\u7b97\u51fa$y$\u8f74\u6bcf\u5217\u6709\u591a\u5c11\u68f5\u6811\uff0c\u4ee5\u6b64\u4e3a\u521d\u59cb$r$\u503c\uff0c$l$\u4e3a$0$\uff0c\u4ece\u5de6\u5230\u53f3\u626b\u3002\u9047\u5230\u4e00\u68f5\u6811\u5c31\u628a\u8fd9\u4e00\u5217\u7684$r$\u51cf$1$\uff0c$l$\u52a0$1$\uff0c\u5e76\u66f4\u65b0\u8fd9\u4e2a\u70b9\u7684$C(l,k)*C(r,k)$\u3002\u5bf9\u540c\u4e00\u6392\u4e0a\u7684\u4e24\u68f5\u6811\u67e5\u8be2\u4e2d\u95f4\u7684$\\sum C(l_i,k)*C(r_i,k)$\u5373\u53ef\u3002\n\n\u6811\u72b6\u6570\u7ec4\u849f\u84bb\u4e0d\u4f1a\u66f4\u65b0$QAQ$\uff0c\u90fd\u653e\u5728\u4e86\u7ebf\u6bb5\u6811\u4e0a\u641e\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\n#include <cstring>\n#include <vector>\n\n#define maxn 100005\n#define inf 0x3f3f3f3f\n\nconst long long mod = 2147483648ll;\n\nusing namespace std;\n\ninline int read(){\n\tint x=0,y=0;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')y=1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn y?-x:x;\n}\ntemplate<typename T>\ninline T read(){\n\tT x=0;\n\tint y=0;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')y=1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn y?-x:x;\n}\nlong long C[11][maxn],c[maxn];\nint disx[maxn],disy[maxn],init[maxn],lenx,leny;\nvector<int>X[maxn];\nstruct Segment_Tree{\n\tlong long dat[maxn<<2];\n\tint ll[maxn<<2],rr[maxn<<2];\n#define ls(x) (x<<1)\n#define rs(x) (x<<1|1)\n\tinline void update(int node){\n\t\tdat[node]=(dat[ls(node)]+dat[rs(node)])%mod;\n\t}\n\tvoid build(int l,int r,int node){\n\t\tif(l==r){\n\t\t\trr[node]=init[l];\n\t\t\treturn;\n\t\t}\n\t\tint mid=l+r>>1;\n\t\tbuild(l,mid,ls(node));\n\t\tbuild(mid+1,r,rs(node));\n\t}\n\tvoid add(int poi,int l,int r,int node){\n\t\tif(l==r){\n\t\t\t--rr[node],++ll[node];\n\t\t\tdat[node]=c[rr[node]]*c[ll[node]]%mod;\n            //\u66f4\u65b0\u7ec4\u5408\u6570\n\t\t\treturn;\n\t\t}\n\t\tint mid=l+r>>1;\n\t\tif(poi<=mid)add(poi,l,mid,ls(node));\n\t\telse add(poi,mid+1,r,rs(node));\n\t\tupdate(node);\n\t}\n\tlong long ask(int L,int R,int l,int r,int node){\n\t\tif(L<=l&&R>=r)return dat[node];\n\t\tint mid=l+r>>1;\n\t\tlong long ans=0;\n\t\tif(L<=mid)ans=ask(L,R,l,mid,ls(node));\n\t\tif(R>mid)ans+=ask(L,R,mid+1,r,rs(node));\n\t\treturn ans%mod;\n\t}\n}st;\nstruct tree{\n\tint x,y;\n}t[maxn];\nint main(){\n\tC[0][0]=1;\n\tread(),read();\n\tint n=read();\n\tfor(register int i=1;i<=n;++i)\n\t\tdisx[++lenx]=t[i].x=read(),disy[++leny]=t[i].y=read();\n\tsort(disx+1,disx+lenx+1);\n\tsort(disy+1,disy+leny+1);\n\tlenx=unique(disx+1,disx+1+lenx)-disx-1;\n\tleny=unique(disy+1,disy+1+leny)-disy-1;\n    //\u79bb\u6563\u5316\n\tint k=read();\n\tfor(register int i=1;i<=n;++i){\n\t\t++init[t[i].y=lower_bound(disy+1,disy+1+leny,t[i].y)-disy];//\u521d\u59cb\u7684r\u503c\n\t\tX[lower_bound(disx+1,disx+1+lenx,t[i].x)-disx].push_back(t[i].y);\n\t\tC[0][i]=1;\n\t\tfor(register int j=1;j<=k;++j)\n\t\t\tC[j][i]=(C[j][i-1]+C[j-1][i-1])%mod;\n\t\tc[i]=C[k][i];\n        //\u9884\u5904\u7406\u7ec4\u5408\u6570\u3002\u56e0\u4e3a\u90fd\u662f\u5173\u4e8ek\u7684\u5c31\u538b\u8fdb\u4e86\u4e00\u4e2a\u6570\u7ec4\n\t}\n\tst.build(1,leny,1);\n\tlong long ans=0;\n\tfor(register int i=1;i<=lenx;++i){\n\t\tsort(X[i].begin(),X[i].end());//\u4e00\u5b9a\u8981\u6392\u5e8f\n\t\tif(!X[i].empty())st.add(X[i][0],1,leny,1);\n\t\tfor(register int j=1;j<X[i].size();++j){\n\t\t\tif(X[i][j-1]+1<X[i][j]&&j>=k&&X[i].size()-j>=k)(ans+=st.ask(X[i][j-1]+1,X[i][j]-1,1,leny,1)*c[j]%mod*c[X[i].size()-j]%mod)%=mod;\n\t\t\tst.add(X[i][j],1,leny,1);\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",ans);\n}\n\n```\n\n",
        "postTime": 1552629135,
        "uid": 111762,
        "name": "_ctz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2154 \u3010[SDOI2009]\u8654\u8bda\u7684\u5893\u4e3b\u4eba\u3011"
    },
    {
        "content": "\u5404\u4f4d\u80fd\u60f3\u8c61\u5404\u79cdWA\u5404\u79cd\u8c03\u6700\u540e\u53d1\u73b0\u7b54\u6848\u5fd8\u8bb0\u53d6\u6a21\u7684\u611f\u53d7\u4e48...\n\n\u9898\u610f\u53ef\u80fd\u6709\u70b9\u4e0d\u592a\u597d\u7406\u89e3\uff0c\u9700\u8981\u7ed3\u5408\u6837\u4f8b\u6765\u7406\u89e3\u3002\u7406\u89e3\u4e86\u9898\u610f\u4e4b\u540e\u6211\u4eec\u53d1\u73b0\uff0c\u7b54\u6848\u5c31\u662f\uff1a\n\nsigma(C(l(x,y),k)\\*C(r(x,y),k)\\*C(u(x,y),k)\\*C(d(x,y),k))\uff08(x,y)\u662f\u6574\u4e2a\u5730\u56fe\u4e0a\u4efb\u610f\u4e00\u70b9\uff0cl,r,u,d\u5206\u522b\u8868\u793a\u70b9(x,y)\u6b63\u5de6/\u53f3/\u4e0a/\u4e0b\u65b9\u7684\u70b9\u6570\uff0cC\u8868\u793a\u7ec4\u5408\u6570\uff09\u3002\n\n\n\u4f46\u662f\u8fd9\u6837O(nm)\u7684\u7b97\u6cd5\u662f\u901a\u8fc7\u4e0d\u4e86100%\u7684\u6570\u636e\u7684\u3002\u7136\u800c\u6211\u4eec\u53d1\u73b01 \u2264 W \u2264 100,000\uff0c\u6240\u4ee5\u6211\u4eec\u4ece\u5e38\u9752\u6811\u7684\u89d2\u5ea6\u5165\u624b\u6765\u601d\u8003\u3002\n\n\u5148\u5c06\u6240\u6709\u5e38\u9752\u6811\u4ee5y\u5750\u6807\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0cx\u5750\u6807\u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\uff0c\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u3002\u5bf9\u4e8e\u7b2ci\u68f5\u5e38\u9752\u6811\uff0c\u5982\u679c\u7b2ci-1\u68f5\u5e38\u9752\u6811\u7684y\u5750\u6807\u4e0e\u5b83\u76f8\u540c\uff0c\u90a3\u4e48\u4e24\u68f5\u5e38\u9752\u6811\u4e4b\u95f4\u7684\u7a7a\u5730\u7684\u8654\u8bda\u5ea6\u4e4b\u548c\u4e3a\uff1a\n\nC(l(i-1),k)\\*C(r(i),k)\\*sigma(C(u(x),k)\\*C(d(x),k))\uff08x\u4ecb\u4e8e\u7b2ci-1~\u7b2ci\u68f5\u5e38\u9752\u6811\u4e4b\u95f4\u3002\u5176\u4e2dl(i-1)\u8868\u793a\u4e0e\u7b2ci-1\u68f5\u5e38\u9752\u6811y\u5750\u6807\u76f8\u540c\uff0c\u4e14x\u5750\u6807\u5c0f\u4e8e\u7b49\u4e8e\u5b83\u7684\u5e38\u9752\u6811\u6570\u91cf\uff0cr(i)\u5219\u8868\u793a\u4e0e\u7b2ci\u68f5\u5e38\u9752\u6811y\u5750\u6807\u76f8\u540c\uff0c\u4e14x\u5750\u6807\u5927\u4e8e\u7b49\u4e8e\u5b83\u7684\u5e38\u9752\u6811\u6570\u91cf\uff1bu(x),d(x)\u8868\u793a\u70b9(x,y)\u6b63\u4e0a/\u4e0b\u65b9\u6709\u591a\u5c11\u5e38\u9752\u6811\uff0cC\u8868\u793a\u7ec4\u5408\u6570\uff09\u3002\n\n\nl(i-1)\u4e0er(i)\u5bb9\u6613\u5f97\u5230\uff0c\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u662f\u5982\u4f55\u5f97\u5230sigma(C(u(x),k)\\*C(d(x),k)). \u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u6b63\u597d\u662f\u4e00\u4e2a\u5355\u70b9\u4fee\u6539\uff0c\u533a\u95f4\u67e5\u8be2\u7684\u95ee\u9898\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u7528\u6811\u72b6\u6570\u7ec4\u6765\u7ef4\u62a4\u8fd9\u4e2a\u503c\u3002\u8bbe\u7b2ci\u68f5\u5e38\u9752\u6811x\u5750\u6807\u4e3axi\uff0c\u5904\u7406\u7b2ci\u68f5\u5e38\u9752\u6811\u540e\uff0c\u6211\u4eec\u5c06\u6811\u72b6\u6570\u7ec4xi\u4f4d\u7f6e\u7684\u503c\u4eceC(u(xi),k)\\*C(d(xi),k)\u6539\u4e3aC(u(xi)-1,k)\\*C(d(xi)+1,k)\uff08\u56e0\u4e3a\u6211\u4eec\u5bf9\u5e38\u9752\u6811\u4ece\u4e0b\u5230\u4e0a\u6392\u5e8f\u4e86\uff0c\u679a\u4e3e\u5b8c\u4e00\u68f5\u6811\u540e\uff0c\u8fd9\u68f5\u6811\u7684\u4f4d\u7f6e\u5c31\u4ece\u4e0a\u65b9\u53d8\u6210\u4e86\u4e0b\u65b9\uff09\u3002\u8fd9\u6837\uff0c\u5229\u7528\u6811\u72b6\u6570\u7ec4\u52a8\u6001\u6c42\u548c\uff0c\u6211\u4eec\u5c31\u89e3\u51b3\u4e86\u95ee\u9898\u3002\n\n\u53e6\u5916\uff0c\u7531\u4e8e\u5750\u6807\u7684\u503c\u90fd\u6bd4\u8f83\u5927\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5750\u6807\u8fdb\u884c\u79bb\u6563\u5316\u5904\u7406\u3002\n\n\u518d\u53e6\u5916\uff0c\u7531\u4e8e\u53d6\u6a21\u7684\u6570\u6b63\u597d\u662fint\u7684\u6700\u5927\u503c+1\uff0c\u6240\u4ee5\u81ea\u7136\u6ea2\u51fa\u5c31\u597d\uff0c\u4e0d\u9700\u8981\u7279\u522b\u53d6\u6a21\u3002\u901f\u5ea6\u53ef\u4ee5\u52a0\u5feb\u4e00\u4e9b\u3002\n\n```cpp\n\n#include <stdio.h>\n#include <stdlib.h>\n#define MOD 2147483648LL\nint n,m,p[100010][2];\nint u[100010],d[100010],l[100010],r[100010],xcnt = 0,ycnt = 0;\nint f[100010][15],sum[100010],ans = 0;\nint compx(const void *a, const void *b)\n{\n    return ((int*)a)[0] - ((int*)b)[0];\n}\nint compy(const void *a, const void *b)\n{\n    return ((int*)a)[1] - ((int*)b)[1];\n}\nint comp(const void *a, const void *b)\n{\n    int ay = ((int*)a)[1],by = ((int*)b)[1];\n    if(ay != by) return ay-by;\n    return ((int*)a)[0] - ((int*)b)[0];\n}\nint lowbit(int x)\n{\n    return x&(-x);\n}\nvoid add(int pos,int x)\n{\n    for(;pos<=xcnt;pos+=lowbit(pos)) sum[pos] += x;\n}\nint query(int pos)\n{\n    int tans = 0;\n    for(;pos;pos-=lowbit(pos)) tans += sum[pos];\n    return tans;\n}\nint main()\n{\n    int i,j,last;\n    scanf(\"%*d%*d%d\",&n);\n    for(i=1;i<=n;i++) scanf(\"%d%d\",&p[i][0],&p[i][1]);\n    scanf(\"%d\",&m);\n    f[1][0] = f[1][1] = 1;\n    for(i=2;i<=n;i++)\n    {\n        f[i][0] = 1;\n        for(j=1;j<=m;j++) f[i][j] = f[i-1][j-1]+f[i-1][j];\n    }\n    qsort(p+1,n,sizeof(p[0]),compx);\n    for(i=1,last=-1;i<=n;i++)\n    {\n        if(p[i][0] != last) { last = p[i][0]; xcnt++;}\n        p[i][0] = xcnt; u[xcnt]++;\n    }\n    qsort(p+1,n,sizeof(p[0]),compy);\n    for(i=1,last=-1;i<=n;i++)\n    {\n        if(p[i][1] != last) { last = p[i][1]; ycnt++;}\n        p[i][1] = ycnt; r[ycnt]++;\n    }\n    qsort(p+1,n,sizeof(p[0]),comp);\n    for(i=1;i<=n;l[p[i][1]]++,r[p[i][1]]--,add(p[i][0],f[u[p[i][0]]-1][m]*f[d[p[i][0]]+1][m]-f[u[p[i][0]]][m]*f[d[p[i][0]]][m]),u[p[i][0]]--,d[p[i][0]]++,i++)\n    {\n        if(p[i-1][1] != p[i][1]) continue;\n        ans += f[l[p[i][1]]][m]*f[r[p[i][1]]][m]*(query(p[i][0]-1)-query(p[i-1][0]));\n    }\n    printf(\"%lld\",(ans+MOD)%MOD);\n    return 0;\n}\n\n```",
        "postTime": 1439018266,
        "uid": 4341,
        "name": "TsReaper",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2154 \u3010[SDOI2009]\u8654\u8bda\u7684\u5893\u4e3b\u4eba\u3011"
    },
    {
        "content": "### [P2154 [SDOI2009] \u8654\u8bda\u7684\u5893\u4e3b\u4eba](https://www.luogu.com.cn/problem/P2154)\n\n\u663e\u7136\u6211\u4eec\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e0d\u80fd\u8ddf $n,m$ \u76f8\u5173\uff0c\u53ea\u80fd\u8ddf $w$ \u76f8\u5173\uff0c\u90a3\u4e48\u79bb\u6563\u5316\u662f\u5f88\u5bb9\u6613\u60f3\u5230\u7684\u3002\n\n\u518d\u8003\u8651\u66b4\u529b\u600e\u4e48\u505a\u3002\u663e\u7136\u662f\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\u7136\u540e\u8ba1\u7b97\u5b83\u7684\u8d21\u732e\u3002\u53c8\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u4e00\u4e2a\u70b9\u4e0a\u9762\uff0c\u4e0b\u9762\uff0c\u5de6\u8fb9\uff0c\u53f3\u8fb9\u7684\u5e38\u9752\u6811\u7684\u4e2a\u6570\u90fd\u5927\u4e8e\u7b49\u4e8e $k$ \u65f6\uff0c\u8fd9\u4e2a\u70b9\u5bf9\u7b54\u6848\u624d\u6709\u8d21\u732e\u3002\u56e0\u4e3a\u8981\u679a\u4e3e\uff0c\u6240\u4ee5\u80af\u5b9a\u8981\u6709\u89c4\u5f8b\u5730\u679a\u4e3e\uff0c\u4e0d\u7136\u5bb9\u6613\u91cd\u590d\u6216\u8005\u9057\u6f0f\u3002\u5f88\u5bb9\u6613\u60f3\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u6309\u5217\u679a\u4e3e\u3002\n\n\u5bf9\u4e8e\u4e00\u5217\u4e2d\u7684\u76f8\u90bb\u4e24\u68f5\u5e38\u9752\u6811\uff0c\u5b83\u4eec\u4e2d\u95f4\u7684\u70b9\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u662f $\\sum C^k_{up_i} \\times  C^k_{down_i} \\times C^k_{left_i} \\times C^k_{right_i}$\u3002\u53ef\u4ee5\u53d1\u73b0\uff0c\u5b83\u4eec\u4e2d\u95f4\u7684\u6bcf\u4e00\u4e2a\u70b9\u4e0a\u9762\u548c\u4e0b\u9762\u7684\u5e38\u9752\u6811\u4e2a\u6570\u90fd\u662f\u76f8\u540c\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u7edf\u8ba1 $\\sum C^k_{left_i} \\times C^k_{right_i}$\u3002\n\n\u6839\u636e\u4ee5\u4e0a\u5206\u6790\uff0c\u6211\u4eec\u8981\u5728 $\\log$ \u7ea7\u522b\u7684\u65f6\u95f4\u5185\u4fee\u6539\u5e76\u7edf\u8ba1 $\\sum C^k_{left_i} \\times C^k_{right_i}$\uff0c\u8fd9\u5e94\u8be5\u8981\u501f\u52a9\u67d0\u79cd\u6570\u636e\u7ed3\u6784\u3002\u5148\u8003\u8651\u4fee\u6539\u3002\u6211\u4eec\u53d1\u73b0\uff0c\u6bcf\u904d\u5386\u5230\u4e00\u68f5\u5e38\u9752\u6811\uff0c\u5f53\u524d\u5e38\u9752\u6811\u6240\u5728\u7684\u90a3\u4e00\u884c\u5c31\u8981\u8fdb\u884c\u4fee\u6539\u3002\u56e0\u4e3a\u8fd9\u4e00\u884c\u7684\u5e38\u9752\u6811\u53f3\u8fb9\u7684\u70b9\u5de6\u8fb9\u90fd\u6bd4\u8fd9\u4e00\u884c\u5e38\u9752\u6811\u5de6\u8fb9\u7684\u70b9\u5de6\u8fb9\u591a\u4e86\u4e00\u68f5\u5e38\u9752\u6811\uff0c\u53f3\u8fb9\u5c11\u4e86\u4e00\u68f5\u5e38\u9752\u6811\u3002\u518d\u8003\u8651\u67e5\u8be2\u3002\u6211\u4eec\u8981\u67e5\u8be2\u4e24\u68f5\u5e38\u9752\u6811\u4e4b\u95f4\u7684\u6240\u6709\u70b9\u7684\u8d21\u732e\uff0c\u76f8\u5f53\u4e8e\u662f\u533a\u95f4\u67e5\u8be2\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u8981\u7ef4\u62a4\u5355\u70b9\u4fee\u6539\u548c\u533a\u95f4\u67e5\u8be2\uff0c\u8003\u8651\u4f7f\u7528\u6811\u72b6\u6570\u7ec4\u3002\n\ncode \n```\n#include <bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define x first\n#define y second\nconst int N=100010,mod=2147483648;\ntypedef pair<int,int> pii;\nint n,m,w,k,col;\npii a[N];\nint tr[N],cntcol[N],cntrow[N],cntb[N],cntv[N];\nint c[N][12];\nvector<int> numx,numy;\ninline int get(int a,int b)\n{\n\treturn c[a][b]%mod;\n}\ninline int getx(int x)\n{\n\treturn lower_bound(numx.begin(),numx.end(),x)-numx.begin()+1;\n}\ninline int gety(int x)\n{\n\treturn lower_bound(numy.begin(),numy.end(),x)-numy.begin()+1;\n}\ninline int lowbit(int x)\n{\n\treturn x & -x;\n}\ninline void add(int x,int k)\n{\n\tfor (int i=x;i<=col;i+=lowbit(i)) tr[i]+=k;\n}\ninline int query(int x)\n{\n\tint res=0;\n\tfor (int i=x;i;i-=lowbit(i)) res+=tr[i];\n\treturn res;\n}\nsigned main()\n{\n\tscanf(\"%lld%lld\",&n,&m);\n\tscanf(\"%lld\",&w);\n\tfor (int i=1;i<=w;++i) \n\t{\n\t\tscanf(\"%lld%lld\",&a[i].x,&a[i].y);\n\t\tnumx.push_back(a[i].x);\n\t\tnumy.push_back(a[i].y);\n\t}\n\tscanf(\"%lld\",&k);\n\tsort(numx.begin(),numx.end());\n\tnumx.erase(unique(numx.begin(),numx.end()),numx.end());\n\tsort(numy.begin(),numy.end());\n\tnumy.erase(unique(numy.begin(),numy.end()),numy.end());\n\tfor (int i=1;i<=w;++i)\n\t{\n\t\ta[i].x=getx(a[i].x);\n\t\ta[i].y=gety(a[i].y);\n\t\tcntrow[a[i].y]++;\n\t\tcntcol[a[i].x]++;\n\t}\n\tsort(a+1,a+w+1);\n\tcol=(int)numy.size();\n\tfor (int i=0;i<=w;++i) c[i][0]=1;\n\tfor (int i=1;i<=w;++i)\n\t{\n\t\tfor (int j=1;j<=min(i,k);++j)\n\t\t{\n\t\t\tc[i][j]=c[i-1][j-1]+c[i-1][j];\n\t\t}\n\t}\n\tint tot=0,ans=0;\n\tfor (int i=1;i<=w;++i)\n\t{\n\t\tif (i==1||a[i].x!=a[i-1].x) tot=0;\n\t\tint row=a[i].y;\n\t\tint val=(++cntb[row])>=k&&cntrow[row]-cntb[row]>=k?get(cntb[row],k)*get(cntrow[row]-cntb[row],k)%mod:0;\n\t\ttot++;\n\t\tadd(row,val-cntv[row]);\n\t\tcntv[row]=val;\n\t\tif (i==w||a[i].x!=a[i+1].x||a[i+1].y-a[i].y<=1||tot<k||cntcol[a[i].x]-tot<k) continue;\n\t\tans=(ans+get(tot,k)*get(cntcol[a[i].x]-tot,k)%mod*(query(a[i+1].y-1)-query(a[i].y))%mod)%mod;\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1685275201,
        "uid": 767793,
        "name": "_ZSR_",
        "ccfLevel": 0,
        "title": "P2154 [SDOI2009] \u8654\u8bda\u7684\u5893\u4e3b\u4eba"
    },
    {
        "content": "\u597d\u4e45\u6ca1\u5199\u4e86\uff0c\u6c34\u4e00\u7bc7\u9898\u89e3\uff08\n\n\u5927\u6c34\u9898\u3002\n\n\u6309\u7167\u9898\u76ee\u610f\u601d\u5217\u51fa\u5f0f\u5b50\uff1a$\\sum C_{up}^kC_{down}^kC_{left}^kC_{right}^k$\uff0c\u56db\u4e2a\u82f1\u6587\u8868\u793a\u5bf9\u5e94\u65b9\u5411\u70b9\u6570\u3002\n\n\u6570\u636e\u8303\u56f4\u6ca1\u8fd9\u4e48\u5927\uff0c\u7a7a\u884c\u7a7a\u5217\u663e\u7136\u6ca1\u6709\u4efb\u4f55\u610f\u4e49\uff0c\u76f4\u63a5\u79bb\u6563\u5316\u6389\u5c31\u884c\u4e86\u3002\n\n\u679a\u4e3e\u7a7a\u70b9\u663e\u7136\u662f\u4e0d\u884c\u7684\uff0c\u8003\u8651\u6211\u4eec\u80fd\u679a\u4e3e\u54ea\u4e9b\u4e1c\u897f\uff0c\u53ea\u6709\u884c\u3001\u5217\uff0c\u548c\u5b58\u5728\u7684\u70b9\u3002\n\n\u7136\u540e\u53d1\u73b0\u4e00\u6bb5\u6a2a\u7740\u8fde\u7eed\u7684\u7a7a\u6bb5\u7684\u5de6\u53f3\u70b9\u6570\u76f8\u540c\uff0c\u53ea\u6709\u4e0a\u4e0b\u4e0d\u540c\u3002\u679a\u4e3e\u6bcf\u884c\uff0c\u679a\u4e3e\u6bcf\u6bb5\u7a7a\u9699\uff0c\u628a\u5de6\u53f3\u8d21\u732e\u4ece\u5f0f\u5b50\u91cc\u63d0\u51fa\u6765\uff0c\u4e0a\u4e0b\u7528\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u548c\uff0c\u4e58\u8d77\u6765\u5c31\u884c\u4e86\u3002\n\n\u7136\u540e\u8bb0\u5f97\u7ed9\u6bcf\u884c\u7684\u70b9\u6392\u5e8f\u3002\u3002\u3002\u3002\u6211\u56e0\u4e3a\u8fd9\u4e2a\u8c03\u4e86\u597d\u4e45\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 1e5 + 5;\nconst long long mod = 2147483648;\nint n, m, r, c, buc[N], cnt[N], all[N], C[N][11], pre[N];\nvector<int> vec[N];\nstruct node\n{\n    int x, y;\n} a[N];\nstruct BIT\n{\n    int t[N];\n    inline int lowbit(int x) { return x & -x; }\n    inline void add(int x, int k)\n    {\n        for (; x <= c; x += lowbit(x))\n            t[x] += k;\n    }\n    inline int query(int x)\n    {\n        int res = 0;\n        for (; x; x -= lowbit(x))\n            res += t[x];\n        return res;\n    }\n} tr;\nint main()\n{\n    ios::sync_with_stdio(false);\n    cin.tie(nullptr);\n    cin >> n >> n >> n;\n    for (int i = 1; i <= n; i++)\n        cin >> a[i].x >> a[i].y;\n    cin >> m;\n    for (int i = 1; i <= n; i++)\n        buc[++r] = a[i].x;\n    sort(buc + 1, buc + 1 + r);\n    r = unique(buc + 1, buc + 1 + r) - buc - 1;\n    for (int i = 1; i <= n; i++)\n        a[i].x = lower_bound(buc + 1, buc + 1 + r, a[i].x) - buc;\n    for (int i = 1; i <= n; i++)\n        buc[++c] = a[i].y;\n    sort(buc + 1, buc + 1 + c);\n    c = unique(buc + 1, buc + 1 + c) - buc - 1;\n    for (int i = 1; i <= n; i++)\n    {\n        a[i].y = lower_bound(buc + 1, buc + 1 + c, a[i].y) - buc;\n        all[a[i].y]++;\n        vec[a[i].x].emplace_back(a[i].y);\n    }\n    C[0][0] = 1;\n    for (int i = 1; i <= n; i++)\n    {\n        C[i][0] = 1;\n        for (int j = 1; j <= m; j++)\n            C[i][j] = C[i - 1][j - 1] + C[i - 1][j];\n    }\n    int ans = 0;\n    for (int i = 1; i <= r; i++)\n    {\n        sort(vec[i].begin(), vec[i].end());\n        for (int j = 0; j < vec[i].size(); j++)\n        {\n            int p = vec[i][j], lst = vec[i][j - 1];\n            if (j)\n                ans += C[j][m] * C[vec[i].size() - j][m] * (tr.query(p - 1) - tr.query(lst));\n            cnt[p]++;\n            tr.add(p, C[cnt[p]][m] * C[all[p] - cnt[p]][m] - pre[p]);\n            pre[p] = C[cnt[p]][m] * C[all[p] - cnt[p]][m];\n        }\n    }\n    cout << (1ll * ans + mod) % mod;\n    return 0;\n}\n```",
        "postTime": 1680109149,
        "uid": 576378,
        "name": "creation_hy",
        "ccfLevel": 5,
        "title": "P2154\u9898\u89e3"
    },
    {
        "content": "\u9898\u76ee\u5927\u610f\uff0c\u7ed9\u51fa\u4e00\u4e2aN*M\u7684\u65b9\u683c\uff0c\u5728\u6bcf\u4e2a\u70b9\u4e0a\u5206\u5e03\u7740\u5e38\u9752\u6811/\u5893\u5730\uff0c\u6211\u4eec\u9700\u8981\u7edf\u8ba1\u6bcf\n\n\u4e2a\u5893\u5730\u7684\u8654\u8bda\u5ea6\uff0c\u76f8\u52a0\u6c42\u5f97\u7b54\u6848\u3002\n\n\u9898\u4e2d\u63cf\u8ff0\u7684\u662f\u201c\u6070\u597d\u201d\u6709k\u9897\u6811\uff0c\u770b\u4e00\u773c\u6837\u4f8b\uff0c\u53d1\u73b0\u4e8b\u60c5\u6ca1\u90a3\u4e48\u7b80\u5355\uff0c\u518d\u7ed3\u5408\u7b54\u6848\u5f88\n\n\u5bb9\u6613\u5206\u6790\u51fa\u6211\u4eec\u5e94\u8be5\u6c42\u7684\u662f\u6bcf\u4e2a\u70b9\u4e0a\u4e0b\u5de6\u53f3\u5bf9\u5e94\u7684\u7ec4\u5408\u6570\u76f8\u4e58\u3002\n\n\u7531\u4e58\u6cd5\u539f\u7406\u53ef\u77e5\uff0c\u6211\u4eec\u8981\u6c42\u7684\u662f\u4ece\u4e0a\u4e0b\u5de6\u53f3\u7684\u5e38\u9752\u6811\u4e2d\u5206\u522b\u9009\u51fak\u9897\uff0c\u5bf9\u5e94\u7684\u65b9\u6848\u6570\n\u4e58\u4e58\u79ef\u3002\n\n\n\u89c2\u5bdf\u6570\u636e\u8303\u56f4\uff0ck <= 10,\u7531\u6768\u8f89\u4e09\u89d2\u884c\u5217\u6570\u5bf9\u5e94\u7ec4\u5408\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6768\u8f89\u4e09\u89d2\u9012\n\n\u63a8\u5f0f\uff0c\u9884\u5904\u7406\u51fa\u6240\u6709\u7684\u7ec4\u5408\u6570\u3002\n\n\u7136\u800c\u518d\u770b\u4e00\u773c\u6570\u636e\u8303\u56f4\uff0cN\uff0cM\u7684\u8303\u56f4\u8fc7\u5927\uff0c\u4e0d\u7528\u8bf4\u7ebf\u6027\u9012\u63a8\uff0c\u6570\u7ec4\u90fd\u5f00\u4e0d\u4e0b\u3002\u7136\u800c\n\n\u5e38\u9752\u6811W\u7684\u4e2a\u6570\u5374\u53ea\u6709100,000\u4e2a\uff0c\u8003\u8651\u79bb\u6563\u5316\u3002\n\n\u5728\u79bb\u6563\u5316\u7684\u8fc7\u7a0b\u4e2d\uff0c\u987a\u624b\u5904\u7406\u51fa\u6bcf\u884c\u6bcf\u5217\u7684\u5e38\u9752\u6811\u4e2a\u6570\u3002\uff08\u540e\u9762\u5728\u89e3\u91ca\uff09\u3002\n\n\n\u81f3\u6b64\uff0c\u9884\u5904\u7406\u7684\u6240\u6709\u5de5\u4f5c\u5df2\u7ecf\u5b8c\u6210\uff0c\u653e\u4e2a\u4ee3\u7801\u3002\uff08\u7801\u98ce\u4e11\uff0c\u8bf7\u89c1\u8c05\uff09\n\n\u79bb\u6563\u5316\uff1a\uff081\u500d\u5b58\u539f\u6570\uff0c2\u500d\u5b58x\uff0c3\u500d\u5b58y\uff09\n```cpp\ninline void discretizition()\n{\n    scanf(\"%d%d%d\",&n,&m,&w);\n    for(int i = 1;i<=w;i++)\n    {\n        int x,y;\n        scanf(\"%d%d\",&x,&y);\n        nd[i+w].temp = x;\n        nd[i+w].kind = 1;\n        nd[i+w].num = i;\n        nd[i+2*w].temp = y;\n        nd[i+2*w].kind = 2;\n        nd[i+2*w].num = i;\n    }            \n    int cnt = 1;\n    sort(nd+w+1,nd+3*w+1,cmp1);\n    for(int i = w+1;i<=3*w;i++)\n    {\n        if(i==w+1)\n        {\n            int num = nd[i].num;\n            if(nd[i].kind==1)\n            {\n                nd[num].x = cnt;\n                lie[cnt]++;    //\u5217\u6570\n            }else\n            {\n                nd[num].y = cnt;\n                hang[cnt]++;    //\u884c\u6570\n            }\n            continue;\n        }\n        if(nd[i].temp!=nd[i-1].temp)cnt++;\n        int num = nd[i].num;\n        if(nd[i].kind==1)\n        {\n            nd[num].x = cnt;\n            lie[cnt]++;  //\u5217\u6570\n        }else\n        {\n            nd[num].y = cnt;\n            hang[cnt]++;    //\u884c\u6570\n        }\n    }\n}\n```\n\u9012\u63a8\u6768\u8f89\u4e09\u89d2\uff0c\u9884\u5904\u7406\u7ec4\u5408\u6570\uff1a\n```cpp\ninline void getC()\n{\n    scanf(\"%d\",&k);\n    C[0][0] = 1;\n    for(int i = 1;i<=W;i++)\n    {\n        for(int j = 0;j<=10;j++)\n        {\n            if(j==0){C[i][j] = 1;continue;}\n            C[i][j] = (C[i-1][j-1]+C[i-1][j])&mod;\n        }\n    }\n}\n```\n\u660e\u786e\u4e00\u70b9\u5c0f\u6280\u5de7\uff0c\u53d6\u6a212147483648\u548c\u6309\u4f4d\u4e0e2147483647\u6548\u679c\u662f\u4e00\u6837\u7684\u3002\n\n(1<<31==2147483648)\n\n\u5982\u679c\u8fd8\u4e0d\u660e\u767d\uff0c\u8bf7\u5b9e\u8df5\u51e0\u7ec4\u6570\uff0c\u6216\u8005\u4ed4\u7ec6\u60f3\u60f3\u3002\u6bd5\u7adf\u8111\u888b\u662f\u7528\u6765\u60f3\u7684\uff0c\u4e0d\u662f\u7528\u6765\u88c5\u9970\u7684\u3002\n\n\u5f53\u6211\u4eec\u5b8c\u6210\u9884\u5904\u7406\u6b65\u9aa4\u65f6\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u6574\u4e2a\u65b9\u683c\u7f29\u5c0f\u5230\u4e86100,000\u00d7100,000\u7684\u5927\u5c0f\n\u4e86\uff0c\u63a5\u4e0b\u6765\u4fbf\u662f\u5982\u4f55\u8ba1\u7b97\u8654\u8bda\u5ea6\u3002\n\n\u66b4\u529b\u679a\u4e3e\u5893\u5730\uff1f\u5fc5\u7136\u8d85\u65f6\uff08\u4f46\u662f\u6d1b\u8c37\u6570\u636e\u8c8c\u4f3c\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u7384\u5b66\u4f18\u5316\u65b9\u6cd5\u8fc7\u6389\uff0c\u8fd9\n\n\u91cc\u6682\u4e0d\u63d0\u53ca\uff09\u3002\u6211\u4eec\u9700\u8981\u627e\u5230\u4e00\u79cd\u66f4\u4e3a\u5feb\u901f\u7684\u65b9\u6cd5\u3002\n\nWhen you have eliminated the impossibles,whatever remains,however \nimprobable,must be the truth.\u2014\u2014\u798f\u5c14\u6469\u65af\n\n\u6211\u4eec\u5e0c\u671b\u80fd\u51fa\u73b0O\uff08wlog\uff09\u7684\u65b9\u6cd5\uff0c\u6216\u8005O\uff08w\uff09\u7684\u65b9\u6cd5\u3002\u7531\u4e8e\u5e38\u9752\u6811\u4e00\u5171\u53ea\u6709\n\n100,000\u9897\uff0c\u65e2\u7136\u6211\u4eec\u4e0d\u80fd\u679a\u4e3e\u5893\u5730\uff0c\u4e0d\u59a8\u679a\u4e3e\u5e38\u9752\u6811\u3002\n\n\u800c\u679a\u4e3e\u5e38\u9752\u6811\u53c8\u4e0d\u80fd\u968f\u610f\u679a\u4e3e\uff0c\u4e0d\u7136\u5728\u7d2f\u79ef\u8654\u8bda\u5ea6\u7684\u65f6\u5019\u53c8\u4f1a\u53d8\u6210w\u65b9\u7684\u60c5\u51b5\uff0c\u6211\n\n\u4eec\u9700\u8981\u4e00\u4e9b\u6570\u636e\u7ed3\u6784\u6765\u7ef4\u62a4\u8654\u8bda\u5ea6\uff0c\u5982\u4f55\u7ef4\u62a4\uff1f\u7ef4\u62a4\u4ec0\u4e48\uff1f\u8fd9\u5c31\u662f\u672c\u9898\u7684\u5173\u952e\u3002\n\n\u7ecf\u8fc7\u6211\u4eec\u7684\u4e00\u756a\u5206\u6790\uff08\u6807\u7b7e\uff09\u6211\u4eec\u77e5\u9053\u672c\u9898\u4f7f\u7528\u7684\u6570\u636e\u7ed3\u6784\u662f\u6811\u72b6\u6570\u7ec4\u3002\n\n\u4e0d\u8981\u95ee\u6211\u600e\u4e48\u5206\u6790\u51fa\u6765\u7684\u6811\u72b6\u6570\u7ec4\uff0c\u6211\u5c31\u662f\u770b\u5230\u5b83\u662f\u6811\u72b6\u6570\u7ec4\u624d\u51b3\u5b9a\u7684\u505a\u8fd9\u9053\u9898\u3002\n\n\u6211\u4eec\u5728\u679a\u4e3e\u7684\u8fc7\u7a0b\u4e2d\uff0c\u60f3\u8981\u6c42\u7684\u662f\u6bcf\u4e2a\u7a7a\u5730\u4e0a\u4e0b\u5de6\u53f3\u7ec4\u5408\u6570\u7684\u4e58\u79ef\uff0c\u53ef\u4ee5\u53d1\u73b0\u5728\u540c\n\n\u4e00\u884c\uff08\u5217\uff09\uff08\u4ee5\u4e0b\u7edf\u4e00\u4e3a\u884c\uff09\u4e24\u9897\u5e38\u9752\u6811\u4e4b\u95f4\u7684\u7a7a\u5730\uff0c\u5b83\u4eec\u5de6\u9762\u548c\u53f3\u9762\u5e38\u9752\u6811\u7684\u7ec4\n\n\u5408\u6570\u662f\u76f8\u540c\u7684\u3002\n\n\u8fd9\u4e5f\u5c31\u7ed9\u4e86\u6211\u4eec\u7075\u611f\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6709\u987a\u5e8f\u7684\u679a\u4e3e\uff0c\u786e\u5b9a\u4e00\u7ef4\uff0c\u8f6c\u79fb\u4e00\u7ef4\u3002\u8fd9\u65f6\u5019\n\n\u9700\u8981\u628a\u6240\u6709\u70b9\u6309\u7167\u884c\u4f18\u5148\uff0c\u5217\u5176\u6b21\u7684\u987a\u5e8f\u6392\u5e8f\u3002\u8fd9\u6837\u679a\u4e3e\u7684\u65f6\u5019\u5c31\u662f\u6709\u5e8f\u7684\u4e86\u3002\n\n\u518d\u7785\u4e00\u773c\u56fe\uff0c\u627e\u627e\u611f\u89c9\u3002\n\n\u6211\u4eec\u5728\u679a\u4e3e\u7684\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7\u524d\u540e\u70b9\u662f\u5426\u5728\u540c\u4e00\u884c\uff0c\u5b9a\u4e49\u53d8\u91cf\u6765\u8bb0\u5f55\u8fd9\u4e00\u884c\u5df2\u7ecf\u679a\u4e3e\n\n\u4e86\u591a\u5c11\u9897\u5e38\u9752\u6811\uff0c\u518d\u901a\u8fc7\u8fd9\u4e00\u884c\u5e38\u9752\u6811\u7684\u603b\u6570\uff0c\n\n\u51cf\u53bb\u5de6\u65b9\u7684\u5e38\u9752\u6811\uff0c\u5373\u53ef\u5f97\u5230\u53f3\u65b9\u7684\u5e38\u9752\u6811\uff0c\u5de6\u53f3\u7684\u7ec4\u5408\u6570\u4e58\u79ef\u5373\u53ef\u8f7b\u677e\u5f97\u5230\u3002\u8fd9\n\n\u4e5f\u5c31\u662f\u4e4b\u524d\u8981\u7ef4\u62a4\u6bcf\u4e00\u884c\u5e38\u9752\u6811\u4e2a\u6570\u7684\u539f\u56e0\u3002\n\n\u90a3\u4e48\u5982\u4f55\u5feb\u901f\u8ba1\u7b97\u540c\u4e00\u884c\u4e24\u9897\u5e38\u9752\u6811\u4e4b\u95f4\u5893\u5730\u7684\u8654\u8bda\u5ea6\u4e4b\u548c\uff1f\n![](https://img2018.cnblogs.com/blog/1532556/201902/1532556-20190209201639401-730083613.png)\n\n\u597d\uff0c\u73b0\u5728\u5728\u4e0b\u6570\u8d77\u7b2c\u4e09\u884c\uff0c\u51fa\u73b0\u4e86\u4e24\u4e2a\u84dd\u8272\u70b9\uff0c\u5b83\u4eec\u5de6\u53f3\u7684\u5e38\u9752\u6811\u6570\u91cf\u76f8\u540c\u3002\n\n\u4e0d\u59a8\u8bbeL\u4e3a\u4e24\u4e2a\u84dd\u8272\u70b9\u5de6\u8fb9\u7ec4\u5408\u6570\uff0cR\u4e3a\u4e24\u4e2a\u84dd\u8272\u70b9\u53f3\u8fb9\u7ec4\u5408\u6570\uff0cU1\u4e3a1\u53f7\u84dd\u8272\u70b9\u4e0a\n\n\u65b9\u7ec4\u5408\u6570\uff0cD1\u4e3a\u5176\u4e0b\u65b9\u7ec4\u5408\u6570\uff0cU2\u540c\u7406\u4e3a2\u53f7\u84dd\u8272\u70b9\u4e0a\u65b9\u7ec4\u5408\u6570\uff0cD2\u4e3a\u84dd\u8272\u70b9\u4e0b\u65b9\n\n\u7ec4\u5408\u6570\u3002\n\n\u6211\u4eec\u8981\u6c42\u7684\u8fd9\u4e24\u4e2a\u70b9\u7684\u8654\u8bda\u5ea6\u4e3a\uff1a\n\nAns = L\u00d7R\u00d7U1\u00d7D1 + L\u00d7R\u00d7U2\u00d7D2\n       \n       = L\u00d7R\u00d7\uff08U1\u00d7D1 + U2\u00d7D2\uff09\n\n\u770b\u5230\u8fd9\u91cc\uff0c\u60a8\u5e94\u8be5\u5df2\u7ecf\u731c\u5230\u5982\u4f55\u5feb\u901f\u8ba1\u7b97\u5893\u5730\u8654\u8bda\u5ea6\u7684\u548c\u4e86\u3002\n\n\u6811\u72b6\u6570\u7ec4\u91cc\u9762\u5b58\u7684\u4e0d\u662f\u5e38\u9752\u6811\u4e2a\u6570\uff0c\u6211\u4eec\u5c06\u6bcf\u4e00\u5217\u7684\u5217\u6570\u4f5c\u4e3a\u6811\u72b6\u6570\u7ec4\u7684\u4e0b\u6807\uff0c\u5c06\n\n\u8fd9\u4e00\u5217\u5728\u672c\u65f6\u523b\u6240\u5bf9\u5e94\u7684\u4e0a\u4e0b\u7ec4\u5408\u6570\u7684\u4e58\u79ef\u5b58\u5165\u6811\u72b6\u6570\u7ec4\u4e2d\uff0c\u518d\u901a\u8fc7\u524d\u7f00\u548c\u76f8\u51cf\uff0c\n\n\u7b97\u51fa\u4e24\u9897\u5e38\u9752\u6811\u4e4b\u95f4\u7684\u5893\u5730\u7684\u4e0a\u4e0b\u7ec4\u5408\u6570\u4e58\u79ef\u4e4b\u548c\u3002\n\n\u5bf9\u5e94\u4e0a\u65b9\u4f8b\u5b50\uff0c\u5373\u6811\u72b6\u6570\u7ec4\u56db\u53f7\u70b9\u5b58\u50a8\u7684\u662fU1\u00d7D1\uff0c\u4e94\u53f7\u70b9\u5b58\u50a8\u7684\u662fU2\u00d7D2\uff0c\u6240\u6c42\n\n\u8654\u8bda\u5ea6\uff1a\n\nAns = L\u00d7R\u00d7\uff08getsum\uff085\uff09-getsum\uff084-1\uff09\uff09\uff1b\n\n\u5728\u7b97\u5b8c\u4e24\u68f5\u6811\u4e4b\u95f4\u7684\u5893\u5730\u540e\uff0c\u9700\u8981\u66f4\u65b0\u5bf9\u5e94\u5217\u7684\u6811\u72b6\u6570\u7ec4\u4e2d\u7684\u503c\uff0c\u66f4\u65b0\u7684\u503c\u5373\u4e3a\u91cd\n\n\u65b0\u7b97\u51fa\u7684\u7ec4\u5408\u6570\u4e0e\u4e4b\u524d\u7684\u7ec4\u5408\u6570\u4e4b\u5dee\uff0c\u5bf9\u5e94\u4f8b\u5b50\u4e2d\uff0c4\u53f7\u70b9\u5e94\u8be5\u66f4\u65b0\u7684\u503c\u5373\u4e3a\uff1a\n\nUpdate\uff084\uff0c\uff08U1-1\uff09\u00d7\uff08D1+1\uff09-U1\u00d7D1\uff09\uff1b\n\n5\u53f7\u70b9\u540c\u7406\u3002\n\n\u8fd9\u91cc\u7684D1/U1\u53ef\u4ee5\u901a\u8fc7\u679a\u4e3e\u987a\u5e8f\u8bb0\u5f55\uff0c\u4f5c\u8005\u901a\u8fc7\u81ea\u4e0b\u800c\u4e0a\u679a\u4e3e\uff0c\u6240\u4ee5\u901a\u8fc7\u6570\u7ec4\u8bb0\u5f55\n\n\u4e86D1\uff0c\u4e4b\u524d\u53c8\u8bb0\u5f55\u4e86\u6bcf\u4e00\u5217\u7684\u5e38\u9752\u6811\u4e2a\u6570\uff0c\u76f8\u51cf\u5373\u53ef\u5f97\u5230U1\u3002\n\n\u9010\u6e10\u679a\u4e3e\uff0c\u66f4\u65b0\u7b54\u6848\u5373\u53ef\u3002\n\n\u6362\u884c\u6216\u4e24\u9897\u5e38\u9752\u6811\u76f8\u90bb\u7684\u60c5\u51b5\u8bfb\u8005\u81ea\u884c\u601d\u8003\u5373\u53ef\uff0c\u9664\u6b64\u4ee5\u5916\u6700\u597d\u5c06\u884c\u5217\u6570\u5750\u6807+1\uff0c\n\n\u56e0\u539f\u9898\u4e2d\u539f\u70b9\u4e3a\uff080,0\uff09\uff0c\u6811\u72b6\u6570\u7ec4\u66f4\u65b0\u4e0d\u4fbf\u3002\n\nTalk is cheap\uff0cshow me the code\u3002\n```cpp\n#include<cstdio>\n#include<algorithm>\n#define W 100005\n#define mod 2147483647\n#define ll long long\nusing namespace std;\nint n,m,w,lie[2*W+1],hang[2*W+1],k,tree[2*W],down[2*W];\nll C[2*W+1][12];\nll ans;\nstruct node\n{\n    int x,y,num,kind,temp;\n}nd[W*3+2];\ninline bool cmp1(node a,node b)\n{\n    return a.temp<b.temp;\n}\ninline bool cmp(node a,node b)\n{\n    if(a.y!=b.y)\n    {\n        return a.y<b.y;\n    }else\n    {\n        return a.x<b.x;\n    }\n}\ninline void discretizition()\n{\n    scanf(\"%d%d%d\",&n,&m,&w);\n    for(int i = 1;i<=w;i++)\n    {\n        int x,y;\n        scanf(\"%d%d\",&x,&y);\n        nd[i+w].temp = x;\n        nd[i+w].kind = 1;\n        nd[i+w].num = i;\n        nd[i+2*w].temp = y;\n        nd[i+2*w].kind = 2;\n        nd[i+2*w].num = i;\n    }            \n    int cnt = 1;\n    sort(nd+w+1,nd+3*w+1,cmp1);\n    for(int i = w+1;i<=3*w;i++)\n    {\n        if(i==w+1)\n        {\n            int num = nd[i].num;\n            if(nd[i].kind==1)\n            {\n                nd[num].x = cnt;\n                lie[cnt]++;    \n            }else\n            {\n                nd[num].y = cnt;\n                hang[cnt]++;    \n            }\n            continue;\n        }\n        if(nd[i].temp!=nd[i-1].temp)cnt++;\n        int num = nd[i].num;\n        if(nd[i].kind==1)\n        {\n            nd[num].x = cnt;\n            lie[cnt]++;\n        }else\n        {\n            nd[num].y = cnt;\n            hang[cnt]++;    \n        }\n    }\n}\ninline void getC()\n{\n    scanf(\"%d\",&k);\n    C[0][0] = 1;\n    for(int i = 1;i<=W;i++)\n    {\n        for(int j = 0;j<=10;j++)\n        {\n            if(j==0)\n            {\n                C[i][j] = 1;\n                continue;\n            }\n            C[i][j] = (C[i-1][j-1]+C[i-1][j])&mod;\n        }\n    }\n}\ninline int lowbit(int x)\n{\n    return x&(-x);\n}\ninline void update(int pos,int x)\n{\n    for(int i = pos;i<=w;i+=lowbit(i))\n    {\n        tree[i]+=x;\n    }\n}\ninline ll getsum(int pos)\n{\n    ll tmp = 0;\n    for(int i = pos;i;i-=lowbit(i))\n    {\n        tmp=(tmp+tree[i])&mod;\n    }\n    return tmp&mod;\n}\ninline void solve()\n{\n    sort(nd+1,nd+1+w,cmp);\n    int tot = 0;\n    for(int i = 1;i<=w;i++)\n    {\n        if(i==1)\n        {\n            tot++;\n            down[nd[i].x]++;\n            update(nd[i].x,(C[down[nd[i].x]][k]*C[lie[nd[i].x]-down[nd[i].x]][k])&mod);\n            continue;\n        }\n        if(nd[i].y==nd[i-1].y)\n        {\n            tot++;\n            if((tot-1>=k)&&(hang[nd[i].y]-tot+1>=k))\n            {\n                ll tp = getsum(nd[i].x-1)-getsum(nd[i-1].x);\n                tp = tp*C[hang[nd[i].y]-tot+1][k]*C[tot-1][k]&mod;\n                ans = (ans+tp)&mod;\n            }\n            down[nd[i].x]++;\n            update(nd[i].x,(C[down[nd[i].x]][k]*C[lie[nd[i].x]-down[nd[i].x]][k]&mod)-(C[down[nd[i].x]-1][k]*C[lie[nd[i].x]-down[nd[i].x]+1][k]&mod));            \n        }else\n        {\n            down[nd[i].x]++;\n            update(nd[i].x,(C[down[nd[i].x]][k]*C[lie[nd[i].x]-down[nd[i].x]][k]&mod)-(C[down[nd[i].x]-1][k]*C[lie[nd[i].x]-down[nd[i].x]+1][k]&mod));\n            tot = 1;\n        }\n    }\n    printf(\"%lld\\n\",ans&mod);\n}\nint main()\n{\n    discretizition();\n    getC();\n    solve();\n    return 0;\n}\n```",
        "postTime": 1549715755,
        "uid": 120949,
        "name": "lizitong",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2154 \u3010[SDOI2009]\u8654\u8bda\u7684\u5893\u4e3b\u4eba\u3011"
    },
    {
        "content": "\u6628\u5929\u5728\u5bbf\u820d\u60f3\u4e86\u4e00\u4e2a\u665a\u4e0a\u7ec8\u4e8e\u5f04\u660e\u767d\u8fd9\u9898\u662f\u600e\u4e48\u4e00\u56de\u4e8b\u4e86\uff1b\n\n\u6211\u4eec\u6765\u770b\u6837\u4f8b\uff1a\n\n- 001000\n- 001000\n- 001000\n- 110110\n- 110101\n- 001000\n- 001000\n\n\u4e00\u4e2a\u5f88\u663e\u7136\u7684\u66b4\u529b\u505a\u6cd5\uff1a\u4e8c\u7ef4\u524d\u7f00\u548c+\u7ec4\u5408\u6570\uff0c\u671f\u671b\u5f97\u5206\uff1a30\uff0c\u5b9e\u9645\u5f97\u5206\uff1a32\uff1b\n\n\u4f46\u662f\u4e8c\u7ef4\u524d\u7f00\u548c\u663e\u7136\u65e0\u6cd5\u5f97\u5230\u5168\u90e8\u7684\u5206\u6570\uff1b\n\n\u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u7ef4\u524d\u7f00\u548c\u5355\u70b9\u4fee\u6539\u65f6\u95f4\u7206\u70b8\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u8003\u8651\u7ebf\u6bb5\u6811\uff1b\n\n\u90a3\u4e48\u4e8c\u7ef4\u524d\u7f00\u548c\u65f6\u7a7a\u90fd\u7206\u70b8\uff0c\u6211\u4eec\u80af\u5b9a\u4e0d\u80fd\u641e\u4e2a\u4ec0\u4e48\u4e8c\u7ef4\u7ebf\u6bb5\u6811\u51fa\u6765\uff1b\n\n\u60f3\u529e\u6cd5\u6d88\u6389\u4e00\u7ef4\uff1f\u6392\u5e8f\u4e8c\u5206\uff1f\n\n\u626b\u63cf\u7ebf\uff01\n\n\u6ca1\u9519\u5c31\u662f\u626b\u63cf\u7ebf\u601d\u60f3\uff0c\u5f53\u6574\u4e2a\u56fe\u6570\u636e\u592a\u5927\u800c\u53ea\u6709\u4e00\u90e8\u5206\u6570\u636e\u5bf9\u6211\u4eec\u6709\u7528\u65f6\uff0c\u5e38\u7528\u626b\u63cf\u7ebf\uff1b\n\n\u6211\u4eec\u5bf9\u5e38\u9752\u6811\u4ee5x\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0cy\u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff1b\n\n\u7136\u540e\u4ece\u5de6\u5f80\u53f3\u626b\uff08\u4e2a\u4eba\u4e60\u60ef\uff09\uff1b\n\n\u4e00\u822c\u6765\u8bf4\uff0c\u7ebf\u6bb5\u6811\u4e0e\u626b\u63cf\u7ebf\u65b9\u5411\u5782\u76f4\uff0c\u6211\u4eec\u5148\u786e\u5b9a\u7ebf\u6bb5\u6811\u65b9\u5411\u662f\u5782\u76f4\u4e8ex\u8f74\u7684\uff1b\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u7ebf\u6bb5\u6811\u7ef4\u62a4\u7684\u4e1c\u897f\uff1b\n\n\u4ece\u6837\u4f8b\u4e2d\u89c2\u5bdf\uff0c\u8fd9\u4e2a\u201c\u6070\u597d\u201d\u4e8c\u5b57\u5e76\u4e0d\u80fd\u8868\u793a\u4e3a\u4e00\u4e2abool\u578b\u7684\u91cf\u4f5c\u201c\u662f1\u975e0\u201d\u5904\u7406\uff0c\u597d\u50cf\u662f\u7ec4\u5408\u6570\uff01~~\uff08\u8003\u573a\u4e0a\u7ea0\u7ed3\u4e86\u5f88\u4e45\u751a\u81f3\u60f3\u8981\u6253\u6b7b\u51fa\u9898\u4eba\uff0c\u201c\u6070\u597d\u201d\u96be\u9053\u4e0d\u662f\u591a\u4e86\u4e5f\u4e0d\u7b97\u5417qwq\uff09~~\n\n\u90a3\u4e48\u5bf9\u4e8e\u4e00\u4e2a\u6709\u8d21\u732e\u7684\u5893\u5730\uff0c\u5176\u8d21\u732e\u7b49\u4e8e\u56db\u65b9\u5411\u5e38\u9752\u6811\u6570\u76ee\u5bf9k\u7684\u7ec4\u5408\u6570\u4e58\u79ef\uff1b\n\n\u90a3\u4e48\u7ebf\u6bb5\u6811\u7ef4\u62a4\u7684\u4fe1\u606f\u5e94\u8be5\u4e0e\u7ec4\u5408\u6570\u6709\u5173\uff1b\n\n\u65e2\u7136\u7ebf\u6bb5\u6811\u968f\u626b\u63cf\u7ebf\u4ece\u5de6\u5411\u53f3\u5e73\u79fb\uff0c\u90a3\u4e48\u7ef4\u62a4\u7684\u4fe1\u606f\u5e94\u8be5\u5728\u6c34\u5e73\u65b9\u5411\uff1b\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u697c\u4e0b\u7684\u5f0f\u5b50\u3002\u4e8e\u662f\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u8fd9\u4e2a\u95ee\u9898\u7cbe\u5999\u7684\u89e3\u51b3\u65b9\u6848\u3002\n\n\u4e8e\u662f\u4f60\u52a8\u624b\u5199\u7ebf\u6bb5\u6811\u3002~~\u4e8e\u662f\u4f60\u6109\u5feb\u5730TLE\u4e86~~\n\n\u7ebf\u6bb5\u6811\u5e38\u6570\u5f88\u5927\u600e\u4e48\u529e\uff1f\n\n\u5bf9\u4e8e\u8fd9\u7c7b\u95ee\u9898\u6211\u4eec\u8003\u8651\u4e24\u4e2a\u65b9\u6848\uff1a\n1. \u5bf9\u4e8e\u5355\u6807\u8bb0\u7684**\u6c38\u4e45\u5316**\n2. \u66f4\u6362**\u5e38\u6570\u8f83\u5c0f**\u7684\u6570\u636e\u7ed3\u6784\n\n\u4e24\u8005\u90fd\u80fd\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u89e3\u51b3\u7ebf\u6bb5\u6811\u81ea\u8eab\u5e38\u6570\u8fc7\u5927\u7684\u95ee\u9898\uff1b\n\n\u65e2\u7136\u6811\u72b6\u6570\u7ec4\u7684\u9898\u89e3\u5df2\u7ecf\u6709\u4e86\uff0c\u90a3\u6211\u5c31\u6765\u4e00\u53d1zkw\u7ebf\u6bb5\u6811\uff01\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\n\nconst int MAXN=(1<<17)-1;\n\nint n,m,W,k,ans;\nint C[MAXN][13];\nint tree[MAXN<<1],cnto[MAXN],cntd[MAXN],cntl[MAXN],cntr[MAXN];\nstruct pnt{\n\tint x,y;\n\tint rex,rey;\n}p[MAXN];\n\nbool cmp1(pnt a,pnt b){\n\tif(a.y==b.y) return a.x<b.x;\n\treturn a.y<b.y;\n}bool cmp2(pnt a,pnt b){\n\tif(a.x==b.x) return a.y<b.y;\n\treturn a.x<b.x;\n}\n\nvoid init(){\n\tscanf(\"%d%d%d\",&n,&m,&W);\n\tfor(int i=1;i<=W;++i){\n\t\tscanf(\"%d%d\",&p[i].x,&p[i].y);\n\t}scanf(\"%d\",&k);\n\tfor(int i=0;i<=W;++i){\n\t\tC[i][0]=1;\n\t\tfor(int j=1;j<=min(i,k);++j){\n\t\t\tC[i][j]=C[i-1][j]+C[i-1][j-1];\n\t\t}\n\t}sort(p+1,p+W+1,cmp1);\n\tp[1].rey=1;\n\tfor(int i=2;i<=W;++i){\n\t\tif(p[i].y==p[i-1].y) p[i].rey=p[i-1].rey;\n\t\telse p[i].rey=p[i-1].rey+1;\n\t}sort(p+1,p+W+1,cmp2);\n\tp[1].rex=cntr[p[1].rey]=cnto[p[1].rex]=1;\n\tfor(int i=2;i<=W;++i){\n\t\tif(p[i].x==p[i-1].x) p[i].rex=p[i-1].rex;\n\t\telse p[i].rex=p[i-1].rex+1;\n\t\t++cntr[p[i].rey];++cnto[p[i].rex];\n\t}\n}\n\nvoid solve(){\n\tfor(int i=1;i<=W;++i){\n\t\t++cntl[p[i].rey];--cntr[p[i].rey];\n\t\t++cntd[p[i].rex];--cnto[p[i].rex];\n\t\ttree[MAXN+p[i].rey]=C[cntl[p[i].rey]][k]*C[cntr[p[i].rey]][k];\n\t\tfor(int j=MAXN+p[i].rey>>1;j;j>>=1) tree[j]=tree[j<<1]+tree[j<<1|1];\n\t\tif(p[i].rex==p[i-1].rex&&p[i].rey-p[i-1].rey>1){\n\t\t\tif(cnto[p[i].rex]+1>=k&&cntd[p[i].rex]-1>=k){\n\t\t\t\tint l=MAXN+p[i-1].rey,r=MAXN+p[i].rey;\n\t\t\t\tint sum=0;\n\t\t\t\twhile(l^r^1){\n\t\t\t\t\tif(~l&1) sum+=tree[l^1];\n\t\t\t\t\tif(r&1) sum+=tree[r^1];\n\t\t\t\t\tl>>=1;r>>=1;\n\t\t\t\t}ans+=sum*C[cnto[p[i].rex]+1][k]*C[cntd[p[i].rex]-1][k];\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid write(){\n\tprintf(\"%d\\n\",ans>=0?ans:ans+2147483648ll);\n}\n\nint main(){\n\tfreopen(\"religious.in\",\"r\",stdin);\n\tfreopen(\"religious.out\",\"w\",stdout);\n\tinit();\n\tsolve();\n\twrite();\n\treturn 0;\n}\n```",
        "postTime": 1522022738,
        "uid": 31293,
        "name": "Adove",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2154 \u3010[SDOI2009]\u8654\u8bda\u7684\u5893\u4e3b\u4eba\u3011"
    },
    {
        "content": "\n\u9898\u76ee\n-\n\n[\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P2154)\n\n\u9898\u89e3\n-\n\n\u6211\u5728\u8003\u573a\u4e0a\u5199\u7684\u662fO(nm)\uff0c\u627e\u5230\u4e00\u4e2a\u7a7a\u5730\u5c31\u5206\u522b\u53d6\u4e0a\u4e0b\u5de6\u53f3\u7684\u6811\u7684\u6570\u91cf\u5206\u522b\u4e3aa\uff0cb\uff0cc\uff0cd\uff0c\u90a3\u4e48\u8fd9\u5757 \u5893\u5730\u7684\u503c\u5c31\u662fC[a][k]*C[b][k]*C[c][k]*C[d][k];\n\n![\u8fd9\u91cc\u5199\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdn.net/20180326200628597?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0FfQ29tbWVfQW1vdXI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)\n\n\u601d\u8def\u662f\u6ca1\u9519\u7684\uff0c\u6211\u4eec\u8003\u8651\u600e\u4e48\u4f7f\u7528\u6570\u636e\u7ed3\u6784\u4f18\u5316\u65f6\u95f4\u548c\u7a7a\u95f4\uff1b\n\n\u9996\u5148\u6211\u4eec\u628a\u6bcf\u68f5\u6811\u6309\u7167y\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0cx\u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\u6392\u5e8f\u3002\u7136\u540e\u7edf\u8ba1\u6bcf\u4e2a\u884c\u548c\u5217\u7684\u6811\u7684\u6570\u91cf\uff1b\n\n\u4ece\u5de6\u5f80\u53f3\u505a\u6bcf\u4e00\u5217\uff0c\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u627e\u5230\u4e86\u5728\u540c\u4e00\u5217\u7684\u4e24\u68f5\u4e0d\u76f8\u90bb\u7684\u6811P\u548cQ\uff0c\u4e0b\u9762\u6c42PQ\u95f4\u7684\u5893\u5730\u7684\u503c\uff1b\u5bf9\u4e8e\u8fd9\u4e9b\u5893\u5730\u6b63\u4e0a\u65b9\u548c\u6b63\u4e0b\u65b9\u7684\u7ec4\u5408\u6570\u90fd\u662f\u6bd4\u8f83\u597d\u6c42\u7684\uff0c\u5173\u952e\u5728\u4e8e\u5982\u4f55get\u5230\u8fd9\u4e9b\u5893\u5730\u5de6\u8fb9\u548c\u53f3\u8fb9\u7684\u503c;\u8fd9\u5c31\u662f\u6211\u4eec\u8981\u7ef4\u62a4\u7684\uff1b\n\n\u5982\u4e0b\u56fe\u7ea2\u8272\u533a\u57df\n\n![\u8fd9\u91cc\u5199\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdn.net/20180326201647489?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0FfQ29tbWVfQW1vdXI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)\n\n\u6ce8\u610f\u7ef4\u62a4\u7684\u503c\u7684\u610f\u4e49\uff1a\u8868\u793a\u5728\u9009\u4e2d\u5f53\u524d\u5217\u7684\u72b6\u6001\u4e0b\uff0c\u8be5\u884c\u7684SUM\u503c\uff1b\u6240\u4ee5\u6211\u4eec\u6bcf\u6b21\u505a\u5b8c\u4e00\u5757\uff08\u4e00\u90e8\u5206\uff09\u5893\u5730\u90fd\u9700\u8981\u8fdb\u884c\u4fee\u6539\uff0c\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u505a\u5b8c\u7684\u70b9\u7684\u5de6\u8fb9\u7684\u6811\u7684\u6570\u91cf\u4e3aa\uff0c\u53f3\u8fb9\u7684\u6811\u7684\u6570\u91cf\u4e3ab\uff0c\u90a3\u4e48\u4fee\u6539\u91cf\u5c31\u662f C [a+1][k] * C [b][k] - C [a][k] * C[b+1][k];\n\n\u7531\u4e0a\u8ff0\u5206\u6790\u53ef\u77e5\uff0c\u6211\u4eec\u9700\u8981\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u8d44\u74f7\u5355\u70b9\u4fee\u6539\u548c\u533a\u95f4\u67e5\u8be2\uff0c\u7ebf\u6bb5\u6811\u548c\u6811\u72b6\u6570\u7ec4\u5747\u53ef\uff1b\n\n\u53e6\u5916\uff0c\u5bf9\u4e8e\u5750\u6807\u7684\u79bb\u6563\u5316\uff0c\u9012\u63a8\u6c42\u7ec4\u5408\u6570\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\uff1b\n\n\u4ee3\u7801\n-\n\n\u70b9[\u8fd9\u91cc](https://blog.csdn.net/A_Comme_Amour/article/details/79703637)\n\n\u603b\u7ed3\n-\n\n\u575a\u51b3\u4e0d\u80fd\u628a\u5927\u91cf\u65f6\u95f4\u82b1\u5728\u8c03\u8bd5\u4e0a\uff1b\n\n\u8fd9\u79cd\u56fa\u5b9a\u4e00\u7ef4\u6765\u64cd\u4f5c\u53e6\u4e00\u7ef4\u7684\u601d\u60f3\uff1b\u7ebf\u6bb5\u6811\u53ef\u4ee5\u4e0d\u65ad\u66f4\u65b0\u4e0d\u5fc5\u4f7f\u7528\u4e8c\u7ef4\u7ebf\u6bb5\u6811\u4ee5\u51cf\u5c11\u7a7a\u95f4\n\n\u4ee5\u4e0a",
        "postTime": 1522067668,
        "uid": 48036,
        "name": "\u79cb\u65e5\u79c1\u8bed",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2154 \u3010[SDOI2009]\u8654\u8bda\u7684\u5893\u4e3b\u4eba\u3011"
    },
    {
        "content": "# \u9898\u89e3\n\n##### \u5176\u4ed6\u5927\u4f6c\u5199\u7684\u90fd\u5f88\u597d\u4e86\uff0c\u6211\u5c31\u6765\u5199\u4e0b\u89e3\u8fd9\u79cd\u9898\u7684\u8fc7\u7a0b\u5427\u3002\u3002\u3002\n------------\n\n### \u9898\u76ee\u5206\u6790\n#### \u6c42\u51fa\u4e00\u4e2a\u5b66\u751f\u5403\u996d\u7684\u987a\u5e8f\uff0c\u4f7f\u5f97\u65f6\u95f4\u6700\u77ed\n#### \u600e\u6837\u624d\u80fd\u77ed\uff1f\uff1f\uff1f\uff1f \u7528\uff08a or b\uff09-\uff08a and b\uff09\u8ba1\u7b97\u65f6\u95f4\n\n\n#### \u9996\u5148\u770b\u9898\u76ee\uff1a\u53d1\u73b0\u8fd9\u4e2a\u4eba\u4e0d\u4ec5\u548c\u524d\u9762\u4eba\u53c8\u5173\uff0c\u8fd8\u548c\u540e\u9762\u4eba\u6709\u5173\uff0c~~\u5567\u5567\u5567~~\n\n#### \u518d\u770b\u6570\u636e\u8303\u56f4 \n### \u5b58\u572830%\u7684\u6570\u636e\uff0c\u6ee1\u8db30 \u2264 Bi \u2264 1\u3002~~(\u53ef\u4ee5\u9a97\u5206\uff0c\u7f8e\u6ecb\u6ecb~~\n### \u5bf9\u4e8e100%\u7684\u6570\u636e\uff0c\u6ee1\u8db31 \u2264 N \u2264 1,000\uff0c0 \u2264 Ti \u2264 1,000\uff0c0 \u2264 Bi \u2264 7\uff0c1 \u2264 C \u2264 5\u3002\n\n#### \u53ea\u80fd\u8ba9\u540e\u97627\u4e2a\u4eba\u63d2\u961f\uff0c\u5c82\u4e0d\u662f\u53ef\u4ee5\u72b6\u6001\u538b\u7f29\n\n## ~~\u62ff\u5230\u9898\u76ee\u5148\u6253\u66b4\u529b~~\n\n- \u7136\u540e\u6211\u4eec\u53ef\u4ee5\u4ece\u641c\u7d22\u4e2d\u627e\u5230\u611f\u89c9\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bb0\u5fc6\u5316\u641c\u7d22\u4e2d\u7684\u4f18\u5316\u7b56\u7565\uff0c\u6839\u636e\u6700\u4f18\u6027\u539f\u5219\u7136\u540e\u5199\u8fdb\u65b9\u7a0b\u3002\n\n\n- \u524d\u9762\u5403\u996d\u7684\u5b66\u751f\u548c\u540e\u9762\u7684\u5b66\u751f \u90fd\u5bf9\u6211\u6709\u5f71\u54cd\u3002\u65b9\u4fbf\u8f6c\u79fb\u3002\u4e0d\u5982\u90fd\u5199\u8fdbdp\u65b9\u7a0b\n\n\n\n------------\n\n#### dp\u65b9\u7a0b \uff1a **f[i] [j] [k]**\n\u8868\u793a\uff1a\u524di\u4e2a\u5b66\u751f**\u90fd**\u5403\u8fc7\u4e86\uff08\u90fd\uff01\uff01\uff01\uff09\uff1b\u540e\u9762\u5b66\u751f\u5403\u8fc7\u4e0e\u5426\u7684\u72b6\u51b5\u7528j\u8868\u793a\uff0800010...\uff09\uff1b\u6700\u540e\u5403\u7684\u5b66\u751f\u548ci\u7684\u8ddd\u79bb\u4e3ak\n\n#### \u8ba1\u7b97\u5f0f\n\u6211\u4eec\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u770b\u4f3c\u590d\u6742\u7684\u5f0f\u5b50\uff0c\u5176\u5b9e\u5c31\u662f^\u8fd0\u7b97~~\uff08\u771f\u7684\u76ae~~\n\n------------\n\n## \u5f00\u59cb\u64cd\u76d8\n\u9996\u5148dp\u9884\u5904\u7406\u3002\n~~~cpp\n\tmemset(f,INF,sizeof(f));f[1][0][7]=0;\n~~~\ndp\u5206\u60c5\u51b5\u8f6c\u79fb~~\uff08\u5206\u7c7b\u8ba8\u8bba~~\n\n```cpp\n\tfor(int i=1;i<=n;i++) \n\tfor(int j=0;j<(1<<8);j++)\n\tfor(int k=-8;k<=7;k++) \n    if(f[i][j][k+8]!=INF)\n```\n##### \u5206\u7c7b\u5f00\u59cb\n\u5982\u679c i \u5403\u8fc7\u4e86\uff0c\u5219\u53ef\u4ee5\u8f6c\u79fb\n~~~cpp\n\tif(j&1) f[i+1][j>>1][k+7]=min(f[i+1][j>>1][k+7],f[i][j][k+8]);\n~~~\n\n\u56e0\u4e3a**\u8f6c\u79fb\u65b9\u7a0b\u662f\u524di\u4e2a\u90fd\u5403\u8fc7\u4e86**\uff0c\u6240\u4ee5i\u6ca1\u5403\u662f\u6ca1\u6cd5\u8f6c\u79fb\u7684\u3002\n\n\u4e0d\u8fc7\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u540e\u9762\u540c\u5b66\u63d2\u961f\u6765\u89e3\u51b3\n\n~~~cpp\n\tmemset(f,INF,sizeof(f));f[1][0][7]=0;\n\tfor(int i=1;i<=n;i++) \n\tfor(int j=0;j<(1<<8);j++)\n\tfor(int k=-8;k<=7;k++) \n\tif(f[i][j][k+8]!=INF) {\n\t\t\tif(j&1) f[i+1][j>>1][k+7]=min(f[i+1][j>>1][k+7],f[i][j][k+8]);\n\t\t\telse{\n\t\t\t\tint limit=INF;\n\t\t\t\tfor(int h=0;h<=7;h++) if(!((j)&(1<<h))) {//i\u6ca1\u5403\u6ca1\u6cd5\u8f6c\u79fb\u65b9\u7a0b\uff0c\u4f46\u53ef\u4ee5\u679a\u4e3e\u540e\u9762\u5b66\u751f\u6765\u6ee1\u8db3\u65b9\u7a0b:(\u524di\u4e2a\u4eba\u5403\u8fc7),\uff08\u7531\u6570\u636e\u53ef\u77e5\u6700\u591a7\u4eba\uff09\n\t\t\t\t\tif(i+h > limit) break;\n\t\t\t\t\tlimit=min(limit,i+h+B[i+h]);//\u5f53\u679a\u4e3ei\u540e\u9762\u5b66\u751f\u5230\u524d\u9762\u63d2\u961f\u65f6\uff0c\u5982\u679c\u8981\u8ba9\u4ed6\u63d2\u961f\uff0c\u5e94\u8be5\u6ce8\u610f\u662f\u5426\u6ee1\u8db3i\u540e\u6bcf\u4e00\u4f4d\u5b66\u751f\u7684\u5fcd\u5bb9\u5ea6\u9650\u5236 \n\t\t\t\t\tf[i][j|(1<<h)][h+8]=min( f[i][j|(1<<h)][h+8] , f[i][j][k+8] + (i+k?(T[i+k]^T[i+h]):0) );\n\t\t\t\t\t//\u5f53\u6ee1\u8db3\u4e0a\u8ff0\u6761\u4ef6\u65f6\uff0c\u5c31\u53ef\u4ee5\u8ba9\u7b2ci+h\u4f4d\u540c\u5b66\u63d2\u961f\u5403\u996d\uff0c\u65f6\u95f4\u5c31\u662fcal(i+k \u548c i+h)\u5c31\u53ef\u4ee5\u8fdb\u884cdp\u8f6c\u79fb \n\t\t\t\t}\n\t\t\t}\n\t\t}\n~~~\n\n\n\n\u7b2c\u4e00\u6b21\u5199\u9898\u89e3\u3002\u3002\u4e0d\u559c\u8f7b\u55b7\u3002\u3002\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7565\u8fc7\n\n\n\n\n\n",
        "postTime": 1541671970,
        "uid": 81190,
        "name": "be_humbo",
        "ccfLevel": 0,
        "title": "P2154 SDOI2009 \u5b66\u6821\u98df\u5802\u9898\u89e3\uff08\u72b6\u538b"
    }
]