[
    {
        "content": "\u4e0d\u81f3\u4e8e\u6ca1\u6709\u9898\u89e3\u5427\u3002\u3002\u3002\n\n\u9996\u5148\u5047\u8bbe\u4e00\u4e2a\u5973\u6027\u4e2d\u610f $k$ \u4e2a\u7537\u6027\uff0c\u603b\u5f97\u5148\u628a\u6982\u7387\u7b97\u51fa\u6765\u5427\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u7537\u6027\uff0c\u9009\u4e2d\u7684\u6982\u7387 $g(1)=P+(1-P)^kP+(1-P)^{2k}P+...$  \n\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u5f97 $g(1)=P\\frac{1-(1-P)^\\infty}{1-(1-P)^k}=\\frac{P}{1-(1-P)^k}$\n\n\u4e14  $\\forall i>1,g(i)=g(i-1)\\times (1-P)$\uff0c\u6545\u53ef\u4ee5\u6c42\u51fa\u6240\u6709 $g(i)$.   \n\u4ece\u5c0f\u5230\u5927\u8003\u8651\u6bcf\u4e2a\u5973\u6027 $i$\uff0c\u82e5\u9009\u62e9\u7b2c $j$ \u4e2a\u4e2d\u610f\u7684\u7537\u6027(\u8bb0\u4e3a $a_{i,j}$ ),\u5219\u8d21\u732e\u4e3a \n$$\n\\sum_{a<i}\\sum_{b>a_{i,j}}P(a\\text{ \u9009 }b)\\times g(j)\n$$\n\u8fd9\u5c31\u662f\u4e2a\u5355\u70b9\u52a0\uff0c\u8be2\u95ee\u540e\u7f00\u548c\u3002\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $\\mathcal O(m\\log n)$\n\nPS:\u6709\u70b9\u5361\u7cbe\u5ea6\uff0c\u6211\u7528 `double` 90pts\uff0c`long double` \u5c31\u8fc7\u4e86\n```cpp\n#define MAXN 500011\nint n;\nstruct BIT\n{\n    long double t[MAXN];\n    #define lowb (i&-i)\n    void modify(int i,long double k)\n    {\n        while(i<=n)t[i]+=k,i+=lowb;\n    }\n    long double Qsum(int i)\n    {\n        long double res=0;\n        while(i)res+=t[i],i-=lowb;\n        return res;\n    }\n}t;\nstd::vector<int>a[MAXN];\nlong double Qpow(long double x,int p)\n{\n    long double res=1;\n    while(p)\n    {\n        if(p&1)res*=x;\n        x*=x,p>>=1;\n    }\n    return res;\n}\nint main()\n{\n    n=read();\n    int m=read();\n    double tmp;\n    scanf(\"%lf\",&tmp);\n    long double p=tmp,ans=0;\n    for(int i=1;i<=m;++i)\n    {\n        int u=read(),v=read();\n        a[u].push_back(v);\n    }\n    for(int u=1;u<=n;++u)\n    {\n        if(a[u].empty())continue;\n        std::sort(a[u].begin(),a[u].end());\n        long double now=p/(1-Qpow(1-p,a[u].size()));\n        for(int v:a[u])\n        {\n            ans+=t.Qsum(n-v)*now;\n            now*=(1-p);\n        }\n        now=p/(1-Qpow(1-p,a[u].size()));\n        for(int v:a[u])\n        {\n            t.modify(n-v+1,now);\n            now*=(1-p);\n        }\n    }\n    printf(\"%.2lf\",tmp=ans);\n    return 0;\n}\n```",
        "postTime": 1597019200,
        "uid": 73142,
        "name": "\u4e07\u5f18",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6089 \u3010[JSOI2015]\u975e\u8bda\u52ff\u6270\u3011"
    },
    {
        "content": "# \u94fe\u63a5\uff1a\n\n[\u9898\u76ee](https://www.luogu.com.cn/problem/P6089)\n\n[\u535a\u5ba2\u56ed](https://www.cnblogs.com/GJY-JURUO/p/14264117.html)\n\n# \u9898\u76ee\u5927\u610f\uff1a\n\n\u6709 $n$ \u4e2a\u7532\u7c7b\u70b9\u548c $n$ \u4e2a\u4e59\u7c7b\u70b9\u3002\u6bcf\u4e2a\u7532\u70b9\u53ef\u4ee5\u548c\u82e5\u5e72\u4e2a\u4e59\u70b9\u8fde\u63a5\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u4e59\u70b9\uff0c\u5b83\u4f1a\u4ee5 $p$ \u7684\u6982\u7387\u9009\u62e9\u6b64\u70b9\uff0c\u4e0d\u9009\u62e9\u5c31\u8df3\u5230\u4e0b\u4e00\u4e2a\u70b9\uff0c\u82e5\u6700\u540e\u4e00\u70b9\u4e0d\u9009\u62e9\uff0c\u5219\u8df3\u5230\u7b2c\u4e00\u70b9\u3002\u6c42\u51fa\u671f\u671b\u9006\u5e8f\u5bf9\u4e2a\u6570\u3002\n\n# \u6b63\u6587\uff1a\n\n\u5047\u8bbe\u4e00\u4e2a\u7532\u70b9\u53ef\u4ee5\u548c $k$ \u4e2a\u4e59\u70b9\u8fde\u63a5\u3002\n\n\u56e0\u4e3a\u50cf\u4e00\u4e2a\u73af\u4e00\u6837\uff0c\u53ef\u4ee5\u8f6c\u51e0\u5708\u3002\u7b2c\u4e00\u4e2a\u4e59\u70b9\u5728\u7b2c\u4e00\u5708\u88ab\u9009\u4e2d\u7684\u6982\u7387\u662f $p$\uff0c\u7b2c\u4e8c\u5708\u88ab\u9009\u4e2d\u7684\u6982\u7387\u5c31\u662f $(1-p)^kp$\uff08\u5373\u4e0d\u9009\u5b83 $k$ \u6b21\u4e5f\u5c31\u8f6c\u4e86\u4e00\u5708\uff0c\u8f6c\u5b8c\u540e\u518d\u9009\uff09\uff0c\u7b2c\u4e09\u5708\u88ab\u9009\u4e2d\u7684\u6982\u7387\u662f $(1-p)^{2k}p$\uff0c\u4ee5\u6b64\u7c7b\u63a8\u7b2c\u4e00\u4e2a\u4e59\u70b9\u88ab\u9009\u4e2d\u7684\u6982\u7387\u662f\uff1a\n\n$$E_1=\\sum_{i=0}^{\\infty}(1-p)^{ik}p$$\n\n\u901a\u8fc7\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\u5f97\u5230\uff1a\n\n$$E_1=\\frac{1-(1-p)^{\\infty}}{1-(1-p)^{k}p}p=\\frac{p}{1-(1-p)^{k}p}$$\n\n\u5f0f\u5b50\u4e2d $(1-p)^{\\infty}$ \u65e0\u9650\u5927\u6240\u4ee5 $1-(1-p)^{\\infty}$ \u65e0\u9650\u5c0f\uff0c\u6240\u4ee5\u53ef\u4ee5\u628a\u5b83\u5316\u6389\u3002\n\n---\n\n\u90a3\u4e48 $E_1$ \u6c42\u597d\u4e86\uff0c\u5269\u4e0b\u7684\u5462\uff1f\u5f88\u5bb9\u6613\u5f97\u5230 $E_i=E_{i-1}\\cdot(1-p)$\uff0c\u56e0\u4e3a $i$ \u76f8\u5f53\u4e8e\u662f\u5148\u62d2\u7edd\u4e86 $i-1$ \u540e\u5f97\u6765\u7684\u3002\n\n\u5269\u4e0b\u7684\u5c31\u548c\u9898\u76ee\u5927\u610f\u7684\u4e00\u6837\uff0c\u6c42\u4e00\u4e2a\u9006\u5e8f\u5bf9\u5c31\u641e\u5b9a\u4e86\u3002\n\n# \u4ee3\u7801\uff1a\n\n```cpp\nint n, m;\nlong double p, t[N], ans;\n\nvector <int> v[N];\n\nvoid add (int x, long double k) {for (; x < n; x += x & -x) t[x] += k; }\nlong double query (int x) {long double ans = 0;for (; x; x -= x & -x) ans += t[x]; return ans;}\n\nlong double qpow(long double a, int b)\n{\n\tlong double ans = 1;\n\tfor (; b; b >>= 1) {if(b & 1)ans *= a; a *= a;} \n\treturn ans;\n}\n\nint main()\n{\n\tscanf (\"%d%d\", &n, &m);\n\tscanf (\"%Lf\", &p);\n\tfor (int i = 1; i <= m; i++)\n\t{\n\t\tint x, y;\n\t\tscanf (\"%d%d\", &x, &y);\n\t\tv[x].push_back(y);\n\t}\n\tfor (int i = 1; i <= n; i++) sort (v[i].begin(), v[i].end());\n\tfor (int i = 1; i <= n; i++)\n\t{\n\t\tif (v[i].empty()) continue;\n\t\tint k = v[i].size();\n\t\tlong double P = p / (1 - qpow(1 - p, k));\n\t\tfor (int j = 0; j < k; j++)\n\t\t\tans += P * query(n - v[i][j]),\n\t\t\tP *= 1 - p;\n\t\tP = p / (1 - qpow(1 - p, k));\n\t\tfor (int j = 0; j < k; j++)\n\t\t\tadd(n + 1 - v[i][j], P),\n\t\t\tP *= 1 - p;\n\t}\n\tprintf (\"%.2Lf\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1610368428,
        "uid": 80695,
        "name": "Jayun",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P6089 \u3010[JSOI2015]\u975e\u8bda\u52ff\u6270\u3011"
    },
    {
        "content": "\u8bbe\u5973\u751f\u96c6\u5408\u4e3a$A$\u3002\u9996\u5148\u5148\u5bf9$A$\u96c6\u5408\u4e2d\u7684\u6bcf\u4e2a$Ai$\u7684\u7537\u751f\u96c6\u5408\u6309\u7f16\u53f7\u6392\u5e8f\uff0c\u8bbe$A$\u96c6\u5408\u4e2d\u7684$Ai$\u6709$m$\u4f4d\u7537\u751f\uff0c\u5bf9\u4e8e\u7b2c$i$\u4f4d\u7537\u751f\uff1a\n\n - \u7b2c\u4e00\u8f6e\u5373\u88ab\u9009\u4e2d\uff1a$P1=(1-p)^{(i-1)} *p$.\n\n - \u7b2c\u4e8c\u8f6e\uff1a$P2:(1-p)^{(i-1+m)}*p$, \n\n - \u7b2c$n$\u8f6e\uff1a$Pn=(1-p)^{(i-1+m*(n-1) )}*p$.\n\n\u89c2\u5bdf\u53d1\u73b0\u662f\u7b49\u6bd4\u6570\u5217\uff0c\u5957\u516c\u5f0f\u5f97\n\n$P=(1-p)^{(i-1)}*(1-(1-p)^{(m*n)})/(1-(1-p)^m)$ \n\n\u56e0\u4e3a$n$\u65e0\u9650\u5927\uff0c\u6240\u4ee5$(1-p)^{(m*n)}$\u65e0\u9650\u5c0f\u3002\n\n\u6240\u4ee5\u9009\u4e2d$i$\u7684\u6982\u7387\u4e3a$P=(1-p)^{(i-1)}/(1-(1-p)^m)$. \n\n\u63a5\u4e0b\u6765\u53ea\u8981\u7528\u6743\u503c\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u9006\u5e8f\u5bfe\u5373\u53ef\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define N 500100\n#define ll long double\nint n,m;\nll p,c[N],ans;\nint lowbit(int x) {return x&-x;}\nvoid change(int x,ll w)\n{\n\twhile(x<N) c[x]+=w,x+=lowbit(x);\n}\nll ask(int x)\n{\n\tll val=0;\n\twhile(x) val+=c[x],x-=lowbit(x);\n\treturn val;\n}\nvector<int>g[N];\nint main()\n{\n\tcin>>n>>m>>p;\n\tfor(int i=1,a,b;i<=m;i++)\n\t  scanf(\"%d%d\",&a,&b),g[a].push_back(b);\n\tfor(int i=1;i<=n;++i) sort(g[i].begin(),g[i].end());\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tif(!g[i].size()) continue;\n\t\tint k=g[i].size(),x;\n\t\tfor(int j=0;j<k;j++)\n\t\t{\n\t\t\tx=g[i][j];\n\t\t\tll pos=pow(1-p,j)*p/(1-pow(1-p,k));\n\t\t//\tprintf(\"girl==%d boy==%d p==%Lf\\n\",i,x,pos);\n\t\t\tans+=pos*(ask(n)-ask(x));\n\t\t}\n\t\tfor(int j=0;j<k;j++)\n\t\t{\n\t\t\tx=g[i][j];\n\t\t\tll pos=pow(1-p,j)*p/(1-pow(1-p,k));\n\t\t\tchange(x,pos);\n\t\t}\n\t}\n\tprintf(\"%.2Lf\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1598327734,
        "uid": 285069,
        "name": "LSG_waterlyf",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6089 \u3010[JSOI2015]\u975e\u8bda\u52ff\u6270\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\uff0c\u56e0\u4e3a $0.4 \\le p < 0.6$\uff0c\u5220\u53bb\u5206\u5b50\u4e0a\u7684 $A(q+1)$ \u7b97\u51fa\u6bcf\u5bf9\u7537\u5973 $(i,j)$ \u5728\u4e00\u8d77\u7684\u6982\u7387\u3002\u8be2\u95ee\u65f6\u5012\u5e8f\u63d2\u5165\u5e76\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u3002\n\n\u6bd4\u5982\u5bf9\u4e00\u4e2a\u5973\u751f $a$\uff0c\u6709 $k$ \u4e2a\u5019\u9009\u7537\u751f\u7f16\u53f7\u4e3a $1$ \u81f3 $k$\u3002\u90a3\u4e48\u5bf9\u4e8e\u7b2c $m$ \u4e2a\u7537\u751f\uff0c $(a,m)$ \u5728\u4e00\u8d77\u7684\u6982\u7387\u5c31\u662f $(1-p) ^ {m-1} \\times p + (1-p)^k \\times (1-p) ^ {m-1} \\times p + (1-p)^{2k} \\times (1-p) ^ {m-1} \\times p + ...+(1-p)^{x-1}\\times (1-p) ^ {m-1} \\times p$\n\n\u6211\u4eec\u4e0d\u59a8\u5148\u5229\u7528\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\uff1a\n\n$$S_n=a1\\times \\dfrac{1-q^n}{1-q}$$\n\n\u5176\u4e2d\uff0c $a_1 = (1-p)^{m-1} \\times p,q = (1 - p)^k$\u3002\u90a3\u4e48\u5728 $n$ \u5f88\u5927\u65f6\uff0c $q^n$ \u5c31\u975e\u5e38\u63a5\u8fd1 $0$\u3002\u6240\u4ee5\u6211\u4eec\u4e0d\u59a8\u5c06 $q^n$ \u5f53\u4f5c $0$\uff0c\u5462\u4e48\u7b54\u6848\u5c31\u662f $a_1 \\div (1-q)$\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u4e2a\u601d\u8def\u53ea\u80fd\u62ff\u5230 60 \u5206\u3002\u6211\u4eec\u53ef\u4ee5\u5012\u53d9\u679a\u4e3e\u5973\u751f\uff0c\u4f7f\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u540e $i$ \u4e2a\u5973\u751f\u548c\u524d $j$ \u4e2a\u7537\u751f\u914d\u5bf9\u7684\u6982\u7387\u548c\uff0c\u8fd9\u4e00\u9898\u5c31\u505a\u5b8c\u4e86\u3002\n\n## AC \u4ee3\u7801\n```cpp\n#include<iostream>\n#include<cmath>\n#include<algorithm>\n#include<cstring> \n#include<cstdio>\nusing namespace std;\ntypedef long long LL;\nconst int MAXN = 1e6 + 10;\nconst int INF = 0x3f;\nint n, m;\nstruct TA{\n\tdouble a[MAXN];\n\tdouble sum(int p){\n\t\tdouble res = 0;\n\t\tfor(;p;p-=(p&-p)){\n\t\t\tres += a[p];\n\t\t}\n\t\treturn res;\n\t}\n\tvoid modify(int p,double val){\n\t\tp++;\n\t\tfor(;p<=n;p+=(p&-p)){\n\t\t\ta[p] += val;\n\t\t}\n\t}\n}ta;\nstruct Edge{\n\tint u, v;\n\tdouble p;\n\tEdge(){}\n\tEdge(int u,int v,double p):u(u),v(v),p(p){}\n}e[MAXN];\nbool cmp(Edge a,Edge b){\n\tif(a.u != b.u)return a.u < b.u;\n\treturn a.v < b.v;\n} \ndouble p;\ndouble powp[MAXN];\nint deg[MAXN], cnt[MAXN];\nint main()\n{\n\tcin >> n >> m >> p;\n\tfor(int i = 0;i < m; i++){\n\t\tint u, v;\n\t\tcin >> u >> v;\n\t\tu--;\n\t\tv--;\n\t\tdeg[u]+=1;\n\t\te[i] = Edge(u, v, 0);\n\t}\n\tsort(e,e + m, cmp);\n\tpowp[0] = 1.0;\n\tfor(int i = 0;i < n; i++){\n\t\tpowp[i + 1] = powp[i] * (1 - p);\n\t}\n\tmemset(cnt, 0, sizeof(cnt));\n\tfor(int i = 0;i < m; i++){\n\t\tint u = e[i].u;\n\t\te[i].p = p * (powp[cnt[u]]) / (1 - powp[deg[u]]);\n\t\tcnt[u] += 1;\n\t}\n\treverse(e, e + m);\n\tint pointer = 0;\n\tdouble res = 0.0;\n\tfor(int i = n-1;i >= 0; i--){\n\t\tfor(int j = pointer;j < m && e[j].u == i; j++){\n\t\t\tres += ta.sum(e[j].v) * e[j].p;\n\t\t}\n\t\tfor(int j = pointer;j < m && e[j].u == i; j++){\n\t\t\tta.modify(e[j].v, e[j].p);\n\t\t\tpointer = j + 1;\n\t\t}\n\t}\n\tprintf(\"%.2lf\", res);\n    return 0;\n}\n```",
        "postTime": 1648992242,
        "uid": 341036,
        "name": "\u8521\u7ae3\u51ef",
        "ccfLevel": 4,
        "title": "P6089 [JSOI2015]\u975e\u8bda\u52ff\u6270"
    }
]