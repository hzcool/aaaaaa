[
    {
        "content": "\u8fd9\u662f\u4e00\u7bc7\u642c\u8fd0\u7684\u9898\u89e3\u3002  \n\u539f\u4f5c\u8005\uff1a@[EntropyIncreaser](https://www.luogu.org/space/show?uid=21423)  \n\u539f\u6587\u94fe\u63a5\uff1a[[TJOI2016/HEOI2016] \u6c42\u548c \u7ebf\u6027\u89e3\u6cd5](https://blog.csdn.net/EI_Captain/article/details/87906472)   \norz EI\uff01\uff01\uff01\n****   \n\u5148\u6765\u63a8\u5f0f\u5b50\uff1a  \n$$ans=\\sum\\limits_{i=0}^n\\sum\\limits_{j=0}^iS(i,j)\\times j! \\times 2^j$$  \n$$=\\sum\\limits_{i=0}^n\\sum\\limits_{j=0}^nS(i,j)\\times j! \\times 2^j$$  \n$$=\\sum\\limits_{i=0}^n\\sum\\limits_{j=0}^n2^j\\sum\\limits_{k=0}^j(-1)^{j-k}k^i \\binom{j}{k} $$  \n$$=\\sum\\limits_{j=0}^n\\sum\\limits_{k=0}^j(-1)^{j-k} \\binom{j}{k} 2^j[n+1]_k$$  \n$$[n]_q=\\sum\\limits_{i=0}^{n-1}q^i\\space\\text{is }\\color{#66CCFF}\\text{q-analog}$$\n\n\u5927\u90e8\u5206\u4eba\u7684\u63a8\u5bfc\u5728\u8fd9\u91cc\u5c31\u7ed3\u675f\u4e86\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u5377\u79ef\u3002   \n\u4f46\u662f\u5176\u5b9e\u8fd9\u4e2a\u5f0f\u5b50\u8fd8\u53ef\u4ee5\u4e0d\u5377\u79ef\u8fdb\u884c\u8ba1\u7b97\u3002\u8fd9\u4e2a\u4e1c\u897f\u7684\u8981\u70b9\u5c31\u662f\u6211\u4eec\u8981\u770b\u6e05\u695a\u5f62\u5982  \n$$\\sum\\limits_{j=i}^nq^{j-i}\\binom{j}{i}a_j$$  \n\u7684\u5f62\u5f0f\u662f\u4ec0\u4e48\u3002  \n\u8bbe\u6570\u5217$\\langle a_n \\rangle$\u7684\u751f\u6210\u51fd\u6570\u662f$G(z)$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u548c\u5f0f\u5176\u5b9e\u5c31\u662f\u5e26\u5165\u4e86$G(z+q)$\u3002  \n\u53cd\u89c2\u6211\u4eec\u7684\u5f0f\u5b50\u4e2d\uff1a  \n$$q=-1,G(z)=[n+1]_{2z}=\\frac{(2z)^{n+1}-1}{2z-1}$$  \n\u56e0\u6b64\uff0c\u6211\u4eec\u5f97\u5230\u7684$[n+1]_k$\u9879\u7684\u7cfb\u6570\u5c31\u7531  \n$$G(z-1)=\\frac{(2z-2)^{n+1}-1}{2z-3}$$  \n\u5206\u5b50\u53ef\u4ee5\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u5316\u5f00\uff0c\u7136\u540e\u518d\u9664\u4e00\u4e2a\u4e00\u6b21\u5f0f\uff0c\u8fd9\u662f\u53ef\u4ee5\u9012\u63a8\u7684\u3002  \n\n\u81f3\u4e8e\u628a\u6240\u6709\u7684  \n$$[n+1]_k=\\frac{k^{n+1}-1}{k-1}$$  \n\u7b97\u51fa\u6765\u4e3a\u4ec0\u4e48\u6ca1\u6709\u5feb\u901f\u5e42\u7684$\\Theta(n\\log n)$\uff0c\u90a3\u662f\u56e0\u4e3a$k^{n+1}$\u5173\u4e8e$k$\u662f\u5b8c\u5168\u79ef\u6027\u51fd\u6570\uff0c\u5408\u6570\u7684$k$\u662f\u53ef\u4ee5\u88ab\u7b5b\u51fa\u6765\u7684\u3002\u8fd9\u90e8\u5206\u7684\u590d\u6742\u5ea6\u5c31\u662f$\\pi (n) \\cdot\\Theta(\\log n)=\\Theta(n)$  \n****  \n\u89e3\u6cd5\u90e8\u5206\u5230\u8fd9\u91cc\u5c31\u7ed3\u675f\u4e86\u3002  \n\u4e0b\u9762\u662fEI\u5de8\u4f6c\u7684\u4ee3\u7801\uff0c\u4e0d\u8981\u6284\u54e6  \n```cpp\n#include <cstdio>\n#include <cstring>\n\n#include <functional>\n#include <vector>\n\n#define LOG(FMT...) fprintf(stderr, FMT)\n\nusing namespace std;\n\ntypedef long long ll;\n\nconst int P = 998244353;\n\nvoid exGcd(int a, int b, int& x, int& y) {\n  if (!b) {\n    x = 1;\n    y = 0;\n    return;\n  }\n  exGcd(b, a % b, y, x);\n  y -= a / b * x;\n}\n\nint inv(int a) {\n  int x, y;\n  exGcd(a, P, x, y);\n  if (x < 0)\n    x += P;\n  return x;\n}\n\nint mpow(int x, int k) {\n  int ret = 1;\n  while (k) {\n    if (k & 1)\n      ret = ret * (ll)x % P;\n    x = x * (ll)x % P;\n    k >>= 1;\n  }\n  return ret;\n}\n\nstruct Simple {\n  int n;\n  vector<int> fac, ifac, inv;\n\n  void build(int n) {\n    this->n = n;\n    fac.resize(n + 1);\n    ifac.resize(n + 1);\n    inv.resize(n + 1);\n    fac[0] = 1;\n    for (int x = 1; x <= n; ++x)\n      fac[x] = fac[x - 1] * (ll)x % P;\n    inv[1] = 1;\n    for (int x = 2; x <= n; ++x)\n      inv[x] = -(P / x) * (ll)inv[P % x] % P + P;\n    ifac[0] = 1;\n    for (int x = 1; x <= n; ++x)\n      ifac[x] = ifac[x - 1] * (ll)inv[x] % P;\n  }\n\n  Simple() {\n    build(1);\n  }\n\n  void check(int k) {\n    int nn = n;\n    if (k > nn) {\n      while (k > nn)\n        nn <<= 1;\n      build(nn);\n    }\n  }\n\n  int gfac(int k) {\n    check(k);\n    return fac[k];\n  }\n\n  int gifac(int k) {\n    check(k);\n    return ifac[k];\n  }\n\n  int ginv(int k) {\n    check(k);\n    return inv[k];\n  }\n\n  int binom(int n, int m) {\n    if (m < 0 || m > n)\n      return 0;\n    return gfac(n) * (ll)gifac(m) % P * gifac(n - m) % P;\n  }\n} simp;\n\nconst int N = 100010, PC = 30010;\n\nint n;\nint pc;\nint a[N];\nbool vis[N];\nint p[PC];\nint pw[N];\n\nvoid sieve() {\n  pw[1] = 1;\n  for (int x = 2; x <= n; ++x) {\n    if (!vis[x]) {\n      p[++pc] = x;\n      pw[x] = mpow(x, n + 1);\n    }\n    for (int i = 1; x * p[i] <= n; ++i) {\n      vis[x * p[i]] = true;\n      pw[x * p[i]] = pw[x] * (ll)pw[p[i]] % P;\n      if (x % p[i] == 0)\n        break;\n    }\n  }\n}\n\nint main() {\n  scanf(\"%d\", &n);\n  simp.check(n + 1);\n  for (int i = 0; i <= n; ++i)\n    a[i] = ((n + 1 - i) & 1) ? (P - simp.binom(n + 1, i)) : simp.binom(n + 1, i);\n  int pw = mpow(2, n + 1);\n  for (int i = 0; i <= n; ++i)\n    a[i] = a[i] * (ll)pw % P;\n  --a[0];\n  for (int i = 0; i <= n; ++i)\n    a[i] = (P - a[i]) % P;\n  int q = inv(3) * 2 % P;\n  for (int i = 1; i <= n; ++i)\n    a[i] = (a[i - 1] * (ll)q + a[i]) % P;\n  int ans = (a[0] + a[1] * (ll)(n + 1)) % P;\n  sieve();\n  for (int i = 2; i <= n; ++i)\n    ans = (ans + simp.ginv(i - 1) * (::pw[i] - 1LL) % P * a[i]) % P;\n  if (ans < 0)\n    ans += P;\n  ans = ans * (ll)inv(3) % P;\n  printf(\"%d\\n\", ans);\n\n  return 0;\n}\n```  \nps\uff1a\u5982\u679c\u8c01\u5bf9\u8fd9\u7bc7\u9898\u89e3\u6709\u66f4\u52a0\u6613\u61c2\u7684\u89e3\u91ca\uff0c\u8bf7\u5728\u8ba8\u8bba\u533a\u5199\u51fa\u6765qwq",
        "postTime": 1553924722,
        "uid": 115864,
        "name": "NaCly_Fish",
        "ccfLevel": 6,
        "title": "\u3010\u642c\u8fd0\u3011[HEOI2016/TJOI2016]\u6c42\u548c \u7ebf\u6027\u89e3\u6cd5\uff01"
    },
    {
        "content": "## [\u9898\u610f](https://blog.csdn.net/BeNoble_/article/details/79931185)\n\n\u6c42\n\n$$\\sum_{i=0}^n\\sum_{j=0}^iS_i^j2^jj!\\mod 998244353$$\n\n$S_n^m$\u8868\u793a\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\n\n---\n\n## \u9898\u89e3\n\n\u8003\u8651\u5230\u5f53$i\\lt j$\u65f6$S_i^j=0$\n\n$$\\Rightarrow\\sum_{i=0}^n\\sum_{j=0}^nS_i^j2^jj!$$\n\n$$\\Rightarrow\\sum_{j=0}^n2^jj!\\sum_{i=0}^nS_i^j$$\n\n\u8003\u8651\u5230\n$$S_n^m=\\frac1{m!}\\sum_{i=0}^m(-1)^i{m\\choose i}(m-i)^n=\\sum_{i=0}^m\\frac{(-1)^i}{i!}\\frac{(m-i)^n}{(m-i)!}$$\n\n\u90a3\u4e48\n\n$$\\Rightarrow\\sum_{j=0}^n2^jj!\\sum_{i=0}^n\\sum_{k=0}^j\\frac{(-1)^k}{k!}\\frac{(j-k)^i}{(j-k)!}$$\n\n$$\\Rightarrow\\sum_{j=0}^n2^jj!\\sum_{k=0}^j\\frac{(-1)^k}{k!}\\frac{\\sum_{i=0}^n(j-k)^i}{(j-k)!}$$\n\n\u8bbe$f(i)=\\frac{(-1)^i}{i!},g(i)=\\frac{\\sum_{j=0}^ni^j}{i!}=\\frac{i^{n+1}-1}{(i-1)i!},$\u7279\u522b\u7684$g(0)=1,g(1)=n+1$\n\n$$\\Rightarrow\\sum_{j=0}^n2^jj!(f\\times g)(j)$$\n\n\u8fd9\u6837\u6c42\u4e00\u904d$NTT$\u5373\u53ef\n\n```cpp\n#include<bits/stdc++.h>\n#define fp(i,a,b) for(register int i=a,I=b+1;i<I;++i)\n#define fd(i,a,b) for(register int i=a,I=b-1;i>I;--i)\n#define go(u) for(register int i=fi[u],v=e[i].to;i;v=e[i=e[i].nx].to)\n#define file(s) freopen(s\".in\",\"r\",stdin),freopen(s\".out\",\"w\",stdout)\ntemplate<class T>inline bool cmax(T&a,const T&b){return a<b?a=b,1:0;}\ntemplate<class T>inline bool cmin(T&a,const T&b){return a>b?a=b,1:0;}\nusing namespace std;\nconst int N=3e5+5,P=998244353,G=3;\ntypedef int arr[N];\ntypedef long long ll;\nint n,ans,K;arr a,b,R,wn,Mi,fac,inv,ifac;\ninline int pls(int a,int b){return a+=b,a<P?a:a-P;}\ninline int sub(int a,int b){return a-=b,a<0?a+P:a;}\ninline int fpm(int a,int b){int x=1;for(;b;b>>=1,a=(ll)a*a%P)if(b&1)x=(ll)x*a%P;return x;}\ninline void init(){for(int i=0,j=0;i<K;++i){R[i]=j;for(int l=K>>1;(j^=l)<l;l>>=1);}}\ninline void dft(int*a,int ty=1){\n    fp(i,0,K-1)if(i>R[i])swap(a[i],a[R[i]]);\n    for(int i=2;i<=K;i<<=1){\n        const int d=i>>1,e=ty==1?fpm(G,(P-1)/i):fpm(G,P-1-(P-1)/i);int o;\n        fp(i,1,d-1)wn[i]=(ll)wn[i-1]*e%P;\n        for(int*x=a;x!=a+K;x+=i)fp(k,0,d-1)\n            o=(ll)x[k+d]*wn[k]%P,x[k+d]=sub(x[k],o),x[k]=pls(x[k],o);\n    }if(ty^1){\n        const int inv=fpm(K,P-2);\n        fp(i,0,K-1)a[i]=(ll)a[i]*inv%P;\n    }\n}\nint main(){\n    #ifndef ONLINE_JUDGE\n        file(\"s\");\n    #endif\n    scanf(\"%d\",&n);\n    inv[1]=a[0]=b[0]=wn[0]=Mi[0]=1;a[1]=P-1;b[1]=n+1;\n    fac[0]=1;fp(i,1,n)fac[i]=(ll)fac[i-1]*i%P,Mi[i]=pls(Mi[i-1],Mi[i-1]);\n    ifac[n]=fpm(fac[n],P-2);fd(i,n,1)ifac[i-1]=(ll)ifac[i]*i%P;\n    fp(i,2,n)inv[i]=(ll)(P-P/i)*inv[P%i]%P;\n    fp(i,2,n)a[i]=i&1?P-ifac[i]:ifac[i],\n             b[i]=(ll)(fpm(i,n+1)-1)*inv[i-1]%P*ifac[i]%P;\n    K=1;while(K<=n)K<<=1;K<<=1;init();\n    dft(a),dft(b);fp(i,0,K-1)a[i]=(ll)a[i]*b[i]%P;dft(a,-1);\n    fp(i,0,n)ans=pls(ans,(ll)Mi[i]*fac[i]%P*a[i]%P);\n    printf(\"%d\\n\",ans);\nreturn 0;\n}\n```\n---\n$upd:2019.7.18$\n\n\u611f\u8c22$@PhantasmDragon$\u6307\u51fa\u6211\u7684\u9519\u8bef \u5df2\u66f4\u6b63\n\n---\n\n$upd:2020.1.7$\n\n\u611f\u8c22$@test12345$\u6307\u51fa\u6211\u7684\u9519\u8bef \u5df2\u66f4\u6b63",
        "postTime": 1523608952,
        "uid": 20156,
        "name": "Kelin",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "\u8fd9\u91cc\u662f\u4e00\u4e2a\u6ca1\u4ec0\u4e48\u601d\u7ef4\u96be\u5ea6\u7684\u7ebf\u6027\u505a\u6cd5.\n\n\u524d\u7f6e\u77e5\u8bc6:\u65af\u7279\u6797\u6570\u7684\u7b80\u5355\u6027\u8d28\uff0c\u6709\u9650\u5fae\u79ef\u5206\n\n$$\\begin{aligned}&\\sum_{i=0}^n\\sum_{j=0}^i2^jj!S(i,j)\\\\=&\\sum_{i=0}^n\\sum_{j=0}^n2^jj!S(i,j)\\\\=&\\sum_{i=0}^n\\sum_{j=0}^n2^j\\sum_{k=0}^j(-1)^{j-k}\\binom{j}{k}k^i\\\\=&\\sum_{j=0}^n2^j\\sum_{k=0}^n(-1)^{j-k}\\binom{j}{k}f(k)\\\\=&\\sum_{k=0}^nf(k)(-1)^k\\sum_{j=0}^n(-2)^j\\binom{j}{k}\\end{aligned}$$\n\n\u5176\u4e2d\n\n$$f(k)=\\sum_{i=0}^nk^i,0^0=1$$\n\n\u5269\u4e0b\u7684\u4e8b\u60c5\u5c31\u662f\u8003\u8651\u4e00\u4e0b\u540e\u9762\u90a3\u4e2a$\\sum$\u600e\u4e48\u7b97.\u8003\u8651\u6709\u9650\u5fae\u79ef\u5206.\n\n$$\\sum (-2)^j\\binom{j}{k}\\delta j$$\n\n\u5206\u90e8\u79ef\u5206\uff0c\u8bbe$u=\\dbinom{j}{k},\\Delta v=(-2)^j$\uff0c\u5219\u6709$\\Delta u=\\dbinom{j}{k-1},v=\\dfrac{(-2)^j}{-3}$\uff0c\u4e8e\u662f\n\n$$\\sum (-2)^j\\binom{j}{k}\\delta j=\\frac{(-2)^j}{-3}\\binom{j}{k}-\\frac{-2}{-3}\\sum (-2)^j\\binom{j}{k-1}\\delta j$$\n\n$$\\sum(-2)^j\\binom{j}{0}\\delta j=\\frac{(-2)^j}{-3}$$\n\n\u4e8e\u662f\u53ef\u4ee5\u9012\u63a8.\n\n\u7136\u540e\u5173\u4e8e$f$\u600e\u4e48\u7b97...$O(n)$\u7b5b\u51fa\u6765$k^{n+1}$\u5c31\u597d\u4e86.\n\n\u76ee\u524d\u662f\u6700\u4f18\u89e3.\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nconst int N=5e5,mod=998244353;\nint inv[N],prime[N],p[N],n,cnt,pw[N];\nint qpower(int a,int b)\n{\n    int ans=1;for(;b;b>>=1,a=1ll*a*a%mod)if(b&1)ans=1ll*ans*a%mod;\n    return ans;\n}\nvoid make()\n{\n    inv[1]=1;for(int i=2;i<=n+2;i++)inv[i]=1ll*inv[mod%i]*(mod-mod/i)%mod;\n    for(int i=2;i<=n;i++)\n    {\n        if(!p[i])prime[++cnt]=i,pw[i]=qpower(i,n+1);\n        for(int j=1;j<=cnt&&i*prime[j]<=n;j++)\n        {\n            p[i*prime[j]]=1;pw[i*prime[j]]=1ll*pw[i]*pw[prime[j]]%mod;\n            if(i%prime[j]==0)break;\n        }\n    }\n}\nint main()\n{\n    scanf(\"%d\",&n);if(n==0){puts(\"1\");return 0;}\n    make();\n    int t1=-1ll*qpower(-2,n+1)*inv[3]%mod,t2=-2*inv[3]%mod;\n    int f0=-inv[3],fn=t1,ans=(fn-f0)%mod,bin=n+1;\n    f0=1ll*t2*f0%mod,fn=(1ll*t1*(n+1)+1ll*t2*fn)%mod;\n    ans=(ans-1ll*(n+1)*(fn-f0))%mod;\n    for(int i=2;i<=n;i++)\n    {\n        bin=1ll*bin*(n+2-i)%mod*inv[i]%mod,f0=1ll*t2*f0%mod,fn=(1ll*t1*bin+1ll*t2*fn)%mod;\n        ans=(ans+((i&1)?-1:1)*(1ll*inv[i-1]*(pw[i]-1)%mod*(fn-f0)))%mod;\n    }\n    cout<<(ans+mod)%mod<<endl;\n}\n```",
        "postTime": 1571538036,
        "uid": 22136,
        "name": "qwaszx",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "## \u9898\u76ee\r\n[[HEOI2016/TJOI2016]\u6c42\u548c](https://www.luogu.org/problemnew/show/P4091)\r\n\r\n\u5173\u4e8e\u65af\u7279\u6797\u6570\u4e0e\u53cd\u6f14\u7684\u66f4\u591a\u59ff\u52bf$\\Longrightarrow$[\u70b9\u8fd9\u91cc](https://www.cnblogs.com/y2823774827y/p/10700231.html)\r\n## \u505a\u6cd5\r\n\r\n$$\r\n\\begin{aligned}\r\nAns&=\\sum_{i=0}^n \\sum_{j=0}^i \\begin{Bmatrix}i\\\\j\\end{Bmatrix}2^j\u00d7j!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~1\\\\\r\n&=\\sum_{i=0}^n \\sum_{j=0}^n \\begin{Bmatrix}i\\\\j\\end{Bmatrix}2^j\u00d7j!~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~2\\\\\r\n&=\\sum_{j=0}^n 2^j\u00d7j!\\sum_{i=0}^n \\begin{Bmatrix}i\\\\j\\end{Bmatrix}~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~3\\\\\r\n&=\\sum_{j=0}^n 2^j\u00d7j!\\sum_{i=0}^n \\sum_{k=0}^j\\frac{(-1)^k}{k!}\\cdot\\frac{(j-k)^i}{(j-k)!}~~~~~~~~~~~~~~~4\\\\\r\n&=\\sum_{j=0}^n 2^j\u00d7j!\\sum_{k=0}^j\\frac{(-1)^k}{k!}\\cdot\\frac{  \\sum_{i=0}^n (j-k)^i}{(j-k)!}~~~~~~~~~~~~~5\\\\\r\n&=\\sum_{j=0}^n 2^j\u00d7j!\\sum_{k=0}^j\\frac{(-1)^k}{k!}\\cdot \\frac{(j-k)^{n+1}-1}{(j-k-1)(j-k)!}~~~~6\\\\\r\n\\end{aligned}\r\n$$\r\n\r\n- $2$\uff1a$\\displaystyle \\begin{Bmatrix}i\\\\j\\end{Bmatrix}=0(i>j)$\r\n- $3$\uff1a\u79fb\u9879\r\n- $4$\uff1a[\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u7684\u6027\u8d28](https://www.cnblogs.com/y2823774827y/p/10700231.html)\r\n- $5$\uff1a\u79fb\u9879\u5316\u5377\u79ef\r\n- $6$\uff1a\u7b49\u6bd4\u516c\u5f0f\r\n\r\n\r\n## \u603b\u7ed3\r\n\u8fd9\u9898\u975e\u5e38\u6709\u610f\u601d\uff0c\u6700\u540e\u4e00\u6b65\u5bf9\u4e8e\u849f\u84bb\u6765\u8bf4\u8fd8\u662f\u5c11\u89c1\u7684\uff0c\u63a8\u5230$4$\u8c01\u90fd\u4f1a\uff0c\u7136\u540e\u5c31\u65e0\u4ece\u4e0b\u624b\u4e86\r\n\u4ee5\u81f3\u4e8e\u4f1a\u4ece\u5934\u8003\u8651$2^j\u00d7j!$\u7684\u6027\u8d28\uff0c\u7279\u522b\u5bb9\u6613\u60f3\u504f\r\n## Code\r\n```cpp\r\n#include<bits/stdc++.h>\r\ntypedef int LL;\r\ntypedef long long L;\r\nconst LL maxn=3e5+9,mod=998244353,g=3,_g=332748118;\r\ninline LL Pow(LL base,LL b){\r\n    LL ret(1);\r\n    while(b){\r\n        if(b&1) ret=(L)ret*base%mod; base=(L)base*base%mod; b>>=1;\r\n    }return ret;\r\n}\r\nLL fac[maxn],fav[maxn],r[maxn],F[maxn],G[maxn],W[maxn];\r\ninline void NTT(LL *a,LL n,LL type){\r\n    for(LL i=0;i<n;++i) if(i<r[i]) std::swap(a[i],a[r[i]]);\r\n    for(LL mid=1;mid<n;mid<<=1){\r\n        LL wn(Pow(type?g:_g,(mod-1)/(mid<<1)));\r\n        W[0]=1; for(LL i=1;i<mid;++i) W[i]=(L)W[i-1]*wn%mod;\r\n        for(LL R=mid<<1,j=0;j<n;j+=R)\r\n            for(LL k=0;k<mid;++k){\r\n            \tLL x(a[j+k]),y((L)W[k]*a[j+mid+k]%mod);\r\n            \ta[j+k]=x+y; if(a[j+k]>=mod) a[j+k]%=mod;\r\n\t\t\t\ta[j+mid+k]=x-y; if(a[j+mid+k]<0) a[j+mid+k]+=mod;\r\n            }\r\n    }\r\n}\r\ninline LL Fir(LL n){\r\n    LL limit(1),len(0);\r\n    while(limit<n){\r\n        limit<<=1; ++len;\r\n    }\r\n    for(LL i=0;i<limit;++i) r[i]=(r[i>>1]>>1)|((i&1)<<len-1);\r\n    return limit;\r\n}\r\ninline LL Solve_fg(LL n){\r\n    for(LL i=0;i<=n;++i) F[i]=(L)(i&1?mod-1:1)*fav[i]%mod;\r\n    for(LL i=0;i<=n;++i) G[i]=(L)(Pow(i,n+1)+mod-1)%mod*Pow(i-1<0?i+mod-1:i-1,mod-2)%mod*fav[i]%mod;\r\n    G[1]=n+1;\r\n    LL limit(Fir(n+1<<1));\r\n    NTT(F,limit,1); NTT(G,limit,1);\r\n    for(LL i=0;i<limit;++i) F[i]=(L)F[i]*G[i]%mod;\r\n    NTT(F,limit,0);\r\n    LL ty(Pow(limit,mod-2)); for(LL i=0;i<=n;++i) F[i]=(L)F[i]*ty%mod;\r\n    \r\n    LL ret(0);\r\n    for(LL i=0;i<=n;++i) ret=(L)(ret+(L)Pow(2,i)*fac[i]%mod*F[i]%mod)%mod;\r\n    return ret;\r\n}\r\nLL n;\r\nint main(){\r\n    scanf(\"%d\",&n);\r\n    fac[0]=fac[1]=1;\r\n    for(LL i=2;i<=n;++i) fac[i]=(L)fac[i-1]*i%mod;\r\n    fav[n]=Pow(fac[n],mod-2);\r\n    for(LL i=n;i>=1;--i) fav[i-1]=(L)fav[i]*i%mod;\r\n    \r\n    printf(\"%d\",Solve_fg(n));\r\n    return 0;\r\n}\r\n```",
        "postTime": 1555307245,
        "uid": 88804,
        "name": "y2823774827y",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "**\u9898\u610f\uff1a** \u6c42\n\n$$\\sum_{i=0}^n \\sum_{j=0}^i S(i,j) \\times 2^j\\times j!$$\n\n**\u63a8\u5f0f\u5b50\u73af\u8282\uff1a**\n\n1\u3001\u56e0\u4e3a $S(i,j)=0(j>i)$\uff0c\u6240\u4ee5\u539f\u5f0f\u7b49\u4e8e\n\n$$\\sum_{i=0}^n \\sum_{j=0}^n S(i,j) \\times 2^j\\times j!$$\n\n2\u3001\u6539\u53d8\u679a\u4e3e\u987a\u5e8f\uff0c\u4e0a\u5f0f\u7b49\u4e8e\n\n$$\\sum_{j=0}^n2^j\\times j! \\sum_{i=0}^n S(i,j)$$\n\n3\u3001\u56e0\u4e3a$S(n,m)=\\sum_{i=0}^m(-1)^{i}\\times \\frac{1}{i!(m-i)!}\\times (m-i)^n$\uff08\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u7684\u901a\u9879\u516c\u5f0f\uff09\uff0c\u6240\u4ee5\u4e0a\u5f0f\u7b49\u4e8e\n\n$$\\sum_{j=0}^n2^j\\times j! \\sum_{i=0}^n \\sum_{k=0}^j(-1)^k\\times \\frac{1}{k!(j-k)!}\\times (j-k)^i$$\n\n4\u3001\u628a $k$ \u7684\u679a\u4e3e\u63d0\u524d\uff0c\u4e0a\u5f0f\u7b49\u4e8e\n\n$$\\sum_{j=0}^n2^j\\times j! \\sum_{k=0}^j(-1)^k\\times \\frac{1}{k!(j-k)!}\\times \\sum_{i=0}^n (j-k)^i$$\n\n5\u3001\u770b\u8d77\u6765\u4e0d\u597d\u770b\uff0c\u628a\u540e\u9762\u7684\u4e1c\u897f\u6362\u6210\u548c $j$ \u6709\u5173\u7684\u5f0f\u5b50\uff0c\u4ee4\n$$g[j]=\\sum_{k=0}^j(-1)^k\\times \\frac{1}{k!(j-k)!}\\times \\sum_{i=0}^n (j-k)^i$$\n\n\u4e8e\u662f\u7b54\u6848\u5c31\u662f\n$$\\sum_{j=0}^n2^j\\times j!\\times g[j]$$\n\n\u95ee\u9898\u8f6c\u6362\u4e3a:**\u5982\u4f55\u6c42 $g[i]$ ?**\n\n\u6362\u4e2a\u53d8\u91cf\u540d\u5e94\u8be5\u66f4\u597d\u770b\u4e00\u4e9b\u3002\n\n$$g[i]=\\sum_{j=0}^i \\frac{(-1)^j}{j!}\\times  \\frac{\\sum_{k=0}^n (i-j)^k}{(i-j)!} $$\n\n\u55ef\u8fd9\u91cc\u5c31\u5f88\u660e\u663e\u4e86\uff0c$g$ \u662f\u4e2a\u5377\u79ef\u5f62\u5f0f\u3002\n\n\u518d\u8be6\u7ec6\u4e00\u70b9\uff1a\n\n\u4ee4\n$$a[i]=\\frac{(-1)^i}{i!}$$\n,\n$$b[i]=\\frac{\\sum_{k=0}^n i^k}{i!}=\\frac{i^{n+1}-1}{(i-1)i!}$$\n\n\u6ce8\uff1a$b[i]$ \u7684\u63a8\u5bfc\u7528\u5230\u4e86\u7b49\u6bd4\u6570\u5217\u6c42\u548c\uff0c\u4e14 $b[1]=n+1$\u3002\n\n\u4e8e\u662f $g[i]=\\sum_{j=0}^ia[j]\\times b[i-j]$\n\n\u7528 $NTT$ \u4f18\u5316\u591a\u9879\u5f0f\u4e58\u6cd5\u5373\u53ef\u3002\n\n**\u4ee3\u7801**\uff1a\uff08\u8fd8\u662f\u5f88\u597d\u5199\u7684\uff0c$50$ \u884c\n\n```cpp\n#include<bits/stdc++.h>\n#define N 400005\n#define p 998244353\n#define G 332748118\n#define int long long\nusing namespace std;\n\nint n,ans,lim;\nint a[N],b[N],r[N];\nint f[N],inv[N],g[N];\n\ninline int POW(int a,int b=p-2,int ans=1){\n\tfor(;b;b>>=1,a=a*a%p)\n\t\tif(b&1) ans=ans*a%p;\n\treturn ans;\n}\nvoid NTT(int *f,int opt,int n)\n{\n    for(int i=0;i<n;i++)\n        if(i<r[i]) swap(f[i],f[r[i]]);\n    for(int w,len=1;len<n;len<<=1){\n        w=POW(opt==1?3:G,(p-1)/(len<<1));\n        for(int b=1,k=0;k<n;k+=(len<<1),b=1)\n            for(int i=k;i<k+len;i++,b=1ll*b*w%p){\n                int now=1ll*b*f[i+len]%p;\n                f[i+len]=(f[i]-now+p)%p;f[i]=(f[i]+now)%p;\n            }\n    }\n}\nvoid mul(int *a,int *b,int n)\n{\n    for(lim=1;lim<=n+n;lim<<=1);\n    for(int i=0;i<lim;i++)\n        r[i]=(r[i>>1]>>1)|((i&1)?lim>>1:0);\n    NTT(a,1,lim);NTT(b,1,lim);\n    for(int i=0;i<lim;i++) b[i]=a[i]*b[i]%p;\n    NTT(b,-1,lim); int inv=POW(lim,p-2);\n    for(int i=0;i<=n;i++) g[i]=b[i]*inv%p;\n}\nsigned main(){\n\tcin>>n;\n\tb[0]=f[0]=inv[0]=1;b[1]=n+1;\n\tfor(int i=1;i<=n;i++)\n\t\tf[i]=f[i-1]*i%p,inv[i]=POW(f[i]);\n\tfor(int i=0;i<=n;i++)\n\t\ta[i]=POW(p-1,i)*inv[i]%p;\n\tfor(int i=2;i<=n;i++)\n\t\tb[i]=(POW(i,n+1)-1)*POW(i-1)%p*inv[i]%p;\n\tmul(a,b,n);\n\tfor(int now=1,i=0;i<=n;i++,now=(now<<1)%p)\n\t\t(ans+=now*f[i]%p*g[i])%=p;\n\tcout<<ans;\t\n}\n```",
        "postTime": 1543670805,
        "uid": 56659,
        "name": "AubRain",
        "ccfLevel": 0,
        "title": "[HEOI2016/TJOI2016]\u6c42\u548c\u2014\u2014NTT+\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570"
    },
    {
        "content": "[\u6b22\u8fce\u5149\u4e34\u535a\u5ba2](http://endsah.tk/blog/HEOI2016-%E6%B1%82%E5%92%8C/)\n\n\u6bd4\u8f83\u7b80\u5355\u6613\u61c2\u7684\u7ebf\u6027\u505a\u6cd5\u3002\n\n\u4e0b\u9762\u7528 $\\begin{Bmatrix} i \\\\ j \\end{Bmatrix}$ \u8868\u793a\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\uff0c\u4e5f\u5373\u5c06 $i$ \u5212\u5206\u6210 $j$ \u4e2a\u975e\u7a7a\u96c6\u5408\u7684\u65b9\u6848\u6570\u3002\n\n\u9996\u5148\u6211\u60f3\u5410\u69fd\u4e00\u4e0b\uff0c\u8fd9\u771f\u7684\u4e0d\u662f\u968f\u624b\u5316\u5f0f\u5b50\u5316\u5230\u4e00\u534a\u51fa\u51fa\u6765\u7684\u9898\u5417\u2026\u2026\n\n$2$ \u7684\u6b21\u5e42\u662f\u53cb\u597d\u7684\uff0c\u4e3b\u8981\u662f\u628a\u8fd9\u4e2a\u65af\u7279\u6797\u6570\u7ed9\u5904\u7406\u6389\u3002\n\n\u5173\u4e8e\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\uff0c\u6709\u4e00\u4e2a\u4e3a\u5927\u5bb6\u6240\u719f\u77e5\u7684\u516c\u5f0f\uff1a\n$$\ni ^k = \\sum _{j = 0} ^k \\begin{Bmatrix} k \\\\ j \\end{Bmatrix} j! {i \\choose j}\n$$\n\u5176\u7ec4\u5408\u610f\u4e49\u76f8\u5f53\u4e8e $i$ \u4e2a\u76d2\u5b50 $k$ \u4e2a\u7403\u4efb\u653e\uff0c\u5de6\u8fb9\u663e\u7136\uff0c\u53f3\u8fb9\u679a\u4e3e\u6709 $j$ \u4e2a\u76d2\u5b50\u975e\u7a7a\u5e76\u5c06\u7403\u5206\u5230\u8fd9 $j$ \u4e2a\u76d2\u5b50\u91cc\u53bb\u3002\n\n\u6ce8\u610f\u53f3\u8fb9\u7684\u4e0a\u754c\u53ef\u4ee5\u6539\u5199\u6210 $i$\u3002\u8003\u8651\u82e5 $k$ \u4e3a\u4e00\u5b9a\u503c\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e8c\u9879\u5f0f\u53cd\u6f14\u5f97\u5230\uff1a\n$$\n\\begin{Bmatrix} k \\\\ j \\end{Bmatrix} j! = \\sum _{i = 0} ^j (-1) ^{j - i} {j \\choose i} i ^k\n$$\n\u628a\u8fd9\u4e2a\u5f0f\u5b50\u4ee3\u5165\u5230\u9898\u76ee\u6240\u7ed9\u7684\u5f0f\u5b50\u4e2d\uff08\u987a\u4fbf\u4fee\u6539 $j$ \u7684\u679a\u4e3e\u4e0a\u754c\u4e3a $n$\uff0c\u65af\u7279\u6797\u6570\u786e\u4fdd\u4e86\u6539\u53d8\u4e0a\u754c\u4e0d\u4f1a\u51fa\u9519\uff09\uff1a\n$$\n\\sum _{i = 0} ^n \\sum _{j = 0} ^n 2 ^j \\sum _{k = 0} ^j (-1) ^{j - k} {j \\choose k} k ^i\n$$\n\u770b\u4e0a\u53bb\u5f0f\u5b50\u53ea\u662f\u53d8\u7684\u66f4\u590d\u6742\u4e86\u2026\u2026\u5176\u5b9e\u4e0d\u7136\uff0c\u6ce8\u610f\u5230 $i$ \u7684\u679a\u4e3e\u53ef\u4ee5\u63d0\u5230\u540e\u9762\u53bb\uff1a\n$$\n\\sum _{j = 0} ^n 2 ^j \\sum _{k = 0} ^j (-1) ^{j - k} {j \\choose k} \\sum _{i = 0} ^n k ^i\n$$\n\u53d1\u73b0\u540e\u9762\u8fd9\u4e2a\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u662f\u975e\u5e38\u53cb\u597d\u7684\u3002\u4ee4 $a _k = \\sum \\limits _{i = 0} ^n k ^i$\uff0c\u4e0a\u5f0f\u5c31\u53d8\u6210\u4e86\u4e00\u4e2a\u6613\u4e8e\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u53ef\u4ee5\u505a\u5230 $O(n \\log n)$\u3002\n\n\u5b9e\u9645\u4e0a\u8fd8\u80fd\u505a\u5230\u66f4\u597d\u3002\u518d\u4ea4\u6362\u4e00\u4e0b\u548c\u5f0f\uff1a\n$$\n\\begin{aligned}\n& \\sum _{k = 0} ^n a _k \\sum _{j = k} ^n 2 ^j (-1) ^{j - k} {j \\choose k} \\\\\n=& \\sum _{k = 0} ^n a _k 2^k \\sum _{j = k} ^n (-2) ^{j - k} {j \\choose k}\n\\end{aligned}\n$$\n\u770b\u4e00\u4e0b\u540e\u9762\u7684\u90a3\u4e00\u5757\u600e\u4e48\u7b97\u3002\n\n\u4ee4\n$$\nb _j = \\sum _{i = j} ^n {i \\choose j} q ^{i - j}\n$$\n\u8003\u8651\u5982\u4f55\u5728\u7ebf\u6027\u65f6\u95f4\u5185\u6c42\u51fa $b$\u3002\n\n$b _0$ \u662f\u6613\u4e8e\u8ba1\u7b97\u7684\uff0c\u800c\u8003\u8651 $b _j$\uff1a\n$$\n\\begin{aligned}\nb _j &= \\sum _{i = j} ^n {i \\choose j} q ^{i - j} \\\\\n&= \\sum _{i = j} ^n {i - 1 \\choose j} q ^{i - j} + \\sum _{i = j} ^n {i - 1 \\choose j - 1} q ^{i - j}\n\\end{aligned}\n$$\n\u4e24\u90e8\u5206\u5206\u5f00\u8ba1\u7b97\u3002\n\n\u5de6\u90e8\u5206\uff1a\n$$\n\\begin{aligned}\n& \\sum _{i = j} ^n {i - 1 \\choose j} q ^{i - j} \\\\\n=& \\sum _{i = j - 1} ^{n - 1} {i \\choose j} q ^{i - j + 1} \\\\\n=& q \\sum _{i = j} ^{n - 1} {i \\choose j} q ^{i - j} \\\\\n=& q (a _j - {n \\choose j} q ^{n - j})\n\\end{aligned}\n$$\n\u53f3\u90e8\u5206\uff1a\n$$\n\\begin{aligned}\n& \\sum _{i = j} ^n {i - 1 \\choose j - 1} q ^{i - j} \\\\\n=& \\sum _{i = j - 1} ^{n - 1} {i \\choose j - 1} q ^{i - j + 1} \\\\\n=& \\sum _{i = j - 1} ^{n - 1} {i \\choose j - 1} q ^{i - (j - 1)} \\\\\n=& b _{j - 1} - {n \\choose j - 1} q ^{n - (j - 1)}\n\\end{aligned}\n$$\n\u6240\u4ee5\n$$\nb _j = qb _j - {n \\choose j} q ^{n - j + 1} + b _{j - 1} - {n \\choose j - 1} q ^{n - j + 1}\n$$\n\u4e8e\u662f\n$$\n(1 - q) b _j = b _{j - 1} - q ^{n - j + 1} \\left( {n \\choose j} +{n \\choose j - 1} \\right)\n$$\n\n\u9884\u5904\u7406\u597d\u7ec4\u5408\u6570\u548c $q$ \u7684\u5e42\u6b21\u5373\u53ef\u505a\u5230 $O(n)$ \u7684\u6c42\u51fa $b$\u3002\n\n\u6c42\u51fa $b$ \u4e4b\u540e\u539f\u5f0f\u4e5f\u6613\u4e8e\u5728 $O(n)$ \u5185\u6c42\u51fa\uff0c\u6545\u603b\u590d\u6742\u5ea6 $O(n)$\u3002\u6ce8\u610f\u6c42 $a _k$ \u65f6\u9700\u8981\u7ebf\u6027\u7b5b\u3002\n\n\u4e3a\u4e86\u907f\u514d\u5360\u7528\u8fc7\u5927\u7248\u5757\uff0c\u4ee3\u7801\u5c31\u4e0d\u653e\u4e86\u2026\u2026\u8981\u770b\u53bb loj \u641c\u6216\u8005\u53bb\u535a\u5ba2\u770b\u5427\u3002\n",
        "postTime": 1591314391,
        "uid": 91252,
        "name": "EndSaH",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "[\u5728\u535a\u5ba2\u67e5\u770b](https://www.cnblogs.com/chenxiaoran666/p/BZOJ4555.html)\n\n**\u5927\u81f4\u9898\u610f\uff1a** \u8ba1\u7b97$\\sum_{i=0}^n\\sum_{j=0}^iS(i,j)*2^j*(j!)$\uff0c\u5176\u4e2d$S$\u4e3a\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u3002\n\n------\n\n#### \u63a8\u5f0f\u5b50\n\n\u9996\u5148\u8ba9\u6211\u4eec\u6765\u63a8\u4e00\u6ce2\u5f0f\u5b50\uff1a\n\n\u56e0\u4e3a\u5f53$i<j$\u65f6\uff0c$S(i,j)=0$\uff0c\u6240\u4ee5\uff0c\u4e3a\u4e86\u65b9\u4fbf\u5f0f\u5b50\u7684\u5316\u7b80\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u5c06\u7b2c\u4e8c\u4e2a$\\sum$\u7684\u4e0a\u9650\u5168\u90e8\u6539\u6210$n$\uff0c\u5373\uff1a\n\n$$\\sum_{i=0}^n\\sum_{j=0}^nS(i,j)*2^j*(j!)$$\n\n\u8fd9\u6837\u4e00\u6765\uff0c$\\sum_{j=0}^n2^j*(j!)$\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u4e0e$i$\u65e0\u5173\uff0c\u5219\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u63d0\u524d\uff1a\n\n$$\\sum_{j=0}^n2^j*(j!)\\sum_{i=0}^nS(i,j)$$\n\n\u5957\u7528\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u7684\u901a\u9879\u516c\u5f0f$S(n,m)=\\sum_{i=0}^m\\frac{(-1)^i*(m-i)^n}{i!(m-i)!}$\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$\\sum_{j=0}^n2^j*(j!)\\sum_{i=0}^n\\sum_{k=0}^j\\frac{(-1)^k*(j-k)^i}{k!(j-k)!}$$\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u518d\u5c06\u6240\u6709\u4e0e$i$\u65e0\u5173\u7684\u9879\u63d0\u524d\uff0c\u5f97\u5230\u4e0b\u9762\u8fd9\u4e2a\u5f0f\u5b50\uff1a\n\n$$\\sum_{j=0}^n2^j*(j!)\\sum_{k=0}^j\\frac{(-1)^k}{k!(j-k)!}*\\sum_{i=0}^n(j-k)^i$$\n\n\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e$j$\uff0c\u8fd9\u6837\u524d\u9762\u7684$\\sum_{j=0}^n2^j*(j!)$\u4e00\u9879\u5c31\u53ef\u4ee5\u8f7b\u677e\u641e\u5b9a\u3002\n\n\u90a3\u4e48\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u5c31\u662f\u5982\u4f55\u5bf9\u4e8e\u7ed9\u5b9a\u7684$j$\uff0c\u6c42\u51fa\u4e0b\u9762\u8fd9\u4e2a\u5f0f\u5b50\u7684\u503c\uff1a\n\n$$\\sum_{k=0}^j\\frac{(-1)^k}{k!(j-k)!}*\\sum_{i=0}^n(j-k)^i$$\n\n\u4ed4\u7ec6\u89c2\u5bdf\uff0c\u53ef\u4ee5\u53d1\u73b0\u4f3c\u4e4e\u8fd9\u4e2a\u5f0f\u5b50\u524d\u534a\u90e8\u5206\u7684\u5206\u6bcd\u548c\u540e\u534a\u90e8\u5206\u90fd\u6709$(j-k)$\u8fd9\u4e2a\u56e0\u5f0f\uff0c\u5219\u5bb9\u6613\u60f3\u5230\u5c06\u5b83\u4eec\u79fb\u5230\u4e00\u8d77\uff0c\u5373\uff1a\n\n$$\\sum_{k=0}^j\\frac{(-1)^k}{k!}*\\sum_{i=0}^n\\frac{(j-k)^i}{(j-k)!}$$\n\n\u8fd9\u6837\u4e00\u79fb\u7684\u6548\u679c\u662f\u663e\u8457\u7684\uff0c\u56e0\u4e3a\u6b64\u65f6\u8fd9\u4e2a\u5f0f\u5b50\u7684\u524d\u534a\u90e8\u5206\u53ea\u4e0e$k$\u6709\u5173\uff0c\u540e\u534a\u90e8\u5206\u53ea\u4e0e$(j-k)$\u6709\u5173\u3002\n\n\u5219\u53ef\u4ee5\u8bbe$f$\u548c$g$\u5982\u4e0b\uff1a\n\n$$f_x=\\frac{(-1)^x}{x!}$$\n\n$$g_x=\\sum_{i=0}^n\\frac{x^i}{x!}=\\frac{\\sum_{i=0}^nx^i}{x!}=\\frac{\\frac{x^{n+1}-1}{x-1}}{x!}=\\frac{x^{n+1}-1}{(x-1)x!}$$\n\n\u5e26\u5165\u539f\u5f0f\u5c31\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$\\sum_{k=0}^jf_{k}*g_{j-k}$$\n\n\u800c\u8fd9\u4e2a\u5f0f\u5b50\u5b9e\u9645\u4e0a\u5c31\u76f8\u5f53\u4e8e\uff1a\n\n$$(f*g)(j)$$\n\n\u81f3\u6b64\u5316\u7b80\u5b8c\u6bd5\uff0c\u6700\u7ec8\u7684\u5f0f\u5b50\u5c31\u662f\uff1a\n\n$$\\sum_{j=0}^n2^j*(j!)*(f*g)(j)$$\n\n------\n\n#### \u5177\u4f53\u5b9e\u73b0\n\n\u6211\u4eec\u53ef\u4ee5\u5148$O(n)$\uff08$O(nlogn)$\uff1f\uff09\u9884\u5904\u7406\u51fa$f$\u548c$g$\u4e24\u4e2a\u6570\u7ec4\uff0c\u7136\u540e$NTT$\u5373\u53ef\u3002\n\n\u8fd9\u5e94\u8be5\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u5427\u3002\n\n------\n\n#### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define Tp template<typename Ty>\n#define Ts template<typename Ty,typename... Ar>\n#define Reg register\n#define RI Reg int\n#define Con const\n#define CI Con int&\n#define I inline\n#define W while\n#define N 100000\n#define X 998244353\n#define Qinv(x) (Qpow(x,X-2))\n#define swap(x,y) (x^=y^=x^=y)\n#define Inc(x,y) ((x+=(y))>=X&&(x-=X))\n#define XSum(x,y) ((x)+(y)>=X?(x)+(y)-X:(x)+(y))\n#define XSub(x,y) ((x)-(y)<0?(x)-(y)+X:(x)-(y))\nusing namespace std;\nint n,a[(N<<2)+5],b[(N<<2)+5],Fac[N+5],Inv[N+5];\nI int Qpow(RI x,RI y) {RI res=1;W(y) y&1&&(res=1LL*res*x%X),x=1LL*x*x%X,y>>=1;return res;}\nclass NTT//NTT\u6c42\u6a21\u610f\u4e49\u4e0b\u7684\u5377\u79ef\n{\n    private:\n        static const int SZ=N,PR=3,IP=(X+1)/3;int P,L,R[(SZ<<2)+5];\n        I void Transform(int* s,CI op)\n        {\n            RI i,j,k,U,S,tx,ty;for(i=0;i^P;++i) i<R[i]&&swap(s[i],s[R[i]]);\n            for(i=1;i^P;i<<=1) for(U=Qpow(~op?PR:IP,(X-1)/(i<<1)),j=0;j^P;j+=(i<<1))\n                for(S=1,k=0;k^i;++k,S=1LL*S*U%X) tx=s[j+k],ty=1LL*S*s[i+j+k]%X,s[j+k]=XSum(tx,ty),s[i+j+k]=XSub(tx,ty);\n        }\n    public:\n        I void Solve(CI n,CI m,int* a,int* b)\n        {\n            RI i,t;P=1,L=0,memset(R,0,sizeof(R));\n            W(P<=n+m) P<<=1,++L;for(i=0;i^P;++i) R[i]=(R[i>>1]>>1)|((i&1)<<L-1);\n            for(Transform(a,1),Transform(b,1),i=0;i^P;++i) a[i]=1LL*a[i]*b[i]%X;\n            for(Transform(a,-1),t=Qinv(P),i=0;i<=n+m;++i) a[i]=1LL*a[i]*t%X;\n        }\n}NTT;\nint main()\n{\n    RI i,t,ans=0;for(scanf(\"%d\",&n),Fac[0]=1,i=1;i<=n;++i) Fac[i]=1LL*Fac[i-1]*i%X;//\u9884\u5904\u7406\u9636\u4e58\n    for(Inv[n]=Qpow(Fac[n],X-2),i=n-1;~i;--i) Inv[i]=1LL*Inv[i+1]*(i+1)%X;//\u9884\u5904\u7406\u9636\u4e58\u7684\u9006\u5143\n    for(t=1,i=0;i<=n;++i,t=1LL*t*(X-1)%X) a[i]=1LL*t*Inv[i]%X;//\u9884\u5904\u7406\u7b2c\u4e00\u4e2a\u6570\u7ec4\n    for(b[0]=1,b[1]=n+1,i=2;i<=n;++i) b[i]=1LL*(Qpow(i,n+1)-1)*Qinv(i-1)%X*Inv[i]%X;//\u9884\u5904\u7406\u7b2c\u4e8c\u4e2a\u6570\u7ec4\n    for(NTT.Solve(n,n,a,b),t=1,i=0;i<=n;++i,(t<<=1)>=X&&(t-=X)) Inc(ans,1LL*a[i]*t%X*Fac[i]%X);//\u505a\u4e00\u904dNTT\uff0c\u7136\u540e\u7edf\u8ba1\u7b54\u6848\n    return printf(\"%d\",ans),0;//\u8f93\u51fa\u7b54\u6848\n}\n```",
        "postTime": 1551674602,
        "uid": 28382,
        "name": "TheLostWeak",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "\u8fd9\u9898\u6211\u7adf\u7136\u81ea\u5df1\u63a8\u51fa\u6765\u4e86\uff01incredible\uff01\n\n\u9996\u5148\u4f60\u8981\u4e86\u89e3 $S(n,k)$ \u7684\u542b\u4e49\uff0c$S(n,k)$\uff0c\u5373\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\uff0c\u8868\u793a\u5c06 $n$ \u4e2a**\u4e0d\u540c\u7684\u7403**\u653e\u5165 $k$ \u4e2a**\u76f8\u540c\u7684\u76d2\u5b50**\u4e2d\uff0c\u4e14\u4e0d\u5141\u8bb8\u6709\u7a7a\u76d2\u7684\u65b9\u6848\u6570\u3002\n\n\u90a3\u4e48 $S(n,k)$ \u6709\u9012\u63a8\u5f0f $S(n,k)=S(n-1,k-1)+S(n-1,k)\\times k$\u3002\u8003\u8651\u6700\u540e\u4e00\u4e2a\u7403\u600e\u4e48\u653e\u3002\u5982\u679c\u5b83\u5355\u72ec\u653e\u5728\u4e00\u4e2a\u76d2\u5b50\u4e2d\uff0c\u90a3\u4e48\u65b9\u6848\u6570\u5c31\u662f $S(n-1,k-1)$\uff0c\u5982\u679c\u5b83\u4e0e\u5176\u5b83\u67d0\u4e9b\u7403\u653e\u5728\u540c\u4e00\u4e2a\u76d2\u5b50\u4e2d\uff0c\u90a3\u4e48\u76f8\u5f53\u4e8e\u5c06 $n-1$ \u4e2a\u7403\u653e\u5165 $k$ \u4e2a\u76d2\u5b50\u4e2d\uff0c\u65b9\u6848\u6570\u4e3a $S(n-1,k)\\times k$\uff0c\u5c06\u4e8c\u8005\u4e00\u52a0\u5373\u53ef\u5f97\u5230\u7b2c\u4e8c\u7c7b stirling \u6570\u7684\u9012\u63a8\u5f0f\u3002\n\n$S(n,k)$ \u7684\u901a\u9879\u516c\u5f0f\uff1a$S(n,k)=\\dfrac{1}{k!}\\sum\\limits_{i=0}^ki^n\\times\\dbinom{k}{i}\\times(-1)^{k-i}$\u3002\n\n\u8003\u8651\u600e\u6837\u8bc1\u660e\u8fd9\u4e2a\u516c\u5f0f\uff1a\n\n\u4ee4 $b_k=k^n=\\sum\\limits_{i=0}^k\\dbinom{k}{i}\\times S(n,i)\\times i!$\uff0c\u5373\u5c06 $n$ \u4e2a\u7403\u653e\u5165 $k$ \u4e2a**\u4e0d\u540c\u7684**\u76d2\u5b50\uff0c\u5bf9\u662f\u5426\u6709\u7a7a\u76d2\u4e5f\u4e0d\u505a\u8981\u6c42\u7684\u65b9\u6848\u6570\uff0c\u663e\u7136 $b_k$ \u5c31\u662f $k^n$\uff0c\u5373\u6bcf\u4e2a\u7403\u90fd\u968f\u4fbf\u653e\u5165\u4e00\u4e2a\u76d2\u5b50\u7684\u65b9\u6848\u6570\u4e58\u5728\u4e00\u8d77\u3002\n\n\u800c $b_k=\\sum\\limits_{i=0}^k\\dbinom{k}{i}\\times (-1)^i\\times S(n,i)\\times i!\\times (-1)^i$\uff08\u5c06 $1$ \u62c6\u6210 $(-1)^i\\times (-1)^i$\uff09\n\n\u518d\u4ee4 $a_k=S(n,k)\\times k!\\times (-1)^k$\u3002\n\n\u7531\u4e8c\u9879\u5f0f\u53cd\u6f14\u53ef\u5f97\uff1a\n\n$\\because b_k=\\sum\\limits_{i=0}^k(-1)^i\\dbinom{k}{i}a_i$\n\n$\\therefore a_k=\\sum\\limits_{i=0}^k(-1)^i\\dbinom{k}{i}b_i$\n\n\u5373 $S(n,k)\\times k!\\times (-1)^k=\\sum\\limits_{i=0}^k(-1)^i\\dbinom{k}{i}i^n$\n\n\u6545 $S(n,k)=\\dfrac{1}{k!}\\sum\\limits_{i=0}^ki^n\\times\\dbinom{k}{i}\\times(-1)^{k-i}$\n\n\u77e5\u9053\u4e86\u8fd9\u4e2a\u516c\u5f0f\u4e4b\u540e\uff0c\u628a\u5b83\u4ee3\u5165\u9898\u76ee\u8981\u6c42\u7684\u5f0f\u5b50\uff0c\u53ef\u5f97\n\n$ans=\\sum\\limits_{i=0}^n\\sum\\limits_{j=0}^i2^j\\times j!\\times \\dfrac{1}{j!}\\sum\\limits_{k=0}^jk^i\\times\\dbinom{j}{k}\\times (-1)^{j-k}$\n\n\u7531\u4e8e\u5f53 $j>i$ \u65f6 $S(i,j)=0$\uff0c\u6545 $\\sum\\limits_{j=0}^i$ \u53ef\u76f4\u63a5\u6539\u4e3a $\\sum\\limits_{j=0}^n$\uff0c\u8fdb\u800c\u53c8\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$ans=\\sum\\limits_{i=0}^n\\sum\\limits_{j=0}^n2^j\\sum\\limits_{k=0}^jk^i\\times\\dbinom{j}{k}\\times (-1)^{j-k}$\n\n\u62c6\u7ec4\u5408\u6570\u53ef\u5f97\uff1a\n\n$ans=\\sum\\limits_{i=0}^n\\sum\\limits_{j=0}^n2^j\\sum\\limits_{k=0}^jk^i\\times\\dfrac{j!}{k!(j-k)!}\\times (-1)^{j-k}$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u91cc\u7684 $i$ \u53ea\u5728 $k^i$ \u4e2d\u51fa\u73b0\u8fc7\uff0c\u6545\u8f6c\u5316\u679a\u4e3e\u987a\u5e8f\uff0c\u5148\u679a\u4e3e $j,k$ \u518d\u679a\u4e3e $i$\uff1a\n\n$ans=\\sum\\limits_{j=0}^n2^j\\sum\\limits_{k=0}^j(\\sum\\limits_{i=0}^nk^i)\\times\\dfrac{j!}{k!(j-k)!}\\times (-1)^{j-k}$\n\n\u663e\u7136 $(\\sum\\limits_{i=0}^nk^i)$ \u53ef\u4ee5\u7528\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f $\\mathcal O(\\log n)$ \u5730\u7b97\u51fa\uff0c\u8bb0\u5176\u4e3a $c_k$\u3002\n\n$ans=\\sum\\limits_{j=0}^n2^j\\sum\\limits_{k=0}^jc_k\\times\\dfrac{j!}{k!(j-k)!}\\times (-1)^{j-k}$\n\n\u770b\u5230\u4e86\u6211\u4eec\u5f88\u559c\u6b22\u7684 $k$ \u4e0e $j-k$\uff0c\u6545\u8003\u8651\u5c06\u5e26 $k$ \u7684\u5408\u5e76\uff0c\u5e26 $j-k$ \u7684\u5408\u5e76\uff0c\u4e0e $k$ \u65e0\u5173\u7684\u4e22\u5230\u5916\u9762\uff0c\u53c8\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$ans=\\sum\\limits_{j=0}^n2^j\\times j!\\times\\sum\\limits_{k=0}^j(c_k\\times\\dfrac{1}{k!})\\times (\\dfrac{1}{(j-k)!}\\times(-1)^{j-k})$\n\n\u4ee4 $a_k=c_k\\times\\dfrac{1}{k!},b_k=\\dfrac{1}{k!}\\times (-1)^k$\uff0c\u5219\n\n$ans=\\sum\\limits_{j=0}^n2^j\\times j!\\times\\sum\\limits_{k=0}^ja_kb_{j-k}$\n\n\u662f\u4e0d\u662f\u611f\u89c9\u540e\u9762\u90a3\u4fe9\u73a9\u610f\u513f\u53ef\u4ee5\u5377\uff1f\u5bf9 $a$ \u548c $b$ \u6c42\u4e2a\u591a\u9879\u5f0f\u5377\u79ef $h$\uff0c\u7136\u540e $ans=\\sum\\limits_{j=0}^n2^j\\times j!\\times h_j$\u3002\n\n\u7136\u540e\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u6ce8\u610f\uff0c\u5f53 $k=0,1$ \u65f6\u5019 $c_k$ \u9700\u8fdb\u884c\u7279\u5224\u3002\u663e\u7136 $c_1=n+1$\uff0c\u4f46\u662f $c_0$ \u7684\u503c\u9700\u8981\u7279\u522b\u6ce8\u610f\u3002\u6211\u4e00\u76f4\u628a\u5b83\u5f53 $0$ \u7b97\uff0c\u7ed3\u679c\u5c31\u603b WA\u3002\u5176\u5b9e\u4f60\u4ee3\u5165\u7279\u6b8a\u503c $n=0$ \u53ef\u624b\u7b97\u5f97 $ans=1$\uff0c\u800c\u5c06 $n=0$ \u4ee3\u5165\u4e0a\u5f0f\u53ef\u5f97 $ans=c_0$\uff0c\u6545 $c_0=1$\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fz(i,a,b) for(int i=a;i<=b;i++)\n#define fd(i,a,b) for(int i=a;i>=b;i--)\n#define ffe(it,v) for(__typeof(v.begin()) it=v.begin();it!=v.end();it++)\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntemplate<typename T1,typename T2> void chkmin(T1 &x,T2 y){if(x>y) x=y;}\ntemplate<typename T1,typename T2> void chkmax(T1 &x,T2 y){if(x<y) x=y;}\ntypedef pair<int,int> pii;\ntypedef long long ll;\ntemplate<typename T> void read(T &x){\n\tx=0;char c=getchar();T neg=1;\n\twhile(!isdigit(c)){if(c=='-') neg=-1;c=getchar();}\n\twhile(isdigit(c)) x=x*10+c-'0',c=getchar();\n\tx*=neg;\n}\nconst int pr=3;\nconst int MOD=998244353;\nconst int MAXN=1e5;\nconst int MAXP=1<<18;\nint qpow(int x,int e){int ret=1;for(;e;e>>=1,x=1ll*x*x%MOD) if(e&1) ret=1ll*ret*x%MOD;return ret;}\nint n,pw[MAXN+5],f[MAXN+5],ff[MAXN+5];\nint calc(int x,int y){return 1ll*f[x]*ff[y]%MOD*ff[x-y]%MOD;}\nint LEN=1,LOG=0,ipr,inv[MAXP+5],prs[MAXP+5][2],rev[MAXP+5];\nint A[MAXP+5],B[MAXP+5],C[MAXP+5];\nvoid NTT(int *a,int len,int type){\n\tint lg=log2(len);\n\tfor(int i=0;i<len;i++) rev[i]=(rev[i>>1]>>1)|((i&1)<<(lg-1));\n\tfor(int i=0;i<len;i++) if(i<rev[i]) swap(a[i],a[rev[i]]);\n\tfor(int i=2;i<=len;i<<=1){\n\t\tint W=prs[i][type<0];\n\t\tfor(int j=0;j<len;j+=i){\n\t\t\tint w=1;\n\t\t\tfor(int k=0;k<(i>>1);k++,w=1ll*w*W%MOD){\n\t\t\t\tint X=a[j+k],Y=1ll*w*a[(i>>1)+j+k]%MOD;\n\t\t\t\ta[j+k]=(X+Y)%MOD;a[(i>>1)+j+k]=(X-Y+MOD)%MOD;\n\t\t\t}\n\t\t}\n\t}\n\tif(type==-1) for(int i=0;i<len;i++) a[i]=1ll*a[i]*inv[len]%MOD;\n}\nint main(){\n\tscanf(\"%d\",&n);ipr=qpow(pr,MOD-2);\n\tf[0]=1;for(int i=1;i<=n;i++) f[i]=1ll*f[i-1]*i%MOD;\n\tff[n]=qpow(f[n],MOD-2);for(int i=n-1;~i;i--) ff[i]=1ll*ff[i+1]*(i+1)%MOD;\n\tpw[0]=1;for(int i=1;i<=n;i++) pw[i]=pw[i-1]*2%MOD;\n\twhile(LEN<=n+n) LEN<<=1,LOG++;\n\tfor(int i=1;i<=LEN;i<<=1){\n\t\tinv[i]=qpow(i,MOD-2);\n\t\tprs[i][0]=qpow(pr,(MOD-1)/i);\n\t\tprs[i][1]=qpow(ipr,(MOD-1)/i);\n\t}\n\tA[0]=1;A[1]=n+1;\n\tfor(int i=2;i<=n;i++) A[i]=1ll*(qpow(i,n+1)-1+MOD)*qpow(i-1,MOD-2)%MOD*ff[i]%MOD;\n\tfor(int i=0;i<=n;i++){if(i&1) B[i]=MOD-ff[i];else B[i]=ff[i];}\n\tNTT(A,LEN,1);NTT(B,LEN,1);\n\tfor(int i=0;i<LEN;i++) C[i]=1ll*A[i]*B[i]%MOD;\n\tNTT(C,LEN,-1);int ans=0;\n\tfor(int i=0;i<=n;i++) ans=(ans+1ll*C[i]*pw[i]%MOD*f[i]%MOD)%MOD;\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1609854599,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "\u539f\u9898\uff1a[luogu4091](https://www.luogu.com.cn/problem/P4091)\n\n\u6c42\uff1a\n$\\sum\\limits_{i=0}^{n}{\\sum\\limits_{j=0}^{i}{S(i,j)\\times 2^j \\times (j!)}}$\n\n\u5176\u5b9e\u8981\u6c42\u7684\u5f0f\u5b50\u5373\n$\\sum\\limits_{i=0}^{n}{[\\frac{y^i}{i!}]\\frac{1}{1-2(e^y-1)}}$=$\\sum\\limits_{i=0}^{n}{i!\\times[y^i]\\frac{1}{3-2e^y}}$\n\n\u8bc1\u660e\uff1a\n\n\u5728$\\sum\\limits_{n}{S(m,n)n!x^n}$ \u4e2d\u5bf9$m$\u53d6$egf$\u5f97\n\n  $\\sum\\limits_{n}{x^nn!}\\sum\\limits_{m}{S(m,n)\\frac{y^m}{m!}}$=$\\sum\\limits_{n}{x^nn!\\frac{(e^y-1)^n}{n!}}$=$\\frac{1}{1-x(e^y-1)}$\n\n\u800c\u539f\u9898\u4e2d$x=2$\uff0c\u5f97\u8bc1\n\n\u4e8e\u662f\u6c42\u51famod($y^{n+1}$)\u610f\u4e49\u4e0b\u7684$\\frac{1}{3-2e^y}$ , \u518d\u5982\u4e0a\u5904\u7406\u5373\u53ef\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(nlogn)$\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=1e6+10;\nconst int mod=998244353;\nint n,n1,g,ans;\nint a[N],b[N],tmp[N];\nint rev[N];\nint inv[N];\nint frac[N];\nint ifrac[N];\nint qpow(int x,int k){\n\tint cnt=1;\n\twhile(k){\n\t\tif(k&1)cnt=(cnt*x)%mod;\n\t\tx=(x*x)%mod;\n\t\tk>>=1;\n\t}\n\treturn cnt;\n}\nvoid ntt(int n,int *a,int t){\n\tfor(int i=0;i<n;i++)if(i<rev[i])swap(a[i],a[rev[i]]);\n\tif(t==1)g=3;\n\telse g=332748118;\n\tfor(int mid=1;mid<n;mid<<=1){\n\t\tint wn=qpow(g,(mod-1)/(mid<<1));\n\t\tfor(int j=0;j<n;j+=(mid<<1)){\n\t\t\tint w=1;\n\t\t\tfor(int k=0;k<mid;k++){\n\t\t\t\tint x=a[j+k],y=w*a[j+k+mid]%mod;\n\t\t\t\ta[j+k]=(x+y)%mod;\n\t\t\t\ta[j+k+mid]=(x-y+mod)%mod;\n\t\t\t\tw=w*wn%mod;\n\t\t\t}\n\t\t}\n\t}\n\tif(t==1)return;\n\tint invn=qpow(n,mod-2);\n\tfor(int i=0;i<n;i++)a[i]=a[i]*invn%mod;\n}\nvoid work(int n,int *f,int *g){\n\tif(n==1){\n\t\tg[0]=qpow(f[0],mod-2);\n\t\treturn;\n\t}\n\twork((n+1)>>1,f,g);\n\tint n1=1,len=0;\n\twhile(n1<(n<<1))n1<<=1,len++;\n\tfor(int i=0;i<n1;i++)rev[i]=(rev[i>>1]>>1)|((i&1)<<(len-1));\n\tfor(int i=0;i<n;i++)tmp[i]=f[i];\n\tfor(int i=n;i<n1;i++)tmp[i]=0;\n\tntt(n1,tmp,1);\n\tntt(n1,g,1);\n\tfor(int i=0;i<n1;i++)g[i]=(2ll-tmp[i]*g[i]%mod+mod)%mod*g[i]%mod;\n\tntt(n1,g,-1);\n\tfor(int i=n;i<n1;i++)g[i]=0;\n}\nsigned main(){\n\tscanf(\"%d\",&n);\n\tinv[1]=1;\n\tfor(int i=2;i<=n;i++)inv[i]=(mod-mod/i)*inv[mod%i]%mod;\n\tfrac[0]=ifrac[0]=1;\n\tfor(int i=1;i<=n;i++)frac[i]=frac[i-1]*i%mod,ifrac[i]=ifrac[i-1]*inv[i]%mod;\n\ta[0]++;\n\tfor(int i=1;i<=n;i++)a[i]=mod-2*ifrac[i]%mod;\n\twork(n+1,a,b);\n\tfor(int i=0;i<=n;i++)ans=(ans+b[i]*frac[i]%mod)%mod;\n\tprintf(\"%d\",ans);\n}\n```",
        "postTime": 1610188851,
        "uid": 334380,
        "name": "Y_B_X",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "\u6392\u884c\u7b2c\u4e00\u7684\u9898\u89e3\u611f\u89c9\u6709\u70b9\u9505\u554a  \n\u6c42\n$$\\sum_{i=0}^{n}\\sum_{j=0}^{n}S(i,j)\\times2^j\\times(j!)$$\nemmm\uff0c\u663e\u7136\u540e\u9762\u4e24\u4e2a\u53ea\u5e26j\u7684\u8ddfi\u6ca1\u5565\u5173\u7cfb\uff0c\u6254\u5230\u524d\u9762\u53bb\n$$\\sum_{j=0}^{n}2^j\\times(j!)\\sum_{i=0}^{n}S(i,j)$$\n\u6839\u636e\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u7684\u901a\u9879\u516c\u5f0f\n$$S(i,j)=\\frac{1}{j!}\\sum_{k=0}^{j}(-1)^k{j\\choose k}(j-k)^i$$\n\u5c55\u5f00\u540e\u9762\u7684\n$$\\sum_{j=0}^{n}2^j\\times(j!)\\sum_{i=0}^{n}S(i,j)$$\n$$=\\sum_{j=0}^{n}2^j\\times(j!)\\sum_{i=0}^{n}\\frac{1}{j!}\\sum_{k=0}^{j}(-1)^k{j\\choose k}(j-k)^i$$\n$$=\\sum_{j=0}^{n}2^j\\times(j!)\\sum_{i=0}^{n}\\frac{1}{j!}\\sum_{k=0}^{j}(-1)^k\\frac{j!}{k!(j-k)!}(j-k)^i$$\n$$=\\sum_{j=0}^{n}2^j\\times(j!)\\sum_{i=0}^{n}\\sum_{k=0}^{j}(-1)^k\\frac{1}{k!(j-k)!}(j-k)^i$$\n$$=\\sum_{j=0}^{n}2^j\\times(j!)\\sum_{i=0}^{n}\\sum_{k=0}^{j}\\frac{(-1)^k}{k!}\\frac{(j-k)^i}{(j-k)!}$$\n\u53d1\u73b0\u53c8\u6709\u548c\u53ea\u5e26k\u548ci\u6ca1\u5565\u5173\u7cfb\u7684\u5f0f\u5b50\u4e86\uff0c\u63d0\u51fa\u6765\n$$=\\sum_{j=0}^{n}2^j\\times(j!)\\sum_{k=0}^{j}\\frac{(-1)^k}{k!}\\frac{\\sum_{i=0}^{n}(j-k)^i}{(j-k)!}$$\n\u540e\u9762\u90a3\u4e1c\u897f\u6709\u70b9\u50cf\u5377\u79ef\u554a\uff0c\u770b\u770b\u5377\u54ea\u4e24\u4e2a\u51fd\u6570\u5427\n$$f(i)=\\frac{(-1)^i}{i!}$$\n$$g(i)=\\frac{\\sum_{j=0}^{n}i^j}{i!}=\\frac{i^{(n+1)}-1}{(i-1)i!}$$\n\u8fd9\u4e24\u4e2a\u90fd\u662f\u53ef\u4ee5\u5728\u5408\u6cd5\u590d\u6742\u5ea6\u5185\u9012\u63a8\u7684\uff0c\u90a3\u4e48\u76f4\u63a5NTT\u5c31\u53ef\u4ee5\u5566  \n\u7136\u540e\u6839\u636eg\u7684\u7b2c\u4e00\u4e2a\u5f0f\u5b50  \n$g(0)=\\frac{1}{1}=1$  \n$g(1)=\\frac{n+1}{1}=n+1$\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define mod 998244353\n#define g 3\nusing namespace std;\n\nlong long fac[400030],inv[400030],x[400030],y[400030],m2[400030];\nint n,lim=1,r[400030],cnt;\n\nlong long kasumi(long long a,long long b)\n{\n\tlong long ans=1;\n\twhile(b)\n\t{\n\t\tif(b&1) ans=ans*a%mod;\n\t\ta=a*a%mod;\n\t\tb>>=1;\n\t}\n\treturn ans;\n}\n\nvoid init()\n{\n\tfac[0]=1;\n\tfor(int i=1;i<=150000;i++)\n\t{\n\t\tfac[i]=fac[i-1]*i%mod;\n\t}\n\tinv[150000]=kasumi(fac[150000],mod-2);\n\tfor(int i=149999;i>=0;i--)\n\t{\n\t\tinv[i]=inv[i+1]*(i+1)%mod;\n\t}\n}\n\nlong long NTT(long long *a,long long kd)\n{\n\tfor(long long i=0;i<lim;i++)\n\t{\n\t\tif(i<r[i])\n\t\t{\n\t\t\tswap(a[i],a[r[i]]);\n\t\t}\n\t}\n\tfor(int mid=1;mid<lim;mid<<=1)\n\t{\n\t\tlong long wn=kasumi(g,(mod-1)/(mid<<1));\n\t\tif(kd) wn=kasumi(wn,mod-2);\n\t\tfor(int i=0;i<lim;i+=mid*2)\n\t\t{\n\t\t\tlong long w=1;\n\t\t\tfor(int j=0;j<mid;j++,w=w*wn%mod)\n\t\t\t{\n\t\t\t\tlong long gg1=a[i+j];\n\t\t\t\tlong long gg2=a[i+j+mid];\n\t\t\t\ta[i+j]=(gg1+gg2*w%mod)%mod;\n\t\t\t\ta[i+j+mid]=(gg1-gg2*w%mod+mod)%mod;\n\t\t\t}\n\t\t}\n\t}\n\tif(kd)\n\t{\n\t\tlong long invl=kasumi(lim,mod-2);\n\t\tfor(long long i=0;i<lim;i++)\n\t\t{\n\t\t\ta[i]=a[i]*invl%mod;\n\t\t}\n\t}\n}\n\nint main()\n{\n\tinit();\n\tscanf(\"%d\",&n);\n\twhile(lim<=2*n) lim<<=1,cnt++;\n\tfor(int i=0;i<lim;i++)\n\t{\n\t\tr[i]=(r[i>>1]>>1)|((i&1)<<(cnt-1));\n\t}\n\tx[0]=1;x[1]=(-inv[1]+mod)%mod;\n\ty[0]=1;y[1]=n+1;\n\tm2[0]=1;m2[1]=2;\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tx[i]=(i&1)?-inv[i]:inv[i];\n\t\tx[i]=(x[i]+mod)%mod;\n\t\ty[i]=(kasumi(i,n+1)-1+mod)*kasumi(i-1,mod-2)%mod*inv[i]%mod;\n\t\tm2[i]=m2[i-1]*2%mod;\n\t}\n\tNTT(x,0);\n\tNTT(y,0);\n\tfor(int i=0;i<lim;i++)\n\t{\n\t\tx[i]=x[i]*y[i]%mod;\n\t}\n\tNTT(x,1);\n\tlong long ans=0;\n\tfor(int i=0;i<=n;i++)\n\t{\n\t\tans+=m2[i]*fac[i]%mod*x[i]%mod;\n\t\tans%=mod;\n\t}\n\tprintf(\"%lld\\n\",ans);\n}\n```\n",
        "postTime": 1551696019,
        "uid": 185441,
        "name": "\u30cb\u30d2\u30eb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "\u5982\u679c\u4f60\u4e0d\u77e5\u5230\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\uff0c\u53ef\u4ee5\u770b\u770b\u6211\u7684[\u7ec4\u5408\u6570\u5b66\u7684\u4e00\u4e9b\u5c0f\u77e5\u8bc6\u603b\u7ed3](https://www.luogu.org/blog/wohaocaia/zu-ge-shuo-xue-di-yi-suo-xiao-zhi-shi-zong-jie-wei-wan-post)\u624d\u521a\u5f00\u59cb\u5199\uff0c\u672a\u5b8c\u5f85\u7eed\uff0c\u5927\u4f6c\u8f7b\u55b7\u3002\n\n\u8fd9\u9053\u9898\u6c42\n\n## $\\sum_{i=0}^n\\sum_{j=0}^iS_i^j2^jj!\\mod 998244353$\n\n\u53cd\u6b63$i<j$\u7684\u65f6\u5019$S_i^j=0,$\u4e8e\u662f\u5462\uff0c\u7528\u5957\u8def\u628a\u4e1c\u897f\u62c9\u5230\u4e00\u8fb9\n\n$$=\\sum_{i=0}^n\\sum_{j=0}^nS_i^j2^jj!$$\n\n\u6ca1\u6709\u4f9d\u8d56\u6027\uff0c\u76f4\u63a5\u66ff\u6362\u679a\u4e3e\u65b9\u5f0f\n\n$$=\\sum_{j=0}^n\\sum_{i=0}^nS_i^j2^jj!$$\n\n\u76f4\u63a5\u63d0\u51fa\u6765\n\n$$=\\sum_{j=0}^n2^jj!\\sum_{i=0}^nS_i^j$$\n\n\u6839\u636e\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u7684\u901a\u9879\u516c\u5f0f\uff08\u535a\u5ba2\u91cc\u6709\u8bc1\u660e\uff09\n\n\u6709$S_i^j=\\sum_ {k=0}^j \\frac {(-1)^{k}\\times (j-k)^i}{k!\\times (j-k)!}$\n\n\u4ee3\u5165\n$$=\\sum_{j=0}^n2^jj!\\sum_{i=0}^n\\sum_ {k=0}^j \\frac {(-1)^{k}\\times (j-k)^i}{k!\\times (j-k)!}$$\n\n\u53d1\u73b0\u679a\u4e3e$i$\u7684\u90e8\u5206\u53ef\u4ee5\u63d0\u4e0a\u53bb\n\n$$=\\sum_{j=0}^n2^jj!\\sum_ {k=0}^j \\frac {(-1)^{k}\\times \\sum_{i=0}^n(j-k)^i}{k!\\times (j-k)!}$$\n\n\u6ca1\u6709\u4efb\u4f55\u8054\u7cfb\uff0c\u53ef\u4ee5\u5206\u5f00\u8ba1\u7b97\n\n$$=\\sum_{j=0}^n2^jj!(\\sum_ {k=0}^j \\frac {(-1)^{k}}{k!}\\times \\frac{\\sum_{i=0}^n(j-k)^i}{(j-k)!})$$\n\n\n\u540e\u9762\u6bd4\u8f83\u6bd2\u7624\n\n\u8bbe\n$$f(k)=\\frac{(-1)^k}{k!},g(k)=\\frac{\\sum_{i=0}^n(k)^i}{k!}=[\\frac{k^{n+1}-1}{k!(k-1)}]$$\n\n\u4e0a\u9762\u7528\u5230\u4e86\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0fqwq\n\n\u6c42$f(k)$\u628a$k!$\u9006\u5143\u6c42\u51fa\u6765\u5c31\u597d\u4e86\uff0c$g(k)$\u53ea\u9700\u8981\u6c42$k!(k-1)$\u9006\u5143\u5c31\u597d\u4e86\uff0c\u4e0a\u9762\u7684\u4e1c\u897f\u53ef\u4ee5\u5feb\u901f\u5e42\uff0c\u4e5f\u53ef\u4ee5\u5faa\u73af\u7684\u65f6\u5019\u987a\u5e26\u6c42\u51fa\u3002\n\n\u7136\u540e\u540e\u9762\u8fd9\u4e00\u9640\u662f\u4e00\u4e2a\u5377\u79ef\uff0c\u8bbe$h(j)=f(k)\\times g(j-k),NTT$\u641e\u4e00\u641e\u590d\u6742\u5ea6$O(nlog_2n)$\n\n\u4e0d\u8fc7\u6ce8\u610f\u4e00\u4e0b$g(0)=1,g(1)=n+1,f(1)=1$\n\n\u6700\u540e\u66b4\u529b\u4ee3\u5165\u4e00\u6b21\u5c31\u597d\u4e86\u3002\n\n$$=\\sum_{j=0}^n2^jj!h(j)$$\n\n\u6ce8\u610f\u5230$n$\u5f88\u5c0f\uff0c\u76f4\u63a5\u626b\u4e00\u53d1\u5c31\u5b8c\u4e8b\u4e86\u3002\n\n\u4ee3\u7801\u5c45\u7136\u4e00\u904d\u8fc7\u7f16\u8bd1\u4e00\u904d\u8fc7\u6837\u4f8b\u4ea4\u4e0a\u53bb~~(\u9664\u4e86\u590d\u5236\u51fa\u9519\u5bfc\u81f4CE)~~\u4e00A\uff1f\uff1f\uff1f\n\n\u8212\u670d~\n\n\u4ee3\u7801\u5982\u4e0b:\n\n```\n#include<bits/stdc++.h>\n#define ll long long\n#define ljc 998244353\nusing namespace std;\nint n,m,r[4000006],lim;\nll f[2000001],h[2000001],w[2000001],g[2000001],c[2000001];\ninline ll fast_pow(ll a,ll b,ll p){\n    ll t=1;a%=p;\n    while (b){\n        if (b&1) t=t*a%p;\n        b>>=1;a=a*a%p;\n    }\n    return t;\n}\ninline void NTT(ll f[],int lim,int id){\n    for (int i=0;i<lim;i++){\n        if (i<r[i]) swap(f[r[i]],f[i]);\n    }\n    w[0]=1;\n    for (int len=1;len<lim;len<<=1){\n    \tll gen=fast_pow(3,(ljc-1)/(len<<1)*id+ljc-1,ljc);\n    \tfor (int i=1;i<lim;i++) w[i]=w[i-1]*gen%ljc;\n        for (int i=0;i<lim;i+=len<<1){\n            ll *f1=f+i,*f2=f1+len;\n            for (int j=0;j<len;j++){\n                ll x=f1[j]%ljc,y=f2[j]*w[j]%ljc;\n                f1[j]=(x+y)%ljc;f2[j]=(x-y+ljc)%ljc;\n            }\n        }\n    }\n    if (id==1) return;\n    ll Inv=fast_pow(lim,ljc-2,ljc);\n    for (int i=0;i<lim;i++) f[i]=f[i]*Inv%ljc;\n}\nint main(){\n\tcin>>n;\n\tf[0]=1;g[0]=1;g[1]=n+1;\n\tll fac=1;\n\tfor (int i=2;i<=n;i++){\n\t\tfac=fac*i%ljc;//\u5faa\u73af\u987a\u5e26\u6c42\u51fa\u9636\u4e58\n\t\tll Iv=fast_pow(fac*(i-1)%ljc,ljc-2,ljc);//\u6c42\u9006\u5143\n\t\tg[i]=(fast_pow(i,n+1,ljc)-1+ljc)%ljc*Iv%ljc;\n\t}\n\tfac=1;\n\tfor (int i=1;i<=n;i++){\n\t\tfac=fac*i%ljc;\n\t\tf[i]=(ljc+(i%2?-1:1)*fast_pow(fac,ljc-2,ljc)%ljc)%ljc;\n\t}\n\tll lim=1,len=0;\n\twhile (lim<=(n<<1)) lim<<=1,len++;\n\tfor (int i=0;i<lim;i++){\n        r[i]=(r[i>>1]>>1)|((i&1)<<(len-1));\n    }\n    NTT(f,lim,1);NTT(g,lim,1);\n    for (int i=0;i<=lim;i++) h[i]=f[i]*g[i]%ljc;\n\tNTT(h,lim,-1);\n\tfac=1;ll ans=0,two=1;//two\u662f\u8bb0\u5f552\u7684\u5e42\u6b21\u7684\u7b54\u6848\n\tfor (int j=0;j<=n;j++){\n\t\tans=(ans+h[j]*fac%ljc*two%ljc)%ljc;\n\t\ttwo=two*2%ljc;fac=fac*(j+1)%ljc;\n\t}\n\tcout<<ans<<endl;\n}\n```",
        "postTime": 1547444472,
        "uid": 20309,
        "name": "Fading",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "# \u5e7f\u544a\n\n[\u849f\u84bb\u306eblog](https://www.cnblogs.com/dedicatus545/p/9152505.html)\n\n# \u601d\u8def\n\n\u9996\u5148\uff0c\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u4e2d\u5927\u90e8\u5206\u7684\u9879\u90fd\u548c$j$\u6709\u5173\uff08\u5c24\u5176\u662f\u540e\u9762\u7684$2^j\\ast j!$\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u66f4\u6362\u4e00\u4e0b\u679a\u4e3e\u65b9\u5f0f\uff0c\u628a\u8fd9\u9053\u9898\u7684\u679a\u4e3e\u65b9\u5f0f\u53d8\u6210\u5148$j$\u518d$i$\n\n$f(n)=\\sum_{j=0}^n2^j\\ast j!\\sum_{i=0}^nS_i^j$\n\n\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u6709\u4e00\u4e2a\u57fa\u4e8e\u7ec4\u5408\u610f\u4e49\u7684\u516c\u5f0f\uff1a\n\n$S_i^j=\\frac1{j!}\\sum_{k=0}^j(-1)^kC_j^k(j-k)^i=\\sum_{k=0}^j\\frac{(-1)^k(j-k)^i}{k!(j-k)!}$\n\n\u628a\u8fd9\u4e2a\u516c\u5f0f\u4ee3\u56de\u539f\u5f0f\u4e2d\uff0c\u5f97\u5230\uff1a\n\n$f(n)=\\sum_{j=0}^n2^j\\ast j!\\sum_{i=0}^n\\sum_{k=0}^j\\frac{(-1)^k(j-k)^i}{k!(j-k)!}$\n\n\u518d\u6b21\u66f4\u6362\u4e00\u4e0b\u679a\u4e3e\u65b9\u5f0f\uff0c\u53d8\u6210\uff1a\n\n$f(n)=\\sum_{j=0}^n2^j\\ast j!\\sum_{k=0}^j\\frac{(-1)^k}{k!}\\sum_{i=0}^n\\frac{(j-k)^i}{(j-k)!}$\n\n$f(n)=\\sum_{j=0}^n2^j\\ast j!\\sum_{k=0}^j\\frac{(-1)^k}{k!}\\ast\\frac{\\sum_{i=0}^n(j-k)^i}{(j-k)!}$\n\n\u6b64\u65f6\uff0c\u8bbe\u4e24\u4e2a\u51fd\u6570$a$\u548c$b$\uff0c\u4ee4\uff1a\n\n$a(i)=\\frac{(-1)^i}{i!}$\n\n$b(i)=\\frac{\\sum_{j=0}^ni^j}{i!}=\\frac{i^{n+1}-1}{(i-1)i!}$\n\n\u90a3\u4e48\uff0c\n\n$f(n)=\\sum_{j=0}^n 2^j\\ast j!\\ast(a\\ast b)(j)$\n\n\u5176\u4e2d(a\\ast b)(j)\u8868\u793a$a$\u548c$b$\u7684$0-j$\u9879\u7684\u5377\u79ef\n\n\u6a21\u6570\u4e3a$998244353$\uff0c\u7528$NTT$\u505a\u4e00\u904d\u5377\u79ef\u5373\u53ef\uff0c\u65f6\u95f4\u6548\u7387\u4e3a$O(nlog_2n)$\n\n### \u6ce8\u610f\u4e8b\u9879\n\n$b(0)=1,b(1)=n+1$\n\n\u8fd9\u4e24\u4e2a\u8981\u63d0\u524d\u4fdd\u5b58\u4e00\u4e0b\uff0c\u56e0\u4e3a\u7528\u516c\u5f0f\u63a8\u7684\u8bdd\u4f1adiv 0\n\n\u8fd8\u6709\u4e00\u4e2a\u5947\u602a\u7684\u95ee\u9898\u6211\u6ca1\u6709\u89e3\u51b3\uff0c\u5177\u4f53\u770b\u4ee3\u7801\u6700\u540e\u9762\u5427\n\n# Code\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\ninline int read(){\n    int re=0,flag=1;char ch=getchar();\n    while(ch>'9'||ch<'0'){\n        if(ch=='-') flag=-1;\n        ch=getchar();\n    }\n    while(ch>='0'&&ch<='9') re=(re<<1)+(re<<3)+ch-'0',ch=getchar();\n    return re*flag;\n}\n#define ll long long\nll MOD=998244353,g=3,inv[400010],f[400010],finv[400010];\nint qpow(ll a,ll b){//\u5feb\u901f\u5e42\n    ll re=1;\n    while(b){\n        if(b&1) re=re*a%MOD;\n        a=a*a%MOD;b>>=1;\n    }\n    return re;\n}\nll n,A[400010],B[400010],C[400010],r[400010],limit,cnt;\nvoid ntt(ll *a,ll type){\n    int i,j,k,mid;ll y,w,wn;\n    for(i=0;i<limit;i++) if(i<r[i]) swap(a[i],a[r[i]]);\n    for(mid=1;mid<limit;mid<<=1){\n        wn=qpow((type==1)?g:inv[g],(MOD-1)/(mid<<1));\n        for(j=0;j<limit;j+=(mid<<1)){\n            w=1;\n            for(k=0;k<mid;k++,w=w*wn%MOD){\n                y=a[j+k+mid]*w%MOD;\n                a[j+k+mid]=(a[j+k]-y+MOD)%MOD;\n                a[j+k]=(a[j+k]+y)%MOD;\n            }\n        }\n    }\n    if(type==-1) for(i=0;i<limit;i++) a[i]=a[i]*inv[limit]%MOD;\n}\nvoid init(){\n    limit=1;cnt=0;int i;\n    while(limit<=(n<<1)) limit<<=1,cnt++;\n    for(i=0;i<limit;i++) r[i]=((r[i>>1]>>1)|((i&1)<<(cnt-1)));\n    inv[1]=A[0]=B[0]=f[1]=finv[1]=1;A[1]=MOD-1;B[1]=n+1;\n    for(i=2;i<=limit;i++) inv[i]=(MOD-MOD/i)*inv[MOD%i]%MOD;\n    for(i=2;i<=limit;i++){\n        f[i]=f[i-1]*i%MOD;\n        finv[i]=finv[i-1]*inv[i]%MOD;\n    }\n}\nint main(){\n    n=read();\n    init();int i;\n    for(i=2;i<=n;i++) A[i]=(((i%2)?-1:1)*finv[i]+MOD)%MOD;\n    for(i=2;i<=n;i++) B[i]=((qpow(i,n+1)-1)*inv[i-1]%MOD*finv[i])%MOD;\n    ntt(A,1);ntt(B,1);\n    for(i=0;i<limit;i++) C[i]=A[i]*B[i]%MOD;\n    ntt(C,-1);\n    ll ans=0;\n    for(i=0;i<=n;i++) ans=(ans+qpow(2,i)*f[i]%MOD*C[i]%MOD)%MOD;\n    printf(\"%lld\\n\",(ans+1)%MOD);//\u8fd9\u91cc\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\uff0c\u4e00\u5b9a\u8981\u52a0\u4e2a1\uff0c\u6211\u4e5f\u6ca1\u6709\u641e\u660e\u767d\n}\n```",
        "postTime": 1528372731,
        "uid": 27753,
        "name": "Orion545",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "\u6c42  \n$$\\sum_{i=0}^n \\sum_{j=0}^i S(i,j)2^jj!$$  \n\n$S(i,j)$\u8868\u793a\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u3002\u8868\u793a$i$\u4e2a\u4e0d\u540c\u7684\u7403\u653e\u5728$j$\u4e2a\u76f8\u540c\u76d2\u5b50\u7684\u65b9\u6848\u6570\uff08\u6ca1\u6709\u7a7a\u76d2\uff09\u3002  \n\n\u9012\u63a8\u5f0f\uff1a$S(i,j) = S(i-1,j-1)+j*S(i-1,j-1)$  \n\n\u653e\u4e00\u4e2a\u65b0\u76d2\u5b50\u6216\u8005\u653e\u5728\u4e4b\u524d$j$\u4e2a\u76f8\u540c\u7684\u4e2d\u3002  \n\n\u53ef\u4ee5\u6c42\u4e00\u4e0b\u4ed6\u7684\u516c\u5f0f\u3002\u3002 \n\n\u7528\u5bb9\u65a5\u539f\u7406\uff0c\u8bbe\u6709$k$\u4e2a\u7a7a\u76d2\uff1a  \n$$S(n,m)=\\frac 1 {m!}\\sum_{k=0}^m(-1)^k*C_m^k*(m-k)^n $$ \n$$=\\sum_{k=0}^m \\frac {(-1)^k*(m-k)^n}{(m-k)!k!}$$  \n\n\u4ee3\u5165\u3002\u3002\u3002\u3002\u3002  \n\u56e0\u4e3a\u5f53$i<j$\u65f6$S(i,j)=0$\u3002\u6240\u4ee5\u628a$j$\u7684\u4e0a\u754c\u8bbe\u4e3a$n$\u3002   \n \n  \n     \n     \n\u539f\u5f0f\u4e3a\uff1a\n$$\\sum_{j=0}^n 2^jj!\\sum_{i=0}^n  S(i,j)$$  \n\n\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e$j$\u3002  \n\n\u5982\u679c\u53ef\u4ee5\u5feb\u901f\u6c42\u51fa$S(i,j)$\u5c31\u597d\u4e86\u3002  \n\n\u7ee7\u7eed\u63a8\u5f0f\u5b50\uff1a  \n\n$$\\sum_{j=0}^n 2^jj!\\sum_{i=0}^n \\sum_{k=0}^j \\frac{(-1)^k(j-k)^i}{(j-k)!k!}$$  \n\n $$=\\sum_{j=0}^n 2^jj!\\sum_{k=0}^j \\frac{(-1)^k}{(j-k)!k!}\\sum_{i=0}^n (j-k)^i$$  \n \n$$=\\sum_{j=0}^n 2^jj!\\sum_{k=0}^j \\frac{(-1)^k}{k!}\\sum_{i=0}^n \\frac {(j-k)^i} {(j-k)!}$$   \n\n\u8bbe  \n$$F(x)=\\frac {(-1)^x}{x!}\\ \\ \\ \\ \\ G(x)=\\frac {x^i} {x!}$$    \n\n\u90a3\u4e48\u5f0f\u5b50\u5c31\u662f $\\sum_{j=0}^n2^jj! (F*G(j))$  \n\n\u5377\u79ef\u5c31\u597d\u4e86\u3002\u3002  \n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst ll mod = 998244353;\nll ksm(ll a,ll b=mod-2)\n{\n\tll ret = 1;\n\twhile(b)\n\t{\n\t\tif(b&1)ret=ret*a%mod;\n\t\ta=a*a%mod;\n\t\tb>>=1;\n\t}\t\n\treturn ret;\n} \nconst ll G = 3,invG=ksm(G);\nconst int N = 280020;\nvoid clr(ll *f,int n)\n{\n\tfor(int i=0;i<n;i++)f[i]=0;\n}\nvoid cpy(ll *f,ll *g,int n)\n{\n\tfor(int i=0;i<n;i++)f[i]=g[i];\n}\nint rev[N],rev_last; \nvoid revinit(int n)\n{\n\t#define last rev_last\n\tif(last==n)return;\n\tlast=n;\n\tfor(int i=0;i<n;i++)\n\t  rev[i] = (rev[i>>1]>>1)|((i&1)*n/2);\n\t#undef last \n}\nvoid ntt(ll *a,int n,int inv)\n{\n\trevinit(n);\n\tfor(int i=0;i<n;i++)\n\t  if(i<rev[i]) swap(a[i],a[rev[i]]);\n\tfor(int mid=1;mid<n;mid*=2)\n\t{\n\t\tll temp=ksm(inv>0?G:invG,(mod-1)/(2*mid));\n\t\tfor(int i=0;i<n;i+=mid*2)\n\t\t{\n\t\t\tll omega = 1;\n\t\t\tfor(int j=0;j<mid;omega=omega*temp%mod,j++)\n\t\t\t{\n\t\t\t\tll x = a[i+j],y=omega*a[i+j+mid]%mod;\n\t\t\t\ta[i+j] = (x+y) %mod;\n\t\t\t\ta[i+j+mid] = ((x-y)%mod+mod)%mod;\n\t\t\t}\t\t\t\n\t\t}\n\t}\n\tif(inv<0)\n\t{\n\t\tll invn = ksm(n);\n\t\tfor(int i=0;i<n;i++)\n\t\t  a[i]=a[i]*invn%mod;\n\t}\n}\nvoid px(ll *f,ll *g,int n)\n{\n\tfor(int i=0;i<n;i++)\n\t  f[i] = f[i] * g[i]%mod;\n}\nll time_sav[N];\nvoid times(ll *f,ll *g,int len,int lim)\n{\n\t#define sav time_sav\n\tint n=1;\n\tfor(n;n<len+len;n<<=1);\n\tcpy(sav,g,n);\n\tfor(int i=len;i<n;i++)sav[i]=0;\n\tntt(f,n,1);\n\tntt(sav,n,1);\n\tpx(f,sav,n);\n\tntt(f,n,-1);\t\n\tfor(int i=lim;i<n;i++)f[i]=0;\n\tclr(sav,n);\n\t#undef sav\n}\nll fac[N],inv[N],F[N],H[N];\nint main()\n{\n\tint n;\n\tscanf(\"%d\",&n);\n\tfac[0]=1;\n\tfor(int i=1;i<=n;i++)\n\t  fac[i]=fac[i-1]*i%mod;\n\tinv[n] = ksm(fac[n]);\n\tfor(int i=n-1;i>=0;i--)\n\t  inv[i] = (inv[i+1]*(i+1))%mod;\n\tfor(int i=0;i<=n;i++)\n\t  if(i&1)F[i] = (mod-1)*inv[i]%mod;\n\t  else F[i]=inv[i];\n\tH[0] =  1;H[1] = n+1;\n\tfor(int i=2;i<=n;i++)\n\t  H[i] = (ksm(i,n+1)-1)*ksm(i-1)%mod*inv[i]%mod;\n\ttimes(F,H,n+1,n+1);\n\tll ans = 0;\n\tfor(int i=0;i<=n;i++)\n\t{\n\t\tans = (ans + ksm(2,i)*fac[i]%mod*F[i])%mod;\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n\n  \n   \n    \n     \n      \n       \n        \n         \n          \n          ",
        "postTime": 1602142060,
        "uid": 13197,
        "name": "zhendelan",
        "ccfLevel": 7,
        "title": "P4091 [HEOI2016/TJOI2016]\u6c42\u548c"
    },
    {
        "content": "# \u3010 HEOI2016 / TJOI2016 \u3011\u6c42\u548c\n# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/P4091)\u770b\u9898\u76ee\u3002\n# \u5206\u6790\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570$S(i,j)$\u672c\u8eab\u7684\u610f\u4e49\u662f\u2014\u2014\u5c06$i$\u4e2a\u4e0d\u540c\u7403\u653e\u5165$j$\u4e2a\u76f8\u540c\u76d2\u5b50\u4e2d\uff0c\u4f7f\u5f97\u76d2\u5b50\u4e0d\u4e3a\u7a7a\u7684\u65b9\u6848\u6570\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230$S(i,j)$\u7684\u5bb9\u65a5\u5f0f\uff1a  \n$$S(i,j)=\\frac1{j!}\\sum_{k=0}^j(-1)^kC_j^k(j-k)^i$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5176\u4e2d\u6211\u4eec\u5148\u5c06$j$\u4e2a\u76d2\u5b50\u770b\u6210\u4e0d\u540c\u7684\u3002\u6211\u4eec\u679a\u4e3e\u7a7a\u76d2\u5b50\u6570\u91cf$k$\uff0c\u5bb9\u65a5\u7cfb\u6570\u4e3a$(-1)^k$\uff0c$C_j^k$\u4e3a\u9009\u51fa$k$\u4e2a\u76d2\u5b50\u7684\u65b9\u6848\u6570\uff0c$(j-k)^i$\u4e3a\u5728\u5269\u4e0b\u7684\u76d2\u5b50\u4e2d\u653e$i$\u4e2a\u7403\u7684\u65b9\u6848\u6570\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u63a5\u4e0b\u6765\u5316\u5f0f\u5b50\uff1a \n$$\\sum_{i=0}^n\\sum_{j=0}^i2^j\\times S(i,j)\\times j!$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6ce8\u610f\u5230\u82e5$j>i$\uff0c\u5219$S(i,j)=0$\u3002  \n$$\\Rightarrow \\sum_{i=0}^n\\sum_{j=0}^n2^j\\times S(i,j)\\times j!$$  \n$$= \\sum_{i=0}^n\\sum_{j=0}^n2^j\\sum_{k=0}^j(-1)^kC_j^k(j-k)^i$$  \n$$= \\sum_{i=0}^n\\sum_{j=0}^n2^j\\sum_{k=0}^j(-1)^k\\frac{j!}{k!(j-k)!}(j-k)^i$$  \n$$= \\sum_{i=0}^n\\sum_{j=0}^n2^j\\times j!\\sum_{k=0}^j\\frac{(-1)^k}{k!}\\frac{(j-k)^i}{(j-k)!}$$  \n$$= \\sum_{j=0}^n2^j\\times j!\\sum_{k=0}^j\\frac{(-1)^k}{k!}\\frac{\\sum_{i=0}^n(j-k)^i}{(j-k)!}$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8bbe$f(x)=\\sum_{i=0}^{+\\infty}\\frac{(-1)^i}{i!}x, g(x)=\\sum_{i=0}^{+\\infty}\\frac{\\sum_{k=0}^ni^k}{i!}$\uff0c\u5e76\u8bb0$[x^k]f(x)$\u8868\u793a\u591a\u9879\u5f0f\u51fd\u6570$f(x)$\u5728$x^k$\u9879\u4e0a\u7684\u7cfb\u6570\uff0c\u53ef\u4ee5\u53c2\u8003\u751f\u6210\u51fd\u6570\u3002\u4e8e\u662f\u5f0f\u5b50\u4f1a\u88ab\u5316\u4e3a\u5982\u4e0b\u5e26\u5377\u79ef\u5f62\u5f0f\uff1a  \n$$\\Rightarrow \\sum_{j=0}^n2^j\\times j!\\times [x^j](f*g)(x)$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u53d1\u73b0$(f*g)(x)$\u53ef\u4ee5 NTT \u9884\u5904\u7406\u3002\u4f46\u662f\u9996\u5f53\u5176\u51b2\u7684\u662f\u5982\u4f55\u5feb\u901f\u6c42\u51fa$[x^k]g(x)$\uff1a  \n$$[x^k]g(x)=\\frac{\\sum_{i=0}^nk^i}{k!}$$\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5229\u7528\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\uff1a  \n$$\\Rightarrow [x^k]g(x)=\\begin{cases}\\frac{k^{n+1}-1}{k!(k-1) }&k\\not= 1\\\\n+1&k=1\\end{cases}$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u9700\u8981\u6ce8\u610f\u7684\u662f$g(0)=1$\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u65f6\u95f4\u662f$O(n\\log_2n)$\u3002  \n# \u4ee3\u7801\n```cpp\n#include <cmath>\n#include <cstdio>\n\ntypedef long long LL;\n\nconst int mod = 998244353, phi = mod - 1;\nconst int MAXN = 1e5 + 5, g = 3;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0;char s = getchar();int f = 1;\n\twhile( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n\twhile( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n\tif( 9 < x ){ write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\ntemplate<typename _T>\nvoid swapp( _T &x, _T &y )\n{\n\t_T t = x; x = y, y = t;\n}\n\nint F[MAXN << 2], G[MAXN << 2], H[MAXN << 2];\nint fac[MAXN], inv[MAXN], invFac[MAXN];\nint N;\n\nint qkpow( int base, int indx )\n{\n\tint ret = 1;\n\twhile( indx )\n\t{\n\t\tif( indx & 1 ) ret = 1ll * ret * base % mod;\n\t\tbase = 1ll * base * base % mod, indx >>= 1;\n\t}\n\treturn ret;\n}\n\nint fix( const int a ) { return ( a % mod + mod ) % mod; }\nint inver( const int a ) { return a <= N ? inv[a] : qkpow( a, phi - 1 ); }\nint getS( const int q, const int n ) { return 1ll * fix( qkpow( q, n ) - 1 ) * inver( fix( q - 1 ) ) % mod; }\n\nvoid NTT( int *coe, const int len, const int type )\n{\n\tconst int phi = mod - 1;\n\tint lg2 = log2( len );\n\tfor( int i = 0, rev ; i < len ; i ++ )\n\t{\n\t\trev = 0;\n\t\tfor( int j = 0 ; j < lg2 ; j ++ ) rev |= ( ( i >> j ) & 1 ) << ( lg2 - j - 1 );\n\t\tif( rev < i ) swapp( coe[rev], coe[i] );\n\t}\n\tint wp, w, we, wo;\n\tfor( int s = 2, p ; s <= len ; s <<= 1 )\n\t{\n\t\tp = s >> 1, wp = type > 0 ? qkpow( 3, phi / s ) : inver( qkpow( 3, phi / s ) );\n\t\tfor( int i = 0 ; i < len ; i += s )\n\t\t{\n\t\t\tw = 1;\n\t\t\tfor( int j = 0 ; j < p ; j ++, w = 1ll * w * wp % mod )\n\t\t\t{\n\t\t\t\twe = coe[i + j], wo = coe[i + j + p];\n\t\t\t\tcoe[i + j] = ( we + 1ll * w * wo % mod ) % mod, coe[i + j + p] = fix( we - 1ll * w * wo % mod );\n\t\t\t}\n\t\t}\n\t}\n\tif( ~ type ) return ;\n\tint in = inver( len );\n\tfor( int i = 0 ; i <= len ; i ++ ) coe[i] = 1ll * coe[i] * in % mod;\n}\n\nvoid init()\n{\n\tfac[0] = fac[1] = invFac[0] = invFac[1] = inv[1] = 1;\n\tfor( int i = 2 ; i <= N ; i ++ ) fac[i] = ( LL ) fac[i - 1] * i % mod, inv[i] = ( LL ) ( mod - mod / i ) * inv[mod % i] % mod;\n\tfor( int i = 2 ; i <= N ; i ++ ) invFac[i] = ( LL ) invFac[i - 1] * inv[i] % mod;\n\tfor( int i = 0 ; i <= N ; i ++ ) \n\t\tF[i] = ( i & 1 ) ? ( mod - invFac[i] ) : invFac[i];\n\tG[0] = 1, G[1] = N + 1;\n\tfor( int i = 2 ; i <= N ; i ++ ) \n\t\tG[i] = ( LL ) ( qkpow( i, N + 1 ) - 1 ) * inv[i - 1] % mod * invFac[i] % mod;\n}\n\nint main()\n{\n\tread( N );\n\tinit();\n\tint K = N * 2, len = 1;\n\twhile( len < K ) len <<= 1;\n\tNTT( F, len, 1 ), NTT( G, len, 1 );\n\tfor( int i = 0 ; i <= len ; i ++ ) H[i] = 1ll * F[i] * G[i] % mod;\n\tNTT( H, len, -1 );\n\tinit();\n\tint ans = 0;\n\tfor( int i = 0, two = 1 ; i <= N ; i ++, two = two * 2 % mod ) \n\t\tans = ( ans + 1ll * two * fac[i] % mod * H[i] % mod ) % mod;\n\twrite( ans ), putchar( '\\n' );\n\treturn 0;\n}\n```",
        "postTime": 1583069481,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "\u3010 HEOI2016 / TJOI2016 \u3011\u6c42\u548c"
    },
    {
        "content": "### \u6c42\u548c\n\n\u9898\u610f\uff1a\u6c42\u4ee5\u4e0b\u8fd9\u4e2a\u5f0f\u5b50$f(n)=\\sum_{i=0}^{n}\\sum_{j=0}^{i}S(i, j)\\times 2^j\\times j!$\n\n\u8c8c\u4f3c\u6709\u4e00\u4e2a\u795e\u4ed9\u7684 $dp$\u505a\u6cd5\uff0c\u53ef\u662f\u6211\u5e76\u4e0d\u4f1a\u3002\u3002\u3002\n\n\u8003\u8651\u628a$S(i,j)$\u7684\u7ec4\u5408\u610f\u4e49\u62c6\u6389\uff1a\n\n\u53ef\u4ee5\u5f97\u5230\u5f0f\u5b50\u4e3a\uff1a$f(n)=\\sum_{i=0}^{n}\\sum_{j=0}^{i}2^j\\sum_{k=0}^{j}(-1)^{j-k}k^i*C(j, k)$\n\n\u4ea4\u6362\u4e00\u4e0b\u679a\u4e3e\u9879\u53ef\u4ee5\u5f97\u5230\uff1a$\\sum_{k=0}^{n}\\sum_{j=0}^{n}(-1)^{j-k}C(j, k)\\sum_{i=0}^{n}k^i$\n\n\u7136\u540e\u53d1\u73b0\u540e\u9762\u90a3\u4e2a\u4e1c\u897f\u662f\u53ef\u4ee5\u9884\u5904\u7406\u7684\uff0c \u90a3\u4e48\u524d\u9762\u5c31\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\n\n\u7136\u540e\u8fd9\u9053\u9898\u5c31\u6109\u5feb\u7684\u6c42\u89e3\u4e86\u3002\n\n\u5177\u4f53\u53ef\u4ee5\u89c1\u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define mod 998244353\n#define G 3\n#define Gi 332748118\n#define reg register\n#define maxn 1000001\nusing namespace std;\nint fac[maxn], ifac[maxn], inv[maxn], n, len;\nint lim, rev[maxn], x, y, ans, a[maxn], b[maxn];\nint ksm(int u, int v){\n\tint s = 1;\n\tfor(int i = v; i; i >>= 1){\n\t\tif(i & 1) s = 1ll * s * u % mod;\n\t\tu = 1ll * u * u % mod;\n\t}\n\treturn s;\n}\nint C(int u, int v){\n\tint s = 1ll * fac[u] * ifac[v] % mod * ifac[u - v] % mod;\n\treturn s;\n}\nint ntt(int *a, int type){\n\tfor(int i = 1; i < lim; i++) \n\t\tif(i < rev[i]) swap(a[i], a[rev[i]]);\n\tfor(int i = 1; i < lim; i <<= 1){\n\t\tint x = ksm(type == 1 ? G : Gi, (mod - 1) / (i << 1));\n\t\tfor(int j = 0; j < lim; j += i << 1)\n\t\t\tfor(int k = 0, y = 1; k < i; k++, y = 1ll * y * x % mod){\n\t\t\t\tint p = a[j + k], q = 1ll * a[j + k + i] * y % mod;\n\t\t\t\ta[j + k] =\t(p + q) % mod; a[j + k + i] = (p - q + mod) % mod;\n\t\t\t}\n\t}\n\tif(type == -1){\n\t\tint x = ksm(lim, mod - 2);\n\t\tfor(int i = 0; i < lim; i++) a[i] = 1ll * a[i] * x % mod;\n\t}\n}\nint main()\n{\n\tcin >> n;\n\tinv[0] = 1; ifac[0] = 1; fac[0] = 1;\n\tfor(int i = 1; i <= n; i++){\n\t\tinv[i] = (i == 1) ? 1 : 1ll * inv[mod % i] * (mod - mod / i) % mod;\n\t\tfac[i] = 1ll * fac[i - 1] * i % mod;\n\t\tifac[i] = 1ll * ifac[i - 1] * inv[i] % mod; \n\t}\n\tfor(int i = 0; i <= n; i++) {\n\t\tif(i == 1) {a[i] = n + 1; continue;}\n\t\ta[i] = 1ll * (ksm(i, n + 1) - 1) * ksm(i - 1, mod - 2) % mod;\n\t\ta[i] = 1ll * a[i] * ifac[i] % mod;\n\t}\n\tfor(int i = 0; i <= n; i++) b[i] = 1ll * ksm(2, i) * fac[i] % mod;\n\tfor(lim = 1, len = 0; lim <= (n << 1); lim <<= 1, len++);\n\tfor(int i = 1; i < lim; i++) rev[i] = (rev[i >> 1] >> 1) | ((i & 1) << (len - 1));\n\treverse(a, a + n + 1); \n\tntt(a, 1); ntt(b, 1);\n\tfor(int i = 0; i < lim; i++) a[i] = 1ll * a[i] * b[i] % mod;\n\tntt(a, -1); \n\tfor(int i = 0; i <= n; i++)\n\t a[i] = a[i + n];\n\tfor(int i = 0; i <= n; i++){\n\t\ta[i] = 1ll * a[i] * ifac[i] % mod;\n\t\tif(i & 1) ans = (ans + mod - a[i]) % mod;\n\t\telse ans = (ans + a[i]) % mod;\n\t}\n\tcout << ans << endl;\n}\n```\n",
        "postTime": 1579096485,
        "uid": 97783,
        "name": "yyxmy",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "[\u539f\u9898\u4f20\u9001\u95e8](https://www.luogu.org/problem/P4091)\n\n$$\\begin{aligned} a n s &=\\sum_{i=0}^{n} \\sum_{j=0}^{i}\\left\\{\\begin{array}{c}{i} \\\\\n{j}\\end{array}\\right\\} 2^{j} \\times j ! \\\\ \n&=\\sum_{i=0}^{n} \\sum_{j=0}^{n}\\left\\{\\begin{array}{c}{i} \\\\ \n{j}\\end{array}\\right\\} 2^{j} \\times j ! \\\\\n&=\\sum_{j=0}^{n} 2^{j} \\times j ! \\sum_{i=0}^{n}\\left\\{\\begin{array}{c}{i} \\\\ {j}\\end{array}\\right\\} \\\\\n&=\\sum_{j=0}^{n} 2^{j} \\times j ! \\sum_{i=0}^n(\\frac{1}{m !} \\sum_{k=0}^j(-1)^k \\tbinom{m}{k} (m-k)^n) \\\\\n&=\\sum_{j=0}^{n} 2^{j} \\times j ! \\sum_{i=0}^{n} \\sum_{k=0}^{j} \\frac{(-1)^{k}}{k !} \\cdot \\frac{(j-k)^{i}}{(j-k) !} \n\\\\ &=\\sum_{j=0}^{n} 2^{j} \\times j ! \\sum_{k=0}^{j} \\frac{(-1)^{k}}{k !} \\cdot \\frac{(j-k)^{n+1}-1}{(j-k-1)(j-k) !} \\end{aligned}$$\n\n\u8fd9\u5c31\u662f\u4e00\u4e2a\u5f88\u660e\u663e\u7684\u5377\u79ef\u5f62\u5f0f\uff0cNTT\u6c42\u4e00\u4e0b\u5373\u53ef\n\n\u8981\u6ce8\u610f\u4e00\u4e0b\u6700\u540e\u4e00\u6b65\uff0c\u56e0\u4e3a\u7528\u4e86\u7b49\u6bd4\u6570\u5217\u6c42\u548c\uff0c\u6240\u4ee5$1$\u8981\u7279\u5224\n\n```cpp\n#include <bits/stdc++.h>\n#define N 100005\n#define mod 998244353\n#define G 3\n#define getchar nc\nusing namespace std;\ninline char nc(){\n    static char buf[100000],*p1=buf,*p2=buf;\n    return p1==p2&&(p2=(p1=buf)+fread(buf,1,100000,stdin),p1==p2)?EOF:*p1++;\n}\ninline int read()\n{\n    register int x=0,f=1;register char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9')x=(x<<3)+(x<<1)+ch-'0',ch=getchar();\n    return x*f;\n}\ninline void write(register int x)\n{\n    if(!x)putchar('0');if(x<0)x=-x,putchar('-');\n    static int sta[20];register int tot=0;\n    while(x)sta[tot++]=x%10,x/=10;\n    while(tot)putchar(sta[--tot]+48);\n}\ninline int power(register int a,register int b)\n{\n    int res=1;\n    while(b)\n    {\n        if(b&1)\n            res=1ll*res*a%mod;\n        a=1ll*a*a%mod;\n        b>>=1;\n    }\n    return res;\n}\nint n,fac[N],invf[N],f[N<<2],g[N<<2],R[N<<2],ans;\ninline void NTT(register int *a,register int n,register int f)\n{\n    for(register int i=0;i<n;++i)\n        if(i<R[i])\n            swap(a[i],a[R[i]]);\n    for(register int i=1;i<n;i<<=1)\n    {\n        int T=power(G,(mod-1)/(i<<1));\n        if(f==-1)\n            T=power(T,mod-2);\n        for(register int j=0;j<n;j+=(i<<1))\n        {\n            int t=1;\n            for(register int k=0;k<i;++k,t=1ll*t*T%mod)\n            {\n                int Nx=a[j+k],Ny=1ll*t*a[i+j+k]%mod;\n                a[j+k]=(0ll+Nx+Ny)%mod;\n                a[i+j+k]=(0ll+Nx-Ny+mod)%mod;\n            }\n        }\n    }\n}\nint main()\n{\n    n=read();\n    fac[0]=fac[1]=1;\n    for(register int i=2;i<=n;++i)\n        fac[i]=1ll*fac[i-1]*i%mod;\n    invf[n]=power(fac[n],mod-2);\n    for(register int i=n-1;i>=0;--i)\n        invf[i]=1ll*invf[i+1]*(i+1)%mod;\n    for(register int i=0;i<=n;++i)\n        f[i]=1ll*(i&1?mod-1:1)*invf[i]%mod;\n    for(register int i=0;i<=n;++i)\n        g[i]=1ll*(power(i,n+1)+mod-1)*power(i-1<0?i+mod-1:i-1,mod-2)%mod*invf[i]%mod;\n    g[1]=n+1;\n    int lim=1,ct=0;\n    while(lim<n<<1)\n        lim<<=1,++ct;\n    for(register int i=0;i<lim;++i)\n        R[i]=(R[i>>1]>>1)|((i&1)<<(ct-1));\n    NTT(f,lim,1),NTT(g,lim,1);\n    for(register int i=0;i<lim;++i)\n        f[i]=1ll*f[i]*g[i]%mod;\n    NTT(f,lim,-1);\n    int inv=power(lim,mod-2);\n    for(register int i=0;i<=n;++i)\n        ans=(0ll+ans+1ll*power(2,i)*fac[i]%mod*f[i]%mod*inv%mod)%mod;\n    write(ans);\n\treturn 0;\n}\n```",
        "postTime": 1565223298,
        "uid": 37881,
        "name": "yzhang",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "[\u70b9\u6211\u98df\u7528\u6548\u679c\u66f4\u4f73](https://www.cnblogs.com/hbxblog/p/11204162.html)\n### $Solution$\n\n\u5148\u5316\u7b80\u5f0f\u5b50:\n\n$$f(n)=\\sum_{i=0}^n\\sum_{j=0}^i\\begin{Bmatrix} i \\\\ j \\end {Bmatrix}*2^j*j!$$\n\n$$f(n)=\\sum_{j=0}^n2^j*j!\\sum_{i=0}^n\\begin{Bmatrix} i \\\\ j \\end {Bmatrix}$$\n\n\u6839\u636e\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u7684\u516c\u5f0f:\n\n$$f(n)=\\sum_{j=0}^n2^j*j!\\sum_{i=0}^n\\sum_{k=0}^j\\frac{(-1)^k}{k!}*\\frac{(j-k)^i}{(j-k)!}$$\n\n$$f(n)=\\sum_{j=0}^n2^j*j!\\sum_{k=0}^j\\frac{(-1)^k}{k!}*\\frac{\\sum_{i=0}^n(j-k)^i}{(j-k)!}$$\n\u6211\u4eec\u4ee4$F(i)=\\frac{(-1)^k}{i!},G(i)=\\frac{\\sum_{j=0}^ni^j}{i!}$\n\n\u6839\u636e\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\u53ef\u5f97\uff1a\n\n$\\sum_{j=0}^ni^j=\\frac{i^{n+1}-1}{i-1}$\n\n\u6240\u4ee5$G(i)=\\frac{i^{n+1}-1}{(i-1)*i!}$\n\n$G(0)=1,G(1)=n+1$\n\n\u90a3\u4e48\n\n$$f(n)=\\sum_{j=0}^n2^j*j!\\sum_{k=0}^jF(k)*G(j-k)$$\n\n\u56e0\u4e3a\u5f53$j>k$\u65f6$G(j-k)=0$\n\n\u6240\u4ee5\u539f\u5f0f\u7b49\u4ef7\u4e8e:\n\n$$f(n)=\\sum_{j=0}^n2^j*j!\\sum_{k=0}^nF(k)*G(j-k)$$\n\n\u8fd9\u4e2a\u4e1c\u897f\u76f4\u63a5$NTT$\u641e\u4e00\u641e\u5c31\u597d\u4e86\n\n### $Code$\n``` cpp\n#include<bits/stdc++.h>\n#define int long long\n#define rg register\n#define file(x) freopen(x\".in\",\"r\",stdin);freopen(x\".out\",\"w\",stdout);\nusing namespace std;\nconst int mod=998244353;\nconst int N=500010;\nint read(){\n    int x=0,f=1;\n    char c=getchar();\n    while(c<'0'||c>'9') f=(c=='-')?-1:1,c=getchar();\n    while(c>='0'&&c<='9') x=x*10+c-48,c=getchar();\n    return f*x;\n}\nint f[N],g[N],r[N],limit=1,w[N],inv[N],a[N],b[N],jc[N];\nint ksm(int a,int b){\n    int ans=1;\n    while(b){\n        if(b&1) ans=ans*a%mod;\n        a=a*a%mod,b>>=1;\n    }\n    return ans;\n}\nvoid ntt(int *a,int opt){\n    for(int i=0;i<=limit;i++)\n        if(i<r[i])\n            swap(a[i],a[r[i]]);\n    for(int i=1;i<limit;i<<=1){\n        int w=ksm(3,(mod-1)/(i*2));\n        if(opt==-1) w=ksm(w,mod-2);\n        for(int j=0;j<limit;j+=i<<1){\n            int l=1;\n            for(int k=j;k<j+i;k++){\n                int p=l*a[k+i]%mod;\n                a[k+i]=(a[k]-p+mod)%mod;\n                a[k]=(a[k]+p)%mod;\n                l=l*w%mod;\n            }\n        }\n    }\n}\nmain(){\n    int n=read(),l=0,ans=0;\n    while(limit<=(n<<1))\n        limit<<=1,l++;\n    jc[0]=1;\n    for(int i=1;i<=limit;i++)\n        jc[i]=jc[i-1]*i%mod;\n    inv[limit]=ksm(jc[limit],mod-2);\n    for(int i=limit-1;i>=0;i--)\n        inv[i]=inv[i+1]*(i+1)%mod;\n\tg[0]=1,g[1]=n+1,f[1]=mod-1,f[0]=1;\n\tfor(int i=2;i<=n;i++)\n\t\tg[i]=(ksm(i,n+1)-1)%mod*inv[i]%mod*ksm(i-1,mod-2)%mod,f[i]=i&1?mod-inv[i]:inv[i];\n    for(int i=0;i<limit;i++)\n        r[i]=(r[i>>1]>>1)|((i&1)<<(l-1));\n    ntt(f,1),ntt(g,1);\n    for(int i=0;i<limit;i++)\n        f[i]=f[i]*g[i]%mod;\n    ntt(f,-1);\n\tint inv=ksm(limit,mod-2);\n    for(int i=0;i<=n;i++)\n\t\tans=(ans+ksm(2,i)*jc[i]%mod*f[i]%mod*inv%mod)%mod;\n    printf(\"%lld\",ans);\n}\n```",
        "postTime": 1563374108,
        "uid": 19805,
        "name": "\u64a4\u4e91",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "# [Tjoi2016&Heoi2016]\u6c42\u548c\n\n\u9996\u5148\u6211\u4eec\u601d\u8003\u4ec0\u4e48\u662f\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\uff0c\u5b83\u7684\u5b9a\u4e49\u4e3a\u628a$n$\u4e2a\u4e0d\u540c\u7684\u5c0f\u7403\u653e\u5728$m$\u4e2a\u76f8\u540c\u7684\u76d2\u5b50\u91cc\u65b9\u6848\u6570\uff0c\u6211\u4eec\u56de\u5934\u770b\u5f0f\u5b50\uff0c\u53d1\u73b0$S(i\uff0cj)\\times (j!)$\u5c31\u662f\u5c06$n$\u4e2a\u4e0d\u540c\u7684\u5c0f\u7403\u653e\u5728$m$\u4e2a\u4e0d\u540c\u7684\u76d2\u5b50\u91cc\u7684\u65b9\u6848\u6570\uff0c\u73b0\u5728\u6211\u4eec\u5047\u8bbe$ g[i]$\u8868\u793a\u5c06$i$\u4e2a\u4e0d\u540c\u5c0f\u7403\u5212\u5206\u5728\u4efb\u610f\u591a\u4e2a\u76d2\u5b50\u4e2d\u5f97\u65b9\u6848\u6570\uff0c\u6211\u4eec\u5148\u8003\u8651\u66b4\u529b\u8f6c\u79fb\uff0c\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u6700\u540e\u4e00\u4e2a\u76d2\u5b50\u6709\u591a\u5c11\u4e2a\u5c0f\u7403\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u5f97\u5230\uff1a\n\n$$\ng[i]=\\sum \\limits _{j=1}^{j\\le i}g[i-j]\\times C_i^j\n$$\n\n\u73b0\u5728\u6211\u4eec\u4ee4$G[i]=\\frac{g[i]}{i!}$\uff0c\u5219\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$\nG[i]=\\frac{g[i]}{i!}=\\sum \\limits _{j=1}^{j\\le i}g[i-j]\\times \\frac{i!}{(i-j)!}\n$$\n\n$$\nG[i]=\\frac{g[i]}{i!}=\\sum \\limits _{j=1}^{j\\le i}i!\\times \\frac{g[i-j]}{(i-j)!}\n$$\n\n$$\nG[i]=\\frac{g[i]}{i!}=\\sum \\limits _{j=1}^{j\\le i}i!\\times G[i-j]\n$$\n\n$$\nG[i]=\\sum \\limits _{j=1}^{j\\le i}i!\\times G[i-j]\n$$\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4e0a\u9762\u7684\u5f0f\u5b50$G[i]$\u5c31\u548c\u6211\u4eec\u9898\u76ee\u4e2d\u8981\u6c42\u7684\u591a\u9879\u5f0f\u7684\u7b2c$i$\u4f4d\u76f8\u5dee$2^j$\u3002\u6211\u4eec\u8003\u8651$2^j$\u7684\u542b\u4e49\uff0c\u5b83\u7684\u5b9e\u8d28\u5c31\u662f$2$\u7684\u6211\u4eec\u5206\u5f97\u76d2\u5b50\u6570\u6b21\u65b9\uff0c\u8fd9\u6837\u6211\u4eec\u53ea\u9700\u8981\u5bf9\u4e0a\u8ff0\u5f0f\u5b50\u7565\u52a0\u4fee\u6539\uff1a\n$$\nG[i]=\\sum \\limits _{j=1}^{j\\le i}2\\times i!\\times G[i-j]\n$$\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4e0a\u9762\u7684\u5f0f\u5b50\u53ef\u4ee5\u770b\u505a\u81ea\u5377\u79ef\uff0c\u6211\u4eec\u4ee4$H[i]=2\\times i!$\u3002\u8fd9\u6837\u6bcf\u4e00\u6b21\u8f6c\u79fb\u5c31\u662f$G=G\\times H+1$\uff0c\u6211\u4eec\u8003\u8651\u6700\u540e\u7684$1$\u662f\u4ec0\u4e48\u4e1c\u897f\uff0c\u8fd9\u4e2a$1$\u662f$G[0]$\u7684\u503c\uff0c\u6211\u4eec\u53d1\u73b0\u4e0a\u9762\u7684\u5f0f\u5b50\u4e2d\u6ca1\u6709\u66f4\u65b0$G[0]$\u7684\u3002\u6211\u4eec\u8fdb\u884c\u53d8\u5f62\u53ef\u4ee5\u5f97\u5230$G=\\frac{1}{1-H}$\uff0c\u6700\u540e\u7528\u591a\u9879\u5f0f\u6c42\u9006\u505a\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n```cpp\n#include <cstdio>\n#include <algorithm>\nusing namespace std;\n#define mod 998244353\n#define N 1000010\nint a[N],b[N],A[N],B[N],inv[N],len,n,ans;\nint qpow(int x,int y)\n\t{int tmp=1; while(y) {if(y&1) tmp=1ll*tmp*x%mod; x=1ll*x*x%mod,y>>=1;} return tmp;}\nvoid ntt(int *a,int len,int miku)\n{\n\tfor(int i=0,k=0;i<len;i++)\n\t{\n\t\tif(i>k) swap(a[i],a[k]);\n\t\tfor(int j=len>>1;(k^=j)<j;j>>=1);\n\t}\n\tfor(int k=2;k<=len;k<<=1)\n\t{\n\t\tint t=k>>1,x=qpow(3,(mod-1)/k);\n\t\tif(miku==-1) x=qpow(x,mod-2);\n\t\tfor(int i=0;i<len;i+=k)\n\t\t{\n\t\t\tint w=1;\n\t\t\tfor(int j=i;j<i+t;j++)\n\t\t\t{\n\t\t\t\tint tmp=1ll*a[j+t]*w%mod;\n\t\t\t\ta[j+t]=(a[j]-tmp+mod)%mod;\n\t\t\t\ta[j]=(a[j]+tmp)%mod;\n\t\t\t\tw=1ll*w*x%mod;\n\t\t\t}\n\t\t}\n\t}\n\tif(miku==-1)\n\t\tfor(int i=0,t=qpow(len,mod-2);i<len;i++)\n\t\t\ta[i]=1ll*a[i]*t%mod;\n}\nvoid get_inv(int *a,int *b,int len)\n{\n\tif(len==1) {b[0]=qpow(a[0],mod-2);return;}\n\tget_inv(a,b,len>>1); int t=len<<1;\n\tfor(int i=0;i<len;i++) A[i]=a[i],B[i]=b[i];\n\tntt(A,t,1),ntt(B,t,1);\n\tfor(int i=0;i<t;i++) A[i]=((1ll*A[i]*B[i])%mod*B[i])%mod;\n\tntt(A,t,-1);\n\tfor(int i=0;i<len;i++)\n\t\tb[i]=((b[i]<<1)%mod-A[i]+mod)%mod;\n}\nint main()\n{\n\tscanf(\"%d\",&n),inv[0]=inv[1]=len=a[0]=1;\n\twhile(len<=n) len<<=1;\n\tfor(int i=2;i<=n;i++) inv[i]=mod-1ll*inv[mod%i]*(mod/i)%mod;\n\tfor(int i=3;i<=n;i++) inv[i]=1ll*inv[i-1]*inv[i]%mod;\n\tfor(int i=1;i<=n;i++) a[i]=(mod-inv[i])*2%mod;\n\tget_inv(a,b,len),ans=b[n];\n\tfor(int i=n;i;i--) ans=(1ll*ans*i%mod+b[i-1])%mod;\n\tprintf(\"%d\\n\",ans);\n}\n```",
        "postTime": 1556501091,
        "uid": 52851,
        "name": "ysy20021208",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "\u56f0\u96be\u7684\u5730\u65b9\u5176\u5b9e\u5c31\u5728\u4e8e\u63a8\u5f0f\u5b50\uff08\u63a8\u5230\u4e00\u534a\u7684\u6211\u5c45\u7136\u5fd8\u8bb0\u4e86\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\uff0c\u5b8c\u86cb\uff09\n\n# derivation\n\n$$\\sum_{i=0}^n \\sum_{j=0}^i 2^j j! \\begin{Bmatrix} i \\\\j \\end{Bmatrix} $$\n\n\u65af\u7279\u6797\u6570 $\\begin{Bmatrix} i \\\\j \\end{Bmatrix}$ \u4e2d\u7684 i \u5982\u679c\u5c0f\u4e8e j \u7684\u8bdd\u662f\u4e3a 0 \u7684\uff0c\u6240\u4ee5 j \u5f00\u5230 n \u6ca1\u5173\u7cfb\n\n$$\\sum_{i=0}^n \\sum_{j=0}^n 2^j j! \\begin{Bmatrix} i \\\\j \\end{Bmatrix} $$\n\n\u63a5\u4e0b\u6765\u662f\u5957\u8def\u7684\u79fb\u9879\n\n$$ \\sum_{j=0}^n 2^j j!\\sum_{i=0}^n \\begin{Bmatrix} i \\\\j \\end{Bmatrix} $$\n\n\u7136\u540e\u5c31\u662f\u7528\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u7684\u516c\u5f0f\u5e26\u5165\n\n$$ \\sum_{j=0}^n 2^j j!\\sum_{i=0}^n {1\\over j!}\\sum_{k=0}^j (-1)^k \\Big( \\begin{matrix} j\\\\k \\end{matrix}  \\Big) (j-k)^i $$\n\n\u5404\u79cd\u5316\u7b80\u4e4b\u540e\u5c31\u662f\n\n\n$$ \\sum_{j=0}^n 2^j j!\\sum_{i=0}^n \\sum_{k=0}^j {(-1)^k\\over k!}  {(j-k)^i\\over (j-k)!} $$\n\n\u518d\u6765\u4e00\u6ce2\u79fb\u9879\n\n$$ \\sum_{j=0}^n 2^j j!\\sum_{k=0}^j {(-1)^k\\over k!}  {\\sum_{i=0}^n (j-k)^i\\over (j-k)!} $$\n\n\n\u540e\u9762\u5c31\u662f\u6211\u8bf4\u7684\u90a3\u4e2a\u7b49\u6bd4\u516c\u5f0f\u4e86...\u6211\u4eec\u770b\u5230 $ {\\sum_{i=0}^n (j-k)^i}$ \u7b49\u4e8e $ { (j-k)^{n+1} -1 \\over (j-k)-1}$\n\n$$ \\sum_{j=0}^n 2^j j!\\sum_{k=0}^j {(-1)^k\\over k!}  {{ (j-k)^{n+1} -1 }\\over  ((j-k)-1)(j-k)!} $$\n\n\u867d\u7136\u540e\u9762\u7684\u5f0f\u5b50\u770b\u8d77\u6765\u6709\u70b9\u8be1\u5f02\uff0c\u4f46\u8fd8\u662f\u53ef\u4ee5\u770b\u51fa\u540e\u9762\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u5377\u7684\u662f j \uff0c\u6211\u4eec\u4ee4 $f(i)={(-1)^i\\over i!}$ , $g(i)={i^n\\over i!}$ \uff08\u8fd9\u91cc\u7684 n \u5176\u5b9e\u662f\u4e0a\u9762\u5f0f\u5b50\u91cc\u7684 i \uff09\uff0c\u6240\u4ee5\u539f\u5f0f\u5c31\u662f\n\n$$ \\sum_{j=0}^n 2^j j! (f* g)(j) $$\n\n\n\u90a3\u4e48\u6211\u4eec\u4e00\u904d NTT \u6c42\u51fa\u6240\u6709\u7684 $(f* g)(i), i\u2208[0,n]$ \u7136\u540e\u5e26\u5165\u5f0f\u5b50\u6c42\u89e3\u5c31\u597d\u4e86\n\n\u8fd9\u91cc\u7528\u4e86\u9884\u5904\u7406 $fac$ \u3001 $inv$ \u3001$finv$ \u7684\u65b9\u6cd5\n\n# \u5361\u5e38\u987b\u77e5\n\n>\u53ef\u4ee5\u8003\u8651\u9884\u5904\u7406\u51fa NTT \u4e2d\u4f7f\u7528\u7684 g \u6570\u7ec4\n\n>\u53ef\u4ee5\u8003\u8651\u591a\u52a0\u51e0\u4e2a register \uff08\u4f46\u8981\u505a\u597d\u4ee3\u7801\u53d8\u6162\u7684\u51c6\u5907\uff09\n\n>\u611f\u89c9\u522b\u7684\u5730\u65b9\u90fd\u6ca1\u6709\u5361\u5e38\uff08\u56e0\u4e3a\u5e73\u65f6\u5c31\u662f\u8fd9\u4e48\u5199\u7684\uff09\n\n\n# code\n\n\u5f53\u7136\u662f\u6ca1\u5361\u8fc7\u5e38\u7684\u90a3\u4efd\u3010\u6ed1\u7a3d\n\n\u8bdd\u8bf4\u4e3a\u4ec0\u4e48\u6211\u5361\u5e38\u8d8a\u5361\u8d8a\u6162\u7684\u3002\u3002\u3002\n\n\u4ee3\u7801\u538b\u7684\u592a\u8d77\u52b2\uff0c\u4f46\u5176\u5b9e\u6ca1\u4ec0\u4e48\u53c2\u8003\u4ef7\u503c\uff0c\u4e24\u4e2a\u591a\u9879\u5f0f\u6784\u9020\u4e00\u4e0b NTT \u5c31\u597d\u4e86\uff0c\u6ca1\u4ec0\u4e48\u7279\u522b\uff08\u8981\u6284\uff09\u7684\u5730\u65b9\n\n\u6ce8\u610f limit \u8981\u5f00\u7684 n* 2 \u5927...\uff08\u6211\u5c31\u662f\u8fd9\u4e48\u6302\u7684\uff09\n\n```\n//by Judge\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#define Rg register\n#define fp(i,a,b) for(Rg int i=(a),I=(b)+1;i<I;++i)\n#define fd(i,a,b) for(Rg int i=(a),I=(b)-1;i>I;--i)\n#define ll long long\nusing namespace std;\nconst int mod=998244353;\nconst int iG=332748118;\nconst int M=27e4+3;\ntypedef int arr[M];\nint n,limit,ans; arr f,g,r,fac,inv,finv;\ninline int mul(int x,int y){return 1ll*x*y%mod;}\ninline int dec(int x,int y){return x<y?x-y+mod:x-y;}\ninline int inc(int x,int y){return x+y>=mod?x+y-mod:x+y;}\ninline int qpow(int x,int p=mod-2,int s=1){\n\tfor(;p;p>>=1,x=mul(x,x)) if(p&1) s=mul(s,x); return s;\n}\ninline void get_rev(int n){ int len=-1;\n\tfor(limit=1;limit<=n<<1;limit<<=1)++len;\n\tfp(i,1,limit-1) r[i]=(r[i>>1]>>1)|((i&1)<<len);\n}\ninline void prep(){ get_rev(n),fac[0]=fac[1]=inv[0]=inv[1]=finv[0]=finv[1]=1;\n\tfp(i,2,n) fac[i]=mul(fac[i-1],i),inv[i]=mul(inv[mod%i],mod-mod/i),finv[i]=mul(finv[i-1],inv[i]);\n}\ninline void NTT(int* a,int tp){ fp(i,0,limit-1) if(i<r[i]) swap(a[i],a[r[i]]);\n\tfor(int mid=1;mid<limit;mid<<=1){ int Gn=qpow(tp?3:iG,(mod-1)/(mid<<1));\n\t\tfor(int j=0,x,y;j<limit;j+=mid<<1) for(int k=0,g=1;k<mid;++k,g=mul(g,Gn))\n\t\t\tx=a[j+k],y=mul(g,a[j+k+mid]),a[j+k]=inc(x,y),a[j+k+mid]=dec(x,y);\n\t} if(tp) return ; int inv=qpow(limit); fp(i,0,limit-1) a[i]=mul(a[i],inv);\n}\nint main(){ scanf(\"%d\",&n),prep(); int now=1;\n\tf[0]=g[0]=1,g[1]=n+1; fp(i,1,n) f[i]=mul(finv[i],i&1?mod-1:1);\n\tfp(i,2,n) g[i]=mul(dec(qpow(i,n+1),1),mul(inv[i-1],finv[i]));\n\tNTT(f,1),NTT(g,1); fp(i,0,limit-1) f[i]=mul(f[i],g[i]); NTT(f,0);\n\tfp(i,0,n) ans=inc(ans,mul(mul(now,fac[i]),f[i])),now=mul(now,2);\n\treturn !printf(\"%d\\n\",ans);\n}\n```\n\n",
        "postTime": 1554784397,
        "uid": 38576,
        "name": "J\u03bcdge",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "# \u524d\u7f6e\uff1a\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\n\u8868\u793a\u628a$n$\u4e2a\u5c0f\u7403\u653e\u5165$m$\u4e2a\u4e0d\u53ef\u533a\u5206\u7684\u76d2\u5b50\u7684\u65b9\u6848\u6570\n\n\u4f7f\u7528\u5bb9\u65a5\u539f\u7406\u5206\u6790\uff0c\u5047\u8bbe\u76d2\u5b50\u53ef\u533a\u5206\u679a\u4e3e\u81f3\u5c11\u6709\u51e0\u4e2a\u76d2\u5b50\u4e3a\u7a7a\uff0c\u5f97\u5230\u901a\u9879\uff1a\n$$S(n,m)=\\frac{1}{m!}\\sum_{k=0}^{m}(-1)^k\\binom{m}{k}(m-k)^n$$\n# \u5206\u6790\n$$f(n)=\\sum_{i=0}^n\\sum_{j=0}^iS(i,j)2^jj!$$\n\u6ce8\u610f\u5230$S(n,m)=0\\quad(m>n)$\uff0c\u56e0\u6b64\u7b2c\u4e8c\u4e2a\u6c42\u548c\u4e0a\u9650\u53ef\u6539\u4e3a$n$\uff0c\u5e76\u4ee3\u5165\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u7684\u901a\u9879\uff0c\u5f97\u5230\n$$f(n)=\\sum_{i=0}^n\\sum_{j=0}^n\\frac{1}{j!}\\sum_{k=0}^j(-1)^k\\frac{j!}{k!(j-k)!}(j-k)^i2^jj!$$\n$$=\\sum_{j=0}^n2^jj!\\sum_{k=0}^{j}\\frac{(-1)^k}{k!(j-k)!}\\sum_{i=0}^n(j-k)^i$$\n$$=\\sum_{j=0}^n2^jj!\\sum_{k=0}^{j}\\frac{(-1)^k}{k!}\\frac{\\sum_{i=0}^n(j-k)^i}{(j-k)!}$$\n\u4ee4$g(j)=\\sum_{k=0}^{j}\\frac{(-1)^k}{k!}\\frac{\\sum_{i=0}^n(j-k)^i}{(j-k)!}$,\u5219$f(n)=\\sum_{j=0}^n2^jj!g(j)$\n\n\u4ee4$a_k=\\frac{(-1)^k}{k!},b_k=\\frac{\\sum_{i=0}^nk^i}{k!}=\\frac{k^{n+1}-1}{(k-1)k!}\\quad (k>1)$\n\u5219$g=a \\otimes b$\n\u7136\u540e\u5148\u6c42\u51fa$g$\uff0c\u518d\u6c42\u51fa$f$\n# \u4ee3\u7801\n```cpp\n#include<cstdlib>\n#include<cstdio>\n#include<cmath>\n#include<cstring>\n#include<ctime>\n#include<iostream>\n#include<string>\n#include<vector>\n#include<list>\n#include<deque>\n#include<stack>\n#include<queue>\n#include<map>\n#include<set>\n#include<algorithm>\n#include<complex>\n#pragma GCC optimize (\"O3\")\n#define rg register\nusing namespace std;\ntemplate<class T> inline T read(T&x){\n    T data=0;\n\tint w=1;\n    char ch=getchar();\n    while(!isdigit(ch))\n    {\n\t\tif(ch=='-')\n\t\t\tw=-1;\n\t\tch=getchar();\n\t}\n    while(isdigit(ch))\n        data=10*data+ch-'0',ch=getchar();\n    return x=data*w;\n}\ntypedef long long ll;\n\nconst int mod=998244353,g=3;\n\nint rev[1<<18|7];\n\ninline void calrev(int lim,int l)\n{\n\trev[0]=0;\n\tfor(int i=1;i<lim;++i)\n\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<(l-1));\n}\n\ninline int qpow(int x,int k)\n{\n\tint ans=1;\n\twhile(k)\n\t{\n\t\tif(k&1)\n\t\t\tans=(ll)ans*x%mod;\n\t\tx=(ll)x*x%mod,k>>=1;\n\t}\n\treturn ans;\n}\n\ninline void FFT(int*t,int lim,int type)\n{\n\tfor(rg int i=0;i<lim;++i)\n\t\tif(i<rev[i])\n\t\t\tswap(t[i],t[rev[i]]);\n\tfor(rg int i=1;i<lim;i<<=1)\n\t{\n\t\tint gn=qpow(g,(mod-1)/(i<<1));\n\t\tif(type==-1)\n\t\t\tgn=qpow(gn,mod-2);\n\t\tfor(rg int j=0;j<lim;j+=(i<<1))\n\t\t{\n\t\t\tint gi=1;\n\t\t\tfor(rg int k=0;k<i;++k,gi=(ll)gi*gn%mod)\n\t\t\t{\n\t\t\t\tint x=t[j+k],y=(ll)gi*t[j+i+k]%mod;\n\t\t\t\tt[j+k]=x+y,t[j+i+k]=x-y+mod;\n\t\t\t\tif(t[j+k]>=mod)\n\t\t\t\t\tt[j+k]-=mod;\n\t\t\t\tif(t[j+i+k]>=mod)\n\t\t\t\t\tt[j+i+k]-=mod;\n\t\t\t}\n\t\t}\n\t}\n\tif(type==-1)\n\t{\n\t\tint inv=qpow(lim,mod-2);\n\t\tfor(rg int i=0;i<lim;++i)\n\t\t\tt[i]=(ll)t[i]*inv%mod;\n\t}\n}\n\nint fac[100010],inv[100010],pow2[100010];\n\nint a[1<<18|7],b[1<<18|7];\n\nint main()\n{\n\tint n;\n\tread(n);\n\tfac[0]=inv[0]=pow2[0]=a[0]=b[0]=1;\n\tfor(rg int i=1;i<=n;++i)\n\t{\n\t\tfac[i]=(ll)fac[i-1]*i%mod;\n\t\tinv[i]=qpow(fac[i],mod-2);\n\t\tpow2[i]=pow2[i-1]<<1;\n\t\tif(pow2[i]>=mod)\n\t\t\tpow2[i]-=mod;\n\t\ta[i]=inv[i];\n\t\tif(i&1)\n\t\t\ta[i]=mod-a[i];\n\t\tb[i]=(ll)(qpow(i,n+1)-1)%mod*inv[i]%mod*qpow(i-1,mod-2)%mod;\n\t}\n\tb[1]=n+1; \n\tint lim=1,l=0;\n\twhile(lim<=n*2) \n\t\tlim<<=1,++l;\n\tcalrev(lim,l);\n\tFFT(a,lim,1);\n\tFFT(b,lim,1);\n\tfor(rg int i=0;i<lim;++i)\n\t\ta[i]=(ll)a[i]*b[i]%mod;\n\tFFT(a,lim,-1);\n\tint f=0;\n\tfor(rg int i=0;i<=n;++i)\n\t{\n\t\tf+=(ll)pow2[i]*fac[i]%mod*a[i]%mod;\n\t\tif(f>=mod)\n\t\t\tf-=mod;\n\t}\n\tprintf(\"%d\\n\",f);\n    return 0;\n}\n\n\n```\n# Hint\n\nb1\u4e0d\u80fd\u7528\u7b49\u6bd4\u6570\u5217\u516c\u5f0f\u8ba1\u7b97\uff0c\u5fc5\u987b\u5355\u72ec\u5904\u7406\u3002\n\n\u6211\u53ea\u9700\u8981n\u9879\uff0c\u4f46\u662f\u53ea\u7b97\u5230n\u9879\u662f\u9519\u7684\uff0c\u4e3e\u4f8b\u7b54\u6848\u662f3\u6b21\u51fd\u6570\uff0c\u6211\u53ea\u9700\u89812\u9879\u5c31\u53ea\u6c42\u6c422\u9879\uff0c\u7b97\u51fa\u6765\u5c31\u662f\u4e00\u4e2a1\u6b21\u51fd\u6570\uff0c\u5c31\u662f\u9519\u7684 \n\n\u603b\u7ed3\uff1alim\u5fc5\u987b\u81f3\u5c11\u662f\u5f85\u5377\u79ef\u5f0f\u5b50\u957f\u5ea6\u7684\u4e24\u500d ",
        "postTime": 1534639273,
        "uid": 37834,
        "name": "autoint",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "# Solution\n**\u5b89\u5229\u4e2a\u4eba\u535a\u5ba2[Blog](https://blog.csdn.net/As_A_Kid)**\n\n\u53d1\u73b0\u6211\u7684\u601d\u8def\u6bd4\u8f83\u6e05\u5947\uff1f\u53ef\u80fd\u662f\u6211\u6570\u5b66\u592a\u5dee\u4e86\u60f3\u4e0d\u5230\n\n\u9996\u5148\u53ef\u4ee5\u7528\u5bb9\u65a5\u63a8\u51fa\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u7684\u901a\u9879\u516c\u5f0f~~(\u6ca1\u89c1\u8fc7\u5c31\u662f\u771f\u00b7\u63a8\u4e0d\u51fa\u6765)~~\n$$S_n^m=\\frac 1 {m!}\\sum_{i=0}^m (-1)^iC_m^i (m-i)^n=\\sum_{i=0}^m (-1)^i(i!)\\frac {(m-i)^n} {(m-i)!}$$\n\u8fd9\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5229\u7528NTT\u5728$O(n\\log n)$\u7684\u65f6\u95f4\u6c42\u51fa\u7b2cn\u884c\u7684\u65af\u7279\u6797\u6570\u3002\n\n\u6211\u4eec\u8003\u8651\u628a$2^j\\times (j!)$\u770b\u4f5c\u4e00\u4e2a\u7cfb\u6570\uff0c\u6839\u636e\u9012\u63a8\u516c\u5f0f\uff0c\u628a\u65af\u7279\u6797\u6570\u5f80\u4e0b\u4e00\u884c\u63a8\u3002\n\n\u7136\u540e\u5982\u679c\u4f60\u624b\u52a8\u6a21\u62df\u4e00\u4e0b\uff0c\u5c31\u50cf\u8fd9\u6837\uff1a\n\n![\u8868](https://cdn.luogu.com.cn/upload/pic/27967.png)\n\n\u5176\u4e2d\uff0c$S_i^i$\u7684\u7cfb\u6570\u4f1a\u6709\u5269\u4f59\uff0c\u4f46\u6211\u4eec\u77e5\u9053\u5b83\u6052\u7b49\u4e8e1\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u77e5\u9053\u5b83\u7684\u7cfb\u6570\u5373\u53ef\u3002\n\n\u53c8\u5bb9\u6613\u53d1\u73b0\uff0c\u8fd9\u4e9b\u7cfb\u6570\u662f\u6709\u89c4\u5f8b\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u9012\u63a8\u6765\u6a21\u62df\u505a\u8fd9\u6837\u7684\u4e00\u4e2a\u4e8b\u60c5\uff0c\u590d\u6742\u5ea6$O(n)$\u3002\u8f6c\u79fb\u65b9\u7a0b\u53ef\u4ee5\u53c2\u8003\u4ee3\u7801\uff0c\u5176\u4e2da\u6570\u7ec4\u4e3a$s_i^i$\u7684\u7cfb\u6570\uff0cb\u6570\u7ec4\u4e3a\u6700\u540e\u4e00\u884c\u7684\u7cfb\u6570\uff0cc\u4e3a\u7b2ci\u5217\u5411\u7b2ci+1\u5217\u7684\u8f6c\u79fb\u7cfb\u6570\u3002\u552f\u4e00\u9700\u8981\u6ce8\u610f\u7684\u662f\u7b2cn\u9879\u7684\u7cfb\u6570\u662f\u6ca1\u6709\u5f97\u5230\u52a0\u6210\u7684\uff0c\u8fd8\u662f$2^n(n!)$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n\\log n)$\u3002\n# Code\n```cpp\n#include <algorithm>\n#include <cstring>\n#include <cstdio>\n#define rg register\nusing namespace std;\ntypedef long long ll;\nconst int maxn=100010,mod=998244353,G=3;\ntemplate <typename Tp> inline void getmin(Tp &x,Tp y){if(y<x) x=y;}\ntemplate <typename Tp> inline void getmax(Tp &x,Tp y){if(y>x) x=y;}\ntemplate <typename Tp> inline void read(Tp &x)\n{\n\tx=0;char ch=getchar();int f=0;\n\twhile(ch!='-'&&(ch<'0'||ch>'9')) ch=getchar();\n\tif(ch=='-') f=1,ch=getchar();\n\twhile(ch>='0'&&ch<='9') x=x*10+ch-'0',ch=getchar();\n\tif(f) x=-x;\n}\nint n,m,tmp,N=1,l,ans,f[maxn<<2],g[maxn<<2],rev[maxn<<2];\nint fac[maxn],inv[maxn],mi[maxn],a[maxn],b[maxn],c[maxn];\ninline int pls(int x,int y){return x+y>=mod?x+y-mod:x+y;}\ninline int dec(int x,int y){return x-y<0?x-y+mod:x-y;}\nint power(int x,int y)\n{\n\tint res=1;\n\tfor(;y;y>>=1,x=(ll)x*x%mod)\n\t  if(y&1)\n\t    res=(ll)res*x%mod;\n\treturn res;\n}\nvoid init()\n{\n\tfac[0]=mi[0]=1;\n\tfor(rg int i=1;i<=n;i++)\n\t  fac[i]=(ll)fac[i-1]*i%mod,mi[i]=pls(mi[i-1],mi[i-1]);\n\tinv[n]=power(fac[n],mod-2);\n\tfor(rg int i=n-1;~i;i--) inv[i]=(ll)inv[i+1]*(i+1)%mod;\n\ta[0]=1;b[0]=1;c[0]=1;\n\tfor(rg int i=1;i<=n;i++)\n\t{\n\t\ta[i]=dec((ll)fac[i]*mi[i]%mod,(ll)i*c[i-1]%mod);\n\t\tb[i]=pls((ll)fac[i]*mi[i]%mod,c[i-1]%mod);\n\t\tc[i]=dec(b[i],(ll)i*c[i-1]%mod);\n\t}\n\tfor(rg int i=0;i<n;i++) ans=pls(ans,a[i]);\n}\nvoid ntt(int *a,int f)\n{\n\tfor(rg int i=0;i<N;i++)\n\t  if(i<rev[i]) swap(a[i],a[rev[i]]);\n\tfor(rg int i=1;i<N;i<<=1)\n\t{\n\t\tint gn=power(G,(mod-1)/(i<<1));\n\t\tfor(rg int j=0;j<N;j+=(i<<1))\n\t\t{\n\t\t\tint g=1;\n\t\t\tfor(rg int k=0;k<i;k++,g=(ll)g*gn%mod)\n\t\t\t{\n\t\t\t\tint x=a[j+k],y=(ll)g*a[j+k+i]%mod;\n\t\t\t\ta[j+k]=pls(x,y);a[j+k+i]=dec(x,y);\n\t\t\t}\n\t\t}\n\t}\n\tif(f==-1)\n\t{\n\t\tint inv=power(N,mod-2);reverse(a+1,a+N);\n\t\tfor(int i=0;i<N;i++) a[i]=(ll)a[i]*inv%mod;\n\t}\n}\nint main()\n{\n\t#ifndef ONLINE_JUDGE\n\tfreopen(\"in.txt\",\"r\",stdin);\n\t#endif\n\tread(n);\n\tinit();\n\twhile(N<(n<<1)) N<<=1,l++;\n\tfor(rg int i=1;i<N;i++) rev[i]=(rev[i>>1]>>1)|((i&1)<<(l-1));\n\tfor(rg int i=0;i<n;i++)\n\t{\n\t\tf[i]=inv[i];\n\t\tif(i&1) f[i]=dec(0,f[i]);\n\t\tg[i]=(ll)power(i,n)*inv[i]%mod;\n\t}\n\tntt(f,1);ntt(g,1);\n\tfor(rg int i=0;i<N;i++) f[i]=(ll)f[i]*g[i]%mod;\n\tntt(f,-1);\n\tfor(rg int i=0;i<n;i++) ans=pls(ans,(ll)f[i]*b[i]%mod);\n\tans=pls(ans,(ll)mi[n]*fac[n]%mod);\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1533982687,
        "uid": 20602,
        "name": "Rayment",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "\u9996\u5148\u4f60\u8981\u6709\u4fe1\u4ef0\uff0c\u4f60\u8981\u76f8\u4fe1\u539f\u5f0f\u4e2d\u7684j\u662f\u53ef\u4ee5\u679a\u4e3e\u5230n\u7684\u3002\u539f\u56e0\u5f88\u7b80\u5355\uff0c\u5f53j>i\u65f6\uff0cS(i,j)=0\uff0c\u6240\u4ee5\u5bf9\u7b54\u6848\u4e0d\u9020\u6210\u8d21\u732e\u3002\u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u505a\uff0c\u540e\u9762\u5c31\u4f1a\u77e5\u9053\n\n\u4f60\u8981\u77e5\u9053\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u5c55\u5f00\u8fd9\u79cd\u4e1c\u897f\u3002\u4e5f\u5c31\u662f$\\left\\{\\begin{aligned}n\\\\m\\end{aligned}\\right\\}m!=\\sum\\limits_{i=0}^m(-1)^i\\left(\\begin{aligned}m\\\\i\\end{aligned}\\right)(m-i)^n$\n\n\u7136\u540e\u628a\u5b83\u4ee3\u5165\u539f\u5f0f\uff0c\u5f97\u5230\uff1a$f(n)=\\sum\\limits_{i=0}^n\\sum\\limits_{j=0}^n2^j\\sum\\limits_{k=0}^j(-1)^k\\left(\\begin{aligned}j\\\\k\\end{aligned}\\right)(j-k)^i$\n\n\u628a\u7ec4\u5408\u6570\u516c\u5f0f\u4ee3\u5165\uff0c\u5f97\u5230\uff1a$f(n)=\\sum\\limits_{i=0}^n\\sum\\limits_{j=0}^n2^j\\sum\\limits_{k=0}^j(-1)^k\\frac{j!}{k!(j-k)!}(j-k)^i$\n\n\u628a$j!$\u63d0\u5230\u524d\u9762\u6765\uff0c\u628a$\\sum\\limits_{i=0}^n$\u4e22\u5230\u540e\u9762\u53bb\uff08\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u4e00\u5f00\u59cb\u8981\u628aj\u679a\u4e3e\u5230n\uff0c\u5982\u679c\u4e0d\u8fd9\u4e48\u5e72\uff0c\u679a\u4e3ei\u662f\u4e0d\u80fd\u4e22\u5230\u540e\u9762\u53bb\u7684\uff09\uff0c\u5f97\u5230\uff1a$\\sum\\limits_{j=0}^n2^jj!\\sum\\limits_{k=0}^j\\frac{(-1)^k}{k!}\\times\\frac{\\sum\\limits_{i=0}^n(j-k)^i}{(j-k)!}$\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u5b9a\u4e49\u4e24\u4e2a\u51fd\u6570\uff1a$A(x)=\\frac{(-1)^k}{k!}\\qquad B(x)=\\frac{\\sum_{i=0}^nx^i}{k!}$\n\n\u4ee3\u5165\u539f\u5f0f\uff0c\u5f97\u5230\uff1a$f(n)=\\sum\\limits_{j=0}^n2^jj!\\sum\\limits_{k=0}^jA(k)B(j-k)$\n\n\u54c7\uff0c\u540e\u9762\u8fd9\u4e2a\u6c42\u548c\uff0c\u5c45\u7136\u662f\u7f8e\u5999\u7684\u5377\u79ef\uff01\u4e8e\u662f\u6211\u4eec\u5b9a\u4e49$C(k)=\\sum\\limits_{x+y=k}A(x)B(y)$\uff0c\u7136\u540e\u539f\u5f0f\u5c31\u53ef\u4ee5\u5316\u4e3a$f(n)=\\sum\\limits_{j=0}^n2^jj!C(j)$\n\n\u9884\u5904\u7406\u9636\u4e58\u53ca\u9636\u4e58\u9006\u5143\uff0c$A$\u5c31\u53ef\u4ee5\u5728$O(n)$\u7684\u65f6\u95f4\u5185\u7b97\u51fa\u3002\u81f3\u4e8e$B$\u7684\u8bdd\uff0c\u7528\u4e00\u4e0b\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u5728$O(n)$\u7684\u65f6\u95f4\u5185\u7b97\u51fa\u3002\u7136\u540e\u7528$FFT$\u5bf9$A,B$\u505a\u4e00\u4e0b\u591a\u9879\u5f0f\u4e58\u6cd5\uff0c\u53ef\u4ee5\u5728$O(n\\;\\log\\;n)$\u7684\u65f6\u95f4\u5185\u6c42\u51fa$C$\u3002\u518d\u9884\u5904\u7406\u51fa$2$\u7684\u6240\u6709\u6b21\u5e42\u5728\u6a21\u610f\u4e49\u4e0b\u7684\u503c\uff0c\u6700\u540e\u5c31\u53ef\u4ee5$O(n)$\u7b97\u51fa$f(n)$\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u74f6\u9888\u5728\u4e8e$FFT$\uff0c\u6700\u7ec8\u603b\u7684\u590d\u6742\u5ea6\u5c31\u662f$O(n\\;\\log\\;n)$\n\n```cpp\n#include<bits/stdc++.h>\n#define ha 998244353\nusing namespace std;\n\nconst int N=270010;\nint A[N],B[N],C[N],r[N];\nint fac[N],ifac[N],pw[N];\n\nint Pow(int a,int b)\n{\n\tint ans=1;\n\tfor(;b;b>>=1,a=1ll*a*a%ha)\n\t\tif(b&1) ans=1ll*ans*a%ha;\n\treturn ans;\n}\n\nvoid NTT(int *A,int n,bool IDFT)\n{\n\tfor(int i=0;i<n;i++) r[i]=(r[i>>1]>>1)|((i&1)*(n/2));\n\tfor(int i=0;i<n;i++) if(i<r[i]) swap(A[i],A[r[i]]);\n\tfor(int i=1;i<n;i<<=1)\n\t{\n\t\tint wn=Pow(3,(ha-1)/(i<<1));\n\t\tif(IDFT) wn=Pow(wn,ha-2);\n\t\tfor(int j=0;j<n;j+=(i<<1))\n\t\t\tfor(int k=0,w=1;k<i;k++)\n\t\t\t{\n\t\t\t\tint x=A[j+k],y=1ll*w*A[i+j+k]%ha;\n\t\t\t\tA[j+k]=(x+y)%ha;\n\t\t\t\tA[i+j+k]=(x-y+ha)%ha;\n\t\t\t\tw=1ll*w*wn%ha;\n\t\t\t}\n\t}\n\tint inv=IDFT?Pow(n,ha-2):0;\n\tif(IDFT) for(int i=0;i<n;i++) A[i]=1ll*A[i]*inv%ha;\n}\n\nvoid InitFac(int n)\n{\n\tfac[0]=1;\n\tfor(int i=1;i<=n;i++)\n\t\tfac[i]=1ll*fac[i-1]*i%ha;\n\tifac[n]=Pow(fac[n],ha-2);\n\tfor(int i=n-1;i>=0;i--)\n\t\tifac[i]=1ll*ifac[i+1]*(i+1)%ha;\n}\n\nvoid InitABC(int n)\n{\n\tfor(int i=0;i<=n;i++)\n\t\tA[i]=1ll*(i&1?ha-1:1)*ifac[i]%ha;\n\tB[0]=1;B[1]=n+1;\n\tfor(int i=2;i<=n;i++)\n\t\tB[i]=1ll*(Pow(i,n+1)-1)*Pow(i-1,ha-2)%ha*ifac[i]%ha;\n\tint len;\n\tfor(len=1;len<=(n<<1);len<<=1);\n\tNTT(A,len,0);NTT(B,len,0);\n\tfor(int i=0;i<len;i++)\n\t\tC[i]=1ll*A[i]*B[i]%ha;\n\tNTT(C,len,1);\n}\n\nint main()\n{\n\tint n,ans=0;\n\tscanf(\"%d\",&n);\n\tInitFac(n);\n\tInitABC(n);\n\tpw[0]=1;\n\tfor(int i=1;i<=n;i++)\n\t\tpw[i]=2ll*pw[i-1]%ha;\n\tfor(int i=0;i<=n;i++)\n\t\tans=(ans+1ll*pw[i]*fac[i]%ha*C[i])%ha;\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1533450664,
        "uid": 20158,
        "name": "Ebola",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    },
    {
        "content": "\u4e0b\u9762\u90a3\u4f4d\u5f0f\u5b50\u597d\u50cf\u6302\u4e86\uff0c\u5e2e\u5fd9\u8865\u4e00\u4e0b\u3002\n\n\u6839\u636e\u7ec4\u5408\u610f\u4e49\uff0c\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u5177\u6709\u4ee5\u4e0b\u516c\u5f0f:\n\n$S(n,m)=\\frac{1}{m!}\\sum\\limits_{k=0}^m(-1)^{m-k}{m\\choose k}k^n$\n\n$=\\frac{1}{m!}\\sum\\limits_{k=0}^m(-1)^{m-k}\\frac{m!}{k!(m-k)!}k^n$\n\n$=\\sum\\limits_{k=0}^m\\frac{(-1)^{m-k}}{(m-k)!}*\\frac{k^n}{k!}$\n\n\n\u518d\u6ce8\u610f\u5f53$m>n$\u65f6\uff0c$S(n,m)=0$\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u5316\u5f0f\u5b50\u4e86\u3002\n\n$ans=\\sum\\limits_{i=0}^n\\sum\\limits_{j=0}^i S(i,j)2^j(j!)$\n\n$=\\sum\\limits_{i=0}^n\\sum\\limits_{j=0}^n S(i,j)2^j(j!)$\n\n$=\\sum\\limits_{j=0}^n2^j(j!)\\sum\\limits_{i=0}^n S(i,j)$\n\n$=\\sum\\limits_{j=0}^n2^j(j!)\\sum\\limits_{i=0}^n \\sum\\limits_{k=0}^j\\frac{(-1)^{j-k}}{(j-k)!}*\\frac{k^i}{k!}$\n\n$=\\sum\\limits_{j=0}^n2^j(j!)\\sum\\limits_{k=0}^j\\frac{(-1)^{j-k}}{(j-k)!}*\\sum\\limits_{i=0}^n\\frac{k^i}{k!}$\n\n$=\\sum\\limits_{j=0}^n2^j(j!)\\sum\\limits_{k=0}^j\\frac{(-1)^{j-k}}{(j-k)!}*\\frac{\\sum\\limits_{i=0}^nk^i}{k!}$\n\n\u8bbe\u51fd\u6570$f(x)=\\frac{(-1)^x}{x!}$\uff0c$g(x)=\\frac{\\sum\\limits_{i=0}^n x^i}{x!}$\uff0c\u5219\n\n$ans=\\sum\\limits_{i=0}^n 2^j(j!)(f*g)(x)$\n\n\u9884\u5904\u7406f\u548cg,\u8fd0\u7528NTT\u6c42\u89e3\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#include<ext/pb_ds/assoc_container.hpp>\n#define Rep(i,a,b) for(register int i=(a),i##end=(b);i<=i##end;++i)\n#define Repe(i,a,b) for(register int i=(a),i##end=(b);i>=i##end;--i)\n#define For(i,a,b) for(i=(a),i<=(b);++i)\n#define Forward(i,a,b) for(i=(a),i>=(b);--i)\ntemplate<typename T>inline void read(T &x)\n{\n\tT f=1;x=0;char c;\n\tfor(c=getchar();!isdigit(c);c=getchar())if(c=='-')f=-1;\n\tfor(;isdigit(c);c=getchar())x=x*10+(c^48);\n\tx*=f;\n}\nusing namespace std;\nvoid file()\n{\n#ifndef ONLINE_JUDGE\n\tfreopen(\"b.in\",\"r\",stdin);\n\tfreopen(\"b.out\",\"w\",stdout);\n#endif\n}\nconst int MAXN=(1<<19)+7;\nconst int mod=998244353,g=3;\nstatic int n,m,rev[MAXN],a[MAXN],b[MAXN];\ninline int power(int a,int b)\n{\n\tstatic int sum;\n\tfor(sum=1;b;b>>=1,a=1ll*a*a%mod)if(b&1)\n\t\tsum=1ll*sum*a%mod;\n\treturn sum;\n}\ninline void NTT(int X[],int type)\n{\n\tRep(i,1,m-1)if(i<rev[i])swap(X[i],X[rev[i]]);\n\tstatic int i,j,k,t,w,wn,kk;\n\tfor(i=2;i<=m;i<<=1)\n\t{\n\t\tkk=i>>1;wn=power(g,(mod-1)/i);\n\t\tif(type==-1)wn=power(wn,mod-2);\n\t\tfor(j=0;j<m;j+=i)\n\t\t{\n\t\t\tw=1;\n\t\t\tfor(k=0;k<kk;++k,w=1ll*w*wn%mod)\n\t\t\t{\n\t\t\t\tt=1ll*X[j+k+kk]*w%mod;\n\t\t\t\tX[j+k+kk]=(X[j+k]-t+mod)%mod;\n\t\t\t\tX[j+k]=(X[j+k]+t)%mod;\n\t\t\t}\n\t\t}\n\t}\n\tif(type==-1)\n\t{\n\t\tstatic int inv=power(m,mod-2);\n\t\tRep(i,0,m-1)X[i]=(1ll*X[i]*inv)%mod;\n\t}\n}\ninline void solve()\n{\n\ta[0]=1;\n\tRep(i,1,n)a[i]=1ll*a[i-1]*i%mod;\n\ta[n]=power(a[n],mod-2);\n\tRepe(i,n-1,0)a[i]=1ll*a[i+1]*(i+1)%mod;\n\tRep(i,0,n)\n\t{\n\t\tb[i]=a[i];\n\t\tif(i==1)b[i]=1ll*b[i]*(n+1)%mod;\n\t\telse b[i]=1ll*b[i]*(power(i,n+1)-1)%mod*power(i-1,mod-2)%mod;\n\t}\n\tRep(i,0,n/2)a[(i<<1)|1]=1ll*(mod-1)*a[(i<<1)|1]%mod;\n\tstatic int len=0,ans=0,las=1;\n\tfor(m=2;m<=(n<<1);m<<=1,++len);\n\tRep(i,1,m-1)rev[i]=(rev[i>>1]>>1)|((i&1)<<len);\n\tNTT(a,1);NTT(b,1);\n\tRep(i,0,m-1)a[i]=(1ll*a[i]*b[i])%mod;\n\tNTT(a,-1);\n\tRep(i,0,n)\n\t{\n\t\tans=((ans+1ll*las*a[i]%mod)%mod+mod)%mod;\n\t\tlas=1ll*(las<<1)%mod*(i+1)%mod;\n\t}\n\tprintf(\"%d\\n\",ans);\n}\nint main()\n{\n\tfile();\n\tread(n);\n\tsolve();\n\treturn 0;\n}\n```",
        "postTime": 1520161108,
        "uid": 7035,
        "name": "Great_Influence",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4091 \u3010[HEOI2016/TJOI2016]\u6c42\u548c\u3011"
    }
]