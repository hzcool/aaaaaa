[
    {
        "content": "\u663e\u7136\u79bb\u7ebf\u5904\u7406\uff0c\u5c06\u8be2\u95ee\u548c\u7403\u5458\u5206\u522b\u6309\u7167\u5e74\u9f84\u6392\u5e8f\uff0c\u7136\u540e\u4f9d\u6b21\u5904\u7406\u8be2\u95ee\u7684\u65f6\u5019\u5148\u6bcf\u6b21\u6dfb\u52a0\u5f53\u524d\u53ef\u884c\u7684\u7403\u5458\u7684 $skill$ \u503c\u3002\u7136\u540e\u6839\u636e\u8d2a\u5fc3\uff0c\u5c06\u5f53\u524d\u5df2\u7ecf\u6dfb\u52a0\u7684\u7403\u5458\u7684 $skill$ \u503c\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff0c\u7136\u540e\u9694\u4e00\u4e2a\u9009\u4e00\u4e2a\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(mn \\log n)$\u3002\n\n\u4e3b\u8981\u95ee\u9898\u5728\u4e8e\u5982\u4f55\u53bb\u5feb\u901f\u7ef4\u62a4\u7403\u5458\u7684 $skill$ \u503c\u3002\n\n\u8003\u8651\u4f7f\u7528\u7ebf\u6bb5\u6811\uff0c\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u7403\u5458 $skill$ \u503c\u662f\u6240\u6709\u7403\u5458\u4e2d\u7b2c\u51e0\u5c0f\u7684\uff08\u6ce8\u610f\u4e0d\u8981\u53bb\u91cd\uff09\uff0c\u8bb0\u4e3a $id$\uff0c\u6bcf\u4e2a\u8282\u70b9\u8bb0\u5f55\u4ee5\u4e0b\u4fe1\u606f\uff08\u8bbe\u8be5\u8282\u70b9\u8303\u56f4\u4e3a $[l,r]$\uff0c\u4e0b\u9762\u6240\u8c13\u201c\u9009 $x$\u201d\u8868\u793a\u9009\u53d6 $id$ \u4e3a $x$ \u7684\u7403\u5458\uff09\uff1a\n\n- $ch_0$\uff1a\u8868\u793a\u82e5 $r+1$ \u4e0d\u9009\uff0c\u5219 $l$ \u9009\u8fd8\u662f\u4e0d\u9009\uff0c\u4e0d\u9009\u4e3a $0$\uff0c\u9009\u4e3a $1$\u3002\n- $ch_1$\uff1a\u8868\u793a\u82e5 $r+1$ \u9009\uff0c\u5219 $l$ \u9009\u8fd8\u662f\u4e0d\u9009\uff0c\u4e0d\u9009\u4e3a $0$\uff0c\u9009\u4e3a $1$\u3002\n- $cnt_0$\uff1a\u8868\u793a\u82e5 $r+1$ \u4e0d\u9009\uff0c\u5219 $[l,r]$ \u4e2d\u9009\u51e0\u4e2a\u3002\n- $cnt_1$\uff1a\u8868\u793a\u82e5 $r+1$ \u9009\uff0c\u5219 $[l,r]$ \u4e2d\u9009\u51e0\u4e2a\u3002\n- $val_0$\uff1a\u8868\u793a\u82e5 $r+1$ \u4e0d\u9009\uff0c\u5219\u5728 $[l,r]$ \u4e2d\u9009\u53ef\u4ee5\u83b7\u5f97\u7684\u6700\u5927\u4f18\u79c0\u7a0b\u5ea6\u3002\n- $val_1$\uff1a\u8868\u793a\u82e5 $r+1$ \u9009\uff0c\u5219\u5728 $[l,r]$ \u4e2d\u9009\u53ef\u4ee5\u83b7\u5f97\u7684\u6700\u5927\u4f18\u79c0\u7a0b\u5ea6\u3002\n\n\u4e8e\u662f\u5c31\u53ef\u4ee5\u5199\u51fa push_up \u64cd\u4f5c\uff1a\n\n```\ninline Node push_up(int u,int v){\n\tNode ret;\n\tret.ch[0]=tree[u].ch[tree[v].ch[0]];\n\tret.ch[1]=tree[u].ch[tree[v].ch[1]];\n\tret.cnt[0]=tree[v].cnt[0]+tree[u].cnt[tree[v].ch[0]];\n\tret.cnt[1]=tree[v].cnt[1]+tree[u].cnt[tree[v].ch[1]];\n\tret.val[0]=tree[v].val[0]+tree[u].val[tree[v].ch[0]];\n\tret.val[1]=tree[v].val[1]+tree[u].val[tree[v].ch[1]];\n\treturn ret;\n}\n```\n\n\u7136\u540e\u5c31\u662f\u7ebf\u6bb5\u6811\u677f\u5b50\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+m)\\log n)$\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\ntypedef long long ll;\nconst int N=3e5+5;\nint n,m,dy[N];ll ans[N];\nstruct Node{\n\tint ag,sk,id;\n\tbool operator < (const Node &rhs) const{\n\t\treturn ag<rhs.ag;\n\t}\n}a[N];\nbool cmp(Node _1,Node _2){\n\treturn _1.sk<_2.sk;\n}\nstruct Query{\n\tint ag,nm,id;\n\tbool operator < (const Query &rhs) const{\n\t\treturn ag<rhs.ag;\n\t}\n}q[N];\nstruct Segment_Tree{\n\tstruct Node{\n\t\tbool ch[2];\n\t\tint cnt[2];ll val[2];\n\t}tree[N<<2];\n\tinline int ls(int u){return u<<1;}\n\tinline int rs(int u){return u<<1|1;}\n\tinline Node push_up(int u,int v){\n\t\tNode ret;\n\t\tret.ch[0]=tree[u].ch[tree[v].ch[0]];\n\t\tret.ch[1]=tree[u].ch[tree[v].ch[1]];\n\t\tret.cnt[0]=tree[v].cnt[0]+tree[u].cnt[tree[v].ch[0]];\n\t\tret.cnt[1]=tree[v].cnt[1]+tree[u].cnt[tree[v].ch[1]];\n\t\tret.val[0]=tree[v].val[0]+tree[u].val[tree[v].ch[0]];\n\t\tret.val[1]=tree[v].val[1]+tree[u].val[tree[v].ch[1]];\n\t\treturn ret;\n\t}\n\tinline void update(int u,int l,int r,int p,int x){\n\t\tif(l==r){\n\t\t\ttree[u].ch[0]=tree[u].cnt[0]=1;\n\t\t\ttree[u].val[0]=x;return;\n\t\t}\n\t\tint mid=l+r>>1;\n\t\tif(mid>=p)update(ls(u),l,mid,p,x);\n\t\telse update(rs(u),mid+1,r,p,x);\n\t\ttree[u]=push_up(ls(u),rs(u));\n\t}\n\tinline ll query(int u,int l,int r,int x,bool key){\n\t\tif(l==r)return tree[u].val[key];\n\t\tint mid=l+r>>1;\n\t\tif(tree[rs(u)].cnt[key]>=x)return query(rs(u),mid+1,r,x,key);\n\t\treturn tree[rs(u)].val[key]+query(ls(u),l,mid,x-tree[rs(u)].cnt[key],tree[rs(u)].ch[key]);\n\t}\n}t;\nint main(){\n\tcin>>n;\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%d%d\",&a[i].ag,&a[i].sk),a[i].id=i;\n\tsort(a+1,a+n+1,cmp);\n\tfor(int i=1;i<=n;i++)\n\t\tdy[a[i].id]=i;\n\tsort(a+1,a+n+1);\n\tcin>>m;\n\tfor(int i=1;i<=m;i++)\n\t\tscanf(\"%d%d\",&q[i].ag,&q[i].nm),q[i].id=i;\n\tsort(q+1,q+m+1);\n\tfor(int i=1,j=1;i<=m;i++){\n\t\twhile(j<=n&&a[j].ag<=q[i].ag)\n\t\t\tt.update(1,1,n,dy[a[j].id],a[j].sk),j++;\n\t\tans[q[i].id]=t.query(1,1,n,q[i].nm,0);\n\t}\n\tfor(int i=1;i<=m;i++)\n\t\tprintf(\"%lld\\n\",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1643717049,
        "uid": 115668,
        "name": "y0y68",
        "ccfLevel": 0,
        "title": "P8065 \u9898\u89e3"
    }
]