[
    {
        "content": "\u8fd9\u9898\u5176\u5b9e\u5c31\u662fP3373\u3010\u6a21\u677f\u3011\u7ebf\u6bb5\u68112\uff0c\u53ea\u8981\u6539\u52a8\u4e00\u53e5\u8bdd\u5c31\u80fd\u8fc7\u3002\u6211\u5728\u505a\u8fd9\u9898\u65f6\u53c8\u6253\u4e86\u4e00\u904d\uff0c\u6bd5\u7adf\u7ebf\u6bb5\u6811\u4e0d\u719f\uff0c\u6253\u51e0\u904d\u90fd\u4e0d\u5acc\u591a\u3002\n\u5199\u8fd9\u7bc7\u9898\u89e3\u7684\u4e3b\u8981\u76ee\u7684\u662f\u76f8\u5f53\u4e8e\u505a\u4e00\u4e2a\u7b14\u8bb0\uff0c\u6700\u597d\u80fd\u5e2e\u5230\u5927\u5bb6\u3002\n\u56e0\u4e3a\u4e58\u7684\u8fd0\u7b97\u7ea7\u522b\u6bd4\u52a0\u9ad8\uff0c\u6240\u4ee5\u5728\u505a\u52a0\u6cd5\u662f\u4e0d\u7528\u7ba1\u4e58\u6cd5\uff0c\u5728\u505a\u4e58\u6cd5\u65f6\u8981\u7ba1\u52a0\u6cd5\u3002\u53ea\u8981\u7406\u89e3\u4e86\u8fd9\u70b9\uff0c\u7a0b\u5e8f\u5c31\u80fd\u770b\u61c2\u4e86\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define update tr[t].su=tr[t<<1].su+tr[t<<1|1].su;if (tr[t].su>=M) tr[t].su-=M;\n//\u6bcf\u4e2a\u5b50\u7a0b\u5e8f\u6700\u540e\u90fd\u8981\u5199\u8fd9\u53e5\uff0c\u66f4\u65b0tr[t].su\ntypedef long long ll;\nconst int N=100003;\nstruct kk{\n\tll mu,su,ad;\n    //mu\u662f\u7ef4\u62a4\u4e58\u79ef\u7684\u61d2\u60f0\u6807\u8bb0\uff0csu\u662f\u533a\u95f4\u548c\uff0cad\u662f\u52a0\n    //\u8981\u6ce8\u610fsu\u548cad\u7684\u533a\u522b\n}tr[N<<2];//4\u500d\u7a7a\u95f4\nint n,M,i,a[N],op,x,y,m;\nll read(){\n    ll x=0;\n    char ch;\n    do ch=getchar();while (ch<'0'||ch>'9');\n    while (ch>='0' && ch<='9') x=(x<<3)+(x<<1)+(ch^48),ch=getchar();\n    return x;\n}\nvoid build(int t,int l,int r){\n\ttr[t].mu=1;\n\tif (l==r){\n\t\ttr[t].su=a[l];\n\t\treturn;\n\t}\n\tint mid=l+r>>1;\n\tbuild(t<<1,l,mid);\n\tbuild(t<<1|1,mid+1,r);\n\tupdate;\n}\nvoid maintain(int t,int k){//\u7ef4\u62a4su,mu\u548cad\n\ttr[t<<1].su=(tr[t<<1].su*tr[t].mu+tr[t].ad*(k+1>>1))%M;\n\ttr[t<<1|1].su=(tr[t<<1|1].su*tr[t].mu+tr[t].ad*(k>>1))%M;\n\ttr[t<<1].mu=tr[t<<1].mu*tr[t].mu%M;\n\ttr[t<<1|1].mu=tr[t<<1|1].mu*tr[t].mu%M;\n\ttr[t<<1].ad=(tr[t<<1].ad*tr[t].mu+tr[t].ad)%M;\n\ttr[t<<1|1].ad=(tr[t<<1|1].ad*tr[t].mu+tr[t].ad)%M;\n\ttr[t].mu=1;tr[t].ad=0;\n}\nvoid cheng(int t,int l,int r,ll val){\n\tif (x<=l && r<=y){\n\t\ttr[t].mu=tr[t].mu*val%M;\n\t\ttr[t].ad=tr[t].ad*val%M;\n\t\ttr[t].su=tr[t].su*val%M;\n\t\treturn;\n\t}\n\tmaintain(t,r-l+1);\n\tint mid=l+r>>1;\n\tif (x<=mid) cheng(t<<1,l,mid,val);\n\tif (mid<y) cheng(t<<1|1,mid+1,r,val);\n\tupdate;\n}\nvoid jia(int t,int l,int r,ll val){\n\tif (x<=l && r<=y){\n\t\ttr[t].ad+=val;\n\t\tif (tr[t].ad>=M) tr[t].ad-=M;\n\t\ttr[t].su=(tr[t].su+(r-l+1)*val)%M;\n\t\treturn;\n\t}\n\tmaintain(t,r-l+1);\n\tint mid=l+r>>1;\n\tif (x<=mid) jia(t<<1,l,mid,val);\n\tif (mid<y) jia(t<<1|1,mid+1,r,val);\n\tupdate;\n}\nll query(int t,int l,int r){\n\tif (x<=l && r<=y) return tr[t].su;\n\tmaintain(t,r-l+1);\n\tint mid=l+r>>1;\n\tll ans=0;\n\tif (x<=mid) ans+=query(t<<1,l,mid);\n\tif (mid<y) ans+=query(t<<1|1,mid+1,r);\n\tif (ans>=M) ans-=M;\n\tupdate;\n\treturn ans;\n}\nint main(){\n\tn=read();M=read();\n\tfor (i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\tbuild(1,1,n);\n\tm=read();\n\twhile (m--){\n\t\top=read();x=read();y=read();\n\t\tif (op==1) cheng(1,1,n,read());\n\t\tif (op==2) jia(1,1,n,read());\n\t\tif (op==3) printf(\"%lld\\n\",query(1,1,n));\n\t}\n}\n```",
        "postTime": 1517576439,
        "uid": 22469,
        "name": "Mingoal",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "## pt.1 \u524d\u8a00\n\n\u8fd9\u662f\u4e00\u9053\u7ebf\u6bb5\u6811\u9898\n\n\u800c\u4e14\u662f\u4e00\u9053\u7ebf\u6bb5\u6811\u88f8\u9898\n\n### \u800c\u4e14\u662f\u4e00\u9053\u7ebf\u6bb5\u6811\u6a21\u677f\u9898!!!\n\n[\u94fe\u63a5 : p3373 \u7ebf\u6bb5\u68112](https://www.luogu.org/problem/P3373)\n\n\u4f60\u4f1a\u60ca\u5947\u7684\u53d1\u73b0 , \u53ea\u6709\u8f93\u5165\u90e8\u5206\u7684\u4e00\u4e2a\u6570\u636e\u7684\u4f4d\u7f6e\u4e0d\u4e00\u6837 : \n\n\u64cd\u4f5c\u603b\u6570$m$\u8dd1\u5230\u6570\u5217$a[i]$\u540e\u9762\u53bb\u4e86\u800c\u5df2 , \u5176\u4ed6\u51e0\u4e4e\u5b8c\u5168\u4e00\u6837\n\n\u5173\u4e8e\u7ebf\u6bb5\u6811 , \u53ef\u4ee5\u53bb[OI Wiki](https://oi-wiki.org/ds/seg/)\u5eb7\u5eb7 , \u6211\u89c9\u5f97\u90a3\u91cc\u7684\u56fe\u5f88\u597d\n\n-----\n## pt.2 \u89e3\u9898\n\n\u4e0d\u96be\u770b\u51fa , \u6211\u4eec\u53ea\u8981\u5bf9\u8fd9\u4e2a\u533a\u95f4\u8fdb\u884c\u533a\u95f4\u4fee\u6539(\u52a0 , \u4e58)\u548c\u533a\u95f4\u67e5\u8be2(\u6c42\u548c)\u5373\u53ef\n\n### 2.1 \u5efa\u6811\n\u5bf9\u4e8e\u533a\u95f4\u4fee\u6539\u548c\u67e5\u8be2 , \u65e2\u7136\u662f$log$\u7684\u64cd\u4f5c , \u90a3\u4e48\u80af\u5b9a\u662f\u8981\u4e8c\u5206\u7684\n\n\u6211\u4eec\u77e5\u9053 , \u7ebf\u6bb5\u6811\u5c06\u6bcf\u4e2a\u957f\u5ea6\u4e0d\u4e3a1\u7684\u533a\u95f4\u5212\u5206\u6210\u5de6\u53f3\u4e24\u4e2a\u533a\u95f4\u9012\u5f52\u6c42\u89e3 ,\n\n\u628a\u6574\u4e2a\u7ebf\u6bb5\u5212\u5206\u4e3a\u4e00\u4e2a\u6811\u5f62\u7ed3\u6784 ,\n\n\u901a\u8fc7\u5408\u5e76\u5de6\u53f3\u4e24\u533a\u95f4\u4fe1\u606f\u6765\u6c42\u5f97\u8be5\u533a\u95f4\u7684\u4fe1\u606f ,\n\n\u8fd9\u79cd\u6570\u636e\u7ed3\u6784\u53ef\u4ee5\u65b9\u4fbf\u7684\u8fdb\u884c\u5927\u90e8\u5206\u7684\u533a\u95f4\u64cd\u4f5c\u3002\n\n\u5047\u8bbe\u6211\u4eec\u7528\u4e00\u4e2a\u6570\u7ec4$sum[i]$\u5b58\u7ebf\u6bb5\u6811\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u4ee51\u4e3a\u6839\u8282\u70b9\u5b58\u50a81\u5230n\u7684\u548c(\u5373$sum[1]$\u4ee3\u88681\u5230n\u6240\u6709\u6570\u7684\u548c)\n\n\u7136\u540e\u518d\u9012\u5f52\u5230\u5176\u5de6\u5b50\u8282\u70b9\u548c\u53f3\u5b50\u8282\u70b9\u7f29\u5c0f\u533a\u95f4\n\n(\u5373$sum[2]$\u5b581\u5230n/2\u7684\u548c , $sum[3]\u5b58n/2+1\u5230n\u7684\u548c , \u5982\u6b64\u7c7b\u63a8 , \u76f4\u5230\u9012\u5f52\u5230\u5de6\u53f3\u7aef\u70b9\u76f8\u7b49\u4e3a\u6b62)\n\n\u7531\u6b64\u8fc7\u7a0b\u53ef\u5f97\u5bf9\u4e8e\u7ebf\u6bb5\u6811\u4e0a\u6bcf\u4e00\u4e2a\u8282\u70b9 , \u8981\u4e48\u6ca1\u6709\u513f\u5b50 , \u8981\u4e48\u67092\u4e2a\u513f\u5b50 ,\n\n\u4e14\u8fd9\u4e24\u4e2a\u5b50\u8282\u70b9\u7f16\u53f7\u5206\u522b\u4e3a$2*i$  (\u4e0b\u7528ls(i)\u4ee3\u66ff) \u548c $2*i+1$ (\u4e0b\u7528rs(i)\u4ee3\u66ff) \n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5bb9\u6613\u7684\u5efa\u7acb\u4e00\u68f5\u7ebf\u6bb5\u6811\u5566\n```cpp\nvoid build(ll p,ll l,ll r){//\u5f53\u524d\u5efa\u7acb\u8282\u70b9p , \u5efa\u6811\u533a\u95f4l\u5230r\n\tlll[p]=l,rrr[p]=r; //\u4e24\u4e2a\u6570\u7ec4\u5206\u522b\u8bb0\u5f55\u5f53\u524d\u8282\u70b9\u5de6\u53f3\u4ee3\u8868\u7684\u533a\u95f4\n\tif(l==r){ \n\t\tsum[p]=a[l]%md; //\u5de6\u53f3\u7aef\u70b9\u76f8\u7b49 , \u5230\u8fbe\u9012\u5f52\u8fb9\u754c\n\t\treturn;\n\t}\n\tll mid=(l+r)>>1;\n\tbuild(ls(p),l,mid);  //\u9012\u5f52\u5230\u5b83\u7684\u5de6\u5b50\n\tbuild(rs(p),mid+1,r);  //\u9012\u5f52\u5230\u5b83\u7684\u53f3\u5b50\n\tsum[p]=sum[ls(p)]+sum[rs(p)]%md;  //\u8ba1\u7b97\u51fa\u5f53\u524d\u8282\u70b9\u7684\u6c42\u548c\n}\n```\n----\n### 2.2 \u533a\u95f4\u4fee\u6539\n**2.2.1 \u61d2\u6807\u8bb0**\n\n\u800c\u5bf9\u4e8e\u533a\u95f4\u4fee\u6539 , \u6211\u4eec\u5f15\u5165\u4e86\u4e00\u4e2a\u53eb\u61d2\u6807\u8bb0\u7684\u4e1c\u897f\n\n\u6240\u8c13\u61d2\u6807\u8bb0 , \u7b80\u5355\u6765\u8bb2 , \u5c31\u662f\u5f53\u52a0\u6cd5\u64cd\u4f5c\u5c06\u8981\u4ece\u7236\u8282\u70b9\u4f20\u7ed9\u5b50\u8282\u70b9\u65f6 ,\n\n\u4e3a\u4e86\u8282\u7701\u64cd\u4f5c , \u5148\u5c06\u52a0\u6cd5\u64cd\u4f5c\u4ee5\u6807\u8bb0\u7684\u5f62\u5f0f\u5b58\u7740 , \n\n\u7b49\u5230\u9700\u8981\u4fee\u6539\u65f6\u5728\u628a\u6807\u8bb0\u4e0b\u4f20\n\n\u4e00\u4e2a~~\u4eceOI Wiki\u4e0a\u627e\u7684~~\u5c0f\u6545\u4e8b , \u6709\u52a9\u4e8e\u7406\u89e3\u61d2\u6807\u8bb0\n```\nA \u6709\u4e24\u4e2a\u513f\u5b50\uff0c\u4e00\u4e2a\u662f B\uff0c\u4e00\u4e2a\u662f C\u3002\n\n\u6709\u4e00\u5929 A \u8981\u5efa\u4e00\u4e2a\u65b0\u623f\u5b50\uff0c\u6ca1\u94b1\u3002\u521a\u597d\u8fc7\u5e74\u561b\uff0c\u6709\u4eba\u8981\u7ed9 B \u548c C \u7ea2\u5305\uff0c\n\u4e24\u4e2a\u7ea2\u5305\u7684\u94b1\u6570\u76f8\u540c\u90fd\u662f1\u5143\uff0c\u7136\u800c\u56e0\u4e3a A \u662f\u7236\u4eb2\u6240\u4ee5\u7ea2\u5305\u80af\u5b9a\u662f\u5148\u585e\u7ed9 A \u54af~\n\n\u7406\u8bba\u4e0a\u6765\u8bb2 A \u5e94\u8be5\u628a\u4e24\u4e2a\u7ea2\u5305\u5206\u522b\u7ed9 B \u548c C\uff0c\n\u4f46\u662f\u2026\u2026\u7f3a\u94b1\u561b\uff0cA \u5c31\u628a\u7ea2\u5305\u5077\u5077\u6536\u5230\u81ea\u5df1\u53e3\u888b\u91cc\u4e86\u3002\n\nA \u9ad8\u5174\u5730\u8bf4\uff1a\u300c\u6211\u73b0\u5728\u67092\u4efd\u7ea2\u5305\u4e86\uff01\u6211\u53c8\u591a\u4e862*1=2\u5143\u4e86\uff01\u54c8\u54c8\u54c8~\u300d\n\n\u4f46\u662f A \u77e5\u9053\uff0c\u5982\u679c\u4ed6\u4e0d\u628a\u7ea2\u5305\u7ed9 B \u548c C\uff0c\u90a3 B \u548c C \u80af\u5b9a\u4f1a\u4e0d\u723d\uff0c\n\u81f4\u5bb6\u5ead\u77db\u76fe\u6700\u540e\u5d29\u6e83\uff0c\u6240\u4ee5 A \u5bf9\u513f\u5b50 B \u548c C \u8bf4\uff1a\n\n\u300c\u6211\u6b20\u4f60\u4eec\u6bcf\u4eba1\u4efd1\u5143\u7684\u7ea2\u5305\uff0c\u4e0b\u6b21\u6709\u65b0\u7ea2\u5305\u7ed9\u8fc7\u6765\u7684\u65f6\u5019\u518d\u7ed9\u4f60\u4eec\uff01\n\u8fd9\u91cc\u6211\u5148\u505a\u4e0b\u8bb0\u5f55\u2026\u2026\u55ef\u2026\u2026\u6211\u6b20\u4f60\u4eec\u54041\u5143\u2026\u2026\u300d\n\n\u513f\u5b50 B\u3001C \u6709\u70b9\u607c\u6012\uff1a\u300c\u53ef\u662f\u5982\u679c\u6709\u540c\u5b66\u95ee\u8d77\u6211\u4eec\u6211\u4eec\u6536\u5230\u4e86\u591a\u5c11\u7ea2\u5305\u548b\u529e\uff1f\n\u4f60\u628a\u6211\u4eec\u7684\u7ea2\u5305\u90fd\u6536\u4e86\uff0c\u6211\u4eec\u8fd8\u600e\u4e48\u88c5\uff1f\u300d\n\n\u7236\u4eb2 A \u8d76\u5fd9\u8bf4\uff1a\u300c\u6709\u540c\u5b66\u95ee\u8d77\u6765\u6211\u5c31\u4f1a\u7ed9\u4f60\u4eec\u7684\uff01\u6211\u6b20\u6761\u90fd\u5199\u597d\u4e86\u4e0d\u4f1a\u4e0d\u7b97\u8bdd\u7684\uff01\u300d\n\n\u8fd9\u6837 B\u3001C \u624d\u653e\u4e86\u5fc3\u3002\n```\n\u5728\u61d2\u6807\u8bb0\u4e0b\u4f20\u7684\u540c\u65f6\u9700\u6ce8\u610f\u7684\u70b9 :\n- \u61d2\u6807\u8bb0\u4e0d\u80fd\u91cd\u590d\u4e0b\u4f20 , \u4f20\u5b8c\u5fc5\u987b\u6e05\u96f6 ; \u4f46\u662f\u4f5c\u4e3a\u6700\u7ec8\u7b54\u6848\u7684\u533a\u95f4\u548c\u4e0d\u7528\u6e05\u96f6\n- \u61d2\u6807\u8bb0\u4e0b\u4f20\u7684\u65f6\u5019 , \u7531\u4e8e\u4e00\u4e2a\u8282\u70b9\u53ef\u4ee5\u5bf9\u5e94\u591a\u4e2a\u539f\u6570\u7ec4\u5143\u7d20\u6240\u5bf9\u5e94\u7684\u533a\u95f4 , \u6240\u4ee5\u4f20\u6807\u8bb0\u7684\u65f6\u5019\u8fd9\u4e2a\u533a\u95f4\u5305\u542b\u4e86\u51e0\u4efd\u5143\u7d20\u5c31\u8981\u4e0b\u4f20\u591a\u5c11\u4e2a\u6807\u8bb0\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5bb9\u6613\u7684\u8fdb\u884c\u61d2\u6807\u8bb0\u4e0b\u4f20\u5566\n```cpp\nvoid pushdown(ll p){ //\u4ecep\u8282\u70b9\u5f00\u59cb\u4e0b\u4f20\n\tsum[ls(p)]=(mu[p]*sum[ls(p)]+(rrr[ls(p)]-lll[ls(p)]+1)*add[p]%md)%md; \n   //\u5c06\u533a\u95f4\u548c\u4ecep\u4f20\u9012\u5230\u5176\u5de6\u5b50 , \u4e0b\u540c\n\tsum[rs(p)]=(mu[p]*sum[rs(p)]+(rrr[rs(p)]-lll[rs(p)]+1)*add[p]%md)%md; \n   //\u5c06\u533a\u95f4\u548c\u4ecep\u4f20\u9012\u5230\u5176\u53f3\u5b50 , \u4e0b\u540c\n\tmu[ls(p)]=(mu[p]*mu[ls(p)])%md;\n\tmu[rs(p)]=(mu[p]*mu[rs(p)])%md;\n   //\u4e58\u6cd5\u8fd0\u7b97\u61d2\u6807\u8bb0\u4e0b\u4f20\n\tadd[ls(p)]=(mu[p]*add[ls(p)]+add[p])%md;\n\tadd[rs(p)]=(mu[p]*add[rs(p)]+add[p])%md; \n   //\u52a0\u6cd5\u8fd0\u7b97\u61d2\u6807\u8bb0\u4e0b\u4f20\n\tmu[p]=1,add[p]=0; \n   //\u6e05\u7a7a\u61d2\u6807\u8bb0(\u6ce8\u610f:\u7531\u4e8e0\u4e58\u4efb\u4f55\u6570\u90fd\u5f970,\u6240\u4ee5\u4e58\u6cd5\u6807\u8bb0\u4f20\u4e3a1,\u52a0\u6cd5\u6807\u8bb0\u4f20\u4e3a0)\n}\n```\n---\n **2.2.2 \u52a0\u6cd5\u548c\u4e58\u6cd5\u7684\u987a\u5e8f**\n\n\u6709\u4e86\u61d2\u6807\u8bb0 , \u6211\u4eec\u5c31\u53ef\u4ee5\u5728$logn$\u7684\u65f6\u95f4\u91cc\u8fdb\u884c\u533a\u95f4\u4fee\u6539\u4e86\n\n\u4f46\u662f\u533a\u95f4\u4fee\u6539\u8fd8\u6709\u4e00\u4e2a\u6ce8\u610f\u4e8b\u9879 , \u90a3\u5c31\u662f**\u5148\u4e58\u540e\u52a0** , \u4e58\u6cd5\u8fd0\u7b97\u4f1a\u5f71\u54cd\u52a0\u6cd5\u8fd0\u7b97 ,\n\n\u56e0\u4e3a\u5982\u679c\u5148\u52a0\u540e\u4e58\u7684\u8bdd , \u5728\u8fdb\u884c\u52a0\u6cd5\u64cd\u4f5c\u65f6 ,\n\n\u8fd8\u9700\u8981\u7ed9\u4e58\u6cd5\u6807\u8bb0\u8fdb\u884c\u4e58\u6cd5\u7684\u9006\u8fd0\u7b97----\u9664\u6cd5 , \u5bb9\u6613\u9020\u6210\u5947\u602a\u7684\u7cbe\u5ea6\u635f\u5931\n\n\u6240\u4ee5\u5728\u533a\u95f4\u4e58\u7684\u65f6\u5019\u9700\u8981\u4fee\u6539\u52a0\u6cd5\u6807\u8bb0\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5bb9\u6613\u7684\u5199\u51fa\u533a\u95f4\u52a0\u548c\u533a\u95f4\u4e58\u7684\u4ee3\u7801\u5566\n```cpp\nvoid mul(ll p,ll l,ll r,ll k){  //\u533a\u95f4\u4e58,p\u8868\u793a\u5f53\u524d\u8282\u70b9,l\u548cr\u8868\u793a\u8be2\u95ee\u533a\u95f4\n\tif(lll[p]>=l && rrr[p]<=r){ \n\t\tadd[p]*=k,add[p]%=md;\n\t\tmu[p]*=k,mu[p]%=md;\n\t\tsum[p]*=k,sum[p]%=md;\n\t\treturn;  \n\t}// \u5f53\u524d\u533a\u95f4\u88ab\u4fee\u6539\u533a\u95f4\u5305\u542b\u65f6\u76f4\u63a5\u4fee\u6539\u5f53\u524d\u8282\u70b9\u503c,\u7136\u540e\u6253\u6807\u8bb0,\u7ed3\u675f\u4fee\u6539\n\tpushdown(p); //\u4f20\u6807\u8bb0\n\tsum[p]=(sum[ls(p)]+sum[rs(p)])%md; //\u6c42\u548c\n\tll mid=(lll[p]+rrr[p])>>1;\n\tif(l<=mid)mul(ls(p),l,r,k);  //\u9012\u5f52\u5230\u5de6\u5b50\u8282\u70b9\n\tif(mid<r)mul(rs(p),l,r,k);   /\u9012\u5f52\u5230\u53f3\u5b50\u8282\u70b9\n\tsum[p]=(sum[ls(p)]+sum[rs(p)])%md;  //\u518d\u6b21\u66f4\u65b0\u8282\u70b9\u503c\n}\nvoid addd(ll p,ll l,ll r,ll k){  //\u533a\u95f4\u52a0,\u548c\u533a\u95f4\u4e58\u5927\u81f4\u76f8\u540c\n\tif(lll[p]>=l && rrr[p]<=r){\n\t\tadd[p]+=k;\n\t\tadd[p]%=md;\n\t\tsum[p]+=(rrr[p]-lll[p]+1)*k;\n\t\tsum[p]%=md;\n\t\treturn;\n\t}\n\tpushdown(p);\n\tsum[p]=(sum[ls(p)]+sum[rs(p)])%md;\n\tll mid=(lll[p]+rrr[p])>>1;\n\tif(l<=mid)addd(ls(p),l,r,k);\n\tif(mid<r)addd(rs(p),l,r,k);\n\tsum[p]=(sum[ls(p)]+sum[rs(p)])%md;\n}\n```\n---\n### 2.3 \u533a\u95f4\u67e5\u8be2\n\u800c\u5bf9\u4e8e\u533a\u95f4\u67e5\u8be2 , \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u627e\u5bf9\u5e94\u7684$sum$\u6570\u7ec4\u7684\u503c\u6765\u6c42\u548c\n\n![](https://oi-wiki.org/ds/images/segt5.png)\n\n\u6bd4\u5982\u5bf9\u4e8e\u8fd9\u5e45~~\u4eceOI Wiki\u4e0acopy\u7684~~\u56fe\u4e2d , \u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u627e\u52301\u52303\u7684\u548c , \u4f46\u662f\u627e\u4e0d\u52301\u52304\u7684\u548c\n\n\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5 , \u6211\u4eec\u53ea\u8981\u628a\u533a\u95f4$[1,4]$\u770b\u6210\u533a\u95f4$[1,3]$\u548c\u533a\u95f4$[4,4]$\u7684\u548c\u5373\u53ef\n\n\u4e5f\u5c31\u662f\u8bf4 , \u4e00\u822c\u5730 , \u5982\u679c\u8981\u67e5\u8be2\u7684\u533a\u95f4\u662f$[l,r]$ ,\n\n\u5219\u53ef\u4ee5\u5c06\u5176\u62c6\u6210\u6700\u591a\u4e3a$logn$\u4e2a\u5b50\u533a\u95f4 , \u5408\u5e76\u8fd9\u4e9b\u533a\u95f4\u5373\u53ef\u6c42\u51fa$[l,r]$\u7684\u7b54\u6848\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5bb9\u6613\u7684\u8fdb\u884c\u533a\u95f4\u67e5\u8be2\u6c42\u548c\u5566\n```cpp\nll query(ll p,ll l,ll r){  //[l,r]\u4e3a\u67e5\u8be2\u533a\u95f4,lll[p]\u548crrr[p]\u5206\u522b\u8bb0\u5f55\u5f53\u524dp\u8282\u70b9\u4ee3\u8868\u7684\u5de6\u53f3\u533a\u95f4 , p\u4e3a\u5f53\u524d\u8282\u70b9\u7684\u7f16\u53f7\n\tif(lll[p]>=l && rrr[p]<=r)return sum[p]; //\u5f53\u524d\u8282\u70b9\u533a\u95f4\u88ab\u5305\u542b\u65f6\u76f4\u63a5\u8fd4\u56de\n    \tpushdown(p);  //\u533a\u95f4\u6c42\u548c\u524d\u5fc5\u987b\u628a\u8282\u70b9\u503c\u66f4\u65b0\u5b8c\u6bd5\n\tll v=0,mid=(lll[p]+rrr[p])>>1; //v\u8bb0\u5f55\u67e5\u8be2\u5b50\u533a\u95f4\u7684\u603b\u548c\n\tif(l<=mid)v+=query(ls(p),l,r),v%=md; //\u9012\u5f52\u5230\u5de6\u534a\u8fb9\u627e\u5b50\u533a\u95f4\n\tif(mid<r)v+=query(rs(p),l,r),v%=md;  //\u9012\u5f52\u5230\u53f3\u534a\u8fb9\u627e\u5b50\u533a\u95f4\n\treturn v;  //\u8fd4\u56de\u67e5\u8be2\u533a\u95f4\u7684\u603b\u548c\n}\n```\n---\n## pt.3 \u4e00\u4e9b\u6ce8\u610f\u4e8b\u9879\n\n- \u7ebf\u6bb5\u6811\u7684\u7a7a\u95f4\u8981\u5f00\u5230\u4e00\u822c\u6570\u7ec4\u76844\u500d , \u539f\u56e0\u89c1\u4e0b\u56fe\n![](https://cdn.luogu.com.cn/upload/image_hosting/n6194vyl.png)\n- \u7531\u4e8e\u4f4d\u8fd0\u7b97\u6bd4\u666e\u901a\u56db\u5219\u8fd0\u7b97\u5feb , \u6240\u4ee5\u53ef\u4ee5\u7528$a<<1$\u548c$a<<1|1$\u6765\u4ee3\u66ff$2a$\u548c$2a+1$ , \u7528$(l+r)>>1$\u4ee3\u66ff(l+r)/2 , \u53ef\u9002\u5f53\u4f18\u5316\u7ebf\u6bb5\u6811\n- \u5efa\u6811\u65f6\u8bb0\u5f55\u6bcf\u4e2a\u8282\u70b9\u6240\u5bf9\u5e94\u7684\u533a\u95f4\uff0c\u5c31\u4e0d\u9700\u8981\u6bcf\u6b21\u8ba1\u7b97\u5f53\u524d\u8282\u70b9\u7684\u5de6\u53f3\u7aef\u70b9\u4e86\uff0c\u51cf\u5c0f\u4ee3\u7801\u5e38\u6570 (\u4f17\u6240\u5468\u77e5 , \u7ebf\u6bb5\u6811\u5e38\u6570\u4e0d\u5c0f)\n- \u5728\u53f6\u5b50\u8282\u70b9\u5904\u65e0\u9700\u4e0b\u653e\u61d2\u60f0\u6807\u8bb0\uff0c\u6240\u4ee5\u61d2\u60f0\u6807\u8bb0\u53ef\u4ee5\u4e0d\u4e0b\u4f20\u5230\u53f6\u5b50\u8282\u70b9\u3002\n---\n## pt.4 \u4e0a\u4ee3\u7801 !\n\u732e\u4e0a\u7801\u98ce\u5947\u7279\u7684\u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define ll long long\nint n,m,md;\nll a[400005],sum[400005],mu[400005],add[400005],lll[400005],rrr[400005];\n#define ls(x) x<<1\n#define rs(x) x<<1|1\nvoid build(ll p,ll l,ll r){\n\tlll[p]=l,rrr[p]=r,mu[p]=1;\n\tif(l==r){\n\t\tsum[p]=a[l]%md;\n\t\treturn;\n\t}\n\tll mid=(l+r)>>1;\n\tbuild(ls(p),l,mid);\n\tbuild(rs(p),mid+1,r);\n\tsum[p]=sum[ls(p)]+sum[rs(p)]%md;\n}\nvoid pushdown(ll p){\n\tsum[ls(p)]=(mu[p]*sum[ls(p)]+(rrr[ls(p)]-lll[ls(p)]+1)*add[p]%md)%md;\n\tsum[rs(p)]=(mu[p]*sum[rs(p)]+(rrr[rs(p)]-lll[rs(p)]+1)*add[p]%md)%md;\n\tmu[ls(p)]=(mu[p]*mu[ls(p)])%md;\n\tmu[rs(p)]=(mu[p]*mu[rs(p)])%md;\n\tadd[ls(p)]=(mu[p]*add[ls(p)]+add[p])%md;\n\tadd[rs(p)]=(mu[p]*add[rs(p)]+add[p])%md;\n\tmu[p]=1,add[p]=0;\n}\nvoid addd(ll p,ll l,ll r,ll k){\n\tif(lll[p]>=l && rrr[p]<=r){\n\t\tadd[p]+=k;\n\t\tadd[p]%=md;\n\t\tsum[p]+=(rrr[p]-lll[p]+1)*k;\n\t\tsum[p]%=md;\n\t\treturn;\n\t}\n\tpushdown(p);\n\tsum[p]=(sum[ls(p)]+sum[rs(p)])%md;\n\tll mid=(lll[p]+rrr[p])>>1;\n\tif(l<=mid)addd(ls(p),l,r,k);\n\tif(mid<r)addd(rs(p),l,r,k);\n\tsum[p]=(sum[ls(p)]+sum[rs(p)])%md;\n}\nvoid mul(ll p,ll l,ll r,ll k){\n\tif(lll[p]>=l && rrr[p]<=r){\n\t\tadd[p]*=k,add[p]%=md;\n\t\tmu[p]*=k,mu[p]%=md;\n\t\tsum[p]*=k,sum[p]%=md;\n\t\treturn;\n\t}\n\tpushdown(p);\n\tsum[p]=(sum[ls(p)]+sum[rs(p)])%md;\n\tll mid=(lll[p]+rrr[p])>>1;\n\tif(l<=mid)mul(ls(p),l,r,k);\n\tif(mid<r)mul(rs(p),l,r,k);\n\tsum[p]=(sum[ls(p)]+sum[rs(p)])%md;\n}\nll query(ll p,ll l,ll r){ \n\tif(lll[p]>=l && rrr[p]<=r)return sum[p];\n\tpushdown(p);\n\tll v=0,mid=(lll[p]+rrr[p])>>1;\n\tif(l<=mid)v+=query(ls(p),l,r),v%=md;\n\tif(mid<r)v+=query(rs(p),l,r),v%=md;\n\treturn v;\n}\nint main() {\n\tcin>>n>>md;\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]);\n\tbuild(1,1,n);\n\tcin>>m;\n\twhile(m--){\n\t\tll x,y,typ;\n\t\tscanf(\"%lld%lld%lld\",&typ,&x,&y);\n\t\tif(typ==1){\n\t\t\tll z;\n\t\t\tscanf(\"%lld\",&z);\n\t\t\tmul(1,x,y,z);\n\t\t}else if(typ==2){\n\t\t\tll z;\n\t\t\tscanf(\"%lld\",&z);\n\t\t\taddd(1,x,y,z);\n\t\t}else printf(\"%lld\\n\",query(1,x,y));\n\t}\n\treturn 0;\n}\n\n```",
        "postTime": 1570713184,
        "uid": 148121,
        "name": "zjy111",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "# [AHOI2009]\u7ef4\u62a4\u5e8f\u5217 \u9898\u89e3\n\n-----\n## \u9898\u76ee\u5206\u6790\n\n\u770b\u9898\u9762\u53ef\u4ee5\u77e5\u9053\u9898\u76ee\u7684\u8981\u6c42\uff1a\n\n\u5bf9\u4e8e\u4e00\u4e2a\u957f\u5ea6\u4e3aN\u7684\u5e8f\u5217a\u652f\u6301\u4ee5\u4e0b\u64cd\u4f5c\n\n1.\u4ee4\u6240\u6709\u6ee1\u8db3l<=i<=r\u7684ai\u5168\u90e8\u53d8\u4e3aai\\*c\u3002\n\n2.\u4ee4\u6240\u6709\u6ee1\u8db3l<=i<=r\u7684ai\u5168\u90e8\u53d8\u4e3aai+c\u3002\n\n3.\u6c42\u6240\u6709\u6ee1\u8db3l<=i<=r\u7684ai\u7684\u548c\u3002\n\n\u663e\u7136\u8fd9\u662f\u5bf9\u4e00\u4e2a\u533a\u95f4\u505a\u52a0\u6cd5\u548c\u4e58\u6cd5\u7684\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528\u7ebf\u6bb5\u6811\u5b8c\u6210\u3002\n\n\u8054\u60f3\u53ea\u6709\u533a\u95f4\u52a0\u6cd5\u7684\u8fc7\u7a0b\uff0c\u5bf9\u4e8e\u7ebf\u6bb5\u6811\u4e0a\u7684\u4e00\u4e2a\u8282\u70b9\uff0c\u6211\u4eec\u8bbesum\u8868\u793a\u8be5\u533a\u95f4\u7684\u548c\uff0cinc\u8868\u793a\u8be5\u533a\u95f4\u6bcf\u4e2a\u6570\u8981\u52a0\u4e0a\u7684\u6570\uff0c\u90a3\u4e48\u8be5\u8282\u70b9\u6240\u8868\u793a\u7684\u533a\u95f4\u548c\u4e3asum + inc \\* (r - l + 1)\n\n\u5c5e\u4e8e$x+b$\u8fd9\u79cd\u5f62\u5f0f\uff0c$(r - l + 1)$\u53ef\u4ee5\u770b\u4f5c\u5e38\u6570\u3002\n\n\u4f46\u662f\u73b0\u5728\u533a\u95f4\u4e0d\u4ec5\u6709\u52a0\u6cd5\uff0c\u8fd8\u6709\u4e58\u6cd5\uff0c\u56e0\u6b64\u5f88\u5bb9\u6613\u60f3\u5230\u533a\u95f4\u548c\u7684\u5f62\u5f0f\u5e94\u8be5\u4e3a\uff1a$ax+b$\n\n\u8868\u793a\u73b0\u5728\u7684\u533a\u95f4\u548c\u662f\u539f\u6765\u7684\u533a\u95f4\u548c\u5148\u4e58\u4ee5a\u518d\u52a0\u4e0ab\u3002\n\n\u5728\u7a0b\u5e8f\u4e2d\u6211\u4eec\u628amtp\u5b9a\u4e49\u4e3aa\uff0csum\u5b9a\u4e49\u4e3ax\uff0cinc\u5b9a\u4e49\u4e3ab\uff0c\u4e0b\u4f20\u6807\u8bb0\u65f6\u8282\u70b9\u7684\u66f4\u65b0\u5c31\u662fsum = mtp \\* sum + inc\n\n\n## \u533a\u95f4\u4fee\u6539\n\n\n\u5f53\u6211\u4eec\u8981\u4fee\u6539\u4e00\u4e2a\u533a\u95f4\u65f6\uff0c\u8981\u4fdd\u8bc1ax+b\u7684\u5f62\u5f0f\uff0c\u5373\u5148\u4e58\u540e\u52a0\u7684\u5f62\u5f0f\u3002\u5f53\u5c06\u533a\u95f4\u4e58\u4ee5\u4e00\u4e2a\u6570k\u65f6\uff0c\u539f\u6765\u7684\u533a\u95f4\u548c\u4e3a$ax+b$\uff0c\u4e58\u4ee5k\u5f97$k(ax+b)=kax+kb$\uff0c\u4e5f\u5c31\u662f\u628a\u8282\u70b9\u7684inc\u548cmtp\u90fd\u4e58\u4e0a\u4e00\u4e2ak\u3002\n\n\n\u533a\u95f4\u52a0\u4e00\u4e2a\u6570\u66f4\u52a0\u7b80\u5355\uff0c\u539f\u6765\u7684\u533a\u95f4\u548c\u4e3a$ax+b$\uff0c\u52a0\u4e0a\u4e00\u4e2ak\u4e3a$ax+b+k$\uff0c\u5408\u5e76b, k\u5f97$ax+(b+k)$\uff0c\u4e5f\u5c31\u662f\u628a\u539f\u6765\u7684inc\u52a0\u4e0a\u4e00\u4e2ak\u3002\n\n\n## \u6807\u8bb0\u4e0b\u4f20\n\n\n\u6211\u4eec\u8bbe\u8981\u4e0b\u4f20\u6807\u8bb0\u7684\u8282\u70b9\u7684inc\u4e3a$b$\uff0csum\u4e3a$x$\uff0cmtp\u4e3a$a$\uff0c\u56e0\u6b64\u8fd9\u4e2a\u8282\u70b9\u7684\u548c\u4e3a$ax+b$\uff0c\u5b83\u7684\u4e00\u4e2a\u513f\u5b50\u7684inc\u4e3a$b'$\uff0csum\u4e3a$y$\uff0cmtp\u4e3a$a'$\uff0c\u8fd9\u4e2a\u8282\u70b9\u7684\u548c\u4e3a$a'y+b'$\uff0c\u4e3a\u4e86\u4fdd\u6301\u5148\u4e58\u540e\u52a0\u7684\u987a\u5e8f\uff0c\u5148\u628a\u8be5\u8282\u70b9\u7684\u548c\u4e58\u4ee5$a$\u5f97$$aa'y+ab'$$\u7136\u540e\u52a0\u4e0ab\u5f97$$aa'y+ab'+b$$\u5408\u5e76\u4e00\u4e0b\u5f97$$(aa')y+(ab'+b)$$\u4e5f\u5c31\u662f\u628a\u8fd9\u4e2a\u8282\u70b9\u7684\u513f\u5b50\u7684mtp\u4e58\u4ee5\u8fd9\u4e2a\u8282\u70b9\u7684mtp\uff0c\u7136\u540e\u628a\u8fd9\u4e2a\u8282\u70b9\u7684\u513f\u5b50\u7684inc\u4e58\u4ee5\u8fd9\u4e2a\u8282\u70b9\u7684mtp\u518d\u52a0\u4e0a\u8fd9\u4e2a\u8282\u70b9\u7684inc\uff0c\u66f4\u65b0\u8fd9\u4e2a\u8282\u70b9\uff0c\u6e05\u7a7a\u8fd9\u4e2a\u8282\u70b9\u7684\u6807\u8bb0\uff0c\u7136\u540e\u6807\u8bb0\u5c31\u4e0b\u4f20\u5b8c\u6bd5\u4e86\u3002\n\n\n## \u4ee3\u7801\uff1a\n\n```cpp\n#pragma GCC optimize(2) //O2\u4f18\u5316\n#include <cmath>\n#include <cstdio>\n#include <cstring>\n#include <cstdlib>\n#define lson rt << 1 //\u7b80\u5316\u4e66\u5199\n#define rson rt << 1 | 1\n\nconst int N = 200007; //\u6570\u636e\u8303\u56f4\u6709\u8bef\uff0c100000\u4f1aRE\ntypedef long long ll;\n\nint n, q, L, R, op;\nll k, P, a[N];\n\nstruct SegmentTree\n{\n    ll sum[N << 2], mtp[N << 2], inc[N << 2];\n\n    void down(int rt, int l, int r)\n    {\n        if (mtp[rt] == 1 && inc[rt] == 0) return; //\u90fd\u4e3a\u521d\u59cb\u72b6\u6001\u65f6\u65e0\u9700\u4e0b\u4f20\n        if (l != r)\n            mtp[lson] = mtp[lson] * mtp[rt] % P, //\u513f\u5b50\u7684mtp\u4e58\u4ee5\u5f53\u524d\u8282\u70b9mtp\n            mtp[rson] = mtp[rson] * mtp[rt] % P, \n            inc[lson] = (inc[lson] * mtp[rt] % P + inc[rt]) % P; //\u513f\u5b50\u7684inc\u4e58\u4ee5\u5f53\u524d\u8282\u70b9mtp\u518d\u52a0\u5f53\u524d\u8282\u70b9inc\n            inc[rson] = (inc[rson] * mtp[rt] % P + inc[rt]) % P;\n        sum[rt] = (sum[rt] * mtp[rt] % P + inc[rt] * (r - l + 1) % P) % P; //\u66f4\u65b0\u8282\u70b9\u4fe1\u606f\n        mtp[rt] = 1, inc[rt] = 0; //\u6e05\u7a7a\u6807\u8bb0\n    }\n\n    void build(int rt, int l, int r) //\u6839\u636e\u6570\u7ec4\u6784\u5efa\u7ebf\u6bb5\u6811\uff0c\u5f53\u7136\u6253insert\u4e5f\u662f\u53ef\u4ee5\u7684\n    {\n        mtp[rt] = 1, inc[rt] = 0; //\u521d\u59cb\u5316\u6807\u8bb0\n        if (l == r) { sum[rt] = a[l]; return; }\n        int mid = l + r >> 1;\n        build(lson, l, mid);\n        build(rson, mid + 1, r);\n        sum[rt] = sum[lson] + sum[rson];\n    }\n    \n    ll qrysum(int rt, int l, int r)\n    {\n        down(rt, l, r); //\u5148\u4e0b\u4f20\u6807\u8bb0\n        if (L <= l && r <= R) return sum[rt];\n        ll ret = 0; int mid = l + r >> 1;\n        if (L <= mid) ret = (ret + qrysum(lson, l, mid)) % P;\n        if (mid + 1 <= R) ret = (ret + qrysum(rson, mid + 1, r)) % P;\n        return ret;\n    }\n\n    void rangeplus(int rt, int l, int r)\n    {\n        down(rt, l, r); //\u5148\u4e0b\u4f20\u6807\u8bb0\n        if (L <= l && r <= R) { inc[rt] = (inc[rt] + k) % P; return; } //\u533a\u95f4\u66f4\u65b0\uff0cinc\u52a0\u4e0ak\n        int mid = l + r >> 1;\n        if (L <= mid) rangeplus(lson, l, mid);\n        if (mid + 1 <= R) rangeplus(rson, mid + 1, r);\n        down(lson, l, mid), down(rson, mid + 1, r); //\u4e0b\u4f20\u513f\u5b50\u7684\u6807\u8bb0\n        sum[rt] = (sum[lson] + sum[rson]) % P;\n    }\n\n    void rangemtp(int rt, int l, int r)\n    {\n        down(rt, l, r); //\u5148\u4e0b\u4f20\u6807\u8bb0\n        if (L <= l && r <= R) { mtp[rt] = mtp[rt] * k % P, inc[rt] = inc[rt] * k % P; return; } //\u533a\u95f4\u66f4\u65b0\uff0cmtp\u548cinc\u90fd\u4e58\u4ee5\u4e00\u4e2ak\n        int mid = l + r >> 1;\n        if (L <= mid) rangemtp(lson, l, mid);\n        if (mid + 1 <= R) rangemtp(rson, mid + 1, r);\n        down(lson, l, mid), down(rson, mid + 1, r); //\u4e0b\u4f20\u513f\u5b50\u7684\u6807\u8bb0\n        sum[rt] = (sum[lson] + sum[rson]) % P;\n    }\n} tree;\n\ninline ll read() //\u8bfb\u5165\u52a0\u901f\n{\n    ll x = 0, f = 0;\n    char c = getchar();\n    for (; c < '0' || c > '9'; c = getchar()) if (c == '-') f = 1;\n    for (; c >= '0' && c <= '9'; c = getchar()) x = (x << 1) + (x << 3) + c - '0';\n    return f ? -x : x;\n}\n\nvoid init()\n{\n    n = read(), P = read();\n    for (int i = 1; i <= n; i++) *(a + i) = read();\n    tree.build(1, 1, n);\n}\n\nvoid solve()\n{\n    q = read();\n    while (q--)\n    {\n        op = read();\n        if (op == 1)\n            L = read(), R = read(), k = read(),\n            tree.rangemtp(1, 1, n);\n        else if (op == 2)\n            L = read(), R = read(), k = read(),\n            tree.rangeplus(1, 1, n);\n        else\n            L = read(), R = read(),\n            printf(\"%lld\\n\", tree.qrysum(1, 1, n));\n    }\n}\n\nint main()\n{\n    init();\n    solve();\n    return 0;\n}\n```",
        "postTime": 1515805011,
        "uid": 37598,
        "name": "GaryZhong",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "# \u53c8\u662f\u4e00\u8f6e\u7ebf\u6bb5\u6811\n\n\u8fd9\u9053\u9898\u5e94\u8be5\u8bf4\u662f\u4e00\u9053\u7ebf\u6bb5\u6811\u6a21\u677f.[\u53c8\u4e00\u6a21\u677f](https://www.luogu.org/problem/P3373)\n\n\u5728\u8fd9\u91cc\u6211\u4eec\u4e86\u89e3\u4e00\u4e0b\u7ebf\u6bb5\u6811\n\n\n\u5728\u5982\u6b64\u5e8f\u5217\u4e2d\uff0c1,2,3,4\uff1b\n\n\u7528\u7ebf\u6bb5\u6811\u7684\u8bdd\uff0c\u6211\u4eec\u9898\u76ee\u4e2d\u7684\u4fee\u6539\u5c31\u53d8\u5f97\u975e\u5e38\u53ef\u89c2\u3002\u6bd4\u5982\u4fee\u65391\uff0c\u7528\u524d\u7f00\u548c\u601d\u8def\u6bcf\u6b21\u7684\u4fee\u6539\u90fd\u8981\u8bb0\u5f55\u4e00\u6b21\uff08~~\u867d\u7136\u524d\u7f00\u548c\u6539\u4e00\u6b21\u5f88\u5feb~~\uff09\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u53d8\u4e3aO(n)\u4e86\uff0c\u4e0d\u8fc7\u7528\u7ebf\u6bb5\u6811\u4fee\u6539\uff0c\u53ea\u9700\u4fee\u65391,1-2,1-4\u3002\u590d\u6742\u5ea6\u4f18\u5316\u4e3aO\uff08logn\uff09\u4e86\uff0c\u5c31\u53ef\u4ee5\u5f00\u5f00\u5fc3\u5fc3\u7684AC\u4e86\uff01\n\n\u7ebf\u6bb5\u6811\u7684\u56fe\u4e3a\uff1a\n```cpp\n          1-4\n         /  \\\n        1-2  3-4\n       / \\   / \\\n       1 2   3  4\n```\n\n## \u5efa\u6811\u64cd\u4f5c\n\n\u6211\u4eec\u7528\u4e00\u4e2a\u6570\u7ef4\u62a4\u4e00\u6bb5\u533a\u95f4\uff0c\u8bb0\u5f55\u5176\u7684\u5de6\u513f\u5b50\u548c\u53f3\u513f\u5b50\uff0c\u7531\u56fe\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u5de6\u513f\u5b50\u8282\u70b9\u533a\u95f4\u4e3a\uff1al-mid\uff0c\u53f3\u513f\u5b50\u533a\u95f4\u4e3amid+1-r\n\n\u6709\u8fd9\u6837\u4e00\u79cd\u601d\u8def\uff0c\u5efa\u6811\u5b8c\u6210\uff01\n\n\u4ee3\u7801\uff1a\n```cpp\nvoid build(ll p,ll l,ll r)\n{\n\tl(p)=l,r(p)=r,mul(p)=1,add(p)=0;\n\tif(l==r){sum(p)=a[l];return ;}\n\tll mid=(l+r)>>1;\n\tbuild(p*2,l,mid);\n\tbuild(p*2+1,mid+1,r);\n\tsum(p)=sum(p*2)+sum(p*2+1);\n\tsum(p)%=h;//\u8fb9\u7b97\u8fb9\u53d6\u6a21\n}\n```\n\n## \u4e0b\u4f20\u6807\u8bb0\n\n\u8fd9\u91cc\u5e94\u8be5\u6bd4\u8f83\u597d\u7406\u89e3\uff0c\u6bcf\u6b21\u90fd\u6162\u6162\u7684\u66f4\u65b0\u5373\u53ef\n\n\u4ee3\u7801\uff1a\n```cpp\nvoid spread(ll p)\n{\n\tif(add(p)||mul(p)!=1)\n\t{\n\t\tsum(p*2)=(sum(p*2)*mul(p))%h;\n\t\tsum(p*2+1)= (sum(p*2+1)*mul(p))%h;\n\t\tsum(p*2)=(sum(p*2)+add(p)*(r(p*2)-l(p*2)+1))%h;\n\t\tsum(p*2+1)=(sum(p*2+1)+add(p)*(r(p*2+1)-l(p*2+1)+1))%h;\n\t\tmul(p*2)=(mul(p*2)*mul(p))%h;\n\t\tmul(p*2+1)=(mul(p*2+1)*mul(p))%h;\n\t\tadd(p*2)=(add(p*2)*mul(p))%h;\n\t\tadd(p*2+1)=(add(p*2+1)*mul(p))%h;\n\t\tadd(p*2)=(add(p*2)+add(p))%h;\n\t\tadd(p*2+1)=(add(p*2+1)+add(p))%h;//\u540c\u6837\u662f\u8fb9\u7b97\u8fb9\u53d6\u6a21\n\t\tadd(p)=0;\n\t\tmul(p)=1;\n\t}\n}\n```\n## \u533a\u95f4\u4fee\u6539\n\n1.\u52a0\u6cd5\u4fee\u6539\uff1a\n\n\u628a\u5f53\u524d\u8282\u70b9\u7ef4\u62a4\u5e8f\u5217\u503c\u52a0\u4e0a\u5de6\u53f3\u513f\u5b50\u7684\u5dee\u503c\u5728\u4e58\u4e0a\u5f53\u524d\u9700\u8981\u4fee\u6539\u7684d\u5373\u53ef\n\n2.\u4e58\u6cd5\u4fee\u6539\n\n\u548c\u52a0\u6cd5\u7c7b\u4f3c\uff0c\u4e0d\u8fc7\u4e0d\u9700\u8ba1\u7b97\u5dee\u503c\uff0c\u76f4\u63a5\u4e58\u5373\u53ef\n\n\u518d\u6bcf\u4e00\u6b21\u53d6mid\uff0c\u5982\u4e0a\u8ff0\u60c5\u51b5\uff0c\u4fee\u6539\u5de6\uff08\u6216\u53f3\uff09\u533a\u95f4\u5373\u53ef\u5f97\u5230\n\n```cpp\nvoid change(ll p,ll l,ll r,ll d,ll k)\n{\n\tif(l<=l(p)&&r>=r(p))\n\t{\n\t\tif(k==2)//\u52a0\u6cd5\u4fee\u6539\n\t\t{\n\t\t\tsum(p)+=d*(r(p)-l(p)+1);\n\t\t\tadd(p)+=d;\n\t\t\tsum(p)%=h;\n\t\t\tadd(p)%=h;\n\t\t}\n\t\tif(k==1)//\u4e58\u6cd5\u4fee\u6539\n\t\t{\n\t\t\tsum(p)*=d;\n\t\t\tadd(p)*=d;\n\t\t\tmul(p)*=d;\n\t\t\tsum(p)%=h;\n\t\t\tadd(p)%=h;\n\t\t\tmul(p)%=h;\n\t\t}\n\t\treturn ;\n\t}\n\tspread(p);//\u4e0b\u4f20\u6807\u8bb0\n\tll mid=(l(p)+r(p))>>1;\n\tif(l<=mid) change(p*2,l,r,d,k);\n\tif(r>mid) change(p*2+1,l,r,d,k);\n\tsum(p)=sum(p*2)+sum(p*2+1);\n\tsum(p)%=h;\n}\n```\n\n## \u533a\u95f4\u67e5\u8be2\n\n\u5982\u679c\u5f53\u524d\u5e8f\u5217\u5df2\u88ab\u8986\u76d6\uff0c\u5c31\u76f4\u63a5\u8f93\u51fa\u5f53\u524d\u8282\u70b9\u7684\u503c,\u7528ans\u8bb0\u5f55\u7b54\u6848\uff0c\u6bcf\u6b21\u52a0\u4e0a\u5de6\uff08\u6216\u53f3\uff09\u533a\u95f4\u7684\u67e5\u8be2(\u9012\u5f52\u5373\u53ef\uff09\n\n\u4ee3\u7801\uff1a\n```cpp\nll ask(ll p,ll l,ll r)\n{\n\tif(l<=l(p)&&r>=r(p)) return sum(p);\n\tspread(p);\n\tll mid=(l(p)+r(p))>>1;\n\tll ans=0;\n\tif(l<=mid) ans+=ask(p*2,l,r);\n\tif(r>mid) ans+=ask(p*2+1,l,r);\n\tans%=h;\n\treturn ans;\n}\n```\n\n\u5728\u6b64\uff0c\u6211\u4eec\u7ebf\u6bb5\u6811\u5df2\u7ecf\u57fa\u672c\u5199\u5b8c\uff0c\u53ea\u9700\u5224\u65ad\u4e00\u4e0b\u5f53\u524d\u9700\u8981\u4ec0\u4e48\u64cd\u4f5c\uff0cchange\u6216ask\u4e00\u4e0b\u5c31AC\u4e86\n\n\n\u5b8c\u6574\u4ee3\u7801\uff08~~\u53ea\u6709\u81ea\u5df1\u7406\u89e3\u4e86\u624d\u662f\u81ea\u5df1\u7684\u54e6\uff01~~\uff09\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nll read()\n{\n\tll r=0,f=1;char c=getchar();\n\twhile((c<'0'||c>'9')&&c!='-') c=getchar();\n\tif(c=='-') f=-1,c=getchar();\n\twhile(c>='0'&&c<='9') r=r*10+c-'0',c=getchar();\n\treturn r*f;\n}\nstruct Segment\n{\n\tll l,r,sum,add,mul;\n\t#define l(x) tree[x].l\n\t#define r(x) tree[x].r\n\t#define sum(x) tree[x].sum\n\t#define add(x) tree[x].add\n\t#define mul(x) tree[x].mul\n}tree[100010*4];\nll n,m,h,a[100010];\nvoid build(ll p,ll l,ll r)\n{\n\tl(p)=l,r(p)=r,mul(p)=1,add(p)=0;\n\tif(l==r){sum(p)=a[l];return ;}\n\tll mid=(l+r)>>1;\n\tbuild(p*2,l,mid);\n\tbuild(p*2+1,mid+1,r);\n\tsum(p)=sum(p*2)+sum(p*2+1);\n\tsum(p)%=h;\n}\nvoid spread(ll p)\n{\n\tif(add(p)||mul(p)!=1)\n\t{\n\t\tsum(p*2)=(sum(p*2)*mul(p))%h;\n\t\tsum(p*2+1)= (sum(p*2+1)*mul(p))%h;\n\t\tsum(p*2)=(sum(p*2)+add(p)*(r(p*2)-l(p*2)+1))%h;\n\t\tsum(p*2+1)=(sum(p*2+1)+add(p)*(r(p*2+1)-l(p*2+1)+1))%h;\n\t\tmul(p*2)=(mul(p*2)*mul(p))%h;\n\t\tmul(p*2+1)=(mul(p*2+1)*mul(p))%h;\n\t\tadd(p*2)=(add(p*2)*mul(p))%h;\n\t\tadd(p*2+1)=(add(p*2+1)*mul(p))%h;\n\t\tadd(p*2)=(add(p*2)+add(p))%h;\n\t\tadd(p*2+1)=(add(p*2+1)+add(p))%h;\n\t\tadd(p)=0;\n\t\tmul(p)=1;\n\t}\n}\nvoid change(ll p,ll l,ll r,ll d,ll k)\n{\n\tif(l<=l(p)&&r>=r(p))\n\t{\n\t\tif(k==2)\n\t\t{\n\t\t\tsum(p)+=d*(r(p)-l(p)+1);\n\t\t\tadd(p)+=d;\n\t\t\tsum(p)%=h;\n\t\t\tadd(p)%=h;\n\t\t}\n\t\tif(k==1)\n\t\t{\n\t\t\tsum(p)*=d;\n\t\t\tadd(p)*=d;\n\t\t\tmul(p)*=d;\n\t\t\tsum(p)%=h;\n\t\t\tadd(p)%=h;\n\t\t\tmul(p)%=h;\n\t\t}\n\t\treturn ;\n\t}\n\tspread(p);\n\tll mid=(l(p)+r(p))>>1;\n\tif(l<=mid) change(p*2,l,r,d,k);\n\tif(r>mid) change(p*2+1,l,r,d,k);\n\tsum(p)=sum(p*2)+sum(p*2+1);\n\tsum(p)%=h;\n}\nll ask(ll p,ll l,ll r)\n{\n\tif(l<=l(p)&&r>=r(p)) return sum(p);\n\tspread(p);\n\tll mid=(l(p)+r(p))>>1;\n\tll ans=0;\n\tif(l<=mid) ans+=ask(p*2,l,r);\n\tif(r>mid) ans+=ask(p*2+1,l,r);\n\tans%=h;\n\treturn ans;\n}\nint main()\n{\n\tn=read(),h=read();\n\tfor(int i=1;i<=n;i++) a[i]=read();\n\tm=read();\n\tbuild(1,1,n);\t\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tll q=read();\n\t\tif(q==1)\n\t\t{\n\t\t\tll x=read(),y=read(),z=read();\n\t\t\tchange(1,x,y,z,1);\n\t\t}\n\t\telse if(q==2){\n\t\t\tll x=read(),y=read(),z=read();\n\t\t\tchange(1,x,y,z,2);\n\t\t}\n\t\telse if(q==3){\n\t\t\tll x=read(),y=read();\n\t\t\tprintf(\"%lld\\n\",ask(1,x,y)%h);\n\t\t}\n\t}\n\treturn 0;\n}\n```\n\n# \u7ebf\u6bb5\u6811\u5b8c\u7ed3\uff08~~\u6492\u82b1~~\uff09\n\n\u8bf7\u591a\u591a\u652f\u6301\uff08~~\u5176\u5b9e\u5c31\u662f\u70b9\u8d5e~~\uff09\n\n\u8c22\u8c22\u5927\u4f6c\u4eec\u7684\u89c2\u770b",
        "postTime": 1572325328,
        "uid": 138649,
        "name": "\u7237\uff0c\u65e0\u9650\u9738\u6c14",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "# \u5206\u5757\u4ee4\u6211\u5757\u4e50\n\u6b64\u9898\u6807\u7b7e\u662f\u7ebf\u6bb5\u6811\uff0c\u5927\u90e8\u5206\u9898\u89e3\u4e5f\u90fd\u662f\u7ebf\u6bb5\u6811\u3002  \n\u7136\u800c\uff0c\u5206\u5757\u4e5f\u662f\u53ef\u4ee5\u8fc7\u7684~~\u867d\u7136\u8981\u5438\u6c27~~\u3002  \n\u5bf9\u4e8e\u6bcf\u4e2a\u5757\uff0c\u7ef4\u62a4\u4e00\u4e2a\u4e58\u6cd5\u6807\u8bb0\u548c\u4e00\u4e2a\u52a0\u6cd5\u6807\u8bb0\uff0c\u770b\u4e0a\u53bb\u597d\u50cf\u4e24\u4e2a\u6807\u8bb0\u76f4\u63a5\u5206\u5f00\u7ef4\u62a4\u5c31\u53ef\u4ee5\u4e86\u3002  \n\u4f46\u662f\uff0c\u6839\u636e~~\u5c0f\u5b66\u751f\u90fd\u4f1a\u7684~~\u4e58\u6cd5\u5206\u914d\u5f8b\u53ef\u77e5\uff1a\n### (a + b) * c = ac + bc  \n\u800c\u6211\u4eec\u5982\u679c\u76f4\u63a5\u5206\u5f00\u7ef4\u62a4\u4e24\u4e2a\u6807\u8bb0\uff0c\u5219\u4f1a\u51fa\u73b0\uff1a\n### (a + b) * c = ac + b  \n\u663e\u7136\u9519\u4e86\u3002  \n\u4ece\u4e0a\u9762\u4e24\u4e2a\u5f0f\u5b50\u4e2d\u53ef\u4ee5\u53d1\u73b0\uff1a\n## \u4e58\u6cd5\u6807\u8bb0\u662f\u53ef\u4ee5\u5f71\u54cd\u52a0\u6cd5\u6807\u8bb0\u7684  \n## \u800c\u52a0\u6cd5\u6807\u8bb0\u5219\u4e0d\u5f71\u54cd\u4e58\u6cd5\u6807\u8bb0  \n\u5728\u8fb9\u89d2\u5757\u66b4\u529b\u5904\u7406\u65f6\uff0c\u4e5f\u6709\u4e00\u4e2a\u7ec6\u8282\u8981\u6ce8\u610f\uff1a  \n\u5982\u679c\u8fd9\u4e2a\u5143\u7d20\u6240\u5728\u7684\u5757\u5df2\u7ecf\u6709\u4e86\u52a0\u6cd5\u6807\u8bb0\uff0c\u800c\u73b0\u5728\u7ed9\u5b83\u4e58\u4e0a\u4e00\u4e2a\u6570\uff0c\u663e\u7136\u52a0\u6cd5\u6807\u8bb0\u4e5f\u8981\u4e58\u8fd9\u4e2a\u6570\u3002\u4f46\u662f\u80af\u5b9a\u4e0d\u80fd\u76f4\u63a5\u628a\u52a0\u6cd5\u6807\u8bb0\u4e58\u4e0a\u8fd9\u4e2a\u6570\uff0c\u56e0\u4e3a\u52a0\u6cd5\u6807\u8bb0\u8bb0\u5f55\u7684\u662f\u6574\u5757\u7684\u4fe1\u606f\uff0c\u800c\u73b0\u5728\u8981\u4fee\u6539\u7684\u53ea\u6709\u8fd9\u4e2a\u6570\u3002\u6240\u4ee5\u5e72\u8106\u76f4\u63a5\u628a\u8fd9\u6574\u4e2a\u5757\u90fd\u5148\u52a0\u4e0a\u6807\u8bb0\uff0c\u5e76\u628a\u6807\u8bb0\u6e05\u96f6\u3002  \n\u4e58\u6cd5\u6807\u8bb0\u540c\u7406\uff08\u4f46\u662f\u6807\u8bb0\u8981\u8d4b\u503c\u62101\uff09  \n\u9644\u4e0a\u4f18\uff08chou\uff09\u7f8e\uff08lou\uff09\u7684\u4ee3\u7801\uff1a\n```cpp\n\n#include<bits/stdc++.h>\n#define N 100007\n#define ll long long\nusing namespace std;\n\nll a[N], sum[N], add[N], mul[N];//add\u4e3a\u52a0\u6cd5\u6807\u8bb0\uff0cmul\u4e3a\u4e58\u6cd5\u6807\u8bb0\uff08\u5f00 long long\u9632\u6b62\u4e2d\u95f4\u8fc7\u7a0b\u7206\u70b8\uff09\nint block[N], l[N], r[N];\n\ninline ll read()\n{\n\tll x = 0;\n\tchar ch = getchar();\n\twhile (!isdigit(ch)) ch = getchar();\n\twhile (isdigit(ch))\n\t{\n\t\tx = (x << 3) + (x << 1) + ch - 48;\n\t\tch = getchar();\n\t}\n\treturn x;\n}//\u5feb\u8bfb\u7528\u6765\u5361\u5e38\n\nint main()\n{\n\tint n = read(), p = read();\n\tfor (int i = 1; i <= n ; i++)\n\ta[i] = read();\n\tint piece = sqrt(n);\n\tfor (int i = 1; i <= n; i++)\n\t{\n\t\tif (i % piece == 0) block[i] = i / piece;\n\t\telse block[i] = i / piece + 1;\n\t}//\u628a\u6570\u5217\u5206\u6210\u4e00\u4e2a\u4e2a\u5757\n\tfor (int i = 1; i <= n; i++)\n\t{\n\t\tif (!l[block[i]]) l[block[i]] = i;\n\t\tr[block[i]] = i;\n\t\tsum[block[i]] += a[i];\n\t}//\u8ba1\u7b97\u6bcf\u4e2a\u5757\u7684\u5de6\u8fb9\u754c\u3001\u53f3\u8fb9\u754c\u3001\u603b\u548c\n\tfor (int i = 1; i <= block[n]; i++)\n\tmul[i] = 1;//\u6ce8\u610f\u4e58\u6cd5\u6807\u8bb0\u521d\u503c\u4e3a1\n\tint m = read();\n\tfor (int i = 1; i <= m; i++)\n\t{\n\t\tll pos = read(), x = read(), y = read();\n\t\tif (pos == 1)\n\t\t{\n\t\t\tll c = read();\n\t\t\tif (block[x] == block[y])\n\t\t\t{\n\t\t\t\tfor (int j = l[block[x]]; j <= r[block[x]]; j++)\n\t\t\t\t{\n\t\t\t\t\ta[j] = (a[j] * mul[block[x]] + add[block[x]]) % p;\n\t\t\t\t}\n\t\t\t\tmul[block[x]] = 1;\n\t\t\t\tadd[block[x]] = 0;//\u6e05\u7a7a\u6807\u8bb0\n\t\t\t\tfor (int j = x; j <= y; j++)\n\t\t\t\t{\n\t\t\t\t    sum[block[x]] = sum[block[x]] - a[j];\n\t\t\t\t    a[j] = (a[j] * c) % p;\n\t\t\t\t    sum[block[x]] = (sum[block[x]] + a[j]) % p;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (int j = block[x] + 1; j <= block[y] - 1; j++)\n\t\t\t\t{\n\t\t\t\t\tmul[j] = (mul[j] * c) % p;\n\t\t\t\t\tadd[j] = (add[j] * c) % p;\n\t\t\t\t\tsum[j] = (sum[j] * c) % p;\n\t\t\t\t}\u5927\u6bb5\u7ef4\u62a4\n\t\t\t\tfor (int j = l[block[x]]; j <= r[block[x]]; j++)\n\t\t\t\t{\n\t\t\t\t\ta[j] = (a[j] * mul[block[x]] + add[block[x]]) % p;\n\t\t\t\t}\n\t\t\t\tmul[block[x]] = 1;\n\t\t\t\tadd[block[x]] = 0;\n\t\t\t\tfor (int j = x; j <= r[block[x]]; j++)\n\t\t\t\t{\n\t\t\t\t    sum[block[x]] = sum[block[x]] - a[j];\n\t\t\t\t    a[j] = (a[j] * c) % p;\n\t\t\t\t    sum[block[x]] = (sum[block[x]] + a[j]) % p;\n\t\t\t\t}\n\t\t\t\tfor (int j = l[block[y]]; j <= r[block[y]]; j++)\n\t\t\t\t{\n\t\t\t\t\ta[j] = (a[j] * mul[block[y]] + add[block[y]]) % p;\n\t\t\t\t}\n\t\t\t\tmul[block[y]] = 1;\n\t\t\t\tadd[block[y]] = 0;\n\t\t\t\tfor (int j = l[block[y]]; j <= y; j++)\n\t\t\t\t{\n\t\t\t\t    sum[block[y]] = sum[block[y]] - a[j];\n\t\t\t\t    a[j] = (a[j] * c) % p;\n\t\t\t\t    sum[block[y]] = (sum[block[y]] + a[j]) % p;\n\t\t\t\t}//\u5c0f\u6bb5\u66b4\u529b\n\t\t\t}\n\t\t}\n\t\telse\n\t\tif (pos == 2)\n\t\t{\n\t\t\tll c = read();\n\t\t\tif (block[x] == block[y])\n\t\t\t{\n\t\t\t\tfor (int j = l[block[x]]; j <= r[block[x]]; j++)\n\t\t\t\t{\n\t\t\t\t\ta[j] = (a[j] * mul[block[y]] + add[block[y]]) % p;\n\t\t\t\t}\n\t\t\t\tmul[block[x]] = 1;\n\t\t\t\tadd[block[x]] = 0;\n\t\t\t\tfor (int j = x; j <= y; j++)\n\t\t\t\t{\n\t\t\t\t    sum[block[x]] = sum[block[x]] - a[j];\n\t\t\t\t    a[j] = (a[j] + c) % p;\n\t\t\t\t    sum[block[x]] = (sum[block[x]] + a[j]) % p;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (int j = block[x] + 1; j <= block[y] - 1; j++)\n\t\t\t\t{\n\t\t\t\t\tsum[j] = (sum[j] + c * (r[j] - l[j] + 1)) % p;\n\t\t\t\t\tadd[j] = (add[j] + c) % p;\n\t\t\t\t}\n\t\t\t\tfor (int j = l[block[x]]; j <= r[block[x]]; j++)\n\t\t\t\t{\n\t\t\t\t\ta[j] = (a[j] * mul[block[x]] + add[block[x]]) % p;\n\t\t\t\t}\n\t\t\t\tmul[block[x]] = 1;\n\t\t\t\tadd[block[x]] = 0;\n\t\t\t\tfor (int j = x; j <= r[block[x]]; j++)\n\t\t\t\t{\n\t\t\t\t    sum[block[x]] = sum[block[x]] - a[j];\n\t\t\t\t    a[j] = (a[j] + c) % p;\n\t\t\t\t    sum[block[x]] = (sum[block[x]] + a[j]) % p;\n\t\t\t\t}\n\t\t\t\tfor (int j = l[block[y]]; j <= r[block[y]]; j++)\n\t\t\t\t{\n\t\t\t\t\ta[j] = (a[j] * mul[block[y]] + add[block[y]]) % p;\n\t\t\t\t}\n\t\t\t\tmul[block[y]] = 1;\n\t\t\t\tadd[block[y]] = 0;\n\t\t\t\tfor (int j = l[block[y]]; j <= y; j++)\n\t\t\t\t{\n\t\t\t\t    sum[block[y]] = sum[block[y]] - a[j];\n\t\t\t\t    a[j] = (a[j] + c) % p;\n\t\t\t\t    sum[block[y]] = (sum[block[y]] + a[j]) % p;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\tif (pos == 3)\n\t\t{\n\t\t\tif (block[x] == block[y])\n\t\t\t{\n\t\t\t\tll ans = 0;\n\t\t\t\tfor (int j = x; j <= y; j++)\n\t\t\t\tans = (ans + (a[j] * mul[block[x]] + add[block[x]])) % p;\n\t\t\t\tprintf(\"%lld\\n\", ans);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tll ans = 0;\n\t\t\t\tfor (int j = block[x] + 1; j <= block[y] - 1; j++)\n\t\t\t\tans = (ans + sum[j]) % p;\n\t\t\t\tfor (int j = x; j <= r[block[x]]; j++)\n\t\t\t\tans = (ans + (a[j] * mul[block[x]] + add[block[x]])) % p;\n\t\t\t\tfor (int j = l[block[y]]; j <= y; j++)\n\t\t\t\tans = (ans + (a[j] * mul[block[y]] + add[block[y]])) % p;\n\t\t\t\tprintf(\"%lld\\n\", ans);\n\t\t\t}\n\t\t}\n\t}\n\treturn 0;\n } \n```\n",
        "postTime": 1563241040,
        "uid": 93286,
        "name": "Yuno",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "\u7ebf\u6bb5\u6811\u6a21\u677f\u9898\u5c31\u4e0d\u8bf4\u4e86\uff0c\u7ed9\u5927\u5bb6\u8bb2\u4e00\u4e2a\u5361\u5e38\u6570\u7684\u5c0f\u6280\u5de7\u3002\n\n\u5f88\u591a\u9898\u7684\u6a21\u6570\u90fd\u662f\u5728\u9898\u9762\u91cc\u9762\u5199\u6b7b\u7684\uff0c\u4f46\u662f\u8fd9\u9053\u9898\u7684\u6a21\u6570\u662f\u540e\u6765\u8f93\u5165\u7684\u3002\u4e0d\u8981\u8ba4\u4e3a\u90fd\u662f\u53d6\u6a21\u6ca1\u6709\u533a\u522b\u3002\u5927\u5bb6\u53ef\u4ee5\u7b80\u5355\u505a\u4e2a\u5b9e\u9a8c\u3002\n```cpp\nunsigned mod5(unsigned x)\n{\n    return x % 5;\n}\nint main() {}\n```\n\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u884c\u7f16\u8bd1\u4e4b\uff1a(\u5047\u5b9a\u6587\u4ef6\u53ebtest.cpp)\n```shell\ng++ -g -c -O2 test.cpp && objdump -S test.o > test.s\n```\n\u6253\u5f00test.s\u5c31\u4f1a\u770b\u5230\n```asm\nmov    %edi,%eax\nmov    $0xcccccccd,%edx\nmul    %edx ;\u4e58\u6cd5\nmov    %edx,%eax \nshr    $0x2,%eax ;\u79fb\u4f4d\nlea    (%rax,%rax,4),%eax ;\u4e58\u6cd5\uff0c\u88ab\u4f18\u5316\u6210\u79fb\u4f4d\nsub    %eax,%edi ;\u51cf\u6cd5\nmov    %edi,%eax\n```\n\u4e00\u6b21\u53d6\u6a21\u88ab\u4f18\u5316\u6210\u4e86\u4e24\u6b21\u4e58\u6cd5\u548c\u4e00\u6b21\u79fb\u4f4d\u548c\u4e00\u6b21\u51cf\u6cd5\uff0c\u5176\u4e2d\u7b2c\u4e8c\u6b21\u4e58\u6cd5\u4e5f\u88ab\u4f18\u5316\u6210\u4e86\u79fb\u4f4d\u3002\uff08\u987a\u4fbf\u8bf4\u4e00\u53e5\uff0c\u5f88\u591a\u4eba\u559c\u6b22\u628ax\\*10\u5199\u6210(x<<1)+(x<<3)\uff0c\u5176\u5b9e\u8fd9\u5e76\u4e0d\u662f\u6700\u9ad8\u6548\u7684\u5199\u6cd5\u3002\u6700\u9ad8\u6548\u7684\u5199\u6cd5\u662f\u8001\u8001\u5b9e\u5b9e\u5199x\\*10\u7136\u540e\u7b49\u7740\u7f16\u8bd1\u5668\u7ed9\u4f60\u4f18\u5316\uff09\n\n\u7f16\u8bd1\u5668\u4e4b\u6240\u4ee5\u8fd9\u6837\u4f18\u5316\uff0c\u662f\u56e0\u4e3a\u9664\u6cd5\u548c\u53d6\u6a21\u76f8\u5bf9\u6765\u8bb2\u975e\u5e38\u6162\u3002\u4e58\u6cd5\u7684\u901f\u5ea6\u548c\u52a0\u51cf\u6cd5\u5728\u4e00\u4e2a\u6570\u91cf\u7ea7\uff0c\u800c\u9664\u6cd5\u548c\u53d6\u6a21\u5219\u6162\u4e00\u4e2a\u6570\u91cf\u7ea7\u3002\u4f46\u662f\u8fd9\u79cd\u4f18\u5316\u4ec5\u9650\u4e8e\u9664/\u6a21\u5e38\u6570\uff0c\u7f16\u8bd1\u5668\u624d\u80fd\u5728\u7f16\u8bd1\u65f6\u8fdb\u884c\u4f18\u5316\u3002\u8fd9\u9053\u9898\u7684\u6a21\u6570\u662f\u540e\u8f93\u5165\u7684\uff0c\u7f16\u8bd1\u5668\u5c31\u6ca1\u529e\u6cd5\u4f18\u5316\u4e86\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5~~\u653e\u5f03\u6cbb\u7597~~\u81ea\u5df1\u6765\u8fdb\u884c\u8fd9\u4e2a\u4f18\u5316\u3002\u5927\u5bb6\u53ef\u4ee5\u770b\u4e00\u4e0b\u8fd9\u4e2a\u6587\u7ae0\uff08\u4e0d\u662f\u6211\u5199\u7684\uff09\u3002https://www.cnblogs.com/shines77/p/4189074.html\n\n\u6587\u7ae0\u91cc\u8bb2\u4e8632\u4f4d\u7684\u9664\u6cd5\u600e\u4e48\u4f18\u5316\uff0c\u6240\u4ee5\u6211\u4eec~~\u968f\u4fbf\u4e71\u641e\u4e00\u4e0b~~\u7ecf\u8fc7\u4e25\u683c\u7684\u63a8\u7406\u53ef\u4ee5\u5bf964\u4f4d\u7684\u9664\u6cd5\u505a\u51fa\u7c7b\u4f3c\u7684\u4f18\u5316\u3002\n```cpp\n// \u6709\u8fd4\u56de\u503c\u7684\u5b8f\uff0c\u8fd9\u662fg++\u7684\u4e00\u4e2a\u62d3\u5c55\uff0c\u53ef\u4ee5\u7528\u6765\u5f53\u51fd\u6570\u7528\n#define Mod(x)                            \\\n    ({                                    \\\n        auto __x = x;                     \\\n        __x - P *((__x * M) >> (64 + K)); \\\n    })\n...\nu128 M;\nu32 P, K;\n...\nfor (K = 0; P >= 1 << (K + 1); ++K)\n        ;\nM = ((u128)1 << (K + 64)) / P;\nif (((P * M) >> (64 + K)) != 1)\n    ++M;\n```\n\n\u4ee5\u4e0b\u662f\u5b8c\u6574\u4ee3\u7801\u3002804ms\uff0c\u76ee\u524drk1\u3002\n```cpp\n#include <cstdio>\n#include <cstdlib>\ntypedef unsigned u32;\ntypedef unsigned long long u64;\ntypedef __uint128_t u128;\n#define L (u64)\n#define Mod(x)                            \\\n    ({                                    \\\n        auto __x = x;                     \\\n        __x - P *((__x * M) >> (64 + K)); \\\n    })\n#define Inline __attribute__((always_inline)) inline\nconst u32 N = 200000 + 15;\nu128 M;\nu32 P, K;\nstruct Node\n{\n    u32 val, add_tag, mul_tag = 1u;\n} tree[N * 4];\nstruct IOBoost\n{\n    char p[1 << 24], *s, e[1 << 24], *t;\n    u32 a[24];\n    IOBoost() : s(p), t(e) { fread(s, 1, sizeof p, stdin); }\n    ~IOBoost() { fwrite(e, 1, t - e, stdout); }\n    Inline operator u32()\n    {\n        static u32 v;\n        v = 0;\n        while (*s < '0')\n            ++s;\n        do\n            v = v * 10 + *s++ - '0';\n        while (*s > ' ');\n        return v;\n    }\n    Inline void print(u32 v)\n    {\n        static u32 *q = a;\n        if (!v)\n            *t++ = '0';\n        else\n        {\n            while (v)\n                *q++ = v % 10 + '0', v /= 10;\n            while (q != a)\n                *t++ = *--q;\n        }\n        *t++ = '\\n';\n    }\n} io;\nu32 ql, qr, qval;\n\nvoid build(u32 rt, u32 l, u32 r)\n{\n    if (l == r)\n        return void(tree[rt].val = io);\n    u32 mid = l + r >> 1;\n    build(rt << 1, l, mid);\n    build(rt << 1 | 1, mid + 1, r);\n    tree[rt].val = Mod(L tree[rt << 1].val + tree[rt << 1 | 1].val);\n}\n\nInline void push(u32 rt, u32 len)\n{\n    if (tree[rt].add_tag || tree[rt].mul_tag != 1u)\n    {\n        u32 ls = rt << 1, rs = rt << 1 | 1;\n        tree[rt].val = Mod(L tree[rt].val * tree[rt].mul_tag + L tree[rt].add_tag * len);\n        tree[ls].mul_tag = Mod(L tree[ls].mul_tag * tree[rt].mul_tag);\n        tree[rs].mul_tag = Mod(L tree[rs].mul_tag * tree[rt].mul_tag);\n        tree[ls].add_tag = Mod(L tree[ls].add_tag * tree[rt].mul_tag + tree[rt].add_tag);\n        tree[rs].add_tag = Mod(L tree[rs].add_tag * tree[rt].mul_tag + tree[rt].add_tag);\n        tree[rt].mul_tag = 1;\n        tree[rt].add_tag = 0;\n    }\n}\n\nvoid add(u32 rt, u32 l, u32 r)\n{\n    push(rt, r - l + 1);\n    if (ql <= l && qr >= r)\n        return void(tree[rt].add_tag = qval);\n    u32 mid = l + r >> 1;\n    if (ql <= mid)\n        add(rt << 1, l, mid);\n    if (qr >= mid + 1)\n        add(rt << 1 | 1, mid + 1, r);\n    push(rt << 1, mid - l + 1), push(rt << 1 | 1, r - mid);\n    tree[rt].val = Mod(L tree[rt << 1].val + tree[rt << 1 | 1].val);\n}\n\nvoid mul(u32 rt, u32 l, u32 r)\n{\n    push(rt, r - l + 1);\n    if (ql <= l && qr >= r)\n        return void(tree[rt].mul_tag = qval);\n    u32 mid = l + r >> 1;\n    if (ql <= mid)\n        mul(rt << 1, l, mid);\n    if (qr >= mid + 1)\n        mul(rt << 1 | 1, mid + 1, r);\n    push(rt << 1, mid - l + 1), push(rt << 1 | 1, r - mid);\n    tree[rt].val = Mod(L tree[rt << 1].val + tree[rt << 1 | 1].val);\n}\n\nu32 sum(u32 rt, u32 l, u32 r)\n{\n    push(rt, r - l + 1);\n    if (ql <= l && qr >= r)\n        return tree[rt].val;\n    u32 mid = l + r >> 1, r1 = 0, r2 = 0;\n    if (ql <= mid)\n        r1 = sum(rt << 1, l, mid);\n    if (qr >= mid + 1)\n        r2 = sum(rt << 1 | 1, mid + 1, r);\n    return Mod(L r1 + r2);\n}\n\nint main()\n{\n    u32 n, m, op;\n    n = io, P = io;\n    for (K = 0; P >= 1 << (K + 1); ++K)\n        ;\n    M = ((u128)1 << (K + 64)) / P;\n    if (((P * M) >> (64 + K)) != 1)\n        ++M;\n    build(1, 1, n);\n    m = io;\n    for (u32 _ = 1; _ <= m; ++_)\n    {\n        op = io, ql = io, qr = io;\n        switch (op)\n        {\n        case 1u: // mul\n            qval = io;\n            mul(1, 1, n);\n            break;\n        case 2u: // add\n            qval = io;\n            add(1, 1, n);\n            break;\n        case 3u: // sum\n            io.print(sum(1, 1, n));\n            break;\n        }\n    }\n}\n```",
        "postTime": 1532245242,
        "uid": 68618,
        "name": "MashPlant",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "\u8bf4\u5b9e\u8bdd\uff0c\u6253\u4e86\u7ebf\u6bb5\u68112\u540e\u518d\u6253\u8fd9\u9898\uff0c\u4e0d\u5f97\u4e0d\u8bf4\u5bf9\u7ebf\u6bb5\u6811\u7406\u89e3\u6df1\u523b\u591a\u4e86\u3002\n\n\u4e3a\u4ec0\u4e48\u6211\u90a3\u9898\u4e0d\u53d1\u5462\uff1f\u5f88\u7b80\u5355\uff0c\u6211\u4e0d\u592a\u559c\u6b22\u7801\u5b57\uff0c\u6240\u4ee5\u6211\u6765\u63a8\u8350\u4e00\u4e0b\u6211\u7684\u795e\u5947\u7684\u4ee3\u7801\u98ce\u683c\uff08\u4f4d\u8fd0\u7b97+\u5927\u5199\u5b57\u7b26\uff0c\u6e05\u6670\u6613\u61c2\uff09\n\nCode Below:\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int maxn=100000+10;\nll A[maxn<<1],Sum[maxn<<3],Add[maxn<<3],Mul[maxn<<3];\nll n,s,p;\n\nvoid PushUp(ll rt){Sum[rt]=(Sum[rt<<1]+Sum[rt<<1|1])%p;}//\u4e0a\u63a8\u51fd\u6570\nvoid PushDown(ll rt,ll m)//\u4e0b\u63a8\u51fd\u6570\uff0c\u6ce8\u610f\u4e58\u6cd5\u4f18\u5148\u7ea7\u6bd4\u52a0\u6cd5\u9ad8\n{\n    if(Add[rt]||Mul[rt]!=1){\n        Sum[rt<<1]=(Sum[rt<<1]*Mul[rt]+Add[rt]*(m-(m>>1)))%p;\n        Sum[rt<<1|1]=(Sum[rt<<1|1]*Mul[rt]+Add[rt]*(m>>1))%p;\n        Add[rt<<1]=(Add[rt<<1]*Mul[rt]+Add[rt])%p;\n        Add[rt<<1|1]=(Add[rt<<1|1]*Mul[rt]+Add[rt])%p;\n        Mul[rt<<1]=(Mul[rt<<1]*Mul[rt])%p;\n        Mul[rt<<1|1]=(Mul[rt<<1|1]*Mul[rt])%p;\n        Add[rt]=0;Mul[rt]=1;\n    }\n}\nvoid Build(ll l,ll r,ll rt)//\u5efa\u6811\n{\n    Add[rt]=0;Mul[rt]=1;\n    if(l == r){\n        Sum[rt]=A[l]%p;\n        return ;\n    }\n    ll m=(l+r)>>1;\n    Build(l,m,rt<<1);\n    Build(m+1,r,rt<<1|1);\n    PushUp(rt);\n}\nvoid Update_mul(ll L,ll R,ll C,ll l,ll r,ll rt)//\u533a\u95f4\u4e58\u6cd5\u8fd0\u7b97\n{\n    PushDown(rt,(r-l+1));\n    if(L <= l && r <= R){\n        Sum[rt]=Sum[rt]*C;\n        Sum[rt]=Sum[rt]%p;\n        Mul[rt]=Mul[rt]*C;\n        Mul[rt]=Mul[rt]%p;\n        return ;\n    }\n    ll m=(l+r)>>1;\n    if(L <= m) Update_mul(L,R,C,l,m,rt<<1);\n    if(R > m)  Update_mul(L,R,C,m+1,r,rt<<1|1);\n    PushUp(rt);\n}\nvoid Update_plu(ll L,ll R,ll C,ll l,ll r,ll rt)//\u533a\u95f4\u52a0\u6cd5\u8fd0\u7b97\n{\n    PushDown(rt,r-l+1);\n    if(L <= l && r <= R){\n        Sum[rt]=(Sum[rt]+(r-l+1)*C)%p;\n        Add[rt]=(Add[rt]+C)%p;\n        return ;\n    }\n    ll m=(l+r)>>1;\n    if(L <= m) Update_plu(L,R,C,l,m,rt<<1);\n    if(R > m)  Update_plu(L,R,C,m+1,r,rt<<1|1);\n    PushUp(rt);\n}\nll Query(ll L,ll R,ll l,ll r,ll rt)//\u533a\u95f4\u67e5\u8be2\n{\n    PushDown(rt,r-l+1);\n    if(L <= l && r <= R){\n        return Sum[rt];\n    }\n    ll m=(l+r)>>1,Ans=0;\n    if(L <= m) Ans=(Ans+Query(L,R,l,m,rt<<1))%p;\n    if(R > m)  Ans=(Ans+Query(L,R,m+1,r,rt<<1|1))%p;\n    return Ans;\n}\nint main()//\u5404\u79cd\u64cd\u4f5c\n{\n    scanf(\"%lld%lld\",&n,&p);\n    for(int i=1;i<=n;i++)\n        scanf(\"%lld\",&A[i]);\n    Build(1,n,1);\n    scanf(\"%lld\",&s);\n    for(int i=1;i<=s;i++){\n        ll t,x,y,k;\n        scanf(\"%lld%lld%lld\",&t,&x,&y);\n        if(t==1){\n            scanf(\"%lld\",&k);\n            Update_mul(x,y,k,1,n,1);\n        }\n        if(t==2) {\n            scanf(\"%lld\",&k);\n            Update_plu(x,y,k,1,n,1);\n        }\n        if(t==3){\n            printf(\"%lld\\n\",Query(x,y,1,n,1));\n        }\n    }\n    return 0;\n}\n```",
        "postTime": 1528200540,
        "uid": 35069,
        "name": "Owen_codeisking",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "### \u8fd8\u6ca1\u6709zkw\u7ebf\u6bb5\u6811\u7684\u7248\u672c\uff0c\u6211\u6765\u4e0a\u4e00\u53d1\n\u5982\u679c\u4e0d\u4f1a\u7ebf\u6bb5\u6811\u7684lazy\u6807\u8bb0\u53ef\u4ee5\u53c2\u8003\u697c\u4e0b\u9898\u89e3\n\u8be6\u7ec6\u7684\u8bf7\u770b\u535a\u5ba2[zkw\u4e4blazy\u6807\u8bb0](https://www.cnblogs.com/czx-1010/articles/9679412.html)\n\n__\u5751\u70b9:\u533a\u95f4\u4e58\u6cd5\u8fd0\u7b97\u548c\u52a0\u6cd5\u9700\u8981\u81ea\u5b9a\u8fd0\u7b97\u4f18\u5148\u7ea7,\u5426\u5219\u6807\u8bb0\u4f1a\u4e92\u76f8\u5f71\u54cd,\u672c\u4eba\u662f\u5148\u4e58\u540e\u52a0\u7248\u7684,\u5148\u52a0\u540e\u4e58\u6bd4\u8f83\u96be\u5199,\u8fd8\u8981\u7528\u9006\u5143,\u6a21\u6570\u4e0d\u662f\u8d28\u6570\u5c31\u4e0d\u53ef\u505a__\n\n```C++\n#include<cmath>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\ntypedef long long ll;\nint read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile (ch<'0'||ch>'9') ch=='-'&&(f=-1),ch=getchar();\n\twhile (ch>='0'&&ch<='9') x=x*10+ch-'0',ch=getchar();\n\treturn x*f;\n}\nconst int N=1e5+10;\nint n,P;\nstruct ZKW_Tree\n{\n\tint m,sta[32];\n\tint t[N<<2],ad[N<<2],mu[N<<2],len[N<<2];//zkw\u7ebf\u6bb5\u6811\u67092*m\u4e2a\u8282\u70b9,m\u6700\u591a\u67092*n;\n\tvoid mod(int&x){if (x>=P)x-=P;}\n\tvoid updata(int p){t[p]=t[p<<1]+t[p<<1|1];mod(t[p]);}//\u66f4\u65b0\u8282\u70b9\uff1b\n\tvoid upper(int p){while (p) updata(p),p>>=1;}\n\tvoid build()//\u5efazkw\u7ebf\u6bb5\u6811\n\t{\n\t\tfor (m=1;m<n;m<<=1);--m;\n\t\tfor (int i=1;i<=n;++i) t[i+m]=read()%P,len[i+m]=1;\n\t\tfor (int i=m;i;--i) \n\t\t{\n\t\t\tupdata(i);mu[i]=1;\n\t\t\tlen[i]=len[i<<1]+len[i<<1|1];mod(len[i]);\n\t\t}\n\t}\n\tvoid add_tag(int x,int v){t[x]=(t[x]+1ll*len[x]*v)%P;ad[x]+=v;mod(ad[x]);}//\u6253\u52a0\u6807\u8bb0\n\tvoid mul_tag(int x,int v){t[x]=1ll*t[x]*v%P,mu[x]=1ll*mu[x]*v%P,ad[x]=1ll*ad[x]*v%P;}//\u6253\u4e58\u6807\u8bb0\n\tvoid pushdown(int x)//\u6807\u8bb0\u4e0b\u4f20\n\t{\n\t\tif (mu[x]!=1)\tmul_tag(x<<1,mu[x]),mul_tag(x<<1|1,mu[x]),mu[x]=1;\n\t\tif (ad[x])\t\tadd_tag(x<<1,ad[x]),add_tag(x<<1|1,ad[x]),ad[x]=0;\n\t}\n\tvoid push(int x)//\u6a21\u62df\u666e\u901a\u7ebf\u6bb5\u6811\u6807\u8bb0\u4e0b\u4f20\n\t{\n\t\tint top=0;\n\t\twhile (x) sta[++top]=x,x>>=1;\n\t\twhile (top>1) pushdown(sta[top--]);\n\t}\n\tint query(int l,int r)//\u533a\u95f4\u6c42\u548c\n\t{\n\t\tint su=0;\n\t\tfor (l=l+m-1,r=r+m+1,push(l),push(r);l^r^1;l>>=1,r>>=1)\n\t\t{\n\t\t\tif (~l&1)\tsu+=t[l^1],mod(su);\n\t\t\tif (r&1)\tsu+=t[r^1],mod(su);\n\t\t}\n\t\treturn su;\n\t}\n\tvoid add(int l,int r,int z)//\u533a\u95f4\u52a0\u6cd5\n\t{\n\t\tfor (l=l+m-1,r=r+m+1,push(l),push(r);l^r^1;l>>=1,r>>=1,updata(l),updata(r))\n\t\t{\n\t\t\tif (~l&1)\tadd_tag(l^1,z);\n\t\t\tif (r&1)\tadd_tag(r^1,z);\n\t\t}\n\t\tupper(l>>1);\n\t}\n\tvoid mul(int l,int r,int z)//\u533a\u95f4\u4e58\u6cd5\n\t{\n\t\tfor (l=l+m-1,r=r+m+1,push(l),push(r);l^r^1;l>>=1,r>>=1,updata(l),updata(r))\n\t\t{\n\t\t\tif (~l&1)\tmul_tag(l^1,z);\n\t\t\tif (r&1)\tmul_tag(r^1,z);\n\t\t}\n\t\tupper(l>>1);\n\t}\n}ST;\nint main()\n{\n\tn=read(),P=read();\n\tST.build();\n\tfor (int i=0,mode,x,y,z,q=read();i<q;++i)\n\t{\n\t\tmode=read();\n\t\tif (mode==1)x=read(),y=read(),z=read(),ST.mul(x,y,z%P);\n\t\telse if (mode==2) x=read(),y=read(),z=read(),ST.add(x,y,z%P);\n\t\telse x=read(),y=read(),printf(\"%d\\n\",ST.query(x,y));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1537516461,
        "uid": 22041,
        "name": "1010_",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "\u9898\u76ee\u8981\u6c42\u7ef4\u62a4\u4e00\u4e2a\u5e8f\u5217\uff0c\u8fdb\u884c\u533a\u95f4\u52a0\u3001\u533a\u95f4\u4e58\u3001\u533a\u95f4\u67e5\u8be2\u548c\u3002\u5f88\u5bb9\u6613\u60f3\u5230\u7ebf\u6bb5\u6811\uff0c\u9700\u8981\u7c7b\u4f3clazyj\u6dfb\u52a0\u4e00\u4e2alazyc\uff0c\u7528\u4ee5\u8bb0\u5f55\u8fd9\u4e2a\u533a\u95f4\u88ab\u4e00\u8d77\u4e58\u4e86\u591a\u5c11\u3002\n\n##### lazyc\u7684pushdown(\u5728\u4e0b\u653elazyc\u65f6\u9700\u8981\u540c\u65f6\u4e0b\u653elazyj\uff0c\u53e6\u5916\u9700\u6ce8\u610flazyc\u7684\u521d\u59cb\u5316\u662f1\u4e0d\u662f0):\n```cpp\nt[id<<1].lazyc=(t[id<<1].lazyc*t[id].lazyc)%mod;//\u4e0b\u653elazyc\nt[id<<1].lazyj=((t[id<<1].lazyj*t[id].lazyc)%mod+t[id].lazyj)%mod;//\u4e0b\u653elazyj\uff0c\u8bb0\u5f97lazyj\u4e5f\u9700\u8981\u7ffblazyc\u500d\nt[id<<1|1].lazyc=(t[id<<1|1].lazyc*t[id].lazyc)%mod;\nt[id<<1|1].lazyj=((t[id<<1|1].lazyj*t[id].lazyc)%mod+t[id].lazyj)%mod;\nt[id].lazyj=0;\nt[id].lazyc=1;\n```\n\n##### lazyc\u7684pushup\uff1a\n```cpp\nt[id].sum=((t[id*2].sum*t[id*2].lazyc)%mod+t[id<<1].lazyj*(t[id<<1].right-t[id<<1].left+1)%mod)%mod\n               +((t[id<<1|1].sum*t[id<<1|1].lazyc)%mod+t[id<<1|1].lazyj*(t[id<<1].right-t[id<<1].left+1)%mod)%mod;\n```\n\u9700\u8981\u7279\u522b\u6ce8\u610f\u7684\u662f\u52a0\u548c\u4e58\u7684\u4f18\u5148\u7ea7\u95ee\u9898\u3002\u6ce8\u610f\u7ef4\u62a4lazyc\u7684\u65f6\u5019\u4e0d\u7528\u8003\u8651lazyj\uff08\u4e58\u6cd5\u4f18\u5148\u7ea7\u9ad8\uff09\uff0c\u4f46\u7ef4\u62a4lazyj\u7684\u65f6\u5019\u8981*=lazyc\n\n\u9644\u5b8c\u6574\u4ee3\u7801\n\n```cpp\n#include <iostream>\n#include <cstdio>\nusing namespace std;\nint mod;\nint n,m;\nconst int maxn=150000;\nstruct Node //\u7ed3\u6784\u4f53\u7248\n{\n       int left,right;\n       long long lazyj,lazyc;\n       long long sum;\n}t[maxn*2];\nlong long a[maxn];\nvoid buildtree() //\u9012\u63a8\u5efa\u6811\n{\n     int ln=1;\n     while(ln<n) ln*=2;\n     for(int id=ln;id<ln*2;id++)\n     {\n             t[id].left=t[id].right=id-ln+1;\n             t[id].lazyj=0;\n             t[id].lazyc=1;\n             t[id].sum=a[id-ln+1];\n     }\n     for(int id=ln-1;id>=1;id--)\n     {\n             t[id].left=t[id<<1].left;\n             t[id].right=t[id<<1|1].right;\n             t[id].sum=t[id<<1].sum+t[id<<1|1].sum;\n             t[id].lazyj=0;\n             t[id].lazyc=1;\n     }\n}\nlong long query(int id,int l,int r) //\u67e5\u8be2\n{\n     if(t[id].left==l && t[id].right==r) //\u8fb9\u754c\u6761\u4ef6\n     {\n            // cout << \"end query\"<<endl;\n            return ((t[id].sum*t[id].lazyc)%mod+t[id].lazyj*(t[id].right-t[id].left+1)%mod)%mod;\n     }\n     if(t[id].lazyj!=0||t[id].lazyc!=1) //pushdown\n     {\n            t[id<<1].lazyc=(t[id<<1].lazyc*t[id].lazyc)%mod;\n            t[id<<1].lazyj=((t[id<<1].lazyj*t[id].lazyc)%mod+t[id].lazyj)%mod;\n            t[id<<1|1].lazyc=(t[id<<1|1].lazyc*t[id].lazyc)%mod;\n            t[id<<1|1].lazyj=((t[id<<1|1].lazyj*t[id].lazyc)%mod+t[id].lazyj)%mod;\n            t[id].sum=((t[id].sum*t[id].lazyc)%mod+t[id].lazyj*(t[id].right-t[id].left+1)%mod)%mod;\n            t[id].lazyj=0;\n            t[id].lazyc=1;\n     }\n     if(r<=t[id<<1].right)\n     {\n          \n         return query(id*2,l,r);\n         }\n     else if(l>=t[id<<1|1].left)         \n         return query(id<<1|1,l,r);\n     else\n     {\n         return (query(id<<1,l,t[id<<1].right)+\n         query(id<<1|1,t[id<<1|1].left,r))%mod;\n         \n     }     \n}\nvoid change(int id,int l,int r,int c,int flag)\n{\n     if(t[id].left==l && t[id].right==r)\n     {\n\t\t// cout<<\"OK\"<<endl;\n        if(flag==1)\n        {\n            t[id].lazyj=(t[id].lazyj*c)%mod;\n            t[id].lazyc=(t[id].lazyc*c)%mod;\n        }\n        else if(flag==2)\n        {\n            t[id].lazyj=(t[id].lazyj+c)%mod;\n        }\n        return;\n     }\n     if(t[id].lazyj!=0||t[id].lazyc!=1)\n     {\n            t[id<<1].lazyc=(t[id<<1].lazyc*t[id].lazyc)%mod;\n            t[id<<1].lazyj=((t[id<<1].lazyj*t[id].lazyc)%mod+t[id].lazyj)%mod;\n            t[id<<1|1].lazyc=(t[id<<1|1].lazyc*t[id].lazyc)%mod;\n            t[id<<1|1].lazyj=((t[id<<1|1].lazyj*t[id].lazyc)%mod+t[id].lazyj)%mod;\n            t[id].lazyj=0;\n            t[id].lazyc=1;\n     }\n     if(r<=t[id<<1].right)\n     {\n         change(id*2,l,r,c,flag);\n        // cout<<l<<\" \"<<r<<endl;   \n     }\n     else if(l>=t[id<<1|1].left)\n     {\n         change(id<<1|1,l,r,c,flag);\n         //cout<<l<<\" \"<<r<<endl;\n     }\n     else\n     {\n         change(id<<1,l,t[id<<1].right,c,flag);\n         change(id<<1|1,t[id<<1|1].left,r,c,flag);\n         //cout<<r<<\" \"<<c<<endl;\n     }\n     t[id].sum=((t[id*2].sum*t[id*2].lazyc)%mod+t[id<<1].lazyj*(t[id<<1].right-t[id<<1].left+1)%mod)%mod\n               +((t[id<<1|1].sum*t[id<<1|1].lazyc)%mod+t[id<<1|1].lazyj*(t[id<<1].right-t[id<<1].left+1)%mod)%mod; //pushup\n     \n}\nint main()\n{\n    cin>>n>>mod;\n    for(int i=1;i<=n;i++) cin>>a[i];\n    buildtree();\n    int m; cin>>m;\n    for(int i=1;i<=m;i++)\n    {\n    \tint opt,x,y,c;\n    \tcin>>opt>>x>>y;\n    \tif(opt==1 || opt==2)\n    \t{\n    \t\tcin>>c;\n    \t\tchange(1,x,y,c,opt);\n        }\n        else\n        {\n        \tcout<<query(1,x,y)<<endl;\n        }\n    }\n    return 0;\n}\n```",
        "postTime": 1535081642,
        "uid": 38212,
        "name": "mydiplomacy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "# [AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u9898\u89e3\n\u5176\u5b9e\u5c31\u662f ~~\u3010\u6a21\u677f\u3011\u7ebf\u6bb5\u68112~~\n### \u4e0b\u9762\u4ecb\u7ecd\u51e0\u79cd\u7ebf\u6bb5\u6811\u7684\u57fa\u672c\u64cd\u4f5c\n- \u5efa\u6811\n\nres[p]\u8868\u793a\u5b83\u7684\u6240\u6709\u53f6\u5b50\u8282\u70b9\u7684\u503c\u7684\u548c\n\u6839\u636e\u4e8c\u53c9\u6811\u7684\u6027\u8d28\u53ef\u5f97\u8282\u70b9p\u7684\u5de6\u513f\u5b50\u662fp\u00d72,\u5373(p<<1),\u53f3\u513f\u5b50\u662fp\u00d72+1,\u5373(p<<1|1)\n```cpp\nvoid build(int p,int l,int r){\n\ttagadd[p]=0;\n\ttagmul[p]=1;\n\tif(l==r){\n\t\tres[p]=a[l];\n\t\treturn ;\n\t}\n\tint mid=l+r>>1;\n\tbuild(p<<1,l,mid);\n\tbuild(p<<1|1,mid+1,r);\n\tpushup(p);//\u66f4\u65b0\u6839\u8282\u70b9\u7684\u503c\n}\n```\n- \u4e0b\u653e\u61d2\u6807\u8bb0\n#### \u4e3a\u4ec0\u4e48\u8981\u61d2\u6807\u8bb0\uff1f\n\u7531\u4e8e\u6211\u4eec\u8981\u505a\u7684\u64cd\u4f5c\u662f\u533a\u95f4\u52a0\u4e00\u4e2a\u6570\u6216\u4e58\u4e00\u4e2a\u6570\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u59a8\u5728\u533a\u95f4\u8fdb\u884c\u4fee\u6539\u65f6\u4e3a\u8be5\u533a\u95f4\u6253\u4e0a\u4e00\u4e2a\u6807\u8bb0\uff0c\u5c31\u4e0d\u5fc5\u518d\u4fee\u6539\u4ed6\u7684\u513f\u5b50\u6240\u7ef4\u62a4\u533a\u95f4\uff0c\u7b49\u5230\u8981\u4f7f\u7528\u8be5\u8282\u70b9\u7684\u513f\u5b50\u8282\u70b9\u7ef4\u62a4\u7684\u503c\u65f6\uff0c\u518d\u5c06\u61d2\u6807\u8bb0\u4e0b\u653e\u5373\u53ef\uff0c\u53ef\u4ee5\u8282\u7701\u5f88\u591a\u65f6\u95f4\uff0c\u5bf9\u4e8e\u6bcf\u6b21\u533a\u95f4\u4fee\u6539\u548c\u67e5\u8be2\uff0c\u5c06\u61d2\u6807\u8bb0\u4e0b\u4f20\uff0c\u53ef\u4ee5\u8282\u7701\u5f88\u591a\u65f6\u95f4\n\n\u7528tagadd[p]\u8868\u793ap\u5bf9\u5e94\u7684\u533a\u95f4\u5185\u7684\u6bcf\u4e00\u4e2a\u6811\u90fd\u8981\u52a0\u4e0atagadd[p],\ntagmul[p]\u8868\u793a\u4e58\n```cpp\nvoid pushdown(int p,int l,int r){\n\tint mid=l+r>>1;\n\tres[p<<1]=(res[p<<1]*tagmul[p]+tagadd[p]*(mid-l+1))%mod;\n\tres[p<<1|1]=(res[p<<1|1]*tagmul[p]+tagadd[p]*(r-mid))%mod;//\u4e0b\u65b9\u61d2\u6807\u8bb0\uff0c\u66f4\u65b0\u5b50\u6811\u7684\u503c\n\ttagmul[p<<1]=(tagmul[p<<1]*tagmul[p])%mod;\n\ttagadd[p<<1]=(tagadd[p<<1]*tagmul[p]+tagadd[p])%mod;\n\ttagmul[p<<1|1]=(tagmul[p<<1|1]*tagmul[p])%mod;\n\ttagadd[p<<1|1]=(tagadd[p<<1|1]*tagmul[p]+tagadd[p])%mod;\n\ttagmul[p]=1;\n\ttagadd[p]=0;//\u6e05\u7a7a\u6839\u8282\u70b9\u7684\u61d2\u6807\u8bb0\uff0c\u5904\u7406\u5b50\u8282\u70b9\u7684\u61d2\u6807\u8bb0\n}\n```\n- \u533a\u95f4\u52a0\u6cd5\n```cpp\nvoid add(int p,int l,int r,int L,int R,int k){\n\tif(l>=L&&r<=R){\n\t\tres[p]+=k*(r-l+1);\n\t\tres[p]%=mod;\n\t\ttagadd[p]=(tagadd[p]+k)%mod;\n\t\treturn ;\n\t}\n\tint mid=l+r>>1;\n\tpushdown(p,l,r);\n\tif(mid>=L) add(p<<1,l,mid,L,R,k);\n\tif(mid<R) add(p<<1|1,mid+1,r,L,R,k);//\u4fdd\u8bc1\u533a\u95f4\u5185\u6db5\u76d6\u9700\u8981\u5904\u7406\u7684\u8282\u70b9\n\tpushup(p);\n}\n```\n- \u533a\u95f4\u4e58\u6cd5\n### \u6ce8\u610f\n\u4e00\u4e2a\u533a\u95f4\u505a\u4e58\u6cd5\uff0c\u533a\u95f4\u5185\u5f85\u52a0\u7684\u6570\u4e5f\u662f\u533a\u95f4\u5185\u7684\u6570\uff0c\u4e5f\u8981\u4e58k\n```cpp\nvoid mul(int p,int l,int r,int L,int R,int k){\n\tif(l>=L&&r<=R){\n\t\tres[p]*=k;\n\t\tres[p]%=mod;\n\t\ttagmul[p]=(tagmul[p]*k)%mod;\n\t\ttagadd[p]=(tagadd[p]*k)%mod;\n\t\treturn ;\n\t}\n\tint mid=l+r>>1;\n\tpushdown(p,l,r);\n\tif(mid>=L) mul(p<<1,l,mid,L,R,k);\n\tif(mid<R) mul(p<<1|1,mid+1,r,L,R,k);\n\tpushup(p);\n}\n```\n- \u67e5\u627e\n```cpp\nlong long query(int p,int l,int r,int L,int R){\n\tif(l>=L&&r<=R){\n\t\treturn res[p];\n\t}\n\tlong long ans=0;\n\tint mid=l+r>>1;\n\tpushdown(p,l,r);\n\tif(mid>=L) ans+=query(p<<1,l,mid,L,R);\n\tif(mid<R) ans+=query(p<<1|1,mid+1,r,L,R);//\u6c42\u548c\n\tpushup(p);\n\treturn ans%mod;\n}\n```\n### \u4e0b\u9762\u8d34\u4ee3\u7801 \n~~\u5176\u5b9e\u5c31\u662f\u7ec4\u5408\u8d77\u6765~~\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nlong long n,m,mod;//mod\u8303\u56f4\u5927\uff0c\u8bb0\u5f97\u5f00long long\nlong long a[100010];\nlong long res[400010],tagadd[400010],tagmul[400010];\nvoid pushup(int p){\n\tres[p]=(res[p<<1]+res[p<<1|1])%mod;\n}\nvoid pushdown(int p,int l,int r){\n\tint mid=l+r>>1;\n\tres[p<<1]=(res[p<<1]*tagmul[p]+tagadd[p]*(mid-l+1))%mod;\n\tres[p<<1|1]=(res[p<<1|1]*tagmul[p]+tagadd[p]*(r-mid))%mod;\n\ttagmul[p<<1]=(tagmul[p<<1]*tagmul[p])%mod;\n\ttagadd[p<<1]=(tagadd[p<<1]*tagmul[p]+tagadd[p])%mod;\n\ttagmul[p<<1|1]=(tagmul[p<<1|1]*tagmul[p])%mod;\n\ttagadd[p<<1|1]=(tagadd[p<<1|1]*tagmul[p]+tagadd[p])%mod;\n\ttagmul[p]=1;\n\ttagadd[p]=0;\n}\nvoid build(int p,int l,int r){\n\ttagadd[p]=0;\n\ttagmul[p]=1;\n\tif(l==r){\n\t\tres[p]=a[l];\n\t\treturn ;\n\t}\n\tint mid=l+r>>1;\n\tbuild(p<<1,l,mid);\n\tbuild(p<<1|1,mid+1,r);\n\tpushup(p);\n}\nvoid add(int p,int l,int r,int L,int R,int k){\n\tif(l>=L&&r<=R){\n\t\tres[p]+=k*(r-l+1);\n\t\tres[p]%=mod;\n\t\ttagadd[p]=(tagadd[p]+k)%mod;\n\t\treturn ;\n\t}\n\tint mid=l+r>>1;\n\tpushdown(p,l,r);\n\tif(mid>=L) add(p<<1,l,mid,L,R,k);\n\tif(mid<R) add(p<<1|1,mid+1,r,L,R,k);\n\tpushup(p);\n}\nvoid mul(int p,int l,int r,int L,int R,int k){\n\tif(l>=L&&r<=R){\n\t\tres[p]*=k;\n\t\tres[p]%=mod;\n\t\ttagmul[p]=(tagmul[p]*k)%mod;\n\t\ttagadd[p]=(tagadd[p]*k)%mod;\n\t\treturn ;\n\t}\n\tint mid=l+r>>1;\n\tpushdown(p,l,r);\n\tif(mid>=L) mul(p<<1,l,mid,L,R,k);\n\tif(mid<R) mul(p<<1|1,mid+1,r,L,R,k);\n\tpushup(p);\n}\nlong long query(int p,int l,int r,int L,int R){\n\tif(l>=L&&r<=R){\n\t\treturn res[p];\n\t}\n\tlong long ans=0;\n\tint mid=l+r>>1;\n\tpushdown(p,l,r);\n\tif(mid>=L) ans+=query(p<<1,l,mid,L,R);\n\tif(mid<R) ans+=query(p<<1|1,mid+1,r,L,R);\n\tpushup(p);\n\treturn ans%mod;\n}\ninline long long read(){//\u6c34\u4e00\u6ce2\u5feb\u8bfb\n\tlong long x=0,f=1;\n\tchar c=getchar();\n\twhile(!isdigit(c)){if(c=='-') f=-1;c=getchar();}\n\twhile(isdigit(c)){\n\t\tx=(x<<3)+(x<<1)+(c^48);\n\t\tc=getchar();\n\t}\n\treturn x*f;\n}\nint main(){\n\tn=read(),mod=read();\n\tfor(int i=1;i<=n;i++) a[i]=read();\n\tm=read();\n\tbuild(1,1,n);\n\tfor(int i=1;i<=m;i++){\n\t\tint a;\n\t\tscanf(\"%d\",&a);\n\t\tlong long l=read(),r=read();\n\t\tswitch(a){\n\t\t\tcase 1:{\n\t\t\t\tlong long k=read();\n\t\t\t\tmul(1,1,n,l,r,k);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 2:{\n\t\t\t\tlong long k=read();\n\t\t\t\tadd(1,1,n,l,r,k);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 3:{\n\t\t\t\tprintf(\"%lld\\n\",query(1,1,n,l,r));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\treturn 0;\n}\n ```\n##### ~~\u849f\u84bbCSP\u540e\u7684\u7b2c\u4e00\u7bc7\u9898\u89e3\u6c42\u7ba1\u7406\u5458\u901a\u8fc7~~",
        "postTime": 1571655462,
        "uid": 131933,
        "name": "sunzh",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "\u6a21\u677f\u9898\u53cc\u500d\u7ecf\u9a8c\uff1f\uff1f\uff1f\n\n\u8fd9\u4e00\u9898\u548c\u7ebf\u6bb5\u68112\u57fa\u672c\u4e0a\u662f\u4e00\u6a21\u4e00\u6837\u7684\uff0c\u4f46\u662f\u63a8\u8350\u5927\u5bb6\u591a\u5199\u51e0\u904d\uff0c\u5bf9\u7ebf\u6bb5\u6811\u7684\u4f7f\u7528\u66f4\u52a0\u719f\u7ec3\n\n\u6b64\u5916\uff0c\u63a8\u8350\u4f7f\u7528\u7ed3\u6784\u4f53\u6307\u9488\u6784\u5efa\u7ebf\u6bb5\u6811\uff0c\u56e0\u4e3a\u6709\u4e9b\u6bd2\u7624\u9898\u4f1a\u8ba9\u4f60\u7684\u7ebf\u6bb5\u6811\u4e0d\u662f\u5806\u5f0f\u7684\u3002\u3002\u3002\u6240\u4ee5\u7528\u94fe\u5f0f\u5b58\u50a8\u5c31\u76f8\u5f53\u6709\u5fc5\u8981\u4e86\n\n\u5176\u4f59\u7684\u5199\u5728\u4ee3\u7801\u91cc~\n\n```cpp\n#include <cstdio>\n\n#define ll long long\n\nconst int MAXN = 1000000 + 10;\n\nstruct Node {\n    int l, r;//\u8868\u793a\u7ed3\u70b9\u533a\u95f4\u7aef\u70b9\n    ll sum, lazyS, lazyM;//\u533a\u95f4\u548c\uff0c\u52a0\u6cd5\u6807\u8bb0\u548c\u4e58\u6cd5\u6807\u8bb0\n    Node *lc, *rc;//\u8be5\u8282\u70b9\u7684\u5de6\u5b50\u8282\u70b9\u548c\u53f3\u5b50\u8282\u70b9\n} tree[MAXN << 2], *root;//\u6570\u7ec4\u6a21\u62df\u94fe\u8868\u548c\u6839\u8282\u70b9\u7684\u4f4d\u7f6e\n\nint a[MAXN], n, m, cnt;\nll mod;\n\nvoid build(Node *p, int l, int r) {//\u5efa\u6811\n    p->l = l;\n    p->r = r;\n    p->lazyM = 1;//\u6ce8\u610f\uff0c\u4e00\u5b9a\u8981\u628a\u4e58\u6cd5\u6807\u8bb0\u5728\u5efa\u6811\u65f6\u5c31\u8d4b\u503c\u4e3a1\n    if (l == r){\n        p->sum = a[l] % mod;\n        return;\n    } \n    int mid = (l + r) / 2;\n    Node *lson = &tree[++cnt];\n    Node *rson = &tree[++cnt];\n    p->lc = lson;\n    p->rc = rson;\n    build(p->lc, l, mid);\n    build(p->rc, mid + 1, r);\n    p->sum = (p->lc->sum + p->rc->sum) % mod;\n}\n\nvoid pushDown(Node *p) {//\u6807\u8bb0\u7684\u4e0b\u4f20\uff0c\u8fd9\u91cc\u662f\u5148\u4e58\u540e\u52a0\uff0c\u8bb0\u5f97\u5de6\u53f3\u5b50\u8282\u70b9\u52a0\u6cd5\u548c\u4e58\u6cd5\u6807\u8bb0\u90fd\u8981\u4e58\u8be5\u8282\u70b9\u4e58\u6cd5\u6807\u8bb0\n        p->lc->sum = (p->lc->sum * p->lazyM + p->lazyS * (p->lc->r - p->lc->l + 1)) % mod;\n        p->rc->sum = (p->rc->sum * p->lazyM + p->lazyS * (p->rc->r - p->rc->l + 1)) % mod;\n        p->lc->lazyM = p->lc->lazyM * p->lazyM % mod;\n        p->lc->lazyS = (p->lc->lazyS * p->lazyM + p->lazyS) % mod;\n        p->rc->lazyM = p->rc->lazyM * p->lazyM % mod;\n        p->rc->lazyS = (p->rc->lazyS * p->lazyM + p->lazyS) % mod;\n        p->lazyS = 0;\n        p->lazyM = 1;\n}\n\nvoid mulChange(Node *p, int l, int r, ll mul) {//\u533a\u95f4\u4e58\u7684\u64cd\u4f5c\n    if (l <= p->l && r >= p->r) {\n        p->sum = p->sum * mul % mod;\n        p->lazyS = (p->lazyS * mul) % mod;\n        p->lazyM = (p->lazyM * mul) % mod;\n        return;\n    }\n    pushDown(p);\n    int mid = (p->l + p->r) / 2;\n    if (l <= mid) mulChange(p->lc, l, r, mul);\n    if (r > mid) mulChange(p->rc, l, r, mul);\n    p->sum = (p->lc->sum + p->rc->sum) % mod;\n}\n\nvoid addChange(Node *p, int l, int r, ll add) {//\u533a\u95f4\u52a0\u7684\u64cd\u4f5c\n    if (l <= p->l && r >= p->r) {\n        p->sum = (p->sum + add * (p->r - p->l + 1)) % mod;\n        p->lazyS = (p->lazyS + add) % mod;\n        return;\n    }\n    pushDown(p);\n    int mid = (p->l + p->r) / 2;\n    if (l <= mid) addChange(p->lc, l, r, add);\n    if (r > mid) addChange(p->rc, l, r, add);\n    p->sum = (p->lc->sum + p->rc->sum) % mod;\n}\n\nll query(Node *p, int l, int r) {//\u67e5\u8be2\u533a\u95f4\u548c\n    if (l <= p->l && r >= p->r) return p->sum % mod;\n    pushDown(p);\n    int mid = (p->l + p->r) / 2;\n    ll val = 0;\n    if (l <= mid) val = (val + query(p->lc, l, r)) % mod;\n    if (r > mid) val = (val + query(p->rc, l, r)) % mod;\n    return val % mod;\n}\n\nint main() {\n    scanf(\"%d %d\", &n, &mod);\n    for (int i = 1; i <= n; i++) scanf(\"%d\", a + i);\n    scanf(\" %d\", &m);\n    root = &tree[0];\n    build(root, 1, n);\n    while (m--) {\n        int x, l = 0, r = 0;\n        ll k = 0;\n        scanf(\"%d\", &x);\n        if (x == 1) {\n            scanf(\" %d %d %lld\", &l, &r, &k);\n            mulChange(root, l, r, k);\n        } else if (x == 2) {\n            scanf(\" %d %d %lld\", &l, &r, &k);\n            addChange(root, l, r, k);\n            } else {\n                scanf(\"%d %d\", &l, &r);\n                printf(\"%lld\\n\", query(root, l, r) % mod);\n            }\n    }\n    return 0;\n}\n```\n\n\u7ebf\u6bb5\u6811\u7684\u60f0\u6027\u6807\u8bb0\u4e5f\u662f\u7ebf\u6bb5\u6811\u6700\u4f18\u7f8e\u7684\u5730\u65b9\u4e4b\u4e00\uff0c\u76f8\u4fe1\u7801\u5b8c\u6b64\u9898\uff0c\u4f60\u4e00\u5b9a\u4f1a\u5bf9\u7ebf\u6bb5\u6811\u6807\u8bb0\u7684\u7406\u89e3\u4e0a\u4e00\u4e2a\u6863\u6b21\u3002",
        "postTime": 1570183453,
        "uid": 86409,
        "name": "Night_star",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "# \u5206\u5757\u5927\u6cd5\u543c\u554a\n\n## \u4e3a\u4ec0\u4e48\u6ca1\u4eba\u7528\u5206\u5757\uff1f\n\n~~\u597d\u5427\u8fd9\u9898\u597d\u50cf\u5e76\u4e0d\u592a\u9002\u7528~~\n\n\u53cd\u6b63\u624b\u5de5\u5f00o3\u7ec8\u4e8e\u662f\u5361\u8fc7\u4e86\n\n\u5c31\u662f\u666e\u901a\u7684\u5206\u5757\u6a21\u677f\uff0c\u7ef4\u62a4\u4e00\u4e2a\u4e58\u6cd5\u6807\u8bb0\uff0c\u4e00\u4e2a\u52a0\u6cd5\u6807\u8bb0\uff0c\u4e00\u4e2a\u603b\u548c\u6807\u8bb0\n\n\u8fd9\u8fd8\u662f\u6211\u8fd9\u4e2a\u849f\u84bb\u5b66\u4f1a\u5206\u5757\u540e\u5207\u5f97\u7b2c\u4e00\u9898\uff0c\u4ec0\u4e48\u4f18\u5316\u90fd\u4e0d\u4f1a\uff0c\u5927\u4f6c\u4eec\u6709\u4ec0\u4e48\u5efa\u8bae\u6b22\u8fce\u63d0\u51fa\n\n\u4e0d\u591a\u8bf4\uff0c\u8d34\u4ee3\u7801\n\n```cpp\n// luogu-judger-enable-o2\n// luogu-judger-enable-o2\n// luogu-judger-enable-o2\n#include<bits/stdc++.h>\n#define ll long long\n#define in inline\n#define re register\nusing namespace std;\nconst int maxn=1e6;\nll n,p;\nll blo;\nll a[maxn];\nll bl[maxn>>1];\nll atag[maxn];\nll mtag[maxn];\nll anstag[maxn];\nll len[maxn];\nll m;\n__attribute__((optimize(\"-O3\")))\nin int read(){\n    ll x=0;\n    char ch;\n    do ch=getchar();while (ch<'0'||ch>'9');\n    while (ch>='0' && ch<='9') x=(x<<3)+(x<<1)+(ch^48),ch=getchar();\n    return x;\n}\n__attribute__((optimize(\"-O3\")))\nvoid write(ll x)\n{\n    if(x<0)x=-x,putchar('\\n');\n    if(x>=10)write(x/10);\n    putchar(x%10+'0');\n}\n__attribute__((optimize(\"-O3\")))\nvoid buildblock()\n{\n    blo=sqrt(n);\n    for(re int i=1;i<=n;i++)\n    {\n        bl[i]=(i-1)/blo+1;\n        anstag[bl[i]]+=a[i];\n        len[bl[i]]++;\t\n    }\n    for(re int i=1;i<=bl[n];i++)\n    {\n        mtag[i]=1;\n    }\n}\n__attribute__((optimize(\"-O3\")))\nvoid reset(ll x)\n{\n    for(re int i=(x-1)*blo+1;i<=min(n,x*blo);i++)\n    {\n        a[i]=(a[i]*mtag[x]+atag[x])%p;\n    }\n    atag[x]=0;\n    mtag[x]=1;\n}\n__attribute__((optimize(\"-O3\")))\nvoid slove1(ll x,ll y,ll w)\n{\n    reset(bl[x]);\n    for(re int i=x;i<=min(y,bl[x]*blo);i++)\n    {\n        anstag[bl[x]]-=a[i];\n        a[i]*=w;\n        a[i]%=p;\n        anstag[bl[x]]+=a[i];\n        anstag[bl[x]]%=p;\n    }\n    if(bl[x]!=bl[y])\n    {\n        reset(bl[y]);\n        for(re int i=(bl[y]-1)*blo+1;i<=y;i++)\n        {\n            anstag[bl[y]]-=a[i];\n            a[i]*=w;\n            a[i]%=p;\n            anstag[bl[y]]+=a[i];\n            anstag[bl[y]]%=p;\n        }\n        for(re int i=bl[x]+1;i<=bl[y]-1;i++)\n        {\n            atag[i]*=w;\n            atag[i]%=p;\n            mtag[i]*=w;\n            mtag[i]%=p;\n            anstag[i]*=w;\n            anstag[i]%=p;\n        }\n    }\n}\n__attribute__((optimize(\"-O3\")))\nvoid slove2(ll x,ll y,ll w)\n{\n    reset(bl[x]);\n    for(re int i=x;i<=min(y,bl[x]*blo);i++)\n    {\n        a[i]+=w;\n        a[i]%=p;\n        anstag[bl[x]]+=w;\n    }\n    if(bl[x]!=bl[y])\n    {\n        reset(bl[y]);\n        for(re int i=(bl[y]-1)*blo+1;i<=y;i++)\n        {\n            a[i]+=w;\n            a[i]%=p;\n            anstag[bl[y]]+=w;\n        }\n        for(re int i=bl[x]+1;i<=bl[y]-1;i++)\n        {\n            atag[i]+=w;\n            atag[i]%=p;\n            anstag[i]+=w*len[i];\n        }\n    }\t\n}\n__attribute__((optimize(\"-O3\")))\nin ll ask(ll x,ll y)\n{\n    ll ans=0;\n    for(re int i=x;i<=min(y,bl[x]*blo);i++)\n    {\n        ans+=(a[i]*mtag[bl[x]]+atag[bl[x]])%p;\n    }\n    if(bl[x]!=bl[y])\n    {\n        for(re int i=(bl[y]-1)*blo+1;i<=y;i++)\n        {\n            ans+=(a[i]*mtag[bl[y]]+atag[bl[y]])%p;\n        }\n        for(re int i=bl[x]+1;i<=bl[y]-1;i++)\n        {\n            ans+=anstag[i];\n        }\n    }\n    return ans%p;\n}\nint main()\n{\n    n=read();\n    p=read();\n    for(re int i=1;i<=n;i++)\n    {\n        a[i]=read();\n    }\n    buildblock();\n    m=read();\n    for(re int i=1;i<=m;i++)\n    {\n        ll op;\n        op=read();\n        if(op==1)\n        {\n            int a,b,c;\n            a=read();\n            b=read();\n            c=read();\n            slove1(a,b,c);\n        }\n        if(op==2)\n        {\n            int a,b,c;\n            a=read();\n            b=read();\n            c=read();\n            slove2(a,b,c);\n        }\n        if(op==3)\n        {\n            int a,b;\n            a=read();\n            b=read();\n            write(ask(a,b));\n            printf(\"\\n\");\n        }\n    }\n}\n```\n\u4eba\u5de5\u4eb2\u6d4b\uff0c\u53ef\u653e\u5fc3\u98df\u7528",
        "postTime": 1552301223,
        "uid": 142510,
        "name": "_October_",
        "ccfLevel": 0,
        "title": "p2023\u7ef4\u62a4\u5e8f\u5217\u2014\u2014\u5206\u5757"
    },
    {
        "content": "\u4e0b\u9762\u4e5f\u6ca1\u6709\u4ec0\u4e48pascal\u7684\u7a0b\u5e8f\uff0c\u4f5c\u4e3ap\u515a\u7684\u6211\uff0c\u5c31\u4e3a\u5927\u5bb6\u4f5c\u4e3b\u70b9\u8d21\u732e\u3002\n\n\u81f3\u4e8e\u8fd9\u9053\u9898\u561b\uff0c\u4e4d\u4e00\u770b\uff0c\u5f88\u660e\u663e\u662f\u4e00\u4e2a\u7ebf\u6bb5\u6811\uff0c\n\n\u7ebf\u6bb5\u6811\uff0c\u7c7b\u4f3c\u533a\u95f4\u6811\uff0c\u5b83\u5728\u5404\u4e2a\u8282\u70b9\u4fdd\u5b58\u4e00\u6761\u7ebf\u6bb5\uff08\u6570\u7ec4\u4e2d\u7684\u4e00\u6bb5\u5b50\u6570\u7ec4\uff09\n\n\n\u7ebf\u6bb5\u6811\u88f8\u9898\uff0c\u62ff\u6765\u5f53\u6a21\u677f\u2026\u2026\n\n\u4e24\u4e2a\u6807\u8bb0\uff0c\u4e00\u4e2a\u8bb0\u5f55\u4e58\uff0c\u53e6\u4e00\u4e2a\u8bb0\u5f55\u52a0\uff0c\u7136\u540e\u89c4\u5b9a\u597d\u5148\u4e58\u540e\u52a0\uff0c\u5c31\u53ef\u4ee5\u50cf\u666e\u901a\u7684\u5e26\u6807\u8bb0\u7684\u7ebf\u6bb5\u6811\u4e00\u6837\u7ef4\u62a4\u4e86\u3002\n\n\u7ebf\u6bb5\u6811\u662f\u4e2a\u795e\u5947\u7684\u7b97\u6cd5\uff0c\u5e0c\u671b\u5927\u5bb6\u597d\u597d\u5b66\u5b66\u3002\u3002\u3002\n\n=======================================================================================\n\n\n```cpp\ntype\n  tree=record\n     l,r,sum,mul,plus:longint;   //sum\u533a\u95f4\u548c\uff0cmul\u4e58\u6807\u8bb0\uff0cplus\u52a0\u6807\u8bb0\n  end;\nvar\n  n,m,p,i,t,x,y,d:longint;\n  a:array[0..400040]of tree;\n  num:array[0..100010]of longint;\nprocedure build(k,l,r:longint);        //\u5efa\u6811\nvar\n  i,mid:longint;\nbegin\n   a[k].l:=l;a[k].r:=r;a[k].mul:=1;a[k].plus:=0;\n   if l=r then begin a[k].sum:=num[l];exit; end;\n   i:=k<<1;mid:=(l+r)>>1;\n   build(i,l,mid);\n   build(i+1,mid+1,r);\n   a[k].sum:=a[i].sum+a[i+1].sum;\nend;\nprocedure pushdown(k:longint);   //\u6807\u8bb0\u4e0b\u4f20\nvar\n  i:longint;\nbegin\n   if (a[k].mul=1) and (a[k].plus=0) then exit;\n   if a[k].l=a[k].r then begin a[k].mul:=1;a[k].plus:=0;exit; end;\n   i:=k<<1;\n   a[i].sum:=(a[i].sum*a[k].mul+a[k].plus*(a[i].r-a[i].l+1)) mod p;\n   a[i+1].sum:=(a[i+1].sum*a[k].mul+a[k].plus*(a[i+1].r-a[i+1].l+1)) mod p;\n   a[i].mul:=a[i].mul*a[k].mul mod p;\n   a[i].plus:=(a[i].plus*a[k].mul+a[k].plus) mod p;\n   a[i+1].mul:=a[i+1].mul*a[k].mul mod p;\n   a[i+1].plus:=(a[i+1].plus*a[k].mul+a[k].plus) mod p;\n   a[k].mul:=1;a[k].plus:=0;\nend;\nprocedure changemul(k:longint);   //\u4e58\u6cd5\u4fee\u6539\nvar\n  i,mid:longint;\nbegin\n   pushdown(k);\n   if (x<=a[k].l) and (a[k].r<=y) then\n       begin\n          a[k].sum:=a[k].sum*d mod p;\n          a[k].mul:=d mod p;\n          exit;\n       end;\n   mid:=(a[k].l+a[k].r)>>1;i:=k<<1;\n   if x<=mid then changemul(i);\n   if mid<y then changemul(i+1);\n   a[k].sum:=(a[i].sum+a[i+1].sum) mod p;\nend;\nprocedure changeplus(k:longint);   //\u52a0\u6cd5\u4fee\u6539\nvar\n  i,mid:longint;\nbegin\n   pushdown(k);\n   if (x<=a[k].l) and (a[k].r<=y) then\n       begin\n          a[k].sum:=(a[k].sum+d*(a[k].r-a[k].l+1)) mod p;\n          a[k].plus:=d mod p;\n          exit;\n       end;\n   mid:=(a[k].l+a[k].r)>>1;i:=k<<1;\n   if x<=mid then changeplus(i);\n   if mid<y then changeplus(i+1);\n   a[k].sum:=(a[i].sum+a[i+1].sum) mod p;\nend;\nfunction ask(k:longint):longint;   //\u8be2\u95ee\nvar\n  i,mid:longint;\nbegin\n   pushdown(k);\n   if (x<=a[k].l) and (a[k].r<=y) then exit(a[k].sum);\n   ask:=0;\n   mid:=(a[k].l+a[k].r)>>1;i:=k<<1;\n   if x<=mid then ask:=ask(i);\n   if mid<y then ask:=ask+ask(i+1);\n   exit(ask mod p);\nend;\nbegin\n   //assign(input,'r.in');assign(output,'r.out');reset(input);rewrite(output);\n   readln(n,p);\n   for i:=1 to n do read(num[i]);\n   readln(m);\n   build(1,1,n);\n   //for i:=1 to 10 do writeln(a[i].l,' ',a[i].r,' ',a[i].sum,' ',a[i].mul,' ',a[i].plus);writeln;\n   for i:=1 to m do\n       begin\n          read(t,x,y);\n          if t=1 then begin read(d);changemul(1); end;\n          if t=2 then begin read(d);changeplus(1); end;\n          if t=3 then writeln(ask(1));\n       end;\n   //close(input);close(output);\nend.\n\n```",
        "postTime": 1509885982,
        "uid": 24997,
        "name": "cenbinbin",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "# P2025\n\n\u8fd9\u662f\u4e00\u7bc7\u6307\u9488\u7248\u7ebf\u6bb5\u6811\u9898\u89e3\u3002\n\n\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u7ebf\u6bb5\u6811\u6a21\u677f\uff0c\u8bb0\u5f97\u8981\u7ef4\u62a4\u4e24\u4e2a lazytag \uff0c\u8fd9\u91cc\u6211\u7528 tag_add \u8868\u793a\u52a0\u6cd5\u610f\u4e49\u4e0a\u7684 lazytag \uff0c\u7528 tag_mul \u8868\u793a\u4e58\u6cd5\u610f\u4e49\u4e0a\u7684 lazytag \u3002\n\n\u5bf9\u4e8e tag_add \u5f88\u660e\u663e\u6700\u5f00\u59cb\u7684\u65f6\u5019\u662f 0 \uff0c\u800c\u5bf9\u4e8etag_mul \u6700\u5f00\u59cb\u7684\u65f6\u5019\u662f 1 \u3002\n\n\u5206\u522b\u8ba8\u8bba getdata \u64cd\u4f5c\uff0c pushdown\u64cd\u7eb5\uff0cupdate \u64cd\u4f5c\u4e2d\u7684 lazytag \u7684\u53d8\u5316\u3002\u6211\u4eec\u53d1\u73b0\u5bf9\u4e8e\u533a\u95f4\u4e58\uff0c $tag \\_ mul = tag \\_ mul \\times dv \\_ mul$ \uff0c \u800c\u5bf9\u4e8e\u533a\u95f4\u52a0\u5c31\u8f83\u4e3a\u590d\u6742 $tag \\_ add = tag \\_ add \\times dv \\_ mul + dv \\_ add$ \u3002\n\n\u4e2a\u4eba\u6bd4\u8f83\u63a8\u8350\u6307\u9488\u7248\u7684\u7ebf\u6bb5\u6811\u662f\u56e0\u4e3a\u53ef\u4ee5\u52a8\u6001\u7684 new \u51fa\u8282\u70b9\uff0c\u53ef\u4ee5\u4e0d\u7528\u60f3\u56db\u500d\u5185\u5b58\u7684\u4e8b\u3002\n\n\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef long long ll;\ntypedef unsigned long long ull;\n\nconst int maxn = 1e5 + 5;\n\nint n, m, k;\nint mod;\nint a[maxn];\n\nstruct Node {\n  int l, r;\n  ll tag_add, tag_mul, d;\n  Node *ls, *rs;\n  Node(int l = 0, int r = 0):\n      l(l), r(r), d(0), tag_add(0), tag_mul(1), ls(NULL), rs(NULL) {};\n}; \n\nNode *root;\n\nNode *build(int l, int r) {\n  Node *p = new Node(l, r);\n  if (l == r) {\n    p->d = a[l] % mod;\n    return p;\n  }\n  int mid = (l + r) / 2;\n  p->ls = build(l, mid);\n  p->rs = build(mid + 1, r);\n  p->d = p->ls->d + p->rs->d;\n  p->d %= mod;\n  return p;\n}\n\nll getD(Node *p) {\n  return (p->d * p->tag_mul + p->tag_add * (p->r - p->l + 1)) % mod;\n} \n\nvoid pushdown(Node *p) {\n  if (p->tag_add == 0 && p->tag_mul == 1) return;\n  p->d = getD(p);\n  p->ls->tag_add = p->ls->tag_add * p->tag_mul + p->tag_add;\n  p->ls->tag_add %= mod;\n  p->rs->tag_add = p->rs->tag_add * p->tag_mul + p->tag_add;\n  p->rs->tag_add %= mod;\n  p->ls->tag_mul *= p->tag_mul;\n  p->ls->tag_mul %= mod;\n  p->rs->tag_mul *= p->tag_mul;\n  p->rs->tag_mul %= mod;\n  p->tag_add = 0;\n  p->tag_mul = 1;\n}\n\nvoid update(Node *p, int l, int r, ll dv_add, ll dv_mul) {\n  if (p->l == l && p->r == r) {\n    p->tag_add = p->tag_add * dv_mul + dv_add;\n    p->tag_add %= mod;\n    p->tag_mul *= dv_mul;\n    p->tag_mul %= mod;\n    return;\n  }\n  pushdown(p);\n  if (p->ls->r >= r) {\n    update(p->ls, l, r, dv_add, dv_mul);\n  } else if (p->rs->l <= l) {\n    update(p->rs, l, r, dv_add, dv_mul);\n  } else {\n    update(p->ls, l, p->ls->r, dv_add, dv_mul);\n    update(p->rs, p->rs->l, r, dv_add, dv_mul);\n  }\n  p->d = getD(p->ls) + getD(p->rs);\n  p->d %= mod;\n}\n\nll query(Node *p, int l, int r) {\n  if (p->l == l && p->r == r) {\n    return getD(p);\n  }\n  pushdown(p);\n  if (p->ls->r >= r) {\n    return query(p->ls, l, r);\n  } else if (p->rs->l <= l) {\n    return query(p->rs, l, r);\n  } else {\n    ll ret = 0;\n    ret += query(p->ls, l, p->ls->r);\n    ret += query(p->rs, p->rs->l, r);\n    return ret;\n  }\n}\n\nint main() {\n  scanf(\"%d%d\", &n, &mod);\n  int v;\n  for (int i = 1; i <= n; i++) {\n    scanf(\"%d\", &v);\n    a[i] = v;\n  }\n  root = build(1, n);\n  scanf(\"%d\", &m);\n  int opt, x, y;\n  ll dv;\n  for (int i = 1; i <= m; i++) {\n    scanf(\"%d%d%d\", &opt, &x, &y);\n    switch (opt) {\n      case 1:\n        scanf(\"%lld\", &dv);\n        update(root, x, y, 0, dv);\n        break;\n      case 2:\n        scanf(\"%lld\", &dv);\n        update(root, x, y, dv, 1);\n        break;\n      case 3:\n        ll ret = query(root, x, y) % mod;\n        printf(\"%lld\\n\", ret);\n        break;\n    }\n  }\n  return 0;\n}\n\n\n```\n\n(\u6bcf\u5929\u7ebf\u6bb5\u6811\uff0c\u5065\u5eb7\u53c8\u957f\u5bff)",
        "postTime": 1534242521,
        "uid": 53067,
        "name": "YuntianZhao",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "\u535a\u5ba2\u98df\u7528\u66f4\u4f73\uff1ahttp://www.cinema000.xyz/998.ruby\n## \u80cc\u666f\n\u53ef\u80fd\u662f\u6211\u7684\u5199\u6cd5\u592a$DT$\u4e86\uff0c\u7136\u540e$int64$\u90fd\u6ea2\u51fa\u4e86\uff0c\u6240\u4ee5\u6211\u5c31\u7528\u4e86 __$int128$\uff0c\u5f53\u7136$NOIP$\u4e0d\u80fd\u7528\u8fd9\u73a9\u610f\u3002\n## \u5206\u6790\n\u5c31\u662f\u7ebf\u6bb5\u6811\u533a\u95f4\u4e58\uff0c\u533a\u95f4\u52a0\uff0c\u67e5\u8be2\u533a\u95f4\u548c\n\u5173\u4e8e\u600e\u6837\u4f20\u6807\u8bb0\u4ed6\u4eec\u8bf4\u7684\u5f88\u6e05\u695a\u3002\n\u5176\u5b9e\u6211\u8fd8\u662f\u5f88\u597d\u5947\u4e3a\u5565\u6211int64\u4f1a\u6ea2\u51fa\u3002\n## \u4ee3\u7801\n$int128$\u9700\u8981\u624b\u52a8\u5199\u8f93\u5165\u8f93\u51fa$I/O$\uff0c\u5c31\u662f\u4e00\u4e2a\u5feb\u8bfb\u5feb\u8f93\u5c31\u597d\u4e86\u3002\n```cpp\n#include<cstdio>\n\ntypedef __int128 int128;\nconst int128 MAXN = 1000000 + 6;\nint128 MOD,A[MAXN];\n\ninline int128 read(){\n\tint128 op = 1,ans = 0;char s = getchar();\n\twhile(s < '0' || s > '9'){if(s == '-'){op = -1;}s = getchar();}\n\twhile(s >= '0' && s <= '9'){ans = ans * 10 + s - '0';s = getchar();}\n\treturn ans *= op;\n}\nvoid print(int128 x){\n\tif(x < 0){putchar('-');x = -x;}\n\tif(x > 9){print(x / 10);}\n\tputchar(x % 10 + '0');\n}\nvoid println(int128 x){print(x);putchar('\\n');}\n\nclass SegmentTree{\n\tpublic:int128 l,r;\n\tpublic:int128 sum,add,mul;\n};SegmentTree t[MAXN * 4];\n\ninline int128 L(int128 x){return x << 1;}\ninline int128 R(int128 x){return x << 1 | 1;}\ninline void maintain(int128 p){t[p].sum = (t[L(p)].sum + t[R(p)].sum) % MOD;}\n\nvoid build(int128 p,int128 l,int128 r){\n\tt[p].l = l;t[p].r = r;\n\tt[p].add = 0;t[p].mul = 1;\n\tif(l == r){t[p].sum = A[l];return;}\n\tint128 mid = (l + r) >> 1;\n\tbuild(L(p),l,mid);\n\tbuild(R(p),mid + 1,r);\n\tmaintain(p);\n}\n\ninline void spread(int128 p){\n\tint128 mid = (t[p].l + t[p].r) >> 1;\n\tt[L(p)].sum = (t[L(p)].sum * t[p].mul + t[p].add * (mid - t[p].l + 1)) % MOD;\n\tt[R(p)].sum = (t[R(p)].sum * t[p].mul + t[p].add * (t[p].r - mid)) % MOD;\n\tt[L(p)].mul = (t[L(p)].mul * t[p].mul) % MOD;\n\tt[R(p)].mul = (t[R(p)].mul * t[p].mul) % MOD;\n\tt[L(p)].add = (t[L(p)].add * t[p].mul + t[p].add) % MOD;\n\tt[R(p)].add = (t[R(p)].add * t[p].mul + t[p].add) % MOD;\n\tt[p].mul = 1;t[p].add = 0;\n}\n\nvoid change(int128 p,int128 l,int128 r,int128 d,bool op){\n\tif(op == true){//mul\n\t\tif(l <= t[p].l && r >= t[p].r){\n\t\t\tt[p].add = t[p].add * d;\n\t\t\tt[p].mul = t[p].mul * d;\n\t\t\tt[p].sum = t[p].sum * d;\n\t\t\treturn;\n\t\t}\n\t\tspread(p);\n\t\tint128 mid = (t[p].l + t[p].r) >> 1;\n\t\tif(l <= mid) change(L(p),l,r,d,op);\n\t\tif(r > mid) change(R(p),l,r,d,op);\n\t\tmaintain(p);\n\t}else{\n\t\tif(l <= t[p].l && r >= t[p].r){\n\t\t\tt[p].add = t[p].add + d;\n\t\t\tt[p].sum = (t[p].sum + d * (t[p].r - t[p].l + 1));\n\t\t\treturn;\n\t\t}\n\t\tspread(p);\n\t\tint128 mid = (t[p].l + t[p].r) >> 1;\n\t\tif(l <= mid) change(L(p),l,r,d,op);\n\t\tif(r > mid) change(R(p),l,r,d,op);\n\t\tmaintain(p);\n\t}\n}\n\nint128 ask(int128 p,int128 l,int128 r){\n\tif(l <= t[p].l && r >= t[p].r) return t[p].sum;\n\tspread(p);\n\tint128 ans = 0,mid = (t[p].l + t[p].r) >> 1;\n\tif(l <= mid) ans += ask(L(p),l,r);\n\tif(r > mid) ans += ask(R(p),l,r);\n\treturn ans;\n}\n\nint main(){\n\tint128 n = read();MOD = read();\n\tfor(int128 i = 1;i <= n;i++) A[i] = read();\n\tbuild(1,1,n);\n\tint128 m = read(),op,l,r;int128 d;\n\twhile(m--){\n\t\top = read(),l = read(),r = read();\n\t\tif(op == 1) d = read(),change(1,l,r,d,true);\n\t\telse if(op == 2) d = read(),change(1,l,r,d,false);\n\t\telse println(ask(1,l,r) % MOD);\n\t}\n\t\n\treturn 0;\n}\n```",
        "postTime": 1528595854,
        "uid": 77211,
        "name": "i9_7980XE",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "**\n\u8fd9\u9053\u9898\u5bf9\u4e8e\u53ea\u89c1\u8fc7\u52a0\u6cd5tag\u7684\u4eba\u5f88\u6709\u5e2e\u52a9= =\n\n\u56e0\u4e3atag\u53ef\u4ee5\u6253\u4e24\u4e2a\uff01\uff01\uff01\uff01\uff08\u56db\u5219\u8fd0\u7b97\u597d\u50cf\u53ea\u6709\u4e58\u52a0\u4e24\u79cdtag\uff1f\uff08\u5927\u96fe\uff09\uff09\n\n\u4e00\u5f00\u59cb\u6253\u4e24\u4e2atag\uff0c\u4e00\u4e2a\u4e58\u6cd5tag\uff0c\u4e00\u4e2a\u52a0\u6cd5tag\n\n\u6ce8\u610f\u4e86\u8d4b\u521d\u503c\u7684\u65f6\u5019\u4e58\u6cd5tag\u8981\u8d4b\u62101 = =\n\n\u5bf9\u4e8e\u5b50\u8282\u70b9\u7684tag\uff0c\u4e58\u6cd5tag\u4e58\u4e0a\u7236\u8282\u70b9\u7684\u4e58\u6cd5tag\uff0c\u52a0\u6cd5tag\u4e58\u4e0a\u7236\u8282\u70b9\u4e58\u6cd5tag\u518d\u52a0\u4e0a\u7236\u8282\u70b9\u7684\u52a0\u6cd5tag\u3002\uff08\u5176\u5b9e\u5c31\u76f8\u5f53\u4e8e\u7528\u4e86\u4e00\u4e0b\u4e58\u6cd5\u7ed3\u5408\u5f8b\uff09\n\n\u7136\u540e\u5c31\u662f\u6ce8\u610f\u53d6\u6a21\uff0c\u7528long long\u4e4b\u7c7b\u7684\uff08\u6211\u4e0d\u77e5\u9053int\u4f1a\u4e0d\u4f1a\u7206\u4f46\u662f\u597d\u50cf\u4f1a\uff09\n\n\u5176\u4f59\u7684\u5c31\u662f\u57fa\u7840\u7ebf\u6bb5\u6811\u4e86\n\n**\n```cpp\n\n#include<queue>\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\nconst int maxn=100000+10;\ntypedef long long ll;\nstruct Node{\n    ll sum,l,r,tagj,tagc;\n    Node *lc,*rc;\n    Node(){sum=tagj=0;tagc=1;lc=rc=NULL;}\n}*root=NULL;\n\nll num[maxn],MOD;//1:+ 2:*\nint read()//\u5341\u4e07\u7684\u8bdd\uff0c\u987a\u624b\u4f18\u8bfb\n{\n    ll ret=0;char ch=getchar();\n    while(ch<'0'||ch>'9') ch=getchar();\n    for(;ch>='0'&&ch<='9';ch=getchar())ret=ret*10+ch-'0';\n    return ret;\n}\n\n#define mid (l+(r-l)/2)\nvoid build(Node* &p,int l,int r)\n{\n    p=new Node();\n    p->l=l;\n    p->r=r;\n    if(l==r)\n    {\n        p->sum=num[l]%MOD;return ;\n    }\n    build(p->lc,l,mid);\n    build(p->rc,mid+1,r);\n    p->sum=(p->lc->sum + p->rc->sum)%MOD;\n    return ;\n}\n\nvoid downtag(Node* &p)\n{\n    p->lc->tagc =  p->lc->tagc * p->tagc % MOD;\n    p->lc->tagj = (p->lc->tagj * p->tagc + p->tagj)%MOD;\n    p->lc->sum  = (p->lc->sum  * p->tagc + p->tagj*(p->lc->r - p->lc->l+1))%MOD;\n    p->rc->tagc =  p->rc->tagc * p->tagc % MOD;\n    p->rc->tagj = (p->rc->tagj * p->tagc + p->tagj)%MOD;\n    p->rc->sum  = (p->rc->sum  * p->tagc + p->tagj*(p->rc->r - p->rc->l+1))%MOD;\n    p->tagc=1;p->tagj=0;\n}\n\nvoid updata(Node* &p,const int &L,const int &R,const int &kind,const int &x)//1:+ 2:*\n{\n    int l=p->l,r=p->r;\n    if(L<=l&&r<=R)\n    {\n        if(kind==1) \n        {\n            p->tagj=(p->tagj+x)%MOD;\n            p->sum=(p->sum+x*(r-l+1))%MOD;\n        }\n        else  \n        {\n            p->tagc = p->tagc*x%MOD;\n            p->tagj = p->tagj*x%MOD;\n            p->sum  = p->sum *x%MOD;\n        }\n        return ;\n    }\n    if(p->tagc!=1||p->tagj) downtag(p);\n    if(L<=mid) updata(p->lc,L,R,kind,x);\n    if(R>mid)  updata(p->rc,L,R,kind,x);\n    p->sum = (p->lc->sum + p->rc->sum)%MOD;\n    return ; \n}\n\nll Query(Node* &p,const int &L,const int &R)\n{\n    int l=p->l,r=p->r;\n    if(L<=l&&r<=R) return p->sum;\n    if(p->tagc!=1||p->tagj) downtag(p);\n    ll ret=0;\n    if(L<=mid) ret += Query(p->lc,L,R);\n    if(mid<R)  ret += Query(p->rc,L,R);\n    return ret%MOD;\n}\n\nint main()\n{\n    int n;cin>>n>>MOD;\n    for(int i=1;i<=n;i++) scanf(\"%lld\",num+i);\n    build(root,1,n);\n    int Q,ins,l,r,c;cin>>Q;\n    while(Q--)\n    {\n        ins=read();\n        if(ins==1)\n        {\n            l=read();r=read();c=read();\n            updata(root,l,r,2,c);\n        }\n        else if(ins==2)\n        {\n            l=read();r=read();c=read();\n            updata(root,l,r,1,c);\n        }\n        else\n        {\n            l=read();r=read();\n            printf(\"%lld\\n\",Query(root,l,r));\n        }\n    }\n    return 0;\n}\n\n\n```",
        "postTime": 1456292484,
        "uid": 11280,
        "name": "QWsin",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "## \u8fd9\u4e0d\u5c31\u662f\u7ebf\u6bb5\u6811\u5417\n\n## \u5047\u5982\u4f60\u4e0d\u77e5\u9053\u7ebf\u6bb5\u6811\n\n### \u5b9a\u4e49\n\n\u7ebf\u6bb5\u6811\u662f\u4e00\u79cd\u4e8c\u53c9\u641c\u7d22\u6811\uff0c\u4e0e\u533a\u95f4\u6811\u76f8\u4f3c\uff0c\u5b83\u5c06\u4e00\u4e2a\u533a\u95f4\u5212\u5206\u6210\u4e00\u4e9b\u5355\u5143\u533a\u95f4\uff0c\u6bcf\u4e2a\u5355\u5143\u533a\u95f4\u5bf9\u5e94\u7ebf\u6bb5\u6811\u4e2d\u7684\u4e00\u4e2a\u53f6\u7ed3\u70b9\u3002\n\n\u5bf9\u4e8e\u7ebf\u6bb5\u6811\u4e2d\u7684\u6bcf\u4e00\u4e2a\u975e\u53f6\u5b50\u8282\u70b9[a,b]\uff0c\u5b83\u7684\u5de6\u513f\u5b50\u8868\u793a\u7684\u533a\u95f4\u4e3a[a,(a+b)/2]\uff0c\u53f3\u513f\u5b50\u8868\u793a\u7684\u533a\u95f4\u4e3a[(a+b)/2+1,b]\u3002\u56e0\u6b64\u7ebf\u6bb5\u6811\u662f\u5e73\u8861\u4e8c\u53c9\u6811\uff0c\u6700\u540e\u7684\u5b50\u8282\u70b9\u6570\u76ee\u4e3aN\uff0c\u5373\u6574\u4e2a\u7ebf\u6bb5\u533a\u95f4\u7684\u957f\u5ea6\u3002\n\n\u4f7f\u7528\u7ebf\u6bb5\u6811\u53ef\u4ee5\u5feb\u901f\u7684\u67e5\u627e\u67d0\u4e00\u4e2a\u8282\u70b9\u5728\u82e5\u5e72\u6761\u7ebf\u6bb5\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3aO(logN\uff09\u3002\u800c\u672a\u4f18\u5316\u7684\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a2N\uff0c\u56e0\u6b64\u6709\u65f6\u9700\u8981\u79bb\u6563\u5316\u8ba9\u7a7a\u95f4\u538b\u7f29\u3002\n\n### \u57fa\u672c\u7ed3\u6784\n\n\u7ebf\u6bb5\u6811\u662f\u5efa\u7acb\u5728\u7ebf\u6bb5\u7684\u57fa\u7840\u4e0a\uff0c\u6bcf\u4e2a\u7ed3\u70b9\u90fd\u4ee3\u8868\u4e86\u4e00\u6761\u7ebf\u6bb5[a,b]\u3002\u957f\u5ea6\u4e3a1\u7684\u7ebf\u6bb5\u79f0\u4e3a\u5143\u7ebf\u6bb5\u3002\u975e\u5143\u7ebf\u6bb5\u90fd\u6709\u4e24\u4e2a\u5b50\u7ed3\u70b9\uff0c\u5de6\u7ed3\u70b9\u4ee3\u8868\u7684\u7ebf\u6bb5\u4e3a[a,(a + b) / 2]\uff0c\u53f3\u7ed3\u70b9\u4ee3\u8868\u7684\u7ebf\u6bb5\u4e3a[((a + b) / 2\uff09+1,b]\u3002\n\n\u4e0b\u56fe\u5c31\u662f\u4e00\u68f5\u7ebf\u6bb5\u6811\u3002\n\n![](data:image/jpeg;base64,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IONpwMY7mtjT/Bc+rWEV7YfEXxLcW0y7o5BcLtYdMj5a6HxrfT2mifYrBtuoalItnbeoZ/vN/wABXc34VuabYQaXYW9jbJtgt4ljQegAAFAHD/Dw6jDr/ivSb3VrzUo9PuoY4ZbuTcwBTcfbvXodcF4I/wCR98ff9f1v/wCiq72gAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA5rxR4MtPFkdkLq9vrSSzlMsM1jKI5FbGM7sE1jD4Wpjnxr4zz7asf/AImu+ooA4H/hVsf/AEOvjP8A8G5/+Jo/4VbH/wBDr4z/APBuf/ia76igDlfDPgSz8MardanHqmrahd3MSwySahciY7QcgA7Qf1qbxv4Ym8WeHW0y3vEtJDNHMszR7wpRg3TI9K6SigDgR4c+Iw6eOrIf9whP8aP+Ed+I5/5nux/8E6f4131FAHAf8I58Rv8AoebH/wAE6f40v/COfEbv47ssen9kJ/jXfUUAcp4K8K6h4bfVp9T1SPULvUrkXEkkcHlAELjpk11dFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFcD41/5KJ4A9rq6/8ARNd9XM+KfBth4smsXvLm/tpLJmeGWzm8tgWAB5wewoA6C5tory3eCeNJIZFKujjIYHgg1gaf4I0rTJHlt/tLTmJoYpZrl5WgQ9o95Owew9BWP/wqmw/6GbxV/wCDVv8ACj/hVNh/0M3ir/wat/hQBt3Hg3TbrS7Gxk89RYoEt54p2jmQAYPzqQeR19a0tJ0ez0SxSzsYRHEpJPJZnY9WYnkk9STXJf8ACqbD/oZvFX/g1b/Cj/hVNh/0M3ir/wAGrf4UAHxF/wCQ54H9tcQ/+ONXReMv+RG8Qf8AYNuP/RTVz9v8LdLtdUsb9tX127ls5hNCt5fGVA46HBFdZrWnnVtA1DTRL5X2u2kg8zbu271K5x3xnpQBheEbCLUvhboVnPu8mfSIYn2MVO1ogDgjkda2LvQbW60BtFUvb2hhEAEJ2lUGAAD9BiuM07wR460zTbbT7P4hpFa2sSwwodEibaijAGS2TwKtf8It8Q/+ikR/+CKH/wCKoA6ubRLS41Kyv5ELT2QcW5LHCbwATjpnAxntk+taVcF/wi3xD/6KRH/4Iof/AIqj/hFviH/0UiP/AMEUP/xVAB4I/wCR98ff9f1v/wCiq72uR8HeEtQ8N3mr3mpa0NVvNTlSWWYWogwVXb90Ejpj0rrqACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/Z)\n\n\u957f\u5ea6\u8303\u56f4\u4e3a[1,L] \u7684\u4e00\u68f5\u7ebf\u6bb5\u6811\u7684\u6df1\u5ea6\u4e3alog (L) + 1\u3002\u8fd9\u4e2a\u663e\u7136\uff0c\u800c\u4e14\u5b58\u50a8\u4e00\u68f5\u7ebf\u6bb5\u6811\u7684\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3aO(L\uff09\u3002\n\n\u7ebf\u6bb5\u6811\u652f\u6301\u6700\u57fa\u672c\u7684\u64cd\u4f5c\u4e3a\u63d2\u5165\u548c\u5220\u9664\u4e00\u6761\u7ebf\u6bb5\u3002\u4e0b\u9762\u4ee5\u63d2\u5165\u4e3a\u4f8b\uff0c\u8be6\u7ec6\u53d9\u8ff0\uff0c\u5220\u9664\u7c7b\u4f3c\u3002\n\n\u5c06\u4e00\u6761\u7ebf\u6bb5[a,b] \u63d2\u5165\u5230\u4ee3\u8868\u7ebf\u6bb5[l,r]\u7684\u7ed3\u70b9p\u4e2d\uff0c\u5982\u679cp\u4e0d\u662f\u5143\u7ebf\u6bb5\uff0c\u90a3\u4e48\u4ee4mid=\uff08l+r\uff09/2\u3002\u5982\u679cb<mid\uff0c\u90a3\u4e48\u5c06\u7ebf\u6bb5[a,b] \u4e5f\u63d2\u5165\u5230p\u7684\u5de6\u513f\u5b50\u7ed3\u70b9\u4e2d\uff0c\u5982\u679ca>mid\uff0c\u90a3\u4e48\u5c06\u7ebf\u6bb5[a,b] \u4e5f\u63d2\u5165\u5230p\u7684\u53f3\u513f\u5b50\u7ed3\u70b9\u4e2d\u3002\n\n\u63d2\u5165\uff08\u5220\u9664\uff09\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3aO\uff08logn\uff09\u3002\n\n## \u56de\u5f52\u672c\u9898\n\n\u52a0\u6cd5\u4e0d\u7528\u8bf4\uff0c\u4e58\u6cd5\u7684\u65f6\u5019\u5230\u52a0\u6cd5\u7684\u5730\u65b9\u4e5f\u8981\u7ffb\u500d\n\n[\u7ebf\u6bb5\u68112](https://www.luogu.com.cn/problem/P3373)\u539f\u9898\u554a\n\n\u628a\u8f93\u5165m\u7684\u4f4d\u7f6e\u6362\u4e00\u4e0b\u5c31\u597d\u4e86\n\n## \u4ee3\u7801\u5982\u4e0b\n\n```\n#include<bits/stdc++.h>\n#define ls o<<1\n#define rs o<<1|1\nusing namespace std;\nstruct tree{\n\tlong long l,r,sum,tim,plu;\n}tr[400005];\nlong long n,m,p,o,x,y,k,v[100005];\nvoid build(long long o,long long l,long long r){\n\ttr[o].l=l,tr[o].r=r,tr[o].tim=1;\n\tif(l==r){\n\t\ttr[o].sum=v[l]%p;\n\t\treturn;\n\t}\n\tlong long mid=(l+r)>>1;\n\tbuild(ls,l,mid);\n\tbuild(rs,mid+1,r);\n\ttr[o].sum=(tr[ls].sum+tr[rs].sum)%p;\n}\nvoid up(long long o){\n\ttr[ls].sum=(tr[o].tim*tr[ls].sum+(tr[ls].r-tr[ls].l+1)*tr[o].plu%p)%p;\n\ttr[rs].sum=(tr[o].tim*tr[rs].sum+(tr[rs].r-tr[rs].l+1)*tr[o].plu%p)%p;\n\ttr[ls].tim=tr[ls].tim*tr[o].tim%p;\n\ttr[rs].tim=tr[rs].tim*tr[o].tim%p;\n\ttr[ls].plu=(tr[ls].plu*tr[o].tim+tr[o].plu)%p;\n\ttr[rs].plu=(tr[rs].plu*tr[o].tim+tr[o].plu)%p;\n\ttr[o].plu=0,tr[o].tim=1;\n}\nvoid time(long long o,long long l,long long r,long long k){\n\tif(tr[o].l>=l&&tr[o].r<=r){\n\t\ttr[o].plu=tr[o].plu*k%p;\n\t\ttr[o].tim=tr[o].tim*k%p;\n\t\ttr[o].sum=tr[o].sum*k%p;\n\t\treturn;\n\t}\n\tup(o);\n\ttr[o].sum=(tr[ls].sum+tr[rs].sum)%p;\n\tlong long mid=(tr[o].l+tr[o].r)>>1;\n\tif(l<=mid)time(ls,l,r,k);\n\tif(mid<r)time(rs,l,r,k);\n\ttr[o].sum=(tr[ls].sum+tr[rs].sum)%p;\n}\nvoid add(long long o,long long l,long long r,long long k){\n\tif(tr[o].l>=l&&tr[o].r<=r){\n\t\ttr[o].plu=(tr[o].plu+k)%p;\n\t\ttr[o].sum=(tr[o].sum+k*(tr[o].r-tr[o].l+1))%p;\n\t\treturn;\n\t}\n\tup(o);\n\ttr[o].sum=(tr[ls].sum+tr[rs].sum)%p;\n\tlong long mid=(tr[o].l+tr[o].r)>>1;\n\tif(l<=mid)add(ls,l,r,k);\n\tif(mid<r)add(rs,l,r,k);\n\ttr[o].sum=(tr[ls].sum+tr[rs].sum)%p;\n}\nlong long ask(long long o,long long l,long long r){\n\tif(tr[o].l>=l&&tr[o].r<=r)return tr[o].sum;\n\tup(o);\n\tlong long ans=0,mid=(tr[o].l+tr[o].r)>>1;\n\tif(l<=mid)ans=(ans+ask(ls,l,r))%p;\n\tif(mid<r)ans=(ans+ask(rs,l,r))%p;\n\treturn ans;\n}\nint main(){\n\tscanf(\"%lld%lld\",&n,&p);\n\tfor(long long i=1;i<=n;i++)scanf(\"%lld\",&v[i]);\n\tbuild(1,1,n);\n    scanf(\"%lld\",&m);\n\tfor(long long i=1;i<=m;i++){\n\t\tscanf(\"%lld%lld%lld\",&o,&x,&y);\n\t\tif(o==1){\n\t\t\tscanf(\"%lld\",&k);\n\t\t\ttime(1,x,y,k);\n\t\t}\n\t\tif(o==2){\n\t\t\tscanf(\"%lld\",&k);\n\t\t\tadd(1,x,y,k);\n\t\t}\n\t\tif(o==3)printf(\"%lld\\n\",ask(1,x,y));\n\t}\n}\n```\n**~~\u6211\u592a\u61d2\u628a\u5168\u90e8int\u6539long long\u4e86~~**",
        "postTime": 1576848773,
        "uid": 242967,
        "name": "JasonZRY",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "[\u5230\u6211\u7684\u535a\u5ba2\u67e5\u770b](https://www.cnblogs.com/Hdgs3-blog/p/10336702.html)\n\n[**\u9898\u9762**](https://www.luogu.org/problemnew/show/P2023)\n\n**\u4e00\u5b9a\u8981\u591a\u53d6\u819c\uff01\u4e0d\u7136\u4e00\u76f4\u536160\u5206\uff01**\n\n\u5728\u533a\u95f4\u4e2d\u8fdb\u884c\u66f4\u65b0\u4e8e\u67e5\u8be2\uff0c\u5f88\u597d\u60f3\u5230\u7528\u7ebf\u6bb5\u6811\n\n\u4e3a\u4e86\u589e\u52a0\u901f\u5ea6\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u5230lazy\u6807\u8bb0\uff0c\u4e0d\u8fc7\u8fd9\u9898\u6709\u4e58\u6cd5\uff0c\u6211\u4eec\u9700\u8981\u4fee\u6539\u4e00\u4e0b\n\n### \u5b9a\u4e49\u7ed3\u6784\u4f53\uff1a\n\n```cpp\nstruct SegmentTree\n{\n\tlong long l,r;\n\tlong long sum;\n\tlong long addmark=0,mulmark=1;//\u52a0\u6cd5\u7684\u6807\u8bb0\u548c\u4e58\u6cd5\u7684\u6807\u8bb0\n}t[400010];//\u56db\u500d\u5f00\u70b9\n```\n\n### \u4e58\u6cd5\u66f4\u65b0\uff1a\n```cpp\nif(x<=l&&y>=r)\n\t{\n\t\tt[id].sum=v%p*t[id].sum%p;\n\t\tt[id].mulmark=t[id].mulmark*v%p;//\u4e58\u6807\u8981\u4e58\u4e0a\u53bb\n\t\tt[id].addmark=t[id].addmark*v%p;//\u52a0\u6807\u4e5f\u8981\u4e58\uff08\u60f3\u4e00\u60f3\u4e3a\u4ec0\u4e48\uff1f\uff09\n\t\treturn;\n\t}\n```\n\n### \u52a0\u6cd5\u66f4\u65b0\n```cpp\n\tif(x<=l&&y>=r)\n\t{\n\t\tt[id].sum=(t[id].sum+v%p*(r-l+1)%p)%p;//\u8fd9\u4e2a\u4e0d\u7528\u89e3\u91ca\u5427\n\t\tt[id].addmark=(t[id].addmark+v%p)%p;\n\t\treturn;\n\t}\n```\n\n### \u4e0b\u4f20\u6807\u8bb0\n```cpp\nvoid PushDown(long long id)\n{\n\tt[id*2].mulmark=t[id].mulmark%p*t[id*2].mulmark%p;//\u4e58\u6807\u662f\u4e58\u4e0a\u53bb\u7684\n\tt[id*2+1].mulmark=t[id].mulmark%p*t[id*2+1].mulmark%p;\n\n\tt[id*2].addmark=(t[id*2].addmark%p*t[id].mulmark%p+t[id].addmark)%p;//\u52a0\u6807\u8981\u4e58\u4e0a\u4e0b\u4f20\u4e0b\u6765\u7684\u4e58\u6807\n\tt[id*2+1].addmark=(t[id*2+1].addmark%p*t[id].mulmark%p+t[id].addmark)%p;\n\n\tt[id*2].sum=(t[id].mulmark%p*t[id*2].sum%p+t[id].addmark*(t[id*2].r-t[id*2].l+1)%p)%p;//\u5148\u4e58\u540e\u52a0\n\tt[id*2+1].sum=(t[id].mulmark%p*t[id*2+1].sum%p+t[id].addmark*(t[id*2+1].r-t[id*2+1].l+1)%p)%p;\n\n\tt[id].addmark=0;//\u8bb0\u5f97\u6e050\n\tt[id].mulmark=1;\n}\n```\n\n## \u8d34\u5b8c\u6574\u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n\n#define lson id*2,l,mid\n#define rson id*2+1,mid+1,r\n\nusing namespace std;\n\nlong long n,m,p;\n\nstruct SegmentTree\n{\n\tlong long l,r;\n\tlong long sum;\n\tlong long addmark=0,mulmark=1;\n}t[400010];\n\nvoid BuildTree(long long,long long,long long);\n\nvoid Update1(long long,long long,long long,long long,long long,long long);\n\nvoid Update2(long long,long long,long long,long long,long long,long long);\n\nlong long Query(long long,long long,long long,long long,long long);\n\nvoid PushDown(long long);\n\nint main()\n{\n\tscanf(\"%lld%lld\",&n,&p);\n\tBuildTree(1,1,n);\n\tscanf(\"%lld\",&m);\n\tfor(long long i=1;i<=m;i++)\n\t{\n\t\tlong long k;\n\t\tscanf(\"%lld\",&k);\n\t\tif(k==1)\n\t\t{\n\t\t\tlong long x,y,o;\n\t\t\tscanf(\"%lld%lld%lld\",&x,&y,&o);\n\t\t\tUpdate1(1,1,n,x,y,o);\n\t\t}\n\t\tif(k==2)\n\t\t{\n\t\t\tlong long x,y,o;\n\t\t\tscanf(\"%lld%lld%lld\",&x,&y,&o);\n\t\t\tUpdate2(1,1,n,x,y,o);\n\t\t}\n\t\tif(k==3)\n\t\t{\n\t\t\tlong long x,y;\n\t\t\tscanf(\"%lld%lld\",&x,&y);\n\t\t\tprintf(\"%lld\\n\",Query(1,1,n,x,y)%p);\n\t\t}\n\t}\nreturn 0;\n}\n\nvoid BuildTree(long long id,long long l,long long r)\n{\n\tt[id].l=l;\n\tt[id].r=r;\n\tif(l==r)\n\t{\n\t\tscanf(\"%lld\",&t[id].sum);\n\t\treturn;\n\t}\n\tlong long mid=(l+r)>>1;\n\tBuildTree(lson);\n\tBuildTree(rson);\n\tt[id].sum=(t[id*2].sum+t[id*2+1].sum)%p;\n}\n\nvoid Update1(long long id,long long l,long long r,long long x,long long y,long long v)\n{\n\tlong long mid=(l+r)>>1;\n\tif(x<=l&&y>=r)\n\t{\n\t\tt[id].sum=v%p*t[id].sum%p;\n\t\tt[id].mulmark=t[id].mulmark*v%p;\n\t\tt[id].addmark=t[id].addmark*v%p;\n\t\treturn;\n\t}\n\tPushDown(id);\n\tif(x<=mid)Update1(id*2,l,mid,x,y,v);\n\tif(y>mid)Update1(id*2+1,mid+1,r,x,y,v);\n\tt[id].sum=(t[id*2].sum+t[id*2+1].sum)%p;\n}\n\nvoid Update2(long long id,long long l,long long r,long long x,long long y,long long v)\n{\n\tlong long mid=(l+r)>>1;\n\tif(x<=l&&y>=r)\n\t{\n\t\tt[id].sum=(t[id].sum+v%p*(r-l+1)%p)%p;\n\t\tt[id].addmark=(t[id].addmark+v%p)%p;\n\t\treturn;\n\t}\n\tPushDown(id);\n\tif(x<=mid)Update2(id*2,l,mid,x,y,v);\n\tif(y>mid)Update2(id*2+1,mid+1,r,x,y,v);\n\tt[id].sum=(t[id*2].sum+t[id*2+1].sum)%p;\n}\n\nlong long Query(long long id,long long l,long long r,long long x,long long y)\n{\n    long long mid=(l+r)>>1;\n    long long sum=0;\n    if(x<=l&&y>=r)return t[id].sum;\n    PushDown(id);\n    if(x<=mid)sum=(sum+Query(id*2,l,mid,x,y))%p;\n    if(y>mid)sum=(sum+Query(id*2+1,mid+1,r,x,y))%p;\n    return sum;\n}\n\nvoid PushDown(long long id)\n{\n\tt[id*2].mulmark=t[id].mulmark%p*t[id*2].mulmark%p;\n\tt[id*2+1].mulmark=t[id].mulmark%p*t[id*2+1].mulmark%p;\n\n\tt[id*2].addmark=(t[id*2].addmark%p*t[id].mulmark%p+t[id].addmark)%p;\n\tt[id*2+1].addmark=(t[id*2+1].addmark%p*t[id].mulmark%p+t[id].addmark)%p;\n\n\tt[id*2].sum=(t[id].mulmark%p*t[id*2].sum%p+t[id].addmark*(t[id*2].r-t[id*2].l+1)%p)%p;\n\tt[id*2+1].sum=(t[id].mulmark%p*t[id*2+1].sum%p+t[id].addmark*(t[id*2+1].r-t[id*2+1].l+1)%p)%p;\n\n\tt[id].addmark=0;\n\tt[id].mulmark=1;\n}\n```",
        "postTime": 1548811125,
        "uid": 54986,
        "name": "lemir3",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": " \u7ebf\u6bb5\u6811\u6a21\u7248\u9898\n------------\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u533a\u95f4\u7ef4\u62a4sum, add, mul\u4e09\u4e2a\u503c\n\n\u4ee3\u8868\u8fd9\u4e2a\u533a\u95f4\u4e2d\u6bcf\u4e2a\u5143\u7d20\u90fd\u8981\u5148\u4e58mul\u518d\u52a0add\n\n\u8fd9\u4e2a\u533a\u95f4\u5bf9\u5e94\u7684\u5b9e\u9645\u503c\u4e3a mul*sum+add\n\n\n------------\n\n\n\u4e0b\u63a8\u6807\u8bb0\u65f6:\n\n\uff08\u5b50\u8282\u70b9\u7684\u503c\u5206\u522b\u8bb0\u4e3asum1, add1, mul1\uff09\n\n\tadd1 = add1*mul + add\n    mul1 = mul1*mul\n    \n\n------------\n\n\u5bf9mul\u548cadd\u7684\u66f4\u65b0\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u51fd\u6570\u5b9e\u73b0\uff0c\u8be6\u89c1\u4ee3\u7801\n\n------------\n\n\u6700\u540e\u6ce8\u610f\u5bf9add, mul, sum\u7b49\u53d6\u6a21\n\n\u4f9d\u636e\u4e0b\u8ff0\u5b9a\u7406\uff1a\n\n\t(a+b)%x = (a%x + b%x)%x\n\n\t(a*b)%x = ((a%x)*(b%x))%x\n    \n\n------------\n\u4ee3\u7801\u5730\u5740\n\nhttps://paste.ubuntu.com/p/Yp7CJCH5DQ/\n",
        "postTime": 1539862192,
        "uid": 141275,
        "name": "fdvty",
        "ccfLevel": 0,
        "title": "\u7ebf\u6bb5\u6811\u6a21\u7248\u9898\uff0c\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "\u8fd9\u9898\u5176\u5b9e\u5c31\u662fP3373\u3010\u6a21\u677f\u3011\u7ebf\u6bb5\u68112\uff0c\u53ea\u8981\u6539\u52a8\u8f93\u5165\u5c31\u80fd\u8fc7\u3002\n**\u601d\u8def\uff08\u9898\u610f\uff09**\uff1a\u7528\u7ebf\u6bb5\u6811\u5904\u7406\uff0c\u4e58\uff0c\u52a0\u548c\u4e00\u6bb5\u533a\u95f4\u7684\u6570\u7684\u548c\n\n```cpp\n#include<cstdio>\n#include<cstring>\n\nstruct nod{int l,r,ll,rr;long long c,k,ce;}a[400010];\n//l\uff0cr\u8868\u793a\u7684\u662fa[i]\u7684\u5de6\u53f3\u8fb9\u754c\uff08\u7b2cl\u5230r\u4e4b\u95f4\u7684\u6570\uff09\n//ll\u662fa[i]\u7684\u5de6\u513f\u5b50\uff0crr\u662fa[i]\u7684\u53f3\u513f\u5b50\n//c\u4e3al\u5230r\u4e4b\u95f4\u7684\u6570\u7684\u548c\uff0ck\u662f\u5b58\u8981\u52a0\u7684\u6570\uff0cce\u662f\u5b58\u8981\u4e58\u7684\u6570 \n\nint len,p;long long f[200010];\n//len\u4e3a\u7b2c\u51e0\u4e2a\u70b9\uff0cf[i]\u4e3a\u8f93\u5165\u7684\u7b2ci\u4e2a\u6570 \n\nvoid bt(int l,int r)//\u5efa\u6811 \n{\n\tlen++;int now=len;//now\u662f\u5f53\u524d\u70b9\uff0clen\u4f1a\u6539\u53d8 \n\ta[len].l=l;a[len].r=r;\n    a[len].ll=a[len].rr=a[len].k=a[len].c=0;\n    a[now].ce=1;\n\t//\u521d\u59cb\u5316 \n\tif(l<r)\n\t{\n\t\tint mid=(l+r)/2;\n\t\ta[now].ll=len+1;bt(l,mid);\n        //len+1\u4e3all\uff0crr\u56e0\u4e3abt\u4f1a\u5f80\u4e0b\u52a0 \n\t\ta[now].rr=len+1;bt(mid+1,r);\n\t\ta[now].c=a[a[now].ll].c+a[a[now].rr].c;\n        //c\u5b58\u5de6\u53f3\u513f\u5b50\u548c \n\t}\n\telse a[len].c=f[l]%p;\n}\n\nvoid up(int now)\n//\u7ef4\u62a4ce\u548ck\uff08\u4e58\u548c\u52a0\u3002\u4e58\u4f18\u5148\uff0c\u5426\u5219\u4f1a\u51fa\u9519\uff0c\u7b54\u6848\u4f1a\u591a\uff09 \n{\n    int l=a[now].l,r=a[now].r,ll=a[now].ll,rr=a[now].rr,m=(l+r)/2;\n//////////////////////////////////////\u5148\u5f80\u4e0b\u4e58\u548c\u52a0 \n    a[ll].c=(a[ll].c*a[now].ce+a[now].k*(m-l+1))%p;\n    a[rr].c=(a[rr].c*a[now].ce+a[now].k*(r-m))%p;\n///////////////////////////////// \u7ef4\u62a4\u5de6\u53f3\u513f\u5b50\u7684ce \n    a[ll].ce=(a[ll].ce*a[now].ce)%p;\n    a[rr].ce=(a[rr].ce*a[now].ce)%p;\n////////////////////////////////// \u7ef4\u62a4\u5de6\u53f3\u513f\u5b50\u7684k\n    a[ll].k=(a[ll].k*a[now].ce+a[now].k)%p;\n    a[rr].k=(a[rr].k*a[now].ce+a[now].k)%p;\n///////////////////////\u628ace\u548ck\u521d\u59cb\u5316\uff08ce\u4e3a\u521d\u59cb\u4e3a1\uff09 \n    a[now].ce=1;\n    a[now].k=0;\n    return ;\n}\n\nvoid change(int now,int l,int r,long long k)//\u52a0 \n{\n\tif(a[now].l==l&&a[now].r==r)\n\t{\n\t\ta[now].c=(a[now].c+k*(r-l+1))%p;\n\t\ta[now].k=(a[now].k+k)%p;\n\t\treturn;\n\t}\n\tint ll=a[now].ll,rr=a[now].rr,mid=(a[now].l+a[now].r)/2;\n\tup(now);\n\tif(r<=mid) change(ll,l,r,k);\n\telse if(l>mid) change(rr,l,r,k);\n\telse{change(ll,l,mid,k); change(rr,mid+1,r,k);}\n\ta[now].c=(a[ll].c+a[rr].c)%p;//\u5237\u65b0c \n}\n\nvoid cc(int now,int l,int r,long long k)//\u4e58 \n{\n\tif(a[now].l==l&&a[now].r==r)\n\t{\n\t\ta[now].c=a[now].c*k%p;\n\t\ta[now].ce=(a[now].ce*k)%p;\n\t\ta[now].k=(a[now].k*k)%p;//\u4e5f\u8981\u4e58k\uff0c\u5426\u5219k\u4f1a\u53d8\u5c11 \n\t\treturn;\n\t}\n\tint ll=a[now].ll,rr=a[now].rr,mid=(a[now].l+a[now].r)/2;\n\tup(now);\n\tif(r<=mid) cc(ll,l,r,k);\n\telse if(l>mid) cc(rr,l,r,k);\n\telse{cc(ll,l,mid,k); cc(rr,mid+1,r,k);}\n\ta[now].c=(a[ll].c+a[rr].c)%p;//\u5237\u65b0c \n}\n\nlong long findsum(int now,int l,int r)//\u627e\u548c \n{\n\tif(a[now].l==l&&a[now].r==r) return a[now].c%p;\n\tint ll=a[now].ll,rr=a[now].rr,mid=(a[now].l+a[now].r)/2;\n\tup(now);\n\tif(r<=mid) return findsum(ll,l,r)%p;\n\telse if(l>mid) return findsum(rr,l,r)%p;\n\telse return (findsum(ll,l,mid)+findsum(rr,mid+1,r))%p;\n}\n\nint main()\n{\n\tint n,m;scanf(\"%d %d\",&n,&p);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&f[i]);\n\tlen=0;bt(1,n);scanf(\"%d\",&m);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint v;scanf(\"%d\",&v);\n\t\tif(v==2)\n\t\t{\n\t\t\tint x,y;long long c;scanf(\"%d %d %lld\",&x,&y,&c);\n\t\t\tchange(1,x,y,c);\n\t\t}\n\t\telse if(v==1)\n\t\t{\n\t\t\tint x,y;long long c;scanf(\"%d %d %lld\",&x,&y,&c);\n\t\t\tcc(1,x,y,c);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tint x,y;scanf(\"%d %d\",&x,&y);\n\t\t\tprintf(\"%lld\\n\",findsum(1,x,y)%p);\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1523512795,
        "uid": 35290,
        "name": "royzhu",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    },
    {
        "content": "\u5176\u5b9e\u5c31\u662f\u7ebf\u6bb5\u6811\u7684\u6a21\u7248\u9898\uff0c\u7136\u540e\u52a0\u4e86\u51e0\u4e2a\u81ea\u5df1\u7684\u5c0f\u4f18\u5316\n\n```cpp\n\n#define FIRST\n#ifdef FIRST\n\n#include <iostream>\n#include <algorithm>\n#include <cstdio>\n\ntypedef long long LL;\n//\u522b\u540d \u8282\u7701\u7801\u91cf\nconst LL N = 8e5 + 5;\n//\u4f7f\u7528\u5e38\u91cf\n\nLL read(void);\n//\u5feb\u8bfb\u51fd\u6570\nLL n, m;\n\nclass SegmentTree{\n  private:\n    LL a[N], sum[N], add[N], mul[N];\n    LL p;\n  public:\n    SegmentTree(void) {}\n    void get_p(void);\n    void input(LL);\n    void pushup(LL);\n    void pushdown(LL, LL, LL);\n    void build(LL, LL, LL);\n    void update1(LL, LL, LL, LL, LL, LL);\n    void update2(LL, LL, LL, LL, LL, LL);\n    LL query(LL, LL, LL, LL, LL);\n};\n//\u58f0\u660e\u7ebf\u6bb5\u6811\u7c7b\n\nSegmentTree st;\n//\u5bf9\u8c61\n\n#define DEBUG for ( LL i = 1; i <= n; ++ i ){\\\n\t\t\t\t\t\tstd::cout << st.query( i, i, 1, n, 1 ) << ' ';\\\n\t\t\t\t}\\\n\t\t\t\tstd::cout << std::endl\n\u65b9\u4fbf\u8c03\u8bd5\n\nint main(void) {\n  n = read(); \n  st.get_p();\n  st.input(n);\n  m = read();\n  st.build(1, n, 1);\n  //\u5efa\u6811\n  while (m--) {\n    LL opt = read();\n    //\u4ee5\u4e0b\u5229\u7528\u4f4d\u8fd0\u7b97\u6765\u538b\u65f6\u95f4\uff0c\u6709\u5bf9\u5e94\u7684\u8bf4\u660e\n    if (opt & 1) //opt == 1 or 3\n      if ((opt >> 1) & 1) {//opt == 3\n        LL l, r;\n        l = read(); r = read();\n        std::printf(\"%lld\\n\", st.query(l, r, 1, n, 1));\n        //\u7528printf\u6bd4\u8f83\u5feb\n      }\n      else {//opt == 1\n        LL l, r; LL c;\n        l = read(); r = read(); c = read();\n        st.update1(l, r, c, 1, n, 1);\n      }\n    else {//opt == 2\n      LL l, r; LL c;\n      l = read(); r = read(); c = read();\n      st.update2(l, r, c, 1, n, 1);\n    }\n    //DEBUG;\n  }\n  return 0;\n}\n\ninline LL read(void) {\n  register LL ret = 0, c = std::getchar();\n  while (!std::isdigit(c)) c = std::getchar();\n  while (std::isdigit(c))  ret = ret * 10 + c - '0', c = std::getchar();\n  return ret;\n}\n//\u5feb\u8bfb\u51fd\u6570\n\n//SegmentTree\n\n//\u4f4d\u8fd0\u7b97\u4f18\u5316\n#define lson rt<<1\n//\u5de6\u513f\u5b50\n#define rson rt<<1|1\n//\u53f3\u513f\u5b50\n#define ltree l,mid,lson\n//\u4e8c\u5206\u4e4b\u540e\u7684\u5de6\u5b50\u6811\n#define rtree mid+1,r,rson\n//\u4e8c\u5206\u4e4b\u540e\u7684\u53f3\u5b50\u6811\n#define mod(x) (x)%p\n//\u53d6\u6a21\u8fd0\u7b97\u6539\u6210\u5b8f\u5b9a\u4e49\uff0c\u6211\u89c9\u5f97\u6bd4\u8f83\u597d\u5199\n\n//\u6ce8\u610f \u4ee5\u4e0b\u7684l,r\u6307\u5f53\u524d\u7684\u95ed\u533a\u95f4\uff0crt\u6307\u5f53\u524d\u533a\u95f4\u7f16\u53f7\n\nvoid SegmentTree::get_p(void) {\n  p = read();\n}\n//\u6ca1\u4ec0\u4e48\u7528\u7684\u51fd\u6570\n\nvoid SegmentTree::input(LL _n) {\n  LL *begin = a + 1, *end = a + _n + 1;\n  while (begin != end) {\n    *begin = read();\n    ++begin;\n  }\n}\n//\u5229\u7528\u6307\u9488\u6765\u52a0\u901f\u3002\n/*\na[i] \u7b49\u4ef7\u4e8e *(a + i)\n\u6240\u4ee5\u5bf9\u4e8e\u4ee5\u4e0b\u4e24\u6bb5\u4ee3\u7801\nfor (int i = 1; i <= n; ++i)\n  f(a[i]);\n\n\nfor (int now = a + 1; now != a + n + 1; ++now) \n  f(*now);\n  \n\u540e\u8005\u7684\u901f\u5ea6\u66f4\u5feb\n\u6240\u4ee5\u8fd9\u91cc\u7528\u6307\u9488\u548c\u5feb\u8bfb\u51fd\u6570\u8fdb\u884c\u8f93\u5165\n*/\n\ninline void SegmentTree::pushup(LL rt) {\n  sum[rt] = mod(sum[lson] + sum[rson]);\n}\n//\u5408\u5e76\u72b6\u6001\n\ninline void SegmentTree::pushdown (LL l, LL r, LL rt) {\n  if (add[rt] || mul[rt] != 1) {\n    LL mid = (l + r) >> 1;\n    sum[lson] = mod(sum[lson] * mul[rt] + add[rt] * (mid - l + 1));\n    sum[rson] = mod(sum[rson] * mul[rt] + add[rt] * (r - mid));\n    //\u533a\u95f4\u548c \u4e3a \u539f\u533a\u95f4\u548c * \u7236\u8282\u70b9\u4e58\u6cd5\u6807\u8bb0 + \u7236\u8282\u70b9\u52a0\u6cd5\u6807\u8bb0 * \u533a\u95f4\u957f\u5ea6 \u6700\u540e\u53d6\u6a21\n    add[lson] = mod(add[lson] * mul[rt] + add[rt]);\n    add[rson] = mod(add[rson] * mul[rt] + add[rt]);\n    //\u52a0\u6cd5\u6807\u8bb0 \u4e3a \u539f\u52a0\u6cd5\u6807\u8bb0 * \u7236\u8282\u70b9\u4e58\u6cd5\u6807\u8bb0 + \u7236\u8282\u70b9\u52a0\u6cd5\u6807\u8bb0 \u6700\u540e\u53d6\u6a21\n    mul[lson] = mod(mul[lson] * mul[rt]);\n    mul[rson] = mod(mul[rson] * mul[rt]);\n    //\u4e58\u6cd5\u6807\u8bb0 \u4e3a \u539f\u4e58\u6cd5\u6807\u8bb0 * \u7236\u8282\u70b9\u4e58\u6cd5\u6807\u8bb0 \u6700\u540e\u53d6\u6a21\n    mul[rt] = 1; add[rt] = 0;\n    //\u5c06\u7236\u8282\u70b9\u7684\u6807\u8bb0\u4e0b\u653e\u540e\uff0c\u6e05\u9664\n  }\n}\n//\u4e0b\u653e\u64cd\u4f5c\n\nvoid SegmentTree::build(LL l, LL r, LL rt) {\n  add[rt] = 0; mul[rt] = 1;\n  if (l == r) {\n    sum[rt] = mod(a[l]);\n    return ;\n  }\n  LL mid = (l + r) >> 1;\n  build(ltree);\n  build(rtree);\n  pushup(rt);\n}\n//\u9012\u5f52\u5efa\u6811\n\nvoid SegmentTree::update1(LL L, LL R, LL C, LL l, LL r, LL rt) {\n  //L, R\u4e3a\u76ee\u6807\u533a\u95f4\uff0cC\u4e3a\u4fee\u6539\u503c\uff0c\u4e0b\u540c\n  if (L <= l && r <= R) {\n    //\u5f53\u524d\u533a\u95f4\u5728\u76ee\u6807\u533a\u95f4\u5185\n    sum[rt] = mod(sum[rt] * C);\n    add[rt] = mod(add[rt] * C);\n    mul[rt] = mod(mul[rt] * C);\n    //\u56e0\u4e3a\u4e58\u6cd5\u4f18\u5148\u7ea7\u9ad8\uff0c\u6240\u4ee5\u5747\u4e58\u4e0aC\n    return ;\n  }\n  pushdown(l, r, rt);\n  //\u5148\u4e0b\u653e\n  LL mid = (l + r) >> 1;\n  //\u5411\u5de6\u3001\u53f3\u5206\u522b\u4fee\u6539\n  if (L <= mid) {\n    update1(L, R, C, ltree);\n  }\n  if (R > mid) {\n    update1(L, R, C, rtree);\n  }\n  pushup(rt);\n}\n//\u533a\u95f4\u4e58\u6cd5\n\nvoid SegmentTree::update2(LL L, LL R, LL C, LL l, LL r, LL rt) {\n  //\u57fa\u672c\u540c\u533a\u95f4\u4e58\u6cd5\n  if (L <= l && r <= R) {\n    sum[rt] = mod(sum[rt] + C * (r - l + 1));\n    //\u533a\u95f4\u548c \u8981\u52a0\u4e0a\u4fee\u6539\u503c*\u533a\u95f4\u957f\u5ea6\n    add[rt] = mod(add[rt] + C);\n    //\u6807\u8bb0\u4fee\u6539\n    return ;\n  }\n  pushdown(l, r, rt);\n  LL mid = (l + r) >> 1;\n  if (L <= mid) {\n    update2(L, R, C, ltree);\n  }\n  if (R > mid) {\n    update2(L, R, C, rtree);\n  }\n  pushup(rt);\n}\n//\u533a\u95f4\u52a0\u6cd5\n\nLL SegmentTree::query(LL L, LL R, LL l, LL r, LL rt) {\n  if (L <= l && r <= R) {\n    //\u76f4\u63a5\u8fd4\u56de\u5f53\u524d\u533a\u95f4\u548c\n    return sum[rt];\n  }\n  pushdown(l, r, rt);\n  LL mid = (l + r) >> 1, ans = 0;\n  //\u8fd8\u662f\u5411\u5de6\u3001\u53f3\u5206\u522b\u67e5\u8be2\n  if (L <= mid) {\n    ans = mod(ans + query(L, R, ltree));\n  }\n  if (R > mid) {\n    ans = mod(ans + query(L, R, rtree));\n  }\n  return ans;\n}\n//\u533a\u95f4\u67e5\u8be2\n\n#endif\n~~~",
        "postTime": 1560780887,
        "uid": 104438,
        "name": "\u5403\u7684",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P2023 \u3010[AHOI2009]\u7ef4\u62a4\u5e8f\u5217\u3011"
    }
]