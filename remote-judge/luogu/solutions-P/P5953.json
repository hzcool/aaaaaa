[
    {
        "content": "#### \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a $n\\times m$ \u7684\u77e9\u9635 ($1\\le n,m\\le 3000$)\uff0c\u6c42\u6240\u6709 $k\\times k$ \u7684\u5b50\u77e9\u9635\u7684\u4e0d\u540c\u5143\u7d20\u4e2a\u6570\uff0c\u8f93\u51fa\u6700\u5927\u503c\u4ee5\u53ca\u548c\u3002\n\n#### \u9898\u89e3\n\n\u5bf9\u6bcf\u79cd\u5143\u7d20\u5206\u5f00\u7b97\uff0c\u8981\u6c42\u7684\u5c31\u662f\u4e00\u4e9b $k\\times k$ \u7684\u77e9\u5f62\u7684\u5e76\uff0c\u7528\u5e73\u8861\u6811\u7ef4\u62a4\u8fde\u7eed\u6bb5\uff0c\u5dee\u5206\u8ba1\u7b97\u8d21\u732e\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(nm\\log m)$\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include <iostream>\n#include <vector>\n#include <algorithm>\n#include <map>\nint n, m, k;\nstd::vector<std::vector<int>> a, d;\nstd::map<int, int> s;\nstd::vector<std::vector<int>> pos;\nint main() {\n    std::ios::sync_with_stdio(false);\n    std::cin.tie(nullptr);\n    std::cin >> n >> m >> k;\n    a.assign(n, std::vector<int>(m));\n    int maxA = 0;\n    for (int i = 0; i < n; ++i) {\n        for (int j = 0; j < m; ++j) {\n            std::cin >> a[i][j];\n            maxA = std::max(maxA, a[i][j]);\n            --a[i][j];\n        }\n    }\n    pos.resize(maxA);\n    for (int i = 0; i < n; ++i)\n        for (int j = 0; j < m; ++j)\n            pos[a[i][j]].push_back(i * m + j);\n    d.assign(n - k + 2, std::vector<int>(m - k + 2));\n    for (int v = 0; v < maxA; ++v) {\n        s.clear();\n        s[0] = 0;\n        s[m - k + 1] = -1;\n        for (int p : pos[v]) {\n            int x = p / m + 1, y = p % m + 1;\n            int u = std::max(0, x - k), l = std::max(0, y - k);\n            x = std::min(x, n - k + 1);\n            y = std::min(y, m - k + 1);\n            s[y] = std::prev(s.upper_bound(y)) -> second;\n            auto it = std::prev(s.upper_bound(l));\n            int up = std::max(it -> second, u), rt = std::next(it) -> first;\n            ++d[up][l];\n            --d[up][rt];\n            --d[x][l];\n            ++d[x][rt];\n            ++it;\n            s[l] = x;\n            while (it -> first != y) {\n                up = std::max(it -> second, u);\n                int lf = it -> first;\n                it = s.erase(it);\n                rt = it -> first;\n                ++d[up][lf];\n                --d[up][rt];\n                --d[x][lf];\n                ++d[x][rt];\n            }\n        }\n    }\n    for (int i = 0; i <= n - k + 1; ++i)\n        for (int j = 1; j <= m - k + 1; ++j)\n            d[i][j] += d[i][j - 1];\n    for (int i = 1; i <= n - k + 1; ++i)\n        for (int j = 0; j <= m - k + 1; ++j)\n            d[i][j] += d[i - 1][j];\n    int max = 0;\n    long long sum = 0;\n    for (int i = 0; i < n - k + 1; ++i) {\n        for (int j = 0; j < m - k + 1; ++j) {\n            max = std::max(max, d[i][j]);\n            sum += d[i][j];\n        }\n    }\n    std::cout << max << \" \" << sum << \"\\n\";\n    return 0;\n}\n\n```\n\n",
        "postTime": 1582612641,
        "uid": 149656,
        "name": "jiangly",
        "ccfLevel": 10,
        "title": "P5953 [POI2018]R\u00f3\u017cnorodno\u015b\u0107 \u9898\u89e3"
    }
]