[
    {
        "content": "## $\\mathcal{Question}$\n\n[P7167 [eJOI 2020 Day1] Fountain](https://www.luogu.com.cn/problem/P7167)\n\n## $\\mathcal{Solution}$\n\n\u8bbe\u6c34\u6c60\u7684\u7f16\u53f7\u4e3a n+1\uff0c\u76f4\u5f84\u548c\u5bb9\u91cf\u8bbe\u4e3a\u65e0\u9650\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5355\u8c03\u6808\u6765\u6c42\u51fa\u6bcf\u4e00\u4e2a\u76d8\u5b50\u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u76f4\u5f84\u6bd4\u5b83\u5927\u7684\u76d8\u5b50\u3002\n\n```cpp\nd[n+1]=inf; c[n+1]=inf;\ns.push(1);\nfor(LL i=2;i<=n+1;i++) {\n\twhile (!s.empty()&&d[i]>d[s.top()]) {\n\t\tl[s.top()]=i; s.pop();\n\t}\n\ts.push(i);\n} // l[i] \u8868\u793a\u7b2c i \u4e2a\u76d8\u5b50\u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u76f4\u5f84\u6bd4\u5b83\u5927\u7684\u76d8\u5b50\u7684\u7f16\u53f7\n```\n\n\u63a5\u7740\uff0c\u6211\u4eec\u8003\u8651\u5efa\u4e00\u68f5\u6811\u3002\n\n\u4ee5\u6837\u4f8b\u6570\u636e\u4e3a\u4f8b\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/64e7acuq.png)\n\n\u5efa\u51fa\u6765\u7684\u6811\u5c31\u662f\u8fd9\u6837\u7684\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/solr19sz.png)\n\n\u76f8\u4fe1\u4f60\u5df2\u7ecf\u53d1\u73b0\u4e86\uff0c\u4ece\u5b50\u8282\u70b9\u5230\u7236\u4eb2\u8282\u70b9\u5c31\u662f\u6c34\u6d41\u7684\u65b9\u5411\u3002\n\n\u5efa\u6811\u7684\u4ee3\u7801\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u8fd9\u65f6\u5c31\u7528\u5230\u6211\u4eec\u4e0a\u9762\u6c42\u51fa\u6765\u7684 l \u6570\u7ec4\u4e86\u3002\n\n```cpp\nfor(LL i=1;i<=n;i++) add(l[i],i); // add \u8868\u793a\u8fde\u8fb9\u64cd\u4f5c\u3002\n// n+1 \u53f7\u8282\u70b9\u4e3a\u6839\uff0c\u4e0d\u9700\u8981\u679a\u4e3e\n```\n\n\u7136\u540e\uff0c\u6211\u4eec\u7ef4\u62a4\u4e24\u4e2a\u6570\u7ec4\uff1a\n\n+ f [ i ] [ j ] \u8868\u793a\u4ece\u7b2c i \u4e2a\u8282\u70b9\u5411\u4e0a\u8d70 $2^j$ \u6b65\u6240\u5230\u7684\u8282\u70b9\u7f16\u53f7\u3002\n\n+ g [ i ] [ j ] \u8868\u793a\u4ece i \u8282\u70b9\u5230 f [ i ] [ j ] \u8282\u70b9\u7684\u6240\u6709\u8282\u70b9\u7684\u5bb9\u91cf\u4e4b\u548c\uff08\u4e0d\u5305\u62ec i \u8282\u70b9\uff09\u3002\n\n\u6211\u4eec\u53ea\u9700\u8981\u904d\u5386\u4e00\u904d\u8fd9\u68f5\u6811\u5c31\u53ef\u4ee5\u7ef4\u62a4\u8fd9\u4e24\u4e2a\u6570\u7ec4\u3002\n\n\u8fd9\u91cc\u5c31\u7528\u5230\u4e86\u500d\u589e\u7684\u601d\u60f3\uff0c\u4e0e\u500d\u589e\u6c42 LCA \u5dee\u4e0d\u591a\u3002\n\n+ [\u500d\u589e\u6c42 LCA \u4f20\u9001\u95e8](https://www.cnblogs.com/lbssxz/p/11114819.html)\n\n\u987a\u4fbf\u7684\uff0c\u94fe\u5f0f\u524d\u5411\u661f\u4e0d\u4f1a\u7684\u6233\u4e0b\u9762\u3002\n\n+ [\u94fe\u5f0f\u524d\u5411\u661f\u4f20\u9001\u95e8](https://www.cnblogs.com/lbssxz/p/10764448.html)\n\n```cpp\nLL f[N][21],g[N][21],dep[N]; // dep[i] \u8868\u793a i \u8282\u70b9\u7684\u6df1\u5ea6\ninline void dfs(LL u,LL fa) {\n\tdep[u]=dep[fa]+1;\n\tf[u][0]=fa; g[u][0]=c[fa];\n\tfor(LL i=1;(1<<i)<=dep[u];i++) f[u][i]=f[f[u][i-1]][i-1],g[u][i]=g[f[u][i-1]][i-1]+g[u][i-1]; // \u500d\u589e\u601d\u60f3\n\tfor(LL i=head[u];i;i=edge[i].next) {\n\t\tLL v=edge[i].to;\n\t\tdfs(v,u);\n\t}\n}\n```\n\n\u67e5\u8be2\u7684\u65f6\u5019\u8ddf\u500d\u589e\u6c42 LCA \u7684\u67e5\u8be2\u4e5f\u6ca1\u592a\u5927\u7684\u533a\u522b\u3002\n\n```cpp\nfor(LL i=1;i<=q;i++) {\n\tLL r,v;\n\tcin>>r>>v;\n\tif (c[r]>=v) { //\u7279\u5224\n\t\tcout<<r<<endl;\n\t\tcontinue;\n\t}\n\tv-=c[r]; /*\u5148\u628a r \u76d8\u5b50\u4e2d\u7684\u6c34\u88c5\u6ee1 */ LL x=r; LL ans=0;\n\tfor(LL i=20;i>=0;i--) {\n\t\tif (g[x][i]<=v&&(1<<i)<=dep[x]) {\n\t\t\tv-=g[x][i]; x=f[x][i];\n\t\t}\n\t\tif (v==0) ans=x; // \u7279\u5224\n\t}\n\tif (ans==0) ans=f[x][0];\n\tif (ans==n+1) cout<<0<<endl;else cout<<ans<<endl;\n}\n```\n\n\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O(n\\ log\\ n)}$\u3002\n\n## $\\mathcal{Code}$\n\n```cpp\n%:include\"bits/stdc++.h\"\nusing namespace std;\n#define IOS ios::sync_with_stdio(false); cin.tie(0); cout.tie(0)\n#define N (LL)(1e5+10)\ntypedef long long LL;\nconst LL inf=1e16;\nLL n,q,d[N],c[N];\nstack<LL>s;\nLL l[N],head[N],tot=0;\nstruct node {\n\tLL next,to;\n}edge[N];\ninline void add(LL x,LL y) {\n\tedge[++tot].to=y;\n\tedge[tot].next=head[x];\n\thead[x]=tot;\n}\nLL f[N][21],g[N][21],dep[N];\ninline void dfs(LL u,LL fa) {\n\tdep[u]=dep[fa]+1;\n\tf[u][0]=fa; g[u][0]=c[fa];\n\tfor(LL i=1;(1<<i)<=dep[u];i++) f[u][i]=f[f[u][i-1]][i-1],g[u][i]=g[f[u][i-1]][i-1]+g[u][i-1];\n\tfor(LL i=head[u];i;i=edge[i].next) {\n\t\tLL v=edge[i].to;\n\t\tdfs(v,u);\n\t}\n}\nsigned main() {\n\tIOS;\n\tcin>>n>>q;\n\tfor(LL i=1;i<=n;i++) cin>>d[i]>>c[i];\n\td[n+1]=inf; c[n+1]=inf;\n\ts.push(1);\n\tfor(LL i=2;i<=n+1;i++) {\n\t\twhile (!s.empty()&&d[i]>d[s.top()]) {\n\t\t\tl[s.top()]=i; s.pop();\n\t\t}\n\t\ts.push(i);\n\t}\n\tfor(LL i=1;i<=n;i++) add(l[i],i);\n\tdfs(n+1,0);\n\tfor(LL i=1;i<=q;i++) {\n\t\tLL r,v;\n\t\tcin>>r>>v;\n\t\tif (c[r]>=v) {\n\t\t\tcout<<r<<endl;\n\t\t\tcontinue;\n\t\t}\n\t\tv-=c[r]; LL x=r; LL ans=0;\n\t\tfor(LL i=20;i>=0;i--) {\n\t\t\tif (g[x][i]<=v&&(1<<i)<=dep[x]) {\n\t\t\t\tv-=g[x][i]; x=f[x][i];\n\t\t\t}\n\t\t\tif (v==0) ans=x;\n\t\t}\n\t\tif (ans==0) ans=f[x][0];\n\t\tif (ans==n+1) cout<<0<<endl;else cout<<ans<<endl;\n\t}\n\treturn 0;\n}\n```\n\u5b8c\u7ed3\u6492\u82b1\uff01 **^.^**",
        "postTime": 1625732982,
        "uid": 355448,
        "name": "Fido_Puppy",
        "ccfLevel": 0,
        "title": "P7167 [eJOI 2020 Day1] Fountain"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P7167)\u3002\n\n> \u9898\u610f\u7b80\u8ff0\uff1a\u7ed9\u5b9a $N$ \u4e2a\u76f4\u5f84\u4e3a $D_i$\uff0c\u5bb9\u91cf\u4e3a $C_i$ \u7684**\u4ece\u4e0a\u5230\u4e0b**\u7684\u7a7a\u5706\u76d8\u3002\u4e00\u4e2a\u5706\u76d8\u6ea2\u51fa\u7684\u6c34\u4f1a\u6d41\u5230\u4e0b\u65b9\u6bd4\u5b83\u5927\u7684\u5706\u76d8\u4e2d\u3002$Q$ \u6b21\u8be2\u95ee\u5982\u679c\u5f80\u7b2c $R$ \u4e2a\u5706\u76d8\u5012 $V$ \u4f53\u79ef\u7684\u6c34\uff0c\u6c34\u6700\u540e\u4f1a\u6d41\u5230\u54ea\u4e2a\u5706\u76d8\uff0c\u5982\u679c\u6d41\u5230\u5e95\u5219\u8f93\u51fa $0$\uff0c\u6bcf\u4e2a\u8be2\u95ee\u72ec\u7acb\u3002\n\n> $N,Q\\leq 10^5$\u3002\n\n---\n\n\u9996\u5148\u8003\u8651\u66b4\u529b\uff1a\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8be2\u95ee\uff0c\u76f4\u63a5\u6a21\u62df\uff0c\u82e5\u6c34\u6ea2\u51fa\uff0c\u5219\u679a\u4e3e\u627e\u51fa\u5728\u5f53\u524d\u5706\u76d8 $i$ \u4e0b\u65b9\u6700\u8fd1\u7684\u6bd4\u5f53\u524d\u5706\u76d8\u5927\u7684\u5706\u76d8 $j$\uff0c\u5373\u4ece $i+1$ \u679a\u4e3e\u51fa\u6700\u5c0f\u7684 $j$ \u4f7f\u5f97 $i<j$ \u4e14 $D_i<D_j$\uff0c\u5c06\u5f53\u524d\u6c34\u91cf\u51cf\u53bb\u5f53\u524d\u5706\u76d8\u7684\u5bb9\u91cf $C_i$ \u6d41\u8fdb\u4e0b\u4e00\u4e2a\u5706\u76d8 $j$\u3002\n\n\u53ef\u4ee5\u5355\u8c03\u6808\u9884\u5904\u7406\u51fa\u5728\u6bcf\u4e2a\u5706\u76d8\u4e0b\u65b9\u6700\u8fd1\u7684\u6bd4\u5b83\u5927\u7684\u5706\u76d8\uff0c\u7136\u540e\u500d\u589e\u4f18\u5316\u6a21\u62df\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}((n+q)\\log n)$\u3002\n\n```cpp\nint main(){\n\tn=read(),q=read(),lg=log2(n);\n\tfor(int i=1;i<=n;i++)d[i]=read(),c[i]=read();\n\tfor(int i=n;i;i--){\n\t\twhile(top&&d[i]>=d[stc[top]])top--;\n\t\tto[i][0]=stc[top],f[i][0]=c[i],stc[++top]=i;\n\t} for(int j=1;j<=lg+1;j++)\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tto[i][j]=to[to[i][j-1]][j-1],f[i][j]=f[i][j-1]+f[to[i][j-1]][j-1];\n\tfor(int i=1;i<=q;i++){\n\t\tint p=read(),r=read();\n\t\tfor(int j=lg+1;~j;j--)if(r>f[p][j])r-=f[p][j],p=to[p][j];\n\t\tprint(p),pc('\\n');\n\t}\n\treturn flush(),0;\n}\n```",
        "postTime": 1608993947,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P7167 \u3010[eJOI 2020 Day1] Fountain\u3011"
    },
    {
        "content": "\u611f\u8c22@[douzi](/space/show?uid=278697) \u5927\u4f6c\u7684 hack \u6570\u636e\uff0c\u672c\u9898\u89e3\u5df2\u4fee\u6b63\uff1a\n\n\u95ee\u9898\u5728\u500d\u589e\u6570\u7ec4\u521d\u59cb\u5316\u4e0a\uff0c\u5f53\u4e00\u4e2a\u76d8\u53ea\u80fd\u6d41\u5230\u6c34\u6c60\u4e2d\u65f6\uff0c$u$ \u6570\u7ec4\u5e94\u4e3a $\\infty$\uff0c\u800c\u4e0d\u662f $0$\u3002\n\n\n------------\n# Preface\n\n\n\n\u5355\u8c03\u6808&\u500d\u589e\u597d\u9898\u3002\n# Analysis\n\u5148\u6765\u770b\u4e00\u4e0b\u9898\u76ee\u63cf\u8ff0\uff1a\n\n------------\n\u201c\u5f53\u4e00\u4e2a\u5706\u76d8\u91cc\u7684\u6c34\u5927\u4e8e\u4e86\u8fd9\u4e2a\u5706\u76d8\u7684\u5bb9\u91cf\uff0c\u90a3\u4e48\u6c34\u5c31\u4f1a\u6ea2\u51fa**\u5f80\u4e0b\u6d41**\uff0c\u76f4\u5230\u6d41\u5165\u534a\u5f84**\u5927\u4e8e**\u8fd9\u4e2a\u5706\u76d8\u7684\u5706\u76d8\u91cc\u3002\u201d\n\n------------\n\n\u201c\u5f80\u4e0b\u6d41\u201d\u201c\u5927\u4e8e\u201d\u8fd9\u5c31\u5f88\u50cf\u5355\u8c03\u6808\u4e86\u3002\n\n\u518d\u6765\u770b\u6837\u4f8b\u89e3\u91ca\u91cc\u7684\u56fe\uff0c\u6211\u628a\u5b83\u65cb\u8f6c\u4e86\u4e00\u4e0b\uff1a\n![](https://cdn.luogu.com.cn/upload/image_hosting/we4n2xas.png)\n\n\u5411 $1$ \u53f7\u5706\u76d8\u4e2d\u704c\u6c34\uff0c\u6c34\u6d41\u5230 $2$ \u53f7\u548c $5$ \u53f7\u5706\u76d8\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff1a\u4ece\u4e0b\u5f80\u4e0a\uff0c\u80fd\u63a5\u6536\u5230\u6c34\u7684\u5706\u76d8\u534a\u5f84**\u4e25\u683c\u5355\u8c03\u9012\u51cf**\u3002\n\n\u8fd9\u6070\u6070\u53ef\u4ee5\u7528\u5355\u8c03\u6808\u7ef4\u62a4\u3002\n\n\u4f46\u53ea\u6709\u5355\u8c03\u6808\u662f\u4e0d\u591f\u7684\uff0c\u5355\u8c03\u6808\u7ef4\u62a4\u7684\u8fc7\u7a0b\u662f\u52a8\u6001\u7684\uff0c\u6808\u4e2d\u7684\u4fe1\u606f\u6709\u65f6\u6548\u6027\uff0c\u5728\u7ef4\u62a4\u8fc7\u7a0b\u4e2d\u6211\u4eec\u9700\u8981\u8bb0\u5f55\u4e0b\u4fe1\u606f\uff0c\u7136\u540e\u5728\u500d\u589e\u7684\u63a5\u7eed\u4f20\u9012\u4e2d\u63a8\u51fa\u5168\u9762\u7684\u3001\u9759\u6001\u7684\u3001\u4fbf\u4e8e\u56de\u7b54\u8be2\u95ee\u7684\u4fe1\u606f\u3002\n\n# Solution\n\n\u5f00\u4e24\u4e2a\u6570\u7ec4\uff1a$f[i][j]$ \u8868\u793a\u4ece $i$ \u8fd9\u4e2a\u4f4d\u7f6e\u5411\u4e0b\u7684\u7b2c $2^j$ \u4e2a\u5706\u76d8\u662f\u54ea\u4e2a\uff0c$u[i][j]$ \u8868\u793a\u6d41\u6ee1\u4ece $i$ \u8fd9\u4e2a\u4f4d\u7f6e\u5411\u4e0b\u7684 $2^j$ \u4e2a\u5706\u76d8\uff08\u4e0d\u5305\u62ec $i$\uff09\u9700\u8981\u591a\u5c11\u4f53\u79ef\u7684\u6c34\u3002\n\n## 1. \u5355\u8c03\u6808\u6c42\u51fa $f[i][0]$\n\n\u7ef4\u62a4\u4e00\u4e2a**\u4e25\u683c\u5355\u8c03\u9012\u51cf**\u7684\u5355\u8c03\u6808\uff0c\u4ece\u540e\u5411\u524d\uff08\u4ece\u4e0b\u5411\u4e0a\uff09\u626b\u6570\u7ec4\uff0c\u82e5\u65b0\u52a0\u5165\u7684\u5706\u76d8\u7684\u534a\u5f84\u6bd4\u6808\u9876\u5706\u76d8\u534a\u5f84\u5927\u5c31\u5f39\u51fa\u6808\u9876\u3002\n```cpp\n\tfor(re int i=n;i>=1;--i)\n\t{\n\t\twhile(size&&a[s[size]].d<=a[i].d)\tsize--;//\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u5f39\u51fa\n\t\tf[i][0]=s[size];//\u8bb0\u5f55f[i][0]\n\t\ts[++size]=i;//\u5165\u6808\n\t}\t\n```\n\n## 2. \u500d\u589e\u51fa\u5b8c\u6574\u7684 $f$ \u6570\u7ec4\u548c $u$ \u6570\u7ec4\n\n```cpp\n\tfor(re int i=1;i<=23;++i)\n\t\tfor(re int j=1;j<=n;++j)\n\t\t\tf[j][i]=f[f[j][i-1]][i-1];//\u500d\u589ef\u6570\u7ec4\n   for(re int i=1;i<=n;++i)\t\n\t\tu[i][0]=a[f[i][0]].c;//\u6839\u636e\u5b9a\u4e49\u521d\u59cb\u5316\n   for(re int i=1;i<=n;++i)\n\t\tif(f[i][0]==0)\t\n\t\t\tu[i][0]=inf; //\u521d\u59cb\u5316u\u6570\u7ec4 \n\tfor(re int i=1;i<=23;++i)\n\t\tfor(re int j=1;j<=n;++j)\n\t\t\tu[j][i]=u[j][i-1]+u[f[j][i-1]][i-1];//\u500d\u589eu\u6570\u7ec4\n```\n\n## 3. \u5229\u7528 $u$ \u6570\u7ec4\u56de\u7b54\u8be2\u95ee\uff08\u4eff\u7167\u500d\u589e LCA\uff09\n\n```cpp\n\t\tint r=read(),v=read();\n\t\tif(v<=a[r].c)\n\t\t{\n\t\t\tcout<<r<<'\\n';\n\t\t\tcontinue;\n\t\t}//\u5982\u679c\u6d41\u4e0d\u5230\u5176\u4ed6\u76d8\u5c31\u76f4\u63a5\u8f93\u51fa\n\t\tv-=a[r].c;//\u8981\u51cf\u6389\u5f53\u524d\u5706\u76d8\u7684\u5bb9\u91cf\uff0c\u7ed3\u5408u\u6570\u7ec4\u7684\u5b9a\u4e49\uff0c\u60f3\u4e00\u60f3\u4e3a\u4ec0\u4e48\n\t\tfor(re int i=23;i>=0;--i)\n\t\t\tif(u[r][i]<=v)\t\n\t\t\t\tv-=u[r][i],r=f[r][i];\n\t\tif(v)\tr=f[r][0];//\u5982\u679c\u8fd8\u6709\u5269\u4f59\u5c31\u4f1a\u6d41\u5230\u4e0b\u9762\u4e00\u4e2a\n\t\tcout<<r<<'\\n';\n```\n\n\u590d\u6742\u5ea6\uff1a\u5355\u8c03\u6808 $O(N)$\uff0c\u500d\u589e $O(N\\log N)$\uff0c\u56de\u7b54\u8be2\u95ee $O(Q\\log N)$\uff0c\u603b\u590d\u6742\u5ea6 $O((N+Q)\\log N)$\u3002\n\n# Code \n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define re register\n#define maxn 100010\n#define inf 0x7f7f7f7f\n#define int long long\n#define Orz cout<<\"stO %\u738b\u961f% Orz\"<'\\n';\nint n,q;\nstruct node\n{\n\tint d,c;\n}a[maxn];\nint s[maxn],size;\nint f[maxn][25],u[maxn][25];\ninline int read(){\n    int x=0,f=1;char ch=getchar();\n    while (ch<'0'||ch>'9') {if(ch=='-')f=-1; ch=getchar();}\n    while (ch>='0'&&ch<='9'){x=(x<<3)+(x<<1)+ch-'0'; ch=getchar();}\n    return x*f;\n}\nsigned main()\n{\n\tcin>>n>>q;\n\tfor(re int i=1;i<=n;++i)\n\t\ta[i].d=read(),a[i].c=read();//\u8bfb\u5165\u6570\u636e\n\tfor(re int i=n;i>=1;--i)\n\t{\n\t\twhile(size&&a[s[size]].d<=a[i].d)\tsize--;\n\t\tf[i][0]=s[size];\n\t\ts[++size]=i;\n\t}\t//\u5355\u8c03\u6808\n\tfor(re int i=1;i<=23;++i)\n\t\tfor(re int j=1;j<=n;++j)\n\t\t\tf[j][i]=f[f[j][i-1]][i-1];\n\tfor(re int i=1;i<=n;++i)\t\n\t\tu[i][0]=a[f[i][0]].c;\n\tfor(re int i=1;i<=n;++i)\n\t\tif(f[i][0]==0)\t\n\t\t\tu[i][0]=inf; //\u521d\u59cb\u5316u\u6570\u7ec4 \n\tfor(re int i=1;i<=23;++i)\n\t\tfor(re int j=1;j<=n;++j)\n\t\t\tu[j][i]=u[j][i-1]+u[f[j][i-1]][i-1];//\u500d\u589e\n\twhile(q--)\n\t{\n\t\tint r=read(),v=read();\n\t\tif(v<=a[r].c)\n\t\t{\n\t\t\tcout<<r<<'\\n';\n\t\t\tcontinue;\n\t\t}\n\t\tv-=a[r].c;\n\t\tfor(re int i=23;i>=0;--i)\n\t\t\tif(u[r][i]<=v)\t\n\t\t\t\tv-=u[r][i],r=f[r][i];\n\t\tif(v)\tr=f[r][0];\n\t\tcout<<r<<'\\n';\n\t}//\u56de\u7b54\u8be2\u95ee\n\treturn 0;\n}\n\n\n\n\n```\n",
        "postTime": 1627450067,
        "uid": 91956,
        "name": "Dreamweaver",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P7167"
    },
    {
        "content": "\u55ef\uff0c\u8fd9\u9053\u9898\u867d\u7136\u53ea\u662f\u7eff\u7684\uff0c\u4f46\u4e2a\u4eba\u8ba4\u4e3a\u5176\u4e2d\u6709\u91cd\u8981\u610f\u4e49\u3002\u7531\u4e8e\u8fd9\u9053\u9898\u6d89\u53ca\u5230\u7684\u7b97\u6cd5\u548c\u601d\u8def\u6bd4\u8f83\u591a\uff0c\u6211\u4f1a\u91c7\u7528\u5faa\u5e8f\u6e10\u8fdb\u7684\u65b9\u5f0f\u6765\u5199\u3002\n\n### Part 1 \u57fa\u7840\u505a\u6cd5\n\n\u54c8\uff0c\u5148\u6765\u7406\u89e3\u4e00\u4e0b\u9898\u610f\u5427\u3002\n\n\u4e2a\u4eba\u662f\u5efa\u8bae\u628a\u9898\u76ee\u91cc\u9762\u6ef4\u56fe\u5012\u8fc7\u6765\u770b\u770b\uff01\n\n![Fountain](https://cdn.luogu.com.cn/upload/image_hosting/bjwxlxll.png)\n\n\u53ef\u4ee5\u8fd9\u4e48\u7406\u89e3\uff0c\u5982\u679c\u6c34\u5230\u4e86\u4e00\u4e2a\u76d8\u5b50\u91cc\u9762\uff0c\u4f1a\u6ea2\u51fa\u5230**\u5f80\u53f3\u7b2c\u4e00\u4e2a\u76f4\u5f84\u6bd4\u6240\u5728\u76d8\u5b50\u8981\u5927\u7684\u76d8\u5b50**\u91cc\u9762\u3002\n\n\u201c\u540e\u9762\u7b2c\u4e00\u4e2a\u6bd4\u81ea\u5df1\u5927\u7684\u5143\u7d20\u201d\uff0c\u8fd9\u4e0d\u5c31\u662f```\u5355\u8c03\u6808```\u7684\u7528\u6cd5\u5417\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u81ea\u7136\u5730\u60f3\u5230\u5355\u8c03\u6808\u6240\u6709\u76d8\u5b50\u7684 $d_i$ \uff08\u76f4\u5f84\uff09\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u5199\u51fa\u4e0b\u9762\u4ee3\u7801\u54af\uff1a\n\n```cpp\nvoid find_max(){\n\tfor(ri i=1;i<=n;i++){\n\t\twhile(stk.empty()==0&&d[i]>d[stk.top()]){\n\t\t\tb[stk.top()]=i;//\u8bb0\u5f55\u6bcf\u4e2a\u76d8\u5b50\u5f80\u53f3\u7b2c\u4e00\u4e2a\u76f4\u5f84\u6bd4\u5b83\u5927\u7684\u76d8\u5b50\u7f16\u53f7\u3002\n\t\t\tstk.pop();\n\t\t}\n\t\tstk.push(i);\n\t}\n\twhile(stk.empty()==0){\n\t\tb[stk.top()]=0;//0\u4ee3\u8868\u6c34\u6c60\u3002\n\t\tstk.pop();\n\t}\n}\n```\n\n\u90a3\u6709\u4e86\u8fd9\u4e2a\uff0c\u6211\u4eec\u518d\u60f3\u60f3\uff0c\u63a5\u4e0b\u6765\u600e\u4e48\u505a\u5462\uff1f\u5c31\u4e3e\u4e00\u4e2a\u6d45\u663e\u7684\u4f8b\u5b50\uff0c\u73b0\u5728\u6211\u4eec\u786e\u5b9a\u4e86\u4e00\u4e2a\u76d8\u5b50 $r$ \uff08\u7f16\u53f7\uff09\uff0c\u91cc\u9762\u88c5\u4e86 $v$ \u7684\u6c34\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4e0d\u505c\u5730\u627e\u5b83\u7684\u4e0b\u4e00\u4e2a\u76d8\u5b50\uff0c\u76f4\u5230\u6c34\u4e0d\u4f1a\u518d\u6ea2\u51fa\u5c31\u53ef\u4ee5\u627e\u5230\u6700\u540e\u7684\u76d8\u5b50\u7684\u7f16\u53f7\u4e86\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u7528```while```\u5faa\u73af\u5b9e\u73b0\uff1a\n\n```cpp\nfor(ri i=1;i<=q;i++){\n\tscanf(\"%d%d\",&r,&v);\n\tint tmp=r;\n\twhile(tmp!=0){\t\n\t\tv-=c[tmp];\n\t\tif(v<=0)break;\n\t\ttmp=b[tmp];\n\t}\n\tprintf(\"%d\\n\",tmp);\n}\n```\n\u90a3\u6211\u4eec\u8fd9\u4e48\u505a\uff0c\u53ef\u4ee5\u62ff\u5230[30\u5206](https://www.luogu.com.cn/record/75830263)\uff08TLE\uff09\uff0c\u800c\u8fd9\u9898\u5728\u666e\u53ca\u7ec4\u4e2d\u4e5f\u5927\u6982\u6709\u4e2a3~4\u9898\u7684\u96be\u5ea6\uff0c\u5927\u6982\u4f1a\u6709\u4e2a50\u5206\u5de6\u53f3\uff0c\u4e5f\u662f\u4e0d\u9519\u7684\u5206\u4e86\uff01\n\n### Part2 \u5347\u7ea7\u7248\u6b63\u89e3\n\n\u5355\u8c03\u6808\u7684\u90e8\u5206\u80af\u5b9a\u6ca1\u5f97\u6539\u6ef4\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u5c31\u6765\u60f3\u60f3\u5982\u4f55\u4f18\u5316\u3002\n\n\u6709\u5355\u8c03\u6027\uff0c\u53ef\u4ee5\u4e8c\u5206\uff1f\u4f46\u662f\u8003\u8651\u5230\u5982\u679c\u8981\u4e8c\u5206\uff0c\u5c31\u9700\u8981\u4efb\u610f\u4e00\u6bb5\u8ddd\u79bb\u53ef\u4ee5\u627f\u53d7\u7684\u6c34\u91cf\uff0c\u8fd9\u4e2a\u4e5f\u4e0d\u597d\u7b97\uff0c\u548c\u533a\u95f4\u5185\u6bcf\u4e00\u4e2a\u76d8\u5b50\u7684\u76f4\u5f84\u5bb9\u79ef\u90fd\u6709\u5173\u7cfb\uff0c\u76f4\u63a5\u653e\u5f03\u3002\n\n\u65e2\u7136\u60f3\u5230\u4e86\u4e8c\u5206\uff0c\u5176\u5b9e\u53ef\u4ee5\u5f88\u5bb9\u6613\u60f3\u5230\u500d\u589e\u3002\u4f60\u4ece\u67d0\u4e2a\u76d8\u5b50\u5f00\u59cb\uff0c\u7167\u7406\u6765\u8bf4\u662f\u4f1a\u8df3\u5230\u4e0b\u4e00\u4e2a\u53ef\u4ee5\u8df3\u6ef4\u76d8\u5b50\uff0c\u4f46\u662f\u5982\u679c\u60f3\u8981\u4f18\u5316\u65f6\u95f4\uff0c\u53ef\u4ee5\u591a\u8df3\uff01\u5bf9\uff0c\u8fd9\u5c31\u662f\u500d\u589e\uff0c\u8df3 $2$ \u7684\u5e42\u6b21\u3002\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u7528```ST\u8868```\u7ef4\u62a4 $nxt[i][j]$ \uff08\u4ece\u76d8\u5b50 $i$ \u5f80\u540e\u8df3 $2^j$ \u6b65\u5230\u8fbe\u7684\u76d8\u5b50\u7f16\u53f7\uff09\u548c $sum[i][j]$ \u533a\u95f4\u603b\u6c34\u91cf\u3002\n\n\u53ef\u4ee5\u5199\u51fa\u4e0b\u9762\u7684\u5904\u7406\u4ee3\u7801\uff1a\n\n```cpp\nvoid pre_rmq(){\n\tfor(ri j=1;(1<<j)<=n;j++){\n\t\tfor(ri i=1;i+(1<<j)<=n;i++){\n\t\t\tnxt[i][j]=nxt[nxt[i][j-1]][j-1];\n\t\t\tsum[i][j]=sum[i][j-1]+sum[nxt[i][j-1]][j-1];\n\t\t}\n\t}\n}\n\nint query(int r,int val){\n\tif(c[r]>=val){\n\t\treturn r;\n\t}\n\tval-=c[r];\n\tfor(ri i=18;i>=0;i--){\n\t\tif(nxt[r][i]!=0&&val>sum[r][i]){\n\t\t\tval-=sum[r][i];\n\t\t\tr=nxt[r][i];\n\t\t}\n\t}\n\treturn nxt[r][0];\n}\n```\n\n\u4e8e\u662f\u8fd9\u9053\u9898\u5dee\u4e0d\u591a\u5c31\u89e3\u51b3\u4e86\uff01\n\n### Part 3 \u5b8c\u6574\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define ri register int\nusing namespace std;\nconst int MAXN=1e5+10;\nint n,q,d[MAXN],c[MAXN],r,v,b[MAXN],nxt[MAXN][20],sum[MAXN][20];\nstack <int> stk;\n\nvoid find_max(){\n\tfor(ri i=1;i<=n;i++){\n\t\twhile(stk.empty()==0&&d[i]>d[stk.top()]){\n\t\t\tnxt[stk.top()][0]=i;\n\t\t\tsum[stk.top()][0]=c[i];\n\t\t\tstk.pop();\n\t\t}\n\t\tstk.push(i);\n\t}\n\twhile(stk.empty()==0){\n\t\tnxt[stk.top()][0]=0;\n\t\tstk.pop();\n\t}\n}\n\nvoid pre_rmq(){\n\tfor(ri j=1;(1<<j)<=n;j++){\n\t\tfor(ri i=1;i+(1<<j)<=n;i++){\n\t\t\tnxt[i][j]=nxt[nxt[i][j-1]][j-1];\n\t\t\tsum[i][j]=sum[i][j-1]+sum[nxt[i][j-1]][j-1];\n\t\t}\n\t}\n}\n\nint query(int r,int val){\n\tif(c[r]>=val){\n\t\treturn r;\n\t}\n\tval-=c[r];\n\tfor(ri i=18;i>=0;i--){\n\t\tif(nxt[r][i]!=0&&val>sum[r][i]){\n\t\t\tval-=sum[r][i];\n\t\t\tr=nxt[r][i];\n\t\t}\n\t}\n\treturn nxt[r][0];\n}\n\nint main() {\n\tscanf(\"%d%d\",&n,&q);\n\tfor(ri i=1;i<=n;i++)scanf(\"%d%d\",&d[i],&c[i]);\n\tmemset(sum,0x3f,sizeof(sum));\n\tfind_max();\n\tpre_rmq();\n\tfor(ri i=1;i<=q;i++){\n\t\tscanf(\"%d%d\",&r,&v);\n\t\tprintf(\"%d\\n\",query(r,v));\n\t}\n\treturn 0;\n}\n```\n\n\u603b\u7ed3\u4e00\u4e0b\uff0c\u505a\u9898\u7684\u601d\u8def\u8981\u8bb2\u7a76\u5faa\u5e8f\u6e10\u8fdb\uff0c\u6162\u6162\u6765\uff0c\u4e0d\u8981\u8f7b\u89c6\u7b80\u5355\u57fa\u7840\u7684\u7b97\u6cd5\u548c\u601d\u8def\uff01",
        "postTime": 1652677192,
        "uid": 483928,
        "name": "Ziqqurat",
        "ccfLevel": 5,
        "title": "P7167 \u9898\u89e3"
    },
    {
        "content": "## Subject\n[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P7167)\n\n## Analysis\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u4e00\u4e2a\u5706\u76d8\u7684\u5bb9\u79ef\u5c0f\u4e8e\u73b0\u5728\u7684\u6c34\uff0c\u90a3\u4e48\u591a\u51fa\u6765\u7684\u6c34\u4f1a\u6d41\u5230\u5b83\u4e0b\u9762\u7684\u7b2c\u4e00\u4e2a\u76f4\u5f84\u6bd4\u5b83\u5927\u7684\u5706\u76d8\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u9700\u8981\u9884\u5904\u7406\u51fa\u6bcf\u4e00\u4e2a\u5706\u76d8\u4e4b\u540e\u7b2c\u4e00\u4e2a\u76f4\u5f84\u6bd4\u5b83\u5927\u7684\u5706\u76d8\u7684\u7f16\u53f7\uff0c\u53ef\u4ee5\u7528\u5355\u8c03\u6808 $ O(n)$ \u6c42\u51fa\u3002\n\n\u6211\u4eec\u628a\u6bcf\u4e2a\u5706\u76d8\u548c\u7b2c\u4e00\u4e2a\u76f4\u5f84\u6bd4\u5b83\u5927\u7684\u5706\u76d8\u4e4b\u95f4\u8fde\u8fb9\uff0c\u53d1\u73b0\u662f\u4e00\u68f5\u6811\uff0c\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f\u627e\u5230\u6700\u8001\u7684\u4e00\u4e2a\u7956\u5148\uff0c\u4f7f\u8fd9\u4e2a\u70b9\u5230\u8fd9\u4e2a\u7956\u5148\u8def\u5f84\u4e0a\u5706\u76d8\u7684\u603b\u5bb9\u79ef\u4e0d\u5927\u4e8e\u6c34\u91cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u6811\u4e0a\u500d\u589e\u89e3\u51b3\u3002\u5148\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u5b50\u8282\u70b9\u5230\u7956\u5148\u8282\u70b9\u7684\u8def\u5f84\u4e0a\u6240\u6709\u8282\u70b9\u7684\u5bb9\u79ef\u548c\uff0c\u53ef\u4ee5\u901a\u8fc7\u904d\u5386\u6574\u68f5\u6811\u89e3\u51b3\uff0c\u7136\u540e\u500d\u589e\uff0c\u6bcf\u6b21\u8df3\u7956\u5148\uff0c\u53ea\u8981\u5f53\u524d\u603b\u5bb9\u79ef\u5c0f\u4e8e\u6c34\u91cf\u5c31\u5f80\u4e0a\u8df3\uff0c\u76f4\u5230\u4e0d\u80fd\u8df3\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8282\u70b9\u5c31\u662f\u7b54\u6848\u3002\n\n\u8fd8\u6709\u4e00\u4e9b\u5177\u4f53\u7684\u7ec6\u8282\uff0c\u5177\u4f53\u89c1\u4ee3\u7801\u3002\n## Code\n```cpp\n#include<cmath>\n#include<cstdio>\n#include<vector>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\n#define int long long\nconst int M=1e6+10;\nconst int N=30;\nconst int inf=0x3f3f3f3f;\ninline int Read(void){\n    int s=0,f=1;char c=getchar();\n    while(!isdigit(c)){if(c=='-')f=-1;c=getchar();}\n    while(isdigit(c)){s=s*10+c-48;c=getchar();}\n    return s*f;    \n}\nvector<int> Edge[M];\nint n,m,u,val,d[M],w[M],Max[M];\nint stack[M],top;\nint fat[M][N],dep[M];\nint sum[M];\nvoid addEdge(int u,int v){\n    Edge[u].push_back(v);\n    return;\n}\nvoid Dfs(int u,int fath){\n    fat[u][0]=fath;\n    dep[u]=dep[fath]+1;\n    for(int i=1;fat[u][i-1];i++)\n        fat[u][i]=fat[fat[u][i-1]][i-1];\n    for(auto v:Edge[u]){\n        sum[v]=sum[u]+w[v];\n        Dfs(v,u);\n    }\n    return;\n}\nint Query(int u,int val){\n    for(int i=21;i>=0;i--){\n        if(sum[u]-sum[fat[u][i]]<val){\n            val-=sum[u]-sum[fat[u][i]];\n            u=fat[u][i];\n        }    \n    }\n    return u;\n}\nsigned main(void){\n    n=Read();m=Read();\n    for(int i=1;i<=n;i++){\n        d[i]=Read();\n        w[i]=Read();\n    }\n    d[n+1]=inf;\n    stack[++top]=1;\n    for(int i=2;i<=n+1;i++){\n        while(top&&d[i]>d[stack[top]]){\n            Max[stack[top]]=i;\n            top--;\n        }\n        stack[++top]=i;\n    }\n    for(int i=1;i<=n;i++)\n        addEdge(Max[i]==n+1?0LL:Max[i],i);\n    Dfs(0,0);\n    for(int i=1;i<=m;i++){\n        u=Read();val=Read();\n        printf(\"%lld\\n\",Query(u,val));\n    }\n    return 0;\n}\n```",
        "postTime": 1627194184,
        "uid": 246005,
        "name": "StupidSeven",
        "ccfLevel": 4,
        "title": "P7167"
    },
    {
        "content": "### \u5148\u770b\u7b97\u6cd5\u6807\u7b7e\uff0c\u500d\u589e\uff1f\n### ~~\u60f3\u8d77\u4e86\u500d\u589e\u6c42LCA~~\n\u4e0a\u601d\u8def\uff1a\n\n- ### \u7b2c\u4e00\u6b65\uff0c\u6c42\u51fa\u6bcf\u4e00\u4e2a\u76d8\u5b50\u7684\u6c34\u6d41\u51fa\u6765\u4e4b\u540e\u4f1a\u6700\u5148\u6d41\u5230\u54ea\u91cc\n\u5355\u7eaf\u679a\u4e3e\u590d\u6742\u5ea6\u8fc7\u9ad8\uff0c\u7528\u5355\u8c03\u6808\u4f18\u5316\u5373\u53ef\uff0c\u95ee\u9898\u5c31\u8f6c\u5316\u6210\u4e86\u6c42\u5728\u67d0\u4e2a\u5143\u7d20\u4e4b\u524d\u7684\u79bb\u8fd9\u4e2a\u5143\u7d20\u6700\u8fd1\u4e14\u6bd4\u5b83\u5927\u7684\u5143\u7d20\u7684\u4f4d\u7f6e\u3002\n\nw[i]\u8868\u793a\u4ece\u4e0b\u5f80\u4e0a\u7b2ci\u4e2a\u76d8\u5b50\u7684\u76f4\u5f84\u3002\n```cpp\nint next[N][M];\nstruct node{int number,data;};\nstack<node>sta;\nvoid init_next(){\n\tsta.push((node){0,1e18});\n\tfor(int i=1;i<=m;i++){\n\t\twhile(!sta.empty()&&sta.top().data<=w[i])sta.pop();\n\t\tnext[i][0]=sta.top().number;\n\t\tsta.push((node){i,w[i]});\n\t}\n}\n```\n\n- ### \u7b2c\u4e8c\u6b65\uff0c\u5229\u7528\u500d\u589e\u7684\u601d\u60f3\u6c42\u51fa\u4ece\u4e0b\u5f80\u4e0a\u7b2cj\u4e2a\u76d8\u5b50\u5f80\u4e0b\u6d41\uff0c\u6d41\u8fc7$2^i$\u4e2a\u76d8\u5b50\u4e4b\u540e\u4f1a\u505c\u7559\u5728\u54ea\u91cc\u3002\n\n\u9012\u63a8\u5373\u53ef\u3002\u7b54\u6848\u50a8\u5b58\u5728 $next[j][i]$ \u4e2d\uff0ci\u3001j\u542b\u4e49\u540c\u4e0a\u3002\n\n```cpp\nfor(int i=1;i<=size;i++){\n\tfor(int j=1;j<=m;j++){\n\t\tnext[j][i]=next[next[j][i-1]][i-1];\n\t}\n}\n```\n\n- ### \u7b2c\u4e09\u6b65\uff0c\u8fd8\u662f\u5229\u7528\u500d\u589e\u7684\u601d\u60f3\uff0c\u6c42\u51fa\u4ece\u4e0b\u5f80\u4e0a\u7b2cj\u4e2a\u76d8\u5b50\u6d41\u8fc7$2^i$\u4e2a\u76d8\u5b50\u9700\u8981\u591a\u5c11\u6c34\u3002\n\n```cpp\nint need[N][M];\nvoid init_need(){\n\tfor(int i=1;i<=m;i++)need[i][0]=c[i];\n\tfor(int i=1;i<=size;i++){\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tneed[j][i]=need[j][i-1]+need[next[j][i-1]][i-1];\n\t\t}\n\t}\n}\n```\n\n- ### \u7b2c\u56db\u6b65\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8be2\u95ee\u5904\u7406\u5373\u53ef\n\n```cpp\nint now=0;\nfor(int i=size;i>=0;i--){\n\tif(now+need[wh][i]<th){\n\t\tnow+=need[wh][i];\n\t\twh=next[wh][i];\n\t}\n}\n```\n\n### \u5b8c\u6574\u4ee3\u7801\uff1a\n- \u7531\u4e8e\u8f93\u5165\u7684\u65f6\u5019\u662f\u4ece\u4e0a\u5f80\u4e0b\u4e00\u4e2a\u4e00\u4e2a\u76d8\u5b50\u8f93\u5165\u7684\uff0c\u800c\u672c\u4eba\u4e60\u60ef\u4ece\u4e0b\u5f80\u4e0a\u5b58\u50a8\uff0c\u6240\u4ee5\u5728\u8f93\u5165\u548c\u8be2\u95ee\u7684\u65f6\u5019\u4e0b\u6807\u6709\u4e00\u4e9b\u5c0f\u5904\u7406\u3002\n- $size$\u610f\u601d\u662f\u6700\u5927\u7684$size$\u4f7f\u5f97$2^{size}\\le m$\u3002\n\n```cpp\n#include<cstdio>\n#include<stack>\n#define int long long\nusing namespace std;\nconst int N=100010;\nconst int M=25;\n\ninline void read(int &wh){\n    wh=0;int f=1;char w=getchar();\n    while(w<'0'||w>'9'){if(w=='-')f=-1;w=getchar();}\n    while(w<='9'&&w>='0'){wh=wh*10+w-'0';w=getchar(); }\n    wh*=f;return;\n}\n\nint m,n,size,w[N],c[N];\n \nint next[N][M];\nstruct node{int number,data;};\nstack<node>sta;\nvoid init_next(){\n\tsta.push((node){0,1e18});\n\tfor(int i=1;i<=m;i++){\n\t\twhile(!sta.empty()&&sta.top().data<=w[i])sta.pop();\n\t\tnext[i][0]=sta.top().number;\n\t\tsta.push((node){i,w[i]});\n\t}\n\twhile(!sta.empty())sta.pop();\n\t\n\tfor(int i=1;i<=size;i++){\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tnext[j][i]=next[next[j][i-1]][i-1];\n\t\t}\n\t}\n}\n\nint need[N][M];\nvoid init_need(){\n\tfor(int i=1;i<=m;i++)need[i][0]=c[i];\n\tfor(int i=1;i<=size;i++){\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tneed[j][i]=need[j][i-1]+need[next[j][i-1]][i-1];\n\t\t}\n\t}\n}\n\nsigned main(){\n\t\n\tread(m);read(n);\n\t\n\twhile((1<<size)-1<m)size++;size--;\n\t\n\tfor(int i=1;i<=m;i++){\n\t\tread(w[m-i+1]);read(c[m-i+1]);\n\t}\n\tinit_next();\n\tinit_need();\n\twhile(n--){\n\t\tint wh,th;\n\t\tread(wh);read(th);\n\t\twh=m-wh+1;\n\t\tint now=0;\n\t\tfor(int i=size;i>=0;i--){\n\t\t\tif(now+need[wh][i]<th){\n\t\t\t\tnow+=need[wh][i];\n\t\t\t\twh=next[wh][i];\n\t\t\t}\n\t\t}\n\t\t\n\t\tif(wh==0)printf(\"0\\n\");\n\t\telse printf(\"%lld\\n\",m-wh+1);\n\t}\n\t\n\treturn 0;\n} \n```\n~~\u4e2a\u4eba\u8ba4\u4e3a\u81ea\u5df1\u7684\u7801\u98ce\u8fd8\u6bd4\u8f83\u6613\u61c2\u2026\u2026~~",
        "postTime": 1619157442,
        "uid": 302383,
        "name": "Feyn",
        "ccfLevel": 0,
        "title": "P7167\u9898\u89e3"
    },
    {
        "content": "\u5229\u7528\u5355\u8c03\u6808\u6c42\u51fa\u5bf9\u6bcf\u4e2a\u5706\u76d8\u6c42\u51fa\u7b2c\u4e00\u4e2a\u6bd4\u8be5\u5706\u76d8\u5927\u7684\u5706\u76d8\u4fe1\u606f\uff08\u7f16\u53f7\u548c\u5bb9\u91cf\uff09\uff0c\u4e3a\u8fdb\u884c\u500d\u589e\u64cd\u4f5c\u7684\u6570\u7ec4\u8d4b\u597d\u521d\u503c\uff0c\u7136\u540e\u501f\u52a9\u500d\u589e\u627e\u51fa\u4e00\u4e2a\u5706\u76d8\u4e0e\u4f4e\u4e8e\u81ea\u5df1\u7684\u5706\u76d8\u4e4b\u95f4\u7684\u5927\u5c0f\u5173\u7cfb\uff0c\u6700\u7ec8\u6839\u636e\u6bcf\u6b21\u8f93\u5165\u7684\u5706\u76d8\u4fe1\u606f\uff0c\u4ece\u5927\u5230\u5c0f\u4f9d\u6b21\u51cf\u6389\u4e0e\u8be5\u5706\u76d8\u76f8\u5173\u8054\u7684\u5706\u76d8\u5bb9\u91cf\uff0c\u8be6\u89c1\u4ee3\u7801\n```cpp\n#include<iostream>\n#include<stdio.h>\n#include<math.h>\n#include<algorithm>\n#include<map>\n#include<string.h>\n#include<queue>\n#define ll long long\n#define debug cout<<\"FUCK\"<<endl;\nusing namespace std;\nconst int logn=20;\nint n,q,top,f[100005][logn+1],stk[100005],id[100005][logn+1],d[100005],c[100005];\nint main(){\n\tcin>>n>>q;\n\tfor(int i=1;i<=n;i++){//\u6ce8\u610f\u8fd9\u91cci\u8d8a\u5927\uff0c\u5706\u76d8\u8d8a\u4f4e \n\t\tcin>>d[i]>>c[i];\t\t\n\t}\n\tfor(int i=n;i>=1;i--){\n\t\twhile(top&&d[stk[top]]<=d[i])top--;\n\t\tid[i][0]=stk[top];//\u4fdd\u5b58\u7b2c\u4e00\u4e2a\u534a\u5f84\u6bd4\u81ea\u5df1\u5927\u7684\u5706\u76d8\u7f16\u53f7 \n\t\tf[i][0]=c[i];//\u5bb9\u91cf\u521d\u503c\u4e3a\u81ea\u5df1\u7684\u5bb9\u91cf \n\t\t//id\u4e3a\u7f16\u53f7\uff0cf\u4e3a\u5bb9\u91cf,\u7b2cid[i][j]\u4e2a\u5706\u76d8\u5fc5\u5b9a\u4f4e\u4e8ei\u4e14j\u8d8a\u5927\u8d8a\u4f4e \n\t\tstk[++top]=i;\n\t}\n\tfor(int j=1;j<=logn;j++){//\u500d\u589e\u627e\u51fa\u534a\u5f84\u5927\u4e8e\u7b2ci\u4e2a\u5706\u76d8\u7684\u5706\u76d8\u4e2d\u7b2c2^j\u5927\u7684\uff08j\u8d8a\u5927,\u7b2cid[i][j]\u7684\u534a\u5f84\u8d8a\u5927\uff09,\u5e76\u4fdd\u5b58\u5176\u7f16\u53f7 \n\t\tfor(int i=1;i<=n;i++){\n\t\t\tid[i][j]=id[id[i][j-1]][j-1],f[i][j]=f[i][j-1]+f[id[i][j-1]][j-1];\n\t\t}\n\t}\n\twhile(q--){\n\t\tint ri,vi;\n\t\tcin>>ri>>vi;\n\t\tfor(int i=20;i>=0;i--){//\u6839\u636e\u500d\u589e\u4fe1\u606f\uff0c\u4ece\u6700\u4f4e\u3001\u534a\u5f84\u6700\u5927\u7684\u5706\u76d8\u5f00\u59cb\u4ece\u4e0b\u5f80\u4e0a\u505a\uff0c\u4f9d\u6b21\u9012\u51cf \n\t\t\tif(vi>f[ri][i])vi-=f[ri][i],ri=id[ri][i]; //\u5982\u679c\u8df3\u5230\u5934\u4e86\uff0c\u4ecd\u6ca1\u6709\u6d41\u5b8c\uff0cid\u6570\u7ec4\u672a\u8d4b\u503c\uff0cri\u4f1a\u81ea\u5df1\u53d8\u62100 \n\t\t}\n\t\tcout<<ri<<endl;\n\t}\n\treturn 0;\n}\n\n```\n",
        "postTime": 1614324553,
        "uid": 181037,
        "name": "ysmlwudia",
        "ccfLevel": 0,
        "title": "\u5355\u8c03\u6808+\u500d\u589e"
    },
    {
        "content": "\u89c2\u5bdf\u672c\u9898\u9898\u5e72\uff0c\u53d1\u73b0\u5236\u7ea6\u6c34\u6700\u7ec8\u7684\u53bb\u5904\u7684\u4e3a\u76d8\u5b50\u7684\u76f4\u5f84\u4e0e\u5bb9\u91cf\u3002\u82e5\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\uff0c\u90fd\u76f4\u63a5\u66b4\u529b\u8ba1\u7b97\uff0c\u663e\u7136\u4f1a\u8d85\u65f6\u3002\u4e8e\u662f\u60f3\u5230\u4e00\u79cd\u80fd\u591f\u51cf\u5c11\u5224\u65ad\u6b21\u6570\uff0c\u53c8\u4e0d\u5f71\u54cd\u7ed3\u679c\u7684\u65b9\u6cd5--\u500d\u589e\u3002\n\n\u9996\u5148\u9884\u5904\u7406\u51fa\u4ece\u7b2c $i$ \u4e2a\u5706\u76d8\u5f00\u59cb\u8fde\u7eed $2^j$ \u4e2a\u5706\u76d8\u4e2d\u7684\u6700\u5927\u76f4\u5f84\uff0c\u8bb0\u4e3a $pre_{i,j}$\u3002\u663e\u7136 $\\forall i \\in [1,n],pre_{i,0} = d_i$\u3002\u7136\u540e\u5c31\u662f\u500d\u589e\u6c42\u6700\u503c\u7684\u8fc7\u7a0b\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8d58\u8ff0\u4e86\u3002\u7136\u540e\u7ed9\u51fa $f_{i,j},g_{i,j}$\uff0c\u5206\u522b\u8868\u793a\u4ece $i$ \u5f00\u59cb\u6c34\u6ea2\u51fa $2^j$ \u6b21\u540e\u6240\u5230\u8fbe\u7684\u5706\u76d8\u4e0e\u6c42\u6c34\u6ea2\u51fa\u6240\u5230\u8fbe\u7684 $2^j$ \u4e2a\u5706\u76d8\u7684\u5bb9\u91cf\u4e4b\u548c\u3002\n\n\u4f46\u662f\u73b0\u5728\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u6bcf\u6b21\u904d\u5386\u53bb\u6c42\u7b2c $i$ \u4e2a\u5706\u76d8\u518d\u52a0\u5165\u6c34\u540e\uff0c\u6700\u7ec8\u80fd\u6d41\u5230\u7684\u5706\u76d8\uff0c\u4f1a\u989d\u5916\u4ea7\u751f $O(N)$ \u7684\u590d\u6742\u5ea6\uff0c\u52a0\u4e0a\u5bf9\u6240\u6709\u5706\u76d8\u7684\u6c42\u89e3\u4ee5\u53ca\u9884\u5904\u7406\u540e\u7684\u67e5\u8be2\uff0c\u4f1a\u8fbe\u5230 $O(N^2 \\log N)$ \u7684\u590d\u6742\u5ea6\uff0c\u65e0\u6cd5\u901a\u8fc7\u6b64\u9898\u3002\u4e0d\u96be\u53d1\u73b0\uff0c\u8fd9\u5176\u5b9e\u5b58\u5728\u5355\u8c03\u6027\uff0c\u56e0\u6b64\u4f7f\u7528\u4e8c\u5206\u7b54\u6848\u53bb\u6c42\u89e3\u3002\u8bbe\u9884\u5904\u7406\u7684\u67e5\u8be2\u51fd\u6570\u4e3a `query (l,r)`\uff0c\u5219\u6709\u6ee1\u8db3 `query(i + 1,(l + r) >> 1) <= d[i]` \u7684\u65f6\u5019\u66f4\u65b0\u5de6\u7aef\u70b9\u4e3a `l = ((l + r) >> 1) + 1`\uff0c\u5426\u5219\u4e3a `r = (l + r) >> 1`\u3002\u5728\u5f97\u5230\u7b54\u6848 $l$ \u540e\uff0c\u5c31\u53ef\u4ee5\u6839\u636e\u53d8\u91cf\u8bbe\u7f6e\u7684\u542b\u4e49\u53bb\u66f4\u65b0 $f_{i,0},g_{i,0}$\uff0c\u6709 $f_{i,0} = l,g_{i,0} = c_{f_{i,0}}$\u3002\n\n\u7531\u4e8e $N_{\\max} = 10^5$\uff0c\u6240\u4ee5\u672c\u9898\u89e3\u5c06\u4e24\u4e2a\u6570\u7ec4\u8bbe\u7f6e\u4e3a `f[100005][20],g[100005][20]`\u3002\u5219\u5bf9\u4e8e $f_{i,j},g_{i,j}$ \u7684\u8f6c\u79fb\u6709\uff1a\n\n```cpp\nfor (int j = 1;j < 20;++j)\n\t\tfor (int i = 1;i <= n;++i)//i~i + 2^j = i ~ 2^(j - 1) + (i + 2^(j - 1) + 1)~2^j\n\t\t\tf[i][j] = f[f[i][j - 1]][j - 1],g[i][j] = g[f[i][j - 1]][j - 1] + g[i][j - 1];\n```\n\n\u6700\u540e\u5c31\u662f\u6c42\u89e3\u7684\u90e8\u5206\u4e86\u3002\u8003\u8651\u5230\u9898\u76ee\u5b58\u5728\u6d41\u5230\u6700\u7ec8\u7684\u6c34\u6c60\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u518d\u52a0\u5165\u4e00\u4e2a\u5bb9\u79ef\u4e3a $\\inf$ \u7684\u5706\u76d8\u3002\u5bf9\u4e8e\u6bcf\u4e00\u7ec4\u7684\u8be2\u95ee\uff0c\u9996\u5148\u5224\u65ad\u6c34\u80fd\u5426\u6ea2\u51fa\uff0c\u82e5\u53ef\u4ee5\uff0c\u5219\u5229\u7528\u500d\u589e\u8fdb\u884c\u5904\u7406\u76f4\u81f3\u65e0\u6cd5\u6ea2\u51fa\uff0c\u6700\u540e\u7279\u5224\u5230\u8fbe\u5e95\u76d8\u7684\u60c5\u51b5\u5373\u53ef\u3002\n\n\u6700\u540e\u5229\u7528\u500d\u589e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n \\log n)$\u3002\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\n#include <cstring>\n#define init(x) memset (x,0,sizeof (x))\n#define ll long long\n#define ull unsigned long long\n#define INF 0x3f3f3f3f\nusing namespace std;\nconst int MAX = 1e5 + 5;\nconst int MOD = 1e9 + 7;\ninline int read ();\nint n,m,d[MAX],c[MAX];\nint pre[MAX][20],f[MAX][20],g[MAX][20];\n/*pre \u9884\u5904\u7406\u6c42\u533a\u95f4\u6700\u503c \nf \u6c42\u4ece i \u5f00\u59cb\u6c34\u6ea2\u51fa 2^j \u6b21\u540e\u6240\u5230\u8fbe\u7684\u5706\u76d8\ng \u6c42\u6c34\u6ea2\u51fa\u6240\u5230\u8fbe\u7684 2^j \u4e2a\u5706\u76d8\u7684\u5bb9\u91cf\u4e4b\u548c */ \nint query (int x,int y);\nint main ()\n{\n\t//freopen (\".in\",\"r\",stdin);\n\t//freopen (\".out\",\"w\",stdout);\n\tn = read ();m = read ();\n\tfor (int i = 1;i <= n;++i) d[i] = read (),c[i] = read ();\n\tfor (int i = 1;i <= n;++i) pre[i][0] = d[i];//\u521d\u59cb\u5316 \n\tfor (int j = 1;(1 << j) <= n;++j)//\u500d\u589e\u6c42\u533a\u95f4\u6700\u503c \n\t\tfor (int i = 1;i + (1 << j) - 1 <= n;++i)\n\t\t\tpre[i][j] = max (pre[i][j - 1],pre[i + (1 << (j - 1))][j - 1]);\n\tc[n + 1] = INF;f[n][0] = n + 1;g[n][0] = c[f[n][0]];//\u52a0\u5165\u4e00\u4e2a\u8d85\u5927\u5bb9\u79ef\u7684\u5e95\u76d8 \n\tfor (int i = 1;i < n;++i)\n\t{\n\t\tint l = i + 1,r = n + 1;\n\t\twhile (l < r)//\u4e8c\u5206\u6c42\u4f1a\u6d41\u5165\u4f55\u5904 \n\t\t{\n\t\t\tint mid = (l + r) >> 1;\n\t\t\tif (query (i + 1,mid) <= d[i]) l = mid + 1;//log \u7684\u67e5\u8be2 \n\t\t\telse r = mid;\n\t\t}\n\t\tf[i][0] = l;\n\t\tg[i][0] = c[f[i][0]];//\u521d\u59cb\u5316 \n\t}\n\tfor (int j = 1;j < 20;++j)\n\t\tfor (int i = 1;i <= n;++i)\n\t\t\tf[i][j] = f[f[i][j - 1]][j - 1],g[i][j] = g[f[i][j - 1]][j - 1] + g[i][j - 1];\n\tfor (int i = 1;i <= m;++i)\n\t{\n\t\tint x = read (),y = read ();\n\t\tif (y > c[x])\n\t\t{\n\t\t\ty -= c[x];\n\t\t\tfor (int j = 19;j >= 0;--j)\n\t\t\t\tif (y > g[x][j]) y -= g[x][j],x = f[x][j];\n\t\t\tx = f[x][0];//\u6ce8\u610f\u522b\u5fd8\u4e86\u51cf\u53bb\u4e00\u5f00\u59cb\u6ea2\u51fa\u7684\u90a3\u4e00\u6b21 \n\t\t}\n\t\tprintf (\"%d\\n\",x == (n + 1) ? 0 : x);//\u7279\u5224 \n\t}\n\treturn 0;\n}\ninline int read ()\n{\n    int s = 0;int f = 1;\n    char ch = getchar ();\n    while ((ch < '0' || ch > '9') && ch != EOF)\n\t{\n        if (ch == '-') f = -1;\n        ch = getchar ();\n    }\n    while (ch >= '0' && ch <= '9')\n\t{\n        s = s * 10 + ch - '0';\n        ch = getchar ();\n    }\n    return s * f;\n}\nint query (int x,int y)\n{\n\tint k = (int) log2 (y - x + 1);\n\treturn max (pre[x][k],pre[y - (1 << k) + 1][k]);\n}\n```",
        "postTime": 1650898028,
        "uid": 183603,
        "name": "SUNCHAOYI",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011P7167 [eJOI 2020 Day1] Fountain"
    },
    {
        "content": "\u8003\u8bd5\u7684\u4e00\u9053\u9898\uff0c\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0sb\u4e86\u5e38\u6570\u7ffb\u4e86\u597d\u51e0\u500d/px\n\n\u9996\u5148\u6211\u4eec\u53d1\u73b0\uff0c\u4e00\u4e2a\u6c34\u6c60\u7684\u6c34\u53ea\u4f1a\u5411\u5b83\u4e0b\u8fb9\u7b2c\u4e00\u4e2a\u76f4\u5f84\u6bd4\u5b83\u5927\u7684\u6c34\u6c60\u6d41\u3002\n\n\u6211\u4eec\u628a\u8fd9\u4e9b\u6d41\u52a8\u7684\u5173\u7cfb\u8fde\u8fb9\uff0c\u5f88\u5bb9\u6613\u53d1\u73b0\u662f\u4e00\u68f5\u6811\u3002\n\n\u95ee\u6c34\u6700\u540e\u4f1a\u5230\u54ea\u4e2a\u6c34\u6c60\u76f8\u5f53\u4e8e\u5728\u95ee\u6700\u8001\u7684\u4e00\u4e2a\u7956\u5148\uff0c\u4f7f\u5f97\u81ea\u5df1\u5230\u7956\u5148\u4e0a\u7684\u70b9\u6743\u4e4b\u548c\u4e0d\u5927\u4e8e\u7ed9\u5b9a\u7684\u6570\u3002\u7136\u540e\u5bb9\u6613\u53d1\u73b0\u662f\u6811\u4e0a\u500d\u589e\u3002\n\n\u7136\u540e\uff0c\u5176\u5b9e\u627e\u53f3\u8fb9\u7b2c\u4e00\u4e2a\u6bd4\u81ea\u5df1\u5927\u7684\u6570\u53ef\u4ee5\u7528\u5355\u8c03\u6808 $ O(n) $\uff0c\u7136\u800c\u6211\u7528\u4e86 $ O(n\\log n) $ \u7684\u500d\u589e+ST\u8868\u3002\u3002\u3002\n\n\u5176\u6b21\uff0c\u53ef\u4ee5\u76f4\u63a5\u500d\u589e\uff0c\u7136\u540e\u6211\u5efa\u4e86\u6811\u3002\u3002\u3002\n\n\u9644\u4e0a\u8003\u573a\u4e0a\u7684\u4ee3\u7801\uff1a\n```cpp\n#include<cstdio>\nconst int M=1e5+5;\ntypedef long long ll;\nint n,m,a[M],d[M],b[M],lg2[M],f[M][22],st[M][22];\nll s[M];\nstruct Edge{\n\tint to;Edge*nx;\n}e[M<<1],*h[M],*cnt=e;\ninline int max(const int&a,const int&b){\n\treturn a>b?a:b;\n}\ninline void Add(const int&u,const int&v){\n\t*cnt=(Edge){v,h[u]};h[u]=cnt++;\n}\nvoid DFS(int u){\n\td[u]=d[f[u][0]]+1;\n\tfor(int i=1;f[u][i-1];++i)f[u][i]=f[f[u][i-1]][i-1];\n\tfor(Edge*E=h[u];E;E=E->nx){\n\t\tint v=E->to;\n\t\ts[v]=s[u]+b[v];DFS(v);\n\t}\n}\nint Find(int u,int val){\n\tfor(int k=21;k>=0;--k){\n\t\tif(s[u]-s[f[u][k]]<val)val-=s[u]-s[f[u][k]],u=f[u][k];\n\t}\n\treturn u;\n}\nint main(){\n\tregister int i,j,A,B,now;\n\tscanf(\"%d%d\",&n,&m);lg2[0]=-1;\n\tfor(i=1;i<=n;++i){\n\t\tscanf(\"%d%d\",a+i,b+i);st[i][0]=a[i];\n\t\tlg2[i]=lg2[i>>1]+1;\n\t}\n\tfor(j=1;(1<<j)<=n;++j){\n\t\tfor(i=1;i+(1<<j)-1<=n;++i){\n\t\t\tst[i][j]=max(st[i][j-1],st[i+(1<<j-1)][j-1]);\n\t\t}\n\t}\n\tfor(i=1;i<=n;++i){\n\t\tnow=i;\n\t\tfor(j=21;j>=0;--j){\n\t\t\tif(now+(1<<j)-1<=n&&st[now][j]<=a[i])now+=1<<j;\n\t\t}\n\t\tif(now==n+1)now=0;\n\t\tAdd(f[i][0]=now,i);\n\t}\n\tDFS(0);\n\tfor(i=1;i<=m;++i){\n\t\tscanf(\"%d%d\",&A,&B);\n\t\tprintf(\"%d\\n\",Find(A,B));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1619006619,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u6570\u8bba \u6811\u4e0a\u500d\u589e P7167\u9898\u89e3"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://loj.ac/p/3373)\n\n\u663e\u7136\u590d\u6742\u5ea6\u8981\u6c42$O(nlogn)$\u4ee5\u4e0b\n\n---\n\n![](https://loj-img.upyun.menci.memset0.cn/2020/10/22/5f913c2eaad64.png)\n\n\u4e00\u4e2a\u50a8\u6c34\u88c5\u7f6e\u6ee1\u4e86\u4e00\u5b9a\u4f1a\u6d41\u5230\u56fa\u5b9a\u7684\u53e6\u4e00\u4e2a\u50a8\u6c34\u88c5\u7f6e\n\n\u5982\u56fe\u4e2d1\u4f1a\u6d41\u52302\uff0c2\u4f1a\u6d41\u52305 \uff0c6\u4f1a\u6d41\u5230\u5730\u9762\u53730\u3002\n\n\u6240\u4ee5\u7528\u4e00\u4e2a$Fa[i]$\u8868\u793a\u7b2c$i$\u4e2a\u50a8\u6c34\u88c5\u7f6e\u4f1a\u6d41\u5230\u7b2c\u51e0\u4e2a\u50a8\u6c34\u88c5\u7f6e\u3002\n\n\u7b97$Fa[i]$\u7684\u65b9\u6cd5\uff1a\n\n\u7528\u4e00\u4e2a\u5c0f\u6839\u5806\u5c06\u6ca1\u627e\u5230$Fa[i]$\u7684\u50a8\u6c34\u88c5\u7f6e\u7684\u4fe1\u606f\u5b58\u8d77\u6765\u3002\n\n\u4ee5$c[i]$\u6392\u5e8f\u3002\n\n\u7136\u540e\u53d1\u73b0\u65b0\u7684$c[i]$\u6bd4\u5806\u5934\u5927\uff0c\n\n\u5c31\u8ba9$Fa[$\u5806\u5934\u7684\u7f16\u53f7$]=i$\u3002\n\n\u7528\u5230\u4e86\u7ed3\u6784\u4f53\u641e\u5f97\u590d\u6742\u4e86\u4e00\u70b9\u3002\n\n\u4ee3\u7801:\n\n```cpp\n#include <queue>\n#include <iostream>\n\nusing namespace std;\n\nstruct cilcle\n{\n    int h,w,id;\n};\nbool operator<(cilcle a,cilcle b)\n{\n    return a.h<b.h;\n}\nbool operator>(cilcle a,cilcle b)\n{\n    return a.h>b.h;\n}\npriority_queue <cilcle,vector<cilcle>,greater<cilcle> > q;\nint n,m;\nint c[100005],d[100005];\nint fa[100005];\nvoid make_fa()\n{\n    int i,j,k;\n    for(i=1;i<=n;i++)\n    {\n        cin>>c[i]>>d[i];\n        if(!q.empty())\n        {\n            while(q.top().h<c[i]&&( !q.empty() ) )\n            {\n                fa[q.top().id]=i;\n                q.pop();\n            }\n        }\n        cilcle pig;\n        pig.h=c[i];\n        pig.w=d[i];\n        pig.id=i;\n        q.push(pig);\n    }\n                                 \n                                 \n                                 }\n```\n\n\n------\n\n\u5b9e\u9645\u4e0a\u4f1a\u53d1\u73b0\u8fd9\u662f\u4e00\u9897\u4ee5\u5730\u9762\u53730\u4e3a\u6839\u8282\u70b9\u7684\u4e00\u9897\u6811\u3002\n\n\u6bcf\u4e2a\u70b9\u7684\u70b9\u6743\u5c31\u662f$d[i]$\u3002\n\n\u8be2\u95ee\u7684\u5c31\u662f\u4ece\u70b9$R$\u5411\u4e0a\u722c\uff0c\u5728\u7ecf\u8fc7\u7684\u70b9\u7684\u70b9\u6743\u548c\u4e0d\u8d85\u8fc7$V$\uff0c\n\n\u7684\u60c5\u51b5\u4e0b\u6700\u9ad8\u80fd\u722c\u5230\u7b2c\u51e0\u4e2a\u70b9\u3002\n\n\u9a6c\u4e0a\u60f3\u5230ST\u8868+\u500d\u589e\u3002\n\n\u7528$stp[i][j]$\u5b58$i$\u5411\u4e0a\u722c$2^j$\u6761\u8fb9\u5230\u51e0\u53f7\u70b9\u3002\n\n\u7528$stw[i][j]$\u5b58$i$\u5411\u4e0a\u722c\u5230$stp[i][j]$\u7684\u70b9\u6743\u548c\u3002\n\n\u4f46\u662f\u4e0d\u5305\u62ec$stp[i][j]$\u7684\u70b9\u6743\u3002\n\n\n\u6709\uff1a\n\n$stp[i][0]=fa[i];$\n\n$stw[i][0]=d[i];$\n\n$stp[i][j]=stp[stp[i][j-1]][j-1];$\n\n$stw[i][j]=stw[i][j-1]+stw[stp[i][j-1]][j-1];$\n\n\u4ee3\u7801\uff1a\n\n```cpp\nvoid make_st()\n{\n    int i,j,k;\n    for(j=1;j<=22;j++)\n    {\n        for(i=1;i<=n;i++)\n        {\n            stp[i][j]=stp[stp[i][j-1]][j-1];\n            stw[i][j]=stw[i][j-1]+stw[stp[i][j-1]][j-1];\n        }\n    }\n    \n    for(i=1;i<=n;i++)\n    {\n        stp[i][0]=fa[i];\n        stw[i][0]=d[i];\n    }\n}\n```\n\n---\n\n\u7136\u540e\u518d\u662f\u500d\u589e\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\nint query(int x,int y)\n{\n    for(int i=21;i>=0;i--)\n    {\n        if(stp[x][i]!=0&&stw[x][i]<y)\n        {\n            return query(stp[x][i],y-stw[x][i]);\n        }\n    }\n    if(fa[x]==0&&y>d[x])return 0;\n    return x;\n}\n```\n\n----\n\n\u6574\u4f53\u6765\u8bf4\u8fd9\u9898\u5e76\u4e0d\u9ad8\uff0c\u63d0\u9ad8\u7b2c2.5\u7b80\u5355\u7684\u9898\u5427\u3002\n\n\u6211\u7684\u4ee3\u7801\u628a\u4e00\u4e9b\u7b80\u5355\u7684\u4e1c\u897f\u590d\u6742\u5316\u4e86\u3002\n\n\u505a\u7684\u65f6\u5019\u8111\u5b50\u7cca\u6d82\u4e86\uff0c\u4e8e\u662f\u500d\u589e\u7528\u9012\u5f52\u5b9e\u73b0\u7684\u3002\n\n\u5bfc\u81f4\u539f\u672c50\u884c\u7684\u4e1c\u897f\u53d8\u6210100\u591a\u884c\u3002\n\n\n\u5b8c\u6574\u4ee3\u7801\uff1a\n\n```cpp\n#include <queue>\n#include <iostream>\n\nusing namespace std;\n\nstruct cilcle\n{\n    int h,w,id;\n};\nbool operator<(cilcle a,cilcle b)\n{\n    return a.h<b.h;\n}\nbool operator>(cilcle a,cilcle b)\n{\n    return a.h>b.h;\n}\npriority_queue <cilcle,vector<cilcle>,greater<cilcle> > q;\nint n,m;\nint c[100005],d[100005];\nint fa[100005];\nint stp[100005][22],stw[100005][22];\nvoid make_fa()\n{\n    int i,j,k;\n    for(i=1;i<=n;i++)\n    {\n        cin>>c[i]>>d[i];\n        stw[i][0]=d[i];\n        if(!q.empty())\n        {\n            while(q.top().h<c[i]&&( !q.empty() ) )\n            {\n                fa[q.top().id]=i;\n                stp[q.top().id][0]=i;\n                q.pop();\n            }\n        }\n        cilcle pig;\n        pig.h=c[i];\n        pig.w=d[i];\n        pig.id=i;\n        q.push(pig);\n    }\n}\nvoid make_st()\n{\n    int i,j,k;\n    for(j=1;j<=22;j++)\n    {\n        for(i=1;i<=n;i++)\n        {\n            stp[i][j]=stp[stp[i][j-1]][j-1];\n            stw[i][j]=stw[i][j-1]+stw[stp[i][j-1]][j-1];\n        }\n    }\n    \n    for(i=1;i<=n;i++)\n    {\n        stp[i][0]=fa[i];\n        stw[i][0]=d[i];\n    }\n}\nint query(int x,int y)\n{\n    for(int i=21;i>=0;i--)\n    {\n        if(stp[x][i]!=0&&stw[x][i]<y)\n        {\n            return query(stp[x][i],y-stw[x][i]);\n        }\n    }\n    if(fa[x]==0&&y>d[x])return 0;\n    return x;\n}\nint main()\n{\n    int i,j,k;\n    cin>>n>>m;\n    make_fa();\n    make_st();\n    for(i=1;i<=m;i++)\n    {\n        int x,y;\n        cin>>x>>y;\n        cout<<query(x,y)<<endl;\n    }\n    return 0;\n}   \n```\n",
        "postTime": 1606375048,
        "uid": 115359,
        "name": "phigy",
        "ccfLevel": 5,
        "title": "#3373. \u300ceJOI2020\u300d\u55b7\u6cc9 \u9898\u89e3"
    },
    {
        "content": "\u7ec3\u4e60\u500d\u589e\u7684\u9898\u3002\n\n\u5148\u5229\u7528\u5355\u8c03\u6808\u6c42\u51fa\u6bcf\u4e2a\u5706\u76d8\u540e\u9762\u7b2c\u4e00\u4e2a\u6bd4\u4ed6\u534a\u5f84\u5927\u7684\u5706\u76d8\u3002\n\n\u5177\u4f53\u89c1[P5788 \u3010\u6a21\u677f\u3011\u5355\u8c03\u6808](https://www.luogu.com.cn/problem/P5788)\n\n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u66b4\u529b\u7684\u8df3\uff0c\u4f46\u662f\u8fd9\u6837\u663e\u7136\u662f\u4f1a\u8d85\u65f6\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u4f7f\u7528\u975e\u5e38\u5de7\u5999\u5730\u500d\u589e\u601d\u60f3\u3002\n\n\u5c31\u662f\u7b97\u51fa\u6765\u6bcf\u4e2a\u55b7\u6cc9\u76d8\u5b50\u6d41 $2^i$ \u4e2a\u76d8\u5b50\u53ef\u4ee5\u6d41\u5230\u54ea\uff0c\u6700\u591a\u53ef\u4ee5\u79ef\u6512\u591a\u5c11\u7684\u6c34\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define pr pair<int,int>\nusing namespace std;\nconst int MA=100005;\nconst int MC=25;\nint n,Q,zu[MA][MC],ke[MA][MC];\nstruct zh{\n\tint x,y;\n}a[MA];\npriority_queue<pr,vector<pr>,greater<pr> > q;\nint cha(int x,int y){\n\tif(a[x].y>=y){\n\t\treturn x;\n\t}\n\ty-=a[x].y;\n\tfor(int i=MC-5;i>=0;i--){\n\t\tif(zu[x][i]!=0&&y>ke[x][i]){\n\t\t\ty-=ke[x][i];x=zu[x][i];\n\t\t}\n\t}\n\treturn zu[x][0];\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&Q);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%d%d\",&a[i].x,&a[i].y);\n\t\twhile(q.empty()==0){\n\t\t\tint he=q.top().first,ha=q.top().second;\n\t\t\tif(he<a[i].x){\n\t\t\t\tzu[ha][0]=i;ke[ha][0]=a[i].y;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tq.pop();\n\t\t}\n\t\tq.push(make_pair(a[i].x,i));\n\t}\n\tfor(int i=1;(1<<i)<=n;i++){\n\t\tfor(int j=1;j+(1<<i)<=n;j++){\n\t\t\tzu[j][i]=zu[zu[j][i-1]][i-1];ke[j][i]=ke[j][i-1]+ke[zu[j][i-1]][i-1];\n\t\t}\n\t}\n\twhile(Q>0){\n\t\t--Q;int x,y;scanf(\"%d%d\",&x,&y);printf(\"%d\\n\",cha(x,y));\t\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1658485124,
        "uid": 393748,
        "name": "JoyJoyGang",
        "ccfLevel": 0,
        "title": "P7167 [eJOI2020 Day1] Fountain"
    }
]