[
    {
        "content": "### \u77e9\u9635\u4f18\u5316DP\n\n\u77e9\u9635\u4e58\u6cd5~~\u51e0\u4e4e~~\u4e0d\u4f1a\uff0c\u6211~~\u778e\u626f~~\u8bc1\u660e\u4e861\u4e2a\u5c0f\u65f6\u624d\u5dee\u4e0d\u591a\u641e\u660e\u767d\u600e\u4e48\u5f04\u3002\n\n1. $DP$\n\t\n    \u8bbe$\\large dp_{i,j}$\u8868\u793a\u8df3\u5230\u7b2c$i$\u884c\u7b2c$j$\u5217\u7684\u65b9\u6848\u6570\u3002\n    \n    \u4e8e\u662f\u6709\u4e86\u4e00\u4e2a\u521d\u6b65\u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff08\u5047\u8bbe$i,j$\u90fd\u4e0d\u4f1a\u8d8a\u754c\uff09\uff1a\n    \n    $\\large dp_{i,j}=dp_{i-1,j-1}+dp_{i,j-1}+dp_{i+1,j-1}+dp_{i-1,j-3}+dp_{i-1,j-5}+...\\ ...$\n    \n    \u5f88\u660e\u663e\uff0c\u5b83\u590d\u6742\u5ea6\u9ad8\uff0c\u4e0d\u65b9\u4fbf\u6c42\u3002\n    \n    \u7136\u540e~~\u624b\u73a9\u4e00\u4e0b~~\u4f60\u5c31\u4f1a\u53d1\u73b0\u540e\u9762\u90a3\u4e00\u5927\u4e32\uff08$dp_{i-1,j-3}+...\\ ...$ \u4ee5\u53ca\u5f80\u540e\u7684\uff09\u8ddf$dp_{i,j-2}$\u76f8\u7b49\u3002\n    \n    \u8bc1\u660e\uff1a\n    \n    \u9996\u5148\uff0c\u5947\u6570+\u5076\u6570\uff082\uff09=\u5947\u6570\uff0c~~\u5c0f\u5b66\u77e5\u8bc6~~\n    \n    \u56e0\u4e3a\u9a6c\u6bcf\u6b21\u53ea\u80fd\u6a2a\u5411\u8df3\u5947\u6570\u683c\uff0c\u6240\u4ee5\u80fd\u4e00\u6b21\u6027\u8fbe\u5230$(i\\ ,\\ j-2)$\u7684\u70b9\u540c\u65f6\u4e5f\u80fd\u4e00\u6b21\u6027\u8fbe\u5230$(i\\ ,\\ j)$\uff0c\u4e14\u6ca1\u6709\u5176\u4ed6\u70b9\uff08\u51fa\u53bb\u7b2c$j-2$\u5217\u4e0a\u7684\u4e09\u4e2a\u70b9\uff09\u80fd\u5230\u8fbe$(i\\ ,\\ j)$\u3002\n    \n    \u7136\u540e\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u5c31\u53d8\u6210\u4e86\n    \n    $\\large dp_{i,j}=dp_{i-1,j-1}+dp_{i,j-1}+dp_{i+1,j-1}+dp_{i,j-2}$\n    \n    \u590d\u6742\u5ea6\u662f$ O(nm)$\u7684\uff0cT\u98de\u3002\n    \n2. \u77e9\u9635\u4f18\u5316\uff1a\n\n\t\u8f6c\u79fb\u77e9\u9635\u7684\u5927\u5c0f\u4e0e$n$\u6709\u5173\u3002\n    \n    \u5982\u679c$n=3$\uff0c\u8f6c\u79fb\u77e9\u9635\u662f\u8fd9\u6837\u54d2\uff1a\n    \n    $\\large\\begin{Bmatrix}\n\t\t1  & 1 & 0 & 1 & 0 & 0\\\\\n\t\t1  & 1 & 1 & 0 & 1 & 0\\\\\n\t\t0  & 1 & 1 & 0 & 0 & 1\\\\\n   \t  1  & 0 & 0 & 0 & 0 & 0\\\\\n   \t  0  & 1 & 0 & 0 & 0 & 0\\\\\n   \t  0  & 0 & 1 & 0 & 0 & 0\\\\\n\t\t\\end{Bmatrix}\n \t  \t\\times \n  \t\t\\begin{Bmatrix}\n\t\tdp_{i,1} \\\\\n\t\tdp_{i,2} \\\\\n\t\tdp_{i,3} \\\\\n   \t  dp_{i-1,1} \\\\\n   \t  dp_{i-1,2} \\\\\n   \t  dp_{i-1,3} \\\\\n\t\t\\end{Bmatrix} \\ \n      = \\ \n  \t\t\\begin{Bmatrix}\n\t\tdp_{i+1,1} \\\\\n\t\tdp_{i+1,2} \\\\\n\t\tdp_{i+1,3} \\\\\n   \t  dp_{i,1} \\\\\n   \t  dp_{i,2} \\\\\n   \t  dp_{i,3} \\\\\n\t\t\\end{Bmatrix}   $\n      \n      \u7136\u540e\u77e9\u9635\u5feb\u901f\u5e42\u6c42\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n        \n3. \u8ba1\u7b97\u7b54\u6848 \n\t\n    \u4f60\u4ee5\u4e3a\u600e\u4e48\u7740\u5c31\u7ed3\u675f\u4e86\u5417\uff1f\n    \n    \u5176\u5b9e\uff0c\u8fd8\u6709\u4e00\u4e2a\u7ec6\u8282\u95ee\u9898\u6ca1\u6709\u6ce8\u610f\u5230\uff1a\n    \n    \u5f53$i=1,j=3$\u65f6\uff0c\u56de\u5f52\u8f6c\u79fb\u65b9\u7a0b\u5f0f\uff1a\n    \n    $\\large dp_{1,3}=dp_{1,2}+dp_{1,2}+dp_{1,1}$\n    \n    \u7136\u800c\u8fd9\u65f6\u5019$dp_{1,1}$\u5374\u5e76\u4e0d\u662f\u7531\u524d\u9762\u7684\u70b9\u8f6c\u79fb\u8fc7\u6765\u7684\uff0c\u800c\u662f\u7279\u6b8a\u521d\u503c\uff01\uff01\uff01\n    \n    \u4e5f\u5c31\u662f\u8bf4\u5bf9\u4e8e$dp_{i,j}$\uff0c\u7b54\u6848\u90fd\u6070\u597d\u4f1a\u591a\u7b97$dp_{i,j-2}$\uff08\u8fd9\u91cc\u5982\u679c\u4e0d\u660e\u767d\u53ef\u4ee5\u81ea\u5df1\u624b\u73a9\u51e0\u7ec4\u5c0f\u6570\u636e\uff09\u3002\n    \n    \u7efc\u4e0a\u6240\u8ff0\uff0c\u8bb0\u5f55\u7b54\u6848\u65f6\uff0c\u5e94\u8be5\u6c42$dp_{n,m}-dp_{n,m-2}$\u3002\n    \n    \u5f53\u7136\u4e5f\u53ef\u4ee5\u6c42$dp_{n,m-1}+dp_{n-1,m-1}$\u3002\n    \n\u591a\u8bf4\u4e00\u53e5\uff1a\u4e3a\u4f55\u770b\u7740\u5404\u4f4d\u5927\u4f6c\u7684\u77e9\u9635\u521d\u503c\u90fd\u662f\u5bf9\u89d2\u7ebf\u4e3a1\u554a\uff0c\u5149\u628a$dp_{1,1}$\u521d\u59cb\u5316\u4e3a1\uff0c\u8ba1\u7b97\u7b54\u6848\u65f6\u53ea\u7528\u7b2c\u4e00\u884c\u4e0d\u5c31\u884c\u5417\uff1f~~\u867d\u7136\u6ca1\u591a\u5927\u533a\u522b~~\n\n__\u5bf9\u4e86\uff0c\u7b54\u6848\u522b\u5fd8\u4e86%30011\u3002__\n\ncode\uff08\u6ca1\u5199\u6ce8\u91ca\uff0c~~\u4e2a\u4eba\u8ba4\u4e3a~~\u4e0a\u9762\u5199\u7684\u6bd4\u8f83\u8be6\u7ec6\u4e86\uff09\uff1a\n    \n```\n\n#include<bits/stdc++.h> \n#define p 30011\nusing namespace std;\nint read()\n{\n\tint xsef = 0,yagx = 1;char cejt = getchar();\n\twhile(cejt < '0'||cejt > '9'){if(cejt == '-')yagx = -1;cejt = getchar();}\n\twhile(cejt >= '0'&&cejt <= '9'){xsef = (xsef << 1) + (xsef << 3) + cejt - '0';cejt = getchar();}\n\treturn xsef * yagx;\n}\nint n,m;\nstruct node{\n\tint a[110][110];\n\tnode(){\n\t\tmemset(a, 0, sizeof(a));\n\t}\n}b,c,d;\nnode operator * (node x, node y){\n\tnode z;\n\tfor(int i = 1;i <= n * 2;i++){\n\t\tfor(int j = 1;j <= n * 2;j++){\n\t\t\tfor(int k = 1;k <= n * 2;k++){\n\t\t\t\tz.a[i][j] = (z.a[i][j] + x.a[i][k] * y.a[k][j]) % p;\n\t\t\t}\n\t\t}\n\t}\n\treturn z;\n}\nvoid build(){\n\tfor(int i=1;i<=n;i++){\n\t\t\tif(i!=1)\n\t\t\t\tb.a[i][i-1]=1;\n\t\t\tb.a[i][i]=1;\n\t\t\tif(i!=n)\n\t\t\t\tb.a[i][i+1]=1;\n\t\t}\n\tfor(int i=1;i<=n;i++){\n\t\tb.a[i][i+n]=1;\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tb.a[i+n][i]=1;\n\t}\n}\nvoid ksm(){\n\twhile(m){\n\t\tif(m&1)\n\t\t\tc=c*b;\n\t\tb=b*b;\n\t\tm>>=1;\n\t}\n}\nsigned main(){\n\tn=read(),m=read();\n\tbuild();\n\td = b;\n\tm-=2;\n\tfor(int i=1;i<=n*2;i++)\n\t\tc.a[i][i]=1;\n\tksm();\n\tint ans = -c.a[1][n+n];\n\tc=c*d;\n\tans += c.a[1][n];\n\tprintf(\"%d\",ans + p % p);\n\treturn 0;\n}\n\n```",
        "postTime": 1607868982,
        "uid": 169422,
        "name": "v\u0435ctorwyx",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P3990 \u3010[SHOI2013]\u8d85\u7ea7\u8df3\u9a6c\u3011"
    },
    {
        "content": "\u672c\u9898\u6211\u60f3\u5230\u4e00\u4e2a\u4e0d\u540c\u4e8e\u5176\u4ed6\u4eba\u7684\u4f18\u5316 dp \u7684\u505a\u6cd5\n\n\u8003\u8651\u6211\u4eec\u5c06\u95ee\u9898\u8f6c\u5316\uff0c\u770b\u6210\u4e00\u4e2a\u4e0b\u9762\u7684\u95ee\u9898\uff1a\n\n> \u4e00\u5171\u6709 $s$ \u7684\u65f6\u95f4\uff0c\u53ef\u4ee5\u7528 $t$ \u65f6\u95f4( $t$ \u4e3a\u5947\u6570)\u79fb\u52a8\u5230\u672c\u884c\u6216\u8005\u76f8\u90bb\u884c\uff0c\u95ee\u65b9\u6848\u6570\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u60f3\u5230\u5947\u6570\u5f80\u5f80\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u9650\u5236\u6761\u4ef6\uff0c\u5947\u6570\u65f6\u95f4\u7684\u8df3\u8dc3\u53ef\u4ee5\u770b\u4f5c $2\\times x+1$ \u7684\u8df3\u8dc3\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u5c06\u6bcf\u4e00\u4e2a\u70b9\u5206\u4e3a3\u4e2a\u70b9\uff0c\u5206\u522b\u662f\u5165\u70b9\uff0c\u5947\u6570\u70b9\uff0c\u5076\u6570\u70b9\n\n\u6211\u4eec $2\\times x$ \u7684\u8df3\u8dc3\u53ef\u4ee5\u770b\u4f5c\u5728\u5947\u6570\u70b9\u548c\u5076\u6570\u70b9\u7ec4\u6210\u7684\u73af\u4e0a\u6765\u56de\u8d70\uff0c\u8fd9\u4e5f\u5c31\u53d8\u6210\u4e86\u7c7b\u4f3c\u4e8e\u6c42\u4e24\u4e2a\u70b9\u7ecf\u8fc7 $k$ \u6761\u8fb9\u5230\u8fbe\u7684\u65b9\u6848\u6570\uff0c\u5c31\u76f4\u63a5\u5957\u7528\u77e9\u9635\u4e58\u6cd5\n\n\u4e0b\u9762\u7528\u4e00\u5f20\u56fe\u6765\u8bf4\u660e\u4e00\u4e0b\u62c6\u70b9\u8fc7\u540e\u7684\u8fde\u8fb9\u65b9\u5f0f\uff1a\n\n![](https://s1.ax1x.com/2020/08/21/dYGt9U.png)\n\n(2a\u6709\u4e00\u4e2a\u81ea\u73af\u6211\u753b\u4e0d\u51fa\u6765\u4e86)\n\n\u4e0b\u9762\u662f\u4ee3\u7801\uff1a\n\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <cstring>\n#include <algorithm>\n\nusing namespace std;\n\nint n,m,t;\n\nint mod=30011;\n\nstruct M\n{\n  int s[160][160],r,c;\n  void clear()\n  {\n    for(int i=1;i<=151;i++) for(int j=1;j<=151;j++) s[i][j]=0;\n  }\n}ans,Ye;\n\nM operator * (const M &x,const M &y)\n{\n  M now;\n  now.clear();\n  now.r=x.r;\n  now.c=y.c;\n  for(int i=1;i<=x.r;i++)\n  {\n    for(int k=1;k<=x.c;k++)\n    {\n      for(int j=1;j<=y.c;j++)\n      {\n        now.s[i][j]=(now.s[i][j]+x.s[i][k]*y.s[k][j]%mod)%mod;\n      }\n    }\n  }\n  return now;\n}\n\nM ksm(M a,int b)\n{\n  M ans=a;\n  b--;\n  while(b)\n  {\n    if(b&1) ans=ans*a;\n    a=a*a;\n    b>>=1;\n  }\n  return ans;\n}\n\nint main()\n{\n  scanf(\"%d%d\",&n,&m);\n  ans.clear();\n  ans.r=1;\n  ans.c=3*n;\n  ans.s[1][1]=1;\n  Ye.clear();\n  Ye.r=3*n;\n  Ye.c=3*n;\n  for(int i=1;i<=n;i++)\n  {\n    Ye.s[3*i-2][3*i-1]=1;\n    Ye.s[3*i-1][3*i]=1;\n    Ye.s[3*i][3*i-1]=1;\n    Ye.s[3*i-2][3*i-2]=1;\n    Ye.s[3*i][3*i-2]=1;\n    if(i!=n) Ye.s[3*i-2][3*(i+1)-2]=1;\n    if(i!=1) Ye.s[3*i-2][3*(i-1)-2]=1;\n    if(i!=n) Ye.s[3*i][3*(i+1)-2]=1;\n    if(i!=1) Ye.s[3*i][3*(i-1)-2]=1;\n  }\n  ans=ans*ksm(Ye,m-1);\n  printf(\"%d\\n\",ans.s[1][3*n-2]);\n}\n```\n\n",
        "postTime": 1597976296,
        "uid": 62573,
        "name": "zzqDeco",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3990 \u3010[SHOI2013]\u8d85\u7ea7\u8df3\u9a6c\u3011"
    },
    {
        "content": "### \u524d\u8a00\n\n\u9898\u89e3\u4e2d\u5404\u4f4d\u5927\u4f6c\u7684\u65b9\u6cd5\u597d\u50cf\u90fd\u6709\u70b9\u70e6\u8bf6\n\n\u7a9d\u6765\u4e00\u4e2a\uff08\u4e2a\u4eba\u611f\u89c9\uff09\u6bd4\u8f83\u7b80\u5355\u7684\u65b9\u6cd5\n\n---\n### \u89e3\u6cd5\n\u4f9d\u65e7\u662f\u8003\u8651dp\u65b9\u7a0b\n\n\u4f9d\u65e7\u662f\u8bbe$f[i][j]$\u4e3a\u8df3\u5230$(i,j)$\u7684\u65b9\u6848\u6570\n\n\u5148\u8003\u8651\u4e00\u6b21\u53ea\u80fd\u5f80\u53f3\u8df3\u4e00\u683c\u7684\u60c5\u51b5\n\n\u90a3\u4e48\u65b9\u7a0b\u5f88\u7b80\u5355\n$$\nf[i][j]=f[i-1][j-1]+f[i-1][j]+f[i-1][j+1]\n$$\n\u90a3\u4e48\u5982\u4f55\u52a0\u4e0a\u4e00\u6b21\u5f80\u53f3\u8df3\u4efb\u610f\u5947\u6570\u683c\u5462\uff1f\n\n\u6211\u4eec\u53d1\u73b0\u9664\u53bb\u53ea\u80fd\u5f80\u53f3\u8df3\u4e00\u683c\u7684\u60c5\u51b5\u5916\uff0c\u6240\u6709\u53ef\u4ee5\u4e00\u6b65\u8df3\u5230$(i,j)$\u7684\u90fd\u53ef\u4ee5\u4e00\u6b65\u8df3\u5230$(i-2,j)$\uff0c\u6240\u6709\u53ef\u4ee5\u4e00\u6b65\u8df3\u5230$(i-2,j)$\u7684\u90fd\u53ef\u4ee5\u4e00\u6b65\u8df3\u5230$(i,j)$\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u7684\u65b9\u7a0b\u5c31\u51fa\u6765\u4e86\uff1a\n$$\nf[i][j]=f[i-1][j-1]+f[i-1][j]+f[i-1][j+1]+f[i-2][j]\n$$\n\u76f4\u63a5\u9012\u63a8\u7684\u590d\u6742\u5ea6$O(nm)$\uff0c\u663e\u7136\u4e0d\u53ef\u4ee5\u63a5\u53d7\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u77e9\u9635\u4f18\u5316\n\n\u6784\u9020\u77e9\u9635\u4e5f\u5f88\u7b80\u5355\uff08\u4ee5$n=4$\u4e3a\u4f8b\uff09\n$$\n\\left(\n\\begin{matrix}\n1&1&0&0&1&0&0&0\\\\\n1&1&1&0&0&1&0&0\\\\\n0&1&1&1&0&0&1&0\\\\\n0&0&1&1&0&0&0&1\\\\\n1&0&0&0&0&0&0&0\\\\\n0&1&0&0&0&0&0&0\\\\\n0&0&1&0&0&0&0&0\\\\\n0&0&0&1&0&0&0&0\n\\end{matrix}\n\\right)\n\\times\n\\left(\n\\begin{matrix}\nf[i-1][1]\\\\\nf[i-1][2]\\\\\nf[i-1][3]\\\\\nf[i-1][4]\\\\\nf[i-2][1]\\\\\nf[i-2][2]\\\\\nf[i-2][3]\\\\\nf[i-2][4]\n\\end{matrix}\n\\right)\n\n=\n\\left(\n\\begin{matrix}\nf[i][1]\\\\\nf[i][2]\\\\\nf[i][3]\\\\\nf[i][4]\\\\\nf[i-1][1]\\\\\nf[i-1][2]\\\\\nf[i-1][3]\\\\\nf[i-1][4]\n\\end{matrix}\n\\right)\n$$\n\u63a5\u4e0b\u6765\uff0c\u77e9\u9635\u5feb\u901f\u5e42\u5c31\u597d\u4e86qwq\n### \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define p 30011\n#define int long long\nusing namespace std;\nint n,m;\nstruct Node\n{\n\tint a[110][110];\n\tNode(int x){memset(a,0,sizeof(a));};\n}e(0),base(0);\nNode operator * (Node x,Node y)\n{\n\tNode ret(0);\n\tfor(int i=1;i<=2*n;i++)\n\t\tfor(int j=1;j<=2*n;j++)\n\t\t\tfor(int k=1;k<=2*n;k++)\n\t\t\t\tret.a[i][j]=(ret.a[i][j]+x.a[i][k]*y.a[k][j]+p)%p;\n\treturn ret;\n}\nNode operator ^ (Node x,int y)\n{\n\tNode ret(0);ret=e;\n\twhile(y)\n\t{\n\t\tif(y%2==1)ret=ret*x;\n\t\tx=x*x;y>>=1;\n\t}\n\treturn ret;\n}\nsigned main()\n{\n\tscanf(\"%lld%lld\",&n,&m);\n\tfor(int i=1;i<=2*n;i++)e.a[i][i]=1;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=max(i-1,1ll);j<=min(i+1,n);j++)\n\t\t\tbase.a[i][j]=1;\n\tfor(int i=1;i<=n;i++)base.a[i][i+n]=1;\n\tfor(int i=1;i<=n;i++)base.a[i+n][i]=1;\n\tif(m==2)//\u4e00\u6ce2\u7279\u5224\uff08\u5e94\u8be5\u5f88\u597d\u7406\u89e3\uff09\n\t{\n\t\tif(n==1||n==2)\n\t\t{\n\t\t\tprintf(\"1\\n\");\n\t\t\treturn 0;\n\t\t}\n\t\tprintf(\"0\\n\");\n\t\treturn 0;\n\t}\n\tif(m==3)\n\t{\n\t\tif(n==1||n==3)\n\t\t{\n\t\t\tprintf(\"1\\n\");\n\t\t\treturn 0;\n\t\t}\n\t\tif(n==2)\n\t\t{\n\t\t\tprintf(\"2\\n\");\n\t\t\treturn 0;\n\t\t}\n\t\tprintf(\"0\\n\");\n\t\treturn 0;\n\t}\n\tbase=base^(m-2);\n\tif(n==1)printf(\"%lld\",(base.a[2*n][1]+base.a[2*n][2])%p);\n\telse if(n==2)printf(\"%lld\",(base.a[2*n][1]*2+base.a[2*n][2]*2+base.a[2*n][n+1]+base.a[2*n][n+2])%p);\n\telse printf(\"%lld\",(base.a[2*n][1]*2+base.a[2*n][2]*2+base.a[2*n][3]+base.a[2*n][n+1]+base.a[2*n][n+2]+p)%p);\n\treturn 0;//\u8f93\u51fa\u65f6\u4e5f\u8981\u7279\u5224\uff08\u8fb9\u754c\u5404\u4f4d\u81ea\u5df1\u601d\u8003\u5427qwq\uff0c\u5176\u5b9e\u8fd8\u662f\u633a\u5751\u7684\uff09\n}\n```",
        "postTime": 1580395965,
        "uid": 65681,
        "name": "UltiMadow",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3990 \u3010[SHOI2013]\u8d85\u7ea7\u8df3\u9a6c\u3011"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P3990)\n\n~~\u8fd9\u9a6c\u8df3\u5f97\u53ef\u771f\u8fdc~~\n\n## dp\n\n\u8bbe $f_{i,j}$ \u8868\u793a\u4ece\u8d77\u70b9\u8d70\u5230\u7b2c $i$ \u884c\u7b2c $j$ \u5217\u7684\u65b9\u6848\u6570\u3002\n\n\u90a3\u4e48\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u663e\u7136\uff1a\n\n$f_{i,j}=f_{i-1,j-1}+f_{i,j-1}+f_{i+1,j-1}$\n\n$+f_{i-1,j-3}+f_{i,j-3}+f_{i+1,j-3}$\n\n$+\\dots$\n\n$+f_{i-1,j\\%2+1}+f_{i,j\\%2+1}+f_{i+1,j\\%2+1}$\n\n\u76f4\u63a5\u8f6c\u79fb\u663e\u7136\u662f\u4e0d\u884c\u7684\uff0c\u65f6\u95f4\u7a7a\u95f4\u90fd\u4f1a\u70b8\u3002\n\n## \u524d\u7f00\u548c\n\n\u6211\u4eec\u53d1\u73b0\u7b2c $j$ \u5217\u7684\u8f6c\u79fb\u8981\u4e48\u548c $1,3,5,\\dots$ \u5217\u6709\u5173\uff0c\u8981\u4e48\u548c $2,4,6,\\dots$ \u6709\u5173\n\n\u90a3\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u524d\u7f00\u548c\u3002\n\n\u8bbe $s_{i,j}=f_{i,j}+f_{i,j-2}+f_{i,j-4}+\\dots+f_{i,j\\%2}$\n\n\u663e\u7136\u6709\uff1a\n\n$s_{i,j}=s_{i,j-2}+f_{i,j}$\n\n\u90a3\u4e48\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u5c31\u80fd\u591f\u5199\u6210\u8fd9\u6837\uff1a\n\n$f_{i,j}=s_{i-1,j-1}+s_{i,j-1}+s_{i+1,j-1}$\n\n\u524d\u7f00\u548c\u6570\u7ec4\u7684\u8f6c\u79fb\u5c31\u53ef\u4ee5\u5199\u6210\u8fd9\u6837\uff1a\n\n$s_{i,j}=s_{i-1,j-1}+s_{i,j-1}+s_{i+1,j-1}+s_{i,j-2}$\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u5728\u65f6\u95f4\u7a7a\u95f4 $O(nm)$ \u7684\u9650\u5236\u4e0b\u6c42\u51fa\u7b54\u6848\u3002\n\n## \u77e9\u9635\u5feb\u901f\u5e42\n\n\u6211\u4eec\u53d1\u73b0\uff0c$s_{j}$ \u7684\u8f6c\u79fb\u53ea\u548c $s_{j-1},s_{j-2}$ \u6709\u5173\uff0c\u800c $n$ \u7684\u8303\u56f4\u7279\u522b\u5c0f\uff0c$m$ \u7684\u8303\u56f4\u6781\u5927\uff0c\u6240\u4ee5\u8003\u8651\u5199\u77e9\u9635\u5feb\u901f\u5e42\u3002\n\n$\\begin{vmatrix}s_{1,j}\\;\\;\\;\\;&s_{2,j}\\;\\;\\;\\;&s_{3,j}&\\;\\dots\\;\\;\\;&s_{n,j}&s_{1,j-1}&s_{2,j-1}&s_{3,j-1}&\\dots&s_{n,j-1}\\end{vmatrix}$ \n\n$\\times$ \u4e00\u4e2a\u77e9\u9635 $=$ \n\n$\\begin{vmatrix}s_{1,j+1}&s_{2,j+1}&s_{3,j+1}&\\dots&s_{n,j+1}&s_{1,j}\\;\\;\\;\\;&s_{2,j}\\;\\;\\;\\;&s_{3,j}&\\;\\dots\\;\\;\\;&s_{n,j}\\end{vmatrix}$\n\n\u6211\u4eec\u628a\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u653e\u8fdb\u53bb\u5c31\u597d\u4e86\uff1a\n\n\u8fd9\u91cc\u4ee5 $n=5$ \u4e3e\u4f8b\uff1a\n\n$\\begin{vmatrix}1&1&0&0&0&1&0&0&0&0\\\\1&1&1&0&0&0&1&0&0&0\\\\0&1&1&1&0&0&0&1&0&0\\\\0&0&1&1&1&0&0&0&1&0\\\\0&0&0&1&1&0&0&0&0&1\\\\1&0&0&0&0&0&0&0&0&0\\\\0&1&0&0&0&0&0&0&0&0\\\\0&0&1&0&0&0&0&0&0&0\\\\0&0&0&1&0&0&0&0&0&0\\\\0&0&0&0&1&0&0&0&0&0\\\\ \\end{vmatrix}$\n\n\u6784\u5efa\u51fa\u6765\u7684\u77e9\u9635\u5927\u6982\u5c31\u662f\u957f\u8fd9\u4e2a\u6837\u5b50\u7684\u3002\n\n\u6ce8\u610f\u8fb9\u754c\u7684\u5224\u65ad\uff0c$m$ \u6bd4\u8f83\u5c0f\u7684\u65f6\u5019\u8981\u7279\u5224\u3002\n\n\u8fd8\u6709\u5c31\u662f\u6211\u4eec\u6c42\u51fa\u6765\u7684\u7b54\u6848\u662f\u524d\u7f00\u548c\uff0c\n\n$Ans=f_{n,m}=s_{n,m}-s_{n,m-2}$\n\n\n## code\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=110,p=30011;\nint n,m;\nstruct Mat{\n\tint r,c;\n\tint mat[N][N];\n\tvoid clear(){\n\t\tmemset(mat,0,sizeof(mat));\n\t\tr=c=0;\n\t}\n\tvoid init(int n){\n\t\tmemset(mat,0,sizeof(mat));\n\t\tfor(int i=1;i<=n;i++)mat[i][i]=1;\n\t\tr=c=n;\n\t}\n};\nMat operator*(Mat a,Mat b){\n\tMat c;\n\tc.clear();\n\tc.r=a.r,c.c=b.c;\n\tfor(int l=1;l<=a.c;l++)\n\t\tfor(int i=1;i<=a.r;i++)\n\t\t\tfor(int j=1;j<=b.c;j++)\n\t\t\t\tc.mat[i][j]=(c.mat[i][j]+a.mat[i][l]*b.mat[l][j]%p)%p;\n\treturn c;\n}\nMat operator^(Mat a,int k){\n    Mat c;\n    c.init(a.r);\n    for(;k;k>>=1,a=a*a)if(k&1)c=c*a;\n    return c;\n}\nint query(int m,int n){\n\tif(m==0)return 0;\n\tMat a,b;\n\ta.clear(),b.clear();\n\ta.r=a.c=b.c=2*n;\n\tb.r=1;\n\tb.mat[1][1]=1;\n\tfor(int i=1;i<=n;i++){\n\t\ta.mat[i][i]=1;\n\t\ta.mat[i+n][i]=1;\n\t\ta.mat[i][i+n]=1;\n\t\tif(i!=1)a.mat[i-1][i]=1;\n\t\tif(i!=n)a.mat[i+1][i]=1;\n\t}\n\tint k=m-1;\n\ta=a^k;\n\ta=b*a;\n\treturn a.mat[1][n];\n}\nsigned main(){\n\tscanf(\"%lld%lld\",&n,&m);\n\tprintf(\"%lld\\n\",(query(m,n)-query(m-2,n)+p)%p);\n}\n```\n\n\u5176\u5b9e\u4e0a\u9762\u6784\u5efa\u77e9\u9635\u7684\u8fc7\u7a0b\u6709\u70b9\u91cd\u590d\u4e86\uff0c\u6784\u5efa\u4e00\u6b21\u5c31\u53ef\u4ee5\u4e86\u3002\n\n~~\u4f46\u662f\u6211\u61d2\u5f97\u6539\u4e86\u3002~~",
        "postTime": 1635045280,
        "uid": 310802,
        "name": "_Diu_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3990 [SHOI2013]\u8d85\u7ea7\u8df3\u9a6c"
    },
    {
        "content": "\u8bbe $f[i][j]$ \u8868\u793a\u8df3\u5230 $(i,j)$ \u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\n$$f[i][j]=\\sum_{k=1}^{\\frac{i}{2}} f[i-2k+1][j-1]+f[i-2k+1][j]+f[i-2k+1][j+1]$$\n\n\u7ef4\u62a4\u4e0e\u5f53\u524d\u5217\u76f8\u5dee\u4e3a\u5076\u6570\u548c\u76f8\u5dee\u4e3a\u5947\u6570\u7684\u7684\u4e24\u4e2a\u524d\u7f00\u548c\n\n\u524d\u7f00\u548c\u7684\u8f6c\u79fb\uff1a\n$s1[i+1][j]=s2[i][j]+s1[i][j-1]+s1[i][j]+s1[i][j+1],s2[i+1][j]=s1[i][j]$\n\n\u53d1\u73b0\u53ef\u4ee5\u7528\u77e9\u4e58\u4f18\u5316\n\n\u6700\u540e\u4e24\u524d\u7f00\u76f8\u51cf\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int mo=30011;int n,m;\nstruct M{\n    int w[105][105];\n    M(){memset(w,0,sizeof(w));}\n    int *operator[](int a){return w[a];}\n    M operator*(M &a){\n        M c;for(int i=1;i<=n;++i) for(int j=1;j<=n;++j) for(int k=1;k<=n;++k)\n        c[i][j]=(c[i][j]+w[i][k]*a[k][j])%mo;return c;\n    }\n}p,x,y;\nM pow(M a,int b){\n    M c;for(int i=1;i<=n;++i) c[i][i]=1;\n    for(;b;b>>=1,a=a*a) if(b&1) c=c*a;return c;\n}\nint main(){\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1;i<=n;++i) p[i][i]=p[i+n][i]=p[i][i+n]=1;\n    for(int i=1;i<n;++i) p[i+1][i]=p[i][i+1]=1;n<<=1,x=pow(p,m-2),y=x*p;\n    return !printf(\"%d\",(y[1][n>>1]-x[1][n]+mo)%mo);\n}\n```",
        "postTime": 1543747794,
        "uid": 9290,
        "name": "quantum11",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3990 \u3010[SHOI2013]\u8d85\u7ea7\u8df3\u9a6c\u3011"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P3990)\n\n\u9996\u5148\u4e0d\u96be\u8bbe$f[i][j]$\u8868\u793a\u8df3\u5230$(i,j)$\u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\u4e0d\u96be\u5f97\u5230\u5982\u4e0b\u8f6c\u79fb\n$$f[i][j]=\\sum\\limits_{k=1}^{\\frac n2}f[i-2k+1][j-1]+f[i-2k+1][j]+f[i-2k+1][j+1]$$\n\u7136\u540e\u7ef4\u62a4\u4e24\u4e2a\u524d\u7f00\u548c$s1,s2$\uff0c\u5206\u522b\u8868\u793a\u4e0e\u5f53\u524d\u5217\u76f8\u5dee\u4e3a\u5076\u6570\u7684\u524d\u7f00\u548c\u4ee5\u53ca\u4e0e\u5f53\u524d\u5217\u76f8\u5dee\u4e3a\u5947\u6570\u7684\u524d\u7f00\u548c\uff0c\u90a3\u4e48\u53ef\u4ee5\u8fd9\u6837\u8f6c\u79fb\n$$s1[i+1][j]=s2[i][j]+s1[i][j-1]+s1[i][j]+s1[i][j+1]$$\n$$s2[i+1][j]=s1[i][j]$$\n\u7136\u800c\u76f4\u63a5\u8f6c\u79fb\u4f1aT\uff0c\u6211\u4eec\u8003\u8651\u7528\u77e9\u9635\u4e58\u6cd5\u6765\u4f18\u5316\u3002\u6784\u9020\u4e00\u4e2a$1*2n$\u7684\u77e9\u9635\u8868\u793a\u7b54\u6848\uff0c\u5de6\u8fb9\u8868\u793a$f[i]$\uff0c\u53f3\u8fb9\u8868\u793a$f[i-1]$\uff0c\u90a3\u4e48\u8981\u6784\u9020\u4e00\u4e2a$2n*2n$\u7684\u8f6c\u79fb\u77e9\u9635\u6ee1\u8db3\u4e58\u4e0a\u4e4b\u540e\u5de6\u8fb9\u53d8\u4e3a$f[i+1]$\uff0c\u53f3\u8fb9\u4e3a$f[i]$\uff0c\u90a3\u4e48\u5927\u6982\u662f\u8fd9\u4e48\u4e2a\u4e1c\u897f\uff08$n=5$\u7684\u60c5\u51b5\uff0c\u56fe\u7247\u7f51\u4e0a\u5077\u7684\uff09\n\n![](https://i.loli.net/2018/12/03/5c04b7a66d37f.png)\n\u7136\u540e\u6700\u540e\u524d\u7f00\u548c\u51cf\u4e00\u51cf\u5c31\u597d\u4e86\n```\n//minamoto\n#include<bits/stdc++.h>\n#define R register int\n#define fp(i,a,b) for(R i=a,T=b+1;i<T;++i)\n#define fd(i,a,b) for(R i=a,T=b-1;i>T;--i)\nusing namespace std;\nconst int P=30011;\nint n,m;\nstruct node{\n    int a[105][105];\n    node(){memset(a,0,sizeof(a));}\n    int *operator [](const R &x){return a[x];}\n    node operator *(node &b){\n        node res;\n        fp(i,1,n)fp(j,1,n)fp(k,1,n)\n        res[i][j]=(res[i][j]+a[i][k]*b[k][j])%P;\n        return res;\n    }\n}I,A,B;\nnode ksm(node x,R y){\n    node res;fp(i,1,n)res[i][i]=1;\n    for(;y;y>>=1,x=x*x)if(y&1)res=res*x;\n    return res;\n}\nint main(){\n//\tfreopen(\"testdata.in\",\"r\",stdin);\n    scanf(\"%d%d\",&n,&m);\n    fp(i,1,n)I[i][i]=I[i+n][i]=I[i][i+n]=1;\n    fp(i,1,n-1)I[i+1][i]=I[i][i+1]=1;\n    n<<=1,A=ksm(I,m-2),B=A*I;\n    printf(\"%d\\n\",(B[1][n>>1]-A[1][n]+P)%P);\n    return 0;\n}\n```",
        "postTime": 1543813115,
        "uid": 41781,
        "name": "bztMinamoto",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3990 \u3010[SHOI2013]\u8d85\u7ea7\u8df3\u9a6c\u3011"
    },
    {
        "content": "# \u9898\u610f\n\n[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P3990)\n\n![](https://img2020.cnblogs.com/blog/2013965/202012/2013965-20201206181446603-2095763553.png)\n\n# \u5206\u6790\n\n## DP\u90e8\u5206\n\n\u8fd9\u9898\u4e4d\u4e00\u770b\u662f\u4e2a\u6c34\u9898...\n\n\u53ef\u4ee5\u5f88\u5feb\u770b\u51fa$DP$\u7684\u505a\u6cd5\n\n\u8bbe$dp[i][j]$\u8868\u793a\u5230\u4e86\u7b2c$i$\u884c\u7b2c$j$\u5217\u7684\u65b9\u6848\u6570\n\n\u90a3\u4e48$dp$\u8f6c\u79fb\u65b9\u7a0b\u5f88\u597d\u5199\u4e86\uff1a\n\n$$\ndp[i][j]=dp[i-1][j]+dp[i-1][j]+dp[i-1][j+1]+dp[i-2][j]\n$$\n\n\u53ef\u80fd\u552f\u4e00\u7684\u96be\u70b9\u5728\u4e8e\u8fd9\u4e2a\u7b2c\u56db\u9879\u5427...\u6211\u8fd9\u91cc\u89e3\u91ca\u4e00\u4e0b\u8fd9\u4e2a\u65b9\u7a0b\u7684\u542b\u4e49\n\n\u6211\u4eec\u5f53\u8fd9\u4e2a\u4f4d\u7f6e\u53ef\u80fd\u7531\u524d\u4e00\u5217\u7684\u4e0a\u4e00\u4e2a\uff0c\u524d\u4e00\u5217\u7684\u8fd9\u4e2a\uff0c\u524d\u4e00\u5217\u7684\u4e0b\u4e00\u4e2a\u4e00\u6b65\u5230\u8fbe\uff08\u56e0\u4e3a\u9650\u5236\u5c31\u662f\u6bcf\u6b21\u53ea\u80fd\u79fb\u52a8\u4e00\u884c\u6216\u8005\u4e0d\u52a8\uff09\n\n\u540c\u65f6\u6211\u4eec\u8003\u8651\u4e00\u6b65\u5230\u8fbe\u8fd9\u4e2a\u4f4d\u7f6e\u7684\u5176\u5b83\u70b9\uff0c\u5bb9\u6613\u53d1\u73b0\u8fd9\u4e9b\u70b9\u90fd\u662f\u53ef\u4ee5\u4e00\u6b65\u5230\u8fbe$(i-2,j)$\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u628a\u5269\u4e0b\u7684\u70b9\u7684\u8d21\u732e\u76f8\u5f53\u4e8e\u5168\u90e8\u90fd\u7b97\u5728\u4e86$(i-2,j)$\u4e0a\u9762\uff0c\u800c\u6ca1\u6709\u5269\u4e0b\u7684\u70b9\u4e00\u5b9a\u5b58\u5728\u4e8e\u524d\u9762\u4e09\u9879\u52a0\u4e0a\u7684\u8d21\u732e\u5f53\u4e2d\n\n\u7136\u540e\u8fd9\u4e2a\u9898\u7684$O(nm)$\u7b97\u6cd5\u5c31\u8fd9\u6837\u505a\u51fa\u6765\u4e86\n\n## \u77e9\u9635\u5feb\u901f\u5e42\n\n\u4f46\u662f\u6211\u4eec\u770b\u5230\u6570\u636e\u8303\u56f4\u65f6\u624d\u77e5\u8fd9\u9898\u5e76\u4e0d\u7b80\u5355...\u6697\u85cf\u6740\u673a...\n\n$m\\leq 10^9$ !!!\n\n\u4f46\u662f\u6211\u4eec\u89c2\u5bdf\u4e00\u4e0b\u4e0a\u9762\u7684$DP$\u8f6c\u79fb\u65b9\u7a0b\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff1a\u5bf9\u4e8e\u6bcf\u4e00\u5217\u6765\u8bf4\uff0c\u5f53\u524d\u8fd9\u4e00\u9879\u53ea\u4f1a\u88ab\u524d\u4e00\u9879\u548c\u524d\u4e24\u9879\u7edf\u8ba1\u5230\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651 ~~\u72b6\u538b~~ \u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316$DP$\n\n\u6211\u4eec\u77e9\u9635\u8981\u8bb0\u5f55\u7684\u5c31\u662f\u4e0a\u4e00\u884c\u548c\u4e0a\u4e24\u884c\u7684\u72b6\u6001\uff0c\u5171$100*100$\n\n\u7136\u540e\u6784\u9020\u7684\u72b6\u6001\u8f6c\u79fb\u77e9\u9635\u5c31\u6309\u7167$DP$\u65b9\u7a0b\u90a3\u6837\u628a\u521d\u59cb\u77e9\u9635\u8d4b\u4e00\u4e0b\u503c\u5c31\u53ef\u4ee5\u4e86\uff0c\u6700\u540e\u7b54\u6848\u4e5f\u4e0d\u96be\u5f97\u51fa\uff0c\u89c1\u4ee3\u7801\u5373\u53ef\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(nlogm*(2n)^3)$\uff0c\u8db3\u4ee5\u901a\u8fc7\u6b64\u9898\n\n# \u4ee3\u7801\n\n\u7a9d\u662f\u770b\u4e86[\u8fd9\u4f4d\u5de8\u4f6c\u7684\u535a\u5ba2](https://www.luogu.com.cn/blog/106024/solution-p3990)\u624d\u5b66\u4f1a\u7684\uff0c\u5982\u6709\u96f7\u540c\u53ea\u662f\u770b\u4e86\u5c31\u611f\u89c9\u5199\u7684\u90fd\u4e00\u6837\u4e86QWQ\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntemplate <typename T>\ninline void read(T &x){\n\tx=0;char ch=getchar();bool f=false;\n\twhile(!isdigit(ch)){if(ch=='-'){f=true;}ch=getchar();}\n\twhile(isdigit(ch)){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}\n\tx=f?-x:x;\n\treturn ;\n}\ntemplate <typename T>\ninline void write(T x){\n\tif(x<0) putchar('-'),x=-x;\n\tif(x>9) write(x/10);\n\tputchar(x%10^48);\n\treturn ;\n}\nconst int N=105,MOD=30011;\nint n,m;\n#define inc(a,b) (a+b>=MOD?a+b-MOD:a+b)\nstruct Matrix{\n\tint a[N][N];\n\tMatrix(){memset(a,0,sizeof(a));}\n\tMatrix operator *(Matrix B){\n\t\tMatrix C;\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tfor(int j=1;j<=n;j++){\n\t\t\t\tfor(int k=1;k<=n;k++){\n\t\t\t\t\tC.a[i][j]=inc(C.a[i][j],a[i][k]*B.a[k][j]%MOD);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn C;\n\t}\n};\nMatrix QuickPow(Matrix A,int y){\n\tMatrix res;\n\tfor(int i=1;i<=n;i++) res.a[i][i]=1;\n\twhile(y){\n\t\tif(y&1) res=res*A;\n\t\tA=A*A;\n\t\ty>>=1;\n\t}\n\treturn res;\n}\nMatrix base;\nint ans1,ans2;\nint main(){\n\tread(n),read(m);\n\tif(m<=2){\n\t\tif(n<=2&&m<=n) puts(\"1\");\n\t\telse puts(\"0\");\n\t\treturn 0;\n\t}\n\tfor(int i=1;i<=n;i++){\n        base.a[i][i-1]=base.a[i][i]=base.a[i][i+n]=base.a[i+n][i]=1;\n        if(i!=n)base.a[i][i+1]=1;\n    }\n    n<<=1;\n    base=QuickPow(base,m-2);\n    n>>=1;\n    if(n==1){\n    \twrite(base.a[1][1]);\n    \treturn 0;\n\t}\n\tint n2=n<<1;\n\tans1=(base.a[1][n2-1]+base.a[2][n2-1]+base.a[n+1][n2-1])%MOD,ans2=(base.a[1][n2]+base.a[2][n2]+base.a[n+1][n2])%MOD;\n\twrite(inc(ans1,ans2)%MOD);\n\treturn 0;\n}\n```",
        "postTime": 1607251866,
        "uid": 130387,
        "name": "_Anchor",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3990 \u3010[SHOI2013]\u8d85\u7ea7\u8df3\u9a6c\u3011"
    },
    {
        "content": "\u5e0c\u4e30\u5c55\uff0c\u770b[\u535a\u5ba2](https://www.cnblogs.com/Z8875/p/13510450.html)\n* \u8fd9\u9898\u9898\u610f\u5f88\u6e05\u695a\u4e86\uff0cDP\u4e5f\u5f88\u5bb9\u6613\u60f3\u5230\uff0c$f_{i,j}$ \u8868\u793a\u5230\u8fbe\u7b2ci\u5217\u7b2cj\u884c\u7684\u65b9\u6848\u6570\uff0c\u5c06\u8d77\u70b9\u65b9\u6848\u6570\u8bbe\u4e3a 1\uff0c\u6bcf\u4e2a\u70b9\u7684\u65b9\u6848\u6570\u7531\u53ef\u4ee5\u8fc7\u6765\u7684\u70b9\u8f6c\u79fb\uff0c\u4e00\u770b\u6570\u636e\u8303\u56f4\uff0cn \u5c31 50\uff0cm \u6700\u5927 1e9 \uff0c\u8fd9\u51e0\u4e4e\u5c31\u53ef\u4ee5\u60f3\u5230\u662f\u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u4e00\u6b65\u4e00\u6b65\u5206\u6790\u3002\n\n* \u9996\u5148\u4e0d\u96be\u5f97\u51fa\u4e00\u4e2a $O(n^3)$ \u7684\u5199\u6cd5\u3002\uff0820pts\uff09\n```cpp\n    f[1][1] = 1;\n    for (int i = 2; i <= m; ++i)\n        for (int j = 1; j <= n; ++j)\n            for (int k = i - 1; k >= 1; k -= 2)\n                f[i][j] = (f[i][j] + f[k][j-1] + f[k][j] + f[k][j+1]) % M;\n```\n* \u6ce8\u610f\u5230\u8fd9\u53ea\u662f\u6c42\u524d\u9762\u7684\u548c\uff0c\u9650\u5236\u6761\u4ef6\u4e5f\u53ea\u6709\u53ea\u80fd\u4ece\u5947\u6570\u884c\u8f6c\u79fb\uff0c\u8fd9\u6837\u8ba9 $f_{i,j}$ \u8bb0\u5f55\u4e0a\u5947\u6570\u884c\u7684\u548c\u5c31\u80fd\u4f18\u5316\u5230 $O(n^2$\u3002\uff0850pts\uff09\n\n  * \u8fd9\u91cc\u7684f\u6570\u7ec4\u8981\u540c\u65f6\u8bb0\u5f55\u524d\u7f00\u548c\uff0c\u6240\u4ee5\u6700\u7ec8\u7b54\u6848\u662f\u7c7b\u4f3c\u533a\u95f4\u6c42\u548c\u7684\u5f62\u5f0f\uff1a$f_{m,n} - f_{m-2,n}$\n\n  * \u4e3a\u4e86\u65b9\u4fbf\u6700\u540e\u77e9\u9635\u7684\u5199\u6cd5\uff0c\u53c8\u56e0\u4e3a\u4ed6\u662f\u7531\u5012\u6570\u7b2c\u4e8c\u884c\u6700\u540e\u4e24\u5217\u8f6c\u79fb\u8fc7\u6765\uff0c\u5c31\u76f4\u63a5\u8f93\u51fa $f_{m-1,n}+f_{m-1,n-1}$ \n  \n    ```cpp\n    f[1][1] = 1;\n    for (int i = 2; i < m; ++i)\n        for (int j = 1; j <= n; ++j)\n            f[i][j] = (f[i-1][j] + f[i-1][j-1] + f[i-1][j+1] + f[i-2][j]) % M;\n    printf(\"%d\\n\", (f[m-1][n] + f[m-1][n-1]) % M);\n    ```\n* \u53d1\u73b0\u7b2c i \u5217\u53ea\u7531\u7b2c i-1 \u5217\u548c i-2 \u5217\u8f6c\u79fb\u8fc7\u6765\u7684\uff0c\u800c\u4e14\u5217\u6570\u53c8\u90a3\u4e48\u5927\uff0c\u8003\u8651\u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316\uff1a\n  * \u53ef\u4ee5\u7c7b\u6bd4\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u5199\u6cd5\uff0c\u5c06 $f_{i.k}$\u548c$f_{i-1,k}(k\\in {1,...,n})$\u7684\u72b6\u6001\u538b\u6210\u4e00\u4e2a $1\\times 2n$ \u7684\u77e9\u9635\uff0c\u4e58\u4e0a\u4e00\u4e2a\u8f6c\u79fb\u77e9\u9635\uff0c\u5f97\u5230 $f_{i+1.k}$\u548c$f_{i,k}(k\\in {1,...,n})$\u7684\u72b6\u6001\uff0c\u8f6c\u79fb\u77e9\u9635\u6839\u636e\u4e0a\u9762\u7b2c\u4e8c\u4e2a\u89e3\u6cd5\u7684\u8f6c\u79fb\u65b9\u7a0b\u6784\u9020\uff0c\u8fd8\u662f\u4e3e n=4 \u7684\u4f8b\u5b50\n\n$$\\begin{bmatrix}\nf_{i,1} & f_{i,2} &f_{i,3} &f_{i,4} &f_{i-1,1} &f_{i-1,2} &f_{i-1,3} &f_{i-1,4}\n\\end{bmatrix}\n\\ast \n\\begin{bmatrix}\n1 & 1 &  0& 0 &  1& 0 &0  & 0\\\\ \n 1&  1& 1 &  0& 0 &1  & 0 &0 \\\\ \n0 & 1 &  1&  1& 0 & 0 & 1 & 0\\\\ \n0 & 0 & 1 & 1 &0  & 0 & 0 &1 \\\\ \n1 & 0 &0  & 0 & 0 &0  & 0 &0 \\\\ \n 0& 1 &  0&  0&  0& 0&  0& 0\\\\ \n 0&  0&  1&  0& 0 &  0&0&0 \\\\ \n 0& 0 &  0& 1 & 0 & 0 & 0 & 0\n\\end{bmatrix}\n\n=\n\\begin{bmatrix}\nf_{i+1,1} & f_{i+1,2} &f_{i+1,3} &f_{i+1,4} &f_{i,1} &f_{i,2} &f_{i,3} &f_{i,4}\n\\end{bmatrix}$$\n~~\u8fd9\u4e2a\u5f0f\u5b50\u6709\u4ebf\u70b9\u957f\u554a~~\n\n\u8f6c\u79fb\u77e9\u9635\uff1a\n$$\\begin{bmatrix}\n1 & 1 &  0& 0 &  1& 0 &0  & 0\\\\ \n 1&  1& 1 &  0& 0 &1  & 0 &0 \\\\ \n0 & 1 &  1&  1& 0 & 0 & 1 & 0\\\\ \n0 & 0 & 1 & 1 &0  & 0 & 0 &1 \\\\ \n1 & 0 &0  & 0 & 0 &0  & 0 &0 \\\\ \n 0& 1 &  0&  0&  0& 0&  0& 0\\\\ \n 0&  0&  1&  0& 0 &  0&0&0 \\\\ \n 0& 0 &  0& 1 & 0 & 0 & 0 & 0\n\\end{bmatrix}$$\n\u521d\u59cb\u77e9\u9635\n$$\\begin{bmatrix}\n1 & 1 & 0 & 0 & 1 & 0 & 0 & 0\n\\end{bmatrix}$$\n* \u9700\u8981\u6ce8\u610f\u7684\u51e0\u70b9\uff1a\n  1. \u56e0\u4e3a\u77e9\u9635\u65e0\u6cd5\u5904\u7406 $m\\le 2$ \u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u9700\u8981\u7279\u5224\u3002\u53ea\u6709 $f_{1,1},f_{1,2},f_{2,2}$\u503c\u4e3a1,\u5176\u4ed6\u60c5\u51b5\u90fd\u662f0.\n  1. \u6b64\u89e3\u6cd5\u53ea\u5904\u7406\u4e86 $n>1$ \u7684\u60c5\u51b5\uff0c\u5bf9\u4e8e $n=1$ \u7684\u60c5\u51b5\u6253\u8868\u53d1\u73b0\u53ef\u4ee5\u8f6c\u6362\u6210\u6590\u6ce2\u90a3\u5951\u6570\u5217\uff0c\u800c\u4e14\u6b64\u65f6\u8f6c\u79fb\u77e9\u9635\u4e0e\u6c42\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u8f6c\u79fb\u77e9\u9635\u4e5f\u5f88\u60f3\uff0c\u4e5f\u7279\u5224\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n* \u63a5\u4e0b\u6765\u5c31\u662f\u5b9e\u73b0\uff0c\u5177\u4f53\u770b\u4ee3\u7801\u3002\n\n```cpp\n#include <cstdio>\n#include <cstring>\nusing namespace std;\nconst int N = 105, M = 30011;\n\nint n, n2, m;\nstruct Matrix {\n    int a[N][N];\n    Matrix () {\n        memset(a, 0, sizeof(a));\n    }\n    int *operator [] (const int &i) {\n        return a[i];\n    }//\u91cd\u8f7d\u65b9\u62ec\u53f7\u8fd0\u7b97\u7b26\uff0c\u5199\u8d77\u6765\u65b9\u4fbf\n    Matrix operator * (const Matrix &b) {\n        Matrix c;\n        for (int i = 1; i <= n2; ++i)\n            for (int j = 1; j <= n2; ++j)\n                for (int k = 1; k <= n2; ++k)\n                    (c.a[i][j] += a[i][k] * b.a[k][j] % M) %= M;\n        return c;\n    }//\u91cd\u8f7d\u4e58\u53f7\n    void Print() {\n        for (int i = 1; i <= n2; ++i, puts(\"\"))\n            for (int j = 1; j <= n2; ++j)\n                printf(\"%d \", a[i][j]);\n        puts(\"\");\n    }//\u8c03\u8bd5\u8f93\u51fa\u7528\n}a, b, c;\n\nMatrix Pow(Matrix a, int k) {\n    Matrix ans = a; k--;\n    for (; k; k >>= 1, a = a * a)\n        if (k & 1) ans = ans * a;\n    return ans;\n}//\u5feb\u901f\u5e42\n\nint main() {\n    scanf(\"%d%d\", &n, &m);\n    if (m <= 2) {\n        if (n <= 2 && m <= n) puts(\"1\");\n        else puts(\"0\");\n        return 0;\n    }//\u7279\u5224\u60c5\u51b51\n    n2 = n << 1;\n    for (int i = 1; i <= n; ++i) {//\u6784\u9020\u8f6c\u79fb\u77e9\u9635\n        a[i][i-1] = a[i][i] = a[i][i+n] = a[i+n][i] = 1;\n        if (i != n) a[i][i+1] = 1;\n    }\n    b = Pow(a, m - 2);\n    if (n == 1) return printf(\"%d\\n\", b[1][1]), 0;//\u7279\u5224\u60c5\u51b52\n    int s1 = (b[1][n2-1] + b[2][n2-1] + b[n+1][n2-1]) % M;\n    int s2 = (b[1][n2] + b[2][n2] + b[n+1][n2]) % M;\n    //\u6839\u636e\u521d\u59cb\u77e9\u9635\u548c\u5feb\u901f\u5e42\u540e\u7684\u8f6c\u79fb\u77e9\u9635\u6c42\u5f97\u76ee\u6807\u77e9\u9635\u7684\u6709\u7528\u503c\n    printf(\"%d\\n\", (s1 + s2) % M);\n    //s1\u662ff[m-1][n-1]\uff0cs2\u662ff[m-1][n]\uff0c\u52a0\u8d77\u6765\u5c31\u662f\u7b54\u6848\n    return 0;\n}\n```",
        "postTime": 1597498516,
        "uid": 106024,
        "name": "Shawk",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3990 \u3010[SHOI2013]\u8d85\u7ea7\u8df3\u9a6c\u3011"
    },
    {
        "content": "\u53d1\u73b0\u6211\u7684\u505a\u6cd5\u6709\u70b9\u8be1\u5f02...\n\n\u601d\u8def\uff1a\u9996\u5148\u6211\u4eec\u53ea\u8003\u8651**\u4ece\u5de6\u8fb9\u67d0\u4e00\u5217\u7684\u8f6c\u79fb**\uff0c\u663e\u7136\u53ef\u4ee5\u6784\u9020\u8fd9\u6837\u7684\u4e00\u4e2a\u8f6c\u79fb\u77e9\u9635\n\n$$\\begin{bmatrix}1&1&0&0&\\cdots&0&0&0\\\\1&1&1 &0&\\cdots&0&0&0\\\\0&1&1 &1&\\cdots&0&0&0\\\\ \\vdots&\\vdots&\\vdots&\\vdots&\\ddots&\\vdots&\\vdots&\\vdots\\\\0&0&0&0&\\cdots&1&1&1\\\\0&0&0&0&\\cdots&0&1&1\\end{bmatrix}$$\n\n\u7136\u540e\u8bbe\u8fd9\u4e2a\u8f6c\u79fb\u77e9\u9635\u4e3a$T$\uff0c\u8bbe\u7b2c$i$\u5217\u7684\u7b54\u6848\u77e9\u9635\u4e3a$A_i$\n\n\u5219$A_n=T*(A_{n-1}+A_{n-3}+A_{n-5}+\\dots)$\n\n$A_{n-2}=T*(A_{n-3}+A_{n-5}+A_{n-7}+\\dots)$\n\n\u90a3\u4e48\u6709$A_n=T*A_{n-1}+A_{n-2}$\uff0c\u53d1\u73b0\u8fd9\u662f\u4e2a\u9012\u63a8\uff0c\u4e8e\u662f\u518d\u6b21\u6784\u9020\u77e9\u9635\u52a0\u901f\u8f6c\u79fb\n\n$$\\begin{bmatrix}T&I\\\\I&O\\end{bmatrix}\\begin{bmatrix}A_n\\\\A_{n-1}\\end{bmatrix}=\\begin{bmatrix}A_{n+1}\\\\A_{n}\\end{bmatrix}$$\n\n$T$\u662f\u539f\u8f6c\u79fb\u77e9\u9635\uff0c$I$\u662f\u5355\u4f4d\u77e9\u9635\uff0c$O$\u662f0\u77e9\u9635\n\n\u7136\u540e\u5927\u529b\u641e\u5c31\u884c\u4e86\uff0c\u590d\u6742\u5ea6$O(2^3n^3\\log t)$\n\n\u6ce8\u610f\u4e00\u70b9$A_3=TA_2$\u4e0d\u7b26\u5408\u9012\u63a8\u5f0f\n\n------\n\n**Code:**\n\n```cpp\n#include <cstdio>\n#include <cstring>\nconst int mod=30011;\nint n,m;\nstruct matrix1\n{\n    int dx[52][52];\n    matrix1(){memset(dx,0,sizeof(dx));}\n    matrix1 friend operator *(matrix1 n1,matrix1 n2)\n    {\n        matrix1 n3;\n        for(int i=1;i<=n;i++)\n            for(int j=1;j<=n;j++)\n                for(int k=1;k<=n;k++)\n                    (n3.dx[i][j]+=n1.dx[i][k]*n2.dx[k][j])%=mod;\n        return n3;\n    }\n    matrix1 friend operator +(matrix1 n1,matrix1 n2)\n    {\n        for(int i=1;i<=n;i++)\n            for(int j=1;j<=n;j++)\n                (n1.dx[i][j]+=n2.dx[i][j])%=mod;\n        return n1;\n    }\n};\nstruct matrix2\n{\n    matrix1 dx[3][3];\n    matrix2(){matrix1();}\n    matrix2 friend operator *(matrix2 n1,matrix2 n2)\n    {\n        matrix2 n3;\n        for(int i=1;i<=2;i++)\n            for(int j=1;j<=2;j++)\n                for(int i1=1;i1<=n;i1++)\n                    for(int j1=1;j1<=n;j1++)\n                        n3.dx[i][j].dx[i1][j1]=0;\n        for(int i=1;i<=2;i++)\n            for(int j=1;j<=2;j++)\n                for(int k=1;k<=2;k++)\n                    n3.dx[i][j]=n3.dx[i][j]+n1.dx[i][k]*n2.dx[k][j];\n        return n3;\n    }\n}S,T,F;\nint main()\n{\n    scanf(\"%d%d\",&n,&m);\n    S.dx[1][1].dx[1][1]=S.dx[1][1].dx[2][1]=1;\n    for(int i=1;i<=n;i++)\n    {\n        T.dx[1][2].dx[i][i]=T.dx[2][1].dx[i][i]=1;\n        T.dx[1][1].dx[i][i]=T.dx[1][1].dx[i][i-1]=T.dx[1][1].dx[i][i+1]=1;\n    }\n    if(m==2) return printf(\"%d\\n\",S.dx[1][1].dx[n][1]),0;\n    m-=3,F=T;\n    while(m)\n    {\n        if(m&1) F=F*T;\n        T=T*T;\n        m>>=1;\n    }\n    S=F*S;\n    printf(\"%d\\n\",S.dx[1][1].dx[n][1]);\n    return 0;\n}\n```",
        "postTime": 1545211771,
        "uid": 63727,
        "name": "ButterflyDew",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3990 \u3010[SHOI2013]\u8d85\u7ea7\u8df3\u9a6c\u3011"
    },
    {
        "content": "\u8fd9\u9898\u77e9\u9635\u5feb\u901f\u5e42......\n\u5148\u8003\u8651\u52a8\u6001\u89c4\u5212\uff1a  \nf[i][j]\u8868\u793a\u5230\u8fbe\u7b2ci\u5217\u7b2cj\u5217\u7684\u65b9\u6cd5\u6570\uff0c\n\u663e\u7136\u6709\uff1a  \n\n```\n       i/2\nf[i][j]=\u2211 f[i+1-2*k][j]+f[i+1-2*k][j+1]+f[i+1-2*k][j-1]\n       k=1 \n```\n\n\u4e0d\u8fc7\u8fd9\u6837\u505a\u7684\u7b97\u6cd5\u6548\u7387......\u6709\u70b9\u4f4e\uff01  \n\u642c\u8fd0\u4e00\u79cd\u5e38\u89c1\u7684\u505a\u6cd5\uff0c\u66f4\u597d\u7684\u5e2e\u52a9\u5927\u5bb6\u5b66\u4e60\u3002   \n\u8bbef1[i][j]\u4e3a\u4e0e\u5f53\u524d\u5217i\u76f8\u5dee\u5947\u6570\u5217\u7684\u65b9\u6cd5\u6570\u7684\u524d\u7f00\u548c\uff0c  \n\u8bbef2[i][j]\u4e3a\u4e0e\u5f53\u524d\u5217i\u76f8\u5dee\u5076\u6570\u5217\u7684\u65b9\u6cd5\u6570\u7684\u524d\u7f00\u548c\u3002  \n\n\u6839\u636e\u4e0a\u9762\u53ef\u4ee5\u63a8\u51fa\uff1a  \nf2[i+1][j]=f1[i][j]+f2[i][j]+f2[i][j-1]+f2[i][j+1]  \nf1[i+1][j]=f2[i][j]  \n\u7136\u540e\u5c31\u53ef\u4ee5\u7528\u77e9\u9635\u4e58\u6cd5\u505a\u3002\n\u8fd9\u4e2a\u77e9\u9635\u6784\u9020\u8d77\u6765\u7a0d\u5fae\u8d39\u70b9\u529b\u6c14\uff0c\u8fd9\u91cc\u7ed9\u51fa\u4e00\u4e2a  \n\u5f53n=4\u65f6\uff1a    \n\n```\n1 1 0 0  1 0 0 0  \n1 1 1 0  0 1 0 0  \n0 1 1 1  0 0 1 0  \n0 0 1 1  0 0 0 1  \n    \n1 0 0 0  0 0 0 0  \n0 1 0 0  0 0 0 0  \n0 0 1 0  0 0 0 0  \n0 0 0 1  0 0 0 0  \n```\n    \nP.S.\u5c06\u8ba1\u7b97\u5076\u6570\u5217\u4e0e\u8ba1\u7b97\u5947\u6570\u5217\u7684\u77e9\u9635\u62fc\u63a5\u4e86\u8d77\u6765\uff0c\u5f97\u5230\u4e86\u4e00\u4e2a\u8fb9\u957f\u4e3a2n\u7684\u77e9\u9635\u3002  \n\u7ed9\u51fa\u4ee3\u7801\uff1a    \n\n```cpp\n#include <iostream>\n#include <cstring>\n\nusing namespace std;\n\nconst int maxn=1007;\nconst int mod=30011;\n\nlong long n,m;\n\nlong long A[maxn][maxn];\nlong long B[maxn][maxn];\nlong long C[maxn][maxn];\nlong long I[maxn][maxn]={};\n\nvoid matrix(long long a[][maxn],long long b[][maxn])\n{\n\tmemset(A,0,sizeof(A));\n\tfor(long long i=1;i<=n;i++)\n\t    for(long long j=1;j<=n;j++)\n\t        for(long long k=1;k<=n;k++)\n\t            A[i][j]=(A[i][j]+a[i][k]*b[k][j])%mod;\n\tfor(long long i=1;i<=n;i++)\n\t    for(long long j=1;j<=n;j++)\n\t        a[i][j]=A[i][j];\n}\n\nvoid pow(long long a[][maxn],long long num)\n{\n\tmemset(A,0,sizeof(A));\n\tnum--;\n\tfor(long long i=1;i<=n;i++)\n\t    for(long long j=1;j<=n;j++)\n\t        B[i][j]=I[i][j];\n\twhile(num)\n\t{\n\t\tif(num&1)\n\t\t    matrix(B,a);\n\t\tmatrix(a,a);\n\t\tnum=num>>1;\n\t}\n}\n\nint main()\n{\n\tcin>>n>>m;\n\tfor(long long i=1;i<=n;i++)\n\t\tI[i][i]=I[i+n][i]=I[i][i+n]=1;\n\tfor(long long i=1;i<n;i++)\n\t    I[i+1][i]=I[i][i+1]=1;\n\tn=n<<1;\n\tfor(long long i=1;i<=n;i++)\n\t    for(long long j=1;j<=n;j++)\n\t        C[i][j]=I[i][j];\n\tpow(I,m-2);\n\t/*\n\tfor(long long i=1;i<=n;i++)\n\t{\n\t    for(long long j=1;j<=n;j++)\n\t\t    cout<<B[i][j]<<' ';\n\t\tcout<<endl;\n\t}\n\t*/\n\tmatrix(C,B);\n\tcout<<(C[1][n>>1]-B[1][n]+mod)%mod<<endl; \n\treturn 0;\n} \n\n```  \n  \n\u6ce8\u610f\u56e0\u4e3a\u7ef4\u62a4\u7684\u662f\u524d\u7f00\u548c\uff0c\u8fd8\u8981\u76f8\u51cf\u4e00\u4e0b\u3002\n\n",
        "postTime": 1521111390,
        "uid": 38188,
        "name": "\u6570\u5b66\u7cfb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3990 \u3010[SHOI2013]\u8d85\u7ea7\u8df3\u9a6c\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u4e00\u679a\u68cb\u5b50\u4e00\u6b65\u53ef\u4ee5\u5728\u7ad6\u76f4\u65b9\u5411\u4e0a\u79fb\u52a8\u81f3\u591a\u4e00\u884c\u5e76\u5411\u53f3\u79fb\u52a8\u5947\u6570\u6b65\u3002\u6c42\u5b83\u4ece $(1,1)$ \u8d70\u5230 $(n,m)$ \u7684\u65b9\u6cd5\u6570\u3002\n\n\u6838\u5fc3\u601d\u60f3\uff1a\u77e9\u9635\u4f18\u5316 DP\n\n\u89e3\uff1a\n\n\u4ee4 $f(i,j)$ \u8868\u793a\u5230\u8fbe $(i,j)$ \u7684\u65b9\u6cd5\u6570\uff0c\u5219\u6709 $f(i,j)=\\Sigma_{p=i-1}^{i+1}\\Sigma_{q=1}^{\\lfloor\\frac{j}{2}\\rfloor}f(p,j-2q)$\u3002\u6ce8\u610f\u5230 $f(i,j-2)=\\Sigma_{p=i-1}^{i+1}\\Sigma_{q=1}^{\\lfloor\\frac{j}{2}\\rfloor-1}f(p,j-2q)$\uff0c\u5219\u6709 $f(i,j)=f(i-1,j-1)+f(i,j-1)+f(i+1,j-1)+f(i,j-2)$\u3002\n\n\u4ee5 $O(mn)$ \u7684\u590d\u6742\u5ea6\u65e0\u6cd5\u901a\u8fc7\u672c\u9898\uff0c\u6545\u6784\u9020\u77e9\u9635 $A$ \u4f7f\u5f97 $[f(1,j),...f(m,j),f(1,j-1)...,f(m,j-1)]A=[f(1,j+1),...f(m,j+1),f(1,j)...,f(m,j)]$\u3002\u53ef\u4ee5\u53d1\u73b0\u5bf9\u4e8e\u7ed9\u5b9a\u7684 $m$\uff0c$A$ \u5e94\u8be5\u5982\u4e0b\u6784\u9020\uff1a\u5de6\u4fa7 $m$ \u5217\u4e2d\u6bcf\u5217\u5728\u8f6c\u79fb\u5f0f\u5bf9\u5e94\u7684\u4f4d\u7f6e\u6709 $3\\sim 4$ \u4e2a $1$\uff0c\u53f3\u4fa7 $m$ \u5217\u4e2d\u7684\u7b2c $m+i$ \u5217\u6709\u4e14\u4ec5\u6709\u7b2c $i$ \u884c\u4e3a $1$\u3002\u4ee5 $m=4$ \u4e3a\u4f8b\uff1a\n\n$$   \n\\left[               \n  \\begin{array}{cccccccc}   \n    1&1&0&0&1&0&0&0\\\\\n    0&1&1&0&0&1&0&0\\\\\n    0&1&1&1&0&0&1&0\\\\\n    0&0&1&1&0&0&0&1\\\\\n    1&0&0&0&0&0&0&0\\\\\n    0&1&0&0&0&0&0&0\\\\\n    0&0&1&0&0&0&0&0\\\\\n    0&0&0&1&0&0&0&0\\\\\n  \\end{array}\n\\right]\n$$\n\n\u968f\u540e\u8fd0\u7528\u77e9\u9635\u5feb\u901f\u5e42\u8ba1\u7b97 $[1,0,...,0]M^{m-1}$ \u7684\u7b2c $1$ \u884c\u7b2c $m$ \u5217\u662f\u4f3c\u662f\u800c\u975e\u7684\u89e3\uff0c\u8fd9\u662f\u56e0\u4e3a\u5728\u8ba1\u7b97\u4e2d $f(3,1)$ \u7531\u4e8e\u8f6c\u79fb\u5f0f\u5c06 $\\Sigma_{p=0}^{2}\\Sigma_{q=1}^{-1}f(p,1-2q)=0$ \u66ff\u6362\u4e3a $f(1,1)=1$ \u800c\u591a\u7b97\u4e86 $1$\u3002\u6709 $[1,0,...,0]M^2=[3,2,1,0,...0,1,0,...,0]$\uff0c\u6545\u6b63\u786e\u7b54\u6848\u4e3a $[2,2,1,0,...0,1,0,...,0]M^{m-3}$ \u7684\u7b2c $1$ \u884c\u7b2c $m$ \u5217\u3002\u6ce8\u610f\u5bf9\u4e8e\u884c\u6570\u6216\u5217\u6570\u8fc7\u5c0f\u7684\u77e9\u9635\u8981\u6dfb\u52a0\u7279\u5224\u3002\n\n\u4ee3\u7801\uff1a\n```\n#include <bits/stdc++.h>\nusing namespace std;\nstruct mat\n{\n\tlong long a[101][101];\n}a, u, res, bla;//\u521d\u59cb\u77e9\u9635\uff0c\u5355\u4f4d\u77e9\u9635\uff0c\u7ed3\u679c\u77e9\u9635\uff0c\u7a7a\u767d\u77e9\u9635\nconst long long mod=30011;\nlong long n, m;\nmat mu(mat x, mat y)\n{\n\tmat r=bla;\n\tfor(int i=1; i<=2*n; i++)\n\t\tfor(int j=1; j<=2*n; j++)\n\t\t\tfor(int k=1; k<=2*n; k++)\n\t\t\t\tr.a[i][j]=(r.a[i][j]+x.a[i][k]*y.a[k][j])%mod;\n\treturn r;\n}//\u77e9\u9635\u4e58\uff08\u4e0d\u521d\u59cb\u5316r\u4f1aWA\uff09\nmat qp(mat x, long long y)\n{\n\tif(y==0)\n\t\treturn u;\n\tmat t=qp(x, y/2);\n\tif(y%2==0)\n\t\treturn mu(t, t);\n\telse\n\t\treturn mu(t, mu(t, x));\n}//\u5feb\u901f\u5e42\nint main()\n{\n\tcin>>n>>m;\n\tfor(int i=1; i<=2*n; i++)\n\t\tu.a[i][i]=1;\n\tfor(int i=1; i<=n; i++)\n\t{\n\t\ta.a[i][i]=1;\n\t\ta.a[i][i+n]=1;\n\t\ta.a[i+n][i]=1;\n\t}\n\tfor(int i=1; i<n; i++)\n\t{\n\t\ta.a[i][i+1]=1;\n\t\ta.a[i+1][i]=1;\n\t}//\u6784\u9020\u77e9\u9635\n\tres=qp(a, m-3);//\u8ba1\u7b97\n//\tfor(int i=1; i<=2*n; i++)\n//\t{\n//\t\tfor(int j=1; j<=2*n; j++)\n//\t\t\tcout<<res.a[i][j]<<\" \";\n//\t\tcout<<endl;\n//\t}\n\tif(m==1)\n\t\tif(n==1)\n\t\t\tcout<<1;\n\t\telse\n\t\t\tcout<<0;\n\telse if(m==2)\n\t\tif(n<=2)\n\t\t\tcout<<1;\n\t\telse\n\t\t\tcout<<0;//\u77ed\u77e9\u9635\u7279\u5224\n\telse if(n==1)\n\t\tcout<<(res.a[1][n]+res.a[n+1][n])%mod;\n\telse if(n==2)\n\t\tcout<<(2*res.a[1][n]+2*res.a[2][n]+res.a[n+1][n]+res.a[n+2][n])%mod;//\u7a84\u77e9\u9635\u7279\u5224\n\telse\n\t\tcout<<(2*res.a[1][n]+2*res.a[2][n]+res.a[3][n]+res.a[n+1][n]+res.a[n+2][n])%mod;//\u6b63\u5e38\u8f93\u51fa\n\treturn 0;\n}\n```",
        "postTime": 1673554772,
        "uid": 191387,
        "name": "\u03a6\u03c1\u03b1\u03bd\u03ba",
        "ccfLevel": 0,
        "title": "P3990 [SHOI2013]\u8d85\u7ea7\u8df3\u9a6c \u9898\u89e3"
    },
    {
        "content": "## \u601d\u8def\n\n### \u7b2c\u4e00\u773c\n\n#### \u601d\u8def 1\n\n\u662f\u4e00\u9053\u8d85\u7ea7\u7b80\u5355\u7684 dp \u9898\u6b38\u3002\n\n![](https://img-blog.csdnimg.cn/img_convert/4ad91ecf6d2ea7c16fdd81023785f784.png)\n\n\u5bf9\u4e8e\uff08 $ 2 $ \uff0c$ 5 $ \uff09\u8fd9\u4e2a\u70b9\uff08\u84dd\u8272\u65b9\u6846\uff09\u6765\u8bf4\uff0c\u5b83\u53ef\u4ee5\u4ece\u56fe\u4e2d\u9ec4\u8272\u65b9\u6846\u5185\u6570\u5b57\u7684\u548c\u8f6c\u79fb\u800c\u6765\uff08\u9ec4\u8272\u65b9\u6846\u7684\u4f4d\u7f6e\u4e0a\u7684\u9a6c\u53ef\u4ee5\u8df3\u5230\u84dd\u8272\u65b9\u6846\uff09\uff0c\u800c\u9ec4\u8272\u65b9\u6846\u5219\u79bb\u84dd\u8272\u65b9\u6846\u5dee\u4e86\u5947\u6570\u5217\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u4e00\u4e2a\u6700\u6734\u7d20\u7684 dp \u8f6c\u79fb\u65b9\u7a0b\u3002\n\n![](https://img-blog.csdnimg.cn/img_convert/31f6d480dbd93b96edf60b98ecfe1ef5.png)\n\n#### \u9644\u4e0a\u4e00\u4efd\u4f1a\u8d85\u65f6\u7684\u4ee3\u7801\n[\u4ee3\u7801\u5728\u8fd9\u91cc](https://www.luogu.com.cn/paste/a57awk72)\n\n\u7136\u800c\uff0c\u4f60\u4f1a\u53d1\u73b0\u4e00\u4e2a\u5f88\u4e25\u91cd\u7684\u95ee\u9898\u3002\u8c8c\u4f3c\u6570\u7ec4\u4e0d\u80fd\u5f00\u90a3\u4e48\u5927\uff0c\u800c\u4e14\uff0c\u53e6\u5916\u4e00\u4e2a\u4e25\u91cd\u95ee\u9898\u662f\uff0c\u5b83\u4f1a\u8d85\u65f6\uff08\u590d\u6742\u5ea6\u592a\u9ad8\u4e86\uff09\uff01\uff01\uff01\u5b8c\u4e86\uff0c\u8fd9\u7b97\u6cd5\u662f\u6ca1\u6551\u4e86\u3002\n\n\u4e8e\u662f\u4e4e\uff0c\u8fd9\u4efd\u4ee3\u7801\u6ca6\u4e3a\u4e86\u5bf9\u62cd\u5de5\u5177\u2026\u2026\n\n### \u7b2c\u4e8c\u773c\n\n#### \u601d\u8def 2\n\n\u6211\u4eec\u6765\u5148\u89e3\u51b3\u4e00\u4e0b\u590d\u6742\u5ea6\u95ee\u9898\u3002\u6700\u7b80\u5355\u7684\u529e\u6cd5\u7684\u5f53\u7136\u662f\u524d\u7f00\u548c\u3002\n\n> \u524d\u7f00\u548c\u5176\u5b9e\u5f88\u5bb9\u6613\u60f3\u5230\u7684\uff0c\u56e0\u4e3a\u6bcf\u6b21\u6211\u4eec\u5f97\u5230\u4e00\u4e2a\u70b9\u7684\u7b54\u6848\u90fd\u4f1a\u5411\u524d\u627e\u5230\u76f8\u9694\u5947\u6570\u884c\u7684\u7b54\u6848\u6765\u8ba1\u7b97\uff0c\u6211\u4eec\u53ea\u8981\u5c06\u524d\u9762\u5947\u6570\u884c\u7684\u7b54\u6848\u7edf\u8ba1\u524d\u7f00\u548c\u5c31\u53ef\u4ee5\u7701\u53bb\u8fd9\u4e2a\u6b65\u9aa4\u4e86\u3002\n\n\u6211\u4eec\u6bcf\u6b21\u8ba1\u7b97\u51fa\u65b0\u7684\u7b54\u6848\u540e\uff0c\u5c31\u5c06\u7b54\u6848\u7d2f\u52a0\u5230\u524d\u7f00\u548c\u4e2d\uff0c\u6bcf\u6b21\u53ea\u7528\u8bbf\u95ee\u524d\u7f00\u548c\u4e2d\u76f8\u90bb\u884c\u5c31\u53ef\u4ee5\u4e86\u3002\n\n#### \u518d\u6b21\u9644\u4e0a\u4f1a\u8d85\u65f6\u7684\u4ee3\u7801\n\n~~\uff08\u6211\u8003\u8bd5\u5c31\u5199\u7684\u8fd9\u4e2a\uff0c\u7136\u800c\u5b83TLE\u4e86\uff09~~\n\n[\u4ee3\u7801\u5728\u8fd9\u91cc](https://www.luogu.com.cn/paste/6hsewmz4)\n\n\u56e0\u4e3a\u6bcf\u6b21\u90fd\u662f\u4ece\u76f8\u9694\u5947\u6570\u7684\u5217\u4e2d\u5f97\u5230\u7b54\u6848\uff0c\u6240\u4ee5\u6211\u4eec\u8ba1\u7b97\u524d\u7f00\u548c\u9700\u8981\u8bb0\u5f55\u4e24\u4e2a\uff0c\u5206\u522b\u662f\u5947\u6570\u5217\u548c\u5076\u6570\u5217\u7684(\u6570\u7ec4 $ a1 $ \u548c\u6570\u7ec4 $ a2 $ )\u3002\n\n\u7136\u800c\uff0c\u6b8b\u9177\u7684\u4e8b\u5b9e\u662f\uff0c\u5b83\u53c8\u8d85\u65f6\u4e86\uff0c\u4ee3\u7801\u5b83\u53c8\u6ca6\u4e3a\u4e86\u5bf9\u62cd\u5de5\u5177\u2026\u2026\n\n### \u7b2c\u4e09\u773c-\u5b83\u7ec8\u4e8e\u662f\u6b63\u89e3\u4e86\uff01\n\n#### \u601d\u8def\n\n\u6211\u4eec\u9664\u4e86\u8fd9\u6837\u7edf\u8ba1\u524d\u7f00\u548c\uff0c\u8fd8\u6709\u5176\u4ed6\u529e\u6cd5\u5417\uff1f\n\n~~\u90a3\u80af\u5b9a\u554a\uff08\u90a3\u4e0d\u5c31\u662f\u6b63\u89e3\u5417\uff09~~\n\n\u6211\u4eec\u5c06\u8f6c\u79fb\u65b9\u7a0b\u5f0f\u6539\u4e3a\u8fd9\u6837\uff1a![](https://img-blog.csdnimg.cn/img_convert/ce74de5c8702b43ad56c6df58ef2d923.png)\n\n\u753b\u4e2a\u56fe\u6765\u89e3\u91ca\u4e00\u4e0b\uff1a\n\n![](https://img-blog.csdnimg.cn/img_convert/4ddfc73ddd5464d70871eb0c2aa7bbbe.png)\n\n\u6709\u4e86\u8fd9\u5e45\u56fe\u5c31\u4e00\u76ee\u4e86\u7136\u4e86\u3002\u9996\u5148\uff0c\u524d\u4e00\u5217\u7684\u76f8\u90bb\u4e09\u4e2a\u6570\u662f\u9700\u8981\u76f8\u52a0\u7684\uff0c\u7136\u540e\u5462\uff0c\u524d\u9762\u76f8\u9694\u4e09\u5217\uff0c\u4e94\u5217\uff0c\u751a\u81f3\u66f4\u8fdc\u7684\u5217\u90fd\u88ab\u540c\u4e00\u884c\u76f8\u9694\u4e24\u5217\u7684\u90a3\u4e2a\u6570\u5305\u542b\u5728\u5185\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u663e\u800c\u6613\u89c1\u7684\u5f97\u5230\u4e86\u8fd9\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u3002\n\n\u8bf4\u5b8c\u4e86\u8f6c\u79fb\u65b9\u7a0b\uff0c\u90a3\u6211\u4eec\u53c8\u8be5\u600e\u4e48\u5199\u5462\uff1f\u90a3\u5f53\u7136\u662f\u77e9\u9635\u52a0\u901f\u4e86\u554a\uff08\u8bf4\u5b9e\u8bdd\u5f00\u59cb\u65f6\u6211\u5b8c\u5168\u6ca1\u60f3\u5230\uff09\u3002\n\n\u5bf9\u4e8e\u6211\u4eec\u65b0\u7684\u4e00\u5217\uff0c\u6211\u4eec\u9700\u8981\u4ece\u524d\u9762\u7684\u4e24\u884c\u8f6c\u79fb\u8fc7\u6765\uff0c\u90a3\u4e48\u521d\u59cb\u77e9\u9635\u5c31\u5f97\u5230\u4e86\uff1a\n\n\u8fd9\u662f\u5bf9\u4e8e $ n $ \u7b49\u4e8e $ 4 $ \u65f6\u7684\u60c5\u51b5\uff08\u524d $ 4 $ \u4e2a\u5143\u7d20\u4e3a\u7b2c\u4e8c\u5217\u7684\uff0c\u540e $ 4 $ \u4e2a\u5143\u7d20\u4e3a\u7b2c\u4e00\u5217\u7684\uff09\uff1a \n\n![](https://img-blog.csdnimg.cn/img_convert/99221c13ae46132348374a5913b67aad.png)\n\n\u524d\u9762 $ n $ \u4e2a\u5143\u7d20\u4e3a\u76f8\u9694\u4e00\u5217\u7684\u5143\u7d20\uff0c$ n+1 $ \u81f3 $ 2 \\times n $ \u4e2a\u5143\u7d20\u4e3a\u76f8\u9694\u4e24\u5217\u7684\u5143\u7d20\u3002\n\n\u8fd9\u65f6\u5019\u5c31\u8be5\u6784\u5efa\u8f6c\u79fb\u77e9\u9635\u4e86\uff1a\uff08\u77e9\u9635\u5e94\u8be5\u4e3a $ 2n \\times 2n $ \u5927\u5c0f\u7684\u65b9\u9635\uff09\u3002\n\n\u6211\u4eec\u8981\u5c06\u8fd9\u4e2a\u521d\u59cb\u77e9\u9635\u53d8\u4e3a\u5b58\u653e\u7b2c\u4e09\u5217\u548c\u7b2c\u4e8c\u5217\u5143\u7d20\u7684\u77e9\u9635\uff1a\n\n![](https://img-blog.csdnimg.cn/img_convert/acf266c80af60bd452441aeafa228264.png)\n\n\u5f88\u5bb9\u6613\u4ece\u4e4b\u4e0a\u63a8\u51fa\u8fd9\u4e2a\u8f6c\u79fb\u77e9\u9635\uff08\u4e0a\u56fe\u662f\u5bf9\u4e8e $ n $ \u7b49\u4e8e $ 4 $ \u7684\u60c5\u51b5\uff09\uff0c\u6211\u4eec\u5bf9\u4e8e\u7b2c\u4e09\u5217\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u53ea\u9700\u8981\u6309\u7167\u4e0a\u9762\u5df2\u7ecf\u7ed9\u51fa\u7684\u8f6c\u79fb\u77e9\u9635\u6765\u7b97\u5c31\u884c\u4e86\uff08\u524d\u63d0\u662f\u4f60\u5df2\u7ecf\u4f1a\u4e86\u77e9\u9635\u4e58\u6cd5\uff09\u3002\n\n\u8c8c\u4f3c\u8fd9\u9053\u9898\u5df2\u7ecf\u505a\u51fa\u6765\u4e86\uff01\u7136\u800c\uff0c\u663e\u793a\u5374\u5f88\u6b8b\u9177\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0c\u4f60\u7684\u7b54\u6848\u662f\u9519\u7684\u3002\n\n#### \u9519\u8bef\u7684\u5730\u65b9\n\n\u4f60\u8ba4\u771f\u7684\u8c03\u8bd5\u540e\uff0c\u4f60\u4f1a\u795e\u5947\u7684\u53d1\u73b0\uff0c\u5728\u7b2c\u4e09\u5217\u7684\u7b2c\u4e00\u884c\u7684\u7b54\u6848\u8c8c\u4f3c\u4e0d\u5bf9\uff08\u9519\u8bef\u7684\u7b54\u6848\u4f1a\u662f\u8fd9\u6837\uff08\u5982\u4e0b\u56fe\uff09\uff09\u3002\n\n![](https://img-blog.csdnimg.cn/img_convert/0116a50cc19ae57569d4f44459e5895f.png)\n\n\u8fd9\u662f\u56e0\u4e3a\u5f53\u6211\u4eec\u8f6c\u79fb\u7b2c\u4e09\u5217\u7b2c\u4e00\u884c\u8fd9\u4e2a\u5143\u7d20\u65f6\uff0c\u4f1a\u5c06\uff08 $ 1 $ \uff0c$ 1 $ \uff09\u4e0a\u7684\u5143\u7d20\u4e5f\u52a0\u4e0a\u53bb\uff0c\u7136\u800c\u6309\u7167\u9898\u610f\uff0c\u8fd9\u4e2a\u70b9\u662f\u4e0d\u4f1a\u88ab\u7b97\u5728\uff08 $ 1 $ \uff0c$ 3 $ \uff09\u8fd9\u4e2a\u70b9\u4e2d\u7684\u3002\n\n\u6240\u4ee5\u8fd9\u662f\u4e00\u4e2a\u7279\u6b8a\u60c5\u51b5\uff08\u7f51\u4e0a\u5927\u591a\u6570\u505a\u6cd5\u662f\u51cf\u53bb\u4e00\u4e2a\u4ec0\u4e48\u4e1c\u897f\uff08\u8c8c\u4f3c\u662f\u4ec0\u4e48\u524d\u7f00\u548c\uff0c\u4f46\u6211\u6ca1\u770b\u61c2\uff09\uff09\uff0c\u6211\u5728\u8fd9\u91cc\u5c31\u975e\u5e38\u76f4\u767d\u5730\u76f4\u63a5\u5c06\u521d\u59cb\u77e9\u9635\u4ece\u7b2c $ 4 $ \u5217\u548c\u7b2c $ 3 $ \u5217\u5f00\u59cb\uff0c\u76f4\u63a5\u907f\u514d\u4e86\u8fd9\u4e2a\u795e\u5947\u7684\u95ee\u9898\uff1a\n\n![](https://img-blog.csdnimg.cn/img_convert/96eec1ed92811010e7867dfa429e8408.png)\n\n\u7136\u540e\u6211\u4eec\u53ea\u8981\u7279\u5224 $ m $ \u5c0f\u4e8e\u7b49\u4e8e $ 4 $ \u548c $ n $ \u5c0f\u4e8e\u7b49\u4e8e $ 4 $ \u7684\u60c5\u51b5\uff08\u540e\u6765\u770b\u522b\u4eba\u7684\u8ba8\u8bba\u624d\u77e5\u9053\uff0c\u8fd9\u6837\u7279\u5224\u8fd8\u53ef\u4ee5\u907f\u514d\u4e00\u4e9b~~\u795e\u5947\u7684~~\u9519\u8bef\uff08\u6bd4\u5982 $ 50 $ \uff0c$ 2 $ \u4f1a\u8f93\u51fa~~\u795e\u5947\u7684~~ $ 1 $ \uff09\uff09\u3002\n\n\u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u53ea\u7528\u5feb\u901f\u5e42 $ m-4 $ \u6b21\u5c31\u53ef\u4ee5\u4e86\u3002\n\n### \u6700\u7ec8\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nstruct matrix{\n\tlong long h,l;//h\u4ee3\u8868\u884c\uff0cl\u4ee3\u8868\u5217\n\tint a[110][110];\n}ans,wns;\nlong long n,m;\nint mod=30011;\nmatrix times(matrix r,matrix c){\n\tmatrix timesans;\n\tmemset(timesans.a,0,sizeof(timesans.a));\n\ttimesans.h=r.h;\n\ttimesans.l=c.l;\n\tfor(int i=1;i<=r.h;i++){\n\t\tfor(int j=1;j<=c.l;j++){\n\t\t\tfor(int q=1;q<=r.l;q++){\n\t\t\t\ttimesans.a[i][j]=(timesans.a[i][j]+r.a[i][q]%mod*c.a[q][j]%mod)%mod;\n\t\t\t}\n\t\t}\n\t}\n\treturn timesans;\n}\t\nmatrix mul(matrix x,long long y){\n\tmatrix res;\n\tres.h=res.l=x.l;\n\tmemset(res.a,0,sizeof(res.a));\n\tfor(int i=1;i<=res.l;i++){\n\t\tres.a[i][i]=1;\n\t}\n\tfor(;y;y>>=1){\n\t\tif(y&1) res=times(x,res);\n\t\tx=times(x,x);\n\t}\n\treturn res;\n}\nmatrix buildansup4(long long n){\n\tmatrix temp;\n\tmemset(temp.a,0,sizeof(temp.a));\n\ttemp.h=1;\n\ttemp.l=2*n;\n\ttemp.a[1][1]=5;\n\ttemp.a[1][2]=6;\n\ttemp.a[1][3]=3;\n\ttemp.a[1][4]=1;\n\ttemp.a[1][n+1]=2;\n\ttemp.a[1][n+2]=2;\n\ttemp.a[1][n+3]=1;\n\treturn temp;\n}\nmatrix buildans3(){\n\tmatrix temp;\n\tmemset(temp.a,0,sizeof(temp.a));\n\ttemp.h=1;\n\ttemp.l=6;\n\ttemp.a[1][1]=5;\n\ttemp.a[1][2]=6;\n\ttemp.a[1][3]=3;\n\ttemp.a[1][4]=2;\n\ttemp.a[1][5]=2;\n\ttemp.a[1][6]=1;\n\treturn temp;\n}\nmatrix buildans2(){\n\tmatrix temp;\n\tmemset(temp.a,0,sizeof(temp.a));\n\ttemp.h=1;\n\ttemp.l=4;\n\ttemp.a[1][1]=5;\n\ttemp.a[1][2]=5;\n\ttemp.a[1][3]=2;\n\ttemp.a[1][4]=2;\n\treturn temp;\n}\nmatrix buildans1(){\n\tmatrix temp;\n\tmemset(temp.a,0,sizeof(temp.a));\n\ttemp.h=1;\n\ttemp.l=2;\n\ttemp.a[1][1]=2;\n\ttemp.a[1][2]=1;\n\treturn temp;\n}\nmatrix buildwns(long long n){\n\tmatrix temp;\n\ttemp.l=temp.h=2*n;\n\tmemset(temp.a,0,sizeof(temp.a));\n\tfor(int i=1;i<=n;i++){\n\t\ttemp.a[i][i]=1;\n\t\tif(i-1>=1){\n\t\t\ttemp.a[i][i-1]=1;\n\t\t}\n\t\tif(i+1<=n){\n\t\t\ttemp.a[i][i+1]=1;\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\ttemp.a[i][n+i]=1;\n\t}\n\tfor(int i=n+1;i<=2*n;i++){\n\t\ttemp.a[i][i-n]=1;\n\t}\n\treturn temp;\n}\nvoid printmatrix(matrix p){\n\tfor(int i=1;i<=p.h;i++){\n\t\tfor(int j=1;j<=p.l;j++){\n\t\t\tcout<<p.a[i][j]<<\" \";\n\t\t}\n\t\tcout<<endl;\n\t}\n} \nint main(){\n\tcin>>n>>m;\n\tif(m<=4){\n\t\tif(m==4){\n\t\t\tif(n==1){\n\t\t\t\tcout<<5;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(n==2){\n\t\t\t\tcout<<6;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(n==3){\n\t\t\t\tcout<<3;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(n==4){\n\t\t\t\tcout<<1;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t\tif(m==3){\n\t\t\tif(n==1){\n\t\t\t\tcout<<2;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(n==2){\n\t\t\t\tcout<<2;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(n==3){\n\t\t\t\tcout<<1;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t\tif(m==2){\n\t\t\tif(n==1){\n\t\t\t\tcout<<1;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif(n==2){\n\t\t\t\tcout<<1;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t\tif(m==1){\n\t\t\tif(n==1){\n\t\t\t\tcout<<1;\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t\tcout<<0;\n\t\treturn 0;\n\t}\n\tif(n>=4){\n\t\tans=buildansup4(n);\n\t}\n\tif(n==3){\n\t\tans=buildans3();\n\t}\n\tif(n==2){\n\t\tans=buildans2();\n\t}\n\tif(n==1){\n\t\tans=buildans1();\n\t}\n\twns=buildwns(n);\n\twns=mul(wns,m-4);\n\tans=times(ans,wns);\n\tprintf(\"%lld\",ans.a[1][n]%mod);\n\treturn 0;\n}\n\n```\n### \u6ce8\u610f\n\n\u6211\u9047\u89c1\u4e86\u4e00\u4e2a\u795e\u5947\u7684\u95ee\u9898\uff0c\u5728\u6700\u540e\u8fd9\u4e2a\u4ee3\u7801\u4e2d\uff0c\u7b2c $ 5 $ \u884c\u548c\u7b2c $ 8 $ \u884c\u7684\u53d8\u91cf\u5b9a\u4e49\u5982\u679c\u662f long long \u7684\u8bdd\uff0c\u4ed6\u7b2c $ 11 $ \u4e2a\u70b9\u5c45\u7136\u4f1aTLE\u3002\n\u6240\u4ee5\u8bb0\u5f97\u80fd\u5f00 int \u5c31\u5f00 int \uff0c\u522b\u4f5c\u6b7b\u5f00 long long \uff08 long long \u6bd4 int \u6162\uff09\u3002",
        "postTime": 1665989563,
        "uid": 508177,
        "name": "GXYZY",
        "ccfLevel": 0,
        "title": "\u8d85\u7ea7\u8df3\u9a6c"
    },
    {
        "content": "\u9996\u5148\u53ef\u4ee5\u60f3\u5230\u4e00\u4e2a\u4f4d\u7f6e\u72b6\u6001\u4f1a\u4ece\u4e0e\u81ea\u5df1\u76f8\u5dee\u4e0d\u5230\u4e00\u884c\uff0c\u76f8\u5dee\u5217\u4e3a\u5947\u6570\u7684\u5217\u8f6c\u79fb\u8fc7\u6765\uff0c\u90a3\u4e48\u5f88\u660e\u663e\u5bf9\u4e8e\u6bcf\u4e00\u884c\u53ef\u4ee5\u6c42\u5947\u6570\u4f4d\u7f6e\u6216\u662f\u5076\u6570\u4f4d\u7f6e\u7684\u524d\u7f00\u548c\u3002\n\n\u8bbe $f_{i,j}$ \u4e3a\u8df3\u5230\u7b2c $i$ \u884c\u7b2c $j$ \u5217\u7684\u65b9\u6848\u6570\uff0c$g_{i,j}$ \u4ee3\u8868\u7b2c $i$ \u884c\u7b2c $j$ \u5217\u7684 $\\sum_{k\\ne j(\\bmod 1)}f_{i,k}$\uff0c\u5373\u540c\u884c\u4e0e\u81ea\u5df1\u76f8\u5dee\u5947\u6570\u5217\u7684\u524d\u7f00\u548c\u3002\n\n\u90a3\u4e48\u53ef\u4ee5\u5199\u51fa\u8f6c\u79fb\u65b9\u7a0b\u3002\n\n$f_{i,j}=g_{i-1,j-1}+g_{i,j-1}+g_{i+1,j-1}$\n\n$g_{i,j}=g_{i-2,j}+f_{i,j}$\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u77e9\u9635\u52a0\u901f\u4e86\uff0c\u521d\u59cb\u77e9\u9635\u4ece\u4e0a\u5230\u4e0b\u5206\u522b\u4e3a $f_{k,j}$\uff0c$g_{k,j}$ \u548c $g_{k,j-1}(1\\le k\\le n)$\u3002\n\n\u5269\u4e0b\u7684\u8f6c\u79fb\u77e9\u9635\u5728\u5bf9\u5e94\u4f4d\u7f6e\u4e0a\u52a0 $1$ \u5373\u53ef\uff0c\u5bf9\u6b64\u64cd\u4f5c\u5982\u679c\u6709\u7591\u95ee\u53ef\u4ee5\u591a\u53bb\u590d\u4e60\u4e0b\u77e9\u9635\u5feb\u901f\u5e42\u3002\n\n\u590d\u6742\u5ea6\uff1a$O(27n^3\\times \\log(m))$\u3002\n\n```\n#include<iostream>\n#include<cstdio>\nusing namespace std;\nconst int mod=30011;\nconst int N=105;\nstruct matrix\n{\n\tint x,y,a[155][155];\n\tvoid init()\n\t{\n\t\tfor(int i=1;i<=x;i++)for(int j=1;j<=y;j++)a[i][j]=0;\n\t}\n};\nmatrix operator *(matrix fi,matrix se)\n{\n\tmatrix th;\n\tth.x=fi.x,th.y=se.y;\n\tth.init();\n\tfor(int i=1;i<=fi.x;i++)\n\t{\n\t\tfor(int j=1;j<=se.y;j++)\n\t\t{\n\t\t\tfor(int k=1;k<=fi.y;k++)\n\t\t\t{\n\t\t\t\tth.a[i][j]+=fi.a[i][k]*se.a[k][j];\n\t\t\t\tth.a[i][j]%=mod;\n\t\t\t}\n\t\t}\n\t}\n\treturn th;\n}\nmatrix quick_pow(matrix x,int y)\n{\n\tmatrix num=x,sum;\n\tsum.x=sum.y=num.x;\n\tsum.init();\n\tfor(int i=1;i<=sum.x;i++)sum.a[i][i]=1;\n\twhile(y)\n\t{\n\t\tif(y&1)sum=sum*num;\n\t\tnum=num*num;\n\t\ty>>=1;\n\t}\n\treturn sum;\n}\nint main()\n{\n\tint n,m;\n\tscanf(\"%d%d\",&n,&m);\n\tmatrix x,y;\n\tx.x=x.y=3*n;\n\tx.init();\n\ty.x=3*n,y.y=1;\n\ty.init();\n\ty.a[1][1]=y.a[1+n][1]=1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint x1=i+n-1,x2=i+n,x3=i+n+1;\n\t\tif(x1>n&&x1<=2*n)x.a[i+n][x1]=x.a[i][x1]=1;\n\t\tif(x2>n&&x2<=2*n)x.a[i+n][x2]=x.a[i][x2]=1;\n\t\tif(x3>n&&x3<=2*n)x.a[i+n][x3]=x.a[i][x3]=1;\n\t}\n\tfor(int i=n+1;i<=2*n;i++)x.a[i][i+n]=1;\n\tfor(int i=2*n+1;i<=3*n;i++)x.a[i][i-n]=1;\n\tx=quick_pow(x,m-1);\n\ty=x*y;\n\tprintf(\"%d\",y.a[n][1]);\n\treturn 0;\n}\n```\n",
        "postTime": 1664686426,
        "uid": 275793,
        "name": "Gmt\u4e36FFF",
        "ccfLevel": 5,
        "title": "P3990 [SHOI2013]\u8d85\u7ea7\u8df3\u9a6c"
    },
    {
        "content": "[$\\texttt{Link}$](https://www.luogu.com.cn/problem/P3990)  \n\n\u663e\u7136\u6709 DP \u505a\u6cd5\uff0c$f(i,j)$ \u8868\u793a\u8d70\u5230\u7b2c $i$ \u884c\u7b2c $j$ \u5217\u7684\u65b9\u6848\u6570\u91cf\u3002  \n\n\u6709\u8f6c\u79fb\u65b9\u7a0b \n$$f(i,j)=f(i-1,j-1)+f(i,j-1)+f(i+1,j-1)+\\sum\\limits_{i=1}^{\\left\\lfloor{\\frac{j}{2}}\\right\\rfloor}f(i-1,j-1-2i)+f(i,j-1-2i)+f(i+1,j-1-2i)$$  \n\n\u8fd9\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u8f6c\u79fb\u590d\u6742\u5ea6\u592a\u9ad8\uff0c\u53d1\u73b0\u540e\u9762\u90a3\u4e2a\u5f0f\u5b50\u5373\u4e3a $f(i,j-2)$\u3002  \n\n\u6240\u4ee5\u6709\u66f4\u7b80\u6d01\u7684\u8f6c\u79fb\u65b9\u7a0b \n$$f(i,j)=f(i-1,j-1)+f(i,j-1)+f(i+1,j-1)+f(i,j-2)$$  \n\n\u7136\u540e\u53d1\u73b0\uff0c\u6570\u636e\u8303\u56f4 $n\\le50,m\\le10^9$\uff0c\u66b4\u529b\u8f6c\u79fb $O(nm)$\uff0c\u8fc7\u9ad8\u3002\n\n\u8003\u8651\u7528\u77e9\u9635\u4f18\u5316\u3002  \n\n\u77e9\u9635\u4e2d\u6709\u4e0a\u4e24\u5217\u6bcf\u884c\u7684\u72b6\u6001\u3002\u5982 $n=3$ \u65f6\u6709\u8f6c\u79fb\u77e9\u9635  \n\n$\\begin{bmatrix}1&1&0&1&0&0\\\\1&1&1&0&1&0\\\\0&1&1&0&0&1\\\\1&0&0&0&0&0\\\\0&1&0&0&0&0\\\\0&0&1&0&0&0\\end{bmatrix}\\times\\begin{bmatrix}f(1,i-1)\\\\f(2,i-1)\\\\f(3,i-1)\\\\f(1,i-2)\\\\f(2,i-2)\\\\f(3,i-2)\\end{bmatrix}=\\begin{bmatrix}f(1,i)\\\\f(2,i)\\\\f(3,i)\\\\f(1,i-1)\\\\f(2,i-1)\\\\f(3,i-1)\\end{bmatrix}$\n\n\u8fd9\u4e2a\u77e9\u9635\u7684\u6784\u9020\uff0c\u4ee5 $f(2,i)$ \u4e3a\u4f8b\n$$f(2,i)=1\\times f(1,i-1)+1\\times f(2,i-1)+1\\times f(3,i-1)+0\\times f(1,i-2)+1\\times f(2,i-2)+0\\times f(3,i-2)$$\n\n\u5176\u5bf9\u5e94\u7684\u7cfb\u6570\u5373\u4e3a\u521d\u59cb\u77e9\u9635\u7684\u7b2c $2$ \u884c\u3002  \n\n\u77e9\u9635\u5feb\u901f\u5e42\u5373\u53ef\u3002\n\n\u56e0\u4e3a\u6700\u521d\u7b2c\u4e00\u5217\u4e0d\u9700\u8981\u8f6c\u79fb\uff0c\u6240\u4ee5\u5c06 $m\\gets m-1$\uff0c\u5e76\u7279\u5224\u4e00\u4e0b $m=2$ \u7684\u60c5\u51b5\uff0c\u7136\u540e\u4f1a\u53d1\u73b0\uff0c\u5728 \u8ba1\u7b97 $f(1,3)$ \u65f6\uff0c\u4f1a\u6709\u4ece $f(1,1)$ \u6765\u7684\u8f6c\u79fb\uff0c\u7136\u800c $f(1,1)$ \u5e76\u6ca1\u6709\u5728\u5176\u4e4b\u524d\u5217\u7684\u8f6c\u79fb\uff0c\u5bfc\u81f4\u591a\u7b97\u4e86\u4e00\u6b21\u3002\u6240\u4ee5\u5230 $f(n,m)$ \u65f6\uff0c\u591a\u51fa\u7684\u65b9\u6848\u6570\uff0c\u5373\u4e3a\u4ece $(1,1)$ \u5230 $(n,m-2)$ \u7684\u65b9\u6848\u6570\uff0c\u5373\u591a\u51fa $f(n,m-2)$\uff0c\u51cf\u53bb\u5b83\u5373\u53ef\u3002  \n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 1e2 + 10, P = 30011;\nint n, m;\nstruct Matrix {\n\tint a[N][N];\n\tMatrix() { memset(a, 0, sizeof(a)); }\n\tvoid init() {\n\t\tfor(int i = 1; i <= (n << 1); i++) a[i][i] = 1;\n\t}\n\tfriend Matrix operator * (Matrix a, Matrix b) {\n\t\tMatrix res;\n\t\tfor(int i = 1; i <= (n << 1); i++)\n\t\t\tfor(int j = 1; j <= (n << 1); j++)\n\t\t\t\tfor(int k = 1; k <= (n << 1); k++)\n\t\t\t\t\tres.a[i][j] = (res.a[i][j] + a.a[i][k] * b.a[k][j]) % P;\n\t\treturn res;\t\t \n\t}\n} base;\nMatrix qpow(Matrix a, int k) {\n\tMatrix res; res.init();\n\tfor(; k; a = a * a, k >>= 1)\n\t\tif(k & 1) res = res * a;\n\treturn res;\n}\nvoid build() {\n\tfor(int i = 1; i <= n; i++)\n\t\tfor(int j = max(i - 1, 1); j <= min(i + 1, n); j++)\n\t\t\tbase.a[i][j] = 1;\n\tfor(int i = 1; i <= n; i++)\n\t\tbase.a[i][i + n] = base.a[i + n][i] = 1;\n}\nint main() {\n\tscanf(\"%d%d\", &n, &m);\n\tif(m == 2) {\n\t\tif(n <= 2) printf(\"1\");\n\t\telse printf(\"0\");\n\t\treturn 0;\n\t}\n\tbuild();\n\tm -= 2;//\u56e0\u4e3a\u6700\u540e\u6709\u4e00\u6b21\u5355\u72ec\u7b97\uff0c\u6240\u4ee5m\u591a\u51cf1\n\tMatrix ans = qpow(base, m);\n\tint s = ans.a[1][n << 1];\n\tans = ans * base;\n\tint t = ans.a[1][n];\n\tprintf(\"%d\", (t - s + P) % P);\n\treturn 0;\n}\n```\n",
        "postTime": 1627026600,
        "uid": 365107,
        "name": "Terac",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3990 [SHOI2013]\u8d85\u7ea7\u8df3\u9a6c"
    },
    {
        "content": "\u3010\u7b97\u6cd5\u4e00\uff1a~~\u66b4\u529b~~DP\u3011\n\n~~\u4e00\u770b\u5230\u8fd9\u4e2a\u9898\uff0c\u5c31\u89c9\u5f97\u662f\u4e2aDP\u9898~~\u3002\n\n\u6211\u4eec\u7528 $f_{i,j}$ \u8868\u793a\u9a6c\u8d70\u5230 $( i,j )$ \u7684\u65b9\u6848\u6570\u3002\n\n\u65b9\u7a0b\uff1a$f_{k,i} = \\sum_{i\\not\\equiv j \\pmod{2},j < i}f_{k-1,j}+f_{k,j}+f_{k+1,j} $\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nm^{2})$ \uff0c\u671f\u671b\u5f97\u5206 $10$ \u5206\u3002\n\n\u3010\u7b97\u6cd5\u4e8c\uff1a~~\u5e26\u4f18\u5316\u7684~~DP\u3011\n\n\u6211\u4eec\u53d1\u73b0$f_{k,i-2}=\\sum_{i\\not\\equiv j \\pmod{2},j < i-2}f_{k-1,j}+f_{k,j}+f_{k+1,j}$\u3002\n\n\u6240\u4ee5DP\u5f0f\u53d8\u4e3a$f_{k,i} = f_{k-1,i-1}+f_{k,i-1}+f_{k+1,i-1}+f_{k,i-2} $\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nm)$,\u671f\u671b\u5f97\u5206 $50$ \u5206\u3002\n\n\u3010\u7b97\u6cd5\u4e09\uff1a\u7528\u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316\u3011\n\n\u6211\u4eec\u53d1\u73b0 $f_{i}$ \u53ea\u4e0e $f_{i-1}$ \u548c $f_{i-2}$ \u6709\u5173\uff0c\n\n\u4e8e\u662f\u53ef\u4ee5\u6784\u9020\u4e00\u4e2a\u77e9\u9635\uff1a\uff08\u4f8b\u5b50\u4e3a $n = 3$\uff09\n\n$\\begin{bmatrix}\nf_{1,i-1} &f_{2,i-1} &f_{3,i-1} &f_{1,i-2} &f_{2,i-2} &f_{3,i-2}\n\\end{bmatrix} \\times \\begin{bmatrix}\n1  &1  &0  &1  &0  &0 \\\\\n1  &1  &1  &0  &1  &0 \\\\\n0  &1  &1  &0  &0  &1 \\\\\n1  &0  &0  &0  &0  &0 \\\\\n0  &1  &0  &0  &0  &0 \\\\\n0  &0  &1  &0  &0  &0\n\\end{bmatrix} = \\begin{bmatrix}\nf_{1,i} &f_{2,i} &f_{3,i} &f_{1,i-1} &f_{2,i-1} &f_{3,i-1}\n\\end{bmatrix}\n$\n\u521d\u59cb\u5316 $f_{1,2}\\gets 1,f_{2,2}\\gets 1$,\u5bf9\u4e2d\u95f4\u77e9\u9635\u8fdb\u884c $m-2$ \u6b21\u5feb\u901f\u5e42\u3002\n\n\u8d34\u51fa\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int mod=30011;\nclass mat{\n    private:\n        int n,m;\n\t\n    public:\n        unsigned long long int a[101][101];\n        mat(int x,int y,bool flag=0){\n            memset(a,0,sizeof(a));\n            n=x;\n            m=y;\n            if(flag&&n==m)\n                for(int i=1;i<=n;i++)\n                    a[i][i]=1;\n        }\n        mat operator+(mat &b){\n            if(b.n==n&&b.m==m){\n                mat ans(n,m);\n                for(int i=1;i<=n;i++)\n                    for(int j=1;j<=n;j++)\n                        ans.a[i][j]=b.a[i][j]+a[i][j],ans.a[i][j]%=mod;\n                return ans;\n            }\n        }\n        mat operator*(mat &b){//\u77e9\u9635\u4e58\u6cd5\n            if(b.n==m){\n                mat ans(n,b.m);\n                for(int i=1;i<=n;i++)\n                    for(int j=1;j<=b.m;j++)\n                        for(int k=1;k<=m;k++)\n                            ans.a[i][j]=(ans.a[i][j]+(long long )a[i][k]*b.a[k][j]%mod)%mod;\n                return ans;\n            }\n        }\n        mat pw(unsigned long long int t){\n            if(n==m){\n                mat re(n,n,1);\n                if(t==0)\n                    return re;\n                if(t%2)re=re*(*this);\n                mat ans(n,n);\n                ans=pw(t/2);\n                re=re*ans*ans;\n                return re;\n            }\n        }\n        void display(){\n            for(int i=1;i<=n;i++){\n                for(int j=1;j<=m;j++)\n                    printf(\"%d \",a[i][j]);\n                printf(\"\\n\");\n            }\n        }\n};\nint main(){\n    long long int n,m;\n    cin>>n>>m;\n    if(n==0){\n        cout<<\"0\";\n        return 0;\n    }\n    mat x(1,2*n);\n    x.a[1][1]=x.a[1][2]=1;//\u521d\u59cb\u5316\n    mat A(2*n,2*n);\n    for(int i=1;i<=n;i++){\n        A.a[i-1>0?i-1:i][i]=1;\n        A.a[i][i]=1;\n        A.a[i+1<=n?i+1:i][i]=1;\n        A.a[i+n][i]=1;\n    }\n    for(int i=1;i<=n;i++){\n        A.a[i][i+n]=1;\n    }//\u4e2d\u95f4\u77e9\u9635\u7684\u521d\u59cb\u5316\n    A=A.pw(m-2);//\u5feb\u901f\u5e42\n    x=x*A;\n    cout<<x.a[1][n];\n    return 0;\n}\n```\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^{3}log_{2}m)$,\u671f\u671b\u5f97\u5206 $100$ \u5206\uff0c\u5b9e\u9645\u5f97\u5206 $90$ \u5206\u3002\n\n**\u9519\u5728\u54ea\u4e86\uff1f**\n\n\u3010\u6b63\u89e3\uff1a\u7279\u5224\uff08~~\u4e0d\u662f\u7279\u5224\u6d4b\u8bd5\u70b9~~\uff09\u3011\n\n~~WA\u6389\u7b2c\u516d\u4e2a\u70b9\u7684\u6211\u597d\u96be\u53d7~~\uff0c\n\n~~\u4e00\u901a\u4e71\u8bd5\u540e~~\uff0c\u6211\u627e\u5230\u4e86\u4e00\u4e2a\u7279\u6b8a\u60c5\u51b5\uff1a\n\n\u5f53 $n=1$ \u65f6\uff0c\u5982\u679c~~\u8349\u7387\u5730~~\u8fdb\u884c `x.a[1][1]=x.a[1][2]=1;` \u7684\u8bdd\uff0c\u4f1a\u51fa\u73b0\u521d\u59cb\u7684\u60c5\u51b5\u9519\u8bef\uff1a\n\n$f_{1,2}=1,f_{1,1}=1$\uff08\u6211\u5e94\u8be5\u662f $0$ \u554a\uff09\u3002\n\n\u52a0\u4e0a\u8fd9\u4e00\u6761\u7279\u5224\uff0c\u6ee1\u5206\u4ee3\u7801\uff1a\n\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int mod=30011;\nclass mat{\n    private:\n        int n,m;\n\t\n    public:\n        unsigned long long int a[101][101];\n        mat(int x,int y,bool flag=0){\n            memset(a,0,sizeof(a));\n            n=x;\n            m=y;\n            if(flag&&n==m)\n                for(int i=1;i<=n;i++)\n                    a[i][i]=1;\n        }\n        mat operator+(mat &b){\n            if(b.n==n&&b.m==m){\n                mat ans(n,m);\n                for(int i=1;i<=n;i++)\n                    for(int j=1;j<=n;j++)\n                        ans.a[i][j]=b.a[i][j]+a[i][j],ans.a[i][j]%=mod;\n                return ans;\n            }\n        }\n        mat operator*(mat &b){//\u77e9\u9635\u4e58\u6cd5\n            if(b.n==m){\n                mat ans(n,b.m);\n                for(int i=1;i<=n;i++)\n                    for(int j=1;j<=b.m;j++)\n                        for(int k=1;k<=m;k++)\n                            ans.a[i][j]=(ans.a[i][j]+(long long )a[i][k]*b.a[k][j]%mod)%mod;\n                return ans;\n            }\n        }\n        mat pw(unsigned long long int t){\n            if(n==m){\n                mat re(n,n,1);\n                if(t==0)\n                    return re;\n                if(t%2)re=re*(*this);\n                mat ans(n,n);\n                ans=pw(t/2);\n                re=re*ans*ans;\n                return re;\n            }\n        }\n        void display(){\n            for(int i=1;i<=n;i++){\n                for(int j=1;j<=m;j++)\n                    printf(\"%d \",a[i][j]);\n                printf(\"\\n\");\n            }\n        }\n};\nint main(){\n    long long int n,m;\n    cin>>n>>m;\n    if(n==0){\n        cout<<\"0\";\n        return 0;\n    }\n    mat x(1,2*n);\n    x.a[1][1]=x.a[1][n>1?2:1]=1;//\u521d\u59cb\u5316\n    mat A(2*n,2*n);\n    for(int i=1;i<=n;i++){\n        A.a[i-1>0?i-1:i][i]=1;\n        A.a[i][i]=1;\n        A.a[i+1<=n?i+1:i][i]=1;\n        A.a[i+n][i]=1;\n    }\n    for(int i=1;i<=n;i++){\n        A.a[i][i+n]=1;\n    }//\u4e2d\u95f4\u77e9\u9635\u7684\u521d\u59cb\u5316\n    A=A.pw(m-2);//\u5feb\u901f\u5e42\n    x=x*A;\n    cout<<x.a[1][n];\n    return 0;\n}\n```\n\n\n\u3010\u603b\u7ed3\u3011\n\n\u505a\u9898\u8fc7\u7a0b\uff1a\u666e\u901aDP$\\to$ ~~\u4e00\u770b\u5c31TLE~~$\\to$ \u4f18\u5316DP$\\to$ ~~\u7ee7\u7eedTLE~~$\\to$ \u60f3\u5230\u77e9\u9635\u4f18\u5316 $\\to$ \u6ca1\u6709\u7279\u5224Orz$\\to$ \u52a0\u4e0a\u7279\u5224 $\\to$AC\u3002",
        "postTime": 1614418028,
        "uid": 400195,
        "name": "momoli",
        "ccfLevel": 7,
        "title": "P3990 \u8d85\u7ea7\u8df3\u9a6c \u9898\u89e3"
    }
]