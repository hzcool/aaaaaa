[
    {
        "content": "> \u7701\u6d41\uff1a\u79bb\u7ebf\u4ee5\u540e\uff0c\u6bcf\u4e2a\u5b57\u7b26\u505a\u524d\u7f00\u548c\u7136\u540e\u76f4\u63a5\u6c34\u8fc7\u53bb  \n\n\u9996\u5148\u79bb\u7ebf\u6240\u6709\u8be2\u95ee\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u82f1\u6587\u5b57\u6bcd\uff0c\u6211\u4eec\u628a\u67e5\u8be2\u8fd9\u4e2a\u5b57\u6bcd\u7684\u8be2\u95ee\u90fd\u4e00\u8d77\u5904\u7406\u3002  \n\u5bf9\u4e8e\u6bcf\u4e2a\u5b57\u6bcd $c$\uff0c\u6211\u4eec\u8dd1\u4e00\u904d\u524d\u7f00\u548c\uff0c\u4ee4 $p_i$ \u8868\u793a $\\mathit{s}_{1,i}$ \u4e2d\u5b57\u7b26 $c$ \u51fa\u73b0\u7684\u6b21\u6570\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u5b9a\u4e49 $\\operatorname{f}(i,l,r)$ \u4e3a $\\mathit{s}_{l,r}$ \u4e2d\u5b57\u7b26 $i$ \u51fa\u73b0\u7684\u6b21\u6570\u3002  \n\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee:  \n\u9996\u5148\u6c42\u51fa\u7b2c $a_i$ \u884c\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u662f\u4ec0\u4e48\uff0c\u8fd9\u7b49\u4ef7\u4e8e\u6c42\u524d $a_i-1$ \u884c\u7684\u5143\u7d20\u4e2a\u6570\u52a0\u4e00\u518d\u5bf9\u5b57\u7b26\u4e32\u957f\u5ea6\u53d6\u6a21\u3002\u6ce8\u610f\u5230 $n$ \u5728 `long long` \u8303\u56f4\u5185\uff0c\u56e0\u6b64\u6211\u4eec\u91c7\u53d6\u4e0b\u9762\u7684\u51fd\u6570\u8ba1\u7b97\u9996\u4e2a\u5b57\u7b26 $p$\u3002\n```\nlong long getP(long long r) {\n    if (r & 1) {\n        return r % m * (((r + 1) >> 1) % m) % m;\n    } else {\n        return (r >> 1) % m * ((r + 1) % m) % m;\n    }\n}\n```\n\u63a5\u4e0b\u6765\u5bf9\u8be2\u95ee\u7684\u957f\u5ea6\u8fdb\u884c\u5206\u8ba8\u3002  \n\u8981\u4e48\u8fd9\u884c\u4e00\u76f4\u5230\u6700\u540e\u90fd\u548c $p$ \u5728\u540c\u4e00\u5b57\u7b26\u4e32\u5faa\u73af\u91cc\uff0c\u90a3\u4e48\u7b54\u6848\u663e\u7136\u662f $\\operatorname{f}(p, p + a_i - 1)$\u3002  \n\u8981\u4e48\u6211\u4eec\u53ef\u4ee5\u628a\u7b2c $a_i$ \u884c\u5206\u6210\u4e09\u90e8\u5206\uff1a\u524d\u9762\u7684\u6563\u5757\uff0c\u4e2d\u95f4\u7684\u82e5\u5e72\u6574\u5757\u548c\u540e\u9762\u7684\u6563\u5757\u3002\u6b64\u65f6\u5206\u522b\u5904\u7406\u5e76\u76f8\u52a0\uff0c\u4e0d\u96be\u5f97\u51fa $\\operatorname{query}(a_i,c_i)$ \u53ef\u4ee5\u88ab\u5199\u6210 $\\operatorname{f}(c_i,\\;p,\\;len - 1) + \\operatorname{f}(c_i,\\;0,\\;len - 1) \\times (\\frac{a_i-len-p}{len})+[len\\bmod m\\not= 0]\\times\\operatorname{f}(c_i,0,(a_i-p) \\bmod m)$\u3002  \n> \u4e0a\u9762\u7684\u516c\u5f0f\u770b\u8d77\u6765\u5f88\u590d\u6742\uff0c\u5176\u5b9e\u5c31\u662f\u4e09\u5757\u5206\u522b\u52a0\u8d77\u6765\n\n\u7efc\u5408\u4e0a\u8ff0\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u6b64\u9898\u7684\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\u3002\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\nconst int maxM = 1000000;\nconst int maxK = 50000;\n\nstruct query {\n    long long row;\n    int id;\n    query(long long row = 0, int id = 0) : row(row), id(id) {}\n};\n\nlong long n, m, k, a, ans[maxK];\nchar w[maxM + 1];\nint p[maxM];\nvector<query> Q[26];\n\nlong long getP(long long r) {\n    if (r & 1) {\n        return r % m * (((r + 1) >> 1) % m) % m;\n    } else {\n        return (r >> 1) % m * ((r + 1) % m) % m;\n    }\n}\n\nint f(int p1, int p2) {\n    return p[p2] - (p1 != 0 ? p[p1 - 1] : 0);\n}\n\nlong long solve(long long r) {\n    int p = getP(r - 1);\n    long long ans = 0, len = r - (m - p);\n    if (p + r <= m)\n        return f(p, p + r - 1);\n    ans = f(p, m - 1) + f(0, m - 1) * (len / m);\n    return ans + (!!(len % m)) * f(0, len % m - 1);\n}\nchar c;\nint main() {\n    scanf(\"%d\", &n);scanf(\"%s\", w);scanf(\"%d\", &k);\n    m = strlen(w);\n    for (int i = 0; i < k; ++i) {\n        scanf(\"%lld %c\", &a, &c);\n        Q[c - 'A'].push_back(query(a, i));\n    }\n\n    for (int i = 0; i < 26; ++i) {\n        for (int j = 0; j < m; ++j) {\n            p[j] = (w[j] - 'A' == i) + (!!j) * p[j - 1];\n        }\n        for (int j = 0; j < Q[i].size(); ++j)\n            ans[Q[i][j].id] = solve(Q[i][j].row);\n    }\n\n    for (int i = 0; i < k; ++i)\n        printf(\"%lld\\n\", ans[i]);\n    return 0;\n}\n\n\n```\n",
        "postTime": 1682598757,
        "uid": 762646,
        "name": "Piggy424008",
        "ccfLevel": 6,
        "title": "P6416 \u9898\u89e3"
    }
]