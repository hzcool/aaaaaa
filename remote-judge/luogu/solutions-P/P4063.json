[
    {
        "content": "\u53d1\u4e00\u4e2a\u4e0d\u4e00\u6837\u7684\u505a\u6cd5~~~~\n\n\u8003\u8651\u9001\u540e\u5f80\u524d\u6784\u9020$A[i]$\n\n\u6700\u540e\u4e24\u4e2a:$A[n],A[n-1]$\u662f\u53ef\u4ee5\u5206\u522b\u5728$1-r[n],1-r[n-1]$\u4e2d\u4efb\u610f\u9009.\n\n\u7136\u540e\u53d1\u73b0$A[n-2]$\u4e0d\u80fd\u5728$A[n]$\u4e0e$A[n-1]$\u4e4b\u95f4\n\u4f46\u53ef\u4ee5\u662f$A[n]$\n\n\u56e0\u4e3a\u5fc5\u987b\u6ee1\u8db3$A[n-2]> A[n-1] > A[n]$\u6216\u8005$A[n-2] < A[n-1] < A[n]$\u6216\u4e09\u8005\u76f8\u7b49\n\n\u540c\u7406$A[n-3]$\u4e5f\u6ee1\u8db3\u6b64\u6761\u4ef6\u4e14\u8fd8\u4e0d\u80fd\u5728$A[n-2]$\u4e0e$A[n-1]$\u4e4b\u95f4(\u56e0\u4e3a\u4e0a\u9762\u6761\u4ef6\u9650\u5236\u6240\u4ee5$A[n-1]$\u4e5f\u4e0d\u884c)\u3002\n\n\u540c\u7406$A[n-k]$\u2026\u2026\n\n\u5f53\u4ece\u540e\u5411\u524d\u9009\u81f3$A[i]$\u65f6\uff0c\u4e0d\u80fd\u9009\u7684\u503c\u4e00\u5b9a\u4e3a\u4e00\u4e2a\u533a\u95f4\u3002\n\n\u8bbe$d(bt,tp,i)$\u4e3a\u5f53\u524d\u9009\u62e9$A[i]$,\u4e0d\u80fd\u9009\u7684\u533a\u95f4\u4e3a$[bt,tp]$\n\n\u56e0\u4e3a$A[i+1]\\in [bt,tp]$\u6240\u4ee5\u82e5$A[i]=k$\u5219\u7531$d(k,tp,i-1),k<bt$\u6216$d(bt,k,i-1),k>tp$\u8f6c\u79fb\u8fc7\u6765\u3002\uff08\u56e0\u4e3a$A[i-1]$\u4e0d\u80fd\u5728$A[i]$\u4e0e$A[i+1]$\u4e4b\u95f4\u3002\uff09\n\n\u4f46\u6709\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\u5373$A[n]=A[n-1]=A[n-2]=...=A[n-k]$\u65f6$A[n-k-1]$\u53ef\u4ee5\u7b49\u4e8e$A[n-k]$\u6216\u8005\u4e0d\u7b49\u4e8e\u3002\u82e5\u4e0d\u7b49\u4e8e\uff0c\u5219\n$A[n-k-2]$\u53ef\u4ee5\u7b49\u4e8e$A[n-k]$\uff08\u6bd4\u5982$A[n-2]$\u53ef\u4ee5\u7b49\u4e8e$A[n]$)\u800c\u4e14\u6b64\u65f6\u5fc5\u5b9a$bt=tp=A[n-k]$\u6240\u4ee5bt\u6216tp\u4e0d\u5728$A[n-k-2]$\u7684\u4e0d\u53ef\u53d6\u8303\u56f4\u5185\u3002\n\n\u8bbe$d(bt,tp,i,o)$\uff0c$o=1$\u65f6\u6ee1\u8db3\u8fd9\u79cd\u60c5\u51b5\uff0c$o=0$\u5219\u4e0d\u6ee1\u8db3\u3002\n\n\u8fb9\u754c$d(bt,tp,0,o)=1$.\n\n\u72b6\u6001$O(nr_i^2)$\u4e2a\uff0c\u8f6c\u79fb$O(r_i)$\n\u8bb0\u5fc6\u5316\u641c\u7d22\u5b9e\u9645\u4e0a\u6ca1\u90a3\u4e48\u591a\u72b6\u6001\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<iostream>\nusing namespace std;\nconst int p=998244353;\nconst int N=52,R=152;\nint d[R][R][N][2],r[N];\nint dp(int bt,int tp,int cur,int o){\n    if(cur==0) return 1;\n    int bot=min(r[cur]+1,bt);\n    int &ans=d[bt][tp][cur][o];\n    if(ans>-1) return ans;\n    ans=0;\n    int k=0;\n    if(bt==tp&&o){\n        k=1,o=0;  //k=1\u65f6tp-1\u6216bt+1\u5c31\u6ca1\u6709\u628atp\u6216bt\u5305\u542b\u5728\u4e0d\u53ef\u53d6\u8303\u56f4\n        if(bt<=r[cur]) ans=(ans+dp(bt,tp,cur-1,1))%p;\n    }\n    for(int i=1;i<bot;i++) ans=(ans+dp(i,tp-k,cur-1,o))%p;\n    for(int i=tp+1;i<=r[cur];i++) ans=(ans+dp(bt+k,i,cur-1,o))%p;\n    return ans;\n}\nint main(){\n    int n;\n    scanf(\"%d\",&n);\n    for(int i=1;i<=n;i++) scanf(\"%d\",&r[i]);\n    memset(d,-1,sizeof(d));\n    int ans=0;\n    for(int i=1;i<=r[n];i++){\n        for(int j=1;j<=r[n-1];j++){\n            int k=ans;\n            if(i==j) ans=(ans+dp(i,j,n-2,1))%p; \n            else if(i<j) ans=(ans+dp(i+1,j,n-2,0))%p;\n            else if(i>j) ans=(ans+dp(j,i-1,n-2,0))%p;//i+1\u6216i-1\u5c31\u6ca1\u6709\u628aA[n]\u5305\u542b\u5728\u4e0d\u53ef\u53d6\u8303\u56f4\n        }\n    }\n    printf(\"%d\\n\",ans);\n    return 0;\n}\n\n```\n\n",
        "postTime": 1523283507,
        "uid": 26556,
        "name": "VSEJGFB",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4063 \u3010[JXOI2017]\u6570\u5217\u3011"
    },
    {
        "content": "\u8fd9\u9898\u7684\u9898\u9762\u5c31\u6bd4\u8f83\u8be1\u5f02\uff0c$A_i$\u4e0d\u80fd\u8d85\u8fc7\u5927\u4e8e\u7b49\u4e8e$A_{i-1}$\u7684\u6700\u5c0f\u503c\uff0c\u8fd8\u4e0d\u80fd\u5c0f\u4e8e\u5c0f\u4e8e\u7b49\u4e8e$A_{i-1}$\u7684\u6700\u5927\u503c\uff0c\u8fd8\u5f97\u8ba1\u6570\uff1f\uff1f\uff1f\u6839\u636e\u54b1\u4eec\u6700\u65e0\u8111\u7684\u60f3\u6cd5\u80af\u5b9a\u662f\u5f97\u77e5\u9053$A_i$\u7684\u53d6\u503c\u533a\u95f4\u4e5f\u5c31\u662f\u4e0a\u9762\u4e24\u4e2a\u6570\u624d\u80fddp\u5bf9\u5427\uff0c\u4f46\u662f\u8fd9\u4e2a\u597d\u50cf\u4e0d\u597d\u8ba1\u5165\u72b6\u6001\u554a\u2026\u2026\n\n\u7136\u540e\u6211\u4eec\u4ed4\u7ec6\u89c2\u5bdf\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u80fd\u8f6c\u5316\u6210\u8fd9\u4e48\u4e2a\u7ed3\u8bba\uff1a**\u5982\u679c$A_i>=A_{i-1}$\uff0c\u90a3\u4e48$A_{i-1}$\u5c31\u662f\u5c0f\u4e8e\u7b49\u4e8e$A_i$\u7684\u6700\u5927\u503c\uff0c\u5982\u679c$A_i>=A_{i-1}$\uff0c\u90a3\u4e48$A_{i-1}$\u5c31\u662f\u5927\u4e8e\u7b49\u4e8e$A_i$\u7684\u6700\u5c0f\u503c\u3002**\n\n\u8fd9\u4e2a\u7ed3\u5408\u9898\u9762\u6765\u8bfb\u8bfb\u770b\uff0c\u4f3c\u4e4e\u662f\u6bd4\u8f83\u663e\u7136\u7684\u5427\u3002\u4e0d\u8fc7\u8981\u6ce8\u610f\u5982\u679c$A_i$\u53d6\u4e86\u5c0f\u4e8e\u7b49\u4e8e$A_{i-1}$\u7684\u6700\u5927\u503c\u6216\u8005\u5927\u4e8e\u7b49\u4e8e$A_{i-1}$\u7684\u6700\u5c0f\u503c\u7684\u8bdd\u90a3\u4e48\u5b83\u4e0d\u4e00\u5b9a\u5c31\u662f$A_{i-1}$\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u540e\u9762\u7684\u6240\u6709\u6570\u90fd\u5fc5\u987b\u53d6$A_i$\uff0c\u8fd9\u662f\u4e2a\u8fb9\u754c\u60c5\u51b5\u3002\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u5982\u679c\u77e5\u9053$A_{i-1}$\u7684\u53d6\u503c\u8303\u56f4\u7684\u8bdd\u53ef\u4ee5\u63a8\u51fa$A_i$\u7684\uff0c\u90a3\u8fd9\u4e0d\u5c31\u80fddp\u4e86\uff1f$dp[i][j][k][l]$\u8868\u793a\u524d$i$\u4e2a\uff0c$A_{i}=j$\uff0c\u5c0f\u4e8e\u7b49\u4e8e$A_i$\u7684\u6700\u5927\u503c\u662f$k$\uff0c\u5927\u4e8e\u7b49\u4e8e$A_i$\u7684\u6700\u5c0f\u503c\u662f$l$\u3002\n\n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u6709\u4e00\u4e2a$O(nr^4)$\u7684\u66b4\u529b\u505a\u6cd5\uff1a\u679a\u4e3ei-1\u7684\u72b6\u6001\uff0c\u7136\u540e\u518d\u679a\u4e3e$A_i$\u7684\u503c\uff0c\u7b80\u5355\u8ba8\u8bba\u4e00\u4e0b$A_i$\u4e0e$A_{i-1}$\u7684\u5927\u5c0f\u5173\u7cfb\u628a$k$\u548c$l$\u8ba8\u8bba\u51fa\u6765\u3002\u8fd9\u662f\u4e2a\u987a\u63a8\u7684dp\u3002\n\n\u5176\u5b9e\u867d\u7136\u5728\u8fd9\u79cd\u8ba1\u6570dp\u9898\u91cc\u987a\u63a8\u6cd5\u6bd4\u8f83\u597d\u60f3\u597d\u5199\uff0c\u4f46\u662f\u5b83\u786e\u5b9e\u4e0d\u5982\u9006\u63a8\u6cd5\u6709\u4f18\u5316\u7684\u4f59\u5730\uff0c\u9006\u63a8\u600e\u4e48\u505a\u5462\uff1f\u6211\u4eec\u679a\u4e3e$A_{i}$\u7684\u72b6\u6001\u7136\u540e\u8981\u627e$A_{i-1}$\u7684\u72b6\u6001\u8f6c\u79fb\uff0c\u7136\u540e\u9664\u975e$j=k=l$\u7684\u65f6\u5019\u6211\u4eec\u8981\u5224\u65ad$A_i$\u4e0e$A_{i-1}$\u6216\u8005\u4e0a\u4e2a$k$\u548c$l$\u76f8\u7b49\u7684\u60c5\u51b5\uff0c\u5269\u4e0b\u7684\u5219\u662f$A_{i-1}=k$\u6216\u8005$A_{i-1}=l$\uff0c\u4f60\u8fd9\u65f6\u5019\u8981\u679a\u4e3e$l$\u6216$k$\uff0c\u8fd9\u8fd8\u662f$O(nr^4)$\u7684\uff0c\u4f46\u662f\u8fd9\u4e2a\u65f6\u5019\u5c31\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u548c\u540e\u7f00\u548c\u4f18\u5316\u5230$O(nr^3)$\u4e86\u3002\n\n\u4e0a\u4ee3\u7801~\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#define p 998244353\nusing namespace std;\nnamespace ywy {\n\tint dp[2][153][153][153], qz[2][153][153][153], hz[2][153][153][153], ints[111];\n\tvoid ywymain() {\n\t    int n;\n\t    cin >> n;\n\t    int mx = 0;\n\t    for (register int i = 1; i <= n; i++) cin >> ints[i], mx = max(mx, ints[i]);\n\t    mx++;\n\t    for (register int i = 1; i <= ints[1]; i++) dp[1][i][0][mx] = 1;\n\t    for (register int j = 1; j <= ints[1]; j++) {\n\t        for (register int l = j; l <= mx; l++) {\n\t            qz[1][j][0][l] = dp[1][j][0][l];\n\t            for (register int k = 1; k <= mx; k++) qz[1][j][k][l] = (qz[1][j][k - 1][l] + dp[1][j][k][l]) % p;\n\t        }\n\t        for (register int k = 0; k <= j; k++) {\n\t            hz[1][j][k][mx] = dp[1][j][k][mx];\n\t            for (register int l = mx - 1; l >= 0; l--)\n\t                hz[1][j][k][l] = (hz[1][j][k][l + 1] + dp[1][j][k][l]) % p;\n\t        }\n\t    }\n\t    for (register int i = 2; i <= n; i++) {\n\t        for (register int j = 0; j <= mx; j++) {\n\t            for (register int k = 0; k <= mx; k++) {\n\t                for (register int l = 0; l <= mx; l++) {\n\t                    dp[i & 1][j][k][l] = qz[i & 1][j][k][l] = hz[i & 1][j][k][l] = 0;\n\t                }\n\t            }\n\t        }\n\t        for (register int j = 1; j <= ints[i]; j++) {\n\t            for (register int k = 0; k <= j; k++) {\n\t                for (register int l = j; l <= mx; l++) {\n\t                    if (j == k && j != l)\n\t                        continue;\n\t                    if (j == l && j != k)\n\t                        continue;\n\t                    if (l == k && l != j)\n\t                        continue;\n\t                    if (j == k && j == l) {\n\t                        for (register int a = 0; a <= j; a++) {\n\t                            for (register int b = j; b <= mx; b++)\n\t                                dp[i & 1][j][k][l] = (dp[i & 1][j][k][l] + dp[(i - 1) & 1][j][a][b]) % p;\n\t                        }\n\t                        for (register int a = k + 1; a <= ints[i - 1]; a++) {\n\t                            for (register int b = a + 1; b <= mx; b++) {\n\t                                dp[i & 1][j][k][l] = (dp[i & 1][j][k][l] + dp[(i - 1) & 1][a][k][b]) % p;\n\t                            }\n\t                        }\n\t                        for (register int a = 1; a <= ints[i - 1] && a < l; a++) {\n\t                            for (register int b = 0; b < a; b++) {\n\t                                dp[i & 1][j][k][l] = (dp[i & 1][j][k][l] + dp[(i - 1) & 1][a][b][l]) % p;\n\t                            }\n\t                        }\n\t                    } else {\n\t                        if (k) {\n\t                            dp[i & 1][j][k][l] = (qz[(i - 1) & 1][k][k - 1][l] + dp[i & 1][j][k][l]) % p;\n\t                        }\n\t                        if (l != mx) {\n\t                            dp[i & 1][j][k][l] = (hz[(i - 1) & 1][l][k][l + 1] + dp[i & 1][j][k][l]) % p;\n\t                        }\n\t                    }\n\t                }\n\t            }\n\t            for (register int l = j; l <= mx; l++) {\n\t                qz[i & 1][j][0][l] = dp[i & 1][j][0][l];\n\t                for (register int k = 1; k <= j; k++)\n\t                    qz[i & 1][j][k][l] = (qz[i & 1][j][k - 1][l] + dp[i & 1][j][k][l]) % p;\n\t            }\n\t            for (register int k = 0; k <= j; k++) {\n\t                hz[i & 1][j][k][mx] = dp[i & 1][j][k][mx];\n\t                for (register int l = mx - 1; l >= 0; l--) {\n\t                    hz[i & 1][j][k][l] = (hz[i & 1][j][k][l + 1] + dp[i & 1][j][k][l]) % p;\n\t                }\n\t            }\n\t        }\n\t    }\n\t    int ans = 0;\n\t    for (register int i = 1; i <= ints[n]; i++) {\n\t        for (register int j = 0; j <= i; j++) {\n\t            for (register int k = i; k <= mx; k++) ans = (ans + dp[n & 1][i][j][k]) % p;\n\t        }\n\t    }\n\t    cout << ans << endl;\n\t}\n}\nint main() {\n    ywy::ywymain();\n    return (0);\n}\n```",
        "postTime": 1551871655,
        "uid": 125124,
        "name": "ywy_c_asm",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4063 \u3010[JXOI2017]\u6570\u5217\u3011"
    },
    {
        "content": "\u6211\u4eec\u53ef\u4ee5\u77e5\u9053$a_i$\u4e4b\u524d\u7684\u6570\u6309\u4ece\u5927\u5230\u5c0f\u7684\u987a\u5e8f\u6392\u5e8f\u4e4b\u540e\uff0c ..... < $L$ $\\leq$ $a_{i-1}$ $\\leq$ $R$ < ....\n\n\u56e0\u4e3a\u8981\u6c42 $ L\\leq a_i \\leq R$, \u90a3\u4e48$a_i$\u53ef\u4ee5\u586b\u7684\u533a\u95f4\u4e3a[L, $a_{i-1}$]\u548c[$a_{i-1}$, R]\uff0c \u6709\u4e00\u4e2a\u6734\u7d20$dp$\uff0c\n\n\u5373$dp[i][k][l][r]$\u8868\u793a\u8003\u8651\u5230\u7b2ci\u4f4d\uff0c \u5f53\u524d\u586bk\uff0c l\u4e3a\u524d\u9a71\uff0c r\u4e3a\u540e\u7ee7\u7684\u65b9\u6848\u6570\uff0c \u8f6c\u79fb\u7684\u8bdd\uff0c \u6211\u4eec\u77e5\u9053\uff0c\n\n$l$\u548c$r$\u5176\u4e2d\u5fc5\u5b9a\u6709\u4e00\u4e2a\u662f\u4e0a\u4e00\u4f4d\u586b\u7684\u6570\uff0c \u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5bf9l\u548cr\u5206\u522b\u7ef4\u62a4\u4e00\u4e2a\u540e\u7f00\u548c\uff0c \u8fd9\u6837\u5c31\u53ef\u4ee5O(1)\n\n\u8f6c\u79fb\u4e86, \u8981\u6ce8\u610f\u586b\u7684\u6570\u548c$l$\u6216$r$\u76f8\u540c\u7684\u65f6\u5019\u8981\u7279\u5224\u4e00\u4e0b\uff0c \u56e0\u4e3a\u6bd4\u5982 $k=1,l=0, r=1$\u8fd9\u4e2a\u72b6\u6001\u662f\u4e0d\u5b58\u5728\u7684\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define reg register\n#define maxn 152\n#define mod 998244353\nusing namespace std;\ninline int  read() {\n    reg int s = 0, t = 0; reg char ch = getchar();\n    while(ch > '9' || ch < '0') t |= ch == '-', ch = getchar();\n    while(ch >= '0' && ch <= '9') s = (s << 1) + (s << 3) + (ch ^ 48), ch = getchar();\n    return t ? -s : s;\n}\nint n, dp[maxn][maxn][maxn], R[maxn], f[maxn][maxn], g[maxn][maxn], ans, w[maxn];\nint main(){\n    n = read();\n    for(int j = 1; j <= n; j++) R[j] = read();\n    for(int i = 1; i <= R[1]; i++) dp[0][i][151] = 1; \n    for(int i = 2; i <= n; i++){\n        memset(f, 0, sizeof f);\n        memset(g, 0, sizeof g);\n        for(int k = 1; k <= 151; k++) w[k] = dp[k][k][k];\n        for(int k = 1; k <= R[i - 1]; k++){\n            for(int l = 0; l < k; l++)\n                for(int r = k + 1; r <= 151; r++){\n                    (w[l] += dp[l][k][r]) %= mod;\n                    (w[k] += dp[l][k][r]) %= mod;\n                    (w[r] += dp[l][k][r]) %= mod;\n                    (f[l][k] += dp[l][k][r]) %= mod;\n                    (g[k][r] += dp[l][k][r]) %= mod; \n                }\n        }\n        memset(dp, 0, sizeof dp);\n        for(int k = 1; k <= R[i]; k++){\n            for(int l = 0; l < k; l++) {\n                for(int r = k + 1; r <= 151; r++){\n                    (dp[l][k][r] += f[l][r]) %= mod;\n                    (dp[l][k][r] += g[l][r]) %= mod;\n                    int p = 1;\n                }\n            }\n             dp[k][k][k] = w[k] % mod; \n            }\n    }\n    for(int i = 1; i <= R[n]; i++)\n        for(int l = 0; l <= i; l++)\n            for(int r = i; r <= 151; r++){\n                (ans += dp[l][i][r]) %= mod;\n             } \n    cout << ans << endl;\n}\n```\n",
        "postTime": 1584661519,
        "uid": 97783,
        "name": "yyxmy",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4063 \u3010[JXOI2017]\u6570\u5217\u3011"
    },
    {
        "content": "\u5728\u672c\u7bc7\u9898\u89e3\u4e2d, \u6211\u4eec\u5b9a\u4e49\u5bf9\u4e8e\u4e24\u4e2a\u533a\u95f4 $[l1, r1], [l2, r2]$ \u7684\u51cf\u6cd5\u64cd\u4f5c. $[l1, r1] - [l2, r2]$ \u7684\u7ed3\u679c\u4e3a\u6240\u6709\u5305\u542b\u5728\u7b2c\u4e00\u4e2a\u533a\u95f4\u800c\u4e0d\u5305\u542b\u5728\u7b2c\u4e8c\u4e2a\u533a\u95f4\u7684 $x$\u6784\u6210\u7684\u96c6\u5408. \u672c\u9898\u89e3\u4e2d\u6211\u4eec\u5c06\u4e0d\u533a\u5206 $[l, r]$ \u548c $[r, l]$.\n\n\u8fd9\u9053\u9898\u76ee\u660e\u663e\u5f88 DP. \u6211\u4eec\u8003\u8651\u5982\u4f55\u5904\u7406\u7b2c\u4e8c\u4e2a\u9650\u5236. \u82e5\u5012\u5e8f\u6784\u9020\u5e8f\u5217, \u8003\u8651\u6bcf\u4e2a\u6570\u7684\u53d6\u503c\u96c6\u5408:\n\n$A_n : [1, r_n]$\n\n$A_{n-1} : [1, r_{n-1}]$\n\n$A_{n-2} : [1, r_{n-2}] - [A_{n-1}, A_n]$(\u8fd9\u662f\u56e0\u4e3a\u82e5 $A_{n-2} \\geq A_{n-1}$\u5219$A_n \\leq A_{n-2}$, \u82e5$A_{n-2} \\leq A_{n-1}$\u5219$A_n \\geq A_{n-2}$)\n\n$A_{n-3} : [1, r_{n-3}] - [A_{n-2}, A_{n-3}]$\n\n$\\cdots$\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0, \u5bf9\u4e8e$A_i$ ($i \\in [1, n-2]$), $A_i$\u7684\u53d6\u503c\u533a\u95f4\u5c31\u662f $[1, r_i] - [A_{i+1}, A_{i+2}]$. \u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5 DP. \u8bbe $dp(i, l, r)$ \u8868\u793a\u586b\u5230 $A_{i}, A_{i+1}=l, A_{i+2}=r$ \u7684\u65b9\u6848\u6570. \u6709\u8f6c\u79fb\u65b9\u7a0b\n\n$dp(i, l, r) = \\sum\\limits_{A_i < \\min(l, r_{i})} dp(i-1, A_i, r) + \\sum\\limits_{r < A_i \\leq r_i} dp(i-1, l, A_i)$\n\n\u4f46\u662f\u6ce8\u610f\u5230\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5: \u82e5 $A_n = A_{n-1} = \\cdots A_{n-k} \\not= A_{n-k-1}$, \u5219\u6b64\u65f6 $A_{n-k-2}$ \u53ef\u4ee5\u53d6\u5230 $A_n$. \u4e3a\u6b64\u6211\u4eec\u52a0\u4e0a\u4e00\u7ef4 t \u8868\u793a\u8fd9\u79cd\u662f\u5426\u662f\u8fd9\u79cd\u72b6\u51b5.\n\n\u6709:\n\n$dp(i,l,r,t) = \\sum\\limits_{A_i < \\min(l, r_{i})} dp(i-1, A_i, r, t) + \\sum\\limits_{r < A_i \\leq r_i} dp(i-1, l, A_i, t) (l\\not= r $ \u6216\u8005 $t\\not= 1)$\n$dp(i,l,r,t) = \\sum\\limits_{A_i < \\min(l, r_{i})} dp(i-1, A_i, r-1, t) + \\sum\\limits_{r < A_i \\leq r_i} dp(i-1, l+1, A_i, t) (l = r $ \u5e76\u4e14 $ t= 1)$\n\nDP \u5373\u53ef.\n\nCode:\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define f(i,x,y) for(int i=x,i##end=y;i<=i##end;++i)\n#define d(i,x,y) for(int i=x,i##end=y;i>=i##end;--i)\n#define ri register int\n#define ll long long\n#define il inline\n#define _ 152\n#define __ 52\n#define mod 998244353\nint max(int x, int y) {return x>y?x:y;} int min(int x, int y) {return x<y?x:y;}\nint dp[__][_][_][2], rof[__], n, ans;\n// dp[i][l][r][t|(0, 1)] \u8868\u793a\u9009\u62e9\u81f3 a[i], a[i]\u7684\u4e0d\u53ef\u53d6\u503c\u533a\u95f4\u4e3a [l, r], \u662f\u5426\u662f\u7279\u6b8a\u60c5\u51b5\n// \u7279\u6b8a\u60c5\u51b5: a[n] = a[n-1] = ... =a[k]; a[k-1] != a[k]; a[k-2] \u53ef\u4ee5\u7b49\u4e8e a[n]\nint main(){\n  f(j,0,_-1) f(k,0,_-1) f(t,0,1) dp[0][j][k][t]=1;\n  scanf(\"%d\", &n); f(i,1,n) scanf(\"%d\", &rof[i]);\n  f(i,1,n-2) f(l,1,_-1) f(r,1,_-1) f(t,0,1) {\n    int rr = min(l, rof[i]+1);\n    if(t&&l==r) {\n      if(l<=rof[i]) dp[i][l][r][t] = (dp[i][l][r][t]+dp[i-1][l][r][1]) % mod;\n      f(j,1,rr-1) dp[i][l][r][t] = (dp[i][l][r][t]+dp[i-1][j][r-1][0]) % mod;\n      f(j,r+1,rof[i]) dp[i][l][r][t] = (dp[i][l][r][t]+dp[i-1][l+1][j][0]) % mod;\n    }\n    else{\n      f(j,1,rr-1) dp[i][l][r][t] = (dp[i][l][r][t] + dp[i-1][j][r][0]) % mod;\n      f(j,r+1,rof[i]) dp[i][l][r][t] = (dp[i][l][r][t] + dp[i-1][l][j][0]) % mod;\n    }\n  }\n  f(i,1,rof[n]) f(j,1,rof[n-1]) {\n    if(i == j) ans = (ans+dp[n-2][i][j][1]) % mod;\n    if(i < j) ans = (ans+dp[n-2][i+1][j][0]) % mod;\n    if(i > j) ans = (ans+dp[n-2][j][i-1][0]) % mod;\n  }\n  printf(\"%d\\n\", ans);\n  return 0;\n}\n// sto wyxkk orz\n```",
        "postTime": 1583658567,
        "uid": 133345,
        "name": "lightup37",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4063 \u3010[JXOI2017]\u6570\u5217\u3011"
    },
    {
        "content": "[\u9898\u76ee](https://www.luogu.org/problem/P4063)\n\n\u4e00\u4e2a\u4e0d\u592a\u4e00\u6837\u7684\u505a\u6cd5\n\n\u5f53$A_{i-1}=x$\uff0c\u79f0$A_1$\u5230$A_{i-2}$\u4e2d\u5927\u4e8e\u7b49\u4e8e$A_{i-1}$\u7684\u6700\u5c0f\u503c$R$\u4e3a\u4e0a\u754c\uff0c$A_1$\u5230$A_{i-2}$\u4e2d\u5c0f\u4e8e\u7b49\u4e8e$A_{i-1}$\u7684\u6700\u5927\u503c$L$\u4e3a\u4e0b\u754c\u3002\u5bf9\u4e8e\u4e00\u7ec4$(L,R,x)$\u663e\u7136\u6709$L\\leq x\\leq R$\uff0c\u6211\u4eec\u4e0b\u4e00\u4e2a\u80fd\u586b\u7684\u6570\u4e5f\u53ea\u80fd\u5728\u8fd9\u4e2a\u8303\u56f4\u5185\u3002\n\n\u5f53\u6211\u4eec$A_i=y$\u7684\u65f6\u5019\uff0c\u8003\u8651\u65b0\u7684\u4e0a\u4e0b\u754c\u5206\u522b\u662f\u8c01\u3002\n\n\u5f53$x\\leq y\\leq R$\u7684\u65f6\u5019\uff0c\u663e\u7136\u5c0f\u4e8e\u7b49\u4e8e$y$\u4e2d\u6700\u5927\u7684\u662f$x$\uff0c\u5927\u4e8e\u7b49\u4e8e$y$\u4e2d\u6700\u5927\u7684\u662f$R$\uff0c\u6240\u4ee5\u65b0\u7684\u4e0b\u754c\u662f$x$\uff0c\u4e0a\u754c$R$\uff0c\u4e09\u5143\u7ec4\u53d8\u6210\u4e86$(x,R,y)$\n\n\u5f53$L\\leq y< x$\u7684\u65f6\u5019\uff0c\u65b0\u7684\u4e0a\u754c\u662f$x$\uff0c\u4e0b\u754c\u662f$L$\uff0c\u4e09\u5143\u7ec4\u53d8\u6210\u4e86$(L,x,y)$\n\n\u5230\u8fd9\u91cc\u6211\u4eec\u5c31\u53ef\u4ee5\u5199\u4e00\u4e2adp\u4e86\uff0c\u8bbe$f_{i,j,k,p}$\u8868\u793a\u586b\u4e86$i$\u4e2a\u6570\uff0c\u672b\u5c3e\u4e09\u5143\u7ec4\u7684\u72b6\u6001\u662f$(j,k,p)$\uff0c\u8f6c\u79fb\u7684\u65f6\u5019\u679a\u4e3e\u4e0b\u4e00\u4f4d\u586b\u4ec0\u4e48\u63a8\u51fa\u4e0b\u4e00\u4e2a\u4e09\u5143\u7ec4\u5373\u53ef\u3002\u72b6\u6001\u6570\u662f$O(nr_i^3)$\uff0c\u8f6c\u79fb\u662f$O(r_i)$\u7684\uff0c\u590d\u6742\u5ea6\u662f$O(nr_i^4)$\u4e0d\u662f\u5f88\u80fd\u63a5\u53d7\n\n\u518d\u89c2\u5bdf\u4e00\u4e0b\u8fd9\u4e2adp\u7684\u8f6c\u79fb\uff0c\u53d1\u73b0\u5b83\u975e\u5e38\u522b\u81f4\uff0c\u6211\u4eec\u679a\u4e3e\u4e0b\u4e00\u4f4d\u586b\u7684\u6570$y$\n\n\u5f53$p\\leq y\\leq k$\uff0c$f_{i,j,k,p}$\u5411$f_{i+1,x,k,y}$\u8f6c\u79fb\uff0c**\u8fd9\u4e2a\u8f6c\u79fb\u548c$j$\u8fd9\u4e00\u7ef4\u6ca1\u6709\u5173\u7cfb**\n\n\u5f53$j\\leq y< p$\uff0c$f_{i,j,k,p}$\u5411$f_{i+1,j,x,y}$\u8f6c\u79fb\uff0c**\u8fd9\u4e2a\u8f6c\u79fb\u548c$k$\u8fd9\u4e00\u7ef4\u6ca1\u6709\u5173\u7cfb**\n\n\u8003\u8651\u4e00\u4e0b\u662f\u5426\u53ef\u4ee5\u53bb\u6389\u4e00\u7ef4\uff0c\u4e0a\u4e0b\u754c\u4e2d\u53ea\u4fdd\u5b58\u4e00\u4e2a\u80fd\u5426\u8fdb\u884c\u8f6c\u79fb\n\n\u663e\u7136\u662f\u53ef\u4ee5\u7684\uff0c\u8bbe$dp_{i,j,k}$\u8868\u793a\u5f53\u524d\u586b\u4e86$i$\u4e2a\u6570\uff0c\u4e0a/\u4e0b\u754c\u4e3a$j$\uff0c\u672b\u5c3e\u586b\u7684\u6570\u4e3a$k$\u3002\u6211\u4eec\u5f3a\u884c\u89c4\u5b9a\u5f53$k\\leq j$\u7684\u65f6\u5019\uff0c$j$\u4e3a\u4e0a\u754c\uff1b\u5f53$k>j$\u7684\u65f6\u5019\uff0c$j$\u4e3a\u4e0b\u754c\n\n\u5373\u5bf9\u4e8e\u539f\u6765\u7684$f_{i,j,k,p}$\u62c6\u5206\u6210\u4e86\u4e24\u4e2a\u72b6\u6001$dp_{i,j,p}$\u548c$dp_{i,k,p}$\uff0c\u8fd9\u4e24\u4e2a\u72b6\u6001\u5404\u81ea\u5b8c\u6210$f_{i,j,k,p}$\u7684\u4e00\u90e8\u5206\u8f6c\u79fb\u3002\u5176\u4e2d$dp_{i,j,p}$\u8d1f\u8d23$j\\leq y<p$\u7684\u8f6c\u79fb\uff1b$dp_{i,k,p}$\u8d1f\u8d23$p\\leq y\\leq k$\u7684\u8f6c\u79fb\u3002**\u6ce8\u610f\u8f6c\u79fb\u4e4b\u540e\u5f97\u5230\u7684\u4ecd\u65e7\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u4e0a\u4e0b\u754c\u90fd\u6709\u7684\u72b6\u6001\uff0c\u6211\u4eec\u8fd8\u662f\u8981\u628a\u8fd9\u4e2a\u72b6\u6001\u62c6\u5206\u4e00\u4e0b**\u3002\n\n\u8f6c\u79fb\u7684\u65f6\u5019\u8fd8\u662f\u679a\u4e3e\u4e0b\u4e00\u4f4d\u586b\u4ec0\u4e48\u6570\uff0c\u6839\u636e\u586b\u7684\u6570\u63a8\u51fa\u8f6c\u79fb\u7684\u72b6\u6001\u5373\u53ef\u3002\u6ce8\u610f\u5f53\u4e00\u4e0b\u4f4d\u586b\u7684\u6570\u548c\u4e0a\u4e0b\u754c\u76f8\u7b49\u65f6\uff0c\u65b0\u7684\u4e0a\u4e0b\u754c\u5c31\u56fa\u5b9a\u4e86\u3002\n\n\u8fd9\u6837\u7684\u72b6\u6001\u6570\u5c31\u53d8\u6210\u4e86$O(nr_i^2)$\uff0c\u590d\u6742\u5ea6\u662f$O(nr_i^3)$\uff0c\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u8dd1\u7684\u6bd4\u8f83\u5feb\uff0cluogu\u6700\u4f18\u89e3\uff0cloj\u4f4d\u5217rk3\n\n\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define re register\n#define max(a,b) ((a)>(b)?(a):(b))\ninline int read() {\n\tchar c=getchar();int x=0;while(c<'0'||c>'9') c=getchar();\n\twhile(c>='0'&&c<='9') x=(x<<3)+(x<<1)+c-48,c=getchar();return x;\n}\nconst int maxn=155;\nconst int mod=998244353;\ninline int qm(int x) {return x>=mod?x-mod:x;}\nint h[55],n,o,R,dp[2][maxn][maxn];\nint main() {\n\tn=read();for(re int i=1;i<=n;i++) h[i]=read(),R=max(R,h[i]);R++;\n\tfor(re int i=1;i<=h[2];++i) \n\t\tfor(re int j=1;j<=h[1];++j) {\n\t\t\tif(j>=i) {if(i!=j) dp[0][i][0]++;}\n\t\t\telse dp[0][i][R]++;\n\t\t\tdp[0][i][j]++;\n\t\t}\n\tfor(re int i=3;i<=n;i++,o^=1) {\n\t\tmemset(dp[o^1],0,sizeof(dp[o^1]));\n\t\tfor(re int j=1;j<=h[i-1];j++)\n\t\t\tfor(re int k=0;k<=R;++k) {\n\t\t\t\tif(!dp[o][j][k]) continue;\n\t\t\t\tif(k<j) {\n\t\t\t\t\tfor(re int p=k;p<j;p++)\n\t\t\t\t\tif(p<=h[i]&&p>0) {\n\t\t\t\t\t\tif(p==k) {\n\t\t\t\t\t\t\tdp[o^1][p][p]=qm(dp[o^1][p][p]+dp[o][j][k]);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdp[o^1][p][k]=qm(dp[o^1][p][k]+dp[o][j][k]);\n\t\t\t\t\t\tdp[o^1][p][j]=qm(dp[o^1][p][j]+dp[o][j][k]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tfor(re int p=j;p<=k;++p)\n\t\t\t\t\tif(p<=h[i]&&p>0) {\n\t\t\t\t\t\tif(p==j||p==k) {\n\t\t\t\t\t\t\tdp[o^1][p][p]=qm(dp[o^1][p][p]+dp[o][j][k]);\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdp[o^1][p][j]=qm(dp[o^1][p][j]+dp[o][j][k]);\n\t\t\t\t\t\tdp[o^1][p][k]=qm(dp[o^1][p][k]+dp[o][j][k]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t}\n\tint ans=0;\n\tfor(re int i=1;i<=h[n];++i)\n\t\tfor(re int j=i;j<=R;++j) ans=qm(ans+dp[o][i][j]);\n\treturn !printf(\"%d\\n\",ans);\n}\n```\n\n\n\n",
        "postTime": 1570838592,
        "uid": 35178,
        "name": "asuldb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4063 \u3010[JXOI2017]\u6570\u5217\u3011"
    }
]