[
    {
        "content": "[Youngsc](https://youngscc.github.io/)\n\n** %% \u697c\u4e0b\u5927\u4f6c\u66b4\u529b\u6c34\u8fc7 **  \n** \u8eab\u4e3a\u849f\u84bb\u7684\u6211\u66b4\u529b\u5199\u6302\u4e86\uff0c\u5c31\u7801\u4e86\u4e00\u53d1\u53ef\u6301\u4e45\u5316\u6743\u503c\u5b57\u5178\u6811 **  \n** \u53ef\u6301\u4e45\u5316\u6743\u503c\u5b57\u5178\u6811\u548c\u53ef\u6301\u4e45\u5316\u7684\u6743\u503c\u7ebf\u6bb5\u6811\u975e\u5e38\u7c7b\u4f3c\uff0c\u4f1a\u5199\u4e3b\u5e2d\u6811\u5c31\u80fd\u7801\u51fa\u6765\u53ef\u6301\u4e45\u5316trie **  \n** \u6211\u4eec\u679a\u4e3e\u6bcf\u4e00\u4e2a\u503c\u4f5c\u4e3a\u6b21\u5927\u503c\u7684\u60c5\u51b5 **  \n** \u4e0d\u59a8\u8bbe\u5f53\u524d\u6570\u5b57\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u4e0b\u6807\u4e3a$l_1$,\u7b2c\u4e8c\u4e2a\u6bd4\u5b83\u5927\u7684\u8bb0\u4f5c$l_2$ **  \n** \u540c\u7406\u8bbe\u5f53\u524d\u6570\u5b57\u53f3\u8fb9\u7b2c\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u4e0b\u6807\u4e3a$r_1$,\u7b2c\u4e8c\u4e2a\u6bd4\u5b83\u5927\u7684\u8bb0\u4f5c$r_2$ **  \n** \u90a3\u4e48\u5bf9\u4e8e\u4e00\u4e2a\u6570\u5b57\u6765\u8bf4\uff0c\u5b83\u80fd\u4f5c\u4e3a\u6b21\u5927\u503c\u7684\u533a\u95f4\u6709\u5f88\u591a\uff0c\u4f46\u6211\u4eec\u53ea\u53d6\u4e24\u4e2a\u533a\u95f4 **\n** \u5206\u522b\u662f$[l_1+1,R_2-1]$\u548c$[l_2+1,R_1-1]$\uff0c\u5176\u4ed6\u7684\u533a\u95f4\u90fd\u662f\u8fd9\u4e24\u4e2a\u533a\u95f4\u7684\u5b50\u96c6**  \n** \u8981\u5904\u7406\u8fd9\u4e2a\u7684\u8bdd\u6211\u4eec\u53ef\u4ee5\u501f\u52a9\u94fe\u8868\uff0c\u5c06\u5143\u7d20\u6309\u7167\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u4f9d\u6b21\u5220\u9664 **  \n** \u6bcf\u6b21\u5220\u9664\u4e4b\u524d\u5f53\u524d\u4f4d\u7f6e\u5de6\u53f3\u4e00\u5171\u56db\u4e2a\u5143\u7d20\u5c31\u662f\u4e0a\u8ff0\u7684\u56db\u4e2a\u5143\u7d20 **  \n** \u5f53\u7136\uff0c\u5982\u679c\u4e00\u4e2a\u5143\u7d20\u5de6\u8fb9\u6ca1\u6709\u6bd4\u4ed6\u5927\u7684\u6216\u8005\u53f3\u8fb9\u6ca1\u6709\u6bd4\u4ed6 \u5927\u7684\u5c31\u9700\u8981\u7279\u5224 **  \n** \u7136\u540e\u5c31\u5728\u533a\u95f4\u5185\u7684trie\u4e0a\u8d2a\u5fc3\u7684\u4ece\u9ad8\u4f4d\u5230\u4f4e\u4f4d\u53d6\u53cd **  \n\n```cpp\n# include <bits/stdc++.h>\n# define R register\n# define N 50010\n# define inf 2000101900\n\nusing namespace std;\n\nint n,a[N],t[N*35],ch[N*35][2],ans,pre[N],nxt[N],rt[N],cnt;\n\npair <int,int> b[N];\n\ntemplate <typename T> inline void in(R T &a){\n    R char c = getchar();R T x=0,f=1;\n    while(!isdigit(c)) {if(c == '-') f=-1; c=getchar();}\n    while(isdigit(c)) x=(x<<1)+(x<<3)+c-'0',c = getchar();\n    a=x*f;\n}\n\ntemplate <typename T> inline void maxx(R T& a,const T b){a<b ? a=b:0;}\ntemplate <typename T> inline void minn(R T& a,const T b){a>b ? a=b:0;}\n\ninline void insert(R int x,R int pos){\n    R int now = rt[pos] = ++cnt,las = rt[pos-1];\n    t[now] = t[las]+1;\n    for (R int i=30; i>=0; --i)\n    {\n        R int tag = x>>i&1;\n        ch[now][tag^1] = ch[las][tag^1];\n        ch[now][tag] = ++cnt;\n        now = ch[now][tag];\n        las = ch[las][tag];\n        t[now] = t[las]+1;\n    }\n}\n\ninline int qury(R int sum,R int l,R int r){\n\tl--;\n    R int now = rt[l],las = rt[r],ret=0;\n    for (R int i=30; i>=0; --i)\n    {\n        R int tag = sum>>i&1;\n        if (t[ch[las][tag^1]]-t[ch[now][tag^1]])\n        {\n            ret ^= (1<<i);\n            now = ch[now][tag^1];\n            las = ch[las][tag^1];\n        }\n        else\n        {\n            now = ch[now][tag];\n            las = ch[las][tag];\n        }\n    }\n    return ret;\n}\n\nint main(){\n    in(n);\n    R int fir=0,las=n+1;\n    pre[las] = n,nxt[fir] = 1;\n    a[fir] = a[las] = inf;\n    for (R int i=1; i<=n; ++i) pre[i] = i-1,nxt[i] = i+1,in(a[i]),b[i] = make_pair(a[i],i),insert(a[i],i);\n    sort(b+1,b+n+1);\\\\\u6309\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\n    for (R int i=1; i<=n; ++i)\n    {\n        R int x = b[i].second;\n        R int l = pre[x],r = nxt[x];\\\\\u53d6\u5f53\u524d\u4f4d\u7f6e\u7684\u5de6\u53f3\u4e24\u4e2a\u503c\n        nxt[l] = r,pre[r] = l;\\\\\u5220\u9664\n        if (l != fir) maxx(ans,qury(a[x],pre[l]+1,r-1)); \\\\\u5982\u679c\u5de6\u8fb9\u6709\u66f4\u5927\u7684\n        if (r != las) maxx(ans,qury(a[x],l+1,nxt[r]-1)); \\\\\u5982\u679c\u53f3\u8fb9\u6709\u66f4\u5c0f\u7684\n    }\n    printf(\"%d\",ans);\n}\n\n```\n",
        "postTime": 1519309046,
        "uid": 36282,
        "name": "Youngsc",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4098 \u3010[HEOI2013]ALO \u3011"
    },
    {
        "content": "\u849f\u84bb\u6765\u53d1\u4e00\u4e2a\u5f88\u7b80\u5355\uff0c\u5f88\u597d\u7406\u89e3\u7684\u505a\u6cd5\u3002\n\n$\\mathtt{Algorithm}$\uff1a\n\n- ST \u8868 + \u4e8c\u5206 + \u53ef\u6301\u4e45\u5316 Trie\u3002\n\n$\\mathtt{Solution}$\uff1a\n\n- \u9996\u5148\uff0c\u601d\u8003 $a_i$ \u4f1a\u5728\u54ea\u4e9b\u533a\u95f4\u4f5c\u4e3a\u6b21\u5927\u503c\u3002\u8bbe $l_1$ \u8868\u793a $i$ \u5de6\u8fb9\u7b2c\u4e00\u4e2a\u6bd4 $a_i$ \u5927\u7684\u6570\u7684\u4e0b\u6807\uff08\u6ca1\u6709\u5c31\u662f $0$\uff09\uff0c\u8bbe $l_2$ \u8868\u793a $i$ \u5de6\u8fb9\u7b2c\u4e8c\u4e2a\u6bd4 $a_i$ \u5927\u7684\u6570\u7684\u4e0b\u6807\uff08\u6ca1\u6709\u5c31\u662f $0$\uff09\u3002$r_1$\uff08\u6ca1\u6709\u5c31\u662f $n+1$\uff09\u8868\u793a $i$ \u53f3\u8fb9\u7b2c\u4e00\u4e2a\u6bd4 $a_i$ \u5927\u7684\u6570\u7684\u5c0f\u6807\uff0c$r_2$\uff08\u6ca1\u6709\u5c31\u662f $n+1$\uff09\u540c\u7406\u3002\n\n- \u663e\u7136\uff0c$a_i$ \u5c31\u53ea\u6709\u5728 $[l_1+1,r_2-1]$ \u6216 $[l_2+1,r_1-1]$ \u65f6\u662f\u6b21\u5927\u503c\u3002\u8fd9\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5728 Trie \u4e0a\u8d2a\u5fc3\u5730\u6c42\u51fa\u6700\u5927\u503c\u3002\n\n- \u800c\u5bf9\u4e8e $l_1$ \u548c $l_2$ \u7684\u6c42\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u4e8c\u5206\u3002\u66f4\u5177\u4f53\u5730\uff0c\u9996\u5148\u6211\u4eec\u4e8c\u5206\u51fa $l_1$ \u7684\u4f4d\u7f6e\uff0c\u518d\u5728\u6b64\u57fa\u7840\u4e0a\u4e8c\u5206\u51fa $l_2$ \u7684\u4f4d\u7f6e\uff0c$r_1$ \u548c $r_2$ \u540c\u7406\u3002\n\n$\\mathtt{Code}$\uff1a\n\n- \u4ee3\u7801\u770b\u7740\u6709\u70b9\u5197\u6742\uff0c\u4f46\u5176\u5b9e\u90a3\u56db\u4e2a\u4e8c\u5206\u662f\u4e00\u4e2a\u610f\u601d\u3002\n\n----------\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\nconst int maxN = 1e5 + 5;\nconst int maxM = 31 * maxN;\n\nint n, a[maxN], f[maxN][24], Log[maxN];\n\nnamespace trie {\n    int ch[maxM][2], tot, mask[maxM], rt[maxN];\n\n    void insert(int idx, int old, int k) {\n        mask[k] = idx;\n        for (int i = 30; i > -1; --i) {\n            int x = a[idx] >> i & 1;\n            if (old) ch[k][x ^ 1] = ch[old][x ^ 1];\n            ch[k][x] = ++tot;\n            mask[tot] = idx;\n            k = ch[k][x], old = ch[old][x];\n        }\n    }\n\n    int query(int l, int r, int val) {\n        int res = 0, u = rt[r];\n        for (int i = 30; i > -1; --i) {\n            int x = val >> i & 1;\n            res <<= 1;\n            if (mask[ch[u][x ^ 1]] >= l) res |= x ^ 1, u = ch[u][x ^ 1];\n            else res |= x, u = ch[u][x];\n        }\n        return val ^ res;\n    }\n}\nusing namespace trie;\n\nint main() {\n    ios_base::sync_with_stdio(false);\n    cin.tie(nullptr);\n\n    cin >> n;\n    rt[0] = ++tot;\n    mask[0] = -1;\n    insert(0, 0, rt[0]);\n    int overallMax = 0;\n    for (int i = 1; i <= n; ++i) {\n        cin >> a[i];\n        overallMax = max(overallMax, a[i]);\n        f[i][0] = a[i];\n        rt[i] = ++tot;\n        insert(i, rt[i - 1], rt[i]);\n    }\n    for (int i = 2; i <= n; ++i) Log[i] = Log[i >> 1] + 1;\n    for (int j = 1; j <= Log[n]; ++j)\n        for (int i = 1; i + (1 << j) - 1 <= n; ++i)\n            f[i][j] = max(f[i][j - 1], f[i + (1 << (j - 1))][j - 1]);\n    auto get = [&](int l, int r) {\n        int len = Log[r - l + 1];\n        return max(f[l][len], f[r - (1 << len) + 1][len]);\n    };\n    int ans = 0;\n    for (int i = 1; i <= n; ++i) {\n        if (a[i] == overallMax) continue;\n        int l, r;\n        int l1 = 0, l2 = 0, r1 = n + 1, r2 = n + 1;\n        // find the first in left\n        l = 1, r = i - 1;\n        while (l <= r) {\n            int mid = (l + r) >> 1;\n            if (get(mid, i - 1) > a[i]) l1 = mid, l = mid + 1;\n            else r = mid - 1;\n        }\n        l = 1, r = l1 - 1;\n        while (l <= r) {\n            int mid = (l + r) >> 1;\n            if (get(mid, l1 - 1) > a[i]) l2 = mid, l = mid + 1;\n            else r = mid - 1;\n        }\n        l = i + 1, r = n;\n        while (l <= r) {\n            int mid = (l + r) >> 1;\n            if (get(i + 1, mid) > a[i]) r1 = mid, r = mid - 1;\n            else l = mid + 1;\n        }\n        l = r1 + 1, r = n;\n        while (l <= r) {\n            int mid = (l + r) >> 1;\n            if (get(r1 + 1, mid) > a[i]) r2 = mid, r = mid - 1;\n            else l = mid + 1;\n        }\n        /*\n         * one : l2 + 1 ~ r1 - 1\n         * two : l1 + 1 ~ r2 - 1\n         */\n        // one :\n        l = l2 + 1, r = r1 - 1;\n        ans = max(ans, query(l, r, a[i]));\n        // two :\n        l = l1 + 1, r = r2 - 1;\n        ans = max(ans, query(l, r, a[i]));\n    }\n    cout << ans;\n\n    return 0;\n}\n```",
        "postTime": 1678627073,
        "uid": 486001,
        "name": "Kcxx",
        "ccfLevel": 5,
        "title": "P4098 \u9898\u89e3"
    },
    {
        "content": "\u8003\u8651\u539f\u5e8f\u5217\u4e2d\u7684\u6bcf\u4e00\u4e2a\u503c\u4f5c\u4e3a\u6784\u6210\u6700\u7ec8\u7b54\u6848\u7684\u90a3\u4e2a\u6b21\u5927\u503c\uff0c\u90a3\u4e48\u5176\u6240\u5728\u7684\u5408\u6cd5\u533a\u95f4\u6700\u5927\u65f6\uff0c\u5176\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u6700\u5927\u3002\n\n\u4e00\u4e2a\u503c\u4f5c\u4e3a\u6700\u5927\u503c\u65f6\u6709\u4e24\u4e2a\u5408\u6cd5\u7684\u6700\u5927\u533a\u95f4\uff0c\u4e00\u4e2a\u662f\u5de6\u8fb9\u7b2c\u4e8c\u4e2a\u6bd4\u5176\u5927\u7684\u4f4d\u7f6e\u548c\u53f3\u8fb9\u7b2c\u4e00\u4e2a\u6bd4\u5176\u5927\u7684\u4f4d\u7f6e\u6784\u6210\u7684\u533a\u95f4\uff0c\u53e6\u4e00\u4e2a\u662f\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u6bd4\u5176\u5927\u7684\u4f4d\u7f6e\u548c\u53f3\u8fb9\u7b2c\u4e8c\u4e2a\u6bd4\u5176\u5927\u7684\u4f4d\u7f6e\u6784\u6210\u7684\u533a\u95f4\uff0c\u8fd9\u4e24\u4e2a\u533a\u95f4\u90fd\u662f\u5f00\u533a\u95f4\u3002\u786e\u5b9a\u533a\u95f4\u53ef\u4ee5\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u7528\u53cc\u5411\u94fe\u8868\u4e00\u4e2a\u4e00\u4e2a\u5220\u9664\u5373\u53ef\u3002\n\n\u7136\u540e\u5c31\u5c06\u95ee\u9898\u7b80\u5316\u4e86\uff0c\u73b0\u5728\u8981\u89e3\u51b3\u7ed9\u5b9a\u4e00\u4e2a\u503c\uff0c\u6c42\u7ed9\u5b9a\u533a\u95f4\u4e0e\u5176\u7684\u5f02\u6216\u6700\u5927\u503c\uff0c\u53ef\u4ee5\u5bf9\u539f\u5e8f\u5217\u5efa\u53ef\u6301\u4e45\u5316$Trie$\uff0c\u67e5\u8be2\u65f6\u76f4\u63a5\u5728$Trie$\u4e0a\u8d2a\u5fc3\u5c31\u884c\u3002\n\n\u5b9e\u73b0\u7ec6\u8282\u770b\u4ee3\u7801\u5427\u3002\n\n$code:$\n\n```cpp\n#include<bits/stdc++.h>\n#define maxn 3000010\nusing namespace std;\ntemplate<typename T> inline void read(T &x)\n{\n    x=0;char c=getchar();bool flag=false;\n    while(!isdigit(c)){if(c=='-')flag=true;c=getchar();}\n    while(isdigit(c)){x=(x<<1)+(x<<3)+(c^48);c=getchar();}\n    if(flag)x=-x;\n}\nint n,tot,ans;\nint a[maxn],p[maxn],pre[maxn],nxt[maxn];\nint rt[maxn],t[maxn][2],cnt[maxn];\nbool cmp(const int &x,const int &y)\n{\n    return a[x]<a[y];\n}\nvoid insert(int x,int k,int &p)\n{\n    cnt[++tot]=cnt[p],t[tot][0]=t[p][0],t[tot][1]=t[p][1];\n    p=tot,cnt[p]++;\n    if(k==-1) return;\n    insert(x,k-1,t[p][(x>>k)&1]);\n}\nint query(int ql,int qr,int k,int x)\n{\n    if(k==-1) return 0;\n    int ch=((x>>k)&1)^1;\n    if(cnt[t[qr][ch]]-cnt[t[ql][ch]])\n        return query(t[ql][ch],t[qr][ch],k-1,x)|(1<<k);\n    else return query(t[ql][ch^1],t[qr][ch^1],k-1,x);\n}\nint main()\n{\n    read(n);\n    for(int i=1;i<=n;++i) pre[i]=i-1,nxt[i]=i+1,p[i]=i;\n    for(int i=1;i<=n;++i)\n        read(a[i]),rt[i]=rt[i-1],insert(a[i],30,rt[i]);\n    sort(p+1,p+n+1,cmp);\n    for(int i=1;i<=n;++i)\n    {\n        int l=pre[p[i]],r=nxt[p[i]];\n        nxt[l]=r,pre[r]=l;\n        if(l) ans=max(ans,query(rt[pre[l]],rt[r-1],30,a[p[i]]));\n        if(r!=n+1) ans=max(ans,query(rt[l],rt[nxt[r]-1],30,a[p[i]]));\n    }\n    printf(\"%d\\n\",ans);\n    return 0;\n}\n```\n",
        "postTime": 1588416808,
        "uid": 172489,
        "name": "lhm_",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4098 \u3010[HEOI2013]ALO \u3011"
    },
    {
        "content": "#### [P4098 [HEOI2013] ALO](https://www.luogu.com.cn/problem/P4098)\n\n\u5bf9\u4e8e\u6bcf\u4e2a **\u975e\u6700\u5927\u503c** \u5143\u7d20 $a_i$\uff0c\u8003\u8651\u6c42\u51fa\u5176\u4e24\u4fa7\u7b2c\u4e8c\u4e2a\u5927\u4e8e $a_i$ \u7684\u4f4d\u7f6e $l_i, r_i$\uff0c\u5219 $[l_i + 1, r_i - 1]$ \u548c $a_i$ \u5747\u4ea7\u751f\u8d21\u732e\uff1a$[l_i + 1, i]$ \u548c $[i, r_i - 1]$ \u7684\u6b21\u5927\u503c\u5747\u4e3a $a_i$\u3002\u7279\u522b\u5730\uff0c\u82e5 $l_i$ \u4e0d\u5b58\u5728\u5219\u4e3a $0$\uff0c\u56e0\u4e3a $a_i$ \u4e0d\u662f\u6700\u5927\u503c\uff0c\u6240\u4ee5\u603b\u5b58\u5728 $[1, x]$ \u4f7f\u5f97 $a_i$ \u4e3a\u6b21\u5927\u503c\u3002\u540c\u7406\uff0c\u82e5 $r_i$ \u4e0d\u5b58\u5728\u5219\u4e3a $n + 1$\u3002\u6c42 $a_i$ \u548c\u4e00\u6bb5\u533a\u95f4\u5185\u6240\u6709\u6570\u5f02\u6216\u503c\u6700\u5927\u503c\u7528\u53ef\u6301\u4e45\u5316 01 Trie \u5373\u53ef\u3002\n\n$l_i$ \u548c $r_i$ \u7684\u6c42\u6cd5\uff1a\u6392\u5e8f\u540e\u7528\u53cc\u5411\u94fe\u8868\u7ef4\u62a4\u5f53\u524d\u5269\u4f59\u7684\u4f4d\u7f6e\uff0c\u6216\u8005\u7528\u5355\u8c03\u6808\uff1a\u4e0d\u59a8\u8bbe\u8981\u6c42 $l_i$\uff0c\u5148\u6c42\u5927\u4e8e\u5f53\u524d\u5143\u7d20\u7684\u524d\u9a71\u4f4d\u7f6e\uff0c\u7136\u540e\u5c06\u6240\u6709\u4f4d\u7f6e\u6309\u7167\u524d\u9a71\u4f4d\u7f6e\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0c\u5143\u7d20\u503c\u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\u6392\u5e8f\uff0c\u626b\u63cf\u8fc7\u7a0b\u4e2d\u5c06\u524d\u4e00\u4e2a\u4f4d\u7f6e\u7684\u524d\u9a71\u5230\u5f53\u524d\u4f4d\u7f6e\u7684\u524d\u9a71\u7684\u524d\u4e00\u4e2a\u5143\u7d20\u52a0\u5165\u5355\u8c03\u6808\uff0c\u7136\u540e\u7528\u5f53\u524d\u4f4d\u7f6e\u7684\u503c\u66f4\u65b0\u5355\u8c03\u6808\uff08\u5373\u5f39\u51fa\u5c0f\u4e8e\u5f53\u524d\u5143\u7d20\u7684\u6808\u9876\uff0c\u4f46\u4e0d\u52a0\u5165\u5f53\u524d\u5143\u7d20\uff09\uff0c\u5219\u6808\u9876\u4f4d\u7f6e\u5373 $l_i$\u3002\u8bfb\u8005\u53ef\u81ea\u884c\u601d\u8003\u5176\u6b63\u786e\u6027\uff08\u8bc1\u660e\u601d\u8def\uff1a\u524d\u9a71\u5143\u7d20\u5927\u4e8e\u5f53\u524d\u5143\u7d20\uff09\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log V)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nusing ll = long long;\nusing pii = pair<int, int>;\nusing ull = unsigned long long;\n\nbool Mbe;\nconstexpr int N = 5e4 + 5;\nconstexpr int K = N << 5;\nint n, mx, ans, a[N], id[N], p[N];\nint node, R[N], son[K][2], val[K];\nvoid modify(int pre, int &x, int v, int dep) {\n  val[x = ++node] = val[pre] + 1;\n  son[x][0] = son[pre][0], son[x][1] = son[pre][1];\n  if(!dep) return;\n  int bit = v >> --dep & 1;\n  modify(son[pre][bit], son[x][bit], v, dep);\n}\nint query(int v, int x, int y, int dep) {\n  if(!dep) return 0;\n  int bit = v >> --dep & 1;\n  if(val[son[y][bit ^ 1]] - val[son[x][bit ^ 1]])\n    return (1 << dep) + query(v, son[x][bit ^ 1], son[y][bit ^ 1], dep);\n  return query(v, son[x][bit], son[y][bit], dep);\n}\nvoid solve() {\n  memset(son, 0, node + 2 << 3);\n  memset(val, 0, node + 2 << 2);\n  node = 0;\n  for(int i = 1; i <= n; i++) modify(R[i - 1], R[i], a[i], 30);\n  static int stc[N], top; top = 0;\n  for(int i = 1; i <= n; i++) {\n    while(top && a[stc[top]] < a[i]) top--;\n    id[i] = stc[top], stc[++top] = p[i] = i;\n  }\n  sort(p + 1, p + n + 1, [&](int x, int y) {\n    return id[x] != id[y] ? id[x] < id[y] : a[x] < a[y];\n  });\n  top = 0;\n  for(int i = 1; i <= n; i++) {\n    for(int j = max(1, id[p[i - 1]]); j < id[p[i]]; j++) {\n      while(top && a[stc[top]] < a[j]) top--;\n      stc[++top] = j;\n    }\n    while(top && a[stc[top]] < a[p[i]]) top--;\n    if(a[p[i]] != mx) ans = max(ans, query(a[p[i]], R[stc[top]], R[p[i]], 30));\n  }\n}\n\nbool Med;\nint main() {\n  fprintf(stderr, \"%.3lf MB\\n\", (&Mbe - &Med) / 1048576.0);\n  #ifdef ALEX_WEI\n    FILE* IN = freopen(\"1.in\", \"r\", stdin); \n    FILE* OUT = freopen(\"1.out\", \"w\", stdout);\n  #endif\n  ios::sync_with_stdio(0), cin.tie(0), cout.tie(0);\n  cin >> n;\n  for(int i = 1; i <= n; i++) cin >> a[i], mx = max(mx, a[i]);\n  solve(), reverse(a + 1, a + n + 1), solve();\n  cout << ans << \"\\n\";\n  cerr << 1e3 * clock() / CLOCKS_PER_SEC << \" ms\\n\";\n  return 0;\n}\n/*\ng++ a.cpp -o a -std=c++14 -O2 -DALEX_WEI\n*/\n```",
        "postTime": 1635928865,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "P4098 [HEOI2013]ALO"
    },
    {
        "content": "# \u53ef\u6301\u4e45\u5316trie\u6811\n\u6c42\u533a\u95f4\u5f02\u6216\u6700\u5927\u503c\u7528trie\u6811 ~~\uff08\u663e\u7136\uff09~~\n\n\u5c06a\u5efa\u7acb\u53ef\u6301\u4e45\u5316trie\u6811\n\n\u679a\u4e3e\u6b21\u5927\u503c$a_i$\uff0c\u6b21\u5927\u503c\u4e3a$a_i$\u7684\u533a\u95f4\u4e3a[$a_i$\u7684\u524d\u9a71\u7684\u524d\u9a71+1,$a_i$\u7684\u540e\u7ee7\u7684\u540e\u7ee7-1]\u3002\n\n\u67e5\u8be2\u524d\u9a71\u540e\u7ee7\u7528set\u7ef4\u62a4\u5373\u53ef\n\n# \u4ee3\u7801\n```\n#include <bits/stdc++.h>\n#define eps 1e-12\n#define R register\n#define INF (1<<30)\n#define LINF (1ll<<60)\n#define MM(x, y) memset(x, y, sizeof x)\n#define Fo(i, x, y) for(R int i=x; i<=y; ++i)\n#define Ro(i, x, y) for(R int i=x; i>=y; --i)\nusing namespace std;\ntemplate<typename T> inline T Max(R T x, R T y) {return x > y ? x : y;}\ntemplate<typename T> inline T Min(R T x, R T y) {return x < y ? x : y;}\ntemplate<typename T> inline void in(R T &x)\n{\n\tstatic int ch; static bool flag;\n\tfor(flag=false, ch=getchar(); ch<'0'||ch>'9'; ch=getchar()) flag |= ch=='-';\n\tfor(x=0; ch>='0'&&ch<='9'; ch=getchar()) x = (x<<1) + (x<<3) + ch - '0';\n\tx = flag ? -x : x;\n}\n/*********************************Samle***********************************/\nset<int> s;\nint n, a[50005], b[50005], ans;\nstruct node{\n\tnode *c[2];\n\tint size;\n\tnode(node *C = 0) {size=0; c[0]=c[1]=C;}\n}*root[50005], *Null;\ninline bool cmp(R int x, R int y) {return a[x] > a[y];}\n\ninline node *insert(R node *x, R int val, R int d)\n{\n\tnode *y = new node(Null);\n\t*y = *x; y->size++;\n\tif(d < 0) return y;\n\tR int p = (val>>d)&1;\n\ty->c[p] = insert(x->c[p], val, d-1);\n\treturn y;\n}\ninline int query(R node *A, R node *B, R int val, R int d)\n{\n\tif(d < 0) return 0;\n\tR int v = (val >> d) & 1;\n\tif(A->c[!v]->size > B->c[!v]->size) return query(A->c[!v], B->c[!v], val, d-1) + (1<<d);\n\telse return query(A->c[v], B->c[v], val, d-1);\n}\nint main()\n{\n\tNull = new node(); Null->c[0] = Null->c[1] = Null;\n\troot[0] = Null;\n\tin(n); \n\tFo(i, 1, n)\n\t{\n\t\tin(a[i]); b[i] = i;\n\t\troot[i] = insert(root[i-1], a[i], 30);\n\t} sort(b+1, b+n+1, cmp);\n\ts.insert(-1); s.insert(-2); s.insert(b[1]); s.insert(n+1); s.insert(n+2);\n\tFo(i, 2, n)\n\t{\n\t\tR int l = Max(1, *--(--s.lower_bound(b[i]))+1);\n\t\tR int r = Min(n, *++(s.upper_bound(b[i]))-1);\n\t\tif(l > r) continue; s.insert(b[i]);\n\t\tans = Max(ans, query(root[r], root[l-1], a[b[i]], 30));\n\t}\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1519266099,
        "uid": 36268,
        "name": "Pine",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4098 \u3010[HEOI2013]ALO \u3011"
    },
    {
        "content": "## \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u5e8f\u5217\uff0c\u6c42\u4e00\u4e2a\u6700\u4f18\u533a\u95f4\uff0c\u8bbe $mex$ \u4e3a\u533a\u95f4\u6b21\u5927\u503c\uff0c\u4f7f $\\max_{i=l}^r\\{mex\\oplus a_i\\}$ \u6700\u5927\u3002\n\n## \u601d\u8def\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a\u53ef\u6301\u4e45\u5316 Trie\u3002\u5982\u679c\u4e0d\u4f1a\u53ef\u4ee5\u5148\u505a\u4e00\u4e0b [\u6a21\u7248](https://www.luogu.com.cn/problem/P4735)\u3002\n\n\u9996\u5148\u8003\u8651\uff0c\u5bf9\u4e8e\u4e00\u4e2a $a_i$ \u6765\u8bf4\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b $a_i$ \u80fd\u6210\u4e3a\u533a\u95f4\u6b21\u5927\u503c\u3002\n\n\u5f88\u663e\u7136\u8fd9\u4e2a\u533a\u95f4\u53ea\u5305\u542b\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u6570 ~~\uff08\u8fd9\u4e0d\u662f\u5e9f\u8bdd\u5417\uff09~~\u3002\n\n\u5373\uff0c\u5982\u679c $lr$ \u8868\u793a $[1,i-1]$ \u4e2d\u6700\u540e\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u6570\u7684\u7f16\u53f7\uff0c$ll$ \u8868\u793a $[1,lr-1]$ \u4e2d\u6700\u540e\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u6570\uff0c$rl$ \u8868\u793a $[i+1,n]$ \u4e2d\u7b2c\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u6570\uff0c$rr$ \u8868\u793a $[rl+1,n]$ \u4e2d\u7b2c\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u6570\uff0c\u90a3\u4e48\u6ee1\u8db3 $a_i$ \u4e3a\u6b21\u5927\u503c\u7684\u6700\u5927\u7684\u4e24\u4e2a\u533a\u95f4\u5206\u522b\u662f\uff1a\n\n$[ll+1,rl-1]$\uff08\u6700\u5927\u503c $lr$\uff09\n\n$[lr+1,rr-1]$\uff08\u6700\u5927\u503c $rl$\uff09\n\n\u8fd9\u4e2a\u4e1c\u897f\u5f88\u597d\u7ef4\u62a4\uff0c\u62ff\u4e00\u4e2a\u94fe\u8868\u5c31\u884c\u3002~~\u5f53\u7136\u4f60\u8981\u62ff\u7ebf\u6bb5\u6811\u6211\u4e5f\u4e0d\u62e6\u4f60~~\n\n\u5177\u4f53\u5b9e\u73b0\uff1a\n\n\u521d\u59cb\u5316\u94fe\u8868\uff1a$pre[i]=i-1,next[i]=i+1$\u3002\n\n\u7136\u540e\u628a $a[]$ \u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u8bbe $id$ \u4e3a\u5b83\u539f\u6765\u7684\u4f4d\u7f6e\uff0c\u6b64\u65f6 $pre[id]$ \u5373\u4e3a $lr$\uff0c$next[id]$ \u5373\u4e3a $rl$\u3002$ll$ \u600e\u4e48\u7b97\uff1f\u76f4\u63a5 $pre[pre[id]]$ \u5c31\u884c\u5566\uff08\n\n\u5f53\u7136\u7b97\u5b8c\u4e4b\u540e\u8981\u628a\u8fd9\u4e2a\u6570\u5728\u94fe\u8868\u4e0a\u5220\u6389\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u606d\u559c\u4f60\u5df2\u7ecf\u627e\u51fa\u4e86\u533a\u95f4\u8fb9\u754c\u548c\u6b21\u5927\u503c\uff0c\u4e0b\u4e00\u6b65\u662f\u6c42\u89e3\u7b54\u6848\u3002\n\n\u89c2\u5bdf\u8fd9\u4e2a\u5f0f\u5b50\uff1a\n\n$\\max_{i=l}^r\\{mex\\oplus a_i\\}$\n\n\u662f\u4e0d\u662f\u5f88\u719f\u6089\u2026\u2026\n\n\u4e00\u773c\u53ef\u6301\u4e45\u5316 Trie\u3002\n\n~~\u5982\u679c\u4f60\u4e0d\u719f\u6089\u7684\u8bdd\u8bf4\u660e\u4f60\u8fd8\u6ca1\u505a\u6a21\u7248\u3002~~\n\n\u7136\u540e\u62ff\u53ef\u6301\u4e45\u5316 Trie \u677f\u5b50\u8dd1\u4e00\u8fb9\u5c31\u884c\u4e86\u3002\n\n\u63d0\u4e00\u4e2a\u7ec6\u8282\uff08\u5751\u4e86\u6211\u597d\u4e45\uff09\uff1a\u53ef\u6301\u4e45\u5316 Trie \u67e5\u8be2\u662f\u4ece $l-1$ \u5230 $r$ \u7684\u3002\u3002\u3002\u6240\u4ee5 `query()` \u5e94\u8be5\u662f $[ll,rl-1]$\u3002\u3002\u3002\n\n\u4e0d\u7136\u4f60\u7684\u6837\u4f8b\u4f1a\u8f93\u51fa $6$\u3002\n\n\u53ef\u80fd\u662f\u56e0\u4e3a\u6211\u592a\u83dc\u4e86\u8fd8\u4e0d\u719f\u6089\u53ef\u6301\u4e45\u5316 Trie \u5427 /kk\n\n## \u4ee3\u7801\n\n\u5185\u542b\u6ce8\u91ca\u3002\n\n~~\u5df2\u5220\u53bb\u6587\u660e\u90e8\u5206~~\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 5e4 + 5;\nint n, pre[N], nxt[N], a[N], id[N];\nint t[N * 35][2], val[N * 35], root[N], tot;\ninline void insert(int x, int last, int k)\n{\n    for (int i = 30; i >= 0; i--)\n    {\n        val[x] = val[last] + 1;\n        bool p = k >> i & 1;\n        if (!t[x][p])\n            t[x][p] = ++tot;\n        t[x][p ^ 1] = t[last][p ^ 1];\n        x = t[x][p], last = t[last][p];\n    }\n    val[x] = val[last] + 1;\n}\ninline int query(int x, int y, int k)\n{\n    int res = 0;\n    for (int i = 30; i >= 0; i--)\n    {\n        bool p = k >> i & 1;\n        if (val[t[x][p ^ 1]] != val[t[y][p ^ 1]])\n        {\n            res += 1 << i;\n            x = t[x][p ^ 1], y = t[y][p ^ 1];\n        }\n        else\n            x = t[x][p], y = t[y][p];\n    }\n    return res;\n}\ninline bool cmp(int x, int y)\n{\n    return a[x] < a[y];\n}\nint main()\n{\n    ios::sync_with_stdio(false);\n    cin.tie(nullptr);\n    cin >> n;\n    for (int i = 1; i <= n; i++)\n    {\n        cin >> a[i];\n        root[i] = ++tot;\n        insert(root[i], root[i - 1], a[i]);\n        pre[i] = i - 1, nxt[i] = i + 1; // init list\n        id[i] = i;\n    }\n    sort(id + 1, id + 1 + n, cmp); // sort by value\n    int ans = 0;\n    for (int i = 1; i <= n; i++)\n    {\n        int l = pre[id[i]], r = nxt[id[i]]; // lr, rl\n        if (l)\n            ans = max(ans, query(root[pre[l]], root[r - 1], a[id[i]]));\n        if (r <= n)\n            ans = max(ans, query(root[l], root[nxt[r] - 1], a[id[i]]));\n        nxt[l] = r, pre[r] = l; // delete\n    }\n    cout << ans;\n    return 0;\n}\n```",
        "postTime": 1671561632,
        "uid": 576378,
        "name": "creation_hy",
        "ccfLevel": 5,
        "title": "P4098 \u9898\u89e3"
    },
    {
        "content": "1. \u4e00\u65b9\u9762\uff0c\u6b21\u5927\u503c\u5f88\u68d8\u624b\uff0c\u6700\u5148\u8003\u8651\u3002\n2. \u53e6\u4e00\u65b9\u9762\uff0c\u5bf9\u4e8e\u4e00\u6bb5\u533a\u95f4\u5185\u7684 $a_p(p\\in[l,r])$\uff0c\u5982\u679c\u8981\u627e\u5b83\u4eec\u548c $k$ \u5f02\u6216\u8d77\u6765\u7684\u6700\u5927\u503c\u662f\u597d\u627e\u7684\u3002\u4ece\u6700\u9ad8\u4f4d\u5230\u6700\u4f4e\u4f4d\u5efa Trie\uff0c\u5728\u6811\u4e0a\u8d2a\u5fc3\u5373\u53ef\u3002\u56e0\u4e3a\u662f\u4e00\u6bb5\u533a\u95f4\uff0c\u9700\u8981\u53ef\u6301\u4e45\u5316 Trie\u3002\n\n\u4e0d\u96be\u60f3\u5230\u679a\u4e3e\u6b21\u5927\u503c\uff0c\u7136\u540e\u5728 $a_k$ \u53ef\u4f5c\u4e3a\u6b21\u5927\u503c\u7684\u533a\u95f4\u5185\u5728\u53ef\u6301\u4e45\u5316 Trie \u4e0a\u627e\u3002\n\n\u5173\u4e8e\u679a\u4e3e\u6b21\u5927\u503c\uff0c\u53ef\u4ee5\u89c1\u6211\u7684[\u8fd9\u7bc7\u9898\u89e3](https://280800.blog.luogu.org/solution-cf1691d)\u3002\n\n> \u8bb0 $\\mathrm{minL}$ \u548c $\\mathrm{maxR}$ \u4e3a $a_k$ \u5411\u5de6\u5411\u53f3\u7b2c\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684 $a_p$ \u7684 $p$\u3002\n\n> \u53ef\u4ee5\u8003\u8651\u628a\u8fd9 $n$ \u4e2a\u6570\u7528\u94fe\u8868\u5c06\u76f8\u90bb\u7684\u4e24\u4e2a\u6570\u8fde\u5728\u4e00\u8d77\uff0c\u7136\u540e\u4ece\u5c0f\u5230\u5927\u679a\u4e3e\u6700\u5927\u503c\uff0c\u6bcf\u6b21\u679a\u4e3e\u5b8c\u4e00\u4e2a\u503c\uff0c\u5c31\u628a\u8fd9\u4e2a\u503c\u5220\u53bb\uff0c\u66f4\u65b0\u94fe\u8868\u3002\n\n> \u8fd9\u6837\u6bcf\u4e2a\u6570\u5728\u94fe\u8868\u4e0a\u7684\u5de6\u53f3\u7684\u6570\u5c31\u662f\u7b2c\u4e00\u4e2a\u5927\u4e8e\u5b83\u7684\u503c\u4e86\uff0c\u56e0\u4e3a\u6bd4\u5b83\u5c0f\u90fd\u5220\u6389\u4e86\uff0c\u6362\u53e5\u8bdd\u8bf4\u5b83\u4eec\u76f4\u63a5\u786e\u5b9a\u4e86 $\\mathrm{minL}-1$ \u548c $\\mathrm{maxR}+1$\u3002\n\n\n```cpp\n// Problem: P4098 [HEOI2013]ALO\n// From: Luogu\n// URL: https://www.luogu.com.cn/problem/P4098\n// Time: 2022-06-30 17:01\n// Author: lingfunny\n\n#include <bits/stdc++.h>\n#define LL long long\nusing namespace std;\nconst int mxn = 5.5e4+10, mxd = 30;\n\nint n, a[mxn], rt[mxn], sz[mxn*mxd], ch[2][mxn*mxd], tot, b[mxn], L[mxn], R[mxn], ans;\n\nvoid ins(int o, int &u, const int& w, int d = mxd - 1) {\n\tif(!u) u = ++tot;\n\tif(d < 0) return ++sz[u], void();\n\tconst int f = (w >> d) & 1;\n\tins(ch[f][o], ch[f][u], w, d - 1);\n\tch[f^1][u] = ch[f^1][o];\n\tsz[u] = sz[ch[0][u]] + sz[ch[1][u]];\n}\n\nint ask(int l, int r, const int& w, int d = mxd - 1) {\n\tif(d < 0) return 0;\n\tconst int f = ((w >> d) & 1) ^ 1;\n\treturn sz[ch[f][r]] > sz[ch[f][l]] ? ask(ch[f][l], ch[f][r], w, d - 1) | (1 << d) : ask(ch[f^1][l], ch[f^1][r], w, d - 1);\n}\n\nsigned main() {\n\tscanf(\"%d\", &n);\n\tfor(int i = 1; i <= n; ++i) scanf(\"%d\", a+i), ins(rt[i-1], rt[i], a[i]),\n\tb[i] = i, L[i] = i - 1, R[i] = i + 1; R[n+1] = n + 1;\n\tsort(b+1, b+n+1, [&](int x, int y) { return a[x] < a[y]; });\n\tfor(int i = 1; i < n; ++i) {\n\t\tint l = L[b[i]], r = R[b[i]];\n\t\tR[l] = r, L[r] = l;\n\t\tans = max(ans, ask(rt[L[l]], rt[r-1], a[b[i]]));\n\t\tans = max(ans, ask(rt[l], rt[R[r]-1], a[b[i]]));\n\t}\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1656581654,
        "uid": 280800,
        "name": "lingfunny",
        "ccfLevel": 7,
        "title": "P4098 [HEOI2013]ALO \u9898\u89e3"
    },
    {
        "content": "\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u6570\uff0c\u6211\u4eec\u5148\u8003\u8651\u5b83\u53ef\u4ee5\u548c\u54ea\u4e9b\u6570\u5f02\u6216\u3002\r\n\r\n\u4ee4 $L_i$ \u4e3a\u7b2c $i$ \u4e2a\u6570\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u6570\u7684\u4e0b\u6807\uff0c$R_i$ \u4e3a\u7b2c $i$ \u4e2a\u6570\u53f3\u8fb9\u7b2c\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u6570\u7684\u4e0b\u6807\u3002\r\n\r\n\u8bbe\u5f53\u524d\u8fd9\u4e2a\u6570\u4e3a $i$\uff0c\u90a3\u4e48\u4ee5\u5b83\u4e3a\u6b21\u5927\u503c\u7684\u533a\u95f4\u6709 $\\left[ L_{L_i}+1,R_i -1 \\right]$ \u548c $\\left[ L_i+1,R_{R_i} -1\\right]$\u3002\r\n\r\n\r\n\u90a3\u4e48\u5982\u4f55\u627e\u51fa\u6765\u6211\u4eec\u8981\u7684 $L$ \u548c $R$ \u5462\uff1f \u8003\u8651\u7528\u94fe\u8868\u8fde\u63a5\u6574\u4e2a\u533a\u95f4\uff0c\u4ece\u5c0f\u5230\u5927\u7684\u67e5\u627e\u6bcf\u4e00\u4e2a\u6570\u7684 $L$ \u548c $R$\uff0c\u4e5f\u5c31\u662f \u524d\u9a71 \u548c \u540e\u9a71\uff0c\u5e76\u5728\u7ed3\u675f\u65f6\u5c06\u5f53\u524d\u7684\u70b9\u4e22\u51fa\u94fe\u8868\u3002\u56e0\u4e3a\u6392\u5e8f\uff0c\u6240\u4ee5\u8fd9\u6837\u5904\u7406\u7684\u590d\u6742\u5ea6\u662f $O(n\\log n)$ \u7684\u3002\r\n\r\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u533a\u95f4\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6240\u6709\u7684 $a$ \u653e\u8fdb\u4e00\u9897\u5b57\u5178\u6811\u4e0a\uff0c\u7136\u540e\u5728\u5b57\u5178\u6811\u4e0a\u67e5\u627e\u6240\u6709\u7684 $a$ \u4e0e $a_i$ \u5f02\u6216\u7684\u6700\u5927\u503c\u3002\r\n\r\n\u56e0\u4e3a\u533a\u95f4\u59cb\u7ec8\u662f\u5728 $\\left[ 1,n \\right]$ \u91cc\u9762\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u53ef\u6301\u4e45\u5316\uff0c\u4e8e\u662f\u6bcf\u6b21\u67e5\u8be2\u7684\u590d\u6742\u5ea6\u5c31\u964d\u6210\u4e86 $O(\\log n)$\u3002\r\n\r\n### \u4ee3\u7801\r\n\r\n```cpp\r\n\r\n#include<bits/stdc++.h>\r\nusing namespace std;\r\n\r\nint n,m,ans=0;;\r\nint a[6000005],tot=0;\r\nint root[20000005];\r\n\r\nstruct Trie{\r\n\tint t[80000005][2],cnt=0;\r\n\tint sum[80000005];\r\n\tvoid Change_Tree(int l,int &r,int val){\r\n\t\tr=++cnt,sum[r]=sum[l]+1;\r\n\t\tint x=l,y=r;\r\n\t\tfor(int i=30;i>=0;i--){\r\n\t\t\tint op=((val>>i)&1);\r\n\t\t\tt[y][!op]=t[x][!op];\r\n\t\t\tt[y][op]=++cnt,sum[t[y][op]]=sum[t[x][op]]+1;\r\n\t\t\tx=t[x][op],y=t[y][op];\r\n\t\t}\r\n\t}\r\n\tint Find_Tree(int x,int y,int val){\r\n//\t\tprintf(\"Fuck:%d %d %d\\n\",x,y,val);\r\n\t\tif(x>y) return 0;\r\n\t\tint ans=0;\r\n\t\tfor(int i=30;i>=0;i--){\r\n\t\t\tint op=((val>>i)&1);\r\n\t\t\tif(sum[t[y][!op]]-sum[t[x][!op]]>0) ans+=(1<<i),op=(!op);\r\n\t\t\tx=t[x][op],y=t[y][op];\r\n\t\t}\r\n\t\treturn ans;\r\n\t}\r\n}T;\r\n\r\nint lsh[500005];\r\nint val[500005];\r\nint pre[500005],nxt[500005];\r\nint ll[500005],rr[500005];\r\n\r\nstruct qwq{\r\n\tint val,id;\r\n}t[500005];\r\nbool cmp(qwq x,qwq y){\r\n\treturn x.val<y.val;\r\n}\r\nint L[500005],R[500005];\r\n\r\nvoid Print(){\r\n\tprintf(\"-----------------------------\\n\");\r\n\tfor(int i=1;i<=n;i++) printf(\"%d:%d %d\\n\",i,pre[i],nxt[i]);\r\n\tprintf(\"-----------------------------\\n\");\r\n}\r\n\r\nint main(){\r\n\tcin>>n;for(int i=1;i<=n;i++) scanf(\"%d\",&a[i]),t[i].val=a[i],t[i].id=i,pre[i]=i-1,nxt[i]=i+1,T.Change_Tree(root[i-1],root[i],a[i]);\r\n\tpre[n+1]=n,nxt[0]=1;\r\n\tsort(t+1,t+n+1,cmp);\r\n\tfor(int i=1;i<=n;i++){\r\n\t\tint id=t[i].id;\r\n\t\tL[id]=pre[id],R[id]=nxt[id];\r\n\t\tpre[R[id]]=L[id],nxt[L[id]]=R[id];\r\n\t\tll[id]=pre[L[id]],rr[id]=nxt[R[id]];\r\n//\t\tprintf(\"%d:%d %d %d %d\\n\",id,L[id],R[id],ll[id],rr[id]); \r\n//\t\tPrint();\r\n\t}\r\n\tfor(int i=1;i<=n;i++){\r\n\t\tint l=L[i],r=R[i];\r\n\t\tint pr=ll[i],nx=rr[i];\r\n//\t\tprintf(\"%d:%d %d %d %d %d\\n\",i,l,r,pr,nx,a[i]);\r\n\t\tif(l) ans=max(ans,T.Find_Tree(root[pr],root[r-1],a[i]));//,printf(\"qwq!\\n\");\r\n\t\tif(r!=n+1) ans=max(ans,T.Find_Tree(root[l],root[nx-1],a[i]));//,printf(\"QWQ!\\n\");\r\n\t}\r\n\tprintf(\"%d\\n\",ans);\r\n\treturn 0;\r\n}\r\n```\r\n\r\n",
        "postTime": 1646124884,
        "uid": 225883,
        "name": "MiRaciss",
        "ccfLevel": 7,
        "title": "P4098 \u9898\u89e3"
    },
    {
        "content": "#### [HEOI 2013] ALO\uff1a\n\n#### \u9898\u610f:\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6b63\u6574\u6570\u5e8f\u5217 $a$\uff0c\u5e8f\u5217\u4e2d\u7684\u6570**\u4e24\u4e24\u4e0d\u76f8\u540c**\uff0c\u5b9a\u4e49\u533a\u95f4 $[l,r]$ \u7684\u4ef7\u503c\u4e3a\uff1a\n\n+ \u5047\u8bbe\u533a\u95f4 $[l,r]$ \u5185\u7684\u7b2c\u4e8c\u5927\u7684\u503c\u662f $k$\uff0c \u90a3\u4e48 $k$ \u4e0e\u533a\u95f4 $[l,r]$ \u4e2d\u4efb\u610f\u4e00\u4e2a\u6570\u5f02\u6216\u5f97\u5230\u6700\u5927\u503c\u5373\u662f\u533a\u95f4 $[l,r]$ \u7684\u4ef7\u503c\u3002\n\n\u4f60\u73b0\u5728\u8981\u627e\u51fa\u4e00\u4e2a\u533a\u95f4 $[l,r](1 \\leq l< r \\leq n)$ \u4f7f\u5f97\u8fd9\u4e2a\u533a\u95f4\u7684\u4ef7\u503c\u662f\u6240\u6709\u533a\u95f4\u4e2d\u6700\u5927\u7684\uff0c\u8f93\u51fa\u6700\u5927\u4ef7\u503c\u3002\n\n#### \u505a\u6cd5\uff1a\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a\u7ebf\u6bb5\u6811 + \u53ef\u6301\u4e45\u5316 `trie` + \u5355\u8c03\u6808\n\nOrz \u795e\u4ed9\u4eec\u90fd\u4f1a\u94fe\u8868\uff0c\u83dc\u9e21\u53ea\u80fd\u5199\u7ebf\u6bb5\u6811\u7ef4\u62a4\u3002\n\n+ \u5b9a\u4e49 $Lef_i$ \u8868\u793a $a_i$ \u5de6\u8fb9\u7b2c\u4e00\u4e2a\u5927\u4e8e $a_i$ \u7684\u6570\u7684\u4f4d\u7f6e\u3002\n+ \u5b9a\u4e49 $Rig_i$ \u8868\u793a $a_i$ \u53f3\u8fb9\u7b2c\u4e00\u4e2a\u5927\u4e8e $a_i$ \u7684\u6570\u7684\u4f4d\u7f6e\u3002\n\n\u8003\u8651\u5148\u627e\u5230\u6bcf\u4e2a\u6570**\u53ef\u4ee5\u4f5c\u4e3a\u6b21\u5927\u503c\u7684\u533a\u95f4\u8303\u56f4**\uff0c\u7136\u540e\u7528\u53ef\u6301\u4e45\u5316 `tire\u200b` \u5904\u7406\u5c31\u5b8c\u4e8b\u4e86\u3002\n\n\u90a3\u4e48\u5b9e\u9645\u4e0a\u4e00\u4e2a\u6570 $a_i$ \u80fd\u591f\u4f5c\u4e3a\u6b21\u5927\u503c\u7684\u8303\u56f4\u5373 $[L' + 1, R'-1]$ \uff0c\u5176\u4e2d $L'$ \u8868\u793a $a_i$ \u5de6\u8fb9**\u7b2c\u4e8c\u4e2a**\u6bd4 $a_i$ \u5927\u7684\u6570\u7684\u4f4d\u7f6e\uff0c $R'$ \u8868\u793a $a_i$ \u53f3\u8fb9**\u7b2c\u4e8c\u4e2a**\u6bd4 $a_i$ \u5927\u7684\u6570\u7684\u4f4d\u7f6e\uff0c\u8bfb\u8005\u53ef\u4ee5\u753b\u56fe\uff0c\u867d\u7136\u4f1a\u6709\u4e24\u4e2a\u53ef\u884c\u7684\u533a\u95f4\uff0c\u4f46\u662f\u4e24\u4e2a\u533a\u95f4\u5e76\u8d77\u6765\u5c31\u662f\u8fd9\u4e2a\u533a\u95f4\u4e86\u3002\n\n\u9996\u5148\u9884\u5904\u7406\u51fa $Lef_i$ \u548c $Rig_i$\uff0c\u627e $Lef_i$ \u4ee5\u53ca $Rig_i$ \u7684\u8fc7\u7a0b\u662f\u6bd4\u8f83\u5957\u8def\u7684\u5355\u8c03\u6808\u7ef4\u62a4\uff0c\u4e0d\u8bb2\u4e86\u3002\n\n\u6211\u4eec\u5148\u8003\u8651\u627e\u51fa $L'$ \uff0c$R'$ \u5176\u5b9e\u540c\u7406\uff0c\u4e8e\u662f\u5728\u8fd9\u91cc\u53ea\u8bb2\u6c42 $L'$ \u7684\u505a\u6cd5\u3002\u968f\u540e\u5b9a\u4e49\u4e00\u4e2a $vector$ \u6570\u7ec4 $q$\u3002\n\n\u63a5\u7740 `q[lef[i]].push_back(i);` \u5c31\u5148\u628a\u6bcf\u4e2a\u70b9\u653e\u5728\u5176 $Lef_i$ \u4e0a\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u4ece\u5de6\u5230\u53f3\uff08\u5982\u679c\u662f\u5904\u7406 $R'$ \u5c31\u4ece\u53f3\u5230\u5de6\uff09\u626b\u6574\u4e2a\u6570\u7ec4 $a$(\u79bb\u6563\u5316\u540e\u7684)\uff0c\u5047\u8bbe\u5f53\u524d\u626b\u5230\u4e86 $a_j$ \uff0c\u90a3\u4e48\u5047\u8bbe `q[j].size() != 0` \u90a3\u4e48\u6211\u4eec\u5c31\u8981\u5904\u7406 `q[j]` \u4e2d\u7684\u5185\u5bb9\u3002\u5047\u8bbe `q[j][k] = c` \uff0c\u90a3\u4e48\u6211\u4eec\u67e5\u8be2\u76ee\u524d\u5927\u4e8e $a[c]$ \u7684\u7b2c\u4e00\u4e2a\u6570\u7684\u4f4d\u7f6e\u5373\u662f\u539f\u672c\u5728 $a[c]$ \u5de6\u8fb9\u7b2c\u4e8c\u4e2a\u6bd4\u5b83\u5927\u7684\u6570\u7684\u4f4d\u7f6e\uff0c\u7ebf\u6bb5\u6811\u7ef4\u62a4\u8fd9\u4e2a\u7b2c\u4e00\u4e2a\u6bd4\u5b83\u5927\u7684\u4f4d\u7f6e\u5373\u53ef(\u7528\u4e0d\u4e86\u5355\u8c03\u6808\u4e86\uff0c\u56e0\u4e3a\u4f60\u4e00\u4e2a\u70b9\u4f1a\u6709\u591a\u4e2a\u8be2\u95ee)\uff0c\u8fd9\u4e2a\u4e0d\u96be\u7406\u89e3\u3002\n\n\u5bf9\u4e8e $R'$ \u7684\u5904\u7406\u4e5f\u662f\u4e00\u6837\u7684\u5904\u7406\u3002 \n\n\u63a5\u7740\u7528\u5957\u53ef\u6301\u4e45\u5316 `trie` \u7ef4\u62a4\u4e00\u4e0b\u5373\u53ef\u3002\u5982\u679c\u8fd8\u4e0d\u4f1a\u53ef\u6301\u4e45\u5316 `trie` \u53ef\u4ee5\u5148\u53bb [OIWIKI](https://oi-wiki.org/ds/persistent-trie/) \u4e0a\u9762\u5b66\u4e60\u4e00\u4e0b\u3002\n\n\u63a5\u7740\u7ed9\u51fa\u51e0\u4e2a**\u6ce8\u610f\u4e8b\u9879** :\n\n+ \u6570\u7ec4\u7a7a\u95f4\u8981\u5f00\u591f\uff0c\u4e0d\u7136\u5bb9\u6613 $Wa$ \u6210 $50pts$\n+ \u7279\u5224\u5f53\u524d\u5143\u7d20\u662f\u4e0d\u662f\u6574\u4e2a\u5e8f\u5217\u7684\u6700\u5927\u503c\uff0c\u5982\u679c\u662f\u7684\u8bdd\uff0c\u6309\u7167\u4e0a\u8ff0\u65b9\u6cd5\u6c42\u51fa\u6765\u5176\u53ef\u4ee5\u4f5c\u4e3a\u6b21\u5927\u503c\u7684\u533a\u95f4\u8303\u56f4\u662f $[1,n]$ \uff0c\u4f46\u662f\u8fd9\u663e\u7136\u662f\u4e0d\u884c\u7684\uff0c\u8981\u7279\u5224\u4e00\u4e0b\u3002\n+ \u8bb0\u5f97\u79bb\u6563\u5316\u3002\n\n#### Code\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define mid ((T[x].l + T[x].r) >> 1)\n#define ls (x << 1)\n#define rs (x << 1 | 1)\ninline int read() {\n\tint x = 0, flag = 1;\n\tchar ch = getchar();\n\tfor( ; ch > '9' || ch < '0' ; ch = getchar()) if(ch == '-') flag = -1;\n\tfor( ; ch >= '0' && ch <= '9' ; ch = getchar()) x = (x << 3) + (x << 1) + ch - '0';\n\treturn x * flag;\n}\nconst int MAXN = 1e5 + 50;\nint n, A[MAXN], Lef[MAXN], Rig[MAXN], Val[MAXN], Mx, Sc;\nint tack[MAXN], top = 0, rt[MAXN];\nqueue <int> q[MAXN];\nstruct Lis {\n\tint val, id;\n} S[MAXN];\nbool cmp(Lis a, Lis b) { return a.val < b.val; }\nstruct SegmentTree {\n\tint l, r, S, tag;\n} T[MAXN << 2];\nnamespace trie { // \u53ef\u6301\u4e45\u5316 trie\n\tint Son[MAXN * 31][2], Num[MAXN * 31], cnt = 0;\n\n\tint insert(int now, int val) {\n\t\tint s = ++ cnt, cur = s;\n\t\tfor(int i = 30 ; i >= 0 ; i --) {\n\t\t\tint t = ((val >> i) & 1);\n\t\t\tNum[cur] = Num[now] + 1;\n\t\t\tSon[cur][t ^ 1] = Son[now][t ^ 1], Son[cur][t] = ++cnt;\n\t\t\tnow = Son[now][t], cur = Son[cur][t];\n\t\t} Num[cur] = Num[now] + 1;\n\t\treturn s;\n\t}\n\n\tint Get(int x, int l, int r) {\n\t\tint ans = 0;\n\t\tfor(int i = 30 ; i >= 0 ; i --) {\n\t\t\tint t = ((x >> i) & 1);\n\t\t\tif(Num[Son[r][t ^ 1]] - Num[Son[l][t ^ 1]]) {\n\t\t\t\tans += (1 << i);\n\t\t\t\tr = Son[r][t ^ 1], l = Son[l][t ^ 1];\n\t\t\t}\n\t\t\telse r = Son[r][t], l = Son[l][t];\n\t\t}\n\t\treturn ans;\n\t}\n\n} ;\nvoid build(int x, int l, int r) {\n\tT[x].l = l, T[x].r = r, T[x].S = T[x].tag = 0;\n\tif(l == r) return ;\n\tbuild(ls, l, mid), build(rs, mid + 1, r);\n\treturn ;\n}\nvoid ad(int x, int k) { T[x].S = k, T[x].tag = k; return ; }\nvoid pushdown(int x) { if(T[x].tag) ad(ls, T[x].tag), ad(rs, T[x].tag), T[x].tag = 0; return ;}\nvoid change(int x, int l, int r, int k) { // \u533a\u95f4\u8986\u76d6\n\tif(l > r) return ;\n\tif(T[x].l >= l && T[x].r <= r) { ad(x, k); return ;}\n\tpushdown(x);\n\tif(l <= mid) change(ls, l, r, k);\n\tif(r  > mid) change(rs, l, r, k);\n\treturn ;\n}\nint Get(int x, int pos) { \n\tif(T[x].l == pos && T[x].r == pos) return T[x].S;\n\tpushdown(x);\n\treturn pos <= mid ? Get(ls, pos) : Get(rs, pos);\n}\n\nint main() {\n\tn = read();\n\tfor(int i = 1 ; i <= n ; i ++) Val[i] = read(), Lef[i] = 1, Rig[i] = n;\n\tfor(int i = 1 ; i <= n ; i ++) S[i].val = Val[i], S[i].id = i;\n\tsort(S + 1, S + 1 + n, cmp);\n\tfor(int i = 1 ; i <= n ; i ++) A[S[i].id] = i;// \u79bb\u6563\u5316\n\ttop = 0, tack[++ top] = 1;\n\tfor(int i = 2 ; i <= n ; i ++) { // \u5355\u8c03\u6808\u6c42 Rig[i]\n\t\twhile(top >= 1 && A[tack[top]] < A[i]) Rig[tack[top]] = i, top --;\n\t\ttack[++ top] = i;\n\t}\n\ttop = 0, tack[++ top] = n;\n\tfor(int i = n - 1 ; i >= 1 ; i --) { // \u5355\u8c03\u6808\u6c42 Lef[i]\n\t\twhile(top >= 1 && A[tack[top]] < A[i]) Lef[tack[top]] = i, top --;\n\t\ttack[++ top] = i;\n\t}\n\tbuild(1, 1, n);\n\tfor(int i = 1 ; i <= n ; i ++) q[Lef[i]].push(i); //\u5904\u7406\u5de6\u8fb9\u754c\n\tfor(int i = 1 ; i <= n ; i ++) {\n\t\twhile(!q[i].empty()) Lef[q[i].front()] = Get(1, A[q[i].front()]) + 1, q[i].pop();\n\t\tchange(1, 1, A[i] - 1, i); // \u4fee\u6539\n\t}\n\tbuild(1, 1, n);\n\tfor(int i = 1 ; i <= n ; i ++) q[Rig[i]].push(i);\n\tfor(int i = n ; i >= 1 ; i --) { \n\t\twhile(!q[i].empty()) Rig[q[i].front()] = Get(1, A[q[i].front()]) - 1, q[i].pop();\n\t\tchange(1, 1, A[i] - 1, i);\n\t}\n\tfor(int i = 1 ; i <= n ; i ++) if(Rig[i] == -1) Rig[i] = n;\n\tint Ans = 0;rt[0] = trie::insert(0, 0);\n\tfor(int i = 1 ; i <= n ; i ++) rt[i] = trie::insert(rt[i - 1], Val[i]); \n\tfor(int i = 1 ; i <= n ; i ++) {\n\t\tif(A[i] == n) continue;\n\t\tAns = max(Ans, trie::Get(Val[i], rt[Lef[i] - 1], rt[Rig[i]]));\n\t} cout << Ans;\n\treturn 0;\n}\n```\n\n",
        "postTime": 1622551099,
        "uid": 67817,
        "name": "MuYC",
        "ccfLevel": 6,
        "title": "[HEOI 2013] ALO \u9898\u89e3"
    },
    {
        "content": "\u5176\u5b9e\u662f\u4e2a\u597d\u9898  \n\n\u9996\u5148\u6211\u4eec\u8003\u8651\u679a\u4e3e\u533a\u95f4\uff0c\u80af\u5b9a\u4e0d\u80fd\u76f4\u63a5\u679a\u4e3e\u5de6\u53f3\u8fb9\u754c\uff0c\u56e0\u4e3a\u90a3\u6837\u4f1a\u4e25\u91cd\u8d85\u65f6  \n\u6211\u4eec\u8003\u8651\u679a\u4e3e\u6b21\u5c0f\u503ck\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u501f\u52a9\u53cc\u5411\u94fe\u8868\u6c42\u51fa\u5b83\u53ef\u80fd\u5bf9\u5e94\u7684\u4e24\u4e2a\u533a\u95f4\uff0c\u5373\u5148\u6309\u7167\u6743\u503c\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u7136\u540e\u4f9d\u6b21\u5728\u94fe\u8868\u4e2d\u83b7\u53d6\u5b83\u7684\u524d\u9a71\u548c\u540e\u7ee7\uff0c\u5373\u5bf9\u5e94\u7684\u533a\u95f4\uff0c\u7136\u540e\u5c06\u8be5\u8282\u70b9\u5728\u94fe\u8868\u91cc\u5220\u9664\uff08~~\u611f\u89c9\u63cf\u8ff0\u4e0d\u6e05\u695a\uff0c\u770b\u697c\u4e0a~~\uff09  \n\u7136\u540e\u5373\u4f7f\u6c42\u533a\u95f4\u6700\u5927\u5f02\u6216\u548c\uff08\u5f88\u719f\u6089\u5bf9\u4e0d\u5bf9\uff1f\uff09\uff0c\u6ca1\u9519\uff0c\u5c31\u662f\u8fd9\u9053\u9898[**\u6700\u5927\u5f02\u6216\u548c**](https://www.luogu.org/problemnew/show/P4735)\uff0c\u6211\u4eec\u501f\u52a9\u53ef\u6301\u4e45\u5316trie\u5373\u53ef\u6c42\u51fa\u6700\u540e\u7684\u7b54\u6848  \n\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,a[50005],prev[50005],next[50005],root[50005],top=0;\nint l[200005],r[200005],to[200005],trie[200005*32][2],latest[5000005];\nstruct sor{\n\tint data;\n\tint where;\n}s[50005];\nbool cmp(sor x,sor y){\n\treturn x.data<y.data;\n}\nvoid insert(int val,int i,int now,int com,int F){\n\tif(F<0){\n\t\tlatest[now]=i;return;\n\t}\n\tint x=val&(1<<(F))?1:0;\n\ttrie[now][x^1]=trie[com][x^1];\n\ttrie[now][x]=++top;\n\tinsert(val,i,trie[now][x],trie[com][x],F-1);\n\tlatest[now]=max(latest[trie[now][0]],latest[trie[now][1]]);\n}\nint ask(int Min,int now,int val,int F){\n\tif(F<0)return latest[now];\n\tint x=val&(1<<(F))?1:0;\n\tif(latest[trie[now][x^1]]>=Min)return ask(Min,trie[now][x^1],val,F-1);\n\telse return ask(Min,trie[now][x],val,F-1);\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++)\n\t    scanf(\"%d\",&a[i]),prev[i]=i-1,next[i]=i+1,\n\t\ts[i].data=a[i],s[i].where=i;\n\tsort(s+1,s+n+1,cmp);int tot=0;\n\tfor(int i=1;i<=n;i++){\n\t\tint x=s[i].where;\n\t\tif(prev[x]){\n\t\t\tl[++tot]=prev[prev[x]]+1;\n\t\t\tr[tot]=next[x]-1;to[tot]=x;\n\t\t}\n\t\tif(next[x]<=n){\n\t\t\tl[++tot]=prev[x]+1;\n\t\t\tr[tot]=next[next[x]]-1;to[tot]=x;\n\t\t}\n\t\tnext[prev[x]]=next[x];\n\t\tprev[next[x]]=prev[x];\n\t}\n\tlatest[0]=-1;root[0]=++top;\n\tinsert(0,0,top,0,31);\n\tfor(int i=1;i<=n;i++)\n\t  root[i]=++top,insert(a[i],i,root[i],root[i-1],31);\n\tint ans=0;\n\tfor(int i=1;i<=tot;i++){\n\t\t//cout<<l[i]<<\" \"<<r[i]<<\" \"<<to[i]<<endl;\n\t\tans=max(ans,a[ask(l[i],root[r[i]],a[to[i]],31)]^a[to[i]]);\n\t}\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1554373146,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4098 \u3010[HEOI2013]ALO \u3011"
    }
]