[
    {
        "content": "\u9898\u5916\u8bdd\uff0c\u6bd4\u8d5b\u65f6\u5927\u5bb6\u597d\u50cf\u90fd\u5728\u6811\u5256\uff0c\u6ca1\u89c1\u5230\u51e0\u4e2a\u5199\u5dee\u5206\u7684\uff08\uff08\u8fd9\u9898\u4e0d\u4f1a\u6210\u4e86\u5929\u5929\u7231\u8dd1\u6b65 2.0 \u5427\uff08\n\n## F2. \u751f\u6d3b\u5728\u6811\u4e0a\uff08hard version\uff09\n\n**\u9898\u610f**\uff1a\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u70b9\u6570\u4e3a $n$\uff0c\u70b9\u6709\u70b9\u6743\u3002\u5b9a\u4e49\u6811\u4e0a\u4e24\u70b9\u95f4\u8def\u5f84\u7684\u6743\u503c\u662f\u5176\u7b80\u5355\u8def\u5f84\u4e0a\u70b9\u6743\u7684\u5f02\u6216\u548c\u3002\u6709 $q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u7ed9\u5b9a\u4e24\u4e2a\u8282\u70b9 $x, y$ \u67e5\u8be2\u662f\u5426\u5b58\u5728\u4e00\u4e2a\u70b9 $u$\uff0c\u4f7f $u$ \u5230 $x$ \u548c $u$ \u5230 $y$ \u7684\u8def\u5f84\u7684\u6743\u503c\u7684\u5f02\u6216\u4e3a $k$\u3002\n\n**\u5173\u952e\u8bcd**\uff1a\u524d\u7f00\u548c\uff0c\u6784\u9020\uff0c\u6811\u4e0a\u5dee\u5206\u3002\n\n**\u53c2\u8003\u96be\u5ea6**\uff1a\u7eff\u3002\n\n**\u5206\u6790**\uff1a\u9996\u5148\u5f02\u6216\u6784\u6210\u4e00\u4e2a Abel \u7fa4\uff0c\u6240\u4ee5\u5982\u679c\u4e00\u4e2a\u70b9\u5728 $u$ \u5230 $x$ \u548c $y$ \u7684\u8def\u5f84\u4e0a\u90fd\u51fa\u73b0\u4e86\uff0c\u90a3\u4e48\u4ed6\u5bf9\u7b54\u6848\u6ca1\u6709\u8d21\u732e\u3002\n\n\u8003\u8651 $u$ \u5230 $x$ \u7684\u8def\u5f84\u548c $u$ \u5230 $y$ \u7684\u8def\u5f84\u603b\u662f\u5148\u7ecf\u8fc7\u82e5\u5e72\u4e2a\u76f8\u540c\u7684\u70b9\uff0c\u7136\u540e\u4e0e $(x, y)$ \u6240\u6210\u7684\u94fe\u6709\u4e00\u4e2a\u4ea4\u70b9 $t$\uff0c\u63a5\u7740\u5728\u8fd9\u4e2a\u4ea4\u70b9\u5904\u5206\u5f00\uff0c\u4e00\u4e2a\u8d70\u5411 $x$ \u4e00\u4e2a\u8d70\u5411 $y$\uff0c\u5982\u56fe\uff1a![](https://cdn.luogu.com.cn/upload/image_hosting/x024zkpa.png)\n\n\u56fe\u4e2d\u7ea2\u8272\u8def\u5f84\u662f $u$ \u5230 $x$ \u7684\u8def\u5f84\uff0c\u84dd\u8272\u8def\u5f84\u662f $u$ \u5230 $y$ \u7684\u8def\u5f84\uff0c\u4e8c\u8005\u5728 $(u, t)$ \u90e8\u5206\u662f\u91cd\u590d\u7684\u3002\u4e0d\u96be\u9a8c\u8bc1\uff0c\u65e0\u8bba $u$ \u5728\u54ea\u4e2a\u4f4d\u7f6e\uff0c\u90fd\u6ee1\u8db3\u8fd9\u4e2a\u6027\u8d28\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53d1\u73b0\uff0c$\\mathrm{dis}_{u, x} \\bigoplus \\mathrm{dis}_{u, y}$ \u7684\u503c\u53ef\u80fd\u662f $s_x \\bigoplus s_y \\bigoplus  w_a \\bigoplus w_t$\uff0c$s_x$ \u548c $s_y$ \u8868\u793a $x$\uff0c$y$ \u5230\u6839\u8def\u5f84\u7684\u70b9\u6743\u5f02\u6216\u548c\uff0c$t$ \u662f $x$ \u5230 $y$ \u7684\u94fe\u4e0a\u4efb\u4f55\u4e00\u4e2a\u70b9\uff0c$a$ \u662f $x$ \u548c $y$ \u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\u3002\u6ce8\u610f\u5230 $a$ \u5728\u94fe\u4e0a\uff0c\u4f46\u662f $w_a$ \u5728 $s_x$ \u548c $s_y$ \u4e2d\u90fd\u88ab\u8ba1\u7b97\u4e86\u4e00\u6b21\uff0c\u4e8c\u8005\u7684\u5f02\u6216\u6ca1\u6709\u4e86 $w_a$ \u7684\u8d21\u732e\uff0c\u56e0\u6b64\u8981\u518d\u5f02\u6216\u4e00\u6b21\u628a\u8d21\u732e\u52a0\u56de\u6765\uff1b\u6b64\u5916\u8003\u8651 $t$ \u662f\u4e24\u6761\u8def\u5f84\u4e0a\u91cd\u590d\u7684\u70b9\uff0c\u56e0\u6b64\u5bf9\u5f02\u6216\u548c\u6ca1\u6709\u8d21\u732e\uff0c\u9700\u8981\u5f02\u6216\u4e00\u6b21\u5c06\u5176\u8d21\u732e\u53bb\u6389\u3002\n\n\u4e8e\u662f\u95ee\u9898\u5c31\u53d8\u6210\u4e86 $s_x \\bigoplus s_y \\bigoplus  w_a \\bigoplus w_t = k$ \u662f\u5426\u6210\u7acb\u3002\u6ce8\u610f\u5230 $x, y, a, k$ \u90fd\u662f\u5b9a\u503c\uff0c\u6839\u636e\u6d88\u53bb\u5f8b\uff0c$w_t = k \\bigoplus s_x \\bigoplus s_y \\bigoplus w_a$\u3002\u4e8e\u662f\u95ee\u9898\u8f6c\u5316\u6210\u4e86\uff1a\u5728 $x$ \u5230 $y$ \u7684\u94fe\u4e0a\u662f\u5426\u5b58\u5728\u4e00\u4e2a $t$\uff0c\u4f7f\u5f97 $t$ \u7684\u6743\u503c\u662f $W= k \\bigoplus s_x \\bigoplus s_y \\bigoplus w_a$\u3002\u4e5f\u5373\u67e5\u8be2\u8fd9\u6761\u94fe\u4e0a\u6743\u503c\u4e3a $W$ \u7684\u70b9\u7684\u4e2a\u6570\u3002\u8fd9\u662f\u4e00\u4e2a\u7ecf\u5178\u7684\u6811\u4e0a\u5dee\u5206\u95ee\u9898\uff1a\u6211\u4eec\u53ea\u9700\u8981\u67e5\u8be2 $(x, a)$ \u548c $(y, b)$ \u4e24\u6761\u94fe\u4e0a\u5176\u4e2a\u6570\u7136\u540e\u76f8\u52a0\u5373\u53ef\uff0c\u5176\u4e2d $b$ \u662f $a$ \u7684\u300c\u662f $y$ \u7684\u7956\u5148\u7684\u300d\u5b69\u5b50\u3002\u6211\u4eec\u53ea\u9700\u8981\u5728 $x, y, a, fa(a)$ \u56db\u4e2a\u70b9\u5206\u522b\u6253\u4e0a\u67e5\u8be2\u6807\u8bb0\uff0c\u67e5\u8be2\u8fd9\u56db\u4e2a\u4f4d\u7f6e\u5230\u6839\u7684\u8def\u5f84\u4e0a $W$ \u7684\u6743\u503c\u4e2a\u6570\uff0c\u8bb0\u4e3a $p$\uff0c\u5219 $(x, y)$ \u4e0a $W$ \u6743\u503c\u4e2a\u6570\u5373\u4e3a $p_x + p_y - p_a - p_{fa(a)}$\u3002\n\n\u7edf\u8ba1 $p$ \u53ea\u9700\u8981\u7528\u6811\u4e0a\u5dee\u5206\u7684\u5957\u8def\uff0c\u79bb\u7ebf\u8be2\u95ee\uff0c\u5728\u6811\u4e0a\u6253\u6807\u8bb0\uff0c\u6700\u540e\u8fdb\u884c\u4e00\u6b21 dfs\uff0c\u7528\u4e00\u4e2a\u5168\u5c40\u6876\u7ef4\u62a4\u5f53\u524d\u8282\u70b9\u5230\u6839\u7684\u6743\u503c\u6570\u91cf\u5373\u53ef\uff0c\u8be6\u89c1\u4ee3\u7801\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n \\log n)$ \u6216 $O(n \\alpha (n))$\u3002\u5176\u4e2d $\\log n$ \u6216 $\\alpha (n)$ \u662f\u6c42 LCA \u7684\u5f00\u9500\u3002\u56e0\u4e3a\u672c\u8eab\u5c31\u9700\u8981\u79bb\u7ebf\u8be2\u95ee\uff0cstd \u4f7f\u7528\u7684\u662f tarjan \u6c42 LCA \u7684 $O(n \\alpha (n))$ \u7684\u505a\u6cd5\uff0c\u4f7f\u7528\u500d\u589e\u6c42 LCA \u53ef\u80fd\u9700\u8981\u4e00\u5b9a\u7684\u5e38\u6570\u4f18\u5316\uff0c\u4f46\u662f\u6839\u636e\u9a8c\u9898\u4eba\u7a0b\u5e8f\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n(C++)\n\n```cpp\n#include <array>\n#include <vector>\n#include <iostream>\n\nconst int maxn = 1000005;\nconst int maxw = 10000007;\n\nint n, q;\nstd::array<std::vector<int>, maxn> e;\nstd::array<int, maxn> a, b, lca, ufs, rnk, anc, kk, cnt, fa, k, ans;\nstd::array<bool, maxn> vis;\nstd::array<std::vector<std::pair<int, int> >, maxn> qry, QQ;\nstd::array<std::pair<int, int>, maxn> Q;\nstd::array<int, maxw> bk;\n\nvoid dfs2(const int u);\nvoid dfs(const int u, const int f);\n\nint main() {\n  std::ios::sync_with_stdio(false);\n  std::cin.tie(0);\n  std::cin >> n >> q;\n  for (int i = 1; i <= n; ++i) {\n    std::cin >> a[i];\n    rnk[ufs[i] = anc[i] = i] = 1;\n  }\n  for (int u, v, i = 1; i < n; ++i) {\n    std::cin >> u >> v;\n    e[u].push_back(v); e[v].push_back(u);\n  }\n  for (int i = 1, u, v; i <= q; ++i) {\n    std::cin >> u >> v >> kk[i];\n    qry[u].push_back(std::make_pair(v, i));\n    qry[v].push_back(std::make_pair(u, i));\n    Q[i] = std::make_pair(u, v);\n  }\n  dfs(1, 0);\n  for (int i = 1; i <= q; ++i) if ((k[i] = b[Q[i].first] ^ b[Q[i].second] ^ a[lca[i]] ^ kk[i]) < maxw) {\n    QQ[Q[i].first].push_back(std::make_pair(i, 1));\n    QQ[Q[i].second].push_back(std::make_pair(i, 1));\n    QQ[lca[i]].push_back(std::make_pair(i, -1));\n    QQ[fa[lca[i]]].push_back(std::make_pair(i, -1));\n  }\n  dfs2(1);\n  std::array<std::string, 2> prt{\"nO\\n\", \"yEs\\n\"};\n  for (int i = 1; i <= q; ++i) std::cout << prt[ans[i] > 0];\n}\n\nint find(int x) { return ufs[x] == x ? x : ufs[x] = find(ufs[x]); }\n\nvoid dfs(const int u, const int f) {\n  b[u] = a[u] ^ b[f];\n  fa[u] = f;\n  for (auto v : e[u]) if (v != f) {\n    dfs(v, u);\n    int x = find(u), y = find(v);\n    if (rnk[x] > rnk[y]) std::swap(x, y);\n    anc[ufs[x] = y] = u;\n    if (rnk[x] == rnk[y]) ++rnk[y];\n  }\n  for (auto [v, i] : qry[u]) if (vis[v]) {\n    lca[i] = anc[find(v)];\n  }\n   vis[u] = true;\n}\n\nvoid dfs2(const int u) {\t// \u8fd9\u91cc\u662f\u6811\u4e0a\u5dee\u5206\u5bf9\u5e94\u6c42\u7ed3\u679c\u7684 dfs \u51fd\u6570\n  ++bk[a[u]];\n  for (auto [i, w] : QQ[u]) {\n    ans[i] += w * bk[k[i]];\n  }\n  for (auto v : e[u]) if (v != fa[u]) {\n    dfs2(v);\n  }\n  --bk[a[u]];\n}\n```",
        "postTime": 1647088765,
        "uid": 65363,
        "name": "\u4e00\u6276\u82cf\u4e00",
        "ccfLevel": 7,
        "title": "P8201"
    },
    {
        "content": "## **\u83ab\u961f**\n\n### \u9898\u76ee\u63cf\u8ff0\n\n[link](https://www.luogu.com.cn/problem/P8201)\n\n### \u7b80\u8981\u9898\u610f\n\n\u7ed9\u4f60\u4e00\u9897\u6811\uff0c\u8282\u70b9\u6709\u70b9\u6743\uff0c\u82e5\u5e72\u6b21\u8be2\u95ee\uff0c\u6c42\u662f\u5426\u5b58\u5728\u4e00\u70b9 $t$\uff0c\u6ee1\u8db3\u4e24\u70b9\u5230 $t$ \u7684\u8def\u5f84\u4e0a\u7684\u70b9\u6743\u5f02\u6216\u548c\u7b49\u4e8e $k$\u3002\n\n\u5373 $dis_{t,a}\\oplus dis_{t,b} = k$\n\n### \u6811\u4e0a\u83ab\u961f\n\n\u7b80\u5355\u89c2\u5bdf\u5373\u53ef\u53d1\u73b0\uff1a\n\n- \u82e5\u70b9 $t$ \u4f4d\u4e8e $a$\uff0c$b$ \u4e24\u70b9\u4efb\u610f\u4e00\u70b9 $p$ \u7684\u5b50\u6811\u4e2d\uff0c\u6709 $dis_{t,a} \\oplus dis_{t,b} = dis_{t,a} \\oplus dis_{t,b} \\oplus w_p$\n\n- \u82e5\u70b9 $t$ \u4f4d\u4e8e $lca_{a,b}$ \u4e4b\u4e0a\uff0c\u5219\u6709 $dis_{t,a} \\oplus dis_{t,b} = dis_{t,a} \\oplus dis_{t,b} \\oplus w_{lca}$\u3002\n\n- \u82e5\u70b9 $t$ \u4f4d\u4e8e $a$\uff0c$b$ \u4e24\u70b9\u8def\u5f84\u4e0a\u70b9 $p$ \u4e0a\u6216\u70b9 $p$ \u7684\u5b50\u6811\u4e2d\uff0c\u5219 $dis_{t,a} \\oplus dis_{t,b} = dis_{t,a} \\oplus dis_{t,b} \\oplus w_p$\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c**\u65e0\u8bba $t$ \u5904\u4e8e\u4f55\u5904\uff0c$dis_{t,a}\\oplus dis_{t,b}$ \u7684\u503c\u53ea\u4e0e $a$\uff0c$b$ \u8def\u5f84\u4e0a\u7684\u70b9\u6709\u5173\u3002** \u6211\u4eec\u4ee4\u8be5\u70b9\u4e3a $q$\u3002\n\n\u6613\u5f97 $dis_{t,a} \\oplus dis_{t,b} = k \\Leftrightarrow  k \\oplus dis_{a,b} = w_q$\n\n\u4e8e\u662f\u95ee\u9898\u5c31\u53d8\u6210\u4e86\uff0c**\u6c42 $a$\uff0c$b$ \u8def\u5f84\u4e0a\u662f\u5426\u6709\u4e00\u70b9 $q$ \u6ee1\u8db3 $w_q= k \\oplus dis_{a,b} $\u3002**\n\n\u56e0\u4e3a $w_i \\le  10^7$\uff0c \u6811\u4e0a\u83ab\u961f\u53ef\u505a\u3002\n\n### CODE\n\n```cpp\n#include<bits/stdc++.h>\n#define N 1000010\n#define re register\nusing namespace std;\ntemplate <typename T> inline void read(T &a)\n{\n\tT x=0,w=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\ta=x*w;\n}\nint n,m,head[N],cc,val[N],mcc;\nstruct EDGE{int v,nxt;}e[N<<1];\ninline void add_edge(int u,int v)\n{\n\te[++cc].v=v;e[cc].nxt=head[u];head[u]=cc;\n\te[++cc].v=u;e[cc].nxt=head[v];head[v]=cc;\n}\nint fa[N],dep[N],dis[N],top[N],son[N],siz[N],dfn[N<<1],dfcc,l[N],r[N];\nstruct QUERY{int l,r,k,id,lca;}q[N];\ninline void dfs1(int u)\n{\n\tsiz[u]=1;dep[u]=dep[fa[u]]+1;dis[u]=dis[fa[u]]^val[u];dfn[++dfcc]=u;l[u]=dfcc;\n\tfor(re int i=head[u];i;i=e[i].nxt)\n\t{\n\t\tint v=e[i].v;if(v==fa[u]) continue;\n\t\tfa[v]=u;dfs1(v);siz[u]+=siz[v];\n\t\tif(!son[u]||siz[son[u]]<siz[v]) son[u]=v;\n\t}\n\tdfn[++dfcc]=u;r[u]=dfcc;\n}\ninline void dfs2(int u,int tp)\n{\n\ttop[u]=tp;if(son[u]) dfs2(son[u],tp);\n\tfor(re int i=head[u];i;i=e[i].nxt)\n\t{\n\t\tint v=e[i].v;if(v==fa[u]||v==son[u]) continue;\n\t\tdfs2(v,v);\n\t}\n}\ninline int get_lca(int a,int b)\n{\n\twhile(top[a]!=top[b])\n\t{\n\t\tif(dep[top[a]]>dep[top[b]]) a=fa[top[a]];\n\t\telse b=fa[top[b]];\n\t}\n\treturn dep[a]<dep[b] ? a:b;\n}\nint bnum,blen,belong[N],nl=1,nr=0,cnt[100000010];\nbool ans[N],vis[N];\ninline bool cmp(QUERY x,QUERY y){return belong[x.l] ^ belong[y.l] ? belong[x.l] < belong[y.l] : ( (belong[x.l]&1) ? x.r<y.r : x.r>y.r);}\ninline void add(int x)\n{\n\tif(vis[dfn[x]]) cnt[val[dfn[x]]]--;\n\telse cnt[val[dfn[x]]]++;\n\tvis[dfn[x]]^=1;\n}\nsigned main()\n{\n\tread(n);read(m);\n\tfor(re int i=1;i<=n;++i) read(val[i]);\n\tfor(re int i=1,u,v;i<n;++i){read(u),read(v),add_edge(u,v);}\n\tdfs1(1);dfs2(1,1);\n\tblen=sqrt(dfcc);\n\tfor(re int i=1;i<=dfcc;++i) belong[i]=(i-1)/blen+1;\n\tfor(re int i=1,u,v,k,lca;i<=m;++i)\n\t{\n\t\tread(u);read(v);read(k);\n\t\tif(l[u]>l[v]) swap(u,v);\n\t\tlca=get_lca(u,v);\n\t\tk=k^dis[u]^dis[v]^val[lca];\n\t\tq[++mcc].l= lca==u ? l[u]:r[u];\n\t\tq[mcc].r=l[v];q[mcc].k=k;\n\t\tq[mcc].id=i;q[mcc].lca=lca;\n\t\tif(val[lca]==q[mcc].k) ans[i]=1,mcc--;\n\t}\n\tsort(q+1,q+1+mcc,cmp);\n\tfor(re int i=1;i<=mcc;++i)\n\t{\n\t\twhile(nl<q[i].l) add(nl++);\n\t\twhile(nl>q[i].l) add(--nl);\n\t\twhile(nr<q[i].r) add(++nr);\n\t\twhile(nr>q[i].r) add(nr--);\n\t\tans[q[i].id]=cnt[q[i].k];\n\t}\n\tfor(re int i=1;i<=m;++i) printf(ans[i] ? \"YES\\n\":\"NO\\n\");\n\treturn 0;\n}\n```\n\n\n",
        "postTime": 1647153768,
        "uid": 251324,
        "name": "stntn",
        "ccfLevel": 0,
        "title": "P8201 \u751f\u6d3b\u5728\u6811\u4e0a\uff08hard version\uff09\u9898\u89e3"
    },
    {
        "content": "[\u9898\u9762](https://www.luogu.com.cn/problem/P8201)\n\n\u8fd9\u9053\u9898\u5c31\u662f\u8be2\u95ee\u628a\u8def\u5f84\u4e0a\u67d0\u4e00\u70b9\u53bb\u6389\u7684\u5f02\u6216\u503c\u53ef\u4e0d\u53ef\u4ee5\u662f $k$\uff0c\u56e0\u4e3a\u968f\u610f\u9009\u4e00\u4e2a\u70b9 $x$ \uff0c\u5b83\u5230 $u,v$ \u7684\u8def\u5f84\u4e0e\u8def\u5f84 $u\\rightarrow v$ \u5fc5\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\u4ea4\u70b9\uff08\u5efa\u8bae\u52a8\u624b\u753b\u4e00\u753b\uff09\u3002\n\n\u7136\u540e\u9898\u4e0a\u7684 $dis_{t,a}\u2a01dis_{t,b}$ \u5c31\u662f\u628a\u8def\u5f84 $u\\rightarrow v$ \u4e0a\u53bb\u6389\u4e00\u70b9\u7684\u5f02\u6216\u503c\u3002\n\n\u53ef\u4ee5\u4ee4 $dis_{u,v}$ \u8868\u793a $u$ \u5230 $v$ \u7684\u8def\u5f84\u4e0a\u6240\u6709\u70b9\u7684\u5f02\u6216\u503c\uff0c$w_i$ \n\u8868\u793a $i$ \u70b9\u7684\u503c\u3002\u82e5\u5728\u8def\u5f84\u4e0a\u627e\u5230\u70b9 $p$ \u4f7f\u5f97 $dis_{u,v}~\\text{xor}~w_p=k$ \uff0c\u5373 $w_p=dis_{u,v}~\\text{xor}~k$\uff0c\u90a3\u4e48\u7b54\u6848\u663e\u7136\u662f\u80af\u5b9a\u7684\u3002\n\n\u5219\u8003\u8651\u6811\u4e0a\u4e3b\u5e2d\u6811\uff0c\u628a\u70b9\u6743\u79bb\u6563\u5316\uff0c\u5728\u7ebf\u6c42\u51fa $u$ \u548c $v$ \u8def\u5f84\u4e0a\u70b9 $p$ \u7684\u4e2a\u6570\u3002\n\n\u600e\u4e48\u6c42\uff1f\u53ef\u4ee5\u4ee4 $lca_{u,v}$ \u8868\u793a $u$ \u548c $v$ \u7684\u6700\u8fd1\u516c\u5171\u7956\u5148 ~~\u53ef\u4ee5\u7528\u6811\u5256\uff0c\u4f46\u6211\u89c9\u5f97\u592a\u957f\u4e86\u5c31\u6253\u500d\u589e~~\uff0c$f_{i}$ \u4e3a 1 \u5230 $i$ \u8def\u5f84\u4e0a\u7684\u5f02\u6216\u503c\u3002$dis_{u,v}=f_u~\\text{xor}~f_v~\\text{xor}~w_{lca}$\uff0c\u7136\u540e\u5c31\u662f\u677f\u5b50\u4e86\u3002\n\n[\u6811\u4e0a\u4e3b\u5e2d\u6811\u6a21\u677f](https://www.luogu.com.cn/problem/P2633)\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=2e6+500;\n\nstruct node\n{\n\tint u,v,nxt;\n}e[N];\n\nstruct nodee\n{\n\tint l,r,tl,tr,v;\n}t[N<<3];\n\nint n,m,f[N],head[N],cnt,w[N],fa[N][25],d[N],tot,cc,rt[N];\nmap<int,int>mp;\n\nvoid add(int u,int v)\n{\n\te[++cnt].u=u;\n\te[cnt].v=v;\n\te[cnt].nxt=head[u];\n\thead[u]=cnt;\n}\n\nvoid ADD(int a,int b,int x)\n{\n\tt[a].l=t[b].l;t[a].r=t[b].r;\n\tif(t[b].tl==0)\n\t{\n\t\tt[a].v=t[b].v+1;\n\t\treturn;\n\t}\n\tif(x>(t[b].l+t[b].r)/2)//rightson\n\t{\n\t\tt[a].tl=t[b].tl;\n\t\tt[a].tr=++cc;\n\t\tADD(t[a].tr,t[b].tr,x);\n\t}\n\telse//leftson\n\t{\n\t\tt[a].tr=t[b].tr;\n\t\tt[a].tl=++cc;\n\t\tADD(t[a].tl,t[b].tl,x);\n\t}\n\tt[a].v=t[t[a].tl].v+t[t[a].tr].v;\n\treturn;\n}\n\nvoid dfs(int x,int ff)\n{\n\tf[x]=f[ff]^w[x];fa[x][0]=ff;d[x]=d[ff]+1;\n\trt[x]=++cc,ADD(rt[x],rt[ff],mp[w[x]]);\n\tfor(int i=head[x];i;i=e[i].nxt)\n\t{\n\t\tint v=e[i].v;\n\t\tif(v==ff)continue;\n\t\tdfs(v,x);\n\t}\n}\n\nint LCA(int u,int v)\n{\n\tif(d[u]<d[v])swap(u,v);\n\tfor(int i=20;i>=0;i--)\n\tif(d[u]-(1<<i)>=d[v])\n\tu=fa[u][i];\n\tif(u==v)return u;\n\tfor(int i=20;i>=0;i--)\n\tif(fa[u][i]!=fa[v][i])\n\tu=fa[u][i],v=fa[v][i];\n\treturn fa[u][0];\n}\n\nint get(int a,int b,int x)\n{\n\tif(t[a].tl==0)return t[b].v-t[a].v;\n\tif(x<=(t[a].l+t[a].r)/2)return get(t[a].tl,t[b].tl,x);//lson\n\treturn get(t[a].tr,t[b].tr,x);//rson\n}\n\nint check(int u,int v,int k,int lca)\n{\n\tint l=f[u]^f[v]^w[lca];\n\tif(!mp[(k^l)])return 0;\n\tint x=mp[(k^l)];\n\tif(get(rt[fa[lca][0]],rt[u],x)>0||get(rt[fa[lca][0]],rt[v],x)>0)return 1;\n\treturn 0;\n\t\n}\n\nvoid build(int id,int l,int r)\n{\n\tt[id].l=l,t[id].r=r;\n\tif(l==r)return;\n\tint mid=(l+r)>>1;\n\tt[id].tl=++cc;build(t[id].tl,l,mid);\n\tt[id].tr=++cc;build(t[id].tr,mid+1,r);\n}\n\nmain()\n{\n\tstd::ios::sync_with_stdio(false);\n\tcin>>n>>m;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tcin>>w[i];\n\t\tif(!mp[w[i]])mp[w[i]]=++tot;\n\t}\n\trt[0]=++cc;\n\tbuild(rt[0],1,tot);\n\tint u,v;\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tcin>>u>>v;\n\t\tadd(u,v);\n\t\tadd(v,u);\n\t}\n\tdfs(1,0);\n\tfor(int i=1;(1<<i)<=n;i++)\n\tfor(int j=1;j<=n;j++)\n\tfa[j][i]=fa[fa[j][i-1]][i-1];\n\tint k,lca;\n\twhile(m--)\n\t{\n\t\tcin>>u>>v>>k;\n\t\tlca=LCA(u,v);\n\t\tif(check(u,v,k,lca))puts(\"YES\");\n\t\telse puts(\"NO\");\n\t}\n}\n```\n\u7801\u98ce\u4e0d\u597d\uff0c\u52ff\u55b7\u3002~~\u8dd1\u7684\u597d\u6162~~\n\n~~\u628a\u4e00\u9053\u7eff\u505a\u6210\u4e86\u84dd\uff0c\u6211\u597d\u83dc~~",
        "postTime": 1647155434,
        "uid": 307826,
        "name": "Lamorak",
        "ccfLevel": 0,
        "title": "P8201 \u751f\u6d3b\u5728\u6811\u4e0a\uff08hard version\uff09 \u9898\u89e3"
    },
    {
        "content": "\u8fd9\u573a\u6bd4\u8d5b\u6211\u7528\u5c0f\u53f7\u6253\u7684\uff0c\u5728\u8fd8\u5269 $40$ \u5206\u949f\u7684\u65f6\u5019\u5206\u6790\u51fa\u672c\u9898\u505a\u6cd5\uff0c\u8fd8\u5269 $20$ \u5206\u949f\u7684\u65f6\u5019\u6210\u529f RE\uff0c\u7136\u540e\u7ecf\u5386\u6f2b\u957f\u7684\u8c03\u8bd5\u4e0e\u591a\u6b21\u63d0\u4ea4\uff0c\u7ec8\u4e8e\u5728\u8fd8\u6709\u4e24\u5206\u949f\u7684\u65f6\u5019\u901a\u8fc7\u672c\u9898\u3002\u597d\u5bb6\u4f19\uff0c\u771f\u6709\u6253 CF \u90a3\u611f\u89c9\u4e86\u3002\n\n### \u601d\u8def\uff1a\n\n\u6211\u4eec\u6ce8\u610f\u5230\uff0c\u8bbe\u6240\u9009\u7684\u8fd9\u4e2a\u70b9\u4e3a $k$\uff0c\u8bb0 $d_{x,y}$ \u8868\u793a\u4ece $x$ \u5230 $y$ \u8fd9\u6761\u8def\u5f84\u7684\u5f02\u6216\u548c\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u8981\u627e\u5230\u4e00\u4e2a $k$ \u4f7f\u5f97 $d_{x,k}\\operatorname{xor}d_{y,k}=w$\u3002\u4e0d\u96be\u53d1\u73b0\uff0c\u5728 $(x,y)$ \u8fd9\u6761\u8def\u5f84\u4e0a\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u70b9\u7684\u6743\u503c\u88ab\u7b97\u4e86\u4e24\u904d\u6d88\u5931\u4e86\uff0c\u800c\u6839\u636e\u9898\u610f\uff0c\u8fd9\u4e2a\u70b9\u6743\u503c\u5e94\u8be5\u662f $d_{x,y}\\operatorname{xor}w$\u3002\n\n\u6240\u4ee5\uff0c\u9898\u610f\u8f6c\u5316\u4e3a\uff1a\u7ed9\u5b9a $x,y,w$\uff0c\u5224\u65ad $(x,y)$ \u8fd9\u6761\u8def\u5f84\u4e0a\u662f\u5426\u6709\u4e00\u4e2a\u70b9 $k$\uff0c\u4f7f\u5f97 $a_k=d_{x,y}\\operatorname{xor}w$\u3002\n\n\u4e3a\u884c\u6587\u65b9\u4fbf\uff0c\u4e0b\u6587\u4e2d\u7528 $w$ \u4ee3\u66ff $d_{x,y}\\operatorname{xor}w$\u3002\n\n\u5177\u4f53\u600e\u4e48\u5b9e\u73b0\u5462\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u628a\u8be2\u95ee\u79bb\u7ebf\u4e0b\u6765\uff0c\u5bf9\u4e8e\u76f8\u540c\u7684 $w$ \u8fdb\u884c\u7edf\u4e00\u5904\u7406\u3002\n\n\u8003\u8651\u91c7\u7528\u6811\u5256+\u7ebf\u6bb5\u6811\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u6743\u503c\u4e3a $w$ \u7684\u70b9\uff0c\u5728\u7ebf\u6bb5\u6811\u4e0a\u6240\u5bf9\u5e94\u7684\u4f4d\u7f6e $+1$\uff0c\u6bcf\u6b21\u67e5\u8be2\u53ea\u9700\u8981\u67e5 $(x,y)$ \u8fd9\u6761\u94fe\u4e0a\u7684\u6743\u503c\u662f\u5426 $\\ge 0$ \u5373\u53ef\u3002\n\n~~\u4e8e\u662f\u5462\uff0c\u6211\u6210\u529f\u7684\u628a\u4e00\u9053\u7eff\u9898\u505a\u6210\u4e86\u84dd\u9898\u3002~~\n\n\u54e6\u5bf9\u4e86\uff0c\u8fd9\u9898\u4e0d\u9700\u8981\u5f00 long long\u3002\n\n### Code:\n```cpp\n/*\n\tCopyright (C) 2022  Troubadour_Ggmz\n\n\tThis program is free software: you can redistribute it and/or modify\n\tit under the terms of the GNU General Public License as published by\n\tthe Free Software Foundation, either version 3 of the License, or\n\t(at your option) any later version.\n\n\tThis program is distributed in the hope that it will be useful,\n\tbut WITHOUT ANY WARRANTY; without even the implied warranty of\n\tMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n\tGNU General Public License for more details.\n\n\tYou should have received a copy of the GNU General Public License\n\talong with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n#include<bits/stdc++.h>\nstruct istream {  //\u5feb\u8bfb\u677f\u5b50\n\tinline char gc() {\n\t\tstatic const int IN_LEN = 1 << 18 | 1;\n\t\tstatic char buf[IN_LEN], *s, *t;\n\t\treturn (s == t) && (t = (s = buf) + fread(buf, 1, IN_LEN, stdin)), s == t ? -1 : *s++;\n\t}\n\n\ttemplate <typename _Tp> inline istream & operator >> (_Tp&x) {\n\t\tstatic char ch, sgn; ch = gc(), sgn = 0;\n\t\tfor (;!isdigit(ch);ch = gc()) { if (ch == -1)return *this;sgn |= ch == '-'; }\n\t\tfor (x = 0;isdigit(ch);ch = gc())x = x * 10 + (ch^'0');\n\t\tsgn && (x = -x); return *this;\n\t}\n} cin;\nnamespace GGMZ\n{\n\tconst int N = 5e5 + 5;\n\tstruct edge\n\t{\n\t\tint to, nxt;\n\t}e[N << 1];\n\tint head[N], cnt;\n\tvoid add(int u, int v)\n\t{\n\t\tcnt++;\n\t\te[cnt].to = v;\n\t\te[cnt].nxt = head[u];\n\t\thead[u] = cnt;\n\t}\n\tint top[N], size[N], fa[N], son[N], tot, a[N], dis[N], dep[N], dfn[N], nfd[N];\n\tvoid dfs1(int u, int f)\n\t{\n\t\tdep[u] = dep[f] + 1;\n\t\tsize[u] = 1;\n\t\tfa[u] = f;\n\t\tdis[u] = dis[f] ^ a[u];\n\t\tfor (int i = head[u];i;i = e[i].nxt)\n\t\t{\n\t\t\tint v = e[i].to;\n\t\t\tif (v == f)continue;\n\t\t\tdfs1(v, u);\n\t\t\tsize[u] += size[v];\n\t\t\tif (size[son[u]] < size[v])son[u] = v;\n\t\t}\n\t}\n\tvoid dfs2(int u, int tp)\n\t{\n\t\ttop[u] = tp;\n\t\tdfn[u] = ++tot;\n\t\tnfd[tot] = u;\n\t\tif (son[u])dfs2(son[u], tp);\n\t\tfor (int i = head[u];i;i = e[i].nxt)\n\t\t{\n\t\t\tint v = e[i].to;\n\t\t\tif (v == fa[u] || v == son[u])continue;\n\t\t\tdfs2(v, v);\n\t\t}\n\t}\n\tstd::map<int, std::vector<int>>mp;\n\tstruct seg\n\t{\n\t\tint l, r, val, clear;\n\t}f[N << 2];\n\tvoid update(int p)\n\t{\n\t\tf[p].val = f[p << 1].val + f[p << 1 | 1].val;\n\t}\n\tvoid brush(int p)\n\t{\n\t\tf[p].val = 0;\n\t\tf[p].clear = 1;\n\t}\n\tvoid push_down(int p)\n\t{\n\t\tif (f[p].clear)\n\t\t{\n\t\t\tbrush(p << 1);\n\t\t\tbrush(p << 1 | 1);\n\t\t\tf[p].clear = 0;\n\t\t}\n\t}\n\tvoid build(int p, int l, int r)\n\t{\n\t\tf[p].l = l, f[p].r = r;\n\t\tif (l == r)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tint mid = (l + r) >> 1;\n\t\tbuild(p << 1, l, mid);\n\t\tbuild(p << 1 | 1, mid + 1, r);\n\t}\n\tvoid modify(int p, int x)\n\t{\n\t\tif (f[p].l == f[p].r)\n\t\t{\n\t\t\tf[p].val = 1;\n\t\t\treturn;\n\t\t}\n\t\tpush_down(p);\n\t\tint mid = (f[p].l + f[p].r) >> 1;\n\t\tif (mid >= x)modify(p << 1, x);\n\t\tif (mid < x) modify(p << 1 | 1, x);\n\t\tupdate(p);\n\t}\n\tint query(int p, int l, int r)\n\t{\n\t\tif (l <= f[p].l&&f[p].r <= r)\n\t\t{\n\t\t\treturn f[p].val;\n\t\t}\n\t\tpush_down(p);\n\t\tint res = 0, mid = (f[p].l + f[p].r) >> 1;\n\t\tif (mid >= l)res += query(p << 1, l, r);\n\t\tif (mid < r)res += query(p << 1 | 1, l, r);\n\t\treturn res;\n\t}\n\tinline int lca(int x, int y)\n\t{\n\t\twhile (top[x] != top[y])\n\t\t{\n\t\t\tif (dep[top[x]] < dep[top[y]])std::swap(x, y);\n\t\t\tx = fa[top[x]];\n\t\t}\n\t\tif (dep[x] > dep[y])std::swap(x, y);\n\t\treturn x;\n\t}\n\tint query(int x, int y)\n\t{\n\t\tint res = 0;\n\t\twhile (top[x] != top[y])\n\t\t{\n\t\t\tif (dep[top[x]] < dep[top[y]])std::swap(x, y);\n\t\t\tres += query(1, dfn[top[x]], dfn[x]);\n\t\t\tx = fa[top[x]];\n\t\t}\n\t\tif (dep[x] > dep[y])std::swap(x, y);\n\t\tres += query(1, dfn[x], dfn[y]);\n\t\treturn res;\n\t}\n\tint n, m;\n\tstruct query_\n\t{\n\t\tint x, y, w, id, skipped;\n\t\tbool operator<(const query_ a)const\n\t\t{\n\t\t\treturn w < a.w;\n\t\t}\n\t}q[N];\n\tbool vis[10000005];\n\tstd::string ans[N];\n\tvoid work()\n\t{\n\t\tcin >> n >> m;\n\t\tfor (int i = 1;i <= n;i++)\n\t\t{\n\t\t\tcin >> a[i];\n\t\t}\n\t\tfor (int i = 1;i < n;i++)\n\t\t{\n\t\t\tint u, v;\n\t\t\tcin >> u >> v;\n\t\t\tadd(u, v);\n\t\t\tadd(v, u);\n\t\t}\n\t\tdfs1(1, 0);\n\t\tdfs2(1, 1);\n\t\tbuild(1, 1, n);\n\t\tfor (int i = 1;i <= m;i++)\n\t\t{\n\t\t\tint u, v, w;\n\t\t\tcin >> u >> v >> w;\n\t\t\tint p = dis[u] ^ dis[v] ^ a[lca(u, v)];\n\t\t\tq[i].x = u, q[i].y = v;\n\t\t\tq[i].w = w ^ p;\n\t\t\tq[i].id = i;\n\t\t\tif (q[i].w > 10000000)\n\t\t\t{\n\t\t\t\tans[i] = \"NO\";\n\t\t\t\tq[i].skipped = 1;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tvis[w^p] = 1;\n\t\t}\n\t\tfor (int i = 1;i <= n;i++)\n\t\t{\n\t\t\tif (vis[a[i]])\n\t\t\t{\n\t\t\t\tmp[a[i]].push_back(i);\n\t\t\t}\n\t\t}\n\t\tstd::sort(q + 1, q + 1 + m);\n\t\tq[0].w = -1;\n\t\tfor (int i = 1;i <= m;i++)\n\t\t{\n\t\t\tif (q[i].skipped)continue;\n\t\t\tif (q[i].w != q[i - 1].w)\n\t\t\t{\n\t\t\t\tbrush(1);\n\t\t\t\tfor (int a : mp[q[i].w])\n\t\t\t\t{\n\t\t\t\t\tmodify(1, dfn[a]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (query(q[i].x, q[i].y))\n\t\t\t{\n\t\t\t\tans[q[i].id] = \"YES\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tans[q[i].id] = \"NO\";\n\t\t\t}\n\t\t}\n\t\tfor (int i = 1;i <= m;i++)\n\t\t{\n\t\t\tputs(ans[i].c_str());\n\t\t}\n\t}\n}\nint main()\n{\n\treturn GGMZ::work(), 0;\n}\n```",
        "postTime": 1647091820,
        "uid": 400781,
        "name": "Troubadour",
        "ccfLevel": 0,
        "title": "P8201 \u751f\u6d3b\u5728\u6811\u4e0a\uff08hard version\uff09\u9898\u89e3"
    },
    {
        "content": "### \u9898\u610f:\n\n\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u5b9a\u4e49 $d(u,v)$ \u4e3a $u$ \u548c $v$ \u8def\u5f84\u4e0a\u6240\u6709\u70b9\u6743\u7684\u5f02\u6216\uff0c\u591a\u7ec4\u8be2\u95ee\uff0c\u7ed9\u5b9a $u,v,k$\uff0c\u95ee\u662f\u5426\u5b58\u5728 $x$ \u4f7f\u5f97 $d(u,x) \\bigoplus d(x,v)=k$\u3002\n\n### \u601d\u8def\uff1a\n\n\u89c2\u5bdf\u6027\u8d28\u53d1\u73b0\uff0c\u5982\u679c\u5b58\u5728 $x$ \u4e0d\u5728 $u,v$ \u8def\u5f84\u4e0a\u6ee1\u8db3\u6761\u4ef6\uff0c\u90a3\u4e48 $u,x$ \u8def\u5f84\u548c $v,x$ \u8def\u5f84\u7684\u7b2c\u4e00\u4e2a\u4ea4\u70b9\u5fc5\u7136\u4e5f\u6ee1\u8db3\u6761\u4ef6\uff0c\u56e0\u4e3a\u7b2c\u4e00\u4e2a\u4ea4\u70b9\u5f80\u540e\u5fc5\u7136\u4e00\u76f4\u91cd\u5408\uff0c\u6240\u4ee5\u90fd\u80fd\u591f\u62b5\u6d88\u3002\u8fd8\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e2a\u4ea4\u70b9\u5fc5\u7136\u5728 $u,v$ \u8def\u5f84\u4e0a\uff0c\u60f3\u4e00\u60f3\uff0c\u4e3a\u4ec0\u4e48\u3002\n\n\u56e0\u6b64\uff0c\u95ee\u9898\u7b49\u4ef7\u4e8e\u5728 $u,v$ \u8def\u5f84\u4e0a\u662f\u5426\u5b58\u5728 $x$ \u4f7f\u5f97 $d(u,x) \\bigoplus d(x,v)=k$\uff0c\u7531\u4e8e $d(u,x) \\bigoplus d(x,v)=d(u,v)\\bigoplus w_x$\uff0c\u8f6c\u5316\u4e3a\u5728 $u,v$ \u8def\u5f84\u4e0a\u662f\u5426\u5b58\u5728 $x$ \u4f7f\u5f97 $d(u,v)\\bigoplus w_x=k$\uff0c\u5de6\u53f3\u540c\u65f6\u5f02\u6216 $d(u,v)$ \u5f97\u5230 $w_x=d(u,v)\\bigoplus k$\uff0c\u7531\u4e8e\u53f3\u5f0f\u662f\u4e2a\u5e38\u6570\uff0c\u8bbe\u4e3a $y$\uff0c\u6700\u7ec8\u8f6c\u5316\u4e3a\u5224\u65ad\u4e00\u6761\u8def\u5f84\u4e0a\u662f\u5426\u5b58\u5728\u70b9\u6743\u4e3a $y$ \u7684\u70b9\u3002\n\n\u4e0e\u5176\u7ef4\u62a4\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u5982\u76f4\u63a5\u7ef4\u62a4\u4e2a\u6570\uff0c\u5b9a\u4e49 $f(u,v,w)$ \u8868\u793a $u,v$ \u8def\u5f84\u4e0a $x$ \u7684\u51fa\u73b0\u6b21\u6570\u3002\n\n\u7531\u4e8e\u51fa\u73b0\u6b21\u6570\u5177\u6709\u53ef\u51cf\u6027\uff0c\u6240\u4ee5 $f(u,v,w)=f(u,1,w)+f(v,1,w)-f(lca(u,v),1,w)-f(father_{lca(u,v)},1,w)$\uff0c\u628a $f(u,v,w)$ \u8fd9\u4e00\u4e2a\u8be2\u95ee\u62c6\u6210\u56db\u4e2a\u8be2\u95ee\u5904\u7406\uff0c\u8f6c\u5316\u4e3a\u4efb\u610f $u,w$ \u6c42 $f(u,1,w)$\u3002\n\n\u8fd9\u5f88\u660e\u663e\u662f\u4e2a\u6570\u636e\u7ed3\u6784\u95ee\u9898\uff0c\u4e0b\u9762\u7ed9\u51fa\u4e24\u79cd\u505a\u6cd5\uff1a\n\n1. \u8003\u8651\u4e3b\u5e2d\u6811\uff0c\u7531\u4e8e\u52a0\u5165 $x$ \u8fd9\u4e2a\u70b9\u76f8\u5f53\u4e8e\u662f\u5728\u5176\u7236\u4eb2\u7684\u7248\u672c\u4e0a\u52a0\u5165\u6709\u5173 $w_x$ \u7684\u4fe1\u606f\uff0c\u90a3\u4e48\u53ef\u4ee5\u5728\u5408\u7406\u7684\u65f6\u95f4\u5185\u5efa\u51fa\u6bcf\u4e2a\u70b9\u7684\u4e3b\u5e2d\u6811\uff0c\u76f4\u63a5\u6c42\u89e3\u5373\u53ef\uff0c\u4ee3\u7801\u96be\u5ea6\u7a0d\u5927\u3002\n2. \u8003\u8651\u79bb\u7ebf\u4e0b\u6765\uff0c\u5168\u5c40\u6876\u7ef4\u62a4\uff0c\u79bb\u5f00\u8fd9\u4e2a\u70b9\u65f6\u5220\u9664\u8fd9\u4e2a\u70b9\u5728\u6876\u4e2d\u7684\u8d21\u732e\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u90fd\u80fd\u5f97\u5230\u4e00\u4e2a\u7ef4\u62a4\u5b83\u5230\u6839\u8def\u5f84\u4fe1\u606f\u7684\u6876\uff0c\u4f46\u662f\u8fd9\u4e2a\u70b9\u7684\u987a\u5e8f\u662f dfn \u5e8f\uff0c\u5bf9\u8be2\u95ee\u7684\u70b9\u5e76\u4e0d\u8fde\u7eed\uff0c\u6240\u4ee5\u5c06\u6240\u6709\u62c6\u5f00\u7684\u8be2\u95ee\u6309 dfn \u6392\u5e8f\uff0c\u90a3\u4e48\u53ef\u4ee5\u5f97\u5230\u7b54\u6848\u7684\u603b\u662f\u8be2\u95ee\u7684\u4e00\u4e2a\u524d\u7f00\uff0c\u5355\u6307\u9488\u626b\u4e00\u904d\u5373\u53ef\uff0c\u5b9e\u73b0\u7ec6\u8282\u6bd4\u8f83\u591a\u3002\n\n### \u4ee3\u7801\uff1a\n\n\u7ed9\u51fa\u7b2c\u4e8c\u79cd\u505a\u6cd5\u7684\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nint n,m,id,dfn[(int)(5e5+10)],w[(int)(5e5+10)],f[35][(int)(5e5+10)];\nint res[(int)(5e5+10)],dep[(int)(5e5+10)],p[(int)(5e5+10)],d[(int)(5e5+10)];\nvector<int>edge[(int)(5e5+10)];\nvoid dfs(int u,int fa)\n{\n\tdfn[u]=++id;f[0][u]=fa;\n\tdep[u]=dep[fa]+1;p[u]^=p[fa];\n\tfor(int i=1;i<=20;i++)\n\t{\n\t\tf[i][u]=f[i-1][f[i-1][u]];\n\t}\n\tfor(int i=0;i<edge[u].size();i++)\n\t{\n\t\tint v=edge[u][i];\n\t\tif(v==fa) continue;\n\t\tdfs(v,u);\n\t}\n}\nint lca(int x,int y)\n{\n    if(dep[x]<dep[y]) swap(x,y);\n    while(dep[x]>dep[y])\n    {\n        x=f[d[dep[x]-dep[y]]-1][x];\n    }\n    if(x==y) return x;\n    for(int i=d[dep[x]]-1;i>=0;i--)\n    {\n        if(f[i][x]!=f[i][y]) x=f[i][x],y=f[i][y];\n    }\n    return f[0][x];\n}\n\nstruct node\n{\n\tint id,type,u,val,dfn,from,ans;\n}a[(int)(2e6+10)],b[(int)(2e6+10)];\nbool cmp(node a,node b)\n{\n\treturn a.dfn<b.dfn;\n}\nmap<int,int>mp;\nint now=1,top=0;\nvoid dfs1(int u,int fa)\n{\n\tmp[w[u]]++;\n\twhile(a[now].u==u&&now<=top) \n\t{\n\t\ta[now].ans=mp[a[now].val];\n\t\tnow++;\n\t}\n\tfor(int i=0;i<edge[u].size();i++)\n\t{\n\t\tint v=edge[u][i];\n\t\tif(v==fa) continue;\n\t\tdfs1(v,u);\n\t}\n\tmp[w[u]]--;\n}\nsigned main()\n{\n\tcin>>n>>m;\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&w[i]),p[i]=w[i];\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint u,v;scanf(\"%lld %lld\",&u,&v);\n\t\tedge[u].push_back(v);\n\t\tedge[v].push_back(u);\n\t}\n\tfor(int i=1;i<=n;i++)\n    {\n        d[i]=d[i-1]+(1<<d[i-1]==i);\n    }\n\tdfs(1,0);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint u,v,k;scanf(\"%lld %lld %lld\",&u,&v,&k);\n\t\tint t=lca(u,v);\n\t\tif(t==u||t==v)\n\t\t{\n\t\t\tif(v==t)\n\t\t\t{\n\t\t\t\ta[++top]=(node){top,1,u,p[u]^p[f[0][t]]^k,dfn[u],i,0};\n\t\t\t\tif(t!=1) a[++top]=(node){top,-1,f[0][t],p[u]^p[f[0][t]]^k,dfn[f[0][t]],i,0};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ta[++top]=(node){top,1,v,p[v]^p[f[0][t]]^k,dfn[v],i,0};\n\t\t\t\tif(t!=1) a[++top]=(node){top,-1,f[0][t],p[v]^p[f[0][t]]^k,dfn[f[0][t]],i,0};\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\ta[++top]=(node){top,1,u,p[u]^p[v]^w[t]^k,dfn[u],i,0};\n\t\t\ta[++top]=(node){top,1,v,p[u]^p[v]^w[t]^k,dfn[v],i,0};\n\t\t\ta[++top]=(node){top,-1,t,p[u]^p[v]^w[t]^k,dfn[t],i,0};\n\t\t\tif(t!=1) a[++top]=(node){top,-1,f[0][t],p[u]^p[v]^w[t]^k,dfn[f[0][t]],i,0};\n\t\t}\n\t}\n\tsort(a+1,a+1+top,cmp);\n\tdfs1(1,0);\n\tfor(int i=1;i<=top;i++)\n\t{\n\t\t// cout<<a[i].u<<\"\\n\";\n\t\tb[a[i].id]=a[i];\n\t}\n\tfor(int i=1;i<=top;i++)\n\t{\n\t\tres[b[i].from]+=b[i].type*b[i].ans;\n\t}\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\t// assert(res[i]>=0);\n\t\tif(res[i]) puts(\"Yes\");\n\t\telse puts(\"No\");\n\t}\n\tsystem(\"pause > null\");\n}\n```\n\n",
        "postTime": 1651636050,
        "uid": 413777,
        "name": "npqenqpve",
        "ccfLevel": 0,
        "title": "P8201"
    },
    {
        "content": "\u8fd9\u4e2a\u849f\u84bb\u4e0d\u4f1a\u6811\u4e0a\u83ab\u961f\uff0c\u4e0d\u4f1a\u4e3b\u5e2d\u6811\uff0c\u4e0d\u4f1a\u6811\u4e0a\u5dee\u5206\uff0c\u4e5f\u61d2\u5f97\u79bb\u7ebf\uff0c\u6240\u4ee5\u5c31\u60f3\u51fa\u4e86\u4e00\u4e2a**\u6811\u5256**+**\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811**\u505a\u6cd5\n\n### \u601d\u8def\uff1a\n\n\u8fd9\u9053\u9898\u53ef\u4ee5\u8f6c\u5316\u6210:\n\n \n _\u5728\u8def\u5f84  $(a,b)$ \u4e0a\u53bb\u6389\u4e00\u70b9\uff0c\u4f7f\u5f97\u5269\u4e0b\u70b9\u7684\u6743\u503c\u5f02\u6216\u548c\u7b49\u4e8e $k$_ \n \n \u4e5f\u5c31\u662f\u8bf4\uff0c\u628a\u6574\u6761\u8def\u5f84\u4e0a\u7684\u503c\u5f02\u6216\u8d77\u6765\uff08\u8bbe\u4e3a $s$\uff09\uff0c\u518d\u5f02\u6216\u4e0a\u8fd9\u6761\u8def\u5f84\u4e0a\u67d0\u4e00\u4e2a\u503c $t$ \uff0c\u4f7f\u5f97 $s$ $xor$ $t$ $=$ $k$ \uff0c\u5373 $s$ $xor$ $k$ $=$ $t$\n \n \u56e0\u4e3a $(a,b)$ \u5df2\u7ecf\u7ed9\u51fa\uff0c\u90a3\u4e48 $s$ \u5f88\u5bb9\u6613\u6c42\uff0c\u95ee\u9898\u8f6c\u5316\u4e3a\u8fd9\u6761\u8def\u5f84\u4e0a\u6743\u503c $t$ \u662f\u5426\u5b58\u5728\n \n \u7136\u540e\u5c31\u662f\u4e00\u4e2a\u8f7b\u91cd\u94fe\u5256\u5206\u7684\u677f\u5b50\u4e86\uff0c\u7528\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u4e00\u4e2a\u6743\u503c\u5728\u8fd9\u6761\u91cd\u94fe\u4e0a\u662f\u5426\u51fa\u73b0\u5373\u53ef\n \n \n ```cpp\n #include<cstdio>\n#include<cstring>\nconst int M=1e7+10,N=5e5+10;\n\nvoid swap(int &p,int &q){\n\tint t=p;p=q;q=t;\n}\n\nstruct Edge{\n\tint to,next;\n}edge[N<<1];\nint head[N],cnte;\nvoid add(int u,int v){\n\tedge[++cnte].to=v;\n\tedge[cnte].next=head[u];\n\thead[u]=cnte;\n}\n\nint son[N],fa[N],size[N],dep[N];\nvoid dfs1(int u,int f){\n\tfa[u]=f,dep[u]=dep[f]+1;\n\tsize[u]=1;\n\tfor(int i=head[u];~i;i=edge[i].next){\n\t\tint v=edge[i].to;\n\t\tif(v!=f){\n\t\t\tdfs1(v,u);\n\t\t\tsize[u]+=size[v];\n\t\t\tif(size[v]>size[son[u]]) son[u]=v;\n\t\t}\n\t}\n}\nint top[N],id[N],rev[N],cntp;\nvoid dfs2(int u,int t){\n\ttop[u]=t;\n\tid[u]=++cntp,rev[cntp]=u;\n\tif(!son[u]) return;\n\tdfs2(son[u],t);\n\tfor(int i=head[u];~i;i=edge[i].next){\n\t\tint v=edge[i].to;\n\t\tif(v!=fa[u]&&v!=son[u]) dfs2(v,v);\n\t}\n}\n\nnamespace SegmentTree{\n\tstruct Tree{\n\t\tint lc,rc,val;\n\t}tr[M];\n\tint rt[M],cntt;\n\tvoid pushup(int p){\n\t\ttr[p].val=tr[tr[p].lc].val+tr[tr[p].rc].val;\n\t}\n\tvoid update(int &p,int l,int r,int pos,int val){\n\t\tif(!p) p=++cntt;\n\t\tif(l==pos&&r==pos){\n\t\t\ttr[p].val=val;\n\t\t\treturn;\n\t\t}\n\t\tint mid=(l+r)>>1;\n\t\tif(pos<=mid) update(tr[p].lc,l,mid,pos,val);\n\t\tif(pos>mid)  update(tr[p].rc,mid+1,r,pos,val);\n\t\tpushup(p);\n\t\t\n\t\tif(!tr[p].val) p=0;\n\t}\n\tint query(int p,int L,int R,int l,int r){\n\t\tif(!p) return 0;\n\t\tif(L<=l&&r<=R) return tr[p].val;\n\t\tint mid=(l+r)>>1,ans=0;\n\t\tif(L<=mid) ans+=query(tr[p].lc,L,R,l,mid);\n\t\tif(R>mid)  ans+=query(tr[p].rc,L,R,mid+1,r);\n\t\treturn ans;\n\t}\n}\nusing namespace SegmentTree;\n\nint n,m,w[M];\nint dis[N];\nvoid dfs(int u,int f){\n\tfor(int i=head[u];~i;i=edge[i].next){\n\t\tint v=edge[i].to;\n\t\tif(v!=f){\n\t\t\tdis[v]=dis[u]^w[v];\n\t\t\tdfs(v,u);\n\t\t}\n\t}\n}\n\nint LCA(int u,int v){\n\twhile(top[u]!=top[v]){\n\t\tif(dep[top[u]]<dep[top[v]]) swap(u,v);\n\t\tu=fa[top[u]];\n\t}\n\tif(dep[u]>dep[v]) return v;\n\telse return u;\n}\n\nbool query_path(int u,int v,int val){\n\twhile(top[u]!=top[v]){\n\t\tif(dep[top[u]]<dep[top[v]]) swap(u,v);\n\t\tif(query(rt[val],id[top[u]],id[u],1,n)) return true;\n\t\tu=fa[top[u]];\n\t}\n\tif(id[u]>id[v]) swap(u,v);\n\tif(query(rt[val],id[u],id[v],1,n)) return true;\n\telse return false;\n}\n\nint main(){\n\tmemset(head,-1,sizeof head);\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&w[i]);\n\tfor(int i=1,u,v;i<n;i++){\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tadd(u,v),add(v,u);\n\t}\n\tdfs(1,0),dfs1(1,0),dfs2(1,1);\n\tfor(int i=1;i<=n;i++) update(rt[w[i]],1,n,id[i],1);\n\t\n\twhile(m--){\n\t\tint a,b,k;\n\t\tscanf(\"%d%d%d\",&a,&b,&k);\n\t\tint lca=LCA(a,b);\n\t\tint res=dis[a]^dis[b]^w[lca]^k;\n\t\tif(res>1e7){\n\t\t\tprintf(\"No\\n\");\n\t\t\tcontinue;\n\t\t}\n\t\tif(query_path(a,b,res)) printf(\"Yes\\n\");\n\t\telse printf(\"No\\n\");\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1648006201,
        "uid": 469066,
        "name": "zzxLLL",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P8201 \u751f\u6d3b\u5728\u6811\u4e0a\uff08hard version\uff09"
    },
    {
        "content": "- **\u524d\u8a00** \uff1a \u751f\u6d3b\u5728\u6811\u4e0a\u2014\u2014\u59cb\u7ec8\u70ed\u7231\u5927\u5730\u2014\u2014\u5347\u4e0a\u5929\u7a7a\u3002 \n\n\n- **\u9898\u76ee** : [\u751f\u6d3b\u5728\u6811\u4e0a\uff08hard version)](https://www.luogu.com.cn/problem/P8201)\n\n- **\u5927\u81f4\u9898\u610f** \uff1a\n\t\n   \u7ed9\u51fa\u4e00\u9897 $n$ \u4e2a\u8282\u70b9\u7684\u6811\uff0c \u6bcf\u4e2a\u70b9 $u$ \u6709\u6743\u503c $w_u$ , \u6709 $m$ \u4e2a\u8be2\u95ee\uff0c \u6c42\u4e24\u4e2a\u8282\u70b9 $u, v$ \u4e4b\u95f4\u7684\u8def\u5f84\u4e0a\u662f\u5426\u6709\u4e00\u4e2a\u70b9 $t$ \u6ee1\u8db3\u6240\u6709 \u8def\u5f84 $(u, t)$, $(v, t)$ \u6240\u7ecf\u8fc7\u7684\u6240\u6709\u7ed3\u70b9\u6743\u503c\u5f02\u6216\u548c\u4e3a $k$ \u3002\n   \n   \u5176\u4e2d $n \\leq 10^5, m \\leq10^5,w_i \\leq10^7$\u3002\n   \n- **\u601d\u8def** \uff1a\n\t\n\t\u8003\u8651\u8bb0\u5f55 $dist_u$ \u4e3a\u6839\u8282\u70b9\u5230 $u$ \u7684\u7ed3\u70b9\u6743\u503c\u5f02\u6216\u548c\uff0c \u7136\u540e\u53ef\u4ee5\u5957\u8def\u5730\u8f6c\u5316\u4e3a\u6c42\u8def\u5f84 $(u,v)$ \u4e0a\u6709\u6ca1\u6709\u70b9 $t$ \u5176\u6743\u503c\u4e3a $k \\oplus dist_u \\oplus dist_v \\oplus w_{lca(u, v)} = w_t$ \u3002\n   \n\t\u7136\u540e\u6211\u4eec\u53d1\u73b0\u8def\u5f84\u4e5f\u662f\u53ef\u4ee5\u6811\u4e0a\u5dee\u5206\uff0c \u62c6\u51fa\u6765 $u, v, lca(u, v), fa_{lca(u, v)}$ \u5230\u6839\u8282\u70b9\u7684\u8def\u5f84\uff0c \u7136\u540e\u5f00\u4e00\u4e2a\u6876\u53bb\u8ba1\u6570\u5373\u53ef\uff0c \u7ed3\u5408\u500d\u589e\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log_2 n)$ \u5176\u65f6\u95f4\u590d\u6742\u5ea6\u74f6\u9888\u5728\u4e8e\u6c42\u6700\u8fd1\u516c\u5171\u7956\u5148\u3002\n  \n- [**\u4ee3\u7801**](https://www.luogu.com.cn/paste/wr8dyuct) ",
        "postTime": 1650014398,
        "uid": 340589,
        "name": "LucisonCats",
        "ccfLevel": 0,
        "title": "\u3010\u6811\u4e0a\u5dee\u5206\u3011P8201 \u751f\u6d3b\u5728\u6811\u4e0a\uff08hard version\uff09"
    },
    {
        "content": "\u8fd9\u662f\u4e00\u7bc7\u5927\u91cf\u5229\u7528 STL \u7684\u9898\u89e3\u3002\n\n## 1\u3001\u9898\u610f\u8f6c\u5316\n\n\u539f\u9898\u8bf4\u4e86\u975e\u5e38\u591a\u7684\u8def\u5f84\u8d39\u7528\u5b9a\u4e49\uff0c\u4e0d\u59a8\u76f4\u63a5\u753b\u56fe\u6765\u7814\u7a76\u4e00\u4e0b\uff1a\n\n![666](https://cdn.luogu.com.cn/upload/image_hosting/ojhuv5aw.png)\n\n\u624b\u6478\u4e00\u4e0b\u53ef\u4ee5\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4e0a\u56fe\u4e2d $t_1$\u3001$t_2$\u3001$t_3$\u3001$t_4$\u56db\u4e2a\u70b9\uff0c\u6240\u8c13\u7684 $dis_{t,a}$ \u4e0e $dis_{t,b}$ \u7684\u5f02\u6216\u503c\uff0c\u4e0d\u6b63\u662f\u5728 $a$ \u5230 $b$ \u7684\u8def\u5f84\u4e0a\u7684\u6316\u6389\u4e00\u4e2a\u70b9\u540e\u7684\u6240\u6709\u70b9\u6743\u7684\u603b\u5f02\u6216\u548c\u5417\uff1f\u4ee5 $t_1$ \u4e3a\u4f8b\u5b50\uff0c\u5176\u5230 $a$ \u4e0e $b$ \u7684\u6700\u8fd1\u516c\u5171\u7956\u5148 $t_4$ \u7684\u8fd9\u6bb5\u8def\uff0c\u5728\u603b\u7b54\u6848\u7684\u5f02\u6216\u548c\u4e2d\uff0c\u5176\u5b9e\u662f\u88ab\u5f02\u6216\u4e86\u4e24\u6b21\uff0c\u5373\u6d88\u53bb\u4e86\u3002\uff08\u4e0d\u4e86\u89e3\u5f02\u6216\u6027\u8d28\u7684\u53ef\u81ea\u884c\u767e\u5ea6\uff09\u3002\n\n\u90a3\u4e48\uff0c\u539f\u95ee\u9898\u5176\u5b9e\u53ef\u4ee5\u8f6c\u5316\u4e3a\uff1a**\u8be2\u95ee\u6811\u4e0a\u7684\u4e00\u5bf9\u70b9\uff0c\u5c06\u5176\u7b80\u5355\u8def\u5f84\u4e0a\u6316\u53bb\u4e00\u4e2a\u70b9\uff08\u5305\u62ec\u7aef\u70b9\uff09\u7684\u503c\uff0c\u95ee\u662f\u5426\u53ef\u4ee5\u4f7f\u5176\u603b\u5f02\u6216\u548c\u4e3a $k$\u3002**\n\n\u5982\u679c\u4e00\u4e2a\u4e2a\u66b4\u529b\u5220\u9664\u8def\u5f84\u4e0a\u7684\u70b9\uff0c\u663e\u7136\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u4e0d\u53ef\u80fd\u8fc7\u5f97\u53bb\u7684\u3002\u6b63\u96be\u5219\u53cd\uff0c\u4e0d\u59a8\u5982\u6b64\u8003\u8651\uff1a\u8def\u5f84\u603b\u5f02\u6216\u548c $tot$ \u548c\u76ee\u6807 $k$ \u5176\u5b9e\u662f\u786e\u5b9a\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u6c42\u51fa\u76ee\u6807\u5220\u9664\u503c\u4e3a $d = tot \u2a01 k$\u3002\n\n\u73b0\u5728\uff0c\u95ee\u9898\u5c31\u8f6c\u5316\u4e86\u4e3a**\u6c42\u4e00\u6bb5\u8def\u5f84\u4e0a\u662f\u5426\u6709\u6743\u503c\u4e3a $d$ \u7684\u70b9\u3002**\n\n## 2\u3001\u5b9e\u73b0\n\n\u5bf9\u4e8e\u8def\u5f84\u603b\u5f02\u6216\u548c\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u6811\u94fe\u5256\u5206\u4e0e\u524d\u7f00\u548c\uff08\u6216\u7ebf\u6bb5\u6811\uff09\u89e3\u51b3\u3002\u5982\u4f55\u67e5\u8be2\u662f\u5426\u5b58\u5728\u6743\u503c $d$ \u6210\u4e3a\u4e3b\u8981\u95ee\u9898\u3002\n\n\u4e0d\u59a8\u8003\u8651\u6811\u94fe\u5256\u5206\u7684\u5b9e\u73b0\u8fc7\u7a0b\uff1a\u6bcf\u6b21\u9009\u4e2d\u4e00\u6761\u94fe\uff0c\u5c06\u5f53\u524d\u70b9\u8df3\u5230\u94fe\u9876\uff0c\u4ee5\u6b64\u5f80\u590d\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e00\u6761\u94fe\u4e2d\u7684\u70b9\u7684 dfn \u5e8f\u662f\u8fde\u7eed\u7684\u3002\u90a3\u8fd9\u5c31\u7ed9\u4e86\u6211\u4eec\u4e00\u4e2a\u601d\u8def\u3002\n\n\u9996\u5148\uff0c\u4f7f\u7528 map \u5bf9\u6240\u6709\u6743\u503c\u79bb\u6563\u5316\u3002\u7136\u540e\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u6743\u503c\uff0c\u7528 multiset \u7ef4\u62a4\u5176\u5bf9\u5e94\u7684\u6240\u6709\u70b9\u7684 dfn \u5e8f\uff0c\u4ee5\u6b64\u5b58\u50a8\u6240\u6709\u6743\u503c\u6240\u51fa\u73b0\u5728\u7684\u4f4d\u7f6e\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u597d\u529e\u4e86\u3002\u5728\u6811\u94fe\u5256\u5206\u4e0a\u8df3\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u76ee\u6807\u6743\u503c\u7684 multiset \u8fdb\u884c\u4e8c\u5206\u67e5\u627e\uff0c\u5224\u65ad\u662f\u5426\u6709\u5bf9\u5e94\u7684\u70b9\u5b58\u5728\u5f53\u524d\u8fd9\u6761\u94fe\u4e0a\u5373\u53ef\u3002\n\n## 3\u3001\u6ce8\u610f\u4e8b\u9879\n\n- \u6ce8\u610f $LCA(a,b)$ \u7684\u6743\u503c\u5176\u5b9e\u88ab\u8ba1\u7b97\u4e86\u4e24\u6b21\uff0c\u8981\u5c06\u5176\u8865\u56de\u6765\u3002\n- \u5bf9 multiset \u548c set \u4f7f\u7528 lower_bound \u6216 upper_bound \u51fd\u6570\u65f6\uff0c\u56e0\u4f7f\u7528\u5176\u81ea\u5e26\u7684\u90a3\u79cd\uff0c\u4e0d\u80fd\u4f7f\u7528\u5934\u6587\u4ef6\u4e2d\u7684\u901a\u7528\u51fd\u6570\uff0c\u5426\u5219\u65f6\u95f4\u590d\u6742\u5ea6\u4f1a\u9000\u5316\u6210 $O(N)$\u3002\n- \u5728\u6811\u94fe\u5256\u5206\u4e0a\u8df3\u4e4b\u524d\u76f4\u63a5\u6c42\u51fa\u76ee\u6807\u503c $d$ \u7684\u5bf9\u5e94\u79bb\u6563\u5316\u7f16\u53f7\uff0c\u800c\u4e0d\u662f\u8fb9\u8df3\u8fb9\u6c42\u3002\u5426\u5219\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u4f1a\u9000\u5316\uff0c\u6709\u53ef\u80fd\u5bfc\u81f4\u8d85\u65f6\u3002\n\n\n\u4e0a\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define N 1000010\n#define ll long long\n\ntemplate <class T>\ninline void read(T& a){\n\tT x = 0, s = 1;\n\tchar c = getchar();\n\twhile(!isdigit(c)){ if(c == '-') s = -1; c = getchar(); }\n\twhile(isdigit(c)){ x = x * 10 + (c ^ '0'); c = getchar(); }\n\ta = x * s;\n\treturn ;\n}\n\nstruct node{\n  int u, v;\n  ll w; \n  int next; \n} t[N << 1];\nint head[N];\n\nint bian = 0;\ninline void addedge(int u, int v, ll w){  // \u53cc\u5411\u8fb9\n  t[++bian] = (node){u, v, w, head[u]}, head[u] = bian;\n  t[++bian] = (node){v, u, w, head[v]}, head[v] = bian; \n  return ; \n}\n\nint n, Q; \nmultiset <int> G[N]; \nll a[N]; \n\nint dfn[N], top[N], son[N], siz[N], deth[N]; \nint fa[N], id = 0, rev[N];\n\nll sum[N];   // \u6811\u4e0a\u524d\u7f00\u548c\u6570\u7ec4\n\nvoid dfs1(int u, int father){\n  deth[u] = deth[father] + 1; \n  siz[u] = 1; \n  fa[u] = father; \n  sum[u] = a[u] ^ sum[father]; \n  int maxn = -1e9; \n  for(int i = head[u]; i; i = t[i].next){\n    int v = t[i].v; \n    if(v != father){\n      dfs1(v, u); \n      siz[u] += siz[v]; \n      if(siz[v] > maxn){\n        maxn = siz[v];\n        son[u] = v; \n      }\n    }\n  }\n  return ; \n}\n\nvoid dfs2(int u, int tp){\n  top[u] = tp; \n  dfn[u] = ++id; \n  rev[id] = u; \n  if(!son[u]) return ;\n  dfs2(son[u], tp);\n  for(int i = head[u]; i; i = t[i].next){\n    int v = t[i].v;\n    if(v != fa[u] && v != son[u])\n      dfs2(v, v); \n  }\n  return ; \n}\n\nint LCA(int x, int y){   // \u6c42 LCA\n  while(top[x] != top[y]){\n    if(deth[top[x]] < deth[top[y]]) swap(x, y);\n    x = fa[top[x]]; \n  }\n  return deth[x] < deth[y] ? x : y; \n}\n\nint check(int x, int y, int d){  // \u68c0\u67e5\u503c\n  while(top[x] != top[y]){\n    if(deth[top[x]] < deth[top[y]]) swap(x, y); \n    auto l = G[d].lower_bound(dfn[top[x]]); \n    auto r = G[d].upper_bound(dfn[x]); \n    if(l != r) return 1; \n    x = fa[top[x]]; \n  }\n  if(deth[x] < deth[y]) swap(x, y); \n  auto r = G[d].upper_bound(dfn[x]); \n  auto l = G[d].lower_bound(dfn[y]);\n  if(l != r) return 1;\n  return 0; \n}\n\nint hehe = 0; \nmap <int, int> g; \n\nint main(){\n  // freopen(\"hh.txt\", \"r\", stdin); \n  read(n), read(Q);\n  for(int i = 1; i <= n; i++){\n    read(a[i]);\n    if(!g.count(a[i])) g[a[i]] = ++hehe;    // \u79bb\u6563\u5316\n  } \n  for(int i = 1; i < n; i++){\n    int x, y;\n    read(x), read(y);\n    addedge(x, y, 0); \n  }\n  dfs1(1, 0);\n  dfs2(1, 1); \n\n  for(int i = 1; i <= n; i++){\n    G[g[a[i]]].insert(dfn[i]);      // \u63d2\u5165\u70b9\u7684\u503c\n  }\n  while(Q--){\n    ll x, y, k;\n    read(x), read(y); read(k); \n    ll ans = sum[x] ^ sum[y];\n    int lca = LCA(x, y); \n    ans ^= a[lca]; \n    ll d = ans ^ k;  // d: \u9700\u8981\u5bfb\u627e\u7684\u503c\n    d = g[d];    // \u63d0\u524d\u627e\u597d\u7f16\u53f7\n    if(check(x, y, d)) puts(\"Yes\");\n    else puts(\"No\"); \n  }\n  return 0;\n}\n\n```\n",
        "postTime": 1666427106,
        "uid": 234224,
        "name": "\u9752\u9e1f_Blue_Bird",
        "ccfLevel": 5,
        "title": "P8201 \u751f\u6d3b\u5728\u6811\u4e0a\uff08hard version\uff09"
    },
    {
        "content": "## \u6811\u5256+\u54c8\u5e0c\u8868+STL \u5e73\u8861\u6811\r\n\r\n\u6211\u76f8\u5bf9\u8f83\u900a\uff0c\u6211\u5728\u505a\u4e86[\u8fd9\u9898\u7684\u7b80\u5355\u7248\u672c\u540e](https://www.luogu.com.cn/problem/P8200)\u5c31\u4e0d\u60f3\u518d\u52a8\u4ee3\u7801\u4e86\uff09\uff09\u3002\r\n\r\n\u4e8e\u662f\u89c2\u5bdf\u9898\u76ee\uff0c\u53d1\u73b0\u8fd9\u9898\u662f\u6c42\u70b9\u6743\u5f02\u6216\u548c\u800c\u4e0d\u662f\u8fb9\u6743\u3002\r\n\r\n\u6211\u4eec\u77e5\u9053\u6839\u636e\u6309\u4f4d\u5f02\u6216\u7684\u6027\u8d28\uff1a\u6709 $ a \\oplus b \\oplus b = a $\uff0c\u5373\u5982\u679c\u4e00\u4e2a\u8282\u70b9\u88ab\u8ba1\u7b97\u4e86\u4e24\u6b21\uff0c\u90a3\u4e48\u5c31\u5bf9\u7b54\u6848\u6ca1\u6709\u8d21\u732e\u3002\r\n\r\n\u53ef\u4ee5\u53d1\u73b0\u5982\u679c\u8be2\u95ee\u70b9 $a,b$ \u548c\u503c $k$\uff0c\u6211\u4eec\u5728\u8ba1\u7b97\u4efb\u610f\u70b9 $t$ \u7684 $\\mathrm{dis}_{t, a} \\oplus \\mathrm{dis}_{t, b}$ \u7684\u8def\u5f84\u5f02\u6216\u548c\u65f6\uff0c\u90e8\u5206\u91cd\u590d\u7684\u8282\u70b9\u7684\u6743\u503c\u4f1a\u88ab\u6d88\u9664\u6389\u3002\r\n\r\n\u5982\u679c\u8bb0 $s$ \u4e3a $\\mathrm{dis}_{a, b} \\oplus k$\uff0c**\u90a3\u4e48\u95ee\u9898\u8f6c\u6362\u4e3a**\uff1a\u8be2\u95ee\u6811\u4e0a\u4ece $u$ \u5230 $v$ \u7684\u7b80\u5355\u8def\u5f84\u4e2d\uff0c\u662f\u5426\u5b58\u5728\u70b9 $t$ \u6743\u503c\u4e3a $s$\u3002\r\n\r\n\u53ef\u4ee5\u7528\u6811\u5256\u5c06\u6811\u5256\u6210\u94fe\uff0c\u8f6c\u6362\u4e3a\u533a\u95f4\u6c42\u5f02\u6216\u548c\u4ee5\u53ca\u533a\u95f4\u67e5\u8be2\u95ee\u9898\uff1a\r\n\r\n\u7ed9\u5b9a\u5e8f\u5217 $a$ \u8be2\u95ee $[a_l, a_r]$ \u4e2d\u662f\u5426\u5b58\u5728\u6570\u5b57 $s$\u3002\r\n\r\n**\u5947\u5999\u60f3\u6cd5**\uff1a\u7528\u54c8\u5e0c\u8868\u79bb\u6563\u5316\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u503c\u5efa\u4e00\u68f5\u5e73\u8861\u6811\uff0c\u8ba1\u5165\u6240\u6709\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u5bf9\u4e8e\u8be2\u95ee $l,r$ \u67e5\u627e\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e $l$ \u7684\u5143\u7d20\u662f\u5426\u5c0f\u4e8e\u7b49\u4e8e $r$\uff0c\u5982\u679c\u5b58\u5728\u8fd9\u6837\u7684\u5143\u7d20\u5c31\u53ef\u4ee5\u76f4\u63a5\u8f93\u51fa `YES` \u4e86\u3002\r\n\r\n\u5145\u5206\u5229\u7528STL\u6570\u636e\u7ed3\u6784\uff0c\u8fd0\u7528 ```unordered_map``` \u5957 ``` set``` \u5b9e\u73b0\u4ee3\u7801\u3002\r\n\r\n\r\n\u65f6\u95f4\u590d\u6742\u5ea6 $ \\mathcal{O}(m \\cdot \\log^2 n) $ \u6bd4\u8f83\u52a3\uff0c\u4f46\u80fd\u8fc7\u3002\r\n\r\n\u5e38\u6570\u5927\uff0c\u9002\u5408\u5438\u6c27\uff0c\u8bb0\u5f97\u5728 ```set``` \u4e2d\u9884\u5148\u63d2\u5165\u6b63\u8d1f\u65e0\u7a77\u3002\r\n\r\n\r\n\r\n## \u4ee3\u7801\r\n\r\n\uff08\u5176\u5b9e\u94fe\u5f02\u6216\u548c\u6811\u4e0a\u5dee\u5206\u5c31\u53ef\u4ee5\u6c42\u4e86\uff0c\u6211\u4e4b\u524d\u5199\u4e86\u6811\u5256\u61d2\u5f97\u6539\uff09\u3002\r\n\r\n```\r\n#include <bits/stdc++.h>\r\nusing std::swap;\r\ntypedef long long ll;\r\nconst int N=5e5+15,inf=0x3f3f3f3f;\r\nint head[N],tt,n,q;\r\nint a[N],sum[N];\r\n\r\nstd::map<int,std::set<int> >num;\r\n\r\nstruct edge{int to,fr,nxt;}ed[N<<1];\r\ninline void added(int u,int v){\r\n\ted[++tt].to=v,ed[tt].fr=u,ed[tt].nxt=head[u],head[u]=tt;\r\n}\r\n\r\nint fa[N],son[N],dep[N],top[N],sze[N],seg[N];\r\n\r\nvoid dfs1(int u,int f){\r\n\tfa[u]=f,dep[u]=dep[f]+1,sze[u]=1;\r\n\tfor(int i=head[u],v;i;i=ed[i].nxt){\r\n\t\tv=ed[i].to;if(v==f) continue;\r\n\t\tdfs1(v,u),sze[u]+=sze[v];\r\n\t\tif(sze[v]>sze[son[u]]) son[u]=v;\r\n\t}\r\n}\r\n\r\nvoid dfs2(int u){\r\n\tif(son[u]){\r\n\t\tseg[son[u]]=++seg[0],top[son[u]]=top[u];\r\n\t\tdfs2(son[u]);\r\n\t}\r\n\tfor(int i=head[u],v;i;i=ed[i].nxt){\r\n\t\tv=ed[i].to;if(seg[v]) continue;\r\n\t\tseg[v]=++seg[0],top[v]=v;\r\n\t\tdfs2(v);\r\n\t}\r\n}\r\n\r\n#define lb (x&-x)\r\ninline void add(int x,int v){\r\n\tfor(;x<=n;x+=lb) sum[x]^=v;\r\n}\r\ninline int ques(int x){int r=0;for(;x;x-=lb) r^=sum[x];return r;}\r\ninline int query(int x,int y){return ques(y)^(x-1>0 ? ques(x-1) : 0);}\r\n\r\ninline bool qnum(int l,int r,int v){\r\n\tif(num[v].empty()) return 0;\r\n\treturn (*num[v].lower_bound(l))<=r;  // \u975e\u5e38\u7684\uff08\u975e\u5e38\uff09\r\n}\r\n\r\ninline int chainq1(int x,int y){\r\n\tint res=0;\r\n\tint fx=top[x],fy=top[y];\r\n\twhile(fx!=fy){\r\n\t\tif(dep[fx]<dep[fy]) swap(x,y),swap(fx,fy);\r\n\t\tres^=query(seg[fx],seg[x]);\r\n\t\tx=fa[fx],fx=top[x];\r\n\t}\r\n\tif(dep[x]>dep[y]) swap(x,y);\r\n\tres^=query(seg[x],seg[y]);\r\n\treturn res;\r\n}\r\n\r\ninline bool chainq2(int x,int y,int v){\r\n\tint res=0;\r\n\tint fx=top[x],fy=top[y];\r\n\twhile(fx!=fy){\r\n\t\tif(dep[fx]<dep[fy]) swap(x,y),swap(fx,fy);\r\n\t\tif(qnum(seg[fx],seg[x],v)) return 1;\r\n\t\tx=fa[fx],fx=top[x];\r\n\t}\r\n\tif(dep[x]>dep[y]) swap(x,y);\r\n\treturn qnum(seg[x],seg[y],v);\r\n}\r\n\r\nint main(){\r\n\tscanf(\"%d%d\",&n,&q);\r\n\tfor(int i=1;i<=n;++i) scanf(\"%d\",&a[i]);\r\n\tfor(int i=1,u,v;i<n;++i){\r\n\t\tscanf(\"%d%d\",&u,&v),added(u,v),added(v,u);\r\n\t}\r\n\tdep[1]=1,dfs1(1,0);\r\n\tseg[0]=seg[1]=1,top[1]=1,dfs2(1);\r\n\tfor(int i=1;i<=n;++i) add(seg[i],a[i]),num[a[i]].insert(seg[i]),num[a[i]].insert(inf),num[a[i]].insert(-inf);\r\n\twhile(q--){\r\n\t\tint a,b,k;\r\n\t\tscanf(\"%d%d%d\",&a,&b,&k);\r\n\t\t//printf(\"q1:%d\\n\",chainq1(a,b));\r\n\t\tk^=chainq1(a,b);\r\n\t\tputs(chainq2(a,b,k) ? \"YES\" : \"NO\");\r\n\t}   \r\n\r\n\treturn 0;\r\n}\r\n```\r\n",
        "postTime": 1666099918,
        "uid": 411778,
        "name": "aleksey_RoFtaCD",
        "ccfLevel": 0,
        "title": "P8201 \u751f\u6d3b\u5728\u6811\u4e0a\uff08hard version\uff09\u9898\u89e3"
    },
    {
        "content": "\u8fd9\u8fb9\u662f\u9a8c\u9898\u4eba\u7684 $\\mathcal{O}(n \\log n)$ \u7684\u500d\u589e LCA \u505a\u6cd5\uff0c\u9020\u6570\u636e\u7684\u65f6\u5019\u53ea\u8bb0\u5f97\u5361\u66b4\u529b\u4e86\uff0c\u4e8e\u662f\u6709\u4e86\u51e0\u7ec4\u94fe\u7684\u6570\u636e\uff0c\u5e76\u4e14\u6709 $\\dfrac 78$ \u7684\u67e5\u8be2\u5747\u4e3a $1\\sim n$\uff0c\u7ed3\u679c\u5fd8\u4e86 $\\mathcal{O}(n\\log^2n)$ \u7684\u6811\u5256\uff0c\u7ed3\u679c\u73b0\u5728\u770b\u8d77\u6765\u6ca1\u5361\u6811\u5256\u662f\u6b63\u786e\u7684\uff08\uff1f\n\n\u9898\u610f\u8f6c\u5316\u548c\u5f0f\u5b50\u8f6c\u5316\u6b64\u5904\u7565\u53bb\u3002\n\n\u5c0f\u58f0\u8bf4\u4e00\u4e0b\u94fe\u5957\u83ca\u82b1\u662f\u53ef\u4ee5\u5361\u6811\u5256\u7684 \u5982\u679c\u6709\u4eba\u611f\u5174\u8da3\u7684\u8bdd\u53ef\u4ee5\u627e\u6211\u6216\u8005@\u4e00\u6276\u82cf\u4e00\u63d0\u4f9b hack \u6570\u636e\uff08\n\n```cpp\n#include<bits/stdc++.h>\n#define ioclear std::ios::sync_with_stdio(false);std::cin.tie(nullptr);std::cout.tie(nullptr);\n#define endl '\\n'\n\nconst int mmax = 5e5 + 10;\nconst int maxw = 1e7 + 10;\nconst int inf = 1e7;\nusing i64 = unsigned long long;\n\nint n, m, u[mmax], v[mmax], zx[mmax][30], dep[mmax], fl[mmax];\ni64 a[mmax], Xor[mmax], k[mmax];\nstd::vector<int> edge[mmax];\nstd::vector<int> qry[mmax];\nstd::unordered_map<int, int> tong, Ans[mmax];\n\nvoid dfs1(int cur, int fa)\n{\n\tXor[cur] = Xor[fa] ^ a[cur];\n\tdep[cur] = dep[fa] + 1;\n\tzx[cur][0] = fa;\n\tfor(int i = 1;(1 << i) <= dep[cur];i++)\n\t\tzx[cur][i] = zx[zx[cur][i-1]][i-1];\n\tfor(auto v : edge[cur])\n\t\tif(v != fa)\n\t\t\tdfs1(v, cur);\n\treturn;\n}\n\nint lca(int x, int y)\n{\n\tif(dep[x] < dep[y]) std::swap(x, y);\n\tfor(int i = 19;i >= 0;i--)\n\t\tif(dep[x] - (1 << i) >= dep[y]) x = zx[x][i];\n\tif(x == y) return x;\n\tfor(int i = 19;i >= 0;i--)\n\t\tif(zx[x][i] != zx[y][i]) x = zx[x][i], y = zx[y][i];\n\treturn zx[x][0];\n}\n\nvoid dfs2(int cur, int fa)\n{\n\ttong[a[cur]]++;\n\tfor(auto v : qry[cur])\n\t\tAns[cur][v] = tong[v];\n\tfor(auto v : edge[cur])\n\t\tif(v != fa)\n\t\t\tdfs2(v, cur);\n\ttong[a[cur]]--;\n\treturn;\n}\n\nint main()\n{\n\tioclear;\n\tstd::cin >> n >> m;\n\tfor(int i = 1;i <= n;i++)\n\t\tstd::cin >> a[i];\n\tfor(int i = 1;i < n;i++)\n\t{\n\t\tint x, y;\n\t\tstd::cin >> x >> y;\n\t\tedge[x].push_back(y);\n\t\tedge[y].push_back(x);\n\t}\n\tdfs1(1, 0);\n\tfor(int i = 1;i <= m;i++)\n\t{\n\t\tstd::cin >> u[i] >> v[i] >> k[i];\n\t\tfl[i] = lca(u[i], v[i]);\n\t\ti64 t = k[i] ^ Xor[u[i]] ^ Xor[v[i]] ^ a[fl[i]];\n\t\tif(t > inf) continue;\n\t\tqry[u[i]].push_back(t);\n\t\tqry[v[i]].push_back(t);\n\t\tqry[fl[i]].push_back(t);\n\t\tqry[zx[fl[i]][0]].push_back(t);\n\t}\n\tdfs2(1, 0);\n\tfor(int i = 1;i <= m;i++)\n\t{\n\t\ti64 t = k[i] ^ Xor[u[i]] ^ Xor[v[i]] ^ a[fl[i]];\n\t\tif(Ans[u[i]][t] + Ans[v[i]][t] - Ans[fl[i]][t] - Ans[zx[fl[i]][0]][t])\n\t\t\tputs(\"Yes\");\n\t\telse\n\t\t\tputs(\"No\");\n\t}\n}\n```\n",
        "postTime": 1647097092,
        "uid": 26538,
        "name": "Dusker",
        "ccfLevel": 4,
        "title": "P8201"
    }
]