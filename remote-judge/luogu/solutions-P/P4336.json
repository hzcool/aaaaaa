[
    {
        "content": "\u6709\u90a3\u4e48\u4e00\u53e5\u8bdd\u53eb\u770b\u5230\u8ba1\u6570\u60f3\u5bb9\u65a5\uff1f\n\n~~(\u4e3a\u4ec0\u4e48\u4f60\u4f1a\u8fd9\u4e48\u719f\u7ec3\u554a\uff01\u4f60\u5230\u5e95\u5207\u8fc7\u591a\u5c11\u9053\u5bb9\u65a5\u9898\u4e86\u554a\uff01\uff1f)~~\n\n\u4f46\u662f\u5bb9\u65a5\u539f\u7406\u8fd9\u4e2a\u4e1c\u897f\u8fd8\u662f\u76f8\u5f53\u5957\u8def\u7684\uff0c\u60f3\u4e0d\u5230\u5c31\u60f3\u4e0d\u5230\u4e86\uff0c\u4f46\u662f\u719f\u7ec3\u4e4b\u540e\u4f1a\u5207\u7684\u5f88\u5feb~\n\n\u76f8\u4f3c\u9898\u76ee\u53ef\u4ee5\u53bb\u505a\u4e00\u505aP3349\\[ZJOI2016]\u5c0f\u661f\u661f\u548c\u8fd9\u9053\u9898\u5f88\u50cf\n\n\u4f46\u662f\u8fd9\u9053\u9898\u4e0d\u662f\u7eaf\u5bb9\u65a5\uff0c\u8fd8\u662f\u8981\u52a0\u4e00\u4e9b\u522b\u7684\u4e1c\u897f\u7684\n\n## \u524d\u7f6e\u829d\u58eb\uff1a\u77e9\u9635\u6811\u5b9a\u7406\n\n~~(\u53ea\u7ba1\u778e\u8bb2\u53e3\u80e1\u4e0d\u7ba1\u8bc1\u660e\uff0c\u5404\u4f4ddalao\u4eec\u8f7b\u62cd)~~\n\n### \u524d\u7f6e\u829d\u58eb\u7684\u524d\u7f6e\u829d\u58eb\uff1a\u884c\u5217\u5f0f\n\n(\u6b63\u5f0f\u7684\u5b9a\u4e49\u9700\u8981\u5b66\u4e60\u6392\u5217\u548c\u9006\u5e8f\u7684\u76f8\u5173\u77e5\u8bc6\uff0c\u8fd9\u91cc\u6211\u4eec\u76f4\u63a5\u8bb2\u8ba1\u7b97\u4e0a\u7684\u5b9a\u4e49)\n\n\u7136\u540e\u6211\u4eec\u6784\u9020\u7684\u5b9a\u4e49\u4e00\u4e2a\u65b9\u9635\u7684\u884c\u5217\u5f0f\uff0c\u884c\u5217\u5f0f\u662f\u4e00\u4e2a\u6570\u3002\n\n**\u4e00\u4e2a\u4e0a\u4e09\u89d2\u65b9\u9635/\u4e0b\u4e09\u89d2\u65b9\u9635(\u5c31\u662f\u6709\u4e00\u534a\u5168\u662f0\u7684\u77e9\u9635)\u7684\u884c\u5217\u5f0f\u662f\u5176\u5bf9\u89d2\u7ebf\u4e4b\u79ef**\n\n(\u7279\u6b8a\u7684\uff0c\u5355\u4f4d\u65b9\u9635\u884c\u5217\u5f0f\u662f1)\n\n**\u5bf9\u4e8e\u4e00\u65b9\u9635\u5176\u4e00\u884c/\u4e00\u5217\u4e58\u4ee5k\uff0c\u884c\u5217\u5f0f\u4e58k**\n\n**\u5bf9\u4e8e\u4e00\u65b9\u9635\u5176\u4e24\u884c\u76f8\u52a0\u51cf\uff0c\u884c\u5217\u5f0f\u4e0d\u53d8**\n\n**\u5bf9\u4e8e\u4e00\u4e2a\u77e9\u9635\u4ea4\u6362\u5176\u4e24\u884c/\u4e24\u5217\uff0c\u884c\u5217\u5f0f\u53cd\u53f7**\n\n(\u63a8\u8bba\uff0c\u4e00\u4e2a\u77e9\u9635\u4e24\u884c/\u4e24\u5217\u6210\u6bd4\u4f8b\u884c\u5217\u5f0f\u4e3a0)\n\n\u597d\u4e86\u90a3\u4e48\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u53ef\u4ee5\u4ece\u4e00\u4e2an\u9636\u5355\u4f4d\u65b9\u9635\u5f00\u59cb\uff0c\u4ec5\u51ed\u501f\u4ea4\u6362\u884c/\u5217\uff0c\u4e00\u884c/\u4e00\u5217\u4e58k\uff0c\u884c/\u5217\u76f8\u52a0\u51cf\u8fd93\u4e2a\u64cd\u4f5c\u53ef\u4ee5\u6784\u9020\u51fa\u6240\u6709\u7684\u65b9\u9635\uff0c\u56e0\u6b64\u6bcf\u4e2a\u65b9\u9635\u90fd\u662f\u6709\u884c\u5217\u5f0f\u7684\n\n\u90a3\u4e48\u6211\u4eec\u600e\u4e48\u8ba1\u7b97\u884c\u5217\u5f0f\u5462\uff1f\n\n\u6211\u4eec\u53d1\u73b0\u53ea\u9700\u8981\u7531\u5355\u4f4d\u77e9\u9635/\u4e09\u89d2\u77e9\u9635\u6784\u9020\u51fa\u6765\u8fd9\u4e2a\u77e9\u9635\u5c31\u884c\u4e86\u5bf9\u5427\n\n\u6211\u4eec\u53d1\u73b0\u6784\u9020\u7528\u76843\u79cd\u64cd\u4f5c(\u4ea4\u6362\uff0c\u52a0\u51cf\uff0c\u4e58\u9664)\uff0c\u521a\u597d\u662f\u9ad8\u65af\u524a\u5143\u7528\u76843\u79cd\u64cd\u4f5c\n\n\u6240\u4ee5\u6211\u4eec\u5bf9\u8fd9\u4e2a\u77e9\u9635\u505a\u4e00\u53d1\u9ad8\u65af\u524a\u5143\uff0c\u4f1a\u5f97\u5230\u4e00\u4e2a\u5355\u4f4d\u77e9\u9635/\u4e09\u89d2\u77e9\u9635\n\n\u7136\u540e\u6211\u4eec\u53ea\u9700\u8981\u5c06\u9ad8\u65af\u524a\u5143\u4e2d\u7684\u6bcf\u4e00\u6b65\u5012\u8fc7\u6765\u5c31\u53ef\u4ee5\u6784\u9020\u51fa\u539f\u77e9\u9635\u7136\u540e\u5c31\u53ef\u4ee5\n\u6c42\u51fa\u884c\u5217\u5f0f\u5566~\n\n\u5f53\u7136\u771f\u5b9e\u5199\u4ee3\u7801\u7684\u65f6\u5019\u5e76\u4e0d\u9700\u8981\u5012\u8fc7\u6765\uff0c\u53ea\u9700\u8981\u505a\u9ad8\u65af\u524a\u5143\u7684\u65f6\u5019\u4ea4\u6362\u5c31\u53cd\u53f7\uff0c\u4e58\u53d8\u9664\u9664\u53d8\u4e58\uff0c\u5c31\u53ef\u4ee5\u4e00\u904d\u9ad8\u65af\u524a\u5143\u4e00\u8fb9\u6c42\u884c\u5217\u5f0f\u4e86(\u5982\u679c\u4f60\u5199\u7684\u662f\u524a\u6210\u5355\u4f4d\u77e9\u9635\u7684\u9ad8\u65af\u524a\u5143\uff0c\u53ef\u4ee5\u628a\u884c\u5217\u5f0f\u7684\u521d\u503c\u76f4\u63a5\u8bbe\u62101)\n\n\u5f53\u7136\u6b64\u65f6\u53ef\u80fd\u4f1a\u53d1\u73b0\u6700\u540e\u6d88\u51fa\u6765\u7684\u77e9\u9635\u5bf9\u89d2\u7ebf\u67090\uff0c\u6211\u4eec\u6b64\u65f6\u76f4\u63a5return 0\u5c31\u597d\u4e86\n\n------------------\n\n _\u4e0b\u9762\u662f\u77e9\u9635\u6811\u5b9a\u7406_ \n\n\u77e9\u9635\u6811\u5b9a\u7406\u89e3\u51b3\u4e00\u4e2a\u5f88\u7b80\u5355\u7684\u95ee\u9898\uff0c\u4e00\u4e2a\u65e0\u5411\u56fe\u5230\u5e95\u6709\u591a\u5c11\u4e2a\u751f\u6210\u6811\uff1f\n\n\u7b54\u6848\u548c\u67d0\u4e2a\u77e9\u9635\u7684\u884c\u5217\u5f0f\u6709\u5173\uff0c\u8fd9\u91cc\u6211\u4eec\u53ea\u7ed9\u51fa\u8bf8\u4f4ddalao\u8bc1\u660e\u51fa\u6765\u7684\u7ed3\u8bba\n\n\u6211\u4eec\u8bbe\u8fd9\u4e2a\u56fe$G$\u7684\u90bb\u63a5\u77e9\u9635\u662f$A$,\u5ea6\u6570\u77e9\u9635\u662f$D$\n\n(\u8fd9\u91cc\u4ecb\u7ecd\u4e0b\u5ea6\u6570\u77e9\u9635\uff0c\u5ea6\u6570\u77e9\u9635\u53ea\u6709\u5bf9\u89d2\u7ebf\u4e0a\u4e0d\u662f0\uff0c\u7b2ci\u884c\u7b2ci\u5217\u7684\u503c\u662f\u70b9i\u7684\u5ea6\u6570\uff0c\u4e5f\u5c31\u662f\u90bb\u63a5\u77e9\u9635\u8fd9\u4e00\u884c\u7684\u548c)\n\n(\u8fd9\u91cc\u7684\u90bb\u63a5\u77e9\u9635\u5141\u8bb8\u91cd\u8fb9\uff0c\u90bb\u63a5\u77e9\u9635\u7b2ci\u884c\u7b2cj\u5217\u7684\u503c\u662fi\u548cj\u4e4b\u95f4\u6709\u51e0\u6761\u8fb9)\n\n\u5b9a\u4e49\u4e00\u4e2a\u56fe\u7684$Kirchhoff$\u77e9\u9635$K=D-A$\n\n\u90a3\u4e48\u77e9\u9635\u6811\u5b9a\u7406\u7684\u7ed3\u8bba\u5982\u4e0b\n\n**1.Kirchhoff\u77e9\u9635\u540c\u65f6\u53bb\u6389\u4efb\u610f\u4e00\u884c\u4e00\u5217\uff0c\u5269\u4e0b\u7684\u77e9\u9635\u884c\u5217\u5f0f\u7edd\u5bf9\u503c\u76f8\u7b49**\n\n**2.Kirchhoff\u77e9\u9635\u540c\u65f6\u53bb\u6389\u4efb\u610f\u4e00\u884c\u4e00\u5217\uff0c\u5269\u4e0b\u7684\u77e9\u9635\u7684\u884c\u5217\u5f0f\u7edd\u5bf9\u503c\uff0c\u5c31\u662f\u8fd9\u4e2a\u65e0\u5411\u56fe\u7684\u751f\u6210\u6811\u4e2a\u6570**\n\n\u6c42\u884c\u5217\u5f0f\u7684\u65b9\u6cd5\u6211\u4eec\u5df2\u7ecf\u4ecb\u7ecd\uff0c\u76f4\u63a5\u9ad8\u65af\u524a\u5143\u66b4\u529b$O(n^3)$\u6c42\u89e3\u5373\u53ef\n\n(\u4e00\u4e2a\u7279\u4f8b:\u5b8c\u5168\u56fe\u7684\u751f\u6210\u6811\u4e2a\u6570\u662f$n^{n-2}$)\n\n_______________\n\n# \u672c\u9898\u9898\u89e3\uff1a\u5bb9\u65a5\u539f\u7406\n\n\u6709\u4e86\u77e9\u9635\u6811\u5b9a\u7406\u8fd9\u4e2a\u66b4\u529b\u800c\u4f18\u96c5\u7684\u5b9a\u7406\u4e4b\u540e\u8fd9\u9898\u5c31\u662f\u4e00\u4e2a\u8003\u9a8c\u8bf8\u4f4d\u719f\u7ec3\u5ea6\u7684\u5bb9\u65a5\u539f\u7406\u8ba1\u6570\u88f8\u9898\u4e86\n\n\u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a\u8fd9\u4e2a\u9898\u6709\u4e24\u4e2a\u9650\u5236\n\n**1.\u5efa\u9020\u7684\u516c\u8def\u6784\u6210\u4e00\u53ea\u751f\u6210\u6811**\n\n**2.\u6bcf\u4e2a\u516c\u8def\u5fc5\u987b\u7531\u4e0d\u540c\u7684\u516c\u53f8\u5efa\u9020**\n\n\u53d1\u73b0\u540c\u65f6\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\u5f88\u8fa3\u624b\uff0c\u4f46\u662f\u5462\u6211\u4eec\u53ef\u4ee5\u53ea\u6ee1\u8db3\u7b2c\u4e00\u4e2a\u6761\u4ef6\n\n\u76f4\u63a5\u5bf9\u7740\u8fd9\u4e2a\u56fe\u8dd1\u4e00\u8fb9\u77e9\u9635\u6811\u5b9a\u7406\u5c31\u53ef\u4ee5\u6c42\u51fa\u65b9\u6848\u6570\u4e86\u5bf9\u5427~\n\n**\u6ce8\u610f:\u5982\u679c\u4e24\u4e2a\u516c\u53f8\u53ef\u4ee5\u5efa\u9020\u540c\u4e00\u4e2a\u516c\u8def\uff0c\u9700\u8981\u6309\u91cd\u8fb9\u5904\u7406**\uff01\n\n\u6b64\u65f6\u6211\u4eec\u4f1a\u53d1\u73b0\u6211\u4eec\u660e\u663e\u7b97\u591a\u4e86\uff0c\u521a\u597d\u7531n-1\u4e2a\u516c\u53f8\u5efa\u9020\u7684\u751f\u6210\u6811\u662f\u7edf\u8ba1\u4e0a\u4e86\n\n**\u4f46\u662f\u6211\u4eec\u4e5f\u7edf\u8ba1\u4e0a\u4e86\u521a\u597d\u7531n-2\u4e2a\u516c\u53f8\u5efa\u9020\u7684\u751f\u6210\u6811**\u3002\n\n\u6ca1\u5173\u7cfb\uff0c\u6211\u4eec\u679a\u4e3e\u5230\u5e95\u662f\u54ean-2\u4e2a\u516c\u53f8\u5efa\u9020\u4e86\u8fd9\u4e2a\u6811\uff0c\u663e\u7136\u8fd9\u6837\u7684\u96c6\u5408\u6709$C_{n-1}^{1}$\u79cd\uff0c**\u5efa\u56fe\u7684\u65f6\u5019\u53ea\u52a0\u5165\u8fd9n-2\u4e2a\u516c\u53f8\u7684\u8fb9**\uff0c\u5bf9\u7740\u8fd9\u4e2a\u56fe\u8dd1\u4e00\u8fb9\u77e9\u9635\u6811\u5c31\u53ef\u4ee5\u6c42\u51fa\u65b9\u6848\u6570\u4e86\u5bf9\u5427~\uff0c\u7136\u540e\u4f9d\u6b21\u51cf\u53bb\u8fd9\u4e9b\u96c6\u5408\u7684\u65b9\u6848\u6570\n\n\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u6b64\u65f6\u660e\u663e\u7b97\u5c11\u4e86,\u56e0\u4e3a\u6211\u4eec\u591a\u51cf\u53bb\u4e86\u521a\u597dn-3\u4e2a\u516c\u53f8\u5efa\u9020\u7684\u6811\uff0c\u663e\u7136\u8fd9\u6837\u7684\u96c6\u5408\u6709$C_{n-1}^{2}$\u79cd\uff0c\u6211\u4eec\u7ee7\u7eed\u679a\u4e3e\u96c6\u5408\uff0c**\u5efa\u56fe\u7684\u65f6\u5019\u53ea\u52a0\u5165\u8fd9n-3\u4e2a\u516c\u53f8\u7684\u8fb9**\uff0c\u7136\u540e\u7ee7\u7eed\u8dd1\u77e9\u9635\u6811\u5b9a\u7406\uff0c\u6b64\u65f6\u6211\u4eec\u4f9d\u6b21\u52a0\u4e0a\u8fd9\u4e9b\u96c6\u5408\u7684\u65b9\u6848\u6570\n\n\u7136\u540e\u53d1\u73b0\u6211\u4eec\u52a0\u591a\u4e86\u2026\u2026n-4\u4e2a\u516c\u53f8\u7684\u60c5\u51b5\u88ab\u91cd\u590d\u7edf\u8ba1\u4e86\uff0c\u6b64\u65f6\u6211\u4eec\u4ee5\u6b64\u7c7b\u63a8\u5730\u679a\u4e3e\u6240\u6709\u7684\u96c6\u5408\uff0c\u6700\u540e\u663e\u7136\u4e00\u4e2a\u516c\u53f8\u90fd\u4e0d\u5269\u7684\u60c5\u51b5\u65b9\u6848\u6570\u662f0\uff0c\u56e0\u6b64\u6211\u4eec\u7684\u9012\u5f52\u662f\u6709\u7ec8\u70b9\u7684\uff0c\u5e76\u4e14\u5f53\u9012\u5f52\u7ed3\u675f\u7684\u65f6\u5019\u6211\u4eec\u521a\u597d\u7edf\u8ba1\u4e86\u6240\u6709\u7684\u65b9\u6848\u6570\u3002\n\n**\u4ee5\u4e0a\u5efa\u56fe\u65f6\u8bf7\u52a1\u5fc5\u6ce8\u610f\u91cd\u8fb9\u7684\u5904\u7406\uff0c\u540c\u4e00\u8fb9\u4e0d\u540c\u516c\u53f8\u9020\u6309\u91cd\u8fb9\u8bb0\uff01\uff01\uff01**\n\n\u7b97\u6cd5\u590d\u6742\u5ea6$O(2^{n-1}(n-1)^{3}log(10^{9}+7))$\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898(\u7136\u800c\u6211\u5e38\u6570\u6781\u5927\u5dee\u70b9T\u98de)\n\n\u4e0a\u4ee3\u7801~\n\n```C\n#include<cstdio>\n#include<algorithm>\nusing namespace std;const int N=20;typedef long long ll;\nll mod=1e9+7;int n;int up;int mp[N][N];\ninline ll po(ll a,ll p){ll r=1;for(;p;p>>=1,a=(a*a)%mod){if(p&1){r=(r*a)%mod;}}return r;}\nll kir[N][N];int siz[262144];int u[N][N*N];int v[N][N*N];int m[N];ll res;\ninline ll det()//\u884c\u5217\u5f0f\u677f\u5b50 \n{\n\tll res=1;int tr=0;//\u8fd9\u91cc\u6211\u4eec\u8bb0\u5f55\u4e0b\u5230\u5e95\u53cd\u4e86\u591a\u5c11\u6b21\u53f7\uff0c\u56e0\u4e3a\u819c\u610f\u4e49\u4e0b\u53d6\u4e0d\u4e86\u7edd\u5bf9\u503c \n\tfor(int i=1;i<=n-1;i++)//\u5f3a\u884c\u9ad8\u65af\u524a\u5143\uff0c\u4e0d\u4f1a\u7684\u8bdd\u51fa\u95e8\u5de6\u8f6cluogu\u819c\u677f\u533a \n\t{\n\t\tif(kir[i][i]==0)\n\t\t{\n\t\t\tfor(int j=i+1;j<=n-1;j++)\n\t\t\t{\n\t\t\t\tif(kir[j][i]==0){continue;}tr^=1;//\u4ea4\u6362\u4e00\u6b21\u53d8\u4e00\u4e0b\u53f7 \n\t\t\t\tfor(int k=1;k<=n-1;k++){swap(kir[i][k],kir[j][k]);}\n\t\t\t}\n\t\t}\n\t\tfor(int j=i;j<=n-1;j++)\n\t\t{\n\t\t\tif(kir[j][i]==0){continue;}//\u4e58\u53d8\u9664\u9664\u53d8\u4e58 \n\t\t\tll div=po(kir[j][i],mod-2);res=(res*kir[j][i])%mod;\n\t\t\tfor(int k=i;k<=n-1;k++){kir[j][k]=(kir[j][k]*div)%mod;}\n\t\t}\n\t\tfor(int j=i+1;j<=n-1;j++)\n\t\t{\n\t\t\tif(kir[j][i]==0){continue;}\n\t\t\tfor(int k=i;k<=n-1;k++){kir[j][k]=(kir[j][k]+mod-kir[i][k])%mod;}\n\t\t}\n\t}for(int i=1;i<=n-1;i++){res*=kir[i][i];}//\u5224\u4e00\u4e0b\u6709\u6ca1\u67090 \n\treturn (tr)?(mod-res)%mod:res;//\u5224\u4e00\u4e0b\u662f\u5426\u53cd\u53f7 \n}\nint main()\n{\n\tscanf(\"%d\",&n);up=(1<<(n-1))-1;\n\tfor(int i=1;i<n;i++)\n\t{scanf(\"%d\",&m[i]);for(int j=1;j<=m[i];j++){scanf(\"%d%d\",&u[i][j],&v[i][j]);}}\n\tfor(int i=1;i<=up;i++){siz[i]=siz[i>>1]+(i&1);}//\u9012\u63a8\u96c6\u5408\u7684siz \n\tfor(int i=1;i<=up;i++)\n\t{\n\t\tfor(int j=1;j<=n;j++){for(int k=1;k<=n;k++){kir[j][k]=0;}}//\u6e05\u7a7a \n\t\tfor(int j=1,p=i;p;p>>=1,j++)//\u5efa\u56fe \n\t\t{\n\t\t\tif((p&1)==0)continue;\n\t\t\tfor(int k=1;k<=m[j];k++)\n\t\t\t{\n\t\t\t\tint U=u[j][k];int V=v[j][k];kir[U][U]++;kir[V][V]++;\n\t\t\t\tkir[U][V]=(kir[U][V]+mod-1)%mod;kir[V][U]=(kir[V][U]+mod-1)%mod;\n\t\t\t}\n\t\t}res=(res+mod+((n-siz[i])%2?det():-det()))%mod;//\u770b\u4e00\u4e0b\u5220\u4e86\u591a\u5c11\u4e2a\u516c\u53f8\uff0c\u51b3\u5b9a\u7b26\u53f7 \n\t}printf(\"%lld\\n\",res);return 0;//\u62dc\u62dc\u7a0b\u5e8f~ \n}\n```\n\n\n\n\n\n\n\n\n\n\n",
        "postTime": 1522324974,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4336 \u3010[SHOI2016]\u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61\u3011"
    },
    {
        "content": "### \u9898\u610f\u7b80\u8ff0\uff1a  \n\n\u6c42\u5728 $n$ \u6761\u6709\u8272\uff08$n-1$ \u79cd\u989c\u8272\uff09\u8fb9\u4e2d\u9009 $n-1$ \u6761 **\u989c\u8272\u5404\u5f02** \u7684\u8fb9\u4f7f\u5b83\u4eec\u6784\u6210\u4e00\u9897\u6811\u7684\u65b9\u6848\u6570\u3002\n\n### \u9898\u76ee\u89e3\u6cd5\uff1a   \n\n**\u524d\u7f6e\u77e5\u8bc6\uff1a\u77e9\u9635\u6811\u5b9a\u7406**  \n\n\u4e0d\u4f1a\u4e0d\u884c\uff0c\u6709\u5173\u7cfb\u3002  \n\n\u770b\u5230\u6570\u636e\u8303\u56f4 $(n\\le17)$\uff0c\u679c\u65ad\u60f3\u5230\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(F2^n)$\uff0c\u5176\u4e2d $F$ \u4e3a\u4e00\u4e2a\u5173\u4e8e $n$ \u7684\u5c0f\uff08\u8bf7\u611f\u6027\u7406\u89e3\uff09\u591a\u9879\u5f0f\u3002  \n\n\u6211\u4eec\u770b\u5230\uff0c\u6c42\u751f\u6210\u6811\u7684\u4e2a\u6570\uff0c\u6839\u636e\u4ee5\u5f80\u77e5\u8bc6\uff0c\u80af\u5b9a\u8981\u7528 $\\rm Matrix-Tree$ \u5b9a\u7406\u4e86\u3002  \n\n\u7136\u540e\u5c31\u662f\u8fd9\u4e2a\u989c\u8272\u5404\u5f02\u6761\u4ef6\u7279\u522b\u70e6\uff0c\u6211\u4eec\u8003\u8651\u679a\u4e3e\u7528\u7684\u8fb9\u4ece\u4f55\u5904\u9009\u51fa\u3002  \n\n\u5982\u679c\u679a\u4e3e\u7528\u5565\u8fb9\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O}(\\prod m_i n^3)$ \u7684\uff0c\u8fd8\u4e0d\u5982\u66b4\u529b\u3002  \n\n\u4ed4\u7ec6\u60f3\u60f3\uff0c\u662f\u56e0\u4e3a **\u91cd\u590d\u8ba1\u6570** \u4e86\uff0c\u6bcf\u79cd\u60c5\u51b5\u90fd\u679a\u4e3e\u4e86\u3002  \n\n\u6839\u636e\u4ee5\u5f80\u7684\u7ecf\u9a8c\uff0c\u8fd9\u9053\u9898\u6570\u636e\u89c4\u6a21\u53c8\u5f88\u5c0f\uff0c\u6240\u4ee5\u7528 **\u5bb9\u65a5\u539f\u7406** \u5c31\u884c\u4e86\u3002  \n\n\u5177\u4f53\u800c\u8a00\uff0c\u5c31\u662f $\\mathcal{O}(2^n)$ \u679a\u4e3e\u53ea\u53d6\u5176\u4e2d\u51e0\u79cd\u989c\u8272\u7684\u8fb9\uff0c\u7136\u540e\u778e\u7b97\u4e00\u4e0b\u5c31\u884c\u4e86\u3002  \n\n\u8bb0 $f$ \u4e3a\u53ea\u8003\u8651\u67d0\u51e0\u79cd\u989c\u8272\u65f6\u751f\u6210\u6811\u7684\u4e2a\u6570\uff0c\u5219\u53ef\u4ee5\u5728 $\\mathcal{O}(n^3)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u7b97\u51fa\u4e00\u79cd\u9009\u62e9\u65b9\u6848\u6240\u5bf9\u5e94\u7684 $f$ \u503c\u3002\n\n\u66f4\u5177\u4f53\u70b9\uff0c\u5c31\u662f $\\sum\\limits_{\\text{\u53d6 1 \u4e2a}}f-\\sum\\limits_{\\text{\u53d6 2 \u4e2a}}f+\\sum\\limits_{\\text{\u53d6 3 \u4e2a}}f-\\sum\\limits_{\\text{\u53d6 4 \u4e2a}}f\\cdots\\pm\\sum\\limits_{\\text{\u53d6 (n-1) \u4e2a}}f$\u3002  \n\n\u5f88\u663e\u7136\uff0c\u8fd9\u4e2a\u6b63\u8d1f\u53f7\u53d6\u51b3\u4e8e\u9009\u7684\u4e2a\u6570\u7684\u5947\u5076\u6027\u3002  \n\n\u6240\u4ee5\u72b6\u538b\u4e00\u4e0b\u4ece $1$ \u679a\u4e3e\u5230 $2^{n-1}-1$\uff08$\\rm dfs$ \u4e5f\u884c\uff09\u987a\u4fbf\u7edf\u8ba1\u4e00\u4e0b\u9009\u7684\u4e2a\u6570 $\\text{(cnt)}$ \u7136\u540e\u5bb9\u65a5\u5c31\u884c\u4e86\u3002  \n\n\u5177\u4f53\u8be6\u89c1\u4ee3\u7801\u3002\n\n### \u6b63\u786e\u4ee3\u7801\uff1a \n\n```cpp\n#include<bits/stdc++.h>\n#define mp(x,y) make_pair(x,y)\n#define mod 1000000007\nusing namespace std;\nint TMP3301;\ninline int read(){\n    int res=0;\n    char c;\n    bool zf=0;\n    while(((c=getchar())<'0'||c>'9')&&c!= '-');\n    if(c=='-')zf=1;\n    else res=c-'0';\n    while((c=getchar())>='0'&&c<='9')res=(res<<3)+(res<<1)+c-'0';\n    if(zf)return -res;\n    return res;\n}\nint n;\nint dta[21][21];\ntypedef pair<int,int>P;\nvector<P>q[21];\ninline void _swap(int x,int y){\n\tfor(register int i=1;i<=n;++i){\n\t\t#define swap(x,y) TMP3301=x,x=y,y=TMP3301;\n\t\tswap(dta[i][x],dta[i][y]);\n\t\t#undef swap\n\t}\n\treturn;\n}\ninline int det(){\n\tint ans=1;\n\tfor(register int i=1;i<=n;++i){\n\t\tint p=-1;\n\t\tfor(register int j=i;j<=n;++j)\n\t\t\tif(dta[i][j]){\n\t\t\t\tp=j;\n\t\t\t\tbreak;\n\t\t\t}\n\t\tif(!~p){\n\t\t\treturn 0;\n\t\t}\n\t\tif(p!=i){\n\t\t\t_swap(i,p);\n\t\t\tans*=-1;\n\t\t}\n\t\tfor(register int j=i+1;j<=n;++j){\n\t\t\twhile(dta[j][i]){\n\t\t\t\tint tmp=dta[j][i]/dta[i][i];\n\t\t\t\tfor(register int k=i;k<=n;++k){\n\t\t\t\t\tdta[j][k]-=1ll*tmp*dta[i][k]%mod;\n\t\t\t\t\tdta[j][k]=(dta[j][k]%mod+mod)%mod;\n\t\t\t\t} \n\t\t\t\tif(!dta[j][i]){\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tswap(dta[i],dta[j]);\n\t\t\t\tans*=-1;\n\t\t\t}\n\t\t}\n\t\tans=1ll*ans*dta[i][i]%mod;\n\t}\n\treturn ans;\n}\nsigned main(){\n\tn=read()-1;\n\tfor(register int i=1;i<=n;++i){\n\t\tint cnt=read();\n\t\twhile(cnt--){\n\t\t\tint x=read(),y=read();\n\t\t\tq[i].push_back(mp(x,y));\n\t\t}\n\t}\n\tint ans=0;\n\tfor(register int i=1;i<(1<<n);++i){\n\t\tmemset(dta,0,sizeof(dta));\n\t\tint cnt=0;\n\t\tfor(register int j=1;j<=n;++j){\n\t\t\tif(!(i&(1<<(j-1)))){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t++cnt;\n\t\t\tfor(register int k=0;k<q[j].size();++k){\n\t\t\t\tint x=q[j][k].first,y=q[j][k].second;\n\t\t\t\t++dta[x][y],++dta[y][x],--dta[x][x],--dta[y][y];\n\t\t\t}\n\t\t}\n\t\tans=(ans+((cnt&1)?-1:1)*det())%mod;\n\t}\n\tprintf(\"%d\\n\",(ans%mod+mod)%mod);\n\treturn 0;\n} \n```\n\n\u5982\u679c\u60a8\u6ca1\u6709\u770b\u61c2\u8fd9\u7bc7\u9898\u89e3\uff0c\u53ef\u4ee5\u5728\u8bc4\u8bba\u533a\u95ee\u6211\uff0c\u6211\u5c06\u4f1a\u56de\u7b54\u60a8\u7684\u95ee\u9898\u5e76\u4e14\u4fee\u6539\u8fd9\u7bc7\u9898\u89e3\uff0c\u4f7f\u5b83\u53d8\u5f97\u66f4\u52a0\u901a\u4fd7\u6613\u61c2\uff0c\u670d\u52a1\u66f4\u591a\u7684 $\\text{OIer}$\u3002  \n\u5982\u679c\u60a8\u770b\u61c2\u4e86\u8fd9\u7bc7\u9898\u89e3\uff0c\u53ef\u4ee5\u70b9\u4e2a\u8d5e\uff0c\u4f7f\u8fd9\u7bc7\u9898\u89e3\u7684\u6392\u540d\u4e0a\u5347\uff0c\u670d\u52a1\u66f4\u591a\u7684 $\\text{OIer}$\u3002  ",
        "postTime": 1609233890,
        "uid": 183609,
        "name": "hhoppitree",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4336 \u3010[SHOI2016]\u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61\u3011"
    },
    {
        "content": "### \u9898\u610f\n\n$n-1$\u4e2a\u516c\u53f8,\u6bcf\u4e2a\u516c\u53f8\u80fd\u4fee\u4e00\u4e9b\u8fb9,\u6c42\u6bcf\u6761\u8fb9\u90fd\u8ba9\u4e0d\u540c\u7684\u516c\u53f8\u6765\u4fee\u7684\u751f\u6210\u6811\u7684\u65b9\u6848\u6570\n\n---\n\n### \u9898\u89e3\n\n\u770b\u5230\u8fd9\u79cd\"\u6bcf\u4e2a$\\ldots$\u90fd\u8981$\\ldots$\"\u7684\u9898\u76ee\u5c31\u5f80\u5bb9\u65a5\u65b9\u9762\u60f3\u4e00\u60f3\n\n\u90a3\u4e48$ans=$\u6240\u6709\u90fd\u9009\u4e86\u7684\u751f\u6210\u6811\u4e2a\u6570$-1$\u4e2a\u6ca1\u9009\u7684$+2$\u4e2a\u6ca1\u9009\u7684$-\\ldots$\n\n\u751f\u6210\u6811\u4e2a\u6570\u5c31\u53ef\u4ee5\u7528\u76f4\u63a5\u7528\u77e9\u9635\u6811\u5b9a\u7406\u6c42\u5c31\u597d\u4e86\n\n\u7136\u540e\u8fd9\u9898\u6a21\u6570\u662f\u4e00\u4e2a\u8d28\u6570,\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u6c42\u9006\u5143\n\n```\n#include<bits/stdc++.h>\n#define fp(i,a,b) for(register int i=a,I=b+1;i<I;++i)\n#define fd(i,a,b) for(register int i=a,I=b-1;i>I;--i)\n#define go(u) for(register int i=fi[u],v=e[i].to;i;v=e[i=e[i].nx].to)\n#define file(s) freopen(s\".in\",\"r\",stdin),freopen(s\".out\",\"w\",stdout)\ntemplate<class T>inline bool cmax(T&a,const T&b){return a<b?a=b,1:0;}\ntemplate<class T>inline bool cmin(T&a,const T&b){return a>b?a=b,1:0;}\nusing namespace std;\nconst int N=20,P=1e9+7;\ntypedef int arr[N];\ntypedef long long ll;\nstruct eg{int nx,u,v;}e[8005];\nint n,ce,ans;arr fi,a[N],G[N];\ninline int pls(int a,int b){return a+=b,a>=P?a-P:a;}\ninline int sub(int a,int b){return a-=b,a<0?a+P:a;}\ninline int fpm(int a,int b){int x=1;for(;b;b>>=1,a=(ll)a*a%P)if(b&1)x=(ll)x*a%P;return x;}\ninline int det(int n){\n    int ans=1,f=1,t,inv,mx;\n    fp(i,1,n)fp(j,1,n)G[i][j]=pls(a[i][j],P);\n    fp(i,1,n){mx=i;\n        fp(j,i,n)if(G[j][i]>G[mx][i])mx=j;\n        if(mx^i){fp(k,i,n)swap(G[i][k],G[mx][k]);f=-f;}\n        inv=fpm(G[i][i],P-2);\n        fp(j,i+1,n)if(G[j][i]){\n        \tt=(ll)G[j][i]*inv%P;\n        \tfp(k,i,n)G[j][k]=sub(G[j][k],(ll)G[i][k]*t%P);\n        }ans=(ll)ans*G[i][i]%P;\n    }\n    return pls(P,f*ans);\n}\nvoid dfs(int x,int y){\n\tif(x==n)return y&1?ans=sub(ans,det(n-1)):ans=pls(ans,det(n-1)),void();\n\tdfs(x+1,y);\n\tfor(int i=fi[x];i;i=e[i].nx){\n\t\tint u=e[i].u,v=e[i].v;\n\t\t--a[u][u],--a[v][v],++a[u][v],++a[v][u];\n\t}\n\tdfs(x+1,y+1);\n\tfor(int i=fi[x];i;i=e[i].nx){\n\t\tint u=e[i].u,v=e[i].v;\n\t\t++a[u][u],++a[v][v],--a[u][v],--a[v][u];\n\t}\n}\ninline void add(int i,int u,int v){e[++ce]={fi[i],u,v},fi[i]=ce;}\nint main(){\n    #ifndef ONLINE_JUDGE\n        file(\"s\");\n    #endif\n    scanf(\"%d\",&n);\n    fp(i,1,n-1){\n    \tint m,u,v;scanf(\"%d\",&m);\n    \tfp(j,1,m)scanf(\"%d%d\",&u,&v),add(i,u,v),++a[u][u],++a[v][v],--a[u][v],--a[v][u];\n    }\n    dfs(1,0);\n    printf(\"%d\",ans);\nreturn 0;\n}\n\n```",
        "postTime": 1522290627,
        "uid": 20156,
        "name": "Kelin",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4336 \u3010[SHOI2016]\u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61\u3011"
    },
    {
        "content": "\u751f\u6210\u6811\u8ba1\u6570\u7684\u95ee\u9898\u7528\u77e9\u9635\u6811\u5b9a\u7406\u89e3\u51b3\u3002\n\n\u8003\u8651\u5982\u4f55\u89e3\u51b3\u53bb\u91cd\u7684\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u5982\u4f55\u4fdd\u8bc1\u6bcf\u4e2a\u516c\u53f8\u90fd\u4fee\u5efa\u4e00\u6761\u9053\u8def\u3002\n\n\u7528\u5bb9\u65a5\u6765\u89e3\u51b3\uff0c\u4e3a\u65b9\u4fbf\u8d77\u89c1\uff0c\u6211\u5904\u7406\u65f6\u5148\u5c06$n$\u51cf\u4e861\u3002\n\n\u8bbe$f(n)$\u4e3a\u7528$n$\u4e2a\u516c\u53f8\uff0c\u4e14\u4e0d\u8003\u8651\u6bcf\u4e2a\u516c\u53f8\u90fd\u4fee\u5efa\u4e00\u6761\u9053\u8def\u7684\u8981\u6c42\uff0c\u751f\u6210\u6811\u7684\u65b9\u6848\u6570\u3002\n\n\u5e94\u7528\u5bb9\u65a5\u516c\u5f0f\uff0c\u90a3\u4e48\u7b54\u6848$ans=\\sum\\limits_{i=1}^n(-1)^{n-i}f(i)$\n\n\u90a3\u4e48\u6211\u4eec\u679a\u4e3e\u5b50\u96c6\uff0c\u7528\u77e9\u9635\u6811\u5b9a\u7406\u8ba1\u7b97\u6c42\u89e3\u5373\u53ef\u3002\n\n\u5b9e\u73b0\u7ec6\u8282\u770b\u4ee3\u7801\u5427\u3002\n\n$code:$\n\n```cpp\n#include<bits/stdc++.h>\n#define maxn 20\n#define maxm 410\n#define mod 1000000007\nusing namespace std;\ntypedef long long ll;\ntemplate<typename T> inline void read(T &x)\n{\n    x=0;char c=getchar();bool flag=false;\n    while(!isdigit(c)){if(c=='-')flag=true;c=getchar();}\n    while(isdigit(c)){x=(x<<1)+(x<<3)+(c^48);c=getchar();}\n    if(flag)x=-x;\n}\nll n,all,sum,cnt;\nll a[maxn][maxn];\nvoid add(int x,int y)\n{\n    a[x][x]++,a[y][y]++;\n    a[x][y]--,a[y][x]--;\n}\nstruct edge\n{\n    int x,y;\n};\nstruct node\n{\n    ll num;\n    edge e[maxm];\n}p[maxn];\nll det()\n{\n    ll ans=1;\n    for(int i=1;i<=n;++i)\n    {\n        for(int j=i+1;j<=n;++j)\n        {\n            while(a[j][i])\n            {\n                ll d=a[i][i]/a[j][i];\n                for(int k=i;k<=n;++k)\n                    a[i][k]=((a[i][k]-a[j][k]*d%mod)%mod+mod)%mod;\n                swap(a[i],a[j]),ans*=-1;\n            }\n        }\n        ans=ans*a[i][i]%mod;\n    }\n    return (ans%mod+mod)%mod;\n}\nint main()\n{\n    read(n),n--,all=1<<n;\n    for(int i=1;i<=n;++i)\n    {\n        read(p[i].num);\n        for(int j=1;j<=p[i].num;++j)\n            read(p[i].e[j].x),read(p[i].e[j].y);\n    }\n    for(int s=1;s<all;++s)\n    {\n        cnt=0;\n        memset(a,0,sizeof(a));\n        for(int i=1;i<=n;++i)\n        {   \n            if(s&(1<<(i-1)))\n            {   \n                cnt++;\n                for(int j=1;j<=p[i].num;++j)\n                    add(p[i].e[j].x,p[i].e[j].y);\n            }\n        }\n        sum=((sum+det()*((n-cnt)&1?-1:1))%mod+mod)%mod;\n    }\n    printf(\"%lld\",sum);\n    return 0;\n}\n```\n",
        "postTime": 1580984716,
        "uid": 172489,
        "name": "lhm_",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4336 \u3010[SHOI2016]\u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61\u3011"
    },
    {
        "content": "[\u9898\u76ee](https://www.luogu.org/problemnew/show/P4336)\n\n\u9898\u76ee\u5927\u610f\uff1a\u7ed9\u51fa$n-1$\u4e2a\u516c\u53f8,\u6c42\u6bcf\u4e2a\u516c\u53f8\u4fee\u5efa\u4e00\u6761\u8def\u80fd\u5f62\u6210\u4e00\u68f5$n$\u4e2a\u8282\u70b9\u7684\u751f\u6210\u6811\u7684\u65b9\u6848\u6570\n\n~~\u4e00\u773c\u770b\u53bb\u77e9\u9635\u6811~~\uff0c\u4f46\u662f\u76f4\u63a5\u6c42$n-1$\u4e2a\u516c\u53f8\u7684\u77e9\u9635\u6811\u4f1a\u51fa\u95ee\u9898\uff0c\u53ef\u80fd\u6709\u7684\u516c\u53f8\u4fee\u5efa\u4e0d\u6b62\u4e00\u6761\u9053\u8def\uff0c\u6240\u4ee5\u5c31\u5bb9\u65a5\u4e00\u4e0b\u5566\u3002\n\n\u5f53\u7136~~\u4e00\u773c\u5c31\u80fd\u770b\u51fa~~\u8fd9\u79cd\u8ddf\u96c6\u5408\u6709\u5173\u7684\u5bb9\u65a5\u7cfb\u6570\u5c31\u662f$(-1)^{n-1-i}$\u5566\uff0c\u4f46\u8fd8\u662f\u8bc1\u660e\u4e00\u4e0b\u597d\u4e86(\u8fd9\u79cd\u7b80\u5355\u7684\u5bb9\u65a5\u5982\u679c\u60a8\u4f1a\u7684\u8bdd\u5c31\u4e0d\u7528\u770b\u4e0b\u9762\u7684\u8bc1\u660e\u4e86QAQ)\n\n\u8003\u8651\u6211\u4eec\u7b97\u7684\u65b9\u6848\u7684\u8d21\u732e\uff0c\u8003\u8651\u53ea\u6709$m$\u4e2a\u516c\u53f8\u4fee\u5efa\u4e86$n-1$\u6761\u8def\u8d21\u732e\u4e3a$[m==n-1]$\uff0c\u800c\u6211\u4eec\u77e9\u9635\u6811\u5176\u5b9e\u6c42\u7684\u662f\u4e00\u4e2a\u96c6\u5408\u7684\u6240\u6709\u5b50\u96c6\u7684\u65b9\u6848\u6570\uff0c\u6bd4\u5982$\\{1,2,3\\}$\u4f1a\u7b97\u51fa$\\{1,2,3\\},\\{1,2\\},\\{1,3\\},\\{2,3\\},\\{1\\},\\{2\\},\\{3\\}$\u4f46\u6211\u4eec\u53ea\u8981\u6c42\u51fa$\\{1,2,3\\}$\uff0c\u600e\u4e48\u529e\u5462\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u8981\u901a\u8fc7\u7b97\u8d21\u732e\u6765\u914d\u5bb9\u65a5\u7cfb\u6570\uff08\u5bb9\u65a5\u7684\u9898\u90fd\u53ef\u4ee5\u8fd9\u6837\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u627e\u89c4\u5f8b\uff0c\u9012\u63a8\u5f97\u5230\u5bb9\u65a5\u7cfb\u6570\uff09\n\n\u8003\u8651\u4efb\u610f\u4e00\u4e2a\u96c6\u5408A\u6709$m$\u4e2a\u5143\u7d20\uff0c\u6709\u53e6\u4e00\u4e2a\u96c6\u5408B\u4f7f\u5f97A\u662fB\u7684\u5b50\u96c6,\u5047\u8bbeB\u6709$i$\u4e2a\u5143\u7d20,\u90a3\u4e48\u4f1a\u7b97$\\tbinom{n-1-m}{i-m}$\u6b21\uff0c\u6211\u4eec\u5e0c\u671b$m!=n-1$\u65f6A\u6ca1\u6709\u8d21\u732e\uff0c\u90a3\u4e48\u5c31\u6709\u8fd9\u4e2a\u5f0f\u5b50\n\n $\\sum{i=m}^{n-1}{\\tbinom{n-1-m}{i-m}*F(i)}==[m==n-1] ===> \\sum{i=0}^{i=n-1-m}{\\tbinom{n-1-m}{i}*F(i+m)}==[m==n-1]$  \n$===>\\sum_{i=0}^{k}{\\tbinom{k}{i}*F(i+(n-1-k))}==[k==0]===>\\sum_{i=0}^{k}{\\tbinom{k}{k-i}*F(n-1-i)}==[k==0]$\n\n\u7136\u540e\u56e0\u4e3a\u6211\u4eec\u90fd\u77e5\u9053$\\sum_{i=0}^{n}{\\tbinom{n}{i}*(-1)^{i}}==[n==0]$\n\n\u6240\u4ee5\u6709$F(n-1-i)=(-1)^{i}$,\u6240\u4ee5$F(i)=(-1)^{n-1-i}$\n\n\u7136\u540e\u5c31\u5f88\u7b80\u5355\u4e86...(\u6211\u7528\u7684\u8f97\u8f6c\u76f8\u9664\u6c42\u9ad8\u65af\u6d88\u5143\uff0c\u597d\u50cf\u6162\u597d\u591a\u554a\uff09\n\n```cpp\n#include <cstdio>\n#include <cstdlib>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\n#include <queue>\nusing namespace std;\ntypedef long long LL;\nconst int mod=1e9+7,N=18;\nint m[N],u[N][N*N],v[N][N*N],siz[1<<N],n,maxn;\nLL ans,a[N][N];\ninline void ins(int u,int v){a[u][u]++;a[v][v]++;a[u][v]--;a[v][u]--;}\ninline LL Gauss(int p){\n    LL ans=1;\n    for(int i=1;i<=p;++i){\n        for(int j=i+1;j<=p;++j){\n            while(a[j][i]){\n                LL d=a[i][i]/a[j][i];\n                for(int k=i;k<=p;++k){a[i][k]=(a[i][k]+mod-d*a[j][k]%mod)%mod;}\n                swap(a[i],a[j]);ans=-ans;\n            }\n        }ans=ans*a[i][i]%mod;\n    }\n    return ans<0?ans+mod:ans;\n}\nint main(){\n    scanf(\"%d\",&n);maxn=(1<<(n-1))-1;\n    for(int i=1;i<n;++i){scanf(\"%d\",&m[i]);for(int j=1;j<=m[i];++j)scanf(\"%d%d\",&u[i][j],&v[i][j]);}\n    for(int i=1;i<=maxn;++i)siz[i]=siz[i>>1]+(i&1);\n    for(int i=1;i<=maxn;++i){\n        for(int j=1;j<n;++j)for(int k=1;k<n;++k)a[j][k]=0;\n        for(int j=1,p=i;p;p>>=1,++j){\n            if(!(p&1))continue;\n            for(int k=1;k<=m[j];++k)ins(u[j][k],v[j][k]);\n        }\n        if((n-siz[i])%2==1){ans+=Gauss(n-1);if(ans>mod)ans-=mod;}\n        else {ans+=(mod-Gauss(n-1));if(ans>mod)ans-=mod;}\n    }printf(\"%lld\\n\",ans);\n    return 0;\n}\n\n```\n",
        "postTime": 1551533295,
        "uid": 54113,
        "name": "ecnerwaIa",
        "ccfLevel": 0,
        "title": "P4336 [SHOI2016]\u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61"
    },
    {
        "content": "\u8fd9\u9898\u7684\u4e3b\u8981\u7279\u70b9\u662f\u4e00\u65e6\u4e86\u89e3\u6240\u7528\u7b97\u6cd5\u5c31\u975e\u5e38\u6a21\u677f\u3002  \n\u90a3\u4e48\u524d\u7f6e\u77e5\u8bc6\u5c31\u662f *\u5bb9\u65a5\u539f\u7406* \u548c *\u77e9\u9635\u6811\u5b9a\u7406*\u3002\n\n\u5373\u4fbf\u6ca1\u6709\u5b66\u8fc7\u5bb9\u65a5\uff0c\u7406\u89e3\u672c\u9898\u5bb9\u65a5\u601d\u8def\u4e5f\u5f88\u5bb9\u6613\u3002\n\n> \u7ed9\u5b9a\u4e00\u4e2a\u6709\u91cd\u8fb9\u65e0\u81ea\u73af\u65e0\u5411\u56fe\uff0c\u6bcf\u6761\u8fb9\u6709\u4e00\u4e2a\u989c\u8272\uff0c\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u5b83\u7684 **\u6240\u6709 $n-1$ \u6761\u6811\u8fb9\u989c\u8272\u4e92\u4e0d\u76f8\u540c** \u7684\u751f\u6210\u6811\u4e2a\u6570\u3002\n\n\n![image.png](https://s2.loli.net/2021/12/27/5fyX4AcDmIdCub1.png)\n\n\u4e0a\u9762\u662f\u4e3e\u4e86\u4e00\u4e2a\u4f8b\u5b50\u3002\u4e8b\u5b9e\u4e0a\uff0c\u4e00\u822c\u5730\uff1a\n$$\nANS(T=\\{1,2,...,n-1\\})=\\sum_{i=n-1}^0\\left((-1)^{n-1-i}\\sum_{|S|=i,S\\subseteq\\{1,2,...,n-1\\}}ANS(T\\subseteq S)\\right)\n$$\n\u5982\u4f55\u6c42 $ANS(T\\subseteq S)$ \u5462\uff1f\u663e\u7136\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u662f\u5df2\u77e5\u4e00\u5f20\u65b0\u56fe\uff0c\u9700\u8981\u6c42\u8fd9\u4e2a\u65b0\u56fe\u7684\u751f\u6210\u6811\u6570\u91cf\u3002\u6211\u4eec\u4e86\u89e3\u5230\uff0cMatrix-Tree \u5b9a\u7406\uff08\u77e9\u9635\u6811\u5b9a\u7406\uff09\u5c31\u662f\u7528\u6765\u5e72\u8fd9\u4e2a\u4e8b\u7684\uff0c\u4e8e\u662f\u5c31\u5f88\u677f\u4e86\u3002\n\n## \u4ec0\u4e48\u662f Matrix-Tree \u5b9a\u7406\n\n### 1.Kirchhoff \u77e9\u9635\n\nKirchhoff \u77e9\u9635\uff08\u53c8\u79f0\u62c9\u666e\u62c9\u65af\u77e9\u9635\uff09 $L=V-E$\uff0c\u5176\u4e2d $V$ \u5b9a\u4e49\u4e3a $V_{i,i}=deg_i,V_{i,j}=0(i\\ne j)$\uff0c$E$ \u4e3a\u65e0\u5411\u56fe\u7684\u90bb\u63a5\u77e9\u9635\uff08\u5f53\u7136\u5173\u4e8e\u5bf9\u89d2\u7ebf\u5bf9\u79f0\uff09\u3002\u77e9\u9635\u51cf\u6cd5\u662f\u6307\u4e24\u4e2a\u77e9\u9635\u5bf9\u5e94\u4f4d\u7f6e\u4e0a\u7684\u6570\u76f8\u51cf\uff0c\u5373 $L_{i,j}=V_{i,j}-E_{i,j}$\u3002\n\n### 2.\u4f59\u5b50\u5f0f\n\n\u4e00\u4e2a\u77e9\u9635\u540c\u65f6\u53bb\u6389\u67d0\u4e9b\u884c\u3001\u67d0\u4e9b\u5217\u540e\u5f97\u5230\u65b0\u77e9\u9635\u7684\u884c\u5217\u5f0f\u7684\u662f\u4ed6\u7684\u4e00\u4e2a\u4f59\u5b50\u5f0f\u3002\n\n### 3.\u77e9\u9635\u884c\u5217\u5f0f\n\n\u77e9\u9635\u884c\u5217\u5f0f **\u9488\u5bf9\u7684\u662f\u4e00\u4e2a $n\\times n$ \u7684\u77e9\u9635**\u3002\u5176\u5b9a\u4e49\u5f0f\u4e3a \n$$\n\\det(A)=\\sum_p(-1)^{\\tau(p)}\\prod_{i=1}^n a_{i,p_i}\n$$\n\u5176\u4e2d $p$ \u4e3a\u4e00\u4e2a $1\\sim n$ \u7684\u5168\u6392\u5217\uff0c$\\tau(p)$ \u8868\u793a $p$ \u7684\u9006\u5e8f\u5bf9\u6570\u3002**$\\det(A)$ \u7684\u53e6\u4e00\u79cd\u8bb0\u6cd5\u4e3a $|A|$**\u3002\n\n\u8fd9\u4e2a\u5f0f\u5b50\u6781\u5c11\u7528\u6765\u76f4\u63a5\u6c42\u89e3\u3002\u5bf9\u77e9\u9635\u884c\u5217\u5f0f\u7684\u7b80\u5355\u7406\u89e3\u65b9\u5f0f\u4e3a **\u4e00\u4e2a\u77e9\u9635\u7684\u5b9a\u4e49\u65b0\u8fd0\u7b97\u201c\u503c\u201d**\u3002\n\n#### \u77e9\u9635\u884c\u5217\u5f0f\u6027\u8d28\n\n\u77e9\u9635\u884c\u5217\u5f0f\u7ecf\u8fc7\u77e9\u9635\u521d\u7b49\u53d8\u6362\u540e\u503c\u4f1a\u53d1\u751f\u8c03\u6574\uff0c\u5177\u4f53\u5730\uff1a\n\n1. \u4ea4\u6362\u77e9\u9635\u7684\u4e24\u884c\u6216\u4e24\u5217\uff0c$\\det(A')=-\\det(A)$\u3002\n2. \u4ea4\u6362\u77e9\u9635\u7684\u4e00\u884c\u548c\u4e00\u5217\uff0c$\\det(A\u2019)=\\det(A)$\u3002\n3. \u77e9\u9635\u7684\u4e00\u884c\u540c $\\times k$\uff0c\u884c\u5217\u5f0f\u540c\u65f6 $\\times k$\u3002\n\n$$\n\\begin{vmatrix}\n        a_{1,1}  &a_{1,2}  &\\cdots  &a_{1,n}\\\\\n        a_{2,1}  &a_{2,2}  &\\cdots  &a_{2,n}\\\\\n        \\vdots  &\\vdots  &\\ddots  &\\vdots\\\\\n        k\\times a_{i,1}  &k\\times a_{i,2}  &\\cdots  &k\\times a_{i,n}\\\\\n        \\vdots &\\vdots  &\\ddots  &\\vdots\\\\\n        a_{n,1} &a_{n,2} &\\cdots &a_{n,n}\\\\\n        \\end{vmatrix}\n        =k\\times\n        \\begin{vmatrix}\n        a_{1,1}  &a_{1,2}  &\\cdots  &a_{1,n}\\\\\n        a_{2,1}  &a_{2,2}  &\\cdots  &a_{2,n}\\\\\n        \\vdots  &\\vdots  &\\ddots  &\\vdots\\\\\n        a_{i,1}  &a_{i,2}  &\\cdots  &a_{i,n}\\\\\n        \\vdots  &\\vdots  &\\ddots  &\\vdots\\\\\n        a_{n,1} &a_{n,2} &\\cdots &a_{n,n}\\\\\n        \\end{vmatrix}\n$$\n\n4. \u77e9\u9635\u7684\u4e00\u884c\u52a0\u4e0a\u53e6\u4e00\u884c\u7684\u82e5\u5e72\u500d\uff0c\u884c\u5217\u5f0f\u4e0d\u53d8\u3002\n\n\u5728\u8fd9\u90e8\u5206\u5185\u5bb9\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u7528\u5230\u7684\u662f\u89c4\u5f8b 1 \u548c 4\u3002\n\n### 4.Matrix-Tree \u5b9a\u7406\n\n\u4e00\u4e2a\u56fe\u7684\u751f\u6210\u6811\u4e2a\u6570\u4e3a\u5b83\u7684 Kirchhoff \u77e9\u9635\u7684\u53bb\u6389\u7b2c $i$ \u884c\u3001\u7b2c $i$ \u5217\u7684\u4f59\u5b50\u5f0f\uff0c$i$ \u4efb\u610f\u3002\n\n\u901a\u5e38\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u9009 $i=n$\u3002\n\n### 5.\u7528\u9ad8\u65af\u6d88\u5143\u6c42\u77e9\u9635\u884c\u5217\u5f0f\n\n\u5728\u521d\u5b66\u9636\u6bb5\uff0c\u4e00\u4e9b\u770b\u8d77\u6765 forbidding \u7684\u63a8\u5bfc\u8fc7\u7a0b\u53ef\u80fd\u4e0d\u5229\u4e8e\u7406\u89e3\uff0c\u56e0\u6b64\u5728\u8fd9\u91cc\u76f4\u63a5\u6446\u7ed3\u8bba\uff1a\n\n- \u6c42\u4e00\u4e2a\u77e9\u9635\u7684\u884c\u5217\u5f0f\u53ef\u4ee5\u901a\u8fc7\u5c06\u5b83\u5229\u7528\u77e9\u9635\u521d\u7b49\u53d8\u6362\u5316\u4e3a\u4e00\u4e2a *\u4e0a\u4e09\u89d2\u77e9\u9635* \u540e\u8ba1\u7b97\u3002\n- \u4e0a\u4e09\u89d2\u77e9\u9635\u7684\u884c\u5217\u5f0f\u7b49\u4e8e\u5176\u5bf9\u89d2\u7ebf\u7684\u6570\u4e58\u79ef\uff0c\u5373\n\n![image.png](https://s2.loli.net/2021/12/27/NwgM6VYlcCXDfGQ.png)\n\n\u800c\u5c06\u4e00\u4e2a\u4e00\u822c\u7684\u77e9\u9635\u5316\u4e3a\u4e0a\u4e09\u89d2\u77e9\u9635\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u9ad8\u65af\u6d88\u5143\u7684\u65b9\u6cd5\u3002\n\n\u4e0b\u9762\u5c55\u793a\u51fa\u9ad8\u65af\u6d88\u5143\u6c42\u89e3\u7ebf\u6027\u65b9\u7a0b\u7ec4\u7684\u6838\u5fc3\u4ee3\u7801\u3002\n\n```cpp\nint a[N][N];\nfor(int i=1;i<=n;i++)\n    for(int p=1;p<=n;p++)if(p!=i){\n        double d=a[p][i]/a[i][i];\n        for(int q=1;q<=n+1;q++)a[p][q]-=d*a[i][q];\n    }\n```\n\n\u8fd9\u91cc\u6211\u4eec\u662f\u7528\u7684\u5c0f\u6570\uff0c\u4f46\u662f\u73b0\u5728\u8bf4\u5728 $\\bmod p$ \u4e0b\u7684\u7b54\u6848\uff0c\u5c31\u4e0d\u80fd\u8fd9\u4e48\u5e72\u4e86\u3002\u4e8e\u662f\u6211\u4eec\u9879\u8981\u6c42 $a[i][i]$ \u7684\u9006\u5143\uff0c\u4f46\u8fd9\u662f\u4e0d\u53ef\u80fd\u7684\u56e0\u4e3a\u6709\u53ef\u80fd\u5b83\u6ca1\u6709\u9006\u5143\uff0c\u800c\u4e14\u91cc\u9762\u7684\u6570\u4e00\u76f4\u5728\u53d8\u4f1a\u8981\u6c42\u5f88\u591a\u6b21\u4e5f\u662f\u4e0d\u53ef\u80fd\u7684\u3002\n\n\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u79cd\u8f97\u8f6c\u76f8\u9664\u7684\u65b9\u6cd5\u3002\u4f60\u5728\u6c42 gcd \u7684\u65f6\u5019\u7528\u8fc7\uff0c\u4f46\u5176\u5b9e\u5b83\u7684\u4f5c\u7528\u4e0d\u6b62\u4e8e\u6c42 gcd \u8fd8\u6b63\u53ef\u4ee5\u7528\u6765\u6d88\u5143\uff01\u56e0\u4e3a\u6700\u540e\u4e00\u5b9a\u4f1a\u6709\u4e24\u6570\u4e2d\u7684\u4e00\u4e2a\u53d8\u6210\u4e86 0\uff0c\u628a\u8fd9\u4e2a 0 \u7ed9\u5230\u4e0a\u9762 $a[p][i]$ \u7684\u4f4d\u7f6e\uff0c\u5c31\u5b9e\u73b0\u4e86\u6d88\u5143\uff0c\u800c\u5728\u6b64\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e0d\u65ad\u5730\u8f97\u8f6c\u76f8\u51cf\u7b2c $i,p$ \u4e24\u884c\u7684\u6570\uff0c\u8fdb\u884c\u77e9\u9635\u521d\u7b49\u53d8\u6362\uff0c\u5e76\u9002\u65f6\u8c03\u6574 $\\det$ \u7684\u503c\u3002\u5177\u4f53\u89c1\uff1a\n\n```cpp\nfor(int i=1;i<=n;i++)\n    for(int j=i+1;j<=n;j++){\n        while(a[i][i]){\n            int d=a[j][i]/a[i][i];\n            for(int k=1;k<=n;k++)a[j][k]=(a[j][k]-1ll*d*a[i][k]%mod+mod)%mod;\n            swap(a[i],a[j]),det=-det;//\u4ea4\u6362\u4e24\u884c\uff0c\u6839\u636e\u89c4\u5f8b1\uff0cdet\u8981\u53d8\u6210\u76f8\u53cd\u6570\n        }\n        swap(a[i],a[j]),det=-det;\n    }\n```\n\n\u8fd9\u6837\u4e00\u6765\u6c42\u672c\u9898\u8981\u6c42\u7684\u751f\u6210\u6570\u4e2a\u6570\u5c31\u4e0d\u5728\u8bdd\u4e0b\u4e86\uff0c\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int mod=1e9+7;\nint n,ans,m[18],e[18][18],cnt[18];\npair<int,int>q[18][180];\nint sol(int s){\n\tmemset(e,0,sizeof(e));\n\tfor(int i=0;i<n-1;i++)if((s>>i)&1){\n\t\tfor(int j=1;j<=m[i];j++)\n\t\t\te[q[i][j].first][q[i][j].second]--,e[q[i][j].second][q[i][j].first]--,\n\t\t\te[q[i][j].first][q[i][j].first]++,e[q[i][j].second][q[i][j].second]++;\n\t}\n\tint det=1;\n\tfor(int i=1;i<n;i++)\n\t\tfor(int j=i+1;j<n;j++){\n\t\t\twhile(e[i][i]){\n\t\t\t\tint d=e[j][i]/e[i][i];\n\t\t\t\tfor(int k=1;k<n;k++)e[j][k]=(e[j][k]-1ll*d*e[i][k]%mod+mod)%mod;\n\t\t\t\tswap(e[i],e[j]),det=-det;\n\t\t\t}\n\t\t\tswap(e[i],e[j]),det=-det;\n\t\t}\n\tfor(int i=1;i<n;i++)det=1ll*det*e[i][i]%mod;\n\treturn (det+mod)%mod;\n}\nint main(){\n\tcin>>n;\n\tfor(int i=0;i<n-1;i++){\n\t\tcin>>m[i];\n\t\tfor(int j=1;j<=m[i];j++)cin>>q[i][j].first>>q[i][j].second;\n\t}\n\tfor(int i=0;i<(1<<(n-1));i++)(cnt[__builtin_popcount(i)]+=sol(i))%=mod;\n\tfor(int i=n-1,j=1;~i;i--,j=-j)ans=((ans+j*cnt[i]%mod)%mod+mod)%mod;//\u6ce8\u610f\u8fd9\u4e2a\u5730\u65b9\uff0c\u5361\u4e86\u6211\u597d\u4e45\uff0c\u4e00\u4e2a\u53d6\u6a21\u90fd\u4e0d\u80fd\u6389\uff01\n\tcout<<ans;\n}\n```\n\n",
        "postTime": 1640597204,
        "uid": 300078,
        "name": "pengyule",
        "ccfLevel": 7,
        "title": "[SHOI2016]\u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61"
    },
    {
        "content": "...\n\n\u672c\u6765\u4ee5\u4e3a\u662f\u9053\u77e9\u9635\u6811\u677f\u5b50\u9898\u3002\u3002\u3002\u4e0d\u8fc7\u4f9d\u65e7\u662f\u5927\u4f6c\u53cd\u624b\u5207\u7684\u9898...\n\nwoc \u4e3a\u4ec0\u4e48\uff0c\u5bb9\u65a5\uff1f\u6211\u8fd8\u662f\u840c\u65b0\u554a\uff01\n\n\n\u5176\u5b9e\u8fd9\u9053\u9898\u5c31\u662f\u5bb9\u65a5+\u77e9\u9635\u6811\u5b9a\u7406\uff08\u597d\u5427\u662f\u884c\u5217\u5f0f\u6c42\u89e3\uff09\n\n\u77e9\u9635\u6811\u5b9a\u7406\u4e0d\u4f1a\u7684\u51fa\u95e8\u5de6\u8f6c\n\uff0c\n\u5bb9\u65a5\u4e0d\u4f1a\u7684...emmm\n\n\n\u9996\u5148\u6211\u4eec\u8003\u8651\u8fd9\u9053\u9898\u7684\u6570\u636e\u8303\u56f4\u600e\u4e48\u8fd9\u4e48\u5c0f...\uff08\u597d\u5427\u4e0d\u9700\u8981\u8003\u8651\u7684\u8fd9\u79cd\u9898\u76ee n \u8303\u56f4\u4e0d\u4f1a\u5927\u7684\u9664\u975e\u662f\u538b\u4f4d\uff09\n\n\n\u90a3\u4e48\u5bb9\u65a5\u65b9\u6cd5\u5c31\u662f n \u4e2a\u516c\u53f8\u9020\u8def\u7684\u65b9\u6848\u6570 - (n-1\uff09\u4e2a\u516c\u53f8\u9020\u8def\u7684\u65b9\u6848\u6570 + (n-2) \u4e2a\u516c\u53f8\u9020\u8def\u7684\u65b9\u6848\u6570 - ....\n\n\u6bd4\u8f83\u663e\u7136\uff1f\n\n\u5176\u5b9e\u5c31\u662f\u8003\u8651 n \u4e2a\u516c\u53f8\u9020\u8def\uff08\u4e14\u6bcf\u4e2a\u516c\u53f8\u5404\u9020\u4e00\u6761\uff09\u7684\u65b9\u6848\u6570\u91cc\u9762\u591a\u51fa\u4e86 (n-1)\n\u4e2a\u516c\u53f8\u9020\u8def\uff08\u4e14\u6bcf\u4e2a\u516c\u53f8\u5404\u9020\u4e00\u6761\uff09\u7684\u65b9\u6848\u6570\uff0c\u4ee5\u53ca (n-2) \u4e2a\u516c\u53f8\u9020\u8def\uff08\u4e14\u6bcf\u4e2a\u516c\u53f8\u5404\u9020\u4e00\u6761\uff09\u7684\u65b9\u6848\u6570.....\n\n\u7136\u540e\u53ef\u4ee5\u5bb9\u65a5\n\n\u8fd9\u91cc\u53ef\u80fd\u8981\u591a\u60f3\u4f1a\u513f~~\uff08\u5927\u4f6c\u4e00\u4e0b\u5c31\u660e\u767d\u4e86\uff09~~\n\n\u5176\u5b9e\u5c31\u662f n-1 \u4e2a\u516c\u53f8\u53ef\u4ee5\u6709 n \u79cd\u9009\u7684\u65b9\u6848\uff08$C_n^1$\uff09\uff0c\u7136\u540e\u5b83\u4eec\u4e4b\u95f4\u6709\u91cd\u53e0\u7684 n-2 \u7684\u65b9\u6848\u6570\uff0c\u6240\u4ee5\u5c31\u8981\u5bb9\u65a5\u4e86\n\n```\n//by Judge\n#include<cstdio>\n#include<iostream>\n#define ll long long\nusing namespace std;\nconst int mod=1e9+7;\nconst int M=19;\n#ifndef Judge\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\n#endif\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline void ADD(ll& a,ll b){a+=a+b>=mod?b-mod:b;}\ninline int read(){ int x=0,f=1; char c=getchar();\n\tfor(;!isdigit(c);c=getchar()) if(c=='-') f=-1;\n\tfor(;isdigit(c);c=getchar()) x=x*10+c-'0'; return x*f;\n} int n,up,siz[262143],m[M],u[M][M*M],v[M][M*M]; ll res,A[M][M];\ninline ll qpow(ll x,ll p){ ll s=1;\n\tfor(;p;p>>=1,x=x*x%mod)\n\t\tif(p&1) s=s*x%mod; return s;\n}\ninline ll det(){ ll res=1,tr=1;\n\tfor(int i=1,j;i<n;++i){\n\t\tfor(j=i;j<n&&!A[j][i];++j);\n\t\tif(j==n) return 0; res=res*A[j][i]%mod;\n\t\tif(i^j) swap(A[i],A[j]),tr=-tr;\n\t\tll inv=qpow(A[i][i],mod-2);\n\t\tfor(j=i+1;j<n;++j) A[i][j]=A[i][j]*inv%mod;\n\t\tfor(j=i+1;j<n;++j) if(A[j][i])\n\t\t\tfor(int k=i+1;k<=n;++k)\n\t\t\t\tADD(A[j][k],mod-A[j][i]*A[i][k]%mod);\n\t} return (res*tr+mod)%mod;\n}\nint main(){ n=read(),up=(1<<n-1)-1;\n\tfor(int i=1,j;i<n;++i)\n\t\tfor(m[i]=read(),j=1;j<=m[i];++j)\n\t\t\tu[i][j]=read(),v[i][j]=read();\n\tfor(int i=1;i<=up;++i)\n\t\tsiz[i]=siz[i>>1]+(i&1);\n\tfor(int i=1;i<=up;++i){\n\t\tfor(int j=1;j<=n;++j)\n\t\t\tfor(int k=1;k<=n;++k) A[j][k]=0;\n\t\tfor(int j=1,p=i;p;p>>=1,++j)\n\t\t\tif(p&1) for(int k=1;k<=m[j];++k){\n\t\t\t\tint x=u[j][k],y=v[j][k];\n\t\t\t\t++A[x][x],++A[y][y];\n\t\t\t\tADD(A[x][y],mod-1);\n\t\t\t\tADD(A[y][x],mod-1);\n\t\t\t} res=(res+mod+(n-siz[i]&1?det():-det()))%mod;\n\t} return !printf(\"%lld\\n\",res);\n}\n```\n---\n\n\u7136\u540e\u5176\u5b9e\u884c\u5217\u5f0f\u6c42\u89e3\u7684\u65b9\u6cd5\u5f88\u591a\u7684\uff0c\u8fd9\u91cc\u7684\u662f\u6bd4\u8f83\u5feb\u7684\u4e00\u79cd\u65b9\u5f0f\uff08\u5316\u4e3a\u4e0a\u4e09\u89d2\u77e9\u9635\uff09\n\n\n\n",
        "postTime": 1551958890,
        "uid": 38576,
        "name": "J\u03bcdge",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4336 \u3010[SHOI2016]\u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61\u3011"
    },
    {
        "content": "\u524d\u7f6e\u829d\u58eb\uff1a[\u5bb9\u65a5\u539f\u7406](https://oi-wiki.org/math/combinatorics/inclusion-exclusion-principle/)\u3001[\u77e9\u9635\u6811\u5b9a\u7406](https://oi-wiki.org/graph/matrix-tree/)\n\n\u76f4\u63a5\u8ba9\u751f\u6210\u6811\u4e0a\u6bcf\u6761\u8fb9\u5206\u522b\u7531\u4e0d\u540c\u7684\u5efa\u7b51\u516c\u53f8\u5efa\u9020\u8f83\u4e3a\u56f0\u96be\uff0c\u8003\u8651\u5bb9\u65a5\u3002\n\n\u663e\u7136\u6211\u4eec\u8981\u6c42\u7684\u662f\u6709**\u6070\u597d** $0$ \u4e2a\u5efa\u7b51\u516c\u53f8\u6ca1\u6709\u53c2\u4e0e\u8fb9\u7684\u8d21\u732e\u7684\u65b9\u6848\u6570\uff0c\u8bbe $f_i$ \u8868\u793a\u6709**\u81f3\u5c11** $i$ \u4e2a\u5efa\u7b51\u516c\u53f8\u6ca1\u6709\u53c2\u4e0e\u8fb9\u7684\u8d21\u732e\u7684\u65b9\u6848\u6570\uff0c\u5219\u7b54\u6848\u4e3a $\\displaystyle\\sum_{i = 0}^{n - 1} (-1)^i f_i$\u3002\n\n\u663e\u7136\u5bf9\u4e8e $f_i$\uff0c\u6211\u4eec\u53ea\u9700\u8981\u679a\u4e3e $popcount(j) = n - i - 1$ \u5e76\u901a\u8fc7\u77e9\u9635\u6811\u5b9a\u7406\u8ba1\u7b97\u51fa\u53ea\u5305\u542b $j$ \u96c6\u5408\u4e2d\u7684\u5efa\u7b51\u516c\u53f8\u7684\u8fb9\u7684\u65b9\u6848\u6570\uff0c\u7136\u540e\u5c06\u65b9\u6848\u6570\u6c42\u548c\u5f97\u5230 $f_i$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(2^{n - 1}(\\sum m_i + n^3))$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <iostream>\n#include <cstring>\n\nusing namespace std;\n\ntypedef long long ll;\n\ntypedef struct Matrix_tag {\n\tint n;\n\tll a[17][17];\n\tMatrix_tag(){\n\t\tmemset(a, 0, sizeof(a));\n\t}\n} Matrix;\n\nconst int mod = 1e9 + 7;\nint m[17], u[17][137], v[17][137];\nll val[65537];\n\ninline ll quick_pow(ll x, ll p, ll mod){\n\tll ans = 1;\n\twhile (p){\n\t\tif (p & 1) ans = ans * x % mod;\n\t\tx = x * x % mod;\n\t\tp >>= 1;\n\t}\n\treturn ans;\n}\n\ninline ll det(Matrix &a, int pos, int mod){\n\tll ans = 1;\n\tfor (register int i = 1; i <= a.n; i++){\n\t\tif (i == pos) continue;\n\t\tif (a.a[i][i] == 0){\n\t\t\tint t = i;\n\t\t\tfor (register int j = i + 1; j <= a.n; j++){\n\t\t\t\tif (j == pos) continue;\n\t\t\t\tif (a.a[j][i] != 0){\n\t\t\t\t\tt = j;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (i == t) return 0;\n\t\t\tans = (mod - ans) % mod;\n\t\t\tswap(a.a[i], a.a[t]);\n\t\t}\n\t\tll cur_inv = quick_pow(a.a[i][i], mod - 2, mod);\n\t\tans = ans * a.a[i][i] % mod;\n\t\tfor (register int j = i + 1; j <= a.n; j++){\n\t\t\tif (j == pos) continue;\n\t\t\tll t = cur_inv * a.a[j][i] % mod;\n\t\t\tfor (register int k = i; k <= a.n; k++){\n\t\t\t\ta.a[j][k] = ((a.a[j][k] - t * a.a[i][k] % mod) % mod + mod) % mod;\n\t\t\t}\n\t\t}\n\t}\n\treturn ans;\n}\n\nint main(){\n\tint n, k;\n\tll ans = 0;\n\tcin >> n;\n\tk = (1 << (n - 1)) - 1;\n\tfor (register int i = 1; i < n; i++){\n\t\tcin >> m[i];\n\t\tfor (register int j = 1; j <= m[i]; j++){\n\t\t\tcin >> u[i][j] >> v[i][j];\n\t\t}\n\t}\n\tfor (register int i = 0; i <= k; i++){\n\t\tMatrix a;\n\t\ta.n = n;\n\t\tfor (register int j = 1; j < n; j++){\n\t\t\tif (i >> (j - 1) & 1){\n\t\t\t\tfor (register int x = 1; x <= m[j]; x++){\n\t\t\t\t\ta.a[u[j][x]][u[j][x]] = (a.a[u[j][x]][u[j][x]] + 1) % mod;\n\t\t\t\t\ta.a[v[j][x]][v[j][x]] = (a.a[v[j][x]][v[j][x]] + 1) % mod;\n\t\t\t\t\ta.a[u[j][x]][v[j][x]] = ((a.a[u[j][x]][v[j][x]] - 1) % mod + mod) % mod;\n\t\t\t\t\ta.a[v[j][x]][u[j][x]] = ((a.a[v[j][x]][u[j][x]] - 1) % mod + mod) % mod;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tval[i] = det(a, 1, mod);\n\t}\n\tfor (register int i = 0; i < n; i++){\n\t\tint t = n - i - 1;\n\t\tll sum = 0;\n\t\tfor (register int j = 0; j <= k; j++){\n\t\t\tif (__builtin_popcount(j) == t) sum = (sum + val[j]) % mod;\n\t\t}\n\t\tans = ((ans + (i % 2 == 0 ? 1 : -1) * sum % mod) % mod + mod) % mod;\n\t}\n\tcout << ans;\n\treturn 0;\n}\n```",
        "postTime": 1647599660,
        "uid": 201007,
        "name": "Leasier",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4336 \u3010[SHOI2016] \u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61\u3011"
    },
    {
        "content": "\u77e9\u9635\u6811\u5b9a\u7406\u677f\u5b50\uff08\n\n### \u9898\u610f\n\n> \u7ed9\u4f60 $n$\uff0c\u6709 $n-1$ \u7ec4\u8fb9\uff0c\u6bcf\u7ec4\u8fb9\u4e2d\u9009\u4e00\u4e2a\uff0c\u6c42\u5c06 $n$ \u4e2a\u70b9\u521a\u597d\u8fde\u901a\u7684\u65b9\u6848\u6570\u3002$2\\le n\\le 17$\u3002\n\n### \u9898\u89e3\n\n\u5bb9\u65a5\uff0c\u94a6\u5b9a\u4e00\u4e2a\u8fb9\u7ec4\u7684\u5b50\u96c6 $S$ \u8868\u793a\u8fb9\u53ea\u80fd\u5728\u8fd9\u4e2a\u5b50\u96c6\u91cc\u9009\uff08\u53ef\u4ee5\u5728\u4e00\u4e2a\u7ec4\u91cd\u590d\u9009\uff09\uff0c\u90a3\u4e48\u5bb9\u65a5\u7cfb\u6570\u662f $(-1)^{n-1-|S|}$\u3002\n\n\u56e0\u4e3a\u521a\u597d\u6709 $n-1$ \u4e2a\u7ec4\uff0c\u6240\u4ee5\u53ef\u4e0d\u53ef\u4ee5\u5728\u4e00\u4e2a\u7ec4\u91cd\u590d\u9009\u5bf9\u6700\u7ec8\u7b54\u6848\u6ca1\u6709\u5f71\u54cd\u3002\n\n\u65b9\u6848\u6570\u5c31\u662f\u5c06\u8fd9\u4e9b\u7ec4\u7684\u8fb9\u5168\u90e8\u8fde\u8d77\u6765\u4e4b\u540e\u7684\u751f\u6210\u6811\u4e2a\u6570\uff0c\u90a3\u4e48\u53ef\u4ee5\u4f7f\u7528\u77e9\u9635\u6811\u5b9a\u7406\u6c42\u4e00\u4e2a\u56fe\u7684\u751f\u6210\u6811\u4e2a\u6570\u3002\n\n\u91cd\u8fb9\u76f4\u63a5\u52a0\uff0c\u4e0d\u7528\u53bb\u91cd\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(2^nn^3)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nconst ll mod=1e9+7;\nint n;\nvector<pair<int,int> >edge[20];\nll a[20][20];\nll power(ll a,ll p){\n\tll res=1;\n\twhile(p){\n\t\tif(p&1)res=res*a%mod;\n\t\tp>>=1;\n\t\ta=a*a%mod;\n\t}\n\treturn res;\n}\nll gauss(){\n\tll res=1;\n\tfor(int i=1;i<n;i++){\n\t\tint p=0;\n\t\tfor(int j=i;j<n;j++)if(a[j][i]){p=j;break;}\n\t\tif(!p)return 0;\n\t\tif(p!=i)res=(mod-res)%mod;\n\t\tfor(int j=i;j<n;j++)swap(a[i][j],a[p][j]);\n\t\tll val=power(a[i][i],mod-2);\n\t\tres=res*a[i][i]%mod;\n\t\tfor(int j=i;j<n;j++)a[i][j]=a[i][j]*val%mod;\n\t\tfor(int j=i+1;j<n;j++){\n\t\t\tval=a[j][i];\n\t\t\tfor(int k=i;k<n;k++)a[j][k]=(a[j][k]-val*a[i][k]%mod+mod)%mod;\n\t\t}\n\treturn res;\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<n;i++){\n\t\tint k;scanf(\"%d\",&k);\n\t\twhile(k--){\n\t\t\tint x,y;scanf(\"%d%d\",&x,&y);\n\t\t\tedge[i].push_back(make_pair(x,y));\n\t\t}\n\t}\n\tll ans=0;\n\tfor(int i=1;i<(1<<n-1);i++){\n\t\tmemset(a,0,sizeof(a));\n\t\tint cnt=0;\n\t\tfor(int j=1;j<n;j++)\n\t\t\tif(i&(1<<j-1))\n\t\t\t\tfor(auto e:edge[j])a[e.first][e.first]++,a[e.second][e.second]++,a[e.first][e.second]--,a[e.second][e.first]--;\n\t\t\telse cnt++;\n\t\tfor(int i=1;i<=n;i++)for(int j=1;j<=n;j++)a[i][j]=(a[i][j]%mod+mod)%mod;\n\t\tif(cnt&1)ans=(ans-gauss()+mod)%mod;\n\t\telse ans=(ans+gauss())%mod;\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1655468302,
        "uid": 233462,
        "name": "Umbrella_Leaf",
        "ccfLevel": 8,
        "title": "\u9898\u89e3P4336 [SHOI2016]\u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61"
    },
    {
        "content": "\u5bb9\u65a5\u52a0\u77e9\u9635\u6811\u597d\u9898\u3002\n\n## \u9898\u76ee\u5927\u610f\n\u7ed9\u5b9a\u4e00\u5f20 $n$ \u4e2a\u8282\u70b9\u7684\u56fe\uff0c\u548c $n-1$ \u79cd\u8fb9\uff0c\u6bcf\u79cd\u8fb9\u7684\u6570\u91cf $m_i\\le \\dfrac{n(n-1)}2$\uff0c\u8bf7\u6c42\u51fa\u539f\u56fe\u5305\u542b\u6bcf\u79cd\u8fb9\u6070\u597d\u4e00\u6b21\u7684\u751f\u6210\u6811\u7684\u4e2a\u6570\uff0c\u7b54\u6848\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n## \u5927\u4f53\u601d\u8def\n\u9996\u5148\uff0c\u770b\u5230\u751f\u6210\u6811\uff0c\u8003\u8651\u4f7f\u7528\u77e9\u9635\u6811\u5b9a\u7406\uff0c\u8fd9\u4e5f\u662f\u672c\u9898\u7684\u524d\u7f6e\u77e5\u8bc6\u3002\n\nMatrix-Tree \u5b9a\u7406\u662f\u89e3\u51b3\u751f\u6210\u6811\u8ba1\u6570\u95ee\u9898\u6700\u6709\u529b\u7684\u6b66\u5668\u4e4b\u4e00\u3002\u5b83\u9996\u5148\u4e8e $1847$ \u5e74\u88ab\u57fa\u5c14\u970d\u592b\u8bc1\u660e\u3002\u4e0b\u9762\u5b9a\u4e49\u4e24\u79cd\u77e9\u9635\uff1a\n\n1. $G$ \u7684\u5ea6\u6570\u77e9\u9635 $D_G$ \u662f\u4e00\u4e2a $n\\times n$ \u7684\u77e9\u9635\uff0c\u5e76\u4e14\u6ee1\u8db3\uff1a\u5f53 $i\u2260j$ \u65f6, $d_{i,j}=0$\uff1b\u5f53 $i=j$ \u65f6\uff0c$d_{i,j}$ \u7b49\u4e8e $i$ \u7684\u5ea6\u6570\u3002\n\n2. $G$ \u7684\u90bb\u63a5\u77e9\u9635 $A_G$ \u4e5f\u662f\u4e00\u4e2a $n\\times n$ \u7684\u77e9\u9635\uff0c \u5e76\u4e14\u6ee1\u8db3\uff1a\u5982\u679c $i, j$ \u4e4b\u95f4\u6709\u8fb9\u76f4\u63a5\u76f8\u8fde\uff0c\u5219 $a_{i,j}=1$\uff0c\u5426\u5219\u4e3a $0$\u3002**\u6ce8\u610f\uff0c\u5bf9\u4e8e $i=j$ \u7684\u60c5\u51b5\uff0c\u662f\u4e3a\u4e24\u8005\u4e4b\u95f4\u6ca1\u6709\u8fb9\uff0c\u5373 $a_{i, i}=0$\u3002**\n\n\u6211\u4eec\u5b9a\u4e49 $G$ \u7684\u57fa\u5c14\u970d\u592b\u77e9\u9635 $C_G=D_G-A_G$\uff0c\u5219 Matrix-Tree \u5b9a\u7406\u53ef\u4ee5\u63cf\u8ff0\u4e3a\uff1a$G$ \u7684\u6240\u6709\u4e0d\u540c\u7684\u751f\u6210\u6811\u7684\u4e2a\u6570\u7b49\u4e8e\u5176\u57fa\u5c14\u970d\u592b\u77e9\u9635\u4efb\u4f55\u4e00\u4e2a $n-1$ \u9636\u4e3b\u5b50\u5f0f\u7684\u884c\u5217\u5f0f\u7684\u7edd\u5bf9\u503c\u3002($n-1$ \u9636\u4e3b\u5b50\u5f0f\u5c31\u662f\u5bf9\u4e8e $r\\in [1, n]$\uff0c\u5c06 $C_G$ \u7684\u7b2c $r$ \u884c\u3001\u7b2c $r$ \u5217\u540c\u65f6\u53bb\u6389\u540e\u5f97\u5230\u7684\u65b0\u77e9\u9635\uff0c\u7528 $C_{rG}$ \u8868\u793a\uff09\u3002\u8fd9\u4e00\u7ed3\u8bba\u53ef\u4ee5\u5229\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u8bc1\u660e\uff0c\u8be6\u7ec6\u8bf7\u89c1 $2007$ \u5e74\u56fd\u5bb6\u96c6\u8bad\u961f\u8bba\u6587\u300a\u751f\u6210\u6811\u7684\u8ba1\u6570\u53ca\u5176\u5e94\u7528\u300b\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6839\u636e\u8981\u6c42\u6c42\u51fa\u539f\u56fe\u7684\u57fa\u5c14\u970d\u592b\u77e9\u9635\uff0c\u5e76\u4f7f\u7528\u7c7b\u4f3c\u9ad8\u65af\u6d88\u5143\u7684\u65b9\u6cd5\u5bf9 [\u884c\u5217\u5f0f\u6c42\u503c](https://www.luogu.com.cn/problem/P7112) \u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u7ea6\u4e3a $\\Theta(n^3)$\uff0c\u8f97\u8f6c\u76f8\u9664\u53ef\u80fd\u4f1a\u4ea7\u751f\u4e00\u4e2a $\\log n$\u3002\n\n\u56de\u5230\u672c\u9898\u3002\u6211\u4eec\u77e5\u9053\u4e86\u5982\u4f55\u6c42\u89e3\u4e00\u4e2a\u56fe\u7684\u751f\u6210\u6811\u3002\u90a3\u4e48\uff0c\u6839\u636e\u5bb9\u65a5\uff0c\u8bbe $T_i$ \u8868\u793a\u81f3\u5c11 $i$ \u79cd\u8fb9\u4e0d\u9009\u7684\u751f\u6210\u6811\u7684\u6570\u91cf\uff0c\u56e0\u6b64\u7b54\u6848\u5373\u4e3a \n$$\\sum_{i=0}^{n-1}(-1)^i\\cdot T_i$$\n\u5177\u4f53\u8ba1\u7b97\u65f6\uff0c\u53ef\u4ee5\u7528\u4e00\u4e2a $n-1$ \u4f4d\u4e8c\u8fdb\u5236\u6570\u679a\u4e3e\u6bcf\u79cd\u8fb9\u9009\u6216\u4e0d\u9009\uff0c\u7528\u77e9\u9635\u6811\u5b9a\u7406\u7b97\u51fa\u8fd9\u79cd\u60c5\u51b5\u4e0b\u751f\u6210\u6811\u7684\u4e2a\u6570\uff0c\u5e76\u6839\u636e\u5bb9\u65a5\uff0c\u4f9d\u636e\u4e8c\u8fdb\u5236\u6570 $1$ \u7684\u4e2a\u6570\uff08\u53ef\u9012\u63a8\u8ba1\u7b97\uff09\u52a0\u4e0a\u6216\u51cf\u53bb\u76f8\u5e94\u7684\u8d21\u732e\u5373\u53ef\u3002\n\n\u8bb0 $N=n-1$\uff0c\u5355\u6b21\u77e9\u9635\u6811\u5b9a\u7406\u7684\u590d\u6742\u5ea6\u4e3a $\\Theta\\left(N^3\\right)$\uff0c\u679a\u4e3e\u72b6\u6001\u7684\u590d\u6742\u5ea6\u4e3a $O(2^{N})$\uff0c\u603b\u590d\u6742\u5ea6\u4e3a $O(2^{N}N^3)$\uff0c\u5728 $N\\le 16$ \u65f6\u8ba1\u7b97\u6b21\u6570\u4e0a\u9650\u4e3a $O(2.7\\times 10^8)$\uff0c\u6d88\u5143\u7684\u5b9e\u9645\u6548\u7387\u66f4\u5feb\u53ef\u8fc7\u3002\u6ce8\u610f\u6bcf\u6b21\u6e05\u7a7a\u57fa\u5c14\u970d\u592b\u77e9\u9635\u3002\n\n## \u5b8c\u6574\u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define rep(ii,aa,bb) for(re int ii = aa; ii <= bb; ii++)\n#define Rep(ii,aa,bb) for(re int ii = aa; ii >= bb; ii--)\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef double db;\ntypedef pair<int, int> PII;\nconst int maxn = 20, mod = 1e9 + 7;\nnamespace IO_ReadWrite {\n\t#define re register\n\t#define gg (p1 == p2 && (p2 = (p1 = _buf) + fread(_buf, 1, 1<<21, stdin), p1 == p2) ? EOF :*p1++)\n\tchar _buf[1<<21], *p1 = _buf, *p2 = _buf;\n\ttemplate <typename T>\n\tinline void read(T &x){\n\t\tx = 0; re T f=1; re char c = gg;\n\t\twhile(c > 57 || c < 48){if(c == '-') f = -1;c = gg;}\n\t\twhile(c >= 48 &&c <= 57){x = (x<<1) + (x<<3) + (c^48);c = gg;}\n\t\tx *= f;return;\n\t}\n\tinline void ReadChar(char &c){\n\t\tc = gg;\n\t\twhile(!isalpha(c)) c = gg;\n\t}\n\ttemplate <typename T>\n\tinline void write(T x){\n\t\tif(x < 0) putchar('-'), x = -x;\n\t\tif(x > 9) write(x/10);\n\t\tputchar('0' + x % 10);\n\t}\n\ttemplate <typename T>\n\tinline void writeln(T x){write(x); putchar('\\n');}\n}\nusing namespace IO_ReadWrite;\nll n, a[maxn][maxn], m[maxn], ans;\nPII e[maxn][maxn * maxn];\nint cnt[1 << 17];\ninline ll Guass() {\n\tll res = 1, w = 1;\n\trep(i, 2, n)\n\t\trep(j, i + 1, n) {\n\t\t\twhile(a[i][i]) {\n\t\t\t\tll factor = a[j][i] / a[i][i];\n\t\t\t\trep(k, i, n)\n\t\t\t\t\ta[j][k] = (a[j][k] - factor * a[i][k] % mod + mod) % mod;\n\t\t\t\tswap(a[i], a[j]), w = -w;\n\t\t\t}\n\t\t\tswap(a[i], a[j]), w = -w;\n\t\t}\n\trep(i, 2, n) (res *= a[i][i]) %= mod;\n\treturn (res * w + mod) % mod;\n}\nint main () {\n\tread(n);\n\trep(i, 1, n - 1) {\n\t\tread(m[i]);\n\t\trep(j, 1, m[i]) read(e[i][j].first), read(e[i][j].second);\n\t}\n\tfor(int S = 1; S < (1 << (n - 1)); S ++) \n\t\tcnt[S] = cnt[S >> 1] + (S & 1);\n\tfor(int S = 1; S < (1 << (n - 1)); S ++) {\n\t\tint dlt = n-1 - cnt[S]; // \u5076\u6570\uff0b\uff0c\u5947\u6570-\n\t\trep(i, 1, n) rep(j, 1, n) a[i][j] = 0;\n\t\trep(i, 1, n - 1) if((S >> (i - 1)) & 1){\n\t\t\trep(j, 1, m[i]) {\n\t\t\t\tint u = e[i][j].first, v = e[i][j].second;\n\t\t\t\ta[u][u] ++, a[v][v] ++;\n\t\t\t\ta[u][v] --, a[v][u] --;\n\t\t\t}\n\t\t}\n\t\tans += Guass() * ((dlt & 1) ? -1 : 1);\n\t\tans = (ans + mod) % mod;\n\t}\n\twriteln(ans);\n\treturn 0;\n}\n```",
        "postTime": 1646742585,
        "uid": 279197,
        "name": "Mars_Dingdang",
        "ccfLevel": 6,
        "title": "P4336 [SHOI2016] \u9ed1\u591c\u524d\u7684\u5e7b\u60f3\u4e61"
    },
    {
        "content": "\u5c11\u6709\u7684\u81ea\u5df1\u9010\u6e10\u53d1\u73b0\u4e86\u5bb9\u65a5\u601d\u8def\u7684\u9898\u2026\u2026\n\n\u9898\u76ee\u5927\u610f\uff1a\u8981\u6c42\u539f\u65e0\u5411\u56fe\u7684\u751f\u6210\u6811\u4e2a\u6570\uff0c\u6ee1\u8db3\u6bcf\u6761\u8fb9\u88ab\u5efa\u7acb\u7684\u516c\u53f8\u4e0d\u540c\u3002\n\n$\\text{Solution:}$\n\n\u89c2\u5bdf\u5230\u4e86\u6211\u4eec\u6709 $n-1$ \u4e2a\u516c\u53f8\uff0c\u6240\u4ee5\u5728\u9898\u76ee\u7684\u9650\u5236\u4e0b\uff0c\u6ee1\u8db3\u6761\u4ef6\u7684\u751f\u6210\u6811\u6070\u597d\u6240\u6709\u516c\u53f8\u90fd\u53c2\u4e0e\u3002\u6240\u4ee5\u6211\u4eec\u4e0d\u9700\u8981\u8003\u8651\u6bcf\u6761\u8fb9\u4e86\uff0c\u76f4\u63a5\u8003\u8651\uff1a\u5bf9\u5f53\u524d\u60c5\u51b5\u4e0b **\u6709 $x$ \u4e2a\u516c\u53f8\u53c2\u4e0e\u7684\u751f\u6210\u6811\u4e2a\u6570** \u3002\u8fd9\u6837\u53ea\u8981\u6211\u4eec\u6c42\u51fa\u5bf9\u5e94 $n-1$ \u60c5\u51b5\u4e0b\u7684\u7b54\u6848\uff0c\u90a3\u5b83\u76f4\u63a5\u5c31\u662f\u7b54\u6848\u4e86\u3002\n\n\u90a3\u4e48\u56de\u5230\u539f\u6765\u7684\u95ee\u9898\uff0c\u4e3a\u4ec0\u4e48\u76f4\u63a5\u5ffd\u7565\u516c\u53f8\u5bf9\u539f\u56fe\u8dd1 Matrix-Tree \u5b9a\u7406\u4e0d\u5bf9\u5462\uff1f\u8fd9\u6837\u7684\u7b54\u6848\u4e2d **\u5305\u542b\u4e86\u8bb8\u591a $n-1$ \u4e2a\u516c\u53f8\u4e2d\u7684\u5b50\u96c6\u3002** \u90a3\u4e48\u601d\u8def\u5c31\u53d8\u6210\u4e86\uff1a\u5982\u4f55\u628a\u8fd9\u4e9b\u4e0d\u5408\u6cd5\u7684\u5b50\u96c6\u53bb\u6389\u5462\uff1f\u7ed3\u5408 $n\\leq 17$ \u7684\u6570\u636e\u8303\u56f4\u4e5f\u5c31\u81ea\u7136\u60f3\u5230\u4e86\u72b6\u538b\u679a\u4e3e\u5b50\u96c6\u7684\u5bb9\u65a5\u601d\u8def\u3002\n\n\u4ed4\u7ec6\u601d\u8003\u4e00\u4e0b\uff0c\u6211\u4eec\u60f3\u8981\u679a\u4e3e\u4e00\u4e9b\u516c\u53f8\u4f7f\u5f97\u5b83\u4eec **\u6bcf\u4e00\u4e2a** \u90fd\u8981\u53c2\u4e0e\u5230\u751f\u6210\u6811\u4e2d\u3002\u4f46\u5b9e\u9645\u4e0a\u8fd9\u4e2a\u95ee\u9898\u4e5f\u662f\u56f0\u96be\u7684\uff0c\u90a3\u4e0d\u59a8\u5148\u6401\u7f6e\u4e00\u4e0b\uff0c\u6765\u60f3\u4e00\u60f3\u5bb9\u65a5\u7684\u60f3\u6cd5\uff1a\n\n\u663e\u7136\u6211\u4eec\u53ef\u4ee5\u7528\u603b\u7684\u51cf\u53bb\u7b97\u91cd\u7684\uff1a\u679a\u4e3e\u53c2\u52a0\u4e86\u591a\u5c11\u516c\u53f8\uff0c\u5219\uff1a\n\n$$\nAns=\\sum_{n-1}f_i-\\sum_{n-2}f_i+\\sum_{n-3}f_i...\n$$\n\n\u5bb9\u65a5\u7cfb\u6570\u5c31\u548c\u679a\u4e3e\u5230\u7684\u516c\u53f8\u6570\u5947\u5076\u6027\u6709\u5173\u7cfb\u3002\n\n\u90a3\u4e48\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u662f\u5bf9\u4e8e\u5f3a\u5236\u4e86\u591a\u5c11\u516c\u53f8\u90fd\u53c2\u4e0e\u7684\u60c5\u51b5\u4e0b\u6210\u7acb\u7684\uff0c\u521a\u521a\u6211\u4eec\u8bf4\u5373\u4f7f\u8fd9\u6837\u7b97\uff0c\u7b97\u5230\u7684\u7ed3\u679c\u4e5f\u5305\u542b\u4e86\u5bf9\u5e94\u8fd9\u4e9b\u516c\u53f8\u7684\u5b50\u96c6\u3002\u90a3\u4e48\u600e\u4e48\u7b97\u5462\uff1f\n\n\u5176\u5b9e\u6309\u7167\u4e0a\u9762\u8fd9\u4e2a\u5f0f\u5b50\u4e0a\u53bb\u7b97\u4e5f\u662f\u5bf9\u7684\uff0c\u56e0\u4e3a\u5728\u6bcf\u4e00\u6b65\u52a0\u51cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6bd4\u5f53\u524d\u679a\u4e3e\u5230\u7684\u66f4\u5c0f\u7684\u5b50\u96c6\u90fd\u88ab\u62b5\u6d88\u6389\u4e86\uff0c\u4e0d\u7406\u89e3\u7684\u8bdd\u53ef\u4ee5\u624b\u63a8\u4e00\u4e0b\uff0c\u7531\u4e8e\u6070\u597d\u62b5\u6d88\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u8fd9\u6837\u679a\u4e3e\u5bb9\u65a5\u5c31\u662f\u5bf9\u7684\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u5957\u7528\u77e9\u9635\u6811\u5b9a\u7406\u4e86\u3002\u6ce8\u610f\u5230\u6709\u91cd\u8fb9\u7684\u60c5\u51b5\uff0c\u7531\u4e8e\u8fd9\u79cd\u91cd\u8fb9\u4e00\u5b9a\u6765\u81ea\u4e8e\u4e24\u4e2a\u4e0d\u540c\u7684\u516c\u53f8\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u628a\u5b83\u5220\u6389\uff0c\u76f4\u63a5\u52a0\u8fdb\u53bb\u5c31\u662f\u5bf9\u7684\u3002\n\n\u987a\u4fbf\u518d\u63d0\u4e00\u53e5\u77e9\u9635\u6811\u5b9a\u7406\uff1a\u57fa\u5c14\u970d\u592b\u77e9\u9635\u662f\u7528 **\u5ea6\u6570\u77e9\u9635** \u51cf\u53bb **\u90bb\u63a5\u77e9\u9635**\uff0c\u6c42\u51fa\u7684\u7ed3\u679c\u662f\uff1a\u6240\u6709\u751f\u6210\u6811\u8fb9\u6743\u4e4b\u79ef\u7684\u548c\u3002\n\n\u90a3\u4e48\u6c42\u65b9\u6848\u6570\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u4ee4\u4e58\u79ef\u4e3a $1\\to$ \u4ee4\u8fb9\u6743\u4e3a $1$ \u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $O(2^n\\cdot n^3),$ \u8dd1\u7684\u8fd8\u662f\u86ee\u5feb\u7684\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int mod=1e9+7;\nconst int N=20;\ninline int Add(int x,int y){return (x+y)%mod;}\ninline int Mul(int x,int y){return 1ll*x*y%mod;}\ninline int Dec(int x,int y){return (x-y+mod)%mod;}\ninline int Max(int x,int y){return x>y?x:y;}\ninline int Min(int x,int y){return x<y?x:y;}\ninline int Abs(int x){if(x<0)x=-x;return x;}\ninline int qpow(int x,int y){\n    int res=1;\n    while(y){\n        if(y&1)res=Mul(res,x);\n        x=Mul(x,x);y>>=1;\n    }\n    return res;\n}\ninline int getinv(int x){return qpow(x,mod-2);}\ninline int read(){\n    int s=0;\n    char ch=getchar();\n    while(!isdigit(ch))ch=getchar();\n    while(isdigit(ch)){\n        s=s*10+ch-'0';\n        ch=getchar();\n    }\n    return s;\n}\ntypedef pair<int,int> pr;\n#define fi first\n#define se second\n#define mp make_pair\nint n,m[N];\nvector<pr>edge[N];\nstruct Matrix{\n    int a[N][N];\n    Matrix(){memset(a,0,sizeof a);}\n    int MatrixTree(int L){\n        int res=1;\n        for(int i=L;i<=n;++i){\n            int pos=i;\n            for(int j=i+1;j<=n;++j)\n                if(a[pos][i]<a[j][i])\n                    pos=j;\n            if(i!=pos)res=Mul(res,mod-1),swap(a[i],a[pos]);\n            int div=getinv(a[i][i]);\n            res=Mul(res,a[i][i]);\n            for(int j=i;j<=n;++j)a[i][j]=Mul(a[i][j],div);\n            for(int j=i+1;j<=n;++j){\n                div=a[j][i];\n                for(int k=i;k<=n;++k)a[j][k]=Dec(a[j][k],Mul(div,a[i][k]));\n            }\n        }\n        for(int i=L;i<=n;++i)res=Mul(res,a[i][i]);\n        return res;\n    }\n};\nint f[1<<N];\nMatrix GetMatrix(int state){\n    Matrix A;\n    for(int i=0;i<n-1;++i){\n        if(!(state>>i&1))continue;\n        for(auto j:edge[i]){\n            int u=j.fi;\n            int v=j.se;\n            A.a[u][u]=Add(A.a[u][u],1);\n            A.a[v][v]=Add(A.a[v][v],1);\n            A.a[u][v]=Dec(A.a[u][v],1);\n            A.a[v][u]=Dec(A.a[v][u],1);\n        }\n    }\n    return A;\n}\ninline int lowbit(int x){return x&(-x);}\ninline int popcount(int x){\n    int res=0;\n    while(x){\n        res++;\n        x-=lowbit(x);\n    }\n    return res;\n}\nint sum[N],Ans;\nint main(){\n    n=read();\n    for(int i=0;i<n-1;++i){\n        m[i]=read();\n        for(int j=0;j<m[i];++j){\n            int u=read(),v=read();\n            edge[i].push_back(mp(u,v));\n        }\n    }\n    for(int i=0;i<(1<<(n-1));++i){\n        Matrix A=GetMatrix(i);\n        f[i]=A.MatrixTree(2);\n    }\n    for(int i=0;i<(1<<(n-1));++i){\n        int num=popcount(i);\n        sum[num]=Add(sum[num],f[i]);\n    }\n    int opt=(n-1)&1;\n    for(int i=n-1;i>=1;--i){\n        int op=i&1;\n        if(op==opt)Ans=Add(Ans,sum[i]);\n        else Ans=Dec(Ans,sum[i]);\n    }\n    printf(\"%d\\n\",Ans);\n    return 0;\n}\n```\n",
        "postTime": 1629437874,
        "uid": 128591,
        "name": "Refined_heart",
        "ccfLevel": 9,
        "title": "P4336 [SHOI2016]\u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61 \u9898\u89e3"
    },
    {
        "content": "## \u9898\u89e3\n\n**\u524d\u7f6e\u829d\u58eb** :\u77e9\u9635\u6811\u5b9a\u7406\n\n\u672c\u9898\u662f\u4e00\u9053\u8ba1\u6570\u9898\uff0c\u6709\u4e24\u4e2a\u8981\u6c42\uff1a\n\n1. \u5efa\u9020\u7684\u516c\u8def\u6784\u6210\u4e00\u9897\u751f\u6210\u6811\n\n2. \u6bcf\u6761\u516c\u8def\u7531\u4e0d\u540c\u7684\u516c\u53f8\u5efa\u9020\uff0c\u6bcf\u6761\u516c\u8def\u4e0e\u4e00\u4e2a\u516c\u53f8\u4e00\u4e00\u6620\u5c04\n\n\u90a3\u4e48\u770b\u5230\u8fd9\u4e24\u4e2a\u8981\u6c42\u540e\uff0c\u6211\u4eec\u5f88\u5bb9\u6613\u60f3\u5230\u7b2c\u4e00\u4e2a\u6761\u4ef6\u7528\u77e9\u9635\u6811\u5b9a\u7406\uff0c\u90a3\u4e48\u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\u6761\u4ef6\uff0c\u6211\u4eec\u5c31\u5f88\u5bb9\u6613\u60f3\u5230\u5bb9\u65a5\u539f\u7406\u3002\n\n\u5148\u4e0d\u8003\u8651\u7b2c\u4e8c\u4e2a\u6761\u4ef6\uff0c\u628a\u6240\u6709\u8fb9\u90fd\u52a0\u8fdb\u53bb\uff08\u6ca1\u6709\u81ea\u73af\uff09\uff0c\u8fd9\u662f\u6211\u4eec\u7528\u77e9\u9635\u6811\u539f\u7406\u7b97\u51fa\u6765\u7684\u7ed3\u679c\u4e0d\u4ec5\u6709 $n-1$ \u4e2a\u516c\u53f8\u5efa\u9020\u7684\u65b9\u6848\uff0c\u4e5f\u5305\u62ec\u4e86 $(n-2)...1$ \u4e2a\u516c\u53f8\u5efa\u9020\u7684\u65b9\u6848\u3002\n\n\u6b64\u65f6\uff0c\u6211\u4eec\u9700\u8981\u51cf\u53bb $n-2$ \u4e2a\u516c\u53f8\u5efa\u9020\u7684\u65b9\u6848\uff0c\u90a3\u4e48\u8fd9\u91cc\u6211\u4eec\u5c31\u628a\u5176\u4e2d\u4e00\u4e2a\u516c\u53f8\u53bb\u6389\uff0c\u518d\u8fdb\u884c\u8ba1\u7b97\uff0c\u6ce8\u610f\u8fd9\u91cc\u53bb\u6389\u4e00\u4e2a\u516c\u53f8\u6709 $n-1$ \u79cd\u65b9\u6848\u3002\n\n\u4f46\u662f\u6211\u4eec\u4f1a\u53d1\u73b0 $n-3$ \u4e2a\u516c\u53f8\u5efa\u9020\u7684\u65b9\u6848\u88ab\u91cd\u590d\u51cf\u53bb\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u52a0\u56de\u6765\uff0c\u81f3\u6b64\uff0c\u5c31\u662f\u4e00\u4e2a\u7eaf\u7684\u5bb9\u65a5\u4e86\u3002\n\n\u5bf9\u4e8e\u5220\u53bb\u4e0d\u540c\u7684\u516c\u53f8\uff0c\u8ba1\u7b97\u4e0d\u540c\u7684\u65b9\u6848\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e8c\u8fdb\u5236\u538b\u4e00\u4e0b $n-1$ \uff0c\u4e8c\u8fdb\u5236\u6bcf\u4e00\u4f4d $1$ \u4ee3\u8868\u9009\u53d6\u8fd9\u4e00\u4f4d\u4ee3\u8868\u7684\u516c\u53f8\u3002\n\n\u800c\u5728\u6c42\u89e3\u884c\u5217\u5f0f\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u9006\u5143\u8fdb\u884c\u6c42\u89e3\uff0c\u4e5f\u53ef\u4ee5\u8f97\u8f6c\u76f8\u9664\u3002\n\n\u6240\u4ee5\u6700\u540e\u524d\u4e00\u79cd\u590d\u6742\u5ea6\u4e3a $\\mathcal O(2^{n-1}((n-1)^3+(n-1)log(1e9+7)))$   \n\n\u540e\u4e00\u79cd\u7684\u590d\u6742\u5ea6\u4e3a $\\mathcal O(2^{n-1}(n-1)^3logn)$ \u3002\n\n\u9006\u5143 $AC \\kern 0.4em CODE:$\n```cpp\n#include<bits/stdc++.h>\n#define ri register signed\n#define p(i) ++i\nusing namespace std;\nnamespace IO{\n    char buf[1<<21],*p1=buf,*p2=buf;\n    #define gc() p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++\n    inline int read() {\n        ri x=0,f=1;char ch=gc();\n        while(ch<'0'||ch>'9') {if (ch=='-') f=-1;ch=gc();}\n        while(ch>='0'&&ch<='9') {x=(x<<1)+(x<<3)+(ch^48);ch=gc();}\n        return x*f; \n    }\n}\nusing IO::read;\nnamespace nanfeng{\n    #define lm(x) (1<<x)\n    #define lowbit(x) (x&-(x))\n    #define cmax(x,y) ((x)>(y)?(x):(y))\n    #define cmin(x,y) ((x)>(y)?(y):(x))\n    #define FI FILE *IN\n    #define FO FILE *OUT\n    typedef long long ll;\n    static const int N=20,MOD=1e9+7;\n    int num[N],u[N][N*N],v[N][N*N],G[N][N],siz[lm(16)+7],lg[lm(16)+7]={-1},n,cnt,st,ans;\n    inline void add(int u,int v) {p(G[u][v]),p(G[v][u]);}\n    inline int fpow(int x,int y) {\n        int res=1;\n        while(y) {\n            if (y&1) res=1ll*res*x%MOD;\n            x=1ll*x*x%MOD;y>>=1;\n        }\n        return res;\n    }\n    inline int Gauss() {\n        int res=1,tr=0;\n        for (ri i(1);i<=cnt;p(i)) {\n            for (ri j(i+1);j<=cnt;p(j)) if (G[j][i]) {swap(G[i],G[j]);tr^=1;break;} \n            int inv=fpow(G[i][i],MOD-2);\n            for (ri j(i+1);j<=cnt;p(j)) {\n                int tmp=1ll*inv*G[j][i]%MOD;\n                for (ri k(i+1);k<=cnt;p(k)) G[j][k]=(G[j][k]-1ll*G[i][k]*tmp%MOD+MOD)%MOD;\n            }\n            if (!G[i][i]) return 0;\n            res=1ll*res*G[i][i]%MOD;\n        }\n        return tr?-res:res;\n    }\n    inline int main() {\n        // FI=freopen(\"nanfeng.in\",\"r\",stdin);\n        // FO=freopen(\"nanfeng.out\",\"w\",stdout);\n        n=read(),cnt=n-1;st=(1<<n-1)-1;\n        for (ri i(1);i<=st;p(i)) siz[i]=siz[i>>1]+(i&1),lg[i]=lg[i>>1]+1;\n        for (ri i(1);i<n;p(i)) {\n            num[i]=read();\n            for (ri j(1);j<=num[i];p(j)) u[i][j]=read(),v[i][j]=read();\n        }\n        for (ri i(1);i<=st;p(i)) {\n            int low=i;\n            memset(G,0,sizeof(G));\n            while(low) {\n                int id=lg[lowbit(low)]+1;\n                for (ri j(1);j<=num[id];p(j)) add(u[id][j],v[id][j]);\n                low-=lowbit(low);\n            }\n            for (ri j(1);j<=n;p(j)) {\n                for (ri k(1);k<=n;p(k)) if (j^k) G[j][j]+=G[j][k],G[j][k]=-G[j][k];\n            }\n            // for (ri j(1);j<=n;p(j)) {\n            //     for (ri k(1);k<=n;p(k)) printf(\"%d \",G[j][k]);\n            //     puts(\"\");\n            // }\n            int tmp=(Gauss()+MOD)%MOD;\n            // printf(\"state=%d tmp=%d\\n\",i,tmp);\n            ans=((ll)ans+MOD+((n-siz[i])&1?tmp:-tmp))%MOD;\n        }\n        printf(\"%d\\n\",ans);\n        return 0;\n    }\n}\nint main() {return nanfeng::main();}\n```\n\u7406\u8bba\u4e0a\u8bf4\u8f97\u8f6c\u5411\u9664\u6cd5\u590d\u6742\u5ea6\u9ad8\uff0c\u4f46\u672c\u9898\u6570\u636e\u4e0d\u5927\uff0c\u4e5f\u6ca1\u95ee\u9898\n\n[Code](https://www.cnblogs.com/nanfeng-blog/p/14880720.html)",
        "postTime": 1623577468,
        "uid": 141958,
        "name": "\u6960\u67ab",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4336 [SHOI2016]\u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61"
    },
    {
        "content": "# \u9898\u76ee\n&emsp;&emsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/P4336)\u770b\u9898\u76ee\u3002  \n# \u5206\u6790\n&emsp;&emsp;\u770b\u5230 n \u5f88\u5c0f\uff0c\u9650\u5236\u6761\u4ef6\u53c8\u8fd9\u4e48\u590d\u6742\uff0c\u663e\u7136\u53ef\u4ee5\u76f4\u63a5\u5bb9\u65a5\u3002     \n&emsp;&emsp;\u6211\u4eec\u5b9e\u9645\u4e0a\u53ea\u9700\u8981\u4fdd\u8bc1\u6bcf\u4e2a\u516c\u53f8\u90fd\u6709\u8fb9\u53ef\u4ee5\u4fee\u5efa\uff08\u6811\u7684\u6027\u8d28\u4fdd\u8bc1\u6700\u7ec8\u6bcf\u4e2a\u516c\u53f8\u6709\u4e14\u4ec5\u6709\u4e00\u6761\u8fb9\u53ef\u4ee5\u4fee\u5efa\uff09\u3002\u56e0\u6b64\u4e0d\u96be\u6709\u5bb9\u65a5\uff1a    \n$$\n\\begin{aligned}\nf(k):&\\text{\u6709}k\\text{\u4e2a\u516c\u53f8\u6ca1\u6709\u8fb9\u4fee\u5efa\u7684\u65b9\u6848\u6570}\\\\\nans=&\\sum_{i=0}^{n-1}(-1)^if(i)\n\\end{aligned}\n$$   \n&emsp;&emsp;\u800c\u6240\u6709\u7684$f$\u90fd\u53ef\u4ee5\u4e00\u904d\u679a\u4e3e\u5b50\u96c6\u8ba1\u7b97\u3002\u65f6\u95f4\u590d\u6742\u5ea6$O(2^nn^3)$\u3002\u770b\u7740\u6162\uff0c\u8dd1\u7740\u8fd8\u4e0d\u9519\u3002      \n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <iostream>\n\nconst int mod = 1e9 + 7;\nconst int MAXN = 25, MAXM = 17 * 17, MAXS = ( 1 << 17 ) + 5;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0;char s = getchar();int f = 1;\n\twhile( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n\twhile( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n\tif( 9 < x ){ write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\nint D[MAXN][MAXN], K[MAXN][MAXN], G[MAXN][MAXN];\nint M[MAXN], fr[MAXN][MAXM], to[MAXN][MAXM];\nint N;\n\nint qkpow( int base, int indx )\n{\n\tint ret = 1;\n\twhile( indx )\n\t{\n\t\tif( indx & 1 ) ret = 1ll * ret * base % mod;\n\t\tbase = 1ll * base * base % mod, indx >>= 1;\n\t}\n\treturn ret;\n}\n\nint inv( const int a ) { return qkpow( a, mod - 2 ); }\n\nint det( int T[MAXN][MAXN], const int n )\n{\n\tint indx, ret = 1, tmp, inver;\n\tfor( int i = 1 ; i <= n ; i ++ )\n\t{\n\t\tindx = -1;\n\t\tfor( int j = i ; j <= n ; j ++ )\n\t\t\tif( T[j][i] )\n\t\t\t{ indx = j; break; }\n\t\tif( indx == -1 ) return 0;\n\t\tif( indx ^ i ) ret = mod - ret;\n\t\tstd :: swap( T[i], T[indx] );\n\t\tinver = inv( T[i][i] );\n\t\tfor( int j = i + 1 ; j <= n ; j ++ )\n\t\t\tif( T[j][i] )\n\t\t\t{\n\t\t\t\ttmp = 1ll * T[j][i] * inver % mod;\n\t\t\t\tfor( int k = i ; k <= n ; k ++ )\n\t\t\t\t\tT[j][k] = ( T[j][k] - 1ll * T[i][k] * tmp % mod + mod ) % mod;\n\t\t\t}\n\t\tret = 1ll * ret * T[i][i] % mod;\t\n\t}\n\treturn ret;\n}\n\nint MatrixTree()\n{\n\tfor( int i = 1 ; i <= N ; i ++ )\n\t{\n\t\tD[i][i] = 0;\n\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\tD[i][i] += G[j][i];\n\t}\n\tfor( int i = 1 ; i <= N ; i ++ )\n\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\tK[i][j] = ( D[i][j] - G[i][j] + mod ) % mod;\n\treturn det( K, N - 1 );\n}\n\nint main()\n{\n\tread( N );\n\tfor( int i = 1 ; i < N ; i ++ ) \n\t{\n\t\tread( M[i] );\n\t\tfor( int j = 1 ; j <= M[i] ; j ++ )\n\t\t\tread( fr[i][j] ), read( to[i][j] ), \n\t\t\tG[fr[i][j]][to[i][j]] ++, G[to[i][j]][fr[i][j]] ++;\n\t}\n\tint upper = 1 << N - 1, coe, ans = 0;\n\tfor( int S = 0 ; S < upper ; S ++ )\n\t{\n\t\tcoe = 1;\n\t\tfor( int i = 1 ; i < N ; i ++ )\n\t\t\tif( S & ( 1 << i - 1 ) )\n\t\t\t{\n\t\t\t\tfor( int j = 1 ; j <= M[i] ; j ++ )\n\t\t\t\t\tG[fr[i][j]][to[i][j]] --, G[to[i][j]][fr[i][j]] --;\n\t\t\t\tcoe = mod - coe;\n\t\t\t}\n\t\tans = ( ans + 1ll * coe * MatrixTree() % mod ) % mod;\n\t\tfor( int i = 1 ; i < N ; i ++ )\n\t\t\tif( S & ( 1 << i - 1 ) )\n\t\t\t\tfor( int j = 1 ; j <= M[i] ; j ++ )\n\t\t\t\t\tG[fr[i][j]][to[i][j]] ++, G[to[i][j]][fr[i][j]] ++;\n\t}\n\twrite( ans ), putchar( '\\n' );\n\treturn 0;\n}\n``` ",
        "postTime": 1593497197,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[SHOI2016]\u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61"
    },
    {
        "content": "\u8fd9\u9053\u9898\u7684\u89e3\u6cd5\u5341\u5206\u66b4\u529b\u3002\n\n\u6211\u4eec\u53d1\u73b0$n$\u7684\u8303\u56f4\u5f88\u5c0f\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u72b6\u538b\u3002\n\n\u6bcf\u4e00\u4e2a\u72b6\u6001$i$\u8868\u793a\u5f53\u524d\u8ba1\u7b97\u7684\u751f\u6210\u6811\u6570\u91cf\u5305\u542b\u54ea\u4e9b\u989c\u8272\n\n\u6839\u636e\u5bb9\u65a5\u539f\u7406\u53ef\u5f97\uff1a\u6700\u540e\u7684\u7b54\u6848\u5c31\u662f\uff1a\u4efb\u53d6$-$\u4e00\u79cd\u989c\u8272\u4e0d\u9009$+$\u4e24\u79cd\u989c\u8272\u4e0d\u9009$-$......\n\n\u7edf\u8ba1\u6bcf\u4e2a\u72b6\u6001\u7684\u7b54\u6848\u7528\u77e9\u9635\u6811\u5b9a\u7406+\u9ad8\u65af\u6d88\u5143\u5373\u53ef\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(2^nn^3)$\n\u4ee3\u7801\uff1a\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\nconst int mod=1e9+7;\nint n,ans,m[20],edge[410][410][2],a[20][20];\nint qpow(int x,int n){\n\tint ret=1;\n\twhile(n){\n\t\tif(n&1)\n\t\t\tret=1ll*ret*x%mod;\n\t\tx=1ll*x*x%mod;\n\t\tn>>=1;\n\t}\n\treturn ret;\n}\nint gauss(int n){\n\tint ret=1;\n\tfor(int i=1;i<n;i++){\n\t\tfor(int j=i+1;j<=n;j++){\n\t\t\tif(!a[i][i])\n\t\t\t\treturn 0;\n\t\t\tif(!a[j][i])\n\t\t\t\tcontinue;\n\t\t\tint tmp=1ll*a[j][i]*qpow(a[i][i],mod-2)%mod;\n\t\t\tfor(int k=i;k<=n;k++){\n\t\t\t\ta[j][k]-=1ll*a[i][k]*tmp%mod;\n\t\t\t\tif(a[j][k]<0)\n\t\t\t\t\ta[j][k]+=mod;\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++)\n\t\tret=1ll*ret*a[i][i]%mod;\n\treturn ret;\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<n;i++){\n\t\tscanf(\"%d\",m+i);\n\t\tfor(int j=1;j<=m[i];j++)\n\t\t\tscanf(\"%d%d\",edge[i][j],edge[i][j]+1);\n\t}\n\tfor(int i=0;i<(1<<(n-1));i++){\n\t\tmemset(a,0,sizeof(a));\n\t\tint f=1;\n\t\tfor(int j=1;j<n;j++){\n\t\t\tif(i&(1<<(j-1))){\n\t\t\t\tfor(int k=1;k<=m[j];k++){\n\t\t\t\t\ta[edge[j][k][0]][edge[j][k][1]]--;\n\t\t\t\t\ta[edge[j][k][1]][edge[j][k][0]]--;\n\t\t\t\t\ta[edge[j][k][0]][edge[j][k][0]]++;\n\t\t\t\t\ta[edge[j][k][1]][edge[j][k][1]]++;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse f=-f;\n\t\t}\n\t\tfor(int j=1;j<=n;j++)\n\t\t\tfor(int k=1;k<=n;k++)\n\t\t\t\tif(a[j][k]<0)\n\t\t\t\t\ta[j][k]+=mod;\n\t\tans+=f*gauss(n-1);\n\t\tif(ans<0)\n\t\t\tans+=mod;\n\t\tif(ans>=mod)\n\t\t\tans-=mod;\n\t}\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1532748849,
        "uid": 49097,
        "name": "ezoiHQM",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4336 \u3010[SHOI2016]\u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61\u3011"
    },
    {
        "content": "[$blog$](https://www.cnblogs.com/hbxblog/p/10332490.html)\n### $Describe$\n> $n-1$\u4e2a\u516c\u53f8,\u6bcf\u4e2a\u516c\u53f8\u80fd\u4fee\u4e00\u4e9b\u8fb9,\u6c42\u6bcf\u6761\u8fb9\u90fd\u8ba9\u4e0d\u540c\u7684\u516c\u53f8\u6765\u4fee\u7684\u751f\u6210\u6811\u7684\u65b9\u6848\u6570\n\n### $Solution$\n\n\u8fd9\u9053\u9898\u5f88\u660e\u663e\u5bb9\u65a5.\u7b54\u6848\u5c31\u662f:\u6240\u6709\u90fd\u9009\u7684\u751f\u6210\u6811\u4e2a\u6570$-$\u4e00\u4e2a\u6ca1\u9009\u7684\u751f\u6210\u6811\u4e2a\u6570$+$\u4e24\u4e2a\u6ca1\u9009\u7684\u751f\u6210\u6811\u4e2a\u6570$-...$  \n\n\u81f3\u4e8e\u751f\u6210\u6811\u4e2a\u6570\u600e\u4e48\u7b97,\u7528$Matrix - Tree$\u77e9\u9635\u6811\u5b9a\u7406\u505a\u5c31\u597d\u4e86  \n\u5982\u679c\u4e0d\u4f1a:[\u4f20\u9001\u95e8](http://baidu.physton.com/?q=\u77e9\u9635\u6811\u5b9a\u7406)\n\n### $Code$\n``` cpp\n#include<bits/stdc++.h>\n#define int long long\n#define rg register\n#define file(x) freopen(x\".in\",\"r\",stdin);freopen(x\".out\",\"w\",stdout);\nusing namespace std;\nconst int mod=1e9+7;\nint read(){\n    int x=0,f=1;\n    char c=getchar();\n    while(c<'0'||c>'9') f=(c=='-')?-1:1,c=getchar();\n    while(c>='0'&&c<='9') x=x*10+c-48,c=getchar();\n    return f*x;\n}\nint a[21][21],len[1001],f[1001][1001],vis[1001][1001],n,ans,bj[10001];\nvoid init(){\n\tmemset(a,0,sizeof(a));\n    for(int i=1;i<n;i++)\n        if(bj[i])\n            for(int j=1;j<=len[i];j++)\n                ++a[f[i][j]][f[i][j]],++a[vis[i][j]][vis[i][j]],--a[f[i][j]][vis[i][j]],--a[vis[i][j]][f[i][j]];\n    for(int i=1;i<=n;i++)\n        for(int j=1;j<=n;j++)\n            a[i][j]=(a[i][j]+mod)%mod;\n}\nint ksm(int a,int b){\n\tint ans=1;\n\twhile(b){\n\t\tif(b&1)\n\t\t\tans=ans*a%mod;\n\t\ta=a*a%mod;\n\t\tb>>=1;\n\t}\n\treturn ans;\n}\nint work(){\n\tinit();\n\tint js=1;\n    for(int i=2;i<=n;i++){\n\t\tint inv=ksm(a[i][i],mod-2);\n        for(int j=i+1;j<=n;j++)\n            while(a[j][i]){\n                int x=a[j][i]*inv%mod;\n                for(int k=i;k<=n;k++)\n                    a[j][k]=(a[j][k]-x*a[i][k]%mod+mod)%mod,swap(a[i][k],a[j][k]);\n            }\n        js=js*a[i][i]%mod;\n    }\n    return js%mod;\n}\nvoid dfs(int x,int opt){\n    if(x==n){\n\t\t(opt&1)?ans-=work():ans+=work(),ans=(ans+mod)%mod;\n        return;\n    }\n    bj[x]=1;dfs(x+1,opt),bj[x]=0;dfs(x+1,opt+1);\n}\nmain(){\n\tn=read();\n\tfor(int i=1;i<n;i++){\n\t\tlen[i]=read();\n\t\tfor(int j=1;j<=len[i];j++)\n\t\t\tf[i][j]=read(),vis[i][j]=read();\n\t}\n\tdfs(1,0);\n\tprintf(\"%lld\",ans);\n}\n```",
        "postTime": 1548720657,
        "uid": 19805,
        "name": "\u64a4\u4e91",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4336 \u3010[SHOI2016]\u9ed1\u6697\u524d\u7684\u5e7b\u60f3\u4e61\u3011"
    }
]