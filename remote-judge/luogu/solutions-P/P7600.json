[
    {
        "content": "\n\u611f\u89c9\u662f\u6574\u573a\u8003\u8bd5\u4e2d\u601d\u7ef4\u6700\u7b80\u5355\u7684\u4e00\u9898\n\n\u8003\u573a\u5199\u4e86 $O(n(\\sqrt n + \\log n))$ ,\u5728 luogu \u548c uoj \u90fd\u662f73,~~\u7136\u540e\u53ef\u80fd\u662f\u56e0\u4e3a\u6ca1\u6253.h~~,\u5728 CCF \u4e0a\u7206\u96f6\u4e86,\u7136\u540e\u559c\u63d0\u94dc\u724c\n\n\u6b64\u5904\u505a\u6cd5\u7684\u590d\u6742\u5ea6\u662f $O(n\\log n)$ \u7684,\u5728 luogu \u4e0a\u8dd1\u4e86440ms\u5de6\u53f3,\u8fd8\u662f\u633a\u5feb\u7684\n## solution\n\u9996\u5148\u6211\u4eec\u8003\u8651\u6734\u7d20 dp \u600e\u4e48\u505a,\u65b9\u4fbf\u8d77\u89c1,\u4ee5\u4e0b\u6211\u4eec\u90fd\u8ba1\u7b97\u5141\u8bb8\u6bcf\u4e2a\u70b9\u4fdd\u7559 k \u6761\u8fb9,\u6700\u5927\u7684\u8fb9\u6743\u548c,\u5bb9\u6613\u53d1\u73b0\u8fd9\u4e2a\u548c\u7b54\u6848\u521a\u597d\u662f\u4e92\u8865\u7684,\u6700\u540e\u7528\u603b\u6570\u51cf\u4e00\u4e0b\u5373\u53ef\n\n\u6211\u4eec\u6ce8\u610f\u5230\u6bcf\u4e2a k \u4e4b\u95f4, dp \u662f\u6ca1\u6709\u5173\u8054\u7684,\u8003\u8651 $dp1_u$ ,\u4e3a $u$ \u7684\u5b50\u6811\u5185(**\u6ce8\u610f\u8fd9\u91cc\u4e0d\u8003\u8651\u4e0e\u7236\u4eb2\u8282\u70b9\u7684\u8fb9\u662f\u5426\u9009\u62e9**),\u6240\u6709\u70b9\u90fd\u9009\u4e86\u4e0d\u8d85\u8fc7 k \u6761\u8fb9, u \u9009\u4e86 k \u6761\u8fb9\u7684\u6700\u4f18\u65b9\u6848, $dp2_u$ \u8868\u793a u \u7684\u5b50\u6811\u5185,\u6240\u6709\u70b9\u90fd\u9009\u4e86\u4e0d\u8d85\u8fc7 k \u6761\u8fb9, u \u9009\u4e86 **k-1\u6761\u8fb9** \u7684\u6700\u4f18\u65b9\u6848,\u8fd9\u91cc\u53ef\u4ee5\u7406\u89e3\u4e3a\u5269\u4e0b\u7684\u90a3\u6761\u8fb9\u8981\u8fde\u5230\u7236\u4eb2\n\n\n\u8003\u8651\u5982\u4f55\u8f6c\u79fb,\u6211\u4eec\u8003\u8651\u8d2a\u5fc3\u7684\u8f6c\u79fb,\u9996\u5148,\u5047\u8bbe\u6211\u4eec\u4e00\u6761\u8fb9\u90fd\u4e0d\u9009,\u7b54\u6848\u663e\u7136\u662f $\\sum_{v \\in son(u)}{dp1_v}$ ,\u63a5\u4e0b\u6765\u6211\u4eec\u6709 **k** \u6b21\u53cd\u6094\u7684\u673a\u4f1a,\u6bcf\u6b21\u53ef\u4ee5\u9009\u4e00\u6761\u8fb9,\u90a3\u4e48\u8d21\u732e\u5c31\u662f $w + dp2_v - dp1_v$ ,\u6211\u4eec\u8bbe\u5b83\u4e3a $f_v$ ,\u90a3\u4e48 $dp1_u = \\max(\\sum_{v \\in son(u)}{dp1_v}$ + (\u81f3\u591a$k$\u4e2a$f_v))$, $dp2_u$ \u5219\u662f\u81f3\u591a k-1 \u4e2a $f_v$\n\n\n\u5bb9\u6613\u7528\u6392\u5e8f\u505a\u5230 $O(n^2\\log n)$\n\n\u8003\u8651\u5355 $\\log$ \u600e\u4e48\u505a,\u6211\u4eec\u4e0d\u59a8\u5148\u5206\u6790\u70b9\u6027\u8d28\n\n\n\n\u5b9a\u4e49:\u5047\u8bbe\u6211\u4eec\u5f53\u524d\u5728\u8ba1\u7b97\u5141\u8bb8\u4fdd\u7559$k$\u6761\u8fb9,\u4e00\u4e2a\u70b9\u88ab\u5b9a\u4e49\u4e3a\u65e0\u7528\u7684,\u5f53\u4e14\u4ec5\u5f53degree(v)(\u4ee5\u4e0b\u7b80\u79f0$deg_v$) $\\leq k$\n\n\u9996\u5148\u6211\u4eec\u6ce8\u610f\u5230\u65e0\u7528\u70b9\u548c\u65e0\u7528\u70b9\u4e4b\u95f4\u7684\u8fb9\u6211\u4eec\u65e0\u9700\u51b3\u7b56,\u662f\u4e00\u5b9a\u53ef\u4ee5\u9009\u7684,\u8fd9\u90e8\u5206\u8d21\u732e\u6211\u4eec\u53ef\u4ee5\u4e8b\u5148\u7528\u5dee\u5206\u6765\u9884\u5904\u7406\n```cpp\nfor(int u = 0; u < N; ++u)\n    for(auto v:E[u]){\n        int o = max(deg[u],deg[v]);\n        F[o] += w; \n    }\nfor(int i = 1; i < N; ++i)  F[i] += F[i-1];\n```\n\n\u8003\u8651\u6709\u7528\u70b9 u \u548c\u65e0\u7528\u70b9 v \u4e4b\u95f4\u7684\u51b3\u7b56,\u6211\u4eec\u53d1\u73b0\u5982\u679c\u4e00\u4e2a\u70b9\u6210\u4e3a\u4e86\u65e0\u7528\u70b9,\u90a3\u4e48\u5728\u4e4b\u540e,\u5176\u8d21\u732e\u5c06\u4e00\u76f4\u4e0d\u53d8,\u4fdd\u6301\u4e3a w(u,v) ,\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u7528\u4e00\u4e2a\u5806\u6765\u7ef4\u62a4.\n\n\u90a3\u4e48\u6211\u4eec\u6bcf\u6b21\u53ef\u4ee5\u53ea\u8ba1\u7b97\u6709\u7528\u70b9\u548c\u6709\u7528\u70b9\u4e4b\u95f4\u7684\u8d21\u732e,\u4e0d\u591f\u7684\u518d\u76f4\u63a5\u7528\u65e0\u7528\u70b9\u7684\u5806\u7684\u524d\u7f00\u548c\u6765\u8865\u5145\n- \u6b64\u90e8\u5206\u4ee3\u7801\u5982\u4e0b(\u6ce8\u610f\u6b64\u5904\u65e0\u9700\u8003\u8651\u7236\u5b50\u5173\u7cfb)\n```cpp\nvoid _delete(int u){\n\tfor(auto now:E[u]){\n\t\tint v = now.fi,w = now.se;\n\t\tq[v].push(-w);Sw[v] += w;\n\t}\n}\n```\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0,\u5bf9\u4e8e\u6bcf\u4e2a k ,\u6211\u4eec\u53ea\u9700\u4fdd\u7559 $deg \\ge k$ \u7684\u70b9\u5f62\u6210\u7684\u68ee\u6797\u6765\u904d\u5386,\u6211\u4eec\u53ef\u4ee5\u5148\u5728\u90bb\u63a5\u8868\u4e0a\u6309\u5ea6\u6570\u6392\u5e8f,\u7528 vector \u7684 pop_back \u548c\u53cc\u6307\u9488\u6765\u5220\u9664\u70b9.\n\n\u8fd9\u6837\u505a\u7684\u590d\u6742\u5ea6\u770b\u8d77\u6765\u5f88\u66b4\u529b,\u4f46\u662f\u5b9e\u9645\u4e0a\u6211\u4eec\u53ef\u4ee5\u5206\u6790,\u4e00\u4e2a\u70b9\u81f3\u591a\u53ea\u4f1a\u88ab\u904d\u5386\u5ea6\u6570\u6b21,\u800c\u6240\u6709\u7684\u70b9\u7684\u5ea6\u6570\u548c\u662f\u7ebf\u6027\u7ea7\u522b\u7684,\u52a0\u4e0a\u5806\u548c\u6392\u5e8f\u7684\u590d\u6742\u5ea6,\u603b\u590d\u6742\u5ea6\u5c31\u662f $O(n \\log n)$\n\n\n\u6709\u4e00\u4e9b\u7ec6\u8282,\u8be6\u89c1\u4ee3\u7801\n\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$ ,\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n)$ \n\n\n\u4ee3\u7801\u5982\u4e0b\n\n```cpp\n#include<bits/stdc++.h>\nstd::vector<long long> minimum_closure_costs(int N, std::vector<int> U,\n                                             std::vector<int> V,\n                                             std::vector<int> W);\nusing namespace std;\nint read(){\n\tchar c = getchar();\n\tint x = 0;\n\twhile(c < '0' || c > '9')\tc = getchar();\n\twhile(c >= '0' && c <= '9')\tx = x * 10 + c - 48,c = getchar();\n\treturn x;\n}\nconst int _ = 1e5 + 7;\nint deg[_];int n;\n#define ll long long\n#define mp make_pair\n#define fi first\n#define se second\n#define pb push_back \ntypedef pair<int,int> pii;\nvector<pii>E[_];\nvector<ll>F;\nvector<int>Ver;\nbool cmp(pii a,pii b){\n\treturn deg[a.fi] > deg[b.fi];\n}\nbool Cmp(int a,int b){\n\treturn deg[a] < deg[b];\n}\npriority_queue<ll>q[_],bq[_];ll Sw[_];\nint dfn[_],dfncnt;\nvoid dfs1(int u,int fa){\n\tfor(auto now:E[u]){\n\t\tint v = now.fi,w = now.se;\n\t\tif(v ^ fa){\n\t\t\tint o = max(deg[u],deg[v]);\n\t\t\tF[o] += w;\n//\t\t\tcout<<o<<\" \"<<w<<'\\n'; \n\t\t\tdfs1(v,u); \n\t\t}\n\t}\n}\nll dp1[_],dp2[_];\nint st[_],top,bac[_],bcnt;\nvoid _delete(int u){\n\tfor(auto now:E[u]){\n\t\tint v = now.fi,w = now.se;\n\t\tq[v].push(-w);Sw[v] += w;\n\t}\n}\nvoid work(int u,int par,const int D){\n\tdfn[u] = D;\n\tdp1[u] = dp2[u] = 0;/*dp1[u]\u53d6D\u4e2a,dp2[u]\u53d6D-1\u4e2a*/\n\tfor(auto now:E[u]){\n\t\tint v = now.fi;\n\t\tif(v ^ par){\n//\t\t\tcout<<u<<' '<<v<<\"E\"<<'\\n';\n\t\t\twork(v,u,D);\n\t\t}\n\t}\n\tll ans = 0;\n\ttop = 0;\n\tfor(auto now:E[u]){\n\t\tint v = now.fi,w = now.se;\n\t\tif(v ^ par){\n\t\t\tans += dp1[v];\n\t\t\tif(w > (dp1[v] - dp2[v])){\n\t\t\t\tst[++top] = w - (dp1[v] - dp2[v]);\n\t\t\t}\n\t\t}\n\t}\n\tsort(st + 1,st + top + 1);\n\treverse(st + 1,st + top + 1);\n\tll S1 = 0,S2 = Sw[u];\n\tdp1[u] = Sw[u];dp2[u] = Sw[u];\n//\tif(D == 2)\tcout<<Sw[u]<<'\\n';\n\tassert(q[u].size() <= (unsigned int)D);\n\tif((int)q[u].size() == D)\tdp2[u] += q[u].top();\n//\tcout<<u<<'\\n';\n\tbcnt = 0;\n//\tcout<<u<<'\\n';\n\tfor(int i = 1; i <= min(top,D); ++i){/*\u9009i\u4e2a\u6709\u7528\u70b9,D-i\u4e2a\u65e0\u7528\u70b9*/\n\t\tS1 += st[i];\n\t\tif((int)q[u].size() > D - i){\n\t\t\tbac[++bcnt] = q[u].top();\n\t\t\tS2 += bac[bcnt];\n\t\t\tq[u].pop();\n\t\t}\n\t\tdp1[u] = max(dp1[u],S2 + S1);\n\t\tif(i == D)\t\tcontinue;\n\t\tll V = S2 + S1;if((int)q[u].size() >= D - i){\n\t\t\tV += q[u].top(); \n\t\t}\n\t\tdp2[u] = max(dp2[u],V);\n\t}\n//\tcout<<u<<'\\n';\n\twhile(bcnt)\tq[u].push(bac[bcnt]),bcnt--;\n//\tif(D == 2 && u == 1)\tcout<<dp1[u]<<'\\n';\n\tdp1[u] += ans;dp2[u] += ans;\n\tif(!par)\tF[D] += dp1[u]; \n}\n//vector<int> U;vector<int> V;vector<int> W;\nvector<ll> minimum_closure_costs(int N,vector<int> U,vector<int> V,vector<int> W) {\n\tll S = 0;\n//\tint N = read();\n\tn = N;\n\t/*for(int i = 0; i < N - 1; ++i){\n\t\tU.pb(0),V.pb(0),W.pb(0);\n\t\tU[i] = read(),V[i] = read(),W[i] = read();\n\t}*/\n\tfor(int i = 1; i < N; ++i){\n\t\tint u = U[i-1] + 1,v = V[i-1] + 1,w = W[i-1];\n//\t\tu--,v--;\n\t\tdeg[u]++,deg[v]++;\n\t\tS += w;\n\t\tE[u].pb(mp(v,w));E[v].pb(mp(u,w));\n\t}\n\tfor(int i = 1; i <= N; ++i)\tF.pb(0);\n\tfor(int i = 1; i <= N; ++i)\tVer.pb(i);\n\tsort(Ver.begin(),Ver.end(),Cmp);Ver.pb(0);\n\tdfs1(1,0);\n\tfor(int i = 1; i <= N; ++i)\tsort(E[i].begin(),E[i].end(),cmp);\n\tfor(int i = 1; i < N; ++i)\tF[i] += F[i-1];\n\tint l = 0;\n//\tfor(int i = 0; i < N; ++i)\tcout<<Ver[i]<<' ';\n//\tcout<<'\\n';\n\tfor(int i = 1; i < N; ++i){\n\t\twhile(l <= N && deg[Ver[l]] <= i){\n\t\t\t_delete(Ver[l]);\n\t\t\tl++;\n\t\t}\n//\t\tcout<<i<<' '<<l<<'\\n';\n\t\tfor(int ver = l; ver < N; ++ver){\n\t\t\tint u = Ver[ver];\n\t\t\tint k = E[u].size() - 1;\n\t\t\twhile(k >= 0 && deg[E[u][k].fi] <= i){\n\t\t\t\tE[u].pop_back();\n\t\t\t\tk--;\n\t\t\t}\n\t\t}\n//\t\tputs(\"hxsb\");\n\t\tfor(int ver = l; ver < N; ++ver){\n\t\t\tint u = Ver[ver];\n\t\t\twhile((int)q[u].size() > i){\n\t\t\t\tll x = -q[u].top();\n\t\t\t\tq[u].pop();Sw[u] -= x;\n\t\t\t\tbq[u].push(x);\n\t\t\t}\n\t\t\tif((int)q[u].size() < i){\n\t\t\t\tif((int)bq[u].size()){\n\t\t\t\t\tll x = bq[u].top();\n\t\t\t\t\tbq[u].pop();q[u].push(-x);Sw[u] += x;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif((int)bq[u].size()) {\n\t\t\t\t\tll x = bq[u].top();ll y = -q[u].top();\n\t\t\t\t\tif(x > y){\n\t\t\t\t\t\tq[u].pop();bq[u].pop();\n\t\t\t\t\t\tSw[u] -= y;Sw[u] += x;\n\t\t\t\t\t\tq[u].push(-x);bq[u].push(y);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} \n\t\tfor(int ver = l; ver < N; ++ver){\n\t\t\tint u = Ver[ver];\n\t\t\tif(dfn[u] != i)\twork(u,0,i);\n\t\t}\n\t}\n\tfor(int i = 0; i < N; ++i)\tF[i] = S - F[i];\n//\tfor(int i = 0; i < N; ++i)\tcout<<F[i]<<' ';\n\treturn F;\n}\n/*int main(){\n\tfreopen(\"data.in\",\"r\",stdin);\n\tfreopen(\"data.out\",\"w\",stdout);\n\tminimum_closure_costs();\n\treturn 0;\n}*/\n```\n",
        "postTime": 1622251934,
        "uid": 248872,
        "name": "y_dove",
        "ccfLevel": 9,
        "title": "P7600 [APIO2021] \u5c01\u95ed\u9053\u8def \u9898\u89e3"
    },
    {
        "content": "### \u601d\u8def\n\n\u4e00\u9053\u5f88\u597d\u53e3\u7cca\uff0c\u4f46\u662f\u5b9e\u73b0\u7ec6\u8282\u9887\u591a\u7684\u9898\uff08\u65f6\u95f4\u590d\u6742\u5ea6\u5bb9\u6613\u5047\u6389\uff09\u3002\n\n\u6211\u4eec\u5148\u8003\u8651\u56fa\u5b9a $k$ \u7684\u60c5\u51b5\uff0c\u7528 $dp_{u,0}$ \u8868\u793a\u5220\u9664\u70b9 $u$ \u5230\u5176\u7236\u4eb2\u7684\u8fde\u8fb9\u7684\u6700\u5c0f\u5220\u8fb9\u4ee3\u4ef7\uff0c\u7528 $dp_{u,1}$ \u8868\u793a\u4e0d\u5220\u9664\u70b9 $u$ \u5230\u5176\u7236\u4eb2\u7684\u8fde\u8fb9\u7684\u6700\u5c0f\u5220\u8fb9\u4ee3\u4ef7\u3002\u5bf9\u4e8e\u513f\u5b50 $v$ \u6709\u4e24\u79cd\u8f6c\u79fb\u65b9\u5f0f\uff0c\u7b2c\u4e00\u79cd $dp_{v,0}+cost(u,v)$\uff0c\u7b2c\u4e8c\u79cd $dp_{v,1}$\u3002\u53d1\u73b0\u76f4\u63a5\u8f6c\u79fb\u8981\u591a\u52a0\u4e00\u7ef4\uff0c\u548c\u6811\u4e0a\u80cc\u5305\u7c7b\u4f3c\u3002\u4f46\u662f\u590d\u6742\u5ea6\u4f1a\u7206\u70b8\u3002\u6545\u800c\u6211\u4eec\u9009\u62e9\u4e00\u79cd\u5e26\u53cd\u6094\u7684\u65b9\u6cd5\uff0c\u4e00\u5f00\u59cb\u6240\u6709\u90fd\u9009 $dp_{v,1}$\uff0c\u518d\u628a\u4e00\u4e9b $1$ \u7684\u6362\u6210 $0$ \u7684\u3002\u90a3\u4e48\u53ea\u8981\u7528\u5806 $dp_{v,0}+cost(u,v)-dp_{v,1}$ \u5373\u53ef\u3002\n\n\u4e4b\u540e\u6211\u4eec\u8003\u8651\u4ece\u5c0f\u5230\u5927\u679a\u4e3e $k$\uff0c\u5bf9\u4e8e\u6240\u6709\u5ea6\u6570\u5927\u4e8e $k$ \u7684\u70b9\u7684\u8054\u901a\u5757\u6309\u4e0a\u8ff0\u7b80\u6613\u7248\u65b9\u6cd5\u8dd1\u4e00\u904d\u6811 DP\u3002\u90a3\u4e9b\u4e0d\u7528\u8dd1\u7684\u70b9\u6211\u4eec\u5728\u679a\u4e3e\u5230\u7684\u5ea6\u6570\u7b49\u4e8e\u5b83\u65f6\u5c31\u5df2\u7ecf\u628a\u5176\u5220\u9664\uff0c\u5bf9\u6240\u6709\u5b83\u8fde\u51fa\u53bb\u7684\u70b9\u7684\u5927\u6839\u5806\u653e\u5165\u4e86\u5b83\u7684\u6743\u503c\u4e86\uff08\u6ce8\u610f\u5f53\u524d\u8fdb\u884c\u6811 DP \u65f6\u5df2\u7ecf\u5220\u9664\u7684\u70b9\u4e0d\u7528\u64cd\u4f5c\u5c31\u6ee1\u8db3\uff0c\u6545\u800c\u4e0d\u4f1a\u4ea7\u751f\u989d\u5916\u8d21\u732e\uff09\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\text{\u5ea6\u6570})$\uff0c\u82e5\u8981\u66f4\u5177\u4f53\u7684\u53ef\u4ee5\u5c31\u4ee3\u7801\u5206\u6790\u3002\n\n### \u4ee3\u7801\n\n\u5207\u8bb0\u4e0d\u8981\u7528 C++14 \u63d0\u4ea4\uff0c\u4e0d\u7136\u4f1a\u6ee1\u5c4f CE\uff08GCC 9 \u7f16\u8bd1\u7248\u672c\u8fc7\u4f4e\uff09\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\n#define pb push_back\n#define L(i, a, b) for(int i = a; i <= b; i++)\n#define R(i, a, b) for(int i = a; i >= b; i--)\nusing namespace std;\nvector<ll> minimum_closure_costs(int N, vector<int> U, vector<int> V, vector<int> W);\nconst int N = 1e5 + 10; \nint n, dg, de[N], id[N], vis[N]; ll sm, dp[N][2];\nvector<pair<int, int> > e[N]; vector<ll> a, d, ans;\nstruct Large_Root_Heap{\n    priority_queue<ll> q, d; ll sz, s;\n    void upd(){while(!d.empty() && q.top() == d.top()) d.pop(), q.pop();}\n    ll top(){upd(); return q.top();}\n    void ins(ll x){q.push(x), s += x, sz++;}\n    void del(ll x){d.push(x), s -= x, sz--;}\n} h[N];\nbool cmp(int i, int j){return de[i] < de[j];}\nbool cmpe(pair<int, int> &x, pair<int, int> &y){return de[x.first] > de[y.first];}\nvoid dfs(int u, int pre){\n    int cnt = de[u] - dg; ll ss = 0;\n    while(h[u].sz && h[u].sz > cnt)\n        a.pb(h[u].top()), h[u].del(h[u].top());\n    for(auto &ne: e[u]){\n        int v = ne.first; if(de[v] <= dg) break;\n        if(v == pre) continue; dfs(v, u);\n    }\n    a.clear(), d.clear(), vis[u] = dg;\n    for(auto &ne: e[u]){\n        int v = ne.first, w = ne.second;\n        if(v == pre) continue; if(de[v] <= dg) break;\n        ll vl = dp[v][0] + w - dp[v][1]; ss += dp[v][1];\n        if(vl <= 0) cnt--, ss += vl;\n        else h[u].ins(vl), d.pb(vl);\n    }\n    while(h[u].sz && h[u].sz > cnt)\n        a.pb(h[u].top()), h[u].del(h[u].top());\n    ss += h[u].s, dp[u][1] = ss;\n    dp[u][0] = ss - ((cnt > 0 && h[u].sz)? h[u].top() : 0);\n    for(auto &vl: a) h[u].ins(vl);\n    for(auto &vl: d) h[u].del(vl);\n}\nvector<ll> minimum_closure_costs(int N, vector<int> U, vector<int> V, vector<int> W){\n    n = N, ans.resize(n);\n    L(i, 1, n - 1){\n        int u = U[i - 1] + 1, v = V[i - 1] + 1, w = W[i - 1];\n        e[u].pb(make_pair(v, w)), de[u]++;\n        e[v].pb(make_pair(u, w)), de[v]++, ans[0] += w;\n    }\n    L(i, 1, n) id[i] = i, sort(e[i].begin(), e[i].end(), cmpe);\n    sort(id + 1, id + n + 1, cmp);\n    for(int i = dg = 1; dg < n; dg++){\n        while(i <= n && de[id[i]] <= dg){\n            for(auto ne: e[id[i]]) h[ne.first].ins(ne.second);\n            i++;\n        }\n        L(j, i, n) if(vis[id[j]] != dg)\n            dfs(id[j], 0), ans[dg] += dp[id[j]][1];\n    }\n    return ans;\n}\n```",
        "postTime": 1680926021,
        "uid": 341946,
        "name": "zac2010",
        "ccfLevel": 7,
        "title": "[APIO2021] \u5c01\u95ed\u9053\u8def \u9898\u89e3"
    },
    {
        "content": "\u5f15\u8def\u53cc\u500d\u7ecf\u9a8c [$\\tt CF1119F$](/problem/CF1119F)\uff0c\u8fd8\u6709\u6211\u90a3\u9898\u7684 [\u9898\u89e3](https://www.luogu.com.cn/blog/368107/solution-cf1119f)\u3002\n\n---\n\n\u8003\u8651\u56fa\u5b9a $x$ \u600e\u4e48\u505a\u3002\u6211\u4eec\u6811\u5f62 $\\tt dp$\uff0c\u8bb0\n\n+ $f_{u,0}$ **\u5220\u9664 $u$ \u5230\u7236\u4eb2\u7684\u8fb9**\uff0c\u8ba9 $u$ \u5b50\u6811\u7b26\u5408\u5ea6\u6570\u6761\u4ef6\u7684\u6700\u5c0f\u4ee3\u4ef7\n+ $f_{u,1}$ **\u4fdd\u7559 $u$ \u5230\u7236\u4eb2\u7684\u8fb9**\uff0c\u8ba9 $u$ \u5b50\u6811\u7b26\u5408\u5ea6\u6570\u6761\u4ef6\u7684\u6700\u5c0f\u4ee3\u4ef7\n+ $d_u$ \u4e3a $u$ \u7684\u5ea6\u6570\uff0c$u$ \u70b9\u8981\u5220\u9664\u7684\u603b\u8fb9\u6570\u662f $de_u-x(de_u\\gt x)$\u3002\n\n\u7136\u540e\u5bf9\u4e8e\u82e5\u5e72\u4e2a $u$ \u7684\u513f\u5b50 $v$ \u4ee5\u53ca\u5b83\u4eec\u4e4b\u95f4\u8fb9\u6743 $w$\uff0c\u6bcf\u79cd\u90fd\u6709\n\n1. \u5220\u9664 $u$ \u5230 $v$ \u7684\u8fb9\uff0c\u4ee3\u4ef7 $f_{v,0}+w$\uff08\u4e00\u7c7b\u8d21\u732e $a_1$\uff09\n2. \u4fdd\u7559 $u$ \u5230 $v$ \u7684\u8fb9\uff0c\u4ee3\u4ef7 $f_{v,1}$\uff08\u4e8c\u7c7b\u8d21\u732e $a_2$\uff09\n\n+ \u5bf9\u4e8e $f_{u,0}$ \u7684\u8ba1\u7b97\u800c\u8a00\uff0c\u9700\u8981\u81f3\u5c11\u5220\u9664 $de_u-x-1$ \u6761\u5230\u513f\u5b50\u7684\u8fb9\uff08\u5728\u81f3\u5c11 $de_u-x-1$ \u4e2a\u513f\u5b50\u90a3\u91cc\u53d6 $a_1$\uff0c\u5269\u4e0b\u513f\u5b50\u53d6 $a_2$\uff09\n+ \u5bf9\u4e8e $f_{u,1}$ \u7684\u8ba1\u7b97\u800c\u8a00\uff0c\u9700\u8981\u81f3\u5c11\u5220\u9664 $de_u-x$ \u6761\u5230\u513f\u5b50\u7684\u8fb9\uff08\u5728\u81f3\u5c11 $de_u-x$ \u4e2a\u513f\u5b50\u90a3\u91cc\u53d6 $a_1$\uff0c\u5269\u4e0b\u513f\u5b50\u53d6 $a_2$\uff09\n\n\u6211\u4eec\u5148\u5047\u8bbe\u5168\u90e8\u53d6 $a_2$\uff0c\u7136\u540e\u5728\u627e\u51fa\u4ee3\u4ef7\u6700\u5c0f\u7684\u67d0\u79cd\u65b9\u5f0f\uff0c\u66ff\u6362\u82e5\u5e72\u4e2a $a_2$ \u4e3a $a_1$\u3002\n\n\u6211\u4eec\u5148\u8ba1\u7b97\u51fa\u6240\u6709 $v$ \u7684 $a_2$ \u7684\u548c\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a $v$ \u6211\u4eec\u8ba1\u7b97\u51fa $a_1-a_2$ \u7684\u503c\uff0c\u6311\u51fa\u6700\u5c0f\u7684\u90a3\u4e9b\u52a0\u4e0a\u5230\u8fd9\u4e2a\u548c\u91cc\u9762\u5373\u53ef\uff08\u6ce8\u610f $a_1-a_2=f_{v,0}+w-f_{v,1}$\uff09\u3002\n\n\u5bf9\u4e8e $u$ \u7684 $\\tt dfs$ \u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u7528\u5806\u7ef4\u62a4\u51fa\u6240\u6709 $a_1-a_2$ \u7684\u503c\uff0c\u7136\u540e\u4ece\u5c0f\u5f80\u5927\u52a0\u5230 $a_2$ \u7684\u548c\u91cc\u9762\uff08\u5373\u5b8c\u6210\u4e86\u66ff\u6362\u82e5\u5e72\u4e2a $a_2$ \u4e3a $a_1$ \u8fd9\u6b65\uff09\u3002\n\n\u603b\u590d\u6742\u5ea6 $\\mathcal O(n\\log n)$\u3002\n\n---\n\n\u73b0\u5728\u8003\u8651\u4ece\u5c0f\u5f80\u5927\u8ba1\u7b97\u6bcf\u4e00\u4e2a $x_0$ \u600e\u4e48\u505a\u3002\n\n\u6211\u4e0a\u9762\u8bf4\u6811\u4e0a $\\tt dfs$ \u65f6\u8981\u5bf9\u6bcf\u4e2a\u70b9\u7ef4\u62a4\u4e00\u4e2a\u5806\uff0c\u4f46\u662f\u90a3\u4e2a\u5806\u662f\u5bf9\u6bcf\u4e2a\u70b9\u800c\u8a00\u7684\uff0c\u4e00\u65e6\u8fd9\u4e2a\u70b9\u7684\u8ba1\u7b97\u7ed3\u675f\u4e4b\u540e\uff0c\u8fd9\u4e2a\u5806\u4e5f\u5c31\u6ca1\u7528\u4e86\u3002\n\n\u5982\u679c\u6211\u4eec\u662f\u6734\u7d20\u7684\u5bf9\u6bcf\u4e2a $x_0$ \u90fd\u8ba1\u7b97\uff0c\u603b\u6709\u67d0\u4e9b\u4fe1\u606f\u4f1a\u88ab\u91cd\u590d\u8ba1\u7b97\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u91cc\u7ed9\u6bcf\u4e2a\u70b9\u90fd\u7ef4\u62a4\u5806\uff0c\u52a0\u4e0a\u201c\u4ece\u5c0f\u5f80\u5927\u679a\u4e3e\u201d\u8fd9\u4e2a\u6761\u4ef6\uff0c\u5c1d\u8bd5\u8ba9\u540e\u6765\u7684\u8ba1\u7b97\u53ef\u4ee5\u5229\u7528\u4ee5\u524d\u7b97\u8fc7\u7684\u4fe1\u606f\u3002\n\n\u89c2\u5bdf\u4ece\u5c0f\u5f80\u5927\u8fd9\u4e2a\u6761\u4ef6\uff0c\u5982\u679c\u4e00\u4e2a $u$ \u6709 $d_u\\le x_0$\uff0c\u90a3\u5728\u540e\u7eed\u7684 $x_0\\sim n$ \u7684\u8ba1\u7b97\u4e2d\uff0c\u8fd9\u4e2a $u$ \u5c31\u6ca1\u7528\u4e86\uff0c\u56e0\u4e3a\u5b83\u7684\u5ea6\u6570\u5df2\u7ecf\u6ee1\u8db3\u6761\u4ef6\u4e86\u3002\u800c\u4e00\u4e2a\u70b9 $u$ \u53ea\u4f1a\u6709\u7528 $d_u$ \u6b21\uff0c\u800c $\\sum d_u=O(n)$\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a $x_0$ \u90fd\u53ea\u8ba1\u7b97\u5f53\u524d\u6709\u7528\u7684\u70b9\uff0c\u65f6\u95f4\u662f\u53ef\u884c\u7684\n\n\u6211\u4eec\u4ee5\u6709\u7528\u7684\u70b9\u4e3a\u6839\u8fdb\u884c $\\tt dfs$\uff0c\u65e0\u7528\u70b9\u89c6\u4e3a\u53f6\u5b50\uff0c\u867d\u7136\u6709\u82e5\u5e72\u4e2a\u7531\u6709\u7528\u70b9\u6784\u6210\u7684\u5b50\u6811\u5171\u7528\u4e00\u4e2a\u53f6\u5b50\uff08\u65e0\u7528\u70b9\u5c06\u4f1a\u6709\u591a\u4e2a\u7236\u4eb2\uff09\uff0c\u4f46\u662f\u65e0\u59a8\u56e0\u4e3a\u65e0\u7528\u70b9\u6839\u672c\u4e0d\u4f1a\u5904\u7406\uff0c\u53ef\u4ee5\u5f53\u4f5c\u5176\u4e0d\u5b58\u5728\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/0wohinyb.png)\n\n\u5982\u56fe\uff0c$u$ \u662f\u65e0\u7528\u70b9\uff0c$p,q$ \u662f\u4e24\u4e2a\u6709\u7528\u70b9\u7684\u5b50\u6811\uff0c\u6211\u4eec\u4ece $p,q$ \u4e2d\u4efb\u610f\u6311\u4e00\u4e2a\u70b9\u5f00\u59cb $\\tt dfs$ \u90fd\u53ef\u4ee5\u628a\u8fd9\u4e2a\u5b50\u6811\u7ed9 $\\tt dfs$ \u5b8c\u4e00\u904d\u3002\u56e0\u4e3a\u65e0\u7528\u70b9\u662f\u53f6\u5b50\uff0c\u6b64\u65f6\u5b83\u76f8\u90bb\u7684\u6709\u7528\u70b9\uff08$p_3,q_2$\uff09\u5168\u90fd\u53ef\u4ee5\u89c6\u4e3a\u5b83\u7236\u4eb2\u3002\n\n\u56e0\u4e3a\u53ea\u4f1a\u8ba1\u7b97\u6709\u7528\u7684\u70b9\uff0c\u6240\u4ee5\u4e00\u4e2a\u70b9\u88ab\u6807\u8bb0\u65e0\u7528\u4e4b\u540e\uff0c\u5c31\u5e94\u8be5\u5904\u7406\u5b83\u4f59\u7559\u7684\u8d21\u732e\u3002\u7531\u8fd9\u4e2a\u7236\u5b50\u5173\u7cfb\uff0c\u5b83\u5e26\u7ed9\u6bcf\u4e2a\u7236\u4eb2\u7684\u8d21\u732e\u662f\u4e00\u4e2a $u$ \u7684 $a_1-a_2$ \u7684\u6743\u3002\u56e0\u4e3a\u65e0\u7528\u70b9\u6ca1\u6709\u5b50\u6811\uff0c\u6240\u4ee5\u4e0d\u5220\u8fb9\u6ca1\u6709\u5b50\u6811\u4ee3\u4ef7\uff08$a_2=0$\uff09\uff0c\u5220\u8fb9\u53ea\u4f1a\u6709\u5220\u8fb9\u81ea\u8eab\u7684\u4ee3\u4ef7\uff08$a_1=w$\uff09\uff0c\u8fd9\u4e2a\u6743\u5c31\u7b49\u4e8e $w$\uff0c\u5373\u8fd9\u4e2a\u70b9\u8fde\u5411\u4ed6\u7236\u4eb2\u7684\u8fb9\u7684\u6743\uff0c\u6211\u4eec\u628a\u8fd9\u4e2a\u6743\u653e\u8fdb\u5b83\u7236\u4eb2\u7684\u5806\u91cc\u5c31\u628a\u8fd9\u4e2a\u70b9\u7684\u4f59\u7559\u8d21\u732e\u5904\u7406\u5b8c\u4e86\u3002\n\n\u7136\u540e\u8003\u8651\u8fd9\u4e2a $\\tt dfs$ \u7684\u8fc7\u7a0b\u3002\u9996\u5148\u80af\u5b9a\u8981\u8ba1\u7b97\u6240\u6709\u513f\u5b50 $a_2$ \u7684\u548c\uff0c\u7136\u540e\u628a $a_1-a_2$ \u7684\u503c\u653e\u5230\u5806\u91cc\u3002\u5806\u91cc\u6b64\u65f6\u4f1a\u6709\u4e24\u7c7b\u5143\u7d20\u3002\n\n1. \u65e0\u7528\u70b9\u513f\u5b50\u5e26\u6765\u7684\u8d21\u732e\uff08\u6240\u6709\u65e0\u7528\u70b9\u513f\u5b50 $v_0$ \u7684 $w_0$ \u503c\uff09\u8fd9\u4e2a\u4e1c\u897f\u5728\u540e\u9762\u7684\u8ba1\u7b97\u4e2d\u8fd8\u6709\u7528\uff0c\u56e0\u4e3a\u65e0\u7528\u70b9\u513f\u5b50\u7684\u7236\u5b50\u5173\u7cfb\u662f\u4e0d\u4f1a\u53d8\u7684\u3002\n2. \u6709\u7528\u70b9\u513f\u5b50\u5e26\u6765\u7684\u8d21\u732e\uff08\u6240\u6709\u6709\u7528\u70b9\u513f\u5b50 $v_1$ \u7684 $a_1-a_2$ \u6743\u503c\uff09\u8fd9\u4e2a\u4e1c\u897f\u53ea\u5728\u8fd9\u8f6e\u8ba1\u7b97\u4e2d\u6709\u7528\uff0c\u56e0\u4e3a\u4e0b\u4e00\u8f6e\u53c8\u6709\u4e9b\u70b9\u4f1a\u53d8\u5f97\u6ca1\u7528\uff0c\u6709\u7528\u70b9\u6811\u5f62\u6001\u53d1\u751f\u6539\u53d8\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5728\u8fd9\u8f6e $\\tt dfs$ \u5b8c\u4e4b\u540e\u64a4\u9500\u5806\u4e2d\u4e8c\u7c7b\u5143\u7d20\u7684\u52a0\u5165\u3002\u590d\u6742\u5ea6\u5206\u6790\u8fd8\u662f $\\sum d_u\\log d_u=\\mathcal O(n\\log n)$\u3002\n\n\u5728\u5904\u7406\u597d\u5806\u4e2d\u7684\u4e1c\u897f\u4e4b\u540e\uff0c\u6211\u4eec\u8ba1\u7b97\u524d\u82e5\u5e72\u5c0f\u7684\u5143\u7d20\u4e4b\u548c\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7\u52a8\u6001\u7ef4\u62a4\u5806\u5143\u7d20\u548c\uff0c\u7136\u540e\u8e22\u6389\u591a\u4f59\u5143\u7d20\u7684\u65b9\u6cd5\u89e3\u51b3\u3002\u4f46\u662f\u4f60\u8e22\u6389\u7684\u53ef\u80fd\u6709\u4e0d\u5e94\u8be5\u8e22\u6389\u7684\u4e00\u7c7b\u5143\u7d20\uff0c\u6240\u4ee5\u6b64\u65f6\u8fd8\u9700\u8981\u64a4\u9500\u8fd9\u4e9b\u8e22\u6389\u7684\u64cd\u4f5c\u3002\n\n\u603b\u4f53\u800c\u8a00\u5c31\u662f\u9700\u8981\u4e00\u4e2a\u53ef\u5220\u9664\u64a4\u9500\u5220\u9664\uff0c\u63d2\u5165\u64cd\u4f5c\u7684\u5806\u3002\u8fd9\u4e2a\u53ef\u4ee5\u7ef4\u62a4\u4e24\u4e2a\u5806\u5206\u522b\u8868\u793a\u63d2\u5165\u548c\u5220\u9664\uff0c\u63d2\u5165\u5143\u7d20\u653e\u63d2\u5165\u5806\u5220\u9664\u5143\u7d20\u653e\u5220\u9664\u5806\uff0c\u6c42 `top` \u9700\u8981\u5148\u8e22\u6389\u4e24\u4e2a\u5806\u9876\u90e8\u7684\u76f8\u540c\u5143\u7d20\uff0c\u590d\u6742\u5ea6\u53ef\u4ee5\u5747\u644a\u3002\n\n---\n\n\u5b9e\u73b0\u65f6\u5f88\u5bb9\u6613\u4e0d\u5c0f\u5fc3\u8ba9\u590d\u6742\u5ea6\u5e26\u4e0a\u4e00\u4e2a $n^2$\uff0c\u4e5f\u9700\u8981\u4e00\u4e9b\u4f18\u5316\u3002\n\n\u7136\u540e\u6ce8\u610f\u8fd9\u4e2a\u9898\u662f\u4ea4\u4e92\uff0c\u70b9\u7f16\u53f7\u662f $0\\sim n-1$\uff0c\u5e76\u4e14 $n$ \u7684\u8303\u56f4\u5c0f\u4e00\u70b9\u5c31\u884c\u4e86\u3002\n\n[\u4ee3\u7801](https://www.luogu.com.cn/paste/q3d23958) \u6ca1\u6709\u6ce8\u91ca\u8981\u7684\u8bdd\u53ef\u4ee5\u53bb\u6211\u539f\u9898\u9898\u89e3\u770b\u3002",
        "postTime": 1672882546,
        "uid": 368107,
        "name": "xfrvq",
        "ccfLevel": 7,
        "title": "P7600 [APIO2021] \u5c01\u95ed\u9053\u8def"
    }
]