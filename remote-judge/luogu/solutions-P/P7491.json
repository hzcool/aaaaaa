[
    {
        "content": "\u663e\u7136\u662f SG \u51fd\u6570\u9898\u3002\n\n\u5982\u679c\u4e0d\u4f1a SG \u51fd\u6570\u53ef\u4ee5\u5b66\u4e00\u4e0b\uff0c\u63a8\u9500[\u6211\u7684\u535a\u5ba2](https://59388.blog.luogu.org/game-theory-1)\u3002\n\n\u9898\u5916\u8bdd\uff1a\u672c\u6765\u60f3\u76f4\u63a5\u51fa\u5148\u624b\u662f\u5426\u5fc5\u80dc\u7684\uff0c\u540e\u6765\u61d2\u5f97\u6784\u9020\u540e\u624b\u5fc5\u80dc\u6570\u636e\u5c31\u6574\u6210\u73b0\u5728\u8fd9\u6837\u811a\u9020\u6570\u636e\u90fd\u9a97\u4e0d\u5230\u5206\u7684\u95ee\u6cd5\uff08\n\n\u56de\u5230\u9898\u89e3\u3002\n\nSG \u51fd\u6570\u503c\u89c4\u5f8b\uff1a\n\n\u4ee4 $n=\\left\\lfloor\\dfrac{x}{\\tau+1}\\right\\rfloor$\u3002\u82e5 $x=\\lfloor n\\tau \\rfloor +n+1,n \\in \\mathbb{N}$\uff0c\u5219 $\\operatorname{SG}(x)=\\operatorname{SG}(n)$\uff1b\u5426\u5219 $\\operatorname{SG}(x)=x-n-1=\\lfloor\\sigma x\\rfloor$\u3002\u5176\u4e2d $\\tau=\\dfrac{\\sigma}{1-\\sigma}$\u3002\n\n\u9996\u5148\u6211\u4eec\u6709\u4e00\u4e2a\u5f15\u7406\uff1a\u96c6\u5408 $A=\\{x|x=\\lfloor n\\tau \\rfloor +n+1,n \\in \\mathbb{N}\\}$\uff0c\u5219 $\\forall x \\in \\mathbb{Z_+}$\uff0c$\\lfloor x\\sigma \\rfloor-\\lfloor (x-1)\\sigma \\rfloor=[x \\notin A]$\u3002\n\n\u5f15\u7406\u8bc1\u660e\uff1a\n\n\uff08\u6ce8\uff1a\u4ee5\u4e0b $\\{x\\}$ \u8868\u793a $x-\\lfloor x \\rfloor$\uff09\n\n\u9996\u5148\u6709 $\\tau=\\dfrac{\\sigma}{1-\\sigma}$\uff0c\u6240\u4ee5 $\\sigma=\\dfrac{\\tau}{1+\\tau}$\u3002\n\n\u63a5\u7740\uff0c\u6211\u4eec\u5148\u8bc1\u660e $\\forall x \\in A$\uff0c\u6709 $\\lfloor x\\sigma \\rfloor-\\lfloor (x-1)\\sigma \\rfloor=0$\u3002\n\n\u5bf9\u4e8e $x=\\lfloor n\\tau \\rfloor +n$\uff0c\u6709\n\n$$\\begin{aligned}\n\\lfloor(\\lfloor n\\tau \\rfloor +n)\\sigma\\rfloor&=\\lfloor \\lfloor n\\tau \\rfloor\\sigma+n\\sigma\\rfloor\\\\\n&=\\lfloor n\\tau\\sigma-\\{n\\tau\\}\\sigma+n\\sigma \\rfloor\\\\\n&=\\lfloor n\\sigma(\\tau+1)-\\{n\\tau\\}\\sigma \\rfloor\\\\\n&=\\lfloor n\\tau-\\{n\\tau\\}\\sigma \\rfloor\\\\\n&=\\lfloor \\lfloor n\\tau \\rfloor+\\{n\\tau\\}(1-\\sigma) \\rfloor=\\lfloor n\\tau \\rfloor.\n\\end{aligned}$$\n\n\u5bf9\u4e8e $x=\\lfloor n\\tau \\rfloor +n+1$\uff0c\u6709\n\n$$\\begin{aligned}\n\\lfloor(\\lfloor n\\tau \\rfloor +n+1)\\sigma\\rfloor&=\\lfloor \\lfloor n\\tau \\rfloor\\sigma+n\\sigma+\\sigma\\rfloor\\\\\n&=\\lfloor n\\tau\\sigma+(1-\\{n\\tau\\})\\sigma+n\\sigma \\rfloor\\\\\n&=\\lfloor n\\sigma(\\tau+1)+(1-\\{n\\tau\\})\\sigma \\rfloor\\\\\n&=\\lfloor n\\tau+(1-\\{n\\tau\\})\\sigma \\rfloor\\\\\n&=\\lfloor \\lfloor n\\tau \\rfloor+\\{n\\tau\\}+(1-\\{n\\tau\\})\\sigma \\rfloor\\\\\n&=\\lfloor \\lfloor n\\tau \\rfloor+1-(1-\\{n\\tau\\})(1-\\sigma) \\rfloor=\\lfloor n\\tau \\rfloor.\n\\end{aligned}$$\n\n\u7136\u540e\u6211\u4eec\u8bc1\u660e $\\forall x \\notin A$\uff0c\u6709 $\\lfloor x\\sigma \\rfloor-\\lfloor (x-1)\\sigma \\rfloor=1$\u3002\n\n\u7531\u4e8e $\\sigma<1$\uff0c\u663e\u7136\u6709 $\\lfloor x\\sigma \\rfloor-\\lfloor (x-1)\\sigma \\rfloor \\le 1$\u3002\n\n\u800c\n\n$$\\begin{aligned}\n&\\ \\ \\ \\ \\ \\lfloor (\\lfloor n\\tau \\rfloor+n)\\sigma\\rfloor-\\lfloor [\\lfloor(n-1)\\tau\\rfloor+(n-1)+1]\\sigma \\rfloor\\\\\n&=\\lfloor n\\tau \\rfloor-\\lfloor(n-1)\\tau\\rfloor=(\\lfloor n\\tau \\rfloor+n)-[\\lfloor(n-1)\\tau\\rfloor+(n-1)+1],\n\\end{aligned}$$\n\n\u6545\u53ea\u53ef\u80fd\u6bcf\u4e2a $\\lfloor x\\sigma \\rfloor-\\lfloor (x-1)\\sigma \\rfloor=1$\u3002\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u8bc1\u6bd5\u3002\n\n\u7531\u5f15\u7406\uff0c\u6211\u4eec\u5f97\u5230 $x$ \u7684\u540e\u7ee7\u72b6\u6001\u4e3a $[x-\\lfloor x\\sigma \\rfloor,x-1]$\u3002\u6240\u4ee5\u5f53 $x \\notin A$ \u65f6\uff0c\u6709 $x-\\lfloor x\\sigma \\rfloor=(x-1)-\\lfloor (x-1)\\sigma \\rfloor$\uff0c\u5426\u5219 $x-\\lfloor x\\sigma \\rfloor=(x-1)-\\lfloor (x-1)\\sigma \\rfloor+1$\u3002\n\n\u5f52\u7eb3\u53ef\u8bc1\u89c4\u5f8b\u6210\u7acb\u3002\n\n\u663e\u7136\u6709 $x$ \u53ca\u5176\u540e\u7ee7\u72b6\u6001 SG \u503c\u53d6\u904d $0,1,\\dots,\\lfloor\\sigma x\\rfloor$ \u4e14\u4e92\u4e0d\u91cd\u590d\u3002\u56e0\u6b64\u53ea\u8981\u5bf9\u4e8e\u6700\u7ec8\u6574\u4e2a\u6e38\u620f\u7684 SG \u503c $ans$ \u6ee1\u8db3 $\\operatorname{SG}(x) \\operatorname{xor} ans \\le \\lfloor\\sigma x\\rfloor$ \u5219\u5c06\u7b54\u6848\u52a0\u4e0a $\\dfrac{1}{n\\lfloor\\sigma x\\rfloor}$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log{n})$\u3002\n\nCode:\n```cpp\n#include<cstdio>\n#define rg register\n#define LL __int128\n#define ll unsigned long long\n#define _mu(x) ((ll)((id<4)?(x*mu[id]):(x*(q-p)/q)))\n#define _tau(x) ((ll)((id<4)?(x*tau[id]):(x*q/(q-p))))\n#define _sigma(x) ((ll)((id<4)?(x*sigma[id]):(x*p/q)))\nconst ll ntf=20190816170251;\ninline char rc()\n{\n\tstatic char buf[1048576],*pn=buf,*pe=buf;\n\treturn (pn==pe)&&(pe=(pn=buf)+fread(buf,1,1048576,stdin),pn==pe)?EOF:*pn++;\n}\ninline int read()\n{\n\tint x=0;\n\tchar cc=rc();\n\twhile(cc<'0'||cc>'9')cc=rc();\n\twhile(cc>='0'&&cc<='9')x=x*10+cc-'0',cc=rc();\n\treturn x;\n}\ninline ll _read()\n{\n\tll x=0;\n\tchar cc=rc();\n\twhile(cc<'0'||cc>'9')cc=rc();\n\twhile(cc>='0'&&cc<='9')x=x*10+cc-'0',cc=rc();\n\treturn x;\n}\nvoid print(LL x)\n{\n\tif(x>9)print(x/10);\n\tputchar(x%10^48);\n}\nint id,n,m;\nll s[300007],d,p,q,r,SG[300007];\ndouble mu[7]={0,0.1952621458756,0.4535898384862,0.3819660112501};\ndouble tau[7]={0,5.1213203435596,2.2046349259880,2.61803398874989};\ndouble sigma[7]={0,0.8047378541243,0.5464101615137,0.61803398874989};\ninline ll _gcd(ll a,ll b)\n{\n\twhile(b^=a^=b^=a%=b);\n\treturn a;\n}\nll sg(ll x)\n{\n\tif(!_sigma(x))return 0;\n\tll y=_mu(x);\n\tll t=_tau(y)+1;\n\tif(t==x)return sg(y);\n\telse return _sigma(x);\n}\nLL exgcd(LL a,LL b,LL &x,LL &y)\n{\n\tif(!b)\n\t{\n\t\tx=1,y=0;\n\t\treturn a;\n\t}\n\tLL d=exgcd(b,a%b,y,x);\n\ty-=a/b*x;return d;\n}\ninline LL _inv(LL a)\n{\n\tLL d,x,y;\n\td=exgcd(ntf,a,x,y);\n\treturn (y%ntf+ntf)%ntf;\n}\nint main()\n{\n\tid=rc()^48,n=read();\n\tfor(rg int i=1;i<=n;++i)s[i]=_read();\n\t(id>=4)&&(p=_read(),q=_read(),d=_gcd(p,q),p/=d,q/=d);d=r=m=0;\n\tfor(rg int i=1;i<=n;++i)SG[i]=sg(s[i]),d^=SG[i];\n\tfor(rg int i=1;i<=n;++i)(_sigma(s[i])==0)?(++m):(((SG[i]^d)<=_sigma(s[i]))&&(r+=_inv(_sigma(s[i])),(r>=ntf)&&(r-=ntf)));\n\tprint((d)?r*_inv(n-m)%ntf:0);\n\treturn 0;\n}\n```",
        "postTime": 1616478592,
        "uid": 59388,
        "name": "VinstaG173",
        "ccfLevel": 7,
        "title": "F2 \u84b2\u516c\u82f1\u7684\u7ea6\u5b9a\uff08vol.2\uff09 \u9898\u89e3"
    }
]