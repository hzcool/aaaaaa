[
    {
        "content": "\u6211\u4eec\u5b9a\u4e49\u4e24\u4e2a\u6570\u5217 $a,b$ \u7684\u5377\u79ef\u4e3a $c_n=\\sum\\limits_{i\\oplus j=n}a_ib_j$\uff0c\u5176\u4e2d $\\oplus$ \u8868\u793a $k$ \u8fdb\u5236\u4e0b\u7684\u4e0d\u8fdb\u4f4d\u52a0\u6cd5\u3002\n\n$k$ \u8fdb\u5236 $\\text{FWT}$ \u5c31\u662f\u7528\u6765\u89e3\u51b3\u8fd9\u7c7b\u5377\u79ef\u95ee\u9898\u7684\uff0c\u6838\u5fc3\u601d\u8def\u4e0e $\\text{DFT}$ \u7c7b\u4f3c\uff0c\u6211\u4eec\u5e0c\u671b\u627e\u5230\u4e00\u79cd\u53ef\u9006\u53d8\u6362 $f$\uff0c\u4f7f\u5f97\u4e24\u4e2a\u6570\u5217 $a,b$ \u95f4\u8fdb\u884c\u7684\u8fd0\u7b97\uff0c\u4f53\u73b0\u5728 $f(a),f(b)$ \u4e0a\uff0c\u5373\u4e3a\u5bf9\u5e94\u4f4d\u7f6e\u95f4\u7684\u8fd0\u7b97\u3002\n\n\u8003\u8651\u5230\u4e0d\u8fdb\u4f4d\u52a0\u6cd5\u6bcf\u4e00\u4f4d\u76f8\u4e92\u72ec\u7acb\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u6bcf\u4e00\u4f4d\u5355\u72ec\u8fdb\u884c\u53d8\u6362\uff0c\u8003\u5bdf\u5355\u72ec\u4e00\u4f4d\u7684\u53d8\u6362\u5e94\u8be5\u662f\u4ec0\u4e48\u5f62\u5f0f\uff0c\u53d1\u73b0\u5bf9\u4e8e\u67d0\u4e00\u4f4d\uff0c\u6709 $i\\oplus j=(i+j)\\bmod k$\uff0c\u5373\u5faa\u73af\u5377\u79ef\uff0c\u4f7f\u7528 $\\text{DFT}$ \u5373\u53ef\uff0c\u66b4\u529b $\\text{DFT}$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(k^{n+1}n)$\uff0c$n$ \u4e3a\u4f4d\u6570\u3002\n\n\u4f46\u662f $k$ \u6b21\u5355\u4f4d\u6839 $\\omega_k$ \u53ef\u80fd\u5728\u6a21\u610f\u4e49\u4e0b\u4e0d\u5b58\u5728\uff0c\u8003\u8651\u6269\u57df\uff0c\u5373\u4eba\u4e3a\u5b9a\u4e49\u4e00\u4e2a $x$\uff0c\u6ee1\u8db3 $x^k=1$\uff0c\u90a3\u4e48\u6211\u4eec\u6240\u6709\u6570\u90fd\u53ef\u4ee5\u8868\u793a\u6210 $\\sum\\limits_{i=0}^{k-1}c_ix^i$ \u7684\u5f62\u5f0f\uff0c\u4e24\u4e2a\u6570\u7684\u8fd0\u7b97\u5b9e\u9645\u4e0a\u5c31\u662f\u5728 $\\bmod x^k-1$ \u610f\u4e49\u4e0b\u7684\u8fd0\u7b97\u3002\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u8fd9\u6837\u7684\u6570\u5e76\u4e0d\u6784\u6210\u57df\uff0c\u56e0\u4e3a\u5b58\u5728\u96f6\u56e0\u5b50\uff0c\u5373\u4e00\u4e2a\u6570\u4f1a\u6709\u591a\u79cd\u8868\u793a\u65b9\u6cd5\uff0c\u5f62\u5982\uff08\u771f\u5b9e\u503c\uff09+\uff08\u96f6\u56e0\u5b50\u7684\u7ebf\u6027\u7ec4\u5408\uff09\uff0c\u6211\u4eec\u8981\u627e\u5230\u4e00\u79cd\u5408\u9002\u7684\u6269\u57df\u65b9\u6cd5\uff0c\u907f\u514d\u96f6\u56e0\u5b50\u7684\u5b58\u5728\u3002\u8003\u8651\u5206\u5706\u591a\u9879\u5f0f $\\Phi_k(x)$\uff0c\u5176\u6ee1\u8db3\u5728 $\\mathbb Q$ \u4e0a\u4e0d\u53ef\u7ea6\uff0c\u4e14\u5728 $\\bmod \\Phi_k(x)$ \u4e0b $x$ \u7684\u9636\u4e3a $k$\uff0c\u6b64\u65f6\u5c31\u6ca1\u6709\u96f6\u56e0\u5b50\uff0c\u6240\u4ee5\u6700\u540e\u5f97\u5230\u7684\u7ed3\u679c\u4e00\u5b9a\u53ea\u6709\u5e38\u6570\u9879\u6709\u503c\u3002\u4f46 $\\bmod \\Phi_k(x)$ \u7684\u5e38\u6570\u5f88\u5927\uff0c\u6211\u4eec\u8003\u8651\u5230 $\\Phi_k(x)\\mid x^k-1$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5728\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u5148\u5bf9 $x^k-1$ \u53d6\u6a21\uff0c\u518d\u628a\u6700\u540e\u7684\u7ed3\u679c\u5bf9 $\\Phi_k(x)$ \u53d6\u6a21\u3002\n\n\u7531\u4e8e $\\text{DFT}$ \u7684\u65f6\u5019\uff0c\u9700\u8981\u8fdb\u884c $O(k^2)$ \u6b21\u5355\u9879\u5f0f\u4e58\u591a\u9879\u5f0f\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6 $O(k^{n+2}n)$\u3002\n\n\u4f8b\u9898\u5c31\u662f P5109 \u5f52\u7a0b\uff0c\u7ed9\u5b9a\u4e00\u4e2a\u957f\u4e3a $n$ \u7684\u6570\u5217 $a$\uff0c\u6bcf\u6b21\u8be2\u95ee\u4e24\u4e2a\u6570 $p,x$\uff0c\u95ee\u6709\u591a\u5c11\u957f\u5ea6\u6700\u591a\u4e3a $p$ \u7684\u6570\u5217 $b$ \u6ee1\u8db3 $1\\le b_i\\le n,b_1\\oplus b_2\\oplus \\cdots\\oplus b_k=x$\uff0c\u5176\u4e2d $k$ \u4e3a $b$ \u7684\u957f\u5ea6\u3002\n\n\u6211\u4eec\u4ee4 $c_i=\\sum\\limits_{j=1}^n[a_j=i]$\uff0c\u90a3\u4e48\u9898\u76ee\u6c42\u7684\u5b9e\u9645\u4e0a\u5c31\u662f $(c^0+c^1+\\cdots+c^p)_x$\uff0c\u7531\u4e8e\u6211\u4eec\u4e0d\u80fd\u6c42\u9006\uff0c\u6240\u4ee5\u4e0d\u80fd\u7528\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\uff0c\u8003\u8651\u500d\u589e\uff0c\u6c42\u51fa $c^1,c^2,c^4,c^8,\\cdots$ \u548c $\\sum\\limits_{i=0}^0c^i,\\sum\\limits_{i=0}^1c^i,\\sum\\limits_{i=0}^3c^i,\\sum\\limits_{i=0}^7c^i,\\cdots$ \u5373\u53ef\u5feb\u901f\u6c42\u89e3\u3002\n\n```cpp\n#include<iostream>\nusing std::cin;\nusing std::cout;\nint const mod=2333;\nint pow(int x,int y){\n\tint res=1;\n\twhile(y){\n\t\tif(y&1) res=1ll*res*x%mod;\n\t\tx=1ll*x*x%mod,y>>=1;\n\t}\n\treturn res;\n}\nint n,m,v,k,lim,iv,pw[14];\nstruct node{\n\tint a[11];\n\tnode():a(){}\n\tint operator [](int x)const{return a[x];}\n\tint& operator [](int x){return a[x];} \n\tvoid operator +=(node const &x){for(int i=0;i<k;i++) a[i]+=x[i];}\n\tvoid fit(){for(int i=0;i<k;i++) a[i]%=mod;}\n\tvoid operator *=(int y){for(int i=0;i<k;i++) a[i]=a[i]*y%mod;}\n\tfriend node operator *(node const &x,node const &y){\n\t\tstatic int a[20];\n\t\tnode ans;\n\t\tfor(int i=0;i<k+k;i++) a[i]=0;\n\t\tfor(int i=0;i<k;i++) for(int j=0;j<k;j++) a[i+j]+=x[i]*y[j];\n\t\tfor(int i=0;i<k;i++) ans[i]=(a[i]+a[i+k])%mod;\n\t\treturn ans;\n\t}\n\tfriend node operator +(node const &x,node const &y){\n\t\tnode ans;\n\t\tfor(int i=0;i<k;i++) ans[i]=(x[i]+y[i])%mod;\n\t\treturn ans;\n\t}\n\tnode apply(int x)const{\n\t\tx=(x%k+k)%k;\n\t\tnode ans;\n\t\tfor(int i=0;i<k;i++) ans[(i+x)%k]=a[i];\n\t\treturn ans;\n\t}\n}T;\nstruct poly{\n\tnode c[6600];\n\tpoly():c(){}\n\tnode operator [](int x)const{return c[x];}\n\tnode& operator [](int x){return c[x];} \n\tvoid dwt(){\n\t\tfor(int i=0;i<v;i++)\n\t\t\tfor(int a=0;a<lim;a+=pw[i+1])\n\t\t\t\tfor(int b=0;b<pw[i];b++){\n\t\t\t\t\tstatic node x[10],y[10];\n\t\t\t\t\tfor(int j=0;j<k;j++) x[j]=c[a+b+j*pw[i]],y[j]=node();\n\t\t\t\t\tfor(int j=0;j<k;j++) for(int u=0;u<k;u++) y[j]+=x[u].apply(j*u);\n\t\t\t\t\tfor(int j=0;j<k;j++) y[j].fit(),c[a+b+j*pw[i]]=y[j];\n\t\t\t\t}\n\t}\n\tfriend poly operator +(poly const &x,poly const &y){\n\t\tpoly a;\n\t\tfor(int i=0;i<lim;i++) a[i]=x[i]+y[i];\n\t\treturn a;\n\t}\n\tfriend poly operator *(poly const &x,poly const &y){\n\t\tpoly a;\n\t\tfor(int i=0;i<lim;i++) a[i]=x[i]*y[i];\n\t\treturn a;\n\t}\n\tvoid idwt(){\n\t\tfor(int i=0;i<v;i++)\n\t\t\tfor(int a=0;a<lim;a+=pw[i+1])\n\t\t\t\tfor(int b=0;b<pw[i];b++){\n\t\t\t\t\tstatic node x[10],y[10];\n\t\t\t\t\tfor(int j=0;j<k;j++) x[j]=c[a+b+j*pw[i]],y[j]=node();\n\t\t\t\t\tfor(int j=0;j<k;j++) for(int u=0;u<k;u++) y[j]+=x[u].apply(-j*u);\n\t\t\t\t\tfor(int j=0;j<k;j++) y[j].fit(),c[a+b+j*pw[i]]=y[j];\n\t\t\t\t}\n\t\tfor(int i=0;i<lim;i++) c[i]*=iv;\n\t}\n}q,p[50],t[50];\nint read(){\n\tint ans=0;\n\tfor(int i=0;i<v;i++){\n\t\tint x;\n\t\tcin>>x;\n\t\tans+=pw[i]*x;\n\t}\n\treturn ans;\n}\nint const phi[]={0,1,1,2,2,4,2,6,4,6,4},mu[]={0,1,-1,-1,0,-1,1,-1,0,0,1};\nvoid init(){\n\tT[0]=1;\n\tfor(int i=1;i<=k;i++)if(k%i==0){\n\t\tif(mu[k/i]==1) for(int j=phi[k];j>=i;j--) T[j]-=T[j-i];\n\t\telse if(mu[k/i]==-1) for(int j=i;j<=phi[k];j++) T[j]+=T[j-i];\n\t}\n}\nint deal(node x){\n\tint n=phi[k];\n\tfor(int i=k-1;i>=n;i--){\n\t\tint u=x[i];\n\t\tfor(int j=1;j<=n;j++) x[i-j]=(x[i-j]-u*T[n-j]%mod+mod)%mod;\n\t}\n\treturn x[0];\n}\nint main(){\n\tstd::ios::sync_with_stdio(false),cin.tie(nullptr);\n\tcin>>n>>m>>v>>k;\n\t++k,iv=pow(pow(k,mod-2),v),init();\n\tpw[0]=1;\n\tfor(int i=1;i<=v;i++) pw[i]=pw[i-1]*k;\n\tlim=pw[v];\n\tfor(int x;n--;) x=read(),q[x][0]++;\n\tfor(int i=0;i<lim;i++) q[i][0]%=mod;\n\tq.dwt();\n\tfor(int i=0;i<lim;i++) t[0][i][0]=1;\n\tp[0]=q;\n\tfor(int i=1;i<30;i++) p[i]=p[i-1]*p[i-1];\n\tfor(int i=1;i<30;i++) t[i]=t[i-1]+t[i-1]*p[i-1];\n\twhile(m--){\n\t\tint c,x;\n\t\tcin>>c,x=read();\n\t\tpoly ans,w=t[0];\n\t\t++c;\n\t\tfor(int i=29;~i;i--) if(c>=(1<<i)) ans=ans+w*t[i],w=w*p[i],c-=1<<i;\n\t\tans.idwt();\n\t\tcout<<deal(ans[x])<<'\\n';\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1653461518,
        "uid": 55707,
        "name": "gxy001",
        "ccfLevel": 9,
        "title": "P5109 \u5f52\u7a0b"
    }
]