[
    {
        "content": "\u53d1\u73b0\u201c\u6bcf\u79cd\u989c\u8272\u51fa\u73b0\u6b21\u6570\u4e0d\u8d85\u8fc7 $\\lfloor\\dfrac{n}{3}\\rfloor+1$\u201d\u8fd9\u4e2a\u6761\u4ef6\u4e0d\u597d\u76f4\u63a5\u5904\u7406\u3002\u6211\u4eec\u53d1\u73b0\u975e\u6cd5\u7684\u989c\u8272\u6570\u91cf\u4e0d\u4f1a\u8d85\u8fc7 $2$\uff0c\u4e8e\u662f\u8003\u8651\u4e00\u4e2a\u5bb9\u65a5\uff0c\u7b54\u6848\u5373\u4e3a \u4e0d\u7ba1\u4f7f\u7528\u6570\u91cf\u9650\u5236\u76f4\u63a5\u7528\u6811\u67d3\u8272\u5f97\u5230\u7684\u7b54\u6848 \u51cf\u53bb \u81f3\u5c11\u6709\u4e00\u79cd\u975e\u6cd5\u989c\u8272\u5f97\u5230\u7684\u7b54\u6848 \u52a0\u4e0a \u6709\u4e24\u79cd\u975e\u6cd5\u989c\u8272\u5f97\u5230\u7684\u7b54\u6848\u3002\u73b0\u5728\u6211\u4eec\u8003\u8651\u6c42\u8fd9\u4e09\u4e2a\u4e1c\u897f\u3002  \n\n\u9996\u5148\u662f\u4e0d\u7ba1\u4f7f\u7528\u6570\u91cf\u9650\u5236\u76f4\u63a5\u7528\u6811\u67d3\u8272\u5f97\u5230\u7684\u7b54\u6848\u3002\u6211\u4eec\u53d1\u73b0\uff0c\u5047\u8bbe\u4ee5 $1$ \u4e3a\u6839\uff0c\u5982\u679c\u6211\u4eec\u4ece\u6839\u5f80\u4e0b\u67d3\u8272\uff0c\u90a3\u4e48\u6bcf\u4e2a\u70b9\u7684\u989c\u8272\u53ea\u4f1a\u88ab\u5b83\u7684\u7236\u4eb2\u6240\u9650\u5236\uff0c\u800c $1$ \u53f7\u70b9\u6ca1\u6709\u9650\u5236\u3002\u4e8e\u662f\u7b54\u6848\u5373\u4e3a $m\\times (m-1)^{n-1}$\u3002  \n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u81f3\u5c11\u6709\u4e00\u79cd\u975e\u6cd5\u989c\u8272\u5f97\u5230\u7684\u7b54\u6848\u3002\u6211\u4eec\u5f88\u660e\u663e\u9700\u8981\u628a\u8fd9\u79cd\u989c\u8272\u548c\u5176\u5b83\u989c\u8272\u5206\u5f00\u7b97\uff0c\u4e8e\u662f\u6211\u4eec\u8003\u8651\u4e00\u4e2a\u6811\u5f62 dp\u3002\u8bb0 $g_{u,j,0/1}$ \u4e3a $u$ \u5b50\u6811\u9009\u4e86 $j$ \u4e2a\u8fd9\u79cd\u989c\u8272\uff0c$u$ \u6709\u6ca1\u6709\u88ab\u9009\u3002\u521d\u59cb\u5316 $g_{u,0,0}\\leftarrow m-1,g_{u,1,1}\\leftarrow 1$\u3002  \n\u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u8f6c\u79fb\uff0c\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u8981\u5c06 $v$ \u8f6c\u79fb\u5230 $u$ \u4e0a\u53bb\uff0c\u8fd9\u5f88\u660e\u663e\u9700\u8981\u4e00\u4e2a\u6811\u5f62\u80cc\u5305\uff0c\u4e8e\u662f\u6211\u4eec\u7528\u6811\u5f62\u80cc\u5305\u7684\u65b9\u5f0f\u679a\u4e3e $j,k$\uff0c\u4ee3\u8868 $u$ \u548c $v$ \u4e4b\u524d\u5b50\u6811\u5171\u9009 $j$ \u4e2a\uff0c$v$ \u9009 $k$ \u4e2a\u3002\u8f6c\u79fb\u7684\u65b9\u7a0b\u4e3a\uff1a\n\n$$g_{u,j+k,0}\\leftarrow g_{u,j+k,0}+g_{u,j,0}\\times(g_{v,k,1}+g_{v,k,0}\\times\\tfrac{m-2}{m-1})$$\n$$g_{u,j+k,1}\\leftarrow g_{u,j+k,1}+g_{u,j+k,1}+g_{u,j,1}\\times g_{v,k,0}$$  \n\u89e3\u91ca\uff1a\u628a $v$ \u5408\u5e76\u4e0a\u53bb\u540e\u4e24\u4e2a\u5b50\u6811\u9009\u7684\u989c\u8272\u4e2a\u6570\u80af\u5b9a\u662f\u8981\u76f8\u52a0\u7684\u3002\u5982\u679c $u$ \u9009\u4e86\u8fd9\u79cd\u989c\u8272\uff0c\u90a3 $v$ \u5fc5\u987b\u4e0d\u9009\u3002\u5982\u679c $u$ \u4e0d\u9009\uff0c$v$ \u53ef\u4ee5\u9009\u4e5f\u53ef\u4ee5\u4e0d\u9009\uff0c\u5982\u679c\u4e0d\u9009\u7684\u8bdd\u65b9\u6848\u4f1a\u5c11\u4e00\u79cd\uff0c\u4f46\u662f\u6211\u4eec\u5728 $v$ \u90a3\u91cc\u7edf\u8ba1\u7684\u8d21\u732e\u662f $m-1$\uff0c\u73b0\u5728\u8981\u628a\u5b83\u53d8\u6210 $m-2$\u3002\u8fd9\u90e8\u5206\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n\u6700\u540e\u662f\u6709\u4e24\u79cd\u975e\u6cd5\u989c\u8272\u5f97\u5230\u7684\u7b54\u6848\uff0c\u6709\u4e86\u4e0a\u9762\u90a3\u79cd\u60c5\u51b5\uff0c\u8fd9\u4e00\u79cd\u7684 dp \u5c31\u5f88\u597d\u5217\u4e86\u3002\u6211\u4eec\u8bb0 $f_{u,j,j1,0/1/2}$ \u4e3a $u$ \u8fd9\u4e2a\u5b50\u6811\u9009\u4e86 $j$ \u4e2a\u4e00\u53f7\u989c\u8272\uff0c $j1$ \u4e2a\u4e8c\u53f7\u989c\u8272\uff08\u5f88\u660e\u663e\u8fd9\u6837\u8ba1\u7b97\u7684\u8bdd\u8fd9\u4e24\u4e2a\u9009\u51fa\u6765\u7684\u989c\u8272\u662f\u6709\u5e8f\u7684\uff09\uff0c\u5f53\u524d\u70b9\u6ca1\u9009/\u9009\u4e86\u4e00\u53f7/\u9009\u4e86\u4e8c\u53f7\u3002\u521d\u59cb\u5316 $f_{u,0,0,0}=m-2,f_{u,1,0,1}=f_{u,0,1,2}=1$  \n\u8f6c\u79fb\u4e5f\u548c\u4e0a\u9762\u7c7b\u4f3c\u3002\u5bf9\u4e8e\u4e00\u4e2a\u8981\u8f6c\u79fb\u4e0a\u6765\u7684 $v$\uff0c\u679a\u4e3e $j,j1,k,k1$\uff0c\u4ee3\u8868 $u$ \u548c $v$ \u4e4b\u524d\u5b50\u6811\u5171\u9009 $j$ \u4e2a\u4e00\u53f7\u989c\u8272\uff0c$j1$ \u4e2a\u4e8c\u53f7\u989c\u8272\uff0c$v$ \u9009 $k$ \u4e2a\u4e00\u53f7\u989c\u8272\uff0c$k1$ \u4e2a\u4e8c\u53f7\u989c\u8272\u3002\u8f6c\u79fb\u7684\u65b9\u7a0b\u4e3a\uff1a  \n$$f_{u,j+k,j1+k1,0}\\leftarrow f_{u,j+k,j1+k1,0}+f_{u,j,j1,0}\\times(f_{v,k,k1,0}\\times\\tfrac{m-3}{m-2}+f_{v,k,k1,1}+f_{v,k,k1,2})$$\n$$f_{u,j+k,j1+k1,1}\\leftarrow f_{u,j+k,j1+k1,1}+f_{u,j,j1,1}\\times(f_{v,k,k1,0}+f_{v,k,k1,2})$$\n$$f_{u,j+k,j1+k1,2}\\leftarrow f_{u,j+k,j1+k1,2}+f_{u,j,j1,2}\\times(f_{v,k,k1,0}+f_{v,k,k1,1})$$  \n\n\u8fd9\u91cc\u5c31\u4e0d\u4f5c\u8fc7\u591a\u89e3\u91ca\u4e86\uff0c\u81ea\u5df1\u5bf9\u7740\u4e0a\u9762\u7684\u89e3\u91ca\u770b\u5c31\u884c\u4e86\u3002\u8fd9\u90e8\u5206\u6211\u95ee\u8fc7\u6559\u7ec3\uff0c\u5b83\u7ed9\u7684\u7b54\u590d\u662f $O(n^4)$\u3002  \n\n\u6700\u540e\u7edf\u8ba1\u7b54\u6848\u7684\u90e8\u5206\u5c31\u8be5\u600e\u4e48\u6837\u600e\u4e48\u6837\uff0c\u9009\u51fa\u4e00/\u4e24\u79cd\u989c\u8272\uff0c\u7136\u540e\u628a $f/g$ \u7684\u503c\u52a0\u8fdb\u7b54\u6848\u91cc\u9762\u5c31\u53ef\u4ee5\u4e86\u3002  \n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int maxn=105,mod=998244353;\nstruct edge {\n\tint next,to;\n} e[maxn*2];\nint h[maxn],cnt,n,m,siz[maxn];\nll g[maxn][maxn][2],f[maxn][maxn][maxn][3],ans,v1,v2,lg[maxn][2],lf[maxn][maxn][3];\nvoid addedge(int x,int y) {\n\te[++cnt].next=h[x],e[cnt].to=y,h[x]=cnt;\n}\nll qpow(ll x,int y) {\n\tll w=1;\n\twhile(y) {\n\t\tif(y&1)w=w*x%mod;\n\t\tx=x*x%mod;\n\t\ty>>=1;\n\t}\n\treturn w;\n}\nll c2(ll x) {\n\treturn x*(x-1)/2%mod;\n}\nvoid dp(int u,int fa) {\n\tg[u][0][0]=m-1,g[u][1][1]=1,siz[u]=1;\n\tf[u][0][0][0]=m-2,f[u][1][0][1]=f[u][0][1][2]=1;\n\tfor(int i=h[u]; i; i=e[i].next) {\n\t\tint v=e[i].to;\n\t\tif(v==fa)continue;\n\t\tdp(v,u);\n\t\tfor(int j=0; j<=siz[u]; j++) {\n\t\t\tmemcpy(lg[j],g[u][j],sizeof(lg[j])),memset(g[u][j],0,sizeof(g[u][j]));\n\t\t\tfor(int k=0; k<=siz[u]-j; k++)memcpy(lf[j][k],f[u][j][k],sizeof(lf[j][k])),memset(f[u][j][k],0,sizeof(f[u][j][k]));\n\t\t}\n\t\tfor(int j=siz[u]; ~j; j--)\n\t\t\tfor(int k=siz[v]; ~k; k--) {\n\t\t\t\tg[u][j+k][1]=(g[u][j+k][1]+lg[j][1]*g[v][k][0])%mod;\n\t\t\t\tg[u][j+k][0]=(g[u][j+k][0]+(g[v][k][1]+g[v][k][0]*v1)%mod*lg[j][0])%mod;\n\t\t\t\tfor(int j1=siz[u]-j; ~j1; j1--)\n\t\t\t\t\tfor(int k1=siz[v]-k; ~k1; k1--) {\n\t\t\t\t\t\tll *to=f[u][j+k][j1+k1],*nu=lf[j][j1],*nv=f[v][k][k1];\n\t\t\t\t\t\tto[2]=(to[2]+nu[2]*(nv[0]+nv[1]))%mod;\n\t\t\t\t\t\tto[1]=(to[1]+nu[1]*(nv[0]+nv[2]))%mod;\n\t\t\t\t\t\tto[0]=(to[0]+(nv[1]+nv[2]+nv[0]*v2)%mod*nu[0])%mod;\n\t\t\t\t\t}\n\t\t\t}\n\t\tsiz[u]+=siz[v];\n\t}\n}\nint main() {\n\tint x,y,lim;\n\tscanf(\"%d%d\",&n,&m),lim=n/3+2;\n\tif(n==1)return printf(\"%d\\n\",m),0;\n\tif(n==2)return printf(\"%lld\\n\",1ll*m*(m-1)%mod),0;\n\tfor(int i=1; i<n; i++) {\n\t\tscanf(\"%d%d\",&x,&y);\n\t\taddedge(x,y),addedge(y,x);\n\t}\n\tv1=qpow(m-1,mod-2)*(m-2)%mod,v2=qpow(m-2,mod-2)*(m-3)%mod;\n\tdp(1,0),ans=qpow(m-1,n-1)*m%mod;\n\tfor(int i=lim; i<=n; i++) {\n\t\tans=(ans-(g[1][i][0]+g[1][i][1])*m%mod+mod)%mod;\n\t\tfor(int j=lim; j<=n-i; j++)ans=(ans+(f[1][i][j][0]+f[1][i][j][1]+f[1][i][j][2])*c2(m))%mod;\n\t}\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1647157556,
        "uid": 104324,
        "name": "abruce",
        "ccfLevel": 7,
        "title": "\u9898\u89e3--P8202 \u67d3\u8272"
    },
    {
        "content": "## G. \u67d3\u8272\n\n**\u9898\u610f**\uff1a\u7ed9\u5b9a\u4e00\u68f5 $n$ \u4e2a\u8282\u70b9\u7684\u6811\uff0c\u8981\u6c42\u7528 $m$ \u79cd\u989c\u8272\u5c06\u5176\u67d3\u8272\uff0c\u8981\u6c42\u76f8\u90bb\u4e24\u4e2a\u8282\u70b9\u7684\u989c\u8272\u4e0d\u540c\uff0c\u4e14\u4efb\u4f55\u4e00\u79cd\u989c\u8272\u7684\u4f7f\u7528\u6b21\u6570\u90fd\u4e0d\u8d85\u8fc7 $\\lfloor\\frac{n}{3}\\rfloor + 1$\u3002\n\n$1 \\leq n \\leq 100$\uff0c$m \\leq n \\leq 10^6$\u3002\n\n**\u5173\u952e\u8bcd**\uff1a\u5bb9\u65a5\uff0cDP\u3002\n\n**\u53c2\u8003\u96be\u5ea6**\uff1a\u84dd/\u7d2b\u3002\n\n**\u89e3\u6790**\uff1a\u672c\u9898\u51fa\u9898\u7075\u611f\u6765\u6e90\u4e8e \u300cCF1487G String Counting\u300d\u548c\u300cLuoguP5664 [CSP-S2019] Emiya \u5bb6\u4eca\u5929\u7684\u996d\u300d\u3002\n\n\u9996\u5148\u6ce8\u610f\u5230 $\\lfloor\\frac{n}{3}\\rfloor + 1$ \u7684\u9650\u5236\uff0c\u53ef\u4ee5\u53d1\u73b0\u5373\u4f7f\u6211\u4eec\u4e0d\u8003\u8651\u8fd9\u4e2a\u9650\u5236\uff0c\u4e5f\u81f3\u591a\u4f1a\u6709\u4e24\u79cd\u989c\u8272\u8d85\u51fa\uff08\u56e0\u4e3a\u4e00\u65e6\u6709\u4e09\u79cd\u989c\u8272\u8d85\u51fa\u5219\u603b\u6570\u5927\u4e8e $n$\uff09\u3002\u4e8e\u662f\u4e0d\u96be\u8bbe\u8ba1\u5bb9\u65a5\uff1a\u7b54\u6848 = \u4e0d\u8003\u8651\u9650\u5236\u7684\u65b9\u6848\u6570 - \u81f3\u5c11\u6709\u4e00\u79cd\u989c\u8272\u8d85\u51fa\u9650\u5236\u7684\u65b9\u6848\u6570 + \u4e24\u79cd\u989c\u8272\u8d85\u51fa\u9650\u5236\u7684\u65b9\u6848\u6570\u3002\n\n\u6211\u4eec\u76f4\u63a5\u8003\u8651\u8ba1\u7b97\u4e24\u79cd\u989c\u8272\u8d85\u51fa\u9650\u5236\u7684\u65b9\u6848\u6570\uff1a\u4e0d\u96be\u8bbe\u8ba1 dp\uff1a\u8bbe $f_{u, p,q,i, j, 0/1/2}$ \u8868\u793a $p$ \u548c $q$ \u662f\u6211\u4eec\u94a6\u5b9a\u7684\u4e24\u79cd**\u53ef\u80fd**\u8d85\u9650\u5236\u7684\u989c\u8272\uff0c\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u91cc\u6709 $i$ \u4e2a $p$ \u989c\u8272\u548c $j$ \u4e2a $q$ \u989c\u8272\uff0c\u4e14 $u$ \u662f\u989c\u8272 $p$ /\u989c\u8272 $q$ /\u5176\u4ed6\u989c\u8272\u7684\u65b9\u6848\u6570\uff0c\u8f6c\u79fb\u6682\u65f6\u4e0d\u8868\u3002\n\n\u8fdb\u4e00\u6b65\u8003\u8651\u53d1\u73b0\u989c\u8272\u4e4b\u95f4\u6ca1\u6709\u672c\u8d28\u533a\u522b\u4e5f\u5c31\u662f\u5bf9\u4e8e\u4e0d\u540c\u7684 $p, q$\uff0c\u7b97\u51fa $f_{u, p, q, i, j, 0/1/ 2}$ \u7684\u7ed3\u679c\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u4e00\u6b21 $f$ \u6570\u7ec4\uff0c\u7136\u540e\u4e58\u4e0a $C_m^2$ \u5373\u53ef\u3002\u4e8e\u662f\u72b6\u6001\u88ab\u4f18\u5316\u4e3a\uff1a\u8bbe $f_{u, i, j, 0/1/2}$ \u8868\u793a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u91cc\u6709 $i$ \u4e2a\u989c\u8272 1 \u548c $j$ \u4e2a\u989c\u8272 2\uff0c\u4e14 $u$ \u662f\u989c\u8272 1/\u989c\u8272 2/\u5176\u4ed6\u989c\u8272\u7684\u65b9\u6848\u6570\u3002\n\n\u65b9\u4fbf\u8d77\u89c1\uff0c\u6211\u4eec\u8bbe\u5df2\u7ecf\u8f6c\u79fb\u4e86 $u$ \u7684\u524d $p - 1$ \u4e2a\u5b69\u5b50\uff0c\u76ee\u524d\u8003\u8651\u5408\u5e76\u7b2c $p$ \u4e2a\u5b69\u5b50 $v$ \u7684\u4fe1\u606f\u3002\u5df2\u5408\u5e76\u7684\u5b69\u5b50\u7684\u4fe1\u606f\u5b58\u50a8\u5728 $h_{p, i, j, 0/1/2}$ \u6570\u7ec4\u4e2d\u3002\n\n$$h_{p, i, j, 0} = \\sum_{x = 0}^i\\sum_{y = 0}^j(f_{v,x,y,0} + f_{v,x,y,1}) \\times h_{p,i - x,j - y,0}$$\n\n$h_{p, i, j, 1}$ \u7684\u8f6c\u79fb\u4e0e\u4e4b\u5b8c\u5168\u5bf9\u79f0\u3002\n\n\u8003\u8651 $h_{p, i, j, 2}$\uff1a\u6b64\u65f6 $u$ \u662f\u4e00\u4e2a\u975e\u989c\u8272 1 \u6216\u989c\u8272 2 \u7684\u5176\u4ed6\u989c\u8272\u3002$v$ \u662f\u989c\u8272 1/2 \u7684\u8f6c\u79fb\u662f\u7b80\u5355\u7684\uff0c\u8003\u8651 $v$ \u4e5f\u662f\u4e00\u4e2a\u5176\u4ed6\u989c\u8272\u65f6\uff0c$v$ \u7684\u989c\u8272\u4e0d\u80fd\u548c $u$ \u7684\u76f8\u540c\u3002\u56e0\u6b64 $v$ \u5bf9 $h_p$ \u7684\u8d21\u732e\u4e0d\u662f $f_{v, ?,?,2}$ \u5168\u90e8\uff0c\u800c\u662f\u9664\u53bb\u4e86 $v$ \u7684\u989c\u8272\u4e0e $u$ \u76f8\u540c\u7684\u90a3\u90e8\u5206\u3002\u6ce8\u610f\u5230 $f_{v}$ \u5171\u8868\u793a\u4e86 $v$ \u53d6 $(m - 2)$ \u79cd\u989c\u8272\u7684\u65b9\u6848\u6570\uff0c\u800c\u989c\u8272\u4e4b\u95f4\u6ca1\u6709\u672c\u8d28\u533a\u522b\uff0c\u56e0\u6b64\u6bcf\u79cd\u989c\u8272\u7684\u65b9\u6848\u6570\u90fd\u662f $\\frac {f_{v, ?, ?, 2}}{m - 2}$\u3002\u53bb\u6389 $u$ \u7684\u989c\u8272\uff0c\u5171\u6709 $m - 3$ \u79cd\u989c\u8272\u4ea7\u751f\u4e86\u8d21\u732e\uff0c\u56e0\u6b64\u603b\u7684\u8d21\u732e\u662f $\\frac{(m - 3)f_{v, ?, ?, 2}}{m - 2}$\u3002\n\n\u4e8e\u662f\u8f6c\u79fb\u5982\u4e0b\uff1a\n\n$h_{p, i, j, 2} = \\sum_{x=  0}^i\\sum_{y = 0}^j(f_{v,x,y,0} + f_{v,x,y,1} + \\frac{(m - 3)f_{v,x,y,2}}{m - 2}) \\times h_{p - 1, i - x, j - y, 2}$\n\n\u56e0\u4e3a\u662f\u6a21\u610f\u4e49\u4e0b\u7684\u8ba1\u6570\uff0c\u6240\u4ee5\u9664\u4ee5 $m - 2$ \u8981\u6539\u4e3a\u4e58 $m - 2$ \u7684\u9006\u3002\u4f46\u662f\u5982\u679c\u5c06 $f_{u, ?, ?, 2}$ \u7684\u65b9\u6848\u6570\u5b9a\u4e49\u4e3a\u67d0\u4e00\u4e2a\u4e0d\u4f1a\u8d85\u51fa\u9650\u5236\u7684\u201c\u989c\u8272 3\u201d\u7684\u65b9\u6848\u6570\uff0c\u5219\u53ef\u4ee5\u89c4\u907f\u6389\u4e58\u9006\u5143\u7684\u8fc7\u7a0b\u3002\n\n\u4e0a\u8ff0\u8f6c\u79fb\u7684\u8fb9\u754c\u6761\u4ef6\u662f $h_{p, 1, 0, 0} = h_{p, 0, 1, 1} = 1$\uff0c$h_{p,0,0,2} = m - 2$\uff0c\u5176\u4f59\u5747\u4e3a $0$\u3002\u82e5\u60f3\u8981\u89c4\u907f\u6c42\u9006\u5143\uff0c\u5219\u4ee4 $h_{p, 0, 0, 2} = 1$ \u5373\u53ef\uff0c\u6700\u540e\u8ba1\u6570\u65f6\u8981\u628a $(m - 2)$ \u518d\u4e58\u4e0a\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c$\\sum_{i = lim + 1}^n\\sum_{j = 1}^nf_{1, i, j, 0/1/2}$ \u5373\u4e3a\u81f3\u5c11\u6709\u4e00\u4e2a\u8d85\u51fa\u9650\u5236\u7684\u65b9\u6848\u6570\uff0c\u5176\u4e2d $lim = \\lfloor\\frac{n}{3}\\rfloor + 1$\u3002\n\n\u5c06 $i$ \u6539\u4e3a\u4ece $1$ \u81f3 $n$ \u679a\u4e3e\uff0c\u5c31\u662f\u4e0d\u8003\u8651\u9650\u5236\u7684\u65b9\u6848\u6570\u3002\n\n\u5f53\u7136\uff0c\u4e0d\u8003\u8651\u9650\u5236\u7684\u65b9\u6848\u6570\u4e5f\u53ef\u4ee5\u8fd9\u6837\u63a8\u5bfc\uff1a\n\n\u8bbe $g_{u, i}$ \u8868\u793a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\uff0c$u$ \u7684\u989c\u8272\u662f $i$ \u7684\u65b9\u6848\u6570\uff1b$G_u$ \u8868\u793a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u7684\u603b\u65b9\u6848\u6570\uff0c\u5219\uff1a\n\n$G_{u} = \\sum\\limits_{col = 1}^m\\prod\\limits_{v \\in son(u)} \\sum\\limits_{1 \\leq j \\leq m}^{j \\neq col}g_{v,j} = \\sum\\limits_{col = 1}^m \\prod\\limits_{v \\in son(u)} \\frac{m - 1}{m}G_v = m\\prod\\limits_{v \\in son(u)} \\frac{m - 1}{m}G_v$\n\n\u8fd9\u91cc\u540c\u6837\u7528\u5230\u4e86\u989c\u8272\u6ca1\u6709\u672c\u8d28\u4e0d\u540c\u3002\n\n\u8003\u8651 $f$ \u6709 $O(n^3)$ \u4e2a\u72b6\u6001\uff0c\u8f6c\u79fb\u662f $O(n^2)$ \u7684\uff0c\u6240\u4ee5\u770b\u8d77\u6765\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n^5)$\u3002\u4f46\u662f\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u7684\u6280\u5de7\u5c06\u5176\u5b9e\u9645\u590d\u6742\u5ea6\u4f18\u5316\u81f3 $O(n^4)$\uff1a\n\n```cpp\nvoid dfs(const int u, const int f) {\n  sz[u] = 1;\n  for (auto v : e[u]) if (v != f) {\n    dfs(v);\n    for (int i = 1; i <= sz[u]; ++i) {\n      for (int x = 1; x <= sz[v]; ++x) {\n        for (int j = 1; j <= sz[u]; ++j) {\n          for (int y = 1; y <= sz[v]; ++y) {\n            // do sth O(1).\n          }\n        }\n      }\n    }\n    sz[u] += sz[v];\n  }\n}\n```\n\n\u8fd9\u662f\u56e0\u4e3a\u679a\u4e3e $i$ \u548c $x$ \u7684\u8fc7\u7a0b\u53ef\u4ee5\u770b\u4f5c\u679a\u4e3e $u$ \u524d\u9762\u7684\u5b50\u6811\u548c $v$ \u8fd9\u4e2a\u5b50\u6811\u91cc\u9762\u7684\u70b9\u7ec4\u6210\u7684\u70b9\u5bf9\uff0c\u663e\u7136\u6574\u68f5\u6811\u7684\u70b9\u5bf9\u53ea\u6709 $O(n^2)$ \u4e2a\uff0c\u6bcf\u4e2a\u70b9\u5bf9\u53ea\u4f1a\u5728 LCA \u5904\u88ab\u679a\u4e3e\u3002\u6240\u4ee5\u904d\u5386\u6811\u4e0a $n$ \u4e2a\u70b9\u5e76\u679a\u4e3e\u5b50\u6811\u95f4\u7684\u70b9\u5bf9\u7684\u603b\u590d\u6742\u5ea6\u662f $O(n^2)$\uff0c\u800c\u91cc\u9762\u4e24\u5c42\u5faa\u73af\u4e5f\u662f $O(n^2)$\uff0c\u6545\u603b\u590d\u6742\u5ea6\u662f $O(n^4)$\u3002\n\n\u5982\u679c\u56e0\u4e3a\u5e38\u6570\u6781\u5c0f\uff0c$O(n^5)$ \u7684\u7b97\u6cd5\u6709\u53ef\u80fd\u5361\u8fc7\u672c\u9898\u3002\u5728\u6d4b\u8bd5\u4e2d\uff0c\u4e94\u6b21\u65b9\u7b97\u6cd5\u7684\u6700\u574f\u7528\u65f6\u5728 800ms \u5de6\u53f3\uff0c\u56e0\u6b64\u672c\u9898\u7684\u65f6\u95f4\u9650\u5236\u5f00\u5230\u4e86 500ms\u3002\u4e8b\u5b9e\u4e0a\u663e\u800c\u6613\u89c1\uff0c\u91cc\u9762\u4e24\u5c42\u5faa\u73af\u6709\u6781\u5c0f\u7684\u5e38\u6570\uff0c\u6240\u4ee5 $n^4$ \u4e5f\u662f\u4e00\u4e2a\u6bd4\u8f83\u677e\u7684\u4e0a\u754c\u3002\n\n(C++)\n\n```cpp\n#include <array>\n#include <vector>\n#include <iostream>\n#include <cstdio>\n\ntypedef long long int ll;\n\nconst int maxn = 105;\nconst int maxm = 1000006;\nconst int p = 998244353;\n\nint n, m, invm, invm2;\nstd::array<std::array<std::array<std::array<std::array<long long, 3>, maxn>, maxn>, 2>, maxn> f;\nstd::array<int, maxn> pos, sz;\nstd::array<long long, maxn> g;\nstd::array<std::vector<int>, maxn> e;\n\nvoid dfs(const int u, const int fa);\nvoid calc(const int u, const int fa);\n\nint mpow(ll x, int y) {\n  ll ret = 1;\n  while (y) {\n    if (y & 1) (ret *= x) %= p;\n    y >>= 1;\n    (x *= x) %= p;\n  }\n  return ret;\n}\n\nint main() {\n  std::ios::sync_with_stdio(false);\n  std::cin.tie(0);\n  std::cin >> n >> m;\n  invm = mpow(m, 998244351);\n  invm2 = mpow(m - 2, 998244351);\n  long long ans = m;\n  for (int i = 1, u, v; i < n; ++i) {\n    std::cin >> u >> v;\n    e[u].push_back(v);\n    e[v].push_back(u);\n  }\n  calc(1, 0);\n  ll s1 = 0, s2 = 0;\n  for (int i = n / 3 + 2; i <= n; ++i) {\n    for (int j = 0; j <= n; ++j) {\n      for (int k = 0; k <= 2; ++k) {\n        (s1 += f[1][pos[1]][i][j][k]) %= p;\n      }\n    }\n    for (int j = n / 3 + 2; j <= n; ++j) {\n      for (int k = 0; k <= 2; ++k) {\n        (s2 += f[1][pos[1]][i][j][k]) %= p;\n      }\n    }\n  }\n  ans = g[1];\n  ans -= m * s1 % p;\n  ans += (m - 1ll) * m / 2 % p * s2 % p;\n  (ans += p) %= p;\n  std::cout << ans << '\\n';\n}\n\nvoid calc(const int u, const int fa) {\n  f[u][pos[u]][1][0][0] = f[u][pos[u]][0][1][1] = 1; f[u][pos[u]][0][0][2] = m - 2;\n  sz[u] = 1;\n  g[u] = m;\n  for (auto v : e[u]) if (v != fa) {\n    calc(v, u);\n    pos[u] ^= 1;\n    (g[u] *= (m - 1ll) * invm % p * g[v] % p) %= p;\n    for (int i = 0; i <= sz[u] + sz[v]; ++i) {\n      for (int j = 0; j <= sz[u] + sz[v]; ++j) {\n        f[u][pos[u]][i][j].fill(0);\n      }\n    }\n    for (int i = sz[u]; i >= 0; --i) {\n      for (int x = 0; x <= sz[v]; ++x) {\n        for (int j = sz[u]; j >= 0; --j) {\n          for (int y = 0; y <= sz[v]; ++y) {\n            (f[u][pos[u]][i + x][j + y][0] += (f[u][pos[u] ^ 1][i][j][0]) * (f[v][pos[v]][x][y][1] + f[v][pos[v]][x][y][2]) % p) %= p;\n            (f[u][pos[u]][i + x][j + y][1] += (f[u][pos[u] ^ 1][i][j][1]) * (f[v][pos[v]][x][y][0] + f[v][pos[v]][x][y][2]) % p) %= p;\n            (f[u][pos[u]][i + x][j + y][2] += (f[u][pos[u] ^ 1][i][j][2]) * ((f[v][pos[v]][x][y][0] + f[v][pos[v]][x][y][1]) % p \n                + f[v][pos[v]][x][y][2] * invm2 % p * (m - 3) % p) % p) %= p;\n          }\n        }\n      }\n    }\n    sz[u] += sz[v];\n  }\n}\n```",
        "postTime": 1647089043,
        "uid": 65363,
        "name": "\u4e00\u6276\u82cf\u4e00",
        "ccfLevel": 7,
        "title": "P8202"
    },
    {
        "content": "# P8202 \u67d3\u8272\n\n\u6811\u5f62 DP\uff0c\u662f\u65e0\u9700\u6c42\u9006\u5143\u7684\u7248\u672c\u3002\n\n$\\tiny{\u9a8c\u9898\u4eba\u9898\u89e3(?)}$\n\n\u6211\u4eec\u8bbe $Lim = \\lfloor \\frac n3 \\rfloor + 2$\uff0c\u7ea6\u675f $3$ \u5c31\u53d8\u6210\u6240\u6709\u989c\u8272\u51fa\u73b0\u6b21\u6570\u90fd\u4e0d\u5927\u4e8e\u7b49\u4e8e $Lim$\u3002\n\n## \u5bb9\u65a5\n\n\u5148\u7b97\u51fa\u5ffd\u7565\u9650\u5236 $3$ \u7684\u65b9\u6848\u6570\u3002\u7136\u540e\u51cf\u53bb\u89c4\u5b9a\u67d0\u4e2a\u989c\u8272\u51fa\u73b0\u5927\u4e8e\u7b49\u4e8e $Lim$ \u7684\u65b9\u6848\u6570\uff0c\u8fd9\u65f6\u4e24\u4e2a\u989c\u8272\u5927\u4e8e\u7b49\u4e8e $Lim$ \u7684\u65b9\u6848\u88ab\u51cf\u53bb\u4e86\u4e24\u6b21\uff0c\u6240\u4ee5\u6700\u540e\u52a0\u4e0a\u4e24\u4e2a\u989c\u8272\u5927\u4e8e\u7b49\u4e8e $Lim$ \u7684\u65b9\u6848\u6570\u3002\n\n## \u8bbe\u8ba1\n\n\u6bcf\u4e2a\u70b9\u7684\u72b6\u6001 $f_{i, j, 0/1/2}$ \u8868\u793a\u8fd9\u4e2a\u70b9\u7684\u5b50\u6811\u4e2d\u989c\u8272 $1$ \u7684\u70b9\u6709 $i$ \u4e2a\uff0c\u989c\u8272 $2$ \u7684\u70b9\u6709 $j$ \u4e2a\uff0c\u8fd9\u4e2a\u70b9\u7684\u989c\u8272\u4e3a\u5176\u5b83\u786e\u5b9a\u7684\u989c\u8272/\u989c\u8272 $1$/\u989c\u8272 $2$ \u7684\u65b9\u6848\u6570\u3002\n\n\u6ce8\u610f\u8fd9\u4e2a\u72b6\u6001\u6240\u8ba1\u7b97\u7684\u662f\u5f53\u524d\u8282\u70b9\u989c\u8272\u786e\u5b9a\u7684\u65b9\u6848\u6570\uff0c\u8f6c\u79fb\u5230\u7236\u4eb2\u65f6\u8981\u679a\u4e3e\u8fd9\u4e2a\u70b9\u7684\u989c\u8272\u3002\n\n\u56e0\u4e3a $i$ \u6216 $j$ \u5927\u4e8e $Lim$ \u5c31\u5931\u53bb\u610f\u4e49\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u628a\u8f6c\u79fb\u5230\u67d0\u4e00\u7ef4\u5927\u4e8e $Lim$ \u7684\u72b6\u6001\u8f6c\u79fb\u5230\u5bf9\u5e94\u7ef4\u5ea6\u7b49\u4e8e $Lim$ \u7684\u72b6\u6001\u5373\u53ef\u3002\n\n\u4e0b\u9762\u7684 $f$ \u7279\u6307\u6839\u8282\u70b9\u7684 DP \u6570\u7ec4\uff0c\u90a3\u4e48\u603b\u65b9\u6848\u5c31\u53ef\u4ee5\u8868\u793a\u4e3a:\n\n$$\n\\sum_{i, j \\leq Lim} \\max(m - 2, 0) \\times f_{i, j, 0} + f_{i, j, 1} + f_{i, j, 2}\n$$\n\n\u8868\u793a\u679a\u4e3e\u4e86\u6240\u6709\u7ec4\u5408\u60c5\u51b5\u4e0b\uff0c\u6839\u8282\u70b9\u4e3a\u6240\u6709 $m$ \u79cd\u989c\u8272\u7684\u65b9\u6848\u6570\u603b\u548c\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u6c42\u5f3a\u5236\u4f7f\u67d0\u4e2a\u989c\u8272\u51fa\u73b0\u6b21\u6570\u5927\u4e8e\u7b49\u4e8e $Lim$ \u7684\u65b9\u6848\u6570\u3002\u56e0\u4e3a\u6bcf\u4e2a\u989c\u8272\u662f\u7b49\u4ef7\u7684\uff0c\u6240\u4ee5\u4e0d\u7ba1\u5f3a\u5236\u54ea\u4e2a\u989c\u8272\uff0c\u5b83\u7684\u65b9\u6848\u6570\u4e00\u5b9a\u7b49\u4e8e\u5f3a\u5236\u989c\u8272 $1$ \u51fa\u73b0\u6b21\u6570\u5927\u4e8e\u7b49\u4e8e $Lim$\uff0c\u6211\u4eec\u53ea\u8981\u5148\u5f3a\u5236\u989c\u8272 $1$ \u51fa\u73b0\u591a\u6b21\uff0c\u7136\u540e\u4e58\u4ee5 $m$ \u5373\u53ef\u3002\n\n$$\nm \\sum_{i \\leq Lim} \\max(m - 2, 0) \\times f_{Lim, i, 0} + f_{Lim, i, 1} + f_{Lim, i, 2}\n$$\n\n\u6700\u540e\u6c42\u5f3a\u5236\u67d0\u4e24\u4e2a\u989c\u8272\u51fa\u73b0\u6b21\u6570\u5927\u4e8e\u7b49\u4e8e $Lim$ \u7684\u65b9\u6848\u6570\u3002\u4ecd\u7136\u662f\u56e0\u4e3a\u6bcf\u4e2a\u989c\u8272\u7b49\u4ef7\uff0c\u6240\u4ee5\u6211\u4eec\u6c42\u5f3a\u5236\u989c\u8272 $1$ \u548c $2$ \u51fa\u73b0\u6b21\u6570\u5927\u4e8e\u7b49\u4e8e $Lim$ \u7684\u65b9\u6848\u6570\u6700\u540e\u4e58 $\\dfrac{m(m - 1)}2$\u3002\n\n$$\n\\frac{m(m - 1)}2 \\max(m - 2, 0) \\times f_{Lim, Lim, 0} + f_{Lim, Lim, 1} + f_{Lim, Lim, 2}\n$$\n\n## \u8f6c\u79fb\n\n\u6700\u540e\u6211\u4eec\u53ea\u8981\u89e3\u51b3\u8f6c\u79fb\u7684\u95ee\u9898\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u5bf9\u4e8e $x.f_{i, j, 0}$, \u5b83\u7684\u6bcf\u4e2a\u513f\u5b50\u6709\u989c\u8272 $1$, $2$, \u548c $m - 3$ \u79cd\u5176\u5b83\u989c\u8272\u53ef\u9009\uff0c\u679a\u4e3e\u4e24\u90e8\u5206 $1$ \u548c $2$ \u7684\u6570\u91cf\u505a\u6811\u4e0a\u80cc\u5305\u5408\u5e76\u5373\u53ef:\n\n$$\n\\text{New}x.f_{i1 + i2, j1 + j2, 0} = \\text{Old}x.f_{i1, j1, 0} (\\max(m - 3, 0) \\times Son.f_{i2, j2, 0} + Son.f_{i2, j2, 1} + Son.f_{i2, j2, 2})\n$$\n\n\u5bf9\u4e8e $x.f_{i, j, 1}$\uff0c\u5b83\u7684\u6bcf\u4e2a\u513f\u5b50\u6709\u989c\u8272 $2$\uff0c\u548c $m - 2$ \u79cd\u5176\u5b83\u989c\u8272\u53ef\u9009\uff0c\u679a\u4e3e\u4e24\u90e8\u5206 $1$ \u548c $2$ \u7684\u6570\u91cf\u505a\u6811\u4e0a\u80cc\u5305\u5408\u5e76\u5373\u53ef:\n\n$$\n\\text{New}x.f_{i1 + i2, j1 + j2, 1} = \\text{Old}x.f_{i1, j1, 1} (\\max(m - 2, 0) \\times Son.f_{i2, j2, 0} + Son.f_{i2, j2, 2})\n$$\n\n\u5bf9\u4e8e $x.f_{i, j, 2}$\uff0c\u5b83\u7684\u6bcf\u4e2a\u513f\u5b50\u6709\u989c\u8272 $1$\uff0c\u548c $m - 2$ \u79cd\u5176\u5b83\u989c\u8272\u53ef\u9009\uff0c\u679a\u4e3e\u4e24\u90e8\u5206 $1$ \u548c $2$ \u7684\u6570\u91cf\u505a\u6811\u4e0a\u80cc\u5305\u5408\u5e76\u5373\u53ef:\n\n$$\n\\text{New}x.f_{i1 + i2, j1 + j2, 2} = \\text{Old}x.f_{i1, j1, 2} (\\max(m - 2, 0) \\times Son.f_{i2, j2, 0} + Son.f_{i2, j2, 1})\n$$\n\n\u590d\u6742\u5ea6\u7c7b\u4f3c\u4e8e\u6811\u4e0a\u80cc\u5305\uff0c\u662f $O(n^4)$ \u7684\u3002\n\n## \u4ee3\u7801\u5b9e\u73b0\n\n```cpp\nunsigned long long Mod(998244353);\nunsigned long long Ans(0), m, m1, m2, m3;\nunsigned n, Tp;\nunsigned A, B, C, D, t;\nunsigned Cnt(0), Tmp(0);\nstruct Node {\n  vector <Node*> E;\n  unsigned f[36][36][3], Size;\n}N[105];\ninline void DFS(Node* x, Node* Fa) {\n  x->Size = x->f[0][0][0] = x->f[1][0][1] = x->f[0][1][2] = 1;\n  for (auto i : x->E) if (i != Fa) {\n    DFS(i, x);\n    unsigned To(x->Size + i->Size);\n    unsigned Tmpf[min(To, Tp) + 1][36][3];\n    memset(Tmpf, 0, sizeof(Tmpf));\n    for (unsigned j1(min(Tp, x->Size)); ~j1; --j1) for (unsigned j2(min(Tp, x->Size)); ~j2; --j2) {\n      unsigned* J(x->f[j1][j2]);\n      if (!(J[0] || J[1] || J[2])) continue;\n      for (unsigned k1(min(Tp, i->Size)); ~k1; --k1) for (unsigned k2(min(Tp, i->Size)); ~k2; --k2) {\n        unsigned* K(i->f[k1][k2]), * T(Tmpf[min(j1 + k1, Tp)][min(j2 + k2, Tp)]);\n        if (!(K[0] || K[1] || K[2])) continue;\n        T[0] = (T[0] + J[0] * (K[0] * m3 % Mod + K[1] + K[2])) % Mod;\n        T[1] = (T[1] + J[1] * (K[0] * m2 % Mod + K[2])) % Mod;\n        T[2] = (T[2] + J[2] * (K[0] * m2 % Mod + K[1])) % Mod;\n      }\n    }\n    memcpy(x->f, Tmpf, sizeof(Tmpf));\n    x->Size = To;\n  }\n}\nsigned main() {\n  n = RD(), m = RD(), Tp = (n / 3) + 2, m1 = m - 1, m2 = (m1 ? (m1 - 1) : 0), m3 = (m2 ? (m2 - 1) : 0);\n  for (unsigned i(1); i < n; ++i)\n    A = RD(), B = RD(), N[A].E.push_back(N + B), N[B].E.push_back(N + A);\n  DFS(N + 1, NULL);\n  for (unsigned i(0); i <= Tp; ++i) for (unsigned j(0); j <= Tp; ++j) \n    Ans = (Ans + N[1].f[i][j][0] * m2 + N[1].f[i][j][1] + N[1].f[i][j][2]) % Mod;\n  for (unsigned i(0); i <= Tp; ++i) Ans = (Ans + (Mod - m) * ((N[1].f[Tp][i][0] * m2 + N[1].f[Tp][i][1] + N[1].f[Tp][i][2]) % Mod)) % Mod;\n  Ans = (Ans + ((N[1].f[Tp][Tp][0] * m2 + N[1].f[Tp][Tp][1] + N[1].f[Tp][Tp][2]) % Mod) * ((m * m1 >> 1) % Mod)) % Mod;\n  printf(\"%llu\\n\", Ans);\n  return Wild_Donkey;\n}\n```",
        "postTime": 1647142877,
        "uid": 143771,
        "name": "\u6bd4\u5229\u2642\u6d77\u7075\u987f",
        "ccfLevel": 8,
        "title": "\u6811\u5f62 DP: P8202 \u67d3\u8272"
    }
]