[
    {
        "content": "\u7ec8\u4e8e\u4f20\u4e0a\u6765\u4e86\uff0c\u5495\u5495\u4e86\u4e24\u5e74\u4e86\u5c5e\u5b9e\u4e0d\u5bb9\u6613\u3002\n\n\u8003\u8651\u4e00\u4e2a\u5f88\u88f8\u7684\u66b4\u529b\uff0c\u6211\u4eec\u6bcf\u6b21 BFS \u7136\u540e\u66f4\u65b0\u67d3\u8272\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u663e\u7136\u5f88\u52a3\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u6839\u53f7\u5206\u6cbb\u3002\uff08\u4e0b\u9762\u79f0\u76f8\u90bb\u7684\u8fde\u901a\u5757\u4e3a\u90bb\u5c45\uff09\n\n\u8003\u8651\u9762\u79ef $\\leq B$ \u7684\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u66b4\u529b\u626b\u63cf\u5b83\u7684\u90bb\u5c45\u7136\u540e\u5408\u5e76\u3002\n\n\u8003\u8651\u9762\u79ef $>B$ \u7684\u5757\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u5927\u5757\uff0c\u6211\u4eec\u5bf9\u4e8e\u6240\u6709\u5927\u5757\u53bb\u7ef4\u62a4\u4e00\u4e2a\u54c8\u5e0c\u8868\uff0c$f(x)$ \u8868\u793a\u8fd9\u4e2a\u5927\u5757\u989c\u8272\u4e3a $x$ \u7684\u6240\u6709\u90bb\u5c45\u96c6\u5408\uff0c\u7531\u4e8e\u5927\u5757\u4e2a\u6570\u6700\u591a\u53ea\u6709 $\\frac{n}{B}$ \uff0c\u6240\u4ee5\u8fd9\u91cc\u7a7a\u95f4\u590d\u6742\u5ea6\u4e0a\u754c\u4e3a $O(\\frac{n^2}{B})$\uff08\u5b9e\u9645\u5e38\u6570\u5f88\u5c0f\uff09\u3002\n\n\u4e3a\u4e86\u652f\u6301\u8fd9\u4e2a\u54c8\u5e0c\u8868\u7684\u66f4\u65b0\uff0c\u6211\u4eec\u8fd8\u5fc5\u987b\u5bf9\u4e8e\u6240\u6709\u5757\u53bb\u7ef4\u62a4\u5176\u90bb\u5c45\u4e2d\u5927\u5757\u7684\u96c6\u5408\uff0c\u6240\u4ee5\u8fd9\u91cc\u7a7a\u95f4\u590d\u6742\u5ea6\u4e0a\u754c\u540c $O(\\frac{n^2}{B})$\uff08\u5b9e\u9645\u5e38\u6570\u5f88\u5c0f\uff09\u3002\n\n\u518d\u8003\u8651\u4e24\u4e2a\u5757\u7684\u5408\u5e76\uff0c\u6211\u4eec\u91c7\u7528\u542f\u53d1\u5f0f\u5408\u5e76\uff0c\u6bcf\u6b21\u5c06\u5c0f\u7684\u96c6\u5408\u8fde\u5411\u5927\u7684\u96c6\u5408\u3002\n\n\u7531\u4e8e\u6bcf\u4e2a\u8fde\u901a\u5757\u7684\u5408\u5e76\u6b21\u6570\u4e0d\u4f1a\u8d85\u8fc7 $\\log$ \u6b21\uff0c\u6bcf\u6b21\u5c0f\u5757\u5bfb\u627e\u90bb\u5c45\u7684\u590d\u6742\u5ea6\u6700\u591a\u4e3a $B$ \u7ea7\u522b\u7684\uff0c\u5927\u5757\u5bfb\u627e\u90bb\u5c45\u662f $O(\\frac{R\\times S}{B})$ \u7ea7\u522b\u7684\uff0c \u6240\u4ee5\u590d\u6742\u5ea6\u5927\u7ea6\u662f $O(R\\times S\\times \\log(R\\times S)+Q\\times B+\\frac{Q\\times R\\times S}{B})$\u3002\u5373 $O(n\\sqrt n)$ \u7ea7\u522b\u7684\u3002\n\n\u5b9e\u73b0\u65f6\u7ec6\u8282\u8fd8\u662f\u5f88\u591a\u7684\u3002\u81ea\u5df1\u6ce8\u610f\u4e0b\u522b\u5199\u9519\u590d\u6742\u5ea6\u5c31\u884c\u3002\n\n```c++\n//QwQcOrZ yyds!!!\n#include<bits/stdc++.h>\n#define ll long long\n#define F(i,a,b) for (int i=(a);i<=(b);++i)\n#define R(i,a,b) for (int i=(a);i<(b);++i)\n#define D(i,a,b) for (int i=(a);i>=(b);i--)\n#define go(i,x) for (int i=head[x];i;i=e[i].nx)\n#define mp make_pair\n#define pb push_back\n#define pa pair < int,int >\n#define fi first\n#define se second\n#define re register\n#define be begin()\n#define en end()\n#define sqr(x) ((x)*(x))\n#define ret return puts(\"-1\"),0;\n#define put putchar('\\n')\n#define inf 1000000005\n#define mod 998244353\n//#define int ll\n#define N 200005\nusing namespace std;\ninline char gc(){static char buf[100000],*p1=buf,*p2=buf;return p1==p2&&(p2=(p1=buf)+fread(buf,1,100000,stdin),p1==p2)?EOF:*p1++;}\n//#define gc getchar\ninline ll read(){char c=gc();ll su=0,f=1;for (;c<'0'||c>'9';c=gc()) if (c=='-') f=-1;for (;c>='0'&&c<='9';c=gc()) su=su*10+c-'0';return su*f;}\ninline void write(ll x){if (x<0){putchar('-');write(-x);return;}if (x>=10) write(x/10);putchar(x%10+'0');}\ninline void writesp(ll x){write(x),putchar(' ');}\ninline void writeln(ll x){write(x);putchar('\\n');}\nint n,m,Q,fa[N],neg[N],xx,yy,col,ID,cnt;\nconst int c[]={0,0,0,-1,1},d[]={0,-1,1,0,0};\nconst int B=0;\nvector<vector<int> >a,bel;\nstruct\n{\n\tint large,col;\n\tvector<pa>nod;\n\tvector<int>bignb;\n\tmap<int,vector<int>>lis;\n}S[N];\nint gf(int x)\n{\n\tif (x==fa[x]) return x;\n\treturn gf(fa[x]);\n}\nvoid dfs(int x,int y)\n{\n\tS[cnt].nod.push_back({x,y});\n\tbel[x][y]=cnt;\n\tfor (int i=1;i<=4;++i)\n\t{\n\t\tint u=x+c[i],v=y+d[i];\n\t\tif (u>=1&&u<=n&&v>=1&&v<=m)\n\t\t{\n\t\t\tif (a[u][v]==a[x][y]&&!bel[u][v])\n\t\t\t{\n\t\t\t\tdfs(u,v);\n\t\t\t}\n\t\t}\n\t}\n}\ninline void turn_to_big(int now)\n{\n\tS[now].large=1;\n\tvector<int>nowb;\n\tID++;\n\tfor (auto u:S[now].nod)\n\t{\n\t\tfor (int j=1;j<=4;++j)\n\t\t{\n\t\t\tint x=u.fi+c[j],y=u.se+d[j];\n\t\t\tif (x>=1&&x<=n&&y>=1&&y<=m)\n\t\t\t{\n\t\t\t\tif (bel[x][y]==now) continue;\n\t\t\t\tint v=bel[x][y];\n\t\t\t\tif (neg[v]==ID) continue;\n\t\t\t\tneg[v]=ID;\n\t\t\t\tS[v].bignb.push_back(now);\n\t\t\t\tS[now].lis[S[v].col].push_back(v);\n\t\t\t}\n\t\t}\n\t}\n}\ninline int merge(int x,int y)\n{\n\tif (!S[x].large&&S[y].large) turn_to_big(x);\n\telse\n\tif (S[x].large&&!S[y].large) turn_to_big(y);\n\t\n\tif (S[x].nod.size()>S[y].nod.size()) swap(x,y);\n\tfa[x]=y;\n\tfor (auto u:S[x].nod)\n\t{\n\t\tbel[u.fi][u.se]=y;\n\t\tS[y].nod.push_back(u);\n\t}\n\tvector<pa>().swap(S[x].nod);\n\t\n\tif (S[x].bignb.size()>S[y].bignb.size()) \n\t\tS[x].bignb.swap(S[y].bignb);\n\tfor (auto u:S[x].bignb)\n\t{\n\t\tS[y].bignb.push_back(u);\n\t}\n\tvector<int>().swap(S[x].bignb);\n\tre vector<int>nownb;\n\tID++;\n\tfor (auto u:S[y].bignb)\n\t{\n\t\tint uu=gf(u);\n\t\tif (uu!=y&&neg[uu]!=ID)\n\t\t{\n\t\t\tneg[uu]=ID;\n\t\t\tnownb.push_back(uu);\n\t\t}\n\t}\n\tvector<int>().swap(S[y].bignb);\n\tS[y].bignb=nownb;\n\tfor (auto u:S[x].lis)\n\t{\n\t\tint nowcol=u.fi;\n\t\tauto &lis1=u.se;\n\t\tauto &lis2=S[y].lis[nowcol];\n\t\tif (lis1.size()>lis2.size()) lis1.swap(lis2);\n\t\tfor (auto v:lis1)\n\t\t{\n\t\t\tlis2.push_back(v);\n\t\t}\n\t\tvector<int>().swap(lis1);\n\t}\n\tS[x].lis.clear();\n\tif (!S[y].large&&S[y].nod.size()>B) turn_to_big(y);\n\treturn y;\n}\nsigned main()\n{\n\tn=read(),m=read();\n\ta.resize(n+10);\n\tfor (re int i=1;i<=n;++i) a[i].resize(m+10);\n\tbel.resize(n+10);\n\tfor (re int i=1;i<=n;++i) bel[i].resize(m+10);\n\tfor (re int i=1;i<=n;++i)\n\t\tfor (re int j=1;j<=m;++j)\n\t\t\ta[i][j]=read();\n\tfor (re int i=1;i<=n;++i)\n\t\tfor (re int j=1;j<=m;++j)\n\t\t\tif (!bel[i][j]) \n\t\t\t{\n\t\t\t\tbel[i][j]=++cnt;\n\t\t\t\tS[cnt].large=0;\n\t\t\t\tS[cnt].nod.clear();\n\t\t\t\tS[cnt].bignb.clear();\n\t\t\t\tS[cnt].lis.clear();\n\t\t\t\tS[cnt].col=a[i][j];\n\t\t\t\tdfs(i,j);\n\t\t\t}\n\tfor (re int i=1;i<=cnt;++i)\n\t{\n\t\tID++;\n\t\tfor (auto u:S[i].nod)\n\t\t{\n\t\t\tfor (re int j=1;j<=4;++j)\n\t\t\t{\n\t\t\t\tint x=u.fi+c[j],y=u.se+d[j];\n\t\t\t\tif (x>=1&&x<=n&&y>=1&&y<=m)\n\t\t\t\t{\n\t\t\t\t\tif (bel[x][y]==i) continue;\n\t\t\t\t\tint v=bel[x][y];\n\t\t\t\t\tif (neg[v]==ID) continue;\n\t\t\t\t\tneg[v]=ID;\n\t\t\t\t\tif (S[v].nod.size()>B) S[i].bignb.push_back(v);\n\t\t\t\t\tif (S[i].nod.size()>B)\n\t\t\t\t\t\tS[i].lis[S[v].col].push_back(v);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfor (re int i=1;i<=cnt;++i)\n\t{\n\t\tif (S[i].nod.size()>B) turn_to_big(i);\n\t\tfa[i]=i;\n\t}\n//\treturn 0;\n\tQ=read();\n\twhile (Q--)\n\t{\n\t\txx=read(),yy=read(),col=read();\n\t\tre int now=bel[xx][yy];\n//\t\tcout<<now<<\" \"<<S[now].large<<endl;\n\t\tif (!S[now].large)\n\t\t{\n\t\t\tre vector<int>nowb;\n\t\t\tID++;\n\t\t\tfor (auto u:S[now].nod)\n\t\t\t{\n\t\t\t\tfor (re int j=1;j<=4;++j)\n\t\t\t\t{\n\t\t\t\t\tint x=u.fi+c[j],y=u.se+d[j];\n\t\t\t\t\tif (x>=1&&x<=n&&y>=1&&y<=m)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (bel[x][y]==now) continue;\n\t\t\t\t\t\tint v=bel[x][y];\n\t\t\t\t\t\tif (neg[v]==ID) continue;\n\t\t\t\t\t\tneg[v]=ID;\n\t\t\t\t\t\tif (S[v].col==col) nowb.push_back(v);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (auto u:nowb)\n\t\t\t{\n\t\t\t\tnow=merge(now,u);\n\t\t\t}\n\t\t\t\n\t\t\tnowb.clear();\n\t\t\tID++;\n\t\t\tfor (auto u:S[now].bignb)\n\t\t\t{\n\t\t\t\tint uu=gf(u);\n\t\t\t\tif (uu!=now&&neg[uu]!=ID)\n\t\t\t\t{\n\t\t\t\t\tneg[uu]=ID;\n\t\t\t\t\tnowb.push_back(uu);\n\t\t\t\t}\n\t\t\t}\n\t\t\tS[now].bignb.clear();\n\t\t\tS[now].bignb=nowb;\n\t\t\tS[now].col=col;\n\t\t\tfor (auto u:S[now].bignb)\n\t\t\t{\n\t\t\t\tS[u].lis[S[now].col].push_back(now);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tre vector<int>nowb;\n\t\t\t++ID;\n\t\t\tfor (auto u:S[now].lis[col])\n\t\t\t{\n\t\t\t\tint uu=gf(u);\n\t\t\t\tif (uu!=now&&neg[uu]!=ID)\n\t\t\t\t{\n\t\t\t\t\tneg[uu]=ID;\n\t\t\t\t\tif (S[uu].col==col) nowb.push_back(uu);\n\t\t\t\t}\n\t\t\t}\n\t\t\tS[now].lis[col].clear();\n\t\t\tS[now].lis[col]=nowb;\n//\t\t\tcout<<\"!\"<<endl;\n\t\t\tfor (auto u:nowb)\n\t\t\t{\n//\t\t\t\tcout<<u<<endl;\n\t\t\t\tnow=merge(now,u);\n\t\t\t}\n\t\t\tnowb.clear();\n\t\t\tID++;\n\t\t\tfor (auto u:S[now].bignb)\n\t\t\t{\n\t\t\t\tint uu=gf(u);\n\t\t\t\tif (uu!=now&&neg[uu]!=ID)\n\t\t\t\t{\n\t\t\t\t\tneg[uu]=ID;\n\t\t\t\t\tnowb.push_back(uu);\n\t\t\t\t}\n\t\t\t}\n\t\t\tS[now].bignb.clear();\n\t\t\tS[now].bignb.swap(nowb);\n\t\t\t\t\n\t\t\tS[now].col=col;\n\t\t\tfor (auto u:S[now].bignb)\n\t\t\t{\n\t\t\t\tS[u].lis[S[now].col].push_back(now);\n\t\t\t}\n\t\t}\n\t}\n\tfor (re int i=1;i<=n;++i)\n\t{\n\t\tfor (re int j=1;j<=m;++j)\n\t\t\twritesp(S[bel[i][j]].col);\n\t\tputs(\"\");\n\t}\n}\n```",
        "postTime": 1657108009,
        "uid": 120911,
        "name": "Lynkcat",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P8427 [COI 2020] Paint"
    },
    {
        "content": "[$\\tt Link$](/problem/P8427)\n\n\u5148\u8bbe $n=rs$\uff0c\u7136\u540e\u8003\u8651\u4e24\u4e2a\u66b4\u529b\u3002\n\n+ \u66b4\u529b 1\uff1a\u6bcf\u6b21\u66b4\u529b $\\tt dfs$ \u5f53\u524d\u8054\u901a\u5757\u7684\u90bb\u5c45\uff0c\u66b4\u529b\u5408\u5e76\u3002\n+ \u66b4\u529b 2\uff1a`vector` \u6570\u7ec4\u8bb0\u5f55\u4e00\u4e2a\u70b9\u7684\u6240\u6709\u90bb\u5c45\uff0c\u6bcf\u79cd\u989c\u8272\u7684\u90bb\u5c45\uff0c\u4fee\u6539\u7684\u65f6\u5019\u627e\u5230\u5bf9\u5e94\u989c\u8272\u7684\u90bb\u5c45\u5408\u5e76\u3002\u7136\u540e\u66f4\u65b0\u4e0a\u8ff0\u6570\u7ec4\u3002\n\n\u5e38\u89c4\u624b\u6bb5\uff0c\u7528\u6839\u53f7\u644a\u5e73\u4e24\u4e2a\u66b4\u529b\uff1a\u6211\u4eec\u6309\u8054\u901a\u5757\u7684\u5927\u5c0f\u5206\u7c7b\uff0c\u79f0\u5927\u5c0f $\\le\\sqrt n$ \u7684\u4e3a\u5c0f\u5757\uff0c\u5927\u7684\u4e3a\u5927\u5757\u3002\u5bf9\u4e8e\u6bcf\u5757\uff0c\u8bb0\u5f55\u7531 `vector` \u6784\u6210\u7684\u6570\u7ec4\u5982\u4e0b\n\n1. `V` \u4ee3\u8868\u5176\u6240\u6709\u5927\u5757\u7684\u90bb\u5c45\uff08\u4ec5\u5927\u5757\uff09\n1. `C[]` \u4ee3\u8868\u5176\u6bcf\u4e2a\u989c\u8272\u7684\u90bb\u5c45\uff08\u4ec5\u5927\u5757\uff09\n1. `P` \u4ee3\u8868\u5176\u6240\u6709\u5728\u5757\u4e2d\u7684\u8282\u70b9\uff08\u6240\u6709\u5757\u90fd\u8981\u7ef4\u62a4\uff09\n\n+ \u5c0f\u5757\u7684\u4fee\u6539\uff1a\u66b4\u529b\u627e\u5230\u5176\u5bf9\u5e94\u989c\u8272\u90bb\u5c45\uff0c\u7136\u540e\u5408\u5e76\u3002\u6700\u540e\u9700\u8981\u66f4\u65b0\u5176\u90bb\u5c45\u7684 `V`\uff0c`C[]` \u6570\u7ec4\u3002\n+ \u5927\u5757\u7684\u4fee\u6539\uff1a\u6cbf\u7740 `C[]` \u627e\u5230\u5176\u5bf9\u5e94\u989c\u8272\u90bb\u5c45\uff0c\u540c\u6837\u5408\u5e76\u3002\u6700\u540e\u9700\u8981\u66f4\u65b0\u5176\u90bb\u5c45\u7684 `V`\uff0c`C[]` \u6570\u7ec4\u3002\n+ \u4e24\u5757\u7684\u5408\u5e76\uff1a\u542f\u53d1\u5f0f\uff0c\u8ba9\u5c0f\u7684\u5408\u5e76\u5411\u5927\u7684\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u6bcf\u6b21\u53ea\u5408\u5e76 $\\log$ \u6b21\u3002\u5408\u5e76\u7684\u8fc7\u7a0b\u5c31\u662f\u628a\u4e00\u65b9\u7684\u4e09\u4e2a\u6570\u7ec4\u5168\u90e8\u585e\u5230\u53e6\u4e00\u65b9\u3002\n+ \u5c0f\u5757\u53d8\u5927\u5757\uff1a\u76f4\u63a5\u66b4\u529b\u641c\u7d22\uff0c\u8bb0\u5f55\u4e0b\u5176\u4e09\u4e2a\u6570\u7ec4\u3002\n\n\u590d\u6742\u5ea6/\u5e38\u6570\u5206\u6790\uff1a\n\n+ \u4e00\u4e2a\u5c0f\u5757\u6700\u591a\u6709 $\\sqrt n$ \u4e2a\u90bb\u5c45\uff0c\u4e00\u4e2a\u5927\u5757\u6700\u591a\u6709 $n$ \u4e2a\u90bb\u5c45\u3002\n+ \u4e8e\u662f\u770b\u8d77\u6765\u7406\u8bba\u65f6\u7a7a\u90fd\u662f $n\\sqrt n$\u3002\n+ \u4f46\u662f\u53d1\u73b0\u7b2c\u4e00\u6761\u51e0\u4e4e\u5361\u4e0d\u6ee1\uff0c\u5b9e\u73b0\u65f6\u4e5f\u53d1\u73b0\u65f6\u7a7a\u5e38\u6570\u90fd\u5c0f\u7684\u79bb\u8c31\u3002\n\n\u5b9e\u73b0\u7ec6\u8282\uff1a\n\n+ \u5173\u4e8e\u4e09\u4e2a\u6570\u7ec4\uff1a`V,P` \u5f00\u6210 `vector<int>[N]` \u7684\u5f62\u5f0f\uff0c`C[]` \u5f00\u6210 `unordered_map<int,vector<int>>[N]` \u7684\u5f62\u5f0f\u3002\n+ \u5173\u4e8e\u8054\u901a\u5757\u4e4b\u95f4\u7684\u88ab\u5305\u542b\u5173\u7cfb\uff1a\u53ef\u4ee5\u5f00\u6210\u5e76\u67e5\u96c6\u7684\u5f62\u5f0f\uff0c\u8def\u5f84\u538b\u7f29/\u542f\u53d1\u5f0f\u5408\u5e76\u4e00\u8d77\u4f7f\u7528\u53ef\u4ee5\u8ba9\u8fd9\u90e8\u5206\u65f6\u95f4\u51e0\u4e4e\u5ffd\u7565\u4e0d\u8ba1\u3002\n+ \u6240\u6709\u7684\u5750\u6807\u4f7f\u7528 `int` \u5b58\u50a8\uff0c\u8981\u7528\u65f6\u5728\u8f6c\u5316\u4e3a\u4e24\u7ef4\u5750\u6807\u7684\u5f62\u5f0f\u3002\n\n\u7ed9\u4e2a\u80fd\u8fc7\u4e14\u6700\u4f18\u89e3\u7684\u4ee3\u7801\u3002~~\u4f46\u662f\u770b\u5230\u8d3a\u7684\u4eba\u592a\u591a\u4e86\uff0c\u6539\u4e00\u4e2a\u4e0d\u5f71\u54cd\u7406\u89e3\u7684\u5c0f\u9519\u5427\u3002~~\n\n```cpp\nconst int N = 2e5 + 5;\n\nint r,s,n,lim;\nvector<vector<int>> G;\nint fa[N],id[N]; bool big[N],vis1[N];\nint cnt = 0,col[N]; vector<int> P[N];\nvector<int> V[N];\nunordered_map<int,vector<int>> C[N];\n\nint fnd(int x){ return x == fa[x] ? x : fa[x] = fnd(fa[x]); }\n\n#define px(p) ((p - 1) / s + 1)\n#define py(p) ((p - 1) % s + 1)\n#define pp(x,y) ((x - 1) * s + y)\n#define siz(I) P[I].size()\n\nint dx[] = {0,-1,0,1},dy[] = {-1,0,1,0};\n\n#define chk(x,y) (x < 1 || x > r || y < 1 || y > s)\n\nvoid dfs(int x,int y,int c,int I){\n\tint p = pp(x,y);\n\tif(chk(x,y) || G[x][y] != c || vis1[p]) return;\n\tP[I].pb(p); id[p] = I; vis1[p] = true;\n\trep(i,0,3) dfs(x + dx[i],y + dy[i],c,I);\n}\n\nvoid tobig(int I){\n\tvector<int> cls;\n\tbig[I] = true;\n\tfor(int p : P[I]){\n\t\tint x = px(p),y = py(p);\n\t\trep(i,0,3){\n\t\t\tint xx = x + dx[i],yy = y + dy[i];\n\t\t\tif(chk(xx,yy)) continue;\n\t\t\tint J = id[pp(xx,yy)];\n\t\t\tif(I == J || vis1[J]) continue;\n\t\t\tvis1[J] = true; C[I][col[J]].pb(J); V[J].pb(I); cls.pb(J);\n\t\t}\n\t}\n\tfor(int I : cls) vis1[I] = false;\n}\n\nvoid init(){\n\tread(r,s); n = r * s; lim = sqrt(n);\n\trep(i,0,r) G.push_back({0});\n\trep(i,1,r) rep(j,1,s) G[i].push_back(read());\n\trep(i,1,n) if(!vis1[i]){\n\t\tcol[++cnt] = G[px(i)][py(i)];\n\t\tdfs(px(i),py(i),col[cnt],cnt);\n\t}\n\tclr(vis1);\n\trep(I,1,cnt) fa[I] = I;\n\trep(I,1,cnt) if(siz(I) > lim) tobig(I);\n}\n\nint mrg(int I,int J){\n\tif(!big[I] && big[J]) tobig(I);\n\tif(big[I] && !big[J]) tobig(J);\n\tif(siz(I) > siz(J)) swap(I,J);\n\tfa[I] = J;\n\tfor(int p : P[I]) P[id[p] = J].pb(p);\n\tvector<int>().swap(P[I]);\n\tif(V[I].size() > V[J].size()) V[I].swap(V[J]);\n\tfor(int v : V[I]) V[J].pb(v);\n\tvector<int>().swap(V[I]);\n\tvector<int> tmp;\n\tfor(int U : V[J]){ int W = fnd(U); if(W != J && !vis1[W]) vis1[W] = 1,tmp.pb(W); }\n\tfor(int W : tmp) vis1[W] = 0; V[J].swap(tmp);\n\tif(C[I].size() > C[J].size()) C[I].swap(C[J]);\t\n\tfor(auto &[c,l] : C[I]){\n\t\tauto &L = C[J][c];\n\t\tif(l.size() > L.size()) l.swap(L);\n\t\tfor(int x : l) L.pb(x);\n\t\tvector<int>().swap(l);\n\t}\n\tC[I].clear();\n\tif(!big[J] && siz(J) > lim) tobig(J);\n\treturn J;\n}\n\nvoid upd(int I,int c){\n\tcol[I] = c;\n\tvector<int> Tmp,tmp;\n\tif(big[I]){\n\t\tfor(int K : C[I][c]){\n\t\t\tint J = fnd(K);\n\t\t\tif(I != J && col[J] == c && !vis1[J])\n\t\t\t\tvis1[J] = 1,Tmp.pb(J);\n\t\t}\n\t\tC[I][c].clear();\n\t} else {\n\t\tfor(int p : P[I]){\n\t\t\tint x = px(p),y = py(p);\n\t\t\trep(i,0,3){\n\t\t\t\tint xx = x + dx[i],yy = y + dy[i];\n\t\t\t\tif(chk(xx,yy)) continue;\n\t\t\t\tint J = id[pp(xx,yy)];\n\t\t\t\tif(I == J || vis1[J] || col[J] != c) continue;\n\t\t\t\tvis1[J] = 1,Tmp.pb(J);\n\t\t\t}\n\t\t}\n\t}\n\tfor(int U : Tmp) I = mrg(I,U),vis1[U] = 0;\n\tfor(int U : V[I]){ \n\t\tint W = fnd(U);\n\t\tif(W != I && !vis1[W]){\n\t\t\tvis1[W] = 1,tmp.pb(W);\n\t\t\tC[W][c].pb(I);\n\t\t}\n\t}\n\tfor(int W : tmp) vis1[W] = 0;\n}\n\nint main(){\n\tinit();\n\tint q;\n\twhile(q--){\n\t\tint x,y; read(x,y);\n\t\tupd(id[pp(x,y)],read());\n\t}\n\trep(i,1,r) rep(j,1,s) print(col[id[pp(i,j)]],j == s ? '\\n' : ' ');\n\treturn 0;\n}\n```",
        "postTime": 1657615148,
        "uid": 368107,
        "name": "xfrvq",
        "ccfLevel": 7,
        "title": "P8427 [COI2020] Paint"
    },
    {
        "content": "\u4ee4 $n=RS$\u3002\n\n\u5408\u5e76\u64cd\u4f5c\u53ef\u4ee5\u542f\u53d1\u5f0f\u5408\u5e76\uff0c\u597d\u50cf\u505a\u5b8c\u4e86\uff1f\n\n\u4ed4\u7ec6\u4e00\u60f3\u53d1\u73b0\u4e0d\u592a\u5bf9\uff0c\u56e0\u4e3a\u6bcf\u6b21\u627e\u76f8\u90bb\u7684\u8fde\u901a\u5757\u662f $O(siz)$ \u7684\uff0c\u8fd9\u6837\u5bf9\u4e8e $siz$ \u7279\u522b\u5927\u65f6\u590d\u6742\u5ea6\u4f1a\u9000\u5316\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u74f6\u9888\u662f\u5728\u627e\u989c\u8272\u76f8\u540c\u7684\u76f8\u90bb\u8fde\u901a\u5757\u3002\n\n\u8003\u8651\u6839\u53f7\u5206\u6cbb\uff0c\u8bbe\u9608\u503c\u4e3a $B$\u3002\n\n\u5bf9\u4e8e $siz<B$ \u7684\u8fde\u901a\u5757\u76f4\u63a5\u66b4\u529b\u628a\u6bcf\u4e2a\u70b9\u76f8\u90bb\u8fde\u901a\u5757\u627e\u51fa\u6765\uff0c$O(nB)$\u3002\n\n\u5bf9\u4e8e $siz\\ge B$ \u7684\u8fde\u901a\u5757\uff0c\u6700\u591a\u53ea\u6709 $\\frac{n}{B}$ \u4e2a\u8fde\u901a\u5757\uff0c\u76f4\u63a5\u7ef4\u62a4\u6bcf\u4e2a\u5927\u5757\u7684\u6bcf\u79cd\u989c\u8272\u7684\u76f8\u90bb\u8fde\u901a\u5757\uff0c\u6700\u591a\u53ea\u6709 $n$ \u4e2a\u76f8\u90bb\u8fde\u901a\u5757\uff0c\u603b\u5171\u662f $O(\\frac{n^2}{B})$ \u7684\u3002\n\n\u53d6 $B=\\sqrt n$\uff0c\u65f6\u95f4 $O(n\\log n+q\\sqrt n)$\uff0c\u7a7a\u95f4 $O(n\\sqrt n)$\u3002",
        "postTime": 1684673941,
        "uid": 365107,
        "name": "Terac",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8427 [COCI2020] Paint"
    }
]