[
    {
        "content": "### \u9898\u610f\n\n\u8bbe $S_k(x)=\\sum\\limits_{i=0}^{x}i^k$\uff0c\u7ed9\u5b9a\u6b63\u6574\u6570 $n$ \u548c\u5e8f\u5217 $a$\uff0c\u6c42\uff1a\n\n$$\\sum\\limits_{k=0}^{n}S_k(x)a_k$$\n\n$\\texttt{Data Range:}1\\leq n\\leq 2\\times 10^5$\n\n### \u9898\u89e3\n\n\u4f2f\u52aa\u5229\u6570\u677f\u5b50\u9898\u3002\n\n\u5047\u8bbe $S_k(x)=\\sum\\limits_{i=0}^{x-1}i^k$\uff0c\u4e4b\u540e\u53ea\u8981\u628a\u6240\u6709\u7684 $x$ \u6362\u6210 $x+1$ \u5373\u53ef\uff0c\u8fd9\u4e48\u505a\u662f\u65b9\u4fbf\u7528\u4f2f\u52aa\u5229\u6570\u8868\u793a\uff0c\u90a3\u4e48\u6709\n\n$$S_k(x)=\\frac{1}{k+1}\\sum\\limits_{i=0}^{k}\\binom{k+1}{i}B_{i}x^{k+1-i}$$\n\n\u8fd9\u4e2a\u5e76\u4e0d\u662f\u5f88\u597d\u770b\uff0c\u6240\u4ee5\u8003\u8651\u679a\u4e3e $k-i$\uff1a\n\n$$S_k(x)=\\frac{1}{k+1}\\sum\\limits_{i=0}^{k}\\binom{k+1}{k-i}B_{k-i}x^{i+1}$$\n\n\u5229\u7528\u4e8c\u9879\u5f0f\u7684\u5bf9\u79f0\u6027\uff1a\n\n$$S_k(x)=\\frac{1}{k+1}\\sum\\limits_{i=0}^{k}\\binom{k+1}{i+1}B_{k-i}x^{i+1}$$\n\n\u4e8e\u662f\u7b54\u6848\u4e3a\n\n$$\\sum\\limits_{k=0}^{n}\\frac{a_k}{k+1}\\sum\\limits_{i=0}^{k}\\binom{k+1}{i+1}B_{k-i}x^{i+1}$$\n\n\u663e\u7136\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\n\n$$\\sum\\limits_{i=0}^{n}x^{i+1}\\sum\\limits_{k=i}^{n}\\frac{a_k}{k+1}\\binom{k+1}{i+1}B_{k-i}$$\n\n\u62c6\u6389\u4e8c\u9879\u5f0f\n\n$$\\sum\\limits_{i=0}^{n}\\frac{x^{i+1}}{(i+1)!}\\sum\\limits_{k=i}^{n}a_kk!\\frac{B_{k-i}}{(k-i)!}$$\n\n\u76f4\u63a5\u51cf\u6cd5\u5377\u79ef\u5373\u53ef\uff0c\u4f46\u662f\u8fd9\u91cc\u7684 $x$ \u5b9e\u9645\u4e0a\u662f $x+1$\uff0c\u4e8e\u662f\u6211\u4eec\u8003\u8651\u4e0b\u9762\u7684\u95ee\u9898\uff0c\u6c42\n\n$$\\sum\\limits_{i=0}^{n}f_i(x+1)^i$$\n\n\u76f4\u63a5\u5229\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\uff1a\n\n$$\\sum\\limits_{i=0}^{n}f_i\\sum\\limits_{j=0}^{i}\\binom{i}{j}x^j$$\n\n\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\u4e4b\u540e\u51cf\u6cd5\u5377\u79ef\u5373\u53ef\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef int ll;\ntypedef long long int li;\nconst ll MAXN=524291,MOD=998244353;\nll n;\nll omgs[MAXN],fact[MAXN],finv[MAXN],f[MAXN],g[MAXN],h[MAXN];\ninline ll read()\n{\n    register ll num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n}\ninline ll qpow(ll base,ll exponent)\n{\n    ll res=1;\n    while(exponent)\n    {\n        if(exponent&1)\n        {\n            res=(li)res*base%MOD;\n        }\n        base=(li)base*base%MOD,exponent>>=1;\n    }\n    return res;\n}\ninline void setupOmg(ll cnt)\n{\n    ll limit=__lg(cnt)-1;\n    omgs[0]=1,omgs[1<<limit]=qpow(31,1<<(21-limit));\n    for(register int i=limit;i;i--)\n    {\n        omgs[1<<(i-1)]=(li)omgs[1<<i]*omgs[1<<i]%MOD;\n    }\n    for(register int i=1;i<cnt;i++)\n    {\n        omgs[i]=(li)omgs[i&(i-1)]*omgs[i&-i]%MOD;\n    }\n}\ninline void setup(ll cnt)\n{\n    fact[0]=fact[1]=finv[0]=1;\n    for(register int i=1;i<=cnt;i++)\n    {\n        fact[i]=(li)fact[i-1]*i%MOD;\n    }\n    finv[cnt]=qpow(fact[cnt],MOD-2);\n    for(register int i=cnt-1;i;i--)\n    {\n        finv[i]=(li)finv[i+1]*(i+1)%MOD;\n    }\n}\ninline ll& reduce(ll &x)\n{\n\treturn x+=x>>31&MOD;\n}\ninline void DIF(ll *cp,ll cnt)\n{\n\tll lim=__lg(cnt),len=cnt>>1,x;\n\tfor(register int i=0;i<lim;i++,len>>=1)\n\t{\n\t\tfor(register int *j=cp,*omg=omgs;j!=cp+cnt;j+=len<<1,omg++)\n\t\t{\n\t\t\tfor(register int *k=j;k!=j+len;k++)\n\t\t\t{\n\t\t\t\tx=(li)*omg*k[len]%MOD,reduce(k[len]=*k-x),reduce(*k+=x-MOD);\n\t\t\t}\n\t\t}\n\t}\n}\ninline void DIT(ll *cp,ll cnt)\n{\n\tll lim=__lg(cnt),len=1,x,invl;\n\tfor(register int i=0;i<lim;i++,len<<=1)\n\t{\n\t\tfor(register int *j=cp,*omg=omgs;j!=cp+cnt;j+=len<<1,omg++)\n\t\t{\n\t\t\tfor(register int *k=j;k!=j+len;k++)\n\t\t\t{\n\t\t\t\treduce(x=*k+k[len]-MOD);\n\t\t\t\tk[len]=(li)(*k-k[len]+MOD)**omg%MOD,*k=x;\n\t\t\t}\n\t\t}\n\t}\n\treverse(cp+1,cp+cnt),invl=MOD-(MOD-1)/cnt;\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\tcp[i]=(li)cp[i]*invl%MOD;\n\t}\n}\ninline void NTT(ll *cp,ll cnt,ll inv)\n{\n    inv==1?DIF(cp,cnt):DIT(cp,cnt);\n}\ninline void conv(ll fd,ll *f,ll *g,ll *res)\n{\n    ll cnt=1,limit=-1;\n    while(cnt<(fd<<1))\n    {\n        cnt<<=1,limit++;\n    }\n    for(register int i=fd;i<cnt;i++)\n    {\n    \tf[i]=g[i]=0;\n\t}\n    NTT(f,cnt,1),NTT(g,cnt,1);\n    for(register int i=0;i<cnt;i++)\n    {\n\t\tres[i]=(li)f[i]*g[i]%MOD;\n    }\n    NTT(res,cnt,-1);\n}\ninline void inv(ll fd,ll *f,ll *res)\n{\n\tstatic ll tmp[MAXN],tmpr[MAXN];\n\tll cnt=2,limit=0;\n\ttmpr[0]=res[0]=qpow(f[0],MOD-2);\n\twhile(cnt<(fd<<1))\n\t{\n\t\tfor(register int i=0;i<cnt;i++)\n\t\t{\n\t\t\ttmp[i]=f[i],tmpr[i]=i<(cnt>>1)?res[i]:0;\n\t\t}\n\t\tNTT(tmp,cnt,1),NTT(tmpr,cnt,1);\n\t\tfor(register int i=0;i<cnt;i++)\n\t\t{\n\t\t\ttmp[i]=(li)tmp[i]*tmpr[i]%MOD;\n\t\t}\n\t\tNTT(tmp,cnt,-1),memset(tmp,0,cnt<<1),NTT(tmp,cnt,1);\n\t\tfor(register int i=0;i<cnt;i++)\n\t\t{\n\t\t\ttmp[i]=(li)tmp[i]*tmpr[i]%MOD;\n\t\t}\n\t\tNTT(tmp,cnt,-1);\n\t\tfor(register int i=(cnt>>1);i<cnt;i++)\n\t\t{\n\t\t\tres[i]=!tmp[i]?0:MOD-tmp[i];\n\t\t}\n\t\tcnt<<=1,limit++;\n\t}\n\tfor(register int i=fd;i<cnt;i++)\n\t{\n\t\tres[i]=0;\n\t}\n}\nint main()\n{\n \tsetup((n=read())+5),setupOmg(524288);\n\tfor(register int i=0;i<=n;i++)\n\t{\n\t\tf[i]=(li)read()*fact[i]%MOD,h[i]=finv[i+1];\n\t}\n\tinv(n+1,h,g),reverse(f,f+n+1),conv(n+1,f,g,f),reverse(f,f+n+1),g[0]=0;\n\tfor(register int i=0;i<=n+1;i++)\n\t{\n\t\tg[i+1]=f[i],h[i]=finv[i];\n\t}\n\treverse(g,g+n+2),conv(n+2,g,h,f),reverse(f,f+n+2);\n\tfor(register int i=0;i<=n+1;i++)\n\t{\n\t\tprintf(\"%d \",(li)f[i]*finv[i]%MOD);\n\t}\n}\n```",
        "postTime": 1613832669,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3711 \u3010\u4ed3\u9f20\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u8fd9\u4e00\u90e8\u5206\u8282\u9009\u81ea\u675c\u745c\u7693\u300a\u591a\u9879\u5f0f\u53ca\u6c42\u548c\u300b\u3002\u5982\u679c\u4f60\u6709\u4f2f\u52aa\u5229\u6570\u57fa\u7840\uff0c\u53ef\u4ee5\u76f4\u63a5\u8df3\u8fc7\u8fd9\u4e00\u90e8\u5206\u3002\n\n\n\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u6570\u5217$\\{B_i\\}\u200b$\u4e3a\u4f2f\u52aa\u5229\u6570\uff0c\u5f53\u4e14\u4ec5\u5f53\u5b83\u7684\u6307\u6570\u751f\u6210\u51fd\u6570\u4e3a$\\frac{x}{e^x-1}\u200b$\uff0c\u5373$\\sum_{n=0}^\\infty \\frac{B_n}{n!}x^n=\\frac{x}{e^x-1}\u200b$\u3002\n\n\n\u5b9a\u4e49\u4f2f\u52aa\u5229\u591a\u9879\u5f0f$\\beta_n(t)=\\sum_{k=0}^n C_n^k B_{n-k}t^k$\uff0c\u90a3\u4e48\u5b83\u5c31\u662f$t^k$\u548c$B_k$\u7684\u6307\u6570\u751f\u6210\u51fd\u6570\u7684\u79ef\uff0c\u5373$\\sum_{n=0}^\\infty \\frac{\\beta_n(t)}{n!}x^n=(\\sum_{n=0}^\\infty \\frac{B_n}{n!}x^n)(\\sum_{n=0}^\\infty \\frac{t^n}{n!}x^n)$\u3002\n\n\n\u90a3\u4e48\u7531\u4e8e$\\sum_{n=0}^\\infty \\frac{B_n}{n!}x^n=\\frac{x}{e^x-1}$\uff0c$\\sum_{n=0}^\\infty \\frac{t^n}{n!}x^n=e^{tx}$\uff08\u6cf0\u52d2\u5c55\u5f00\uff09\uff0c\u6240\u4ee5$\\sum_{n=0}^\\infty \\frac{\\beta_n(t)}{n!}x^n=\\frac{x}{e^x-1}e^{tx}$\u3002\n\n\n$\\sum_{n=0}^\\infty \\frac{\\beta_n(t+1)-\\beta_n(t)}{n!}x^n=\\frac{xe^{(t+1)x}}{e^x-1}-\\frac{xe^{tx}}{e^x-1}=xe^{tx}=x\\sum_{n=0}^\\infty \\frac{t^n}{n!}{x^n}$\n\n\n\u6240\u4ee5$\\sum_{n=0}^\\infty \\frac{t^n}{n!}{x^n}=\\sum_{n=0}^\\infty \\frac{\\beta_n(t+1)-\\beta_n(t)}{n!}x^{n-1}=\\sum_{n=0}^\\infty \\frac{\\beta_{n+1}(t+1)-\\beta_{n+1}(t)}{(n+1)!}x^n$\u3002\n\n\n\u90a3\u4e48\u5bf9\u6bd4\u4e00\u4e0b\u7cfb\u6570\u53ef\u4ee5\u53d1\u73b0$\\frac{t^n}{n!}=\\frac{\\beta_{n+1}(t+1)-\\beta_{n+1}(t)}{(n+1)!}$\uff0c$\\beta_{n+1}(t+1)-\\beta_{n+1}(t)=(n+1)t^n$\u3002\n\n\n\u8003\u8651\u8ba1\u7b97$S_k(x)=\\sum_{i=1}^x i^k$\uff0c\u628a\u53f3\u8fb9\u7684t\u4ece1\u5230x\u6c42\u548c\uff0c\u90a3\u4e48\u5de6\u8fb9\u6211\u4eec\u53d1\u73b0\u7c7b\u4f3c\u88c2\u9879\u76f8\u6d88\u6d88\u6389\u4e86\uff0c\u6700\u540e\u5269\u4e0b$\\beta_{k+1}(x+1)-\\beta_{k+1}(0)$\uff0c\u90a3\u4e48$S_k(x)=\\frac{\\beta_{k+1}(x+1)-\\beta_{k+1}(0)}{k+1}$\uff0c\u5e26\u5165\u4e00\u6ce2$\\beta$\u7684\u5b9a\u4e49\u53ef\u4ee5\u53d1\u73b0$S_k(x)=\\frac{1}{k+1}\\sum_{g=0}^k C_{k+1}^g B_g x^{k+1-g}$\u3002\n\n\n\u8df3\u8fc7\u90e8\u5206\u5230\u6b64\u7ed3\u675f\u3002\u8003\u8651\u5982\u4f55\u6c42\u51fa\u4f2f\u52aa\u5229\u6570\uff0c$\\sum_{i=0}^\\infty \\frac{B_i}{i!}x^i=\\frac{x}{e^x-1}=\\frac{x}{\\sum_{i=1}^\\infty \\frac{x^i}{i!}}=\\frac{1}{\\sum_{i=0}^\\infty \\frac{x^i}{(i+1)!}}$\uff0c\u90a3\u4e48\u6211\u4eec\u628a\u5206\u6bcd\u8fd9\u4e2a\u591a\u9879\u5f0f\u6c42\u9006\u5143\u5373\u53ef\u3002$O(nlogn)$\u3002\n\n\n\u56de\u5230\u539f\u95ee\u9898\uff0c$\\sum_{k=0}^{n}S_k(x)a_k=\\sum_{k=0}^n\\frac{a_k}{k+1}\\sum_{g=0}^k C_{k+1}^g B_g x^{k+1-g}=\\sum_{k=0}^n a_kk!\\sum_{g=0}^n\\frac{B_g}{g!}\\frac{x^{k+1-g}}{(k+1-g)!}$\u3002\n\n\n\u90a3\u4e48\u8003\u8651\u4ee4$X_k=a_kk!$\uff0c$Y_k=\\frac{B_k}{k!}$\uff0c\u90a3\u4e48$x^a$\u7684\u7cfb\u6570\u4e3a$\\frac{1}{a!}\\sum_k \\sum_g X_k Y_g [k+1-g==a]$\u3002\n\n\n\u6309\u7167\u5e38\u7528\u6280\u5de7\uff0c\u4ee4$Y'_{k}=Y_{n+1-k}$\uff0c\u90a3\u4e48$x^a$\u7684\u7cfb\u6570\u4e3a$\\frac{1}{a!}\\sum_k \\sum_g X_k Y'_g [k+g==a+n]$\u3002\u76f4\u63a5\u5c06X\u4e0eY'\u5377\u79ef\u5373\u53ef\u3002$O(nlogn)$\u3002\n",
        "postTime": 1492355873,
        "uid": 4134,
        "name": "fjzzq2002",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3711 \u3010\u4ed3\u9f20\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u6839\u636e Faulhaber \u516c\u5f0f\uff0c\u6709\n\n$$S_p(n)=[p=0]+\\frac{1}{p+1}\\sum _{j=0}^{p}\\binom{p+1}{j}B^+_jn^{p+1-j}$$\n\n\u53ef\u4ee5\u5148\u4e0d\u8003\u8651 $[p=0]$ \u8fd9\u4e2a\u90e8\u5206\uff0c\u6700\u540e\u54e6\u94fa\u52a0\u4e0a\u53bb\uff0c\u9000\u5316\u4e3a\n\n$$S_p(x)=\\frac{1}{p+1}\\sum _{j=0}^{p}\\binom{p+1}{j}B^+_jx^{p+1-j}$$\n\n$$S_p(x)[x^j]=\\frac{1}{p+1}\\binom{p+1}{p+1-j}B^+_{p+1-j}$$\n\n\u4e8e\u662f\u76f4\u63a5\u66b4\u529b\u63a8\u5f0f\u5b50\u4e86\u3002\n\n$$c_j=\\sum_{p=j-1}^n a_pS_p(x)[x^j]$$\n$$c_j=\\sum_{p=j-1}^n a_p\\frac{1}{p+1}\\binom{p+1}{p+1-j}B^+_{p+1-j}$$\n$$c_j=\\sum_{p=j-1}^n a_p\\frac{1}{p+1}\\frac{(p+1)!}{j!(p+1-j)!}B^+_{p+1-j}$$\n$$c_j=\\frac{1}{j!}\\sum_{p=j-1}^n a_p\\frac{p!}{(p+1-j)!}B^+_{p+1-j}$$\n$$c_j=\\frac{1}{j!}\\sum_{p=j-1}^n (a_pp!)(\\frac{B^+_{p+1-j}}{(p+1-j)!})$$\n$$c_j=\\frac{1}{j!}\\sum_{p=j-1}^n (a_{n-(n-p)}(n-(n-p))!)(\\frac{B^+_{p+1-j}}{(p+1-j)!})$$\n\n\u73b0\u5728\uff0c\u6211\u4eec\u5b9a\u4e49\u4e24\u4e2a\u65b0\u5e8f\u5217\uff1a\n\n$$x_i=a_{n-i}(n-i)!$$\n\n$$y_i=\\frac{B^+_i}{i!}$$\n\n\u90a3\u4e48\u5c31\u6709\n\n$$c_j=\\frac{1}{j!}\\sum_{p=j-1}^n x_{n-p}y_{p+1-j}$$\n$$c_j=\\frac{1}{j!}\\sum_{a+b=n+1-j}^n x_ay_b$$\n\n\u8fd9\u4e2a\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u56e0\u4e3a\u51fa\u9898\u4eba\u826f\u5fc3\u53ef\u4ee5\u76f4\u63a5 NTT \u6765\u505a\u3002\n\n\u6700\u540e\u53ea\u9700\u8981\u5904\u7406 $B^+_i$ \u4e86\uff0c\u7136\u540e\u8fd9\u4e2a\u53ef\u4ee5\u7528\u5b83\u7684 egf $\\frac{x}{1-e^{-x}}$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n// writer: w33z8kqrqk8zzzx33\n#include <bits/stdc++.h>\nusing namespace std;\n\n// begin fast read template by CYJian (source: https://www.luogu.com.cn/paste/i11c3ppx)\n\nnamespace io {\n\tconst int __SIZE = (1 << 21) + 1;\n\tchar ibuf[__SIZE], *iS, *iT, obuf[__SIZE], *oS = obuf, *oT = oS + __SIZE - 1, __c, qu[55]; int __f, qr, _eof;\n\t#define Gc() (iS == iT ? (iT = (iS = ibuf) + fread (ibuf, 1, __SIZE, stdin), (iS == iT ? EOF : *iS ++)) : *iS ++)\n\tinline void flush () { fwrite (obuf, 1, oS - obuf, stdout), oS = obuf; }\n\tinline void gc (char &x) { x = Gc(); }\n\tinline void pc (char x) { *oS ++ = x; if (oS == oT) flush (); }\n\tinline void pstr (const char *s) { int __len = strlen(s); for (__f = 0; __f < __len; ++__f) pc (s[__f]); }\n\tinline void gstr (char *s) { for(__c = Gc(); __c < 32 || __c > 126 || __c == ' ';)  __c = Gc();\n\t\tfor(; __c > 31 && __c < 127 && __c != ' '; ++s, __c = Gc()) { *s = __c; } *s = 0; }\n\ttemplate <class I> inline bool gi (I &x) { _eof = 0;\n\t\tfor (__f = 1, __c = Gc(); (__c < '0' || __c > '9') && !_eof; __c = Gc()) { if (__c == '-') __f = -1; _eof |= __c == EOF; }\n\t\tfor (x = 0; __c <= '9' && __c >= '0' && !_eof; __c = Gc()) { x = x * 10 + (__c & 15), _eof |= __c == EOF; x *= __f; } return !_eof; }\n\ttemplate <class I> inline void print (I x) { if (!x) pc ('0'); if (x < 0) pc ('-'), x = -x;\n\t\twhile (x) { qu[++ qr] = x % 10 + '0',  x /= 10; } while (qr) pc (qu[qr --]); }\n\tstruct Flusher_ {~Flusher_(){flush();}}io_flusher_;\n} using io::pc; using io::gc; using io::pstr; using io::gstr; using io::gi; using io::print;\n\n// end fast read template by CYJian\n\n#define iter(i, a, b) for(int i=(a); i<(b); i++)\n#define rep(i, a) iter(i, 0, a)\n#define rep1(i, a) iter(i, 1, (a)+1)\n#define fi first\n#define se second\n#define pb push_back\n \n#define ll long long\n#define pii pair<int, int>\n//#define int ll\nconst int MOD = 998244353;\nnamespace poly {\n\tconst int MOD = 998244353;\n\tconst int IMAG = 86583718;\n\tconst int NTTG = 3;\n\t\n\tint rev[524300];\n\tint minv[524300];\n\tint w[20][2][524300];\n\t\n\tint qpow(int b, int e) {\n\t\tint re=1;\n\t\twhile(e){\n\t\t\tif(e&1)re=1ll*re*b%MOD;\n\t\t\tb=1ll*b*b%MOD;e>>=1;\n\t\t}\n\t\treturn re;\n\t}\n\t\n\tvoid constructrev(int n) {\n\t\tfor(int i=1, j=0; i < n; i++) {\n\t\t\tint bit=n>>1;\n\t\t\tfor(;j&bit;bit>>=1)j^=bit;\n\t\t\tj^=bit; rev[i] = j;\n\t\t}\n\t}\n\n\tvoid constructroot(int n) {\n\t\tminv[1] = 1;\n\t\titer(i, 2, n+1)\n\t\t\tminv[i]=1ll*(MOD-MOD/i)*minv[MOD%i]%MOD;\n\t\tfor(int l=1; (1<<l)<=n; l++)\n\t\t\trep(inv, 2) {\n\t\t\t\tint re = inv?qpow(minv[NTTG],(MOD-1)>>l):qpow(NTTG,(MOD-1)>>l);\n\t\t\t\tw[l][inv][0] = 1;\n\t\t\t\trep1(i,(1<<(l-1))-1) w[l][inv][i] = 1ll*w[l][inv][i-1]*re%MOD;\n\t\t\t}\n\t}\n\t\n\tvoid ntt(int *v, int n, bool inv) {\n\t\trep(i, n) if(i < rev[i]) swap(v[i], v[rev[i]]);\n\t\tfor(int l=1;(1<<l)<=n;l++)\n\t\t\tfor(int i=0;i<n;i+=(1<<l)) {\n\t\t\t\tint p=i+(1<<(l-1));\n\t\t\t\titer(j, i, p) {\n\t\t\t\t\tint a=v[j],b=1ll*v[j+(1<<(l-1))]*w[l][inv][j-i]%MOD;\n\t\t\t\t\tv[j]=(a+b>=MOD?a+b-MOD:a+b);\n\t\t\t\t\tv[j+(1<<(l-1))]=(a<b?a+MOD-b:a-b);\n\t\t\t\t}\n\t\t\t}\n\t\tif(inv) rep(i, n) v[i] = 1ll*v[i]*minv[n]%MOD;\n\t}\n\t\n\tvoid mult(int *a, int as, int *b, int bs, int *o, bool construct, bool clean = 0, int th = 100000000) {\n\t\tint n = as+bs-1;\n\t\twhile(n - (n & (-n))) n += (n & (-n));\n\t\tif(construct) constructroot(n);\n\t\tconstructrev(n);\n\t\tntt(a, n, 0); ntt(b, n, 0);\n\t\trep(i, n) o[i] = 1ll*a[i]*b[i]%MOD;\n\t\tntt(o, n, 1);\n\t\titer(i, th, n) o[i] = 0;\n\t\tif(clean) rep(i, n) a[i] = b[i] = 0;\n\t}\n\n\tvoid cfn(int* a, int as, int *o) {\n\t\tstatic int tmp[524300];\n\t\tif(as == 1) { tmp[0] = a[0]; o[0] = qpow(a[0], MOD - 2); return; }\n\t\tcfn(a, (as+1)/2, o); int le = 0;\n\t\twhile((1 << le) < (as << 1)) le++;\n\t\tconstructrev(1 << le);\n\t\trep(i, as) tmp[i] = a[i];\n\t\titer(i, as, 1<<le) tmp[i] = o[i] = 0;\n\t\tntt(tmp, 1<<le, 0); ntt(o, 1<<le, 0);\n\t\trep(i, 1<<le) o[i] = 1ll * (MOD + (2 - 1ll * tmp[i] * o[i]) % MOD) * o[i] % MOD;\n\t\tntt(o, 1<<le, 1);\n\t\titer(i, as, 1<<le) o[i] = 0;\n\t}\n\n\tvoid init(int n) { constructroot(n); }\n}\n\nint fac[524300], ifac[524300], inv[524300];\nint ini[524300], bern[524300];\n\nint d[524300];\nint f[524300];\nint answer[524300];\n\nint ncr(int n, int k) {\n\treturn 1ll * fac[n] * ifac[k] % MOD * ifac[n-k] % MOD;\n}\n\nsigned main() {\n    ios_base::sync_with_stdio(false); cin.tie(0);\n    fac[0] = ifac[0] = fac[1] = ifac[1] = inv[0] = inv[1] = 1;\n    int n; gi(n);\n    iter(i, 2, n+2) {\n    \tinv[i]=1ll*(MOD-MOD/i)*inv[MOD%i]%MOD;\n    \tfac[i] = 1ll * fac[i-1] * i % MOD;\n    \tifac[i] = 1ll * ifac[i-1] * inv[i] % MOD;\n    }\n    int th = 1; while(th < ((n+2)*2)) th <<= 1;\n    poly::init(th);\n    rep1(i, n+1) ini[i-1] = (MOD - (1ll * (i % 2 ? (MOD-1) : 1) * ifac[i]) % MOD) % MOD;\n    poly::cfn(ini, n+1, bern);\n    rep(i, n+1) {\n    \tgi(f[n-i]);\n    \tf[n-i] = 1ll * f[n-i] * fac[i] % MOD;\n    }\n    rep(i, n+1) d[i] = bern[i];\n    print(f[n]);\n    poly::mult(d, n+1, f, n+1, answer, 0);\n    //poly::mult(d, n+2, f, n+2, answer, 0);\n    rep1(j, n+1) {\n    \tint tot = answer[n+1-j];\n    \ttot = 1ll * tot * ifac[j] % MOD;\n    \tpc(' '); print(tot);\n    }\n}\n\n```",
        "postTime": 1593095832,
        "uid": 220037,
        "name": "w33z8kqrqk8zzzx33",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3711 \u3010\u4ed3\u9f20\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u8fd9\u9898\u628a\u81ea\u7136\u6570\u5e42\u548c\u51fd\u6570\u7684\u6c42\u548c\u4e0a\u9650\u989d\u5916\u52a0\u4e86\u4e00\u4e2a1\uff0c\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u53ef\u80fd\u9700\u8981\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u91cd\u65b0\u628a\u539f\u6765\u7684\u5f0f\u5b50\u5c55\u5f00\u4e00\u904d\u2026\u2026\n\n### \u524d\u7f6e\u829d\u58eb\uff1a\u4f2f\u52aa\u5229\u6570\n\n\u5982\u679c\u4e0d\u4f1a\u4f2f\u52aa\u5229\u6570\u7684\u8bdd\u53ef\u4ee5\u770b\u4e00\u4e0b[\u8fd9\u7bc7\u535a\u5ba2](https://www.luogu.org/blog/ShadowassIIXVIIIIV/guan-yu-bo-nu-li-shuo-zhuai-hua-zi-ran-shuo-mi-hu-gong-shi-di-zheng-mi)\u5b66\u4e60\u4e00\u4e0b\n\n### \u524d\u7f6e\u829d\u58eb\uff1a\u591a\u9879\u5f0f\u6c42\u9006\n\n\u86e4\uff1f\u4e0d\u4f1a\u591a\u9879\u5f0f\u6c42\u9006\uff0c\u53ef\u4ee5\u51fa\u95e8\u5de6\u8f6c\u4f60\u7ad9\u6a21\u677f\u533a\u53bb\u5b66\u4e60\u4e00\u4e0b\n\n### \u524d\u7f6e\u829d\u58eb\uff1a\u5feb\u901f\u5904\u7406\u4f2f\u52aa\u5229\u6570\n\n\u6211\u4eec\u4f7f\u7528\u4f2f\u52aa\u5229\u6570\u7684\u6307\u6570\u578b\u751f\u6210\u51fd\u6570\u6765\u5feb\u901f\u7684\u9884\u5904\u7406\u5b83\n\n\u5177\u4f53\u6765\u8bb2\u6211\u4eec\u6709\u8fd9\u6837\u4e00\u4e2a\u548c\u5f0f\n\n$$\\sum_{i}\\frac{B(i)}{i!}z^{i}=\\frac{z}{e^{z}-1}$$\n\n\u7b49\u4f1a\u663e\u7136\u5de6\u8fb9\u662f\u4e00\u4e2a\u65e0\u9650\u548c\u5f0f\uff0c\u8fd9\u4e1c\u897f\u663e\u7136\u6ca1\u6709\u529e\u6cd5\u8ba1\u7b97\u554a\n\n\u6ca1\u5173\u7cfb\u554a\uff0c\u6211\u4eec\u628a$e^{z}$\u5927\u529b\u6cf0\u52d2\u5c55\u5f00\u4e00\u4e0b\n\n$$e^{z}=\\sum_{i}\\frac{z^{i}}{i!}$$\n\n\u90a3\u4e48\u6211\u4eec\u8981\u8ba1\u7b97\u7684\u5f0f\u5b50\u5c31\u662f\n\n$$\\frac{z}{\\sum_{i}\\frac{z^{i}}{i!}-1}$$\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u4e00\u4e2a\u5f88\u5c34\u5c2c\u7684\u4e8b\u5b9e\uff0c\u8fd9\u4e1c\u897f\u5206\u6bcd\u5e38\u6570\u9879\u662f0\u6c42\u4e0d\u4e86\u9006\u2026\u2026\n\n\u8fd8\u597d\u5206\u5b50\u662f$z$\u6240\u4ee5\u6211\u4eec\u4e0a\u4e0b\u540c\u65f6\u9664\u4e00\u4e2a$z$\n\n$$\\frac{1}{\\sum_{i}\\frac{z^{i}}{(i+1)!}}$$\n\n\u90a3\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u591a\u9879\u5f0f\u6c42\u9006\u7136\u540e\u628a\u4f2f\u52aa\u5229\u6570\u7684\u524d$n$\u9879\u5237\u51fa\u6765\u4e86~\n\n## \u672c\u9898\u9898\u89e3\n\n\u4f17\u6240\u5468\u77e5\uff0c\u6807\u51c6\u7684\u81ea\u7136\u6570\u5e42\u548c\u51fd\u6570$S(n,k)$\u662f\u7b49\u4e8e$\\sum_{i=0}^{n-1}i^{k}$\u7684\u4f46\u662f\u8fd9\u9898\u6211\u4eec\u7684\u5faa\u73af\u4e0a\u9650\u53d8\u6210\u4e86$n$\u8fd9\u5c31\u5341\u5206\u7684\u96be\u53d7\u4e86\n\n\u6240\u4ee5\u8bbe\u7b54\u6848\u51fd\u6570\u662f$f(n)$\uff0c\u6211\u4eec\u5148\u8ba1\u7b97\u6bd4\u8f83\u597d\u7b97\u7684$f(n-1)$\u7136\u540e\u518d\u7528\u4e00\u4e9b\u79d1\u6280\u628a\u7b54\u6848\u7684\u7cfb\u6570\u5c55\u5f00\u5c31\u597d\u4e86\n\n\u90a3\u4e48\u5728\u4ee5\u4e0b\u7684\u8ba8\u8bba\u5f53\u4e2d\u6211\u4eec\u8ba4\u4e3a$S(n,k)$\u4ee3\u8868$\\sum_{i=0}^{n-1}i^{k}$\u800c\u4e0d\u662f$\\sum_{i=0}^{n}i^{k}$\n\n\u9898\u76ee\u4e2d\u8ba9\u6211\u4eec\u6c42\n\n$$\\sum_{k=0}^{n}S(n,k)a(k)$$\n\n\u5f3a\u884c\u7528\u4f2f\u52aa\u5229\u6570\u5c55\u5f00\u4e00\u6ce2\u53ef\u4ee5\u5f97\u5230\n\n$$\\sum_{k=0}^{n}a(k)\\frac{1}{k+1}\\sum_{i=0}^{k}{k+1 \\choose i}B(i)n^{k+1-i}$$\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u7ffb\u8f6c\u540e\u534a\u90e8\u5206\u7684\u6c42\u548c\u987a\u5e8f\n\n$$\\sum_{k=0}^{n}a(k)\\frac{1}{k+1}\\sum_{i=1}^{k+1}{k+1 \\choose k+1-i}B(k+1-i)n^{i}$$\n\n\u8ba9\u6211\u4eec\u628a\u7ec4\u5408\u6570\u62c6\u4e86\u641e\u6210\u9636\u4e58\u7684\u5f62\u5f0f\n\n$$\\sum_{k=0}^{n}a(k)k!\\sum_{i=1}^{k+1}\\frac{B(k+1-i)}{(k+1-i)!}\\frac{n^{i}}{i!}$$\n\n\u63a5\u4e0b\u6765\u53c8\u662f\u559c\u95fb\u4e50\u89c1\u7684\u4ea4\u6362\u6c42\u548c\u53f7\u73af\u8282\u4e86\n\n$$\\sum_{i=1}^{n+1}\\frac{n^{i}}{i!}\\sum_{k=i-1}^{n}a(k)k!\\frac{B(k+1-i)}{(k+1-i)!}$$\n\n\u5982\u679c\u6211\u4eec\u4ee4$f,g$\u5206\u522b\u8868\u793a\u8fd9\u4e24\u4e2a\u5f0f\u5b50\u7684\u8bdd\n\n$$f(i)=\\frac{B(i)}{i!}$$\n\n$$g(i)=a(i)i!$$\n\n\u5f0f\u5b50\u4f1a\u88ab\u5199\u7684\u597d\u770b\u4e00\u70b9\n\n$$\\sum_{i=1}^{n+1}\\frac{n^i}{i!}\\sum_{p-q=i-1}f(p)g(q)$$\n\n\u4f3c\u4e4e\u662f\u4e2a\u5dee\u5377\u79ef\uff0c\u4f17\u6240\u5468\u77e5\u6211\u4eec\u7684ntt\u53ea\u80fd\u5904\u7406\u548c\u7684\u5377\u79ef\uff0c\u6240\u4ee5\u8ba9\u6211\u4eec\u628ag\u51fd\u6570\u7ffb\u8f6c\u4e00\u4e0b\n\n$$g_{r}(x)=g(n-x)$$\n\n\n\u90a3\u4e48\u539f\u6765\u7684\u5f0f\u5b50\u5c31\u4f1a\u53d8\u6210\n\n$$\\sum_{i=1}^{n+1}\\frac{n^i}{i!}\\sum_{p+q=n+(i-1)}f(p)g_{r}(q)$$\n\n\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u4e00\u6ce2ntt\u7136\u540e\u9664\u4e0a\u4e00\u4e2a\u9636\u4e58\u5c31\u53ef\u4ee5\u6c42\u51fa$f(n-1)$\u7b2ci\u9879\u7cfb\u6570\u4e86\uff0c\u8ba9\u6211\u4eec\u8bbe\u8fd9\u4e2a\u4e1c\u897f\u4e3a$c_{i}$\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u505a\u7684\u662f\u6c42\u51fa\u8fd9\u4e2a\u591a\u9879\u5f0f\u7684\u7cfb\u6570\n\n$$\\sum_{i=1}^{n+1}c_{i}(x+1)^{i}$$\n\n\u505a\u6cd5\u7b80\u5355\u7c97\u66b4\uff0c\u76f4\u63a5\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00\u4e00\u4e0b\n\n$$\\sum_{i=1}^{n+1}c_{i}\\sum_{j=0}^{i}{i\\choose j}x^{j}$$\n\n\u8ba9\u6211\u4eec\u7ee7\u7eed\u4ea4\u6362\u6c42\u548c\u53f7\uff0c\u7531\u4e8e$c_{0}=0$\u6240\u4ee5\u6211\u4eec\u65e0\u9700\u62c5\u5fc3\u6c42\u548c\u4e0b\u754c\u7684\u95ee\u9898\n\n$$\\sum_{j=0}^{n+1}x^{j}\\sum_{i=j}^{n+1}{i\\choose j}c_{i}$$\n\n\u628a\u7ec4\u5408\u6570\u7528\u9636\u4e58\u62c6\u4e86\u53ef\u4ee5\u5f97\u5230\n\n$$\\sum_{j=0}^{n+1}x^{j}\\frac{1}{j!}\\sum_{i=j}^{n+1}c_{i}i!\u00d7\\frac{1}{(i-j)!}$$\n\n\u8bbe$f,g$\u5206\u522b\u4e3a\n\n$$f(i)=c_{i}i!$$\n\n$$g(i)=\\frac{1}{i!}$$\n\n\u90a3\u4e48\u6211\u4eec\u4f1a\u5f97\u5230\u8fd9\u6837\u4e00\u4e2a\u5f0f\u5b50\n\n$$\\sum_{j=0}^{n+1}x^{j}\\frac{1}{j!}\\sum_{p-q=j}f(p)g(q)$$\n\n\u770b\u8d77\u6765\u53c8\u662f\u70e6\u4eba\u7684\u5dee\u5377\u79ef\uff0c\u6ca1\u5173\u7cfb\u63a5\u7740\u7ffb\u8f6c\u6570\u5217,\u4ee4\n\n$$g_{r}(x)=g(n+1-x)$$\n\n\u5219\u539f\u5f0f\u4e3a\n\n$$\\sum_{j=0}^{n+1}x^{j}\\frac{1}{j!}\\sum_{p+q=n+1+j}f(p)g(q)$$\n\n\u7136\u540e\u6211\u4eec\u5927\u529bntt\u4e00\u6ce2\u9664\u4e2a\u9636\u4e58\u5c31\u884c\u4e86\n\n\u4e0a\u4ee3\u7801~\n\n```C\n// luogu-judger-enable-o2\n#include<cstdio>\n#include<algorithm>\nusing namespace std;const int N=524288+10;typedef unsigned long long ll;const ll mod=998244353;\ninline ll po(ll a,ll p){ll r=1;for(;p;p>>=1,a=a*a%mod)if(p&1)r=r*a%mod;return r;}\n# define md(x) (x=(x>mod)?x-mod:x)\nint rv[22][N];ll rt[2][22];ll tr[N];ll ifac[N];ll bu[N];ll fac[N];ll a[N];int n;\nll f1[N];ll ans[N];\ninline void pre()//\u9884\u5904\u7406 \n{\n    for(int i=1;i<=19;i++)\n        for(int j=1;j<(1<<i);j++)rv[i][j]=(rv[i][j>>1]>>1)|((j&1)<<(i-1));\n    for(int i=1,t=(mod-1)/2;i<=20;i++,t>>=1)rt[0][i]=po(3,t);\n    for(int i=1,t=(mod-1)/2;i<=20;i++,t>>=1)rt[1][i]=po(332748118,t);\n}\ninline void ntt(ll* a,int len,int d,int o)//\u7b80\u6613ntt\u677f\u5b50 \n{\n    for(int i=0;i<len;i++)if(i<rv[d][i])swap(a[i],a[rv[d][i]]);\n    for(int k=1,j=1;k<len;k<<=1,j++)\n        for(int s=0;s<len;s+=(k<<1))\n            for(int i=s,w=1;i<s+k;i++,w=w*rt[o][j]%mod)\n            {ll a1=a[i+k]*w%mod;a[i+k]=a[i]+mod-a1;md(a[i+k]);a[i]+=a1;md(a[i]);}\n    if(o){ll iv=po(len,mod-2);for(int i=0;i<len;i++)(a[i]*=iv)%=mod;}\n}\ninline void poly_inv(ll* a,ll* b,int len)//\u7b80\u6613\u591a\u9879\u5f0f\u6c42\u9006 \n{\n    b[0]=po(a[0],mod-2);\n    for(int k=2,d=1;k<=len;k<<=1,d++)\n    {\n        for(int i=0;i<k;i++)tr[i]=a[i];ntt(tr,(k<<1),d+1,0);ntt(b,(k<<1),d+1,0);\n        for(int i=0;i<(k<<1);i++)b[i]=b[i]*(2+mod-tr[i]*b[i]%mod)%mod;\n        ntt(b,(k<<1),d+1,1);for(int i=k;i<(k<<1);i++)b[i]=0;\n    }\n}\nint main()\n{\n    pre();ifac[0]=1;\n    ifac[1]=1;for(int i=2;i<=250005;i++)ifac[i]=(mod-mod/i)*ifac[mod%i]%mod;\n    for(int i=2;i<=250005;i++)(ifac[i]*=ifac[i-1])%=mod;\n    poly_inv(ifac+1,bu,262144);//\u8fd9\u91cc\u61d2\u4e86\u76f4\u63a5\u5904\u7406\u7684\u6240\u6709\u7684\u4f2f\u52aa\u5229\u6570 \n    fac[0]=1;for(int i=1;i<=250005;i++)fac[i]=fac[i-1]*i%mod;\n    scanf(\"%d\",&n);\n    for(int i=0;i<=n;i++)scanf(\"%lld\",&a[i]);int len=524288;int d=19;\n    for(int i=0;i<=n;i++)(a[i]*=fac[i])%=mod;ntt(a,len,d,0);\n    for(int i=0;i<=n;i++)f1[i]=bu[n-i];ntt(f1,len,d,0);\n    for(int i=0;i<len;i++)(f1[i]*=a[i])%=mod;ntt(f1,len,d,1);\n    for(int i=1;i<=n+1;i++)f1[i]=f1[n+(i-1)]%mod;f1[0]=0;//\u9884\u5904\u7406f(n-1)\u7684\u7cfb\u6570 \n    for(int i=n+2;i<len;i++)f1[i]=0;ntt(f1,len,d,0);\n    for(int i=0;i<=n+1;i++)ans[i]=ifac[n+1-i];ntt(ans,len,d,0);\n    for(int i=0;i<len;i++)(ans[i]*=f1[i])%=mod;ntt(ans,len,d,1);//\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00 \n    for(int i=0;i<=n+1;i++)printf(\"%lld \",ans[n+1+i]*ifac[i]%mod);return 0;//\u62dc\u62dc\u7a0b\u5e8f~ \n}\n\n```",
        "postTime": 1544577563,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3711 \u3010\u4ed3\u9f20\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u8fd9\u9898\u9ed1\u7684\u4e2b\uff01\u600e\u4e48\u4f1a\u6389\u7d2b\u5462\uff01\n\n# noteskey\n\n\u4f2f\u52aa\u5229\u6570... [\u8fd9\u91cc](https://www.cnblogs.com/Judge/p/10722777.html) \u6709\u4ecb\u7ecd\u54df~ \u5199\u7684\u975e\u5e38\u8be6\u7ec6\u5462~\n\n\u53cd\u6b63\u8fd9\u9898\u5c31\u662f\u63a8\u67ff\u5b50...\n\n\u53e6\u5916\u5c31\u662f\u9ec8\u529b\u7b97\u6cd5\u7684\u8fd0\u7528 QWQ \n\n\u6211\u4eec\u4ee4 $ANS(x)$ \u4e3a\u7b54\u6848\u591a\u9879\u5f0f\uff0c\u90a3\u4e48\u8fd9\u4e2a\u591a\u9879\u5f0f\u53ef\u4ee5\u8fd9\u4e48\u6c42\uff1a\n\n\uff08\u4e0b\u9762\u6211\u4eec\u5b9a\u4e49 $S(n,k)$ \u4e3a\u81ea\u7136\u5e42\u548c\u51fd\u6570\uff08\u4e0d\u662f\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\uff01\uff09\uff0c\u5373 $\\sum_{i=0}^{ n} i^k$\uff09\n\n$$\\begin{aligned}ANS(x)=& \\sum_{k=0}^{n} S_k (x) a_k \\\\  =& \\sum_{k=0}^{n} (S(x,k)+x^k) a_k \\\\  =&  \\sum_{k=0}^n a_k \\Big( x^k +{1\\over k+1} \\sum_{i=0}^k  \\begin{pmatrix} k+1\\\\i \\end{pmatrix} B_i x^{k+1-i}\\Big)  \\\\  =&  \\sum_{k=0}^n a_k \\Big( x^k + k! \\sum_{i=0}^k  {B_i\\over i!} {x^{k+1-i} \\over (k+1-i)! }\\Big)                            \\\\  =&  \\sum_{k=0}^n a_k x^k  + \\sum_{k=0}^n a_k k! \\sum_{i=0}^k  {B_i\\over i!} {x^{k+1-i} \\over (k+1-i)! }        \\\\  =&  \\sum_{i=0}^n a_i  x^i + \\sum_{i=1}^{n+1} {x^i\\over  i!} \\sum_{k=i-1}^{n}  a_k k!{B_{k+1-i}\\over (k+1-i)!}          \\end{aligned}$$\n\n\n\u7136\u540e\u611f\u89c9\u505a\u4e0d\u4e0b\u53bb\u4e86\u5462...\u540e\u9762\u867d\u8bf4\u50cf\u662f\u5377\u79ef\u7684\u5f62\u5f0f\u7136\u9e45\u6839\u672c\u5c31\u4e0d\u662f\u5377\u79ef\u5462QWQ\n\n\u9996\u5148\uff0c\u6211\u4eec\u770b\u7740\u8868\u8fbe\u5f0f\u592a\u957f\u4e86\uff0c\u4e8e\u662f\u4e4e\u628a\u8868\u8fbe\u5f0f\u6362\u6210\u4e00\u4e2a\u51fd\u6570\uff1a\n\n\n$$\\begin{aligned}f(i)=&~a_ii! \\\\g(i) =&~{B_i \\over i!} \\end{aligned}$$\n\n\u90a3\u4e48\u539f\u6765\u7684\u5f0f\u5b50\u5c31\u662f\uff1a\n\n$$ANS=\\sum_{i=0}^n a_i x^i  + \\sum_{i=1}^{n+1} {x^i\\over  i!} \\sum_{k=i-1}^{n}  f(k)g(k+1-i)  $$\n\n\u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u66f4\u52a0\u6e05\u6670\u7684\u53d1\u73b0\u540e\u9762\u7684\u5f0f\u5b50\u4e0d\u662f\u5377\u79ef\u7684\u5f62\u5f0f\u4e86 XD\n\n\u90a3\u4e48\u6211\u4eec\u4ee4 $gr(i)=g(n-i)$ \uff08\u4e5f\u5c31\u662f\u7ffb\u8f6c\u591a\u9879\u5f0f\uff09\n\n\u7136\u540e\u539f\u6765\u7684\u5f0f\u5b50\u5c31\u662f\uff1a\n\n$$ANS=\\sum_{i=0}^n a_i x^i+ \\sum_{i=1}^{n+1} {x^i\\over i!} \\sum_{k=i-1}^{n}  f(k)gr(n+i-k-1)  $$\n\n\u53d1\u73b0\u8fd9\u91cc\u5c31\u662f\u6700\u9ad8\u9879\u6539\u6210 $n+i$ \u9879\u7684\u5377\u79ef\u4e86\uff0c\u4e8e\u662f\u6211\u4eec\u53d1\u73b0 \u8981\u8ba1\u7b97\u540e\u9762\u7684 $\\sum_{k=i-1}^n$ \u4ec0\u4e48\u7684\u7b97\u51fa\u6765\u7684\u662f $f* gr$  \u7684\u7b2c $(n+i-1)$ \u9879\n\n\u4e8e\u662f\u6211\u4eec\u628a $f* gr$ \u7684\u591a\u9879\u5f0f\u6c42\u51fa\u6765\uff0c\u62ff\u7b2c $(n-i+1)$ \u9879\u4e58\u4e0a $i!$ \uff0c\u518d\u52a0\u4e0a $a_i$ \u5c31\u662f\u6700\u540e\u591a\u9879\u5f0f\u7684\u7b2c i \u9879\u7b54\u6848\u4e86\n\n\n\u597d\u50cf\u6ca1\u6709\u9ed1\u9898\u96be\u5ea6\uff1f \u524d\u63d0\u4f60\u5f97\u77e5\u9053\u4f2f\u52aa\u5229\u6570\u8fd9\u73a9\u610f\u513f\u4e2b\uff01 \u3010\u96fe \n\n\u800c\u4e14\u8fd9\u4e2a\u63a8\u5bfc\u8fc7\u7a0b...\u597d\u50cf\u6bd4 shadowice \u5de8\u5de8\u7684\u77ed\u5f88\u591a\u4e2b...\u3010\u5c0f\u58f0\n\n\n\n# code\n\n\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u4e0d\u5f00 Ofast \u8dd1\u5f97\u6bd4\u5f00\u4e86\u5feb... 600ms + \n\n```\n//by Judge\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#define Rg register\n#define fp(i,a,b) for(Rg int i=(a),I=(b)+1;i<I;++i)\n#define ll long long\nusing namespace std;\nconst int mod=998244353;\nconst int iG=332748118;\nconst int M=1<<19|3;\ntypedef int arr[M];\n#ifndef Judge\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\n#endif\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline int mul(int x,int y){return 1ll*x*y%mod;}\ninline int dec(int x,int y){return x<y?x-y+mod:x-y;}\ninline int inc(int x,int y){return x+y>=mod?x+y-mod:x+y;}\ninline int read(){ int x=0,f=1; char c=getchar();\n\tfor(;!isdigit(c);c=getchar()) if(c=='-') f=-1;\n\tfor(;isdigit(c);c=getchar()) x=x*10+c-'0'; return x*f;\n} char sr[1<<21],z[20];int CCF=-1,Z;\ninline void Ot(){fwrite(sr,1,CCF+1,stdout),CCF=-1;}\ninline void print(int x,char chr=' '){\n    if(CCF>1<<20)Ot();if(x<0)sr[++CCF]=45,x=-x;\n    while(z[++Z]=x%10+48,x/=10);\n    while(sr[++CCF]=z[Z],--Z);sr[++CCF]=chr;\n} int n,limit; arr fac,ifac,a,B,C,r;\ninline int qpow(int x,int p=mod-2,int s=1){\n\tfor(;p;p>>=1,x=mul(x,x)) if(p&1) s=mul(s,x); return s;\n}\ninline void init(int n){ int len=-1;\n\tfor(limit=1;limit<=n;limit<<=1) ++len;\n\tfp(i,0,limit-1) r[i]=(r[i>>1]>>1)|((i&1)<<len); \n}\ninline void NTT(int* a,int tp){ fp(i,0,limit-1) if(i<r[i]) swap(a[i],a[r[i]]);\n\tfor(Rg int mid=1;mid<limit;mid<<=1){ Rg int I=mid<<1,Gn=qpow(tp?3:iG,(mod-1)/I);\n\t\tfor(Rg int j=0,x;j<limit;j+=I) for(Rg int k=0,g=1;k<mid;++k,g=mul(g,Gn))\n\t\t\tx=mul(a[j+k+mid],g),a[j+k+mid]=dec(a[j+k],x),a[j+k]=inc(a[j+k],x);\n\t} if(tp) return ; int inv=qpow(limit); fp(i,0,limit-1) a[i]=mul(a[i],inv);\n}\nvoid get_inv(int* a,int* b,int n){\n\tif(n==1) return b[0]=qpow(a[0]),void(); static int c[M],d[M];\n\tget_inv(a,b,n>>1),init(n); for(int i=0;i<n;++i) c[i]=a[i],d[i]=b[i];\n\tfor(int i=n;i<limit;++i) c[i]=d[i]=0; NTT(c,1),NTT(d,1);\n\tfp(i,0,limit-1) c[i]=mul(c[i],mul(d[i],d[i])); NTT(c,0);\n\tfp(i,0,n-1) b[i]=dec(inc(b[i],b[i]),c[i]);\n}\ninline void prep(int len){ B[0]=ifac[0]=ifac[1]=fac[0]=fac[1]=1;\n\tfp(i,2,len) ifac[i]=mul(mod-mod/i,ifac[mod%i]);\n\tfp(i,2,len) ifac[i]=mul(ifac[i-1],ifac[i]),fac[i]=mul(fac[i-1],i);\n\tget_inv(ifac+1,B,len);\n}\nint main(){ n=read();\n\tfor(limit=1;limit<=n;limit<<=1); prep(limit);\n\tfp(i,0,n) a[i]=read(),C[i]=mul(a[i],fac[i]);\n\treverse(B,B+1+n),init(n<<1|1);\n\tfp(i,n+1,limit-1) B[i]=C[i]=0; NTT(B,1),NTT(C,1);\n\tfp(i,0,limit-1) B[i]=mul(B[i],C[i]); NTT(B,0);\n\tfp(i,0,n+1) B[n+i-1]=mul(B[n+i-1],ifac[i]);\n\tfp(i,0,n) B[n+i-1]=inc(B[n+i-1],a[i]);\n\tprint(a[0]); fp(i,1,n+1) print(B[n+i-1]);\n\treturn sr[CCF]='\\n',Ot(),0;\n}\n```\n\n# more...\n\n\u5176\u5b9e\u6211\u4eec\u53ea\u9700\u8981\u7528\u53e6\u5916\u4e00\u79cd\u4f2f\u52aa\u5229\u6570\uff0c\u5c31\u53ef\u4ee5\u8ba9\u63a8\u5bfc\u66f4\u52a0\u7b80\u6d01\uff08\u6ca1\u7b80\u6d01\u591a\u5c11\uff0c\u4ee3\u7801\u590d\u6742\u5ea6\u4e5f\u57fa\u672c\u6ca1\u53d8\u7684\u8bf4\uff09\n\n\u8fd9\u4e2a\u4f2f\u52aa\u5229\u6570\u5c31\u662f\u4e4b\u524d\u63d0\u5230\u7684\u90a3\u7bc7[\u535a\u5ba2](https://www.cnblogs.com/Judge/p/10722777.html)\u91cc\u9762\u8bb2\u7684 $B^+$\uff0c\u8fd9\u4e2a\u4f2f\u52aa\u5229\u6570\u5217\u6ee1\u8db3\u7684\u6027\u8d28\u66f4\u52a0\u9002\u5408\u505a\u8fd9\u9053\u9898...\n\n\u4e8e\u662f\u6211\u4eec\u4ee4 $B=B^+$\uff0c \u7136\u540e\u91cd\u63a8\u4e00\u904d\uff1a\n\n\uff08\u5176\u5b9e\u6ca1\u5fc5\u8981\uff0c\u7ed9\u4e2a\u4ee3\u7801\u5c31 OJBK \u4e86\uff1f \u3010\u6ed1\u7a3d\uff09\n\n\n\n$$\\begin{aligned}ANS(x)=& \\sum_{k=0}^{n} S_k (x) a_k \\\\  =& \\sum_{k=0}^{n} S^+(x,k) a_k \\\\  =&  \\sum_{k=0}^n a_k \\Big( {1\\over k+1} \\sum_{i=0}^k  \\begin{pmatrix} k+1\\\\i \\end{pmatrix} B_i x^{k+1-i} \\Big) \\\\  =&  \\sum_{k=0}^n a_k  k! \\sum_{i=0}^k  {B_i\\over i!} {x^{k+1-i} \\over (k+1-i)! }                           \\\\  =& \\sum_{i=1}^{n+1} {x^i\\over i!} \\sum_{k=i-1}^{n}  a_k k!{B_{k+1-i}\\over (k+1-i)!}          \\end{aligned}$$\n\n\u4f9d\u7136\u4ee4\uff1a\n\n$$\\begin{aligned}f(i)=&~a_ii! \\\\g(i) =&~{B_i \\over i!} \\\\g_r(i)=&~g(n-i)\\end{aligned}$$\n\n\uff08\u6ce8\u610f\u8fd9\u91cc\u7684 $B_i$ \u5c31\u662f $B_i^+$ \uff09\n\n$$ANS=\\sum_{i=1}^{n+1} {x^i \\over i!} \\sum_{k=i-1}^{n}  f(k)gr(n+i-k-1)  $$\n\n\n\u540c\u6837\u7684\uff0c\u628a $f* g_r$ \u7684\u7b2c $(n-i+1)$ \u9879\u4e58\u4e0a $i!$ \u5c31\u662f\u6700\u540e\u7684\u7b54\u6848\u4e86 \uff0c\u4e0d\u540c\u7684\u5c31\u662f\u8fd9\u91cc\u4e0d\u9700\u8981\u518d\u52a0\u4e0a $a_i$  XD\n\n\n# code*2\n\n\u4ee3\u7801...\u53ef\u8c13\u6ca1\u6709\u4ec0\u4e48\u533a\u522b\n\n```cpp\n//by Judge\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#define Rg register\n#define fp(i,a,b) for(Rg int i=(a),I=(b)+1;i<I;++i)\n#define ll long long\nusing namespace std;\nconst int mod=998244353;\nconst int iG=332748118;\nconst int M=1<<19|3;\ntypedef int arr[M];\n#ifndef Judge\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\n#endif\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline int mul(int x,int y){return 1ll*x*y%mod;}\ninline int dec(int x,int y){return x<y?x-y+mod:x-y;}\ninline int inc(int x,int y){return x+y>=mod?x+y-mod:x+y;}\ninline int read(){ int x=0,f=1; char c=getchar();\n\tfor(;!isdigit(c);c=getchar()) if(c=='-') f=-1;\n\tfor(;isdigit(c);c=getchar()) x=x*10+c-'0'; return x*f;\n} char sr[1<<21],z[20];int CCF=-1,Z;\ninline void Ot(){fwrite(sr,1,CCF+1,stdout),CCF=-1;}\ninline void print(int x,char chr=' '){\n    if(CCF>1<<20)Ot();if(x<0)sr[++CCF]=45,x=-x;\n    while(z[++Z]=x%10+48,x/=10);\n    while(sr[++CCF]=z[Z],--Z);sr[++CCF]=chr;\n} int n,limit; arr fac,ifac,a,B,C,r;\ninline int qpow(int x,int p=mod-2,int s=1){\n\tfor(;p;p>>=1,x=mul(x,x)) if(p&1) s=mul(s,x); return s;\n}\ninline void init(int n){ int len=-1;\n\tfor(limit=1;limit<=n;limit<<=1) ++len;\n\tfp(i,0,limit-1) r[i]=(r[i>>1]>>1)|((i&1)<<len); \n}\ninline void NTT(int* a,int tp){ fp(i,0,limit-1) if(i<r[i]) swap(a[i],a[r[i]]);\n\tfor(Rg int mid=1;mid<limit;mid<<=1){ Rg int I=mid<<1,Gn=qpow(tp?3:iG,(mod-1)/I);\n\t\tfor(Rg int j=0,x;j<limit;j+=I) for(Rg int k=0,g=1;k<mid;++k,g=mul(g,Gn))\n\t\t\tx=mul(a[j+k+mid],g),a[j+k+mid]=dec(a[j+k],x),a[j+k]=inc(a[j+k],x);\n\t} if(tp) return ; int inv=qpow(limit); fp(i,0,limit-1) a[i]=mul(a[i],inv);\n}\nvoid get_inv(int* a,int* b,int n){\n\tif(n==1) return b[0]=qpow(a[0]),void(); static int c[M],d[M];\n\tget_inv(a,b,n>>1),init(n); for(int i=0;i<n;++i) c[i]=a[i],d[i]=b[i];\n\tfor(int i=n;i<limit;++i) c[i]=d[i]=0; NTT(c,1),NTT(d,1);\n\tfp(i,0,limit-1) c[i]=mul(c[i],mul(d[i],d[i])); NTT(c,0);\n\tfp(i,0,n-1) b[i]=dec(inc(b[i],b[i]),c[i]);\n}\ninline void prep(int len){\n\tB[0]=ifac[0]=ifac[1]=fac[0]=fac[1]=1;\n\tfp(i,2,len) ifac[i]=mul(mod-mod/i,ifac[mod%i]);\n\tfp(i,2,len) ifac[i]=mul(ifac[i-1],ifac[i]);\n\tfp(i,2,len) fac[i]=mul(fac[i-1],i);\n\tget_inv(ifac+1,B,len); B[1]=mod-B[1];\n}\nint main(){ n=read();\n\tfor(limit=1;limit<=n;limit<<=1); prep(limit);\n\tfp(i,0,n) a[i]=read(),C[i]=mul(a[i],fac[i]);\n\treverse(B,B+1+n),init(n<<1|1);\n\tfp(i,n+1,limit-1) B[i]=C[i]=0; NTT(B,1),NTT(C,1);\n\tfp(i,0,limit-1) B[i]=mul(B[i],C[i]); NTT(B,0);\n\tfp(i,0,n+1) B[n+i-1]=mul(B[n+i-1],ifac[i]);\n\tprint(a[0]); fp(i,1,n+1) print(B[n+i-1]);\n\treturn sr[CCF]='\\n',Ot(),0;\n}\n```\n\n\n\n\n# update\n\n\u867d\u8bf4\u662f\u6587\u5316\u8bfe\u9009\u624b\u8fa3\uff0c\u4f46\u8fd8\u662f\u6539\u4e86\u4e00\u4e0b\u9519\u8bef\u7684\u67ff\u5b50...\u8bb2\u9053\u7406\u5927\u5bb6\u80fd get \u5230\u60f3\u6cd5\u5c31\u884c\u4e86\n\n\n\n\n\n\n",
        "postTime": 1555497863,
        "uid": 38576,
        "name": "J\u03bcdge",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3711 \u3010\u4ed3\u9f20\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "## \u9898\u610f\n\u5b9a\u4e49 $\\displaystyle sum(x,k)=\\sum_{i=0}^xi^k$ \uff0c\u6c42  $\\displaystyle F(x)=\\sum_{k=0}^na_k\\times sum(x,k)$ \u7684\u7cfb\u6570\u3002\u53ef\u4ee5\u8bc1\u660e\u6b21\u6570\u4e0d\u8d85\u8fc7 $n+1$\n## \u9898\u89e3\n\u8003\u8651 $S(n,m)=\\sum_{k=0}^{n-1}k^m$ \u7684 $\\mathbb{EGF}$ $\\hat{S}(x)$ ,\u8fd8\u6709\u4e00\u4e2a\u795e\u79d8\u7684 $\\mathbb{EGF}$ $\\hat{B}$\u4ee5\u53ca $B(i)=i![x^i]\\hat{B}(x)$\n\n$$\\begin{aligned}\n\\hat{S}(x)&=\\sum_{i=0}^\\infty S(n,i)\\frac{x^i}{i!}\n=\\sum_{i=0}^\\infty\\left(\\sum_{k=0}^{n-1}k^i\\right)\\frac{x^i}{i!}\\\\\n&=\\sum_{k=0}^{n-1}\\left(\\sum_{i=0}^\\infty\\frac{(xk)^i}{i!}\\right)=\\sum_{k=0}^{n-1}\\left(e^x\\right)^k\\\\\n&=\\frac{e^{nx}-1}{e^x-1}=\\frac{e^{nx}-1}{x}\\times\\frac{x}{e^x-1}\\\\\n&=\\sum_{i=1}^\\infty\\frac{n^i x^{i-1}}{i!}\\sum_{i=0}^\\infty\\frac{B(i)x^i}{i!}\n\\end{aligned}$$\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u63d0\u53d6\u7cfb\u6570 $[x^m]\\hat{S}=\\sum_{i=1}^m\\frac{n^i}{i!}\\times\\frac{B(m-i+1)}{(m-i+1)!}$\uff0c\u4e5f\u5c31\u662f\n$$S(n,m)=m!\\sum_{i=1}^{m+1}\\frac{n^iB(m-i+1)}{i!(m-i+1)}$$\n\u4ee5\u53ca\u4e00\u79cd\u53ef\u80fd\u66f4\u4f18\u7f8e\u7684\u5199\u6cd5\n$$S(n,m)=\\frac{1}{m+1}\\sum_{i=0}^m\\binom{m+1}{i}n^{m-i+1}B(i)$$\n\u4e0d\u8fc7\u6b64\u9898\u6211\u4eec\u53ea\u4f7f\u7528\u7b2c\u4e00\u4e2a\u67ff\u5b50\u3002\n\n\u8003\u8651 $B(i)$ \u600e\u4e48\u6c42\uff0c\u6839\u636e\u5b9a\u4e49\u5f0f $\\dfrac{x}{e^x-1}$\uff0c\u4e0d\u8fc7\u5e38\u6570\u9879\u662f $0$\u3002\u8fd8\u597d\u4e0a\u9762\u7684\u5e38\u6570\u9879\u4e5f\u662f $0$\uff0c\u4e8e\u662f\u4e0a\u4e0b\u540c\u9664 $x+\\rm Taylor\\text{\u516c\u5f0f}$ \u5f97\u5230 $\\displaystyle\\frac{1}{\\sum_{i=1}^\\infty\\frac{x^{i-1}}{i!}}$\n\n\u4e0d\u96be\u6709 $sum(x,k)=S(x,k)+x^k$ ,\u4e8e\u662f\u518d\u6765\u63a8\u67ff\u5b50\n$$\n\\begin{aligned}\nF(x)&=\\sum_{k=0}^na_i\\times sum(x,k)\\\\\n&=\\sum_{k=0}^na_kx^k+\\sum_{k=0}^na_kS(x,k)\\\\\n&=F_0(x)+\\sum_{k=0}^na_kk!\\sum_{i=1}^{k+1}\\frac{x^i}{i!}\\times\\frac{B(k-i+1)}{(k-i+1)!}\\\\\n&=F_0(x)+\\sum_{i=1}^{n+1}\\frac{x^i}{i!}\\sum_{k=0}\n^na_kk!\\times \\frac{B(k-i+1)}{(k-i+1)!}\t\\\\\n&\\text{\u8bb0} c_k=a_kk!,d_{n-k}=\\frac{B(k)}{k!}\\\\\n&=F_0(x)+\\sum_{i=1}^{n+1}\\frac{x^i}{i!}\\sum_{k=0}^nc_kd_{n-k+i-1}\n\\end{aligned}\n$$\n$\\rm NTT$ \u5377\u4e00\u4e0b\u5c31\u505a\u5b8c\u4e86\u3002\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nnamespace in{\n\tchar buf[1<<21],*p1=buf,*p2=buf;\n\tinline int getc(){return p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++;}\n\ttemplate <typename T>inline void read(T& t){\n\t\tt=0;int f=0;char ch=getc();while (!isdigit(ch)){if(ch=='-')f = 1;ch=getc();}\n\t\twhile(isdigit(ch)){t=t*10+ch-48;ch = getc();}if(f)t=-t;\n\t}\n\ttemplate <typename T,typename... Args> inline void read(T& t, Args&... args){read(t);read(args...);}\n\tchar getC(){char c=getc();while(!isdigit(c)&&!isalpha(c))c=getc();return c;}\n}\nnamespace out{\n\tchar buffer[1<<21];int p1=-1;const int p2 = (1<<21)-1;\n\tinline void flush(){fwrite(buffer,1,p1+1,stdout),p1=-1;}\n\tinline void putc(const char &x) {if(p1==p2)flush();buffer[++p1]=x;}\n\ttemplate <typename T>void write(T x) {\n\t\tstatic char buf[15];static int len=-1;if(x>=0){do{buf[++len]=x%10+48,x/=10;}while (x);}else{putc('-');do {buf[++len]=-(x%10)+48,x/=10;}while(x);}\n\t\twhile (len>=0)putc(buf[len]),--len;\n\t}\n}\nusing namespace std;\ntemplate<const int mod>\nstruct modint{\n    int x;\n    modint<mod>(int o=0){x=o;}\n    modint<mod> &operator = (int o){return x=o,*this;}\n    modint<mod> &operator +=(modint<mod> o){return x=x+o.x>=mod?x+o.x-mod:x+o.x,*this;}\n    modint<mod> &operator -=(modint<mod> o){return x=x-o.x<0?x-o.x+mod:x-o.x,*this;}\n    modint<mod> &operator *=(modint<mod> o){return x=1ll*x*o.x%mod,*this;}\n    modint<mod> &operator ^=(int b){\n        modint<mod> a=*this,c=1;\n        for(;b;b>>=1,a*=a)if(b&1)c*=a;\n        return x=c.x,*this;\n    }\n    modint<mod> &operator /=(modint<mod> o){return *this *=o^=mod-2;}\n    modint<mod> &operator +=(int o){return x=x+o>=mod?x+o-mod:x+o,*this;}\n    modint<mod> &operator -=(int o){return x=x-o<0?x-o+mod:x-o,*this;}\n    modint<mod> &operator *=(int o){return x=1ll*x*o%mod,*this;}\n    modint<mod> &operator /=(int o){return *this *= ((modint<mod>(o))^=mod-2);}\n\ttemplate<class I>friend modint<mod> operator +(modint<mod> a,I b){return a+=b;}\n    template<class I>friend modint<mod> operator -(modint<mod> a,I b){return a-=b;}\n    template<class I>friend modint<mod> operator *(modint<mod> a,I b){return a*=b;}\n    template<class I>friend modint<mod> operator /(modint<mod> a,I b){return a/=b;}\n    friend modint<mod> operator ^(modint<mod> a,int b){return a^=b;}\n    friend bool operator ==(modint<mod> a,int b){return a.x==b;}\n    friend bool operator !=(modint<mod> a,int b){return a.x!=b;}\n    bool operator ! () {return !x;}\n    modint<mod> operator - () {return x?mod-x:0;}\n\tmodint<mod> &operator++(int){return *this+=1;}\n};\nconst int N=6e5+5;\nconst int mod=998244353;\ntypedef modint<mod> mint;\nconst mint GG=3,Ginv=mint(1)/3,I=86583718;\nstruct poly{\n\tvector<mint>a;\n\tmint&operator[](int i){return a[i];}\n\tint size(){return a.size();}\n\tvoid resize(int n){a.resize(n);}\n\tvoid reverse(){std::reverse(a.begin(),a.end());}\n\tvoid print(char op=' '){for(auto x:a)out::write(x.x),out::putc(op);}\n};\nint rev[N];\ninline poly one(){poly a;a.a.push_back(1);return a;}\ninline int ext(int n){int k=0;while((1<<k)<n)k++;return k;}\ninline void init(int k){int n=1<<k;for(int i=0;i<n;i++)rev[i]=(rev[i>>1]>>1)|((i&1)<<(k-1));}\ninline void ntt(poly&a,int k,int typ){\n\tint n=1<<k;\n\tfor(int i=0;i<n;i++)if(i<rev[i])swap(a[i],a[rev[i]]);\n\tfor(int mid=1;mid<n;mid<<=1){\n\t\tmint wn=(typ>0?GG:Ginv)^((mod-1)/(mid<<1));\n\t\tfor(int r=mid<<1,j=0;j<n;j+=r){\n\t\t\tmint w=1;\n\t\t\tfor(int k=0;k<mid;k++,w=w*wn){\n\t\t\t\tmint x=a[j+k],y=w*a[j+k+mid];\n\t\t\t\ta[j+k]=x+y,a[j+k+mid]=x-y;\n\t\t\t}\n\t\t}\n\t}\n\tif(typ<0){\n\t\tmint inv=mint(1)/n;\n\t\tfor(int i=0;i<n;i++)a[i]*=inv;\n\t}\n}\ninline poly operator*(poly a,poly b){\n\tint n=a.size()+b.size()-1,k=ext(n);\n\ta.resize(1<<k),b.resize(1<<k),init(k);\n\tntt(a,k,1);ntt(b,k,1);for(int i=0;i<(1<<k);i++)a[i]*=b[i];\n\tntt(a,k,-1),a.resize(n);return a;\n}\npoly inv(poly F,int k){\n\tint n=1<<k;F.resize(n);\n\tif(n==1){F[0]=modint<mod>(1)/F[0];return F;}\n\tpoly G,H=inv(F,k-1);\n\tG.resize(n),H.resize(n<<1),F.resize(n<<1);\n\tfor(int i=0;i<n/2;i++)G[i]=H[i]*2;\n\tinit(k+1),ntt(H,k+1,1),ntt(F,k+1,1);\n\tfor(int i=0;i<(n<<1);i++)H[i]=H[i]*H[i]*F[i];\n\tntt(H,k+1,-1),H.resize(n);\n\tfor(int i=0;i<n;i++)G[i]-=H[i];return G;\n}\ninline poly inv(poly a){\n\tint n=a.size();\n\ta=inv(a,ext(n)),a.resize(n);return a;;\n}\nint n;mint a[N],fac[N],ifac[N];\nsigned main(){\n\tin::read(n);for(int i=0;i<=n;i++)in::read(a[i]);\n\tfac[0]=1;for(int i=1;i<N;i++)fac[i]=fac[i-1]*i;\n\tifac[N-1]=1/fac[N-1];for(int i=N-1;i;i--)ifac[i-1]=ifac[i]*i;\n\tpoly f,B,c,d;\n\t//\u6c42\u51fa 1-n \u7684\u4f2f\u52aa\u5229\u6570\n\tB.resize(n+2);for(int i=0;i<=n+1;i++)B[i]=ifac[i+1];B=inv(B);\n\t//B.print();out::putc('\\n');\n\tc.resize(n+2);d.resize(n+2);\n\tfor(int k=0;k<=n;k++)c[k]=a[k]*fac[k];\n\tfor(int k=0;k<=n;k++)d[n-k]=B[k];\n\tc=c*d;\n\tf.resize(n+2);\n\tfor(int i=1;i<=n+1;i++)f[i]=ifac[i]*c[n+i-1]+a[i];f[0]=a[0];\n\tf.print();out::flush();\n}\n```",
        "postTime": 1613554878,
        "uid": 174304,
        "name": "jun\u5934\u5409\u5409",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3711 \u3010\u4ed3\u9f20\u7684\u6570\u5b66\u9898\u3011&& \u4f2f\u52aa\u5229\u6570\u5b66\u4e60\u5c0f\u8bb0"
    },
    {
        "content": "[\u6b22\u8fce\u5230\u6211\u7684\u535a\u5ba2\u67e5\u770b](https://mivik.gitee.io/2020/solution/hamsters-math-problem/)\n\n\n> \u7ed9\u5b9a $n$ \u548c \u957f\u5ea6\u4e3a $n+1$ \u7684\u6570\u7ec4 $a_0\\cdots a_n$\uff0c\u6c42\n>\n> $$\n> \\sum_{k=0}^n a_k\\sum_{i=0}^x i^k\n> $$\n>\n> $1\\le n\\le 250000$\uff0c\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u3002\n\n---\n\n\u6211\u4eec\u4ee4 $S_{n,k}=\\sum_{i=0}^{n-1}i^k$\uff0c\u7136\u540e\u6211\u4eec\u8003\u8651\u6c42\u51fa $S_{n,k}$ **\u5173\u4e8e $k$ \u7684** \u6307\u6570\u751f\u6210\u51fd\u6570 $S_n(x)$\uff1a\n\n$$\n\\begin{aligned}\nS_n(x)&=\\sum_{k=0}^\\infty \\frac{x^k}{k!}\\sum_{i=0}^{n-1} i^k\\\\\n&=\\sum_{i=0}^{n-1}\\sum_{k=0}^\\infty \\frac{(xi)^k}{k!}\\\\\n&=\\sum_{i=0}^{n-1}(e^x)^i\\\\\n&=\\frac{e^{nx}-1}{e^x-1}\n\\end{aligned}\n$$\n\n\u8003\u8651\u600e\u4e48\u62ff\u5230\u8fd9\u4e2a\u4e1c\u897f\u7684\u7b2c $k$ \u9879\u7cfb\u6570\u3002\u5148\u8bbe $B(x)=\\frac{x}{e^x-1}$\uff0c\u4e8e\u662f\u6709\uff1a\n$$\n\\begin{aligned}\nS_n(x)&=\\frac{e^{nx}-1}{x}\\cdot B(x)\\\\\nS_n(x)&=\\left(\\sum_{i=0}^\\infty \\frac{n^{i+1}}{(i+1)!}x^i\\right)\\cdot B(x)\\\\\n\\frac{S_{n,k}}{k!}&=\\sum_{i=0}^k \\frac{n^{i+1}}{(i+1)!}\\cdot\\frac{B_{k-i}}{(k-i)!}\n\\end{aligned}\n$$\n\n\u7136\u540e\u6211\u4eec\u8f6c\u6362\u539f\u5f0f\uff08\u7531\u4e8e\u6211\u4eec\u53ea\u6c42\u5230\u4e86 $n-1$ \u6240\u4ee5\u8981\u52a0\u4e0a $n^k$\uff09\uff1a\n$$\n\\begin{aligned}\n&\\sum_{k=0}^n a_k\\sum_{i=0}^x i^k\\\\\n=&\\sum_{k=0}^n a_k\\left(x^k+S_{x,k}\\right)\\\\\n=&\\sum_{k=0}^n a_k\\left(x^k+k!\\sum_{i=0}^k \\frac{x^{i+1}}{(i+1)!}\\cdot\\frac{B_{k-i}}{(k-i)!}\\right)\\\\\n=&\\left(\\sum_{k=0}^n a_k x^k\\right)+\\sum_{i=0}^n\\frac{x^{i+1}}{(i+1)!}\\sum_{k=i}^n a_k k!\\frac{B_{k-i}}{(k-i)!}\n\\end{aligned}\n$$\n\n\u7136\u540e\u8bb0 $B'_i=B_{n-i}$\uff0c\u7136\u540e\u4e0a\u9762\u53f3\u8fb9\u90a3\u4e2a\u5f0f\u5b50\u5c31\u53ef\u4ee5\u5377\u79ef\u4e86\u3002\n\n~~\u4e3a\u770b\u5230\u7684\u9898\u89e3\u533a\u91cc\u9762\u4e00\u4f4d\u628a $(n+1)$ \u5e26\u5165\u4e0a\u9762\u5f0f\u5b50\u7136\u540e\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00\u7684\u53ef\u601c\u8001\u54e5\u9ed8\u54c0~~\n\n\u8981\u6ce8\u610f\u7684\u4e00\u4e2a\u7ec6\u8282\u662f\u600e\u4e48\u6c42 $B$\u3002\u4e0a\u6587\u63d0\u5230 $B=\\frac{x}{e^x-1}$\uff0c \u4f46\u662f\u76f4\u63a5\u591a\u9879\u5f0f\u6c42\u9006\u4f1a\u53d1\u73b0\u7531\u4e8e $(e^x-1)$ \u5e38\u6570\u9879\u4e3a 0\uff0c\u6ca1\u6cd5\u6c42\u9006\uff0c\u8003\u8651\u628a\u4e0a\u9762\u7684 $x$ \u5f04\u4e0b\u6765\uff0c\u7136\u540e\u5f97\u5230\uff1a\n$$\nB=\\frac{1}{\\sum_{i=0}^\\infty \\frac{x^i}{(i+1)!}}\n$$\n\u7136\u540e\u5c31\u53ef\u505a\u4e86\u3002\u987a\u5e26\u4e00\u63d0\uff0c\u8fd9\u91cc\u7684 $B$ \u5c31\u662f\u591a\u6570\u9898\u89e3\u91cc\u9762\u63d0\u5230\u7684\u4f2f\u52aa\u5229\u6570\u3002\n\n[mivik.h](https://mivik.gitee.io/mivik.h)\n\n[\u4ee3\u7801](https://paste.ubuntu.com/p/MnQwcccB8B/)",
        "postTime": 1606402038,
        "uid": 45182,
        "name": "Mivik",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3711 \u3010\u4ed3\u9f20\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a$S_k(x)=\\sum_{i=0}^xi^k$\uff0c\u9ed8\u8ba4 $0^0=1$\uff0c\u6c42\n\n$$\\sum_{i=0}^nS_i(x)a_i$$\n\n\u8fd9\u4e2a\u591a\u9879\u5f0f\uff0c$n\\le250000$\uff0c\u5bf9 $998244353$ \u53d6\u6a21\u3002\n\n\u6211\u4eec\u77e5\u9053[\u4e00\u4e2a\u4e1c\u897f](https://www.luogu.com.cn/blog/Peterprpr/hxznohorse)\uff0c\u7136\u540e\u6211\u4eec\u8ba9 $B_n=B_n+[n=1]$\u3002\n\n\u540e\u9762\u90a3\u4e2a $B_n$ \u4e3a\u539f\u6765\u7684\u4f2f\u52aa\u5229\u6570\uff0c\u524d\u9762\u90a3\u4e2a $B_n$ \u8868\u793a\u6211\u4eec\u7684\u4f2f\u52aa\u5229\u6570\u3002\n\n$$\\frac 1{m+1}\\sum_{k=0}^m\\binom{m+1}k(B_k+[k=1])n^{m+1-k}$$\n\n$$\\sum_{i=0}^n\\frac{a_i}{i+1}\\sum_{j=0}^{i}B_{j}\\binom{i+1}{j}x^{i+1-j}$$\n\n$$\\sum_{i=0}^n\\frac{a_i}{i+1}\\sum_{j=0}^{i}B_{i-j}\\binom{i+1}{j+1}x^{j+1}$$\n\n$$\\sum_{j=0}^{n}\\frac{x^{j+1}}{(j+1)!}\\sum_{i=j}^n\\frac{a_i}{i+1}B_{i-j}\\frac{(i+1)!}{(i-j)!}$$\n\n$$\\sum_{j=0}^{n}\\frac{x^{j+1}}{(j+1)!}\\sum_{i=j}^nB_{i-j}\\frac{a_ii!}{(i-j)!}$$\n\n$$\\sum_{j=0}^{n}\\frac{x^{j+1}}{(j+1)!}\\sum_{i=0}^{n-j}B_{i}\\frac{a_{i+j}(i+j)!}{i!}$$\n\n\u8bb0 $c_i=a_{n-i}(n-i)!$\n\n$$\\sum_{j=0}^{n}\\frac{x^{j+1}}{(j+1)!}\\sum_{i=0}^{n-j}\\frac{B_{i}}{i!}c_{n-j-i}$$\n\n\u5377\u5c31\u662f\u4e86\u3002\n\n\u56e0\u4e3a\u4e0a\u9762\u653e\u7684\u94fe\u63a5\u7684\u505a\u6cd5\u6709\u5c40\u9650\u6027\uff0c\u5c31\u662f $k=0$ \u65f6\u4e0d\u884c\uff0c\u6240\u4ee5 $[x^0]$ \u8fd8\u8981\u7279\u5224\u3002\n\n```cpp\nint r;\nsigned main(){\n  int n;\n  cin>>n;\n  poly a(n+1),c(n+1);\n  init(extend(n+1));\n  rep(i,0,n)a[i]=jcinv[i+1];\n  a=Inv(a);\n  a[1]++;\n  rep(i,0,n){\n    cin>>r;\n    if(i==0)cout<<r<<' ';\n    c[n-i]=Mul(jc[i],r);\n  }\n  c=c*a;\n  rep(i,0,n)cout<<Mul(c[n-i],jcinv[i+1])<<\" \";\n}\n```\n\u9644\u8d60[\u591a\u9879\u5f0f\u677f\u5b50](https://www.luogu.com.cn/blog/Peterprpr/mu-ban)\u3002",
        "postTime": 1640159580,
        "uid": 100325,
        "name": "peterwuyihong",
        "ccfLevel": 7,
        "title": "P3711 \u4ed3\u9f20\u7684\u6570\u5b66\u9898"
    },
    {
        "content": "[\u6d1b\u8c37\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P3711)\n\n\u63d0\u4f9b\u4e00\u79cd\u4e0d\u592a\u4e00\u6837\u7684\u505a\u6cd5\u3002\n\n\u5047\u8bbe\u8981\u6c42\u7684\u591a\u9879\u5f0f\u4e3a $f(x)$\u3002\u6211\u4eec\u8003\u5bdf $f(x)-f(x-1)$\uff0c\u4e0d\u96be\u53d1\u73b0\u5176\u7b49\u4e8e $\\sum\\limits_{i=0}^na_ix^i$\n\n\u8003\u8651\u8bbe $f(x)=\\sum\\limits_{i=0}^{n+1}b_ix^i$\uff0c\u90a3\u4e48\u76f4\u63a5\u4ee3\u5165 $x-1$ \u5e76\u5316\u7b80\u53ef\u4ee5\u5f97\u5230\uff1a\n$$\n\\begin{aligned}\nf(x-1)&=\\sum\\limits_{i=0}^{n+1}b_i(x-1)^i\\\\\n&=\\sum\\limits_{i=0}^{n+1}b_i\\sum\\limits_{j=0}^i\\dbinom{i}{j}(-1)^{i-j}x^j\\\\\n&=\\sum\\limits_{i=0}^{n+1}(\\sum\\limits_{j=i}^{n+1}\\dbinom{j}{i}(-1)^{j-i}b_j)x^i\n\\end{aligned}\n$$\n\u6545\n$$\n\\begin{aligned}\nf(x)-f(x-1)&=\\sum\\limits_{i=0}^{n+1}(\\sum\\limits_{j=i+1}^{n+1}\\dbinom{j}{i}(-1)^{j-i}b_j)x^i\n\\end{aligned}\n$$\n\u6839\u636e $f(x)-f(x-1)=\\sum\\limits_{i=0}^na_ix^i$ \u53ef\u5f97\n$$\n\\sum\\limits_{j=i+1}^{n+1}\\dbinom{j}{i}(-1)^{j-i}b_j=a_i\n$$\n\u6309\u7167\u5957\u8def\u62c6\u7ec4\u5408\u6570\uff1a\n$$\n\\dfrac{1}{i!}\\sum\\limits_{j=i+1}^{n+1}(j!\u00b7b_j)\u00b7(\\dfrac{1}{(j-i)!}(-1)^{j-i})=a_i\n$$\n\u8bbe\n$$\nf_i=i!\u00b7b_i\n$$\n\n$$\ng_i=\\dfrac{1}{i!}(-1)^i,g_0=0\n$$\n\n$$\nh_i=a_i\u00b7i!\n$$\n\n\u90a3\u4e48\u4e0a\u5f0f\u53ef\u4ee5\u5199\u4f5c\uff1a\n$$\nh_i=\\sum\\limits_{x-y=i}f_xg_y\n$$\n\u559c\u95fb\u4e50\u89c1\u7684\u51cf\u6cd5\u5377\u79ef\uff0c\u6309\u7167\u5957\u8def\u8bbe\n$$\nf'_i=f_{n+1-i},h'_i=h_{n+1-i}\n$$\n\u90a3\u4e48\u6709 $h'$ \u4e3a $f'$ \u4e0e $g$\uff0c\u6309\u7167\u5e38\u7406\u662f\u4e00\u904d\u6c42\u9006\u5c31\u53ef\u4ee5\u89e3\u51b3\u7684\u4e8b\uff0c\u4f46\u662f\u975e\u5e38\u60b2\u50ac\u7684\u662f $g_0=0$\uff0c\u56e0\u6b64\u65e0\u6cd5\u76f4\u63a5\u6c42\u9006\uff0c\u4e0d\u8fc7\u6ce8\u610f\u5230\u5bf9\u4e8e $f'$ \u548c $h'$ \u540c\u6837\u6709\u5b83\u4eec\u7684\u7b2c $0$ \u9879\u4e3a $0$\uff0c\u56e0\u6b64\u53ef\u4ee5\u5c06\u6570\u7ec4\u5168\u90e8\u5411\u524d\u5e73\u79fb\u4e00\u4f4d\u7136\u540e\u6c42\u9006\u3002\u8fd8\u6709\u5c31\u662f\u539f\u6570\u7ec4\u662f $n+1$ \u6b21\u591a\u9879\u5f0f\uff0c\u5e73\u79fb\u4ee5\u540e\u53d8\u6210\u4e86 $n$ \u6b21\u591a\u9879\u5f0f\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5927\u81f4\u786e\u5b9a\u7684 $f_i$ \u53ea\u6709 $n+1$ \u4f4d\uff0c\u600e\u4e48\u529e\u5462\uff1f\u9996\u5148\u6ce8\u610f\u5230 $f'_{n+1}=b_0$\uff0c\u4e5f\u5c31\u662f\u5f85\u6c42\u591a\u9879\u5f0f\u7684\u5e38\u6570\u9879\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u4ee3\u5165 $x=0$ \u6c42\u5f97 $f'_{n+1}=a_{0}$\u3002\u8fd8\u6709\u5c31\u662f\u7531\u4e8e\u4f60\u5bf9 $f',g$ \u5377\u79ef\u662f\u5728 $\\bmod x^{n+1}$ \u610f\u4e49\u4e0b\u8fdb\u884c\uff0c\u5e76\u4e14 $g_0=0$\uff0c\u56e0\u6b64\u7406\u8bba\u4e0a\u6765\u8bf4 $f'_n$ \u662f\u4e0d\u80fd\u901a\u8fc7 $f'$ \u4e0e $g$ \u5377\u79ef\u4e3a $h'$ \u8fd9\u4e00\u6761\u4ef6\u786e\u5b9a\u7684\uff0c\u4e0d\u8fc7\u6ce8\u610f\u5230\u591a\u9879\u5f0f\u6c42\u9006\u7684\u8fc7\u7a0b\u4e2d\u5982\u679c\u6211\u4eec\u56fa\u5b9a\u4f4f $f'_0$\uff0c\u90a3\u4e48\u6240\u6709\u6570\u90fd\u53ef\u8868\u793a\u4e3a $f'_i=v_i\u00b7\\dfrac{1}{f'_0}$ \u7684\u5f62\u5f0f\uff0c\u5176\u4e2d $v_i$ \u4e3a\u5e38\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u6c42\u51fa\u6765\u7684 $f'$ \u4e0e\u771f\u6b63\u7684 $f'$ \u662f\u5b58\u5728\u6bd4\u4f8b\u5173\u7cfb\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u8003\u8651\u4ee3\u5165 $x=1$ \u6c42\u51fa\u5f85\u6c42\u591a\u9879\u5f0f\u7684\u7cfb\u6570\u548c\uff0c\u8fd9\u6837\u5373\u53ef\u6c42\u51fa\u771f\u6b63\u7684 $f'$ \u76f8\u8f83\u4e8e\u6211\u4eec\u6c42\u51fa\u7684 $f'$ \u7f29\u653e\u4e86\u591a\u5c11\u500d\uff0c\u4e5f\u5c31\u53ef\u4ee5\u6c42\u51fa\u771f\u6b63\u7684 $f'$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $n\\log n$\u3002\n\n```cpp\nconst int pr=3;\nconst int ipr=332748118;\nconst int MAXN=255555;\nconst int MAXP=524288;\nint n,fac[MAXN+5],ifac[MAXN+5];\nvoid init_fac(int n){\n\tfor(int i=(fac[0]=ifac[0]=ifac[1]=1)+1;i<=n;i++) ifac[i]=1ll*ifac[MOD%i]*(MOD-MOD/i)%MOD;\n\tfor(int i=1;i<=n;i++) fac[i]=1ll*fac[i-1]*i%MOD,ifac[i]=1ll*ifac[i-1]*ifac[i]%MOD;\n}\nint qpow(int x,int e){\n\tint ret=1;\n\tfor(;e;e>>=1,x=1ll*x*x%MOD) if(e&1) ret=1ll*ret*x%MOD;\n\treturn ret;\n}\nint rev[MAXP+5];\nvoid NTT(vector<int> &a,int len,int type){\n\tint lg=31-__builtin_clz(len);\n\tfor(int i=0;i<len;i++) rev[i]=(rev[i>>1]>>1)|((i&1)<<lg-1);\n\tfor(int i=0;i<len;i++) if(i<rev[i]) swap(a[i],a[rev[i]]);\n\tfor(int i=2;i<=len;i<<=1){\n\t\tint W=qpow((type<0)?ipr:pr,(MOD-1)/i);\n\t\tfor(int j=0;j<len;j+=i){\n\t\t\tfor(int k=0,w=1;k<(i>>1);k++,w=1ll*w*W%MOD){\n\t\t\t\tint X=a[j+k],Y=1ll*w*a[(i>>1)+j+k]%MOD;\n\t\t\t\ta[j+k]=(X+Y)%MOD;a[(i>>1)+j+k]=(X-Y+MOD)%MOD;\n\t\t\t}\n\t\t}\n\t} if(!~type){\n\t\tint ivn=qpow(len,MOD-2);\n\t\tfor(int i=0;i<len;i++) a[i]=1ll*a[i]*ivn%MOD;\n\t}\n}\nvector<int> conv(vector<int> a,vector<int> b){\n\tint LEN=1;while(LEN<a.size()+b.size()) LEN<<=1;\n\ta.resize(LEN,0);b.resize(LEN,0);NTT(a,LEN,1);NTT(b,LEN,1);\n\tfor(int i=0;i<LEN;i++) a[i]=1ll*a[i]*b[i]%MOD;\n\tNTT(a,LEN,-1);return a;\n}\nvector<int> getinv(vector<int> a,int len){\n\tvector<int> b(len,0);b[0]=qpow(a[0],MOD-2);\n\tfor(int i=2;i<=len;i<<=1){\n\t\tvector<int> c(b.begin(),b.begin()+(i>>1));\n\t\tvector<int> d(a.begin(),a.begin()+i);\n\t\tc=conv(conv(c,c),d);\n\t\tfor(int j=0;j<i;j++) b[j]=(2ll*b[j]-c[j]+MOD)%MOD;\n\t} return b;\n}\nvector<int> A,B;\nint res[MAXN+5];\nint main(){\n\tscanf(\"%d\",&n);init_fac(MAXN);A.resize(n+2);int sum=0;\n\tfor(int i=n;~i;i--) scanf(\"%d\",&A[i]),sum=(sum+A[i])%MOD,A[i]=1ll*A[i]*fac[n-i]%MOD;\n\tB.resize(n+2);for(int i=1;i<=n+1;i++) B[i-1]=(i&1)?(MOD-ifac[i]):ifac[i];\n\tint LEN=1;while(LEN<=n+2) LEN<<=1;\n\tA.resize(LEN,0);B.resize(LEN,0);\n\tvector<int> C=conv(A,getinv(B,LEN));\n//\tprintf(\"A: \");for(int i=0;i<n+1;i++) printf(\"%d%c\",A[i],\" \\n\"[i==n]);\n//\tprintf(\"B: \");for(int i=0;i<n+1;i++) printf(\"%d%c\",B[i],\" \\n\"[i==n]);\n\tfor(int i=1;i<=n+1;i++) res[i]=1ll*C[n+1-i]*ifac[i]%MOD;\n\tres[0]=A[n];int iv=qpow(res[n+1],MOD-2);\n\tfor(int i=1;i<=n+1;i++) res[i]=1ll*res[i]*iv%MOD;\n\tint ssum=0;for(int i=1;i<=n+1;i++) ssum=(ssum+res[i])%MOD;\n\tint mul=1ll*sum*qpow(ssum,MOD-2)%MOD;\n\tfor(int i=1;i<=n+1;i++) res[i]=1ll*res[i]*mul%MOD;\n\tfor(int i=0;i<=n+1;i++) printf(\"%d%c\",res[i],\" \\n\"[i==n+1]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1633690584,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3711 \u4ed3\u9f20\u7684\u6570\u5b66\u9898"
    },
    {
        "content": "[P3711 \u4ed3\u9f20\u7684\u6570\u5b66\u9898](https://www.luogu.com.cn/problem/P3711) \n\n**\u524d\u7f6e\u77e5\u8bc6\uff1a\u4f2f\u52aa\u5229\u6570**\n\n\u5b9a\u4e49\u4f2f\u52aa\u5229\u6570 $\\sum_{i=0}^nB_i{n+1\\choose i}=[n=0]$\u3002\u8bbe\u5176\u6307\u6570\u578b\u751f\u6210\u51fd\u6570\u4e3a $B(x)$\n$$\n\\begin{aligned}\n\\sum_{i=0}^{n+1}B_i{n+1\\choose i}=[n=0]+B_{n+1}\\\\\n\t\t\t\t\\sum_{i=0}^{n}B_i{n\\choose i}=[n=1]+B_{n}\\\\\n\t\t\t\t\\sum_{i=0}^{n}\\frac{B_i}{i!}\\frac{1}{(n-i)!}=[n=1]+\\frac{B_n}{n!}\\\\\n\t\t\t\t\tB(x)e^x=x+B(x)\\Rightarrow B(x)=\\frac{x}{e^x-1}\n\t\t\t\\end{aligned}\n$$\n\u4f2f\u52aa\u5229\u6570\u53ef\u4ee5\u7528\u6765\u7b97\u81ea\u7136\u6570\u5e42\u548c\u3002\u8bbe $S_m(n)=\\sum\\limits_{i=0}^{n-1}i^m,G(x)=\\sum\\limits_{i=0}\\frac{S_i(n)x^i}{i!}$\uff0c$B$ \u8868\u793a\u4f2f\u52aa\u5229\u6570\uff0c\u5219\u6709\n$$\nG(x)=\\sum_{i=0}\\sum_{j=0}^{n-1}j^i\\frac{x^i}{i!}=\\sum_{j=0}^{n-1}e^{jx}=\\frac{e^{nx}-1}{e^x-1}=B(x)\\frac{e^{nx}-1}{x}=B(x)\\sum_{i=0}\\frac{n^{i+1}x^i}{(i+1)!}\\\\\nS_m(n)=\\frac{1}{m+1}\\sum_{i=0}^m{m+1\\choose i}{B_i}n^{m+1-i}\n$$\n\n**\u672c\u9898solution**\n\n~~\u5982\u679c\u4f1a\u4e86\u4e0a\u9762\u7684\u90e8\u5206\uff0c\u8fd9\u9898\u5176\u5b9e\u633a\u677f\u7684\u3002~~\n\n\u5047\u8bbe $S_k(x)=\\sum_{i=0}^{x-1}i^k$\uff0c\u4e4b\u540e\u628a $x$ \u5168\u6362\u4e3a $x+1$ \u5373\u53ef\u3002\u6839\u636e\u81ea\u7136\u6570\u5e42\u548c\u7684\u516c\u5f0f\n$$\n\\begin{aligned}\n&\\sum_{k=0}^{n}\\frac{a_k}{k+1}\\sum_{i=0}^k{k+1\\choose i}{B_i}x^{k+1-i}\\\\\n=&\\sum_{k=0}^{n}\\frac{a_k}{k+1}\\sum_{i=0}^k{k+1\\choose k-i}{B_{k-i}}x^{i+1}\\\\\n=&\\sum_{k=0}^{n}k!a_k\\sum_{i=0}^k\\frac{B_{k-i}}{(k-i)!}\\frac{x^{i+1}}{(i+1)!}\\\\\n=&\\sum_{i=1}^{n+1}\\frac{x^{i}}{i!}\\sum_{k=i-1}^{n}k!a_k\\frac{B_{k-i+1}}{(k-i+1)!}\\\\\n\\end{aligned}\n$$\n\n\u540e\u534a\u90e8\u5206\u662f\u4e2a\u5dee\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u53ef\u4ee5\u76f4\u63a5\u7b97\u3002\u8bbe\u540e\u534a\u90e8\u5206\u4e3a $f_i$ \uff0c\u5c06 $x+1$ \u4ee3\u5165\u5f97\n$$\n\\begin{aligned}&\\sum_{i=1}^{n+1}\\frac{(x+1)^{i}}{i!}f_i\\\\=&\\sum_{i=1}^{n+1}\\frac{f_i}{i!}\\sum_{j=0}^i{i\\choose j}x^j\\\\=&\\sum_{i=0}^{n+1}\\frac{x^i}{i!}\\sum_{j=i}^{n+1}\\frac{f_j}{(j-i)!}\\end{aligned}\n$$\n\n\u4ecd\u7136\u662f\u5dee\u5377\u79ef\uff0c\u76f4\u63a5\u7b97\u5373\u53ef\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nnamespace FGF\n{\n\tconst int N=1e6+5,mo=998244353,g=3,gi=(mo+1)/3;\n\tint n,lim,r[N],a[N],inv[N],b[N],fac[N],c[N];\n\tint qpow(int x,int y)\n\t{\n\t\tint s=1;\n\t\twhile(y)\n\t\t{\n\t\t\tif(y&1)s=1ll*s*x%mo;\n\t\t\tx=1ll*x*x%mo;\n\t\t\ty>>=1;\n\t\t}\n\t\treturn s;\n\t}\n\tvoid NTT(int *y,int op)\n\t{\t\n\t\tfor(int i=0;i<lim;i++)\n\t\t\tif(r[i]<i)swap(y[r[i]],y[i]);\n\t\tfor(int l=1;l<lim;l<<=1)\n\t\t\tfor(int i=0,wn=qpow(op==1?g:gi,(mo-1)/(l<<1));i<lim;i+=(l<<1))\n\t\t\t\tfor(int j=0,w=1;j<l;j++,w=1ll*w*wn%mo)\n\t\t\t\t{\n\t\t\t\t\tint tmp=(y[i+j]-1ll*w*y[i+j+l]%mo+mo)%mo;\n\t\t\t\t\ty[i+j]=(y[i+j]+1ll*w*y[i+j+l]%mo)%mo,y[i+j+l]=tmp;\n\t\t\t\t}\n\t\tif(op==-1)\n\t\t\tfor(int i=0,inv=qpow(lim,mo-2);i<lim;i++)\n\t\t\t\ty[i]=1ll*y[i]*inv%mo;\t\n\t}\n\tvoid getinv(int *ans,int *a,int n)\n\t{\n\t\tif(n==1){ans[0]=qpow(a[0],mo-2);return ;}\n\t\tgetinv(ans,a,n>>1);\n\t\tstatic int tmp[N];\n\t\tlim=n<<1;\n\t\tfor(int i=0;i<lim;i++)tmp[i]=0,r[i]=r[i>>1]>>1|(i&1)*(lim>>1);\n\t\tfor(int i=0;i<n;i++)tmp[i]=a[i];\n\t\tNTT(tmp,1),NTT(ans,1);\n\t\tfor(int i=0;i<lim;i++)ans[i]=1ll*ans[i]*(2ll-1ll*ans[i]*tmp[i]%mo+mo)%mo;\n\t\tNTT(ans,-1);\n\t\tfor(int i=n;i<lim;i++)ans[i]=0;\n\t}\n\tvoid work()\n\t{\n\t\tscanf(\"%d\",&n);\n\t\tfac[0]=inv[0]=inv[1]=1;\n\t\tfor(int i=2;i<=n+10;i++)\n\t\t\tinv[i]=1ll*inv[mo%i]*(mo-mo/i)%mo;\n\t\tfor(int i=1;i<=n+10;i++)\n\t\t\tfac[i]=1ll*i*fac[i-1]%mo,inv[i]=1ll*inv[i-1]*inv[i]%mo;\n\t\tfor(int i=0;i<=n;i++)\n\t\t\tscanf(\"%d\",&a[i]),a[i]=1ll*a[i]*fac[i]%mo;\n\t\tfor(lim=1;lim<(n+1);lim<<=1);\n\t\tgetinv(b,inv+1,lim);\n\t\treverse(a,a+n+1);\n\t\tfor(lim=1;lim<(n+n+2);lim<<=1);\n\t\tfor(int i=0;i<lim;i++)r[i]=r[i>>1]>>1|(i&1)*(lim>>1);\n\t\tNTT(b,1),NTT(a,1);\n\t\tfor(int i=0;i<lim;i++)a[i]=1ll*a[i]*b[i]%mo;\n\t\tNTT(a,-1);\n\t\treverse(a,a+n+1);\n\t\tmemset(b,0,sizeof(b));\n\t\tfor(int i=1;i<=n+1;i++)\n\t\t\tb[i]=a[i-1];\n\t\tmemset(a,0,sizeof(a));\n\t\tfor(int i=0;i<=n+1;i++)\n\t\t\ta[i]=inv[i];\n\t\treverse(b,b+n+2);\n\t\tfor(lim=1;lim<(n+n+4);lim<<=1);\n\t\tfor(int i=0;i<lim;i++)r[i]=r[i>>1]>>1|(i&1)*(lim>>1);\n\t\tNTT(b,1),NTT(a,1);\n\t\tfor(int i=0;i<lim;i++)a[i]=1ll*a[i]*b[i]%mo;\n\t\tNTT(a,-1);\n\t\treverse(a,a+n+2);\n\t\tfor(int i=0;i<=n+1;i++)\n\t\t\tprintf(\"%lld \",1ll*a[i]*inv[i]%mo);\n\t}\n}\nint main()\n{\n\tFGF::work();\n\treturn 0;\n}\n```\n\n\u4ee3\u7801\u4e5f\u4e0d\u7b97\u957f\uff0c\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u5199\u4e86\u4fe9\u5c0f\u65f6\\kk",
        "postTime": 1615294217,
        "uid": 224403,
        "name": "\u6728xx\u6728\u5927",
        "ccfLevel": 9,
        "title": "P3711 \u4ed3\u9f20\u7684\u6570\u5b66\u9898\uff08\u4f2f\u52aa\u5229\u6570\uff09"
    }
]