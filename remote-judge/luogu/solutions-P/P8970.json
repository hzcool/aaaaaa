[
    {
        "content": "### $\\text{Part 1}$\n\n\u9996\u5148\u8003\u8651\u66b4\u529b\u3002\u9884\u5904\u7406\u6bcf\u4e2a\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\uff0c\u7136\u540e\u679a\u4e3e\u6bcf\u4e2a\u70b9\u7684\u4e09\u79cd\u72b6\u6001\uff0c\u6700\u540e\u8fdb\u884c\u5224\u65ad\u3002\u8fd9\u6837\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O}(n3^n)$\u3002\u671f\u671b\u5f97\u5206 $7\\text{pts}$\u3002\n\n### $\\text{Part 2}$\n\n\u63a5\u7740\uff0c\u5f88\u5bb9\u6613\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a\u6811\u5f62 $\\text{DP}$\u3002\u4e3a\u4e86\u65b9\u4fbf\u6211\u4eec\u628a\u5b83\u770b\u6210\u4e00\u68f5\u6709\u6839\u6811\u3002\u800c\u7531\u4e8e\u4e00\u4e2a\u70b9\u9009\u4ec0\u4e48\u5bf9\u5b83\u7684 $r$ \u7ea7\u7956\u5148\u90fd\u662f\u6709\u8d21\u732e\u7684\uff0c\u540c\u65f6 $1\\le r\\le 7$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u52a0\u4e0a\u4e00\u4e2a\u72b6\u538b $\\text{DP}$\u3002\n\n\u4e0d\u59a8\u8bbe $f(i,S,T)$ \u8868\u793a\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u6709 $S$ \u96c6\u5408\u7684\u8d21\u732e\uff0c\u9700\u8981 $T$ \u96c6\u5408\u7684\u8d21\u732e\u7684\u6700\u5c0f\u4ef7\u503c\u3002\u5176\u4e2d $S,T$ \u662f\u4e24\u4e2a $r$ \u4f4d\u4e8c\u8fdb\u5236\u6570\u3002\n\n\u6211\u4eec\u5bf9\u5f53\u524d\u8282\u70b9\u7684 $S,T$ \u8fdb\u884c\u679a\u4e3e\uff0c\u518d\u5bf9\u5f53\u524d\u513f\u5b50\u7684 $S,T$ \u8fdb\u884c\u679a\u4e3e\uff0c\u6700\u540e\u5408\u5e76\u4e3a\u65b0\u7684 $S,T$\u3002\n\n\u56fe\u4e2d\u662f $r=3$ \u7684\u60c5\u51b5\u3002\u5176\u4e2d $x,y$ \u8868\u793a $u$ \u8282\u70b9\u7684 $S,T$\uff0c$z,w$ \u8868\u793a $v$ \u8282\u70b9\u7684 $S,T$\uff0c$s,t$ \u8868\u793a\u5408\u5e76\u51fa\u6765\u7684 $S,T$\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/54jns4bf.png)\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5728\u5408\u5e76\u8fc7\u7a0b\u4e2d\uff0c$v$ \u7684\u72b6\u6001\u4f1a\u53d1\u751f\u9519\u4f4d\u73b0\u8c61\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e0b\u8868\uff1a\n\n| $y_1$ | $z_1$ | $s_0t_1$ |\n| :----------: | :----------: | :----------: |\n| $0$ | $0$ | $00$ |\n| $0$ | $1$ | $10$ |\n| $1$ | $0$ | $01$ |\n| $1$ | $1$ | $10$ |\n\n| $x_3\\color{red}w_4$ | $w_3$ | $s_3t_4$ |\n| :----------: | :----------: | :----------: |\n| $00$ | $0$ | $00$ |\n| $00$ | $1$ | $\\color{red}{01}$ |\n| $10$ | $0$ | $10$ |\n| $10$ | $1$ | $10$ |\n\n| $x_iy_{i+1}$ | $z_{i+1}w_i$ | $s_it_{i+1}$ |\n| :----------: | :----------: | :----------: |\n| $00$ | $00$ | $00$ |\n| $00$ | $01$ | $01$ |\n| $00$ | $10$ | $10$ |\n| $00$ | $11$ | $11$ |\n| $01$ | $00$ | $01$ |\n| $01$ | $01$ | $01$ |\n| $01$ | $10$ | $10$ |\n| $01$ | $11$ | $11$ |\n| $10$ | $00$ | $10$ |\n| $10$ | $01$ | $10$ |\n| $10$ | $10$ | $10$ |\n| $10$ | $11$ | $10$ |\n| $11$ | $00$ | $11$ |\n| $11$ | $01$ | $11$ |\n| $11$ | $10$ | $10$ |\n| $11$ | $11$ | $10$ |\n\n\u4e0a\u6587\u4e2d\u7ea2\u8272\u7684\u72b6\u6001\u662f\u4e0d\u5fc5\u8981\u6216\u4e0d\u5408\u6cd5\u7684\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n16^r)$\uff0c\u671f\u671b\u5f97\u5206 $43\\text{pts}$\u3002\n\n\u5982\u679c\u7279\u5224 $r=1$ \u7684\u60c5\u51b5\uff0c\u8fdb\u884c $\\mathcal{O}(n)$ \u7684 $\\text{DP}$\uff0c\u53ef\u4ee5\u62ff\u5230 $49\\text{pts}$\u3002\n\n### $\\text{Part 3}$\n\n\u8003\u8651\u8fdb\u884c\u4f18\u5316\u3002\u6211\u4eec\u73b0\u5728\u662f\u679a\u4e3e\u4e24\u4e2a\u72b6\u6001\u5408\u5e76\u4e3a\u4e00\u4e2a\u72b6\u6001\uff0c\u4e0d\u59a8\u679a\u4e3e\u4e00\u4e2a\u72b6\u6001\u62c6\u4e3a\u4e24\u4e2a\u72b6\u6001\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u884c\u9884\u5904\u7406\u3002\n\n\u4e8e\u662f\u5f97\u5230\u4e0b\u8868\uff1a\n\n| $y_1$ | $z_1$ | $t_1$ |\n| :----------: | :----------: | :----------: |\n| $0$ | $0/1$ | $0$ |\n| $1$ | $1$ | $0$ |\n| $1$ | $0$ | $1$ |\n\n| $x_3$ | $w_3$ | $s_3$ |\n| :----------: | :----------: | :----------: |\n| $0$ | $0$ | $0$ |\n| $1$ | $0/1$ | $1$ |\n\n| $x_iy_{i+1}$ | $z_{i+1}w_i$ | $s_it_{i+1}$ |\n| :----------: | :----------: | :----------: |\n| $00$ | $00$ | $00$ |\n| $01$ | $00/01$ | $01$ |\n| $00/01$ | $01$ | $01$ |\n| $10$ | $00/01$ | $10$ |\n| $00/01$ | $10$ | $10$ |\n| $10/11$ | $10/11$ | $10$ |\n| $11$ | $00/01$ | $11$ |\n| $00/01$ | $11$ | $11$ |\n\n\u4e0d\u59a8\u679a\u4e3e\u6240\u6709\u7684\u53ef\u80fd\u6027\uff0c\u8fd9\u6837\u7684\u590d\u6742\u5ea6\u662f $\\mathcal{O}(n8^r)$ \u7684\uff0c\u671f\u671b\u5f97\u5206 $81\\text{pts}$\u3002\n\n### $\\text{Part 4}$\n\n\u7ee7\u7eed\u8fdb\u884c\u4f18\u5316\u3002\u6211\u4eec\u53d1\u73b0 $01$ \u7684\u9650\u5236\u6bd4 $00$ \u66f4\u52a0\u4e25\u683c\uff0c\u56e0\u6b64\u5c06\u72b6\u6001\u5408\u5e76\u3002\n\n\u4f18\u5316\u524d\uff1a\n\n| $x_iy_{i+1}$ | $z_{i+1}w_i$ | $s_it_{i+1}$ |\n| :----------: | :----------: | :----------: |\n| $01$ | $00/01$ | $01$ |\n| $00/01$ | $01$ | $01$ |\n\n\u4f18\u5316\u540e\uff1a\n\n| $x_iy_{i+1}$ | $z_{i+1}w_i$ | $s_it_{i+1}$ |\n| :----------: | :----------: | :----------: |\n| $00/01$ | $00/01$ | $01$ |\n\n\u8fd9\u6837\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O}(n7^r)$\uff0c\u671f\u671b\u5f97\u5206 $100\\text{pts}$\u3002\n\n### $\\text{Code:}$\n\n```cpp\n#include<bits/stdc++.h>\n//#pragma GCC optimize(2)\nconst int N=2e3+7;\nconst int M=2e3+7;\nconst int R=7;\nconst long long LONGLONG_INF=0x3f3f3f3f3f3f3f3f;\nconstexpr int _7[R+1]={1,7,49,343,2401,16807,117649,823543};\nconstexpr int _5[R+1]={1,5,25,125,625,3125,15625,78125};\nconstexpr int _first[7]={0,1,2,1,4,3,1};\nconstexpr int _second[7]={0,1,1,2,4,1,3};\nconstexpr int _result[7]={0,1,2,2,2,3,3};\nconstexpr int __first[6][2]={{0,0},{0,1},{1,0},{1,1},{1,0},{1,1}};\nconstexpr int __second[6][2]={{2,0},{2,1},{1,0},{1,1},{0,0},{0,1}};\nconstexpr int __result[6][2]={{0,0},{0,1},{0,0},{0,1},{1,0},{1,1}};\nint n,m,r,a[N],b[N];\nint _h[N],cnt;\nint mp[_7[R-1]*6/*<<1*/][2];int mpdown[_7[R-1]*6/*<<1*/];\nint upu[1<<R<<R/*<<1*/];int downu[_5[R-1]*6/*<<1*/];\nint upv[1<<R<<R/*<<1*/];int downv[_5[R-1]*6/*<<1*/];\nint from[_5[R-1]*6*6/*<<1*/][3];int common[_5[R-1]*6*6/*<<1*/];bool vis[_5[R-1]*6*6/*<<1*/];\nint tot,tot2;\nlong long minu[_5[R-1]*4/*<<1*/],minv[_5[R-1]*6/*<<1*/];\nstruct edge{\n    int nxt,v;\n}_e[M<<1];\ninline void add_edge(int u,int v){\n    _e[++cnt].nxt=_h[u],_e[cnt].v=v;\n    _h[u]=cnt;\n}\ninline long long min(const long long &a,const long long &b){\n\treturn a<b?a:b;\n} \nlong long f[N][1<<R<<R/*<<1*/],ans=LONGLONG_INF;\ninline void init(){\n\tfor(int i=0;i<3;i++){\n\t\tfor(int j=0;j<2;j++){\n\t\t\tfor(int k=0;k<_7[r-1];k++){\n\t\t\t\tint st=i*_7[r-1]*2+j*_7[r-1]+k;//tmp=10,i=0,j=1,k=3;\n\t\t\t\tfor(int p=0;p<r-1;p++){\n\t\t\t\t\tmp[st][0]+=_first[k/_7[p]%7]*_5[p];//+1\n\t\t\t\t\tmp[st][1]+=_second[k/_7[p]%7]*_5[p];//+2\n\t\t\t\t}\n\t\t\t\tmp[st][0]+=(__first[i*2+j][0]*_5[r-1]*2+__first[i*2+j][1]*_5[r-1]);\n\t\t\t\tmp[st][1]+=(__second[i*2+j][0]*_5[r-1]*2+__second[i*2+j][1]*_5[r-1]);\n\t\t\t}\n\t\t}\n\t}\n\tmemset(downu,-1,sizeof downu);\n\tmemset(downv,-1,sizeof downv);\n\tfor(int i=0;i<(1<<r<<r);i++){\n\t\tfor(int j=0;j<r-1;j++){\n\t\t\tint tmp1=(i>>j>>r)&1,tmp2=(i>>j>>1)&1;\n\t\t\tif(tmp1==0&&tmp2==1) upu[i]+=_5[j];\n\t\t\tif(tmp1==1&&tmp2==0) upu[i]+=2*_5[j];\n\t\t\tif(tmp1==1&&tmp2==1) upu[i]+=3*_5[j];\n\t\t\ttmp1=(i>>j>>r>>1)&1,tmp2=(i>>j)&1;\n\t\t\tif(tmp1==0&&tmp2==1) upv[i]+=_5[j];\n\t\t\tif(tmp1==1&&tmp2==0) upv[i]+=2*_5[j];\n\t\t\tif(tmp1==1&&tmp2==1) upv[i]+=3*_5[j];\n\t\t}\n\t\tupu[i]+=((i<<1>>r>>r)&1)*_5[r-1]+(i&1)*_5[r-1]*2;\n\t\tupv[i]+=((i>>r)&1)*_5[r-1]*2+((i<<1>>r)&1)*_5[r-1];\n\t\tdownu[upu[i]]=i;\n\t\tdownv[upv[i]]=i;\n\t}\n\tfor(int i=0;i<3;i++){\n\t\tfor(int j=0;j<2;j++){\n\t\t\tfor(int k=0;k<_5[r-1];k++){\n\t\t\t\tbool flag=0;bool flag2=0;\n\t\t\t\tint st=i*_5[r-1]*2+j*_5[r-1]+k;\n\t\t\t\tif(i==2) from[++tot][0]=st,from[tot][1]=st-_5[r-1]*4,from[tot][2]=st-_5[r-1]*2;\n\t\t\t\tif(j==1) flag2=1;\n\t\t\t\tfor(int p=0;p<r-1;p++){\n\t\t\t\t\t//if(from[tot][0]==st&&(k/_5[p]%5==1||k/_5[p]%5==4)) ;\n\t\t\t\t\tif(k/_5[p]%5==1) from[++tot][0]=st,from[tot][1]=st-_5[p],from[tot][2]=st,flag=1;\n\t\t\t\t\tif(k/_5[p]%5==4) from[++tot][0]=st,from[tot][1]=st-_5[p]-_5[p],from[tot][2]=st-_5[p];\n\t\t\t\t}\n\t\t\t\tif(from[tot][0]!=st||flag||(i!=2&&st==0)) common[++tot2]=st;\n\t\t\t\tif(flag2) vis[st]=1;\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=0;i<3;i++){\n\t\tfor(int j=0;j<2;j++){\n\t\t\tfor(int k=0;k<_7[r-1];k++){\n\t\t\t\tint st=i*_7[r-1]*2+j*_7[r-1]+k;\n\t\t\t\tfor(int p=0;p<r-1;p++)\n\t\t\t\t\tmpdown[st]+=_result[k/_7[p]%7]*_5[p];\n\t\t\t\tmpdown[st]+=__result[i*2+j][0]*_5[r-1]*2+__result[i*2+j][1]*_5[r-1];\n\t\t\t\tmpdown[st]=downu[mpdown[st]];\n\t\t\t}\n\t\t}\n\t}\n}\ninline void first(int u){\n    f[u][1]=0;\n    f[u][1<<r]=a[u];\n    f[u][1<<r>>1<<r]=min(f[u][1<<r>>1<<r],(long long)b[u]);\n}\ninline void work(int u,int v){\n\tmemset(minu,0x3f,sizeof minu);\n\tmemset(minv,0x3f,sizeof minv);\n\tfor(int i=1;i<=tot2;i++){\n\t\tif(~downu[common[i]]) minu[common[i]]=min(minu[common[i]],f[u][downu[common[i]]]);\n\t\tif(~downv[common[i]]) minv[common[i]]=min(minv[common[i]],f[v][downv[common[i]]]);\n\t}\n\tfor(int i=1;i<=tot;i++){\n\t\tif(from[i][0]<_5[r-1]*4)\t\t\t\n\t\t\tminu[from[i][0]]=min(minu[from[i][1]],minu[from[i][2]]);\n\t\tminv[from[i][0]]=min(minv[from[i][1]],minv[from[i][2]]);\n\t\tif(vis[from[i][0]]) minv[from[i][0]]=min(minv[from[i][0]],minv[from[i][0]-_5[r-1]]);\n\t}\n}\ninline void solve(int u,int v){\n\tmemset(f[u],0x3f,sizeof f[u]);\n\tfor(int i=0;i<3;i++){\n\t\tfor(int j=0;j<2;j++){\n\t\t\tfor(int k=0;k<_7[r-1];k++){\n\t\t\t\tint tmp=i*_7[r-1]*2+j*_7[r-1]+k;\n\t\t\t\tint st=mpdown[tmp];\n\t\t\t\tf[u][st]=min(f[u][st],minu[mp[tmp][0]]+minv[mp[tmp][1]]);\n\t\t\t\t//if(f[u][st]!=LONGLONG_INF)\n\t\t\t\t//\tprintf(\"u:%d tmp:%d upu[st]:%d st:%d f[u][st]:%d mp[tmp][0]:%d mp[tmp][1]:%d minu[mp[tmp][0]]:%d O:%d minv[mp[tmp][1]]:%d O:%d\\n\",u,tmp,upu[st],st,f[u][st],mp[tmp][0],mp[tmp][1],minu[mp[tmp][0]],downu[mp[tmp][0]],minv[mp[tmp][1]],downv[mp[tmp][1]]);\n\t\t\t}\n\t\t}\n\t} \n}\ninline void dfs(int u,int fa){\n    first(u);\n    for(int ___=_h[u];___;___=_e[___].nxt){\n        int v=_e[___].v;if(v==fa) continue;\n        dfs(v,u);work(u,v);solve(u,v);\n    }\n}\ninline void answer(){\n    for(int i=0;i<(1<<r);i++) if(ans>f[1][i<<r]) ans=f[1][i<<r];\n    printf(\"%lld\\n\",ans);\n}\nint main(){\n\tmemset(f,0x3f,sizeof f);\n    scanf(\"%d%d\",&n,&r);\n    for(int i=1;i<n;i++){\n        int u,v;scanf(\"%d%d\",&u,&v);\n        add_edge(u,v);add_edge(v,u);\n    }\n    for(int i=1;i<=n;i++) scanf(\"%d%d\",&a[i],&b[i]);\n    init();dfs(1,0);answer();\n    return 0;\n}\n```\n",
        "postTime": 1672037162,
        "uid": 481527,
        "name": "AC_CSP",
        "ccfLevel": 5,
        "title": "\u5bbf\u547d | Regulation of Destiny \u9898\u89e3"
    }
]