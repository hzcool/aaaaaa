[
    {
        "content": "\u6253 acm \u7684\u65f6\u5019\u6ca1\u51b2\u5b8c\u7684\u9898...\n\n\u505a\u6cd5\u5c31\u662f\u8003\u8651\u7ecf\u8fc7 $T$ \u6b21\u64cd\u4f5c\u540e\u6bcf\u4e2a\u8ddd\u79bb\u76f8\u540c\u7684\u72b6\u6001\u5230\u8fbe\u7684\u6982\u7387\u662f\u76f8\u540c\u7684\uff0c\u5b9a\u4e49\u4e24\u4e2a\u72b6\u6001\u7684\u8ddd\u79bb\u4e3a\u76f8\u540c\u7684\u6570\u4f4d\u4e2a\u6570\u3002  \n\u8ba1\u7b97 $f_{i,j}$ \u8868\u793a\u548c\u72b6\u6001 $i$ \u8ddd\u79bb\u4e3a $j$ \u7684\u72b6\u6001\u6743\u503c\u4e4b\u548c\uff0c$g_{i,j}$ \u8868\u793a\u7ecf\u8fc7 $i$ \u8f6e\u4ee5\u540e\u72b6\u6001\u548c\u521d\u59cb\u72b6\u6001\u7684\u8ddd\u79bb\u4e3a $j$ \u7684\u65b9\u6848\u6570\u3002   \n$ans = \\sum_{i=0}^k \\frac{g_{t,i}}{\\binom{k}{i}\\times {n-1}^{k-i}} \\times f_{a,i}$\u3002   \n\u8ba1\u7b97 $f$ \u6570\u7ec4\u5c31\u662f\u9b54\u6539\u4e00\u4e0b $k$ \u8fdb\u5236 $fmt$ \u5c31\u884c\u4e86\uff0c\u6bcf\u6b21\u8003\u8651\u5f53\u524d\u4f4d\uff0c\u4e00\u4e2a\u72b6\u6001 $f_{i,j}$ \u8981\u4e48\u4ece $f_{i,j-1}$ \u8f6c\u79fb\u8fc7\u6765\uff0c\u8981\u4e48\u4ece $f_{x,j} (x \\neq i)$ \u8f6c\u79fb\u8fc7\u6765\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^k k^2)$\u3002   \n\u8ba1\u7b97 $g$ \u5c31\u662f\u8003\u8651 $g_{i,x} \\rightarrow g_{i+1,x}$ \u662f\u7ebf\u6027\u53d8\u6362\uff0c\u6bcf\u6b21\u4e58\u4e00\u4e2a\u77e9\u9635\u7684\u5f62\u5f0f\uff0c\u5229\u7528\u77e9\u9635\u5feb\u901f\u5e42\u5373\u53ef\uff0c\u8003\u8651\u5230 $q$ \u6bd4\u8f83\u5927\uff0c\u53ef\u4ee5\u7c7b\u4f3c $bsgs$ \u7684\u65b9\u6cd5\u9884\u5904\u7406\u51fa $M^1,M^2, \\cdots. M^B, M^{2B}, \\cdots, M^{B^2}$\uff0c\u67e5\u8be2\u6307\u5173\u5fc3\u7b2c $k$ \u884c\u56e0\u6b64 $k^2$ \u4e58\u4e00\u4e0b\u4fe9\u77e9\u9635\u5c31\u884c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(q k^2+\\sqrt{mod}k^3)$\u3002\n\n\n------------\n\n\u7ecf\u8fc7\u7b80\u5355\u7684\u5361\u5e38\u5373\u53ef\u901a\u8fc7\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i, l, r) for(int i = (l); i <= (r); i ++)\n#define per(i, r, l) for(int i = (r); i >= (l); i --)\n#define trv(i, u, v) for(int i = head[u], v = e[i].to; i; v = e[i = e[i].nxt].to)\n#define fi first\n#define se second\n#define all(s) s.begin(), s.end()\n#define sz(s) (int)(s.size())\n#define lb(s) ((s) & -(s))\n#define pb push_back\nusing namespace std;\n\ntypedef long long ll;\ntypedef unsigned long long u64;\ntypedef pair<int, int> P;\nmt19937_64 hua(time(0));\ntemplate<typename T> inline bool chkmx(T &x, T y) {return x < y ? x = y, 1 : 0;}\ntemplate<typename T> inline bool chkmn(T &x, T y) {return y < x ? x = y, 1 : 0;}\ntemplate<int T> using A = array<int, T>;\n\ninline ll read() {\n\tll x = 0, f = 1; char c = getchar();\n\tfor(; !isdigit(c); c = getchar()) if(c == '-')  f = 0;\n\tfor(; isdigit(c); c = getchar()) x = x * 10 + c - '0';\n\treturn f ? x : -x;\n}\nconst int maxn = 1e6;\nconst int maxk = 20;\nconst int mod = 998244353;\nconst int B = sqrt(mod) + 5;\nint n, k, q, N, pw[maxk + 5], w[maxn + 5], val[maxk + 5];\nint fac[maxk + 5], ifac[maxk + 5], inv[maxk + 5];\nint f[maxk + 5][maxn + 5], g[maxn + 5];\ninline int add(int a, int b) {return (a += b) >= mod ? a - mod : a;}\ninline int sub(int a, int b) {return (a -= b) < 0 ? a + mod : a;} \ninline int mul(int a, int b) {return 1ll * a * b % mod;}\ninline void upd(int &a, int b) {a = add(a, b);}\ninline int fpw(int a, int b) {\n\tint ans = 1;\n\tfor(; b; b >>= 1, a = mul(a, a)) if(b & 1) ans = mul(ans, a);\n\treturn ans;\n}\nstruct Mat {\n\tint a[maxk + 1][maxk + 1];\n\tint* operator [] (int x) {return a[x];}\n\tMat() {memset(a, 0, sizeof a);}\n\tfriend Mat operator * (Mat x, Mat y) {\n\t\tMat z;\n\t\trep(i, 0, k) rep(l, 0, k) rep(j, 0, k)  {\n\t\t\tupd(z[i][j], mul(x[i][l], y[l][j]));\n\t\t}\n\t\treturn z;\n\t}\n}mpw1[B + 5], mpw2[B + 5];\nvoid init() {\n\tfac[0] = fac[1] = inv[0] = inv[1] = ifac[0] = ifac[1] = 1;\n\trep(i, 2, maxk) fac[i] = mul(fac[i - 1], i);\n\trep(i, 2, maxk) inv[i] = mul(inv[mod % i], mod - mod / i);\n\trep(i, 2, maxk) ifac[i] = mul(ifac[i - 1], inv[i]); \n}\ninline int c(int n, int m) {return mul(fac[n], mul(ifac[m], ifac[n - m]));} \nint main() {\n// \tfreopen(\"in.txt\", \"r\", stdin);\n// \tfreopen(\"out.txt\", \"w\", stdout);\n\tn = read(), k = read(), q = read();\n\tN = fpw(n, k);\n\tinit();\n\tpw[0] = 1, val[0] = 1;\n\trep(i, 1, k) pw[i] = pw[i - 1] * n, val[i] = val[i - 1] * (n - 1);\n\trep(i, 0, k) val[i] = fpw(mul(c(k, i), val[i]), mod - 2);\n\trep(i, 0, N - 1) f[0][i] = w[i] = read();\n\trep(i, 0, k - 1) {\n\t\tper(j, k, 0) {\n\t\t\tmemset(g, 0, sizeof g);\n\t\t\tper(s, N - 1, 0) {\n\t\t\t\tupd(g[s / pw[i + 1] * pw[i + 1] + s % pw[i]], f[j][s]);\n\t\t\t}\n\t\t\trep(s, 0, N - 1) {\n\t\t\t\tf[j][s] = sub(g[s / pw[i + 1] * pw[i + 1] + s % pw[i]], f[j][s]);\n\t\t\t\tif(j) upd(f[j][s], f[j - 1][s]);\n\t\t\t}\n\t\t}\n\t}\n\tMat bs;\n\trep(i, 0, k) {\n\t\tbs[i][i] = mul(k - i, n - 2);\n\t\tmpw1[0][i][i] = mpw2[0][i][i] = 1;\n\t}\n\trep(i, 1, k) {\n\t\tbs[i][i - 1] = mul(i, n - 1);\n\t}\n\trep(i, 0, k - 1) {\n\t\tbs[i][i + 1] = k - i;\n\t}\n\trep(i, 1, B) {\n\t\tmpw1[i] = mpw1[i - 1] * bs;\n\t}\n\trep(i, 1, B) {\n\t\tmpw2[i] = mpw2[i - 1] * mpw1[B];\n\t}\n\tll lstans = 1;\n\trep(i, 1, q) {\n\t\tll a = read(), t = read() * lstans % mod;\n\t\tint x = t / B, y = t % B, ans = 0;\n\t\trep(i, 0, k) {\n\t\t\tint ret = 0;\n\t\t\trep(j, 0, k) {\n\t\t\t\tupd(ret, mul(mpw2[x][k][j], mpw1[y][j][i]));\n\t\t\t}\n\t\t\tupd(ans, mul(mul(ret, f[i][a]), val[k - i]));\n\t\t}\n\t\tcout << (lstans = ans) << '\\n';\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1646437059,
        "uid": 55650,
        "name": "flowerletter",
        "ccfLevel": 9,
        "title": "P6712 [THUPC2019] \u6446\u5bb6\u5177"
    }
]