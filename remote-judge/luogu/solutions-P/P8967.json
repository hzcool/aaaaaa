[
    {
        "content": "## \u9898\u89e3\r\n\r\n\u8003\u8651\u8bbe $f_i$ \u8868\u793a\uff0c\u4ece\u7b2c $i$ \u4e2a\u5730\u70b9\u51fa\u53d1\uff0c\u5230\u8fbe\u7ec8\u70b9\u7684\u671f\u671b\u6b65\u6570\u3002\u7279\u522b\u5730\uff0c\u8bb0 $f_0$ \u8868\u793a\u4ece\u8d77\u70b9 $(0,0,\\cdots,0)$ \u51fa\u53d1\u5230\u8fbe\u7ec8\u70b9\u7684\u671f\u671b\u6b65\u6570\u3002\u6bd4\u8f83\u663e\u7136\u7684\u601d\u8def\u662f\u8bbe\u6cd5\u7b97\u51fa $f_i$ \u4e4b\u95f4\u7684\u8868\u8fbe\u5f0f\u3002\r\n\r\n\u4ece\u4e00\u4e2a\u70b9\u51fa\u53d1\uff0c\u8d70\u8fc7\u4e86\u82e5\u5e72\u6b65\u540e\uff0c\u603b\u662f\u4f1a\u5230\u8fbe\u4ee5\u4e0b\u4e24\u4e2a\u60c5\u51b5\u4e4b\u4e00\uff1a\r\n\r\n- \u5931\u8db3\u4ece $k$ \u4e2a\u8d77\u70b9\u4e2d\u7684\u67d0\u4e00\u4e2a\u4ece\u5934\u6765\u8fc7\uff1b\r\n- \u987a\u5229\u5230\u8fbe\u7ec8\u70b9\u3002\r\n\r\n\u524d\u8005\u5f88\u4e0d\u5bb9\u6613\u8ba1\u7b97\uff0c\u56e0\u6b64\u8003\u8651\u5148\u7b97\u51fa\u7b2c\u4e8c\u79cd\u60c5\u51b5\u7684\u6982\u7387\uff0c\u518d\u56de\u6765\u7b97\u51fa\u7b2c\u4e00\u79cd\u60c5\u51b5\u3002\r\n\r\n\u4ece $(a_1,a_2,\\cdots,a_n)$ \u5230\u8fbe $(d_1,d_2,\\cdots,d_n)$ \u7684\u603b\u6b65\u6570\uff0c\u663e\u7136\u4e00\u5b9a\u662f $s=\\sum |d_i-a_i|$\u3002\u53d1\u751f\u7684\u6982\u7387\u662f\u591a\u5c11\u5462\uff1f\u9700\u8981\u6ce8\u610f\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\uff1a\r\n\r\n- \u5728\u524d\u8fdb\u7684\u65f6\u5019\u4e0d\u614e\u4ece\u5934\u5f00\u59cb\u4e86\uff1b\r\n- \u67d0\u4e00\u7ef4\u7684\u503c\u8d85\u8fc7\u4e86\u5bf9\u5e94\u7684 $d_i$\uff0c\u6b64\u65f6\u4e0d\u53ef\u80fd\u987a\u5229\u5230\u8fbe\u7ec8\u70b9\uff0c\u53ea\u6709\u53ef\u80fd\u4ece\u67d0\u4e2a\u5730\u65b9\u4ece\u5934\u6765\u8fc7\u3002\r\n\r\n\u524d\u8005\u9700\u8981\u4fdd\u8bc1\u5728 $s$ \u6b65\u5185\u90fd\u6ca1\u6709\u5931\u8db3\uff0c\u540e\u8005\u5219\u53ef\u4ee5\u8f6c\u5316\u4e3a\u4ece $s$ \u4e2a\u7403\u91cc\u53d6 $d_1-a_1$ \u4e2a\u7ea2\u7403\uff0c\u53d6 $d_2-a_2$ \u4e2a\u84dd\u7403\uff0c\u2026\u2026\uff0c\u8fd9\u6837\u7684\u7ec4\u5408\u95ee\u9898\u3002\u4e8e\u662f\u5f97\u5230\u6982\u7387\uff1a\r\n\r\n$$q=\\dfrac{s!}{(d_1-a_1)!(d_2-a_2)!\\cdots (d_n-a_n)!\\times n^s}\\times (1-p)^s$$\r\n\r\n\u7279\u522b\u5730\uff0c\u82e5\u5b58\u5728 $d_i<a_i$\uff0c\u5219 $q=0$\u3002\r\n\r\n\u5bf9\u4e8e $i=0,1,\\cdots,k$ \u90fd\u53ef\u4ee5\u8ba1\u7b97\u51fa\u5bf9\u5e94\u7684 $q_i$\u3002\u63a5\u4e0b\u6765\u8003\u8651\u5931\u8db3\u7684\u60c5\u51b5\u3002\r\n\r\n\u4f3c\u4e4e $f_i$ \u7684\u503c\u4f1a\u4e0e $f_j\\ (j=1,2,\\cdots,k)$ \u6709\u5173\u3002\u4f46\u662f\u6211\u4eec\u4e0d\u5e0c\u671b\u7528 $f_j\\ (j=1,2,\\cdots,k)$ \u5199\u5230 $f_i$ \u7684\u8868\u8fbe\u5f0f\u4e2d\uff0c\u8fd9\u4f1a\u53d8\u6210\u4e00\u4e2a $k$ \u9636\u7684\u7ebf\u6027\u65b9\u7a0b\u7ec4\uff0c\u7528\u6734\u7d20\u7684\u9ad8\u65af\u6d88\u5143\u65e0\u6cd5\u6c42\u89e3\u3002\u4f46\u662f\u6ce8\u610f\u5230\u4ece $f_i$ \u5931\u8db3\u6389\u8fdb\u67d0\u4e00\u4e2a $f_j$ \u4e2d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e0e $i$ \u65e0\u5173\u3002\u4e8e\u662f\u8003\u8651\u8bbe\u4e00\u4e2a\u4e2d\u95f4\u53d8\u91cf $g$ \u8868\u793a\u4ece\u4e00\u4e2a\u5931\u8db3\u8fc7\u7a0b\u5f00\u59cb\uff08\u8fd8\u6ca1\u6709\u51b3\u5b9a\u597d\u6389\u5230 $1\\sim k$ \u4e2d\u7684\u54ea\u4e2a\u4f4d\u7f6e\uff09\u9700\u8981\u7684\u671f\u671b\u6b65\u6570\u3002\r\n\r\n\u5bb9\u6613\u5f97\u5230 $g$ \u7684\u8868\u8fbe\u5f0f\uff1a\r\n\r\n$$g=\\sum_{i=1}^k \\dfrac{p_i}{p}f_i$$\r\n\r\n\u73b0\u5728\u7ee7\u7eed\u8ba1\u7b97 $f$ \u7684\u8868\u8fbe\u5f0f\uff1a\r\n\r\n$$f_i=q_is_i+(1-q_i)g+?$$\r\n\r\n\u5230\u8fd9\u4e00\u6b65\uff0c\u53d1\u73b0\u5f88\u96be\u8868\u793a\u51fa\u4ece\u8d77\u70b9\u51fa\u53d1\u4e00\u76f4\u5230\u5931\u8db3\u524d\u5230\u5e95\u8d70\u4e86\u591a\u5c11\u6b65\u3002\u8003\u8651\u4f7f\u7528\u5bb9\u65a5\uff0c\u5047\u8bbe\u538b\u6839\u6ca1\u6709\u7ec8\u70b9\u53ea\u662f\u5230\u5904\u4e71\u8d70\uff0c\u90a3\u4e48\u5728\u5931\u8db3\u524d\u7684\u671f\u671b\u6b65\u6570\u663e\u7136\u5c31\u662f $\\dfrac{1}{p}$\u3002\u73b0\u5728\u52a0\u4e0a\u4e86\u7ec8\u70b9\uff0c\u90a3\u4e48\u8d70\u5230\u7ec8\u70b9\u4e4b\u540e\u518d\u5931\u8db3\u8fd9\u4e00\u90e8\u5206\u7684\u671f\u671b\u6b65\u6570\u5c31\u6d88\u5931\u4e86\u3002\u8fd9\u4e00\u90e8\u5206\u7684\u671f\u671b\u5e94\u8be5\u662f $q_i\\times \\left(\\dfrac{1}{p}+s_i\\right)$\u3002\u6362\u8a00\u4e4b\uff0c\u95ee\u53f7\u90e8\u5206\u7684\u503c\u5e94\u8be5\u4e3a\uff1a\r\n\r\n$$\\frac{1}{p}-q_i\\times \\left(\\dfrac{1}{p}+s_i\\right)$$\r\n\r\n\u6574\u7406\u4e00\u4e0b $f$\uff1a\r\n\r\n$$f_i=(1-q_i)\\left(g+\\frac{1}{p}\\right)$$\r\n\r\n\u73b0\u5728\u8003\u8651\u89e3\u51fa $g$\u3002\u5c06 $f_i$ \u4ee3\u5165\u5230 $g$ \u7684\u8868\u8fbe\u5f0f\u91cc\uff1a\r\n\r\n$$g=\\sum_{i=1}^k \\dfrac{p_i}{p}\\times(1-q_i)\\left(g+\\frac{1}{p}\\right)$$\r\n\r\n\u5c06\u542b\u6709 $g$ \u7684\u9879\u5168\u90e8\u6574\u7406\u5230\u7b49\u53f7\u7684\u5de6\u4fa7\uff1a\r\n\r\n$$\\left(1+\\sum_{i=1}^k \\dfrac{p_i}{p}(q_i-1)\\right)g=\\sum_{i=1}^k\\dfrac{p_i}{p}\\times \\left(\\dfrac{1}{p}-\\dfrac{q_i}{p}\\right)$$\r\n\r\n\u5176\u4e2d $q_i,s_i,p_i$ \u90fd\u5f88\u5bb9\u6613\u8ba1\u7b97\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u6109\u5feb\u5730\u89e3\u51fa $g$ \u4e86\u3002\u5c06\u5176\u4ee3\u5165\u5230 $f$ \u7684\u8868\u8fbe\u5f0f\u91cc\uff0c\u5373\u53ef\u89e3\u51fa $f$ \u7684\u503c\u3002\r\n\r\n## \u53c2\u8003\u4ee3\u7801\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\n#define up(l, r, i) for(int i = l, END##i = r;i <= END##i;++ i)\r\n#define dn(r, l, i) for(int i = r, END##i = l;i >= END##i;-- i)\r\nusing namespace std;\r\ntypedef long long i64;\r\nconst int INF = 2147483647;\r\nconst int MOD = 998244353;\r\nint qread(){\r\n    int w=1,c,ret;\r\n    while((c = getchar()) >  '9' || c <  '0') w = (c == '-' ? -1 : 1); ret = c - '0';\r\n    while((c = getchar()) >= '0' && c <= '9') ret = ret * 10 + c - '0';\r\n    return ret * w;\r\n}\r\nint qpower(int x, int y){\r\n    int r = 1;\r\n    while(y){\r\n        if(y & 1) r = 1ll * r * x % MOD;\r\n        x = 1ll * x * x % MOD, y >>= 1;\r\n    }\r\n    return r;\r\n}\r\nconst int MAXT = 1e7 + 3;\r\nconst int MAXN = 1e2 + 3;\r\nconst int MAXK = 1e4 + 3;\r\nint o = 1e7, n, k, p, g;\r\nint D[MAXN], S[MAXK], Q[MAXK], P[MAXK], F[MAXK];\r\nint M[MAXT], N[MAXT], X[MAXT], Y[MAXT], A[MAXK][MAXN];\r\nint main(){\r\n    n = qread(), k = qread();\r\n    M[0] = 1, N[0] = 1, X[0] = 1;\r\n    up(1, o, i) M[i] = 1ll * M[i - 1] *   i  % MOD;\r\n    up(1, o, i) X[i] = 1ll * X[i - 1] * M[i] % MOD;\r\n    Y[o] = qpower(X[o], MOD - 2);\r\n    dn(o, 1, i) Y[i - 1] = 1ll * Y[i] * M[i    ] % MOD;\r\n    up(1, o, i) N[i]     = 1ll * Y[i] * X[i - 1] % MOD;\r\n    up(1, n, i) D[i] = qread();\r\n    up(1, k, i){\r\n        up(1, n, j) A[i][j] = qread(); P[i] = qread();\r\n        P[i] = 1ll * P[i] * qpower(1e8, MOD - 2) % MOD;\r\n        p = (p + P[i]) % MOD;\r\n    }\r\n    up(0, k, i){\r\n        bool f = 0;\r\n        up(1, n, j) if(D[j] < A[i][j]) f = true;\r\n        up(1, n, j) S[i] += D[j] - A[i][j];\r\n        if(f == true) Q[i] = 0; else {\r\n            Q[i] = 1ll * M[S[i]]\r\n                * qpower(qpower(n, S[i]), MOD - 2) % MOD \r\n                * qpower(1 - p + MOD, S[i]) % MOD;\r\n            up(1, n, j) Q[i] = 1ll * Q[i] * N[D[j] - A[i][j]] % MOD;\r\n        }\r\n    }\r\n    int u = 0, v = 1, np = qpower(p, MOD - 2);\r\n    up(1, k, i)\r\n        u = (u + 1ll * P[i] * np % MOD * (np - 1ll * Q[i] * qpower(p, MOD - 2) % MOD + MOD) % MOD) % MOD;\r\n    up(1, k, i)\r\n        v = (v + 1ll * P[i] * np % MOD * (Q[i] - 1 + MOD) % MOD) % MOD;\r\n    g = 1ll * u * qpower(v, MOD - 2) % MOD;\r\n    up(0, k, i)\r\n        F[i] = (1ll * (1 - Q[i] + MOD) * g % MOD + np - 1ll * Q[i] * qpower(p, MOD - 2) % MOD + MOD) % MOD;\r\n    printf(\"%d\\n\", F[0]);\r\n    return 0;\r\n}\r\n```",
        "postTime": 1674639368,
        "uid": 68344,
        "name": "\u79bb\u6563\u5c0f\u6ce2\u53d8\u6362\u00b0",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P8967 \u3010\u8ffd\u5bfb | Pursuit of Dream\u3011"
    },
    {
        "content": "\u611f\u8c22 E_space \u8001\u5e08\u7684\u8bb2\u89e3\uff01\n\n### Subtask 1\n\n\u9996\u5148\u8003\u8651 $n=1,k=1$ \u7684\u60c5\u51b5\uff0c\u8bbe $f$ \u8868\u793a\u4f20\u9001\u70b9\u5230\u7ec8\u70b9\u7684\u671f\u671b\u3002\n\n\u8003\u8651\u679a\u4e3e\u8fde\u8d70 $1\\sim d-a$\u6b65\u3002\n\u5982\u679c\u662f\u8fde\u8d70 $i$ \u6b65\u88ab\u8c03\u56de\uff0c\u5219\u671f\u671b\u5e94\u8be5\u662f $(1-p)^{i-1}p(i+s)$\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u5f97\u5230\u65b9\u7a0b:\n\n$$f=(1-p)^{d-a}(d-a)+\\sum_{k=1}^{d-a}(1-p)^{k-1}p(k+s)$$\n\n\u7136\u540e\u8003\u8651\u8ba1\u7b97\u7b54\u6848\uff1a\n\n$$ans=(1-p)^dd+\\sum_{k=1}^d(1-p)^{k-1}p(k+s)$$\n\n\u53ef\u4ee5\u901a\u8fc7\u6d88\u5143\u89e3\u51b3\u3002\n\n### Subtask 3\n\n\n\u73b0\u5728\u7c7b\u6bd4Subtask 1\uff0c\u4ecd\u7136\u8bbe $f$ \u4e3a\u4f20\u9001\u70b9\u5230\u7ec8\u70b9\u7684\u7b54\u6848\u3002\n\n\u8fd9\u65f6\u5019\u5982\u679c\u8981\u5957\u7528Subtask 1\u7684\u5f0f\u5b50\u662f\u4e0d\u73b0\u5b9e\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u5728Subtask 1\u4e2d\u6700\u540e\u76f4\u63a5\u8d70 $d-a$ \u6b65\u7684\u5f0f\u5b50\u8981\u6362\u3002(\u4e0d\u4e00\u5b9a\u80fd\u8d70\u5230\u7ec8\u70b9)\n\n\u8bbe $d=\\sum_{k=1}^nd_i-a_i$\uff0c\u4e5f\u5373\u8d70 $d$ \u6b65\u5230\u7ec8\u70b9\u3002\n\n\u4f46\u8fd9\u5e76\u4e0d\u4e00\u5b9a\u5230\u5f97\u4e86\u7ec8\u70b9\u3002\u60f3\u60f3\uff0c\u5728\u7b2c $k$ \u7ef4\uff0c\u8981\u4ece $d$ \u6b65\u91cc\u9762\u9009\u51fa $k$ \u6b65\uff0c\u5e76\u4e14\u8981\u9009\u4e2d\u7b2c $k$ \u7ef4\uff0c\u8fd9\u4e2a\u65b9\u6848\u6570\u662f $\\frac{A_{k}^d}{n}=\\frac{d!}{(d_k-a_k)!n}$\uff0c\u7136\u540e\u6211\u4eec\u8fd8\u8981\u9009\u62e9\u5176\u4ed6\u51e0\u7ef4\uff0c\u8fd9\u7b49\u4ef7\u4e8e\u4ece$d$\u4e2a\u7403\u91cc\u9762\u9009\u51fa$d_1-a_1,d_2-a_2\u2026\u2026$\u5206\u522b\u67d3\u8272\uff0c\u7b49\u4ef7\u4e8e\u4e00\u4e2a\u591a\u9879\u5f0f\u7cfb\u6570\uff1a\n\n$${d\\choose {d_1-a_1,d_2-a_2\u2026d_n-a_n} }\\frac {1}{n^d}=\\frac{d!}{n^d\\prod _{i=1}^n(d_i-a_i)!}$$\n\n\u6240\u4ee5\u8bbe $s$ \u8868\u793a\u8fde\u8d70 $d$ \u6b65(\u4e0d\u88ab\u4f20\u9001)\u5230\u7ec8\u70b9\u7684\u6982\u7387\uff0c\u5219:\n\n$$s=\\frac{d!}{n^d\\prod_{k=1}^n(d_i-a_i)!}$$\n\n\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u6837\u8d70\u51fa\u53bb\u4e86(\u6ca1\u5230\u7ec8\u70b9\uff0c\u51fa\u754c\u4e86\uff0c\u6982\u7387\u662f $1-s$ )\uff0c\u8fd8\u9700\u8981\u82b1\u8d39\u671f\u671b $\\frac{1}{p}$ \u6b65\u8d70\u56de\u4f20\u9001\u70b9\u3002\n\n\u6240\u4ee5\u4ece\u8d77\u70b9\u5230\u7ec8\u70b9\u7b2c $1\\sim d$ \u6b65\u4e0d\u4f20\u9001\u7684\u671f\u671b\u662f $\\left(1-p)^d(d+(1-s)\\left(\\frac{1}{p}+f\\right)\\right)$\u3002\n\n\u540e\u534a\u90e8\u5206\u7167\u642c\uff08\u6ca1\u95ee\u9898\uff09\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$f=(1-p)^d\\left(d+\\left(1-s\\right)\\left(\\frac{1}{p}+f\\right)\\right)+\\sum_{k=1}^d(1-p)^{k-1}p(k+f)$$\n\n\u7c7b\u4f3c\u5730\uff0c\u6211\u4eec\u8bbe $D=\\sum_{k=1}^nd_i$\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$ans=(1-p)^D\\left(D+(1-s)\\left(\\frac{1}{p}+f\\right)\\right)+\\sum_{k=1}^D(1-p)^{k-1}p(k+f)$$\n\n### Subtask 5\n\nSubtask 4\u5c31\u662f\u786c\u4e0a\u9ad8\u65af\u6d88\u5143\u5c31\u662f\n\n\u8003\u8651\u5bf9 Subtask 3 \u7684\u505a\u6cd5\u8fdb\u884c\u6269\u5c55\u3002\n\n\u8bbe $f_i$ \u8868\u793a\u7b2c $i$ \u4e2a\u4f20\u9001\u70b9\u5230\u7ec8\u70b9\u7684\u6b65\u6570\u671f\u671b\u3002$s_i$ \u8868\u793a\u7b2c $i$ \u4e2a\u4f20\u9001\u70b9\u4e00\u76f4\u76f4\u8d70\u5230\u7ec8\u70b9\u7684\u6982\u7387\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u5904\u7406\uff0c\u6211\u4eec\u5c06\u8d77\u70b9\u8bbe\u4e3a\u7b2c $0$ \u4e2a\u4f20\u9001\u70b9\uff0c$p_0=0$\u3002\n\n\u9700\u8981\u5206\u7c7b\u8ba8\u8bba\uff1a\u8bbe$D_j=\\sum_{i=1}^nd_i-a_{j,i}$\u3002\n\n1. $\\forall i\\in[1,n],a_{j,i}\\le d_i$\u3002\n\n>\u7c7b\u6bd4Subtask 3 \u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a\n>\n>$$s_j=\\frac{D_j!}{n^{D_j}\\prod_{i=1}^n(d_i-a_{j,i})!}$$\n>\n>\u63a5\u7740\uff0c\u540c\u6837\u7c7b\u6bd4\u8ba1\u7b97 $f$\uff0c\u53ea\u662f\u6bcf\u4e00\u6b65\u9700\u8981\u8ba1\u7b97\u8df3\u5230\u5176\u4ed6\u4f20\u9001\u70b9\u7684\u6b65\u6570\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a\n>\n>$$f_j=\\sum_{i=1}^{D_j}(1-p)^{i-1}\\left(\\sum_{q=1}^kp_q(i+f_q)\\right)+(1-p)^{D_j}\\left(D_j+(1-s_j)S\\right)$$\n>\n>$S$ \u662f\u6307\u4e00\u4e2a\u76f4\u8d70\u4e0d\u53ef\u5230\u8fbe\u7ec8\u70b9\u7684\u70b9\u5230\u7ec8\u70b9\u7684\u671f\u671b\u6b65\u6570\uff0c\u663e\u7136 $S=1+(1-p)S+\\sum_{i=1}^kp_if_i$\u3002\n\n2. $\\exists i\\in[1,n],a_{j,i}>d_i$\u3002\n\n>\u7b49\u4ef7\u4e8e $S$\uff0c\u4e5f\u5373 $f_j=S$\uff0c\u9700\u8981\u6ce8\u610f $s_j=0$\u3002\n\n\n\u9ad8\u65af\u6d88\u5143\u5373\u53ef\u3002\n### Subtask 6\n\n\u4e0a\u6b63\u89e3\uff01\n\n\u56de\u5fc6\u8d77\u5f0f\u5b50\uff1a\n\n$$D_j=\\sum_{i=1}^nd_i-a_{j,i}$$\n\n$$s_j=\\frac{D_j!}{n^{D_j}\\prod_{i=1}^n(d_i-a_{j,i})!}$$\n\n$$f_j=\\sum_{i=1}^{D_j}(1-p)^{i-1}\\left(\\sum_{q=1}^kp_q(i+f_q)\\right)+(1-p)^{D_j}\\left(D_j+(1-s_j)S\\right)$$\n\n$$S=1+(1-p)S+\\sum_{i=1}^kp_if_i\\implies S=\\frac{1+\\sum_{i=1}^kp_if_i}{p}$$\n\n\u8bbe $g=\\frac{\\sum_{i=1}^kp_if_i}{p},S=\\frac{1}{p}+g$\u3002\n\n\u8003\u8651\u628a $f$ \u7684\u8ba1\u7b97\u5f0f\u62c6\u5f00\uff1a\n\n$$f_j=\\sum_{i=1}^{D_j}(1-p)^{i-1}\\left(\\sum_{q=1}^kp_q(i+f_q)\\right)+(1-p)^{D_j}\\left(D_j+(1-s_j)S\\right)$$\n\n$$=\\sum_{i=1}^{D_j}(1-p)^{i-1}p(i+g)+(1-p)^{D_j}\\left(D_j+(1-s_j)S\\right)$$\n\n\u524d\u534a\u90e8\u5206\uff1a\n\n$$\\sum_{i=1}^{D_j}(1-p)^{i-1}(pi+pg)=pg\\sum_{i=0}^{D_j-1}(1-p)^{i}+p\\sum_{i=1}^{D_j}i(1-p)^{i-1}$$\n\n\u8fd0\u7528\u88c2\u9879\u76f8\u6d88\u6cd5\u53ef\u4ee5\u5f97\u5230\u5176\u7b49\u4ef7\u4e8e\uff1a\n\n$$g(1-(1-p)^{D_j})+\\frac{1-(1-p)^{D_j}}{p}-D_j(1-p)^{D_j}$$\n\n\u7136\u540e\u770b\u540e\u534a\u90e8\u5206:\n\n\u62c6\u5f00\u5f0f\u5b50\u5f97\u5230\uff1a\n\n$$(1-p)^{D_j}\\left(D_j+(1-s_j)S\\right)=D_j(1-p)^{D_j}+S(1-p)^{D_j}(1-s_j)$$\n\n\u5408\u5e76\u5f97\u5230\u5176\u7b49\u4ef7\u4e8e\uff1a\n\n$$f_j=g(1-(1-p)^{D_j})+\\frac{1-(1-p)^{D_j}}{p}+S(1-p)^{D_j}(1-s_j)$$\n\n$$=g(1-(1-p)^{D_j})+\\frac{1-(1-p)^{D_j}}{p}+(\\frac{1}{p}+g)(1-p)^{D_j}(1-s_j)$$\n\n$$=\\frac{1-s_j(1-p)^{D_j}}{p}+g(1-s_j(1-p)^{D_j})$$\n\n\u6240\u4ee5\u8fdb\u4e00\u6b65\u5730\u62c6\u5f00 $g$ \u5e76\u5e26\u5165\uff1a\n\n$$g=\\frac{\\sum_{i=1}^kp_if_i}{p}=\\frac{\\sum_{i=1}^kp_i\\left(\\frac{1-s_i(1-p)^{D_i}}{p}+g(1-s_i(1-p)^{D_i})\\right)}{p}$$\n\n\u8bbe $h_i=s_ip_i(1-p)^{D_i},H=\\sum_{i=1}^kh_i$\uff0c\u5219\u53ef\u4ee5\u5f97\u5230\n\n$$pg=\\sum_{i=1}^k\\left(\\frac{p_i-h_i}{p}+p_ig-gh_i\\right)$$\n\n\u5206\u5f00\u6c42\u548c\u5373\u5f97\uff1a\n\n$$pg=1-\\frac{H}{p}+pg-gH\\implies g=\\frac{1-\\frac{H}{p}}{H}=\\frac{1}{H}-\\frac{1}{p},S=\\frac{1}{H}$$\n\n\u6240\u4ee5\u5e26\u5165 $f_0$\uff1a\u8bbe $w=1-s_0(1-p)^{D_0}$\u3002\n\n$$f_0=\\frac{w}{p}+(\\frac{1}{H}-\\frac{1}{p})w=\\frac{w}{H}$$\n\n\u4e00\u4e9b\u7ec6\u8282\uff1a\n\n1. $\\forall i\\in[1,k],s_i=[\\forall j\\in[1,n],a_{i,j}\\le d_j]s_i$\u3002\n2. $D_i=[D_i>0]$\u3002\n3. \u8bb0\u5f97\u53d6\u6a21\uff0c\u9632\u7206\u8d1f\u6570\uff0c\u9636\u4e58\u9006\u5143\u7528\u9012\u63a8\u641e\u3002\n\nCode:\n\n```cpp\n#include<iostream>\n#include<cmath>\nusing namespace std;\n#define mod 998244353\n#define int long long\nint power(int a,int b){\n\tint ans=1;\n\twhile(b){\n\t\tif(b&1)ans=ans*a%mod;\n\t\ta=a*a%mod;\n\t\tb>>=1; \n\t}\n\treturn ans;\n} \n#define N 150\n#define M 10500\nint s[M],p[M],mx,P,Inv,D[M],h[M],n,m,H,k,d[M],a[M][N],jc[10000050],inv[10000050];\nvoid init(){\n\tcin>>n>>k;\n\tInv=power(100000000,mod-2);\n\tfor(int i=1;i<=n;i++)cin>>d[i];\n\tfor(int i=1;i<=k;i++){\n\t\tfor(int j=1;j<=n;j++)cin>>a[i][j];\n\t\tint x;cin>>x;p[i]=x*Inv%mod;\n\t\tP=(P+p[i])%mod;\n\t}\n\tfor(int i=0;i<=k;i++){\n\t\tfor(int j=1;j<=n;j++)D[i]+=d[j]-a[i][j];\n\t\tD[i]=max(0ll,D[i]);\n\t\tmx=max(mx,D[i]);\n\t}\n\tjc[0]=inv[0]=1;\n\tjc[1]=inv[1]=1;\n\tfor(int i=2;i<=mx;i++) {\n\t\tjc[i]=1ll*jc[i-1]*i%mod;\n\t\tinv[i]=mod-(1ll*mod/(1ll*i)*1ll*inv[mod%i]%mod)%mod;\n\t}\n\tfor(int i=2;i<=mx;i++) {\n\t\tinv[i]=1ll*inv[i-1]*inv[i]%mod;\n\t}\n\tfor(int i=0;i<=k;i++){\n\t\ts[i]=jc[D[i]];\n\t\ts[i]=s[i]*power(power(n,D[i]),mod-2)%mod;\n\t\tfor(int j=1;j<=n;j++){\n\t\t\ts[i]=s[i]*inv[max(0ll,d[j]-a[i][j])]%mod;\n\t\t\tif(d[j]<a[i][j])s[i]=0;\n\t\t}\n\t}\n\tfor(int i=0;i<=k;i++){\n\t\th[i]=s[i]*p[i]%mod;\n\t\th[i]=h[i]*power(mod+1-P,D[i])%mod;\n\t\tH=(H+h[i])%mod;\n\t}\n\tint w=1-s[0]*power(mod+1-P,D[0])%mod;\n\tw=(w%mod+mod)%mod;\n\tint ans=w*power(H,mod-2)%mod;\n\tcout<<ans<<endl;\n}\nsigned main(){\n\tios::sync_with_stdio(false);\n\tinit();\n\treturn 0;\n}\n```",
        "postTime": 1674617789,
        "uid": 507718,
        "name": "weakpyt",
        "ccfLevel": 5,
        "title": "P8967\u3000\u9898\u89e3"
    }
]