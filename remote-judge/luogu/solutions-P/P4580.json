[
    {
        "content": "\u4e00\u9053DP\u88f8\u9898\u3002 \n\u9996\u5148\u6211\u4eec\u5b9a\u4e49\u72b6\u6001`f[i][j][k][0/1/2][0/1]` \u6765\u8868\u793a\uff0c\u7b2ci\u4e2a\u8282\u70b9\uff0c\u957f\u5ea6\u4e3aj,\u6709k\u4e2a\u672a\u5339\u914d\u7684\u5de6\u62ec\u53f7\uff0c\u73b0\u5728\u4e0b\u4e00\u4e2a\u4e0d\u80fd\u52a0\u6570\u5b57(0) /\u4e0b\u4e00\u4e2a\u53ef\u4ee5\u52a0\u4e00\u4e2a\u6570\u5b57\u7684\u5f00\u59cb(1) / \u4e0b\u4e00\u4e2a\u53ef\u4ee5\u52a0\u6570\u5b57\u7684\u5176\u4ed6\u4f4d\u6570(2),\u4e0b\u4e00\u4e2a\u662f\u5426\u53ef\u4ee5\u52a0\u7b26\u53f7(0/1)\u3002 \\\n\u8f6c\u79fb\u975e\u5e38\u663e\u7136\uff1a \n* \u6570\u5b57\u5982\u679c\u662f\u4ee50\u5f00\u59cb\uff0c\u540e\u9762\u4e0d\u80fd\u52a0\u6570\u5b57\uff0c\u4f46\u662f\u53ef\u4ee5\u52a0\u7b26\u53f7\uff0c\u5982\u679c\u662f\u4ee5\u5176\u4ed6\u5f00\u59cb\uff0c\u540e\u9762\u65e2\u53ef\u4ee5\u52a0\u6570\u5b57\u4e5f\u53ef\u4ee5\u52a0\u7b26\u53f7\u3002\n* \u7b26\u53f7\u540e\u9762\u65e2\u53ef\u4ee5\u52a0\u6570\u5b57\uff0c\u4e5f\u53ef\u4ee5\u52a0\u5de6\u62ec\u53f7\n* \u5de6\u62ec\u53f7\u540e\u9762\u65e2\u53ef\u4ee5\u52a0\u5de6\u62ec\u53f7\uff0c\u4e5f\u53ef\u4ee5\u52a0\u6570\u5b57\n* \u53f3\u62ec\u53f7\u540e\u9762\u53ea\u80fd\u52a0\u7b26\u53f7\n* \u8d1f\u53f7\u53ea\u80fd\u5728\u5b57\u7b26\u4e32\u6700\u5f00\u59cb\u6216\u8005\u7d27\u63a5\u7740\u5de6\u62ec\u53f7\u653e\n\n\u7528\u4e0a\u9762\u51e0\u4e2a\u6761\u4ef6\u6765\u8f6c\u79fb\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn = 35,p=1000000007;\nint inc(int a,int b) {\n\ta+=b;\n\treturn a>=p?a-p:a;\n}\nint dec(int a,int b) {\n\ta-=b;\n\treturn a<0?a+p:a;\n}\nint mul(int a,int b) {\n\treturn 1ll*a*b%p;\n}\nint qpow(int a,int b) {\n\tint ret=1;\n\twhile(b) {\n\t\tif(b&1) ret=mul(ret,a);\n\t\ta=mul(a,a);\n\t\tb>>=1;\n\t}\n\treturn ret;\n}\nint f[maxn][maxn][maxn][3][2];// ver u len k with j ( and ends with num 0/1 and opt 0/1\nint n,m,k;\nchar S[maxn];\nvector<int> E[maxn];\nbool isd(char ch) {\n\treturn ch >='0'&&ch<='9';\n}\nbool isopt(char ch) {\n\treturn ch == '-' || ch == '+' || ch=='*' || ch =='/' ;\n}\nint main() {\n\tscanf(\"%d%d%d\",&n,&m,&k);\n\tscanf(\"%s\",S+1);\n\tfor(int i=1;i<=m;++i) {\n\t\tint u,v;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tE[u].push_back(v);\n\t\tE[v].push_back(u);\n\t}\n\tfor(int i=1;i<=n;++i) {\n\t\tif(isd(S[i]) ) {\n\t\t\tif(S[i] != '0')\n\t\t\t\tf[i][1][0][2][1] = 1;\n\t\t\telse f[i][1][0][0][1] = 1;\n\t\t}\n\t\telse if(S[i] == '(') f[i][1][1][1][0] = 1;\n\t\telse if(S[i] == '-') {\n\t\t\tf[i][1][0][1][0] = 1;\n\t\t}\n\t}\n\tfor(int j = 1;j<=k;++j) {\n\t\tfor(int u=1;u<=n;++u) {\n\t\t\tfor(int c = 0;c<=k;++c) {\n\t\t\t\tfor(auto nx : E[u]) {\n\t\t\t\t\tint k = j;\n\t\t\t\t\tif(isd(S[nx]) ) {\n\t\t\t\t\t\tif(S[nx] != '0') {\n\t\t\t\t\t\t\tf[nx][k+1][c][2][1] = inc(f[nx][k+1][c][2][1],f[u][k][c][1][1]);\n\t\t\t\t\t\t\tf[nx][k+1][c][2][1] = inc(f[nx][k+1][c][2][1],f[u][k][c][1][0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tf[nx][k+1][c][2][1] = inc(f[nx][k+1][c][2][1],f[u][k][c][2][1]);\n\t\t\t\t\t\tf[nx][k+1][c][2][1] = inc(f[nx][k+1][c][2][1],f[u][k][c][2][0]);\n\t\t\t\t\t\tif(S[nx] == '0') {\n\t\t\t\t\t\t\tf[nx][k+1][c][0][1] = inc(f[nx][k+1][c][0][1],f[u][k][c][1][1]);\n\t\t\t\t\t\t\tf[nx][k+1][c][0][1] = inc(f[nx][k+1][c][0][1],f[u][k][c][1][0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if(isopt(S[nx])) {\n\t\t\t\t\t\tf[nx][k+1][c][1][0] = inc(f[nx][k+1][c][1][0],f[u][k][c][0][1]);\n\t\t\t\t\t\tf[nx][k+1][c][1][0] = inc(f[nx][k+1][c][1][0],f[u][k][c][1][1]);\n\t\t\t\t\t\tf[nx][k+1][c][1][0] = inc(f[nx][k+1][c][1][0],f[u][k][c][2][1]);\n\t\t\t\t\t\tif(S[nx] == '-') {\n\t\t\t\t\t\t\tif(S[u] == '(') {\n\t\t\t\t\t\t\t\tf[nx][k+1][c][1][0] = inc(f[nx][k+1][c][1][0],f[u][k][c][1][0]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if(S[nx] == '(') {\n\t\t\t\t\t\tf[nx][k+1][c+1][1][0] = inc(f[nx][k+1][c+1][1][0],f[u][k][c][1][0]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tassert(S[nx] == ')');\n\t\t\t\t\t\tif(c > 0 ) {\n\t\t\t\t\t\t\tf[nx][k+1][c-1][0][1] =inc(f[nx][k+1][c-1][0][1],f[u][k][c][2][1]);\n\t\t\t\t\t\t\tf[nx][k+1][c-1][0][1] =inc(f[nx][k+1][c-1][0][1],f[u][k][c][0][1]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tint ans = 0;\n\tfor(int i=1;i<=n;++i) {\n\t\tans = inc(ans,f[i][k][0][0][1]);\n\t\tans = inc(ans,f[i][k][0][1][1]);\n\t\tans = inc(ans,f[i][k][0][2][1]);\n\t}\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n\n```",
        "postTime": 1591753305,
        "uid": 64618,
        "name": "\u6587\u6587\u6bbf\u4e0b",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4580 \u3010[BJOI2014]\u8def\u5f84\u3011"
    },
    {
        "content": "## \u524d\u8a00\n\u4e00\u9053\u597d\u73a9\u7684 dp \u9898\uff0c\u672c\u849f\u84bb\u5728\u4e00\u4e2a\u6570\u7ec4\u4e0a\u88ab\u5361\u4e86 3 \u5929T_T\u3002\n## \u6b63\u9898\n\u8003\u8651 dp \u72b6\u6001\uff1a$dp_{u,j,k,l}$ \u8868\u793a\u5f53\u524d\u8282\u70b9 $u$\uff0c\u5df2\u7ecf\u8d70\u4e86 $j$ \u6b65\uff0c\u6709 $k$ \u4e2a\u5de6\u62ec\u53f7\u672a\u5339\u914d\uff0c$l$ \u8868\u793a\u5982\u679c\u5f53\u524d\u662f\u6570\u5b57\uff0c\u6709\u6ca1\u6709\u524d\u5bfc 0\u3002\n\n\u8fd9\u9053\u9898\u7528\u9012\u63a8\u6bd4\u8f83\u96be\u61c2\uff0c\u6240\u4ee5\u6211\u4eec\u7528\u8bb0\u5fc6\u5316\u641c\u7d22\u5927\u6cd5\uff0c\u662f\u8fd9\u6837\u8f6c\u79fb\u7684\uff1a\n\n\u8bbe\u5f53\u524d\u70b9\u4e3a $u$\uff0c\u63a5\u4e0b\u6765\u8981\u8d70\u7684\u8282\u70b9\u4e3a $v$\u3002\n\n- \u5f53 $v$ \u662f\u6570\u5b57\uff1a\n\n1. \u5982\u679c $u$ \u4e5f\u662f\u6570\u5b57\uff0c\u4e14\u6ca1\u6709\u524d\u5bfc\u96f6\uff0c\u5219 $ans$ \u52a0\u4e0a $dp_{u,j+1,k,0}$\u3002\n1. \u5982\u679c $u$ \u662f\u5de6\u62ec\u53f7\u6216\u8fd0\u7b97\u7b26\uff0c\u5b9a\u4e49 $f$ \u7b49\u4e8e $v$ \u662f\u5426\u4e3a $0$\uff0c\u5219 $ans$ \u52a0\u4e0a $dp_{v,j+1,k,f}$\u3002\n\n- \u5f53 $v$ \u662f\u5de6\u62ec\u53f7\uff1a\n\n  \u5982\u679c $u$ \u662f\u8fd0\u7b97\u7b26\u6216\u5de6\u62ec\u53f7\uff0c\u5219 $ans$ \u52a0\u4e0a $dp_{v,j+1,k+1,0}$\u3002\n\n- \u5f53 $v$ \u662f\u53f3\u62ec\u53f7\uff1a\n\n  \u5982\u679c $u$ \u662f\u6570\u5b57\u6216\u53f3\u62ec\u53f7\u5e76\u4e14 $k>0$\uff0c\u5219 $ans$ \u52a0\u4e0a $dp_{v,j+1,k-1,0}$\u3002\n\n- \u5f53 $v$ \u662f\u8fd0\u7b97\u7b26\uff1a\n\n1. \u5982\u679c $u$ \u662f\u6570\u5b57\u6216\u53f3\u62ec\u53f7\uff0c\u5219 $ans$ \u52a0\u4e0a $dp_{v,j+1,k,0}$\u3002\n1. \u7279\u6b8a\u60c5\u51b5\uff0c\u5982\u679c $v$ \u662f\u51cf\u53f7\uff08\u8d1f\u53f7\uff09\u5e76\u4e14 $u$ \u662f\u5de6\u62ec\u53f7\uff0c$ans$ \u8fd8\u662f\u52a0\u4e0a $dp_{v,j+1,k,0}$\u3002\n\n\u6700\u540e\u628a $dp_{u,j,k,l}$ \u8d4b\u503c\u4e3a $ans$\u3002\n\n\u6700\u7ec8\u7b54\u6848\uff1a\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u70b9 $i$\uff0c\u4ee5\u5b83\u4eec\u4f5c\u4e3a\u8d77\u70b9\u7684\u7b54\u6848\u4e4b\u548c\u3002\n\n\u8fd9\u4e9b\u70b9\u5206\u522b\u6709\u4ee5\u4e0b 3 \u79cd\u60c5\u51b5\uff1a\n\n1. $i$ \u4e3a\u5de6\u62ec\u53f7\uff0c\u7b54\u6848\u52a0\u4e0a $dp_{i,1,1,0}$\u3002\n1. $i$ \u4e3a\u6570\u5b57\uff0c\u7b54\u6848\u52a0\u4e0a $dp_{i,1,0,f}$\uff0c$f$ \u8fd8\u662f\u8001\u6837\u5b50\u3002\n1. $i$ \u4e3a\u51cf\u53f7\uff0c\u7b54\u6848\u52a0\u4e0a $dp_{i,1,0,0}$\u3002\n\n\u5176\u4ed6\u7ec6\u8282\uff1a\n- \u6bcf\u6b21\u52a0\u5b8c\u8981\u5bf9 $10^9+7$ \u53d6\u6a21\n- dp \u6570\u7ec4\u8981\u5f00\u5927\u4e00\u70b9\uff0c\u628a\u63e1\u4e0d\u4f4f\u5c31\u5f00\u5230 $40$\u3002\n- \u5c0f\u6570\u636e\u91c7\u7528\u90bb\u63a5\u77e9\u9635\u66f4\u65b9\u4fbf\u3002\n- \u4e00\u5b9a\u8981\u6ce8\u610f\u6bcf\u4e2a\u7ec6\u8282\uff0c\u7279\u522b\u662f\u5728\u641c\u7d22\u65f6\uff0c\u5199\u9519\u4e00\u4e2a\u5c31\u4f1aBBQ\u3002\n\n\u6700\u540e\u8d34\u4e0a\u6211\u7684\u4ee3\u7801\uff1a\n```cpp\n#include <iostream>\nusing namespace std;\nconst int mod = 1000000007;\nint n, m, k;\nlong long dp[25][35][35][2];//\u4e2a\u4eba\u4e60\u60ef\uff0c\u5f00\u4e86\u4e2along long\uff0c\u4e0d\u5f00\u4e5f\u5e94\u8be5\u80fd\u8fc7\nint g[25][25];\nchar s[40];\nbool isnum(char c) {\n\treturn '0' <= c && c <= '9';\n}//\u5224\u65ad\u662f\u5426\u4e3a\u6570\u5b57\nbool isop(char c) {\n\treturn c == '+' || c == '-' || c == '*' || c == '/';\n}//\u5224\u65ad\u662f\u5426\u4e3a\u8fd0\u7b97\u7b26\nlong long dfs(int u, int step, int l, int hz) {//\u5173\u952e\uff1a\u8bb0\u5fc6\u5316\u641c\u7d22\n\tif (dp[u][step][l][hz] >= 0)\n\t\treturn dp[u][step][l][hz];\n\tlong long ans = 0;\n\tif (step == k) {\n\t\tif (!l && !isop(s[u]))\n\t\t\treturn dp[u][step][l][hz] = 1;\n\t\telse\n\t\t\treturn dp[u][step][l][hz] = 0;\n\t}\n\tfor (int i = 0; i < n; i++)\n\t\tif (g[u][i]) {\n\t\t\tif (isnum(s[i])) {\n\t\t\t\tif (isnum(s[u]) && !hz)\n\t\t\t\t\tans = (ans + dfs(i, step + 1, l, 0)) % mod;\n\t\t\t\telse if (isop(s[u]) || s[u] == '(')\n\t\t\t\t\tans = (ans + dfs(i, step + 1, l, s[i] == '0')) % mod;\n\t\t\t} else if (s[i] == '(') {\n\t\t\t\tif (isop(s[u]) || s[u] == '(')\n\t\t\t\t\tans = (ans + dfs(i, step + 1, l + 1, 0)) % mod;\n\t\t\t} else if (s[i] == ')') {\n\t\t\t\tif (l > 0 && (isnum(s[u]) || s[u] == ')'))\n\t\t\t\t\tans = (ans + dfs(i, step + 1, l - 1, 0)) % mod;\n\t\t\t} else if (isop(s[i])) {\n                if(isnum(s[u]))\n\t\t\t\t\tans = (ans + dfs(i, step + 1, l, 0)) % mod;\n                if(s[u] == ')' || (s[u] == '(' && s[i] == '-'))\n\t\t\t\t\tans = (ans + dfs(i, step + 1, l, 0)) % mod;\n\t\t\t}\n\t\t}\n\treturn dp[u][step][l][hz] = ans % mod;\n}\nsigned main() {\n\tcin >> n >> m >> k;\n\tcin >> s;\n\tint u, v;\n\tlong long ans = 0;\n\tmemset(dp, -1, sizeof(dp));//\u521d\u59cb\u5316\n\tfor (int i = 1; i <= m; i++) {\n\t\tcin >> u >> v;\n\t\t--u;\n\t\t--v;\n\t\tg[u][v] = g[v][u] = 1;\n\t}\n\tfor (int i = 0; i < n; i++) {\n\t\tif (s[i] == '(')\n\t\t\tans = (ans + dfs(i, 1, 1, 0)) % mod;\n\t\telse if (s[i] == '-')\n\t\t\tans = (ans + dfs(i, 1, 0, 0)) % mod;\n\t\telse if (isnum(s[i]))\n\t\t\tans = (ans + dfs(i, 1, 0, s[i] == '0')) % mod;\n\t}\n\tcout << ans;//\u8f93\u51fa\u7b54\u6848\n\treturn 0;\n}\n```\n\u6284\u88ad\u6ca1\u597d\u4e0b\u573a\u5466\uff01",
        "postTime": 1654760119,
        "uid": 378951,
        "name": "farfar",
        "ccfLevel": 0,
        "title": "P4580 [BJOI2014]\u8def\u5f84 \u9898\u89e3"
    }
]