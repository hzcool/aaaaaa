[
    {
        "content": "~~\u62a2\u5230\u7b2c\u4e00\u7bc7\u9898\u89e3\u5566~~\n\n\u5f88\u88f8\u7684splay\uff0c\u7136\u800c\u8fd8\u662f\u6ca1\u660e\u767d\u4e3a\u4ec0\u4e48\u51fa\u9898\u4eba\u628a\u8fd9\u9898\u6392\u6700\u7b80\u5355\uff0c\u53ef\u80fd\u662f\u849f\u84bb\u6211\u60f3\u592a\u590d\u6742\u4e86\n\n\u4e00\u5f00\u59cb\u5efa\u7acbsplay\u8981\u52a0\u4e24\u4e2a\u54e8\u5175(\u70e7\u997c)\u7ed3\u70b91\u548cn+2\uff0c\n\u539f\u59cb\u7684\u6bcf\u4e2a\u8bbe\u5907\u5e8f\u5217\u7f16\u53f7\u52a01\uff0c\u4ee4n+=2\n\n$I \\ x$\u64cd\u4f5c\uff0c\u5728splay tree\u4e2d\u627e\u5230**\u7b2cx+1\u4e2a**\u7ed3\u70b9x\u65cb\u8f6c\u5230\u6839\uff0c\u627e\u5230**\u7b2cx+2\u4e2a**\u7ed3\u70b9y\u65cb\u8f6c\u5230\u6839\u7684\u53f3\u5b50\u6811\uff0c\n\u65b0\u8282\u70b9\u7f16\u53f7\u4e3a++n\uff0c\u5c06\u5176\u4f5c\u4e3ay\u7684\u5de6\u5b50\u6811\uff0c\u66f4\u65b0y\u548cx\u7ef4\u62a4\u7684\u503c\n\n$D \\ x$\u64cd\u4f5c\uff0c\u5728splay tree\u4e2d\u627e\u5230**\u7b2cx\u4e2a**\u7ed3\u70b9x\u65cb\u8f6c\u5230\u6839\uff0c\u627e\u5230**\u7b2cx+2\u4e2a**\u7ed3\u70b9y\u65cb\u8f6c\u5230\u6839\u7684\u53f3\u5b50\u6811\n\u65ad\u6389y\u7684\u5de6\u5b50\u6811\n\n$QA$\u64cd\u4f5c\uff0c\u7528\u4e00\u4e2a\u53d8\u91cfrem\u8bb0\u5f55\u5220\u6389\u4e86\u591a\u5c11\u8282\u70b9\u5c31\u597d\uff0c\u8f93\u51fan-2-rem\n\n$QS\\ ll\\ rr$\u64cd\u4f5c\uff0c\u5728splay tree\u4e2d\u627e\u5230**\u7b2cll\u4e2a**\u7ed3\u70b9x\u65cb\u8f6c\u5230\u6839\uff0c\u627e\u5230**\u7b2crr+2\u4e2a**\u7ed3\u70b9y\u65cb\u8f6c\u5230\u6839\u7684\u53f3\u5b50\u6811\uff0c\u8f93\u51fay\u7684\u5de6\u5b50\u6811\u7ef4\u62a4\u7684\u503c\n\n```\n#include<iostream>\n#include<cmath>\n#include<algorithm>\n#include<queue>\n#include<cstring>\n#include<cstdio>\n#include<stack>\nusing namespace std;\ntypedef double dd;\n\nint read()\n{\n    int f=1,x=0;\n    char ss=getchar();\n    while(ss<'0'||ss>'9'){if(ss=='-')f=-1;ss=getchar();}\n    while(ss>='0'&&ss<='9'){x=x*10+ss-'0';ss=getchar();}\n    return f*x;\n}\n\nconst int maxn=30010;\nint n,m;\nint a[maxn][210];\nint rt,ch[maxn][2],fa[maxn],rem;\nint val[maxn][210],size[maxn];\n\nvoid update(int p)\n{\n    int lc=ch[p][0],rc=ch[p][1];\n    size[p]=size[lc]+size[rc]+1;\n    for(int i=1;i<=m;++i)\n    val[p][i]=val[lc][i]+val[rc][i]+a[p][i];\n}\n\nvoid build(int p,int ll,int rr)\n{\n    if(ll>rr) return;\n    int mid=ll+rr>>1;\n    fa[mid]=p; size[mid]=1;\n    ch[p][mid>p]=mid;\n    if(ll==rr)\n    {\n        for(int i=1;i<=m;++i)val[ll][i]=a[ll][i];\n        return;\n    }\n    build(mid,ll,mid-1); build(mid,mid+1,rr);\n    update(mid);\n}\n\nvoid rotate(int &p,int x)\n{\n    int y=fa[x],z=fa[y];\n    int d=(ch[y][0]==x);\n    if(y==p) p=x;\n    else if(ch[z][0]==y) ch[z][0]=x;\n    else ch[z][1]=x;\n    fa[y]=x; fa[ch[x][d]]=y; fa[x]=z;\n    ch[y][d^1]=ch[x][d]; ch[x][d]=y;\n    update(y); update(x);\n}\n\nvoid splay(int &p,int x)\n{\n    while(x!=p)\n    {\n        int y=fa[x],z=fa[y];\n        if(y!=p)\n        {\n            if((ch[z][0]==y)^(ch[y][0]==x))rotate(p,x);\n            else rotate(p,y);\n        }\n        rotate(p,x);\n    }\n}\n\nint find(int p,int k)\n{\n    int ss=size[ch[p][0]];\n    if(k==ss+1) return p;\n    else if(k<=ss) return find(ch[p][0],k);\n    else return find(ch[p][1],k-ss-1);\n}\n\nvoid ins(int k)\n{\n    int x=find(rt,k+1); splay(rt,x);\n    int y=find(rt,k+2); splay(ch[x][1],y);\n    \n    ch[y][0]=n; fa[n]=y; size[n]=1;\n    for(int i=1;i<=m;++i) val[n][i]=a[n][i];\n    update(y); update(x);\n}\n\nvoid del(int k)\n{\n    int x=find(rt,k); splay(rt,x);\n    int y=find(rt,k+2); splay(ch[x][1],y);\n    \n    fa[ch[y][0]]=0; ch[y][0]=0;\n    update(y); update(x); rem++;\n}\n\nvoid get(int ll,int rr)\n{\n    int x=find(rt,ll); splay(rt,x);\n    int y=find(rt,rr+2); splay(ch[x][1],y);\n    \n    for(int i=1;i<=m;++i)\n    printf(\"%d \",val[ch[y][0]][i]);\n    printf(\"\\n\");\n}\n\nint main()\n{\n    n=read();m=read();\n    for(int i=2;i<=n+1;++i)\n    {\n        int k=read();\n        while(k--)\n        {\n            int x=read()+1,y=read();\n            a[i][x]=y;\n        }\n    }\n    rt=n+3>>1; \n    build(rt,1,n+2); n+=2;\n    \n    int q=read();\n    while(q--)\n    {\n        char ss[5]; scanf(\"%s\",&ss);\n        if(ss[0]=='I')\n        {\n            int p=read(),k=read(); ++n;\n            while(k--)\n            {\n                int x=read()+1,y=read();\n                a[n][x]=y;\n            }\n            ins(p);\n        }\n        else if(ss[0]=='D') del(read());\n        else if(ss[0]=='Q'&&ss[1]=='A') printf(\"%d\\n\",n-2-rem);\n        else if(ss[0]=='Q'&&ss[1]=='S') \n        {\n            int ll=read(),rr=read();\n            get(ll,rr);\n        }\n    }\n    printf(\"end\");\n    return 0;\n    //niiick\n}\n```",
        "postTime": 1531285857,
        "uid": 60885,
        "name": "niiick",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4743 \u3010[Wind Festival]Energy Center\u3011"
    },
    {
        "content": "~~\u8bed\u6587\u9898\uff08~~\n\n\u9898\u610f\uff1a\u7ed9\u5b9a $1\\times m$ \u77e9\u9635\u5217 $\\{a_n\\}$\uff0c\u7ef4\u62a4\u5355\u70b9\u63d2\u5165\uff0c\u5355\u70b9\u5220\u9664\uff0c\u77e9\u9635\u5217\u957f\u5ea6\uff0c\u533a\u95f4\u548c\u3002\n# \u601d\u8def\n\u7528\u5e73\u8861\u6811\u7ef4\u62a4\u4e4b\uff0c\u8003\u8651\u7ecf\u5178\u5e73\u8861\u6811\u4e94\u95ee\uff1a\n### \u8282\u70b9\u4fe1\u606f\n\u56e0\u4e3a\u6211\u4eec\u5199\u7684\u662f FHQ\uff0c\u6240\u4ee5\u8981\u8bb0\u5f55\u5de6\u53f3\u5b69\u5b50\u3001\u4e24\u4e2a\u6743\u503c\u3001\u5b50\u6811\u5927\u5c0f\u3002\n\n\u56e0\u4e3a\u8981\u7ef4\u62a4\u533a\u95f4\u548c\uff0c\u6240\u4ee5\u8981\u8bb0\u5f55\u5b50\u6811\u548c\u3002\n### \u8282\u70b9\u6807\u8bb0 & \u4e0b\u4f20\u6807\u8bb0 & \u533a\u95f4\u4fee\u6539\n\u6ca1\u6709\u533a\u95f4\u4fee\u6539\uff0c\u4e0d\u8003\u8651\u3002\n### \u4e0a\u4f20\u4fe1\u606f\n\u6b63\u5e38\u66f4\u65b0\u5b50\u6811\u5927\u5c0f\u3002\u5b50\u6811\u548c = \u5de6\u5b50\u6811\u548c + \u53f3\u5b50\u6811\u548c + \u8282\u70b9\u672c\u8eab\u77e9\u9635\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5199\u51fa\uff1a\n```cpp\n#define F for(int i = 0;i < m;++i)\ninline int R()\n{\n    int r = 0;char c = getchar();while(!isdigit(c)) c = getchar();\n    while(isdigit(c)) r = r * 10 + c - '0', c = getchar();return r;\n}\nvoid P(int x) {if(x >= 10) P(x / 10);putchar(x % 10 + '0');}\nstruct T\n{\n    T *l, *r;int k, s, v[200], q[200];T() : l(0), r(0), k(rand()), s(1)\n    {\n        memset(v, 0, m << 2);memset(q, 0, m << 2);g =\n        R();while(g--) x = R(), y = R(), v[x] = q[x] = y;\n    }\n    void u()\n    {\n        s = 1;memcpy(q, v, m << 2);if(l) {F q[i] += l->q[i];\n        s += l->s;}if(r) {F q[i] += r->q[i];s += r->s;}\n    }\n}*r, *a, *b, *c, *s[30];\nvoid S(T *x, int k, T *&a, T *&b)\n{\n    if(!x) {a = b = 0;return;}if(!k) {a = 0;b = x;return;}\n    if(k >= x->s) {a = x;b = 0;return;}int z = x->l ? x->l->s\n    : 0;if(z >= k) b = x, S(x->l, k, a, b->l), b->u();\n    else a = x, S(x->r, k - z - 1, a->r, b), a->u();\n}\nT *M(T *a, T *b)\n{\n    if(!a) return b;if(!b) return a;if(a->k <\n    b->k) {a->r = M(a->r, b);a->u();return a;}\n    else {b->l = M(a, b->l);b->u();return b;}\n}\n```\n\uff08\u53ef\u4ee5\u9009\u62e9\uff09\u7528\u7b1b\u5361\u5c14\u6811\u4f18\u5316\u5efa\u6811\u8fc7\u7a0b\u3002\n```cpp\nfor(int i = 1;i <= n;++i, s[l++] = a)\n{\n    a = new T;k = a->k;p = l;while(l && k < s[l - 1]->k)\n    s[--l]->u();if(l < p) a->l = s[l];if(l) s[l - 1]->r = a;\n}\nwhile(l) s[--l]->u();r = s[0];\n```\n\u5206\u522b\u5904\u7406\u6bcf\u79cd\u64cd\u4f5c\u3002\n```cpp\nwhile(q--)\n{\n    scanf(\"%s\", o);switch(o[0])\n    {\n        case 'I': S(r, R(), a, b);r = M(a, M(new T, b));break;\n        case 'D': S(r, R() - 1, a, b);S(b, 1, b, c);delete b;r = M(a, c);break;\n        case 'Q': if(o[1] == 'A') P(r->s);else {x = R();y = R();S(r, y, a, c);S(a,\n        x - 1, a, b);F P(b->q[i]), putchar(' ');r = M(a, M(b, c));}puts(\"\");break;\n    }\n}\n```\n\u8fd9\u9898\u505a\u5b8c\u4e86\u3002\n# Code\n```cpp\n#include <cstdio>\n#include <cctype>\n#include <cstdlib>\n#include <cstring>\n#define F for(int i = 0;i < m;++i)\ninline int R()\n{\n    int r = 0;char c = getchar();while(!isdigit(c)) c = getchar();\n    while(isdigit(c)) r = r * 10 + c - '0', c = getchar();return r;\n}\nvoid P(int x) {if(x >= 10) P(x / 10);putchar(x % 10 + '0');}\nint n, m, q, l, k, p, g, x, y;char o[3];struct T\n{\n    T *l, *r;int k, s, v[200], q[200];T() : l(0), r(0), k(rand()), s(1)\n    {\n        memset(v, 0, m << 2);memset(q, 0, m << 2);g =\n        R();while(g--) x = R(), y = R(), v[x] = q[x] = y;\n    }\n    void u()\n    {\n        s = 1;memcpy(q, v, m << 2);if(l) {F q[i] += l->q[i];\n        s += l->s;}if(r) {F q[i] += r->q[i];s += r->s;}\n    }\n}*r, *a, *b, *c, *s[30];\nvoid S(T *x, int k, T *&a, T *&b)\n{\n    if(!x) {a = b = 0;return;}if(!k) {a = 0;b = x;return;}\n    if(k >= x->s) {a = x;b = 0;return;}int z = x->l ? x->l->s\n    : 0;if(z >= k) b = x, S(x->l, k, a, b->l), b->u();\n    else a = x, S(x->r, k - z - 1, a->r, b), a->u();\n}\nT *M(T *a, T *b)\n{\n    if(!a) return b;if(!b) return a;if(a->k <\n    b->k) {a->r = M(a->r, b);a->u();return a;}\n    else {b->l = M(a, b->l);b->u();return b;}\n}\nint main()\n{\n    n = R();m = R();for(int i = 1;i <= n;++i, s[l++] = a)\n    {\n        a = new T;k = a->k;p = l;while(l && k < s[l - 1]->k)\n        s[--l]->u();if(l < p) a->l = s[l];if(l) s[l - 1]->r = a;\n    }\n    while(l) s[--l]->u();r = s[0];q = R();while(q--)\n    {\n        scanf(\"%s\", o);switch(o[0])\n        {\n            case 'I': S(r, R(), a, b);r = M(a, M(new T, b));break;\n            case 'D': S(r, R() - 1, a, b);S(b, 1, b, c);delete b;r = M(a, c);break;\n            case 'Q': if(o[1] == 'A') P(r->s);else {x = R();y = R();S(r, y, a, c);S(a,\n            x - 1, a, b);F P(b->q[i]), putchar(' ');r = M(a, M(b, c));}puts(\"\");break;\n        }\n    }\n    return puts(\"end\"), 0;\n}\n```\n\n",
        "postTime": 1661853096,
        "uid": 388651,
        "name": "5k_sync_closer",
        "ccfLevel": 7,
        "title": "P4743 [Wind Festival]Energy Center \u9898\u89e3"
    },
    {
        "content": "# \u672c\u9898 $FHQ\\;Teap$ \u5199\u6cd5\n\n\u88f8\u7684 $fhq\\; Treap$ \u53ea\u4e0d\u8fc7\u628a\u6bcf\u4e2a\u8282\u70b9\u7528\u7ed3\u6784\u4f53\u50a8\u5b58\uff0c\u4fdd\u5b58\u6bcf\u4e2a $value_i$ \u5c31\u884c\u4e86\uff0c\u591a\u4e00\u4e2a\u7ed3\u6784\u4f53 $sum[i]$ \u8868\u793a\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u7684\u6bcf\u4e2a\u72b6\u6001\u4e4b\u548c\uff0c\u5206\u88c2\u8981\u7528\u6392\u540d\u5206\u88c2,\u67e5\u8be2\u65f6\u5c06\u6574\u68f5\u6811\u5206\u6210\u4e09\u6bb5\uff0c\u8fd4\u56de\u4e2d\u95f4\u4e00\u6bb5 $l$ \u5230 $r$ \u7684\u4fe1\u606f\u5c31\u884c\u4e86\n\n\u6700\u5f00\u59cb\u63d2\u5165\u4e00\u4e2a\u7a7a\u8282\u70b9\uff0c\u5176 $heap$ \u503c\u4e3a $-INT\\_MAX$ \u540e\u9762\u6bcf\u6b21\u63d2\u5165\u6216\u5220\u9664\u7684\u4f4d\u7f6e\u90fd\u8981\u52a0 $1$ ,\u8be2\u95ee\u673a\u5668\u4e2a\u6570\u65f6\u5c31\u8f93\u51fa $size[root]-1$ \u5c31\u884c\u4e86\n\n### \u4ee3\u7801\u5982\u4e0b:\n\n```cpp\n#include <bits/stdc++.h>\n#define random(x) rand()*rand()%x;\n#define INF random(30000010)+10000010\n#define N 50010\n\nusing namespace std;\n\nstruct node{\n\tint num[210];\n\tvoid clean() {memset(num,0,sizeof(num));}\n}xx,sum[N],t[N];\n\nint n,m,T,x,y,_x,X,a,b,cnt,root,l,r;\nint son[N][2],heap[N],size[N];\nchar c;\n\nvoid add(node x) {t[++cnt]=x,sum[cnt]=x,size[cnt]=1,heap[cnt]=random(INF);}\n\nvoid update(int x)    \t\t\\\\\u66f4\u65b0\u8282\u70b9\u65f6\u522b\u5fd8\u8bb0\u66f4\u65b0sum\u503c\n{\n\tsize[x]=size[son[x][0]]+size[son[x][1]]+1;\n\tfor (int i=0;i<m;i++)\n\t\tsum[x].num[i]=t[x].num[i]+sum[son[x][0]].num[i]+sum[son[x][1]].num[i];\n}\n\nvoid split(int now,int &a,int &b,int val)\t\\\\\u6392\u540d\u5206\u88c2\n{\n    if (now==0) {a=0,b=0;return;}\n    if (size[son[now][0]]+1<=val) a=now,split(son[now][1],son[a][1],b,val-size[son[now][0]]-1);\n    else b=now,split(son[now][0],a,son[b][0],val);\n    update(now);\n}\n\nvoid merge(int &now,int a,int b)\n{\n    if (a==0 || b==0) {now=a+b;return;}\n    if (heap[a]<heap[b]) now=a,merge(son[now][1],son[a][1],b);\n    else now=b,merge(son[now][0],a,son[b][0]);\n    update(now);\n}\n\nvoid insert(int val)\n{\n    int x=0,y=0;\n    add(xx);\n    int o=cnt;\n    split(root,x,y,val);\n    merge(x,x,o);merge(root,x,y);\n}\n\nvoid del(int val)\n{\n\tint x=0,y=0,o=0;\n\tsplit(root,x,y,val);split(x,x,o,val-1);\n\tmerge(o,son[o][0],son[o][1]);\n\tmerge(x,x,o),merge(root,x,y);\n}\t\t\t\t\t\\\\\u666e\u901a\u7684 fhq Treap\n\nnode query(int l,int r)\t\t\t\\\\\u8be2\u95ee\u533a\u95f4\u4fe1\u606f\uff0c\u8fd4\u56de\u4e00\u4e2a\u7ed3\u6784\u4f53\n{\n\tint x=0,y=0,o=0;\n\tsplit(root,x,y,l);split(y,y,o,r-l+1);\t\t\\\\\u6ce8\u610f\u7531\u4e8e\u63d2\u5165\u4e86\u4e00\u4e2a\u7a7a\u8282\u70b9\uff0c\u533a\u95f4\u6574\u4f53\u5411\u540e\u79fb\u4e00\u4e2a\u5355\u4f4d\n\tnode xx=sum[y];\n\tmerge(y,y,o),merge(root,x,y);\n\treturn xx;\n}\n\nvoid write(node x)\t\t\t\\\\\u5c06\u8fd4\u56de\u7684\u7ed3\u6784\u4f53\u8f93\u51fa\n{\n\tfor (int i=0;i<m;i++) printf(\"%d \",x.num[i]);\n\tprintf(\"\\n\");\n\treturn;\n}\n\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tadd(xx),root=1,heap[1]=-INT_MAX;\n\tfor (int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d\",&_x);\n\t\txx.clean();\n\t\tfor (int j=1;j<=_x;j++)\n\t\t\tscanf(\"%d%d\",&x,&y),xx.num[x]=y;\n\t\tinsert(i);\n\t}\n\tscanf(\"%d\",&T);\n\twhile (T--)\n\t{\n\t\tc=getchar();\n\t\twhile (c<'A' || c>'Z') c=getchar();\n\t\tif (c=='I')\n\t\t{\n\t\t\tscanf(\"%d\",&X);\n\t\t\tscanf(\"%d\",&_x);\n\t\t\txx.clean();\n\t\t\tfor (int j=1;j<=_x;j++)\n\t\t\t\tscanf(\"%d%d\",&x,&y),xx.num[x]=y;\n\t\t\tinsert(X+1);\n\t\t}\n\t\telse if (c=='D') scanf(\"%d\",&x),del(x+1);\n\t\telse\n\t\t{\n\t\t\tc=getchar();\n\t\t\tif (c=='A') printf(\"%d\\n\",size[root]-1);\n\t\t\telse scanf(\"%d%d\",&l,&r),write(query(l,r));\n\t\t}\n\t}\n\tprintf(\"end\\n\");\t\t\\\\\u522b\u5fd8\u8bb0\u8f93\u51fa end\n\treturn 0;\n}\n```",
        "postTime": 1560253539,
        "uid": 67718,
        "name": "G\u6211\u5c31\u662f\u83dcG",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011P4743 [Wind Festival]Energy Center"
    }
]