[
    {
        "content": "\u89c9\u5f97\u4e24\u7bc7\u9898\u89e3\u6ca1\u6709\u5c06\u6d41\u91cf\u7684\u7ef4\u62a4\u8bb2\u6e05\u695a\uff0c\u76f4\u63a5\u5c31\u80e1\u8fc7\u53bb\u4e86\u3002\n\n\u7701\u9009\u524d\u53d1\u9898\u89e3 RP++ \u3002\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://rusunoi.github.io/post/P6122/)\n\n\u5148\u8003\u8651\u8d39\u7528\u6d41\uff0c\u6811\u4e0a\u53cc\u5411\u8fb9\uff0c\u5bb9\u91cf\u65e0\u9650\uff0c\u8d39\u7528\u4e3a $1$ \uff0c\u6e90\u70b9\u5411\u6240\u6709\u6709\u98df\u7269\u7684\u70b9\u8fde\u8fb9\uff0c\u6240\u6709\u9f39\u9f20\u5411\u6c47\u70b9\u8fde\u8fb9\u3002\u53d1\u73b0\u4e0d\u80fd\u4e00\u6b21\u505a\u5b8c\u6240\u6709\u70b9\uff0c\u9700\u8981\u4e00\u4e2a\u4e00\u4e2a\u6dfb\u52a0\uff0c\u8d39\u7528\u6d41\u4e0d\u65b9\u4fbf\u505a\u6b64\u9898\u3002\n\n\u8003\u8651\u6a21\u62df\u8d39\u7528\u6d41\uff0c\u6bcf\u65b0\u52a0\u5165\u4e00\u4e2a\u70b9\uff0c\u9700\u8981\u627e\u5230\u4e00\u6761\u6e90\u70b9 $\\to$ \u52a0\u5165\u7684\u70b9 $\\to$ \u6c47\u70b9\u7684\u4e00\u6761\u589e\u5e7f\u8def\uff0c\u4e0e\u6e90\u70b9\u6c47\u70b9\u8fde\u63a5\u7684\u8fb9\u662f\u552f\u4e00\u7684\uff0c\u4e5f\u5c31\u662f\u9700\u8981\u5728\u6811\u4e0a\u627e\u5230\u4e00\u6761\u52a0\u5165\u7684\u70b9 $\\to$ \u6709\u98df\u7269\u7684\u70b9\u7684\u6700\u77ed\u8def\u3002\u73b0\u5728\u8003\u8651\u5982\u4f55\u5feb\u901f\u627e\u5230\u8fd9\u6837\u7684\u6700\u77ed\u8def\uff0c\u6ce8\u610f\u5230\u8fd9\u662f\u4e00\u68f5\u4e8c\u53c9\u6811\uff0c\u6811\u9ad8\u53ea\u6709 $\\log n$ \uff0c\u8003\u8651\u7ef4\u62a4 $f _ i, g _ i$ \u8868\u793a\u70b9 $i$ \u5230\u5176\u5b50\u6811\u4e2d\u6709\u98df\u7269\u7684\u70b9\u7684\u6700\u77ed\u8def\u4e3a\u591a\u5c11\u3001\u662f\u54ea\u4e2a\u70b9\u3002\u8fd9\u6837\u4ece\u4e00\u4e2a\u70b9\u4e00\u76f4\u8df3\u7236\u4eb2\uff0c\u53ea\u9700\u8981 $\\log n$ \u6b21\u5c31\u53ef\u4ee5\u786e\u5b9a\u8fd9\u4e2a\u70b9\u3002\u786e\u5b9a\u70b9\u540e\u9700\u8981\u5c06\u8fd9\u4e00\u6761\u8def\u5f84\u7684\u6d41\u91cf\u51cf\u4e00\uff0c\u53cd\u5411\u8fb9\u6d41\u91cf\u52a0\u4e00\u3002\n\n\u53cc\u5411\u8fb9\u4ee5\u53ca\u5b83\u4eec\u7684\u53cd\u5411\u8fb9\u7684\u6d41\u91cf\u4ee5\u53ca\u8d39\u7528\u53ef\u4ee5\u7b80\u5355\u5730\u7528\u4e00\u4e2a\u6570\u7ec4\u5373\u53ef\u7ef4\u62a4\uff0c\u539f\u6765\u7684\u4e00\u5bf9\u7236\u5b50 $p, s$ \u9700\u8981\u5efa\u8fb9 $(p, s, inf, 1)$ \u4ee5\u53ca\u53cd\u5411\u8fb9 $(s, p, 0, -1)$ \uff1b$(s, p, inf, 1)$ \u4ee5\u53ca\u53cd\u5411\u8fb9 $(p, s, 0, -1)$ \uff0c\u65e0\u8bba\u662f $p \\to s$ \u8fd8\u662f $s \\to p$ \uff0c\u90fd\u4f18\u5148\u8003\u8651\u8d70\u5bf9\u65b9\u7684\u53cd\u5411\u8fb9\uff0c\u56e0\u4e3a\u53cd\u5411\u8fb9\u7684\u8d39\u7528\u4e3a $-1$ \uff0c\u662f\u66f4\u4f18\u7684\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a $wt _ i$ \u8868\u793a\u4ece $i$ \u7684\u7236\u4eb2\u5230 $i$ \u7684\u6b63\u5411\u8fb9\u6d41\u91cf\uff0c\u5f53\u5176\u4e3a\u6b63\u7684\u65f6\u5019\uff0c\u8868\u793a\u5b58\u5728\u8fb9 $(p, s, inf, 1), (s, p, wt _ i, -1)$ \uff0c\u7236\u4eb2\u5230\u513f\u5b50\u53ea\u80fd\u9009\u62e9\u6b63\u5411\u8fb9\uff0c\u513f\u5b50\u5230\u7236\u4eb2\u4f18\u5148\u9009\u62e9\u7236\u4eb2\u5230\u513f\u5b50\u7684\u53cd\u5411\u8fb9\uff1b\u5f53\u5176\u4e3a\u8d1f\u7684\u65f6\u5019\uff0c\u8868\u793a\u5b58\u5728\u8fb9 $(s, p, inf, 1), (p, s, wt _ i, -1)$ \uff0c\u513f\u5b50\u5230\u7236\u4eb2\u53ea\u80fd\u9009\u62e9\u53cd\u5411\u8fb9\uff0c\u7236\u4eb2\u5230\u513f\u5b50\u4f18\u5148\u9009\u62e9\u53cd\u5411\u8fb9\uff1b\u5f53\u4e3a $0$ \u7684\u65f6\u5019\uff0c\u90a3\u4e48\u4e24\u8005\u90fd\u6ca1\u6709\u6d41\u91cf\uff0c\u53ea\u80fd\u9009\u62e9\u6b63\u5411\u8fb9\u3002\n\n\u65b0\u52a0\u5165\u70b9 $p$ \u65f6\uff0c\u5148\u4e0d\u65ad\u8df3\u7236\u4eb2\uff0c\u627e\u5230\u4e00\u4e2a\u7236\u4eb2 $pos$ \u4f7f\u5f97\u8def\u5f84 $p \\to pos \\to g _ {pos}$ \u662f\u6700\u77ed\u8def\uff0c\u7136\u540e\u4fee\u6539\u5176\u4e2d\u7684\u6d41\u91cf\uff0c\u5bf9\u4e8e\u5411\u4e0a\u7684\u8fb9\uff0c\u76f8\u5f53\u4e8e\u4f7f ``wt--`` \uff0c\u5411\u4e0b\u7684\u8fb9\u53cd\u4e4b\u3002\u4fee\u6539\u5b8c\u8def\u5f84\u540e\uff0c\u9700\u8981\u5c06\u6240\u6709 $f _ i, g _ i$ \u53d7\u5230\u5f71\u54cd\u7684\u70b9\u5168\u90e8\u66f4\u65b0\uff0c\u5373 $p \\to pos, g _ {pos} \\to pos, pos \\to root$ \u3002\n\n\u6bcf\u4e2a\u70b9\u5b8c\u6210\u540e\u8f93\u51fa\u7b54\u6848\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $O(n \\log n)$ \u3002\n\n```cpp\n#include <cstdio>\nusing namespace std;\ntemplate <class Type>\nvoid read(Type &x)\n{\n    char c;\n    bool flag = false;\n    while ((c = getchar()) < '0' || c > '9')\n        c == '-' && (flag = true);\n    x = c - '0';\n    while ((c = getchar()) >= '0' && c <= '9')\n        x = (x << 3) + (x << 1) + c - '0';\n    flag && (x = ~x + 1);\n}\ntemplate <class Type>\nvoid write(Type x)\n{\n    x < 0 && (putchar('-'), x = ~x + 1);\n    x > 9 && (write(x / 10), 0);\n    putchar(x % 10 + '0');\n}\nconst int N = 1e5 + 10, inf = 2e6;\nint n, m, c[N], f[N << 1], g[N << 1], wt[N];\nvoid chkmin (int &x, int &mn, int t, int k)\n{\n    k < mn && (mn = k, x = t);\n}\nint cst_up (int x)\n{\n    return wt[x] > 0 ? -1 : 1;\n}\nint cst_down (int x)\n{\n    return wt[x] < 0 ? -1 : 1;\n}\nvoid update (int x)\n{\n    f[x] = inf;\n    c[x] && (f[x] = 0, g[x] = x);\n    x << 1 <= n && (chkmin(g[x], f[x], g[x << 1], f[x << 1] + cst_down(x << 1)), 0);\n    (x << 1 | 1) <= n && (chkmin(g[x], f[x], g[x << 1 | 1], f[x << 1 | 1] + cst_down(x << 1 | 1)), 0);\n}\nint main ()\n{\n    read(n), read(m);\n    for (int i = 1; i <= n; i++)\n        read(c[i]);\n    for (int i = n; i; i--)\n        update(i);\n    int res = 0;\n    for (int p; m; m--)\n    {\n        read(p);\n        int mn = inf, pos;\n        for (int u = p, t = 0; u; t += cst_up(u), u >>= 1)\n            chkmin(pos, mn, u, f[u] + t);\n        res += mn;\n        for (int u = p; u ^ pos; u >>= 1)\n            wt[u]--, update(u);\n        c[g[pos]]--;\n        for (int u = g[pos]; u ^ pos; u >>= 1)\n            wt[u]++, update(u);\n        for (; pos; pos >>= 1)\n            update(pos);\n        write(res), putchar(' ');\n    }\n    return 0;\n}\n```\n",
        "postTime": 1648812377,
        "uid": 185726,
        "name": "RuSun",
        "ccfLevel": 8,
        "title": "Solution P6122"
    },
    {
        "content": "\u5bb9\u6613\u5efa\u51fa\u8d39\u7528\u6d41\u6a21\u578b\uff1a\n\n\u6e90\u70b9\u5411\u677e\u9f20\u4f4f\u7684\u6d1e\u8fde\u5bb9\u91cf\u4e3a $1$\uff0c \u8d39\u7528\u4e3a $0$ \u7684\u8fb9\u3002\n\n\u76f8\u90bb\u4e24\u70b9\u8fde\u5bb9\u91cf\u65e0\u9650\u5927\uff0c \u8d39\u7528\u4e3a $1$ \u7684\u8fb9\u3002\n\n\u6709\u98df\u7269\u7684\u70b9\u5411\u6c47\u70b9\u8fde\u5bb9\u91cf\u4e3a $c_i$\uff0c \u8d39\u7528\u4e3a $0$ \u7684\u8fb9\u3002\n\n\u7136\u540e\u5c31\u662f\u8d39\u7528\u6d41\u677f\u5b50\u4e86\u3002 \u4f46\u663e\u7136\uff0c \u8fd9\u6837\u4f1a\u8d85\u65f6\u3002\n\n## \u6a21\u62df\u8d39\u7528\u6d41\n\n\u6211\u4eec\u53ef\u4ee5\u6a21\u62df\u8d39\u7528\u6d41\u7684\u8fc7\u7a0b\uff0c \u628a\u65f6\u95f4\u4f18\u5316\u5230 $\\Theta(n\\log n)$\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c \u6211\u4eec\u6bcf\u52a0\u5165\u4e00\u4e2a\u70b9\u65f6\uff0c \u66b4\u529b\u67e5\u8be2\u5230\u8fd9\u4e2a\u70b9\u8ddd\u79bb\u6700\u5c0f\u4e14\u6709\u98df\u7269\u7684\u70b9\u3002 \u8fd9\u4e2a\u53ef\u4ee5 $dp$\u3002 \u8bbe $f(i)$ \u8868\u793a $i$ \u70b9\u5230\u5b50\u6811\u5185\u7684\u70b9\u7684\u6700\u5c0f\u8ddd\u79bb\u3002 \u7531\u4e8e\u662f\u4e00\u9897\u5b8c\u5168\u4e8c\u53c9\u6811\uff0c \u6211\u4eec\u5c06\u52a0\u5165\u7684\u70b9\u66b4\u529b\u5f80\u4e0a\u722c\u53bb\u627e\uff0c \u4e00\u6b21\u65f6\u95f4 $\\Theta(\\log n)$\u3002\n\n\u627e\u5230\u90a3\u4e2a\u70b9\u4e4b\u540e\uff0c \u66b4\u529b\u6539\u53d8\u4e24\u70b9\u4e4b\u95f4\u7684\u8def\u5f84\u7684\u6d41\u91cf\u548c\u8fb9\u6743\uff08\u5c31\u50cf\u8d39\u7528\u6d41\u4e00\u6837\uff09\uff0c \u540c\u65f6\u66f4\u65b0 $f$ \u7684\u503c\u3002 \u6ce8\u610f\uff0c $f$ \u7684\u503c\u8981\u66f4\u65b0\u5230\u6839\uff0c \u6709\u53ef\u80fd\u4f1a\u66f4\u65b0\u5c11\u4e86 ~~\uff08\u522b\u95ee\u6211\u662f\u600e\u4e48\u77e5\u9053\u7684\uff09~~\u3002\n\n\u7136\u540e\u590d\u6742\u5ea6\u5c31\u53d8\u6210 $\\Theta(n\\log n)$ \u4e86\u3002\n\n## Code:\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nconst int N=1e5+5,inf=0x3f3f3f3f;\nint n,m,p[N],c[N],f[N<<1],g[N<<1];\nvoid upd(int &a,int &b,int x,int y){\n\tif(x<a) a=x,b=y;\n}\nint flow[N],ans;\nvoid update(int x){\n\tf[x]=inf;\n\tif(c[x]) f[x]=0,g[x]=x;\n\tupd(f[x],g[x],f[x<<1]+(flow[x<<1]<0?-1:1),g[x<<1]);\n\tupd(f[x],g[x],f[x<<1|1]+(flow[x<<1|1]<0?-1:1),g[x<<1|1]);\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1; i<=n; i++) scanf(\"%d\",&c[i]);\n\tfor(int i=1; i<=m; i++) scanf(\"%d\",&p[i]);\n\tmemset(f,0x3f,sizeof f);\n\tfor(int i=n; i; i--) update(i);\n\tfor(int i=1; i<=m; i++){\n\t\tint x=inf,y=0,u=p[i],t=0,v=0;\n\t\twhile(u){\n\t\t\tif(x>f[u]+t) x=f[u]+t,y=g[u],v=u;\n\t\t\tt+=(flow[u]>0?-1:1);u>>=1;\n\t\t}\n\t\tu=p[i];ans+=x;\n\t\twhile(u!=v){\n\t\t\tflow[u]--;\n\t\t\tupdate(u>>1);\n\t\t\tu>>=1;\n\t\t}\n\t\tc[y]--;update(y);\n\t\twhile(y!=v){\n\t\t\tflow[y]++;\n\t\t\tupdate(y>>1);\n\t\t\ty>>=1;\n\t\t}\n\t\twhile(v) update(v),v>>=1;\n\t\tprintf(\"%d \",ans);\n\t}\n    return 0;\n}",
        "postTime": 1644053104,
        "uid": 225370,
        "name": "loverintime",
        "ccfLevel": 8,
        "title": "P6122"
    },
    {
        "content": "\u9898\u610f : $n$\u4e2a\u70b9\u7684\u5b8c\u5168\u4e8c\u53c9\u6811, \u70b9$i$\u4e0a\u6709$c_i$\u98df\u7269, $m$\u53ea\u4e0d\u540c\u4f4d\u7f6e\u7684\u4ed3\u9f20\u4f9d\u6b21\u9192\u6765, \u6c42\u6700\u5c0f\u603b\u8def\u5f84\u957f\u5ea6\n\n------\n\n~~\u4e0d\u8981\u8138\u7684\u6765\u6c34\u7bc7\u9898\u89e3~~\n\n\u636e\u8bf4\u662f\u4e00\u9053\u7ecf\u5178\u7684**\u6a21\u62df\u8d39\u7528\u6d41**\n\n* \u603b\u8def\u5f84\u957f\u5ea6\u53ef\u4ee5\u770b\u505a : \u6240\u6709\u8fb9\u53ef\u4ee5\u7ecf\u8fc7\u65e0\u6570\u6b21, \u6bcf\u7ecf\u8fc7\u4e00\u6b21\u82b1\u8d391\u7684\u8d39\u7528\n* \u98df\u7269\u662f\u6bcf\u53ea\u4ed3\u9f20\u7684\u7ec8\u70b9 : \u76f8\u5f53\u4e8e$i$\u5230\u6c47\u8fde\u4e00\u6761\u6d41\u91cf\u4e3a$c_i$\u7684\u8fb9\n* \u6bcf\u6b21\u90fd\u4f1a\u8fdb\u5165\u4e00\u53ea\u4ed3\u9f20 : \u76f8\u5f53\u4e8e\u6e90\u5411$p_i$\u52a0\u4e00\u6761\u6d41\u91cf\u4e3a1\u7684\u8fb9\n\n\u56e0\u4e3a\u8fd9\u79cd\u5efa\u56fe**\u6d41\u91cf\u8f6c\u79fb**\u975e\u5e38\u7684\u7b80\u5355, \u6240\u4ee5\u53ef\u4ee5\u624b\u52a8\u6a21\u62df\u4f7f\u590d\u6742\u5ea6\u8fbe\u5230$O(nlogn)$\n\n\u5927\u81f4\u6d41\u7a0b\u662f : \u7c7b\u4f3c\u8d2a\u5fc3, \u6bcf\u6b21\u627e\u5230\u6700\u8fd1\u8ddd\u79bb\u7684\u98df\u7269, \u7136\u540e\u501f\u52a9\u8d39\u7528\u6d41\u7684\u53cd\u6094\u673a\u5236, \u5728\u7ecf\u8fc7\u7684\u8def\u5f84\u4e0a\u7684\u53cd\u5411\u8fb9\u6dfb\u52a0\u8d1f\u8d39\u7528\u7684\u8fb9, \u6700\u540e\u66f4\u65b0\u8ddd\u79bb\n\n\u56e0\u4e3a\u662f\u5b8c\u5168\u4e8c\u53c9\u6811, \u6240\u4ee5\u6bcf\u6b21\u7684\u67e5\u627e\u7c7b\u4f3c\u5e73\u8861\u6811\u4e0a\u67e5\u627e, \u590d\u6742\u5ea6\u4fdd\u8bc1\u4e3a\u6bcf\u6b21\u4e00\u4e2a$log$, \u66f4\u65b0\u7b54\u6848\u7684\u65b9\u5f0f\u4e5f\u7c7b\u4f3c\u5e73\u8861\u6811\u7684update\n\n\u505a\u6cd5\u5f88\u5947\u5999, \u4e5f\u7b97\u662f\u4e00\u9053\u9887\u6709\u542f\u53d1\u6027\u7684\u4e00\u9053\u9898= =+\n\n\u6807\u7b7e\u6807\u84dd\u9898\u662f\u633a\u6b63\u5e38\u7684\n\n### \u4ee3\u7801\u5b9e\u73b0:\n\n```\n#include<cstdio>\n#include<cctype>\n#include<algorithm>\n#include<cmath>\n#define ll long long\n#define il inline\n#define rep(i,s,t) for(register int i=(s);i<=(t);i++)\n#define rev_rep(i,s,t) for(register int i=(s);i>=(t);i--)\n#define each(i,u) for(int i=head[u];i;i=bow[i].nxt)\n#define file(s) freopen(s\".in\",\"r\",stdin),freopen(s\".out\",\"w\",stdout)\n#define pt(x) putchar(x)\nusing namespace std;\nil int ci(){\n\tregister char ch; int f=1;\n\twhile(!isdigit(ch=getchar())) f=ch=='-'?-1:1;\n\tregister int x=ch^'0';\n\twhile(isdigit(ch=getchar())) x=(x*10)+(ch^'0');\n\treturn f*x;\n}\ntemplate<typename T>\nil bool chk_min(T&x,T y){\n\treturn y<x ? (x=y,1):0;\n}\n\nenum{N=800023}; // \u70b9\u6570\u591a\u5f00\u51e0\u500d\u9632\u6b62\u8d8a\u754c\n\n#define lc(x) ((x)<<1)\n#define rc(x) ((x)<<1|1)\nint dis[N],c[N],pos[N];\nint flow[N];\nil int lenU(int x){ return flow[x]<0 ? -1:1; }\nil int lenD(int x){ return flow[x]>0 ? -1:1; } \u8fd9\u91cc\u4ee3\u7801\u91cc\u7684\u6d41\u91cf\u662f\u6839\u636e\u6b63\u8d1f\u5224\u65ad\u662f\u5426\u662f\u53cd\u5411\u8fb9\u7684\n\u5982\u679cCE\u4e86\u4e0d\u8981\u602a\u6211\n\nil void update(int x){\n\tdis[x] = 1e9;\n\tpos[x] = 0;\n\tif( c[x] ) dis[x]=0, pos[x]=x;\n\tif( chk_min(dis[x],dis[lc(x)]+lenD(lc(x))) ){\n\t\tpos[x] = pos[lc(x)];\n\t}\n\tif( chk_min(dis[x],dis[rc(x)]+lenD(rc(x))) ){\n\t\tpos[x] = pos[rc(x)];\n\t}\n}\n\nint main(){\n\tint n=ci(), m=ci();\n\tmemset(dis,0x3f,sizeof(dis));\n\trep(i,1,n) c[i]=ci();\n\trev_rep(i,n,1) update(i);\n\tint ans = 0;\n\twhile( m-- ){\n\t\tint s=ci();\n\t\tint t=0;\n\t\tint cost=1e9, now=0;\n\t\t#define up(x,s,t) for(register int x=s;x!=t;x>>=1)\n\t\tup(x,s,0){\n\t\t\tif( chk_min(cost,now+dis[x]) ) t=x;\n\t\t\tnow += lenU(x);\n\t\t}\n\t\tint target = pos[t];\n\t\tans += cost;\n\t\tup(x,s,t) flow[x]++;\n\t\tup(x,target,t) flow[x]--;\n\t\tc[target]--;\n\t\tup(x,target,t) update(x);\n\t\tup(x,s,0) update(x);\n//\tprintf(\"c   \"); rep(i,1,n) printf(\"%d \",c[i]); pt('\\n');\n//\tprintf(\"dis \"); rep(i,1,n) printf(\"%d \",dis[i]); pt('\\n');\n//\tprintf(\"pos \"); rep(i,1,n) printf(\"%d \",pos[i]); pt('\\n');\n//\tprintf(\"flw \"); rep(i,1,n) printf(\"%d \",flow[i]); pt('\\n');\n\t\tprintf(\"%d \",ans);\n\t}\n\tpt('\\n');\n\treturn 0;\n}\n```\n\n\u8fd9\u4e48easy\u7684\u9898, \u5199\u8fc7\u4e86\u5374\u4e0d\u662f\u5f88\u6709\u6210\u5c31\u611f\n\n\u6bd5\u7adf\u771f\u6b63\u7684\u6a21\u62df\u8d39\u7528\u6d41\u8fd8\u662f\u5f88hard",
        "postTime": 1583984826,
        "uid": 127195,
        "name": "z7z_Eta",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P6122 \u3010[Neerc2016]Mole Tunnels\u3011"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P6122)\n\n\u540c\u6b65\u53d1\u8868\u4e8e\u6211\u7684 [$\\texttt{cnblog}$](https://www.cnblogs.com/UperFicial/p/16178283.html)\u3002\n\n### $\\texttt{Description}$\n\n\u6709\u4e00\u68f5 $n$ \u4e2a\u8282\u70b9\u7684\u5b8c\u5168\u4e8c\u53c9\u6811\uff0c\u7b2c $i$ \u4e2a\u70b9\u6700\u591a\u8d2e\u5b58 $c_i$ \u53ea\u9f39\u9f20\uff0c\u6709 $m$ \u53ea\u9f39\u9f20\u4f9d\u6b21\u9192\u6765\uff0c\u5bf9\u4e8e $\\forall k\\in[1,m]$ \u8f93\u51fa\u524d $k$ \u53ea\u9f39\u9f20\u9192\u6765\u540e\u6700\u5c11\u7684\u8fd0\u52a8\u957f\u5ea6\u603b\u548c\u3002\n\n$1\\le n\\le 10^5$\u3002\n\n### $\\texttt{Solution}$\n\n\u8003\u8651\u66b4\u529b\u5efa\u56fe\uff1a\n\n- \u4ece $s$ \u5411\u6bcf\u53ea\u9f39\u9f20\u7761\u89c9\u7684\u5730\u65b9\u8fde\u4e00\u6761\u5bb9\u91cf\u4e3a $1$\uff0c\u8d39\u7528\u4e3a $0$ \u7684\u8fb9\u3002\u8868\u793a\u6709 $1$ \u53ea\u9f39\u9f20\u5728\u67d0\u4e2a\u6d1e\u91cc\u3002\n\n- \u5bf9\u4e8e\u6811\u4e0a\u4e00\u4e2a\u70b9\uff0c\u8fde\u5411\u5b83\u80fd\u5230\u8fbe\u7684\u70b9\uff0c\u5bb9\u91cf\u4e3a $\\infty$\uff0c\u8d39\u7528\u4e3a $1$\u3002\u8868\u793a\u4e00\u6761\u8fb9\u53ef\u4ee5\u7ecf\u8fc7\u591a\u53ea\u9f39\u9f20\uff0c\u4f46\u662f\u9700\u8981\u4e00\u4e2a\u5355\u4f4d\u7684\u957f\u5ea6\u3002\n\n- \u6bcf\u4e2a\u70b9\u5411 $t$ \u8fde\u4e00\u6761\u5bb9\u91cf\u4e3a $c_i$\uff0c\u8d39\u7528\u4e3a $0$ \u7684\u8fb9\uff0c\u8868\u793a\u4e00\u4e2a\u7ec8\u70b9\u7684\u5bb9\u91cf\u3002\n\n\u4f46\u8fd9\u6837\u5efa\u56fe\u662f $\\Theta(nm)$ \u7684\uff0c\u8fb9\u6570\u4e5f\u662f $nm$ \u7ea7\u522b\u7684\uff0c\u663e\u7136 [$\\text{TLE}$](https://www.luogu.com.cn/record/74369874)\u3002\n\n\u90a3\u4e48\u552f\u4e00\u7684\u529e\u6cd5\uff0c\u5c31\u662f\u7528\u6478\u4f60\u80ba\u7528\u6d41\u7684\u601d\u8def\u6765\u4f18\u5316\u3002\n\n\u8003\u8651\u52a0\u5165\u4e86\u7b2c $i$ \u4e2a\u70b9\uff0c$s$ \u4e0e\u524d $i-1$ \u4e2a\u70b9\u4e4b\u95f4\u7684\u6d41\u91cf\u80af\u5b9a\u662f\u6ee1\u6d41\u4e86\uff0c\u56e0\u4e3a\u4e0d\u4f1a\u6709\u65e0\u89e3\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u6bcf\u4e2a\u70b9\u90fd\u5230\u8fbe\u76f8\u5e94\u7684\u76ee\u7684\u5730\u3002\n\n\u56de\u987e\u6700\u5c0f\u8d39\u7528\u6700\u5927\u6d41\u7684\u4ee3\u7801\uff0c\u73b0\u9700\u8981\u627e\u5230\u4e00\u6761\u4ece $s\\to t$ \u7684\u589e\u5e7f\u8def\u3002\n\n\u800c\u53ea\u6709\u70b9 $i$ \u6ee1\u8db3 $s$ \u4e0e $i$ \u7684\u6b8b\u4f59\u6d41\u91cf\u975e $0$\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u627e\u5230 $i\\to t$ \u7684\u589e\u5e7f\u8def\u3002\u4e5f\u5c31\u662f\u8ddd\u79bb $i$ \u6700\u77ed\uff0c\u5e76\u4e14\u8fd8\u6709\u98df\u7269\u7684\u70b9\u3002\n\n\u8003\u8651 $\\texttt{DP}$\u3002\n\n\u6211\u4eec\u8bbe $f_i$ \u8868\u793a\u7b2c $i$ \u4e2a\u70b9\u5230\u5b83\u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u7684\u4e00\u4e2a\u8fd8\u6709\u98df\u7269\u70b9\u7684\u6700\u8fd1\u70b9\u7684\u8ddd\u79bb\uff0c$g_i$ \u8868\u793a\u76f8\u5e94\u7684\u70b9\u7684\u7f16\u53f7\u3002\n\n\u5b50\u6811\u5916\u7684\u70b9\u662f\u65e0\u6cd5\u8fdb\u884c $\\texttt{DP}$ \u7684\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u66b4\u529b\u5411\u4e0a\u8df3\u7236\u4eb2\uff0c\u56e0\u4e3a\u8fd9\u662f\u4e00\u68f5\u5b8c\u5168\u4e8c\u53c9\u6811\uff0c\u6811\u9ad8\u662f $\\log n$ \u7684\u3002\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u7236\u4eb2 $j$ \u5c06 $f_i$ \u5bf9 $f_j$ \u8fdb\u884c\u66f4\u65b0\u3002\u590d\u6742\u5ea6\u662f $\\Theta(\\log n)$ \u7684\u3002\n\n\u7b2c\u4e00\u6b65\uff0c\u6211\u4eec\u5148\u627e\u5230\u8ddd\u79bb $i$ \u6700\u8fd1\u7684\u70b9\uff0c\u8bbe\u4e3a $v$\uff0c\u5e76\u6c42\u51fa $v$ \u5bf9\u5e94\u7684 $i$ \u7684\u7956\u5148 $u$\uff0c\u7d2f\u8ba1\u8def\u5f84\u8ddd\u79bb\u3002\n\n\u4e4b\u540e\u5bf9\u4e8e $i\\to u$ \u8def\u5f84\u4e0a\u7684\u6240\u6709\u8fb9\u5bb9\u91cf\u51cf\u4e00\uff0c\u5e76\u66b4\u529b\u4fee\u6539 $f$ \u548c $g$ \u7684\u503c\u3002\u5f53\u7136 $v\\to u$ \u8def\u5f84\u4e0a\u4e5f\u5e94\u8be5\u8fdb\u884c\u76f8\u5e94\u7684\u4fee\u6539\uff0c\u53ea\u4e0d\u8fc7\u6d41\u91cf\u52a0\u4e00\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd9\u91cc\u8d70\u7684\u662f\u53cd\u5411\u8fb9\u3002\n\n\u6700\u540e\u66b4\u529b\u4ece $u$ \u8df3\u6839\u4fee\u6539\u5373\u53ef\u3002",
        "postTime": 1650599783,
        "uid": 360511,
        "name": "UperFicial",
        "ccfLevel": 0,
        "title": "\u9898\u89e3\u3010P6122 [NEERC2016]Mole Tunnels\u3011"
    },
    {
        "content": "\u5206\u6790\uff1a\n\n\u8003\u8651\u4e00\u4e2a\u8d2a\u5fc3\uff0c\u6211\u4eec\u6bcf\u6b21\u90fd\u628a\u9f39\u9f20\u9001\u5230\u79bb\u5b83\u6700\u8fd1\u7684\u8fd8\u53ef\u4ee5\u5c45\u4f4f\u7684\u6d1e\u91cc\u3002\u4f46\u662f\uff0c\u6709\u4e00\u4e2a\u663e\u7136\u95ee\u9898\u662f\u6211\u4eec\u6ca1\u6cd5\u5904\u7406\u4e4b\u524d\u7684\u9f39\u9f20\u5bf9\u540e\u7eed\u7684\u5f71\u54cd\u3002\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u8003\u8651\uff1a\u6bcf\u5f53\u4e00\u540d\u9f39\u9f20\u7ecf\u8fc7\u4e00\u6761\u6811\u8fb9\uff0c\u6211\u4eec\u5c31\u5c06\u5176\u8bbe\u7f6e\u4e00\u6761\u53cd\u65b9\u5411\u7684\u6743\u4e3a -1 \u7684\u8fb9\uff0c\u8868\u793a\u5982\u679c\u6709\u9f39\u9f20\u53cd\u5411\u7ecf\u8fc7\uff0c\u5219\u4f1a\u62b5\u6d88\u5176\u5f71\u54cd\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5148\u626b\u4e00\u904d\u6574\u68f5\u6811\uff0c\u7528 $f(i)$ \u8868\u793a\u5728 $i$ \u7684\u5b57\u6570\u4e2d\u8ddd\u79bb $i$ \u6700\u8fd1\u7684\u70b9\u5230 $i$ \u7684\u8ddd\u79bb\uff0c$g[i]$ \u8868\u793a\u5728 $i$ \u7684\u5b50\u6811\u4e2d\u8ddd\u79bb $i$ \u6700\u8fd1\u7684\u70b9\u7684\u4f4d\u7f6e\uff0c\u8fd9\u4e24\u4e2a\u6570\u7ec4\u7684\u7ef4\u62a4\u6211\u4eec\u90fd\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u4ed6\u4eec\u7684\u5b50\u6811\u4fe1\u606f\u5f97\u5230\uff1a \n\n```\nf[i]=min{f[v]|v\u2208i\u7684\u513f\u5b50\u70b9\u96c6}\ng[i]=f\u8f6c\u79fb\u7528\u5230\u7684\u90a3\u4e2av\n```\n\n\u67e5\u8be2\u6700\u77ed\u8def\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4ece $p[i]$ \u5411\u4e0a\u904d\u5386 $p[i]$ \u7684\u6240\u6709\u7956\u5148\uff0c\u540c\u65f6\u7ef4\u62a4\u7ecf\u8fc7\u7684\u8ddd\u79bb\uff0c\u4e0d\u65ad\u7528\u5f53\u524d\u8282\u70b9\u7684 $f$ \u503c\u52a0\u4e0a\u722c\u4e0a\u6765\u7684\u8ddd\u79bb\u66f4\u65b0\u6700\u77ed\u8def\u7b54\u6848\uff0c\u6700\u540e\uff0c\u5229\u7528\u4e0a\u9762\u63d0\u5230\u7684\u8f6c\u79fb\u5f0f\u91cd\u6784\u8def\u5f84\u4e0a\u7684\u6240\u6709\u7ed3\u70b9\u7684 $f$ \u548c $g$ \u503c\uff0c\u5e76\u4e14\u4e3a\u6cbf\u9014\u7684\u8def\u5f84\u6253\u4e0a\u6807\u8bb0\u3002\u7531\u4e8e\u5bf9\u4e8e\u4efb\u610f\u7684 $i>1$\uff0c\u7b2c $i$ \u4e2a\u6d1e\u90fd\u4f1a\u548c\u7b2c $\\lfloor \\frac{i}{2} \\rfloor$ \u4e2a\u6d1e\u95f4\u6709\u4e00\u6761\u96a7\u9053\u7684\u9898\u8bbe\u6761\u4ef6\u4fdd\u8bc1\u4e86\u8fd9\u68f5\u6811\u662f\u4e00\u4e2a\u5b8c\u5168\u4e8c\u53c9\u6811\uff0c\u4e5f\u5c31\u662f\u6811\u9ad8\u6700\u591a\u4e3a $\\log_2n$\uff0c\u4e14\u6bcf\u4e2a\u70b9\u81f3\u591a\u6709 2 \u4e2a\u513f\u5b50\uff0c\u6240\u4ee5\u8fd9\u4e2a\u8d2a\u5fc3\u52a0\u4e0a\u66b4\u529b\u590d\u6742\u5ea6\u662f $O(n\\log n)$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\nfor(int i=n;i>=1;i--){\n\t\tif(c[i]) f[i]=0,g[i]=i;\n\t\tif(f[i>>1]>f[i]+1) f[i>>1]=f[i]+1,g[i>>1]=g[i]; \n\t}\n\tfor(int i=1;i<=m;i++){\n\t\tcin>>p[i];\n\t\tminn=1<<30,sum=0;\n\t\tfor(int j=p[i];j;j>>=1){\n\t\t\tif(f[j]+sum<minn) minn=f[j]+sum,pos=g[j],lca=j;\n\t\t\tsum+=(v[j][0]>0)?(-1):1;\n\t\t}\n\t\tans+=minn;\n\t\tcout<<ans;\n\t\tif(i!=m) cout<<' ';\n\t\tc[pos]--;\n\t\tfor(int j=p[i];j!=lca;j>>=1) v[j][0]?v[j][0]--:v[j][1]++;\n\t\tfor(int j=pos;j!=lca;j>>=1) v[j][1]?v[j][1]--:v[j][0]++;\n\t\tfor(int j=p[i];j!=lca;j>>=1){\n\t\t\tf[j]=1<<30;\n\t\t\tif(c[j]&&0<f[j]) f[j]=0,g[j]=j;\n\t\t\tif((j<<1)<=n&&f[j<<1|1]+(v[j<<1][1]?-1:1)<f[j]){\n\t\t\t\tf[j]=f[j<<1]+(v[j<<1][1]?-1:1);\n\t\t\t\tg[j]=g[j<<1];\n\t\t\t} \n\t\t\tif((j<<1|1)<=n&&f[j<<1|1]+(v[j<<1|1][1]?-1:1)<f[j]){\n\t\t\t\tf[j]=f[j<<1|1]+(v[j<<1|1][1]?-1:1);\n\t\t\t\tg[j]=g[j<<1|1];\n\t\t\t}\n\t\t}\n\t\tfor(int j=pos;j;j>>=1){\n\t\t\tf[j]=1<<30;\n\t\t\tif(c[j]&&0<f[j]) f[j]=0,g[j]=j;\n\t\t\tif((j<<1)<=n&&f[j<<1]+(v[j<<1][1]?-1:1)<f[j]){\n\t\t\t\tf[j]=f[j<<1]+(v[j<<1][1]?-1:1);\n\t\t\t\tg[j]=g[j<<1];\n\t\t\t}\n\t\t\tif((j<<1|1)<=n&&f[j<<1|1]+(v[j<<1|1][1]?-1:1)<f[j]){\n\t\t\t\tf[j]=f[j<<1|1]+(v[j<<1|1][1]?-1:1);\n\t\t\t\tg[j]=g[j<<1|1];\n\t\t\t}\n\t\t}\n\t}\n```\n",
        "postTime": 1648448273,
        "uid": 577670,
        "name": "KevinSHW007",
        "ccfLevel": 0,
        "title": "P6122 [NEERC2016]Mole Tunnels"
    }
]