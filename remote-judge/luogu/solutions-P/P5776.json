[
    {
        "content": "\u4f5c\u4e3a\u4e00\u9053\u6c42\u5305\u542b\u6240\u6709\u70b9\u7684\u6700\u5c0f\u6743\u8fb9\u53cc\u8fde\u901a\u5b50\u56fe\u7684\u72b6\u538b DP \u9898\uff0c\u505a\u6cd5\u4e0e\u5176\u5f3a\u8fde\u901a\u5206\u91cf\u7248\u672c https://codeforces.ml/gym/102759/problem/C \u662f\u8fd1\u4e4e\u4e00\u6837\u7684\u3002\n\n\u9996\u5148\u6211\u4eec\u9700\u8981\u4e86\u89e3 **\u8033\u5206\u89e3**\u3002\n\n\u8fd9\u91cc\u8fd9\u6837\u5b9a\u4e49\u8033\uff08\u4e0d\u77e5\u9053\u662f\u5426\u6807\u51c6\uff09\uff1a\u5bf9\u4e8e\uff08\u5f3a\uff09\u8fde\u901a\u56fe $G$\uff0c\u8033\u662f\u4e00\u6761\u8def\u5f84 $a_1\\to \\ldots\\to a_m$\uff0c\u6ee1\u8db3 $a_1,\\ldots,a_{m-1}$ \u4e24\u4e24\u4e0d\u540c\u4e14 $a_2,\\ldots,a_m$ \u4e24\u4e24\u4e0d\u540c\uff08\u4e5f\u5c31\u662f\u8bf4\u662f\u4e00\u6761\u7b80\u5355\u8def\u5f84\u6216\u7b80\u5355\u5708\uff09\uff0c\u5e76\u4e14 $a_2,\\ldots,a_{m-1}$ \u7684\u5ea6\u6570\u90fd\u4e3a $2$\uff0c\u5e76\u4e14\u5220\u9664\u8fd9\u4e0a\u9762\u6240\u6709\u8fb9\u540e\u4e0d\u5f71\u54cd $a_2,\\ldots,a_{m-1}$ \u4ee5\u5916\u70b9\u7684\uff08\u5f3a\uff09\u8fde\u901a\u6027\u3002\n\n\u5b9a\u4e49\u4e00\u5f20\u56fe\u662f\u53ef\u8033\u5206\u89e3\u7684\uff0c\u5f53\u4e14\u4ec5\u5f53\u53ef\u4ee5\u6bcf\u6b21\u4ece\u4e2d\u5220\u53bb\u4e00\u4e2a\u8033\uff0c\u5e76\u4e14\u6700\u7ec8\u6240\u6709\u8fb9\u90fd\u88ab\u5220\u9664\u3002\n\n\u6211\u4eec\u6709\u5982\u4e0b\u5b9a\u7406\uff1a\n\n**\u4e00\u5f20\u6709\u5411\u56fe\u662f\u53ef\u8033\u5206\u89e3\u7684\uff0c\u5f53\u4e14\u4ec5\u5f53\u5b83\u5f3a\u8fde\u901a\u3002**\n\n**\u4e00\u5f20\u65e0\u5411\u56fe\u662f\u53ef\u8033\u5206\u89e3\u7684\uff0c\u5f53\u4e14\u4ec5\u5f53\u5b83\u8fb9\u53cc\u8054\u901a\u3002**\n\n\u4e0a\u4e00\u6761\u5b9a\u7406\u662f\u7528\u6765\u505a\u90a3\u9053 open cup \u9898\u7684\uff0c\u800c\u4e0b\u4e00\u6761\u5219\u662f\u505a\u672c\u9898\u7684\u3002\n\n\u4e8e\u662f\u6211\u4eec\u6709\u4e00\u4e2a naive \u7b97\u6cd5\uff0c\u5012\u505a\u8033\u5206\u89e3\uff0c\u5f80\u4e00\u4e2a\u7a7a\u56fe\u4e2d\u4e0d\u65ad\u52a0\u8033\u3002\n\n\u4ee4 $f(S)$ \u8868\u793a\u5305\u542b\u96c6\u5408 $S$ \u4e2d\u6240\u6709\u70b9\u7684\u6700\u5c0f\u6743\u53cc\u8fde\u901a\u5206\u91cf\uff0c\u679a\u4e3e\u4e0e $S$ \u4e0d\u4ea4\u7684\u70b9\u96c6 $T$\uff0c\u5c06 $T$ \u8fde\u6210\u8033\u540e\u4e24\u7aef\u4e0e $S$ \u4e2d\u7684\u67d0\u4e24\u4e2a\u70b9\u8fde\u63a5\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(3^n\\times \\operatorname{poly}(n))$\u3002\n\n\u4f46\u662f naive \u7b97\u6cd5\u8fd8\u662f naive \u7b97\u6cd5\uff0c\u5c31\u7b97\u80fd\u8fc7\u8fd9\u9898\u4e5f\u8fc7\u4e0d\u4e86\u90a3\u4e2a\u6709\u5411\u56fe\u7248\u672c\uff0c\u6211\u4eec\u8fdb\u884c\u4e00\u4e2a\u4f18\u5316\u3002\n\n\u4e0a\u9762\u5c06\u8033\u770b\u505a\u4e86\u4e00\u4e2a\u6574\u4f53\uff0c\u4f46\u6211\u4eec\u4e0d\u59a8\u5c06\u8033\u9010\u6b65\u52a0\u5165\uff0c\u5177\u4f53\u5730\uff0c\u4ee4 $f(S,i,j)$ \u8868\u793a\u5f53\u524d\u8003\u8651\u4e86 $S$ \u4e2d\u7684\u70b9\uff0c\u4f46\u662f $S$ \u4e2d\u6700\u540e\u52a0\u5165\u7684\u4e00\u4e2a\u8033\u8fd8\u662f\u4e0d\u5b8c\u6574\u7684\uff0c\u8033\u4f38\u51fa\u53bb\u90e8\u5206\u7684\u4e00\u4e2a\u7aef\u70b9\u662f $i$\uff0c\u6700\u7ec8\u9700\u8981\u4e0e $j$ \u8fde\u63a5\u4e0a\uff0c\u6b64\u65f6\u5df2\u7ecf\u52a0\u5165\u7684\u6240\u6709\u8fb9\u7684\u6700\u5c0f\u6743\u503c\u548c\u3002\n\n\u90a3\u4e48\u8f6c\u79fb\u53ea\u8981\u6bcf\u6b21\u679a\u4e3e\u8033\u4e0a $i$ \u7684\u540e\u7ee7\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(2^n\\times \\operatorname{poly}(n))$\uff0c\u6ce8\u610f\u5b9e\u73b0\u7ec6\u8282\u3002\n\n\u76ee\u524d\u8fd9\u4efd\u4ee3\u7801\u662f\u672c\u9898\u6700\u4f18\u89e3\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nint t,n,m,x,y,z,d[20][20][2],dp[1<<12][14][14][2],f[1<<12];\nint main () {\n\tscanf(\"%d\",&t);\n\tfor (int ii=1;ii<=t;ii++) {\n\t\tmemset(d,0x2f,sizeof(d));\n\t\tmemset(dp,0x2f,sizeof(dp));\n\t\tmemset(f,0x2f,sizeof(f));\n\t\tscanf(\"%d%d\",&n,&m);\n\t\tfor (int i=1;i<=m;i++) {\n\t\t\tscanf(\"%d%d%d\",&x,&y,&z);\n\t\t\tx--,y--;\n\t\t\tif (z<d[x][y][0]) {d[x][y][1]=d[x][y][0],d[x][y][0]=z;}\n\t\t\telse if (z<d[x][y][1]) {d[x][y][1]=z;}\n\t\t\tswap(x,y);\n\t\t\tif (z<d[x][y][0]) {d[x][y][1]=d[x][y][0],d[x][y][0]=z;}\n\t\t\telse if (z<d[x][y][1]) {d[x][y][1]=z;}\n\t\t}\n\t\tfor (int i=0;i<n;i++) {f[1<<i]=0;}\n\t\tfor (int i=1;i<(1<<n);i++) {\n\t\t\tfor (int j=0;j<n;j++) {\n\t\t\t\tif (!(i&(1<<j))) {continue;}\n\t\t\t\tfor (int k=0;k<n;k++) {\n\t\t\t\t\tif (!(i&(1<<k))) {continue;}\n\t\t\t\t\tf[i]=min(f[i],dp[i][j][k][1]+d[j][k][0]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (f[i]<0x2f2f2f2f) {\n\t\t\t\tfor (int j=0;j<n;j++) {\n\t\t\t\t\tif (i&(1<<j)) {continue;}\n\t\t\t\t\tfor (int k=0;k<n;k++) {\n\t\t\t\t\t\tif (!(i&(1<<k))) {continue;}\n\t\t\t\t\t\tf[i|(1<<j)]=min(f[i|(1<<j)],f[i]+d[j][k][0]+d[j][k][1]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (int j=0;j<n;j++) {\n\t\t\t\t\tif (!(i&(1<<j))) {continue;}\n\t\t\t\t\tfor (int k=0;k<n;k++) {\n\t\t\t\t\t\tif (!(i&(1<<k))) {continue;}\n\t\t\t\t\t\tfor (int l=0;l<n;l++) {\n\t\t\t\t\t\t\tif (i&(1<<l)) {continue;}\n\t\t\t\t\t\t\tdp[i|(1<<l)][l][k][0]=min(dp[i|(1<<l)][l][k][0],f[i]+d[j][l][0]);\n\t\t\t\t\t\t\tif (j!=k) {f[i|(1<<l)]=min(f[i|(1<<l)],f[i]+d[j][l][0]+d[k][l][0]);}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (int j=0;j<n;j++) {\n\t\t\t\tif (!(i&(1<<j))) {continue;}\n\t\t\t\tfor (int k=0;k<n;k++) {\n\t\t\t\t\tif (!(i&(1<<k))) {continue;}\n\t\t\t\t\tif (min(dp[i][j][k][0],dp[i][j][k][1])==0x2f2f2f2f) {continue;}\n\t\t\t\t\tfor (int l=0;l<n;l++) {\n\t\t\t\t\t\tif (i&(1<<l)) {continue;}\n\t\t\t\t\t\tdp[i|(1<<l)][l][k][1]=min(dp[i|(1<<l)][l][k][1],\n\t\t\t\t\t\tmin(dp[i][j][k][0],dp[i][j][k][1])+d[j][l][0]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (f[(1<<n)-1]==0x2f2f2f2f) {printf(\"impossible\\n\");}\n\t\telse {printf(\"%d\\n\",f[(1<<n)-1]);}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1639644157,
        "uid": 113546,
        "name": "ix35",
        "ccfLevel": 10,
        "title": "[SNOI 2013] Quare"
    },
    {
        "content": "### \u524d\u7f6e\u77e5\u8bc6\n**\u8033\u5206\u89e3**\n\n\u611f\u89c9\u8033\u5206\u89e3\u7684\u5b9a\u4e49 ix35 \u8bb2\u5f97\u5f88\u6e05\u695a\u4e86\uff0c~~\u6765\u590d\u8bfb\u4e00\u4e0b~~\u3002\n\n\u5b9a\u4e49\uff08\u5f3a\uff09\u8fde\u901a\u56fe\u4e2d\u7684**\u8033**\u4e3a\u4e00\u6761\u8def\u5f84 $a,(a_1,a_2,\\cdots,a_m)$\uff0c\u6ee1\u8db3\u5176\u4e3a\u4e00\u6761\u7b80\u5355\u8def\u5f84\u6216\u4e00\u4e2a\u7b80\u5355\u73af\uff0c\u5220\u9664\u8be5\u8def\u5f84\u4e0a\u7684\u6240\u6709\u8fb9\u540e\u4e0d\u5f71\u54cd\u9664 $a_2,a_3,\\cdots,a_{m-1}$ \u4e4b\u5916\u70b9\u7684\uff08\u5f3a\uff09\u8fde\u901a\u6027\u3002\n\n\u4e0d\u52a0\u8bc1\u660e\u7684\u7ed9\u51fa\u4e0b\u8ff0\u4e24\u4e2a\u5b9a\u7406\uff1a\n\n1. \u4e00\u5f20\u6709\u5411\u56fe\u662f\u53ef\u8033\u5206\u89e3\u7684\uff0c\u5f53\u4e14\u4ec5\u5f53\u5b83\u5f3a\u8fde\u901a\u3002\n\n2. \u4e00\u5f20\u65e0\u5411\u56fe\u662f\u53ef\u8033\u5206\u89e3\u7684\uff0c\u5f53\u4e14\u4ec5\u5f53\u5b83\u8fb9\u53cc\u8054\u901a\u3002\n\n### $\\texttt{Solution}$\n\u539f\u9898\u5373\u6c42\u5305\u542b\u6240\u6709\u70b9\u7684\u6700\u5c0f\u6743\u8fb9\u53cc\u8fde\u901a\u5b50\u56fe\u3002\n\n\u5b58\u5728\u4e00\u4e2a\u5148\u628a\u8033 DP \u51fa\u6765\uff0c\u518d\u679a\u4e3e\u5b50\u96c6\u5408\u5e76\u7684 $O(3^n\\text{poly}(n))$ \u7684\u505a\u6cd5\uff0c\u8fd9\u91cc\u4e0d\u4e88\u5c55\u5f00\u3002\n\n\u91cd\u70b9\u6765\u8bb2 $O(2^nn^3)$ \u7684\u505a\u6cd5\u3002\n\n\u8bbe\u8ba1\u8fd9\u6837\u4e00\u4e2a DP \u72b6\u6001\uff1a$f_S$ \u8868\u793a\u5c06\u96c6\u5408 $S$ \u8fde\u6210\u8fb9\u53cc\u8054\u901a\u56fe\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u6211\u4eec\u8bd5\u56fe\u589e\u91cf\u52a0\u5165\u8033\uff0c\u8bbe\u8ba1\u4e00\u4e2a\u8f85\u52a9 DP $g_{S,x,y}$ \u8868\u793a\u8003\u8651\u4e86\u96c6\u5408 $S$\uff0c\u6b63\u5728\u5904\u7406\u4e00\u4e2a\u8033\uff0c\u8be5\u8033\u7684\u8def\u5f84\u5df2\u7ecf\u8d70\u5230\u70b9 $x$\uff0c\u76ee\u6807\u8d70\u5230\u70b9 $y$\u3002\n\n\u8f6c\u79fb\u8f83\u4e3a\u590d\u6742\uff1a\n1. \u5bf9\u4e8e\u8033\uff0c\u5f62\u5982 $x\\to y\\to x$ \u7684\u60c5\u51b5\u9700\u8981\u7279\u6b8a\u5904\u7406\uff08\u8d70 $(x,y)$ \u7684\u6700\u77ed\u8fb9\u548c\u6b21\u77ed\u8fb9\uff09\uff0c\u6211\u4eec\u76f4\u63a5\u8f6c\u79fb $f$\u3002\n\t```cpp\n\tfor(int x=0;x<n;x++){\n\t    if((s>>x)&1)continue;\n\t    for(int y=0;y<n;y++){\n\t        if(!((s>>y)&1))continue;\n\t        if(e[x][y].se==inf)continue;\n\t        chkmn(f[s|(1<<x)],f[s]+e[x][y].fi+e[x][y].se);\n\t    }\n\t}\n\n\t```\n2. \u5f00\u59cb\u8f6c\u79fb\u4e00\u4e2a\u8033\uff0c\u679a\u4e3e\u8d77\u70b9 $z$ \u548c\u7ec8\u70b9 $y$\uff0c\u6ee1\u8db3 $z,y\\in S$\uff0c\u679a\u4e3e\u8d70\u51fa\u7684\u7b2c\u4e00\u6b65 $x$\uff0c\u6ee1\u8db3 $x\\not\\in S$\u3002\n   \n   \u7279\u522b\u7684\uff0c$z,y$ \u76f8\u540c\u7684\u60c5\u51b5\u4e0b\u7531\u4e8e\u6211\u4eec\u4e0d\u80fd\u8ba9\u8f6c\u79fb\u5728 $x$ \u4e0b\u4e00\u6b65\u76f4\u63a5\u56de\u5230 $z$\uff0c\uff08\u8fd9\u4e2a\u60c5\u51b5\u5df2\u5728 Case 1 \u4e2d\u8003\u8651\uff09\uff0c\u6211\u4eec\u5bf9 $S$ \u52a0\u5165 $x$ \u4ee5\u89c4\u907f\u8fd9\u6837\u7684\u8f6c\u79fb\uff08\u8fce\u5408\u8f6c\u79fb 3\uff09\u3002\n   ```cpp\n   for(int x=0;x<n;x++){\n       if((s>>x)&1)continue;\n       for(int y=0;y<n;y++){\n           if(!((s>>y)&1))continue;\n           for(int z=0;z<n;z++){\n               if(!((s>>z)&1))continue;\n               if(e[z][x].fi==inf)continue;\n               if(y!=z)chkmn(g[s][x][y],f[s]+e[z][x].fi);\n               else chkmn(g[s|(1<<x)][x][y],f[s]+e[z][x].fi);\n           }\n       }\n   }\n\n   ```\n3. \u8f6c\u79fb $g_{S,x,y}$\uff0c\u679a\u4e3e\u5176\u4e0b\u4e00\u6b65 $z$\uff0c\u6ee1\u8db3 $y\\in S,z\\not\\in S$\uff0c\u6211\u4eec\u5e0c\u671b\u53ea\u6709 $x\\not\\in S$ \u7684 $g_{S,x,y}$ \u8f6c\u79fb\u56de $f$\uff0c\u6240\u4ee5\u9664\u8033\u7684\u7b2c\u4e00\u6b65\uff0c\u5176\u5b83\u65f6\u5019\u6211\u4eec\u5747\u4fdd\u6301 $g_{S,x,y}$ \u4e2d\u6709 $x\\not\\in S$\u3002\n   \n   \u6545\u8f6c\u79fb 2 \u4e2d\u5c06 $S$ \u52a0\u5165 $x$ \u53ef\u4ee5\u907f\u514d\u4e00\u6b65\u56de\u5230 $z$\u3002\n   ```cpp\n   for(int x=0;x<n;x++){\n       for(int y=0;y<n;y++){\n           if(!((s>>y)&1)||x==y)continue;\n           if(g[s][x][y]==inf)continue;\n           for(int z=0;z<n;z++){\n               if(((s>>z)&1)||x==z)continue;\n               if(e[x][z].fi==inf)continue;\n               chkmn(g[s|(1<<x)][z][y],g[s][x][y]+e[x][z].fi);\n           }\n       }\n   }\n\n   ```\n4. \u7ed3\u675f\u4e00\u4e2a\u8033\uff0c\u4ece $g_{S,x,y}$ \u8f6c\u79fb\u5230 $f_{S+x}$  \u4e2d\u3002\n   ```cpp\n   for(int x=0;x<n;x++){\n       if((s>>x)&1)continue;\n       for(int y=0;y<n;y++){\n           if(!((s>>y)&1))continue;\n           chkmn(f[s|(1<<x)],g[s][x][y]+e[x][y].fi);\n       }\n   }\n\n   ```\n\n\u590d\u6742\u5ea6\u663e\u7136\u4e3a $O(2^nn^3)$\u3002\n\n\u5173\u952e\u4ee3\u7801\u5df2\u7ecf\u5168\u90e8\u7ed9\u51fa\uff0c\u4e0d\u653e\u5b8c\u6574\u4ee3\u7801\u4e86\u3002",
        "postTime": 1657339525,
        "uid": 98527,
        "name": "juju527",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5776 \u3010[SNOI2013]Quare\u3011"
    },
    {
        "content": "\u795e\u4ed9\u72b6\u538bdp\u9898\uff08\n\n\u9898\u610f\u5373\u4e3a\u6c42\u8fb9\u6743\u548c\u6700\u5c0f\u7684\u8fb9\u53cc\u5b50\u56fe\n\n\u53d1\u73b0\u8fd9\u4e2a $n$ \u5f88\u5c0f\uff0c\u5f88\u9002\u5408\u72b6\u538b\u70b9\u96c6\n\n\u4e8e\u662f\u6211\u4eec\u8bbe $f_s$ \u4e3a $s$ \u96c6\u5408\u7684\u70b9\u6784\u6210\u70b9\u53cc\u7684\u6700\u5c0f\u4ee3\u4ef7\n\n\u8003\u8651\u5c06\u4e00\u4e2a\u65b0\u7684\u96c6\u5408 $t$ \u52a0\u5165 $s$ \u6240\u5e26\u6765\u7684\u6700\u5c0f\u4ee3\u4ef7\n\n\u6709\u4e00\u4e2a\u7ed3\u8bba\uff0c\u8fd9\u4e2a\u6700\u5c0f\u4ee3\u4ef7\u5fc5\u7136\u662f\u628a $t$ \u4e2d\u7684\u70b9\u8fde\u6210\u4e00\u6761\u94fe\u7136\u540e\u628a\u94fe\u7684\u4e24\u7aef\u70b9\u63a5\u5165 $s$\n\n\u4f46\u662f\u8fd8\u6709\u4e2a\u7279\u4f8b\uff0c\u5373 $t$ \u4e2d\u53ea\u6709\u4e00\u4e2a\u70b9\uff0c\u8fd9\u65f6\u6211\u4eec\u53ea\u9700\u8981\u52a0\u5165 $t\\to s$ \u7684\u6700\u5c0f\u8fb9\u548c\u6b21\u5c0f\u8fb9\u5373\u53ef\n\n\u8bbe $e_{i,j,0/1}$ \u8868\u793a $i\\to j$ \u7684\u8fb9\u6743\u6700\u5c0f/\u6b21\u5c0f\u503c\uff0c$g_{s,i,0/1}$ \u8868\u793a\u70b9 $i$ \u8fde\u5165 $s$ \u7684\u8fb9\u7684\u8fb9\u6743\u6700\u5c0f/\u6b21\u5c0f\u503c\uff0c$h_{s,i,j}$ \u8868\u793a $s$ \u4e2d\u7684\u70b9\u8fde\u6210\u4e00\u6761\u94fe\uff0c\u94fe\u7aef\u70b9\u4e3a $i,j$ \u7684\u6700\u5c0f\u6743\u503c\u548c\n\n\u53d1\u73b0 $g$ \u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\uff0c$h_{s,i,j}=\\min_{k\\not =i}\\{h_{s-k,k,j}+e_{i,k,0}\\}$\n\n\u4e8e\u662f $f$ \u5c31\u53ef\u4ee5\u8f6c\u79fb\u4e86\n\n$f_{s}=\\min_{t\\subset s}\\{f_{s-t}+h_{s,i,j}+g_{s-t,i,0}+g_{s-t,j,0}\\}$\uff0c\u4e5f\u53ef\u4ee5\u53ea\u8f6c\u79fb\u8fdb\u4e00\u4e2a\u70b9 $f_s=\\min_{t\\in s}\\{f_{s-t}+g_{s-t,t,0}+g_{s-t,t,1}\\}$\n\n\u8ba1\u7b97 $g$ \u662f $\\mathcal O(2^nn^2)$ \u7684\uff0c\u8ba1\u7b97 $h$ \u662f $\\mathcal O(2^nn^3)$ \u7684\uff0c\u8ba1\u7b97 $f$ \u662f $\\mathcal O(3^nn^2)$\uff0c\u6240\u4ee5\u603b\u590d\u6742\u5ea6 $\\mathcal O(2^nn^3+3^nn^2)$\n\n\u6709\u4e2a\u7ec6\u8282\u5c31\u662f\u5982\u679c\u628a $f,g,h$ \u7684\u521d\u59cb\u503c\u5168\u90e8\u8bbe\u6210 `0x3f3f3f3f` \u7531\u4e8e $f$ \u8f6c\u79fb\u6709\u56db\u4e2a\u6570\u76f8\u52a0\uff0c\u6240\u4ee5\u53ef\u80fd\u4f1a\u7206 `int`\uff08\u5f00 `long long` \u4e5f\u6ca1\u7528\uff09\uff0c\u6240\u4ee5\u521d\u59cb\u503c\u8981\u5c0f\u4e8e `INT_MAX/4`\n\ncode:\n```cpp\n#include<bits/stdc++.h>\n#define MAXN 100\nusing namespace std;\nconst int inf=(0x7f7f7f7f)/5;\nint T,n,m;\nint e[MAXN][MAXN][2],h[1<<12][15][15];\nint f[1<<12],g[1<<12][15][2];\nint main(){\n\tscanf(\"%d\",&T);\n\twhile(T--){\n\t\tscanf(\"%d%d\",&n,&m);\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\te[i][j][0]=e[i][j][1]=inf;\n\t\tfor(int i=0;i<(1<<n);i++)f[i]=inf;\n\t\tfor(int i=0;i<(1<<n);i++)\n\t\t\tfor(int j=1;j<=n;j++)g[i][j][0]=g[i][j][1]=inf;\n\t\tfor(int i=0;i<(1<<n);i++)\n\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\tfor(int k=1;k<=n;k++)h[i][j][k]=inf;\n\t\tfor(int i=1;i<=m;i++){\n\t\t\tint u,v,w;scanf(\"%d%d%d\",&u,&v,&w);\n\t\t\tif(w<e[u][v][0])e[u][v][1]=e[u][v][0],e[u][v][0]=w;\n\t\t\telse if(w<e[u][v][1])e[u][v][1]=w;\n\t\t\te[v][u][0]=e[u][v][0];e[v][u][1]=e[u][v][1];\n\t\t}\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tfor(int s=0;s<(1<<n);s++){\n\t\t\t\tif(s&(1<<(i-1)))continue;\n\t\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\t\tif(s&(1<<(j-1))){\n\t\t\t\t\t\tif(e[i][j][0]<g[s][i][0])g[s][i][1]=g[s][i][0],g[s][i][0]=e[i][j][0];\n\t\t\t\t\t\telse if(e[i][j][0]<g[s][i][1])g[s][i][1]=e[i][j][0];\n\t\t\t\t\t\tif(e[i][j][1]<g[s][i][0])g[s][i][1]=g[s][i][0],g[s][i][0]=e[i][j][1];\n\t\t\t\t\t\telse if(e[i][j][1]<g[s][i][1])g[s][i][1]=e[i][j][1];\n\t\t\t\t\t}\n\t\t\t}\n\t\tfor(int i=1;i<=n;i++)h[1<<(i-1)][i][i]=0;\n\t\tfor(int s=0;s<(1<<n);s++)\n\t\t\tfor(int i=1;i<=n;i++){\n\t\t\t\tif(!(s&(1<<(i-1))))continue;\n\t\t\t\tfor(int j=1;j<=n;j++){\n\t\t\t\t\tif(!(s&(1<<(j-1))))continue;\n\t\t\t\t\tif(i==j)continue;\n\t\t\t\t\tfor(int k=1;k<=n;k++)\n\t\t\t\t\t\tif(k!=i&&(s&(1<<(k-1))))\n\t\t\t\t\t\t\th[s][i][j]=min(h[s][i][j],h[s^(1<<(i-1))][k][j]+e[i][k][0]);\n\t\t\t\t}\n\t\t\t}\n\t\tf[0]=0;\n\t\tfor(int i=1;i<=n;i++)f[1<<(i-1)]=0;\n\t\tfor(int s=1;s<(1<<n);s++){\n\t\t\tfor(int i=1;i<=n;i++)\n\t\t\t\tif(s&(1<<(i-1))){\n\t\t\t\t\tint ns=1<<(i-1);\n\t\t\t\t\tif(!(s^ns))break;\n\t\t\t\t\tf[s]=min(f[s],f[s^ns]+h[ns][i][i]+g[s^ns][i][0]+g[s^ns][i][1]);\n\t\t\t\t}\n\t\t\tfor(int t=(s-1)&s;t;t=(t-1)&s)\n\t\t\t\tfor(int i=1;i<=n;i++)\n\t\t\t\t\tif(t&(1<<(i-1)))\n\t\t\t\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\t\t\t\tif(i!=j&&(t&(1<<(j-1))))\n\t\t\t\t\t\t\t\tf[s]=min(f[s],f[s^t]+h[t][i][j]+g[s^t][i][0]+g[s^t][j][0]);\n\t\t}\n\t\tif(f[(1<<n)-1]>=inf)puts(\"impossible\");\n\t\telse printf(\"%d\\n\",f[(1<<n)-1]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1616423452,
        "uid": 65681,
        "name": "UltiMadow",
        "ccfLevel": 7,
        "title": "[\u9898\u89e3] P5776 [SNOI2013]Quare"
    },
    {
        "content": "**P5776**\n\n\u5982\u679c\u4f60\u4e0d\u77e5\u9053\u8033\u5206\u89e3\uff0c\u4f60\u53ef\u80fd\u4f1a\u5728\u505a\u6b64\u9898\u65f6\u5403\u5927\u4e8f\u3002\n\n\u53ef\u80fd\u4e0d\u5b8c\u5168\u4e25\u8c28\uff0c\u5efa\u8bae\u770b ix35 \u8bba\u6587\u539f\u6587\u3002\n\n\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u662f\u8fb9\u53cc\u7684\u539f\u56fe\uff0c\u6211\u4eec\u8ba4\u4e3a\u4ece\u4e00\u4e2a\u521d\u59cb\u5b50\u56fe\u4e3a\u7b80\u5355\u73af\u7684 $G_0$ \u5f00\u59cb\uff0c\u5bf9\u4e8e $G_i \\rightarrow G_{i + 1}$\uff0c\u4ece\u8fb9\u96c6\u7684\u8865\u96c6\u91cc\u9009\u4e00\u4e2a\u5f53\u4e14\u4ec5\u5f53\u8def\u5f84\u7aef\u70b9\u5728 $G_i$ \u4e2d\u7684\u8def\u5f84\u5e76\u5165 $G_i$ \u4e2d\u5f97\u5230 $G_{i + 1}$\uff0c\u6700\u540e\u53ef\u4ee5\u5f97\u5230\u539f\u56fe\u3002\n\n\u5bf9\u4e8e\u8fd9\u4e2a\u8def\u5f84\u5c31\u662f\u8033\uff0c\u6ce8\u610f\u8def\u5f84\u7aef\u70b9\u662f\u53ef\u91cd\u590d\u7684\uff0c\u5e76\u4e14\u4e00\u6761\u8fb9\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u53ea\u4f1a\u88ab\u52a0\u5165\u4e00\u6b21\u3002\n\n\u8fd9\u4e2a\u53ef\u4ee5\u8bc1\u660e\u5145\u8981\u6027\u3002\u7b80\u5355\u8bb2\u4e00\u4e0b\uff0c\u5fc5\u8981\u6027\u662f\u56e0\u4e3a\u4efb\u610f\u6bcf\u6b21\u62d3\u5c55\u52a0\u5165\u7684\u90fd\u5728\u539f\u56fe\u4e0a\u7ec4\u6210\u4e86\u4e00\u4e2a\u7b80\u5355\u73af\uff0c\u6240\u4ee5\u80af\u5b9a\u4e00\u76f4\u662f\u8fb9\u53cc\uff1b\n\n\u5145\u5206\u6027\u53ef\u4ee5\u8003\u8651\u6784\u9020\u4e00\u68f5 $1$ \u4e3a\u6839\u7684 dfs \u6811\uff0c\u521d\u59cb\u968f\u4fbf\u94a6\u5b9a\u4e00\u4e2a\u548c $1$ \u76f8\u8fde\u7684\u975e\u6811\u8fb9 $(1,x)$\uff0c\u5c06\u4e24\u70b9\u6811\u4e0a\u8def\u5f84\u548c\u8be5\u8fb9\u6784\u9020\u521d\u59cb\u7b80\u5355\u73af $G_0$\uff0c\u5728 $G_i$ \u7684\u70b9\u96c6 $V'$ \u672a\u6ee1\u79e9\u65f6\u6bcf\u6b21\u627e\u5230\u4e00\u4e2a dfs \u6811\u4e0a\u7236\u4eb2\u5728 $G_i$ \u4e14\u81ea\u5df1\u4e0d\u5728 $G_i$ \u4e2d\u7684\u70b9 $p$\uff08\u5728\u672a\u6ee1\u79e9\u524d\u663e\u7136\u5b58\u5728\u8fd9\u6837\u7684\u70b9\uff09\uff0c\u7136\u540e\u5b50\u6811\u5185\u968f\u4fbf\u627e\u4e00\u4e2a\u8fd4\u7956\u8fb9\uff0c\u8bbe\u5176\u8fde\u5411 $p$ \u7684\u7956\u5148 $u$ \u4ee5\u53ca $p$ \u7684\u5b50\u5b59 $v$\uff0c\u90a3\u4e48 $u$ \u5148\u8d70\u8fd4\u7956\u8fb9\u5230 $v$ \u7136\u540e\u8d70\u5230 $p$ \u7684\u7236\u4eb2\u53bb\u5c31\u662f\u4e00\u4e2a\u8033\uff1b\u5982\u679c $V'$ \u6ee1\u79e9\u4e86\u5c31\u6bcf\u6b21\u628a\u6240\u6709\u6ca1\u52a0\u8fdb\u7684\u8fb9\u6254\u8fdb\u53bb\u5c31\u884c\u4e86\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u8fd9\u6837\u4efb\u610f\u65f6\u523b\uff0c$G_i$ \u4e2d\u7684\u70b9\u90fd\u662f\u4e00\u4e2a\u548c $1$ \u8054\u901a\u7684\u8fde\u901a\u5757\u3002\u81ea\u7136\u662f\u5bf9\u7684\u3002\n\n\u8fd9\u53ea\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u9053\u9898\u800c\u505a\u7684\u524d\u7f6e\u77e5\u8bc6\uff0c\u5982\u679c\u4f60\u6ca1\u770b\u61c2\u5efa\u8bae\u53bb\u770b\u4e00\u4e0b ix35 \u539f\u6587\uff0c\u5f88\u597d\u7406\u89e3\u7684\u3002\n\n------------------------------------------------------\n\n\u56de\u5230\u8fd9\u9053\u9898\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u72b6\u538b dp \u6a21\u62df\u8033\u5206\u89e3\u3002\u7ef4\u62a4 $f(S)$ \u8868\u793a $S$ \u4e2d\u7684\u8282\u70b9\u6784\u6210\u8fb9\u53cc\u7684\u6700\u5c0f\u82b1\u8d39\uff0c\u7531\u4e8e\u662f\u6700\u5c0f\u82b1\u8d39\u6211\u4eec\u53ef\u4ee5\u4e0d\u8bb0\u5f55\u8fb9\u96c6\u7684\u9009\u62e9\u60c5\u51b5\uff0c\u56e0\u4e3a\u72b6\u538b dp \u7684\u8fc7\u7a0b\u80af\u5b9a\u80fd\u7b97\u5230\u6240\u6709\u53ef\u80fd\u51fa\u73b0\u7684\u5206\u89e3\u60c5\u51b5\uff0c\u91cd\u65b0\u7b97\u4e00\u6761\u8fb9\u4e00\u5b9a\u4e0d\u4f18\u3002\n\n\u4e00\u4e2a\u6bd4\u8f83\u663e\u7136\u7684\u8f6c\u79fb\u662f\u7ef4\u62a4\u4e00\u4e0b $E(T,x,y)$ \u8868\u793a\u70b9\u96c6\u4e3a $T$\uff0c\u4e14 $x,y \\in T$\uff0c\u4ece $x$ \u8d70\u5230 $y$ \u7ecf\u8fc7 $T$ \u4e2d\u6240\u6709\u70b9\u7684\u6700\u5c0f\u8fb9\u6743\u548c\u3002\n\n\u8f6c\u79fb\u7684\u65f6\u5019\u679a\u4e3e\u5b50\u96c6\uff0c\u4ee4 $f(S) \\leftarrow f(S/T) + \\min_{x,y \\in T} E(T,x,y) + \\min_{a,b\\in S/T} e_{a,x} + e_{b,y}$ \u5373\u53ef\u6a21\u62df\u4e00\u6b21\u52a0\u8033\u7684\u8fc7\u7a0b\u3002\n\n\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u76f4\u63a5\u679a\u4e3e\u4e00\u4e2a $E(T \\cup \\{a,b\\},a,b)$ \u6765\u7b97\uff0c\u6bdb\u59d1\u59d1\u4e0b\u6765\u53ef\u80fd\u662f $O(3 ^ n \\times n ^ 2)$\uff0c\u526a\u70b9\u679d\u80af\u5b9a\u8dd1\u7684\u5f88\u5feb\u3002\n\n\u66f4\u5feb\u7684\u7406\u8bba\u590d\u6742\u5ea6\u505a\u6cd5\u662f\u6211\u4eec\u5957\u8def\u5316\u7684\u4e0d\u4e00\u6b21\u52a0\u5b8c\u4e00\u4e2a\u8033\uff0c\u8bbe $dp(S,x,y)$ \u8868\u793a $S$ \u4e2d\u6709\u4e00\u90e8\u5206\u70b9\u6b63\u5728\u8fdb\u884c\u52a0\u8033\u7684\u6b65\u9aa4\uff0c\u5e76\u4e14\u5f53\u524d\u5df2\u7ecf\u52a0\u5230\u4e86 $x$\uff0c\u800c\u52a0\u8033\u7684\u8fc7\u7a0b\u5728\u672b\u7aef\u70b9\u662f $y$ \u65f6\u4f1a\u7ed3\u675f\u65f6\u7684\u6700\u5c0f\u8fb9\u6743\u548c\uff0c\u518d\u53bb\u8f6c\u79fb\u539f\u672c\u7684 $f(S)$\u3002\n\n\u53d1\u73b0\u4f60\u80af\u5b9a\u80fd\u505a\u5230 $O(2 ^ n \\times Poly(n))$ \u4e86\uff0c\u4e0d\u8fc7\u4f60\u53d1\u73b0\u6709\u5f88\u591a corner\uff1a\n\n- \u5b58\u5728\u76f4\u63a5\u5411\u5916\u4f38\u51fa\u4e00\u4e2a\u70b9\u540e\u56de\u6765\u7684\u60c5\u51b5\uff0c\u76f4\u63a5\u66b4\u529b\u679a\u4e3e\u89e3\u51b3\uff1b\n\n- \u7531\u4e8e $dp(S,x,y)$ \u53ea\u80fd\u8bb0\u5f55\u4e24\u4e2a\u8282\u70b9\uff0c\u8f6c\u79fb\u53ef\u80fd\u4f1a\u51fa\u73b0\u4ece\u539f\u672c\u5728 $G_i$ \u7684\u4e00\u4e2a\u8282\u70b9 $x$ \u8d70\u5230 $y$ \u53bb\u7ecf\u8fc7\u540c\u4e00\u6761\u8fb9\u8d70\u56de\u6765\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u8981\u591a\u8bbe\u4e00\u7ef4\uff0c\u5373 $dp(S,x,y,1/0)$ \u65b0\u589e\u4e00\u4e2a\u7ef4\u8868\u793a\u5f53\u524d\u52a0\u8033\u7684\u8fc7\u7a0b\u4e2d\uff0c$x$ \u662f/\u4e0d\u662f\u5f53\u524d\u8033\u6309\u7167\u679a\u4e3e\u987a\u5e8f\u4e0b\u7684\u7b2c\u4e8c\u4e2a\u8282\u70b9\u3002\n\n- \u7136\u540e\u5c31\u76f4\u63a5\u8ba9 $dp(S,x,y,1)$ \u624d\u80fd\u5411 $f$ \u6570\u7ec4\u66f4\u65b0\uff0c\u5176\u5b83\u8f6c\u79fb\u7167\u5e38\u5373\u53ef\u3002\u53d1\u73b0\u8fd9\u65f6\u5019\u4e5f\u4f1a\u5c11\u7b97\u201c\u4ece $G_i$ \u8d70\u51fa\u53bb\u627e\u5230\u4e00\u4e2a\u70b9\u7136\u540e\u53c8\u8d70\u56de\u4e00\u4e2a\u5728 $G_i$ \u4e2d\u4f46\u4e0d\u540c\u4e8e\u51fa\u53d1\u70b9\u201d\u7684\u60c5\u51b5\uff0c\u7167\u6837\u679a\u4e3e\u7b97\u5c31\u597d\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(2 ^ n \\times n ^ 3)$\uff0c\u81ea\u5df1\u7684\u4ee3\u7801 corner \u5224\u7684\u4e0d\u597d\u4e8e\u662f\u65e0\u803b\u5730\u8d3a\u4e86 ix35 \u7684\u4ee3\u7801\u3002\n\n```cpp\n#include \"bits/stdc++.h\"\nusing namespace std;\nconst int Len = (1 << 12) + 5 , Inf = 0x3f3f3f3f;\nint n,m,w[25][25][2],dp[Len][16][16][2],f[Len];\ninline void solve()\n{\n\tmemset(w , 0x3f , sizeof w);\n\tmemset(dp , 0x3f , sizeof dp);\n\tmemset(f , 0x3f , sizeof f);\n\tscanf(\"%d %d\",&n,&m);\n\tfor(int i = 1 ; i <= m ; i ++)\n\t{\n\t\tint x,y,ww;scanf(\"%d %d %d\",&x,&y,&ww);x -- , y --;\n\t\tif(w[x][y][0] > ww){w[x][y][1] = w[x][y][0];w[x][y][0] = ww;}\n\t\telse w[x][y][1] = min(w[x][y][1] , ww);\n\t\tswap(x , y);\n\t\tif(w[x][y][0] > ww){w[x][y][1] = w[x][y][0];w[x][y][0] = ww;}\n\t\telse w[x][y][1] = min(w[x][y][1] , ww);\n\t}\n\tfor(int i = 0 ; i < n ; i ++) f[1 << i] = 0;\n\tfor(int i = 1 ; i < (1 << n) ; i ++)\n\t{\n\t\t//printf(\"%d %d\\n\",i,f[i]);\n\t\tfor(int j = 0 ; j < n ; j ++)\n\t\t{\n\t\t\tif(!((i >> j) & 1)) continue;\n\t\t\tfor(int k = 0 ; k < n ; k ++) \n\t\t\t{\n\t\t\t\tif(!((i >> k) & 1)) continue;\n\t\t\t\tf[i] = min(f[i] , dp[i][j][k][1] + w[j][k][0]);\n\t\t\t}\n\t\t}\n\t\tif(f[i] < Inf)\n\t\t{\n\t\t\t//case 1:\u76f4\u63a5\u4f38\u51fa\u53bb\u4e00\u4e2a\u70b9\u540e\u56de\u6765\uff0c\u679a\u4e3e S \u5185\u7aef\u70b9\u548c\u4f38\u51fa\u53bb\u7684\u70b9 \n\t\t\tfor(int j = 0 ; j < n ; j ++)\n\t\t\t{\n\t\t\t\tif(!((i >> j) & 1)) continue;\n\t\t\t\tfor(int k = 0 ; k < n ; k ++)\n\t\t\t\t{\n\t\t\t\t\tif((i >> k) & 1) continue;\n\t\t\t\t\tf[i | (1 << k)] = min(f[i | (1 << k)] , f[i] + w[j][k][0] + w[j][k][1]);\t\n\t\t\t\t}\t\n\t\t\t}\n\t\t\t//case2:\u4f38\u51fa\u53bb\u4e00\u4e2a\u5e26\u4e2d\u8f6c\u70b9\u7684\u73af\uff0c\u4f9d\u6b21\u679a\u4e3e\u8fd9\u4e09\u4e2a\u70b9\uff0c\u987a\u4fbf \n\t\t\tfor(int j = 0 ; j < n ; j ++)//1,2,4,3 \u8fd9\u4e2a\u73af\u6ca1\u6709\u679a\u5230\u3002 \n\t\t\t{\n\t\t\t\tif(!((i >> j) & 1)) continue;\n\t\t\t\tfor(int k = 0 ; k < n ; k ++)\n\t\t\t\t{\n\t\t\t\t\tif((i >> k) & 1) continue;\n\t\t\t\t\tfor(int l = 0 ; l < n ; l ++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif(!((i >> l) & 1)) continue;\n\t\t\t\t\t\tdp[i | (1 << k)][k][l][0] = min(dp[i | (1 << k)][k][l][0] , f[i] + w[j][k][0]);\n\t\t\t\t\t\t//if((i | (1 << k)) == 11 && l == 0 && k == 3) printf(\"!!!%d\\n\",dp[i | (1 << k)][k][l][0]);\n\t\t\t\t\t\tif(j != l) f[i | (1 << k)] = min(f[i | (1 << k)] , f[i] + w[j][k][0] + w[k][l][0]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\t//case3:\u66b4\u529b\u8f6c\u79fb\n\t\t\tfor(int j = 0 ; j < n ; j ++)\n\t\t\t{\n\t\t\t\tif(!((i >> j) & 1)) continue;\n\t\t\t\tfor(int k = 0 ; k < n ; k ++)//\u679a\u4e3e\u7684\u8033\u7684\u53e6\u4e00\u4e2a\u7aef\u70b9 \n\t\t\t\t{\n\t\t\t\t\tif(!((i >> k) & 1)) continue;\n\t\t\t\t\tif(min(dp[i][j][k][0] , dp[i][j][k][1]) == Inf) continue;\n\t\t\t\t\tfor(int l = 0 ; l < n ; l ++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif((i >> l) & 1) continue;\n\t\t\t\t\t\tdp[i | (1 << l)][l][k][1] = min(dp[i | (1 << l)][l][k][1] , \n\t\t\t\t\t\tmin(dp[i][j][k][0] , dp[i][j][k][1]) + w[j][l][0]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\n\t}\n\tif(f[(1 << n) - 1] == Inf) puts(\"impossible\");\n\telse printf(\"%d\\n\",f[(1 << n) - 1]);\n}\nsigned main()\n{\n\tint T;scanf(\"%d\",&T);while(T --) solve();\n\treturn 0;\n}\n```",
        "postTime": 1678878867,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "\u8fd9\u7e41\u534e\u76db\u5f00\u4e4b\u5730 \u8774\u8776\u805a\u96c6\u76d8\u65cb\u4e0d\u53bb"
    },
    {
        "content": "\u6c42\u8fb9\u6743\u6700\u5c0f\u7684\u70b9\u96c6\u4e3a\u539f\u56fe\u70b9\u96c6\u7684\u8fb9\u53cc\u3002\u8003\u8651\u72b6\u538b\u3002\u4e00\u4e2a\u8fb9\u53cc\u53ef\u4ee5\u62c6\u6210\u4e00\u4e2a\u8fb9\u53cc\u52a0\u4e00\u6761\u94fe\uff0c\u4ee3\u4ef7\u6700\u5c0f\u5373\u4e3a\u94fe\u4e24\u7aef\u7684\u70b9\u8fde\u7ebf\u52a0\u5165\u8fd9\u4e2a\u8fb9\u53cc\u3002$f_{S}$ \u8868\u793a\u70b9\u96c6\u4e3a $S$ \u7684\u8fb9\u6743\u6700\u5c0f\u7684\u8fb9\u53cc\u3002\n\n\u8003\u8651\u8bbe\u51e0\u4e2a\u8f85\u52a9\u6570\u7ec4\u3002$c_{S,u,v}$ \u8868\u793a $S$ \u4e2d\u4ee5 $u,v$ \u4e3a\u7aef\u70b9\u7684\u94fe\u7684\u6700\u5c0f\u6743\u503c\u548c\uff0c$g_{S,u,0/1}$ \u8868\u793a\u5c06 $u$ \u8fde\u5230 $S$ \u4e2d\u53bb\u7684\u6700\u5c0f/\u6b21\u5c0f\u4ee3\u4ef7\u3002$g$ \u53ef\u4ee5\u66b4\u529b\u679a\u4e3e\uff0c$c$ \u6709 $c_{S,u,v}=\\min_{k\\neq i} h_{S-u,k,v}+w_{u,k}$\u3002\n$$\nf_{S}=\\min_{T\\subset S}\n\\begin{cases}\nf_{S-T}+c_{T,u,v}+g_{S-T,u,0}+g_{S-T,v,0} &|T|>1\\\\\nf_{S-T}+g_{S-T,u,0}+g_{S-T,u,1} &|T|=1\n\\end{cases}\n$$\n\u521d\u59cb\u503c\u6709\n$$\n\\begin{aligned}\nf_{\\{u\\}}=f_{\\varnothing}=0\\\\\nc_{\\{u\\},u,u}=0\\\\\n\\end{aligned}\n$$\n\n```cpp\n#define rep(i,a,b) for(register int i=(a);i<=(b);i++)\n#define per(i,a,b) for(register int i=(a);i>=(b);i--)\nusing namespace std;\nconst int SS=5009,N=19,inf=0x1f1f1f1f;\n\ninline long long read() {\n    register long long x=0, f=1; register char c=getchar();\n    while(c<'0'||c>'9') {if(c=='-') f=-1; c=getchar();}\n    while(c>='0'&&c<='9') {x=(x<<3)+(x<<1)+c-48,c=getchar();}\n    return x*f;\n}\n\nint T,n,m,S,w[N][N][2],c[SS][N][N],g[SS][N][2],f[SS];\n\nvoid cal_g() {\n\trep(s,0,S) {\n\t\trep(u,1,n) {\n\t\t\tif(s&(1<<u-1)) continue;\n\t\t\trep(i,1,n) if(u!=i&&(s&(1<<i-1))) {\n\t\t\t\tif(w[u][i][0]<g[s][u][1]) g[s][u][1]=w[u][i][0];\n\t\t\t\tif(g[s][u][1]<g[s][u][0]) swap(g[s][u][1],g[s][u][0]);\n\t\t\t\tif(w[u][i][1]<g[s][u][1]) g[s][u][1]=w[u][i][1];\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid cal_c() {\n\trep(i,1,n) c[1<<i-1][i][i]=0;\n\trep(s,0,S) {\n\t\tint cnt=0; rep(i,1,n) if(s&(1<<i-1)) cnt++; if(cnt<=1) continue;\n\t\trep(u,1,n) if(s&(1<<u-1)) {\n\t\t\trep(v,1,n) if(s&(1<<v-1)) {\n\t\t\t\trep(k,1,n) if(k!=u&&(s&(1<<k-1))) {\n\t\t\t\t\tc[s][u][v]=min(c[s][u][v],c[s-(1<<u-1)][k][v]+w[u][k][0]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid cal_f() {\n\tf[0]=0;\n\trep(s,1,S) {\n\t\tint cnt=0; rep(i,1,n) if(s&(1<<i-1)) cnt++;\n\t\tif(cnt==1) {f[s]=0; continue;}\n\t\tfor(int t=s;t;t=(t-1)&s) {\n\t\t\tint pc=0; rep(i,1,n) if(t&(1<<i-1)) pc++;\n\t\t\tif(pc==1) {\n\t\t\t\tint u;\n\t\t\t\trep(i,1,n) if(t&(1<<i-1)) u=i;\n\t\t\t\tf[s]=min(f[s],f[s-t]+g[s-t][u][0]+g[s-t][u][1]);\n\t\t\t} else {\n\t\t\t\trep(u,1,n) if(t&(1<<u-1)) rep(v,1,n) if(t&(1<<v-1)) {\n\t\t\t\t\tf[s]=min(f[s],f[s-t]+c[t][u][v]+g[s-t][u][0]+g[s-t][v][0]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nint main() {\n\tT=read();\n\twhile(T--) {\n\t\tmemset(w,0x1f,sizeof(w)), memset(c,0x1f,sizeof(c)), memset(g,0x1f,sizeof(g)), memset(f,0x1f,sizeof(f));\n\t\tn=read(), m=read(), S=(1<<n)-1;\n\t\trep(i,1,m) {\n\t\t\tint u=read(), v=read(), ww=read();\n\t\t\tif(ww<w[u][v][1]) w[u][v][1]=ww;\n\t\t\tif(w[u][v][1]<w[u][v][0]) swap(w[u][v][0],w[u][v][1]);\n\t\t\tw[v][u][0]=w[u][v][0], w[v][u][1]=w[u][v][1];\n\t\t}\n\t\tcal_g();\n\t\tcal_c();\n\t\tcal_f();\n\t\tif(f[S]==inf) puts(\"impossible\");\n\t\telse printf(\"%d\\n\",f[S]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1616669727,
        "uid": 180652,
        "name": "_lgswdn",
        "ccfLevel": 0,
        "title": "P5776 [SNOI2013]Quare"
    }
]