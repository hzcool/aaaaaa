[
    {
        "content": "# \u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\r\n\r\n**\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4**\u662f\u4e00\u4e2a\u5341\u5206~~\u80e1\u626f~~\u7384\u5999\u7684\u7b97\u6cd5\u3002\u5b83\u548c\u4e00\u7ef4\u6811\u72b6\u6570\u7ec4\u6709\u7740\u76f8\u540c\u7684\u5730\u65b9\uff0c\u90a3\u5c31\u662f**lowbit**\u8fd0\u7b97\u3002\u5728\u4e00\u7ef4\u6811\u72b6\u6570\u7ec4\u4e2d\uff0c\u6211\u4eec\u7528tree[x]\u8bb0\u5f55\u53f3\u7aef\u70b9\u4e3ax\uff0c\u957f\u5ea6\u4e3alowbit(x)\u7684\u533a\u95f4\u7684\u533a\u95f4\u548c\u3002\u6211\u4eec\u540c\u6837\u53ef\u4ee5\u7c7b\u4f3c\u5730\u5b9a\u4e49tree[x][y]\u4e3a\u53f3\u4e0b\u7aef\u70b9\u4e3a(x,y),\u9ad8\u4e3alowbit(x),\u5bbd\u4e3alowbit(y)\u7684\u533a\u95f4\u7684\u533a\u95f4\u548c\u3002\r\n\r\n## \u90a3\u4e48\u6211\u4eec\u5982\u4f55\u5bf9\u5176\u8fdb\u884c**\u533a\u95f4\u4fee\u6539**\u5462\uff1f\r\n\r\n\u6211\u4eec\u56de\u5fc6\u4e00\u4e0b\u6211\u4eec\u662f\u5982\u4f55\u5bf9\u4e00\u7ef4\u6811\u72b6\u6570\u7ec4\u8fdb\u884c\u533a\u95f4\u4fee\u6539\u7684\u3002\u6211\u4eec\u5bf9\u5176\u8fdb\u884c\u5dee\u5206\u64cd\u4f5c\uff0c\u662f\u4e3a\u4e86\u4f7f\u5f97\u5230\u7684\u5dee\u5206\u6570\u7ec4\u524d\u7f00\u548c\u5c31\u7b49\u4e8e\u5bf9\u5e94\u4f4d\u7f6e\u5143\u7d20\u7684\u503c\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8fd0\u7528\u7c7b\u6bd4\u601d\u60f3\uff0c\u8bbe\u8ba1\u4e00\u4e2a\u4e8c\u7ef4\u7684\u5dee\u5206\u5462\uff1f\r\n#### \u4ec0\u4e48\u662f\u5dee\u5206\u6570\u7ec4\u5462\uff1f\r\n\r\n\u5bf9\u4e8e\u4e00\u4e2a\u6570\u7ec4$A[ ]$\uff0c\u5176\u5dee\u5206\u6570\u7ec4$D[i]=A[i]-A[i-1] (i>0)$\u4e14$D[0]=A[0]$\r\n\r\n\u4ee4$SumD[i]=D[0]+D[1]+D[2]+\u2026+D[i]$ \uff08SumD[ ]\u662f\u5dee\u5206\u6570\u7ec4D[ ]\u7684\u524d\u7f00\u548c\uff09 \r\n\u5219$SumD[i]=A[0]+A[1]-A[0]+A[2]-A[1]+A[3]-A[2]+\u2026+A[i]-A[i-1]=A[i] $\r\n\u5373$A[i]$\u7684\u5dee\u5206\u6570\u7ec4\u662f$D[i]$\uff0c \u800c$D[i]$\u7684\u524d\u7f00\u548c\u662f$A[i]$\r\n\r\n#### \u56de\u5f52\u6b63\u9898\r\n\r\n\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u4e8c\u7ef4\u7684\u524d\u7f00\u548c\u3002\r\n\r\n$$sum[i][j]=sum[i-1][j]+sum[i][j-1]-sum[i-1][j-1]+a[i][j]$$\r\n\r\n\u67e5\u8be2\u5de6\u4e0a\u89d2\u70b9\uff08x1,y1\uff09\uff0c\u53f3\u4e0b\u89d2\u70b9(x2,y2)\u7684\u533a\u95f4\u548c\u5219\u662f\uff1a$$sum[x2][y2]-sum[x1-1][y2]-sum[x2][y1-1]+sum[x1-1][y1-1]$$\r\n\r\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u4f7f\u5dee\u5206\u6570\u7ec4$d[i][j]$\u7b49\u4e8e$a[i][j]$\u548c$a[i-1][j]+a[i][j-1]-a[i-1][j-1]$\u7684\u5dee\u3002\r\n\r\n\u5982\u4e0b\u77e9\u9635:\r\n\r\n             0 0 0 0 0\r\n             0 0 0 0 0\r\n             0 0 0 0 0 \r\n             0 0 0 0 0\r\n             \r\n\u5f53\u6211\u4eec\u60f3\u7ed9\u4e2d\u95f4\u90a3\u4e2a2*3\u7684\u77e9\u9635\u52a0\u4e0ax\u65f6\uff0c\u5dee\u5206\u6570\u7ec4\u7684\u53d8\u5316\u5e94\u8be5\u662f\uff1a\r\n\r\n\r\n\t\t\t 0  0 0 0 0\r\n             0 +x 0 0 -x\r\n             0  0 0 0 0\r\n             0 -x 0 0 +x\r\n         \r\n\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\uff0c\u6211\u4eec\u8981\u7b49\u5230\u533a\u95f4\u67e5\u8be2\u65f6\u5c31\u4f1a\u53d1\u73b0\u3002\r\n\r\n\r\n## **\u533a\u95f4\u67e5\u8be2**\r\n\r\n\u6839\u636e\u5dee\u5206\u6570\u7ec4\u7684\u5b9a\u4e49\uff0c\u6211\u4eec\u4e0d\u96be\u53d1\u73b0\uff0c\u5bf9\u4e8e\u70b9(x,y)\uff0c\u5b83\u7684\u4e8c\u7ef4\u524d\u7f00\u548c\u5c31\u662f:\r\n\r\n$$\\sum_{i=1}^x\\sum_{j=1}^y\\sum_{h=1}^i\\sum_{k=1}^j d[h][k]$$\r\n\r\n\u4f46\u6211\u4eec\u7c7b\u6bd4\u4e00\u4e0b\u4e00\u7ef4\u6811\u72b6\u6570\u7ec4\u7684\u533a\u95f4\u6c42\u548c\uff0c\u6211\u4eec\u4ea6\u53ef\u4ee5\u7edf\u8ba1\u6bcf\u4e2a$d[h][k]$\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u53d1\u73b0$d[1][1]$\u51fa\u73b0\u4e86$(x\\times y)$\u6b21\uff0c$d[1][2]$\u51fa\u73b0\u4e86$x\\times(y-1)$\u6b21\u2026\u2026$d[h][k]$\u51fa\u73b0\u4e86$(x-h+1)\\times (y-k+1)$\u6b21\u3002\r\n\r\n\u5219\u539f\u5f0f\u6574\u7406\u5f97\uff1a\r\n\r\n$$\\sum_{i=1}^x\\sum_{j=1}^y d[i][j]\\times (x-i+1)\\times (y-j+1)$$\r\n\r\n\u5206\u89e3\u5f97\uff1a\r\n\r\n$$\\sum_{i=1}^x\\sum_{j=1}^y d[i][j]\\times [(xy-xj+x)+(-yi+ij-i)+(y-j+1)]$$\r\n\r\n\u6700\u540e\u5f97\uff1a\r\n\r\n$$\\sum_{i=1}^x\\sum_{j=1}^y d[i][j]\\times (xy+x+y+1)-d[i][j]\\times i(y+1)-d[i][j]\\times j(x+1)+d[i][j]\\times i\\times j$$\r\n\r\n\u6839\u636e\u6211\u4eec\u6700\u540e\u5206\u89e3\u51fa\u6765\u7684\u516c\u5f0f\uff0c\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u56db\u4e2a\u6570\u7ec4$d[i][j],d[i][j]*i,d[i][j]*j,d[i][j]*i*j$\uff0c\u4ece\u800c\u5b9e\u73b0\u533a\u95f4\u67e5\u8be2\u3002\r\n\r\n## \u4f8b\u9898\r\n\r\n[LuoguP4514 \u4e0a\u5e1d\u9020\u9898\u7684\u4e03\u5206\u949f](https://www.luogu.org/problemnew/show/P4514)\r\n\r\n\u975e\u5e38\u9002\u5408\u6211\u4eec\u7684\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u88f8\u9898\u3002\u56e0\u4e3a\u8fd9\u9898~~\u542c\u8bf4~~\u5f00\u4e8c\u7ef4\u7ebf\u6bb5\u6811\u4f1a\u7206\u7a7a\u95f4\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u4f7f\u7528\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u3002\u800c\u4e14\u8fd9\u9898\u8981\u5f00o2\u4f18\u5316\uff0c\u4e0d\u7136\u8fc7\u4e0d\u4e86\u3002~~\u60e8\u75db\u7684\u7ecf\u5386\u3002~~\u539f\u7406\u6211\u4eec\u5df2\u7ecf\u8bb2\u5f97\u5f88\u6e05\u695a\u4e86\uff0c\u76f4\u63a5\u4e0a\u4ee3\u7801\u3002\r\n```c++\r\n// luogu-judger-enable-o2\r\n#include <cstdio>\r\n\r\nint n,m,num,x1,y1,x2,y2;\r\nchar c[3];\r\n\r\nstruct BIT\r\n{\r\n\tint tree[2050][2050];\r\n\t\r\n\tint lowbit(int x) {return x&-x;}\r\n\t\r\n\tvoid add(int x,int y,int num)\r\n\t{\r\n\t\tfor(int i=x; i<=n; i+=lowbit(i))\r\n\t\t\tfor(int j=y; j<=m; j+=lowbit(j))\r\n\t\t\t\ttree[i][j]+=num;\r\n\t}\r\n\t\r\n\tint query(int x,int y)\r\n\t{\r\n\t\tint res=0;\r\n\t\tfor(int i=x; i>=1; i-=lowbit(i))\r\n\t\t\tfor(int j=y; j>=1; j-=lowbit(j))\r\n\t\t\t\tres+=tree[i][j];\r\n\t\treturn res;\r\n\t}\r\n}A,Ai,Aj,Aij;\r\n\r\nint read()\r\n{\r\n\tint sign=1,res=0;\r\n\tchar c;\r\n\twhile((c=getchar())<48||c>57)\r\n\t\tif(c=='-')\r\n\t\t\tsign=-1;\r\n\tif(sign)\r\n\t\tres=c-48;\r\n\twhile((c=getchar())>=48&&c<=57)\r\n\t\tres=res*10+c-48;\r\n\treturn res*sign;\r\n}\r\n\r\nint Ans(int x,int y)\r\n{\r\n\treturn A.query(x,y)*(x*y+x+y+1)-\r\n\t\t   Ai.query(x,y)*(y+1)-\r\n\t\t   Aj.query(x,y)*(x+1)+\r\n\t\t   Aij.query(x,y);\r\n}\r\n\r\nvoid Add(int x,int y,int num)\r\n{\r\n\tA.add(x,y,num);\r\n\tAi.add(x,y,num*x);\r\n\tAj.add(x,y,num*y);\r\n\tAij.add(x,y,num*x*y);\r\n}\r\n\r\nint main()\r\n{\r\n\tscanf(\"X %d %d\",&n,&m);\r\n\twhile(~scanf(\"%s\",&c))\r\n\t{\r\n\t\tscanf(\"%d%d%d%d\",&x1,&y1,&x2,&y2);\r\n\t\tif(c[0]=='L')\r\n\t\t{\r\n\t\t\tscanf(\"%d\",&num);\r\n\t\t\tAdd(x1,y1,num);\r\n\t\t\tAdd(x1,y2+1,-num);\r\n\t\t\tAdd(x2+1,y1,-num);\r\n\t\t\tAdd(x2+1,y2+1,num);\r\n\t\t}else\r\n\t\t{\r\n\t\t\tprintf(\"%d\\n\",Ans(x2,y2)-Ans(x1-1,y2)-Ans(x2,y1-1)+Ans(x1-1,y1-1));\r\n\t\t}\r\n\t}\r\n\treturn 0;\r\n}\r\n```\r\n[\u53c2\u8003\u5730\u5740](https://www.cnblogs.com/RabbitHu/p/BIT.html)",
        "postTime": 1526052237,
        "uid": 53167,
        "name": "kuansoudafahao",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4514 \u3010\u4e0a\u5e1d\u9020\u9898\u7684\u4e03\u5206\u949f\u3011"
    },
    {
        "content": "# \u4e00\u4f4d\u6811\u72b6\u6570\u7ec4\u533a\u95f4\u64cd\u4f5c\u7684\u65b9\u6cd5\u5c31\u662f\n\n\u5f00\u4e24\u4e2a\u6811\u72b6\u6570\u7ec4A,B\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8ba9[1,x]\u4e2d\u6240\u6709\u6570+v\uff0c\u90a3\u4e48\u5c31\u5728A\u4e2dx\u4f4d\u7f6e+x*v\uff0cB\u4e2dx\u4f4d\u7f6e+v\u3002\n\n\u5982\u679c\u6211\u4eec\u60f3\u67e5\u8be2[1,y]\u7684\u548c\uff0c\u90a3\u4e48ans=A\u4e2d[1,y]\u7684\u548c+B\u4e2d[y+1,n]\u7684\u548c*x\u3002\n\n## \u95ee\uff1a \u90a3\u4e48\u4e8c\u7ef4\u7684\u5462\uff1f\n## \u7b54\uff1a \u628a\u4e24\u4e2a\u6362\u6210\u56db\u4e2a\u3002\u3002\u3002\n# \u4ee3\u7801\n```\n#include <cstdio>\n#include <cstring>\n#include <iostream>\nusing namespace std;\nconst int maxn=2050;\nint n,m;\nstruct BIT\n{\n    int s[maxn][maxn];\n    void updata(int x,int y,int val)\n    {\n        if(!x||!y)  return ;\n        for(int i=x;i<=n;i+=i&-i)    for(int j=y;j<=m;j+=j&-j)    s[i][j]+=val;\n    }\n    int query(int x,int y)\n    {\n        int ret=0,i,j;\n        for(i=x;i;i-=i&-i)  for(j=y;j;j-=j&-j)  ret+=s[i][j];\n        return ret;\n    }\n}A,B,C,D;\nchar str[5];\nvoid add(int x,int y,int val)\n{\n    A.updata(x,y,val*x*y),B.updata(x,y,val*x),C.updata(x,y,val*y),D.updata(x,y,val);\n}\nint query(int x,int y)\n{\n    return A.query(x,y)+y*(B.query(x,m)-B.query(x,y))+x*(C.query(n,y)-C.query(x,y))+x*y*(D.query(n,m)-D.query(x,m)-D.query(n,y)+D.query(x,y));\n}\nint main()\n{\n    scanf(\"%s%d%d\",str,&n,&m);\n    int i,a,b,c,d,e;\n    while(scanf(\"%s%d%d%d%d\",str,&a,&b,&c,&d)!=EOF)\n    {\n        if(str[0]=='L') scanf(\"%d\",&e),add(a-1,b-1,e),add(a-1,d,-e),add(c,b-1,-e),add(c,d,e);\n        else    printf(\"%d\\n\",query(a-1,b-1)-query(a-1,d)-query(c,b-1)+query(c,d));\n    }\n    return 0;\n}\n```",
        "postTime": 1525508063,
        "uid": 75446,
        "name": "Unknown_Error\u00a0",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4514 \u3010\u4e0a\u5e1d\u9020\u9898\u7684\u4e03\u5206\u949f\u3011"
    },
    {
        "content": "~~\u672c\u849f\u84bb~~\u7b2c\u4e09\u7bc7\u9898\u89e3\uff0c\u671b\u7ba1\u7406\u7ed9\u8fc7\uff01\n\n## \u601d\u8def\n\u8c8c\u4f3c **\u4e8c\u7ef4\u524d\u7f00\u548c $+$ \u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4** \u5c31\u9614\u4ee5\u89e3\u51b3\u95ee\u9898\u4e86\u3002~~\uff08\u7ebf\u6bb5\u6811\u5927\u4f6c\u52ff\u55b7~~\n\n## \u6ce8\u610f\n\u6309\u7167\u6211\u7684\u65b9\u6cd5\uff0c\u9700\u8981\u5f00\u542f\uff1a\n\n1. **\u5feb\u8bfb**\n1. **\u6c27\u6c14** \u4f18\u5316\uff1b\n1. **\u81ed\u6c27** \u4f18\u5316\uff1b\n1. **$Ofast$** \u4f18\u5316\uff1b\n1. **\u6d1b\u8c37$O2$** \u4f18\u5316\uff1b\n\n~~\uff08\u5927\u4f6c\u53ef\u4ee5\u5c1d\u8bd5\u5173\u95ed\u67d0\u4e9b\u4f18\u5316\uff0c\u53cd\u6b63\u6211\u6ca1\u8bd5\u8fc7~~\n\n## CODE\n```cpp\n#include <stdio.h>\n#include <iostream>\n#pragma GCC optimize(1)\n#pragma GCC optimize(2)\n#pragma G++ optimize(3)\n#pragma GCC optimize(Ofast)\nconst int N = 2501;\nint n, m;\nint c1[N][N], c2[N][N], c3[N][N], c4[N][N];\ntemplate<typename TYPE>\ninline void read(TYPE&x) {\n\tx = 0;\n\tint w = 1;\n\tchar c = getchar();\n\tfor(; c < '0' || c > '9'; w *= c == '-' ? -1 : 1, c = getchar());\n\tfor(; c >= '0' && c <= '9'; x = (x << 3) + (x << 1) + (c ^ 48), c = getchar());\n\tx *= w;\n}\ninline void add(int x, int y, int k) {\n\tfor (int i = x; i <= n; i += i & -i)\n\t\tfor (int j = y; j <= m; j += j & -j) {\n\t\t\tc1[i][j] += k;\n\t\t\tc2[i][j] += k * (x - 1);\n\t\t\tc3[i][j] += k * (y - 1);\n\t\t\tc4[i][j] += k * (x - 1) * (y - 1);\n\t\t}\n}\ninline int query(int x, int y) {\n\tint ret1 = 0, ret2 = 0, ret3 = 0, ret4 = 0;\n\tfor (int i = x; i; i -= i & -i)\n\t\tfor (int j = y; j; j -= j & -j) {\n\t\t\tret1 += c1[i][j];\n\t\t\tret2 += c2[i][j];\n\t\t\tret3 += c3[i][j];\n\t\t\tret4 += c4[i][j];\n\t\t}\n\treturn ret1 * x * y - ret2 * y - ret3 * x + ret4;\n}\nint main(void) {\n\tscanf(\"X %d %d\", &n, &m);\n\tchar op;\n\tint a, b, c, d, delta;\n\twhile (std:: cin >> op) {\n\t\tread(a), read(b), read(c), read(d);\n\t\tif (op ==  'L') {\n\t\t\tread(delta);\n\t\t\tadd(c + 1, d + 1, delta);\n\t\t\tadd(c + 1, b, -delta);\n\t\t\tadd(a, d + 1, -delta);\n\t\t\tadd(a, b, delta);\n\t\t}\n\t\telse\n\t\t\tprintf(\"%d\\n\", query(c, d) - query(c, b - 1) - query(a - 1, d) + query(a - 1, b - 1));\n\t}\n\treturn 0;\n}\n```\n\n\uff08\u6700\u6162\u4e00\u4e2a\u70b9\u5361\u5230 $947ms$ \u624d\u8fc7\uff0c~~\u6d1b\u8c37\u8bc4\u6d4b\u59ec\u76f8\u5f53\u5361\u554a~~\n\n## \u63a8\u8350\u6811\u72b6\u6570\u7ec4\u9898\u5355\n### \u5b98\u65b9\u7cbe\u9009\n- [\u3010\u6570\u636e\u7ed3\u67842-2\u3011\u7ebf\u6bb5\u6811\u4e0e\u6811\u72b6\u6570\u7ec4](https://www.luogu.com.cn/training/206)\n\n### \u7528\u6237\u7cbe\u9009\n- [\u6811\u72b6\u6570\u7ec4\u6a21\u677f\u9898](https://www.luogu.com.cn/training/3079)\n\n- [CM\u306e\u6811\u72b6\u6570\u7ec4](https://www.luogu.com.cn/training/1143)\n\n## The end. Thanks.\n\n~~\uff08\u8d70\u8fc7\u8def\u8fc7\u4e00\u5b9a\u8981\u8d5e\u8fc7\u554a~~",
        "postTime": 1591420081,
        "uid": 214696,
        "name": "Dry_ice",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4514 \u3010\u4e0a\u5e1d\u9020\u9898\u7684\u4e03\u5206\u949f\u3011"
    },
    {
        "content": "## \u9898\u76ee\u63cf\u8ff0\n\n\u88f8\u4f53\uff08\u9898\uff09\u5c31\u610f\u5473\u7740\u8eab\u4f53\uff08\u795e\u9898\uff09\u3002\n\u7b2c\u4e00\u5206\u949f\uff0c `X` \u8bf4\uff0c\u8981\u6709\u77e9\u9635\uff0c\u4e8e\u662f\u4fbf\u6709\u4e86\u4e00\u4e2a\u91cc\u9762\u5199\u6ee1\u4e86 0 \u7684 $n\u00d7m$ \u77e9\u9635\u3002\n\u7b2c\u4e8c\u5206\u949f\uff0c `L` \u8bf4\uff0c\u8981\u80fd\u4fee\u6539\uff0c\u4e8e\u662f\u4fbf\u6709\u4e86\u5c06\u5de6\u4e0a\u89d2\u4e3a $(a,b)$ \uff0c\u53f3\u4e0b\u89d2\u4e3a $(c,d)$ \u7684\u4e00\u4e2a\u77e9\u5f62\u533a\u57df\u5185\u7684\u5168\u90e8\u6570\u5b57\u52a0\u4e0a\u4e00\u4e2a\u503c\u7684\u64cd\u4f5c\u3002\n\u7b2c\u4e09\u5206\u949f\uff0c`k` \u8bf4\uff0c\u8981\u80fd\u67e5\u8be2\uff0c\u4e8e\u662f\u4fbf\u6709\u4e86\u6c42\u7ed9\u5b9a\u77e9\u5f62\u533a\u57df\u5185\u7684\u5168\u90e8\u6570\u5b57\u548c\u7684\u64cd\u4f5c\u3002\n\u7b2c\u56db\u5206\u949f\uff0c\u5f69\u8679\u55b5\u8bf4\uff0c\u8981\u57fa\u4e8e\u4e8c\u53c9\u6811\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4e8e\u662f\u4fbf\u6709\u4e86\u6570\u636e\u8303\u56f4\u3002\n\u7b2c\u4e94\u5206\u949f\uff0c\u548c\u96ea\u8bf4\uff0c\u8981\u6709\u8010\u5fc3\uff0c\u4e8e\u662f\u4fbf\u6709\u4e86\u65f6\u95f4\u9650\u5236\u3002\n\u7b2c\u516d\u5206\u949f\uff0c\u5403\u94a2\u7434\u7537\u8bf4\uff0c\u8981\u7701\u70b9\u4e8b\uff0c\u4e8e\u662f\u4fbf\u6709\u4e86\u4fdd\u8bc1\u8fd0\u7b97\u8fc7\u7a0b\u4e2d\u53ca\u6700\u7ec8\u7ed3\u679c\u5747\u4e0d\u8d85\u8fc732\u4f4d\u6709\u7b26\u53f7\u6574\u6570\u7c7b\u578b\u7684\u8868\u793a\u8303\u56f4\u7684\u9650\u5236\u3002\n\u7b2c\u4e03\u5206\u949f\uff0c\u8fd9\u9053\u9898\u7ec8\u4e8e\u9020\u5b8c\u4e86\uff0c\u7136\u800c\uff0c\u9020\u9898\u7684\u795e\u725b\u4eec\u518d\u4e5f\u4e0d\u60f3\u5199\u8fd9\u9053\u9898\u7684\u7a0b\u5e8f\u4e86\u3002\u201d\n\u2014\u2014\u300a\u4e0a\u5e1d\u9020\u88f8\u9898\u7684\u4e03\u5206\u949f\u300b\n\u6240\u4ee5\u8fd9\u4e2a\u795e\u5723\u7684\u4efb\u52a1\u5c31\u4ea4\u7ed9\u4f60\u4e86\u3002\n\n**\u65f6\u7a7a\u9650\u5236** 1000ms /131MB\n\n\n\n## \u94fe\u63a5\n\n[luogu 4514](https://www.luogu.org/problemnew/show/P4514)\n\n## \u9898\u89e3\n\n### \u7b97\u6cd51\uff08\u4e8c\u7ef4\u7ebf\u6bb5\u6811\uff09\n\n\u88ab\u5361\u65f6\u95f4\u548c\u7a7a\u95f4\n\u56e0\u4e3a\u4e00\u5f00\u59cb\u6ca1\u6709\u4f30\u8ba1\u65f6\u95f4\u548c\u7a7a\u95f4\u5c31\u5199\u4e86\n\u5f00 $O(2)$ \u53ea\u8fc7\u4e86\u4e94\u4e2a\u70b9\n\u4e8c\u7ef4\u7ebf\u6bb5\u6811\u5199\u5f97\u6211\u597d\u82e6\u554a\n\u4ee5\u540e\u518d\u4e5f\u4e0d\u6562\u4e71\u5199\u4e86\n\n> \u4ee3\u7801\n\n```cpp\n/*\nson[]:0,1,2,3\n  -   -\n| 0 | 2 |\n  -   -\n| 1 | 3 |\n  -   -\n*/\n\n#include <cstdio>\n#include <cctype>\n//#define DEBUG 1\n\nint n,m,ans;\n\nchar readc(){\n\tchar ch;\n\twhile (ch=getchar(),ch!=EOF && !isalpha(ch));\n\treturn ch;\n}\n\ntemplate <typename T>\ninline void read(T &x){\n\tx=0; char ch; bool flg=0;\n\twhile (ch=getchar(),ch<48 || 57<ch) flg^=!(ch^'-'); x=(ch&15);\n\twhile (ch=getchar(),47<ch && ch<58) x=(x<<1)+(x<<3)+(ch&15);\n\tif (flg) x=-x;\n}\n\ntemplate <typename T>\ninline T max(const T x,const T y){ if (x<y) return y; return x; }\n\ntemplate <typename T>\ninline T min(const T &x,const T &y){ if (x<y) return x; return y; }\n\nstruct node{\n\tint sum,tag;\n\tint size;\n\tnode *son[4];\n\tnode(){sum=0,tag=0,size=0,son[0]=NULL,son[1]=NULL,son[2]=NULL,son[3]=NULL;} \n};\nnode *rt=NULL;\n\nvoid BUILD(node *&u,int a,int b,int c,int d){\n\tif (u==NULL) u=new node(),u->size=(c-a+1)*(d-b+1);\n}\n\nvoid UPDATE(node *&u){\n\tif (u==NULL) return;\n\tu->sum=0;\n\tif (u->son[0]!=NULL) u->sum+=u->son[0]->sum;\n\tif (u->son[1]!=NULL) u->sum+=u->son[1]->sum;\n\tif (u->son[2]!=NULL) u->sum+=u->son[2]->sum;\n\tif (u->son[3]!=NULL) u->sum+=u->son[3]->sum;\n}\n\nvoid PUSHDOWN(node *&u,int a,int b,int c,int d){\n\tif (u==NULL) return;\n\tif (u->size == 1) return;\n\tif (u->tag){\n\t\tint mid0=a+c>>1,mid1=b+d>>1;\n\t\tif (u->son[0]==NULL){\n\t\t\tBUILD(u->son[0],a,b,mid0,mid1);\n\t\t}\n\t\tu->son[0]->tag+=u->tag;\n\t\tu->son[0]->sum+=u->tag * u->son[0]->size;\n\t\t\n\t\tif (u->son[1]==NULL){\n\t\t\tBUILD(u->son[1],mid0+1,b,c,mid1);\n\t\t}\n\t\tu->son[1]->tag+=u->tag;\n\t\tu->son[1]->sum+=u->tag * u->son[1]->size;\n\t\tif (u->son[2]==NULL){\n\t\t\tBUILD(u->son[2],a,mid1+1,mid0,d);\n\t\t}\n\t\tu->son[2]->tag+=u->tag;\n\t\tu->son[2]->sum+=u->tag * u->son[2]->size;\n\t\tif (u->son[3]==NULL){\n\t\t\tBUILD(u->son[3],mid0+1,mid1+1,c,d);\n\t\t}\n\t\tu->son[3]->tag+=u->tag;\n\t\tu->son[3]->sum+=u->tag * u->son[3]->size;\n\t\tu->tag=0;\n\t}\n//\t(u->son[0],a,b,mid0,mid1);\n//\t(u->son[1],mid0+1,b,c,mid1);\n//\t(u->son[2],a,mid1+1,mid0,d);\n//\t(u->son[3],mid0+1,mid1+1,c,d);\n}\n\n/*\n(a,b) \u5f53\u524d\u533a\u95f4 \u5de6\u4e0a\u89d2 \n(c,d) \u5f53\u524d\u533a\u95f4 \u53f3\u4e0b\u89d2\n(ax,bx) \u5f85\u67e5\u533a\u95f4 \u5de6\u4e0a\u89d2\n(cx,dx) \u5f85\u67e5\u533a\u95f4 \u53f3\u4e0b\u89d2\n*/\n\nvoid MODIFY(node *&u,int a,int b,int c,int d,int ax,int bx,int cx,int dx,int delta){\n\tif (u==NULL) BUILD(u,a,b,c,d);\n\tu->sum+=(cx-ax+1)*(dx-bx+1)*delta;\n\tif (a==ax && b==bx && c==cx && d==dx){\n\t\tu->tag+=delta;\n\t\treturn;\n\t}\n\tPUSHDOWN(u,a,b,c,d);\n\tint mid0=a+c>>1,mid1=b+d>>1;\n\tif (ax <= mid0 && bx <= mid1) MODIFY(u->son[0],a,b,mid0,mid1,ax,bx,min(cx,mid0),min(dx,mid1),delta);\n\tif (cx >  mid0 && bx <= mid1) MODIFY(u->son[1],mid0+1,b,c,mid1,max(ax,mid0+1),bx,cx,min(dx,mid1),delta);\n\tif (ax <= mid0 && dx >  mid1) MODIFY(u->son[2],a,mid1+1,mid0,d,ax,max(bx,mid1+1),min(cx,mid0),dx,delta);\n\tif (cx >  mid0 && dx >  mid1) MODIFY(u->son[3],mid0+1,mid1+1,c,d,max(ax,mid0+1),max(bx,mid1+1),cx,dx,delta);\n\tUPDATE(u);\n}\n\nvoid QUERY(node *&u,int a,int b,int c,int d,int ax,int bx,int cx,int dx){\n\tif (u==NULL) BUILD(u,a,b,c,d);\n#ifdef DEBUG\n\tprintf(\"%d %d %d %d %d %d %d %d\",a,b,c,d,ax,bx,cx,dx);\n#endif \n\tif (a==ax && b==bx && c==cx && d==dx){\n\t\tans+=u->sum;\n#ifdef DEBUG\n\t\tprintf(\" %d\\n\",u->sum);\n#endif\n\t\treturn;\n\t}\n#ifdef DEBUG\n\tprintf(\"\\n\");\n#endif\n\tPUSHDOWN(u,a,b,c,d);\n\tint mid0=a+c>>1,mid1=b+d>>1;\n\tif (ax <= mid0 && bx <= mid1) QUERY(u->son[0],a,b,mid0,mid1,ax,bx,min(cx,mid0),min(dx,mid1));\n\tif (cx >  mid0 && bx <= mid1) QUERY(u->son[1],mid0+1,b,c,mid1,max(ax,mid0+1),bx,cx,min(dx,mid1));\n\tif (ax <= mid0 && dx >  mid1) QUERY(u->son[2],a,mid1+1,mid0,d,ax,max(bx,mid1+1),min(cx,mid0),dx);\n\tif (cx >  mid0 && dx >  mid1) QUERY(u->son[3],mid0+1,mid1+1,c,d,max(ax,mid0+1),max(bx,mid1+1),cx,dx);\n\tUPDATE(u);\n}\n\nint main(){\n\treadc();\n\tread(n),read(m);\n\tBUILD(rt,1,1,n,m);\n\tint a,b,c,d,delta;\n\tchar type;\n\twhile (type=readc(),type!=EOF){\n\t\tread(a),read(b),read(c),read(d);\n\t\tif (type=='L'){\n\t\t\tread(delta);\n\t\t\tMODIFY(rt,1,1,n,m,a,b,c,d,delta);\n\t\t}\n\t\telse{\n\t\t\tans=0;\n\t\t\tQUERY(rt,1,1,n,m,a,b,c,d);\n\t\t\tprintf(\"%d\\n\",ans);\n\t\t}\n\t}\n\treturn 0;\n}\n```\n\n### \u7b97\u6cd52 \uff08\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\uff09\n\n> \u601d\u8def\n\n\u4e00\u7ef4\u6811\u72b6\u6570\u7ec4\u533a\u95f4\u4fee\u6539\u533a\u95f4\u67e5\u8be2\u662f\u5229\u7528\u5dee\u5206\u7684\u539f\u7406,\u901a\u8fc7\u4e00\u7ef4\u7684\u6811\u72b6\u6570\u7ec4\u53ef\u4ee5\u62d3\u5c55\u51fa\u4e8c\u7ef4\u7684\u6811\u72b6\u6570\u7ec4,\u5bf9\u4e8e\u4e8c\u7ef4\u7684\u6811\u72b6\u6570\u7ec4\u533a\u95f4\u67e5\u8be2\u95ee\u9898,\u65b9\u6cd5\u8fd8\u662f\u5dee\u5206\n\n\u5bf9\u4e8e\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u533a\u95f4\u4fee\u6539\u533a\u95f4\u67e5\u8be2\u95ee\u9898\u53ea\u8981\u7ef4\u62a4\u56db\u4e2a\u652f\u6301\u5355\u70b9\u4fee\u6539\u533a\u95f4\u67e5\u8be2\u95ee\u9898\u7684\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u5c31\u53ef\u4ee5\u4e86,\u6570\u636e\u5f88\u5927,\u5e38\u6570\u5927\u5c31\u8fc7\u4e0d\u4e86,\u6700\u540e\u4e24\u4e2a\u70b9\u4e0d\u660e RE,\u52a0\u5927 `MAXN` \u540e\u624d\u8fc7\u4e86,\u6ca1\u6709\u5f00 $O2$ \u8fc7\u4e86\u7684\n\n> \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#include <cctype>\n\nconst int MAXN=3055;\nint n,m,ans,tree[4][MAXN][MAXN];\n\nchar readc(){\n\tchar ch;\n\twhile (ch=getchar(),ch!=EOF && !isalpha(ch));\n\treturn ch;\n}\n\ntemplate <typename T>\ninline void read(T &x){\n\tx=0; char ch; bool flg=0;\n\twhile (ch=getchar(),ch<48 || 57<ch) flg^=!(ch^'-'); x=(ch&15);\n\twhile (ch=getchar(),47<ch && ch<58) x=(x<<1)+(x<<3)+(ch&15);\n\tif (flg) x=-x;\n}\n\nvoid ADD(int x,int y,int delta){\n\tif (x<1 || n<x || y<1 || m<y) return;\n\tfor (int i=x;i<=n;i+=i&-i)\n\tfor (int j=y;j<=m;j+=j&-j){\n\t\ttree[0][i][j]+=delta;\n\t\ttree[1][i][j]+=delta*y;\n\t\ttree[2][i][j]+=delta*x;\n\t\ttree[3][i][j]+=delta*x*y;\n\t}\n}\n\nint ASK(int x,int y){\n\tint res=0;\n\tfor (int i=x;i;i-=i&-i)\n\tfor (int j=y;j;j-=j&-j)\n\t\tres=res+(x+1)*(y+1)*tree[0][i][j]-(x+1)*tree[1][i][j]-(y+1)*tree[2][i][j]+tree[3][i][j];\n\treturn res;\n}\n\nint main(){\n\treadc();\n\tread(n),read(m);\n\tint a,b,c,d,delta;\n\tchar type;\n\twhile (type=readc(),type!=EOF){\n\t\tread(a),read(b),read(c),read(d);\n\t\tif (type=='L'){\n\t\t\tread(delta);\n\t\t\tADD(a,b,delta);\n\t\t\tADD(c+1,b,-delta);\n\t\t\tADD(a,d+1,-delta);\n\t\t\tADD(c+1,d+1,delta);\n\t\t}\n\t\telse\n\t\t\tprintf(\"%d\\n\",ASK(c,d)-ASK(a-1,d)-ASK(c,b-1)+ASK(a-1,b-1));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1525858790,
        "uid": 26166,
        "name": "\u6309Ctrl\u52a0w\u4f1aAC",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4514 \u3010\u4e0a\u5e1d\u9020\u9898\u7684\u4e03\u5206\u949f\u3011"
    },
    {
        "content": "Update 20191114 \u4fee\u4e86\u4e00\u4e9bbug\n\n- \u9898\u76ee\u5927\u610f\uff1a\u6709\u4e00\u4e2a\u5199\u6ee10\u7684\u77e9\u9635\uff0c\u8981\u6c42\u6709\n\n```\n  1. L a b c d delta \u4ee3\u8868\u5c06 (a,b),(c,d)(a,b),(c,d) \u4e3a\u9876\u70b9\u7684\u77e9\u5f62\u533a\u57df\u5185\u7684\u6240\u6709\u6570\u5b57\u52a0\u4e0adelta\u3002\n\n  2. k a b c d \u4ee3\u8868\u6c42 (a,b),(c,d)(a,b),(c,d) \u4e3a\u9876\u70b9\u7684\u77e9\u5f62\u533a\u57df\u5185\u6240\u6709\u6570\u5b57\u7684\u548c\u3002\n ```\n  \u8fd9\u4e24\u79cd\u64cd\u4f5c\n- \u603b\u7ed3\uff1a\u533a\u95f4\u4fee\u6539\uff0c\u533a\u95f4\u67e5\u8be2\n\n  OK \uff0c\u770b\u5230\u8fd9dalao\u4eec\u7684\u53cd\u5e94\u90fd\u662f\u7ebf\u6bb5\u6811\u6216\u6811\u72b6\u6570\u7ec4\u4e86\uff0c\u56e0\u4e3a~~\u542c\u8bf4\u7ebf\u6bb5\u6811\u8fc7\u4e0d\u53bb~~\uff0c\u6240\u4ee5\u6211\u7528\u4e86\u6811\u72b6\u6570\u7ec4\u3002\n---\n### \u6811\u72b6\u6570\u7ec4\u600e\u4e48\u7528\uff1f\u5982\u4f55\u533a\u95f4\u4fee\u6539\uff0c\u5355\u70b9\u67e5\u8be2\uff1f\u8bf7\u53c2\u8003\n## [3374](/problemnew/show/P3374)\n## [3368](/problemnew/show/P3368)\n\n---\n\u6211\u4eec\u4ece\u4e00\u7ef4\u6811\u72b6\u6570\u7ec4\u7684\u201c\u533a\u95f4\u4fee\u6539\uff0c\u533a\u95f4\u67e5\u8be2\u201c\u5f00\u59cb\n\n\u4f7f\u7528\u5dee\u5206\u7684\u65b9\u6cd5\uff0c\u5dee\u5206\u6570\u7ec4$d_i$\u4e3a\u7b2c$i$\u4e2a\u6570\uff08$a_i$\uff09\u4e0e\u7b2c$i-1$($a_{i-1}$)\u4e2a\u6570\u7684\u5dee,\u90a3\u4e48\n\n\u56e0\u4e3a $a_i=d_1+d_2+...+d_{i-1}+d_i$\n\n### \u6240\u4ee5 $d_i$\u5b9e\u9645\u4e0a\u7528\u4e86$n-(i-1)$\u6b21,\u76f8\u5f53\u4e8e\u6709$i-1$\u6b21\u6ca1\u88ab\u4f7f\u7528\n\n\u6240\u4ee5 \u6211\u4eec\u53ef\u4ee5\u5efa\u4e24\u4e2a\u6811\u72b6\u6570\u7ec4\uff0c\n\n\u7b2c\u4e00\u4e2a\uff08\u672c\u90e8\u5206\u79f0\u4e3a$tree$\uff09\u5b58$d_i$\n\n\u7b2c\u4e8c\u4e2a\uff08\u672c\u90e8\u5206\u79f0\u4e3a$tree1$\uff09\u5b58$d_i*(i-1)$\n\n#### \u6c421~x\u7684\u603b\u548c\u5c31\u662f $tree$\u4e2dx\u7684\u524d\u7f00\u548c*x-$tree1$\u4e2dx\u7684\u524d\u7f00\u548c\n\n\u5bf9\u4e8e\u6b64\u516c\u5f0f\uff0c\u6211\u7684\u601d\u8def\u662f\u5148\u628ax\u524d\u9762\u7684\u6570\u770b\u6210$a_x$,\u518d\u51cf\u53bb\u591a\u7b97\u7684\u503c\uff08$tree1$\u6570\u7ec4\uff09\n\n\u8d34\u4ee3\u7801\uff08P3372\uff09\n```\n// luogu-judger-enable-o2\n//\u672c\u4ee3\u7801\u4e2d\uff0ctree\u548ctree1\u7684\u610f\u4e49\u4e0e\u524d\u6587\u76f8\u540c\n#include<bits/stdc++.h>\nusing namespace std;\nlong long n,tree[101000],tree1[100000],m,c,l,r,k;\nvoid add(int x,int y)\n{\n    //\u4fee\u6539tree\n    for (int i=x;i<=n;i+=(i&(-i)))\n        tree[i]+=y;\n}\nvoid add1(int x,int y)\n{\n    //\u4fee\u6539tree1\n    for (int i=x;i<=n;i+=(i&(-i)))\n        tree1[i]+=y;\n}\nlong long ask(long long x)\n{\n    long long ans=0,ans1=0;\n    for (long long i=x;i;i-=(i&(-i)))\n      ans+=tree[i];\n    ans*=x;\n    for (long long i=x;i;i-=(i&(-i)))\n      ans1+=tree1[i];\n    //\u5206\u522b\u6c42\u51faans*x\u4e0eans1\uff08\u5e94\u8be5\u53ef\u4ee5\u5408\u8d77\u6765\u5199\uff09\n    return ans-ans1;\n}\nint main()\n{\n    scanf(\"%lld%lld\",&n,&m);\n    long long c=0,last=0,a=0;\n    for (long long i=1;i<=n;i++)\n    {\n        scanf(\"%lld\",&a);//long long\u8bfb\u5165\u8981\u7528lld\n        c=a-last;//\u6c42\u5dee\u5206\n        add(i,c);add1(i,c*(i-1));\n        last=a;\n    }\n    for (long long i=1;i<=m;i++)\n    {\n        scanf(\"%lld\",&c);\n        if (c==1)\n        {\n          //\u533a\u95f4\u4fee\u6539\n          scanf(\"%lld%lld%lld\",&l,&r,&k);\n            add(l,k);add(r+1,-k);//\u5728l\u5904+x\n            add1(l,k*(l-1));add1(r+1,(-k)*(r));//\u5728r+1\u5904-x\uff0c\u76f8\u5f53\u4e8e\u62b5\u6d88\u524d\u9762\u7684+x\n        }\n        if (c==2)\n        {\n           //\u533a\u95f4\u67e5\u8be2 \n           scanf(\"%d%d\",&l,&r);\n            cout<<ask(r)-ask(l-1)<<endl;\n        }\n    }\n    return 0;\n}\n```\n\n\n---\n\n\u56de\u5f52\u6b63\u9898\uff0c\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u7684\u533a\u95f4\u4fee\u6539\uff0c\u533a\u95f4\u67e5\u8be2\u600e\u4e48\u505a\u5462\uff1f\n\n\uff08\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u7684\u5b9a\u4e49\u53ef\u4ee5baidu\u4e00\u4e0b\uff09\n\n\u56e0\u4e3a\u5dee\u5206\u5b9e\u9645\u4e0a\u662f\u524d\u7f00\u548c\u7684\u9006\u8fd0\u7b97\uff0c\u6240\u4ee5\uff0c\u4eff\u7167\u4e8c\u7ef4\u524d\u7f00\u548c\uff08$s[i][j]=a[i][j]+a[i-1][j]+a[i][j-1]-a[i-1][j-1]$\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\u51fa\u4e8c\u7ef4\u5dee\u5206\u516c\u5f0f\n$d[i][j]=a[i][j]-a[i-1][j]-a[i][j-1]+a[i-1][j-1]$\n\n\u4fee\u6539\u5c31\u662f\u8fd9\u6837\n```\n//\u539f\u6570\u7ec4\n0 x x x \n0 x x x\n0 x x x\n```\n```\n//\u5dee\u5206\u6570\u7ec4\n0 +x 0 0 -x\n0 0  0 0 0\n0 0  0 0 0\n0 -x 0 0 +x\n```\n\n\u4eff\u7167\u4e00\u7ef4\u7684\u201c\u533a\u95f4\u4fee\u6539\uff0c\u533a\u95f4\u67e5\u8be2\u201d\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\n### $d[i][j]$\u5b9e\u9645\u4e0a\u88ab\u4f7f\u7528\u4e86$(n-i+1)(m-j+1)$\u6b21,\u76f8\u5f53\u4e8e\u6709$j(i-1)+i(j-1)+(i-1)(j-1)$\u6b21\u6ca1\u88ab\u4f7f\u7528\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a44\u4e2a\u6811\u72b6\u6570\u7ec4\n\n\u7b2c\u4e00\u4e2a\uff08\u672c\u90e8\u5206\u79f0\u4e3a$tree$\uff09\u5b58$d[i][j]$\n\n\u7b2c\u4e8c\u4e2a\uff08\u672c\u90e8\u5206\u79f0\u4e3a$tree1$\uff09\u5b58$d[i][j]*(i-1)$\n\n\u7b2c\u4e09\u4e2a\uff08\u672c\u90e8\u5206\u79f0\u4e3a$tree2$\uff09\u5b58$d[i][j]*(j-1)$\n\n\u7b2c\u4e8c\u4e2a\uff08\u672c\u90e8\u5206\u79f0\u4e3a$tree3$\uff09\u5b58$d[i][j]*(i-1)*(j-1)$\n\n\u6700\u540e\uff0c\u6c42$(1,1)$\u5230$(i,j)$\u7684\u524d\u7f00\u548c\u5c31\u662f \n#### $tree[i][j]$\u7684\u524d\u7f00\u548c$*x*y$-$tree1[i][j]$\u7684\u524d\u7f00\u548c$*j$-$tree2[i][j]$\u7684\u524d\u7f00\u548c$*i$+$tree3[i][j]$\u7684\u524d\u7f00\u548c\n\n\uff08\u8fd9\u4e2a\u516c\u5f0f\u548c\u666e\u901a\u7684\u524d\u7f00\u548c\u5dee\u4e0d\u591a\u554a\u597d\u50cf\uff09\n\n\u6211\u7684\u601d\u8def\u548c\u524d\u9762\u4e00\u6837\uff0c\u5148\u628a\u6240\u6709\u6570\u770b\u6210$a[i][j]$\uff0c\u518d\u51cf\u5dee\u503c\n\n\u6700\u540e\u8d34\u672c\u9898\u4ee3\u7801\n```\n// luogu-judger-enable-o2\n//\u672c\u4ee3\u7801\u4e2d\uff0ctree\u3001tree1\u3001tree2\u3001tree3\u7684\u610f\u4e49\u4e0e\u524d\u6587\u76f8\u540c\n//\u7801\u98ce\u4e0d\u597d\u6c42\u8f7b\u55b7\n#include<bits/stdc++.h>\nusing namespace std;\nlong long tree[2049][2049],tree1[2049][2049],tree2[2049][2049],tree3[2049][2049];\nlong long n,m,a,b,c,d,ad;char ch;\nvoid add(long long x,long long y,long long z)\n{\n    for (long long i=x;i<=n;i+=i&(-i))\n    {\n        for (long long j=y;j<=m;j+=(j&(-j)))\n        {\n            tree[i][j]+=z;\n            tree1[i][j]+=z*(x-1);\n            tree2[i][j]+=z*(y-1);\n            tree3[i][j]+=z*(x-1)*(y-1);//\u5206\u522b\u4fee\u6539\u56db\u4e2a\u6570\u7ec4\n        }\n    }\n}\nvoid fa(long long a,long long b,long long c,long long d,long long ad)\n{\n    //\u5206\u522b\u4fee\u6539\u56db\u4e2a\u70b9\n    add(a,b,ad);add(c+1,b,-ad);\n    add(a,d+1,-ad);add(c+1,d+1,ad);\n}\nlong long ask(long long x,long long y)\n{\n    long long ans=0,ans1=0,ans2=0,ans3=0;\n    for (long long i=x;i;i-=(i&(-i)))\n    {\n        for (long long j=y;j;j-=(j&(-j)))\n        {\n            ans+=tree[i][j];\n            ans1+=tree1[i][j];\n            ans2+=tree2[i][j];\n            ans3+=tree3[i][j];\n        }\n    }\n    ans*=x*y;\t\n    //\u5206\u522b\u6c42\u548c\n    return ans-ans1*y-ans2*x+ans3;\n}\nint main()\n{\n    cin>>ch;\n    scanf(\"%d%lld\",&n,&m);\n    while (cin>>ch)\n    {\n        if (ch=='L')\n        {\n         //\u4fee\u6539\n         scanf(\"%lld%lld%lld%lld%lld\",&a,&b,&c,&d,&ad);\n          fa(a,b,c,d,ad);\n        }\n        if (ch=='k')\n        {\n        //\u67e5\u8be2\n        \tscanf(\"%lld%lld%lld%lld\",&a,&b,&c,&d);\n        \tcout<<ask(c,d)-ask(c,b-1)-ask(a-1,d)+ask(a-1,b-1)<<endl;\n        }\n    }\n    return 0;\n}\n```\n\n\u672c\u6587\u90e8\u5206\u53c2\u8003\u81ea[\u80e1\u5c0f\u5154\u7684\u535a\u5ba2](https://www.cnblogs.com/RabbitHu/p/BIT.html)\uff0c\u5e76\u611f\u8c22ta\u7684\u535a\u5ba2\u5bf9\u6211\u5b66\u4e60\u6b64\u65b9\u6cd5\u7684\u5e2e\u52a9",
        "postTime": 1528344572,
        "uid": 73990,
        "name": "fmj_123",
        "ccfLevel": 7,
        "title": "luogu-P4514-\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4"
    },
    {
        "content": "\u8fd9\u4e48\u4e00\u9053\u9898\u6211\u8c03\u4e86\u8fd9\u4e48\u957f\u65f6\u95f4\u662f\u6211\u6ca1\u60f3\u5230\u7684\u3002\u3002\u3002\n\n\u67e5\u4e86\u534a\u5929\u7ed3\u679c\u53d1\u73b0\u4e3b\u51fd\u6570\u6709\u95ee\u9898\u3002\u3002\u3002\n\n\u819c\u62dcxiaolilsq\u5e2e\u6211\u67e5\u9519\n\n\u597d\u4e86\u5199\u7bc7\u9898\u89e3\u7eaa\u5ff5\u4e00\u4e0b\n\n### 1.\u524d\u7f6e\u829d\u58eb\n\u4e8c\u7ef4BIT\n### 2.\u9898\u89e3\n\u9996\u5148\u8003\u8651\u4e00\u7ef4\u3002\n\n\u6211\u4eec\u8003\u8651\u5982\u679c\u662f\u533a\u95f4\u4fee\u6539\uff0c\u5355\u70b9\u67e5\u8be2\u600e\u4e48\u505a\u3002\n\n\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u6211\u4eec\u53ea\u8981\u7ef4\u62a4\n\n$$b_1=a_1$$\n\n\u5219\n\n$$a_i=b_i+a_{i-1}$$\n$$=\\sum_{i=1}^{n}b_i$$\n\n\u4e8e\u662f\u5957\u7528\u4e00\u7ef4BIT\u677f\u5b50\u3002\n\n\u518d\u8003\u8651\u533a\u95f4\u4fee\u6539\uff0c\u533a\u95f4\u67e5\u8be2\u600e\u4e48\u505a.\n\n\u6ce8\u610f\u5230\n\n$$\\sum_{i=1}^{n}a_i$$\n$$=\\sum_{i=1}^{n}\\sum_{j=1}^{i}b_j$$\n$$=\\sum_{j=1}^{n}b_j(n-j+1)$$\n\u4e8e\u662f\u53ea\u8981\u518d\u7ef4\u62a4\n$$c_i=b_i\\times i$$\n\u5c31\u53ef\u4ee5\u4e86\n\n---\n\n\u4e0b\u9762\u8003\u8651\u4e8c\u7ef4\u3002\n\n\u9996\u5148\u662f\u77e9\u5f62\u4fee\u6539\uff0c\u5355\u70b9\u67e5\u8be2\u3002\n\n\u6ce8\u610f\u5230\u4e8c\u7ef4\u524d\u7f00\u548c\uff0c\u6211\u4eec\u53ef\u4ee5\u4eff\u7167\u4e8c\u7ef4\u524d\u7f00\u548c\uff0c\u5b9a\u4e49\n$$b_{i,j}=a_{i,j}-a_{i,j-1}-a_{i-1,j}+a_{i-1,j-1}$$\n\u5219\n$$a_{i,j}=\\sum_{x=1}^{i}\\sum_{y=1}^{j}b_{x,y}$$\n\u7528\u4e8c\u7ef4BIT\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u518d\u8003\u8651\u77e9\u5f62\u6c42\u548c\u3002\n$$\\sum_{x=1}^{a}\\sum_{y=1}^{b}a_{x,y}$$\n$$=\\sum_{x=1}^{a}\\sum_{y=1}^{b}\\sum_{i=1}^{x}\\sum_{j=1}^{y}b_{i,j}$$\n$$=\\sum_{i=1}^{a}\\sum_{j=1}^{b}b_{i,j}(a-i+1)(b-j+1)$$\n\u6240\u4ee5\u53ea\u8981\u518d\u7ef4\u62a4\u4e00\u4e0b\n$$c_{i,j}=i\\times b_{i,j}$$\n$$d_{i,j}=j\\times b_{i,j}$$\n$$e_{i,j}=ij\\times b_{i,j}$$\n\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u4e0b\u9762\u662f\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=2055;\nint n,m,bit[N][N][4];\nvoid update(int k,int x,int y,int v){for(;x<=n;x+=x&-x)for(int j=y;j<=m;j+=j&-j)bit[x][j][k]+=v;} \nint sum(int k,int x,int y){int ret=0;for(;x;x-=x&-x)for(int j=y;j;j-=j&-j)ret+=bit[x][j][k];return ret;}\nvoid Update(int x,int y,int v){update(0,x,y,v),update(1,x,y,v*x),update(2,x,y,v*y),update(3,x,y,v*x*y);}\nint Sum(int x,int y){return sum(0,x,y)*(x+1)*(y+1)-sum(1,x,y)*(y+1)-sum(2,x,y)*(x+1)+sum(3,x,y);}\nint main(){\n\tchar op[2];\n\tscanf(\"%s%d%d\",op,&n,&m);\n\tfor(int a,b,c,d,delta;~scanf(\"%s%d%d%d%d\",op,&a,&b,&c,&d);){\n\t\tif(op[0]=='L'){\n\t\t\tscanf(\"%d\",&delta);\n\t\t\tUpdate(a,b,delta),Update(a,d+1,-delta),Update(c+1,b,-delta),Update(c+1,d+1,delta);\n\t\t}else{\n\t\t\tprintf(\"%d\\n\",Sum(c,d)-Sum(a-1,d)-Sum(c,b-1)+Sum(a-1,b-1));\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1593956649,
        "uid": 121027,
        "name": "Spasmodic",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4514 \u3010\u4e0a\u5e1d\u9020\u9898\u7684\u4e03\u5206\u949f\u3011"
    },
    {
        "content": "\u5176\u5b9e\u8fd9\u9898\u4e5f\u662f\u53ef\u4ee5\u7528cdq\u5206\u6cbb\u505a\u7684\uff08\u5438\u6c27\u6ce8\u610f\uff09\n\u4eff\u7167\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u7684\u505a\u6cd5\uff0c\u5982\u679c\u6709\u5dee\u5206\u6570\u7ec4$d[i][j]=a[i][j]-a[i-1][j]-a[i][j-1]+a[i-1][j-1]$\uff0c\u90a3\u4e48\u5c31\u6709:\n\n$$sum[x][y]=\\sum\\limits_{i=1}^{x}{\\sum\\limits_{j=1}^{y}{\\sum\\limits_{k=1}^{i}{\\sum\\limits_{l=1}^{j}{d[k][l]}}}}$$\n\n$$=\\sum\\limits_{i=1}^{x}{\\sum\\limits_{k=1}^{i}{\\sum\\limits_{j=1}^{y}{((y+1)d[k][j]-j*d[k][j])}}}$$\n\n$$=\\sum\\limits_{i=1}^{x}{\\sum\\limits_{j=1}^{y}{(x+1)(y+1)d[i][j]-(x+1)*j*d[i][j]-(y+1)*i*d[i][j]+i*j*d[i][j]}}$$\n\n\u6240\u4ee5\u628a\u8be2\u95ee\u62c6\u6210\u56db\u4e2a\u70b9\uff08\u524d\u7f00\u548c\uff09\u3001\u4fee\u6539\u62c6\u6210\u56db\u4e2a\u70b9\uff08\u5dee\u5206\uff09\n\n\u5df2\u7ecf\u6309\u65f6\u95f4\u6392\u597d\u5e8f\uff0c\u7136\u540e\u628ax\u4f5c\u4e3a\u7b2c\u4e8c\u7ef4\u6765cdq\uff0c\u4ee5y\u4e3a\u4e0b\u6807\u5f00d,id,jd,ijd\u56db\u4e2a\u6811\u72b6\u6570\u7ec4\uff0c\u7edf\u8ba1\u7b54\u6848\u5c31\u53ef\u4ee5\u4e86\n\n\u8fd9\u6837\u7684\u8bdd\uff0c\u5373\u4f7fN\u518d\u5927\u4e5f\u80fd\u505a\u4e86\uff0c\u53ea\u662f\u5e38\u6570\u6bd4\u8f83\u5927\n\n\u9644\u4e0a\u4ee3\u7801\n\n```cpp\n// luogu-judger-enable-o2\n#include<bits/stdc++.h>\n#define pa pair<int,int>\n#define CLR(a,x) memset(a,x,sizeof(a))\nusing namespace std;\ntypedef long long ll;\nconst int maxn=2100,maxm=2e5+10;\n\ninline ll rd(){\n    ll x=0;char c=getchar();int neg=1;\n    while(c<'0'||c>'9'){if(c=='-') neg=-1;c=getchar();}\n    while(c>='0'&&c<='9') x=x*10+c-'0',c=getchar();\n    return x*neg;\n}\n\nstruct Node{\n    int t,x,y,o;ll v;\n    Node(int a=0,int b=0,int c=0,int d=0,int e=0){\n        t=a,x=b,y=c,v=d,o=e;\n    }//o==1\u67e5 o==0\u6539\n}op[maxm*4],tmp[maxm*4];\nll dd[maxn],id[maxn],jd[maxn],ijd[maxn];\nll ans[maxm];\nint N,M,L;\nbool isask[maxm];\n\ninline int lowbit(int x){return x&(-x);}\ninline void add(ll *t,int x,ll y){\n    for(;x<=M;x+=lowbit(x)) t[x]+=y;\n}\ninline ll query(ll *t,int x){\n    ll re=0;for(;x;x-=lowbit(x)) re+=t[x];return re;\n}\n\nvoid cdq(int l,int r){\n    if(l==r){return;}\n    int m=l+r>>1;\n    cdq(l,m);cdq(m+1,r);\n    int p=l,q=m+1,n=0;\n    for(;q<=r;q++){\n        for(;p<=m&&op[p].x<=op[q].x;p++){\n            tmp[++n]=op[p];\n            if(op[p].o!=0) continue;\n            add(dd,op[p].y,op[p].v);\n            add(id,op[p].y,op[p].v*op[p].x);\n            add(jd,op[p].y,op[p].v*op[p].y);\n            add(ijd,op[p].y,op[p].v*op[p].x*op[p].y);\n        }\n        tmp[++n]=op[q];\n        if(op[q].o!=1) continue;\n        ll re=query(dd,op[q].y)*(op[q].x+1)*(op[q].y+1);\n        re-=query(id,op[q].y)*(op[q].y+1);\n        re-=query(jd,op[q].y)*(op[q].x+1);\n        re+=query(ijd,op[q].y);\n        ans[op[q].t]+=re*op[q].v;\n    }for(;p<=m;p++) tmp[++n]=op[p];\n    for(int p=l;p<=m&&op[p].x<=op[r].x;p++){\n        if(op[p].o!=0) continue;\n        add(dd,op[p].y,-op[p].v);\n        add(id,op[p].y,-op[p].v*op[p].x);\n        add(jd,op[p].y,-op[p].v*op[p].y);\n        add(ijd,op[p].y,-op[p].v*op[p].x*op[p].y);\n    }\n    memcpy(op+l,tmp+1,sizeof(Node)*n);\n}\n\nint main(){\n    // freopen(\"4514.in\",\"r\",stdin);\n    int i,j;\n    N=rd(),M=rd();\n    char s[5];\n    i=j=0;\n    while(~scanf(\"%s\",s)){\n        ++i;\n        int x1=rd(),y1=rd(),x2=rd(),y2=rd();\n        if(s[0]=='k'){\n            op[++j]=Node(i,x2,y2,1,1);\n            if(x1>1&&y1>1) op[++j]=Node(i,x1-1,y1-1,1,1);\n            if(x1>1) op[++j]=Node(i,x1-1,y2,-1,1);\n            if(y1>1) op[++j]=Node(i,x2,y1-1,-1,1);\n            isask[i]=1;\n        }else{\n            int dt=rd();\n            op[++j]=Node(i,x1,y1,dt,0);\n            if(x2<N&&y2<M) op[++j]=Node(i,x2+1,y2+1,dt,0);\n            if(y2<M) op[++j]=Node(i,x1,y2+1,-dt,0);\n            if(x2<N) op[++j]=Node(i,x2+1,y1,-dt,0);\n        }\n    }L=i;\n    cdq(1,j);\n    for(i=1;i<=L;i++){\n        if(isask[i]) printf(\"%lld\\n\",ans[i]); \n    }\n    return 0;\n}\n```",
        "postTime": 1539325433,
        "uid": 57266,
        "name": "__Ressed__",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4514 \u3010\u4e0a\u5e1d\u9020\u9898\u7684\u4e03\u5206\u949f\u3011"
    },
    {
        "content": "\u9996\u5148\u9898\u76ee\u80cc\u666f\u5f88\u68d2\u68d2:\n\n\u88f8\u4f53\u5c31\u610f\u5473\u7740\u8eab\u4f53$\\Rightarrow$\u88f8\u9898\u5c31\u610f\u5473\u7740\u795e\u9898\n\n\u5176\u5b9e\u8fd9\u662f\u4e00\u9053\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4+\u533a\u95f4\u4fee\u6539\u533a\u95f4\u67e5\u8be2\u7684\u88f8\u9898\u3002\n\n\u8fd9\u9898\u7a7a\u95f4\u4f1a\u5361\u6389\u4e8c\u7ef4\u7ebf\u6bb5\u6811\u3002~~(\u4e5f\u8bb8\u662f\u6211\u592a\u83dc\u4e86)~~\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u597d\u53bb\u6253\u6bd4\u8f83\u7b80\u5355\u7684\u6811\u72b6\u6570\u7ec4\u4e86\u3002\n## \u3007\u3001\u66b4\u529b\n\u542c\u8bf4\u66b4\u529b\u4e5f\u80fd~~\u62ff10\u5206~~\n## \u4e00\u3001\u6811\u72b6\u6570\u7ec4\n\u5148\u53bbAc\u6389[\u3010\u6a21\u677f\u3011\u6811\u72b6\u6570\u7ec4 1](https://www.luogu.org/problemnew/show/P3374)\u8fd9\u9898\u5148\uff0c\u4e0d\u61c2\u53bb\u770b\u8fd9\u9898\u7684\u9898\u89e3\u3002\n## \u4e8c\u3001\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\n\u8bbe\u539f\u6765\u7684\u6570\u7ec4\u4e3aa\uff0c\u6bcf\u4e00\u884c\u72ec\u81ea\u4e3a\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4b\u3002\n\n\u8fd9\u6837\u7684\u8bdd\uff1a\n$b[i][1]=a[i][1],b[i][2]=a[i][1]+a[i][2],b[i][4]=a[i][1]+a[i][2]+a[i][3]+a[i][4]...$\n\n\u8fd9\u65f6\u6211\u4eec\u518d\u8bbe\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4c\uff0c\u6309\u884c\u7ef4\u62a4b\u3002\n\n\u8fd9\u6837\u7684\u8bdd\uff1a\n$c[1][j]=b[1][j],c[2][j]=b[1][j]+b[2][j],c[4][j]=b[1][j]+b[2][j]+b[3][j]+b[4][j]...$\n\n\u4e8b\u5b9e\u4e0a\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4c\u6570\u7ec4\u5c31\u884c\u4e86\u3002\n\n\u4ee3\u7801\u5982\u4e0b:\n```c++\nvoid change(int x,int y,int s)//\u7ed9a[x][y]\u52a0\u4e0as\n{\n    for(int i=x;i<=n;i+=lowbit(i))\n    {\n        for(int j=y;j<=m;j+=lowbit(j))\n        {\n            a[i][j]+=s;\n        }\n    }\n}\nint ans(int x,int y)//\u6c421..x\uff0c1..y\u7684\u548c\n{\n    int s=0;\n    for(int i=x;i>0;i-=lowbit(i))\n    {\n        for(int j=y;j>0;j-=lowbit(j))\n        {\n            s+=a[i][j];\n        }\n    }\n    return s;\n}\n```\n## \u4e09\u3001\u533a\u95f4\u7ef4\u62a4+\u533a\u95f4\u4fee\u6539\n\n\u9996\u5148\u6709\u4e00\u4e2a\u5dee\u5206\u6570\u7ec4$b[i]=a[i]-a[i-1]$\n\n\u6709$a\\left[n\\right]=\\sum_{i=1}^nb\\left[i\\right]$\n\n\u7136\u540e\u53c8\u6709\u4e00\u4e2a\u6570\u7ec4$c[i]=i\\cdot b[i]$\n\n\u5c31\u6709$\\sum_{i=1}^na\\left[i\\right]=\\sum_{i=1}^n\\sum_{j=1}^ib\\left[i\\right]=\\sum_{i=1}^n\\left(n-i+1\\right)\\cdot b\\left[i\\right]=\\left(n+1\\right)\\sum_{i=1}^nb\\left[i\\right]-\\sum_{i=1}^nc\\left[i\\right]$\n\n\u4fee\u6539\u65f6$b[x]$\u52a0\u4e0a\u6570\uff0c$b[y+1]$\u51cf\u6389\uff0cc\u6570\u7ec4\u518d\u4e58\u4e0ai\uff0c\u90fd\u662f\u5355\u70b9\u4fee\u6539\uff0c\u6240\u4ee5\u662fO(logn)\n\n\u8ba1\u7b97\u65f6\u90fd\u662f\u533a\u95f4\u548c\uff0c\u6240\u4ee5\u4e5f\u662fO(logn)\n## \u56db\u3001\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4+\u533a\u95f4\u7ef4\u62a4+\u533a\u95f4\u4fee\u6539\n**\u9996\u5148\u6211\u770b\u4e0d\u61c2\u697c\u4e0b\u7684\u505a\u6cd5~~(\u4e5f\u8bb8\u662f\u6211\u592a\u83dc\u4e86)~~\uff0c\u6211\u7528\u4e86\u53e6\u4e00\u79cd\u63a8\u516c\u5f0f\u7684\u65b9\u6cd5**\n\n\u8bbe\u539f\u6765\u7684\u6570\u7ec4\u662f$a[i][j]$\n\n\u7136\u540e\u6709\u5dee\u5206\u6570\u7ec4$b\\left[i\\right]\\left[j\\right]=a\\left[i\\right]\\left[j\\right]-a\\left[i-1\\right]\\left[j\\right]-a\\left[i\\right]\\left[j-1\\right]+a\\left[i-1\\right]\\left[j-1\\right]$\n\n\u8fd8\u6709\u4e09\u4e2a\u795e\u5947\u7684\u6570\u7ec4\n\n$c\\left[i\\right]\\left[j\\right]=i\\cdot b\\left[i\\right]\\left[j\\right]$\n\n$d\\left[i\\right]\\left[j\\right]=j\\cdot b\\left[i\\right]\\left[j\\right]$\n\n$e\\left[i\\right]\\left[j\\right]=ij\\cdot b\\left[i\\right]\\left[j\\right]$\n\n\u8fd9\u6837\u6c42\u548c\u65f6:\n\n$\\sum_{i=1}^n\\sum_{j=1}^ma\\left[i\\right]\\left[j\\right]$\n\n$=\\sum_{i=1}^n\\sum_{j=1}^m\\sum_{k=1}^i\\sum_{l=1}^jb\\left[k\\right]\\left[l\\right]$\n\n$=\\sum_{i=1}^n\\sum_{j=1}^m\\left(n-i+1\\right)\\left(m-j+1\\right)\\cdot b\\left[i\\right]\\left[j\\right]$\n\n$=\\sum_{i=1}^n\\sum_{j=1}^m\\left(n+1\\right)\\left(m+1\\right)\\cdot b\\left[i\\right]\\left[j\\right]-\\sum_{i=1}^n\\sum_{j=1}^m\\left(m+1\\right)i\\cdot b\\left[i\\right]\\left[j\\right]-\\sum_{i=1}^n\\sum_{j=1}^m\\left(n+1\\right)j\\cdot b\\left[i\\right]\\left[j\\right]+\\sum_{i=1}^n\\sum_{j=1}^mij\\cdot b\\left[i\\right]\\left[j\\right]$\n\n$=\\left(n+1\\right)\\left(m+1\\right)\\sum_{i=1}^n\\sum_{j=1}^mb\\left[i\\right]\\left[j\\right]-\\left(m+1\\right)\\sum_{i=1}^n\\sum_{j=1}^mc\\left[i\\right]\\left[j\\right]-\\left(n+1\\right)\\sum_{i=1}^n\\sum_{j=1}^md\\left[i\\right]\\left[j\\right]+\\sum_{i=1}^n\\sum_{j=1}^me\\left[i\\right]\\left[j\\right]$\n\n\u6bcf\u6b21\u4fee\u6539\u90fd\u53ea\u8981\u7ed9$b[a][b]$\u52a0\u4e0a\uff0c\u7ed9$b[c+1][b],b[a][d+1]$\u51cf\u53bb\uff0c\u518d\u7ed9$b[c+1][d+1]$\u52a0\u4e0a\uff0c\u5e76\u7ed9c,d,e\u6570\u7ec4\u7684\u5404\u4e2a\u5730\u65b9\u90fd\u4f5c\u4fee\u6539\u3002\n\n\u6c42\u548c\u6309\u7167\u516c\u5f0f\u6765\u5c31\u597d\u4e86\u3002\n\n# \u4f46\u662f\n\n\u7531\u4e8e~~\u6211\u592a\u5783\u573e\u4e86~~\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65b9\u6cd5\u7684\u5e38\u6570\u8fc7\u5927\u3002\n\n\u88ab\u8feb\u6253\u4e86\u8bfb\u5165\u8bfb\u51fa\u4f18\u5316\u548c\u6c27\u6c14\u4f18\u5316\u3002\n\n\u4ee3\u7801\u5982\u4e0b\n```c++\n// luogu-judger-enable-o2\n#include<cstdio>\n#include<cstring>\nusing namespace std;\ninline void read(int &x)\n{\n    x=0;int f=1;\n    char c=getchar();\n    while(c<'0'||c>'9'){c=='-'?f=-1:1;c=getchar();}\n    while(c>='0'&&c<='9'){x=x*10+c-'0';c=getchar();}\n    x=x*f;\n}\ninline void write(int x)\n{\n    if(x<0){putchar('-');x=-x;}\n    int y=10;\n    while(y<=x)y=y*10;\n    while(y!=1){y=y/10;putchar(x/y+'0');x=x%y;}\n    putchar('\\n');\n}\nint n,m;\nint b[2050][2050],c[2050][2050],d[2050][2050],e[2050][2050];\ninline int lowbit(int x){return x&-x;}\nvoid change(int x,int y,int s,int (*a)[2050])\n{\n    for(int i=x;i<=n;i+=lowbit(i))\n    {\n        for(int j=y;j<=m;j+=lowbit(j))\n        {\n            a[i][j]+=s;\n        }\n    }\n}\nint ans(int x,int y,int (*a)[2050])\n{\n    int s=0;\n    for(int i=x;i>0;i-=lowbit(i))\n    {\n        for(int j=y;j>0;j-=lowbit(j))\n        {\n            s+=a[i][j];\n        }\n    }\n    return s;\n}\nchar cs[11];\nint main()\n{\n    int i,j,x,y;\n    scanf(\"%s\",cs+1);\n    read(n);read(m);\n    while(scanf(\"%s\",cs+1)!=EOF)\n    {\n        read(i);read(j);read(x);read(y);\n        if(cs[1]=='L')\n        {\n            int gc;read(gc);\n            change(i,j,gc,b);change(i,y+1,-gc,b);\n            change(x+1,j,-gc,b);change(x+1,y+1,gc,b);\n            change(i,j,i*gc,c);change(i,y+1,-i*gc,c);\n            change(x+1,j,-(x+1)*gc,c);change(x+1,y+1,(x+1)*gc,c);\n            change(i,j,j*gc,d);change(i,y+1,-(y+1)*gc,d);\n            change(x+1,j,-j*gc,d);change(x+1,y+1,(y+1)*gc,d);\n            change(i,j,i*j*gc,e);change(i,y+1,-i*(y+1)*gc,e);\n            change(x+1,j,-(x+1)*j*gc,e);change(x+1,y+1,(x+1)*(y+1)*gc,e);\n        }\n        else\n        {\n            int at,bt,ct,dt;\n            at=i*j*ans(i-1,j-1,b)-j*ans(i-1,j-1,c)-i*ans(i-1,j-1,d)+ans(i-1,j-1,e);\n            bt=(x+1)*j*ans(x,j-1,b)-j*ans(x,j-1,c)-(x+1)*ans(x,j-1,d)+ans(x,j-1,e);\n            ct=i*(y+1)*ans(i-1,y,b)-(y+1)*ans(i-1,y,c)-i*ans(i-1,y,d)+ans(i-1,y,e);\n            dt=(x+1)*(y+1)*ans(x,y,b)-(y+1)*ans(x,y,c)-(x+1)*ans(x,y,d)+ans(x,y,e);\n            write(dt-ct-bt+at);\n        }\n    }\n    return 0;\n}\n```",
        "postTime": 1525588999,
        "uid": 65849,
        "name": "zhoufangyuanPT",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4514 \u3010\u4e0a\u5e1d\u9020\u9898\u7684\u4e03\u5206\u949f\u3011"
    },
    {
        "content": "\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u7684\u5199\u6cd5,\u5176\u4ed6julao\u5df2\u7ecf\u4ecb\u7ecd\u5f97\u76f8\u5f53\u900f\u5f7b\u4e86,\n\n\u5728\u6b64\u5c31\u4e0d\u591a\u505a\u4ecb\u7ecd\u4e86\n\n\u6b64\u5904\u4ec5\u4ecb\u7ecd\u4e8c\u7ef4\u7ebf\u6bb5\u6811\u7684\u4e00\u4e2a\u5947\u602a\u5199\u6cd5.\n\n\u4e8c\u7ef4\u7ebf\u6bb5\u6811\u660e\u663e\u5e38\u6570\u652f\u6491\u4e0d\u4e86\u8fd9\u9053\u9898,\u65f6\u7a7a\u4e24\u7206\u70b8,\u5438\u6c27\u5feb\u8bfb\u4e5f\u53ea\u80fd\u8fc7**\u4e94\u4e2a\u70b9**\n\n\u4f46\u7528\u4ee5\u4e0b\u5199\u6cd5,\u53ef\u4ee5\u5927\u5927\u4f18\u5316\u65f6\u7a7a\u95f4,\u4e22\u6389MLE,\u80fd\u8fc7**\u516d\u4e2a\u70b9**\n\n~~\u7136\u800c\u8fd8\u662f\u6ca1\u8fc7~~\n\n\u8fd9\u4e2a\u5199\u6cd5\u7075\u611f\u6765\u81ea\u6d1b\u8c37\u65e5\u62a5\n\n [\u6d1b\u8c37\u65e5\u62a5#162 C++ template(\u6a21\u677f) \u521d\u63a2](https://www.luogu.org/blog/z3475/c-template-mu-ban-chu-tan)\n\n\u5728\u91cc\u9762,\u7ebf\u6bb5\u6811\u901a\u8fc7\u6a21\u677f\u7279\u5316,\u4f9d\u9760\u7f16\u8bd1\u5668\u5b8c\u6210\u521d\u59cb\u5316\n\n\u5bf9\u4e8e\u4e8c\u7ef4\u7ebf\u6bb5\u6811,\u4e5f\u53ef\u4ee5\u8fd9\u4e48\u505a\n\n\u9996\u5148\u5199\u51fa\u4e00\u822c\u8282\u70b9\u7684\u6a21\u677f\n\n```cpp\n#define u unsigned\n#define s short \n#define fx(p) (fx>p.fromx? fx:p.fromx)\n#define fy(p) (fy>p.fromy? fy:p.fromy)\n#define tx(p) (tx<p.tox?   tx:p.tox)\n#define ty(p) (ty<p.toy?   ty:p.toy)\ntemplate<u char floor>//floor\u5373\u8282\u70b9\u7684\u9ad8\u5ea6,\u5b83\u9650\u5236\u4e86\u7ebf\u6bb5\u6811\u7684\u9ad8\u5ea6\nstruct segment_tree{\n    u s fromx,tox,fromy,toy;\n    int h,lazy_tag;\n\tsegment_tree<floor-1> ll,lr,rl,rr;//\u4e0b\u884c\u5efa\u6811\n\tsegment_tree(){h=lazy_tag=0;}\n\tinline void getid(u s fx,u s fy,u s tx,u s ty){\n\t\tfromx=fx,fromy=fy,tox=tx,toy=ty;\n\t\tll.getid(fx,fy,(fx+tx)>>1,(fy+ty)>>1);\n\t\tlr.getid(fx,ll.toy+1,(fx+tx)>>1,ty);\n\t\trl.getid(ll.tox+1,fy,tx,(fy+ty)>>1);\n\t\trr.getid(ll.tox+1,ll.toy+1,tx,ty);\n\t}//\u521d\u59cb\u5316\u8282\u70b9\u8303\u56f4\n\tinline void plus(u s fx,u s fy,u s tx,u s ty,int num){\n\t\th+=((tx-fx+1)*(ty-fy+1)*num);//\u66f4\u65b0\u548c\n\t\tif(fx==fromx&&tx==tox&&fy==fromy&&ty==toy){\n\t\t\tlazy_tag+=num;//\u6253\u6807\u8bb0\n\t\t\treturn;\n\t\t}\n\t\tif(fx<=ll.tox&&fy<=ll.toy)  ll.plus(fx,fy,tx(ll),ty(ll),num);\n\t\tif(fx<=lr.tox&&lr.fromy<=ty) lr.plus(fx,fy(lr),tx(lr),ty,num);\n\t\tif(rl.fromx<=tx&&fy<=rl.toy) rl.plus(fx(rl),fy,tx,ty(rl),num);\n\t\tif(rr.fromx<=tx&&rr.fromy<=ty)rr.plus(fx(rr),fy(rr),tx,ty,num;\n        //\u4e0b\u884c \n\t}//\u533a\u95f4\u52a0\n\tinline int sum(u s fx,u s fy,u s tx,u s ty){\n\t\tif(fx==fromx&&tx==tox&&fy==fromy&&ty==toy) return h;\n\t\tregister int h=(tx-fx+1)*(ty-fy+1)*lazy_tag;//\u6807\u8bb0\u6c38\u4e45\u5316\n\t\tif(fx<=ll.tox&&fy<=ll.toy)   h+=ll.sum(fx,fy,tx(ll),ty(ll));\n\t\tif(fx<=lr.tox&&lr.fromy<=ty)  h+=lr.sum(fx,fy(lr),tx(lr),ty);\n\t\tif(rl.fromx<=tx&&fy<=rl.toy)  h+=rl.sum(fx(rl),fy,tx,ty(rl));\n\t\tif(rr.fromx<=tx&&rr.fromy<=ty) h+=rr.sum(fx(rr),fy(rr),tx,ty);\n        //\u4e0b\u884c \n\t\treturn h;\n\t}//\u6c42\u533a\u95f4\u548c\n};\n#undef fx\n#undef fy\n#undef tx\n#undef ty\n#undef u\n#undef s\n```\n\n\u7136\u540e\u7279\u5316\u6700\u5e95\u5c42\u7684\u8282\u70b9\n\n```cpp\n#define u unsigned\n#define s short\ntemplate<>\nstruct segment_tree<0>{//\u7279\u5316\u9ad8\u5ea6\u4e3a\u96f6\u7684\u8282\u70b9\n\tint h;\n\tu s fromx,fromy,tox,toy;\n\tsegment_tree(){h=0;}\n\tinline void getid(u s fx,u s fy,u s tx,u s ty){\n        fromx=fx,fromy=fy,tox=tx,toy=ty;\n    }//\u5e95\u5c42\u8282\u70b9\u4e0d\u9700\u8981\u5b50\u8282\u70b9\n\tinline void plus(u s fx,u s fy,u s tx,u s ty,int num){h+=num;}\n   //\u5e95\u5c42\u8282\u70b9\u53ea\u9700\u5355\u7eaf\u7684\u52a0\u548c\u6c42\u548c\n\tinline int sum(u s fx,u s fy,u s tx,u s ty){return h;}\n};\n#undef u\n#undef s\n```\n\n\u7531\u6b64,\u4e00\u68f5\u4e8c\u7ef4\u7ebf\u6bb5\u6811\u5c31\u9020\u597d\u4e86\n\n\u8fd9\u4e48\u5199\u4e8c\u7ef4\u7ebf\u6bb5\u6811\u6709\u8bf8\u591a\u597d\u5904\n\n1. \u7801\u91cf\u5c0f,\u4e00\u767e\u6765\u884c\u7684\u4e8c\u7ef4\u7ebf\u6bb5\u6811,\u53ea\u9700\u516d\u5341\u6765\u884c\n\n\t(\u51fd\u6570\u8fd0\u884c\u901f\u5ea6\u4e5f\u56e0\u6b64\u5927\u5927\u63d0\u9ad8)\n\n2. \u9884\u5904\u7406\u7531\u7f16\u8bd1\u5668\u81ea\u52a8\u5b8c\u6210(\u867d\u7136\u65e0\u6cd5\u8f93\u5165,\u4f46\u8fd9\u9053\u9898\u672c\u6765\u5c31\u4e0d\u9700\u8981)\n\n3. \u5e38\u6570\u5c0f.\u5185\u90e8\u662f\u7531\u5d4c\u5957\u7c7b\u5b9e\u73b0\u7684,\u7701\u53bb\u4e86\u6570\u7ec4\u4e0b\u6807(4\u5b57\u8282)/\u6307\u9488(8\u5b57\u8282)\n\t\u53ea\u9700\u5b58\u50a8\u4e00\u4e2a\u9ad8\u5ea6\u5e38\u91cf(1\u5b57\u8282),\u5e95\u5c42\u8282\u70b9\u8fd8\u65e0\u9700\u52a0\u6807\u8bb0,\u907f\u514dMLE\n    \n\u4e8e\u662f,\u6700\u7b80\u5355\u7684\u4e8c\u7ef4\u7ebf\u6bb5\u6811\u4ee3\u7801\u8bde\u751f\u4e86!(105\u884c)\n\n```cpp\n// luogu-judger-enable-o2\n#pragma GCC optimize(3,\"Ofast\")\n#include<cstdio>\nusing namespace std;\n#define getchar()(p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline long long r32(){\n\tregister char c=getchar();\n\tregister short w=1;\n\twhile('0'>c||c>'9'){\n\t\tif(c=='-') w=-1;\n\t\tc=getchar();\n\t}\n\tregister int a=0;\n\twhile('0'<=c&&c<='9'){\n\t\ta=a*10+(c-'0');\n\t\tc=getchar();\n\t}\n\treturn a*w;\n}//\u5feb\u8bfb \n#define u unsigned\n#define s short \n#define fx(p) (fx>p.fromx? fx:p.fromx)\n#define fy(p) (fy>p.fromy? fy:p.fromy)\n#define tx(p) (tx<p.tox?   tx:p.tox)\n#define ty(p) (ty<p.toy?   ty:p.toy)//\u6279\u91cf\u5b8f\u5b9a\u4e49 \ntemplate<u char floor>//floor\u5373\u8282\u70b9\u7684\u9ad8\u5ea6,\u5b83\u9650\u5236\u4e86\u7ebf\u6bb5\u6811\u7684\u9ad8\u5ea6\nstruct segment_tree{\n    u s fromx,tox,fromy,toy;\n    int h,lazy_tag;\n\tsegment_tree<floor-1> ll,lr,rl,rr;//\u4e0b\u884c\u5efa\u6811\n\tsegment_tree(){h=lazy_tag=0;}\n\tinline void getid(u s fx,u s fy,u s tx,u s ty){\n\t\tfromx=fx,fromy=fy,tox=tx,toy=ty;\n\t\tll.getid(fx,fy,(fx+tx)>>1,(fy+ty)>>1);\n\t\tlr.getid(fx,ll.toy+1,(fx+tx)>>1,ty);\n\t\trl.getid(ll.tox+1,fy,tx,(fy+ty)>>1);\n\t\trr.getid(ll.tox+1,ll.toy+1,tx,ty);\n\t}//\u521d\u59cb\u5316\u8282\u70b9\u8303\u56f4\n\tinline void plus(u s fx,u s fy,u s tx,u s ty,int num){\n\t\th+=((tx-fx+1)*(ty-fy+1)*num);//\u66f4\u65b0\u548c\n\t\tif(fx==fromx&&tx==tox&&fy==fromy&&ty==toy){\n\t\t\tlazy_tag+=num;//\u6253\u6807\u8bb0\n\t\t\treturn;\n\t\t}\n\t\tif(fx<=ll.tox&&fy<=ll.toy)  ll.plus(fx,fy,tx(ll),ty(ll),num);\n\t\tif(fx<=lr.tox&&lr.fromy<=ty) lr.plus(fx,fy(lr),tx(lr),ty,num);\n\t\tif(rl.fromx<=tx&&fy<=rl.toy) rl.plus(fx(rl),fy,tx,ty(rl),num);\n        //\u4e0b\u884c \n\t\tif(rr.fromx<=tx&&rr.fromy<=ty)rr.plus(fx(rr),fy(rr),tx,ty,num);\n\t}//\u533a\u95f4\u52a0\n\tinline int sum(u s fx,u s fy,u s tx,u s ty){\n\t\tif(fx==fromx&&tx==tox&&fy==fromy&&ty==toy) return h;\n\t\tregister int h=(tx-fx+1)*(ty-fy+1)*lazy_tag;//\u6807\u8bb0\u6c38\u4e45\u5316\n\t\tif(fx<=ll.tox&&fy<=ll.toy)   h+=ll.sum(fx,fy,tx(ll),ty(ll));\n\t\tif(fx<=lr.tox&&lr.fromy<=ty)  h+=lr.sum(fx,fy(lr),tx(lr),ty);\n\t\tif(rl.fromx<=tx&&fy<=rl.toy)  h+=rl.sum(fx(rl),fy,tx,ty(rl));\n\t\tif(rr.fromx<=tx&&rr.fromy<=ty) h+=rr.sum(fx(rr),fy(rr),tx,ty);\n        //\u4e0b\u884c \n\t\treturn h;\n\t}//\u6c42\u533a\u95f4\u548c\n};\n#undef fx\n#undef fy\n#undef tx\n#undef ty\ntemplate<>\nstruct segment_tree<0>{\n\tint h;\n\tu short fromx,fromy,tox,toy;\n\tsegment_tree(){h=0;}\n\tinline void getid(u short fx,u short fy,u short tx,u short ty){fromx=fx,fromy=fy,tox=tx,toy=ty;}\n\tinline void plus(u short fx,u short fy,u short tx,u short ty,int num){h+=num;}\n\tinline int sum(u short fx,u short fy,u short tx,u short ty){return h;}\n};\nsegment_tree<11> tree;\n//\u5b9a\u4e49\u4e00\u4e2a11\u5c42\u7684\u4e8c\u7ef4\u7ebf\u6bb5\u6811,\u53732048*2048 \nint main(){\n\ttree.getid(1,1,2048,2048);\n\tregister u short n=r32();\n\tregister u short m=r32();\n\t//\u8f93\u5165\u8303\u56f4 \n\tregister u short a,b,c,d;\n\tregister int delta;\n\tregister char cha;\n\twhile(1){\n\t\tcha=getchar();\n\t\twhile(cha!='L'&&cha!='k'&&cha!=EOF) cha=getchar();\n\t\tif(cha==EOF) return 0;\n\t\ta=r32();\n\t\tb=r32();\n\t\tc=r32();\n\t\td=r32();\n\t\tif(cha=='L'){\n\t\t\tdelta=r32();\n\t\t\ttree.plus(a,b,c,d,delta);\n\t\t\t//\u533a\u95f4\u52a0 \n\t\t}\n\t\telse{\n\t\t\tdelta=tree.sum(a,b,c,d);\n\t\t\tprintf(\"%d\\n\",delta);\n\t\t\t//\u533a\u95f4\u6c42\u548c \n\t\t}\n\t}\n}\n```",
        "postTime": 1565344315,
        "uid": 104726,
        "name": "wangrx",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4514 \u3010\u4e0a\u5e1d\u9020\u9898\u7684\u4e03\u5206\u949f\u3011"
    },
    {
        "content": "### CDQ \u5206\u6cbb\u5957\u626b\u63cf\u7ebf\r\n###### \u65e0 O2 \u5355\u70b9\u65f6\u95f4 $\\leq$ 800ms\r\n------------\r\n#### \u524d\u8a00\r\n\r\n\u8fd9\u9053\u9898\u5f88\u6709\u540d\uff0c\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u7684\u677f\u9898\u2014\u2014\u5f53\u7136\uff0c\u8fd9\u7bc7\u9898\u89e3\u4e0d\u662f\u5173\u4e8e\u5b83\u7684\u3002\r\n\r\n\u611f\u8c22 @[H_Kaguya](https://www.luogu.com.cn/user/663405) \u548c @[yllcm](https://www.luogu.com.cn/user/682934) \u6307\u6559\u626b\u63cf\u7ebf\u76f8\u5173\u95ee\u9898\u3002\r\n\r\n\u524d\u7f6e\u77e5\u8bc6\uff1a\u5dee\u5206\u3001\u7ebf\u6bb5\u6811\u3001\u6811\u72b6\u6570\u7ec4\u3001\u626b\u63cf\u7ebf\u3001CDQ \u5206\u6cbb\u3002\r\n\r\n------------\r\n#### \u7ebf\u6bb5\u6811 + \u626b\u63cf\u7ebf\r\n\r\n\u4f7f\u7528\u626b\u63cf\u7ebf\u3001\u7ebf\u6bb5\u6811\u548c\u5dee\u5206\u79bb\u7ebf\u89e3\u51b3\u9759\u6001\u95ee\u9898\uff1a\u5e73\u9762\u52a0**\u4e4b\u540e**\u5e73\u9762\u6c42\u548c\u3002\r\n\r\n\u626b\u63cf\u7ebf\u7684\u6536\u76ca\uff1a\u95ee\u9898\u964d\u4e00\u7ef4\uff0c\u7ef4\u62a4\u4e00\u4e2a\u4e00\u7ef4\u7ebf\u6bb5\u6811\u5373\u53ef\u3002\r\n\r\n\u626b\u63cf\u7ebf\u7684\u4ee3\u4ef7\uff1a\u95ee\u9898\u8f6c\u4e3a\u5728\u7ebf\uff0c\u6240\u4ee5\u626b\u63cf\u7ebf\u53ea\u80fd\u7528\u4e00\u6b21\u3002\r\n\r\n\u5c06\u4fee\u6539\u548c\u67e5\u8be2\u6309\u7167\u67d0\u4e2a\u5750\u6807\u8f74\u5dee\u5206\u6210\u4e24\u4e2a\u5e73\u9762\u4fee\u6539\u6216\u5e73\u9762\u67e5\u8be2\uff08\u5c06\u77e9\u5f62\u62c6\u6210\u4e24\u4e2a\u7b49\u957f\u5bf9\u8fb9\uff09\uff0c\u672c\u6587\u4e2d\u626b\u63cf\u7ebf\u5168\u90e8\u6309 y \u8f74\u5dee\u5206\u4e14\u6309\u7167 y \u8f74\u5750\u6807\u4ece\u5c0f\u5230\u5927\u626b\u63cf\u3002\r\n\r\n\u4e3a\u4fdd\u8bc1\u7b54\u6848\u6b63\u786e\uff0c\u5dee\u5206\u65f6\u5c06\u8be2\u95ee\u4e2d\u9ad8\u5ea6\u8f83\u5c0f\u4e00\u8fb9\u9ad8\u5ea6 $-1$\uff0c\u4fee\u6539\u4e2d\u9ad8\u5ea6\u8f83\u5927\u4e00\u8fb9\u9ad8\u5ea6 $+1$\uff0c\u7b49\u9ad8\u5ea6\u7684\u60c5\u51b5\u5148\u6267\u884c\u4fee\u6539\u64cd\u4f5c\u3002\r\n\r\n\u4f7f\u7528\u4e24\u6b21\u626b\u63cf\u7ebf\uff0c\u7b2c\u4e00\u6b21\u626b\u63cf\u65f6\u76f4\u63a5\u6267\u884c\u4fee\u6539\uff0c\u5728\u67e5\u8be2\u65f6\u5c06\u8d21\u732e\u4e58\u4ee5\u8be5\u67e5\u8be2\u7684 y \u8f74\u5750\u6807 $+1$\uff08\u67e5\u8be2\u7684 y \u8f74\u5750\u6807\u4fee\u6539\u540e\u53ef\u80fd\u662f $0$\uff0c\u4e24\u6b21\u7edf\u8ba1\u65f6\u7ebf\u6bb5\u6811\u4e2d\u7684\u4fe1\u606f\u53ef\u80fd\u4e0d\u7b49\uff09\uff0c\u540c\u4e00\u67e5\u8be2\u5148\u51cf\u540e\u52a0\u3002\u7b2c\u4e00\u6b21\u626b\u63cf\u7ebf\u7684\u4fee\u6539\u5982\u679c\u5168\u90e8\u6267\u884c\uff0c\u7ebf\u6bb5\u6811\u4f1a\u81ea\u884c\u6e05\u7a7a\u3002\u7b2c\u4e8c\u6b21\u626b\u63cf\u65f6\u5c06\u4fee\u6539\u7684\u8d21\u732e\u4e58\u4ee5\u5176 y \u8f74\u5750\u6807\uff0c\u540c\u4e00\u67e5\u8be2\u5148\u52a0\u540e\u51cf\uff0c\u7ebf\u6bb5\u6811\u4e0d\u4f1a\u6e05\u7a7a\u8fd9\u6b21\u626b\u63cf\u7684\u4fee\u6539\uff08\u5dee\u5206\u540e\u7684\u4fee\u6539\u5e26\u4e86\u9ad8\u5ea6\u6743\u503c\uff09\u3002\r\n\r\n\u53ef\u4ee5\u611f\u6027\u7406\u89e3\u4e3a\u7b2c\u4e00\u6b21\u7edf\u8ba1\u67e5\u8be2\u8303\u56f4\u5185\u201c\u4e0d\u5b8c\u6574\u201d\u7684\u77e9\u5f62\uff0c\u7b2c\u4e8c\u6b21\u7edf\u8ba1\u67e5\u8be2\u8303\u56f4\u5185\u201c\u5b8c\u6574\u201d\u7684\u77e9\u5f62\u5e76\u4e14\u53bb\u6389\u7b2c\u4e00\u6b21\u626b\u63cf\u52a0\u5165\u7684\u591a\u4f59\u8d21\u732e\u3002\r\n\r\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a $O(n\\log n)$\u3002\r\n\r\n[Code](https://www.luogu.com.cn/paste/pkm4y5fh)\uff1a\u626b\u63cf\u7ebf\u89e3\u51b3\u9759\u6001\u4e8c\u7ef4\u5e73\u9762\u52a0 & \u5e73\u9762\u6c42\u548c\u3002\r\n\r\nPS\uff1a\u5199\u5f97\u8fd9\u4e48\u591a\u662f\u56e0\u4e3a\u7f51\u4e0a\u6ca1\u6709\u591a\u5c11\u6587\u7ae0\u8bb2\u8fd9\u4e2a\uff0c\u81f3\u5c11\u7b14\u8005\u5b66\u4e60\u7684\u65f6\u5019\u6ca1\u6709\u627e\u5230\u3002\r\n\r\n------------\r\n#### CDQ \u5206\u6cbb\u548c\u8fdb\u4e00\u6b65\u4f18\u5316\r\n\r\n\u8fd9\u9053\u9898\u5e76\u975e\u9759\u6001\u95ee\u9898\uff0c\u4f46 CDQ \u5206\u6cbb\u53ef\u4ee5\u505a\u5230\u5316\u52a8\u4e3a\u9759\uff0c\u5f53\u7136\uff0c\u9700\u8981\u79bb\u7ebf\u5904\u7406\u3002\r\n\r\n\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u5212\u51fa\u5206\u6cbb\u7ebf\uff0c\u5904\u7406\u5206\u6cbb\u7ebf\u5de6\u4fa7\u4fee\u6539\u64cd\u4f5c\u5bf9\u5206\u6cbb\u7ebf\u53f3\u4fa7\u67e5\u8be2\u64cd\u4f5c\u7684\u8d21\u732e\u5373\u53ef\uff0c\u626b\u63cf\u7ebf\u7684\u4f7f\u7528\u65b9\u6cd5\u4e0a\u6587\u5df2\u7ecf\u8bb2\u4e86\u3002\u5173\u4e8e CDQ \u5206\u6cbb\uff0c\u5177\u4f53\u89e3\u91ca\u548c\u4f7f\u7528\u65b9\u6cd5\u53ef\u4ee5\u770b [OI Wiki](https://oi-wiki.org/misc/cdq-divide/)\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\u4e0d\u80fd\u91cd\u590d\u7edf\u8ba1\u8d21\u732e\uff0c\u800c\u4e14\u8981\u6309\u65f6\u95f4\u987a\u5e8f\u8fdb\u884c\u64cd\u4f5c\u3002\r\n\r\n\u5206\u6cbb\u6267\u884c $\\log n$ \u5c42\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2 n)$\u3002\r\n\r\n\u6ce8\u610f\uff1a\u7b2c\u4e8c\u6b21\u626b\u63cf\u4e4b\u540e\u6e05\u7a7a\u6570\u636e\u7ed3\u6784\u3002\r\n\r\n[Code](https://www.luogu.com.cn/paste/7mbt341x)\uff1a\u6734\u7d20\u4ee3\u7801\uff0c\u8be2\u95ee\u548c\u4fee\u6539\u4f7f\u7528\u4e86\u540c\u6837\u7684\u7ed3\u6784\u4f53\u3002[\u8bc4\u6d4b\u8bb0\u5f55](https://www.luogu.com.cn/record/102064908)\uff0c[\u5438\u6c27\u53ef\u8fc7](https://www.luogu.com.cn/record/102065532)\u3002\r\n\r\n\u4f46\u662f\u5982\u679c\u8981\u5438\u6c27\u624d\u80fd\u901a\u8fc7\uff0c\u8fd9\u7bc7\u6587\u7ae0\u5c31\u6ca1\u6709\u610f\u4e49\u4e86\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u5199\u6b63\u89e3\u5462\uff1f~~\u6211\u81ea\u5df1\u63a8\u4e0d\u51fa\u6765\u6b63\u89e3\u7684\u5f0f\u5b50~~\u3002\r\n\r\n\u5f00\u59cb\u4f18\u5316\uff0c\u9996\u5148\u6ce8\u610f\u5230\u5206\u6cbb\u8fc7\u7a0b\u4e2d\u5bf9\u4e00\u4e2a\u64cd\u4f5c\u5dee\u5206\u4e86\u5f88\u591a\u6b21\uff0c\u800c\u66f4\u788d\u773c\u7684\u662f\u5939\u5728\u5206\u6cbb\u51fd\u6570\u91cc\u9762\u7684 ```sort```\uff0c\u5b83\u4e0d\u5f71\u54cd\u590d\u6742\u5ea6\uff0c\u4f46\u5e26\u6765\u4e86\u5de8\u5927\u7684\u5e38\u6570\uff0c\u53e6\u5916\u7ebf\u6bb5\u6811\u9700\u8981\u5f00 ```long long```\uff0c\u4e5f\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u5f71\u54cd\u4e86\u7a0b\u5e8f\u6548\u7387\u3002\r\n\r\n\u6b64\u65f6\u74f6\u9888\u5e94\u8be5\u5728 ```sort```\u3002\u8003\u8651\u5982\u4f55\u53bb\u6389\u5b83\uff0c\u53ef\u4ee5\u4f7f\u7528 CDQ \u5206\u6cbb\u7684\u5e38\u89c1\u5957\u8def\uff1a\u5f52\u5e76\u6392\u5e8f\u4f18\u5316\u3002\u5206\u6cbb\u7ebf\u5de6\u8fb9\u7684\u64cd\u4f5c\u65e0\u8bba\u5982\u4f55\u90fd\u6bd4\u53f3\u8fb9\u7684\u67e5\u8be2\u66f4\u65e9\u6267\u884c\uff0c\u53ef\u4ee5\u5148\u9012\u5f52\u5de6\u534a\u8fb9\u548c\u53f3\u534a\u8fb9\uff0c\u626b\u63cf\u7ebf\uff0c\u5f52\u5e76\u5de6\u53f3\u533a\u95f4\u3002\u5b9e\u73b0\u540e\u5373\u53ef\u5220\u9664 ```sort```\u3002\r\n\r\n\u95ee\u9898\u51fa\u73b0\uff1a\u64cd\u4f5c\u5dee\u5206\u4e4b\u540e\u624d\u80fd\u6392\u5e8f\u3002\r\n\r\n\u628a\u64cd\u4f5c\u5dee\u5206\u4e4b\u540e\u518d\u5206\u6cbb\u4e0d\u5c31\u884c\u4e86\uff1f\u5f88\u9057\u61be\uff0c\u76f4\u63a5\u8fd9\u6837\u505a\u4f1a\u7a3b\u82b1\u9999\u91cc\u8bf4\u4e30\u5e74\u2014\u2014\u626b\u63cf\u7ebf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u540c\u4e00\u4e2a\u67e5\u8be2\u6216\u4fee\u6539\u64cd\u4f5c\u5dee\u5206\u540e\u4e0d\u80fd\u5206\u5f00\u3002\r\n\r\n\u82e6\u601d\u51a5\u60f3\uff082min\uff09\u540e\uff0c\u60f3\u5230 FFT\uff0c\u53d1\u73b0\u7528 $2$ \u7684\u6574\u6570\u6b21\u5e42\u4f5c\u5206\u6cbb\u603b\u957f\u5ea6\u65f6\u5206\u6cbb\u6811\u4e3a\u5b8c\u7f8e\u4e8c\u53c9\u6811\uff0c\u540c\u4e00\u4e2a\u64cd\u4f5c\u5dee\u5206\u540e\u4e0d\u4f1a\u5206\u5f00\uff0c\u540c\u65f6\u7531\u4e8e\u5206\u6cbb\u957f\u5ea6\u4e3a $2$ \u65f6\u5fc5\u5b9a\u4e3a\u540c\u4e00\u64cd\u4f5c\u7684\u5dee\u5206\uff0c\u81ea\u7136\u6ee1\u8db3\u6392\u5e8f\u6761\u4ef6\uff0c\u9012\u5f52\u5c42\u6570\u53ef\u4ee5\u51cf\u5c11\u4e00\u5c42\u3002\u7528\u7a7a\u64cd\u4f5c\u586b\u5145\u5e8f\u5217\u76f4\u5230\u603b\u957f\u5ea6\u4e3a $2$ \u7684\u6574\u6570\u6b21\u5e42\u5373\u53ef\u3002\r\n\r\n\u989d\u5916\u4f18\u5316\uff1a\u53ea\u6709\u533a\u95f4\u5185\u540c\u65f6\u5b58\u5728\u4fee\u6539\u548c\u67e5\u8be2\u65f6\u624d\u4f1a\u5f71\u54cd\u7b54\u6848\uff0c\u7528\u524d\u7f00\u548c\u5224\u65ad\u4e00\u4e0b\u3002\r\n\r\n[Code](https://www.luogu.com.cn/paste/vlffs9bq)\uff1a\u6b64\u65f6\u7684\u4ee3\u7801\u5df2\u7ecf\u80fd\u901a\u8fc7[\u516d\u4e2a\u6d4b\u8bd5\u70b9](https://www.luogu.com.cn/record/102085539)\u3002\r\n\r\n\u6700\u540e\u7684\u74f6\u9888\u662f\u7ebf\u6bb5\u6811\uff0c\u6362\u6210\u533a\u95f4\u52a0\u533a\u95f4\u6c42\u548c\u7684\u6811\u72b6\u6570\u7ec4\u5373\u53ef\uff0c\u4e5f\u4e0d\u7528\u5f00 ```long long``` \u4e86\u3002\u6700\u540e\u7684\u6700\u540e\uff0c\u8fd8\u662f\u5199\u4e86\u6811\u72b6\u6570\u7ec4\u3002\r\n\r\n[AC Code](https://www.luogu.com.cn/paste/hb9p4t6m)\uff1a[\u8bc4\u6d4b\u8bb0\u5f55](https://www.luogu.com.cn/record/102086860)\u3002\r\n\r\n------------\r\n#### \u603b\u7ed3\r\n\r\n\u6548\u7387\u6bd4\u6b63\u89e3\u5dee\uff0c\u4e5f\u8bb8\u8bfb\u8005\u4f1a\u8ba4\u4e3a\u8fd9\u79cd\u89e3\u6cd5\u4e0d\u5f88\u503c\u5f97\u5b66\u4e60\uff0c\u4f46\u662f\u4f5c\u4e3a\u79bb\u7ebf\u7b97\u6cd5\uff0c\u5b83\u4e5f\u6709\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u6ca1\u6709\u7684\u4f18\u70b9\u3002\r\n\r\n- \u7edf\u8ba1\u8d21\u732e\u4e0d\u53d7 y \u8f74\u503c\u57df\u5f71\u54cd\uff1a\u8fd9\u4e00\u7ef4\u88ab\u626b\u63cf\u7ebf\u626b\u6389\u4e86\uff0c\u6570\u636e\u7ed3\u6784\u4e0d\u9700\u8981\u5173\u5fc3\u5b83\uff0c\u5b83\u7684\u503c\u57df\u4e5f\u4e0d\u5f71\u54cd\u626b\u63cf\u7ebf\u8fdb\u884c\u3002\r\n- \u7edf\u8ba1\u8d21\u732e\u4e0d\u53d7 x \u8f74\u503c\u57df\u5f71\u54cd\uff1a\u4f7f\u7528\u503c\u57df\u79bb\u6563\u7ebf\u6bb5\u6811\u8bb0\u5f55\u533a\u95f4\uff0c\u533a\u95f4\u52a0\u65f6\u5c06\u52a0\u503c\u4e58\u4ee5\u533a\u95f4\u7684\u5b9e\u9645\u957f\u5ea6\uff0c\u8fd9\u662f\u6811\u72b6\u6570\u7ec4\u8f7b\u6613\u4e0d\u80fd\u5b9e\u73b0\u7684\u529f\u80fd\u3002\r\n\r\n\u672c\u9898\u867d\u7136\u662f\u4e13\u95e8\u4e3a\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u8bbe\u8ba1\u7684\uff0c\u4f46 CDQ \u5206\u6cbb\u5957\u626b\u63cf\u7ebf\u7684\u89e3\u6cd5\u4e5f\u9002\u7528\uff0c\u800c\u4e14\u8fd9\u79cd\u79bb\u7ebf\u5206\u6cbb\u7684\u65b9\u6cd5\u5728\u66f4\u5927\u7684\u6570\u636e\u8303\u56f4\u4e0b\u8868\u73b0\u4f1a\u66f4\u597d\u3002\r\n\r\n------------\r\n#### \u95f2\u8bdd\r\n\r\n\u5f53\u521d\u5199\u8fd9\u79cd\u89e3\u6cd5\u7684\u65f6\u5019\uff0c\u6ca1\u6709\u6253\u7b97\u901a\u8fc7\uff0c\u4e00\u6b65\u6b65\u4f18\u5316\u540e\u5374\u53d6\u5f97\u4e86\u610f\u6599\u4e4b\u5916\u7684\u6210\u679c\uff0c\u5341\u5206\u4ee4\u4eba\u6b23\u559c\u3002\r\n\r\n\u9898\u89e3\u533a\u6ca1\u6709\u8fd9\u79cd\u89e3\u6cd5\uff0c\u4e5f\u8bb8\u662f\u8ba4\u4e3a\u6548\u7387\u592a\u4f4e\uff1f\u7b14\u8005\u8ba4\u4e3a\u80fd\u591f\u4e0d\u5f00 O2 \u4f18\u5316\u901a\u8fc7\u5df2\u7ecf\u8db3\u591f\uff0c\u6bd5\u7adf\u9898\u76ee\u7684\u6570\u636e\u8303\u56f4\u8f83\u5c0f\uff0c\u64cd\u4f5c\u8f83\u591a\uff0c\u4e13\u4e3a\u6811\u72b6\u6570\u7ec4\u8bbe\u8ba1\u3002\r\n\r\n\u867d\u7136\u601d\u8def\u65e9\u5c31\u6709\u4e86\uff0c\u5b9e\u73b0\u5374\u82b1\u8d39\u4e86\u5f88\u957f\u65f6\u95f4\uff0c\u4e5f\u7b97\u79ef\u7d2f\u4e86\u5b9d\u8d35\u7684\u7ecf\u9a8c\u3002",
        "postTime": 1676990039,
        "uid": 662295,
        "name": "Flanksy",
        "ccfLevel": 0,
        "title": "P4514 \u4e0a\u5e1d\u9020\u9898\u7684\u4e03\u5206\u949f"
    },
    {
        "content": "\u8fd9\u9053\u9898\u9898\u9700\u8981\u7528**\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4**\uff08\u6811\u72b6\u6570\u7ec4\u7565\uff09\u3002\n\n\u6811\u72b6\u6570\u7ec4\u672c\u6765\u7684\u7528\u5904\u662f\u5355\u70b9\u4fee\u6539\u3001\u533a\u95f4\u67e5\u8be2\uff0c\u600e\u4e48\u8ddf\u533a\u95f4\u4fee\u6539\u3001\u533a\u95f4\u67e5\u8be2\uff08\u800c\u4e14\u8fd8\u662f\u4e8c\u7ef4\u7684\uff09\u626f\u4e0a\u5173\u7cfb\u4e86\u5462\uff1f\u8fd9\u5c31\u8981\u8c08\u5230**\u5dee\u5206**\u4e86\u3002\n\n## \u5dee\u5206\n\n\u8bbe\u539f\u6570\u7ec4\u4e3a $a[i]$\uff0c\u5176\u5dee\u5206\u6570\u7ec4\u4e3a $d[i]=a[i]-a[i-1]\\ (i > 0)$\u3002\u7279\u522b\u7684\uff0c$d[0]=a[0]$\u3002\u89c2\u5bdf\u5b9a\u4e49\u53ef\u4ee5\u53d1\u73b0\uff0c\u67e5\u5206\u6570\u7ec4 $d$ \u7684\u524d\u7f00\u548c\u5c31\u662f\u539f\u6570\u7ec4\uff0c\u6240\u8c13\u201c\u5dee\u5206\u662f\u524d\u7f00\u548c\u7684\u9006\u8fd0\u7b97\u201d\u3002\u90a3\u4e48\u5b83\u6709\u4f55\u7528\u5462\uff1f\u7b54\uff1a\u65b9\u4fbf\u8fdb\u884c\u533a\u95f4\u4fee\u6539\u3002\n\n\u4e3e\u4e2a\u4f8b\u5b50\uff1a\u8bbe\u539f\u6570\u7ec4\u4e3a $a$\uff0c\u67e5\u5206\u6570\u7ec4\u4e3a $d$\u3002\n\n$a = \\{2,3,6,\\ \\ \\ 3,7,\\ \\ \\ 4\\}$\n\n$d = \\{2,1,3,-3,4,-3\\}$\n\n\u6b64\u65f6\u6211\u4eec\u628a\u539f\u6570\u7ec4 $a[1]$ \u5230 $a[3]$ \u52a0 2\uff1a\n\n$a = \\{2,{\\color{red}{5,8,\\ \\ \\ 5}},7,\\ \\ \\ 4\\}$\n\n$d = \\{2,{\\color{red}{3}},3,-3,{\\color{red}{2}},-3\\}$\n\n\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u6211\u4eec\u628a\u539f\u6570\u7ec4 $a[1]$ \u5230 $a[3]$ \u52a0 2 \u540e\uff0c$d[1]\\ +\\!= 2$\uff0c$d[3+1]\\ -\\!= 2$\u3002\u60f3\u60f3\u5c31\u80fd\u660e\u767d\uff0c\u5f53\u6211\u4eec\u628a\u539f\u6570\u7ec4 $a[l]$ \u5230 $a[r]$ \u52a0 $x$ \u540e\uff0c$d[l]\\ +\\!= x$\uff0c$d[r+1]\\ -\\!= x$\u3002\u8bc1\u660e\u7565\u3002\n\n## \u6811\u72b6\u6570\u7ec4 \u533a\u95f4\u4fee\u6539+\u533a\u95f4\u67e5\u8be2\n\n**\u533a\u95f4\u4fee\u6539+\u533a\u95f4\u67e5\u8be2** \u4e0d\u662f\u7ebf\u6bb5\u6811\u7684\u4e8b\u5417\uff1f\u6811\u72b6\u6570\u7ec4\u600e\u4e48\u641e\uff1f\u5176\u5b9e\u518d\u60f3\u60f3\uff0c**\u6811\u72b6\u6570\u7ec4+\u5dee\u5206**\u662f\u80fd\u5b9e\u73b0 \u533a\u95f4\u4fee\u6539+\u533a\u95f4\u67e5\u8be2 \u7684\u3002\n\n\u9996\u5148\uff0c\u67e5\u5206\u662f\u53ef\u4ee5\u533a\u95f4\u4fee\u6539\u7684\u3002\u90a3\u4e48\u5982\u4f55\u533a\u95f4\u67e5\u8be2\uff1f\u5176\u5b9e\u53ef\u4ee5\u8f6c\u6362\u6210\u6c42\u524d\u7f00\u548c\u3002\n\n$\\quad a_1+a_2+\\cdots+a_k$\n\n$=d_1+(d_1+d_2)+(d_1+d_2+d_3)+\\cdots+(d_1+d_2+\\cdots+d_k)$\n\n$=k\\times d_1+(k-1)\\times d_2+(k-2)\\times d_3+\\cdots+(k-(k-1))\\times d_k$\n\n$=k\\sum_{i=1}^kd_i-\\sum_{i=1}^k((i-1)d_i)$\n\n\u7efc\u4e0a\uff0c\u6211\u4eec\u53ea\u8981\u7ef4\u62a4\u4e24\u4e2a\u6811\u72b6\u6570\u7ec4\u5206\u522b\u7528\u4e8e\u7ef4\u62a4 $d_i$ \u7684\u524d\u7f00\u548c\u4ee5\u53ca $(i-1)d_i$ \u7684\u524d\u7f00\u548c\u5373\u53ef\u3002\n\n\u4f8b\u9898\uff1a[P3372 \u3010\u6a21\u677f\u3011\u7ebf\u6bb5\u6811 1](https://www.luogu.com.cn/problem/P3372) \u5176\u5b9e\u8fd9\u9898\u867d\u662f\u7ebf\u6bb5\u6811\u6a21\u677f\u9898\uff0c\u5374\u53ef\u4ee5\u7528\u5982\u4e0a\u7684\u65b9\u6cd5\u505a\uff0c\u4e5f\u80fd AC\u3002\n\nP3372 \u3010\u6a21\u677f\u3011\u7ebf\u6bb5\u6811 1 \u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nconst int Maxn = 100010;\n#define lowbit(x)  ((x) & - (x))\nll tree1[Maxn],tree2[Maxn];\n\nvoid update1(ll x,ll d) {\n    while(x<=Maxn) {\n        tree1[x]+=d;\n        x+=lowbit(x);\n    }\n}\nvoid update2(ll x,ll d) {\n    while(x<=Maxn) {\n        tree2[x]+=d;\n        x+=lowbit(x);\n    }\n}\nll sum1(ll x) {\n    ll ans = 0;\n    while(x>0) {\n        ans+=tree1[x];\n        x-=lowbit(x);\n    }\n    return ans;\n}\nll sum2(ll x) {\n    ll ans = 0;\n    while(x>0) {\n        ans+=tree2[x];\n        x-=lowbit(x);\n    }\n    return ans;\n}\n\nint main() {\n    ll n, m;\n    scanf(\"%lld%lld\",&n,&m);\n    ll old = 0, a;\n    for (int i=1; i<=n; i++) {\n        scanf(\"%lld\",&a);\n        update1(i, a-old);\n        update2(i,(i-1)*(a-old));\n        old = a;\n    }\n    while (m--) {     \n        ll q, L, R, d;\n        scanf(\"%lld\",&q);\n        if (q==1) {                \n            scanf(\"%lld%lld%lld\",&L, &R, &d);\n            update1(L,d);         \n            update1(R+1,-d);\n            update2(L,d*(L-1));  \n            update2(R+1,-d*R);   \n        } else {                 \n            scanf(\"%lld%lld\",&L,&R);\n            printf(\"%lld\\n\",R*sum1(R)-sum2(R) - (L-1)*sum1(L-1)+sum2(L-1));\n        }\n    }\n    return 0;\n}\n```\n\n## \u6811\u72b6\u6570\u7ec4 \u4e8c\u7ef4\u533a\u95f4\u4fee\u6539+\u533a\u95f4\u67e5\u8be2\n\n\u9996\u5148\uff0c\u4f60\u9700\u8981\u77e5\u9053\u4ec0\u4e48\u662f\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\uff0c\u5982\u4f55\u7528\u5b83\u5b9e\u73b0\u4e8c\u7ef4\u5355\u70b9\u4fee\u6539+\u533a\u95f4\u67e5\u8be2\uff08\u4e0d\u4f1a\u7684\u81ea\u884c[\u767e\u5ea6](https://www.baidu.com/)\uff09\u3002\n\n\u5982\u4f55\u5b9e\u73b0\u4e8c\u7ef4\u533a\u95f4\u4fee\u6539+\u533a\u95f4\u67e5\u8be2\uff1f\u76f8\u4fe1\u5927\u5bb6\u5df2\u7ecf\u660e\u767d\u4e86\uff0c\u5c31\u662f\u5229\u7528\u5dee\u5206\u3002\n\n![](https://img-blog.csdnimg.cn/20200806165821226.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzkxNDU5Mw==,size_16,color_FFFFFF,t_70)\n\n\u5b9a\u4e49\u5dee\u5206\u6570\u7ec4 $d[i][j]=a[i][j]-a[i-1][j]-a[i][j-1]+a[i-1][j]$\uff0c\u53ef\u77e5\u539f\u6570\u7ec4 $a[x][y]=\\sum_{i=1}^x\\sum_{j=1}^yd[i][j]$\u3002\u6211\u4eec\u53d1\u73b0\uff0c\u90a3\u53e5\u201c\u5dee\u5206\u662f\u524d\u7f00\u548c\u7684\u9006\u8fd0\u7b97\u201d\u4ecd\u7136\u6b63\u786e\u3002\n\n\u7ee7\u7eed\u4e0b\u53bb\uff0c\u518d\u770b\u533a\u95f4\u67e5\u8be2\u3002\n\n![](https://img-blog.csdnimg.cn/20200806170347250.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzkxNDU5Mw==,size_16,color_FFFFFF,t_70)\n\n\u6211\u4eec\u60f3\u8981\u533a\u95f4\u67e5\u8be2\uff0c\u5bf9\u7167\u4e0a\u56fe\u53ef\u77e5 $\\sum_{i=a}^c\\sum_{j=b}^da[i][j]=\\sum_{i=1}^c\\sum_{j=1}^da[i][j] - \\sum_{i=1}^c\\sum_{j=1}^{b-1}  a[i][j] - \\sum_{i=1}^{a-1}\\sum_{j=b}^da[i][j]+ \\sum_{i=1}^{a-1}\\sum_{j=1}^{b-1}a[i][j]$\n\n\u53ef\u4ee5\u770b\u5230\u95ee\u9898\u8f6c\u6362\u4e3a\u4e86\u5982\u4f55\u6c42 $\\sum_{i=1}^n\\sum_{j=1}^ma[i][j]$\u3002\u7ee7\u7eed\u63a8\u5bfc\uff1a\n\n\n$\\quad\\sum_{i=1}^n\\sum_{j=1}^ma[i][j]$\n\n$=\\sum_{i=1}^n\\sum_{j=1}^m\\sum_{k=1}^i\\sum_{l=1}^jd[k][l]$\n\n$=\\sum_{i=1}^n\\sum_{j=1}^md[i][j]\\times(n-i+1)\\times(m-i+1)$\n\n$=(n+1)(m+1)\\sum_{i=1}^n\\sum_{j=1}^md[i][j]-(m+1)\\sum_{i=1}^n\\sum_{j=1}^md[i][j]\\times i-(n+1)\\sum_{i=1}^n\\sum_{j=1}^md[i][j]\\times j+\\sum_{i=1}^n\\sum_{j=1}^md[i][j]\\times i\\times j$\n\n~~\u6253\u516c\u5f0f\u628a\u6211\u624b\u6253\u5e9f\u4e86~~\n\n\u90a3\u4e48\u6211\u4eec\u53ea\u9700 4 \u4e2a\u6811\u72b6\u6570\u7ec4\u5206\u522b\u7ef4\u62a4 $d[i][j]$\uff0c$d[i][j]\\times i$\uff0c$d[i][j]\\times j$ \u548c $d[i][j]\\times i\\times j$ \u5373\u53ef\u3002\n\n\u4ee3\u7801\uff08O2 \u7248\uff09\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N = 2e3 + 100;\nint tree1[N][N], tree2[N][N], tree3[N][N], tree4[N][N];\ninline int read() {\n   int s=0, w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=(s<<3)+(s<<1)+(ch^48),ch=getchar();\n   return s*w;\n}\ninline int lowbit(int x) {\n    return x & (-x);\n}\nint n,m;\ninline void update(int x, int y, int d) {\n    for(int i = x; i <= n; i += lowbit(i))\n        for(int j = y; j <= m; j += lowbit(j)) {\n            tree1[i][j] += d;\n            tree2[i][j] += x * d;\n            tree3[i][j] += y * d;\n            tree4[i][j] += x * y * d;\n        }\n}\ninline int sum(int x, int y) {\n    int ans = 0;\n    for(int i = x; i > 0; i -= lowbit(i)) for(int j = y; j > 0; j -= lowbit(j)) ans += (x + 1) * (y + 1) * tree1[i][j] - (y + 1) * tree2[i][j] - (x + 1) * tree3[i][j] + tree4[i][j];\n    return ans;\n}\n\nint main() {\n    n = read(), m = read();\n    char ch[3];\n    while (~scanf(\"%s\", ch)) {\n        int a = read(), b = read(), c = read(), d = read(), x;\n        if(ch[0] == 'L') {\n            x = read();\n            update(a, b, x);\n            update(c + 1, d + 1, x);\n            update(a, d + 1,-x);\n            update(c + 1, b, -x);\n        } else printf(\"%d\\n\",sum(c, d)+sum(a-1, b-1)-sum(a-1, d)-sum(c, b-1));\n    }\n    return 0;\n}\n```\n\n\u4f46\u662f\uff0c\u8fd9\u6837\u8981\u5f00 O2\uff0c\u5982\u4f55\u4e0d\u5f00 O2 \u80fd\u8fc7\u5462\uff1f\u5feb\u8bfb\u6551\u4e0d\u4e86\u6211\u4eec\uff0c\u53ea\u80fd\u8bd5\u8bd5\u66f4\u591a\u5361\u5e38\u5c0f\u6280\u5de7\u4e86\uff01\n\n## \u9644\u3001\u5361\u5e38\u5c0f\u77e5\u8bc6\n\n\u6ce8\u610f\u5230\u6211\u4eec\u4ee3\u7801\u4e2d\u6709\u4e00\u4e2a ```if(ch[0] == 'L')```\uff0c\u6211\u4eec\u5c31\u4f18\u5316\u5b83\u5427\uff01\n\n\u6709\u6bd4\u8fd9\u66f4\u5feb\u7684\uff1f\u5f53\u7136\u4e86\uff0c\u5c31\u662f\u4f4d\u8fd0\u7b97\uff01\n\n\u4ec0\u4e48\u8fd0\u7b97\u80fd\u4ee3\u66ff\u5b83\u5462\uff1f\u6309\u4f4d\u4e0e\u3002\u3002\u3002\u6309\u4f4d\u6216\u3002\u3002\u3002**\u5f02\u6216\uff08xor\uff09**\uff01\uff01\uff01\n\n\u5f02\u6216\u662f\u4ec0\u4e48\u6211\u5c31\u4e0d\u8bf4\u4e86\uff0c\u4f46\u5927\u5bb6\u60f3\u60f3\uff0c\u5f02\u6216\u662f\u53ef\u4ee5\u4ee3\u66ff == \u7684\u3002\u4f17\u6240\u5468\u77e5 'L' \u7684 ASCII \u7801\u662f 76\uff0c\u90a3\u4e48\u5229\u7528\u5f02\u6216\u7684\u6027\u8d28\uff0c\u53ea\u9700\u5c06\u4e0a\u9762\u7684\u8bed\u53e5\u6539\u4e3a ```if(!(ch[0] ^ 76))``` \u5373\u53ef\uff01\n\n\u6700\u7ec8\u4ee3\u7801\uff08\u65e0\u9700 O2\uff09\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define rg register\nusing namespace std;\nconst int N = 2e3 + 100;\nint tree1[N][N], tree2[N][N], tree3[N][N], tree4[N][N];\ninline int read() {\n   int s=0, w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=(s<<3)+(s<<1)+(ch^48),ch=getchar();\n   return s*w;\n}\ninline int lowbit(int x) {\n\treturn x & (-x);\n}\nint n,m;\ninline void update(int x, int y, int d) {\n\tfor(rg int i = x; i <= n; i += lowbit(i))\n\t\tfor(rg int j = y; j <= m; j += lowbit(j)) {\n\t\t\ttree1[i][j] += d;\n\t\t\ttree2[i][j] += x * d;\n\t\t\ttree3[i][j] += y * d;\n\t\t\ttree4[i][j] += x * y * d;\n\t\t}\n}\ninline int sum(int x, int y) {\n\tint ans = 0;\n\tfor(rg int i = x; i > 0; i -= lowbit(i)) for(rg int j = y; j > 0; j -= lowbit(j)) ans += (x + 1) * (y + 1) * tree1[i][j] - (y + 1) * tree2[i][j] - (x + 1) * tree3[i][j] + tree4[i][j];\n\treturn ans;\n}\n\nint main() {\n\tn = read(), m = read();\n\tchar ch[3];\n\twhile (~scanf(\"%s\", ch)) {\n\t\tint a = read(), b = read(), c = read(), d = read(), x;\n\t\tif(!(ch[0] ^ 76)) {\n\t\t\tx = read();\n\t\t\tupdate(a, b, x);\n\t\t\tupdate(c + 1, d + 1, x);\n\t\t\tupdate(a, d + 1,-x);\n\t\t\tupdate(c + 1, b, -x);\n\t\t} else printf(\"%d\\n\",sum(c, d)+sum(a-1, b-1)-sum(a-1, d)-sum(c, b-1));\n\t}\n\treturn 0;\n}\n```\n\n\u53c2\u8003\uff1a\nhttps://www.cnblogs.com/lindalee/p/11503503.html\n\n\n\n",
        "postTime": 1597463519,
        "uid": 341650,
        "name": "_504",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4514 \u3010\u4e0a\u5e1d\u9020\u9898\u7684\u4e03\u5206\u949f\u3011"
    },
    {
        "content": "\u6bd5\u59e5\u7237\u8868\u793a\u6211\u5c31\u6ca1\u60f3\u8ba9\u9664\u4e86\u6811\u72b6\u6570\u7ec4\u7684\u5176\u4ed6\u65b9\u6cd5\u8fc7\n\u5404\u4f4d\u5361\u65f6\u95f4\u7684dalao\u4eec\u6b47\u6b47\u5427\n\n\u8bdd\u8bf4\u59e5\u7237\u5f00\u5c0f\u4e86\u6570\u636e\u5426\u5219\u4f1a\u7206`long long`\u81ea\u5df1\u611f\u53d7\u4e00\u4e0b\n\n\u8be6\u7ec6\u9898\u89e3\u5728[blog](https://blog.csdn.net/Force_CHL/article/details/81178351)\n\n## \u533a\u95f4\u67e5\u8be2,\u533a\u95f4\u4fee\u6539\n\u7c7b\u6bd4\u4e00\u7ef4\u7684\u60c5\u51b5\u4e0b,\u8003\u8651\u6bcf\u6b21\u67e5\u8be2\u5f97\u5230\u4e9b\u4ec0\u4e48\n\u5047\u8bbe$c[i][j]=s[i][j]-s[i-1][j]-s[i][j-1]+s[i-1][j-1]$\n\n$$query(x,y)=\\sum_{i=1}^{x}\\sum_{j=1}^{y}c[i][j]$$\n\n\u5047\u8bbe\u8981\u67e5\u8be2$\\sum_{i=1}^{x}\\sum_{j=1}^{y}s[i][j]$,\u9700\u8981\u7684\u662f\n$$\\sum_{i=1}^{x}\\sum_{j=1}^{y}c[i][j]*(x+1-i)*(y+1-j)$$\n\u7b49\u4ef7\u4e8e\n$$(x+1)*(y+1)*\\sum_{i=1}^{x}\\sum_{j=1}^{y}c[i][j]$$\n$$-(y+1)*\\sum_{i=1}^{x}\\sum_{j=1}^{y}c[i][j]*i$$\n$$-(x+1)*\\sum_{i=1}^{x}\\sum_{j=1}^{y}c[i][j]*j$$\n$$+\\sum_{i=1}^{x}\\sum_{j=1}^{y}c[i][j]*i*j$$\n\n\u6240\u4ee5\u8bf4**\u53ea\u9700\u8981**\u7ef4\u62a4\u56db\u4e2a\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4$c[i][j],c[i][j]*i,c[i][j]*j,c[i][j]*i*j$\u5373\u53ef\n\n```cpp\nvoid insert(int x,int y,int add) {\n\tint newx=x;\n\twhile(newx<=n) {\n\t\tint newy=y;\n\t\twhile(newy<=n) {\n\t\t\ta[0][newx][newy]+=add;\n\t\t\ta[1][newx][newy]+=add*x;\n\t\t\ta[2][newx][newy]+=add*y;\n\t\t\ta[3][newx][newy]+=add*x*y;\n\t\t\tnewy+=lowbit(newy);\n\t\t}\n\t\tnewx+=lowbit(newx);\n\t}\n}\nint query(int x,int y) {\n\tint newx=x,ans=0;\n\twhile(newx) {\n\t\tint newy=y;\n\t\twhile(newy) {\n\t\t\tans+=(x+1)*(y+1)*a[0][newx][newy];\n\t\t\tans-=(y+1)*a[1][newx][newy];\n\t\t\tans-=(x+1)*a[2][newx][newy];\n\t\t\tans+=a[3][newx][newy];\n\t\t\tnewy-=lowbit(newy);\n\t\t}\n\t\tnewx-=lowbit(newx);\n\t}\n\treturn ans;\n}\n```",
        "postTime": 1534233367,
        "uid": 20601,
        "name": "League\u4e36\u7fce",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4514 \u3010\u4e0a\u5e1d\u9020\u9898\u7684\u4e03\u5206\u949f\u3011"
    },
    {
        "content": "> ### $Get\\ Many\\ Persimmon\\ Trees$ \n\n\u4e0a\u5e1d\u9020\u4eba\u7684\u4e03\u5206\u949f,\u88f8\u9898\u5c31\u610f\u5473\u7740\u795e\u9898(~~\u4e00\u9053\u8bed\u6587\u9898~~)\u3002\n\n\u5fc3\u8840\u6765\u6f6e\u5c31\u6765\u53d1\u4e00\u4e0b$Pascal$\u7684\u4ee3\u7801\u3002\n\n\u5177\u4f53\u7684\u505a\u6cd5\u4e5f\u662f\u5927\u4f6c\u4eec\u5199\u51fa\u6765\u4e86,\u8fd9\u91cc\u4e0d\u91cd\u590d\u3002\n\n\u8981\u6ce8\u610f\u4e00\u70b9,\u5982\u679c\u521a\u5b66\u5b8c\u6811\u72b6\u6570\u7ec4,\u53ef\u80fd\u4f1a\u628a**\u4e8c\u7ef4\u6570\u7ec4\u5199\u6210$while$\u7684\u5f62\u5f0f**,\u7136\u540e\u5c31\u50bb\u903c\u7684$WA*N+RE*M$\u3002\n\n$Pascal$\u5199\u6210$tree[mode,x,y]$\u7684\u5f62\u5f0f\u4f1a\u597d\u770b\u5f88\u591a\u5427\u3002\n\n```pascal\nvar\n    tree:array[1..4,-1..110,-1..110] of longint; \u7ef4\u62a4\u7684\u6570\u7ec4\n    place:array[1..4] of longint; //\u8f93\u5165\u7528\n    i,j,num,n,m:longint;\n    mode:char; //\u547d\u4ee4\u6807\u8bc6\n\nfunction lowbit(num:longint):longint; begin exit(num and -num); end;\n\nprocedure Insert(x,y,num:longint); //add\u51fd\u6570\nvar\n    i,j:longint;\nbegin\n    i:=x;\n    while i<n do\n    begin\n        j:=y; //\u5751\u70b9\n        while j<m do\n        begin\n            inc(tree[1,i,j],num); //\u8fd9\u6837\u5b50\u5199\u5c31\u4e0d\u4f1a\u5361\u5e38\u54e6,qwq\n            inc(tree[2,i,j],num*y); \n            inc(tree[3,i,j],num*x); \n            inc(tree[4,i,j],num*x*y);\n            inc(j,lowbit(j));\n        end;\n        inc(i,lowbit(i));\n    end;\nend;\n\nfunction Sum(x,y:longint):longint; //\u7b54\u6848\nvar\n    i,j:longint;\nbegin\n    i:=x; Sum:=0;\n    while i>0 do\n    begin\n        j:=y; //\u5751\u70b9\n        while j>0 do\n        begin\n            inc(Sum,tree[1,i,j]*(x+1)*(y+1)-tree[2,i,j]*(x+1)-tree[3,i,j]*(y+1)+tree[4,i,j]); //\u8fd9\u6837\u5b50\u5199\u5c31\u4e0d\u4f1a\u5361\u5e38\u54e6,qwq\n            dec(j,lowbit(j));\n        end;\n        dec(i,lowbit(i));\n    end;\nend;\n\nbegin\n\n    readln(mode,n,m);\n    while not eof do //\u64cd\u4f5c\n    begin\n        read(mode,place[1],place[2],place[3],place[4]); \n        if mode='L' then\n        begin\n            readln(num);\n            Insert(place[1],place[2],num);\n            Insert(place[1],place[4]+1,-num);\n            Insert(place[3]+1,place[2],-num);\n            Insert(place[3]+1,place[4]+1,num);\n        end;\n        if mode='k' then\n        begin\n            readln; //\u5751\u70b9\n            writeln(Sum(place[3],place[4])-Sum(place[1]-1,place[4])-Sum(place[3],place[2]-1)+Sum(place[1]-1,place[2]-1));\n        end;\n    end;\nend.\n```\n\n\u603b\u4f53\u611f\u89c9\u8fd9\u9898\u4e00\u822c\u822c....\n\n",
        "postTime": 1534662029,
        "uid": 77760,
        "name": "arfa",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4514 \u3010\u4e0a\u5e1d\u9020\u4eba\u7684\u4e03\u5206\u949f\u3011"
    }
]