[
    {
        "content": "> \u4e00\u5e74\u524d\uff0c\u6211\u62a5\u540d\u4e86 [MCOI Round 4](https://www.luogu.com.cn/contest/33344)\uff0c\u53d1\u73b0\u81ea\u5df1\u4e00\u9053\u9898\u4e5f\u4e0d\u4f1a\u505a\uff0c\u9057\u61be\u7206\u96f6\u3002  \n> \u4e00\u5929\u524d\uff0c\u6211\u4ece\u6bd4\u8d5b\u5217\u8868\u91cc\u6311\u4e86\u4e00\u573a\u6bd4\u8d5b\u5f00\u59cb VP\uff0c\u53d1\u73b0\u8fd9\u573a\u6bd4\u8d5b\u4e00\u5e74\u524d\u81ea\u5df1\u6253\u8fc7\uff0c\u4f46\u662f\u57fa\u672c\u6ca1\u6709\u5370\u8c61\u3002\u60f3\u4e86\u4fe9\u5c0f\u65f6 A \u53d1\u73b0\u505a\u6cd5\u5047\u4e86\uff0c\u540e\u6765\u4e00\u76f4\u5361\u5728 A \u4e0a\uff0c\u9057\u61be\u7206\u96f6\u3002\n\n## \u7b80\u8981\u9898\u610f\n\n\u4e3a\u8868\u8ff0\u65b9\u4fbf\u548c\u4e2a\u4eba\u4e60\u60ef\u539f\u56e0\uff0c\u4e0b\u9762\u51fa\u73b0\u7684\u6240\u6709\u5927\u5199\u5b57\u6bcd $K$ \u5747\u4ee3\u8868\u539f\u9898\u9762\u4e2d\u5c0f\u5199\u5b57\u6bcd $k$ \u7684\u542b\u4e49\u3002\n\n\u7ed9\u5b9a\u65e0\u81ea\u73af\u65e0\u91cd\u8fb9\u7684\u65e0\u5411\u56fe\uff0c$K$ \u56de\u5408\u4e2d\u6bcf\u56de\u5408\u53ef\u4ee5\u5220\u53bb\u73b0\u6709\u70b9\u96c6\u7684\u4efb\u610f\u771f\u5b50\u96c6\uff0c\u6c42\u6240\u6709\u65b9\u6848\u4e2d\u6bcf\u56de\u5408\u540e\u5269\u4e0b\u7684\u56fe\u6700\u5927\u56e2\u5927\u5c0f\u4e4b\u548c\u6a21 $10^9+7$\u3002\n\n\u89c2\u5bdf\u9898\u610f\uff0c\u53d1\u73b0\u8fd9\u9898\u662f\u4e2a\u4e8c\u5408\u4e00\uff0c\u9996\u5148\u9884\u5904\u7406\u51fa\u6240\u6709\u5b50\u96c6\u7684\u6700\u5927\u56e2\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u96c6\u5408\u8fdb\u884c\u8d21\u732e\u7684\u8ba1\u7b97\uff0c\u7d2f\u52a0\u5373\u53ef\u3002\n\n## 1. DP \u90e8\u5206\n\n\u9996\u5148\u6211\u4eec\u8003\u8651\u679a\u4e3e\u5b50\u96c6\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5b50\u96c6\u6c42\u51fa\u6700\u5927\u56e2\u7684\u5927\u5c0f\uff0c\u8fd9\u662f\u4e00\u4e2a\u57fa\u7840\u7684\u72b6\u538b DP\uff0c\u9898\u89e3\u4e2d\u4e0d\u505a\u8fc7\u591a\u8bb2\u8ff0\u3002\u9884\u5904\u7406\u51fa $F(i)$ \u8868\u793a\u70b9\u96c6\u7684\u6240\u6709\u5927\u5c0f\u4e3a $i$ \u7684\u5b50\u96c6\u7684\u6700\u5927\u56e2\u5927\u5c0f\u4e4b\u548c\uff0c\u4ee5\u4fbf\u4e0b\u4e00\u90e8\u5206\u4f7f\u7528\u3002\n\n## 2. \u8ba1\u7b97\u8d21\u732e\n\n\u5bf9\u4e8e\u6bcf\u4e00\u79cd\u60c5\u51b5\u8ba1\u7b97\u8d21\u732e\u3002\u5373\u7b54\u6848\u4e3a\uff1a\u5728\u7b2c $k$ \u56de\u5408\u7ed3\u675f\u540e\uff0c\u5269\u4e0b $s$ \u4e2a\u70b9\u6ca1\u88ab\u5220\u7684\u65b9\u6848\u6570\u4e58\u4e0a $F(s)$\u3002\u6240\u4ee5\u6211\u4eec\u5148\u8981\u6c42\u51fa\u8fd9\u4e2a\u300c\u65b9\u6848\u6570\u300d\u3002\n\n\u8fd9\u4e2a\u90e8\u5206\u6211\u4e00\u5f00\u59cb\u60f3\u5230\u7684\u662f\u4e00\u79cd\u5047\u505a\u6cd5\u3002\u5177\u4f53\u53ef\u4ee5\u89c1 [\u8fd9\u7bc7\u5e16\u5b50](https://www.luogu.com.cn/discuss/397203)\u3002\u8fd9\u4e2a\u4e1c\u897f\u5e76\u4e0d\u662f\u7ec4\u5408\u6570\uff0c\u539f\u56e0\u662f\u540c\u4e00\u4e2a\u70b9\u5728\u4e0d\u540c\u7684\u65f6\u95f4\u88ab\u5220\u4e5f\u662f\u4e0d\u540c\u7684\u65b9\u6848\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6211\u5728\u5e16\u5b50\u4e2d\u7684\u505a\u6cd5\u95ee\u9898\u8f6c\u5316\u4e3a\u628a\u957f\u5ea6\u4e3a $k$ \u7684\u5355\u8c03\u4e0d\u5347\u5e8f\u5217\u8ba1\u6570\uff0c\u662f\u5fd8\u4e86\u70b9\u4e0e\u70b9\u4e4b\u95f4\u6709\u533a\u522b\uff0c\u5373\u628a\u6709\u6807\u53f7\u8ba1\u6570\u60f3\u6210\u4e86\u6210\u65e0\u6807\u53f7\u8ba1\u6570\u3002\n\n\u6b63\u786e\u7684\u505a\u6cd5\u4e3a\uff1a\u5047\u8bbe\u5728\u7b2c $k$ \u56de\u5408\u7ed3\u675f\u65f6\u5269\u4e0b $s$ \u4e2a\u70b9\u6ca1\u88ab\u5220\uff0c\u5219\u6709 $(n-s)$ \u4e2a\u70b9\u5728\u524d $k$ \u56de\u5408\u7684\u67d0\u4e2a\u65f6\u523b\u88ab\u5220\u4e86\uff0c\u5355\u72ec\u5bf9\u6bcf\u4e2a\u70b9\u8003\u8651\uff0c\u53ea\u8981\u4e24\u79cd\u65b9\u6848\u4e2d\u67d0\u4e2a\u70b9\u88ab\u5220\u7684\u65f6\u523b\u4e0d\u4e00\u6837\uff0c\u8fd9\u4e24\u79cd\u65b9\u6848\u5c31\u4e0d\u4e00\u6837\uff0c\u5171 $s^{n-k}$ \u79cd\u3002\u5728 $k$ \u56de\u5408\u540e\u540c\u7406\uff0c\u6709 $s$ \u4e2a\u70b9\u5728\u540e\u9762\u7684 $K-k$ \u56de\u5408\u88ab\u5220\u4e86\uff0c\u6216\u8005\u6ca1\u88ab\u5220\uff0c\u4e00\u5171\u662f $k-y+1$ \u79cd\uff0c\u6240\u4ee5\u662f $(k-y+1)^x$\u3002\u7efc\u4e0a\uff0c\u7b2c $k$ \u56de\u5408\u7ed3\u675f\u65f6\u5269\u4e0b $s$ \u4e2a\u70b9\u6ca1\u88ab\u5220\u7684\u65b9\u6848\u6570\u4e3a $k^{n-s}((K-k+1)^s-(K-k)^s)$\u3002\n\n\u679a\u4e3e $k,s$\uff0c\u5219\u6211\u4eec\u8981\u6c42\u7684\u7b54\u6848\u4e3a\uff1a\n\n$$\n\\sum_{k=0}^{K-1} \\sum_{s=1}^n F(s) (K-k)^{n-s}((k+1)^s-k^s)\n$$\n\n\u628a $F(s)$ \u63d0\u51fa\u6765\uff0c\u5f97\uff1a\n\n$$\n\\sum_{s=1}^n (F(s) \\sum_{k=0}^{K-1} (K-k)^{n-s}((k+1)^s-k^s))\n$$\n\n\u53d1\u73b0\u8981\u679a\u4e3e\u4e00\u4e2a $k$\uff0c\u800c $K$ \u7684\u8303\u56f4\u4e3a $10^9$\uff0c\u590d\u6742\u5ea6\u4e0d\u80fd\u63a5\u53d7\uff0c\u8003\u8651\u628a\u5f0f\u5b50\u4e2d\u7684 $(K-k)^{n-s}$ \u548c $((k+1)^s-k^s)$ \u62c6\u5f00\uff0c\u6839\u636e\u4e8c\u9879\u5f0f\u5b9a\u7406\u5f97\uff1a\n\n$$\n\\sum_{s=1}^n (F(s) \\sum_{k=0}^{K-1} ((\\sum_{i=0}^{n-s}\\binom{n-s}{i}K^i(-k)^{n-s-i})(\\sum_{i=0}^{s-1} \\binom{s}{i} k^i))\n$$\n\n\u8fd9\u662f\u4e24\u4e2a\u5173\u4e8e $k$ \u7684\u6700\u9ad8\u6b21\u4e3a $n$ \u7684\u591a\u9879\u5f0f\uff0c\u7531\u4e8e $n$ \u8303\u56f4\u5f88\u5c0f\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u4eec $O(n^2)$ \u66b4\u529b\u4e58\u8d77\u6765\uff0c\u5f97\u5230\u4e00\u4e2a\u6700\u9ad8\u6b21\u4e3a $2n$ \u7684\u591a\u9879\u5f0f\uff0c\u6211\u4eec\u8bb0\u8fd9\u4e2a\u591a\u9879\u5f0f\u7684 $i$ \u6b21\u9879\u7cfb\u6570\u4e3a $P_i$\uff0c\u5219\uff1a\n\n$$\n\\sum_{s=1}^n (F(s) \\sum_{p=0}^{2n} (P_p\\sum_{k=0}^{K-1} k^p))\n$$\n\n\u8fd9\u5c31\u662f\u4e00\u4e2a\u7ecf\u5178\u7684\u81ea\u7136\u6570\u5e42\u548c\uff0c\u76f4\u63a5\u4f2f\u52aa\u5229\u6570 $O(n^2)$ \u9884\u5904\u7406\u540e $O(n)$ \u8ba1\u7b97\u3002\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u4ee5 $O(n^3)$ \u7684\u590d\u6742\u5ea6\u8ba1\u7b97\u51fa\u4e86\u8d21\u732e\u3002\u5982\u679c\u4f60\u5728\u8ba1\u7b97\u591a\u9879\u5f0f\u4e58\u6cd5\u65f6\u4f7f\u7528\u4e86 $O(n\\log n)$ \u7684\u7b97\u6cd5\uff0c\u590d\u6742\u5ea6\u5c06\u4f18\u5316\u81f3 $O(n^2 \\log n)$\uff0c\u4f46\u662f\u4ecb\u4e8e\u6b64\u9898\u7684\u6570\u636e\u8303\u56f4\uff0c\u6ca1\u6709\u5fc5\u8981\u3002\n\n> \u540e\u6765\u8bfb std \u4ee3\u7801\u65f6\u53d1\u73b0\u5176\u7528\u4e86\u62c9\u683c\u6717\u65e5\u63d2\u503c\u800c\u4e0d\u662f\u66b4\u529b\u62c6\u4e8c\u9879\u5f0f\u5316\u7b80\uff0c\u7b97\u662f\u4e00\u9898\u591a\u89e3\u4e86\u3002\n\n## 3. \u5e38\u6570\u4f18\u5316\n\n\u5982\u679c\u4f60\u6309\u7167 $1\\sim 2$ \u4e2d\u7684\u6b65\u9aa4\u5199\u5b8c\u4e86\u4ee3\u7801\uff0c\u4f60\u4f1a\u53d1\u73b0\u4f60\u7684 $2^n$ \u8dd1\u4e0d\u8fc7\u53bb $n=28$\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u4e9b\u5e38\u6570\u4f18\u5316\u3002\n\n### \u4f18\u5316 A\n\n\u9996\u5148\uff0c\u5728\u5199\u8fd9\u7bc7\u9898\u89e3\u65f6\uff0c\u672c\u9898\u7684\u7a7a\u95f4\u9650\u5236\u4e3a $160\\text{ MB}$\u3002\u4f60\u6839\u672c\u5f00\u4e0d\u4e0b $2^{28}$ \u4e2a `int` \u751a\u81f3\u662f $2^{28}$ \u4e2a `unsigned char`\u3002\u6240\u4ee5\u53ef\u4ee5\u91c7\u7528\u4e00\u79cd\u7279\u6b8a\u7684\u65b9\u6cd5\u6765\u5361\u5185\u5b58\uff0c\u7531\u4e8e\u56fe\u7684\u6700\u5927\u56e2\u5927\u5c0f\u6700\u5927\u4e3a\u70b9\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4e00\u4e2a `int` \u62c6\u6210\u516d\u4e2a\u6765\u7528\uff0c\u6bcf\u4e2a\u6570\u5b57\u53ea\u7528\u5176\u4e2d\u7684 $5$ \u4e2a bit \u5373 $2^5=32$\uff0c\u538b\u7f29\u7a7a\u95f4\u6765\u5361\u8fdb\u672c\u9898\u7684\u7a7a\u95f4\u9650\u5236\u3002\n\n### \u4f18\u5316 B\n\n\u6211\u4eec\u53ef\u4ee5\u628a $n$ \u4e2d\u7684\u70b9\u62c6\u6210\u4e24\u90e8\u5206\uff0c\u7b2c\u4e00\u90e8\u5206\u7528\u666e\u901a\u7684 $2^n$ DP\u3002\u5305\u542b\u7b2c\u4e8c\u90e8\u5206\u7684\u70b9\u7684\u70b9\u96c6\u7684\u6700\u5927\u56e2\u5728\u6bcf\u6b21\u8fdb\u884c\u7b2c\u4e00\u90e8\u5206\u7684 DP \u8f6c\u79fb\u65f6\u987a\u4fbf\u8f6c\u79fb\u3002\u7531\u4e8e\u7b2c\u4e8c\u90e8\u5206\u7684\u70b9\u6709\u4e09\u79cd\u72b6\u6001\uff1a\u4e0d\u9009\u3001\u9009\u4f46\u4e0d\u5305\u62ec\u5728\u6700\u5927\u56e2\u5185\uff0c\u9009\u4e14\u5305\u62ec\u5728\u6700\u5927\u56e2\u5185\uff0c\u6240\u4ee5\u662f $O(3^n)$\u3002\u8fd9\u6837\u7684\u8bdd\u8bbe\u7b2c\u4e00\u90e8\u5206\u5305\u542b\u524d $n_0$ \u4e2a\u70b9\uff0c\u7b2c\u4e8c\u90e8\u5206\u5305\u62ec\u540e $n-n_0$ \u4e2a\u70b9\uff0c\u5219\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(2^{n_0} 3^{n-n_0})$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\max\\{2^{n_0},3^{n-n_0}\\})$\uff0c\u770b\u4f3c\u65f6\u95f4\u590d\u6742\u5ea6\u66f4\u52a3\u4f46\u662f\u5728 $(n-n_0)$ \u975e\u5e38\u5c0f\u7684\u65f6\u5019\u8dd1\u5f97\u6bd4 $2^n$ \u66b4\u529b DP \u8981\u5feb\u63a5\u8fd1 $400\\text{ ms}$\u3002\n\n- \u5982\u679c\u4ec5\u4f7f\u7528\u4f18\u5316 A\uff0c\u53ef\u4ee5\u505a\u5230 $840\\text{ ms / }131\\text{ MB}$\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u4f46\u662f\u5e38\u6570\u4ecd\u7136\u4e0d\u591f\u4f18\u79c0\u3002\n- \u5982\u679c\u628a\u4f18\u5316 A \u548c B \u7ed3\u5408\u8d77\u6765\uff0c$n_0$ \u53d6 $n-1$\uff0c\u5219\u53ef\u4ee5\u505a\u5230 $620\\text{ ms / }44\\text{ MB}$\uff0c\u5185\u5b58\u7ea6\u4e3a std \u7684 $\\dfrac 1 3$\uff0c\u4f46\u662f\u7528\u65f6\u8f83\u6162\u3002\n- \u5982\u679c\u4ec5\u4f7f\u7528\u4f18\u5316 B\uff0c$n_0$ \u53d6 $n-2$\uff0c\u5219\u53ef\u4ee5\u505a\u5230 $330\\text{ ms / }64\\text{ MB}$\uff0c\u65f6\u95f4\u7565\u4f18\u4e8e std \u7684\u540c\u65f6\u5185\u5b58\u53ea\u6709 std \u7684 $\\dfrac 1 2$\u3002\n\n## \u4ee3\u7801\u53c2\u8003\n\n$O(n^2)$ \u66b4\u529b\u8ba1\u7b97\u591a\u9879\u5f0f\u4e58\u6cd5\uff0c\u4ec5\u4f7f\u7528\u4f18\u5316 B \u4e14 $n_0=n-2$\uff1a\n\n```cpp\nconst int mo = 1e9 + 7;\nconst int N = 139;\nint n, m, K, cnt[30], jc[N], jcinv[N], e[30], B[N], Binv[N], pwk[N], P[N];\n// unsigned sz[(1 << 28) / 2 / 6 + 9];\nunsigned char sz[(1 << 28) / 4 + 9];\n\nll Pow(ll a, ll b, const ll &m) {\n  ll res = 1;\n  a %= m;\n  while (b > 0) {\n    if (b & 1) res = res * a % m;\n    a = a * a % m, b >>= 1;\n  }\n  return res;\n}\ninline int C(int n, int m) {\n  if (m > n) return 0;\n  return 1ll * jc[n] * jcinv[m] % mo * jcinv[n - m] % mo;\n}\nint Calc(int n, int k) {\n  if (k == 0) return n;\n  int res = 0;\n  re (i, k + 1)\n    res = (res + 1ll * C(k + 1, i) * B[k + 1 - i] % mo * Pow(n + 1, i, mo)) % mo;\n  int ans = 1ll * res * Pow(k + 1, mo - 2, mo) % mo;\n  return ans;\n}\n// inline unsigned char Get(int pos) { return (sz[pos / 6] >> (pos % 6 * 5)) & 0b11111; }\n// inline void Set(int pos, unsigned char x) { sz[pos / 6] |= x << (pos % 6 * 5); }\n#define Get(x) sz[x]\n#define Set(x, y) sz[x] = y\n\nsigned main() {\n  ios::sync_with_stdio(0), cin.tie(0), cout.tie(0);\n  cin >> n >> m >> K;\n  pwk[0] = jc[0] = jcinv[0] = 1;\n  re (i, N - 1)\n    jc[i] = 1ll * jc[i - 1] * i % mo, jcinv[i] = Pow(jc[i], mo - 2, mo),\n    pwk[i] = 1ll * pwk[i - 1] * K % mo;\n  B[0] = 1;\n  re (i, 100) {\n    B[i] = 0;\n    rep (j, 0, i - 1)\n      B[i] += 1ll * C(i + 1, j) * B[j] % mo, umod(B[i]);\n    B[i] = (1ll * B[i] * -Pow(i + 1, mo - 2, mo) % mo + mo) % mo;\n  }\n  rep (i, 0, n - 1)\n    e[i] |= 1 << i;\n  re (i, m) {\n    int f, t;\n    cin >> f >> t, e[f] |= 1 << t, e[t] |= 1 << f;\n  }\n  cnt[1] = 2;\n  cnt[2] = 1 + (e[n - 2] >> (n - 1));\n  re (S, (1 << (n - 2)) - 1) {\n    unsigned char res = max<unsigned char>(Get(S ^ lb(S)),\n                                           Get((S ^ lb(S)) & e[__builtin_ctz(lb(S))]) + 1),\n                  popc = __builtin_popcount(S);\n    Set(S, res), cnt[popc] += res;\n    unsigned char res2;\n    cnt[popc + 1] += (res2 = max<unsigned char>(res, Get(S & e[n - 1]) + 1));\n    cnt[popc + 1] += max<unsigned char>(res, Get(S & e[n - 2]) + 1);\n    up(res2, Get(S & e[n - 2]) + 1);\n    cnt[popc + 2] +=\n        max<unsigned char>(res2, Get(S & e[n - 1] & e[n - 2]) + (e[n - 2] >> (n - 1)) + 1);\n  }\n  // \u5171 K \u56de\u5408\uff0c\u7b2c k \u56de\u5408\u65f6\u5269\u4e0b\u4e00\u4e2a\u5927\u5c0f\u4e3a s \u7684\u70b9\u96c6\u7684\u65b9\u6848\u6570\n  // \u65b9\u6848\u6570 = k^(n-s)*((K-k+1)^s-(K-k)^s)\n  int ans = 0;\n  re (s, n) {\n    int res = 0;\n    memset(P, 0, sizeof P);\n    rep (i, 0, n - s)\n      rep (j, 0, s - 1)\n        P[n - s - i + j] +=\n            (((n - s - i) & 1) ? mo - 1ll : 1ll) * C(n - s, i) % mo * pwk[i] % mo * C(s, j) % mo,\n            umod(P[n - s - i + j]);\n    rep (p, 0, 2 * n) {\n      int x = p == 0;\n      x += Calc(K - 1, p);\n      res += 1ll * x * P[p] % mo, umod(res);\n    }\n    ans += 1ll * res * cnt[s] % mo, umod(ans);\n  }\n  cout << ans << '\\n';\n  return 0;\n}\n```",
        "postTime": 1641989897,
        "uid": 207996,
        "name": "yzy1",
        "ccfLevel": 9,
        "title": "P7347 \u9898\u89e3"
    },
    {
        "content": "\u7b80\u8981\u9898\u89e3\r\n\r\n### Part1 \u9884\u5904\u7406\u5b50\u96c6\u6700\u5927\u56e2\r\n\r\n\u5b9a\u4e49\uff1a$f(S)$ \u662f\u96c6\u5408 $S$ \u7684\u6700\u5927\u56e2\u5927\u5c0f\uff0c$r(x)$ \u662f\u70b9 $x$ \u7684\u90bb\u5c45\u7684\u96c6\u5408\r\n\r\n\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a $S\\neq \\varnothing$\uff0c\u53d6\u4efb\u610f $x\\in S$\uff0c\u8003\u8651 $x$ \u662f\u5426\u5728\u6700\u5927\u56e2\u4e2d\uff0c\u53ef\u4ee5\u5f97\u5230\u8f6c\u79fb\uff1a$f(S)=\\max(1+f(S\\cap r(x)),f(S-\\{x\\}))$\r\n\r\n\u72b6\u538b\u4ece\u5c0f\u5230\u5927\u679a\u4e3e $S$\uff0cdp \u8ba1\u7b97\u5373\u53ef\r\n\r\n\u6ce8\u610f\u5230\u6211\u4eec\u53ea\u9700\u8981\u5bf9\u6bcf\u4e2a\u5b50\u96c6\u5927\u5c0f\u5206\u522b\u6c42\u51fa\u5b50\u96c6\u6700\u5927\u56e2\u7684\u548c\r\n\r\n\u6240\u4ee5\u6570\u7ec4\u53ef\u4ee5\u5f00\u5927\u5c0f $2^{n-1}$ \u7684```char```\u7c7b\u578b\uff0c\u56e0\u4e3a\u540e $2^{n-1}$ \u4e2a\u503c\u4e0d\u4f1a\u518d\u6b21\u88ab\u7528\u5230\u4e86\r\n\r\n### Part2 \u8ba1\u7b97\u8d21\u732e\r\n\r\n\u5982\u679c\u5728\u7b2c $y$ \u56de\u5408\u7ed3\u675f\u540e\u5269\u4e0b\u4e00\u4e2a\u5927\u5c0f\u4e3a $x$ \u7684\u5b50\u96c6\uff0c\u5305\u542b\u8fd9\u79cd\u72b6\u6001\u7684\u65b9\u6848\u6570\u5e94\u8be5\u662f $y^{n-x}((k-y+1)^x-(k-y)^x)$\r\n\r\n\u4e5f\u5c31\u662f\uff0c\u8003\u8651\u6bcf\u4e2a\u70b9\u662f\u5728\u54ea\u4e00\u56de\u5408\u5220\u9664\u7684\r\n\r\n\u7531\u4e8e $x$ \u7684\u8303\u56f4\u53ea\u6709 $[0,n]$ \u6240\u4ee5\u53ef\u4ee5\u679a\u4e3e\uff0c\u6240\u4ee5\u8981\u6c42\u7684\u5c31\u662f $\\sum_{y=1}^k y^{n-x}((k-y+1)^x-(k-y)^x)$\r\n\r\n\u8fd9\u662f\u4e2a\u5173\u4e8e $k$ \u7684 $n+1$ \u6b21\u591a\u9879\u5f0f\uff0c\u66b4\u529b\u6c42 $n+2$ \u4e2a\u70b9\u503c\u7136\u540e\u62c9\u683c\u6717\u65e5\u63d2\u503c\u5373\u53ef\r\n\r\n### Part3 \u5361\u5e38\r\n\r\n\u8fd9\u4e2a\u2026\u2026\u770b\u6807\u7a0b\u5427\uff0c\u6700\u5927\u70b9 356ms\uff0c\u8fd8\u633a\u5feb\u7684\uff08\u521d\u4ee3\u6807\u7a0b\u6700\u5927\u70b9 700+ms\uff0c\r\n\u88ab\u6211\u4f18\u5316\u4e86\u4e00\u534a\u5e38\u6570\uff0c\u6211\u8ba4\u4e3a\u6709\u5fc5\u8981\u533a\u5206\u4e00\u4e0b\uff09\r\n\r\n\u6807\u7a0b\u957f\u8fd9\u6837\uff0c~~\u6b22\u8fce\u6284\u9898\u89e3~~\r\n\r\n```cpp\r\n#include <cstdio>\r\n#include <algorithm>\r\n#define N 28\r\n#define P 1000000007\r\nint n, m, k, G[N], s[N+1]; char a[1<<(N-1)];\r\nint inv[N+2], pow[N+2][N+1];\r\nint main() {\r\n\tscanf(\"%d%d%d\", &n, &m, &k);\r\n\twhile (m--) {\r\n\t\tint x, y;\r\n\t\tscanf(\"%d%d\", &x, &y);\r\n\t\tG[x] |= 1 << y;\r\n\t\tG[y] |= 1 << x;\r\n\t}\r\n\tfor (int x = 1, t = 1, d = 0; ; x++) {\r\n\t\tif (x & (t<<1)) {t <<= 1; if (++d == n-1) break; }\r\n\t\ta[x] = std::max(a[x^t], char(a[x&G[d]]+1));\r\n\t\tint c = __builtin_popcount(x); s[c] += a[x];\r\n\t\ts[c+1] += std::max(int(a[x]), a[x&G[n-1]]+1);\r\n\t}\r\n\ts[1]++;\r\n\tpow[0][0] = inv[1] = 1;\r\n\tfor (int i = 1; i <= n+1; i++) {\r\n\t\tpow[i][0] = 1;\r\n\t\tfor (int j = 1; j <= n; j++)\r\n\t\t\tpow[i][j] = 1ll * pow[i][j-1] * i % P;\r\n\t}\r\n\tfor (int i = 2; i <= n+1; i++)\r\n\t\tinv[i] = 1ll * (P-P/i) * inv[P%i] % P;\r\n\tint ans = 0;\r\n\tfor (int g = 1; g <= n; g++) {\r\n\t\tfor (int i = 1; i <= n+1; i++) {\r\n\t\t\tint y = 0;\r\n\t\t\tfor (int j = 1; j <= i; j++)\r\n\t\t\t\ty = (1ll * pow[j][n-g] * (pow[i-j+1][g] - pow[i-j][g] + P) + y) % P;\r\n\t\t\tfor (int j = 0; j <= n+1; j++) if (i != j)\r\n\t\t\t\ty = 1ll * y * (k-j+P) % P * (i>j?inv[i-j]:P-inv[j-i]) % P;\r\n\t\t\tans = (1ll * y * s[g] + ans) % P;\r\n\t\t}\r\n\t}\r\n\tprintf(\"%d\\n\", ans);\r\n}\r\n```",
        "postTime": 1610715846,
        "uid": 90893,
        "name": "\u93e1\u97f3\u30ea\u30f3",
        "ccfLevel": 10,
        "title": "MCOI R4 A solution"
    }
]