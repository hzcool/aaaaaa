[
    {
        "content": "\u76f4\u63a5\u8003\u8651\u4e0d\u7ecf\u8fc7 $n$ \u4e2a\u70b9\u7684\u65b9\u6848\u96be\u5ea6\u8f83\u5927\uff0c\u6240\u4ee5\u8003\u8651\u8fdb\u884c\u5bb9\u65a5\u3002\n\n\u6839\u636e\u9898\u610f\uff0c\u4e00\u4e2a\u70b9\u53ef\u5230\u8fbe\u7684\u5176\u4ed6\u70b9\u662f\u628a\u539f\u6765\u70b9\u5750\u6807\u4e8c\u8fdb\u5236\u8868\u793a\u4e0b\u67d0\u4e9b $0$ \u53d8\u4e3a $1$ \u5f97\u5230\u7684\u3002\u8bb0 $x$ \u4e8c\u8fdb\u5236\u8868\u793a\u4e0b $1$ \u7684\u4e2a\u6570\u4e3a $count(x)$ \uff0c$dp[i][j][k]$ \u4e3a\u4ece $(0,0,0)$ \u5230\u6ee1\u8db3 $count(x)=i,count(y)=j,count(z)=k$ \u7684\u70b9 $P(x,y,z)$ \u7684\u65b9\u6848\u6570\u3002\u7531\u4e8e\u6bcf\u4e00\u6b65\u53ea\u80fd\u6539\u53d8\u4e00\u7ef4\u5750\u6807\uff0c\u6240\u4ee5\u53ef\u4ee5\u5f97\u5230\u8f6c\u79fb\u65b9\u7a0b \n$$\ndp[i][j][k]=\\sum_{x=0}^{i-1}dp[x][j][k]\\times \\dbinom{i}{x}+\\sum_{y=0}^{j-1}dp[i][y][k]\\times \\dbinom{j}{y}+\\sum_{z=0}^{k-1}dp[i][j][z]\\times \\dbinom{k}{z}\n$$\n\u518d\u8003\u8651\u969c\u788d\u70b9\u3002\n\n\u8bb0\u7b2c $i$ \u4e2a\u969c\u788d\u4e3a $P_i(x_i,y_i,z_i)$ \uff0c$f[i]$ \u4e3a\u4e0d\u7ecf\u8fc7\u5176\u4ed6\u969c\u788d\u5230\u8fbe\u7b2c $i$ \u4e2a\u969c\u788d\u7684\u65b9\u6848\u6570\u3002\u9996\u5148\u5c06\u969c\u788d\u6309\u5b57\u5178\u5e8f\u6392\u5e8f\uff0c\u5219\u53ef\u4ee5\u4fdd\u8bc1\u65e0\u540e\u6548\u6027\u3002\u4ece $dp[count(x_i)][count(y_i)][count(z_i)]$ \u5f97\u5230 $f[i]$\uff0c\u5219\u4f9d\u6b21\u679a\u4e3e\u4ece $(0,0,0)$ \u5230 $P_i$ \u7684\u8fc7\u7a0b\u4e2d\u7ecf\u8fc7\u7684\u7b2c\u4e00\u4e2a\u5176\u4ed6\u969c\u788d $P_j(j<i)$ \u82e5\u4ece $P_j$ \u5230 $P_i$ \u7684\u65b9\u6848\u6570\u4e3a $to(j, i)$ \uff0c\u5219\u53ef\u5f97 $f[i]$ \u8f6c\u79fb\u65b9\u7a0b\n$$\nf[i]=dp[count(x_i)][count(y_i)][count(z_i)]-\\sum_{j=1}^{i-1}f[j]\\times to(j,i)\n$$\n\n\u6700\u540e\u53ea\u5269\u4e0b\u6c42 $to(j,i)$ \u4e86\u3002\u4e8b\u5b9e\u4e0a\uff0c$dp[i][j][k]$ \u4ec5\u4e0e\u4e0b\u6807\u53d8\u5316\u6709\u5173\uff0c\u5373\u4ece\u8d77\u70b9\u5230\u4efb\u4e00\u53ef\u5230\u8fbe\uff0c\u4e14 $x,y,z$ \u5750\u6807\u6bd4\u8d77\u70b9\u7684\u5750\u6807\u5728\u4e8c\u8fdb\u5236\u8868\u793a\u4e0b\u5206\u522b\u591a$i,j,k$\u4e2a $1$ \u7684\u70b9\u7684\u65b9\u6848\u6570\u3002\u6240\u4ee5\u82e5\u4ece $P_i$ \u53ef\u4ee5\u5230\u8fbe $P_i$\uff08\u5373 $x_j\\land x_i=x_j$\uff0c$y_j\\land y_i=y_j$\uff0c\u4e14$z_j\\land z_i=z_j$\uff09\uff0c\u5219\u6709\n$$\nto(j, i)=dp[count(x_i)-count(x_j)][count(y_i)-count(y_j)][count(z_i)-count(z_j)]\n$$\n\u5426\u5219 $to(j,i)=0$\n\n\u4e3a\u4e86\u65b9\u4fbf\u5f97\u5230\u7b54\u6848\uff0c\u53ef\u4ee5\u5c06\u7ec8\u70b9$(n,m,r)$\u5f53\u505a\u7b2c $o+1$ \u4e2a\u969c\u788d\uff0c\u5219\u7b54\u6848\u4e3a $f[o+1]$\n```cpp\n#include <bits/stdc++.h>\ntypedef long long LL;\nint read()\n{\n\tint s = 0, f = 1;\n\tchar ch = getchar();\n\twhile (!(ch >= '0' && ch <= '9'))\n\t{\n\t\tif (ch == '-')\n\t\t\tf = -1;\n\t\tch = getchar();\n\t}\n\twhile (ch >= '0' && ch <= '9')\n\t{\n\t\ts = (s << 3) + (s << 1) + (ch ^ 48);\n\t\tch = getchar();\n\t}\n\treturn s * f;\n}\nLL readll()\n{\n\tLL s = 0, f = 1;\n\tchar ch = getchar();\n\twhile (!(ch >= '0' && ch <= '9'))\n\t{\n\t\tif (ch == '-')\n\t\t\tf = -1;\n\t\tch = getchar();\n\t}\n\twhile (ch >= '0' && ch <= '9')\n\t{\n\t\ts = (s << 3) + (s << 1) + (ch ^ 48);\n\t\tch = getchar();\n\t}\n\treturn s * f;\n}\nstruct Block\n{\n\tLL x, y, z;\n\tint xx, yy, zz;\n} ;\nLL n, m, r;\nint o;\nBlock a[10005];\nconst int MOD = 998244353;\nLL dp[70][70][70] = {{{0}}}, f[10005];\nLL c[70][70] = {{0}};\nLL comb(int n, int m)\n{\n\tif (c[n][m])\n\t\treturn c[n][m];\n\tif (n == m || m == 0)\n\t\treturn c[n][m] = 1;\n\treturn c[n][m] = (comb(n - 1, m - 1) + comb(n - 1, m)) % MOD;\n}\nint count(LL x)\n{\n\tint cnt = 0;\n\tfor (; x; x -= x & -x) \n\t\tcnt++;\n\treturn cnt;\n}\ninline bool chk(int i, int j)\n{\n\treturn ((a[i].x & a[j].x) == a[i].x)\n\t\t&& ((a[i].y & a[j].y) == a[i].y)\n\t\t&& ((a[i].z & a[j].z) == a[i].z);\n}\nint main()\n{\n\tn = readll(), m = readll(), r = readll(), o = read();\n\tfor (int i = 1; i <= o; i++)\n\t\ta[i].x = readll(), a[i].y = readll(), a[i].z = readll();\n\tdp[0][0][0] = 1;\n\tfor (int i = 0; i <= 64; i++)\n\t\tfor (int j = 0; j <= 64; j++)\n\t\t\tfor (int k = 0; k <= 64; k++)\n\t\t\t{\n\t\t\t\tfor (int ii = 0; ii < i; ii++)\n\t\t\t\t\tdp[i][j][k] = (dp[i][j][k] + dp[ii][j][k] * comb(i, i - ii) % MOD) % MOD;\n\t\t\t\tfor (int jj = 0; jj < j; jj++)\n\t\t\t\t\tdp[i][j][k] = (dp[i][j][k] + dp[i][jj][k] * comb(j, j - jj) % MOD) % MOD;\n\t\t\t\tfor (int kk = 0; kk < k; kk++)\n\t\t\t\t\tdp[i][j][k] = (dp[i][j][k] + dp[i][j][kk] * comb(k, k - kk) % MOD) % MOD;\n\t\t\t}\n\tstd::sort(a + 1, a + o + 1, [](Block p, Block q){\n\t\treturn (p.x != q.x) ? (p.x < q.x) : (p.y != q.y ? p.y < q.y : p.z < q.z);\n\t}); \n\ta[++o].x = n, a[o].y = m, a[o].z = r;\n\tfor (int i = 1; i <= o; i++)\n\t\ta[i].xx = count(a[i].x), a[i].yy = count(a[i].y), a[i].zz = count(a[i].z);\n\tfor (int i = 1; i <= o; i++)\n\t{\n\t\tf[i] = dp[a[i].xx][a[i].yy][a[i].zz];\n\t\tfor (int j = 1; j < i; j++)\n\t\t\tif (chk(j, i))\n\t\t\t\tf[i] = ((f[i] - dp[a[i].xx - a[j].xx][a[i].yy - a[j].yy][a[i].zz - a[j].zz] * f[j] % MOD) % MOD + MOD) % MOD;\n\t}\n\tprintf(\"%lld\\n\", f[o]);\n\treturn 0;\n} \n```\n~~\u8fd9\u9898\u771f\u7684\u80fd\u8bc4\u9ed1\u5417~~",
        "postTime": 1648543926,
        "uid": 368995,
        "name": "complexor",
        "ccfLevel": 0,
        "title": "P3734 [HAOI2017]\u65b9\u6848\u6570\u9898\u89e3"
    },
    {
        "content": "\u6211\u4eec\u5957\u8def\u7684\u8003\u8651\u6ca1\u6709\u969c\u788d\u8be5\u600e\u4e48\u505a\uff0c\u4f60\u53d1\u73b0\u7531\u4e8e\u662f\u4ece$(0,0,0)$\u5f00\u59cb\u7684\u6240\u4ee5\u72b6\u6001\u53ea\u4e0e$a,b,c$\u5206\u522b\u6709\u51e0\u4e2a1\u6709\u5173\uff0c\u90a3\u4e48\u8bbe$dp[i][j][k]$\u4e3a\u4ed6\u4eec\u5206\u522b\u7684\u4f4d\u6570\u4e3a\u8fd9\u4e48\u591a\u65f6\u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\u6709\uff1a\n\n$dp[i][j][k]=\\sum_{x=1}^idp[i-x][j][k]C_{i}^x+\\sum_{x=1}^jdp[i][j-x][k]C_{j}^x+\\sum_{x=1}^kdp[i][j][k-x]C_{k}^x$\n\n\u7136\u540e\u6709\u969c\u788d\u7684\u8bdd\uff0c\u6211\u4eec\u5148\u628a\u5750\u6807\u6309\u5b57\u5178\u5e8f\u6392\u5e8f\uff0c\u8fd9\u6837\u4fdd\u8bc1\u53ef\u80fd\u4f1a\u5728\u4e4b\u524d\u4f1a\u88ab\u7ecf\u8fc7\u7684\u70b9\u4e00\u5b9a\u5728\u4e4b\u524d\uff0c\u8bbe$f[i]$\u4e3a\u5230\u70b9i\u7684\u65b9\u6848\u6570\uff0c\u521d\u59cb\u4e3a\u4e0d\u8003\u8651\u969c\u788d\u7684\u65b9\u6848\u6570\uff0c\u7136\u540e\u679a\u4e3e$(x,y,z)$\u90fd\u662f$(a,b,c)$\u7684\u5b50\u96c6\u7684\u524d\u9762\u7684\u969c\u788d\u70b9\uff0c\u94a6\u5b9a\u4ed6\u662f\u7ecf\u8fc7\u7684\u7b2c\u4e00\u4e2a\u969c\u788d\uff0c\u90a3\u4e48\u51cf\u53bb$f[j]$\u4e58\u4e0a$j->i$\u7684\u4e0d\u8003\u8651\u969c\u788d\u7684\u65b9\u6848\u5373\u53ef\uff0c\u540e\u8005\u5bf9\u8fd93\u4e2a\u5750\u6807\u505a\u4e2a\u5dee\u96c6\u5c31\u80fd\u7b97\u4e86\uff0c\u8fd9\u4e2a\u662f$O(o^2)$\u7684\u53cd\u6b63\u80fd\u8fc7\u2026\u2026\n\n\u4e0a\u4ee3\u7801~\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n#define ll long long\n#define p 998244353\nusing namespace std;\nnamespace ywy {\n\tll c[101][101], dp[65][65][65];\n\tint bit[65537];\n\tinline int bitof(ll n) {\n\t    return (bit[n & 65535] + bit[(n >> 16) & 65535] + bit[(n >> 32) & 65535] + bit[(n >> 48) & 65535]);\n\t}\n\ttypedef struct _n {\n\t    ll a, b, c;\n\t    friend bool operator<(const _n &a, const _n &b) {\n\t        if (a.a != b.a)\n\t            return (a.a < b.a);\n\t        if (a.b != b.b)\n\t            return (a.b < b.b);\n\t        return (a.c < b.c);\n\t    }\n\t} node;\n\tnode memchi[11111];\n\tll f[11111];\n\tvoid ywymain() {\n\t    ll x, y, z;\n\t    cin >> x >> y >> z;\n\t    int n;\n\t    cin >> n;\n\t    for (register int i = 1; i <= n; i++) cin >> memchi[i].a >> memchi[i].b >> memchi[i].c;\n\t    n++;\n\t    memchi[n].a = x;\n\t    memchi[n].b = y;\n\t    memchi[n].c = z;\n\t    sort(memchi + 1, memchi + 1 + n);\n\t    c[0][0] = 1;\n\t    for (register int i = 1; i <= 64; i++) {\n\t        c[i][0] = 1;\n\t        for (register int j = 1; j <= i; j++) c[i][j] = (c[i - 1][j] + c[i - 1][j - 1]) % p;\n\t    }\n\t    for (register int i = 1; i < 65536; i++) bit[i] = bit[i - (i & -i)] + 1;\n\t    dp[0][0][0] = 1;\n\t    for (register int i = 0; i <= 64; i++) {\n\t        for (register int j = 0; j <= 64; j++) {\n\t            for (register int k = 0; k <= 64; k++) {\n\t                if (!i && !j && !k)\n\t                    continue;\n\t                if (i) {\n\t                    for (register int a = 1; a <= i; a++)\n\t                        dp[i][j][k] = (dp[i][j][k] + dp[i - a][j][k] * c[i][a]) % p;\n\t                }\n\t                if (j) {\n\t                    for (register int b = 1; b <= j; b++)\n\t                        dp[i][j][k] = (dp[i][j][k] + dp[i][j - b][k] * c[j][b]) % p;\n\t                }\n\t                if (k) {\n\t                    for (register int z = 1; z <= k; z++)\n\t                        dp[i][j][k] = (dp[i][j][k] + dp[i][j][k - z] * c[k][z]) % p;\n\t                }\n\t            }\n\t        }\n\t    }\n\t    for (register int i = 1; i <= n; i++) {\n\t        f[i] = dp[bitof(memchi[i].a)][bitof(memchi[i].b)][bitof(memchi[i].c)];\n\t        for (register int j = 1; j < i; j++) {\n\t            if ((memchi[j].a & memchi[i].a) != memchi[j].a)\n\t                continue;\n\t            if ((memchi[j].b & memchi[i].b) != memchi[j].b)\n\t                continue;\n\t            if ((memchi[j].c & memchi[i].c) != memchi[j].c)\n\t                continue;\n\t            f[i] -= f[j] * dp[bitof(memchi[i].a ^ memchi[j].a)][bitof(memchi[i].b ^ memchi[j].b)]\n\t                             [bitof(memchi[i].c ^ memchi[j].c)];\n\t            f[i] %= p;\n\t            f[i] += p;\n\t            f[i] %= p;\n\t        }\n\t    }\n\t    cout << f[n] << endl;\n\t}\n}\nint main() {\n    ywy::ywymain();\n    return (0);\n}\n```",
        "postTime": 1553691482,
        "uid": 125124,
        "name": "ywy_c_asm",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3734 \u3010[HAOI2017]\u65b9\u6848\u6570\u3011"
    },
    {
        "content": "\u53ef\u4ee5\u5148\u8003\u8651\u6ca1\u6709\u969c\u788d\u7269\u7684\u60c5\u51b5\uff0c\u8bbe\u8ba1\u72b6\u6001$f_{i,j,k}$\uff0c\u8868\u793a\u5230\u8fbe\u5750\u6807 $(x,y,z)$\u4e8c\u8fdb\u5236\u4e0b\uff0c$x$\u6709$i$\u4f4d\uff0c$y$\u6709$j$\u4f4d\uff0c$z$\u6709$k$\u4f4d\u7684\u65b9\u6848\u6570\u3002\n\n\u5f97\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a\n\n$$\n\tf_{i,j,k}=\\sum_{x=1}^i f_{i-x,j,k}\\binom{i}{x}+\\sum_{x=1}^j f_{i,j-x,k}\\binom{j}{x}+\\sum_{x=1}^k f_{i,j,k-x}\\binom{k}{x}\n$$\n\n\u5bf9\u6240\u6709\u969c\u788d\u7269\u7684\u4f4d\u7f6e\u548c\u6700\u7ec8\u7684\u7ec8\u70b9\u4e00\u8d77\u8003\u8651\uff0c\u5148\u5c06\u8fd9\u4e9b\u70b9\u6309$x$\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0c$y$\u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\uff0c$z$\u4e3a\u7b2c\u4e09\u5173\u952e\u5b57\u6392\u5e8f\uff0c\u4fdd\u8bc1\u540e\u9762\u8f6c\u79fb\u7684\u5408\u6cd5\u3002\n\n\u8bbe$g_i$\u4e3a\u5230\u8fbe\u7b2c$i$\u4e2a\u70b9\u4e14\u4e0d\u7ecf\u8fc7\u6392\u5e8f\u540e\u987a\u5e8f\u8be5\u70b9\u4e4b\u524d\u7684\u70b9\u7684\u65b9\u6848\u6570\u3002\u5bf9\u4e8e$g_i$\uff0c\u8ba1\u7b97\u65f6\u901a\u8fc7\u5bb9\u65a5\uff0c\u4e3a\u4ece$(0,0,0)$\u5230\u8be5\u70b9\u4e0d\u8003\u8651\u969c\u788d\u7269\u7684\u65b9\u6848\u6570\uff0c\u51cf\u53bb\u5176\u4ed6\u53ef\u4ee5\u5230\u8fbe\u8be5\u70b9\u7684\u70b9\u8d70\u8fc7\u6765\u7684\u65b9\u6848\u6570\uff0c\u5224\u65ad\u662f\u5426\u53ef\u4ee5\u5230\u8fbe\u9700\u770b\u662f\u5426\u4e09\u7ef4\u90fd\u662f\u8be5\u70b9\u5b50\u96c6\u3002\n\n$code:$\n\n```cpp\n#include<bits/stdc++.h>\n#define maxn 20010\n#define maxm 70\n#define all 65\n#define mod 998244353\n#define lowbit(x) (x&(-x))\nusing namespace std;\ntypedef long long ll;\ntemplate<typename T> inline void read(T &x)\n{\n    x=0;char c=getchar();bool flag=false;\n    while(!isdigit(c)){if(c=='-')flag=true;c=getchar();}\n    while(isdigit(c)){x=(x<<1)+(x<<3)+(c^48);c=getchar();}\n    if(flag)x=-x;\n}\nll n,m,r,tot;\nll f[maxm][maxm][maxm],g[maxn],C[maxm][maxm];\nint get(ll x)\n{\n    int cnt=0;\n    while(x) cnt++,x-=lowbit(x);\n    return cnt;\n}\nstruct node\n{\n    ll x,y,z;\n    int a,b,c;\n    void init()\n    {\n        a=get(x),b=get(y),c=get(z);\n    }\n}p[maxn];\nbool cmp(const node &a,const node &b)\n{\n    if(a.x==b.x&&a.y==b.y) return a.z<b.z;\n    if(a.x==b.x) return a.y<b.y;\n    return a.x<b.x;\n}\nint main()\n{\n    read(n),read(m),read(r),read(tot);\n    for(int i=1;i<=tot;++i)\n        read(p[i].x),read(p[i].y),read(p[i].z),p[i].init();\n    p[++tot]=(node){n,m,r},p[tot].init(),sort(p+1,p+tot+1,cmp);\n    for(int i=0;i<=all;++i) C[i][0]=1;\n    for(int i=1;i<=all;++i)\n        for(int j=1;j<=i;++j)\n            C[i][j]=(C[i-1][j-1]+C[i-1][j])%mod;\n    f[0][0][0]=1;\n    for(int i=0;i<=all;++i)\n    {\n        for(int j=0;j<=all;++j)\n        {\n            for(int k=0;k<=all;++k)\n            {\n                for(int x=1;x<=i;++x) f[i][j][k]=(f[i][j][k]+f[i-x][j][k]*C[i][x]%mod)%mod;\n                for(int x=1;x<=j;++x) f[i][j][k]=(f[i][j][k]+f[i][j-x][k]*C[j][x]%mod)%mod;\n                for(int x=1;x<=k;++x) f[i][j][k]=(f[i][j][k]+f[i][j][k-x]*C[k][x]%mod)%mod;\n            }\n        }\n    }\n    for(int i=1;i<=tot;++i)\n    {\n        g[i]=f[p[i].a][p[i].b][p[i].c];\n        for(int j=1;j<i;++j)\n        {\n            if((p[j].x&p[i].x)!=p[j].x||(p[j].y&p[i].y)!=p[j].y||(p[j].z&p[i].z)!=p[j].z) continue;\n            g[i]=(g[i]-g[j]*f[p[i].a-p[j].a][p[i].b-p[j].b][p[i].c-p[j].c]%mod+mod)%mod;\n        }\n    }\n    printf(\"%lld\",g[tot]);\n    return 0;\n}\n```",
        "postTime": 1591581639,
        "uid": 172489,
        "name": "lhm_",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3734 \u3010[HAOI2017]\u65b9\u6848\u6570\u3011"
    },
    {
        "content": "upd 2022/10/14\uff1a\u4fee\u6b63\u4e86\u9898\u89e3\u4e2d\u7684\u90e8\u5206\u9519\u8bef\u5e76\u4f18\u5316\u4e86\u4ee3\u7801\u3002\n### \u524d\u8a00\n\n\u4f5c\u4e3a\u4e00\u540d\u666e\u53ca\u7ec4\u9009\u624b\uff0c\u672c\u6765\u662f\u57fa\u672c\u4e0d\u4f1a\u6478\u9ed1\u9898\u7684\u3002\u4eca\u5929\u673a\u623f\u4e00\u4f4d\u84dd\u52fe\u5927\u4f6c\u544a\u8bc9\u6211\u8fd9\u9053\u6c34\u9ed1\uff0c\u4e8e\u662f\u770b\u4e86\u770b\u3002\u78b0\u5de7\u6211\u5bf9 DP\u3001\u5bb9\u65a5\u7b49\u7406\u89e3\u6bd4\u8f83\u6df1\u523b\uff0c\u624d\u80fd\u5728\u4e0d\u770b\u9898\u89e3\u7684\u60c5\u51b5\u4e0b A \u4e86\u8fd9\u9053\u9898\u3002\u5199\u7bc7\u9898\u89e3\u7eaa\u5ff5\u4e00\u4e0b\u3002  \n\uff08\u8fd9\u9898\u6076\u8bc4\u662f\u4e0d\u662f\u6709\u70b9\u4e25\u91cd\uff09\n## \u601d\u8def\n\uff08\u4ee5\u4e0b\u5b9a\u4e49 $c(x)=\\text{popcount}(x)$\uff09\n\n\u4e0d\u8003\u8651\u969c\u788d\u7269\uff0c\u72b6\u6001\u5177\u6709\u660e\u663e\u7684\u65e0\u540e\u6548\u6027\uff0c\u8003\u8651 DP\u3002\n\n\u8bbe $f_{i,j,k}$ \u8868\u793a $c(x)=i,c(y)=j,c(z)=k$\uff0c\u4ece $(0,0,0)$ \u5230 $(x,y,z)$ \u7684\u5408\u6cd5\u65b9\u6848\u6570\u3002\u5bb9\u6613\u5f97\u5230\u4e0b\u9762\u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$\\begin{aligned}\nf_{i,j,k}&=\\sum\\limits_{u=1}^{i-1}\\text C_i^{i-u}f_{u,j,k}+\\sum\\limits_{u=1}^{j-1}\\text C_j^{j-u}f_{i,u,k}+\\sum\\limits_{u=1}^{k-1}\\text C_k^{k-u}f_{i,j,u}\\\\&=\\sum\\limits_{u=1}^{i-1}\\text C_i^uf_{u,j,k}+\\sum\\limits_{u=1}^{j-1}\\text C_j^uf_{i,u,k}+\\sum\\limits_{u=1}^{k-1}\\text C_k^uf_{i,j,u}\\end{aligned}$$\n\u6ce8\uff1a\u5728\u63a5\u4e0b\u6765\u7684\u8003\u8651\u4e2d\uff0c\u969c\u788d\u7269\u5747\u5df2\u5c06 $x,y,z$ \u4f5c\u4e3a\u5173\u952e\u5b57\u5347\u5e8f\u6392\u5e8f\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u6709\u969c\u788d\u7269\u7684\u60c5\u51b5\uff0c\u8003\u8651\u5bb9\u65a5\uff1a\n\n\u8bbe $g_i$ \u8868\u793a\u4e0d\u7ecf\u8fc7\u5176\u4ed6\u969c\u788d\u7269\u8fbe\u5230\u7b2c $i$ \u4e2a\u969c\u788d\u7269\u7684\u65b9\u6848\u6570\u3002$g$ \u6570\u7ec4\u4e5f\u540c\u6837\u53ef\u4ee5\u901a\u8fc7 DP \u5f97\u5230\uff1a\n$$g_i=f_{c(x_i),c(y_i),c(z_i)}-\\sum\\limits_{j=1}^{i-1}g_jh(j,i)$$\n\n\u5176\u4e2d $h(j,i)$ \u4ee3\u8868\u4ece\u7b2c $j$ \u4e2a\u969c\u788d\u7269\u8d70\u5230\u7b2c $i$ \u4e2a\u969c\u788d\u7269\u7684\u5408\u6cd5\u65b9\u6848\u6570\u3002\n\n\u53d1\u73b0 $h(j,i)$ \u5176\u5b9e\u5c31\u662f $(x_j,y_j,z_j)$ \u5230 $(x_i,y_i,z_i)$ \u7684\u65b9\u6848\u6570\uff0c\u8fd9\u4e0e $f$ \u6570\u7ec4\u7684\u5b9a\u4e49\u6781\u5176\u76f8\u50cf\u3002  \n\u4e8e\u662f\u601d\u8003\u5982\u4f55\u5c06\u4e0a\u8ff0\u65b9\u6848\u6570\u8f6c\u5316\u6210 $f$ \u6570\u7ec4\u4e2d\u7684\u6570\u8868\u793a\u3002\n\n\u601d\u8003\u53d1\u73b0\uff1a  \n\u5982\u679c $(x_j,y_j,z_j)$ \u53ef\u4ee5\u8d70\u5230 $(x_i,y_i,z_i)$\uff0c\u65b9\u6848\u6570\u5176\u5b9e\u5c31\u662f $(0,0,0)$ \u5230 $(x_i\\oplus x_j,y_i\\oplus y_j,z_i\\oplus z_j)$ \u7684\u65b9\u6848\u6570\u3002  \n\uff08$\\oplus$ \u4ee3\u8868\u6309\u4f4d\u5f02\u6216\u8fd0\u7b97\uff09\n\n\u6b64\u65f6\u65b9\u6848\u6570\u5373\u4e3a $f_{c(x_i)-c(x_j)~,~c(y_i)-c(y_j)~,~c(z_i)-c(z_j)}$\u3002\n\n\u4e8e\u662f $h(j,i)$ \u5b9a\u4e49\u5982\u4e0b\uff1a\n$$h(j,i)=\\begin{cases}f_{c(x_i)-c(x_j)~,~c(y_i)-c(y_j)~,~c(z_i)-c(z_j)} &\\text{if} ~point(j)\\subseteq point(i)\\\\0 &\\text{otherwise}\\end{cases}$$\n\u4e3a\u4e86\u66f4\u5bb9\u6613\u5904\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u628a $(n,m,r)$ \u5f53\u4f5c\u7b2c $o+1$ \u4e2a\u969c\u788d\u7269\uff0c\u7b54\u6848\u5373\u4e3a $g_{o+1}$\u3002\n\n\u6211\u4eec\u9884\u5904\u7406\u7ec4\u5408\u6570\uff08\u9636\u4e58\u9006\u5143\u6216\u4e8c\u7ef4\u9012\u63a8\uff09\uff0c\u5c31\u53ef\u4ee5\u5728 $O(\\log n ~\\log m~\\log r~\\log\\max(n,m,r)+o^2)$ \u65f6\u95f4\u5185\u6c42\u89e3\u3002\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int M=998244353;\nconst int N=1e4+5;\n\nint f[70][70][70];\nint fac[70],ifac[70];\nint n,m,r,o;\nint ln,lm,lr;//popcount(n,m,r)\nint g[N];\nstruct bar{\n\tint x,y,z;\n\tint lx,ly,lz;//popcount(x,y,z)\n\tfriend bool operator <(bar a,bar b){\n\t\tif(a.x!=b.x)return a.x<b.x;\n\t\tif(a.y!=b.y)return a.y<b.y;\n\t\treturn a.z<b.z;\n\t}\n}a[N];\nint len;\n\nbool isin(bar a,bar b){//a\u53ef\u4ee5\u8d70\u5230b\n\treturn (a.x&b.x)==a.x && (a.y&b.y)==a.y && (a.z&b.z)==a.z;\n}\nint popcount(int x){\n\tint cnt=0;\n\tfor(;x;x&=x-1)cnt++;\n\treturn cnt;\n}\nint qpow(int a,int b){\n\tint res=1;\n\tfor(;b;b>>=1,a=a*a%M)\n\t\tif(b&1)res=res*a%M;\n\treturn res;\n}\nvoid init(){\n\tfac[0]=1;\n\tfor(int i=1;i<=69;i++)fac[i]=fac[i-1]*i%M;\n\tifac[69]=qpow(fac[69],M-2);\n\tfor(int i=69;i>=0;i--)ifac[i-1]=ifac[i]*i%M;\n}\nint C(int n,int m){return fac[n]*ifac[m]%M*ifac[n-m]%M;}\nvoid upd(int &x,int y){x=(x+y%M)%M;}\n\nsigned main(){\n\tinit();\n\tscanf(\"%lld%lld%lld\",&n,&m,&r);\n\tln=popcount(n);\n\tlm=popcount(m);\n\tlr=popcount(r);\n\tscanf(\"%lld\",&o);\n\tfor(int i=1;i<=o;i++){\n\t\tint x,y,z;\n\t\tscanf(\"%lld%lld%lld\",&x,&y,&z);\n\t\tif(isin({x,y,z},{n,m,r})){//\u53ea\u6709\u80fd\u8d70\u5230\u624d\u5bf9\u7ed3\u679c\u6709\u8d21\u732e\n\t\t\ta[++len]={x,y,z,popcount(x),popcount(y),popcount(z)};\n\t\t}\n\t}\n\ta[++len]={n,m,r,ln,lm,lr};\n\tsort(a+1,a+len+1);\n\tf[0][0][0]=1;\n\tfor(int i=0;i<=ln;i++){\n\t\tfor(int j=0;j<=lm;j++){\n\t\t\tfor(int k=0;k<=lr;k++){\n\t\t\t\tfor(int u=0;u<i;u++)upd(f[i][j][k],f[u][j][k]*C(i,u));\n\t\t\t\tfor(int u=0;u<j;u++)upd(f[i][j][k],f[i][u][k]*C(j,u));\n\t\t\t\tfor(int u=0;u<k;u++)upd(f[i][j][k],f[i][j][u]*C(k,u));\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=len;i++){\n\t\tg[i]=f[a[i].lx][a[i].ly][a[i].lz];\n\t\tfor(int j=1;j<i;j++){\n\t\t\tif(isin(a[j],a[i])){\n\t\t\t\tg[i]=((g[i]-g[j]*f[a[i].lx-a[j].lx][a[i].ly-a[j].ly][a[i].lz-a[j].lz]%M)%M+M)%M;\n\t\t\t}\n\t\t}\n\t}\n\tprintf(\"%lld\",g[len]);\n}\n```\n",
        "postTime": 1665564298,
        "uid": 654546,
        "name": "ScatteredHope",
        "ccfLevel": 5,
        "title": "P3734 \u9898\u89e3"
    },
    {
        "content": "\u5b9a\u4e49\u5168\u96c6 $U$ \u4e3a\u65e0\u4efb\u4f55\u9650\u5236\u65f6\u4ece $(0, 0, 0) \\to (n, m, r)$ \u7684\u8def\u5f84\u96c6\uff0c$C_i$ \u8868\u793a\u4e0d\u7ecf\u8fc7\u7b2c $i$ \u4e2a\u9650\u5236\u70b9\u7684\u8def\u5f84\u96c6\u3002\u6240\u6c42\u5f0f\u4e3a\n\n$$\n\\begin{aligned}\n|\\bigcap C_i| &= |U| - |\\bigcup \\overline{C_i}|\t\\\\\n&= |U| - \\sum_{S \\subseteq[1, o], S \\neq \\varnothing} (-1) ^ {|S| - 1} |\\bigcap_{x \\in S} \\overline{C_x}|\n\\end{aligned}$$\n\n$\\overline{C_i}$ \u5373 $C_i$ \u7684\u8865\u96c6\uff0c\u4e5f\u5373\u7ecf\u8fc7\u7b2c $i$ \u4e2a\u9650\u5236\u70b9\u7684\u8def\u5f84\u96c6\u3002\u6362\u8a00\u4e4b\uff0c\u4e0a\u5f0f\u5373 \u94a6\u5b9a\u7ecf\u8fc7 $0$ \u4e2a\u9650\u5236\u70b9\u7684\u65b9\u6848\u6570 $-$ \u94a6\u5b9a\u7ecf\u8fc7 $1$ \u4e2a\u9650\u5236\u70b9\u7684\u65b9\u6848\u6570 $+$ \u94a6\u5b9a\u7ecf\u8fc7 $2$ \u4e2a\u9650\u5236\u70b9\u7684\u65b9\u6848\u6570\u2026\u2026\u8003\u8651\u8bb0 $g(i)$ \u8868\u793a\u8003\u8651\u4e86\u524d $i$ \u4e2a\u70b9\uff0c\u4e14\u8981\u6c42\u7ecf\u8fc7\u7b2c $i$ \u4e2a\u70b9\u65f6\u7684\u60c5\u51b5\u4e0b**\u5bf9\u5bb9\u65a5\u8fc7\u7a0b\u4ea7\u751f\u7684\u8d21\u732e**\uff08\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u8981\u5728\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u540c\u65f6\u4e58\u4e0a\u5bb9\u65a5\u7cfb\u6570\uff09\u3002\u8bb0 $T(i, j)$ \u8868\u793a\u4ece\u7b2c $i$ \u4e2a\u9650\u5236\u70b9\u5230\u7b2c $j$ \u4e2a\u9650\u5236\u70b9\uff0c\u4e14\u4e0d\u8003\u8651\u5176\u4f59\u4efb\u4f55\u9650\u5236\u7684\u8def\u5f84\u65b9\u6848\u6570\uff0c\u5219 $g(i) = -\\sum \\limits_{j \\in [0, i - 1]} T(j, i)g_j$\u3002\uff08\u8fd9\u4e2a\u8d1f\u53f7\u4f53\u73b0\u7684\u5373\u662f\u5bb9\u65a5\u7cfb\u6570\uff09\n\n\u8003\u8651\u8ba1\u7b97 $T(i, j)$\u3002\u82e5\u4e0d\u6ee1\u8db3 $x_i \\subseteq x_j \\wedge y_i \\subseteq y_j \\wedge z_i \\subseteq z_j$\uff0c\u663e\u7136 $T(i, j) = 0$\uff1b\u5426\u5219\uff0c\u53d1\u73b0\u65e0\u9650\u5236\u6761\u4ef6\u4e0b\u5230\u4e00\u4e2a\u70b9\u7684\u8def\u5f84\u6570\u91cf\u4ec5\u4e0e $n, m, r$ \u4e8c\u8fdb\u5236\u8868\u793a\u4e0b $1$ \u7684\u6570\u91cf\u76f8\u5173\u3002\u8bb0 $f(x, y, z)$ \u8868\u793a\u65e0\u4efb\u4f55\u9650\u5236\u65f6\u4ece $(0, 0, 0) \\to (n, m, r)$ \u7684\u8def\u5f84\u6570\uff0c\u5176\u4e2d $\\mathrm{popcount}(n) = x, \\mathrm{popcount}(m) = y, \\mathrm{popcount}(r) = z$\uff0c\u679a\u4e3e\u4e00\u4e0b\u5b83\u53ef\u4ee5\u4ece\u54ea\u4e9b\u5750\u6807\u8f6c\u79fb\u6765\u53ef\u5f97\n\n$$f(x, y, z) = \\sum_{i < x} f(i, y, z) \\binom{x}{i} + \\sum_{i < y} f(x, i, z) \\binom{y}{i} + \\sum_{i < z} f(x, y, i) \\binom{z}{i}$$\n\n\u90a3\u4e48 $T(i, j) = f(\\mathrm{popcount}(x_i \\oplus x_j), \\mathrm{popcount}(y_i \\oplus y_j), \\mathrm{popcount}(z_i \\oplus z_j))$\u3002\n\n\u6700\u7ec8\u7b54\u6848\u7684\u8ba1\u7b97\u7c7b\u4f3c\u4e8e $g$ \u7684\u8ba1\u7b97\uff0c\u8fd9\u91cc\u7ed9\u51fa\u4e00\u79cd\u66f4\u7b80\u5355\u7684\u65b9\u6cd5\uff0c\u76f4\u63a5\u5c06 $(n, m, r)$ \u4f5c\u4e3a\u969c\u788d\u70b9 $o + 1$\uff0c\u6700\u7ec8\u7b54\u6848\u4e3a $-g(o+1)$\uff08\u56e0\u4e3a\u591a\u52a0\u5165\u4e00\u4e2a\u70b9\u540e\u4f1a\u5f71\u54cd\u5bb9\u65a5\u7cfb\u6570\uff09\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nusing i64 = long long;\n#define pc(x) __builtin_popcountll(x)\n\nconstexpr int N = 70, M = 1e4 + 10, mod = 998244353;\n\ni64 binom[N][N], f[N][N][N], g[M];\n\nstruct point {i64 x, y, z;} p[M];\n\ninline bool subset(i64 x, i64 y) {return ((x & y) == x);}\n\ninline bool ok(int i, int j) {return (subset(p[i].x, p[j].x) && subset(p[i].y, p[j].y) && subset(p[i].z, p[j].z));}\n\nint main(){\n\tios::sync_with_stdio(false); \n\tcin.tie(nullptr); cout.tie(nullptr);\n\t\n\tfor(int i = 0; i < N; i++){\n\t\tbinom[i][0] = 1;\n\t\tfor(int j = 1; j <= i; j++)\n\t\t\tbinom[i][j] = (binom[i - 1][j - 1] + binom[i - 1][j]) % mod;\n\t}\n\tf[0][0][0] = 1;\n\tfor(int x = 0; x < N; x++){\n\t\tfor(int y = 0; y < N; y++){\n\t\t\tfor(int z = 0; z < N; z++){\n\t\t\t\tfor(int i = 0; i < x; i++)\n\t\t\t\t\tf[x][y][z] += f[i][y][z] * binom[x][i], f[x][y][z] %= mod;\n\t\t\t\tfor(int j = 0; j < y; j++)\n\t\t\t\t\tf[x][y][z] += f[x][j][z] * binom[y][j], f[x][y][z] %= mod;\n\t\t\t\tfor(int k = 0; k < z; k++)\n\t\t\t\t\tf[x][y][z] += f[x][y][k] * binom[z][k], f[x][y][z] %= mod;\n\t\t\t}\n\t\t}\n\t}\n\n\ti64 n, m, r; cin >> n >> m >> r;\n\tint o; cin >> o;\n\tfor(int i = 1; i <= o; i++)\n\t\tcin >> p[i].x >> p[i].y >> p[i].z;\n\tsort(p, p + o + 1, [](point &A, point &B){\n\t\treturn (A.x == B.x) ? (A.y == B.y ? A.z < B.z : A.y < B.y) : A.x < B.x;\n\t});\n\n\tp[++o] = {n, m, r};\n\tg[0] = 1;\n\tfor(int i = 1; i <= o; i++){\n\t\tfor(int j = 0; j < i; j++){\n\t\t\tif(!ok(j, i)) continue;\n\t\t\tg[i] += g[j] * f[pc(p[i].x ^ p[j].x)][pc(p[i].y ^ p[j].y)][pc(p[i].z ^ p[j].z)];\n\t\t\tg[i] %= mod;\n\t\t}\n\t\tg[i] = -g[i];\n\t}\n\ti64 ans = -g[o];\n\tcout << (ans % mod + mod) % mod << \"\\n\";\n}\n```",
        "postTime": 1683024072,
        "uid": 710100,
        "name": "ChroneZ_ZU",
        "ccfLevel": 4,
        "title": "P3734 [HAOI2017]\u65b9\u6848\u6570 - \u9898\u89e3"
    },
    {
        "content": "> solution of P3734\n\n\u5f88\u7ecf\u5178\u7684\u9898\u76ee\uff0c\u8003\u8651\u5bb9\u65a5\uff0c\u4e0d\u7ecf\u8fc7\u969c\u788d\u7684\u65b9\u6848\u6570\u7b49\u4e8e\u4e0d\u94a6\u5b9a\u969c\u788d\u7684\u65b9\u6848\u6570\u51cf\u53bb\u94a6\u5b9a\u4e00\u4e2a\u969c\u788d\u7684\u65b9\u6848\u6570\u52a0\u4e0a\u94a6\u5b9a\u4e24\u4e2a\u969c\u788d\u7684\u65b9\u6848\u6570\u8fd9\u6837\u4e0d\u65ad\u4e0b\u53bb\u3002\n\n\u5c06\u969c\u788d\u4e00\u5b9a\u987a\u5e8f\u6392\u5e8f\u540e\u7edf\u8ba1 $f_i$ \u4ee3\u8868\u4ec5\u4ec5\u8003\u8651\u524d $i-1$ \u4e2a\u70b9\uff0c\u76ee\u524d\u5230\u8fbe\u7b2c $i$ \u4e2a\u70b9\u7684\u65b9\u6848\u6570\uff0c\u5bb9\u6613\u5f97\u5230 $f_i=-\\sum f_j$\uff0c\u5176\u4e2d $j$ \u6ee1\u8db3\u4e09\u7ef4\u5750\u6807\u90fd\u5305\u542b\u4e8e $i$ \u7684\u4e09\u7ef4\u5750\u6807\u624d\u53ef\u4ee5\u8f6c\u79fb\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u8f6c\u79fb\u7684\u65f6\u5019\u6211\u4eec\u53ea\u9700\u8981\u77e5\u9053\u8d77\u70b9\u548c\u7ec8\u70b9\u7684\u4e09\u7ef4\u5206\u522b $1$ \u7684\u4e2a\u6570\uff0c\u8fc7\u7a0b\u76f8\u5f53\u4e8e\u662f\u8865\u5168\u76f8\u5dee\u7684 $1$ \u7684\u4e2a\u6570\uff0c\u6211\u4eec\u5b9a\u4e49 $g_{i,j,k}$ \u4e3a\u7b2c\u4e00\u7ef4\u76f8\u5dee $i$ \u4e2a $1$\uff0c\u7b2c\u4e8c\u7ef4\u76f8\u5dee $j$ \u4e2a $1$\uff0c\u7b2c\u4e09\u7ef4\u76f8\u5dee $k$ \u4e2a $1$ \u7684\u65b9\u6848\u6570 \u3002\n\n\u8f6c\u79fb\u7684\u65f6\u5019\u679a\u4e3e\u4e00\u4e2a\u5df2\u6709\u7684\u5dee $p$ \uff0c\u5bb9\u6613\u53d1\u73b0\u586b\u5230\u8fd9 $i$ \u4e2a\u4f4d\u7f6e\u91cc\u6709 $C_{i}^{p}$ \u79cd\u586b\u6cd5\u3002\n\n\u5bb9\u6613\u5f97\u5230 $g$ \u7684\u8f6c\u79fb:\n\n$$g_{i,j,k}=\\sum_{p=0}^{i-1}g_{p,j,k} \\times C_{i}^{p} + \\sum_{p=0}^{i-1}g_{i,p,k} \\times C_{j}^{p} + \\sum_{p=0}^{i-1}g_{i,j,p} \\times C_{k}^{p}$$\n\n\u8fd9\u6837\u5c31\u505a\u5b8c\u4e86 \uff0c \u65f6\u95f4\u590d\u6742\u5ea6 $O(o^2+\\log_{2}^{4}{\\max(n,m,r)})$\n\n```cpp\n//#pragma GCC optimize(\"Ofast,no-stack-protector\")\n//#pragma GCC target(\"sse,sse2,sse3,ssse3,sse4,popcnt,abm,mmx,avx,tune=native\")\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int mod=998244353;\nstruct mint{\n\tint x;mint(int o=0){x=o;}mint&operator+=(mint a){return(x+=a.x)%=mod,*this;}mint&operator-=(mint a){return(x+=mod-a.x)%=mod,*this;}\n\tmint&operator*=(mint a){return(x=1ll*x*a.x%mod),*this;}mint&operator^=( int b){mint a=*this;x=1;while(b)(b&1)&&(*this*=a,1),a*=a,b>>=1;return*this;}\n\tmint&operator/=(mint a){return*this*=(a^=mod-2);}friend mint operator+(mint a,mint b){return a+=b;}friend mint operator-(mint a,mint b){return a-=b;}\n\tfriend mint operator*(mint a,mint b){return a*=b;}friend mint operator/(mint a,mint b){return a/=b;}friend mint operator^(mint a, int b){return a^=b;}\n\tmint operator-(){return 0-*this;}bool operator==(const mint b)const{return x==b.x;}\n};\nsigned main(){\n\tios::sync_with_stdio(false);\n\tcin.tie(NULL),cout.tie(NULL);\n\tconstexpr int maxn(63),maxo(1e5+5);\n\tstatic int n,m,r,t,cnt;\n\tcin >> n >> m >> r >> t;\n\t// f[i] rong chi  , f[i]=-\\sum i<j f[j]\n\t// g[i][j][k] related to bit\n\tstruct obstacle{int a,b,c;};\n\tstatic obstacle obs[maxo];\n\tfor(int i=1;i<=t;i++)\n\t\tcin >> obs[i].a >> obs[i].b >> obs[i].c;\n\tsort(obs+1,obs+1+t,[&](obstacle x,obstacle y){\n\t\tif(x.a^y.a) return x.a<y.a;\n\t\telse if(x.b^y.b) return x.b<y.b;\n\t\telse return x.c<y.c;\n\t});cnt=t,obs[0]={0,0,0},obs[++cnt]={n,m,r};\n\tstatic mint c[maxn][maxn],g[maxn][maxn][maxn];\n\tauto prepare=[&](){\n\t\tc[0][0]=1;\n\t\tfor(int i=1;i<maxn;i++){c[i][0]=1;\n\t\t\tfor(int j=1;j<=i;j++)\n\t\t\t\tc[i][j]=c[i-1][j]+c[i-1][j-1];\n\t\t}\n\t\tg[0][0][0]=1ll;\n\t\tfor(int i=0;i<maxn;i++)\n\t\t\tfor(int j=0;j<maxn;j++)\n\t\t\t\tfor(int k=0;k<maxn;k++){\n\t\t\t\t\tfor(int p=0;p<i;p++) g[i][j][k]+=g[p][j][k]*c[i][p]; \n\t\t\t\t\tfor(int p=0;p<j;p++) g[i][j][k]+=g[i][p][k]*c[j][p];\n\t\t\t\t\tfor(int p=0;p<k;p++) g[i][j][k]+=g[i][j][p]*c[k][p];\n\t\t\t\t}\n\t};prepare();static mint f[maxo];f[0].x=1ll;\n\t#define a(x) (obs[x].a)\n\t#define b(x) (obs[x].b)\n\t#define c(x) (obs[x].c)\n\t#define bcnt(x) (__builtin_popcountll(x))\n\tfor(int i=1;i<=cnt;i++)\n\t\tfor(int j=0;j<i;j++)\n\t\t\tif(((a(i)&a(j))==a(j))&&\n\t\t\t   ((b(i)&b(j))==b(j))&&\n\t\t\t   ((c(i)&c(j))==c(j)))\n\t\t\tf[i]-=f[j]*g[bcnt(a(i)^a(j))][bcnt(b(i)^b(j))][bcnt(c(i)^c(j))];\n\tcout << (mod-f[cnt].x)%mod << '\\n';\n\treturn 0;\n}\n\n```\n",
        "postTime": 1678629445,
        "uid": 235855,
        "name": "shenxinge",
        "ccfLevel": 6,
        "title": "\u5931\u604b\uff0c\u6cea\u5982\u96e8\u6ef4\u822c\u843d\u4e0b"
    },
    {
        "content": "\u7ecf\u5178\u5bb9\u65a5\u3002  \n\u5148 dp \u6c42\u51fa\u4e0d\u542b\u969c\u788d\u70b9\u7684\u65b9\u6848\u6570\u3002\u901a\u8fc7\u89c2\u5bdf\u53ef\u4ee5\u53d1\u73b0\uff0c\u4ece $(0,0,0)$ \u5230 $(x,y,z)$ \u7684\u8def\u5f84\u6761\u6570\u53ea\u548c $x,y,z$ \u7684 $\\text{popcount}$ \u6709\u5173\u3002\u8bbe $i,j,k$ \u5206\u522b\u7b49\u4e8e $x,y,z$ \u7684 $\\text{popcount}$\uff0c\u5219\u5f97\u5230 dp \u8f6c\u79fb\uff1a\n$$dp_{i,j,k}=\\sum^{i-1}_{p=0}\\binom{i}{p}dp_{p,j,k}+\\sum^{j-1}_{p=0}\\binom{j}{p}dp_{i,p,k}+\\sum^{k-1}_{p=0}\\binom{k}{p}dp_{i,j,p}$$\n\u7136\u540e\u5bb9\u65a5\u3002\u5148\u6309\u5b57\u5178\u5e8f\u6392\u5e8f\uff0c\u7136\u540e\u7edf\u8ba1 $ans_i$ \u4e3a\u5230\u8fbe\u7b2c $i$ \u4e2a\u70b9\u4e14\u53ea\u8003\u8651\u524d $i-1$ \u4e2a\u70b9\u7684\u65b9\u6848\u6570\u3002\u679a\u4e3e\u9012\u63a8\u5373\u53ef\u3002  \n# AC \u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\n\nconst int mod = 998244353;\nconst int MAXN = 1e4 + 10;\n\ninline \nint popcnt(ll n) {\n\tint cnt = 0;\n\twhile (n) n &= n - 1, cnt++;\n\treturn cnt;\n}\n\ninline \nint lg2(ll n) {\n\tint cnt = 0;\n\twhile (n) n >>= 1, cnt++;\n\treturn cnt;\n}\n\nstruct node {\n\tll x, y, z;\n\tint cx, cy, cz;\n\tbool operator < (const node &rhs) const { return x == rhs.x ? y == rhs.y ? z < rhs.z : y < rhs.y : x < rhs.x; }\n} a[MAXN];\n\ninline \nbool connect(int p, int q) {\n\tif ((a[p].x & a[q].x) != a[p].x) return 0;\n\tif ((a[p].y & a[q].y) != a[p].y) return 0;\n\tif ((a[p].z & a[q].z) != a[p].z) return 0;\n\treturn 1;\n}\n\nll c[61][61];\n\ninline \nvoid init() {\n\tc[0][0] = 1;\n\tfor (int i = 1; i < 60; i++) {\n\t\tc[i][0] = 1;\n\t\tfor (int j = 1; j < 60; j++) c[i][j] = (c[i - 1][j] + c[i - 1][j - 1]) % mod;\n\t}\n}\n\nll n, m, r;\n\nint cn, cm, cr, o, tot;\n\nll dp[61][61][61], ans[MAXN];\n\ninline \nll calc(int p, int q) {\n\treturn dp[a[p].cx - a[q].cx][a[p].cy - a[q].cy][a[p].cz - a[q].cz];\n}\n\nint main() {\n\tscanf(\"%lld%lld%lld\", &n, &m, &r), init();\n\tcn = lg2(n), cm = lg2(m), cr = lg2(r);\n\tscanf(\"%d\", &o);\n\tfor (int i = 1; i <= o; i++) {\n\t\tll x, y, z;\n\t\tscanf(\"%lld%lld%lld\", &x, &y, &z);\n\t\ta[i] = { x, y, z, popcnt(x), popcnt(y), popcnt(z) };\n\t}\n\tdp[0][0][0] = 1;\n\tfor (int i = 0; i <= cn; i++) {\n\t\tfor (int j = 0; j <= cm; j++) {\n\t\t\tfor (int k = 0; k <= cr; k++) {\n\t\t\t\tfor (int p = 0; p < i; p++) dp[i][j][k] = (dp[i][j][k] + c[i][p] * dp[p][j][k] % mod) % mod;\n\t\t\t\tfor (int p = 0; p < j; p++) dp[i][j][k] = (dp[i][j][k] + c[j][p] * dp[i][p][k] % mod) % mod;\n\t\t\t\tfor (int p = 0; p < k; p++) dp[i][j][k] = (dp[i][j][k] + c[k][p] * dp[i][j][p] % mod) % mod;\n\t\t\t}\n\t\t}\n\t}\n\tsort(a + 1, a + o + 1);\n\ta[++o] = { n, m, r, popcnt(n), popcnt(m), popcnt(r) };\n\tfor (int i = 1; i <= o; i++) {\n\t\tans[i] = dp[a[i].cx][a[i].cy][a[i].cz];\n\t\tfor (int j = 1; j < i; j++) {\n\t\t\tif (connect(j, i)) ans[i] = (ans[i] - ans[j] * calc(i, j) % mod + mod) % mod;\n\t\t}\n\t}\n\tprintf(\"%lld\", ans[o]);\n}\n```",
        "postTime": 1666184625,
        "uid": 406941,
        "name": "Register_int",
        "ccfLevel": 6,
        "title": "P3734 \u9898\u89e3"
    },
    {
        "content": "\u8003\u8651\u5bb9\u65a5\uff0c\u4e0d\u7ecf\u8fc7\u969c\u788d\u70b9\u7684\u65b9\u6848\u6570 = \u4e0d\u7ba1\u969c\u788d\u70b9\u7684\u65b9\u6848\u6570 - \u94a6\u5b9a\u7ecf\u8fc7\u4e00\u4e2a\u969c\u788d\u70b9\u7684\u65b9\u6848\u6570 + \u94a6\u5b9a\u7ecf\u8fc7\u4e24\u4e2a\u969c\u788d\u70b9\u7684\u65b9\u6848\u6570 - \u2026\u2026\n\n\u4ee4 $f_i$ \u8868\u793a\u8d70\u5230\u7b2c $i$ \u4e2a\u969c\u788d\u70b9\u7684\u7b54\u6848\uff0c\u90a3\u4e48 $f_i=-\\sum_{j<i}f_j( $\u4ece\u7b2c $j$ \u4e2a\u969c\u788d\u70b9\u8d70\u5230\u7b2c $i$ \u4e2a\u969c\u788d\u70b9\u7684\u65b9\u6848\u6570$ )$\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u628a $(0,0,0)$ \u548c $(n,m,r)$ \u4e5f\u8bbe\u6210\u7b2c $0$ \u4e2a\u548c\u7b2c $o+1$ \u4e2a\u969c\u788d\u70b9\uff0c\u90a3\u4e48\u521d\u59cb $f_0=1$\uff0c\u6700\u540e\u7b54\u6848\u662f $-f_{o+1}$\u3002\n\n\u7136\u540e\u9700\u8981\u5904\u7406\u4e24\u4e2a\u70b9\u4e4b\u95f4\u7684\u65b9\u6848\u6570\uff0c\u53d1\u73b0\u65b9\u6848\u6570\u548c\u6bcf\u7ef4\u4e8c\u8fdb\u5236\u4e0a\u5dee\u7684\u90e8\u5206\u6709\u5173\uff0c\u800c\u4e14\u53ea\u548c\u5dee\u7684\u4f4d\u6570\u6709\u5173\uff0c\u90a3\u4e48\u8bbe $g_{i,j,k}$ \u4e3a\u4e09\u7ef4\u5206\u522b\u5dee $i,j,k$ \u4f4d\uff0c\u8d70\u8fc7\u6765\u7684\u65b9\u6848\u6570\u3002\n\n\u6240\u4ee5\u6709\n\n$$g_{i,j,k}=\\sum_{0\\le p<i}g_{p,j,k}\\dbinom{i}{p}+\\sum_{0\\le p<j}g_{i,p,k}\\dbinom{j}{p}+\\sum_{0\\le p<k}g_{i,j,p}\\dbinom{k}{p}$$\n\n\u521d\u503c\u662f $g_{0,0,0}=1$\uff0c\u505a\u5b8c\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nconst ll mod=998244353;\nint n;\nll X,Y,Z;\nll f[10005],g[65][65][65];\nll C[65][65];\nstruct node{\n\tll a,b,c;\n\tbool operator <(const node &y)const{\n\t\tif(a!=y.a)return a<y.a;\n\t\telse if(b!=y.b)return b<y.b;\n\t\telse return c<y.c;\n\t}\n}a[10005];\nint bitcnt(ll x){return !x?0:bitcnt(x&x-1)+1;}\nint main(){\n\tC[0][0]=1;\n\tfor(int i=1;i<=60;i++){\n\t\tC[i][0]=1;\n\t\tfor(int j=1;j<=i;j++)C[i][j]=(C[i-1][j]+C[i-1][j-1])%mod;\n\t}\n\tg[0][0][0]=1;\n\tfor(int i=0;i<=60;i++)\n\t\tfor(int j=0;j<=60;j++)\n\t\t\tfor(int k=0;k<=60;k++){\n\t\t\t\tfor(int p=0;p<i;p++)g[i][j][k]=(g[i][j][k]+g[p][j][k]*C[i][p]%mod)%mod;\n\t\t\t\tfor(int p=0;p<j;p++)g[i][j][k]=(g[i][j][k]+g[i][p][k]*C[j][p]%mod)%mod;\n\t\t\t\tfor(int p=0;p<k;p++)g[i][j][k]=(g[i][j][k]+g[i][j][p]*C[k][p]%mod)%mod;\n\t\t\t}\n\tscanf(\"%lld%lld%lld\",&X,&Y,&Z);\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%lld%lld%lld\",&a[i].a,&a[i].b,&a[i].c);\n\tsort(a+1,a+n+1);\n\ta[++n]=(node){X,Y,Z};\n\ta[0]=(node){0,0,0};\n\tf[0]=1;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=0;j<i;j++)\n\t\t\tif((a[j].a&a[i].a)==a[j].a&&(a[j].b&a[i].b)==a[j].b&&(a[j].c&a[i].c)==a[j].c)\n\t\t\t\tf[i]=(f[i]-f[j]*g[bitcnt(a[i].a^a[j].a)][bitcnt(a[i].b^a[j].b)][bitcnt(a[i].c^a[j].c)]%mod+mod)%mod;\n\tprintf(\"%lld\\n\",(mod-f[n])%mod);\n\treturn 0;\n}\n```",
        "postTime": 1655468859,
        "uid": 233462,
        "name": "Umbrella_Leaf",
        "ccfLevel": 8,
        "title": "\u9898\u89e3P3734 [HAOI2017]\u65b9\u6848\u6570"
    }
]