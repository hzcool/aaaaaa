[
    {
        "content": "### \u9898\u610f\n\n\u7565\u3002\n\n### \u9898\u89e3\n\n\u6211\u6211\u6211\u518d\u4e5f\u4e0d\u505a\u8c03\u53c2\u4eba\u4e86\uff01\n\n\u53c2\u6570\u662f\u91cd\u65b0\u8c03\u7684\uff08\u56e0\u4e3a\u539f\u6765\u7684\u7b54\u6848\u4e22\u4e86\uff09\uff0c\u62a2\u4e86\u4e2a\u4f60\u8c37\u9996 A \u8fd8\u662f\u86ee\u5f00\u5fc3\u3002/cy\n\n\u4e00\u5f00\u59cb\u60f3\u7684\u662f\u679a\u4e3e\u767d\u8272\u56e2\u5b50\u5339\u914d\u54ea\u4e24\u4e2a\uff0c\u5982\u679c\u80fd\u5339\u914d\u5c31\u5339\u914d\uff0c\u53d1\u73b0\u8fd9\u4e1c\u897f\u53ea\u80fd\u5199\u968f\u673a\u8d2a\u5fc3\uff0c\u4e8e\u662f\u8003\u8651\u53d8\u6362\u4e00\u4e0b\u679a\u4e3e\u7eff\u8272\u6216\u8005\u7c89\u8272\uff0c\u5927\u6982\u8fd9\u6837\uff1a\n\n\u5bf9\u4e8e\u4e00\u4e2a\u5f53\u524d\u6ca1\u6709\u5339\u914d\u7684\u975e\u767d\u8272\u56e2\u5b50\uff0c\u679a\u4e3e\u516b\u4e2a\u65b9\u5411\u770b\u80fd\u4e0d\u80fd\u5339\u914d\uff0c\u5982\u679c\u80fd\u5339\u914d\u4e14\u4e0d\u4f1a\u5e26\u6765\u51b2\u7a81\u5219\u5339\u914d\uff0c\u5426\u5219\u64a4\u9500\u4e0e\u4e4b\u51b2\u7a81\u56e2\u5b50\u7684\u5339\u914d\uff0c\u7136\u540e\u7c7b\u4f3c\u5308\u7259\u5229\u89e3\u51b3\u51b2\u7a81\u95ee\u9898\u3002\n\n\u4f46\u662f\u8fd9\u4e2a\u4e1c\u897f\u5e76\u4e0d\u80fd\u4e00\u904d\u6c42\u51fa\u6700\u4f18\u89e3\uff0c\u6240\u4ee5\u5927\u6982\u53ef\u4ee5\u8003\u8651\u5237\u4e00\u4e0b\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u60c5\u51b5\u968f\u5f88\u591a\u65b9\u6848\u51fa\u6765\u53d6\u4e2a $\\max$ \u5f97\u5230\u6700\u4f18\u65b9\u6848\u3002\n\n\u4f46\u662f\u8fd9\u4e2a\u6240\u8c13\u7684\u6700\u4f18\u65b9\u6848\u6709\u4e9b\u65f6\u5019\u8fd8\u4e0d\u591f\uff0c\u4e8e\u662f\u8003\u8651\u7528\u8fd9\u4e2a\u521d\u59cb\u89e3\u53bb\u5237\u66f4\u597d\u7684\u89e3\uff0c\u7c7b\u4f3c\u6a21\u62df\u9000\u706b\u4e00\u6837\u4e00\u5f00\u59cb\u968f\u673a\u7684\u5e45\u5ea6\u5f88\u5927\uff0c\u7136\u540e\u540e\u9762\u968f\u673a\u5e45\u5ea6\u5f88\u5c0f\u6765\u8c03\u6574\uff0c\u7136\u540e\u591a\u82b1\u70b9\u65f6\u95f4\u5237\u89e3\u5e94\u8be5\u80fd\u884c\u3002\n\n\u63d0\u4ea4\u7684\u7b54\u6848\u662f\u8fd9\u6837\u7684\uff1a\n\n```plain\nData 1: 47220\nData 2: 41984\nData 3: 51391\nData 4: 19129\nData 5: 48625\nData 6: 46503\n```\n\n\u7531\u4e8e\u589e\u52a0\u4e86\u8bb8\u591a\u4e00\u8f6e\u5237\u89e3\u65f6\u5019\u7684\u6b21\u6570\u6240\u4ee5\u76ee\u524d\u5f97\u5230\u7684\u7ed3\u679c\u6bd4\u4e4b\u524d\u7684\u90a3\u4e00\u4efd\u89e3\u6cd5\u8981\u597d\uff0c\u5982\u679c\u5927\u5bb6\u6709\u66f4\u597d\u7684\u7b54\u6848\u53ef\u4ee5\u8054\u7cfb\u6211\u3002\n\n\u4e0b\u9762\u7684\u4ee3\u7801\u5927\u6982\u662f\u8fd9\u4e48\u7528\u7684\uff1a\u8f93\u5165\u6d4b\u8bd5\u6570\u636e\u7f16\u53f7\u548c\u53c2\u6570\uff08\u53c2\u6570\u4e3a $0$ \u5219\u4e3a\u5237\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u521d\u59cb\u89e3\u5b58\u5230 `.out1` \u4e2d\uff0c\u53c2\u6570\u4e3a $1$ \u5219\u610f\u5473\u7740\u4ece `.out1` \u4e2d\u5f97\u5230\u4e00\u4efd\u597d\u7684\u521d\u59cb\u89e3\u5237\u4e00\u4e2a\u66f4\u597d\u7684\uff09\uff0c\u7136\u540e\u4e00\u8f6e\u5927\u6982\u662f 500s \u5de6\u53f3\u7684\u6837\u5b50\u53ef\u4ee5\u8dd1\u51fa\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u89e3\uff0c\u6bd5\u7adf\u63d0\u7b54\u9898\u5c31\u662f\u770b\u8010\u5fc3\u4ee5\u53ca\u7b97\u6cd5\u7684\u4f18\u79c0\u7a0b\u5ea6\u3002\n\n\u5982\u679c\u5e76\u884c\u7684\u8bdd\u5e94\u8be5\u80fd\u591f\u5728 30min \u4e4b\u5185\u8dd1\u5b8c\u6240\u6709 6 \u4e2a\u6570\u636e\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#pragma GCC optimize(\"Ofast,unroll-loops\")\nusing namespace std;\ntypedef int ll;\ntypedef long long int li;\ntypedef pair<ll,ll> pii;\nconst ll MAXN=505;\nvector<pii>v;\nll n,m,r,rr,par,tp;\nstring test;\nmt19937 mt(time(0));\nll vx[8]={1,-1,0,0,1,-1,1,-1},vy[8]={0,0,1,-1,1,-1,-1,1};\nll vis[MAXN][MAXN],match[MAXN][MAXN][2],matchr[MAXN][MAXN][2];\nchar ch[MAXN][MAXN],chr[MAXN][MAXN],res[MAXN][MAXN];\ninline ll read()\n{\n    register ll num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n}\ninline char getId(char x)\n{\n    return x=='|'?0:x=='-'?1:x=='\\\\'?2:3;\n}\ninline char getOp(ll x)\n{\n    return \"|-\\\\/\"[x>>1];\n}\ninline ll dfs(ll x,ll y)\n{\n    ll wx,wy,px,py,cx,cy;\n    if(vis[x][y])\n    {\n        return 0;\n    }\n    vis[x][y]=1,v.push_back((pii){x,y});\n    for(register int i=0;i<8;i++)\n    {\n        wx=x+vx[i],wy=y+vy[i],px=wx+vx[i],py=wy+vy[i];\n        if(ch[wx][wy]=='W'&&ch[px][py]+ch[x][y]=='P'+'G')\n        {\n            cx=match[px][py][0],cy=match[px][py][1],ch[wx][wy]=getOp(i);\n            if(cx==-1||dfs(cx,cy))\n            {\n                if(cx!=-1)\n                {\n                    for(register int j=0;j<8;j++)\n                    {\n                        if(cx+2*vx[j]==px&&cy+2*vy[j]==py)\n                        {\n                            ch[cx+vx[j]][cy+vy[j]]='W';\n                        }\n                    }\n                }\n                match[px][py][0]=x,match[px][py][1]=y;  \n                match[x][y][0]=px,match[x][y][1]=py;\n                return 1;\n            }   \n            ch[wx][wy]='W';\n        }\n    }\n    return 0;\n}\ninline void calc(ll op)\n{\n    vector<pii>cc;\n    for(register int i=1;i<=n;i++)\n    {\n        for(register int j=1;j<=m;j++)\n        {\n            ch[i][j]!='W'&&match[i][j][0]==-1?cc.push_back((pii){i,j}):(void)1;\n        }\n    }\n    if(op)\n    {\n        shuffle(cc.begin(),cc.end(),mt);\n    }\n    for(auto i:cc)\n    {\n        if(match[i.first][i.second][0]==-1)\n        {\n            r+=dfs(i.first,i.second);\n            for(auto j:v)\n            {\n                vis[j.first][j.second]=0;\n            }\n            v.clear();\n        }\n    }\n}\ninline void calc1(ll c)\n{\n    vector<pii>undo;\n    memcpy(matchr,match,sizeof(match)),memcpy(chr,ch,sizeof(ch)),rr=r;\n    for(register int i=1;i<=n;i++)\n    {\n        for(register int j=1;j<=m;j++)\n        {\n            !isupper(ch[i][j])?undo.push_back((pii){i,j}):(void)1;\n        }\n    }\n    shuffle(undo.begin(),undo.end(),mt);\n    for(auto i:undo)\n    {\n        if(!(mt()%(ll)ceil(1.5*c)))\n        {\n            ll x=i.first,y=i.second,tp=getId(ch[x][y]);\n            ch[x][y]='W',r--;\n            match[x+vx[tp<<1]][y+vy[tp<<1]][0]=-1;\n            match[x+vx[tp<<1]][y+vy[tp<<1]][1]=-1;\n            match[x+vx[tp<<1|1]][y+vy[tp<<1|1]][0]=-1;\n            match[x+vx[tp<<1|1]][y+vy[tp<<1|1]][1]=-1;\n        }\n    }\n    calc(1);\n    if(r<rr)\n    {\n        memcpy(match,matchr,sizeof(match)),memcpy(ch,chr,sizeof(ch)),r=rr;\n    }\n}\nint main()\n{\n    cin>>test,par=read();\n    if(par==0)\n    {\n        freopen((test+\".in\").c_str(),\"r\",stdin);\n        freopen((test+\".out1\").c_str(),\"w\",stdout);\n    }\n    if(par==1)\n    {\n        freopen((test+\".out1\").c_str(),\"r\",stdin);\n        freopen((test+\".out\").c_str(),\"w\",stdout);\n    }\n    srand(time(0));\n    memset(match,-1,sizeof(match));\n    if(par==1)\n    {\n        n=m=500;\n    }\n    else\n    {\n        n=read(),m=read();\n    }\n    fprintf(stderr,\"%d %d\\n\",n,m);\n    for(register int i=1;i<=n;i++)\n    {\n        scanf(\"%s\",ch[i]+1);\n    }\n    fprintf(stderr,\"%d\\n\",strlen(ch[1]+1));\n    if(par)\n    {\n        for(register int i=1;i<=n;i++)\n        {\n            for(register int j=1;j<=m;j++)\n            {\n                if(!isupper(ch[i][j]))\n                {\n                    tp=getId(ch[i][j]),r++;\n                    match[i+vx[tp<<1]][j+vy[tp<<1]][0]=i+vx[tp<<1|1];\n                    match[i+vx[tp<<1]][j+vy[tp<<1]][1]=j+vy[tp<<1|1];\n                    match[i+vx[tp<<1|1]][j+vy[tp<<1|1]][0]=i+vx[tp<<1];\n                    match[i+vx[tp<<1|1]][j+vy[tp<<1|1]][1]=j+vy[tp<<1];\n                }\n            }\n        }\n    }\n    else\n    {\n        calc(0);\n    }\n    fprintf(stderr,\"%d\\n\",r);\n    for(register int i=1;i<=200;i++)\n    {\n        for(register int j=1;j<=60;j++)\n        {\n            calc1(i);\n            if(j%10==0)\n            {\n                fprintf(stderr,\"%d\\n\",r);\n            }\n        }\n    }\n    fprintf(stderr,\"%d\\n\",r);\n    for(register int i=1;i<=n;i++)\n    {\n        printf(\"%s\\n\",ch[i]+1);\n    }\n}\n```",
        "postTime": 1609511841,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7218 \u3010[JOISC2020] \u4f1d\u8aac\u306e\u56e3\u5b50\u8077\u4eba\u3011"
    },
    {
        "content": "## P7218 [JOISC2020] \u4f1d\u8aac\u306e\u56e3\u5b50\u8077\u4eba\n\n~~\u6a21\u62df\u9000\u706b\u771f\u7684\u662f\u592a\u597d\u73a9\u4e86\uff01~~\n\nupd\uff1a\u53d1\u73b0\u539f\u7a0b\u5e8f\u5b9e\u9645\u4e0a\u662f\u4e00\u4efd\u722c\u5c71\uff0c\u73b0\u6dfb\u52a0\u8bf4\u660e\u5e76\u8865\u5145\u6a21\u62df\u9000\u706b\u4ee3\u7801\u3002\n\nupd:\u53d6\u6d88\u4e86 NP-Hard \u7684 LaTeX\u3002\n\n### \u9898\u610f\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\n\n[P7218 [JOISC2020] \u4f1d\u8aac\u306e\u56e3\u5b50\u8077\u4eba](https://www.luogu.com.cn/problem/P7218)\n\n### \u505a\u6cd5\u5206\u6790\n\n\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u8fd9\u4e2a\u95ee\u9898\u53ef\u4ee5\u8f6c\u5316\u6210\u4e00\u822c\u56fe\u7684\u6700\u5927\u72ec\u7acb\u96c6\u3002\n\n\u5373\u6211\u4eec\u628a\u51e0\u4e32\u5171\u7528\u4e86\u76f8\u540c\u4f4d\u7f6e\u7684\u4e38\u5b50\u8fde\u8fb9\uff0c\u8868\u793a\u5b83\u4eec\u4e0d\u80fd\u540c\u65f6\u5b58\u5728\uff0c\u4e8e\u662f\u8fd9\u4e2a\u95ee\u9898\u5c31\u8f6c\u5316\u5b8c\u6210\u4e86\u3002\n\n\u6211\u4eec\u77e5\u9053\u8fd9\u662f\u4e2a NP-Hard \u95ee\u9898\uff0c\u90a3\u5c31\u9700\u8981\u8003\u8651\u6a21\u62df\u9000\u706b\u3002\n\n\u5148\u6309\u4e00\u4e32\u4e00\u4e32\u5730\u628a\u56fe\u5efa\u597d\u3002\u7136\u540e\u9000\u706b\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u6b21\u9009\u4e00\u4e2a\u6ca1\u9009\u7684\u70b9\uff0c\u9009\u4e2d\u5b83\u5e76\u9000\u6389\u4e0e\u5b83\u76f8\u8fde\u7684\u5df2\u9009\u4e2d\u7684\u70b9\uff0c**\u5e76\u66f4\u65b0\u4e0e\u9000\u6389\u7684\u70b9\u76f8\u8fde\u7684\u90a3\u4e9b\u70b9**\uff08\u8fd9\u4e00\u6b65\u5f88\u91cd\u8981\u4e0d\u7136\u7b54\u6848\u8d8a\u8dd1\u8d8a\u52a3\uff09\u3002\n\n\u7136\u540e\u524d\u9762\u51e0\u7bc7\u9898\u89e3\u662f\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u6ca1\u9009\u7684\u70b9\u6bcf\u6b21\u968f\u673a\u6392\u540d\uff0c\u5b9e\u9645\u4e0a\u76f4\u63a5\u7eaf\u968f\u5c31\u53ef\u4ee5\uff0c\u4e00\u76f4\u968f\u76f4\u5230\u968f\u5230\u4e00\u4e2a\u6ca1\u9009\u7684\u70b9\uff0c\u5b9e\u6d4b\u547d\u4e2d\u7387\u8fd8\u662f\u76f8\u5f53\u9ad8\u7684\u3002\n\n### \u5efa\u56fe\n\n\u8fd9\u91cc\u662f\u8003\u8651\u6bcf\u4e2a\u4e2d\u95f4\u7684 `W`\uff0c\u5206\u522b\u8ba8\u8bba\u56db\u4e2a\u65b9\u5411\u3002\u53ea\u8981\u4fdd\u8bc1\u4e24\u8fb9\u90fd\u4e0d\u662f `W` \u5e76\u4e14\u4e0d\u540c\u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u8fde\u8fb9\u8fd9\u91cc\u5728\u6bcf\u4e2a\u70b9\u4e0a\u5f00\u4e86\u4e2a `vector` \u5b58\u5305\u542b\u8be5\u70b9\u4e32\u7684\u7f16\u53f7\u3002\n\n\uff08\u4f3c\u4e4e\u662f\u73b0\u6709\u9898\u89e3\u533a\u91cc\u6700\u77ed\u7684\u4ee3\u7801\u4e86\uff09\n\n### \u8c03\u53c2\n\n\u8fd9\u4e2a\u73a9\u610f\u8c03\u4e86\u6211\u4e00\u4e0a\u5348\uff0c\u4e3b\u8981\u662f\u6a21\u62df\u9000\u706b\u8981\u4fdd\u8bc1\u63a5\u53d7\u52a3\u89e3\u7684\u6982\u7387\u4e0d\u8981\u592a\u9ad8\uff0c\u5b9e\u5728\u4e0d\u884c\u7ed9 $d$ \u4e58\u4e0a\u4e00\u4e2a\u7cfb\u6570 $k$ \u6765\u653e\u5927\u4ee3\u4ef7\uff0c\u4e0d\u7136\u5c31\u4f1a\u8d8a\u8dd1\u8d8a\u52a3\u751a\u81f3\u5e72\u4e0d\u8fc7\u722c\u5c71\u3002~~\u6a21\u62df\u9000\u5316\u7b97\u6cd5~~\n\n\u56e0\u4e3a\u540e\u6765\u53d1\u73b0\u901a\u8fc7\u7684\u5b9e\u9645\u4e0a\u5df2\u7ecf\u9000\u5316\u6210\u4e86\u722c\u5c71\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e0d\u518d\u7ed9\u51fa\u6240\u6709\u7684\u53c2\u6570\uff0c\u4ec5\u653e\u51fa\u7b2c\u4e94\u4e2a\u70b9\u76f8\u5bf9\u8f83\u4f18\u7684\u53c2\u6570\uff1a\n\n`#5:T=6,dta=0.999995,k=16`\n\n\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u722c\u5c71\u80fd\u8fc7\uff0c\u6240\u4ee5\u8fd9\u91cc\u653e\u51fa\u4e24\u4efd\u4ee3\u7801\u3002\n\n### \u8d34\u4ee3\u7801\n\n#### \u722c\u5c71\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#define lint long long\nusing namespace std;\ninline int read(){\n\tchar c;int f=1,res=0;\n\twhile(c=getchar(),!isdigit(c))if(c=='-')f*=-1;\n\twhile(isdigit(c))res=res*10+c-'0',c=getchar();\n\treturn res*f;\n}\nconst int N=505,P=N*N*8;\nint hed[P],nxt[P],ver[P],cnt=1;\ninline void ae(int u,int v){\n\tver[++cnt]=v;\n\tnxt[cnt]=hed[u];\n\thed[u]=cnt;\n}\ninline void lnk(int u,int v)\n\t{ae(u,v);ae(v,u);}\nvector<int> ex[N][N];\nint d[4][2]={{0,1},{1,0},{1,1},{1,-1}};\nchar c[4]={'-','|','\\\\','/'};\nstruct pnt{int x,y,d;}p[P];\nint n,m,tot=0;char s[N][N];\ninline void inst(int x,int y,int dir){//\u52a0\u70b9 \n\tint x0=x+d[dir][0],y0=y+d[dir][1];\n\tint x1=x-d[dir][0],y1=y-d[dir][1];\n\tif(x0<1||y0<1||x1<1||y1<1)return;\n\tif(x0>n||x1>n||y0>m||y1>m)return;\n\tif(s[x0][y0]=='W'||s[x1][y1]=='W')\n\t\treturn;\n\tif(s[x][y]!='W'||s[x0][y0]==s[x1][y1])\n\t\treturn;\n\tint u=++tot;p[u]=pnt{x,y,dir};\n\tfor(int v:ex[x][y])lnk(u,v);ex[x][y].push_back(u);\n\tfor(int v:ex[x0][y0])lnk(u,v);ex[x0][y0].push_back(u);\n\tfor(int v:ex[x1][y1])lnk(u,v);ex[x1][y1].push_back(u);\n}\ninline void build(){//\u5efa\u56fe \n\tfor(int i=1;i<=n;++i)\n\t\tfor(int j=1;j<=m;++j)\n\t\t\tfor(int k=0;k<4;++k)\n\t\t\t\tinst(i,j,k);\n}\nint ans;\nbitset<P> vis,_vis,avis;\ninline bool ck(int u){//\u5224\u65ad\u5f53\u524d\u70b9\u80fd\u5426\u9009 \n\tif(_vis[u])return false;\n\tfor(int e=hed[u];e;e=nxt[e])\n\t\tif(_vis[ver[e]])return false;\n\treturn true;\n}\ninline int calc(){//\u4ea7\u751f\u521d\u59cb\u89e3 \n\tint res=0;\n\tfor(int u=1;u<=tot;++u)\n\t\tif(ck(u))_vis[u]=1,++res;\n\treturn res;\n}\ninline int rnd(int md)\n\t{return 1ll*rand()*rand()%md+1;}\ninline int del(int u){\n\t_vis[u]=0;int res=0;\n\tfor(int e=hed[u];e;e=nxt[e])\n\t\tif(ck(ver[e]))_vis[ver[e]]=1,++res;\n\treturn res;\n}\ninline int upd(){//\u4ea7\u751f\u65b0\u89e3 \n\t_vis=vis;\n\tint res=0,t=0;\n\twhile(++t<=10){//\u6ca1\u4ec0\u4e48\u7528\u7684\u9632\u6b7b\u5faa\u73af \n\t\tint u=rnd(tot);\n\t\tif(_vis[u])continue;\n\t\t_vis[u]=1;++res;\n\t\tfor(int e=hed[u];e;e=nxt[e]){\n\t\t\tint v=ver[e];\n\t\t\tif(_vis[v])res+=del(v)-1;\n\t\t\t//\u9000\u6389\u4e0eu\u76f8\u8fde\u7684v\u5e76\u66f4\u65b0\u4e0ev\u76f8\u8fde\u7684\u70b9 \n\t\t}break;\n\t}return res;\n}\ninline void SA(){\n\tans=calc();vis=_vis;\n\tint res=ans,_res;\n\tdouble T=0.01,dta=0.999999,k=16;\n\twhile(ans<48620){\n\t\t_res=res+upd();\n\t\tif(_res>ans)//\u4e5f\u8bb8\u8fd9\u91cc\u4e0d\u662f\u6bd4\u8f83\u5168\u5c40\u7b54\u6848\uff0c\u4f46\u597d\u50cf\u8fd9\u6837\u8dd1\u5f97\u5feb\u4e9b \n\t\t\tavis=vis=_vis,ans=res=_res,cout<<T<<\" \"<<ans<<endl;\n\t\telse if(exp(k*(_res-ans)/T)*RAND_MAX>rand())\n\t\t\tvis=_vis,res=_res;\n\t\tT*=dta;\n\t}\n}\nint main(){\n\tfreopen(\"05.in\",\"r\",stdin);\n\tn=read();m=read();\n\tfor(int i=1;i<=n;++i)\n\t\tscanf(\"%s\",s[i]+1);\n\tbuild();SA();\n\tfor(int i=1;i<=tot;++i)\n\t\tif(avis[i])\n\t\t\ts[p[i].x][p[i].y]=c[p[i].d];\n\tfreopen(\"05.ans\",\"w\",stdout);\n\tfor(int i=1;i<=n;++i)\n\t\tprintf(\"%s\\n\",s[i]+1);\n\treturn 0;\n}\n```\n\n#### \u6a21\u62df\u9000\u706b\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#define lint long long\nusing namespace std;\ninline int read(){\n\tchar c;int f=1,res=0;\n\twhile(c=getchar(),!isdigit(c))if(c=='-')f*=-1;\n\twhile(isdigit(c))res=res*10+c-'0',c=getchar();\n\treturn res*f;\n}\nconst int N=505,P=N*N*8;\nint hed[P],nxt[P],ver[P],cnt=1;\ninline void ae(int u,int v){\n\tver[++cnt]=v;\n\tnxt[cnt]=hed[u];\n\thed[u]=cnt;\n}\ninline void lnk(int u,int v)\n\t{ae(u,v);ae(v,u);}\nvector<int> ex[N][N];\nint d[4][2]={{0,1},{1,0},{1,1},{1,-1}};\nchar c[4]={'-','|','\\\\','/'};\nstruct pnt{int x,y,d;}p[P];\nint n,m,tot=0;char s[N][N];\ninline void inst(int x,int y,int dir){//\u52a0\u70b9 \n\tint x0=x+d[dir][0],y0=y+d[dir][1];\n\tint x1=x-d[dir][0],y1=y-d[dir][1];\n\tif(x0<1||y0<1||x1<1||y1<1)return;\n\tif(x0>n||x1>n||y0>m||y1>m)return;\n\tif(s[x0][y0]=='W'||s[x1][y1]=='W')\n\t\treturn;\n\tif(s[x][y]!='W'||s[x0][y0]==s[x1][y1])\n\t\treturn;\n\tint u=++tot;p[u]=pnt{x,y,dir};\n\tfor(int v:ex[x][y])lnk(u,v);ex[x][y].push_back(u);\n\tfor(int v:ex[x0][y0])lnk(u,v);ex[x0][y0].push_back(u);\n\tfor(int v:ex[x1][y1])lnk(u,v);ex[x1][y1].push_back(u);\n}\ninline void build(){//\u5efa\u56fe \n\tfor(int i=1;i<=n;++i)\n\t\tfor(int j=1;j<=m;++j)\n\t\t\tfor(int k=0;k<4;++k)\n\t\t\t\tinst(i,j,k);\n}\nint ans;\nbitset<P> vis,_vis,avis;\ninline bool ck(int u){//\u5224\u65ad\u5f53\u524d\u70b9\u80fd\u5426\u9009 \n\tif(_vis[u])return false;\n\tfor(int e=hed[u];e;e=nxt[e])\n\t\tif(_vis[ver[e]])return false;\n\treturn true;\n}\ninline int calc(){//\u4ea7\u751f\u521d\u59cb\u89e3 \n\tint res=0;\n\tfor(int u=1;u<=tot;++u)\n\t\tif(ck(u))_vis[u]=1,++res;\n\treturn res;\n}\ninline int rnd(int md)\n\t{return 1ll*rand()*rand()%md+1;}\ninline int del(int u){\n\t_vis[u]=0;int res=0;\n\tfor(int e=hed[u];e;e=nxt[e])\n\t\tif(ck(ver[e]))_vis[ver[e]]=1,++res;\n\treturn res;\n}\ninline int upd(){//\u4ea7\u751f\u65b0\u89e3 \n\t_vis=vis;\n\tint res=0,t=0;\n\twhile(++t<=10){//\u6ca1\u4ec0\u4e48\u7528\u7684\u9632\u6b7b\u5faa\u73af \n\t\tint u=rnd(tot);\n\t\tif(_vis[u])continue;\n\t\t_vis[u]=1;++res;\n\t\tfor(int e=hed[u];e;e=nxt[e]){\n\t\t\tint v=ver[e];\n\t\t\tif(_vis[v])res+=del(v)-1;\n\t\t\t//\u9000\u6389\u4e0eu\u76f8\u8fde\u7684v\u5e76\u66f4\u65b0\u4e0ev\u76f8\u8fde\u7684\u70b9 \n\t\t}break;\n\t}return res;\n}\ninline void SA(){\n\tans=calc();vis=_vis;\n\tint res=ans,_res;\n\tdouble T=6,dta=0.999995,k=16;\n\twhile(ans<48620){\n\t\t_res=res+upd();\n\t\tif(_res>=res){\n\t\t\tif(_res>ans)\n\t\t\t\tans=_res,avis=_vis,cout<<T<<\" \"<<_res<<endl;\n\t\t\tvis=_vis;res=_res;\n\t\t}else if(exp(k*(_res-res)/T)*2e9>rnd(2e9))\n\t\t\tvis=_vis,res=_res;\n\t\tT*=dta;\n\t}\n}\nint main(){\n\tios::sync_with_stdio(false);\n\tfreopen(\"05.in\",\"r\",stdin);\n\tn=read();m=read();\n\tfor(int i=1;i<=n;++i)\n\t\tscanf(\"%s\",s[i]+1);\n\tbuild();SA();\n\tfor(int i=1;i<=tot;++i)\n\t\tif(avis[i])\n\t\t\ts[p[i].x][p[i].y]=c[p[i].d];\n\tfreopen(\"05.ans\",\"w\",stdout);\n\tfor(int i=1;i<=n;++i)\n\t\tprintf(\"%s\\n\",s[i]+1);\n\treturn 0;\n}\n```\n",
        "postTime": 1637910048,
        "uid": 206258,
        "name": "SDNetFriend",
        "ccfLevel": 7,
        "title": "P7218 [JOISC2020] \u4f1d\u8aac\u306e\u56e3\u5b50\u8077\u4eba"
    },
    {
        "content": "# JOISC2020\n## Day4T2 \u4f20\u5947\u56e2\u5b50\u5e08\u5085\n\n\u5b89\u5229\u53ef\u89c6\u5316\u5de5\u5177 [visualizer.html](https://www.ioi-jp.org/camp/2020/2020-sp-tasks/day4/dango2-visualizer.html)\n\n\u5c06\u6240\u6709\u7684 $\\text{PWG}$ \u4e32\u4e4b\u95f4\u7684\u4e92\u65a5\u5173\u7cfb\u8fde\u8fb9\uff0c\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u4e00\u822c\u56fe\u7684\u6700\u5927\u72ec\u7acb\u96c6\u3002\n\n\u8003\u8651\u6a21\u62df\u9000\u706b\uff0c\u4e00\u4e2a\u8f83\u4f18\u7684\u8d2a\u5fc3\u7b56\u7565\u662f\u6bcf\u6b21\u968f\u673a\u4e00\u4e2a\u70b9\uff0c\u8bbe\u8fd9\u4e2a\u70b9\u52a0\u5165\u540e\u7684\u8d21\u732e\u662f $x$ \uff0c\u5982\u679c $x>0$ \u76f4\u63a5\u52a0\uff0c\u5426\u5219 $exp$ \u6982\u7387\u63a5\u53d7\u3002\n\n\u968f\u673a\u70b9\u7684\u90e8\u5206\uff0c\u968f\u673a\u4e00\u4e2a $rank$ \uff0c\u7528\u7ebf\u6bb5\u6811\u5bfb\u627e\u5bf9\u5e94\u7684\u70b9\uff0c\u7136\u540e\u76f4\u63a5\u505a\u5373\u53ef\u3002\n\n\u9700\u8981\u8c03\u6574\u5408\u9002\u7684\u53c2\u6570\uff0c\u7136\u540e\u5c31\u80fd\u7206\u8e29 **\u4f18\u79c0\u7ebf$Z$** \u4e86\u3002 \n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(Cnlogn)$ \uff0c$C$ \u662f\u9000\u706b\u6b21\u6570\u3002\n\n\u4e00\u4e9b\u7279\u6b8a\u6027\u8d28\uff1a\n\n- $\\text{data 2}$ \uff1a\u5927\u5c0f\u4e3a $25\\times 25$ \u7684\u5b50\u77e9\u9635\u76f8\u540c\uff0c\u5904\u7406\u5c0f\u77e9\u5f62\u5373\u53ef\uff1b\n\n- $\\text{data 3}$ \uff1a\u4e0d\u5b58\u5728\u659c\u5bf9\u89d2\u7684\u4e32\uff0c\u53ef\u7b80\u5316\u4e00\u5b9a\u8fd0\u7b97\u91cf\uff1b\n\n- $\\text{data 4}$ \uff1a\u51e0\u4e4e\u90fd\u662f $W$ \uff0c\u6240\u4ee5\u4e32\u5206\u5e03\u7279\u522b\u7a00\u758f\uff0c\u53ef\u5c0f\u8303\u56f4\u641c\u7d22\uff0c\u6700\u540e\u62fc\u63a5\u8d77\u6765\uff1b\n\n\u6211\u5b58\u4e86 $6$ \u4efd\u4ee3\u7801\u540c\u65f6\u8fd0\u884c\u4e86 $20+$ \u5206\u949f\u624d\u8dd1\u51fa\u4f18\u79c0\u7ebf $Z$ \u3002\u3002\u3002\n\n```cpp\n// Author: wlzhouzhuan\n#pragma GCC optimize(2)\n#pragma GCC optimize(3)\n#pragma GCC optimize(\"Ofast\")\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define pb push_back\n\nmt19937 rng(chrono::steady_clock::now().time_since_epoch().count());\nint random(int l, int r) {\n  return uniform_int_distribution<int>(l, r)(rng);\n}\n\nconst int N = 1005;\nchar s[N];\nvector<int> V[N][N], adj[4 * N * N];\nint col[N][N], ans[N][N], n, m, tot;\n\n// SegmentTree\n#define ls (u << 1)\n#define rs (u << 1 | 1)\nint sum[4 * N * N << 2];\nvoid pushup(int u) {\n  sum[u] = sum[ls] + sum[rs];\n}\nvoid build(int u, int l, int r) {\n  if (l == r) {\n    sum[u] = 1;\n    return ;\n  }\n  int mid = l + r >> 1;\n  build(ls, l, mid), build(rs, mid + 1, r);\n  pushup(u);\n}\nvoid update(int u, int l, int r, int pos, int dlt) {\n  if (l == r) {\n    sum[u] += dlt;\n    return ;\n  }\n  int mid = l + r >> 1;\n  if (pos <= mid) update(ls, l, mid, pos, dlt);\n  else update(rs, mid + 1, r, pos, dlt);\n  pushup(u);\n}\nint query(int u, int l, int r, int rnk) {\n  if (l == 1 && r == tot) assert(rnk <= r - l + 1);\n  if (l == r) {\n    assert(rnk == 1);\n    return l;\n  }\n  int mid = l + r >> 1;\n  if (sum[ls] >= rnk) return query(ls, l, mid, rnk);\n  else return query(rs, mid + 1, r, rnk - sum[ls]);\n}\n\nint dot, vis[4 * N * N];\nint ans_dot, ans_vis[4 * N * N];\n\nvoid updans() {\n  ans_dot = dot;\n  for (int i = 1; i <= tot; i++) ans_vis[i] = vis[i];\n}\nvoid SA() {\n  for (int i = 1; i <= tot; i++) vis[i] = 0;\n  double T = 1000, alpha = 0.99994;\n  build(1, 1, tot);\n  dot = 0;\n  while (T >= 1e-6) {\n    for (int times = 1; times <= 5; times++) { \n//      if (dot == tot) {\n//        puts(\"wtf\");\n//      }\n      int rnk = random(1, tot - dot);\n      assert(dot >= 0);\n//      printf(\"tot = %d, dot = %d, rnk = %d\\n\", tot, dot, rnk);\n      int u = query(1, 1, tot, rnk);\n      assert(!vis[u]);\n//      printf(\"%d\\n\", u);\n      int adds = 1;\n      for (auto v: adj[u]) if (vis[v]) {\n        adds--;\n      }\n//      printf(\"adds = %d\\n\", adds);\n      int ok = 0;\n      if (adds > 0 || exp(10.0 * adds / T) > rng() / 4294967296.0) {\n        vis[u] = 1, update(1, 1, tot, u, -1);\n        for (auto v: adj[u]) if (vis[v]) {\n          vis[v] = 0, update(1, 1, tot, v, 1);\n        }\n        dot += adds;\n        if (dot > ans_dot) updans();\n      }\n    }\n    T *= alpha;\n  }\n}\n\nint main() {\n  freopen(\"01.in\", \"r\", stdin);\n  freopen(\"01.out\", \"w\", stdout);\n  scanf(\"%d%d\", &n, &m);\n  n += 2, m += 2;\n  for (int i = 1; i <= n; i++) {\n    for (int j = 1; j <= m; j++) {\n      col[i][j] = ans[i][j] = 2;\n    }\n  }\n  for (int i = 2; i < n; i++) {\n    scanf(\"%s\", s + 2);\n    for (int j = 2; j < m; j++) {\n      if (s[j] == 'P') col[i][j] = ans[i][j] = 0;\n      if (s[j] == 'G') col[i][j] = ans[i][j] = 1;\n    }\n  }\n  for (int i = 2; i < n; i++) {\n    for (int j = 2; j < m; j++) {\n      if (col[i][j] == 2) {\n        if ((col[i - 1][j] ^ col[i + 1][j]) == 1) {\n          tot++;\n          V[i - 1][j].pb(tot);\n          V[i + 1][j].pb(tot);\n        }\n        if ((col[i][j - 1] ^ col[i][j + 1]) == 1) {\n          tot++;\n          V[i][j - 1].pb(tot);\n          V[i][j + 1].pb(tot);\n        }\n        if ((col[i - 1][j - 1] ^ col[i + 1][j + 1]) == 1) {\n          tot++;\n          V[i - 1][j - 1].pb(tot);\n          V[i + 1][j + 1].pb(tot);\n        }\n        if ((col[i - 1][j + 1] ^ col[i + 1][j - 1]) == 1) {\n          tot++;\n          V[i - 1][j + 1].pb(tot);\n          V[i + 1][j - 1].pb(tot);\n        }\n      }\n    }\n  }\n  cerr << \"tot = \" << tot << '\\n';\n  for (int i = 2; i < n; i++) {\n    for (int j = 2; j < m; j++) {\n      int sz = V[i][j].size();\n      for (int x = 0; x < sz; x++) {\n        for (int y = 0; y < x; y++) {\n          int u = V[i][j][x], v = V[i][j][y];\n          adj[u].pb(v), adj[v].pb(u);\n        }\n      }\n    }\n  }\n  SA();\n  cerr << \"ans_dot = \" << ans_dot << '\\n';\n  tot = 0;\n  for (int i = 2; i < n; i++) {\n    for (int j = 2; j < m; j++) {\n      if (col[i][j] == 2) {\n        if ((col[i - 1][j] ^ col[i + 1][j]) == 1) {\n          tot++;\n          if (ans_vis[tot]) ans[i][j] = 3;\n        }\n        if ((col[i][j - 1] ^ col[i][j + 1]) == 1) {\n          tot++;\n          if (ans_vis[tot]) ans[i][j] = 4;\n        }\n        if ((col[i - 1][j - 1] ^ col[i + 1][j + 1]) == 1) {\n          tot++;\n          if (ans_vis[tot]) ans[i][j] = 5;\n        }\n        if ((col[i - 1][j + 1] ^ col[i + 1][j - 1]) == 1) {\n          tot++;\n          if (ans_vis[tot]) ans[i][j] = 6;\n        }\n      }\n    }\n  }\n  int Points = 0;\n  for (int i = 2; i < n; i++) {\n    for (int j = 2; j < m; j++) {\n      switch (ans[i][j]) {\n        case 0: putchar('P'); break;\n        case 1: putchar('G'); break;\n        case 2: putchar('W'); break;\n        case 3: putchar('|'); Points++; break;\n        case 4: putchar('-'); Points++; break;\n        case 5: putchar('\\\\'); Points++; break;\n        case 6: putchar('/'); Points++; break;\n      }\n    }\n    putchar('\\n');\n  }\n  cerr << \"Points = \" << Points << '\\n';\n  return 0;\n}\n```",
        "postTime": 1609693063,
        "uid": 112381,
        "name": "wlzhouzhuan",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P7218 \u3010[JOISC2020] \u4f1d\u8aac\u306e\u56e3\u5b50\u8077\u4eba\u3011"
    },
    {
        "content": "\u9996\u5148\u5bf9\u6709\u516c\u5171\u70b9\u7684\u4e32\u4e32\u8fde\u8fb9\uff0c\u7136\u540e\u5c31\u662f\u6c42\u4e00\u4e2a\u5927\u4e8e\u67d0\u4e2a\u5927\u5c0f\u7684\u72ec\u7acb\u96c6\u3002\n\n\u9898\u89e3\u5168\u662f\u6a21\u62df\u9000\u706b\uff0c\u4f46\u662f\u6211\u4e0d\u4f1a\u8c03\u53c2\u3002\u6240\u4ee5\u6211\u7528\u4e86\u4e00\u79cd\u517b\u751f\u7684\u89e3\u6cd5\uff0c\u5c31\u662f\u5199\u6210 01\u7ebf\u6027\u89c4\u5212 \u7684\u5f62\u5f0f\uff0c\u7136\u540e\u76f4\u63a5\u7528\u73b0\u6210\u7684\u6c42\u89e3\u5668\uff08\u6bd4\u5982 Gurobi\uff09\u5c31\u80fd\u8fc7\u4e86\u3002\n\n\u56e0\u4e3a\u6211\u4e0d\u4f1a Gurobi \u5728 c++ \u91cc\u4f7f\u7528\u6240\u4ee5\u5199\u6210\u4e86\u4e09\u4e2a\u6587\u4ef6\uff0c\u4e00\u4e2a\u8fde\u8fb9\uff0c\u4e00\u4e2a\u6c42\u89e3\uff0c\u4e00\u4e2a\u8f93\u51fa\u65b9\u6848\uff1a\n\n```cpp\nconst int ax[3]={1,0,-1},ay[3]={0,0,0};\nconst int bx[3]={0,0,0},by[3]={1,0,-1};\nconst int cx[3]={1,0,-1},cy[3]={1,0,-1};\nconst int dx[3]={1,0,-1},dy[3]={-1,0,1};\nchar s[510][510];\narray<pair<int,int>,3>ss[510*510*4];int cnt;\n#define deal(arr,xx,yy) {\\\n\tbool flag=1;for(int i=0;i<3;i++)if(xx+(arr##x)[i]<0||yy+(arr##y)[i]<0||xx+(arr##x)[i]>=n||yy+(arr##y)[i]>=m)flag=0;\\\n\tif(flag){\\\n\t\tarray<pair<int,int>,3>tmp;\\\n\t\tfor(int i=0;i<3;i++)tmp[i]=mp(xx+(arr##x)[i],yy+(arr##y)[i]);\\\n\t\tif(s[tmp[0].fi][tmp[0].se]=='P'&&s[tmp[1].fi][tmp[1].se]=='W'&&s[tmp[2].fi][tmp[2].se]=='G')ss[++cnt]=tmp;\\\n\t\treverse(tmp.begin(),tmp.end());\\\n\t\tif(s[tmp[0].fi][tmp[0].se]=='P'&&s[tmp[1].fi][tmp[1].se]=='W'&&s[tmp[2].fi][tmp[2].se]=='G')ss[++cnt]=tmp;\\\n\t}\\\n}\nsigned main(){\n\tfreopen(\"input_06.txt\",\"r\",stdin);\n\tfreopen(\"1.txt\",\"w\",stdout);\n\tint n,m;read(n,m);\n\tfor(int i=0;i<n;i++)scanf(\"%s\",s[i]);\n\tfor(int X=0;X<n;X++)for(int Y=0;Y<m;Y++){\n\t\tdeal(a,X,Y);\n\t\tdeal(b,X,Y);\n\t\tdeal(c,X,Y);\n\t\tdeal(d,X,Y);\n\t}\n\tprintf(\"%d 46500\\n\",cnt);\n\tfor(int i=1;i<=cnt;i++){for(int j=i+1;j<=cnt;j++){\n\t\tbool flag=0;for(auto x:ss[i])for(auto y:ss[j])if(x==y)flag=1;\n\t\tif(flag)printf(\"%d %d\\n\",i,j);\n\t}if(i%1000==0)cerr<<i<<endl;}\n}\n```\n\n\n```python\nfrom gurobipy import *\nm = Model(\"mipl\")\nf = open(\"1.txt\")\ns = f.read().split('\\n')\nf.close()\nn,c = map(int, s[0].split(' '))\ns.remove(s[0])\nvar = [0]\nfor i in range(1,n+1):\n\tvar.append(m.addVar(vtype=GRB.BINARY,name=str(i)))\nfor con in s:\n\tif con!='':\n\t\ta,b = map(int, con.split(' '))\n\t\tm.addConstr(var[a] + var[b] <=1, str(a)+'_'+str(b))\nm.addConstr(sum([var[i] for i in range(1,n+1)]) >= c, \"ans\")\nm.optimize()\nf = open('1.out','w')\nfor i in range(1,n+1):\n\tf.write(str(int(var[i].x)))\nf.close()\n```\n\n```cpp\nconst int ax[3]={1,0,-1},ay[3]={0,0,0};char a='|';\nconst int bx[3]={0,0,0},by[3]={1,0,-1};char b='-';\nconst int cx[3]={1,0,-1},cy[3]={1,0,-1};char c='\\\\';\nconst int dx[3]={1,0,-1},dy[3]={-1,0,1};char d='/';\nchar s[510][510];\narray<pair<int,int>,3>ss[510*510*4];int Xx[510*510*4],Yy[510*510*4];char nm[510*510*4];int cnt;\n#define deal(arr,xx,yy) {\\\n\tbool flag=1;for(int i=0;i<3;i++)if(xx+(arr##x)[i]<0||yy+(arr##y)[i]<0||xx+(arr##x)[i]>=n||yy+(arr##y)[i]>=m)flag=0;\\\n\tif(flag){\\\n\t\tarray<pair<int,int>,3>tmp;\\\n\t\tfor(int i=0;i<3;i++)tmp[i]=mp(xx+(arr##x)[i],yy+(arr##y)[i]);\\\n\t\tif(s[tmp[0].fi][tmp[0].se]=='P'&&s[tmp[1].fi][tmp[1].se]=='W'&&s[tmp[2].fi][tmp[2].se]=='G')ss[++cnt]=tmp,Xx[cnt]=xx,Yy[cnt]=yy,nm[cnt]=arr;\\\n\t\treverse(tmp.begin(),tmp.end());\\\n\t\tif(s[tmp[0].fi][tmp[0].se]=='P'&&s[tmp[1].fi][tmp[1].se]=='W'&&s[tmp[2].fi][tmp[2].se]=='G')ss[++cnt]=tmp,Xx[cnt]=xx,Yy[cnt]=yy,nm[cnt]=arr;\\\n\t}\\\n}\nchar res[510*510*4];\nsigned main(){\n\tfreopen(\"input_06.txt\",\"r\",stdin);\n\tint n,m;read(n,m);\n\tfor(int i=0;i<n;i++)scanf(\"%s\",s[i]);\n\tfreopen(\"1.out\",\"r\",stdin);\n\tfreopen(\"output_06.txt\",\"w\",stdout);\n\tfor(int X=0;X<n;X++)for(int Y=0;Y<m;Y++){\n\t\tdeal(a,X,Y);\n\t\tdeal(b,X,Y);\n\t\tdeal(c,X,Y);\n\t\tdeal(d,X,Y);\n\t}\n\tscanf(\"%s\",res+1);\n\tfor(int i=1;i<=cnt;i++)if(res[i]-'0')s[Xx[i]][Yy[i]]=nm[i];\n\tfor(int i=0;i<n;i++)puts(s[i]);\n}\n```\n\n\u6709\u4e00\u8bf4\u4e00 Gurobi \u7684\u901f\u5ea6\u8fd8\u86ee\u5feb\u7684\u6bcf\u4e2a\u90fd\u53ef\u4ee5\u5728 10s \u5de6\u53f3\u8dd1\u51fa\u89e3\uff0c\u6240\u4ee5\u6700\u6162\u7684\u53cd\u800c\u662f\u6211\u7684\u66b4\u529b\u5efa\u56fe \uff0c\u4e0d\u8981\u7528\u66b4\u529b\u5e94\u8be5\u5c31\u80fd\u5728 15s \u5185\u7b97\u51fa\u6bcf\u4e2a\u7b54\u6848\u3002",
        "postTime": 1652338208,
        "uid": 174304,
        "name": "jun\u5934\u5409\u5409",
        "ccfLevel": 10,
        "title": "P7218 \u3010[JOISC2020] \u4f1d\u8aac\u306e\u56e3\u5b50\u8077\u4eba\u3011"
    },
    {
        "content": "\u63d0\u4ea4\u7b54\u6848\u9898\uff0c\u7ed9\u5b9a\u4e00\u4e2a\u7f51\u683c\uff0c\u9700\u8981\u627e\u5230\u5c3d\u91cf\u591a\u7684\u4e0d\u76f8\u4ea4\u7684 ``PWG`` \u4e32\u3002\n\n\u9996\u5148\u539f\u56fe\u4e2d\u51fa\u73b0\u7684 ``PWG`` \u4e32\u662f $\\mathcal{O}(RC)$ \u7ea7\u522b\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u627e\u51fa\u6765\u3002\n\n\u7136\u540e\u5bf9\u4e8e\u4e24\u4e2a\u76f8\u4ea4\u7684 ``PWG`` \u4e32\u8fde\u8fb9\uff0c\u8fb9\u6570\u4e5f\u662f $\\mathcal{O}(RC)$ \u7ea7\u522b\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u5c06\u56fe\u5efa\u51fa\u6765\u3002\n\n\u90a3\u4e48\u539f\u56fe\u7684\u6700\u5927\u72ec\u7acb\u96c6\u5c31\u662f\u6700\u4f18\u89e3\uff0c\u4f46\u662f\u6211\u4eec\u77e5\u9053\u8fd9\u662f NP-Hard \u95ee\u9898\u3002\n\n\u8003\u8651\u76f4\u63a5\u6a21\u62df\u9000\u706b\uff0c\u6bcf\u6b21\u968f\u673a\u9009\u62e9\u4e00\u4e2a\u6ca1\u6709\u9009\u62e9\u7684\u70b9\uff0c\u5f3a\u884c\u9009\u62e9\u8fd9\u4e2a\u70b9\uff0c\u5e76\u5c06\u4e0e\u4ed6\u76f8\u90bb\u7684\u70b9\u53d6\u6d88\u9009\u62e9\u3002\n\n\u5269\u4e0b\u7684\u5c31\u662f\u8c03\u53c2\u3002\n\n```cpp\n#include<cstdio>\n#include<cmath>\n#define rep(i,a,b) for(int i=a;i<=b;i++)\n#define pre(i,a,b) for(int i=a;i>=b;i--)\n#define N 505\n#define M 130020\nusing namespace std;\nint n,m,u[N][N][4],idx,ans=0;char s[N][N];\nint h[M],tot,v[M],w[M];\nstruct edge{int to,nxt;}e[M*5];\nvoid add(int x,int y){e[++tot].nxt=h[x];h[x]=tot;e[tot].to=y;e[++tot].nxt=h[y];h[y]=tot;e[tot].to=x;}\nnamespace RAND{\n\tbool isInit;\n\tint index;\n\tint MT[624];  //624 * 32 - 31 = 19937\n\tvoid srand(int seed)\n\t{\n\t   \tindex = 0;\n\t    isInit = 1;\n\t    MT[0] = seed;\n\t    for(int i=1; i<624; i++)\n\t    {\n\t        int t = 1812433253 * (MT[i-1] ^ (MT[i-1] >> 30)) + i;\n\t        MT[i] = t & 0xffffffff;\n\t    }\n\t}\n\tvoid generate(){\n\t    for(int i=0; i<624; i++)\n\t    {\n\t        int y = (MT[i] & 0x80000000) + (MT[(i+1) % 624] & 0x7fffffff);\n\t        MT[i] = MT[(i + 397) % 624] ^ (y >> 1);\n\t        if (y & 1)\n\t            MT[i] ^= 2567483615;\n\t    }\n\t}\n\tint rand(){\n\t    if(!isInit)\n\t        srand(19260817);\n\t    if(index == 0)\n\t        generate();\n\t    int y = MT[index];\n\t    y = y ^ (y >> 11);\n\t    y = y ^ ((y << 7) & 2636928640);\n\t    y = y ^ ((y << 15) & 4022730752);\n\t    y = y ^ (y >> 18);\n\t    index = (index + 1) % 624;\n\t    return y;\n\t}\n}\nint c[M];\ninline void ins(int x,int val){for(;x<=idx;x+=x&-x)c[x]+=val;}\ninline int ask(int k){\n\tint cur=0;\n\tpre(i,17,0)if(cur+(1<<i)<=idx&&c[cur+(1<<i)]<k)cur+=1<<i,k-=c[cur];\n\treturn cur+1;\n}\nusing namespace RAND;\nint main(){\n\tfreopen(\"01.in\",\"r\",stdin);\n\t//freopen(\"01.out\",\"w\",stdout);\n\tscanf(\"%d%d\",&n,&m);\n\trep(i,1,n)scanf(\"%s\",s[i]+1);\n\trep(i,1,n)rep(j,1,m-2)\n\t\tif(s[i][j]!=s[i][j+1]&&s[i][j]!=s[i][j+2]&&s[i][j+1]!=s[i][j+2]&&s[i][j+1]=='W')u[i][j][0]=++idx;//,cout<<\"ss \"<<i<<\" \"<<j<<\" 0\"<<endl;\n\trep(i,1,n-2)rep(j,1,m)\n\t\tif(s[i][j]!=s[i+1][j]&&s[i][j]!=s[i+2][j]&&s[i+1][j]!=s[i+2][j]&&s[i+1][j]=='W')u[i][j][1]=++idx;//,cout<<\"ss \"<<i<<\" \"<<j<<\" 1\"<<endl;\n\trep(i,1,n-2)rep(j,1,m-2)\n\t\tif(s[i][j]!=s[i+1][j+1]&&s[i][j]!=s[i+2][j+2]&&s[i+1][j+1]!=s[i+2][j+2]&&s[i+1][j+1]=='W')u[i][j][2]=++idx;//,cout<<\"ss \"<<i<<\" \"<<j<<\" 2\"<<endl;\n\trep(i,3,n)rep(j,1,m-2)\n\t\tif(s[i][j]!=s[i-1][j+1]&&s[i][j]!=s[i-2][j+2]&&s[i-1][j+1]!=s[i-2][j+2]&&s[i-1][j+1]=='W')u[i][j][3]=++idx;//,cout<<\"ss \"<<i<<\" \"<<j<<\" 3\"<<endl;\n\trep(i,1,n)rep(j,1,m-2)if(u[i][j][0]){\n\t\trep(k,0,2)rep(p,0,2)if(i>k&&j>k-p&&u[i-k][j-k+p][2])add(u[i][j][0],u[i-k][j-k+p][2]);\n\t\trep(k,1,2)if(j>k&&u[i][j-k][0])add(u[i][j-k][0],u[i][j][0]);\n\t\trep(k,0,2)rep(p,0,2)if(i+k<=n&&j>k-p&&u[i+k][j-k+p][3])add(u[i][j][0],u[i+k][j-k+p][3]);\n\t\trep(k,0,2)rep(p,0,2)if(i>k&&u[i-k][j+p][1])add(u[i-k][j+p][1],u[i][j][0]);\n\t}\n\trep(i,1,n-2)rep(j,1,m)if(u[i][j][1]){\n\t\trep(k,1,2)if(i>k&&u[i-k][j][1])add(u[i-k][j][1],u[i][j][1]);\n\t\trep(k,0,2)rep(p,0,2)if(j>k&&i>k-p&&u[i-k+p][j-k][2])add(u[i][j][1],u[i-k+p][j-k][2]);\n\t\trep(k,0,2)rep(p,0,2)if(i+k+p<=n&&j>k&&u[i+k+p][j-k][3])add(u[i][j][1],u[i+k+p][j-k][3]);\n\t}\n\trep(i,1,n-2)rep(j,1,m-2)if(u[i][j][2]){\n\t\trep(k,1,2)if(i>k&&j>k&&u[i-k][j-k][2])add(u[i][j][2],u[i-k][j-k][2]);\n\t\trep(k,0,2)rep(p,0,2)if(i+k+p<=n&&j+k>p&&u[i+k+p][j+k-p][3])add(u[i][j][2],u[i+k+p][j+k-p][3]);\n\t}\n\trep(i,3,n)rep(j,1,m-2)if(u[i][j][3]){\n\t\trep(k,1,2)if(u[i-k][j+k][3])add(u[i][j][3],u[i-k][j+k][3]);\n\t}\n\trep(x,1,idx){\n\t\t//printf(\"ss %d\\n\",x);\n\t\tbool flag=true;\n\t\tfor(int i=h[x];i;i=e[i].nxt)flag&=!w[e[i].to];\n\t\tif(flag)ans++,w[x]=1;\n\t\telse ins(x,1);\n\t}\n\tprintf(\"%d\\n\",ans);\n\tint sum = ans ;rep(i,1,idx)v[i]=w[i];\n\twhile(ans < 47220){\n\t\t//,printf(\"%d \",v[i]);putchar('\\n');\n\t\tdouble T = 10 ;const double dta = 0.9999999 , eps = 1e-2 ;const double k = 16.0;\n\t\twhile(T > eps){\n\t\t\tT*=dta;\n\t\t\tint rk = (rand() % (idx-sum) ) + 1;\n\t\t\tint x =ask(rk);\n\t\t\t//printf(\"%.10lf %d %d %d %d\\n\",T,x,sum,rand(),rk);\n\t\t\t//rep(i,1,idx)printf(\"%d \",v[i]);putchar('\\n');\n\t\t\t//if(v[x])puts(\"Error\");\n\t\t\tint now = 1;\n\t\t\tfor(int i=h[x];i;i=e[i].nxt)\n\t\t\t\tif(v[e[i].to])now--;\n\t\t\tif(now==1|| exp(k*now/T) > rand()/2147483647.00){\n\t\t\t\tfor(int i=h[x];i;i=e[i].nxt)if(v[e[i].to])\n\t\t\t\t\tv[e[i].to]=0,ins(e[i].to,1);\n\t\t\t\tins(x,-1);v[x]=1;sum+=now;\n\t\t\t\tif(sum>ans){\n\t\t\t\t\tans=sum;\n\t\t\t\t\trep(i,1,idx)w[i]=v[i];\n\t\t\t\t\tprintf(\"%d\\n\",ans);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\trep(i,1,n)rep(j,1,m){\n\t\tif(w[u[i][j][0]]){\n\t\t\ts[i][j+1]='-';\n\t\t}\n\t\telse if(w[u[i][j][1]]){\n\t\t\ts[i+1][j]='|';\n\t\t}\n\t\telse if(w[u[i][j][2]]){\n\t\t\ts[i+1][j+1]='\\\\';\n\t\t}\n\t\telse if(w[u[i][j][3]]){\n\t\t\ts[i-1][j+1]='/';\n\t\t}\n\t}\n\tfreopen(\"01.out\",\"w\",stdout);\n\trep(i,1,n)puts(s[i]+1);\n\treturn 0;\n} \n```\n\n\u6548\u7387\u8fd8\u662f\u6bd4\u8f83\u9ad8\u7684\uff0c\u9664\u4e86\u7b2c $5$ \u4e2a\u6d4b\u8bd5\u70b9\uff0c\u5176\u4ed6\u70b9\u90fd\u80fd\u5728 $120$ \u79d2\u4e4b\u5185\u51fa\u89e3\u3002\n\n\u5bf9\u4e8e\u7b2c $5$ \u7ec4\u6570\u636e\uff0c\u6ca1\u627e\u5230\u4ec0\u4e48\u597d\u65b9\u6cd5\uff0c\u4e8c\u5206\u8c03\u53c2\uff0c\u6700\u540e\u80fd\u5728 $1200$ \u79d2\u5185\u51fa\u89e3\u3002\n\n\u4e0b\u9762\u662f\u5404\u7ec4\u6570\u636e\u5bf9\u5e94\u7684\u53c2\u6570\u3002\n\n```cpp\nTestdata1 :\ndouble T = 10 ;const double dta = 0.9999999 , eps = 1e-2 ;const double k = 16.0;\n\nTestdata2 :\ndouble T = 10 ;const double dta = 0.9999999 , eps = 1e-2 ;const double k = 16.0;\n\nTestdata3 :\ndouble T = 8 ;const double dta = 0.99999999 , eps = 1;const double k = 16.0;\n\nTestdata4 :\ndouble T = 3 ;const double dta = 0.99999999 , eps = 1e-3 ;const double k = 16.0;\n\nTestdata5 :\ndouble T = 8 ;const double dta = 0.9999999 , eps = 1e-7 ;const double k = 16.0;\n\nTestdata6 :\ndouble T = 4 ;const double dta = 0.99999999 , eps = 1e-2 ;const double k = 16.0;\n\n```",
        "postTime": 1623910423,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011[JOISC2020] \u4f1d\u8aac\u306e\u56e3\u5b50\u8077\u4eba"
    }
]