[
    {
        "content": "\u95ee\u9898\u76f8\u5f53\u4e8e\u6c42\u4e24\u4e2a\u8ddd\u79bb\u4e0d\u5927\u4e8e $K$ \u7684\u6570\u5bf9\u7684\u548c\u7684\u6700\u5927\u503c\u3002\n\n\u5c06\u5e8f\u5217 $K$ \u4e2a\u5206\u4e00\u5757\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5757\u5185\u7684\u6700\u5927\u503c\uff0c\u94a6\u5b9a\u4ed6\u4eec\u662f\u6700\u5927\u503c\u6216\u6b21\u5927\u503c\u4e4b\u4e00\uff0c\u7136\u540e\u6c42\u51fa\u4ed6\u4eec\u5468\u56f4 $K-1$ \u4e2a\u6570\u7684\u6700\u5927\u503c\uff0c\u7528\u4ed6\u4eec\u7684\u548c\u66f4\u65b0\u7b54\u6848\u3002\n\n\u4e00\u5f00\u59cb\u7684\u6700\u5927\u503c\u4f7f\u7528\u5355\u8c03\u961f\u5217\u6c42\u51fa\u3002\u6bcf\u6b21\u4fee\u6539\uff0c\u53ea\u9700\u8981\u91cd\u65b0\u6c42\u51fa\u5757\u5185\u6700\u5927\u503c\uff0c\u7136\u540e\u91cd\u65b0\u8ba1\u7b97\u5468\u56f4 $O(1)$ \u5757\u7684\u4fe1\u606f\u3002\u4f7f\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u6700\u5927\u503c\u5373\u53ef\u3002\n\n\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n+q\\log n )$\u3002 \n\n---\n\n\n\u8bc1\u660e\uff0c\u6211\u4eec\u6700\u62c5\u5fc3\u51fa\u73b0\u8fd9\u6837\u7684\u60c5\u51b5\uff1a\u7b54\u6848\u662f\u76f8\u90bb\u4e24\u4e2a\u5757\u7684\u4e24\u4e2a\u975e\u6700\u5927\u503c\u7684\u6570\u5339\u914d\u3002\u8bbe\u4ed6\u4eec\u4e3a $a,b$\uff0c\u6240\u5728\u5757\u7684\u5206\u522b\u7684\u6700\u5927\u503c\u4e3a $c,d$\uff0c\u6709 $c>a,d>b$\u3002\u8003\u8651 $a$ \u548c $c$ \u800c\u4e0d\u662f $b$ \u5339\u914d\uff0c\u6240\u4ee5 $b>c$\uff1b$b$ \u4e0e $a$ \u800c\u4e0d\u662f $d$ \u5339\u914d\uff0c\u6240\u4ee5 $a>d$\u3002\u77db\u76fe\u3002",
        "postTime": 1659001391,
        "uid": 79067,
        "name": "dottle",
        "ccfLevel": 10,
        "title": "6717-\u725b\u903c\u505a\u6cd5"
    },
    {
        "content": "## \u63d0\u8981\n\n\u770b\u522b\u4eba\u505a\u7684\u9898\u627e\u5230\u7684\uff0c\u8054\u7cfb\u4e00\u4e0b\u6700\u8fd1\u505a\u7684\u4e24\u9053CF\u548c\u6a21\u62df\u8d5b\u9898\u5f88\u81ea\u7136\u5730\u5c31\u4f1a\u4e86\u3002\n\n\u4e00\u79cd\u4e0d\u9700\u8981\u7ebf\u6bb5\u6811\u5206\u6cbb\u7684\u5728\u7ebf\u505a\u6cd5\uff0c\u4f46\u65f6\u7a7a\u590d\u6742\u5ea6\u76f8\u5bf9\u7565\u9ad8\u3002\n\n## \u63d0\u793a\n\n* \u4e00\u4e2a\u663e\u7136\u7684\u60f3\u6cd5\u662f\u8003\u8651\u628a\u201c\u67e5\u8be2\u957f\u5ea6\u4e3a $K$ \u7684\u533a\u95f4\u7684\u6700\u5927\u503c+\u6b21\u5927\u503c\u201d\u53d8\u6210\u201c\u4fee\u6539\u957f\u5ea6\u4e3a $K$ \u7684\u533a\u95f4\u201d\u3002\n\n* \u5982\u679c\u6240\u6709\u63d2\u5165\u64cd\u4f5c\u548c\u6240\u6709\u5220\u9664\u64cd\u4f5c\u4fee\u6539\u7684\u533a\u95f4\u76f8\u540c\uff0c\u4e5f\u5c31\u662f\u53ea\u5b58\u5728\u201c\u64cd\u4f5cA\u201d\u548c\u201c\u5220\u9664\u64cd\u4f5cA\u201d\u7684\u8bdd\uff0c\u5982\u679c\u6b64\u65f6\u7ebf\u6bb5\u6811\u4e0b\u4f20\u6807\u8bb0\u4e0d\u597d\u7ef4\u62a4\uff0c\u53ef\u4ee5\u8003\u8651\u6807\u8bb0\u6c38\u4e45\u5316\u3002\n\n* \u5bf9\u9876\u5806\u662f\u4e00\u79cd\u652f\u6301\u63d2\u5165/\u5220\u9664\u67d0\u4e2a\u503c\uff0c\u67e5\u8be2\u6700\u503c\u7684 $\\log $ \u6570\u636e\u7ed3\u6784\uff0c\u901a\u8fc7\u4f7f\u7528\u4e00\u822c\u7684\u5806\u6765\u5b9e\u73b0\u3002\n\n## \u9898\u89e3\n\n\u7ef4\u62a4\u8fd9\u6837\u4e00\u4e2a\u7ebf\u6bb5\u6811\uff0c\u7ef4\u62a4\u7684\u5355\u70b9\u4fe1\u606f\u662f\uff1a\u4f4d\u7f6e $i$ \u8868\u793a $[i,i+K)$ \u533a\u95f4\u7684\u6700\u5927\u503c\u548c\u6700\u5927\u503c+\u6b21\u5927\u503c\u7684\u76f8\u5173\u4fe1\u606f\u3002\n\n\u90a3\u4e48\u7ef4\u62a4\u7684\u533a\u95f4\u4fe1\u606f\u662f\u5f53\u524d\u533a\u95f4\u7684 \u6700\u5927\u503c \u548c \u6700\u5927\u7684\uff08\u6700\u5927\u503c+\u6b21\u5927\u503c\uff09 \u503c\u3002\n\n\u63a5\u4e0b\u6765\u628a\u66ff\u6362\u770b\u6210 \u533a\u95f4\u5220\u9664/\u52a0\u5165 \u64cd\u4f5c\uff0c\u6700\u521d\u5efa\u6811\u770b\u6210\u63d2\u5165\u64cd\u4f5c\u3002\n\n\u8003\u8651\u533a\u95f4\u4fee\u6539\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u533a\u95f4\u63d2\u5165\u6807\u8bb0\uff0c\u4f7f\u7528\u6807\u8bb0\u6c38\u4e45\u5316\u7684\u6280\u672f\u505a\uff0c\u8fd9\u91cc\u6807\u8bb0\u53ef\u4ee5\u91c7\u7528\u4f18\u5148\u961f\u5217\u7684\u65b9\u5f0f\u5b58\u50a8\uff0c\u4e5f\u5c31\u662f\u8282\u70b9\u7ef4\u62a4\u4e86\u5f53\u524d\u4e00\u6574\u4e2a\u533a\u95f4\u90fd\u4f1a\u88ab\u63d2\u5165\u7684\u4e00\u4e9b\u6570\u7684\u96c6\u5408\uff0c\u6211\u4eec\u5728\u6bcf\u4e2a\u8282\u70b9\u7528\u4e00\u4e2a\u5806\u628a\u8fd9\u4e9b\u503c\u5b58\u8d77\u6765\u3002\n\n\u8fd9\u6837\u5bf9\u4e8e\u5220\u9664\u64cd\u4f5c\u4e5f\u662f\u5bb9\u6613\u7684\uff0c\u56e0\u4e3a\u63d2\u5165\u65f6\u9012\u5f52\u5230\u7684\u533a\u95f4\u548c\u5220\u9664\u65f6\u4e00\u6a21\u4e00\u6837\uff0c\u6240\u4ee5\u628a\u7ef4\u62a4\u7684\u5806\u6362\u6210\u652f\u6301\u5220\u9664\u7684\u5bf9\u9876\u5806\u5373\u53ef\u3002\n\n\u7ebf\u6bb5\u6811\u7684\u4fe1\u606f\u4e0a\u4f20\u662f\u7ec6\u8282\u95ee\u9898\uff0c\u4e0d\u518d\u8d58\u8ff0\uff0c\u4e0d\u7406\u89e3\u53ef\u4ee5\u89c1\u4ee3\u7801\u3002\n\n\u67e5\u8be2\u7b54\u6848\u5373\u76f4\u63a5\u8c03\u7528\u6839\u8282\u70b9\u4fe1\u606f\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log^2 n+q\\log^2 n)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log n)$\u3002\n\n## \u4f18\u5316\n\n\u53ef\u4ee5\u628a\u7528\u4e8e\u7ef4\u62a4\u6807\u8bb0\u7684\u4f18\u5148\u961f\u5217\u6362\u6210\u914d\u5bf9\u5806\u7b49\u53ef\u4ee5 $\\mathcal O(1)$ \u63d2\u5165\uff0c$\\mathcal O(\\log n)$ \u67e5\u8be2\u7684\u5806\uff0c\u518d\u7a0d\u5fae\u4fee\u6539\u4e00\u4e0b\u5efa\u6811\u7684\u8fc7\u7a0b\u5c31\u80fd\u505a\u5230 $\\mathcal O(n\\log n+q\\log ^2 n )$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e0d\u53d8\u3002\n\n\u8fd9\u6837\u505a\u6210\u529f\u4f18\u5316\u65f6\u95f4\u7684\u672c\u8d28\u662f\uff1a\u53ea\u6709\u5220\u9664\u624d\u4f1a\u5bfc\u81f4\u7528\u5230\u5806\u7684\u67e5\u8be2\uff0c\u800c\u5982\u679c\u662f\u53ea\u6709\u63d2\u5165\u53ef\u4ee5\u76f4\u63a5\u51ed\u501f\u7ef4\u62a4\u6700\u5927\u503c\u5c31\u7ef4\u62a4\u51fa\u7b54\u6848\uff08\u8fd9\u90e8\u5206\u5c31\u662f\u201c\u7a0d\u5fae\u4fee\u6539\u5efa\u6811\u8fc7\u7a0b\u201d\u7684\u4f18\u5316\uff09\u3002\n\n\u4e8e\u662f\u8fdb\u4e00\u6b65\u5730\u53ef\u4ee5\u77e5\u9053\uff0c\u5982\u679c\u6240\u6709\u4fee\u6539\u5355\u8c03\u9012\u589e\uff0c\u90a3\u4e48\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O(n\\log n+q\\log n)$ \u3002\n\n## \u4ee3\u7801\n\n\u672a\u8fdb\u884c\u4f18\u5316\u7684\u7248\u672c\uff0c\u5728\u6d1b\u8c37\u4e0a\u5f00 O2 \u53ef\u8fc7\uff0c\u5b9e\u9645\u7801\u91cf\u5f88\u5c0f\uff0c1.16kb\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntemplate<typename T>\ninline void read(T &x){\n\tx=0;bool f=false;char ch=getchar();\n\twhile(!isdigit(ch)){f|=ch=='-';ch=getchar();}\n\twhile(isdigit(ch)){x=x*10+(ch^48);ch=getchar();}\n\tx=f?-x:x;\n\treturn ;\n}\ntemplate<typename T, typename ...Args>\ninline void read(T &x, Args &...args){read(x),read(args...);}\ntemplate<typename T>\ninline void write(T x){\n\tif(x<0) x=-x,putchar('-');\n\tif(x>9) write(x/10);\n\tputchar(x%10^48);\n\treturn ;\n}\n#define ll long long\n#define pc putchar\nconst int N=2e6+5,M=1e6+5,INF=1e9+7;\nint n,m,K,q,a[N];\nstruct SGT{\n\tpriority_queue<int>ins,del;\n\tint Maxs,Max;\n\tint Gettop(){while(!ins.empty()&&!del.empty()&&ins.top()==del.top()) ins.pop(),del.pop();return ins.empty()?0:ins.top();}\n}t[N<<2];\nvoid Pushup(int x){\n\tint tmp=t[x].Gettop();\n\tt[x].del.push(tmp);\n\tint tmp1=t[x].Gettop();\n\tt[x].ins.push(tmp);\n\t\n\tt[x].Maxs=max(t[x<<1].Maxs,t[x<<1|1].Maxs);\n\tt[x].Maxs=max(t[x].Maxs,max({t[x<<1].Max,t[x<<1|1].Max,tmp1})+tmp);\n\t\n\tt[x].Max=max({t[x<<1].Max,t[x<<1|1].Max,tmp});\n\treturn ;\n}\nvoid Modify(int x,int l,int r,int ql,int qr,int v,int tp){\n\tif(ql<=l&&r<=qr){\n\t\tif(tp) t[x].ins.push(v);\n\t\telse t[x].del.push(v);\n\t\tPushup(x);\n\t\treturn ;\n\t}\n\tint mid=l+r>>1;\n\tif(ql<=mid) Modify(x<<1,l,mid,ql,qr,v,tp);\n\tif(qr>mid) Modify(x<<1|1,mid+1,r,ql,qr,v,tp);\n\tPushup(x);\n\treturn ;\n}\ninline void _Solve(){\n\tread(n,K,q);\n\tfor(int i=1;i<=n;i++) read(a[i]);\n\tm=n-K+1;\n\tfor(int i=1;i<=n;i++) Modify(1,1,m,max(i-K+1,1),min(i,m),a[i],1);\n\twrite(t[1].Maxs),pc('\\n');\n\twhile(q--){\n\t\tint pos,v;\n\t\tread(pos,v);\n\t\tModify(1,1,m,max(pos-K+1,1),min(pos,m),a[pos],0);\n\t\ta[pos]=v;\n\t\tModify(1,1,m,max(pos-K+1,1),min(pos,m),a[pos],1);\n\t\twrite(t[1].Maxs),pc('\\n');\n\t}\n\treturn ;\n}\nsigned main(){\n\tint _T=1;while(_T--) _Solve();\n\treturn 0;\n}\n/*\n\n*/\n```",
        "postTime": 1658903858,
        "uid": 130387,
        "name": "_Anchor",
        "ccfLevel": 0,
        "title": "P6717 [CCO2018] Boring Lectures\u9898\u89e3"
    },
    {
        "content": "\u53d1\u73b0\u6ca1\u6709\u9898\u89e3\uff0c\u6240\u4ee5\u6765\u6c34\u4e00\u53d1qwq\n\n\u9898\u76ee\u8981\u6c42\u521d\u59cb\u4e0e\u6bcf\u6b21\u64cd\u4f5c\u4e4b\u540e\u7684\u7b54\u6848\uff0c\u5bf9\u4e8e\u8fd9\u79cd\u6c42\u6bcf\u4e2a\u65f6\u523b\u7b54\u6848\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u5206\u6cbb\u6765\u89e3\u51b3\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u6570\uff0c\u5c06\u521d\u503c\u4e5f\u89c6\u4e3a\u4fee\u6539\uff0c\u5219\u4ed6\u7684\u53d6\u503c\u88ab\u5404\u4e2a\u4fee\u6539\u6309\u65f6\u95f4\u5206\u6210\u4e86\u5f88\u591a\u90e8\u5206\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a\u6570\uff0c\u5c06\u6bcf\u4e2a\u4e0d\u540c\u7684\u53d6\u503c\u533a\u95f4\u653e\u5230\u7ebf\u6bb5\u6811\u4e0a\uff0c\u90a3\u4e48\u73b0\u5728\u4ece\u7ebf\u6bb5\u6811\u7684\u6839\u8282\u70b9\u5411\u4e0b\u8d70\uff0c\u6bcf\u8d70\u5230\u4e00\u4e2a\u53f6\u5b50\uff0c\u5c31\u80fd\u5f97\u5230\u6b64\u4e0b\u6807\u5bf9\u5e94\u7684\u7b54\u6848\n\n\u90a3\u4e48\u73b0\u5728\u7684\u95ee\u9898\u662f\u627e\u51fa\u4e00\u79cd\u5728\u7ebf\u6bb5\u6811\u4e0a\u8d70\u65f6\u52a0\u5165/\u5220\u9664\u4e00\u4e2a\u6570\u8d21\u732e\u7684\u65b9\u6cd5\n\n\u9996\u5148\uff0c\u7531\u7ebf\u6bb5\u6811\u5206\u6cbb\u7684\u6027\u8d28\u53ef\u5f97\u52a0\u5165\u53ea\u6709 $0\\rightarrow x$ \u8fd9\u6837\u7684\u60c5\u51b5\uff0c\u6b64\u65f6\u53ea\u9700\u8ba1\u7b97\u8303\u56f4\u5185\u6700\u5927\u503c\uff0c\u5e76\u7528\u5176\u4e0e $x$ \u5c1d\u8bd5\u66f4\u65b0\u7b54\u6848\n\n\u800c\u5bf9\u4e8e\u5220\u9664\u8d21\u732e\uff0c\u53d1\u73b0\u6bcf\u4e2a\u7ed3\u70b9\u7684\u4fe1\u606f\u521d\u59cb\u7531\u4ed6\u7684\u7236\u4eb2\u7ee7\u627f\uff0c\u56e0\u6b64\u53ef\u4ee5\u7528\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u5c31\u4e0d\u9700\u8981\u8003\u8651\u5220\u9664\u4e86\n\n\u4e00\u5171 $(n+q)\\log q$ \u4e2a\u6570\u9700\u8981\u52a0\n\n\u6bcf\u6b21\u7528\u7ebf\u6bb5\u6811\u67e5\u8be2\u66f4\u65b0\u7b54\u6848 $\\log n$\n\n\u56e0\u6b64\u8fd9\u4e2a\u7b97\u6cd5\u7684\u590d\u6742\u5ea6\u662f $O(n+q)\\log q\\log n$\n\n\u7136\u800c\uff0c\u56e0\u4e3a\u7a7a\u95f4\u592a\u5927\uff0c\u8fd9\u4e2a\u7b97\u6cd5\u5e76\u4e0d\u80fd\u901a\u8fc7\u672c\u9898~~\u81f3\u5c11\u6211\u6ca1\u8fc7~~\n\n\u53d1\u73b0 $n$ \u548c $q$ \u8303\u56f4\u76f8\u5dee\u60ac\u6b8a\uff0c\u5176\u5b9e\u53ea\u6709\u4e00\u90e8\u5206\u6570\u88ab\u6539\u8fc7\n\n\u5bf9\u4e8e\u6ca1\u6709\u88ab\u6539\u8fc7\u7684\u6570\uff0c\u5728\u5168\u5c40\u9020\u6210\u7684\u8d21\u732e\u4e00\u76f4\u4e0d\u53d8\uff0c\u800c\u5728\u4e4b\u524d\u7684\u7b97\u6cd5\u4e2d\u5374\u5927\u5e45\u6269\u5927\u4e86\u4e3b\u5e2d\u6811\u6240\u9700\u7a7a\u95f4\n\n\u56e0\u6b64\u53ef\u4ee5\u5c06\u4e0d\u9700\u4fee\u6539\u7684\u90e8\u5206\u7528\u666e\u901a\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u7701\u4e0b\u8fd9\u90e8\u5206\u5927\u91cf\u63d2\u5165\u5bfc\u81f4\u7684\u7a7a\u95f4\u6d6a\u8d39\n\n\u5177\u4f53\u7684\u5b9e\u73b0\u4e2d\uff0c\u6211\u5f00\u4e24\u4e2a\u6570\u7ec4\u8bb0\u5f55\u662f/\u5426\u4fee\u6539\u8fc7\u7684\u6570\u7684\u7f16\u53f7\uff0c\u7136\u540e $O(n)$ \u9884\u5904\u7406 $1-n$ \u5728\u4e24\u6570\u7ec4\u4e2d\u7684\u524d\u9a71/\u540e\u7ee7\uff0c\u4fbf\u4e8e\u7ebf\u6bb5\u6811\u7ef4\u62a4\n\n\u53e6\u5916\u518d\u52a0\u4e0a\u5206\u6cbb\u56de\u6eaf\u65f6\u628a\u8fd9\u90e8\u5206\u4e3b\u5e2d\u6811\u6e05\u7a7a\u7684\u4f18\u5316\uff0c\u8fd9\u6837\u7a7a\u95f4\u5c31\u6ca1\u6709\u95ee\u9898\u4e86\uff0c\u800c\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u53d8\u6210\u4e86 $O(q\\log^2 q)$\uff08\u7c7b\u4f3c\u4e4b\u524d\u7684\u8ba1\u7b97\u65b9\u6cd5\uff09\uff0c8s \u65f6\u9650\u5df2\u7ecf\u5f88\u7a33\u4e86\n\n$Code:$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n\nconst int N=1000005;\nint n,k,q;\nint lst[N],lv[N],ori[N];\nconst int Q=100005;\nint t1,t2;\n\nint v[Q*17];\nint sl[Q*17],sr[Q*17];\n#define ls sl[x]\n#define rs sr[x]\n#define mi ((l+r)>>1)\n#define lson ls,l,mi\n#define rson rs,mi+1,r\nint cnt=0;\ninline void clone(int &x){\n\tv[++cnt]=v[x];\n\tsl[cnt]=sl[x]; sr[cnt]=sr[x];\n\tx=cnt;\n}\ninline void up(int x){\n\tv[x]=max(v[ls],v[rs]);\n}\ninline void ins(int &x,int l,int r,int p,int k){\n\tclone(x);\n\tif(l==r){ v[x]=k; return; }\n\tif(mi>=p)ins(lson,p,k);\n\telse ins(rson,p,k);\n\tup(x);\n}\ninline int qry(int x,int l,int r,int nl,int nr){\n\tif(nl>nr)return 0;\n\tif(nl<=l&&r<=nr)return v[x];\n\tint res=0;\n\tif(mi>=nl)res=max(res,qry(lson,nl,nr));\n\tif(mi<nr)res=max(res,qry(rson,nl,nr));\n\treturn res;\n}\n#undef ls\n#undef rs\n#undef mi\n#undef lson\n#undef rson\n\nint ch[Q],re[N];\nint cc=0,rc=0;\nint u1[N],d1[N];\nint u2[N],d2[N];\n\n#define ls x<<1\n#define rs x<<1|1\n#define lson ls,l,mi\n#define rson rs,mi+1,r\n#define mi ((l+r)>>1)\nint rv[N<<2];\ninline void rup(int x){\n\trv[x]=max(rv[ls],rv[rs]);\n}\ninline void rbuild(int x,int l,int r){\n\tif(l>r)return;\n\tif(l==r){ rv[x]=lv[re[l]]; return; }\n\trbuild(lson); rbuild(rson);\n\trup(x);\n}\ninline int rqry(int x,int l,int r,int nl,int nr){\n\tif(l>r)return 0;\n\tif(nl>nr)return 0;\n\tif(nl<=l&&r<=nr)return rv[x];\n\tint res=0;\n\tif(mi>=nl)res=max(res,rqry(lson,nl,nr));\n\tif(mi<nr)res=max(res,rqry(rson,nl,nr));\n\treturn res;\n}\n\n#define pb push_back\n#define pii pair<int,int>\n#define mp make_pair\n#define fi first\n#define se second\nint sv[Q<<2];\nvector<pii > ss[Q<<2];\ninline void sbuild(int x,int l,int r){ \n\tss[x].clear(); sv[x]=0;\n\tif(l==r)return;\n\tsbuild(lson); sbuild(rson);\n}\ninline void sins(int x,int l,int r,int nl,int nr,int k1,int k2){\n\tif(nl<=l&&r<=nr){ ss[x].pb(mp(k1,k2)); return; }\n\tif(mi>=nl)sins(lson,nl,nr,k1,k2);\n\tif(mi<nr)sins(rson,nl,nr,k1,k2);\n}\nint mx=0;\nint tmm=0;\ninline void sqry(int x,int l,int r,int now){\n\tint qq=cnt;\n\tfor(auto i:ss[x]){\n\t\tins(sv[x],1,cc,u2[i.fi],i.se);\n\t}\n\tfor(auto i:ss[x]){\n\t\tif(i.fi>1)now=max(now,i.se+max(rqry(1,1,rc,u1[max(1,i.fi-k+1)],d1[i.fi-1]),qry(sv[x],1,cc,u2[max(1,i.fi-k+1)],d2[i.fi-1])));\n\t\tif(i.fi<n)now=max(now,i.se+max(rqry(1,1,rc,u1[i.fi+1],d1[min(n,i.fi+k-1)]),qry(sv[x],1,cc,u2[i.fi+1],d2[min(n,i.fi+k-1)])));\n\t}\n\tif(l==r){ \n\t\tprintf(\"%d\\n\",now); \n\t\tcnt=qq;\n\t\treturn; \n\t}\n\tsv[ls]=sv[rs]=sv[x];\n\tsqry(lson,now);\n\tsqry(rson,now);\n\ttmm=max(cnt,tmm);\n\tcnt=qq;\n\tss[x].clear();\n}\n\ninline int read(){\n\tint f=0,s=0; char c=getchar();\n\twhile(c>'9'||c<'0')f=(c=='-'),c=getchar();\n\twhile(c>='0'&&c<='9')s=(s<<3)+(s<<1)+(c^'0'),c=getchar();\n\treturn f?-s:s;\n}\n\nint main(){\n\tn=read(); k=read(); q=read(); \n\tfor(int i=1;i<=n;i++)lv[i]=ori[i]=read();\n\tsbuild(1,1,q+1);\n\tfor(int i=1;i<=q;i++){\n\t\tt1=read(); t2=read();\n\t\tsins(1,1,q+1,lst[t1]+1,i,t1,lv[t1]);\n\t\tlst[t1]=i; lv[t1]=t2;\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tif(!lst[i])re[++rc]=i;\n\t\telse ch[++cc]=i,sins(1,1,q+1,lst[i]+1,q+1,i,lv[i]);;\n\t}\n\tfor(int i=n,p1=rc,p2=cc;i>=1;i--){\n\t\td1[i]=p1; d2[i]=p2;\n\t\tif(re[p1]==i)p1--;\n\t\tif(ch[p2]==i)p2--;\n\t}\n\tfor(int i=1,p1=1,p2=1;i<=n;i++){\n\t\tu1[i]=p1; u2[i]=p2;\n\t\tif(re[p1]==i)p1++;\n\t\tif(ch[p2]==i)p2++;\n\t}\n\trbuild(1,1,rc);\n\tfor(int i=1;i<=rc;i++){\n\t\tint tmp=0;\n\t\tif(re[i]>1)tmp=max(rqry(1,1,rc,u1[max(1,re[i]-k+1)],d1[re[i]-1]),tmp);\n\t\tif(re[i]<n)tmp=max(rqry(1,1,rc,u1[re[i]+1],d1[min(n,re[i]+k-1)]),tmp);\n\t\tmx=max(mx,tmp+ori[re[i]]);\n\t}\n\tsqry(1,1,q+1,mx);\n\treturn 0;\n}\n```",
        "postTime": 1623209248,
        "uid": 118743,
        "name": "ZZ\u4f5c\u8005",
        "ccfLevel": 7,
        "title": "P6717 [CCO 2018] Boring Lectures \u9898\u89e3"
    },
    {
        "content": "$O((n+q)\\log n)$ \u505a\u6cd5\uff0c\u8fd8\u80fd\u652f\u6301\u533a\u95f4\u67e5\uff0c\u611f\u89c9\u5f88\u5178\u4f46\u662f\u522b\u7684\u9898\u89e3\u6ca1\u6709\u63d0\u5230\u3002\n\n\u6709\u5957\u8def\uff1a \u5982\u679c\u4f60\u505a\u8fc7 [\u5b83\u7684\u52a0\u5f3a\u7248](https://dreamerkk.blog.luogu.org/gym-103681f) \uff0c \u5f3a\u70c8\u63a8\u8350\u8fd9\u4e2a\u9898\uff0c\u771f\u7684\u5f88\u6709\u610f\u601d\u3002\n\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a\u7ebf\u6bb5\u6811\u7ef4\u62a4 $a_x +b_y\\ (x\\leq y)$ \u7684\u6700\u6700\u5927\u503c\uff1a \u7ef4\u62a4\u53bb\u52a0 $a,b,a_x +b_y\\ (x\\leq y)$ \u7684\u6700\u503c\uff0c\u4e0d\u96be\u53d1\u73b0\u4fe1\u606f\u53ef\u4ee5\u5408\u5e76\uff0c\u53ea\u7528\u8003\u8651\u5de6\u513f\u5b50\u7684 $a $ \u914d\u53f3\u513f\u5b50\u7684 $b$\u3002\n\n\n\u4e3a\u65b9\u4fbf\u79f0\u8ff0\u4ee4 $k\\gets k-1$\uff0c \u4e24\u4e2a\u6570\u7684\u4e0b\u6807\u5dee\u4e0d\u8d85\u8fc7 $k$\u3002 \n\n\u5957\u8def\uff1a\u9009\u62e9\u4e24\u4e2a\u8ddd\u79bb\u81f3\u5c11\u4e3a $k$ \u7684\u6570\u53ef\u4ee5\u628a\u5e8f\u5217\u9519\u5f00 $k$ \u4f4d\u7136\u540e\u7ef4\u62a4 $a_x+b_y \\ (x\\leq y)$ \u7684\u5206\u6cbb\u7ed3\u6784\uff0c\u800c\u9009\u62e9\u4e24\u4e2a\u8ddd\u79bb\u81f3\u591a\u4e3a $k$ \u7684\u6570\u76f4\u63a5\u8fd9\u6837\u9519\u5f00 $k$ \u4f4d\uff0c\u7ef4\u62a4 $a_x+b_y \\ (x\\geq y)$ \u53ef\u80fd\u4f1a\u5bfc\u81f4\u9009\u62e9\u4e86\u4e00\u4e2a\u540e\u9762\u7684\u6570\u800c\u4e14\u8ddd\u79bb\u5927\u4e8e $k$ \u800c\u5047\u6389\u3002\n\n\u4e8e\u662f\u6211\u4eec\u8003\u8651\u628a\u5e8f\u5217\u5272\u5f00\u6210 $k$ \u4e2a\u4e00\u6bb5\u90a3\u4e48\u7b54\u6848\u4e00\u5b9a\u51fa\u73b0\u5728\u4e24\u4e2a\u76f8\u90bb\u7684\u6bb5\u4e4b\u95f4\u6216\u8005\u4e00\u4e2a\u6bb5\u5185\u3002 \u6bb5\u5185\u968f\u4fbf\u9009\uff0c\u9009\u6700\u5927\u6b21\u5927\u5c31\u884c\uff0c\u968f\u4fbf\u62ff\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u3002\n\n\u4e24\u4e2a\u6bb5\u4e4b\u95f4\u95ee\u9898\u5c31\u6bd4\u8f83\u597d\u89e3\u51b3\u4e86\uff0c\u50cf\u521a\u521a\u4e0a\u9762\u90a3\u6837\u518d\u5c06\u5e8f\u5217\u9519\u4f4d\u518d\u7ef4\u62a4\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u5177\u4f53\u5730\u8bf4\u5c31\u662f\u7ef4\u62a4  $a_x+a_{y+k}\\ (x\\geq y)$ \u7684\u6700\u503c\uff0c\u5e26\u5165\u4e0a\u9762\u90a3\u4e2a\u5f62\u5f0f\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5c31\u884c\u4e86\u3002\n\n\u518d\u62ff\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u6240\u6709\u6bb5\u7684\u7b54\u6848\uff0c\u66f4\u6539\u65f6\u53ea\u4f1a\u6d89\u53ca\u5230\u6bb5\u5185\u548c\u76f8\u90bb\u7684\u4e24\u7aef\uff0c\u76f4\u63a5\u5728\u7ebf\u6bb5\u6811\u4e0a\u66f4\u6539\u540e\u518d\u6539\u4e0b\u5168\u5c40\u7b54\u6848\u5c31\u884c\u4e86\uff0c\u590d\u6742\u5ea6 $O((n+q)\\log n)$\u3002\n\n\u8981\u505a\u533a\u95f4\u67e5\u7684\u8bdd\u5c31\u518d\u52a0\u4e24\u68f5\u5927\u7ebf\u6bb5\u6811\u7ef4\u62a4\u6bb5\u7684\u7b54\u6848\u548c\u4e24\u7aef\u4e4b\u95f4\u7684\u7b54\u6848\uff0c\u6709\u4fee\u6539\u7684\u8bdd\u7b97\u5b8c\u7b54\u6848\u8981\u540c\u6b65\u66f4\u65b0\u5728\u8fd9\u4e24\u68f5\u7ebf\u6bb5\u6811\u4e0a\uff0c\u7136\u540e\u67e5\u8be2\u5c31\u5728\u8fd9\u4e24\u68f5\u7ebf\u6bb5\u6811\u4e0a\u5148\u67e5\u4e00\u4e0b\uff0c\u7136\u540e\u5c31\u53ea\u5269\u8fb9\u4e0a\u7684\u7b54\u6848\u4e86\uff0c\u8fb9\u4e0a\u67e5\u4e0b\u4e24\u6bb5\u7684\u6700\u5927\u6b21\u5927\uff0c\u7136\u540e\u5269\u4e0b\u5c31\u662f\u8fb9\u6bb5\u548c\u6574\u6bb5\u4e4b\u95f4\u7684\u7b54\u6848\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728\u539f\u6765\u90a3\u4e2a\u7ebf\u6bb5\u6811\u4e0a\u67e5\u4e24\u6b21\u5f97\u5230\uff0c\u5927\u6982\u5c31\u662f\u6563\u5757\u90e8\u5206\u80fd\u7528\u7684\u90e8\u5206\u7684 $a_x+a_{y+k}\\ (x\\geq y)$\uff0c\u548c\u6563\u5757\u6700\u503c\u52a0\u6574\u5757\u5168\u90fd\u80fd\u7528\u90e8\u5206\uff0c\u5982\u679c $l$ \u548c $r$ \u5728\u76f8\u90bb\u7684\u5757\u91cc\u7684\u60c5\u51b5\u9700\u8981\u7a0d\u5fae\u5206\u8ba8\u4e00\u4e0b\uff0c\u4e5f\u53ef\u4ee5\u7528 $O(1)$ \u6b21\u67e5\u8be2\u89e3\u51b3\uff0c\u590d\u6742\u5ea6\u8fd8\u662f   $O((n+q)\\log n)$\u3002\n\n\n\n",
        "postTime": 1675258078,
        "uid": 161697,
        "name": "\u10e6\ua9bf\u0fd0",
        "ccfLevel": 7,
        "title": "P6717 Boring Lectures \u7ed3\u8bba \u7ebf\u6bb5\u6811"
    },
    {
        "content": "\u4e0d\u4f1a polylog\uff0c\u641e\u70b9\u82b1\u6d3b\u3002\n\n\u64cd\u4f5c\u5206\u5757\uff0c\u6bcf $S$ \u4e2a\u64cd\u4f5c\u4e00\u8d77\u5904\u7406\uff0c\u628a\u8fd9 $S$ \u4e2a\u70b9\u79f0\u4e3a\u7279\u6b8a\u70b9\uff0c\u5355\u8c03\u961f\u5217\u5904\u7406\u51fa\u6bcf\u4e2a\u4f4d\u7f6e\u524d/\u540e $k-1$ \u4e2a\u4f4d\u7f6e\u5185\u975e\u7279\u6b8a\u70b9\u7684\u6700\u5927\u503c\uff0c\u63a5\u4e0b\u6765\u53ea\u9700\u8981\u8003\u8651\u7279\u6b8a\u70b9\u662f\u6700\u5927\u503c\u6216\u6b21\u5927\u503c\u7684\u8d21\u732e\uff0c\u5373\u627e\u5230\u5b83\u4eec\u5de6\u53f3 $k-1$ \u4e2a\u6570\u4e2d\u7684\u6700\u5927\u503c\u3002\u6bcf\u6b21\u4fee\u6539\u540e\u7684\u8be2\u95ee\u518d\u5728 $S$ \u4e2a\u5173\u952e\u70b9\u4e4b\u95f4\u8dd1\u5355\u8c03\u961f\u5217\uff0c\u7528\u7279\u6b8a\u70b9\u4e4b\u95f4/\u7279\u6b8a\u70b9\u548c\u975e\u7279\u6b8a\u70b9\u4e4b\u95f4\u7684\u8d21\u732e\u66f4\u65b0\u7b54\u6848\u3002\n\n$O(\\frac{q}{S}n+qS)$\uff0c\u53d6 $S=\\sqrt n$ \u65f6\u590d\u6742\u5ea6\u5e73\u8861\u4e3a $O(q\\sqrt n)$\uff0c~~\u7406\u8bba\u4e0a~~\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\uff0cO2 \u4e0b\u6700\u6162\u70b9\u4e0d\u8d85\u8fc7 3s\uff0c\u8868\u73b0\u548c 2log \u7684\u7ebf\u6bb5\u6811\u5206\u6cbb\u7c7b\u4f3c\uff0c\u4f18\u52bf\u662f\u597d\u60f3\uff0c\u5199\u5f97\u5feb\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define For(i,a,b) for(int i=(a),i##END=(b);i<=i##END;i++)\n#define Rof(i,b,a) for(int i=(b),i##END=(a);i>=i##END;i--)\n#define go(u) for(int i=head[u];i;i=nxt[i])\nusing namespace std;\ninline int read(){\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9'){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}\n    return x*f;\n}\nconst int N=1e6+10,S=1e3+10;\nint n,k,Q,a[N],m,b[N],R[N],L[N];\nstruct node{int i,x;}t[S];int g[S],o;\nint q[N],l,r;\nvoid work(){\n\tFor(i,1,n)b[i]=a[i];o=0;\n\tFor(i,1,m)b[t[i].i]=0,g[++o]=t[i].i;\n\tsort(g+1,g+1+o),o=unique(g+1,g+1+o)-g-1;int res=0;\n\tl=1,r=0;For(i,1,n){\n\t\twhile(l<=r&&q[l]<=i-k)l++;\n\t\tL[i]=(l<=r)?b[q[l]]:0;\n\t\twhile(l<=r&&b[q[r]]<=b[i])r--;\n\t\tq[++r]=i;\n\t}\n\tl=1,r=0;Rof(i,n,1){\n\t\twhile(l<=r&&q[l]>=i+k)l++;\n\t\tR[i]=(l<=r)?b[q[l]]:0;\n\t\twhile(l<=r&&b[q[r]]<=b[i])r--;\n\t\tq[++r]=i;\n\t}\n\tFor(i,1,n)res=max(res,b[i]+max(L[i],R[i]));\n\tFor(j,1,m){\n\t\tint now=0;a[t[j].i]=t[j].x;\n\t\tl=1,r=0;For(i,1,o){\n\t\t\twhile(l<=r&&q[l]<=g[i]-k)l++;\n\t\t\tnow=max(now,a[g[i]]+max(L[g[i]],(l<=r)?a[q[l]]:0));\n\t\t\twhile(l<=r&&a[q[r]]<=a[g[i]])r--;\n\t\t\tq[++r]=g[i];\n\t\t}\n\t\tl=1,r=0;Rof(i,o,1){\n\t\t\twhile(l<=r&&q[l]>=g[i]+k)l++;\n\t\t\tnow=max(now,a[g[i]]+max(R[g[i]],(l<=r)?a[q[l]]:0));\n\t\t\twhile(l<=r&&a[q[r]]<=a[g[i]])r--;\n\t\t\tq[++r]=g[i];\n\t\t}\n\t\tprintf(\"%d\\n\",max(res,now));\n\t}\n}\nsigned main(){\n\tn=read(),k=read(),Q=read();For(i,1,n)a[i]=read();\n\tt[++m]=(node){1,a[1]};work(),m=0;\n\tint len=sqrt(n);while(Q--){\n\t\tint i=read(),x=read();\n\t\tt[++m]=(node){i,x};\n\t\tif(m==len)work(),m=0;\n\t}if(m)work(),m=0;\n\treturn 0;\n}\n```\n\n",
        "postTime": 1667392100,
        "uid": 447750,
        "name": "luogubot",
        "ccfLevel": 0,
        "title": "P6717"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2a\u4e71\u641e\u505a\u6cd5\u3002\u53ef\u60dc\u6a21\u62df\u8d5b\u8d5b\u65f6\u5199\u4e86\u4e00\u4e2a\u9505\u6ee1\u76d8\u7686\u8f93\u3002\n\n\u9996\u5148\u6211\u4eec\u5f97\u5199\u51fa\u67e5\u8be2\u6700\u5927\u503c\u548c\u4f4d\u7f6e\u7684\u7ebf\u6bb5\u6811\uff0c\u987a\u4fbf\u628a $l>r$ \u7684\u60c5\u51b5\u7ed9\u53bb\u6389\uff0c\u7136\u540e\u6211\u4eec\u60f3\u4e00\u4e2a\u6bd4\u8f83\u66b4\u529b\u7684\u505a\u6cd5\u3002\n\n\u6211\u4eec\u5bf9\u6574\u4e2a\u5e8f\u5217\u8fdb\u884c\u5206\u6cbb\uff0c\u6bcf\u4e00\u6b21\u627e\u5230\u5f53\u524d\u533a\u95f4\u7684\u6700\u5927\u503c\u548c\u4f4d\u7f6e\u3002\u7136\u540e\u4ece\u8fd9\u4e2a\u4f4d\u7f6e\u5f80\u5de6\u95ee $k-1$ \u4e2a\uff0c\u5f80\u53f3\u95ee $k-1$ \u4e2a\uff0c\u8fd9\u6837\u5c31\u80fd\u7b97\u51fa\u786e\u5b9a\u4f4d\u7f6e\u6700\u5927\u80fd\u5e26\u7684\u6b21\u5927\u503c\u3002\u63a5\u7740\u5206\u6cbb\u786e\u5b9a\u4f4d\u7f6e\u7684\u5de6\u53f3\u90e8\u5206\u3002\n\n\u8fd9\u4e2a\u5206\u6cbb\u597d\u50cf\u662f\u7ebf\u6027\u7684\uff0c\u7136\u540e\u6211\u4eec\u52a0\u51e0\u4e2a\u526a\u679d\u3002\u663e\u7136\u533a\u95f4\u957f\u5ea6\u5c0f\u4e8e $k$ \u662f\u4e0d\u53ef\u80fd\u7684\uff0c\u76f4\u63a5\u8fd4\u56de\u3002\u5982\u679c\u5f53\u524d\u533a\u95f4\u53d6\u5230\u7684\u6700\u5927\u503c\u7684\u4e24\u500d\u6bd4\u5f53\u524d\u7edf\u8ba1\u7684\u7b54\u6848\u8fd8\u5c0f\uff0c\u81ea\u7136\u662f\u8981\u8fd4\u56de\u3002\n\n\u5bf9\u4e8e\u4fee\u6539\u6bcf\u6b21\u76f4\u63a5\u66b4\u529b\u6539\uff0c\u7136\u540e\u66f4\u65b0\u3002\n\n\u52a0\u4e0a\u8fd9\u4e2a\u4f18\u5316\u5c31\u80fd\u8dd1\u7684\u6bd4\u8f83\u5feb\u4e86\uff0c\u8bd5\u4e86\u4e00\u4e0b\u597d\u50cf\u80fd\u8fc7\uff0c\u4f46\u8dd1\u7684\u5f88\u6162\uff0c\u800c\u4e14\u5f53 $k=2$ \u4f1a\u5bc4\u3002\n\n\u6211\u4eec\u770b\u4e00\u4e0b\u8fd9\u9053\u9898\u7684\u7279\u6027\uff0c\u53d1\u73b0\u6bcf\u6b21\u90fd\u662f\u5355\u70b9\u4fee\u6539\u3002\u6700\u5f00\u59cb\u8dd1\u4e00\u4e0b\u5206\u6cbb\uff0c\u6211\u4eec\u53ef\u4ee5\u8bb0\u5f55\u4e0a\u4e00\u6b21\u7684\u6700\u5927\u503c\u6b21\u5927\u503c\u7684\u4f4d\u7f6e\u3002\u5982\u679c\u4fee\u6539\u7684\u4f4d\u7f6e\u662f\u6700\u5927\u503c\u6216\u6b21\u5927\u503c\u7684\u4f4d\u7f6e\uff0c\u76f4\u63a5\u4fee\u6539\uff0c\u7136\u540e\u8dd1\u4e00\u904d\u5206\u6cbb\u3002\u5982\u679c\u4fee\u6539\u7684\u662f\u5176\u4ed6\u4f4d\u7f6e\uff0c\u5c31\u5047\u8bbe\u8fd9\u6b21\u4fee\u6539\u7684\u662f\u4e2d\u70b9\uff0c\u7136\u540e\u5411\u5de6\u5411\u53f3\u627e\u6b21\u5927\u503c\uff0c\u52a0\u8d77\u6765\u548c\u4e0a\u4e00\u6b21\u6bd4\u8f83\u5373\u53ef\uff0c\u56e0\u4e3a\u8981\u662f\u60f3\u66f4\u65b0\u7b54\u6848\u5fc5\u987b\u628a\u65b0\u4fee\u6539\u7684\u4f5c\u4e3a\u6700\u5927\u503c\u6216\u6b21\u5927\u503c\u3002\u8bb0\u5f97\u5982\u679c\u66f4\u4f18\u8981\u66f4\u65b0\u4f4d\u7f6e\u3002\n\n\u4ee3\u7801\uff1a\n\n```\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<string>\n#include<cstring>\n#include<algorithm>\n#include<queue>\n#include<stack>\n#include<vector>\n#include<map>\n#include<ctime>\n#define int long long\n#define ls p<<1\n#define rs p<<1|1\n#define mid ((l+r)>>1)\nusing namespace std;\ninline int read(){\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\treturn x*f;\n}\nconst int N=2e6+10;\nint n,m,k,a[N],sum[N<<1],tag[N<<1],flag=0,maxx=0,id,ans,id1,id2;\ninline void pushup(int p){\n\tif(sum[ls]>=sum[rs])\n\t\ttag[p]=tag[ls];\n\telse tag[p]=tag[rs];\n\tsum[p]=max(sum[ls],sum[rs]);\n}\ninline void build(int p,int l,int r){\n\ttag[p]=0;\n\tif(l==r){\n\t\tsum[p]=a[l];\n\t\ttag[p]=l;\n\t\treturn;\n\t}\n\tbuild(ls,l,mid);\n\tbuild(rs,mid+1,r);\n\tpushup(p);\n}\ninline void update(int L,int l,int r,int p,int k){\n\tif(l==L&&L==r){\n\t\tsum[p]=k;\n\t\treturn;\n\t}\n\tif(L<=mid)update(L,l,mid,ls,k);\n\tif(L>mid) update(L,mid+1,r,rs,k);\n\tpushup(p);\n}\ninline int query(int L,int R,int l,int r,int p){\n\tint res=0;\n\tif(L<=l&&r<=R)\n\t\treturn sum[p];\n\tif(L<=mid)res=max(res,query(L,R,l,mid,ls));\n\tif(R>mid) res=max(res,query(L,R,mid+1,r,rs));\n\treturn res;\n}\ninline int ask(int L,int R,int l,int r,int p){\n\tint res=0;\n\tif(L<=l&&r<=R){\n\t\tif(sum[p]>maxx){\n\t\t\tmaxx=sum[p];\n\t\t\tid=tag[p];\n\t\t}\n\t\treturn sum[p];\n\t}\n\tif(L<=mid)res=max(res,ask(L,R,l,mid,ls));\n\tif(R>mid) res=max(res,ask(L,R,mid+1,r,rs));\n\treturn res;\n}\ninline int qmax(int l,int r){\n\tl=max(l,1ll);\n\tr=min(r,n);\n\tif(l>r)\n\t\treturn 0;\n\treturn query(l,r,1,n,1);\n}\ninline int qtag(int l,int r){\n\tl=max(l,1ll);\n\tr=min(r,n);\n\tif(l>r)\n\t\treturn 0;\n\tmaxx=0;\n\task(l,r,1,n,1);\n\treturn id;\n}\nvoid solve(int l,int r){\n\tif(l>r)\n\t\treturn;\n\tif(r-l+1<k)\n\t\treturn;\n\tint maxn=qmax(l,r),p=qtag(l,r);\n\tif(maxn*2<=ans)\n\t\treturn;\n\tint s1=qmax(p-k+1,p-1),s2=qmax(p+1,p+k-1);\n\tint res=maxn+max(s1,s2);\n\tif(res>ans){\n\t\tid1=p;\n\t\tif(s1>s2)\n\t\t\tid2=qtag(p-k+1,p-1);\n\t\telse id2=qtag(p+1,p+k-1);\n\t}\n\tans=max(ans,res);\n\tsolve(l,p-1);\n\tsolve(p+1,r);\n}\nsigned main()\n{\n\tn=read(),k=read(),m=read();\n\tfor(int i=1;i<=n;i++)\n\t\ta[i]=read();\n\tbuild(1,1,n);\n\tsolve(1,n);\n\tprintf(\"%lld\",ans);\n\tputchar('\\n');\n\twhile(m--){\n\t\tint x=read(),y=read();\n\t\tupdate(x,1,n,1,y);\n\t\tif(x==id1||x==id2){\n\t\t\tans=0;\n\t\t\tsolve(1,n);\n\t\t\tprintf(\"%lld\",ans);\n\t\t\tputchar('\\n');\n\t\t\tcontinue;\n\t\t}\n\t\tint res=max(qmax(x-k+1,x-1),qmax(x+1,x+k-1))+y;\n\t\tif(res>ans){\n\t\t\tid1=x;\n\t\t\tupdate(x,1,n,1,0);\n\t\t\tid2=qtag(x-k+1,x+k-1);\n\t\t\tupdate(x,1,n,1,y);\n\t\t}\n\t\tans=max(ans,res);\n\t\tprintf(\"%lld\",ans);\n\t\tputchar('\\n');\n\t}\n\treturn 0;\n\n}\n```\n\n\u53ef\u60dc\u67d0\u4e2a\u4eba\u62ff\u7740\u6211\u4ee3\u7801\u89e3\u91ca\u4e00\u4e0b\u5c31\u4ea4\u4e86\u9898\u89e3\u3002",
        "postTime": 1658050012,
        "uid": 253738,
        "name": "\u542c\u53d6MLE\u58f0\u4e00\u7247",
        "ccfLevel": 7,
        "title": "P6717\u9898\u89e3"
    },
    {
        "content": "\u9996\u5148\u628a\u4e00\u6b21\u4fee\u6539\u62c6\u6210\u4e00\u6b21\u5355\u70b9\u63d2\u5165\u4e00\u6b21\u5355\u70b9\u5220\u9664\uff0c\u521d\u59cb\u5e8f\u5217\u5c31\u662f\u82e5\u5e72\u63d2\u5165\u64cd\u4f5c\u3002\n\n\u63d2\u5165\u7684\u65f6\u5019\u662f\u5bb9\u6613\u7ef4\u62a4\u7b54\u6848\u7684\u3002\u4f7f\u7528\u7ebf\u6bb5\u6811\u5728\u5de6\u7aef\u70b9\u7ef4\u62a4\u6bcf\u4e2a\u533a\u95f4\u7684\u7b54\u6848\uff0c\u90a3\u4e48\u6211\u4eec\u7ef4\u62a4\u533a\u95f4\u6700\u5927\u7684\u6700\u5927\u503c+\u6b21\u5927\u503c\uff0c\u548c\u533a\u95f4\u6700\u503c\u5c31\u5bb9\u6613\u66f4\u65b0\u7b54\u6848\u3002\u5177\u4f53\u6765\u8bf4\u6bcf\u6b21\u65b0\u4ea7\u751f\u7684\u7b54\u6848\u53ea\u53ef\u80fd\u662f\u81ea\u5df1\u52a0\u4e0a\u533a\u95f4\u6700\u503c\uff0c\u6240\u4ee5\u53ef\u4ee5\u7b80\u5355\u7ef4\u62a4\u3002\n\n\u7136\u540e\u662f\u5220\u9664\u64cd\u4f5c\uff0c\u5f88\u9057\u61be\uff0c\u6211\u4e5f\u4e0d\u4f1a\u5220\u9664\u64cd\u4f5c\u3002\n\n\u90a3\u4e48\u600e\u4e48\u529e\uff1f\u6ce8\u610f\u5230\u53ef\u4ee5\u79bb\u7ebf\uff0c\u90a3\u4e48\u76f4\u63a5\u7ebf\u6bb5\u6811\u5206\u6cbb\u4e00\u4e0b\uff0c\u5c31\u6ca1\u6709\u5220\u9664\u64cd\u4f5c\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(Q\\log Q\\log n)$\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<vector>\n#include<algorithm>\nusing namespace std;\nint n,len,m,a[1000001],lst[1000001],maxn[1000001<<2],ans[1000001<<2],tag[1000001<<2];\nvector<pair<int,int> > v[100001<<2];\nstruct element\n{\n\tint id,maxn,ans,tag;\n\telement(int id_,int maxn_,int ans_,int tag_):\n\t\tid(id_),maxn(maxn_),ans(ans_),tag(tag_){}\n};\nvector<element> tmp[100001<<2];\ninline int read()\n{\n\tint x=0;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9')\n\t\tc=getchar();\n\twhile(c>='0'&&c<='9')\n\t{\n\t\tx=(x<<1)+(x<<3)+(c^48);\n\t\tc=getchar();\n\t}\n\treturn x;\n}\ninline void print(int x)\n{\n\tif(x>=10)\n\t\tprint(x/10);\n\tputchar(x%10+'0');\n}\ninline int Max(int x,int y)\n{\n\treturn x>y? x:y;\n}\ninline void push_up(int k)\n{\n\tmaxn[k]=Max(maxn[k],Max(maxn[k<<1],maxn[k<<1|1]));\n\tans[k]=Max(ans[k],Max(ans[k<<1],ans[k<<1|1]));\n}\ninline void push_down(int k)\n{\n\tif(tag[k])\n\t{\n\t\tans[k<<1]=Max(ans[k<<1],maxn[k<<1]+tag[k]);\n\t\tans[k<<1|1]=Max(ans[k<<1|1],maxn[k<<1|1]+tag[k]);\n\t\tmaxn[k<<1]=Max(maxn[k<<1],tag[k]);\n\t\tmaxn[k<<1|1]=Max(maxn[k<<1|1],tag[k]);\n\t\ttag[k<<1]=Max(tag[k<<1],tag[k]);\n\t\ttag[k<<1|1]=Max(tag[k<<1|1],tag[k]);\n\t\ttag[k]=0;\n\t}\n}\ninline void update(int nl,int nr,int l,int r,int k,int p,int node)\n{\n\tif(k==1&&node!=1)\n\t\ttmp[node].emplace_back(k,maxn[k],ans[k],tag[k]);\n\tif(l>=nl&&r<=nr)\n\t{\n\t\tans[k]=Max(ans[k],p+maxn[k]);\n\t\tmaxn[k]=Max(maxn[k],p);\n\t\ttag[k]=Max(tag[k],p);\n\t\treturn;\n\t}\n\tif(node!=1)\n\t{\n\t\ttmp[node].emplace_back(k<<1,maxn[k<<1],ans[k<<1],tag[k<<1]);\n\t\ttmp[node].emplace_back(k<<1|1,maxn[k<<1|1],ans[k<<1|1],tag[k<<1|1]);\n\t}\n\tpush_down(k);\n\tint mid=(l+r)>>1;\n\tif(nl<=mid)\n\t\tupdate(nl,nr,l,mid,k<<1,p,node);\n\tif(nr>mid)\n\t\tupdate(nl,nr,mid+1,r,k<<1|1,p,node);\n\tpush_up(k);\n}\ninline void insert(int nl,int nr,int l,int r,int k,pair<int,int> w)\n{\n\tif(l>=nl&&r<=nr)\n\t{\n\t\tv[k].emplace_back(w);\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tif(nl<=mid)\n\t\tinsert(nl,nr,l,mid,k<<1,w);\n\tif(nr>mid)\n\t\tinsert(nl,nr,mid+1,r,k<<1|1,w);\n}\ninline void query(int l,int r,int k)\n{\n\tfor(auto i:v[k])\n\t\tupdate(Max(i.first-len+1,1),i.first,1,n,1,i.second,k);\n\tif(l==r)\n\t{\n\t\tprint(ans[1]);\n\t\tputchar('\\n');\n\t\tif(k^1)\n\t\t\tfor(int i=(int)tmp[k].size()-1;i>=0;--i)\n\t\t\t{\n\t\t\t\tmaxn[tmp[k][i].id]=tmp[k][i].maxn;\n\t\t\t\tans[tmp[k][i].id]=tmp[k][i].ans;\n\t\t\t\ttag[tmp[k][i].id]=tmp[k][i].tag;\n\t\t\t}\n\t\ttmp[k].clear();\n\t\ttmp[k].shrink_to_fit();\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tquery(l,mid,k<<1);\n\tquery(mid+1,r,k<<1|1);\n\tif(k^1)\n\t\tfor(int i=(int)tmp[k].size()-1;i>=0;--i)\n\t\t{\n\t\t\tmaxn[tmp[k][i].id]=tmp[k][i].maxn;\n\t\t\tans[tmp[k][i].id]=tmp[k][i].ans;\n\t\t\ttag[tmp[k][i].id]=tmp[k][i].tag;\n\t\t}\n\ttmp[k].clear();\n\ttmp[k].shrink_to_fit();\n}\nint main()\n{\n\tn=read(),len=read(),m=read();\n\tfor(int i=1;i<=n;++i)\n\t\ta[i]=read();\n\tfor(int i=1;i<=m;++i)\n\t{\n\t\tint x=read(),y=read();\n\t\tinsert(lst[x],i-1,0,m,1,{x,a[x]});\n\t\ta[x]=y;\n\t\tlst[x]=i;\n\t}\n\tfor(int i=1;i<=n;++i)\n\t\tinsert(lst[i],m,0,m,1,{i,a[i]});\n\tquery(0,m,1);\n\treturn 0;\n}\n```",
        "postTime": 1658039216,
        "uid": 85682,
        "name": "\u7edd\u9876\u6211\u4e3a\u5cf0",
        "ccfLevel": 8,
        "title": "P6717 [CCO2018] Boring Lectures \u9898\u89e3"
    }
]