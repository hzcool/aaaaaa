[
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P5561)\n\n#### \u524d\u7f6e\u77e5\u8bc6\uff1a\n\n\u540e\u7f00\u6570\u7ec4\u6c42\u6700\u957f\u516c\u5171\u524d\u7f00\u3002\n\n#### \u9898\u610f\uff1a\n\n- \u7ed9\u51fa $n$ \u4e2a\u5b57\u7b26\u4e32\uff0c\u4e00\u4e2a\u5b57\u7b26\u4e32\u96c6\u5408 $S$\uff08\u521d\u59cb\u4e3a\u7a7a\uff09\uff0c$q$ \u6b21\u64cd\u4f5c\uff0c\u6bcf\u6b21\u64cd\u4f5c\u5206\u4e3a\u4e24\u79cd\uff1a\n\t1. \u5c06\u7b2c $x$ \u4e2a\u5b57\u7b26\u4e32\u7684\u5b50\u4e32 $[l,r]$ \u52a0\u5165\u96c6\u5408 $S$\u3002\n\t2. \u64a4\u9500\u7b2c $k$ \u6b21\u64cd\u4f5c\u3002\u4fdd\u8bc1\u7b2c $k$ \u6b21\u64cd\u4f5c\u4e3a\u64cd\u4f5c 1 \u4e14\u672a\u88ab\u64a4\u9500\u8fc7\u3002\n- \u6bcf\u6b21\u64cd\u4f5c\u540e\uff0c\u8be2\u95ee\u96c6\u5408\u5185\u6240\u6709\u5b57\u7b26\u4e32\u7684 $\\text{LCP}$ \u7684\u957f\u5ea6\u3002\u82e5\u96c6\u5408\u4e3a\u7a7a\uff0c\u8f93\u51fa 0\u3002\n\n- \u8bb0\u5b57\u7b26\u4e32\u603b\u957f\u4e3a $m$\uff0c$n,m,q\\le10^6$\u3002\n\n#### \u5206\u6790\uff1a\n\n\u524d\u4e09\u4e2a Subtask \u548c\u6b63\u89e3\u65e0\u5173\uff0c\u53ef\u76f4\u63a5\u4ece Subtask 4 \u5f00\u59cb\u770b\u3002\n\n**Subtask 1\uff1a**$n\\le5$\uff0c$q=10$\u3002\n\n\u66b4\u529b\u3002\n\n**Subtask 2\uff1a**\u6bcf\u6b21\u63d2\u5165\u4fdd\u8bc1 $l=1$\u3002\n\n\u5148\u8003\u8651\u6bcf\u6b21\u90fd\u4f1a\u63d2\u5165\u4e00\u6574\u4e2a\u5b57\u7b26\u4e32\u7684\u60c5\u51b5\u3002\u76f8\u5f53\u4e8e\u6c42\u82e5\u5e72\u5b57\u7b26\u4e32\u7684 $\\text{LCP}$\uff0c\u5b57\u7b26\u4e32\u603b\u957f\u4e0d\u8d85\u8fc7 $10^6$\u3002\n\n\u8003\u8651\u5c06\u6240\u6709\u5b57\u7b26\u4e32\u63d2\u5165\u4e00\u68f5 $\\text{Trie}$ \u4e2d\uff0c\u5219\u6c42 $\\text{LCP}$ \u8f6c\u5316\u4e3a\u6c42 $\\text{LCA}$\uff0c\u53ef\u4ee5\u4f7f\u7528\u6b27\u62c9\u73af\u6e38\u5e8f\u89e3\u51b3\u3002\n\n**Subtask 3\uff1a**$q=10^5$\uff0c\u4e0d\u542b\u64cd\u4f5c 2\uff0c\u8be2\u95ee\u968f\u673a\u751f\u6210\u3002\n\n\u82e5 $n=1$\uff0c\u5219\u66b4\u529b\u671f\u671b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O(m\\log m)$\u3002[\u8bc1\u660e link](https://www.luogu.com.cn/paste/sx27ugfb)\u3002\n\n\u82e5 $n>1$\uff0c\u5219\u66f4\u5bb9\u6613\u751f\u6210\u957f\u5ea6\u8f83\u77ed\u7684\u8be2\u95ee\uff0c\u5e94\u5f53\u66f4\u5feb\u3002\n\n**Subtask 4\uff1a**\n\n\u5148\u8003\u8651\u64cd\u4f5c 1 \u4e2d\u5b50\u4e32\u5747\u4e3a\u5b57\u7b26\u4e32\u540e\u7f00\u7684\u60c5\u51b5\u3002\n\n\u6b64\u65f6\u8be2\u95ee\u76f8\u5f53\u4e8e\u6c42\u82e5\u5e72\u5b57\u7b26\u4e32\u540e\u7f00\u7684 $\\text{LCP}$\u3002\u5c06\u8fd9\u4e9b\u540e\u7f00\u6309\u6392\u540d\u6392\u5e8f\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e9b\u540e\u7f00\u7684 $\\text{LCP}$ \u5373\u4e3a\u6392\u540d\u6700\u5c0f\u7684\u540e\u7f00\u4e0e\u6392\u540d\u6700\u5927\u7684\u540e\u7f00\u7684 $\\text{LCP}$\u3002\u8bc1\u660e\u53ef\u4ee5\u8003\u8651\u53cd\u8bc1\u6cd5\u3002\n\n\u8fd9\u6837\u53ea\u9700\u8981\u7ef4\u62a4\u6392\u540d\u7684\u96c6\u5408\uff0c\u6bcf\u6b21\u8be2\u95ee\u65f6\u53d6\u51fa\u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\uff0c\u6c42\u4e00\u6b21 $\\text{LCP}$ \u5373\u53ef\u3002\n\n\u518d\u8003\u8651\u975e\u540e\u7f00\u60c5\u51b5\u3002\u53ea\u9700\u8981\u5f53\u6210\u540e\u7f00\u8003\u8651\uff0c\u6c42\u51fa $\\text{LCP}$ \u4e0e\u5b50\u4e32\u957f\u5ea6\u7684\u8f83\u5c0f\u503c\u5373\u53ef\u3002\n\n---\n\n```cpp\n#include <bits/stdc++.h>\n#define rep(i, l, r) for(int i=l, _=r; i<=_; ++i)\n#pragma GCC diagnostic ignored \"-Wparentheses\"\nusing namespace std;\ntypedef long long ll;\ninline int read() {\n\tint res=0; bool k=1; char ch;\n\twhile(!isdigit(ch=getchar())) k=ch^45;\n\tdo res=res*10+(ch&15); while(isdigit(ch=getchar()));\n\treturn k? res: -res;\n}\ninline int max_(const int a, const int b) {return a>b? a: b;}\ninline int min_(const int a, const int b) {return a<b? a: b;}\n\nconst int mN=1e6+9, mD=22;\nint n, m, lg[mN], mn[mD][mN];\nchar c[mN], *en[mN];\n//\u5c06\u6240\u6709\u5b57\u7b26\u4e32\u62fc\u63a5\u6210\u4e00\u4e2a c\n//en[i] \u8868\u793a\u7b2c i \u4e2a\u5b57\u7b26\u4e32\u7684\u7ed3\u675f\u4f4d\u7f6e\nint qn[mN][2];\nmultiset<int> S, len;\n//S \u8bb0\u5f55\u6392\u540d\uff0clen \u8bb0\u5f55\u957f\u5ea6\n\n//begin \u677f\u5b50\nint buc[mN], ork, rk[2][mN*2], sa[mN], t1[mN], t2[mN];\ninline void get_buc(int *a) {\n\tmemset(buc, 0, ork+1<<2);\n\trep(i, 1, m) ++buc[a[i]];\n\trep(i, 1, ork) buc[i]+=buc[i-1];\n}\nvoid get_sa() {\n\trep(i, 1, m) rk[0][i]=c[i];\n\tork=127+(m&1);\n\tint t=0, *a;\n\tfor(; t<=lg[m] && ork^m; ++t) {\n\t\tget_buc((a=rk[t&1])+(1<<t));\n\t\trep(i, 1, m) t1[buc[a[i+(1<<t)]]--]=i;\n\t\tget_buc(a);\n\t\tfor(int i=m; i>=1; --i) t2[buc[a[t1[i]]]--]=t1[i];\n\t\tork=0;\n\t\trep(i, 1, m) {\n\t\t\tif(a[t2[i]]!=a[t2[i-1]] || a[t2[i]+(1<<t)]!=a[t2[i-1]+(1<<t)]) ++ork;\n\t\t\trk[t&1^1][t2[i]]=ork;\n\t\t}\n\t}\n\ta=rk[0];\n\tif(t&1) memcpy(a, rk[1], m+1<<2);\n\trep(i, 1, m) sa[a[i]]=i;\n\trep(i, 1, m) for(int &j=mn[0][a[i]]=max_(mn[0][a[i-1]]-1, 0); c[i+j]==c[sa[a[i]+1]+j]; ) ++j;\n\trep(t, 1, lg[m]) rep(i, 1, m-(1<<t)+1) mn[t][i]=min_(mn[t-1][i], mn[t-1][i+(1<<t-1)]);\n}\n//end \u677f\u5b50\n\nint main() {\n\trep(i, 2, mN-1) lg[i]=lg[i>>1]+1;\n\ten[0]=c;\n\trep(i, 1, n=read()) scanf(\"\\n%s\", en[i-1]+1), en[i]=en[i-1]+strlen(en[i-1]+1);\n\tm=en[n]-c, get_sa();\n\trep(i, 1, read()) {\n\t\tif(read()==1) {\n\t\t\tint x=read(), l=read(), r=read();\n\t\t\tS.insert(qn[i][0]=rk[0][en[x-1]-c+l]), len.insert(qn[i][1]=r-l+1);\n\t\t} else {\n\t\t\tint x=read();\n\t\t\tS.erase(S.find(qn[x][0])), len.erase(len.find(qn[x][1]));\n\t\t}\n\t\tif(S.empty()) {puts(\"0\"); continue;}\n\t\tint l=*S.begin(), r=(*--S.end())-1, ans=*len.begin();\n\t\t//l \u4e3a\u6700\u5c0f\u6392\u540d\uff0cr \u4e3a\u6700\u5927\u6392\u540d\uff0cans \u4e3a\u6700\u5c0f\u957f\u5ea6\n\t\tif(l<=r) ans=min_(ans, min_(mn[lg[r-l]][l], mn[lg[r-l]][r-(1<<lg[r-l])+1]));\n\t\t//\u82e5 l>r\uff0c\u5373\u96c6\u5408\u4e2d\u53ea\u6709\u4e00\u79cd\u540e\u7f00\uff0c\u5219 LCP \u5373\u4e3a\u957f\u5ea6\uff0c\u800c len \u4e2d\u5df2\u7ecf\u8bb0\u5f55\u4e86\u957f\u5ea6\n\t\tprintf(\"%d\\n\", ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1642818696,
        "uid": 175807,
        "name": "ArrTue",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5561  [Celeste-B]Mirror Magic \u955c\u50cf\u9b54\u6cd5"
    }
]