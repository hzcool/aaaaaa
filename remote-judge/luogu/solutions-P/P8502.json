[
    {
        "content": "\u8d5b\u65f6\u56e0\u4e3a\u7a7a\u95f4\u9650\u5236\u7684\u539f\u56e0\u4e0d\u592a\u8212\u670d\uff0c\u8bed\u6c14\u6709\u70b9\u51b2\uff0c\uff0c\u8fd9\u91cc\u5148\u5411\u51fa\u9898\u4eba\u81f4\u4e2a\u6b49\uff08 ~~\u987a\u624b\u5077\u8dd1\u4e00\u7bc7\u9898\u89e3~~\n\n\u9996\u5148\u770b\u53bb\u6389\u4e0d\u7ecf\u8fc7 $c$ \u7684\u9650\u5236\u600e\u4e48\u505a\u3002\u5f88\u7ecf\u5178\u7684 dp\uff1a$f_{u,v,i}$ \u8868\u793a\u4ece $u$ \u5230 $v$ \u7ecf\u8fc7 $i$ \u6761\u8fb9\u65b9\u6848\u6570\u3002\u663e\u7136\u53ef\u4ee5\u679a\u4e3e\u8fb9\u8f6c\u79fb\uff0c\u5373\u5bf9\u4e8e\u6bcf\u4e00\u6761 $v\\to w$ \u7684\u8fb9\uff0c\u628a $f_{u,w,i+1}\\gets f_{u,w,i+1}+f_{u,v,i}$\u3002\u4ed4\u7ec6\u60f3\u4e00\u4e0b\uff0c\u7531\u4e8e\u9898\u76ee\u4fdd\u8bc1\u8fb9\u65f6 $i\\to[l_i,r_i]$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8fc7\u7a0b\u76f8\u5f53\u4e8e\u5148\u533a\u95f4\u52a0\u540e\u5355\u70b9\u67e5\uff0c\u76f4\u63a5\u5dee\u5206\u4e00\u4e0b\u5c31\u884c\u3002\n\n\u7136\u540e\u60f3\u4e00\u4e0b\u600e\u4e48\u641e\u8fd9\u4e2a\u4e0d\u7ecf\u8fc7 $c$\u3002\u4e0d\u96be\u60f3\u5230\u6b63\u96be\u5219\u53cd\uff0c\u5c31\u662f\u7b97\u4e00\u4e0b $a$ \u5230 $b$ \u5b9a\u957f\u8def\u7ebf\u7684\u6240\u6709\u65b9\u6848\u6570\u548c\u5b9a\u957f\u8def\u7ebf\u4e00\u5b9a\u7ecf\u8fc7 $c$ \u7684\u65b9\u6848\u6570\u3002\u524d\u8005\u663e\u7136\u5c31\u662f $f_{a,b,m}$\uff1b\u540e\u8005\u7684\u8bdd\uff0c\u8003\u8651\u679a\u4e3e\u4e00\u4e2a\u5206\u65ad\u70b9\u4f7f\u5f97\u524d\u540e\u90e8\u5206\u6709\u672c\u8d28\u533a\u522b\u3002\u4e00\u79cd\u65b9\u6cd5\u662f\u679a\u4e3e\u5728\u8def\u5f84\u4e2d\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u7684 $c$ \u7684\u4f4d\u7f6e\uff08\u4e0d\u59a8\u8bbe\u662f $\\rm pos$\uff09\uff0c\u5206\u6790\u4e00\u4e0b\u5c31\u6709\uff0c\u5b83\u4e4b\u524d\u7684\u8def\u5f84\u662f\u53ef\u4ee5\u4e71\u8d70\u7684\uff0c\u6240\u4ee5\u8bf4\u5c31\u76f4\u63a5\u662f $f_{a,c,{\\rm pos}}$\uff1b\u5bf9\u4e8e\u4e4b\u540e\u7684\u8def\u5f84\u4e0d\u80fd\u518d\u7ecf\u8fc7 $c$ \u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u8fd8\u9700\u8981\u641e\u4e00\u4e2a\u72b6\u6001 $g_{u,v,i}$ \u8868\u793a\u4ece $u$ \u5230 $v$ \u7ecf\u8fc7 $i$ \u6761\u8fb9\u4e14\u4e0d\u518d\u7ecf\u8fc7 $u$ \u7684\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u4e5f\u662f\u7b80\u5355\u7684\uff0c\u5c31\u662f\u5728 $f$ \u7684\u57fa\u7840\u4e0a\u628a\u6240\u6709 $u=v$ \u7684 $g_{u,v,i}$ \u7f6e\u4e3a $0$ \u5373\u53ef\u3002\u6240\u4ee5\u8fd9\u90e8\u5206\u7684\u65b9\u6848\u6570\u5c31\u662f $g_{c,b,m-{\\rm pos}}$\uff1a\u90a3\u4e48\u6700\u7ec8\u7b54\u6848\u5199\u5f97\u5f62\u5f0f\u5316\u4e00\u70b9\u5c31\u662f$\\sum\\limits_{i=0}^mf_{a,c,i}g_{c,b,m-i}$\u3002\n\n\u7ed3\u7b97\u4e00\u4e0b\u590d\u6742\u5ea6\uff0c\u53d1\u73b0\u5462\u8981\u8f6c\u79fb $m$ \u6b21\uff0c\u6bcf\u6b21\u8f6c\u79fb\u5dee\u5206\u4f18\u5316\u540e\u662f $O(n^2)$ \u7684\uff1b\u6b64\u5916\u5462\uff0c\u6bcf\u6b21\u8be2\u95ee\u90fd\u8981 $O(m)$ \u7b97\u4e00\u4e0b\uff0c\u6240\u4ee5\u6700\u7ec8\u6fc0\u7d20\u5c31\u662f $O(n^2m+qm)$ \u7684\u3002\u7a7a\u95f4\u7684\u8bdd\uff0c\u6eda\u6389\u4e00\u7ef4\u5c31\u2026\u2026\u6b38\uff1f\n\n\u4f60\u53d1\u73b0\u4f60\u4e0d\u80fd\u76f4\u63a5\u6eda\u6389\u4e00\u7ef4\uff0c\u56e0\u4e3a\u4f60\u8be2\u95ee\u7684\u65f6\u5019\u8fd8\u8981\u7528\uff1b\u53ef\u4e0d\u6eda\u7a7a\u95f4\u590d\u6742\u5ea6\u662f $O(n^2m)$\uff0c\u7531\u4e8e $f,g$ \u7684\u533a\u522b\u8fd8\u8981\u5e26\u4e0a\u4e24\u500d\u5e38\u6570\uff0c\u5bc4\u5f97\u900f\u900f\u7684\uff0c\u600e\u4e48\u529e\u5462\uff1f\u5b9e\u9645\u4e0a\uff0c\u53ea\u9700\u8981\u628a\u6240\u6709\u8be2\u95ee\u79bb\u7ebf\u4e0b\u6765\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e00\u8be2\u95ee\u8bb0\u5f55\u4e0b\u6765\u5b83\u6240\u9700\u8981\u7684 $f$ \u548c $g$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u5c31\u53d8\u6210\u4e86 $O(n^2+qm)$\u3002\u540c\u6837\u5e26\u6709\u4e24\u500d\u5e38\u6570\uff0c\u4f46\u662f\u521a\u597d\u5c31\u8fc7\u4e86\uff08\n\n\u8bc4\u4ef7\uff1a\u611f\u89c9\u505a\u6cd5\u8fd8\u662f\u86ee\u4e2d\u89c4\u4e2d\u77e9\u7684\uff0c\u4e00\u6b65\u6b65\u60f3\u4e0d\u96be\u60f3\u5230\u3002\u7801\u91cf\u786e\u5b9e\u6709\u4e00\u4e9b\uff0c\u4f46\u662f ~~\u6211\u8003\u573a\u4e0a\u4e0d\u5e26\u7f16\u8bd1\u4e00\u904d\u8fc7~~ \u4e5f\u5728\u9884\u60f3\u8303\u56f4\u4e4b\u4e2d\uff0c\u5c31\u662f\u5361\u7a7a\u95f4\u8fd9\u90e8\u5206\u6bd4\u8f83\u65e0\u804a\uff0c\u53ef\u80fd\u4e5f\u8c08\u4e0d\u4e0a trash\uff1f\n\n\u7a81\u7136\u53d1\u73b0\u81ea\u5df1\u7684\u9898\u89e3\u4ece\u6765\u4e0d\u7ed9\u4ee3\u7801\u6b38\uff0c\u90a3\u5c31\u6765\u4e00\u4efd\u5427\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 505, M = 1e5 + 5, P = 998244353;\n\nvoid Add (int &a, int v) {\n\ta = (a + v) >= P ? (a + v - P) : a + v;\t\n}\n\nint n, Q;\nint l[N], r[N];\nint f[2][N][N], g[2][N][N];\n\n/*\nf[i][j][k] \u8868\u793a j ~ k \u8d70 i \u6b65\u7684\u65b9\u6848\u6570\ng[i][j][k] \u8868\u793a j ~ k \u8d70 i \u6b65\u4e14\u53ea\u7ecf\u8fc7 j \u4e00\u6b21\u7684\u65b9\u6848\u6570 \n*/\n\nstruct query {\n\tint a, b, c, m;\n\tint f[105], g[105];\n\tint tot;\n} q[M];\n\nint MaxM = 0;\n\nint df[N][N], dg[N][N];\n\nvoid dp () {\n\tfor (int i = 1; i <= n; ++i) {\n\t\tf[0][i][i] = 1;\n\t\tg[0][i][i] = 1; \n\t}\n\t\n\tint p = 1;\n\tfor (int i = 0; i <= MaxM; ++i) {\n\t\tbool t = (i & 1);\n\t\t\n\t\tfor (int j = 1; j <= Q; ++j) {\n\t\t\tint a = q[j].a, b = q[j].b, c = q[j].c;\n\t\t\tq[j].f[i] = f[t][a][c], q[j].g[i] = g[t][c][b];\n\t\t\tif (i == q[j].m) q[j].tot = f[t][a][b]; \n\t\t}\n\n\t\tmemset(f[t ^ 1], 0, sizeof f[t ^ 1]);\n\t\tmemset(g[t ^ 1], 0, sizeof g[t ^ 1]);\n\t\tmemset(df, 0, sizeof df);\n\t\tmemset(dg, 0, sizeof dg);\n\t\tfor (int j = 1; j <= n; ++j) {\n\t\t\tfor (int k = 1; k <= n; ++k) if (r[k]) {\n\t\t\t\tint fval = f[t][j][k], gval = g[t][j][k];\n\t\t\t\tAdd(df[j][r[k] + 1], P - fval);\n\t\t\t\tAdd(df[j][l[k]], fval);\n\t\t\t\tAdd(dg[j][r[k] + 1], P - gval);\n\t\t\t\tAdd(dg[j][l[k]], gval);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfor (int j = 1; j <= n; ++j) {\n\t\t\tfor (int k = 1; k <= n; ++k) {\n\t\t\t\tAdd(df[j][k], df[j][k - 1]);\n\t\t\t\tAdd(dg[j][k], dg[j][k - 1]);\n\t\t\t\tf[t ^ 1][j][k] = df[j][k];\n\t\t\t\tg[t ^ 1][j][k] = dg[j][k];\n\t\t\t}\n\t\t\tg[t ^ 1][j][j] = 0;\n\t\t}\n\t}\n}\n\nint main () {\n\tios::sync_with_stdio(false);\n\tcin >> n >> Q;\n\tfor (int i = 1; i <= n; ++i) cin >> l[i] >> r[i];\n\tfor (int i = 1; i <= Q; ++i) {\n\t\tcin >> q[i].a >> q[i].b >> q[i].c >> q[i].m;\n\t\tMaxM = max(MaxM, q[i].m);\n\t}\n\t\n\tdp();\n\t\n\tfor (int i = 1; i <= Q; ++i) {\n\t\tint ans = q[i].tot;\n\t\tfor (int j = 0; j <= q[i].m; ++j) ans = (ans - 1ll * q[i].f[j] * q[i].g[q[i].m - j]) % P;\n\t\tans = (ans < 0) ? (ans + P) : ans;\n\t\tcout << ans << '\\n';\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1661601006,
        "uid": 733594,
        "name": "Karry235",
        "ccfLevel": 0,
        "title": "\u4e0d\u70c2"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/T257300)\n\n#### \u524d\u7f6e\u77e5\u8bc6\uff1a\n\n\u5dee\u5206\uff0c\u5bb9\u65a5\u3002\n\n#### \u9898\u610f\uff1a\n\n- \u7ed9\u51fa\u4e00\u5f20\u6709\u5411\u56fe\uff0c\u5bf9\u623f\u95f4 $i$ \u6709\u82e5\u5e72\u6761\u8fb9\u8fde\u5411\u533a\u95f4 $[l_i,r_i]$ \u4e2d\u7684\u6240\u6709\u70b9\u3002\n- $q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u95ee\u4ece\u70b9 $a$ \u51fa\u53d1\uff0c\u6070\u901a\u8fc7 $m$ \u6761\u8fb9\u4e14\u4e0d\u7ecf\u8fc7\u70b9 $c$ \u5230\u8fbe\u70b9 $b$ \u7684\u65b9\u6848\u6570\u3002\n\n#### \u5206\u6790\uff1a\n\n\u662f\u4e00\u9053\u5bb9\u65a5+dp+\u5c0f\u5e45\u5ea6\u5361\u7a7a\u95f4\u9898\u3002\n\n##### Subtask0\uff1a\n\ndfs \u66b4\u529b\u641c\u7d22\u3002\n\n##### Subtask2:\n\n\u5148\u6765\u770b\u770b\u6ca1\u6709\u5bb9\u65a5\u3001\u4e0d\u5361\u7a7a\u95f4\u7684 dp \u8be5\u600e\u4e48\u505a\u3002\n\n\u8003\u8651\u4e00\u4e2a dp \u6570\u7ec4 $f_{k,s,t}$\uff0c\u8868\u793a\u4ece $s$ \u7ecf\u8fc7 $k$ \u6761\u8fb9\u5230\u8fbe $t$ \u7684\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u65b9\u7a0b\u662f $f_{k,s,t}\\gets\\sum_{(v,t)\\in E}$ $f_{k-1,s,v}$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^3m)$\u3002\u5c06\u8fd9\u4e2a\u65b9\u7a0b\u53cd\u8fc7\u6765\uff0c\u5c31\u662f $f_{k-1,s,v}\\to f_{k,s,t}\\quad((v,t)\\in E)$\u3002\u5173\u6ce8\u5230\u6bcf\u4e2a\u70b9\u6240\u5230\u8fbe\u7684\u70b9\u90fd\u5728\u4e00\u4e2a\u533a\u95f4\u4e2d\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e2a\u5f0f\u5b50\u662f\u4e00\u4e2a\u533a\u95f4\u52a0\u6cd5\u3002\u533a\u95f4\u52a0\u6cd5\u53ef\u4ee5\u901a\u8fc7\u524d\u7f00\u548c\u6216\u8005\u5dee\u5206\u5b9e\u73b0\u3002\u8fd9\u91cc\u6211\u9009\u62e9\u5dee\u5206\uff0c\u90a3\u4e48\u8f6c\u79fb\u5c31\u53d8\u6210\u4e86\u5982\u4e0b\uff1a\n\n```cpp\nfor(int k=1; k<=M; ++k) {\n\tfor(int s=1; s<=n; ++s) {\n\t\tfor(int t=1; t<=n; ++t) {\n\t\t\tf[k][s][L[t]]+=f[k-1][s][t];\n\t\t\tf[k][s][R[t]+1]-=f[k-1][s][t];\n\t\t}\n\t\tfor(int t=1; t<=n; ++t) {\n\t\t\tf[k][s][t]+=f[k][s][t-1];\n\t\t}\n\t}\n}\n```\n\n\u8be2\u95ee\u53ef\u4ee5\u5728\u7ebf\u56de\u7b54\uff1a\n\n```cpp\nwhile(q--) {\n\tint a=read(), b=read(), c=read(), m=read();//\u8fd9\u91cc\u7684c\u6682\u65f6\u6ca1\u7528\n\tprintf(\"%d\\n\", f[m][a][b]);\n}\n```\n\n\n\n##### Subtask3:\n\n\u52a0\u5165\u5bb9\u65a5\uff0c\u663e\u7136\u4e0d\u7ecf\u8fc7\u70b9 $c$ \u7684\u65b9\u6848\u7b49\u4ef7\u4e8e\u6240\u6709\u65b9\u6848\u51cf\u53bb\u7ecf\u8fc7\u70b9 $c$ \u7684\u65b9\u6848\u3002\u4e00\u79cd\u5f88\u7b26\u5408\u76f4\u89c9\u7684\u8ba1\u7b97\u7ecf\u8fc7\u70b9 $c$ \u65b9\u6848\u6570\u7684\u65b9\u6cd5\u662f $\\sum_{i=0}^kf_{i,s,c}\\cdot f_{k-i,c,t}$\uff0c\u4f46\u662f\u5f88\u663e\u7136\uff0c\u8fd9\u6837\u4f1a\u6709\u91cd\u590d\u7684\u65b9\u6848\u3002\u5f53\u4e24\u4e2a\u65b9\u6848\u4e2d\u6700\u540e\u4e00\u6b21\u7ecf\u8fc7 $c$ \u70b9\u7684\u65f6\u95f4\u4e0d\u540c\u65f6\uff0c\u8fd9\u4e24\u4e2a\u65b9\u6848\u4e00\u5b9a\u4e0d\u540c\uff0c\u5e76\u4e14\u6211\u4eec\u77e5\u9053\u5355\u4e2a $f$ \u6570\u7ec4\u4e2d\u5e76\u6ca1\u6709\u91cd\u590d\u7684\u65b9\u6848\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u901a\u8fc7\u679a\u4e3e\u6700\u540e\u4e00\u6b21\u7ecf\u8fc7 $c$ \u70b9\u7684\u65f6\u95f4\u6765\u8fdb\u884c\u8ba1\u7b97\u3002\u73b0\u5728\u518d\u589e\u52a0\u4e00\u4e2a dp \u6570\u7ec4 $g_{k,s,t}$\uff0c\u8868\u793a\u4ece $s$ \u51fa\u53d1\uff0c\u7ecf\u8fc7 $k$ \u6761\u8fb9\u4e14\u4e0d\u518d\u7ecf\u8fc7 $s$ \u5230\u8fbe $t$ \u7684\u65b9\u6848\u6570\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7 $\\sum_{i=0}^kf_{i,s,c}\\cdot g_{k-i,c,t}$ \u6765\u8ba1\u7b97\u4e0d\u91cd\u590d\u7684\u7ecf\u8fc7\u70b9 $c$ \u7684\u65b9\u6848\u6570\u4e86\u3002\u5728\u8f6c\u79fb\u6570\u7ec4 $g$  \u65f6\uff0c\u53ea\u9700\u8981\u4ee4 $g_{k,s,s}$ \u7684\u503c\u59cb\u7ec8\u4e3a $0$\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u6240\u6709 $g_{k,s,t}$ \u65b9\u6848\u90fd\u6ca1\u6709\u518d\u6b21\u7ecf\u8fc7\u70b9 $s$\u3002\u8f6c\u79fb\u5982\u4e0b\uff1a\n\n```cpp\nfor(int k=1; k<=M; ++k) {\n\tfor(int s=1; s<=n; ++s) {\n\t\tfor(int t=1; t<=n; ++t) {\n\t\t\tf[k][s][L[t]]+=f[k-1][s][t], f[k][s][R[t]+1]-=f[k-1][s][t];\n\t\t\tg[k][s][L[t]]+=g[k-1][s][t], g[k][s][R[t]+1]-=g[k-1][s][t];\n\t\t}\n \t\tfor(int t=1; t<=n; ++t) {\n\t\t\tf[k][s][t]+=f[k][s][t-1];\n\t\t\tg[k][s][t]+=g[k][s][t-1];\n\t\t}\n\t\tg[k][s][s]=0;\n\t}\n}\n```\n\n\u8be2\u95ee\u4ecd\u7136\u662f\u5728\u7ebf\u56de\u7b54\uff1a\n\n```cpp\nwhile(q--) {\n\tint a=read(), b=read(), c=read(), m=read(), ans=f[m][a][b];\n\tfor(int i=0; i<=m; ++i) ans-=f[i][a][c]*g[m-i][c][b];\n\tprintf(\"%d\\n\", ans);\n}\n```\n\n##### Subtask4:\n\n\u4e0d\u51fa\u610f\u5916\u7684\u8bdd\uff0c\u6b64\u65f6\u7684\u6570\u7ec4\u5927\u5c0f\u5728 200MB \u4e0a\u4e0b\uff0c\u5b8c\u5168\u65e0\u6cd5\u901a\u8fc7 128MB \u7684\u9650\u5236\u3002\u4f46\u662f\u8be2\u95ee\u662f\u53ef\u4ee5\u79bb\u7ebf\u7684\uff0c\u610f\u5473\u7740\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u5c06 $f$ \u548c $g$ \u4e24\u4e2a\u6570\u7ec4\u90fd\u5b8c\u5168\u5b58\u4e0b\u6765\u3002\u8fd9\u91cc\u9009\u62e9\u6eda\u52a8 $g$ \u6570\u7ec4\uff0c\u6240\u4ee5\u5148\u628a $f$ \u6570\u7ec4\u8ba1\u7b97\u51fa\u6765\uff0c\u7136\u540e\u5728\u6eda\u52a8\u8ba1\u7b97\u6570\u7ec4 $g$ \u7684\u540c\u65f6\u8ba1\u7b97\u7b54\u6848\u3002\u4e3b\u9898\u4ee3\u7801\u5982\u4e0b\uff08\u672a\u8fdb\u884c\u53d6\u6a21\uff09\uff1a\n\n```cpp\n#define rep(i, a, b) ...\ninline int read(){...};\nconst int N=502, M=100, Q=1e5+1;\n\nint n, q, L[N], R[N], f[M+2][N][N], g[2][N][N];\nstruct Que {\n\tint a, b, c, m, ans;\n\tinline void sol(int k) {\n\t\tif(k<=m) ans-=f[m-k][a][c]*g[k&1][c][b];\n\t}\n} que[Q];\ninline Que get() {\n\tint a=read(), b=read(), c=read(), m=read();\n\treturn Que(a, b, c, m, f[m][a][b]);\n}\n\nint main() {\n\t//\u8f93\u5165 \n\tn=read(), q=read();\n\trep(i, 1, n) {\n\t\tL[i]=read(), R[i]=read();\n\t\tf[0][i][i]=g[0][i][i]=1;\n\t\tif(!L[i]) L[i]=1;\n\t}\n\t//\u8ba1\u7b97\u6570\u7ec4 f \n\trep(k, 1, M) {\n\t\trep(s, 1, n) {\n\t\t\trep(t, 1, n) {\n\t\t\t\tf[k][s][L[t]]+=f[k-1][s][t]);\n\t\t\t\tf[k][s][R[t]+1]-=f[k-1][s][t];\n\t\t\t}\n\t\t\trep(t, 1, n) {\n\t\t\t\tf[k][s][t]+=f[k][s][t-1];\n\t\t\t}\n\t\t}\n\t}\n\t//\u8f93\u5165\u4e0e\u9884\u5904\u7406\u8be2\u95ee \n\trep(i, 1, q) {\n\t\tque[i]=get();\n\t\tque[i].sol(0);\n\t}\n\t//\u8ba1\u7b97\u6570\u7ec4 g \u4e0e\u7b54\u6848 \n\trep(k, 1, M) {\n\t\tbool kk=k&1, tk=kk^1;\n\t\tmemset(g[kk], 0, sizeof(g[kk]));\n\t\trep(s, 1, n) {\n\t\t\trep(t, 1, n) {\n\t\t\t\tg[kk][s][L[t]]+=g[tk][s][t];\n\t\t\t\tg[kk][s][R[t]+1]-=g[tk][s][t];\n\t\t\t}\n\t\t\trep(t, 1, n) {\n\t\t\t\tg[kk][s][t]+=g[kk][s][t-1];\n\t\t\t}\n\t\t\tg[kk][s][s]=0;\n\t\t}\n\t\trep(i, 1, q) que[i].sol(k);\n\t}\n\t//\u8f93\u51fa\u7b54\u6848 \n\trep(i, 1, q) printf(\"%d\\n\", que[i].ans);\n}\n```\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2m+mq)$\uff0c\u7a7a\u95f4\u5927\u6982\u5728 100MB \u4e0a\u4e0b\u3002\n\n#### \u5176\u4ed6\u7684\u8bdd\n\n\u672c\u9898\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5bf9\u7a7a\u95f4\u8fdb\u884c\u5e38\u6570\u7ea7\u522b\u7684\u4f18\u5316\uff0c\u6700\u540e\u5c06\u7a7a\u95f4\u63a7\u5236\u5728 54MB \u4e0a\u4e0b\uff0c\u662f\u901a\u8fc7\u53ea\u5b58\u50a8\u5947\u6570\u6b65\u7684 $f$ \u6570\u7ec4\u6765\u5b8c\u6210\u7684\uff0c\u5728\u8ba1\u7b97\u7b54\u6848\u7684\u65f6\u5019\u5bf9 $f$ \u8fdb\u884c\u4e00\u6b21\u8f6c\u79fb\u3002\u4f46\u662f\u8fd9\u79cd\u65b9\u6848\u662f\u7528\u65f6\u95f4\u6362\u7a7a\u95f4\uff0c\u672c\u8d28\u4e0a\u5e76\u65e0\u533a\u522b\uff0c\uff08\u5e76\u4e14\u80af\u5b9a\u4f1a\u88ab\u9a82\uff09\u6240\u4ee5\u5c31\u6ca1\u6709\u4f5c\u4e3a\u672c\u9898\u6b63\u89e3\u3002",
        "postTime": 1659710235,
        "uid": 428154,
        "name": "\u5b50\u4e11",
        "ccfLevel": 7,
        "title": "\u9898\u89e3\u3010No cost too great\u3011"
    },
    {
        "content": "\u6ca1\u6709\u6253\u8fd9\u573a\u6bd4\u8d5b\uff0c\u8d5b\u540e\u5199\u4e86 1h+ \u5199\u4e86[ N \u591a\u9875\u6d4b\u8bc4\u8bb0\u5f55](https://www.luogu.com.cn/record/list?pid=P8502&user=560516)\u7684\u840c\u65b0\u6765\u5199\u4e00\u53d1\u9898\u89e3\u3002\n\n\u8bbe $f_{i,j,k}$ \u662f $i\\to j$ \u7ecf\u8fc7 $k$ \u6761\u8def\u5f84\u7684\u65b9\u6848\u6570\uff0c\u521d\u59cb\u5316 $f_{i,i,0}=1$\u3002\n\n\u6709\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f_{i,j,k}=\\sum_{j\\in G_{t}}f_{i,t,k-1}$$\n\n\u8fd9\u4e2a\u597d\u50cf\u4e0d\u592a\u597d\u4f18\u5316\uff0c\u53cd\u4e00\u4e0b\uff1a\n\n\u76f8\u5f53\u4e8e $\\forall_{t\\in G_j}f_{i,t,k}+=f_{i,j,k-1}$\uff0c\u8fd9\u4e2a\u663e\u7136\u5dee\u5206\u53ef\u4ee5 $\\mathcal{O}(1)$ \u505a\u3002\n\n\u7136\u800c\u9898\u76ee\u8981\u6c42\u4e0d\u7ecf\u8fc7 $c$ \u70b9\uff0c\u6839\u636e\u5bb9\u65a5\u539f\u7406\uff0c\u4e0d\u7ecf\u8fc7 $c$ \u70b9\u7684\u8def\u5f84\u7b49\u4e8e\u6240\u6709\u8def\u5f84\u6570\u51cf\u53bb\u7ecf\u8fc7\u7684\u8def\u5f84\u6570\u3002\n\n\u6240\u6709\u8def\u5f84\u5f53\u7136\u662f $f_{s,c,k}$\u3002\u90a3\u4ece $s$ \u5230 $t$ \u7ecf\u8fc7 $c$ \u70b9\u7684\u8def\u5f84\u600e\u4e48\u6c42\u5462\uff1f\u53ef\u4ee5\u662f $\\sum_{i=1}^{k}f_{s,c,i}\\times f_{c,t,k-i}$ \u5417\uff1f\n\n\u4e0d\u53ef\u4ee5\u3002\u56e0\u4e3a $f$ \u4f1a\u91cd\u590d\u7ecf\u8fc7 $c$ \u70b9\uff0c\u5bfc\u81f4\u8def\u5f84\u91cd\u590d\u3002\u6211\u4eec\u53d1\u73b0\u95ee\u9898\u5728\u4e8e\u91cd\u590d\u4e0a\u3002\u6240\u4ee5\u8bbe $g_{i,j,k}$ \u4e3a $i\\to j$ \u7ecf\u8fc7 $k$ \u6761\u8fb9\u4e14\u4e0d\u91cd\u590d\u7ecf\u8fc7 $i$ \u70b9\u7684\u8def\u5f84\u6570\u3002\n\n\u8fd9\u6837\uff0c\u4ece $s$ \u5230 $t$ \u7ecf\u8fc7 $c$ \u70b9\u7684\u8def\u5f84\u5c31\u662f $\\sum_{i=1}^{k}f_{s,c,k-i}\\times g_{c,t,i}$\u3002\u4e0d\u7ecf\u8fc7\u7684\u8def\u5f84\u5c31\u662f\uff1a\n\n$$f_{s,c,k}-\\sum_{i=1}^{k}f_{s,c,k-i}\\times g_{c,t,i}$$\n\n\u90a3\u4e48 $g$ \u600e\u4e48\u8f6c\u79fb\u5462\uff1f\u540c $f$\uff0c\u53ea\u8981\u6bcf\u6b21\u8f6c\u79fb\u5b8c\u4f7f $g_{i,i,k}=0$ \u5373\u53ef\u3002\n\n\u8fd9\u6837 $10\\text{pts}$ \u5c31\u6709\u4e86\u3002\n\n\u63a5\u4e0b\u6765\u8981\u6ce8\u610f\u53d6\u6a21+\u7a7a\u95f4+\u5361\u5e38\u3002\n\n\u9996\u5148\u8fd9\u91cc $f_{s,c,k-i}\\times g_{c,t,i}$ \u7528\u9f9f\u901f\u4e58\u80af\u5b9a\u76f4\u63a5\u7206\u70b8\uff0c\u8f6c `long long` \u4e58\u518d\u6a21\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u7136\u540e\u6ce8\u610f\u5dee\u5206\u6709\u51cf\u7684\u8fc7\u7a0b\uff0c\u4e5f\u5c31\u662f\u8bf4\u6709\u8d1f\u6570\uff0c\u6a21\u8981 `(a%mod+mod)%mod`\u3002\n\n\u7136\u540e\u60a8\u53d1\u73b0\u60a8\u7a7a\u95f4\u70b8\u4e86\uff0c\u7ea6\u662f $200\\text{MB}$ \u4e0a\u4e0b\u3002\n\n\u600e\u4e48\u529e\uff1f\u53ea\u80fd\u7528\u6eda\u52a8\u6570\u7ec4\u3002\n\n\u4f46\u662f\u8fd9\u4e2a $f$ \u548c $g$ \u4e0d\u80fd\u6eda\uff0c\u8be2\u95ee\u8981\u7528\u3002\n\n\u90a3\u6211\u4eec\u5c31\u628a\u8be2\u95ee\u79bb\u7ebf\u4e0b\u6765\uff0c\u6eda\u5b8c\u4e00\u5c42\u5c31\u66f4\u65b0\u3002\n\n\u4f46\u662f $f$ \u548c $g$ \u4e0d\u80fd\u540c\u65f6\u6eda\u3002\u56e0\u4e3a\u4e00\u4e2a\u662f $i$ \u4e00\u4e2a\u662f $k-i$\uff0c$k$ \u6bcf\u4e2a\u8be2\u95ee\u8fd8\u4e0d\u4e00\u6837\u3002\n\n\u4f46\u662f $200\\text{MB}$ \u6eda\u4e00\u4e2a\u5269 $100\\text{MB}$ \u597d\u50cf\u591f\u4e86\uff0c\u90a3\u5c31\u6eda $g$\u3002\n\n\u628a $g$ \u6eda\u4e00\u4e0b\uff0c$k$ \u662f\u7ecf\u8fc7\u8fb9\u7684\u6761\u6570\uff0c$x$ \u662f $k\\operatorname{bitand}1$\uff08\u5373\u6eda\u52a8\u6570\u7ec4\u672c\u6b21\u7684\u7ed3\u679c\uff0c$x\\operatorname{xor}1$ \u662f\u4e0a\u6b21\uff09\uff0c\u6709\uff1a\n\n$$g_{i,j,x}=\\sum_{j\\in G_{t}}g_{i,t,x\\operatorname{xor}1}$$\n\n\u7136\u540e\u518d\u5dee\u5206\u4f18\u5316\u3002\n\n\u505a $100$ \u6b21\uff0c\u56e0\u4e3a $M\\leq100$\u3002\u6bcf\u6b21\u505a\u5b8c\u679a\u4e3e $Q$\uff0c\u5c06 $k_i\\leq k$ \u7684\u66f4\u65b0\u3002\n\n\u7136\u540e\u6ce8\u610f\uff0c\u505a $g_{i,j,x}$ \u7684\u65f6\u5019\u8981\u6e05\u7a7a $g_{i,j,x\\operatorname{xor}1}$\u3002\u4f46\u662f\u624b\u52a8\u6e05\u7a7a\u4f1a T\uff0c\u8981\u7528 `memset`\u3002\n\n\u4f46\u662f\u8fd8\u662f\u70b8\u4e86\u3002\u56e0\u4e3a\u53d6\u6a21\u5e38\u6570\u592a\u5927\u3002\n\n\u6211\u4eec\u53d1\u73b0\u5982\u679c $a,b< p$\uff0c\u90a3\u4e48 $a+b-p<p$\uff0c\u53ef\u4ee5\u628a\u52a0\u6cd5\u53d6\u6a21\u6362\u6210 `(x>mod)&&(x-=mod)` \u7684\u5f62\u5f0f\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5 AC \u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n^2m+qm)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n^2m+q)$\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 505, M = 105, Q = 1e5 + 5, mod = 998244353;\nint f[M][N][N], g[2][N][N], L[N], R[N], n, m, now, q;\ninline int upd(int x) {\n\t(x >= mod) && (x -= mod);\n\treturn x;\n} // \u53d6\u6a21\nstruct node {\n\tint s, t, c, k, id, ans;\n\tinline void upd(int qwq) {\n\t\tans -= 1LL * f[k - qwq][s][c] * g[qwq & 1][c][t] % mod; // \u8f6c long long \u4e58\n\t\tans = ::upd(ans + mod); // ::upd \u662f\u53d6\u6a21\n\t} // \u51cf\u53bb\u4e00\u6b21\u7ecf\u8fc7 c \u7684\u8def\u5f84\n} s[Q];\nint main() {\n\tios::sync_with_stdio(0);\n\tcin.tie(0), cout.tie(0);\n\tcin >> n >> q;\n\tfor (int i = 1; i <= n; i ++)\n\t\tcin >> L[i] >> R[i], f[0][i][i] = g[0][i][i] = 1; // \u521d\u59cb\u5316\n\tfor (int k = 1; k <= 100; k ++)\n\t\tfor (int i = 1; i <= n; i ++) {\n\t\t\tfor (int j = 1; j <= n; j ++) {\n\t\t\t\tf[k][i][L[j]] = upd((f[k][i][L[j]] + f[k - 1][i][j]) % mod + mod);\n\t\t\t\tf[k][i][R[j] + 1] = upd(f[k][i][R[j] + 1] - f[k - 1][i][j] + mod);\n\t\t\t}\n\t\t\tfor (int j = 1; j <= n; j ++)\n\t\t\t\tf[k][i][j] = upd(upd(f[k][i][j] + f[k][i][j - 1]) + mod);\n\t\t}\n\tfor (int i = 1; i <= q; i ++) {\n\t\tcin >> s[i].s >> s[i].t >> s[i].c >> s[i].k, s[i].id = i;\n\t\ts[i].ans = f[s[i].k][s[i].s][s[i].t], s[i].upd(0);\n\t}\n\tfor (int k = 1; k <= 100; k ++) {\n\t\tint now = k & 1, last = (k & 1) ^ 1; // now \u662f\u5f53\u524d\uff0clast \u7684\u4e4b\u524d\n\t\tmemset(g[now], 0, sizeof g[now]); // memset \u5e38\u6570\u5c0f\uff0c\u66b4\u529b\u6e05\u7a7a TLE\n\t\tfor (int i = 1; i <= n; i ++) {\n\t\t\tfor (int j = 1; j <= n; j ++) {\n\t\t\t\tg[now][i][L[j]] = upd(upd(g[now][i][L[j]] + g[last][i][j]) + mod);\n\t\t\t\tg[now][i][R[j] + 1] = upd(g[now][i][R[j] + 1] - g[last][i][j] + mod); // \u8bb0\u5f97\u53d6\u6a21\n\t\t\t}\n\t\t\tfor (int j = 1; j <= n; j ++)\n\t\t\t\tg[now][i][j] = upd(upd(g[now][i][j] + g[now][i][j - 1]) + mod);\n\t\t\tg[now][i][i] = 0;\n\t\t}\n\t\tfor (int i = 1; i <= q; i ++)\n\t\t\tif (k <= s[i].k) s[i].upd(k); // \u66f4\u65b0\u7b54\u6848\n\t}\n\tfor (int i = 1; i <= q; i ++)\n\t\tcout << s[i].ans << '\\n';\n\treturn 0;\n}\n```\n\nUPD\uff1a\n\n\u5176\u5b9e\u5982\u679c\u628a\u6bcf\u4e2a\u8be2\u95ee\u90fd\u4fdd\u5b58\u4e00\u4e2a $f_1\\sim f_m,g_1\\sim g_m$ \u7a7a\u95f4\u590d\u6742\u5ea6\u53ef\u4ee5\u505a\u5230 $\\mathcal{O}(n^2+qm)$\uff0c\u4f46\u662f\u597d\u50cf\u5dee\u4e0d\u591a\uff08\uff1f\uff09\uff0c\u8fd9\u91cc\u61d2\u5f97\u5199\u4e86\u3002",
        "postTime": 1661608746,
        "uid": 560516,
        "name": "\u55b5\u4ed4\u725b\u5976",
        "ccfLevel": 0,
        "title": "P8502 No cost too great\u9898\u89e3"
    },
    {
        "content": "# \u5361\u7a7a\u95f4\u840c\u65b0\u4e5f\u80fd\u770b\u61c2\u7684\u9898\u89e3TWT\n\u7384\u5b66\u7a7a\u95f4\n\n[\u9898\u76ee\u6307\u8def](https://www.luogu.com.cn/problem/P8502)\n\n\u4ee5\u4e0b\u4e3a\u907f\u514d\u4e0b\u6807\u770b\u4e0d\u6e05\uff0c\u7528 $a[i][j][k]$ \u7b49\u6765\u8868\u793a $a_{i,j,k}$\u3002\n\n## subtask 0~1\n#### \u5206\u6790\n\u8bb0 $dp[i][j]$ \u8868\u793a\u73b0\u5728\u5728\u8282\u70b9 $i$ \u6070\u597d\u8d70\u4e86 $j$ \u6b65\u7684\u65b9\u6848\u6570\u3002\n\n\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\uff0c\u521d\u59cb\u72b6\u6001\u4e3a $dp[a][0]=1$\u3002\n\n\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u4e3a $\\forall l_i\\le t\\le r_i,dp[t][k+1]+dp[i][k]\\to dp[t][k+1]$\u3002\n\n\u628a $dp[t]$ \u770b\u4f5c\u4e00\u4e2a\u6570\u5217\uff0c\u4e0a\u8ff0\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u53ef\u770b\u4f5c\u533a\u95f4\u52a0\uff0c\u7528\u5dee\u5206\u4f18\u5316\u6389\u4e00\u4e2a\u7ebf\u6027\u3002\n\n\u53e6\u5916\uff0c\u5728\u6bcf\u6b21\u8f6c\u79fb\u65f6\uff0c\u4fdd\u8bc1 $\\forall t,dp[c][t]=0$\uff0c\u5373\u53ef\u6c42\u51fa\u4e0d\u7ecf\u8fc7\u8282\u70b9 $c$ \u7684\u8def\u5f84\u6570\u3002\n\n\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\u90fd\u8ba1\u7b97\u4e00\u904d\uff0c\u5728\u7ebf\u56de\u7b54\uff0c\u7b54\u6848\u4e3a $dp[b][m]$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(Qmn)$\uff1b\u6eda\u52a8\u6570\u7ec4\u6eda\u6389\u7b2c\u4e8c\u7ef4\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(n)$\u3002\n\n#### \u6838\u5fc3\u4ee3\u7801\u90e8\u5206\n\n```cpp\nfor(;Q;--Q){\n\ta=input(),b=input(),c=input(),m=input();\n\tF(i,1,n) dp[i][0]=0;\n\tdp[a][0]=1;\n\tF(i,0,m-1){\n\t\tF(j,1,n) dp[j][(i+1)&1]=0;\n\t\tF(j,1,n){\n\t\t\tif(j==c||!l[j]) continue;\n\t\t\tdp[l[j]][(i+1)&1]=(dp[l[j]][(i+1)&1]+dp[j][i&1])%MOD;\n\t\t\tdp[r[j]+1][(i+1)&1]=((dp[r[j]+1][(i+1)&1]-dp[j][i&1])%MOD+MOD)%MOD;\n\t\t}\n\t\tF(j,1,n) dp[j][(i+1)&1]=(dp[j][(i+1)&1]+dp[j-1][(i+1)&1])%MOD;\n\t\tdp[c][(i+1)&1]=0;\n\t}\n\tprintf(\"%d\",dp[b][m&1]),putchar('\\n');\n}\n```\n\n\u559c\u63d0[75\u5206\u7684TLE](https://www.luogu.com.cn/record/85281284)\u3002\n\n## subtask 2~3\n\u4e3a\u4ec0\u4e48\u5462\uff1f\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\uff0c\u6211\u4eec\u90fd\u91cd\u590d\u8ba1\u7b97\u4e86\u5f88\u591a $dp$ \u503c\u3002\u5982\u679c\u80fd\u591f\u4e00\u6b21\u7b97\u5b8c\uff0c\u6bcf\u6b21\u67e5\u8be2\uff0c\u5c31\u80fd\u8fc7\u4e86\u3002\n\n\u65e2\u7136\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u518d\u52a0\u4e00\u7ef4\u3002\n\n\u8bb0 $dp[i][j][k]$ \u8868\u793a\u4ece\u8282\u70b9 $i$ \u5230\u8282\u70b9 $j$ \u6070\u597d\u8d70\u4e86 $k$ \u6b65\u7684\u65b9\u6848\u6570\u3002\n\n\u521d\u59cb\u72b6\u6001\u4e3a $dp[i][i][0]=1$\u3002\n\n\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u4e3a $\\forall l_j\\le t\\le r_j,dp[i][t][k+1]+dp[i][j][k]\\to dp[i][t][k+1]$\u3002\n\n\u4f9d\u7136\u53ef\u4ee5\u5dee\u5206\u4f18\u5316\u3002\n\n\u4f46\u662f\u6bcf\u6b21\u8be2\u95ee $c$ \u90fd\u4e0d\u4e00\u6837\uff0c\u6211\u4eec\u600e\u4e48\u7edf\u8ba1\u4e0d\u7ecf\u8fc7 $c$ \u7684\u65b9\u6848\u6570\u5462\uff1f\n\n\u6b63\u96be\u5219\u53cd\uff0c\u8003\u8651\u5bb9\u65a5\uff0c\u7b54\u6848\u4e3a\u603b\u6570\u51cf\u5fc5\u987b\u7ecf\u8fc7 $c$ \u7684\u65b9\u6848\u6570\u3002\n\n\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0c\u5fc5\u987b\u7ecf\u8fc7 $c$ \u7684\u65b9\u6848\u6570\u4e3a $\\sum_{i=0}^m dp[a][c][i]\\times dp[c][b][m-i]$\u3002\n\n\u2026\u2026\u5417\uff1f\n\n\u5f88\u663e\u7136\uff0c\u6211\u4eec\u91cd\u590d\u7b97\u4e86\u51e0\u6761\u8def\u5f84\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5982\u4e0b\u56fe\uff1a\n\n![\u91cd\u590d\u8def\u5f84](https://cdn.luogu.com.cn/upload/image_hosting/3cf4t72u.png)\n\n\u8fd9\u6761\u8def\u5f84\u88ab\u5f53\u6210 $BCEDF+CA$ \u548c $BC+CEDFA$ \u7b49\uff0c\u88ab\u7b97\u4e86\u591a\u6b21\u3002\n\n\u7a76\u5176\u6839\u672c\u539f\u56e0\uff0c\u5c31\u662f\u6211\u4eec\u5728\u8d77\u70b9 $c$ \u5904\u8d70\u4e86\u4e00\u4e2a\u73af\u3002\n\n\u4e3a\u6b64\uff0c\u8bb0 $dp'[i][j][k]$ \u8868\u793a\u4ece\u8282\u70b9 $i$ \u5230\u8282\u70b9 $j$ \u6070\u597d\u8d70\u4e86 $k$ \u6b65\u4e14\u4e0d\u91cd\u590d\u7ecf\u8fc7 $i$ \u7684\u65b9\u6848\u6570\u3002\n\n\u5176\u521d\u59cb\u503c\u548c\u8f6c\u79fb\u65b9\u7a0b\u5747\u4e0e $dp$ \u4e00\u6837\uff0c\u9664\u4e86\u6211\u4eec\u8981\u4fdd\u8bc1 $dp'[i][i][k]=[k=1]$\u3002\n\n\u6700\u540e\uff0c\u7b54\u6848\u4e3a $dp[a][b][m]-\\sum_{i=0}^m dp[a][c][i]\\times dp[c][b][m-i]$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2m)$\u3002\n\n## subtask 4\n\u4e0a\u9762\u7684\u65b9\u6cd5\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2m)$\uff0c\u5b8c\uff0c$200MB$\u3002\n\n\u6bcf\u6b21\u8be2\u95ee\u90fd\u8981\u67e5\u8be2\u4ee5\u524d\u7684\u503c\uff0c\u4e0d\u80fd\u6eda\u52a8\u6570\u7ec4\u3002\n\n\u65e2\u7136\u8981\u67e5\u8be2\u4ee5\u524d\u7684\u503c\uff0c\u90a3\u4e0d\u5982\u628a\u8be2\u95ee\u79bb\u7ebf\uff0c\u628a\u6bcf\u4e2a\u8be2\u95ee\u6240\u9700\u7684\u503c\u5b58\u4e0b\u6765\uff0c\u518d\u6eda\u6389 $dp$ \u548c $dp'$ \u7684\u7b2c\u4e09\u7ef4\uff0c\u6b64\u65f6\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(Qm)$\u3002\n\n\u867d\u7136\u4f46\u662f\uff0c\u8fd9\u4e2a\u770b\u7740\u533a\u522b\u4e0d\u5927\u7684\u4f18\u5316\u7adf\u7136\u80fd\u8fc7\u3002\n\n\u4e5f\u53ef\u4ee5\u52a0\u4e0a\u4e00\u4e9b\u7384\u5b66\u4f18\u5316\uff1a\u7528 vector \u5b58\u50a8\u6240\u9700\u503c\uff0c\u5f53\u4e00\u4e2a\u8be2\u95ee\u8bb0\u5f55\u5b8c\u65f6\uff0c\u9a6c\u4e0a\u7b97\u51fa\u7b54\u6848\uff0c\u5e76\u91ca\u653e vector \u7684\u5185\u5b58\u3002\n\n\u603b\u4e4b\uff0c\u672c\u9898\u901a\u8fc7\u3002\n\n## \u9644\u4e0a\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define F(i,a,b) for(int i(a);i<=b;++i)\n#define R(i,a,b) for(int i(a);i>=b;--i)\n#define _ 0\nusing namespace std;\nconst int MOD=998244353;\nshort n,l[501],r[501],maxm;\nint Q,dp[2][2][501][502];\ninline int input(){\n\tint x;char ch;\n\tfor(ch=getchar();!isdigit(ch);ch=getchar());\n\tfor(x=0;isdigit(ch);ch=getchar()) x=x*10+(ch^48);\n\treturn x;\n}\nstruct Meow{\n\tshort a,b,c,m;\n\tint need0[101],need1[101],ans;\n}ask[100001];\nint main(){\n\tn=input(),Q=input();\n\tF(i,1,n) l[i]=input(),r[i]=input(),dp[0][0][i][i]=dp[1][0][i][i]=1;\n\tF(i,1,Q) ask[i].a=input(),ask[i].b=input(),ask[i].c=input(),ask[i].m=input(),maxm=max(ask[i].m,maxm);\n\tF(I,0,maxm){\n\t\tbool i=I&1;\n\t\tF(j,1,Q){\n\t\t\task[j].need0[I]=dp[0][i][ask[j].a][ask[j].c],\n\t\t\task[j].need1[I]=dp[1][i][ask[j].c][ask[j].b];\n\t\t\tif(ask[j].m==I){\n\t\t\t\task[j].ans=dp[0][i][ask[j].a][ask[j].b];\n\t\t\t\tF(k,0,ask[j].m) ask[j].ans=((ask[j].ans-(ll)ask[j].need0[k]*ask[j].need1[ask[j].m-k])%MOD+MOD)%MOD;\n\t\t\t}\n\t\t}\n\t\tmemset(dp[0][i^1],0,sizeof(dp[0][i^1]));\n\t\tmemset(dp[1][i^1],0,sizeof(dp[1][i^1]));\n\t\tF(k,1,n) if(l[k]) F(j,1,n){\n\t\t\tdp[0][i^1][j][l[k]]=(dp[0][i^1][j][l[k]]+dp[0][i][j][k])%MOD;\n\t\t\tdp[0][i^1][j][r[k]+1]=((dp[0][i^1][j][r[k]+1]-dp[0][i][j][k])%MOD+MOD)%MOD;\n\t\t\tdp[1][i^1][j][l[k]]=(dp[1][i^1][j][l[k]]+dp[1][i][j][k])%MOD;\n\t\t\tdp[1][i^1][j][r[k]+1]=((dp[1][i^1][j][r[k]+1]-dp[1][i][j][k])%MOD+MOD)%MOD;\n\t\t}\n\t\tF(j,1,n) F(k,1,n) dp[0][i^1][j][k]=(dp[0][i^1][j][k-1]+dp[0][i^1][j][k])%MOD,dp[1][i^1][j][k]=(dp[1][i^1][j][k-1]+dp[1][i^1][j][k])%MOD;\n\t\tF(j,1,n) dp[1][i^1][j][j]=0;\n\t}\n\tF(i,1,Q) printf(\"%d\",ask[i].ans),putchar('\\n');\n    return ~~(0^_^0);//\u6bcf\u65e5\u5356\u840c(1/1)\n}\n```\n\n\u6700\u540e\uff0c\u4e34\u754c\u6570\u7ec4\u4e07\u5206\u6ce8\u610f\uff0c\u5426\u5219\u5c31\u4f1a[\u8fd9\u6837](https://www.luogu.com.cn/record/85846991)\u2026\u2026\n\n\u5b8c\u7ed3\u6492\u82b1 OwO",
        "postTime": 1662877955,
        "uid": 486559,
        "name": "littlez_meow",
        "ccfLevel": 0,
        "title": "P8502 No cost too great \u9898\u89e3"
    }
]