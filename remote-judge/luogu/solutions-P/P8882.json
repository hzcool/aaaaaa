[
    {
        "content": "## \u5206\u6790\n\n\u9996\u5148\u6211\u4eec\u8981\u77e5\u9053\uff0c\u4e00\u4e2a\u56fe\u91cc\u8fde\u901a\u5757\u7684\u6570\u91cf\u662f\u70b9\u6570\u51cf\u53bb\u8fb9\u6570\u3002\n\n\u5206\u6790\u9898\u76ee\uff0c\u6bcf\u4e2a\u975e\u53f6\u7ed3\u70b9\u90fd\u4ece\u5b50\u7ed3\u70b9\u4e2d\u9009\u53d6\u4e00\u4e2a\u70b9 $v$ \u4e0e\u4e4b\u8fde\u63a5\uff0c\u4e5f\u5c31\u662f\u8bf4\u6709\u591a\u5c11\u975e\u53f6\u7ed3\u70b9\u5c31\u6709\u591a\u5c11\u6761\u8fb9\u3002\n\u6211\u4eec\u4ee4 $x$ \u4e3a\u53f6\u7ed3\u70b9\u6570\u91cf\uff0c\u90a3\u4e48 $n-x$ \u5c31\u662f\u8fb9\u7684\u6570\u91cf\uff0c\u8fde\u901a\u5757\u7684\u6570\u91cf\u5c31\u662f $n-(n-x)$\uff0c\u4e5f\u5c31\u662f $x$\u3002\n\n\u6211\u4eec\u53d1\u73b0\u53f6\u7ed3\u70b9\u6709\u591a\u5c11\uff0c\u8fde\u901a\u5757\u5c31\u6709\u591a\u5c11\uff0c\u9898\u76ee\u5c31\u7b80\u5316\u4e3a\u6c42\u53f6\u7ed3\u70b9\u7684\u6570\u91cf\u3002\n\n## \u505a\u6cd5\n\n\u5982\u4f55\u6c42\u53f6\u7ed3\u70b9\u6570\u91cf\uff1f\u9996\u5148\u7528\u4e00\u4e2a\u53d8\u91cf\uff0c\u50a8\u5b58\u521d\u59cb\u6811\u7684\u53f6\u7ed3\u70b9\u6570\u91cf\uff0c\u518d\u5206\u522b\u5bf9\u4e8e\u6bcf\u4e2a\u64cd\u4f5c\u66f4\u65b0\u7b54\u6848\u3002\n\n* Add \u64cd\u4f5c\uff1a\u5982\u679c $u$ \u662f\u975e\u53f6\u7ed3\u70b9\uff0c\u53f6\u7ed3\u70b9\u6570\u91cf\u52a0\u4e00\uff0c\u5982\u679c $u$ \u662f\u53f6\u7ed3\u70b9\uff0c\u53f6\u7ed3\u70b9\u603b\u6570\u4e0d\u53d8\u3002\n* Del \u64cd\u4f5c\uff1a\u5982\u679c $u$ \u7684\u7236\u7ed3\u70b9\u662f\u975e\u53f6\u7ed3\u70b9\uff0c\u53f6\u7ed3\u70b9\u6570\u91cf\u51cf\u4e00\uff0c\u5982\u679c $u$ \u7684\u7236\u4eb2\u662f\u53f6\u7ed3\u70b9\uff0c\u53f6\u7ed3\u70b9\u603b\u6570\u4e0d\u53d8\u3002\n* Upd \u64cd\u4f5c\uff1a\u5982\u679c\u539f\u6765\u7684\u6839\u53ea\u6709\u4e00\u4e2a\u513f\u5b50\uff0c\u90a3\u4e48\u64cd\u4f5c\u540e\u5c31\u4f1a\u53d8\u6210\u53f6\u7ed3\u70b9\uff0c\u53f6\u7ed3\u70b9\u6570\u5c31\u52a0\u4e00\u3002\u5982\u679c\u65b0\u7684\u6839\u539f\u6765\u662f\u53f6\u7ed3\u70b9\uff0c\u64cd\u4f5c\u540e\u53f6\u7ed3\u70b9\u6570\u5c31\u51cf\u4e00\u3002\n\n\u56e0\u4e3a\u8981\u8fdb\u884c\u5220\u8fb9\u548c\u8bbf\u95ee\u7236\u7ed3\u70b9\u64cd\u4f5c\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528 set \u6765\u7ef4\u62a4\u6bcf\u4e2a\u70b9\u7684\u90bb\u70b9\u3002\u5982\u679c\u4e00\u4e2a\u70b9\u53ea\u6709\u4e00\u4e2a\u90bb\u70b9\uff0c\u90a3\u4e48\u8fd9\u4e2a\u70b9\u5c31\u662f\u53f6\u7ed3\u70b9\u3002\u53f6\u7ed3\u70b9\u7684\u7236\u7ed3\u70b9\u5c31\u662f\u552f\u4e00\u7684\u90bb\u70b9\u3002\n\n## \u4ee3\u7801\n\n\u6700\u591a $n+m$ \u4e2a\u70b9\u548c\u5220\u8fb9 $m$ \u6b21\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u4e3a $O(n+m\\log(n+m))$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nunordered_set<int>s[400005];\nint n,m,rt=1;\nint ans;\nint f(int x){//\u5224\u65ad\u662f\u5426\u662f\u53f6\u7ed3\u70b9\n    return (x==rt&&s[x].size()==0)||(x!=rt&&s[x].size()==1);\n}\nint main(){\n    cin>>n;\n    int x;\n    for(int i=2;n>=i;i++){\n        cin>>x;\n        s[i].insert(x);s[x].insert(i);\n    }\n    for(int i=2;n>=i;i++)\n        if(s[i].size()==1)ans++;\n    cout<<ans<<endl;\n    cin>>m;\n    string str;\n    for(int i=1;m>=i;i++){\n        cin>>str>>x;\n        if(str==\"Add\"){\n            if(!f(x))ans++;\n            s[x].insert(n+i);s[n+i].insert(x);\n        }\n        if(str==\"Del\"){\n            s[*s[x].begin()].erase(x);\n            if(!f(*s[x].begin()))ans--;\n        }\n        if(str==\"Upd\"){\n            int y=rt;rt=0;\n            if(f(x)&&!f(y))ans--;\n            if(!f(x)&&f(y))ans++;\n            rt=x;\n        }\n        cout<<ans<<endl;\n    }\n    return 0;\n}\n```\n\n",
        "postTime": 1671099515,
        "uid": 632236,
        "name": "gan1234",
        "ccfLevel": 0,
        "title": "P8882"
    }
]