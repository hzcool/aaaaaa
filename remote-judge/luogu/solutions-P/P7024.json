[
    {
        "content": "\u9996\u5148\u4ecb\u7ecd\u5982\u4f55\u5bf9 DAG \u6c42\u62d3\u6251\u5e8f\u7684\u4e2a\u6570\u3002\n\n$f_S$ \u8868\u793a\u70b9\u96c6 $S$ \u4e2d\u62d3\u6251\u5e8f\u7684\u4e2a\u6570\uff0c\u679a\u4e3e\u62d3\u6251\u5e8f\u4e2d\u6700\u540e\u9762\u7684\u70b9 $v$\uff0c\u5219\u5f53 $v\\in S$ \u4e14 $v$ \u4e0d\u5b58\u5728\u901a\u5f80 $S$ \u7684\u51fa\u8fb9\u65f6\uff0c\u5bb9\u6613\u5efa\u7acb\u4ece $S-\\{v\\}$ \u7684\u62d3\u6251\u5e8f\u5230 $S$ \u7684\u62d3\u6251\u5e8f\u7684\u5355\u5c04\uff08\u76f4\u63a5\u628a $v$ \u52a0\u5230\u6700\u540e\uff09\u3002\u56e0\u800c\u53ef\u4ee5\u5c06 $f_S$ \u52a0\u4e0a $f_{S-\\{v\\}}$\u3002\u5f88\u663e\u7136\uff0c\u8fd9\u8986\u76d6\u4e86\u6240\u6709\u53ef\u80fd\u7684\u60c5\u51b5\u3002\n\n\u4e0b\u9762\u56de\u5230\u672c\u9898\uff1a\n\n> (**2021\u96c6\u8bad\u961f\u4f5c\u4e1a P7024 \u3010[NWRRC2017]Fygon 2.0\u3011**)\u7ed9\u5b9a $m$ \u5c42\u5d4c\u5957\u7684 `for` \u5faa\u73af\u8bed\u53e5\uff0c\u6bcf\u4e2a\u5faa\u73af\u5305\u542b\u5faa\u73af\u53d8\u91cf\u548c\u4e0a\u4e0b\u754c\uff0c\u5176\u4e2d\u4e0a\u4e0b\u754c\u662f\u5916\u5c42\u53d8\u91cf\u6216 $1$ \u548c $n$\uff0c\u6c42\u5173\u4e8e $n$ \u7684\u6e10\u8fdb\u590d\u6742\u5ea6\u548c\u6700\u9ad8\u6b21\u9879\u7cfb\u6570\uff08\u5e38\u6570\uff09\u3002\u6700\u5185\u5c42\u662f\u4e00\u4e2a\u8bed\u53e5 `lag`\uff0c\u5176\u590d\u6742\u5ea6\u88ab\u8ba4\u4e3a\u662f $O(1)$\u3002\n\n\u5bf9\u6240\u6709\u6d89\u53ca\u5230\u7684\u53d8\u91cf\u548c\u4e0a\u4e0b\u754c\u90fd\u5efa\u7acb\u7ed3\u70b9\uff08\u6574\u6570\u53d8\u91cf\uff09 $\\{u_k\\}$\uff0c\u5c06\u4e00\u4e2a `for ui in range(uj,uk)` \u7684\u5faa\u73af\u89c6\u4e3a\u4e24\u4e2a\u6574\u6570\u4e0d\u7b49\u5f0f $u_j\\le u_i\\le u_k$\u3002\u5219 `lag` \u7684\u6267\u884c\u6b21\u6570\u5c31\u7b49\u4e8e\u8be5\u4e0d\u7b49\u5f0f\u7ec4\u7684\u6b63\u6574\u6570\u89e3\u6570\u3002\n\n\u8003\u8651\u5efa\u7acb\u56fe\u8bba\u6a21\u578b\uff0c\u82e5 `for` \u5faa\u73af\u4e2d\u6709 $u_i\\le u_j$ \u7684\u7ea6\u675f\uff08\u82e5\u5176\u4e2d\u6709 $1$ \u6216 $n$\uff0c\u89c6\u4e3a\u6ca1\u6709\u7ea6\u675f\uff09\uff0c\u5219\u5efa\u8fb9 $u_i\\rightarrow u_j$\u3002\u5bf9\u8be5\u56fe\u8fdb\u884c\u7f29\u70b9\uff0c\u5f62\u6210\u4e00\u4e2a\u7531 SCC\uff08\u5f3a\u8fde\u901a\u5206\u91cf\uff09 \u7ec4\u6210\u7684 DAG\u3002\u6613\u89c1\u6bcf\u4e2a SCC \u4e2d\u6240\u6709\u70b9\u7684\u53d6\u503c\u90fd\u662f\u76f8\u540c\u7684\uff0c\u4e0d\u59a8\u8bbe\u4e3a $v_1,v_2,...,v_k$\uff08\u4e00\u5171\u6709 k \u4e2a SCC\uff09\u3002\u6211\u4eec\u53ea\u8981\u6c42\u51fa\u4e86\u8be5 DAG \u7684\u4e00\u4e2a\u62d3\u6251\u5e8f\uff0c\u5219\u4ece\u5c0f\u5230\u5927\u968f\u610f\u7ed9 $v_1,...,v_k$ \u8d4b\u503c\u4e3a $[1..n]$ \u4e2d\u7684\u4e92\u4e0d\u76f8\u540c\u7684\u6574\u6570\uff0c\u4fbf\u5f97\u5230\u4e86\u8be5\u62d3\u6251\u5e8f\u5bf9\u5e94\u7684 $\\binom nk$ \u7ec4\u89e3\uff0c\u4e8e\u662f\u603b\u6267\u884c\u6b21\u6570\u5c31\u662f $N\\binom nk$\uff0c\u5176\u4e2d $N$ \u662f\u62d3\u6251\u5e8f\u4e2a\u6570\u3002\u4ece\u800c\u6e10\u8fdb\u590d\u6742\u5ea6\u5c31\u662f $O(n^k)$\u3002\u5e38\u6570\u9879\u4e3a $\\lim_{n\\rightarrow\\infty}N\\binom nk/n^k=N/k!$\u3002\n\n\u8fd9\u91cc $N$ \u5c31\u53ef\u4ee5\u7528\u4e0a\u8ff0\u7684\u65b9\u6cd5\uff0c\u72b6\u538b DP \u6c42\u51fa\u3002\n\n```cpp\n#define ctz __builtin_ctz\nconst int S = 1048586;\nint m, tab[128], tot;\nll f[S];\ninline int newnode(int x) {\n\treturn (x == '0' || x == 'n' ? 0 : tab[x] ? tab[x] : tab[x] = ++tot) - 1;\n}\nint eg[21], eg_[S], dfn[21], low[21], tim, ins, cnt = -1, rt[21];\nstack<int>stk;\nvoid tarjan(int x) {\n\tdfn[x] = low[x] = ++tim, stk.push(x), ins |= 1 << x;\n\tfor (int v, i = eg[x]; i; i &= i - 1)\n\t\tif (!dfn[v = ctz(i)]) tarjan(v), low[x] = min(low[x], low[v]);\n\t\telse if (ins >> v & 1) low[x] = min(low[x], dfn[v]);\n\tif (dfn[x] == low[x]) {\n\t\t++cnt; int y;\n\t\tdo y = stk.top(), rt[y] = cnt, ins &= ~(1 << y), stk.pop(); while (y != x);\n\t}\n}\nint main() {\n\tfreopen(\"1.in\", \"r\", stdin);\n\tm = rd();\n\tfor (int i = 1; i <= m; ++i) {\n\t\tchar ch = gtc();\n\t\twhile (ch != 'f' && ch != 'l') ch = gtc();\n\t\tif (ch == 'f') {\n\t\t\tgtc(); gtc(); int x = gtc();\n\t\t\tgtc(); gtc(); gtc(); gtc(); gtc(); gtc(); gtc(); gtc();\n\t\t\tint l = gtc(); gtc(); int r = gtc();\n\t\t\tx = newnode(x), l = newnode(l), r = newnode(r);\n\t\t\tif (~l) eg[l] |= 1 << x;\n\t\t\tif (~r) eg[x] |= 1 << r;\n\t\t}\n\t}\n\tfor (int i = 0; i < tot; ++i)\n\t\tif (!dfn[i]) tarjan(i);\n\tfor (int i = 0; i < tot; ++i)\n\t\tfor (int j = eg[i], v; j; j &= j - 1)\n\t\t\tif (rt[i] != rt[v = ctz(j)])\n\t\t\t\teg_[rt[i]] |= 1 << rt[v];\n\tll fac = 1;\n\tfor (int i = 2; i <= cnt; ++i) fac *= i;\n\tf[0] = 1;\n\tfor (int i = 1, all = ~(-1 << cnt); i <= all; ++i)\n\t\tfor (int j = i, v; j; j &= j - 1)\n\t\t\tif (!(eg_[v = ctz(j)] & i)) f[i] += f[i & ~(1 << v)];\n\tll fs = f[~(-1 << cnt)], g = __gcd(fs, fac);\n\tprintf(\"%d %lld/%lld\", cnt, fs / g, fac / g);\n\treturn 0;\n}\n```",
        "postTime": 1635751565,
        "uid": 75765,
        "name": "Starlight237",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7024 \u3010[NWRRC2017]Fygon 2.0\u3011"
    },
    {
        "content": "![](https://cdn.luogu.com.cn/upload/image_hosting/tr9vtl7f.png)\n\n\u819c\u62dc $\\text{h}\\textcolor{red}{\\text{ehezhou}}$ \uff01\n\n## \u9898\u89e3\n\n\u4f60\u53d1\u73b0\u76f8\u5f53\u4e8e\u662f\u7ed9\u8fd9 $m$ \u4e2a\u53d8\u91cf\u8fdb\u884c\u67d3\u8272\uff0c\u6bcf\u4e00\u4e2a\u5faa\u73af\u8bed\u53e5\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2a\u5927\u5c0f\u7684\u9650\u5236\u6bd4\u5982\u8bf4 $j\\le i\\le k$ \u4e4b\u7c7b\u7684\uff0c\u7136\u540e\u95ee\u4f60\u67d3\u8272\u7684\u65b9\u6848\u6570\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e\u4e00\u4e2a $i\\le j$ \uff0c\u6211\u4eec\u53ef\u4ee5\u5efa\u4e00\u6761\u6709\u5411\u8fb9 $i->j$ \uff0c\u8868\u793a\u5728\u904d\u5386\u8fd9\u5f20\u56fe\u7684\u65f6\u5019 $i$ \u9700\u8981\u51fa\u73b0\u5728 $j$ \u7684\u524d\u9762\uff0c\u7136\u540e\u53d1\u73b0\u5bf9\u4e8e\u5176\u4e2d\u7684\u5f3a\u8fde\u901a\u5206\u91cf\uff0c\u4ed6\u5fc5\u987b\u662f\u5168\u90e8\u76f8\u540c\u7684\uff0c\u4f60\u5c31\u76f4\u63a5\u7f29\u70b9\u5373\u53ef\uff0c\u7136\u540e\u5269\u4e0b\u7684\u5c31\u662f\u4e00\u4e2a $DAG$ \u3002\n\n\u7136\u540e\u5c31\u53d8\u6210\u4e86 $DAG$ \u4e0a\u7684\u67d3\u8272\u65b9\u6848\u6570\uff0c\u8fd9\u4e2a\u4e1c\u897f\u597d\u50cf\u53ef\u4ee5\u72b6\u538b~~\uff0c\u5177\u4f53\u660e\u5929\u5728\u60f3\u5427\uff0c\u6211\u56f0\u4e86~~\u3002\n\n---\n\n\u7531\u4e8e\u6211\u4eec\u8003\u8651\u7684\u662f\u6e10\u8fdb\u590d\u6742\u5ea6\uff0c\u6240\u4ee5\u867d\u7136\u5bf9\u4e8e\u4e00\u4e2a\u9650\u5236 $i\\le j$ \u5b58\u5728 $i=j$ \u7684\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u7528\u8003\u8651\uff0c\u56e0\u4e3a\u4ed6\u5728\u5176\u4e2d\u6240\u5360\u7684\u6bd4\u4f8b\u8fc7\u4e8e\u5c0f\uff0c\u76f8\u5bf9\u4e8e\u6781\u9650\u6765\u8bf4\u3002\u4e8e\u662f\u9898\u76ee\u5c31\u53d8\u6210\u4e86\u4e00\u5f20 $DAG$ \u7684 $top$ \u5e8f\u6570\u91cf\u3002\uff08\u6211\u5728\u60f3\u662f\u4e0d\u662f\u8003\u8651\u4e86\u5c31\u9519\u4e86\uff1f\u4e0d\u662f\u5f88\u660e\u767d\u3002\u3002\u3002\uff09\n\n \u6211\u4eec\u8003\u8651\u72b6\u538b $dp$ \uff0c\u8bbe $f_i$ \u8868\u793a\u5728\u5df2\u7ecf\u8bbf\u95ee\u8fc7\u7684\u70b9\u7684\u72b6\u6001\u4e3a $i$ \u7684\u65f6\u5019\uff0c\u5176 $top$ \u5e8f\u6570\u91cf\u662f\u591a\u5c11\u3002\u7136\u540e\u62ff\u5934\u786c\u8f6c\u79fb\u5c31\u53ef\u4ee5\u4e86\u5427\u3002\n\n## \u4ee3\u7801\u5982\u4e0b\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nconst int N=25;\nint n=0,m;char s[N];\nint id[256];\nstruct Graph{\n\tstruct Edge{int nxt,from,to;}e[N<<1];int fir[N],size=0;\n\tvoid add(int u,int v){e[++size]=(Edge){fir[u],u,v},fir[u]=size;}\n}g1,g2;\nint bel[N],tot=0;\nint dfn[N],low[N],cnt=0;\nstack<int> h;bool vis[N];\nvoid tarjan(int u){\n\tdfn[u]=low[u]=++cnt;\n\tvis[u]=true,h.push(u);\n\tfor(int i=g1.fir[u];i;i=g1.e[i].nxt){\n\t\tif(!dfn[g1.e[i].to]){\n\t\t\ttarjan(g1.e[i].to);\n\t\t\tlow[u]=min(low[u],low[g1.e[i].to]);\n\t\t}\n\t\telse if(vis[g1.e[i].to]) low[u]=min(low[u],dfn[g1.e[i].to]);\n\t}\n\tif(dfn[u]==low[u]){\n\t\t++tot;\n\t\twhile(h.top()!=u)\n\t\tvis[h.top()]=false,bel[h.top()]=tot,h.pop();\n\t\tvis[h.top()]=false,bel[h.top()]=tot,h.pop();\n\t}\n}\nint f[1<<N],deg[N];\nint gcd(int a,int b){return b==0?a:gcd(b,a%b);}\nsigned main(){\n\tcin>>m;\n\tfor(int i=1;i<m;++i){\n\t\tscanf(\"%s\",s+1),scanf(\"%s\",s+1),id[(int)s[1]]=++n;\n\t\tscanf(\"%s\",s+1),scanf(\"%s\",s+1);\n\t\tif('a'<=s[7]&&s[7]<='z') g1.add(id[(int)s[7]],n);\n\t\tscanf(\"%s\",s+1);\n\t\tif('a'<=s[1]&&s[1]<='z'&&s[1]!='n') g1.add(n,id[(int)s[1]]);\n\t}\n\tscanf(\"%s\",s+1);\n\tfor(int i=1;i<=n;++i){\n\t\tif(dfn[i]) continue;\n\t\ttarjan(i);\n\t}\n\tfor(int i=1;i<=g1.size;++i){\n\t\tif(bel[g1.e[i].from]!=bel[g1.e[i].to]){\n\t\t\tg2.add(bel[g1.e[i].to],bel[g1.e[i].from]);\n\t\t}\n\t}\n\tprintf(\"%lld \",tot);\n\tf[0]=1;\n\tfor(int now=0;now<(1<<tot);++now){\n\t\tfor(int i=1;i<=tot;++i){\n\t\t\tif(now&(1<<(i-1))) continue;\n\t\t\tbool flag=true;\n\t\t\tfor(int j=g2.fir[i];j;j=g2.e[j].nxt){\n\t\t\t\tflag&=(bool)(now&(1<<(g2.e[j].to-1)));\n\t\t\t}\n\t\t\tif(!flag) continue;\n\t\t\t// printf(\"%lld %lld %lld %lld\\n\",now,i,now|(1<<(i-1)),f[now]);\n\t\t\tf[now|(1<<(i-1))]+=f[now];\n\t\t}\n\t}\n\tint tmp,res=1;\n\tfor(int i=1;i<=tot;++i) res*=i;\n\ttmp=gcd(res,f[(1<<tot)-1]);\n\tprintf(\"%lld/%lld\\n\",f[(1<<tot)-1]/tmp,res/tmp);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1609764564,
        "uid": 72468,
        "name": "\u300c\u3000\u300d",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7024 \u3010[NWRRC2017]Fygon 2.0\u3011"
    }
]