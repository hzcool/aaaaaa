[
    {
        "content": "\u8fd9\u662f\u4e00\u9053\u7ecf\u5178\u7684\u659c\u7387\u4f18\u5316\u5165\u95e8\u9898\uff0c\u5c31\u7528\u8fd9\u9898\u6765\u4f5c\u4e2a\u603b\u7ed3\u597d\u4e86\n\n\u524d\u8a00\uff1a\u659c\u7387\u4f18\u5316\u7684\u601d\u60f3\u5176\u5b9e\u548c\u9ad8\u4e2d\u6570\u5b66\u7684\u7ebf\u6027\u89c4\u5212\u6709\u76f8\u4f3c\u4e4b\u5904\uff0c\u56e0\u6b64\u5efa\u8bae\u6ca1\u5b66\u8fc7\u7684\u540c\u5b66\u5148\u4e86\u89e3\u4e00\u4e0b\u7ebf\u6027\u89c4\u5212\n\n\n\u9996\u5148\u63d0\u4e00\u4e0b\u5355\u8c03\u961f\u5217\u4f18\u5316\uff1a\n\n\u5f53dp\u65b9\u7a0b\u4e3a$dp[i]=a[i]+b[j]$\u65f6\uff0c\u8fd9\u4e2a\u65b9\u7a0b\u662f$O(n^2)$\u7684\n\n\u8fd9\u65f6\u7528\u5355\u8c03\u961f\u5217\u53ef\u4ee5\u5c06\u5176\u4f18\u5316\u4e3a$O(n)$\uff0c\u5177\u4f53\u65b9\u6cd5\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\n\n\u800cdp\u65b9\u7a0b\u4e3a$dp[i]=a[i] \\cdot b[j]+c[i]+d[j]$\u65f6\uff0c\u7531\u4e8e\u5b58\u5728$a[i] \\cdot b[j]$\u8fd9\u4e2a\u65e2\u6709$i$\u53c8\u6709$j$\u7684\u9879\uff0c\u4ee5\u4e0a\u65b9\u6cd5\u5c31\u4e0d\u9002\u7528\u4e86\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u4f7f\u7528\u659c\u7387\u4f18\u5316\n\n\u56de\u5230\u672c\u9898\uff0c\u8bbe\u524d\u7f00\u548c\u4e3a$sum[i]$\uff0c\u7531\u9898\u610f\u6613\u5f97dp\u65b9\u7a0b\uff1a\n\n$$dp[i]=min(dp[j]+(sum[i]+i-sum[j]-j-L-1)^2)  (j<i)$$\n\n\u4f46\u8fd9\u4e2a\u65b9\u7a0b\u662f$O(n^2)$\u7684\uff0c\u663e\u7136\u4e0d\u6ee1\u8db3\u8981\u6c42\uff0c\u56e0\u6b64\u9700\u8981\u8fdb\u884c\u4f18\u5316\n\n\uff08\u4ee5\u4e0b\u79f0\u4e24\u70b9\u659c\u7387\u4e3a$slope(A,B)$\uff09\n\n\u4ee4$a[i]=sum[i]+i$\uff0c$b[i]=sum[i]+i+L+1$\uff08\u8fd9\u4e00\u6b65\u662f\u4e3a\u4e86\u7b80\u5316\u8ba1\u7b97\uff09\n\n\u5219\n$$dp[i]=dp[j]+(a[i]-b[j])^2$$\n\n\u5c55\u5f00\u5f97\n\n$$dp[i]=dp[j]+a[i]^2-2 \\cdot a[i] \\cdot b[j]+b[j]^2$$\n\n\u79fb\u9879\u5f97\n\n$$2 \\cdot a[i] \\cdot b[j]+dp[i]-a[i]^2=dp[j]+b[j]^2$$\n\n\u5c06$b[j]$\u770b\u4f5c$x$\uff0c$dp[j]+b[j]^2$\u770b\u4f5c$y$\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u53ef\u4ee5\u770b\u4f5c\u4e00\u6761\u659c\u7387\u4e3a$2 \\cdot a[i]$\u7684\u76f4\u7ebf\n\n\u800c\u5bf9\u4e8e\u6bcf\u4e2a$i$\u6765\u8bf4\uff0c$a[i]$\u90fd\u662f\u786e\u5b9a\u7684\n\n\u63a5\u4e0b\u6765\u7684\u6b65\u9aa4\u548c\u7ebf\u6027\u89c4\u5212\u5f88\u76f8\u4f3c\n\n$dp[i]$\u7684\u542b\u4e49\u8f6c\u5316\u4e3a\uff1a\u5f53\u4e0a\u8ff0\u76f4\u7ebf\u8fc7\u70b9$P(b[j],dp[j]+b[j]^2)$\u65f6\uff0c\u76f4\u7ebf\u5728$y$\u8f74\u7684\u622a\u8ddd\u52a0\u4e0a$a[i]^2$\uff08\u4e00\u4e2a\u5b9a\u503c\uff09\n\n\u800c\u9898\u76ee\u5373\u4e3a\u627e\u8fd9\u4e2a\u622a\u8ddd\u7684\u6700\u5c0f\u503c\n\n\u56e0\u6b64\uff0c\u7c7b\u4f3c\u7ebf\u6027\u89c4\u5212\uff0c\u6211\u4eec\u5c06\u8fd9\u6761\u76f4\u7ebf\u4ece\u4e0b\u5f80\u4e0a\u5e73\u79fb\uff0c\u76f4\u5230\u8fc7\u4e00\u4e2a\u7b26\u5408\u8981\u6c42\u7684\u70b9\u65f6\u505c\u4e0b\uff0c\u6b64\u65f6\u622a\u8ddd\u5373\u4e3a\u6700\u5c0f\n\n\u753b\u51fa\u56fe\u50cf\u5982\u4e0b\uff08\u7ea2\u8272\u4e3a\u76ee\u6807\u76f4\u7ebf\uff09\n\n ![](https://cdn.luogu.com.cn/upload/pic/13267.png) \n\n\u7ed3\u5408\u56fe\u50cf\u5206\u6790\u53ef\u77e5\uff0c\u672c\u9898\u4e2d\u53ef\u80fd\u4e3a\u6700\u4f18\u7684$P$\u70b9\uff08\u56fe\u4e2d\u7528\u76f4\u7ebf\u8fde\u63a5\uff09\u7ec4\u6210\u4e86\u4e00\u4e2a\u4e0b\u51f8\u5305\uff08\u5176\u4ed6\u9898\u76ee\u53ef\u80fd\u4e0d\u540c\uff0c\u7ed3\u5408\u56fe\u50cf\u5177\u4f53\u5206\u6790\uff09\n\n\u663e\u7136\uff0c\u51f8\u5305\u4e2d\u76f8\u90bb\u4e24\u70b9\u659c\u7387\u662f\u5355\u8c03\u9012\u589e\u7684\n\n\u800c\u76ee\u6807\u76f4\u7ebf\u7684\u659c\u7387$2 \\cdot a[i]$\u4e5f\u662f\u5355\u8c03\u9012\u589e\u7684\n\n\u7531\u56fe\u50cf\u53c8\u6613\u77e5\uff0c\u6ee1\u8db3\u6761\u4ef6\u7684\u6700\u4f18$P_j$\u4e3a\u7b2c\u4e00\u4e2a$slope(P_j,P_{j+1}) > 2 \\cdot a[i]$\u7684\u70b9\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u8fd9\u4e2a\u51f8\u5305\uff1a\n\n\u8bbe\u961f\u9996\u4e3a$head$\uff0c\u961f\u5c3e\u4e3a$tail$\n\n1. \u5bf9\u961f\u9996\uff1a\n\n$$while(slope(P_{head},P_{head+1})<2 \\cdot a[i])\\quad  head++$$\n\n2. \u6b64\u65f6\u961f\u9996\u7684\u70b9\u5373\u4e3a\u6700\u4f18\uff0c\u6839\u636e\u5b83\u8ba1\u7b97\u51fa$dp[i]$\n\n3. \u5bf9\u961f\u5c3e\uff1a\n\n$$while(slope(P_{tail-1},P_{tail})>slope(P_{tail-1},P_i)\\quad tail--$$\n\n4. \u5728\u961f\u5c3e\u63d2\u5165$P_i$\n\n\u89e3\u91ca\uff1a\n\n\u82e5$slope(P_j,P_{j+1})<2 \\cdot a[i]$\uff0c\u663e\u7136$P_j$\u4e0d\u662f\u6700\u4f18\u901a\u8fc7\u6b65\u9aa41\u5220\u53bb\n\n\u56e0\u4e3a\u76ee\u6807\u76f4\u7ebf\u659c\u7387\u5355\u8c03\u9012\u589e\uff0c\u6240\u4ee5\u5f53\u524d\u5220\u53bb\u7684$P_j$\u4e00\u5b9a\u5bf9\u4e4b\u540e\u7684$dp[i]$\u4e5f\u4e0d\u662f\u6700\u4f18\uff0c\u4e0d\u4f1a\u9020\u6210\u5f71\u54cd\n\n\u800c\u64cd\u4f5c3\u7684\u7406\u7531\u5982\u4e0b\uff1a\n\n ![](https://cdn.luogu.com.cn/upload/pic/13443.png) \n\n\u56fe\u4e2d\u7ea2\u8272\u7684\u70b9\u4e3a$P_i$\n\n\u663e\u7136\uff0c\u6ee1\u8db3\u64cd\u4f5c3\u7684\u8981\u6c42\u65f6\uff0c$P_{tail}$\u5728\u51f8\u5305\u5185\u90e8\uff0c\u4e00\u5b9a\u4e0d\u662f\u6700\u4f18\uff0c\u56e0\u6b64\u53ef\u4ee5\u5220\u53bb\n\n\u4ee5\u4e0a\u5373\u4e3a\u672c\u9898\u7b97\u6cd5\n\n\u8981\u6ce8\u610f\uff0c\u521d\u59cb\u5316\u65f6\u8981\u52a0\u5165\u5355\u8c03\u961f\u5217\u7684\u70b9\u4e3a$P_0$\u800c\u4e0d\u662f$P_1$\uff08\u5426\u5219\u5c31\u53d8\u6210\u4e86\u7b2c\u4e00\u4e2a\u7269\u54c1\u5fc5\u987b\u5355\u72ec\u88c5\uff09\n\n\n\u4ee3\u7801\uff1a\n\n\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\nusing namespace std;\ntypedef double db;\ntypedef long long LL;\nconst int maxn=50010;\nint n,L;\ndb sum[maxn],dp[maxn];\nint head,tail,Q[maxn];\ninline db a(int i){return sum[i]+i;}\ninline db b(int i){return a(i)+L+1;}\ninline db X(int i){return b(i);}\ninline db Y(int i){return dp[i]+b(i)*b(i);}\ninline db slope(int i,int j){return (Y(i)-Y(j))/(X(i)-X(j));}\nint main(){\n    scanf(\"%d%d\",&n,&L);\n    for(int i=1;i<=n;i++){\n        scanf(\"%lf\",&sum[i]);\n        sum[i]+=sum[i-1];\n    }\n    head=tail=1;\n    for(int i=1;i<=n;i++){\n        while(head<tail&&slope(Q[head],Q[head+1])<2*a(i)) ++head;\n        dp[i]=dp[Q[head]]+(a(i)-b(Q[head]))*(a(i)-b(Q[head]));\n        while(head<tail&&slope(i,Q[tail-1])<slope(Q[tail-1],Q[tail])) --tail;\n        Q[++tail]=i;\n    }\n    printf(\"%lld\\n\",(LL)dp[n]);\n    return 0;\n}\n\n```",
        "postTime": 1516255674,
        "uid": 32837,
        "name": "hhz6830975",
        "ccfLevel": 0,
        "title": "P3195 [HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\uff08\u659c\u7387\u4f18\u5316\u5165\u95e8\uff09"
    },
    {
        "content": "# **\u3010\u5b66\u4e60\u7b14\u8bb0\u3011\u52a8\u6001\u89c4\u5212\u2014\u659c\u7387\u4f18\u5316DP\uff08\u8d85\u8be6\u7ec6\uff09**\n\n$update\\ 2020.6.19:$ \u4e34\u8fd1\u9000\u5f79\uff0c\u7ec8\u4e8e\u6765\u4fee\u9505\u5566QAQ\uff08\u66f4\u6b63\u57fa\u7840\u6982\u5ff5\u4e0a\u7684\u9519\u8bef\uff1b$\\text{Latex}$ \u89c4\u8303\u5316\uff1b\u91cd\u65b0\u6392\u7248\uff1b\u589e\u52a0\u6807\u9898\u53f7\uff1b\u6dfb\u52a0\u3010\u5173\u4e8e\u5355\u8c03\u6027\u7684\u7814\u7a76\u3011\uff1b\u6dfb\u52a0 $\\text{CDQ}$ \u7ef4\u62a4\u659c\u7387\u4f18\u5316\u7684\u4f8b\u5b50\uff09\n\n[$\\mathcal{My}\\ \\mathcal{Blog}$](https://www.cnblogs.com/Xing-Ling/p/11210179.html)\n\n**[\u3010\u5b66\u4e60\u7b14\u8bb0\u3011\u52a8\u6001\u89c4\u5212\u2014\u5404\u79cd $\\text{DP}$ \u4f18\u5316](https://www.luogu.com.cn/blog/ChenXingLing/post-xue-xi-bi-ji-dong-tai-gui-hua-ge-zhong-dp-you-hua)**\n\n## **\u3010\u524d\u8a00\u3011**\n\n\u7b2c\u4e00\u6b21\u5199\u8fd9\u4e48\u957f\u7684\u6587\u7ae0\u3002\n\n\u5199\u5b8c\u540e\u5bf9\u659c\u4f18\u7684\u7406\u89e3\u53c8\u52a0\u6df1\u4e86\u4e0d\u5c11\uff08$update\\ 2020.6.19:$ \u56de\u8fc7\u5934\u6765\u770b\u8fd9\u53e5\u8bdd\u6ee1\u662f\u8bbd\u523a\u554a\uff0c\u660e\u660e\u8fd9\u65f6\u5019\u8fde\u57fa\u672c\u7684\u6982\u5ff5\u90fd\u6ca1\u6709\u7406\u6e05....\uff09\u3002\n\n\u672c\u6587\u8bb2\u89e3\u8f83\u8be6\uff0c\u53ea\u8981\u8010\u5fc3\u8bfb\u4e0b\u53bb\uff0c\u76f8\u4fe1\u5927\u90e8\u5206 $\\text{OIer}$ \u90fd\u80fd\u770b\u61c2\u3002\n\n\u659c\u7387\u4f18\u5316 $\\text{dp}$\uff0c\u987e\u540d\u601d\u4e49\u5c31\u662f\u5229\u7528\u659c\u7387\u76f8\u5173\u6027\u8d28\u5bf9 $\\text{dp}$ \u8fdb\u884c\u4f18\u5316\u3002\n\n\u659c\u7387\u4f18\u5316\u901a\u5e38\u53ef\u4ee5\u7531\u4e24\u79cd\u65b9\u5f0f\u6765\u7406\u89e3\uff0c\u9700\u8981\u7075\u6d3b\u5730\u8fd0\u7528\u6570\u5b66\u4e0a\u7684**\u6570\u5f62\u7ed3\u5408,\u7ebf\u6027\u89c4\u5212**\u601d\u60f3\u3002\n\n\u5bf9\u4e8e\u8fd9\u6837\u5f62\u5f0f\u7684 $\\text{dp}$ \u65b9\u7a0b\uff1a$dp[i]=\\min/ \\max(a[i]\\times b[j]+c[j]+d[i])$\uff0c\u5176\u4e2d $b$ \u4e25\u683c\u5355\u8c03\u9012\u589e\u3002\n\n\u8be5\u65b9\u7a0b\u7684\u5173\u952e\u70b9\u5728\u4e8e $a[i]\\times b[j]$ \u8fd9\u4e00\u9879\uff0c\u5b83\u65e2\u6709 $i$ \u53c8\u6709 $j$\uff0c\u4e8e\u662f\u5355\u8c03\u961f\u5217\u4f18\u5316\u4e0d\u518d\u9002\u7528\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528\u659c\u7387\u4f18\u5316\u3002\n\n---------\n\n## **\u4e00.\u3010\u7406\u89e3\u65b9\u5f0f\u3011**\n\n\u4ee5 [**\u3010\u6a21\u677f\u3011** \u73a9\u5177\u88c5\u7bb1 $\\text{toy [P3195]}$](https://www.luogu.org/problemnew/show/P3195) \u4e3a\u4f8b\uff0c\u4e24\u79cd\u659c\u4f18\u7684\u7406\u89e3\u65b9\u5f0f\u3002\n\n\u8bbe $S[n]=\\sum_{i=1}^n(C[i]+1)$\uff0c\u7528 $dp[i]$ \u8868\u793a\u88c5\u597d\u524d $i$ \u4e2a\u7684\u6700\u5c0f\u82b1\u8d39\uff0c\u5219\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a$dp[i]=\\min(dp[j]+(S[i]-S[j]-1-L)^2)$\u3002\n\n\u4e3a\u65b9\u4fbf\u63cf\u8ff0\uff0c\u5c06 $\\text{L}$ \u63d0\u524d\u52a0 $1$\uff0c\u518d\u628a $\\min$ \u53bb\u6389\uff0c\u5f97\u5230\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a$dp[i]=dp[j]+(S[i]-S[j]-L)^2$\u3002\n\n\u5316\u7b80\u5f97\uff1a$dp[i]=S[i]^2-2S[i]L+dp[j]+(S[j]+L)^2-2S[i]S[j]$\n\n### **1.\u3010\u4ee3\u6570\u6cd5\uff08\u6570\u5f62\u7ed3\u5408\uff09\u3011**\n\n\u53ea\u542b $\\text{L}$ \u7684\u9879\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $i$ \u7684**\u62e9\u4f18\u7b5b\u9009**\u8fc7\u7a0b\u90fd\u662f\u5b8c\u5168\u4e00\u6837\u7684\u503c\uff0c\u53ea\u542b $Function(i)$ \u7684\u9879\u5728\u4e00\u6b21 $i$ \u7684**\u62e9\u4f18\u7b5b\u9009**\u8fc7\u7a0b\u4e2d\u4e0d\u53d8\uff0c\u542b $Function(j)$ \u7684\u9879\u53ef\u80fd\u4f1a\u4e0d\u65ad\u53d8\u5316\uff08\u5728\u672c\u9898\u4e2d\u8868\u73b0\u4e3a\u4e3a**\u4e25\u683c\u5355\u589e**\uff09\u3002  \n\u6211\u4eec\u4ee5\u6b64\u4e3a\u5212\u5206\u4f9d\u636e\uff0c\u628a\u540c\u7c7b\u578b\u7684\u9879\u7528\u62ec\u53f7\u62ec\u8d77\u6765\uff0c\u5373\uff1a$dp[i]=(-2S[i]S[j])+(dp[j]+(S[j]+L)^2)+(S[i]^2-2S[i]L)$\n\n#### **(1).\u3010\u7ef4\u62a4\u4e00\u4e2a\u51f8\u5305\u3011**\n\n\u8bbe $j_1,j_2$ $(0 \\leqslant j_1<j_2<i)$ \u4e3a $i$ \u7684\u4e24\u4e2a\u51b3\u7b56\u70b9\uff0c\u4e14\u6ee1\u8db3**\u51b3\u7b56\u70b9 $j_2$ \u4f18\u4e8e $j_1$**\uff0c\n\u6709\uff1a$(-2S[i]S[j_2])+(dp[j_2]+(S[j_2]+L)^2)+(S[i]^2-2S[i]L) \\leqslant (-2S[i]S[j_1])+(dp[j_1]+(S[j_1]+L)^2)+(S[i]^2-2S[i]L)$\n\n\u5373\uff1a$(-2S[i]S[j_2])+(dp[j_2]+(S[j_2]+L)^2) \\leqslant (-2S[i]S[j_1])+(dp[j_1]+(S[j_1]+L)^2)$\n\n**\u5212\u91cd\u70b9\uff1a\u6b64\u5904\u79fb\u9879\u9700\u8981\u9075\u5faa\u7684\u539f\u5219\u662f\uff1a\u53c2\u53d8\u5206\u79bb\u3002\u5c06 $Function(i)$ \u89c6\u4f5c\u672a\u77e5\u91cf\uff0c\u7528  $Function(j)$ \u6765\u8868\u793a\u51fa $Function(i)$ \u3002**\n\n> \u79fb\u9879\u5f97\uff1a$-2S[i](S[j_2]-S[j_1]) \\leqslant (dp[j_1]+(S[j_1]+L)^2)-(dp[j_2]+(S[j_2]+L)^2)$  \n$\\because C[j] \\geqslant 1$  \n$\\therefore S[j+1] > S[j]$  \n$\\text{\u53c8} \\because j_2 > j_1$  \n$\\therefore S[j_2]-S[j_1]>0$  \n$\\therefore 2S[i] \\geqslant \\frac {(dp[j_2]+(S[j_2]+L)^2)-(dp[j_1]+(S[j_1]+L)^2)} {S[j_2]-S[j_1]}$  \n\u8bbe $Y(j)=dp[j]+(S[j]+L)^2,X(j)=S[j]$\uff0c\n\u5373 $2S[i] \\geqslant \\frac {Y(j_2)-Y(j_1)} {X(j_2)-X(j_1)}$\n\n\u663e\u7136\u7b49\u5f0f\u53f3\u8fb9\u662f\u4e00\u4e2a\u5173\u4e8e\u70b9 $P(j_2)$ \u548c $P(j_1)$ \u7684\u659c\u7387\u5f0f\uff0c\u5176\u4e2d $P(j)=(X(j),Y(j))=(S[j],dp[j]+(S[j]+L)^2)$\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u5b58\u5728\u4e24\u4e2a\u51b3\u7b56\u70b9 $j_1,j_2$ \u6ee1\u8db3 $(0 \\leqslant j_1<j_2<i)$\uff0c\u4f7f\u5f97\u4e0d\u7b49\u5f0f $\\frac {Y(j_2)-Y(j_1)} {X(j_2)-X(j_1)} \\leqslant 2S[i]$ \u6210\u7acb\uff0c\u6216\u8005\u8bf4 \u4f7f\u5f97 $P(j_2),P(j_1)$ \u4e24\u70b9\u6240\u5f62\u6210\u76f4\u7ebf\u7684\u659c\u7387\u5c0f\u4e8e\u7b49\u4e8e $2S[i]$\uff0c\u90a3\u4e48**\u51b3\u7b56\u70b9 $j_2$ \u4f18\u4e8e $j_1$**\u3002\n\n> **\u5212\u91cd\u70b9\uff1a\u659c\u4f18\u7075\u6d3b\u591a\u53d8\uff0c\u7ec6\u8282\u9ebb\u70e6\u4e5f\u591a\uff0c\u6240\u4ee5\u5c3d\u91cf\u5c06\u95ee\u9898\u6a21\u5f0f\u5316\u3002**  \n\u6bd4\u5982\u8fd9\u91cc\u7684\u6700\u7ec8\u516c\u5f0f\uff0c\u5c3d\u91cf\u5316\u4e3a $\\frac {(j)-(j')} {(j)-(j')}$ \u7684\u5f62\u5f0f\uff0c\u800c\u4e0d\u662f $\\frac {(j)-(j')} {(j')-(j)}$ \uff0c\u867d\u7136\u76f4\u63a5\u505a\u4e00\u822c\u4e5f\u4e0d\u4f1a\u51fa\u4ec0\u4e48\u95ee\u9898\uff0c\u4f46\u8fd9\u6837\u5b50\u53ef\u4ee5\u65b9\u4fbf\u7406\u89e3\uff0c\u65b9\u4fbf\u5224\u65ad\u51f8\u5305\u65b9\u5411\u7b49\u7b49\u3002\n\n\u5047\u8bbe\u6709\u9171\u7d2b\u7684\u4e09\u4e2a\u70b9 $P(j_1),P(j_2),P(j_3)$\uff0c$k_1,k_2$ \u4e3a\u659c\u7387\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u60c5\u51b5\uff08\u4e09\u70b9\u5206\u522b\u4e3a $A,B,C$\uff09\uff1a\n\n![](http://images.cnblogs.com/cnblogs_com/Xing-Ling/1457207/o_464656465.PNG)\n\n\u663e\u7136\u6709 $k_2 < k_1$\u3002\u8bbe $k_0=2S[i]$\uff0c\u7531\u4e0a\u8ff0\u7ed3\u8bba\u53ef\u77e5\uff1a  \n> $(a).$ \u82e5 $k_1 \\leqslant k_0$\uff0c\u5219 $j_2$ \u4f18\u4e8e $j_1$ \u3002\u53cd\u4e4b\uff0c\u82e5 $k_1 > k_0$\uff0c\u5219 $j_1$ \u4f18\u4e8e $j_2$ \u3002  \n$(b).$ \u82e5 $k_2 \\leqslant k_0$\uff0c\u5219 $j_3$ \u4f18\u4e8e $j_2$ \u3002\u53cd\u4e4b\uff0c\u82e5 $k_2 > k_0$\uff0c\u5219 $j_2$ \u4f18\u4e8e $j_3$ \u3002\n\n\u4e8e\u662f\u8fd9\u91cc\u53ef\u4ee5\u5206\u4e09\u79cd\u60c5\u51b5\u6765\u8ba8\u8bba\uff1a  \n> $(1).$ $k_0 < k_2 < k_1$\u3002\u7531 $(a),(b)$ \u53ef\u77e5\uff1a$j_1$ \u4f18\u4e8e $j_2$ \u4f18\u4e8e $j_3$ \u3002  \n$(2).$ $k_2 \\leqslant k_0 < k_1$\u3002\u7531 $(a),(b)$ \u53ef\u77e5\uff1a$j_1$ \u548c $j_3$ \u5747\u4f18\u4e8e $j_2$\u3002  \n$(3).$ $k_2 < k_1 \\leqslant k_0$\u3002\u7531 $(a),(b)$ \u53ef\u77e5\uff1a$j_3$ \u4f18\u4e8e $j_2$ \u4f18\u4e8e $j_1$ \u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5bf9\u4e8e\u8fd9\u4e09\u79cd\u60c5\u51b5\uff0c$j_2$ **\u59cb\u7ec8\u4e0d\u662f\u6700\u4f18\u89e3**\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5**\u5c06 $j_2$ \u4ece\u5019\u9009\u51b3\u7b56\u70b9\u4e2d\u8e22\u51fa\u53bb\uff08\u5220\u9664\uff09**\uff0c\u53ea\u7559\u4e0b $j_1$ \u548c $j_3$\uff0c\u5220\u540e\u7684\u60c5\u51b5\u5982\u4e0b\u56fe\u6240\u793a\uff1a\n\n![](http://images.cnblogs.com/cnblogs_com/Xing-Ling/1457207/o_456.PNG)\n\n\u6211\u4eec\u8981\u5bf9\u67d0\u4e00\u4e2a\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\u8fdb\u884c\u4f18\u5316\u6539\u8fdb\uff0c\u65e0\u975e\u5c31\u662f\u5173\u6ce8\u4e24\u4e2a\u8981\u70b9\uff1a**\u6b63\u786e\u6027**\u548c**\u9ad8\u6548\u6027**\uff08\u5f88\u591a\u65f6\u5019**\u9ad8\u6548\u6027**\u90fd\u4f53\u73b0\u4e3a**\u5355\u8c03\u6027**\uff09\u3002\n\n\u9171\u7d2b\u505a\u7684**\u6b63\u786e\u6027**\u662f\u6bcb\u5eb8\u7f6e\u7591\u7684\uff0c\u56e0\u4e3a\u5728 $j_1$ \u548c $j_3$ \u5176\u4e2d\u5fc5\u5b9a\u6709\u4e00\u4e2a\u6bd4 $j_2$ \u66f4\u4f18\uff0c\u6240\u4ee5\u5220\u9664 $j_2$ \u5bf9\u7b54\u6848\u6ca1\u6709\u4efb\u4f55\u5f71\u54cd\u3002\n\n\u90a3\u4e48**\u9ad8\u6548\u6027**\u5462\uff1f\u81ea\u5df1\u5728\u8111\u5b50\u91cc\u9762 $yy$ \u4e00\u4e0b\uff0c\u5728\u4e00\u4e2a\u5750\u6807\u7cfb\u7684\u7b2c\u4e00\u8c61\u9650\u4e2d\uff08\u672c\u9898\u4e2d $X(j)$ \u548c $Y(j)$\u5747\u5927\u4e8e\u7b49\u4e8e $0$\uff0c\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8fd9\u91cc\u8981\u8bf4\u7b49\u4e8e\uff0c\u4e0b\u9762\u4f1a\u63d0\u5230\uff09\uff0c\u6709\u82e5\u5e72\u4e2a\u79bb\u6563\u7684\u70b9\uff0c\u4efb\u53d6\u4e09\u70b9\uff0c\u5982\u679c\u5de6\u8fb9\u659c\u7387\u5927\u4e8e\u53f3\u8fb9\u659c\u7387\uff0c\u5219\u5f62\u6210\u4e86\u4e0a\u8ff0\u60c5\u51b5\uff0c\u5fc5\u5b9a\u4f1a\u5220\u70b9\uff0c\u56e0\u800c\u6d88\u9664\u8fd9\u79cd\u60c5\u51b5\u3002\u6240\u4ee5**\u5c06\u6700\u540e\u7559\u4e0b\u6765\u7684\u70b9\u9996\u4f4d\u76f8\u8fde\uff0c\u5176\u5f62\u6210\u7684\u5404\u4e2a\u7ebf\u6bb5\u659c\u7387\u4ece\u5de6\u5230\u53f3\u5fc5\u5b9a\u662f\u5355\u8c03\u9012\u589e\u7684**\uff08\u6709\u53ef\u80fd\u975e\u4e25\u683c\u9012\u589e\uff0c\u8fd9\u4e2a\u95ee\u9898\u4e4b\u540e\u518d\u8ba8\u8bba\uff09\u3002\n\n\u5982\u679c\u5b66\u4e60\u8fc7\u8ba1\u7b97\u51e0\u4f55\u76f8\u5173\u77e5\u8bc6\uff0c\u4f1a\u610f\u8bc6\u5230\u8fd9\u4e2a\u8fc7\u7a0b\u5176\u5b9e\u4e0e\u6c42\u51f8\u5305\u7b97\u6cd5\u662f\u7c7b\u4f3c\u7684\u3002\uff08\u987a\u624b\u4e22\u4e00\u4e2a\u5e7f\u544a\uff1a[\u3010\u5b66\u4e60\u7b14\u8bb0\u3011\u8ba1\u7b97\u51e0\u4f55\u5168\u5bb6\u6876](https://www.luogu.com.cn/blog/ChenXingLing/post-xue-xi-bi-ji-ji-suan-ji-he-quan-jia-tong)\uff09\n\n\u5b9e\u9645\u4e0a\u5728\u56fe\u4e2d\u9009\u53d6\u6700\u9760\u5de6\u4e0b\u9762\u3001\u4e0b\u9762\u3001\u53f3\u4e0b\u9762\u7684\u70b9\u9996\u4f4d\u76f8\u8fde\uff0c\u5c31\u662f\u6700\u540e\u7559\u4e0b\u6765\u7684\u70b9\u4e86\uff0c\u5b83\u4eec\u5f62\u6210\u4e86\u4e00\u4e2a**\u4e0b\u51f8\u5305**\uff0c\u5373**\u51f8\u5305**\uff08\u53c8\u540d**\u51f8\u58f3**\uff09\u7684**\u4e0b\u534a\u90e8\u5206**\uff08\u4e0d\u4e25\u8c28\u7684\u8bb2\uff0c\u7ed9\u5b9a\u4e8c\u7ef4\u5e73\u9762\u4e0a\u7684\u70b9\u96c6\uff0c\u51f8\u5305\u5c31\u662f\u5c06\u6700\u5916\u5c42\u7684\u70b9\u8fde\u63a5\u8d77\u6765\u6784\u6210\u7684**\u51f8\u591a\u8fb9\u5f62**\uff0c\u5b83\u80fd\u5305\u542b\u70b9\u96c6\u4e2d\u6240\u6709\u7684\u70b9\u2014\u2014\u6458\u81ea[\u767e\u5ea6\u767e\u79d1](https://baike.baidu.com/item/%E5%87%B8%E5%8C%85/179150?fr=aladdin)\uff09\u3002\n\n\u7ef4\u62a4\u51fa\u7684\u56fe\u5f62\u5982\u4e0b\u56fe\u6240\u793a\uff1a\n\n![](http://images.cnblogs.com/cnblogs_com/Xing-Ling/1457207/o_789.PNG)\n\n\u53ef\u4ee5\u5c1d\u8bd5\u5728\u51f8\u5305\u56f4\u8d77\u6765\u7684\u533a\u57df\u5185\u4efb\u610f\u53d6\u4e00\u70b9\uff0c\u5176\u5fc5\u5b9a\u80fd\u5728\u5305\u56f4\u5708\u4e0a\u627e\u5230\u4e24\u4e2a\u70b9\u4f7f\u5f97\u8be5\u70b9\u53ef\u88ab\u5220\u9664\u3002\u5982\u4e0a $\\text{L}$ \u70b9\uff0c\u5b83\u4e0e $D,E$ \u4e24\u70b9\u5f62\u6210\u4e86\u4e00\u4e2a\u53ef\u5220\u70b9\u56fe\u5f62\u3002\n\n> \u6ce8\u610f\uff1a\u56fe\u4e2d $C,D,E$ \u6545\u610f\u753b\u6210\u4e86\u4e09\u70b9\u4e00\u7ebf\uff0c\u800c\u5b9e\u9645\u4e0a\u70b9 $D$ \u662f\u53ef\u4ee5\u5220\u53bb\u7684\uff0c\u4e14\u4e25\u683c\u51f8\u5305\u4e0d\u5141\u8bb8\u5b58\u5728\u8fd9\u79cd\u60c5\u51b5\u3002\u5173\u4e8e\u53bb\u91cd\u7684\u7ec6\u8282\u95ee\u9898\u540e\u9762\u4f1a\u63d0\u5230\u3002\n\n**\u540c\u7406**\uff0c\u5982\u679c\u628a\u4e0d\u7b49\u5f0f $\\frac {Y(j_2)-Y(j_1)} {X(j_2)-X(j_1)} \\leqslant k_0[i]$ \u6539\u4e3a $\\frac {Y(j_2)-Y(j_1)} {X(j_2)-X(j_1)} \\geqslant k_0[i]$\uff0c\u90a3\u4e48\u7ef4\u62a4\u51fa\u6765\u7684\u5c31\u662f\u4e00\u4e2a**\u4e0a\u51f8\u5305**\u3002\n\n#### **(2).\u3010\u5bfb\u627e\u6700\u4f18\u51b3\u7b56\u70b9\u3011**\n\n\u5728\u4e00\u6b21\u51b3\u7b56\u70b9\u7684\u5bfb\u627e\u4e2d\uff0c\u6613\u77e5\u4e0b\u51f8\u5305\u70b9\u96c6\u91cc\u603b\u4f1a\u5b58\u5728\u4e00\u70b9\uff0c\u4f7f\u5f97\u5b83\u4e0e\u5de6\u90bb\u70b9\u5f62\u6210\u7684\u659c\u7387\u5c0f\u4e8e\u7b49\u4e8e $k_0$ \uff0c\u4e0e\u53f3\u90bb\u70b9\u5f62\u6210\u7684\u659c\u7387\u5927\u4e8e $k_0$ \u3002\n\n\u4f8b\u5982\u4e0a\u56fe\u4e2d\u7684 $E$ \u70b9\uff0c\u8bbe $k_4 \\leqslant k_0 < k_5$ \u7531\u4e8e\u51f8\u5305\u4e0a\u9762\u7684\u659c\u7387\u5448\u5355\u589e\u6001\uff0c\u90a3\u4e48\u6709\uff1a$k_1 < k_2 < k_3 < k_4 \\leqslant k_0 < k_5 < k_6 < k_7$\uff0c\u6240\u4ee5\u51b3\u7b56\u70b9 $E$ \u4f18\u4e8e\u5176\u4ed6\u6240\u6709\u70b9\uff0c\u5373 $E$ \u5c31\u662f $dp[i]$ \u7684**\u6700\u4f18\u51b3\u7b56\u70b9**\u3002\n\n\u5982\u679c\u66b4\u529b\u67e5\u627e\u7684\u8bdd\uff0c\u5c31\u662f\u4ece\u7b2c\u4e00\u4e2a\u70b9\u5f00\u59cb\u5411\u540e\u626b\u63cf\uff0c\u627e\u5230**\u7b2c\u4e00\u4e2a\u659c\u7387\u5927\u4e8e $k_0$ \u7684\u7ebf\u6bb5**\uff0c\u5176\u5de6\u7aef\u70b9\u5373\u4e3a**\u6700\u4f18\u51b3\u7b56\u70b9**\u3002\u7531\u4e8e\u51f8\u5305\u4e0a\u7684\u659c\u7387\u4f9d\u6b21\u9012\u589e\uff0c\u53ef\u4ee5**\u4e8c\u5206**\u5feb\u901f\u5f97\u5230\u8fd9\u4e2a\u70b9\u3002\n\n### **2.\u3010\u7ebf\u6027\u89c4\u5212\u3011**\n\n\u5148\u56de\u987e\u4e00\u4e0b\u6a21\u677f\u9898\u7684 $\\text{dp}$ \u65b9\u7a0b\uff1a$dp[i]=S[i]^2-2S[i]L+dp[j]+(S[j]+L)^2-2S[i]S[j]$\u3002\n\n\u5bf9\u5176\u8fdb\u884c\u79fb\u9879\u53d8\u5316\uff0c\u53d8\u6210\u5f62\u5982 $y=kx+b$ \u7684\u70b9\u659c\u5f0f\u3002  \n**\u5212\u91cd\u70b9\uff1a\u79fb\u9879\u8981\u9075\u5faa\u7684\u539f\u5219\u662f\uff1a\u628a\u542b\u6709 $function(i)*function(j)$ \u7684\u8868\u8fbe\u5f0f\u770b\u4f5c\u659c\u7387 $k_0$ \u4e58\u4ee5\u672a\u77e5\u6570 $x$\uff0c\u542b\u6709 $dp[i]$ \u7684\u9879\u5fc5\u987b\u8981\u5728 $b$ \u7684\u8868\u8fbe\u5f0f\u4e2d\uff0c\u542b\u6709 $function(j)$ \u7684\u9879\u5fc5\u987b\u5728 $y$ \u7684\u8868\u8fbe\u5f0f\u4e2d\u3002\u5982\u679c\u672a\u77e5\u6570 $x$ \u7684\u8868\u8fbe\u5f0f\u5355\u8c03\u9012\u51cf\uff0c\u6700\u597d\u8ba9\u7b49\u5f0f\u4e24\u8fb9\u540c\u4e58\u4e2a $-1$\uff0c\u4f7f\u5176\u53d8\u4e3a\u5355\u589e**\u3002\n\n\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8bf4\u8981\u8ba9 $x$ \u7684\u8868\u8fbe\u5f0f\u5355\u589e\uff0cemm...\u5176\u5b9e\u662f\u4e3a\u4e86\u8ba9\u4e00\u4e9b\u8f83\u7b80\u5355\u7684\u95ee\u9898\u6a21\u5f0f\u5316\uff0c\u4e0d\u6613\u51fa\u9519\uff0c\u5982\u679c\u4f60\u975e\u8981\u5355\u51cf\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5012\u5e8f\u679a\u4e3e\uff0c\u81f3\u4e8e\u662f\u5426\u6b63\u786e\uff0c\u5177\u4f53\u5b9e\u73b0\u9700\u8981\u6ce8\u610f\u7684\u7384\u5b66\u95ee\u9898\u7b49\u7b49\uff0c\u56e0\u4e3a\u89c9\u5f97\u592a\u9ebb\u70e6\u6ca1\u6709\u7ec6\u60f3\uff0c\u6211\u4e5f\u4e0d\u6e05\u695a\u4f1a\u9047\u5230\u4ec0\u4e48\u95ee\u9898\u3002\n\n\u4f8b\u5982\u6b64\u9898\uff0c\u539f $\\text{dp}$ \u65b9\u7a0b\u53ef\u5316\u4e3a\uff1a\n$(2S[i])S[j]+(dp[i]-S[i]^2+2S[i]L)=(dp[j]+(S[j]+L)^2)$\n\n\u5176\u4e2d $k_i=2S[i],$ $x_i=S[j],$ $b_i=dp[i]-S[i]^2+2S[i]L,$ $y_i=dp[j]+(S[j]+L)^2$\u3002\n\n\u5176\u5b9e\u4e5f\u53ef\u4ee5\u5316\u4e3a\uff1a\n$(2S[i])(S[j]+L)+(dp[i]-S[i]^2)=(dp[j]+(S[j]+L)^2)$\n\u5176\u4e2d $k_i=2S[i],$ $x_i=S[j]+L,$ $b_i=dp[i]-S[i]^2,$ $y_i=dp[j]+(S[j]+L)^2$\u3002\n\n\u8fd8\u53ef\u4ee5\u5316\u4e3a $...$\n\n$...$\n\n\u53ea\u8981\u6ee1\u8db3\u4e0a\u8ff0\u79fb\u9879\u539f\u5219\uff0c\u5bf9\u7b54\u6848\u662f\u6ca1\u6709\u4efb\u4f55\u5f71\u54cd\u7684\u3002\n\n\u8fd9\u91cc\u4ee5\u7b2c\u4e00\u79cd\u5f62\u5f0f\u4e3a\u4f8b\uff0c\u5148\u753b\u51fa\u8349\u56fe\uff1a\n\n![](http://images.cnblogs.com/cnblogs_com/Xing-Ling/1457207/o_14564864.PNG)\n\n#### **(1).\u3010\u9ad8\u4e2d\u6570\u5b66\u77e5\u8bc6\u3011**\n\n\u6211\u4eec\u7684\u76ee\u7684\u662f\u6c42\u51fa\u4e00\u4e2a**\u6700\u4f18\u51b3\u7b56\u70b9** $j$ \u4f7f\u5f97 $dp[i]$ \u6700\u5c0f\uff0c\u53c8\u56e0\u4e3a $b[i]=dp[i]-S[i]^2$ \uff0c\u6240\u4ee5\u5c31\u662f\u8981\u627e\u5230\u67d0\u4e2a\u70b9\u4f7f\u8fd9\u6761\u76f4\u7ebf\u7ecf\u8fc7\u5b83\u65f6\u7b97\u51fa\u6765\u7684 $b$ \u6700\u5c0f\uff0c\u5373\u662f\u9ad8\u4e2d\u6570\u5b66\u8bfe\u672c\u4e0a\u7684**\u7ebf\u6027\u89c4\u5212**\u95ee\u9898\u3002\n\n#### **(2).\u3010\u5bfb\u627e\u6700\u4f18\u51b3\u7b56\u70b9\u3011**\n\n![](http://images.cnblogs.com/cnblogs_com/Xing-Ling/1457207/o_4684.PNG)\n\n\u5982\u56fe\u6240\u793a\uff0c\u70b9 $E$ \u5373\u4e3a**\u6700\u4f18\u51b3\u7b56\u70b9**\u3002\u663e\u7136\uff0c\u8fd9\u4e2a\u4f7f\u5f97 $b$ \u6700\u5c0f\u7684**\u6700\u4f18\u51b3\u7b56\u70b9**\u4f4d\u4e8e**\u4e0b\u51f8\u5305**\u70b9\u96c6\u4e2d\uff0c\u4e14\u4e0e\u4e0a\u8ff0**\u4ee3\u6570\u6cd5**\u6c42\u5f97\u7684\u70b9\u4e00\u81f4\u3002\n\n### **3.\u3010\u4e24\u79cd\u601d\u8003\u65b9\u5f0f\u7684\u7ed3\u5408\u3011**\n\n\u5f3a\u70c8\u63a8\u8350\u7528**\u7ebf\u6027\u89c4\u5212**\u601d\u60f3\u4e3b\u5bfc\u601d\u8003\u8fc7\u7a0b\uff0c\u56e0\u4e3a\u56fe\u5f62\u7684\u53d8\u5e7b\u8f83\u76f4\u89c2\uff0c\u66f4\u91cd\u8981\u7684\u662f\uff1a\u5728\u67d0\u67d0\u53d8\u91cf\u4e0d\u6ee1\u8db3\u5355\u8c03\u6027\u65f6\uff0c\u901a\u8fc7\u56fe\u5f62\u53ef\u4ee5\u8fc5\u901f\u505a\u51fa\u5224\u65ad\u5e76\u6539\u53d8\u7b56\u7565\uff08\u5728\u540e\u9762\u3010\u5173\u4e8e\u5355\u8c03\u6027\u7684\u7814\u7a76\u3011\u4e2d\u4f1a\u8be6\u7ec6\u89e3\u91ca\uff09\u3002\n\n\u800c**\u4ee3\u6570\u6cd5**\u901a\u5e38\u5728\u4e0d\u4fbf\u4e8e\u8bc6\u522b\u65b9\u7a0b\u7279\u5f81\u65f6\u8d77\u4e00\u4e2a\u8f6c\u6362\u601d\u7ef4\u65b9\u5411\u7684\u4f5c\u7528\uff0c\u56e0\u4e3a\u6709\u4e9b\u9898\u53ef\u80fd\u4f1a\u76f4\u63a5\u51fa\u73b0 $\\frac{Y(j)-Y(j')}{X(j)-X(j')}$ \u7684\u5f62\u5f0f\uff0c\u9700\u8981\u901a\u8fc7\u4e00\u7cfb\u5217\u4ee3\u6570\u63a8\u5bfc\u540e\u518d\u7ed8\u8349\u56fe\u6a21\u62df\u51b3\u7b56\u3002\n\n------\n\n## **\u4e8c.\u3010\u7ef4\u62a4\u51f8\u5305\u3011**\n\n\u5b9e\u9645\u4e0a\u53ea\u8981\u8ba9\u7ef4\u62a4\u7684\u51f8\u5305\u65b9\u5411\u76f8\u540c\uff0c\u4e24\u79cd\u601d\u8003\u65b9\u5f0f\u7684\u4ee3\u7801\u662f\u4e00\u6a21\u4e00\u6837\u7684\u3002\n\n\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u51f8\u5305\u70b9\u96c6\uff0c\u64cd\u4f5c\u5206\u4e09\u6b65\u8d70\uff1a  \n$(1).$ \u8fdb\u884c**\u62e9\u4f18\u7b5b\u9009**\u65f6\uff0c\u5728\u51f8\u5305\u4e0a\u627e\u5230**\u6700\u4f18\u51b3\u7b56\u70b9** $j$ \u3002  \n$(2).$ \u7528**\u6700\u4f18\u51b3\u7b56\u70b9** $j$ \u66f4\u65b0 $dp[i]$ \u3002  \n$(3).$ \u5c06 $i$ \u4f5c\u4e3a\u4e00\u4e2a**\u51b3\u7b56\u70b9**\u52a0\u5165\u56fe\u5f62\u5e76\u66f4\u65b0\u51f8\u5305\uff08\u5982\u679c\u70b9 $i$ \u4e5f\u662f $dp[i]$ \u7684**\u51b3\u7b56\u70b9\u4e4b\u4e00**\uff0c\u5219\u9700\u8981\u5c06 $(3)$ \u6362\u5230\u6700\u524d\u9762\uff09\u3002\n\n\u5728\u672c\u9898\u4e2d\u6b65\u9aa4 $(3)$ \u7684\u5177\u4f53\u64cd\u4f5c\u4e3a\uff1a\u5224\u65ad\u5f53\u961f\u5c3e\u7684\u70b9\u4e0e\u70b9 $i$ \u5f62\u6210\u53ef\u5220\u70b9\u56fe\u5f62\u65f6\uff0c\u51fa\u961f\u76f4\u81f3\u65e0\u6cd5\u518d\u5220\u70b9\uff0c\u7136\u540e\u5c06 $i$ \u52a0\u5165\u961f\u5217\u3002  \n\n\n\n\u5728\u5224\u65ad\u53ef\u5220\u56fe\u5f62\u65f6\u6709\u4e24\u79cd\u65b9\u6cd5\uff08\u4ee5 \u4e0b\u51f8\u5305 \u4e3a\u4f8b\uff09\uff0c\u4e00\u79cd\u662f `slope(Q[t-1],Q[t])<=slope(Q[t],i)`\uff0c\u53e6\u4e00\u79cd\u662f `slope(Q[t-1],Q[t])<=slope(Q[t-1],i)`\uff0c\u90fd\u8868\u793a\u51fa\u73b0\u4e86\u53ef\u4ee5\u5220\u53bb\u70b9 $Q[t]$ \u7684\u60c5\u51b5\uff08\u53ea\u8981\u5bf9\u8fb9\u754c\u3001\u53bb\u91cd\u7684\u5904\u7406\u8db3\u591f\u4e25\u8c28\uff0c\u4e24\u79cd\u5199\u6cd5\u662f\u6ca1\u6709\u533a\u522b\u7684\uff09\u3002\u5176\u4e2d $Q$ \u662f\u7ef4\u62a4\u51f8\u5305\u70b9\u96c6\u7684\u961f\u5217\u3002\n\n\u8be5\u505a\u6cd5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$\uff0c\u74f6\u9888\u5728\u4e8e\u4e8c\u5206\u5bfb\u627e**\u6700\u4f18\u51b3\u7b56\u70b9**\u3002\n\n------\n\n## **\u4e09.\u3010\u518d\u4f18\u5316\u3011**\n\n\u8fd0\u7528**\u51b3\u7b56\u5355\u8c03\u6027**\u8fdb\u884c\u4f18\u5316\u3002**\u51b3\u7b56\u5355\u8c03\u6027**\u76f8\u5173\u57fa\u7840\u77e5\u8bc6\u89c1 **[\u3010\u5b66\u4e60\u7b14\u8bb0\u3011\u52a8\u6001\u89c4\u5212\u2014\u5404\u79cd $\\text{DP}$ \u4f18\u5316](https://www.cnblogs.com/Xing-Ling/p/11317315.html)**\uff0c\u8fd9\u91cc\u53ea\u653e\u4e00\u4e0b\u5b9a\u4e49\uff1a  \n\u8bbe $j_0[i]$ \u8868\u793a $dp[i]$ \u8f6c\u79fb\u7684**\u6700\u4f18\u51b3\u7b56\u70b9**\uff0c\u90a3\u4e48**\u51b3\u7b56\u5355\u8c03\u6027**\u53ef\u63cf\u8ff0\u4e3a $\\forall i\\leqslant i',j_0[i]\\leqslant j_0[i']$\u3002\u4e5f\u5c31\u662f\u8bf4\u968f\u7740 $i$ \u7684\u589e\u5927\uff0c\u6240\u627e\u5230\u7684**\u6700\u4f18\u51b3\u7b56\u70b9**\u662f\u9012\u589e\u6001\uff08\u975e\u4e25\u683c\u9012\u589e\uff09\u3002\n\n### **(1).\u3010\u51b3\u7b56\u5355\u8c03\u6027\u8bc1\u660e\u3011**\n\n\u8fd8\u662f\u4ee5 [\u73a9\u5177\u88c5\u7bb1](https://www.luogu.org/problemnew/show/P3195) \u4e3a\u4f8b\uff0c\u6765\u7b80\u5355\u8bc1\u4e00\u6ce2\u51b3\u7b56\u5355\u8c03\u6027\uff0c\u65b9\u6cd5\u91c7\u7528**\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f**\u3002\n\n\u663e\u7136\uff0c\u672c\u9898\u7684\u8f6c\u79fb\u65b9\u7a0b\u5448\u73b0\u51fa\u4e86 $dp[i]=\\min(dp[j]+w(i,j))$ \u7684\u5f62\u5f0f\uff0c\u5373 $1D/1D$ \u52a8\u6001\u89c4\u5212\u65b9\u7a0b\uff0c\u5176\u4e2d $w(i,j)=(S[i]-S[j]-1-L)^2$\u3002\n\n$\u8bc1\u660e\uff1a\u8bbe$ $Q=S[i]-S[j]-1-L$\n\n$\\therefore w(i,j)=(S[i]-S[j]-1-L)^2=Q^2$\n\n$\\begin{aligned}\n\\therefore w(i+1,j+1)=&(S[i+1]-S[j+1]-1-L)^2\\\\\n                   =&((S[i]+C[i+1]+1)-(S[j]+C[j+1]+1)-1-L)^2\\\\\n                   =&(Q+C[i+1]-C[j+1])^2\n\\end{aligned}$\n\n$\\begin{aligned}\nw(i,j+1)=&(S[i]-S[j+1]-1-L)^2\\\\\n                   =&(S[i]-(S[j]+C[j+1]+1)-1-L)^2\\\\\n                   =&(Q-C[j+1]-1)^2\n\\end{aligned}$\n\n$\\begin{aligned}\nw(i+1,j)=&(S[i+1]-S[j]-1-L)^2\\\\\n                   =&((S[i]+C[i+1]+1)-S[j]-1-L)^2\\\\\n                   =&(Q+C[i+1]+1)^2\n\\end{aligned}$\n\n$\\therefore w(i,j)+w(i+1,j+1)=2Q^2+2C[i+1]Q-2C[j+1]Q+C[i+1]^2-2C[i+1]C[j+1]+C[j+1]^2$\n\n$\\therefore w(i+1,j)+w(i,j+1)=2Q^2+2C[i+1]Q-2C[j+1]Q+C[i+1]^2+2C[i+1]+2C[j+1]+C[j+1]^2+2$\n\n$\\therefore w(i,j)+w(i+1,j+1)-w(i+1,j)+w(i,j+1)=-2(C[i+1]+1)(C[j+1]+1)$\n\n$\\text{\u53c8} \\because C[i],C[j] \\geqslant 1$\n\n$\\therefore -2(C[i+1]+1)(C[j+1]+1) \\leqslant -8$\n\n$\\therefore w(i,j)+w(i+1,j+1) \\leqslant w(i+1,j)+w(i,j+1)$\n\n\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\u6210\u7acb\uff0c\u6240\u4ee5\u6b64\u65b9\u7a0b\u5177\u6709\u51b3\u7b56\u5355\u8c03\u6027\u3002  \n\u8bc1\u6bd5\u3002\n\n### **(2).\u3010\u5355\u8c03\u961f\u5217\u3011**\n\n\u7531\u4e8e**\u6700\u4f18\u51b3\u7b56\u70b9**\u9012\u589e\uff0c\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u5bf9\u5176\u8fdb\u884c\u7ef4\u62a4\u3002\u64cd\u4f5c $(2),(3)$ \u4e0d\u9700\u8981\u6539\u52a8\uff0c\u64cd\u4f5c $(1)$ \u6539\u4e3a\uff1a\u5224\u65ad\u5f53\u961f\u9996\u7684\u7b2c\u4e00\u6839\u7ebf\u6bb5\u659c\u7387\u5c0f\u4e8e\u7b49\u4e8e $k_0[i]$ \u65f6\u5c31\u51fa\u961f\uff0c\u76f4\u81f3\u659c\u7387\u5927\u4e8e $k_0[i]$\uff0c\u6b64\u65f6\u7684\u961f\u9996\u5373\u4e3a**\u6700\u4f18\u51b3\u7b56\u70b9**\u3002\n\n\u6b63\u786e\u6027\u663e\u7136\u3002\u56e0\u4e3a\u968f\u7740 $i$ \u7684\u53d8\u5927\uff0c\u6700\u4f18\u51b3\u7b56\u70b9 $j_0[i]$ \u4e5f\u4f1a\u8ddf\u7740\u53d8\u5927\uff0c\u5982\u679c\u5df2\u77e5\u67d0\u4e2a\u70b9\u5728\u5f53\u524d\u60c5\u51b5\u4e0b\u4e0d\u591f\u4f91\u79c0\uff0c\u90a3\u4e48\u5728\u8fd9\u4e4b\u540e\u4e5f\u4e00\u5b9a\u4e0d\u4f1a\u4f5c\u4e3a\u6700\u4f18\u51b3\u7b56\u70b9\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u51fa\u961f\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n)$ \u3002\n\n### **(3).\u3010\u518d\u8bc1\u51b3\u7b56\u5355\u8c03\u6027\u3011**\n\n\u4e00\u6837\u7684\uff0c\u4e24\u79cd\u601d\u8def\u3002\n\n\u5148\u89c2\u5bdf $k_0[i]$ \u7684\u8868\u8fbe\u5f0f\uff1a$k_0[i]=2S[i]$ \uff0c\u660e\u663e\u5728\u672c\u9898\u4e2d $k_0$ \u5448\u5355\u589e\u6001\u3002\n\n#### **\u3010\u4ee3\u6570\u6cd5\u3011**\n\n$k_0[i]$ \u9012\u589e\u5c31\u8bf4\u660e\u6211\u4eec\u627e\u5230\u7684**\u7b2c\u4e00\u4e2a\u659c\u7387\u5927\u4e8e $k_0[i]$ \u7684\u7ebf\u6bb5**\u5728\u4e0d\u65ad\u5730\u5411\u540e\u79fb\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u627e\u5230\u4e86\u67d0\u4e00\u4e2a**\u6700\u4f18\u51b3\u7b56\u70b9 $j$**\uff0c\u90a3\u4e48\u5728\u4e0b\u4e00\u6b21\u51b3\u7b56\u4e2d\uff0c**\u6700\u4f18\u51b3\u7b56\u70b9 $j'$** \u5fc5\u5b9a\u5728 $j$ \u7684\u540e\u9762\u3002\n\n**\u51b3\u7b56\u5355\u8c03\u6027**\u5f97\u8bc1\u3002\n\n#### **\u3010\u7ebf\u6027\u89c4\u5212\u3011**\n\n\u753b\u51fa\u8349\u56fe\uff1a\n\n![](http://images.cnblogs.com/cnblogs_com/Xing-Ling/1457207/o_5757575.PNG)\n\n\u76f4\u7ebf $Line_i$ \u7684\u659c\u7387 $k_0[i]$ \u9012\u589e\uff0c\n\n\u7531\u56fe\u53ef\u77e5**\u6700\u4f18\u51b3\u7b56\u70b9**\u5728\u9012\u589e\u3002\n\n**\u51b3\u7b56\u5355\u8c03\u6027**\u5f97\u8bc1\u3002\n\n#### **\u3010\u5176\u4ed6\u3011**\n\n\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u770b\u7684\u8bdd\uff0c\u8c8c\u4f3c\u51b3\u7b56\u5355\u8c03\u6027\u548c $X(j),k_0[i]$ \u7684\u5355\u8c03\u6027\u662f\u76f8\u901a\u7684\uff1f\n\n\u4e8e\u662f\u4e00\u4e2a\u7ed3\u8bba\u5c31\u51fa\u73b0\u4e86\uff1a\u5982\u679c $X(j),k_0[i]$ \u5747\u5355\u8c03\u4e0d\u51cf\uff0c\u5219\u8be5\u65b9\u7a0b\u5fc5\u5b9a\u6709**\u51b3\u7b56\u5355\u8c03\u6027**\uff08\u81ea\u5df1\u778e $yy$ \u7684\uff0c\u4e0d\u6562\u80af\u5b9a\u4e00\u5b9a\u6b63\u786e\uff09\u3002\n\n-------\n\n## **\u56db.\u3010Code\u3011**\n\n[**\u3010\u6a21\u677f\u3011** \u73a9\u5177\u88c5\u7bb1 $toy$ $[P3195]$](https://www.luogu.org/problemnew/show/P3195) \n\n\u8fd9\u9053\u9898 $...$ \u6570\u636e\u592a\u6c34\u4e86 $...$ \u6211\u4e00\u5f00\u59cb $\\text{L}$ \u5fd8\u4e86\u52a0 $1$ \u5c45\u7136\u8fd8\u8fc7\u4e86 $...$\n\n```cpp\n#include<cstring>\n#include<cstdio>\n#define LL long long\n#define Re register LL\nconst int N=5e4+5;\nLL i,j,n,L,h=1,t=0,Q[N],S[N],dp[N];\n//S[n]=\u2211C[i]+1, dp[i]=min(dp[j]+(S[i]-(S[j]+L+1))^2)\uff0c++L \n//dp[i]=S[i]^2-2*S[i]*L+dp[j]+(S[j]+L)^2-2S[i]*S[j]\n//(2*S[i]) * S[j] + (dp[i]-S[i]^2+2S[i]L)=(dp[j]+(S[j]+L)^2)\n//   k     *  x   +           b          =        y\ninline LL min(Re a,Re b){return a<b?a:b;}\ninline LL X(Re j){return S[j];}\ninline LL Y(Re j){return dp[j]+(S[j]+L)*(S[j]+L);}\ninline long double slope(Re i,Re j){return (long double)(Y(j)-Y(i))/(X(j)-X(i));}//\u8bb0\u5f97\u5f00long double \nint main(){\n    scanf(\"%lld%lld\",&n,&L);++L; \n    for(i=1;i<=n;S[i]+=S[i-1]+1,++i)scanf(\"%lld\",&S[i]);\n    Q[++t]=0;//\u91cd\u4e2d\u4e4b\u91cd \n    for(i=1;i<=n;++i){\n        while(h<t&&slope(Q[h],Q[h+1])<=2*S[i])++h;//\u81f3\u5c11\u8981\u6709\u4e24\u4e2a\u5143\u7d20 h<t\u3002\u51fa\u961f\u5224\u65ad\u65f6\u5c3d\u91cf\u52a0\u4e0a\u7b49\u53f7 \n        dp[i]=dp[j=Q[h]]+(S[i]-S[j]-L)*(S[i]-S[j]-L);\n        while(h<t&&slope(Q[t-1],Q[t])>=slope(Q[t-1],i))--t;//\u81f3\u5c11\u8981\u6709\u4e24\u4e2a\u5143\u7d20 h<t\u3002\u5165\u961f\u5224\u65ad\u65f6\u5c3d\u91cf\u52a0\u4e0a\u7b49\u53f7 \n        Q[++t]=i;\n    }\n    printf(\"%lld\",dp[n]);\n}\n```\n\n-------\n\n## **\u4e94.\u3010\u5404\u79cd\u7384\u5b66\u95ee\u9898\u3011**\n\n (\u30ce\u00b0\u03bf\u00b0)\u30ce\u524d\u65b9\u9ad8\u80fd\u9884\u8b66 (\uff0a\u00b0\u03c9\u00b0\uff0a)\u30ce\"\u975e\u6218\u6597\u4eba\u5458\u8bf7\u64a4\u79bb!! \uff0a\u30fb_\u30fb)\u30ce\n\n$(1).$ \u5199\u51fa $\\text{dp}$ \u65b9\u7a0b\u540e\uff0c\u8981\u5148\u5224\u65ad\u80fd\u4e0d\u80fd\u4f7f\u7528\u659c\u4f18\uff0c\u5373\u662f\u5426\u5b58\u5728 $function(i)*function(j)$ \u7684\u9879\u6216\u8005 $\\frac{Y(j)-Y(j')}{X(j)-X(j')}$ \u7684\u5f62\u5f0f\u3002\n\n$(2).$ \u901a\u8fc7\u5927\u5c0f\u4e8e\u7b26\u53f7\u6216\u8005 $b$ \u4e2d $dp[i]$ \u7684\u7b26\u53f7\u7ed3\u5408\u9898\u76ee\u8981\u6c42 $(\\min/ \\max)$ \u5224\u65ad\u662f\u4e0a\u51f8\u5305\u8fd8\u662f\u4e0b\u51f8\u5305\uff0c\u4e0d\u8981\u89c1\u4e00\u4e2a\u65b9\u7a0b\u5c31\u76f4\u63a5\u76f2\u731c\u4e00\u4e2a\u4e0b\u51f8\u3002\n\n$(3).$ \u5f53 $X(j)$ \u975e\u4e25\u683c\u9012\u589e\u65f6\uff0c\u5728\u6c42\u659c\u7387\u65f6\u53ef\u80fd\u4f1a\u51fa\u73b0 $X(j_1)=X(j_2)$ \u7684\u60c5\u51b5\uff0c\u6b64\u65f6\u6700\u597d\u662f\u5199\u6210\u8fd9\u6837\u7684\u5f62\u5f0f\uff1a`return Y(j)>=Y(i)?inf:-inf`\uff0c\u800c\u4e0d\u8981\u76f4\u63a5\u8fd4\u56de $inf$ \u6216\u8005 $-inf$\uff0c\u5728\u67d0\u4e9b\u9898\u4e2d\u60c5\u51b5\u8f83\u590d\u6742\uff0c\u5982\u679c\u4e0d\u5c0f\u5fc3\u753b\u9519\u4e86\u56fe\uff0c\u8fd4\u56de\u4e86\u4e00\u4e2a\u9519\u8bef\u7684\u6781\u503c\u5c31\u5b8c\u4e86\uff0c\u800c\u4e14\u8fd9\u79cd\u9519\u8bef\u53ea\u7528\u7b80\u5355\u6570\u636e\u8fd8\u5f88\u96be\u67e5\u51fa\u6765\u3002\n\n$(4).$ \u6ce8\u610f\u6bd4\u8f83 $k_0[i]$ \u548c $slope(j_1,j_2)$ \u8981\u5199\u89c4\u8303\uff0c\u8981\u7528\u53f3\u8fb9\u7684\u70b9\u51cf\u53bb\u5de6\u8fb9\u7684\u70b9\u8fdb\u884c\u8ba1\u7b97\uff08\u7ed3\u5408 $(3)$ \u6765\u770b\uff0c\u53ef\u9632\u6b62\u8fd4\u56de\u9519\u8bef\u7684\u6781\u503c\uff09\uff0c\u5982\u679c\u7528\u7684\u4ee3\u6570\u6cd5\u7406\u89e3\uff0c\u5199\u51fa\u4e86 `(X(j2)-X(j1))*k0<=Y(j2)-Y(j1)` \u6216 `(X(j2)-X(j1))*k0<=Y(j2)-Y(j1)`\uff0c\u800c\u6070\u5de7 $j_1,j_2$ \u53c8\u5199\u53cd\u4e86\uff0c\u4fbf\u4f1a\u51fa\u73b0\u7b49\u5f0f\u4e24\u8fb9\u540c\u9664\u4e86\u8d1f\u6570\u5374\u6ca1\u53d8\u53f7\u7684\u60c5\u51b5\u3002\u5f53\u7136\u7528 $k_0$ \u548c $\\frac {Y(j_2)-Y(j_1)}{X(j_2)-X(j_1)}$ \u8fdb\u884c\u6bd4\u8f83\u662f\u6ca1\u6709\u8fd9\u79cd\u95ee\u9898\u7684\u3002\n\n$(5).$ \u961f\u5217\u521d\u59cb\u5316\u5927\u591a\u90fd\u8981\u585e\u5165\u4e00\u4e2a\u70b9 $P(0)$\uff0c\u6bd4\u5982 [\u73a9\u5177\u88c5\u7bb1 $\\text{toy}$](https://www.luogu.org/problemnew/show/P3195)\uff0c\u9700\u8981\u585e\u5165 $P(S[0],dp[0]+(S[0]+L)^2)$ \u5373 $P(0,0)$\uff0c\u5176\u4ee3\u8868\u7684\u51b3\u7b56\u70b9\u4e3a $j=0$\u3002\n\n$(6).$ \u624b\u5199\u961f\u5217\u7684\u521d\u59cb\u5316\u662f `h=1,t=0`\uff0c\u7531\u4e8e\u585e\u4e86\u521d\u59cb\u70b9\u5bfc\u81f4 $t$ \u52a0 $1$\uff0c\u6240\u4ee5\u5728\u4e00\u4e9b\u9898\u89e3\u4e2d\u53ef\u4ee5\u770b\u5230 `h=t=1` \u751a\u81f3\u662f `h=t=0`\uff0c`h=t=2` \u4e4b\u7c7b\u7684\u5199\u6cd5\uff0c\u5176\u5b9e\u662f\u56e0\u4e3a\u7701\u53bb\u4e86\u585e\u521d\u59cb\u70b9\u7684\u4ee3\u7801\u3002\u5b83\u4eec\u90fd\u662f\u7b49\u4ef7\u7684\u3002\n\n$(7).$ \u624b\u5199\u961f\u5217\u5224\u65ad\u4e0d\u4e3a\u7a7a\u7684\u6761\u4ef6\u662f `h<=t`\uff0c\u800c\u51fa\u5165\u961f\u5224\u65ad\u90fd\u9700\u8981\u6709\u81f3\u5c11 $2$ \u4e24\u4e2a\u5143\u7d20\u624d\u80fd\u8fdb\u884c\u64cd\u4f5c\u3002\u6240\u4ee5\u5e94\u662f `h<t` \u3002\n\n$(8).$ \u8ba1\u7b97\u659c\u7387\u53ef\u80fd\u4f1a\u56e0\u4e3a\u5411\u4e0b\u53d6\u6574\u800c\u51fa\u73b0\u8bef\u5dee\uff0c\u6240\u4ee5 $slope$ \u51fd\u6570\u6700\u597d\u8bbe\u4e3a $long$ $double$ \u7c7b\u578b\u3002\n\n$(9).$ \u53ef\u80fd\u4f1a\u6709\u4e00\u90e8\u5206\u7684 $\\text{dp}$ \u521d\u59cb\u503c\u65e0\u6cd5\u8f6c\u79fb\u8fc7\u6765\uff0c\u9700\u8981\u624b\u52a8\u63d0\u524d\u5f04\u4e00\u4e0b\uff0c\u4f8b\u5982 [\u6446\u6e21\u8f66 $\\text{[P5017]}$](https://www.luogu.org/problemnew/show/P5017)\u3002\n\n$(10).$ \u5728\u6bd4\u8f83\u4e24\u4e2a\u659c\u7387\u65f6\uff0c\u5c3d\u91cf\u5199\u4e0a\u7b49\u4e8e\uff0c\u5373 `<=` \u548c `>=` \u800c\u4e0d\u662f `<` \u548c `>`\u3002\u8fd9\u6837\u5199\u5bf9\u4e8e\u53bb\u91cd\u6709\u5947\u6548\uff08\u6709\u91cd\u70b9\u65f6\u4f1a\u5bfc\u81f4\u659c\u7387\u5206\u6bcd\u51fa\u9505\uff09\uff0c\u4f46\u4e0d\u8981\u4ee5\u4e3a\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b8c\u5168\u53bb\u91cd\uff0c\u56e0\u4e3a\u8981\u8003\u8651\u7684\u60c5\u51b5\u53ef\u80fd\u4f1a\u975e\u5e38\u590d\u6742\uff0c\u6240\u4ee5\u8fd8\u662f\u63a8\u8350\u52a0\u4e0a $(3)$ \u4e2d\u63d0\u5230\u7684\u7279\u5224\uff0c\u786e\u4fdd\u4e07\u65e0\u4e00\u5931\u3002\n\n-------\n\n## **\u516d.\u3010\u5173\u4e8e\u5355\u8c03\u6027\u7684\u7814\u7a76\u3011**\n\n**\u5212\u91cd\u70b9\uff1a\u6ce8\u610f\u662f\u5426\u5177\u6709\u5355\u8c03\u6027\uff0c\u4e0d\u8981\u76f2\u76ee\u5730\u4f7f\u7528\u5355\u8c03\u961f\u5217\u8fdb\u884c\u7ef4\u62a4\u3002**\n\n### **(1).\u3010X(j) \u5355\u589e\u4e0e\u5355\u51cf\u3011**\n\n\u5c06\u65b9\u7a0b\u53d8\u4e3a $\\frac {Y(j_2)-Y(j_1)} {X(j_2)-X(j_1)} \\leqslant k_0[i]$ \u6216\u8005 $\\frac {Y(j_2)-Y(j_1)} {X(j_2)-X(j_1)} \\geqslant k_0[i]$ \u6216\u8005 $kx+b=y$ \u7684\u5f62\u5f0f\uff0c\u53d8\u5316\u8981\u9075\u5faa\u4e4b\u524d\u63d0\u5230\u7684\u539f\u5219\uff0c\u5c24\u5176\u662f $X(j)$ \u7684\u5355\u8c03\u6027\uff0c\u7ed3\u5408\u56fe\u5f62\u4f1a\u66f4\u597d\u7406\u89e3\uff08\u76ee\u7684\u662f\u5c06\u5355\u51cf\u7684\u5f62\u5f0f\u53d8\u4e3a\u5355\u589e\uff0c\u65b9\u4fbf\u7ef4\u62a4\uff09\u3002\n\n### **(2).\u3010\u51b3\u7b56\u70b9\u6a2a\u5750\u6807 X(j) \u4e0d\u5355\u8c03\u3011**\n\n> \u6ce8\u610f\uff1a$X(j)$ \u7684\u5355\u8c03\u6027\u4f1a\u5f71\u54cd**\u51f8\u5305\u7ef4\u62a4**\u65b9\u5f0f\u7684\u9009\u62e9\u3002\n\n**\u5982\u679c\u51b3\u7b56\u70b9\u6a2a\u5750\u6807 $X(j)$ \u4e0d\u5b58\u5728\u5355\u8c03\u6027\u8be5\u600e\u4e48\u529e\uff08\u65e2\u4e0d\u5355\u589e\u4e5f\u4e0d\u5355\u51cf\uff09\uff1f**  \n\uff08\u5047\u8bbe\u6b64\u65f6 $k_0[i]$ \u4ecd\u7136\u5355\u8c03\uff09\n\n\u6b64\u65f6\u7ef4\u62a4\u51f8\u5305\u5c31\u4e0d\u80fd\u7528\u5355\u8c03\u961f\u5217\u4e86\uff0c\u56e0\u4e3a\u63d2\u5165\u70b9\u65f6\u53ef\u80fd\u4f1a\u63d2\u5230\u51f8\u5305\u70b9\u96c6\u4e2d\u95f4\u7684\u67d0\u4e2a\u4f4d\u7f6e\uff0c\u800c\u961f\u5217\u662f\u4e0d\u652f\u6301\u8fd9\u79cd\u64cd\u4f5c\u7684\uff0c\u9700\u8981\u7528\u5230\u5e73\u8861\u6811\u7ef4\u62a4\u6216\u8005\u7528 $\\text{CDQ}$ \u5206\u6cbb\u63d0\u4f9b\u5355\u8c03\u6027\uff08\u540e\u9762\u4f1a\u8bb2\u5230\uff09\u3002  \n\u8fd9\u91cc\u6709\u8ba1\u7b97\u51e0\u4f55\u57fa\u7840\u7684\u8bdd\u4f1a\u66f4\u6613\u7406\u89e3\uff0c\u56e0\u4e3a\u4e0a\u9762\u7ef4\u62a4\u56fe\u5f62\u65f6\u7684\u5220\u70b9\u64cd\u4f5c\u4e0e\u6c34\u5e73\u5e8f $\\text{Graham}$ \u626b\u63cf\u6cd5\u6c42\u51f8\u5305\u662f\u7c7b\u4f3c\u7684\uff0c\u800c\u626b\u63cf\u6cd5\u7684\u524d\u63d0\u4e3a\uff1a\u70b9\u96c6\u5448\u6c34\u5e73\u5e8f\uff0c\u5373\u70b9\u4ece\u5de6\u81f3\u53f3\u4f9d\u6b21\u6392\u5217\uff08\u4f53\u73b0\u4e3a $X(j)$ \u5355\u8c03\u4e0d\u51cf\uff09\u3002\n\n### **(3).\u3010\u5f85\u51b3\u7b56\u70b9\u659c\u7387 K0[i] \u4e0d\u5355\u8c03\u3011**\n\n> \u6ce8\u610f\uff1a$k_0[i]$ \u7684\u5355\u8c03\u6027\u4f1a\u5f71\u54cd**\u5bfb\u627e\u6700\u4f18\u51b3\u7b56\u70b9**\u65b9\u5f0f\u7684\u9009\u62e9\u3002\n\n**\u5982\u679c\u659c\u7387 $k_0[i]$ \u4e0d\u5b58\u5728\u5355\u8c03\u6027\u8be5\u600e\u4e48\u529e\uff1f**  \n\uff08\u5047\u8bbe\u6b64\u65f6 $X(j)$ \u4ecd\u7136\u5355\u8c03\uff09\n\n\u6211\u4eec\u4ecd\u53ef\u4ee5\u7528\u961f\u5217\u7ef4\u62a4\u51f8\u5305\u70b9\u96c6\uff0c\u4f46\u4e0d\u77e5\u9053\u6bcf\u4e00\u6b21\u4f1a\u5728\u4ec0\u4e48\u5730\u65b9\u53d6\u5f97**\u6700\u4f18\u51b3\u7b56\u70b9**\uff0c\u6240\u4ee5\u5fc5\u987b\u8981\u4fdd\u7559\u6574\u4e2a\u51f8\u5305\u4ee5\u786e\u4fdd\u51b3\u7b56\u6709\u5b8c\u6574\u7684\u9009\u62e9\u7a7a\u95f4\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u80fd\u5f39\u8d70\u961f\u9996\uff0c\u540c\u65f6\u67e5\u627e\u7b54\u6848\u4e5f\u4e0d\u80fd\u76f4\u63a5\u53d6\u961f\u9996\uff0c\u53ea\u80fd\u4f7f\u7528\u4e8c\u5206\u3002  \n- [**\u3010\u6a21\u677f\u3011** \u4efb\u52a1\u5b89\u6392 $3$](https://www.luogu.com.cn/problem/P5785)\uff08\u53ef\u4ee5\u8bc1\u660e\u8be5\u9898\u4e0d\u5177\u6709\u51b3\u7b56\u5355\u8c03\u6027\uff09\n\n### **(4).\u3010X(j) \u4e0e K0[i]  \u5747\u4e0d\u5355\u8c03\u3011**\n\n\u73b0\u5728\u6765\u770b $k_0[i]$ \u4e0e $X(j)$ \u5747\u4e0d\u5355\u8c03\u7684\u60c5\u51b5\uff1a  \n\n\u6b64\u65f6\u65e0\u6cd5\u518d\u7528\u961f\u5217\u7ef4\u62a4\u51f8\u5305\u4e86\uff0c\u4f46\u5e73\u8861\u6811\u672c\u5c31\u652f\u6301\u67e5\u8be2\u524d\u9a71\u3001\u540e\u7ee7\uff0c\u76f4\u63a5\u628a $k_0[i]$ \u4e22\u8fdb\u53bb\u8be2\u95ee\u5373\u53ef\u3002\n\n\u800c $\\text{CDQ}$ \u5c31\u66f4\u6709\u610f\u601d\u4e86\uff1a\u5728 $(2)$ \u4e2d\u505a\u6cd5\u7684\u57fa\u7840\u4e0a\u6070\u597d\u8fd8\u80fd\u518d\u52a0\u4e00\u7ef4\u504f\u5e8f\uff01  \n\u6211\u4eec\u76f4\u63a5\u4eba\u4e3a\u5730\u6392\u51fa\u5355\u8c03\u6027\uff0c\u50cf\u666e\u901a\u5355\u8c03\u961f\u5217\u90a3\u6837\u7ef4\u62a4\u5c31\u53ef\u4ee5\u4e86\uff08\u4ee3\u7801\u653e\u540e\u9762\uff09\u3002\n- [**\u3010\u6a21\u677f\u3011** $\\text{Building Bridges}$](https://www.luogu.com.cn/problem/P4655) \n\n-------\n\n## **\u4e03.\u3010\u4f8b\u9898\u3011**\n\n### **1.\u3010\u9884\u5904\u7406DP \u521d\u59cb\u503c\u3011**\n\n- [\u6446\u6e21\u8f66 $\\text{[NOIP2018] [P5017]}$](https://www.luogu.org/problemnew/show/P5017)\n\n\u53bb\u5e74 $\\text{noip}$ \u666e\u53ca\u7ec4\u7684\u9898\uff08\u96fe\uff09\u3002\n\n#### **\u3010Code\u3011**\n\n```cpp\n#include<cstdio>\n#define Re register int\nconst int N=4e6+105;\nint i,j,n,m,h=1,t=0,T,ti,ans=2e9,G[N],S[N],Q[N],dp[N];\ninline int min(Re a,Re b){return a<b?a:b;}\n//                 i\n//dp[i]=min(dp[j]+ \u2211(i-T[k]))\n//                 k=j+1\n//dp[i]=dp[j]+(G[i]-G[j])*i-(S[i]-S[j])\n//(i) * G[j] + (dp[i]+S[j]-i*G[i]) = (dp[j]+S[j])\n// k  *  x   +          b          =      y\ninline int X(Re j){return G[j];}\ninline int Y(Re j){return dp[j]+S[j];}\ninline long double slope(Re i,Re j){return X(i)==X(j)?(Y(j)>Y(i)?2e9:-2e9):(long double)(Y(j)-Y(i))/(long double)(X(j)-X(i));}\nint main(){\n    scanf(\"%d%d\",&n,&m);\n    for(i=1;i<=n;T=-min(-T,-ti),++G[ti],S[ti]+=ti,++i)scanf(\"%d\",&ti);\n    for(i=1;i<T+m;++i)G[i]+=G[i-1],S[i]+=S[i-1];\n    for(i=0;i<m;++i)dp[i]=G[i]*i-S[i];//\u63d0\u524d\u5904\u7406dp\u521d\u59cb\u503c \n    Q[++t]=0;\n    for(i=m;i<T+m;++i){\n        while(h<t&&slope(Q[h],Q[h+1])<=i)++h;\n        dp[i]=dp[j=Q[h]]+(G[i]-G[j])*i-S[i]+S[j];\n           while(h<t&&slope(Q[t-1],Q[t])>=slope(Q[t-1],i-m+1))--t;\n        Q[++t]=i-m+1;//(j+1)+m<=i\n    }\n    for(i=T;i<T+m;++i)ans=min(ans,dp[i]);\n    printf(\"%d\",ans);\n}\n```\n\n### **2.\u3010\u5355\u8c03\u961f\u5217+\u4e8c\u5206\u3011**\n\n- [\u4efb\u52a1\u5b89\u6392 $1$ $\\text{[Loj10184]}$](https://loj.ac/problem/10184) [$\\text{[P2365]}$](https://www.luogu.org/problemnew/show/P2365)\n\n- [\u4efb\u52a1\u5b89\u6392 $2$ $\\text{[Loj10185]}$](https://loj.ac/problem/10185) [$\\text{[Poj1180]}$](http://poj.org/problem?id=1180)\n\n- [\u4efb\u52a1\u5b89\u6392 $3$ $\\text{[SDOI2012] [P5785]}$](https://www.luogu.com.cn/problem/P5785) [$\\text{[Loj10186]}$](https://loj.ac/problem/10186) [$\\text{[Bzoj2726]}$](https://www.lydsy.com/JudgeOnline/problem.php?id=2726)\n\n**\u3010\u9898\u76ee\u63cf\u8ff0\u3011**\n\n\u6709 $N$ \u4e2a\u4efb\u52a1\u7b49\u5f85\u5b8c\u6210\uff08\u987a\u5e8f\u4e0d\u5f97\u6539\u53d8\uff09\uff0c\u8fd9 $N$ \u4e2a\u4efb\u52a1\u88ab\u5206\u6210\u82e5\u5e72\u6279\uff0c\u6bcf\u6279\u5305\u542b\u76f8\u90bb\u7684\u82e5\u5e72\u4efb\u52a1\u3002\u4ece\u65f6\u523b $0$ \u5f00\u59cb\uff0c\u8fd9\u4e9b\u4efb\u52a1\u88ab\u5206\u6279\u52a0\u5de5\uff0c\u7b2c $i$ \u4e2a\u4efb\u52a1\u5355\u72ec\u5b8c\u6210\u6240\u9700\u7684\u65f6\u95f4\u662f $T_i$ \u3002\u53ea\u6709\u4e00\u53f0\u673a\u5668\uff0c\u5728\u6bcf\u6279\u4efb\u52a1\u5f00\u59cb\u524d\uff0c\u673a\u5668\u9700\u8981\u542f\u52a8\u65f6\u95f4 $S$\uff0c\u5b8c\u6210\u8fd9\u6279\u4efb\u52a1\u6240\u9700\u7684\u65f6\u95f4\u662f\u5404\u4e2a\u4efb\u52a1\u9700\u8981\u65f6\u95f4\u7684\u603b\u548c\uff08\u540c\u4e00\u6279\u4efb\u52a1\u5c06\u5728\u540c\u4e00\u65f6\u523b\u5b8c\u6210\uff09\u3002\u6bcf\u4e2a\u4efb\u52a1\u7684\u8d39\u7528\u662f\u5b83\u7684\u5b8c\u6210\u65f6\u523b\u4e58\u4ee5\u5b83\u7684\u8d39\u7528\u7cfb\u6570 $F_i$\u3002\u8bf7\u786e\u5b9a\u4e00\u4e2a\u5206\u7ec4\u65b9\u6848\uff0c\u4f7f\u5f97\u603b\u8d39\u7528\u6700\u5c0f\u3002\n\n**\u3010\u6570\u636e\u8303\u56f4\u3011**\n\n$T1:$ $1 \\leqslant N \\leqslant 5000, 0 \\leqslant S \\leqslant 50,1 \\leqslant T_i, F_i \\leqslant 100$\n\n$T2:$ $1 \\leqslant N \\leqslant 10000, 0 \\leqslant S \\leqslant 50,1 \\leqslant T_i, F_i \\leqslant 100$\n\n$T3:$ $1 \\leqslant N \\leqslant 300000, 1 \\leqslant S\\leqslant 512,0 \\leqslant F_i \\leqslant 512,|T_i| \\leqslant 512$\n\n#### **(1).\u3010T1\u3011**\n\n\u8bbe $ST[i]=\\sum_{j=1}^i T[j],SF[i]=\\sum_{j=1}^i F[j]$\n\n$\\text{dp}$ \u65b9\u7a0b\u5f88\u7b80\u5355\uff1a$dp[p][i]=\\min(dp[p-1][j]+(ST[i]+p\\times S)(SF[i]-SF[j]))$\uff0c\u4f46\u662f $O(n^3)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u8fde $T1$ \u90fd\u8fc7\u4e0d\u4e86\u3002\n\n\u7531\u4e8e\u4e0d\u77e5\u9053\u6bcf\u4e00\u6b21\u5206\u6bb5\u4e4b\u524d\u5df2\u7ecf\u5206\u4e86\u591a\u5c11\uff0c\u6240\u4ee5\u9700\u8981\u7528\u4e00\u7ef4\u7a7a\u95f4\u548c\u4e00\u5c42\u5faa\u73af\u6765\u8868\u793a\u8fd9\u4e2a\u4fe1\u606f\uff0c\u4ece\u800c\u77e5\u9053 $S$ \u9700\u8981\u4e58\u4ee5\u591a\u5c11\u3002\n\n\u90a3\u4e48\u53ef\u4ee5\u53cd\u8fc7\u6765\uff0c\u7528\u4e00\u79cd\u540d\u4e3a**\u8d39\u7528\u63d0\u524d\u8ba1\u7b97**\u7684\u7ecf\u5178\u601d\u60f3\u6765\u8fdb\u884c\u4f18\u5316\uff08\u636e\u8bf4\u8fd9\u4e2a\u53eb\u672a\u6765 $\\text{dp}$\uff09\uff0c\u6bcf\u5206\u51fa\u4e00\u6279\u4efb\u52a1\uff0c\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u4e4b\u540e\u7684\u6bcf\u4e00\u4e2a\u4efb\u52a1\u90fd\u9700\u8981\u591a\u51fa\u4e00\u4e2a $S$ \u7684\u65f6\u95f4\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97 $S$ \u5bf9\u540e\u9762\u7684\u5f71\u54cd\u3002\n\u5373\uff1a$dp[i]=\\min(dp[j]+ST[i](SF[i]-SF[j])+S(SF[n]-SF[j]))$\n\u538b\u6210\u4e86 $O(n^2)$ \u540e\uff0c$T1$ \u5c31\u53ef\u4ee5 $\\text{AC}$ \u4e86\uff0c\u4f46\u5b83\u8fd8\u80fd\u7ee7\u7eed\u4f18\u5316\u3002\n\n#### **(2).\u3010T2\u3011**\n\n\u5148\u8f6c\u5316\u4e3a\u659c\u7387\u5f0f\u770b\u770b\uff1f\n$(S+ST[i]) * SF[j] + (dp[i]-ST[i]*SF[i]-S\\times SF[i]) = (dp[j])$\n\u5176\u4e2d $k=S+ST[i],$ $x=SF[j],$ $b=dp[i]-ST[i]\\times SF[i]-S\\times SF[i],$ $y=dp[j]$ \u3002\n\n\u51b3\u7b56\u70b9\u8981\u4f7f\u5f97 $dp[i]$ \u5c3d\u91cf\u5c0f\uff0c\u4e14 $S+ST[i]$ \u548c $SF[j]$ \u90fd\u4e25\u683c\u5355\u589e\uff0c\u6240\u4ee5\u76f4\u63a5\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u5305\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n)$ \u3002\n\n**\u3010Code\u3011**\n\n```cpp\n#include<cstring>\n#include<cstdio>\n#define LL long long\n#define Re register LL\nconst int N=1e4+5;\nLL i,j,n,h=1,t=0,S,Q[N],ST[N],SF[N],dp[N];\n//dp[p][i]=min(dp[p-1][j]+(ST[i]+S*p)*(SF[i]-SF[j]));\n//dp[i]=dp[j]+ST[i]*(SF[i]-SF[j])+S*(SF[n]-SF[j]);\n//(S+ST[i]) * SF[j] + (dp[i]-ST[i]*SF[i]-S*SF[i]) = (dp[j])\n//    k     *   x   +              b              = y\ninline LL min(Re a,Re b){return a<b?a:b;}\ninline LL X(Re j){return SF[j];}\ninline LL Y(Re j){return dp[j];}\ninline long double slope(Re i,Re j){return (long double)(Y(j)-Y(i))/(X(j)-X(i));}\nint main(){\n    scanf(\"%lld%lld\",&n,&S);\n    for(i=1;i<=n;ST[i]+=ST[i-1],SF[i]+=SF[i-1],++i)scanf(\"%lld%lld\",&ST[i],&SF[i]);\n    Q[++t]=0;\n    for(i=1;i<=n;++i){\n        while(h<t&&slope(Q[h],Q[h+1])<(S+ST[i]))++h;\n        dp[i]=dp[j=Q[h]]+ST[i]*(SF[i]-SF[j])+S*(SF[n]-SF[j]);\n        while(h<t&&slope(Q[t-1],Q[t])>slope(Q[t-1],i))--t;\n        Q[++t]=i;\n    }\n    printf(\"%lld\",dp[n]);\n}\n```\n\n#### **(3).\u3010T3\u3011**\n\n\u56e0 $F_i$ \u53ef\u7b49\u4e8e $0$\uff0c$X(j)$ $($ \u5373 $SF[i])$ \u975e\u4e25\u683c\u9012\u589e\uff0c\u6240\u4ee5\u9700\u8981\u7279\u5224 $X(j_1)=X(j_2)$ \u7684\u60c5\u51b5\uff08\u4f46\u4ecd\u5177\u6709\u5355\u8c03\u6027\uff0c\u53ef\u4ee5\u4f7f\u7528\u961f\u5217\u7ef4\u62a4\u51f8\u5305\uff09\u3002\n\n\u56e0 $T_i$ \u53ef\u5c0f\u4e8e $0$\uff0c$k_0[i]($ \u5373 $S+ST[i])$ \u65e0\u5355\u8c03\u6027\uff0c\u6240\u4ee5\u4e0d\u5177\u6709\u51b3\u7b56\u5355\u8c03\u6027\uff0c\u53ef\u4ee5\u7528\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\u8fdb\u884c\u8bc1\u660e\uff1a\n\n\u8be5 $\\text{dp}$ \u65b9\u7a0b\u663e\u7136\u4e3a $dp[i]=dp[j]+w(i,j)$ \u7684\u5f62\u5f0f\uff0c\u5176\u4e2d $w(i,j)=ST[i](SF[i]-SF[j])+S(SF[n]-SF[j])$ \u3002  \n\n$\\text{\u8bc1\u660e\uff1a}$ $\\text{\u8bbe}$ $Q=S(SF[n]-SF[j])$  \n\n$\\therefore w(i,j)=ST[i](SF[i]-SF[j])+Q$  \n\n$\\begin{aligned}\n\\therefore w(i+1,j+1)=&ST[i+1]SF[i+1]-ST[i+1]SF[j+1]+S(SF[n]-SF[j+1])\\\\\n                              =&ST[i+1]SF[i+1]-SF[j+1]*(ST[i]+T[i+1])+Q-S\\times F[j+1]\\\\\n\\end{aligned}$  \n\n$\\begin{aligned}\nw(i,j+1)=&ST[i](SF[i]-SF[j+1])+Q-S\\times F[j+1]\\\\\n           =&ST[i]SF[i]-ST[i]SF[j+1]+Q-S\\times F[j+1]\\\\\n\\end{aligned}$  \n\n$\\begin{aligned}\nw(i+1,j)=&ST[i+1](SF[i+1]-SF[j])+Q\\\\\n           =&ST[i+1]SF[i+1]-ST[i+1]SF[j]+Q\\\\\n           =&ST[i+1]SF[i+1]-ST[i]SF[j]-T[i+1]SF[j]+Q\n\\end{aligned}$  \n\n$\\therefore w(i,j)+w(i+1,j+1)=ST[i](SF[i]-SF[j])+ST[i+1]SF[i+1]-SF[j+1](ST[i]+T[i+1])+2Q-S\\times F[j+1]$  \n\n$\\therefore w(i+1,j)+w(i,j+1)=ST[i]SF[i]-ST[i]SF[j+1]+ST[i+1]SF[i+1]-ST[i]SF[j]-T[i+1]SF[j]+2Q-S\\times F[j+1]$  \n\n$\\therefore w(i,j)+w(i+1,j+1)-w(i+1,j)+w(i,j+1)=-F[j+1]*T[i+1]$  \n$\\text{\u53c8} \\because 0 \\leqslant F_i \\leqslant 512,-512 \\leqslant T_i \\leqslant 512$  \n\n$\\therefore \\text{\u5f53} T_i \\leqslant 0 \\text{\u65f6},w(i,j)+w(i+1,j+1) \\geqslant w(i+1,j)+w(i,j+1)$  \n\n$\\text{\u5f53} T_i \\geqslant 0 \\text{\u65f6},w(i,j)+w(i+1,j+1) \\leqslant w(i+1,j)+w(i,j+1)$\n\n\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\u4e0d\u4e00\u5b9a\u6210\u7acb\uff0c\u6240\u4ee5\u6b64\u9898\u4e0d\u5177\u6709\u51b3\u7b56\u5355\u8c03\u6027\u3002  \n\u8bc1\u6bd5\u3002\n\n\u6b64\u65f6\u9700\u8981\u5728\u961f\u5217\u4e2d\u4e8c\u5206\u67e5\u627e\u6700\u4f18\u51b3\u7b56\u70b9\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$ \u3002\n\n**\u3010Code\u3011**\n\n```cpp\n#include<cstring>\n#include<cstdio>\n#define LL long long\n#define Re register LL\nconst int N=3e5+5;\nLL i,j,n,h=1,t=0,S,Q[N],ST[N],SF[N],dp[N];\n//dp[p][i]=min(dp[p-1][j]+(ST[i]+S*p)*(SF[i]-SF[j]));\n//dp[i]=dp[j]+ST[i]*(SF[i]-SF[j])+S*(SF[n]-SF[j]);\n//(S+ST[i]) * SF[j] + (dp[i]-ST[i]*SF[i]-S*SF[i]) = (dp[j])\n//    k     *   x   +              b              = y\n//ti\u53ef\u5c0f\u4e8e0\uff0c\u6240\u4ee5ST[i]\u975e\u9012\u589e\uff0c\u53ea\u53ef\u4e8c\u5206\n//fi\u53ef\u7b49\u4e8e0\uff0c\u6240\u4ee5SF[i](X)\u975e\u4e25\u683c\u9012\u589e\uff0c\u56e0\u6b64\u9700\u8981\u7279\u5224X(i)==X(j)\u7684\u60c5\u51b5\ninline LL min(Re a,Re b){return a<b?a:b;}\ninline LL X(Re j){return SF[j];}\ninline LL Y(Re j){return dp[j];}\ninline long double slope(Re i,Re j){return X(j)==X(i)?(Y(j)>=Y(i)?1e18:-1e18):(long double)(Y(j)-Y(i))/(X(j)-X(i));\n}//\u7531\u4e8e\u9700\u8981\u4e8c\u5206\u67e5\u627e\uff0c\u591a\u4e86\u4e00\u4e9b\u9650\u5236\uff1a\u961f\u5217\u91cc\u4e0d\u80fd\u6709\u5728\u540c\u4e00\u4f4d\u7f6e\u7684\u70b9,\u8fd4\u56deinf\u8fd8\u662f-inf\u90fd\u5f71\u54cd\u7740\u662f\u5426\u5220\u9664\u91cd\u70b9\uff0c\u5e73\u65f6\u4e0d\u53ef\u4e0d\u7ba1\uff0c\u4e8c\u5206\u5fc5\u987b\u6ce8\u610f\u8fd4\u56de\u503c\ninline LL sakura(Re k){\n    if(h==t)return Q[h];\n    Re l=h,r=t;\n    while(l<r){\n        Re mid=l+r>>1,i=Q[mid],j=Q[mid+1];\n        if(slope(i,j)<k)l=mid+1;\n//      if( (Y(j) - Y(i)) < k * (X(j) - X(i)) )l=mid+1;//\u6ce8\u610f\u662f(j)-(i)\u56e0\u4e3aQ[mid+1]>Q[mid]s\u5373j>i\u5373SF[j]>SF[i]\u5373X(j)>X(i)\uff0c\u5982\u679c\u662f(i)-(j)\u7684\u8bdd\u4e58\u8fc7\u53bb\u8981\u53d8\u53f7\n        else r=mid;\n    }\n    return Q[l];\n}\nint main(){\n    scanf(\"%lld%lld\",&n,&S);\n    for(i=1;i<=n;ST[i]+=ST[i-1],SF[i]+=SF[i-1],++i)scanf(\"%lld%lld\",&ST[i],&SF[i]);\n    Q[++t]=0;\n    for(i=1;i<=n;++i){\n        j=sakura(S+ST[i]);\n        dp[i]=dp[j]+ST[i]*(SF[i]-SF[j])+S*(SF[n]-SF[j]);\n        while(h<t&&slope(Q[t-1],Q[t])>=slope(Q[t-1],i))--t;//\u6b64\u5904\u53d6\u7b49\u53f7\u4f5c\u7528\u51fa\u73b0\uff0c\u5982\u679c\u4e0d\u53d6\u7b49\uff0c\u4f1aWA\u7b2c12\u4e2a\u70b9\n        Q[++t]=i;\n    }\n    printf(\"%lld\",dp[n]);\n}\n```\n\n### **3.\u3010CDQ/\u5e73\u8861\u6811\u3011**\n\n\u56e0\u4e3a\u6682\u65f6\u6ca1\u627e\u5230 $X(j)$ \u4e0d\u5355\u8c03\u3001$k_0[i]$ \u5355\u8c03\u7684\u4f8b\u9898\uff0c\u8fd9\u91cc\u76f4\u63a5\u8bb2\u4e24\u8005\u5747\u4e0d\u5355\u8c03\u7684\u60c5\u51b5\u3002\n\n- [$\\text{Building Bridges [CEOI2017] [P4655]}$](https://www.luogu.com.cn/problem/P4655)\n\n\u5982\u679c\u5b66\u4e60\u4e86\u52a8\u6001\u51f8\u5305\u7b97\u6cd5\uff0c\u4f1a\u53d1\u73b0\u8fd9\u5176\u5b9e\u5c31\u662f\u5957\u4e86\u4e2a\u677f\u5b50\u4e0a\u53bb\uff08\u5e73\u8861\u6811\u4ee3\u7801\u8f83\u6bd2\u7624\u5c31\u4e0d\u653e\u4e86\uff09\u3002\n\n$\\text{CDQ}$ \u505a\u6cd5\u4e5f\u6bd4\u8f83\u663e\u7136\uff0c\u4f46\u56e0\u4e3a\u9012\u5f52\u8fc7\u7a0b\u4e0d\u597d\u63cf\u8ff0\uff0c\u76f4\u63a5\u770b\u4ee3\u7801\u6ce8\u91ca\u5427\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$\u3002\n\n#### **\u3010Code\u3011**\n\n```cpp\n#include<algorithm>\n#include<cstring>\n#include<cstdio>\n#define LD long double\n#define LL long long\n#define Re register int\n#define S2(a) (1ll*(a)*(a))\nusing namespace std;\nconst LL N=1e5+3,inf=1e18;\nint n,H[N],W[N],Q[N];LL S[N],dp[N];\ninline void in(Re &x){\n    int f=0;x=0;char c=getchar();\n    while(c<'0'||c>'9')f|=c=='-',c=getchar();\n    while(c>='0'&&c<='9')x=(x<<1)+(x<<3)+(c^48),c=getchar();\n    x=f?-x:x;\n}\n//dp[i]=min(dp[i],dp[j]+(H[i]-H[j])*(H[i]-H[j])+S[i-1]-S[j]);\n//dp[i]=dp[j]-2*H[i]*H[j]+H[j]*H[j]+H[i]*H[i]+S[i-1]-S[j]\n//(2*H[i]) * H[j] + (dp[i]-S[i-1]-H[i]*H[i]) = (dp[j]+H[j]*H[j]-S[j])\n//   k     *  x   +            b             =          y\n#define X(j) (a[j].x)\n#define Y(j) (a[j].y)\nstruct QAQ{\n    int k,x,id;LL y;\n    inline bool operator<(const QAQ &O)const{return x!=O.x?x<O.x:y<O.y;}\n}a[N],b[N];\ninline bool cmp(QAQ A,QAQ B){return A.k<B.k;}\ninline LD slope(Re i,Re j){return X(i)==X(j)?(Y(j)>Y(i)?inf:-inf):(LD)(Y(j)-Y(i))/(X(j)-X(i));}\ninline void CDQ(Re L,Re R){\n    if(L==R){Re j=a[L].id;a[L].y=dp[j]+(LL)H[j]*H[j]-S[j];return;}//\u6b64\u65f6dp[j]\u5fc5\u5b9a\u5df2\u7ecf\u6c42\u51fa\u6765\u4e86\uff0c\u76f4\u63a5\u7b97\u8ba1Y(j)\u5373\u53ef\n    Re mid=L+R>>1,p1=L,p2=mid+1,h=1,t=0;\n    for(Re i=L;i<=R;++i)a[i].id<=mid?b[p1++]=a[i]:b[p2++]=a[i];//\u6309\u7167i\u7684\u5927\u5c0f\u5206\u5230\u5de6\u53f3\u4e24\u8fb9\uff08\u4e24\u8fb9\u7684k0[i]\u5206\u522b\u9012\u589e\uff09\n    for(Re i=L;i<=R;++i)a[i]=b[i];\n    CDQ(L,mid);//\u5904\u7406\u5b8c\u5de6\u8fb9\u540e\uff0c\u5de6\u8fb9\u7684X(j)\u662f\u9012\u589e\u7684\uff0c\u6b64\u65f6\u53f3\u8fb9\u8fd8\u6ca1\u5904\u7406\uff0c\u6240\u4ee5\u53f3\u8fb9k0[i]\u662f\u9012\u589e\u7684\n    for(Re i=L;i<=mid;++i){//\u628a\u5de6\u8fb9\u7684\u70b9\u62ff\u51fa\u6765\u7ef4\u62a4\u51f8\u5305\uff08\u4f7f\u7528\u5355\u8c03\u961f\u5217\uff09\n        while(h<t&&slope(Q[t-1],Q[t])>=slope(Q[t-1],i))--t;\n        Q[++t]=i;\n    }\n    for(Re i=mid+1,j,id;i<=R;++i){//\u628a\u53f3\u8fb9\u7684\u70b9\u62ff\u6765\u51b3\u7b56\uff08\u4f9d\u65e7\u662f\u5355\u8c03\u961f\u5217\uff09\n        while(h<t&&slope(Q[h],Q[h+1])<=a[i].k)++h;\n        if(h<=t)id=a[i].id,j=Q[h],dp[id]=min(dp[id],a[j].y-(LL)a[i].k*a[j].x+S[id-1]+(LL)H[id]*H[id]);\n    }\n    CDQ(mid+1,R);//\u5904\u7406\u5b8c\u53f3\u8fb9\u540e\uff0c\u4e24\u8fb9\u90fd\u6309\u7167X(j)\u6392\u597d\u4e86\u5e8f\n    Re w=L-1;p1=L,p2=mid+1;//\u628a\u4e24\u8fb9\u6309\u7167X(j)\u4ece\u5c0f\u5230\u5927\u5f52\u5e76\u8d77\u6765\n    while(p1<=mid&&p2<=R)b[++w]=a[p1]<a[p2]?a[p1++]:a[p2++];\n    while(p1<=mid)b[++w]=a[p1++];while(p2<=R)b[++w]=a[p2++];\n    for(Re i=L;i<=R;++i)a[i]=b[i];\n}\nint main(){\n//    freopen(\"123.txt\",\"r\",stdin);\n    in(n);\n    for(Re i=1;i<=n;++i)in(H[i]);\n    for(Re i=1;i<=n;++i)in(W[i]);\n    for(Re i=1;i<=n;++i)S[i]=S[i-1]+W[i],dp[i]=inf;\n    for(Re i=1;i<=n;++i)a[i].k=(H[i]<<1),a[i].x=H[i],a[i].id=i;\n    sort(a+1,a+n+1,cmp);//\u5148\u6309k0[i]\u6392\u5e8f\n    dp[1]=0,CDQ(1,n);//\u6ce8\u610f\u5de6\u8fb9\u754c\u4e0a\u7684\u70b9\u8981\u5355\u72ec\u6c42\n    printf(\"%lld\\n\",dp[n]);\n}\n```\n\n### **4.\u3010\u9898\u76ee\u94fe\u63a5\u3011**\n\n- [\u73a9\u5177\u88c5\u7bb1 $\\text{toy [HNOI2008] [P3195]}$](https://www.luogu.org/problemnew/show/P3195)\n\n- [\u571f\u5730\u5f81\u7528 $\\text{Land Acquisition G [P2900]}$](https://www.luogu.org/problemnew/show/P2900)\n\n- [\u5f81\u9014 $\\text{[SDOI2016] [P4072]}$](https://www.luogu.org/problemnew/show/P4072)\n\n- [$\\text{Cats Transport}$](https://www.luogu.com.cn/problem/CF311B) [$\\text{[CF311B]}$](http://codeforces.com/problemset/problem/311/B)\n\n- [\u6446\u6e21\u8f66 $\\text{[NOIP2018] [P5017]}$](https://www.luogu.org/problemnew/show/P5017)\n\n- [\u4ed3\u5e93\u5efa\u8bbe $\\text{[ZJOI2007] [P2120]}$](https://www.luogu.com.cn/problem/P2120)\n\n- [\u5e8f\u5217\u5206\u5272 $\\text{[APIO2014] [P3648]}$](https://www.luogu.com.cn/problem/P3648)\n\n- [\u4efb\u52a1\u5b89\u6392 $2$ $\\text{[Loj10185]}$](https://loj.ac/problem/10185) [$\\text{[Poj1180]}$](http://poj.org/problem?id=1180)\n\n- [\u952f\u6728\u5382\u9009\u5740 $\\text{[CEOI2004] [P4360]}$](https://www.luogu.com.cn/problem/P4360)\n\n- [\u7279\u522b\u884c\u52a8\u961f $\\text{[APIO2010] [P3628]}$](https://www.luogu.com.cn/problem/P3628)\n\n- [\u56fd\u738b\u996e\u6c34\u8bb0 $\\text{[NOI2016] [P1721]}$](https://www.luogu.org/problemnew/show/P1721)\n\n\uff08\u4ee5\u6b64\u5904\u4e3a\u5206\u754c\u7ebf\uff0c\u4e0a\u9762\u90fd\u662f $X(j)$ \u4e0e $k_0[i]$ \u5747\u5355\u8c03\u7684\u4f8b\u5b50\uff09\n\n- [\u4efb\u52a1\u5b89\u6392 $3$ $\\text{[SDOI2012] [P5785]}$](https://www.luogu.com.cn/problem/P5785) [$\\text{[Loj10186]}$](https://loj.ac/problem/10186) [$\\text{[Bzoj2726]}$](https://www.lydsy.com/JudgeOnline/problem.php?id=2726)\uff08$X(j)$ \u5355\u8c03 $k_0[i]$ \u4e0d\u5355\u8c03\uff09\n\n- [\u9ad8\u901f\u516c\u8def $\\text{[P3994]}$](https://www.luogu.com.cn/problem/P3994)\uff08$X(j)$ \u5355\u8c03 $k_0[i]$ \u4e0d\u5355\u8c03\u3002\u6811\u4e0a\u8f6c\u79fb\uff09\n\n- [\u8d2d\u7968 $\\text{[NOI2014] [P2305]}$](https://www.luogu.org/problemnew/show/P2305)\uff08$X(j)$ \u5355\u8c03 $k_0[i]$ \u4e0d\u5355\u8c03\u3002\u6811\u4e0a\u8f6c\u79fb\uff09\n\n- [$\\text{Building Bridges [CEOI2017] [P4655]}$](https://www.luogu.com.cn/problem/P4655)\uff08$X(j)$ \u4e0e $k_0[i]$ \u5747\u4e0d\u5355\u8c03\uff09\n\n- [\u8d27\u5e01\u5151\u6362 $\\text{[NOI2007] [P4027]}$](https://www.luogu.com.cn/problem/P4027)\uff08$X(j)$ \u4e0e $k_0[i]$ \u5747\u4e0d\u5355\u8c03\uff09\n\n--------\n\n## **\u3010\u53c2\u8003\u8d44\u6599\u3011**\n\n\uff08\u672c\u6587\u90e8\u5206\u5185\u5bb9\u6458\u81ea\u4ee5\u4e0b\u6587\u7ae0\uff09\n\n- [\u51f8\u5305\u2014\u767e\u5ea6\u767e\u79d1](https://baike.baidu.com/item/%E5%87%B8%E5%8C%85/179150?fr=aladdin)\n\n- [$\\text{DP}$ \u7684\u5404\u79cd\u4f18\u5316](https://www.cnblogs.com/flashhu/p/9480669.html)\n\n- [\u659c\u7387\u4f18\u5316\u5b66\u4e60\u7b14\u8bb0](https://www.cnblogs.com/MashiroSky/p/6009685.html)\n\n- [\u659c\u7387\u4f18\u5316\u53ca\u5176\u53d8\u5f62](https://www.cnblogs.com/Parsnip/p/10832015.html)\n\n- [\u659c\u7387\u4f18\u5316 $\\text{DP}$ \u53ca\u603b\u7ed3](https://blog.csdn.net/weixin_34402408/article/details/94027981)\n\n- [\u9898\u89e3 $P3195$\u2014$xyz32768$](https://www.luogu.org/blog/user29936/solution-p3195)\n\n- [\u300e\u4efb\u52a1\u5b89\u6392 \u659c\u7387\u4f18\u5316\u53ca\u5176\u53d8\u5f62\u300f](https://www.cnblogs.com/Parsnip/p/10832015.html)",
        "postTime": 1563496126,
        "uid": 110985,
        "name": "\u8fb0\u661f\u51cc",
        "ccfLevel": 9,
        "title": "\u3010\u5b66\u4e60\u7b14\u8bb0\u3011\u52a8\u6001\u89c4\u5212\u2014\u659c\u7387\u4f18\u5316DP\uff08\u8d85\u8be6\u7ec6\uff09"
    },
    {
        "content": "**\u659c\u7387\u4f18\u5316\u52a8\u6001\u89c4\u5212**\u53ef\u4ee5\u7528\u6765\u89e3\u51b3\u8fd9\u9053\u9898\u3002\u540c\u65f6\u8fd9\u4e5f\u662f\u4e00\u9053\u7ecf\u5178\u7684\u659c\u7387\u4f18\u5316\u57fa\u7840\u9898\u3002\n\n**\u5206\u6790**\uff1a\u660e\u663e\u662f\u52a8\u6001\u89c4\u5212\u3002\u4ee4$dp[i]$\u4e3a\u524d$i$\u4e2a\u88c5\u7bb1\u7684\u6700\u5c0f\u82b1\u8d39\u3002\n\u8f6c\u79fb\u65b9\u7a0b\u5982\u4e0b\uff1a\n$$dp[i]=\\min\\limits_{0 \\leq j < i} \\{ dp[j]+( \\sum \\limits_{k = j + 1}^{i}{C_k} + i - j - 1 - L) ^ 2\\}$$\n\n\u7528$sum[i]$\u8868\u793a\u524d$i$\u4e2a\u5bb9\u5668\u7684\u957f\u5ea6\u4e4b\u548c\uff08\u5373$C$\u7684\u524d\u7f00\u548c\uff09\uff0c\u65b9\u7a0b\u7b80\u5316\u4e3a\uff1a\n$$dp[i]=\\min\\limits_{0 \\leq j < i} \\{ dp[j]+( sum[i]-sum[j] + i - j - 1 - L) ^ 2\\}$$\n\n\u53c8\u4ee4$f[i]$\u4e3a$sum[i]+i$\uff0c\u7ee7\u7eed\u7b80\u5316\u65b9\u7a0b\u4e3a\uff1a\n$$dp[i]=\\min\\limits_{0 \\leq j < i} \\{ dp[j]+( f[i]-f[j] - 1 - L) ^ 2\\}$$\n\n\u66b4\u529bdp\u662f$O(n^2)$\uff0c\u8003\u8651\u4f18\u5316\u3002\u5982\u4f55\u4f18\u5316\uff0c\u5c31\u662f\u7528\u524d\u9762\u6240\u63d0\u5230\u7684**\u659c\u7387\u4f18\u5316**\u3002\u8fd9\u73a9\u610f\u5230\u5e95\u662f\u4ec0\u4e48\uff1f\u6211\u4eec\u5148\u6765\u7ee7\u7eed\u5bf9\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u8fdb\u884c\u8fdb\u4e00\u6b65\u7684\u63a8\u5bfc\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a$dp[i]$\u53ef\u4ee5\u77e5\u9053\u90fd\u662f\u7531\u4e00\u4e2a$j0$\u63a8\u8fc7\u6765\u7684\u3002\u8fd9\u4e2a$j0$\u5bf9\u4e8e\u5f53\u524d\u7684$i$\u662f\u6700\u4f18\u7684\u51b3\u7b56\u3002\u5047\u8bbe\u73b0\u5728\u6709\u4e24\u4e2a\u51b3\u7b56$j_1,j_2 (1 \\leq j_1 < j_2 < i)$\uff0c\u4e14\u51b3\u7b56$j_2$\u4f18\u4e8e$j_1$\uff0c\u5219\u6709\uff1a\n$$dp[j_1]+( f[i]-f[j_1] - 1 - L) ^ 2 \\geq dp[j_2]+( f[i]-f[j_2] - 1 - L) ^ 2$$\n\n\u62c6\u5f00\u53ef\u5f97\uff1a\n$$dp[j_1]+f[i]^2-2f[i](f[j_1]+1+L)+(f[j_1]+L+1)^2 \\geq dp[j_2]+f[i]^2-2f[i](f[j_2]+1+L)+(f[j_2]+L+1)^2$$\n\n\u5316\u7b80\u53ef\u5f97\uff1a\n$$2f[i](f[j_2] + 1 + L)-2f[i](f[j_1] + 1 + L) \\geq dp[j_2]+(f[j_2]+1+L)^2 - (dp[j_1]+(f[j_1]+1+L)^2)$$\n\n\u5373\uff1a\n$$2f[i] \\geq \\frac{dp[j_2]+(f[j_2]+1+L)^2 - (dp[j_1]+(f[j_1]+1+L)^2)}{f[j_2]-f[j_1]}$$\n\u4ee4$g[i] = (f[i]+L+1)^2$\uff0c\u53ef\u5f97\uff1a\n$$2f[i] \\geq \\frac{dp[j_2]+g[j_2] - (dp[j_1]+g[j_1])}{f[j_2]-f[j_1]}$$\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u82e5$j1,j2$\u6ee1\u8db3\u4e0a\u9762\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u90a3\u4e48$j2$\u4e00\u5b9a\u6bd4$j1$\u4f18\u3002\n\n\u4e3a\u4ec0\u4e48\u53eb\u659c\u7387\u4f18\u5316\uff1f\u56e0\u4e3a\u4e0a\u9762\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u628a\u770b\u4f5c$dp[i]+g[i]$\u770b\u505a\u7eb5\u5750\u6807\uff0c$f[i]$\u770b\u505a\u6a2a\u5750\u6807\uff0c\u4e0a\u9762\u7684\u7b49\u5f0f\u53f3\u4fa7\u5c31\u76f8\u5f53\u4e8e$\\frac{\\Delta y}{\\Delta x}=k$\u4e5f\u5c31\u662f\u4e00\u4e2a\u4e00\u6b21\u51fd\u6570\u7684\u659c\u7387\u3002\u5f53\u8fd9\u4e2a\u659c\u7387$k \\leq 2f[i]$\u5219$j_2$\u4f18\u4e8e$j_1$\u3002\n\n\u5047\u5982\u6211\u4eec\u6709\u4e09\u4e2a\u51b3\u7b56$j_1,j_2,j_3$\uff08\u5982\u4e0b\u56fe\uff09\n![](https://cdn.luogu.com.cn/upload/pic/20775.png)\n\n\u5bb9\u6613\u8bc1\u660e\uff1a$j_2$\u4e0d\u53ef\u80fd\u662f\u6700\u4f18\u7684\u3002\n\u8fd9\u6837\u4e00\u6765\uff0c\u6bcf\u4e24\u4e2a\u51b3\u7b56\u95f4\u7684\u659c\u7387\u4fbf\u662f**\u5355\u8c03\u4e0a\u5347\u7684**\u3002\n\n\u6240\u4ee5\u6709\u4e24\u79cd\u505a\u6cd5\uff1a\n- \u5bf9\u4e8e$dp[i]$\uff0c\u6709\u4e86\u659c\u7387\u5355\u8c03\u4e0a\u5347\u8fd9\u4e2a\u6761\u4ef6\uff0c\u5c31\u53ef\u4ee5\u53bb\u4e8c\u5206\u6700\u4f18\u7684\u51b3\u7b56\u70b9\uff08\u4e5f\u5c31\u662f\u659c\u7387\u5c0f\u4e8e$2f[i]$\u7684\uff09\u3002\u590d\u6742\u5ea6$O(n \\log n)$\u3002\n- \u53c8\u56e0\u4e3a$f[i]$\u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u6765\u7ef4\u62a4\u3002\u5177\u4f53\u5b9e\u73b0\u5c31\u662f\uff0c\u628a\u51b3\u7b56\u653e\u8fdb\u4e00\u4e2a\u5355\u8c03\u961f\u5217\u91cc\uff0c\u5982\u679c\u961f\u9996\u548c\u5f53\u524d\u7684$i$\u95f4\u7684\u659c\u7387 $<f[i]$\uff0c\u5c31\u628a\u961f\u9996\u5220\u6389\uff08\u5373h++\uff09\u3002\u5bf9\u4e8e\u961f\u5c3e\uff0c\u5c31\u6bcf\u6b21\u628a\u52a0\u5165$i$\u540e\u4e0d\u6ee1\u8db3\u659c\u7387\u5355\u8c03\u4e0a\u5347\u7684\u961f\u5c3e\u5168\u90e8\u5220\u6389\uff08\u5373t--\uff09\uff0c\u6700\u540e\u628a$i$\u653e\u8fdb\u5355\u8c03\u961f\u5217\u5c31\u597d\u4e86\u3002\n\n\u6ce8\u610f\u4e8b\u9879\uff1a\n**long long**.\n**\u8fd8\u6709 $g[0]=(L + 1) ^ 2 $\u800c\u4e0d\u662f$0$!!!!**~~\uff08\u56e0\u4e3a\u8fd9\u4e2a\u6211\u8c03\u4e86\u5f88\u4e45\uff09~~\n\n\u7ed9\u4e00\u4e0b\u5355\u8c03\u961f\u5217\u505a\u6cd5\u7684\u4ee3\u7801\uff1a\n```cpp\n#include <iostream>\n#include <cstdlib>\n#include <cstdio>\n#include <algorithm>\n\nusing namespace std;\n\n#define int long long\nconst int MAXN = 50050;\nint N, L, dp[MAXN], sum[MAXN], f[MAXN], g[MAXN], h, t, Q[MAXN];\n\ninline double xie(int j1, int j2)\n{\n\treturn (double) (dp[j2] + g[j2] - dp[j1] - g[j1]) / (f[j2] - f[j1]);\n}\n#undef int\nint main()\n{\n    scanf(\"%d%d\", &N, &L);\n    for(int i = 1; i <= N; i++)\n    {\n    \tscanf(\"%d\", &sum[i]);\n    \tsum[i] += sum[i - 1];\n    \tf[i] = sum[i] + i;\n    \tg[i] = (f[i] + L + 1) * (f[i] + L + 1);\n\t}\n\tg[0] = (L + 1) * (L + 1); //important!!!\n\tfor(int i = 1; i <= N; i++)\n\t{\n\t\twhile(h < t && xie(Q[h], Q[h + 1]) <= 2 * f[i]) h++;\n\t\tdp[i] = dp[Q[h]] + (f[i] - f[Q[h]] - L - 1) * (f[i] - f[Q[h]] - L - 1); //\u66f4\u65b0dp\u503c\n\t\twhile(h < t && xie(Q[t], i) < xie(Q[t - 1], Q[t])) t--;\n\t\tQ[++t] = i;\n\t\t\n\t}\n\tprintf(\"%lld\\n\", dp[N]);\n \treturn 1\uff1b//\u9632\u6284\n}\n\n```\n",
        "postTime": 1528362560,
        "uid": 54745,
        "name": "Gypsophila",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "\u5bb9\u6613\u63a8\u51fa\uff0c\u5982\u679c\u73a9\u5177\u957f\u5ea6\u7684\u524d\u7f00\u548c\u4e3a$sum[]$\uff0c\u90a3\u4e48$DP$\u65b9\u7a0b\u4e3a\uff1a\n\n$f[i]=min{0<=j<i,f[j]+(i-j-1-L+sum[i]-sum[j])^2}$\u3002\n\n\u89e3\u6cd5\u4e00\uff1a\u51b3\u7b56\u5355\u8c03\u6027\u3002\n\n\u53ef\u4ee5\u770b\u51fa\u539f\u65b9\u7a0b\u662f\u4e00\u4e2a$f[i]=min{0<=j<i,f[j]+w(i,j)}$\u7684\u6a21\u578b\uff0c\u5176\u4e2d$w(i,j)=(i-j-1-L+sum[i]-sum[j])^2$\u3002\n\n\u8bbe$X=i-j-1-L+sum[i]-sum[j]$\uff0c\u5219\uff1a\n\n$w(i+1,j+1)=(X+c[i+1]-c[j+1])^2$\n\n$w(i+1,j)=(X+c[i+1]+1)^2$\n\n$w(i,j+1)=(X-c[j+1]-1)^2$\n\n\u6b64\u65f6$w(i,j)+w(i+1,j+1)=2X^2+2c[i+1]X-2c[j+1]X+c[i+1]^2-2c[i+1]c[j+1]+c[j+1]^2$\n\n$w(i+1,j)+w(i,j+1)=2X^2+2c[i+1]X-2c[j+1]X+c[i+1]^2+2c[i+1]+2c[j+1]+c[j+1]^2+2$\n\n\u53ef\u5f97$w(i,j)+w(i+1,j+1)<=w(i+1,j)+w(i,j+1)$\uff0c\u5373\u6ee1\u8db3\u51b3\u7b56\u5355\u8c03\u6027\u3002\n\n\u51b3\u7b56\u5355\u8c03\u6027\u5b9e\u73b0\u5373\uff0c\u7528\u4e00\u4e2a\u6808\u7ef4\u62a4\u6bcf\u4e2a\u51b3\u7b56\u7684\u8d77\u59cb\u548c\u7ed3\u675f\u4f4d\u7f6e\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u5df2\u7ecf\u8ba1\u7b97\u51fa\u6765\u7684$f[i]$\uff0c\u53bb\u5bfb\u627e\u5b83\u80fd\u66f4\u65b0\u7684\u72b6\u6001\u6709\u54ea\u4e9b\u3002\n\n\u5177\u4f53\u4e3a\uff1a\n\n\uff081\uff09\u5728\u6808\u9876\u7684\u51b3\u7b56\u8d77\u59cb\u4f4d\u7f6e\u5224\u65ad\u8d77\u59cb\u4f4d\u7f6e\u662f\u5426\u51b3\u7b56$i$\u66f4\u4f18\u3002\u5982\u679c\u662f\uff0c\u5219\u9000\u6808\uff0c\u7ee7\u7eed\u6267\u884c\uff081\uff09\u3002\u5426\u5219\u8f6c\uff082\uff09\u3002\n\n\uff082\uff09\u4e8c\u5206\u67e5\u627e\u5728\u6808\u9876\u7684\u51b3\u7b56\u533a\u95f4\u91cc\uff0c\u51b3\u7b56$i$\u6700\u4f18\u7684\u6700\u5de6\u4f4d\u7f6e$pos$\uff0c\u628a\u6808\u9876\u7684\u51b3\u7b56\u7ed3\u675f\u4f4d\u7f6e\u8bbe\u4e3a$pos-1$\uff0c\u5e76\u628a\u51b3\u7b56$i$\u538b\u5165\u6808\uff0c\u51b3\u7b56\u8d77\u59cb\u4f4d\u7f6e\u4e3a$pos$\uff0c\u7ed3\u675f\u4f4d\u7f6e\u4e3a$n$\uff08\u4f46\u662f\u5982\u679c$pos>n$\u5c31\u4e0d\u8981\u5165\u6808\uff0c\u6211\u5c31\u5728\u8fd9\u91cc\u8c03\u4e86\u597d\u4e45\uff09\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\nusing namespace std;\ninline int read() {\n    int res = 0; bool bo = 0; char c;\n    while (((c = getchar()) < '0' || c > '9') && c != '-');\n    if (c == '-') bo = 1; else res = c - 48;\n    while ((c = getchar()) >= '0' && c <= '9')\n        res = (res << 3) + (res << 1) + (c - 48);\n    return bo ? ~res + 1 : res;\n}\ntypedef long long ll;\nconst int N = 5e4 + 5;\nint n, L, c[N], top; ll sm[N], f[N];\nstruct cyx {\n    int l, r, x;\n    cyx() {}\n    cyx(int _l, int _r, int _x) :\n        l(_l), r(_r), x(_x) {}\n} stk[N];\nll w(int i, int j) {\n    ll res = sm[j] - sm[i] - L;\n    res += j - i - 1; return res * res;\n}\nint findx(int i) {\n    int l = stk[top].l, r = stk[top].r, mid;\n    while (l <= r) { // \u4e8c\u5206\u67e5\u627e\u65b0\u51b3\u7b56\u7684\u8d77\u59cb\u4f4d\u7f6e\n        mid = l + r >> 1;\n        if (f[i] + w(i, mid) < f[stk[top].x] + w(stk[top].x, mid))\n            r = mid - 1;\n        else l = mid + 1;\n    }\n    return l;\n}\nint main() {\n    int i, now = 1; n = read(); L = read();\n    for (i = 1; i <= n; i++) c[i] = read(),\n        sm[i] = sm[i - 1] + c[i];\n    stk[top = 1] = cyx(1, n, 0);\n    for (i = 1; i <= n; i++) {\n        f[i] = f[stk[now].x] + w(stk[now].x, i);\n        while (i < stk[top].l && f[i] + w(i, stk[top].l) < f[stk[top].x] +\n            w(stk[top].x, stk[top].l)) top--;\n        int u = findx(i); stk[top].r = u - 1;\n        if (u <= n) stk[++top] = cyx(u, n, i);\n        if (i == stk[now].r) now++;\n    }\n    cout << f[n] << endl;\n    return 0;\n}\n```\n\u65f6\u95f4\u590d\u6742\u5ea6$O(nlogn)$\u3002\n\n\n\u89e3\u6cd5\u4e8c\uff1a\u659c\u7387\u4f18\u5316\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u539f\u65b9\u7a0b\u4e3a\n\n$f[i]=min{0<=j<i,f[j]+((i+sum[i]-L-1)-(sum[j]+j))^2}$\n\n\u8bbe$a[i]=i+sum[i]-L-1$\uff0c$b[j]=sum[j]+j$\uff0c\n\n\u5219$f[i]=min{0<=j<i,f[j]+(a[i]-b[j])^2}$\n\n\u5373$f[i]=min{0<=j<i,f[j]+b[j]^2-2a[i]b[j]}+a[i]^2$\n\n\u518d\u8bbe$X[j]=b[j]$\uff0c$Y[j]=f[j]+b[j]^2$\uff0c\n\n\u5219\u53ef\u4ee5\u53d1\u73b0$a[]$\u548c$X[]$\u90fd\u5355\u8c03\u9012\u589e\uff0c\u6240\u4ee5\u659c\u7387\u662f\u5355\u8c03\u9012\u51cf\u7684\u3002\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u51f8\u58f3\uff0c\u6bcf\u6b21\u4ece\u961f\u9996\u4e0d\u65ad\u51fa\u961f\u4ee5\u627e\u51fa\u6700\u4f18\u51b3\u7b56\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\nusing namespace std;\ninline int read() {\n    int res = 0; bool bo = 0; char c;\n    while (((c = getchar()) < '0' || c > '9') && c != '-');\n    if (c == '-') bo = 1; else res = c - 48;\n    while ((c = getchar()) >= '0' && c <= '9')\n        res = (res << 3) + (res << 1) + (c - 48);\n    return bo ? ~res + 1 : res;\n}\ntypedef long long ll;\nconst int N = 5e4 + 5;\nint n, H, T, L, que[N];\nll f[N], a[N], b[N], X[N], Y[N];\nbool check(int p1, int p2, int p3) {\n    return (X[p2] - X[p3]) * (Y[p1] - Y[p3]) - (X[p1] - X[p3])\n        * (Y[p2] - Y[p3]) >= 0; // \u6839\u636e\u53c9\u79ef\u5224\u65adp1p2\u7684\u659c\u7387\u662f\u5426\u5927\u4e8ep2p3\u7684\u659c\u7387\n}\nll calc(int x, int y) {\n    return f[x] + b[x] * b[x] - 2ll * a[y] * b[x];\n}\nint main() {\n    int i; n = read(); L = read(); H = T = 1;\n    for (i = 1; i <= n; i++) {\n        b[i] = b[i - 1] + read() + 1;\n        a[i] = b[i] - L - 1;\n    }\n    for (i = 1; i <= n; i++) {\n        while (H < T && calc(que[H], i) >= calc(que[H + 1], i)) H++;\n        f[i] = calc(que[H], i) + a[i] * a[i];\n        X[i] = b[i]; Y[i] = f[i] + b[i] * b[i];\n        while (H < T && check(que[T - 1], que[T], i)) T--;\n        que[++T] = i;\n    }\n    cout << f[n] << endl;\n    return 0;\n}\n```\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n)$\u3002\n",
        "postTime": 1502372279,
        "uid": 29936,
        "name": "xyz32768",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "[$$\\Large\\texttt{My Blog}$$](https://hydingsy.github.io/)\n\n---\n\n## Description\n\n> \u9898\u76ee\u94fe\u63a5\uff1a[Luogu 3195](https://www.luogu.org/problemnew/show/P3195)\n\nP \u6559\u6388\u8981\u53bb\u770b\u5965\u8fd0\uff0c\u4f46\u662f\u4ed6\u820d\u4e0d\u5f97\u4ed6\u7684\u73a9\u5177\uff0c\u4e8e\u662f\u4ed6\u51b3\u5b9a\u628a\u6240\u6709\u7684\u73a9\u5177\u8fd0\u5230\u5317\u4eac\u3002\n\n\u4ed6\u4f7f\u7528\u81ea\u5df1\u7684\u538b\u7f29\u5668\u8fdb\u884c\u538b\u7f29\u3002\u8fd9\u4e2a\u538b\u7f29\u5668\u53ef\u4ee5\u5c06\u4efb\u610f\u7269\u54c1\u53d8\u6210\u4e00\u7ef4\uff0c\u518d\u653e\u5230\u4e00\u79cd\u7279\u6b8a\u7684\u4e00\u7ef4\u5bb9\u5668\u4e2d\u3002P \u6559\u6388\u6709\u7f16\u53f7\u4e3a $1\\dots n$ \u7684 $n$ \u4ef6\u73a9\u5177\uff0c\u73a9\u5177\u7ecf\u8fc7\u538b\u7f29\u540e\u4f1a\u53d8\u6210\u4e00\u7ef4\uff0c\u7b2c $i$ \u4ef6\u4ef6\u73a9\u5177\u538b\u7f29\u540e\u957f\u5ea6\u4e3a $C_i$\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u6574\u7406\uff0cP \u6559\u6388\u8981\u6c42\uff1a\n\n- \u5728\u4e00\u4e2a\u4e00\u7ef4\u5bb9\u5668\u4e2d\uff0c\u73a9\u5177\u7684\u7f16\u53f7\u662f\u8fde\u7eed\u7684\uff1b\n- \u5982\u679c\u4e00\u4e2a\u4e00\u7ef4\u5bb9\u5668\u4e2d\u6709\u591a\u4e2a\u73a9\u5177\uff0c\u90a3\u4e48\u4e24\u4ef6\u73a9\u5177\u4e4b\u95f4\u8981\u52a0\u5165\u4e00\u4e2a\u5355\u4f4d\u957f\u5ea6\u7684\u586b\u5145\u7269\u3002\u5f62\u5f0f\u5730\u8bf4\uff0c\u5982\u679c\u8981\u5c06 $i$ \u53f7\u73a9\u5177\u5230 $j$ \u53f7\u73a9\u5177\u653e\u5230\u540c\u4e00\u4e2a\u5bb9\u5668\u4e2d\uff0c\u5219\u5bb9\u5668\u957f\u5ea6\u4e0d\u5c0f\u4e8e $x=j-i+\\sum_{k=i}^{j}C_k$\u3002\n\n\u5236\u4f5c\u5bb9\u5668\u7684\u8d39\u7528\u4e0e\u5bb9\u5668\u7684\u957f\u5ea6\u6709\u5173\uff0c\u6839\u636e\u6559\u6388\u7814\u7a76\uff0c\u5982\u679c\u5bb9\u5668\u957f\u5ea6\u4e3a $x$\uff0c\u5176\u5236\u4f5c\u8d39\u7528\u4e3a $(x-L)^2$\uff0c\u5176\u4e2d $L$ \u662f\u4e00\u4e2a\u5e38\u91cf\u3002\n\nP \u6559\u6388\u4e0d\u5173\u5fc3\u5bb9\u5668\u7684\u6570\u76ee\uff0c\u4ed6\u53ef\u4ee5\u5236\u4f5c\u51fa\u4efb\u610f\u957f\u5ea6\u7684\u5bb9\u5668\uff0c\u751a\u81f3\u8d85\u8fc7 $L$\u3002\u8bd5\u6c42\u6700\u5c0f\u8d39\u7528\u3002\n\n\u6570\u636e\u8303\u56f4\uff1a$1\\le n\\le 5\\times 10^4$\uff0c$1\\le L,C_i\\le 10^7$\n\n------\n\n## Solution\n\n\u8fd9\u9898\u53ef\u4ee5\u8bf4\u662f**\u659c\u7387\u4f18\u5316**\u7684\u5165\u95e8\u9898\u4e86\u5427\uff08\u5173\u4e8e\u659c\u7387\u4f18\u5316\u7684\u5206\u6790\u5b9e\u73b0\uff0c\u8bf7\u53c2\u89c1\u6211\u7684\u53e6\u4e00\u7bc7\u535a\u5ba2[\u300c\u7b97\u6cd5\u7b14\u8bb0\u300d\u659c\u7387\u4f18\u5316](https://hydingsy.github.io/articles/algorithm-Slope-Optimization/)\uff09\u3002\u6211\u4eec\u9996\u5148\u8003\u8651\u6734\u7d20\u7684\u52a8\u6001\u89c4\u5212\uff0c\u5b9a\u4e49 $f_i$ \u8868\u793a\u8003\u8651\u5230\u7b2c $i$ \u4e2a\u73a9\u5177\u7684\u6700\u5c0f\u8d39\u7528\uff0c\u8bb0 $sum_i=\\sum_{k=1}^i C_k$\u3002\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a\n\n$$f_i=\\min\\{f_j+(i-j-1+sum_i-sum_j-L)^2\\}\\quad (0\\le j<i)$$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u91cc\u6709\u4e00\u4e2a\u5e73\u65b9\u9879\uff0c\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u659c\u7387\u4f18\u5316\u3002\n\n\u4e3a\u4e86\u8868\u8ff0\u65b9\u4fbf\uff0c\u6211\u4eec\u8bb0 $x_i=sum_i+i$\uff0c$y_i=sum_i+i+1+L$\uff0c\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u53ef\u4ee5\u53d8\u5f62\u4e3a\uff1a\n\n$$f_i=\\min\\{f_j+(x_i-y_j)^2\\}\\quad (0\\le j<i)$$\n\n\u6211\u4eec\u4efb\u53d6 $j,k$ \u6ee1\u8db3 $0\\le k<j<i$\uff0c\u5f53 $j$ \u6bd4 $k$ \u8981**\u66f4\u597d**\u65f6\uff0c\u6ee1\u8db3\uff1a\n\n$$\\begin{aligned}f_j+(x_i-y_j)^2&\\le f_k+(x_i-y_k)^2 \\\\f_j-2\\cdot x_i\\cdot y_j+y_j^2&\\le f_k-2\\cdot x_i\\cdot y_k+y_k^2 \\\\(f_j+y_j^2)-(f_k+y_k^2)&\\le 2\\cdot x_i(y_j-y_k)\\end{aligned}$$\n\n\u7531\u4e8e $C_i>0$ \u56e0\u6b64 $y_i$ \u7684\u503c\u662f\u9012\u589e\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u9664\u4ee5 $y_j-y_k$ \u5f97\u5230\uff1a\n\n$$2\\cdot x_i\\ge \\frac{(f_j+y_j^2)-(f_k+y_k^2)}{y_j-y_k}$$\n\u5f88\u663e\u7136\u8fd9\u5df2\u7ecf\u662f\u4e00\u4e2a\u53ef\u4ee5\u659c\u7387\u4f18\u5316\u7684\u4e1c\u897f\u4e86\uff0c\u76f4\u63a5\u5957\u659c\u7387\u4f18\u5316\u677f\u5b50\u5373\u53ef\uff01\n\n**\u6ce8\u610f**\uff1a\u6b64\u5904 $x_0=0$\uff0c$y_0=1+L$\uff0c\u8fd9\u4e24\u4e2a\u503c\u5fc5\u987b\u8981\u521d\u59cb\u5316\uff01\n\n**\u65f6\u95f4\u590d\u6742\u5ea6**\uff1a$O(n)$\n\n------\n\n## Code\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n\nconst int N=5e4+5;\nint n,L,c[N],q[N];\nlong long sum[N],x[N],y[N],f[N];\n\nlong long sqr(long long x) {\n    return x*x;\n}\ndouble slope(int i,int j) {\n    return 1.0*((f[i]+sqr(y[i]))-(f[j]+sqr(y[j])))/(y[i]-y[j]);\n}\nint main() {\n    scanf(\"%d%d\",&n,&L);\n    x[0]=0,y[0]=1+L;\n    for(int i=1;i<=n;++i) {\n        scanf(\"%d\",&c[i]);\n        sum[i]=sum[i-1]+c[i],x[i]=sum[i]+i,y[i]=sum[i]+i+1+L;\n    }\n    int l=1,r=0;\n    f[0]=q[++r]=0;\n    for(int i=1;i<=n;++i) {\n        while(l<r&&slope(q[l],q[l+1])<=2*x[i]) ++l;\n        f[i]=f[q[l]]+sqr(x[i]-y[q[l]]);\n        while(l<r&&slope(q[r-1],q[r])>=slope(q[r],i)) --r;\n        q[++r]=i;\n    }\n    printf(\"%lld\\n\",f[n]);\n    return 0;\n}\n```\n\n",
        "postTime": 1546748778,
        "uid": 49725,
        "name": "Siyuan",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "### [BLOG](https://www.luogu.org/problemnew/show/P3195)\n\n\u611f\u8c22\u697c\u4e0a\u5927\u4f6c\u8ba9\u6211\u5f7b\u5e95\u5f04\u61c2\u659c\u7387\u4f18\u5316QAQ\n\n\"\u8fd9\u662f\u4e00\u9053\u7ecf\u5178\u7684\u659c\u7387\u4f18\u5316\u5165\u95e8\u9898,\u5c31\u7528\u8fd9\u9898\u6765\u4f5c\u4e2a\u603b\u7ed3\u597d\u4e86.\"\n\n\u8fd9\u9053\u9898\u7528\u5230\u7684\u662f\u5355\u8c03\u961f\u5217(\u6211\u53ea\u4f1a\u8fd9\u73a9\u610f\u513f)\u7684\u659c\u7387\u4f18\u5316.\n\n\u6211\u4eec\u6574\u7406\u4e00\u4e0b\u9898\u610f\u4f1a\u53d1\u73b0\u5b83\u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u5c31\u662f\u4e0b\u9762\u8fd9\u4e1c\u897f:\n\n$$dp[i]=min(dp[j]+(sum[i]+i-sum[j]-j-L-1)^2),i>j$$\n\n![](https://www.cnblogs.com/images/cnblogs_com/terribleterrible/1303410/o_1537252318274.jpg)\n\n\u4e0a\u9762\u8fd9\u5f20\u56fe\u8bb2\u5f97\u5df2\u7ecf\u5f88\u6e05\u695a\u4e86.\n\n\u6211\u4eec\u5982\u679c\u628a\u542b$j$\u7684\u76f8\u5173\u53d8\u91cf\u90fd\u770b\u6210\u70b9\u7684\u5750\u6807\u7684\u8bdd,\u6b64\u65f6\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u5c3d\u91cf\u8ba9\u622a\u8ddd\u66f4\u5c0f.\n\n\u600e\u4e48\u8ba9\u622a\u8ddd\u6700\u5c0f\u5462?\u96be\u9053\u4e00\u4e2a\u4e00\u4e2a\u6bd4\u8f83\u5417?\n\n\u6211\u4eec\u518d\u6765\u770b\u4e0b\u9762\u8fd9\u5f20\u56fe:\n\n![](https://www.cnblogs.com/images/cnblogs_com/terribleterrible/1303410/o_2.png)\n\n\u4e0a\u9762\u4e09\u4e2a\u70b9\u662f\u6211\u4eec\u53ef\u4f9b\u9009\u62e9\u7684\u4e09\u4e2a\u70b9,\u8fd9\u6761\u76f4\u7ebf\u5c31\u662f\u6211\u4eec\u5c31\u662f\u8981\u4f7f\u8fd9\u6761\u4e00\u76f4\u659c\u7387\u7684\u622a\u8ddd\u6700\u5c0f.\n\n\u9ad8\u4e2d\u6570\u5b66\u5b66\u7ebf\u6027\u89c4\u5212\u7684\u65f6\u5019\u6211\u4eec\u90fd\u77e5\u9053,\u663e\u7136\u662f\u9009\u9014\u4e2d\u7684$B$\u70b9.\n\n\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u4e00\u6761\u76f4\u7ebf,\u6211\u4eec\u6839\u636e\u659c\u7387\u548c\u5750\u6807\u53ef\u4ee5\u8ba1\u7b97\u622a\u8ddd,\u4ece\u800c\u5f97\u5230dp\u503c.\n\u90a3\u5269\u4e0b\u4e24\u4e2a\u70b9\u5462?\n\n\u5bf9\u4e8e$A$\u70b9,\u6211\u4eec\u662f\u4e0d\u662f\u53ef\u4ee5\u4e22\u6389\u5b83\u4e86?\u662f\u7684,\u7531\u4e8e\u6211\u4eec\u7684\u659c\u7387\u662f\u4e0d\u65ad\u589e\u5927\u7684,$A$\u70b9\u662f\u4e0d\u53ef\u80fd\u7528\u6765\u8f6c\u79fb\u540e\u9762\u7684\u72b6\u6001\u4e86,\u6240\u4ee5\u628a\u5b83\u5254\u9664.\n\n\u8fd8\u6709$C$\u70b9,\u5f53\u659c\u7387\u5230\u8fbe\u4e00\u5b9a\u5927\u5c0f,\u4f8b\u5982\u4e0b\u56fe:\n\n![](https://www.cnblogs.com/images/cnblogs_com/terribleterrible/1303410/o_1.png)\n\n\u6b64\u65f6\u6211\u4eec\u5c31\u8981\u7528\u5230$C$,\u800c$B$\u53c8\u53ef\u4ee5\u5254\u9664.\n\n\u4e8e\u662f\u6211\u4eec\u53ea\u8981\u7ef4\u62a4\u4e00\u4e2a\u51f8\u5305,\u800c\u4e14\u8fd9\u4e2a\u51f8\u5305\u76f8\u90bb\u4e24\u4e2a\u70b9\u8fde\u7684\u659c\u7387\u8981\u5927\u4e8e\u5f53\u524d\u8fd9\u6761\u7ebf\u7684\u659c\u7387.\u5c31\u50cf\u521a\u521a\u8fd9\u4e2a\u4f8b\u5b50\u4e00\u6837.\u4e00\u65e6\u6700\u5de6\u7aef\u7684\u4e00\u4e2a\u70b9\u548c\u6b21\u5de6\u7aef\u7684\u70b9\u7684\u8fde\u7ebf\u8981\u5c0f\u4e8e\u5f53\u524d\u7684\u659c\u7387\u4e86,\u5c31\u628a\u6700\u5de6\u7aef\u7684\u70b9\u5254\u9664.\n\n\u8fd9\u6837\u6bcf\u6b21\u9047\u5230\u65b0\u7684\u76f4\u7ebf,\u76f4\u63a5\u62ff\u6700\u5de6\u7aef\u7684\u70b9(\u961f\u5934)\u6765\u8f6c\u79fb,\u52a0\u5165\u4e00\u4e2a\u65b0\u70b9\u5c31\u52a0\u5230\u6700\u53f3\u8fb9(\u961f\u5c3e),\u56e0\u4e3a\u6a2a\u5750\u6807\u4e5f\u662f\u9012\u589e\u7684.\u518d\u52a0\u5165\u8fd9\u4e2a\u70b9\u4e4b\u524d,\u6211\u4eec\u4e00\u5b9a\u8981\u4fdd\u8bc1\u4e0b\u51f8\u7684\u6027\u8d28,\u4f8b\u5982\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50:\n\n![](https://www.cnblogs.com/images/cnblogs_com/terribleterrible/1303410/o_W@2AJJXH%7B_%7D0A5C_V5%7BS5L2.png)\n\n$B$\u663e\u7136\u8981\u88ab\u5254\u9664.\n\n\u4e3a\u4ec0\u4e48\u4e00\u5b9a\u7ef4\u62a4\u51f8\u5305\u5462?\u4e3a\u4ec0\u4e48\u4e00\u5b9a\u662f\u5f39\u6389$B$.$C$\u4e3a\u4ec0\u4e48\u66f4\u4f18\u5462?\u81ea\u5df1\u60f3\u8c61\u4e00\u4e0b,\u4e00\u6761\u76f4\u7ebf\u659c\u7387\u5927\u4e8e$CG$\u7684\u76f4\u7ebf\u4ece\u4e0b\u9762\u5e73\u79fb\u4e0a\u6765,\u8d70\u554a\u8d70,\u6700\u540e\u4e00\u5b9a\u4f1a\u5728$C$\u8fd9\u91cc\u505c\u4e0b.\u5982\u679c\u662f\u4e00\u6761\u659c\u7387\u5c0f\u4e8e$GC$\u5927\u4e8e$GF$\u7684,\u663e\u7136\u4f1a\u5728$G$\u505c\u4e0b,\u8fd9\u6837$B$\u5c31\u6ca1\u6709\u4eba\u548c\u7528\u6b66\u4e4b\u5730\u4e86.\n\n\u5728\u8fd9\u91cc\u6211\u4eec\u603b\u7ed3\u4e00\u4e0b,\u5355\u8c03\u961f\u5217\u659c\u7387\u4f18\u5316\u7684\u6b65\u9aa4:\n\n1.\u5f39\u961f\u5934,\u5c31\u662f\u6700\u5de6\u8fb9\u7684\u70b9.\n\n2.\u653e\u76f4\u7ebf,\u7b97\u7b54\u6848,\u5f97\u5230\u5f53\u524d\u72b6\u6001\u7684\u7b54\u6848,\u5f97\u5230\u65b0\u7684\u5f85\u52a0\u5165\u7684\u70b9.\n\n3.\u5f39\u961f\u5c3e,\u628a\u63d2\u5165\u65b0\u70b9\u4e4b\u540e\u4e0d\u5408\u6cd5\u7684\u70b9\u5f39\u6389.\u6700\u540e\u52a0\u5165\u65b0\u70b9\u5c31\u597d\u4e86.\n\n\u4ee3\u7801:\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#define maxn 50005\n#define ll long long\nusing namespace std;\nint q[maxn];\ndouble A[maxn],B[maxn],dp[maxn],sum[maxn];\ndouble X(int x){return B[x];}\ndouble Y(int x){return dp[x]+B[x]*B[x];}\ndouble slope(int a,int b){return (Y(a)-Y(b))/(X(a)-X(b));}\nint main()\n{\n\tint n,l;cin>>n>>l;\n\tfor(int i=1;i<=n;i++)scanf(\"%lf\",&sum[i]);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tsum[i]+=sum[i-1];\n\t\tA[i]=sum[i]+i;B[i]=sum[i]+i+l+1;\n\t}\n\tB[0]=l+1;//B[0]=sum[0]+0+l+1=l+1\n\tint tail=1,head=1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(head<tail&&slope(q[head],q[head+1])<2*A[i])head++;\n\t\tint j=q[head];dp[i]=dp[j]+(A[i]-B[j])*(A[i]-B[j]);\n\t\twhile(head<tail&&slope(i,q[tail-1])<slope(q[tail-1],q[tail]))tail--;\n\t\tq[++tail]=i;\n\t}\n\tprintf(\"%lld\",(ll)dp[n]);\n\treturn 0;\n}\n\n```\n",
        "postTime": 1537261793,
        "uid": 61672,
        "name": "Brioche",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "\u987a\u624b\u5b89\u5229\u4e00\u6ce2\u535a\u5ba2->[Chlience](http://blog.csdn.net/Force_CHL)\n\n\u6b22\u8fcedalao\u4ea4\u6362\u53cb\u94fe\n\n\n### \u5206\u6790\uff1a\n\n\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\uff08\u663e\u7136\uff09\n\n$dp[i]=min(dp[j]+(sum[i]-sum[j]+i-j-1-L)^2)$\n\n$sum$\u4e3a\u524d\u7f00\u548c\n\n\u7136\u540e\u6211\u4eec\u4ee4$f[i]=sum[i]+i,c=1+L$\n\n\u539f\u5f0f\u53ef\u4ee5\u5316\u7b80\u4e3a\uff1a\n\n$dp[i]=min(dp[j]+(f[i]-f[j]-c)^2)$\n\n\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684$f,c$\u90fd\u662f\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6765\u7684\n\n#### 1.\u8bc1\u660e\u51b3\u7b56\u5355\u8c03\u6027\n\n\u5047\u8bbe\u5728\u5f53\u524d\u7531$j$\u72b6\u6001\u8f6c\u79fb\u4f18\u4e8e$k$\u72b6\u6001\uff08\u663e\u7136$k$\u662f\u4e4b\u524d\u679a\u4e3e\u7684\u51b3\u7b56\uff09\uff0c\u5373\uff1a\n\n$dp[j]+(f[i]-f[j]-c)^2\\le dp[k]+(f[i]-f[j]-c)^2$\n\n\u90a3\u4e48\u5bf9\u4e8e$i$\u540e\u9762\u7684\u4e00\u4e2a\u72b6\u6001$t$\uff0c\u8981\u4fdd\u8bc1$k$\u5bf9\u5176\u65e0\u8d21\u732e\uff08\u5df2\u7ecf\u88ab$j$\u8986\u76d6\uff09\n\n\u5219\u9700\u8981\u8bc1\u660e\uff1a\n\n$dp[j]+(f[t]-f[j]-c)^2\\le dp[k]+(f[t]-f[k]-c)^2$\n\n\u7531\u4e8e$f[i]=sum[i]+i$\uff0c\u6240\u4ee5\u4e00\u5b9a\u4e3a\u5355\u8c03\u9012\u589e\u7684\uff08$sum$\u548c$i$\u5747\u4e3a\u5355\u8c03\u9012\u589e\uff09\n\n\u6240\u4ee5\u4ee4$v=f[t]-f[i]$\n\n\u539f\u5f0f\u53ef\u5316\u4e3a\uff1a\n\n$dp[j]+(f[i]+v-f[j]-c)^2\\le dp[k]+(f[i]+v-f[k]-c)^2$\n\n\u53d8\u5f62\u2193\u5c3d\u91cf\u62c6\u51fa\u5df2\u6709\u7684\u5f0f\u5b50\n\n$dp[j]+(f[i]-f[j]-c)^2+2v*(f[i]-f[j]-c)+4v^2\\le dp[k]+(f[i]-f[k]-c)^2+2v*(f[i]-f[k]-c)+4v^2$\n\n\u79fb\u9879\uff0c\u6d88\u9664\u76f8\u540c\u9879\n\n$f[i]-f[j]-c\\le f[i]-f[k]-c$\n\n$f[j]\\ge f[k]$\n\n\u7531\u5355\u8c03\u9012\u589e\u6027\uff0c\u53ea\u9700\u8981\u679a\u4e3e\u72b6\u6001\u65f6\u4ee5$1$~$i-1$\u7684\u987a\u5e8f\u5373\u53ef\u4fdd\u8bc1$f[j]\\ge f[k]$\uff0c\u5f97\u8bc1\n\n#### 2.\u6c42\u659c\u7387\u65b9\u7a0b\n\n\u5f53\u524d\u51b3\u7b56$i$\uff0c\u82e5\u7531$j$\u72b6\u6001\u8f6c\u79fb\u4f18\u4e8e$k$\u72b6\u6001\uff0c\u5219\u6709\uff1a\n\n$dp[j]+(f[i]-f[j]-c)^2\\le dp[k]+(f[i]-f[j]-c)^2$\n\n\u5c55\u5f00\uff0c\u53d8\u5f62\uff0c\u5f97\uff1a\n\n$dp[j]+f[i]^2-2f[i]* (f[j]+c)+(f[j]+c)^2\\le dp[k]+f[i]^2-2f[i]* (f[k]+c)+(f[k]+c)^2$\n\n\u79fb\u9879\uff0c\u6d88\u9664\u76f8\u540c\u9879\uff0c\u5c3d\u91cf\u5c06\u53d8\u91cf\u6309$j,k$\u51d1\u5728\u4e00\u8d77\uff0c\u5f97\uff1a\n\n$\\frac {(dp[j]+(f[j]+c)^2)-(dp[k]+(f[k]+c)^2)}{2*(f[j]-f[k])}\\le f[i]$\n\n\u5de6\u8fb9\u90e8\u5206\u5c31\u50cf\u659c\u7387\u4e00\u6837\uff0c\u53ef\u4ee5\u770b\u505a\uff1a\n\n$\\frac {Y_j-Y_k} {X_j-X_k}$\n\n\u6211\u4eec\u4ee5$Slope(x,y)$\u6765\u8868\u793a\u4e0a\u9762\u90a3\u4e2a\u7c7b\u4f3c\u4e8e\u659c\u7387\u7684\u4e1c\u897f\uff08\u5176\u5b9e\u5c31\u662f\u659c\u7387\u597d\u4e48\uff09\n\n\u82e5\u6ee1\u8db3\u8fd9\u4e2a$Slope(k,j)\\le f[i]$\uff0c\u5219\u8bf4\u660e$j$\u6bd4$k$\u4f18\n\n#### 3.\u7ec4\u7ec7\u7b97\u6cd5\n\n\u90a3\u4e48\u5bf9\u4e8e\u5f53\u524d\u8f83\u4f18\u7684\u72b6\u6001\u6211\u4eec\u5efa\u7acb\u4e00\u4e2a\u961f\u5217$q$\n\n\u7ef4\u62a4\u8fd9\u4e2a\u961f\u5217\u6211\u4eec\u6709\u4ee5\u4e0b\u64cd\u4f5c\uff1a\n\n> 1.\u82e5$Slope(q[l],q[l+1])\\le f[i] $\uff0c\u5219$q[l]$\u6ca1\u6709$q[l+1]$\u4f18\uff0c\u5219\u5220\u9664$q[l]$\n> 2.\u82e5$Slope(q[r-1],q[r])\\ge Slope(q[r],i)$,\u5219\u5220\u9664$q[r]$\n\n\n\n\n**\u5206\u6790\uff1a**\n\n\n\u65b9\u7a0b\u6210\u7acb\u65f6\u662f$j$\u6bd4$k$\u4f18\u7684\u5145\u5206\u5fc5\u8981\u6761\u4ef6\uff0c\u90a3\u4e48\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u6709\u4e00\u4e2a\u5e8f\u5217\uff0c\u90a3\u4e48\u961f\u5934\u5c31\u662f\u5f53\u524d\u6700\u4f18\u7684\uff0c\u82e5\u5230\u4e86\u67d0\u4e2a$i$\u503c\u4f7f\u5f97\u5bf9\u4e8e\u961f\u9996$p[l]$\u548c\u961f\u6b21\u9996$p[l+1]$\u6765\u8bf4$Slope(q[l],q[l+1])\\le f[i]$\u6210\u7acb\uff0c\u5219$q[l+1]$\u6bd4$q[l]$\u4f18\uff0c\u6240\u4ee5\u5f39\u51fa\u961f\u9996\uff0c\u76f4\u5230\u4e0d\u6210\u7acb\u4e3a\u6b62\n\n\n\u7b2c\u4e00\u6761\u64cd\u4f5c\u662f\u663e\u7136\u7684\uff0c\u90a3\u4e48\u7b2c\u4e8c\u6761\u5462\uff1f\n\n\u4e00\u4e2a\u72b6\u6001\u8981\u4e0d\u8981\u653e\u5728\u5e8f\u5217\u91cc\uff0c\u662f\u7531\u5b83\u80fd\u4e0d\u80fd\u505a\u51fa\u8d21\u732e\u51b3\u5b9a\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u80fd\u4e0d\u80fd\u6210\u4e3a\u961f\u9996\u51b3\u5b9a\u7684\n\n\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u6709$Slope(q[a],q[a+1])\\ge Slope(q[a+1],q[a+2])$\uff0c\u90a3\u4e48\uff0c$q[a+1]$\u70b9\u60f3\u8981\u6210\u4e3a\u961f\u9996\u5c31\u53ea\u80fd\u5f53\u524d\u9762\u7684\u70b9\u90fd\u5f39\u51fa\u4e86\uff0c\u5e76\u4e14$Slope(q[a],q[a+1])\\le f[i]$\uff0c$q[a+1]$\u6bd4$q[a]$\u4f18\u6240\u4ee5\u4e5f\u5c06$q[a]$\u5f39\u51fa\u65f6\uff0c\u624d\u80fd\u6210\u4e3a\u961f\u9996\u3002\u4f46\u662f\u5728\u8fd9\u65f6\uff0c\u7531\u4e8e$f[i]\\ge Slope(q[a],q[a+1])\\ge Slope(q[a+1],q[a+2])$\uff0c\u90a3\u4e48$q[a+2]$\u4e5f\u5e94\u8be5\u6bd4$q[a+1]$\u4f18\uff0c\u6240\u4ee5\u5c06$q[a+1]$\u5f39\u51fa\uff0c\u610f\u601d\u5c31\u662f\uff0c\u65e0\u8bba\u600e\u6837\uff0c$q[a+1]$\u90fd\u4e0d\u53ef\u80fd\u505a\u51fa\u8d21\u732e\n\n\u7c7b\u6bd4\u4e00\u4e0b\uff0c\u6211\u4eec\u53ea\u64cd\u4f5c\u961f\u5c3e\u65f6\uff0c\u82e5\u5176\u659c\u7387$Slope(q[r-1],q[r])\\ge Slope(q[r],i)$\uff0c\u76f4\u63a5\u5f39\u51fa$q[r]$\u5373\u53ef\n\n\u90a3\u4e48\uff0c\u5728\u6211\u4eec\u7684\u8fd9\u4e2a\u64cd\u4f5c\u4ee5\u540e\uff0c\u80fd\u591f\u4fdd\u8bc1\u659c\u7387\u5355\u8c03\u9012\u589e\uff0c\u4e5f\u5c31\u662f\u7ef4\u62a4\u4e00\u4e2a\u4e0a\u51f8\u5305\uff0c\u8fd9\u5c31\u662f\u659c\u7387\u4f18\u5316\u5566\uff01\n\n\n\u81ea\u8ba4\u4e3a\u975e\u5e38\u7684\u8be6\u7ec6\u5566\uff0c\u6709\u95ee\u9898\u53ef\u4ee5\u5728\u4e0b\u9762\u7559\u8a00\u55bd\uff01\n\n\n**Code\uff1a**\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define ll long long\nll n,L;\nll f[50005];\nll dp[50005];\nll q[50005];\nll head,tail; \nll read() {\n    ll ans=0,flag=1;\n    char ch=getchar();\n    while((ch<'0'||ch>'9') && ch!='-') ch=getchar();\n    if(ch=='-') flag=-1,ch=getchar();\n    while(ch>='0' && ch<='9') ans=ans*10+ch-'0',ch=getchar();\n    return ans*flag;\n}\ndouble slope(ll k,ll j) {return (double) (dp[j]-dp[k]+(f[j]+L)*(f[j]+L)-(f[k]+L)*(f[k]+L))/(2.0*(f[j]-f[k]));}\nint main() {\n    n=read(),L=read();\n    L++;\n    for(int i=1;i<=n;i++) {\n        ll a=read();\n        f[i]=f[i-1]+a+1;\n    }\n    for(int i=1;i<=n;i++) {\n        while(head<tail && slope(q[head],q[head+1])<=f[i]) head++;\n        int t=q[head];\n        dp[i]=dp[t]+(f[i]-f[t]-L)*(f[i]-f[t]-L);\n        while(head<tail && slope(q[tail],i)<slope(q[tail-1],q[tail])) tail--;\n        q[++tail]=i;\n    } \n    printf(\"%lld\",dp[n]);\n}\n```",
        "postTime": 1516281217,
        "uid": 20601,
        "name": "League\u4e36\u7fce",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "[\u4f20\u9001~](https://www.luogu.org/problemnew/show/P3195)\n\n## Description\n\n\u5171\u6709$n$\u4e2a\u73a9\u5177,\u6bcf\u4e2a\u73a9\u5177\u957f\u5ea6$c_i$, \u5c06$i$\u81f3$j$**\u8fde\u7eed**\u7684\u73a9\u5177\u653e\u5165\u4e00\u4e2a\u5bb9\u5668$i<j$,\u5176\u957f\u5ea6$x=j-i+\\sum_{k=i}^j{c_k}$.\u5236\u4f5c\u4e00\u4e2a\u5bb9\u5668\u7684\u8d39\u7528\u4e3a$(x-L)^2$,\u5176\u4e2dL\u4e3a\u5e38\u6570.\u6c42\u5c06\u6240\u6709\u73a9\u5177\u90fd\u653e\u5165\u5bb9\u5668\u4e2d\u7684\u8d39\u7528\u6700\u5c0f\u503c.\n\n$n\\leq 5*10^4, 1\\leq L,c_i\\leq 10^7$\n\n## Solution\n\n### $O(n^2)$\n\n\u8003\u8651dp.\n\n\u8bbe$f_i$\u4e3a1\u81f3$i$\u7684\u6240\u6709\u73a9\u5177\u90fd\u653e\u5165\u5bb9\u5668\u4e2d\u7684\u6700\u5c0f\u8d39\u7528.~~\u663e\u7136~~\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u8f6c\u79fb\u65b9\u7a0b\n\n$$f_i=\\min_{1\\leq j<i}\\left\\{f_j+\\left[i-(j+1)+\\sum_{k=j+1}^i{c_k}-L\\right]^2\\right\\}$$\n\n\u8bbe$sum_i$\u4e3a$\\sum_{j=1}^i{c_j}$,\u5219\u539f\u65b9\u7a0b\u53ef\u5316\u4e3a\n\n$$f_i=\\min_{1\\leq j<i}\\{f_j+[i-(j+1)+(sum_i-sum_{j+1})-L]^2\\}$$\n\n\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u505a\u5230$O(n^2)$.\u4f46\u5bf9\u4e8e$5*10^4$,\u8fd9\u662f\u8fdc\u8fdc\u4e0d\u591f\u7684.\n\n### $O(n)$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u5b9e\u5728\u662f\u592a\u4e11\u4e86...\u4e8e\u662f,\u6839\u636e\u5f0f\u5b50\u4e2d\u5404\u6210\u5206\u4e0e$i,j$\u7684\u5173\u7cfb,\u6211\u4eec\u53ef\u4ee5\u8bbe$a_i=sum_i+i,b_i=sum_i+i+L$,\u5219\u539f\u65b9\u7a0b\u53c8~~\u53cc\u53d2\u53d5~~\u53ef\u4ee5\u8868\u793a\u4e3a\n\n$$f_i=\\min_{1\\leq j<i}\\{f_j+(a_i-b_{j+1})^2\\}$$\n\n\u5f0f\u5b50\u77ac\u95f4\u7b80\u6d01\u591a\u4e86.\n\n\u8fd9\u65f6\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u659c\u7387\u4f18\u5316\\.\u7531\u659c\u7387\u4f18\u5316\u5957\u8def,\u5373\u6bd4\u8f83\u4e24\u79cd\u8f6c\u79fb\u7b56\u7565,\u6211\u4eec\u8bbe$j>k$\u4e14\u4ece\u4ece$j$\u8f6c\u79fb\u4f18\u4e8e$k$,\u5219\u5fc5\u987b\u6ee1\u8db3\n\n$$\\begin{aligned}f_j+(a_i-b_{j+1})^2&<f_k+(a_i-b_{k+1})^2\\\\\\Rightarrow f_j+a_i^2-2*a_i*b_{j+1}+b_{j+1}^2&<f_k+a_i^2-2*a_k*b_{k+1}+b_{k+1}^2\\\\\\Rightarrow (f_j+b_{j+1}^2)-(f_k+b_{k+1}^2)&<2*a_i*(b_{j+1}-b_{k+1})\\\\\\Rightarrow \\frac{(f_j+b_{j+1}^2)-(f_k+b_{k+1}^2)}{(b_{j+1}-b_{k+1})}&<2*a_i\\end{aligned}$$\n\n\u8fd9\u65f6\u6211\u4eec\u53d1\u73b0\u5de6\u8fb9**\u4e0e\u5f53\u524d$i$\u65e0\u5173**(\u8fd9\u662f\u53ef\u4ee5\u7528\u659c\u7387\u4f18\u5316\u7684\u5fc5\u8981\u6761\u4ef6)\u4e14\u5f88\u50cf\u4e00\u6b21\u51fd\u6570\u7684\u70b9\u659c\u5f0f.\u6211\u4eec\u8bbe$slope(j,k)$\u4e3a\u4e0a\u9762\u7684\u5de6\u5f0f,\u5373\u659c\u7387.\u5219\u5f53$j>k$\u4e14$slope(j,k)<2*a_i$\u65f6,$j$\u6bd4$k$\u4f18.\u7531\u4e8e$a_i$\u5355\u8c03\u9012\u589e,\u6211\u4eec\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u659c\u7387,\u4f7f$slope(i+1, i)$\u5355\u8c03\u9012\u589e,\u4e14\u961f\u9996\u6700\u4f18.\n\n## Code\n```cpp\n#include <bits/stdc++.h>\n#define A(i) ((i)+sum[i])\n#define B(i) ((i)+L+1+sum[i])\n#define S(i) 1ll*(i)*(i)\nusing namespace std;\ntemplate<typename T> inline void read(T& x) {\n\tchar ch = getchar(); T a = 0, b = 1;\n\twhile (ch != '-' && (ch < '0' || ch > '9')) ch = getchar();\n\tif (ch == '-') b = -1, ch = getchar();\n\twhile (ch >= '0' && ch <= '9') a = (a<<1)+(a<<3)+(ch^48), ch = getchar();\n\tx = a*b;\n}\ntypedef long long ll;\nconst int maxn = 5e4;\nint n, sum[maxn+10], L, q[maxn+10];\nll f[maxn+10];\ninline double slope(int j, int k) {\n\treturn 1.0*(f[j]+S(B(j))-f[k]-S(B(k)))/(B(j)-B(k));\n}\nint main() {\n\tread(n); read(L);\n\tfor (int i = 1; i <= n; ++i) {\n\t\tread(sum[i]); sum[i] += sum[i-1];\n\t}\n\tint l = 0, r = 0;\n\tfor (int i = 1; i <= n; ++i) {\n\t\twhile (l < r && slope(q[l+1], q[l]) <= 2*A(i)) ++l; //\u6b64\u65f6q[l]\u6bd4q[l+1]\u66f4\u52a3,\u7531\u4e8ea[i]\u9012\u589e,\u6545\u4e4b\u540e\u4e00\u76f4\u66f4\u52a3,\u5f39\u51fa\n\t\tf[i] = f[q[l]]+S(A(i)-B(q[l]));\n\t\twhile (l < r && slope(q[r], q[r-1]) > slope(i, q[r])) --r; //\u4fdd\u6301\u961f\u5217\u4e2d\u659c\u7387\u5355\u8c03\u9012\u589e\n\t\tq[++r] = i;\n\t}\n\tprintf(\"%lld\", f[n]); //\u4e00\u5b9a\u8bb0\u5f97\u5f00longlong\n\treturn 0;\n}\n```\n> *THANK YOU FOR READING THIS!*",
        "postTime": 1553313848,
        "uid": 15702,
        "name": "rhdeng",
        "ccfLevel": 7,
        "title": "\u6d1b\u8c37 P3195 [HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY \u659c\u7387\u4f18\u5316"
    },
    {
        "content": "\u4e0d\u5f97\u4e0d\u8bf4\uff0c\u659c\u7387\u4f18\u5316\u8fd9\u4e2a\u4e1c\u897f\u4ee3\u7801\u4e00\u70b9\u90fd\u4e0d\u591a\n\n\u5c31\u662f\u7406\u89e3\u4e0a\u9762\u7684\u95ee\u9898\u4e86\n\n------------\n\n\u672c\u4eba\u592a\u5f31\u4e86\u3002\u3002\u3002\u521a\u521a\u5b66\u659c\u7387\u4f18\u5316\uff0c\u505a\u51e0\u9053\u9898\u7ec3\u7ec3\u624b\uff0c\u5076\u5c14\u770b\u5230\u4e86\u8fd9\u9053\u9898\n\n\u4e00\u770b\u5c31\u77e5\u9053\u662f\u8981DP\uff0c\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u4e00\u5199\n\ndp[i]=min(dp[j]+(sum[i]+i\u2212sum[j]\u2212j\u2212L\u22121)^2)(j<i)\n\n\u90a3\u4e48\u5982\u679c\u6211\u4eec\u8981\u53bb\u6389min\n\n\u5c31\u53d8\u6210\u4e86\u8fd9\u6837\n\ndp[i]=dp[j]+(sum[i]+i\u2212sum[j]\u2212j\u2212L\u22121)^2(j<i)\n\n\u8bbesum[i]+i=a[i],sum[i]+i+L+1=b[i]\n\n\u90a3\u4e48dp[i]=dp[j]+a[i]^2+b[j]^2-2*a[i]*b[j]\n\n\u5982\u679c\u5f0f\u5b50\u957f\u8fd9\u6837\uff1a\n\ndp[i]=max\uff08dp[j]+a[j]\uff09(\u53ea\u662f\u7c7b\u4f3c)\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5355\u8c03\u961f\u5217\u4f18\u5316\n\n\u4f46\u662f\u6211\u4eec\u7684\u8fd9\u4e2a\u5f0f\u5b50\u4e2d\u6709\u4e00\u9879\u4e3ai\uff0cj\u76f8\u4e58\uff01\uff01\uff01\n\n\u600e\u4e48\u529e\uff1f\u51c9\u4e86\u5417\uff1f\n\n\u8fd9\u65f6\u659c\u7387\u4f18\u5316\u6a2a\u7a7a\u800c\u51fa\n\n\u79fb\u4e00\u4e0b\u9879\uff0c\u6709\uff1a\n\ndp[j]+b[j]^2=2*a[i]*b[j]+dp[i]-a[i]^2\n\n\u7b49\u4e00\u4e0b\uff0c\u8fd9\u91cci\u4e3a\u5b9a\u503c\uff0c\u540c\u65f6\u4e3a\u9700\u8981\u8f6c\u79fb\u72b6\u6001\uff0c\u6240\u4ee5\u9664\u4e86dp[i]\u4e4b\u5916\u6240\u6709\u4e0ei\u76f8\u5173\u7684\u9879\u4e3a\u5b9a\u503c\n\n\u6211\u4eec\u9700\u8981dp[i]\u6700\u5c0f\uff0c\u90a3\u4e48\n\ndp[j]+b[j]^2\uff08y\uff09=2*a[i]\uff08k\uff09*b[j]\uff08x\uff09+dp[i]-a[i]^2\uff08b\uff09\n\n\u5f62\u5982y=kx+b\uff08~~\u5e9f\u8bdd~~\uff09\n\n\u8003\u8651\u5e73\u9762\u5185\u4e00\u7cfb\u5217\u7684\u70b9\uff08\u5373\u6bcf\u4e2a\u51b3\u7b56\u70b9\uff09\n\n![](https://cdn.luogu.com.cn/upload/pic/13267.png)\n\n\u5f53\u524d\u4ec5\u5f53\u5f62\u5982\u4e0a\u56fe\u7684\u4e0b\u51f8\u5305\u7684\u70b9\u624d\u53ef\u80fd\u6210\u4e3a\u6700\u4f18\u51b3\u7b56\n\n\u90a3\u4e48\u6211\u4eec\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e00\u4e0b\n\n\u5c31\u662f\u8981\u4fdd\u8bc1\u4e00\u4e2a\u70b9\uff0c\u5176\u5de6\u8fb9\u659c\u7387\u5c0f\u4e8e\u53f3\u8fb9\u659c\u7387\u5373\u53ef\n\n\u961f\u9996\u51fa\u961f\u6761\u4ef6\u5f53\u961f\u9996\u659c\u7387\u5c0f\u4e8e\u5f53\u524d\u76f4\u7ebf\u659c\u7387\uff082*a[i]\uff09\n\n\u4e3b\u8981\u539f\u56e0\u662f\u56e0\u4e3a2*a[i]\u5355\u8c03\uff0c\u4f46\u6709\u4e9b\u9898\u76ee\u4e2d\u4e0d\u4e00\u5b9a\n\n\u90a3\u6211\u4eec\u5c31\u5fc5\u987b\u8981\u4e8c\u5206\u5728\u5176\u4e2d\u67e5\u627e\u6700\u4f18\u51b3\u7b56\n\n\u6b64\u5904\u6682\u4e14\u4e0d\u4f1a\u7528\uff0c\u4f5c\u8005\u592a\u5f31\u4e86\u4e5f\u4e0d\u5927\u4f1a\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<algorithm>\n#include<cstring>\n#include<cstdlib>\n#include<cctype>\n#define M 4010000\n#define inf 1e9+1e4\n#define LL long long\nusing namespace std;\nLL n,ll,q[M];\ndouble dp[M],sum[M];\nLL l=0,r=0,maxt,ans=inf,c[M],a[M],b[M];\ninline void read(LL &x)\n{\n\tLL f=1;x=0;char s=getchar();\n\twhile (!isdigit(s)){\n\t\tif(s=='-')f=-1;\n\t\ts=getchar();\n\t}\n\twhile (isdigit(s))\n\t{\n\t\tx=(x<<1)+(x<<3)+(s^48);\n\t\ts=getchar();\n\t}\n\tx*=f;\n}\ndouble get_slope(int x,int y)\n{\n\treturn (dp[x]-dp[y]+b[x]*b[x]-b[y]*b[y])/(b[x]-b[y]);\n}\nint main()\n{\n\tread(n);read(ll);\n\tb[0]=ll+1;\n\tfor (int i=1;i<=n;i++)\n\t{\n\t\tread(c[i]);\n\t\tsum[i]=sum[i-1]+c[i];\n\t\ta[i]=sum[i]+i;\n\t\tb[i]=sum[i]+i+ll+1;\n\t}\n\tfor (int i=1;i<=n;i++)\n\t{\n\t\twhile (l<r&&get_slope(q[l+1],q[l])<2*a[i])\n\t\t{\n\t\t\tl++;\n\t\t}\n\t\tdp[i]=dp[q[l]]+(a[i]-b[q[l]])*(a[i]-b[q[l]]);\n\t\twhile (l<r&&get_slope(i,q[r])<get_slope(q[r],q[r-1]))\n\t\t{\n\t\t\tr--;\n\t\t}\n\t\tq[++r]=i;\n\t}\n\tprintf(\"%lld\",(LL)dp[n]);\n    return 0;\n}\n\n```\n",
        "postTime": 1567069192,
        "uid": 78290,
        "name": "Polaris_Dane",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/y2823774827y/p/10176159.html)\n\n\u7eaa\u5ff5\u4e0d\u770b\u9898\u89e3$A$\u6389\u7684\u7b2c\u4e00\u4e2a\u659c\u7387\u4f18\u5316dp\n\n\u5b9a\u4e49\u6570\u7ec4$sum_i$\u4e3a\u957f\u5ea6\u524d\u7f00\u548c\uff0c\u6570\u7ec4$dp_i$\u4e3a\u524d$i$\u4e2a\u73a9\u5177\u7684\u6700\u5c0f\u82b1\u8d39\n\n\u5f53\u524d\u5757\u672b$i$\u4e0e\u524d\u4e00\u5757\u672b$j$\u72b6\u6001\u8f6c\u79fb\u4e3a$dp_i=dp_{j-1}+i-(j+1)+sum_i-sum_j-L$\n\n\u5047\u8bbe$j<k$\uff0c\u4ece$k$\u8f6c\u79fb\u6bd4$j$\u8f6c\u79fb\u66f4\u4f18\uff1a\n\n$dp_j+[i-(j+1)+sum_i-sum_j-L]^2>$\n\n$dp_k+[i-(k+1)+sum_i-sum_k-L]^2$\n\n$\\Longrightarrow$\n\n$dp_j+[(i+sum_i-L)+(-j-1-sum_j)]^2>$\n\n$dp_k+[(i+sum_i-L)+(-k-1-sum_k)]^2$\n\n$\\Longrightarrow$\n\n$dp_j+(i+sum_i-L)^2+2(i+sum_i-L)(-j-1-sum_j)+(-j-1-sum_j)^2>$\n\n$dp_k+(i+sum_i-L)^2+2(i+sum_i-L)(-k-1-sum_k)+(-k-1-sum_k)^2$\n\n$\\Longrightarrow$\n\n$dp_j+2(i+sum_i-L)(-j-1-sum_j)+(-j-1-sum_j)^2>$\n\n$dp_k+2(i+sum_i-L)(-k-1-sum_k)+(-k-1-sum_k)^2$\n\n$\\Longrightarrow$\n\n$dp_j-dp_k+(-j-1-sum_j)^2-(-k-1-sum_k)^2>$\n\n$(i+sum_i-L) \\{2[(-k-1-sum_k)-(-j-1-sum_j)]\\}$ \n\n$\\Longrightarrow$\n\n$\\dfrac{dp_j-dp_k+(-j-1-sum_j)^2-(-k-1-sum_k)^2}{2[(-k-1-sum_k)-(-j-1-sum_j)]}>i+sum_i-L$\n\n\uff1a\u7136\u540e\u4f60\u5c31\u4f1a\u6837\u4f8b\u90fd\u8fc7\u4e0d\u4e86\uff0c\u4e3a\u4ec0\u4e48\uff1f\u6839\u636e\u5355\u8c03\u6027$2[(-k-1-sum_k)-(-j-1-sum_j)]$\u4e3a\u8d1f\uff0c\u7b26\u53f7\u8981\u53d8\uff0c\u6240\u4ee5\u6700\u540e\u7684\u5f0f\u5b50\u4e3a\n\n$\\dfrac{dp_j-dp_k+(-j-1-sum_j)^2-(-k-1-sum_k)^2}{2[(-k-1-sum_k)-(-j-1-sum_j)]}<i+sum_i-L$\n\n$i+sum_i-L$\u5355\u8c03\u9012\u589e\uff0c\u6240\u4ee5\u6211\u4eec\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e0a\u51f8\u5305\n\n### **My complete code**\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nconst LL maxn=200000;\ninline LL Read(){\n\tLL x=0,f=1; char c=getchar();\n\twhile(c<'0'||c>'9'){\n\t\tif(c=='-') f=-1; c=getchar();\n\t}\n\twhile(c>='0'&&c<='9')\n\t    x=(x<<3)+(x<<1)+c-'0',c=getchar();\n\treturn x*f;\n}\nLL n,L,head,tail;\nLL sum[maxn],dp[maxn],q[maxn];\ninline double Get(LL i){\n\treturn (double)i+sum[i]-L;\n}\ninline LL P_(LL x){\n\treturn x*x;\n}\ninline double Xl(LL j,LL k){\n\treturn (double)\n\t(dp[j]-dp[k]+P_(-j-1-sum[j])-P_(-k-1-sum[k]))/(2*(-k-1-sum[k]+j+1+sum[j]));\n}\nint main(){\n\tn=Read(),L=Read();\n\tfor(LL i=1;i<=n;++i)\n\t\tsum[i]=sum[i-1]+Read();\n\tdp[1]=P_(sum[1]-L),\n\tq[head=tail=1]=1;\n\tfor(LL i=2;i<=n;++i){\n\t\twhile(head<tail&&Xl(q[head],q[head+1])<Get(i))\n\t\t    ++head;\n\t\tLL j=q[head];\n\t\tLL val=i-(j+1)+sum[i]-sum[j]-L;\n\t\tdp[i]=min(dp[j]+P_(val),P_(i-1+sum[i]-L));\n\t\twhile(head<tail&&Xl(q[tail-1],q[tail])>Xl(q[tail],i))\n\t\t    --tail;\n\t\tq[++tail]=i;\n\t}\n\tprintf(\"%lld\",dp[n]);\n    return 0;\n}\n```",
        "postTime": 1545739621,
        "uid": 88804,
        "name": "y2823774827y",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "## \u300cHNOI 2008\u300d\u73a9\u5177\u88c5\u7bb1TOY\n\n\u9996\u5148$O(n^2)$\u7684$DP$\u505a\u6cd5\u662f\u663e\u7136\u7684\uff0c\u4f7f\u7528\u524d\u7f00\u548c\u7136\u540e\u66b4\u529b\u679a\u4e3e\u8f6c\u79fb\n\n```cpp\ndp[0] = 0;\nfor(int i = 1; i <= n; i ++) {\n\tdp[i] = 1LL << 62;\n\tfor(int j = 0; j < i; j ++) {\n\t\tLL x = i - (j + 1) + s[i] - s[j];\n\t\tdp[i] = min(dp[i], dp[j] + (x - L) * (x - L));\n\t}\n}\n```\n\u4e0a\u9762\u7684$dp$\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a\uff08$s[k]=\\sum_{i=1}^kc[i]$ \u4e3a\u524d\u7f00\u548c\uff09\n\n$dp[i]=min(dp[j]+(i - j - L - 1 + s[i] - s[j]) ^ 2) \\; (0\\leq j < i)$\n\n\u4ee4$a_i=s[i]+i-L-1,b_j=s[j]+j$\uff0c\u5219\uff1a\n\n$dp[i]=min(dp[j]+(a_i - b_j) ^ 2) \\; (0\\leq j < i)$\n\n\u5047\u8bbe\u9009$j$\u8f6c\u79fb\uff1a$dp[i]=dp[j]+(a_i - b_j) ^ 2$\n\n$dp[i]=dp[j]+a_i^2 + b_j^2 -2a_ib_j$\n\n\u79fb\u9879\u5f97\uff1a\n\n$2a_ib_j+dp[i]-a_i^2 =dp[j]+ b_j^2$\n\n\u628a\u8fd9\u770b\u6210\u662f$kx+b=y$\u7684\u76f4\u7ebf\u5f62\u5f0f\uff0c\u5219\u5176\u659c\u7387\u4e3a$2a_i$\uff0c$x=b_j$\uff0c$y=dp[j]+ b_j^2$\uff0c\u622a\u8ddd$dp[i]-a_i^2$\n\n\u4e5f\u5c31\u662f\u8bf4\u5047\u8bbe\u6211\u4eec\u7528$j$\u8f6c\u79fb\uff0c$y=2a_ix+b$\u8fd9\u6761\u76f4\u7ebf\u7ecf\u8fc7\u70b9$P_j(b_j,dp[j]+ b_j^2)$\u65f6\uff0c\u5b83\u7684\u622a\u8ddd$+a_i^2$\u5c31\u662f$dp[i]$\u3002\n\n\u8fd9\u6837\u6211\u4eec\u6bcf\u6b21\u9009\u62e9\u4e00\u4e2a\u6700\u4f18\u7684$j$\u8f6c\u79fb\u5c31\u884c\u4e86\n\n\u663e\u7136\u662f\u627e\u4e00\u4e2a\u659c\u7387\u4e3a$2a_i$\u3001\u7ecf\u8fc7$P_j$\uff0c\u622a\u8ddd\u6700\u5c0f\u7684$j$\u3002\n\n\u6839\u636e\u56fe\u50cf\uff0c\u8fd9\u4e9b\u6700\u4f18\u7684$j$\u70b9\u662f\u4f1a\u6784\u6210\u4e00\u4e2a\u4e0b\u51f8\u5305\u7684\n\n\u7136\u540e\u6bcf\u6b21\u627e\u5230\u7b2c\u4e00\u4e2a\u6ee1\u8db3\u7684\u4f4d\u7f6e\u5c31\u662f\u6700\u4f18\u7b54\u6848\uff08\u622a\u8ddd\u6700\u5c0f\uff09\uff0c\u5982\u56fe\n\n![](https://cdn.luogu.com.cn/upload/pic/39942.png)\n\n\u8bb0$slope(P_1,P_2)$\u8868\u793a\u7ecf\u8fc7$P1,P2$\u7684\u76f4\u7ebf\u659c\u7387\n\n\u53ef\u4ee5\u53d1\u73b0\u6700\u4f18\u89e3\u5904\u5c31\u662f\u627e\u5230\u51f8\u5305\u4e0a\u7684\u7b2c\u4e00\u4e2a\u6ee1\u8db3$slope(P_j,P_{j+1})>2a_i$\u7684\u70b9$j$\n\n\u6ce8\u610f\u6bcf\u6b21\u9700\u8981\u67e5\u627e\u7684$a_i=s[i]+i-L-1$\u662f\u9012\u589e\u7684\uff0c\u56e0\u4e3a$s[i]+i$\u9012\u589e\uff0c$-L-1$\u662f\u5e38\u91cf\n\n\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u51f8\u5305\n\n\u8003\u8651\u961f\u9996\uff1a\u6839\u636e\u5355\u8c03\u6027\uff0c\u82e5$slope(P_j,P_{j+1})<2a_i$\uff0c$P_j$\u5c31\u53ef\u4ee5\u4ee5\u540e\u90fd\u4e0d\u518d\u8003\u8651\uff0c\u628a\u5b83\u51fa\u961f$( \\text{pop\\_front})$\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u66f4\u65b0$dp[i]$\u4e86\u3002\n\n\u518d\u8003\u8651\u961f\u672b\uff1a\u628a$P_i(b_i,dp[i]+ b_i^2)$\u52a0\u5165\u51f8\u5305\u3002\u5982\u56fe\u6240\u793a\uff0c\u7ea2\u7ebf\u4f18\u4e8e\u7eff\u7ebf\uff0c\u56e0\u6b64$P_{back-1}$\u5c06\u6539\u4e3a\u8fde$P_i$\n\n![](https://cdn.luogu.com.cn/upload/pic/39944.png)\n\n\u56e0\u6b64\u5355\u8c03\u961f\u5217\u5177\u4f53\u505a\u6cd5\u662f\uff1a\u8bb0\u672b\u7aef$2$\u4e2a\u70b9\u5206\u522b\u4e3a$P_{back-1},P_{back}$\n\n\u82e5$slope(P_{back-1},P_{back})>slope(P_{back-1},P_i)$\uff0c\u4ece\u961f\u5c3e\u5f39\u51fa$(\\text{pop\\_back})$\n\n\u76f4\u5230\u53ea\u5269\u4e00\u4e2a\u70b9\u6216\u8005\u4e0d\u6ee1\u8db3\u5927\u4e8e\u6761\u4ef6\u65f6\u63d2\u5165\u3002\n\n\u5927\u6982\u5c31\u662f\u8fd9\u6837.\n\n```cpp\n#include <cstdio>\n\ntypedef long long LL;\n\nconst int N = 5e4 + 10; \n\nint n, L, c[N];\nLL dp[N], s[N], a[N], b[N];\n\ninline LL x(int i) { return b[i]; }\ninline LL y(int i) { return dp[i] + b[i] * b[i]; }\ninline double slope(int i, int j) { return (y(j) - y(i)) / (double) (x(j) - x(i)); }\n\nint main() {\n\tscanf(\"%d%d\", &n, &L);\n\tfor(int i = 1; i <= n; i ++) {\n\t\tscanf(\"%d\", &c[i]);\n\t\ts[i] = s[i - 1] + c[i];\n\t\ta[i] = (b[i] = s[i] + i) - L - 1;\n\t}\n\tstatic int q[N], hd = 0, bk = 0;\n\tq[bk ++] = 0; //\u6ce8\u610f\u961f\u5217\u521d\u59cb\u65f6\u5e94 push(j = 0)\n\tfor(int i = 1; i <= n; i ++) {\n\t\tfor(; hd + 1 < bk && slope(q[hd], q[hd + 1]) < 2.0 * a[i]; ++ hd) ;\n\t\tdp[i] = dp[q[hd]] + (a[i] - b[q[hd]]) * (a[i] - b[q[hd]]);\n\t\tfor(; hd < bk - 1 && slope(q[bk - 2], q[bk - 1]) > slope(i, q[bk - 1]); -- bk) ;\n\t\tq[bk ++] = i;\n\t}\n\tprintf(\"%lld\\n\", dp[n]);\n\treturn 0;\n}\n```\n\uff08\u611f\u8c22\u4e4b\u524d\u7684$dalao$\u4eec\u7684\u7ec6\u81f4\u8bb2\u89e3$qwq$",
        "postTime": 1540565144,
        "uid": 20375,
        "name": "hongzy",
        "ccfLevel": 9,
        "title": "P3195 \u300cHNOI 2008\u300d\u73a9\u5177\u88c5\u7bb1TOY\u300c\u659c\u7387\u4f18\u5316\u300d"
    },
    {
        "content": "# \u659c\u7387\u4f18\u5316\n\u524d\u7f6e\u77e5\u8bc6\uff1a\u52a8\u6001\u89c4\u5212\uff0c\u5355\u8c03\u961f\u5217\u3002\n\n\u597d\u4e86\uff0c\u5c31\u5f53\u5927\u5bb6\u5b66\u4f1a\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u4e00\u8d77\u5f00\u59cb\u5427\u3002\n\n\u5c31\u62ff\u8fd9\u4e00\u9898\u4f5c\u4e3a\u4f8b\u9898\u5427\u3002\u65b9\u7a0b\uff1a\n$$dp[i]=min(dp[j]+(\\sum_{k=j+1}^ic[k]+i-j-1-l)^2)$$\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n^3)$\n\n\u663e\u7136\u662f\u4e0d\u884c\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u4f18\u5316\u4e00\u4e0b\uff0c\u7528s\u50a8\u5b58c\u7684\u524d\u7f00\u548c\uff0c\u8fd9\u6837\u5316\u7b80\u4e4b\u540e\uff0c\u65b9\u7a0b\u5982\u4e0b\uff1a\n$$dp[i]=min(dp[j]+(s[i]-s[j]+i-j-1-l)^2)$$\n\u6211\u4eec\u4ee4$f[i]=s[i]+i$\uff0c\u5219\u65b9\u7a0b\u4e3a\uff1a\n$$dp[i]=min(dp[j]+(f[i]-f[j]-1-l)^2)$$\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n^2)$\n\n\u8fd8\u662f\u4f1a\u8d85\u65f6\n## \u659c\u7387\u4f18\u5316\u8be5\u4e0a\u4e86\n\u5047\u5982\u73b0\u5728\u6709\u4e24\u4e2a\u51b3\u7b56\uff0c\u5206\u522b\u4e3a\n$$dp[j]+(f[i]-f[j]-1-l)^2\\geq dp[k]+(f[i]-f[k]-1-l)^2$$\n\u5176\u4e2d\uff1a$j<k$\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u80af\u5b9a\u4f1a\u9009\u62e9$k$\uff0c\u5bf9\u5427\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5148\u628a\u4e0a\u9762\u8bb2\u8ff0\u7684\u4e0d\u7b49\u5f0f\u5316\u7b80\u4e00\u4e0b\uff0c\u4ee4$g[i]=(f[i]+1+l)^2,g[0]=(1+l)^2$\uff0c\u90a3\u4e48\u539f\u5f0f\u4e3a\uff1a\n$$dp[j]+(f[i]-(f[j]+1+l))^2\\geq dp[k]+(f[i]-(f[k]+1+l))^2$$\n$$dp[j]+f[i]^2-2\u00d7f[i]\u00d7(f[j]+1+l)+g[j]\\geq dp[k]+f[i]^2-2\u00d7f[i]\u00d7(f[k]+1+l)+g[k]$$\n\u79fb\u9879\u5f97\uff1a\n$$2\u00d7f[i]\u00d7(f[k]+1+l)-2\u00d7f[i]\u00d7(f[j]+1+l)\\geq dp[k]+f[i]^2+g[k]-dp[j]-f[i]^2-g[j]$$\n$$2\u00d7f[i]\u00d7(f[k]-f[j])\\geq dp[k]+g[k]-dp[j]-g[j]$$\n\u56e0\u4e3a$f[k]-f[j]>0$\uff0c\u6240\u4ee5\u5f97\u5230\uff1a\n$$2\u00d7f[i]\\geq \\frac{dp[k]+g[k]-dp[j]-g[j]}{f[k]-f[j]}$$\n\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u60ca\u5947\u5730\u53d1\u73b0\uff0c\u5982\u679c\u4e24\u4e2a\u51b3\u7b56\uff1a$j,k(j<k)$\u6ee1\u8db3$2\u00d7f[i]\\geq \\frac{dp[k]+g[k]-dp[j]-g[j]}{f[k]-f[j]}$\uff0c\u5219$k$\u6bd4$j$\u66f4\u4f18\u3002\n\n\u597d\u4e86\uff0c\u65e2\u7136\u6211\u4eec\u63a8\u51fa\u7684\u8fd9\u4e00\u4e2a\u5f0f\u5b50\uff0c\u90a3\u4e48\u6211\u4eec\u7ee7\u7eed\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u961f\u5217\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u961f\u5217\u4e2d\u7684\u5143\u7d20\u5355\u8c03\u9012\u589e\uff0c\u6211\u4eec\u5fc5\u987b\u5f00\u4e00\u4e2a\u5355\u8c03\u961f\u5217\u3002\u4fdd\u8bc1\u6bcf\u4e00\u6b21\u53d6\u961f\u9996\u7684\u5143\u7d20\u4e00\u5b9a\u662f\u6700\u4f18\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u8981\u7ef4\u62a4\u8fd9\u4e00\u4e2a\u961f\u5217\u3002\n\n\u9996\u5148\uff0c\u7ed9\u51fa\u8fd9\u4e00\u4e2a\u4e1c\u897f\uff1a\n```cpp\ndouble slope(int j1,int j2)\n{\n\treturn (double)(dp[j2]+g[j2]-dp[j1]-g[j1])/(f[j2]-f[j1]);\n}\nlong long pw(int a)\n{\n\treturn (long long)a*a;\n}\n```\n\u5e94\u8be5\u61c2\u5f97\u8fd9\u4e1c\u897f\u662f\u5e72\u4ec0\u4e48\u7684\u5427\uff0c\u7136\u540e\u6211\u4eec\u518d\u6765\u770b\uff1a\n\n\u9996\u5148\uff1a\n```cpp\nwhile(head<tail&&slope(d[head],d[head+1])<2*f[i]) head++;\ndp[i]=dp[d[head]]+pw(f[i]-f[d[head]]-1-l);\n```\n\u8fd9\u4e00\u4e2a\u5c31\u662f\u53d6\u6700\u4f18\u7684\u51b3\u7b56\uff0c\u5e94\u8be5\u6ca1\u95ee\u9898\u5427\u3002\n\n\u7136\u540e\uff0c\u56e0\u4e3a\u659c\u7387\u5012\u6389\u4e0a\u5347\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u8981$\\frac{dp[k]+g[k]-dp[j]-g[j]}{f[k]-f[j]}$\u5176\u5b9e\u4e5f\u8981\u4fdd\u8bc1\u5355\u8c03\u4e0a\u5347\uff0c\u8fd9\u6837\u624d\u80fd\u8fbe\u5230\u6700\u4f18\u89e3\uff0c\u6240\u4ee5\uff1a\n```cpp\nwhile(head<tail&&slope(d[tail],i)<slope(d[tail-1],d[tail])) tail--;\ntail++;\nd[tail]=i;\n```\n\u597d\u4e86\uff0c\u5927\u529f\u544a\u6210\uff0c\u6700\u540e\u7ed9\u4e00\u4efd\u5b8c\u6574\u7684\u4ee3\u7801\uff08\u7801\u98ce\u4e0d\u600e\u4e48\u6837\uff0c\u8bf7\u8c05\u89e3\uff09\uff1a\n```cpp\n#include<cstdio>\n#define N 100010\nusing namespace std;\nlong long dp[N],g[N];\nint f[N],d[N];\nint t,n,l,head,tail,s;\nlong long pw(int a)\n{\n\treturn (long long)a*a;\n}\ndouble slope(int j1,int j2)\n{\n\treturn (double)(dp[j2]+g[j2]-dp[j1]-g[j1])/(f[j2]-f[j1]);\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&l);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d\",&t);\n\t\ts+=t;\n\t\tf[i]=s+i;\n\t\tg[i]=pw(l+1+f[i]);\n\t}\n\tg[0]=pw(l+1);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(head<tail&&slope(d[head],d[head+1])\n\t\t\t<2*f[i]) head++;\n\t\tdp[i]=dp[d[head]]+pw(f[i]-f[d[head]]-1-l);\n\t\twhile(head<tail&&slope(d[tail],i)<\n\t\t\tslope(d[tail-1],d[tail])) tail--;\n\t\ttail++;\n\t\td[tail]=i;\n\t}\n\tprintf(\"%lld\",dp[n]);\n}\n```\n\u5b8c\u7f8e\u6492\u82b1\u2740\n## \u66f4\u65b0\u65e5\u5fd7\nupdata 2020.1.16 \u4fee\u6539\u4e86\u4e00\u4e2a\u5c0f\u5c0f\u7684\u9519\u8bef\n\nupdata 2020.6.27 \u5220\u6389\u4e86\u6ca1\u7528\u7684\u4e1c\u897f",
        "postTime": 1579941574,
        "uid": 99506,
        "name": "_LHF_",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY /\u3010\u6a21\u677f\u3011\u659c\u7387\u4f18\u5316\u3011"
    },
    {
        "content": "[P3195 [HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY](https://www.luogu.org/problemnew/show/P3195)\n**\u8fc7\u7a0b\u5341\u5206\u8270\u96be\uff0c\u523a\u8765**\n\n------------\n## \u4e0d\u8fc7\uff0c\u5565\u90fd\u4e0d\u8bf4\u4e86\uff0c\u9898\u89e3\u62db\u5f85*\u2014\u2014*\n# \"\u659c\u7387\u4f18\u5316\"  \u624d\u662f\u672c\u9898\u6b63\u89e3\n\n\u659c\u7387\u4f18\u5316\n\n------------\n\n\u76ee\u6807\u662f\u8981\u5316\u6210f[i]=a[i]*b[j]+c[j]+\uff08\u4e00\u4e2a\u53ea\u4e0ei\u6709\u5173\u7684\u5e38\u6570\uff09\u8fd9\u4e2a\u5f62\u5f0f\uff01\n[a[i]\u8868\u793a\u4e00\u4e2a\u4e0ei\u6709\u5173\u7684\u6570\uff0cb[j]\u3001c[j]\u4ea6\u5982\u6b64]\n\n\u79fb\u9879\uff1a-a[i]*b[j]+f[i]=c[j] \u6709\u6ca1\u6709\u5f88\u50cfy=kx+b\n\n\u628a-a[i]\u770b\u4e3a\u659c\u7387\uff0cb[j]\u4e3ax\uff0cc[j]\u4e3ay\uff0c\u753b\u4e00\u6761\u76f4\u7ebf \n\n\u90a3\u4e48\u7b54\u6848f[i]\u5c31\u662f\u76f4\u7ebf\u4e0ey\u8f74\u7684\u4ea4\u70b9\uff0c\u5373\u622a\u8ddd\n\n------------\n\n\u5148\u628adp\u65b9\u7a0b\u5199\u51fa\u6765\u5427\uff1af[i]=min( f[j] +[sum[i]-sum[j]+i-(j+1)-L]^2 ),j<=i (sum[i]\u4e3a\u524d\u7f00\u548c\u00a0\n\nf[i]\u8868\u793ai\u4e3a\u5176\u4e2d\u4e00\u4e2a\u65ad\u70b9\uff0c\u641e\u5b8c\u524di\u4e2a\u6570\u7684\u6700\u5c0f\u603b\u548c\n\n\u4e3a\u4e86\u7b80\u5316\u65b9\u7a0b\uff0c\u6211\u4eec\u8bbes[i]=sum[i]+i;L=L+1;\n\n\u90a3\u4e48\u539f\u65b9\u7a0b\u5219\u4e3a f[i]=min(f[j]+(s[i]-s[j]-L)^2)\uff0cj<=i\n\n\u5e73\u65b9\u62c6\u5f00\u3001\u79fb\u9879\u80fd\u5f97\u5230\uff1a2*(s[i]-L)*s[j]+f[i]=f[j]+s[j]^2\n\nk=2*(s[i]-L)\uff1bx=s[j]\uff1by=f[j]+s[j]*2\n## \u7136\u540e\u5417\uff0c\u4ee3\u7801\u4f3a\u5019\uffe5-\uffe5\n```cpp\n#include<bits/stdc++.h>\n#define maxn 50100\nusing namespace std;\ntypedef long long LL;\nLL s[maxn],q[maxn],f[maxn];\ndouble Y(LL j) {return f[j]+s[j]*s[j];}\ndouble X(LL j) {return s[j];}\ndouble xielu(LL j,LL k)\n{\n\treturn (Y(k)-Y(j))/(X(k)-X(j));\n}\nint main()\n{\n\tLL n,L,i,x,tou,wei;\n\tscanf(\"%lld%lld\",&n,&L);L++;s[0]=0;\n    for (i=1;i<=n;i++) {scanf(\"%lld\",&s[i]);s[i]+=s[i-1];}\n\tfor (i=1;i<=n;i++) s[i]+=i;\n\ttou=1;\n\twei=1;\n\tq[1]=0;\n\tfor (i=1;i<=n;i++)\n\t{\n\t\twhile (tou<wei &&xielu(q[tou],q[tou+1])<=2*(s[i]-L))tou++;\n\t\tint j=q[tou];\n\t\tf[i]=f[j]+(s[i]-s[j]-L)*(s[i]-s[j]-L);\n\t\twhile (tou<wei &&xielu(q[wei-1],q[wei])>xielu(q[wei],i)) wei--;\n\t\tq[++wei]=i;\n\t}\n\tprintf(\"%lld\\n\",f[n]);\n\treturn 0;\n}\n```\n",
        "postTime": 1559039879,
        "uid": 211665,
        "name": "ccsc",
        "ccfLevel": 0,
        "title": "\u7b2c\u4e00\u9053 \u7d2b\u9898 ac\u4e86\uff01\uff01\uff01"
    },
    {
        "content": "\u6253\u5e7f\u544a->[\u8fd9\u91cc](https://www.cnblogs.com/bztMinamoto/p/9544619.html)\n\n\u6765\u597d\u597d\u7684\u8bb2\u4e00\u8bb2\u659c\u7387\u4f18\u5316\uff08\u867d\u7136\u672c\u4eba\u624d\u505a\u4e86\u4e00\u4e24\u9053\u9898\uff09\n\n\u9996\u5148\u6211\u4eec\u8981\u77e5\u9053\uff0c\u5bf9\u4e8e\u5f62\u5982$dp[i]=a[j]+b[j]$\u7684\u5f0f\u5b50\uff0c\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u4f18\u5316\u5230$O(n)$\n\n\u4f46\u5982\u679c\u5f0f\u5b50\u53d8\u6210\u4e86\u5f62\u5982$dp[i]=a[i]*b[j]+c[i]+d[j]$\u7684\u65f6\u5019\uff0c\u56e0\u4e3a$a[i]*b[j]$\u8fd9\u4e00\u9879\u65e2\u4e0e$i$\u6709\u5173\u53c8\u4e0e$j$\u6709\u5173\uff0c\u6240\u4ee5\u76f4\u63a5\u5355\u8c03\u961f\u5217\u884c\u4e0d\u901a\u4e86\n\n\u6211\u4eec\u5148\u6765\u8003\u8651\u8fd9\u4e00\u9053\u9898\u76ee\uff0c\u8bbe\u524d\u7f00\u548c\u4e3a$sum[i]$\u8f6c\u79fb\u65b9\u7a0b\u5e94\u8be5\u662f$$dp[i]=min(dp[j]+(sum[i]+i-sum[j]-j-L-1)^2) (j<i)$$\n\n\u90a3\u4e48\u6211\u4eec\u8981\u8003\u8651\u4e00\u4e0b\u8fdb\u884c\u4f18\u5316\uff0c\u6211\u4eec\u5047\u8bbe\u9009\u53d6$j$\u4f1a\u6bd4$k$\u66f4\u4f18\uff0c\u4e14$k<j$\n\n\u90a3\u4e48$$dp[j]+(sum[i]+i-sum[j]-j-L-1)^2<dp[k]+(sum[i]+i-sum[k]-k-L-1)^2$$\n\n\u7136\u540e\u4e3a\u4e86\u65b9\u4fbf\u4e00\u70b9\uff0c\u4ee4$a[i]=sum[i]+i,b[i]=sum[i]+i+L+1$\n\n\u90a3\u4e48\u4e0a\u5f0f\u53ef\u4ee5\u5316\u4e3a$$dp[j]+(a[i]-b[j])^2<dp[k]+(a[i]-b[k])^2$$\n\n\u7136\u540e\u5c55\u5f00\u4e00\u4e0b$$dp[j]+a[i]^2-2*a[i]*b[j]+b[j]^2<dp[k]+a[i]^2-2*a[i]*b[k]+b[k]^2$$\n\n\u79fb\u9879$$dp[j]+b[j]^2-dp[k]-b[k]^2<2*a[i]*b[j]-2*a[i]*b[k]$$\n\n$$\\frac {dp[j]+b[j]^2-dp[k]-b[k]^2}{b[j]-b[k]}<2*a[i]$$\n\n\u7136\u540e\u4ee4$Y[i]=dp[i]+b[i]^2,x[i]=b[i]$\n\n\u90a3\u4e48\u539f\u5f0f\u53ef\u5316\u4e3a$$\\frac {Y[j]-Y[k]}{X[j]-X[k]}<2*a[i]$$\n\n\u6240\u4ee5\u5982\u679c$j>k$\u4e14$\\frac {Y[j]-Y[k]}{X[j]-X[k]}<2*a[i]$ \u90a3\u4e48$j$\u6bd4$k$\u66f4\u4f18\uff0c\u5426\u5219$k$\u6bd4$j$\u4f18\n\n\u6240\u4ee5\u8bc1\u4e86\u534a\u5929\u8fd9\u6709\u5565\u7528\u4e48\uff1f\u6ca1\u6709\n\n\u6211\u4eec\u8003\u8651\u4e00\u4e0b\uff0c\u82e5\u5728\u5e73\u9762\u76f4\u89d2\u5750\u6807\u7cfb\u4e0a\u5b58\u5728\u70b9$k:(X[k],Y[k])$\u4e0e$j:(X[j],Y[j])$\uff0c\u90a3\u4e48$\\frac {Y[j]-Y[k]}{X[j]-X[k]}$\u5c31\u662f\u4e24\u70b9\u7684\u659c\u7387\n\n\u7136\u540e\u4e00\u4e0b\u6211\u4eec\u7528$slope(i,j)$\u8868\u793a$i,j$\u4e24\u70b9\u7684\u659c\u7387\uff0c\u5373$\\frac {Y[i]-Y[j]}{X[i]-X[j]}$\n\n\u56e0\u4e3a$X[j],X[k],Y[i],Y[k]$\u90fd\u662f\u5b9a\u503c\uff0c\u6240\u4ee5\u4e0a\u9762\u4e24\u4e2a\u70b9\u90fd\u662f\u5b9a\u70b9\n\n\u7136\u540e\u6211\u4eec\u5047\u8bbe\u6709\u4e09\u4e2a\u503c$i,j,k$\uff08\u8fd9\u91cc\u7684$i$\u4e0e\u4e0a\u9762\u7684\u65e0\u5173\uff09\uff0c\u5176\u4e2d$k<j<i$\n\n\u6211\u4eec\u5047\u8bbe$slope(j,k)>slope(i,j)$\uff0c\u4e5f\u5c31\u662f\u8bf4\u662f\u4e0b\u9762\u8fd9\u4e2a\u6837\u5b50\n\n\n![](https://i.loli.net/2018/08/27/5b83fc008a9aa.png)\n \n\n\u90a3\u4e48$slope(j,k),slope(i,j),2*a[i]$\u4f1a\u6709\u4e09\u79cd\u5927\u5c0f\u5173\u7cfb\n\n\u5f53$slope(j,k)>slope(i,j)>2*a[i]$\u65f6\uff0c$j$\u6bd4$i$\u4f18\uff0c$k$\u6bd4$j$\u4f18\uff0c$j$\u4e0d\u662f\u6700\u4f18\n\n\u5f53$slope(j,k)>2*a[i]>slope(i,j)$\u65f6\uff0c$k$\u6bd4$j$\u4f18\uff0c$i$\u6bd4$j$\u4f18\uff0c$j$\u4e0d\u662f\u6700\u4f18\n\n\u5f53$2*a[i]>slope(j,k)>slope(i,j)$\u65f6\uff0c$j$\u6bd4$k$\u4f18\uff0c$i$\u6bd4$j$\u4f18\uff0c$j$\u4e0d\u662f\u6700\u4f18\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u5b58\u5728$slope(j,k)>slope(i,j)$\uff0c\u90a3\u4e48\u4ece$j$\u8f6c\u79fb\u65e0\u8bba\u5982\u4f55\u90fd\u4e0d\u53ef\u80fd\u662f\u6700\u4f18\u7684\u65b9\u6848\uff0c\u5df2\u7ecf\u53ef\u4ee5\u628a\u5b83\u7ed9\u6392\u9664\u4e86\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u5fc5\u987b\u4fdd\u8bc1\u7ef4\u62a4\u7684\u662f\u4e00\u4e2a\u4e0b\u51f8\u5305\uff0c\u5373$slope(j,k)>slope(i,j)$\uff0c\u5982\u4e0b\u56fe\n\n![](https://i.loli.net/2018/08/27/5b83fbf130e32.png)\n\n\u4e0d\u96be\u770b\u51fa\u4e0b\u51f8\u5305\u7684\u659c\u7387\u662f\u6c38\u8fdc\u5355\u8c03\u9012\u589e\u7684\uff0c\u90a3\u4e48\u53ef\u4ee5\u7528\u4e00\u4e2a\u5355\u8c03\u961f\u5217\u6765\u7ef4\u62a4\uff0c\u5373\u6bcf\u4e00\u6b21\u770b\u4e00\u770b\u6700\u672b\u5c3e\u7684\u5143\u7d20$slope(q[t],q[t-1])<slope(q[t],i)$\u662f\u5426\u6210\u7acb\uff0c\u82e5\u4e0d\u6210\u7acb\u5219\u628a$q[t]$\u5f39\u51fa\uff08\u5373$--t$\uff09\n\n\u6216\u8005\u5199\u6210$slope(q[t],q[t-1])<slope(q[t-1],i)$\u4e5f\u662f\u53ef\u4ee5\u7684\uff08\u4ed4\u7ec6\u89c2\u5bdf\u4e0a\u56fe\uff0c\u4e0d\u96be\u53d1\u73b0\u8fd9\u4e24\u4e2a\u5224\u65ad\u662f\u7b49\u4ef7\u7684\uff09\n\n\u90a3\u4e48\uff0c\u5728\u8fd9\u4e2a\u5355\u8c03\u961f\u5217\u91cc\u54ea\u4e00\u4e2a\u7b54\u6848\u624d\u662f\u6700\u4f18\u7684\u5462\uff1f\n\n\u56e0\u4e3a\u53ea\u6709$slope(j,k)<2*a[i]$\u65f6$j$\u624d\u4f1a\u6bd4$k$\u66f4\u4f18\uff0c\u800c\u56e0\u4e3a$a[i]=sum[i]+i$\uff08\u5fd8\u4e86\u7684\u53ef\u4ee5\u56de\u53bb\u770b\u770b\uff0c\u4e0a\u9762\u7684\u5047\u8bbe\uff09\uff0c\u6240\u4ee5$s[i]$\u80af\u5b9a\u662f\u9012\u589e\u7684\n\n\u90a3\u4e48\u5982\u679c$slope(j,k)>2*a[i]$\uff0c\u90a3\u4e48$j$\u5c31\u4e0d\u53ef\u80fd\u6bd4$k$\u66f4\u4f18\u4e86\uff0c\u5426\u5219$j$\u4e00\u5b9a\u6bd4$k$\u4f18\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a$k$\u4ece\u5355\u8c03\u961f\u5217\u91cc\u5220\u6389\u4e86\uff0c\u5373\u6bcf\u4e00\u6b21\u770b\u770b\u6700\u5f00\u5934\u7684\u5143\u7d20$slope(q[h],q[h+1])<2*a[i]$\u662f\u5426\u6210\u7acb\uff0c\u82e5\u6210\u7acb\uff0c\u5219\u628a$q[h]$\u5f39\u51fa\uff08\u5373$++h$\uff09\n\n\u90a3\u4e48\u6bcf\u4e00\u6b21\u5355\u8c03\u961f\u5217\u7684\u5f00\u5934\u90fd\u6ee1\u8db3$slope(q[h],q[h+1])>2*a[i]$\uff0c\u5373$q[h]$\u540e\u9762\u7684\u7b54\u6848\u6c38\u8fdc\u4e0d\u53ef\u80fd\u6bd4\u5b83\u66f4\u4f18\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u7528$q[h]$\u6765\u8fdb\u884c\u8f6c\u79fb\u5c31\u884c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n)$\n\n\u987a\u4fbf\u6ce8\u610f\u4e00\u4e2a\u7ec6\u8282\uff0c\u56e0\u4e3a\u6211\u4eec\u8981\u6c42\u7684$j$\u5fc5\u987b\u5c0f\u4e8e$i$\u6240\u4ee5\u6211\u4eec\u5e94\u8be5\u5148\u5904\u7406\u5b8c\u5355\u8c03\u961f\u5217\u5f00\u5934\u5e76\u66f4\u65b0\u5b8c\u7b54\u6848\uff0c\u518d\u53bb\u5904\u7406\u672b\u5c3e\n\n\u7136\u540e\u4e0a\u672c\u9898\u4ee3\u7801\n```\n//minamoto\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#define db double\n#define ll long long\nusing namespace std;\n#define getc() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline int read(){\n    #define num ch-'0'\n    char ch;bool flag=0;int res;\n    while(!isdigit(ch=getc()))\n    (ch=='-')&&(flag=true);\n    for(res=num;isdigit(ch=getc());res=res*10+num);\n    (flag)&&(res=-res);\n    #undef num\n    return res;\n}\nconst int N=50005;\nint n,L;\ndb sum[N],dp[N];int h,t,q[N];\ninline db a(int i){return sum[i]+i;}\ninline db b(int i){return sum[i]+i+L+1;}\ninline db X(int i){return b(i);}\ninline db Y(int i){return dp[i]+b(i)*b(i);}\ninline db slope(int i,int j){return (Y(i)-Y(j))/(X(i)-X(j));}\n//\u8fd9\u4e9b\u90fd\u5982\u4e0a\u9762\u5b9a\u4e49\uff0c\u5fd8\u4e86\u7684\u518d\u53bb\u770b\u770b \nint main(){\n    n=read(),L=read();\n    for(int i=1;i<=n;++i) sum[i]=read()+sum[i-1];\n    h=t=1;\n    //\u4e00\u5f00\u59cb\u8981\u5148\u653e\u4e00\u4e2a0\uff0c\u800c\u4e0d\u80fd\u628a\u5b83\u8bbe\u4e3a\u7a7a \n    for(int i=1;i<=n;++i){\n        while(h<t&&slope(q[h],q[h+1])<2*a(i)) ++h;\n        double p=a(i)-b(q[h]);\n        dp[i]=dp[q[h]]+p*p;\n        //\u66f4\u65b0\u7b54\u6848 \n        while(h<t&&slope(q[t-1],q[t])>slope(q[t-1],i)) --t;\n        q[++t]=i;\n    }\n    printf(\"%lld\\n\",(ll)dp[n]);\n    return 0;\n}\n```",
        "postTime": 1535376433,
        "uid": 41781,
        "name": "bztMinamoto",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "## \u5728\u8fd9\u91cc\u5199\u4e00\u5199\u5b66\u4e60\u5fc3\u5f97\n\n\u8fd9\u6b21\u6ca1\u6709\u627e\u5230\u5927\u4f6c\u7684\u535a\u5ba2\uff0c\u4e8e\u662f\u6211\u5c31\u81ea\u5df1\u5199\u5199\uff0c\u753b\u753b\u56fe\u5427\n\n\u4f17\u6240\u5468\u77e5\uff0cDP\u7684\u590d\u6742\u5ea6\u4e00\u822c\u662f$ O(n^a) $ \u7684\uff08\u5176\u4e2da\u4e3a\u5e38\u6570\uff09\n\n\u800c\u5bf9\u4e8e1e5\u53ca\u4ee5\u4e0a\u7684\u6570\u636e\uff0c\u666e\u901a\u7684dp\u5c31\u4e0d\u597d\u4f7f\u4e86\n\n\u4e8e\u662f\u5c31\u4ea7\u751f\u4e86DP\u7684\u4f18\u5316\u3002\n\n\u4f18\u5316\u6709\u5f88\u591a\u79cd\uff1a\u659c\u7387\u4f18\u5316\uff0c\u5355\u8c03\u961f\u5217\uff0c\u51b3\u7b56\u5355\u8c03\uff08\u4e0d\u7b49\u5f0f\uff09\uff0c\u6570\u636e\u7ed3\u6784\u2026\u2026\u2026\u2026\u2026\u2026\n\n\u5176\u4e2d\u659c\u7387\u4f18\u5316\u5f88\u5e38\u8003\uff0c\u4e0d\u8fc7\u4e5f\u6709\u6a21\u677f\n\n\u4e00\u822c\u7684\u8f6c\u79fb\u65b9\u7a0b $ dp_i  = max/min $ ( $ dp_j $   + \u5e73\u65b9\u9879) $ (0<=j<i) $\n\n\u8fd9\u65f6\u628a\u5e73\u65b9\u9879\u62c6\u5f00\u770b\uff0c\u53ef\u4ee5\u5199\u6210$ ai*bj $ \u7684\u5f62\u5f0f\u3002\n\n\u770b\u6210kx\u5c31\u884c\uff0c\u5176\u5b83\u7684\u770b\u6210\u5e38\u6570\u9879b\u3002\n\n\u4fdd\u8bc1\n$ dp_i $\u8fd9\u4e00\u9879\u5728b\u4e2d\uff0cy\u53ef\u4ee5\u8868\u793a\u4e3a\u548c $ dp_j $\u6709\u5173\u7684\u9879\n\n\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u753b\u51fa\u8fd9\u6837\u7684\u56fe\n\n![\u753b\u7684\u597d\u4e11555](https://cdn.luogu.com.cn/upload/image_hosting/k2arc8ic.png)\n\n\u6211\u4eec\u6240\u8981\u505a\u7684\uff0c\u5c31\u662f\u8981\u8ba9\u56fe\u4e2d\u76f4\u7ebf\u7684\u622a\u8ddd\u6700\u5c0f\uff08\u5927\uff09\u5316\u3002\n\n### \u5b9e\u73b0\n\n\u8fd0\u7528\u5efa\u6a21\u7684\u601d\u60f3\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u4e2a\u51b3\u7b56\u70b9\u53d8\u4e3a\u4e00\u4e2a\u70b9\n\n\u90a3\u4e48\u53ef\u4ee5\u5f97\u51fa\u51b3\u7b56\u70b9\u4e0e\u73b0\u51b3\u7b56\u70b9\u4e4b\u95f4\u7684\u5173\u7cfb\u2014\u2014\u8fde\u6210\u4e86\u4e00\u4e2a\u51f8\u5305\n\n\u5982\u679c\u6c42\u6700\u5927\u503c\uff0c\u7ef4\u62a4\u4e0a\u51f8\u5305\uff0c\u6700\u5c0f\u503c\u53cd\u662f\u3002\n\n\u800c\u5f53\u524d\u7684\u51b3\u7b56\u72b6\u6001\uff0c\u5c31\u662f\u4ee5\u67d0\u4e00\u659c\u7387\u53bb\u5207\u8fd9\u4e2a\u51f8\u5305\n\n\u800c\u6bcf\u5207\u4e00\u6b21\uff0c\u76f4\u7ebf\u7684\u659c\u7387\u90fd\u4f1a\u53d8\uff0c\u800c\u6211\u4eec\u8981\u627e\u7684\u4fbf\u662f\u6700\u4f18\u622a\u8ddd\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u627e\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u7ef4\u62a4\u8fd9\u4e2a\u51f8\u5305\uff0c\u4fdd\u8bc1\u6bcf\u6b21\u51b3\u7b56\u7684\u70b9\u662f\u6700\u4f18\u7684\uff08\u5982\u5355\u8c03\u961f\u5217\uff0c\u5355\u8c03\u6808\u2026\u2026\uff09\n\n\u81f3\u4e8e\u7ef4\u62a4\u51f8\u5305\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u5728\u9898\u91cc\u7ec6\u8bf4\u3002\n\n\uff08\u53e3\u80e1\u5b8c\u4e86\uff0c\u62cd\u5f20\u56fe\uff09\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/fq81cd15.png)\n\n\n### \u9898\u89e3\n\n[P3195](https://www.luogu.com.cn/problem/P3195)\n\n[P3628](https://www.luogu.com.cn/problem/P3628)\n\n\u8fd9\u4e24\u9053\u6a21\u677f\u9898\uff0c\u5148\u505a\u505a\u3002\n\n\u6211\u5199\u4e00\u7bc7P3628\u7684\u9898\u89e3\uff08\u8fd9\u662f\u4e00\u4f4d\u5b66\u957f\u53bb\u5e74\u8bb2\u5f97\uff0c\u6211\u4eca\u5e74\u624d\u505a\u51fa\u6765\uff0c\u60ed\u6127\u554a\uff01\uff09\n\n\u6211\u4eec\u5f88\u5bb9\u6613\u5f97\u51fa $ O(n^2) $\u7684dp\u65b9\u7a0b\uff1a$ dp_i=\\max_{0<=j<i}\\{{dp_j+a(sum_i-sum_j)^2+b(sum_i-sum_j)+c}\\} $ \n\n\u901a\u8fc7\u4e0a\u6587\u7684\u62c6\u9879\u65b9\u5f0f\uff0c\u6211\u4eec\u5f97\u5230\n\n$ dp_i=\\max_{0<=j<i}\\{{dp_j-2a(sum_i-sum_j)+asum_j^2-bsum_j}\\}+asum_i^2+bsum_i+c $ \n\n\u4e4b\u540e\u753b\u51fa\u76f4\u7ebf\uff0c\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e0a\u51f8\u5305\uff0c\u4f7f\u622a\u8ddd\u6700\u5927\u3002\n\n\u4f18\u79c0\u7684push\uff0c\u4e0d\u4f18\u7684pop\n\n\u6ce8\u610f\u7ef4\u62a4\u5355\u8c03\u961f\u5217\u7684\u5355\u8c03\u6027\n\n\u76f4\u63a5\u8f6c\u79fb\u5373\u53ef\uff0c\u4e0a\u4ee3\u7801\n\n```c++\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n\nconst int INF=0x3f3f3f3f3f3f;\n\ndouble x,y,k;\nint n,L,ans=INF;\ndouble c[50009],dp[50009],sum[50009];\nint Q[50009],h,t;\ninline int X(int p) {return (sum[p]+p+L+1);}\ninline int Y(int p) {return dp[p]+X(p)*X(p);}\ninline int A(int p) {return sum[p]+p;}\n\ninline double cal(double x,double y)\n{\n\treturn (Y(x)-Y(y))/(X(x)-X(y));\n}\n\nsigned main()\n{\n//\tfreopen(\"P3195_1.in\",\"r\",stdin);\n//\tfreopen(\"P3195_1.out\",\"w\",stdout);\n\tscanf(\"%d%d\",&n,&L);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%lf\",&c[i]);\n\t\tsum[i]=sum[i-1]+c[i];\n\t}\n\th=t=1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(h<t&&cal(Q[h],Q[h+1])<2*A(i)) h++;\n\t\tdp[i]=dp[Q[h]]+(A(i)-X(Q[h]))*(A(i)-X(Q[h]));\n\t\twhile(h<t&&cal(Q[t-1],i)<cal(Q[t-1],Q[t])) t--;\n\t\tQ[++t]=i;\n\t}\n\tprintf(\"%lld\",(long long)dp[n]);\n\treturn 0;\n}    \n```\n\n#### PS \n\n\u6ce8\u610f\u5728\u8fdb\u884c\u659c\u7387\u7684\u6bd4\u8f83\u65f6\uff0c\u56e0\u4e3a\u201c/\u201d\u662f\u5411\u4e0b\u53d6\u6574\uff0c\u5bb9\u6613\u51fa\u9505\n\n\u6240\u4ee5\u4e00\u822c\u5316\u9664\u4e3a\u4e58\uff0c\u6216\u8f6c\u4e00\u4e0bdouble\n\n\u6700\u540e%\u5b66\u957f[whyl](https://www.luogu.com.cn/user/118918)\n\n\u6211\u592a\u83dc\u4e86",
        "postTime": 1579657738,
        "uid": 237308,
        "name": "AlanSP",
        "ccfLevel": 0,
        "title": "\u5b66\u4e60\u7b14\u8bb0 \u659c\u7387\u4f18\u5316DP"
    },
    {
        "content": "\u660e\u663e\u7684\u659c\u7387\u4f18\u5316\u9898~\n\n\u6240\u4ee5\u6211\u4eec\u6309\u7167\u4e00\u822c\u7684\u7a0b\u5e8f\u6765\u770b\n\n\u4e0d\u61c2\u7684\u53ef\u4ee5\u770b[\u6211\u7684blog](https://www.luogu.org/blog/a999999/xie-shuai-you-hua-di-ji-ben-bu-zhou)\n\n\u9996\u5148\u5217\u51fadp\u65b9\u7a0b\uff1a\n$$f_i=min_{0<j<i}\\{f_j+(i-j-1-L+\\sum_{k=j+1}^iC_k)^2\\}$$\n\u7136\u540e\u6309\u57fa\u672c\u6b65\u9aa4\u6765\uff1a\n\u8bbe$sum_i=\\sum_{j=1}^{i}C_j$\n\n\u4e8e\u662f\u5c31\u6709\n$$f_i=f_j+(i-j+sum_i-sum_j-L-1)^2$$\n\u8bbe$j>k$\u4e14$j$\u6bd4$k$\u4f18\n$$f_j+[(sum_i+i-L-1)-(sum_j+j)]^2<f_k+[(sum_i+i-L-1)-(sum_k+k)]^2$$\n$$f_j-2(sum_i+i-L-1)(sum_j+j)+(sum_j+j)^2<f_k-2(sum_i+i-L-1)(sum_k+k)+(sum_k+k)^2$$\n$$f_j-f_k+(sum_j+j)^2-(sum_k+k)^2<2(sum_i+i-L-1)(sum_j+j-sum_k-k)$$\n$$\\frac{f_j-f_k+(sum_j+j)^2-(sum_k+k)^2}{sum_j+j-sum_k-k}<2(sum_i+i-L-1)$$\n\n\u518d\u5077\u5077\u544a\u8bc9\u4f60\u4e00\u4e2a\u5c0f\u6280\u5de7\n\n\u961f\u5c3e\u6392\u9664\u65f6\u4e0d\u77e5\u9053\u5927\u4e8e\u8fd8\u662f\u5c0f\u4e8e\u7684\u65f6\u5019\n\n~~\u7528\u6837\u4f8b\u628a\u4e24\u79cd\u60c5\u51b5\u90fd\u8bd5\u4e00\u4e0b\u5c31\u597d\u5566~~\n\n$Code:$\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#define N 50010 \n#define S(x) ((x)*(x))\nlong long f[N],sum[N],m;\nint n,q[N];\nlong long Y(int x,int y)\n{\n\treturn f[x]-f[y]+S(sum[x]+x)-S(sum[y]+y);\n}\nlong long X(int x,int y)\n{\n\treturn sum[x]+x-sum[y]-y;\n}\nsigned main(int argc,char **argv)\n{\n\tscanf(\"%d%lld\",&n,&m);\n\tfor(int i=1;i<=n;++i)\n\t\tscanf(\"%lld\",sum+i),\n\t\tsum[i]+=sum[i-1];\n\tfor(int l=0,r=0,i=1;i<=n;++i)\n\t{\n\t\twhile(Y(q[l+1],q[l])<2*(sum[i]+i-m-1)*X(q[l+1],q[l])&&l<=r)++l;//\u8bb0\u5f97-1\n\t\tf[i]=f[q[l]]+S(i-q[l]+sum[i]-sum[q[l]]-m-1);//\u8bb0\u5f97-1\n\t\twhile(Y(q[r],q[r-1])*X(i,q[r])>Y(i,q[r])*X(q[r],q[r-1])&&l<=r)--r;\n\t\tq[++r]=i;\n\t}\n\tprintf(\"%lld\",f[n]);\n\treturn 0;\n}\n```",
        "postTime": 1560388007,
        "uid": 84836,
        "name": "a999999",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3195\u3010[HNOI]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "# [\u9898\u9762](https://www.luogu.org/problemnew/show/P3195)\n[\u60ca\u559c](https://www.cnblogs.com/ztlztl/p/10616538.html)\n\n\u200b\t\u6700\u8fd1\u5728\u641edp, \u53d1\u73b0\u81ea\u5df1\u7684dp\u8fd8\u662f\u592a\u5f31\u4e86, \u505a\u7684\u9898\u6bd4\u8f83\u5c11, \u4e5f\u6709\u4e00\u4e9b\u4e1c\u897f\u6ca1\u5b66, \u8fd9\u9053\u9898\u7b97\u662f\u6211\u72ec\u7acb\u505a\u7684\u7b2c\u4e00\u9053\u659c\u7387\u4f18\u5316dp, \u5199\u7bc7\u9898\u89e3\u7eaa\u5ff5\u4e00\u4e0b\u5427.\n\n\u200b\tdp\u5f0f\u6bd4\u8f83\u7b80\u5355, \u5c31\u662f\u4e00\u4e2a\u7ebf\u6027\u7684dp, \u8bbe$f[i]$\u4e3a\u5c061 ~ i\u5206\u4e3a\u82e5\u5e72\u4e2a\u96c6\u5408\u6240\u82b1\u8d39\u7684\u6700\u5c0f\u503c, $c[i]$\u4e3a1 ~ i\u7684$c$\u503c\u7684\u524d\u7f00\u548c, \u5bf9\u4e8e\u6ee1\u8db3$j$\u5c0f\u4e8e$i$\u7684$j$, \u5219\u6709:\n$$\nf[i] = min(f[j] + (c[i] - c[j] + i - j - 1 - l)^2)\\tag{1}\n$$\n\u8bbe$a[i] = c[i] + i$, $b[i] = c[i] + i + 1 + l$, \u5219\u53ef\u5c06\u4e0a\u5f0f\u5316\u7b80\u4e3a\u4e0b\u5f0f:\n$$\n\\begin{aligned}\nf[i] = & min(f[j] + (a[i] - b[j])^2)\\\\\n=&min(f[j] + a[i] ^ 2 + b[j] ^ 2 - 2 * a[i] * b[j])\n\\end{aligned}\n$$\n\u5047\u8bbe\u5bf9\u4e8e\u67d0\u4e2a$k$($k$ >$j$), \u9009$k$\u6bd4\u9009$j$\u66f4\u4f18, \u5219\u6709\u4e0b\u5f0f:\n$$\n\\begin{aligned}\nf[k] + a[i] ^ 2 + b[k] ^ 2 - 2 * a[i] * b[k] &< f[j] + a[i] ^ 2 + b[j] ^ 2 - 2 * a[i] * b[j]\\\\\n(f[k] + b[k] ^ 2) - (f[j] + b[j] ^ 2) &< 2 * a[i] * (b[k] - b[j])\\\\\n\\frac{(f[k] + b[k] ^ 2) - (f[j] + b[j] ^ 2)}{2 * (b[k] - b[j])} &< a[i]\n\\end{aligned}\n$$\n\u5bf9\u4e8e\u4e0a\u8ff0\u51e0\u4e2a\u4e0d\u7b49\u5f0f, \u7531\u4e8e$c[i]$\u4e0e$i$\u5355\u8c03\u9012\u589e, \u6240\u4ee5$a[i]$\u4e5f\u662f\u5355\u8c03\u9012\u589e\u7684, \u90a3\u4e48\u5bf9\u4e8e\u5e73\u9762\u4e0a\u7684\u4efb\u610f\u4e09\u4e2a\u51b3\u7b56\u70b9$j_1$, $j_2$, $j_3$, \u82e5$j_2$\u5bf9$i$\u6700\u4f18, \u5219$(b[j_1], f[j_1] + b[j _ 1] ^ 2)$, $(b[j_2], f[j_2] + b[j _ 2]^2)$, $(b[j_3], f[j _ 3] + b[j _ 3] ^ 2)$\u4e09\u70b9\u5e94\u8be5\u6ee1\u8db3\u4e0b\u5217\u4e24\u4e2a\u7b49\u5f0f: \n$$\n\\begin{aligned}\n\\frac{(f[j_2] + b[j_2] ^ 2) - (f[j _ 1] + b[j _ 1] ^ 2)}{2 * (b[j_2] - b[j _ 1])} &< a[i]\\\\\n\\frac{(f[j_3] + b[j_3] ^ 2) - (f[j _ 2] + b[j _ 2] ^ 2)}{2 * (b[j_3] - b[j _ 2])} &\\geq a[i]\\\\\n\\end{aligned}\n$$\n\u6240\u4ee5\u6709:\n$$\n\\frac{(f[j_3] + b[j_3] ^ 2) - (f[j _ 2] + b[j _ 2] ^ 2)}{2 * (b[j_3] - b[j _ 2])} >\\frac{(f[j_2] + b[j_2] ^ 2) - (f[j _ 1] + b[j _ 1] ^ 2)}{2 * (b[j_2] - b[j _ 1])}\n$$\n\u6545\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u5305\u5373\u53ef, \u6ce8\u610f\u5355\u8c03\u961f\u5217\u521d\u59cb\u5316\u65f6\u8981\u5148\u52a0\u5165\u4e00\u4e2a0. \n\n**\u4ee3\u7801**\n\n```cpp\n#include <iostream>\n#include <cstring>\n#include <cstdio>\n#define N 50005\n#define int long long\nusing namespace std;\n\nint n, L, sum[N], a[N], b[N], f[N], q[N], l = 1, r; \n\ninline int read()\n{\n\tint x = 0, w = 1;\n\tchar c = getchar();\n\twhile(c < '0' || c > '9') { if (c == '-') w = -1; c = getchar(); }\n\twhile(c >= '0' && c <= '9') { x = x * 10 + c - '0'; c = getchar(); }\n\treturn x * w;\n}\n\nbool F_check(int x, int y, int z) { return f[y] - f[x] + b[y] * b[y] - b[x] * b[x] < 2 * z * (b[y] - b[x]); }\n\nbool S_check(int x, int y, int z)\n{\n\treturn (f[y] - f[x] + b[y] * b[y] - b[x] * b[x]) * (b[z] - b[y]) > (f[z] - f[y] + b[z] * b[z] - b[y] * b[y]) * (b[y] - b[x]); \n}\n\nsigned main()\n{\n\tn = read(); L = read(); \n\tfor(int i = 1; i <= n; i++)\n\t{\n\t\tsum[i] = read(); sum[i] += sum[i - 1];\n\t\ta[i] = sum[i] + i; b[i] = sum[i] + i + L + 1; \n\t}\n\tmemset(f, 0x3f, sizeof(f));\n\tb[0] = L + 1; f[0] = 0;\n\tq[++r] = 0; \n\tfor(int i = 1; i <= n; i++)\n\t{\n\t\twhile(l < r && F_check(q[l], q[l + 1], a[i])) l++;\n\t\tf[i] = f[q[l]] + a[i] * a[i] + b[q[l]] * b[q[l]] - 2 * a[i] * b[q[l]];\n\t\twhile(l < r && S_check(q[r - 1], q[r], i)) --r;\n\t\tq[++r] = i; \n\t}\n\tprintf(\"%lld\\n\", f[n]); \n\treturn 0;\n}\n\\\\\u6709\u4e00\u4e9b\u6570\u7ec4\u7684\u540d\u5b57\u6539\u52a8\u4e86\u4e00\u70b9\u70b9, \u4e16\u4e0a\u4e0d\u662f\u7f3a\u5c11\u4e0d\u4e00\u6837\u7684\u4e1c\u897f, \u800c\u662f\u7f3a\u5c11\u53d1\u73b0\u4e0d\u4e00\u6837\u7684\u4e1c\u897f\u7684\u773c\u775b\n```\n\n~~\u4f60\u89c9\u5f97\u6211\u4f1a\u544a\u8bc9\u4f60\u6211\u5728\u5199\u9898\u76ee\u4e4b\u524d\u5c31\u628a\u9898\u89e3\u5199\u5b8c\u4e86\u5417???~~",
        "postTime": 1553765936,
        "uid": 160323,
        "name": "mgzc",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "### \u505a\u6cd5: \n\u3000\u3000\u7528$f(i)$\u8868\u793a\u524d$i$\u4e2a\u7269\u54c1\u7684\u957f\u5ea6\u52a0\u7269\u54c1\u4e2a\u6570$s_n=\\sum\\limits_{i=1}^nc_i+j$, \u90a3\u4e48\u7b2c$i$\u5230$j$\u4e2a\u7269\u54c1\u7684\u957f\u5ea6\u52a0\u7269\u54c1\u4e2a\u6570\u5c31\u4e3a$s_j-s_{i-1}$.\u8fd9\u5c31\u662f\u9898\u76ee\u8981\u6c42\u7684$(x-l)^2$\u4e2d\u7684x.\n\u3000\u3000\u9996\u5148\u53ef\u4ee5\u60f3\u51fa\u4e00\u4e2a\u6734\u7d20\u7684dp.$f(i)$\u8868\u793a\u524d$i$\u4e2a\u6570\u653e\u5230\u82e5\u5e72\u4e2a\u76d2\u5b50\u91cc(\u653e\u6ee1)\u7684\u6700\u5c0f\u82b1\u8d39.\u5219$f(i)$\u4e3a$j$\u4e2a\u7269\u54c1\u6700\u5c0f\u4ee3\u4ef7\u52a0\u4e0a\u8fd9\u4e2a\u76d2\u5b50\u7684\u4ee3\u4ef7, \u8f6c\u79fb\u65b9\u7a0b\u4e3a:\n$$f(i)=\\max\\{f(j)+(s_i-s_j-l-1)^2\\},j<i$$\n\n\u3000\u3000\u8868\u793a\u65b0\u52a0\u4e00\u4e2a\u76d2\u5b50\u88c5\u7b2c$j+1$\u5230$i$\u4e2a\u7269\u54c1.\n\u3000\u3000\u4f18\u5316\u8fd9\u4e2a$n^2$\u8f6c\u79fb\u7684\u65b9\u6cd5\u4e3b\u8981\u6709\u4e24\u79cd.\n- \u659c\u7387\u4f18\u5316\n- \u51b3\u7b56\u5355\u8c03\u6027\n\n\u3000\u3000\u659c\u7387\u4f18\u5316\u7684\u590d\u6742\u5ea6\u8f83\u4f4e, \u4e3a$O(n)$, \u8fd9\u662f\u8003\u8651\u5230\u5176\u5355\u8c03\u961f\u5217\u590d\u6742\u5ea6\u4e3a\u5747\u644a$O(7n)$.\u800c\u4e00\u6b21\u8f6c\u79fb\u53ea\u9700\u8981\u53d6\u51fa\u5355\u8c03\u961f\u5217\u4e2d\u7684\u4e00\u4e2a\u6700\u5c0f\u503c.\n\t.\n\u3000\u3000\u5728$N^2$\u8f6c\u79fb\u4e2d, \u6c42$f(i)$\u9700\u8981\u679a\u4e3e\u4ece$j,j< i$\u8f6c\u79fb\u7684\u4ee3\u4ef7.\u53ef\u4ee5\u901a\u8fc7\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u961f\u5217\u6765\u5c06\u8fd9\u4e00\u8fc7\u7a0b\u4f18\u5316\u5230$O(1)$, \u8003\u8651\u4ece$k$\u8f6c\u79fb\u5230$i$\u6bd4\u4ece$j$\u8f6c\u79fb\u5230$i$\u4ee3\u4ef7\u66f4\u4f4e, \u5176\u6ee1\u8db3\u8fd9\u4e48\u4e00\u4e2a\u4e0d\u7b49\u5f0f.\n\n$$f(j)+(s_j-s_i-l-1)^2>f(k)+(s_k-s_i-l-1)^2$$\n\u5c06\u8fd9\u4e2a\u5f0f\u5b50\u5c55\u5f00\u53ef\u4ee5\u5f97\u5230\u5982\u6b64\u7684\u9650\u5236\u5173\u7cfb.\n\n$$s_i>\\frac{f_k-f_i+(s_k+1+1)^2-(s_j+1+1)^2}{s\\cdot(s_k-s_j)}$$\n\u5c06\u53f3\u8fb9\u7684\u5f0f\u5b50\u8bb0\u4e3a$p(k,j)$, \u53ef\u4ee5\u53d1\u73b0\u6c42\u5f97\u6700\u5927\u7684$p(k,j)$\u6ee1\u8db3$s_i>p(k,j)$, \u5219$f(i)$\u4e3a$f(k)+(s_k-s_i-l)^2$.\n\u3000\u3000\u901a\u8fc7\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u9012\u589e\u961f\u5217,\u7528$q_i$\u8868\u793a\u961f\u5217\u4e2d\u7684\u5143\u7d20, $q_h, q_t$\u8868\u793a\u961f\u5934\u548c\u961f\u5c3e.\u5355\u8c03\u961f\u5217\u4e2d\u7684\u5143\u7d20\u662f\u53ef\u4ee5\u8f6c\u79fb\u81f3\u7b54\u6848\u7684\u70b9, \u7b54\u6848\u4ece\u961f\u9996\u5bfb\u627e.\u5355\u8c03\u961f\u5217\u4e2d\u5143\u7d20\u7684\u5355\u8c03\u6027\u662f\u6307\u6ee1\u8db3$p(q_{i+1},q_{i})<p(q_{i+2},q_{i+1})$,\u5bf9\u4e8e$f(1)$\u5230$f(n)$\u7684\u6c42\u503c, \u56e0\u4e3a$s_i$\u4e3a\u5355\u8c03\u9012\u589e, \u6240\u4ee5\u53ef\u4ee5\u4fdd\u8bc1\u5220\u9664\u961f\u5217\u624b\u5143\u7d20\u4e0d\u4f1a\u5f71\u54cd\u7b54\u6848.\n\n- \u6c42$f(i)$\u65f6, \u5982\u679c$p(q_{h+1},q_{h})\\leq s_i$,\u5c31\u5f39\u51fa\u961f\u9996.\u76f4\u5230\u65e0\u6cd5\u5f39\u51fa\u65f6\u5373\u4ece$q_h$\u5176\u8f6c\u79fb\u81f3\u5f53\u524d\u70b9\u6700\u4f18.\n- \u6bcf\u6b21\u5c06\u4e00\u4e2a\u70b9$i$\u52a0\u5165\u961f\u5217\u65f6, \u4e3a\u4e86\u4fdd\u8bc1\u961f\u5217\u7684\u5355\u8c03\u6027, \u4f9d\u6b21\u5f39\u51fa\u961f\u5c3e\u76f4\u5230\u6ee1\u8db3\u5355\u8c03\u9012\u589e.\n\n### Code\n```c++\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#define N 100005\n\nlong long sum[N];\nlong long f[N];\nint q[N];\nint h,t;\nint n,l;\n\nlong long pow(long long s){\nreturn (long long)s*s;\n}\ndouble cmp(int i,int j){\n\treturn (double)(f[j]-f[i]+pow(sum[j]+l)-pow(sum[i]+l))/(2*(sum[j]-sum[i]));\n}\n\nint main(){\n\tlong long temp;\n\tscanf(\"%d%d\",&n,&l);l+=1;\n\tfor(int i=1;i<=n;++i){\n\t\tscanf(\"%lld\",&temp);\n\t\tsum[i]=(long long)sum[i-1]+1+temp;\n\t}\n\tfor(int i=1;i<=n;++i){\n\t\twhile(h<t&&cmp(q[h],q[h+1])<=(double)sum[i])++h;\n\t\tf[i]=(long long)f[q[h]]+pow(sum[i]-sum[q[h]]-l);\n\t\twhile(h<t&&cmp(q[t-1],q[t])>cmp(q[t],i))--t;\n\t\tq[++t]=i;\n\t}\n\tprintf(\"%lld\",f[n]);\n\treturn 0;\n}\n```\n",
        "postTime": 1525918951,
        "uid": 39067,
        "name": "aiyougege",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "\u6211\u4eec\u4ece\u66b4\u529b\u51b3\u7b56\u6253\u8868\u5f97\u77e5, \u51b3\u7b56\u603b\u662f\u6ee1\u8db3\u5355\u8c03\u6027\u7684, \u4e00\u4e2a\u51b3\u7b56j<k\u5728\u4e4b\u524dk\u8d77\u4f5c\u7528\u800cj\u6ca1\u6709, \u5728k\u4e4b\u540ej\u5c31\u518d\u4e5f\u6ca1\u6709\u4e86,\u8fd9\u5c31\u662f\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\u539f\u7406[\u8be6\u89c1\u5218\u6c5d\u4f73\u9ed1\u4e66\u7b49\u8d44\u6599], \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u52a8\u6001\u7ef4\u62a4\u51b3\u7b56\u533a\u95f4\u8fbe\u5230\u76ee\u7684, \u7136\u800c\u8fd9\u91cc\u4f7f\u7528\u4e86\u5355\u8c03\u6808\u53bb\u4e8c\u5206, \u8be6\u89c1<http://blog.csdn.net/qq\\_34025203/article/details/50976612>,\u6709\u6bd4\u8f83\u8be6\u7ec6\u7684\u8bb2\u89e3,\u8fd9\u91cc\u7ed9\u51fa\u4e86\u7a0b\u5e8f\n\n```cpp\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#define LL long long \nconst int N = 1e5 + 10;\nusing namespace std; \nint n,h,t;\nLL m,a[N],l,sum[N],f[N];\nstruct Nodes {int l,r,p;} q[N];\n```\nnamespace SAKman\n```cpp\n{\n  LL spr(LL x) {return x*x;} \n  LL cal(int x,int y) {return f[x]+spr(sum[y]-sum[x]+y-x-1-l);}\n  int find(Nodes qi,int o)\n  {\n    int l=qi.l, r=qi.r;\n    while(l<=r)\n    {\n      int m=(l+r) >> 1;\n      if(cal(o,m) < cal(qi.p,m)) r=m-1; else l=m+1;\n    }\n    return l;\n  }\n  void run() \n  {\n    scanf(\"%d%lld\",&n,&l);\n    for(int i=1; i<=n; ++i){scanf(\"%lld\",&a[i]);sum[i]=sum[i-1]+a[i];}\n    h=1;t=0;q[++t]=(Nodes){0,n,0};\n    for(int i=1; i<=n; ++i) \n    {\n      if(i>q[h].r) ++h;\n      f[i]=cal(q[h].p,i);\n      while(h>t||cal(i,n)<cal(q[t].p,n))\n      {    \n        while(h<=t && cal(i,q[t].l)<cal(q[t].p,q[t].l)) --t;\n        if(h<=t)\n        {\n          int z=find(q[t],i);\n          q[t].r=z-1;\n          q[++t]=(Nodes){z,n,i}; \n        } \n        else q[++t]=(Nodes){i,n,i};\n      }    \n    }\n    printf(\"%lld\\n\",f[n]);\n  }\n}\nusing namespace SAKman; int main() {    run();}\n\n```",
        "postTime": 1497337166,
        "uid": 7268,
        "name": "_bestknife",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "\n\n[\u9898\u9762](https://www.Luogu.org/probLemnew/show/P3195)\n\u5927\u610f\uff1a~~\u81ea\u5df1\u770b\u592a\u590d\u6742\u6211\u4e0d\u60f3\u89e3\u91ca\u4e86~~\n\n---\n\u7ec8\u4e8e\uff0c\u6211\u8981\u5f00\u59cb\u590d\u4e60\u6211\u76ee\u524d\u63a5\u89e6\u5230\u7684\u6700\u6bd2\u7624\u3001\u601d\u8003\u96be\u5ea6\u6700\u5927\u7684\u7b97\u6cd5\u4e86\u3002\n\n**\u659c\u7387\u4f18\u5316\u3002**\n\n\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\uff1a ~~\u659c\u7387\u4f18\u5316\u5728\u6211\u770b\u6765\u5c31\u662f\u5229\u7528\u4e00\u4e2a\u7384\u5b66\u7684\u65b9\u6cd5\u786e\u5b9a\u4e00\u4e2a\u503c\uff0c\u7136\u540e\u7528\u8fd9\u4e2a\u503c\u53bb\u786e\u5b9a\u4ee5\u524d\u7684\u4e00\u4e9b\u72b6\u6001\u662f\u5426\u6ca1\u6709\u7528\uff0c\u518d\u7ed3\u5408\u5355\u8c03\u961f\u5217\u6216\u5176\u4ed6\u6570\u636e\u7ed3\u6784\u51cf\u5c11DP\u8fc7\u7a0b\u4e2d\u7684\u7ee7\u627f\u6b21\u6570\uff0c\u4ece\u800c\u8fbe\u5230\u52a0\u901f\u7684\u76ee\u7684\u3002~~ \u4e0d\u5f97\u4e0d\u8bf4\u659c\u7387\u4f18\u5316**\u5fc5\uff01\u987b\uff01\u5f97\uff01\u6570\uff01\u5f62\uff01\u7ed3\uff01\u5408\uff01**\n\n\u659c\u7387\u4f18\u5316\u662f\u5c06\u6bcf\u4e00\u4e2a\u72b6\u6001\u8f6c\u6362\u6210\u51b3\u7b56\u70b9\uff0c\u518d\u7528\u6c42\u6700\u5c0f\u622a\u8ddd\u7b49\u65b9\u6cd5\u52a0\u901f\u7684\n\n\u5e9f\u8bdd\u5c11\u8bf4\u6211\u4eec\u6765\u505a\u9898\n\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u98de\u5feb\u5730\u60f3\u51fa$O(n^2)$\u7684\u7b97\u6cd5\uff1a\n\n$f[i]$\u8868\u793a\u524d$i$\u4e2a\u73a9\u5177\u88ab\u88c5\u597d\u7684\u6700\u5c0f\u82b1\u8d39\n\n\u7136\u540e\n\n$$f[i]=\\min\\limits^{i-1}_{j=0}(f[j]+(i-j-1+\\sum\\limits^{i}_{k=j+1}a[i]-L)^2)$$\n\u5373\u5c06\u7b2c$j+1$\u5230\u7b2c$i$\u4e2a\u653e\u5230\u4e00\u4e2a\u76d2\u5b50\u4e2d\n\n\uff08\u8bf7\u539f\u8c05\u6211\u7528\u4e86\u4e00\u79cd\u7384\u5b66\u7684\u65b9\u5f0f\u8868\u793a\u6c42\u6700\u5c0f\u503c\uff09\n\n\u5176\u4e2d$\\sum\\limits^{i}_{k=j+1}a[i]$\u4e00\u90e8\u5206\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u6c42\n\n```cpp\n#incLude<cstdio>\n#incLude<cstring>\nusing namespace std;\nLong Long min(register Long Long a,register Long Long b)\n{return a<b?a:b;}\nLong Long sqr(register Long Long x)\n{return x*x;}\nint a[51000],sum[51000];\nLong Long f[51000];\nint main()\n{\n\tint n,l;\n\tscanf(\"%d%d\",&n,&l);\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%d\",a+i),sum[i]=sum[i-1]+a[i];\n\tmemset(f,1,sizeof(f));\n\tf[0]=0;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=0;j<n;j++)\n\t\t\tf[i]=min(f[i],f[j]+sqr(i-j-1+(sum[i]-sum[j])-l));\n\tprintf(\"%LLd\",f[n]);\n\treturn 0;\n}\n```\n\u53ef\u4ee5\u6210\u529f\u5730\u83b7\u5f9720\u5206\n\n---\n\u63a5\u4e0b\u6765\u4f18\u5316\u7684\u65f6\u95f4\u5c31\u5230\u4e86\n\n\u9996\u5148\uff0c\u6211\u4eec\u4ece\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u5165\u624b\uff1a\n```cpp\nf[i]=min(f[i],f[j]+sqr(i-j-1+(sum[i]-sum[j])-l));\n```\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u8bb0$s[i]=sum[i]+i$\uff0c$L=L+1$\u53ef\u4ee5\u7b80\u5316\u65b9\u7a0b\n\n\u5219\u6709\uff1a\n```cpp\nf[i]=min(f[i],f[j]+sqr(s[i]-s[j]-l));\n```\n\u7136\u540e\u6211\u4eec\u5f00\u59cb\u6570\u5f62\u7ed3\u5408\n\n\uff08PS.:\u672c\u6765\u8fd9\u540e\u9762\u6709\u4e00\u6bb5\u4e24\u5343\u591a\u5b57\u6253\u4e86\u6211\u6574\u6574\u4e00\u5929\u7684\u63a8\u5bfc\uff0c\u6700\u540e\u53d1\u73b0\u6839\u672c\\*\\*\u4e0d\u901a\u2014\u2014\u8bf7\u539f\u8c05\u6211\u56e0\u4e3a\u5b9e\u5728\u662f\u592a\u751f\u6c14\u4e86\uff09\uff08**\u6570\u5f62\u7ed3\u5408\u4e07\u5c81\uff01**\uff09\n\n\u7b80\u5355\u5730\u8bb2\uff0c\u73b0\u5728\u4f18\u5316\u7684\u76ee\u7684\u5c31\u662f\u5c3d\u5feb\u5730\u627e\u5230\u8fd9\u4e2a\u4f7f$f_i$\u6700\u5c0f\u5316\u7684$j$\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u8bbe$j$\u5c31\u662f\u4ee4$f_i$\u6700\u5c0f\u5316\u7684\u7ee7\u627f\u72b6\u6001\n\n$f_i=f_j+(s_i-s_j-L)^2$\n\n\u5c06\u8fd9\u4e2a\u65b9\u7a0b\u5c55\u5f00\uff0c\u5e76\u5c06\u5176\u8f6c\u5316\u4e3a$y=kx+b$\u7684\u5f62\u5f0f\n\n\u5176\u4e2d\uff0c$y$\u4e0e$x$\u8981\u5305\u542b\u6240\u6709\u4e0e$j$\u6709\u5173\u7684\u9879\uff0c\u4e14$x$\u8981\u4fdd\u8bc1\u968f$j$\u5355\u8c03\u9012\u589e\uff08\u65b9\u4fbf\u6784\u5efa\u6a21\u578b\uff09\uff0c$k,b$\u662f\u4e0e$j$\u65e0\u5173\u7684\u503c\uff0c$b$\u8981\u5305\u542b$f_i$\n\n\u539f\u5f0f$=f_i=f_j+{s_i}^2-2s_i(s_j+L)+(s_j+L)^2$\n\n$f_i-{s_i}^2=f_j-2s_i(s_j+L)+(s_j+L)^2$\n\n$f_i-{s_i}^2+2s_i(s_j+L)=f_j+(s_j+L)^2$\n\n$\u5373f_j+(s_j+L)^2=2s_i(s_j+L)+f_i-{s_i}^2$\n\n\u5176\u4e2d\uff1a\n\n$y=f_j+(s_j+L)^2$\n\n$k=2s_i$\n\n$x=s_j+L$\n\n\uff08\u7531$2s_i(s_j+L)$\u62c6\u6210\uff09\n\n$b=f_i-{s_i}^2$\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u5bf9\u4e8e$j$\u7684\u5750\u6807\u63cf\u8ff0\uff1a\n\n$(s_j+L,f_j+(s_j+L)^2)$\n\n\u4e0d\u903c\u903c\u4e0a\u56fe\n![](https://img-blog.csdnimg.cn/20190701195330136.png)\n\u5c31\u662f\u8fd9\u6837\uff0c\u6211\u4eec\u8981\u627e\u5230\u4e00\u4e2a\u70b9\u628a\u90a3\u6761\u7ebf\u6302\u4e0a\u53bb\n\n\u7ebf\u7684\u659c\u7387\u4e0d\u53d8\uff0c\u53c8\u9700\u8981\u6302\u5728\u6700\u4f4e\u7684\u5730\u65b9\n\n\u70b9\u4ece\u5de6\u5230\u53f3\u4f9d\u6b21\u52a0\u5165\n\n\u89c2\u5bdf\u4e00\u4e0b\uff0c\u9664\u4e86\u56fe\u4e2d\u7684\u90a3\u51e0\u4e2a\u6298\u7ebf\u4e0a\u7684\u70b9\uff0c\u5176\u5b83\u70b9\u60f3\u90fd\u4e0d\u7528\u60f3\u5c31\u53ef\u4ee5\u6dd8\u6c70\uff1a\n\n![](https://img-blog.csdnimg.cn/20190701195640154.png)\n\u56e0\u4e3a\u5b83\u4eec\u88ab\u6321\u4f4f\u4e86\u3002\n\n\u800c\u518d\u89c2\u5bdf\u8fd9\u6761\u6298\u7ebf\uff0c\u4e0a\u9762\u4efb\u610f\u7684\u4e09\u4e2a\u70b9$A,B,C$\u82e5\u6ee1\u8db3$x_A<x_B<x_C$\uff0c\u5c31\u6709$AB$\u7684\u659c\u7387\u5c0f\u4e8e$BC$\u7684\u659c\u7387\u3002\uff08\u8bb0\u4efb\u610f\u4e24\u70b9$B,C$\u7684\u659c\u7387\u4e3a$\\operatorname{slop}(B,C)$\uff09\n\n\u7ed3\u5408\u70b9\u7684\u52a0\u5165\u65b9\u5f0f\u548c\u6700\u4f18\u5316\u7684\u9700\u6c42\uff0c\u8003\u8651$O(1)$\u67e5\u8be2\u6700\u503c+\u672b\u7aef\u63d2\u5165\u7684\u5355\u8c03\u961f\u5217\n\n\uff08\u8bb0\u5355\u8c03\u961f\u5217\u4e3a$q$\uff0c\u961f\u5c3e\u4e0b\u6807\u4e3a$tail$\uff0c\u961f\u5934\u4e0b\u6807\u4e3a$head$\uff0c\u65b0\u52a0\u5165\u7684\u70b9\u4e3a$i$\uff09\n\n\u63a8\u51fa\u6dd8\u6c70\u961f\u5217\u672b\u5c3e\u7684\u6807\u51c6\uff1a\n\n**\u5f53$\\operatorname{slop}(q_{tail-1},q_{tail})\\ge\\operatorname{slop}(q_{tail},i)$\u65f6\uff0c\u5254\u9664$q_{tail}$**\n\n\u800c\u53c8\u4ece\u5355\u8c03\u961f\u5217\u5f15\u51fa\u4e00\u4e2a\u95ee\u9898\uff1a\u5982\u4f55\u5220\u961f\u5934\uff1f\n\n\u8fd9\u7b80\u5355\uff1a~~\u7531\u56fe\u53ef\u77e5~~**\u659c\u7387\u5c0f\u4e8e$k$\u7684\u5c31\u5220\u6389**~~\u8bc1\u660e\u5f88\u7b80\u5355\u4f46\u6211\u5f88\u61d2~~\n\n\u5982\u679c\u4ee5\u540e\u7684\u76f4\u7ebf\u659c\u7387\u6bd4\u73b0\u5728\u5c0f\u4e86\u600e\u4e48\u529e\uff1f\n\n$k=2s_i$\u2014\u2014$s_i$\u662f\u548c$i$\u4e00\u8d77\u9012\u589e\u7684\u3002\n\n\u7531\u6b64\uff0c\u5355\u8c03\u961f\u5217\u6240\u6709\u64cd\u4f5c\u5168\u90e8\u63a8\u51fa\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#define ll long long\nusing namespace std;\nint l;\nstruct deque\n{\n\tint list[51000];\n\tint head,tail;//head~tail\n\t\n\tdeque():head(1),tail(0){}\n\tint size(){return tail-head+1;}\n\t\n\tint front(){return list[head];}\n\tvoid push_front(int x){list[--head]=x;}\n\tvoid pop_front(){++head;}\n\tint front_2nd(){return list[head+1];}\n\t\n\tint back(){return list[tail];}\n\tvoid push_back(int x){list[++tail]=x;}\n\tvoid pop_back(){--tail;}\n\tint back_2nd(){return list[tail-1];}\n};//\u624b\u6253deque\nll sqr(ll x)\n{return x*x;}\nint a[51000];\nll s[51000];\nll f[51000];\ndouble slop(ll a,ll b)\n{return (f[b]+sqr(s[b]+l)-f[a]-sqr(s[a]+l))/(double)(s[b]-s[a]);}\nint main()\n{\n\tint n;\n\tscanf(\"%d%d\",&n,&l);l++;\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%d\",a+i),s[i]=s[i-1]+a[i]+1;\n\tdeque q;\n\tq.push(0);//\u5f88\u91cd\u8981\uff01\uff01\uff01\u8981\u521d\u59cb\u5316\uff01\uff01\uff01\n\tf[0]=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(q.size()>1&&slop(q.front(),q.front_2nd())<=2*s[i])q.pop_front();\n\t\tf[i]=f[q.front()]+sqr(s[i]-s[q.front()]-l);\n\t\twhile(q.size()>1&&slop(q.back_2nd(),q.back())>=slop(q.back(),i))q.pop_back();\n\t\tq.push_back(i);\n\t}\n\tprintf(\"%lld\",f[n]);\n\treturn 0;\n}\n```\n\n\u53c2\u8003\u8d44\u6599\uff1a[LB\u4e0d\u9876\u7528](http://www.360doc.com/content/19/0120/11/5315_810145904.shtml)",
        "postTime": 1562390075,
        "uid": 97504,
        "name": "MZW_BG",
        "ccfLevel": 4,
        "title": "\u6d1b\u8c37P3195 [HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY"
    },
    {
        "content": "## \u601d\u8def\n\u7406\u89e3\u9898\u610f\u4e4b\u540e\uff0c\u53d1\u73b0\n\n## \u659c\u7387\u4f18\u5316\u771f\u662f\u4e00\u4e2a\u5927\u5751\n$F_i$\u4e3a\u6700\u8fd1\u4e00\u4e2a\u7bb1\u5b50\u88c5\u5230\u7b2c$i$\u4ef6\u7269\u54c1\u7684\u82b1\u8d39\n\n\u9996\u5148\u6211\u4eec\u6765\u770b\u770b\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n($sum$\u4e3a\u524d\u7f00\u548c)\n\n$$F_i=\\min(F_i,F_j+(sum_i-sum_j+(i-(j+1))-L)^2)$$\n\n$$=\\min(F_i,F_j+((sum_i+i)-(sum_j+j)-(L+1))^2)$$\n\n\u8bbe$s_i=sum_i+i,s_j=sum_j+j,L=L+1$\uff0c\n\n\u5219\n$$F_i=\\operatorname{min}(F_i,F_j+(s_i-s_j-L)^2)$$\n\n\u8bbe\u6709\n$F_j+(s_i-s_j-L)^2\\ge F_k+(s_i-s_k-L)^2(j<k<i)$\n\n\u8bf4\u660e\u5728$i$\u65f6\uff0c$k$\u4f18\u4e8e$j$\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u540e\u9762\u72b6\u6001$t$\u5462\uff0c\u662f\u5426\u6709$F_j+(s_t-s_j-L)^2\\ge F_k+(s_t-s_k-L)^2$\n\n\u8bc1\u660e:\n\n\u663e\u800c\u6613\u89c1\u7684\uff0c$s_t=s_i+val(val>0)$\uff0c\u5219\n\n$$F_j+(s_t-s_j-L)^2=F_j+(s_i-s_j-L+val)^2$$\n\u2461\n\n$$ F_k+(s_t-s_k-L)^2=F_k+(s_i-s_j-\tL+val)^2 $$\n\u2462\n\n\u7531$\u2461$\u5f97:\n\n$$F_j+(s_i-s_j-L)^2+2*val*(s_i-s_j-L)+val^2$$\n\n\u7531$\u2462$\u5f97\n\n$$F_k+(s_i-s_j-L)^2+2*val*(s_i-s_k-L)+val^2$$\n\n\u6bd4\u8f83\u4e0a\u8ff0\u4e8c\u5f0f\uff0c\u5e76\u7ed3\u5408$\u2460$,\u53ef\u77e5\n\n\u53ea\u8981\u8bc1\u660e$s_i-s_j-L>s_i-s_k-L$\u5373\u53ef\n\n$-s_j>-s_k$\n\n\u7531\u4e8e$s_j<s_k$\uff0c\u5219\u4e0d\u7b49\u5f0f\u6210\u7acb\u3002\n\n\u6240\u4ee5\u5728$i$\u65f6\uff0c$k$\u4f18\u4e8e$j$\uff0c\u90a3\u4e48\u5728\u540e\u9762\u72b6\u6001\u65f6\uff0c$k$\u6c38\u8fdc\u4f18\u4e8e$j$\u3002\n\n## \u5982\u4f55\u6dd8\u6c70$j$(\u961f\u5934)\n\n$$F_j+(s_i-s_j-L)^2\\ge F_k+(s_i-s_k-L)^2 $$\n$$F_j+(s_i-L)^2-2*s_j*(s_i-L)+s_{j}^{2}\\ge F_k+(s_i-L)^2-2*s_k*(s_i-L)+s_{k}^{2}$$\n$$ F_j-F_k+s_j^2-s_k^2\\ge 2*(s_j-s_k)*(s_i-L)$$\n\n\u7531$s_k>s_j$\u53ef\u77e5\uff0c\n\n$$\\frac{F_j-F_k+s_j^2-s_k^2}{s_j-s_k}\\le 2*(s_i-L)$$\n\n\u8bbe$x_1=F_j+s_j^2,x_2=F_k+s^2_k,y_1=s_j,y_2=s_k$\n\n\u5219\n$$calc(j,k)=\\frac{x_1-x_2}{y_1-y_2}\\le2*(s_i-L)$$\n\n\u8fd9\u53e5\u8bdd\u7684\u610f\u601d\u5c31\u662f$k$\u6bd4$j$\u66f4\u4f18\uff0c\u6240\u4ee5$j$(\u5148\u8fdb\u961f\u5217)\u5c31\u6ca1\u6709\u5b58\u5728\u7684\u5fc5\u8981\uff0c\u8981\u8e22\u53bb\u3002\n\n## \u8e22\u961f\u5c3e\n\n\u6211\u4eec\u9996\u5148\u4e00\u5b9a\u8981\u786e\u5b9a$i$\u8fd9\u4e2a\u72b6\u6001\uff0c\u8981\u4f18\u4e8e$q_{tail}$\n\n\u8981\u7ef4\u62a4\u7684\u961f\u5217\u7531\u4e8e$q_{tail-1}$\u4e00\u5b9a\u4f18\u4e8e$q_{tail}$\n\n\u73b0\u6709\u4e00\u4e2a\u6807\u51c6\u503c$2*(s_t-L)(tail<t)$\n\n$calc(q_{tail-1},q_{tail)}\\ge 2*(s_t-L)$\n\n\u5982\u679c$q_{tail}$\u8981\u4f18\u4e8e$i$\uff0c\n\n\u5219$calc(q_{tail},i)\\ge calc(q_{tail-1},q_{tail})$\n\n\u624d\u80fd\u786e\u4fdd$q_{tail}$\u4f18\u4e8e$i$\n\n\u53cd\u4e4b\uff0c\u5f53$calc(q_{tail},i)\\le calc(q_{tail-1},q_{tail})$\u65f6\uff0c\u9700\u8981\u5220\u53bb\u961f\u5c3e\u3002\n\n\u8c8c\u4f3c\u5c31\u6ca1\u4e86\u54e6\u3002\n\n\n## \u6700\u540e\u51e0\u53e5\u8bdd\n\u672c\u9898\u7ef4\u62a4\u7684\u662f\u4e00\u4e2a\u4e0b\u51f8\u58f3(\u6211\u7684\u505a\u6cd5\u662f\u8fd9\u6837\u7684)\uff0c\u6240\u4ee5\u659c\u7387\u4f18\u5316\u771f\u662f\u4e00\u4e2a\u795e\u5947\u7684\u4e1c\u897f\u3002\n\n## AC code\n```cpp\n#pragma GCC optimize(\"Ofast\")\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<iostream>\n#define gc getchar()\n#define ll long long\nusing namespace std;\nconst int N=5e4+10;\ninline void qr(ll &x)\n{\n\tx=0;int f=1;char c=gc;\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=gc;}\n\twhile(c>='0'&&c<='9'){x=x*10+(c^48);c=gc;}\n\tx*=f;\n}\nvoid qw(ll x)\n{\n\tif(x<0)x=-x,putchar('-');\n\tif(x/10)qw(x/10);\n\tputchar(x%10+48);\n}\nll s[N],f[N];\nint q[N],l,r;\ndouble calc(int j,int k)\n{\n\treturn (f[j]-f[k]+s[j]*s[j]-s[k]*s[k])/(double)(s[j]-s[k]);\n}\nint n,L;\nint main()\n{\n\tscanf(\"%d%d\",&n,&L);++L;\n\tfor(int i=1;i<=n;i++)qr(s[i]),s[i]+=s[i-1]+1;\n\tl=1;r=1;q[1]=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(l<r&&calc(q[l],q[l+1])<=2.0*(s[i]-L))++l;\n\t\tf[i]=f[q[l]]+(s[i]-s[q[l]]-L)*(s[i]-s[q[l]]-L);\n\t\twhile(l<r&&calc(q[r],i)<=calc(q[r-1],q[r]))--r;\n\t\tq[++r]=i;\n\t}\n\tqw(f[n]);puts(\"\");\n\treturn 0;\n}\n```",
        "postTime": 1561895670,
        "uid": 106232,
        "name": "_Sein",
        "ccfLevel": 0,
        "title": "[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY"
    },
    {
        "content": "# [problem](https://www.luogu.org/problemnew/show/P3195)\n___\n___\n## Solution\n### 20'DP:\n\n$dp[i] = min(dp[j] + (sum[i] - sum[j - 1] + i - j - L)^2)$\n\ncode:\n\n```cpp\n#include<bits/stdc++.h>\n#define N 500005\n#define int long long\nusing namespace std;\nint sqr(int x){\n\treturn x * x;\n}\nint n, L, a[N], sum[N], f[N];\nsigned main(){\n\tscanf(\"%lld%lld\", &n, &L);\n\tfor(int i = 1; i <= n; i ++) scanf(\"%lld\", &a[i]), sum[i] = a[i] + sum[i - 1];\n\tmemset(f, 0x3f, sizeof f);\n\tf[0] = 0;\n\tfor(int i = 1; i <= n; i ++){\n\t\tfor(int j = 1; j <= i; j ++){\n\t\t\tf[i] = min(f[i], f[j - 1] + sqr(sum[i] - sum[j - 1] + i - j - L));\n\t\t}\n\t}\n\tprintf(\"%lld\", f[n]);\n\treturn 0;\n}\n\n```\n\n\n## \u659c\u7387\u4f18\u5316\n\u53ef\u4ee5\u53d8\u6210\n$dp[i] = min(dp[j] + (sum[i] - sum[j] + i - j - L - 1)^2)$\n\n\u4ee4 $a[i] = sum[i] + i, b[i]=sum[i]+i+L+1$\n\n$dp[i] = min(dp[j] + (a[i]-b[j])^2)$\n\n$dp[i] = dp[j] + a[i]^2+b[j]^2-2\u00b7a[i]\u00b7b[j]$\n\n$2\u00b7a[i]\u00b7b[j] + dp[i] -a[i]^2= dp[j]+b[j]^2$\n\n\u628a$b[j]$\u770b\u505a$x$\uff0c$dp[j]+b[j]^2$\u770b\u505a$y$\n\n$y=2\u00b7a[i]x+dp[i]-a[i]^2$\n\n\u8fd9\u5c31\u662f\u4e00\u6761\u76f4\u7ebf\u7684\u89e3\u6790\u5f0f\uff0c$y=kx+b, k=2\u00b7a[i],b=dp[i]-a[i]^2$\n\n\u8981\u627e\u4e00\u4e2a\u70b9$P(b[j],dp[j]+b[j]^2)$\u4f7f\u5f97\u4e0a\u9762\u7684\u659c\u7387\u4e3a2*a[i]\u7684\u76f4\u7ebf\u8fc7\u8fd9\u4e2a\u70b9\u4e14\u4e0e$y$\u8f74\u622a\u8ddd$(b=dp[i]-a[i]^2)$\u6700\u5c0f\n\n\u56e0\u4e3a\u659c\u7387$k=2\u00b7a[i]$\u662f\u56fa\u5b9a\u7684\uff0c\u6240\u4ee5\u8981\u6c42\u7684\u5c31\u662f\u6700\u5c0f\u7684$b$,\u628a\u5b83\u52a0\u4e0a$a[i]^2$\u5c31\u662f$dp[i]$\u7684\u503c\n___\n### \u5927\u6982\u5c31\u662f\u8fd9\u6837\n\n![233](https://i.loli.net/2019/06/06/5cf8a82eed5f943608.png)\n\n\u5c31\u53d8\u6210\u4e86\u7528\u4e00\u6761\u659c\u7387\u4e3a$k=2\u00b7a[i]$\u7684\u76f4\u7ebf\u4ece\u4e0b\u5230\u4e0a\uff08\u6216\u4ece\u53f3\u5230\u5de6\uff09\u626b\u8fc7\u53bb\uff0c\u78b0\u5230\u7684\u7b2c\u4e00\u4e2a\u70b9\u540e\u628a\u76f4\u7ebf\u548c$y$\u8f74\u7684\u622a\u8ddd\u6c42\u51fa\u6765\u52a0\u4e0a$a[i]$\u5c31\u662f\u7b54\u6848\n\n\u5f88\u660e\u663e\u5c31\u662f\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u58f3(1/4)\n\n___\n\n\n\n\u7136\u540e\u5c31\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u561b\u3002\u3002\n\n\u8bbe$Slope(i,j)$\u4e3a    $P_i, P_j$ \u7684\u659c\u7387\n\n\u5982\u679c$Slope(Q_{head}, Q_{head + 1}) <=2\u00b7a[i]$\u5c31 $head ++$\n\n\n$Slope(Q_{tail}, Q_{tail - 1}) >= Slope(Q_{tail - 1}, i)$\u5c31 $tail --$\n\n\n\ncode:\n```cpp\n#include<bits/stdc++.h>\n#define N 1000005\n#define int long long//hei hei\n#define double long double //\u5f00long double \u9632\u6b62\u7cbe\u5ea6\u4e22\u5931\nusing namespace std;\nint q[N], n, L, sum[N], dp[N];\ndouble a(int i) {return sum[i] + i;}\ndouble b(int i) {return sum[i] + i + L + 1;}\ndouble x(int i) {return b(i);}\ndouble y(int i) {return dp[i] + b(i) * b(i);}\ndouble Slope(int i, int j) {return (y(i) - y(j)) / (x(i) - x(j));}\nsigned main(){\n\tscanf(\"%lld%lld\", &n, &L);\n\tfor(int i = 1; i <= n; i ++) scanf(\"%lld\", &sum[i]), sum[i] += sum[i - 1];\n\tint l = 1, r = 1;\n\tfor(int i = 1; i <= n; i ++){\n\t\twhile(l < r && Slope(q[l], q[l + 1]) < 2 * a(i)) l ++;\n\t\tint j = q[l]; \n\t\tdp[i] = dp[j] + (a(i) - b(j)) * (a(i) - b(j));//\u622a\u8ddd\u5c31\u662f\u628ax=2*b[j]\u4ee3\u5165\u659c\u7387\u4e3a2*a[i]\u7684\u76f4\u7ebf\uff0c\u89e3\u9664b\uff0c\u52a0\u4e0aa[i]\u5c31\u662fdp[i],\u5316\u7b80\u5b8c\u5c31\u662f\u8fd9\u6837\n\t\twhile(l < r && Slope(q[r - 1], q[r]) > Slope(i, q[r - 1])) r --;\n\t\tq[++ r] = i;\n\t}\n\tprintf(\"%lld\", dp[n]);\n\treturn 0;\n}\n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        "postTime": 1559798198,
        "uid": 31656,
        "name": "lomit",
        "ccfLevel": 8,
        "title": "[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY"
    },
    {
        "content": "###### 1.\u5217\u65b9\u7a0b\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6211\u4eec\u5148\u60f3\u8fd9\u9053\u9898\u7684dp\u5f0f\u5b50\uff0c\u5148\u4e0d\u7ba1\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u95ee\u9898\u3002\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8fd9\u4e2a\u5f0f\u5b50\u5e94\u8be5\u5f88\u597d\u60f3\uff1a$ f[i]=min \\{ f[j]+( \\sum_{k=j+1}^{i} lenth[k] +i\u2212j\u2212l)^{2} \\}$\uff0c\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$ O(n^3) $\u3002   \n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u60f3\u4e00\u4e0b\u4f18\u5316\uff0c\u6211\u4eec\u662f\u4e0d\u662f\u53ef\u4ee5\u5c06\u6c42\u548c\u90e8\u5206\u5199\u6210\u524d\u7f00\u548c\u7684\u5f62\u5f0f\uff1f\u5c06$ \\sum $\u7684\u90e8\u5206\u5316\u6210$ sum[i] $\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u5f0f\u5b50\u8f6c\u5316\u6210$ f[i]=min \\{ f[j]+( sum[i] -sum[j] +i\u2212j\u2212l)^{2} \\} $\uff0c\u8fd9\u6837\u7684\u8bdd\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u964d\u4f4e\u6210\u4e3a$ O(n^2) $\u3002\u65f6\u95f4\u662f\u66f4\u4f4e\u4e86\uff0c\u4f46\u662f\u8fd8\u662f\u8fc7\u4e0d\u4e86\u554a\uff0c\u8fd9\u662f\u6211\u4eec\u5c31\u8981\u7b49\u4ef7\u5730\u53d8\u6362\u5f0f\u5b50\uff0c\u4f7f\u5176\u6210\u4e3ay=kx+b\u7684\u5f62\u5f0f\uff0c\u8fd9\u4e2a\u5f62\u5f0f\u5c31\u662f\u659c\u7387\u4f18\u5316\u7684\u6838\u5fc3\u3002\n\n###### 2.\u8f6c\u5316\u5f0f\u5b50\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ f[i]=min \\{ f[j]+( sum[i] -sum[j] +i\u2212j\u2212l)^{2} \\} \\downarrow$\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ f[i]= f[j] + [ ( sum[i] + i ) - ( sum[j] + j ) - l ]^2 \\downarrow $\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4ee4$ s[i]=sum[i]+i \\downarrow$\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ f[i]=f[j]+( s[i] -s[j] - l)^2 $\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ f[i] = f[j] + s[i]^2 + ( s[j] + l ) ^2 - 2\\times s[i] \\times ( s[j] + l) \\downarrow$\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ f[j] + s[i]^2 + ( s[j] + l )^2 = 2 \\times s[i] \\times ( s[j] +l ) + f[i] $\n\n###### 3.\u5206\u6790\u5f0f\u5b50\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$ f[j] + s[i]^2 + ( s[j] + l )^2 = 2 \\times s[i] \\times ( s[j] +l ) + f[i] $\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u89c2\u5bdf\u4e0a\u9762\u7684\u5f0f\u5b50\uff0c\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u5341\u5206\u50cf\u4e00\u79cd\u51fd\u6570\uff0cy=kx+b\uff0c\u53ef\u80fd\u5927\u5bb6\u4f1a\u6709\u7591\u95ee\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u548c\u76f4\u7ebf\u7684\u8868\u8fbe\u662f\u6709\u4ec0\u4e48\u5f62\u4f3c\u4e4b\u5904\u5462\uff1f\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6211\u4eec\u5c06$ f[j] + s[i]^2 + (s[j] + l)^2 $\u8fd9\u4e2a\u90e8\u5206\u770b\u505a\u4e00\u4e2a\u6574\u4f53\u8bb0\u4e3a$ y $\uff0c\u8fd9\u4e2a\u90e8\u5206\u53ef\u4ee5\u770b\u6210\u4e00\u4e2a\u6574\u4f53\u7684\u6761\u4ef6\u662f\uff1a\u8fd9\u4e2a\u6574\u4f53\u4e2d\u7684\u6240\u6709\u90e8\u5206\u90fd\u662f\u5df2\u6c42\u51fa\u7684\uff0c\u5e76\u4e14\u5f53\u77e5\u9053$ i $\u548c$ j $\u4e4b\u540e\u53ef\u4ee5$ O(1) $\u6c42\u51fa\u3002\u663e\u7136\u8fd9\u4e2a\u6574\u4f53\u6ee1\u8db3\u3002\u540c\u7406\u6211\u4eec\u5c06$ 2 \\times s[i] $\u548c$ (s[i] + l) $\u8fd9\u4e24\u4e2a\u90e8\u5206\u4e5f\u5206\u522b\u770b\u505a\u6574\u4f53\uff0c\u5e76\u5206\u522b\u8bb0\u4e3a$ k $\u3001$ x $\u3002\u8fd9\u6837\u5f0f\u5b50\u5c31\u5316\u4e3a$ y=kx+f[i] $\u3002\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e0b\u4e00\u6b65\uff0c\u6211\u4eec\u5efa\u7acb\u4ee5\u4e2a\u5e73\u9762\u76f4\u89d2\u5750\u6807\u7cfb\uff0c\u8fd9\u4e2a\u5e73\u9762\u76f4\u89d2\u5750\u6807\u7cfb\u4e2d\u7684\u6bcf\u4e00\u4e2a\u70b9\u7684\u5750\u6807$ \uff08x\uff0cy\uff09 \u200b$\u90fd\u5bf9\u5e94\u7684\u662f\u4e0a\u9762\u5f0f\u5b50\u4e2d\u7684$ x \u200b$\u548c$ y \u200b$\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u591f\u5c06\u6bcf\u4e00\u4e2a\u4e0e$ i \u200b$\u6709\u5173\u7684\u4e1c\u897f\u5904\u7406\u5b8c\u4e8b\u4e4b\u540e\u6807\u5230\u5e73\u9762\u76f4\u89d2\u5750\u6807\u7cfb\u4e4b\u4e2d\u3002\u6bcf\u4e00\u4e2a\u70b9\u7684\u5750\u6807\u8868\u6210$ ( s[i]\uff0cf[i] + \uff08s[i] + l\uff09^2 ) \u200b$\uff0c\u53ef\u80fd\u6709\u4eba\u4f1a\u95ee\u4e3a\u4ec0\u4e48\u7eb5\u5750\u6807\u6ca1\u6709\u4e86$ s[i]^2 \u200b$\uff0c\u5e76\u4e14\u6a2a\u5750\u6807\u6ca1\u6709\u4e86$ l \u200b$\uff0c\u8fd9\u4e2a\u95ee\u9898\u4e0b\u9762\u4f1a\u89e3\u7b54\uff0c\u8bf7\u7a0d\u4f5c\u7b49\u5f85\u3002\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5982\u679c\u6211\u4eec\u60f3\u7528$ j $\u6765\u8f6c\u79fb$ i $\u7684\u8bdd\uff0c\u5c31\u8981\u8ba9\u659c\u7387\u4e3a$ 2 \\times s[i] $\u7684\u76f4\u7ebf\u8fc7\u70b9$ (s[j]\uff0cf[j] + \uff08s[j] + l\uff09^2) $\uff0c\u5e76\u4e14\u6b64\u65f6\u76f4\u7ebf\u7684\u622a\u8ddd\u5c31\u662f\u65b0\u7684$ f[i] $\uff0c\u56e0\u4e3a$ f[i] $\u4e3a\u8fd9\u6761\u76f4\u7ebf\u7684$ b $\u3002\u518d\u770b\u4e0b\u9762\u7684\u56fe\u89e3\uff0c\u6211\u4eec\u5c06\u6c42\u8fc7\u7684\u70b9\u90fd\u6807\u5230\u5e73\u9762\u76f4\u89d2\u5750\u6807\u7cfb\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u6211\u4eec\u60f3\u8fc7\u7684\u8fd9\u4e2a\u70b9\u4e00\u5b9a\u5728\u6211\u4eec\u7ef4\u62a4\u7684\u5927\u5706\u5305\u4e0a\uff0c\u50cf\u70b92\u8fd9\u6837\u7684\u70b9\u5c31\u4e0d\u80fd\u88ab\u7528\u6765\u66f4\u65b0\uff0c\u56e0\u4e3a\u8fc7\u70b93\u6240\u5f97\u622a\u8ddd\uff0c\u4e00\u5b9a\u6bd4\u8fc7\u70b92\u6240\u5f97\u622a\u8ddd\u5c0f\uff0c\u90a3\u4e48\u6211\u4eec\u80fd\u53d1\u73b0\u5f53\u70b93\u6c42\u51fa\u4e4b\u540e\uff0c\u53ea\u8981\u6bd4\u8f83\u4e00\u4e0b\uff0c\u70b92\u548c\u70b93\u5f62\u6210\u7684\u76f4\u7ebf\u7684\u659c\u7387\u548c\u70b91\u548c\u70b92\u5f62\u6210\u7684\u76f4\u7ebf\u7684\u659c\u7387\uff0c\u5982\u679c2\u30013\u5f62\u6210\u7684\u6bd41\u30012\u5f62\u6210\u7684\u8981\u5c0f\uff0c\u90a3\u4e483\u53f7\u70b9\u4e00\u5b9a\u6bd42\u53f7\u70b9\u66f4\u4f18\u3002\u6211\u4eec\u518d\u770b\uff0c\u5047\u8bbe\u4e0b\u56fe\u4e4b\u4e2d\u5df2\u7ecf\u7ef4\u62a4\u597d1\u52305\u7684\u6240\u6709\u70b9\uff0c\u90a3\u4e48\u5c31\u4f1a\u51fa\u73b0\u8fd9\u6837\u7684\u5927\u5706\u5305\u3002\u6211\u4eec\u7528\u6c42\u51fa6\u7684\u70b9\u7684\u76f4\u7ebf\u53bb\u548c\u8fd9\u4e9b\u70b9\u76f8\u4ea4\uff0c\u6211\u4eec\u53d1\u73b0\u53ea\u6709\u70b94\u5728\u5f53\u524d\u76f4\u7ebf\u4e0a\u65f6\u80fd\u4f7f\u622a\u8ddd\u6700\u5c0f\uff08\u753b\u4e00\u753b\u56fe\u5c31\u80fd\u53d1\u73b0\u662f\u8fc7\u70b94\u65f6\uff0c\u76f4\u7ebf\u7684\u622a\u8ddd\u6700\u5c0f\uff09\uff0c\u6839\u636e\u662f\u7531\u70b94\u8f6c\u79fb\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5f53\u4e24\u4e2a\u70b91\u30013\u7684\u659c\u7387\u5c0f\u4e8e$ 2 \\times s[i] $\u7684\u65f6\u5019\uff0c\u6a2a\u5750\u6807\u5c0f\u7684\u70b9\u4e00\u5b9a\u4e0d\u80fd\u7528\u6765\u8f6c\u79fb\uff0c\u540c\u7406\u659c\u7387\u5927\u4e8e$ 2 \\times s[i] $\u7684\u4e24\u4e2a\u70b9\uff0c\u6a2a\u5750\u6807\u5927\u7684\u4e5f\u4e0d\u80fd\u591f\u7528\u6765\u8f6c\u79fb\uff0c\u8fd9\u4e2a\u6027\u8d28\u662f\u4e0d\u662f\u5f88\u597d\uff1f\n\n![](https://images2018.cnblogs.com/blog/1257114/201809/1257114-20180911205634537-676700193.png)\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6839\u636e\u4e0a\u9762\u6211\u4eec\u53d1\u73b0\u7684\u5f0f\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u5355\u8c03\u961f\u5217\u7684\u961f\u5217\u6765\u7ef4\u62a4\u6211\u4eec\u7684\u5927\u5706\u5305\u3002\u4f46\u662f\u8fd9\u4e2a\u5927\u5706\u5305\u5177\u4f53\u600e\u4e48\u7ef4\u62a4\u5462\uff1f\u6211\u4eec\u5148\u770b\u5982\u4f55\u6c42\u659c\u7387\u3002\u5982\u679c\u7ed9\u4f60\u76f4\u7ebf\u4e0a\u7684\u4e24\u4e2a\u70b9\uff0c\u6211\u60f3\u5927\u5bb6\u4e00\u5b9a\u4f1a\u6c42\u659c\u7387\u3002\u5c31\u662f\u4e24\u70b9\u7684\u7eb5\u5750\u6807\u76f8\u51cf\u7684\u5dee\u9664\u4e0a\u4e24\u70b9\u7684\u6a2a\u5750\u6807\u76f8\u51cf\u7684\u5dee\u3002\u8fd9\u91cc\u4e5f\u5c31\u89e3\u91ca\u4e86\uff0c\u4e3a\u4ec0\u4e48\u4e0a\u6587\u4e2d\u7684\u7eb5\u5750\u6807\u6ca1\u6709\u4e86$ s[i]^2 $\uff0c\u56e0\u4e3a\u4e24\u5f0f\u76f8\u51cf\u65f6$ s[i] $\u662f\u76f8\u540c\u7684\uff0c\u4ece\u800c$ s[i]^2 $\u4e5f\u5c31\u662f\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u76f8\u51cf\u65f6\u5c31\u5c06\u5176\u51cf\u6389\u4e86\uff0c\u56e0\u6b64$ s[i]^2 $\u4e0d\u7528\u51fa\u73b0\u5728\u7eb5\u5750\u6807\u4e4b\u4e2d\u3002\u540c\u7406\u5728\u76f8\u51cf\u65f6\u6211\u4eec\u7684\u6a2a\u5750\u6807\u4e5f\u4e0d\u9700\u8981$ l $\u3002\n\n```c++\ndouble re_x(int i){return s[i];}\ndouble re_y(int i){return f[i]+(s[i]+l)*(s[i]+l);}\ndouble re_k(int i,int j){return (re_y(j)-re_y(i))/(re_x(j)-re_x(i));}\n```\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4f1a\u6c42\u659c\u7387\u4e86\uff0c\u6211\u4eec\u518d\u6765\u770b\u600e\u4e48\u7ef4\u62a4\u5927\u5706\u5305\uff0c\u6211\u4eec\u53d1\u73b0\u5f53\u961f\u5217\u4e2d\u6700\u540e\u4e00\u4e2a\u7684\u70b9\u548c\u961f\u5217\u4e2d\u5012\u6570\u7b2c\u4e8c\u4e2a\u70b9\u7684\u4ea7\u751f\u659c\u7387\u5927\u4e8e\u6700\u540e\u4e00\u4e2a\u70b9\u548c\u65b0\u4ea7\u751f\u7684\u70b9\u4ea7\u751f\u7684\u659c\u7387\uff0c\u90a3\u4e48\u7ed3\u5c3e\u5c31\u8981\u5f39\u51fa\u961f\u5217\uff0c\u8fd9\u4e2a\u7528\u4e00\u4e2a$ whlie $\u5faa\u73af\u5c31\u80fd\u591f\u89e3\u51b3\uff0c\u6700\u540e\u518d\u5c06\u65b0\u4ea7\u751f\u7684\u70b9\u653e\u5728\u7ed3\u5c3e\u3002\u8fd9\u4e2a\u5b9e\u73b0\u5341\u5206\u50cf\u5355\u8c03\u961f\u5217\u7684\u5b9e\u73b0\u3002\n\n```C++\nint main()\n{\n    while(head<tail&&re_k(q[tail],i)<re_k(q[tail],q[tail-1])) tail--;\n    q[++tail]=i;\n}\n```\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6211\u4eec\u518d\u770b\uff0c\u600e\u4e48\u6ee1\u8db3\u7b2c\u4e8c\u4e2a\u6027\u8d28\uff0c\u8ba9\u66f4\u65b0\u53d8\u6210$ O(1) $\u7684\uff1f\u6211\u4eec\u53d1\u73b0\u5f53\u961f\u5217\u4e2d\u7b2c\u4e00\u4e2a\u70b9\u548c\u7b2c\u4e8c\u4e2a\u70b9\u4ea7\u751f\u7684\u659c\u7387\u5982\u679c\u5c0f\u4e8e\u5f53\u524d\u7684\u76f4\u7ebf\uff0c\u90a3\u4e48\u7b2c\u4e8c\u4e2a\u70b9\u66f4\u65b0\u4e00\u5b9a\u6bd4\u7b2c\u4e00\u4e2a\u70b9\u66f4\u65b0\u66f4\u4f18\uff0c\u6211\u4eec\u5c31\u8981\u8fdb\u884c\u961f\u9996\u5f39\u51fa\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e5f\u5341\u5206\u50cf\u5355\u8c03\u961f\u5217\u7684\u7ef4\u62a4\u3002\u6700\u540e\u76f4\u63a5\u7528\u961f\u9996\u8fdb\u884c\u66f4\u65b0\u3002\n\n```c++\nint main()\n{\n    while(head<tail&&re_k(q[head],q[head+1])<2*s[i]) head++;\n    f[i]=f[q[head]]+(s[i]-s[q[head]]-l-1)*(s[i]-s[q[head]]-l-1);\n}\n```\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8fd9\u6837\u6211\u4eec\u5c31\u89e3\u51b3\u4e86\u7ef4\u62a4\u7684\u95ee\u9898\uff0c\u6700\u540e\u5c31\u662f\u5c06\u8fd9\u4e9b\u7ec4\u88c5\u5728\u4e00\u8d77\uff0c\u5f62\u6210\u4e0b\u65b9\u7684\u4ee3\u7801\u3002\n\n```C++\n#include <stdio.h>\n#define N 50001\nint n,l,head,tail;\nlong long f[N],s[N],q[N];\ndouble re_x(int i){return s[i];}\ndouble re_y(int i){return f[i]+(s[i]+l)*(s[i]+l);}\ndouble re_k(int i,int j){return (re_y(j)-re_y(i))/(re_x(j)-re_x(i));}\nint main()\n{\n    scanf(\"%d%d\",&n,&l);\n    for(int i=1;i<=n;i++)\n\t\tscanf(\"%lld\",&s[i]),s[i]+=s[i-1];\n    for(int i=1;i<=n;i++) s[i]+=i;\n    q[tail]=0;\n    for(int i=1;i<=n;i++)\n    {\n\t\twhile(head<tail&&re_k(q[head],q[head+1])<2*s[i]) head++;\n\t\tf[i]=f[q[head]]+(s[i]-s[q[head]]-l-1)*(s[i]-s[q[head]]-l-1);\n\t\twhile(head<tail&&re_k(q[tail],i)<re_k(q[tail],q[tail-1])) tail--;\n\t\tq[++tail]=i;\n    }\n    printf(\"%lld\\n\",f[n]);\n}\n```",
        "postTime": 1547000753,
        "uid": 52851,
        "name": "ysy20021208",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "### \u9898\u76ee\u5927\u610f\uff1a\n\n\u6709\u7f16\u53f7 _1~n_ \u7684 _n_ \u6837\u7269\u54c1\u3002\n\n\u7b2ci\u6837\u538b\u7f29\u6210\u4e00\u7ef4\u4ee5\u540e\u957f\u5ea6\u4e3a _c[i]_ \n\n\u628a\u7b2c _i~j_ \u53f7\u7269\u54c1\u653e\u5165\u5bb9\u5668\u957f\u5ea6\u4e3a _j-i+cigema(i<=k<=j) c[k]_ \n\n\u5462\u4e48\u82e5\u957f\u5ea6\u4e3ax\uff0c\u8d39\u7528\u4e3a\uff1a _(x-l)^2   L\u4e3a\u5e38\u91cf_ \n\n### \u89e3\u9898\u601d\u8def\uff1a\n\n####  _f[i]=min(0<=j<i){f[j]+(cigema(j+1<=k<=i) c[k]+i-j-1-L)^2}_\n\n\u4ee4_sum[i]_ \u4e3a_c_\u7684\u524d\u7f00\u548c;\n\n\u5219\uff0c\u4e0a\u5f0f=> _f[i]=min(0<=j<i{f[j]+(sum[i]-sum[j]+i-j-1-L)^2})_\n\n\u4ee4_a[i]=sum[i]+i_\n\n_f[i]=min(0<=j<i){f[j]+(a[i]-a[j]-1-L)^2}_\n\n\u66b4\u529bn^2;\u4f7f\u7528\u659c\u7387\u4f18\u5316\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<cstdio>\n#define N 50005\nusing namespace std;\nlong long n,L,f[N],sum[N],a[N],sqr[N],que[N];\ndouble calc(long long x,long long y){\n    return (double)(f[y]+sqr[y]-f[x]-sqr[x])/(a[y]-a[x]);\n}\nint main(){\n    scanf(\"%lld%lld\",&n,&L);\n    sqr[0]=(L+1)*(L+1);\n    for (long long i=1;i<=n;i++){\n        scanf(\"%lld\",&sum[i]);\n        sum[i]+=sum[i-1];\n        a[i]=sum[i]+i;\n        sqr[i]=(a[i]+L+1)*(a[i]+L+1);\n    }\n    long long l=0,r=0;\n    for (long long i=1;i<=n;i++){\n        while (l<r&&calc(que[l],que[l+1])<=(a[i]<<1)) l++;\n        f[i]=f[que[l]]+(a[i]-a[que[l]]-L-1)*(a[i]-a[que[l]]-L-1);\n        while (l<r&&calc(que[r],i)<calc(que[r-1],que[r])) r--;\n        que[++r]=i;\n    }\n    printf(\"%lld\\n\",f[n]);\n    return 0;\n}\n```",
        "postTime": 1534164315,
        "uid": 99722,
        "name": "\u4e8c\u54c8",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "**\u5982\u679c\u516c\u5f0f\u770b\u4e0d\u6e05\u5230CSDN\u4e0a\u770b\u628a\u3002\u3002\u3002**\n\n[CSDN\u7684\u94fe\u63a5](http://blog.csdn.net/qq\\_30974369/article/details/78306943)\n\n\u9996\u5148\u6211\u4eec\u5f88\u5bb9\u6613\u60f3\u5230DP\n\n\u8bbef[i]\u8868\u793a\u5f53\u524d\u9009\u62e9\u5230\u4e86\u7b2ci\u4e2a\u73a9\u5177\uff0c\u4e14\u7b2ci\u4e2a\u4f5c\u4e3a\u4e00\u4e2a\u5bb9\u5668\u7ed3\u675f\u7684\u4f4d\u7f6e\u7684\u6700\u5c0f\u4ee3\u4ef7\n\n\u7136\u540e\u5f88\u5bb9\u6613\u7684\u60f3\u5230\u4e86O(n^2)\u7684DP\n\n```cpp\n    for(int i=1;i<=n;++i)\n        for(int j=0;j<i;++j)\n            f[i]=min(f[i],f[j]+sqr(c[i]-c[j]+i-j-1-L));\n\n```\n\u5176\u4e2d\uff0cc\u4e3a\u524d\u7f00\u548c,sqr\u4e3a\u5e73\u65b9\n\n\n\u4f46\u662f\uff0c\u8fd9\u6837\u505a\u7684\u590d\u6742\u5ea6\u592a\u9ad8\uff0c\u663e\u7136\u4e0d\u80fd\u591fAC\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u4e0d\u59a8\u8bbef[i]\u4ecej\u8f6c\u79fb\u8fc7\u6765\uff0c\u5e76\u4e14\u8fd8\u6709\u4e00\u4e2a\u72b6\u6001k\n\n\u90a3\u4e48\u5c31\u6709\uff1a\n\n$$f[j]+(c[i]-c[j]+i-j-1-L)^{2}<f[k]+(c[i]-c[k]+i-k-1-L)^{2}$$\n\n$$\u4e0d\u59a8\u4ee4M=c[i]-i-1-L,T[j]=c[j]+j$$\n\n$$\u539f\u5f0f\u53ef\u4ee5\u7b80\u5199\u4e3af[j]+(M-T[j])^{2}<f[k]+(M-T[k])^{2}$$\n\n$$\u5de6\u8fb9=f[j]+M^{2}+T[j]^{2}-2MT[j]$$\n\n$$\u53f3\u4fa7\u540c\u7406=f[k]+M^{2}+T[k]^{2}-2MT[k]$$\n\n$$\u5316\u7b80\u4e0d\u7b49\u5f0f\u5f97\uff1a\\frac{(f[j]+T[j]^2)-(f[k]+T[k]^2)}{2(T[j]-T[k])}<M$$\n\nf[i],T[j]\u548cM\u5f88\u663e\u7136\u662f\u5355\u8c03\u7684\n\n\u6240\u4ee5\u5f88\u663e\u7136\u7684\u53ef\u4ee5\u7528\u5230\u4e86[\u659c\u7387\u4f18\u5316](http://blog.csdn.net/qq\\_30974369/article/details/78306743)\u5566\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\n#include<set>\n#include<map>\n#include<vector>\nusing namespace std;\n#define MAX 50100\ninline int read()\n{\n    int x=0,t=1;char ch=getchar();\n    while((ch<'0'||ch>'9')&&ch!='-')ch=getchar();\n    if(ch=='-')t=-1,ch=getchar();\n    while(ch<='9'&&ch>='0')x=x*10+ch-48,ch=getchar();\n    return x*t;\n}\nint n,L,c[MAX];\nint s[MAX],h,t;\nlong long f[MAX],q[MAX],T[MAX];\nlong long sqr(long long x){return x*x;}\nlong long count(int x,int y)\n{\n    return ((f[x]+sqr(q[x]))-(f[y]+sqr(q[y])))/(2*(q[x]-q[y]));\n}\nint main()\n{\n    n=read();L=read();\n    for(int i=1;i<=n;++i)c[i]=read()+c[i-1];\n    for(int i=1;i<=n;++i)f[i]=1e18;\n    /*\n    for(int i=1;i<=n;++i)\n        for(int j=0;j<i;++j)\n            f[i]=min(f[i],f[j]+sqr(c[i]-c[j]+i-j-1-L));\n    */\n    //\u4ee5\u4e0a\u5185\u5bb9\u4e3aO(n^2)\u7684\u66b4\u529b\u8f6c\u79fb\n    for(int i=1;i<=n;++i)q[i]=c[i]+i;\n    for(int i=1;i<=n;++i)T[i]=c[i]+i-L-1;\n    for(int i=1;i<=n;++i)\n    {\n        while(h<t&&count(s[h],s[h+1])<=T[i])h++;\n        int get=s[h];\n        f[i]=f[get]+sqr(T[i]-q[get]);\n        while(h<t&&count(s[t-1],s[t])>=count(s[t],i))t--;\n        s[++t]=i;\n    }\n    printf(\"%lld\\n\",f[n]);\n    return 0;\n}\n\n```",
        "postTime": 1508595870,
        "uid": 21283,
        "name": "yybyyb",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "\u554a\uff0c\u8fd9\u4e2a\u662f\u6211\u5f88\u65e9\u5f88\u65e9\u4e4b\u524d\u5c31\u60f3\u641e\u61c2\u7684\u77e5\u8bc6\u70b9\u4e86emmm\u53ef\u662f\u4e00\u76f4\u6ca1\u6709\u89e3\u51b3\u3002\u4eca\u5929\u603b\u7b97\u6709\u673a\u4f1a\u4e86\uff01\n\n\u6211\u4eca\u5929\u6253\u7b97\u505a[P3195](https://www.luogu.com.cn/problem/P3195)\uff0c\u628a\u8fd9\u9053\u677f\u5b50\u809d\u51fa\u6765\u3002\n\n## \u9898\u610f\uff1a\n\n\u4f60\u6709\u4e00\u4e2a\u5e8f\u5217\uff0c\u4f60\u53ef\u4ee5\u4efb\u610f\u5730\u5c06\u5176\u4e2d\u7684i-j\u9879\u5408\u5e76\u6210\u4e00\u7ec4\u3002\u5e76\u4e14\u5bf9\u4e8e\u6bcf\u4e00\u7ec4\uff0c\u4ee3\u4ef7\u4e3a$(x-L)^2$\u3002\u5176\u4e2d\uff0c$x=j-i+\\sum_{k=i}^j C_k$\uff0cL\u4e3a\u5e38\u4eae\u3002\u6c42\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n## $N^2$ \u89e3\u6cd5\n\n\u6211\u4eec\u8ba9$s[i]=\\sum_{j=1}^i+i$(\u5373\u524d\u7f00\u548c+i)\uff0c\u53ef\u4ee5\u53d1\u73b0\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u53ef\u4ee5\u53d8\u6210\uff1a\n\n$$f[i]=min_{j=0}^{i-1}(f[j]+(s[i]-s[j]-1-l)^2);$$\n\n\u4e8e\u662f\u6109\u5feb$N^2$\u66b4\u529b\uff0c\u5438\u6c27\u540e70\u5206\u3002\n\n## \u5348\u9910\n\n\u5348\u9910\u548cAtalod\u4e00\u8d77\u5403\uff0c\u5403\u4e86\u91d1\u62f1\u95e8\u3002\u867d\u7136\u7b49\u4e86\u5f88\u4e45\uff0c\u4f46\u662f\u6211\u4eec\u804a\u4e86\u4e00\u4f1a\u513f\u659c\u7387\u4f18\u5316\u3002\n\n## \u659c\u4f18\u6570\u8bba\u8bc1\u660e\n\n\u5bf9\u4e8e\u4e0a\u9762\u7684\u8fd9\u4e2a\u65b9\u7a0b\uff0c\u6211\u4eec\u5047\u8bbe\u5bf9\u4e8e\u4e00\u4e2a\u6211\u4eec\u5c06\u8981\u6c42\u7684i\u3002\u6709\u4e24\u4e2aj,\u5206\u522b\u662f$j_1,j_2$,\u6211\u4eec\u5047\u8bbe$j_1$\u7684\u89e3\u66f4\u5c0f(\u66f4\u4f18\u79c0)\u3002\n\n\n$$f[j_1]+(s_i-s_{j_1}-1-l)^2\\leq f[j_2]+(s_i-s_{j_2}-1-l)^2$$\n\n\u62c6\u5f00\uff1a\n\n$$f[j_1]+s_i^2-2*s_i*(s_{j_1}-1-l)+(s_{j_1}-1-l)^2\\leq f[j_2]+s_i^2-2*s_i*(s_{j_2}-1-l)+(s_{j_2}-1-l)^2$$\n\n\u5316\u7b80\uff1a\n\n$$-2*s_i*(s_{j_1}-1-l)+2*s_i*(s_{j_2}-1-l)\\leq -f[j_1]+f[j_2]+(s_{j_2}-1-l)^2-(s_{j_1}-1-l)^2$$\n\n\u518d\u5316\u7b80\uff1a\n\n$$2*s_i*(s_{j_2}-s_{j_1})\\leq -f[j_1]+f[j_2]+(s_{j_2}-1-l)^2-(s_{j_1}-1-l)^2$$\n\n\u518d\u518d\u5316\u7b80\uff1a\n\n\n$$2*s_i\\leq \\frac{-f[j_1]+f[j_2]+(s_{j_2}-1-l)^2-(s_{j_1}-1-l)^2}{(s_{j_2}-s_{j_1})}$$\n\n\u7ecf\u8fc7\u6211\u4eec\u7684\u63a8\u5bfc\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u53ea\u8981\u4efb\u610f\u7684$j_1,j_2$\u6ee1\u8db3\u4e0a\u5f0f\u5b50\uff0c$j_1$\u5c31\u66f4\u4f18\u79c0\uff0c\u4e5f\u5c31\u662f$j_1$\u66f4\u5c0f\u3002\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u4e0b\u6807\u4e0e\u4e0b\u6807\u6240\u5bf9\u5e94\u7684\u503c\u5efa\u7acb\u4e00\u4e2a\u4e2a\u6563\u70b9\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/swcmvou8.png)\n\n\u6839\u636e\u6211\u4eec\u7684\u63a8\u8bba\uff0c$2*s_i$\u4f5c\u4e3a\u659c\u7387\uff0c\u6211\u4eec\u5e94\u5f53\u627e\u5230\u67d0\u4e2aj\u4f5c\u4e3a**\u8f6c\u79fb\u51b3\u7b56\u70b9**\uff0c\u800c\u4e14\u8fd9\u4e2a\u8f6c\u79fb\u51b3\u7b56\u70b9\u9700\u8981\u4fdd\u8bc1\u8ba9$f[i]$\u6700\u5c0f\u3002\n\n\u501f\u7528\u4e0a\u9762\u7684\u4e00\u4e2a\u516c\u5f0f\uff1a\n$$f[i]=f[j]+(s[i]-s[j]-1-l)^2;$$\n\n$f[j]$\u5c31\u662f\u9ad8\u5ea6,$(s[i]-s[j]-1-l)^2$\u662f\u659c\u7387\n\n\u7136\u540e\u53d1\u73b0\u6211\u4eec\u8981\u505a\u7684\u53ea\u662f\u62ff\u4e00\u6761\u659c\u7387\u4e3a$2*s[i]$\u7684\u76f4\u7ebf\u53bb\u903c\u8fd1\u5b83\uff0c\u627e\u5230\u7b2c\u4e00\u4e2a\u51b3\u7b56\u70b9\u3002\n![](http://47.103.204.220/picture_bed/uploads/2020/02/1.jpg)\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u53ea\u6709\u8fd9\u4e9b\u6563\u70b9\u4e2d\u80fd\u591f\u6210\u4e0b\u51f8\u58f3\u7684\u90a3\u4e9b\u70b9\u624d\u6709\u53ef\u80fd\u6210\u4e3a\u51b3\u7b56\u70b9\u3002\n\n![](http://47.103.204.220/picture_bed/uploads/2020/02/2.jpg.png)\n\n\u7136\u540e\u961f\u5217\u6216\u8005\u6808\u7ef4\u62a4\u51f8\u58f3\u3002\n\n\u800c\u8fd9\u4e2a\u65b9\u7a0b\uff0c\u524d\u7f00\u548c\u5355\u589e\uff0cy=x\u5355\u589e\uff0c\u6240\u4ee5$s_i$\u5355\u589e\uff0c\u6240\u4ee5\u659c\u7387\u5355\u589e\uff0c\u6ee1\u8db3\u659c\u7387\u5355\u8c03\u6027\u3002\n\n\u5bf9\u4e8e\u6709\u51b3\u7b56\u5355\u8c03\u6027\u7684\u65b9\u7a0b\uff0c\u51b3\u7b56\u70b9\u4e00\u5b9a\u4f1a\u4f1a\u540e\u79fb\u6216\u4e0d\u52a8\uff0c\u4e0d\u53ef\u80fd\u524d\u79fb\u3002\u6bcf\u4e2a\u70b9\u662f\u6700\u591a\u8fdb\u961f\u4e00\u6b21\uff0c\u51fa\u961f\u4e00\u6b21\u3002\u590d\u6742\u5ea6$O(n)$\n\n\u5bf9\u4e8e\u6ca1\u6709\u51b3\u7b56\u5355\u8c03\u6027\u7684\u70b9\uff0c\u51b3\u7b56\u70b9\u53ef\u80fd\u4e71\u8df3\u3002\u6bcf\u4e2a\u70b9\u8fdb\u6808\u51fa\u6808\u6700\u591a\u4e00\u6b21\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2ai\uff0c\u5728\u51f8\u58f3\u4e0a\u4e8c\u5206\u5373\u53ef\u627e\u5230\u51b3\u7b56\u70b9\u3002\u590d\u6742\u5ea6$O(n log n)$\n\n\u6b64\u9898\u5438\u6c2770\u5206\u7684$O(n^2)$\u505a\u6cd5\n\n```\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=52505;\nint f[N],a[N],s[N];\nint q[N],be,ed;\nint n,l;\nint X(int j){\n\treturn s[j];\n}\nint Y(int j){\n\treturn f[j]+(s[j]+l)*(s[j]+l);\n}\nlong double slope(int i,int j){\n\treturn (long double)(Y(j)-Y(i))/(X(j)-X(i));\n}\nsigned main(){\n\tcin>>n>>l;\n\tfor(int i=1;i<=n;++i){\n\t\tscanf(\"%lld\",&a[i]);\n\t\ts[i]=s[i-1]+a[i]+1;\n\t}\n\tq[++ed]=1;\n\tfor(int i=1;i<=n;++i){\n\t\tf[i]=0x3f3f3f3f3f3f3f3f;\n\t\tfor(int j=0;j<i;++j)\n\t\t\tf[i]=min(f[i],f[j]+(s[i]-s[j]-1-l)*(s[i]-s[j]-1-l));\n\t}\n\tcout<<f[n];\n}\n```\n\u659c\u4f18$O(n)$\u505a\u6cd5\n```\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=52505;\nint f[N],a[N],s[N];\nint q[N],be,ed;\nint n,l;\nint X(int j){\n\treturn s[j];\n}\nint Y(int j){\n\treturn f[j]+(s[j]+l)*(s[j]+l);\n}\nlong double slope(int i,int j){\n\treturn (long double)(Y(j)-Y(i))/(X(j)-X(i));\n}\nsigned main(){\n\tcin>>n>>l;\n\tfor(int i=1;i<=n;++i){\n\t\tscanf(\"%lld\",&a[i]);\n\t\ts[i]=s[i-1]+a[i]+1;\n\t}\n\tq[++ed]=1;\n\tfor(int i=1;i<=n;++i){\n//\t\tf[i]=0x3f3f3f3f3f3f3f3f;\n//\t\tfor(int j=0;j<i;++j)\n//\t\t\tf[i]=min(f[i],f[j]+(s[i]-s[j]-1-l)*(s[i]-s[j]-1-l));\n\t\twhile(be<=ed&&slope(q[be],q[be+1])<=2*s[i])\n\t\t\tbe++;\n\t\tf[i]=f[q[be]]+(s[i]-s[q[be]]-1-l)*(s[i]-s[q[be]]-1-l);\n\t\twhile(be<=ed&&slope(q[ed-1],q[ed])>=slope(q[ed-1],i))\n\t\t\ted--;\n\t\tq[++ed]=i;\n\t}\n\tcout<<f[n];\n}\n```\n",
        "postTime": 1579406307,
        "uid": 53058,
        "name": "Algha_Porthos",
        "ccfLevel": 0,
        "title": "\u5173\u4e8e\u659c\u7387\u4f18\u5316"
    },
    {
        "content": "\u8fd9\u9053\u9898\u50cf\u6211\u8fd9\u6837\u7684 $dp$ \u849f\u84bb\u90fd\u80fd\u4e00\u773c\u770b\u51fa $dp$ \u5f0f\uff1a\n\n\u8bbe $sum$ \u4e3a $c$ \u7684\u524d\u7f00\u548c\uff0c\u5219\u6709\n\n$$\ndp[i]=min\\{ dp[j]+((i-j-1)+(sum[i]-sum[j])-L)^2 \\} ~~ (0 \\le j < i)\n$$\n\n\u5c31\u53ef\u4ee5$\\Theta(n^2)$\u89e3\u51b3\u4e86 \uff0c~~\u5f00O2\u9a97\u4e8670\u5206~~\u3002\n\n\u8003\u8651\u4f18\u5316\uff0c\u4ee4$s_i=sum[i]+i$,\u5219\u6709\uff1a\n\n$$\ndp[i]=min\\{ dp[j] + (s_i-s_j-1-L)^2 \\} ~~~~ (0 \\le j < i)\n$$\n\n\u5c06 $s_i-1-L$ \u770b\u4f5c\u4e00\u4e2a\u6574\u4f53\u62c6\u5f00\u5e73\u65b9\uff08\u5b83\u4eec\u4e0e\u51b3\u7b56\u70b9 $j$ \u65e0\u5173\uff09\uff0c\u5f97\u5230:\n\n$$\ndp[i]=min\\{ dp[j] + {s_j}^2 - 2 \\times s_j \\times (s_i-L-1) \\}+(s_i-L-1)^2 ~~~~ (0 \\le j < 0)\n$$\n\n$$\ndp[i]=min\\{ dp[j] + {s_j}^2 - 2s_is_j + 2Ls_j + 2s_j  \\}+(s_i-L-1)^2 ~~~~ (0 \\le j < 0)\n$$\n\n\u7136\u540e\u662f\u659c\u4f18\u7684\u5957\u8def\uff0c\u8bbe\u4e24\u4e2a\u51b3\u7b56\u70b9 $j,k (j<k)$ \u4e14 $j$ \u4f18\u4e8e $k$\u3002\u5373:\n\n$$dp[j] + {s_j}^2 - 2s_is_j + 2Ls_j + 2s_j<dp[k] + {s_k}^2 - 2s_is_k + 2Ls_k + 2s_k$$\n\n$$(dp[j]+{s_j}^2)-(dp[k]+{s_k}^2)+2L(s_j-s_k)+2(s_j-s_k)<2s_i(s_j-s_k)$$\n\n\u6ce8\u610f$s_j<s_k$ \uff0c \u79fb\u9879\u53d8\u53f7\uff1a\n\n$$\n\\frac{(dp[j]+{s_j}^2)-(dp[k]+{s_k}^2)+2(L+1)(s_j-s_k)}{s_j-s_k}>2s_i\n$$\n\n$$\n\\frac{(dp[j]+{s_j}^2+2s_j(L+1))-(dp[k]+{s_k}^2+2s_k(L+1))}{s_j-s_k}>2s_i\n$$\n\n\u73b0\u5728\u5c31\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u5305\u89e3\u51b3\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$\\Theta(n)$\u3002\n\n```cpp\n#include <cstdio>\n#include <iostream>\nusing namespace std;\n#define LL long long\n\nconst int MAXN = 50000;\nint n , l , c[ MAXN + 5 ] , Head = 1 , Tail = 0 , Que[ MAXN + 5 ];\nLL sum[ MAXN + 5 ] , dp[ MAXN + 5 ];\n\nLL Calc( int i ) {\n    return sum[ i ] + i;\n}\ndouble Slope( int u , int v ) {\n    return ( ( dp[ u ] + Calc( u ) * Calc( u ) + 2 * Calc( u ) * ( l + 1 ) ) - ( dp[ v ] + Calc( v ) * Calc( v )+ 2 * Calc( v ) * ( l + 1 ) ) ) / ( Calc( u ) - Calc( v ) );\n}\n\nint main( ) {\n    scanf(\"%d %d\",&n,&l);\n    for( int i = 1 ; i <= n ; i ++ )\n        scanf(\"%d\",&c[ i ]) , sum[ i ] = sum[ i - 1 ] + c[ i ];\n    \n    Que[ ++ Tail ] = 0;\n    for( int i = 1 ; i <= n ; i ++ ) {\n        while( Head < Tail && Slope( Que[ Head ] , Que[ Head + 1 ] ) < 2 * Calc( i ) ) Head ++;\n\n        dp[ i ] = dp[ Que[ Head ] ] + ( Calc( i ) - Calc( Que[ Head ] ) - 1 - l ) * ( Calc( i ) - Calc( Que[ Head ] ) - 1 - l );\n        while( Head < Tail && Slope( Que[ Tail - 1 ] , Que[ Tail ] ) > Slope( Que[ Tail - 1 ] , i ) ) Tail --;\n        Que[ ++ Tail ] = i;\n    }\n\n    printf(\"%lld\",dp[ n ]);\n    return 0;\n}\n```\n\n",
        "postTime": 1575078048,
        "uid": 123802,
        "name": "chihik",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/P3195)\u770b\u9898\u76ee\u3002  \n# \u5206\u6790\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e0d\u96be\u770b\u51fa\u662f\u4e00\u4e2a$dp$\u9898\uff1a  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$f(i)$\uff1a\u524d$i$\u4e2a\u7269\u54c1\u88c5\u8fdb\u7bb1\u5b50\u91cc\u9762\u7684\u6700\u5c0f\u82b1\u8d39\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8f6c\u79fb\u5f88\u7b80\u5355\uff1a  \n$$f(i)=\\min_{0\\le j<i}\\{f(j)+(i-j-1+\\sum_{k=j+1}^iC_k-L)^2\\}$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8bbe$s_i=(\\sum_{j=1}^i C_j)+i$\uff0c\u4ee3\u5165\u5f97\u5230\uff1a  \n$$f(i)=\\min_{0\\le j<i}\\{f(j)+(s_i-s_j-L-1)^2\\}$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u65f6\u95f4\u662f$O(n^2)$\u3002\u8003\u8651\u4f18\u5316\u3002\u4e8c\u6b21\u9879\u8fd9\u79cd\u4e1c\u897f\u544a\u8bc9\u6211\u4eec\uff0c\u8fd9\u4e2a\u5e94\u8be5\u548c\u659c\u4f18\u6709\u5173\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8bbe$0\\le j<k<i\\Rightarrow s_j<s_k$\uff0c\u82e5\u5728$j$\u8f6c\u79fb\u6bd4$k$\u4f18\uff1a  \n$$f(j)+(s_i-s_j-L-1)^2<f(k)+(s_i-s_k-L-1)^2$$  \n$$\\Rightarrow f(j)-2s_is_j+s_j^2+2s_j(L+1)<f(k)-2s_is_k+s_k^2+2s_k(L+1)$$  \n$$\\Rightarrow [f(j)+s_j^2+2s_j(L+1)]-[f(k)+s_k^2+2s_k(L+1)]<2s_i(s_j-s_k)$$  \n$$\\Rightarrow \\frac {[f(j)+s_j^2+2s_j(L+1)]-[f(k)+s_k^2+2s_k(L+1)]}{s_j-s_k}>2s_i$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u611f\u6027\u7406\u89e3\u5c31\u662f\uff0c\u5982\u679c\u4e24\u70b9\u7684\u659c\u7387$>2s_i$\uff0c\u90a3\u4e48\u524d\u4e00\u4e2a\u70b9\u66f4\u4f18\uff0c\u5426\u5219\u5c31\u662f\u540e\u4e00\u4e2a\u70b9\u66f4\u4f18\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7136\u540e\u4e0d\u96be\u53d1\u73b0\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u5305\u3002\u7136\u540e\u7528\u5355\u8c03\u961f\u5217\u505a\u4e00\u505a\u5c31\u53ef\u4ee5\u4e86\u3002\u65f6\u95f4$O(n)$\u3002  \n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n\ntypedef long long LL;\n\nconst LL INF = 0x3f3f3f3f3f3f3f3f;\nconst int MAXN = 50005;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0; char s = getchar();int f = 1;\n\twhile( s < '0' || '9' < s ) { f = 1; if( s == '-' ) f = -1; s = getchar(); }\n\twhile( '0' <= s && s <= '9' ) { x = ( x << 3 ) + ( x << 1 ) + s - '0', s = getchar(); }\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ) { putchar( '-' ), x = -x; }\n\tif( 9 < x ) { write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\ntemplate<typename _T>\n_T MIN( const _T a, const _T b )\n{\n\treturn a < b ? a : b;\n}\n\nstruct vector\n{\n\tLL x, y;\n\tvector(){}\n\tvector( const LL X, const LL Y ) { x = X, y = Y; } \n\tLL mul( const vector & other ) const { return x * other.y - other.x * y; }\n\tbool operator >= ( const vector & other ) const { return mul( other ) <= 0; }\n};\n\nLL f[MAXN], s[MAXN], p[MAXN];\nLL L;\nint deq[MAXN], h, t;\nint N;\n\nLL sqr( const LL a ) { return a * a; }\n\nLL Y( const LL i ) { return f[i] + sqr( p[i] ) + 2 * p[i] * ( L + 1 ); }\nLL X( const LL i ) { return p[i]; }\nLL getDP( const LL i, const LL j ) { return f[j] + sqr( p[i] - p[j] - L - 1 ); }\n\nint main()\n{\n\tread( N ), read( L );\n\tfor( int i = 1, tmp ; i <= N ; i ++ ) read( tmp ), s[i] = s[i - 1] + tmp, p[i] = s[i] + i;\n\tf[0] = 0, h = 1, t = 0, deq[++ t] = 0;\n\tfor( int i = 1 ; i <= N ; i ++ )\n\t{\n\t\twhile( h < t && Y( deq[h] ) - Y( deq[h + 1] ) >= 2 * p[i] * ( X( deq[h] ) - X( deq[h + 1] ) ) ) h ++;\n\t\tf[i] = getDP( i, deq[h] );\n\t\twhile( h < t && vector( X( deq[t] ) - X( deq[t - 1] ), Y( deq[t] ) - Y( deq[t - 1] ) ) >=\n\t\t\t\t\t\tvector( X( i ) - X( deq[t] ), Y( i ) - Y( deq[t] ) ) ) t --;\n\t\tdeq[++ t] = i;\n\t}\n\twrite( f[N] ), putchar( '\\n' );\n\treturn 0;\n}```",
        "postTime": 1575034612,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY"
    },
    {
        "content": " [\u5b89\u5229\u4e00\u6ce2\u535a\u5ba2](https://www.cnblogs.com/cold-cold/p/10103100.html)\n\n\n\u663e\u7136dp\u65b9\u7a0b\u53ef\u4ee5\u5f97\u51fa\u4e3adp[i]=min{dp[j]+(sum[i]+i\u2212sum[j]\u2212j\u2212L\u22121)2}\n\n\u4f46\u662f\u8fd9\u79cddp\u65b9\u5f0f\u662fO(n2)\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u659c\u7387\u4f18\u5316\u7684\u65b9\u6cd5\u5c06\u5176\u4f18\u5316\u6210O(n)\n\n\u6211\u4eec\u8003\u8651\u5c06\u539fDP\u65b9\u7a0b\u53d8\u5f62\n\n1.  dp[i]=dp[j]+(sum[i]+i\u2212sum[j]\u2212j\u2212L\u22121)^2    \u3000\u3000\u3000\u3000\u5c06L++\n\n2.  dp[i]=dp[j]+(sum[i]+i\u2212sum[j]\u2212j\u2212L)^2 \u3000\u3000\u3000\u3000\u3000    \u4ee4sum[i]+=i\n\n3.  dp[i]=dp[j]+(sum[i]\u2212sum[j]\u2212L)^2\n\n\u5c06\u539f\u5f0f\u5b50\u5c55\u5f00\n\ndp[j]+sum[i]^2+(sum[j]+L)^2=2\\*sum[i]\\*(sum[j]+L)+dp[i]\n\n          y \t\t\t  = \tk *   x    +  b\n\ny=dp[j]+sum[i]^2+(sum[j]+L)^2\n\nk=2*sum[i]\n\nx=sum[j]+L\n\nb=dp[i]\n\n\u6240\u4ee5\u6211\u4eec\u5c06\u6bcf\u4e00\u4e2a\u70b9(x,y)\u753b\u5728\u56fe\u50cf\u4e0a\uff0c\u5e76\u7ef4\u62a4\u4e00\u4e2a\u51f9\u5305\n\n![](https://img2018.cnblogs.com/blog/1539484/201812/1539484-20181211162629847-430955230.png)\n\n\u90a3\u4e48\u6211\u4eec\u5728\u6c42f[i]\u7684\u503c\u7684\u65f6\u5019\uff0c\u7528\u4e00\u6761\u659c\u7387\u4e3a2*sum[i]\u7684\u7ebf\u5207\u4e0a\u5b83\u80fd\u5207\u5230\u7684\u6700\u4f4e\u70b9\n\n\u6b64\u65f6\u5176\u4e0ey\u8f74\u7684\u4ea4\u70b9\u7684\u622a\u8ddd\u4e3af[i]\u7684\u6700\u5c0f\u503c\n\n\u53c8\u56e0\u4e3asum[i]\u5355\u8c03\u9012\u589e\uff0c\u6240\u4ee5k\u503c\u53ea\u4f1a\u8d8a\u6765\u8d8a\u5927\n\n\u6240\u4ee5\u9009\u4e2d\u70b9\u524d\u7684\u70b9\u5168\u90e8\u5e9f\u5f03\n![](https://img2018.cnblogs.com/blog/1539484/201812/1539484-20181211163154391-1027468699.png)\n\n\u56e0\u4e3a\u6bcf\u4e2a\u70b9\u53ea\u4f1a\u88ab\u5220\u4e00\u6b21\uff0c\u6240\u4ee5\u7b97\u6cd5\u4e3aO(n)\n\n\u5b9e\u73b0\u91c7\u7528\u5355\u8c03\u961f\u5217\uff1a\n\n```cpp\n#include <algorithm>\n#include <iostream>\n#include <cmath>\n#include <cstring>\n#include <map>\n#include <string>\n#include <vector>\n#include <queue>\n#include <stack>\n#include <cstdio>\n#include <cstdlib>\nusing namespace std;\ntypedef long long ll;\ninline ll read()\n{\n    register ll p(1),a(0);register char ch=getchar();\n    while((ch<'0'||ch>'9')&&ch!='-') ch=getchar();\n    if(ch=='-') p=-1,ch=getchar();\n    while(ch>='0'&&ch<='9') a=a*10+ch-48,ch=getchar();\n    return a*p;\n}\nconst int N=50010;\nll n,L,f[N],s[N],Q[N],head=1,tail=1;\n//f[i]+2*s[i]*(s[j]+L)=f[j]+s[i]^2+(s[j]+L)^2\ndouble getx(int x) {return s[x];}\ndouble gety(int x) {return f[x]+(s[x]+L)*(s[x]+L);}\ndouble che(int x,int y){return (gety(y)-gety(x))/(getx(y)-getx(x));}\nint main()\n{\n//    freopen(\"input\",\"r\",stdin);\n//    freopen(\"output\",\"w\",stdout);\n    n=read(),L=read()+1;\n    for(int i=1;i<=n;i++) s[i]=s[i-1]+read();\n    for(int i=1;i<=n;i++) s[i]+=i;\n    for(int i=1,j;i<=n;i++)\n    {\n        while(head<tail&&che(Q[head],Q[head+1])<2*s[i]) ++head;\n        j=Q[head];f[i]=f[j]+(s[i]-s[j]-L)*(s[i]-s[j]-L);\n        while(head<tail&&che(Q[tail-1],Q[tail])>che(Q[tail],i)) --tail;\n        Q[++tail]=i;\n    }\n    printf(\"%lld\",f[n]);\n    return 0;\n}\n/*\n \n*/\n```\n",
        "postTime": 1544517708,
        "uid": 48934,
        "name": "cold_cold",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "## \u9898\u76ee\u603b\u7ed3\n\n![](https://cdn.luogu.com.cn/upload/pic/20603.png )\n\n## \u6570\u636e\u8303\u56f4\n\n$1<=N<=50000$\uff0c\u4e0d\u4f18\u5316\u51c9\u51c9\uff1b\n\n## \u89e3\u9898\u601d\u8def\n\n![](https://cdn.luogu.com.cn/upload/pic/20604.png )\n\n![](https://cdn.luogu.com.cn/upload/pic/20606.png )\n\n![](https://cdn.luogu.com.cn/upload/pic/20607.png )\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u4e0d\u7528\u7ef4\u62a4\u6240\u6709\u70b9\u4e86\uff0c\u53ea\u7528\u7ef4\u62a4\u4e00\u4e2a\u51f8\u58f3\u3002\n\u6ce8\u610f\u5230\uff0c\u6211\u4eec\u7684\u659c\u7387\uff08\n$2 \u00d7 G(i)$\n\uff09\u662f\u6b63\u7684\uff0c\u4e14\u6c42\u622a\u8ddd\u6700\u5c0f\u503c\u3002\n\u6240\u4ee5\u6211\u4eec\u5e94\u8be5\u7ef4\u62a4\u4e0b\u51f8\u58f3\uff08\u53f3\u4e0b\uff09\u3002\n\u90a3\u600e\u4e48\u7ef4\u62a4\u5462\uff1f\n\u7ef4\u62a4\u52a8\u6001\u51f8\u5305\u8fd9\u4e2a\u4e1c\u897f\u9700\u8981\u7528\u5e73\u8861\u6811\u6216set\u3002\n\u90a3\u8fd9\u9898\u53ea\u80fd\u7528\u90a3\u4e24\u79cd\u65b9\u6cd5\u505a\u5417\uff1f\n\n\u663e\u7136\u4e0d\u662f\uff1b\n\u6211\u4eec\u7ee7\u7eed\u89c2\u5bdf\uff0c\u4e0d\u96be\u53d1\u73b0\uff0c**\u6211\u4eec\u7684\u659c\u7387\uff08\n$2 \u00d7 G(i)$\n\uff09\u662f\u5355\u8c03\u9012\u589e\u7684\u3002\n\u6240\u4ee5\u5462\uff1f\u4e4b\u524d\uff08\u56e0\u4e3a\u659c\u7387\uff09\u88ab\u5220\u6389\u7684\u70b9\u80af\u5b9a\u4e0d\u4f1a\u518d\u88ab\u52a0\u8fdb\u6765\u3002\n\u5e76\u4e14\u6bcf\u6b21\u63d2\u5165\u70b9\u7684\nX\n\u5750\u6807\u662f\u5355\u8c03\u4e0d\u964d\u7684\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u3002**\n\n![](https://cdn.luogu.com.cn/upload/pic/20608.png )\n\n\u624b\u52a8\u6a21\u62df\u4e00\u4e0b\u53d1\u73b0\u8fd9\u662f\u5bf9\u7684\uff1b\n\n## \u6613\u9519\u8bef\u533a\n\n\u4e00\u4e2a\u9898\u80fd\u4f7f\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u51f8\u5305\uff0c\u5e94\u8be5\u6709\u4ee5\u4e0b\u51e0\u4e2a\u6761\u4ef6\uff1a\n\n1.\n\u67e5\u8be2\u659c\u7387\u5355\u8c03\u3002\n\n2.\n\u63d2\u5165\u70b9\u7684\u6a2a\u5750\u6807\u5355\u8c03\u3002\n\n## \u4ee3\u7801\u5c55\u793a\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cmath>\n#include<cstring>\n#include<string>\n#include<algorithm>\n#include<vector>\n#include<map>\n#include<set>\n#include<list>\n#include<queue>\n#include<stack>\n#include<bitset>\n#include<deque>\nusing namespace std;\n#define ll long long\n#define ull unsigned long long\n#define inf 0x3f3f3f3f\n#define ri register int\n#define il inline\n#define fi first\n#define se second\n#define mp make_pair\n#define pi pair<int,int>\n#define mem0(x) memset((x),0,sizeof (x))\n#define mem1(x) memset((x),0x3f,sizeof (x))\n#define int ll\nil char gc() {\n    static const int BS = 1 << 22;\n    static unsigned char buf[BS], *st, *ed;\n    if (st == ed) ed = buf + fread(st = buf, 1, BS, stdin);\n    return st == ed ? EOF : *st++;\n}\n#define gc getchar\ntemplate<class T>void in(T &x)\n{\n    x = 0; bool f = 0; char c = gc();\n    while (c < '0' || c > '9') {if (c == '-') f = 1; c = gc();}\n    while (isdigit(c)) {x = (x << 3) + (x << 1) + (c ^ 48); c = gc();}\n    if (f) x = -x;\n}\n#undef gc\nvoid out(int x) {\n    if (x < 0) putchar('-'), x = -x;\n    if (x > 9) out(x / 10);\n    putchar(x % 10 + '0');\n}\n#define N 50010\n#define int ll\n#define A(i) (sum[i]+i)\n#define B(i) (A(i)+(L+1))\n#define X(i) B(i)\n#define Y(i) (B(i)*B(i)+dp[i])\n#define G(i) 2.0*A(i)\n#define slope(i,j) ((double)(Y(j)-Y(i))/(double)(X(j)-X(i)))\nint n,L, c[N], sum[N], dp[N];\ndeque<int>q;\nsigned main() {\n    in(n),in(L);\n    for (ri i = 1; i <= n; ++i) {\n        in(c[i]);\n        sum[i] = sum[i - 1] + c[i];\n    }\n    q.push_back(0);// f[0]=0;\n    for (ri i = 1; i <= n; ++i) {\n        while (q.size() > 1 && slope(*(q.begin()), *(q.begin() + 1)) < G(i))\n            q.pop_front();\n        dp[i] = dp[q.front()] + (A(i) - B(q.front())) * (A(i) - B(q.front()));\n        while (q.size() > 1 && slope(*(q.end() - 1), *(q.end() - 2)) > slope(*(q.end() - 2), i))\n            q.pop_back();\n        q.push_back(i);\n    }\n    printf(\"%lld\", dp[n]);\n    return 0;\n}\n```",
        "postTime": 1528103900,
        "uid": 58302,
        "name": "i207M",
        "ccfLevel": 0,
        "title": "\u89e3\u9898\u62a5\u544a-\u659c\u7387\u4f18\u5316-\u73a9\u5177\u88c5\u7bb1-P3195"
    },
    {
        "content": "#### \u9898\u76ee\u5927\u610f\uff1a\n\n\u6709n\u4e2a\u6570\uff0c\u8981\u5c06\u4ed6\u4eec\u5206\u6210\u82e5\u5e72\u6bb5\uff0c\u6bcf\u4e00\u6bb5\u7684cost\u5b9a\u4e49\u4e3a\uff1a\ncost=r-l+\u03a3Ck (k\u2208[r,l])\n\u8be5\u6bb5\u7684\u6700\u7ec8\u82b1\u8d39\u662f\uff1a(cost-L)^2;\n\u7ed9\u51faL,n,C(1~n)\uff0c\u603b\u5171\u7684\u6700\u5c0f\u82b1\u8d39\u3002\n\n#### \u5206\u6790\uff1a\n\ndp\u65b9\u7a0b\u6781\u5bb9\u6613\u60f3\u51fa\u6765\uff1a\nf[i]=max(f[j]+(sum[i]-sum[j]+i-j-1-L)^2)\n\u5176\u4e2dsum[i]\u8868\u793ac(1~i)\u7684\u548c\u3002\u56e0\u4e3a\u53d6\u7684\u8fd9\u4e00\u6bb5\u6570\u4ecej+1\u5f00\u59cb\uff0c\u6240\u4ee5i-j-1\uff08\u9898\u76ee\u4e2di-j\u5e76\u4e0d\u662f\u533a\u95f4\u957f\u5ea6\uff01\u6ca1\u6709\u518d\u52a01\uff09\n\nO(n^2)\u76f4\u63a5\u6302\u6389\u3002\n\n\u56e0\u4e3a\u72b6\u6001O(n)\u5df2\u7ecf\u975e\u5e38\u4e0d\u9519\uff0c\u65e0\u6cd5\u518d\u4f18\u5316\u4e86\u3002\u6240\u4ee5\u8003\u8651\u80fd\u4e0d\u80fd\u4f18\u5316\u8f6c\u79fb\u7684O(n)\u3002\n\n\u5c06\u8868\u8fbe\u5f0f\u5c55\u5f00\uff1a\n\nf[i]=f[j]+(sum[i]-sum[j]+i-j-1-L)^2\n\n\u4ee4a[k]=sum[k]+k;x[k]=a[k]+1+\nf[i]=f[j]+(a[i]-x[j])^2\n\nf[i]=f[j]+x[j]^2-2a[i]x[j]+a[i]^2\n\n\u5bf9\u4e8e\u7ed9\u5b9a\u7684i\uff0ca[i]^2\u662f\u4e00\u4e2a\u5b9a\u503c\uff0c\u6240\u4ee5\u5f53\u505a\u5e38\u6570\u5148\u4e0d\u7528\u7ba1\uff0c**\u4f46\u662f\u8bb0\u5f97\u6700\u540e\u52a0\u4e0a\uff01**\n\n\u4ee4y[k]=f[k]+x[k]^2;\nf[i]=y[j]-2a[i]x[j]\n\n\u79fb\u9879\uff1a\n**y[j]**=2a[i]**x[j]**+f[i]\n\n\u5bf9\u4e8e\u7ed9\u5b9a\u7684i,\u6211\u4eec\u9700\u8981\u5faa\u73af\u6240\u6709\u7684j\u3002\n\u5bf9\u4e8e\u4e00\u4e2aj,\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u4e86x[j],y[j]\u3002\n\u5c06\u5b83\u770b\u4f5c\u4e00\u4e2a\u70b9\uff0c\u6240\u6709\u7684j\u6784\u6210\u4e00\u4e2a\u70b9\u96c6\uff0c\u6a2a\u5750\u6807x[j],\u7eb5\u5750\u6807y[j]\n\n\u800c\u5bf9\u4e8e\u7ed9\u5b9a\u7684i\uff0c2a[i]\u662f\u4e00\u4e2a\u5b9a\u503c\uff0c\u770b\u505a\u659c\u7387\uff0c\u800c\u76ee\u6807f[i]\u5219\u662f\u622a\u8ddd\uff0c\u6240\u4ee5\u8981\u5728j\u7684\u70b9\u96c6\u4e4b\u4e2d\u627e\u5230\u4e00\u4e2a\u70b9\u4f7f\u5f97\u8fd9\u6761\u76f4\u7ebf\u622a\u8ddd\u6700\u5c0f\uff0c\u672c\u8d28\u662f\u5c06y=2a[i]x\u7684\u76f4\u7ebf\u5e73\u79fb\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e9b\u6700\u4f18\u89e3\u7684\u70b9\u5fc5\u5b9a\u5728\u8fb9\u754c\u4e0a\u3002\u5e76\u4e14\u53d1\u73b0\uff0c\u659c\u7387\u662f\u5355\u589e\u7684\uff0c\u800cx\u4e00\u5b9a\u4e5f\u662f\u5355\u589e\u7684\u3002\u6240\u4ee5\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u5de6\u4e0a\u4e0b\u51f8\u58f3\u3002\n\n\u56e0\u4e3a\u659c\u7387\u5355\u589e\uff0c\u6240\u4ee5\u82e5\u4e00\u4e2a\u70b9\u6b64\u65f6\u4e0d\u662f\u6700\u4f18\u89e3\uff0c\u90a3\u4e48\u4ee5\u540e\u4e00\u5b9a\u4e5f\u4e0d\u662f\u6700\u4f18\u89e3\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece\u5934pass\u6389\uff1b\u6bcf\u6b21\u65b0\u589e\u4e00\u4e2a\u70b9\uff0c\u90fd\u8981\u4fdd\u8bc1\u8fd9\u662f\u4e00\u4e2a\u51f8\u5305\uff0c\u901a\u8fc7\u659c\u7387\u8981\u6765\u4ece\u5c3epass\u6389\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\uff01\u5355\u8c03\uff0c\u5728\u8fd9\u91cc\u662f\u6307\u961f\u5217\u4e2d\u7684\u5143\u7d20\uff0c\u6bcf\u76f8\u90bb\u4e24\u4e2a\u5143\u7d20\u6240\u4ee3\u8868\u7684\u70b9\u8fde\u6210\u7684\u7ebf\uff0c\u5176\u659c\u7387\u662f\u5355\u8c03\u9012\u589e\u7684\u3002\u56e0\u4e3a\u659c\u7387\u90fd\u662f\u6b63\u6570\uff0c\u6240\u4ee5\u4e5f\u5c31\u662f\u753b\u51fa\u6765\u662f\u4e00\u4e2a\u5de6\u4e0a\u51f8\u5305\u3002\n\n\u6ce8\u610f\uff0c**\u961f\u5217\u4e2d\u81f3\u5c11\u8981\u6709\u4e00\u4e2a0\u53f7\u5143\u7d20\u4e0d\u80fd\u51fa\u961f**\uff01\u8fd9\u91cc\u7b2c\u4e00\u4e2a\u7a7a\u4f4d\u7f6e\u662f\u6709\u610f\u4e49\u7684\u3002\u5426\u5219\u5c31\u4e0d\u5b58\u5728\u7ebf\u548c\u659c\u7387\u4e86\u3002\u6240\u4ee5\u624b\u5199\u961f\u5217\u65f6\uff0c\u5f00\u59cbhd=tl=0,while\u5224\u65ad\u4e2dhd<tl \u4fdd\u8bc1\u4e00\u5b9a\u81f3\u5c11\u6709\u4e00\u4e2a\u5143\u7d20\uff0c\u5e76\u4e14\u8fd9\u4e2a\u5143\u7d20\u4e0d\u4f1a\u88ab\u5176\u4ed6\u5143\u7d20\u66ff\u4ee3\u3002\u8be6\u89c1\u4ee3\u7801\u3002\n\n##### \u5177\u4f53\u6b65\u9aa4\uff1a\n\n1.\u524d\u7f00\u548c\u9884\u5904\u7406\n\n2.\u5faa\u73afi\uff0c\u5148\u5220\u9664\u961f\u9996\uff0c\u518d\u66f4\u65b0\u7b54\u6848\uff0c\u518d\u66f4\u65b0\u961f\u5217\u3002\n\n3.\u8f93\u51faf[n] GAME OVER\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define ll long long \nusing namespace std;\nconst int N=50000+10;\nint n,L;\nlong long f[N];\nlong long sum[N];\nint q[N],hd,tl;\nlong long a(int i)\n{\n\treturn sum[i]+i;\n}\nlong long x(int i)\n{\n\treturn sum[i]+i+L+1;\n}\nlong long y(int i)\n{\n\treturn x(i)*x(i)+f[i];\n}\ndouble slope(int a,int b)\n{\n\treturn\t((double)y(b)-y(a))/((double)x(b)-x(a));\n}//\u4e00\u5806\u51fd\u6570\nint t;\nint main()\n{\n\tscanf(\"%d%d\",&n,&L);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d\",&t);\n\t    sum[i]=sum[i-1]+t;\n\t}\n\thd=0,tl=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(hd<tl&&slope(q[hd],q[hd+1])<2*a(i)) hd++;//\u5220\u9664\n\t\tf[i]=y(q[hd])-2*a(i)*x(q[hd])+a(i)*a(i);\n\t\twhile(hd<tl&&slope(q[tl-1],q[tl])>slope(q[tl-1],i)) tl--;\n\t\tq[++tl]=i;//\u66f4\u65b0\n\t}\n\tprintf(\"%lld\",f[n]);\n\treturn 0;\n}\n```\n\n#### \u603b\u7ed3\uff1a\n\n1.\u4e00\u4e2a\u9898\u80fd\u7528\u659c\u7387\u4f18\u5316\uff0c\u5fc5\u7136\u80fd\u51fa\u73b0y=kx+b \u7ebf\u6027\u5f62\u5f0f\uff0c\u5176\u4e2dk\u662f\u5b9a\u503c\uff0cx\uff0cy\u6784\u6210\u70b9\u96c6\uff0cb\u662f\u76ee\u6807\u503c\u3002\n\n2.\u4e00\u4e2a\u51f8\u5305\u80fd\u7528\u5355\u8c03\u961f\u5217\u4f18\u5316\u7684\u6761\u4ef6\u5e94\u8be5\u6ee1\u8db3\uff1a\n \n \uff081\uff09\u67e5\u8be2\u7684\u659c\u7387\u5355\u8c03\n \uff082\uff09\u63d2\u5165\u7684\u70b9\u6a2a\u5750\u6807\u6709\u5355\u8c03\u6027\n  \uff08\u5426\u5219\u8981\u7528\u5e73\u8861\u6811\u3001set\uff09",
        "postTime": 1524802101,
        "uid": 56672,
        "name": "\u67ab\u6797\u665a",
        "ccfLevel": 9,
        "title": "P3195 \u73a9\u5177\u88c5\u7bb1TOY"
    },
    {
        "content": "# \u4e00\u5b9a\u8981\u5f00longlong\uff01\n\n\u975e\u5e38\u9002\u5408\u5165\u624b\u659c\u7387\u4f18\u5316\u7684\u6a21\u677f\u9898\n\nn^2\u66b4\u529b\u65b9\u7a0b//\u8fd9\u91ccc[i]\u662f\u524d\u7f00\u548c\n\n**dp\\[i]=dp\\[j]+(i-j+1+c[i]-c[j]+l)^2**\n\n\u4ee4f\\[i]=c\\[i]+i-1-l,g\\[i]=c\\[i]+i\n\n**dp\\[i]=dp\\[j]+(f\\[i]-g\\[j])^2**\n\n**dp\\[i]=dp\\[j]+f\\[i]^2+g\\[j]^2-2\\*f\\[i]\\*g\\[j]**\n\n\u4ee4h\\[i]=g\\[i]^2+dp\\[i]\n\n**h[j]=2\\*f\\[i]\\*g\\[j]+dp\\[i]**\n\n\u53d1\u73b0\u5bf9\u4e8e\u6bcf\u4e00\u4e2ai\u6765\u8bb2\uff0c\u8f6c\u79fb\u7684\u8fc7\u7a0b\u5b9e\u9645\u4e0a\u662f\n\n\u5bfb\u627e\u4e00\u4e2a\u70b9(g\\[j],h\\[j])\u4f7f\u5f97\u8fc7\u8fd9\u4e2a\u70b9\u505a\u659c\u7387\u4e3a2\\*f\\[i]\u7684\u76f4\u7ebf\u622a\u8ddd\u6700\u5c0f\n\n\u8fd9\u91cc\u6709\u4e00\u4e2a\u795e\u5947\u7684\u6027\u8d28\uff0c\u8fd9\u4e2a\u70b9\u4e00\u5b9a\u5728\u5df2\u77e5\u70b9\u96c6\u7684\u51f8\u5305\u4e0a\n\n**//\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u8fd9\u79cd\u4f18\u5316\u65b9\u6cd5\u88ab\u79f0\u4e3a\u659c\u7387\u4f18\u5316**\n\n\u7136\u540e\u53c8\u53d1\u73b0g[i],h[i]\u90fd\u662f\u5355\u8c03\u7684\n\n\u9009\u62e9\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u51f8\u5305\uff0c\u6bcf\u6b21\u68c0\u67e5\u961f\u5c3e\u7684\u5f62\u72b6\u662f\u5426\u51f9\u8fdb\u53bb\n\n\u659c\u7387\u6700\u5c0f\u7684\u70b9\u4e00\u5b9a\u5728\u961f\u5934\uff0c\u6bcf\u6b21\u53d6\u6700\u5c0f\u503c\u7684\u65f6\u5019pop\u81f3\u659c\u7387\u7b2c\u4e00\u6b21\u5927\u4e8e\u961f\u5934\u5373\u53ef\n\n\u4e0a\u4ee3\u7801~\n\n\n\n\n```cpp\n    #include<cstdio>\n    #include<algorithm>\n    using namespace std;//\u4e00\u5b9a\u8981\u5f00longlong\uff01\n    typedef double db;long long c[500010];\n    int n;int l;long long dp[500010];long long f[500010];\n    long long g[500010];long long h[500010];\n    int dq[500010];int head;int tail;//\u624b\u5199\u53cc\u7aef\u961f\u5217\n    inline bool empty(){return head>=tail;}\n    inline void push(int x){dq[++tail]=x;}\n    inline void pop(){head++;}\n    inline void pot(){tail--;}\n    inline db calck(int p1,int p2)//\u8ba1\u7b97\u659c\u7387\n    {return ((db)h[p1]-(db)h[p2])/((db)g[p1]-(db)g[p2]);}\n    int main()\n    {\n        scanf(\"%d%d\",&n,&l);\n        for(int i=1;i<=n;i++)\n        {scanf(\"%d\",&c[i]);c[i]+=c[i-1];}//\u524d\u7f00\u548c\n        for(int i=1;i<=n;i++)\n        {\n            f[i]=c[i]+i-1-l;g[i]=c[i]+i;//\u8ba1\u7b97f,g\n            while(!empty()&&(db)2*f[i]>=calck(dq[head],dq[head+1]))pop();\n            dp[i]=dp[dq[head]]+(f[i]-g[dq[head]])*(f[i]-g[dq[head]]);//\u8f6c\u79fb\n            h[i]=g[i]*g[i]+dp[i];//\u8ba1\u7b97h\n            while(!empty()&&calck(dq[tail-1],dq[tail])>=calck(dq[tail],i))pot();\n            push(i);//\u63d2\u5165\u70b9\n        }\n        printf(\"%lld\",dp[n]);return 0;\n    }\n\n```",
        "postTime": 1514280889,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "\u6765\u81ea\u6211\u7684\u535a\u5ba2\uff1ahttp://blog.csdn.net/YihAN\\_Z/article/details/65449992\n\n\u8fd9\u91cc\u7528\u4e00\u4e2a\u4e0e\u697c\u4e0b\u4e0d\u540c\u7684\u659c\u7387\u4f18\u5316\u65b9\u6cd5\n\n\u8bbe\u72b6\u6001f(i)\u8868\u793a\u5c06\u524di\u4e2a\u73a9\u5177\u88c5\u7bb1\u540e\u7684\u6700\u5c0f\u8d39\u7528\uff0csum(i)\u8868\u793a\u524di\u4e2a\u73a9\u5177\u7684\u957f\u5ea6(c\u503c)\u548c\n\n\u6613\u5f97\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n\n![\u8fd9\u91cc\u5199\u56fe\u7247\u63cf\u8ff0](http://img.blog.csdn.net/20170324085548517?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWWloQU5fWg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n\u5176\u4e2d  0 < j < i\n\n\u4e3a\u4e86\u7b80\u5316\u5f0f\u5b50\uff0c\u8bb0![\u8fd9\u91cc\u5199\u56fe\u7247\u63cf\u8ff0](http://img.blog.csdn.net/20170324085707392?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWWloQU5fWg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n\u5c06\u4e0a\u5f0f\u4ee3\u5165\uff0c\u5f00\u65b9[^1]\n\n\u5219\u5bf9\u4e8e\u6240\u6709\u53ef\u80fd\u7684![\u8fd9\u91cc\u5199\u56fe\u7247\u63cf\u8ff0](http://img.blog.csdn.net/20170324090319479?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWWloQU5fWg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n![\u8fd9\u91cc\u5199\u56fe\u7247\u63cf\u8ff0](http://img.blog.csdn.net/20170324090514521?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWWloQU5fWg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n\u8bb0![\u8fd9\u91cc\u5199\u56fe\u7247\u63cf\u8ff0](http://img.blog.csdn.net/20170324090809304?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWWloQU5fWg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)[^2]\n\n\u5c06\u4e0a\u5f0f\u79fb\u9879\u540e\u4ee3\u5165\uff0c\u5f97\u5230![\u8fd9\u91cc\u5199\u56fe\u7247\u63cf\u8ff0](http://img.blog.csdn.net/20170324091241757?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWWloQU5fWg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n\u73b0\u5728\u8981\u4f7fb\u6700\u5c0f\uff0ck\u4e0d\u53d8\uff0c\u82e5\u56fa\u5b9ax\uff0c\u5219y\u8d8a\u5c0f\uff0cb\u8d8a\u5c0f\uff0c\u6240\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u58f3\u3002\n\n\u53ef\u4ee5\u770b\u51fax\u4e0e\u67e5\u8be2\u659c\u7387k\u5747\u5355\u8c03\u9012\u589e\uff0c\u7ef4\u62a4\u4e00\u4e2a\u6709\u5173\u659c\u7387\u7684\u5355\u8c03\u961f\u5217\u5373\u53ef\u3002\n\n```cpp\n#include <cstdio>\n#define N 50005\nusing namespace std;\ntypedef long long LL;\nconst double INF=1e10;\ninline LL sq(LL x) { return x*x; }\nstruct Point {\n    LL x,y;\n    Point() {}\n    Point(LL _x,LL _y):x(_x),y(_y) {}\n    double operator ^ (const Point& rhs) const {///get_slope\n        if(x==rhs.x) return y>rhs.y ? -INF : INF;\n        return (double)(rhs.y-y)/(rhs.x-x);\n    }\n}q[N];\nint n,l=1,r;\nLL L,f[N],sum[N];\nLL get_ans(LL k) {\n    while(l<r && (q[l]^q[l+1])<k) l++;\n    return q[l].y-k*q[l].x;\n}\nvoid Insert(Point o) {\n    while(l<r && (q[r-1]^q[r])>(q[r-1]^o)) r--;\n    q[++r]=o;\n    return ;\n}\nint main() {\n    scanf(\"%d%lld\",&n,&L); L++;\n    for(int i=1;i<=n;i++) scanf(\"%lld\",sum+i), sum[i]+=sum[i-1]+1;\n    //DP\n    q[++r]=Point(0,0);\n    for(int i=1;i<=n;i++) {\n        f[i]=get_ans(2*(sum[i]-L))+sq(sum[i]-L);\n        Insert(Point(sum[i],sum[i]*sum[i]+f[i]));\n    }\n\n    printf(\"%lld\\n\",f[n]);\n    return 0;\n}\n\n```\n\n[^1]: \u56e0\u4e3a\u8981\u8ba1\u7b97f(i)\uff0c\u56fa\u5b9ai\uff0c\u6709\u5173\u4e8ei\u7684\u91cf\u5747\u4e3a\u5df2\u77e5\u91cf\u3002\u5c06\u5df2\u77e5\u91cf\u4e0e\u5e38\u91cf\u653e\u5728\u4e00\u8d77\u5f00\u65b9\u3002\n\n\n[^2]:\u56e0\u4e3a\u8981\u659c\u7387\u4f18\u5316\uff0c\u6240\u4ee5\u5c06f(i)\u548c\u5e38\u91cf(\u5df2\u77e5\u91cf)\u653e\u5230b\u4e2d\uff1b\u6709\u5173j\u4e0e\u6709\u5173i\u7684\u4e58\u79ef\u7684\u9879\u4e2d\uff0c\u5c06\u6709\u5173i\u7684\u53d8\u91cf\u548c\u5e38\u91cf\u770b\u505a\u659c\u7387k\uff0c\u6709\u5173j\u7684\u53d8\u91cf\u770b\u505ax\uff1b\u5176\u4f59\u53ea\u542b\u6709\u6709\u5173j\u7684\u91cf\u7684\u9879\u770b\u505ay\n",
        "postTime": 1490940907,
        "uid": 20558,
        "name": "zyh2015",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    },
    {
        "content": "\u9996\u5148\u5c31\u5199\u4e86\u4e00\u4e2a\u5927\u66b4\u529b\uff1a\n\n\u5b9a\u4e49f[i]\u4e3a\u5df2\u7ecf\u5206\u914d\u4e86i\u4e2a\u73a9\u5177\u65f6\u7684\u6700\u5c0f\u8d39\u7528\u3002\n\n\u65b9\u7a0b\u5bb9\u6613\u5199\u51fa:\n\nf[i] = f[j] + w[j][i];\n\n\u5176\u4e2d$w[j][i] = (sum_i - sum_j + i - (j+1) - l ) ^ 2$\n\n\u660e\u663e\u5730\uff0c\u8fd9\u662f\u4e00\u4e2aO(n2)\u7684\u7b97\u6cd5\uff0c\u53ea\u80fd\u5f97\u5230\u9898\u76ee30\u7684\u5206\u6570\u3002\n\n\u6240\u4ee5\u6211\u4eec\u4e0a\u659c\u7387\u4f18\u5316\u3002\n\n\u9996\u5148\u6211\u4eec\u5206\u6790\u590d\u6742\u5ea6:\u72b6\u6001\u4e3aO(n)\uff0c\u8f6c\u79fb\u4e3aO(n)\n\n\u72b6\u6001\u5df2\u7ecf\u53ef\u4ee5\u8ba4\u4e3a\u65e0\u6cd5\u7ee7\u7eed\u4f18\u5316\u4e86\uff08\u9664\u975e\u4f7f\u7528\u5176\u4ed6\u7b97\u6cd5\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u4f18\u5316\u8f6c\u79fb\u3002\n\n\u66fe\u7ecf\u6211\u4eec\u505a\u8fc7\u5f88\u591a\u9898\u76ee\uff0c\u53ef\u4ee5\u4f7f\u7528\u5355\u8c03\u961f\u5217\u6765\u83b7\u5f97\u5747\u644aO(1)\u7684\u8f6c\u79fb\u590d\u6742\u5ea6\uff0c\u8fd9\u91cc\u4e5f\u662f\u7c7b\u4f3c\u601d\u8def\u3002\n\n\u7ecf\u8fc7\u4e00\u4e9b\u63a8\u5bfc\uff08\u8fd9\u91cc\u7565\u53bb\uff0chttp://medalplus.com/?p=1751#Solution\u5199\u7684\u5f88\u4e0d\u9519\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u51b3\u7b56i\u6bd4\u51b3\u7b56j\u4f18\u5f53\u4e14\u4ec5\u5f53(i>j)\n\n$$\\frac{f[j]-f[k]+(G[j]+M)^2-(G[k]+M)^2}{2(G[j]-G[k])} < G(x)$$\n\n\u5176\u4e2d\uff0cG[i] = S[i] + i, \u5e38\u6570M = 1 + l, S[i] = S[i-1]+C[i]\uff0cx\u662f\u5f53\u524d\u9700\u8981\u8fdb\u884c\u51b3\u7b56\u7684\u70b9.\n\n\u6839\u636eG[x]\u7684\u5b9a\u4e49\uff0c\u53ef\u4ee5\u77e5\u9053G[x]\u662f\u5355\u8c03\u9012\u589e\u7684\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8bc1\u660e\u8fd9\u6837\u4e24\u4e2a\u6027\u8d28\uff1a\n\n\u6027\u8d28\u4e00\uff1a\n\n\u5982\u679c\u6211\u4eec\u628a\u6bcf\u4e00\u4e2a\u72b6\u6001\u62bd\u8c61\u6210\u4e00\u4e2a\u70b9\uff0c\u90a3\u4e48\u539f\u5f0f\u53ef\u4ee5\u770b\u4f5ci\u5230j\u8fde\u7ebf\u7684\u659c\u7387\u3002\n\n\u6211\u4eec\u8bf4\uff1a\u5bf9\u4e8e\u4e00\u4e2a\u51b3\u7b56x\uff0c\u5176\u6700\u4f18\u51b3\u7b56\u4e00\u5b9a\u5728x\u51b3\u7b56\u524d\u9762\u7684\u51b3\u7b56\u7684\u70b9\u8fde\u6210\u7684\u4e00\u4e2a\u4e0b\u51f8\u5305\u4e0a\u3002\n\n\u5bf9\u4e8e\u8fd9\u4e2a\u7ed3\u8bba\uff1a\n\n\u8003\u8651\u6709\u4e00\u4e2a\u8981\u52a0\u5165\u7684\u70b9k>j, \u4e14k[j-1][j] > k[j][k]\n\n\u56e0\u4e3aj\u70b9\u5df2\u7ecf\u5728\u8fd9\u4e2a\u4e0b\u51f8\u5305\u4e0a\uff0c\u6240\u4ee5j\u4e00\u5b9a\u6bd4j-1\u66f4\u4f18\uff0c\u6240\u4ee5k[j-1][j] < G[x]\n\n\u53c8\u56e0\u4e3ak[j][k] < k[j-1][j]\uff0c\n\n\u6240\u4ee5k[j][k] < G[x]\n\n\u6240\u4ee5k\u6bd4j\u66f4\u4f18\n\n\u6240\u4ee5\u6211\u4eec\u628aj\u70b9\u820d\u5f03\uff0c\u5728\u64cd\u4f5c\u4e2d\u5c31\u662f\u4ece\u5c3e\u7aef\u5f39\u51fa\u53cc\u7aef\u961f\u5217\u3002\n\n\u76f4\u63a5\u628aj-1\u70b9\u8fde\u4e0ak\u5373\u53ef\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u8bc1\u660e\u4e86\u6027\u8d28\u4e00\u3002\n\n\u6027\u8d28\u4e8c\uff1a\n\n\u56e0\u4e3aG[x]\u5355\u8c03\u9012\u589e\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4ece\u524d\u5411\u540e\u5f39\u51fa\u6700\u524d\u7aef\u5143\u7d20\u6765\u4fdd\u8bc1k[head][head+1] > G[i]\n\n\u8fd9\u65f6k[head]\u4e00\u5b9a\u662f\u6700\u4f18\u7684\u3002\n\n\u6839\u636e\u5b9a\u4e49\u4e0d\u96be\u5f97\u51fa\u8fd9\u4e2a\u7ed3\u8bba\u3002\n\n\u5728\u4e24\u4e2a\u6027\u8d28\u7684\u63a8\u5bfc\u4e2d\uff0c\u6211\u4eec\u4e5f\u5f97\u5230\u4e86\u7ef4\u62a4\u4e0b\u51f8\u5305\u7684\u65b9\u6cd5\uff0c\u5177\u4f53\u8be6\u89c1\u4ee3\u7801\u3002\n\n\u4e0b\u9762\u662f\u4ee3\u7801\u3002\n\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long \nusing namespace std;\nconst int maxn = 50005;\nll n, l;\nll f[maxn];\nll c[maxn], s[maxn], g[maxn];\nll pow(ll n) {return n*n;}\nll que[maxn];\nint alpha;\nint head, tail, size;\ndouble calck(int a, int b) {\n    return (double)(f[b]-f[a]+pow(g[b]+alpha)-pow(g[a]+alpha))/(double)(2*(g[b]-g[a]));\n}\nint main() {\n    scanf(\"%d %d\", &n, &l);\n    alpha = l+1;\n    s[0] = 0;\n    for(int i = 1; i <= n; i++) {\n       scanf(\"%d\", &c[i]); \n       s[i] = s[i-1] + c[i];\n       g[i] = s[i] + i; \n    }\n    f[0] = 0;\n    head = 1;\n    tail = 1;\n    size = 1;\n    que[head] = 0;\n    for(int i = 1; i <= n; i++) {\n        while(size >= 2) {\n            int a = que[head];\n            int b = que[head+1];\n            if(calck(a, b) < g[i]) {\n                head++;\n                size--;\n            }\n            else break;\n        }   \n        int n = que[head];\n        f[i] = f[n]+pow(s[i]-s[n]+i-n-1-l);\n        if(size>=2){int x = que[tail];\n        int y = que[tail-1];\n        while(calck(x, i) < calck(y, x)) {\n            tail--;\n            size--;\n            if(size < 2) break;\n            x = que[tail];\n            y = que[tail-1];\n        }}\n        tail++;\n        que[tail] = i;\n        size++;\n    } \n    //for(int i = 1; i <= n; i++) cout << f[i] << ' ';\n    //cout << endl;\n    printf(\"%lld\\n\", f[n]);\n}\n```\n\u6b22\u8fce\u8bbf\u95ee[\u6211\u7684\u535a\u5ba2](http://www.cnblogs.com/gengchen/p/6340921.html)\n",
        "postTime": 1489893877,
        "uid": 7429,
        "name": "MrMorning",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3195 \u3010[HNOI2008]\u73a9\u5177\u88c5\u7bb1TOY\u3011"
    }
]