[
    {
        "content": "\u795e\u4e00\u822c\u7684\u9898\u2026\u2026\n\n\u7ecf\u8fc7\u4e86\u4e00\u6574\u5929\u7684\u51a5\u601d\u82e6\u60f3\uff0c\u7ec8\u4e8eAC\u4e86\u3002\n\n\u4e0b\u9762\u662f\u601d\u8def\uff1a\uff0899.9%\u90fd\u662f\u81ea\u5df1\u60f3\u4e0d\u51fa\u6765\uff0c\u8001\u5e08\u544a\u8bc9\u6211\u7684\uff09\n\n1\u3001\u8054\u5408\u7684\u4e24\u4e2a\u8282\u70b9\u8ddd\u79bb\u4e3a\u4e8c\uff0c\u6240\u4ee5\u5fc5\u5b9a\u6709\u4e00\u4e2a\u4e2d\u8f6c\u70b9\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u6bcf\u4e00\u4e2a\u4e2d\u8f6c\u70b9\u3002\uff08\u9707\u60ca\uff01\uff01\uff01\uff09\n\n2\u3001\u5047\u8bbe\u6bcf\u4e2a\u4e2d\u8f6c\u70b9\u5468\u56f4\u6709\u4e24\u4e2a\u70b9\uff0c\u6743\u503c\u5206\u522b\u4e3aa\u3001b\uff0c\u5219\u8054\u5408\u6743\u503c\u4e3a2ab=(a+b)^2-(a^2+b^2)\u3002\n\n3\u3001\u82e5\u6709\u4e09\u4e2a\u70b9\uff0c\u6743\u503c\u5206\u522b\u4e3aa\u3001b\u3001c\uff0c\u5219\u8054\u5408\u6743\u503c\u4e3a2ab+2bc+2ac=(a+b+c)^2-(a^2+b^2+c^2)\u3002\n\n4\u3001\u7efc\u4e0a\uff0c\u4ee5\u67d0\u4e2a\u8282\u70b9\u4e3a\u4e2d\u8f6c\u70b9\u7684\u8054\u5408\u6743\u503c\u4e4b\u548c\u7b49\u4e8e\u6743\u503c\u548c\u7684\u5e73\u65b9\u51cf\u53bb\u6743\u503c\u7684\u5e73\u65b9\u548c\u3002\uff08+1\uff01\uff01\uff01\uff01\uff01\uff09\n\n5\u3001\u4e3a\u4e86\u627e\u5230\u6700\u5927\u7684\u8054\u5408\u6743\u503c\uff0c\u53ea\u9700\u627e\u5230\u5468\u56f4\u6700\u5927\u7684\u4e24\u4e2a\u6743\u503cmax1\uff0cmax2\uff0c\u76f8\u4e58\u5224\u65ad\u5373\u53ef\u3002\n\n\u6ce8\u610f\uff1a\u867d\u7136\u9898\u76ee\u8ba9%10007\uff0c\u4f46\u6700\u5927\u8054\u5408\u6743\u503c\u662f\u4e0d\u80fd%10007\u7684\uff01\uff01\uff01\uff0840\u5206WA\u7684\u770b\u8fd9\u91cc\uff01\uff01\uff09\n\n\u4e0b\u9762\u662f\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\nusing namespace std;\nstruct edge\n{\n    int next;\n    int to;\n}a[400005];\nint edgenum,head[200005],w[200005];\nint n,ans,maxx;\nvoid add(int u,int v)//\u52a0\u5165\u4e00\u6761\u4eceu\u5230v\u7684\u8fb9\n{\n    a[++edgenum].next=head[u];\n    a[edgenum].to=v;\n    head[u]=edgenum;\n}\nint main()\n{\n    scanf(\"%d\",&n);\n    for(int i=1;i<n;i++)\n    {\n        int u,v;\n        scanf(\"%d%d\",&u,&v);\n        add(u,v);\n        add(v,u);\n    }\n    for(int i=1;i<=n;i++)\n      scanf(\"%d\",&w[i]);\n    for(int i=1;i<=n;i++)\n    {\n        int max1=0,max2=0;//\u6700\u5927\u7684\u4e24\u4e2a\u6743\u503c\n        int t1=0,t2=0;//t1\u4ee3\u8868\u548c\u7684\u5e73\u65b9\uff0ct2\u4ee3\u8868\u5e73\u65b9\u548c\n        for(int j=head[i];j;j=a[j].next)\n        {\n            if(w[a[j].to]>max1)max2=max1,max1=w[a[j].to];\n            else if(w[a[j].to]>max2)max2=w[a[j].to];\n            t1=(t1+w[a[j].to])%10007;\n            t2=(t2+w[a[j].to]*w[a[j].to])%10007;\n        }\n        t1=t1*t1%10007;\n        ans=(ans+t1+10007-t2)%10007;\n        if(maxx<max1*max2)maxx=max1*max2;\n    }\n    printf(\"%d %d\\n\",maxx,ans);\n    return 0;\n}\n```",
        "postTime": 1508148321,
        "uid": 54214,
        "name": "wucstdio",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u7ec8\u4e8e\u8fc7\u4e86\u8fd9\u4e00\u9898\u3002\uff08\u5b9e\u9645\u4e0a\u53ea\u6709\u4e00\u6b21\u63d0\u4ea4\u2026\u2026\uff09\n\n\u6b64\u9898\u5176\u5b9e\u8fd8\u662f\u633a\u5de7\u5999\u7684\u3002\u601d\u8def\u6211\u60f3\u4e86\u534a\u5929\u624d\u60f3\u51fa\u6765\uff0c\u8981\u662f\u5728\u8003\u573a\u76f4\u63a5\u6253\u7684\u8bdd\uff0c\u672a\u5fc5\u80fd\u591f\u6253\u7684\u51fa\u6765\u3002\n\n\u9996\u5148\uff0c\u6b64\u9898\u8bf4\u7684\u6bd4\u8f83\u7684\u9690\u6666\u3002\u6240\u8c13\u7684\u6709n-1\u6761\u8fb9\uff0cn\u4e2a\u70b9\u7684\u65e0\u76f8\u8fde\u901a\u56fe\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u9897\u65e0\u6839\u6811\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6ca1\u6709\u4e00\u4e2a\u73af\u3002\u6240\u4ee5\uff0c\u8981\u662f\u4e24\u4e2a\u70b9\u540c\u4e8e\u53e6\u4e00\u4e2a\u70b9\u76f8\u8fde\uff0c\u5219\u5b83\u4eec\u4e0d\u53ef\u80fd\u518d\u6709\u8fb9\u76f8\u8fde\uff0c\u5373\u5b83\u4eec\u4e4b\u95f4\u7684\u8ddd\u79bb\u4e3a2.\n\n\u4e8e\u662f\uff0c\u601d\u8def\u5c31\u9690\u9690\u51fa\u6765\u4e86\uff1a\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u53d6\u5176\u4efb\u610f\u4e24\u4e2a\u70b9\uff0c\u7136\u540e\u8fdb\u884c\u7ec4\u5408\uff0c\u7136\u540e\u4e24\u4e24\u76f8\u4e58\uff0c\u5f97\u5230\u6700\u5927\u503c\u4e0e\u4ed6\u4eec\u7684\u548c\u3002\u5c06\u6240\u6709\u503c\u7edf\u8ba1\u4e00\u4e0b\uff0c\u7136\u540e\u6ce8\u610f\u56e0\u4e3a\u548c\u662f\u7ec4\u5408\u51fa\u6765\u7684\uff0c\u6240\u4ee5\u518d\u4e582\uff0c\u8f93\u51fa\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u8fd9\u91cc\u5148\u7533\u660e\u4e00\u4e2a\u5751\u70b9\uff1a\u9898\u76ee\u53ea\u8bf4\u4e86\u5bf9\u548c\u53d6\u6a21\uff0c\u6ca1\u6709\u8bf4\u5bf9\u6700\u5927\u503c\u53d6\u6a21\uff0c\u6240\u4ee5\u8981\u6ce8\u610f\uff0c\u5982\u679c\u5bf9\u6700\u5927\u503c\u53d6\u6a21\u5c31\u9519\u4e86\u3002\n\n\u7136\u540e\u5c31\u662f\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u7684\u95ee\u9898\u4e86\u3002\u5982\u679c\u76f4\u63a5\u7ec4\u5408\uff0c\u5219n^2\u590d\u6742\u5ea6\u4f1aTLE\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e58\u6cd5\u7ed3\u5408\u5f8b\u548c\u524d\u7f00\u548c\u7684\u601d\u60f3\u3002\u5bf9\u4e8e\u4e00\u4e2a\u70b9\uff0c\u56e0\u4e3a\u7528\u90bb\u63a5\u8868\u5b58\u50a8\uff0c\u6240\u4ee5\u7ebf\u6027\u626b\u8fc7\u6240\u6709\u4e0e\u4ed6\u76f8\u8fde\u7684\u70b9\uff0c\u7136\u540e\u52a8\u6001\u66f4\u65b0\u76ee\u524d\u7684\u548c\u4e0e\u76ee\u524d\u8fd9\u4e9b\u70b9\u4e2d\u7684\u6700\u5927\u503c\uff0c\u7136\u540e\u518d\u5230\u4e0b\u4e00\u4e2a\u70b9\u65f6\uff0c\u5c06\u4e0b\u4e00\u4e2a\u70b9\u7684\u6743\u503c\u4e0e\u8fd9\u4e24\u4e2a\u503c\u76f8\u4e58\uff0c\u7136\u540e\u505a\u76f8\u5e94\u7684\u5904\u7406\u5c31\u884c\u4e86\u3002\u7c7b\u4f3c\u4e8eDP\u3002\n\n\u518d\u6ce8\u610f\u4e00\u4e0b\u7ec6\u8282\uff0c\u6b64\u9898\u4fbf\u505a\u5b8c\u4e86\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff08\u4e0d\u523050\u884c\uff0c\u8d85\u7b80\u6d01~\uff09\uff1a\n\n```cpp\n#include<cstdio>\n#include<cmath>\nusing namespace std;\nstruct Edge\n{\n    int t,nexty;\n    Edge(){t=nexty=0;}\n}edge[1000000];//\u94fe\u5f0f\u524d\u5411\u661f\u90bb\u63a5\u8868\nint head[300000]={0},cnt=0;//\u94fe\u5f0f\u524d\u5411\u661f\u94fe\u8868\u53d8\u91cf\nvoid add(int a,int b)//\u52a0\u8fb9\n{\n    cnt++;\n    edge[cnt].t=b,edge[cnt].nexty=head[a];\n    head[a]=cnt;//\u52a0\u8fb9\u8fc7\u7a0b\uff08\u5982\u679c\u4e0d\u61c2\u94fe\u5f0f\u524d\u5411\u661f\uff0c\u53ef\u4ee5\u767e\u5ea6\u4e00\u4e0b\uff09\n}\nlong long w[300000]={0};//\u6bcf\u4e2a\u70b9\u7684\u6743\u503c\nint main()\n{\n    int n;\n    scanf(\"%d\",&n);\n    int a,b;\n    for(int i=0;i<n-1;i++)\n    {\n        scanf(\"%d%d\",&a,&b);\n        add(a,b),add(b,a);//\u52a0\u8fb9\n    }\n    for(int i=1;i<=n;i++)scanf(\"%lld\",&w[i]);//\u8bfb\u5165\u6743\u503c\n    long long sum=0,maxn=0;//\u5168\u5c40\u7684\u548c\uff0c\u6700\u5927\u503c\n    long long he,rmax;//\u4e00\u6bb5\u7684\u548c\u4e0e\u4e00\u6bb5\u7684\u6700\u5927\u503c\n    int node;\n    for(int i=1;i<=n;i++)\n    {\n        node=head[i];//\u7b2c\u4e00\u4e2a\u5143\u7d20\n        he=(rmax=w[edge[node].t])%10007;//\u5f97\u5230\u521d\u59cb\u503c\n        node=edge[node].nexty;//\u4e0b\u4e00\u4e2a\n        for(;node!=0;node=edge[node].nexty)//\u679a\u4e3e\u4e0e\u4e4b\u76f8\u8fde\u7684\u70b9\n        {\n            sum=(sum+he*w[edge[node].t])%10007;//\u4e58\u6cd5\u7ed3\u5408\u5f8b\n            maxn=max(maxn,rmax*w[edge[node].t]);//\u8d2a\u5fc3\uff0c\u53d6\u6700\u5927\u503c\n            he=(he+w[edge[node].t])%10007;\n            rmax=max(rmax,w[edge[node].t]);//\u66f4\u65b0\n        }\n    }\n    printf(\"%lld %lld\",maxn,(sum*2)%10007);//\u8bb0\u5f97*2\n    return 0;\n}\n```",
        "postTime": 1506852344,
        "uid": 32275,
        "name": "KesdiaelKen",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u4e00\u9053\u5f88\u6c34\u7684\u6811\u5f62DP\u2026\u20262\u5206\u949f\u51fa\u601d\u8def\uff0c10\u5206\u949f\u51fa\u4ee3\u7801\u2026\u2026\n\n\n\u5f88\u5bb9\u6613\u53d1\u73b0\uff0c\u8fd9\u4e2a\u56fe\u5176\u5b9e\u662f\u4e00\u68f5\u6811\uff08\u8fd9\u770b\u4e0d\u51fa\u6765\u5c31\u771f\u7684\u6ca1\u8c01\u4e86\uff09\n\n\u5728\u65e0\u8fb9\u6743\u7684\u6811\u4e0a\u968f\u610f\u6307\u5b9a\u4e00\u4e2a\u8282\u70b9\u4e3a\u6839\uff0c\u90a3\u4e48\u6211\u4eec\u4f1a\u53d1\u73b0\u6811\u4e0a\u8ddd\u79bb\u4e3a2\u7684\u8282\u70b9\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\n\n1.\u4e24\u4e2a\u8282\u70b9\u4e3a\u201c\u7956\u7236-\u5b59\u5b50\u201d\n\n2.\u4e24\u4e2a\u8282\u70b9\u4e92\u4e3a\u5144\u5f1f\n\n\u201c\u7956\u7236-\u5b59\u5b50\u201d\u8fd9\u79cd\u60c5\u51b5\u6bd4\u8f83\u597d\u89e3\u51b3\uff0c\u5728dfs\u4fbf\u5229\u6811\u7684\u65f6\u5019\u4e0d\u4ec5\u4ec5\u4f20\u9012\u7236\u4eb2(f)\uff0c\u8fd8\u628a\u7956\u7236(g)\u4e00\u8d77\u4f20\u9012\n\n\u90a3\u4e48\u8054\u5408\u6743\u503c\u5c31\u4e3aw[r]\\*w[g]\uff08\u8bb0\u5f55\u603b\u548c\u65f6\u8981\u4e582\uff09\n\n\u90a3\u4e48\u6211\u4eec\u770b\u770b\u5144\u5f1f\u60c5\u51b5\u8be5\u5982\u4f55\u89e3\u51b3\n\n\u8bbe\u4e00\u4e2a\u8282\u70b9r\u7684\u513f\u5b50\u5206\u522b\u662fson[1],son[2],son[3]...\n\n\u90a3\u4e48\u4ed6\u4eec\u7684\u6700\u5927\u503c\u663e\u7136\u662fson\u4e2d\u6700\u5927\u7684w\u4e58\u4e0a\u7b2c\u4e8c\u5927\u7684w\n\n\u7528maf\u548cmas\u5206\u522b\u8bb0\u5f55\u4e00\u4e0b\u6700\u5927\u503c\u548c\u6b21\u5927\u503c\u5c31\u53ef\u4ee5\u4e86\n\n\u603b\u548c\u4e5f\u5f88\u597d\u641e\uff0c\u8bb0\u5f55\u4e00\u4e0bson\u4e2dw\u603b\u548c\uff0c\u5e73\u65b9\u4e00\u4e0b\uff0c\u518d\u51cf\u53bbson[i]\u4e0eson[i]\uff08\u81ea\u5df1\u914d\u81ea\u5df1\uff09\u8fd9\u6837\u4e0d\u5408\u6cd5\u7684\u60c5\u51b5\u5373\u53ef\n\n\u8fd9\u4e9b\u90fd\u662f\u53ef\u4ee5\u5728dfs\u65f6\u987a\u9053\u5b8c\u6210\u7684\n\n\u6240\u4ee5\u6211\u4eec\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662fO(n)\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u5b8c\u6210\u4e86\u8fd9\u9053\u9898\uff0c\u5982\u679c\u6709\u4e0d\u61c2\u7684\u8bf7\u770b\u4ee3\u7801\u54e6\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\n#define mod 10007\n#define N 200005\n#define M 400005\nint n,w[N],ans1,ans2;\nint fir[N],nex[M],tar[M],cnt;\nvoid add(int a,int b)\n{\n    ++cnt;\n    tar[cnt]=b;\n    nex[cnt]=fir[a];\n    fir[a]=cnt;\n}\nvoid dfs(int r,int f,int g)\n{\n    int maf=0,mas=0,sum=0,squ=0;\n    for(int i=fir[r];i;i=nex[i])\n    {\n        int v=tar[i];\n        if(v!=f)\n        {\n            sum=(sum+w[v])%mod;\n            squ=(squ+w[v]*w[v]%mod)%mod;\n            if(w[v]>maf)\n                mas=maf,maf=w[v];\n            else\n                if(w[v]>mas)\n                    mas=w[v];\n            dfs(v,r,f);\n        }\n    }\n    ans1=max(ans1,max(mas*maf,w[r]*w[g]));\n    ans2=(ans2+(sum*sum%mod-squ+mod)%mod+w[r]*w[g]*2%mod)%mod;\n}\nint main()\n{\n    scanf(\"%d\",&n);\n    for(int i=1;i<n;i++)\n    {\n        int a,b;\n        scanf(\"%d%d\",&a,&b);\n        add(a,b);add(b,a);\n    }\n    for(int i=1;i<=n;i++)\n        scanf(\"%d\",&w[i]);\n    dfs(1,0,0);\n    printf(\"%d %d\\n\",ans1,ans2);\n}\n\n```",
        "postTime": 1508235721,
        "uid": 29815,
        "name": "ModestStarlight",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u989d\uff1b\n\u4f60\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\uff1b\n\n\u7136\u540e\u679a\u4e3e\u53ef\u4ee5\u8fde\u5230\u4ed6\u7684\u70b9\uff1b\n\n\u7136\u540e\u5bf9\u7740\u4e9b\u70b9\u76f4\u63a5\u7edf\u8ba1\u7b54\u6848\u5c31\u597d\u4e86\uff1b\n\n\u600e\u4e48\u7edf\u8ba1\u770b\u4ee3\u7801\u628a\uff0c\u611f\u89c9\u4e0d\u96be\u554a\uff1b\n\n\u4e3a\u4ec0\u4e48\u522b\u4eba\u7684\u9898\u89e3\u8fa3\u4e48\u957f\uff1b\n\n```cpp\n#include<cstdio>\n#include<iostream>\nusing namespace std;\nconst int N=2e5+5,mo=10007;\nstruct cs{int to,nxt;}a[N*2];\nint head[N],ll,v[N];\nint n,ans,x,y,maxans;\nvoid init(int x,int y){\n    a[++ll].to=y;\n    a[ll].nxt=head[x];\n    head[x]=ll;\n}\nvoid work(int x){\n    int sum=0,ma=0,m=0;\n    for(int k=head[x];k;k=a[k].nxt){\n        if(v[a[k].to]>ma){m=ma;    ma=v[a[k].to];}else\n        if(v[a[k].to]>m)m=v[a[k].to];\n        ans=(ans+sum*v[a[k].to])%mo;\n        sum=(sum+v[a[k].to])%mo;\n    }\n    maxans=max(maxans,ma*m);\n}\nint main()\n{\n    scanf(\"%d\",&n);\n    for(int i=1;i<n;i++){\n        scanf(\"%d%d\",&x,&y);\n        init(x,y); init(y,x);\n    }\n    for(int i=1;i<=n;i++)scanf(\"%d\",&v[i]);\n    for(int i=1;i<=n;i++)work(i);\n    printf(\"%d %d\",maxans,(ans*2)%mo);\n}\n\n```",
        "postTime": 1492141632,
        "uid": 7442,
        "name": "\u5de8\u578b\u65b9\u5757",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "### \u8054\u5408\u6743\u503c\n#### Solution\n\u3000\u3000\u4e00\u5f00\u59cb\u6ca1\u6709\u770b\u89c1\u53d6\u6a21\u8fd9\u56de\u4e8b, \u5e78\u597d\u6ca1\u6709\u63d0\u4ea4\u4e0a\u53bb\u2026\u2026233.\n\n##### 70\u5206\u505a\u6cd5\n\u3000\u3000\u6211\u4eec\u53d1\u73b0\u4e00\u4e2a\u70b9$i$\u6240\u8fde\u63a5\u7684\u70b9\u76f8\u4e92\u4e4b\u95f4\u7684\u8ddd\u79bb\u662f2.\u7136\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u679a\u4e3e\u6c42, \u7136\u540e\u5c31\u53ea\u80fd\u5f97\u523070\u5206.\u5177\u4f53\u7684\u6b65\u9aa4\u662f:\n1. \u679a\u4e3e\u6bcf\u4e2a\u70b9\n2. \u679a\u4e3e\u6bcf\u4e2a\u70b9\u8fde\u63a5\u7684\u53e6\u4e00\u4e2a\u70b9$v_1$\n3. \u679a\u4e3e\u6bcf\u4e2a\u70b9\u8fde\u63a5\u7684\u53e6\u53e6\u4e00\u4e2a\u70b9$v_2$\n4. \u53ea\u8981$v_1\\ne v_2$, \u90a3\u4e48\u8fd9\u4e24\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u4e3a$2$\n5. \u7edf\u8ba1\u7b54\u6848\n\n##### 100\u5206\u505a\u6cd5\n- \u5f53\u7136\u6700\u5927\u8054\u5408\u6743\u503c\u6bd4\u8f83\u597d\u6c42, \u53ea\u9700\u8981\u6c42\u51fa $i$ \u56db\u5468\u70b9\u7684\u6700\u5927\u503c\u548c\u6b21\u5927\u503c, \u5173\u952e\u662f\u8054\u5408\u6743\u503c\u4e4b\u548c.\n- \u5bf9\u4e8e\u8054\u5408\u5168\u804c\u4e4b\u548c, \u5047\u8bbe\u70b9 $u$ \u6240\u8fde\u63a5\u7684\u70b9\u7684\u6743\u503c\u4e3a$v_1,v_2,\\cdots $,\u90a3\u4e48\u8282\u70b9$i$\u5bf9\u6743\u503c\u4e4b\u548c\u4ea7\u751f\u7684\u8d21\u732e\u4e3a:\n![](https://cdn.luogu.com.cn/upload/pic/17000.png)\n\n\u3000\u3000\u90a3\u4e48\u8fd9\u4e2a\u53ea\u8981\u5728\u904d\u5386\u7684\u65f6\u5019\u6c42\u4e00\u4e0b$\\sum\\limits_{v_i}v_i$\u548c$\\sum\\limits_{v_i}v_i^2$, \u904d\u5386\u6811\u7684\u590d\u6742\u5ea6\u4e3a$\\Theta(n)$, \u53ef\u4ee5\u901a\u8fc7.\n  \n\u3000\u3000\u597d\u50cf\u8fd8\u6709\u4e00\u79cd\u6811\u5f62dp\u7684\u505a\u6cd5\u53ef\u60dc\u6211\u6ca1\u8bd5\u8fc7.\n  \n\u3000\u3000Tips:\u5176\u5b9e\u662f\u4e0d\u7528\u5199\u9012\u5f52\u5f62\u5f0f\u7684\u904d\u5386\u7684, \u901f\u5ea6\u4f1a\u53d8\u6162, \u4e0d\u5982\u76f4\u63a5\u50cf70\u5206\u505a\u6cd5\u4e00\u6837\u76f4\u63a5\u679a\u4e3e\n#### Code\n70\u5206\u505a\u6cd5, \u662f\u6bd4\u73b0\u5728\u8fd8\u8981naive\u7684\u65f6\u5019\u5199\u7684.\n```cpp\n#include<algorithm> \n#include<iostream> \n#include<cstdio> \n#define mod 10007 \n#define N 200005 \nusing namespace std; \n  \nint n,maxl,sigma; \n  \nvoid read(int& s){ \n    char ch=getchar(); \n    for(;!isdigit(ch);ch=getchar()); \n    for(s=0;isdigit(ch);s=s*10+ch-'0',ch=getchar()); \n} \n  \nstruct edge{ \n    int to,nxt; \n}edge[N<<2]; \nint w[N],head[N],tot; \n  \n  \nvoid add(int a,int b){ \n    edge[++tot].to=b; \n    edge[tot].nxt=head[a]; \n    head[a]=tot; \n} \n  \nint main(){ \n    cin>>n;int a,b,c; \n    for(int i=1;i<n;++i){ \n        read(a),read(b); \n        add(a,b),add(b,a); \n    } \n    for(int i=1;i<=n;++i)read(w[i]); \n    for(int i=1;i<=n;++i) //\u679a\u4e3e\u6bcf\u4e2a\u70b9\n        for(int j=head[i];j;j=edge[j].nxt) //\u679a\u4e3e\u5b83\u8fde\u63a5\u7684\u4e24\u4e2a\u70b9\n            for(int k=head[i];k;k=edge[k].nxt){ \n                if(j==k)continue; //\u4e0d\u80fd\u662f\u76f8\u540c\u7684\u70b9\n                maxl=max(maxl,w[edge[j].to]*w[edge[k].to]); //\u7edf\u8ba1\u6700\u5927\u503c\n                sigma=(sigma+w[edge[j].to]*w[edge[k].to])%mod; //\u7edf\u8ba1\u548c\n            } \n    printf(\"%d %d\",maxl,sigma); \n    return 0; \n} \n```\n100\u5206\u505a\u6cd5\n\nTips:\u5176\u5b9e\u662f\u4e0d\u7528\u5199\u9012\u5f52\u5f62\u5f0f\u7684\u904d\u5386\u7684, \u901f\u5ea6\u4f1a\u53d8\u6162, \u4e0d\u5982\u76f4\u63a5\u50cf70\u5206\u505a\u6cd5\u4e00\u6837\u76f4\u63a5\u679a\u4e3e\n```cpp\n#include<algorithm>\n#include<iostream>\n#include<cstdio>\n#define N 400005\n#define mod 10007\nusing namespace std;\n\n#define int long long\n\nstruct Edge{\n    int v,nxt;\n}e[N];\nint head[N],tot;\nvoid AddEdge(int u,int v){\n    e[++tot]=(Edge){v,head[u]};head[u]=tot;\n    e[++tot]=(Edge){u,head[v]};head[v]=tot;\n}\n\nint ans1,ans2;\nint val[N];\nint n;\n\nvoid dfs(int x,int f){\n    if(x>n)return ;\n    int m1,m2;m1=m2=0;//x\u6240\u8fde\u63a5\u7684\u70b9\u7684\u6700\u5927\u503c\u548c\u6b21\u5927\u503c\n    int h1,h2;h1=h2=0;//x\u6240\u8fde\u63a5\u7684\u70b9\u4e3av, h1,h2\u4e3a v\u70b9\u6743\u548c \u548c v\u7684\u70b9\u6743\u5e73\u65b9\u548c.\n\n    for(int i=head[x];i;i=e[i].nxt){\n        int to=e[i].v;//\u6240\u8fde\u63a5\u7684\u53e6\u4e00\u4e2a\u70b9\n        if(to!=f)dfs(to,x);\n\n        if(val[to]>m2){//\u7ef4\u62a4\u6700\u5927\u503c\u548c\u6b21\u5927\u503c\n            if(val[to]>m1)\n                m2=m1,m1=val[to];\n            else m2=val[to];\n        }\n        \n\t\th1+=val[to],h2+=val[to]*val[to];//\u66f4\u65b0h1,h2\n    }\n\n    ans2+=((h1%mod)*(h1%mod)-h2%mod)%mod;\n    ans2%=mod;\n    ans1=max(m1*m2,ans1);\n}\n\nmain(){\n    scanf(\"%lld\",&n);int u,v;\n    for(int i=1;i<n;++i){\n        scanf(\"%lld%lld\",&u,&v);\n        AddEdge(u,v);\n    }\n    for(int i=1;i<=n;++i)\n        scanf(\"%lld\",&val[i]);\n    dfs(1,0);\n    printf(\"%lld %lld\",ans1,ans2);\n    return 0;\n}\n```",
        "postTime": 1523087097,
        "uid": 39067,
        "name": "aiyougege",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\n[\u535a\u5ba2\u98df\u7528\u4f20\u9001\u95e8](https://www.luogu.org/blog/wicker/solution-p1351)\n\n- **\u5206\u6790\u9898\u76ee**\n\n  1. \u65e0\u5411\u8fde\u901a\u56fe $G$ \u6709 $n$ \u4e2a\u70b9\uff0c$n-1$ \u6761\u8fb9\u3002\n\n     \u5f88\u660e\u663e\uff0c\u7ed9\u51fa\u7684\u662f\u4e00\u4e2a**\u65e0\u6839\u6811**\n   \n  2. \u7531\u4e8e\u6240\u6709\u8054\u5408\u6743\u503c\u4e4b\u548c\u53ef\u80fd\u5f88\u5927\uff0c\u8f93\u51fa\u5b83\u65f6\u8981\u5bf9$10007$\u53d6\u4f59\u3002\n   \n     \u6613\u9519\u70b9\uff0c**\u6700\u5927\u503c\u4e0d\u7528\u53d6\u819c**\uff0c\u548c\u624d\u8981\u53d6\u819c\u3002\n     \n\n------------\n\n- **\u5206\u6790**\n\n  \u56e0\u4e3a\u4ed6\u662f\u4e00\u4e2a\u65e0\u6839\u6811\uff0c\u6240\u4ee5\u4e0d\u5982\u5148\u7ed9\u4ed6**\u786e\u8ba4$1$\u4e3a\u5176\u6839\u8282\u70b9**\u3002\n\n  \u56e0\u4e3a\u4ed6\u662f\u4e00\u4e2a\u6811\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u53ea\u8981\u8003\u8651$3$\u79cd\u60c5\u51b5\uff1a**\u7236\u8282\u70b9\u7684\u7236\u8282\u70b9**\uff08\u7237\u7237\uff09\uff0c\u4ed6\u7684**\u5b50\u8282\u70b9\u7684\u5b50\u8282\u70b9**\uff0c**\u548c\u4ed6\u6709\u540c\u4e00\u4e2a\u7236\u4eb2\u7684\u4efb\u610f\u4e00\u70b9**\uff08\u5b59\u5b50\u4eec\uff09\n  \n  \u7136\u540e\u53c8\u53ef\u4ee5\u53d1\u73b0\uff0c\u53ef\u4ee5\u5ffd\u7565\u6bcf\u4e2a\u70b9\u7684**\u5b50\u8282\u70b9\u7684\u5b50\u8282\u70b9\u7684\u8ba1\u7b97** \uff0c\u76f8\u5e94\u7684\uff0c\u53ea\u8981\u628a\u6bcf\u6b21\u7b97\u7236\u8282\u70b9\u7684\u7236\u8282\u70b9\u65f6\u7684\u503c**\u7b97\u4e0a2\u904d**\u5c31\u53ef\u4ee5\u4e86\u3002\n  \n  \u8fd9\u91cc\u7a0d\u5fae\u89e3\u91ca\u4e00\u4e0b\uff1a\uff08\u7406\u89e3\u7684\u4eba\u81ea\u52a8\u8df3\u8fc7\uff09\n  \n  \u8bbe $x$ \u7684\u7236\u8282\u70b9\u7684\u7236\u8282\u70b9\u662f $y$ \u3002\n  \n  \u5728\u7b97 $x$ \u7684\u60c5\u51b5\u65f6\uff0c\u8981\u4ee5**\u7b2c\u4e00\u79cd\u60c5\u51b5\uff08\u7236\u8282\u70b9\u7684\u7236\u8282\u70b9\uff09** \u6c42\u4e00\u6b21 $w_x*w_y$\u3002\u7b97 $y$ \u7684\u60c5\u51b5\u65f6\uff0c\u4e5f\u8981\u4ee5**\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff08\u5b50\u8282\u70b9\u7684\u5b50\u8282\u70b9\uff09** \u7b97\u4e00\u904d $w_y * w_x$ \u3002\n  \n  \u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u5ffd\u7565\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u628a\u7b2c\u4e00\u79cd\u60c5\u51b5\u7684\u7ed3\u679c\u4e58\u4e0a  $2$\u3002\n  \n  \u597d\u4e86\u7ee7\u7eed\u3002\n  \n  \u8fd9\u4e48\u4e00\u5206\u6790\u5b8c\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8dd1 $dfs$ \u4e86\u3002\n  \n  \u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c**\u7b2c\u4e00\u79cd\u60c5\u51b5\u76f4\u63a5\u7b97**(\u76f4\u63a5\u4e58\u6cd5)\uff1b\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u76f4\u63a5**\u679a\u4e3e**\u548c\u81ea\u5df1\u6709\u540c\u4e00\u4e2a\u7236\u4eb2\u7684\u6240\u6709\u70b9\uff0c\u4e0d\u65ad\u66f4\u65b0\u7b54\u6848\u5373\u53ef\u3002\n  \n  \n\n------------\n- **\u4e00\u70b9\u7ec6\u5c0f\u7684\u4f18\u5316\uff08\u6211\u5f53\u65f6\u4ee5\u4e3a\u4e0d\u52a0\u80fd\u8fc7\uff09**\n\n  \u76f4\u63a5$dfs$\u76f4\u63a5TLE\uff0c\u8fd8\u9700\u8981\u4e00\u70b9\u70b9\u4f18\u5316\u3002\n  \n  \u770b\u521a\u521a\u6700\u540e\u7684\u7ed3\u8bba\uff0c\u53d1\u73b0\u6bcf\u6b21\u679a\u4e3e\u7684\u70b9\u6743\u662f\u53ef\u4ee5\u9884\u5904\u7406\u7684\u3002\n  \n  \u8bbe $sum[x]$ \u8868\u793a**\u70b9 $x$ \u6240\u6709\u5b50\u8282\u70b9\u70b9\u6743\u548c**\u3002\n  \n  \u800c\u6700\u5927\u503c\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u70b9 $x$ \uff0c\u4e5f\u6c42\u51fa\u4ed6\u7684\u5b50\u8282\u70b9\u7684**\u6700\u5927\u503c\u548c\u6b21\u5927\u503c\u3002**(\u56e0\u4e3a\u4e0b\u4e00\u5c42\u7684\u6700\u5927\u503c\u7684\u70b9**\u4e0d\u80fd\u548c\u81ea\u5df1\u4e58**)\n  \n  \u7136\u540e\u5c31\u53ef\u4ee5\u4e86\u3002\n  \n  \u5982\u679c\u8fd8\u6709\u4e9b\u4e0d\u7406\u89e3,\u53ef\u4ee5\u770b\u770b\u4ee3\u7801\u3002\n  \n\n------------\n\n  \n- \u4ee3\u7801\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cmath>\nusing namespace std;\nconst int dalao=10007;\nstruct edge{\n\t\tint v,nx;\n}p[400005];\nint n,ne,f[200005];\nint sum[200005],father[200005],w[200005];\nint data[200005][2],gmax[200005][2];//data\u8bb0\u5f55\u7f16\u53f7 gmax\u8bb0\u5f55\u5177\u4f53\u503c 0\u6700\u5927\u503c 1\u6b21\u5927\u503c \nint maxn,ans;\nvoid read(int u,int v)\n{\t\n\t\tp[++ne].v=v;\n\t\tp[ne].nx=f[u];\n\t\tf[u]=ne;\n}\nvoid getfather(int x,int fa)\n{\t\n\t\tfather[x]=fa;\n\t\tfor(int i=f[x];i;i=p[i].nx)\n\t\t{\t\n\t\t\tif(p[i].v==fa)continue;\n\t\t\tgetfather(p[i].v,x);\n\t\t}\n}\nint main()\n{\t\n\t\tscanf(\"%d\",&n);\n\t\tfor(int i=1;i<n;i++)\n\t\t{\t\n\t\t\tint u,v;\n\t\t\tscanf(\"%d%d\",&u,&v);\n\t\t\tread(u,v);\n\t\t\tread(v,u);\n\t\t}\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tscanf(\"%d\",&w[i]);\n\t\tsum[0]=w[1];\n\t\tgetfather(1,0);//\u786e\u8ba4\u6bcf\u4e2a\u70b9\u7684\u7236\u8282\u70b9 \n\t\tfor(int i=1;i<=n;i++)//\u9884\u5904\u7406 \n\t\t\tfor(int j=f[i];j;j=p[j].nx)\n\t\t\t{\t\n\t\t\t\tif(p[j].v==father[i])continue;\n\t\t\t\tsum[i]=(sum[i]+w[p[j].v])%dalao;//\u9884\u5904\u7406\u548c\n\t\t\t\t//\u9884\u5904\u7406\u6700\u5927\u503c\u548c\u6b21\u5927\u503c \n\t\t\t\tif(w[p[j].v]>gmax[i][0]){gmax[i][0]=w[p[j].v];data[i][0]=p[j].v;}\n\t\t\t\telse if(w[p[j].v]>gmax[i][1]){gmax[i][1]=w[p[j].v];data[i][1]=p[j].v;}\n\t\t\t}\n\t\tfor(int x=1;x<=n;x++)\n\t\t{\t\n\t\t\tif(father[father[x]])//\u5b58\u5728\u7236\u8282\u70b9\u7684\u7236\u8282\u70b9 \n\t\t\t\tans=(ans+2*w[x]*w[father[father[x]]])%dalao;\n\t\t\tif(father[father[x]])\n\t\t\t\tmaxn=max(maxn,w[x]*w[father[father[x]]]);\n\t\t\tans=(ans+w[x]*(sum[father[x]]-w[x]))%dalao;\n\t\t\t\n\t\t\tif(data[father[x]][0]!=x)//\u6700\u5927\u503c\u4e0d\u80fd\u548c\u81ea\u5df1\u4e58 \n\t\t\t\tmaxn=max(maxn,w[x]*gmax[father[x]][0]);\n\t\t\telse maxn=max(maxn,w[x]*gmax[father[x]][1]);\n\t\t}\n\t\tprintf(\"%d %d\\n\",maxn,ans);\n\t\treturn 0;\n}\n```\n\n$$\\text{by \u8def\u4eba\u4e03}$$",
        "postTime": 1570632447,
        "uid": 39408,
        "name": "Rainy7",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "> - Tips\uff1a\u672c\u7bc7\u9898\u89e3\u8ba8\u8bba\u4e86\u6709\u5173\u672c\u9898\u7684\u901a\u89e3\uff0c\u5373\u8003\u8651\u8ba1\u7b97\u4e24\u70b9\u95f4\u7684\u8ddd\u79bb\u4e3a k \u65f6\u7684\u8054\u5408\u6743\u503c\u3002\u540c\u65f6\u4e5f\u4f1a\u8bba\u8ff0\u8ddd\u79bb\u4e3a2\u65f6\u7684\u7279\u6b8a\u89e3\u6cd5\u3002\n\n------\n\n- \u9898\u76ee\u94fe\u63a5\uff1a[P1351](https://www.luogu.com.cn/problem/P1351)\n\n- \u9898\u610f\u89e3\u8bfb\uff1a\u6c42**\u65e0\u6839\u6811**\u4e0a**\u4efb\u610f\u4e24\u4e2a\u8ddd\u79bb\u4e3a2**\u7684\u70b9\u5bf9 $(u,v)$ \u7684 $w(u)\\cdot w(v)$ \u7684\u548c\u4e0e\u6700\u5927\u503c\u3002\n\n------\n\n## .\u7279\u6b8a\u60c5\u51b5(\u672c\u9898)\u7684\u601d\u8def\n\n- \u94a6\u5b9a 1 \u4e3a\u6839\u8282\u70b9\u3002\n\n- \u5bf9\u4e8e\u4efb\u610f\u7684\u7ed3\u70b9 $u$ \uff0c\u53ef\u4ee5\u8003\u8651 $u$ \u4e0e $fa(fa(u))$ \u5f62\u6210\u8054\u5408\u6743\u503c\uff1b\u82e5\u628a\u5b83**\u4f5c\u4e3a\u4e2d\u8f6c\u70b9,\u90a3\u4e48 $u$ \u7684\u4efb\u610f2\u4e2a\u513f\u5b50\u4e4b\u95f4**\u4e5f\u53ef\u4ee5\u5f62\u6210\u8054\u5408\u6743\u503c\u3002\u4e3e\u4f8b\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/2r3wa8l7.png)\n\n- \u5982\u56fe\uff0c\u5bf9\u4e8e\u7ed3\u70b9 4 \uff0c\u53ef\u4ee5\u4e0e $fa(fa(4))$ \u5373 2 \u53f7\u7ed3\u70b9\u5f62\u6210\u8054\u5408\u6743\u503c\uff1b\n\n  \u800c\u82e5\u628a\u5b83\u505a\u4e3a\u4e2d\u8f6c\u70b9\uff0c\u7ecf\u8fc7\u5b83\u53ef\u4ee5\u5f62\u6210\u8054\u5408\u6743\u503c\u7684\u70b9\u5bf9\u6709  $(5,6),(5,7),(5,8),(6,7),(6,8),(7,8)$ \u3002\n\n- \u6545\u53ef\u4ee5\u5199\u51fa\u5982\u4e0b\u4ee3\u7801\uff08 `w(u)` \u8868\u793a\u9898\u76ee\u4e2d\u7ed9\u5b9a\u7684\u6743\u503c\uff09\uff1a\n\n```cpp\nvoid dfs(int u,int pre,int dep){\n\tfa[u]=pre;\n\tif(dep>=3)\n        ansmax=max(ansmax,w[u]*w[fa[pre]]),anssum=(anssum+w[u]*w[fa[pre]])%mod;\n    //\u4e0e\u7236\u4eb2\u7684\u7236\u4eb2\u7684\u8054\u5408\u6743\u503c\u7edf\u8ba1.\u53ea\u6709\u5c42\u6570>=3\u7684\u7ed3\u70b9\u624d\u6709\u7236\u4eb2\u7684\u7236\u4eb2.\n\tif(nd[u].size()==1)return;//\u53f6\u5b50\u7ed3\u70b9\u65e0\u513f\u5b50(\u91c7\u7528vector\u5b58\u53cc\u5411\u8fb9).\n\tfor(int i(0);i<nd[u].size();++i)\n\t\tfor(int j(i+1);j<nd[u].size();++j){//\u53cc\u91cd\u5faa\u73af\u679a\u4e3e\u5b50\u6811\u5185\u76842\u4e2a\u513f\u5b50.\n\t\t\tint lson(nd[u][i]),rson(nd[u][j]);\n            if(lson!=pre&&rson!=pre)\n                ansmax=max(ansmax,w[lson]*w[rson]),anssum=(anssum+w[lson]*w[rson])%mod;\n            //\u513f\u5b50\u7684\u5144\u5f1f\u95f4\u7684\u8054\u5408\u6743\u503c\u7edf\u8ba1.\n  \t\t\t//\u6ce8\u610f\u8fd9\u6837\u6c42\u7684\u662f\u6709\u5e8f\u7684\u70b9\u5bf9,\u8f93\u51fa\u65f6\u8981\u4e582.\n\t\t}\n\tfor(int i(0);i<nd[u].size();++i)if(nd[u][i]!=pre)dfs(nd[u][i],u,dep+1);//\u7ee7\u7eed\u8bbf\u95ee\n}\n```\n\n- \u4f46\u4f1a TLE 3\u4e2a\u70b9\uff0c $u$ \u548c $fa(fa(u))$ \u7684\u8054\u5408\u6743\u503c\u7684\u7edf\u8ba1\u662f $\\Theta(1)$ \u80af\u5b9a\u4e0d\u80fd\u7ee7\u7eed\u4f18\u5316\u4e86\uff0c\u73b0\u5728\u53ea\u80fd\u7740\u773c\u4e8e\u4f18\u5316\u4e24\u5c42 `for`\uff1a\n\n- **\u6c42\u6700\u5927\u503c\u7684\u4f18\u5316**\uff1a\u663e\u7136\u5c31\u662f\u6743\u503c\u6700\u5927\u7684\u4e0e\u6b21\u5927\u7684\u4e24\u4e2a\u7ed3\u70b9\u7684\u6743\u503c\u76f8\u4e58\u5373\u53ef\uff08\u4f46\u6ce8\u610f\u6700\u5927\u503c\u4e0e\u6b21\u5927\u503c\u53ef\u80fd\u76f8\u7b49\uff09\u3002\n\n- **\u6c42\u548c\u7684\u4f18\u5316**\uff1a\n  - \u8fd8\u662f\u770b\u4e3e\u4f8b\u7684\u56fe\uff0c\u5bf9\u4e8e\u7ed3\u70b9 4 \u7684\u513f\u5b50\u7ed3\u70b9 5 \uff0c\u5b83\u6b64\u65f6\uff08\u4ee54\u53f7\u7ed3\u70b9\u4e3a\u4e2d\u8f6c\u70b9\uff09\u80fd\u4e0e\u53e6\u59163\u4e2a\u513f\u5b50\u5206\u522b\u5f62\u6210\u8054\u5408\u6743\u503c\uff0c\u6839\u636e\u4e58\u6cd5\u5206\u914d\u5f8b\u53ef\u4ee5\u63a8\u51fa\u662f\u5b83\u5bf9\u7ed3\u70b9 4\u4ea7\u751f\u7684\u8d21\u732e\u662f$w(5)\\cdot (w(6)+w(7)+w(8))=w(5)\\cdot (sum-w(5))$\uff0c\u5176\u4e2d $sum=\\sum_{v\\in son(u)}w(v)$ \u3002\u5bf9\u4e8e\u7ed3\u70b9 6\uff0c7\uff0c8 \u4e5f\u662f\u540c\u7406\u3002\u66f4\u4e00\u822c\u5730\uff0c\u7ed3\u70b9 $u$ \u513f\u5b50 $v$ \u5bf9 $u$ \u4ea7\u751f\u7684\u603b\u8d21\u732e\u4e3a\uff1a\n\n$$\n\u2211_{v\\in son(u)}w(v)*(sum-w(v))\n$$\n\n- \u4f18\u5316\u540e\u7684\u4ee3\u7801\uff1a\n\n```cpp\nll ansmax(-INF),anssum,w[mxN+5];vector<int>nd[mxN+5];\nvoid add(int u,int v){nd[u].push_back(v);}\nvoid dfs(int u,int pre,int dep){\n\tfa[u]=pre;\n\tif(dep>=3)ansmax=max(ansmax,w[u]*w[fa[pre]]),anssum=(anssum+w[u]*w[fa[pre]]*2)%mod;//\u4e0e\u7236\u4eb2\u7684\u7236\u4eb2\u7684\u8054\u5408\u6743\u503c\u7edf\u8ba1.\n\tif(nd[u].size()==1)return;//\u53f6\u5b50\u7ed3\u70b9\u65e0\u513f\u5b50.\n    ll sum(0),max1(0),max2(0);int fg(-1);//\u513f\u5b50\u7ed3\u70b9\u7684\u548c,\u6700\u5927\u503c,\u6b21\u5927\u503c,\u662f\u5426\u67092\u4e2a\u6700\u5927\u503c.\n    for(int i(0);i<nd[u].size();++i){\n        int v(nd[u][i]);if(v==pre)continue;\n        sum+=w[v],max1=max(max1,w[v]);//\u6c42\u548c,\u627e\u6700\u5927\u503c.\n    }\n    for(int i(0);i<nd[u].size();++i){\n        int v(nd[u][i]);if(v==pre)continue;\n        if(w[v]==max1)++fg;if(fg==1)break;//\u627e\u6709\u51e0\u4e2a\u6700\u5927\u503c.\n    }\n    if(fg)ansmax=max(ansmax,max1*max1);//\u82e5\u5b58\u57282\u4e2a\u6700\u5927\u503c\u5219\u76f4\u63a5\u76f8\u4e58.\n    for(int i(0);i<nd[u].size();++i){\n        int v(nd[u][i]);if(v==pre)continue;\n        anssum=(anssum+w[v]*(sum-w[v])%mod);//\u513f\u5b50\u7684\u5144\u5f1f\u95f4\u7684\u8054\u5408\u6743\u503c\u7edf\u8ba1.\n        if(w[v]>max2&&w[v]<max1)max2=w[v];//\u6c42\u8054\u5408\u6743\u503c\u548c,\u987a\u4fbf\u627e\u6b21\u5927\u503c.\n    }\n    if(!fg)ansmax=max(ansmax,max1*max2);//\u53ea\u67091\u4e2a\u6700\u5927\u503c\u65f6.\n  \t//\u6ce8\u610f\u6b64\u65f6\u7edf\u8ba1\u7684\u662f\u65e0\u5e8f\u70b9\u5bf9,\u6240\u4ee5\u8f93\u51fa\u65f6\u4e0d\u9700\u8981\u4e582.\n\tfor(int i(0);i<nd[u].size();++i)if(nd[u][i]!=pre)dfs(nd[u][i],u,dep+1);\n}\nint main(){\n\tscanf(\"%d\",&n);int u,v;for(int i(1);i<=n-1;++i)scanf(\"%d%d\",&u,&v),add(u,v),add(v,u);\n\tfor(int i(1);i<=n;++i)scanf(\"%lld\",&w[i]);\n\tdfs(1,0,1),printf(\"%lld %lld\",ansmax,anssum%mod);\n\treturn 0;\n}\n```\n\n- \u53d1\u73b0\u4e0a\u5f0f\u6709\u4e0d\u53d8\u7684\u90e8\u5206\uff0c\u53ef\u7ee7\u7eed\u5316\u7b80\uff1a\n  $$\n  \u2211_{v\\in son(u)}(w(v)\\cdot(sum-w(v)))=\u2211_{v\\in son(u)}(w(v)\\cdot sum-w(v)^2)=\\\\\n  \u2211_{v\\in son(u)}(w(v)\\cdot sum-\u2211_{v\\in son(u)}w(v)^2)=\u2211_{v\\in son(u)}w(v)\\cdot\u2211_{v\\in son(u)}sum-\u2211w(v)^2=\\\\\n  sum\\cdot\u2211_{v\\in son(u)}sum-sum^2=sum^2\\cdot (siz(u)-1).\n  $$\n\n  - \u5176\u4e2d $siz(u)$ \u8868\u793a\u4e0e $u$ \u76f4\u63a5\u76f8\u8fde\u7684\u513f\u5b50\u7684\u4e2a\u6570\u3002\n\n- \u8fd9\u6837\u5bf9\u4e8e\u6bcf\u4e2a\u7ed3\u70b9\u4f5c\u4e3a\u4e2d\u8f6c\u70b9\u65f6\u7684\u7edf\u8ba1\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\Theta(1)$ \u7684\u3002\u4f46\u4e5f\u56e0\u4e3a\u6bcf\u4e2a\u513f\u5b50\u7ed3\u70b9\u672c\u8eab\u5c31\u4f1a\u8bbf\u95ee\uff0c\u6240\u4ee5\u4f18\u5316\u524d\u540e\u65f6\u95f4\u590d\u6742\u5ea6\u76f8\u5dee\u4e0d\u5927\u3002\n\n- \u81f3\u6b64\uff0c\u672c\u9898\u7ed3\u675f\u3002\n\n------\n\n> - \u7ffb\u5230\u8ba8\u8bba\u7248\u91cc @cybercsc \u63d0\u51fa\u7684\u95ee\u9898\uff08 https://www.luogu.com.cn/discuss/show/254696 \uff09\uff0c\u5f15\u53d1\u4e86\u6211\u5982\u4e0b\u7684\u601d\u8003\u3002\n\n## .\u6709\u5173\u4e00\u822c\u6027\u89e3\u6cd5\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/yc8tmtro.png)\n\n- \u5982\u56fe\uff0c\u8003\u8651\u8054\u5408\u6743\u503c\u65f6\u8ddd\u79bb\u4e3a 3 \u7684\u60c5\u51b5\u3002\u5bf9\u4e8e\u7ed3\u70b9 3 \uff1a\n\n  - **\u5bf9\u4e8e\u7956\u5b97\u7ed3\u70b9**\uff1a\u663e\u7136\u4e0e\u8ddd\u79bb\u4e3a 2 \u7684\u60c5\u51b5\u4e00\u6837\uff0c\u5c31\u662f\u4e0e 0 \u53f7\u8282\u70b9\u5f62\u6210\u8054\u5408\u6743\u503c\uff08\u6b63\u786e\u7684\u539f\u56e0\u5728\u4e8e\u6811\u4e0a\u7684\u6bcf\u4e2a\u7ed3\u70b9\u5230\u5176\u7236\u4eb2\u53ea\u6709\u552f\u4e00\u4e00\u6761\u8def\u5f84\uff09\u3002\n\n  - **\u4f5c\u4e3a\u4e2d\u8f6c\u70b9**\uff1a\u663e\u7136\u4ee5\u7ed3\u70b9 3 \u4e3a\u4e2d\u8f6c\u70b9\u80fd\u5f62\u6210\u8054\u5408\u6743\u503c\u7684\u70b9\u5bf9\u6709 $(5,6),(9,6),(4,7),(9,7),(5,8),(4,9)$ \u3002\u5176\u5b9e\u5c31\u662f**\u628a\u4e24\u6761\u8def\u5f84\u62c9\u76f4**\u6765\u770b\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/n0my48nx.png)\n\n- \u8fd9\u6837\u5bb9\u6613\u76f4\u89c2\u770b\u51fa\u8fd9\u4e24\u6761\u94fe\u4e0a\u505a\u51fa\u8d21\u732e\u7684\u70b9\u5bf9\u662f $(5,6),(4,7)$ \uff1a\u8fd9\u7ed9\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u601d\u8def\uff0c\u5bf9\u4e8e\u6bcf 2 \u6761\u94fe\uff0c\u62c9\u76f4\u6210 1 \u6761\u8def\u5f84\u4e4b\u540e\uff0c**\u4ece\u5de6\u7aef\u70b9\u5f00\u59cb\uff08\u6b64\u5904\u662f 5\u53f7\u7ed3\u70b9\uff09\u679a\u4e3e\u8ddd\u79bb\u4e3a k \u7684\u70b9\u5bf9**\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8fdb\u884c\u7edf\u8ba1\u4e86\u3002\n\n- \u4f46\u8fd9\u6837\u505a\u7684\u590d\u6742\u5ea6\u4ecd\u7136\u76f8\u5f53\u9ad8\uff1a\u5916\u5c42\u8981\u679a\u4e3e\u662f\u54ea 2 \u6761\u94fe\uff0c\u5185\u5c42\u8fd8\u8981\u679a\u4e3e\u5de6\u7aef\u70b9\u3002\u53ef\u4ee5\u4f18\u5316\u5417\uff1f\u663e\u7136\u53ef\u4ee5\u3002\n\n  - **\u6c42\u6700\u5927\u503c\u7684\u4f18\u5316**\uff1a\u548c\u6c42\u7279\u6b8a\u60c5\u51b5\u65f6\u662f\u4e00\u6837\u7684\u3002\n\n  - **\u6c42\u548c\u7684\u4f18\u5316**\uff1a\u7edf\u8ba1\u51fa\u4ee5\u4e2d\u8f6c\u70b9\u4e3a\u6839\u6bcf\u4e00\u5c42\u7684 $sum(i)$ \u3002\u5373\uff1a\n\n    - \u4ee4\u4e2d\u8f6c\u70b9\u4e3a $u$ \uff0c $k$ \u8868\u793a\u7ed9\u5b9a\u7684\u8ddd\u79bb\uff0c\u73b0\u5728\u9700\u8981\u8ba1\u7b97 $v$ \u6b64\u65f6\u80fd\u4e0e\u54ea\u4e9b\u70b9\u5f62\u6210\u8054\u5408\u6743\u503c\u3002\n    - \u4ee4 $dep(u)$ \u8868\u793a $u$ \u7684\u6df1\u5ea6\uff0c$sum(u,i)$ \u8868\u793a\u4ee5 $u$ \u4e3a\u6839\u7b2c $i$ \u5c42\uff08\u5305\u542b\u7ed3\u70b9 $u$ \uff09\u7684\u513f\u5b50\u7684 $w$ \uff08\u9898\u76ee\u7ed9\u5b9a\u6743\u503c\uff09\u7684\u548c\u3002\n    - \u5219\u6b64\u65f6\u80fd\u4e0e $v$ \u5f62\u6210\u8054\u5408\u6743\u503c\u7684\u70b9\u7684\u6df1\u5ea6\u662f $Dep=k-(dep(v)-dep(u))+1=k-dep(v)+dep(u)+1$  \uff08\u6ce8\u610f\u662f\u76f8\u5bf9\u7ed3\u70b9 $u$ \u800c\u8a00\u7684\u6df1\u5ea6\uff09\uff0c\u90a3\u4e00\u5c42\u7684\u548c\u662f $sum(u,Dep)$ \u3002\n    - \u5bf9\u4e8ev\uff0c\u9700\u8981\u51cf\u53bb\u7684\u90e8\u5206\u662f $sum(v,Dep-(dep(v)-dep(u))=sum(v,Dep-dep(v)+dep(u))$  \u3002\n    - \u90a3\u4e48\u53ef\u4ee5\u4e0e $v$ \u5f62\u6210\u7684\u8054\u5408\u6743\u503c\u4e4b\u7684\u7ed3\u70b9\u5bf9\u4e2d\u8f6c\u70b9 $u$ \u7684\u8d21\u732e\u4e4b\u548c\u4e3a\uff1a\n\n    $$\n    w(v)\\cdot(sum(u,Dep)-sum(v,Dep-dep(v)+dep(u))).\n    $$\n\n    - \u5bf9\u4e8eu\u7684\u6bcf\u4e2a\u513f\u5b50\u7ed3\u70b9\u7686\u5982\u6b64\uff0c\u90a3\u4e48\u6700\u540e\u76f8\u52a0\u5373\u53ef\u7b97\u51fa\u4ee5 $u$ \u4e3a\u4e2d\u8f6c\u70b9\u7684\u8054\u5408\u6743\u503c\u4e4b\u548c\u3002\n\n- \u6700\u540e\u7684\u95ee\u9898\u5728\u4e8e\u9884\u5904\u7406 $sum(u,i)$ \u3002\u663e\u7136\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u5408\u5e76\u7ef4\u62a4\u3002\n\n****\n\n> PS\uff1a~~\uff08\u840c\u65b0\u521a\u5b66 OI 3\u79d2**\u6c42\u8d5e**\uff09\u5982\u679c\u6709\u4ec0\u4e48\u4e0d\u5bf9\u8bf7\u5927\u4f6c\u6307\u6b63\u3002~~\n>\n> Upd\uff1a20210828\uff0c\u89c4\u8303\u4e86 markdown \u7684\u4f7f\u7528\uff0c\u53bb\u9664\u4e86\u56fe\u7247\u4e0a\u622a\u56fe\u8f6f\u4ef6\u7684\u6c34\u5370\uff0c\u8c03\u6574\u4e86\u4ee3\u7801\u683c\u5f0f\u4e0e\u8868\u8fbe\u65b9\u5f0f\u3002",
        "postTime": 1611841575,
        "uid": 261046,
        "name": "Cht_master",
        "ccfLevel": 5,
        "title": "P1351 [NOIP2014 \u63d0\u9ad8\u7ec4] \u8054\u5408\u6743\u503c"
    },
    {
        "content": "## \u672c\u849f\u84bb\u7b2c\u4e00\u6b21\u53d1\u9898\u89e3\u671b\u901a\u8fc7~~~~\n\u4e00\u5f00\u59cb\u628a\u8fd9\u9053\u9898\u5f53\u6210\u4e86\u56fe\u8bba...\u5f53\u7136\u53ef\u4ee5\u505a\u51fa\u6765\uff0c\u5176\u4ed6\u7684\u5927\u4f6c\u4eec\u90fd\u89e3\u91ca\u7684\u5f88\u8be6\u7ec6\u4e86\u3002\u849f\u84bb\u81ea\u53f9\u4e0d\u5982\u5728\u6b64\u4e0d\u505a\u8bf4\u660eO(\u2229_\u2229)O\u54c8\u54c8~\u3002\n\n#### \u540e\u6765\u505a\u5b8c\u540e\u60f3\u7740\u60f3\u7740\u53d1\u73b0\u2014\u2014\u8fd9\u4e2a\u9898\u662f\u5176\u5b9e\u4e00\u9053**\u6570\u5b66\u9898\uff01\uff01\uff01** \u4e0d\u9700\u8981\u90bb\u63a5\u77e9\u9635\u6216\u8005\u90bb\u63a5\u8868\uff0cO(n)\u7b97\u6cd5\u5c31\u53ef\u4ee5\u8fc7\u3002\n\u90a3\u8fd9\u9053\u9898\u600e\u4e48\u7528\u6570\u8bba\u505a\u5462\uff1f\u4e0e\u5927\u5bb6\u5206\u4eab\u4e00\u4e2a\u516c\u5f0f\n##### - - \u5982\u679c\u6709\u4e00\u7ec4\u6570\uff0c\u6211\u4eec\u8981\u6c42\u5b83\u4eec\u4e24\u4e24\u76f8\u4e58\u7684\u548c\uff0c\u90a3\u6211\u4eec\u6240\u6c42\u7684\u503c\u5c31\u7b49\u4e8e\u8fd9\u7ec4\u6570\u7684\u548c\u7684\u5e73\u65b9\u51cf\u53bb\u5b83\u4eec\u5206\u522b\u7684\u5e73\u65b9\nO(\u2229_\u2229)O~\u662f\u4e0d\u662f\u770b\u8d77\u6765\u6709\u70b9\u614c\uff0c\u522b\u614c\u522b\u614c\u4e3e\u51e0\u4e2a\u4f8b\u5b50\n\n2ab=(a+b)^2-a^2-b^2\n\n2ab+2ac+2bc=(a+b+c)^2-a^2-b^2-c^2\n\n**\u4ee5\u6b64\u7c7b\u63a8**\n\n\u90a3\u8fd9\u4e2a\u516c\u5f0f\u5bf9\u8fd9\u9053\u9898\u6709\u4ec0\u4e48\u7528\u5462\uff1f\u6211\u4eec\u6765\u770b\uff0c![undefined](https://cdn.luogu.com.cn/upload/pic/1347.png)\n\n\u8fd9\u9053\u9898\u8981\u6c42\u7684\u5c31\u662f\u4e00\u4e2a\u70b9\u4e24\u8fb9\u8fde\u63a5\u70b9\u7684\u4e58\u79ef\u548c\uff0c\u90a3\u6211\u4eec\u53ea\u9700\u8981\u679a\u4e3e\u5404\u4e2a\u4e2d\u95f4\u70b9\uff0c\u5c06\u8fd9\u4e2a\u70b9(\u6bd4\u5982\u8bf4i)\u6240\u8fde\u63a5\u70b9\u7684\u6743\u503c\u5b58\u5230\u4e0b\u6807\u4e3a\u8fd9\u4e2a\u70b9\u7684\u6570\u7ec4he[i]\u91cc\uff0c\u518d\u628a\u5404\u4e2a\u70b9\u7684\u6743\u503c\u5e73\u65b9\u540e\u52a0\u5230\u53e6\u4e00\u4e2a\u6570\u7ec4cheng[i]\u91cc\uff0c\u6700\u540e\u4ee3\u5165\u516c\u5f0f\u6c42\u51fa\u6765\u6240\u6c42\u5c31\u597d\u4e86\n\n\u90a3\u6700\u5927\u503c\u600e\u4e48\u529e\u5462\uff1f\u5728\u679a\u4e3e\u70b9\u7684\u65f6\u5019\u628a\u4e00\u4e2a\u70b9\u4e0a\u6700\u5927\u7684\u4e24\u4e2a\u6743\u503c\u4fdd\u5b58\u5728\u4e24\u4e2a\u6570\u7ec4\u91cc\u5c31\u597d\u4e86\u554a~~~~\n\n\u6700\u540e\u8fd9\u9053\u9898\u6709\u4e00\u79cd\u5f88\u5de7\u5999\u679a\u4e3e\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u628a\u6bcf\u6761\u8fb9\u5b58\u4e0b\u6765\u518d\u6328\u4e2a\u8fb9\u52a0\u4e00\u904d\u5c31\u884c\u4e86\u6240\u4ee5\u770b\u8d77\u6765\u50cf\u662f\u679a\u4e3e\u8fb9(#^.^#)\uff0c\u8fd9\u6837\u5c31\u7701\u4e86\u5b58\u56fe\u6216\u8005\u5efa\u90bb\u63a5\u8868\u7684\u65f6\u95f4\u548c\u7a7a\u95f4\u3002\n\n\u6765\u770b\u4ee3\u7801\n```\n#include<iostream>\n#include<cstdio>\nusing namespace std;\nint u[200001],v[200001],w[200001],max1[200002],max2[200001];\nlong long he[200001],cheng[200001];\nlong long ans,max3;//\u4e00\u5b9a\u8981\u5f00long long\nint main()\n{\n\tint n;//\u9876\u70b9\u6570\n\tmax3=0;//\u6700\u540e\u7684\u6700\u5927\u503c\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n-1;i++)\n\t{\n\t\tscanf(\"%d %d\",&u[i],&v[i]);//\u5b58\u8fb9\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d\",&w[i]);//\u5b58\u6bcf\u4e2a\u70b9\u7684\u6743\u503c\n\t}\n    //\u4e0b\u9762\u662f\u7b97\u6cd5\u6838\u5fc3\n\tfor(int i=1;i<=n-1;i++)\n\t{\n\the[u[i]]=he[u[i]]+w[v[i]];//\u628a\u4e0eu[i]\u76f8\u8fde\u7684\u70b9\u7684\u6743\u503c\u52a0\u8fdbhe[u[i]]\u91cc\uff1b\n\the[v[i]]=he[v[i]]+w[u[i]];//\u65e0\u5411\u56fe\u53cd\u7740\u52a0\u4e00\u904d\uff1b\n\tcheng[u[i]]=cheng[u[i]]+w[v[i]]*w[v[i]];//\u8fd9\u662f\u4e58\u65b9\u7684\u548c\uff1b\n\tcheng[v[i]]=cheng[v[i]]+w[u[i]]*w[u[i]];\n    //\u4e0b\u9762\u662f\u5224\u65ad\u6bcf\u4e2a\u70b9\u6240\u8fde\u7684\u6700\u5927\u503c\u4e0e\u7b2c\u4e8c\u5927\u7684\u503c\n\tif(w[v[i]]>max1[u[i]])\n\t{\n\t\tmax2[u[i]]=max1[u[i]];\n\t\tmax1[u[i]]=w[v[i]];\n\t}\n\telse if(w[v[i]]>max2[u[i]])\n\t{\n\t\tmax2[u[i]]=w[v[i]];\n\t}\n\tif(w[u[i]]>max1[v[i]])\n\t{\n\t\tmax2[v[i]]=max1[v[i]];\n\t\tmax1[v[i]]=w[u[i]];\n\t}\n\telse if(w[u[i]]>max2[v[i]])\n\t{\n\t\tmax2[v[i]]=w[u[i]];\n\t}\n\t}//\u52a0\u5b8c\u5566O(\u2229_\u2229)O~\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tans=(ans+he[i]*he[i]-cheng[i])%10007;//\u4ee3\u516c\u5f0f\uff0c\u522b\u5fd8\u4e86mod10007\uff1b\n\t\tif(max1[i]*max2[i]>max3)\n\t\t{\n\t\t\tmax3=max1[i]*max2[i];//\u5224\u65ad\u6700\u5927\u503c\n\t\t}\n\t}\n\tprintf(\"%lld %lld\",max3,ans);//\u8f93\u51fa\n    return 0;\n}\n```\n\n\n#### \u4e0d\u4f1a\u90bb\u63a5\u8868\u7684\u7ae5\u978b\u770b\u8fc7\u6765\uff01\uff01\uff01\u7eaf\u6a21\u62df\u52a0\u6570\u8bba\n\n### \u672c\u9898\u89e3\u672a\u7528\u4efb\u4f55\u9ad8\u7ea7\u7b97\u6cd5\u5927\u4f6c\u4eec\u52ff\u55b7\uff0c\u2014\u2014\u81ea\u52a8\u5ffd\u7565\u5c31\u597d\\\\(^o^)/~\n### \u5e0c\u671b\u5bf9\u5927\u5bb6\u6709\u6240\u5e2e\u52a9\uff0c\u6709\u4e0d\u5bf9\u7684\u5730\u65b9\u8fd8\u8bf7\u5927\u4f6c\u4eec\u6307\u6559\uff0c\u4e0d\u559c\u52ff\u55b7\u554aO(\u2229_\u2229)O\u54c8\u54c8~",
        "postTime": 1543655328,
        "uid": 136297,
        "name": "riker_moon",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u867d\u7136\u4e00\u4e0b\u5c31\u505a\u51fa\u6765\u4e86\u4f46\u8fd8\u662f\u4e0d\u88c5\u903c\u4e86\uff08~~\u771f\u9999~~\uff09\u3002\n\n\u9996\u5148\uff0c\u8f93\u5165\u6570\u636e\u544a\u8bc9\u4f60\u8fd9\u662f\u4e00\u9897\u6811\u3002\n\n\u5176\u6b21\uff0c\u6211\u4eec\u6c42\u7684\u662f\u70b9i\u4e0e\u548c\u5b83\u8ddd\u79bb\u4e3a2\u7684\u6240\u6709\u70b9\u7684\u4e58\u79ef\u3002\n\n\u4e0d\u5982\u6211\u4eec\u5148\u641e\u5b9a\u6743\u503c\u548c\u5427\uff0c\n\n\u6240\u6709 \u4e0e\u70b9i\u8ddd\u79bb\u4e3a2\u7684\u70b9\u90fd\u662f \u4e0e \u4e0e\u70b9i\u8ddd\u79bb\u4e3a1 \u7684\u70b9 \u76f8\u90bb\u7684\u70b9\uff0c\n\n\u8bbe\u8fd9\u4e9b\u4e0e\u70b9i\u8ddd\u79bb\u4e3a1\u7684\u70b9\u7684\u96c6\u5408\u4e3aA\uff0c\n\n\u7531\u4e58\u6cd5\u7ed3\u5408\u5f8b(\u5c0f\u5b66\u7684\u77e5\u8bc6)\u77e5\u7531(i,j\u5c5e\u4e8eA)\u8d21\u732e\u7684\u7b54\u6848\u4e3a\uff1a\n\n###  \u70b9i\u7684\u6743\u503c*(\u4e0e\u70b9j\u76f8\u90bb\u7684\u70b9\u7684\u6743\u503c\u548c-\u70b9i\u7684\u6743\u503c) \n\n\u4e0e\u70b9j\u76f8\u90bb\u7684\u70b9\u7684\u6743\u503c\u548cO(n)\u9884\u5904\u7406\u4e00\u904d\u5c31\u597d\u3002\n\n\u8fd9\u6837\u628a \u4ee5\u6bcf\u4e2a\u70b9\u4e3a\u6709\u5e8f\u70b9\u5bf9\u7b2c\u4e00\u9879 \u7684\u6240\u6709\u7b54\u6848\u503c\u52a0\u8d77\u6765(\u5c31\u662f\u6bcf\u4e2a\u70b9\u8d21\u732e\u7684\u7b54\u6848\u4e4b\u548c)\u5c31\u662f\u5168\u56fe\u7684\u6743\u503c\u548c\u4e86\u3002\n\n#### \u6ce8\u610f\uff1a\u6211\u4eec\u8fd9\u4e48\u505a\u662f\u6709\u5411\u7684\uff0c\u6240\u4ee5\u4e0d\u7528\u5c06\u7b54\u6848*2\uff01\n\n\u63a5\u4e0b\u6765\u641e\u6700\u5927\u70b9\u5bf9\u7684\u503c\uff0c\n\n\u6211\u4eec\u524d\u9762\u5728\u9884\u5904\u7406\u7684\u540c\u65f6\u627e\u51fa\u4e0e\u70b9j\u76f8\u90bb\u7684\u70b9\u4e2d\u6743\u503c\u6700\u5927\u7684\u70b9\u548c\u6b21\u5927\u7684\u70b9\u5c31\u597d\u4e86\uff0c\n\n\u56e0\u4e3a\u540e\u9762\u7b97\u7684\u65f6\u5019\u4e0d\u80fdi\u70b9\u548c\u81ea\u5df1\u914d\u5bf9\uff0c\n\n\u6240\u4ee5i\u70b9\u5982\u679c\u662fj\u70b9\u76f8\u90bb\u70b9\u4e2d\u6700\u5927\u7684\u5c31\u627e\u6b21\u5927\u7684\u548ci\u7684\u6743\u503c\u76f8\u4e58\uff0c\u5426\u5219\u4e0e\u6700\u5927\u503c\u76f8\u4e58\uff0c\u7b97\u5f97\u7684\u503c\u7528\u4e00\u4e2amaxx(\u521d\u59cb\u503c=0)\u53d8\u91cf\u5b58\u4e0b\u6700\u5927\u7684\u5c31\u597d\u5566\uff01\n\n\u53ef\u80fd\u6709\u70b9\u5570\u55e6\u4f46\u8fd9\u5c31\u662f\u6211\u505a\u7684\u65f6\u5019\u7684\u60f3\u6cd5\uff0c\u770b\u4e86\u6807\u7b7e\u4ec0\u4e48LCA\u3001\u52a8\u5f52\uff0c\u60ca\u4e86\u3002\n\n\u5bf9\u4e86\uff0c\u8fd8\u8981\u6ce8\u610fmaxx\u4e0d\u8981\u53d6\u6a21\uff01\u6211\u4e00\u5f00\u59cb\u53d6\u4e86\u6a21\u53ea\u670940\u5206\uff01\n\n\u4e0b\u9762\u8d34\u4ee3\u7801qwq\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std; \nint n,a[200001],v[200001],Ma1[200001],Ma2[200001];//Ma1[i],Ma2[i]\u5206\u522b\u662f\u4e0e\u70b9i\u76f8\u90bb\u7684\u6700\u5927\u70b9\u548c\u6b21\u5927\u70b9\uff0cv\u662f\u76f8\u90bb\u70b9\u6743\u503c\u548c \nint first[200001],next[400005],to[400005],ans,maxx,MOD=10007;\nint main()  \n{  \n    scanf(\"%d\",&n);\n    int xx,yy;\n    for(int i=1;i<n;i++)\n    {\n    \tscanf(\"%d%d\",&xx,&yy);//\u90bb\u63a5\u8868\u5b58\u56fe \n    \tnext[i]=first[xx];\n    \tfirst[xx]=i;\n    \tto[i]=yy;\n    \tnext[i+n-1]=first[yy];\n    \tfirst[yy]=i+n-1;\n    \tto[i+n-1]=xx;\n\t}\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint k=first[i];\n\t\twhile(k)\n\t\t{\n\t\t\tv[i]+=a[to[k]];\n\t\t\tif(a[to[k]]>Ma1[i]){Ma2[i]=Ma1[i];Ma1[i]=a[to[k]];}\n\t\t\telse if(a[to[k]]>Ma2[i]){Ma2[i]=a[to[k]];}\n\t\t\tv[i]%=MOD;\n\t\t\tk=next[k];\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint k=first[i],p;\n\t\twhile(k)\n\t\t{\n\t\t\tans+=a[i]*(v[to[k]]-a[i]);\n\t\t\tans%=MOD;\n\t\t\tif(Ma1[to[k]]==a[i]) p=Ma2[to[k]];\n\t\t\telse p=Ma1[to[k]];\n\t\t\tp*=a[i];\n\t\t\tmaxx=max(maxx,p);\n\t\t\tk=next[k];\n\t\t}\n\t}\n\tprintf(\"%d %d\",maxx,ans);\n    return 0;  \n}  \n\n```",
        "postTime": 1541431701,
        "uid": 77848,
        "name": "\u5c0f\u9f2c\u5b50",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u5176\u5b9e\u8fd9\u9898\u662f\u4e2a\u66b4\u529b\u3002\u3002\u3002\n\n### \u66b4\u529b\uff01\uff01\uff01\n\n## \u66b4\u529b\uff01\uff01\uff01\n\n# \u66b4\u529b\uff01\uff01\uff01\n\n\u4e3a\u4ec0\u4e48\u6211\u624d\u77e5\u9053\u3002\u3002\u3002\n\n## \u54b3\u54b3\uff0c\u8fdb\u5165\u6b63\u9898\u3002\u3002\u3002\n\n### \u6211\u4eec\u89c2\u5bdf\u9898\u76ee\uff0c\u60f3\u8c61\uff1a\u5982\u679c\u56fe\u4e0a\u53ea\u6709\u4e09\u4e2a\u70b9\uff0c\u6211\u4eec\u5982\u4f55\u5904\u7406\uff1f\n\n** \u663e\u7136\uff0c\u627e\u5230\u4e2d\u95f4\u90a3\u4e2a\u70b9\u5c31\u884c\u4e86\u3002 **\n\n\u6b64\u5904\u53ef\u4ee5\u8bb0\u5f55\u6bcf\u4e2a\u8282\u70b9\u76f8\u90bb\u7684\u8fb9\u6570\uff08\u6211\u7528vector\u505a......size()\u5c31\u662f\u6211\u60f3\u8981\u7684\u4e1c\u897f\u54af\uff09\uff0c\u53ea\u8981\u5927\u4e8e1\u5c31\u8ba1\u7b97\u4e00\u904d\uff0c\u7edf\u8ba1\u5165\u7b54\u6848\u4e2d\u3002\n\n\u603b\u548c\u8bb0\u4e3asum\uff0c\u6700\u5927\u8054\u5408\u6743\u503c\u8bb0\u4e3amaxn\u3002\n\n## \u73b0\u5728\u89e3\u51b3\u8ba1\u7b97\u7684\u95ee\u9898\u3002\n\n### \u6c42\u6700\u5927\u8054\u5408\u6743\u503cmaxn\uff1a\n\n\u90fd\u8bf4\u4e86\u8981\u66b4\u529b\uff0c\u662f\u8981\u626b\u8fc7\u6240\u6709\u8282\u70b9\u7684\uff0c\u6240\u4ee5\u4e00\u4e2a\u8282\u70b9\u4e00\u4e2a\u8282\u70b9\u6765\u8003\u8651\u3002\u3002\u3002\n\n** \u663e\u7136\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u8282\u70b9\u6765\u8bf4\uff0c\u6700\u5927\u8054\u5408\u6743\u503c\u5e94\u4e3a:\u4e0e\u5b83\u76f8\u8fde\u7684\u8282\u70b9\u4e2d\uff0c\u6743\u503c\u6700\u5927\u7684\u4e24\u4e2a\u8282\u70b9\u3002 **\n\n\u627e\u8fd9\u4e24\u4e2a\u70b9\u7684\u4ee3\u7801\u6bb5\uff1a\n\n\u5176\u4e2d\uff0cw[ i ]\u4e3a i \u70b9\u7684\u6743\u503c\uff0ctree[ i ][  ]\u4e3a \u4e0e i \u70b9\u76f8\u8fde\u7684\u70b9\uff0c\u662f\u4e2avector\u6570\u7ec4\uff0cmax1,max2\u5373\u4e3a\u6743\u503c\u7b2c1\u5927\u548c\u7b2c2\u5927\u7684\u70b9\u3002\n\n```cpp\n   if(w[tree[i][j]] >= max1) {\n    max2=max1;\n    max1=w[tree[i][j]];\n    }\n    else if(w[tree[i][j]] > max2) {\n         max2=w[tree[i][j]];\n    }\n```\n\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u90fd\u8fd9\u4e48\u5904\u7406\u8fc7\u4e4b\u540e\uff0c\u6700\u5927\u8054\u5408\u6743\u503c\u5c31\u5904\u7406\u54af\uff08\u62a0\u9f3b\uff09\u3002\u3002\u3002\n\n### \u8ba1\u7b97sum\u3002\n\n\u4ecd\u7136\u5148\u8003\u8651\u4e00\u4e2a\u8282\u70b9\uff0c\u8054\u7cfb\u6211\u4eec\u4e0a\u9762\u8003\u8651\u8fc7\u7684\u95ee\u9898\uff0c\u4e09\u4e2a\u70b9\u7684\u8054\u5408\u6743\u503c\uff0c\u53ea\u8981\u627e\u5230\u90a3\u4e2a\u4e0e\u53e6\u5916\u4e24\u4e2a\u70b9\u90fd\u76f8\u8fde\u7684\u201c\u4e2d\u5fc3\u70b9\u201d\u5373\u53ef\u3002\n\n### \u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e\u6240\u6709\u80fd\u8054\u5408\u7684\u70b9\u5bf9\u6765\u8bf4\uff0c\u4e00\u5b9a\u5b58\u5728\u4e00\u4e2a\u201c\u4e2d\u5fc3\u70b9\u201d\u4e0e\u5b83\u4fe9\u76f8\u8fde\u3002\n\n### \u6240\u4ee5\u5bf9\u4e8e\u4e00\u4e2a\u70b9\u6765\u8bf4\uff0c\u53ea\u8981\u5b83\u76f8\u8fde\u7684\u8fb9\u6570\u5927\u4e8e1\uff0c\u5b83\u5c31\u4e00\u5b9a\u662f\u67d0\u4e24\u4e2a\uff08\u6216\u591a\u4e2a\uff09\u70b9\u7684\u201c\u4e2d\u5fc3\u70b9\u201d\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u626b\u8fc7\u6240\u6709\u8fb9\u6570\u5927\u4e8e1\u7684\u70b9\uff0c\u5c06\u4e0e\u5b83\u76f8\u8fde\u7684\u6240\u6709\u70b9\u4e24\u4e24\u8054\u5408\u4e00\u904d\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u5047\u8bbe\u5f53\u524d\u626b\u5230\u7684\u8fd9\u4e2a\u70b9\u4e3as\uff0c\u5e76\u4e14s\u53ef\u4ee5\u4f5c\u4e3a\u4e2d\u5fc3\u70b9\uff0c\u8bbe\u4e0e\u5b83\u76f4\u63a5\u76f8\u8fde\u7684m\u4e2a\u70b9\uff08tree[ s ][ 0 ... m-1 ]\uff09\u4e3aa,b,c......\n\n\u4e8e\u662f\u8fd9\u4e2a\u201c\u4e2d\u5fc3\u70b9\u201d\u53ef\u4ee5\u4ea7\u751f\u7684\u6743\u503c\u4e3a(\u6211\u7528a\u6765\u4ee3\u8868w[ a ]...\u5927\u5bb6\u4e0d\u8981\u55b7\u6211\u61d2QAQ)\n\nsum=ab+ac+ad+\u2026\u2026+ba+bc+bd+\u2026\u2026+ca+cb+cd+\u2026\u2026\n\n### (\u597d\u591a\u3002\u3002\u3002)\n\n\u4f18\u5316\u4e00\u4e0b\uff1a\n\n\u89c2\u5bdf\uff08\u5047\u8bbem=5\uff09\uff1aab+ac+ad+ae = a(b+c+d+e) = a(a+b+c+d+e - a)   \u663e\u7136\u8fd9\u662f\u5bf9\u7684\u3002\u3002\n\n\u6240\u4ee5  ba+bc+bd+be=b(a+b+c+d+e - b)\n\nca+cb+cd+ce=c(a+b+c+d+e - c)\n\nda+db+dc+de=d(a+b+c+d+e - d)\n\nea+eb+ec+ed=e(a+b+c+d+e - e)\n\n\u89c2\u5bdf\u4e0a\u5f0f\uff0c\u53d1\u73b0\u7b49\u5f0f\u53f3\u8fb9\u90fd\u5b58\u5728** a+b+c+d+e **\u7684\u5f0f\u5b50\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u5176\u5b9e\u5c31\u662f\u4e0es\u76f4\u63a5\u76f8\u8fde\u7684\u6240\u6709\u70b9\u7684\u6743\u503c\u603b\u548c\uff0c\u4e8e\u662f\u5f00\u4e2a\u6570\u7ec4\uff0c\u8bb0\u4e3a** son\\_wsum[ s ] = a+b+c+d+e **\n\n\u5219\u5bf9\u4e8e\u4e0es\u76f4\u63a5\u76f8\u8fde\u7684\u6bcf\u4e2a\u8282\u70b9\uff08\u4ee5a\u4e3a\u4f8b\uff09\u4e0a\u5f0f\u53ef\u5316\u4e3a\uff1a\n\n** w[ a ]\\*(son\\_wsum[ s ] - w[ a ]) **\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u51fa\u6bcf\u4e2a\u8282\u70b9\u5468\u56f4\u6240\u6709\u76f4\u63a5\u76f8\u8fde\u7684\u7ed3\u70b9\u7684\u6743\u503c\u603b\u548c\uff0c\u7136\u540e\u626b\u4e00\u904d\u6240\u6709\u4e0e\u5b83\u76f4\u63a5\u76f8\u8fde\u7684\u70b9\uff0c\u8ba1\u7b97\u51fa\u7ed3\u679c\u5373\u53ef\u3002\n\n# son\\_wsum[ ]\u4e00\u5b9a\u8981\u5f00\u6210long long !!!\n\n\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff08\u849f\u84bb\u7684\u5783\u573e\u4ee3\u7801...\u5927\u795e\u4e0d\u8981\u55b7...\uff09\uff1a\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<vector>\n#include<cmath>\nusing namespace std;\nint w[200010],n,maxn,l,max1=0,max2=0;\nlong long son_wsum[200010];\nint sum;\nvector <int> tree[200010];\nint read()\n{\n    char c=getchar();\n    int x=0;\n    while(c<'0'||c>'9') c=getchar();\n    while(c>='0'&&c<='9') {x=x*10+c-'0',c=getchar();}\n    return x;\n}\nint main()\n{\n    n=read();\n    for(int i=1,u,v;i<n;i++) {\n        u=read();v=read();\n        tree[u].push_back(v);\n        tree[v].push_back(u);\n    }\n    for(int i=1;i<=n;i++) {\n        w[i]=read();\n    }\n    \n    for(int i=1;i<=n;i++) {\n        l=tree[i].size();\n        if(l > 1) {\n            max1=max2=0;\n            for(int j=0;j<l;j++) {\n                son_wsum[i]+=w[tree[i][j]];\n                if(w[tree[i][j]] >= max1) {\n                    max2=max1;\n                    max1=w[tree[i][j]];\n                }\n                else if(w[tree[i][j]] > max2) {\n                    max2=w[tree[i][j]];\n                }\n            }\n            maxn=max(maxn,max1*max2);\n            for(int j=0;j<l;j++) {\n                sum=(sum+(son_wsum[i]-w[tree[i][j]])*w[tree[i][j]])%10007;\n            }\n        }\n    }\n    printf(\"%d %d\",maxn,sum);\n    return 0;\n}\n\n```",
        "postTime": 1498288449,
        "uid": 37839,
        "name": "\u7d2b\u94a6",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "$$\\color{Cornflowerblue}{\\mathcal{Treaker}}$$\n# \u6811\u5f62DP\n\u8fd9\u4e0d\u5c31\u662f\u4e2a\u88f8\u7684\u6811\u5f62DP\u561b\u3002\n\n\u4e24\u4e2a\u70b9\u80fd\u4ea7\u751f\u6743\u503c\u5f53\u4e14\u4ec5\u5f53\u76f8\u8ddd2\u7684\u8ddd\u79bb\u3002\u800c\u4e14\u8981\u6c42\u6c42\u6700\u5927\u503c \u548c \u603b\u7684\u548c\u3002\n\n\u90a3\u4e48DP\u65b9\u7a0b\u5c31\u5f88\u660e\u663e\u4e86\u3002\n\n\u6211\u4eec\u8bbe$f[x][0/1]$\u8868\u793a$x$\u7684\u5b50\u6811\u5185\uff0c\u8ddd\u79bb$x$\u7684\u8ddd\u79bb\u4e3a$0/1$\u7684\u70b9\u7684\u6700\u5927\u6743\u503c\u3002\n\n\u8bbe$g[x][0/1]$\u8868\u793a$x$\u7684\u5b50\u6811\u5185\uff0c\u8ddd\u79bb$x$\u7684\u8ddd\u79bb\u4e3a$0/1$\u7684\u70b9\u7684\u6743\u503c\u548c\u3002\n\n\u8f6c\u79fb\u5373\u53ef\u3002\u3002\n```cpp\n\tans = max(ans,f[x][1] * f[to][0]);\n\tans = max(ans,f[x][0] * f[to][1]);\n\tres = (res + g[x][1] * g[to][0] % mod) % mod;\n\tres = (res + g[x][0] * g[to][1] % mod) % mod;\n\tf[x][1] = max(f[x][1],f[to][0]);\n\tg[x][1] = (g[x][1] + g[to][0]) % mod; \n```\n\u6ce8\u610f\u6700\u5927\u6743\u503c\u4e0d\u7528\u53d6\u6a21\n\n\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\nconst int N = 2e5+5 , mod = 10007;\ninline int read()\n{\n\tint x = 0, f = 1; char ch = getchar();\n\twhile(ch < '0' || ch > '9') {if(ch == '-') f = -1; ch = getchar();}\n\twhile(ch >= '0' && ch <= '9') {x = (x << 3) + (x << 1) + ch - '0'; ch = getchar();}\n\treturn x * f;\n}\nint n , ans , res;\nint a[N] , f[N][2] , g[N][2] , fa[N];\nstruct Edge\n{\n\tint to; Edge *nxt;\n\tEdge(int to,Edge *nxt) : to(to) , nxt(nxt) {}\n}*head[N];\ninline void add(int u,int v) {head[u] = new Edge(v,head[u]);}\n#define to (i -> to)\nvoid dfs(int x)\n{\n\tf[x][0] = g[x][0] = a[x];\n\tfor(Edge *i = head[x];i;i = i -> nxt)\n\t{\n\t\tif(to == fa[x]) continue;\n\t\tfa[to] = x;\n\t\tdfs(to);\n\t\tans = max(ans,f[x][1] * f[to][0]);\n\t\tans = max(ans,f[x][0] * f[to][1]);\n\t\tres = (res + g[x][1] * g[to][0] % mod) % mod;\n\t\tres = (res + g[x][0] * g[to][1] % mod) % mod;\n\t\tf[x][1] = max(f[x][1],f[to][0]);\n\t\tg[x][1] = (g[x][1] + g[to][0]) % mod; \n\t}\n}\nint main()\n{\n\tn = read();\n\tfor(int i = 1 , u , v;i < n;i ++)\n\t{\n\t\tu = read(); v = read();\n\t\tadd(u,v); add(v,u);\n\t}\n\tfor(int i = 1;i <= n;i ++) a[i] = read();\n\tdfs(1);\n\tprintf(\"%d %d\\n\",ans,res * 2 % mod);\n\treturn 0;\n}\n```\n",
        "postTime": 1571698370,
        "uid": 153898,
        "name": "Treaker",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "# \u4f5c\u4e3a\u4e00\u540d\u5c0f\u83dc\u9e21\uff0c\u5927\u4f6c\u4eec\u8981\u662f\u6709\u610f\u89c1\u8bf7\u5411\u6211\u63d0\u51fa\uff0c\u4e5f\u5e0c\u671b\u5927\u4f6c\u4eec\u591a\u591a\u9f13\u52b1\u3002\n\n\u770b\u5b8c\u9898\u5e72\u540e\uff0c\u6211\u60f3\u5230\u4e86\u4e00\u79cd\u65b9\u6cd5\uff0c\u5c31\u662f\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u5728\u679a\u4e3e\u6240\u6709\u4e0e\u5b83\u76f8\u8fde\u7684\u70b9\uff0c\u5c06\u4efb\u610f\u4e24\u4e2a\u4e0d\u76f8\u540c\u7684\u4e58\u8d77\u6765\uff0c\u6bd4\u8f83\u4e00\u4e0b\u8fd9\u662f\u4e0d\u662f\u6700\u5927\u7684\uff0c\u518d\u5c06\u8fd9\u4e2a\u503c\u4e0e\u503c\u7684\u548c\u52a0\u8d77\u6765\uff0cmod10007\uff1b\n\u6211\u7528\u7684\u90bb\u63a5\u8868\u5b58\u56fe\uff0c\u5177\u4f53\u64cd\u4f5c\u662f\u8fd9\u6837\u7684\uff1a\n\n```cpp\n\n#include<cstdio>\n#include<queue>\nusing namespace std;\nint n;\nint u[400050],v[400050],w[400050],first[200050],nxt[400050];\nlong long sum,maxn=-1;\nint main()\n{\n    scanf(\"%d\",&n);\n    for(int i=1;i<=n+1;i++)\n    {\n        first[i]=-1;\n    }\n    for(int i=1;i<=n-1;i++)//\u90bb\u63a5\u8868\u5b58\u65e0\u5411\u56fe\uff0c\n    //noip2018\u6211\u8fd9\u4f4d\u5c0f\u83dc\u9e21\u5728\u8003\u573a\u4e0a\u597d\u4e0d\u5bb9\u6613\u624d\u60f3\u51fa\u6765\u7684\n    //\u5927\u4f6c\u4eec\u6709\u66f4\u597d\u7684\u65b9\u6cd5\u8bf7\u6307\u6559\u3002\n    {\n        scanf(\"%d%d\",&u[i],&v[i]);\n        nxt[i]=first[u[i]];\n        first[u[i]]=i;\n        u[i+n]=v[i];\n        v[i+n]=u[i];\n        nxt[i+n]=first[u[i+n]];\n        first[u[i+n]]=i+n;\n    }\n    for(int i=1;i<=n;i++)\n    {\n        scanf(\"%d\",&w[i]);\n    }\n    int k,k1;\n    long long z;\n    for(int i=1;i<=n;i++)//\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9i\n    {\n        k=first[i];\n        while(k!=-1)//\u679a\u4e3e\u6bcf\u4e00\u4e2a\u4e0ei\u6709\u8fb9\u7684\u70b9k\n        {\n            k1=first[i];\n            while (k1!=-1\uff09//\u679a\u4e3e\u6bcf\u4e00\u4e2a\u4e0ei\u6709\u8fb9\u7684\u70b9k1\n            {\n                if(k1==k)//\u5224\u65adk\u4e0ek1\u662f\u4e0d\u662f\u540c\u4e00\u4e2a\u70b9\n                {\n                    k1=nxt[k1];\n                    continue;\n                }\n                z=w[v[k]]*w[v[k1]];//\u4e58\u8d77\u6765\n                if(z>maxn)maxn=z;//\u6bd4\u8f83\u5927\u5c0f\n                sum=(z%10007+sum)%10007;//\u6c42\u548c\n                k1=nxt[k1];\n            }\n            k=nxt[k];\n        }\n    }\n    printf(\"%lld %lld\",maxn,sum);//\u8f93\u51fa\n}\n\n```\n### \u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u4e2a\u7b97\u6cd5\u65f6\u95f4\u590d\u6742\u5ea6\u5f88\u9ad8\uff0c\u800c\u4e14\u6709\u5f88\u591a\u5e9f\u8bdd\u3002\n\u4e8e\u662f\u6539\u8fdb\u7b97\u6cd5\uff1a\n\u8d34\u4ee3\u7801\n```cpp\n#include<cstdio>\n#include<queue>\nusing namespace std;\nint n;\nint u[400050],v[400050],w[400050],first[200050],nxt[400050];\nlong long sum,maxn=-1;\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n+1;i++)\n\t{\n\t\tfirst[i]=-1;\n\t}\n\tfor(int i=1;i<=n-1;i++)\n\t{\n\t\tscanf(\"%d%d\",&u[i],&v[i]);\n\t\tnxt[i]=first[u[i]];\n\t\tfirst[u[i]]=i;\n\t\tu[i+n]=v[i];\n\t\tv[i+n]=u[i];\n\t\tnxt[i+n]=first[u[i+n]];\n\t\tfirst[u[i+n]]=i+n;\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d\",&w[i]);\n\t}\n\tint k,k1;\n\tlong long z;\n\tlong long sum1,sum2,sum3,maxn1,maxn2,sum4;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tsum1=0;\n\t\tsum3=0;\n\t\tmaxn1=-1;\n\t\tmaxn2=-1;\n\t\tk=first[i];\n\t\twhile(k!=-1)\n\t\t{\n\t\t\tsum1+=w[v[k]];\n\t\t\tsum3+=w[v[k]]*w[v[k]];\n\t\t\tif(w[v[k]]>maxn1)\n\t\t\t{\n\t\t\t\tmaxn2=maxn1;\n\t\t\t\tmaxn1=w[v[k]];\n\t\t\t}\n\t\t\telse if(w[v[k]]>maxn2)\n\t\t\tmaxn2=w[v[k]];\n\t\t\tk=nxt[k];\n\t\t}\n\t\tsum2=(sum1*sum1-sum3)%10007;\n\t\tsum4=maxn1*maxn2;\n\t\tif(sum4>maxn)maxn=sum4;\n\t\tsum=(sum+sum2)%10007;\n\t}\n\tprintf(\"%lld %lld\",maxn,sum);\n}\n```\n\u8fd9\u4e2a\u7b97\u6cd5\u7684\u57fa\u672c\u601d\u8def\u4e0e\u4e0a\u4e00\u4e2a\u662f\u4e00\u6837\u7684\uff0c\u5148\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\u3002\n\u7136\u800c\u6211\u4eec\u77e5\u9053\uff1a2ab+2bc+2ac=\uff08a+b+c\uff09^2-a^2-b^2-c^2;\n2ab+2bc+2ac+2ad+2bd+2cd=\uff08a+b+c+d\uff09^2-a^2-b^2-c^2-d^2;......\n# \u6240\u4ee5\uff0c\n```cpp\nwhile(k!=-1)\n{\n    sum1+=w[v[k]];//\u76f8\u5f53\u4e8ea+b+c;\n\tsum3+=w[v[k]]*w[v[k]];//\u76f8\u5f53\u4e8ea^2+b^2+c^2;\n\tif(w[v[k]]>maxn1)//\u627e\u6700\u5927\u7684\u4e24\u4e2a\u6743\u503c\n\t{\n\t\tmaxn2=maxn1;\n\t\tmaxn1=w[v[k]];\n\t}\n\t\telse if(w[v[k]]>maxn2)\n\t\tmaxn2=w[v[k]];\n\tk=nxt[k];\n}\nsum2=(sum1*sum1-sum3)%10007;//\u6c42\u503c\nsum4=maxn1*maxn2;\nif(sum4>maxn)maxn=sum4;//\u6bd4\u8f83\u5927\u5c0f\nsum=(sum+sum2)%10007;//\u6c42\u548c\n```\n\n# \u60a8\u660e\u767d\u4e86\u5417\uff1f\u6211\u7684\u9898\u89e3\u5bf9\u60a8\u6709\u5e2e\u52a9\u5417\uff1f\n\u6c42\u9f13\u52b1\n\n",
        "postTime": 1543504270,
        "uid": 121646,
        "name": "sunxiaofan",
        "ccfLevel": 6,
        "title": "86\u9898\u796d \u6211\u7684\u7b2c\u4e00\u7bc7\u9898\u89e3 P1351\u8054\u5408\u6743\u503c"
    },
    {
        "content": "### \u6b64\u9898\u538b\u6839\u5c31\u4e0d\u9700\u8981\u4ec0\u4e48\u6811\u5f62DP\u4e4b\u7c7b\u7684\u4e1c\u897f\uff0c\u7528\u6570\u5b66\u65b9\u6cd5\u5c31\u89e3\u51b3\u4e86\u3002                \n### \u6211\u7684\u601d\u8def\uff1a          \n\u8bbe\u8ddf\u7b2c$i$\u4e2a\u8282\u70b9\u76f8\u8fde\u7684\u70b9\u4e3a$W_1,W_2,W_3....$\u90a3\u4e48\u6211\u4eec\u5047\u8bbe\u8ddf\u7b2c$i$\u4e2a\u8282\u70b9\u76f8\u8fde\u7684\u6709$n$\u4e2a\u70b9\uff0c\u90a3\u4e48\u8fd9\u4e9b\u70b9\u7684\u6743\u503c\u81ea\u7136\u5c31\u662f\uff1a    \n$$W_1*W_2+W_1*W_3+W_1*W_4....+W1*W_n+W_2*W_1+...+W_n*W_{n-1}$$       \n\n\u8fd9\u4e9b\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u662f\u4e00\u5b9a\u4e3a$2$\u7684\uff0c\u4e3a\u4ec0\u4e48\uff1f \u56e0\u4e3a\u8fd9\u4e9b\u70b9\u662f\u5df2\u7b2c$i$\u4e2a\u70b9\u4e3a\u4e2d\u5fc3\u7684\u70b9\uff0c\u5176\u4e2d\u7b2c$i$\u4e2a\u70b9\u8ddf\u8fd9\u4e24\u4e2a\u70b9\u90fd\u662f\u76f4\u63a5\u8fde\u8fb9\uff0c\u6240\u4ee5\u8ddd\u79bb\u4e00\u5b9a\u4e3a$2$\u3002     \n\u6709\u6ca1\u6709\u627e\u5230\u89c4\u5f8b\uff1a**\u6211\u4eec\u53d1\u73b0\u5df2\u7b2c$i$\u4e2a\u4e3a\u4e2d\u5fc3\u7684\u70b9\u7684\u7efc\u5408\u6743\u503c\u4e4b\u548c\u5c31\u662f\u9664\u4e86\u8fd9\u4e2a\u70b9\u672c\u8eab\u4ee5\u5916\u7684\u5176\u4ed6\u7684\u70b9\u4e0e\u8fd9\u4e2a\u70b9\u7684\u79ef\u3002**                \n\u90a3\u4e48\u6211\u4eec\u5c31\u4e0d\u59a8\u5148\u628a\u4e0a\u9762\u8fd9\u4e2a\u5f0f\u5b50\u52a0\u4e0a       \n$$W_1^2+W_2^2+...+W_n^2$$            \n\n\u4e8e\u662f\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u53d8\u6210\u4e86\uff1a              \n$$(W_1+W_2+W_3+..+W_4)^2$$             \n\u4f46\u662f\u6211\u4eec\u52a0\u4e0a\u4e86\u4e0a\u9762\u7684\u8fd9\u5768\u73a9\u610f\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u8981\u51cf\u6389\uff0c\u4e8e\u662f\u5f0f\u5b50\u5c31\u53d8\u6210\u4e86:               \n$$(W_1+W_2+W_3+..+W_4)^2-(W_1^2+W_2^2+...+W_n^2)$$            \n\u597d\u4e86\uff0c\u73b0\u5728\u90fd\u5f52\u7eb3\u5b8c\u4e86\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u8bb2\u5982\u679c\u5c06\u8fd9\u4e2a\u56fe\u5b58\u4e0b\u6765\u3002           \n#### \u90a3\u4e48\u5982\u4f55\u627e\u5230\u6700\u5927\u7684\u8054\u5408\u6743\u503c\uff1f     \n\u7b54\u6848\u662f\uff1a\u5f00\u4e24\u4e2a\u6570$firmax$\u548c$secmax$\u627e\u5230\u4e24\u4e2a\u6743\u6700\u5927\u7684\u70b9\uff0c\u7136\u540e\u4e58\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\u3002\u3002\n### \u5982\u4f55\u5b58\u8fd9\u4e2a\u56fe\uff1f\uff08\u5982\u679c\u4f60\u4f1a\u5b58\uff0c\u53ef\u4ee5\u8df3\u8fc7\uff09\n\u5f00\u4e00\u4e2a$vector$\u6570\u7ec4\uff0c\u5176\u4e2d$v[i]$\u8868\u793a\u7684\u662f\u4e0e\u7b2c$i$\u4e2a\u70b9\u76f8\u8fde\u7684\u70b9\u3002\u56e0\u4e3a\u8fd9\u5f20\u56fe\u6ca1\u6709\u8fb9\u6743\uff0c\u6240\u4ee5\u6211\u4eec\u8fd9\u4e2a$vector$\u7684\u7c7b\u578b\u5199$int$\u5c31\u597d\u4e86\u3002          \n\u8fd9\u65f6\u6211\u4eec\u5728\u5355\u72ec\u5f00\u4e00\u4e2a\u6570\u7ec4$a$,\u628a\u6bcf\u4e2a\u70b9\u7684\u6743\u5b58\u4e0b\u6765\u5c31\u597d\u4e86\u3002          \n### \u8bdd\u4e0d\u591a\u8bf4\uff0c\u770b\u4ee3\u7801\uff1a        \n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define MAXN 200010\nusing namespace std;\nll n,m,i,j,k,u,v,sum,maxn;\nvector<ll> g[MAXN];\nll a[MAXN];\nnamespace Fastio{\n    ll read(){//\u5feb\u901f\u8f93\u5165\n        ll x=0;char c=getchar();\n        while(!isdigit(c)) c=getchar();\n        while(isdigit(c)) {x=x*10+c-48;c=getchar();}\n        return x;\n    }\n    void write(ll x){//\u5feb\u901f\u8f93\u51fa\n        if(x/10>0) write(x/10);\n        putchar(x%10+48);\n        return;\n    }\n}\nusing namespace Fastio;\nvoid noip(ll x){  //\u4e0d\u7528\u5728\u610f\u51fd\u6570\u540d\uff0c\u5b9e\u5728\u60f3\u4e0d\u5230\u4ec0\u4e48\u597d\u7684\u540d\u5b57\u4e86= =\n    ll i,j,sec_max=0,fir_max=0,s=0,s1=0;\n    for(i=0;i<g[x].size();i++){\n    \ts=(s+a[g[x][i]])%10007;\n        //\u52a0\u4e0aw1+w2+w3..+wn\n    \ts1=(s1+(a[g[x][i]]%10007*a[g[x][i]]%10007))%10007;\n        // \u52a0\u4e0aw1^2+w2^2+...+wn^2\n    \tif(a[g[x][i]]>fir_max){//\u53d6\u51fa\u6743\u6700\u5927\u7684\u4e24\u4e2a\u70b9\n    \t\tsec_max=fir_max;\n    \t\tfir_max=a[g[x][i]];\n    \t}\n    \telse if(a[g[x][i]]>sec_max) sec_max=a[g[x][i]];\n    }\n    sum=(sum+(s*s%10007-s1+10007))%10007;\n    //\u5c06\u603b\u548c\u52a0\u5165\u68d5\u503c\n   \tmaxn=max(maxn,fir_max*sec_max);\n    //\u5224\u65ad\u8fd9\u56de\u5408\u662f\u5426\u8fd9\u4e2a\u6570\u5927\u4e8e\u76ee\u524d\u6700\u5927\u7684\u8054\u5408\u6743\u503c\uff0c\u6ce8\u610f\u4e0d\u80fd%10007\uff0c\u5426\u5219\u53ea\u670920\u5206= =\n}\nint main(){\n    //freopen(\"link.in\",\"r\",stdin);\n    //freopen(\"link.out\",\"w\",stdout);\n    n=read();\n    for(i=1;i<=n-1;i++){\n        u=read();v=read();//\u8f93\u5165\u8fb9\n        if(u>v) swap(u,v);//\u8fd9\u53e5if\u5176\u5b9e\u6ca1\u6709\u5fc5\u8981\uff0c\u540e\u6765\u61d2\u7684\u5220\u4e86\n        g[u].push_back(v);//\u65e0\u5411\u56fe\u5b58\u4e24\u6b21\n        g[v].push_back(u);\n    }\n    for(i=1;i<=n;i++) a[i]=read();       \n    //\u8f93\u5165\u6bcf\u4e2a\u70b9\u7684\u6743\u3002\n    for(i=1;i<=n;i++) noip(i);\n    printf(\"%lld %lld\",maxn,sum);\n}\n\n```\n\n\n\n",
        "postTime": 1537115266,
        "uid": 114320,
        "name": "\u843d\u6c50",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "~~\u6dc0\u7c89\u8d28\u677f\u5b50~~\n\n\u770b\u5230\u8fd9\u79cd\u5173\u4e8e\u70b9\u5bf9\u8ddd\u79bb\u7684\u95ee\u9898\uff0c\u600e\u4e48\u80fd\u5c11\u4e86~~\u6dc0\u7c89\u8d28~~\u70b9\u5206\u6cbb\u5462\n\n~~14\u9875\u9898\u89e3\u6ca1\u6709\u4e00\u7bc7\u6dc0\u7c89\uff0c\u90a3\u6211\u5c31\u6765\u5199\u4e00\u7bc7\u5427~~\n\n---\n\n## \u601d\u8def\n\n~~\u6dc0\u7c89~~\u70b9\u5206\u5957\u8def\u90e8\u5206\u63a0\u8fc7\uff0c\u4e3b\u8981\u8bb2\u4e00\u4e0b\u600e\u4e48\u5904\u7406\u8fc7\u6839\u7684\u70b9\u5bf9\n\n\u5bf9\u6bcf\u4e2a\u5b50\u6811\u8bb0\u5f55\u4e24\u4e2a\u4fe1\u606f\uff1a$Sum[3],Max[3]$\n\n$Sum[i]$\u8868\u793a\uff08\u8ddd\u79bb\u5f53\u524d\u6839\u8282\u70b9\u8ddd\u79bb\u4e3a$i$\u7684\u70b9\uff09\u7684\u6743\u503c\u548c\n\n$Max[i]$\u8868\u793a\uff08\u8ddd\u79bb\u5f53\u524d\u6839\u8282\u70b9\u8ddd\u79bb\u4e3a$i$\u7684\u70b9\uff09\u7684\u6700\u5927\u6743\u503c\n\n\u7136\u540e\u518d\u5f00\u4e24\u4e2a\u6570\u7ec4$Pre\\_Sum[3],Pre\\_Max[3]$\n\n$Pre\\_Sum[i]$\u8868\u793a\uff08**\u4e4b\u524d\u5904\u7406\u8fc7\u7684\u6240\u6709\u5b50\u6811\u4e2d**\uff09\uff08\u8ddd\u79bb\u5f53\u524d\u6839\u8282\u70b9\u8ddd\u79bb\u4e3a$i$\u7684\u70b9\uff09\u7684\u6743\u503c\u548c\n\n$Pre\\_Max[i]$\u8868\u793a\uff08**\u4e4b\u524d\u5904\u7406\u8fc7\u7684\u6240\u6709\u5b50\u6811\u4e2d**\uff09\uff08\u8ddd\u79bb\u5f53\u524d\u6839\u8282\u70b9\u8ddd\u79bb\u4e3a$i$\u7684\u70b9\uff09\u7684\u6700\u5927\u6743\u503c\n\n## \u8ba1\u7b97\u7b54\u6848\n### \u6743\u503c\u548c\n\u8fc7\u6839\u7684\u8d21\u732e\uff1a\n$$\\sum_{\\text{\u5408\u6cd5\u6709\u5e8f\u70b9\u5bf9}(i,j)}val_i\\cdot val_j$$\n\u518d\u53d8\u4e2a\u6837\u5b50\uff1a\n$$\\sum_ival_i\\cdot\\sum_{\\text{\u80fd\u548c}i\\text{\u7ec4\u6210\u5408\u6cd5\u70b9\u5bf9\u7684}j}val_j$$\n\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u7ef4\u62a4\u7684$Pre\\_Sum$\u6570\u7ec4\u5c31\u6709\u7528\u4e86\uff0c\u5982\u679c\u4f60\u8fd8\u770b\u4e0d\u51fa\u6765\u7684\u8bdd\uff0c\u518d\u628a\u4e0a\u9762\u7684\u5f0f\u5b50\u53d8\u4e2a\u6837\u5b50\uff1a\n$$\\sum_{\\text{\u5b50\u6811}v}(\\sum_{\\text{\u5c5e\u4e8e\u5f53\u524d\u5b50\u6811\u7684\u70b9}i}val_i\\cdot\\sum_{\\text{\u4e4b\u524d\u5904\u7406\u8fc7\u7684\u5b50\u6811\u4e2d\u80fd\u548c}i\\text{\u7ec4\u6210\u5408\u6cd5\u70b9\u5bf9\u7684}j}val_j)$$\n\u7136\u540e\u4f60\u5c31\u4f1a\u53d1\u73b0\u7b2c\u4e09\u4e2a$\\sum$\u5c31\u662f\u6211\u4eec\u7ef4\u62a4\u7684$Pre\\_Sum$\uff0c\u7b2c\u4e8c\u4e2a$\\sum$\u5c31\u662f\u6211\u4eec\u7ef4\u62a4\u7684$Sum$\n\n### \u6700\u5927\u6743\u503c\n\u548c*\u6743\u503c\u548c\u7684\u7ef4\u62a4* \u540c\u7406\n### $Code$\n```cpp\nfor(register int i=0; i<=2; i++){\n\tMax_Val = max(Max_Val,Pre_Max[i]*SubTree_Max[2-i]);\n\tSum = (Sum+Pre_Sum[i]*SubTree_Sum[2-i]%MOD)%MOD;\n}\n```\n\n## \u7ef4\u62a4\n\u7ef4\u62a4\u561b\u2026\u2026~~\u663e\u7136~~\n\n\u76f4\u63a5\u4e0a\u4ee3\u7801\n\n### $Code$\n```cpp\nfor(register int i=0; i<=2; i++){\n\tPre_Max[i] = max(Pre_Max[i],SubTree_Max[i]);\n\tPre_Sum[i] = (Pre_Sum[i]+SubTree_Sum[i])%MOD;\n}\n```\n---\n\u7136\u540e\u5c31\u662f~~\u6dc0\u7c89\u8d28~~\u70b9\u5206\u6cbb\u677f\u5b50\u5566~\n\n\u4e0a\u4ee3\u7801\n\n*$PS$\uff1a\u6ce8\u610f\u4e00\u4e0b\u6700\u540e\u6743\u503c\u548c\u8981\u4e58\u4ee52\uff0c\u56e0\u4e3a\u4e4b\u524d\u8ba1\u7b97\u7684\u662f\u65e0\u5e8f\u70b9\u5bf9\uff0c\u800c\u9898\u4e2d\u7ed9\u7684\u662f\u6709\u5e8f\u70b9\u5bf9*\n## $Code$\n\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\ntemplate<typename T>\ninline void Read(T &n){\n\tchar ch; bool flag=0;\n\twhile(!isdigit(ch=getchar()))if(ch=='-')flag=1;\n\tfor(n=ch^48;isdigit(ch=getchar());n=(n<<1)+(n<<3)+(ch^48));\n\tif(flag)n=-n;\n}\n\ntypedef long long ll;\nconst int MAXN = 200005;\nconst ll MOD = 10007;\n\nstruct _{\n\tint nxt, to;\n\t_(int nxt=0, int to=0):nxt(nxt),to(to){}\n}edge[MAXN<<1];\nint fst[MAXN], tot;\n\ninline void Add_Edge(int f, int t){\n\tedge[++tot] = _(fst[f], t); fst[f] = tot;\n\tedge[++tot] = _(fst[t], f); fst[t] = tot;\n}\n\nint n;\nll Max_Val, Sum, val[MAXN];\nbool vis[MAXN], Centered[MAXN];\n\nint Total_Size, Center, Min_Weight, sz[MAXN];\nvoid Get_Center(int x){//\u627e\u91cd\u5fc3 \n\tvis[x] = true;\n\t\n\tsz[x] = 1;\n\tint Weight=0;\n\t\n\tfor(register int u=fst[x]; u; u=edge[u].nxt){\n\t\tint v=edge[u].to;\n\t\tif(vis[v]==true or Centered[v]==true) continue;\n\t\tGet_Center(v);\n\t\tsz[x] += sz[v];\n\t\tWeight = max(Weight,sz[v]);\n\t}\n\tWeight = max(Weight,Total_Size-sz[x]);\n\t\n\tif(Weight<Min_Weight){\n\t\tMin_Weight = Weight;\n\t\tCenter = x;\n\t}\n\t\t\n\tvis[x] = false;\n}\n\nll SubTree_Sum[3]/*Sum\u6570\u7ec4*/, SubTree_Max[3]/*Max\u6570\u7ec4*/, Pre_Sum[3], Pre_Max[3];\nvoid Work_SubTree(int x, int dis_root){//\u5904\u7406\u5b50\u6811\n\tif(dis_root>2) return;\n\tvis[x] = true;\n\t\n\tSubTree_Sum[dis_root] = (SubTree_Sum[dis_root]+val[x])%MOD;\n\tSubTree_Max[dis_root] = max(SubTree_Max[dis_root], val[x]);\n\t\n\tfor(register int u=fst[x]; u; u=edge[u].nxt){\n\t\tint v=edge[u].to;\n\t\tif(Centered[v]==true or vis[v]==true) continue;\n\t\tWork_SubTree(v,dis_root+1);\n\t}\n\t\n\tvis[x] = false;\n}\n\nvoid Divide(int x, int Size){//\u70b9\u5206\u5957\u8def\n\tMin_Weight = n+1; Total_Size = Size;\n\tGet_Center(x);\n\tx = Center;\n\tCentered[x] = true;\n\t//Get Center\n\t\n\tmemset(Pre_Sum,0,sizeof Pre_Sum);\n\tmemset(Pre_Max,0,sizeof Pre_Max);\n\tPre_Sum[0] = Pre_Max[0] = val[x];\n\t//Clear\n\t\n\tfor(register int u=fst[x]; u; u=edge[u].nxt){\n\t\tint v=edge[u].to;\n\t\tif(Centered[v]==true) continue;\n\t\t\n\t\tmemset(SubTree_Max,0,sizeof SubTree_Max);\n\t\tmemset(SubTree_Sum,0,sizeof SubTree_Sum);\n\t\t//Clear\n\t\n\t\tWork_SubTree(v,1);\n\t\t//Dfs\n\t\t\n\t\tfor(register int i=0; i<=2; i++){\n\t\t\tMax_Val = max(Max_Val,Pre_Max[i]*SubTree_Max[2-i]);\n\t\t\tSum = (Sum+Pre_Sum[i]*SubTree_Sum[2-i]%MOD)%MOD;\n\t\t}\n\t\t//Calc Ans\n\t\t\n\t\tfor(register int i=0; i<=2; i++){\n\t\t\tPre_Max[i] = max(Pre_Max[i],SubTree_Max[i]);\n\t\t\tPre_Sum[i] = (Pre_Sum[i]+SubTree_Sum[i])%MOD;\n\t\t}\n\t\t//Update\n\t}\n\t//Work SubTree\n\t\n\tfor(register int u=fst[x]; u; u=edge[u].nxt){\n\t\tint v=edge[u].to;\n\t\tif(Centered[v]==true) continue;\n\t\tDivide(v,sz[v]);\n\t}\n\t//Solve SubTree\n}\n\nint main(){\n\t//Input\n\tRead(n);\n\tfor(register int i=1; i<n; i++){\n\t\tint from, to;\n\t\tRead(from); Read(to);\n\t\tAdd_Edge(from,to);\n\t}\n\tfor(register int i=1; i<=n; i++) Read(val[i]);\n\t\n\t//Solve\n\tDivide(1,n);\n\t\n\tprintf(\"%lld %lld\\n\",Max_Val, Sum*2%MOD);//\u6ce8\u610f\u4e58\u4ee52\n\treturn 0;\n}\n```\n",
        "postTime": 1571388733,
        "uid": 56825,
        "name": "oisdoaiu",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "~~\u8fd9\u4e0d\u662f\u5c0f\u5b66\u5965\u6570\u5417~~\n## \u4ee3\u6570\u5927\u6cd5\u597d\uff01\n###### \u5bf9\u4e8e\u8fd9\u9898\uff0c\u5f88\u591a\u9898\u89e3\u7684\u6c42\u548c\u90fd\u662f\u6bd4\u8f83\u7384\u5b66\u7684\uff08~~\u849f\u84bb\u8868\u793a\u770b\u4e0d\u61c2~~\uff09\n\n\u6211\u4eec\u4ece\u6700\u521d\u7684\u601d\u8def\u5f00\u59cb\u3002\n### \u4e00.\u6811?\n\u9898\u9762\u4e0a\u5f88\u72e1\u733e\uff0c\u8bf4\u662fn\u4e2a\u70b9\uff0cn-1\u6761\u8fb9\u7684\u65e0\u5411\u56fe\u3002\n\u90a3\u8fd9\u79cd\u56fe\u662f\u4ec0\u4e48\u9b3c\u5462\uff1f\n\u8bf4\u767d\u4e86\u5c31\u662f\u6811\u3002\n\n## **\u6811\uff01**\n\n\u597d\u7684\uff0c\u6211\u4eec\u8d70\u51fa\u4e86\u6700\u5173\u952e\u7684\u7b2c\u4e00\u6b65\u3002\n\u65e2\u7136\u662f\u6811\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u8054\u5408\u6743\u503c\u5206\u6210\u4e24\u7c7b\u8ba8\u8bba\u3002\n\n**\u4e00\u7c7b\u662f\u513f\u5b50\u4e0e\u7236\u4eb2\u7684\u7236\u4eb2\u4e24\u8005\u7684\u4e58\u79ef**\uff08\u4e0b\u79f0A\uff09\n\n**\u53e6\u4e00\u7c7b\u662f\u4e24\u4e2a\u513f\u5b50\u7684\u4e58\u79ef**\n\n~~\uff08\u5728\u5ea7\u90fd\u4f1a\u5efa\u6811\u628a\uff09~~\n\n### \u4e8c.\u6c42\u6700\u5927\u503c\n\u8fd9\u4e2a\u64cd\u4f5c\u96be\u5ea6\u76f8\u5bf9\u7b80\u5355\uff0c\u53ea\u8981\u628a\u5b50\u8282\u70b9\u4e2d\u7684\u6700\u5927\u503c\u4e0e\u6b21\u5927\u503c\u6c42\u51fa\uff0c\u7136\u540e\u76f8\u4e58\uff0c\u5e76\u4e0eA\u6bd4\u8f83\uff0c\u53d6\u8f83\u5927\u503c\u5373\u53ef\u3002\n### \u4e09.\u6c42\u548c\n~~\u4e8e\u662f\u4e4e\uff0c\u9898\u89e3\u4e2d\u5404\u8def\u5de8\u4f6c\u516b\u4ed9\u8fc7\u6d77\uff0c\u65bd\u5c55\u4e86\u4e00\u5806\u849f\u84bb\u6211\u770b\u4e0d\u61c2\u7684\u7b97\u6cd5~~\n\n\u5c0f\u5b66\u5965\u6570\u4e2d\u5e38\u7528\u516c\u5f0f\uff1a\n**(a + b + c)\u00b2 = a\u00b2 + b\u00b2 + c\u00b2 + 2ab + 2bc + 2ac**\n\n**\u63a8\u5e7f\uff1a(a1 + a2 + \u2026\u2026+ ak)\u00b2 = (a1\u00b2 + a2\u00b2 + \u2026\u2026 + ak\u00b2) + (\u4efb\u610f\u4e24\u9879\u4e58\u79ef\u76842\u500d\u7684\u548c)**\n\n## \uff1f\uff1f\uff1f\n\u83ab\u540d\u5176\u5999\u89e3\u51b3\u95ee\u9898\uff01 \n\n\u6211\u4eec\u53ea\u9700\u8981\u5c06\u6bcf\u4e2a\u70b9\u7684\u513f\u5b50\u503c\u7684\u548c\u6c42\u51fa\uff0c\u5e73\u65b9\u4e00\u4e0b\uff0c\u7136\u540e\u51cf\u53bb\u6bcf\u4e2a\u513f\u5b50\u8282\u70b9\u7684\u5e73\u65b9\u503c\uff0c\u518d\u52a0\u4e0aA\uff08\u89c1\u4e00\uff09\u5c31OK\u4e86\uff01~~\uff08\u6fc0\u52a8\uff09~~\n\n**\u6ce8\uff1a\u9898\u9762\u660e\u786e\u6307\u51fa\uff0c\u662f\u6709\u5e8f\u6570\u5bf9\uff0c\u56e0\u6b64\uff08a,b\uff09\u4e0e\n\uff08b, a\uff09\u90fd\u8981\u7b97\u5230\u548c\u91cc\u3002**\n\n### \u56db.\u8d34\u4ee3\u7801\n```c++\n\n#include<bits/stdc++.h>\nusing namespace std;\ntemplate <typename T> inline void read(T &x) {\n\tx = 0;\n\tT f = 1;\n\tchar c = getchar();\n\tfor (; !isdigit(c); c = getchar()) if (c == '-') f = -1;\n\tfor (; isdigit(c); c = getchar()) x = (x << 1) + (x << 3) + (c ^ 48);\n\tx *= f;\n}\ninline void d_read(double &x) {\n\tx = 0.0;\n\tint f = 1;\n\tchar c = getchar();\n\tfor (; !isdigit(c); c = getchar()) if (c == '-') f = -1;\n\tfor (; isdigit(c); c = getchar()) x = x * 10 + (c ^ 48);\n\tif (c == '.'){\n\t\tdouble num = 1.0;\n\t\tc = getchar();\n\t\tfor (; isdigit(c); c = getchar()) x = x + (num /= 10) * (c ^ 48);\n\t}\n\tx *= f;\n}\n\ntemplate <typename T> inline void w(T x) {\n\tif (x > 9) w(x / 10);\n\tputchar(x % 10 + 48);\n}\ntemplate <typename T> inline void write(T x, char c) {\n\tif (x < 0){\n\t\tputchar('-');\n\t\tx = -x;\n\t}\n\tw(x);\n\tputchar(c);\n}\nstruct info{\n\tint to, nex;\n}l[4000001];\nint head[2000001], f[2000001], wg[2000001], len, W;\nlong long S;\nvector <int> v[2000001]; \ninline void dfs(int p) {\n\tfor (int e = head[p]; e; e = l[e].nex) {\n\t\tint u = l[e].to;\n\t\tif (u != f[p]) {\n\t\t\tf[u] = p;\n\t\t\tv[p].push_back(u);\n\t\t\tdfs(u);\n\t\t}\n\t}\n}\ninline void val(int p) {\n\tint maxi = 0, maxg = 0;\n\tfor (int i = 0; i < v[p].size(); i ++) {\n\t\tint u = v[p][i];\n\t\tif (wg[u] > maxg) {\n\t\t\tmaxi = maxg;\n\t\t\tmaxg = wg[u];\n\t\t} \n\t\telse if (wg[u] > maxi) maxi = wg[u];\n\t}\n\t\n\tW = max(W, max(maxi * maxg, wg[p] * wg[f[f[p]]]));\n}\ninline void sum(int p) {\n\tint sg = 0, sw = 0;\n\tfor (int i = 0; i < v[p].size(); i ++) {\n\t\tsg += wg[v[p][i]];\n\t\tsg %= 10007;\n\t\tsw += wg[v[p][i]] * wg[v[p][i]];\n\t\tsw %= 10007;\n\t}\n\tS += sg * sg - sw + wg[p] * wg[f[f[p]]] * 2; \n\tS %= 10007;\n}\nint main(void) {\n\tint n;\n\tread(n);\n\tfor (int i = 1; i <= n - 1; i ++) {\n\t\tint u, v;\n\t\tread(u); read(v);\n\t\tl[++ len] = (info) {u, head[v]};\n\t\thead[v] = len;\n\t\tl[++ len] = (info) {v, head[u]};\n\t\thead[u] = len;\n\t}\n\tfor (int i = 1; i <= n; i ++ ) read(wg[i]);\n\tdfs(1);\n\tfor (int i = 1; i <= n; i ++) val(i);\n\tfor (int i = 1; i <= n; i ++) sum(i);\n\twrite(W, ' '); write(S, '\\n');\n\treturn 0;\n}\n",
        "postTime": 1564493709,
        "uid": 46820,
        "name": "Wall_breaker",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u5bb9\u6613\u770b\u51fa\uff0c\u539f\u56fe\u662f\u4e00\u68f5\u6811\u3002\n\n\u7136\u540e\u5982\u679c\u6211\u4eec\u6309\u7167\u9898\u610f\u76f4\u63a5\u6a21\u62df\uff0c\u90a3\u4e48\u65f6\u95f4\u590d\u6742\u5ea6\u81f3\u5c11\u4e5f\u8981 $ O(n^2) $\uff08\u679a\u4e3e $ u, v $ \u4e24\u4e2a\u70b9\uff09\n\n\u6240\u4ee5\u6211\u4eec\u5f97\u60f3\u4e00\u4e0b\u5982\u4f55\u66f4\u5feb\u5730\u679a\u4e3e\u8ddd\u79bb\u4e3a2\u7684\u4e24\u4e2a\u70b9\u3002\n\n\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u70b9\u5728\u6811\u4e0a\uff0c\u6240\u4ee5\u5b83\u4eec\u4e4b\u95f4\u4e00\u5b9a\u53ea\u6709\u4e00\u6761\u8def\u5f84\uff0c\u53c8\u56e0\u4e3a\u5b83\u4eec\u7684\u8ddd\u79bb\u4e3a2\uff0c\u6240\u4ee5\u5b83\u4eec\u4e2d\u95f4\u5fc5\u5b9a\u6709\u4e00\u4e2a\u70b9\u3002\n\n\u53cd\u8fc7\u6765\uff0c\u6211\u4eec\u679a\u4e3e\u8fd9\u4e2a\u4e2d\u95f4\u70b9\uff0c\u7136\u540e\u53d6\u4e0e\u5b83\u76f8\u90bb\u7684\u4efb\u4f55\u4e24\u4e2a\u4e0d\u540c\u7684\u70b9\uff0c\u5b83\u4eec\u7684\u8ddd\u79bb\u5c31\u4e00\u5b9a\u4e3a2\u3002\u800c\u4e14\u663e\u7136\u901a\u8fc7\u8fd9\u79cd\u65b9\u6cd5\u4ea7\u751f\u7684\u70b9\u5bf9\uff0c\u5c31\u4e00\u5b9a\u662f\u6240\u6709\u8ddd\u79bb\u4e3a2\u7684\u70b9\u5bf9\u3002\n\n\u4f46\u662f\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u8fd8\u662f $ O(n^2) $\uff08\u6700\u591a\u7684\u70b9\u5bf9\u6570\u91cf\uff09\uff0c\u5982\u4f55\u4f18\u5316\uff1f\n\n\u6211\u4eec\u628a\u201c\u7531\u70b9 $ i $ \u7684\u76f8\u90bb\u7684\u4e24\u4e2a\u70b9\u7ec4\u6210\u7684\u70b9\u5bf9\u201d\u53eb\u505a $ i $ \u7684\u70b9\u5bf9\u3002\u9996\u5148\u770b\u6700\u5927\u503c\u3002\u660e\u663e\u5728 $ i $ \u7684\u70b9\u5bf9\u4e2d\uff0c\u82e5\u8054\u5408\u6743\u503c\u6700\u5927\u7684\u70b9\u5bf9\u662f $ u - v $\uff0c\u90a3\u4e48 $ W_u, W_v $ \u4e00\u5b9a\u662f $ i $ \u76f8\u90bb\u7684\u70b9\u4e2d $ W $ \u503c\u6700\u5927\u7684\u4e24\u4e2a\u3002\u6362\u8a00\u4e4b\uff0c\u6700\u5927\u7684\u4e24\u4e2a\u6570\u4e58\u79ef\u4e00\u5b9a\u662f\u6700\u5927\u7684\u3002\n\n\u7136\u540e\u770b\u6743\u503c\u4e4b\u548c\u3002\u6211\u4eec\u5728 $ i $ \u7684\u70b9\u5bf9\u4e2d\uff0c\u5148\u5173\u6ce8\u6709\u4e00\u4e2a\u70b9\u662f $ u $ \u7684\u70b9\u5bf9\uff0c\u8fd9\u4e9b\u70b9\u5bf9\u7684\u6743\u503c\u548c\u662f\uff08\u4e3a\u4e86\u770b\u5f97\u66f4\u6e05\u695a\u52a0\u4e0a\u4e86\u62ec\u53f7\uff09\n\n$ \\sum\\limits_{v \\not= u}(W_u \\times W_v) $\n\n$ = \\sum\\limits_v(W_u \\times W_v) - W_u^2 $\n\n$ = W_u \\times \\sum\\limits_vW_v - W_u^2 $\n\n\u5982\u679c\u7528 $ S $ \u8868\u793a $ \\sum\\limits_uW_u $\uff0c\u90a3\u4e48\u4e0a\u5f0f\u5c31\u662f\n\n$ W_u \\times S - W_u^2 $\n\n\u90a3\u4e48\u6240\u6709\u7684\u70b9\u5bf9\u6743\u503c\u4e4b\u548c\u5c31\u662f\n\n$ \\sum\\limits_u\\sum\\limits_{v \\not= u}(W_u \\times W_v) $\n\n$ = \\sum\\limits_u(W_u \\times S - W_u^2) $\n\n$ = \\sum\\limits_u(W_u \\times S) - \\sum\\limits_uW_u^2 $\n\n$ = (\\sum\\limits_uW_u) \\times S - \\sum\\limits_uW_u^2 $\n\n$ = S^2 - \\sum\\limits_uW_u^2 $\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5728 $ O(d_i) $ \u7684\u65f6\u95f4\u5185\u6c42\u51fa $ i $ \u7684\u70b9\u5bf9\u7684\u6743\u503c\u548c\uff08$ d_i $ \u662f $ i $ \u7684\u5ea6\uff0c\u5c31\u662f\u4e0e $ i $ \u76f8\u8fde\u7684\u70b9\u7684\u6570\u91cf\uff09\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5728 $ O(\\sum\\limits_id_i) $ \u7684\u65f6\u95f4\u5185\u89e3\u51b3\u95ee\u9898\uff0c\u6ce8\u610f\u5230\u6240\u6709\u70b9\u7684\u5ea6\u6570\u4e4b\u548c\u5c31\u662f $ 2m = 2n - 2 $\uff0c\u6240\u4ee5\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u662f $ O(n) $\n\n\u5c0fTip\uff1a\u6743\u503c\u548c\u8981\u53d6\u6a21\uff0c\u4f46\u662f**\u6700\u5927\u503c\u4e0d\u7528\u53d6\u6a21**\uff01\uff01\uff01\n\n\u4e0aCode:\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nvector<int> g[200001];\nint w[200001];\nconst int mod=10007;\nint main()\n{\n    int n;\n    scanf(\"%d\",&n);\n    for(int i=1;i<n;i++)\n    {\n        int u,v;\n        scanf(\"%d %d\",&u,&v);\n        g[u].push_back(v);\n        g[v].push_back(u);\n    }\n    for(int i=1;i<=n;i++)\n        scanf(\"%d\",&w[i]);\n    int ans=0,Max=0;\n    for(int i=1;i<=n;i++)\n    {\n        int st=0,t=0,m1=0,m2=0;\n        for(vector<int>::iterator iter=g[i].begin();iter!=g[i].end();iter++)\n        {\n            int v=w[*iter];\n            st=(st+v*v)%mod;\n            t=(t+v)%mod;\n            if(v>m1)\n            {\n                m2=m1;\n                m1=v;\n            }\n            else if(v>m2)\n                m2=v;\n        }\n        if(m2)\n        {\n            int del=(t*t-st)%mod;\n            if(del<0)\n                del+=mod;\n            ans=(ans+del)%mod;\n            Max=max(Max,m1*m2);\n        }\n    }\n    printf(\"%d %d\\n\",Max,ans);\n    return 0;\n}\n```",
        "postTime": 1554703178,
        "uid": 73645,
        "name": "_ztyqwq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u55ef...\u4e00\u5806\u4e1c\u897f\u4e92\u76f8\u4e58\u5728\u4e00\u8d77\u8ba9\u89c1\u8bc6\u5c11\u7684\u672c\u849f\u84bb\u8054\u60f3\u8d77\u4e8615\u5e74\u666e\u53ca\u7684T3\u6c42\u548c\u3002\n\n\u5148\u770b\u6c42\u8054\u5408\u6743\u503c\u7684\u548c\u3002\u7a0d\u7a0d\u5bf9\u9898\u610f\u8fdb\u884c\u53d8\u5f62\uff0c\u5373\u4e3a\uff1a\u5bf9\u6bcf\u4e00\u4e2a\u70b9\uff0c\u627e\u5230\u4e0e\u5b83\u76f8\u8fde\u7684\u6240\u6709\u70b9\uff0c\u90a3\u4e9b\u70b9\u4e4b\u95f4\u4e24\u4e24\u6743\u503c\u76f8\u4e58\uff0c\u6700\u540e\u628a\u6240\u6709\u4e58\u79ef\u76f8\u52a0\uff08\u5e76\u53d6\u4f59\uff0c\u522b\u5fd8\u4e86qwq\uff09\u3002\n\n\u6211\u4eec\u60f3\u8c61\uff1a\u6bcf\u8fde\u4e0a\u4e00\u6761\u8fb9\uff0c\u4fbf\u8fdb\u884c\u4e00\u6b21\u201c\u64cd\u4f5c\u201d\u3002\u5b9a\u4e49\u4e00\u4e2a\u6570\u7ec4S\uff0c\u7528**S[i]**\u8bb0\u5f55\u7b2ci\u4e2a\u70b9\u5468\u56f4\u5df2\u7ecf\u8fde\u4e0a\u7684\u70b9\u7684**\u6743\u503c\u4e4b\u548c**\u3002\u8fde\u4e0a\u4e00\u6761\u8fb9\u65f6\uff0c\u6bd4\u65b9\u8bf4\u4ecea\u70b9\u5230b\u70b9\uff0c\u5bf9\u8fd9\u4e24\u4e2a\u70b9\u5206\u522b\u8fdb\u884c\u64cd\u4f5c\uff0c\u62ffa\u70b9\u4e3e\u4f8b\uff1a\n\n\u9996\u5148\u5c06b\u70b9\u7684\u6743\u503c\u4e58\u4ee5\u5df2\u7ecf\u8fde\u4e0aa\u70b9\u7684\u6240\u6709\u70b9\u7684\u6743\u503c\u4e4b\u548c\uff08\u5c31\u662fS[a]\uff09\uff0c\u52a0\u5230\u603b\u7ed3\u679csum\u4e0a\uff1b\u7136\u540e\u628ab\u70b9\u7684\u6743\u503c\u52a0\u5230S[a]\u4e0a\u3002\n\nb\u70b9\u7684\u64cd\u4f5c\u540c\u7406\u3002\u8fd9\u6837\u7684\u8bdd\uff0c\u4ece\u7b2c\u4e00\u6761\u8fb9\u8fde\u5230\u6700\u540e\u4e00\u6761\u8fb9\uff0csum\u7d2f\u79ef\u4e86\u4e00\u534a\u7684\u8054\u5408\u6743\u503c\u603b\u548c\uff0cx2\u4fbf\u662f\u6b63\u786e\u7b54\u6848\u3002\n\n\uff08\u7a0d\u7a0d\u60f3\u60f3\u5927\u6982\u5c31\u662f\u8fd9\u4e48\u56de\u4e8b\u5427...\uff09\n\n\u518d\u770b\u6c42\u6700\u5927\u503c\u3002\u7c7b\u4f3c\u5730\uff0c\u5b9a\u4e49\u4e00\u4e2a\u6570\u7ec4M\uff0c\u7528**M[i]**\u8bb0\u5f55\u7b2ci\u4e2a\u70b9\u5468\u56f4\u5df2\u7ecf\u8fde\u4e0a\u7684\u70b9\u7684**\u6743\u503c\u7684\u6700\u5927\u503c**\u3002\u7c7b\u4f3c\u4e8e\u4e0a\u9762\u7684\u64cd\u4f5c\uff0c\u6bcf\u8fde\u4e0a\u4e00\u6761\u8fb9\uff0c\u5206\u522b\u66f4\u65b0\u76f8\u5e94\u7684M[a]\u3001M[b]\uff0c\u4ee5\u53ca\u5168\u5c40\u8054\u5408\u6743\u503c\u7684\u6700\u5927\u503cans\u3002\n\n\u6700\u540e...\u522b\u5fd8\u5f00long long\u5426\u521970\u5206orz\n\n\u8fd9\u683725\u884c\u4fbf\u53ef\u4ee5\u5b8c\u6210\uff0c\u770b\u4e0d\u61c2\u697c\u4e0bdalao\u4eec\u6652\u89e6\u7684\u670b\u53cb\u53ef\u4f9b\u53c2\u8003~\n\n```cpp\n#include<algorithm>\n#include<cstdio>\nusing namespace std;\nlong long w[200005],A[200005],B[200005],S[200005],M[200005],sum,ans;\nint n;\nint main()\n{\n    scanf(\"%d\",&n);\n    for(int i=1;i<n;i++)   scanf(\"%lld%lld\",A+i,B+i);\n    for(int i=1;i<=n;i++)   scanf(\"%lld\",w+i);\n    for(int i=1;i<n;i++)\n    {\n        int ta=A[i],tb=B[i];\n        ans=max(ans,M[ta]*w[tb]);\n        M[ta]=max(M[ta],w[tb]);\n        sum=(sum+S[ta]*w[tb])%10007;\n        S[ta]+=w[tb];\n        ans=max(ans,M[tb]*w[ta]);\n        M[tb]=max(M[tb],w[ta]);\n        sum=(sum+S[tb]*w[ta])%10007;\n        S[tb]+=w[ta];\n    }\n    printf(\"%lld %lld\",ans,(sum*2)%10007);\n    return 0;\n}\n```",
        "postTime": 1535286102,
        "uid": 31967,
        "name": "Ximenbao",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u8fd9\u662f\u6211\u5f88\u4e45\u4ee5\u524d\u505a\u7684\u5462\u3002\u3002\n\n\u9996\u5148\uff0c\u82e5\u6709\u4e24\u4e2a\u8282\u70b9\u4e0e\u540c\u4e00\u8282\u70b9\u76f8\u8fde\uff0c\u5373\u4e24\u4e2a\u8282\u70b9\u53ef\u4ee5\u6784\u6210\u4e00\u5bf9\u8054\u5408\u6743\u503c\u3002\n\n\u6240\u4ee5\u5c31\u53ef\u4ee5\u679a\u4e3e\u6bcf\u4e00\u4e2a\u8282\u70b9\uff0c\u627e\u5230\u5b83\u80fd\u591f\u5230\u8fbe\u7684\u6743\u503c\u6700\u5927\u7684\u4e24\u4e2a\u70b9\uff0c\u90a3\u4e48\u76f8\u5bf9\u4e8e\u8fd9\u4e2a\u8282\u70b9\uff0c\u8fd9\u4e24\u4e2a\u70b9\u7684\u4e58\u79ef\u5c31\u662f\u6700\u5927\u503c\u3002\u518d\u5c06\u6bcf\u4e00\u4e2a\u70b9\u7684\u6700\u5927\u8054\u5408\u6743\u503c\u4e2d\u53d6\u6700\u5927\u503c\uff0c\u5c31\u4e3a\u7b54\u6848\u8981\u6c42\u7684\u6743\u503c\u6700\u5927\u3002\n\n\u7136\u540e\uff0c\u8981\u6c42\u6240\u6709\u8054\u5408\u6743\u503c\u4e4b\u548c\uff1a\n\n\u5bf9\u4e8e\u8282\u70b9a,\u4e0e\u5b83\u76f8\u8fde\u7684\u8282\u70b9\u96c6$vector[a](0~~k)$(k\u4e3a\u5411\u91cf\u7684\u89c4\u6a21\uff09\u4e2d\u6bcf\u4e00\u4e2a\u70b9\u90fd\u53ef\u4ee5\u4e24\u4e24\u7ec4\u5408\uff0c\u6240\u4ee5\n$$\nW=w0*w1+w0*w2+w0*w3+....+w1*w0+w1*w2+....+wk*w0+....+wj*wk-1;\n$$\n\u5316\u7b80\u53ef\u5f97:\n$$\nW=w0*(w0+...+wk-w0)+....+wk*(w0+...+wk-wk);\n$$\n\u4ee4$w0+w1+....+wk$\u4e3a$he[a]$;\n\n\u5219$W=w0*(he[a]-w0)+w1*(he[a]-w1)+....+wk*(he[a]-wk);$\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u5f88\u5feb\u6c42\u51fa\u6743\u503c\u4e4b\u548c\uff1b\n\n\u5177\u4f53\u64cd\u4f5c\u770b\u4ee3\u7801\uff1a(\u6709\u5f88\u8be6\u7ec6\u7684\u6ce8\u91ca\uff09\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<vector>\n#include<cmath>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\nint n,x,y;\nvector<int> g[200010];//\u5b58\u53d6\u5404\u4e2a\u70b9\u80fd\u591f\u5230\u8fbe\u7684\u70b9\nlong long sum_p,max_p;\nlong long w[200010];//\u6743\u503c\nlong long he[200010];//W\n\nint main(){\n    cin>>n;\n    for(int i=1;i<=n-1;i++){//\u5b58\u5165\u5411\u91cf\n    \tcin>>x>>y;\n    \tg[x].push_back(y);\n    \tg[y].push_back(x);\n    }\n    for(int i=1;i<=n;i++){//\u8bfb\u5165\u6743\u503c\n    \tcin>>w[i];\n    }\n    long long maxn,maxx;//\u6700\u5927\u503c\u548c\u6b21\u5927\u503c\n\tfor(int i=1;i<=n;i++){\n\t\tif(g[i].size()<2) continue;//\u5982\u679c\u5411\u91cf\u4e2d\u6ca1\u6709\u4e24\u4e2a\u70b9\uff0c\u5c31\u4e0d\u53ef\u80fd\u6784\u6210\u8054\u5408\u6743\u503c\n\t\tif(w[g[i][0]]>w[g[i][1]]) maxn=w[g[i][0]],maxx=w[g[i][1]];\n\t\telse maxn=w[g[i][1]],maxx=w[g[i][0]];\n\t\the[i]=w[g[i][0]]+w[g[i][1]];\n\t\tfor(int j=2;j<g[i].size();j++){//\u6c42\u548cW\n\t\t\the[i]+=w[g[i][j]];\n\t\t\tif(w[g[i][j]]>maxn){\n\t\t\t    maxx=maxn;\n\t\t\t\tmaxn=w[g[i][j]];\n\t\t\t}\n\t\t\telse if(w[g[i][j]]>maxx){\n\t\t\t\tmaxx=w[g[i][j]];\n\t\t\t}\n\t\t}\n\t\tmax_p=max(max_p,maxx*maxn);//\u66f4\u65b0\u6700\u5927\u8054\u5408\u6743\u503c\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tif(g[i].size()<2) continue;//\u540c\u4e0a\n\t\tfor(int j=0;j<g[i].size();j++){\n\t\t\tsum_p+=(w[g[i][j]]*((he[i]-w[g[i][j]]))%10007)%10007;//\u53c2\u7167\u516c\u5f0f\n\t\t}\n\t}\n\tcout<<max_p<<\" \"<<sum_p%10007;//\u522b\u5fd8\u6a2110007\u4e86\n\t\n\treturn 0;\n}\n```\n\n\u5199\u4e86\u597d\u4e45\u5440\u3002\u3002\u6c42\u8fc7QXQ\u3002\u3002",
        "postTime": 1532417097,
        "uid": 39535,
        "name": "huwenbo",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "### \u4f60\u4eec\u4ee3\u7801\u771f\u957f\uff0c\u672c\u849f\u84bb\u770b\u4e0d\u61c2\n\u63d0\u4f9b\u4e00\u4e2a\u597d\u601d\u8def\n\n\u9996\u5148\u5171n\u4e2a\u70b9,n-1\u6761\u8fb9\uff0c\u80af\u5b9a\u4e3a\u6811\uff0c\u5373\u6ca1\u6709\u73af\u3002\u90a3\u4e48\u8ddd\u79bb\u4e3a2\uff0c\u5c31\u662f\u4e00\u4e2a\u70b9\u8fde\u63a5\u7684\u4e24\u4e2a\u70b9\uff0c\u6c42\u8054\u5408\u6743\u503c\u5373\u53ef\u3002\n### But:O(n^2) TLE\n\u90a3\u548b\u529e\uff1f\u6211\u4eec\u6765\u4f18\u5316\u4e00\u4e0b\u3002\n\n\u6700\u5927\uff1a\n\n\u4e00\u4e2a\u70b9\u8fde\u63a5\u7684\u4e24\u4e2a\u6743\u503c\u6700\u5927\u7684\u70b9\uff0c\u5176\u8054\u5408\u6743\u503c\u518d\u4e0eans1\u53d6max\n\u4e24\u4e2a\u6743\u503c\u6700\u5927\u7684\u70b9\u5728\u8f93\u5165\u7684\u65f6\u5019\u5c31\u641e\u5b9a O(n)\n\n------------\n\n\u548c\uff1a\n\n\u5373\u4e3a\u4e00\u4e2a\u70b9\u8fde\u63a5\u7684\u4e24\u4e2a\u70b9\u7684\u8054\u5408\u6743\u503c\u4e4b\u548c\uff0c\u7136\u540e\u518d\u53d6\u548c\u3002\u90a3\u548b\u6c42\uff1f\n\n\u6613\u5f97\n\nS(\u4e00\u4e2a\u70b9\u8fde\u63a5\u7684\u4e24\u4e2a\u70b9\u7684\u8054\u5408\u6743\u503c\u4e4b\u548c)=A{\u4e00\u4e2a\u70b9\u8fde\u63a5\u7684\u70b9\uff09*\uff08W(\u4e00\u4e2a\u70b9\u8fde\u63a5\u7684\u70b9\u7684\u6743\u503c\u548c\uff09-A)\n\nS=A*W-A^2;\n\nS\u603b=W^2-A\u603b^2;\n\nW\u53ef\u5728\u5efa\u8fb9\u65f6\u641e\u5b9a\uff0c\u540c\u65f6\u5904\u7406A\u603b^2\u3002O(n)\n\n------------\n\u641e\u5b9a!\n\n\u732e\u4e0a\u4e11\u964b\u7684\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=200005,M=N<<1,P=10007;\nint w[N],s[N],s1[N],m1[N],m2[N],xx[N],yy[N],ans1,ans2,n;\ninline void bia(int x,int y)\n{\n\ts[x]+=w[y]%P,s[x]%=P;\n\ts1[x]+=(w[y]*w[y])%P,s1[x]%=P;\n\tif(w[y]>m1[x]) m2[x]=m1[x],m1[x]=w[y];\n\telse if(w[y]>m2[x]) m2[x]=w[y];\n}\ninline void ad(int x,int y)\n{\n\tbia(x,y);\n\tbia(y,x);\n}\nint main()\n{\n\tcin>>n;\n\tfor(int i=1;i<n;i++)\n\t\tcin>>xx[i]>>yy[i];\n\tfor(int i=1;i<=n;i++)\n\t\tcin>>w[i];\n\tfor(int i=1;i<n;i++)\n\t\tad(xx[i],yy[i]);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tans1=max(ans1,m1[i]*m2[i]);\n\t\tans2+=((s[i]*s[i])-s1[i])%P;\n\t\tans2%=P;\n\t}\n\tcout<<ans1<<\" \"<<ans2<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1529751567,
        "uid": 103990,
        "name": "asd_a",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "[Youngsc](http://youngscc.github.io/)\n\n\n\u641e\u4e0d\u61c2\u6807\u7b7e\u4e3a\u4ec0\u4e48\u662fDP\u548cLCA\uff0c\u660e\u660e\u904d\u5386\u4e00\u904d\u6811\u5c31\u53ef\u4ee5\u5b8c\u6210\u7684\u4e8b\u60c5\u554a\u3002\n\n\u9898\u76ee\u91cc\u8bf4\u4e86\uff0c\u4e24\u70b9\u4e4b\u95f4\u8ddd\u79bb\u4e3a2\u5373\u53ef\u4ea7\u751f\u8054\u5408\u6743\u503c\uff0c\u90a3\u4e48\u6211\u4eec\u5e76\u6ca1\u6709\u5fc5\u8981\u53bb\u6c42\u51fa\u4efb\u610f\u4e24\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\uff0c\u53ea\u8981\u5bfb\u627e\u90a3\u4e9b\u70b9\u5bf9\u8ddd\u79bb\u4e3a2\u5c31\u597d**\u8ddd\u79bb\u4e3a2\u7684\u70b9\u5bf9\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\u4e0e\u7236\u4eb2\u7684\u7236\u4eb2\uff0c\u4e0e\u5144\u5f1f**\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u904d\u5386\u4e00\u904d\u6811\uff0c\u4e0e\u7236\u4eb2\u7684\u7236\u4eb2\u4e4b\u95f4\u7684\u6743\u503c\u662f\u6bd4\u8f83\u597d\u8ba1\u7b97\u7684\uff0c\u4f46\u5144\u5f1f\u4e4b\u95f4\u7684\u8054\u5408\u6743\u503c\u662f\u6bd4\u8f83\u8270\u96be\u7684\uff0c\u5982\u679c\uff08n^2\uff09\u679a\u4e3e\u7684\u8bdd\uff0c\u663e\u7136\u4f1aTLE\uff0c\n\n\u8fd9\u662f\u6211\u4eec\u5c31\u8981\u8003\u8651\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u70b9\uff0c\u4ed6\u4e0e\u6240\u6709\u5144\u5f1f\u7684\u8054\u5408\u6743\u503c\u662f\u53ef\u4ee5\u7528\u7ed3\u5408\u5f8b\u7ed3\u5408\u8d77\u6765\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53\u524d\u70b9\u4e0e\u5176\u5144\u5f1f\u7684\u8054\u5408\u6743\u503c\u662f\u4ed6\u7684\u6743\u503c\u4e58\u4e0a\u03a3\u5144\u5f1f\u7684\u6743\u503c\uff0c\u6240\u4ee5\u53ea\u9700\u5728\u7ef4\u62a4\u4e00\u4e0b\u5f53\u524d\u70b9\u7684\u513f\u5b50\u7684\u548c\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u5c31\u51e0\u4e2a\u8981\u6ce8\u610f\u7684\u95ee\u9898\uff0c\u9996\u5148\u662f\u8981\u5f00**long long**\uff0c\u7136\u540e\u9898\u76ee\u4e2d\u8bf4**\u6709\u5e8f\u70b9\u5bf9**\uff0c\u6240\u4ee5\u4efb\u610f\u4e00\u5bf9\u70b9\u7684\u6743\u503c\u90fd\u4f1a\u88ab\u8ba1\u7b97\u4e24\u6b21\u3002\n\n\n## \u4ee3\u7801\u5982\u4e0b\n\n```cpp\n# include <iostream>\n# include <cstdio>\n# include <algorithm>\n# include <cmath>\n# include <cstring>\n# define R register\n# define LL long long\n# define db double\n\nusing namespace std;\n\nint a[200010],h[200010],most[200010],more[200010],fa[200010],n,x,y,ans,e;\nLL tot;\n\nstruct pp{int v,pre;}ed[400010];\n\ninline void in(R int &a){\n    R char c = getchar();R int x = 0,f = 1;\n    while(!isdigit(c)) {if(c == '-') f = -1; c = getchar();}\n    while(isdigit(c)) x = (x<<1)+(x<<3)+c-'0',c = getchar();\n    a = x\\*f;\n}\n\ninline void maxx(R int &a,const int b){a>b? :a=b;}\n\ninline void add(R int x,R int y){\n    ed[++e] = (pp){y,h[x]};\n    h[x] = e;\n}\n\ninline void dfs(R int x,R int f){\n    R int now = 0;\n    for(R int i=h[x]; i; i=ed[i].pre)\n    {\n        // cout << x << \"--\"<< f << endl;\n        R int p = ed[i].v;\n        if(p == f) continue;\n        fa[p] = x;\n        dfs(p,x);\n        now += a[p];//\u5f53\u524d\u70b9\u7684\u513f\u5b50\u7684\u6743\u503c\u548c\u3002\n        maxx(more[x],a[p]);\n        if(most[x] < more[x]) most[x] ^= more[x],more[x] ^= most[x],most[x] ^= more[x];\n    }\n    maxx(ans,most[x]\\*more[x]);\n    if(fa[fa[x]]) maxx(ans,a[x]\\*a[fa[fa[x]]]),tot += 1LL\\*a[x]\\*a[fa[fa[x]]]\\*2,tot %= 10007;\n    for(R int i=h[x]; i; i=ed[i].pre)\n    {\n        R int p = ed[i].v;\n        if(p == f) continue;\n        tot += 1LL\\*a[p]\\*(now-a[p]);\n        tot %= 10007;\n    }\n}\n\nint yg(){\n    in(n);\n    for(R int i=1; i<n; ++i)\n    {\n        in(x),in(y);\n        add(x,y);\n        add(y,x);\n    }\n    for(R int i=1; i<=n; ++i) in(a[i]);\n    dfs(1,0);\n    printf(\"%d %lld\",ans,tot);\n}\n\nint youngsc = yg();\n\nint main (){;}\n```",
        "postTime": 1501991652,
        "uid": 36282,
        "name": "Youngsc",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u5148\u65e0\u826f\u5ba3\u4f20\u4e00\u4e0b\u535a\u5ba2 $wwwwww$    \n[\u6587\u7ae0\u5217\u8868 - \u5730\u7075\u6bbf - \u6d1b\u8c37\u535a\u5ba2](https://www.luogu.org/blog/koishikoishi/)\n\n------------\n## \u77e5\u8bc6\u70b9: \u6811\u4e0a\u95ee\u9898 , $dfs$ \n\n- ### \u539f\u9898\u9762: [P1351 \u8054\u5408\u6743\u503c](https://www.luogu.org/problem/P1351)\n\n---\n\n- ### \u9898\u76ee\u8981\u6c42 :  \n\n  \u7ed9\u5b9a\u4e00\u68f5\u6811 ,   \n  \u6c42\u6240\u6709\u8ddd\u79bb $2$ \u7684\u70b9\u5bf9   \n  **\u6743\u503c\u4e58\u79ef\u7684\u6700\u5927\u503c** \u548c **\u6743\u503c\u4e58\u79ef\u7684\u548c**  \n\n---\n\n- ### \u5206\u6790\u9898\u610f :\n\n  \u53ef\u4ee5\u53d1\u73b0\u4e00\u4e9b \u6bd4\u8f83\u6d45\u663e \u7684 \u6027\u8d28 :    \n  \u6ee1\u8db3\u9898\u76ee\u6761\u4ef6\u7684 \u70b9\u5bf9 ,   \n  \n  1. \u5728\u4e00\u6761\u94fe\u4e0a,\u4e14\u6df1\u5ea6\u76f8\u5dee $2$ ,    \n     \u5373\u4e00\u4e2a\u70b9\u662f\u53e6\u4e00\u4e2a\u70b9\u7684 $2$ \u7ea7\u7956\u5148 ,    \n     \u5373 \"\u7236\u4eb2\u7684\u7236\u4eb2\" ;    \n  2. \u662f\u540c\u4e00\u4e2a\u7ed3\u70b9 \u7684 \u5b50\u7ed3\u70b9   \n\n---\n\n- ### \u66b4\u529b\u5f00\u5199 :   \n\n  \u901a\u8fc7\u4e0a\u8ff0\u6027\u8d28 , \u53ea\u9700\u8981\u8fdb\u884c\u4e00\u6b21 $dfs$ ,   \n  \u5c31\u53ef\u4ee5\u627e\u5230\u6240\u6709 \u70b9\u5bf9\n  \n  1. \u83b7\u5f97\u6bcf\u4e2a\u70b9\u7684\u7236\u4eb2 \n  2. \u5c06\u4e00\u4e2a\u70b9\u4e0e\u5176 \u7236\u4eb2\u7684\u7236\u4eb2 ,   \n   \t \u5373\u5176\u4e8c\u7ea7\u7956\u5148, \u8fdb\u884c\u5339\u914d\n  3. \u679a\u4e3e\u4e00\u4e2a\u70b9\u7684\u51fa\u8fb9\u65f6 ,  \n     \u5c06\u51fa\u8fb9\u7aef\u70b9\u4e24\u4e24\u5339\u914d .\n     \n  \u6c42\u5f97\u5339\u914d\u7684\u70b9\u5bf9\u7684\u6743\u503c\u4e4b\u79ef\u540e , \u518d\u8fdb\u884c\u5904\u7406\u5373\u53ef . \n\n  \u76f4\u63a5\u6309\u7167\u4e0a\u8ff0\u8fc7\u7a0b \u5199\u51fa\u4ee3\u7801 ,   \n  \u53d6\u5f97\u4e86 $70$ \u5206\u7684\u597d\u6210\u7ee9 , $T$ \u6389\u4e86 $3$ \u4e2a\u70b9 .      \n\n---\n\n- ### \u8003\u8651\u4f18\u5316 :   \n\n  \u53d1\u73b0 $dfs$ \u4e2d,\u679a\u4e3e\u51fa\u8fb9\u7aef\u70b9 , \u5e76\u8fdb\u884c\u4e24\u4e24\u5339\u914d,   \n  \u603b\u590d\u6742\u5ea6\u662f $O(n^2)$ \u7ea7\u522b\u7684 , \u5fc5\u7136\u4f1a\u88ab\u5361\u6389 .   \n  \u4f46\u662f \u4e24\u4e24\u5339\u914d\u8fc7\u7a0b \u53c8\u4e0d\u53ef\u7f3a\u5c11   \n  \u8003\u8651\u4f18\u5316 \u8fd9 \u5fc5\u8981\u7684\u4e00\u6b65.  \n \n  \u8003\u8651 \u67d0\u7ed3\u70b9\u7684\u6240\u6709\u5b50\u7ed3\u70b9 ,  \n  \u53ef\u4ee5\u53d1\u73b0 :  \n  $\\text{\u5176 \u6700\u5927\u6743\u503c\u79ef} = \\text{\u6700\u5927\u5b50\u7ed3\u70b9\u6743\u503c} \\times \\text{\u6b21\u5927\u5b50\u7ed3\u70b9\u6743\u503c}$      \n  $\\text{\u5176 \u6743\u503c\u548c} = \\sum(\\text{\u6bcf\u4e2a\u5b50\u7ed3\u70b9\u6743\u503c} \\times \\text{\u5176\u4ed6\u5404\u5b50\u7ed3\u70b9\u7684\u6743\u503c\u548c})$  \n\n  \u8003\u8651\u9884\u5904\u7406\u51fa \u6bcf\u4e2a\u7ed3\u70b9\u7684 **\u6700\u5927\u5b50\u7ed3\u70b9\u6743\u503c , \u6b21\u5927\u5b50\u8282\u70b9\u6743\u503c , \u5b50\u7ed3\u70b9\u6743\u503c\u548c**  \n  \u53ea\u9700\u8981\u4e00\u6b21 $O(n)$ \u7684 $dfs$ \u5373\u53ef\n  \n  \u901a\u8fc7\u4e0a\u8ff0\u4f18\u5316 , \u5df2\u7ecf\u53ef\u4ee5 $A$ \u6389\u672c\u9898\u4e86\n\n---\n\n- ### \u7ee7\u7eed\u4f18\u5316  \n  \n  ~~(\u5176\u5b9e\u662f\u56e0\u4e3a\u4e0d\u4f1a\u9884\u5904\u7406\u6b21\u5927\u503c)~~  \n  \u771f\u7684\u6709\u5fc5\u8981\u5904\u7406\u51fa \u6b21\u5927\u5b50\u8282\u70b9\u6743\u503c\u5417?  \n  \u53d1\u73b0\u6839\u672c\u4e0d\u9700\u8981 , \u53ea\u9700\u8981\u5904\u7406\u51fa\u6700\u5927\u5b50\u8282\u70b9\u6743\u503c\u5373\u53ef  \n  \n  \u5f53\u679a\u4e3e\u5230\u6b21\u5927\u5b50\u8282\u70b9\u65f6 , \u5c06\u5176\u4e0e \u6700\u5927\u5b50\u8282\u70b9\u6743\u503c\u76f8\u4e58,   \n  \u5373\u53ef\u5f97\u5230 $u$ \u7684\u5b50\u8282\u70b9\u7684\u6700\u5927\u6743\u503c\u79ef   \n  \n  \u540c\u65f6\u6ce8\u610f\u5224\u91cd , \u4e0d\u80fd\u4f7f $\\ \\text{\u6700\u5927\u70b9}\\times\\text{\u6700\u5927\u70b9}$  ,     \n  \u53ef\u4ee5\u901a\u8fc7\u8bb0\u5f55 \u6700\u5927\u70b9 \u7684\u7f16\u53f7\u6765\u5b9e\u73b0.   \n\n---\n\n- ### \u4e00\u4e9b\u5c0f\u6280\u5de7:\n\n  \u7531\u4e8e\u6ca1\u6709\u8fb9\u6743\u503c ,  \n  \u53ea\u9700\u8981\u77e5\u9053\u6bcf\u4e00\u6761\u8fb9\u7684\u8d77\u70b9\u7ec8\u70b9\u5373\u53ef  \n  \u6240\u4ee5 \u53ef\u4ee5\u4f7f\u7528 $vector$ \u5b58\u8fb9 .  \n  \u6613\u4e8e\u679a\u4e3e\u5339\u914d , \u8fd8\u8282\u7701\u7a7a\u95f4   \n  \n---\n\u9644 $AC$ \u4ee3\u7801 :\n\n```cpp\n#include<cstdio>\n#include<ctype.h>\n#include<vector>\n#define max(a,b) ((a)>(b)?(a):(b))\nconst int MARX = 2e5+10;\nconst int mod = 1e4+7;\n//=============================================================\nstd::vector <int> e[MARX];\nint ans1,ans2,n,w[MARX];\nint num,head[MARX],father[MARX];\nint maxw[MARX],sumw[MARX],maxv[MARX]; //\u5206\u5b58:i\u7684\u76f4\u63a5\u5b50\u8282\u70b9 \u7684 \u6700\u5927\u6743\u503c,\u6743\u503c\u548c,\u6700\u5927\u6743\u503c\u70b9\u7684\u7f16\u53f7 \n//=============================================================\ninline int read()\n{\n    int s=1, w=0; char ch=getchar();\n    for(; !isdigit(ch);ch=getchar()) if(ch=='-') s =-1;\n    for(; isdigit(ch);ch=getchar()) w = w*10+ch-'0';\n    return s*w;\n}\nvoid dfs1(int u,int fa)//\u9884\u5904\u7406\u51fa u\u7684\u5b50\u8282\u70b9 \u7684\u6700\u5927\u6743\u503c \u548c \u6743\u503c\u548c \n{\n\tfor(int i=0;i<e[u].size();i++)//\u679a\u4e3e\u6bcf\u4e00\u4e2a\u51fa\u70b9 \n\t  if(e[u][i]!=fa)\n\t  {\n\t  \tif(w[e[u][i]] >maxw[u]) maxw[u]=w[e[u][i]] , maxv[u]=e[u][i];//\u9884\u5904\u7406\u6700\u5927\u6743\u503c \n\t  \tsumw[u]=(sumw[u]+w[e[u][i]])%mod;//\u9884\u5904\u7406\u6743\u503c\u548c \n\t    dfs1(e[u][i],u);//\u9012\u5f52\u8fdb\u884c \n\t  }\n}\nvoid dfs2(int u,int fa)\n{\n\tfather[u]=fa;//\u8bb0\u5f55\u7236\u4eb2 \n\tif(father[father[u]]) //\u5982\u679c\u5b58\u5728 \u4e8c\u7ea7\u7956\u5148 \n\t  ans1=max(ans1,w[u]*w[father[father[u]]]),//\u8fdb\u884c\u914d\u5bf9 \n\t  ans2=( ans2 + 2*w[u]*w[father[father[u]]] )%mod;\n\t\n\tfor(int i=0;i<e[u].size();i++)//\u679a\u4e3e\u76f4\u63a5\u5b50\u7ed3\u70b9 \n\t  if(e[u][i]!=fa)\n\t  {\n\t  \tif(e[u][i]!=maxv[u]) ans1=max(ans1,w[e[u][i]]*maxw[u]);//\u5982\u679c\u5f53\u524d\u70b9\u4e0d\u4e3a\u6700\u5927\u70b9 \n\t    ans2=( ans2 + w[e[u][i]]*(sumw[u]-w[e[u][i]]) )%mod;//\u589e\u52a0\u6743\u503c\u548c \n\t    dfs2(e[u][i],u); \n\t  }\n}\n//=============================================================\nsigned main()\n{\n\tn=read();\n\tfor(int i=1;i<n;i++) //vector \u5efa\u56fe \n\t{\n\t  int u=read(),v=read();\n\t  e[u].push_back(v);\n\t  e[v].push_back(u);\n\t}\n\tfor(int i=1;i<=n;i++) w[i]=read();\n\tdfs1(1,0);//\u9884\u5904\u7406 \n\tdfs2(1,0);\n\tprintf(\"%d %d\",ans1,ans2%mod);\n}\n```",
        "postTime": 1567322742,
        "uid": 186186,
        "name": "\u7075\u4e4c\u8def\u7a7a",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "```cpp\n\n\n\n\u4e00\u3001\u5ba1\u9898\n  \u9996\u5148\u6211\u4eec\u4e00\u770b\u5230\u56fe\u5c31\u5c31\u77e5\u9053\u56fe\u8bba\u6709\u5173\uff0c\u53c8\u56e0\u4e3a\u6709n\u4e2a\u70b9\u548cn-1\u6761\u8fb9\uff0c\u4e0d\u96be\u770b\u51fa\u662f\u4e00\u4e2a\u65e0\u73af\u56fe\uff0c\u8fd9\u5bf9\u9898\u76ee\u7684\u96be\u5ea6\u964d\u4f4e\u4e86\u5f88\u591a\u3002\u5982\u679c\u76f4\u63a5\u6a21\u62df\u7684\u8bdd\u80af\u5b9a\u4e0d\u884c\uff0c\u4f1a\u8d85\u65f6\uff0c\u6240\u4ee5\u6211\u4eec\u5e94\u8be5\u6362\u4e00\u79cd\u601d\u7ef4\uff0c\u53ca\u4e00\u4e2a\u70b9\u5468\u56f4\u7684\u8282\u70b9\u4e24\u4e24\u90fd\u80fd\u4ea7\u751f\u8054\u5408\u5168\u503c\uff0c\n\u4e0b\u9762\u5c31\u6765\u5b8c\u5584\u8fd9\u4e00\u601d\u60f3\u3002\n\n\n\u4e8c\u3001\u7b97\u6cd5\u8ba8\u8bba\n  \u2460\u3001\u516c\u5f0f\u63a8\u5bfc\uff1a\n\u5047\u5982\u4e00\u4e2a\u70b9x\u5b58\u5728n\u4e2a\u8282\u70b9\uff0c\u5206\u522b\u4e3ax1,x2\u2026xn.\n\u8282\u70b9\u6700\u5927\u503c\u53ea\u9700\u5b58\u4e0b\u8282\u70b9\u4e2d\u6700\u5927\u503c\uff0c\u6bcf\u6b21\u518d\u7528\u5f53\u524d\u8282\u70b9\u4e0e\u6700\u5927\u8282\u70b9\u76f8\u4e58\uff0c\u5728\u4e8emax\u6bd4\u8f83\u3002\n\u5219\u5173\u4e8ex\u8282\u70b9\u95f4\u7684\u7684\u8054\u5408\u5168\u503c\u4e4b\u548c\u4e3a\uff1a\nx\uff08x2+x3\u2026+xn\uff09+x2(x1+x3\u2026+xn)+xn(x1+x2\u2026+xn-1) \uff1b\u7ecf\u6574\u7406\u53ef\u77e5\u5c31\u662f\u6bcf\u4e24\u4e2a\u8282\u70b9\u76f8\u4e58\uff0c\u6700\u540e\u518d\u62102\u5373\u53ef\uff1b\n\u5316\u7b80\u4e3a\uff1a\nx1(x2+x3\u2026+xn)+x2(x3+x4\u2026+xn)+xn-2(xn-1+xn)+xn-1*xn\n\u53ef\u7406\u89e3\u4e3a\u628a\u6bcf\u4e00\u4e2a\u70b9\u548c\u6240\u6709\u524d\u9762\u51fa\u73b0\u7684\u7684\u70b9\u4e4b\u548c\u76f8\u4e58\u518d\u76f8\u52a0\u6700\u540e\u4e582\u3002\n\n\u2461\u3001\u6ce8\u610f\u4e8b\u9879\uff1a\n1\u3001\u56e0\u4e3a\u56fe\u662f\u6ca1\u6709\u73af\u7684\uff0c\u6240\u4ee5\u4e00\u70b9\u5230\u8ddd\u79bb\u4e3a\u4e8c\u7684\u70b9\u5fc5\u5b9a\u6709\u4e14\u4ec5\u6709\u4e00\u6761\uff0c\u6bcf\u4e00\u4e2a\u70b9\u4efb\u610f\u4e24\u4e2a\u8282\u70b9\u5fc5\u5c06\u7ecf\u8fc7\u6b64\u70b9\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u5fc5\u8ba8\u8bba\u662f\u5426\u4f1a\u91cd\u590d\u3002\n2\u3001\u56e0\u4e3a\u6570\u636e\u8303\u56f4\u5f88\u5927\uff0c\u7528\u90bb\u63a5\u77e9\u9635\u4f1a\u7206\u5185\u5b58\uff0c\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u8981\u7528\u90bb\u63a5\u77e9\u9635\u624d\u884c(\u6ce8\u610f\u8981\u5b58\u53cc\u5411\u8fb9\uff09\u3002\n3\u3001\u6c42\u8054\u5408\u6743\u503c\u4e4b\u548c\u65f6\u5fc5\u987b\u8fb9\u505a\u8fb9\u5bf910007\u53d6\u6a21\uff0c\u4e0d\u7136\u4f1a\u8d85\u51fa\u8303\u56f4\u3002\n\n\n\u4e09\u3001\u7b97\u6cd5\u5b9e\u73b0\n   \u7528\u4e00\u4e2a\u4e8c\u7ef4\u6570\u7ec4a\u5b58\u8fb9\uff0c\u4e00\u7ef4\u6570\u7ec4max1\u7528\u6765\u5b58\u8be5\u70b9\u8282\u70b9\u4e2d\u7684\u6700\u5927\u503c,\u5927\u6982\u5c31\u662f\u8fd9\u6837\u5427\uff0c\u5269\u4e0b\u7684\u53d8\u91cf\u5c31\u5728\u4ee3\u7801\u4e2d\u4e00\u4e00\u89e3\u91ca\u3002\n\n\n\u56db\u3001\u4ee3\u7801\u5c55\u793a\nc,qz,dd:array[0..400000]of longint;  \nn,i,tot,x,y,max:longint;  \n//max\u5b58\u6700\u5927\u503c\uff0ctot\u5b58\u8054\u5408\u5168\u503c\u4e4b\u548c  \nprocedure sb(x:longint);  \nvar i,tot1,nn,ny,max1:longint;  \nbegin  \n  tot1:=0; nn:=dd[x]; max1:=0;  \n  ny:=a[nn].y; \n//\u5faa\u73af\u5217\u4e3e\u8be5\u70b9\u7684\u6240\u6709\u8282\u70b9  tot1\u5b58\u524d\u9762\u51fa\u73b0\u7684\u8282\u70b9\u5168\u503c\u4e4b\u548c\u3002\n  repeat  \n    if max1*qz[ny]>max then max:=max1*qz[ny];  \n    if qz[ny]>max1 then max1:=qz[ny];  \n    tot:=(tot+tot1*(qz[ny]mod 10007))mod 10007;  \ntot1:=(tot1+qz[ny])mod 10007;  \n//\u8981\u4e0d\u65ad\u5bf910007\u53d6\u6a21\n    nn:=c[nn];  \n    ny:=a[nn].y;  \n  until nn=0;  \nend;  \nbegin  \nread(n);  \nfor i:=1 to n-1 do  \n   begin  \nread(x,y);\na[i*2-1].x:=x;a[i*2-1].y:=y;\nc[i*2-1]:=dd[x];dd[x]:=i*2-1;  \n//\u6b64\u5904\u4e3a\u53cc\u5411\u8fb9  dd\u6570\u7ec4\u7528\u6765\u628a\u8d77\u70b9\u76f8\u540c\u7684\u8fb9\u7ed1\u5b9a\u5728\u4e00\u8d77\na[i*2].x:=y;  a[i*2].y:=x;   \nc[i*2]:=dd[y];dd[y]:=i*2;  \n   end;  \nfor i:=1 to n do    \n    read(qz[i]);    \nfor i:=1 to n do  \nsb(i);  \ntot:=tot mod 10007;  \nwrite(max,' ',tot*2 mod 10007);  \n//\u6ce8\u610f\u6700\u540e\u7b54\u6848\u8981\u4e582\nend.  \n\n\n\u4e94\u3001\u6700\u540e\u7684\u5bc4\u8bed\uff1a\n    \u5176\u5b9e\u672c\u9898\u8fd8\u6709\u66f4\u7b80\u5355\u7684\u505a\u6cd5\uff0c\u5c31\u662f\u641c\u8fb9\u5373\u53ef\uff0c\u6ca1\u5fc5\u8981\u679a\u4e3e\u6bcf\u4e2a\u70b9\uff0c\u8fd9\u4e2a\u7559\u7ed9\u5927\u5bb6\u81ea\u5df1\u53bb\u60f3\uff0c\u6211\u5c31\u4e0d\u591a\u8bb2\u3002\n\n\n```",
        "postTime": 1456996752,
        "uid": 14968,
        "name": "mmqqdd",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u5bf9\u4e8e\u4e00\u68f5\u6811\uff0c\u6811\u4e0a\u8ddd\u79bb\u4e3a2\u7684\u70b9\u5c31\u662f\u4e00\u4e2a\u4e2d\u95f4\u70b9\u7684\u4e24\u4e2a\u51fa\u8fb9\u7684\u7ec8\u70b9\uff0c\u6211\u4eec\u6765\u63a8\u63a8\u5f0f\u5b50\n\n\u8bbe\u8fd9\u4e2a\u4e2d\u95f4\u70b9\u53ea\u6709\u4e09\u4e2a\u51fa\u8fb9\uff0c\u51fa\u8fb9\u7684\u7ec8\u70b9\u8bbe\u4e3a`w1,w2,w3`\n\n\u6b64\u65f6\u7684`sum`\u5c31\u4e3a:\n\n$$(w_1*w_2+w_1*w_3+w_2*w_3)*2$$\n\n\n\u90a3\u4e48\u5047\u8bbe\u6211\u4eec\u5f53\u524d\u679a\u4e3e\u5230\u4e86`w1`\n\n\u521d\u59cb\u5316\n\n$$now=0$$\n\n\u6b64\u65f6\n\n$$now+=w_1;$$\n\n\u5bf9\u603b\u7b54\u6848\u7684\u8d21\u732e\u4e3a`0`(\u56e0\u4e3a\u53ea\u6709\u4e00\u4e2a\u70b9\uff09\n\n\u7136\u540e\u679a\u4e3e\u5230`w2`\n\n$$sum+=now*w_2,now+=w_2$$\n\n\u8fd9\u4e48\u7b97\u51fa\u6765\u7684\n\n$$sum=w_1*w_2,now=w_1+w_2$$\n\n\u518d\u679a\u4e3e`w3`\n\n$$sum+=now*w_3,now+=w_3$$\n\n\u6b64\u65f6\n\n$$sum=w_1*w_2+(w_1+w_2)*w_3,now=w_1+w_2+w_3$$\n\n\u60ca\u559c\u7684\u53d1\u73b0\n\n$$sum=w_1*w_2+w_1*w_3+w_2*w_3$$\n\n\u7b97\u51fa\u6765\u662f\u6b63\u786e\u7ed3\u679c\u7684\u4e00\u534a\n\n\u8fd9\u5c31\u53ef\u4ee5\u63a8\u5e7f\u5230\u591a\u4e2a\u70b9~~\u4e0d\u4fe1\u4f60\u8bd5\u8bd5~~\n\ndalao\u8bf4\u662f\u56e0\u4e3a\u52a0\u6cd5\u4e58\u6cd5\uff0c\u6700\u5927\u503c\u6ee1\u8db3\u7ed3\u5408\u5f8b,\u4f46\u6211\u89c9\u5f97\u8fd9\u4e48\u63a8\u4e00\u4e0b\u66f4\u597d\u7406\u89e3\n\n\u7136\u540e\u505a\u6cd5\u5c31\u53d8\u6210\u4e86\u679a\u4e3e\u4e2d\u95f4\u70b9\uff0c\u904d\u5386\u8fd9\u4e2a\u70b9\u7684\u6240\u6709\u51fa\u8fb9\uff0c\u8bb0\u5f55\u4e00\u4e2a`now`\u8868\u793a\u5f53\u524d\u679a\u4e3e\u8fc7\u7684\u51fa\u8fb9\u7684\u70b9\u7684\u548c\uff0c\u6bcf\u6b21\u904d\u5386\u5230\u4e00\u4e2a\u70b9\u65f6\uff0c\u5148\u7528`now*val[v]`\u66f4\u65b0\u7b54\u6848,\u518d`\u66f4\u65b0now`\u7684\u503c\n\n\u6700\u5927\u503c\u540c\u6837\u5982\u6b64\n\n\u8fd8\u6709\u4e00\u4e2a\u5c0f\u5c0f\u7684\u5c0f\u95ee\u9898\uff1a\n```cpp\nfor(i=1;i<=n;i++)\n\tfor(re j=head[i];j;j=e[j].nxt)\n\n```\n\n\u8bd5\u95ee\u8fd9\u4e2a\u7a0b\u5e8f\u590d\u6742\u5ea6\u662f\u591a\u5c11\uff1f\n\n\u5176\u5b9e\u662f`O(n+e)`\u7684\uff0c\u56e0\u4e3a\u6bcf\u6761\u8fb9\u81f3\u591a\u904d\u5386\u4e24\u6b21\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\n#define re register int\n#define ll long long\n#define maxn 100050\n#define mod 10007\nusing namespace std;\nstruct tu{\n\tint u,v,w,nxt;\n}e[maxn<<1];\nint val[maxn];\nint head[maxn],cnt;\nvoid add(int u,int v){\n\te[++cnt].u=u;\n\te[cnt].v=v;\n\te[cnt].nxt=head[u];\n\thead[u]=cnt;\n}\nint n,m;\nint mmax,rt;\nint sum;\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(re i=1;i<=n-1;i++){\n\t\tint a1,a2;\n\t\tscanf(\"%d%d\",&a1,&a2);\n\t\tadd(a1,a2);\n\t\tadd(a2,a1);\n\n\t}\n\n\tfor(re i=1;i<=n;i++)\n\tscanf(\"%d\",&val[i]);\n\tfor(re i=1;i<=n;i++){\n\t\tint now1=0,now2=0;\n\t\tfor(re j=head[i];j;j=e[j].nxt){\n\t\t\tint v=e[j].v;\n\t\t\tsum=(sum+(now1*val[v]))%mod;\n\t\t\tmmax=max(mmax,now2*val[v]);\n\t\t\tnow1=(now1+val[v])%mod;\n\t\t\tnow2=max(now2,val[v]);\n\t\t\n\t\t}\t\t\n\t}\n\tprintf(\"%d %d\\n\",mmax,(sum*2)%mod);\n\t//*2\n\t\n\treturn 0;\n}\t\n```\n\n\n\n",
        "postTime": 1571662107,
        "uid": 57823,
        "name": "\u7ea2\u8272OI\u518d\u4e34",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u6211\u7684\u65b9\u6cd5\u597d\u50cf\u4e0d\u5982\u5176\u4ed6\u9898\u89e3\u90a3\u4e48~~\u77ed~~ \u4f46\u5e94\u8be5\u662f~~\u6700~~ \u6bd4\u8f83\u6613\u4e8e\u7406\u89e3\u7684\n\n\u9996\u5148\u770b\u5230$dis = 2$ \u611f\u89c9\u662f\u9053\u6811\u5f62$DP$\n\n\u9996\u5148\u8003\u8651$dis=2$ \u5047\u8bbe\u4ece$u - > v$\u4e14$dis[u][v] = 2$ \u90a3\u4e48\u4ece$u -> v$\u8def\u5f84\u4e0a\u6709\u4e14\u53ea\u4f1a\u7ecf\u8fc7\u4e00\u4e2a\u70b9 \u8fd9\u91cc\u8bb0\u4e3a $w$ \u5373$u -> v$\u8def\u5f84\u4e0a\u5fc5\u987b\u7ecf\u8fc7$w$\n\n\u4ee5$w$\u8003\u8651 \u90a3\u4e48$dis=2$\u5c31\u88ab\u62c6\u5206\u6210$dis = 1$\u7684\u60c5\u51b5 \u53ea\u8981\u8ba1\u7b97\u8fde\u63a5$w$\u7684\u70b9\n\n\u8fd9\u91cc\u7ef4\u62a4\u51e0\u4e2a\u503c\n\n```cpp\nf[u][1]\u8868\u793a\u4ee5u\u4e3a\u4e2d\u8f6c\u8282\u70b9\u7684\u6700\u5927\u8054\u5408\u6743\u503c \n\nf[u][0]\u8868\u793a\u4ee5u\u4e3a\u4e2d\u8f6c\u8282\u70b9\u7684\u6743\u503c\u4e4b\u548c\n\nf[u][2]\u8868\u793a\u4ee5u\u4e3a\u4e2d\u8f6c\u8282\u70b9\u7684\u8054\u5408\u6743\u503c\u4e4b\u548c\n\nf[u][3]\u8868\u793a\u4ee5u\u4e3a\u4e2d\u8f6c\u8282\u70b9\u7684\u7b2c\u4e00\u5927\u6743\u503c\n\nf[u][4]\u8868\u793a\u4ee5u\u4e3a\u4e2d\u8f6c\u8282\u70b9\u7684\u7b2c\u4e8c\u5927\u6743\u503c\n```\n\n\u5173\u4e8e$f[u][0]$\u7684\u8f6c\u79fb\u5e94\u8be5\u6bd4\u8f83\u663e\u7136 \u56e0\u4e3a\u4e58\u6cd5\u6ee1\u8db3\u7ed3\u5408\u5f8b \u6240\u4ee5\n$$f[u][0] += w[v] * (f[u][2] - w[v])$$\n\n\u7136\u540e\u6b64\u9898\u5c31\u5b8c\u7ed3\u4e86 \u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$\n\n# code\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\n\nconst int INF = 2139062143;\n\n#define DEBUG(x) std::cerr << #x << \" = \" << x << std::endl\n\ninline ll read() {\n    ll f = 1, x = 0;char ch;\n    do {ch = getchar();if (ch == '-')f = -1;} while (ch > '9' || ch < '0');\n    do {x = x * 10 + ch - '0';ch = getchar();} while (ch >= '0' && ch <= '9');\n    return f * x;\n}\n\nconst int MAX_N = 200050;\n\n#define int ll\n\nll n, ans1, ans2, f[MAX_N][5], w[MAX_N];\n\nstruct EDGE {\n\tint to, next;\n} edge[MAX_N << 1];\n\nint head[MAX_N], cnt;\n\nconst int mod = 10007;\n\nvoid addedge (int u, int v) {\n\tedge[++cnt].to = v;\n\tedge[cnt].next = head[u];\n\thead[u] = cnt;\n}\n\n//f[u][1]\u8868\u793a\u4ee5u\u4e3a\u4e2d\u8f6c\u8282\u70b9\u7684\u6700\u5927\u8054\u5408\u6743\u503c \n\n//f[u][0]\u8868\u793a\u4ee5u\u4e3a\u4e2d\u8f6c\u8282\u70b9\u7684\u6743\u503c\u4e4b\u548c\n\n//f[u][2]\u8868\u793a\u4ee5u\u4e3a\u4e2d\u8f6c\u8282\u70b9\u7684\u8054\u5408\u6743\u503c\u4e4b\u548c\n\n//f[u][2] += (w[u] * (f[u][0] - w[u]))\n\n//f[u][3]\u8868\u793a\u4ee5u\u4e3a\u4e2d\u8f6c\u8282\u70b9\u7684\u7b2c\u4e00\u5927\u6743\u503c\n\n//f[u][4]\u8868\u793a\u4ee5u\u4e3a\u4e2d\u8f6c\u8282\u70b9\u7684\u7b2c\u4e8c\u5927\u6743\u503c\n\ninline void work () {\n\tfor (int u = 1; u <= n; u ++ ) {\n\t\tfor (int i = head[u]; i; i = edge[i].next) {\n\t\t\tint v = edge[i].to;\n\t\t\tif (w[v] > f[u][3]) {\n\t\t\t\tf[u][4] = f[u][3];\n\t\t\t\tf[u][3] = w[v];\n\t\t\t}\n\t\t\telse\n\t\t\t\tf[u][4] = max (f[u][4], w[v]);\n\t\t\tf[u][2] = (f[u][2] + w[v]) % mod;\n\t\t}\n\t}\n\t\n}\n\ninline void dfs (int u, int fa) {\n\tans1 = max (ans1, 1ll * f[u][3] * f[u][4]);\n\tf[u][0] = (f[u][0] + 1ll * w[fa] % mod * (f[u][2] - w[fa]) % mod + mod) % mod;\n\tfor (int i = head[u]; i; i = edge[i].next) {\n\t\tint v = edge[i].to;\n\t\tif (v == fa) continue;\n\t\tdfs (v, u);\n\t\tf[u][0] = (f[u][0] + 1ll * w[v] % mod * (f[u][2] - w[v]) % mod + mod) % mod;\n\t}\n//\tcout << f[u][0] << \" \";\n\tans2 = (ans2 + f[u][0]) % mod;\n//\tans2 %= mod;\n}\n\nsigned main() {\n\tn = read();\n\tfor (int i = 1; i < n; i ++ ) {\n\t\tint u = read(), v = read();\n\t\taddedge (u, v);\n\t\taddedge (v, u);\n\t}\n\tfor (int i = 1; i <= n; i ++ ) w[i] = read();\n\twork ();\n//\tfor (int i = 1; i <= n; i ++ ) {\n//\t\tcout << f[i][0] << \" \" << f[i][3] << \" \" << f[i][4] << endl;\n//\t}\n\tdfs (1, 0);\n\tcout << ans1 << \" \" << ans2 % mod << endl; \n\treturn 0;\n}\n```",
        "postTime": 1570790954,
        "uid": 107377,
        "name": "Cryin",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u9996\u5148$G$\u5c31\u662f\u4e2a\u65e0\u6839\u6811  \n\u6211\u4eec\u9700\u8981\u628a\u9898\u76ee\u4e2d\u5947\u602a\u7684\u6761\u4ef6\u51c6\u8f6c\u5316  \n\u5bf9\u4e8e\u8ddd\u79bb\u4e3a2\u7684\u70b9\u5bf9$(x,y)$ \u4ecex\u5230y\u7684\u8def\u5f84\u4f1a\u7ecf\u8fc7\u4e14\u4ec5\u7ecf\u8fc7\u4e00\u4e2a\u70b9  \n\u800c\u7531\u4e8e\u8fd9\u662f\u65e0\u6839\u6811 \u6240\u4ee5\u8fd9\u4e2a\u70b9\u662f\u552f\u4e00\u786e\u5b9a\u7684  \n\n\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u4e2d\u95f4\u70b9  \n\u7136\u540e\u628a\u6240\u6709\u4e0e\u8fd9\u4e2a\u70b9\u76f8\u8fde\u7684\u70b9\u6682\u65f6\u5b58\u4e0b\u6765 \u4e24\u4e24\u76f8\u4e58\u8ba1\u7b97\u6743\u503c  \n\u628a\u6240\u6709\u7684\u70b9\u679a\u4e3e\u4e00\u904d \u8fd9\u6837\u4e00\u5b9a\u662f\u4e0d\u4f1a\u91cd\u590d\u6216\u9057\u6f0f\u7684  \n\n\u4f46\u662f\u4e0a\u9762\u7684\u7b97\u6cd5\u4f1a\u88ab\u83ca\u82b1\u56fe\u5361\u6389 \u9700\u8981\u4f18\u5316  \n\u5047\u8bbe\u548c\u8fd9\u4e2a\u70b9\u76f8\u8fde\u7684\u70b9\u4e3a$x_1,x_2,...,x_n$ \u90a3\u4e48\u4f1a\u4ea7\u751f$\\frac{n\\dot(n-1)}{2}$\u4e2a\u6743\u503c  \n\u5148\u89c2\u5bdf\u4e24\u4e2a\u70b9\u7684\u60c5\u51b5  \n$2x_1x_2=(x_1+x_2)^2-(x_1^2+x_2^2)$  \n\u4e09\u4e2a\u70b9\u7684\u60c5\u51b5  \n$2x_1x_2+2x_1x_3+2x_2x_3=(x_1+x_2+x_3)^2-(x_1^2+x_2^2+x_3^2)$  \nn\u4e2a\u70b9\u6743\u503c\u548c\u4e3a$2x_1x_2+2x_1x_3+...+2x_1x_n+2x_2x_3+2x_2x_4+...+2x_2x_n+...+2x_{n-1}x_n$\n$=(\\Sigma{x_i})^2-\\Sigma x_i^2$  \n\u4e0b\u9762\u8fd9\u4e2a\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u53ea\u8ba1\u7b97\u8be5\u70b9\u5ea6\u6570\u7684\u6b21\u6570  \n\u800c\u6240\u6709\u70b9\u7684\u5ea6\u6570\u4e4b\u548c\u662f$O(n)$\u7ea7\u522b\u7684  \n\n\u5bf9\u4e8e\u6700\u5927\u503c \u5728\u4e0a\u9762\u8bb0\u5f55\u6700\u5927\u7684\u4e24\u4e2a\u70b9\u5c31\u53ef\u4ee5\u4e86  \n\u6211\u8fd9\u91cc\u76f4\u63a5\u5b58\u4e0b\u6765\u4e0e\u6bcf\u4e00\u4e2a\u70b9\u76f8\u8fde\u7684\u6240\u6709\u70b9 \u7136\u540e\u6392\u5e8f\u53d6\u4e24\u4e2a\u6700\u5927\u7684...  \n```cpp\n#include <cstdio>\n#include <iostream>\n#include <algorithm>\n#include <cstring>\nusing namespace std;\ntypedef long long LL;\nconst int N = 10007;\n\nint mx = 0,ans = 0;\nint n,a,b;\nint v[200005] = {0};\nint ec = 0,hed[200005] = {0},nxt[400005] = {0},to[400005] = {0};\nint val[200005] = {0};\n\nvoid add_edge(int f,int t){\n\t++ ec; to[ec] = t; nxt[ec] = hed[f]; hed[f] = ec;\n}\n\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i = 1;i < n;i ++){ scanf(\"%d %d\",&a,&b); add_edge(a,b); add_edge(b,a); }\n\tfor(int i = 1;i <= n;i ++) scanf(\"%d\",&v[i]);\n\tfor(int i = 1;i <= n;i ++){\n\t\tint s1 = 0,s2 = 0,cnt = 0;\n\t\tfor(int j = hed[i];j;j = nxt[j]){\n\t\t\tval[++ cnt] = v[to[j]];\n\t\t\ts1 += v[to[j]]; s1 %= N;\n\t\t\ts2 += v[to[j]] * v[to[j]]; s2 %= N;\n\t\t}\n\t\tsort(val + 1,val + 1 + cnt);\n\t\tmx = max(mx,val[cnt] * val[cnt - 1]);\n\t\ts1 = s1 * s1 % N;\n\t\tans = (ans + s1 - s2 + N) % N;\n\t}\n\tprintf(\"%d %d\\n\",mx,ans);\n\treturn 0;\n}\n```",
        "postTime": 1567068125,
        "uid": 31440,
        "name": "installb",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://xiaohuang888.github.io/2019/08/21/%E3%80%8E%E9%A2%98%E8%A7%A3%E3%80%8F%E6%B4%9B%E8%B0%B7P1351%20%E8%81%94%E5%90%88%E6%9D%83%E5%80%BC)\n\n### Solution\n\n\u6211\u4eec\u5148\u770b\u4e00\u4e0b\u9898\u76ee\uff1a\u65e0\u5411\u8fde\u901a\u56fe$\\mathrm G$\u6709$n$\u4e2a\u70b9\uff0c$n - 1$\u6761\u8fb9\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u9898\u76ee\u7ed9\u51fa\u7684\u662f\u4e00\u9897\u6811\u3002\n\n\u6211\u4eec\u770b\u4e00\u4e2a\u4f8b\u5b50\uff1a\n\n![](https://s2.ax1x.com/2019/08/22/macLHP.png)\n\n\u8fd9\u4e2a\u56fe\u7684\u8054\u5408\u6743\u503c\u548c\u4e3a$W_2 \\times W_3 + W_4 \\times W_5 + W_4 \\times W_6 + W_5 \\times W_6 + W_7 \\times W_8$\u3002\n\n\n![](https://s2.ax1x.com/2019/08/22/magjq1.png)\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u6211\u4eec\u6c42\u7684\u662f\u5bf9\u4e8e\u6bcf\u4e00\u68f5\u5b50\u6811\u7684\u975e\u6839\u8282\u70b9\u7684\u6240\u6709\u5b50\u7ed3\u70b9\u4e24\u4e24\u76f8\u4e58\u7684\u6743\u503c\u548c\u3002\u4f46\u662f\u6211\u4eec\u5bf9\u6bcf\u4e00\u68f5\u5b50\u6811\u90fd\u904d\u5386\u4e00\u904d\u663e\u7136\u8981\u8d85\u65f6\u3002\u6211\u4eec\u53ef\u4ee5\u627e\u5230\u5982\u4e0b\u6027\u8d28\uff1a\n\n$(a + b) ^ 2 = a ^ 2 + b ^ 2 + 2ab$\n\n$(a + b + c) ^ 2 = a ^ 2 + b ^ 2 + c ^ 2 + 2ab+ 2ac + 2bc$\n\n$(a + b + c + d) =  a ^ 2 + b ^ 2 + c ^ 2 + d ^ 2 + 2ab+ 2ac + 2ad + 2bc + 2bd + 2cd$\n\n$\\cdots \\cdots$\n\n\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f\u5e73\u65b9\u9879\u540e\u9762\u7684\u4e00\u534a\u3002\u5c31\u662f $\\texttt{\u548c\u7684\u5e73\u65b9} - \\texttt{\u5e73\u65b9\u7684\u548c}$ \u3002\n\n\u7edf\u8ba1\u6700\u5927\u503c\u662f\u53ea\u9700\u8981\u627e\u51fa\u6700\u5927\u7684\u4e24\u9879\uff0c\u7136\u540e\u76f8\u4e58\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u8fd9\u6837\u5c31\u8fd9\u9053\u9898\u5c31\u89e3\u51b3\u4e86\u3002\n\n### Code\n\n```cpp\n#include<iostream>\n#include<algorithm>\n#include<cstdio>\n#include<cstring>\n#include<cmath>\n\nusing namespace std;\n\ntypedef long long LL;\nconst int INF = 0x3f3f3f3f, MAXN = 400005, MAXM = 200005, mod = 10007;\nstruct EDGE {\n    int to, nxt;\n} edge[MAXN];\nint n, u, v, cnt, w[MAXM], head[MAXN];\ninline void addedge(int u, int v) {\n    edge[++cnt].to = v; edge[cnt].nxt = head[u]; head[u] = cnt;\n}\nint main() {\n    scanf(\"%d\", &n);\n    memset(head, -1, sizeof(head));\n    for (int i = 1; i < n; i++) {\n        scanf(\"%d%d\", &u, &v);\n        addedge(u, v); addedge(v, u);//\u52a0\u8fb9\n    }\n    for (int i = 1; i <= n; i++)\n        scanf(\"%d\", &w[i]);\n    LL Max = -INF, ans = 0;\n    for (int i = 1; i <= n; i++) {\n        LL Max1 = -INF, Max2 = -INF, tot1 = 0, tot2 = 0;//Max1\u8868\u793a\u6700\u5927\u7684\u6743\u503c\uff0cMax2\u8868\u793a\u7b2c\u4e8c\u5927\u7684\u6743\u503c\uff0ctot1\u8868\u793a\u548c\u7684\u5e73\u65b9\uff0ctot2\u8868\u793a\u5e73\u65b9\u7684\u548c\n        for (int j = head[i]; ~j; j = edge[j].nxt) {//\u904d\u5386\u6bcf\u4e00\u4e2a\u70b9\n            if (w[edge[j].to] > Max1) {\n                Max2 = Max1;\n                Max1 = w[edge[j].to];\n            } else\n            if (w[edge[j].to] > Max2 && w[edge[j].to] <= Max1) Max2 = w[edge[j].to];//\u627e\u4e24\u4e2a\u6700\u5927\u7684\n            tot1 += w[edge[j].to]; tot2 = (tot2 + w[edge[j].to] * w[edge[j].to]) % mod;//\u7d2f\u8ba1\u5f53\u524d\u70b9\u7684\u6743\u503c\n        }\n        tot1 = (tot1 % mod * tot1 % mod) % mod;//\u548c\u7684\u5e73\u65b9\n        ans = (ans + tot1 - tot2 + mod) % mod;//\u7d2f\u52a0\u7b54\u6848\n        Max = max(Max, Max1 * Max2);//\u627e\u6700\u5927\u6743\u503c\n    }\n    printf(\"%lld %lld\\n\", Max, ans);\n    return 0;\n}\n```\n\n### Attachment\n\n\u6d4b\u8bd5\u6570\u636e\u4e0b\u8f7d\uff1ahttps://www.lanzous.com/i5q1vdg",
        "postTime": 1566441400,
        "uid": 19729,
        "name": "xiaohuang",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u8fd9\u9898...\n\n\u672c\u6765\u60f3\u5199\u4e00\u4e2a\u66b4\u529b\u679a\u4e3e\u7684\u89e3\u2642fa\uff08\n\n\u7136\u540e\u53d1\u73b0\u6570\u636e\u4f3c\u4e4e\u662f\u52a0\u4e86\u4e09\u7ec4\u83ca\u82b1\u56fe\uff1f\uff1f\uff1f\n\n\u51c9\u6389\uff08\n\n\u4e8e\u662f\u82b1\u4e86\u70b9\u65f6\u95f4\u5199\u4e86\u4e2a\u6811\u5f62$dp$\u5e76\u4e14\u4e00\u53d1\u2642\u5165\u9b42\uff08\n\n---\n\n\u5f00\u59cb\u6b63\u9898\n\n\u9996\u5148\u5bb9\u6613\u60f3\u5230\uff0c\u6709\u6839\u6811\u4e0a\u4e24\u70b9\u82e5\u8ddd\u79bb\u4e3a$2$\uff0c\u5219\u53ea\u53ef\u80fd\u662f\u5144\u5f1f\u5173\u7cfb\u6216\u7956\u5b59\u5173\u7cfb\n\n\u7956\u5b59\u5173\u7cfb\u7edf\u8ba1\u7b54\u6848\u5f88\u5bb9\u6613\uff1a\n\n\u5bf9\u6bcf\u4e2a\u70b9\u8bb0\u5f55\u5176\u5b50\u8282\u70b9\u7684\u6700\u5927\u6743\u503c\u3001\u6743\u503c\u603b\u548c\uff0c\u7136\u540e\u5728\u5176\u7236\u8282\u70b9\u5904\u7edf\u8ba1\u7b54\u6848\u3002\n\n\u91cd\u70b9\u662f\u5144\u5f1f\u5173\u7cfb\uff1a\n\n\u8bb0\u5f55\u6700\u5927\u503c\u4f9d\u7136\u5f88\u5bb9\u6613\uff0c\u53ea\u8981\u5b58\u4e00\u4e2a\u6700\u5927\u503c\u548c\u4e00\u4e2a\u6b21\u5927\u503c\uff0c\u4e58\u8d77\u6765\u5c31\u662f\u3002\n\n\u7136\u800c\u6c42\u548c\u4e0d\u80fd$O(n^2)$\u679a\u4e3e\u70b9\u5bf9\uff0c\u4f1a\u88ab\u83ca\u82b1\u56fe\u5361\u6389\uff08\n\n\u6709\u7684\u5927\u4f6c\u91c7\u7528\u8bb0\u5f55\u548c\u4e0e\u5e73\u65b9\u548c\u7684\u529e\u2642fa\u6c42\u89e3\uff0c\u8868\u793a\u5e76\u4e0d\u60f3\u63a8\u67ff\u5b50\uff08\n\n\u4ed4\u7ec6\u89c2\u5bdf\uff0c\u53d1\u73b0\u6211\u4eec\u679a\u4e3e\u513f\u5b50\u7684\u8fc7\u7a0b\u4e2d\u8981\u7b97$sum$\n\n\u800c$sum$\u662f\u5df2\u7ecf\u679a\u4e3e\u8fc7\u7684\u513f\u5b50\u7684\u6743\u503c\u603b\u548c...\n\n\u6240\u4ee5\u5c06\u5f53\u524d\u8282\u70b9\u6743\u503c\u4e0e\u4e4b\u524d\u679a\u4e3e\u8fc7\u7684\u6743\u503c\u603b\u548c\u4e58\u8d77\u6765\uff0c\u5c31\u662f\u5f53\u524d\u8282\u70b9\u4ea7\u751f\u7684\u8d21\u732e\u3002\n\n\u53e3\u80e1\u6ca1\u4ec0\u4e48\u7528\uff0c\u6765\u63a8\u67ff\u5b50 ~~\uff08\u771f\u9999~~\n\n\u8bbe\u5f53\u524d\u8282\u70b9\u6709$n$\u4e2a\u513f\u5b50\uff0c\u6807\u53f7$1$\u5230$n$\uff0c$i$\u53f7\u8282\u70b9\u6743\u503c$w_i$\u3002\n\n$\\sum_{i=1}^n \\sum_{j=1}^n w_i w_j$\n\n$=\\sum_{i=1}^n (w_i \\sum_{j=1}^n w_j)$\n\n$=2\\sum_{i=1}^n(w_i \\sum_{j=1}^{i-1} w_j)$\n\n\u4e8e\u662f\u539f\u672c$O(n^2)$\u5377\u8d77\u6765\u7684\u505a\u2642fa\u5316\u8eab$O(n)$\uff08\n\n\u5176\u5b9e\u5728[\u8fd9\u9898](https://www.luogu.org/problem/P3469)\u4e2d\u4e5f\u4f1a\u7528\u5230\u7c7b\u4f3c\u7684\u65b9\u2642fa\u3002\n\n---\n\n\u4ee3\u7801\uff1a\n\n\uff08\u6b63\u5e38\u5411\u7801\u98ce\uff0c\u65e0\u9632\u4f5c\u5f0a ~~\uff0c\u65b9\u4fbf\u6284\u88ad~~\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n\nconst int N=200005,P=10007;\n\nint n,head[N],wei[N];\n\nstruct Edge\n{\n    int next,to;\n};\nEdge E[N<<1];\nvoid add(int u,int v)\n{\n    static int tot=0;\n    E[++tot].next=head[u];\n    E[tot].to=v;\n    head[u]=tot;\n}\n\nint res1,res2,sum[N],maxs[N],_maxs[N];//res1\u6700\u5927\u503c\uff0cres2\u603b\u548c\uff0csum\u6bcf\u4e2a\u70b9\u513f\u5b50\u7684\u6743\u503c\u548c\n//maxs\u6700\u5927\u7684\u513f\u5b50\u6743\u503c\uff0c_maxs\u6b21\u5927\u6743\u503c\n\nvoid dfs(int u,int fa)\n{\n    for(int i=head[u];i;i=E[i].next)\n    {\n        int v=E[i].to;\n        if(v==fa)continue;\n        dfs(v,u);\n        res2=(res2+sum[u]*wei[v]%P)%P;//\u7edf\u8ba1\u5df2\u7ecf\u679a\u4e3e\u8fc7\u7684\u5144\u5f1f\u7684\u8d21\u732e\n        res2=(res2+sum[v]*wei[u]%P)%P;//\u7edf\u8ba1\u7956\u5b59\u5173\u7cfb\u7684\u8d21\u732e\n        res1=std::max(res1,wei[u]*maxs[v]);//\u6309\u7956\u5b59\u5173\u7cfb\u66f4\u65b0\u6700\u5927\u503c\n        sum[u]=(sum[u]+wei[v])%P;\n        if(wei[v]>maxs[u])\n        {\n            _maxs[u]=maxs[u];\n            maxs[u]=wei[v];\n        }\n        else if(wei[v]>_maxs[u])\n        {\n            _maxs[u]=wei[v];\n        }\n    }\n    res1=std::max(res1,maxs[u]*_maxs[u]);//\u6309\u5144\u5f1f\u5173\u7cfb\u66f4\u65b0\u6700\u5927\u503c\n}\n\nint main()\n{\n    scanf(\"%d\",&n);\n    for(int i=1;i<n;++i)\n    {\n        int u,v;\n        scanf(\"%d%d\",&u,&v);\n        add(u,v);\n        add(v,u);\n    }\n    for(int i=1;i<=n;++i)scanf(\"%d\",wei+i);\n    dfs(1,0);\n    printf(\"%d %d\",res1,res2*2%P);//\u7531\u4e8e\u53ea\u7edf\u8ba1\u4e86\u65e0\u5e8f\u70b9\u5bf9\u7684\u7b54\u6848\u603b\u548c\u6240\u4ee5\u8981\u4e582\n}\n```\n\n",
        "postTime": 1566009843,
        "uid": 60489,
        "name": "\u5c0f\u83dc\u9e1f",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "#### [\u535a\u5ba2\u4f20\u9001\u95e8](https://blog.csdn.net/huang_ke_hai/article/details/86682061)\n\u9898\u76ee\u63cf\u8ff0\uff1a\n\u65e0\u5411\u8fde\u901a\u56fe G \u6709 n \u4e2a\u70b9\uff0cn\u22121 \u6761\u8fb9\u3002\u70b9\u4ece 1 \u5230 n \u4f9d\u6b21\u7f16\u53f7,\u7f16\u53f7\u4e3a i \u7684\u70b9\u7684\u6743\u503c\u4e3a Wi\uff0c\u6bcf\u6761\u8fb9\u7684\u957f\u5ea6\u5747\u4e3a 1\u3002\u56fe\u4e0a\u4e24\u70b9 (u,v) \u7684\u8ddd\u79bb\u5b9a\u4e49\u4e3a u \u70b9\u5230 v \u70b9\u7684\u6700\u77ed\u8ddd\u79bb\u3002\u5bf9\u4e8e\u56fe G \u4e0a\u7684\u70b9\u5bf9 (u,v)\uff0c\u82e5\u5b83\u4eec\u7684\u8ddd\u79bb\u4e3a 2\uff0c\u5219\u5b83\u4eec\u4e4b\u95f4\u4f1a\u4ea7\u751fWv\u00d7Wu\u200b \u7684\u8054\u5408\u6743\u503c\u3002\n\u8bf7\u95ee\u56fe G \u4e0a\u6240\u6709\u53ef\u4ea7\u751f\u8054\u5408\u6743\u503c\u7684\u6709\u5e8f\u70b9\u5bf9\u4e2d\uff0c\u8054\u5408\u6743\u503c\u6700\u5927\u7684\u662f\u591a\u5c11\uff1f\u6240\u6709\u8054\u5408\u6743\u503c\u4e4b\u548c\u662f\u591a\u5c11\uff1f\n***\n\u8f93\u5165\u8f93\u51fa\u683c\u5f0f\n\n\u8f93\u5165\u683c\u5f0f\uff1a\n\u7b2c\u4e00\u884c\u5305\u542b 1 \u4e2a\u6574\u6570 n\u3002\n\u63a5\u4e0b\u6765 n\u22121 \u884c,\u6bcf\u884c\u5305\u542b 2 \u4e2a\u7528\u7a7a\u683c\u9694\u5f00\u7684\u6b63\u6574\u6570 u,v\uff0c\u8868\u793a\u7f16\u53f7\u4e3a u \u548c\u7f16\u53f7\u4e3a v \u7684\u70b9\u4e4b\u95f4\u6709\u8fb9\u76f8\u8fde\u3002\n\u6700\u540e 1 \u884c,\u5305\u542b n \u4e2a\u6b63\u6574\u6570\uff0c\u6bcf\u4e24\u4e2a\u6b63\u6574\u6570\u4e4b\u95f4\u7528\u4e00\u4e2a\u7a7a\u683c\u9694\u5f00\uff0c\u5176\u4e2d\u7b2c i \u4e2a\u6574\u6570\u8868\u793a\u56fe G \u4e0a\u7f16\u53f7\u4e3a i \u7684\u70b9\u7684\u6743\u503c\u4e3a Wi\u3002\n***\n\u8f93\u51fa\u683c\u5f0f\uff1a\n\u8f93\u51fa\u5171 1 \u884c,\u5305\u542b 2 \u4e2a\u6574\u6570\uff0c\u4e4b\u95f4\u7528\u4e00\u4e2a\u7a7a\u683c\u9694\u5f00,\u4f9d\u6b21\u4e3a\u56fe G \u4e0a\u8054\u5408\u6743\u503c\u7684\u6700\u5927\u503c\u548c\u6240\u6709\u8054\u5408\u6743\u503c\u4e4b\u548c\u3002\u7531\u4e8e\u6240\u6709\u8054\u5408\u6743\u503c\u4e4b\u548c\u53ef\u80fd\u5f88\u5927\uff0c\u8f93\u51fa\u5b83\u65f6\u8981\u5bf910007\u53d6\u4f59\u3002\n***\n**\u5206\u6790\uff1a\u56e0\u4e3a\u9898\u76ee\u8bf4\u4e24\u4e2a\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u4e3a2\u5c31\u662f\u4e00\u4e2a\u6709\u5e8f\u6570\u5bf9\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053\u4e00\u5bf9\u6709\u5e8f\u5e8f\u5bf9\u4e4b\u95f4\u5fc5\u5b9a\u9694\u7740\u4e00\u4e2a\u4e2d\u8f6c\u70b9** \u4f8b\u5982\u4e0b\u56fe\uff1a\n![\u5728\u8fd9\u91cc\u63d2\u5165\u56fe\u7247\u63cf\u8ff0](https://img-blog.csdnimg.cn/20190128194512532.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1YW5nX2tlX2hhaQ==,size_16,color_FFFFFF,t_70)\u5176\u4e2d1\u30012\u30013\u30014\u4e92\u4e3a\u5e8f\u5bf9\uff0c\u56e0\u4e3a\u5b83\u4eec\u90fd\u9694\u7740\u4e00\u4e2a\u4e2d\u8f6c\u70b95\uff0c\u5b83\u4eec\u4e4b\u95f4\u7684\u8ddd\u79bb\u90fd\u4e3a2\uff0c\u6240\u4ee5\u505a\u8fd9\u9053\u9898\u7684\u57fa\u7840\u5c31\u662f\u679a\u4e3e\u4e2d\u8f6c\u70b9\uff0c\u5b83\u5ef6\u4f38\u51fa\u53bb\u7684\u70b9\u5fc5\u5b9a\u4e92\u4e3a\u5e8f\u5bf9\u3002\n\n\u90a3\u4e48\u679a\u4e3e\u7684\u95ee\u9898\u89e3\u51b3\u4e86\uff0c\u8fd9\u56de\u6211\u4eec\u5c31\u9700\u8981\u60f3\u7b97\u7684\u95ee\u9898\u3002\n\u7b2c\u4e00\u4e2a\u6c42\u6700\u5927\u503c\u5f88\u597d\u7406\u89e3\uff0c\u6211\u4eec\u53ea\u9700\u8981\u679a\u4e3e\u4e2d\u95f4\u70b9\uff0c\u5728\u679a\u4e3e\u5b83\u5ef6\u4f38\u51fa\u53bb\u7684\u70b9\uff0c\u7136\u540e\u627e\u4e00\u4e2a\u6700\u5927\u503c\u548c\u6b21\u5927\u503c\u5c31\u53ef\u4ee5\u4e86\u3002\n\u4f8b\u5982\u4e0a\u56fe\u4e2d\u7684\u6700\u5927\u503c\u5c31\u662f c*d=12;\n\n\u7b2c\u4e8c\u4e2a\u95ee\u9898\u9700\u8981\u7528\u5230\u4e58\u6cd5\u7684\u4e00\u4e9b\u5b9a\u5219\u3002\n\u4e3e\u4e2a\u4f8b\u5b50\uff1a\n\u4e0a\u56fe\u7684\u548c\u4e3a$$a*b+a*c+a*d+b*a+b*c+b*d+c*a+c*b+c*d+d*a+d*c+d*b$$\n\u7ecf\u8fc7\u6574\u7406\u53ef\u4ee5\u53d8\u6210\uff1a\n$$(a*b+a*c+a*d+b*c+b*d+c*d)*2$$\n\u518d\u7ecf\u8fc7\u6574\u7406\u53ef\u4ee5\u53d8\u6210\uff1a\n$$(a*(b+c+d)+b*(c+d)+c*d)*2$$\n\u6240\u4ee5\u6211\u4eec\u53d1\u73b0\u6c42\u548c\u53ea\u9700\u8981\u7528\u4e00\u4e2asum\u8bb0\u5f55\u524d\u51e0\u4e2a\u6570\u6c42\u5f97\u7684\u548c\uff0c\u7136\u540e\u4e0d\u505c\u7684\u7528\u540e\u9762\u7684\u6570\u7d2f\u4e58\u5373\u53ef\uff0c\u5177\u4f53\u7684\u8bc1\u660e\u53ef\u4ee5\u7528\u4e58\u6cd5\u5206\u914d\u5f8b\u5c55\u5f00\u6c42\u5f97\u3002\n\n\u4e0d\u8fc7\u6c42\u5f97\u540e\u6700\u540e\u7684\u4e582\u4e0d\u80fd\u5fd8\u6389\uff0c\u8fd9\u4e5f\u662f\u4e00\u4e2a\u5751\u70b9\u3002\n\n\u90a3\u4e48\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define P 10007\nstruct node{\n    int next,y;\n}e[1000001];\nint v[1000001];\nint n;\nint linkk[10000001];\nint len;\nvoid insert(int xx,int yy){\n    e[++len].next=linkk[xx];\n    linkk[xx]=len;\n    e[len].y=yy;\n}\nint main(){\n    scanf(\"%d\",&n);\n    for (int i=1,x,y;i<n;i++) scanf(\"%d %d\",&x,&y),insert(x,y),insert(y,x);\n    int ans=0,maxx=0;\n    for (int i=1;i<=n;i++) scanf(\"%d\",&v[i]);\n    for (int i=1;i<=n;i++){\n    \tint max1=0,max2=0,sum=0;\n\t    int t=linkk[i];\n\t    for (int j=t;j;j=e[j].next){\n\t\t    if (v[e[j].y]>max1) max2=max1,max1=v[e[j].y];\n\t\t    else max2=max(max2,v[e[j].y]);\n\t\t    ans=(ans+sum*v[e[j].y])%P;\n\t\t    sum=(sum+v[e[j].y])%P;\n\t\t}\n\t\tmaxx=max(maxx,max1*max2);\n\t}\n\tprintf(\"%d %d\",maxx,(ans*2)%P);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1548677090,
        "uid": 34301,
        "name": "\u9e6d\u5929",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u9996\u5148\u9898\u76ee\u7ed9\u5b9a\u7684\u662f\u4e00\u9897\u65e0\u6839\u6811\u3002\n\n\u7531\u4e8e\u9898\u76ee\u8981\u6c42\u7684\u662f\u8ddd\u79bb\u4e3a$2$\u7684\u6240\u6709\u70b9\u5bf9\u7684\u6743\u503c\u79ef\u7684\u548c\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u89c6\u4f5c\u662f**\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u4e0e\u4e4b\u76f8\u90bb\u7684\u6240\u6709\u70b9\u4e24\u4e24\u76f8\u4e58\u7684\u548c**\u3002\n\n\u4e3a\u4ec0\u4e48\u5462\uff1f\u8bbe\u76f8\u90bb\u70b9\u4e3a$v_1,v_2$\uff0c\u8fd9\u4e2a\u70b9\u4e3a$u$\uff0c\u5219\u5bf9\u4e8e\u6240\u6709\u7684\u76f8\u90bb\u70b9\uff0c\u4e00\u5b9a\u6709$$\\begin{matrix}dis(v_1,v_2)&=&dis(v_1,u)+dis(u,v_2)\\\\&=&1+1\\\\&=&2\\end{matrix}$$\n\n### \u7b97\u6cd51\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u679a\u4e3e\u76f8\u90bb\u7684\u70b9\uff0c\u7136\u540e\u66f4\u65b0\u6700\u5927\u503c\u548c\u603b\u548c\u3002\u8bb0\u6bcf\u4e2a\u70b9\u5ea6\u6570\u4e3a$d_i$\uff0c\u5219\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(\\displaystyle\\sum_{i}^{i\\in V}d_i^2)$\u3002\n\n### \u7b97\u6cd52\n\u663e\u7136\uff0c\u6709\u540c\u5b66\u5df2\u7ecf\u770b\u51fa\u6765\u4e86\u2014\u2014\u83ca\u82b1\u56fe\u600e\u4e48\u529e\uff1f\u590d\u6742\u5ea6\u76f4\u63a5\u5c31\u662f$O(n^2)$\u4e86\u2026\u2026\n\n\u6700\u5927\u79ef\u6bd4\u8f83\u7b80\u5355\uff0c\u6bcf\u4e2a\u70b9\u53ea\u8981\u7ebf\u6027\u679a\u4e3e\u76f8\u90bb\u70b9\u5373\u53ef\uff0c\u590d\u6742\u5ea6\u662f$O(n)$\u7684\uff08\u4e0e\u8fb9\u6570\u540c\u7ea7\u522b\uff09\uff0c\u90a3\u4e48\u603b\u548c\u6709\u7c7b\u4f3c\u7684\u65b9\u6cd5\u5417\uff1f\n\n\u7b54\u6848\u662f\u80af\u5b9a\u7684\u3002\u6211\u4eec\u77e5\u9053\uff1a\n$$\\begin{matrix}\\displaystyle\\sum_{i\\in V}^{(u,i)\\in E}\\displaystyle\\sum_{j\\in V|j\\neq i}^{(u,j)\\in E}w_i\\cdot w_j&=&\\displaystyle\\sum_{i\\in V}^{(u,i)\\in E}\\displaystyle\\sum_{j\\in V}^{(u,j)\\in E}w_i\\cdot w_j-\\displaystyle\\sum_{i\\in V}w_i^2\\\\&=&(\\displaystyle\\sum_{i\\in V}w_i)^2-\\displaystyle\\sum_{i\\in V}w_i^2\\end{matrix}$$\n\n\u8fd9\u73a9\u610f\u4e2d$\\sum w_i$\u548c$\\sum w_i^2$\u90fd\u53ef\u4ee5\u7ebf\u6027\u6c42\u51fa\uff0c\u56e0\u6b64\u6211\u4eec\u4e0d\u9700\u8981\u4e24\u4e24\u679a\u4e3e\u3002\u6700\u7ec8\u590d\u6742\u5ea6\u5c31\u964d\u5230$O(n)$\u4e86\u3002",
        "postTime": 1540182175,
        "uid": 23398,
        "name": "frankchenfu",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u6ca1\u7528longlongint\u7206\u4e8670\u5206\u66b4\u529b\u5206\n\u6211\u4eec\u5bf9\u6bcf\u4e2a\u70b9\u904d\u5386\u4e00\u4e0b\u524d\u5411\u661f\uff0c\u6c42\u51fa\u76f4\u63a5\u4e0e\u5b83\u76f8\u8fde\u7684\u70b9\u7684\u6743\u503c\u548csum[i]\uff1b\n\n\u7136\u540e\u6c42\u51fa\u4e0e\u5b83\u76f4\u63a5\u76f8\u8fde\u7684\u70b9\u7684\u6700\u5927\u6743\u503cmx[i]\uff0c\u4ee5\u53ca\u8fd9\u4e2a\u6700\u5927\u6743\u503c\u6240\u5c5e\u70b9\u7684\u7f16\u53f7id[i],\u8fd8\u6709\u662f\u5426\u53ea\u6709\u4e00\u4e2a\u6700\u5927\u6743\u503cjud[i]\uff1b\n\n\u7136\u540e\u6211\u4eec\u6c42\u5b8c\u4e4b\u540e\uff0c\u518d\u904d\u5386\u4e00\u904d\uff0c\u76f4\u63a5\u7528\u5b83\u7684\u6743\u503c$*$\u4e0e\u5b83\u76f4\u63a5\u76f8\u8fde\u7684\u70b9\u7684val[i]*(sum[to[k]]-val[i]);\n\n\u7136\u540e\u6700\u5927\u6743\u503c\u5c31\u770b\u76f4\u63a5\u76f8\u8fde\u7684\u70b9id[to[k]\u662f\u4e0d\u662f\u5f53\u524d\u70b9i\u6216\u8005\u6709\u5176\u4ed6\u70b9jud[to[k]==1\uff0c\u8fd9\u6837\u624d\u80fd\u53d6max\uff0c\u56e0\u4e3a\u4ed6\u4e0d\u80fd\u548c\u672c\u8eab\u6c42;\n\n\u7136\u540e\u8bb0\u5f97\u5f00longlong\n\n\u4ee3\u7801\n\n```cpp\n//By AcerMo\n#include<cmath>\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#define lli long long int\nusing namespace std;\nconst int M=2005000;\nconst int mod=10007;\nlli n,ans,sum,c[M];\nlli s[M],mx[M],id[M],jud[M];\nint to[M],nxt[M],head[M],cnt;\ninline int read()\n{\n\tint x=0;char ch=getchar();\n\twhile (ch>'9'||ch<'0') ch=getchar();\n\twhile (ch>='0'&&ch<='9') x=x*10+ch-'0',ch=getchar();\n\treturn x;\n}\ninline void add(int x,int y)\n{\n\tto[++cnt]=y;nxt[cnt]=head[x];head[x]=cnt;\n\tto[++cnt]=x;nxt[cnt]=head[y];head[y]=cnt;\n\treturn ;\n}\nsigned main()\n{\n\tn=read();int x,y;\n\tfor (int i=1;i<n;i++)\n\tx=read(),y=read(),add(x,y);\n\tfor (int i=1;i<=n;i++) c[i]=read();\n\tfor (int i=1;i<=n;i++)\n\tfor (int k=head[i];k;k=nxt[k])\n\t{\n\t\ts[i]+=c[to[k]];\n\t\tif (mx[i]<c[to[k]]) id[i]=to[k],mx[i]=c[to[k]],jud[i]=0;\n\t\telse if (mx[i]==c[to[k]]) jud[i]=1;\n\t}\n\tfor (int i=1;i<=n;i++)\n\tfor (int k=head[i];k;k=nxt[k])\n\t{\n\t\tsum=(sum+c[i]*(s[to[k]]-c[i]))%mod;\n\t\tif (id[to[k]]!=i||jud[to[k]]) ans=max(ans,c[i]*mx[to[k]]);\n\t}\n\tcout<<ans<<\" \"<<sum<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1537838369,
        "uid": 71558,
        "name": "AcerMo",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u5728\u5f88\u4e45\u524d\u770b\u6807\u7b7e\u662f$lca$\u53ef\u662f\u5e76\u6ca1\u6709\u60f3\u51fa\u6765\uff0c\u73b0\u5728\u7528\u6811\u89c4\u53d1\u73b0\u5f88\u7b80\u5355\u3002$$qwq$$  \n## \u9898\u76ee\u5927\u610f  \n\u6811\u4e0a\u6240\u6709\u8ddd\u79bb\u4e3a$2$\u7684\u6709\u5e8f\u70b9\u5bf9\u7684\u6743\u503c\u7684\u4e58\u79ef\u7684\u6700\u5927\u503c\u4ee5\u53ca\u4e58\u79ef\u4e4b\u548c\u3002  \n## \u9898\u76ee\u601d\u8def  \n\u6811\u4e0a\u8ddd\u79bb\u4e3a$2$\u7684\u70b9\u8981\u4e48\u4e3a\u540c\u4e00\u4e2a\u7236\u4eb2\u7684\u513f\u5b50\uff0c\u8981\u4e48\u662f\u7237\u7237\u548c\u5b59\u5b50\u7684\u5173\u7cfb\uff0c\u7528\u6811\u5f62$dp$\u3002  \n\u8bbe$w[x]$\u662f\u8282\u70b9$x$\u7684\u6743\u503c\uff0c$y$\u662f$x$\u5f53\u524d\u8981\u8bbf\u95ee\u7684\u513f\u5b50\uff0c$fa$\u662f$x$\u7684\u7236\u4eb2\u8282\u70b9\uff0c$s[x]$\u662f$x$\u5df2\u7ecf\u5904\u7406\u8fc7\u7684\u6240\u6709\u513f\u5b50\u8282\u70b9\u7684\u6743\u503c\u548c\uff0c$fir[x]$\u3001$sec[x]$\u5206\u522b\u662f$x$\u7684\u513f\u5b50\u8282\u70b9\u4e2d\u6700\u5927\u3001\u6b21\u5927\u7684\u6743\u503c\uff0c$ans$\u4e3a\u603b\u6743\u503c\u548c\uff0c$maxn$\u4e3a\u6743\u503c\u7684\u4e58\u79ef\u7684\u6700\u5927\u503c\u3002  \n\u5bb9\u6613\u5f97\u51fa$fir[x]$\u548c$sec[x]$\u7684\u6c42\u6cd5\uff1a\u5982\u679c$y$\u7684\u6743\u503c\u6bd4\u6700\u5927\u7684\u8fd8\u5927\uff0c\u90a3\u4e48\u6700\u5927\u53d8\u6210\u6b21\u5927\uff0c\u6700\u5927\u53d8\u6210$y$\u7684\u6743\u503c\uff0c\u5373$sec[x]=fir[x],fir[x]=w[y]$\uff1b\u5426\u5219\u5982\u679c$y$\u7684\u6743\u503c\u6bd4\u6b21\u5927\u7684\u5927\uff0c\u90a3\u4e48\u6b21\u5927\u7684\u53d8\u6210$y$\u7684\u6743\u503c\uff0c\u5373$sec[x]=w[y]$  \n\u5176\u6b21\u662f$s[x]$\u7684\u6c42\u6cd5\uff0c\u4e5f\u5f88\u7b80\u5355\uff1a\u53ea\u8981\u6bcf\u6b21\u8bbf\u95ee\u4e00\u4e2a\u513f\u5b50\u8282\u70b9\u7d2f\u52a0\u5c31\u884c\u4e86\uff0c\u5373$s[x]+=w[y]$  \n\u6700\u91cd\u8981\u7684\u5c31\u662f$maxn$\u548c$ans$\u7684\u6c42\u6cd5\u4e86\uff0c\u5176\u5b9e\u4e5f\u4e0d\u662f\u5f88\u96be\uff0c\u6839\u636e\u5b9a\u4e49\u6765\u5c31\u884c\u4e86\uff1a  \n$maxn$\u662f\u6240\u6709\u5408\u6cd5\u4e58\u79ef\u7684\u6700\u5927\u503c\uff0c\u82e5\u4ee5$x$\u4e3a\u4e2d\u95f4\u8282\u70b9\uff0c\u90a3\u4e48\u6240\u6709\u5408\u6cd5\u8282\u70b9\u6709\uff1a$x$\u7684\u6240\u6709\u513f\u5b50\u8282\u70b9\u4ee5\u53ca$x$\u7684\u7236\u4eb2\u8282\u70b9\uff0c\u90a3\u4e48\u6240\u6709\u5408\u6cd5\u4e58\u79ef\u5c31\u6709\uff1a$x$\u7684\u6240\u6709\u513f\u5b50\u8282\u70b9\u7684\u4e24\u4e24\u4e58\u79ef\u4ee5\u53ca$x$\u7684\u7236\u4eb2\u8282\u70b9\u4e0e\u6bcf\u4e00\u4e2a\u513f\u5b50\u8282\u70b9\u7684\u4e58\u79ef\u7684\u6700\u5927\u503c\uff0c\u90a3\u4e48\u5b9e\u9645\u6709\u6548\u7684\u5176\u5b9e\u5c31\u662f\u513f\u5b50\u8282\u70b9\u4e2d\u7684\u6700\u5927\u6743\u503c\u548c\u6b21\u5927\u6743\u503c\u4ee5\u53ca\u7236\u4eb2\u8282\u70b9\u7684\u6743\u503c\uff0c\u6700\u5927\u7684\u4e58\u79ef\u5c31\u662f$max(fir[x]*max(sec[x],w[fa]))$\uff08\u8fd9\u91cc\u81ea\u5df1\u597d\u597d\u60f3\u4e00\u60f3\uff0c\u5982\u679c\u80fd\u81ea\u5df1\u63a8\u4e00\u63a8\u4e3a\u4ec0\u4e48\u662f\u8fd9\u4e2a\u5f0f\u5b50\u81ea\u7136\u662f\u66f4\u597d~~\uff08\u5176\u5b9e\u662f\u6211\u6709\u70b9\u6df7\u4e71\uff09~~\uff09  \n$ans$\u662f\u6240\u6709\u5408\u6cd5\u4e58\u79ef\u4e4b\u548c\uff0c\u5373$$\\begin{aligned}ans&=\\sum_{x=1}^{n}(\\sum_{y_1,y_2\\in Son[x]\\atop y_1\\neq y_2}w[y_1]\\times w[y_2]+2\\times\\sum_{y\\in Son[x]}w[y]\\times w[fa])\\\\\\ &=\\sum_{x=1}^{n}(2\\times\\sum_{y_1,y_2\\in Son[x]\\atop y_1<y_2}w[y_1]\\times w[y_2]+2\\times\\sum_{y\\in Son[x]}w[y]\\times w[fa])\\\\\\ &=2\\times\\sum_{x=1}^{n}\\sum_{y\\in Son[x]}w[y]\\times (s[x]+w[fa])\\\\\\ or&=2\\times\\sum_{x=1}^{n}(\\sum_{y\\in Son[x]}w[y]\\times s[x]+w[fa]\\times s[x])\\end{aligned}$$  \n\u6ce8\u610f\u8fd9\u91cc\u7684$s[x]$\u7684\u5b9a\u4e49\uff01\uff01\uff01  \n\u6ce8\u610f\u8fd9\u91cc\u7684$s[x]$\u7684\u5b9a\u4e49\uff01\uff01\uff01  \n\u6ce8\u610f\u8fd9\u91cc\u7684$s[x]$\u7684\u5b9a\u4e49\uff01\uff01\uff01  \n\u7136\u540e\u5957\u6811\u89c4\u7684\u6a21\u677f\u5c31\u53ef\u4ee5\u4e86\uff0c\u6ce8\u610f$maxn$\u4e0d\u8981\u53d6\u6a21\uff0c$ans$\u8bb0\u5f97$\\times2$\uff08\u56e0\u4e3a\u662f\u6709\u5e8f\u70b9\u5bf9\uff09\u5c31\u884c\u4e86  \n\u4e0b\u9762\u4e0a\u4ee3\u7801\uff08$1A$\uff0c\u6ce8\u91ca\u6211\u5c31\u61d2\u5f97\u5199\u4e86\uff0c\u8fd8\u4e0d\u61c2\u7684\u53ef\u4ee5\u79c1\u804a\uff09\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=200010,M=1000010;\nconst int p=10007;\n\nint mo(ll x)\n{\n\treturn (x%p+p)%p;\n}\n\nint head[N],ver[M],nxt[M],w[N];\nint n,m,tot=1;\n\nvoid add(int x,int y)\n{\n\tver[++tot]=y,nxt[tot]=head[x],head[x]=tot;\n}\n\nint fir[N],sec[N];\nint s[N];\nint ans=0;\nll maxn=0;\n\nvoid dp(int x,int fa)\n{\n\ts[x]=fir[x]=sec[x]=0;\n\tfor(int i=head[x];i;i=nxt[i])\n\t{\n\t\tint y=ver[i];\n\t\tif(y==fa) continue;\n\t\tdp(y,x);\n\t\tans=mo(ans+s[x]*w[y]);\n\t\ts[x]=mo(s[x]+w[y]);\n\t\tif(w[y]>fir[x]) sec[x]=fir[x],fir[x]=w[y];\n\t\telse if(w[y]>sec[x]) sec[x]=w[y];\n\t}\n\tmaxn=max(maxn,(ll)fir[x]*max(sec[x],w[fa]));\n\tans=mo(ans+w[fa]*s[x]);\n}\n\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint a,b;\n\t\tscanf(\"%d%d\",&a,&b);\n\t\tadd(a,b);\n\t\tadd(b,a);\n\t}\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&w[i]);\n\tdp(1,0);\n\tprintf(\"%lld %d\\n\",maxn,mo(ans+ans));\n\treturn 0;\n}\n```",
        "postTime": 1534756519,
        "uid": 54728,
        "name": "wangxuye",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u6709\u4e00\u4e2a\u9690\u85cf\u6761\u4ef6\uff0c\u76f8\u4fe1\u5927\u5bb6\u90fd\u5df2\u7ecf\u53d1\u73b0\u4e86\uff0c\u8fd9\u662f\u4e00\u4e2a\u65e0\u5411\u8fde\u901a\u56fe\uff0cn\u4e2a\u70b9\uff0cn-1\u6761\u8fb9\uff0c\u6240\u4ee5\u8fd9\u662f\u4e00\u4e2a\u6811\u56fe\u3002\n\n\u4e4b\u540e\u5c31\u5f88\u5bb9\u6613\u60f3\u5230\u904d\u5386\uff0c\u6c42\u51fa\u8ddd\u79bb\u4e3a2\u7684\u70b9\u5bf9\uff0c\u7136\u540e\u3002\u3002\u3002\n\n\n\u597d\u5427\uff0c\u4e00\u770b\u5c31\u77e5\u9053TLE\u5728\u51b2\u4f60\u62db\u624b\uff0c\u6240\u4ee5\u6211\u4eec\u5f00\u59cb\u60f3\u4f18\u5316\u3002\n\n\n\u4f18\u53161\uff1a\n\n\u5f53\u5927\u5bb6\u4ece\u53d1\u73b0\u8fd9\u662f\u4e2a\u6811\u56fe\u7684\u559c\u60a6\u4e2d\u6e05\u9192\u8fc7\u6765\u4e4b\u540e\uff0c\u5c31\u4f1a\u5229\u7528\u6811\u7684\u6027\u8d28\u6765\u4f18\u5316\u8fd9\u9053\u9898\u3002\u5bf9\u4e00\u4e2a\u8ddd\u79bb\u4e3a2\u7684\u70b9\u5bf9\uff0c\u5b83\u4eec\u80af\u5b9a\u662f\u5728\u540c\u4e00\u4e2a\u70b9\u7684\u90bb\u63a5\u8868\u4e2d\uff0c\u6240\u4ee5\u53ea\u8981\u7528vector\u6765\u5b58\u6811\uff0c\u7136\u540e\u904d\u5386\u6bcf\u4e2a\u90bb\u63a5\u8868\uff0c\u679a\u4e3e\u6bcf\u4e2a\u90bb\u5c45\u70b9\uff0c\u518d\u679a\u4e3e\u8fd9\u4e2a\u90bb\u63a5\u8868\u4e2d\u6bcf\u4e2a\u4e0d\u662f\u8fd9\u4e2a\u70b9\u7684\u70b9\uff0c\u76f8\u4e58\u7d2f\u8ba1\u6c42\u548c\uff0cOK\uff01\n\n\u6700\u5927\u6743\u503c\u53ea\u9700\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6253\u64c2\u5c31\u53ef\u4ee5\u5566\uff01\n\n\n\u4ee3\u7801\u4e0a\uff1a\n\n\n\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nint N;\nint a,b;\nint num[200010];\nvector<int> t[200010];\nlong long sum[200010];\nlong long ans;\nlong long maxn;\nint main()\n{\n    scanf(\"%d\",&N);\n    for(int i=1;i<N;i++)//\u90bb\u63a5\u8868\u5b58\u50a8\u6811\n    {\n        scanf(\"%d%d\",&a,&b);\n        t[a].push_back(b);\n        t[b].push_back(a);\n    }\n    for(int i=1;i<=N;i++)//\u8bfb\u5165\u70b9\u6743\uff0c\u4e0d\u89e3\u91ca\n    {\n        scanf(\"%d\",&num[i]);\n    }\n    ans=0;\n    maxn=-1;\n    for(int i=1;i<=N;i++)//\u8bbf\u95ee\u6bcf\u4e2a\u9886\u63a5\u8868\n    {\n        long long max1=-1,max2=-1;\n        for(vector<int>::iterator it=t[i].begin();it!=t[i].end();it++)//\u8bbf\u95ee\u9886\u63a5\u8868\u4e2d\u7684\u6bcf\u4e2a\u70b9\n        {\n            for(vector<int>::iterator it2=t[i].begin();it2!=t[i].end();it2++)//\u679a\u4e3e\u90bb\u63a5\u8868\u4e2d\u7684\u53e6\u4e00\u4e2a\u70b9\n            {\n                if(it!=it2)\n                {\n                    ans=(ans+num[*it]*num[*it2])%10007;//\u52a0\u548c\n                }\n            }\n            if(num[*it]>max1)//\u627e\u51fa\u9886\u63a5\u8868\u4e2d\u6700\u5927\u7684\u4e24\u4e2a\u70b9\uff0c\u4f5c\u4e3a\u6700\u5927\u6743\u503c\u7684\u9884\u9009\n            {\n                max2=max1;\n                max1=num[*it];\n            }\n            else if(num[*it]>max2)\n            {\n                max2=num[*it];\n            }\n        }\n        if(max1*max2>maxn)//\u6700\u5927\u6743\u503c\u7684\u6253\u64c2\n        {\n            maxn=max1*max2;\n        }\n    }\n    printf(\"%lld %lld\",maxn,ans);\n    return 0;\n}\n```\n\u8fd9\u4e2a\u65b9\u6cd5\u7684\u6548\u7387\u662fO(VE)\u7684\uff0c\u6240\u4ee5\u662f\u4e2a60\u5206\u65b9\u6cd5\u3002\n\n\u6211\u4eec\u7ee7\u7eed\u4f18\u5316\u3002\n\n\u4f18\u53162\uff1a\n\n\u7ee7\u627f\u4f18\u53161\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u9886\u63a5\u8868t[i]\uff0c\u4e2d\u7684\u67d0\u70b9t[i][x]\uff0c\u5b83\u5bf9\u4e8eans\u7684\u8d21\u732e\u4e3at[i][x]\\*t[i][1]+t[i][x]\\*t[i][2]+t[i][x]\\*t[i][3]+......+t[i][x]\\*t[i][t[i].size()]-t[i][x]\\*t[i][x]\uff0c\u52a0\u6cd5\u7684\u7ed3\u5408\u7387\u544a\u8bc9\u6211\u4eec\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u6574\u7406\u4e3at[i][x]\\*sum(t[i][y] )  (y\u5c5e\u4e8e1~t[i].size()\uff0c\u4f46y\u4e0d\u7b49\u4e8ex\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u90bb\u63a5\u8868\u7684sum\u7684\u503c\uff0c\u7136\u540et[i][x]\u5bf9ans\u7684\u8d21\u732e\u7684\u516c\u5f0f\u5c31\u53d8\u4e3at[i][x]\\*(sum[i]-t[i][x])\uff0c\u4e4b\u540e\u53ea\u8981\u8bbf\u95ee\u6bcf\u4e2a\u9886\u63a5\u8868\uff0c\u679a\u4e3e\u90bb\u63a5\u8868\u4e2d\u7684\u6bcf\u4e2a\u70b9\u5c31\u597d\u4e86\u3002\n\n\u6700\u5927\u6743\u503c\u53ea\u9700\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6253\u64c2\u5c31\u53ef\u4ee5\u5566\uff01\n\n\n\u8fd9\u4e2a\u65b9\u6cd5\u662fO(n)\u7684\u6548\u7387\uff0cAC\u3002\n\nAC\u4ee3\u7801\u4e0a\uff1a\n\n\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nint N;\nint a,b;\nint num[200010];\nvector<int> t[200010];\nlong long ans;\nlong long sum[200010];\nint main()\n{\n    scanf(\"%d\",&N);\n    for(int i=1;i<N;i++)//\u90bb\u63a5\u8868\u5b58\u50a8\u6811\n    {\n        scanf(\"%d%d\",&a,&b);\n        t[a].push_back(b);\n        t[b].push_back(a);\n    }\n    for(int i=1;i<=N;i++)//\u8bfb\u5165\u70b9\u6743\uff0c\u4e0d\u89e3\u91ca\n    {\n        scanf(\"%d\",&num[i]);\n    }\n    ans=0;\n    long long maxn=-1;\n    for(int i=1;i<=N;i++)//\u8bbf\u95ee\u6bcf\u4e2a\u9886\u63a5\u8868\n    {\n        long long max1=-1,max2=-1;\n        for(vector<int>::iterator it=t[i].begin();it!=t[i].end();it++)\n        {\n            sum[i]+=num[*it];//\u6c42\u8868\u4e2d\u70b9\u7684\u6743\u503c\u548c\n            if(num[*it]>max1)//\u627e\u51fa\u9886\u63a5\u8868\u4e2d\u6700\u5927\u7684\u4e24\u4e2a\u70b9\uff0c\u4f5c\u4e3a\u6700\u5927\u6743\u503c\u7684\u9884\u9009\n            {\n                max2=max1;\n                max1=num[*it];\n            }\n            else if(num[*it]>max2)\n            {\n                max2=num[*it];\n            }\n        }\n        if(max1*max2>maxn)//\u6700\u5927\u6743\u503c\u7684\u6253\u64c2\n        {\n            maxn=max1*max2;\n        }\n    }\n    for(int i=1;i<=N;i++)//\u8bbf\u95ee\u6bcf\u4e2a\u90bb\u63a5\u8868\n    {\n        for(vector<int>::iterator it=t[i].begin();it!=t[i].end();it++)//\u679a\u4e3e\u8868\u4e2d\u7684\u6bcf\u4e2a\u70b9\n        {\n            ans=(ans+num[*it]*(sum[i]-num[*it]))%10007;//\u516c\u5f0f\u4ee3\u5165\uff0c\u6c42\u548c\n        }\n    }\n    printf(\"%lld %lld\",maxn,ans);\n    return 0;\n}\n\n```",
        "postTime": 1507189750,
        "uid": 47180,
        "name": "\u559d\u62b9\u8336\u7684\u5e03\u4e01",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u5de7\u5999\u7684\u6a21\u62df+\u8d2a\u5fc3\n\n\u914d\u5408\u516c\u5f0f ab+ba+ac+ca+bc+cb=(a+b+c)(a+b+c)-a\\*a-b\\*b-c\\*c;\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\nconst int N=200000+20;\nconst int MOD=10007;\nint n,tot=0,maxn=0;\nstruct node{\n    int sum;(a+b+c)\n        int temp;a*a+b*b+c*c\n}po[N];\nstruct edge1{\n    int u,v;\n}edge[N];\nint value[N];\nint maxm[N][3];//\u8bb0\u5f55\u4e0ex\u70b9\u76f8\u90bb\u7684\u6700\u5927\u6743\u503c\u7684\u4e24\u4e2a\u70b9\uff0c\u6bcf\u6b21\u66f4\u65b0\u8c03\u6574\nvoid rule(int x)\n{\n    if(maxm[x][0]>maxm[x][2])\n    {\n        int t=maxm[x][0];\n        maxm[x][0]=maxm[x][2];\n        maxm[x][2]=t;\n    }\n    if(maxm[x][0]>maxm[x][1])\n    {\n        int t=maxm[x][1];\n        maxm[x][1]=maxm[x][0];\n        maxm[x][0]=t;\n    }\n    if(maxm[x][1]>maxm[x][2])\n    {\n        int t=maxm[x][1];\n        maxm[x][1]=maxm[x][2];\n        maxm[x][2]=t;\n    }\n}\nint main()\n{\n    scanf(\"%d\",&n);\n    for(int i=1;i<n;i++)\n    {\n        int u,v;\n        scanf(\"%d%d\",&u,&v);\n        edge[i].u=u;\n        edge[i].v=v;\n    }\n    for(int i=1;i<=n;i++)\n        scanf(\"%d\",&value[i]);\n    for(int i=1;i<n;i++)\n    {\n        int u=edge[i].u;\n        int v=edge[i].v;\n        po[u].sum=(po[u].sum+value[v])%MOD;//\u7b26\u5408\u6a21\u7684\u76f8\u5173\u6027\u8d28\n        po[u].temp=(po[u].temp+value[v]*value[v])%MOD;\n        po[v].sum=(po[v].sum+value[u])%MOD;\n        po[v].temp=(po[v].temp+value[u]*value[u])%MOD;\n        maxm[v][0]=value[u];\n        maxm[u][0]=value[v];\n        rule(u);\n        rule(v);//\u624b\u52a8\u8c03\u6574\n    }\n    for(int i=1;i<=n;i++)\n    {\n        //printf(\"%d %d %d\\n\",maxm[i][0],maxm[i][1],maxm[i][2]);\n        maxn=max(maxn,maxm[i][1]*maxm[i][2]);\n    }\n    for(int i=1;i<=n;i++)\n        tot=(tot+po[i].sum*po[i].sum-po[i].temp+2*MOD)%MOD;\n    printf(\"%d %d\\n\",maxn,tot);\n    return 0;\n}\n```",
        "postTime": 1477874741,
        "uid": 25110,
        "name": "wenake",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u8c03\u4e86\u4e00\u4e0b\u5348\uff0c\u8d3c\u6076\u5fc3  \n\u8fd9\u9053\u9898\u53ef\u4ee5\u8bf4\u662f\u5f88\u795e\u5947\u4e86\uff0c\u6211\u7167\u7740\u7535\u97f3\u4ed3\u9f20\u7684\u601d\u8def\u7f16\uff0c\u7ed3\u679cT\u4e864\u4e2a\u70b9  \n\u6211\uff1a  \n##### \uff1f\uff1f\uff1f  \n\n\n------------\n\u8fd9\u6761\u7ebf\u4ee5\u4e0a\u5168\u662f\u5e9f\u8bdd\n\n\n------------\n\u9996\u5148\uff0c\u770b\u4e0d\u51fa\u8fd9\u662f\u4e00\u68f5\u6811\u7684\u540c\u5b66\u8bf7\u79bb\u5f00\u53bb\u8865\u4e60\u56fe\u8bba\u6982\u5ff5  \n\u4e00\u68f5\u6811\uff0c\u6700\u5927\u7684\u7279\u70b9\u5c31\u662f\u6ca1\u6709\u73af\uff08\u8fd9\u4e0d\u662f\u5e9f\u8bdd\u5417\uff09  \n\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5~~\u4e3a\u6240\u6b32\u4e3a\u5730~~\u679a\u4e3e\u6bcf\u4e00\u4e2a\u4e24\u4e2a\u70b9\u4e4b\u95f4\u7684\u4e2d\u8f6c\u70b9  \n\u53ea\u8981\u4e00\u4e2adfs\u641e\u5b9a  \n\u5728\u9047\u5230\u6bcf\u4e2a\u4e2d\u8f6c\u70b9\u4e4b\u540e\uff0c\u4e24\u4e24\u7edf\u8ba1\u5468\u56f4\u4e00\u5708\u7684\u6743\u503c\uff08\u6ce8\u610f\u53bb\u91cd\uff09\uff0c\u7136\u540e\u52a0\u5728\u4e00\u8d77  \nO(n^2)\u70b8\u4e86......  \n\u7b80\u5316\u4e00\u4e0b\uff0c\u6211\u4eec\u8981\u6c42\u7684\u662f\u6bcf\u4e24\u4e2a\u76f8\u90bb\u7684\u5b50\u8282\u70b9\u7684\u4e58\u79ef\u7684\u4e8c\u500d  \n\u7136\u540e\u7528\u591a\u9879\u5f0f\u4e58\u6cd5\u4f18\u5316  \n(\u4e00\u5806\u6570)^2==\u6bcf\u4e2a\u6570^2\u7684\u548c+\u4e24\u4e24\u4e58\u79ef\u7684\u4e8c\u500d  ~~\u60f3\u51fa\u8fd9\u4e2a\u7684\u4e00\u5b9a\u662fdalao~~  \n\u8fd9\u4e9b\u6743\u503c\u548c\u548c\u5e73\u65b9\u548c\u662f\u53ef\u4ee5O(n)\u7edf\u8ba1\u51fa\u6765\u7684  \n\u6700\u540e\u518d\u52a0\u4e0a\u8fd9\u4e2a\u6570\u548c\u5b83\u7237\u7237\u7684\u4e58\u79ef\u7684\u4e8c\u500d  \n\u6700\u5927\u8054\u5408\u6743\u503c\u663e\u7136\u662f\u7531\u6bcf\u4e00\u4e2a\u4e2d\u8f6c\u70b9\u7684\u5468\u56f4\u4e24\u4e2a\u6700\u5927\u7684\u6570\u4e58\u79ef\u5f97\u6765\u7684  \n\u987a\u4fbf\u7edf\u8ba1\u4e00\u4e0b\u5c31\u597d\u5566  \n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,val[200005],mans=-99999999,ans=0,tmp,tt,tmp1,tmp2;\nvector<int> v[200005];\nconst int mod=10007;\nvoid build(int now,int pa,int gp)\n{\n\ttmp1=0;\n\ttmp2=0;\n\ttmp=0;\n\ttt=0;\n\tfor(int i=0;i<v[now].size();i++)\n\t\tif(v[now][i]!=pa)\n\t\t{\n\t\t\tif(val[v[now][i]]>=tmp1)\n\t\t\t{\n\t\t\t\ttmp2=tmp1;\n\t\t\t\ttmp1=val[v[now][i]];\n\t\t\t}\n\t\t\telse if(val[v[now][i]]>tmp2)\n\t\t\t\ttmp2=val[v[now][i]];\n\t\t\ttmp=(tmp+val[v[now][i]])%mod;\n\t\t\ttt=(tt+val[v[now][i]]*val[v[now][i]])%mod;\n\t\t}\n\ttmp=(tmp*tmp)%mod;\n\tmans=max(mans,max(val[now]*val[gp],tmp1*tmp2));\n\tans=(ans+tmp-tt+mod)%mod;\n\tans=(ans+2*val[now]*val[gp])%mod;\n\tfor(int i=0;i<v[now].size();i++)\n\t\tif(v[now][i]!=pa)\n\t\t\tbuild(v[now][i],now,pa);\n\treturn;\n}\nint main()\n{\n\tcin>>n;\n\tint a,b;\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tcin>>a>>b;\n\t\tv[a].push_back(b);\n\t\tv[b].push_back(a);\n\t}\n\tfor(int i=1;i<=n;i++)\n\t\tcin>>val[i];\n\tval[0]=0;\n\tbuild(1,0,0);\n\tcout<<mans<<' '<<ans<<endl;\n\treturn 0;\n}\n```\n",
        "postTime": 1572786910,
        "uid": 182525,
        "name": "yangyujia18",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u4e00\u9053**2014\u5e74**\u7684~~\u6c34\u9898~~\n\n\u849f\u84bb\u7684\u7b2c\u4e00\u53cd\u5e94\u662f **-->\u6700\u77ed\u8def\u5f84-->floyd**\n\n\u4f46\u662f\uff01\uff01\uff01\n\n![](https://i.loli.net/2019/11/03/C5AS9haGPberd8o.png)\n\n**n\u2264200000\uff01\uff01\uff01**\n\nfloyd\uff0c\u4f60\u60f3\u591a\u4e86\u3002\n\n\u4e0d\u80fd\u7528\u6700\u77ed\u8def\u90a3\u600e\u4e48\u6c42\u4e24\u70b9\u8ddd\u79bb\u5462\uff1f\n\n\u8fd9\u662f\u6211\u7a81\u7136\u770b\u5230\u4e86~~\u9898\u89e3~~ \n\n```cpp\n\"\u5bf9\u4e8e\u56feG\u4e0a\u7684\u70b9\u5bf9(u,v)(u,v)\uff0c\u82e5\u5b83\u4eec\u7684\u8ddd\u79bb\u4e3a2\uff0c\u5219\u5b83\u4eec\u4e4b\u95f4\u4f1a\u4ea7\u751f\u8054\u5408\u6743\u503c\"\n```\n\n\u4e5f\u5c31\u662f\u53ea\u8ba1\u7b97\u8ddd\u79bb\u4e3a2\u7684\u5c31\u884c\u4e86\u3002\n\n\u8ddd\u79bb\u4e3a\u4e8c\u90a3\u5c31\u662f\u4e0d\u4ec5\u76f8\u8fde\uff0c\u800c\u4e14\u8ddd\u79bb\u4e0d\u662f1\u3002\n\n\u4f46\u5982\u679c\u4f60\u8bb0\u5f55\u4e86\u4ed6\u4eec\u76f8\u8fde\u4e0e\u4e0d\u8fde\u3002200000*200000\u662fhold\u4e0d\u4f4f\u7684\uff01\uff01\uff01\n\n\u4f46\u662f\u806a\u660e\u7684~~\u6211~~\u4f60\u4e00\u5b9a\u4f1a\u8ba4\u771f\u770b\u9898-->\n\n```cpp\n\"\u65e0\u5411\u8fde\u901a\u56feG\u6709,n\u4e2a\u70b9,n-1\u6761\u8fb9\u3002\"\n```\n\u8054\u901a\u7684n-1\u6761\u8fb9\uff0c\u4ee3\u8868-->**\u4ed6\u65e0\u73af**\n\n\u4e5f\u5c31\u662f\u53ea\u8981\u4ed6\u4eec\u6709\u4e00\u4e2a\u4e2d\u95f4\u4eba\uff0c\u8ddd\u79bb\u5c31\u4e00\u5b9a\u662f2.\n\n\u4e8e\u662f\u679a\u4e3e\u6240\u6709\u4e2d\u95f4\u4eba\u3002\n\n\u4f46\u662f\u6211\u4eec\u4e0d\u80fd\u66b4\u529b\u679a\u4e3e\n\n\u5229\u7528**\u524d\u7f00\u548c**\u601d\u60f3\u2026\u2026\n\n```cpp\nsum=(sum+w[i]*ans)%mod;\nans=(ans+w[i])%mod; \n```\n\n\u53ea\u662f\u6211\u4eec\u628a\u6bcf\u4e2a\u76f8\u8fde\u7684\u8fb9\u90fd\u52a0\u4e86\u8fdb\u6765\u3002\n\n\u4f46\u6ce8\u610f\u8981*2\uff01\uff01\uff01\n\n## \u6700\u540e\u6ce8\u610f\uff1a\uff1a \u9898\u76ee\u53ea\u8bf4\u5bf9\u548c\u53d6\u6a21\uff0c\u4e0d\u5bf9\u6700\u5927\u503c\u53d6\u6a21!!!\n\n```cpp\n#include<cstdio> \n#include<string>\nusing namespace std;\n\nconst int maxn=200005,mod=10007;\nint n;\nstruct edge{\n\tint v,next;\n}e[maxn*2];\nint head[maxn],cnt;\nint w[maxn];\nint maxx=-1;\nint sum;\nint ans; \n\nint read()\n{\n    int x=0,f=1;char c=getchar();\n    while(!isdigit(c)){if(c=='-')f=-1;c=getchar();}\n    while(isdigit(c)){x=x*10+c-'0';c=getchar();}\n    return x*f;\n}\n\nvoid add(int u,int v)\n{\n\te[++cnt].v=v;\n\te[cnt].next=head[u];\n\thead[u]=cnt;\n}\n\nvoid readdata()\n{\n\tn=read();\n\tfor(int i=1;i<n;++i)\n\t{\n\t\tint a,b;\n\t\ta=read(),b=read();\n\t\tadd(a,b);\n\t\tadd(b,a);\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tw[i]=read();\n\t}\n}\n\nvoid work()\n{\n\tfor(int u=1;u<=n;u++) //\u679a\u4e3e\u4e2d\u95f4\u70b9\n\t{\n\tint now=-1,vpp=-1;//\u8bb0\u5f55\u6700\u5927\u7684\u548c\u6b21\u5927\u7684\uff0c\u76f8\u4e58\u81ea\u7136\u5c31\u662f\u6700\u5927\u7684\u4e86\n\tans=0;\n\tfor(int i=head[u];i;i=e[i].next)  //\u548c\u4ed6\u76f8\u8fde\u7684\u8fb9\n\t{\n\t\tint z=e[i].v;\n\t\tif(w[z]>now) \n\t\t{\n\t\t\tvpp=now; //\u77ac\u79fb\u6b21\u5927\n\t\t\tnow=w[z];\n\t\t}\n\t\telse if(w[z]>vpp)vpp=w[z];\n\t\tsum=(sum+w[z]*ans)%mod;\n\t\tans=(ans+w[z])%mod;\n\t}\t\n\tmaxx=max(maxx,now*vpp);\n\t}\n}\n\nint main()\n{\n\treaddata();\n\twork();\n\tprintf(\"%d %d\",maxx,(sum*2)%mod);\n\treturn 0;\n}\n```\n\n\n",
        "postTime": 1572767719,
        "uid": 91720,
        "name": "Anonymous\u533f\u540d\u8005",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u5bf9\u4e8e\u8fd9\u4e00\u9898\uff0c\u521d\u770b\u96be\u70b9\u662f\u5982\u4f55\u627e\u5230\u201c\u8054\u7ed3\u5bf9\u201d\uff0c\u65e2\u4e24\u4e2a\u76f8\u8ddd\u4e3a2\u7684\u7ed3\u70b9\u3002\u4f46\u662f\u8f6c\u53d8\u601d\u8def\uff0c\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u7ed3\u70b9\uff0c\u5b83\u76f4\u63a5\u76f8\u8fde\u7684\u4e24\u4e2a\u7ed3\u70b9\u7684\u8ddd\u79bb\u4e00\u5b9a\u662f2\u3002\uff08\u56e0\u4e3a\u8fd9\u662f\u4e2a\u53ea\u6709n\u4e2a\u7ed3\u70b9\uff0cn-1\u6761\u8fb9\u7684\u8fde\u901a\u56fe\uff0c\u6240\u4ee5\u6bcf\u4e24\u4e2a\u7ed3\u70b9\u6709\u4e14\u4ec5\u6709\u4e00\u6761\u8def\u5f84\uff09\n\n\u6240\u4ee5\u6211\u4eec\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u7136\u540e\u5bf9\u4e8e\u8fd9\u4e2a\u70b9\uff0c\u679a\u4e3e\u6bcf\u4e00\u4e2a\u4e0e\u5b83\u76f4\u63a5\u76f8\u8fde\u7684\u70b9\uff0c\u6734\u7d20\u7b97\u6cd5\u662f\u4e8c\u91cd\u679a\u4e3e\u7b97\u51fa\u6240\u6709\u7684\u8054\u5408\u6743\u503c\u5e76\u6c42\u548c\uff0c\u8fd9\u6837\u6781\u7aef\u72b6\u6001\u4e0b\u7684\u7b97\u6cd5\u590d\u6742\u5ea6\u9ad8\u8fben^2\uff0c\u5fc5\u5b9aTLE\u3002\u6240\u4ee5\u6211\u4eec\u8f6c\u53d8\u601d\u8def\uff0c\u60f3\u529e\u6cd5\u6784\u9020\u51fa\u8054\u5408\u548c\u3002\n\n\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u8054\u60f3\u5230\u5b8c\u5168\u5e73\u65b9\u516c\u5f0f\u3002(a+b)^2 = a^2 + 2ab + b^2\u3002\u5f53\u7136\u4e24\u9879\u80af\u5b9a\u4e0d\u884c\uff0c\u4f46\u662f\u7a0d\u5fae\u63a8\u5e7f\u4e00\u4e0b\uff1a\n\t(a_1 + a_2 + ...... +a_n)^2 = a_1^2 + a_2^2 +......+ a_n^2 +\u8054\u5408\u6743\u503c\u548c\n    \n   \u663e\u7136\u8fd9\u4e2a\u7b97\u6cd5\u7684\u590d\u6742\u5ea6\u662fO(n),\u521a\u597d\u6ee1\u8db3\u9700\u8981\u3002\n   \n   \u4e8e\u662f\u5177\u4f53\u505a\u6cd5\u5c31\u662f\uff0c\u7528\u90bb\u63a5\u8868\u50a8\u5b58\u8fd9\u5f20\u56fe\uff0c\u7136\u540e\u904d\u5386\u6bcf\u4e00\u4e2a\u7ed3\u70b9\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u7ed3\u70b9\uff0c\u904d\u5386\u4e0e\u5176\u76f8\u8fde\u7684\u7ed3\u70b9\u3002\u5728\u904d\u5386\u4e0e\u5176\u76f8\u8fde\u7684\u7ed3\u70b9\u65f6\uff0c\u8bb0\u5f55\u6700\u5927\u548c\u6b21\u5927\u7684\u7ed3\u70b9\u6743\u503c\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u8054\u5408\u6743\u503c\u6700\u5927\uff0c\u7136\u540e\u7528\u4e00\u4e2asum\u8bb0\u5f55\u4e0e\u5176\u76f8\u8fde\u7684\u7ed3\u70b9\u7684\u6743\u503c\u548c\uff0c\u518d\u7528\u4e00\u4e2asum2\u8bb0\u5f55\u4e0e\u5176\u76f8\u8fde\u7684\u7ed3\u70b9\u7684\u6743\u503c\u7684\u5e73\u65b9\u548c\u3002\u904d\u5386\u5b8c\u540e\uff0c\u4ee4ans += sum*sum - sum2 \u5373\u53ef\u3002\u6ce8\u610f\u5fc5\u8981\u65f6\u53d6\u6a21\u3002\u6ce8\u610f\u7b2c\u4e00\u95ee\u4e0d\u5fc5\u53d6\u6a21\u3002\n   \u8fd9\u91cc\u9644\u4e0a\u4ee3\u7801\uff1a\n   ```cpp\n#include<iostream>\n#include<fstream>\nusing namespace std;\nconst int N = 200005,Mod = 10007;\n//\u6700\u5927\u6570\u636e\u8303\u56f4\uff0c\u819c\u503c \nint w[N],edge_to[2*N];\n//w\u8868\u793a\u7ed3\u70b9\u6743\u503c\uff0cedge_to[i]\u8868\u793a\u7b2ci\u6761\u8fb9\u7684\u7ec8\u70b9\nint head[N],next[2*N],num[N];\n//num[i]\u8868\u793a\u7b2ci\u4e2a\u7ed3\u70b9\u7684\u8fde\u8fb9\uff0c\u8fd9\u4e2a\u91cf\u4e0d\u5fc5\u987b\uff0c\u53ea\u662f\u8fde\u8fb9\u5c0f\u4e8e2\u7684\u7ed3\u70b9\u53ef\u4ee5\u8df3\u8fc7 \nint n,u,v,cnt;\n//cnt\uff1a\u603b\u8fb9\u6570 \nint ans,maxa;\n//\u8bb0\u5f55\u7b54\u6848\uff0c\u5206\u522b\u4e3a\u8054\u5408\u6743\u503c\u548c \u548c \u6700\u5927\u8054\u5408\u6743\u503c \n\nvoid add_edge(int u,int v){\n\tnext[++cnt] = head[u];\n\thead[u] = cnt;\n\tedge_to[cnt] = v;\n\tnum[u]++;\n}\n\nint main(){\n\tcin>>n;\n\tfor(int i = 1;i < n;i++){\n\t\tcin>>u>>v;\n\t\tadd_edge(u,v);\n\t\tadd_edge(v,u);\n\t}\n\tfor(int i = 1;i <= n;i++) cin>>w[i];\n\tfor(int i = 1;i <= n;i++){\n\t//\u904d\u5386\u6bcf\u4e00\u4e2a\u7ed3\u70b9 \n\t\tif(num[i] < 2) continue;\n\t\t//\u5982\u679c\u8fde\u8fb9\u5c0f\u4e8e2\uff0c\u8df3\u8fc7 \n\t\tlong long sum = 0,sum2 = 0,max1 = 0,max2 = 0;\n\t\t//\u5206\u522b\u4e3a\u6743\u503c\u548c\uff0c\u6743\u503c\u5e73\u65b9\u548c\uff0c\u6700\u5927\u6743\u503c\uff0c\u6b21\u5927\u6743\u503c \n\t\tfor(int k = head[i];k;k = next[k]){ \n\t\t//\u904d\u5386\u4e0e\u5176\u76f8\u8fde\u7684\u7ed3\u70b9 \n\t\t\tint eto = edge_to[k];\n\t\t\tif(w[eto] > max1) max1 = w[eto];\n\t\t\telse if(w[eto] > max2) max2 = w[eto];\n\t\t\tsum += w[eto];\t\t\n\t\t\t//\u66f4\u65b0\u6743\u503c\u548c \n\t\t\tsum2 += w[eto]*w[eto];\n\t\t\t//\u66f4\u65b0\u6743\u503c\u5e73\u65b9\u548c \n\t\t\tsum2 %= Mod;\t\n\t\t\t//\u53d6\u6a21\u9632\u6ea2\u51fa \n\t\t}\n\t\tmaxa = maxa > max1*max2 ? maxa:max1*max2;\n\t\t//\u66f4\u65b0\u6700\u5927\u8054\u5408\u6743\u503c \n\t\tans += (sum*sum - sum2)%Mod;\n\t\t//\u66f4\u65b0\u8054\u5408\u6743\u503c\u548c \n\t\tans %= Mod;\n\t}\n\tcout<<maxa<<\" \"<<ans;\n}\n```\n",
        "postTime": 1571739281,
        "uid": 32310,
        "name": "LetMyself",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "## \u3010\u601d\u8def\u3011\n\u6811\u4e0a\u95ee\u9898  + dfs    \n\u4e00\u5f00\u59cb\u6ca1\u5f80\u6811\u4e0a\u64cd\u4f5c\u8fd9\u4e2a\u5730\u65b9\u60f3\u5c31\u60f3\u6253\u4e2a\u66b4\u529b\u641c\u7d22\u90a3\u70b9\u90e8\u5206\u5206    \n\u7136\u540e\u53d1\u73b0\u66b4\u641c\u662f\u5f88\u9ebb\u70e6\u7684\uff0c\u597d\u50cf\u662f\u6ca1\u6cd5\u5904\u7406\u7c7b\u4f3c\u83ca\u82b1\u56fe\u7684\u56fe\u5f62    \n\u6240\u4ee5\u53ea\u80fd\u4e0a\u6811    \n\u53ef\u4ee5\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\u7b2c\u4e00\u4e2a\u90e8\u5206\u5148\u9884\u5904\u7406\u51fa\u6bcf\u4e00\u4e2a\u70b9\u5bf9\u5e94\u7684\u957f\u5ea6\u4e3a1\u7684\u83ca\u82b1\u56fe\u91cc\u9762\u7684\u6700\u5927\u503c\u548c\u6700\u5927\u503c\u7684\u4f4d\u7f6e\uff0c\u540c\u65f6\u4e5f\u6c42\u51fa    \n\u8fd9\u4e2a\u70b9\u5bf9\u5e94\u7684\u83ca\u82b1\u56fe\u91cc\u9762\u6240\u6709\u5b50\u8282\u70b9\u7684\u548c    \n\u56e0\u4e3a\u540e\u9762\u6c42\u603b\u548c\u7684\u65f6\u5019\u53ef\u4ee5\u7528\u4e00\u4e2a\u70b9\u7684\u503c\u4e58\u4ee5\u8fd9\u4e2a\u83ca\u82b1\u56fe\u7684\u603b\u548c\u51cf\u53bb\u90a3\u4e2a\u70b9\u7684\u503c   \n\u7136\u540e\u518d\u6765\u4e00\u4e2adfs    \n\u5148\u5904\u7406\u5904\u4e0d\u662f\u83ca\u82b1\u56fe\u4e5f\u5c31\u662f\u76f4\u4e0a\u76f4\u4e0b\u4e0d\u62d0\u5f2f\u7684\u90a3\u79cd\u53ef\u80fd\u51fa\u73b0\u7684\u60c5\u51b5\u4e5f\u66b4\u529b\u6bd4\u8f83\u627e\u6700\u5927\u503c    \n\u7136\u540e\u518d\u679a\u4e3e\u83ca\u82b1\u56fe\uff0c\u6bd4\u8f83\u91cc\u9762\u54ea\u4e00\u4e2a\u9664\u4e86\u6700\u5927\u70b9\u7684\u70b9\u548c\u6700\u5927\u7684\u7684\u4e58\u79ef\u6700\u5927    \n\u4e5f\u5c31\u662f\u627e\u51fa\u6b21\u5927\u70b9\u8bb0\u5f55\uff0c\u540c\u65f6\u6c42\u548c\uff0c\u5c31\u7528\u4e0a\u9762\u7684\u65b9\u6cd5\u5c31\u53ef\u4ee5\u4e86     \n\n## \u3010\u5b8c\u6574\u4ee3\u7801\u3011\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<vector>\n\nusing namespace std;\nconst int Max = 2e5 + 10;\nconst int mo = 1e4 + 7;\nint a[Max];\nint father[Max];\nint maxw[Max],maxv[Max];//\u67d0\u4e2a\u70b9\u5bf9\u5e94\u7684\u5b50\u8282\u70b9\u91cc\u9762\u7684\u6700\u5927\u503c\u548c\u6700\u5927\u503c\u7684\u4f4d\u7f6e \nint sum[Max];//\u67d0\u4e2a\u70b9\u5bf9\u5e94\u7684\u5b50\u8282\u70b9\u4e4b\u548c \nvector<int>e[Max];\nint n;\nint ans1,ans2;\n\nvoid dfs1(int x,int fa)\n{\n\tfor(int i = 0;i < e[x].size();i ++)\n\t{\n\t\tif(e[x][i] != fa)\n\t\t{\n\t\t\tif(a[e[x][i]] > maxw[x])\n\t\t\t\tmaxw[x] = a[e[x][i]],maxv[x] = e[x][i];\n\t\t\tsum[x] = (sum[x] + a[e[x][i]]) % mo;\n\t\t\tdfs1(e[x][i],x); \n\t\t}\n\t}\n}\n\nvoid dfs2(int x,int fa)\n{\n\tfather[x] = fa;\n\tif(father[father[x]] != 0)\n\t{\n\t\tans1 = max(ans1,a[father[father[x]]] * a[x]);\n\t\tans2 = (ans2 + 2 * a[x] * a[father[father[x]]]) % mo;\n\t}\n\tfor(int i = 0;i < e[x].size();i ++)\n\t{\n\t\tif(e[x][i] != fa)\n\t\t{\n\t\t\tif(e[x][i] != maxv[x])ans1 = max(ans1,a[e[x][i]] * maxw[x]);\n\t\t\tans2 = (ans2 + a[e[x][i]] * (sum[x] - a[e[x][i]])) % mo;\n\t\t\tdfs2(e[x][i],x);\n\t\t}\n\t}\n}\n\nint main()\n{\n//\tfreopen(\"2\",\"r\",stdin); \n\tint x,y;\n\tscanf(\"%d\",&n);\n//\tfor(int i = 1;i <= n;++ i)\n//\t\tfather[i] = i;\n\tfor(int i = 1;i < n;++ i)\n\t{\n\t\tscanf(\"%d%d\",&x,&y);\n\t\te[x].push_back(y);\n\t\te[y].push_back(x);\n\t}\n\tfor(int i = 1;i <= n;++ i)\n\t\tscanf(\"%d\",&a[i]);\n\tdfs1(1,0);\n\tdfs2(1,0);\n\tcout<<ans1<<\" \"<<ans2 % mo<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1571281372,
        "uid": 186489,
        "name": "EarthGiao",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u68f5\u65e0\u6839\u6811\uff0c\u6c42\u6240\u6709\u7684\u70b9\u5bf9$(u,v)$\u4e14\u8ddd\u79bb\u4e3a2\u7684\u4e58\u79ef\u4e4b\u548c,\u5e76\u8f93\u51fa\u6700\u5927\u7684\u70b9\u5bf9\u4e58\u79ef\u3002\n\n## \u601d\u8def\n\n\u9996\u514830\u5206\u662f\u5f88\u597d\u60f3\u7684\u3002\n\n\u679a\u4e3e\u6bcf\u4e00\u4e2a\u4e2d\u8f6c\u70b9\uff0c\u8fdb\u884c\u4e00\u4e2a$O(n^2)$\u7684\u8ba1\u7b97\u5373\u53ef\u3002\n\n\u603b\u590d\u6742\u5ea6$O(n^3)$\n\n60\u5206\u7684\u8bdd\uff0c\u6211\u4eec\u8003\u8651\u4f18\u5316\u6389\u4e0a\u9762\u7b97\u6cd5\u7684\u4e00\u7ef4\u3002\n\n\u663e\u7136\u7b2c\u4e09\u7ef4\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6765\u4e00\u4e2a$sum[i]$\uff0c\u4ee3\u8868\u70b9$i$\u5468\u56f4\u7684\u70b9\u6743\u548c\u3002\n\n\u90a3\u4e48\u7b2c\u4e09\u7ef4\u5c31\u53ef\u4ee5\u7565\u53bb\uff0c\u603b\u590d\u6742\u5ea6\u4e3a$O(n^2)$\n\n100\u5206\u505a\u6cd5\uff0c\u663e\u7136\u9700\u8981\u7528$O(n)$\u5de6\u53f3\u7684\u65b9\u6cd5\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u628a60\u5206\u7684\u505a\u6cd5\u7ee7\u7eed\u6539\u8fdb\u4e00\u4e0b\u3002\n\n\u6211\u4eec\u8003\u8651\u6bcf\u4e00\u4e2a\u4e2d\u8f6c\u70b9\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\n\n\u6211\u4eec\u5148\u8ba8\u8bba\u4e0e\u70b9$i$\u76f4\u63a5\u76f8\u8fde\u7684\u70b9\u6570\u4e3a$2$\u7684\u60c5\u51b5\u3002\n\n\u8bbe\u8fd9\u4e24\u4e2a\u70b9\u4e3a$a,b$\n\n\u90a3\u4e48\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f$ab+ba=(a+b)^2-a^2-b^2$\n\n\u6211\u4eec\u7ee7\u7eed\u5ef6\u4f38\u5230\u4e09\u4e2a\u70b9$a,b,c$\n\n\u663e\u7136\u7ed3\u679c\u5c31\u662f$2ab+2bc+2ca=(a+b+c)^2-a^2-b^2-c^2$\n\n\u6269\u5c55\u5230$n$\u4e2a\u8282\u70b9\u5462\uff1f\u7b54\u6848\u5c31\u5f88\u663e\u7136\u4e86\u3002\n\n$$(\\sum_{i=1}^{n} a_i)^2- \\sum_{i=1}^n a_{i}^{2}$$\n\n\u4ee3\u7801\u5c31\u6bd4\u8f83\u597d\u5199\u4e86\u3002\n\n(\u8bb0\u5f97\u53d6\u6a21\uff01)\n\n$Code:$\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\nconst int maxn = (200000 + 10) * 2;\n#define mod 10007\n\nstruct Edge {\n\tint to , nxt;\n}e[maxn];\n\nint cnt , n , a[maxn] , head[maxn] , sum1[maxn] , son1[maxn] , son2[maxn] , sum2[maxn];\n\n\nvoid add(int u, int v) {\n\te[++cnt].to = v;\n\te[cnt].nxt = head[u];\n\thead[u] = cnt;\n}\n\nvoid Dfs(int now , int last) {\n\tfor(int i = head[now] ; i ; i = e[i].nxt) {\n\t\tint v = e[i].to;\n\t\tif(a[v] > son1[now]) son1[now] = a[v];\n\t\telse if(a[v] <= son1[now] && a[v] > son2[now]) son2[now] = a[v];\n\t\tsum1[now] = (sum1[now] % mod + a[v] % mod) % mod;\n\t\tsum1[now] %= mod;\n\t\tsum2[now] = (sum2[now] + a[v] % mod * a[v] % mod) % mod;\n\t\tsum2[now] %= mod;\n\t\tif(v == last) continue;\n\t\tDfs(v , now);\n\t}\n}\n\nvoid Solve () {\n\tlong long ans1 = 0 ;\n\tint ans2 = 0;\n\t\n\tfor(int now = 1 ; now <= n ; now ++) {\n\t\tans2 = max(ans2 , son1[now] * son2[now]);\n\t\t\n\t\tans1 = (ans1 + (sum1[now]  * sum1[now])   - sum2[now]) % mod;\n\t}\n\tprintf(\"%d %lld\" , ans2 , ans1 );\n}\n\nint main () {\n\t//freopen(\"test.in\" , \"r\" , stdin);\n\tscanf(\"%d\" ,&n);\n\tfor(int i = 1 ; i < n ; ++ i) {\n\t\tint u , v;\n\t\tscanf(\"%d%d\" ,&u , &v);\n\t\tadd(u , v) , add(v , u);\n\t}\n\tfor(int i = 1 ; i <= n ; ++ i) scanf(\"%d\" ,&a[i]) , a[i] %= mod;\n\tDfs(1 , 1);\n\tSolve();\n\treturn 0;\n}\n\n\n```",
        "postTime": 1569491123,
        "uid": 134080,
        "name": "jins3599",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\n## \u4e0d\u8981\u88ab\u6811\u5e26\u8dd1\u504f\u4e86\n![](https://cdn.luogu.com.cn/upload/pic/74145.png)\n\n\u5bf9\u4e8e\u8282\u70b9$x$\uff0c\u53ea\u9700\u8981\u8bb0\u5f55\u4e0e\u5176\u76f8\u90bb\u7684\u70b9\u7684\u6743\u91cd\u4e4b\u548c\uff08\u4e0d\u5305\u62ec\u81ea\u8eab\uff09$sum[x]$\n\n\u90a3\u4e48\u5bf9\u4e8e\u4e0e$x$\u76f8\u90bb\u7684\u8282\u70b9$i$\uff0c\u6613\u8bc1\u5176\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u662f$w[i]*(sum[x]-w[i])$\n\uff08\u4f9d\u7136\u662f\u4e58\u6cd5\u5206\u914d\u5f8b\uff09\n\n\u7136\u540e\u662f\u6c42\u6700\u5927\u503c\n\n\u53ea\u8981\u8bb0\u5f55\u4e0e$x$\u76f8\u90bb\u7684\u70b9\u4e2d\u6743\u503c\u6700\u5927\u7684\u4e24\u4e2a\u5c31\u597d\u4e86\uff0c~~\u4f18\u5148\u961f\u5217\u6162\u6210\u5c51~~\n\n**\u5177\u4f53\uff1a**\n\n$max1$\u8bb0\u5f55\u7b2c\u4e00\u5927\uff0c$max2$\u8bb0\u5f55\u7b2c\u4e8c\u5927\n\n\u6bcf\u8fdb\u6765\u4e00\u4e2a\u503c\uff0c\u5148\u770b\u4ed6\u662f\u4e0d\u662f\u6bd4$max1$\u5927\uff0c\u662f\u7684\u8bdd\u5c31\u5c06\n$max2=max1,max1=now$\n\n\u5982\u679c\u5c0f\u4e8e$max1$\u5927\u4e8e$max2$ $max2=now$\n\u5426\u5219\u4e0d\u7ba1\n\n\uff08\u6bd2\u7624\u5199\u6cd5 $by$ $CangMing$\uff09\n```\n    int go=edge[i];\n    w[go]>max1?(max2=max1,max1=w[go]):(w[go]>max2?max2=w[go]:0);\n```\n\n\n\u6700\u540e$max1*max2$\u66f4\u65b0\u5168\u5c40\u6700\u5927\u503c\n\n\u5982\u6b64\u904d\u5386\u6bcf\u4e2a\u8282\u70b9\uff0c\u5c31\u80fd\u6c42\u51fa\u7b54\u6848\u4e86,\u65f6\u95f4\u590d\u6742\u5ea6$O(n+m)=O(2n)$\uff08\u672c\u9898\u53ef\u4ee5\u7b49\u4ef7\uff09\n\n\u76f8\u5f53\u4e8e\u6bcf\u6761\u8fb9\uff08\u6216\u6bcf\u4e2a\u70b9\uff09\u90fd\u8bbf\u95ee\u8fc7\u4e24\u904d\n\n\u65f6\u95f4\u5927\u6982$50ms$\uff0c\u80fd\u8fc7\u672c\u5730\u8001\u5e74\u8bc4\u6d4b\u673a\n\n**\u4ee3\u7801**\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=2e5+10,mod=10007;\nint n,w[N],sum[N],ans,maxl;\nint tot,edge[N<<1],nxt[N<<1],head[N];\nvoid add()\n{\n\tint x,y;scanf(\"%d%d\",&x,&y);\n\tedge[++tot]=y,nxt[tot]=head[x],head[x]=tot;\n\tedge[++tot]=x,nxt[tot]=head[y],head[y]=tot;\n}\nvoid dfs(int pre,int now)\n{\n\tfor(int i=head[now];i;i=nxt[i])\n\t{\n\t\tint go=edge[i];\n\t\tif(go!=pre)\n\t\t{\n\t\t\tsum[now]+=w[go],sum[go]+=w[now];\n\t\t\tsum[now]%=mod,sum[go]%=mod;\n\t\t\tdfs(now,go);\n\t\t}\n\t}\n}\nint main()\n{\n//\tfreopen(\"link.in\",\"r\",stdin);freopen(\"link.ans\",\"w\",stdout); \n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<n;i++)\n\t    add();\n\tfor(int i=1;i<=n;i++)\n\t    scanf(\"%d\",&w[i]);\n\tdfs(0,1);\n    for(int k=1;k<=n;k++)\n    {\n    \tint max1=0,max2=0;\n\t\tfor(int i=head[k];i;i=nxt[i])\n    \t{\n    \t\tint go=edge[i];\n    \t\tw[go]>max1?(max2=max1,max1=w[go]):(w[go]>max2?max2=w[go]:0);\n    \t\tint v=sum[k]-w[go];\n    \t\tv=(v%mod+mod)%mod;\n    \t\tans=(w[go])*v%mod+ans,ans%=mod;\n\t\t}\n\t\tmaxl=max(maxl,max1*max2);\n\t}    \n\tprintf(\"%d %d\",maxl,ans);\n\t//fclose(stdin);fclose(stdout);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1566478563,
        "uid": 112390,
        "name": "izthy",
        "ccfLevel": 0,
        "title": "P1351 \u8054\u5408\u6743\u503c(\u5946\u4f6c\u7248)"
    },
    {
        "content": "## Solution\n\n### \u6700\u5927\u6c42\u8054\u5408\u6743\u503c\n\n1. \u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\n2. \u904d\u5386\u4e0e\u8be5\u70b9\u76f8\u8fde\u7684\u70b9\uff0c\u627e\u6700\u5927\u503c $max1$ \u548c\u6b21\u5927\u503c $max2$\uff0c\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\n\n```cpp\nint max1 = 0, max2 = 0;\nfor (int i = head[x]; i; i = edge[i].next)\n{\n    int y = edge[i].y;\n    if (w[y] > max1)\n    {\n        max2 = max1;\n        max1 = w[y];\n    } else if (w[y] > max2)\n        max2 = w[y];\n}\nans1 = max(ans1, max1 * max2);\n```\n\n\u7528 $max1 * max2$ \u66f4\u65b0\u7b54\u6848\n\n### \u6c42\u8054\u5408\u6743\u503c\u4e4b\u548c\n\n\u6ce8\u610f\u5230 $(a + b + c)^2 = a^2 + b^2 + c ^ 2 + 2ab + 2ac + 2bc$\n\u6240\u4ee5\u679a\u4e3e\u6bcf\u4e2a\u70b9\u65f6\uff0c\u53ea\u9700\u7edf\u8ba1\u4e0e\u8be5\u70b9\u76f8\u8fde\u7684\u70b9\u7684\n\n- \u548c\u7684\u5e73\u65b9\n- \u5e73\u65b9\u548c\n\n\u4ee3\u7801\u5982\u4e0b\n\n```cpp\nint sum = 0, sqrs = 0;\nfor (int i = head[x]; i; i = edge[i].next)\n{\n    int y = edge[i].y;\n    sum = (sum + w[y]) % P;\n    sqrs = (sqrs + w[y] * w[y]) % P;\n}\nans2 = (ans2 + sum * sum - sqrs) % P;\n```\n\n\u5728\u76ee\u524d\u7b54\u6848\u4e0a\u7d2f\u52a0 (\u548c\u7684\u5e73\u65b9 - \u5e73\u65b9\u548c)\nPS: \u56e0\u4e3a\u9898\u76ee\u4e2d\u63cf\u8ff0\u4e3a `\u6709\u5e8f\u70b9\u5bf9`\uff0c\u6240\u4ee5\u4e0d\u9700\u9664\u4ee52\n\n## Code\n\n```cpp\n// \u8054\u5408\u6743\u503c(link) (http://www.mfstem.org/contest/18/problem/B)\n// author: xzqiaochu\n// status: AC\n#include <cstdio>\n#include <algorithm>\n\nusing std::max;\n\nconst int SZP = 2e5 + 7, SZE = 2 * SZP, P = 10007;\n\nint n;\nint w[SZP];\nstruct Edge\n{\n    int x, y, next;\n    Edge() {}\n    Edge(int _x, int _y, int _n) : x(_x), y(_y), next(_n) {}\n\n} edge[SZE];\nint head[SZP];\nint ans1, ans2;\n\ninline void addEdge(int x, int y)\n{\n    static int tot;\n    edge[++tot] = Edge(x, y, head[x]);\n    head[x] = tot;\n}\n\nint main()\n{\n    // freopen(\"link.in\", \"r\", stdin);\n    // freopen(\"link.out\", \"w\", stdout);\n    scanf(\"%d\", &n);\n    for (int i = 1; i <= n - 1; i++)\n    {\n        int x, y;\n        scanf(\"%d%d\", &x, &y);\n        addEdge(x, y), addEdge(y, x);\n    }\n    for (int i = 1; i <= n; i++)\n        scanf(\"%d\", w + i);\n\n    for (int x = 1; x <= n; x++)\n    {\n        int max1 = 0, max2 = 0;\n        int sum = 0, sqrs = 0;\n        for (int i = head[x]; i; i = edge[i].next)\n        {\n            int y = edge[i].y;\n            if (w[y] > max1)\n            {\n                max2 = max1;\n                max1 = w[y];\n            } else if (w[y] > max2)\n                max2 = w[y];\n            sum = (sum + w[y]) % P;\n            sqrs = (sqrs + w[y] * w[y]) % P;\n        }\n        ans1 = max(ans1, max1 * max2);\n        ans2 = (ans2 + sum * sum - sqrs) % P;\n    }\n\n    printf(\"%d %d\", ans1, ans2);\n    return 0;\n}\n```\n",
        "postTime": 1563806413,
        "uid": 146104,
        "name": "xzqiaochu",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u641c\u4e86\u4e00\u5e74\u9898\u89e3\u53d1\u73b0\u8fd8\u4e0d\u5982\u81ea\u5df1\u7684\u778e\u641e\u505a\u6cd5\u5feb..\n\n\n\n![](https://i.loli.net/2019/04/05/5ca6c3a800562.png)\n$$\u2191\\texttt{(O(n)\u505a\u6cd5\uff0c\u8c8c\u4f3c\u6bd4HK\u8bb0\u8005\u8fd8\u5feb)}\u2191$$\n\n\n\n------------\n## \u5206\u6790\n\n\u5148\u53d8\u56fe\u4e3a\u6811\u3002\n\n\u53e6\u5916\u4e0d\u7528\u5efa\u6811..\n\u5148\u641e\u4e2a$\\texttt{queue<pair<int,int> > q;}$\n\u6bcf\u4e00\u5bf9\u7236\u5b50$\\texttt{make pair}$\u6254\u4e00\u8d77\u5c31\u597d\u4e86\n\n\u663e\u7136\uff0c\u8ddd\u79bb\u4e3a2\u4e0d\u5c31\u662f**\u4e00\u4e2a\u7236\u8282\u70b9\u7684\u4efb\u610f\u4e24\u4e2a\u5b50\u7ed3\u70b9\u7684\u8ddd\u79bb**\u561b\uff0c\u5982\u56fe\uff08\u6837\u4f8b\u7684\uff09\uff1a\n\n![](https://cdn.luogu.com.cn/upload/pic/55876.png)\n\n\u4ee5$3$\u53f7\u4e3a\u4f8b\uff0c$4,2$\u53f7\u8ddd\u79bb\u4e3a$2$\uff0c\u4ee5\u6b64\u7c7b\u63a8\u63a8\u8bba\u6210\u7acb\u3002\n\n------------\n### \u6700\u5927\u8054\u5408\u6743\u503c\n\n\u6211\u4eec\u53d1\u73b0\u8981\u7edf\u8ba1\u6700\u5927\u8054\u5408\u6743\u503c\uff0c\u5176\u5b9e\u5c31\u662f\u679a\u4e3e\u7ed3\u70b9\uff0c**\u6eda\u52a8\u66f4\u65b0**\u8be5\u7ed3\u70b9\u7684\u513f\u5b50\u91cc\u4e2d\u6700\u5927\u7684\u4e24\u4e2a\u6743\u503c\u3002\n\n\u600e\u4e48\u6eda\u52a8..\u5927\u6982\u662f\u8fd9\u6837\uff1a\n\n```\nif(w[v]>maxn[u][1]) maxn[u][1]=w[v]; if(maxn[u][1]>maxn[u][0]) swap(maxn[u][1],maxn[u][0]);\n        if(w[u]>maxn[v][1]) maxn[v][1]=w[u]; if(maxn[v][1]>maxn[v][0]) swap(maxn[v][1],maxn[v][0]);\n```\n\n\u62bd\u8c61\u7406\u89e3\u5c31\u662f\u65f6\u523b\u66f4\u65b0\u7b2c\u4e00\u548c\u7b2c\u4e8c\u5927\u7684\u503c\u3002\n\n\n\n------------\n### \u8054\u5408\u6743\u503c\u4e4b\u548c\n\n\u663e\u7136\uff0c\u5355\u5355\u679a\u4e3e\u80af\u5b9a\u4f1a\u91cd\u590d\u8ba1\u7b97.\n\n\u4f46\u662f\u6211\u4eec\u6709\u4e2a\u597d\u7528\u7684\u5e73\u65b9\u548c\u516c\u5f0f\u554a..\n\n$\\mathit(a+b+c+...+d)^2=a^2+b^2+...+c^2+2ab+2ac+...$\n\n$ab+ac+bc+...$\u5373\u4e3a\u6240\u6c42\u3002\n\n\u56e0\u6b64\u7edf\u8ba1\u6bcf\u4e2a\u70b9\u88ab\u8ba1\u7b97\u7684\u6b21\u6570\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e2a\u70b9\u7684\u5ea6\u3002\n\n\u5728**\u603b\u7684\u6743\u503c\u548c\u91cc\u51cf\u53bb\u6bcf\u4e2a\u70b9\u7684\u5ea6*\u6bcf\u4e2a\u70b9\u7684\u6743\u503c\u7684\u5e73\u65b9**\u5373\u662f\u8054\u5408\u6743\u503c\u4e4b\u548c\u3002\n\n\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u8fb9\u51cf\u8fb9\u66f4\u65b0\uff0c\u56e0\u6b64\u4e0d\u6d6a\u8d39\u590d\u6742\u5ea6\u3002\n\n\u603b\u590d\u6742\u5ea6\u4e3aO(n)\uff0c**\u4e00\u5b9a\u6ce8\u610f\u53d6\u6a21\u7684\u6280\u5de7\u4ee5\u53ca\u4e0d\u8981\u968f\u4fbf\u53d6\u6a21**\u3002\n\n\n\n------------\n$\\texttt{code:}$\n\n```\n// luogu-judger-enable-o2\n// luogu-judger-enable-o2\n#include<bits/stdc++.h>\nusing namespace std;\n#define N 200005\n#define ll long long\n#define mp make_pair\n#define p 10007\n\nint n;\nll ans;\nll w[N],idx[N];\nll sum[N],maxn[N][2];\nll maxm;\n\nchar gc() {\n    static char buf[1000001],*p1=buf,*p2=buf;\n    return p1==p2&&(p2=(p1=buf)+fread(buf,1,1000000,stdin),p1==p2)?EOF:*p1++;\n}\n\nll read(){\n    ll x=0,w=0;\n    char ch=0;\n    while(!isdigit(ch)) w|=ch=='-',ch=gc();\n    while(isdigit(ch)) x=(x<<1)+(x<<3)+(ch^48),ch=gc();\n    return w?-x:x;\n}\nqueue<pair<ll,ll> >q;\nint main(){\n    n=read();\n    for(int i=1;i<n;i++) q.push(mp(read(),read()));\n    for(int i=1;i<=n;i++) w[i]=read();\n    for(int i=1;i<n;i++){\n        int u=q.front().first,v=q.front().second;q.pop();\n        sum[u]=(sum[u]+w[v])%p;sum[v]=(sum[v]+w[u])%p;//\u4f9d\u6b21\u9009\u62e9\n        ++idx[u];++idx[v];//\u7edf\u8ba1\u5ea6\n        if(w[v]>maxn[u][1]) maxn[u][1]=w[v]; if(maxn[u][1]>maxn[u][0]) swap(maxn[u][1],maxn[u][0]);\n        if(w[u]>maxn[v][1]) maxn[v][1]=w[u]; if(maxn[v][1]>maxn[v][0]) swap(maxn[v][1],maxn[v][0]);//\u6eda\u52a8\u66f4\u65b0\u6700\u5927\u548c\u6b21\u5927\u503c\n    }\n    for(int i=1;i<=n;i++){\n        ans=(ans+sum[i]*sum[i]-idx[i]%p*w[i]*w[i])%p;//\u5e73\u65b9\u548c\n        maxm=max(maxm,maxn[i][1]*maxn[i][0]);//\u66f4\u65b0\n    }\n    if(ans<0) ans+=p;//\u6ce8\u610f\u8d1f\u6570\u53d6\u6a21\n    printf(\"%lld %lld\",maxm,ans);\n    return 0;\n}\n```\n\n",
        "postTime": 1554435921,
        "uid": 83906,
        "name": "_stellar",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u6211\u4eec\u8003\u8651\u5728\u6811\u4e0a\u8ddd\u79bb\u4e3a2\u7684\u70b9\uff0c\u4ed6\u4eec\u4e4b\u95f4\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\u70b9\u3002 \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u6811\u4e0a\u7684\u6240\u6709\u70b9\uff0c\u518d\u679a\u4e3e\u6240\u6709\u5b83\u8fde\u63a5\u7684\u70b9\uff0c\u53ea\u8981\u5b83\u8fde\u7684\u70b9\u5728\u4e00\u4e2a\u4ee5\u4e0a\uff0c\u7edf\u8ba1\u7b54\u6848\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u8fd9\u79cd\u64cd\u4f5c\u6211\u624b\u5199\u4e86\u4e00\u4e2a\u961f\u5217\u6765\u5b9e\u73b0\u3002\n```cpp\nfor(int i = head[x] ; i ; i = nxt[i])\n    {\n        int u = e[i].t;\n        s[++cnt] = w[u]; //\u5c06\u5b83\u8fde\u63a5\u7684\u70b9\u7684\u6743\u503c\u653e\u5165\u961f\u5217 \n    }\n    if(cnt != 1)//\u5982\u679c\u5b83\u8fde\u63a5\u4e86\u4e0d\u6b62\u4e00\u4e2a\u70b9\n    for(int i = 1 ; i <= cnt ; i ++)\n        for(int j = 1 ; j <= cnt ; j ++)\n            if(i != j) sum = (sum + s[i] * s[j]) % p, ans = max(ans , s[i] * s[j]);//\u66f4\u65b0\u6743\u503c\u548c\u548c\u6700\u5927\u503c\n```\n\u8fd9\u79cd\u65b9\u6cd5\u8fd8\u662f\u975e\u5e38\u597d\u60f3\u7684\u3002\n\n\u4f46\u662f\u8fd9\u6837\u590d\u6742\u5ea6\u80af\u5b9a\u4f1a\u7206\u70b8\u3002\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5728\u8fd9\u79cd\u65b9\u6cd5\u7684\u57fa\u7840\u4e0a\u8fdb\u884c\u4f18\u5316\u3002\n\n#### \u9996\u5148\u662f\u8054\u5408\u6743\u503c\u7684\u6700\u5927\u503c\u3002\n\n\u6839\u636e\u9898\u610f\u8054\u5408\u6743\u503c\u662f\u8ddd\u79bb\u4e3a2\u7684\u4e24\u4e2a\u70b9\u6743\u503c\u7684\u4e58\u79ef\u3002\u4e0d\u96be\u53d1\u73b0\u8fd9\u5c31\u662f\u6743\u503c\u6700\u5927\u7684\u70b9\u548c\u6b21\u5927\u7684\u70b9\u7684\u4e58\u79ef\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5728\u679a\u4e3e\u4e00\u4e2a\u70b9\u8fde\u63a5\u7684\u70b9\u7684\u65f6\u5019\uff0c\u987a\u4fbf\u8bb0\u4e00\u4e0b\u6700\u5927\u503c\u548c\u6b21\u5927\u503c\u3002\u7528\u8fd9\u4e24\u4e2a\u503c\u5f97\u4e58\u79ef\u66f4\u65b0\u6700\u7ec8\u7b54\u6848\u3002\n\n#### \u7136\u540e\u662f\u8054\u5408\u6743\u503c\u7684\u548c\u3002\n\n\u521a\u624d\u7684\u505a\u6cd5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3b\u8981\u96c6\u4e2d\u4e8e\u8ba1\u7b97\u6743\u503c\u548c\u3002\u90a3\u6837\u505a\u662f$O(n^2)$\u7684\u3002\n\n\u6211\u4eec\u6765\u60f3\u5982\u4f55\u5feb\u901f\u6c42\u51fa\u6743\u503c\u548c\u3002\n\n\u5982\u4e0b\u6709\u4e00\u4e2a\u961f\u5217 $s[]$ =  $abcd$\n\n\u6211\u4eec\u9700\u8981\u8ba1\u7b97\u7684\u662f$a *b + a*c+a*d+b*c*+c*d$\n\n\u63d0\u53d6\u516c\u56e0\u5f0f\u5c31\u53d8\u6210\u4e86$a*(b + c+d)+b*(c+d)+c*d$\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5f53\u6211\u4eec\u679a\u4e3e\u5230$i$\u65f6\uff0c\u6743\u503c\u548c\u5c31\u4f1a\u52a0\u4e0a$s[i] + sum(i + 1--j)$ \u800csum\u6211\u4eec\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u7ef4\u62a4\u3002\u8fd9\u6837\u6211\u4eec\u6c42\u548c\u7684\u590d\u6742\u5ea6\u5c31\u53d8\u6210\u4e86\u7ebf\u6027\u7684\u3002\n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u8fc7\u8fd9\u9053\u9898\u4e86~\u3002\n```cpp\n#include<bits/stdc++.h>\n\nusing namespace std;\n\nconst int maxn = 200050, p = 1e4 + 7;\nstruct node{\n    int f, t;\n}e[maxn<<1];\n#define ri register int\n#define ll long long                 \nint head[maxn], nxt[maxn<<1], dep[maxn], fa[maxn], w[maxn]; \nint n, m, tot, cnt;\nll ans, sum, s[maxn], k[maxn], m1, m2;\ninline int read()\n{\n    int x = 0, f = 1;\n    char ch = getchar();\n    while (ch < '0' || ch > '9') { if (ch == '-') f = -1; ch = getchar(); }\n    while (ch >= '0' && ch <= '9') { x = x * 10 + ch - 48; ch = getchar(); }\n    return x * f;\n}\ninline void buildnode(int a, int b)\n{\n    e[++tot] = (node){a, b};\n    nxt[tot] = head[a];\n    head[a] = tot;\n}\ninline void dfs1(int x, int fat)\n{\n    dep[x] = dep[fat] + 1;\n    fa[x] = fat;\n    for(int i = head[x] ; i ; i = nxt[i])\n    {\n        int u = e[i].t;\n        if(u == fa[x]) continue;\n        dfs1(u , x);\n    }\n}\ninline void dfs2(int x)\n{\n    cnt = 0, m1 = 0, m2 = 0;\n    for(int i = head[x] ; i ; i = nxt[i])\n    {\n        int u = e[i].t;\n        s[++cnt] = w[u];\n        if(s[cnt] > m1) m2 = m1 , m1 = s[cnt];\n        else if(s[cnt] > m2) m2 = s[cnt];  //\u8bb0\u5f55\u6700\u5927\u503c\u6b21\u5927\u503c\n    }\n    for(int i = 1 ; i <= cnt ; i ++)\n        k[i] = k[i - 1] + s[i]; //\u524d\u7f00\u548c\u64cd\u4f5c\n    ans = max(ans , m1 * m2);\n    for(int i = 1 ; i <= cnt ; i ++)\n        sum = (sum + s[i] * (k[cnt] - k[i])) % p;//\u7edf\u8ba1\u6743\u503c\u548c\u7b54\u6848\n    for(int i = head[x] ; i ; i = nxt[i])//\u66f4\u65b0\u5b8c\u6bd5\u540e\u904d\u5386\u5176\u4ed6\u70b9\n    {\n        int u = e[i].t;\n        if(u == fa[x]) continue;\n        dfs2(u);\n    }\n}\nint main()\n{\n    //freopen(\"s.in\",\"r\",stdin);\n    n = read();\n    for(ri i = 1 ; i <= n - 1 ; i ++)\n    {\n        int a, b;\n        a = read(); b = read();\n        buildnode(a, b);\n        buildnode(b, a);\n    }\n    for(int i = 1 ; i <= n ; i ++) w[i] = read();\n    dfs1(1, 0); \n    dfs2(1);\n    printf(\"%lld %lld\", ans, (sum * 2) % p );\n}\n\n```\n",
        "postTime": 1540907483,
        "uid": 53334,
        "name": "Izumi_Sagiri",
        "ccfLevel": 4,
        "title": "P1351 \u8054\u5408\u6743\u503c"
    },
    {
        "content": "[\u6d1b\u8c37P1351 \u539f\u9898\u5730\u5740](https://www.luogu.org/problemnew/show/P1351)\n\n\u8fd9\u9053\u9898\u6709\u591a\u79cd\u505a\u6cd5\u3002\n\n\u89c2\u5bdf\u9898\u9762\u53ef\u4ee5\u5f97\u51fa\uff0c\u70b9\u6570=\u8fb9\u6570+1\uff0c\u6240\u4ee5\u663e\u7136\uff0c\u8fd9\u662f\u4e00\u68f5\u65e0\u6839\u6811\uff0c\u53ef\u4ee5\u91c7\u7528\u6811\u5f62DP\u5f97\u5230\u7b54\u6848\u3002\n  \n\u4f46\u662f\uff0c\u6211\u4eec\u5728\u8fd9\u91cc\u8ba8\u8bba\u4e00\u79cd\u66f4\u4e3a\u7b80\u4fbf\u7684\u65b9\u6cd5\uff1a**\u66b4\u529b\u679a\u4e3e**\u3002\n\n\u6839\u636e\u9898\u76ee\u63cf\u8ff0\uff0c\u8ddd\u79bb\u4e3a2\u7684\u4e24\u70b9\u53ef\u4ea7\u751f\u8054\u5408\u6743\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u5f88\u5bb9\u6613\u60f3\u5230\u679a\u4e3e\u4e24\u70b9\u7684\u4e2d\u95f4\u70b9\uff0c\u9009\u4e24\u70b9\u4e0e\u4e2d\u95f4\u70b9\u5b58\u5728\u8fb9\u76f4\u63a5\u8fde\u63a5\uff0c\u6b64\u4e24\u70b9\u8ddd\u79bb\u5373\u4e3a2\u3002\u7531\u4e8e\u8ba1\u7b97\u7684\u662f\u6709\u5e8f\u70b9\u5bf9\uff0c\u53ea\u9700\u8981\u6ce8\u610f\u7684\u53bb\u6389\u6240\u9009\u4e24\u70b9\u76f8\u540c\u7684\u60c5\u51b5\u5373\u53ef\u3002\n\n\u6839\u636e\u4ee5\u4e0a\u601d\u8def\uff0c\u6211\u4eec\u6709\u4e86\u4e00\u4e2a\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n^2)$\u7684\u7b97\u6cd5\u3002\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define ll long long\n\nstruct Edge {\n\tint v, next;\n} edge[200010];\n\nconst int MOD = 10007;\nint n, tot = 0, head[200010]\uff1b\nll w[200010];\n\ninline void add(int x, int y) {\n\tedge[++tot].v = y;\n\tedge[tot].next = head[x];\n\thead[x] = tot;\n} // \u90bb\u63a5\u8868\u50a8\u5b58 \n\nint main(){\n\tscanf(\"%d\", &n);\n\tfor (int i = 1; i <= n - 1; i++) {\n\t\tint u, v;\n\t\tscanf(\"%d%d\", &u, &v);\n\t\tadd(u, v);\n\t\tadd(v, u);\n\t}\n\tfor (int i = 1; i <= n; i++) scanf(\"%d\", &w[i]);\n\tll sum = 0, mmax = 0;\n\tfor (int i = 1; i <= n; i++) { // \u679a\u4e3e\u4e2d\u95f4\u70b9\n\t\tfor (int j = head[i]; j; j = edge[j].next) {\n\t\t\tfor (int k = head[i]; k; k = edge[k].next) { // \u679a\u4e3e\u4e0e\u4e2d\u95f4\u70b9\u76f8\u8fde\u76842\u4e2a\u70b9\n\t\t\t\tif (edge[j].v != edge[k].v) {\n\t\t\t\t\tmmax = max(mmax, w[edge[j].v] * w[edge[k].v]); // \u66f4\u65b0\u6700\u5927\u503c\n\t\t\t\t\tsum += w[edge[j].v] * w[edge[k].v]; // \u7d2f\u8ba1\u603b\u548c\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tprintf(\"%d %d\", mmax, sum);\n\treturn 0;\n}\n```\n\n\u4f46\u5f88\u4e0d\u5e78\u7684\u662f\uff0c\u8fd9\u6837\u7684\u590d\u6742\u5ea6\u9884\u4f30\u53ea\u80fd\u8fc7$60\\%$\u7684\u6570\u636e\u3002\u5c3d\u7ba1\u5b9e\u9645\u6d4b\u8bd5\u4e2d\u8fc7\u4e867\u4e2a\u70b9\uff0c\u4f46\u4ecd\u7136\u4e0d\u80fd\u6ee1\u8db3\u6211\u4eec\u7684\u9700\u6c42\u3002\u90a3\u8be5\u600e\u4e48\u4f18\u5316\u6211\u4eec\u7684\u66b4\u529b\u5462\uff1f\n\n\u4ed4\u7ec6\u5206\u6790\u4e00\u4e0b\uff0c\u5982\u679c\u4e0e\u4e00\u4e2a\u4e2d\u95f4\u70b9\u6709$i$\u4e2a\u70b9\u76f8\u8fde,\u8bbe\u5b83\u4eec\u7684\u6743\u503c\u5206\u522b\u4e3a$w_1,w_2,\\cdots,w_i$\uff0c\u90a3\u4e48\u679a\u4e3e\u5230\u8fd9\u4e2a\u4e2d\u95f4\u70b9\u65f6\uff0c\u9700\u8981\u8ba1\u7b97\u7684\u8054\u5408\u6743\u503c\u603b\u548c\u5373\u4e3a\n$$[w_i*(w_{i-1}+w_{i-2}+\\cdots+w_1)+w_{i-1}*(w_{i-2}+w_{i-3}+\\cdots+w_1)+\\cdots+w_2*w_1]*2$$\n\n\u8fd9\u65f6\u6211\u4eec\u5c31\u5f88\u5bb9\u6613\u53d1\u73b0\uff0c\u6211\u4eec\u901a\u8fc7\u53ef\u4ee5\u8bb0\u5f55\u524d\u7f00\u548c\u6765\u5c06\u7d2f\u8ba1\u8054\u5408\u6743\u503c\u603b\u548c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4f18\u5316\u5230$O(n)$\u3002\u90a3\u6700\u5927\u8054\u5408\u6743\u503c\u600e\u4e48\u89e3\u51b3\u5462\uff1f\u53ef\u4ee5\u60f3\u5230\uff0c\u6bcf\u679a\u4e3e\u5230\u4e00\u4e2a\u65b0\u7684\u8282\u70b9\uff0c\u8054\u5408\u6743\u503c\u6700\u5927\u503c\u53ea\u53ef\u80fd\u88ab\u5f53\u524d\u8282\u70b9\u7684\u6743\u503c\u4e0e\u4e4b\u524d\u679a\u4e3e\u8fc7\u8282\u70b9\u7684\u6743\u503c\u6700\u5927\u503c\u7684\u4e58\u79ef\u6240\u66f4\u65b0\uff0c\u8fd9\u6837\u53ea\u8981\u8bb0\u5f55\u4e0b\u4e4b\u524d\u679a\u4e3e\u8fc7\u7684\u70b9\u6743\u503c\u6700\u5927\u503c\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define ll long long\n\nstruct Edge {\n\tint v, next;\n} edge[400010];\n\nconst int MOD = 10007;\nint n, tot = 0, head[200010];\nll w[200010];\n\ninline void add(int x, int y) {\n\tedge[++tot].v = y;\n\tedge[tot].next = head[x];\n\thead[x] = tot;\n} // \u90bb\u63a5\u8868\u50a8\u5b58 \n\nint main(){\n\tscanf(\"%d\", &n);\n\tfor (int i = 1; i <= n - 1; i++) {\n\t\tint u, v;\n\t\tscanf(\"%d%d\", &u, &v);\n\t\tadd(u, v);\n\t\tadd(v, u);\n\t}\n\tfor (int i = 1; i <= n; i++) scanf(\"%lld\", &w[i]);\n\tll sum = 0, mmax = 0, sum1, mmax1;\n\tfor (int i = 1; i <= n; i++) {\n\t\tint j = head[i];\n\t\tsum1 = w[edge[j].v]; // sum1\u8bb0\u5f55\u6743\u503c\u524d\u7f00\u548c\n\t\tmmax1 = w[edge[j].v]; // mmax1\u8bb0\u5f55\u4e4b\u524d\u679a\u4e3e\u5230\u7684\u70b9\u6743\u503c\u6700\u5927\u503c\n\t\tfor (j = edge[j].next; j != 0; j = edge[j].next) {\n\t\t\tsum = (sum + (sum1 * w[edge[j].v]) % MOD) % MOD;\n\t\t\tmmax = max(mmax, mmax1 * w[edge[j].v]);\n\t\t\tsum1 = (sum1 + w[edge[j].v]) % MOD; // \u7d2f\u8ba1\u524d\u7f00\u548c\n\t\t\tmmax1 = max(mmax1, w[edge[j].v]); // \u66f4\u65b0\u679a\u4e3e\u5230\u7684\u6700\u5927\u70b9\u6743\u503c\n\t\t}\n\t}\n\tprintf(\"%lld %lld\", mmax, (sum * 2) % MOD); // \u6ce8\u610f\u6700\u540e\u7ed3\u679c\u4e582\t\n    return 0;\n}\n```\n\n\u8fd9\u6837\u4f18\u5316\u8fc7\u540e\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n)$\uff0c\u8db3\u4ee5\u901a\u8fc7\u672c\u9898\u3002",
        "postTime": 1540733276,
        "uid": 29146,
        "name": "\u4f9d\u7136wtm",
        "ccfLevel": 0,
        "title": "2014NOIP\u63d0\u9ad8\u7ec4D1T2 \u8054\u5408\u6743\u503c"
    },
    {
        "content": "\u8981\u6c42\u8ddd\u79bb\u4e3a2\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e24\u4e2a\u70b9\u4e4b\u95f4**\u53ea\u8fde\u7740\u53e6\u4e00\u4e2a\u70b9**\uff0c\u6240\u4ee5\u80af\u5b9a\u662f**\u679a\u4e3e\u4e2d\u95f4\u7684\u8fd9\u4e2a\u70b9**\u3002\n\n\u9996\u5148\u8003\u8651\u6700\u5927\u6743\u503c\u7684\u505a\u6cd5\u3002\u663e\u7136\uff0c\u56f4\u7ed5\u4e00\u4e2a\u70b9\u7684\u6700\u5927\u6743\u503c\u80af\u5b9a\u662f\u4e0e**\u5b83\u76f8\u8fde\u7684\u4e24\u4e2a\u6743\u503c\u6700\u5927\u7684\u70b9**\u7684\u4e58\u79ef\uff0c\u6240\u4ee5\u7528$fir[i]$\u8868\u793a\u4e0e$i$\u7ed3\u70b9\u76f8\u8fde\u7684\u6700\u5927\u7684\u5e97\uff0c$sec[i]$\u8bb0\u5f55\u7b2c\u4e8c\u5927\u7684\u3002  \n\n\u63a5\u4e0b\u6765\u662f\u6c42\u548c\u3002\u5bf9\u4e8e\u65ad\u70b9$i$\uff0c\u5b83\u7684\u548c\u5c31\u662f\u6240\u6709\u7684$w[j] \\times (sum[i]-w[j])$\uff0c\u5176\u4e2d$j$\u8868\u793a\u5f53\u524d\u7684\u76f8\u8fde\u7ed3\u70b9\uff0c$sum[i]$\u8868\u793a\u4f59$i$\u76f8\u8fde\u6240\u6709\u70b9\u7684\u70b9\u6743\u4e4b\u548c\u3002\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u628a\u8fd9\u4e2a$sum$\u7b97\u51fa\u6765\uff0c\u51cf\u53bb\u6240\u6709\u7684$w[j]^2$\u5c31\u597d\u4e86\uff0c\u8fd9\u91cc$w[j]^2$\u7684\u548c\u7528$sqr$\u8bb0\u5f55\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n\nusing std::max;\n\ntypedef long long ll; \n\nconst int N = 200000; \nconst int m = 10007; \n\nint n; \nll w[N + 3]; \nint head[N + 3], ed[N + 3]; // \u6bcf\u4e00\u6761\u8fb9\u7684\u4fe1\u606f\n\nll fir[N + 3], sec[N + 3]; // \u524d\u4e24\u5927\u6743\u503c\nll sum[N + 3], sqr[N + 3]; // \u6743\u503c\u548c\uff0c\u5e73\u65b9\u548c\nll ans, res; // \u6700\u5927\u6743\u503c\uff0c\u603b\u6743\u503c\n\nvoid addedge(int a, ll c) {\n\tsum[a] = (sum[a] + c) % m; \n    sqr[a] = (sqr[a] + c * c % m) % m; \n    \n    // \u66f4\u65b0\u6700\u5927\u503c\n    if(c > sec[a]) {\n    \tif(c > fir[a]) sec[a] = fir[a], fir[a] = c; \n        else sec[a] = c; \n    }\n}\n\nint main() {\n\tscanf(\"%d\", &n); \n    for(int i = 1; i <  n; i++) scanf(\"%d%d\", &head[i], &ed[i]); \n    for(int i = 1; i <= n; i++) scanf(\"%lld\", &w[i]); \n    \n    // \u7edf\u8ba1\n    for(int i = 1; i <  n; i++) {\n    \taddedge(head[i], w[ed[i]]); \n        addedge(ed[i], w[head[i]]); \n    }\n    // \u7d2f\u52a0\n    for(int i = 1; i <= n; i++) {\n    \tres = (res + sum[i] * sum[i] - sqr[i]) % m; \n        ans = max(ans, fir[i] * sec[i]); \n    }\n    \n    printf(\"%lld %lld\\n\", ans, res); \n    \n    return 0; \n}\n```",
        "postTime": 1539005109,
        "uid": 75165,
        "name": "\u5f7c\u5cb8\u5f52\u822a",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u849f\u84bb\u4e5f\u80fd1A\u7684\u9898......\n\n\u611f\u89c9\u505a\u8fd9\u9053\u9898\u5e76\u6ca1\u7528\u4ec0\u4e48\u9ad8\u7aef\u7b97\u6cd5\uff08\u4e0d\u8fc7\u8dd1\u7684\u6709\u70b9\u6162\uff09\u3002\n\n\u56e0\u4e3a\u8981\u7528\u6700\u77ed\u8ddd\u79bb\u4e3a$2$\u7684\u70b9\u7b97\u8054\u5408\u6743\u503c\uff0c\u4e14\u8fd9\u662f\u4e00\u4e2a\u65e0\u73af\u7684\u56fe\uff08\u82e5\u6709\u4e09\u5143\u73af\u5c31GG\u4e86\uff09\uff0c\u6240\u4ee5\u4e24\u70b9\u4e4b\u95f4\u5fc5\u5939\u4e00\u4e2a\u70b9\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u4e0e\u540c\u4e00\u4e2a\u70b9\u76f4\u63a5\u76f8\u8fde\u7684\u4e24\u70b9\u4e4b\u95f4\u53ef\u4ee5\u8ba1\u7b97\u8054\u5408\u6743\u503c\u3002\n\n\u8003\u8651\u6bcf\u4e2a\u70b9\u4e0e\u4e4b\u76f4\u63a5\u76f8\u8fde\u7684\u70b9\uff0c\u4e2d\u95f4\u5939\u4e86\u6b64\u70b9\u7684\u6240\u6709\u4e8c\u5143\u7ec4\u7684\u8054\u5408\u6743\u503c\u6700\u5927\u4e3a\u8fd9\u4e9b\u70b9\u4e2d\u6700\u5927\u7684\u548c\u6b21\u5927\u7684\u6743\u503c\u4e58\u79ef\u3002\u6240\u4ee5\u8981\u8bb0\u5f55$fir[i],sec[i]$\u4e3a\u4e0e\u8fd9\u4e2a\u70b9\u76f4\u63a5\u76f8\u8fde\u7684\u70b9\u4e2d\u6743\u503c\u6700\u5927\u548c\u6b21\u5927\u3002\u6700\u540e\u627e$max$\u5c31\u884c\u4e86\u3002\n\n\u7b2c\u4e8c\u95ee\u53ef\u80fd\u8981\u7528\u4e00\u70b9\u70b9\u6570\u5b66\u77e5\u8bc6\u3002\n\n\u8ba1\u7b97\u6240\u6709\u8054\u5408\u6743\u503c\u7684\u548c\uff0c\u5373\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff08\u76f4\u63a5\u76f8\u8fde\u7684\u70b9\u6709$m$\u4e2a\uff09\u6743\u503c\u603b\u548c\u4e3a$sum$\n\n\u8054\u5408\u6743\u503c\u4e4b\u548c\u4e3a\n$$\\sum_{i=1}^m(sum-a[i])*a[i]$$\n\n\u62c6\u4e00\u62c6\uff0c\u53d8\u6210\n$$\\sum_{i=1}^m(sum*a[i]-a[i]^2)$$\n\n\u7136\u540e\u518d\u53d8\u6210\n$$sum^2-\\sum_{i=1}^ma[i]^2$$\n\n\u6240\u4ee5\u4e2d\u9014\u8fd8\u9700\u8981\u8bb0\u5f55\u6743\u503c\u5e73\u65b9\u548c$res[i]$\u3002\n\n\u628a\u6bcf\u4e2a\u70b9\u7684$sum[i]^2-res[i]$\u52a0\u8d77\u6765\u5c31\u597d\u4e86\u3002\n\n\u7b2c\u4e00\u6b21\u5199\u9898\u89e3\uff0c\u5c3d\u91cf\u8be6\u7ec6\u4e86\uff0c\u5199\u7684\u4e0d\u597d\u8bf7\u65a7\u6b63\uff08\u97a0\u8eac\uff09\u3002\n```cpp\n#include<iostream>\n#include<cstdio>\n#define MOD 10007\n#define N 200005\nusing namespace std;\nint n,u[N],v[N],a[N],sum[N],res[N],fir[N],sec[N],ans1,ans2;\nvoid init(int x,int y)\n{\n\t(sum[x]+=a[y])%MOD;(res[x]+=(1LL*a[y]*a[y])%MOD)%MOD;\n\tif(a[y]>=fir[x]) sec[x]=fir[x],fir[x]=a[y];\n\telse sec[x]=max(sec[x],a[y]);\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<n;i++) scanf(\"%d%d\",&u[i],&v[i]);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\tfor(int i=1;i<n;i++) init(u[i],v[i]),init(v[i],u[i]);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tans1=max(ans1,fir[i]*sec[i]);\n\t\t(ans2+=(1LL*sum[i]*sum[i])%MOD-res[i]+MOD)%MOD;\n\t}\n\tprintf(\"%d %d\\n\",ans1,ans2%MOD);\n\treturn 0;\n} \n```",
        "postTime": 1536744078,
        "uid": 61312,
        "name": "\u54aa\u55f7\u545c\u55b5",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "###### \u65e0\u5411\u8fde\u901a\u56fe G \u6709 n \u4e2a\u70b9\uff0c n\u22121 \u6761\u8fb9\u3002\u70b9\u4ece 1 \u5230 n \u4f9d\u6b21\u7f16\u53f7,\u7f16\u53f7\u4e3a i \u7684\u70b9\u7684\u6743\u503c\u4e3a W i\uff0c\u6bcf\u6761\u8fb9\u7684\u957f\u5ea6\u5747\u4e3a 1 \u3002\u56fe\u4e0a\u4e24\u70b9 (u,v) \u7684\u8ddd\u79bb\u5b9a\u4e49\u4e3a u \u70b9\u5230 v \u70b9\u7684\u6700\u77ed\u8ddd\u79bb\u3002\u5bf9\u4e8e\u56fe G \u4e0a\u7684\u70b9\u5bf9 (u,v) \uff0c\u82e5\u5b83\u4eec\u7684\u8ddd\u79bb\u4e3a 2\uff0c\u5219\u5b83\u4eec\u4e4b\u95f4\u4f1a\u4ea7\u751f W v\u00d7W u\u7684\u8054\u5408\u6743\u503c\u3002\n### \u9898\u76ee\u4e2d\u8bf4\u4e86\u8fd9\u4e48\u591a\u5176\u5b9e\u5c31\u662f\u8bf4\uff1a\u6709\u4e00\u68f5\u6811\uff0c\u6c42\u6bcf\u4e2a\u8282\u70b9\u53ef\u4ee5\u5230\u8fbe\u7684\u8282\u70b9\u4e24\u4e24\u76f8\u4e58\u7684\u6700\u5927\u503c\u548c\u548c\n#### \u2235(a+b+c)^2=a*a+b*b+c*c++2*a*b+2*a*c+2*b*c  \uff08\u53ef\u4ee5\u6269\u5c55\u5230\u66f4\u591a\u6570\uff09\n#### \u2234a*b+a*c+b*c=(a+b+c)^2-a*a-b*b-c*c\n## \u7b2c\u4e8c\u95ee\n```cpp\nint ans2=0;\nfor(int i=1;i<=n;i++)\n\t\tif(a[i].size()>1)\n\t\t{\n\t\t\tlong long c=0,p=0;\n\t\t\tfor(int j=a[i].size()-1;j>=0;j--)\n\t\t\t{\n\t\t\t\tp+=w[a[i][j]];\n\t\t\t\tc+=w[a[i][j]]*w[a[i][j]];\n\t\t\t}\n\t\t\tp=p*p-c;\n\t\t\tp%=10007;\n\t\t\tans2+=p;\n\t\t\tans2%=10007;\n\t\t}\n```\n#### \u7b2c\u4e00\u95ee\u66f4\u7b80\u5355\uff0c\u53ea\u8981\u6c42\u6bcf\u4e2a\u8282\u70b9\u76f8\u8fde\u7684\u8282\u70b9\u4e2d\u7684\u6700\u5927\u503c\u548c\u6b21\u5927\u503c\u7684\u79ef\u7684\u6700\u5927\u503c\u5373\u53ef\n```cpp\nint ans1=0;\nfor(int i=1;i<=n;i++)\n\t\tif(a[i].size()>1)\n\t\t{\n\t\t\tint max1=0,max2=0;\n\t\t\tfor(int j=a[i].size()-1;j>=0;j--)\n\t\t\t{\n\t\t\t\tif(w[a[i][j]]>max1)\n\t\t\t\t{\n\t\t\t\t\tmax2=max1;\n\t\t\t\t\tmax1=w[a[i][j]];\n\t\t\t\t}\n\t\t\t\telse if(w[a[i][j]]>max2)max2=w[a[i][j]];\n\t\t\t}\n\t\t\tans1=max(ans1,max1*max2);\n\t\t}\n```\n## \u6700\u540e\u9644\u4e0a\u6574\u5408\u540e\u7684\u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n;\nvector<int>a[200001];\nint w[200001];\nint main()\n{\n\tios::sync_with_stdio(0);\n\tcin>>n;\n\tint x,y;\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tcin>>x>>y;\n\t\ta[x].push_back(y);\n\t\ta[y].push_back(x);\n\t}\n\tfor(int i=1;i<=n;i++)\n\t\tcin>>w[i];\n\tint ans1=0,ans2=0;\n\tfor(int i=1;i<=n;i++)\n\t\tif(a[i].size()>1)\n\t\t{\n\t\t\tint max1=0,max2=0;\n\t\t\tlong long c=0,p=0;\n\t\t\tfor(int j=a[i].size()-1;j>=0;j--)\n\t\t\t{\n\t\t\t\tif(w[a[i][j]]>max1)\n\t\t\t\t{\n\t\t\t\t\tmax2=max1;\n\t\t\t\t\tmax1=w[a[i][j]];\n\t\t\t\t}\n\t\t\t\telse if(w[a[i][j]]>max2)max2=w[a[i][j]];\n\t\t\t\tp+=w[a[i][j]];\n\t\t\t\tc+=w[a[i][j]]*w[a[i][j]];\n\t\t\t}\n\t\t\tp=p*p-c;\n\t\t\tp%=10007;\n\t\t\tans2+=p;\n\t\t\tans2%=10007;\n\t\t\tans1=max(ans1,max1*max2);\n\t\t}\n\tcout<<ans1<<\" \"<<ans2;\n\treturn 0;\n}\n```",
        "postTime": 1533716275,
        "uid": 70310,
        "name": "wuzhaoxin",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "** _2018.6.12\u4e2d\u5348 \u534e\u5e08\u4e00\u673a\u623f_ **\n\n\n------------\n\n\u539f\u9898\uff1a[P1351 \u8054\u5408\u6743\u503c](https://www.luogu.org/problemnew/show/P1351)\n\n### \u9898\u76ee\u63cf\u8ff0\n\n\u65e0\u5411\u8fde\u901a\u56fe _G_ \u6709 _n_ \u4e2a\u70b9\uff0c _n\u22121_ \u6761\u8fb9\u3002\u70b9\u4ece _1_ \u5230 _n_ \u4f9d\u6b21\u7f16\u53f7,\u7f16\u53f7\u4e3a _i_ \u7684\u70b9\u7684\u6743\u503c\u4e3a _W(i)_ \uff0c\u6bcf\u6761\u8fb9\u7684\u957f\u5ea6\u5747\u4e3a _1_ \u3002\u56fe\u4e0a\u4e24\u70b9 _(u,v)_ \u7684\u8ddd\u79bb\u5b9a\u4e49\u4e3a _u_ \u70b9\u5230 _v_ \u70b9\u7684\u6700\u77ed\u8ddd\u79bb\u3002\u5bf9\u4e8e\u56fe _G_ \u4e0a\u7684\u70b9\u5bf9 _(u,v)_ \uff0c\u82e5\u5b83\u4eec\u7684\u8ddd\u79bb\u4e3a _2_ \uff0c\u5219\u5b83\u4eec\u4e4b\u95f4\u4f1a\u4ea7\u751f _W(v)\u00d7W(u)_ \u7684\u8054\u5408\u6743\u503c\u3002\n\n\u8bf7\u95ee\u56fe _G_ \u4e0a\u6240\u6709\u53ef\u4ea7\u751f\u8054\u5408\u6743\u503c\u7684\u6709\u5e8f\u70b9\u5bf9\u4e2d\uff0c\u8054\u5408\u6743\u503c\u6700\u5927\u7684\u662f\u591a\u5c11\uff1f\u6240\u6709\u8054\u5408\u6743\u503c\u4e4b\u548c\u662f\u591a\u5c11\uff1f\n\n### \u8f93\u5165\u8f93\u51fa\u683c\u5f0f\n\n\u8f93\u5165\u683c\u5f0f\uff1a\n\n\u7b2c\u4e00\u884c\u5305\u542b _1_ \u4e2a\u6574\u6570 _n_ \u3002\n\n\u63a5\u4e0b\u6765 _n-1_ \u884c,\u6bcf\u884c\u5305\u542b _2_ \u4e2a\u7528\u7a7a\u683c\u9694\u5f00\u7684\u6b63\u6574\u6570 _u,v_ \uff0c\u8868\u793a\u7f16\u53f7\u4e3a _u_ \u548c\u7f16\u53f7\u4e3a _v_ \u7684\u70b9\u4e4b\u95f4\u6709\u8fb9\u76f8\u8fde\u3002\n\n\u6700\u540e _1_ \u884c,\u5305\u542b _n_ \u4e2a\u6b63\u6574\u6570\uff0c\u6bcf\u4e24\u4e2a\u6b63\u6574\u6570\u4e4b\u95f4\u7528\u4e00\u4e2a\u7a7a\u683c\u9694\u5f00\uff0c\u5176\u4e2d\u7b2c _i_ \u4e2a\u6574\u6570\u8868\u793a\u56fe _G_ \u4e0a\u7f16\u53f7\u4e3a _i_ \u7684\u70b9\u7684\u6743\u503c\u4e3a _W(i)_ \u3002\n\n\u8f93\u51fa\u683c\u5f0f\uff1a\n\n\u8f93\u51fa\u5171 _1_ \u884c,\u5305\u542b _2_ \u4e2a\u6574\u6570\uff0c\u4e4b\u95f4\u7528\u4e00\u4e2a\u7a7a\u683c\u9694\u5f00,\u4f9d\u6b21\u4e3a\u56fe _G_ \u4e0a\u8054\u5408\u6743\u503c\u7684\u6700\u5927\u503c\u548c\u6240\u6709\u8054\u5408\u6743\u503c\u4e4b\u548c\u3002\u7531\u4e8e\u6240\u6709\u8054\u5408\u6743\u503c\u4e4b\u548c\u53ef\u80fd\u5f88\u5927\uff0c\u8f93\u51fa\u5b83\u65f6\u8981\u5bf9 _10007_ \u53d6\u4f59\u3002\n\n\u8f93\u5165\u8f93\u51fa\u6837\u4f8b\n\n\u8f93\u5165\u6837\u4f8b#1\uff1a \n\n```\n5  \n1 2  \n2 3\n3 4  \n4 5  \n1 5 2 3 10\n```\n\n\u8f93\u51fa\u6837\u4f8b#1\uff1a \n\n```\n20 74\n```\n\n### \u8bf4\u660e\n\n![](https://cdn.luogu.com.cn/upload/pic/1347.png)\n\n\u672c\u4f8b\u8f93\u5165\u7684\u56fe\u5982\u4e0a\u6240\u793a\uff0c\u8ddd\u79bb\u4e3a _2_ \u7684\u6709\u5e8f\u70b9\u5bf9\u6709 _(1,3)_ \u3001 _(2,4)_ \u3001 _(3,1)_ \u3001 _(3,5)_ \u3001 _(4,2)_ \u3001 _(5,3)_ \u3002\n\n\u5176\u8054\u5408\u6743\u503c\u5206\u522b\u4e3a2\u300115\u30012\u300120\u300115\u300120\u3002\u5176\u4e2d\u6700\u5927\u7684\u662f20\uff0c\u603b\u548c\u4e3a74\u3002\n\n\u3010\u6570\u636e\u8bf4\u660e\u3011\n\n\u5bf9\u4e8e30%\u7684\u6570\u636e\uff0c1<n\u2264100\uff1b\n\n\u5bf9\u4e8e60%\u7684\u6570\u636e\uff0c1<n\u22642000\uff1b\n\n\u5bf9\u4e8e100%\u7684\u6570\u636e\uff0c1<n\u2264200000,0<W(i)\u226410000\u3002\n\n\u4fdd\u8bc1\u4e00\u5b9a\u5b58\u5728\u53ef\u4ea7\u751f\u8054\u5408\u6743\u503c\u7684\u6709\u5e8f\u70b9\u5bf9\u3002\n\n------------\n\n#### \u6ce8\uff1a2014 NOIP D2T2\n\n## \u66b4\u529b\u6a21\u62df\u601d\u8def(\u4e0d\u4f18\u5316)\n\n _n_ \u4e2a\u70b9 _n-1_ \u6761\u8fb9\u7684\u56fe\uff0c\u662f\u4e00\u68f5\u6ca1\u6709\u73af\u7684\u6811\uff0c\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u5b83\u7684\u6bcf\u4e24\u4e2a\u4e0e\u5b83\u76f8\u8fde\u7684\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u90fd\u4e3a _2_ (\u53ef\u4ee5\u8bc1\u660e\uff0c\u8fd9\u4e24\u4e2a\u70b9\u4e0d\u53ef\u80fd\u76f4\u63a5\u76f8\u8fde)\u3002\n \n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u9010\u70b9\u627e\u8fd9\u4e24\u4e2a\u70b9\uff0c\u4e00\u904d\u904d\u5730\u8bbf\u95ee\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 _O(n^2)_ \u3002\n\n| \u7a0b\u5e8f\u8017\u65f6 | \u5360\u7528\u5185\u5b58 | \u6700\u7ec8\u5f97\u5206 |\n| :----------: | :----------: | :----------: |\n| 6252ms | 13648KB | 60(4TLE) |\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#include<vector>\n#define max(a,b) a>b?a:b ///\u6ce8\u610f:iostream\u5e93\u4e2d\u5185\u7f6e\u6bd4\u8f83\u51fd\u6570max\u548cmin,\u4f46\u662fcstdio\u4e0d\u81ea\u5e26\nusing namespace std;\nconst int P=10007;///\u53d6\u819c\u6570\nconst int MAXN=200005;\nint n,x,y,w[MAXN],ans1,ans2;\nvector<int>G[MAXN];///\u90bb\u63a5\u8868\u50a8\u5b58\u8def\u5f84\nint read()///\u5feb\u8bfb\u4f18\u5316(\u6ca1\u4ec0\u4e48\u5375\u7528,\u8fd8\u662fTLE)\n{\n    int re=0;\n    char ch=getchar();\n    while(ch<'0'||ch>'9') ch=getchar();\n    while(ch>='0'&&ch<='9') re=re*10+ch-'0',ch=getchar();\n    return re;\n}\nint main()\n{\n    n=read();\n    for(int i=1;i<n;i++)\n    {\n        x=read(),y=read();\n        G[x].push_back(y);///\u53cc\u5411\u8fb9\n        G[y].push_back(x);///\u5efa\u4e24\u904d\n    }\n    for(int i=1;i<=n;i++)\n        w[i]=read();\n    for(int i=1;i<=n;i++)\n        for(int j=0;j<G[i].size();j++)\n            for(int k=0;k<G[i].size();k++)///\u4e09\u5c42\u5faa\u73af\u679a\u4e3e\u6bcf\u4e00\u6761\u8fb9\n                if(j!=k)\n                {\n                    int tmp=w[G[i][j]]*w[G[i][k]];\n                    ans1=max(ans1,tmp);\n                    ans2+=tmp;\n                    ans2%=P;\n                }\n    printf(\"%d %d\",ans1,ans2);\n    return 0;\n}\n\n```\n\n\u4f18\u70b9\uff1a\u597d\u60f3\u3002\n\n\u7f3a\u70b9\uff1a\u6ca1\u5206\uff08\u53ef\u4ee5\u8bf4\u662f\u7f3a\u70b9\u5f88\u5927\u4e86\uff09\n\n------------\n\n## LCA\u601d\u8def\n\n\u5373\u6700\u8fd1\u516c\u5171\u7956\u5148\u7b97\u6cd5\u3002\u6ca1\u6709\u627e\u5230\u535a\u5ba2\u4e0a\u5bf9\u8fd9\u4e2a\u7b97\u6cd5\u7684\u5f88\u597d\u89e3\u91ca\uff0c\u53ef\u4ee5\u53c2\u9605lyd\u795e\u4ed9\u7684\u300a\u7b97\u6cd5\u7ade\u8d5b\u8fdb\u9636\u6307\u5357\u300b\u4e2d\u7684\u300a0x63 \u6811\u7684\u76f4\u5f84\u4e0e\u6700\u8fd1\u516c\u5171\u7956\u5148\u300b\u4e00\u8282\u3002\n\n\u603b\u7684\u601d\u8def\u5c31\u662f\u4ee5\u4efb\u610f\u4e00\u70b9\u4f5c\u4e3a\u6811\u7684\u6839\u8282\u70b9 _root_ \uff0c\u7136\u540e\u4ece\u6839\u8282\u70b9\u5f00\u59cb\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u6bcf\u4e00\u4e2a\u70b9\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u5b83\u7684\u5b50\u8282\u70b9\u4e4b\u95f4\u3001\u6bcf\u4e00\u4e2a\u5b50\u8282\u70b9\u548c\u5b83\u7684\u7236\u8282\u70b9\u4e4b\u95f4\u90fd\u6709\u8054\u5408\u6743\u503c\u3002\u90a3\u4e48\u6211\u4eec\u4ee5 _d_ \u6570\u7ec4\u50a8\u5b58\u8be5\u70b9\u6df1\u5ea6\uff08\u4e8b\u5b9e\u4e0a\u53ef\u4ee5\u7b80\u5355\u4e00\u70b9\uff0c\u7528 _vis_ \u6570\u7ec4\u50a8\u5b58\u662f\u5426\u8bbf\u95ee\u8fc7\u8be5\u8282\u70b9\uff09\uff0c\u7528 _f_ \u4e8c\u7ef4\u6570\u7ec4\u50a8\u5b58\u8be5\u70b9\u7684\u7236\u8282\u70b9\u4e0e\u7236\u8282\u70b9\u7684\u7236\u8282\u70b9\u3002\n\n\u5176\u4e2d\uff0c _f(i,0)_ \u8868\u793a\u8282\u70b9 _i_ \u7684\u7236\u8282\u70b9\uff0c _f(i,1)_ \u8868\u793a\u8282\u70b9 _i_ \u7684\u7236\u8282\u70b9\u7684\u7236\u8282\u70b9\u3002\u8bb2\u6c42\u539f\u7406\u7684\u8bdd\uff0c\u5176\u5b9e\u662f\u5728 _LCA_ \u7684\u500d\u589e\u7b97\u6cd5\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528 _f(i,j)_ \u8868\u793a\u8282\u70b9 _i_ \u5411\u4e0a\u79fb\u52a82^j\u5c42\u540e\u7684\u70b9\u3002\u5176\u4e2d\uff0c\u7531\u4e8e\u4e8c\u8fdb\u5236\u7684\u7279\u70b9\uff0c\u8be5\u7b97\u6cd5\u6709\u4e2a\u5f88\u5de7\u5999\u7684\u8fd0\u7b97\u516c\u5f0f\uff1a\n\n![](https://cdn.luogu.com.cn/upload/pic/20981.png)\n\n\u6709\u5174\u8da3\u7684\u8bdd\u53ef\u4ee5\u60f3\u4e00\u60f3\u3002\n\n\u90a3\u4e48\uff0c\u8282\u70b9 _node_ \u548c\u8282\u70b9 _f(node,1)_ \u4e4b\u95f4\u7684\u8054\u5408\u6743\u503c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u6c42\u51fa\uff0c\u800c\u540c\u4e00\u8282\u70b9\u7684\u4e24\u4e2a\u5b50\u8282\u70b9\u7684\u8054\u5408\u6743\u503c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u65b9\u6cd5\u6c42\u51fa\uff1a\n\n\u5728\u904d\u5386 _i_ \u70b9\u65f6\uff0c\u5047\u8bbe\u6b63\u5728\u8bbf\u95ee\u5176\u7b2c _j_ \u4e2a\u5b50\u8282\u70b9\uff0c\u7528\u53d8\u91cf _sum_ \u50a8\u5b58\u7b2c _1~j-1_ \u4e2a\u5b50\u8282\u70b9\u7684\u6743\u503c\u548c\uff0c\u7528\u53d8\u91cf _maxa_ \u50a8\u5b58\u7b2c _1~j-1_ \u4e2a\u5b50\u8282\u70b9\u7684\u6743\u503c\u6700\u5927\u503c\uff0c\u90a3\u4e48\u7b2c _j_ \u5b50\u8282\u70b9\u4e0e\u524d _j-1_ \u4e2a\u70b9\u7684\u8054\u5408\u6743\u503c\u4e4b\u548c\u4e3aw(i) \u00d7 sum\u3002\u5f97\u89e3\u3002\n\n| \u7a0b\u5e8f\u8017\u65f6 | \u5360\u7528\u5185\u5b58 | \u6700\u7ec8\u5f97\u5206 |\n| :----------: | :----------: | :----------: |\n| 352ms | 15847KB | 100 |\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#include<vector>\n#define max(a,b) a>b?a:b\nusing namespace std;\nconst int P=10007;\nconst int MAXN=200005;\nint n,x,y,w[MAXN];\nint d[MAXN],f[MAXN][2];///\u4e24\u4e2a\u6570\u7ec4\u7684\u610f\u4e49\u5728\u4e0a\u6587\u4e2d\u5df2\u7ecf\u7ed9\u51fa\nint ans1,ans2;\nvector<int>G[MAXN];\ninline int read()///\u4f9d\u65e7\u662f\u5feb\u8bfb\n{\n    int re=0;\n    char ch=getchar();\n    while(ch<'0'||ch>'9') ch=getchar();\n    while(ch>='0'&&ch<='9') re=re*10+ch-'0',ch=getchar();\n    return re;\n}\nvoid LCA(int now)///\u4e3b\u4f53\n{\n    int sum=0,maxa=0;\n    for(int i=0;i<G[now].size();i++)\n    {\n        int hjj=G[now][i];\n        if(d[hjj]) continue;///\u8bbf\u95ee\u8fc7,\u5373\u6b64\u65f6\u7684\u8282\u70b9\u4e3a\u8282\u70b9now\u7684\u7236\u8282\u70b9,\u4e0d\u8fdb\u884c\u8bbf\u95ee\n        d[hjj]=d[now]+1;///\u6807\u8bb0\u6df1\u5ea6\n        f[hjj][0]=now;\n        f[hjj][1]=f[now][0];///\u4fee\u6539f\u6570\u7ec4\n        int tmp=w[hjj]*w[f[hjj][1]];///\u6c42\u8be5\u6709\u5e8f\u70b9\u5bf9\u7684\u8054\u5408\u6743\u503c\n        ans1=max(ans1,tmp);\n        ans1=max(ans1,maxa*w[hjj]);///\u66f4\u65b0\u7b2c\u4e00\u4e2a\u7b54\u6848\n        maxa=max(maxa,w[hjj]);///\u66f4\u65b0maxa\n        ans2+=tmp%P;\n        ans2+=sum*w[hjj]%P;\n        ans2%=P;///\u66f4\u65b0\u7b2c\u4e8c\u4e2a\u7b54\u6848(\u8bb0\u5f97\u53d6\u6a21)\n        sum+=w[hjj];\n        sum%=P;///\u66f4\u65b0sum\n        LCA(hjj);///\u6df1\u5ea6\u904d\u5386\n    }\n}\nint main()\n{\n    n=read();\n    for(int i=1;i<n;i++)\n    {\n        x=read(),y=read();\n        G[x].push_back(y);\n        G[y].push_back(x);\n    }\n    for(int i=1;i<=n;i++)\n        w[i]=read();\n    d[1]=1;///\u7b2c\u4e00\u4e2a\u70b9\u7684\u6df1\u5ea6\u663e\u7136\u4e3a1\n    LCA(1);\n    printf(\"%d %d\",ans1,ans2*2%P);///\u56e0\u4e3a\u6bcf\u7ec4\u6709\u5e8f\u70b9\u5bf9\u6211\u4eec\u90fd\u53ea\u8bbf\u95ee\u4e86\u4e00\u6b21,\u4f46\u663e\u7136\u5e94\u8be5\u8bbf\u95ee\u4e24\u6b21,\u6240\u4ee5\u8f93\u51fa\u7b2c\u4e8c\u4e2a\u503c\u4e4b\u524d\u8981\u5148\u4e582\n    return 0;\n}\n\n```\n\n\u4f18\u70b9\uff1a\u6ee1\u5206\u4e0d\u662f\u4f18\u70b9\u7684\u8bdd\u8fd8\u6709\u4ec0\u4e48\u662f\u4f18\u70b9\uff1f\n\n------------\n\n## \u66b4\u529b\u6a21\u62df\u601d\u8def(\u4f18\u5316)\n\n\u6839\u636eLCA\u601d\u8def\uff0c\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u679a\u4e3e\u6bcf\u4e2a\u6709\u5e8f\u70b9\u5bf9\u3002\u6240\u4ee5\u53ef\u4ee5\u7528LCA\u51fd\u6570\u4e2d\u7684\u65b9\u5f0f\u5bf9ans1\u548cans2\u8fdb\u884c\u66f4\u65b0\u3002\n\n| \u7a0b\u5e8f\u8017\u65f6 | \u5360\u7528\u5185\u5b58 | \u6700\u7ec8\u5f97\u5206 |\n| :----------: | :----------: | :----------: |\n| 388ms | 15277KB | 100 |\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#include<vector>\n#define max(a,b) a>b?a:b\nusing namespace std;\n#define P 10007\n#define MAXN 200005\nlong long n,x,y,w[MAXN],ans1,ans2;\nvector<long long>G[MAXN];\nlong long read()\n{\n    long long re=0;\n    char ch=getchar();\n    while(ch<'0'||ch>'9') ch=getchar();\n    while(ch>='0'&&ch<='9') re=re*10+ch-'0',ch=getchar();\n    return re;\n}\nint main()\n{\n    n=read();\n    for(long long i=1;i<n;i++)\n    {\n        x=read(),y=read();\n        G[x].push_back(y);\n        G[y].push_back(x);\n    }\n    for(long long i=1;i<=n;i++)\n        w[i]=read();\n    for(long long i=1;i<=n;i++)\n    {\n        long long sum=0,maxa=0;\n        for(long long j=0;j<G[i].size();j++)\n        {\n            long long tmp=w[G[i][j]]*sum;\n            ans1=max(ans1,w[G[i][j]]*maxa);\n            maxa=max(maxa,w[G[i][j]]);\n            ans2+=tmp%P;\n            ans2%=P;\n            sum+=w[G[i][j]];\n        }\n    }\n    printf(\"%lld %lld\",ans1,ans2*2%P);\n    return 0;\n}\n\n```\n\n\u4f18\u70b9\uff1a\u5199\u5f97\u5feb\u7206\u4e86\u3002\n\n\u7f3a\u70b9\uff1a\u53d1\u73b0\u4e86\u4e00\u4e2a\u795e\u5947\u7684\u73b0\u8c61\uff1a\n\n\u56e0\u4e3a\u6211\u4e0d\u4f1a\u6253 _printf_ \uff0c\u6240\u4ee5\u7b2c\u4e00\u6b21\u6253\u6210\u4e86\uff1a\n\n```\nprintf(\"%ld %ld\",ans1,ans2*2%P);\n```\n\n\u7ed3\u679c _ans2*2%P_ \u4e0d\u8f93\u51fa\uff1f\uff1f\uff1f\n\n\u7136\u540e\u6211\u6539\u6210\u4e86\uff1a\n\n```\nprintf(\"%ld \",ans1);\nprintf(\"%ld\",ans2*2%P);\n```\n\n\u5c31\u8f93\u51fa\u6b63\u786e\u4e86\uff1f\uff1f\uff1f\n\n\uff1f\uff1f\uff1f\n\n\u770b\u6765\u683c\u5f0f\u5316\u8f93\u51fa\u7684\u8bb8\u591a\u7279\u6027\u8fd8\u6709\u5f85\u53d1\u6398\u2026\u2026",
        "postTime": 1528778005,
        "uid": 51983,
        "name": "Uranus",
        "ccfLevel": 4,
        "title": "\u3010\u9898\u76ee\u603b\u7ed3\u3011P1351 \u8054\u5408\u6743\u503c"
    },
    {
        "content": "\u9996\u5148\u8fd9\u662f\u4e00\u68f5\u6811\uff08\u4e0d\u7136\u6211\u4e0d\u4f1a\u505a\uff09\n\n\u7136\u540e\u9898\u76ee\u8981\u6c42\u4e24\u70b9\u7684\u8ddd\u79bb\u5fc5\u987b\u662f2\uff08\u4e0d\u7136\u9700\u8981\u70b9\u5206\u6cbb/\u542f\u53d1\u5f0f\u5408\u5e76\u5e73\u8861\u6811\uff08\u6211\u4e5f\u4e0d\u4f1a\u505a\uff09\uff09\n\n\u4e00\u822c\u8fd9\u79cd\u9898\u5c31\u662f\u8003\u8651\u201c\u8d21\u732e\u201d\u4e86\n\n\u540c\u7b49\u4e8e\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u4e0e\u5b83\u8ddd\u79bb\u4e3a2\u7684\u70b9\u4f1a\u6709\u8d21\u732e\uff08\u4f46\u8fd9\u4e48\u505a\u4f1aTLE\uff09\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u5b83\u7684\u7237\u7237\u4e0e\u5b83\u4f1a\u4ea7\u751f\u8d21\u732e\uff08\u56e0\u4e3a\u5b83\u7684\u7237\u7237\u8bbf\u95ee\u5b83\u548c\u5b83\u8bbf\u95ee\u7237\u7237\u5b9e\u9645\u4e0a\u662f\u4e00\u7ec4\u70b9\u5bf9\uff09\n\n\u6216\u8005\u67d0\u4e00\u4e2a\u70b9\u4f5c\u4e3a\u4e2d\u8f6c\uff0c\u5b83\u7684\u4e24\u4e2a\u76f4\u5c5e\u7684\u4e0d\u540c\u7684\u513f\u5b50\u4f5c\u4e3a\u4e00\u6b21\u8d21\u732e\n\n\u7136\u540e\u7528\u7d2f\u8ba1\u548c\u516c\u5f0f\u53ef\u4ee5\u505a\u5230O\uff08len\uff09\u5408\u5e76\u67d0\u4e00\u4e2a\u8282\u70b9\u6240\u76f4\u5c5e\u7684\u513f\u5b50\u4eec\n\n\u6ce8\u610f\u9898\u610f\u662f\u8bf4\u6709\u5e8f\u70b9\u5bf9\uff0c\u6700\u540esum\u9700\u8981\u4e58\u4ee5\u4e8c\n\n\n```cpp\n#include <iostream>\n#include <algorithm>\n#include <cstdio>\n#include <cstring>\n#include <cstdlib>\n\nusing namespace std;\n\nconst int N = 400010;\n\ntypedef long long ll;\n\nint head[N], rest[N], to[N], tot;\n\nll w[N];\n\nvoid add(int u, int v) {\n    ++ tot;\n    to[tot] = v;\n    rest[tot] = head[u];\n    head[u] = tot;\n}\n\nint fa[N];\n\nconst ll mod = 10007LL;\n\nll ans = 0xcfcfcfcfcfcfcfcfLL, sum;\n\nint n;\n\n/*\n * 1. \u5f80\u4e0a\u8d70\u5230\u7237\u7237\u8282\u70b9\u65f6\u7684\u8d21\u732e\n * 2. \u6240\u6709\u513f\u5b50\u4e2d\u53d6\u4e24\u4e2a\u4e0d\u540c\u5f97\u8282\u70b9\u7684\u8d21\u732e\n */\n\nvoid dfs(int u) {\n    ll ret = 0, cnt = 0;\n    ll mx = -1, smx = -1;\n    if(fa[fa[u]]) {\n        ret = (ret + w[u] * w[fa[fa[u]]]) % mod;\n        ans = max(ans, w[u] * w[fa[fa[u]]]);\n    }\n    for(int i = head[u] ; i ; i = rest[i]) {\n        int v = to[i];\n        if(v != fa[u]) {\n            fa[v] = u;\n            dfs(v);\n            ret = (ret + cnt * w[v]) % mod;\n            cnt = (cnt + w[v]) % mod;\n            if(w[v] >= mx) {\n                smx = mx;\n                mx = w[v];\n            } else if(w[v] >= smx) {\n                smx = w[v];\n            }\n        }\n    }\n    if(smx != -1) {\n        ans = max(ans, mx * smx);\n    }\n    sum = (sum + ret) % mod;\n}\n\nint main() {\n    scanf(\"%d\", &n);\n    for(int i = 1, u, v ; i < n ; ++ i) {\n        scanf(\"%d%d\", &u, &v);\n        add(u, v);\n        add(v, u);\n    }\n    for(int i = 1 ; i <= n ; ++ i) {\n        scanf(\"%lld\", &w[i]);\n    }\n    dfs(1);\n    printf(\"%lld %lld\\n\", ans, sum * 2 % mod);\n}\n```",
        "postTime": 1508313568,
        "uid": 47111,
        "name": "nekko",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u770b\u6ca1\u6709\u6811\u5f62dp\uff0c\u6211\u6765\u53d1\u4e00\u4e2a\n\n\u4e0d\u8fc7\u6811\u5f62dp\u786e\u5b9e\u4e0d\u5982\u7528\u4e58\u6cd5\u7ed3\u5408\u5f8b\u5199\u597d\u61c2\n\n\u4ee3\u7801\u6ce8\u91ca\u5f88\u8be6\u7ec6\u4e86\uff0c\u5e0c\u671b\u8bfb\u8005\u597d\u597d\u7406\u89e3\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#define mod 10007\nusing namespace std;\nlong long dp[200005],maxn[200005],sum[200005],mx[200005],w[200005];\n//dp[u] \u4ee5u\u4e3a\u6839\u7684\u5b50\u6811\u7684\u8054\u5408\u6743\u503c\u4e4b\u548c\uff0c maxn[u]\u4ee5u\u4e3a\u6839\u7684\u5b50\u6811\u7684\u8054\u5408\u6743\u503c\u6700\u5927\u503c\n//sum[u] u\u7684\u513f\u5b50\u7684\u6743\u503c\u548c\uff0cmx[u] u\u7684\u513f\u5b50\u6743\u503c\u7684\u6700\u5927\u503c \nint n,to[400005],nextt[400005],head[400005],tot;\n//  \u5b58\u56fe \nvoid add(int a,int b)\n{\n    to[++tot]=b;\n    nextt[tot]=head[a];\n    head[a]=tot;\n}\n\nvoid dfs(int u,int fa)\n{\n    for(int i=head[u];i;i=nextt[i])\n    {\n        if(to[i]==fa)continue;\n        dfs(to[i],u);  //\u6ce8\u610f \u5148dfs\u518d\u66f4\u65b0 \n        mx[u]=max(mx[u],w[to[i]]);     \n        sum[u]=(sum[u]+w[to[i]])%mod;// \u66f4\u65b0u\u7684sum[u],mx[u] \n        maxn[u]=max(maxn[u],maxn[to[i]]);  // \u7528\u513f\u5b50\u7684\u4fe1\u606f\u66f4\u65b0maxn[u]\n        maxn[u]=max(maxn[u],w[u]*mx[to[i]]);  // \u5b59\u5b50\u7684\u6700\u5927\u503c*w[u] \n        dp[u]=(w[u]*sum[to[i]]+dp[u])%mod;    //\u5b59\u5b50\u6743\u804c\u548c*w[u] \n        dp[u]=(dp[u]+dp[to[i]])%mod;          //\u513f\u5b50\u7684\u8054\u5408\u6743\u503c\u548c \n    }\n    long long a=0,b=0;    //a\u4fdd\u5b58\u6700\u5927\u503c\uff0cb\u662f\u5df2\u7ecf\u904d\u5386\u7684\u70b9\u7684\u6743\u503c\u548c \n    for(int i=head[u];i;i=nextt[i])\n    {\n        if(to[i]==fa) continue;\n        maxn[u]=max(maxn[u],a*w[to[i]]);  //u\u4e3a\u4e2d\u8f6c\u70b9\u7684\u8054\u5408\u6743\u503c\u6700\u5927\u503c \n        dp[u]=(dp[u]+b*w[to[i]])%mod;     //\u89e3\u91ca\u4e00\u4e0b \u6bd4\u5982\u6709\u4e09\u4e2a\u513f\u5b50x,y,z.\u90a3\u4e48\u6c42\u7684\u503c\u5c31\u662f(y*x)+(z*y+z*x) \n                                          //\u5c31\u662f\u4ee5u\u4e3a\u4e2d\u8f6c\u70b9\u7684\u8054\u5408\u6743\u503c\u4e4b\u548c\u76841/2\uff0c\u8f93\u51fa\u65f6\u518d\u4e582\u5373\u53ef  \n        a=max(w[to[i]],a);\n        b=(b+w[to[i]])%mod;\n    }\n}\n\nint main()\n{\n    int a,b;\n    cin>>n;\n    for(int i=1;i<n;i++)\n    scanf(\"%d%d\",&a,&b),add(a,b),add(b,a);\n    for(int i=1;i<=n;i++)\n    scanf(\"%d\",&w[i]);\n    dfs(1,1);\n    cout<<maxn[1]<<\" \"<<(dp[1]<<1)%mod<<endl;\n    return 0;\n} \n```",
        "postTime": 1508156781,
        "uid": 36103,
        "name": "wxgwxg",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u9996\u5148\u7531 **n-1** \u6761\u8fb9\u53d1\u73b0\u8fd9\u662f\u4e00\u68f5\u6811\n\n\n\u7136\u540e\u8ddd\u79bb\u4e3a 2 \u7684\u4e24\u4e2a\u8282\u70b9\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\n\n\u4e00\u79cd\u662f \u4e24\u4e2a\u8282\u70b9\u5728 \u540c\u4e00\u6761\u5230\u6839\u7684\u94fe\u4e0a\n\n\u53e6\u4e00\u79cd\u662f \u4e24\u4e2a\u8282\u70b9\u5206\u522b\u4f5c\u4e3a \u4e00\u4e2a\u8282\u70b9\u7684\u4efb\u610f\u4e24\u4e2a\u513f\u5b50\n\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u60c5\u51b5 \u6211\u4eec\u53ea\u8981\u5904\u7406\u51fa \u67d0\u4e2a\u8282\u70b9 a \u524d\u9762\u5144\u5f1f\u7684\u548c\uff0c \u7136\u540e\u4e0ew[a] \u76f8\u4e58\u518d\u4e582\u5373\u53ef\u4fdd\u8bc1\u4e0d\u91cd\u4e0d\u6f0f\n\n\u800c\u8fd9\u79cd\u60c5\u51b5\u7684\u6700\u5927\u503c \u53ea\u8981\u627e\u5230\u8fd9\u4e2a\u8282\u70b9\u7684\u6700\u5927\u4e24\u4e2a\u513f\u5b50\u8282\u70b9\u5373\u53ef\n\n\u8be6\u89c1\u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#define max(a, b) ((a) > (b) ? (a) : (b))\n#define inf 2147483647\n#define mod 10007\nint n, m, cnt, ans, sum;\nstruct node{\n    int a, b, c, n;\n}d[400005];\nint h[200005], w[200005], s, fa[200005];\n//fread\u8d85\u5feb\u8bfb\u5165\uff0c \u4e0d\u662f\u91cd\u70b9= =\uff0c \u8981\u8fd0\u884c\u8bf7\u8bb2\u4ee5\u4e0b\u51e0\u884c\u6ce8\u91ca\u6389 \n```\n#undef v\n\n```cpp\nstruct io{\n    char ibuf[1<<24], *s;\n    int a[24];\n    io(){\n        fread(s = ibuf, 1, 1 << 24, stdin);\n    }\n    inline int read(){\n        register int u = 0;\n        while(*s < 48) s++;\n        while(*s > 32) u = u * 10 + * s++ - 48;\n        return u;\n    }\n}ip;\n#define read ip.read\n// \nvoid cr(int a, int b){\n    d[++cnt].a = a; d[cnt].b = b; d[cnt].n = h[a]; h[a] = cnt;\n}\nvoid dfs(int a, int f){\n    int i, b, max1, max2, s;\n    max1 = max2 = s = 0;\n    //\u5230\u6839\u8282\u70b9\u662f\u4e00\u6761\u94fe\u7684\u60c5\u51b5 \n    sum = (sum + 2 * w[a] * w[fa[f]]) % mod;\n    ans = max(ans, w[a] * w[fa[f]]);\n    //\n    for(i = h[a]; i; i = d[i].n){\n        b = d[i].b;\n        if(b == f) continue;\n        fa[b] = a;\n        //\u4e00\u4e2a\u8282\u70b9\u4efb\u610f\u4e24\u4e2a\u513f\u5b50\u7684\u60c5\u51b5 \n        sum = (sum + s * w[b] * 2) % mod;\n        s = (s + w[b]) % mod;\n        if(w[b] > max1) max2 = max1, max1 = w[b];\n        else if(w[b] > max2) max2 = w[b];\n        dfs(b, a);\n    }\n    //\u4e00\u4e2a\u8282\u70b9\u7684\u4e24\u4e2a\u6700\u5927\u7684\u513f\u5b50 \n    ans = max(ans, max1 * max2);\n}\nint main(){\n    int i, j, a, b;\n    n = read();\n    for(i = 1; i < n; i++){\n        a = read(); b = read();\n        cr(a, b); cr(b, a);\n    }\n    for(i = 1; i <= n; i++) w[i] = read();\n    dfs(1, 1);\n    printf(\"%d %d\", ans, sum);\n    return 0;\n}\n```",
        "postTime": 1507786871,
        "uid": 31619,
        "name": "Hzxleo4",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\uff08\u697c\u4e0b\u6709\u66f4\u9ad8\u7aef\u7684\u7b97\u6cd5\uff0c\u7136\u800c\u6211\u770b\u4e0d\u61c2\u3002\u3002\u3002\uff09\n\n\uff08\u5728\u4e0b\u849f\u84bb\uff0c\u5982\u6709\u9519\u8bef\uff0c\u8bf7\u5404\u4f4d\u5927\u4f6c\u6307\u6b63\uff09\n\n\u9996\u5148\u4e0d\u96be\u770b\u51fa\u5982\u679c\u8981\u6c42\u8054\u5408\u6743\u503c\u548c\u5fc5\u987b\u679a\u4e3e\u6240\u6709\u80fd\u4ea7\u751f\u8054\u5408\u6743\u503c\u7684\u60c5\u51b5\u3002\u53c8\u56e0\u4e3a\u4ea7\u751f\u8054\u5408\u6743\u503c\u7684\u4e24\u70b9u,v\u4e2d\u95f4\u80af\u5b9a\u95f4\u9694\u4e00\u70b9i\uff0c\u5e76\u4e14\u6211\u4eec\u53d1\u73b0\u5982\u679c\u4ee5u\u6216v\u4e3a\u8d77\u70b9\u679a\u4e3e\u60c5\u51b5\u7684\u8bdd\u5176\u6548\u7387\u662f\u5f88\u4f4e\u7684\u3002\u56e0\u6b64\u6211\u4eec\u9700\u8981\u679a\u4e3ei\u3002\n\n\u5bf9i\u6765\u8bf4\uff0c\u6240\u6709\u4e0e\u5b83\u76f8\u8fde\u7684\u70b9\u4e2d\u7684\u4efb\u610f\u4e24\u70b9\u90fd\u4f1a\u4ea7\u751f\u8054\u5408\u6743\u503c\u3002\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u679a\u4e3e\u6240\u6709\u4e0e\u4ed6\u76f8\u8fde\u7684\u70b9\u3002\u4f46\u6b64\u505a\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3an\u65b9\uff0c\u662f\u6211\u4eec\u4e0d\u80fd\u63a5\u6536\u7684\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u627e\u89c4\u5f8b\u3002\n\n\u8bbe\u4e0ei\u76f8\u8fde\u7684\u70b9\u7f16\u53f7\u5206\u522b\u4e3a1\u30012\u30013\u2026\u2026\uff0c\u70b91\u7684\u6743\u4e3aw1\uff0c\u90a3\u4e48\u6240\u4ea7\u751f\u7684\u8054\u5408\u6743\u503cS\u4e3aw1\\*w2+w2\\*w1+w1\\*w3+w3\\*w1+w\u2026\u2026\uff0c\u5316\u7b80\u5f97S=(w1\\*w2+w1\\*w3+w1\\*w4+w2\\*w3+w2\\*w4+w3\\*w4)\\*2\u540c\u65f6(w1+w2+w3+w4) \u00b2=w1\u00b2+w2\u00b2+w3\u00b2+w4\u00b2+2\\*(w1\\*w2+w1\\*w3+w1\\*w4+w2\\*w3+w2\\*w4+w3\\*w4)\uff1b\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u7edf\u8ba1\u70b91\u30012\u30013\u30014\u7684\u6743\u7684\u548csum\u548c\u6743\u7684\u5e73\u65b9\u548csumn\uff0ci\u70b9\u6240\u8fde\u7684\u70b9\u4ea7\u751f\u7684\u8054\u5408\u6743\u503cSi=sum-sumn\uff1b\u6700\u540e\u6c42S\u7684\u548c\u5373\u4e3a\u8054\u5408\u6743\u503c\u7684\u603b\u548c\u3002\n\n\u5bf9\u4e8e\u6700\u5927\u503c\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8bb0\u4f4f\u4e0ei\u76f8\u8fde\u7684\u70b9\u4e2d\u6743\u7684\u6700\u5927\u548c\u6b21\u5927\u503c\uff0c\u4e58\u79ef\u5373\u4e3ai\u76f8\u8fde\u7684\u70b9\u4e2d\u6700\u5927\u7684\u8054\u5408\u6743\u503cMaxi\u3002\n\n\u6700\u540e\u679a\u4e3ei\uff0c\u5728\u6240\u6709Maxi\u53d6\u6700\u5927\u5373\u4e3a\u6700\u5927\u8054\u5408\u6743\u503c\u3002\n\nPS\uff1a\u53ea\u9700\u5bf9\u548c\u53d6\u6a21\u3002\n\n##########################################\n\n\uff08\u9644\u4e00\u4e2a\u849f\u84bb\u7684\u4ee3\u7801\uff09\n\n\n\n\n\n\n\n    \n    \n    \n        \n        \n        \n        \n        \n            \n        \n    \n    \n        \n    \n    \n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\nconst int MAXN = 200050;\nlong long a[MAXN][4];\nint b[MAXN][2];\nlong long pos[MAXN];\nint main()\n{\n    int n;\n    int i,j;\n    int x,y;\n    long long sum,sumn,summ;\n    long long maxn;\n    long long fx,fy;\n    memset(a,0,sizeof(a)); \n    scanf(\"%d\",&n);\n    for(i=1;i<n;i++)\n    {\n        scanf(\"%d%d\",&b[i][0],&b[i][1]);\n    }\n    for(i=1;i<=n;i++)\n    {\n        scanf(\"%d\",&pos[i]);\n    }    \n    for(i=1;i<n;i++)\n    {    \n        x=b[i][0];\n        y=b[i][1];    \n        fx=pos[x];\n        fy=pos[y];\n        a[x][0]+=fy;\n        a[y][0]+=fx;\n        a[x][1]+=fy*fy;\n        a[y][1]+=fx*fx;\n        if(fy>a[x][2])\n        {\n            a[x][3]=a[x][2];\n            a[x][2]=fy;\n        }\n        else if(fy>a[x][3])\n        {\n            a[x][3]=fy;\n        }\n        if(fx>a[y][2])\n        {\n            a[y][3]=a[y][2];\n            a[y][2]=fx;\n        }\n        else if(fx>a[y][3])\n        {\n            a[y][3]=fx;\n        }\n    }\n    sum=0;\n    sumn=0;summ=0;\n    maxn=0;\n    for(i=1;i<=n;i++)\n    {\n        summ=(a[i][0]*a[i][0]-a[i][1]);\n        sum+=summ;\n        sum=sum % 10007;\n        sumn=a[i][2]*a[i][3];\n        if(sumn>maxn)\n        {\n            maxn=sumn;\n        }\n    }\n    printf(\"%lld %lld\",maxn,sum);\n    return 0;\n}\n##########################################\n```",
        "postTime": 1507174457,
        "uid": 23321,
        "name": "Macwyw",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u4f5c\u4e3a\u4e00\u540dpascal\u849f\u84bb\n\n\u7adf\u7136ac\u4e86\uff01\uff01\n\n\u8fd9\u9053\u9898\u5206\u4e3a\u4e24\u90e8\u5206\n\n\u6c42\u6700\u5927\u8054\u5408\u6743\u503c\u548c\u6c42\u548c\n\n\u5148\u60f3\u5230\uff1a\u5982\u679cj\uff0ck\u662fi\u7684\u90bb\u5c45\uff0c\u90a3\u4e48j\uff0ck\u8ddd\u79bb\u4e3a2\uff0c\u53ef\u4ee5\u7b97\u8054\u5408\u6743\u503c\n\n\u90a3\u4e48\uff0c\u6700\u5927\u8054\u5408\u6743\u503c\u662fmax\uff5bmaxa[i]\\*maxb[i]\uff5d\uff081<=i<=n\uff09\n\nmaxa,maxb\u8868\u793a\u6700\u5927\u7684\u4e24\u4e2a\u76f8\u90bb\u6743\u503c\n\n\u63a5\u4e0b\u6765\u6c42\u548c\n\n\u6613\u77e5\uff0c\u4e00\u4e2a\u70b9i\uff0c\u82e5\u6709\u90bb\u5c45\u7684\u6743\u503c\u4e3aa1,a2,a3,\u2026\u2026,at\uff0c\u90a3\u4e48\u548c\u4e3aa1\\*(a2+a3+\u2026\u2026+at)+a2\\*(a1+a3+\u2026\u2026+at)+\u2026\u2026+at\\*(a1+a2+\u2026\u2026+a(t-1))\n\n\u7528\u4ee3\u5165\u6cd5\uff0c\u8bbeS=a1+a2+a3+\u2026\u2026+at\uff0c\u90a3\u4e48\u548c\u4e3aS^2-a1^2-a2^2-a3^2-\u2026\u2026-at^2\n\n\u628a\u6bcf\u4e2a\u70b9\u7684S\u4e0e(a1^2+a2^2+a3^2+\u2026\u2026+at^2\uff09\u5b58\u50a8\u8d77\u6765\uff0c\u6700\u7ec8\u641e\u4e00\u4e0b\u5c31\u597d\u4e86\n\n\n\n```cpp\nvar\n    maxa,maxb,sum,s,u,v,a:array[0..200000] of int64;\n    i,n:longint;\n    print,ans:int64;\nbegin\n    readln(n);\n    for i:=1 to n-1 do\n        readln(u[i],v[i]);\n    for i:=1 to n do\n        read(a[i]);\n    for i:=1 to n-1 do\n        begin\n            if a[u[i]]>maxa[v[i]] then\n                begin\n                    maxb[v[i]]:=maxa[v[i]];\n                    maxa[v[i]]:=a[u[i]];\n                end else\n            if a[u[i]]>maxb[v[i]] then\n                maxb[v[i]]:=a[u[i]];\n            if a[v[i]]>maxa[u[i]] then\n                begin\n                    maxb[u[i]]:=maxa[u[i]];\n                    maxa[u[i]]:=a[v[i]];\n                end else\n            if a[v[i]]>maxb[u[i]] then\n                maxb[u[i]]:=a[v[i]];\n            sum[u[i]]:=(sum[u[i]]+sqr(a[v[i]])) mod 10007;\n            sum[v[i]]:=(sum[v[i]]+sqr(a[u[i]])) mod 10007;\n            s[u[i]]:=(s[u[i]]+a[v[i]]) mod 10007;\n            s[v[i]]:=(s[v[i]]+a[u[i]]) mod 10007;\n        end;\n    for i:=1 to n do\n        if maxa[i]*maxb[i]>print then\n            print:=maxa[i]*maxb[i];\n    write(print,' ');\n    for i:=1 to n do\n        ans:=(ans+(sqr(s[i])-sum[i])) mod 10007;\n    writeln(ans);\nend.\n```",
        "postTime": 1506148484,
        "uid": 51719,
        "name": "ModestCoder_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u8f6c\u8f7d\u4e8e\uff1ahttp://www.cnblogs.com/Mrsrz/p/7506467.html\n\n\u9996\u5148\uff0c\u8ddd\u79bb\u4e3a2\u7684\u70b9\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\u2460\u70b9u\u548c\u5b83\u7236\u4eb2\u7684\u7236\u4eb2\uff1b\u2461\u70b9u\u548c\u5b83\u7684\u5144\u5f1f\u3002\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u904d\u5386\u5168\u56fe\uff0c\u8bb0\u5f55\u8be5\u70b9\u7236\u4eb2\u7684\u7236\u4eb2\u5373\u53ef\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\uff0c\u6c42\u51fa\u5b83\u6240\u6709\u513f\u5b50\u548c\u513f\u5b50\u4e4b\u95f4\u7684\u8054\u5408\u6743\u503c\u662f\u591a\u5c11\uff0c\u52a0\u8d77\u6765\u5373\u53ef\u3002\n\n\u8fd9\u6837\u5b50\u53ef\u80fd\u4f1a\u8d85\u65f6\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u53d8\u91cf\u8bb0\u5f55\u524d\u9762\u513f\u5b50\u7684\u6743\u503c\u548c\uff0c\u7136\u540e\u76f4\u63a5\u4e58\u8fd9\u4e2a\u548c\u5373\u53ef\u3002\u6700\u540e\u7b54\u6848\u4e582\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u95ee\uff0c\u6211\u4eec\u4e5f\u601d\u8003\u4ee5\u4e0a\u4e24\u79cd\u60c5\u51b5\u3002\u7b2c\u2460\u79cd\u5f88\u597d\u8003\u8651\uff0c\u7b2c\u2461\u79cd\u6211\u4eec\u53ea\u9700\u8bb0\u5f55\u6700\u5927\u6743\u503c\u548c\u6b21\u5927\u6743\u503c\uff0c\u7136\u540e\u76f8\u4e58\u5c31\u662f\u53ef\u80fd\u7684\u6700\u5927\u503c\u4e86\u3002\n\n\u4e8e\u662f\u5c31\u8fc7\u4e86\u3002\n\n```cpp\n#include<cstdio>\n#include<vector>\nusing namespace std;\nvector<int>G[200002];\nint n,d[200002],ans=0,Max=0;\nbool b[200002]={0};\nvoid addedge(int from,int to){\n    G[from].push_back(to);\n    G[to].push_back(from);\n}\nvoid dfs(int u,int fa,int fasfa){\n    b[u]=true;\n    if(fasfa)ans=(ans+d[u]*d[fasfa]%10007)%10007;\n    int sum=0,no1=0,no2=0;\n    for(int i=0;i<G[u].size();++i)\n    if(!b[G[u][i]]){\n        if(d[G[u][i]]>no1)no2=no1,no1=d[G[u][i]];else\n        if(d[G[u][i]]>no2)no2=d[G[u][i]];\n        ans=(ans+d[G[u][i]]*sum%10007)%10007;\n        sum=(sum+d[G[u][i]])%10007;\n    }\n    if(no1*no2>Max)Max=no1*no2;\n    if(d[u]*d[fasfa]>Max)Max=d[u]*d[fasfa];\n    for(int i=0;i<G[u].size();++i)\n    if(!b[G[u][i]]){\n        b[G[u][i]]=true;\n        dfs(G[u][i],u,fa);\n    }\n}\nint main(){\n    scanf(\"%d\",&n);\n    for(int i=1;i<n;++i){\n        int x,y;\n        scanf(\"%d%d\",&x,&y);\n        addedge(x,y);\n    }\n    for(int i=1;i<=n;++i)scanf(\"%d\",&d[i]);\n    dfs(1,0,0);\n    printf(\"%d %d\\n\",Max,ans*2%10007);\n    return 0;\n}\n```",
        "postTime": 1505219807,
        "uid": 13745,
        "name": "kanloner",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u5176\u5b9e\u6a21\u62df\u5c31\u597d\u5566\n\n\u53ea\u662f\u5fc5\u987b\u8981\u4f18\u5316\u4e00\u4e0b\n\n\u53cd\u6b63\u6211\u662f\u7528\u4e86vector\u7684\uff08\u8282\u7ea6\u7a7a\u95f4\uff09\n\n\u7528\u52a8\u6001\u6570\u7ec4\u628a\u6bcf\u4e2a\u70b9\u4e0e\u4e4b\u76f8\u8fde\u7684\u70b9\u90fd\u8bb0\u4e0b\u6765\uff0c\u7136\u540e\u65e2\u7136\u90fd\u4e0e\u540c\u4e00\u70b9\u76f8\u8fde\u90a3\u4e48\u8ddd\u79bb\u4e00\u5b9a\u4e3a2\uff0c\u90a3\u4e48\u53ea\u8981\u5c06\u6bcf\u4e00\u70b9\u540e\u9762\u8fde\u63a5\u70b9\u4e00\u4e2a\u4e00\u4e2a\u5904\u7406\u5c31\u597d\u4e86\uff0c\u5177\u4f53\u89c1\u4ee3\u7801\u540e\u7684\u8bf4\u660e\u5427\n\n**\u53e6\u5916 **   \u6709\u4e00\u4e2a\u6570\u5b66\u6280\u5de7\uff0c\uff0c\uff0c\n\n\u7531\u5e73\u65b9\u548c\u516c\u5f0f\\_\uff08a+b\uff09^2=a^2+2ab+b^2\\_\u4e0d\u96be\u5c06\u516c\u5f0f\u4ece\u4e24\u4e2a\u6570\u63a8\u5e7f\u5230n\u4e2a\u6570\uff0c\u8fd9\u6837\u7684\u8bdd\u5c31\u53ef\u4ee5\u8282\u7ea6\u65f6\u95f4\u4e86\n\n\u5e76\u4e14\u8fd9\u6837\u4e0d\u7528\u5f00long long\uff0c\u56e0\u4e3a\u53ef\u4ee5\u5728\u6c42\u503c\u8fc7\u7a0b\u4e2d\u4e0d\u65ad\u53d6\u6a21\n\n##\u4ee3\u7801\u5982\u4e0b\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<vector>                                  \nusing namespace std;\nconst int k=10007;\nint n,x,y,v,p,q,maxn,max1,max2,ans,i,j,l;\nint w[200005];\nvector<int>a[200005];                            \nint main()\n{\n    scanf(\"%d\",&n);\n    for(i=1;i<=n-1;i++)\n     {\n         scanf(\"%d%d\",&x,&y);\n         a[x].push_back(y);        //\u8bb0\u5f55\u76f8\u8fde\u7684\u70b9                \n         a[y].push_back(x);\n     }\n    for(i=1;i<=n;i++) scanf(\"%d\",&w[i]);\n    for(i=1;i<=n;i++)                              \n    {\n        l=a[i].size();\n        max1=max2=0;\n        p=q=0;\n        if(l>1)\n        for(j=0;j<l;j++)\n        {\n            v=a[i][j];                //\u4f9d\u6b21\u53d6\u51fa\u8fde\u63a5\u70b9 \n            p=(p+w[v])%k;             //\u6570\u5b66part1\uff1aa1+a2+a3+...+an \n            q=(q+w[v]*w[v])%k;        //\u6570\u5b66part2\uff1aa1^2+a2^2+a3^2+...+an^2 \n            if(w[v]>=max1) \n            {\n                max2=max1;            //\u6c42\u51fa\u5f53\u524d\u70b9\u76f8\u8fde\u7684\u6700\u5927\u53ca\u6b21\u5927\u503c \n                max1=w[v];\n            } \n            if(w[v]<max1&&w[v]>=max2) max2=w[v];\n        }\n        ans=(ans+p*p-q)%k;            //\u6570\u5b66part3:part1^2-part2      \n        maxn=max(maxn,max1*max2);     //\u8054\u5408\u6743\u503c\u6700\u5927\u503c \n    }\n    printf(\"%d %d\",maxn,ans);\n    return 0;\n}\n```",
        "postTime": 1502001600,
        "uid": 48358,
        "name": "Nitric\u785d",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u8981\u5bfb\u6c42\u8ddd\u79bb\u4e3a2\u7684\u8282\u70b9\uff0c\u5373\u5728dfs\u6811\u4e0a\u7684\u4efb\u610f\u8282\u70b9x\n\n\u6ee1\u8db3\u6761\u4ef6\u7684\u6709\uff1a1.x\u7684fa \u4e0e x\u7684son 2.x\u7684\u4efb\u610f\u4e24\u4e2ason\n\n\u5904\u7406\u7b2c\u4e8c\u79cd\u60c5\u51b5\u6709\u4e2a\u5c0f\u6280\u5de7 \u5904\u7406\u4e00\u6570\u5217\u4e24\u4e24\u6570\u79ef\u4e4b\u65f6\uff0c\u6734\u7d20\u7b97\u6cd5\u4e3aO(1/2\\*n^2),\u4f18\u5316\u7b97\u6cd5\u4e3aO(n)\n\n```cpp\n#include<queue>\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#define maxn 200005\nusing namespace std;\nint n,cnt,head[maxn],val[maxn],que[maxn];\nlong long sum,mx;\n\nstruct Edge{\n    int to,next;\n}edge[maxn<<1];\n\ninline int read()\n{\n    int x=0,f=1;char c=getchar();\n    while(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n    while(c>='0'&&c<='9'){x=x*10+c-'0';c=getchar();}\n    return x*f;\n}\n\ninline void add(int u,int v)\n{\n    edge[++cnt].to=v;\n    edge[cnt].next=head[u];\n    head[u]=cnt;\n} \n\nvoid dfs(int x,int fa)\n{\n    if(head[x]==-1)    return ;\n    int num=0,tot=0;\n    int max1=0,max2=0,max1id;\n    for(int i=head[x];i!=-1;i=edge[i].next)\n    {\n        int son=edge[i].to;\n        if(son==fa)    continue;\n        que[++num]=son;\n\n        sum+=(long long)val[fa]*val[son];//\u5904\u7406\u60c5\u51b51\n        sum%=10007;\n        if(val[son]>max1) max1=val[son],max1id=num;//\u627e\u6700\u5927\n    }\n\n    for(int i=1;i<=num;i++)//\u5904\u7406\u60c5\u51b52 + \u4f18\u5316\n    {\n        if(val[que[i]]>max2&&val[que[i]]!=max1)    max2=val[que[i]];\n        sum+=(long long)tot*val[que[i]];\n        tot+=val[que[i]];\n    }\n    \n    que[0]=fa;if(val[fa]>max1)    max1=val[fa],max1id=0;//\u6700\u5927\u4e0d\u8981\u5fd8\u8bb0fa\u7684\u6743\u503c\n    for(int i=0;i<=num;i++)\n        if(val[que[i]]>max2&&i!=max1id)    max2=val[que[i]];//\u627e\u7b2c\u4e8c\u5927\n    mx=max((long long)max1*max2,mx);\n    \n    for(int i=head[x];i!=-1;i=edge[i].next)\n    {\n        dfs(edge[i].to,x);\n    }\n}\nint main()\n{\n    memset(head,-1,sizeof(head));\n    n=read();\n    for(int i=1,u,v;i<n;i++)\n    {\n        u=read();v=read();\n        if(u>v) swap(u,v);\n        add(u,v);\n    }\n    for(int i=1;i<=n;i++)    val[i]=read();\n    dfs(1,0);\n    sum=(sum<<1)%10007;\n    printf(\"%lld %lld\",mx,sum);\n    return 0;\n}\n```",
        "postTime": 1497448746,
        "uid": 29892,
        "name": "ibilllee",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u8fd9\u9898\u6ce8\u610f\u9898\u76ee\u770b\u6e05......\u6211\u8bed\u6587\u4e0d\u597d\u54ea\u4e2a\u53d6\u4f59\u54ea\u4e2a\u4e0d\u53d6wa\u4e86\u8fd110\u6b21,,,,,,\n\n\u8fd9\u9898\u7684\u5173\u952e\u662f\u7edf\u8ba1\u6bcf\u4e00\u4e2a\u5143\u7d20\u5468\u56f4\u4e00\u5708\u6240\u6709\u5143\u7d20\u7684\u503c\n\n\u7136\u540e\u5bf9\u4e8e\u4e00\u4e2a\u70b9\u4ea7\u751f\u7684\u503c\u5c31\u662f\u8fd9\u4e2a\u70b9\u8fde\u63a5\u7684\u6240\u6709\u70b9\u5468\u56f4\u7684\u503c\u4e4b\u548c\\*\u8fd9\u4e2a\u70b9\u7684\u503c-\u8fd9\u4e2a\u70b9\u7684\u503c\u7684\u5e73\u65b9\n\n\u590d\u6742\u5ea6\u662f\u591a\u4e2aO(n)\n\n\u6211\u6ca1\u52a0\u4efb\u4f55\u4f18\u5316458ms\n\n\u6ce8\u610fmod\u7684\u65f6\u5019\u4e0d\u80fd\u51fa\u73b0\u8d1f\u6570\n\n        \n        \n```cpp\n#include<iostream>\n#include<cstdio>\nusing namespace std;\nint a[300001],b[300001],w[300001];\nlong long f[300001];\nint maxs[300001][3];\nint main()\n{\n    int i,j,k,m,n;\n    scanf(\"%d\",&n);\n    for(i=1;i<=n-1;i++)\n    scanf(\"%d %d\",&a[i],&b[i]);\n    for(i=1;i<=n;i++)\n    scanf(\"%d\",&w[i]);\n    for(i=1;i<=n-1;i++)\n    {\n        f[a[i]]+=w[b[i]];\n        f[b[i]]+=w[a[i]];\n        f[a[i]]=f[a[i]]%10007;\n        f[b[i]]=f[b[i]]%10007;\n    }\n    long long ans=0;\n    for(i=1;i<n;i++)\n    {\n        ans+=w[a[i]]*f[b[i]]+w[b[i]]*f[a[i]];\n        ans=ans-w[a[i]]*w[a[i]]-w[b[i]]*w[b[i]];\n        ans=(ans+10007000000)%10007;\n    }long long big=0;\n    for(i=1;i<=n-1;i++)\n    {\n        if (w[b[i]]>maxs[a[i]][1])\n        {\n            maxs[a[i]][2]=maxs[a[i]][1];\n            maxs[a[i]][1]=w[b[i]];\n        }\n        else if(w[b[i]]>maxs[a[i]][2])\n                maxs[a[i]][2]=w[b[i]];\n        if (w[a[i]]>maxs[b[i]][1])\n        {\n            maxs[b[i]][2]=maxs[b[i]][1];\n            maxs[b[i]][1]=w[a[i]];\n        }\n        else if(w[a[i]]>maxs[b[i]][2])\n        maxs[b[i]][2]=w[a[i]];\n        if (maxs[b[i]][1]*maxs[b[i]][2]>big)\n        big=maxs[b[i]][1]*maxs[b[i]][2];\n        if (maxs[a[i]][1]*maxs[a[i]][2]>big)\n        big=maxs[a[i]][1]*maxs[a[i]][2];\n    }\n    cout<<big<<' '<<ans;\n}\n```",
        "postTime": 1488605370,
        "uid": 6063,
        "name": "NephrenRuq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "/\\*\n\u56e0\u4e3a\u9ed8\u8ba4\u7684\u8fb9\u6743\u503c\u662f1 \u6240\u4ee5\u8ddd\u79bb\u4e3a2\u7684\u70b9\u4e5f\u5c31\u662f\u4ece\u540c\u4e00\u4e2a\u70b9\u51fa\u53d1\u7684\u4e24\u4e2a\n\n\u8fd9\u6837\u6211\u4eec\u4e0d\u9700\u8981n\\*n\u7684\u679a\u4e3e\u70b9 \u6211\u4eec\u7edf\u8ba1\u6bcf\u4e2a\u70b9\u4e4b\u95f4\u76f8\u8fde\u7684\n\n\u7136\u540e\u4e24\u4e24\u7ec4\u5408 \u8fd9\u91cc\u4f1a\u53d1\u73b0 \u8dd1\u6162\u4e86 70\u5206\n\n\u5047\u8bbe\u70b9x\u76f4\u63a5\u76f8\u8fde\u7684\u70b9\u6709\u4e09\u4e2a \u6743\u503c\u5206\u522b\u662fa b c\n\n\u90a3\u4e48\u6211\u4eec\u4e24\u4e24\u7ec4\u5408\u540e\u603b\u6743\u503c\u662fab+bc+ac\n\n\u4f1a\u53d1\u73b0\u8fd9\u91cc\u548c\u4e4b\u524d\u7528\u7ebf\u6bb5\u6811\u6c42\u533a\u95f4\u4e24\u4e24\u5143\u7d20\u4e4b\u548c\u662f\u4e00\u6837\u7684\n\n\u6839\u636e\u6570\u5b66\u516c\u5f0f (a+b+c)^2-a^2-b^2-c^2=2\\*(ab+bc+ac)\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5f88\u5feb\u5730\u6c42\u51fa\u6743\u503c\u548c \u81f3\u4e8e\u6700\u5927\u7684\u561b \u90a3\u80af\u5b9a\u662f\u6700\u5927\u7684\u4e24\u4e2a\u70b9\u6743\u4e4b\u79ef\n\n\\*/\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define maxn 200010\n#define mod 10007\nusing namespace std;\nint n,w[maxn],head[maxn],num,ans,sum;\nstruct node\n{\n    int u,v,pre;\n}e[maxn*2];\nint cmp(int x,int y)\n{\n    return x>y;\n}\nint init()\n{\n    int x=0;char s=getchar();\n    while(s<'0'||s>'9')s=getchar();\n    while(s>='0'&&s<='9'){x=x*10+s-'0';s=getchar();}\n    return x;\n}\nvoid Add(int from,int to)\n{\n    num++;\n    e[num].u=from;\n    e[num].v=to;\n    e[num].pre=head[from];\n    head[from]=num;\n}\nint main()\n{\n    //freopen(\"linkb.in\",\"r\",stdin);\n    //freopen(\"linkb.out\",\"w\",stdout);\n    n=init();\n    int x,y;\n    for(int i=1;i<=n-1;i++)\n      {\n          x=init();y=init();\n          Add(x,y);Add(y,x);\n      }\n    for(int i=1;i<=n;i++)\n      w[i]=init();\n    for(int u=1;u<=n;u++)\n      {\n          int p[maxn],l=0,tmp=0,s=0;\n        for(int i=head[u];i;i=e[i].pre)\n          p[++l]=w[e[i].v];\n        sort(p+1,p+1+l,cmp);\n        ans=max(ans,p[1]*p[2]);\n        for(int i=1;i<=l;i++)\n          {\n            tmp=(tmp+p[i]*p[i]%mod)%mod;\n            s=(s+p[i]%mod)%mod;\n          }\n        sum=(sum+(s*s-tmp)%mod)%mod;\n      }\n    printf(\"%d %d\\n\",ans,sum);\n    return 0;\n}\n```",
        "postTime": 1486258838,
        "uid": 20833,
        "name": "\u5b89\u597d",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u7136\u800c\u5e76\u4e0d\u9700\u8981\u4ec0\u4e48\u6027\u8d28==\n\n\u6ce8\u610f\u67092\u79cd\uff0c\u4e00\u79cd\u513f\u5b50\u7684\u513f\u5b50\u4e0e\u8282\u70b9\uff0c\u4e00\u79cd\u662f\u513f\u5b50\u548c\u513f\u5b50\n\n\n    \n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<vector>\n#define name \"\"\n#define mod 10007\n#define M(x) ((x)%mod+mod)%mod\n#define maxn 200009\nusing namespace std;\nstruct egde_{\n    int to;\n    int next;\n}line[maxn*2];\nint fi[maxn],tot;\nvoid add(int u,int v)    {\n    line[++tot].to=v;\n    line[tot].next=fi[u];\n    fi[u]=tot;\n}\nvoid add_double(int u,int v)    {\n    add(u,v);\n    add(v,u);\n}\nint fa[maxn],v[maxn],sonv[maxn],sumv[maxn];\nint ans,rans;\nvoid dfs(int u)    {\n    for(int i=fi[u];i;i=line[i].next)    {\n        int to=line[i].to;\n        if(fa[u]==to)\n            continue;\n        fa[to]=u;\n        ans=max(ans,v[to]*sonv[u]);\n        if(v[to]>sonv[u])    {\n            sonv[u]=v[to];\n        }\n        sumv[u]=M(sumv[u]+v[to]);\n        dfs(to);\n        ans=max(ans,v[u]*sonv[to]);\n        rans=M(rans+2*v[u]*sumv[to]);\n    }\n    for(int i=fi[u];i;i=line[i].next)    {\n        int to=line[i].to;\n        if(to==fa[u])\n            continue;\n        rans=M(rans+v[to]*(sumv[u]-v[to]));\n    }\n}\nint main()    {\n    int n;\n    cin>>n;\n    int x,y;\n    for(int i=1;i<n;i++)    {\n        cin>>x>>y;\n        add_double(x,y);\n    }\n    for(int i=1;i<=n;i++)\n        cin>>v[i];\n    dfs(1);\n    cout<<ans<<\" \"<<rans<<endl;\n}\n```",
        "postTime": 1479342160,
        "uid": 7364,
        "name": "what_trouble",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u672c\u4eba\u849f\u84bb\u4e00\u679a \u770b\u5230\u8fd9\u9053\u9898\u7b2c\u4e00\u4e2a\u60f3\u5230\u7684\u5c31\u662f\u679a\u4e3e\u3002\n\n\u8ddd\u79bb\u4e3a\u4e8c\u7684\u4e24\u4e2a\u70b9\u53ef\u4ee5\u4ea7\u751f\u8054\u5408\u6743\u503c \u90a3\u4e48\u8fd9\u4e24\u4e2a\u70b9\u53ef\u4ee5\u770b\u505a\u4e00\u4e2a\u70b9\u7684\u4e24\u4e2a\u5b69\u5b50\u3002\n\n\u679a\u4e3e\u6bcf\u4e2a\u70b9\u7684\u6bcf\u4e2a\u5b69\u5b50 \u6bcf\u4e2a\u70b9\u53d6\u6743\u503c\u6700\u5927\u7684\u4e24\u4e2a\u5b69\u5b50\u8ba1\u7b97\u8054\u5408\u6743\u503c \u6700\u540e\u6240\u6709\u70b9\u91cc\u53d6\u6700\u5927\u7684\u3002\n\n\u81f3\u4e8e\u8054\u5408\u6743\u503c\u4e4b\u548c\uff0c\u4e0d\u9700\u8981\u679a\u4e3e\u6240\u6709\u7684\u8054\u5408\u6743\u503c\uff0c\u5bf9\u4e8e\u4efb\u610f\u4e2a \u6570\uff0c\u4e24\u4e24\u76f8\u4e58\u7684\u4e58\u79ef\u4e4b\u548c\u5c31\u7b49\u4e8e\u8fd9\u4e9b\u6570\u7684\u548c\u7684\u5e73\u65b9\u51cf\u53bb\u5e73\u65b9\u7684\u548c\n\n\u4e3e\u4f8b\uff1a\u5bf9\u4e8ea,b,c,d\u56db\u4e2a\u503c\uff0c\u5b83\u4eec\u4ea7\u751f\u7684\u8054\u5408\u6743\u503c\u7684\u548c\u5c31\u662f(a+b+c+d)^2-a^2-b^2-c^2-d^2;\n\n\u6240\u4ee5\u53ea\u9700\u8981\u679a\u4e3e\u4e00\u904d\uff0c\u8bb0\u5f55\u5b83\u4eec\u7684\u548c \u5e73\u65b9\u548c,\u6700\u540e\u76f4\u63a5\u8ba1\u7b97\u5c31\u884c\u3002\n\n\u4ee3\u7801\n```cpp\n#include<iostream>\n#include<cstdio>\nusing namespace std;\n#define m weight[point[s]]\nint head[200001],point[400001],weight[200001],next[400001];\nint n,sum,a,b,num,ans,maxx,maxy,maxans;\nint main()\n{\n    scanf(\"%d\",&n);\n    for(int i=1;i<n;i++)\n    {\n        scanf(\"%d%d\",&a,&b);\n        sum++;\n        next[sum]=head[a];\n        head[a]=sum;\n        point[sum]=b;\n        sum++;\n        next[sum]=head[b];\n        head[b]=sum;\n        point[sum]=a;\n    }\n    for(int i=1;i<=n;i++)\n    scanf(\"%d\",&weight[i]);\n    for(int i=1;i<=n;i++)\n    {\n        num=0;\n        maxx=0;\n        maxy=0;\n        int s=head[i];\n        while(s)\n        {\n            num+=m;\n            num%=10007;\n            ans-=m*m;\n            ans%=10007;\n            if(m>maxx)\n            {\n                maxy=maxx;\n                maxx=m;\n            }\n            else\n            if(m>maxy)\n            maxy=m;\n            s=next[s];\n        }\n        if(maxx*maxy>maxans)\n        maxans=maxx*maxy;\n        ans+=num*num;\n        ans%=10007;\n    }\n    ans=(ans%10007+10007)%10007;\n    printf(\"%d %d\",maxans,ans);\n}\n\n```",
        "postTime": 1478836067,
        "uid": 17828,
        "name": "revenger",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u4e3a\u4ec0\u4e48\u4f1a\u6709dp\u7684\u6807\u7b7e\u3002\u3002\n\n\u76f4\u63a5\u628a\u6811\u904d\u5386\u4e00\u904d\uff0c\u8bb0\u5f55\u6bcf\u4e2a\u8282\u70b9\u7684\u7236\u4eb2\u8282\u70b9fa[i]\n\n\u904d\u5386\u65f6\u6c42\u51fa\u6bcf\u4e2a\u8282\u70b9\u7684\u5b50\u8282\u70b9\u4e24\u4e24\u4e58\u79ef\u4e4b\u548c\uff0c\u7528\u548c\u7684\u5e73\u65b9\u51cf\u53bb\u5e73\u65b9\u548c\n\n\u6700\u540e\u518d\u52a0\u4e0aw[i]\\*w[fa[fa[i]]]\u5c31\u884c\u4e86\n\n\u8fd9\u4e2a\u5b9e\u73b0\u4e0d\u96be\u5427\uff0c\u6211\u5c31\u4e0d\u8d34\u4ee3\u7801\u4e86\u3002\u3002\n",
        "postTime": 1472960589,
        "uid": 5130,
        "name": "mcfx",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\n\n```cpp\n//\u8d85\u8be6\u7ec6\u9898\u89e3\uff01\n#include<iostream>\n#include<cstdio>\nusing namespace std;\nint n;\nlong long x,y,ans1,ans2;\nlong long b[200001],s[200001],max1[200001],max2[200001];\nstruct ljh\n{\n    long long u,v;\n}a[200001];\nvoid make(long long &x,long long &a,long long &b)\n{\n    if(x>a)\n    {\n        b=a;\n        a=x;\n    }\n    else if(x>b)b=x;\n}\nint main()\n{\n    scanf(\"%d\",&n);\n    for(int i=1;i<n;i++)cin>>a[i].u>>a[i].v;\n    for(int i=1;i<=n;i++)cin>>b[i];\n    for(int i=1;i<n;i++)\n    {\n        x=a[i].u;y=a[i].v;\n        //\u904d\u5386\u6bcf\u6761\u8fb9\u8fde\u63a5\u7684\u6bcf\u4e2a\u7ed3\u70b9\n        s[x]+=b[y];//\u4ee5x\u4e3a\u8d77\u70b9\u7684\uff0c\u52a0\u4e0a\u65b0\u589e\u7684\u4e00\u4e2a\u70b9\u7684\u6743\u503c \n        s[y]+=b[x];//\u540c\u7406 \n        make(b[y],max1[x],max2[x]);//\u66f4\u65b0\u4ee5x\u4e3a\u8d77\u70b9\u7684\u6700\u5927\u6743\u503c\u4e0e\u6b21\u5927\u6743\u503c \n        make(b[x],max1[y],max2[y]);//\u540c\u4e0a\n    }\n    for(int i=1;i<=n;i++)\n    if(max1[i]*max2[i]>ans1)ans1=max1[i]*max2[i];\n    //\u8ba1\u7b97\u51fa\u6700\u5927\u7684\u8054\u5408\u6743\u503c\uff0cmax1\u6570\u7ec4\u8868\u793a\u6700\u5927\u7684\u4e0ei\u76f8\u8fde\u7684\u6743\u503c\uff0cmax2\u6570\u7ec4\n    //\u8868\u793a\u6b21\u5927\u7684\u4e0ei\u76f8\u8fde\u7684\u6570\u7ec4\uff0c\u65e2\u7136\u90fd\u4e0ei\u76f8\u8fde\uff0c\u90a3\u4e48\u5c31\u80af\u5b9a\u4f1a\u4e24\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u4e3a2\n    for(int i=1;i<n;i++)\n    {\n        x=a[i].u;y=a[i].v;\n        ans2=(ans2+((s[x]-b[y])*b[y])%10007)%10007;\n        //\u6240\u6709\u4e0ex\u70b9\u76f8\u8fde\u7684\u70b9\uff08\u9664y\u5916\uff09\u7684\u6743\u503c\u4e58y\u70b9\u7684\u6743\u503c\n        //\u56e0\u4e3a\u90fd\u4e0ex\u76f8\u8fde\u76f8\u8fde\u90a3\u4e48\u4e24\u70b9\u95f4\u8ddd\u79bb\u80af\u5b9a\u4e3a2 \n        ans2=(ans2+((s[y]-b[x])*b[x])%10007)%10007;\n    }\n    cout<<ans1<<\" \"<<ans2;\n    return 0;\n}\n```",
        "postTime": 1472736475,
        "uid": 20892,
        "name": "Rotepad",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\n\n## \u601d\u8def\n\n\u4e00\u9053\u6d1b\u8c37\u7684\u7eff\u9898\uff0c\u867d\u7136\u4e0d\u662f\u5f88\u96be\uff0c\u4f46\u6211\u8fd8\u662f\u505a\u4e86\u5f88\u957f\u65f6\u95f4\n\n$n$\u4e2a\u70b9\uff0c$n-1$\u6761\u8fb9\uff0c\u6211\u4eec\u5f88\u5bb9\u6613\u5c31\u80fd\u60f3\u5230\u8fd9\u662f\u4e00\u68f5\u6811\uff0c\u770b\u6570\u636e\u8303\u56f4\uff0c\u5982\u679c\u66b4\u529b\u679a\u4e3e\u7684\u8bdd\uff0c\u53ea\u80fd\u62ff\u90e8\u5206\u5206\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u56de\u5230\u9898\u76ee\u4e2d\u770b\uff0c\u53d1\u73b0\uff0c\u53ea\u6709\u8ddd\u79bb\u4e3a$2$\u624d\u4f1a\u4ea7\u751f\u4ef7\u503c\u7684\u8bdd\uff0c\u5982\u679c\u679a\u4e3e\u4e00\u4e2a\u8282\u70b9\uff0c\u53ea\u6709 \u5b83\u548c\u5b83\u7684\u5b59\u5b50\u4e4b\u95f4 \u6216\u8005 \u5b83\u7684\u4e24\u4e2a\u513f\u5b50\u4e4b\u95f4 \u624d\u4f1a\u4ea7\u751f\u4ef7\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u679a\u4e3e\u8fd9\u4e2a\u8282\u70b9\uff0c\u8fdb\u884c$DFS$\uff0c\u671f\u95f4\u8fdb\u884c\u66f4\u65b0\u5c31\u597d\u4e86\uff0c\u5177\u4f53\u7684\u5b9e\u73b0\u53ef\u4ee5\u770b\u4ee3\u7801\n\n## \u4ee3\u7801\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <cstring>\n#include <iostream>\nusing namespace std;\n\ninline int read() {\n\tchar c = getchar();\n\tint x = 0, f = 1;\n\tfor( ; !isdigit(c); c = getchar()) if(c == '-') f = -1;\n\tfor( ; isdigit(c); c = getchar()) x = (x << 3) + (x << 1) + (c ^ 48);\n\treturn x * f;\n}\n\nconst int N = 1e6 + 11;\nconst int M = 2e5 + 7;\nconst int mod = 10007;\n\n//\u90bb\u63a5\u8868\u5b58\u56fe\nstruct node {\n\tint to, nxt;\n} e[N];\n\nint head[M], cnt = 0;\n\ninline void add(int from, int to) {\n\te[++cnt].to = to;\n\te[cnt].nxt = head[from];\n\thead[from] = cnt;\n}\n\nint n, w[M], x, y, tot[M], ma[M], cma[M], ans, maxn;\n//tot[x]\u6570\u7ec4\u8bb0\u5f55x\u6240\u6709\u513f\u5b50\u7684\u4ef7\u503c\uff0cma[x]\u8bb0\u5f55x\u6240\u6709\u513f\u5b50\u4e2d\u7684\u6700\u5927\u503c\uff0ccma[x]\u8bb0\u5f55x\u6240\u6709\u513f\u5b50\u4e2d\u7684\u6b21\u5927\u503c\n\n//DFS!!\nvoid dfs(int u, int fa) {\n\t//\u4e0e\u5b59\u5b50\u4e4b\u95f4\u4ea7\u751f\u7684\u4ef7\u503c\n\tfor(int i = head[u]; i; i = e[i].nxt) { //\u679a\u4e3e\u513f\u5b50\u8282\u70b9\n\t\tint v = e[i].to;\n\t\tif(v == fa) continue;\n\t\tdfs(v, u);\n\t\ttot[u] = (tot[u] + w[v]) % mod; //tot[u]\u52a0\u4e0a\u5b83\u513f\u5b50v\u7684\u4ef7\u503c\n\t\tif(w[v] > ma[u]) ma[u] = w[v]; //\u627e\u5b83\u6240\u6709\u513f\u5b50\u7684\u6700\u5927\u503c\n\t\telse cma[u] = max(cma[u], w[v]);\n\t\tmaxn = max(maxn, w[u] * ma[v]);//\u7b54\u6848\u4e2d\u7684\u6700\u5927\u503c\n\t\tans = (ans + 2 * w[u] * tot[v] % mod) % mod;//\u4e0e\u5b59\u5b50\u4e4b\u95f4\u4ea7\u751f\u7684\u4ef7\u503c\uff08\u4ed6\u5230\u4ed6\u5b59\u5b50\u4e4b\u95f4\u7684\u8ddd\u79bb\u4e00\u5b9a\u662f2\uff09\uff0c\u56e0\u4e3a\u662f\u53cc\u5411\u7684\uff0c\u6240\u4ee5\u8981\u4e582\n\t}\n\t//\u513f\u5b50\u4e4b\u95f4\u4ea7\u751f\u7684\u4ef7\u503c\n\tfor(int i = head[u]; i; i = e[i].nxt) {\n\t\tint v = e[i].to;\n\t\tif(v == fa) continue;\n\t\tif(w[v] == ma[u]) maxn = max(maxn, w[v] * cma[u]); //\u5982\u679c\u662f\u6700\u5927\u503c\u5c31\u4e0e\u6b21\u5927\u503c\u76f8\u4e58\n\t\telse maxn = max(maxn, w[v] * ma[u]); //\u5426\u5219\u4e0e\u6700\u5927\u503c\u76f8\u4e58\n\t\tans = (ans + w[v] * (tot[u] - w[v]) % mod) % mod; //\u5176\u4e2d\u4e00\u4e2a\u513f\u5b50\u4e0e\u7236\u8282\u70b9\u6240\u6709\u513f\u5b50\u4e4b\u95f4\u4ea7\u751f\u7684\u4ef7\u503c\u5c31\u662fw[v] * (tot[u] - w[v])\n\t}\n}\n\nint main() {\n\tn = read();\n\tfor(int i = 1; i < n; i++) {\n\t\tx = read(), y = read();\n\t\tadd(x, y);\n\t\tadd(y, x);\n\t}\n\tfor(int i = 1; i <= n; i++) w[i] = read();//cout << w[i] << '\\n';\n\tdfs(1, 0);\n\twhile(ans < 0) ans += mod; //\u7b54\u6848\u53ef\u80fd\u662f\u8d1f\u7684\uff0c\u53ea\u8981\u662f\u8d1f\u7684\u5c31\u4e00\u76f4\u52a0\u6a21\u6570\n\tcout << maxn << \" \" << ans << '\\n';\n\treturn 0;\n}\n\n```",
        "postTime": 1569069170,
        "uid": 198323,
        "name": "loceaner",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "~~\u4f5c\u4e3a\u4e00\u4e2a\u849f\u84bb\u8868\u793a\u770b\u5230\u5e95\u4e0b\u5927\u4f6c\u4eec\u7684\u9898\u89e3\u5f88\u662f\u80c6\u6218\u5fc3\u60ca~~\n\n\u7136\u540e\u5f00\u59cb\u597d\u5947\u8fd9\u9053\u9898\u80fd\u4e0d\u80fd\u7528\u4e00\u4e9b\u6570\u5b66\u65b9\u6cd5\u6765\u89e3\u51b3\uff1b\n\n~~\u6bd5\u7adf\u8fd9\u91cc\u6709\u4e00\u53ea\u8fde\u56fe\u662f\u4ec0\u4e48\u4e1c\u897f\u90fd\u4e0d\u77e5\u9053\u7684\u849f\u84bb~~\n\n****\n\n**\u90a3\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\uff1a**\n\n- \u9996\u5148\uff0c\u9898\u76ee\u4e2d\u6c42\u7684\u8054\u5408\u6743\u503c\u6307**\u8ddd\u79bb\u4e3a2\u7684\u4e24\u4e2a\u70b9\u7684\u6743\u503c\u4e4b\u79ef**\uff1b\u4e5f\u5c31\u662f\u8bf4\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u53ea\u8981\u6709\u4e24\u4e2a\u4e0e\u5b83\u76f8\u8fde\u7ed3\u7684\u70b9\uff0c\u5c31\u80fd\u4ea7\u751f\u4e00\u4e2a\u8054\u5408\u6743\u503c\uff1b\n\n- \u5f88\u663e\u7136\uff0c\u8fd9\u9053\u9898\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u518d\u679a\u4e3e\u6240\u6709\u4e0e\u5b83\u76f8\u8fde\u7ed3\u7684\u70b9\uff1b\u5f53\u7136\uff0c\u5982\u679c\u4f60\u4e0d\u6015\u88ab\u6570\u636e\u5361\u6b7b\uff1b~~\u76ee\u6d4b\u590d\u6742\u5ea6\u8d85\u8fc7O(n^2);~~\n\n\u6211\u521a\u624d\u662f\u4e0d\u662f\u8bf4\u8fc7\u6570\u5b66\u65b9\u6cd5\u6765\u7740\uff1f\u5bf9\uff0c\u8fd9\u9053\u9898\u53ef\u4ee5\u7528\u6570\u5b66\u65b9\u6cd5\u89e3\u3002\n\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u95ee\u9898\u62c6\u6210\u4e24\u4e2a\u90e8\u5206\uff0c\u5148\u8003\u8651\u5982\u4f55\u6c42\u51fa\u8fd9\u4e00\u5806\u8054\u5408\u6743\u503c\u7684\u548c\uff1b\n\n- \u7528\u201cC\u201d\u8868\u793a\u8054\u5408\u6743\u503c\u4e4b\u548c\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 C= 2x1y1 + 2x2y2 + ... + 2xiyi;\n\n- \u5728\u521d\u4e2d\u6211\u4eec\u5b66\u8fc7\u5b8c\u5168\u5e73\u65b9\u516c\u5f0f\uff0c\u5373(a+b)^2=a^2 + b^2 + 2ab;\n\n- \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a\u539f\u5f0f\u53d8\u5f62\u4e3a C=(x1 + x2 +...+ xi)^2-(x1^2 + x2^2 +...+ xi^2);\n\n- \u7531\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5~~\u91ce\u86ee\u5730~~\u5c06\u590d\u6742\u5ea6\u964d\u5230O(n);\n\n\u8d34\u51fa\u4ee3\u7801\uff1a\n```cpp\nfor(i=1;i<n;i++)\n\t{\n\t\tx=a[i];\n\t\ty=b[i];\n\t\t\n\t\tw[x]=(w[x]+cnt[y])%10007;//a[i],b[i];\n\t\tw[y]=(w[y]+cnt[x])%10007;\n\t\t\n\t\tsqt[x]+=(cnt[y]*cnt[y])%10007;\n\t\tsqt[y]+=(cnt[x]*cnt[x])%10007;//maxium\n\t\t\n\t\tsqt[x]%=10007;\n\t\tsqt[y]%=10007;\n    }\n```\n\n\u6211\u4eec\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u8054\u5408\u6743\u503c\u7684\u6700\u5927\u503c\u8fd8\u6ca1\u6709\u6c42\uff1b\n\n\u4f46\u662f\u8fd9\u4e5f\u5f88\u597d\u89e3\u51b3\uff0c\u4e0a\u9762\u7684\u4ee3\u7801\u76f8\u5f53\u4e8e\u628a\u6240\u6709\u6570\u636e\u90fd\u626b\u4e86\u4e00\u904d\uff0c\u800c\u5728\u4e0a\u9762\u4ee3\u7801\u7684\u57fa\u7840\u4e0a\u6211\u4eec\u589e\u52a0\u4e00\u4e2a\u5224\u65ad\u6700\u5927\u503c\u5c31\u53ef\u4ee5\u4e86\uff1b\n\n**\u8981\u6ce8\u610f\u7684\u662f\uff0c\u9898\u76ee\u8981\u6c42\u8f93\u51fa\u4e00\u4e2a\u6700\u5927\u7684\u8054\u5408\u6743\u503c\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u8981\u627e\u5230\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u7684\u6700\u5927\u6743\u503c\u548c\u7b2c\u4e8c\u5927\u6743\u503c\uff0c\u4e24\u6570\u76f8\u4e58\u5373\u5f97\u89e3\uff1b**\n\n\u90a3\u4e48\u4f5c\u51fa\u4fee\u6539\u7684\u4ee3\u7801\u5c31\u662f\u8fd9\u4e2a\u6837\u5b50\uff1a\n```cpp\nfor(i=1;i<n;i++)\n\t{\n\t\tx=a[i];\n\t\ty=b[i];\n\t\t\n\t\tw[x]=(w[x]+cnt[y])%10007;//a[i],b[i];\n\t\tw[y]=(w[y]+cnt[x])%10007;\n\t\t\n\t\tsqt[x]+=(cnt[y]*cnt[y])%10007;\n\t\tsqt[y]+=(cnt[x]*cnt[x])%10007;//maxium\n\t\t\n\t\tsqt[x]%=10007;\n\t\tsqt[y]%=10007;\n\t\t\n\t\t//\u6c42\u6700\u5927\u503c; \n\t\tif(m1[x]<=cnt[y])\n\t\t{\n\t\t\tm2[x]=m1[x];\n\t\t\tm1[x]=cnt[y];\n\t\t}\n\t\telse if(m2[x]<cnt[y])\n\t\t{\n\t\t\tm2[x]=cnt[y];//\u6c42\u7b2c\u4e8c\u5927\u503c\n\t\t}\n\t\t\n\t\tif(m1[y]<=cnt[x])//\u6ce8\u610f\u6743\u503c\u5728\u6b64\u5904\u662f\u76f8\u4e92\u7684\n\t\t{\n\t\t\tm2[y]=m1[y];//a\u76f8\u5bf9b\u6709\u4e00\u4e2a\u6743\u503c\uff0cb\u76f8\u5bf9a\u4ea6\u7136\uff1b\n\t\t\tm1[y]=cnt[x];\n\t\t}\n\t\telse if(m2[y]<cnt[x])\n\t\t{\n\t\t\tm2[y]=cnt[x];\n\t\t}\n\t\t\n\t\tif(m1[x]*m2[x]>maxn)\n\t\t{\n\t\t\tmaxn=m1[x]*m2[x];\n\t\t}\n\t\telse if(m1[y]*m2[y]>maxn)\n\t\t{\n\t\t\tmaxn=m1[y]*m2[y];\n\t\t}\n\t\t//\u6c42\u5b8c\u6700\u5927\u503c; \n\t}\n```\n\u81f3\u6b64\u6838\u5fc3\u90e8\u5206\u7ed3\u675f\u3002\n\n## \u9700\u8981\u6ce8\u610f\u7684\u51e0\u4e2a\u5730\u65b9\uff1a\n\n- \u9898\u76ee\u4e0a**\u6ca1\u8bf4\u6700\u5927\u503c\u4e5f\u8981\u53d6\u6a21**\uff0c\u5343\u4e07\u522b\u753b\u86c7\u6dfb\u8db3\uff1b\n\n- \u6b63\u56e0\u4e3a\u4e0d\u53d6\u6a21\uff0c\u6700\u5927\u503c\u53ef\u80fd\u5f88\u5927\uff0c\u8bb0\u5f97long long\u5904\u7406\uff1b\n\n- \u7531\u4e8e\u6c42\u548c\u516c\u5f0fC=(x1 + x2 +...+ xi)^2-(x1^2 + x2^2 +...+ xi^2)\u4e2d\u5b58\u5728\u51cf\u6cd5\uff0c\u5e76\u4e14\u6bcf\u6b21\u8ba1\u7b97\u90fd\u9700\u8981\u53d6\u6a21\uff0c\u6700\u7ec8\u7ed3\u679c\u5f88\u53ef\u80fd\u4e3a\u8d1f\u6570\uff0c\u6b64\u5904\u6211\u4eec\u9700\u5982\u4e0b\u5904\u7406\uff1a\n```cpp\nans = (ans + 10007)%10007;\n```\n\n****\n\u60f3\u4e86\u5f88\u4e45\u8fd8\u662f\u51b3\u5b9a\u628a\u6e90\u4ee3\u7801\u8d34\u4e0a  \n~~\u603b\u4e4b\u53d8\u6210\u5c4e\u540d\u7684\u4e0d\u662f\u6211\uff0c\u81ea\u91cd\u5c31\u597d\uff1b~~\n```cpp\n#include<cstdio>\n#include<cstring>\nusing namespace std;\n\nint w[200005]={0},sqt[200005]={0},a[200005]={0},b[200005]={0};\nint cnt[200005]={0};\nint m1[200005]={0},m2[200005]={0};\n\nint main()\n{\n\tint n,i,ans,x,y;\n\tlong long maxn;\n\t\n\tscanf(\"%d\",&n);\n\t\n\tfor(i=1;i<n;i++)\n\t{\n\t\tscanf(\"%d%d\",&a[i],&b[i]);\n\t}\n\t\n\tfor(i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d\",&cnt[i]);\n\t}\n\t// read;\n\t\n\tmemset(m1,0,sizeof(m1));\n\tmemset(m2,0,sizeof(m2));\n\t\n\tmaxn=0;\n\tfor(i=1;i<n;i++)\n\t{\n\t\tx=a[i];\n\t\ty=b[i];\n\t\t\n\t\tw[x]=(w[x]+cnt[y])%10007;//a[i],b[i];\n\t\tw[y]=(w[y]+cnt[x])%10007;\n\t\t\n\t\tsqt[x]+=(cnt[y]*cnt[y])%10007;\n\t\tsqt[y]+=(cnt[x]*cnt[x])%10007;//maxium\n\t\t\n\t\tsqt[x]%=10007;\n\t\tsqt[y]%=10007;\n\t\t\n\t\t//\u6c42\u6700\u5927\u503c; \n\t\tif(m1[x]<=cnt[y])\n\t\t{\n\t\t\tm2[x]=m1[x];\n\t\t\tm1[x]=cnt[y];\n\t\t}\n\t\telse if(m2[x]<cnt[y])\n\t\t{\n\t\t\tm2[x]=cnt[y];\n\t\t}\n\t\t\n\t\tif(m1[y]<=cnt[x])\n\t\t{\n\t\t\tm2[y]=m1[y];\n\t\t\tm1[y]=cnt[x];\n\t\t}\n\t\telse if(m2[y]<cnt[x])\n\t\t{\n\t\t\tm2[y]=cnt[x];\n\t\t}\n\t\t\n\t\tif(m1[x]*m2[x]>maxn)\n\t\t{\n\t\t\tmaxn=m1[x]*m2[x];\n\t\t}\n\t\telse if(m1[y]*m2[y]>maxn)\n\t\t{\n\t\t\tmaxn=m1[y]*m2[y];\n\t\t}\n\t\t//\u6c42\u5b8c\u6700\u5927\u503c; \n\t}\n\t\n\tfor(i=1;i<=n;i++)\n\t{\n\t\tw[i]=(w[i]*w[i])%10007;\n\t\tw[i]-=sqt[i];\n\t}//computing;\n\t\n\tans=0;\n\tfor(i=1;i<=n;i++)\n\t{\n\t\tans=(ans+w[i])%10007;\n\t}//final\n\t\n\tans = (ans + 10007)%10007;\n\t\n\tprintf(\"%lld %d\\n\",maxn,ans);//%I64d----%lld;\n\t\n\treturn 0;\n}\n\n\n```",
        "postTime": 1527393668,
        "uid": 22555,
        "name": "strike",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "##\u8fd9\u4e2a\u7a0b\u5e8f\u53ef\u4ee5\u5728\u6bd4\u8d5b\u65f6\u9a97\u5206\u7528\uff1b\u5f53\u65f6\u6211\u6a21\u62df\u8d5b\u53ea\u6253\u51fa\u4e86\u9a9760\u5206\u7684\u7a0b\u5e8f\uff1bac\u7684\u662f\u8d5b\u540e\u5b8c\u5584\u7684\uff1b\u60f3\u60f3\u6bd4\u8d5b\u65f6\u80fd\u9a9760\u5206\u4e5f\u503c\u4e86\uff1b\n\n```cpp\n#include <iostream>\n#include <cmath>\n#include <cstdio>\n#include <cstdlib>\n#include <cstring>\n#include <string>\n#include <algorithm>\n#include <queue>\n#include <map>\n#define nmax 200100\n#define long long LL\nusing namespace std;//\u5b57\u5934\uff1b\nint n,w[nmax],ww,tot;//w\u5b58\u70b9\u6743\uff1bww\u662f\u6700\u5927\u8054\u5408\u6743\u503c\uff1btot\u662f\u8054\u5408\u6743\u503c\u7684\u548c\uff1b\nint zd[nmax],cd[nmax],s[nmax];\nbool f[201][201];\nstruct bian{\n    int u;\n    int v;\n}b[nmax];\nvoid lll(){//\u5566\u5566\u5566\u51fd\u6570\uff0c\u4e09\u91cd\u5faa\u73af\uff1b\n    for(int i=1;i<=n-1;i++){\n        int u,v;\n        cin>>u>>v;\n        f[u][v]=f[v][u]=1;//\u90bb\u63a5\u77e9\u9635\u8868\u793a\u4e24\u70b9\u76f8\u8fde\uff1b\n    }\n    for(int i=1;i<=n;i++){\n        cin>>w[i];\n    }\n    for(int i=1;i<=n;i++)\n        for(int j=1;j<=n;j++)\n            for(int k=1;k<=n;k++)//\u65e0\u8111\u5f17\u6d1b\u4f0a\u5fb7\u4e09\u91cd\u5faa\u73af\uff1b\n                if(i!=j&&f[i][k]&&f[k][j]){//\u4e24\u4e2a\u70b9\u8fde\u5728\u540c\u4e00\u4e2a\u70b9\u4e0a\u4e14\u4e0d\u662f\u540c\u4e00\u4e2a\u70b9\uff1b\n                    ww=max(ww,w[i]*w[j]);\n                    tot+=w[i]*w[j];\n                    tot%=10007;//\u8fd9\u4e24\u4e2a\u70b9\u5c31\u662f\u8054\u5408\u6743\u503c\uff1b\n                }\n    cout<<ww<<\" \"<<tot;\n    return ;\n```\n}//\u8fd9\u53ef\u4ee5\u9a9730\u5206\uff1b\nvoid mmqm(){//\u83ab\u540d\u5176\u5999\u51fd\u6570\uff1b\u4e8c\u91cd\u5faa\u73af\uff1b\n\n    for(int i=1;i<=n-1;i++){\n\n        cin>>b[i].u>>b[i].v;\n\n}//\u7ed3\u6784\u4f53\u5b58\u8fb9\u7684\u4e24\u70b9\uff1b\n\n```cpp\n    for(int i=1;i<=n;i++){\n        cin>>w[i];\n    }\n    for(int i=1;i<=n-1;i++)\n        for(int j=1;j<=n-1;j++)//\u4e8c\u91cd\u5faa\u73af\u679a\u4e3e\u8fb9\uff1b\n            if(i!=j){.//\u4e0d\u662f\u540c\u4e00\u6761\u8fb9\uff1b\n                if(b[i].u==b[j].u){//\u4ee5\u4e0b\u56db\u4e2aif\u90fd\u662f\u5224\u65ad\u4e24\u6761\u8fb9\u6709\u65e0\u4e00\u4e2a\u516c\u5171\u8282\u70b9\uff1b\n                    ww=max(ww,w[b[i].v]*w[b[j].v]);\n                    tot+=w[b[i].v]*w[b[j].v];\n                    tot%=10007;//\u6709\u7684\u8bdd\uff0c\u8fd9\u4e24\u6761\u8fb9\u7684\u53e6\u4e24\u4e2a\u70b9\u5c31\u662f\u8054\u5408\u6743\u503c\uff1b\n                }\n                if(b[i].u==b[j].v){\n                    ww=max(ww,w[b[i].v]*w[b[j].u]);\n                    tot+=w[b[i].v]*w[b[j].u];\n                    tot%=10007;\n                }\n                if(b[i].v==b[j].u){\n                    ww=max(ww,w[b[i].u]*w[b[j].v]);\n                    tot+=w[b[i].u]*w[b[j].v];\n                    tot%=10007;\n                }\n                if(b[i].v==b[j].v){\n                    ww=max(ww,w[b[i].u]*w[b[j].u]);\n                    tot+=w[b[i].u]*w[b[j].u];\n                    tot%=10007;\n                }\n            }\n    cout<<ww<<\" \"<<tot;\n    return ;\n```\n}//\u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u9a9760\u5206\uff1b\nvoid sxt(){//ac\u51fd\u6570\uff1b\u697c\u4e0b\u7684\u5927\u4f6c\u89e3\u91ca\u7684\u5f88\u8be6\u7ec6\u4e86\uff1b\n\n```cpp\n    for(int i=1;i<=n-1;i++){\n        cin>>b[i].u>>b[i].v;\n    }\n    for(int i=1;i<=n;i++){\n        cin>>w[i];\n    }\n    for(int i=1;i<=n-1;i++){\n        int uu=w[b[i].u],vv=w[b[i].v];\n        s[b[i].u]+=vv;\n        s[b[i].v]+=uu;\n        if(uu>zd[b[i].v]){\n            cd[b[i].v]=zd[b[i].v];\n            zd[b[i].v]=uu;\n        }\n        else{\n            if(uu>cd[b[i].v]){\n                cd[b[i].v]=uu;\n            }\n        }\n        if(vv>zd[b[i].u]){\n            cd[b[i].u]=zd[b[i].u];\n            zd[b[i].u]=vv;\n        }\n        else{\n            if(vv>cd[b[i].u]){\n                cd[b[i].u]=vv;\n            }\n        }\n    }\n    for(int i=1;i<=n;i++){\n        if(zd[i]*cd[i]>ww){\n            ww=zd[i]*cd[i];\n        }\n    }\n    for(int i=1;i<=n-1;i++){\n        int uu=w[b[i].u],vv=w[b[i].v];\n        int uuu,vvv;\n        vvv=(uu%10007)*((s[b[i].v]-uu)%10007)%10007;\n        uuu=(vv%10007)*((s[b[i].u]-vv)%10007)%10007;\n        tot+=uuu;tot%=10007;\n        tot+=vvv;tot%=10007;\n    }\n    cout<<ww<<\" \"<<tot;\n    return ;\n}\nint main(){\n    //freopen(\"link.in\",\"r\",stdin);\n    //freopen(\"link.out\",\"w\",stdout);\n    cin>>n;\n    if(n<=100){\n        lll();\n    }\n    else{\n        if(n<=2000){\n            mmqm();\n        }\n        else{\n            sxt();\n        }\n    }\n    return 0;\n}\n```",
        "postTime": 1476697655,
        "uid": 19551,
        "name": "NishikinoMaki",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u9996\u5148\u6570\u636e\u53ef\u80fd\u5f88\u5927\uff0c\u90bb\u63a5\u6570\u7ec4\u5b58\u4e0d\u4e0b\u53ef\u80fd\uff0c\u4e8e\u662f\u7528vector\u3002\n\n\u7136\u540e\u8bb0\u5f97\u53d6MOD\uff0c\u4ee5\u9632\u8d85\u8fc72^31\uff0c\u5f53\u7136\u4fdd\u9669\u8fd8\u662f\u8981\u7528long long\u3002\n\n\u6ce8\u610f\u5728\u8ba1\u7b97\u6743\u503c\u548c\u7684\u65f6\u5019\u6709\u4f18\u5316\u7b56\u7565\uff0c\u7528\u524d\u7f00\u548c\u5b9e\u73b0\u3002\n\n\u6ce8\u610f\u7ef4\u62a4\u6700\u5927\u503c\u3002\n\n\n\u9644\u4e2a\u4eba\u4ee3\u7801\uff1a\n\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <cstring>\n#include <vector>\nusing namespace std;\nconst int maxn=400001;\nvector<int> G[maxn];\nint a[maxn];\nlong long b[maxn];\nint n;\nint main()\n{\n    int i;\n    int u,v;\n    int maxa,maxb,max=0;\n    long long sum=0;\n    memset(a,0,sizeof(a));\n    cin>>n;\n    for(i=1;i<=n-1;i++)\n    {\n        cin>>u>>v;\n        G[u].push_back(v);\n        G[v].push_back(u);\n    }\n    for(i=1;i<=n;i++)\n        cin>>a[i];\n    for(i=1;i<=n;i++)\n    {\n        if(G[i].size()>=2)\n        {\n            maxa=0;\n            maxb=0;\n            for(int j=0;j<G[i].size();j++)\n            {\n                if(j==0)\n                    b[j]=a[G[i][j]];\n                else\n                {\n                    b[j]=b[j-1]+a[G[i][j]];\n                    sum+=b[j-1]*a[G[i][j]];\n                    sum%=10007;\n                }\n                if(maxa<a[G[i][j]])\n                {\n                    maxb=maxa;\n                    maxa=a[G[i][j]];\n                    continue;\n                }\n                if(maxb<a[G[i][j]])\n                {\n                    maxb=a[G[i][j]];\n                }\n            } \n            if(maxa*maxb>max)\n            {\n                max=maxa*maxb;\n            }\n        }\n    }\n    sum*=2;\n    sum=sum%10007;\n    cout<<max<<' '<<sum;\n    return 0;\n}\n```",
        "postTime": 1474271959,
        "uid": 19409,
        "name": "dragon_bra",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "```cpp\n\u849f\u84bb\u60f3\u5230\u4e00\u4e2anlogn\u7684\u65b9\u6cd5\u3002\u3002\u53ea\u8fc7\u4e8670%\n\u53ea\u6709n-1\u6761\u8fb9\u7684\u8fde\u901a\u56fe\uff0c\u90a3\u4e48\u663e\u7136\u5c31\u662f\u6811\u4e86\u3002\u3002\u4e8e\u662f\u6211\u4eec\u53ef\u4e0d\u53ef\u4ee5\u628a\u4ed6\u53d8\u6210\u6811\u5728\u5904\u7406\u5462\n\u7528build\u51fd\u6570\u521d\u59cb\u5316\u6811\uff0c\u8282\u70b91\u4f5c\u4e3a\u6839\uff0cfa\u6570\u7ec4\u50a8\u5b58\u5404\u4e2a\u8282\u70b9\u7684\u7236\u4eb2\uff0cvector cs[MAXN]\u50a8\u5b58\u7684\u662f\u7b2c\u4e00\u5c42\u5230\u7b2cn\u5c42\u7684\u8282\u70b9 \uff08\u6839\u5728\u7b2c\u4e00\u5c42\uff09\n\u6211\u4eec\u53c8\u6ce8\u610f\u5230\u6848\u4f8b\u91cc\u9762\u7684\u6709\u5e8f\u70b9\u5bf9\u662f\u6709\u91cd\u590d\u7684\u53ea\u4e0d\u8fc7\uff0c\u4f8b\u5982(1,3) (3,1) \u53ea\u4e0d\u8fc7\u662fx y\u4ea4\u6362\u4e86\u800c\u5df2\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u53ea\u8ba1\u7b97\u4e00\u6b21\uff0c\u7136\u540e\u5230\u6700\u540e\u628asum*2 \u6700\u5927\u503c\u663e\u7136\u4e5f\u4e0d\u4f1a\u53d7\u6b64\u5f71\u54cd\u3002\u3002\n\u7136\u540e\u5c31\u662f\u5904\u7406\u4e86\uff0c\u4ece\u7b2c\u4e00\u5c42\u5f00\u59cb\u5f80\u4e0b\uff0c\u5bf9\u6bcf\u4e00\u5c42\u7684\u8282\u70b9\uff0c\u627e\u51fa\u5176\u4e0e\u5176\u4e0a\u5c42\u8282\u70b9\u7ec4\u6210\u7684\u6240\u6709\u6709\u5e8f\u70b9\u5bf9\n\n\u5bf9\u4e8e\u6bcf\u4e00\u5c42\u7684\u8282\u70b9\uff0c\u663e\u7136\uff0c\u5047\u5982\u5c42\u6570\u5927\u4e8e2\uff0c\u90a3\u4e48\u5176\u4e2d\u6bcf\u4e00\u4e2a\u8282\u70b9\u90fd\u4f1a\u548c[\u4ed6\u7684\u7236\u4eb2\u8282\u70b9\u7684\u7236\u4eb2\u8282\u70b9]\u7ec4\u6210\u4e00\u5bf9\u6709\u5e8f\u70b9\u5bf9\n\u5bf9\u4e8e\u4efb\u610f\u4e00\u5c42\u5c42\u6570\u5927\u4e8e1\u91cc\u7684\u8282\u70b9\uff0c\u82e5\u5176\u4e2d\u6709\u8282\u70b9x1,x2,x3.....\u6709\u76f8\u540c\u7684\u6700\u8fd1\u7236\u4eb2\u8282\u70b9\uff0c\u90a3\u4e48x1 x2 x3 .....\u4e92\u4e3a\u4e00\u5bf9\u6709\u5e8f\u70b9\u5bf9\n\n\u5c31\u662f\u8fd9\u6837-v- \u540c\u65f6\u66f4\u65b0\u6700\u5927\u503c\u548c\u548c\u5c31\u884c\u4e86\n\u6700\u540e\u518d\u5c06\u548c*2%10007\u5c31\u5b8c\u6210\u4e86\n\n\u4ee3\u7801\u5982\u4e0b:\n/*\n\n    \u8054\u5408\u6743\u503c\n    70\u5206\u4ee3\u7801\n\n*/\n\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <vector>\nusing namespace std;\nconst int MAXN=200001+100;\nconst int INF=1000000000;\nbool done[MAXN]={0};\nint W[MAXN]={0},fa[MAXN]={0};\nvector<int> edges[MAXN],tree[MAXN];\nvector<int> samefa[MAXN];\n\nvoid build(int o,int n)\n{\n    if(done[o]) return;\n    done[o]=1;\n    for(int i=0;i<edges[o].size();i++)\n    {\n        int x=edges[o][i];\n        if(!done[x])\n        {\n            fa[x]=o;\n            tree[n+1].push_back(x);\n            build(x,n+1);\n        }\n    }\n}\n\nint main()\n{\n//    freopen(\"data.in\",\"r\",stdin);\n    int n;\n    cin>>n;\n    for(int i=1;i<n;i++)\n    {\n        int x,y;\n        cin>>x>>y;\n        edges[x].push_back(y);\n        edges[y].push_back(x);\n    }\n    for(int i=1;i<=n;i++)\n        cin>>W[i];\n    fa[1]=1;\n    tree[1].push_back(1);\n    build(1,1);\n/*\n    for(int i=1;i<=n;i++)\n    {\n        for(int j=0;j<tree[i].size();j++)\n        {\n            cout<<tree[i][j]<<' ';\n        }\n        cout<<endl;\n    }\n*/\n    int cs=1;\n    int maxi=-INF;\n    long long sum=0;\n    while(tree[cs].size())\n    {\n        int ans=0;\n        for(int i=0;i<tree[cs].size();i++)\n        {\n            if(cs>2)\n            {\n                int x=tree[cs][i];\n                int y=fa[fa[x]];\n                maxi=max(maxi,W[x]*W[y]);\n                sum+=W[x]*W[y];\n                sum%=10007;\n                ans+=W[x]*W[y];\n            }\n            \n            if(cs>1)\n            {\n                int x=tree[cs][i];\n                samefa[fa[x]].push_back(x);\n            }\n            \n            if(i==tree[cs].size()-1)\n            {\n\n                for(int j=0;j<tree[cs-1].size();j++)\n                {\n\n                    int y=tree[cs-1][j];\n                    if(samefa[y].size()>1)\n                    {\n                        for(int k=0;k<samefa[y].size();k++)\n                            for(int l=k+1;l<samefa[y].size();l++)\n                            {\n                                int x=samefa[y][k];\n                                int z=samefa[y][l];\n                                maxi=max(maxi,W[x]*W[z]);\n                                sum+=W[x]*W[z];\n                                ans+=W[x]*W[z];\n                                sum%=10007;\n                            }\n                        samefa[y].clear();\n                    }\n                }\n            }\n/*            cout<<\"samefa=\";\n            for(int ii=0;ii<samefa.size();ii++)\n                cout<<samefa[ii]<<' ';\n            cout<<endl;\n*/        \n        }\n//        cout<<\"cs=\"<<cs<<\" ans=\"<<ans<<endl;\n        cs++;\n    }\n    sum*=2;\n    sum%=10007;\n    cout<<maxi<<' '<<sum;\n    return 0;\n}\n```",
        "postTime": 1471092432,
        "uid": 11585,
        "name": "\u4f0a\u65af\u5361\u5c14\u7684\u98ce",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u6ca1\u6709c\u7684\u9898\u89e3\uff0c\u6211\u4e5f\u6765\u5199\u4e00\u53d1\u3002\n\n\u9996\u5148\u5982\u697c\u4e0a\u51e0\u4f4d\u6240\u8bf4\uff0c\u672c\u9898\u5173\u952e\u5c31\u662f\u4e58\u6cd5\u7ed3\u5408\u5f8b\uff08\u867d\u7136\u6211\u4e00\u5f00\u59cb\u4e5f\u6ca1\u6709\u60f3\u51fa\u6765\n\n\u6709\u4e00\u4e2a\u5de7\u5999\u7684\u65b9\u6cd5\uff0c\u5c31\u662f\u9884\u5904\u7406\uff0c\u628a\u548c\u5148\u52a0\u51fa\u6765\n\n\u8bed\u6587\u5b9e\u5728\u4e0d\u597d\uff0c\u770b\u4ee3\u7801\u6ca1\u51c6\u6709\u52a9\u4e8e\u4f60\u7684\u601d\u8003\n\n```cpp\n/*#include<cstdio>\n#include<cstdlib>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\nstruct\n{ long long u,v;\n}e[200001];\nlong long w[200001];\nlong long max1[200001],max2[200001];\nlong long s[200001];\nvoid work1(long long  u,long long  v)\n{ if(w[u]>max1[v]) { max2[v]=max1[v]; max1[v]=w[u]; }\n            else if(w[u]>max2[v]) max2[v]=w[u];\n}\nvoid work2(long long u,long long v)\n{ if(w[v]>max1[u]) { max2[u]=max1[u]; max1[u]=w[v]; }\n            else if(w[v]>max2[u]) max2[u]=w[v];\n}\nint main()\n{ int u,v,i,j,k,n;\n  long long ans1=0,ans2=0;\n  scanf(\"%d\",&n);\n  for(i=1;i<n;i++) scanf(\"%lld%lld\",&e[i].u,&e[i].v);\n  for(i=1;i<=n;i++) scanf(\"%lld\",&w[i]);\n  for(i=1;i<n;i++)\n  { u=e[i].u; v=e[i].v;\n    s[u]+=w[v]; s[v]+=w[u];\n    work1(u,v); work2(u,v);\n  }\n  for(i=1;i<=n;i++) if(max1[i]*max2[i]>ans1) ans1=max1[i]*max2[i];\n  for(i=1;i<n;i++)\n   { u=e[i].u; v=e[i].v;\n     ans2=(ans2+(s[u]-w[v])*w[v] % 10007) % 10007;\n     ans2=(ans2+(s[v]-w[u])*w[u] % 10007) % 10007;\n   }\n  printf(\"%lld %lld\\n\",ans1,ans2);\n  return 0; \n}*/\n```",
        "postTime": 1469103164,
        "uid": 7980,
        "name": "\u5927\u8868\u54e5",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "\u5982\u679c\u4e24\u4e24\u6c42\uff0c\u90a3\u4e48\u6211\u4eec\u6784\u9020\u4e00\u4e2a\u661f\u5f62\u7684\u56fe\uff0c\u8fd9\u6837\u7684\u70b9\u5bf9\u5c31\u63a5\u8fd1n^2\u5bf9\uff0c\u90a3\u4e48\u590d\u6742\u5ea6\u592a\u9ad8\u3002\n\n\u90a3\u4e48\u5229\u7528\u70b9i\uff0c\u5468\u56f4\u7684\u70b9a,b,c ,\u5982\u679ca\uff0cb\uff0cc\u5728i\u7684\u5468\u56f4\u90a3\u4e48a\uff0cb\uff0cc\u76f8\u4e92\u4e4b\u95f4\u7684\u8ddd\u79bb\u4e00\u5b9a\u662f2\u3002\u90a3\u4e48\u4ed6\u4eec\u4f1a\u4ea7\u751f\u7684\u503c\u6709ab+ac+ba+bc+ca+cb=(a+b+c)^2-a^2-b^2-c^2\n\n\u6545\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u8fd9\u79cd\u65b9\u6cd5\u6c42\u51fa\u4e24\u4e24\u4e4b\u95f4\u7684\u548c\uff0c\u81f3\u4e8e\u6700\u5927\u503c\uff0c\u76f4\u63a5\u9009\u53d6a\uff0cb\uff0cc\u4e2d\u7684\u6700\u5927\u503c\u548c\u6b21\u5927\u503c\u6765\u4ea7\u751f\u6700\u5927\u503c\u3002\n\n\n```delphi\n\nvar\n  n,i,j,newmax,resmax,ressum:longint;\n  u,v,w,max,sum:array[1..200000] of longint;\nbegin\n\n   readln(n);\n   for i:=1 to n-1 do readln(u[i],v[i]);\n   for i:=1 to n do read(w[i]);\n\n   resmax:=0;ressum:=0;\n   fillchar(max,sizeof(max),0);\n   fillchar(sum,sizeof(sum),0);\n\n   for i:=1 to n-1 do\n     begin\n       ressum:=(ressum+(w[u[i]]*sum[v[i]]) mod 10007+(w[v[i]]*sum[u[i]]) mod 10007) mod 10007;//\u8ba1\u7b97\u8054\u5408\u6743\u503c\u4e4b\u548c\n       sum[u[i]]:=(sum[u[i]]+w[v[i]]) mod 10007;\n       sum[v[i]]:=(sum[v[i]]+w[u[i]]) mod 10007;//sum\u7edf\u8ba1\u76f8\u8fde\u63a5\u7684\u4e24\u8282\u70b9\u6743\u503c\u4e4b\u548c\n\n       newmax:=max[u[i]]*w[v[i]];//\u8ba1\u7b97\u6700\u5927\u8054\u5408\u6743\u503c\n       if newmax>resmax then resmax:=newmax;\n       if w[v[i]]>max[u[i]] then max[u[i]]:=w[v[i]];//max\u7edf\u8ba1\u76f8\u8fde\u63a5\u7684\u4e24\u8282\u70b9\u8f83\u5927\u7684\u6743\u503c\n\n       newmax:=max[v[i]]*w[u[i]];\n       if newmax>resmax then resmax:=newmax;\n       if w[u[i]]>max[v[i]] then max[v[i]]:=w[u[i]];\n     end;\n\n   writeln(resmax,' ',(ressum*2) mod 10007);\nend.\n\n```",
        "postTime": 1439902198,
        "uid": 5431,
        "name": "\u96be\u4e0a\u52a0\u5170",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    },
    {
        "content": "60%\uff1a\u7528\u66b4\u529b\u641c\u7d22\u53ef\u4ee5\u5c06\u89e3\u51b360%\u7684\u6570\u636e\uff0c\u5982\u679ci\u548cj\u76f8\u8fde\uff0cj\u548ck\u76f8\u8fde\uff0ci\u548ck\u4e0d\u76f8\u8fde\uff0c\u90a3\u4e48\u53ef\u4ee5\u8ba4\u4e3ai\u548ck\u53ef\u4ee5\u6784\u6210\u8054\u5408\u6700\u5927\u6743\u503c\uff0c\u7528\u4e00\u4e2aO\uff08N^3\uff09\u7684\u5faa\u73af\u5373\u53ef\u3002\n\n\n100%\uff1a\n\n\n\u8fd9\u4e2a\u9898AC\u7684\u601d\u8def\u5f88\u591a\uff0c\u53ef\u4ee5\u8dd1\u6811\uff0c\u7528LCA\u5904\u7406\u4e24\u4e2a\u5144\u5f1f\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u4e5f\u53ef\u4ee5\u8dd1\u56fe\uff0c\u60f3\u8981\uff0c\u5b58\u50a8\u4e00\u5b9a\u8981\u7528\u524d\u5411\u661f\u3002\uff08\u4e0d\u4f1a\u95ee\u5ea6\u5a18\uff09\u3002\u6211\u80fd\u591fAC\u8fd8\u8981\u611f\u8c22@yangs\\_s\uff0c\u5982\u679c\u4e0d\u662f\u4ed6\u7684\u535a\u5ba2http://blog.csdn.net/yangs\\_s/article/details/47359967\uff0c\u8fd9\u4e2a\u9898\u6211\u4e5f\u505a\u4e0d\u51faAC\u6765\u7684\uff0c\u6211\u5728\u8fd9\u91cc\u628a\u4ed6\u7684\u601d\u8def\u8bf4\u4e00\u4e0b\u5427\u3002\n\n\n\u6709\u4e24\u4e2a\u5173\u952e\u70b9\u3002\n\n\n\u9996\u5148\u8f93\u51fa\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u53ef\u4ee5\u628a\u9898\u76ee\u5206\u6210\u4e24\u90e8\u5206\u6765\u770b\uff0c\u5bf9\u4e00\u4e2a\u70b9\u6765\u8bf4\uff0c\u6700\u5927\u7684\u4e58\u79ef\u81ea\u7136\u5c31\u662f\u548c\u5b83\u76f8\u90bb\u7684\u4e24\u4e2a\u6743\u503c\u6700\u5927\u7684\u8282\u70b9\u7684\u6743\u503c\u7684\u4e58\u79ef\uff0c \u8bfb\u5165\u540e\u987a\u624b\u5904\u7406\u4e00\u4e0b\u5c31\u80fd\u51fa\u6765\u3002\n\n\n\u7b2c\u4e8c\u4e2a\u5173\u952e\u70b9\u5c31\u662f\u52a0\u6cd5\u7ed3\u5408\u5f8b\u3002\n\n\n\u6ca1\u9519\uff0c\u52a0\u6cd5\u7ed3\u5408\u5f8b\uff01\n\n\n\u6211\u770b\u5230\u795e\u7287\u7684\u535a\u5ba2\u540e\u4f0f\u6848\u957f\u53f9\uff0c\u8fd9\u662f\u5c0f\u5b66\u4e09\u5e74\u7ea7\u7684\u5185\u5bb9\uff0c\u6211\u5c31\u8fd9\u6837\u8fd8\u7ed9\u8001\u5e08\u4e86\u3002\n\n\n\u6211\u4eec\u5047\u8bbe\u548co\u70b9\u76f8\u90bb\u7684\u70b9\u6709a,b,c,d,e,f,g\u4e03\u4e2a\uff0c\u5047\u8bbe\u4ed6\u4eec\u7684\u6743\u503c\u5c31\u662fa,b,c,d,e,f,g\u3002\u67d0\u4e8c\u903c\u9752\u5e74\u7684\u8ba1\u7b97\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff1asum\uff1a=a\u00b7b+a\u00b7c+a\u00b7d\u2026\u2026.+a\u2026.+e\\*g\u2026.,\u4f46\u5176\u5b9e\u6211\u4eec\u8fd9\u6837\u5904\u7406\uff0c\u6211\u4eec\u5148\u7528\u52a0\u6cd5\u8fd0\u7b97\u6cd5\u5219\uff0c\u53d1\u73b0sum\u5176\u5b9e\u5c31\u662f\u6bcf\u4e2a\u70b9\u7684\u6743\u503c\u4e58\u4ee5\u53ef\u4ee5\u8054\u5408\uff08\u8ddd\u79bb\u4e3a2\uff09\u7684\u8282\u70b9\u7684\u6240\u6709\u6743\u503c\u4e4b\u548c\uff0c\u6240\u4ee5\u8bf4\uff0c\u6211\u4eec\u5728\u8bfb\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u9884\u5148\u5904\u7406\u4e00\u4e0b\uff0c\u628a\u6bcf\u4e2a\u8282\u70b9\u5468\u56f4\u76f8\u90bb\u8282\u70b9\u7684\u6743\u503c\u4e4b\u548c\u7ed9\u52a0\u8d77\u6765\uff0c\u5c31\u4ee5\u4e0a\u8ff0\u4e3a\u4f8b\uff0c\u5728\u5904\u7406\u65f6\uff0c\u628aa,b,c\u2026.g\u7684\u6743\u503c\u52a0\u8d77\u6765\u4e3as[o]{o\u70b9\u76f8\u90bb\u70b9\u7684\u6743\u503c\u4e4b\u548c}\uff0c\u7136\u540e\u5728\u8ba1\u7b97\u65f6\uff0c\u5c31\u53ef\u4ee5\u7528sum:=a\u00b7(s[o]-a)+b\u00b7(s[o]-b)\u2026..\u5f88\u81ea\u7136\u7684\u7ed3\u679c\u5c31\u51fa\u6765\u4e86!\n\n\n\u7b97\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5e94\u8be5\u662fO\uff08kn\uff09\uff0ck\u5e94\u8be5\u662f\u4e00\u4e2a\u5f88\u5c0f\u5f88\u5c0f\u8fdc\u5c0f\u4e8eN\u7684\u5e38\u6570\uff0c\u5e94\u8be5\u548cLCA\u7684\u5dee\u4e0d\u591a\u4e86\u5427\u3002\n\n```delphi\n(const ma=10007;  \nconst mx=200000;  \n  \ntype ss=record  \n    u,v:longint;  \n    end;  \n  \nvar s:array[1..mx] of int64;//s[i]\u8868\u793a\u548c\u7ed3\u70b9i\u6240\u6709\u76f8\u8fde\u7684\u70b9\u7684\u6743\u503c\u4e4b\u548c  \n    e:array[1..mx] of ss;//\u5b58\u7684\u662f\u8fb9  \n    w,max1,max2:array[1..mx]of longint;  \n{w[i]\u8868\u793a\u7b2ci\u4e2a\u70b9\u7684\u6743\u503c \n max1[i]\u8868\u793a\u548ci\u76f8\u8fde\u5f97\u7ed3\u70b9\u4e2d\u6743\u503c\u6700\u5927\u7684\u7ed3\u70b9 \n max2[i]\u8868\u793a\u548ci\u76f8\u8fde\u5f97\u7ed3\u70b9\u4e2d\u6743\u503c\u6700\u5c0f\u7684\u7ed3\u70b9 \n }  \n    n,i,j,ans1,ans2:longint;  \n  \nprocedure box;  \nvar i,j:longint;  \nbegin  \n    fillchar(s,sizeof(s),0);  \n    fillchar(e,sizeof(e),0);  \n    fillchar(w,sizeof(w),0);  \n    fillchar(max1,sizeof(max1),0);  \n    fillchar(max2,sizeof(max2),0);  \n    ans1:=0;  \n    ans2:=0;  \nend;  \n//\u53d8\u91cf\u521d\u59cb\u5316  \n  \nprocedure work(x:longint;var a,b:longint);  \n//x\u7684\u503c\u662f\u4e0d\u4f1a\u88ab\u6539\u53d8\u7684\uff0ca\u548cb\u662f\u53ef\u4ee5\u88ab\u6539\u53d8\u7684  \nbegin  \n//\u9996\u5148\u5df2\u7ecf\u5f97\u51fa\u503c\u7684\u6570\u7ec4\u662f\u5408\u6cd5\u7684\uff0c\u518d\u6b21\u66f4\u6539\u8fc7\u540e\u4e5f\u4e00\u5b9a\u662f\u5408\u6cd5\u7684  \n    if x>a then  \n        begin  \n            b:=a;  \n            a:=x;  \n        end  \n    else  \n        if x>b then b:=x;  \nend;  \n//\u7528\u6765\u6bd4\u8f83\u5927\u5c0f\u7684\u8fc7\u7a0b\uff0c\u5fc5\u987b\u7528\u5168\u5c40\u53d8\u91cf  \n  \nprocedure change;  \nvar i,u,v:longint;  \nbegin  \n    for i:=1 to n-1 do  \n        begin  \n            u:=e[i].u;  \n            v:=e[i].v;  \n            inc(s[u],w[v]);  \n            inc(s[v],w[u]);  \n            work(w[v],max1[u],max2[u]);  \n            work(w[u],max1[v],max2[v]);  \n            //\u4e0d\u65ad\u66f4\u65b0\u7ed3\u70b9\u5468\u56f4\u7684\u6700\u5927\u503c\u548c\u6b21\u5927\u503c  \n        end;  \nend;  \n//\u9884\u5904\u7406\u7a0b\u5e8f  \n  \nprocedure main1;  \nvar i:longint;  \nbegin  \n    for i:=1 to n do  \n        if max1[i]*max2[i]>ans1 then  \n            ans1:=max1[i]*max2[i];  \nend;  \n//\u5904\u7406\u6700\u5927\u7684\u8054\u5408\u6743\u503c  \n  \nprocedure main2;  \nvar i,j,u,v:longint;  \nbegin  \n    for i:=1 to n-1 do  \n        begin  \n            u:=e[i].u;  \n            v:=e[i].v;  \n            ans2:=(ans2+((s[u]-w[v])*w[v]) mod ma) mod ma;  \n            ans2:=(ans2+((s[v]-w[u])*w[u]) mod ma) mod ma;  \n        end;  \nend;  \n//\u5904\u7406\u6743\u503c\u4e4b\u548c  \n  \nprocedure init;  \nvar i,j:longint;  \nbegin  \n    readln(n);  \n    for i:=1 to n-1 do  \n        readln(e[i].u,e[i].v);  \n    for i:=1 to n do read(w[i]);  \nend;  \n  \nprocedure printf;  \nbegin  \n    writeln(ans1,' ',ans2);  \nend;  \n  \nbegin  \n    box;  \n    init;  \n    change;  \n    main1;  \n    main2;  \n    printf;  \nend.  )\n\n```",
        "postTime": 1439287571,
        "uid": 6906,
        "name": "gryql",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1351 \u3010\u8054\u5408\u6743\u503c\u3011"
    }
]