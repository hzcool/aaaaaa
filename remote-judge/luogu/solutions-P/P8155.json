[
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P8155)\n\n\u5728\u5f00\u59cb\u524d\u6211\u4eec\u5148\u601d\u8003\u4e00\u4e2a\u7b80\u5316\u7248\uff1a\n\n$n$ \u7b49\u4e8e $1$ \u600e\u4e48\u529e\uff1f\n\n\u6211\u4eec\u5c06 $a_1$ \u62c6\u6210 $\\gcd(a_1,m)\\times x$\uff0c\u7136\u540e\u4e00\u6b21\u64cd\u4f5c\u5c31\u76f8\u5f53\u4e8e\u5c06 $a_1$ \u53d8\u6210 $\\gcd(a_1,m)\\times (x+1)$\u3002\n\n\u4f46\u662f $x$ \u4f1a\u5c31\u8fd9\u6837\u4e00\u76f4\u52a0\u4e0b\u53bb\u5417\uff1f\u663e\u7136\u4e0d\u662f\u7684\u3002\u5f53 $\\gcd(\\frac{m}{\\gcd(a_1,m)},x)>1$ \u65f6\uff0c$\\gcd(a_1,m)$ \u4f1a\u4e58 $y$\uff0c$x$ \u4f1a\u9664\u4ee5 $y$\u3002 \n\n\u4f46\u662f\u4e0a\u8ff0\u64cd\u4f5c\u53ea\u4f1a\u8fdb\u884c\u5927\u7ea6 $\\log m$ \u6b21\u3002\u56e0\u4e3a $\\gcd(a_1,m)<=m$\uff0c\u6240\u4ee5\u4e0d\u53ef\u80fd\u505a\u8d85\u8fc7 $\\log m$ \u6b21\u4e58\u6cd5\u3002\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u6c42\u51fa\u6bcf\u6b21\u64cd\u4f5c\u76f8\u6bd4\u4e0a\u4e00\u6b21 $x$ \u52a0\u4e86\u591a\u5c11\uff0c\u5c31\u80fd\u6c42\u51fa\u6700\u7ec8\u53d8\u6362\u6b21\u6570\u3002\n\n\u600e\u4e48\u6c42\u5462\uff1f\n\n\u6211\u4eec\u5148\u6c42\u51fa\u6240\u6709\u5f53\u524d $\\frac{m}{\\gcd(a_1,m)}$ \u7684\u8d28\u56e0\u5b50\u7684\u500d\u6570\u4e2d $\u2265x$ \u4e14\u503c\u6700\u5c0f\u7684\u6570\uff0c\u8fd9\u5c31\u662f\u6211\u4eec\u4e0b\u4e00\u6b21\u64cd\u4f5c\u65f6 $x$ \u7684\u503c\u3002\u7136\u540e\u66f4\u65b0 $\\gcd(a_1,m)$ \u548c $x$ \u5230\u4e0b\u4e00\u6b21\u64cd\u4f5c\u540e\u7684\u503c\u3002\n\n\u5c31\u8fd9\u6837\u505a\u5927\u7ea6 $\\log m$ \u6b21\uff0c\u76f4\u5230 $\\gcd(a_1,m)=m$ \u5c31\u53ef\u4ee5\u6c42\u51fa\u7b54\u6848\u3002\n\n\u7136\u540e\u6269\u5c55\u5230\u539f\u9898\u3002\n\n\u9996\u5148\u9700\u8981\u77e5\u9053 $\\gcd(a,b,c)=\\gcd(\\gcd(a,b),c)$\u3002\n\n\u5bf9\u4e8e $a_i$\uff0c\u6211\u4eec\u53d1\u73b0\u524d\u9762\u7684 $\\gcd(a_1,a2,...,a_{i-1})$ \u53ea\u6709\u5927\u7ea6 $\\log m$ \u79cd\u53ef\u80fd\u3002\n\n\u4e3a\u4ec0\u4e48\uff1f\n\n\u5148\u8bc1\u660e\u6bcf\u6b21\u4ece\u524d\u9762\u8fc7\u6765\u7684 $\\gcd$ \u90fd\u662f\u4e0a\u4e00\u6b21\u7684\u500d\u6570\u3002\n\n\u6211\u4eec\u8003\u8651\u9012\u63a8\u8bc1\u660e\u3002\n\n\u5047\u8bbe $\\gcd(m,a_1,a2,...,a_{i-1})$ \u6ee1\u8db3\u4e0a\u8ff0\u60c5\u51b5\u3002\u82e5 $a_i$ \u4e0d\u53d8\u5219\u5f88\u7b80\u5355\u3002\u73b0\u5728\u6709 $x$ \u7684\u5f71\u54cd\u3002\u4f46\u662f $x$ \u7684\u8d28\u56e0\u5b50\u53ea\u8981\u88ab\u4e58\u8fdb $\\gcd$ \u91cc\u9762\u5c31\u4e0d\u4f1a\u518d\u51fa\u6765\u4e86\u3002\u6240\u4ee5 $\\gcd(m,a_1,a2,...,a_i)$ \u6ee1\u8db3\u4e0a\u8ff0\u60c5\u51b5\u3002\n\n\u540c\u65f6 $\\gcd(m)$ \u6ee1\u8db3\u4e0a\u8ff0\u60c5\u51b5\uff0c\u987a\u7740\u63a8\u4e0b\u53bb\u5373\u53ef\u3002\u8bc1\u6bd5\u3002\n\n\u7136\u540e\u5f88\u7b80\u5355\u7684\u7ed3\u8bba\uff1a**\u6bcf\u6b21 $\\gcd$ \u6539\u53d8\u90fd\u4f1a\u4e58\u4e00\u4e2a\u6570**\u3002\u6700\u591a\u4e58 $\\log m$ \u6b21\uff0c\u6240\u4ee5\u53ea\u4f1a\u6709 $\\log m$ \u79cd\u53ef\u80fd\u3002\n\n\u4e8e\u662f\u5bf9\u4e8e\u524d\u9762\u8fc7\u6765\u7684\u6bcf\u4e2a $\\gcd$\uff0c\u6211\u4eec\u90fd\u6309\u7167 $n=1$ \u64cd\u4f5c\u4e00\u904d\uff0c\u53ea\u4e0d\u8fc7\u591a\u4e86\u4e2a\u53d8\u6362\u6b21\u6570\u4e0a\u9650\u3002\u7136\u540e\u5c31\u53ef\u4ee5\u6c42\u51fa\u6bcf\u4e2a\u4f4d\u7f6e\u7684 $a_i$ \u9700\u8981\u53d8\u6362\u51e0\u6b21\u624d\u80fd\u7b26\u5408\u8981\u6c42\u3002\u53d6 $\\max$ \u5373\u53ef\u3002\n\n\u56e0\u4e3a\u5206\u89e3\u8d28\u56e0\u6570\u662f $O(\\sqrt{m})$ \u7684\uff0c\u6240\u4ee5\u4f5c\u8005\u5148\u5206\u89e3\u7136\u540e\u76f4\u63a5\u7528\u8d28\u56e0\u6570\u505a\u3002\u590d\u6742\u5ea6\u591a\u4e86\u4e00\u4e2a $\\log$\u3002\n\n\u590d\u6742\u5ea6 $O(\\sqrt{m}+n\\log^2m)$ \n\n\u5176\u5b9e\u590d\u6742\u5ea6\u662f\u4e0d\u5230\u7684\u3002\u56e0\u4e3a\u91cc\u9762\u5927\u591a\u6570\u7684\u6570\u90fd\u6ca1\u6709 $\\log m$ \u4e2a\u8d28\u56e0\u6570\u3002\n\n\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define ull unsigned long long\n#define N 100010\nusing namespace std;\n\null n,m,a[N],f[2][65][65],t[2][65],cnt[2],c[2][65],ans;\n\nint main()\n{\n\tcin>>n>>m;\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%llu\",&a[i]);\n\tull x=2;\n\twhile(m>1)\n\t{\n\t\tif(m%x==0) \n\t\t\tm/=x,f[0][1][++c[0][1]]=x,x=1;\n\t\tx++;if(x*x>m) break;\n\t}\n\tif(m!=1) f[0][1][++c[0][1]]=m;\n\tt[0][2]=8e18;cnt[0]=1;\n\tull now,cur;bool u;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tu^=1;cur=a[i];cnt[u]=0;now=0;\n\t\tmemset(f[u],0,sizeof(f[u]));\n\t\tmemset(c[u],0,sizeof(c[u]));\n\t\tfor(int j=1;j<=cnt[u^1];j++)\n\t\t{\n\t\t\tcur+=(t[u^1][j]-now);now=t[u^1][j];\n\t\t\tull p=t[u^1][j+1],w[60];int c1,nd;\n\t\t\twhile(true)\n\t\t\t{\n\t\t\t\tc1=1;nd=0;\n\t\t\t\tfor(int k=1;k<=c[u^1][j];k++)\n\t\t\t\t\tif(f[u^1][j][k]!=f[u][cnt[u]][c1])\n\t\t\t\t\t\tw[++nd]=f[u^1][j][k];\n\t\t\t\t\telse c1++;\n\t\t\t\tull mi=8e18,q=-1;\n\t\t\t\tfor(int k=1;k<=nd;k++)\n\t\t\t\t\tif(((cur-1)/w[k]+1)*w[k]-cur<=p-now)\n\t\t\t\t\t\tif(((cur-1)/w[k]+1)*w[k]-cur<mi)\n\t\t\t\t\t\t\tmi=((cur-1)/w[k]+1)*w[k]-cur,q=w[k];\n\t\t\t\tif(q==-1) break;\n\t\t\t\tnow+=((cur-1)/q+1)*q-cur;cur=(cur-1)/q+1;\n\t\t\t\tcnt[u]++;\n\t\t\t\tfor(int k=1;k<=c[u][cnt[u]-1];k++)\n\t\t\t\t\tf[u][cnt[u]][k]=f[u][cnt[u]-1][k];\n\t\t\t\tc[u][cnt[u]]=c[u][cnt[u]-1];\n\t\t\t\tf[u][cnt[u]][++c[u][cnt[u]]]=q;\n\t\t\t\tint s=c[u][cnt[u]];\n\t\t\t\twhile(s>1&&f[u][cnt[u]][s]<f[u][cnt[u]][s-1])\n\t\t\t\t\tswap(f[u][cnt[u]][s],f[u][cnt[u]][s-1]),s--;\n\t\t\t\tt[u][cnt[u]]=now;\n\t\t\t}\n\t\t}\n\t\tans=max(ans,now);t[u][cnt[u]+1]=8e18;\n\t}\n\tcout<<ans<<endl;\n\treturn 0;\n}\n\n```\n",
        "postTime": 1644855975,
        "uid": 546289,
        "name": "Link_Cut_qwq",
        "ccfLevel": 7,
        "title": "P8155 \u300cPMOI-5\u300d\u516c\u7ea6\u6570\u53d8\u6362"
    }
]