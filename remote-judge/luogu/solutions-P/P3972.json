[
    {
        "content": "\u5728\u7f51\u4e0a\u542c\u4eba\u8bf4\u8fd9\u9898\u66b4\u529b\u53ef\u8fc7\uff0c\u672c\u7740no zuo no die\u7684\u5fc3\u6001\u8bd5\u4e86\u4e00\u53d1...\n\n\u7ed3\u679c\u4e0d\u4ec5\u8fc7\u4e86\uff0c\u8fd8\u8dd1\u5f97\u6bd4\u9999\u6e2f\u8bb0\u8005\u8fd8\u5feb\uff0c\u6211\u751a\u81f3\u8fd8\u6ca1\u5f00\u6c27\u6c14\u4f18\u5316\uff01\n\n~~\u6211\u5c06\u53d1\u52a8\u540c\u5b66\u5199\u6b64\u9898\uff0c\u6b64\u9898\u5c06\u6210\u4e3a\u4e00\u9053\u7701\u9009\u7ea2\u9898~~\n\n\u6b63\u89e3\u597d\u50cf\u662f\u5e73\u8861\u6811?\n\nupd:\u52a0\u70b9~~\u5b8c\u5168\u4e0d\u5fc5\u8981\u7684~~\u8bf4\u660e\n\nid/fid\u8bb0\u5f55\u6bcf\u90e8\u7535\u5f71\u5b58\u5728\u6570\u7ec4\u91cc\u7684\u7f16\u53f7/R\u64cd\u4f5c\u7ed9\u51fa\u7684\u7f16\u53f7\n\nQ:\u76f4\u63a5\u628a\u6240\u6709\u7535\u5f71\u5b58\u8fdb\u6570\u7ec4\u6392\u5e8f\u5373\u53ef\n\nR:\u76f4\u63a5\u6309\u9898\u610f\u6a21\u62df\u5373\u53ef\n\nC:fid\u8f6c\u6362\u7f16\u53f7\u76f4\u63a5\u6309\u9898\u610f\u4fee\u6539\u5373\u53ef\n\n\u76f4\u63a5\u66b4\u529b\u641e\u5c31\u597d\u4e86\n\n\u4e0a\u4ee3\u7801\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef double ddf;\nconst int N=100000+10;\nint id[N],fid[N],ac[N],tot,n;\nddf s[N];\nstruct node{\n\tddf x;\n\tint y;\n}a[N];\nbool cmp(node a,node b){\n\treturn a.x==b.x?a.y<b.y:a.x>b.x;\n}\nchar b[16];\nint main(){\n\tint x,y,z;\n\tddf xp,yp,zp;\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%s\",b);\n\t\tif(b[0]=='Q'){\n\t\t\tscanf(\"%d\",&x);\n\t\t\tfor(int i=1;i<=tot;i++)a[i]=(node){s[i],i};\n\t\t\tsort(a+1,a+1+tot,cmp);\n\t\t\tprintf(\"%d\\n\",id[a[x].y]);\n\t\t}\n\t\telse if(b[0]=='R'){\n\t\t\tint mx=0;\n\t\t\tscanf(\"%d%d\",&x,&y);\n\t\t\tid[++tot]=x;\n\t\t\tfid[x]=tot;\n\t\t\tfor(int i=1;i<=y;i++){\n\t\t\t\tscanf(\"%d\",&z);\n\t\t\t\tmx=max(mx,ac[z]);\n\t\t\t\tac[z]=tot;\n\t\t\t}\n\t\t\ts[tot]=s[mx];\n\t\t}\n\t\telse {\n\t\t\tscanf(\"%d%lf\",&x,&xp);\n\t\t\tx=fid[x];\n\t\t\ts[x]=(s[x]+xp)/2;\n\t\t}\n\t}\n\treturn 0;\n}\n/*\n10\nR 1 1 1\nR 2 2 1 2\nC 2 2\nR 3 1 2\nQ 1\nC 3 2\nC 1 5\nQ 1\nQ 2\nQ 3\n*/\n```",
        "postTime": 1522282412,
        "uid": 38725,
        "name": "xiwang",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3972 \u3010[TJOI2014]\u7535\u5f71\u8bc4\u5206\u3011"
    },
    {
        "content": "## Solution\n\n\u6709\u79cd\u505a\u6cd5\u662f\u66b4\u529b\uff0c\u5229\u7528\u5feb\u6392\u53ef\u4ee5\u5728 $\\mathcal O(n)$ \u7684\u65f6\u95f4\u5185\u6c42\u51fa\u533a\u95f4\u7b2c $k$ \u5927\uff0c\u505a\u5230\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O(n^2)$\uff0c\u5438\u4e0b\u6c27\u5e94\u8be5\u80fd\u8fc7\u3002\n\n\u6b63\u89e3\u662f\u540e\u7f00\u5e73\u8861\u6811\uff0c\u5c06\u5c0f\u6570\u5206\u6210\u6574\u6570\u90e8\u5206\u548c\u5c0f\u6570\u90e8\u5206\uff0c\u5c0f\u6570\u90e8\u5206\u7528\u4e8c\u8fdb\u5236\u8868\u793a\uff0c\u7136\u540e\u6765\u6bd4\u8f83\u3002\n\n\u4f46\u6b63\u89e3\u6211\u4e5f\u4e0d\u4f1a\uff0c\u6211\u5c31\u53ea\u6253\u4e86 $\\mathrm{Splay}$\uff0c\u7531\u4e8e\u6015\u88ab\u5361\u7cbe\u5ea6\u4e8e\u662f\u7528\u4e86 $\\mathrm{long\\ double}$\u3002\n\n\u5269\u4e0b\u7684\u5c31\u8ddf\u666e\u901a\u7684 $\\mathrm{Splay}$ \u5dee\u4e0d\u591a\u3002\n\n## Code\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#define N 100005\n#define eps 1e-60\n#define ldb long double\nusing namespace std;\nint n,cnt,rt,t[N],lst[N],size[N],f[N],c[N][2];\nldb val[N];\nchar ch[16];\nldb Abs(ldb x) {return x<0?-x:x;}\nvoid Update(int x)\n{\n    int l=c[x][0],r=c[x][1];\n    size[x]=size[l]+size[r]+1;\n}\nvoid Rotate(int x,int &k)\n{\n    int y=f[x],z=f[y],l=x==c[y][1],r=l^1;\n    r=l^1;\n    if (y==k) k=x;\n    else c[z][y==c[z][1]]=x;\n    f[c[x][r]]=y;f[y]=x;f[x]=z;\n    c[y][l]=c[x][r];c[x][r]=y;\n    Update(x);Update(y);\n}\nvoid Splay(int x,int &k)\n{\n    while (x!=k)\n    {\n        int y=f[x],z=f[y];\n        if (y!=k)\n        {\n            if (x==c[y][1]^y&&c[y][1]^y==c[z][1]) Rotate(x,k);\n            else Rotate(y,k);\n        }\n        Rotate(x,k);\n    }\n}\nvoid Insert(int &now,int x,int fa)\n{\n    if (!now)\n    {\n        now=x;\n        f[now]=fa;\n        c[now][0]=c[now][1]=0;\n        Splay(now,rt);\n        return;\n    }\n    if (val[x]>val[now]||Abs(val[x]-val[now])<eps&&t[x]<t[now]) Insert(c[now][0],x,now);\n    else Insert(c[now][1],x,now);\n}\nvoid Delete(int x)\n{\n    Splay(x,rt);\n    if (c[x][0]*c[x][1]==0)\n    {\n        rt=c[x][0]+c[x][1];\n        f[c[x][0]+c[x][1]]=0;\n        return;\n    }\n    int pre=c[x][0],suf=c[x][1];\n    while (c[pre][1]) pre=c[pre][1];\n    while (c[suf][0]) suf=c[suf][0];\n    Splay(pre,rt);Splay(suf,c[pre][1]);\n    c[suf][0]=f[x]=0;\n    Update(pre);Update(suf);\n}\nint Get(int now,int rk)\n{\n    if (size[c[now][0]]+1==rk) return now;\n    if (rk<=size[c[now][0]]) return Get(c[now][0],rk);\n    return Get(c[now][1],rk-size[c[now][0]]-1);\n}\nint main()\n{\n    freopen(\"movie.in\",\"r\",stdin);\n    freopen(\"movie.out\",\"w\",stdout);\n    scanf(\"%d\",&n);\n    while (n--)\n    {\n        scanf(\"%s\",ch);\n        if (ch[0]=='R')\n        {\n            int x,num,act,k=0;\n            scanf(\"%d%d\",&x,&num);\n            for (int i=1;i<=num;++i)\n            {\n                scanf(\"%d\",&act);\n                if (t[lst[act]]>t[k]) k=lst[act];\n                lst[act]=x;\n            }\n            val[x]=val[k];\n            t[x]=++cnt;\n            size[x]=1;\n            Insert(rt,x,0);\n        }\n        else if (ch[0]=='C')\n        {\n            int x;ldb v;\n            scanf(\"%d%Lf\",&x,&v);\n            Delete(x);\n            val[x]=(val[x]+v)/2;\n            Insert(rt,x,0);\n        }\n        else if (ch[0]=='Q')\n        {\n            int x;\n            scanf(\"%d\",&x);\n            printf(\"%d\\n\",Get(rt,x));\n        }\n    }\n    return 0;\n}\n```\n\n",
        "postTime": 1642293633,
        "uid": 166078,
        "name": "Thunder_S",
        "ccfLevel": 6,
        "title": "P3972 [TJOI2014]\u7535\u5f71\u8bc4\u5206"
    },
    {
        "content": "\u770b\u9898\u89e3\u8bf4\u8fd9\u9898\u66b4\u529b\u53ef\u8fc7\uff0c\u672c\u7740no zuo no die\u7684\u5fc3\u6001\u8bd5\u4e86\u4e00\u53d1...  \n\u7ed3\u679c\u4e0d\u4ec5\u6ca1\u8fc7\uff0c\u8fd8T\u4e86\u4e24\u4e2a\u70b9\uff0c\u751a\u81f3\u8fd8\u5f00\u4e86\u6c27\u6c14\u4f18\u5316  \n~~\u540e\u6765\u53d1\u73b0\u7528\u7684\u662fcin\uff0c\u6539\u6210scanf\u5c31\u884c\u4e86~~  \n\u6b63\u89e3\u597d\u50cf\u662f\u66b4\u529b?  \n\u76f4\u63a5\u66b4\u529b\u641e\u5c31\u597d\u4e86  \n\u4e0a\u4ee3\u7801  \n```cpp\n#include <cstdio>\n\nusing namespace std;\n\nint tmp;\nvoid swap(int &a,int &b)\n{\n    tmp=a;\n    a=b;\n    b=tmp;\n}\n\nconst int maxn=100001;\nint Actor_Movie[maxn]={};//\u6f14\u5458\u6700\u540e\u4e00\u90e8\u7535\u5f71\u7684ID \nint Actor_Time[maxn]={};//\u6f14\u5458\u6700\u540e\u4e00\u6b21\u6f14\u51fa\u65f6\u95f4 \nint movie[maxn]={};//\u6392\u540d\u4e3ai\u7684\u7535\u5f71id \ndouble movietime[maxn]={};//\u7535\u5f71\u4e0a\u6620\u65f6\u95f4 \ndouble score[maxn]={};//\u7535\u5f71id\u7684\u5206\u6570 \nint n;\n\nint main()\n{\n    scanf(\"%d\",&n);\n    int id,x,NearestActor,actor[maxn]={};\n    int Time=0;\n\tchar op;\t\n    double y;\n    for(int i=1;i<=n;i++)\n    {\n        scanf(\"%s\",&op);\n        if(op=='R')//\u65b0\u7535\u5f71 \n        {\n            scanf(\"%d%d\",&id,&x);\n            movietime[id]=(++Time)/100000000.0;\n            NearestActor=0;\n            for(int i=1;i<=x;i++)\n            {\n                scanf(\"%d\",&actor[i]);\n                if(Actor_Movie[actor[i]] && Actor_Time[actor[i]]>Actor_Time[NearestActor])\n                    NearestActor=actor[i];\n            }\n            score[id]=score[Actor_Movie[NearestActor]];\n            for(int i=1;i<=x;i++)\n            {\n                Actor_Time[actor[i]]=Time;\n                Actor_Movie[actor[i]]=id;\n            }\n            movie[Time]=id;\n            for(int i=Time;i>1;i--)\n            {\n                if(score[movie[i]]-movietime[movie[i]]>score[movie[i-1]]-movietime[movie[i-1]])\n                    swap(movie[i],movie[i-1]);\n                else\n                    break;\n            }\n        }\n        else if(op=='C')//\u6539\u5206 \n        {\n            scanf(\"%d%lf\",&id,&y);\n            score[id]=(score[id]+y)/2.0;\n            for(int i=1;i<=Time;i++)\n                if(movie[i]==id)\n                {\n                    for(int j=i;j<Time;j++)\n                        movie[j]=movie[j+1];\n                    movie[Time]=id;\n                    for(int j=Time;j>1;j--)\n                    {\n                        if(score[movie[j]]-movietime[movie[j]]>score[movie[j-1]]-movietime[movie[j-1]])\n                            swap(movie[j],movie[j-1]);\n                        else\n                            break;\n                    }\n                    break;\n                }\n        }\n        else//\u67e5\u6392\u540d \n        {\n            scanf(\"%d\",&x);\n            printf(\"%d\\n\",movie[x]);\n        }\n    }\n    return 0;\n}\n\n```\n",
        "postTime": 1551342976,
        "uid": 38188,
        "name": "\u6570\u5b66\u7cfb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3972 \u3010[TJOI2014]\u7535\u5f71\u8bc4\u5206\u3011"
    }
]