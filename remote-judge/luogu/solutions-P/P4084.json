[
    {
        "content": "\u7ecf\u5178\u7684**\u6811\u5f62DP**\uff0c\u9002\u5408\u5165\u95e8\u7ec3\u624b\n\n\u8fdb\u5165\u6b63\u9898\uff1a\n\n- f[i][j]\u8868\u793ai\u8fd9\u4e2a\u70b9\u4e0a\u8272\u4e3aj\u662f\u65b9\u6848\u6570\uff08**\u4ece\u4e0b\u5f80\u4e0a/\u4ece\u5b50\u8282\u70b9\u5411\u7236\u8282\u70b9\u66f4\u65b0**\uff09\n- \u5373\u5bf9\u4e8e\u6240\u6709\u521d\u59cb\u8282\u70b9\uff0c**f[i][1],f[i][2],f[i][3]\u90fd\u4e3a1**\n- \u5f53\u67d0\u4e2a\u8282\u70b9\u88ab\u6307\u5b9a\u4e0a\u8272\u540e\uff0c\u90a3\u4e48\u8be5\u8282\u70b9\u53e6\u5916\u4e24\u79cd\u989c\u8272\u7684\u65b9\u6848\u6570\u4e3a0\u3002\n  \n  \u5217\u5982:\u5f53\u70b9x\u88ab\u6307\u5b9a\u4e0a\u8272 2 \u65f6\uff1af[x][1]=0,f[x][3]=0 (\u56e0\u4e3a\u65e0\u6cd5\u4e0a\u82721\u548c3\uff09\n- \u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\uff0c\u56e0\u4e3a\u4e0d\u80fd\u4e8e\u5b50\u8282\u70b9\u4e0a\u8272\u76f8\u540c,\u5373\uff1a\n\n```\n   f[x][0]=f[x][0]*(f[son[i]][1]+f[son[i]][2]);\n   f[x][1]=f[x][1]*(f[son[i]][0]+f[son[i]][2]);\n   f[x][2]=f[x][2]*(f[son[i]][1]+f[son[i]][0]);\n```\n\n- \u6700\u540e\uff0c\u8bb0\u5f97**\u53d6\u6a21\u548c\u5f00long long**\n\n\u4ee3\u7801\u53c2\u8003\uff1a\n\n```\n#include<bits/stdc++.h>\n#define maxn 200005\n#define ll long long\nusing namespace std;\nconst int TT=1e9+7;\nint n,x,y,lnk[maxn],nxt[maxn],son[maxn],tot,m;\nll f[maxn][3];\ninline int read(){\n\tint ret=0,f=1;char ch=getchar();\n\twhile (ch<'0'||ch>'9'){if (ch=='-') f=-f;ch=getchar();}\n\twhile (ch<='9'&&ch>='0') ret=ret*10+ch-'0',ch=getchar();\n\treturn ret*f;\n}\ninline void add(int x,int y){nxt[++tot]=lnk[x];lnk[x]=tot;son[tot]=y;}\ninline void Dfs(int x,int fa){\n\tfor (int i=0;i<3;i++){\n\t\tif (f[x][i]){for (int j=0;j<i;j++) f[x][j]=0;break;}\n\t\tf[x][i]=1;\n\t}\n\tfor (int i=lnk[x];i;i=nxt[i])\n\t  if (son[i]!=fa){\n\t  \tDfs(son[i],x);\n\t  \tf[x][0]=f[x][0]*((f[son[i]][1]+f[son[i]][2])%TT)%TT;\n                f[x][1]=f[x][1]*((f[son[i]][0]+f[son[i]][2])%TT)%TT;\n                f[x][2]=f[x][2]*((f[son[i]][1]+f[son[i]][0])%TT)%TT;\n\t  }\n}\nint main(){\n\tn=read(),m=read();\n\tfor (int i=1;i<n;i++) x=read(),y=read(),add(x,y),add(y,x);\n\tfor (int i=1;i<=m;i++) x=read(),y=read()-1,f[x][y]=1;\n\tDfs(1,0);\n\tprintf(\"%lld\",(f[1][0]+f[1][1]+f[1][2])%TT);\n\treturn 0;\n}\n```\n",
        "postTime": 1565875791,
        "uid": 108047,
        "name": "LlLlCc",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4084 \u3010[USACO17DEC]Barn Painting\u3011"
    },
    {
        "content": "\u53c8\u662f\u4e00\u9053\u6811\u5f62dp\u7684\u9898\n\n\u8fd9\u9053\u9898\u548c[P1352 \u6ca1\u6709\u4e0a\u53f8\u7684\u821e\u4f1a](https://www.luogu.org/problemnew/show/P1352)\u8fd8\u662f\u633a\u50cf\u7684\uff0c\u8fd9\u4e2a\u53ef\u80fd\u66f4\u52a0\u590d\u6742\u4e00\u4e9b\u3002\u4e0d\u8fc7\u6211\u89c9\u5f97\u96be\u5ea6\u53ef\u80fd\u90fd\u8fd8\u5c5e\u4e8e\u6811\u5f62dp\u7684\u5165\u95e8\u9898\u3002\n\n\u6811\u5f62dp\u672c\u8d28\u4e0a\u6765\u8bf4\u5c31\u662fdfs\u4e00\u904d\u6811\u7136\u540e\u8fdb\u884c\u9012\u63a8\uff0c\u8fd9\u9053\u9898\u4e2d\u53ef\u4ee5\u5f00\u4e2a\u4e8c\u7ef4\u7684\u6570\u7ec4dp[i][j]\u8868\u793a\u7f16\u53f7\u4e3ai\u7684\u70b9\u6d82\u4e0aj\u989c\u8272\u7684\u65b9\u6848\u6570\u3002\n\n\u663e\u7136\u6bcf\u4e2a\u70b9\u7684\u65b9\u6848\u6570\u548c\u5b83\u7684\u5b50\u6811\u662f\u6709\u5173\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u5148\u904d\u5386\u5230\u53f6\u5b50\u8282\u70b9\u7136\u540e\u4e00\u6b65\u6b65\u5f80\u56de\u63a8\u3002\n\n\u7531\u4e8e\u76f8\u90bb\u7684\u70b9\u989c\u8272\u4e0d\u80fd\u76f8\u540c\uff0c\u6240\u4ee5\u8f6c\u79fb\u7684\u65f6\u5019\u53ea\u80fd\u7531\u989c\u8272\u4e0d\u540c\u7684\u8f6c\u79fb\u8fc7\u6765\u3002\u4e14\u5f53\u524d\u70b9\u7684\u65b9\u6848\u6570\u5e94\u4e3a\u5176\u5b50\u6811\u65b9\u6848\u6570\u7684\u4e58\u79ef\u3002\u6253\u4e2a\u6bd4\u65b9\uff0c\u5bf9\u4e8e\u70b9i\u6765\u8bf4,\u5b83\u6709\u4e24\u4e2a\u5b50\u6811j,k\u3002\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u5e94\u4e3a\n\n```cpp\ndp[i][1]*=(dp[j][2]+dp[j][3])*(dp[k][2]+dp[k][3]);\n\ndp[i][2]*=(dp[j][1]+dp[j][3])*(dp[k][1]+dp[k][3]);\n\ndp[i][3]*=(dp[j][1]+dp[j][2])*(dp[k][1]+dp[k][2]);\n```\n\n\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u662f*=\uff0c\u8fd9\u5c31\u6d89\u53ca\u5230\u4e86dp\u521d\u59cb\u503c\u7684\u8bbe\u7acb\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u6700\u521d\u6ca1\u6709\u6d82\u8272\u7684\u70b9i\uff0c\u5f88\u663e\u7136\u521a\u904d\u5386\u5230\u7684\u65f6\u5019\u6211\u4eec\u8bbe\u7f6e\u70b9i\u7684\u521d\u59cb\u503c\ndp[i][1]=dp[i][2]=dp[i][3]=1;\n\n\u800c\u5982\u679c\u70b9i\u5df2\u7ecf\u88ab\u4e0a\u8272\u4e86\uff0c\u90a3\u4e48\u53ea\u6709~~\u88ab\u4e0a\u7684\u989c\u8272~~\u7684\u6570\u7ec4\u624d\u80fd\u4e3a1(dp[i][col[i]]=1)\uff0c\u800c\u5176\u4ed62\u4e2a\u90fd\u4e3a0\u3002\n\n\u6240\u4ee5\u4e4b\u524d\u7528*=\u6765\u66f4\u65b0\u4fdd\u8bc1\u4e86\u5982\u679c\u5f53\u524d\u70b9\u5df2\u7ecf\u88ab\u4e0a\u8272\u4e86\u7684\u8bdd\uff0c\u4e0a\u5176\u4ed6\u989c\u8272\u7684\u65b9\u6848\u6570\u4e3a0\u3002\n\n\u7136\u540e\u968f\u4fbf\u9009\u4e2a\u70b9i\u4e3a\u6839\u8dd1\u4e00\u904ddfs\u8f93\u51fadp[i][1]+dp[i][2]+dp[i][3]\u5c31\u597d\u4e86\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#define p 1000000007\n#define LL long long\nusing namespace std;\ninline int read()\n{\n    int sum=0;\n    char ch =getchar();\n    while(ch<'0'||ch>'9')\n        ch=getchar();\n    while(ch>='0'&&ch<='9')\n    {\n        sum=sum*10+ch-'0';\n        ch=getchar();\n    }\n    return sum;\n}\nint n,m,tot=0;\nint Head[100005],col[100005];//Head\u7528\u4e8e\u90bb\u63a5\u8868  col\u8bb0\u5f55\u989c\u8272\nLL dp[100005][4];\nbool visit[100005];//\u7531\u4e8e\u5b58\u56fe\u4e3a\u65e0\u5411\u56fe\uff0c\u6240\u4ee5\u8981\u8bb0\u5f55\u4e0b\u5df2\u7ecf\u8d70\u8fc7\u7684\u70b9\u9632\u6b62\u6b7b\u5faa\u73af\nstruct tree\n{\n    int next,node;\n}h[200010];\ninline void add(int u,int v)//\u90bb\u63a5\u8868\u5b58\u56fe\n{\n    h[++tot].next=Head[u];\n    h[tot].node=v;\n    Head[u]=tot;\n}\nvoid dfs(int pos)//dfs\u904d\u5386\n{\n    visit[pos]=1;\n    if(col[pos])//\u5982\u679c\u5df2\u7ecf\u4e0a\u8fc7\u8272\u4e86\uff0c\u5176\u4ed6\u4e24\u79cd\u989c\u8272\u7684\u65b9\u6848\u6570\u4e3a0\u3002\n        dp[pos][col[pos]]=1;\n    else//\u4e09\u79cd\u989c\u8272\u90fd\u53ef\u4ee5\u88ab\u2642\u4e0a\n    {\n        dp[pos][1]=1;\n        dp[pos][2]=1;\n        dp[pos][3]=1;\n    }\n    for(register int i=Head[pos];i;i=h[i].next)//\u627e\u5230\u5f53\u524d\u70b9\u6240\u6709\u7684\u5b50\u8282\u70b9\n    {\n        int v=h[i].node;\n        if(!visit[v])\n        {\n            dfs(v);//\u4e00\u76f4\u5411\u4e0b\u904d\u5386\u76f4\u5230\u53f6\u5b50\u8282\u70b9\u8fd4\u56de\n            dp[pos][1]=dp[pos][1]*((dp[v][2]+dp[v][3])%p)%p;\n            dp[pos][2]=dp[pos][2]*((dp[v][1]+dp[v][3])%p)%p;\n            dp[pos][3]=dp[pos][3]*((dp[v][2]+dp[v][1])%p)%p;//\u8f6c\u79fb  \u8bb0\u5f97\u53d6\u6a21\uff01\n        }\n    }\n}\nint main()\n{\n    int x,y;\n    n=read();\n    m=read();\n    for(register int i=1;i<n;++i)\n    {\n        x=read();\n        y=read();\n        add(x,y);\n        add(y,x);//\u52a0\u8fb9\n    }\n    for(register int i=1;i<=m;++i)\n    {\n        x=read();\n        y=read();\n        col[x]=y;//\u8bb0\u5f55\u989c\u8272\n    }\n    dfs(1);//\u968f\u4fbf\u628a\u4e00\u4e2a\u70b9\u5f53\u6839\u5c31\u597d\u4e86\n    cout<<(dp[1][1]+dp[1][2]+dp[1][3])%p<<endl;\n    return 0;\n}\n```",
        "postTime": 1540985952,
        "uid": 44434,
        "name": "Okarin",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4084 \u3010[USACO17DEC]Barn Painting\u3011"
    },
    {
        "content": "\u4e00\u9053\u6709\u8da3\u7684\u6811\u578bDP\u3002\n\n\u4e00\u770b\u5230XXDP\uff0c\u5c31\u83ab\u540d\u6709\u79cd\u6050\u60e7\u611f\uff0c\u4f46\u6811\u5f62DP\u770b\u4e0a\u53bb\u5e76\u4e0d\u96be\u2014\u2014\u4e0d\u5c31\u662f\u5728\u6811\u4e0a\u8dd1DP\u5417\uff1f\n\n\u53ef\u4ee5\u7528DFS\u786e\u5b9a\u6bcf\u4e2a\u70b9\u7684\u53ef\u80fd\u6027\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\uff0c\u4e0d\u80fd\u548c\u5b50\u8282\u70b9\u76f8\u540c\uff0c\u6545\u63a8\u51fa\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n```\n  f[x][0]=f[x][0]*(f[son[i]][1]+f[son[i]][2]);\n  f[x][1]=f[x][1]*(f[son[i]][0]+f[son[i]][2]);\n  f[x][2]=f[x][2]*(f[son[i]][1]+f[son[i]][0]);\n```\n\u7531\u4e8e\u4e0d\u53ef\u80fd\u6709\u73af\uff0c\u4e00\u4e2a\u70b9\u7684\u8d4b\u503c\u53ea\u6709\u53ef\u80fd\u6709\u4e00\u6b21\uff0c\u6240\u4ee5\u5f53\u8fd9\u4e2a\u70b9\u7684\u521d\u59cb\u503c\u4e0d\u4e3a0\u662f\uff0c\u8bf4\u660e\u5df2\u7ecf\u5728\u6761\u4ef6\u4e2d\u88ab\u67d3\u8fc7\u8272\u4e86\u3002\n\n\u559c\u95fb\u4e50\u89c1\u7684\u4ee3\u7801\uff1a\n```\n#include<bits/stdc++.h>\n#define int long long//\u8981\u7528long long\u7684\u9898\u76ee\u8fd9\u6837\u5b9a\u4e49\u518d\u597d\u4e0d\u8fc7\u4e86\nusing namespace std;\nint n,k,cnt,f[4][1000002],head[1000002];//\u597d\u50cf\u5f00100001\u7684\u6570\u7ec4\u4f1aRE\uff0c\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\uff0c\u8c03\u592710\u500d\u4ee5\u540e\u5c31\u6ca1\u95ee\u9898\u4e86\u3002\nstruct node{\n\tint next,to;\n} road[1000002];\nvoid add(int x,int y)//\u94fe\u5f0f\u524d\u5411\u661f\u5b58\u6811\n{\n\troad[++cnt].to=y;\n\troad[cnt].next=head[x];\n\thead[x]=cnt;\n}\nvoid dfs(int x,int fa)\n{\n\tfor(int i=1;i<=3;i++)\n\t{\n\t\tif(f[i][x])//\u5982\u679c\u5df2\u7ecf\u88ab\u8d4b\u8fc7\u521d\u503c\u4e86\uff0c\u5c31\u4e0d\u80fd\u518d\u8d4b\u5176\u4ed6\u503c\u4e86\n\t\t{\n\t\t\tfor(int j=1;j<i;j++)\n\t\t\t\tf[j][x]=0;\n\t\t\tbreak;\n\t\t} \n\t\tf[i][x]=1;\n\t}\n\tfor(int i=head[x];i;i=road[i].next)\n\t{\n\t\tint v=road[i].to;\n\t\tif(v!=fa)//\u907f\u514d\u6b7b\u5faa\u73af\n\t\t{\n\t\t\tdfs(v,x);\n\t\t\tf[1][x]=f[1][x]*((f[2][v]+f[3][v])%1000000007)%1000000007;//\u8bb0\u5f97\u53d6\u6a21\n\t\t\tf[2][x]=f[2][x]*((f[1][v]+f[3][v])%1000000007)%1000000007;\n\t\t\tf[3][x]=f[3][x]*((f[1][v]+f[2][v])%1000000007)%1000000007;\n\t\t}\n\t}\n}\nsigned main()//main\u51fd\u6570\u4e0d\u80fd\u7528long long\uff0c\u53ea\u80fd\u7528signed\n{\n\tcin>>n>>k;\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint a,b;\n\t\tcin>>a>>b;\n\t\tadd(a,b);\n\t\tadd(b,a);\n\t}\n\tfor(int i=1;i<=k;i++)\n\t{\n\t\tint a,b;\n\t\tcin>>a>>b;\n\t\tf[b][a]=1;\n\t}\n\tdfs(1,0);\n\tcout<<(f[1][1]+f[2][1]+f[3][1])%1000000007;//\u6700\u540e\u518d\u53d6\u4e00\u6b21\u819c\n\treturn 0;\n}\n```\n",
        "postTime": 1584694188,
        "uid": 240812,
        "name": "45dino",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4084 \u3010[USACO17DEC]Barn Painting G\u3011"
    },
    {
        "content": "\u8fd9\u79cd\u6811\u4e0a\u95ee\u9898\u663e\u7136\u662f\u6811\u5f62DP\u5566\n\n\u4ee4 $f[i][j]$ \u8868\u793a **\u5f53 $i$ \u53f7\u8282\u70b9 \u53d6\u989c\u8272 $j$ \u65f6\u5176\u5b50\u6811\u603b\u5171\u7684\u72b6\u6001\u6570**;\n\n$ced[i]$ \u8868\u793a **$i$ \u53f7\u8282\u70b9\u6700\u521d\u662f\u5426\u88ab\u67d3\u8272\uff0c\u5982\u5df2\u88ab\u67d3\u8272\u662f\u54ea\u79cd\u989c\u8272**\u3002\n\n\u641c\u7d22\u65f6\u5206\u7c7b\u5224\u65ad\u5373\u53ef\uff08\u5177\u4f53\u770b\u4ee3\u7801\uff09\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$\u3002\n\n\u4ee3\u7801\uff1a\n\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define I inline\nconst int N = 100010; \nusing namespace std;\nstruct Edge\n{\n\tint to,next;\n}edge[N * 2];\nint n, k, f[N][4], ced[N], cnt = 0, vis[N], head[N], mod = 1000000007;\nI void add(int x,int y)\n{\n\tedge[++cnt].to = y;\n\tedge[cnt].next = head[x];\n\thead[x] = cnt;\n}\nI void init()//\u8bfb\u5165\n{\n\tmemset(ced, 0, sizeof(ced));\n\tscanf(\"%lld%lld\", &n, &k);\n\tint x,y;\n\tfor(int i = 1; i < n; ++i)\n    {\n\t\tscanf(\"%lld%lld\", &x, &y);\n\t\tadd(x, y), add(y, x);\n\t}\n\tfor(int i = 1; i <= k; ++i)\n\t\tscanf(\"%lld%lld\", &x, &y), ced[x] = y;\n\treturn;\n}\nI void slove(int x)//\u641c\u7d22\n{\n\tvis[x] = 1;//\u6807\u8bb0\u4e3a\u5df2\u8bbf\u95ee\n\tif(ced[x]) f[x][ced[x]] = 1; //\u5982\u5df2\u88ab\u67d3\u8272\uff0c\u5219\u5bf9\u4e8e\u5f53\u524d\u8282\u70b9\u53ea\u6709\u56fa\u5b9a\u7684\u4e00\u79cd\u53d6\u6cd5\n\telse f[x][1] = f[x][2] = f[x][3] = 1;//\u5426\u5219\u4e09\u79cd\u53d6\u6cd5\u7686\u53ef\n\tfor(int i = head[x]; i; i = edge[i].next)\n    {\n\t\tint y = edge[i].to;\n\t\tif(vis[y]) continue;//\u9632\u6b62\u8bbf\u95ee\u7236\u4eb2\u9020\u6210\u6b7b\u5faa\u73af\n\t\tslove(y);\n\t\tf[x][1] = f[x][1] * ((f[y][2] + f[y][3]) % mod) % mod;\n\t\tf[x][2] = f[x][2] * ((f[y][1] + f[y][3]) % mod) % mod;\n\t\tf[x][3] = f[x][3] * ((f[y][1] + f[y][2]) % mod) % mod;//\u4e58\u6cd5\u539f\u7406\uff0c\u7b97\u51fa\u8fd9\u4e2a\u5b50\u8282\u70b9\u53d6\u5176\u4ed6\u7684\u4e24\u79cd\u989c\u8272\u7684\u8d21\u732e\n\t}\n\treturn;\n}\nsigned main()\n{\n\tinit();\n\tslove(1);\n\tprintf(\"%lld\\n\", ced[1] ? f[1][ced[1]] % mod : (f[1][1] + f[1][2] + f[1][3]) % mod);//\u5982\u679c\u6839\u8282\u70b9\u6700\u521d\u5df2\u88ab\u786e\u5b9a\u989c\u8272\uff0c\u5219\u53ea\u7b97\u5b83\u989c\u8272\u7684\u8d21\u732e\n    //\u5426\u5219\u4e09\u79cd\u989c\u8272\u7684\u8d21\u732e\u90fd\u7b97\u4e0a\n\treturn 0;\n}\n\n```\n",
        "postTime": 1582706462,
        "uid": 108098,
        "name": "FourteenObsidian",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4084 \u3010[USACO17DEC]Barn Painting G\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u7ed9\u51fa\u4e00\u68f5\u65e0\u6839\u6811\uff0c\u6811\u4e0a\u6709\u4e00\u90e8\u5206\u8282\u70b9\u5df2\u7ecf\u6d82\u597d\u4e86\u989c\u8272\uff0c\u5176\u4ed6\u7684\u8282\u70b9\u9700\u8981\u4f60\u6d82\u4e0a\u989c\u8272\uff0c\u95ee\u6700\u540e\u7684\u65b9\u6848\u6570\u3002\u5c31\u662f\u4e00\u9053\u6c34\u9898\u3002dp[i][j]\u8868\u793a\u4ee5i\u4e3a\u6839\u7684\u5b50\u6811\uff0c\u5e76\u4e14i\u7684\u989c\u8272\u6d82\u6210j\u3002\u8f6c\u79fb\u65b9\u7a0b\u4e5f\u597d\u5199\uff0c\u5c31\u662f\u628ai\u7684\u51e0\u4e2a\u513f\u5b50\u8282\u70b9\u7684\u65b9\u6848\u6570\u4e58\u8d77\u6765\u5c31\u597d\u4e86\u3002\ndp[root][1]=(dp[root][1]*(dp[v][2]+dp[v][3])%mod)%mod; \ndp[root][2]=(dp[root][2]*(dp[v][1]+dp[v][3])%mod)%mod;\ndp[root][3]=(dp[root][3]*(dp[v][1]+dp[v][2])%mod)%mod;\n\u5343\u4e07\u5343\u4e07\u522b\u5fd8\u4e86\u53d6\u6a21\uff0c\u522b\u5fd8\u4e86\u3002\n```c\n#include<bits/stdc++.h>\n#pragma GCC optimize(2)\n#define MAXN 100005\n#define mod 1000000007\n#define INF 0x3f3f3f3f\nusing namespace std;\n\nint n,k;\nstruct Edge\n{\n    int from,to;\n    Edge(int from=0,int to=0):from(from),to(to){};\n};\nvector<Edge> edges;\nvector<int> G[MAXN];\nlong long val[MAXN];\nlong long dp[MAXN][4];\n\nvoid dfs(int root,int fa)\n{\n    dp[root][1]=dp[root][2]=dp[root][3]=1;\n    if(val[root])                                                 //\u8fd9\u4e2a\u8282\u70b9\u5df2\u7ecf\u6d82\u597d\u4e86\u989c\u8272\n    {\n        for(int i=1;i<=3;i++)                            //\u5c1d\u8bd5\u4e09\u79cd\u989c\u8272\n        {\n            if(i!=val[root])                                   //\u60f3\u8981\u6d82\u7684\u989c\u8272\u4e0d\u4e00\u6837\u5c31\u76f4\u63a5\u7f6e\u4e3a0\n                dp[root][i]=0;\n        }\n    }\n    for(int i=0;i<G[root].size();i++)\n    {\n        Edge &e=edges[G[root][i]];\n        int v=e.to;\n        if(v==fa)\n            continue;\n        dfs(v,root);\n        dp[root][1]=(dp[root][1]*(dp[v][2]+dp[v][3])%mod)%mod;\n        dp[root][2]=(dp[root][2]*(dp[v][1]+dp[v][3])%mod)%mod;\n        dp[root][3]=(dp[root][3]*(dp[v][1]+dp[v][2])%mod)%mod;\n    }\n}\n\nint main()\n{\n    scanf(\"%d %d\",&n,&k);\n    int u,v;\n    for(int i=1;i<n;i++)\n    {\n        scanf(\"%d %d\",&u,&v);\n        edges.push_back({u,v});\n        edges.push_back({v,u});\n        int mm=edges.size();\n        G[u].push_back(mm-2);\n        G[v].push_back(mm-1);\n    }\n    //printf(\"ok\\n\");\n    for(int i=1;i<=k;i++)\n    {\n        int kk,op;\n        scanf(\"%d %d\",&kk,&op);\n        val[kk]=op;\n    }\n    memset(dp,INF,sizeof(dp));\n    dfs(1,-1);\n    long long ans=0;\n    for(int i=1;i<=3;i++)\n        ans+=dp[1][i];\n    printf(\"%lld\\n\",ans%mod);\n    return 0;\n}\n\n```\n",
        "postTime": 1572593720,
        "uid": 210155,
        "name": "abandentsky",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4084 \u3010[USACO17DEC]Barn Painting\u3011"
    },
    {
        "content": "\u8003\u8651\u6811\u4e0adp\uff0c\u8bbe$f_{u,i}$\u8868\u793a\u4ee5u\u4e3a\u6839\u7684\u5b50\u6811\u4e2d\uff0cu\u88ab\u67d3\u6210i\u8fd9\u4e2a\u989c\u8272\u7684\u65b9\u6848\u6570\uff0c\u4e8e\u662f\u8003\u8651\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n\n\u5982\u679c\u8fd9\u4e2a\u70b9\u88ab\u6307\u5b9a\u67d3\u8272\u4e86\uff0c\u90a3\u4e48\u6709\n\n$$f_{u,c_u}=\\prod_{v\\in son(u)}\\sum_{i=1}^3 f_{v,i}\\ \\ (i\\ne c_u)$$\n\n\u56e0\u4e3a\u5047\u5982u\u9009\u4e86\u4e00\u4e2a\u989c\u8272\uff0c\u90a3\u4e48\u5b83\u7684\u6bcf\u4e2a\u513f\u5b50\u90fd\u53ea\u80fd\u6709\u4e24\u79cd\u989c\u8272\u53ef\u9009\uff0c\u5148\u7528\u52a0\u6cd5\u539f\u7406\u7edf\u8ba1\u513f\u5b50\u53ef\u9009\u7684\u989c\u8272\uff0c\u7136\u540e\u518d\u7528\u4e58\u6cd5\u539f\u7406\u7edf\u8ba1\u8fd9\u68f5\u5b50\u6811\u7684\u7b54\u6848\n\n\u7136\u540e\u53ef\u4ee5\u5f97\u51fa\u672a\u88ab\u6307\u5b9a\u989c\u8272\u70b9\u7684\u65b9\u7a0b\n\n$$\\begin{cases}f_{u,1}=\\prod_{v\\in son(u)}\\ \\ (f_{v,2}+f_{v,3})& \\\\f_{u,2}=\\prod_{v\\in son(u)}\\ \\ (f_{v,1}+f_{v,3})& \\\\f_{u,3}=\\prod_{v\\in son(u)}\\ \\ (f_{v,1}+f_{v,2})&\n\\end{cases}$$\n\n\u8fd9\u6837\u5c31\u505a\u5b8c\u4e86QAQ\n\n**Code**\n``` cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cstring>\n#include <vector>\nconst int N = 1e5;\nconst int p = 1e9 + 7;\nusing namespace std;\nint n,k,c[N + 5],f[N + 5][4];\nvector <int> d[N + 5];\nvoid dfs(int u,int fa)\n{\n    vector <int>::iterator it;\n    int sum[4] = {1,1,1,1};\n    for (it = d[u].begin();it != d[u].end();it++)\n    {\n        int v = (*it);\n        if (v == fa)\n            continue;\n        dfs(v,u);\n        if (c[u])\n        {\n            int s = 0;\n            for (int i = 1;i <= 3;i++)\n                if (i != c[u])  \n                    s = (s + f[v][i]) % p;\n            sum[c[u]] = 1ll * sum[c[u]] * s % p;\n        }\n        else\n            for (int i = 1;i <= 3;i++)\n            {\n                int s = 0;\n                for (int j = 1;j <= 3;j++)\n                    if (i != j)\n                        s = (s + f[v][j]) % p;\n                sum[i] = 1ll * sum[i] * s % p;\n            }\n    }\n    if (c[u])\n        f[u][c[u]] = sum[c[u]];\n    else\n        for (int i = 1;i <= 3;i++)\n            f[u][i] = sum[i];\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&k);\n    int u,v;\n    for (int i = 1;i < n;i++)\n    {\n        scanf(\"%d%d\",&u,&v);\n        d[u].push_back(v);\n        d[v].push_back(u);\n    }\n    for (int i = 1;i <= k;i++)\n    {\n        scanf(\"%d%d\",&u,&v);\n        c[u] = v;\n    }\n    dfs(1,0);\n    cout<<((f[1][1] + f[1][2]) % p + f[1][3]) % p<<endl;  \n    return 0;\n}\n```",
        "postTime": 1572255111,
        "uid": 73231,
        "name": "eee_hoho",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4084 \u3010[USACO17DEC]Barn Painting\u3011"
    },
    {
        "content": "\u53ef\u4ee5\u8003\u8651\u6811\u5f62dp\n\n\u6211\u4eec\u7528$f[i][j]$\u8868\u793a$i$\u53f7\u70b9\u6d82\u4e0a$j$\u989c\u8272\u7684\u65b9\u6848\u6570\n\n\u8bbe$u->v$\u6709\u4e00\u6761\u8fb9,\u5bf9\u4e8e\u4e09\u79cd\u989c\u8272\uff0c\u56e0\u4e3a\u76f8\u90bb\u7684\u989c\u8272\u4e0d\u80fd\u76f8\u540c\n\n\u6240\u4ee5\u5982\u679c$u$\u8282\u70b9\u6d82\u4e86$1$\u53f7\u989c\u8272\uff0c\u90a3\u4e48$v$\u8282\u70b9\u53ea\u80fd\u6d82$2,3$\u53f7\u989c\u8272\n\n\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0cdp\u65b9\u7a0b\u4e3a\uff1a\n\n$f[u][1]=f[u][1]*(f[v][2]+f[v][3])$\n\n$f[u][2]=f[u][2]*(f[v][1]+f[v][3])$\n\n$f[u][3]=f[u][3]*(f[v][1]+f[v][2])$\n\n\u6ce8\u610f\u591a\u53d6\u6a21,\u8fd8\u7528\u8bb0\u5f97\u5f00long long\u3002\n\n**code:**\n\n```\n#include<bits/stdc++.h>\n\n#define N 100005\n#define rd(x) x=read()\n#define int long long\n\nusing namespace std;\n\nint n,m;\nint a[N],f[N][5];\nint vis[N];\nvector<int>e[N];\nconst int p=1e9+7;\n\ninline void addEdge(int u,int v){e[u].push_back(v);}\n\ninline int read()\n{\n    int x=0,f=1;char ch=getchar();\n    while(ch>'9'||ch<'0'){if(ch=='-')f=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n    return x*f;\n}\n\ninline void write(int x)\n{\n    if(x<0){putchar('-');x=-x;}\n    if(x>=10)write(x/10);\n    putchar(x%10+'0');\n}\n\nvoid dfs(int u)\n{\n    if(!a[u])f[u][1]=f[u][2]=f[u][3]=1;\n    else f[u][a[u]]=1;\n    for(int i=0;i<e[u].size();i++)\n    {\n        int v=e[u][i];\n        if(!vis[v])\n        {\n            vis[v]=1,dfs(v);\n            (f[u][1]*=((f[v][2]+f[v][3])%p))%=p;\n            (f[u][2]*=((f[v][1]+f[v][3])%p))%=p;\n            (f[u][3]*=((f[v][1]+f[v][2])%p))%=p;\n        }\n    }\n}\n\nsigned main() \n{\n    rd(n),rd(m);\n    for(int i=1;i<n;i++){int u,v;rd(u),rd(v);addEdge(u,v),addEdge(v,u);}\n    for(int i=1;i<=m;i++){int u,v;rd(u),rd(v),a[u]=v;}\n\n    vis[1]=1,dfs(1),printf(\"%lld\\n\",(f[1][1]+f[1][2]+f[1][3])%p);\n\n    return 0;\n}\n\n```",
        "postTime": 1570450840,
        "uid": 53807,
        "name": "Erusel",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4084 \u3010[USACO17DEC]Barn Painting\u3011"
    },
    {
        "content": "\u8fd9\u9898\u6811\u5f62dp+\u52a0\u6cd5\u539f\u7406+\u4e58\u6cd5\u539f\u7406\uff0c\u4e0d\u9519\u7684\u9898\u3002\n\n\u7528f[u][i]\u8868\u793a\u4ee5u\uff08\u67d3\u6210i\u8fd9\u79cd\u989c\u8272\uff09\u8fd9\u4e2a\u8282\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u5185\u7684\u65b9\u6848\u603b\u6570\uff0csum[u]\u8868\u793au\u4e3a\u6839\u7684\u5b50\u6811\u7684\u65b9\u6848\u603b\u6570\u3002\u6240\u4ee5\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0c\u6709$f[u][i]*(sum[v]-f[v][i])$,\n\n\u6839\u636e\u52a0\u6cd5\u539f\u7406\u6709\n$sum[u]+=f[u][i]$\n\n\u521d\u59cb\u5316\u9664\u4e86k\u4e2a\u56fa\u5b9a\u8282\u70b9\uff0c\u5176\u4f59$f[u][i(1<=i<=3)]=1$\n\n```cpp\n#include<bits/stdc++.h>\n\n#define ll long long\n#define mod 1000000007\n\nusing namespace std;\n\nconst int maxn=100000+10;\nint head[maxn],f[maxn][5],sum[maxn],x[maxn];\nint n,k,cnt;\nbool vis[maxn];\n\nstruct Edge{\n\tint v,nxt;\n}e[maxn];\n\nvoid add(int u,int v)\n{\n\te[++cnt].v=v;\n\te[cnt].nxt=head[u];\n\thead[u]=cnt;\n}\n\nvoid dfs(int u,int fa)\n{\n    for(int i=head[u];i;i=e[i].nxt)\n    {\n        int to=e[i].v;\n        if(to==fa)continue;\n        dfs(to,u);\n        for(int i=1;i<=3;i++)\n        {\n            f[u][i]=((long long)f[u][i]*(sum[to]-f[to][i]+mod)%mod)%mod;\n        }\n    }\n    for(int i=1;i<=3;i++)\n    sum[u]+=f[u][i],sum[u]%=mod; \n}\n\nint main()\n{\n\tscanf(\"%d%d\",&n,&k);\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint u,v;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tadd(u,v);\n\t\tadd(v,u);\n\t}\n\tfor(int i=1;i<=k;i++)\n\t{\n\t\tint y;\n\t\tscanf(\"%d%d\",&x[i],&y);\n\t\tf[x[i]][y]=1;\n\t\tvis[x[i]]=1;\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tif(vis[i]) continue;\n\t\tfor(int j=1;j<=3;j++)\n\t\t{\n\t\t\tf[i][j]=1;\n\t\t}\n\t}\n\t\n\tdfs(1,0);\n\tprintf(\"%d\",sum[1]);\n\treturn 0;\n}\n```\n",
        "postTime": 1568864602,
        "uid": 86970,
        "name": "StephenYoung",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4084 \u3010[USACO17DEC]Barn Painting\u3011"
    },
    {
        "content": "\u5f88\u57fa\u7840\u7684\u4e00\u9053\u6811\u5f62dp\u3002\n\n\u8bbe$f[i][j]$\u8868\u793a \u4ee5\u67d3\u7b2c$j$\u79cd\u989c\u8272\u7684\u8282\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u7684\u67d3\u8272\u65b9\u6848\u6570\u3002\n\n$$f[i][1]= \\prod(f[son][2]+f[son][3])$$\n\n$$f[i][2]= \\prod(f[son][1]+f[son][3])$$\n\n$$f[i][3]= \\prod(f[son][1]+f[son][2])$$\n\n\u5177\u4f53\u5b9e\u73b0\uff0c\u628a1\u53f7\u8282\u70b9\u4f5c\u4e3a\u6574\u68f5\u6811\u7684\u6839\uff0c\u7136\u540e\u5148\u9012\u5f52\u4e0b\u53bb\u8d4b\u521d\u503c1\uff0c\u5408\u5e76\u65f6\u8f6c\u79fb\u65b9\u7a0b\u3002\u6ce8\u610f\u4e0d\u7ba1\u662f\u8d4b\u521d\u503c\u8fd8\u662f\u8f6c\u79fb\u65b9\u7a0b\uff0c\u90fd\u8981\u5224\u65ad\u8fd9\u4e2a\u70b9\u662f\u5426\u662f\u90a3$K$\u4e2a\u5df2\u7ecf\u67d3\u8fc7\u8272\u7684\u8282\u70b9\uff0c\u5982\u679c\u5df2\u7ecf\u67d3\u8fc7\u8272\uff0c\u4ec5\u5bf9$j=$\u8fd9\u4e2a\u989c\u8272 \u7684\u60c5\u51b5\u8fdb\u884c\u64cd\u4f5c\u3002\n\n## Code\n```cpp\n#include <iostream>\n#include <stdio.h>\n#include <cstring>\n#include <algorithm>\n\n#define mod 1000000007\n#define N 100005\n\nusing namespace std;\n\nlong long f[N][4];\nint n , k;\nint val[N];\nstruct Edge{\n\tint to , next;\n}edge[N << 1];\nint head[N] , tot = 0;\n\nvoid add(int u , int v){\n\tedge[++tot].to = v;\n\tedge[tot].next = head[u];\n\thead[u] = tot;\n}\n\nvoid dfs(int x , int fa){\n\tfor(int i = 1; i <= 3; i++) if(val[x] == i || !val[x]) f[x][i] = 1;//\u8d4b\u521d\u503c \n\tfor(int i = head[x]; i; i = edge[i].next){//\u5411\u4e0b\u9012\u5f52 \n\t\tint v = edge[i].to;\n\t\tif(v == fa) continue;//\u6ce8\u610f\u8fde\u5411\u7236\u4eb2\u7684\u8fb9\u4e0d\u80fd\u53bb \n\t\tdfs(v , x);\n\t}\n\tfor(int i = head[x]; i; i = edge[i].next){//\u5408\u5e76\u7b54\u6848 \n\t\tint v = edge[i].to;\n\t\tif(v == fa) continue;\n\t\tif(val[x] == 1 || !val[x]) f[x][1] = (f[x][1] * (f[v][2] + f[v][3]) % mod) % mod;//\u8f6c\u79fb \n\t\tif(val[x] == 2 || !val[x]) f[x][2] = (f[x][2] * (f[v][1] + f[v][3]) % mod) % mod;\n\t\tif(val[x] == 3 || !val[x]) f[x][3] = (f[x][3] * (f[v][1] + f[v][2]) % mod) % mod;\n\t}\n}\n\t\t\nint main(){\n\tscanf(\"%d%d\" , &n , &k);\n\tfor(int i = 1; i < n; i++){\n\t\tint u , v;\n\t\tscanf(\"%d%d\" , &u , &v);\n\t\tadd(u , v);\n\t\tadd(v , u);\n\t}\n\tfor(int i = 1; i <= k; i++){\n\t\tint p , c;\n\t\tscanf(\"%d%d\" , &p , &c);\n\t\tval[p] = c;\n\t}\n\t\n\tdfs(1 , 0);\n\t\n\tprintf(\"%lld\" , (f[1][1] + f[1][2] + f[1][3]) % mod);\n\t\n\treturn 0;\n}\n```",
        "postTime": 1566396021,
        "uid": 35584,
        "name": "KillerXu",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4084 \u3010[USACO17DEC]Barn Painting\u3011"
    },
    {
        "content": "# [USACO17DEC]Barn Painting\n\n## \u9898\u610f\u7ffb\u8bd1\n\n\u9898\u610f\uff1a\u7ed9\u5b9a\u4e00\u9897N\u4e2a\u8282\u70b9\u7ec4\u6210\u7684\u6811\uff0c3\u79cd\u989c\u8272\uff0c\u5176\u4e2dK\u4e2a\u8282\u70b9\u5df2\u67d3\u8272\uff0c\u8981\u6c42\u4efb\u610f\u4e24\u76f8\u90bb\u8282\u70b9\u989c\u8272\u4e0d\u540c\uff0c\u6c42\u5408\u6cd5\u67d3\u8272\u65b9\u6848\u6570\u3002 \u7ffb\u8bd1\u8d21\u732e\u8005\uff1aIl_ItzABC_lI\n\n## \u9898\u76ee\u63cf\u8ff0\n\nFarmer John has a large farm with NN barns (1 \\le N \\le 10^51\u2264N\u2264105), some of which are already painted and some not yet painted. Farmer John wants to paint these remaining barns so that all the barns are painted, but he only has three paint colors available. Moreover, his prize cow Bessie becomes confused if two barns that are directly reachable from one another are the same color, so he wants to make sure this situation does not happen.\n\nIt is guaranteed that the connections between the NN barns do not form any 'cycles'. That is, between any two barns, there is at most one sequence of connections that will lead from one to the other.\n\nHow many ways can Farmer John paint the remaining yet-uncolored barns?\n\n## \u8f93\u5165\u8f93\u51fa\u683c\u5f0f\n\n\u8f93\u5165\u683c\u5f0f\uff1a\n\n\n\nThe first line contains two integers NN and KK (0 \\le K \\le N0\u2264K\u2264N), respectively the number of barns on the farm and the number of barns that have already been painted.\n\nThe next N-1N\u22121 lines each contain two integers xx and yy (1 \\le x, y \\le N, x \\neq y1\u2264x,y\u2264N,x\u2260y) describing a path directly connecting barns xx and yy.\n\nThe next KK lines each contain two integers bb and cc (1 \\le b \\le N1\u2264b\u2264N, 1 \\le c \\le 31\u2264c\u22643) indicating that barn bb is painted with color cc.\n\n\n\n\u8f93\u51fa\u683c\u5f0f\uff1a\n\n\n\nCompute the number of valid ways to paint the remaining barns, modulo 10^9 + 7109+7, such that no two barns which are directly connected are the same color.\n\n\n\n## \u8f93\u5165\u8f93\u51fa\u6837\u4f8b\n\n\u8f93\u5165\u6837\u4f8b#1\uff1a\n\n\n\n```\n4 1\n1 2\n1 3\n1 4\n4 3\n```\n\n\u8f93\u51fa\u6837\u4f8b#1\uff1a\n\n\n\n```\n8\n```\n\n## \u9898\u89e3\n\n\u4e00\u9053\u666e\u901a\u7ec4\u5408\u6811\u5f62dp\uff0cD1T2\u96be\u5ea6\u3002\n\n\u6240\u4ee5\u6211\u53c8\u88ab\u5361\u4e86n\u6b21\u3002\u3002\u5509\u3002\u6ce8\u610fdp\u7684\u6570\u7ec4\u521d\u59cb\u503c\u662f\u5426\u5408\u9002\u3002\n\n\u8bbe\uff1a\n$$\nf(u,c)\n$$\n\u8868\u793a\u5b50\u6811u\u5728u\u67d3\u989c\u8272c\u7684\u65f6\u5019\u65b9\u6848\u6570\u3002\n\n\u8f6c\u79fb\u539f\u59cb\u5f62\u5f0f\u662f\u6240\u6709\u5b50\u6811\u6bcf\u4e2a\u989c\u8272\u7684\u5377\u79ef\uff0c\u590d\u6742\u5ea6\u4f1a\u7206\u70b8\u3002\n\n\u7136\u540e\u901a\u8fc7~~\u4e25\u5bc6\u7684\u8bc1\u660e~~\u7075\u654f\u7684\u773c\u775b\u6211\u4eec\u53d1\u73b0\u5176\u5b9e\u662f\u5b50\u6811\u7684\u989c\u8272\u548c\u76f8\u4e58\uff0c\u53ef\u4ee5\u81ea\u5df1\u8bd5\u7740\u628a\u4e0b\u9762\u7684\u516c\u5f0f\u5c55\u5f00\u5c31\u660e\u767d\u4e86\u3002\n$$\nf(u,c) = \\prod_{v}\\sum_{i=1}^{cnum}[i!=c]f(v,i)\n$$\n\u65f6\u95f4\u590d\u6742\u5ea6\n$$\nO(nc^2)\n$$\n\u5b9e\u73b0\u6ce8\u610f\u7ec6\u8282\u95ee\u9898\uff01\uff01\uff08\u6bcf\u6b21\u51fa\u8fd9\u79cd\u95ee\u9898\u6211\u5c31\u62c5\u5fc3\u6211\u7684\u8054\u8d5b\uff09\n\nCode\uff1a\n\n```c++\n#include <cstdlib>\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cstring>\n#define maxn 100005\n#define mod 1000000007\nint head[maxn] , cnt , n , m , vis[maxn];\nlong long f[maxn][4];\nstruct edge{\n\tint next , to;\n}e[maxn*2];\n//void dfs(int x , int fx)\n//{\n//\tif(vis[x]){\n//\t\tf[x][vis[x]] = 1;\n//\t\tfor(int i = head[x] ; i ; i = e[i].next){\n//\t\t\tif(e[i].to != fx){\n//\t\t\t\tdfs(e[i].to , x);\n//\t\t\t\tlong long sum = 0;\n//\t\t\t\tfor(int j = 1 ; j <= 3 ; ++j){\n//\t\t\t\t\tif(j != vis[x] && f[e[i].to][j] != -1)\n//\t\t\t\t\t\t(sum += f[e[i].to][j]) %= mod;\n//\t\t\t\t\t(f[x][vis[x]] *= sum) %= mod;\n//\t\t\t\t}\n//\t\t\t}\n//\t\t}\n//\t}\n//\telse{\n//\t\tfor(int i = 1 ; i <= 3 ; ++i)\n//\t\t\tf[x][i] = 1;\n//\t\tfor(int i = head[x] ; i ; i = e[i].next){\n//\t\t\tif(e[i].to != fx){\n//\t\t\t\tdfs(e[i].to , x);\n//\t\t\t\tfor(int j = 1 ; j <= 3 ; ++j){\n//\t\t\t\t\tlong long sum = 0;\n//\t\t\t\t\tfor(int k = 1 ; k <= 3 ; ++k)\n//\t\t\t\t\t\tif(k != j && f[e[i].to][k] != -1)\t(sum += f[e[i].to][k]) %= mod;\n//\t\t\t\t\t(f[x][j] *= sum) %= mod;\n//\t\t\t\t}\n//\t\t\t\t\t\n//\t\t\t}\n//\t\t}\n//\t}\n//}\nlong long dp(int x , int c , int fx)\n{\n\tif(f[x][c] != -1)\treturn f[x][c];\n\tf[x][c] = 1;\n\tif(vis[x] && vis[x] != c) return f[x][c] = 0;\n\tfor(int i = head[x] ; i ; i = e[i].next)\t\n\t\tif(e[i].to != fx){\n\t\t\tlong long sum = 0;\n\t\t\tfor(int j = 1 ; j <= 3 ; ++j)\n\t\t\t\tif(j != vis[x] && j != c)\n\t\t\t\t\tsum += dp(e[i].to , j , x) , sum %= mod;\n\t\t\tf[x][c] = (f[x][c] * sum) % mod;\n\t\t}\n\treturn f[x][c];\n}\ninline void add(int x , int y)\n{\n\te[++cnt].next = head[x];\n\te[cnt].to = y;\n\thead[x] = cnt;\n}\nint main()\n{\n//\tfreopen(\"colors.in\",\"r\",stdin);\n\tstd::memset(f,-1,sizeof(f));\n\tscanf(\"%d%d\",&n,&m);\n\tint x , y;\n\tfor(int i = 1 ; i <= n-1 ; ++i)\n\t\tscanf(\"%d%d\",&x,&y) , add(x,y) , add(y,x);\n\tfor(int i = 1 ; i <= m ; ++i){\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tvis[x] = y;\n\t}\n\tlong long ans = 1ll*(dp(1,1,1)+dp(1,2,1)+dp(1,3,1))%mod;\n\tprintf(\"%lld\",ans);\n}\n```\n\n\u4e0a\u9762\u90a3\u4e2a\u4e0d\u8fd4\u56de\u503c\u7684dfs\u6211\u4e5f\u4e0d\u77e5\u9053\u600e\u4e48\u5c31\u6302\u4e86\u3002\u3002",
        "postTime": 1540899390,
        "uid": 100712,
        "name": "Starrydream",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4084 \u3010[USACO17DEC]Barn Painting\u3011"
    },
    {
        "content": "~~\u4e00\u7bc7\u9898\u89e3\u4e5f\u6ca1\u6709\uff1f\u849f\u84bb\u6765\u5199\u4e00\u7bc7\u5427~~\n\n\u5f88\u660e\u663e **\u6811\u5f62DP**\n\n**main\u90e8\u5206**\n\n\u56e0\u4e3a\u53ef\u80fd\u67090\u7684\u60c5\u51b5 \u6240\u4ee5\u5f00\u59cb\u5148\u5c06dp\u6e05\u4e3a-1\n\n\u7136\u540e\u6839\u636e1 2 3\u4e09\u79cd\u60c5\u51b5\u5faa\u73afdfs\u5c31\u53ef\u4ee5\u4e86\n\n**dfs\u90e8\u5206**\n\no\u4e3a\u5f53\u524d\u8282\u70b9\u7f16\u53f7 c\u4e3a\u5f53\u524d\u989c\u8272 p\u4e3a\u4e0a\u4e00\u8282\u70b9\u7f16\u53f7\n\n\u663e\u7136 \u5982\u679cc=1 \u5b50\u8282\u70b9\u53ea\u80fd\u67d3 2\uff0c3 ~~\u540c\u7406\uff08\u4e09\u4e2a\u4e11if~~\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u5224\u65ad\u662f\u5426\u5df2\u7ecf\u88ab\u67d3\u8fc7\u8272 \u5982\u679c\u5df2\u7ecf\u88ab\u9898\u76ee\u4e2d\u67d3\u8fc7\u8272\n\n\u5c31\u76f4\u63a5\u6e050 \u5982\u679c\u5927\u4e8e0\u4e86\uff08\u6211\u4eec\u8bbe\u7f6e\u7684\u521d\u59cb\u503c\u4e3a-1\n\n\u8bc1\u660e\u5df2\u7ecf\u8ba1\u7b97\u51fa\u6765\u4e86 \u6240\u4ee5\u5c31\u76f4\u63a5\u8fd4\u56de\n\n\u7136\u540e\u5c31\u662f\u628a\u6bcf\u4e00\u4e2a\u8282\u70b9\u7684\u65b9\u6cd5\u90fd\u52a0\u8d77\u6765\u76f8\u4e58 \u7136\u540e % \u5373\u53ef\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<cstring>\n#include<algorithm>\n#include<queue> \n#define MAXN 100005\n#define LL long long\n#define INF 2147483640\n#define MOD 1000000007\n#define free(s) freopen(\"s.txt\",\"r\",stdin);\n#define init(n) scanf(\"%d\",&n);\n#define ans() printf(\"%d\",ans);\n#define initt(n,m) scanf(\"%d%d\",&n,&m);\n#define scan(a,b) scanf(\"%d%d\",&a,&b);\nusing namespace std;\nconst int L=100005;\nint n,m,tu[L];\nLL int dp[L][5],ans=0;\nvector<int>tree[L];\nLL int  dfs(int o,int c,int p)\n{\n\tint a,b;\n\tif(c==1)\n\t\ta=2,b=3;\n\tif(c==2)\n\t\ta=1,b=3;\n\tif(c==3)\n\t\ta=1,b=2;\n\tif(tu[o]&&tu[o]!=c)\n\t\treturn dp[o][c]=0;\n\tif(dp[o][c]>=0)\n\t\treturn dp[o][c];\n\tdp[o][c]=1;\n\tfor(int i=0;i<tree[o].size();i++)\n\t{\n\t\tif(tree[o][i]==p)\n\t\t\tcontinue;\n\t\tint sum=0;\n\t\tsum+=dfs(tree[o][i],a,o);\n\t\tsum+=dfs(tree[o][i],b,o);\n\t\tsum%=MOD;\n\t\tdp[o][c]*=sum;\n\t\tdp[o][c]%=MOD;\n\t}\n\treturn dp[o][c];\n}\nint main()\n{\n\tmemset(dp,-1,sizeof(dp));\n\tinitt(n,m);\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint t1,t2;\n\t\tscanf(\"%d%d\",&t1,&t2);\n\t\ttree[t1].push_back(t2);\n\t\ttree[t2].push_back(t1);\n\t}\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint a,b;\n\t\tscan(a,b);\n\t\ttu[a]=b;\n\t}\n\tfor(int i=1;i<=3;i++)\n\t\tdfs(1,i,0);\n\tans=(dp[1][1]+dp[1][2]+dp[1][3])%MOD;\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1524647488,
        "uid": 37427,
        "name": "\u66f9\u8001\u5e08",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4084 \u3010[USACO17DEC]Barn Painting\u3011"
    }
]