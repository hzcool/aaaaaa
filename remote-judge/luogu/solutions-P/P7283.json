[
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P7283)\n\n### \u9898\u76ee\u5927\u610f:\n\n\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u6c42\u6ee1\u8db3\u8def\u5f84\u6700\u5927\u503c\u51cf\u8def\u5f84\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e $k$ \u7684\u70b9\u5bf9 $(u,v)$ \u7684\u6570\u91cf\u3002\n\n\n### \u5206\u6790:\n\n\u6c42\u6811\u4e0a\u6ee1\u8db3\u6761\u4ef6\u7684\u70b9\u5bf9\u6570\u91cf\uff0c\u5f88\u5bb9\u6613\u60f3\u5230\u70b9\u5206\u6cbb\u53ef\u4ee5\u505a\u3002\n\n\u8bbe\u5f53\u524d\u6839\u4e3a $root$\uff0c$g[x]$ \u8868\u793a $x$ \u5230 $root$ \u4e4b\u95f4\u7684\u6700\u5927\u503c\uff0c$d[x]$ \u8868\u793a $x$ \u5230 $root$ \u7684\u8ddd\u79bb\u3002\n\n\u5728 $root$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u70b9\u5bf9 $(u, v)$ \u5408\u6cd5\u5f53\u4e14\u4ec5\u5f53 $\\max (g[u],g[y])-d[u]-d[v] \\geq k$ \u4e14 $u$\uff0c$v$ \u4e0d\u5c5e\u4e8e $root$ \u7684\u540c\u4e00\u76f4\u63a5\u513f\u5b50\u4e0b\u3002\n\nmax \u5f88\u4e0d\u597d\u5904\u7406\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c06\u5b83\u62c6\u5f00\u6210\u4e24\u4e2a\u90e8\u5206\u3002\n\n$$\\begin{cases}\ng[u]-d[u]-d[v]\\geq k,& g[u]\\geq g[v]\\\\\ng[v]-d[u]-d[v]\\geq k,& g[u]\\leq g[v]\n\\end{cases}$$\n\n\u79fb\u9879\u540e:\n\n$$\\begin{cases}\ng[u]-d[u]-k\\geq d[v],& g[u]\\geq g[v]\\\\\n-d[u]-k\\geq d[v]-g[v],& g[u]\\leq g[v]\n\\end{cases}$$\n\n\u8fd9\u4e24\u4e2a\u90e8\u5206\u663e\u7136\u53ef\u4ee5\u7528\u4e24\u4e2a\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\uff0c\u81f3\u4e8e\u5982\u4f55\u786e\u5b9a\u662f\u54ea\u4e2a\u8d21\u732e\uff0c\u76f4\u63a5\u5bf9\u5b50\u6811\u8282\u70b9\u6309 $g$ \u6392\u5e8f\u5373\u53ef\u3002**\u6ce8\u610f\u6b64\u5904\u9700\u8981\u53d6\u7b49**\u3002\n\n\u7136\u540e\u6211\u4eec\u5c31\u53d1\u73b0\u4f1a\u7b97\u91cd\uff0c\u56e0\u4e3a $root$ \u540c\u4e00\u76f4\u63a5\u513f\u5b50\u5185\u90e8\u53ef\u80fd\u5bfc\u81f4\u4e0d\u5408\u6cd5\u7684\u8d21\u732e\uff0c\u76f4\u63a5\u51cf\u53bb\u5c31\u5b8c\u4e86\u3002\u3002\u3002\n\n### \u65f6\u95f4\u590d\u6742\u5ea6\u5206\u6790:\n\n\u7ecf\u5178\u70b9\u5206\u6cbb\uff0c\u6bcf\u6b21\u627e\u91cd\u5fc3\u5904\u7406\uff0c\u53ea\u6709 $\\log n$ \u5c42\uff0c\u6bcf\u6b21\u8ba1\u7b97\u7b54\u6848\uff0c\u5bf9\u4f46\u524d\u5b50\u6811\u626b\u63cf\u4e00\u904d\u9884\u5904\u7406\uff0c$O(siz(x))$\uff0c\u6392\u5e8f\u52a0\u6811\u72b6\u6570\u7ec4 $O(siz(x)\\log(siz(x)))$\uff0c\u53bb\u91cd\u65f6\u540c\u6837\u662f\u904d\u5386\u4e00\u904d\u5f53\u524d\u5b50\u6811\u590d\u6742\u5ea6\u76f8\u540c\u3002\u5b50\u6811\u603b\u548c\u5927\u5c0f\u4e3a $n$\uff0c\u6240\u4ee5\u6700\u540e\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log^2n)$\u3002\n\n### \u4ee3\u7801:\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long i64;\ni64 read() {\n\ti64 x(0), f(0); char ch = getchar();\n\twhile (!isdigit(ch)) f |= (ch == '-'), ch = getchar();\n\twhile (isdigit(ch)) x = x * 10 + ch - '0', ch = getchar();\n\treturn f ? -x : x;\n}\nint __stk[128], __len;\nvoid put(i64 x) {\n\tif (x < 0) putchar('-'), x = -x;\n\tdo { __stk[++__len] = x % 10, x /= 10; } while (x);\n\twhile (__len) putchar(__stk[__len--] ^ 48);\n}\nconst int N = 1e5 + 10, inf = 1e9;\nint n, k;\ni64 ans;\nnamespace DFZ {\n    int head[N], cur;\n    struct edge {\n        int to, nxt, w;\n    } e[N << 1];\n    void link(int u, int v) {\n\t\tint w = read();\n        e[++cur] = (edge) {v, head[u], w}, head[u] = cur;\n        e[++cur] = (edge) {u, head[v], w}, head[v] = cur;\n    }\n    int root, siz[N], maxp[N];\n    bool vis[N];\n    void get_root(int u, int fa, int total) {\n        maxp[u] = 0, siz[u] = 1;\n        for (int i = head[u]; i; i = e[i].nxt) {\n            if (e[i].to == fa || vis[e[i].to]) continue;\n            get_root(e[i].to, u, total);\n            siz[u] += siz[e[i].to], maxp[u] = max(maxp[u], siz[e[i].to]);\n        }\n        maxp[u] = max(maxp[u], total - siz[u]);\n        if (maxp[u] < maxp[root]) root = u;\n    }\n\tint g[N], d[N], o[N], cnt;\n\tbool cmp(int x, int y) { return g[x] < g[y]; }\n\tstruct BIT {\n\t\tint t[2000000];\n\t\tvoid add(int x, int y) { for (x += 1000000; x <= 2000000; x += x & -x) t[x] += y; }\n\t\tint ask(int x) { int res = 0; for (x += 1000000; x; x -= x & -x) res += t[x]; return res; }\n\t}t1, t2;\n\tvoid prepare(int u, int fa) {\n\t\tfor (int i = head[u]; i; i = e[i].nxt) \n\t\t\tif (!vis[e[i].to] && e[i].to != fa) \n\t\t\t\tg[e[i].to] = max(g[u], e[i].w), d[e[i].to] = d[u] + 1, prepare(e[i].to, u);\n\t}\n\tvoid dfs(int u, int fa) {\n\t\to[++cnt] = u;\n\t\tfor (int i = head[u]; i; i = e[i].nxt) \n\t\t\tif (!vis[e[i].to] && e[i].to != fa) dfs(e[i].to, u);\n\t}\n    void calc(int u) {\n        g[u] = 0, d[u] = 0, prepare(u, 0);\n\t\tcnt = 0, dfs(u, 0), sort(o + 1, o + cnt + 1, cmp);\n\t\tfor (int i = 1; i <= cnt; ++i) ans += t1.ask(g[o[i]] - d[o[i]] - k), t1.add(d[o[i]], 1);\n\t\tfor (int i = cnt; i >= 1; --i) ans += t2.ask(-d[o[i]] - k), t2.add(d[o[i]] - g[o[i]], 1);\n\t\tfor (int i = 1; i <= cnt; ++i) t1.add(d[o[i]], -1), t2.add(d[o[i]] - g[o[i]], -1);\n\t\tfor (int i = head[u]; i; i = e[i].nxt) {\n\t\t\tif (vis[e[i].to]) continue;\n\t\t\tcnt = 0, dfs(e[i].to, u), sort(o + 1, o + cnt + 1, cmp);\n\t\t\tfor (int j = 1; j <= cnt; ++j) ans -= t1.ask(g[o[j]] - d[o[j]] - k), t1.add(d[o[j]], 1);\n\t\t\tfor (int j = cnt; j >= 1; --j) ans -= t2.ask(-d[o[j]] - k), t2.add(d[o[j]] - g[o[j]], 1);\n\t\t\tfor (int j = 1; j <= cnt; ++j) t1.add(d[o[j]], -1), t2.add(d[o[j]] - g[o[j]], -1);\n\t\t}\n    }\n    void divide(int u) {\n        calc(u), get_root(u, 0, 0), vis[u] = 1;\n        for (int i = head[u]; i; i = e[i].nxt) {\n            if (vis[e[i].to]) continue;\n            root = 0, get_root(e[i].to, 0, siz[e[i].to]);\n            divide(root);\n        }\n    }\n}\n\nsigned main() {\n\tn = read(), k = read(); \n\tfor (int i = 1; i < n; ++i) DFZ::link(read(), read());\n\tDFZ::maxp[0] = n, DFZ::get_root(1, 0, n);\n\tDFZ::divide(DFZ::root), put(ans), putchar('\\n');\n\treturn 0;\n}\n```\n\n",
        "postTime": 1658989570,
        "uid": 399716,
        "name": "\u94b0\u747e_\u604b\u6db5",
        "ccfLevel": 7,
        "title": "[COCI2020-2021#4] Janjetina \u9898\u89e3"
    }
]