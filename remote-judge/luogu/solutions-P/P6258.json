[
    {
        "content": "\u5bb9\u6613\u53d1\u73b0\uff0c\u539f\u56fe\u662f\u4e00\u4e2a\u57fa\u73af\u5185\u5411\u6811\u68ee\u6797\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u68f5\u57fa\u73af\u6811\uff0c\u9996\u5148\u628a\u73af\u53bb\u6389\uff0c\u8003\u8651\u6811\u3002\u6bcf\u4e00\u4e2a\u6811\u8282\u70b9\u53ef\u4ee5\u5bf9\u81ea\u5df1\u4e0d\u8d85\u8fc7 $k$ \u7ea7\u7684\u7956\u5148\u9020\u6210\u8d21\u732e\uff0c\u53ef\u4ee5\u4f7f\u7528\u6811\u4e0a\u5dee\u5206\u89e3\u51b3\u3002\n\n\u7136\u540e\u5904\u7406\u6bcf\u4e2a\u70b9\u5bf9\u73af\u7684\u8d21\u732e\u3002\u6c42\u51fa\u4ece\u6bcf\u4e2a\u70b9\u51fa\u53d1\u6700\u5148\u5230\u8fbe\u7684\u73af\u4e0a\u7684\u70b9 $id_i$\uff0c\u4ee5\u53ca\u5b83\u79bb\u73af\u7684\u8ddd\u79bb $len_i$\u3002\u90a3\u4e48\u8be5\u70b9\u5bf9\u73af\u9020\u6210\u7684\u8d21\u732e\u662f\u4e00\u4e2a\u4ece\u70b9 $id_i$ \u5f00\u59cb\uff0c\u957f $k-len_i+1$ \u7684\u8fde\u7eed\u6bb5\u3002\u4ecd\u7136\u53ef\u4ee5\u4f7f\u7528\u5dee\u5206\u89e3\u51b3\u3002\n\n\u7531\u4e8e\u8981\u5904\u7406\u7684\u662f\u4e00\u4e2a\u73af\uff0c\u4f1a\u51fa\u73b0 $3 \\to 4 \\to 5 \\to 1 \\to 2$ \u8fd9\u7c7b\u7ec8\u70b9\u7f16\u53f7\u5c0f\u4e8e\u8d77\u70b9\u7f16\u53f7\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u8981\u52a0\u4e0a\u53d6\u6a21\u5904\u7406\u3002\n\n\u4ee3\u7801\u5199\u5f97\u6bd4\u8f83\u70c2\uff0c\u5404\u4f4d\u51d1\u5408\u7740\u770b\u770b\u5427\u3002\n\n```cpp\n# include <bits/stdc++.h>\n# define rr\nconst int N=500010,INF=0x3f3f3f3f;\nstruct Edge{\n\tint to,next;\n}edge[N];\nint head[N],sum;\nint d[N],loop[N],len[N],v[N],id[N];\n// d[i] \u542b\u4e49\u89c1\u9898\u9762\n//loop[i] \u70b9\u6240\u5728\u73af\u7f16\u53f7\n//v[i] \u70b9\u5728\u73af\u4e0a\u7684\u7f16\u53f7\nint n,k;// \u5982\u9898\u610f\nbool vis[N],ins[N]; // \u662f\u5426\u8bbf\u95ee\u8fc7 \u662f\u5426\u5728\u6808\u4e2d\nint sta[N],size;// \u6808\nstd::vector <int> L[N]; // \u73af\nstd::vector <int> diff[N];// \u73af\u4e0a\u5dee\u5206\nint cnt;// \u73af\u6570\u91cf\nint ans[N];// \u6bcf\u4e2a\u5e97\u7684\u6700\u7ec8\u7b54\u6848\ninline int read(void){\n\tint res,f=1;\n\tchar c;\n\twhile((c=getchar())<'0'||c>'9')\n\t\tif(c=='-')f=-1;\n\tres=c-48;\n\twhile((c=getchar())>='0'&&c<='9')\n\t\tres=res*10+c-48;\n\treturn res*f;\n}\ninline void add(int x,int y){\n\tedge[++sum].to=y;\n\tedge[sum].next=head[x];\n\thead[x]=sum;\n\treturn;\n}\nvoid dfs(int i){\n\tvis[i]=true,ins[i]=true;\n\tsta[++size]=i;\n\tif(!vis[d[i]]){\n\t\tdfs(d[i]);\n\t}else if(ins[d[i]]){\n\t\tint now=size;\n\t\t++cnt;\n\t\twhile(sta[now]!=d[i]){\n\t\t\tL[cnt].push_back(sta[now]);\n\t\t\t--now; \n\t\t}\n\t\tL[cnt].push_back(d[i]);\n\t\tstd::reverse(L[cnt].begin(),L[cnt].end());\n\t\tfor(rr int j=0;j<(int)L[cnt].size();++j){\n\t\t\tloop[L[cnt][j]]=cnt;\n\t\t\tv[L[cnt][j]]=j+1;\n\t\t}\n\t\tdiff[cnt].resize((int)L[cnt].size()+2);// \u5904\u7406\u73af\n\t}\n\tins[i]=false;\n\t--size;\n\treturn;\n}\nvoid Tree_Diff(int i,int x){ // \u6811\u4e0a\u5dee\u5206\n\tsta[++size]=i;\n\tlen[i]=len[sta[size-1]]+1;\n\tid[i]=x;\n\t++ans[i];\n\tif((size-1)>k){\n\t\t--ans[sta[size-k-1]];\n\t}\n\tfor(rr int j=head[i];j;j=edge[j].next){\n\t\tTree_Diff(edge[j].to,x);\n\t\tans[i]+=ans[edge[j].to];\n\t}\n\t--size;\n\treturn;\n}\nint main(void){\n\tn=read(),k=read();\n\tfor(rr int i=1;i<=n;++i){\n\t\tadd(d[i]=read(),i);\n\t}\n\tfor(rr int i=1;i<=n;++i){\n\t\tif(!vis[i]){\n\t\t\tdfs(i);\n\t\t}\n\t}\n\tfor(rr int i=1;i<=n;++i){\n\t\tif(!loop[i]&&loop[d[i]]){\n\t\t\tsize=0;\n\t\t\tlen[0]=sta[0]=0;\n\t\t\tTree_Diff(i,d[i]);\n\t\t}else if(loop[i]){\n\t\t\tid[i]=i;\n\t\t}\n\t}\n\tfor(rr int i=1;i<=n;++i){\n\t\tif(len[i]<=k){\n\t\t\tint l=k-len[i];\n\t\t\tif(l>=(int)L[loop[id[i]]].size()-1){\n\t\t\t\t++diff[loop[id[i]]][1];\n\t\t\t}else{\n\t\t\t\tint End=(v[id[i]]+l-1)%(int)L[loop[id[i]]].size()+1;\n\t\t\t\tif(v[id[i]]<=End){\n\t\t\t\t\t++diff[loop[id[i]]][v[id[i]]],--diff[loop[id[i]]][End+1];\n\t\t\t\t}else{\n\t\t\t\t\t++diff[loop[id[i]]][v[id[i]]],++diff[loop[id[i]]][1],--diff[loop[id[i]]][End+1];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfor(rr int i=1;i<=cnt;++i){\n\t\tint now=0;\n\t\tfor(rr int j=0;j<(int)L[i].size();++j){\n\t\t\tnow+=diff[i][j+1];\n\t\t\tans[L[i][j]]+=now;\n\t\t}\n\t}\n\tfor(rr int i=1;i<=n;++i){\n\t\tprintf(\"%d\\n\",ans[i]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1593832758,
        "uid": 108949,
        "name": "Meatherm",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6258 \u3010[ICPC2019 WF]Hobson's Trains\u3011"
    },
    {
        "content": "~~\u8111\u5b50\u4e0d\u591f\u6570\u636e\u7ed3\u6784\u6765\u51d1~~\n\n\u663e\u7136\u539f\u56fe\u662f\u4e00\u4e2a\u57fa\u73af\u5185\u5411\u6811\u68ee\u6797\u3002\n\n\u5355\u72ec\u8003\u8651\u4e00\u68f5\u57fa\u73af\u5185\u5411\u6811\uff0c\u663e\u7136\u73af\u4e0a\u7684\u70b9\u548c\u4e0d\u5728\u73af\u4e0a\u7684\u70b9\u7b97\u7b54\u6848\u7684\u65b9\u5f0f\u662f\u4e0d\u540c\u7684\u3002\u5bf9\u4e8e\u4e0d\u5728\u73af\u4e0a\u7684\u70b9\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7edf\u8ba1\u5176\u5b50\u6811\u4e2d\u6df1\u5ea6\u5dee\u4e0d\u8d85\u8fc7 $k$ \u7684\u70b9\u7684\u4e2a\u6570\uff1b\u5bf9\u4e8e\u5728\u73af\u4e0a\u7684\u70b9\uff0c\u9664\u4e86\u5b50\u6811\u4e2d\u7684\u8d21\u732e\u5916\u8fd8\u9700\u8981\u7edf\u8ba1\u73af\u4e0a\u5176\u5b83\u70b9\u7684\u5b50\u6811\u7684\u8d21\u732e\u3002\n\n\u8003\u8651\u65ad\u5f00\u73af\u4e0a $u\\to v$ \u7684\u8fb9\uff0c\u6574\u68f5\u57fa\u73af\u6811\u53d8\u4e3a\u6811\u3002\u8bbe $u$ \u7684\u6df1\u5ea6\u4e3a $1$\uff0c\u5219\u5bf9\u4e8e $v$ \u70b9\uff0c\u6df1\u5ea6\u5728 $k$ \u4ee5\u5185\u7684\u70b9\u90fd\u53ef\u4ee5\u5bf9\u5b83\u4ea7\u751f\u8d21\u732e\uff1b\u5bf9\u4e8e $d_v$ \u70b9\uff0c\u6df1\u5ea6\u5728 $k-1$ \u4ee5\u5185\u7684\u70b9\u90fd\u53ef\u4ee5\u5bf9\u5b83\u4ea7\u751f\u8d21\u732e\uff1b\u2026\u2026\n\n\u4e8e\u662f\u65ad\u8fb9\u540e\u5728\u6811\u4e0a DFS\uff0c\u540c\u65f6\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u6df1\u5ea6\u4e3a $i$ \u7684\u70b9\u7684\u4e2a\u6570\u3002\u6211\u4eec\u9700\u8981\u77e5\u9053\u5b50\u6811\u4e2d\u6df1\u5ea6 $\\leq x$ \u7684\u70b9\u7684\u4e2a\u6570\u548c\u6574\u68f5\u6811\u4e0a\u6df1\u5ea6 $\\leq x$ \u7684\u70b9\u7684\u4e2a\u6570\uff0c\u5728 DFS \u65f6\u52a0\u51cf\u4e00\u4e0b\u53bb\u6389\u5176\u5b83\u90e8\u5206\u7684\u8d21\u732e\u5373\u53ef\u3002\n\n```cpp\n// ====================================\n//   author: M_sea\n//   website: https://m-sea-blog.com/\n// ====================================\n#include <bits/stdc++.h>\n#define file(x) freopen(#x\".in\",\"r\",stdin); freopen(#x\".out\",\"w\",stdout)\nusing namespace std;\ntypedef long long ll;\n\nint read() {\n\tint X=0,w=1; char c=getchar();\n\twhile (c<'0'||c>'9') { if (c=='-') w=-1; c=getchar(); }\n\twhile (c>='0'&&c<='9') X=X*10+c-'0',c=getchar();\n\treturn X*w;\n}\n\nconst int N=500000+10;\n\nint n,k,f[N],ans[N];\nvector<int> E[N];\n\nint c[N];\nvoid add(int x,int y) { for (;x<=n;x+=x&-x) c[x]+=y; }\nint sum(int x) { int s=0; for (x=min(x,n);x;x-=x&-x) s+=c[x]; return s; }\n\nint vis[N],lim[N],banu,banv;\nvoid dfs(int u,int d) {\n\tvis[u]=1;\n\tans[u]-=sum(d+k),ans[u]+=sum(lim[u]);\n\tadd(d,1);\n\tfor (int v:E[u])\n\t\tif (u!=banu||v!=banv) dfs(v,d+1);\n\tans[u]+=sum(d+k),ans[u]-=sum(lim[u]);\n}\n\nint main() {\n\tn=read(),k=read();\n\tfor (int i=1;i<=n;++i) f[i]=read(),E[f[i]].emplace_back(i);\n\tfor (int i=1;i<=n;++i) {\n\t\tif (vis[i]) continue;\n\t\tint u=i;\n\t\twhile (!vis[u]) vis[u]=1,u=f[u];\n\t\tint v=f[u];\n\t\tbanu=v,banv=u;\n\t\tfor (int l=k;v!=u;v=f[v],--l) lim[v]=max(0,l);\n\t\tfor (v=f[u];v!=u;v=f[v]) ans[v]-=sum(lim[v]);\n\t\tdfs(u,1);\n\t\tfor (v=f[u];v!=u;v=f[v]) ans[v]+=sum(lim[v]);\n\t}\n\tfor (int i=1;i<=n;++i) printf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1591145728,
        "uid": 38370,
        "name": "M_sea",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6258 \u3010[ICPC2019 WF]Hobson's Trains\u3011"
    },
    {
        "content": "$\\text{Problem}:$[\u9898\u76ee\u94fe\u63a5](https://codeforces.com/gym/102511/problem/H)\n\n$\\text{Solution}:$\n\n\u6bcf\u4e2a\u70b9\u51fa\u5ea6\u4e3a $1$\uff0c\u8bf4\u660e\u56fe\u662f\u4e00\u4e2a\u5185\u5411\u57fa\u73af\u6811\u68ee\u6797\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u5c06\u7b54\u6848\u5206\u4e3a\u4e24\u90e8\u5206\uff1a\u5230\u6811\u4e0a\u7684\u8282\u70b9 $+$ \u5230\u73af\u4e0a\u7684\u8282\u70b9\u3002\n\n\u5230\u6811\u4e0a\u7684\u8282\u70b9\u53ef\u4ee5\u770b\u4f5c\u662f\u6c42\u6811\u4e0a $k$ \u7ea7\u7956\u5148\uff0c\u5e76\u7ed9\u8fd9\u6bb5\u8def\u5f84\u4e0a\u70b9\u7684\u6743\u503c\u90fd\u52a0 $1$\u3002\u6bd4\u8f83\u65b9\u4fbf\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u500d\u589e\u6c42 $k$ \u7ea7\u7956\u5148 $+$ \u6811\u4e0a\u5dee\u5206\u3002\n\n\u5bf9\u4e8e\u73af\u4e0a\u7684\u8282\u70b9\uff0c\u53ef\u4ee5\u7834\u73af\u4e3a\u94fe\uff0c\u5229\u7528\u5e8f\u5217\u5dee\u5206\u5b9e\u73b0\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u74f6\u9888\u5728\u500d\u589e\u6c42 $k$ \u7ea7\u7956\u5148\u4e0a\uff0c\u4e3a $O(n\\log n)$\u3002\n\n$\\text{Code}:$\n\n```cpp\n#include <bits/stdc++.h>\n//#pragma GCC optimize(3)\n//#define int long long\n#define ri register\n#define mk make_pair\n#define fi first\n#define se second\n#define pb push_back\n#define eb emplace_back\n#define is insert\n#define es erase\n#define vi vector<int>\n#define vpi vector<pair<int,int>>\n#define double long double\nusing namespace std; const int N=500010, M=20;\ninline int read()\n{\n\tint s=0, w=1; ri char ch=getchar();\n\twhile(ch<'0'||ch>'9') { if(ch=='-') w=-1; ch=getchar(); }\n\twhile(ch>='0'&&ch<='9') s=(s<<3)+(s<<1)+(ch^48), ch=getchar();\n\treturn s*w;\n}\nint n,K,deg[N],d[N],dep[N],h[N],book[N],f[N][M],A[N],Ans[N],siz[N];\nint head[N],maxE; struct Edge { int nxt,to; }e[N];\ninline void Add(int u,int v) { e[++maxE].nxt=head[u]; head[u]=maxE; e[maxE].to=v; }\nvector<int> cir[N],B[N]; int bl[N],cnt;\ninline void Topo()\n{\n\tqueue<int> Q;\n\tfor(ri int i=1;i<=n;i++) if(!deg[i]) Q.push(i);\n\twhile(!Q.empty())\n\t{\n\t\tint x=Q.front(); Q.pop();\n\t\tdeg[d[x]]--;\n\t\tif(!deg[d[x]]) Q.push(d[x]);\n\t}\n\tfor(ri int i=1;i<=n;i++) if(deg[i]&&!book[i])\n\t{\n\t\tcnt++;\n\t\tint x=i;\n\t\twhile(!siz[cnt] || x!=i)\n\t\t{\n\t\t\tbl[x]=cnt;\n\t\t\th[x]=++siz[cnt], x=d[x];\n\t\t}\n\t\tcir[cnt].resize(siz[cnt]+1), B[cnt].resize(siz[cnt]*2+1);\n\t\tx=i; int now=0;\n\t\twhile(!book[x])\n\t\t{\n\t\t\tbook[x]=1, now++;\n\t\t\tcir[cnt][now]=x;\n\t\t\tx=d[x];\n\t\t}\n\t}\n}\nvoid DFS1(int x,int fa)\n{\n\tf[x][0]=fa;\n\tdep[x]=dep[fa]+1;\n\tfor(ri int i=1;i<M;i++) f[x][i]=f[f[x][i-1]][i-1];\n\tfor(ri int i=head[x];i;i=e[i].nxt)\n\t{\n\t\tint v=e[i].to;\n\t\tif(v==fa||book[v]) continue;\n\t\tDFS1(v,x);\n\t}\n}\ninline int Kth(int x,int k)\n{\n\tfor(ri int i=M-1;~i;i--) if((k>>i)&1) x=f[x][i];\n\treturn x;\n}\nvoid DFS2(int x,int fa)\n{\n\tfor(ri int i=head[x];i;i=e[i].nxt)\n\t{\n\t\tint v=e[i].to;\n\t\tif(v==fa||book[v]) continue;\n\t\tDFS2(v,x);\n\t\tA[x]+=A[v];\n\t}\n}\ninline void Get(int x)\n{\n\tint up=min(K,dep[x]-1);\n\tint fa=Kth(x,up);\n\tA[x]++, A[f[fa][0]]--;\n\t//printf(\"Tree : %d %d\\n\",x,f[fa][0]);\n\tint gg=K-up;\n\tif(gg<=0) return;\n\tint z=bl[fa];\n\tint pos=h[fa]+1;\n\t//printf(\"Circle : %d %d\\n\",pos,min(pos+gg,pos+siz[z]-1));\n\tB[z][pos]++, B[z][min(pos+gg,pos+siz[z]-1)]--;\n}\nsigned main()\n{\n\tn=read(), K=read();\n\tfor(ri int i=1;i<=n;i++)\n\t{\n\t\tint x=read();\n\t\td[i]=x, deg[x]++;\n\t\tAdd(x,i);\n\t}\n\tTopo();\n\tfor(ri int i=1;i<=n;i++)\n\t{\n\t\tif(deg[i]) DFS1(i,0);\n\t}\n\tfor(ri int i=1;i<=n;i++) Get(i);\n\tfor(ri int i=1;i<=cnt;i++)\n\t{\n\t\tfor(ri int j=1;j<=siz[i]*2;j++) B[i][j]+=B[i][j-1];\n\t\tfor(ri int j=1;j<=siz[i];j++) Ans[cir[i][j]]+=B[i][j]+B[i][j+siz[i]];\n\t}\n\tfor(ri int i=1;i<=n;i++)\n\t{\n\t\tif(deg[i]) DFS2(i,0);\n\t}\n\tfor(ri int i=1;i<=n;i++) printf(\"%d\\n\",Ans[i]+A[i]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1616486367,
        "uid": 98618,
        "name": "Provicy",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6258"
    }
]