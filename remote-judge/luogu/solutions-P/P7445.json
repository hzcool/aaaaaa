[
    {
        "content": "\u51fa\u9898\u4eba\u9898\u89e3\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u628a $V$ \u52a0 $2$\u3002\n\n\u4e00\u4e2a\u8282\u70b9 $[l,r]$ \u80fd $\\mathrm{Pushdown}$ \u5f53\u4e14\u4ec5\u5f53\u6240\u6709\u8986\u76d6\u5b83\u7684\u4fee\u6539\u52a0\u8d77\u6765\u4e0d\u7b49\u4e8e $0$ \u3002\n\n\u4e00\u6b21\u64cd\u4f5c\u5b83\u88ab\u8986\u76d6\u7684\u671f\u671b\u4e3a $p=\\dfrac{l\\times(n-r+1)}{\\frac{n(n+1)}{2}}$ \u3002\n\n\u8bbe\u8986\u76d6 $k$ \u6b21\uff0c\u52a0\u8d77\u6765\u4e3a $0$ \u7684\u65b9\u6848\u6570\u4e3a $f(k)$ \u3002\n$$\nf(k)=[x^0](x^{-1}+1+x+x^2+\\cdots+x^{V-2})^k\n$$\n\n\u4e00\u4e2a\u8282\u70b9\u5bf9\u4e8e\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f\n\n$$\nS=\\sum_{i=0}^{m}p^i(1-p)^{m-i}\\binom{m}{i}\\dfrac{V^i-f(i)}{V^i}\n$$\n\n\u628a $\\dfrac{p}{1-p}$ \u770b\u505a\u53c2\u6570\uff0c\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u591a\u9879\u5f0f\u3002\n\n\u53d1\u73b0\u603b\u5171\u53ea\u6709 $n-1$ \u4e2a\u70b9\uff08\u7ebf\u6bb5\u6811\u975e\u53f6\u8282\u70b9\u4e2a\u6570\uff09\uff0c\u591a\u70b9\u6c42\u503c\u5c31\u597d\u4e86\uff0c\u975e\u5e38\u7b80\u4fbf\u3002\n\n\u5f53\u7136\u4e5f\u53ef\u4ee5\u4e0d\u7528\u8fd9\u4e2a\u79d1\u6280\uff0c\u9a8c\u9898\u4eba\u7ed9\u4e86\u4e2a\u5e38\u6570\u8f83\u5c0f\u7684\u5206\u6cbbFFT\u505a\u6cd5\uff0c\u7a0d\u5fae\u63a8\u63a8\u5f0f\u5b50\u5c31\u597d\u4e86\u3002\n\n\u73b0\u5728\u552f\u4e00\u5269\u4e0b\u7684\u95ee\u9898\u662f\u8ba1\u7b97 $k\\in [0,m]$ \u7684 $f(k)$ \u3002\n\n### \u65b9\u6cd5\u4e00\n\n$$\nf(k)=[x^k](1+x+x^2+x^3+\\cdots+x^{V-1})^k\n$$\n$$\n=[x^k](\\frac{1-x^{V}}{1-x})^k\n$$\n$$\n(1-x^V)^k=\\sum_{i=0}\\binom{k}{i}x^{iV}(-1)^i\n$$\n$$\n(1-x)^{-k}=\\sum_{i=0}\\binom{k+i-1}{i}x^{i}\n$$\n$$\nf(k)=\\sum_{i=0}^{\\frac{k}{V}}\\binom{k}{i}(-1)^i\\binom{2k-Vi-1}{k-1}\n$$\n\n\u590d\u6742\u5ea6 $O(\\dfrac{m^2}{V})$ \u3002\n\n### \u65b9\u6cd5\u4e8c\n\n\u8bbe \n\n$$\nF(x)=1+x+x^2+\\cdots+x^{V-1}\n$$\n$$\nG(x)=\\dfrac{x}{F(x)}\n$$\n\n\u6211\u4eec\u8981\u6c42\u7684\u662f $[x^0]\\left(\\dfrac{F(x)}{x}\\right)^k$\uff0c\u5373 $[x^0]G^{-k}(x)$\u3002\n\n\u53ef\u4ee5\u53d1\u73b0 $G(x)$ \u6ca1\u6709\u5e38\u6570\u9879\u4e14\u4e00\u6b21\u9879\u7cfb\u6570\u4e0d\u4e3a $0$ \u3002\u4ee4 $G(x)$ \u7684\u590d\u5408\u9006\u4e3a $H(x)$ \u3002\n\n\u6839\u636eEI\u9e3d\u9e3d\u5728\u5458\u4ea4\u8bfe\u4ef6\u91cc\u7684\u300a\u53e6\u7c7b\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u300b\u4e00\u8282\u91cc\u7684\u4e00\u4e2a\u5f0f\u5b50\uff08\u611f\u8c22 EI \u7684\u6307\u5bfc\u3002\u8bc1\u660e\u53ef\u4ee5\u770b\u9a8c\u9898\u4eba\u9898\u89e3\uff0c\u5927\u6982\u662f\u666e\u901a\u62c9\u53cd\u8bc1\u660e\u7b2c\u4e00\u6b65\u4e24\u8fb9 $k$ \u6b21\u5e42\uff09\uff1a\n\n\u82e5 $G,H$ \u4e92\u4e3a\u590d\u5408\u9006\uff0c\u90a3\u4e48\n$$\n[x^n]G^k=[x^{-k-1}]H'H^{-n-1}\n$$\n\n\u5e26\u8fdb\u53bb\u5c31\u5f97\u5230\n\n$$\n[x^0]G^{-k}(x)=[x^k]\\dfrac{H'(x)}{\\frac{H(x)}{x}}\n$$\n\n\u53ea\u8981\u7b97\u51fa $H(x)$ \u5c31\u597d\u4e86\u3002\n\n\u6ce8\u610f\u5230\n$$\nG(x)=\\dfrac{x}{F(x)}=\\dfrac{x-x^2}{1-x^V}\n$$\n\n\u76f8\u5f53\u4e8e\u8981\u6c42\u4e00\u4e2a $H(x)$ \u6ee1\u8db3\n\n$$\n\\dfrac{H(x)-H^2(x)}{1-H^{V}(x)}\\equiv x\n$$\n\n\u5316\u7b80\u4e00\u4e0b\uff1a\n\n$$\nH(x)-H^2(x)-x+xH^V(x)\\equiv 0\n$$\n\n\u725b\u987f\u8fed\u4ee3\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $O(n\\log n)$  \uff08$n,m$ \u89c6\u4e3a\u540c\u9636\uff09\u3002\n\n\u7efc\u4e0a\uff0c\u4f7f\u7528\u65b9\u6cd5\u4e8c\uff0c\u590d\u6742\u5ea6\u4e3a $O(n\\log^2 n)$ \u3002\n\n\u601d\u7ef4\u96be\u5ea6\u5e94\u8be5\u4e0d\u662f\u5f88\u5927\uff0c\u6709\u70b9\u677f\u5b50\uff0c\u653e E \u5e94\u8be5\u5dee\u4e0d\u591a\u5427\u3002\n\nupd\uff1a\u4e0a\u9762\u90a3\u53e5\u8bdd\u662f\u8d5b\u524d\u5199\u7684\uff0c\u4e0d\u60f3\u5220\u6389/wq\u3002\u4f46\u662f\u539f\u672c\u786e\u5b9e\u662f\u4e3a\u4e86\u653e\u4e00\u4e2a\u7b80\u5355\u4e00\u70b9\u7684 E \u624d\u9009\u4e86\u8fd9\u9898\u7684\uff0c\u6ca1\u60f3\u5230\u573a\u4e0a\u6700\u9ad8 $30$\u3002\u3002\u3002\n\n\u6240\u6709\u70b9\u7684\u65f6\u9650\u81f3\u5c11\u4e3a\u9a8c\u9898\u4eba\u4ee3\u7801 3 \u500d\uff0cstd 2 \u500d\u591a\uff0c\u5e76\u4e14\u6211\u7684\u677f\u5b50\u4e0d\u7b97\u5f88\u5feb\uff0c\u8fd8\u6709\u6781\u5927\u7684\u4f18\u5316\u7a7a\u95f4\uff0c\u6211\u7528\u6211\u5199\u8fc7\u6700\u6162\u7684\u677f\u5b50\u90fd\u80fd\u8fc7\uff0c\u6240\u4ee5\u5e94\u8be5\u4e0d\u4f1a\u6709\u4eba\u88ab\u5361\u5e38\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define mkp(x,y) make_pair(x,y)\n#define pb(x) push_back(x)\n#define sz(v) (int)v.size()\ntypedef long long LL;\ntypedef double db;\ntemplate<class T>bool ckmax(T&x,T y){return x<y?x=y,1:0;}\ntemplate<class T>bool ckmin(T&x,T y){return x>y?x=y,1:0;}\n#define rep(i,x,y) for(int i=x,i##end=y;i<=i##end;++i)\n#define per(i,x,y) for(int i=x,i##end=y;i>=i##end;--i)\ninline int read(){\n\tint x=0,f=1;char ch=getchar();\n\twhile(!isdigit(ch)){if(ch=='-')f=0;ch=getchar();}\n\twhile(isdigit(ch))x=x*10+ch-'0',ch=getchar();\n\treturn f?x:-x;\n}\nconst int N=200005;\nconst int M=N<<2;\nint n,m,V,f[M],a[N<<1],tot,IV,c[N],b[N<<1],ans,P[N];\n#define mod 998244353\nnamespace math{\nint inv[N],fac[N],ifc[N];\ninline int qpow(int n,int k){int res=1;for(;k;k>>=1,n=1ll*n*n%mod)if(k&1)res=1ll*n*res%mod;return res;}\ninline void fmod(int&x){x-=mod,x+=x>>31&mod;}\ninline int comb(int n,int m){return n<m?0:1ll*fac[n]*ifc[m]%mod*ifc[n-m]%mod;}\nvoid initmath(const int&n=N-1){\n\tinv[1]=1;for(int i=2;i<=n;++i)inv[i]=1ll*inv[mod%i]*(mod-mod/i)%mod;\n\tfac[0]=1;for(int i=1;i<=n;++i)fac[i]=1ll*i*fac[i-1]%mod;\n\tifc[n]=qpow(fac[n],mod-2);for(int i=n-1;i>=0;--i)ifc[i]=1ll*(i+1)*ifc[i+1]%mod;\n}\n}\nusing namespace math;\n\nnamespace poly{\n\nint rev[M],lg,lim,rt[M];\nvoid initpoly(const int&n){\n\tfor(lg=0,lim=1;lim<=n;++lg,lim<<=1);\n\tfor(int i=0;i<lim;++i)rev[i]=(rev[i>>1]>>1)|((i&1)<<(lg-1));\n\tfor(int i=1;i<lim;i<<=1){\n\t\tconst int w=qpow(3,(mod-1)/(i<<1));\n\t\trt[i]=1;\n\t\tfor(int j=1;j<i;++j)rt[i+j]=1ll*rt[i+j-1]*w%mod;\n\t}\n}\nvoid NTT(int*a,int op){\n\tif(!op)reverse(a+1,a+lim);\n\tfor(int i=0;i<lim;++i)\n\t\tif(i>rev[i])swap(a[i],a[rev[i]]);\n\tfor(int i=1;i<lim;i<<=1){\n\t\tfor(int j=0;j<lim;j+=i<<1){\n\t\t\tfor(int k=0;k<i;++k){\n\t\t\t\tconst int X=a[j+k],Y=1ll*rt[i+k]*a[i+j+k]%mod;\n\t\t\t\tfmod(a[j+k]=X+Y),fmod(a[i+j+k]=X-Y+mod);\n\t\t\t}\n\t\t}\n\t}\n\tif(op)return;const int ilim=qpow(lim,mod-2);\n\tfor(int i=0;i<lim;++i)a[i]=1ll*a[i]*ilim%mod;\n}\n#define clr(a,n) memset(a,0,sizeof(int)*(n))\n#define cpy(a,b,n) memcpy(a,b,sizeof(int)*(n))\nvoid poly_mul(int*f,int*g,int*ans,int n,int m){\n\tstatic int A[M],B[M];initpoly(n+m);\n\tcpy(A,f,n),clr(A+n,lim-n),NTT(A,1);\n\tcpy(B,g,m),clr(B+m,lim-m),NTT(B,1);\n\tfor(int i=0;i<lim;++i)A[i]=1ll*A[i]*B[i]%mod;\n\tNTT(A,0),cpy(ans,A,n+m-1);\n}\nvoid dao(int*g,int*f,int n){\n\tfor(int i=0;i<n-1;++i)g[i]=1ll*(i+1)*f[i+1]%mod;g[n-1]=0;\n}\nvoid poly_inv(int*g,int*f,int n){\n\tstatic int A[M],B[M];\n\tif(n==1)return g[0]=qpow(f[0],mod-2),void();\n\tint m=(n+1)>>1;\n\tpoly_inv(g,f,m),initpoly(n<<1);\n\tcpy(A,f,n),clr(A+n,lim-n),cpy(B,g,m),clr(B+m,lim-m);\n\tNTT(A,1),NTT(B,1);\n\tfor(int i=0;i<lim;++i)A[i]=1ll*B[i]*(2-1ll*A[i]*B[i]%mod+mod)%mod;\n\tNTT(A,0),cpy(g,A,n);\n}\n\n#define lc (p<<1)\n#define rc (p<<1|1)\nint pool[N<<6],*mem=pool,*ev[M];\nvoid eva_mul(int*f,int*g,int*ans,int n,int m){\n\tstatic int A[M],B[M];initpoly(n);\n\tcpy(A,f,n),clr(A+n,lim-n),NTT(A,1);\n\tcpy(B,g,m),clr(B+m,lim-m),NTT(B,1);\n\tfor(int i=0;i<lim;++i)A[i]=1ll*A[i]*B[i]%mod;\n\tNTT(A,0),cpy(ans,A+m-1,n-m+1);\n}\nvoid eva_solve1(int l,int r,int p,int*a){\n\tev[p]=mem,mem+=r-l+1;\n\tif(r-l==1)return ev[p][0]=mod-a[l],ev[p][1]=1,void();\n\tint mid=(l+r)>>1;\n\teva_solve1(l,mid,lc,a);\n\teva_solve1(mid,r,rc,a);\n\tpoly_mul(ev[lc],ev[rc],ev[p],mid-l+1,r-mid+1);\n}\nvoid eva_solve2(int l,int r,int p,int*h,int*f){\n\tif(r-l==1)return h[l]=f[0],void();\n\tint mid=(l+r)>>1,*al,*ar;\n\tal=mem,mem+=mid-l,ar=mem,mem+=r-mid;\n\teva_mul(f,ev[rc],al,r-l,r-mid+1);\n\teva_mul(f,ev[lc],ar,r-l,mid-l+1);\n\teva_solve2(l,mid,lc,h,al);\n\teva_solve2(mid,r,rc,h,ar);\n}\nvoid poly_eva(int*g,int*f,int*a,int n,int m){\n\tstatic int A[M];\n\tn=max(n,m);\n\teva_solve1(0,n,1,a);\n\treverse(ev[1],ev[1]+n+1);\n\tpoly_inv(A,ev[1],n),reverse(A,A+n);\n\tpoly_mul(A,f,A,n,n),cpy(A,A+n,n);\n\teva_solve2(0,n,1,g,A);\n\tfor(int i=0;i<m;++i)fmod(g[i]=1ll*g[i]*a[i]%mod+f[0]);\n\tfor(int i=m;i<n;++i)g[i]=0;\n}\nvoid poly_sqa(int*g,int*f,int n){\n\tinitpoly(n<<1);\n\tNTT(f,1);\n\tfor(int i=0;i<lim;++i)g[i]=1ll*f[i]*f[i]%mod;\n\tNTT(g,0);\n}\nvoid poly_qpow(int*g,int *f,int k,int n){\n\tstatic int A[M];\n\tcpy(A,f,n),g[0]=1;\n\tfor(;k;k>>=1,poly_sqa(A,A,n),clr(A+n,n))\n\t\tif(k&1)poly_mul(g,A,g,n,n),clr(g+n,n);\n}\nvoid newton(int*g,int n){\n\tstatic int A[M],B[M],C[M];\n\tif(n==1)return g[0]=0,void();\n\tnewton(g,(n+1)>>1);\n\tclr(A,n),A[0]=1;\n\tfor(int i=0;i<n;++i)A[i]=(A[i]-2ll*g[i]%mod+mod)%mod;\n\tclr(B,n),poly_qpow(B,g,V-1,n);\n\tfor(int i=1;i<n;++i)A[i]=(A[i]+1ll*V*B[i-1]%mod)%mod;\n\tclr(C,n),poly_inv(C,A,n);\n\t\n\tpoly_mul(B,g,B,n,n),clr(B+n,n);\n\tfor(int i=0;i<n;++i)A[i]=g[i];\n\tpoly_sqa(A,A,n);\n\tfor(int i=0;i<n;++i)fmod(A[i]=g[i]-A[i]+mod);\n\tfmod(A[1]+=mod-1);\n\tfor(int i=1;i<n;++i)fmod(A[i]+=B[i-1]);\n\tpoly_mul(A,C,A,n,n);\n\t\n\tfor(int i=0;i<n;++i)fmod(g[i]+=mod-A[i]);\n}\nvoid calcf(int*f,int n){\n\tstatic int A[M],B[M];\n\tif(V>=127){\n\t\tf[0]=1;\n\t\tfor(int k=1;k<=m;++k){\n\t\t\tfor(int i=0;i<=k/V;++i){\n\t\t\t\tint tmp=1ll*comb(k,i)*comb(2*k-V*i-1,k-i*V)%mod;\n\t\t\t\tfmod(f[k]+=i&1?mod-tmp:tmp);\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\tnewton(A,n+1),dao(f,A,n+1);\n\tfor(int i=0;i<n;++i) A[i]=A[i+1];\n\tclr(B,n),poly_inv(B,A,n);\n\tpoly_mul(f,B,f,n,n),clr(f+n,n);\n}\n\n}\n\nvoid solve(int l,int r){\n\tif(l==r)return;\n\tint mid=(l+r)>>1;\n\tint p=1ll*l*(n-r+1)%mod*IV%mod,q=mod+1-p;\n\tP[tot]=p,a[tot++]=1ll*p*qpow(q,mod-2)%mod;\n\tsolve(l,mid),solve(mid+1,r);\n}\n\nsigned main(){\n\tmath::initmath();\n\tn=read(),m=read(),V=read()+2;\n\tpoly::calcf(f,m+1);\n\tIV=qpow(1ll*n*(n+1)/2%mod,mod-2);\n\tsolve(1,n);\n\tfor(int i=0,j=1;i<=m;++i,j=1ll*j*V%mod)\n\t\tc[i]=1ll*comb(m,i)*(j+mod-f[i])%mod*qpow(j,mod-2)%mod;\n\tpoly::poly_eva(b,c,a,m+1,tot);\n\tfor(int i=0;i<tot;++i)fmod(ans+=1ll*b[i]*qpow(mod+1-P[i],m)%mod);\n\tcout<<ans<<'\\n';\n}\n```\n",
        "postTime": 1615206581,
        "uid": 123384,
        "name": "tommy0221",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 \u3010P7445 \u300cEZEC-7\u300d\u7ebf\u6bb5\u6811\u3011"
    },
    {
        "content": "\u672c\u6587\u540c\u6b65\u53d1\u8868\u4e8e\u6211\u7684\u535a\u5ba2\uff1a<https://www.alpha1022.me/articles/lg-7445.htm>\n\n\u9996\u5148\u4ee4 $v=V+2$\u3002\n\n\u8003\u8651\u4e00\u4e2a\u7ed3\u70b9 $[l,r]$\u3002  \n\u5219\u5b9e\u9645\u4e0a\u4e00\u6b21\u64cd\u4f5c\u5bf9\u5b83\u4ea7\u751f\u5f71\u54cd\u7684\u6982\u7387\u5373\u8fd9\u6b21\u64cd\u4f5c\u7684\u533a\u95f4\u5305\u542b\u5b83\u7684\u6982\u7387\uff0c\u5373 $p=\\frac{l(n-r+1)}{\\binom{n+1}2}$\u3002  \n\u8bbe\u968f\u673a\u52a0 $k$ \u6b21 $[-1,V]$ \u4e2d\u7684\u6574\u6570\uff0c\u7ed3\u679c\u4e3a $0$ \u7684\u65b9\u6848\u6570\u4e3a $f_k$\uff0c\u90a3\u4e48\u679a\u4e3e\u88ab\u64cd\u4f5c\u6b21\u6570\uff0c\u4e00\u4e2a\u7ed3\u70b9\u7684\u8d21\u732e\u5373\u4e3a\n$$\n\\sum\\limits_{i=0}^m \\binom mi p^i (1-p)^{m-i} \\left(1-\\frac{f_i}{v^i}\\right)\n$$\n\n\u89c2\u5bdf\u5230\u8fd9\u5176\u5b9e\u662f\u4e00\u4e2a\u5173\u4e8e $\\frac p{1-p}$ \u7684\u591a\u9879\u5f0f\u4e58\u4e00\u4e2a $(1-p)^m$\uff0c\u8bbe\u5176\u7b49\u4e8e\n$$\n(1-p)^m \\sum\\limits_{i=0}^m c_i \\left(\\frac p{1-p}\\right)^i\n$$\n\n\u4e00\u4e2a\u7b80\u5355\u7684\u505a\u6cd5\u662f\u76f4\u63a5\u591a\u70b9\u6c42\u503c\uff0c\u53ea\u8981\u5e38\u6570\u4e0d\u7206\u70b8\u5e94\u8be5\u90fd\u53ef\u4ee5\u8fc7\u3002  \n\u4e0d\u8fc7\u5b58\u5728\u4e0d\u591a\u70b9\u6c42\u503c\u7684\u505a\u6cd5\u3002\n\n\u5c06\u6709\u8d21\u732e\u7684\u7ed3\u70b9\uff08\u975e\u53f6\u7ed3\u70b9\uff09\u4efb\u610f\u6807\u53f7\u4e3a $1,2,\\dots,n-1$\uff0c\u4ee4 $p_i$ \u8868\u793a\u7b2c $i$ \u4e2a\u7ed3\u70b9\u7684\u4ee5\u4e0a\u63d0\u5230\u7684 $p$ \u503c\uff0c\u4ee4 $a_i = \\frac{p_i}{1-p_i},b_i = (1-p_i)^m$\uff0c\u5219\u603b\u7b54\u6848\u4e3a\n$$\n\\begin{aligned}\n\\sum\\limits_{i=1}^{n-1} b_i \\sum\\limits_{j=0}^m c_j a_i^j\n&= \\sum\\limits_{j=0}^m c_j \\sum\\limits_{i=1}^{n-1} b_i a_i^j\n\\end{aligned}\n$$\n\n\u4e8e\u662f\u95ee\u9898\u53d8\u4e3a\u5bf9 $j=0,1,\\dots,m$ \u6c42\u51fa $\\sum b_i a_i^j$\u3002  \n\u53d1\u73b0\n$$\n\\sum\\limits_{i=1}^{n-1} b_i a_i^j = [x^j] \\sum\\limits_{i=1}^{n-1} \\frac{b_i}{1-a_ix}\n$$\n\n\u53ef\u4ee5\u8003\u8651\u5206\u6cbb NTT \u5b9e\u73b0\u901a\u5206\u5e76\u76f8\u52a0\u7684\u8fc7\u7a0b\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log^2 n)$\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u95ee\u9898\u53ea\u5269\u4e0b\u6c42\u51fa $f_k$\u3002  \n\u901a\u8fc7\u7ec4\u5408\u6570\u6700\u540e\u53ef\u4ee5\u63a8\u5f97\u4e00\u4e2a $O\\left(\\frac {m^2}V\\right)$ \u7684\u505a\u6cd5\uff0c\u53ef\u4ee5\u53c2\u89c1\u51fa\u9898\u4eba\u7684\u9898\u89e3\uff0c\u8fd9\u91cc\u7565\u53bb\u4e0d\u8c08\u3002  \n\u901a\u8fc7\u5927\u529b\u751f\u6210\u51fd\u6570\u5904\u7406\uff0c\u663e\u7136\n$$\nf_k = [x^0](x^{-1}+1+x+x^2+\\dots+x^{V})^k\n$$\n\n\u4ee4\n$$\nF(x) = x^{-1}+1+x+x^2+\\dots+x^{V} = \\frac{1-x^v}{x(1-x)}\n$$\n\n\u7136\u540e\u95ee\u9898\u53d8\u6210\n$$\n[x^0] F^k(x)\n$$\n\n\u4e8b\u5b9e\u4e0a\u8fd9\u4e2a\u95ee\u9898\u7684\u5f62\u5f0f\u4e0e\u4e00\u4e2a\u7ecf\u5178\u95ee\u9898\u6781\u5176\u76f8\u4f3c\uff0c\u4e8e\u662f\u8fd9\u542f\u53d1\u6211\u4eec\u8003\u8651\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u3002  \n\u4f46\u662f\u7531\u4e8e\u8981\u63d0\u53d6\u5e38\u6570\u9879\uff0c\u6240\u4ee5\u5e76\u4e0d\u80fd\u76f4\u63a5\u8fd0\u7528\u7ecf\u5178\u7684\u62c9\u683c\u6717\u65e5\u53cd\u6f14\uff1b\u5e76\u4e14\uff0c$F$ \u663e\u7136\u4e0d\u5b58\u5728\u590d\u5408\u9006\u3002\n\n\u8003\u8651\u4ee4 $G = \\frac1F$\uff0c\u4ee4 $H$ \u4e3a $G$ \u7684\u590d\u5408\u9006\uff0c\u7136\u540e\u8003\u8651\u53e6\u7c7b\u62c9\u683c\u6717\u65e5\u53cd\u6f14\uff1a\n$$\n[x^0] F^k(x) = [x^0] G^{-k}(x) = [x^k] \\frac{xH'(x)}{H(x)}\n$$\n\n\u81f3\u6b64\uff0c\u5982\u679c\u80fd\u6c42\u51fa $H(x)$\uff0c\u95ee\u9898\u5373\u8fce\u5203\u800c\u89e3\u3002  \n\u6ce8\u610f\u5230\n$$\nG = \\frac{x(1-x)}{1-x^v}\n$$\n\n\u4ee3\u5165 $x = H$ \u5f97\n$$\nxH^v - H^2 + H - x = 0\n$$\n\n\u4f7f\u7528\u591a\u9879\u5f0f\u725b\u987f\u8fed\u4ee3\u6c42\u89e3\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log^2 n)$\uff08\u89c6 $n,m$ \u540c\u9636\uff09\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <cstdio>\n#include <vector>\n#include <cstring>\n#include <utility>\n#include <algorithm>\n#define add(a,b) (a + b >= mod ? a + b - mod : a + b)\n#define dec(a,b) (a < b ? a - b + mod : a - b)\nusing namespace std;\nconst int N = 1e5;\nconst int mod = 998244353;\nconst int LIM = 128;\nint n,m,v,inv,lim;\nint a[N + 5],b[N + 5],tot;\nint c[N + 5];\nint ans;\ninline int fpow(int a,int b)\n{\n    int ret = 1;\n    for(;b;b >>= 1)\n        (b & 1) && (ret = (long long)ret * a % mod),a = (long long)a * a % mod;\n    return ret;\n}\nnamespace Poly\n{\n    const int LG = 19;\n    const int N = 1 << LG + 1;\n    const int G = 3;\n    int lg2[N + 5];\n    int rev[N + 5],fac[N + 5],ifac[N + 5],inv[N + 5];\n    int rt[N + 5],irt[N + 5];\n    inline void init()\n    {\n        for(register int i = 2;i <= N;++i)\n            lg2[i] = lg2[i >> 1] + 1;\n        int w = fpow(G,(mod - 1) / N / 2),wi = fpow(w,mod - 2);\n        rt[0] = irt[0] = 1;\n        for(register int i = 1;i <= N;++i)\n        \trt[i] = (long long)rt[i - 1] * w % mod,\n        \tirt[i] = (long long)irt[i - 1] * wi % mod;\n        for(register int i = 0;i < N;++i)\n            rev[i] = (rev[i >> 1] >> 1) | ((i & 1) << LG),\n            i < rev[i] && (swap(rt[i],rt[rev[i]]),swap(irt[i],irt[rev[i]]),1);\n        fac[0] = 1;\n        for(register int i = 1;i <= N;++i)\n            fac[i] = (long long)fac[i - 1] * i % mod;\n        ifac[N] = fpow(fac[N],mod - 2);\n        for(register int i = N;i;--i)\n            ifac[i - 1] = (long long)ifac[i] * i % mod;\n        for(register int i = 1;i <= N;++i)\n            inv[i] = (long long)ifac[i] * fac[i - 1] % mod;\n    }\n    struct poly\n    {\n        vector<int> a;\n        inline poly(int x = 0)\n        {\n            x && (a.push_back(x),1);\n        }\n        inline poly(const vector<int> &o)\n        {\n            a = o,shrink();\n        }\n        inline poly(const poly &o)\n        {\n            a = o.a,shrink();\n        }\n        inline void shrink()\n        {\n            for(;!a.empty() && !a.back();a.pop_back());\n        }\n        inline int size() const\n        {\n            return a.size();\n        }\n        inline void resize(int x)\n        {\n            a.resize(x);\n        }\n        inline int operator[](int x) const\n        {\n            if(x < 0 || x >= size())\n                return 0;\n            return a[x];\n        }\n        inline void clear()\n        {\n            vector<int>().swap(a);\n        }\n        inline poly rever() const\n        {\n            return poly(vector<int>(a.rbegin(),a.rend()));\n        }\n        inline void dit()\n        {\n        \tint n = size();\n\t\t    for(register int i = 1,l = n >> 1;i < n;i <<= 1,l >>= 1)\n\t\t        for(register int j = 0,w,o = 0;j < i;++j,o += l << 1)\n\t\t\t\t{\n\t\t            w = rt[i | j];\n\t\t            for(register int k = o,t;k < o + l;++k)\n\t\t                t = (long long)a[k + l] * w % mod,\n\t\t                a[k + l] = dec(a[k],t),\n\t\t                a[k] = add(a[k],t);\n\t\t        }\n\t\t}\n\t\tinline void dif()\n\t\t{\n\t\t\tint n = size();\n\t\t    for(register int i = n >> 1,l = 1;i;i >>= 1,l <<= 1)\n\t\t        for(register int j = 0,w,o = 0;j < i;++j,o += l << 1)\n\t\t\t\t{\n\t\t            w = irt[i | j];\n\t\t            for(int k = o,t;k < o + l;++k)\n\t\t                t = a[k + l],\n\t\t                a[k + l] = dec(a[k],t),a[k + l] = (long long)a[k + l] * w % mod,\n\t\t                a[k] = add(a[k],t);\n\t\t        }\n\t\t    for(register int i = 0;i < n;++i)\n\t\t\t\ta[i] = (long long)a[i] * inv[n] % mod;\n\t\t}\n        inline void ntt(int type = 1)\n        {\n            type == 1 ? dit() : dif();\n        }\n        friend inline poly operator+(const poly &a,const poly &b)\n        {\n            vector<int> ret(max(a.size(),b.size()));\n            for(register int i = 0;i < ret.size();++i)\n                ret[i] = add(a[i],b[i]);\n            return poly(ret);\n        }\n        friend inline poly operator-(const poly &a,const poly &b)\n        {\n            vector<int> ret(max(a.size(),b.size()));\n            for(register int i = 0;i < ret.size();++i)\n                ret[i] = dec(a[i],b[i]);\n            return poly(ret);\n        }\n        friend inline poly operator*(poly a,poly b)\n        {\n            if(a.a.empty() || b.a.empty())\n                return poly();\n            int n = a.size(),m = b.size();\n            int lim = 1,tot = n + m - 1;\n            for(;lim < tot;lim <<= 1);\n            a.resize(lim),b.resize(lim);\n            for(register int i = n;i < lim;++i)\n                a.a[i] = 0;\n            for(register int i = m;i < lim;++i)\n                b.a[i] = 0;\n            a.ntt(),b.ntt();\n            for(register int i = 0;i < lim;++i)\n                a.a[i] = (long long)a[i] * b[i] % mod;\n            a.ntt(-1),a.shrink();\n            return a;\n        }\n        poly &operator+=(const poly &o)\n        {\n            resize(max(size(),o.size()));\n            for(register int i = 0;i < o.size();++i)\n                a[i] = add(a[i],o[i]);\n            return *this;\n        }\n        poly &operator-=(const poly &o)\n        {\n            resize(max(size(),o.size()));\n            for(register int i = 0;i < o.size();++i)\n                a[i] = dec(a[i],o[i]);\n            return *this;\n        }\n        poly &operator*=(poly o)\n        {\n            return (*this) = (*this) * o;\n        }\n        poly deriv() const\n        {\n            if(a.empty())\n                return poly();\n            vector<int> ret(size() - 1);\n            for(register int i = 0;i < size() - 1;++i)\n                ret[i] = (long long)(i + 1) * a[i + 1] % mod;\n            return poly(ret);\n        }\n        poly integ() const\n        {\n            if(a.empty())\n                return poly();\n            vector<int> ret(size() + 1);\n            for(register int i = 0;i < size();++i)\n                ret[i + 1] = (long long)a[i] * inv[i + 1] % mod;\n            return poly(ret);\n        }\n        inline poly modxn(int n) const\n        {\n            if(a.empty())\n                return poly();\n            n = min(n,size());\n            return poly(vector<int>(a.begin(),a.begin() + n));\n        }\n        inline poly inver(int m) const\n        {\n            poly ret(fpow(a[0],mod - 2)),f,g;\n            for(register int k = 1;k < m;)\n            {\n                k <<= 1,f.resize(k),g.resize(k);\n                for(register int i = 0;i < k;++i)\n                    f.a[i] = (*this)[i],g.a[i] = ret[i];\n                f.ntt(),g.ntt();\n                for(register int i = 0;i < k;++i)\n                    f.a[i] = (long long)f[i] * g[i] % mod;\n                f.ntt(-1);\n                for(register int i = 0;i < (k >> 1);++i)\n                    f.a[i] = 0;\n                f.ntt();\n                for(register int i = 0;i < k;++i)\n                    f.a[i] = (long long)f[i] * g[i] % mod;\n                f.ntt(-1);\n                ret.resize(k);\n                for(register int i = (k >> 1);i < k;++i)\n                    ret.a[i] = dec(0,f[i]);\n            }\n            return ret.modxn(m);\n        }\n        inline pair<poly,poly> div(poly o) const\n        {\n            if(size() < o.size())\n                return make_pair(poly(),*this);\n            poly f,g;\n            f = (rever().modxn(size() - o.size() + 1) * o.rever().inver(size() - o.size() + 1)).modxn(size() - o.size() + 1).rever();\n            g = (modxn(o.size() - 1) - o.modxn(o.size() - 1) * f.modxn(o.size() - 1)).modxn(o.size() - 1);\n            return make_pair(f,g);\n        }\n        inline poly log(int m) const\n        {\n            return (deriv() * inver(m)).integ().modxn(m);\n        }\n        inline poly exp(int m) const\n        {\n            poly ret(1);\n            for(register int k = 1;k < m;)\n                k <<= 1,ret = (ret * (1 - ret.log(k) + modxn(k))).modxn(k);\n            return ret.modxn(m);\n        }\n        inline poly pow(int m,int k1,int k2 = -1) const\n        {\n            if(a.empty())\n                return poly();\n            if(k2 == -1)\n                k2 = k1;\n            int t = 0;\n            for(;t < size() && !a[t];++t);\n            if((long long)t * k1 >= m)\n                return poly();\n            poly ret;\n            ret.resize(m);\n            int u = fpow(a[t],mod - 2),v = fpow(a[t],k2);\n            for(register int i = 0;i < m - t * k1;++i)\n                ret.a[i] = (long long)operator[](i + t) * u % mod;\n            ret = ret.log(m - t * k1);\n            for(register int i = 0;i < ret.size();++i)\n                ret.a[i] = (long long)ret[i] * k1 % mod;\n            ret = ret.exp(m - t * k1),t *= k1,ret.resize(m);\n            for(register int i = m - 1;i >= t;--i)\n                ret.a[i] = (long long)ret[i - t] * v % mod;\n            for(register int i = 0;i < t;++i)\n                ret.a[i] = 0;\n            return ret;\n        }\n    };\n}\nusing Poly::init;\nusing Poly::poly;\ninline int C(int n,int m)\n{\n    return n < m ? 0 : (long long)Poly::fac[n] * Poly::ifac[m] % mod * Poly::ifac[n - m] % mod;\n}\npoly f,g;\npair<poly,poly> res;\ninline poly solve(int m)\n{\n    poly ret,f2,fv1,fv,t,t1;\n    for(register int k = 1;k < m;)\n    {\n        k <<= 1,f2.resize(k << 1);\n        for(register int i = 0;i < (k << 1);++i)\n            f2.a[i] = ret[i];\n        f2.ntt();\n        fv1 = ret.pow(k,v - 1),fv = fv1,fv.resize(k << 1),fv.ntt();\n        for(register int i = 0;i < (k << 1);++i)\n            fv.a[i] = (long long)fv[i] * f2[i] % mod,\n            f2.a[i] = (long long)f2[i] * f2[i] % mod;\n        f2.ntt(-1),f2.resize(k),fv.ntt(-1),fv.resize(k);\n        t.resize(k),t1.resize(k);\n        for(register int i = 0;i < k;++i)\n            t.a[i] = add(fv[i - 1],ret[i]),\n            t.a[i] = dec(t[i],f2[i]);\n        t.a[1] = dec(t[1],1);\n        for(register int i = 0;i < k;++i)\n            t1.a[i] = ((long long)v * fv1[i - 1] % mod - 2 * ret[i] + 2 * mod) % mod;\n        t1.a[0] = add(t1[0],1);\n        ret -= (t * t1.inver(k)).modxn(k);\n    }\n    return ret.modxn(m);\n}\ninline pair<poly,poly> operator+(pair<poly,poly> a,pair<poly,poly> b)\n{\n    int alen = a.first.size(),blen = b.first.size();\n    int n = a.second.size(),m = b.second.size();\n    int lim = 1,tot = n + m - 1;\n    for(;lim < tot;lim <<= 1);\n    a.first.resize(lim),a.second.resize(lim),b.first.resize(lim),b.second.resize(lim);\n    a.first.ntt(),a.second.ntt(),b.first.ntt(),b.second.ntt();\n    for(register int i = 0;i < lim;++i)\n        a.first.a[i] = ((long long)a.first[i] * b.second[i] + (long long)a.second[i] * b.first[i]) % mod,\n        a.second.a[i] = (long long)a.second[i] * b.second[i] % mod;\n    a.first.ntt(-1),a.second.ntt(-1),\n    a.first.shrink(),a.second.shrink();\n    return a;\n}\ninline pair<poly,poly> solve(int l,int r)\n{\n    if(l == r)\n    {\n        poly t;\n        t.resize(2),t.a[0] = 1,t.a[1] = dec(0,a[l]);\n        return make_pair(poly(b[l]),t);\n    }\n    int mid = l + r >> 1;\n    return solve(l,mid) + solve(mid + 1,r);\n}\nvoid build(int l,int r)\n{\n    if(l == r)\n        return ;\n    ++tot;\n    int p = (long long)l * (n - r + 1) % mod * inv % mod;\n    a[tot] = (long long)p * fpow((1 - p + mod) % mod,mod - 2) % mod,\n    b[tot] = fpow((1 - p + mod) % mod,m);\n    int mid = l + r >> 1;\n    build(l,mid),build(mid + 1,r);\n}\nint main()\n{\n    init();\n    scanf(\"%d%d%d\",&n,&m,&v),v += 2,lim = LIM,inv = fpow(C(n + 1,2),mod - 2);\n    if(n == 1)\n\t{\n    \tputs(\"0\");\n    \treturn 0;\n\t}\n    if(v <= lim)\n    {\n        f = solve(m + 2),f.resize(m + 2),g = f.deriv();\n        for(register int i = 0;i <= m;++i)\n            f.a[i] = f[i + 1];\n        f.resize(m + 1),f = (g * f.inver(m + 1)).modxn(m + 1);\n    }\n    else\n    {\n        f.resize(m + 1),f.a[0] = 1;\n        for(register int i = 1;i <= m;++i)\n            for(register int j = 0;j * v <= i;++j)\n                f.a[i] = (f[i] + (long long)C(i,j) * (j & 1 ? mod - 1 : 1) % mod * C(2 * i - j * v - 1,i - 1)) % mod;\n    }\n    for(register int i = 0;i <= m;++i)\n        c[i] = (long long)C(m,i) * (fpow(v,i) - f[i] + mod) % mod * fpow(v,(mod - i - 1) % (mod - 1)) % mod;\n    build(1,n),res = solve(1,tot),res.first = (res.first.modxn(m + 1) * res.second.inver(m + 1)).modxn(m + 1);\n    for(register int i = 0;i <= m;++i)\n        ans = (ans + (long long)c[i] * res.first[i]) % mod;\n    printf(\"%d\\n\",ans);\n}\n```",
        "postTime": 1616496831,
        "uid": 75840,
        "name": "deserter",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 - \u826f\u5fc3\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u6a21\u677f\u9898"
    },
    {
        "content": "\u6280\u4e0d\u5982\u4eba\u7518\u62dc\u4e0b\u98ce\u3002\u5316\u5f0f\u5b50\u7684\u611f\u89c9\u8fd8\u662f\u592a\u83dc\u4e86\u3002\n\n___\n\n\u8d21\u732e\u62c6\u5f00\u81f3\u6bcf\u4e00\u4e2a\u8282\u70b9\uff0c\u4ece\u800c\u4e0d\u96be\u5c06\u95ee\u9898\u8f6c\u5316\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a\n\n- \u5bf9\u6240\u6709 $k\\in [0,m]$\uff0c\u6c42 $P_k$ \u8868\u793a \u300c\u957f\u4e3a $k$ \u7684\u6570\u5217\uff0c\u6bcf\u4e00\u9879\u5728 $[-1,V]$ \u5185\uff0c\u548c\u4e3a $0$ \u7684\u6570\u91cf\u300d\u3002\n\n- \u5bf9\u6240\u6709\u7ebf\u6bb5\u6811\u4e0a\u533a\u95f4 $[l,r]$\uff0c\u8bb0\u968f\u673a\u4e00\u4e2a\u533a\u95f4\u5305\u542b\u5b83\u7684\u6982\u7387\u4e3a $P_{[l,r]} = \\dfrac{l(n-r+1)}{\\frac{n(n+1)}{2}}$\uff0c\u6c42\u548c $\\sum_{[l,r]\\in \\text{SGT}}\\sum_{k=0}^m\\binom{m}{k}(1-\\dfrac{P_k}{(V+2)^k})P_{[l,r]}^k(1-P_{[l,r]})^{m-k}$\u3002\n\n___\n\n\u5148\u505a\u7b2c\u4e00\u4e2a\u3002\u663e\u7136 $P^k = [x^0](\\dfrac{1+x+\\cdots x^{V+1}}{x})^k$\u3002\u6c42\u7cfb\u6570\uff0c\u8003\u8651\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u3002\n- \u6ce8\u610f\u5230\u6c42\u7684\u662f $[x^0]$\uff0c\u56e0\u6b64\u53ea\u80fd\u4e0a\u53e6\u7c7b\u62c9\u683c\u6717\u65e5\u53cd\u6f14\u3002\n\n\u82e5\u8bbe $F = \\sum_{i=0}^{V+1} x^i = \\dfrac{1-x^{V+2}}{1-x},G = \\dfrac{F}{x}$\uff0c\u76f4\u63a5\u4e0a\u62c9\u53cd\uff0c\u5bfc\u51fa\u7684\u662f\u6211\u4eec\u4e0d\u60f3\u770b\u5230\u7684\u8d1f\u6307\u6570\u7cfb\u6570\u3002\n\n\u8003\u8651\u5982\u4f55\u89c4\u907f\u3002\u53ea\u9700**\u53d6\u5012**\u5c06 $G$ \u7684\u5b9a\u4e49\u66f4\u6539\u4e3a $G = \\dfrac{x}{F}$\uff0c\u6b64\u65f6 $P_k = [x^0]G^{-k}$\uff0c\u4ece\u800c\u62c9\u53cd\u5bfc\u51fa\u7684\u6210\u4e3a\u6b63\u6307\u6570 $[x^k](G^{(-1)})'\\dfrac{x}{G^{(-1)}}$\u3002\n\n\u4e8e\u662f\u95ee\u9898\u8f6c\u5316\u6210\u6c42 $G^{(-1)}$\u3002\u5957\u8def\u5730\uff0c\u5728 $G$ \u7684\u5b9a\u4e49\u5f0f\u4e2d\u66ff\u6362 $x$ \u4e3a $G^{(-1)}$ \uff0c\u5373\u53ef\u5bfc\u51fa\u4e00\u4e2a\u51fd\u6570\u65b9\u7a0b $\\dfrac{G^{(-1)}(1-G^{(-1)})}{1-(G^{(-1)})^{V+2}} = x$\u3002\n\n\u725b\u8fed\u89e3\u5b83\u5373\u53ef\u3002$O(n\\log n)$\u3002\u6ce8\u610f\u591a\u9879\u5f0f\u5feb\u901f\u5e42\u9700\u8981 P5273 \u90a3\u4e2a general \u7684\u7248\u672c\u3002\n\n___\n\n\u8003\u8651\u7b2c\u4e8c\u4e2a\u3002\u5c06\u5f0f\u5b50\u6574\u7406\uff0c**\u5408\u5e76\u540c\u6b21\u7684\u9879**\uff0c$\\sum_{[l,r]\\in \\text{SGT}}(1-P_{[l,r]})^{m}\\left(\\sum_{k=0}^m\\binom{m}{k}(1-\\dfrac{P_k}{(V+2)^k})(\\dfrac{P_{[l,r]}}{1-P_{[l,r]}})^k\\right)$\u3002\n\n\u4e0d\u96be\u60f3\u5230\u5c06\u540e\u9762\u7684\u770b\u505a\u4e00\u4e2a $m$ \u6b21\u591a\u9879\u5f0f\uff0c\u591a\u70b9\u6c42\u503c\u5373\u53ef\u3002$O(n\\log^2n)$\u3002\n___\n\n\u503c\u5f97\u6ce8\u610f\u7684\u70b9\uff1a\n\n- \u725b\u8fed\u89e3 $G^{(-1)}$ \u65f6\uff0c\u9700\u8981\u89e3\u5230 $m+1$ \u6b21\u9879\u800c\u975e $m$\uff0c\u56e0\u4e3a\u540e\u9762\u7684 $(G^{(-1)})'$  \u9700\u8981\u5f80\u540e\u7528\u4e00\u9879\u3002\uff08\u611f\u8c22 yjt \u7684\u6307\u51fa\uff09\n\n- $n=1$ \u65f6\u4f1a\u5bfc\u81f4\u7a7a\u591a\u9879\u5f0f\u7684\u51fa\u73b0\uff0c\u8bb0\u5f97\u5224\u6389\u3002\n\nCode\uff1a\u653e\u526a\u8d34\u677f\u3002\u56e0\u4e3a\u81ea\u5df1\u7684\u591a\u9879\u5f0f\u677f\u5b50\u592a\u96be\u770b\u4e86\u3002[Link](https://www.luogu.com.cn/paste/yla4rpda)\u3002",
        "postTime": 1657631611,
        "uid": 114153,
        "name": "Sali\u0435ri",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7445"
    }
]