[
    {
        "content": "\n[\u6b22\u8fce\u5230\u6211\u7684\u535a\u5ba2\u67e5\u770b](https://mivik.gitee.io/2020/solution/mivik-newbie-and-chinos-contest-2020-solution-amegura/)\n\n\u9996\u5148\u6765\u62c6\u89e3\u4e00\u4e0b\u968f\u673a\u6570\u751f\u6210\u5668\u751f\u6210 $N$ \u4e2a\u968f\u673a\u6570\u7684\u8fc7\u7a0b\u3002\n\n1. \u8c03\u7528 `init(uint32_t seed)`\uff0c`index` \u7f6e\u4e3a $N$\u3002\n2. \u7b2c\u4e00\u6b21\u8c03\u7528 `gen()` \u65f6\u7531\u4e8e `index` \u4e3a $N$ \u4f1a\u5148\u8c03\u7528 `twist()` \u51fd\u6570\uff0c\u4ece\u800c\u5c06 `index` \u7f6e\u4e3a `0`\u3002\n3. \u603b\u5171 $N$ \u6b21\u8c03\u7528 `gen()`\uff0c\u7b2c $i$ \u6b21\u8c03\u7528\u4f1a\u4f9d\u6b21\u8fd4\u56de `temper(mt[i - 1])`\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u8bbe\u8ba1\u51fa `temper(uint32_t x)` \u7684\u53cd\u51fd\u6570\u3002\u6211\u4eec\u89c2\u5bdf\u8fd9\u4e2a\u51fd\u6570\uff1a\n\n```cpp\nstatic inline uint32_t temper(uint32_t x) {\n\tx ^= (x >> U);\n\tx ^= (x << S) & B;\n\tx ^= (x << T) & C;\n\tx ^= (x >> L);\n\treturn x;\n}\n```\n\n\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u5b9e\u73b0\u4e0b\u9762\u4e24\u79cd\u64cd\u4f5c\uff1a\n\n- \u6839\u636e `(x ^ (x >> L))` \u8fd8\u539f\u51fa `x`\n- \u6839\u636e `(x ^ ((x << L) & V))` \u8fd8\u539f\u51fa `x`\n\n\u5c31\u53ef\u4ee5\u53cd\u5411\u8fdb\u884c `temper` \u64cd\u4f5c\u4e86\u3002\n\n\u6211\u4eec\u4ee5\u7b2c\u4e00\u79cd\u53cd\u5411\u64cd\u4f5c\u4e3a\u4f8b\u3002\u6211\u4eec\u6ce8\u610f\u5230 `(x ^ (x >> L))` \u4e8c\u8fdb\u5236\u4e0b\u6700\u9ad8\u7684 `L` \u4f4d\u548c `x` \u662f\u76f8\u540c\u7684\uff0c\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u7acb\u5373\u5f97\u5230 `x` \u4e8c\u8fdb\u5236\u4e0b\u7684\u6700\u9ad8 `L` \u4f4d\u3002\u63a5\u4e0b\u6765\uff0c\u7531\u4e8e\u6211\u4eec\u77e5\u9053\u4e86 `x` \u6700\u9ad8\u7684 `p1` \u4f4d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5f02\u6216\u8fd8\u539f\u51fa `x` \u6700\u9ad8\u7684 `2L` \u4f4d\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002\u4e0b\u56fe\u7b80\u5355\u89e3\u91ca\u4e86\u8fd9\u4e00\u6d41\u7a0b\uff08`L = 6`\uff09\uff1a\n\n```plain\nAAAAAABBBBBB--------------------|       --> x\n      AAAAAABBBBBB--------------|------ --> (x >> L)\n```\n\n\u6211\u4eec\u7b2c\u4e00\u6b65\u80fd\u77e5\u9053 `A` \u7684\u90e8\u5206\uff0c\u7136\u540e\u901a\u8fc7\u5f02\u6216\u5c31\u53ef\u4ee5\u5f97\u51fa `B` \u7684\u90e8\u5206\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002\u4e0b\u9762\u662f\u7b80\u8981\u7684\u4ee3\u7801\uff1a\n\n```cpp\ninline uint32_t inv_shift_right(uint32_t v, uint8_t bits) {\n\tif (bits == 32) return v;\n\t// cur \u8868\u793a\u5df2\u7ecf\u5f97\u51fa\u7684\u90e8\u5206\uff0ck \u8868\u793a\u5f53\u524d\u5df2\u7ecf\u63a8\u5bfc\u4e86\u524d\u51e0\u4f4d\u3002\n\tuint32_t mask = (-1U) << (32 - bits), cur = v & mask;\n\tfor (uint8_t k = bits; k < 32; k += bits)\n\t\tcur |= (v ^ (cur >> bits)) & (mask >>= bits);\n\treturn cur;\n}\n```\n\n\u540c\u6837\u5730\uff0c\u7b2c\u4e8c\u79cd\u53cd\u5411\u64cd\u4f5c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u76f8\u4f3c\u7684\u65b9\u5f0f\u5b9e\u73b0\uff1a\n\n```cpp\ninline uint32_t inv_shift_left(uint32_t v, uint8_t bits, uint32_t m) {\n\tif (bits == 32) return v;\n\tuint32_t mask = (1U << bits) - 1, cur = v & mask;\n\tfor (uint8_t k = bits; k < 32; k += bits)\n\t\tcur |= (v ^ ((cur << bits) & m)) & (mask <<= bits);\n\treturn cur;\n}\n```\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u53cd\u5411 `temper` \u64cd\u4f5c\u6765\u5f97\u5230\u521a\u8c03\u7528 `twist()` \u51fd\u6570\u540e\u7684 `mt` \u6570\u7ec4\u4e2d\u7684 $N$ \u4e2a\u6570\u3002\u6211\u4eec\u89c2\u5bdf\u8fd9\u4e2a `twist` \u51fd\u6570\uff1a\n\n```cpp\n// \u5f97\u5230\u4e0b\u4e00\u72b6\u6001\ninline void twist() {\n\tfor (int i = 0; i < N; ++i) {\n\t\tuint32_t tmp = (mt[i] & (1U << 31)) | (mt[keep_in_range(i + 1)] & 0x7fffffffU);\n\t\ttmp = (tmp & 1)? ((tmp >> 1) ^ A): (tmp >> 1);\n\t\tmt[i] = mt[keep_in_range(i + M)] ^ tmp;\n\t}\n\tindex = 0;\n}\n```\n\n\u6211\u4eec\u53d1\u73b0\u4e0d\u884c\u4e86\uff1a\u6211\u4eec\u6ca1\u6cd5\u5012\u63a8\u51fa `tmp`\uff0c\u56e0\u4e3a\u6211\u4eec\u5e76\u4e0d\u77e5\u9053 `tmp` \u4e00\u5f00\u59cb\u5230\u5e95\u662f\u4e0d\u662f\u5947\u6570\uff0c\u5982\u679c\u66b4\u529b\u679a\u4e3e\u662f $O(2^N)$ \u7684\u3002\u600e\u4e48\u529e\u5462\uff1f\n\n\u6211\u4eec\u8003\u8651\u4ece\u5176\u5b83\u5730\u65b9\u5207\u5165\uff0c\u89c2\u5bdf\u8fd9\u4e2a `init()` \u51fd\u6570\uff1a\n\n```cpp\n// \u4f7f\u7528\u79cd\u5b50\u521d\u59cb\u5316\ninline void init(uint32_t seed) {\n\tmt[0] = seed;\n\tfor (int i = 1; i < N; ++i)\n\t\t// \u6ce8\u610f\u8fd9\u91cc\u7684\u65e0\u7b26\u53f7\u6574\u578b\u4e58\u6cd5\u6ea2\u51fa\u4e3a\u5b9a\u4e49\u884c\u4e3a\uff0c\u5373\u5f97\u5230\u7684\u7ed3\u679c\u4e0e\u771f\u5b9e\u7ed3\u679c\u5728\u6a21 2 ^ 32 \u610f\u4e49\u4e0b\u540c\u4f59\n\t\tmt[i] = F * (mt[i - 1] ^ (mt[i - 1] >> 30)) + i;\n\tindex = N;\n}\n```\n\n\u7531\u4e8e $F$ \u662f\u5947\u6570\uff0c\u90a3\u4e48 $F$ \u5728\u6a21 $2^{32}$ \u610f\u4e49\u4e0b\u6709\u9006\u5143\u3002\u4f7f\u7528\u8fd9\u4e2a\u9006\u5143\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `mt[i]` \u89e3\u51fa `(mt[i - 1] ^ (mt[i - 1] >> 30))`\uff0c\u4ece\u800c\u7528\u4e0a\u9762\u63d0\u5230\u7684\u53cd\u5411\u64cd\u4f5c\u5f97\u51fa `mt[i - 1]` \u7684\u503c\u3002\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u53ea\u8981\u77e5\u9053\u4e86 `mt[N - 1]` \u5c31\u53ef\u4ee5\u63a8\u51fa\u6574\u4e2a\u8c03\u7528 `twist()` \u4e4b\u524d\u7684 `mt` \u6570\u7ec4\uff0c\u6211\u4eec\u53ea\u9700\u8981\u679a\u4e3e\u4e00\u4e0b `mt[N - 1]` \u7684\u503c\u5e76\u68c0\u67e5\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(N)$\u3002\n\n[mivik.h](https://mivik.gitee.io/mivik.h)\n\n[\u4ee3\u7801](https://paste.ubuntu.com/p/TPbJGmKDNg/)",
        "postTime": 1606554238,
        "uid": 45182,
        "name": "Mivik",
        "ccfLevel": 9,
        "title": "[\u9898\u89e3] Ame \u548c Gura \u7684\u5947\u5999\u63a2\u9669"
    }
]