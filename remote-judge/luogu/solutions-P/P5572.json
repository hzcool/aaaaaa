[
    {
        "content": "\u9898\u610f\uff1a\u7ec4\u6570\u5c0f\u4e8e\u7b49\u4e8e $30000$\uff0c$n,m\\le 5\\times10^4$ \u591a\u6d4b\n\n$$\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(\\frac{ij}{\\gcd^2(i,j)})$$\n\n\u9ed8\u8ba4 $n\\le m,x/y\\rightarrow\\lfloor\\frac{x}{y}\\rfloor$\uff0c\u7136\u540e\u4f60\u4e00\u6f14\n\n$$\\sum_{d=1}^n\\sum_{i=1}^{n/d}\\sum_{j=1}^{m/d}\\varphi(ij)[\\gcd(i,j)=1]$$\n\n$$\\sum_{d=1}^n\\sum_{i=1}^{n/d}\\sum_{j=1}^{m/d}\\varphi(i)\\varphi(j)[\\gcd(i,j)=1]$$\n\n$$\\sum_{d=1}^n\\sum_{k=1}^{n/d}\\mu(k)\\sum_{i=1}^{n/dk}\\varphi(ik)\\sum_{j=1}^{m/dk}\\varphi(jk)$$\n\n$$dk\\rightarrow T,\\sum_{T=1}^n\\sum_{d|T}\\mu(d)\\sum_{i=1}^{n/T}\\varphi(id)\\sum_{j=1}^{m/T}\\varphi(jd)$$\n\n\u7136\u540e\u5c31\u662f\u53d1\u626c\u4eba\u7c7b\u667a\u6167\u7684\u65f6\u5019\u4e86\uff01\n\n\u4f60\u53d1\u73b0\u53d8\u5316\u540e\u7684\u67ff\u5b50\u53ea\u8981\u6c42 $\\varphi$ \u5728 $\\text{maxn}$ \u4ee5\u5185\u7684\u503c\uff0c\u4e8e\u662f\u4f60\u5c31\u638f\u51fa\u6765\u4e00\u4e2a $G$\uff0c\u8868\u793a\uff1a\n\n$$G(x,y)=\\sum_{i=1}^x\\varphi(yi)$$\n\n\u663e\u7136 $G$ \u4e0d\u8d85\u8fc7\u8c03\u548c\u5927\u5c0f\u4e2a\uff0c\u66b4\u529b\u9884\u5904\u7406\u5373\u53ef\u3002\n\n$$\\sum_{T=1}^n\\sum_{d|T}\\mu(d)G(n/T,d)G(m/T,d)$$\n\n\u7136\u540e\u4f60\u53c8\u638f\u51fa\u4e00\u4e2a $H$ \uff0c\u8868\u793a\uff1a\n\n$$H(x,y,z)=\\sum_{i=1}^z\\sum_{T|i}\\mu(T)G(x,T)G(y,T)$$\n\n\u5982\u679c\u4f60\u80fd\u628a\u7b54\u6848\u9884\u5904\u7406\u51fa\u6765\uff0c\u90a3\u5c06\u662f\u975e\u5e38\u7f8e\u5999\u7684\u4e8b\uff0c\u4f46\u662f\u4f1a $\\text{MTLE}$\uff0c\u6240\u4ee5\u6211\u4eec\u638f\u51fa\u4e00\u4e2a\u4eba\u7c7b\u667a\u6167\uff0c\u8003\u8651\u9884\u5904\u7406\u4e00\u4e9b\u4e1c\u897f\u51fa\u6765\uff0c\u5269\u4e0b\u66b4\u529b\u3002\n\n\u5f04\u51fa\u6765\u4e00\u4e2a\u503c\u57df $B$\uff0c\u5bf9\u4e8e $m/B$ \u4ee5\u5185\u7684 $z$ \u66b4\u529b\u7528 $G$ \u7b97\uff0c\u5176\u4ed6\u6ce8\u610f\u5230 $H(x,y,z)$ \u4e2d\u7684 $x,y$ \u5b9e\u8d28\u5c31\u662f $n/T,m/T$\uff0c\u4f7f\u7528\u6574\u9664\u5206\u5757\u6765\u4f18\u5316\u5373\u53ef\u3002\n\n\u73b0\u5728\u662f $16:41$\uff0c\u6211\u770b\u6211\u4ec0\u4e48\u65f6\u5019\u5199\u5b8c\u3002\n\n\u73b0\u5728\u662f $18:15$\uff0c\u6211\u5199\u5b8c\u4e86\u3002\n\n```cpp\n#define maxn 50010\nconst int p=23333;\nint pri[maxn],mu[maxn],phi[maxn],tot;\nbitset<maxn>v;\nconst int B=72;\nvector<int>G[maxn],H[B+10][B+10],fac[maxn];\nint ksm(int a,int b){\n\tint ans=1;\n\tfor(;b;b>>=1,a=a*a%p)\n\tif(b&1)ans=ans*a%p;\n\treturn ans;\n}\nint calc(int x,int y,int z){\n\tint ans=0;\n\tfor(int o:fac[z])\n\tans=(ans+mu[o]*G[o][x]%p*G[o][y])%p+p;\n\treturn ans%p;\n}\nvoid shai(int n){\n\tfor(int i=1;i<=n;i++)\n\tfor(int j=i;j<=n;j+=i)\n\tfac[j].push_back(i);\n\tmu[1]=phi[1]=1;\n\tfor(int i=2;i<=n;i++){\n\t\tif(v[i]==0)pri[++tot]=i,phi[i]=i-1,mu[i]=-1;\n\t\tfor(int j=1;j<=tot&&i*pri[j]<=n;j++){\n\t\t\tv[i*pri[j]]=1;\n\t\t\tif(i%pri[j]==0){\n\t\t\t\tphi[i*pri[j]]=phi[i]*pri[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i*pri[j]]=phi[i]*(pri[j]-1);\n\t\t\tmu[i*pri[j]]=-mu[i];\n\t\t}\n\t}\n\tfor(int i=1;G[i].push_back(0),i<=n;i++)\n\tfor(int j=1;j*i<=n;j++)\n\tG[i].push_back((G[i][j-1]+phi[i*j])%p);\n\tfor(int i=1;i<=B;i++)for(int j=1;j<=B;j++){\n\t\tH[i][j].push_back(0);\n\t\tfor(int k=1;k<=n/max(i,j);k++)\n\t\tH[i][j].push_back((H[i][j][k-1]+calc(i,j,k))%p);\n\t}\n}\nint T,n,m,ans;\nsigned main(){\n\tshai(50000);\n\tfor(cin>>T;T;T--){\n\t\tcin>>n>>m;\n\t\tif(n>m)swap(n,m);\n\t\tans=0;\n\t\tfor(int i=1;i<=m/B;i++)ans=(ans+calc(n/i,m/i,i))%p;\n\t\tfor(int L=m/B+1,R;L<=n;L=R+1){\n\t\t\tR=min(n/(n/L),m/(m/L));\n\t\t\tans=(ans+H[n/L][m/L][R]-H[n/L][m/L][L-1]+p)%p;\n\t\t}\n\t\tcout<<ans%p<<endl;\n\t}\n}\n```\n\u964d\u667a\u4e86\uff0c\u628aP4240\u7684\u4ee3\u7801\u8d3a\u8fc7\u6765\u7684\u65f6\u5019\u6709\u4e2a\u5730\u65b9\u6ca1\u6539\uff0c$\\text{WA}$ \u4e86\u4e0d\u4e45\u3002",
        "postTime": 1631695275,
        "uid": 100325,
        "name": "peterwuyihong",
        "ccfLevel": 7,
        "title": "P5572 [CmdOI2019]\u7b80\u5355\u7684\u6570\u8bba\u9898 \u8bb0\u5f55"
    },
    {
        "content": "### \u5b98\u65b9\u9898\u89e3 : \u7b80\u5355\u7684\u6570\u8bba\u9898\n\n$\\color{blue}(\\text{\u91cd\u5236\u4e8e 2020.11.24})$ : \u66f4\u7b80\u6d01\u7684\u63a8\u5bfc\uff0c\u66f4\u4e25\u8c28\u7684\u590d\u6742\u5ea6\u5206\u6790\u3002\u52a0\u66f4\u83ab\u961f\u89e3\u6cd5\u3002\n\n\u5176\u5b9e\u8fd9\u4e2a\u9898\u6839\u672c\u6ca1\u7528\u5230\u6b27\u62c9\u51fd\u6570\u7684\u795e\u5947\u6027\u8d28\u3002\n\n\u5982\u679c\u4f60\u5f80 $\\varphi(ij)=\\dfrac{\\varphi(i)\\varphi(j)(i,j)}{\\varphi((i,j))}$ \u8fd9\u65b9\u9762\u601d\u8003\uff0c\u53ef\u80fd\u4f1a\u4e00\u53bb\u4e0d\u590d\u8fd4\u3002\n\n(\u5f53\u7136,\u6b22\u8fce\u5927\u4f6c\u8e29\u6807\u7b97)\n\n\u6362\u53e5\u8bdd\u8bf4\u628a $\\varphi$ \u6362\u6210\u4efb\u610f\u4e00\u4e2a\u79ef\u6027\u51fd\u6570,\u90fd\u662f\u53ef\u4ee5\u505a\u7684\u3002\n\n- $\\Large 20'$\n\n$n,m\\leq 100,T\\leq 100$\n\n\u6253\u51fa $\\varphi$ \u7684\u8868\uff0c\u7136\u540e\u6309\u7167\u9898\u610f\u5927\u529b\u8ba1\u7b97\u5373\u53ef\u3002\n\n- $\\Large 40'$\n\n$n,m\\leq 2000,T\\leq 3*10^4$\n\n\u6253\u4e2a\u7b54\u6848\u7684\u8868\u5c31\u597d\u4e86, $\\varphi$ \u7ebf\u6027\u7b5b,\u590d\u6742\u5ea6 $O(n^2\\log n+T)$ \u6216\u8005 $O(n^2+T)$ \u3002\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#define MaxN 4000500\n#define MaxNum 2010\n#define mod 23333\nusing namespace std;\nint T,N,M;\nbool e[MaxN+500];\nint tn,p[MaxN+500],phi[MaxN+500];\nint gcd[MaxNum+50][MaxNum+50];\nint ans[MaxNum+50][MaxNum+50];\nint gcdpre(int a,int b)\n{\n  if (!b)return a;\n  if (gcd[a][b])return gcd[a][b];\n  return gcd[a][b]=gcdpre(b,a%b); \n}\ninline void getsth()\n{\n  e[1]=1;phi[1]=1;\n  for (int i=2,t;i<=MaxN;i++){\n    if (!e[i]){\n      p[++tn]=i;\n      phi[i]=i-1;\n    }\n    for (int j=1;j<=tn&&(t=p[j]*i)<=MaxN;j++){\n      phi[t]=phi[i]*(i%p[j]==0 ? p[j] : p[j]-1);\n      e[t]=1;\n      if (i%p[j]==0)break;\n    }\n  }\n  for (int i=1;i<=MaxNum;i++)\n    for (int j=1;j<=MaxNum;j++)\n      gcd[i][j]=gcdpre(i,j);\n  for (int i=1;i<=MaxNum;i++)\n    for (int j=1;j<=MaxNum;j++)\n      ans[i][j]=(phi[i*j/gcd[i][j]/gcd[i][j]]\n        +ans[i-1][j]+ans[i][j-1]-ans[i-1][j-1])%mod;\n}\nint main()\n{\n  scanf(\"%d\",&T);\n  getsth();\n  while(T--){\n    scanf(\"%d%d\",&N,&M);\n    printf(\"%d\\n\",(ans[N][M]+mod)%mod);\n  }return 0;\n}\n```\n\n- $\\Large 60'$\n\n$n,m\\leq 3\\times 10^4,T\\leq 5000$\n\n\u9001\u5206\u7ed3\u675f,\u5f00\u59cb\u63a8\u5bfc\u5f0f\u5b50:\n\n\u6c42 $\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^m\\varphi\\left(\\dfrac{lcm(i,j)}{gcd(i,j)}\\right)$\n\n$=\\sum\\limits_{d=1}^n\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^m\\varphi\\left(\\dfrac{ij}{d^2}\\right)[gcd(i,j)=d]$\n\n$=\\sum\\limits_{d=1}^n\\sum\\limits_{i=1}^{n/d}\\sum\\limits_{j=1}^{m/d}\\varphi(ij)[i\\perp j]$\n\n$=\\sum\\limits_{d=1}^n\\sum\\limits_{i=1}^{n/d}\\sum\\limits_{j=1}^{m/d}\\varphi(i)\\varphi(j)[i\\perp j]$\n\n$=\\sum\\limits_{d=1}^n\\sum\\limits_{i=1}^{n/d}\\sum\\limits_{j=1}^{m/d}\\varphi(i)\\varphi(j)\\sum\\limits_{t|i,t|j}\\mu(t)$\n\n$=\\sum\\limits_{d=1}^n\\sum\\limits_{t=1}^{n/d}\\mu(t)\\sum\\limits_{t|i}^{n/d}\\varphi(i)\\sum\\limits_{t|j}^{m/d}\\varphi(j)$\n\n$=\\sum\\limits_{d=1}^n\\sum\\limits_{t=1}^{n/d}\\mu(t)\\sum\\limits_{i=1}^{n/dt}\\varphi(it)\\sum\\limits_{j=1}^{m/dt}\\varphi(jt)$\n\n- \u8bbe $G(n,k)=\\sum\\limits_{i=1}^n\\varphi(ik)$\n\n.$=\\sum\\limits_{d=1}^n\\sum\\limits_{t=1}^{n/d}\\mu(t)G(\\lfloor n/dt\\rfloor,t)G(\\lfloor m/dt\\rfloor,t)$\n\n\u8bbe $L=\\max(n,m)$\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u6211\u4eec\u8c03\u7528\u7684 $G(n,k)$ \u51fd\u6570\u90fd\u6ee1\u8db3 $n,k\\leq L$\uff0c\u6240\u4ee5\u603b\u72b6\u6001\u91cf\u662f $O\\Big(\\sum\\limits_{x,y}[xy\\leq n]\\Big)=O(L\\log L)$ \u7684\u3002\n\n\u4e0d\u8fc7\uff0c\u7531\u4e8e $t$ \u7684\u5b58\u5728\uff0c\u4e0a\u9762\u90a3\u4e2a\u5f0f\u5b50\u4ecd\u7136\u4e0d\u80fd\u76f4\u63a5\u6574\u9664\u5206\u5757\u3002\n\n- \u8bbe $S(n,m,k)=\\mu(k)G(n,k)G(m,k)$\n\n\u5219 ${\\rm Ans}=\\sum\\limits_{d=1}^n\\sum\\limits_{t=1}^{n/d}S(\\lfloor n/dt\\rfloor,\\lfloor m/dt\\rfloor,t)$\n\n\u5bf9 $S$ \u5728 $t$ \u7ef4\u5ea6\u4e0a\u505a\u524d\u7f00\u548c\uff0c\u5373\u53ef\u6574\u9664\u5206\u5757\u3002\n\n\u6211\u4eec\u9884\u5904\u7406\u51fa $n,m\\leq B$ \u7684 $S(n,m,k)$\uff0c\u7531 $m*k,n*k<=L$ \u53ef\u4ee5\u5f97\u5230\u603b\u72b6\u6001\u91cf\u4e3a :\n\n$O\\Big(\\sum\\limits_{n=1}^B\\sum\\limits_{m=1}^BL/\\max(n,m)\\Big)=O\\Big(\\sum\\limits_{n=1}^B\\sum\\limits_{m=1}^nL/n\\Big)=O(LB)$\u3002\n\n${\\rm Ans}=\\sum\\limits_{d=1}^nf(\\lfloor n/d\\rfloor,\\lfloor m/d\\rfloor ,1)$\n\n\u4ee4 $B\u2248\\sqrt{L}$ ,\u9884\u5904\u7406 $S$ \u7684\u65f6\u7a7a\u590d\u6742\u5ea6\u4e3a $O(L\\sqrt{L})$ \u3002\n\n\u8bbe $f(n,m)=\\sum\\limits_{t=1}^{n}S(\\lfloor n/t\\rfloor,\\lfloor m/t\\rfloor,t)$\n\n\u5f53 $n/t\\geq B\\Rightarrow t\\leq n/B$ \u65f6\uff0c\u6ca1\u6709\u9884\u5904\u7406 $S$ \uff0c\u9700\u8981\u66b4\u529b\u6c42\u548c,\u590d\u6742\u5ea6\u4e3a $O(n/B)\\leq O(\\sqrt{n})$\u3002\n\n\u5f53 $t>n/B$ \u65f6\uff0c\u53ef\u4ee5\u6574\u9664\u5206\u5757\u8ba1\u7b97\uff0c\u8fd9\u90e8\u5206\u590d\u6742\u5ea6\u4e3a $O(\\sqrt{n})$\u3002\n\n${\\rm Ans}=\\sum\\limits_{d=1}^nf(\\lfloor n/d\\rfloor,\\lfloor m/d\\rfloor)$\n\n\u76f4\u63a5\u5206\u5757\u5957\u5206\u5757\u8ba1\u7b97\uff0c\u590d\u6742\u5ea6\u4e3a$O(\u222b_1^{\\sqrt{n}}\\sqrt{n/x})=O(n^{3/4})$ ,\u5e38\u6570\u8f83\u5927\u3002\n\n\u603b\u590d\u6742\u5ea6 $O(TL^{3/4}+L\\sqrt{L})$\u3002\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#define ll long long\n#define MaxN 30500\nusing namespace std;\nconst int mod=23333,B=200,lim=30000;\nint tn,p[MaxN>>2],mu[MaxN],phi[MaxN]\n   ,*G[MaxN],_G[MaxN*16],*gp=_G\n   ,*S[B+5][B+5],_S[MaxN*(B+B/4)],*sp=_S;\nvoid getsth()\n{\n  phi[1]=mu[1]=1;\n  for (int i=2,t;i<=lim;i++){\n    if (!phi[i]){\n      mu[p[++tn]=i]=-1;\n      phi[i]=i-1;\n    }\n    for (int j=1;j<=tn&&(t=p[j]*i)<=lim;j++){\n      if (i%p[j]==0){\n        phi[t]=phi[i]*p[j];\n        break;\n      }mu[t]=-mu[i];\n      phi[t]=phi[i]*(p[j]-1);\n    }\n  }G[0]=gp;gp+=lim+1;\n  for (int x=1;x<=lim;x++){\n    G[x]=gp+1;\n    gp+=lim/x+1;\n    for (int y=1;x*y<=lim;y++)\n      G[x][y]=(G[x-1][y]+phi[x*y])%mod;\n  }\n  for (int j=1;j<=B;j++)\n    for (int i=j;i<=B;i++){\n      S[i][j]=sp;\n      sp+=lim/i+2;\n      for (int k=1;k*i<=lim;k++)\n        S[i][j][k]=(S[i][j][k-1]+mu[k]*G[i][k]%mod*G[j][k])%mod;\n    }\n}\nint f(int n,int m)\n{\n  ll ans=0;\n  for (int i=1;i*B<=n;i++)\n    ans+=mu[i]*G[n/i][i]*G[m/i][i];\n  ans%=mod;\n  register int l=n/B+1,r;int tn,tm;\n  for (;l<=m;l=r+1){\n    r=min(n/(tn=n/l),m/(tm=m/l));\n    ans+=S[tn][tm][r]-S[tn][tm][l-1];\n  }return ans%mod;\n}\nint T,N,M;\nint main()\n{\n  scanf(\"%d\",&T);\n  getsth();\n  while(T--){\n    scanf(\"%d%d\",&N,&M);\n    if (N<M)swap(N,M);\n    ll ans=0;\n    int l=1,r;\n    for (;l<=M;l=r+1){\n      r=min(N/(N/l),M/(M/l));\n      ans+=f(N/l,M/l)*(r-l+1)%mod;\n    }printf(\"%d\\n\",(ans%mod+mod)%mod);\n  }return 0;\n}\n```\n\n- $\\Large \\oplus\\ 20'$\n\n$n=m\\leq 5*10^4,T\\leq 5*10^4$\n\n\u53d1\u73b0\u9884\u5904\u7406\u6240\u6709 $f(n,n)$ \u7684\u503c\uff0c\u5c31\u53ea\u9700\u4e00\u6b21\u5916\u5c42\u6574\u9664\u5206\u5757\u3002\n\n(\u6b64\u5916, $S$ \u4e5f\u4e0d\u7528\u8d39\u5fc3)\n\n- $\\Large 100'$\n\n$n,m\\leq 5*10^4,T\\leq 5*10^4$\n\n\u627f\u63a5\u4e0a\u9762\u7684\u5f0f\u5b50:\n\n${\\rm Ans}=\\sum\\limits_{d=1}^n\\sum\\limits_{t=1}^{n/d}\\mu(t)G(n/dt,t)G(m/dt,t)$\n\n\u8bbe $T=dk$ ,\u4ea4\u6362\u548c\u5f0f\u5f97\u5230:\n\n$=\\sum\\limits_{T=1}^n\\sum\\limits_{k|T}\\mu(k)G(n/T,k)G(m/T,k)$\n\n\u4ecd\u7136\u4e0d\u80fd\u6574\u9664\u5206\u5757\uff0c\u66b4\u529b\u7684\u8bdd\u9700\u8981 $O(n\\log n)$ ,\u4e0d\u77e5T\u5230\u54ea\u91cc\u53bb\u4e86\u3002\n\n\u6211\u4eec\u8bbe $R(n,m,t)=\\sum\\limits_{k|T}\\mu(k)G(n,k)G(m,k)$\n\n\u6211\u4eec\u9884\u5904\u7406 $n\\leq\\sqrt{L}$ \u7684 $R(n,m,t)$ \uff0c\u72b6\u6001\u91cf\u4ecd\u7136\u662f $O(L\\sqrt{L})$\u3002\n\n\u9884\u5904\u7406\u65f6\uff0c\u5bf9\u4e8e $t$ \u8fd9\u4e00\u7ef4\u505a\u7ea6\u6570\u6c42\u548c\uff0c\u5bb9\u6613\u505a\u5230 $O(L\\sqrt{L}\\log L)$ (\u8c03\u548c\u7ea7\u6570)\u3002\n\n\u5b9e\u9645\u4e0a\u8fd8\u53ef\u4ee5\u505a\u5230 $O(L\\sqrt{L}\\log\\log L)$ \uff0c\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u89c1 [\u72c4\u5229\u514b\u96f7\u76f8\u5173](https://www.luogu.com.cn/blog/command-block/gcd-juan-ji-xiao-ji)\u3002\n\n${\\rm Ans}=\\sum\\limits_{T=1}^nR(n/T,m/T,T)$\n\n\u5bf9\u4e8e $n/T\\leq B$ \u7684\u90e8\u5206\u6574\u9664\u5206\u5757\uff0c\u590d\u6742\u5ea6\u4e3a $O(\\sqrt{n})$.\n\n\u5bf9\u4e8e $n/T>B$ \u5373 $T\\leq n/B$ \u7684\u90e8\u5206\u6211\u4eec\u662f\u6ca1\u6709\u9884\u5904\u7406\u7684,\u590d\u6742\u5ea6\u4e3a $O(n/B\\log n)=O(\\sqrt{n}\\log n)$\u3002\n\n\u7efc\u4e0a,\u7a7a\u95f4 $O(n\\sqrt{n})$ ,\u65f6\u95f4 $O\\big((L+T)\\sqrt{L}\\log L\\big)$\u3002\n\n~~\u5e38\u6570\u6bd4\u8f83\u5c0f,\u6240\u4ee5\u6bd460pts\u505a\u6cd5\u5feb\u5230\u4e0d\u77e5\u54ea\u91cc\u53bb\u4e86~~\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#define ll long long\n#define MaxN 50500\nusing namespace std;\nconst int mod=23333,B=150,lim=50000;\nint tn,p[MaxN>>2],mu[MaxN],phi[MaxN]\n   ,*G[MaxN],_G[MaxN*16],*gp=_G\n   ,*R[B+5][B+5],_R[MaxN*(B+B/4)],*rp=_R;\nvoid getsth()\n{\n  phi[1]=mu[1]=1;\n  for (int i=2,t;i<=lim;i++){\n    if (!phi[i]){\n      mu[p[++tn]=i]=-1;\n      phi[i]=i-1;\n    }\n    for (int j=1;j<=tn&&(t=p[j]*i)<=lim;j++){\n      if (i%p[j]==0){\n        phi[t]=phi[i]*p[j];\n        break;\n      }mu[t]=-mu[i];\n      phi[t]=phi[i]*(p[j]-1);\n    }\n  }G[0]=gp;gp+=lim+1;\n  for (int x=1;x<=lim;x++){\n    G[x]=gp+1;\n    gp+=lim/x+1;\n    for (int y=1;x*y<=lim;y++)\n      G[x][y]=(G[x-1][y]+phi[x*y])%mod;\n  }\n  for (int j=1;j<=B;j++)\n   for (int i=j;i<=B;i++){\n     R[i][j]=rp;\n     rp+=lim/i+2;\n     int n0=lim/i;\n     for (int k=1;k<=n0;k++){\n       int sav=mu[k]*G[i][k]%mod*G[j][k];\n       for (int p=k;p<=n0;p+=k)\n         R[i][j][p]+=sav;\n     }\n     for (int k=1;k*i<=lim;k++)\n       R[i][j][k]=(R[i][j][k-1]+R[i][j][k])%mod;\n  }\n}\nint T,N,M;\nint main()\n{\n  scanf(\"%d\",&T);\n  getsth();\n  while(T--){\n    scanf(\"%d%d\",&N,&M);\n    long long ans=0;\n    for (int i=1;i*B<=N;i++)\n      for (int j=i;j*B<=N;j+=i)\n        ans+=mu[i]*G[N/j][i]*G[M/j][i];\n    ans%=mod;\n    register int l=N/B+1,r;int tn,tm;\n    for (;l<=M;l=r+1){\n      r=min(N/(tn=N/l),M/(tm=M/l));\n      ans+=R[tn][tm][r]-R[tn][tm][l-1];\n    }printf(\"%d\\n\",(ans%mod+mod)%mod);\n  }return 0;\n}\n```\n\n## \u53e6\u89e3\n\n\u6765\u81ea @\u6d41\u98ce\u4e4b\u56de\u96ea \u5927\u4f6c\u7684\u8d5b\u65f6\u89e3\u6cd5\u3002\n\n\u53d1\u73b0\u6b64\u9898\u5e76\u6ca1\u6709\u5f3a\u5236\u5728\u7ebf\uff0c\u53ef\u4ee5\u4f7f\u7528\u57fa\u4e8e\u83ab\u961f\u7684\u7684\u505a\u6cd5\u3002\n\n\u9759\u5f85\u5927\u4f6c\u53d1\u9898\u89e3\u2026\u2026 \n\n\uff08\u7136\u800c\u4e00\u5e74\u591a\u8fc7\u53bb\u4e86\u8fd8\u662f\u6ca1\u6709\u5176\u4ed6\u9898\u89e3\uff0c\u90a3\u6211\u5c31\u81ea\u5df1\u5199\u5199\u5427\uff09\n\n\u8bbe\u4e00\u884c\u7684\u6743\u503c $S(n,k)=\\sum\\limits_{i=1}^n\\varphi\\Big(\\dfrac{{\\rm lcm}(i,k)}{\\gcd(i,k)}\\Big)$\n\n\u83ab\u961f\u53ef\u4ee5\u628a\u95ee\u9898\u8f6c\u5316\u6210 $O(n\\sqrt{T})$ \u4e2a $S(n,k)$ \u7684\u6c42\u89e3\u3002\n\n$=\\sum\\limits_{d|k}\\sum\\limits_{i=1}^n\\varphi\\Big(\\dfrac{ik}{d^2}\\Big)[\\gcd(i,k)=d]$\n\n$=\\sum\\limits_{d|k}\\sum\\limits_{i=1}^{n/d}\\varphi\\Big(\\dfrac{ik}{d}\\Big)[i\\perp(k/d)]$\n\n$=\\sum\\limits_{d|k}\\sum\\limits_{i=1}^{n/(k/d)}\\varphi(id)[i\\perp d]$\n\n$=\\sum\\limits_{d|k}\\varphi(d)\\sum\\limits_{i=1}^{n/(k/d)}\\varphi(i)[i\\perp d]$\n\n$=\\sum\\limits_{d|k}\\varphi(d)\\sum\\limits_{i=1}^{n/(k/d)}\\varphi(i)\\sum\\limits_{t|i,t|d}\\mu(t)$\n\n$=\\sum\\limits_{d|k}\\varphi(d)\\sum\\limits_{t|d}\\mu(t)\\sum\\limits_{t|i}^{n/(k/d)}\\varphi(i)$\n\n$=\\sum\\limits_{d|k}\\varphi(d)\\sum\\limits_{t|d}\\mu(t)\\sum\\limits_{i=1}^{n/t(k/d)}\\varphi(it)$\n\n$=\\sum\\limits_{d|k}\\varphi(d)\\sum\\limits_{t|d}\\mu(t)G(\\lfloor nd/tk\\rfloor,t)$\n\n\u5230\u8fd9\u91cc\u53ef\u4ee5\u5c1d\u8bd5 $O\\big((I*d)\\big(k))$ \u679a\u4e3e\u7ea6\u6570\u8ba1\u7b97\u3002\n\n\u5e73\u5747\u590d\u6742\u5ea6\u5927\u6982\u662f $O(\\log^2n)$ \u7684\uff0c\u8fd9\u4e5f\u6b63\u662f\u5927\u4f6c\u7684\u8d5b\u65f6\u505a\u6cd5\uff0c\u73b0\u5728\u4f3c\u4e4e\u5df2\u7ecf\u65e0\u6cd5\u901a\u8fc7\u3002\n",
        "postTime": 1570012036,
        "uid": 58705,
        "name": "command_block",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5572 \u3010[CmdOI2019]\u7b80\u5355\u7684\u6570\u8bba\u9898\u3011"
    },
    {
        "content": "> [P5572 [CmdOI2019] \u7b80\u5355\u7684\u6570\u8bba\u9898](https://www.luogu.com.cn/problem/P5572)\n\n$$\n\\begin{aligned}\n\\mathrm{answer} & = \\sum\\limits_{i = 1} ^ n \\sum\\limits_{j = 1} ^ m \\varphi\\left( \\dfrac {i j} {\\gcd ^ 2(i, j)}\\right) \\\\\n& = \\sum\\limits_{i = 1} ^ n \\sum\\limits_{j = 1} ^ m \\varphi\\left( \\dfrac {i} {\\gcd(i, j)}\\right) \\varphi\\left( \\dfrac {j} {\\gcd(i, j)}\\right) \\\\\n& = \\sum\\limits_{d = 1} ^ m \\sum\\limits_{i = 1} ^ {\\frac n d} \\sum\\limits_{j = 1} ^ {\\frac m d} \\varphi(i) \\varphi(j) [i\\perp j] \\\\\n& = \\sum\\limits_{d = 1} ^ m \\sum\\limits_{d' = 1} ^ {\\frac m d} \\mu(d') \\sum\\limits_{i = 1} ^ {\\frac n {dd'}} \\sum\\limits_{j = 1} ^ {\\frac m {dd'}} \\varphi(id') \\varphi(jd') \\\\\n& = \\sum\\limits_{T = 1} ^ m \\sum\\limits_{d\\mid T} \\mu(d) \\left(\\sum\\limits_{i = 1} ^ {\\frac n T} \\varphi(id) \\right)  \\left(\\sum\\limits_{j = 1} ^ {\\frac m T} \\varphi(jd) \\right) \\\\\n\\end{aligned}\n$$\n\n\u7b2c\u4e8c\u6b65\u8fd0\u7528\u4e86 $\\varphi$ \u7684\u79ef\u6027\u3002\n\n\u6c42\u51fa\u4e0d\u5927\u4e8e\u67d0\u503c\u7684\u6240\u6709 $d$ \u7684\u500d\u6570\u7684 $\\varphi$ \u4e4b\u548c\u7684\u5f62\u5f0f\u51fa\u73b0\u591a\u6b21\uff0c\u6240\u4ee5\u9996\u5148 $n\\ln n$ \u9884\u5904\u7406 $f(d, s)$ \u8868\u793a $\\sum\\limits_{i = 1} ^ s \\varphi(id)$\u3002\n\n\u8ba1\u7b97\u5355\u4e2a $T$ \u7684\u590d\u6742\u5ea6\u4e3a $d(T)$\uff0c\u4e14\u5f53 $T$ \u5927\u7684\u65f6\u5019\uff0c$\\dfrac n T$ \u548c $\\dfrac m T$ \u8f83\u5c0f\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u6839\u53f7\u5206\u6cbb\u3002\n\n\u5bf9\u4e8e $T\\leq \\sqrt n$\uff0c\u76f4\u63a5\u66b4\u529b\u679a\u4e3e $T, d$ \u8ba1\u7b97 $\\sum\\limits_{T = 1} ^ m \\sum\\limits_{d\\mid T} \\mu(d) f(d, \\frac n T) f(d, \\frac m T)$\u3002\u8fd9\u90e8\u5206\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\sqrt n \\log n)$\u3002\n\n\u5bf9\u4e8e $T \\geq \\sqrt n$\uff0c$\\dfrac n T\\leq \\sqrt n$\uff0c\u9884\u5904\u7406 $g(i, j, s)$ \u8868\u793a $\\sum\\limits_{T = 1} ^ s \\sum\\limits_{d\\mid T} f(d, i) f(d, j)$\uff0c\u5219\u4e00\u6bb5\u4f7f\u5f97\u6574\u9664\u503c $\\dfrac n T$ \u548c $\\dfrac m T$ \u76f8\u540c\u7684 $T\\in [l, r]$ \u7684\u8d21\u732e\u53ef\u76f4\u63a5\u8868\u793a\u4e3a $g(\\frac n T, \\frac m T, r) - g(\\frac n T, \\frac m T, l - 1)$\u3002\u6ce8\u610f\u5230 $i \\geq j$ \u4e14 $s$ \u7684\u4e0a\u754c\u4e3a $\\dfrac n i$\uff08\u8981\u4f7f $\\dfrac n T = i$\uff0c\u5219 $T$ \u4e0d\u4f1a\u8d85\u8fc7 $n$ \u7684\u6700\u5927\u503c\u9664\u4ee5 $i$\uff09\uff0c\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a $i$ \u7684 $j, s$ \u60c5\u51b5\u6570\u4e3a $i\\times \\dfrac n i = n$\u3002\u5bf9\u6bcf\u4e2a $i\\leq \\sqrt n$ \u9884\u5904\u7406\u51fa\u6240\u6709 $(i, j, s)$ \u7684\u7b54\u6848\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\sqrt n)$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\sqrt n\\log n)$ \u6216 $\\mathcal{O}(n\\sqrt n \\log\\log n)$\u3002\u5f97\u5230\u6bcf\u6bb5 $[l, r]$ \u53ef\u4ee5\u76f4\u63a5\u6574\u9664\u5206\u5757\u3002\n\n\u7efc\u4e0a\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\sqrt n\\log n)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define TIME 1e3 * clock() / CLOCKS_PER_SEC\nusing ll = long long;\nusing uint = unsigned int;\nusing ld = long double;\n// using lll = __int128;\nusing pii = pair<int, int>;\nusing pll = pair<ll, ll>;\nusing us = unsigned short;\nusing ull = unsigned long long;\ninline ll read() {\n  ll x = 0, sgn = 0;\n  char s = getchar();\n  while(!isdigit(s)) sgn |= s == '-', s = getchar();\n  while(isdigit(s)) x = x * 10 + s - '0', s = getchar();\n  return sgn ? -x : x;\n}\ninline void print(ll x) {\n  if(x < 0) return putchar('-'), print(-x);\n  if(x >= 10) print(x / 10);\n  putchar(x % 10 + '0');\n}\nbool Mbe;\nconstexpr int N = 5e4 + 5;\nconstexpr int mod = 23333;\nint reduce(int v) {return v >= mod ? v - mod : v;}\nvoid add(int &x, int y) {x += y, x >= mod && (x -= mod);}\nbool vis[N];\nint pr[N], cnt, phi[N], mu[N];\nvector<int> f[233][233], sphi[N];\nint T, n[N], m[N];\nbool Med;\nint main() {\n  fprintf(stderr, \"%.3lf MB\\n\", (&Mbe - &Med) / 1048576.0);\n  #ifdef ALEX_WEI\n    FILE* IN = freopen(\"1.in\", \"r\", stdin);\n    FILE* OUT = freopen(\"1.out\", \"w\", stdout);\n  #endif\n  int T = read(), mx = 0;\n  for(int i = 1; i <= T; i++) mx = max(mx, n[i] = read()), m[i] = read();\n  phi[1] = mu[1] = 1;\n  for(int i = 2; i <= mx; i++) {\n    if(!vis[i]) pr[++cnt] = i, phi[i] = i - 1, mu[i] = -1;\n    for(int j = 1; j <= cnt && i * pr[j] <= mx; j++) {\n      vis[i * pr[j]] = 1;\n      if(i % pr[j] == 0) {\n        phi[i * pr[j]] = phi[i] * pr[j];\n        break;\n      }\n      mu[i * pr[j]] = -mu[i];\n      phi[i * pr[j]] = phi[i] * (pr[j] - 1);\n    }\n    phi[i] %= mod;\n  }\n  for(int d = 1; d <= mx; d++) {\n    sphi[d].resize(N / d + 1);\n    for(int j = 1; j * d <= mx; j++) sphi[d][j] = reduce(sphi[d][j - 1] + phi[j * d]);\n  }\n  int K = max(1, (int) sqrt(mx) / 3);\n  for(int i = 1; i <= K; i++)\n    for(int j = 1; j <= i; j++) {\n      int lim = (N - 1) / i;\n      f[i][j].resize(lim + 1);\n      for(int d = 1; d * i <= mx; d++) {\n        if(mu[d] == 0) continue;\n        int v = sphi[d][i] * sphi[d][j] % mod;\n        if(mu[d] == -1) v = mod - v;\n        add(f[i][j][d], v);\n      }\n      for(int p = 1; p <= cnt && pr[p] <= lim; p++)\n        for(int k = 1; k * pr[p] <= lim; k++)\n          add(f[i][j][k * pr[p]], f[i][j][k]);\n      for(int p = 1; p <= lim; p++) add(f[i][j][p], f[i][j][p - 1]);\n    }\n  for(int _ = 1; _ <= T; _++) {\n    int n = ::n[_], m = ::m[_], ans = 0;\n    int l = min(n / K, m) + 1;\n    for(int d = 1; d < l; d++) {\n      if(mu[d] == 0) continue;\n      for(int T = d; T < l; T += d) {\n        int v = sphi[d][n / T] * sphi[d][m / T] % mod;\n        add(ans, mu[d] == -1 ? mod - v : v);\n      }\n    }\n    for(int r; l <= m; l = r + 1) {\n      r = min(n / (n / l), m / (m / l));\n      add(ans, f[n / l][m / l][r]);\n      add(ans, mod - f[n / l][m / l][l - 1]);\n    }\n    cout << ans << \"\\n\";\n  }\n  cerr << TIME << \" ms\\n\";\n  return 0;\n}\n/*\n2022/10/27\nauthor: Alex_Wei\nstart coding at 7:12\nfinish debugging at 9:11\n*/\n```",
        "postTime": 1666838696,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "P5572 [CmdOI2019] \u7b80\u5355\u7684\u6570\u8bba\u9898"
    },
    {
        "content": "# \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a $n,m$\uff0c\u6c42\uff1a\n\n$$\\sum_{i=1}^n\\sum_{j=1}^m\\varphi\\left(\\dfrac{\\operatorname{lcm}(i,j)}{\\gcd(i,j)}\\right)\\bmod 23333$$\n\n$30000$ \u7ec4\u6570\u636e\uff0c$1\\le m\\le n\\le 50000$\u3002\n\n# \u89e3\u6cd5\n\n\u5148\u63a8\u5f0f\u5b50\uff1a\uff08\u4ee5\u4e0b\u201c$/$\u201d\u9ed8\u8ba4\u5411\u4e0b\u53d6\u6574\uff09\n\n$$\\begin{aligned}\n&\\sum_{i=1}^n\\sum_{j=1}^m\\varphi\\left(\\dfrac{\\operatorname{lcm}(i,j)}{\\gcd(i,j)}\\right)\\\\\n=&\\sum_{i=1}^n\\sum_{j=1}^m\\varphi\\left(\\dfrac{ij}{\\gcd(i,j)^2}\\right)\n&\\text{\uff08\u62c6 lcm\uff09}\\\\\n=&\\sum_{i=1}^n\\sum_{j=1}^m\\varphi\\left(\\dfrac{i}{\\gcd(i,j)}\\dfrac{j}{\\gcd(i,j)}\\right)\n&\\text{\uff08\u6b64\u65f6}\\dfrac{i}{\\gcd(i,j)}\\text{\u548c}\\dfrac{j}{\\gcd(i,j)}\\text{\u4e92\u8d28\uff09}\\\\\n=&\\sum_{i=1}^n\\sum_{j=1}^m\\varphi\\left(\\dfrac{i}{\\gcd(i,j)}\\right)\\varphi\\left(\\dfrac{j}{\\gcd(i,j)}\\right)\n&\\text{\uff08}\\varphi\\text{\u662f\u79ef\u6027\u51fd\u6570\uff09}\\\\\n=&\\sum_{g=1}^m\\sum_{i=1}^n\\sum_{j=1}^m[\\gcd(i,j)=g]\\varphi\\left(\\dfrac{i}{g}\\right)\\varphi\\left(\\dfrac{j}{g}\\right)\n&\\text{\uff08\u679a\u4e3e}\\gcd\\text{\uff09}\\\\\n=&\\sum_{g=1}^m\\sum_{i=1}^{n/g}\\sum_{j=1}^{m/g}[\\gcd(i,j)=1]\\varphi(i)\\varphi(j)\n&\\text{\uff08\u7528}i\\text{\u4ee3\u6362}\\dfrac{i}{g}\\text{\uff09}\\\\\n=&\\sum_{g=1}^m\\sum_{i=1}^{n/g}\\sum_{j=1}^{m/g}\\varphi(i)\\varphi(j)\\sum_{k=1}^m[k|\\gcd(i,j)]\\mu(k)\n&\\text{\uff08}\\mu\\text{\u7684\u57fa\u672c\u6027\u8d28\uff09}\\\\\n=&\\sum_{g=1}^m\\sum_{k=1}^m\\mu(k)\\sum_{i=1}^{n/g}\\sum_{j=1}^{m/g}[k|i][k|j]\\varphi(i)\\varphi(j)\n&\\text{\uff08\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\uff09}\\\\\n=&\\sum_{g=1}^m\\sum_{k=1}^m\\mu(k)\\sum_{i=1}^{n/gk}\\sum_{j=1}^{m/gk}\\varphi(ki)\\varphi(kj)\n&\\text{\uff08\u7528}ki\\text{\u4ee3\u6362}i\\text{\uff09}\\\\\n=&\\sum_{g=1}^m\\sum_{k=1}^m\\mu(k)\\left(\\sum_{i=1}^{n/gk}\\varphi(ki)\\right)\\left(\\sum_{j=1}^{m/gk}\\varphi(kj)\\right)\n&\\text{\uff08\u628a}i\\text{\u548c}j\\text{\u5206\u5f00\uff09}\\\\\n=&\\sum_{T=1}^m\\sum_{k|T}\\mu(k)\\left(\\sum_{i=1}^{n/T}\\varphi(ki)\\right)\\left(\\sum_{j=1}^{m/T}\\varphi(kj)\\right)\n&\\text{\uff08\u6362\u5143}T=kg\\text{\uff09}\\\\\n\\end{aligned}$$\n\n\u89c2\u5bdf\u548c\u5f0f\u4e2d\u6700\u540e\u4e24\u4e2a\u56e0\u5b50\uff0c\u5b83\u4eec\u90fd\u6709 $\\sum_{i=1}^{b}\\varphi(ai)$ \u7684\u5f62\u5f0f\uff0c\u5176\u4e2d $a$ \u548c $b$ \u4e00\u5b9a\u3002\n\n\u8bbe $G(a,b)=\\sum_{i=1}^{b}\\varphi(ai)$\uff0c\u5219\u7b54\u6848 $=\\sum_{T=1}^m\\sum_{k|T}\\mu(k)\\times G(n/T,k)\\times G(m/T,k)$\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u5728\u4efb\u4f55\u8981\u8c03\u7528 $G(a,b)$ \u7684\u60c5\u51b5\u4e0b\uff0c$a\\times b$ \u90fd\u4e0d\u8d85\u8fc7 $n$\uff0c\u6545 $a$ \u548c $b$ \u53ea\u6709 $O(n\\log n)$ \u79cd\u53d6\u503c\uff0c\u53ef\u4ee5\u9884\u5904\u7406\u5230\u4e00\u4e2a\u8868\u91cc\u3002\n\n\u5269\u4e0b\u7684\u5f0f\u5b50\u5148\u8003\u8651\u6574\u9664\u5206\u5757\uff1a\n$$\\begin{aligned}\n&\\sum_{T=1}^m\\sum_{k|T}\\mu(k) G(n/T,k) G(m/T,k)\\\\\n=&\\sum_{l,r}\\sum_{T=l}^r\\sum_{k|T}\\mu(k) G(n/l,k) G(m/l,k)\\\\\n=&\\sum_{l,r}\\left(\\sum_{T=1}^r\\sum_{k|T}\\mu(k) G(n/l,k) G(m/l,k)\\right)\\\\&-\\left(\\sum_{T=1}^{l-1}\\sum_{k|T}\\mu(k) G(n/l,k)G(m/l,k)\\right)\n\\end{aligned}$$\n\n\u89c2\u5bdf\u548c\u5f0f\u4e2d\u6700\u540e\u4e24\u9879\uff0c\u5b83\u4eec\u90fd\u6709 $\\sum_{T=1}^{c}\\sum_{k|T}\\mu(k) G(a,k)G(b,k)$ \u7684\u5f62\u5f0f\uff0c\u5176\u4e2d $a,b$ \u548c $c$ \u4e00\u5b9a\u3002\n\n\u8bbe $T(a,b,c)=\\sum_{T=1}^{c}\\sum_{k|T}\\mu(k) G(a,k)G(b,k)$\uff0c\u5219\u7b54\u6848 $=\\sum_{l,r}T(n/l,m/l,r)-T(n/l,m/l,l-1)$\u3002\u518d\u4e00\u6b21\u5730\uff0c\u4e0d\u96be\u53d1\u73b0 $ac\\le n,bc\\le m$\u3002\n\n\u4ecd\u8003\u8651\u9884\u5904\u7406 $T$ \u6570\u7ec4\uff0c\u4f46\u662f\u5982\u679c\u5168\u90e8\u9884\u5904\u7406\uff0c\u65f6\u95f4\u548c\u7a7a\u95f4\u90fd\u53d7\u4e0d\u4e86\uff0c\u8003\u8651\u9884\u5904\u7406\u4e00\u90e8\u5206\uff0c\u5269\u4e0b\u7684\u90e8\u5206\u66b4\u529b\u7b97\u3002\n\n\u6211\u4eec\u8bbe\u4e00\u4e2a\u5e38\u6570 $B$\uff0c\u7136\u540e\u9884\u5904\u7406\u6240\u6709\u6ee1\u8db3 $a\\le B,b\\le B$ \u7684 $T(a,b,c)$ \u503c\u3002\u590d\u6742\u5ea6 $O(n\\times B^2)$\u3002\n\n\u5728\u67e5\u8be2 $T(n/l,m/l,r)$\uff08\u6216 $T(n/l,m/l,l-1)$\uff09\u7684\u503c\u65f6\uff0c\u5982\u679c $n/l$ \u548c $m/l$ \u5747\u4e0d\u5927\u4e8e $B$\uff0c\u76f4\u63a5\u67e5\u8868\uff1b\n\n\u82e5 $n/l>B$\uff0c\u5219 $l,r$ \u4e00\u5b9a\u8f83\u5c0f\uff08\u6307 $l,r<n/B$\uff09\uff0c\u6b64\u65f6\u66b4\u529b\u8ba1\u7b97\u590d\u6742\u5ea6\u8f83\u4f4e\u3002\u67e5\u8be2\u9636\u6bb5\u590d\u6742\u5ea6 $O\\left(\\dfrac{Tn\\log n}{B}\\right)$\u3002\n\n\u901a\u8fc7\u8c03\u6574 $B$ \u7684\u503c\uff0c\u53ef\u4ee5\u5e73\u8861\u9884\u5904\u7406\u590d\u6742\u5ea6\u548c\u67e5\u8be2\u590d\u6742\u5ea6\u3002\u672c\u83dc\u9e21\u8bbe $B=50$\u3002\n# \u4ee3\u7801\n\u672c\u9898\u65e0\u9700\u5f00 `long long`\uff0c\u56e0\u4e3a\u6a21\u6570\u4ec5\u6709 $23333$\u3002\n\n\u9884\u5904\u7406\u6570\u7ec4 `G`\u3001`T` \u4ee5\u53ca\u7528\u6765\u8bb0\u5f55\u6bcf\u4e2a\u6570\u7684\u6240\u6709\u56e0\u5b50\u7684 `div`\u3002\u6b64\u5904\u7528 `vector` \u5b9e\u73b0\u3002\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<vector>\n#define M 23333\n#define N 50000\n#define B 50\nusing namespace std;\nint T,n,m,pn,p[N+1],mu[N+1],phi[N+1],t[B+1][B+1][N+1];\nbool ip[N+1];\nvector<int> g[N+1],dv[N+1];\nvoid init()\n{\n\tmemset(ip,1,sizeof(ip));\n\tip[1]=0,mu[1]=1,phi[1]=1;\n\tfor(int i=2;i<=N;i++)\n\t{\n\t\tif(ip[i]) p[++pn]=i,mu[i]=-1,phi[i]=i-1;\n\t\tfor(int j=1;j<=pn;j++)\n\t\t{\n\t\t\tint now=i*p[j];\n\t\t\tif(now>N) break;\n\t\t\tip[now]=0;\n\t\t\tphi[now]=phi[i]*(p[j]-1);\n\t\t\tmu[now]=-mu[i];\n\t\t\tif(i%p[j]==0)\n\t\t\t{\n\t\t\t\tphi[now]=phi[i]*p[j];\n\t\t\t\tmu[now]=0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=N;i++)\n\t\tdv[i].clear(),\n\t\tdv[i].push_back(0);\n\tfor(int i=1;i<=N;i++)\n\t{\n\t\tg[i].clear();\n\t\tg[i].push_back(0);\n\t\tfor(int j=1;j<=N/i;j++)\n\t\t\tg[i].push_back((g[i][j-1]+phi[i*j])%M),\n\t\t\tdv[i*j].push_back(i);\n\t}\n\tfor(int i=1;i<=B;i++)\n\t\tfor(int j=1;j<=B;j++)\n\t\t\tfor(int k=1;k<=N/max(i,j);k++)\n\t\t\t{\n\t\t\t\tt[i][j][k]=t[i][j][k-1];\n\t\t\t\tint h;\n\t\t\t\tfor(int l=1;l<dv[k].size();l++)\n\t\t\t\t\th=dv[k][l],\n\t\t\t\t\tt[i][j][k]=(t[i][j][k]+mu[h]*g[h][i]*g[h][j]%M+M)%M;\n\t\t\t}\n}\nsigned main()\n{\n\tinit();\n\tcin>>T;\n\twhile(T--)\n\t{\n\t\tscanf(\"%d%d\",&n,&m);\n\t\tint ans=0;\n\t\tfor(int l=1,r;l<=min(n,m);l=r+1)\n\t\t{\n\t\t\tr=min(n/(n/l),m/(m/l));\n\t\t\tif(n/l>B||m/l>B)\n\t\t\t{\n\t\t\t\tint h;\n\t\t\t\tfor(int i=l;i<=r;i++)\n\t\t\t\t\tfor(int j=1;j<dv[i].size();j++)\n\t\t\t\t\t\th=dv[i][j],\n\t\t\t\t\t\tans=(ans+mu[h]*g[h][n/l]*g[h][m/l]%M+M)%M;\n\t\t\t}\n\t\t\telse ans=(ans+t[n/l][m/l][r]-t[n/l][m/l][l-1]+M)%M;\n\t\t}\n\t\tprintf(\"%d\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1659952990,
        "uid": 340940,
        "name": "IAKIOI2357",
        "ccfLevel": 0,
        "title": "P5572 [CmdOI2019]\u7b80\u5355\u7684\u6570\u8bba\u9898 \u9898\u89e3"
    },
    {
        "content": "### [P5572 [CmdOI2019]\u7b80\u5355\u7684\u6570\u8bba\u9898](https://www.luogu.com.cn/problem/P5572)\n\n\u6c42\uff1a\n$$\n\\sum_{i=1}^{n}\\sum_{j=1}^{m}\\varphi(\\frac{\\operatorname{lcm}(i,j)}{\\gcd(i,j)})\\bmod 23333\n$$\n$T$ \u7ec4\u6570\u636e\uff0c\u6ee1\u8db3 $T \\leq 3 \\times 10^4,m \\leq n \\leq 5 \\times 10^4$\u3002\n\n\u4e0b\u9762\u9ed8\u8ba4 $n \\leq m$\u3002\n\n\u5148\u5316\u7b80\u539f\u5f0f\uff0c\u6709\uff1a\n$$\n\\begin{aligned}\n\\sum_{i=1}^{n}\\sum_{j=1}^{m}\\varphi(\\frac{\\operatorname{lcm}(i,j)}{\\gcd(i,j)})&=\\sum_{i=1}^{n}\\sum_{j=1}^{m}\\varphi(\\frac{i \\times j}{\\gcd(i,j)^2})\\\\\n&=\\sum_{d=1}^{n}\\sum_{i=1}^{n}\\sum_{j=1}^{m}\\varphi(\\frac{i \\times j}{d^2})[\\gcd(i,j)=d]\\\\\n&=\\sum_{d=1}^{n}\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}\\varphi(i\\times j)[\\gcd(i,j)=1]\\\\\n&=\\sum_{d=1}^{n}\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}\\varphi(i)\\varphi(j)[\\gcd(i,j)=1]\\\\\n&=\\sum_{d=1}^{n}\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}\\varphi(i)\\varphi(j)\\sum_{p|\\gcd(i,j)}\\mu(p)\\\\\n&=\\sum_{d=1}^{n}\\sum_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(p) \\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}\\varphi(i)\\varphi(j)[p|i][p|j]\\\\\n&=\\sum_{d=1}^{n}\\sum_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(p) \\sum_{i=1}^{\\lfloor\\frac{n}{pd}\\rfloor}\\varphi(ip)\\sum_{j=1}^{\\lfloor\\frac{m}{pd}\\rfloor}\\varphi(jp)\\\\\n&=\\sum_{T=1}^{n}\\sum_{p|T}\\mu(p)\\sum_{i=1}^{\\lfloor\\frac{n}{T}\\rfloor}\\varphi(ip)\\sum_{j=1}^{\\lfloor\\frac{m}{T}\\rfloor}\\varphi(jp)\n\\end{aligned}\n$$\n\u8bbe\uff1a\n$$\nG(x,y)=\\sum_{i=1}^{x}\\varphi(iy)\n$$\n\u66b4\u529b\u9884\u5904\u7406\u5373\u53ef\u3002\n\n\u90a3\u4e48\u539f\u5f0f\u7b49\u4e8e\uff1a\n$$\n\\sum_{T=1}^{n}\\sum_{p|T}\\mu(p)G(\\lfloor\\frac{n}{T}\\rfloor,p)G(\\lfloor\\frac{m}{T}\\rfloor,p)\n$$\n\u518d\u8bbe\uff1a\n$$\nH(x,y,z)=\\sum_{i=1}^{z}\\sum_{p|i}\\mu(p)G(x,p)g(y,p)\n$$\n\u7136\u540e\u8ddf [P4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c](https://www.luogu.com.cn/problem/P4240) \u5dee\u4e0d\u591a\uff0c\u5c06\u7b54\u6848\u8868\u793a\u4e3a\u5173\u4e8e $H$ \u7684\u5dee\u5206\u52a0\u4e0b\u53d6\u6574\u7684\u5f62\u5f0f\u3002\n\n\u518d\u8003\u8651\u6839\u53f7\u5206\u6cbb\uff0c\u6211\u4eec\u8bbe\u4e00\u4e2a\u9608\u503c\uff0c\u5c06\u6240\u6709\u8303\u56f4\u5185\u7684 $H$ \u503c\u9012\u63a8\u9884\u5904\u7406\u51fa\u6765\u3002\n\n\u540e\u9762\u7684\u518d\u6570\u8bba\u5206\u5757\u7b97\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\n#define int long long\n\ninline int read()\n{\n\tint x = 0, f = 1;\n\tchar c = getchar();\n\twhile(c < '0' || c > '9')\n\t{\n\t\tif(c == '-') f = -1;\n\t\tc = getchar();\n\t}\n\twhile(c >= '0' && c <= '9')\n\t{\n\t\tx = x * 10 + c - '0';\n\t\tc = getchar();\n\t}\n\treturn x * f;\n}\n\ninline void write(int x)\n{\n\tif(x < 0)\n\t{\n\t\tputchar('-');\n\t\tx = -x;\n\t}\n\tif(x > 9)\n\t\twrite(x / 10);\n\tputchar(x % 10 + '0');\n}\n\nconst int p = 23333;\n\nconst int _ = 5e4 + 7;\n\nint T, n, m;\n\nbool vis[_];\n\nint cnt, pr[_], phi[_], mu[_];\n\nconst int B = 72;\n\nvector<int> G[_], H[B + 10][B + 10], fac[_];\n\nint calc(int x, int y, int z)\n{\n    int ans = 0;\n    for (int o : fac[z])\n        ans = (ans + mu[o] * G[o][x] % p * G[o][y]) % p + p;\n    return ans % p;\n}\n\nvoid init()\n{\n\tfor (int i = 1; i <= _ - 7; i++)\n    \tfor (int j = i; j <= _ - 7; j += i)\n        \tfac[j].push_back(i);\n\tphi[1] = mu[1] = 1;\n\tfor(int i = 2; i <= _ - 7; ++i)\n\t{\n\t\tif(!vis[i])\n\t\t{\n\t\t\tpr[++cnt] = i;\n\t\t\tphi[i] = i - 1;\n\t\t\tmu[i] = -1;\n\t\t}\n\t\tfor(int j = 1; j <= cnt && i * pr[j] <= _ - 7; ++j)\n\t\t{\n\t\t\tint p = i * pr[j];\n\t\t\tvis[p] = 1;\n\t\t\tif(i % pr[j] == 0)\n\t\t\t{\n\t\t\t\tphi[p] = phi[i] * pr[j];\n\t\t\t\tmu[p] = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[p] = phi[i] * (pr[j] - 1);\n\t\t\tmu[p] = -mu[i];\n\t\t}\n\t}\n\tfor (int i = 1; G[i].push_back(0), i <= _ - 7; ++i)\n\t\tfor (int j = 1; j * i <= _ - 7; ++j)\n\t\t\tG[i].push_back((G[i][j - 1] + phi[i * j]) % p);\n\tfor (int i = 1; i <= B; ++i)\n\t\tfor (int j = 1; j <= B; ++j)\n\t\t{\n\t\t\tH[i][j].push_back(0);\n\t\t\tfor (int k = 1; k <= (_ - 7) / max(i, j); ++k)\n\t\t\t\tH[i][j].push_back((H[i][j][k - 1] + calc(i, j, k)) % p);\n\t\t}\n}\n\nsigned main()\n{\n\tinit();\n\tT = read();\n\twhile(T--)\n\t{\n\t\tn = read(), m = read();\n\t\tif(n > m) swap(n, m);\n\t\tint ans = 0;\n\t\tfor(int i = 1; i <= m / B; ++i)\n\t\t\tans = (ans + calc(n / i, m / i, i)) % p;\n\t\tfor(int l = m / B + 1, r; l <= n; l = r + 1)\n\t\t{\n\t\t\tr = min(n / (n / l), m / (m / l));\n\t\t\tans = (ans + H[n / l][m / l][r] - H[n / l][m / l][l - 1] + p) % p;\n\t\t}\n\t\twrite(ans % p);\n\t\tputchar('\\n');\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1642165724,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "P5572 [CmdOI2019]\u7b80\u5355\u7684\u6570\u8bba\u9898"
    },
    {
        "content": "\u770b\u8fd9\u9898\u6570\u636e\u8303\u56f4\u8fd8\u4ee5\u4e3a\u6b63\u89e3\u5c31\u662f $\\mathcal O(T n^{\\frac{3}{4}})$ \u7684\uff0c\u7136\u540e\u6211\u751f\u751f\u5361\u5e38\u5361\u8fc7\u53bb\u4e86\uff08\n\n## \u601d\u8def\n\n\u4e0b\u6587\u8bbe $w=5 \\cdot 10^4$\u3002\n\n\u9898\u76ee\u8981\u6c42\uff1a\n\n$$\\sum_{i=1}^n \\sum_{j=1}^m \\varphi\\left(\\dfrac{\\text{lcm}(i,j)}{\\gcd(i,j)}\\right)$$\n\n$$=\\sum_{i=1}^n \\sum_{j=1}^m \\varphi \\left( \\dfrac{i}{\\gcd(i,j)} \\cdot \\dfrac{j}{\\gcd(i,j)}\\right)$$\n\n\u6ce8\u610f\u5230 $\\gcd\\left(\\dfrac{i}{\\gcd(i,j)},\\dfrac{j}{\\gcd(i,j)}\\right)=1$\uff0c\u4e14 $\\varphi$ \u662f\u79ef\u6027\u51fd\u6570\uff0c\u6240\u4ee5\u539f\u5f0f\n\n$$=\\sum_{i=1}^n \\sum_{j=1}^m \\varphi \\left( \\dfrac{i}{\\gcd(i,j)}\\right) \\cdot \\varphi \\left(\\dfrac{j}{\\gcd(i,j)}\\right)$$\n\n$$=\\sum_{d=1}^{m}\\sum_{i=1}^{\\lfloor \\frac{n}{d}\\rfloor} \\sum_{j=1}^{\\lfloor \\frac{m}{d}\\rfloor}[\\gcd(i,j)=1] \\varphi(i)\\varphi(j)$$\n\n\u8bbe\n\n$$f(n,m)=\\sum_{i=1}^n\\sum_{j=1}^m [\\gcd(i,j)=1] \\varphi(i)\\varphi(j)$$\n\n\u5219\u539f\u5f0f\n\n$$=\\sum_{d=1}^m f\\left(\\left\\lfloor \\dfrac{n}{d}\\right\\rfloor,\\left\\lfloor \\dfrac{m}{d}\\right\\rfloor\\right)$$\n\n\u73b0\u5728\u8003\u8651\u6c42 $f(n,m)$\uff1a\n\n$$f(n,m)=\\sum_{i=1}^n\\sum_{j=1}^m [\\gcd(i,j)=1]\\varphi(i)\\varphi(j)$$\n\n$$=\\sum_{i=1}^n \\sum_{j=1}^m \\sum_{d|\\gcd(i,j)} \\mu(d) \\varphi(i) \\varphi(j)$$\n\n$$=\\sum_{d=1}^m\\mu(d)\\sum_{i=1}^{\\lfloor \\frac{n}{d}\\rfloor} \\sum_{j=1}^{\\lfloor \\frac{m}{d}\\rfloor} \\varphi(id)\\varphi(jd)$$\n\n$$=\\sum_{d=1}^m\\mu(d)\\left(\\sum_{i=1}^{\\lfloor \\frac{n}{d}\\rfloor} \\varphi(id) \\right)\\left(\\sum_{j=1}^{\\lfloor \\frac{m}{d}\\rfloor} \\varphi(jd)\\right)$$\n\n\u8bbe\n\n$$g(n,d)=\\sum_{i=1}^n \\varphi(id)$$\n\n\u5219\n\n$$f(n,m)=\\sum_{d=1}^m \\mu(d) g\\left(\\left\\lfloor \\dfrac{n}{d}\\right\\rfloor\\right)g\\left(\\left\\lfloor \\dfrac{m}{d}\\right\\rfloor\\right)$$\n\n\u56e0\u4e3a $nd \\le w$\uff0c\u6240\u4ee5 $g$ \u53ef\u4ee5\u66b4\u529b\u9884\u5904\u7406\uff08$g(n,d)=g(n-1,d)+\\varphi(nd)$\uff09\u3002\n\n\u8003\u8651\u5bf9 $d$ \u6839\u53f7\u5206\u6cbb\u3002\u5f53 $d \\le B$ \u65f6\uff0c\u53ef\u4ee5 $\\mathcal O(B)$ \u66b4\u529b\u6c42\uff1b\u5f53 $d>B$ \u65f6\uff0c$\\left\\lfloor \\dfrac{m}{d}\\right\\rfloor \\le \\left\\lfloor \\dfrac{n}{d}\\right\\rfloor \\le \\dfrac{n}{B}$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u9884\u5904\u7406\u4e86\u3002\u9884\u5904\u7406\n\n$$h(n,m,k)=\\sum_{d=1}^k \\mu(d)g(n)g(m)$$\n\n\u5bf9\u4e8e $\\left\\lfloor \\dfrac{n}{d}\\right\\rfloor$ \u548c $\\left\\lfloor \\dfrac{m}{d}\\right\\rfloor$ \u90fd\u4e00\u5b9a\u65f6\uff0c\u6c42\u51fa\u6765 $d$ \u7684\u533a\u95f4\u5e76\u7528 $h$ \u51fd\u6570\u51cf\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u4f46\u662f $h$ \u51fd\u6570\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6765\u5417\uff1f\u56e0\u4e3a $nk \\le w$\uff0c\u6240\u4ee5 $h$ \u51fd\u6570\u4e00\u5171\u53ea\u6709 $h$ \u51fd\u6570\u4e00\u5171\u6709 $\\mathcal O\\left(\\sum\\limits_{i=1}^{\\frac{n}{B}} \\sum\\limits_{j=1}^{i} \\left \\lfloor \\dfrac{w}{i}\\right\\rfloor\\right)=O(\\dfrac{n}{B} w)$ \u79cd $n,m,k$\u3002\n\n\u53d6 $B=\\sqrt{n}$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5 $\\mathcal O(\\sqrt{n})$ \u6c42\u51fa\u6765 $f$ \u51fd\u6570\u4e86\u3002\u5916\u9762\u8fd8\u6709\u4e00\u4e2a\u6574\u9664\u5206\u5757\uff0c\u56e0\u4e3a\u6574\u9664\u5206\u5757\u5957\u6574\u9664\u5206\u5757\u7684\u590d\u6742\u5ea6\u4e3a $\\mathcal O(n^{\\frac{3}{4}})$\uff0c\u6240\u4ee5\u8be2\u95ee\u7684\u590d\u6742\u5ea6\u4e3a $\\mathcal O(Tn^{\\frac{3}{4}})$\u3002\u56e0\u4e3a $n$ \u6700\u5927\u4e3a $w$\uff0c\u6240\u4ee5\u9884\u5904\u7406\u7684\u590d\u6742\u5ea6\u4e3a $\\mathcal O(w \\sqrt{w})$\u3002\n\n\u6211\u4ee5\u4e3a\u8fd9\u4e2a\u6570\u636e\u8303\u56f4\u5c31\u662f\u8fd9\u4e48\u505a\u7684\uff0c\u5c31\u6ca1\u6709\u60f3\u4f18\u5316\u4e86\uff0c\u7ed3\u679c\u4ea4\u4e0a\u53bb T \u98de\u4e86\u3002\u4f46\u662f\u6211\u751f\u751f\u5730\u5c06\u8fd9\u4e2a\u9519\u89e3\u5361\u8fc7\u53bb\u4e86\u3002\u4ee5\u4e0b\u662f\u8fd9\u4e2a\u505a\u6cd5\u7684\u5361\u5e38\u65b9\u6cd5\uff1a\n\n* \u5c11\u7528 ```long long```\u3002\n\n* \u6ce8\u610f\u5230 $n\\ge m$\uff0c\u6240\u4ee5\u9884\u5904\u7406 $h$ \u7684\u65f6\u5019\u53ea\u9700\u8981\u9884\u5904\u7406 $i \\ge j$ \u7684\u3002\n\n* \u9884\u5904\u7406 $\\text{inv}_i =\\dfrac{1}{i}$\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $\\dfrac{a}{b}$ \u53d8\u6210 $a \\cdot \\text{inv}_b$\u3002\n\n* \u6c42 $f$ \u51fd\u6570\u65f6 $B$ \u8981\u52a8\u6001\u53d6\uff0c\u5426\u5219\u590d\u6742\u5ea6\u4f1a\u9000\u5316\u3002\n\n* \u5f53 $d\\le B$ \u65f6\u4e0d\u7528\u6574\u9664\u5206\u5757\uff0c\u800c\u662f\u76f4\u63a5\u5faa\u73af\u8fc7\u53bb\u3002\n\n* \u56e0\u4e3a\u6574\u9664\u5206\u5757\u5e38\u6570\u5927\uff0c\u56e0\u6b64\u5c06 $B$ \u8c03\u5927\uff0c\u6211\u8bbe\u7684 $B=\\sqrt{12n}$\u3002\n\n## \u4ee3\u7801\n\n\u8fd9\u91cc\u6709\u4e24\u4efd\u4ee3\u7801\uff0c\u4e00\u4efd\u662f\u6beb\u65e0\u5361\u5e38\u7684\uff08\u65b9\u4fbf\u7406\u89e3\uff09\uff0c\u53e6\u4e00\u4efd\u662f\u53ef\u4ee5\u901a\u8fc7\u7684\u3002\n\n\u4ee3\u7801\u4e2d\u7684 ```ycl``` \u662f $h$ \u51fd\u6570\u3002\n\n\u6beb\u65e0\u5361\u5e38\u7684\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nbitset<50010> vis;\nint tot=0,pr[50010];\nint phi[50010],miu[50010];\nvector<int> g[50010];\nvector<int> ycl[231][231];\nvoid init()\n{\n\tphi[1]=miu[1]=1;\n\tfor(int i=2; i<=5e4; ++i)\n\t{\n\t\tif(!vis[i]) pr[++tot]=i,phi[i]=i-1,miu[i]=-1;\n\t\tfor(int j=1; j<=tot && i*pr[j]<=5e4; ++j)\n\t\t{\n\t\t\tvis[i*pr[j]]=1;\n\t\t\tif(i%pr[j]==0)\n\t\t\t{\n\t\t\t\tphi[i*pr[j]]=phi[i]*pr[j];\n\t\t\t\tmiu[i*pr[j]]=0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i*pr[j]]=phi[i]*(pr[j]-1);\n\t\t\tmiu[i*pr[j]]=-miu[i];\n\t\t}\n\t}\n\tfor(int i=1; i<=5e4; ++i)\n\t{\n\t\tg[i].resize(5e4/i+1);\n\t\tfor(int j=1; j<=5e4/i; ++j) g[i][j]=(i==1?0:g[i-1][j])+phi[i*j];\n\t}\n\tfor(int i=1; i<=230; ++i)\n\t{\n\t\tfor(int j=1; j<=i; ++j)\n\t\t{\n\t\t\tint d=min(5e4/i,5e4/j);\n\t\t\tycl[i][j].resize(d+1);\n\t\t\tfor(int k=1; k<=d; ++k) ycl[i][j][k]=ycl[i][j][k-1]+1ll*miu[k]*g[i][k]*g[j][k];\n\t\t}\n\t}\n}\nint n,m;\nint f(int n,int m)\n{\n\tint B=sqrt(n);\n\tint ans=0;\n\tfor(int l=1,r; l<=min(n,m); l=r+1)\n\t{\n\t\tint tmp1=n/l,tmp2=m/l;\n\t\tr=min(n/tmp1,m/tmp2);\n\t\tif(r<=B) for(int j=l; j<=r; ++j) ans+=1ll*miu[j]*g[tmp1][j]*g[tmp2][j];\n\t\telse ans+=ycl[tmp1][tmp2][r]-ycl[tmp1][tmp2][l-1];\n\t}\n\treturn ans;\n}\nsigned main()\n{\n\tinit();\n\tint t; cin>>t; while(t--)\n\t{\n\t\tcin>>n>>m;\n\t\tint ans=0;\n\t\tfor(int l=1,r; l<=min(n,m); l=r+1)\n\t\t{\n\t\t\tr=min(n/(n/l),m/(m/l));\n\t\t\tans+=(r-l+1)*f(n/l,m/l);\n\t\t}\n\t\tcout<<ans%23333<<'\\n';\n\t}\n\treturn 0;\n}\n```\n\n\u53ef\u4ee5\u901a\u8fc7\u7684\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nbitset<50010> vis;\nint tot=0,pr[50010];\nint phi[50010],miu[50010];\nvector<int> g[50010];\nvector<long long> ycl[101][101];\ndouble inv[50010];\nvoid init()\n{\n\tphi[1]=miu[1]=1;\n\tfor(int i=2; i<=5e4; ++i)\n\t{\n\t\tif(!vis[i]) pr[++tot]=i,phi[i]=i-1,miu[i]=-1;\n\t\tfor(int j=1; j<=tot && i*pr[j]<=5e4; ++j)\n\t\t{\n\t\t\tvis[i*pr[j]]=1;\n\t\t\tif(i%pr[j]==0)\n\t\t\t{\n\t\t\t\tphi[i*pr[j]]=phi[i]*pr[j];\n\t\t\t\tmiu[i*pr[j]]=0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i*pr[j]]=phi[i]*(pr[j]-1);\n\t\t\tmiu[i*pr[j]]=-miu[i];\n\t\t}\n\t}\n\tfor(int i=1; i<=5e4; ++i)\n\t{\n\t\tg[i].resize(5e4/i+1);\n\t\tfor(int j=1; j<=5e4/i; ++j) g[i][j]=(i==1?0:g[i-1][j])+phi[i*j];\n\t}\n\tfor(int i=1; i<=100; ++i)\n\t{\n\t\tfor(int j=1; j<=i; ++j)\n\t\t{\n\t\t\tint d=min(5e4/i,5e4/j);\n\t\t\tycl[i][j].resize(d+1);\n\t\t\tfor(int k=1; k<=d; ++k) ycl[i][j][k]=ycl[i][j][k-1]+1ll*miu[k]*g[i][k]*g[j][k];\n\t\t}\n\t}\n\tfor(int i=1; i<=5e4; ++i) inv[i]=1.0/i;\n}\nint n,m;\nlong long f(int n,int m)\n{\n\tint B=sqrt(n*12);\n\tlong long ans=0;\n\tfor(int i=1; i<=min(B,m); ++i) ans+=1ll*miu[i]*g[(int)(n*inv[i]+1e-10)][i]*g[(int)(m*inv[i]+1e-10)][i];\n\tfor(int l=B+1,r; l<=m; l=r+1)\n\t{\n\t\tint tmp1=n*inv[l]+1e-10,tmp2=m*inv[l]+1e-10;\n\t\tr=min(n*inv[tmp1]+1e-10,m*inv[tmp2]+1e-10);\n\t\tans+=ycl[tmp1][tmp2][r]-ycl[tmp1][tmp2][l-1];\n\t}\n\treturn ans;\n}\nint main()\n{\n\tinit();\n\tint t; cin>>t; for(int i=1; i<=t; ++i)\n\t{\n\t\tcin>>n>>m;\n\t\tlong long ans=0;\n\t\tfor(int l=1,r; l<=m; l=r+1)\n\t\t{\n\t\t\tint tmp1=n*inv[l]+1e-10,tmp2=m*inv[l]+1e-10;\n\t\t\tr=min(n*inv[tmp1]+1e-10,m*inv[tmp2]+1e-10);\n\t\t\tans+=(r-l+1)*f(tmp1,tmp2);\n\t\t}\n\t\tcout<<ans%23333<<'\\n';\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1676964703,
        "uid": 353688,
        "name": "\u738b\u7199\u6587",
        "ccfLevel": 0,
        "title": "P5572 \u9898\u89e3"
    },
    {
        "content": "\u4ee5\u4e0b\u8bbe $n\\le m$\u3002\n\n\u6211\u4eec\u6709\n\n$$\n\\begin{aligned}\n  &\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(\\frac{\\operatorname{lcm}(i,j)}{\\gcd(i,j)})\\\\\n  =&\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(\\frac{ij}{\\gcd(i,j)^2})\\\\\n  =&\\sum_{d=1}^n\\sum_{i=1}^n\\sum_{j=1}^m\\varphi(\\frac{ij}{d^2})[\\gcd(i,j)=d]\\\\\n  =&\\sum_{d=1}^n\\sum_{i=1}^{\\lfloor n/d\\rfloor}\\sum_{j=1}^{\\lfloor m/d\\rfloor}\\varphi(ij)[\\gcd(i,j)=1]\\\\\n\\end{aligned}\n$$\n\n\u7531 $\\gcd(i,j)=1$\uff0c\u6211\u4eec\u6709 $\\varphi(ij)=\\varphi(i)\\varphi(j)$\u3002\u4e8e\u662f\u6709\n\n$$\n\\begin{aligned}\n  &\\sum_{d=1}^n\\sum_{i=1}^{\\lfloor n/d\\rfloor}\\sum_{j=1}^{\\lfloor m/d\\rfloor}\\varphi(ij)[\\gcd(i,j)=1]\\\\\n  =&\\sum_{d=1}^n\\sum_{i=1}^{\\lfloor n/d\\rfloor}\\sum_{j=1}^{\\lfloor m/d\\rfloor}\\varphi(i)\\varphi(j)\\sum_{p\\mid i,p\\mid j}\\mu(p)\\\\\n  =&\\sum_{d=1}^n\\sum_{p=1}^{\\lfloor n/d\\rfloor}\\mu(p)\\sum_{i=1}^{\\lfloor n/dp\\rfloor}\\varphi(ip)\\sum_{j=1}^{\\lfloor m/dp\\rfloor}\\varphi(jp)\\\\\n  =&\\sum_{t=1}^n\\sum_{p\\mid t}\\mu(p)\\sum_{i=1}^{\\lfloor n/t\\rfloor}\\varphi(ip)\\sum_{j=1}^{\\lfloor m/t\\rfloor}\\varphi(jp) & t=dp\\\\\n\\end{aligned}\n$$\n\n\u8bbe $g(k,n)=\\displaystyle\\sum_{i=1}^{n}\\varphi(ik)$\uff0c\u7531\u4e8e $ik\\le m$\uff0c\u663e\u7136\u6b64\u5f0f\u53ea\u6709 $O(n\\log n)$ \u79cd\u53d6\u503c\uff0c\u53ef\u4ee5\u76f4\u63a5\u9884\u5904\u7406\u3002\n\n\u90a3\u4e48\u6709\n\n$$\n\\begin{aligned}\n  &\\sum_{t=1}^n\\sum_{p\\mid t}\\mu(p)\\sum_{i=1}^{\\lfloor n/t\\rfloor}\\varphi(ip)\\sum_{j=1}^{\\lfloor m/t\\rfloor}\\varphi(jp)\\\\\n  =&\\sum_{t=1}^n\\sum_{p\\mid t}\\mu(p)g(p,\\lfloor n/t\\rfloor)g(p,\\lfloor m/t\\rfloor)\\\\\n\\end{aligned}\n$$\n\n\u518d\u8bbe $h(a,b,n)=\\displaystyle\\sum_{i=1}^n\\sum_{p\\mid i}\\mu(p)g(p,a)g(p,b)$\u3002\n\n\u90a3\u4e48\u6309 [P4240](https://wsfxk.blog.luogu.org/solution-p4240) \u7684\u5957\u8def\u505a\u5c31\u884c\u4e86\u3002\n\n\u6ce8\u610f\u9884\u5904\u7406 $h$ \u7684\u65f6\u5019\u6211\u4eec\u9700\u8981\u5148\u9884\u5904\u7406 $\\displaystyle\\sum_{p\\mid i}\\mu(p)g(p,a)g(p,b)$\uff0c\u9884\u5904\u7406\u74f6\u9888\u5c31\u5728\u8fd9\u91cc\uff0c\u8ba1\u7b97\u4e00\u4e0b\uff0c\u6709\n\n$$\n\\begin{aligned}\n  &O(\\sum_{i=1}^B\\sum_{j=1}^B\\sum_{p=1}^{n/j}n/jp)\\\\\n  =&O(n\\sum_{i=1}^B\\sum_{j=1}^B1/j\\sum_{p=1}^{n/j}1/p)\\\\\n  =&O(n\\sum_{i=1}^B\\ln(B)\\ln(n))\\\\\n  =&O(nB\\ln(B)\\ln(n))\\\\\n\\end{aligned}\n$$\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u5373\u4e3a $O(n\\log n+nB\\log B\\log n+T(n/B\\log(n/B)+\\sqrt{n}))$\uff0c\u6700\u4f18\u7684 $B$ \u6ee1\u8db3 $B^2\\log B=T$\uff0c\u8fd1\u4f3c\u89e3\u4e3a $B=80$\u3002\n\n```cpp\n#include <iostream>\n#include <vector>\n\nusing namespace std;\n\nconst int kM = 23333;\nconst int kN = 5e4 + 1, kB = 81;\n\nint t, n, m, phi[kN], mu[kN];\nvector<int> g[kN], h[kB][kB], hf[kB][kB];\nbool v[kN];\nvector<int> pri;\n\nint main() {\n  ios_base::sync_with_stdio(0), cin.tie(0);\n  mu[1] = phi[1] = 1;\n  for (int i = 2; i < kN; ++i) {\n    if (!v[i]) {\n      pri.push_back(i), phi[i] = i - 1, mu[i] = -1;\n    }\n    for (int j : pri) {\n      int k = i * j;\n      if (k >= kN) {\n        break;\n      }\n      v[k] = 1;\n      if (i % j) {\n        mu[k] = -mu[i], phi[k] = phi[i] * (j - 1);\n      } else {\n        mu[k] = 0, phi[k] = phi[i] * j;\n        break;\n      }\n    }\n  }\n  for (int i = 1; i < kN; ++i) {\n    phi[i] %= kM;\n  }\n  for (int k = 1; k < kN; ++k) {\n    g[k].push_back(0);\n    for (int i = 1; i * k < kN; ++i) {\n      g[k].push_back((g[k].back() + phi[i * k]) % kM);\n    }\n  }\n  for (int i = 1; i < kB; ++i) {\n    for (int j = i; j < kB; ++j) {\n      hf[i][j].resize((kN - 1) / j + 1);\n      for (int p = 1; p < hf[i][j].size(); ++p) {\n        int s = mu[p] * g[p][i] % kM * g[p][j] % kM + kM;\n        for (int k = p; k < hf[i][j].size(); k += p) {\n          hf[i][j][k] = (hf[i][j][k] + s) % kM;\n        }\n      }\n      h[i][j].push_back(0);\n      for (int k = 1; j * k < kN; ++k) {\n        h[i][j].push_back((h[i][j].back() + hf[i][j][k]) % kM);\n      }\n    }\n  }\n  for (cin >> t; t--;) {\n    cin >> m >> n;\n    int ans = 0;\n    for (int d = 1; d <= m / kB; ++d) {\n      for (int l = d; l <= m / kB; l += d) {\n        ans = (ans + mu[d] * g[d][n / l] % kM * g[d][m / l] % kM + kM) % kM;\n      }\n    }\n    for (int l = m / kB + 1, r; l <= n; l = r + 1) {\n      r = min(n / (n / l), m / (m / l));\n      ans = (ans + (h[n / r][m / r][r] - h[n / r][m / r][l - 1] + kM)) % kM;\n    }\n    cout << ans << '\\n';\n  }\n  return 0;\n}\n```",
        "postTime": 1676637019,
        "uid": 376161,
        "name": "wsfxk",
        "ccfLevel": 6,
        "title": "P5572 [CmdOI2019]\u7b80\u5355\u7684\u6570\u8bba\u9898 \u9898\u89e3"
    },
    {
        "content": "[P5572 [CmdOI2019]\u7b80\u5355\u7684\u6570\u8bba\u9898](https://www.luogu.com.cn/problem/P5572)\n\n\u601d\u8def\u57fa\u672c\u540c [P4240 \u6bd2\u7624\u4e4b\u795e\u7684\u8003\u9a8c](https://www.luogu.com.cn/problem/P4240)\u3002\n\n## Description\n\n- \u591a\u6d4b\uff0c$T$ \u7ec4\u6570\u636e\u3002\n\n- \u7ed9\u5b9a\u6574\u6570 $n, m$\uff0c\u8bf7\u6c42\u51fa\n  $$\n  \\left[\\sum_{i = 1}^n \\sum_{j = 1}^m \\varphi\\left(\\dfrac{\\operatorname{lcm}(i, j)}{\\gcd(i, j)} \\right) \\right] \\bmod 23333\n  $$\n\n- $T\\le 3\\times 10^4, m\\le n\\le 5\\times 10^4$\u3002\n\n## Solution\n\n\u4e0d\u59a8\u8bbe $n\\le m$\u3002\n$$\n\\begin{aligned}\nans\n& = \\sum_{d = 1}^n \\sum_{i = 1}^n \\sum_{j = 1}^m \\varphi\\left(\\dfrac{ij}{d^2} \\right) [\\gcd(i, j) = d] \\\\\n& = \\sum_{d = 1}^n \\sum_{i = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\sum_{j = 1}^{\\left\\lfloor\\frac{m}{d}\\right\\rfloor} \\varphi(ij) [\\gcd(i, j) = 1] \\\\\n& = \\sum_{d = 1}^n \\sum_{i = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\varphi(i) \\sum_{j = 1}^{\\left\\lfloor\\frac{m}{d}\\right\\rfloor} \\varphi(j) [\\gcd(i, j) = 1] \\\\\n& = \\sum_{d = 1}^n \\sum_{k = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\mu(k) \\sum_{i = 1}^{\\left\\lfloor\\frac{n}{dk}\\right\\rfloor} \\varphi(ik) \\sum_{j = 1}^{\\left\\lfloor\\frac{m}{dk}\\right\\rfloor} \\varphi(jk) \\\\\n& = \\sum_{T = 1}^n \\sum_{k\\mid T} \\mu(k) \\sum_{i = 1}^{\\left\\lfloor\\frac{n}{T}\\right\\rfloor} \\varphi(ik) \\sum_{j = 1}^{\\left\\lfloor\\frac{m}{T}\\right\\rfloor} \\varphi(jk)\n\\end{aligned}\n$$\n\u5957\u8def\u5730\u8bbe\u51fa\u6765\n$$\nf(k, n) = \\sum_{i = 1}^n \\varphi(ik)\n$$\n\u90a3\u4e48\n$$\nans = \\sum_{T = 1}^n \\sum_{k\\mid T} \\mu(k) f\\left(k, \\left\\lfloor\\dfrac{n}{T}\\right\\rfloor \\right) f\\left(k, \\left\\lfloor\\dfrac{m}{T}\\right\\rfloor \\right)\n$$\n\u53c8\u6709\u9012\u63a8\u5f0f\n$$\nf(k, n) = f(k, n - 1) + \\varphi(nk)\n$$\n\u5373 $f$ \u53ef\u4ee5\u5728 $\\Theta(n\\ln n)$ \u65f6\u95f4\u5185\u9884\u5904\u7406\u3002\n\n\u4f46\u662f\u8fd9\u4e2a $f$ \u5e26\u4e00\u4e2a $k$\uff0c\u65e0\u6cd5\u6574\u9664\u5206\u5757\uff0c\u53ea\u80fd\u66b4\u529b\uff0c\u6240\u4ee5\u67e5\u8be2\u662f $\\Omicron(T\\sum\\limits_{i = 1}^n \\dfrac{n}{i}) \\simeq \\Omicron(T n\\ln n)$ \u7684\u3002\n\n------\n\n\u6211\u4eec\u60f3\u8981\u6574\u9664\u5206\u5757\uff0c\u90a3\u5c31\u5f04\u4e2a\u524d\u7f00\u548c\u3002\n\n\u628a\u6574\u4e2a\u8868\u793a\u51fa\u6765\n$$\ng(n, m, l) = \\sum_{i = 1}^l \\sum_{k\\mid i} \\mu(k) f(k, n) f(k, m)\n$$\n\u90a3\u4e48\u6574\u9664\u5206\u5757\u5927\u6982\u957f\u8fd9\u6837\n$$\ng\\left(\\left\\lfloor\\dfrac{n}{l}\\right\\rfloor, \\left\\lfloor\\dfrac{m}{l}\\right\\rfloor, r \\right) - g\\left(\\left\\lfloor\\dfrac{n}{l}\\right\\rfloor, \\left\\lfloor\\dfrac{m}{l}\\right\\rfloor, l - 1 \\right)\n$$\n\u540c\u6837\u6709\u9012\u63a8\u5f0f\n$$\ng(n, m, l) = g(n, m, l - 1) + \\sum_{k\\mid l} \\mu(k) f(k, n) f(k, m)\n$$\n\u9884\u5904\u7406\u662f\n$$\n\\Omicron\\left(n \\sum_{i = 1}^n \\left(\\sum_{j = 1}^{\\frac{n}{i}} \\dfrac{n}{j}\\right) + \\dfrac{n}{i} \\right) \\simeq \\Omicron(n^3)\n$$\n\u4f1a $\\rm TLE + MLE$\u3002\n\n\u4f46\u662f\u5b83\u80fd\u591f\u505a\u5230\u5341\u5206\u4f18\u79c0\u7684 $\\Omicron(T \\sqrt{n})$ \u56de\u7b54\u3002\n\n------\n\n\u5982\u679c\u8981\u5c06\u4e24\u79cd\u65b9\u6cd5\u7ed3\u5408\uff0c\u90a3\u4e48\u5c31\u662f\u5927\u5bb6\u559c\u95fb\u4e50\u89c1\u7684 **\u6839\u53f7\u5206\u6cbb** \u4e86\u3002\n\n\uff08\u5176\u5b9e\u9898\u76ee\u80cc\u666f\u5df2\u7ecf\u6709\u63d0\u793a\u4e86\uff09\n\n> A:\u201c\u6570\u8bba,\u5206\u5757\u3002\u201d\n\n\u8bbe $k$ \u4e3a\u9608\u503c\uff0c\u8868\u793a\u9884\u5904\u7406 $g(n, m, l)$ \u65f6 $n, m$ \u53ea\u5904\u7406\u5230 $k$\u3002\n\n\u90a3\u4e48\u8ba1\u7b97\u65f6\u5bf9\u4e8e $l \\le \\left\\lfloor\\dfrac{n}{k}\\right\\rfloor$ \u7684\u76f4\u63a5\u66b4\u529b\uff1b\u5bf9\u4e8e $l > \\left\\lfloor\\dfrac{n}{k}\\right\\rfloor$ \u7684\u90e8\u5206\uff0c\u6709 $\\left\\lfloor\\dfrac{n}{l}\\right\\rfloor \\le k$\uff0c\u76f4\u63a5\u7528\u9884\u5904\u7406\u8fc7\u7684 $g$\u3002\n\n## Code\n\n```cpp\n//18 = 9 + 9 = 18.\n#include <iostream>\n#include <cstdio>\n#include <vector> \n#define Debug(x) cout << #x << \"=\" << x << endl\ntypedef long long ll;\nusing namespace std;\n\nconst int MAXN = 5e4 + 5;\nconst int N = 5e4;\nconst int MAXK = 155;\nconst int K = 150;\nconst int MOD = 23333;\ntypedef int arr[MAXN];\nint add(int a, int b) {return (a + b) % MOD;}\nint sub(int a, int b) {return (a - b + MOD) % MOD;}\nint mul(int a, int b) {return (ll)a * b % MOD;}\n\narr p, mu, phi;\nbool vis[MAXN];\nvector<int> f[MAXN], g[MAXK][MAXK];\n\nvoid pre()\n{\n\tmu[1] = phi[1] = 1;\n\tfor (int i = 2; i <= N; i++)\n\t{\n\t\tif (!vis[i])\n\t\t{\n\t\t\tp[++p[0]] = i;\n\t\t\tmu[i] = MOD - 1;\n\t\t\tphi[i] = (i - 1) % MOD;\n\t\t}\n\t\tfor (int j = 1; j <= p[0] && i * p[j] <= N; j++)\n\t\t{\n\t\t\tvis[i * p[j]] = true;\n\t\t\tif (i % p[j] == 0)\n\t\t\t{\n\t\t\t\tmu[i * p[j]] = 0;\n\t\t\t\tphi[i * p[j]] = mul(phi[i], p[j]);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmu[i * p[j]] = mul(mu[i], mu[p[j]]);\n\t\t\tphi[i * p[j]] = mul(phi[i], phi[p[j]]);\n\t\t}\n\t}\n\t\n\tfor (int k = 1; k <= N; k++)\n\t{\n\t\tf[k].resize(N / k + 5);\n\t\tfor (int n = 1; n <= N / k; n++)\n\t\t{\n\t\t\tf[k][n] = add(f[k][n - 1], phi[n * k]);\n\t\t}\n\t}\n\t\n\tfor (int n = 1; n <= K; n++)\n\t{\n\t\tfor (int m = n; m <= K; m++)\n\t\t{\n\t\t\tg[n][m].resize(N / m + 5);\n\t\t\tfor (int i = 1; i <= N / m; i++)\n\t\t\t{\n\t\t\t\tint wjy = mul(mu[i], mul(f[i][n], f[i][m]));\n\t\t\t\tfor (int j = 1; j <= N / m / i; j++)\n\t\t\t\t{\n\t\t\t\t\tg[n][m][i * j] = add(g[n][m][i * j], wjy);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (int l = 1; l <= N / m; l++)\n\t\t\t{\n\t\t\t\tg[n][m][l] = add(g[n][m][l], g[n][m][l - 1]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nint block(int n, int m)\n{\n\tif (n > m)\n\t{\n\t\tswap(n, m);\n\t}\n\tint res = 0, xsy = m / K;\n\tfor (int i = 1; i <= xsy; i++)\n\t{\n\t\tfor (int j = 1; j <= xsy / i; j++)\n\t\t{\n\t\t\tint t = i * j;\n\t\t\tres = add(res, mul(mu[i], mul(f[i][n / t], f[i][m / t])));\n\t\t}\n\t}\n\tfor (int l = xsy + 1, r; l <= n; l = r + 1)\n\t{\n\t\tint k1 = n / l, k2 = m / l;\n\t\tr = min(n / k1, m / k2);\n\t\tres = add(res, sub(g[k1][k2][r], g[k1][k2][l - 1]));\n\t}\n\treturn res;\n}\n\nint main()\n{\n\tpre();\n\tint t;\n\tscanf(\"%d\", &t);\n\twhile (t--)\n\t{\n\t\tint n, m;\n\t\tscanf(\"%d%d\", &n, &m);\n\t\tprintf(\"%d\\n\", block(n, m));\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1643202152,
        "uid": 305532,
        "name": "mango09",
        "ccfLevel": 0,
        "title": "\u300e\u9898\u89e3\u300fLuogu-P5572 [CmdOI2019]\u7b80\u5355\u7684\u6570\u8bba\u9898"
    },
    {
        "content": "\uff08$n\\le m$\uff0c$n=\\Theta(m)$\uff0c\u5206\u6570\u5411\u4e0b\u53d6\u6574\uff09\n\n$$\\sum_{i=1}^n \\sum_{j=1}^m \\varphi(\\dfrac {\\text{lcm}(i,j)} {\\gcd(i,j)})$$\n\n$$\\sum_{i=1}^n \\sum_{j=1}^m \\varphi(\\dfrac {ij} {\\gcd(i,j)^2})$$\n\n$$\\sum_{d=1}^n \\sum_{i=1}^n \\sum_{j=1}^m \\varphi(\\dfrac {ij} {d^2}) [\\gcd(i,j)=d]$$\n\n$$\\sum_{d=1}^n \\sum_{i=1}^{n/d} \\sum_{j=1}^{m/d} \\varphi(ij) [\\gcd(i,j)=1]$$\n\n$$\\sum_{d=1}^n \\sum_{i=1}^{n/d} \\sum_{j=1}^{m/d} \\varphi(i)\\varphi(j) [\\gcd(i,j)=1]$$\n\n\uff08\u6709\u8da3\u7684\u4e00\u6b65\uff09\n\n$$\\sum_{d=1}^n \\sum_{i=1}^{n/d} \\sum_{j=1}^{m/d} \\varphi(i)\\varphi(j)\\sum_{x|i,x|j} \\mu(x)$$\n\n$$\\sum_{d=1}^n \\sum_{x=1}^{n/d} \\mu(x)\\sum_{i=1}^{n/dx} \\varphi(ix)\\sum_{j=1}^{m/dx} \\varphi(jx)$$\n\n\u4ee4 $t=dx$\n\n$$\\sum_{t=1}^n \\sum_{x|t} \\mu(x) \\sum_{i=1}^{n/t} \\varphi(ix)\\sum_{j=1}^{m/t} \\varphi(jx)$$\n\n\u8bbe $g(x,y)=\\sum_{i=1}^x \\varphi(iy)$\n\n\u597d[\u773c\u719f](https://www.luogu.com.cn/blog/203623/fake-ti-xie-p4240-du-liu-zhi-shen-di-kao-yan)\u7684\u5f0f\u5b50\u3002\n\n$g(x,y)=g(x-1,y)+\\varphi(xy)$\uff08\u544a\u8bc9\u4f60\u4ed6\u53ef\u4ee5\u9012\u63a8\u9884\u5904\u7406\uff09\n\n\u663e\u7136\u6240\u6709\u7684 $xy\\le n$\uff0c\u6240\u4ee5\u9012\u63a8\u9884\u5904\u7406\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n$$\\sum_{t=1}^n \\sum_{x|t} \\mu(x) g(\\dfrac n t,x)g(\\dfrac m t,x)$$\n\n\u8bbe $s(t,y,z)=\\sum_{x|t} \\mu(x) g(y,x)g(z,x)$\n\n$$\\sum_{t=1}^n s(t,\\dfrac n t,\\dfrac m t)$$\n\n\u6839\u53f7\u5206\u6cbb\uff0c\u8bbe\u5206\u6cbb\u754c\u4e3a $b$\u3002\n\n\u9884\u5904\u7406 $s(\\le n,\\le b,\\le b)$\uff08\u975e\u5e38\u4e0d\u4e25\u8c28\u7684\u8868\u8ff0\uff09\uff0c$O(nb^2)$ \u4e2a\u72b6\u6001\u3002$O(nb^2 \\log n)$ \u9884\u5904\u7406\u590d\u6742\u5ea6\u3002\n\n\u5904\u7406\u5b8c\u4e86 $\\dfrac m t\\le b$ \u90e8\u5206\u3002\n\n\u82e5 $\\dfrac m t>b$\uff0c\u5219 $t<\\dfrac m b$\u3002\u76f4\u63a5\u6c42 $s$\uff0c\u590d\u6742\u5ea6 $O(d(t))$\u3002\u7136\u800c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\dfrac n b \\log(\\dfrac n b))$\uff08\u8c03\u548c\u7ea7\u6570\uff09\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nb^2 \\log n+T(\\sqrt n+\\dfrac n b \\log(\\dfrac n b)))$\u3002\n\n\u89e3\u5f97 $b=\\Theta(T^{\\frac 1 3})$~~\uff0c\u597d[\u773c\u719f](https://www.luogu.com.cn/blog/203623/fake-ti-xie-p4240-du-liu-zhi-shen-di-kao-yan)\u7684\u5f0f\u5b50~~\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nT^{\\frac 2 3}\\log n+T\\sqrt n)$\u3002\n\n\uff08\u82e5\u6211\u7684\u8ba1\u7b97\u6709\u8bef\uff0c\u8bf7\u6307\u51fa\uff09\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int S=5e4;\nconst int mod=23333;\nconst int b=21;\nint mu[S+5],phi[S+5];\nvector<int> g[S+5];\nvector<int> ys[S+5];\nint prime[S+5];\nbool t[S+5];\nint inv[S+5];\nint s2[S+5][b+1][b+1];\nvoid getmod(int &x)\n{\n\tx+=(x<0)*mod,x-=(x>=mod)*mod;\n}\nint s(int t,int y,int z)\n{\n\tll sum=0;\n\tfor(int i=0,x;i<ys[t].size();i++)\n\t\tsum+=1ll*mu[x=ys[t][i]]*g[y][x]*g[z][x];\n\treturn sum%mod;\n}\nvoid init()\n{\n\tinv[0]=inv[1]=phi[1]=t[1]=mu[1]=1;\n\tint i,j,k,l,x,cnt=0;\n\tll sum;\n\tfor(i=2;i<=S;i++)\n\t\tinv[i]=1ll*(mod-mod/i)*inv[mod%i]%mod;\n\tfor(i=2;i<=S;i++)\n\t{\n\t\tif(!t[i])\n\t\t\tprime[++cnt]=i,mu[i]=-1,phi[i]=i-1;\n\t\tfor(j=1;j<=cnt&&i*prime[j]<=S;j++)\n\t\t{\n\t\t\tt[i*prime[j]]=1;\n\t\t\tif(i%prime[j])\n\t\t\t\tmu[i*prime[j]]=-mu[i],phi[i*prime[j]]=phi[i]*(prime[j]-1);\n\t\t\telse\n\t\t\t{\n\t\t\t\tmu[i*prime[j]]=0;\n\t\t\t\tphi[i*prime[j]]=phi[i]*prime[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tg[0].resize(S+5);\n\tfor(i=1;i<=S;i++)\n\t{\n\t\tg[i].resize(S/i+5);\n\t\tfor(j=1;i*j<=S;j++)\n\t\t\tgetmod(g[i][j]=g[i-1][j]+phi[i*j]);\n\t}\t\n\tfor(i=1;i<=S;i++)\n\t\tfor(j=i;j<=S;j+=i)\n\t\t\tys[j].push_back(i);\n\tfor(i=1;i<=S;i++)\n\t\tfor(j=1;j<=b;j++)\n\t\t\tfor(k=1;k<=b;k++)\n\t\t\t\tif(i*j<=S&&i*k<=S)\n\t\t\t\t\tgetmod(s2[i][j][k]=s(i,j,k)+s2[i-1][j][k]);\t\t\t\n}\nint main()\n{\n\tinit();\n\tint T,n,m,l,r,x,y;\n\tll ans;\n\tscanf(\"%d\",&T);\n\twhile(T--)\n\t{\n\t\tscanf(\"%d%d\",&n,&m);\n\t\tif(n>m) swap(n,m);\n\t\tfor(ans=0,l=1;l<=n;l=r+1)\n\t\t{\n\t\t\tr=min(n/(x=n/l),m/(y=m/l));\n\t\t\tif(y<=b)\n\t\t\t\tans+=s2[r][x][y]-s2[l-1][x][y];\n\t\t\telse\n\t\t\t\tfor(;l<=r;l++)\n\t\t\t\t\tans+=s(l,x,y);\n\t\t}\n\t\tprintf(\"%ld\\n\",(ans%mod+mod)%mod);\n\t}\n}\n```\n",
        "postTime": 1629690051,
        "uid": 203623,
        "name": "Ntokisq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5572 [CmdOI2019]\u7b80\u5355\u7684\u6570\u8bba\u9898"
    }
]