[
    {
        "content": "\u9996\u5148\u6211\u4eec\u53d1\u73b0\u8fd9\u9898\u4e0d\u5f31\u4e8e\u80cc\u5305\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u9898\u591a\u4e86\u4e00\u4e2a\u9650\u5236\uff0c\u6bcf\u4ef6\u7269\u54c1\u7684\u4ef7\u503c\u4e3a $1$\uff0c\u4f53\u79ef\u5f88\u5c0f\u3002\n\n\u8003\u8651\u5230\u603b\u7684\u5bb9\u91cf\u5f88\u5927\u800c\u5355\u4ef6\u7269\u54c1\u4f53\u79ef\u5f88\u5c0f\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u8d2a\u5fc3\u7684\u5c3d\u91cf\u591a\u9009\u7269\u54c1\uff0c\u8fd9\u6837\u80cc\u5305\u7684\u5bb9\u91cf\u6700\u591a\u8fd8\u5269 $m$\uff0c\u6b64\u65f6\u6211\u4eec\u518d\u4f7f\u7528\u80cc\u5305\u8003\u8651\u586b\u6ee1\u8fd9\u6700\u540e\u8fd9\u70b9\u4f53\u79ef\u3002\u7531\u4e8e $i$ \u548c $-i$ \u5728\u8dd1\u80cc\u5305\u662f\u4e0d\u4f1a\u540c\u65f6\u5b58\u5728\uff0c\u6240\u4ee5\u6700\u591a\u518d\u585e $2m$ \u4e2a\u6570\uff0c\u80cc\u5305\u503c\u57df\u5f00 $[-m^2,m^2]$ \u5373\u53ef\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u7ec6\u8282\u662f\u5bf9\u4e8e\u5df2\u7ecf\u8d2a\u5fc3\u9009\u62e9\u7684\u7269\u54c1\uff0c\u8981\u5bf9\u5e94\u8003\u8651\u4f53\u79ef\u4e3a\u76f8\u53cd\u6570\u7684\u7269\u54c1\u8868\u793a\u53cd\u6094\u64cd\u4f5c\u3002\u5bf9\u4e8e\u539f\u4f53\u79ef $<0$ \u7684\u7269\u54c1\uff0c\u53ef\u4ee5\u5148\u5f3a\u5236\u9009\u62e9\u7136\u540e\u5220\u9664\uff0c\u8fd9\u6837\u5c06\u7269\u54c1\u4f53\u79ef\u7edf\u4e00\u53d8\u6210\u6b63\u6570\u3002\u591a\u91cd\u80cc\u5305\u53ef\u4ee5\u76f4\u63a5\u8dd1\u4e8c\u8fdb\u5236\u4f18\u5316\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(m^3\\log m)$\u3002\n\n```cpp\n#define N 605\nint n, m, k, f[N * N]; LL ans, l, a[N], b[N], c[N], d[N];\nvoid ins(LL s,int v,int w){\n\tif(!s)return;\n\tcmn(s, n + n + 1LL);\n\tif(v > 0){\n\t\tint c = 1;\n\t\tfor(; c + c < s; c <<= 1, w <<= 1, v <<= 1);\n\t\twhile(true){\n\t\t\tpre(x, k - v, 0)cmx(f[x + v], f[x] + w);\n\t\t\ts -= c;\n\t\t\tif(1 == c)break;\n\t\t\tc >>= 1, w >>= 1, v >>= 1;\n\t\t}\n\t\tif(s > 0){\n\t\t\tv *= s, w *= s;\n\t\t\tpre(x, k - v, 0)cmx(f[x + v], f[x] + w);\n\t\t}\n\t}\n\telse{\n\t\tv = -v;\n\t\tint c = 1;\n\t\tfor(; c + c < s; c <<= 1, w <<= 1, v <<= 1);\n\t\twhile(true){\n\t\t\trep(x, v, k)cmx(f[x - v], f[x] + w);\n\t\t\ts -= c;\n\t\t\tif(1 == c)break;\n\t\t\tc >>= 1, w >>= 1, v >>= 1;\n\t\t}\n\t\tif(s > 0){\n\t\t\tv *= s, w *= s;\n\t\t\trep(x, v, k)cmx(f[x - v], f[x] + w);\n\t\t}\n\t}\n}\nint main() {\n\tread(n, l);\n\tpr(i, n)read(a[i]), ans += a[i], l += i * a[i];\n\tLL x; read(x); ans += x;\n\trp(i, n)read(b[i]);\n\tif(l < 0){puts(\"impossible\"); return 0;}\n\trp(x, n){\n\t\tif(b[x] * x <= l)l -= b[x] * x, ans += (c[x] = b[x]);\n\t\telse {c[x] = l / x, ans += c[x], l -= c[x] * x; break;}\n\t}\n\tpr(x, n){\n\t\tif(a[x] * x <= l)l -= a[x] * x, ans -= (d[x] = a[x]);\n\t\telse {d[x] = l / x, ans -= d[x], l -= d[x] * x; break;}\n\t}\n\tm = n * n, k = m * 2;\n\tmemset(f, 0xcf, sizeof(f));\n\tf[m] = 0;\n\trp(x, n){\n\t\tif(c[x])ins(c[x], -x, -1);\n\t\tif(b[x] - c[x])ins(b[x] - c[x], x, 1);\n\t\tif(d[x])ins(d[x], -x, 1);\n\t\tif(a[x] - d[x])ins(a[x] - d[x], x, -1);\n\t}\n\tif(l > m || f[m + l] < -m)puts(\"impossible\");\n\telse printf(\"%lld\\n\", ans + f[m + l]);\n\treturn 0;\n}\n```",
        "postTime": 1655596454,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011\u300cBalticOI 2022 Day1\u300dUplifting Excursion"
    },
    {
        "content": "\u9996\u5148\u8bb2\u4e00\u4e9b\u9519\u8bef\u7684\u65b9\u5411\uff0c\u521a\u770b\u5230\u8fd9\u9053\u9898\u4f60\u4f1a\u53d1\u73b0\u80cc\u5305\u5fc5\u7136\u662f\u9003\u4e0d\u6389\u7684\uff0c\u56e0\u6b64\u4f60\u53ef\u80fd\u4f1a\u5c1d\u8bd5\u5404\u79cd\u65b9\u6cd5\u4e71\u641e\u80cc\u5305\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u5b9a\u4e49\u57df\u503c\u57df\u4ea4\u6362\u3001\u731c\u6d4b\u7b54\u6848\u5728 $[m^2,sum-m^2]$ \u4e4b\u5185\u5fc5\u7136\u6709\u89e3\u7b49\u7b49\u9519\u8bef\u7684\u5c1d\u8bd5\uff0c\u4f46\u662f\u90fd\u4e0d\u592a\u884c\u5f97\u901a\u3002\n\n\u6b63\u786e\u7684\u65b9\u5411\uff1a**\u53d1\u73b0\u4e00\u4e9b\u6027\u8d28\uff0c\u4ece\u800c\u5c06\u80cc\u5305\u5bb9\u91cf\u9650\u5236\u5728 $\\text{poly}(m)$ \u7684\u89c4\u6a21\u5185**\u3002\n\n\u6211\u4eec\u5148\u8003\u8651\u4e00\u4e2a\u8d2a\u5fc3\uff1a\u5148\u5047\u8bbe\u6240\u6709\u6570\u5168\u9009\uff0c\u6c42\u51fa\u6240\u6709\u6570\u4e4b\u548c $s$\uff0c\u5982\u679c $s > L$ \u5c31\u6bcf\u6b21\u5220\u53bb\u6700\u5927\u7684\u6570\u76f4\u5230 $\\le L$ \u4f4d\u7f6e\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u76f4\u63a5\u626b\u4e00\u904d\u6c42\u5f97\uff0c\u5bf9\u4e8e $s<L$ \u7684\u60c5\u51b5\u4e5f\u540c\u7406\u3002\u6b64\u65f6\u6240\u6709\u6570\u4e4b\u548c\u5fc5\u7136\u5728 $[L-m,L]$ \u4e2d\uff0c\u4f46\u662f\u8fd9\u4e0d\u4e00\u5b9a\u662f\u6700\u4f18\u65b9\u6848\uff0c\u6211\u4eec\u8fd8\u9700\u8fdb\u4e00\u6b65\u8c03\u6574\u3002\u5047\u8bbe\u6b64\u65f6 $i$ \u7684\u6570\u91cf\u4e3a $c_i$\uff0c\u6700\u4f18\u89e3\u4e2d $i$ \u7684\u6570\u91cf\u4e3a $b_i$\uff0c\u90a3\u4e48\u6709\u7ed3\u8bba $\\sum |b_i - c_i|\\le 2m$\u3002\u8bc1\u660e\u5927\u6982\u5c31\uff0c\u5728\u8c03\u6574\u8fc7\u7a0b\u4e2d\uff0c\u6240\u6709\u7269\u54c1\u91cd\u91cf\u603b\u548c\u80af\u5b9a\u4e0d\u4f1a\u8d70\u51fa\u533a\u95f4 $[L-m,L+m]$\uff0c\u5426\u5219\u6211\u4eec\u53ef\u4ee5\u8c03\u6574\u5220\u7269\u54c1/\u52a0\u7269\u54c1\u7684\u987a\u5e8f\uff0c\u5e76\u4e14\u6211\u4eec\u80af\u5b9a\u4e0d\u4f1a\u91cd\u590d\u7ecf\u8fc7\u540c\u4e00\u4e2a\u72b6\u6001\u4e24\u6b21\uff0c\u56e0\u6b64\u6211\u4eec\u6700\u591a\u52a0/\u5220\u7269\u54c1 $2m$ \u6b21\u3002\u4e8e\u662f\u76f4\u63a5\u591a\u91cd\u80cc\u5305\u5373\u53ef\u3002\u80cc\u5305\u5bb9\u91cf\u4e0a\u754c\u662f $\\mathcal O(m^2)$\uff0c\u4f7f\u7528\u5355\u8c03\u961f\u5217\u53ef\u4ee5\u4f18\u5316\u5230 $\\mathcal O(m^3)$\u3002\n\n\u603b\u4e4b\uff0c\u662f\u4e00\u9053\u4e0d\u9519\u7684\u53d1\u6398\u6027\u8d28\u9898\u3002\n\n```cpp\nconst int MAXN = 600;\nint n; ll L, a[MAXN + 5], b[MAXN + 5], sum, mnV, mxV;\nll dp1[2000000], dp2[2000000];\nvoid ins(ll *dp, int w, int v, ll num, int lim) {\n//\tprintf(\"ins %d %d %lld %d\\n\", w, v, num, lim);\n    for (int i = (w > 0) ? (-lim) : lim, stp = 0; stp < abs(w); (w > 0) ? (i++) : (i--), stp++) {\n        deque<pair<int, ll> > q;\n        for (int j = i, k = 0; j <= lim && j >= -lim; j += w, k++) {\n            while (!q.empty() && q.back().se < dp[j + lim] - v * k) q.pop_back();\n            q.push_back(mp(k, dp[j + lim] - v * k));\n            while (!q.empty() && q.front().fi < k - num) q.pop_front();\n            if (!q.empty()) dp[j + lim] = v * k + q.front().se;\n        }\n    }\n}\nint main() {\n\tfreopen(\"goods.in\", \"r\", stdin);\n\tfreopen(\"goods.out\", \"w\", stdout);\n\tscanf(\"%d%lld\", &n, &L);\n\tfor (int i = -n; i <= n; i++) {\n\t\tscanf(\"%lld\", &a[i + n]);\n\t\tsum += i * a[i + n], b[i + n] = a[i + n];\n\t\tif (i < 0) mnV += i * a[i + n];\n\t\telse mxV += i * a[i + n];\n\t}\n\tif (L < mnV || L > mxV) return puts(\"impossible\"), 0;\n\tif (sum == L) {\n\t\tll res = 0;\n\t\tfor (int i = 0; i <= 2 * n; i++) res += a[i];\n\t\tprintf(\"%lld\\n\", res); return 0;\n\t}\n\tint d = (sum > L) ? 1 : -1;\n\tfor (int i = d * n; i != 0; i -= d) {\n\t\tll l = 0, r = a[i + n], p = 0;\n\t\twhile (l <= r) {\n\t\t\tll mid = l + r >> 1;\n\t\t\tif ((sum - mid * i >= L) == (d == 1)) p = mid, l = mid + 1;\n\t\t\telse r = mid - 1;\n\t\t}\n\t\tsum -= p * i; b[i + n] -= p;\n\t}\n\tint lim = n * n;\n\tmemset(dp1, 192, sizeof(dp1)); memset(dp2, 192, sizeof(dp2));\n\tdp1[lim] = dp2[lim] = 0;\n\tfor (int i = -n; i <= n; i++) {\n\t\tif (i == 0) continue;\n\t\tll can_del = min(1ll * n, b[i + n]), can_add = min(1ll * n, a[i + n] - b[i + n]);\n\t\tins(dp1, i, 1, can_add, lim); ins(dp2, -i, -1, can_del, lim);\n\t}\n\tll lft = L - sum, res = -1e18;\n\tfor (int i = -lim; i <= lim; i++) if (-lim <= lft - i && lft - i <= lim)\n\t\tchkmax(res, dp1[i + lim] + dp2[lft - i + lim]);\n\tfor (int i = -n; i <= n; i++) res += b[i + n];\n\tif (res < 0) puts(\"impossible\");\n\telse printf(\"%lld\\n\", res);\n\treturn 0;\n}\n```",
        "postTime": 1655360115,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P8392 \u300cBalticOI 2022 Day1\u300dUplifting Excursion"
    }
]