[
    {
        "content": "\u9996\u5148\uff0c\u6211\u4eec\u90fd\u77e5\u9053fail\u6811\u5c31\u662f\u5728\u8dd1ac\u673a\u4e2d\u628a\u5931\u914d\u6307\u9488\u6240\u6307\u5411\u7684\u503c\u4e0e\u5931\u914d\u6307\u9488\u6240\u8868\u793a\u7684\u8fb9\u91cd\u65b0\u5efa\u51fa\u6765\u7684\u6811\u3002\u6709\u8fd9\u4e2a\u601d\u60f3\uff0c\u90a3\u4e48\u8fd9\u9053\u9898\u5c31\u5f88\u7b80\u5355\u4e86\u3002\n\n\u8dd1\u4e00\u904dAC\u81ea\u52a8\u673a\uff0c\u6bcf\u4e00\u4e2a\u8282\u70b9\u4fdd\u5b58\u4e00\u4e0b\u5c5e\u4e8e\u591a\u5c11\u5b57\u7b26\u4e32\uff0c\u4e3a\u5b83\u7684\u6743\u503c\u3002\u7136\u540e\u4e00\u4e2a\u8282\u70b9\u8868\u793a\u7684\u5b57\u7b26\u4e32\u5728\u6574\u4e2a\u5b57\u5178\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\u76f8\u5f53\u4e8e\u5176\u5728Fail\u6811\u4e2d\u7684\u5b50\u6811\u7684\u6743\u503c\u7684\u548c\u3002\n\n# code\n\n```\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#define N 1100005\nusing namespace std;\nint n,a[N],h[N],cnt,last,ch[N][26],sz[N],fail[N];\nchar s[N];\nstruct ac{\n\tvoid ins(int x){\n\t\tscanf(\"%s\",s+1);int now=0,len=strlen(s+1);\n\t\tfor(int i=1;i<=len;i++){\n\t\t\tint u=s[i]-'a';\n\t\t\tif(!ch[now][u]) ch[now][u]=++cnt;\n\t\t\tnow=ch[now][u];\n\t\t\tsz[now]++;\n\t\t}\n\t\ta[x]=now;\n\t}\n\tvoid build(){\n\t\tint i,head=0,tail=0;\n\t\tfor(i=0;i<26;i++) if(ch[0][i]) h[++tail]=ch[0][i];\n\t\twhile(head<tail){\n\t\t\tint x=h[++head],y;\n\t\t\t\tfor(i=0;i<26;i++) if(y=ch[x][i]){\n\t\t\t\th[++tail]=y;\n\t\t\t\tfail[y]=ch[fail[x]][i];\n\t\t\t}\n\t\t\telse ch[x][i]=ch[fail[x]][i];\n\t\t}\n\t}\n\tvoid solve(){\n\t\tfor(int i=cnt;i>=0;i--) sz[fail[h[i]]]+=sz[h[i]];\n\t\tfor(int i=1;i<=n;i++) printf(\"%d\\n\",sz[a[i]]);\n\t}\n}ac;\nint main(){\n\t//freopen(\"word.in\",\"r\",stdin);\n\t//freopen(\"word.out\",\"w\",stdout);\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++) ac.ins(i);\n\tac.build();ac.solve();\n\treturn 0;\n}\n```\n",
        "postTime": 1543570205,
        "uid": 111961,
        "name": "D_14134",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "## KMP\n\n\u770b\u89c1\u8fd9\u4e48\u591adalao\u7528AC\u81ea\u52a8\u673a\uff0c\u6628\u5929\u624d\u5f00\u59cb\u4e86\u89e3AC\u81ea\u52a8\u673a\u7684\u849f\u84bb\u8868\u793a\u5f88\u6de6\uff0c\u4e8e\u662f\u4ed6\u638f\u51fa\u4e86~~\u66b4\u529b\u5f97\u53d1\u6307~~KMP\u6765\u6c35\u4e00\u7bc7\u9898\u89e3\u3002\n\n\u7528KMP\u6ca1\u6709\u4efb\u4f55\u601d\u8def\u548c\u7801\u529b\u7684\u56f0\u96be\uff0c\u65f6\u95f4900ms\uff0c\u4e0d\u6127\u662f\u66b4\u529b\n\n\u5177\u4f53\u7684\u6ce8\u610f\u4e8b\u9879\u5728\u7801\u91cc\u9762\u6ce8\u660e\uff0c\u4e8e\u662f......\n\n\u4e0a\u7801\uff01\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ri register int\n\nint n,len[210],ans1,nxt[1000010];\nchar s[210][1000010];\n\ninline int gi(char *s)//\u5b57\u7b26\u4e32\u5feb\u8bfb\uff0c\u8fd8\u80fd\u8fd4\u56de\u5b57\u7b26\u4e32\u957f\u5ea6\uff0c\u9999\uff01 \n{\n\tint x=0;\n\twhile((s[++x]=getchar())!='\\n'&&s[x]!=' '&&s[x]!='\\377');\n\treturn x-1;\n}\ntemplate< typename T > inline void read(T &x)\n{\n\tint f=1;\n\tchar c=getchar();\n\tx=0;\n\tfor(; !isdigit(c); c=getchar()) if(c=='-') f=-1;\n\tfor(; isdigit(c); c=getchar()) x=((x<<3)+(x<<1)+(c^48));\n\tx*=f;\n}\ntemplate< typename T > inline void write(T x)\n{\n\tif(x<0) putchar('-'),x=-x;\n\tif(x>9) write(x/10);\n\tputchar(x%10+'0');\n}\ninline void kmp(char *a,int l)//KMP\u677f\u5b50 \n{\n\tnxt[1]=0;\n\tfor(ri i=2,j=0; i<=l; ++i)\n\t{\n\t\twhile(j>0&&a[i]!=a[j+1]) j=nxt[j];\n\t\tif(a[i]==a[j+1]) ++j;\n\t\tnxt[i]=j;\n\t}\n}\ninline void findd(char *a,char *target,int l)\n{\n\tfor(ri i=1,j=0; target[i]; ++i)\n\t{\n\t\twhile(j&&target[i]!=a[j+1]) j=nxt[j];\n\t\tif(target[i]==a[j+1]) ++j;\n\t\tif(j==l) ++ans1;\n\t}\n}\n\nint main()\n{\n\tread(n);\n\tfor(ri i=1; i<=n; ++i)\n\t\tlen[i]=gi(s[i]);\n\tfor(ri i=1; i<=n; ++i)\n\t{\n\t\tans1=0;\n\t\tfor(ri j=1; j<=n; ++j)\n\t\t{\n\t\t\tif(i==j) ++ans1;\t       //\u5c0f\u4f18\u5316\uff1a\u5f53i=j\u65f6\u76f4\u63a5ans1++ \n\t\t\telse if(len[i]<=len[j])    //\u5c0f\u4f18\u5316\uff0c\u5f53\u957f\u5ea6\u66f4\u5c0f\u65f6\u5fc5\u5b9a\u6ca1\u6709\u5339\u914d\u4e32\uff0c\u76f4\u63a5\u6e9c\n\t\t\t{\n\t\t\t\tkmp(s[i],len[i]);\n\t\t\t\tfindd(s[i],s[j],len[i]);\n\t\t\t}\n\t\t}\n\t\twrite(ans1);\n\t\tputchar('\\n');\n\t}\n}\n```\n",
        "postTime": 1602830061,
        "uid": 254036,
        "name": "HMP_Haoge",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u6700\u8fd1\u6211\u4eec\u5728\u5b66ac\u81ea\u52a8\u673a\n\n~~\u4e8e\u662f\u6211\u7528kmp\u6c34\u8fc7\u4e86\u8fd9\u9053\u9898~~\n\n\u673a\u623f\u91cc\u9762\u5404\u4f4d\u5927\u4f6c\u90fd\u7528\u7684ac\u81ea\u52a8\u673a...\u4f46\u662f\u5982\u679c\u6ca1\u5b8c\u5168\u7406\u6e05\u81ea\u52a8\u673a\u7684\u601d\u8def\u7684\u8bdd\uff0c\u5c31\u4f1a~~\u542c\u53d6wa\u58f0\u4e00\u7247~~\n\n**\u56e0\u4e3a\u666e\u901a\u7684ac\u81ea\u52a8\u673a\u662f\u4e0d\u53ef\u4ee5\u505a\u76f8\u540c\u5b57\u7b26\u4e32\u7684\uff01\uff01\uff01\uff01**\n\n\u6240\u4ee5\u5728\u6548\u7387\u6ee1\u8db3\u7684\u60c5\u51b5\u4e0b\u4e3a\u4ec0\u4e48\u4e0d\u540ckmp\u5462\u3002\n\n\u4ee3\u7801\u5982\u4e0b\n\n```cpp\n#define ITC_TL\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long int\nll n;\nchar mob[210][1123456];\nint p[4123456];\nvoid pre(char *s,int v){\n\tint h=strlen(s+1);\n\tfor(int i=1,j=0;i<h;i++){\n\t\twhile(j>0&&s[i+1]!=s[j+1]) j=p[j];\n\t\tif(s[i+1]==s[j+1]) ++j;\n\t\tp[i+1]=j;\n\t}\n}\nll kmp(char* b,char* a,int v){\n\tll ans=0,j=0,n1=strlen(a+1),m1=strlen(b+1);\n\tfor(int i=0;i<n1;i++){\n\t\twhile(j>0&&b[j+1]!=a[i+1]) j=p[j];\n\t\tif(b[j+1]==a[i+1]) j++;\n\t\tif(j==m1) ans++,j=p[j];\n\t}\n\treturn ans;\n}\nint main(){\n//\tfreopen(\"word.in\",\"r\",stdin);\n//\tfreopen(\"word.out\",\"w\",stdout);\n\tcin>>n;\n\tfor(int i=1;i<=n;i++) {\t\t\n\t\tscanf(\"%s\",mob[i]+1);\n\t}\n\tll sum1=1;\n\tfor(int i=1;i<=n;i++){\n\t\tsum1=0;\n\t\tpre(mob[i],i);\n\t\tfor(int j=1;j<=n;j++){\n\t//\t\tif(i!=j){\n\t\t\t\tsum1+=kmp(mob[i],mob[j],i);\t\n//\t\t\t}\n\t\t}\n\t\tcout<<sum1<<endl;\n\t}\n}\n```\n",
        "postTime": 1602834257,
        "uid": 242235,
        "name": "ITC_\u5929\u6ce0",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u51fan\u4e2a\u5355\u8bcd\u548cn\u4e2a\u4e0e\u4e4b\u76f8\u540c\u7684\u6a21\u5f0f\u4e32\u8fdb\u884c\u5339\u914d,\n\n\u6c42\u51fa\u5404\u4e2a\u5355\u8bcd\u5339\u914d\u7684\u51fa\u73b0\u6b21\u6570\n\n____________________________________________\n\n\u4ee5\u4e0b\u7ed9\u51fa\u4e24\u79cd\u65b9\u6cd5:\n\n### \u6cd5\u4e00:AC\u81ea\u52a8\u673a\n\n\u65e2\u7136\u662f\u591a\u6a21\u5339\u914d,\u90a3\u4e48\u81ea\u7136\u662f\u7528AC\u81ea\u52a8\u673a\n\n\u6211\u4eec\u53ef\u4ee5\u5728\u5b58\u5404\u4e2a\u5355\u8bcd\u7684\u540c\u65f6\u628a\u5b83\u4eec\u5b58\u5165\u5b57\u5178\u6811\n\n\u7136\u540e\u5c31\u662f\u559c\u95fb\u4e50\u89c1\u7684AC\u81ea\u52a8\u673a\u5339\u914d\u4e86~\n\n\u6ce8\u610f\u53ef\u80fd\u6709\u91cd\u590d,\u6211\u4eec\u5e94\u7528\u4e00\u4e2avector[]\u6307\u5411\u5b57\u5178\u6811\u4e0a\u7684\u8282\u70b9\n\n\u4e8e\u662f\u5f97\u5230\u5982\u4e0b\u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nint n;\nchar s[1000010];\nclass QUEUE{//\u6c42fail\u7528\u7684\u961f\u5217 \n    private:\n    \tint *list;\n\t\tint head,tail,size;\n\tpublic:\n\t\tQUEUE(const int &length){\n\t\t\tsize=length;\n\t\t\tlist=new int[size+1];\n\t\t\thead=tail=0;\n\t\t}\n\t\t~QUEUE(){delete[] list;}\n\t\tinline void push(const int&in){\n\t\t\tlist[tail]=in;\n\t\t\tif(tail==size) tail=0;\n\t\t\telse tail++;\n\t\t}\n\t\tinline void pop(){\n\t\t\tif(head==size) head=0;\n\t\t\telse head++;\n\t\t}\n\t\tinline int top(){return list[head];}\n\t\tinline bool empty(){return head==tail;}\n}; \nclass Trie{\n\tprivate:\n\t\tstruct point{\n\t\t\tunsigned int next[26],fail;\n\t\t\tunsigned int floor,count;\n\t\t}*all;\n\t\tunsigned int *vector,size,p_size;\n\t\tunsigned int *tail;\n\tpublic:\n\t\tTrie(const int&SIZE,const int&P_SIZE){//\u5b57\u5178\u6811\u521d\u59cb\u5316  \n\t\t\tsize=p_size=0;\n\t\t\tall=new point[SIZE+1];\n\t\t\tvector=new unsigned int[P_SIZE+1];\n\t\t\ttail=new unsigned int[SIZE+1];\n\t\t\ttail[0]=0;\n\t\t\tmemset(all,0,sizeof(point)*(SIZE+1));\n\t\t}\n\t\t~Trie(){\n\t\t\tdelete[] all;\n\t\t\tdelete[] vector;\n\t\t\tdelete[] tail;\n\t\t}\n\t\tinline void read(){//\u8f93\u5165\u6a21\u5f0f\u4e32\u5e76\u5b58\u5165\u5b57\u5178\u6811 \n\t\t\tregister int p=0;\n\t\t\tregister int i=tail[p_size]+1; \n\t\t\ts[i]=getchar();//\u540c\u65f6\u8bb0\u5f55\u5f85\u5339\u914d\u4e32 \n\t\t\twhile('a'>s[i]||s[i]>'z') s[i]=getchar();\n\t\t\tfor(;'a'<=s[i]&&s[i]<='z';s[i]=getchar()){\n\t\t\t\ts[i]-='a';\n\t\t\t\tif(all[p].next[s[i]]==0){\n\t\t\t\t\tsize++;\n\t\t\t\t\tall[p].next[s[i]]=size;\n\t\t\t\t\tall[size].floor=all[p].floor+1;\n\t\t\t\t}\n\t\t\t\tp=all[p].next[s[i]];\n\t\t\t\ti++;\n\t\t\t}\n\t\t\tp_size++;\n\t\t\tvector[p_size]=p;//\u8bb0\u5f55\u5404\u4e2a\u5355\u8bcd\u6307\u5411\u7684\u8282\u70b9\n\t\t\ttail[p_size]=tail[p_size-1]+all[p].floor;\n\t\t\t//\u8bb0\u5f55\u5f85\u5339\u914d\u4e32\u672b\u5c3e \n\t\t}\n\t\tinline void getfail(){//\u6c42fail\u6307\u9488 \n\t\t\tQUEUE q(p_size);\n\t\t\tfor(register int i=0;i<26;i++){\n\t\t\t\tif(all[0].next[i]!=0){\n\t\t\t\t\tall[all[0].next[i]].fail=0;\n\t\t\t\t\tq.push(all[0].next[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tregister int p;\n\t\t\twhile(!q.empty()){\n\t\t\t\tp=q.top();\n\t\t\t\tq.pop();\n\t\t\t\tfor(register int i=0,nextfail;i<26;i++){\n\t\t\t\t\tnextfail=all[all[p].fail].next[i];\n\t\t\t\t\tif(all[p].next[i]==0){\n                        all[p].next[i]=nextfail;\n                        continue;\n                    }\n\t\t\t\t\tall[all[p].next[i]].fail=nextfail;\n\t\t\t\t\tq.push(all[p].next[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tinline void AC_auto(){\n\t\t\tfor(register int i=1;i<=p_size;i++){//\u5339\u914d \n                register int p=0;\n\t\t\t\tfor(register int j=tail[i-1]+1;j<=tail[i];j++){\n\t\t\t\t\tp=all[p].next[s[j]];\n\t\t\t\t\tfor(register int k=p;k!=0;){\n                        all[k].count++;\n                        k=all[k].fail;\n                    }\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor(register int i=1;i<=p_size;i++){//\u8f93\u51fa \n\t\t\t\tprintf(\"%d\\n\",all[vector[i]].count);\n\t\t\t}\n\t\t}\n};\nint main(){\n\tscanf(\"%d\",&n);\n\tTrie tree(1e6,n);\n\tfor(register int i=0;i<n;i++) tree.read();\n\ttree.getfail();\n\ttree.AC_auto();\n\treturn 0;\n}\n```\n\n\u5dee\u4e0d\u591a\u4e86,\u4ea4\u5427!\n\n?!(90\u5206,TLE) [\u63d0\u4ea4\u8bb0\u5f55](https://www.luogu.org/record/21974180)\n\n### \u6cd5\u4e8c:AC\u81ea\u52a8\u673a+fail\u6307\u9488\u7edf\u4e00\u5904\u7406\n\n\u6211\u4eec\u7406\u5e94\u9700\u8981\u4e00\u4e9b\u4f18\u5316\n\n[P5357 \u3010\u6a21\u677f\u3011AC\u81ea\u52a8\u673a\uff08\u4e8c\u6b21\u52a0\u5f3a\u7248\uff09](https://www.luogu.org/problem/P5357)\n\n\u5728\u8fd9\u9053\u9898\u4e2d,\u6211\u4eec\u4f7f\u7528\u4e86\u4e00\u79cd\u4f18\u5316\u65b9\u6cd5:\n\n**\u5148\u53ea\u8bb0\u5f55AC\u81ea\u52a8\u673a\u626b\u63cf\u5230\u7684\u4f4d\u7f6e,**\n\n**\u7136\u540e\u5728fail\u6307\u9488\u6811\u4e0a\u9012\u5f52\u7edf\u8ba1\u5339\u914d\u6b21\u6570**\n\n\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u76f8\u540c\u65b9\u6cd5,\u800c\u4e14\n\n**\u7531\u4e8e\u6a21\u5f0f\u4e32\u4e0e\u5f85\u5339\u914d\u7684\u4e32\u76f8\u540c,**\n\n**\u6211\u4eec\u53ef\u4ee5\u5728\u5b58\u5165\u5b57\u5178\u6811\u7684\u540c\u65f6\u8bb0\u5f55\u626b\u63cf\u4f4d\u7f6e,\u800c\u4e0d\u7528\u989d\u5916\u8fdb\u884c\u5339\u914d**\n\n(\u8fd9\u6837\u4e5f\u7701\u53bb\u4e86\u989d\u5916\u5b58\u50a8\u5f85\u5339\u914d\u4e32\u7684\u9ebb\u70e6)\n\n**\u6cd5\u4e8cAC\u4ee3\u7801(\u4e0d\u5f00O2,731ms,118.15MB)**\n\n```cpp\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nint n;\nclass QUEUE{//\u6c42fail\u7528\u7684\u961f\u5217 \n    private:\n\t\tint *list;\n\t\tint head,tail,size;\n\tpublic:\n\t\tQUEUE(const int &length){\n\t\t\tsize=length;\n\t\t\tlist=new int[size+1];\n\t\t\thead=tail=0;\n\t\t}\n\t\t~QUEUE(){delete[] list;}\n\t\tinline void push(const int&in){\n\t\t\tlist[tail]=in;\n\t\t\tif(tail==size) tail=0;\n\t\t\telse tail++;\n\t\t}\n\t\tinline void pop(){\n\t\t\tif(head==size) head=0;\n\t\t\telse head++;\n\t\t}\n\t\tinline int top(){return list[head];}\n\t\tinline bool empty(){return head==tail;}\n}; \nclass Trie{\n\tprivate:\n\t\tstruct point{\n\t\t\tunsigned int next[26],fail;\n\t\t\tunsigned int floor,count;\n\t\t}*all;\n\t\tunsigned int *vector,size,p_size;\n\t\tunsigned int *head,*tail,*next;\n\t\tinline void dfs_count(int id){//\u9012\u5f52\u7edf\u8ba1\u5339\u914d\u6b21\u6570 \n\t\t\tfor(register int i=head[id];i!=0;i=next[i]){\n\t\t\t\tdfs_count(i);\n\t\t\t\tall[id].count+=all[i].count;\n\t\t\t}\n\t\t}\n\tpublic:\n\t\tTrie(const int&SIZE,const int&P_SIZE){//\u5b57\u5178\u6811\u521d\u59cb\u5316  \n\t\t\tsize=p_size=0;\n\t\t\tall=new point[SIZE+1];\n\t\t\tvector=new unsigned int[P_SIZE+1];\n\t\t\thead=new unsigned int[SIZE+1];\n\t\t\ttail=new unsigned int[SIZE+1];\n\t\t\tnext=new unsigned int[SIZE+1];\n\t\t\tmemset(all,0,sizeof(point)*(SIZE+1));\n\t\t\tmemset(head,0,(SIZE+1)<<2);\n\t\t}\n\t\t~Trie(){\n\t\t\tdelete[] all;\n\t\t\tdelete[] vector;\n\t\t\tdelete[] head;\n\t\t\tdelete[] tail;\n\t\t\tdelete[] next;\n\t\t}\n\t\tinline void read(){//\u8f93\u5165\u6a21\u5f0f\u4e32\u5e76\u5b58\u5165\u5b57\u5178\u6811 \n\t\t\tregister int p=0;\n\t\t\tregister char c=getchar();\n\t\t\twhile('a'>c||c>'z') c=getchar();\n\t\t\tfor(;'a'<=c&&c<='z';c=getchar()){\n\t\t\t\tc-='a';\n\t\t\t\tif(all[p].next[c]==0){\n\t\t\t\t\tsize++;\n\t\t\t\t\tall[p].next[c]=size;\n\t\t\t\t\tall[size].floor=all[p].floor+1;\n\t\t\t\t}\n\t\t\t\tp=all[p].next[c];\n\t\t\t\tall[p].count++;//\u540c\u65f6\u8bb0\u5f55\u626b\u63cf\u4f4d\u7f6e  \n\t\t\t}\n\t\t\tp_size++;\n\t\t\tvector[p_size]=p;//\u8bb0\u5f55\u5404\u4e2a\u5355\u8bcd\u6307\u5411\u7684\u8282\u70b9  \n\t\t}\n\t\tinline void getfail(){//\u6c42fail\u6307\u9488 \n\t\t\tQUEUE q(p_size);\n\t\t\tfor(register int i=0;i<26;i++){\n\t\t\t\tif(all[0].next[i]!=0){\n\t\t\t\t\tall[all[0].next[i]].fail=0;\n\t\t\t\t\t\n\t\t\t\t\tif(head[0]==0) head[0]=all[0].next[i];\n\t\t\t\t\telse next[tail[0]]=all[0].next[i];\n\t\t\t\t\ttail[0]=all[0].next[i];\n\t\t\t\t\tnext[all[0].next[i]]=0;\n\t\t\t\t\t//\u540c\u65f6\u7528\u90bb\u63a5\u8868\u8bb0\u5f55fail\u6811\u7684\u513f\u5b50\u8282\u70b9 \n\t\t\t\t\tq.push(all[0].next[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tregister int p;\n\t\t\twhile(!q.empty()){\n\t\t\t\tp=q.top();\n\t\t\t\tq.pop();\n\t\t\t\tfor(register int i=0,nextfail;i<26;i++){\n\t\t\t\t\tnextfail=all[all[p].fail].next[i];\n\t\t\t\t\tif(all[p].next[i]==0){\n                        all[p].next[i]=nextfail;\n                        continue;\n                    }\n\t\t\t\t\tall[all[p].next[i]].fail=nextfail;\n\t\t\t\t\t\t\n\t\t\t\t\tif(head[nextfail]==0)\n\t\t\t\t\t\thead[nextfail]=all[p].next[i];\n\t\t\t\t\telse next[tail[nextfail]]=all[p].next[i];\n\t\t\t\t\ttail[nextfail]=all[p].next[i];\n\t\t\t\t\tnext[all[p].next[i]]=0;\n\t\t\t\t\t//\u540c\u4e0a \n\t\t\t\t\tq.push(all[p].next[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tinline void AC_auto(){\n\t\t\tdfs_count(0);\n\t\t\tfor(register int i=1;i<=p_size;i++){//\u8f93\u51fa \n\t\t\t\tprintf(\"%d\\n\",all[vector[i]].count);\n\t\t\t}\n\t\t}\n};\nint main(){\n\tscanf(\"%d\",&n);\n\tTrie tree(1e6,n);\n\tfor(register int i=0;i<n;i++) tree.read();\n\ttree.getfail();\n\ttree.AC_auto();\n\treturn 0;\n}\n```",
        "postTime": 1564651886,
        "uid": 104726,
        "name": "wangrx",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u4e4d\u4e00\u770b\uff0c\u8fd9\u662f\u4e00\u9053AC\u81ea\u52a8\u673a\u7684\u677f\u5b50\u9898\uff0c\u53ea\u8981\u628aAC\u81ea\u52a8\u673a\u5efa\u597d\uff0c\u518d\u6765\u5339\u914d\u5c31\u597d\u4e86\n\n\u7136\u540e\uff0c\u4f60\u5c31WA\u4e86\u3002\u3002\u3002\n\n\u4e3a\u4ec0\u4e48\u5462\uff1f\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5b83\u7684\u8f93\u5165\u5355\u8bcd\u91cc\u662f\u4f1a\u6709\u76f8\u540c\u7684\u5355\u8bcd\u7684\uff0c\u6240\u4ee5\u5f53\u6210\u677f\u5b50\u9898\u6765\u505a\u7684\u8bdd\uff0c\u5c31\u4f1a\u7531\u4e8e\u5efatire\u6811\u7684\u8986\u76d6\u800c\u5bfc\u81f4\u7b54\u6848\u51fa\u9519\uff0c\u90a3\u4e48\u600e\u4e48\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f\n\n\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2asame\u6570\u7ec4\uff0cend\u6570\u7ec4\u53ea\u8bb0\u5f55\u6700\u65e9\u7684\u7f16\u53f7\uff0c\u6bcf\u6b21\u5982\u679c\u8981\u8986\u76d6\uff0c\u4fbf\u628a\u4ee4\u8be5\u8282\u70b9\u7684same\u503c\u4e3a\u8fd9\u4e2a\u4f4d\u7f6e\u4e0a\u7684end\u7684\u503c\uff0c\u67e5\u8be2\u65f6\u6bcf\u4e2a\u90fd\u67e5\u8be2\u4e00\u904d\uff0c\u8f93\u51fa\u7b54\u6848\u5c31\u8f93\u51faans[same[i]]\n\n\u4f60\u5174\u51b2\u51b2\u7684\u7801\u5b8c\u4e4b\u540e\uff0c\u63d0\u4ea4\uff0c\u672c\u4ee5\u4e3a\u80fd\u591fAC\uff0c\u7ed3\u679c\uff0c\u5728\u4f60A\u4e869\u4e2a\u70b9\u4e4b\u540e\uff0cTLE\u3002\u3002\u3002\n\n\u600e\u4e48\u529e\u5462\uff1f\n\n\u65e2\u7136\u6709\u91cd\u590d\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u663e\u7136\u4e0d\u9700\u8981\u628a\u6bcf\u4e2a\u90fd\u626b\u4e00\u904d\uff0c\u800c\u662f\u53ea\u626b\u4e00\u6b21\uff0c\u518d\u901a\u8fc7\u73b0\u6709\u7684\u7b54\u6848\u6765\u5f97\u51fa\u6b63\u786e\u7b54\u6848\uff0c\u6211\u4eec\u53ea\u9700\u8981\u89e3\u51b3\u5982\u4f55\u626b\u63cf\u4e00\u6b21\u540e\u7684\u7b54\u6848\u6765\u5f97\u51fa\u6b63\u786e\u7b54\u6848\u5c31\u53ef\u4ee5\u4e86\n\n\u5b9a\u4e49\u4e24\u4e2a\u6570\u7ec4\uff0capr\u548cvis\uff0capr\u8bb0\u5f55\u5728AC\u81ea\u52a8\u673a\u4e0a\u6bcf\u4e00\u4e2a\u8282\u70b9\u88ab\u8986\u76d6\u7684\u6b21\u6570\uff0cvis\u8bb0\u5f55\u5f53\u524d\u8282\u70b9\u5728\u7edf\u8ba1\u7b54\u6848\u65f6\u6709\u6ca1\u6709\u88ab\u626b\u8fc7\u3002\n\n\u5728\u7edf\u8ba1\u7b54\u6848\u65f6\uff0c\u82e5\u5f53\u524d\u8282\u70b9\u662f\u67d0\u4e2a\u5355\u8bcd\u7684\u672b\u5c3e\u4e14\u6ca1\u6709\u88ab\u626b\u8fc7\uff0c\u8bf4\u660e\u5b83\u80fd\u591f\u4e3a\u8be5\u5355\u8bcd\u6709\u8d21\u732e\uff0c\u5c31\u5c06\u8be5\u5355\u8bcd\u7684\u7b54\u6848\u52a0\u4e0aapr[now]\u3002\u6bcf\u6b21\u626b\u5230AC\u81ea\u52a8\u673a\u4e0a\u7684\u4e00\u4e2a\u8282\u70b9\uff0c\u5c31\u628a\u5b83\u7684vis\u6807\u8bb0\u53d8\u62101\uff0c\u8fd9\u6837\u5b50\u5c31\u80fd\u5f97\u51fa\u6b63\u786e\u7b54\u6848\u4e86\uff0c\u8be6\u89c1\u4ee3\u7801\u3002\n\n#### **Code:**\n```\n#include<bits/stdc++.h>\n#define N 100001\nusing namespace std;\nint n,cnt,Len,ans[201];\nchar ch[201][N];\nnamespace AC_Automaton{\n    queue<int> q;\n    int same[N],apr[N*27],vis[N*27];\n    int trie[N*27][26],ed[N*27],fail[N*27];\n    void ins(int x){\n        int now=0,len=strlen(ch[x]+1);\n        for(int i=1;i<=len;i++){\n            int num=ch[x][i]-'a';\n            if(!trie[now][num]) trie[now][num]=++cnt;\n            now=trie[now][num];apr[now]++;\n        }\n        if(ed[now]) same[x]=ed[now];\n        else ed[now]=x;\n    }\n    void makefail(){\n        for(int i=0;i<26;i++)\n            if(trie[0][i]) q.push(trie[0][i]);\n        while(!q.empty()){\n            int x=q.front();q.pop();\n            for(int i=0;i<26;i++)\n                if(trie[x][i]) fail[trie[x][i]]=trie[fail[x]][i],q.push(trie[x][i]);\n                else trie[x][i]=trie[fail[x]][i];\n        }\n    }\n    void query(char *s){\n        int now=0,len=strlen(s+1);\n        for(int i=1;i<=len;i++){\n            int num=s[i]-'a';\n            now=trie[now][num];\n            for(int j=now;j;j=fail[j])\n                if(ed[j]&&!vis[now]) ans[ed[j]]+=apr[now];\n            vis[now]=1;\n        }\n    }\n}\nint main(){\n    scanf(\"%d\",&n);  \n    using namespace AC_Automaton; \n    for(int i=1;i<=n;i++){\n        scanf(\"%s\",ch[i]+1);\n        ins(i);\n    }\n    makefail();\n    for(int i=1;i<=n;i++)\n        if(!same[i]) query(ch[i]);\n    for(int i=1;i<=n;i++)\n       if(!same[i]) printf(\"%d\\n\",ans[i]);\n       else printf(\"%d\\n\",ans[same[i]]);\n    return 0;\n}\n```",
        "postTime": 1547183421,
        "uid": 73702,
        "name": "DQYdqy",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u770b\u7740\u8fd9\u9053\u9898\u7b2c\u4e00\u611f\u89c9\uff0c\u597d\u50cffind\u53ef\u4ee5\u8fc7\n\n\u9ed8\u9ed8\u82b120\u5206\u949f\u5199\u51fa\u6765\uff0cAC\n\nfind\u5927\u6cd5\u597d\n\nfind\u7528\u6cd5\u89c1[find](https://www.cnblogs.com/zpcdbky/p/4471454.html)\n\n\u8bdd\u4e0d\u591a\u8bf4\uff0c\u8d34\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n;\nstring st[205];\nint read()\n{\n    int X=0,w=0; char ch=0;\n    while(!isdigit(ch)) {w|=ch=='-';ch=getchar();}\n    while(isdigit(ch)) X=(X<<3)+(X<<1)+(ch^48),ch=getchar();\n    return w?-X:X;\n}\nvoid write(int x)\n{\n     if(x<0) putchar('-'),x=-x;\n     if(x>9) write(x/10);\n     putchar(x%10+'0');\n}\nint main(){\n\tn=read();\n\tfor(int i=1;i<=n;i++)\n\t\tcin>>st[i];\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint ans=0;\n\t\tfor(int j=1;j<=n;j++)\n\t\t{\n\t\t\tint k=0,l=st[j].find(st[i],k);\n\t\t\twhile(l!=-1)\n\t\t\t{\n\t\t\t\tk=l+1;\n\t\t\t\tl=st[j].find(st[i],k); \n\t\t\t\tans++;\n\t\t\t}\n\t\t}\n\t\twrite(ans);\n\t\tputchar('\\n');\n\t}\n\treturn 0;\n}\n\n```\n\n\u7a81\u7136\u53d1\u73b0\u6211\u5e38\u6570\u5199\u5f97\u771f\u7684\u5f88\u5c0f\n\n[AC\u8bb0\u5f55](https://www.luogu.org/record/show?rid=14774441)",
        "postTime": 1545055362,
        "uid": 75108,
        "name": "\u6708\u304c\u304d\u308c\u3044",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u849f\u84bb\u4e5f\u80fd\u5199\u51fa\u6765\u7684[AC\u4ee3\u7801](http://www.cnblogs.com/poorpool/p/7997731.html)\uff01\u8fd9\u9898\u662fAC\u81ea\u52a8\u673a\u6a21\u677f\u9898\u3002\u63d2\u5165\u5355\u8bcd\u65f6\u7528\u4e00\u4e2a\u6ca1\u51fa\u73b0\u8fc7\u7684\u5b57\u7b26\u9694\u5f00\u5c31\u884c\u4e86\u3002\n\n\n\u4e00\u4e9b\u7ec6\u8282\u8bf7\u770b\u6ce8\u91ca\n\n\n300ms\uff0c\u6548\u7387\u4e00\u822c\u5427\n\n\n```cpp\n#include <iostream>\n#include <cstring>\n#include <cstdio>\n#include <queue>\nusing namespace std;\nchar a[1000005], b[1000205];//b\u6570\u7ec4\u8981\u5f00\u8fd9\u4e48\u5927\uff0c\u56e0\u4e3a\u8981\u5728\u6240\u6709\u5355\u8bcd\u62fc\u8d77\u6765\u4e4b\u5916\u518d\u52a0n\u4e2a#\u53f7\nint n, len, mp[205], all, cnt[205];\nqueue<int> d;\nstruct ACzdj{\n    int siz, s[1000005][26], val[1000005], lst[1000005], fai[1000005];\n    int u, v;\n    void ins(int k){\n        u = 0;\n        len = strlen(a);\n        for(int i=0; i<len; i++)\n            b[all+i] = a[i];\n        all += len;\n        b[all++] = '#';\n        for(int i=0; i<len; i++){\n            v = a[i] - 'a';\n            if(!s[u][v])    s[u][v] = ++siz;\n            u = s[u][v];\n        }\n        if(!val[u])    val[u] = k;\n        mp[k] = val[u];//mp[k]\u8bb0\u5f55\u7684\u662f\u4e0e\u7b2ck\u53f7\u5355\u8bcd\u76f8\u540c\u7684\u5355\u8bcd\u7684\u6700\u5c0f\u7f16\u53f7\uff0c\u8fd9\u6837\u53ef\u4ee5\u89e3\u51b3\u91cd\u590d\u5355\u8bcd\u3002\n    }\n    void getFail(){\n        for(int i=0; i<26; i++)\n            if(s[0][i])\n                d.push(s[0][i]);\n        while(!d.empty()){\n            u = d.front();\n            d.pop();\n            for(int i=0; i<26; i++){\n                v = s[u][i];\n                if(v){\n                    fai[v] = s[fai[u]][i];\n                    lst[v] = val[fai[v]]?fai[v]:lst[fai[v]];\n                    d.push(v);\n                }\n                else    s[u][i] = s[fai[u]][i];\n            }\n        }\n    }\n    void query(){\n        u = 0;\n        for(int i=0; i<all; i++){\n            if(b[i]=='#'){\n                u = 0;//\u8bb0\u5f97\u7f6e\u96f6\n                continue;\n            }\n            u = s[u][b[i]-'a'];\n            if(val[u])    cnt[val[u]]++;\n            v = lst[u];\n            while(v){\n                cnt[val[v]]++;\n                v = lst[v];\n            }\n        }\n        for(int i=1; i<=n; i++)\n            printf(\"%d\\n\", cnt[mp[i]]);\n    }\n}ac;\nint main(){\n    cin>>n;\n    for(int i=1; i<=n; i++)\n        scanf(\"%s\", a), ac.ins(i);\n    ac.getFail();\n    ac.query();\n    return 0;\n}\n```",
        "postTime": 1512612530,
        "uid": 44733,
        "name": "poorpool",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "**\u57fa\u672c\u7684Hash**\n\n\u4e3b\u8981\u601d\u8def\u662fHash+\u524d\u7f00\u548c(\u53c2\u8003CQOI2014 \u901a\u914d\u7b26\u5339\u914d)\u3002\u5f53\u7136\uff0c\u7a7a\u95f4\u5f00\u7684\u975e\u5e38\u53cb\u597d\n\n\u628a\u6240\u6709\u7684\u5355\u8bcd\u7c98\u5728\u4e00\u8d77\uff0c\u4e2d\u95f4\u7528\u7279\u6b8a\u7b26\u53f7\uff08\u4f8b\u5982#\uff09\u9694\u5f00\uff0c\u7136\u540e$O(n*len)$Hash\u5224\u4e00\u904d\u662f\u5426\u51fa\u73b0\u5373\u53ef\u3002\n\n\u53cb\u60c5\u63d0\u793a\uff1a\u6700\u540e\u4e00\u4e2a\u70b9\u8bf7\u6ce8\u610f\u8fb9\u754c\u95ee\u9898TaT\n\n\u6076\u5fc3\u7684Code\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdlib>\n#include <cstdio>\n#include <cstring>\n#define f(x,y,z) for(int x=y;x<=z;x++)\n#define F(x,y,z,v) for(int x=y;x<=z;x+=v)\nusing namespace std;\nconst int MAXN=1000005;\nchar a[205][MAXN],b[MAXN<<1];\nunsigned long long hash1[205],hash2[MAXN<<1],divi[MAXN<<1];\nint stl[205];\nconst int BASE=131;\nunsigned long long getsum(int l,int r)\n{\n\treturn hash2[r]-hash2[l-1]*divi[r-l+1];\n}\nint main()\n{\n\tint n;\n\tscanf(\"%d\",&n);\n\tint cnt=-1,len;\n\tf(i,1,n)\n\t{\n\t\tb[++cnt]='#';\n\t\tscanf(\"%s\",&a[i]);\n\t\tlen=strlen(a[i]);\n\t\tstl[i]=len;\n\t\tf(j,0,len-1)\n\t\t{\n\t\t\tb[++cnt]=a[i][j];\n\t\t\thash1[i]*=BASE;\n\t\t\thash1[i]+=a[i][j];\n\t\t}\n\t}\n\tlen=strlen(b);\n\thash2[0]=b[0];\n\tdivi[0]=1;\n\tf(i,1,len-1)\n\t{\n\t\thash2[i]=hash2[i-1]*BASE+b[i];\n\t\tdivi[i]=divi[i-1]*BASE;\n\t}\n\tf(i,1,n)\n\t{\n\t\tint tcnt=0;\n\t\tf(j,1,len-stl[i])\n\t\t\tif(hash1[i]==getsum(j,j+stl[i]-1))\n\t\t\t\ttcnt++;\n\t\tprintf(\"%d\\n\",tcnt);\n\t}\n\treturn 0;\n}\n//\u9632\u53c9\u7528\u7684\u81ea\u7136\u6ea2\u51fa\n```",
        "postTime": 1521025961,
        "uid": 52587,
        "name": "\u6226\u8266\u306f\u308b\u306a",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u81ea\u5df1xjb YY\u4e86\u4e00\u4e2a\u505a\u6cd5\u5c45\u71361Ahhh\n\n\u9996\u5148\u5e94\u8be5\u4e00\u773c\u5c31\u80fd\u770b\u51fa\u662fAC\u81ea\u52a8\u673a\u53ef\u4ee5\u641e\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5148\u628a\u6240\u6709\u4e32\u7684AC\u81ea\u52a8\u673a\u641e\u51fa\u6765\uff0c\u7136\u540e\u8bb0\u5f55\u4e0b\u4ed6\u4eec\u62fc\u8d77\u6765\u7684\u4e32\uff0c\u7528\u968f\u4fbf\u4e00\u4e2a\u5b57\u7b26\u5206\u9694\n\n\u66b4\u529b\u679a\u4e3e\u6bcf\u4e00\u4e2a\u4e32\uff0c\u628a\u7ecf\u8fc7\u7684\u8def\u5f84\u4e0a\u7684\u6743\u503c$+1$\uff0c\u8868\u793a\u8be5\u4f4d\u7f6e\u4ee3\u8868\u7684\u4e32\u53c8\u591a\u51fa\u73b0\u4e86\u4e00\u6b21\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u7edf\u8ba1\u51fa\u4e86\u4e0e\u5b83\u4e00\u6a21\u4e00\u6837\u7684\u4e32\u7684\u51fa\u73b0\u6b21\u6570\u3002\n\n\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\uff0c\u5373\u5f53\u5b83\u4f5c\u4e3a\u67d0\u4e9b\u4e32\u7684\u540e\u7f00\u51fa\u73b0\u3002\n\n\u6b64\u65f6\uff0c\u6839\u636eAC\u81ea\u52a8\u673a\u7684\u6027\u8d28\u4e0d\u96be\u53d1\u73b0\uff0c\u6211\u4eec\u8981\u6c42\u7684\u7b54\u6848\u5373\u4e3a\u8be5\u8282\u70b9\u5728$fail$\u6811\u4e0a\u5b50\u6811\u7684\u548c\n\n\u7136\u540e\u76f4\u63a5\u66b4\u529b\u628a$fail$\u6811\u5efa\u51fa\u6765\uff0c\u6811\u5f62DP\u7edf\u8ba1\u7b54\u6848\u5373\u53ef\n\n~~\u5c31\u662f\u8dd1\u7684\u6709\u70b9\u6162~~\n\n```cpp\n// luogu-judger-enable-o2\n// luogu-judger-enable-o2\n#include<cstdio>\n#include<cstring>\n#include<queue>\nusing namespace std;\nconst int MAXN = 1e6 + 100, B = 28;\nint T;\nchar s[MAXN], a[MAXN];\nint fail[MAXN], ch[MAXN][28], val[MAXN], tot = 0, root = 0;\nvoid insert(char *s) {\n    int N = strlen(s + 1);\n    int now = root;\n    for(int i = 1; i <= N; i++) {\n        int x = s[i] - 'a';\n        if(!ch[now][x]) ch[now][x] = ++tot;\n        now = ch[now][x];\n        val[now]++;\n    }\n}   \nvector<int> v[MAXN];\nvoid GetFail() {\n    queue<int> q; \n    for(int i = 0; i < B; i++) if(ch[root][i]) q.push(ch[root][i]);\n    while(!q.empty()) {\n        int p = q.front(); q.pop();\n        for(int i = 0; i < B; i++) {\n            if(ch[p][i]) fail[ch[p][i]] = ch[fail[p]][i], q.push(ch[p][i]);\n            else ch[p][i] = ch[fail[p]][i];\n        }\n        v[fail[p]].push_back(p);\n    }\n}\nvoid GetVal(int x) {\n    for(int i = 0; i < v[x].size(); i++)\n        GetVal(v[x][i]), val[x] += val[v[x][i]];\n}\nvoid GetAns(char *s) {\n    int N = strlen(s + 1), now = root, ans = 0;\n    for(int i = 1; i <= N; i++) {\n        int x = s[i] - 'a';\n        if(x == 26) printf(\"%d\\n\", val[now]), now = root, ans = 0;\n        now = ch[now][x];\n    }\n    printf(\"%d\", val[now]);\n}\nint main() {\n    //freopen(\"a.in\", \"r\", stdin); \n    scanf(\"%d\", &T);\n    for(int i = 1; i <= T; i++) {\n        scanf(\"%s\", s + 1);\n        insert(s);\n        s[0] = 'z' + 1;\n        strcat(a, s);\n    }\n    GetFail();\n    GetVal(0);\n    GetAns(a); \n    return 0;\n}\n```",
        "postTime": 1530270398,
        "uid": 36984,
        "name": "attack",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u590d\u4e60\u4e00\u4e0b\u6628\u5929\u7684\u4e8c\u5206\u67e5\u627e\uff0c\u4f46\u662f\u590d\u6742\u5ea6\u611f\u89c9\u662f\u7384\u5b66\uff0c\u8fd8\u4e0d\u5982\u66b4\u529b\u8dd1\u5f97\u5feb\n\n\u5c31\u662f\u627e\u5230\u6700\u957f\u7684\u6ee1\u8db3\u533a\u95f4\u5185height\u90fd\u5927\u4e8e\u7b49\u4e8eLen \u6c42\u8fd9\u4e2a\u6700\u5927\u957f\u5ea6\uff0c\u5206\u522b\u5728\u5de6\u53f3\u4e8c\u5206\u5c31\u53ef\u4ee5\u4e86\n\n\u628a\u6240\u6709\u5355\u8bcd\u8fde\u5728\u4e00\u8d77\uff0cSA\u6c42\u51fah\u6570\u7ec4\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5355\u8bcd\u770b\u505a\u4e00\u4e2a\u8be2\u95ee\uff0c\u66b4\u529b\u5f80\u524d\u5f80\u540e\u626b\uff0c\u770b\u6709\u51e0\u4e2a\u66b4\u529b\u7edf\u8ba1\u5373\u53ef\n\n(http://www.elijahqi.win/2017/08/26/bzoj3473/)\n\nnlogn 2628 ms\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#define N 1100000\n#define N1 220\nint n,n1,a[N],m,k,rank[N<<1],rank1[N],sa[N],count[N],tmp[N],height[N],Log[N],fmin[N][20];\nchar str1[N];\nstruct node{\n    int st,len;\n}data[N1];\ninline int min(int x,int y){return x<y?x:y;}\ninline int lcp(int x,int y){\n    x++;int t=Log[y-x+1];\n    return min(fmin[x][t],fmin[y-(1<<t)+1][t]);\n}\nvoid check(int st,int len){\n    int l1,r1;\n    if (height[st]<len) l1=st;else{\n        int l=1,r=st-1;\n        while (l<=r){\n            int mid=(l+r)>>1;\n            if(lcp(mid,st)>=len) r=mid-1;else l=mid+1;\n        }\n        l1=l;\n    }\n    if (height[st+1]<len) r1=st;else{\n        int l=st+1,r=n;\n        while (l<=r){\n            int mid=(l+r)>>1;\n            if (lcp(st,mid)>=len) l=mid+1;else r=mid-1;\n        }\n        r1=r;\n    }\n    printf(\"%d\\n\",r1-l1+1);\n}\nint main(){\n    freopen(\"bzoj3172.in\",\"r\",stdin);\n    scanf(\"%d\",&n1);n=1;m=30;\n    for (int i=1;i<=n1;++i) {\n        scanf(\"%s\",str1);int nn=strlen(str1);data[i].len=nn;data[i].st=n;\n        for (int j=0;j<nn;++j) a[n+j]=str1[j]-'a'+1;n+=nn;a[n++]=m++;\n    }n-=1;\n    //for (int i=1;i<=n;++i) printf(\"%d \",a[i]);\n    //for (int i=1;i<=n1;++i) printf(\"%d %d\\n\",data[i].st,data[i].len);\n    for (int i=1;i<=n;++i) count[a[i]]=1;\n    for (int i=1;i<=255;++i) count[i]+=count[i-1];\n    for (int i=1;i<=n;++i) rank[i]=count[a[i]];\n    k=0;\n    for (int p=1;k!=n;p<<=1,m=k){\n        for (int i=1;i<=m;++i) count[i]=0;\n        for (int i=1;i<=n;++i) count[rank[i+p]]++;\n        for (int i=1;i<=m;++i) count[i]+=count[i-1];\n        for (int i=n;i>=1;--i) tmp[count[rank[i+p]]--]=i;\n        for (int i=1;i<=m;++i) count[i]=0;\n        for (int i=1;i<=n;++i) count[rank[i]]++;\n        for (int i=1;i<=m;++i) count[i]+=count[i-1];\n        for (int i=n;i>=1;--i) sa[count[rank[tmp[i]]]--]=tmp[i];\n        memcpy(rank1,rank,sizeof(rank)>>1);\n        rank[sa[1]]=k=1;\n        for (int i=2;i<=n;++i){\n            if (rank1[sa[i]]!=rank1[sa[i-1]]||rank1[sa[i-1]+p]!=rank1[sa[i]+p]) ++k;\n            rank[sa[i]]=k;\n        }\n    }\n//    for (int i=1;i<=n;++i) printf(\"%d \",rank[i]);\n    k=0;\n    for (int i=1;i<=n;++i){\n        if (rank[i]==1) continue;\n        k=k==0?0:k-1;\n        while (a[i+k]==a[sa[rank[i]-1]+k]) ++k;\n        height[rank[i]]=k;\n    }    \n    //for (int i=1;i<=n;++i) printf(\"%d \",height[i]);\n    Log[0]=-1;\n    for (int i=1;i<=n;++i) Log[i]=Log[i>>1]+1;\n    for (int i=1;i<=n;++i) fmin[i][0]=height[i];\n    for (int j=1;j<=Log[n];++j){\n        for (int i=1;i<=n-(1<<j)+1;++i){\n            fmin[i][j]=min(fmin[i][j-1],fmin[i+(1<<(j-1))][j-1]);\n        }\n    }\n    for (int i=1;i<=n1;++i)\n        check(rank[data[i].st],data[i].len);\n    return 0;\n}\n```\n\u66b4\u529b\n1384 ms\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#define N 1100000\n#define N1 220\nint n,n1,a[N],m,k,rank[N<<1],rank1[N],sa[N],count[N],tmp[N],height[N];\nchar str1[N];\nstruct node{\n    int st,len;\n}data[N1];\nint main(){\n    freopen(\"bzoj3172.in\",\"r\",stdin);\n    scanf(\"%d\",&n1);n=1;m=30;\n    for (int i=1;i<=n1;++i) {\n        scanf(\"%s\",str1);int nn=strlen(str1);data[i].len=nn;data[i].st=n;\n        for (int j=0;j<nn;++j) a[n+j]=str1[j]-'a'+1;n+=nn;a[n++]=m++;\n    }n-=1;\n    //for (int i=1;i<=n;++i) printf(\"%d \",a[i]);\n    //for (int i=1;i<=n1;++i) printf(\"%d %d\\n\",data[i].st,data[i].len);\n    for (int i=1;i<=n;++i) count[a[i]]=1;\n    for (int i=1;i<=255;++i) count[i]+=count[i-1];\n    for (int i=1;i<=n;++i) rank[i]=count[a[i]];\n    k=0;\n    for (int p=1;k!=n;p<<=1,m=k){\n        for (int i=1;i<=m;++i) count[i]=0;\n        for (int i=1;i<=n;++i) count[rank[i+p]]++;\n        for (int i=1;i<=m;++i) count[i]+=count[i-1];\n        for (int i=n;i>=1;--i) tmp[count[rank[i+p]]--]=i;\n        for (int i=1;i<=m;++i) count[i]=0;\n        for (int i=1;i<=n;++i) count[rank[i]]++;\n        for (int i=1;i<=m;++i) count[i]+=count[i-1];\n        for (int i=n;i>=1;--i) sa[count[rank[tmp[i]]]--]=tmp[i];\n        memcpy(rank1,rank,sizeof(rank)>>1);\n        rank[sa[1]]=k=1;\n        for (int i=2;i<=n;++i){\n            if (rank1[sa[i]]!=rank1[sa[i-1]]||rank1[sa[i-1]+p]!=rank1[sa[i]+p]) ++k;\n            rank[sa[i]]=k;\n        }\n    }\n//    for (int i=1;i<=n;++i) printf(\"%d \",rank[i]);\n    k=0;\n    for (int i=1;i<=n;++i){\n        if (rank[i]==1) continue;\n        k=k==0?0:k-1;\n        while (a[i+k]==a[sa[rank[i]-1]+k]) ++k;\n        height[rank[i]]=k;\n    }    \n    //for (int i=1;i<=n;++i) printf(\"%d \",height[i]);\n\n    for(int i=1;i<=n1;++i){\n        int x=rank[data[i].st];\n        int l=x,r=x+1;\n        while(height[l]>=data[i].len) --l;\n        while(height[r]>=data[i].len) ++r;--r;\n        printf(\"%d\\n\",r-l+1);\n    }\n    return 0;\n}\n```",
        "postTime": 1510963316,
        "uid": 5037,
        "name": "elijahqi",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u5e94\u8be5\u662f\u540e\u7f00\u6570\u7ec4\u7684\u5957\u8def\u9898\u554a\uff0c\u628a\u5355\u8bcd\u8fde\u63a5\u8d77\u6765\uff0c\u4e2d\u95f4\u7528\u6ca1\u6709\u51fa\u73b0\u8fc7\u4e14\u4e92\u4e0d\u76f8\u540c\u7684\u5b57\u7b26\u6765\u5206\u9694\u5f00\uff0c\u6c42\u4e00\u4e0b$height$\u6570\u7ec4\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u5355\u8bcd\u6765\u8bf4\uff0c\u8bbe\u5355\u8bcd\u957f$len$\uff0c\u6240\u5728\u7684\u540e\u7f00\u4e3a$i$\uff0c\u5982\u679c\u67d0\u540e\u7f00$j$\u6ee1\u8db3$lcp(i,j)==len$\uff0c\u5219$j$\u7684\u524d\u7f00\u4e0e\u8fd9\u4e2a\u5355\u8bcd\u76f8\u7b49\u3002\u56e0\u4e3a\u548c$i$\u7684$lcp$\u5927\u5c0f\u662f\u4ece$i$\u5411\u4e24\u8fb9\u9012\u51cf\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u5206\u522b\u4ece\u540e\u5f80\u524d\uff0c\u4ece\u524d\u5f80\u540e\u4e24\u904d\u5355\u8c03\u6808\u627e\u51fa\u5de6\u53f3\u6700\u8fdc\u80fd\u6ee1\u8db3\u6761\u4ef6\u7684\u540e\u7f00$l,r$\uff0c\u533a\u95f4\u5927\u5c0f$l-r+1$\u5c31\u662f\u603b\u6570\n\n\u5410\u69fd\u4e00\u4e0b\u8fd9\u9898\u6211\u5f00\u59cb\u4ea4\u4e86\u4e24\u904dR\u70b8\u4e86\uff0c\u539f\u56e0\u7adf\u662f\u52a0\u5206\u9694\u7b26\u7684\u65f6\u5019\u52a0\u5165\u4e86\u4e00\u4e9b\u5947\u602a\u7684\u5b57\u7b26...\uff0c\u628a$s$\u6539\u6210$int$\u5c31\u597d\u4e86...\n\n[\u5b89\u5229\u4e00\u4e0bblog](https://www.cnblogs.com/nianheng/)\n\n```cpp\n#include<map>\n#include<cmath>\n#include<queue>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\nconst int maxn=2e6+100;\nstruct SA{\n    int sa[maxn],tp[maxn],tax[maxn],rk[maxn],h[maxn],n,m,len[300],bj[maxn];\n    int siz[300],st[maxn],top,tot,s[maxn];\n    void Qsort(){\n        for(int i=0;i<=m;i++) tax[i]=0;\n        for(int i=1;i<=n;i++) tax[rk[i]]++;\n        for(int i=1;i<=m;i++) tax[i]+=tax[i-1];\n        for(int i=n;i>=1;i--)\n            sa[tax[rk[tp[i]]]--]=tp[i];\n    }\n    void getsa(){\n        m=1000;\n        for(int i=1;i<=n;i++)\n            rk[i]=s[i],tp[i]=i;\n        Qsort();\n        for(int p=1,w=1;p<n;w<<=1,m=p){\n            p=0;\n            for(int i=1;i<=w;i++) tp[++p]=n+i-w;\n            for(int i=1;i<=n;i++) if(sa[i]>w) tp[++p]=sa[i]-w;\n            Qsort();\n            swap(tp,rk);\n            rk[sa[1]]=p=1;\n            for(int i=2;i<=n;i++)\n                rk[sa[i]]=tp[sa[i]]==tp[sa[i-1]]&&tp[sa[i]+w]==tp[sa[i-1]+w]?p:++p;\n        }\n    }\n    void geth(){\n        for(int i=1,j,p=0;i<=n;h[rk[i++]]=p)\n        for(p?p--:p,j=sa[rk[i]-1];s[j+p]==s[i+p];p++);\n    }\n    void ycl(){\n        h[0]=-0x7fffffff,top=0;\n        for(int i=1;i<=n;i++){\n            while(h[st[top]]>=h[i]) top--;\n            if(bj[sa[i]]&&h[i]==len[bj[sa[i]]])\n                siz[bj[sa[i]]]=i-st[top];\n            st[++top]=i;\n        }\n        h[n+1]=-0x7fffffff,st[0]=n+1,top=0;\n        for(int i=n-1;i>=1;i--){\n            while(h[st[top]]>=h[i+1]) top--;\n            if(bj[sa[i]]&&h[i+1]==len[bj[sa[i]]]) siz[bj[sa[i]]]+=st[top]-i-1;\n            st[++top]=i+1;\n        }\n    }\n}sa;\nint n,m;\nchar a[maxn];\nint main(){\n    scanf(\"%d\",&n);\n    for(int i=1;i<=n;i++){\n        scanf(\"%s\",a+1);\n        m=strlen(a+1);\n        sa.bj[sa.n+1]=i;\n        sa.len[i]=m;\n        for(int j=1;j<=m;j++)\n            sa.s[++sa.n]=a[j]; \n        sa.s[++sa.n]='z'+i;\n    }\n    sa.getsa(),sa.geth(),sa.ycl();\n    for(int i=1;i<=n;i++)\n        printf(\"%d\\n\",sa.siz[i]+1);\n    return 0;\n}\n\n```",
        "postTime": 1543541719,
        "uid": 53421,
        "name": "nianheng",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\n\u7edf\u8ba1\u5355\u8bcd\u51fa\u73b0\u6b21\u6570\u2026\u2026\u4e3a\u5565\u5927\u5bb6\u90fd\u662f\u5199AC\u81ea\u52a8\u673a\u7684\u561e\u2026\u2026\u660e\u660e\u540e\u7f00\u81ea\u52a8\u673a\u4e5f\u80fd\u505a\u7684\u8bf4\u2026\u2026\n\n\u7edf\u8ba1\u51fa\u73b0\u6b21\u6570\u8fd9\u4e2a\u5c31\u76f4\u63a5\u6309\u957f\u5ea6\u6392\u5e8f\u7136\u540e\u505a\u4e2adp\u5c31\u597d\uff0c\u8fd9\u662fSAM\u7684\u677f\u5b50\u7684\u8981\u6c42\u554a\uff0c\u4e0d\u63d0\u4e86\n\n\u7136\u540e\u8003\u8651\u600e\u4e48\u8ba9\u6240\u6709\u4e32\u4e4b\u95f4\u9694\u5f00\u3002\u672c\u6765\u6253\u7b97\u5efa\u4e2a\u5e7f\u4e49SAM\u540e\u6765\u53d1\u73b0\u6ca1\u529e\u6cd5\u5904\u7406\u5b50\u4e32\u91cd\u590d\u7684\u60c5\u51b5\u2026\u2026\u7136\u540e\u5c31\u6309\u9898\u89e3\u91cc\u7684\u65b9\u6cd5\u5728\u6bcf\u4e24\u4e2a\u4e32\u4e4b\u95f4\u52a0\u5165\u4e00\u4e2a\u65b0\u5b57\u7b26\u7136\u540e\u76f4\u63a5\u5bf9\u6574\u4e2a\u4e32\u5efa\u597d\u4e86\n```\n//minamoto\n#include<iostream>\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nconst int N=4e6+5;\nint fa[N],ch[N][27],l[N],cnt[N],last=1,tot=1;\nchar s[N>>1],t[N>>1];int len[N>>1],c[N],a[N],k,ans[N],n;\nvoid ins(int c){\n\tint p=last,np=++tot;last=np,l[np]=l[p]+1,cnt[np]=1;\n\tfor(;p&&!ch[p][c];p=fa[p]) ch[p][c]=np;\n\tif(!p) fa[np]=1;\n\telse{\n\t\tint q=ch[p][c];\n\t\tif(l[q]==l[p]+1) fa[np]=q;\n\t\telse{\n\t\t\tint nq=++tot;l[nq]=l[p]+1;\n\t\t\tmemcpy(ch[nq],ch[q],sizeof(ch[q]));\n\t\t\tfa[nq]=fa[q],fa[q]=fa[np]=nq;\n\t\t\tfor(;ch[p][c]==q;p=fa[p]) ch[p][c]=nq;\n\t\t}\n\t}\n}\ninline void calc(){\n\tfor(int i=1;i<=tot;++i) ++c[l[i]];\n\tfor(int i=1;i<=tot;++i) c[i]+=c[i-1];\n\tfor(int i=1;i<=tot;++i) a[c[l[i]]--]=i;\n\tfor(int i=tot;i;--i) cnt[fa[a[i]]]+=cnt[a[i]];\n}\nint main(){\n//\tfreopen(\"testdata.in\",\"r\",stdin);\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;++i){\n\t\tscanf(\"%s\",t+1);len[i]=strlen(t+1);\n\t\tfor(int j=1;j<=len[i];++j) ins(s[++k]=t[j]-'a');\n\t\tins(s[++k]=26);\n\t}\n\tcalc();k=0;\n\tfor(int i=1,x,j;i<=n;++i){\n\t\tfor(j=1,x=1;j<=len[i];++j)\n\t\tx=ch[x][s[++k]];\n\t\tans[i]=cnt[x];\n\t\t++k;\n\t}\n\tfor(int i=1;i<=n;++i) printf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1536820385,
        "uid": 41781,
        "name": "bztMinamoto",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u4ecb\u7ecd\u4e00\u79cd\u540e\u7f00\u6570\u7ec4\u7684\u505a\u6cd5\u5427\u3002\n\n\u9996\u5148\u5c06\u6240\u6709\u7684\u5b57\u7b26\u4e32\u7c98\u6210\u4e00\u4e2a\u5de8\u5927\u7684\u5b57\u7b26\u4e32\uff0c\u4e2d\u95f4\u7528**\u4e0d\u540c**\u7684\u7279\u6b8a\u5b57\u7b26\u5206\u9694\u5f00\u3002\u7136\u540e\u8fdb\u884c\u540e\u7f00\u6392\u5e8f\uff0c\u83b7\u5f97\u4e86\u540e\u7f00\u6570\u7ec4\u548c$Height$\u6570\u7ec4\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5355\u8bcd\uff0c\u6211\u4eec\u627e\u5230\u5b83\u7684\u9996\u5b57\u6bcd\u5728\u540e\u7f00\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6e\uff0c\u53ea\u8981\u80fd\u591f\u627e\u5230\u4e00\u4e2a\u5305\u542b\u5f53\u524d\u4f4d\u7f6e\u7684\u533a\u95f4\uff0c\u4f7f\u5f97\u5176\u4e2d\u7684$Height$\u6700\u5c0f\u503c\u4f9d\u7136\u4e0d\u5c0f\u4e8e\u5f53\u524d\u5355\u8bcd\u7684\u957f\u5ea6\uff0c\u8fd9\u4e2a\u533a\u95f4\u7684\u5927\u5c0f\u5c31\u662f\u7b54\u6848\u3002\n\n\u53ef\u4ee5\u8003\u8651\u4e8c\u5206\u67e5\u627e\u8fd9\u4e2a\u533a\u95f4\u7684\u5de6\u53f3\u7aef\u70b9\u6700\u591a\u53ef\u4ee5\u6269\u5c55\u5230\u54ea\u3002\n\n\u81f3\u4e8e\u600e\u4e48\u5f97\u5230\u533a\u95f4$Height$\u6700\u5c0f\u503c\uff0c\u53ef\u4ee5\u4f7f\u7528$rmq$\n\n\u4ee4$L$\u4e3a\u5355\u8bcd\u603b\u957f\uff0c\u5219\u8be5\u7b97\u6cd5\u590d\u6742\u5ea6\u5e94\u8be5\u662f$O(L log L)$\u7684\uff0c\u867d\u7136\u4e0d\u53caAC\u81ea\u52a8\u673a\u7684\u505a\u6cd5\u90a3\u4e48\u4f18\u79c0\uff0c\u4f46\u662f\u8fd8\u662f\u5f88\u76f4\u89c2\u7684\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=2000005;\nint n,tpm=26,tn;\nchar s[N];int len[N],pos[N],a[N],x[N],y[N],T[N],SA[N],Hei[N];\nvoid Rsort() {//\u57fa\u6570\u6392\u5e8f\n\tfor(int i=0;i<=tpm;++i) T[i]=0;\n\tfor(int i=1;i<=tn;++i) ++T[x[y[i]]];\n\tfor(int i=1;i<=tpm;++i) T[i]+=T[i-1];\n\tfor(int i=tn;i>=1;--i) SA[T[x[y[i]]]--]=y[i];\n}\nint cmp(int i,int j,int num) {return y[i]==y[j]&&y[i+num]==y[j+num];}\nvoid getSA() {//\u83b7\u5f97\u540e\u7f00\u6570\u7ec4\n\tfor(int i=1;i<=tn;++i) x[i]=a[i],y[i]=i;\n\tRsort();\n\tfor(int km=1,num=1;km<tn;num+=num,tpm=km) {\n\t\tkm=0;\n\t\tfor(int i=tn-num+1;i<=tn;++i) y[++km]=i;\n\t\tfor(int i=1;i<=tn;++i) if(SA[i]>num) y[++km]=SA[i]-num;\n\t\tRsort(),swap(x,y),km=x[SA[1]]=1;\n\t\tfor(int i=1;i<=tn;++i) x[SA[i]]=cmp(SA[i],SA[i-1],num)?km:++km;\n\t}\n\tfor(int i=1;i<=tn;++i) x[SA[i]]=i;\n}\nvoid getHei() {//\u83b7\u5f97Height\u6570\u7ec4\n\tint lcp=0;\n\tfor(int i=1;i<=tn;++i) {\n\t\tif(lcp) --lcp;\n\t\tint j=SA[x[i]-1];\n\t\twhile(j+lcp<=tn&&i+lcp<=tn&&a[j+lcp]==a[i+lcp]) ++lcp;\n\t\tHei[x[i]]=lcp;\n\t}\n}\nint f[N][22],Log[N],bin[22];\nvoid init() {//\u9884\u5904\u7406rmq\n\tbin[0]=1;for(int i=1;i<=21;++i) bin[i]=bin[i-1]<<1;\n\tfor(int i=2;i<=tn;++i) Log[i]=Log[i>>1]+1;\n\tfor(int i=tn;i>=1;--i) {\n\t\tf[i][0]=Hei[i];\n\t\tfor(int j=1;j<=Log[tn-i+1];++j)\n\t\t\tf[i][j]=min(f[i][j-1],f[i+bin[j-1]][j-1]);\n\t}\n}\nint rmq(int l,int r) {int t=Log[r-l+1];return min(f[l][t],f[r-bin[t]+1][t]);}\n//O(1)\u83b7\u5f97\u4e00\u4e2a\u533a\u95f4\u7684Height\u6700\u5c0f\u503c\nint findl(int l,int r,int lim) {//\u4e8c\u5206\u67e5\u627e\u5de6\u7aef\u70b9\u6700\u591a\u6269\u5c55\u5230\u54ea\n\tint re;\n\twhile(l<=r) {\n\t\tint mid=(l+r)>>1;\n\t\tif(rmq(mid,r)>=lim) re=mid,r=mid-1;\n\t\telse l=mid+1;\n\t}\n\treturn re;\n}\nint findr(int l,int r,int lim) {//\u4e8c\u5206\u67e5\u627e\u53f3\u7aef\u70b9\u6700\u591a\u6269\u5c55\u5230\u54ea\n\tint re;\n\twhile(l<=r) {\n\t\tint mid=(l+r)>>1;\n\t\tif(rmq(l,mid)>=lim) re=mid,l=mid+1;\n\t\telse r=mid-1;\n\t}\n\treturn re;\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;++i) {\n\t\tscanf(\"%s\",s),len[i]=strlen(s),pos[i]=tn+1;\n\t\tfor(int j=0;j<len[i];++j) a[++tn]=s[j]-'a'+1;\n\t\ta[++tn]=++tpm;//\u7279\u6b8a\u5b57\u7b26\u9694\u5f00\n\t}\n\tgetSA(),getHei(),init();\n\tfor(int i=1;i<=n;++i) {\n\t\tint l,r,xx=x[pos[i]];\n\t\tif(xx==1||Hei[xx]<len[i]) l=xx;//\u7279\u5224\u5de6\u53f3\u7aef\u70b9\u4e0d\u80fd\u6269\u5c55\u7684\u60c5\u51b5\n\t\telse l=findl(2,xx,len[i])-1;\n\t\tif(xx==tn||Hei[xx+1]<len[i]) r=xx;\n\t\telse r=findr(xx+1,tn,len[i]);\n\t\tprintf(\"%d\\n\",r-l+1);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1519460102,
        "uid": 20604,
        "name": "litble",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u4e3a\u5565\u6211\u6ca1\u7528\u7279\u6b8a\u5b57\u7b26\u9694\u5f00\u5b57\u7b26\u4e32,\u597d\u614c\u554a ~~\u6211\u7684\u505a\u6cd5\u662f\u4e0d\u662f\u5047\u7684\u554a~~\n\n\u4e00\u5f00\u59cb\u6ca1\u770b\u61c2\u9898,\u60f3\u7740\u76f4\u63a5map\u8bb0\u5f55\u4e32\u51fa\u73b0\u6b21\u6570\u4e0d\u5c31\u6ca1\u4e86?\u590d\u6742\u5ea6\u4e0d\u5bf9\u5c31\u641e\u4e2aTrie\u5c31\u53ef\u4ee5\u7ebf\u6027\u4e86(\u5f53\u65f6\u8bfb\u9519\u7684\u9898\u610f\u662f,\u6c42\u4e32\u5b8c\u6574\u5730\u51fa\u73b0\u4e86\u51e0\u6b21)\n\n\u540e\u6765\u53d1\u73b0\u6837\u4f8b\u90fd\u5bf9\u4e0d\u4e0a,\u4ed4\u7ec6\u770b\u9898\u624d\u660e\u767d\u662f\u6307\"\u6bcf\u4e2a\u5355\u8bcd\u5206\u522b\u5728\u8bba\u6587\u4e2d\u51fa\u73b0\u4e86\u591a\u5c11\u6b21\",\u4e5f\u5c31\u662f\u5982\u679c\u67d0\u4e2a\u4e32\u662f\u53e6\u4e00\u4e2a\u4e32\u7684\u5b57\u4e32,\u4e5f\u662f\u6709\u8d21\u732e\u7684.  \n\u90a3\u8fd9\u5c31\u662f\u4e2aAC\u81ea\u52a8\u673a\u88f8\u9898\u4e86,\u6bcf\u6b21\u8bfb\u5165\u4e00\u4e2a\u4e32\u76f4\u63a5\u63d2\u5165,\u6240\u6709\u7ecf\u8fc7\u7684\u70b9\u6807\u8bb0$val[u]++$,\u5728\u7ed3\u5c3e\u8282\u70b9\u6807\u8bb0$num[dex]=u$(dex\u662f\u5f53\u524d\u4e32\u7684\u7f16\u53f7)\n\n\u4f46$val[u]$\u6b64\u65f6\u8fd8\u4e0d\u8868\u793a\u4ee5$u$\u4e3a\u7ed3\u5c3e\u7684\u4e32\u51fa\u73b0\u4e86\u51e0\u6b21.  \n\u522b\u7740\u6025,\u5148\u628aAC\u81ea\u52a8\u673a\u7684fail\u6307\u9488\u5efa\u597d.  \n\u7531fail\u7684\u5b9a\u4e49,\u53ef\u5f97:**fail[u]\u8868\u793a\u7684\u4ee5fail[u]\u4e3a\u7ed3\u5c3e\u7684\u4e32\u4e00\u5b9a\u662f\u4ee5u\u7ed3\u5c3e\u7684\u4e32\u7684\u540e\u7f00**,\u4e5f\u5c31\u662f\u4ee5fail[u]\u4e3a\u7ed3\u5c3e\u7684\u4e32\u4f1a\u5728\u4ee5u\u7ed3\u5c3e\u7684\u4e32\u4e2d\u51fa\u73b0.\n\n\u90a3\u4e48,\u5efa\u7acbfail\u6811,\u6c42\u5b50\u6811\u548c\u5373\u4e3a\u6700\u7ec8\u7b54\u6848.**\u65f6\u95f4\u590d\u6742\u5ea6\u7ebf\u6027.**\n\n\u4ee3\u7801\u5c01\u88c5\u4e86\u5efa\u7acbfail\u6811\u7684ac\u81ea\u52a8\u673a,\u6240\u4ee5\u5e94\u8be5\u4e0d\u4f1a\u592a\u96be\u770b\u5427.\n```cpp\n//\u7701\u7565\u4e86\u5feb\u8bfb\n/**********/\n#define MAXN 1000011\nchar a[MAXN];\nstruct ACM\n{\n    ll t[27][MAXN],num[MAXN],fail[MAXN],val[MAXN];\n    struct Edge\n    {\n        ll v,nxt;\n    }e[MAXN];\n    ll Ecnt,last[MAXN];\n    void adde(ll u,ll v)\n    {\n        e[++Ecnt].v=v;\n        e[Ecnt].nxt=last[u],last[u]=Ecnt;\n    }\n    ll cnt;\n    ACM()\n    {\n        Ecnt=0;\n        cnt=0;\n    }\n    void insert(char* a,ll dex)//\u63d2\u5165\n    {\n        ll n=strlen(a+1),u=0;\n        for(ll i=1;i<=n;++i)\n        {\n            ll &v=t[a[i]-'a'][u];\n            if(!v)v=++cnt;\n            u=v;\n            ++val[u];\n        }\n        num[dex]=u;\n    }\n    void dfs(ll u)//\u6c42fail\u6811\u5b50\u6811\u548c\n    {\n        for(ll i=last[u];i;i=e[i].nxt)\n        {\n            ll v=e[i].v;\n            dfs(v);\n            val[u]+=val[v];\n        }\n    }\n    void build()//\u6c42fail\u6307\u9488\u5e76\u6784\u9020fail\u6811\n    {\n        std::queue<ll>q;\n        for(ll i=0;i<26;++i)\n            if(t[i][0])\n            {\n                fail[t[i][0]]=0;\n                adde(0,t[i][0]);\n                //printf(\"add 0 to %lld\\n\",t[i][0]);\n                q.push(t[i][0]);\n            }\n        while(!q.empty())\n        {\n            ll u=q.front();q.pop();\n            for(ll i=0;i<26;++i)\n            {\n                ll &v=t[i][u];\n                if(v)\n                {\n                    fail[v]=t[i][fail[u]];\n                    adde(fail[v],v);\n                    //printf(\"add %lld to %lld\\n\",fail[v],v);\n                    q.push(v);\n                }\n                else v=t[i][fail[u]];\n            }\n        }\n        dfs(0);\n    }\n    ll getf(ll x)//\u8be2\u95ee\u4e32x\u7684\u51fa\u73b0\u6b21\u6570\n    {\n        return val[num[x]];\n    }\n}ac;\nint main()\n{\n    ll n=read();\n    for(ll i=1;i<=n;++i)\n    {\n        scanf(\"%s\",a+1);\n        ac.insert(a,i);\n    }\n    ac.build();\n    for(ll i=1;i<=n;++i)\n        printf(\"%lld\\n\",ac.getf(i));\n    return 0;\n}\n```",
        "postTime": 1572770300,
        "uid": 73142,
        "name": "\u4e07\u5f18",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u79cd\u5b8c\u5168\u4e0d\u4e00\u6837\u7684\u601d\u8def\u3002\u6211\u4eca\u5929\u521a\u521a\u505a\u5b8c\u4e8c\u6b21\u52a0\u5f3a\u7248\u7684\u6a21\u677f\uff0c\u4ee3\u7801\u8fd8\u5728\u8fd9\uff0c\u5c31\u60f3\u7740\u600e\u4e48\u5957\u8fd9\u4e2a\u6a21\u677f\uff0c\u61d2\u5f97\u6539\u4e86\u3002\n\n\u7136\u540e\u5c31\u6709\u4e86\u8fd9\u6837\u7684\u65b9\u6cd5\uff1a\u628a\u6bcf\u4e2a\u5b57\u7b26\u4e32\u63a5\u8d77\u6765\uff0c\u7136\u540e\u4e2d\u95f4\u7528\u4e00\u4e2a\u7279\u6b8a\u5b57\u7b26\u63d2\u5165\u4e00\u4e0b\u3002\u8fd9\u4e2a\u5b57\u7b26\u4e0d\u662f$[a,z]$\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u3002\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u6211\u4eec\u627e\u5230\u7684\u5339\u914d\u4e0d\u4f1a\u8de8\u8fc7\u591a\u4e2a\u5355\u8bcd\uff0c\u4ec5\u9650\u5728\u4e00\u4e2a\u5355\u8bcd\u5185\u3002\u7136\u540e\u8fd9\u6837\u7684\u8bdd\u5c31\u76f4\u63a5\u5957\u90a3\u4e2a\u6a21\u677f\u5373\u53ef\u3002\n\n\u5f53\u7136\uff0c\u8bb2\u4e00\u4e0b\u5177\u4f53\u7684\u5b9e\u73b0\u3002\u8fd9\u4e2a\u5b57\u7b26\u5c31\u662fASCII\u7801\u8868\u4e2d\u7684$'z'+1$\u3002\u7ecf\u8fc7\u8f93\u51fa\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u5b57\u7b26\u662f\u5de6\u5927\u62ec\u53f7```{```\u3002\u7136\u540e\u6211\u4eec\u5728\u5199$AC$\u81ea\u52a8\u673a\u7684\u65f6\u5019\u5c31\u7a0d\u5fae\u6539\u4e00\u4e0b\uff0c\u628a\u6240\u6709\u7684$26$\u6539\u6210$27$\u5c31\u597d\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nnamespace Flandre_Scarlet\n{\n\t#define N 212345\n\n\t#define F(i,l,r) for(int i=l;i<=r;++i)\n\t#define D(i,r,l) for(int i=r;i>=l;--i)\n\t#define Fs(i,l,r,c) for(int i=l;i<=r;c)\n\t#define Ds(i,r,l,c) for(int i=r;i>=l;c)\n\t#define Tra(i,u) for(int i=G.Start(u);~i;i=G.Next(i))\n\t#define MEM(x,a) memset(x,a,sizeof(x))\n\t#define FK(x) MEM(x,0)\n\n\tint id[N];\n\tclass AC_Automaton\n\t{\n\tpublic:\n\t\tint tr[N][27];\n\t\tint tot;\n\n\t\tvoid Init()\n\t\t{\n\t\t\tFK(tr);\n\t\t\ttot=1;\n\t\t}\n\t\tint Insert(char s[])\n\t\t{\n\t\t\tint pos=1;\n\t\t\tF(i,0,INT_MAX)\n\t\t\t{\n\t\t\t\tif (!s[i]) break;\n\n\t\t\t\tint c=s[i]-'a';\n\t\t\t\tif (!tr[pos][c])\n\t\t\t\t{\n\t\t\t\t\ttr[pos][c]=++tot;\n\t\t\t\t}\n\t\t\t\tpos=tr[pos][c];\n\t\t\t}\n\t\t\treturn pos;\n\t\t}\n\n\t\tint fail[N];\n\t\tqueue<int> Q;\n\t\tvector<int> G[N];void Add(int u,int v){G[u].push_back(v);}\n\t\tvoid BuildFail()\n\t\t{\n\t\t\twhile(!Q.empty()) Q.pop();\n\n\t\t\tF(i,0,26) tr[0][i]=1;\n\t\t\tQ.push(1);\n\t\t\twhile(!Q.empty())\n\t\t\t{\n\t\t\t\tint u=Q.front();Q.pop();\n\n\t\t\t\tF(i,0,26)\n\t\t\t\t{\n\t\t\t\t\tif (tr[u][i])\n\t\t\t\t\t{\n\t\t\t\t\t\tfail[tr[u][i]]=tr[fail[u]][i];\n\t\t\t\t\t\tQ.push(tr[u][i]);\n\t\t\t\t\t}\n\t\t\t\t\telse tr[u][i]=tr[fail[u]][i];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tF(i,2,tot) Add(fail[i],i);\n\t\t}\n\n\t\tint size[N];\n\t\tvoid DFS(int u)\n\t\t{\n\t\t\tF(i,0,(int)G[u].size()-1)\n\t\t\t{\n\t\t\t\tint v=G[u][i];\n\t\t\t\tDFS(v);\n\t\t\t\tsize[u]+=size[v];\n\t\t\t}\n\t\t}\n\t\tvoid Query(char s[])\n\t\t{\n\t\t\tint pos=1;\n\t\t\tF(i,0,INT_MAX)\n\t\t\t{\n\t\t\t\tif (!s[i]) break;\n\n\t\t\t\tint c=s[i]-'a';\n\t\t\t\tpos=tr[pos][c];\n\t\t\t\t++size[pos];\n\t\t\t}\n\t\t\tDFS(1);\n\t\t}\n\t}AC;\n\n\tint n;\n\tchar s[N];\n\tchar T[N*10];\n\tvoid Input()\n\t{\n\t\tscanf(\"%d\",&n);\n\t\tAC.Init();\n\t\tFK(T);\n\t\tF(i,1,n)\n\t\t{\n\t\t\tscanf(\"%s\",s);\n\t\t\tid[i]=AC.Insert(s);\n\t\t\tstrcat(T,s);\n\t\t\tstrcat(T,\"{\");//{='z'+1\n\t\t}\n\t}\n\tvoid Soviet()\n\t{\n\t\t// printf(\"T=%s\\n\",T);\n\t\tAC.BuildFail();\n\t\tAC.Query(T);\n\t\tF(i,1,n)\n\t\t{\n\t\t\tprintf(\"%d\\n\",AC.size[id[i]]);\n\t\t}\n\t}\n\tvoid IsMyWife()\n\t{\n\t\tInput();\n\t\tSoviet();\n\t}\n}\nint main()\n{\n\tFlandre_Scarlet::IsMyWife();\n\tgetchar();getchar();\n\treturn 0;\n}\n```",
        "postTime": 1568342364,
        "uid": 106252,
        "name": "LightningUZ",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "### \u6570\u636e\u52a0\u5f3a\uff0c\u76f4\u63a5\u8df3$Fail$\u6307\u9488\u9010\u4e2a\u7edf\u8ba1\u7684\u5199\u6cd5\u5df2\u7ecf$gg$\u3002\u5982\u679c\u4f60\u7684\u7a0b\u5e8f$TLE$\u4e86\u8bf7\u4e0d\u7528\u62c5\u5fc3\uff0c\u5b83\u6ca1\u6709\u51fa\u9519\uff0c\u5b83\u53ea\u662f\u5355\u7eaf\u7684\u590d\u6742\u5ea6\u6709\u95ee\u9898\u800c\u5df2\u3002\n#### [\u9898\u76ee\u94fe\u63a5  $Click$  $Here$](https://www.luogu.org/problemnew/show/P3966)\n\n\u672c\u9898$AC$\u81ea\u52a8\u673a\u5199\u6cd5\u7684\u6b63\u89e3\u4e4b\u4e00\u662f$Fail$\u6811\u4e0a\u8dd1$DP$\u3002\n\n$AC$\u81ea\u52a8\u673a\u662f$Trie$\u6811\u548c$Fail$\u6811\u5171\u5b58\u7684\u7ed3\u6784\uff0c\u524d\u8005\u53ef\u4ee5\u65b9\u4fbf\u5730\u5904\u7406\u524d\u7f00\u95ee\u9898\uff0c\u800c\u5728\u540e\u8005\u4e2d\uff0c\u4e00\u4e2a\u8282\u70b9\u7684\u5b50\u8282\u70b9\uff0c**\u4ee3\u8868\u4ee5\u5f53\u524d\u5b57\u7b26\u4e32\u4e3a\u540e\u7f00\u7684\u6240\u6709\u5b57\u7b26\u4e32\u8282\u70b9**\uff08\u6839\u8282\u70b9\u5916\u5411$Fail$\u6811\uff09\u3002\u6211\u4eec\u6700\u521d\u7ed9\u6bcf\u4e2a\u4e32\u7684\u6240\u6709\u524d\u7f00\u8ba1\u6570$+1$\uff0c\u540e\u671f\u7edf\u8ba1\u65f6\uff0c\u5728\u8be5\u524d\u7f00\u7684\u6240\u6709\u540e\u7f00\u4e0a\uff08$Fail$\u6811\u4e0a\u7684\u7956\u5148\u8282\u70b9\u4e0a\uff09\uff0c\u5c06\u5176\u81ea\u8eab\u7b54\u6848\u7d2f\u52a0\u4e0a\u53bb\uff0c\u5c31\u662f\u603b\u5171\u51fa\u73b0\u7684\u6b21\u6570\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int N = 1000010;\n\nstruct AC_Auto {\n\tint top, sta[N];\n\tlong long sum[N];\n\tint cnt, ch[N][26], pre[N], fail[N];\n\n\tAC_Auto () {\n\t\tcnt = top = 0;\n\t\tmemset (ch, 0, sizeof (ch));\n\t\tmemset (sum, 0, sizeof (sum));\n\t\tmemset (pre, 0, sizeof (pre));\n\t\tmemset (fail, 0, sizeof (fail));\n\t}\n\n\tvoid add_str (char *s) {\n\t\tint l = strlen (s), now = 0;\n\t\tfor (int i = 0; i < l; ++i) {\n\t\t\tif (!ch[now][s[i] - 'a']) {\n\t\t\t\tch[now][s[i] - 'a'] = ++cnt;\n\t\t\t}\n\t\t\tpre[ch[now][s[i] - 'a']] = now;\n\t\t\tnow = ch[now][s[i] - 'a'];\n\t\t\tsum[now]++;\n\t\t}\n\t\tsta[++top] = now;\n\t}\n\n\tqueue <int> q;\n\t\n\tvoid build () {\n\t\tfor (int i = 0; i < 26; ++i) {\n\t\t\tif (ch[0][i]) {\n\t\t\t\tq.push (ch[0][i]);\n\t\t\t}\n\t\t}\n\t\twhile (!q.empty ()) {\n\t\t\tint u = q.front (); q.pop ();\n\t\t\tfor (int i = 0; i < 26; ++i) {\n\t\t\t\tif (ch[u][i]) {\n\t\t\t\t\tq.push (ch[u][i]);\n\t\t\t\t\tfail[ch[u][i]] = ch[fail[u]][i];\n\t\t\t\t} else {\n\t\t\t\t\tch[u][i] = ch[fail[u]][i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tint _cnt, head[N];\n\n\tstruct edge {\n\t\tint nxt, to;\n\t}e[N];\n\n\tvoid add_edge (int from, int to) {\n\t\te[++_cnt].nxt = head[from];\n\t\te[_cnt].to = to;\n\t\thead[from] = _cnt;\n\t} \n\n\tvoid dp (int u) {\n\t\tfor (int i = head[u]; ~i; i = e[i].nxt) {\n\t\t\tdp (e[i].to);\n\t\t\tsum[u] += sum[e[i].to];\n\t\t}\n\t}\n\t\n\tvoid get_ans () {\n\t\t_cnt = 0;\n\t\tmemset (head, -1, sizeof (head));\n\t\tfor (int i = 1; i <= cnt; ++i) {\n\t\t\tadd_edge (fail[i], i);\n\t\t}\n\t\tdp (0);\n\t\tfor (int i = 1; i <= top; ++i) {\n\t\t\tcout << sum[sta[i]] << endl;\n\t\t}\n\t}\n\t\n\t\n\t\n\t\n}AC;\n\nint n; char s[N];\n\nint main () {\n\tcin >> n;\n\tfor (int i = 1; i <= n; ++i) {\n\t\tscanf (\"%s\", s);\n\t\tAC.add_str (s);\n\t}\n\tAC.build ();\n\tAC.get_ans ();\n}\n\n```\n$UPD:$\u65b0\u589e\u4e86\u540e\u7f00\u6570\u7ec4$+ST$\u8868$+$\u500d\u589e\u5199\u6cd5\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int N = 2000010;\n\nchar tmp[N];\nint n, len, ban = 'z', s[N], id[N], sa[N], tp[N], rk[N], _rk[N], bin[N], _len[N], height[N];\n\nvoid get_height (int n) {\n\tint k = 0;\n\tfor (int i = 1; i <= n; ++i) {\n\t\tif (k != 0) --k;\n\t\tint j = sa[rk[i] - 1];\n\t\twhile (s[i + k] == s[j + k]) ++k;\n\t\theight[rk[i]] = k;\n\t}\n}\n\nvoid base_sort (int n, int m) {\n\tfor (int i = 0; i <= m; ++i) bin[i] = 0;\n\tfor (int i = 1; i <= n; ++i) bin[rk[tp[i]]]++;\n\tfor (int i = 1; i <= m; ++i) bin[i] += bin[i - 1];\n\tfor (int i = n; i >= 1; --i) sa[bin[rk[tp[i]]]--] = tp[i];\n}\n\nvoid suffix_sort (int n, int m) {\n\tfor (int i = 1; i <= n; ++i) {\n\t\ttp[i] = i, rk[i] = s[i];\n\t}\n\tbase_sort (n, m);\n\tfor (int w = 1; w <= n; w <<= 1) {\n\t\tint cnt = 0;\n\t\tfor (int i = n - w + 1; i <= n; ++i) tp[++cnt] = i;\n\t\tfor (int i = 1; i <= n; ++i) if (sa[i] > w) tp[++cnt] = sa[i] - w;\n\t\tbase_sort (n, m);\n\t\tmemcpy (_rk, rk, sizeof (rk));\n\t\trk[sa[1]] = cnt = 1;\n\t\tfor (int i = 2; i <= n; ++i) {\n\t\t\trk[sa[i]] = (_rk[sa[i - 1]] == _rk[sa[i]]) && (_rk[sa[i - 1] + w] == _rk[sa[i] + w]) ? cnt : ++cnt; \n\t\t}\n\t\tif (cnt == n) break;\n\t\tm = cnt;\n\t}\n}\n\nint fa[N][25];\n\nint query (int l, int r) {\n\tif (l >= r) return 0; l++;\n\tint mx = log2 (r - l + 1);\n\treturn min (fa[l][mx], fa[r - (1 << mx) + 1][mx]);\n}\n\nvoid get_STlist (int n) {\n\tint mx = log2 (n);\n\tfor (int i = 1; i <= n; ++i) fa[i][0] = height[i];\n\tfor (int i = 1; i <= mx; ++i) {\n\t\tfor (int j = 1; j <= n - (1 << i) + 1; ++j) {\n\t\t\tfa[j][i] = min (fa[j][i - 1], fa[j + (1 << (i - 1))][i - 1]);\n\t\t}\n\t}\n}\n\nint main () {\n\tcin >> n;\n\tfor (int i = 1; i <= n; ++i) {\n\t\tscanf (\"%s\", tmp);\n\t\tint l = strlen (tmp);\n\t\tid[i] = len + 1;\n\t\t_len[i] = l;\n\t\tfor (int j = 0; j < l; ++j) {\n\t\t\ts[++len] = tmp[j];\n\t\t}\n\t\ts[++len] = ++ban;\n\t}\n\tsuffix_sort (len, ban);\n\tget_height (len);\n\tget_STlist (len);\n\tfor (int i = 1; i <= n; ++i) {\n\t\tint l = rk[id[i]], r = rk[id[i]];\n\t\tfor (int j = 24; j >= 0; --j) {\n\t\t\tint tol = l - (1 << j);\n\t\t\tint tor = r + (1 << j);\n\t\t\tif (tol >= 1   && query (tol, rk[id[i]]) >= _len[i]) l = tol;\n\t\t\tif (tor <= len && query (rk[id[i]], tor) >= _len[i]) r = tor;\n\t\t}\n\t\tprintf (\"%d\\n\", r - l + 1);\n\t}\n}\n\n```",
        "postTime": 1551658619,
        "uid": 58698,
        "name": "Nativ",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u79cdkmp\u7684\u601d\u8def\u5566\uff08\u5f53\u7136\u5927\u4f6c\u4eec\u4e00\u5b9a\u53ef\u4ee5\u7528AC\u81ea\u52a8\u673a\u7684\uff09\n\n\u601d\u8def\uff1a\u7528kmp\u66b4\u529b\u5339\u914d\uff08\u56e0\u4e3a\u672c\u9898\u8303\u56f4N<=200\uff09,\u6240\u4ee5\u5982\u679c\u4f18\u5316\u5199\u5f97\u597d\u662f\u4e0d\u4f1aT\u6389\u7684  \n\n\u4f18\u53161\uff1a\u5b57\u7b26\u4e32\u5feb\u8bfb  \n\n\u4f18\u53162\uff1aget next\u6570\u7ec4\u53ea\u9700\u8981\u5faa\u73afn\u6b21\uff08\u5982\u679c\u6bcf\u6b21\u5339\u914d\u90fdget_nxt\u5c31\u4f1aTLE,\u4eb2\u6d4b\u8fc7\uff09  \n\n\u4f18\u53163\uff1a\u5982\u679c\u5b57\u7b26t\u957f\u5ea6\u7b49\u4e8e\u5b57\u7b26s\u957f\u5ea6\uff0cans\u76f4\u63a5++,\u5982\u679c\u5b57\u7b26t\u957f\u5ea6\u5927\u4e8e\u5b57\u7b26s\u957f\u5ea6\uff0c\u76f4\u63a5continue  \n\n# Code:\n```cpp\n#define Flowery\n#define maxn 1000100\n#define rg register int\n#include<bits/stdc++.h>\nusing namespace std;\nint nxt[maxn],n,ans,len;\nchar s[maxn],gy[210][maxn];\ninline int re_s(char *s,int cnt)//\u5b57\u7b26\u4e32\u5feb\u8bfb\n{\n\tint x=0;\n\twhile((s[++x]=getchar())!=' '&&s[x]!='\\n'&&s[x]!='\\377')gy[cnt][x]=s[x];\n\treturn x-1;\n}\ninline void get_nxt(char *t)//get next\u6570\u7ec4\n{\n\tint lent=strlen(t+1);\n\tmemset(nxt,0,sizeof(nxt));\n\tfor(rg i=2,j=0;i<=lent;i++)\n\t{\n\t\twhile(j&&t[i]!=t[j+1])j=nxt[j];\n\t\tif(t[i]==t[j+1])j++;\n\t\tnxt[i]=j;\n\t}\n}\ninline int kmp(char *t,char *s)//kmp\u5b57\u7b26\u4e32\u5339\u914d\n{\n\tint ret=0;\n\tint lent=strlen(t+1),lens=strlen(s+1);\n\tif(lent>lens)return ret;//\u4f18\u53163\n\tfor(rg i=1,j=0;i<=lens;i++)\n\t{\n\t\twhile(j&&s[i]!=t[j+1])j=nxt[j];\n\t\tif(s[i]==t[j+1])j++;\n\t\tif(j==lent) {j=nxt[j];ret++;}\n\t}\n\treturn ret;\n}\nint main()\n{\n\tscanf(\"%d\\n\",&n);\n\tfor(rg i=1;i<=n;i++)len=re_s(s,i);\n\tfor(rg i=1;i<=n;i++)\n\t{\n\t\tans=0;\n\t\tget_nxt(gy[i]);//\u4e00\u5b9a\u8981\u653e\u5916\u9762\n\t\tfor(rg j=1;j<=n;j++) \n\t\t{\n\t\t\tif(i==j) {ans++;continue;}//\u4f18\u53163\n\t\t\tans+=kmp(gy[i],gy[j]);\n\t\t}\n\t\tprintf(\"%d\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n\u2014\u2014>[my blog](https://www.luogu.com.cn/blog/flowery/)",
        "postTime": 1602835464,
        "uid": 240952,
        "name": "Flowery",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "###### \u849f\u84bb\u7684\u9898\u89e3\n\n\u867d\u7136\u8fd9\u662f\u7d2b\u9898\n\u5b9e\u9645\u4e0a\u5f04\u61c2Ac\u81ea\u52a8\u673a\u4e5f\u5c31\u5f88\u597d\u505a\u4e86\u554a\n\n~~\u4e0d\u61c2\u7684\u8bdd\u8fd8\u662f\u5148\u770b\u4e66\u5427~~\n\n\u4e0d\u8fc7\u66b4\u529bAC\u81ea\u52a8\u673a\u4f1aTLE \u6240\u4ee5\u849f\u84bb\u5c31\u52a0\u4e86\u4e00\u4e2a\u7384\u5b66\u4f18\u5316\n\n\u4e3a\u4e86\u9632\u6b62\u6bcf\u6b21\u627e\u90fd\u6d6a\u8d39\u5f88\u591a\u65f6\u95f4 \u5f00\u4e00\u4e2a\u6570\u7ec4\u5148\u7edf\u8ba1\u6b21\u6570 \n\u6700\u540e\u518d\u4e00\u8d77\u52a0\u8d77\u6765\u6bd4\u8f83\u5feb ~~\u8bed\u6587\u4e0d\u597d\u8fd8\u662f\u770b\u4ee3\u7801\u5427~~\n### \u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <cstring>\nusing namespace std;\nint n,m,l,tot = 1,u;\nchar s[1000015],ma[1000500];\nint ch[3000001][28],nxt[1000001],que[1000001];\nint b[1000005],qwq[1000001],ovo[1000001],ans[1000001]; //\u5c0f\u5fc3\u592a\u5c0fRE \u592a\u5927MLE \nvoid ca(int x) //\u6b63\u5e38\u63d2\u5165\u64cd\u4f5c \n{\n\tu = 1;\n\tfor(int i = 1;i <= l;i++) {\n\t\tint a = s[i] - 'a';\n\t\tif(!ch[u][a]) ch[u][a] = ++tot;\n\t\tu = ch[u][a];\n\t}\n\tb[x] = u; //\u8bb0\u5f55\u7b2ci\u4e2a\u5355\u8bcd\u7684\u672b\u5c3e \u65b9\u4fbf\u540e\u9762\u67e5\u8be2 \n}\nvoid bfs()//\u6c42fail\u6307\u9488 \n{\n\tfor(int i = 0;i <= 25;i++) ch[0][i] = 1;//\u5efa\u7acb\u865a\u62df\u8282\u70b9 \u5e76\u4f7f\u8282\u70b9\u5230\u6bcf\u4e2a\u5b57\u6bcd\u90fd\u4e3a1 \n\tque[1] = 1; nxt[1] = 0;\n\tfor(int q1 = 1,q2 = 1;q1 <= q2;++q1) {\n\t\tint u = que[q1];\n\t\tfor(int i = 0;i <= 25;i++) {\n\t\t\tif(!ch[u][i]) ch[u][i] = ch[nxt[u]][i];//\u5947\u602a\u7684\u4f18\u5316 \n\t\t\telse {\n\t\t\t\tque[++q2] = ch[u][i]; //\u52a0\u5165\u961f\u5217 \n\t\t\t\tnxt[ch[u][i]] = ch[nxt[u]][i];\n\t\t\t}\n\t\t}\n\t}\n}\nvoid find() {\n\tu = 1;\n\tfor(int i = 1;i <= m;i++) {\n\t\tint a = ma[i] - 'a';\n\t\tif(a == 26) {//\u5982\u679c\u78b0\u5230\u95f4\u9694\u7684\u5730\u65b9 \n\t\t\tu = 1;\n\t\t\tcontinue;\n\t\t}\n\t\tint k = ch[u][a];\n\t\tovo[k] ++;//\u5728\u6700\u5f00\u59cb\u7684\u5730\u65b9\u7edf\u8ba1\u8d77\u6765 \u6700\u540e\u518d\u4e00\u8d77\u52a0 \n\t\tqwq[k] = -1;//\u6807\u8bb0 \n\t\tu = ch[u][a]; \n\t}\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i = 1;i <= n;i++)\n\t{\n\t\tscanf(\"%s\",s + 1);\n\t\tl = strlen(s + 1);\n\t\tfor(int j = 1;j <= l;j++) ma[++m] = s[j];//\u5408\u6210\u6bcd\u4e32 \n\t\tma[++m] = 'z' + 1;//\u5355\u8bcd\u4e2d\u95f4\u95f4\u9694\u4e00\u4e0b \n\t\tca(i);\n\t}\n\tbfs();\n\tfind();\n\tfor(int i = 1;i <= 1000000;i++) if(!~qwq[i]) { //\u7edf\u4e00\u52a0\u8d77\u6765 \n\t\tint k = i;\n\t\twhile(k) {//\u6807\u8bb0\u53ca\u5176\u524d\u9762 nxt[]\u5bf9\u5e94\u7684\u5730\u65b9\u4e5f\u52a0 \n\t\t\tans[k] += ovo[i];//\u4e00\u6b21\u6027\u52a0 \u514d\u5f97\u4e00\u6b21\u4e00\u6b21\u6d6a\u8d39\u65f6\u95f4 \n\t\t\tk = nxt[k];\n\t\t}\n\t}\n\tfor(int i = 1;i <= n;i++) printf(\"%d\\n\",ans[b[i]]);//\u5355\u8bcd\u672b\u5c3e\u5bf9\u5e94\u7684ans\u503c\u5c31\u662f\u7b54\u6848 \n}\n\n```\n",
        "postTime": 1562253903,
        "uid": 48023,
        "name": "stargre",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u540e\u7f00\u6811\u6a21\u677f\u9898\u3002\n\n\u628a\u5b57\u7b26\u4e32\u8fde\u8d77\u6765\u5e76\u7528%\u9694\u5f00\uff0c\u7136\u540e\u5728\u6700\u540e\u52a0\u4e00\u4e2a&\uff0c\u7136\u540e\u6309\u7167ukk\u6cd5\u5efa\u51fa\u540e\u7f00\u6811\uff0c\u5219\u6c42\u6bcf\u4e2a\u5b57\u7b26\u4e32\u51fa\u73b0\u6b21\u6570\u53ea\u9700\u8981\u5728\u540e\u7f00\u6811\u4e0a\u5339\u914d\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7136\u540e\u8f93\u51fa\u5305\u542b\u7684\u53f6\u5b50\u8282\u70b9\uff08\u5373\u540e\u7f00\uff09\u7684\u4e2a\u6570\u3002\n\n```cpp\n#include <stdio.h>\n#include <string.h>\n#include <algorithm>\nusing namespace std;\nconst int N=1e6+210,M=2e6+420;\nint t[M],f[M],c[M][28],zd[M],s[N],siz[M],lj[M],nxt[M],fir[M],fa[M],lf[M];\nint n,ds=1,i,j,k,x,y,z,cc,ad,point,edge,r,bs,fbs,remain,m;\ninline void add(int x,int y)\n{\n\tlj[++fbs]=y;\n\tnxt[fbs]=fir[x];\n\tfir[x]=fbs;\n}\ninline void add(int a,int b,int cc,int d)\n{\n\tzd[++bs]=b;f[bs]=cc;t[bs]=d;c[a][s[cc]]=bs;\n}\nvoid dfs(int x)\n{\n\tif (!fir[x]) {siz[x]=1;return;}\n\tint i,v;\n\tfor (i=fir[x];i;i=nxt[i])\n\t{\n\t\tlf[v=zd[c[x][lj[i]]]]=i;\n\t\tdfs(v);\n\t\tsiz[x]+=siz[v];\n\t}\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor (i=1;i<=n;i++)\n\t{\n\t\tcc=getchar();\n\t\twhile ((cc<'a')||(cc>'z')) cc=getchar();\n\t\twhile ((cc>='a')&&(cc<='z'))\n\t\t{\n\t\t\ts[++m]=cc-'a';cc=getchar();\n\t\t}\n\t\ts[++m]=26;\n\t}s[++m]=27;\n\tfa[1]=point=1;\n\tfor (i=1;i<=m;i++)\n\t{\n\t\tad=0;++remain;\n\t\twhile (remain)\n\t\t{\n\t\t\tif (r==0) edge=i;\n\t\t\tif ((j=c[point][s[edge]])==0)\n\t\t\t{\n\t\t\t\tfa[++ds]=1;\n\t\t\t\tfa[ad]=point;\n\t\t\t\tadd(ad=point,ds,edge,m);\n\t\t\t\tadd(point,s[edge]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif ((t[j]!=m)&&(t[j]-f[j]+1<=r))\n\t\t\t\t{\n\t\t\t\t\tr-=t[j]-f[j]+1;\n\t\t\t\t\tedge+=t[j]-f[j]+1;\n\t\t\t\t\tpoint=zd[j];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (s[f[j]+r]==s[i]) {++r;fa[ad]=point;break;}\n\t\t\t\tfa[fa[ad]=++ds]=1;\n\t\t\t\tadd(ad=ds,zd[j],f[j]+r,t[j]);\n\t\t\t\tadd(ds,s[i]);add(ds,s[f[j]+r]);fa[++ds]=1;\n\t\t\t\tadd(ds-1,ds,i,m);\n\t\t\t\tzd[j]=ds-1;t[j]=f[j]+r-1;\n\t\t\t}\n\t\t\t--remain;\n\t\t\tif ((r)&&(point==1))\n\t\t\t{\n\t\t\t\t--r;edge=i-remain+1;\n\t\t\t} else point=fa[point];\n\t\t}\n\t}\n\tdfs(1);\n\tfor (j=i=1;i<=m;i++) if (s[i]==26)\n\t{\n\t\tx=1;r=0;\n\t\tfor (k=j;k<i;k++)\n\t\t{\n\t\t\tif (r==0) edge=c[x][s[k]];++r;\n\t\t\tif (f[edge]+r>t[edge]) {x=zd[edge];r=0;}\n\t\t}if (r) x=zd[edge];\n\t\tj=i+1;\n\t\tprintf(\"%d\\n\",siz[x]);\n\t}\n}\n```\n",
        "postTime": 1555478599,
        "uid": 29826,
        "name": "SSerxhs",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "## BZOJ3172&&lg3966 TJOI\u5355\u8bcd(\u5e7f\u4e49\u540e\u7f00\u81ea\u52a8\u673a) ##\n### \u9898\u9762\n\u81ea\u5df1\u627e\u53bb\n### HINT\n\u7ed9\u51fa\u591a\u4e2a\u6587\u672c\u4e32\uff0c\u8ba9\u4f60\u67e5\u627e\u6bcf\u4e2a\u6587\u672c\u4e32\u4e00\u5171\u51fa\u73b0\u4e86\u591a\u5c11\u6b21\uff0c\u5e7f\u4e49\u540e\u7f00\u81ea\u52a8\u673a\u5efa\u51faparent tree\u7136\u540e\u4e0a\u63a8\u5c31\u597d\u4e86\u9e2d\uff0c\u611f\u89c9\u4ee3\u7801\u4e5f\u6ca1\u6709\u4ec0\u4e48\u7ec6\u8282\uff0c\u5199\u5c31\u5b8c\u4e8b\u4e86\u3002\n```cpp\n#include<bits/stdc++.h>\n#include<set>\nusing namespace std;\nconst int maxn=200010;\ninline int read(){\n    int w=0,f=1;\n    char ch=getchar();\n    while(ch<'0'||ch>'9'){\n        if(ch=='-') f=-1;\n        ch=getchar();\n    }\n    while(ch>='0'&&ch<='9'){\n        w=(w<<3)+(w<<1)+ch-48;\n        ch=getchar();\n    }\n    return w*f;\n}\nint n,m;\nbool debug;\nset<int> s[maxn];\nset<int>::iterator it;\nint size[2000010];\nstruct SUFFIXAUTOMATON{\n    struct Node{\n        int len,fa;\n        map<int,int> ch;\n    }node[2000010];\n    int lst,tot,root;\n    inline void init(){\n        lst=tot=root=1;return;\n    }\n    inline void extend(int now){\n        int p=lst;tot++;lst=tot;int np=tot;\n        node[np].len=node[p].len+1;size[np]=1;\n        while(p&&!node[p].ch[now]){\n            node[p].ch[now]=np;\n            p=node[p].fa;\n        }\n        if(!p) node[np].fa=1;\n        else{\n            int q=node[p].ch[now];\n            if(node[q].len==node[p].len+1){\n                node[np].fa=q;\n            }\n            else{\n                int nq=++tot;node[nq]=node[q];\n                node[nq].len=node[p].len+1;\n                node[q].fa=nq;node[np].fa=nq;\n                while(p&&node[p].ch[now]==q){\n                    node[p].ch[now]=nq;\n                    p=node[p].fa;\n                }\n            }\n        }\n    }\n}SAM;\nstring ch[210];\nint cnt,head[2000010];\nstruct Edge{\n    int from,to,next;\n}edge[5000010];\ninline void addedge(int u,int v){\n    cnt++;\n    edge[cnt].from=u;\n    edge[cnt].to=v;\n    edge[cnt].next=head[u];\n    head[u]=cnt;\n}\ninline void dfs(int u){\n    for(int i=head[u];i;i=edge[i].next){\n        int v=edge[i].to;dfs(v);\n        size[u]+=size[v];\n    }\n    return;\n}\nint main(){\n    n=read();SAM.init();\n    for(int i=1;i<=n;i++){\n        cin>>ch[i];int len=ch[i].length();\n        for(int j=0;j<len;j++){\n            SAM.extend(ch[i][j]-'a'+1);\n        }\n        SAM.lst=1;\n    }\n    for(int i=2;i<=SAM.tot;i++){\n        addedge(SAM.node[i].fa,i);\n    }\n    dfs(1);\n    for(int i=1;i<=n;i++){\n        int u=1;int len=ch[i].length();\n        for(int j=0;j<len;j++){\n            u=SAM.node[u].ch[ch[i][j]-'a'+1];\n        }\n        printf(\"%d\\n\",size[u]);\n    }\n    return 0;\n}\n```",
        "postTime": 1554041905,
        "uid": 106035,
        "name": "\u6e29\u8bcd",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u6700\u76f4\u63a5\u7684\u60f3\u6cd5\u5c45\u7136\u4e0d\u662f\u6811\u4e0a\u5dee\u5206qwq\n\n\u8003\u8651\u4e00\u4e2a\u66b4\u529b\u7684\u60f3\u6cd5\n\n\u628aAC\u81ea\u52a8\u673a\u5efa\u51fa\u6765\u540e\uff0c\u5bf9\u4e8e\u4f9d\u6b21\u67e5\u8be2\u6bcf\u4e00\u4e2a\u5355\u8bcd\uff0c\u66b4\u529b\u8df3fail\u6307\u9488\n\n\u5bf9\u7ecf\u8fc7\u7684\u5355\u8bcd\u8282\u70b9+1\u3002\n\n\u8003\u8651\u4f18\u5316\u8fd9\u4e2a\u8fc7\u7a0b\n\n\u6ce8\u610f\u5230fail\u6307\u9488\u6784\u6210\u4e86fail\u6811\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u672c\u8d28\u4e0a\u7b49\u4ef7\u4e8e\u5bf9\u4ece\u628a\u4e00\u4e2a\n\n\u70b9\u5230\u6839\u7684\u8def\u5f84\u4e0a\u7684\u6240\u6709\u70b9\u52a0\u4e00\u3002\u8fd9\u4e2a\u64cd\u4f5c\u53ef\u4ee5\u7528\u6811\u4e0a\u5dee\u5206\u6765\u4f18\u5316\u3002\n\n\u590d\u6742\u5ea6O(\u2211len)\u3002\n```\n#include<iostream>\n#include<cctype>\n#include<cstdio>\n#include<cstring>\n#include<string>\n#include<cmath>\n#include<ctime>\n#include<queue>\n#include<cstdlib>\n#include<algorithm>\n#define N 1500000\n#define eps 1e-7\n#define inf 1e9+7\n#define ll long long\nusing namespace std;\ninline int read()\n{\n\tchar ch=0;\n\tint x=0,flag=1;\n\twhile(!isdigit(ch)){ch=getchar();if(ch=='-')flag=-1;}\n\twhile(isdigit(ch)){x=(x<<3)+(x<<1)+ch-'0';ch=getchar();}\n\treturn x*flag;\n}\nconst int mo=inf;\nstruct node\n{\n\tint f,v,nxt[27];\n}t[N];\nstring s,T;\nqueue<int>q; \nint root=1,size=1,times,p[N],dp[N];\nvoid insert()\n{\n\tint x=root,len=s.size();\n\tfor(int i=0;i<len;i++)\n\t{\n\t\tint k=s[i]-'a';\n\t\tif(!t[x].nxt[k])t[x].nxt[k]=++size;\n\t\tx=t[x].nxt[k];\n\t}\n\tt[x].v=true;p[++times]=x;\n}\nvoid build()\n{\n\tq.push(root);\n\twhile(!q.empty())\n\t{\n\t\tint x=q.front();\n\t\tq.pop();\n\t\tfor(int i=0;i<27;i++)\n\t\t{\n\t\t\tif(t[x].nxt[i])\n\t\t\t{\n\t\t\t\tif(x!=root)t[t[x].nxt[i]].f=t[t[x].f].nxt[i];\n\t\t\t\telse t[t[x].nxt[i]].f=root;\n\t\t\t\tq.push(t[x].nxt[i]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif(x!=root)t[x].nxt[i]=t[t[x].f].nxt[i];\n\t\t\t\telse t[x].nxt[i]=root;\n\t\t\t}\n\t\t}\n\t}\n}\nvoid solve()\n{\n\tint x=root,len=T.size();\n\tfor(int i=0;i<len;i++)\n\tx=t[x].nxt[T[i]-'a'],dp[x]++;\t\n}\nstruct edge\n{\n\tint to,nxt;\n}e[N];\nint num=-1,head[N];\ninline void add(int x,int y)\n{\n\te[++num]=(edge){y,head[x]};head[x]=num;\n}\nint dfs(int x)\n{\n\tfor(int i=head[x];i!=-1;i=e[i].nxt)\n\t{\n\t\tint to=e[i].to;\n\t\tdp[x]+=dfs(to);\n\t}\n\treturn dp[x];\n}\nint main()\n{\n\tint n=read();\n\tfor(int i=1;i<=n;i++)\n\tcin>>s,insert(),T+=s+\"{\";\n\tbuild();solve();\n\tmemset(head,-1,sizeof(head));\n\tfor(int i=2;i<=size;i++)add(t[i].f,i);\n\tdfs(1);\n\tfor(int i=1;i<=n;i++)printf(\"%d\\n\",dp[p[i]]);\n\treturn 0;\n}\n```",
        "postTime": 1544079969,
        "uid": 45431,
        "name": "creed_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u53d1\u73b0\u66b4\u529b$AC$\u673a\u786c\u4e0a\u597d\u50cf\u4f1a$T$?\n\n\u90a3\u5c31\u66b4\u529b$kmp$\u786c\u4e0a\u5427\n\n\u53d1\u73b0$n<=200$\u90a3\u4e0d\u5c31\u662f$kmp$\u968f\u4fbf\u8fc7\u7684\u9898\u4e86\n\n\u6ca1\u4ec0\u4e48\u601d\u7ef4\u96be\u5ea6\u4e86\uff0c\u76f4\u63a5\u66b4\u529b\u679a\u4e3e\u6bcf\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4e4b\u540e\u53bb\u548c\u6bcf\u4e00\u4e2a\u5b57\u7b26\u4e32\u641e\u4e00\u4e2a\u5355\u4e32\u5339\u914d\u5c31\u597d\u4e86\n\n\u590d\u6742\u5ea6\u662f$O(n\\times|S|)$\n\n\u4ee3\u7801\n\n```\n\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#define LL long long\n#define min(a,b) ((a)<(b)?(a):(b))\n#define max(a,b) ((a)>(b)?(a):(b))\n#define re register\n#define maxn 1000006 \ninline int read()\n{\n\tchar c=getchar();\n\tint x=0;\n\twhile(c<'0'||c>'9') c=getchar();\n\twhile(c>='0'&&c<='9') x=(x<<3)+(x<<1)+c-48,c=getchar();\n\treturn x;\n}\nstd::string S[201];\nint nx[maxn];\nstd::string s;\nint n;\ninline void get_nx(int x)\n{\n\tint len=S[x].size();\n\tfor(re int i=1;i<len;i++)\n\t\tnx[i]=0;\n\tnx[1]=0;\n\tfor(re int i=2;i<len;i++)\n\t{\n\t\tint p=nx[i-1];\n\t\twhile(p&&S[x][p+1]!=S[x][i]) p=nx[p];\n\t\tif(S[x][p+1]==S[x][i]) nx[i]=p+1;\n\t\t\telse nx[i]=0;\n\t}\n}\ninline int query(int x)\n{\n\tint now=0;\n\tint p=0;\n\tint len=S[x].size();\n\tfor(re int i=1;i<len;i++)\n\t{\n\t\twhile(p&&s[p+1]!=S[x][i]) p=nx[p];\n\t\tif(s[p+1]==S[x][i]) ++p;\n\t\t\telse p=0;\n\t\tif(p==s.size()-1) now++,p=nx[p];\n\t}\n\treturn now;\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(re int i=1;i<=n;i++) std::cin>>S[i],S[i]=\"#\"+S[i];\n\tfor(re int t=1;t<=n;t++)\n\t{\n\t\tget_nx(t);\n\t\ts=S[t];\n\t\tint ans=0;\n\t\tfor(re int j=1;j<=n;j++)\n\t\tif(t!=j) ans+=query(j);\n\t\tprintf(\"%d\\n\",ans+1);\n\t}\n\treturn 0;\n}\n\n```\n",
        "postTime": 1543755457,
        "uid": 35178,
        "name": "asuldb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "~~\u5b9e\u5728\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u8fd9\u662f\u4e00\u9053\u7701\u9009\u9898\uff0c\u6216\u8bb8\u662f $\\sout{T1}$ \u96be\u5ea6\u5427~~\n\n\u4e00\u9053 $AC$ \u81ea\u52a8\u9e21\u7684\u677f\u9898\u3002\n\n\u6a21\u5f0f\u4e32\u5c31\u662f\u8f93\u5165\u7684\u90a3\u4e9b\u5b57\u7b26\u4e32\uff0c\u7528\u90a3\u4e9b\u6a21\u5f0f\u4e32\u5efa\u4e00\u53ea\u9e21\u5373\u53ef\u3002\n\n\u800c\u6587\u672c\u4e32\u53ef\u80fd\u8981\u60f3\u4e00\u4f1a\u2014\u2014\u5c06\u6a21\u5f0f\u4e32\u4e4b\u95f4\u7528\u4e00\u4e9b\u7279\u522b\u7684\u5b57\u7b26\u9694\u5f00\uff0c\u518d\u62fc\u8d77\u6765\uff0c\u5f97\u5230\u7684\u6700\u7ec8\u7684\u4e32\u5c31\u662f\u6211\u4eec\u7684\u6587\u672c\u4e32\u3002\n\n\u81f3\u4e8e\u5269\u4e0b\u7684\uff0c\u6216\u8bb8\u5c31\u662f $AC$ \u81ea\u52a8\u9e21\u7684\u6a21\u677f\u4e86\u3002\n\n\u5982\u679c\u6709 $AC$ \u81ea\u52a8\u9e21\u4e0d\u61c2\u7684\uff0c\u53ef\u4ee5\u95ee\u5ea6\u5a18\u3002\n\n\u6b64\u5904\u4ee3\u7801\u4f7f\u7528\u62d3\u6251\u4f18\u5316 $AC$ \u81ea\u52a8\u9e21\uff0c\u5b89\u5229\u4e00\u4f4d\u5927\u4f6c\u5173\u4e8e $AC$ \u81ea\u52a8\u9e21\u7684\u8bb2\u89e3[sto hyfhaha](https://www.cnblogs.com/hyfhaha/p/10802604.html)\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<vector>\n#include<queue>\nusing namespace std;\n\n#define rep(i,__l,__r) for(signed i=__l,i##_end_=__r;i<=i##_end_;++i)\n#define fep(i,__l,__r) for(signed i=__l,i##_end_=__r;i>=i##_end_;--i)\n#define writc(a,b) fwrit(a),putchar(b)\n#define mp(a,b) make_pair(a,b)\n#define ft first\n#define sd second\n#define LL long long\n#define ull unsigned long long\n#define uint unsigned int\n#define pii pair< int,int >\n#define Endl putchar('\\n')\n// #define FILEOI\n// #define int long long\n// #define int unsigned\n\n#ifdef FILEOI\n# define MAXBUFFERSIZE 500000\n    inline char fgetc(){\n        static char buf[MAXBUFFERSIZE+5],*p1=buf,*p2=buf;\n        return p1==p2&&(p2=(p1=buf)+fread(buf,1,MAXBUFFERSIZE,stdin),p1==p2)?EOF:*p1++;\n    }\n# undef MAXBUFFERSIZE\n# define cg (c=fgetc())\n#else\n# define cg (c=getchar())\n#endif\ntemplate<class T>inline void qread(T& x){\n    char c;bool f=0;\n    while(cg<'0'||'9'<c)f|=(c=='-');\n    for(x=(c^48);'0'<=cg&&c<='9';x=(x<<1)+(x<<3)+(c^48));\n    if(f)x=-x;\n}\ninline int qread(){\n    int x=0;char c;bool f=0;\n    while(cg<'0'||'9'<c)f|=(c=='-');\n    for(x=(c^48);'0'<=cg&&c<='9';x=(x<<1)+(x<<3)+(c^48));\n    return f?-x:x;\n}\ntemplate<class T,class... Args>inline void qread(T& x,Args&... args){qread(x),qread(args...);}\ntemplate<class T>inline T Max(const T x,const T y){return x>y?x:y;}\ntemplate<class T>inline T Min(const T x,const T y){return x<y?x:y;}\ntemplate<class T>inline T fab(const T x){return x>0?x:-x;}\ninline int gcd(const int a,const int b){return b?gcd(b,a%b):a;}\ninline void getInv(int inv[],const int lim,const int MOD){\n    inv[0]=inv[1]=1;for(int i=2;i<=lim;++i)inv[i]=1ll*inv[MOD%i]*(MOD-MOD/i)%MOD;\n}\ntemplate<class T>void fwrit(const T x){\n    if(x<0)return (void)(putchar('-'),fwrit(-x));\n    if(x>9)fwrit(x/10);\n    putchar(x%10^48);\n}\ninline LL mulMod(const LL a,const LL b,const LL mod){//long long multiplie_mod\n    return ((a*b-(LL)((long double)a/mod*b+1e-8)*mod)%mod+mod)%mod;\n}\n\nstruct node{\n    int u,fail;char cr;\n    node(const int U=0,const int F=0,const char C='\\0'):u(U),fail(F),cr(C){}\n};\n\nconst int MAXK=27;\nconst int MAXN=200;\nconst int MAXSIZE=1e6+MAXN;\nconst char spc='z'+1;\n\nint trie[MAXSIZE+5][MAXK+5],fail[MAXSIZE+5],enz[MAXN+5],N,ncnt=1;\nint in[MAXSIZE+5],tot[MAXSIZE+5];\n\nchar T[MAXSIZE+5];\n\ninline void Insert(const char* ss,const int id){\n    int p=1;\n    for(int i=0,siz=strlen(ss),v;i<siz;++i){\n        v=ss[i]-'a';\n        if(!trie[p][v])trie[p][v]=++ncnt;\n        p=trie[p][v];\n    }\n    enz[id]=p;\n}\n\ninline void Getfail(){\n    rep(i,0,MAXK)trie[0][i]=1;\n    queue<int>Q;Q.push(1),fail[1]=0;\n    while(!Q.empty()){\n        int u=Q.front();Q.pop();\n        for(int i=0,v,ff=fail[u];i<MAXK;++i){\n            v=trie[u][i];\n            if(!v){trie[u][i]=trie[ff][i];continue;}\n            fail[v]=trie[ff][i],++in[trie[ff][i]];\n            Q.push(v);\n        }\n    }\n}\n\ninline void Compare(const char* ss){\n    for(int i=0,len=strlen(ss),p=1;i<len;++i){\n        p=trie[p][ss[i]-'a'];\n        ++tot[p];\n    }\n}\n\ninline void Runtopu(){\n    queue<int>Q;\n    rep(i,1,ncnt)if(!in[i])Q.push(i);\n    while(!Q.empty()){\n        int u=Q.front();Q.pop();\n        tot[fail[u]]+=tot[u];\n        --in[fail[u]];\n        if(!in[fail[u]])Q.push(fail[u]);\n    }\n}\n\nsigned main(){\n#ifdef FILEOI\n    freopen(\"file.in\",\"r\",stdin);\n    freopen(\"file.out\",\"w\",stdout);\n#endif\n    qread(N);\n    for(int i=1,prelen=0;i<=N;++i){\n        prelen=strlen(T);\n        if(i!=1)T[prelen]=spc,++prelen;\n        scanf(\"%s\",T+prelen);\n        Insert(T+prelen,i);\n    }\n    Getfail();\n    Compare(T);\n    Runtopu();\n    rep(i,1,N)writc(tot[enz[i]],'\\n');\n    return 0;\n}\n\n```",
        "postTime": 1579968029,
        "uid": 125355,
        "name": "Vladilena",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "**\u8fd9\u9053\u9898\u53ef\u4ee5\u7528\u5b57\u7b26\u4e32\u7684find\u505a\uff0c\u867d\u7136\u4ee3\u7801\u6613\u6253\uff0c\u4f46\u8fd8\u662f\u6709\u8981\u6ce8\u610f\u7684\u5730\u65b9\uff1a**\n\n1\uff1a\u6bcf\u6b21\u67e5\u627e\u4f4d\u7f6e\u4ee5\u540e\uff0c\u4e0b\u4e00\u6b21\u67e5\u627e\u7684\u4f4d\u7f6e\u662f\u4ee5\u4e0a\u4e00\u6b21\u67e5\u627e\u7684\u4f4d\u7f6e\u52a01\uff0c\u5426\u5219\u5c31\u4f1a\u6b7b\u5faa\u73af\u3002\n\n2\uff1a\u5f53find\u67e5\u627e\u4e0d\u5230\u7684\u65f6\u5019\uff0c\u4f3c\u4e4e\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5f88\u5927\u7684\u503c\uff0c\u6240\u4ee5\uff0c\u67e5\u627e\u7684\u4f4d\u7f6e\u5c0f\u4e8e\u5b57\u7b26\u4e32\u957f\u5ea6\u5373\u53ef\u3002\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\nint n,ans;\nstring s[210];\nint main() {\n\tios::sync_with_stdio(false),cin.tie(0),cout.tie(0);//\u4e00\u4e2a\u4f18\u5316\n\tcin>>n;\n\tfor(register int i=1; i<=n; ++i) cin>>s[i];\n\tfor(register int i=1; i<=n; ++i) {\n\t\tans=0;\n\t\tfor(register int j=1; j<=n; ++j) {\n\t\t\tint k=0,kk=s[j].find(s[i],k);\n\t\t\twhile(kk<s[j].length()) {\n\t\t\t\tk=kk+1;\n\t\t\t\tkk=s[j].find(s[i],k);\n\t\t\t\t++ans;\n\t\t\t}\n\t\t}\n\t\tcout<<ans<<endl;\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1565580208,
        "uid": 39434,
        "name": "nbnhzbw",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u7ed9\u51fa$n$\u4e2a\u5355\u8bcd\uff0c\u6c42\u6bcf\u4e2a\u5355\u8bcd\u5728\u8fd9$n$\u4e2a\u5355\u8bcd\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\u3002\n\n\u6982\u5ff5\uff1a$fail$ \u6811\uff1aAC\u81ea\u52a8\u673a\u4e2d\u6bcf\u4e2a$fail$\u6307\u9488\u7684\u53cd\u5411\u8fb9\u4f5c\u4e3a\u4e00\u6761\u6709\u5411\u8fb9\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u70b9\u53ea\u6709$1$\u4e2a$fail$\u6307\u9488\uff0c\u6240\u4ee5\u6bcf\u4e2a\u70b9\u5165\u5ea6\u4e3a$1$\uff0c\u6240\u4ee5\u56fe\u662f\u6811\u5f62\u7684\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u9053\u9898\u6211\u4eec\u53ef\u4ee5\u5efa\u51fa$fail$\u6811\uff0c\u8bbe$siz_i$\u8868\u793a\u6709\u591a\u5c11\u4e2a\u5355\u8bcd\u7ecf\u8fc7i\u8282\u70b9\uff0c\u6240\u4ee5\u6bcf\u4e2a\u8282\u70b9\u7684\u8868\u793a\u7684\u5b57\u7b26\u4e32\u7684\u51fa\u73b0\u6b21\u6570\u5e94\u4e3a\u8be5\u8282\u70b9\u7684$fail$\u6811\u4e2d\u5b50\u6811\u7684$siz$\u7684\u548c\u3002\n\nAC\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define N 201001\n#define MAX 2001\n#define re register\nusing namespace std;\ntypedef long long ll;\ntypedef double db;\ninline void read(re ll &ret)\n{\n    ret=0;re char c=getchar();re bool pd=false;\n    while(!isdigit(c)){pd|=c=='-';c=getchar();}\n    while(isdigit(c)){ret=(ret<<1)+(ret<<3)+(c&15);c=getchar();}\n    ret=pd?-ret:ret;\n    return;\n}\nll n,trie[N][30],tot,nxt[N],num[N],ans,tt,siz[N],b[N],top;\nchar s[N][101],t[N*10];\nll f[N];\ninline void insert(re ll pos)\n{\n    re ll len(strlen(s[pos]+1)),p(0),c;\n    for(re int i(1);i<=len;++i)\n    {\n        c=s[pos][i]-'a';\n        if(!trie[p][c])\n            trie[p][c]=++tot;\n        p=trie[p][c];\n        siz[p]++;\n    }\n    f[pos]=p;\n    return;\n}\ninline void bfs()\n{\n    queue<ll>q;\n    for(re int i=0;i<26;i++)\n        if(trie[0][i])\n            q.push(trie[0][i]);\n    re ll p;\n    while(!q.empty())\n    {\n        p=q.front();\n        b[++top]=p;\n        q.pop();\n        for(re int i(0);i<26;++i)\n        {\n            if(!trie[p][i])trie[p][i]=trie[nxt[p]][i];\n            else\n            {\n                q.push(trie[p][i]);\n                nxt[trie[p][i]]=trie[nxt[p]][i];\n            }\n        }\n    }\n    return;\n}\ninline void AC()\n{\n    re ll len(strlen(t+1)),p(0),c,k;\n    for(re int i(1);i<=len;++i)\n    {\n        c=(t[i]-'a');\n        p=trie[p][c];\n        if(f[p])\n        {\n        \tfor(re int j=p;j;j=nxt[j])\n        \t{\n        \t\tnum[f[j]]++;\n       \t\t\tans=max(ans,f[j]?num[f[j]]:0);\n\t\t\t}\n\t\t}\n    }\n    return;\n}\nmain()\n{\n\tread(n);\n\tif(!n)exit(0);\n   \tfor(re int i(1);i<=n;i++)\n   \t{\n  \t\tscanf(\"%s\",s[i]+1);\n       \tinsert(i);\n    }\n   \tbfs();\n   \tfor(re int i=tot;i>=0;i--)\n   \t\tsiz[nxt[b[i]]]+=siz[b[i]];\n   \tfor(re int i=1;i<=n;i++)\n   \t\tprintf(\"%lld\\n\",siz[f[i]]);\n\texit(0);\n}\n```\n",
        "postTime": 1583676110,
        "uid": 176990,
        "name": "Celtic",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3966 \u3010[TJOI2013]\u5355\u8bcd\u3011"
    }
]