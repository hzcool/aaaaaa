[
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2a\u674e\u8d85\u7ebf\u6bb5\u6811\u7684\u89e3\u6cd5\u3002\n\n\u9996\u5148\uff0c $O(n^2)$ \u7684 dp \u8f6c\u79fb\u65b9\u7a0b\u6781\u5176\u663e\u7136\uff1a\n\n$f_i=\\min\\{f_j+h_i^2-2h_ih_j+h_j^2+s_{i-1}-s_j\\}$\n\n\u5176\u4e2d\uff0c $s$ \u662f\u62c6\u9664\u4ee3\u4ef7 $w$ \u7684\u524d\u7f00\u548c\u3002\n\n\u5c06\u5f0f\u5b50\u5316\u7b80\uff0c\u5f97\u5230\uff1a\n\n$f_i=h_i^2+s_{i-1}+\\min\\{f_j-2h_ih_j+h_j^2-s_j\\}$\n\n\u4ee4 $a_j=-2h_j$ \uff0c $b_j=f_j+h_j^2-s_j$ \uff0c\u5219\uff1a\n\n$f_i=h_i^2+s_{i-1}+\\min\\{a_jh_i+b_j\\}$\n\n\u95ee\u9898\u8f6c\u5316\u4e3a\uff0c\u63d2\u5165\u76f4\u7ebf $y_j=a_jx+b_j$ \uff0c\u6c42 $x=h_i$ \u65f6 $y_j$ \u7684\u6700\u5c0f\u503c\u3002\n\n\u5f88\u660e\u663e\uff0c\u53ef\u4ee5\u7528\u674e\u8d85\u7ebf\u6bb5\u6811\u4f18\u5316\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$ \u3002\n\n\u4ee3\u7801\u5f88\u77ed\uff0c\u6bd4 cdq \u5206\u6cbb\u597d\u5199\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n//\u6ce8\u610f\u5f00long long\nconst int N=1e5+9,M=1e6+9;\nll a[N],b[N],h[N],w[N],f[N];\nint s[M<<2],u;\ninline ll g(int x,int o){return b[o]+a[o]*x;}\n//\u5bf9\u7ed9\u5b9a\u76f4\u7ebf\u548c\u6a2a\u5750\u6807\u6c42\u7eb5\u5750\u6807\nvoid upd(int k,int l,int r,int t){\n\tif(l==r){\n\t\tif(g(l,t)<g(l,s[k]))s[k]=t;\n\t\treturn;\n\t}\n\tint m=l+r>>1;\n\tif(g(m,t)<g(m,s[k]))swap(t,s[k]);\n\tif(g(l,t)<g(l,s[k]))upd(k<<1,l,m,t);\n\telse if(g(r,t)<g(r,s[k]))upd(k<<1|1,m+1,r,t);\n}//\u63d2\u5165\u76f4\u7ebf\nll qry(int k,int l,int r){\n\tif(l==r)return g(u,s[k]);\n\tint m=l+r>>1;\n\treturn min(g(u,s[k]),u<=m?qry(k<<1,l,m):qry(k<<1|1,m+1,r));\n}//\u67e5\u8be2\nint main(){\n\tint n,i;\n\tscanf(\"%d\",&n),b[0]=1e18;\n\tfor(i=1;i<=n;++i)scanf(\"%lld\",h+i);\n\tfor(i=1;i<=n;++i)scanf(\"%lld\",w+i),w[i]+=w[i-1];\n\ta[1]=-2*h[1],b[1]=h[1]*h[1]-w[1],upd(1,0,M,1);\n\tfor(i=2;i<=n;++i){\n\t\tu=h[i],f[i]=h[i]*h[i]+w[i-1]+qry(1,0,M);\n\t\ta[i]=-2*h[i],b[i]=f[i]+h[i]*h[i]-w[i],upd(1,0,M,i);\n\t}\n\tprintf(\"%lld\",f[n]);\n\treturn 0;\n}\n```\n",
        "postTime": 1585372216,
        "uid": 221955,
        "name": "panyf",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4655 \u3010[CEOI2017]Building Bridges\u3011"
    },
    {
        "content": "\u6211\u793e\u533a\u8d21\u732e\u5206\u5feb\u6389\u6ca1\u4e86\n\n\u6709\u4e24\u7bc7 CDQ \u5206\u6cbb\u7684\u9898\u89e3\u88ab\u6570\u636e #19 \u5361\u6389\u4e86\n\n[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P4655)\n\n### \u9898\u610f\u7b80\u8ff0\n\n- \u6709 $n$ \u6839\u67f1\u5b50\uff0c\u7b2c $i$ \u6839\u67f1\u5b50\u9ad8\u5ea6\u4e3a $h_i$\uff1b\u62c6\u9664\u4e00\u4e2a\u67f1\u5b50\u9700\u8981\u82b1\u8d39 $w_i$\uff1b\u5728\u67f1\u5b50 $i$\u3001$j$ \u95f4\u8fde\u63a5\u7684\u82b1\u8d39\u4e3a $(h_i-h_j)^2$\u3002\u4f60\u9700\u8981\u4fdd\u7559\u4e00\u4e9b\u67f1\u5b50\uff0c\u5176\u4e2d\u7b2c $1$ \u548c $n$ \u53f7\u67f1\u5b50\u5fc5\u987b\u4fdd\u7559\uff0c\u62c6\u9664\u5176\u4f59\u67f1\u5b50\uff0c\u5e76\u8fde\u63a5\u76f8\u90bb\u7684\u4fdd\u7559\u7684\u67f1\u5b50\u3002\n\n- \u4f60\u9700\u8981\u786e\u5b9a\u4e00\u4e2a\u4fdd\u7559\u65b9\u6848\uff0c\u4f7f\u5f97\u603b\u82b1\u8d39\u6700\u5c0f\u3002\n\n- $n \\le 10^5$\uff0c$h_i, |w_i| \\le 10^6$\u3002\n\n### \u7b97\u6cd5\n\n\u82b1\u8d39\u4e3a\u5e73\u65b9\u5f0f\uff0c\u8fd9\u5f88\u659c\u7387\u4f18\u5316\u3002\n\n\u8bbe $f_i$ \u8868\u793a\u8003\u8651\u524d $i$ \u4e2a\u67f1\u5b50\u5e76\u5f3a\u5236\u4fdd\u7559\u7b2c $i$ \u4e2a\u67f1\u5b50\u7684\u6700\u5c0f\u82b1\u8d39\uff0c\u8bb0 $s_i=\\sum\\limits_{j=1}^iw_j$\u3002\n\n$$f_i = \\min\\{f_j+s_{i-1}-s_j+(h_i-h_j)^2\\}$$\n\n\u7528\u659c\u4f18\u7684\u5957\u8def\u62c6\u62c6\u5f0f\u5b50\uff0c\u8bb0 $X_i=h_i$\uff0c$Y_i=h_i^2+f_i-s_i$\uff0c\u4e14 $j \\le k$\uff1a\n\n$$2h_i(X_k-X_j) \\ge {Y_k-Y_j}$$\n\n\u4f60\u5f00\u5fc3\u5730\u5199\u4e86\u4e2a\u5355\u8c03\u961f\u5217\u4e8c\u5206\uff0c\u7136\u540e\u5f00\u5fc3\u7684\u7206\u96f6\u4e86\u3002\n\n\u7136\u540e\u4f60\u53d1\u73b0\u8fd9\u9898\u4e0d\u4ec5\u659c\u7387\u4e0d\u5355\u8c03\uff0c\u8fde\u81ea\u53d8\u91cf\u53d6\u503c\u4e5f\u662f\u4e0d\u5355\u8c03\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\u4ec5\u4ec5\u5355\u8c03\u961f\u5217\u662f\u6ca1\u6cd5\u7ef4\u62a4\u7684\u3002\n\n\u90a3\u600e\u4e48\u529e\u5462\uff1f\n\n\u4e0d\u59a8\u5f3a\u884c\u8ba9\u81ea\u53d8\u91cf\u5355\u8c03\u3002\u8003\u8651\u5206\u6cbb\uff0c\u6b64\u65f6\u53f3\u533a\u95f4\u5bf9\u5de6\u8fb9\u662f\u6ca1\u6709\u8d21\u732e\u7684\uff0c\u6240\u4ee5\u5148\u8ba1\u7b97\u5de6\u533a\u95f4\u7684 DP \u503c\uff0c\u7136\u540e\u8003\u8651\u5176\u5bf9\u53f3\u533a\u95f4\u7684\u5f71\u54cd\uff0c\u6700\u540e\u518d\u9012\u5f52\u53f3\u533a\u95f4\u3002\u56de\u6eaf\u65f6\u518d\u6309\u7167 $X_i$ \u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0c$Y_i$ \u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\u5f52\u5e76\u6392\u5e8f\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u5728\u9012\u5f52\u524d\u5148\u5728\u8be5\u533a\u95f4\u5185\u6309\u7167 $X_i$ \u6392\u5e8f\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u81ea\u53d8\u91cf\u548c\u659c\u7387\u5355\u8c03\u4e0d\u964d\uff0c\u6545\u5de6\u533a\u95f4\u5bf9\u53f3\u533a\u95f4\u7684\u8f6c\u79fb\u76f4\u63a5\u5355\u8c03\u961f\u5217\u5373\u53ef\u3002\n\n\u5f53\u9012\u5f52\u5230\u5355\u4e2a\u7ed3\u70b9 $l$ \u65f6\uff0c\u5b83\u7684 DP \u503c\u5df2\u7ecf\u8ba1\u7b97\u5b8c\u4e86\uff0c\u53ef\u4ee5\u7b97\u51fa $Y_l$\u3002  \n\n\u4f60\u53d1\u73b0\u8fd9\u5c31\u662f CDQ \u5206\u6cbb\uff0c\u5bb9\u6613\u53d1\u73b0\u50cf\u8fd9\u6837\u5728\u5206\u6cbb\u8fc7\u7a0b\u4e2d\u8f6c\u79fb\u662f\u4e0d\u4f1a\u9057\u6f0f\u7684\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n### \u4ee3\u7801\u5b9e\u73b0\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n\nusing namespace std;\n\ntypedef long long ll;\nconst int MAXN = 100010;\n\nint n;\nll h[MAXN], s[MAXN], f[MAXN];\ninline ll pw2(ll x) {return x*x;}\ninline ll X(int i) {return h[i];}\ninline ll Y(int i) {return pw2(h[i])+f[i]-s[i];}\nstruct node{\n\tll x, y;\n\tint ind;\n\tnode(ll X=0,ll Y=0,int I=0):x(X),y(Y),ind(I){}\n\tbool operator<(const node&o)const{return x ^ o.x ? x < o.x : y < o.y;}\n}a[MAXN], tmp[MAXN];\n\nint q[MAXN], he, ta;\n\nvoid cdq(int l, int r)\n{\n\tif(l == r)\n\t{\n\t\ta[l].y = Y(l);\n\t\treturn ;\n\t}\n\tint mid = (l+r)>>1;\n\tint x = l, y = mid+1;\n\tfor(int i=l;i<=r;i++)\n\t\tif(a[i].ind <= mid) tmp[x++] = a[i];\n\t\telse tmp[y++] = a[i];\n\tfor(int i=l;i<=r;i++)\n\t\ta[i] = tmp[i];\n\tcdq(l, mid);\n\the = 1; ta = 0;\n\tfor(int i=l;i<=mid;i++)\n\t{\n\t\tif(i > l && a[i].x == a[i-1].x) continue;\n\t\twhile(he < ta && (a[i].y-a[q[ta]].y)*(a[q[ta]].x-a[q[ta-1]].x) <= (a[q[ta]].y-a[q[ta-1]].y)*(a[i].x-a[q[ta]].x))\n\t\t\t--ta;\n\t\tq[++ta] = i;\n\t}\n\tfor(int i=mid+1;i<=r;i++)\n\t{\n\t\twhile(he < ta && a[q[he+1]].y-a[q[he]].y <= 2*a[i].x*(a[q[he+1]].x-a[q[he]].x)) ++he;\n\t\tint u = a[i].ind, v = a[q[he]].ind;\n\t\tf[u] = min(f[u], f[v] + s[u-1] - s[v] + pw2(h[u] - h[v]));\n\t}\n\tcdq(mid+1, r);\n\tx = l; y = mid+1;\n\tint now = l;\n\twhile(x <= mid && y <= r)\n\t{\n\t\tif(a[x].x < a[y].x || (a[x].x == a[y].x && a[x].y < a[y].y)) tmp[now++] = a[x++];\n\t\telse tmp[now++] = a[y++];\n\t}\n\twhile(x <= mid) tmp[now++] = a[x++];\n\twhile(y <= r) tmp[now++] = a[y++];\n\tfor(int i=l;i<=r;i++) a[i] = tmp[i];\n}\n\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%lld\",h+i), a[a[i].ind = i].x = h[i];\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%lld\",s+i), s[i] += s[i-1];\n\tfor(int i=2;i<=n;i++)\n\t\tf[i] = 0x3f3f3f3f3f3f3f3f;\n\tsort(a+1, a+n+1);\n\tcdq(1, n);\n\tprintf(\"%lld\\n\",f[n]);\n\treturn 0;\n}\n```\n",
        "postTime": 1612420614,
        "uid": 151601,
        "name": "Aphros",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4655 \u3010[CEOI2017]Building Bridges\u3011"
    },
    {
        "content": "\u8bbe $S_n=\\sum_{i=1}^n w_i$\uff0c\u5219\u6709\r\n$$\\begin{aligned}F_i&=\\min\\{F_j+S_{i-1}-S_j+(h_i-h_j)^2\\}\\\\   &=S_{i-1}+h_i^2+\\min\\{F_j-S_j+h_j^2-2h_ih_j\\}\\\\\\end{aligned}$$\r\n\r\n\u5047\u8bbe $h_j \\lt h_k$\uff0c\u5219 $k$ \u6bd4 $j$ \u66f4\u4f18\u7684\u6761\u4ef6\u4e3a\r\n$$\\begin{aligned}F_j-S_j+h_j^2-2h_ih_j &\\ge F_k-S_k+h_k^2-2h_ih_k\\\\2h_i(h_k-h_j) &\\ge F_k-S_k+h_k^2-(F_j-S_j+h_j^2)\\end{aligned}$$\r\n\r\n\u8bbe $y_i=F_i-S_i+h_i^2,x_i=h_i$\uff0c\u5219\r\n$$\\frac{y_k-y_j}{x_k-x_j} \\le 2h_i$$\r\n\r\nCDQ \u5206\u6cbb\u659c\u7387\u4f18\u5316 DP \u5373\u53ef\uff0c\u6309\u7167 $h_i$ \u6392\u5e8f\uff0c\u5efa\u51fa\u51f8\u58f3\uff0c\u53f3\u534a\u8fb9\u659c\u7387\u5355\u8c03\u9012\u589e\uff0c\u7528\u659c\u7387\u4f18\u5316 DP \u7684\u6a21\u578b\u89e3\u51b3\u5373\u53ef\u3002\r\n\r\n```cpp\r\n#include <cstdio>\r\n#include <cstring>\r\n#include <algorithm>\r\n\r\ntypedef long long ll;\r\ntypedef long double ld;\r\nconst int maxN = 100005;\r\n\r\nint N, H[maxN], W[maxN];\r\nint Pos[maxN];\r\nll S[maxN], Y[maxN], X[maxN];\r\nll F[maxN];\r\n\r\ninline ld slope(int j, int k)\r\n{\r\n\tif (X[k] == X[j])\r\n\t\treturn Y[k] > Y[j] ? 1e20 : -1e20;\r\n\treturn (ld)(Y[k] - Y[j]) / (X[k] - X[j]);\r\n}\r\n\r\nvoid solve(int l, int r)\r\n{\r\n\tif (l == r)\r\n\t{\r\n\t\tint i = Pos[l];\r\n\t\tY[i] = F[i] - S[i] + (ll)H[i] * H[i];\r\n\t\tX[i] = H[i];\r\n\t\treturn;\r\n\t}\r\n\tint m = (l + r) >> 1;\r\n\tstd::stable_partition(Pos + l, Pos + r + 1, [&](int x) {\r\n\t\treturn x <= m;\r\n\t});\r\n\tsolve(l, m);\r\n\tstatic int qu[maxN];\r\n\tint *qs = qu, *qe = qu;\r\n\tfor (int j = l; j <= m; ++j)\r\n\t{\r\n\t\tint i = Pos[j];\r\n\t\twhile (qe - qs > 1 && slope(*(qe - 1), i) <= slope(*(qe - 1), *qe))\r\n\t\t\t--qe;\r\n\t\t*++qe = i;\r\n\t}\r\n\t++qs;\r\n\tfor (int j = m + 1; j <= r; ++j)\r\n\t{\r\n\t\tint i = Pos[j];\r\n\t\twhile (qs != qe && slope(*qs, *(qs + 1)) <= 2 * H[i])\r\n\t\t\t++qs;\r\n\t\tF[i] = std::min(F[i], F[*qs] + (ll)(H[i] - H[*qs]) * (H[i] - H[*qs]) + S[i - 1] - S[*qs]);\r\n\t}\r\n\tsolve(m + 1, r);\r\n\tstd::inplace_merge(Pos + l, Pos + m + 1, Pos + r + 1, [](int x, int y) {\r\n\t\treturn H[x] < H[y];\r\n\t});\r\n}\r\n\r\nint main()\r\n{\r\n\tscanf(\"%d\", &N);\r\n\tfor (int i = 1; i <= N; ++i)\r\n\t\tscanf(\"%d\", H + i);\r\n\tfor (int i = 1; i <= N; ++i)\r\n\t\tscanf(\"%d\", W + i), S[i] = S[i - 1] + W[i];\r\n\t\r\n\tfor (int i = 1; i <= N; ++i)\r\n\t\tPos[i] = i;\r\n\tstd::sort(Pos + 1, Pos + 1 + N, [](int x, int y) {\r\n\t\treturn H[x] < H[y];\r\n\t});\r\n\tmemset(F, 0x7F, sizeof(F));\r\n\r\n\tF[1] = 0;\r\n\tsolve(1, N);\r\n\r\n\tprintf(\"%lld\\n\", F[N]);\r\n\r\n\treturn 0;\r\n}\r\n```",
        "postTime": 1552374032,
        "uid": 3144,
        "name": "\u6d6e\u5c18ii",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4655 \u3010[CEOI2017]Building Bridges\u3011"
    },
    {
        "content": "\u4e0d\u4f1a\u674e\u8d85\u6811\uff0c\u5199\u4e2a\u4e8c\u8fdb\u5236\u5206\u7ec4\u7684\u505a\u6cd5\u3002\n\n\u9996\u5148\u770b\u5230 $ ( h_i - h_j )^2 $ ,\u5dee\u4e0d\u591a\u5c31\u80fd\u731c\u5230\u662f\u659c\u7387\u4f18\u5316\u3002\n\n\u63a8\u4e00\u6ce2\u5f0f\u5b50\uff1a\n\n\u8bbe $ f_i $ \u4e3a\u628a\u7b2c $ 1 $ \u6839\u67f1\u5b50\u548c\u7b2c $ i $ \u6839\u67f1\u5b50\u8fde\u63a5\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\n\n$ h_i $ \u4ee3\u8868\u7b2c $ i $ \u6839\u67f1\u5b50\u7684\u9ad8\u5ea6\uff0c\n\n$ s_i $ \u4ee3\u8868\u62c6\u9664\u524d $ i $ \u6839\u67f1\u5b50\u7684\u4ee3\u4ef7\u4e4b\u548c\u3002\n\n\u5219 $ f_i = \\{ f_j + ( h_i - h_j )^2 + s_{i-1} -s_j \\}_{\\min} \\quad (1 \\leq j < i) $ \n\n\u5316\u7b80\u5f97 $ f_i = {h_i}^2 + s_{i-1}+ \\{ f_j + {h_j}^2 -s_j - 2 h_i h_j \\}_{\\min} \\quad (1 \\leq j < i) $ \n\n\u5373\u6211\u4eec\u7684\u6a2a\u5750\u6807\u4e3a $ h_j $ \uff0c\u7eb5\u5750\u6807\u4e3a $ f_j + {h_j}^2 -s_j $ \uff0c\u5bf9\u6bcf\u4e2a $ i $ \u6c42\u659c\u7387\u4e3a $ 2 h_i $ \u7684\u76f4\u7ebf\u80fd\u622a\u5230\u7684\u622a\u8ddd\u7684\u6700\u5c0f\u503c\u3002\n\n\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u9898\u7684\u6a2a\u5750\u6807\u4e0d\u5355\u8c03\uff0c\u96be\u4ee5\u7528\u5355\u8c03\u6808\u7ef4\u62a4\uff08~~[\u7136\u540e\u6211\u5199\u4e86\u4e00\u68f5Splay\u7ef4\u62a4\u51f8\u5305](https://www.luogu.com.cn/record/42585702)~~ \n\n\u5728\u673a\u623f\u91cc\u8c03\u4e864\u4e2a\u5c0f\u65f6\u6ca1\u8c03\u51fa\u6765\uff0c\u5ffd\u7136\u60f3\u8d77\u53ef\u4ee5\u4e8c\u8fdb\u5236\u5206\u7ec4\uff0c\u4e0d\u4ec5\u5bb9\u6613\u5199\uff0c\u5e38\u6570\u8fd8\u5c0f\u5f88\u591a\uff0c~~\u4e8e\u662f\u679c\u65ad Ctrl+A Delete~~\n\n\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u4e8c\u8fdb\u5236\u5206\u7ec4\uff1a\n\n\u6240\u8c13\u201c\u5206\u7ec4\u201d\uff0c\u4fbf\u662f\u628a\u6240\u7ef4\u62a4\u7684\u6570\u636e\uff08\u5728\u672c\u9898\u4e2d\u662f\u70b9\uff09\u5206\u4e3a\u82e5\u5e72\u7ec4\uff0c\u5176\u4e2d\u7b2c $ i $ \u7ec4\uff08$ i \\geq 0 $\uff09\u7684\u70b9\u6570\u4e3a $ 2^i $ (\u663e\u7136\u65e0\u8bba\u4f55\u65f6\u6211\u4eec\u90fd\u53ea\u6709\u4e0d\u8d85\u8fc7 $ O(\\log n) $ \u4e2a\u7ec4)\n\n\u5bf9\u4e8e\u6bcf\u4e00\u6b21\u63d2\u5165\uff0c\u6211\u4eec\u76f8\u5f53\u4e8e\u6dfb\u52a0\u4e86\u4e00\u4e2a $ 2^0 $ \u5927\u5c0f\u7684\u7ec4\uff0c\u6b64\u65f6\u5982\u679c\u5df2\u7ecf\u5b58\u5728\u4e00\u4e2a $ 2^0 $ \u5927\u5c0f\u7684\u7ec4\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5b83\u548c\u63d2\u5165\u7684\u6570\u636e\u5408\u5e76\uff0c\u5e76\u4f5c\u4e3a\u4e00\u4e2a $ 2^1 $ \u5927\u5c0f\u7684\u7ec4\uff0c\u4e0e\u539f\u6709\u7684 $ 2^1 $ \u5927\u5c0f\u7684\u7ec4\u7ee7\u7eed\u5411\u4e0a\u5408\u5e76\u3002\u76f4\u5230\u6709\u4e00\u7ec4\u4e0d\u5b58\u5728\uff0c\u6211\u4eec\u5c31\u7528\u65b0\u6dfb\u52a0\u7684\u7ec4\u4ee3\u66ff\u8be5\u7ec4\u3002\n\n\u5728\u5408\u5e76\u65f6\u4f1a\u6709\u4e00\u4e9b\u70b9\u56e0\u4e3a\u5de6\u53f3\u659c\u7387\u4e0d\u6ee1\u8db3\u5355\u8c03\u6027\u6216 $ x $ \u503c\u76f8\u7b49\u800c\u88ab\u5220\u9664\uff0c\u4f46\u662f\u6211\u4eec\u4ecd\u628a\u4e24\u4e2a\u7ec4\u5408\u5e76\u524d\u7684\u5927\u5c0f\uff08\u5047\u8bbe\u90fd\u4e3a $ 2^i $ \uff09\u89c6\u4e3a\u4e24\u4e2a\u7ec4\u7684\u5927\u5c0f\u4e4b\u548c( $ 2^{i+1} $ )\n\n\u56e0\u4e3a\u6240\u6709\u70b9\u6700\u591a\u4f1a\u88ab\u5408\u5e76 $ O(\\log n) $ \u6b21\uff0c\u5171\u6709 $ n $ \u4e2a\u70b9\uff0c\u6240\u4ee5\u63d2\u5165\u603b\u590d\u6742\u5ea6\u662f $ O(n\\log n) $ \n\n\u5bf9\u4e8e\u67e5\u627e\uff0c\u76f4\u63a5\u5c06\u6240\u6709\u7ec4\u7684\u6700\u4f18\u503c\u5168\u90e8\u4e8c\u5206\u627e\u51fa\uff0c\u518d\u53d6\u4e2a\u6700\u4f18\u5373\u53ef\u3002\u56e0\u4e3a\u5171\u6709 $ O(\\log n) $ \u4e2a\u7ec4\uff0c\u5355\u4e2a\u7ec4\u4e8c\u5206\u67e5\u627e\u6700\u4f18\u503c\u7684\u590d\u6742\u5ea6\u662f $ O(\\log n) $ \uff0c\u6240\u4ee5\u67e5\u627e $ n $ \u6b21\u7684\u603b\u590d\u6742\u5ea6 $ O(n\\log^2 n) $ \n\n\u6700\u7ec8\u590d\u6742\u5ea6 $ O(n\\log^2 n) $ \uff0c\u4f46\u5e38\u6570\u8f83\u5c0f\uff0c[\u8dd1\u5f97\u8fd8\u633a\u5feb](https://www.luogu.com.cn/record/42627083)\n\n\u4ee3\u7801\uff1a\uff08\u6709\u5927\u91cf\u5361\u5e38\u64cd\u4f5c\uff0c\u56e0\u4e3a\u6211\u76f4\u63a5\u4ece\u5e73\u8861\u6811\u7ef4\u62a4\u7684\u4ee3\u7801\u4e0a\u6539\u7684\uff0c~~\u61d2\u5f97\u6539\u4e86~~\uff09\n\n```cpp\n#include <cstdio>\n#include <algorithm>\nusing namespace std;\ntypedef long long ll;\nll dp[100001],h[100001],s[100001];\nstruct node{\n\tint at;\n\tll x,y;\n}b[550000];//\u6240\u6709\u7ec4\u653e\u5728\u4e00\u4e2a\u6570\u7ec4\u91cc\uff0c\u8282\u7701\u5185\u5b58\ninline ll mmin(const ll &x,const ll &y){\n\treturn x<y?x:y;\n}\ninline bool chk(const node &n1,const node &n2,const node &n3){\n\treturn n3.x==n2.x?n3.y<=n2.y:(n3.y-n2.y)*(n2.x-n1.x)<=(n2.y-n1.y)*(n3.x-n2.x);\n}\nstruct stk{\n\tint h,t;//head\u548ctail (tail\u5728\u8fd9\u91cc\u662f\u5c3e\u6307\u9488\uff09\n\tbool ext;//\u8be5\u7ec4\u662f\u5426\u5b58\u5728\n\tinline void add(const node &x){\n\t\twhile(t>h&&chk(b[t-1],b[t],x))--t;\n\t\tif(t>=h&&x.x==b[t].x)\n\t\t\tif(x.y>b[t].y)return;\n\t\t\telse --t;\n\t\tb[++t]=x;\n\t}\n\tinline node qus(const ll &k){//\u5355\u7ec4\u67e5\u627e\n\t\tint l=h,r=t,mid;\n\t\twhile(l<r){\n\t\t\tmid=l+r>>1;\n\t\t\tif(k*(b[mid+1].x-b[mid].x)>b[mid+1].y-b[mid].y)l=mid+1;\n\t\t\telse r=mid;\n\t\t}\n\t\treturn b[l];\n\t}\n}q[18],z,mr;\ninline void cpy(stk &x,const stk &y){//\u4e00\u5b9a\u8981\u6ce8\u610f\u662f\u628a\u6570\u636e\u590d\u5236\u8fc7\u53bb\u800c\u975e\u76f4\u63a5\u6539head\u548ctail\n\tx.t=x.h-1;\n\tfor(int j=y.h;j<=y.t;++j)\n\t\tb[++x.t]=b[j];\n}\ninline void mrg(const int &at){//\u5408\u5e76\u4e24\u4e2a\u7ec4\n\tmr.h=400001,mr.t=400000;\n\tfor(int i=z.h,j=q[at].h;i<=z.t||j<=q[at].t;)\n\t\tif(i>z.t||(j<=q[at].t&&b[i].x>b[j].x))mr.add(b[j]),++j;\n\t\telse mr.add(b[i]),++i;\n\tcpy(z,mr);\n}\nint sum=-1;\ninline void psh(const node &x){//\u4e8c\u8fdb\u5236\u5206\u7ec4\u7684\u63d2\u5165\n\tz.h=265001,z.t=265000,z.ext=1;\n\tz.add(x);\n\tint at=0;\n\twhile(at<=sum&&q[at].ext){\n\t\tq[at].ext=0;\n\t\tmrg(at);\n\t\t++at;\n\t}\n\tif(at==sum+1)++sum;\n\tcpy(q[at],z);\n\tq[at].ext=1;\n}\ninline node fnd(const ll &k){//\u4e8c\u8fdb\u5236\u5206\u7ec4\u7684\u67e5\u627e\n\tnode ans;\n\tint at=0;\n\twhile(!q[at].ext)++at;\n\tans=q[at].qus(k);\n\twhile(++at<=sum){\n\t\tconst node &t=q[at].qus(k);\n\t\tif(t.y-k*t.x<ans.y-k*ans.x)ans=t;\n\t}\n\treturn ans;\n}\ninline int rd(){//\u5feb\u8bfb\n\tregister int x=0,f=1;\n\tregister char c=getchar();\n\twhile(c!='-'&&(c<'0'||c>'9'))c=getchar();\n\tif(c=='-')f=0,c=getchar();\n\twhile(c>='0'&&c<='9')x=(x<<1)+(x<<3)+(c^48),c=getchar();\n\treturn f?x:-x;\n}\nvoid pt(const ll &x){//\u5feb\u5199\n\tif(x>9)pt(x/10);\n\tputchar((x%10)|48);\n}\nint main(){\n\tregister int n;\n\tn=rd();\n\tfor(int i=0;i<18;++i)q[i].h=1<<i;\n\tfor(register int i=1;i<=n;++i)h[i]=rd();\n\tfor(register int i=1;i<=n;++i)s[i]=rd()+s[i-1];\n\tpsh((node){1,h[1],h[1]*h[1]-s[1]});//\u5148\u628a\u7b2c1\u4e2a\u67f1\u5b50\u7279\u6b8a\u5904\u7406\uff08\u56e0\u4e3a\u5b83\u4e0d\u9700\u8981\u4efb\u4f55\u4ee3\u4ef7\u5c31\u4e0e\u81ea\u5df1\u8fde\u63a5\uff09\n\tfor(register int i=2;i<=n;++i){\n\t\tconst node &now=fnd(2*h[i]);\n\t\tdp[i]=now.y+s[i-1]+h[i]*(h[i]-(now.x<<1));\n\t\tpsh((node){i,h[i],dp[i]+h[i]*h[i]-s[i]});\n\t}\n\tif(dp[n]<0)putchar('-'),dp[n]=-dp[n];//\u8d1f\u6570\u8f93\u51fa\n\tpt(dp[n]);\n\treturn 0;\n}\n```\n~~\u4e3a\u4ec0\u4e48\u6211\u6240\u6709\u7684\u9898\u89e3\u90fd\u7528\u7684\u5947\u602a\u505a\u6cd5\u554a~~",
        "postTime": 1606465388,
        "uid": 179182,
        "name": "CCCCOrz",
        "ccfLevel": 7,
        "title": "P4655 [CEOI2017]Building Bridges \u9898\u89e3"
    },
    {
        "content": "[$\\Huge \\texttt{In Cnblogs}$](https://www.cnblogs.com/Wendigo/p/12803378.html)\n\n---\n\n> [\\[CEOI2017\\]Building Bridges](https://www.luogu.com.cn/problem/P4655)\n\n> \u6709 $n$ \u4e2a\u6865\u58a9\uff0c\u9ad8 $h_i$ \u91cd $w_i$\u3002\u8fde\u63a5 $i$ \u548c $j$ \u6d88\u8017\u4ee3\u4ef7 $(h_i-h_j)^2$\uff0c\u7528\u4e0d\u5230\u7684\u6865\u58a9\u88ab\u62c6\u9664\uff0c\u4ee3\u4ef7\u4e3a $w_i$\u3002\u6c42\u4f7f $1$ \u4e0e $n$ \u8054\u901a\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n> \u6570\u636e\u8303\u56f4\uff1a$2\\le n\\le 10^5$\uff0c$0\\le h_i,|w_i|\\le 10^6$\u3002\n\n---\n\u975e\u5e38\u7ecf\u5178\u7684 **[\u674e\u8d85\u7ebf\u6bb5\u6811](https://www.cnblogs.com/Wendigo/p/12694123.html)\u7ef4\u62a4 $\\texttt{dp}$** \u7684\u9898\u76ee\uff0c\u5c0f\u849f\u84bb\u6765\u5206\u4eab\u4e00\u4e0b\u3002\n\n---\n\u5f88\u660e\u663e $w_i$ \u662f\u5927\u7247\u5927\u7247\u6d88\u8017\u7684\uff0c\u6240\u4ee5\u8bb0 $s_i=\\sum_{j=1}^i w_j$\u3002\n\n\u4ee4 $f_i$ \u8868\u793a**\u8fde\u63a5\u5230\u7b2c $i$ \u4e2a\u6865\u58a9\u7684\u6700\u5c0f\u4ee3\u4ef7**\u3002\u53ef\u4ee5\u91ce\u86ee\u63a8\u5f0f\uff1a\n\n\n![image.png](https://i.loli.net/2020/04/30/aok6zf9UZcXw7hl.png)\n\n\u8fd9\u8c8c\u4f3c\u662f\u4e2a\u659c\u7387\u4f18\u5316\u5f0f\u5b50\uff0c\u4f46\u849f\u84bb\u4e0d\u7ba1\uff0c\u7528\u674e\u8d85\u7ebf\u6bb5\u6811\u600e\u4e48\u505a\u5462\uff1f\n\n\u8003\u8651\u674e\u8d85\u7ebf\u6bb5\u6811\u7684\u4f5c\u7528\uff1a**\u591a\u6761\u7ebf\u6bb5\uff08\u76f4\u7ebf\uff09\uff0c\u6c42\u5355\u70b9\u6700\u503c\u3002**\n\n\u53d1\u73b0\u8fd9\u4e2a $j$ \u6709\u5f88\u591a\uff0c\u800c $i$ \u5c31\u53ea\u6709\u5f53\u524d\u4e00\u4e2a\uff1a\u6240\u4ee5\u53ef\u4ee5 $i$ \u5bf9\u5e94\u5355\u70b9\uff0c$j$ \u5bf9\u5e94\u7ebf\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c**\u53ef\u4ee5\u628a\u6bcf\u4e2a $f_i$ \u6c42\u51fa\u6765\u540e\u6dfb\u52a0\u4e00\u6761\u76f4\u7ebf**\u3002\n\n![image.png](https://i.loli.net/2020/04/30/2jcAYZRgf4ptWTP.png)\n\n---\n\u8fd9\u9898\u6709\u51e0\u4e2a\u5751\uff0c\u672c\u6765\u662f\u5e94\u8be5\u7531\u4f60\u6765\u5feb\u4e50\u5730\u8c03\u8bd5\u7684\uff0c\u4f46\u662f\u65e2\u7136\u5199\u4e86\u9898\u89e3\uff0c\u849f\u84bb\u5c31\u653e\u51fa\u6765\u4e86\uff1a\n\n1. \u56e0\u4e3a\u8981\u8ba1\u7b97 $h_j^2$\uff0c\u6240\u4ee5\u8981\u5f00 $\\texttt{long long}$ \u6216\u7528 $1ll$ \u4e58\u4e4b\u3002\n2. \u8fd9\u4e2a\u674e\u8d85\u7ebf\u6bb5\u6811\u662f\u6743\u503c\u7ebf\u6bb5\u6811\uff0c\u4e0b\u6807\u8981\u5f00 $10^6$ \u4e2a\uff0c\u8282\u70b9\u4e2a\u6570\u8981\u5f00 $4\\cdot 10^6$ \u4e2a\u3002\n\n\u8fd9\u4e2a\u505a\u6cd5\u8c8c\u4f3c\u6709\u70b9\u8f9c\u8d1f\u4e86\u8fd9\u9898\u7684\u96be\u5ea6\uff0c\u4f46\u662f\u849f\u84bb\u53ea\u4f1a\u8fd9\u4e48\u505a\u3002\u849f\u84bb\u8bb2\u4e0d\u6e05\u695a\uff0c\u8fd8\u662f\u653e\u4e2a\u84bb\u84bb\u7684\u4ee3\u7801\u5427\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n//Start\n#define lng long long\n#define db double\n#define mk make_pair\n#define pb push_back\n#define fi first\n#define se second\n#define rz resize\nconst int inf=0x3f3f3f3f;\nconst lng INF=0x3f3f3f3f3f3f3f3f;\n\n//Data\nconst int N=1e5,M=1e6;\nint n,h[N+7];\nlng w[N+7],f[N+7];\n\n//Lichaotree\ntypedef pair<lng,lng> line;\nlng g(line&li,int x){return li.fi*x+li.se;}\nint inter(line&la,line&lb){return db(lb.se-la.se)/(la.fi-lb.fi);}\nline v[(M<<2)+7];\nvoid add(line li,int k=1,int l=0,int r=M){\n\tint mid((l+r)>>1);\n\tlng ly1=g(li,l),ry1=g(li,r),ly=g(v[k],l),ry=g(v[k],r);\n\tif(ly1>=ly&&ry1>=ry);\n\telse if(ly1<=ly&&ry1<=ry) v[k]=li;\n\telse {\n\t\tint in=inter(li,v[k]);\n\t\tif(ly1<=ly){\n\t\t\tif(in<=mid) add(li,k<<1,l,mid);\n\t\t\telse add(v[k],k<<1|1,mid+1,r),v[k]=li;\n\t\t} else {\n\t\t\tif(in>mid) add(li,k<<1|1,mid+1,r);\n\t\t\telse add(v[k],k<<1,l,mid),v[k]=li;\n\t\t}\n\t}\n}\nlng get(int x,int k=1,int l=0,int r=M){\n\tlng res(g(v[k],x));\n\tif(l==r) return res;\n\tint mid((l+r)>>1);\n\tif(mid>=x) res=min(res,get(x,k<<1,l,mid));\n\telse res=min(res,get(x,k<<1|1,mid+1,r));\n\treturn res;\n}\n\n//Main\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&h[i]);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&w[i]),w[i]+=w[i-1];\n\tfill(v+1,v+(M<<2)+1,mk(0,INF));\n\tf[1]=0,add(mk(-2ll*h[1],1ll*h[1]*h[1]-w[1]));\n\tfor(int i=2;i<=n;i++){\n\t\tf[i]=1ll*h[i]*h[i]+w[i-1]+get(h[i]);\n\t\tadd(mk(-2ll*h[i],f[i]+1ll*h[i]*h[i]-w[i]));\n\t}\n\tprintf(\"%lld\\n\",f[n]);\n\treturn 0;\n}\n```\n---\n\n**\u795d\u5927\u5bb6\u5b66\u4e60\u6109\u5feb\uff01**",
        "postTime": 1588254177,
        "uid": 118365,
        "name": "George1123",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4655 \u3010[CEOI2017]Building Bridges\u3011"
    },
    {
        "content": "\u8003\u8651\u8ba1\u7b97\u6240\u6709\u62c6\u9664\u67f1\u5b50\u7684\u8d21\u732e\uff0c\u518d\u5728\u8f6c\u79fb\u8fc7\u7a0b\u4e2d\u6d88\u53bb\n\n\u4e8e\u662f\u5f97\u5230\u4e00\u4e2a\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n\n$$f_i=\\begin{cases}\\displaystyle\\sum_{i=2}^n w_i&(i=1)\\\\\\displaystyle\\min\\{f_j+(h_i-h_j)^2-w_i)\\}&(i>1)\\end{cases}$$\n\n\u7b54\u6848\u5373\u4e3a $f_n$\n\n\u4e8e\u662f\u5c31\u6709\u4e86\u4e00\u4e2a\u4f18\u79c0\u7684 $O(n^2)$ \u7684\u8fc7\u4e0d\u53bb\u7b97\u6cd5\u4e86\n\n\u7136\u800c\u8fd9\u73a9\u610f\u513f\u662f\u53ef\u4ee5\u659c\u7387\u4f18\u5316\u7684\n\n\u901a\u8fc7\u4e00\u756a\u5957\u8def\u5730\u5316\u5f0f\u5b50\uff0c\u53ef\u4ee5\u5f97\u5230\n\n$$f_j+h_j^2=2h_ih_j+f_i-h_i^2+w_i$$\n\n\u4ee4 $h_j$ \u4e3a\u6a2a\u5750\u6807\uff0c $f_j+h_j^2$ \u4e3a\u7eb5\u5750\u6807\uff0c $2h_i$ \u4e3a\u659c\u7387\n\n\u7136\u540e\u2026\u2026\u53ef\u4ee5\u53d1\u73b0 $h_j$ \u4e0d\u662f\u9012\u589e\u7684\u2026\u2026\n\n\u8fd9\u5c31\u610f\u5473\u7740\u2026\u2026\u9700\u8981\u652f\u6301\u63d2\u5165\uff0c\u8be2\u95ee\u524d\u9a71\u540e\u7ee7\uff0c\u4ee5\u53ca\u4e00\u4e9b\u590d\u6742\u7684\u5206\u7c7b\u8ba8\u8bba\u2026\u2026\n\n~~\u6211\u4f1a\u5e73\u8861\u6811\u7ef4\u62a4\u52a8\u6001\u51f8\u5305\uff01~~\n\n\u7136\u800c\u6709\u66f4\u597d\u7684\u79bb\u7ebf\u89e3\u51b3\u529e\u6cd5\uff1acdq\u5206\u6cbb\n\n\u5f3a\u5236\u8ba9\u659c\u7387\u9012\u589e\u7136\u540e\u8ba1\u7b97\u8d21\u732e\n\n\u56de\u60f3cdq\u5206\u6cbb\u7684\u8fc7\u7a0b\uff0c\u5de6\u53f3\u9012\u5f52\uff0c\u8ba1\u7b97\u5de6\u4fa7\u5bf9\u53f3\u4fa7\u7684\u8d21\u732e\n\n\u5982\u679c\u5de6\u4fa7\u659c\u7387\u9012\u589e\uff0c\u5e76\u4e14\u5de6\u4fa7\u7f16\u53f7\u5c0f\u4e8e\u53f3\u4fa7\uff0c\u90a3\u4e48\u53ef\u4ee5\u901a\u8fc7\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u5de6\u4fa7\u7684\u51f8\u5305\u6765\u66f4\u65b0\u53f3\u4fa7\u7b54\u6848\n\n\u5e76\u4e14\u8fd9\u6837\u4e00\u5b9a\u80fd\u591f\u904d\u5386\u51fa\u6bcf\u4e2a\u8282\u70b9\u7684\u6240\u6709\u51b3\u7b56\u70b9\n\n\u6ce8\u610f $long\\ long$ \uff0c\u4ee5\u53ca\u6c42\u659c\u7387\u65f6 $x_1=x_2$ \u7684\u60c5\u51b5\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\n\n\u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef double db;\ntypedef long long ll;\nconst int maxn = 1e5 + 10;\nll f[maxn];\nint n, w[maxn];\n\nstruct node {\n  int x, tid; ll y;\n} a[maxn], dat[maxn];\n\nll sqr(ll x) { return x * x; }\ndb slope(int x, int y) {\n  if (a[x].x == a[y].x) {\n    return a[x].y < a[y].y ? 1e18 : -1e18;\n  }\n  return db(a[x].y - a[y].y) / db(a[x].x - a[y].x);\n}\n\nvoid cdq(int l, int r) {\n  if (l == r) {\n    a[l].y = f[a[l].tid] + sqr(a[l].x);\n    return;\n  }\n  int mid = (l + r) >> 1;\n  for (int i = l, p1 = l, p2 = mid + 1; i <= r; i++) {\n    if (a[i].tid <= mid) {\n      dat[p1++] = a[i];\n    } else {\n      dat[p2++] = a[i];\n    }\n  }\n  for (int i = l; i <= r; i++) {\n    a[i] = dat[i];\n  }\n  cdq(l, mid);\n  int L = 1, R = 0;\n  static int q[maxn];\n  for (int i = l; i <= mid; i++) {\n    while (L < R && slope(q[R - 1], q[R]) > slope(q[R], i)) R--;\n    q[++R] = i;\n  }\n  for (int i = mid + 1; i <= r; i++) {\n    while (L < R && slope(q[L], q[L + 1]) < 2 * a[i].x) L++;\n    int x = a[i].tid, y = a[q[L]].tid;\n    f[x] = min(f[x], f[y] + sqr(a[i].x - a[q[L]].x) - w[x]);\n  }\n  cdq(mid + 1, r);\n  for (int i = l, p1 = l, p2 = mid + 1; i <= r; i++) {\n    if (p2 > r || (p1 <= mid && a[p1].x < a[p2].x)) {\n      dat[i] = a[p1++];\n    } else {\n      dat[i] = a[p2++];\n    }\n  }\n  for (int i = l; i <= r; i++) {\n    a[i] = dat[i];\n  }\n}\n\nint main() {\n  scanf(\"%d\", &n);\n  for (int i = 1; i <= n; i++) {\n    scanf(\"%d\", &a[i].x);\n    a[i].tid = i, f[i] = 1ll << 60;\n  }\n  f[1] = 0;\n  for (int i = 1; i <= n; i++) {\n    scanf(\"%d\", w + i);\n    if (i > 1) f[1] += w[i];\n  }\n  sort(a + 1, a + n + 1, [](node a, node b) {\n    return a.x < b.x;\n  });\n  cdq(1, n);\n  printf(\"%lld\", f[n]);\n  return 0;\n}\n```",
        "postTime": 1554564159,
        "uid": 73934,
        "name": "Juanzhang",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4655 \u3010[CEOI2017]Building Bridges\u3011"
    },
    {
        "content": "\u8bbe$s_i$\u4e3a$w_i$\u7684\u524d\u7f00\u548c\uff0c$f_i$\u8868\u793a\u5c06\u7b2c$1$\u6839\u67f1\u5b50\u4e0e\u7b2c$i$\u6839\u67f1\u5b50\u8fde\u63a5\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\u8003\u8651\u6700\u540e\u4e00\u5ea7\u6865\u4ece\u7b2c$j$\u6839\u67f1\u5b50\u67b6\u5230\u7b2c$i$\u6839\u67f1\u5b50\uff0c\u4e8e\u662f\u679a\u4e3e$j$\uff0c\u6709\u8f6c\u79fb\n\n$$f_i=\\min\\{f_j+s_{i-1}-s_j+(h_i-h_j)^2\\}$$\n\n\u628a\u5e73\u65b9\u5c55\u5f00\uff0c\u63d0\u51fa\u4ec5\u4e0e$i$\u6709\u5173\u7684\u9879\n\n$$f_i=\\min\\{f_j-s_j+h_j^2-2h_ih_j\\}+s_{i-1}+h_i^2$$\n\n\u8bbe$y_i=f_i-s_i+h_i^2,x_i=h_i,k_i=2h_i$\uff0c\u90a3\u4e48\n\n$$f_i=\\min\\{y_j-k_ix_j\\}+s_{i-1}+h_i^2$$\n\n\u662f\u6bd4\u8f83\u663e\u7136\u7684\u659c\u7387\u4f18\u5316\u3002\u7531\u4e8e\u8fd9\u91cc\u659c\u7387\u548c\u6a2a\u5750\u6807\u90fd\u4e0d\u5355\u8c03\uff0c\u4e0d\u80fd\u7b80\u5355\u7528\u5355\u8c03\u961f\u5217\u89e3\u51b3\u3002\u53ef\u4ee5\u4f7f\u7528splay\u7ef4\u62a4\u52a8\u6001\u51f8\u5305\u3002\n\n\u8fd9\u91cc\u659c\u7387\u662f\u6b63\u7684\uff0c\u8981\u6700\u5c0f\u5316\u622a\u8ddd\uff0c\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u4e0b\u51f8\u58f3\u3002\n\n\u5728splay\u4e0a\u7ef4\u62a4\u76ee\u524d\u7684\u4e0b\u51f8\u58f3\u4e0a\u7684\u7ed3\u70b9\uff0c\u7ed3\u70b9\u6a2a\u5750\u6807\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u5373\u4e3asplay\u4e2d\u5e8f\u904d\u5386\u7684\u987a\u5e8f\u3002\n\n\u5728splay\u4e0a\u5bf9\u6bcf\u4e2a\u8282\u70b9$x$\u8bb0\u5f55$\\mathrm{lk}_x$\u548c$\\mathrm{rk}_x$\u4e24\u4e2a\u503c\uff0c\u5206\u522b\u4ee3\u8868\u5728\u51f8\u58f3\u4e0a$x$\u5de6\u4fa7\u90a3\u4e2a\u70b9\u4e0e\u5b83\u7684\u8fde\u7ebf\u7684\u659c\u7387\uff08\u4e0d\u59a8\u79f0\u4e3a\u201c\u5de6\u7ebf\u659c\u7387\u201d\uff09\u548c\u5b83\u53f3\u4fa7\u90a3\u4e2a\u70b9\u4e0e\u5b83\u8fde\u7ebf\u7684\u659c\u7387\uff08\u4e0d\u59a8\u79f0\u4e3a\u201c\u53f3\u7ebf\u659c\u7387\u201d\uff09\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5728splay\u4e0a\u4e8c\u5206\u6765\u627e\u5230\u5bf9\u4e8e$i$\u7684\u6700\u4f18\u51b3\u7b56\u70b9$j$\u8fdb\u884c\u8f6c\u79fb\u3002\u5bf9\u4e8e\u5f53\u524d\u8282\u70b9$x$\uff1a\n\n- \u5982\u679c$\\mathrm{lk}_x\\leq k_i\\leq\\mathrm{rk}_x$\uff0c\u8bf4\u660e\u8fd9\u6761\u76f4\u7ebf\u5728\u8fd9\u91cc\u4e0e\u51f8\u58f3\u76f8\u5207\uff0c\u8fd9\u4e2a\u70b9$x$\u5c31\u662f\u6700\u4f18\u51b3\u7b56\u70b9\u3002\n\n- \u5982\u679c$k_i<\\mathrm{lk}_x$\uff0c\u8bf4\u660e\u5207\u70b9\u5728\u5de6\u4fa7\uff0c\u5bf9\u5de6\u5b50\u6811\u9012\u5f52\u8c03\u7528\u3002\n\n- \u5982\u679c$k_i>\\mathrm{rk}_x$\uff0c\u8bf4\u660e\u5207\u70b9\u5728\u53f3\u4fa7\uff0c\u5bf9\u53f3\u5b50\u6811\u9012\u5f52\u8c03\u7528\u3002\n\n\u6c42\u51fa$f_i$\u4e4b\u540e\u8981\u5c06\u8fd9\u4e2a\u70b9\u63d2\u5165\u5e73\u8861\u6811\u3002\u9996\u5148\u6309\u6a2a\u5750\u6807\u9012\u589e\u987a\u5e8f\u627e\u5230\u5b83\u7684\u63d2\u5165\u4f4d\u7f6e\uff0c\u63d2\u5165\u8fd9\u4e2a\u7ed3\u70b9\u5e76splay\u5230\u6839\u3002\u7136\u540e\u68c0\u67e5\u5b83\u5de6\u53f3\u7684\u7ed3\u70b9\uff0c\u628a\u7531\u4e8e\u5b83\u7684\u63d2\u5165\u800c\u4e0d\u6ee1\u8db3\u51f8\u5305\u6027\u8d28\u7684\u70b9\u5220\u9664\uff0c\u540c\u65f6\u6c42\u51fa\u5b83\u7684\u5de6\u53f3\u7ebf\u659c\u7387\u3002\u6700\u540e\u68c0\u67e5\u5982\u679c\u5b83\u7684\u5de6\u7ebf\u659c\u7387\u5927\u4e8e\u53f3\u7ebf\u659c\u7387\uff0c\u8bf4\u660e\u8fd9\u4e2a\u7ed3\u70b9\u4e0d\u5728\u51f8\u58f3\u4e0a\uff0c\u5c06\u5b83\u5220\u9664\u3002\n\n\u4e24\u4e2a\u6ce8\u610f\u70b9\uff1a$f_1$\u548c$f_2$\u8981\u5355\u72ec\u62ce\u51fa\u6765\u5199\uff0c\u8fd8\u6709\u6ce8\u610f\u659c\u7387\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u3002\n\n\u7c7b\u4f3c\u7684\u9898\u76ee\u53ef\u4ee5\u770b\u770bNOI2007\u7684\u8d27\u5e01\u5151\u6362\n\n```cpp\n#include <cctype>\n#include <cstdio>\n#include <climits>\n#include <algorithm>\n#include <cmath>\n\ntemplate <typename T> inline void read(T& x) {\n    int f = 0, c = getchar(); x = 0;\n    while (!isdigit(c)) f |= c == '-', c = getchar();\n    while (isdigit(c)) x = x * 10 + c - 48, c = getchar();\n    if (f) x = -x;\n}\ntemplate <typename T, typename... Args>\ninline void read(T& x, Args&... args) {\n    read(x); read(args...); \n}\ntemplate <typename T> void write(T x) {\n    if (x < 0) x = -x, putchar('-');\n    if (x > 9) write(x / 10);\n    putchar(x % 10 + 48);\n}\ntemplate <typename T> inline void writeln(T x) { write(x); puts(\"\"); }\ntemplate <typename T> inline bool chkmin(T& x, const T& y) { return y < x ? (x = y, true) : false; }\ntemplate <typename T> inline bool chkmax(T& x, const T& y) { return x < y ? (x = y, true) : false; }\n\ntypedef long long LL;\n\nconst int maxn = 1e5 + 207;\nconst double inf = 1e16, eps = 1e-10;\n\nLL s[maxn], h[maxn], f[maxn];\ndouble lk[maxn], rk[maxn], xc[maxn], yc[maxn];\nint ch[maxn][2], fa[maxn], root;\nint n;\n\ninline double slope(int i, int j) {\n    if (fabs(xc[i] - xc[j]) <= eps) return yc[i] < yc[j] ? inf : -inf;\n    return (yc[i] - yc[j]) / (xc[i] - xc[j]);\n}\ninline int iden(int x) {\n    return ch[fa[x]][0] == x ? 0 : (ch[fa[x]][1] == x ? 1 : -1);\n}\ninline void rotate(int x) {\n    int d = iden(x), y = fa[x];\n    if (~iden(y)) ch[fa[y]][iden(y)] = x;\n    fa[x] = fa[y];\n    if ((ch[y][d] = ch[x][d ^ 1])) fa[ch[x][d ^ 1]] = y;\n    fa[ch[x][d ^ 1] = y] = x;\n}\ninline void splay(int x, int &k) {\n    if (x == k) return;\n    for (int p = fa[k], y = fa[x]; y != p; y = fa[x]) {\n        if (fa[y] != p) rotate(iden(y) ^ iden(x) ? x : y);\n        rotate(x);\n    }\n    k = x;\n}\nint queryBest(int x, double k) {\n    if (!x) return 0;\n    if (lk[x] <= k + eps && k <= rk[x] + eps) return x;\n    if (k + eps >= rk[x]) return queryBest(ch[x][1], k);\n    else return queryBest(ch[x][0], k);\n}\ninline int getPrev(int x) {\n    int ans = 0;\n    for (int y = ch[x][0]; y;) {\n        if (lk[y] <= slope(y, x) + eps) ans = y, y = ch[y][1];\n        else y = ch[y][0];\n    }\n    return ans;\n}\ninline int getNext(int x) {\n    int ans = 0;\n    for (int y = ch[x][1]; y;) {\n        if (slope(x, y) <= rk[y] + eps) ans = y, y = ch[y][0];\n        else y = ch[y][1];\n    }\n    return ans;\n}\ninline void update(int &rt, int x) {\n    splay(x, rt);\n    if (ch[x][0]) {\n        int y = getPrev(x);\n        splay(y, ch[x][0]);\n        ch[y][1] = 0;\n        rk[y] = lk[x] = slope(y, x);\n    } else lk[x] = -inf;\n    if (ch[x][1]) {\n        int y = getNext(x);\n        splay(y, ch[x][1]);\n        ch[y][0] = 0;\n        rk[x] = lk[y] = slope(x, y);\n    } else rk[x] = inf;\n    if (lk[x] + eps >= rk[x]) {\n        rt = ch[x][0];\n        fa[ch[rt][1] = ch[x][1]] = rt;\n        fa[rt] = 0;\n        rk[rt] = lk[ch[rt][1]] = slope(rt, ch[rt][1]);\n    }\n}\nvoid insert(int &x, int dad, int id) {\n    if (!x) { fa[x = id] = dad; return; }\n    insert(xc[x] <= xc[id] + eps ? ch[x][1] : ch[x][0], x, id);\n}\n\nint main() {\n    read(n);\n    for (int i = 1; i <= n; ++i) read(h[i]);\n    for (int i = 1, x; i <= n; ++i) read(x), s[i] = s[i - 1] + x;\n\n    f[1] = 0;\n    xc[1] = h[1];\n    yc[1] = f[1] - s[1] + 1.0 * h[1] * h[1];\n    f[2] = 1ll * (h[2] - h[1]) * (h[2] - h[1]);\n    xc[2] = h[2];\n    yc[2] = f[2] - s[2] + 1.0 * h[2] * h[2];\n    insert(root, 0, 1); update(root, 1);\n    insert(root, 0, 2); update(root, 2);\n\n    for (int i = 3; i <= n; ++i) {\n        int j = queryBest(root, 2 * h[i]);\n        f[i] = f[j] + s[i - 1] - s[j] + (h[i] - h[j]) * (h[i] - h[j]);\n        xc[i] = h[i];\n        yc[i] = f[i] - s[i] + 1.0 * h[i] * h[i];\n        insert(root, 0, i);\n        update(root, i);\n    }\n    writeln(f[n]);\n    return 0;\n}",
        "postTime": 1556895767,
        "uid": 72071,
        "name": "GKxx",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4655 \u3010[CEOI2017]Building Bridges\u3011"
    },
    {
        "content": "\u4ecb\u7ecd\u4e00\u4e0b\u674e\u8d85\u7ebf\u6bb5\u6811\uff1a\n\n\u674e\u8d85\u7ebf\u6bb5\u6811\u53ef\u4ee5\u7ef4\u62a4\u4e00\u5806\u7ebf\u6bb5\u4e0a\u6c42 $x=a$ \u7684\u6700\u503c\u7684\u95ee\u9898\u3002\n\n\u7c7b\u4f3c\u4e8e\u666e\u901a\u7ebf\u6bb5\u6811\uff0c\u4e0d\u8fc7\u6bcf\u4e2a\u533a\u95f4 $[l,r]$ \u90fd\u7ef4\u62a4\u7684\u662f\u4e00\u6761\u5728 $mid$ \u5904\u6700\u4f18\u7684\u7ebf\u6bb5\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u6c42 $x=a$ \u7684\u6700\u503c\u65f6\u7528\u6bcf\u4e2a\u5305\u542b $a$ \u7684\u8282\u70b9\u4e0a\u7684\u7ebf\u6bb5\u5206\u522b\u6c42\u6700\u503c\u5373\u53ef\u3002\n\n\u6bd4\u5982\u8fd9\u9053\u9898\uff0c\u5199\u51fa dp \u65b9\u7a0b\uff1a\n\n$$dp_x=min\\{dp_i+(h_i-h_x)^2-W_i+W_x\\}$$\n\n\u5176\u4e2d $W_x = \\sum_{i=1}^{x-1}w_i$\n\n\u90a3\u4e48\u53ef\u4ee5\u8f6c\u5316\u6210\u4e00\u4e2a\u7c7b\u4f3c\u659c\u7387\u4f18\u5316\u7684\u5f0f\u5b50\uff1a\n\n$$dp_x-W_x-{h_x}^2=dp_i+{h_i}^2-W_i-2h_ih_x$$\n\n\u4e8e\u662f\u5c31\u662f\u6c42\u4e0e\u76f4\u7ebf $x=h_x$ \u76f8\u4ea4\u7684\u6700\u4f4e\u70b9\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u7528\u674e\u8d85\u7ebf\u6bb5\u6811\u7ef4\u62a4\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define l(x) tree[x].l\n#define lazy(x) tree[x].lazy\n#define ls(x) (tree[x].son[0])\n#define rs(x) (tree[x].son[1])\n#define ll long long\n#define Mid ((L+R)>>1)\nusing namespace std;\ntypedef pair<int,int> pii;\ninline int read(){\n\tchar c;int x=0;int b=1;do{c=getchar();if(c==45)b=-1;}while(c>57||c<48);\n\tdo x=x*10+c-48,c=getchar();while(c<=57&&c>=48);x*=b;return x;\n}\nconst int maxn=200010;\nint i,j,k,n,m,root,cnt;\nll h[maxn],w[maxn],dp[maxn];\nstruct line{\n\tll k,b;\n\tll calc(ll x){\n\t\treturn k*x+b;\n\t}\n};\nstruct tree{\n\tline l;\n\tint son[2];\n}tree[maxn*4]\nvoid insert(int &root,int L,int R,line g){\n\tif(!root){\n\t\troot=++cnt;\n\t\tlazy(root)=1;\n\t\tl(root)=g;\n\t\treturn;\n\t}\n\tif(L==R){\n\t\tif(g.calc(L)<l(root).calc(L))l(root)=g;\n\t\treturn;\n\t}\n\tif(g.calc(Mid)<l(root).calc(Mid))swap(l(root),g);\n\tif(g.k>l(root).k)insert(ls(root),L,Mid,g);\n\telse if(g.k<l(root).k)insert(rs(root),Mid+1,R,g);\n}\nll find(int root,int L,int R,int x){\n\tif(!root)return 1e18;\n\tif(L==R)return l(root).calc(x);\n\tif(x<=Mid)return min(find(ls(root),L,Mid,x),l(root).calc(x));\n\treturn min(find(rs(root),Mid+1,R,x),l(root).calc(x));\n}\nll ans=1e18;\nsigned main() {\n\tfreopen(\"P4655.in\",\"r\",stdin);\n\tfreopen(\"P4655.out\",\"w\",stdout);\n\tcin>>n;\n\tfor(i=1;i<=n;i++)h[i]=read();\n\tfor(i=1;i<=n;i++)w[i]=read();\n\tfor(i=1;i<=n;i++)w[i]+=w[i-1];\n\tdp[1]=0;insert(root,1,1e6,(line){-2*h[1],dp[1]+h[1]*h[1]-w[1]});\n\tfor(i=2;i<=n;i++){\n\t\tdp[i]=find(root,1,1e6,h[i])+h[i]*h[i]+w[i-1];\n\t\tinsert(root,1,1e6,(line){-2*h[i],dp[i]+h[i]*h[i]-w[i]});\n\t}cout<<dp[n]<<endl;\n\t//cerr << 1.0*clock()/CLOCKS_PER_SEC << endl;\n\treturn 0;\n}\n```",
        "postTime": 1603458198,
        "uid": 35891,
        "name": "huangzirui",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4655 \u3010[CEOI2017]Building Bridges\u3011"
    },
    {
        "content": "\u660e\u663e\u662f dp\u3002\n\n\u9996\u5148\u5217\u51fa dp \u5f0f\u5b50\uff0c\u8bbe $f_i$ \u4e3a\u8df3\u5230 $i$ \u65f6\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n\u90a3\u4e48\uff1a\n\n$f_i=f_j+(h_i-h_j)^2+(sum_{i-1}-sum_j)$\u3002\n\n$f_i=f_j+h_i^2+h_j^2+2h_ih_j+sum_{i-1}-sum_j$\n\n$f_j+h_j^2-sum_j=-2h_ih_j+f_i-h_i^2-sum_{i-1}$\n\n\u660e\u663e\u659c\u7387\u5f0f\uff0c\u8003\u8651\u659c\u7387\u4f18\u5316\uff0c\u4f46 $h_i,h_j$ \u5747\u65e0\u5355\u8c03\u6027\u3002\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u7528\u659c\u7387\u4e09\u4ef6\u5957\u4e86\uff1a\u674e\u8d85\u7ebf\u6bb5\u6811\uff0c\u5e73\u8861\u6811\uff0ccdq \u5206\u6cbb\uff0c\u8fd9\u91cc\u9009\u62e9 cdq \u5206\u6cbb\u3002\n\n\u6b65\u9aa4\u5982\u4e0b\uff1a\n\n1\u3001\u5bf9\u5de6\u8fb9\u8fdb\u884c\u5206\u6cbb\u3002\n\n2\u3001\u7ef4\u62a4\u5de6\u8fb9\u51f8\u5305\u3002\n\n3\u3001\u5bf9\u53f3\u8fb9\u659c\u7387\u6392\u5e8f\u3002\n\n4\u3001\u5bf9\u53f3\u8fb9\u8fdb\u884c\u5206\u6cbb\u3002\n\n5\u3001\u5bf9\u6574\u4e2a\u533a\u95f4\u7684\u70b9\u6309 $x$ \u6392\u5e8f\uff0c\u7528\u6765\u7ef4\u62a4\u4e0b\u6b21\u7684\u51f8\u5305\u3002\n\n\u9012\u5f52\u5230\u8fb9\u754c\u65f6\u6ce8\u610f\u5904\u7406\u70b9\u7684\u5750\u6807\n\n\u672c\u9898\u6c42\u6700\u5c0f\u503c\uff0c\u6240\u4ee5\u7ef4\u62a4\u4e0b\u51f8\u5305\uff0c\u659c\u7387\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u5269\u4e0b\u7684\u5c31\u6ca1\u4ec0\u4e48\u4e86\u3002\n\n\u7531\u4e8e\u61d2\uff0c\u6240\u4ee5\u6392\u5e8f\u9009\u62e9\u4e86 sort\uff0c\u6bd4\u5f52\u5e76\u590d\u6742\u5ea6\u9ad8\uff0c\u4f46\u95ee\u9898\u4e0d\u5927\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n\\times\\log_2^2(n))$\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#define int long long\nusing namespace std;\nconst int N=2e5+5;\nint h[N],sum[N],n,s[N],f[N];\nstruct node\n{\n\tint name,x,y;\n}q[N];\nint cmp(node fi,node se)\n{\n\tif(fi.x==se.x)return fi.y>se.y;\n\treturn fi.x<se.x;\n}\nint cmp2(node fi,node se)\n{\n\treturn h[fi.name]<h[se.name];\n}\nint cmp3(node fi,node se)\n{\n\treturn fi.name<se.name;\n}\ninline int clac(int x)\n{\n\treturn x*x;\n}\ndouble slope(int x,int y)\n{\n\tif(q[x].x==q[y].x)return -1e18;\n\treturn (q[x].y-q[y].y)*1.0/1.0/(q[x].x-q[y].x);\n}\nvoid cdq(int l,int r)\n{\n\tif(l==r)\n\t{\n\t\tq[l].x=h[l];\n\t\tq[l].y=f[l]-sum[l]+clac(h[l]);\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tcdq(l,mid);\n\tint lc=1,rc=0;\n\tfor(int i=l;i<=mid;i++)\n\t{\n\t\twhile(lc<rc&&slope(s[rc],s[rc-1])>=slope(i,s[rc]))rc--;\n\t\ts[++rc]=i;\n\t}\n\tsort(q+mid+1,q+r+1,cmp2);\n\tfor(int i=mid+1;i<=r;i++)\n\t{\n\t\twhile(lc<rc&&slope(s[lc],s[lc+1])<=2*h[q[i].name])lc++;\n\t\tf[q[i].name]=min(f[q[i].name],f[q[s[lc]].name]+sum[q[i].name-1]-sum[q[s[lc]].name]+clac(h[q[i].name]-h[q[s[lc]].name]));\n\t}\n\tsort(q+mid+1,q+r+1,cmp3);\n\tcdq(mid+1,r);\n\tsort(q+l,q+r+1,cmp);\n}\nsigned main()\n{\n\tmemset(f,0x3f,sizeof(f));\n\tf[1]=0;\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&h[i]),q[i].name=i;\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&sum[i]),sum[i]+=sum[i-1];\n\tcdq(1,n);\n\tprintf(\"%lld\",f[n]);\n\treturn 0;\n}\n/*\n10\n1 2 3 4 5 4 3 2 1 0\n-1 -1 -1 -1 -1 -1 -1 -1 -1 -1\n*/\n```\n",
        "postTime": 1666583990,
        "uid": 275793,
        "name": "Gmt\u4e36FFF",
        "ccfLevel": 5,
        "title": "P4655 [CEOI2017] Building Bridges \u9898\u89e3"
    },
    {
        "content": "\u8bbe $f_i$ \u8868\u793a\u628a\u7b2c $1$ \u6839\u67f1\u5b50\u548c\u7b2c $i$ \u6839\u67f1\u5b50\u8fde\u63a5\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n\u6709\u8f6c\u79fb\u65b9\u7a0b $f_i=\\min_{j=1}^{i-1}f_j+(h_i-h_j)^2+(s_{i-1}-s_j)$\uff0c\u5176\u4e2d $s_i=\\sum_{j=1}^iw_j$\uff0c\u5373 $w$ \u7684\u524d\u7f00\u548c\u3002\n\n\u628a\u5f0f\u5b50\u5c55\u5f00\uff1a\n\n$$\nf_i=\\min_{j=1}^{i-1}f_j+(h_i-h_j)^2+(s_{i-1}-s_j)\\\\\nf_i=\\min_{j=1}^{i-1}f_j+h_i^2+h_j^2-2h_ih_j+s_{i-1}-s_j\n$$\n\n\u89c2\u5bdf\u5230\u8fd9\u662f\u4e00\u4e2a\u5178\u578b\u7684\u659c\u7387\u4f18\u5316\u5f62\u5f0f\uff0c\u4e0d\u59a8\u8bbe $b_i=h_i^2+s_{i-1}$\uff0c$k_i=h_i$\uff0c$x_i=2h_i$\uff0c$y_i=f_i+h_i^2-s_i$\u3002\u90a3\u4e48\u539f\u5f0f\u53d8\u6210\uff1a\n\n$$f_i=b_i+\\min_{j=1}^{i-1}y_j-k_ix_j$$\n\n\u7531\u4e8e $x_i$ \u548c $k_i$ \u6ca1\u6709\u5355\u8c03\u6027\uff0c\u6240\u4ee5\u8981\u7528 CDQ \u5206\u6cbb\u7ef4\u62a4\u51f8\u5305\uff0c\u4e8c\u5206\u627e\u51b3\u7b56\u70b9\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2 n)$\u3002\n\n```cpp\n#include <algorithm>\n#include <iostream>\n\nusing namespace std;\nusing LL = long long;\nusing Pll = pair<LL, LL>;\n\nconst int kN = 1e5 + 1;\n\nint n, t;\nLL h[kN], w[kN], f[kN], s[kN];\nPll q[kN], p[kN];\n\nLL X(int i) { return 2 * h[i]; }\nLL Y(int i) { return f[i] - s[i] + h[i] * h[i]; }\nLL K(int i) { return h[i]; }\nLL B(int i) { return s[i - 1] + h[i] * h[i]; }\n\nPll operator-(Pll x, Pll y) { return {x.first - y.first, x.second - y.second}; }\nLL operator*(Pll x, Pll y) { return x.first * y.second - x.second * y.first; }\n\nvoid S(int l, int r) {\n  if (l == r) {\n    if (l != 1) {\n      f[l] += B(l);\n    }\n    return;\n  }\n  int m = l + r >> 1;\n  S(l, m);\n  for (int i = l; i <= m; ++i) {\n    p[i] = {X(i), Y(i)};\n  }\n  sort(p + l, p + m + 1);\n  t = 0;\n  for (int i = l; i <= m; ++i) {\n    for (; t > 1 && (p[i] - q[t - 1]) * (q[t] - q[t - 1]) >= 0; --t) {\n    }\n    q[++t] = p[i];\n  }\n  q[t + 1] = {q[t].first + 1, 1e18};\n  for (int i = m + 1; i <= r; ++i) {\n    int _l = 1, _r = t;\n    while (_l < _r) {\n      int _m = _l + _r >> 1;\n      if ((q[_m + 1].second - q[_m].second) < K(i) * (q[_m + 1].first - q[_m].first)) {\n        _l = _m + 1;\n      } else {\n        _r = _m;\n      }\n    }\n    f[i] = min(f[i], q[_l].second - K(i) * q[_l].first);\n  }\n  S(m + 1, r);\n}\n\nint main() {\n  ios_base::sync_with_stdio(0), cin.tie(0), cout.tie(0);\n  cin >> n;\n  for (int i = 1; i <= n; ++i) {\n    cin >> h[i];\n  }\n  for (int i = 1; i <= n; ++i) {\n    cin >> w[i];\n    s[i] = s[i - 1] + w[i];\n  }\n  for (int i = 2; i <= n; ++i) {\n    f[i] = 1e18;\n  }\n  S(1, n);\n  cout << f[n];\n  return 0;\n}\n```\n",
        "postTime": 1670567416,
        "uid": 376161,
        "name": "wsfxk",
        "ccfLevel": 6,
        "title": "P4655 [CEOI2017] Building Bridges \u9898\u89e3"
    },
    {
        "content": "### \u524d\u7f6e\u77e5\u8bc6\n\n[\u674e\u8d85\u7ebf\u6bb5\u6811](https://oi-wiki.org/ds/li-chao-tree/)\n\n\u4e0b\u9762\u7684\u8bb2\u89e3\u9ed8\u8ba4\u5b66\u8fc7\u674e\u8d85\u7ebf\u6bb5\u6811\u3002\n\n------------\n\u9996\u5148\u53ef\u4ee5\u5f97\u51fa\u4e00\u4e2a\u6700\u57fa\u7840\u7684\u52a8\u6001\u89c4\u5212\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$f_i=\\min_{1\\le j<i}\\{f_j+s_{i-1}-s_j+(h_i-h_j)^2\\}$$\n\u5176\u4e2d\uff0c$f_i$ \u4e3a\u524d $i$ \u4e2a\u67f1\u5b50\uff0c\u968f\u4fbf\u5efa\u6865\uff0c\u6700\u5c0f\u4ee3\u4ef7\u662f\u591a\u5c11\u3002$s_i$ \u662f $w_i$ \u7684\u524d\u7f00\u548c~~\u72b6\u6001\u8f6c\u79fb\u5e94\u8be5\u5f88\u663e\u7136\u5427~~\u3002\n\n\u5c55\u5f00\u5f97\uff1a\n$$f_i=\\min_{1\\le j<i}\\{f_j+s_{i-1}-s_j+{h_i}^2-2h_ih_j+{h_j}^2\\}$$\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\uff0c\u80af\u5b9a\u4f1a\u8d85\u65f6\u3002\n\n\u4e0b\u4e00\u6b65\u8003\u8651\u4f18\u5316\u8f6c\u79fb\u8fc7\u7a0b\u3002\n\n\u5148\u628a\u6240\u6709\u4e0e $j$ \u53d6\u503c\u65e0\u5173\u7684\u90fd\u63d0\u51fa\u6765\u3002\n$$f_i=\\min_{1\\le j<i}\\{f_j+s_{i-1}-s_j+{h_i}^2+{h_j}^2-2h_ih_j\\}$$\n\u5f97\uff1a\n$$f_i=s_{i-1}+{h_i}^2+\\min_{1\\le j<i}\\{f_j-s_j+{h_j}^2-2h_ih_j\\}$$\n\u770b\u5230\u5176\u4e2d\u6709\u4e00\u9879\u662f $-2h_ih_j$\uff0c\u518d\u7ed3\u5408\u6570\u636e\u8303\u56f4 $0\\le h_i\\le 10^6$\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u7528\u674e\u8d85\u7ebf\u6bb5\u6811\u6765\u8fdb\u884c\u4f18\u5316\u3002\n\n\u674e\u8d85\u7ebf\u6bb5\u6811\u80fd\u591f\u5728 $O(\\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u5b9e\u73b0\u5728\u5e73\u9762\u4e0a\u63d2\u5165\u4e00\u6761\u76f4\u7ebf\uff0c\u67e5\u8be2\u6a2a\u5750\u6807\u4e3a $x$ \u4e0a\u7684\u6700\u9ad8\u6216\u6700\u4f4e\u7684\u76f4\u7ebf\u3002\n\n\u90a3\u4e48\u5728\u8fd9\u9053\u9898\u4e2d\uff0c\u8bbe $a_j=f_j-s_j+{h_j}^2,b_j=-2h_j$\uff0c\u5219\u6709\uff1a\n$$f_i=s_{i-1}+{h_i}^2+\\min_{1\\le j<i}\\{h_ib_j+a_j\\}$$\n\n\u628a $y=b_jx+a_j$ \u89c6\u4f5c\u4e00\u6761\u76f4\u7ebf\uff0c\u90a3\u4e48\u6c42 $\\min_{1\\le j<i}\\{h_ib_j+a_j\\}$ \u5c31\u53ef\u4ee5\u8f6c\u5316\u4e3a\u6c42\u5f53\u6a2a\u5750\u6807\u4e3a $h_i$ \u65f6\uff0c\u6700\u4f4e\u7684\u4e00\u6761\u76f4\u7ebf\u3002\u8fd9\u6837\u5c31\u8f6c\u5316\u4e3a\u4e86\u674e\u8d85\u7ebf\u6bb5\u6811\u53ef\u4ee5\u6c42\u89e3\u7684\u95ee\u9898\u3002\n\n------------\n### \u4ee3\u7801\n###### \u4ee3\u7801\u91cc\u6709\u6ce8\u91ca\n\n```cpp\n\n\n#include <cstdio>\n#define ll long long\n\nusing namespace std;\n\nstruct Node {\n    int id;\n    Node () {\n        id = 0;\n    }\n};\n\nint N;\nll H[100009];\nll W[100009];\nll s[100009];\nll dp[100009];\nll a[100009];\nll b[100009];\nNode tr[4000009];\n\nvoid In () {\n    scanf(\"%d\", &N);\n    for (int i = 1; i <= N; i++) scanf(\"%lld\", &H[i]);\n    for (int i = 1; i <= N; i++) scanf(\"%lld\", &W[i]);\n}\n\ninline ll Get_C (ll x, int l) { //\u627e\u5230\u7b2c l \u6761\u76f4\u7ebf\u6a2a\u5750\u6807\u4e3ax\u5904y\u5750\u6807\u7684\u503c\n    return a[l] + b[l] * x;\n}\n\nvoid Add (int x, int l, int r, int id) { //\u52a0\u5165\u7b2cid\u6761\u76f4\u7ebf\n    int mid;\n\n    if (l == r) {\n        if (Get_C(l, id) < Get_C(l, tr[x].id)) tr[x].id = id;\n        return;\n    }\n    mid = l + r >> 1;\n    if (Get_C(mid, id) < Get_C(mid, tr[x].id)) { int t = tr[x].id; tr[x].id = id, id = t; }\n    if (Get_C(l, id) < Get_C(l, tr[x].id)) Add(x << 1, l, mid, id);\n    else if (Get_C(r, id) < Get_C(r, tr[x].id)) Add(x << 1 | 1, mid + 1, r, id);\n}\n\ninline ll Min (ll a, ll b) {\n    return a < b ? a : b;\n}\n\nll Query (int x, int l, int r, ll p) {\n    int mid;\n    \n    if (l == r) return Get_C(p, tr[x].id);\n    mid = l + r >> 1;\n    if (p <= mid) return Min(Get_C(p, tr[x].id), Query(x << 1, l, mid, p));\n    else return Min(Get_C(p, tr[x].id), Query(x << 1 | 1, mid + 1, r, p));\n}\n\nvoid Solve () {\n    for (int i = 1; i <= N; i++) s[i] = s[i - 1] + W[i];\n    a[0] = 1e18; //\u8fd9\u91cc\u4e00\u5b9a\u8981\u521d\u59cb\u5316\uff0c\u56e0\u4e3a\u674e\u8d85\u7ebf\u6bb5\u6811\u91cc\u7684\u6bcf\u4e2a\u8282\u70b9\u8ba1\u7684\u6700\u4f18\u89e3\u4e00\u5f00\u59cb\u521d\u59cb\u9ed8\u8ba4\u4e3a\u7b2c0\u6761\u76f4\u7ebf\n    a[1] = H[1] * H[1] - s[1], b[1] = -2ll * H[1];\n    Add(1, 0, 1e6, 1); //\u5148\u5904\u7406\u4e00\u4e0b\u7b2c\u4e00\u6761\u76f4\u7ebf\n    for (int i = 2; i <= N; i++) {\n        dp[i] = H[i] * H[i] + s[i - 1] + Query(1, 0, 1e6, H[i]);\n        a[i] = dp[i] - s[i] + H[i] * H[i], b[i] = -2ll * H[i]; //\u7b2ci\u6761\u76f4\u7ebf\u7684\u53c2\u6570\n        Add(1, 0, 1e6, i);\n    }\n}\n\nvoid Out () {\n    printf(\"%lld\\n\", dp[N]);\n}\n\nint main () {\n\n    In();\n    Solve();\n    Out();\n\n    return 0;\n}\n```",
        "postTime": 1644207877,
        "uid": 224532,
        "name": "lyxeason",
        "ccfLevel": 5,
        "title": "[CEOI2017]Building Bridges \u9898\u89e3"
    },
    {
        "content": "\u5728\u6b64\u63d0\u4f9b\u4e24\u79cd\u65b9\u6cd5\uff1acdq \u5206\u6cbb\u548c\u674e\u8d85\u6811\u3002\n\n\u5b9a\u4e49 $f(i)$ \u4e3a\u8fde\u5230\u7b2c $i$ \u6839\u67f1\u5b50\u7684\u6700\u5c0f\u82b1\u8d39\uff0c\u628a $w_i$ \u5199\u6210\u524d\u7f00\u548c\u3002\n\n$f(i)=\\min\\{f(j)+(h_i-h_j)^2+w_{i-1}-w_j\\}$\n\n\u9996\u5148\u4ecb\u7ecd cdq \u5206\u6cbb\u5199\u6cd5\u3002\n\n$f(i)=f(j)+h_j^2-w_j-2h_jh_i+h_i^2+w_{i-1}$\n\n\u8bbe $Y(j)=f(j)+h_j^2-w_j,X(j)=h_j$\uff0c\u82e5 $j_1<j_2$ \u4e14 $j_2$ \u4f18\u4e8e $j_1$\uff0c\u6211\u4eec\u5c31\u6709\n\n$Y(j_2)-2h_iX(j_2)\\leq Y(j_1)-2h_iX(j_1)$\n\n$\\frac{Y(j_2)-Y(j_1)}{X(j_2)-X(j_1)}\\leq 2h_i$\n\n\u8fd9\u662f\u4e00\u4e2a\u4e0b\u51f8\u5305\uff0c\u4f46 $h_i$ \u4e0d\u5355\u8c03\uff0c\u8981\u7528 cdq \u5206\u6cbb\u3002\n\n\u5206\u6cbb\u524d\uff0c\u5148\u6309\u7167 $k_i$ \u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff08\u56e0\u4e3a\u8fd9\u662f\u4e0b\u51f8\u5305\uff0c\u5982\u679c\u662f\u4e0a\u51f8\u5305\u5c31\u8981\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff09\u3002\u5206\u6cbb\u65f6\uff0c\u5148\u6309\u7167\u7f16\u53f7\u5206\u5230\u5de6\u53f3\u534a\u8fb9\uff0c\u8fd9\u6837 [ $l,mid$ ] \u548c [ $mid+1,r$ ] \u90fd\u662f $k$ \u5355\u8c03\u7684\uff0c\u7136\u540e\u9012\u5f52\u5904\u7406\u5de6\u534a\u8fb9\uff0c\u4f7f\u5f97\u5de6\u534a\u8fb9\u7684 $x$ \u6709\u5e8f\uff0c\u518d\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u5de6\u534a\u8fb9\u7684\u51f8\u5305\uff0c\u66f4\u65b0\u53f3\u534a\u8fb9\u7684\u7b54\u6848\uff0c\u7136\u540e\u518d\u5904\u7406\u53f3\u534a\u8fb9\uff0c\u6700\u540e\uff0c\u628a\u5de6\u53f3\u4e24\u534a\u6309 $x$ \u5f52\u5e76\u8d77\u6765\u3002\n\n\u4e0b\u9762\u662f cdq \u5206\u6cbb\u7684 AC \u4ee3\u7801\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define int long long\n\nconst int INF = 0x7f7f7f7f;\n\nint n,h[100005],s[100005],hd=1,tl=0,dq[100005],f[100005];\nstruct node{\n\tint x,y,k,u;\n}q[100005],q0[100005];\n\nbool cmpk(node a,node b)\n{\n\treturn a.k<b.k;\n}\n\nbool cmpx(node a,node b)\n{\n\treturn a.x<b.x;\n}\n\ndouble k_(int j1,int j2)\n{\n\tif(q[j1].x==q[j2].x)\n\t\treturn q[j1].y>q[j2].y ? -1.0*INF : 1.0*INF;\n\treturn 1.0*(q[j1].y-q[j2].y)/(q[j1].x-q[j2].x);\n}\n\nvoid cdq_(int l,int r)\n{\n\tif(l==r)\n\t{\n\t\tint j=q[l].u;\n\t\tq[l].y = f[j]+h[j]*h[j]-s[j];\n\t\treturn;\n\t}\n\tint mid=l+r>>1;\n\tint p1=l,p2=mid+1;\n\tfor(int i=l;i<=r;i++)\n\t\tif(q[i].u<=mid)\n\t\t\tq0[p1] = q[i], p1++;\n\t\telse\n\t\t\tq0[p2] = q[i], p2++;\n\tfor(int i=l;i<=r;i++)\n\t\tq[i] = q0[i];\n\tcdq_(l,mid);\n\thd = 1, tl = 0;\n\tfor(int i=l;i<=mid;i++)\n\t{\n\t\twhile(hd<tl && k_(dq[tl],i)<=k_(dq[tl-1],dq[tl]))\n\t\t\ttl--;\n\t\tdq[++tl] = i;\n\t}\n\tfor(int i=mid+1;i<=r;i++)\n\t{\n\t\twhile(hd<tl && k_(dq[hd],dq[hd+1])<=1.0*q[i].k)\n\t\t\thd++;\n\t\tif(hd<=tl)\n\t\t{\n\t\t\tint j=dq[hd];\n\t\t\tf[q[i].u] = min(f[q[i].u],q[j].y-q[i].k*q[j].x+h[q[i].u]*h[q[i].u]+s[q[i].u-1]);\n\t\t}\n\t}\n\tcdq_(mid+1,r);\n\tinplace_merge(q+l,q+1+mid,q+1+r,cmpx);\n}\n\nsigned main()\n{\n\tmemset(f,INF,sizeof(f));\n\tcin>>n;\n\tfor(int i=1;i<=n&&cin>>h[i];i++)\n\t\tq[i].x = h[i], q[i].k = 2*h[i], q[i].u = i;\n\tfor(int i=1;i<=n&&cin>>s[i];i++)\n\t\ts[i] += s[i-1];\n\tsort(q+1,q+1+n,cmpk);\n\tf[1] = 0;\n\tcdq_(1,n);\n\tcout<<f[n]<<endl;\n\t\n\treturn 0;\n}\n```\n\n\u7136\u540e\u6765\u4ecb\u7ecd\u674e\u8d85\u6811\u7684\u5199\u6cd5\u3002\n\n\u56de\u5230\u6700\u5f00\u59cb\u7684 dp \u5f0f\u5b50\u3002\n\n$f(i)=f(j)+h_j^2-w_j-2h_jh_i+h_i^2+w_{i-1}$\n\n\u8bbe $B(j)=f(j)+h_j^2-w_j,K(j)=-2h_j$\u3002\n\n$f(i)=K(j)h_i+B(j)+h_i^2+w_{i-1}$\n\n\u524d\u4e24\u9879\u662f\u4e00\u6761\u76f4\u7ebf\uff0c\u6c42\u7684\u662f\u6240\u6709\u76f4\u7ebf\u5728 $x=h_i$ \u5904\u7684\u6700\u5c0f\u503c\u3002\u6211\u4eec\u53ea\u8981\u50cf\u7ebf\u6bb5\u6811\u4f18\u5316 dp \u4e00\u6837\uff0c\u6bcf\u6b21\u63d2\u5165\u4e00\u6839\u76f4\u7ebf\uff0c\u66f4\u65b0\u4f18\u52bf\u7ebf\u6bb5\u5373\u53ef\u3002\n\n\u4e0b\u9762\u662f\u674e\u8d85\u6811\u7684 AC \u4ee3\u7801\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define int long long\n#define mid (l+r>>1)\n\nconst int V = 1e6;\nconst int INF = 2e17;\n\nint n,h[100005],w[100005],f[100005];\nint root,cnt=0;\nstruct lictree{\n\tint l,r,v;\n}t[1000005*30];\n\nint K(int j)\n{\n\treturn -2*h[j];\n}\n\nint B(int j)\n{\n\treturn f[j]+h[j]*h[j]-w[j];\n}\n\nint F(int i,int x)\n{\n\treturn K(i)*x+B(i);\n}\n\ndouble I(int i,int j)\n{\n\treturn 1.0*(B(i)-B(j))/(K(j)-K(i));\n}\n\nvoid insert(int &o,int l,int r,int i)\n{\n\tif(!o)\n\t{\n\t\to = ++cnt;\n\t\tt[o].v = i;\n\t\treturn;\n\t}\n\tint j=t[o].v;\n\tif(F(i,l)>=F(j,l) && F(i,r)>=F(j,r))\n\t\treturn;\n\telse if(F(i,l)<=F(j,l) && F(i,r)<=F(j,r))\n\t{\n\t\tt[o].v = i;\n\t\treturn;\n\t}\n\tdouble x=I(i,j);\n\tif(F(i,l)<=F(j,l))\n\t{\n\t\tif(x<=mid) insert(t[o].l,l,mid,i);\n\t\telse insert(t[o].r,mid+1,r,j), t[o].v = i;\n\t}\n\telse if(F(i,r)<=F(j,r))\n\t{\n\t\tif(x<=mid) insert(t[o].l,l,mid,j), t[o].v = i;\n\t\telse insert(t[o].r,mid+1,r,i);\n\t}\n}\n\nint query(int o,int l,int r,int x)\n{\n\tif(!o) return INF;\n\tint res=F(t[o].v,x);\n\tif(l==x && r==x)\n\t\treturn res;\n\tif(x<=mid)\n\t\tres = min(res,query(t[o].l,l,mid,x));\n\telse\n\t\tres = min(res,query(t[o].r,mid+1,r,x));\n\treturn res;\n}\n\nsigned main()\n{\n\tcin>>n;\n\tfor(int i=1;i<=n;cin>>h[i++]);\n\tfor(int i=1;i<=n;cin>>w[i++]);\n\tfor(int i=1;i<=n;i++)\n\t\tw[i] += w[i-1];\n\tf[1] = 0;\n\tinsert(root,1,V,1);\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tf[i] = query(root,1,V,h[i])+h[i]*h[i]+w[i-1];\n\t\tinsert(root,1,V,i);\n\t}\n\tcout<<f[n]<<endl;\n\t\n\treturn 0;\n}\n```\n\n\u4e0b\u9762\u6211\u4eec\u6765\u6bd4\u8f83\u4e00\u4e0b\u4e24\u79cd\u7b97\u6cd5\u3002\u63a8\u5f0f\u5b50\u65f6 cdq \u5206\u6cbb\u7684\u5199\u6cd5\u9700\u8981\u628a\u4ea4\u53c9\u9879\u5f53\u6210\u659c\u7387\uff0c\u674e\u8d85\u6811\u65f6\u8981\u628a\u4ea4\u53c9\u9879\u53d8\u6210\u6a2a\u5750\u6807\u3002cdq \u5206\u6cbb\u8981\u5feb\u4e00\u70b9\uff0c\u4f46\u674e\u8d85\u6811\u6bd4\u8f83\u7b80\u5355\u65e0\u8111\u3002\n\n\u795d\u5927\u5bb6 AC \u6109\u5feb\uff01",
        "postTime": 1633857591,
        "uid": 123298,
        "name": "kouylty",
        "ccfLevel": 7,
        "title": "\u9898\u89e3\u3010P4655 [CEOI2017]Building Bridges\u3011"
    },
    {
        "content": "\u4e00\u79cd\u674e\u8d85\u6811\u7ef4\u62a4\u4e8c\u6b21\u51fd\u6570\u7684\u89e3\u6cd5\u3002\n\n------\n\n\u4ec0\u4e48\uff1f\u674e\u8d85\u6811\u8fd8\u80fd\u7ef4\u62a4\u4e8c\u6b21\u51fd\u6570\uff1f\n\n\u90a3\u662f\u56e0\u4e3a\u672c\u9898\u7684\u51fd\u6570\u6709\u7279\u6b8a\u7684\u6027\u8d28\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u5f88\u5bb9\u6613\u5199\u51faDP\u7684\u5f0f\u5b50\u6765\uff1a\n\n$$f_i=\\min\\limits_{j<i}\\Big\\{f_j+(h_i-h_j)^2+(w_i-w_j)\\Big\\}$$\n\n\u7136\u540e\uff0c\u5e38\u89c4\u89e3\u6cd5\u662f\u8fdb\u4e00\u6b65\u62c6\u5f0f\u5b50\u5f97\u5230\u4e00\u6b21\u51fd\u6570\u3002\u7136\u800c\uff0c\u8fd9\u91cc\u56e0\u4e3a~~\u6211\u8111\u62bd\u4e86~~\u5e76\u6ca1\u6709\u8fdb\u4e00\u6b65\u63a8\u4e0b\u53bb\u3002\u4e8e\u662f\uff0c\u4fbf\u5f00\u59cb\u601d\u8003\u8fd9\u4e2a\u4e1c\u897f\u6709\u4f55\u6027\u8d28\u3002\n\n\u660e\u663e\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u8f6c\u6362\u4e3a\u4e00\u4e2a\u5f62\u5982\n\n$$f_i-w_i=\\min\\Big\\{(h_i-k)^2+h\\Big\\}$$\n\n\u7684\u5f0f\u5b50\u3002\n\n\u5f88\u8f7b\u677e\u53ef\u4ee5\u53d1\u73b0\uff0c\u6211\u4eec\u5f97\u5230\u7684\u662f\u5e73\u9762\u4e0a\u4e00\u5806\u4e8c\u6b21\u51fd\u6570 $y=(x-k)^2+h$\uff0c\u8981\u6c42\u5176\u5728 $x=h_i$ \u5904\u7684\u6700\u4f4e\u70b9\u3002\n\n\u4e00\u6b21\u51fd\u6570\u674e\u8d85\u6811\u7684\u590d\u6742\u5ea6\uff0c\u4f9d\u8d56\u4e8e\u4e00\u6b21\u51fd\u6570\u7684**\u5355\u8c03\u6027**\uff1a\u4e24\u6761\u51fd\u6570\uff0c\u5728\u4e2d\u70b9\u5904\u66f4\u9ad8\u7684\u90a3\u6761\uff0c\u4e00\u5b9a\u4e0d\u4f1a\u5728\u4e24\u7aef\u90fd\u6bd4\u53e6\u4e00\u6761\u4f4e\u3002\n\n\u5e38\u89c4\u4e8c\u6b21\u51fd\u6570\u674e\u8d85\u6811\u7684\u590d\u6742\u5ea6\u662f\u65e0\u6cd5\u88ab\u4fdd\u8bc1\u7684\uff0c\u56e0\u4e3a\u5728\u4e2d\u70b9\u5904\u66f4\u9ad8\u7684\u90a3\u6761\u5728\u4e24\u7aef\u6709\u53ef\u80fd\u90fd\u6bd4\u53e6\u4e00\u6761\u4f4e\uff0c\u8fd9\u5c31\u4f7f\u5f97\u7ebf\u6bb5\u6811\u4e0a\u4fee\u6539\u4e00\u4e2a\u8282\u70b9\u65f6\u53ef\u80fd\u5176\u4e24\u4e2a\u5b50\u6811\u90fd\u8981\u88ab\u8bbf\u95ee\u3002\n\n\u4f46\u662f\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u91cc\u7684\u4e8c\u6b21\u51fd\u6570\u6709\u7740\u7279\u6b8a\u7684\u6027\u8d28\uff1a\u5b83\u4eec\u4e8c\u6b21\u9879\u7cfb\u6570\u90fd\u4e3a $1$\uff01\u5982\u679c\u753b\u51fa\u56fe\u6765\u5c31\u4f1a\u53d1\u73b0\uff0c\u4e0a\u8ff0\u4e2d\u70b9\u5904\u66f4\u9ad8\u4f46\u4e24\u7aef\u66f4\u4f4e\u7684\u60c5\u5f62\u662f\u4e0d\u53ef\u80fd\u51fa\u73b0\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u6b64\u5904\u7684\u4e8c\u6b21\u51fd\u6570**\u5c31\u53ef\u4ee5\u540c\u4e00\u6b21\u51fd\u6570\u4e00\u6837\u8ba1\u7b97**\uff01\n\n\u4e8e\u662f\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$\uff0c\u8f7b\u677e\u89e3\u51b3\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nint n,a[100100],m,mn[400100];\nll b[100100],f[100100];\nvector<int>v;\n#define lson x<<1\n#define rson x<<1|1\n#define mid ((l+r)>>1) \nll calc(int x,int y){return 1ll*(v[x-1]-v[a[y]-1])*(v[x-1]-v[a[y]-1])-b[y]+f[y];}\nvoid modify(int x,int l,int r,int k){\n\tif(calc(mid,k)<calc(mid,mn[x]))swap(mn[x],k);\n\tif(calc(l,k)<calc(l,mn[x]))modify(lson,l,mid,k);\n\tif(calc(r,k)<calc(r,mn[x]))modify(rson,mid+1,r,k);\n}\nvoid build(int x,int l,int r){mn[x]=1;if(l!=r)build(lson,l,mid),build(rson,mid+1,r);}\nll query(int x,int l,int r,int P){\n\tll ret=calc(P,mn[x]);\n\tif(l!=r){\n\t\tif(P<=mid)ret=min(ret,query(lson,l,mid,P));\n\t\telse ret=min(ret,query(rson,mid+1,r,P));\n\t}\n\treturn ret;\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]),v.push_back(a[i]);\n\tsort(v.begin(),v.end()),v.resize(m=unique(v.begin(),v.end())-v.begin());\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&b[i]),b[i]+=b[i-1],a[i]=lower_bound(v.begin(),v.end(),a[i])-v.begin()+1;\n\tbuild(1,1,m);\n\tfor(int i=2;i<=n;i++)f[i]=query(1,1,m,a[i])+b[i-1],modify(1,1,m,i);\n\tprintf(\"%lld\\n\",f[n]);\n\treturn 0;\n} \n```\n\n",
        "postTime": 1615164927,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4655 \u3010[CEOI2017]Building Bridges\u3011"
    },
    {
        "content": "### Solution\n\n\u8bbe $f_i$ \u4e3a\u5c06\u7b2c $1$ \u6839\u548c\u7b2c $i$ \u6839\u67f1\u5b50\u76f8\u8fde\u7684\u4ee3\u4ef7\uff0c\u5219\u5bb9\u6613\u5f97\u5230\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$\nf_i=\\min\\{f_j+\\sum\\limits_{k=j+1}^{i-1}w_k+(h_i-h_j)^2\\}\n$$\n\n\n\u6211\u4eec\u53ef\u4ee5\u4ee4 $s_i=\\sum\\limits_{k=1}^iw_k$ \uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5c06 $\\sum\\limits_{k=j+1}^{i-1}w_k$ \u5199\u4f5c $s_{i-1}-s_j$ \uff0c\u5f97\uff1a\n$$\n\\begin{aligned}f_i&=\\min\\{f_j+s_{i-1}-s_j+(h_i-h_j)^2\\}\\\\&=\\min\\{f_j+s_{i-1}-s_j+h_i^2-2h_ih_j+h_j^2\\}\\\\&=\\min\\{(-2h_ih_j+f_j-s_j+h_j^2)+(s_{i-1}+h_i^2)\\}\\end{aligned}\n$$\n\n\u770b\u4e0a\u53bb\u662f\u4e0d\u662f\u5f88\u50cf\u659c\u7387\u4f18\u5316DP\u7684\u6837\u5b50\u3002~~(\u867d\u7136\u662f\u674e\u8d85\u7ebf\u6bb5\u6811\u677f\u5b50\u9898\uff0c\u4e0d\u8fc7\u6211\u4eec\u7528\u659c\u7387\u4f18\u5316\u505a)~~\n\n\\\n\u89c2\u5bdf\u4e00\u4e0b\u53ef\u4ee5\u53d1\u73b0\uff0c\u82e5 $i$ \u786e\u5b9a\uff0c$(s_{i-1}+h_i^2)$ \u4e3a\u5e38\u6570\u9879\uff0c\u53ef\u4ee5\u5ffd\u7565\u3002\n\n\u4e8e\u662f\u5c31\u53d8\u6210\u4e86\u5bf9\u4e8e\u4e00\u4e2a\u786e\u5b9a\u7684 $i$\uff0c\u6c42 $\\min\\{-2h_ih_j+f_j-s_j+h_j^2\\}$ \u3002\n\n\u82e5\u51b3\u7b56 $j$ \u4f18\u4e8e\u51b3\u7b56 $k$ \u5219\uff1a\n$$\n-2h_ih_j+f_j-s_j+h_j^2<-2h_ih_k+f_k-s_k+h_k^2\n$$\n\u5316\u7b80\u5f97\uff1a\n\n$$\n\\dfrac{(f_j-s_j+h_j^2)-(f_k-s_k+h_k^2)}{2(h_j-h_k)}<h_i\n$$\n\u4ee4 $Y(i)=f_i-s_i+h_i^2,X(i)=2h_i$ \uff0c\u5219\uff1a\n$$\n\\dfrac{Y(j)-Y(k)}{X(j)-X(k)}<h_i\n$$\n\n\n\n\u56e0\u4e3a $h_i$ \u5e76\u4e0d\u662f\u5355\u8c03\u7684\uff0c\u6240\u4ee5\u9700\u8981**CDQ\u5206\u6cbb**\u6765\u7ef4\u62a4\n\n\u7528splay\u7ef4\u62a4\u52a8\u6001\u51f8\u5305\u4e5f\u4e0d\u62e6\u4f60(~~\u56e0\u4e3a\u6211\u4e0d\u4f1a~~)\n\n\u6211\u4eec\u8003\u8651\u5c06\u4e00\u4e2a\u5355\u8c03\u961f\u5217\u5206\u4e3a\u5de6\u53f3\u4e24\u4e2a\uff0c\u7136\u540e\u9012\u5f52\u5904\u7406\uff0c\u53d1\u73b0\u9012\u5f52\u5230\u957f\u5ea6\u4e3a1\u65f6\uff0c\u53ef\u4ee5\u50cf\u666e\u901a\u659c\u7387\u4f18\u5316\u4e00\u6837\u5efa\u70b9\u3002\n\n\u56de\u6eaf\u65f6\uff0c\u56e0\u4e3a\u5de6\u8fb9\u5bf9\u53f3\u8fb9\u4f1a\u6709\u5f71\u54cd\uff0c\u6240\u4ee5\u5148\u5c06\u5de6\u8fb9\u7684\u72b6\u6001\u63d2\u5165\u5355\u8c03\u961f\u5217\uff0c\u518d\u66f4\u65b0\u53f3\u8fb9\u7684\u72b6\u6001\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n\\log^2n)$ \n\n\u4ee3\u7801\u5c31\u5495\u5495\u5495\u4e86= =",
        "postTime": 1598067332,
        "uid": 272143,
        "name": "\u662f\u4e2a\u6c49\u5b50",
        "ccfLevel": 4,
        "title": "P4655 [CEOI2017]Building Bridges"
    },
    {
        "content": "\u9898\u5916\u8bdd\uff1a \u524d\u51e0\u5929\u795etommy\u6559\u4e86\u674e\u8d85\u7ebf\u6bb5\u6811\u3002  \n\n\u8003\u8651\u66b4\u529bdp\uff0c \u8bbe$f_i$\u4e3a\u6253\u901a\u5230\u7b2c$i$\u53f7\u8282\u70b9\u7684\u6700\u5c0f\u4ee3\u4ef7, \u6709  \n$$\\displaystyle f_i = \\min\\limits_{1 \\leqslant j < i}\\{f_j + \\sum_{k=j+1}^i w_k + (h_i-h_j)^2\\}$$  \n\u8bb0$S_i = \\sum_{i=1}^n w_i$, \u53d8\u5f62\u5f0f\u5b50  \n$$f_i = h_i^2+S_{i-1}+\\min\\limits_{1 \\leqslant j < i}\\{-2h_jh_i+f_j+h_j^2-S_j\\}$$  \n\u6bcf\u4e2a$h_j$\u90fd\u4f1a\u5bf9\u540e\u9762\u7684\u6240\u6709$h_i$\u8fdb\u884c\u66f4\u65b0, \u8fd9\u662f\u4e00\u4e2a\u5173\u4e8e$h_i$\u7684\u4e00\u6b21\u51fd\u6570\uff0c $k=-2h_j, \\space b = f_j + h_j^2-S_j$\u3002  \n\u7528\u674e\u8d85\u7ebf\u6bb5\u6811\u5373\u53ef\u7ef4\u62a4\u5373\u53ef\u5728$\\mathcal{O(\\log n)}$\u6c42\u51fa\u5355\u70b9\u7684\u51fd\u6570\u6700\u503c\u3002  \n\u590d\u6742\u5ea6$\\mathcal{O(n \\log n)}$  \n```cpp\n#include <bits/stdc++.h>\n#define endl '\\n'\n#define rep(i,a,b) for(int i=a;i<=(b);++i)\n#define per(i,a,b) for(int i=a;i>=(b);--i)\n#define repp(i,a,b) for(int i=a;i<(b);++i)\n#define perr(i,a,b) for(int i=a;i>(b);--i)\n\nusing namespace std;\n\ntypedef long long ll;\n\nconst int inf = 0x3f3f3f3f, maxn = 123456, maxh = 1234567;\nconst ll linf = 0x3f3f3f3f3f3f3f3f;\n\nll h[maxn], k[maxn], b[maxn], s[maxn], f[maxn];\n\nint dat[maxh << 2];\n\ninline ll calc(int id, int x) {\n\treturn k[id] * x + b[id];\n}\n\nvoid insert(int p, int lp, int rp, int id) {\n\tif(!dat[p]) { dat[p] = id; return; }\n\tif(lp == rp) {\n\t\tif(calc(dat[p], lp) > calc(id, lp)) dat[p] = lp;\n\t\treturn;\n\t}\n\tint mid = lp + rp >> 1;\n\tll pre = calc(dat[p], mid), cur = calc(id, mid);\n\tif(k[dat[p]] < k[id]) {\n\t\tif(cur < pre) insert(p<<1|1, mid+1, rp, dat[p]), dat[p] = id;\n\t\telse insert(p<<1, lp, mid, id);\n\t} else if(k[dat[p]] > k[id]) {\n\t\tif(cur < pre) insert(p<<1, lp, mid, dat[p]), dat[p] = id;\n\t\telse insert(p<<1|1, mid+1, rp, id);\n\t} else {\n\t\tif(cur < pre) dat[p] = id;\n\t}\n}\n\nll qry(int p, int lp, int rp, int x) {\n\tif(lp == rp) return calc(dat[p], x);\n\tint mid = lp + rp >> 1;\n\tif(x <= mid) return min(calc(dat[p], x), qry(p<<1, lp, mid, x));\n\telse return min(calc(dat[p], x), qry(p<<1|1, mid+1, rp, x));\n}\n\nint main() {\n\tios::sync_with_stdio(false);\n\tcin.tie(0);\n\tint n;\n\tll mh = 0;\n\tcin >> n;\n\trep(i, 1, n) cin >> h[i], mh = max(h[i], mh);\n\trep(i, 1, n) cin >> s[i];\n\trep(i, 2, n) s[i] += s[i-1];\n\tk[0] = b[0] = inf;\n\tf[1] = 0;\n\tk[1] = -2 * h[1], b[1] = -s[1] + h[1]*h[1];\n\tinsert(1, 0, mh, 1);\n\trep(i, 2, n) {\n\t\tf[i] = h[i] * h[i] + s[i-1] + qry(1, 0, mh, h[i]);\n\t\tk[i] = -2 * h[i], b[i] = f[i] + -s[i] + h[i] * h[i];\n\t\tinsert(1, 0, mh, i);\n\t}\n\tcout << f[n] << endl;\n\treturn 0;\n}\n```",
        "postTime": 1586049241,
        "uid": 88735,
        "name": "\u5bd2\u9e3d\u513f",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4655 \u3010[CEOI2017]Building Bridges\u3011"
    },
    {
        "content": "\u535a\u5ba2\u5185\u98df\u7528\u66f4\u4f73\uff1a[\u535a\u5ba2\u4f20\u9001\u95e8](https://blog.csdn.net/The_OIer/article/details/100046779)\n\n\u9898\u76ee\u94fe\u63a5\uff1a[\u4f20\u9001\u95e8](https://www.luogu.org/problem/P4655)\n\n## \u5927\u81f4\u601d\u8def\n\n\u4ee4$sumw$\u8868\u793a$w$\u7684\u524d\u7f00\u548c\u3002\n\n\u8003\u8651\u4ece$j$\u63a8\u5230$i$\u7684\u60c5\u51b5\uff0c\u8f6c\u79fb\u65b9\u7a0b\u663e\u7136\uff1a\n\n$dp[i]=min(dp[j]+(h[i]-h[j])^2+sumw[i-1]-sumw[j])$\n\n\n\u5c55\u5f00\uff0c\u79fb\u9879\uff0c~~\u4e00\u901a\u4e71\u641e~~\uff0c\u5f97\u5230$2h[i]*h[j]+dp[i]+$\u5e38\u6570$=dp[j]+h[j]^2-sumw[j]$\n\n\u6709\u4e58\u79ef\u9879\uff0c\u6240\u4ee5\u8981\u659c\u7387\u4f18\u5316\u3002\n\n\u53d1\u73b0$h$\u4e0d\u5355\u8c03\uff0c\u6240\u4ee5\u9700\u8981CDQ\u5206\u6cbb\u3002\n\n\u7136\u540e\u5c31\u662fCDQ\u5206\u6cbb+\u659c\u7387\u4f18\u5316\u7684\u5957\u8def\uff1a\n\n\u5148\u628a\u6240\u6709\u70b9\u6309\u7167$x$\u5750\u6807\u6392\u5e8f\uff08\u672c\u9898$x$\u5750\u6807\u4e3a$h$\uff09\uff0c\u7136\u540eCDQ\u5206\u6cbb\u65f6\u628a$id$\u5728$[l,mid]$\u548c$[mid+1,r]$\u7684\u5206\u6210\u5de6\u53f3\u4e24\u8fb9\u533a\u95f4\uff0c\u8fd9\u6837\u4ecd\u7136\u6ee1\u8db3\u5de6\u8fb9\u548c\u53f3\u8fb9\u533a\u95f4$x$\u5750\u6807\u5206\u522b\u5355\u8c03\u3002\n\n\u7136\u540e\u5957\u4e0a\u5355\u8c03\u961f\u5217+\u659c\u7387\u4f18\u5316\u5373\u53efqwq\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<stdio.h>\n#include<cstring>\n#include<algorithm>\n#include<math.h>\n#define re register int\n#define rl register ll\nusing namespace std;\ntypedef long long ll;\nint read() {\n    re x=0,f=1;\n    char ch=getchar();\n    while(ch<'0' || ch>'9') {\n        if(ch=='-')    f=-1;\n        ch=getchar();\n    }\n    while(ch>='0' && ch<='9') {\n        x=(x<<1)+(x<<3)+ch-'0';\n        ch=getchar();\n    }\n    return x*f;\n}\ninline void write(int x) {\n\tif(x>9)\twrite(x/10);\n\tputchar(x%10+'0');\n}\nconst int Size=100005;\nnamespace I_Love {\n\nll n,h[Size],w[Size],sumw[Size],dp[Size];\nstruct node {\n\tdouble x,y;\n\tint id;\n} p[Size],tmp[Size],Queue[Size];\ninline bool comp(node a,node b) {\n\tif(a.x!=b.x)\treturn a.x<b.x;\n\treturn a.id<b.id;\n}\ninline bool operator < (node a,node b) {\n\treturn a.x<b.x;\n}\nvoid Divide(int l,int r) {\n\tint mid=(l+r)>>1;\n\tint ptrl=l-1,ptrr=mid;\n\tfor(re i=l; i<=r; i++) {\n\t\tif(p[i].id<=mid) {\n\t\t\ttmp[++ptrl]=p[i];\n\t\t} else {\n\t\t\ttmp[++ptrr]=p[i];\n\t\t}\n\t}\n\tfor(re i=l; i<=r; i++) {\n\t\tp[i]=tmp[i];\n\t}\n}\nvoid Merge(int l,int r) {\n\tint mid=(l+r)>>1;\n\tint ptrl=l,ptrr=mid+1,tot=l-1;\n\twhile(ptrl<=mid && ptrr<=r) {\n\t\tif(p[ptrl]<p[ptrr]) {\n\t\t\ttmp[++tot]=p[ptrl++];\n\t\t} else {\n\t\t\ttmp[++tot]=p[ptrr++];\n\t\t}\n\t}\n\twhile(ptrl<=mid)\ttmp[++tot]=p[ptrl++];\n\twhile(ptrr<=r)\t\ttmp[++tot]=p[ptrr++];\n\tfor(re i=l; i<=r; i++) {\n\t\tp[i]=tmp[i];\n\t}\n}\ninline double slope(node a,node b) {\n\treturn (b.y-a.y)/(b.x-a.x);\n}\nvoid CDQ_Divide(int l,int r) {\n\tif(l==r) {\n\t\tp[l].y=dp[l]+h[l]*h[l]-sumw[l];\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n   //\n\tDivide(l,r);\n\tCDQ_Divide(l,mid);\n\tint hd=1,tl=0;\n\tfor(re i=l; i<=mid; i++) {\n\t\twhile(hd<tl && (p[i].y-Queue[tl].y)*(Queue[tl].x-Queue[tl-1].x)<=(Queue[tl].y-Queue[tl-1].y)*(p[i].x-Queue[tl].x))\n\t\t\ttl--;\n\t\tQueue[++tl]=p[i];\n\t}\n\tfor(re i=mid+1; i<=r; i++) {\n\t\twhile(hd<tl && slope(Queue[hd],Queue[hd+1])<=p[i].x*2)\thd++;\n\t\tint x=p[i].id,y=Queue[hd].id;\n\t\tdp[x]=min(dp[x],dp[y]+(h[x]-h[y])*(h[x]-h[y])+sumw[x-1]-sumw[y]);\n\t}\n//\tif(l==1 && r==n) {\n//\t\tputs(\"\u6211\u6c38\u8fdc\u559c\u6b22\u73c2\u6735\u8389\");\n//\t}\n\tCDQ_Divide(mid+1,r);\n\tMerge(l,r);\n}\nvoid Kutori() {\n\tn=read();\n\tfor(re i=1; i<=n; i++) {\n\t\th[i]=read();\n\t\tp[i].x=h[i];\n\t\tp[i].id=i;\n\t}\n\tfor(re i=1; i<=n; i++) {\n\t\tw[i]=read();\n\t\tsumw[i]=sumw[i-1]+w[i];\n\t}\n\tmemset(dp,0x3f,sizeof(dp));\n\tdp[1]=0;\n\tsort(p+1,p+1+n,comp);\n\tCDQ_Divide(1,n);\n\tprintf(\"%lld\",dp[n]);\n}\n\n}\nint main() {\n\tI_Love::Kutori();\n    return 0;\n}\n```",
        "postTime": 1566570351,
        "uid": 45108,
        "name": "Peter_Z",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4655 \u3010[CEOI2017]Building Bridges\u3011"
    },
    {
        "content": "\u543c\u9898\u554a\u3002\u3002\u3002 \u53ef\u4ee5\u8003\u8651\u5206\u6cbb\u53bb\u505a\u8fd9\u9053\u9898\uff1f\n\n\u636e\u8bf4\u6807\u7b97\u674e\u8d85\u7ebf\u6bb5\u6811\u7136\u9e45 \u597d\u591a\u4e00\u4e2a log \u7684\u4ee3\u7801\u8dd1\u5f97\u8fd8\u6ca1\u4e24\u4e2a log \u7684\u5feb $QVQ$ \uff08\u5e38\u6570\u95ee\u9898\uff1f\uff09\n\n\u54e6\uff01\u6211\u7684CDQ\u597d\u50cf\u4e5f\u662f\u4e00\u4e2alog\u7684...\n\n\u590d\u6742\u5ea6\u767d\u75f4\u50bb\u50bb\u7b97\u4e0d\u6e05\u695a **\u2192_\u2192**\n\n----\n\n\n\u9996\u5148\u8003\u8651\u8fd9\u9898\u53ef\u4ee5 $n^2$ dp ...\u8868\u8fbe\u5f0f\u5f88\u6734\u7d20\uff0c\u4e00\u5f00\u59cb\u6211\u5c31\u7528\u7684\u8fd9\u4e2a $n^2$ \u505a\u7684\u56e0\u4e3a\u7406\u4e0d\u51fa\u601d\u7eea\n\n\u8868\u8fbe\u5f0f\uff1a\n\n$$f_i=f_j +(h_i-h_j)^2 +W_{i-1}-W_j $$\n\n\u7136\u540e\u6211\u4e00\u5f00\u59cb\u5c45\u7136\u60f3\u4e9b\u4e71\u4e03\u516b\u7cdf\u7684\u7b97\u6cd5\u6ca1\u770b\u51fa\u6765\u8fd9\u73a9\u610f\u513f\u662f\u659c\u7387\u4f18\u5316\uff01\n\n\u54ce\uff0c\u624b\u751f\u4e86\uff0c\u659c\u7387\u4f18\u5316\u90fd\u597d\u4e45\u6ca1\u505a\u4e86\u5462...QVQ\n\n\u7136\u540e\u7684\u8bdd\u6211\u4eec\u5427\u5f0f\u5b50\u5c55\u5f00\u51fa\u6765\u5c31\u662f\uff1a\n\n\n$$f_i=f_j +h_i^{~~ 2} +  h_j^{~~ 2}  -2\u00b7h_ih_j +W_{i-1}-W_j $$\n\n\u5728\u79fb\u4e00\u4e0b\u9879\u53d8\u6210\u659c\u7387\u4f18\u5316\u6807\u51c6\u5f62\u5f0f\uff1a\n\n\n$$    2\u00b7h_ih_j +f_i~~~ [+ h_i^{~~ 2} -W_{i-1} ] = f_j + h_j^{~~ 2} -W_j $$\n\n\u5ffd\u7565\u6389 [] \u91cc\u9762\u7684\u5e38\u91cf\uff0c\u8fd9\u5c31\u662f\u4e00\u4e2a\u4e00\u6b21\u51fd\u6570\u4e86\uff0c\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u8ba9 f[i] \u6700\u5c0f\uff0c\u90a3\u4e48\u5c31\u662f\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u58f3\n\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u8d85\u7ea7\u96be\u7ef4\u62a4\uff1a\n\n\u56e0\u4e3a\u9996\u5148\u8fd9\u91cc\u7684\u659c\u7387 h[i] \u662f\u4e0d\u5355\u8c03\u7684\uff0c\u5e76\u4e14\u6211\u4eec\u53d1\u73b0\u6a2a\u5750\u6807 x \u662f h[i] \uff0c \u4e5f\u662f\u4e0d\u5355\u8c03\u7684\uff01\n\n\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u8981\u5728\u5355\u8c03\u6808\u91cc\u9762\u4e8c\u5206\u627e\u7b54\u6848\uff0c\u66f4\u8981\u547d\u7684\u662f\u6bcf\u6b21\u8981\u5728\u5355\u8c03\u4e2d\u95f4\u63d2\u5165\u4e00\u4e2a\u70b9\uff01\u7528 map \uff01\u7528 set \uff01 \u53e3\u80e1\u5012\u662f\u5bb9\u6613\u7684\u554a  $QVQ$\uff0c \u4e8e\u662f\u6211\u6210\u529f\u7684\u53e3\u80e1\u6389\u4e86\u8fd9\u9053\u9898\u7136\u540e\u4ea4\u4e86 30 \u5206\u4ee3\u7801\uff08\u597d\u5427\u5176\u5b9e\u6211\u6839\u672c\u4e0d\u4f1a\u5904\u7406\u52a8\u6001\u51f8\u5305\u554a...\uff09\n\n\n\u867d\u7136\u8bf4\u4f1a\u52a8\u6001\u51f8\u5305\u7684\u5946\u4f6c\u53ef\u4ee5\u5206\u5206\u949f\u5207\u4e86\u8fd9\u9898\uff0c\u4f46\u662f\u8eab\u4e3a\u849f\u84bb\u7684\u6211\u53ea\u4f1a\u5206\u6cbb...\n\n\n\u6211\u4eec\u8003\u8651\u53ef\u4ee5\u6c5f\u4e00\u4e2a\u4e0a\u51f8\u58f3\u62c6\u6210\u4e24\u4e2a\uff0c\u7136\u540e\u5206\u522b\u5bf9 i \u8ba1\u7b97\u7b54\u6848\uff0c\u4e24\u8005\u53d6\u8f83\u4f18\uff0c\u90a3\u4e48\u8fd9\u6837\u7684\u64cd\u4f5c\u5e76\u4e0d\u4f1a\u5f71\u54cd\u7b54\u6848\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u53bb\u8ba9 CDQ \u6bcf\u4e00\u5c42\u7684\u5de6\u90e8\u5206\u6784\u9020\u4e0a\u51f8\u58f3\u7136\u540e\u53bb\u66f4\u65b0\u53f3\u8fb9\u7684\u7b54\u6848\uff0c\u53ef\u4ee5\u8bc1\u660e\u8fd9\u6837\u505a\u662f\u6b63\u786e\u7684\u3002\n\n\u53e6\u5916\u8fd9\u91cc\u8981\u6ce8\u610f\u5f53\u6211\u4eec\u5230\u8fbe\u4e00\u4e2a CDQ \u5206\u6cbb\u5c42\u65f6\uff0c\u5148\u9012\u5f52\u5904\u7406\u5de6\u90e8\u5206\uff0c\u7136\u540e\u518d\u5904\u7406\u5f53\u524d\u5c42\uff0c\u6700\u540e\u518d\u53bb\u5904\u7406\u53f3\u8fb9\u7684\u90e8\u5206\n\n\u4e3a\u4ec0\u4e48\uff1f\u56e0\u4e3a\u6211\u4eec\u6784\u9020\u51f8\u5305\u7684\u65f6\u5019\u8981\u5148\u62ff\u5230 f[i] \u7684\u6700\u4f18\u503c\u554a\uff0c\u6240\u4ee5\u80af\u5b9a\u8981\u7b49\u5230\u70b9 i \u7684 f \u503c\u66f4\u65b0\u5b8c\u6bd5\u4e4b\u540e\u624d\u80fd\u7528\u7684\u554a\n\n\n```\n//by Judge\n#include<bits/stdc++.h>\n#define fp(i,a,b) for(int i=(a),I=(b)+1;i<I;++i)\n#define mid (l+r>>1)\n#define ll long long\n#define db double\nusing namespace std;\nconst db inf=1e18;\nconst int M=1e5+3;\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline bool cmin(ll& a,ll b){return a>b?a=b,1:0;}\ninline ll read(){ ll x=0,f=1; char c=getchar();\n\tfor(;!isdigit(c);c=getchar()) if(c=='-') f=-1;\n\tfor(;isdigit(c);c=getchar()) x=x*10+c-'0'; return x*f;\n} int n,top,num[22][M]; ll f[M];\nstruct node{ ll id,h,w; }s[M],ss[M];\nstruct po{ ll x,y,id; }stk[M];\ninline void merge(int k,int l,int r){  //\u9884\u5904\u7406\u4f7f\u5f97\u6bcf\u4e2a\u5206\u6cbb\u5757\u5185 h \u9012\u589e\n\tif(l==r) return num[k][l]=l,void();\n\tmerge(k+1,l,mid),merge(k+1,mid+1,r);\n\tint li=l,ri=mid+1;\n\tfp(i,l,r) if(li>mid) num[k][i]=num[k+1][ri++];\n\t\telse if(ri>r) num[k][i]=num[k+1][li++];\n\t\telse num[k][i]=s[num[k+1][li]].h<=s[num[k+1][ri]].h?\n\t\t\t\t\t\tnum[k+1][li++]:num[k+1][ri++];\n}\ninline po xl(po a,po b){return {a.x-b.x,a.y-b.y,0};}\ninline ll cj(po a,po b){return a.x*b.y-a.y*b.x;}\ninline void make_convex(int l,int r){ top=0; //\u7ef4\u62a4 \u4e0a\u3010\u5212\u6389\u3011\u4e0b\u51f8\u58f3\n\tfp(i,l,r){ po now={s[i].h,f[s[i].id]+s[i].h*s[i].h-s[i].w,s[i].id};\n\t\tfor(;top>1&&cj(xl(stk[top],stk[top-1]),xl(now,stk[top]))<=0;--top);\n\t\tstk[++top]=now;\n\t}\n}\ninline db get_k(po& a,po& b){  //\u62ff\u4e2a\u659c\u7387\n\tif(a.x^b.x) return (db)(a.y-b.y)/(db)(a.x-b.x);\n\treturn a.y>b.y?-inf:inf;\n}\nvoid CDQ(int k,int l,int r){\n\tif(l==r) return ; CDQ(k+1,l,mid);\n\tfp(i,l,r) s[i]=ss[num[k+1][i]];\n\tmake_convex(l,mid); int fs=1;\n\tfp(i,mid+1,r){  //\u56e0\u4e3a\u6b64\u65f6 s \u4e2d h \u9012\u589e\u6240\u4ee5\u53ef\u4ee5\u5355\u8c03\u961f\u5217\u5904\u7406\u4e86\n\t\tfor(;fs<top&&2*s[i].h>get_k(stk[fs],stk[fs+1]);++fs);\n\t\tint j=stk[fs].id,ii=s[i].id;\n\t\tcmin(f[ii],f[j]+(ss[ii].h-ss[j].h)*(ss[ii].h-ss[j].h)+ss[ii-1].w-ss[j].w);\n\t} fp(i,mid+1,r) s[i]=ss[i]; CDQ(k+1,mid+1,r); //\u5411\u4e0b\u5206\u6cbb\n}\nint main(){ n=read();\n\tfp(i,1,n) s[i].h=read();\n\tfp(i,1,n) s[i].w=s[i-1].w+read();\n\tfp(i,1,n) s[i].id=i,ss[i]=s[i];\n\tmerge(1,1,n); fp(i,2,n) f[i]=inf;\n\treturn CDQ(1,1,n),!printf(\"%lld\\n\",f[n]); //\u8bb0\u5f97 long long\n}\n```\n\n\n\u7136\u540e\u7ed9\u4e00\u4e2a\u5946\u4f6c\u7684\u52a8\u6001\u51f8\u5305\u4ee3\u7801 $QVQ$\uff08\u6ca1\u9519\u5c31\u662fBinamoto\uff01\uff09\n\n\u5dee\u70b9\uff08\u597d\u5427\u5176\u5b9e\u662f\u5df2\u7ecf\uff09 AK \u4e86\u67d0\u573a\u6709\u6b64\u9898\u7684\u6bd4\u8d5b\n\n\n```\n//minamoto\n#include<bits/stdc++.h>\n#define R register\n#define ll long long\n#define ld long double\n#define pi pair<int,ll>\n#define IT map<int,ll>::iterator\n#define fp(i,a,b) for(R int i=(a),I=(b)+1;i<I;++i)\n#define fd(i,a,b) for(R int i=(a),I=(b)-1;i>I;--i)\n#define go(u) for(int i=head[u],v=e[i].v;i;i=e[i].nx,v=e[i].v)\nusing namespace std;\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline char getc(){return p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++;}\nint read(){\n    R int res,f=1;R char ch;\n    while((ch=getc())>'9'||ch<'0')(ch=='-')&&(f=-1);\n    for(res=ch-'0';(ch=getc())>='0'&&ch<='9';res=res*10+ch-'0');\n    return res*f;\n}\nconst int N=1e5+5;\nstruct node{\n\tint h;double k;\n\tnode(){}\n\tnode(R int hh,R double kk=0){h=hh,k=kk;}\n\tinline bool operator <(const node &b)const{return k<b.k;}\n\tinline bool operator <=(const node &b)const{return k<=b.k;}\n\tinline bool operator ==(const node &b)const{return h==b.h&&k==b.k;}\n};\nint h[N];ll sum[N],f[N],g[N];map<int,ll>mp;set<node>s;\nint n;bool flag=0;int hi,ht;\ninline ll G(R int id){return f[id]+1ll*h[id]*h[id]-sum[id];}\ninline bool cross(R int id,pi a,pi b){\n\treturn (ld)(a.first-h[id])*(b.second-g[id])-(ld)(a.second-g[id])*(b.first-h[id])>=0;\n}\ninline double slope(pi a,pi b){return 1.0*(b.second-a.second)/(b.first-a.first);}\nbool in(int id){\n\tif(h[id]<mp.begin()->first||h[id]>(--mp.end())->first)return false;\n\tIT it=mp.lower_bound(h[id]);\n\tif(it!=mp.end()&&it->first==h[id])return it->second<=g[id];\n\tIT itr=it;--it;\n\treturn cross(id,*it,*itr);\n}\nvoid del(IT itl,IT itr){s.erase(node(itl->first,slope(*itl,*itr)));}\nvoid ins(IT it){\n\tIT itl=it,itr=it;--itl,++itr;\n\tif(it!=mp.begin())s.insert(node(itl->first,slope(*itl,*it)));\n\tif(itr!=mp.end())s.insert(node(it->first,slope(*it,*itr)));\n}\nvoid update(int id){\n\tif(in(id))return;\n\tIT it=mp.lower_bound(h[id]),itr;\n\tif(it!=mp.end()&&it->first==h[id]){\n\t\tIT itl=it,itr=it;--itl,++itr;\n\t\tif(it!=mp.begin())del(itl,it);\n\t\tif(itr!=mp.end())del(it,itr);\n\t\tmp.erase(it);\n\t}else{\n\t\tIT itl=it;--itl;\n\t\tif(it!=mp.begin()&&it!=mp.end())del(itl,it);\n\t}\n\tit=mp.upper_bound(h[id]),itr=it;\n\tif(it!=mp.end()){\n\t\t++itr;\n\t\twhile(itr!=mp.end()&&cross(id,*itr,*it))\n\t\t\tdel(it,itr),mp.erase(it),it=itr,++itr;\n\t}\n\tit=mp.lower_bound(h[id]),itr=it;--itr;\n\tif(it!=mp.begin()&&itr!=mp.begin()){\n\t\t--it,--itr;\n\t\twhile(it!=mp.begin()&&cross(id,*it,*itr))\n\t\t\tdel(itr,it),mp.erase(it),it=itr,--itr;\n\t}\n\tmp[h[id]]=g[id];\n\tit=mp.lower_bound(h[id]),ins(it);\n}\nint get(int k){\n\tset<node>::iterator it=s.lower_bound(node(0,1.0*k));\n\tif(it==s.end())return (--mp.end())->first;\n\treturn it->h;\n}\nint main(){\n\tn=read();\n\tfp(i,1,n)h[i]=read();\n\tfp(i,1,n)sum[i]=read()+sum[i-1];\n\tf[1]=0,f[2]=1ll*(h[2]-h[1])*(h[2]-h[1]),g[1]=G(1),g[2]=G(2);\n\tmp[h[1]]=g[1],update(2);\n\tfp(i,3,n){\n\t\tht=get(2*h[i]);\n\t\tf[i]=sum[i-1]+mp[ht]+1ll*h[i]*h[i]-2ll*h[i]*ht;\n\t\tg[i]=G(i);\n\t\tupdate(i);\n\t}\n\tprintf(\"%lld\\n\",f[n]);\n\treturn 0;\n}\n```\n\n\n\n\u5f53\u7136\u8d85\u54e5\u7ebf\u6bb5\u6811\u4e5f\u662f\u6709\u7684 $QVQ$ \uff08\u4f46\u662f\u53ea\u6709\u7b2c\u4e00\u4e2a\u4ee3\u7801\u662f\u6211\u6ef4~\uff09\n\n\u81f3\u4e8e\u600e\u4e48\u505a\u561b\u3002\u3002\u3002\u6211\u5c31\u4e0d\u4f1a\u4e86\uff0c\u672c\u9898\u89e3\u53ea\u8bb2\u5206\u6cbb\u505a\u6cd5...\n\n\u4f46\u662f\u8fd9\u4e2a\u8d85\u54e5\u7ebf\u6bb5\u6811\u4ee3\u7801\u786e\u5b9e\u662f\u8dd1\u5f97\u6bd4\u6211\u5feb\u7684...\n\n\u4ee3\u7801\u8c8c\u4f3c\u662f zcy \u5927\u4f6c\u7684 emmm... \u770b\u5230\u522b\u68d5\u6211 $QWQ$\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\n#define N 100010\n#define M 1000000\n#define LL long long\n#define LD long double\n#define F(x, y, z) for (int x = y; x <= z; ++x)\n#define D(x, y, z) for (int x = y; x >= z; --x)\nint Max(int x, int y) { return x > y ? x : y; }\nint Min(int x, int y) { return x < y ? x : y; }\ntemplate <typename T> void read(T &x)\n{\n\tx = 0; T f = 1; char c = getchar();\n\tfor ( ; !isdigit(c); c = getchar()) if (c == '-') f = -f;\n\tfor ( ; isdigit(c); c = getchar()) x = x * 10 + c - '0';\n\tx *= f;\n}\nLL h[N], s[N], f[N];\nint n;\nstruct LiChao_Tree\n{\n\tLL X[M * 4 + N], Y[M * 4 + N];\n\tvoid Build(int k, int l, int r)\n\t{\n\t\tX[k] = 0, Y[k] = 1e14;\n\t\tif (l == r) return;\n\t\tint mid = l + r >> 1;\n\t\tBuild(k << 1, l, mid);\n\t\tBuild(k << 1 | 1, mid + 1, r);\n\t}\n\tvoid Modify(int k, int l, int r, LL x, LL y) \n\t{\n\t\tint mid = l + r >> 1;\n\t\tif (x * mid + y < X[k] * mid + Y[k])\n\t\t\tswap(X[k], x), swap(Y[k],y);\n\t\tif (x == X[k] || l == r) return;\n\t\tif (x > X[k]) Modify(k << 1, l, mid, x, y);\n\t\telse Modify(k << 1 | 1, mid + 1, r, x, y);\n\t}\n\tLL Query(int k,int l,int r, int w)\n\t{\n\t\tif (l == r) return X[k] * w + Y[k];\n\t\tint mid = l + r >> 1;\n\t\tLL ans = X[k] * w + Y[k];\n\t\tif (w <= mid) ans = min(ans, Query(k << 1, l, mid, w));\n\t\telse ans = min(ans, Query(k << 1 | 1, mid + 1, r, w));\n\t\treturn ans;\n\t}\n} T;\nLL C(int x)\n{\n\treturn h[x] * h[x] - s[x] + f[x];\t\n} \nint main(){\n\tread(n);\n\tF(i, 1, n) read(h[i]);\n\tF(i, 1, n) read(s[i]), s[i] += s[i - 1];\n\tT.Build(1, 0, M);\n\tT.Modify(1, 0, M, -2 * h[1], C(1));\n\tF(i, 2, n)\n\t{\n\t\tf[i] = h[i] * h[i] + s[i - 1] + T.Query(1, 0, M, h[i]);\n\t\tT.Modify(1, 0, M, -2 * h[i], C(i));\n\t}\n\tcout << f[n] << '\\n';\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1552719380,
        "uid": 38576,
        "name": "J\u03bcdge",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4655 \u3010[CEOI2017]Building Bridges\u3011"
    },
    {
        "content": "[\u9898\u9762](https://www.luogu.com.cn/problem/P4655)\n\n\u674e\u8d85\u7ebf\u6bb5\u6811\u4f18\u5316 $\\text{dp}$\u3002\n\n\u672c\u6765\u60f3\u5b66\u4e60\u4e00\u4e0b\u659c\u7387\u4f18\u5316\u7684\uff0c\u4f46\u53d1\u73b0\u8fd9\u9898\u7528\u659c\u7387\u4f18\u5316\u8fd8\u8981\u5957\u4e00\u4e2a $\\text{CDQ}$ \u5206\u6cbb\uff0c\u76f4\u63a5\u653e\u5f03\u3002\n\n\u4e0d\u4f1a\u674e\u8d85\u7ebf\u6bb5\u6811\u7684\u53ef\u4ee5\u770b[\u6211\u7684\u8fd9\u7bc7\u535a\u5ba2](https://www.luogu.com.cn/blog/s19418/li-chao-xian-duan-shu-xue-xi-bi-ji)\u3002\n\n\u5176\u5b9e\u8fd9\u7bc7\u535a\u5ba2\u4e5f\u6709\u8865\u5145\u5230\u8fd9\u9898\u7684\u601d\u8def\uff0c\u4f46\u8bb2\u5f97\u4e0d\u6e05\u6670\uff0c\u6211\u518d\u7b80\u5355\u8bf4\u4e00\u4e0b\u3002\n\n\u770b\u9898\uff0c\u4e00\u773c\u4e01\u771f\uff0c\u53ef\u7528 $\\text{dp}$\u3002\n\n\u8bbe $dp_i$ \u8868\u793a\u5c06 $1$ \u53f7\u4e0e $i$ \u53f7\u67f1\u5b50\u8fde\u63a5\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u968f\u4fbf\u63a8\u4e00\u63a8\uff0c\u8f6c\u79fb\u65b9\u7a0b\u5c31\u51fa\u6765\u4e86\uff1a\n\n$$dp_i=\\min\\limits_{1\\leq j<i}\\{dp_j+(h_i-h_j)^2+\\sum\\limits_{k=j}^iw_k\\}$$\n\n\u8bbe $s_i=\\sum\\limits_{k=1}^iw_k$\uff0c\u5219\u6709\uff1a\n\n$$\n\\begin{aligned}\ndp_i&=\\min\\limits_{0\\leq j<i}\\{dp_j+h_i^2+h_j^2-2h_ih_j+s_{i-1}-s_j\\}\\\\\n&=\\min\\limits_{0\\leq j<i}\\{(-2h_i)\\cdot h_j+(dp_j+h_j^2-s_j)\\}+h_i^2+s_{i-1}\\\\\n\\end{aligned}\n$$\n\n\u8bbe $a_j=-2h_j$\uff0c$b_j=dp_j+h_j^2-s_j$\uff0c\u5219\u6709\uff1a\n\n$$dp_i=\\min\\limits_{0\\leq j<i}\\{a_jh_i+b_j\\}+h_i^2+s_{i-1}$$\n\n\u95ee\u9898\u8f6c\u5316\u4e3a\u5df2\u77e5 $i-1$ \u6761\u76f4\u7ebf $y=a_jx+b_j$\uff0c\u6c42 $x=h_i$ \u65f6\u7684 $y$ \u7684\u6700\u5c0f\u503c\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define LL long long\n#define N 100005\n#define M 1000005\nusing namespace std;\nint n;LL h[N],s[N],A[N],B[N];\nint Best[M<<2];\ninline LL GetY(int id,int x){return A[id]*x+B[id];}\ninline bool Cmp(int id1,int id2,int x){\n\treturn GetY(id1,x)<GetY(id2,x);\n}\n#define ls (k<<1)\n#define rs (k<<1|1)\n#define mid (l+r>>1)\nvoid Set(int k,int l,int r,int id){\n\tBest[k]=id;if(l^r) Set(ls,l,mid,id),Set(rs,mid+1,r,id);\n}\nvoid Insert(int k,int l,int r,int id){\n\tif(Cmp(id,Best[k],mid)) swap(id,Best[k]);\n\tif(l==r||A[id]==A[Best[k]]) return;\n\tif(A[id]>A[Best[k]]) Insert(ls,l,mid,id);\n\tif(A[id]<A[Best[k]]) Insert(rs,mid+1,r,id);\n}\nLL Query(int k,int l,int r,int x){\n\tif(l==r) return GetY(Best[k],x);\n\tLL res(GetY(Best[k],x));\n\tif(x<=mid) return min(res,Query(ls,l,mid,x));\n\treturn min(res,Query(rs,mid+1,r,x));\n}\nLL dp[N];\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i(1);i<=n;++i) scanf(\"%lld\",&h[i]);\n\tfor(int i(1);i<=n;++i) scanf(\"%lld\",&s[i]),s[i]+=s[i-1];\n\tA[1]=-2*h[1];B[1]=h[1]*h[1]-s[1];Set(1,0,M,1);\n\tfor(int i(2);i<=n;++i){\n\t\tdp[i]=Query(1,0,M,h[i])+h[i]*h[i]+s[i-1];\n\t\tA[i]=-2*h[i];B[i]=dp[i]+h[i]*h[i]-s[i];\n\t\tInsert(1,0,M,i);\n\t}\n\tprintf(\"%lld\\n\",dp[n]);\n\treturn 0;\n}\n```",
        "postTime": 1679136400,
        "uid": 554574,
        "name": "gyyyyx",
        "ccfLevel": 0,
        "title": "[CEOI2017] Building Bridges"
    },
    {
        "content": "\u5c0f\u6e05\u65b0\u659c\u7387\u4f18\u5316\u9898\u3002\n\n\u5206\u6bb5\u95ee\u9898\u663e\u7136 dp\uff0c\u4ee4 $f_i$ \u4e3a\u5c06\u7b2c $1$ \u6839\u67f1\u5b50\u548c\u7b2c $i$ \u6839\u67f1\u5b50\u8fde\u63a5\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002$f_1=0$\uff0c\u6bcf\u6b21\u679a\u4e3e $i$ \u5411\u524d\u76f4\u63a5\u8fde\u63a5\u7684\u67f1\u5b50\uff1a\n\n$$f_{i}=\\min\\limits_{j=1}^{i-1}\\left\\{f_j+(h_i-h_j)^2+\\sum\\limits_{k=j+1}^{i-1}w_k\\right\\}$$\n\n\u4ee4 $s_{i}=\\sum\\limits_{j=1}^iw_j$\uff0c\u7136\u540e\u628a\u8f6c\u79fb\u62c6\u5f00\uff0c\u5047\u8bbe\u6700\u4f18\u51b3\u7b56\u70b9\u4e3a $j$\uff1a\n\n$$f_i=f_j+(h_i-h_j)^2+s_{i-1}-s_{j}$$\n$$f_i=f_j+h_i^2+h_j^2-2h_jh_i+s_{i-1}-s_{j}$$\n$$f_{i}-s_{i-1}-h_i^2=f_j-s_j+h_j^2-2h_j\\times h_i$$\n\n\u5e73\u51e1\u7684\u659c\u7387\u4f18\u5316\u4f1a\u628a\u4e0a\u5f0f\u5199\u6210 $b=y-xk$ \u7684\u5f62\u5f0f\uff0c\u4f46\u6211\u4eec\u65cb\u8f6c\u4e00\u4e0b\u5750\u6807\u7cfb\uff0c\u4ee4 $y_i=f_{i}-s_{i-1}-h_{i}^2$\uff0c$b_j=f_j-s_j+h_j^2$\uff0c$k_j=-2h_j$\uff0c$x_i=h_i$\uff1a\n\n$$y_i=k_jx_i+b_j$$\n\n\u4e8e\u662f\u6211\u4eec\u5f97\u5230\u4e86\u659c\u7387\u4f18\u5316\u7684\u53e6\u4e00\u79cd\u5f62\u5f0f\u3002\n\n\n\u6211\u4eec\u53ef\u4ee5\u5c06\u8f6c\u79fb\u70b9 $j$ \u770b\u4f5c\u5e73\u9762\u4e0a\u7684\u4e00\u6761\u6761\u5f62\u5982 $y=k_jx+b_j$ \u7684\u76f4\u7ebf\uff0c\u6bcf\u6b21\u5373\u67e5\u8be2\u4e00\u4e2a $x$ \u5750\u6807\u4e0a $y$ \u5750\u6807\u6700\u5c0f\u7684\u503c\uff0c\u652f\u6301\u52a8\u6001\u63d2\u5165\u4e00\u6761\u76f4\u7ebf\u3002\n\n\u674e\u8d85\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5373\u53ef\u3002\u590d\u6742\u5ea6 $O(n\\log w)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\n\nnamespace vbzIO {\n\tchar ibuf[(1 << 20) + 1], *iS, *iT;\n\t#if ONLINE_JUDGE\n\t#define gh() (iS == iT ? iT = (iS = ibuf) + fread(ibuf, 1, (1 << 20) + 1, stdin), (iS == iT ? EOF : *iS++) : *iS++)\n\t#else\n\t#define gh() getchar()\n\t#endif\n\t#define pi pair<int, int>\n\t#define mp make_pair\n\t#define fi first\n\t#define se second\n\t#define pb push_back\n\t#define ins insert\n\t#define era erase\n\tinline int read () {\n\t\tchar ch = gh();\n\t\tint x = 0;\n\t\tbool t = 0;\n\t\twhile (ch < '0' || ch > '9') t |= ch == '-', ch = gh();\n\t\twhile (ch >= '0' && ch <= '9') x = (x << 1) + (x << 3) + (ch ^ 48), ch = gh();\n\t\treturn t ? ~(x - 1) : x;\n\t}\n\tinline void write(int x) {\n\t\tif (x < 0) {\n\t\t\tx = ~(x - 1);\n\t\t\tputchar('-');\n\t\t}\n\t\tif (x > 9)\n\t\t\twrite(x / 10);\n\t\tputchar(x % 10 + '0');\n\t}\n}\nusing vbzIO::read;\nusing vbzIO::write;\n\nconst int maxn = 1e5 + 100;\nconst int maxw = 1e6 + 100;\nconst int inf = 1e18;\nint n, h[maxn], w[maxn], s[maxn], f[maxn], tr[maxw << 2];\n\n#define ls x << 1\n#define rs x << 1 | 1\n#define mid ((l + r) >> 1)\nint K(int id) { return - 2 * h[id]; }\nint B(int id) { return id ? (f[id] - s[id] + h[id] * h[id]) : inf; }\nint gety(int id, int x) { return K(id) * x + B(id); }\nint cmp(int x, int y) { return x == y ? 0 : (x > y ? 1 : -1); }\nvoid push(int l, int r, int s, int x) {\n    int &t = tr[x];\n    if (cmp(gety(s, mid), gety(t, mid)) == -1) swap(s, t);\n    int fl = cmp(gety(s, l), gety(t, l)), fr = cmp(gety(s, r), gety(t, r));\n    if (fl == -1 || (!fl && s < t)) push(l, mid, s, ls);\n    if (fr == -1 || (!fr && s < t)) push(mid + 1, r, s, rs);\n}\n\nint qry(int l, int r, int p, int x) {\n    if (l == r) return gety(tr[x], p);\n    int res = gety(tr[x], p);\n    if (p <= mid) return min(res, qry(l, mid, p, ls));\n    else return min(res, qry(mid + 1, r, p, rs));\n}\n\nsigned main() {\n\tn = read();\n    for (int i = 1; i <= n; i++) h[i] = read();\n    for (int i = 1; i <= n; i++) w[i] = read(), s[i] = s[i - 1] + w[i];\n    push(0, 1e6, 1, 1);\n    for (int i = 2; i <= n; i++) {\n        int j = qry(0, 1e6, h[i], 1);\n        f[i] = j + s[i - 1] + h[i] * h[i];\n        push(0, 1e6, i, 1);\n    }\n    write(f[n]);\n\treturn 0;\n}\n```",
        "postTime": 1676279965,
        "uid": 306573,
        "name": "Ender32k",
        "ccfLevel": 0,
        "title": "CEOI2017 Building Bridges"
    },
    {
        "content": "[\u535a\u5ba2\u98df\u7528\u6548\u679c\u66f4\u4f73](https://www.cnblogs.com/lxy-2022/p/P4655-Solution.html)\n#### \u5206\u6790\n\n\u53d1\u73b0\u5982\u679c\u5728 $i,j$ \u4e4b\u95f4\u5efa\u6865\uff0c\u90a3\u4e48 $(i,j)$ \u5185\u7684\u6240\u6709\u67f1\u5b50\u90fd\u662f\u65e0\u7528\u7684\uff0c\u4ee3\u4ef7\u8fd8\u9700\u52a0\u4e0a $(i,j)$ \u5185\u7684\u6240\u6709\u62c6\u9664\u4ee3\u4ef7\u3002\u8bbe $dp_i$ \u4e3a\u4ece $1$ \u8d70\u5230 $i$ \u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u4e8e\u662f\u8f6c\u79fb\u65b9\u7a0b\u5c31\u547c\u4e4b\u6b32\u51fa\u4e86\uff1a\n$$\ndp_i=\\min\\limits_{j=1}^{i-1}\\{dp_j+(h_i-h_j)^2+s_{i-1}-s_j\\}\n$$\n\uff0c\u5176\u4e2d $s_i$ \u8868\u793a\u62c6\u9664\u4ee3\u4ef7\u7684\u524d\u7f00\u548c\u3002\u53d1\u73b0\u5982\u679c\u679a\u4e3e\u6bcf\u4e00\u4e2a $j$ \u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O}(n^2)$\uff0c\u663e\u7136\u4f1a TLE\uff0c\u56e0\u6b64\u8003\u8651\u4f18\u5316\u3002\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u662f\u5f88\u5178\u578b\u7684\u659c\u7387\u4f18\u5316\u5f62\u5f0f\uff0c\u53ef\u4ee5\u53d8\u5f62\u4e3a\uff1a\n$$\ndp_i=\\min\\limits_{j=1}^{i-1}\\{dp_j-2h_ih_j+h_j^2-s_j\\}+h_i^2+s_{i-1}\n$$\n\u7136\u800c\u53d1\u73b0\u6bcf\u6b21\u67e5\u8be2\u7684\u659c\u7387\u5e76\u4e0d\u662f\u6709\u5e8f\u7684\uff0c\u56e0\u6b64\u4e0d\u80fd\u76f4\u63a5\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u51f8\u5305\u3002\u53d1\u73b0\u6570\u636e\u8303\u56f4\u53ea\u5230 $10^5$\uff0c\u7528\u674e\u8d85\u7ebf\u6bb5\u6811\u53ef\u4ee5\u65b9\u4fbf\u7684\u6c42\u51fa\u5f53 $x=h_i$ \u65f6\u6700\u5c0f\u7684 $y$\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u505a\u4e86\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log n)$\u3002\n\n#### \u6838\u5fc3\u4ee3\u7801\n\n```cpp\nqread(n);int i,j,mx=0;for(i=1;i<=n;i++) qread(h[i]),mx=qmax(mx,h[i]);\nbuild(1,0,mx);for(i=1;i<=n;i++) qread(w[i]),w[i]+=w[i-1];\ndp[1]=0;upd(1,0,mx,Line{-2*h[1],h[1]*h[1]-w[1]});\nfor(i=2;i<=n;i++){\n    dp[i]=que(1,0,mx,h[i])+h[i]*h[i]+w[i-1];\n    upd(1,0,mx,Line{-2*h[i],dp[i]+h[i]*h[i]-w[i]});\n}printf(\"%lld\\n\",dp[n]);\n```\n\n[record](https://www.luogu.com.cn/record/86519916)",
        "postTime": 1663039426,
        "uid": 225991,
        "name": "_lxy_",
        "ccfLevel": 6,
        "title": "P4655 [CEOI2017] Building Bridges \u9898\u89e3"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P4655)\n\n## \u601d\u7ef4\u5386\u7a0b\n\n\u9996\u5148\u5e94\u5f53\u601d\u8003\u4e0d\u5e26\u4f18\u5316\u7684 dp\uff0c\u518d\u8fdb\u884c\u4f18\u5316\u3002\n\n\u5148\u5217\u51fa\u6700\u6734\u7d20\u7684\u5f0f\u5b50\u3002\n$$f_i=\\min_{j=1}^{j \\le i}\\{f_j+(h_i-h_j)^2+sum_{i-1}-sum_j\\}$$\n\n\u5176\u4e2d $sum_j=\\sum_{i=1}^ja_i$\uff0c\u518d\u5c06\u4e0e $i$ \u6709\u5173\u9879\u63d0\u51fa\u3002\n\n$$f_i={h_i}^2+sum_{i-1}+\\min_{j=1}^{j \\le i}\\{f_j-2h_ih_j+{h_j}^2-sum_j\\}$$\n\n\u89c2\u5bdf\u5230\u5176\u4e2d\u6709\u4e00\u9879\u4e3a $-2h_ih_j$\uff0c\u4e0e $i$ \u548c $j$ \u90fd\u6709\u5173\uff0c\u4e14\u7ed3\u5408\u6570\u636e\u8303\u56f4\u8fbe\u5230 $10^6$\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u91c7\u7528\u674e\u8d85\u6811\u8fdb\u884c\u4f18\u5316\u3002\n\n\u7b80\u5355\u8bb2\u4e00\u4e0b\u674e\u8d85\u6811\u7684\u5b9e\u73b0\uff0c\u63d2\u5165\u76f4\u7ebf\u5176\u5b9e\u5c31\u662f\u5bf9\u4e00\u4e2a\u533a\u95f4\uff0c\u9996\u5148\u5224\u65ad\u5176\u4e2d\u70b9\uff0c\u82e5\u65b0\u52a0\u5165\u76f4\u7ebf\u66f4\u4f18\u76f4\u63a5\u4ea4\u6362\u65b0\u65e7\u7f16\u53f7\uff0c\u63a5\u4e0b\u6765\u5bf9\u4e24\u7aef\u5224\u65ad\uff0c\u82e5\u65b0\u76f4\u7ebf\uff08\u6b64\u5904\u8868\u793a\u4ea4\u6362\u540e\u7684 $x$\uff09\u66f4\u4f18\u5219\u7ee7\u7eed\u67e5\u627e\u4e0b\u53bb\u3002\n\n\u800c\u67e5\u8be2\u5219\u662f\u6b63\u5e38\u7c7b\u4f3c\u7ebf\u6bb5\u6811\u7684\u5199\u6cd5\uff0c\u4f46\u662f\u6ce8\u610f\u8981\u548c\u5f53\u524d\u5b58\u7684\u76f4\u7ebf\u7684\u53d6\u503c\u6bd4\u8f83\u53d6\u66f4\u4f18\uff0c\u56e0\u4e3a\u674e\u8d85\u6811\u5b58\u7684\u5176\u5b9e\u662f**\u53ef\u80fd\u7684**\u6700\u4f18\u76f4\u7ebf\uff0c\u8fd8\u662f\u4f1a\u6709\u4f8b\u5916\u7684\uff0c\u4e0d\u4f1a\u7684\u53ef\u4ee5\u5de6\u8f6c[\u8fd9\u91cc](https://www.luogu.com.cn/problem/P4254)\u3002\n\n\u9996\u5148\u8bbe $k=-2h_j$\uff0c$x=h_i$\uff0c$b=f_j+{h_j}^2-sum_j$\uff08\u628a\u548c $i$ \u6709\u5173\u7684\u8bbe\u4e3a\u672a\u77e5\u91cf\uff0c\u7528\u674e\u8d85\u6811\u7ef4\u62a4\u4e4b\u524d\u6240\u6709 $k$ \u548c $b$ \u7684\u6700\u4f18\u53d6\u503c\uff09\uff0c\u7ef4\u62a4\u6b64\u65f6\u7684 $y$ \u4e3a\u6700\u5c0f\u503c\uff0c\u5176\u5b9e\u5c31\u662f\u628a $y=kx+b$ \u89c6\u4e3a\u4e00\u6761\u76f4\u7ebf\uff0c\u6c42\u5bf9\u4e8e\u786e\u5b9a\u7684 $x$ \u5728\u4e4b\u524d\u7684\u54ea\u6761\u76f4\u7ebf\u4e0a\u7684\u53d6\u503c\u6700\u5c0f\uff0c\u5f97\u5230\u7684\u5c31\u662f\u7b54\u6848\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u70b9\u76f4\u63a5\u5904\u7406\u5e76\u52a0\u5165\u674e\u8d85\u6811\u4e2d\uff0c\u5bf9\u4e8e\u4e4b\u540e\u7684\u70b9\u5148\u8ba1\u7b97\u53d6\u503c\u518d\u52a0\u5165\u674e\u8d85\u6811\u3002\n\n**\u4e09\u4e2a\u5c0f\u5751\u70b9\uff1a**\n\n- \u8bb0\u5f97\u5f00 `long long`\u3002\n\n- \u674e\u8d85\u6811\u7531\u4e8e\u53f6\u5b50\u8282\u70b9\u662f\u533a\u95f4\u4e0a\u7684\u70b9\u6240\u4ee5\u8282\u70b9\u7a7a\u95f4\u5927\u5c0f\u8bb0\u5f97\u5f00\u56db\u500d\u3002\n\n- \u8bb0\u5f97\u521d\u59cb\u5316 $b_0$ \u540c\u65f6\u8d4b\u503c\u8981\u5927\u4ebf\u70b9\u3002\n\n~~\u672c\u4eba\u62d9\u89c1\uff0c\u5982\u6709\u5dee\u9519\uff0c\u8bf7\u8d50\u6559\u3002~~\n\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define void inline void\n#define ls rt<<1\n#define rs rt<<1|1\nusing namespace std;\nconst ll N=1e6+10;\nll n,h[N],sum[N],dp[N],k[N],b[N],pre[N<<2];\ninline ll read(){\n\tchar ch=getchar();ll res=0,f=1;\n\twhile(ch<'0'||'9'<ch){if(ch=='-')f=-1;ch=getchar();}\n\twhile('0'<=ch&&ch<='9') res=res*10+ch-'0',ch=getchar();\n\treturn res*f;\n}\ninline ll v(ll num,ll x){//\u5bf9\u4e8ex\u5728\u7b2cnum\u6761\u76f4\u7ebf\u4e0a\u7684\u53d6\u503c\u3002\n\treturn k[num]*x+b[num];\n}\nvoid modify(ll rt,ll l,ll r,ll x){//\u8fd9\u91cc\u662f\u63d2\u5165\u7b2cx\u6761\u76f4\u7ebf\u3002\n\tll mid=(l+r)>>1;\n\tif(v(x,mid)<v(pre[rt],mid))\tswap(x,pre[rt]);\n\tif(v(x,l)<v(pre[rt],l)) modify(ls,l,mid,x);\n\tif(v(x,r)<v(pre[rt],r)) modify(rs,mid+1,r,x);\n}\ninline ll query(ll rt,ll l,ll r,ll x){\n\tif(l==r) return v(pre[rt],x);\n\tll mid=(l+r)>>1;\n\tif(x<=mid) return min(v(pre[rt],x),query(ls,l,mid,x));//\u8bb0\u5f97\u53d6min\u3002\n\telse return min(v(pre[rt],x),query(rs,mid+1,r,x));\n}\nint main(){\n\tn=read(),b[0]=1e18;//\u4e00\u5f00\u59cb\u9ed8\u8ba4\u7b2c0\u6761\uff0c\u6240\u4ee5\u5fc5\u987b\u521d\u59cb\u5316\u3002\n\tfor(ll i=1;i<=n;i++) h[i]=read();\n\tfor(ll i=1;i<=n;i++) sum[i]=read(),sum[i]+=sum[i-1];\n\tk[1]=-2*h[1],b[1]=h[1]*h[1]-sum[1],modify(1,0,N,1);//\u7b2c\u4e00\u6761\u76f4\u63a5\u63d2\u5165\u3002\n\tfor(ll i=2;i<=n;i++){\n\t\tdp[i]=query(1,0,N,h[i])+h[i]*h[i]+sum[i-1];\n\t\tk[i]=-2*h[i],b[i]=dp[i]+h[i]*h[i]-sum[i],modify(1,0,N,i);\n\t}\n\tprintf(\"%lld\",dp[n]);\n\treturn 0;\n}\n```",
        "postTime": 1661172952,
        "uid": 365166,
        "name": "\u795e\u5149qwq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4655 [CEOI2017] Building Bridges"
    }
]