[
    {
        "content": "\u8fd9\u9898\u7f51\u4e0a\u8c8c\u4f3c\u8fd8\u6ca1\u6709\u5b8c\u6574\u7684\u9898\u89e3\u5462\uff0c\u6211\u6765\u53e3\u80e1\u4e00\u4e0b~\n\n# Description\n\n$W \\times H$ \u7684\u4e8c\u7ef4\u5750\u6807\u7cfb\uff0c$W, H \\le 10^9$\n\n\u7ed9 $n (n \\le 10^5)$  \u4e2a\u70b9 $(x, y)$\uff0c\u6bcf\u4e2a\u70b9\u6709\u4e2a\u65b9\u5411\uff0c\u6bcf $1$ \u65f6\u523b\u7bad\u5934\u671d\u5176\u4f4d\u7f6e\u79fb\u52a8\u4e00\u4e2a\u5355\u4f4d\uff0c\u5982\u679c\u70b9\u76f8\u9047\u5c31\u4f1a\u6d88\u5931\u3002\u95ee\u70b9\u7ecf\u8fc7\u8f68\u8ff9\u7684\u683c\u5b50\u5e76\u3002\n\n# Solution\n\n### \u6574\u4f53\u6846\u67b6\u5206\u6790\n\n\u5982\u679c\u6211\u4eec\u80fd\u5feb\u901f\u786e\u5b9a\u6bcf\u4e2a\u82e6\u65e0\u8fd0\u52a8\u7684\u8f68\u8ff9\uff08\u6700\u7ec8\u5728\u4f55\u65f6\u523b\u6d88\u5931\uff09\uff0c\u4e4b\u540e\u7684\u95ee\u9898\u662f\u77e9\u5f62\u9762\u79ef\u5e76\uff0c\u7528\u626b\u63cf\u7ebf $O(n \\log n)$ \u89e3\u51b3\u3002\n\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u4e0d\u8003\u8651\u82e6\u65e0\u7684\u6d88\u5931\uff0c\u4e24\u4e2a\u82e6\u65e0\u76f8\u649e\u7684\u5145\u8981\u6761\u4ef6\u5373\u5728\u4e00\u6761\u6a2a\u7ebf\u3001\u7ad6\u7ebf\u6216\u659c\u7ebf\uff08\u5448 $45\u00b0$ \u89d2\uff09\u4e0a\uff0c\u7136\u540e\u6ee1\u8db3\u4e00\u4e9b\u65b9\u5411\u9650\u5236\uff0c\u6bd4\u5982\uff0c\u5de6\u53f3\u76f8\u649e\u7684\u82e6\u65e0 $i, j$ \u8981\u6ee1\u8db3\u5728\u540c\u4e00\u6761\u6a2a\u7ebf $X_i = Y_i$\uff0c\u7136\u540e $Y_i < Y_j, D_i = 0, D_j = 2$\u3002\n\n\u4ee4\u6211\u4eec\u6bd4\u8f83\u56f0\u6270\u7684\u4e8b\uff0c\u53ef\u80fd\u4e24\u4e2a\u82e6\u65e0\u6ee1\u8db3\u4e0a\u8ff0\u6761\u4ef6\uff0c\u4f46\u5728\u6b64\u4e4b\u524d\u5176\u4e2d\u6709\u82e6\u65e0\u5df2\u7ecf\u6d88\u5931\u4e86\uff0c\u6240\u4ee5\u8fd9\u6b21\u76f8\u9047\u5c31\u5931\u8d25\u4e86\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u5904\u7406\uff0c\u6bcf\u6b21\u628a\u51b2\u7a81\u65f6\u95f4\u6700\u77ed\u7684\u82e5\u5e72\u82e6\u65e0\u90fd\u62ff\u51fa\u6765\u7136\u540e\u8ba9\u4ed6\u4eec\u6d88\u5931\uff0c\u5982\u679c\u6211\u4eec\u9047\u5230\u7684\u76f8\u9047\u4e8b\u4ef6\u4e2d\u53c8\u82e6\u65e0\u5df2\u7ecf\u6d88\u5931\u4e86\uff0c\u5c31\u8df3\u8fc7\u3002\n\n### \u5feb\u901f\u7ef4\u62a4 & \u7b97\u51fa\u6700\u77ed\u76f8\u649e\u7684\u82e6\u65e0\n\n\u7531\u4e8e\u6bcf\u4e2a\u70b9\u5206\u522b\u5728\u4e00\u6761\u6a2a\u7ebf\u3001\u7ad6\u7ebf\u3001\u659c\u7ebf\u4e0a\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u6761\u8fd9\u6837\u7684\u7ebf\u53ca\u65b9\u5411\u5f53\u6210\u4e00\u4e2a\u96c6\u5408\uff0c\u6bcf\u4e2a\u70b9\u81f3\u591a\u5728\u56db\u4e2a\u96c6\u5408\u4e2d\u3002\n\n\u7136\u540e\u6211\u4eec\u73b0\u5728\u7684\u95ee\u9898\u5c31\u53d8\u6210\u4e86\uff1a\u4e00\u4e2a\u6570\u8f74\u4e0a\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u53ef\u80fd\u6709\u4e24\u79cd\u79cd\u7c7b\u7684\u70b9 \uff08$0, 1$\uff09\uff0c\u7136\u540e\u8981\u6c42\u6700\u8fd1\u5339\u914d\u7684 $01$ \u70b9\u5bf9\uff08\u65b9\u5411\u4e0d\u80fd\u53cd\uff09\uff0c\u8fd8\u8981\u652f\u6301\u5220\u9664\u70b9\u3002\n\n\u5982\u679c\u6211\u4eec\u8003\u8651\u6bcf\u4e2a\u70b9\u5339\u914d\u7684\u6700\u4f18\u70b9\uff0c\u6211\u4eec\u662f\u53ef\u4ee5\u901a\u8fc7 $\\text{set}$ \u5728 $\\log$ \u65f6\u95f4\u7b97\u51fa\u524d\u9a71\u540e\u7ee7\uff0c\u4f46\u5220\u9664\u4e00\u4e2a\u70b9\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u6709\u591a\u4e2a\u70b9\u7684\u6700\u6709\u5339\u914d\u662f\u4ed6\uff0c\u8981\u4fee\u6539\u591a\u4e2a\u70b9\uff0c\u8fd9\u6837\u5c31\u6302\u4e86\u3002\u4e0d\u59a8\u8003\u8651\u53cc\u5411\u5339\u914d\uff0c\u6211\u4eec\u7ef4\u62a4 $x, y$ \u4e92\u76f8\u90fd\u4f5c\u4e3a\u5bf9\u65b9\u7684\u6700\u4f18\u5339\u914d\u8fd9\u6837\u7684\u70b9\u5bf9\uff0c\u8fd9\u6837\u662f\u5bf9\u7684\uff0c\u56e0\u4e3a\u5355\u5411\u5339\u914d\u603b\u80fd\u627e\u5230\u66f4\u4f18\u7684\u53cc\u5411\u5339\u914d\u3002\u6240\u4ee5\u5728\u5220\u9664\u7684\u4e00\u4e2a\u70b9\u7684\u65f6\u5019\uff0c\u5982\u679c\u4ed6\u5728\u53cc\u5411\u5339\u914d\u91cc\uff0c\u8ba9\u4ed6\u7684\u5339\u914d\u70b9\u627e\u65b0\u7684\u5339\u914d\uff0c\u5373\u53ef\u3002\n\n\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $O(n \\log n)$\n\n\u63a5\u4e0b\u6765\u7684\u5de5\u4f5c\u5c31\u662f\u628a\u53cc\u5411\u5339\u914d\u653e\u8fdb\u4e00\u4e2a\u5806\u91cc\uff0c\u6bcf\u6b21\u628a\u6240\u6709\u65f6\u95f4\u6700\u77ed\u7684\u70b9\u62ff\u51fa\u6765\u5220\u9664\u5c31\u884c\u3002\n\n### \u4e00\u4e9b\u7ec6\u8282\n\n1. \u5173\u4e8e\u6a2a\u7ad6\u76f4\u7ebf\uff0c\u8ddd\u79bb\u4e3a\u5947\u6570\u70b9\u7684\u76f8\u649e\u65f6\u95f4\u95ee\u9898\u3002\u6bd4\u5982\u76f8\u90bb\u7684\u4e24\u4e2a \u2192 \u2190\uff0c\u5982\u679c\u53f3\u7bad\u5934\u4e0a\u65b9\u6709\u4e00\u4e2a\u4e0b\u7bad\u5934\uff08\u5982\u9898\u9762\u53f3\u4e0b\u89d2\u7684\u56fe\uff09\uff0c\u90a3\u4e2a\u7bad\u5934\u4e0d\u4f1a\u76f8\u649e\uff0c\u8bf4\u660e\u76f8\u649e\u65f6\u95f4 $> 1$\uff0c\u4f46\u5982\u679c\u76f8\u649e\u65f6\u95f4\u53c8\u5f97 $ < 2$\uff0c\u5426\u5219\u4f1a\u548c\u5de6\u7bad\u5934\u76f8\u649e\uff0c\u56e0\u6b64\u8fd9\u79cd\u7684\u76f8\u649e\u65f6\u95f4\u5e94\u8be5\u662f $1.5$\u3002\u6211\u662f\u628a\u65f6\u95f4\u6574\u4f53 $\\times 2$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u6ca1\u6709\u5c0f\u6570\u3002\n2. \u4e00\u5b9a\u8981\u6bcf\u6b21\u628a\u6240\u6709\u540c\u4e00\u65f6\u95f4\u7684\u70b9\u4e00\u5757\u5220\u9664\uff0c\u4e0d\u7136\u53ef\u80fd\u4f1a\u5b58\u5728\u540c\u4e00\u65f6\u95f4\uff0c\u4f46\u540e\u8005\u8ba4\u4e3a\u524d\u8005\u5df2\u7ecf\u6d88\u5931\u7684\u6050\u6016\u65b9\u6cd5\u3002\n\n### \u65f6\u95f4\u590d\u6742\u5ea6\n\n$O(n \\log n)$\n\n### Code\n\n\u611f\u89c9\u81ea\u5df1\u786e\u5b9e\u5199\u7684\u5f88\u9ebb\u70e6\uff0c\u5176\u5b9e\u72ec\u81ea\u5f00\u4e2a\u7ed3\u6784\u4f53\u7ef4\u62a4\u90a3\u4e2a\u6570\u8f74\u53ef\u80fd\u4f1a\u66f4\u7b80\u5355\u4e00\u70b9\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <set>\n#include <cstring>\n#include <algorithm>\n#include <queue>\n#include <vector>\nusing namespace std;\n\ntypedef long long LL;\n\nconst int N = 100005, INF = 2e9;\n\nint W, H, n, X[N], Y[N], D[N], L[N][4], f[N], m, a[N << 1], len, d[4][N], tot[4];\nint nxt[4][4], pre[4][4], match[N][4], val[N][4], stk[N], top;\nLL ans;\nbool st[N], re[N];\n\nstruct O {\n\tint v, x, y;\n\tbool operator < (const O &b) const { return v > b.v; }\n};\n\nstruct Node{\n\tint x, id;\n\tbool operator < (const Node &b) const { return x < b.x; }\n};\n\ntypedef set<Node>::iterator SIT;\n\nset<Node> s[4][N][4];\n// \u7b2c\u4e00\u7ef4\uff1a\u6a2a / \u7ad6 / \u5de6\u4e0b - \u53f3\u4e0a / \u5de6\u4e0a / \u53f3\u4e0b; \u7b2c\u4e8c\u7ef4\uff1a\u79bb\u6563\u540e\u7ebf\u7f16\u53f7; \u7b2c\u4e09\u7ef4\uff1a\u5b58\u50a8\u7684\u65b9\u5411\u503c\npriority_queue<O> q;\n\nint inline get(int x, int o) { return lower_bound(d[o] + 1, d[o] + 1 + tot[o], x) - d[o]; }\n\nvoid inline find(int c, int i) {\n\tmatch[i][c] = 0;\n\tint x = L[i][c], k = c == 0 ? Y[i] : X[i];\n\tif (nxt[c][D[i]] != -1) {\n\t\tint cq = nxt[c][D[i]];\n\t\tSIT it = s[c][x][cq].lower_bound( (Node) { k, 0 } );\n\t\tif (it != s[c][x][cq].end()) {\n\t\t\tint j = it -> id, w = (it -> x - k + 1) * 2;\n\t\t\tif (c < 2) w = w / 2 + 1; \n\t\t\tif (!match[j][c] || w < val[j][c]) {\n\t\t\t\tmatch[i][c] = j, match[j][c]  = i, val[i][c] = val[j][c] = w;\n\t\t\t\tq.push((O){ val[i][c], i, j });\n\t\t\t}\n\t\t}\n\t} \n\tif (pre[c][D[i]] != -1) {\n\t\tint cq = pre[c][D[i]];\n\t\tSIT it = s[c][x][cq].lower_bound( (Node) { k, 0 } );\n\t\tif (it != s[c][x][cq].begin()) {\n\t\t\t--it; int j = it -> id, w = (k - it -> x + 1) * 2;\n\t\t\tif (c < 2) w = w / 2 + 1; \n\t\t\tif (!match[j][c] || w < val[j][c]) {\n\t\t\t\tmatch[i][c] = j, match[j][c]  = i, val[i][c] = val[j][c] = w;\n\t\t\t\tq.push((O){ val[i][c], i, j });\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid inline insert(int c, int i) {\n\tint x = L[i][c], k = c == 0 ? Y[i] : X[i];\n\ts[c][x][D[i]].insert((Node) { k, i } );\n\tfind(c, i);\n}\n\nvoid inline init() {\n\tmemset(nxt, -1, sizeof nxt);\n\tmemset(pre, -1, sizeof pre);\n\tnxt[0][0] = 2, pre[0][2] = 0, nxt[1][3] = 1, pre[1][1] = 3;\n\tpre[2][0] = 3, nxt[2][3] = 0, pre[2][1] = 2, nxt[2][2] = 1;\n\tnxt[3][0] = 1, pre[3][1] = 0, nxt[3][3] = 2, pre[3][2] = 3;\n\tfor (int i = 1; i <= n; i++) {\n\t\td[0][++tot[0]] = X[i], d[1][++tot[1]] = Y[i];\n\t\td[2][++tot[2]] = X[i] + Y[i], d[3][++tot[3]] = X[i] - Y[i];\n\t}\n\tfor (int i = 0; i < 4; i++) {\n\t\tsort(d[i] + 1, d[i] + 1 + tot[i]);\n\t\ttot[i] = unique(d[i] + 1, d[i] + 1 + tot[i]) - d[i] - 1;\n\t}\n\tfor (int i = 1; i <= n; i++) {\n\t\tL[i][0] = get(X[i], 0), L[i][1] = get(Y[i], 1);\n\t\tL[i][2] = get(X[i] + Y[i], 2), L[i][3] = get(X[i] - Y[i], 3);\n\t\tfor (int j = 0; j < 4; j++) insert(j, i);\n\t}\n}\n\nvoid inline del(int i) {\n\tif (re[i]) return;\n\tre[i] = true;\n\tfor (int c = 0; c < 4; c++) {\n\t\tint x = L[i][c], k = c == 0 ? Y[i] : X[i];\n\t\ts[c][x][D[i]].erase((Node) { k, i } );\n\t\tif (match[i][c]) find(max(nxt[c][D[i]], pre[c][D[i]]), match[i][c]);\n\t}\n}\n\nvoid inline clear() { while (!q.empty() && (st[q.top().x] || st[q.top().y])) q.pop(); }\n\nvoid inline work() {\n\twhile (!q.empty()) {\n\t\tclear();\n\t\tif (q.empty()) break;\n\t\tint v = q.top().v;\n\t\twhile (1) {\n\t\t\tclear();\n\t\t\tif (q.empty() || q.top().v != v) break;\n\t\t\tO u = q.top(); \n\t\t\tf[u.x] = f[u.y] = v >> 1, del(u.x), del(u.y);\n\t\t\tstk[++top] = u.x, stk[++top] = u.y; q.pop();\n\t\t}\n\t\twhile (top) st[stk[top--]] = true;\n\t}\n}\n\nstruct E{\n\tint x, l, r, c;\n\tbool operator < (const E &b) const { return x < b.x; }\n} e[N << 1];\n\nvoid inline add(int x1, int y1, int x2, int y2) {\n\te[++m] = (E) { x1, y1, y2 + 1, 1 };\n\te[++m] = (E) { x2 + 1, y1, y2 + 1, -1 };\n\ta[++len] = y2 + 1, a[++len] = y1;\n}\n\nint inline getY(int y) {\n\treturn lower_bound(a + 1, a + 1 + len, y) - a;\n}\n\nstruct T{\n\tint len, cnt;\n} t[N * 8];\n\nvoid inline pushup(int p, int l, int r) {\n\tt[p].len = t[p].cnt ? a[r + 1] - a[l] : t[p << 1].len + t[p << 1 | 1].len;\n}\n\nvoid change(int p, int l, int r, int x, int y, int k) {\n\tif (x <= l && r <= y) {\n\t\tt[p].cnt += k;\n\t\tif (l == r) t[p].len = t[p].cnt ? a[r + 1] - a[r] : 0;\n\t\telse pushup(p, l, r); \n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tif (x <= mid) change(p << 1, l, mid, x, y, k);\n\tif (mid < y) change(p << 1 | 1, mid + 1, r, x, y, k);\n\tpushup(p, l, r);\n}\n\nvoid inline fill() {\n\tfor (int i = 1; i <= n; i++) {\n\t\tif (D[i] == 0) add(X[i], Y[i], X[i], Y[i] + f[i] - 1);\n\t\telse if (D[i] == 1)  add(X[i] - f[i] + 1, Y[i], X[i], Y[i]);\n\t\telse if (D[i] == 2) add(X[i], Y[i] - f[i] + 1, X[i], Y[i]);\n\t\telse add(X[i], Y[i], X[i] + f[i] - 1, Y[i]);\n\t}\n\tsort(e + 1, e + 1 + m);\n\tsort(a + 1, a + 1 + len);\n\tlen = unique(a + 1, a + 1 + len) - a - 1;\n\tfor (int i = 1; i <= m; i++) {\n\t\tchange(1, 1, len, getY(e[i].l), getY(e[i].r) - 1, e[i].c);\n\t\tif (i != m && e[i].x != e[i + 1].x)\n\t\t \tans += (e[i + 1].x - e[i].x) * (LL)t[1].len;\n\t}\n}\n\nint main() {\n\tscanf(\"%d%d%d\", &W, &H, &n);\n\tfor (int i = 1; i <= n; i++) {\n\t\tscanf(\"%d%d%d\", Y + i, X + i, D + i);\n\t\tif (D[i] == 0) f[i] = W - Y[i] + 1;\n\t\telse if (D[i] == 1) f[i] = X[i];\n\t\telse if (D[i] == 2) f[i] = Y[i];\n\t\telse f[i] = H - X[i] + 1;\n\t}\n\tinit(); \n\twork();\n\tfill();\n\tprintf(\"%lld\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1606038102,
        "uid": 161687,
        "name": "Remake",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3635 \u3010[APIO2012]\u82e6\u65e0 \u3011"
    },
    {
        "content": "~~\u8fd9\u79cd\u9898\u53e3\u80e1\u4e00\u4e0b\uff0c\u5e76\u4e14\u8c34\u8d23\u4e00\u4e0b\u51fa\u9898\u4eba\u5c31\u597d\u4e86\uff0c\u5343\u4e07\u522b\u50cf\u6211\u4e00\u6837\u5934\u94c1\u53bb\u51997\u4e2ak\u3002~~\n\n\u8fd9\u7bc7\u9898\u89e3\u5c31\u8bb2\u4e00\u4e0b\u5927\u81f4\u601d\u8def\uff0c\u5177\u4f53\u7ec6\u8282\u592a\u591a\uff0c\u5c31\u4e0d\u4e00\u4e00\u9610\u8ff0\u4e86\uff0c~~\u5e0c\u671b\u7ba1\u7406\u5458\u770b\u5728\u6ca1\u6709\u9898\u89e3\u7684\u4efd\u4e0a\u901a\u8fc7~~\u3002\n\n\u8003\u8651\u7b97\u51fa\u6bcf\u4e00\u4e2a\u82e6\u65e0\u7ecf\u8fc7\u7684\u683c\u5b50\uff0c\u6700\u540e\u77e9\u5f62\u9762\u79ef\u5e76\u3002\n\n\u53ea\u8981\u6c42\u51fa\u6bcf\u4e00\u4e2a\u82e6\u65e0\u548c\u54ea\u4e00\u4e2a\u82e6\u65e0\u76f8\u649e\uff0c\u5c31\u5bb9\u6613\u6c42\u51fa\u5b83\u7ecf\u8fc7\u7684\u683c\u5b50\u3002\n\n\u82e6\u65e0\u76f8\u649e\u65e0\u975e\u5c31\u516d\u79cd\u60c5\u51b5\uff0c\u5206\u65b9\u5411\u8ba8\u8bba\uff0c\u7136\u540e\u7ef4\u62a4\u6bcf\u4e00\u6761\u5e73\u884c\u4e8e\u5750\u6807\u8f74\u7684\u76f4\u7ebf\uff0c\u4ee5\u53ca\u4e0e\u5750\u6807\u8f74\u621045\u5ea6\u89d2\u7684\u76f4\u7ebf\uff08\u4e24\u4e2a\u82e6\u65e0\u4f1a\u76f8\u649e\u4ec5\u5f53\u5b83\u4eec\u521d\u59cb\u7684$x,y,x+y,x-y$\u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u76f8\u540c\uff09\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u6309\u7167\u76f4\u7ebf\u7684\u4f4d\u7f6e\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\uff0c\u5728\u76f4\u7ebf\u4e0a\u7684\u4f4d\u7f6e\u4e3a\u7b2c\u4e8c\u5173\u952e\u5b57\u5c06\u70b9\u6392\u5e8f\uff0c\u5efa\u7ebf\u6bb5\u6811\uff0c\u7ebf\u6bb5\u6811\u4e0a\u7ef4\u62a4\u533a\u95f4\u5185\u8ddd\u79bb\u6700\u8fd1\u7684\u4e00\u5bf9\u82e6\u65e0\uff0c\u4ee5\u53ca\u5411\u4e24\u4e2a\u65b9\u5411\u79fb\u52a8\u7684\u82e6\u65e0\u4e2d\u6700\u9760\u5de6/\u9760\u53f3\u7684\uff0c\u8fd9\u4e2a\u4fe1\u606f\u53ef\u4ee5\u5408\u5e76\u3002\n\n\u6bcf\u6b21\u53d6\u51fa\u6700\u65e9\u76f8\u649e\u7684\u82e6\u65e0\uff0c\u5e76\u5c06\u5b83\u4eec\u4ece\u7ebf\u6bb5\u6811\u4e2d\u5220\u9664\uff0c\u6ce8\u610f\u591a\u4e2a\u82e6\u65e0\u540c\u65f6\u76f8\u649e\u7684\u60c5\u51b5\u3002\n\n\u5bf9\u4e8e\u5220\u9664\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u7ebf\u6bb5\u6811\uff0c\u628a\u5bf9\u5e94\u8282\u70b9\u4fe1\u606f\u6e05\u7a7a\u5373\u53ef\u3002\n\n\u4ee3\u7801\u592a\u4e11\u5c31\u4e0d\u8d34\u4e86\uff0c\u9700\u8981\u7684\u79c1\u4fe1\u6211\u3002",
        "postTime": 1605873810,
        "uid": 60202,
        "name": "csyakuoi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3635 \u3010[APIO2012]\u82e6\u65e0 \u3011"
    },
    {
        "content": "\u9898\u610f\uff1a$W \\times H$ \u7684\u8868\u683c\u4e2d\uff0c\u6709 $n$ \u4e2a\u8d28\u70b9\u4ece\u67d0\u65b9\u683c\u4e2d\u5fc3\u540c\u65f6\u5f00\u59cb\u8fd0\u52a8\u3002\u6ca1\u6709\u4e24\u4e2a\u8d28\u70b9\u521d\u59cb\u65f6\u5728\u540c\u4e00\u65b9\u683c\u4e2d\u3002\u6240\u6709\u8d28\u70b9\u4ee5\u540c\u6837\u7684\u901f\u5ea6\u505a\u76f4\u7ebf\u8fd0\u52a8\uff0c\u65b9\u5411\u4e3a\u4e0a\u3001\u4e0b\u3001\u5de6\u3001\u53f3\u4e4b\u4e00\u3002\u5982\u679c\u4e24\u4e2a\u6216\u591a\u4e2a\u8d28\u70b9\u5728\u540c\u4e00\u65f6\u523b\u4f4d\u4e8e\u540c\u4e00\u4f4d\u7f6e\uff0c\u5219\u8fd9\u4e9b\u8d28\u70b9\u76f8\u649e\u5e76\u6d88\u5931\u3002\u6c42\u88ab\u8d28\u70b9\u7ecf\u8fc7\u7684\u683c\u5b50\u6570\u3002\n\n\u8fd9\u91cc\u6bcf\u4e2a\u8d28\u70b9\u7528\u4e09\u4e2a\u53c2\u6570 $x$\uff0c$y$\uff0c$d$ \u6765\u63cf\u8ff0\uff0c\u8868\u793a\u5176\u5f00\u59cb\u8fd0\u52a8\u7684\u4f4d\u7f6e\u662f\u4ece\u5de6\u5f80\u53f3\u7684 $x$ \u5217\u3001\u4ece\u4e0a\u5f80\u4e0b\u7684\u7b2c $y$ \u884c\u7684\u65b9\u683c\u7684\u4e2d\u5fc3\u3002\u8fd0\u52a8\u7684\u65b9\u5411\u7531 $d$ \u8868\u793a\uff0c\u5206\u522b\u4e3a\uff1a \n\n- $d = 0$\uff0c\u8868\u793a\u5411\u53f3\uff1b\n- $d = 1$\uff0c\u8868\u793a\u5411\u4e0a\uff1b\n- $d = 2$\uff0c\u8868\u793a\u5411\u5de6\uff1b\n- $d = 3$\uff0c\u8868\u793a\u5411\u4e0b\u3002\n\n$1 \\le n \\le 10^5$\uff0c$1 \\le w \\le 10^9$\uff0c$1 \\le h \\le 10^9$\uff1b$1 \\le x \\le W$\uff0c$1 \\le y \\le H$\uff0c$0 \\le d \\le 3$\u3002\n\n------------\n\n\u53ea\u7528\u6c42\u51fa\u6bcf\u4e2a\u8d28\u70b9\u7684\u8fd0\u52a8\u8def\u7a0b\uff0c\u7136\u540e\u770b\u4f5c\u5bbd\u4e3a $1$ \u7684\u77e9\u5f62\u505a\u626b\u63cf\u7ebf\u5373\u53ef\u3002\n\n\u6c42\u8fd0\u52a8\u8def\u7a0b\uff0c\u5c31\u53ea\u9700\u8981\u6c42\u76f8\u649e\u7684\u60c5\u51b5\u3002\u76f8\u649e\u8d28\u70b9\u7684\u65b9\u5411\u6709 $6$ \u79cd\u53ef\u80fd\uff0c\u5982\u540c\u4e00\u884c\uff0c\u5de6\u8fb9\u7684\u5411\u53f3\uff0c\u53f3\u8fb9\u7684\u5411\u5de6\uff1b\u518d\u5982\u540c\u4e00\u6761\u5de6\u4e0a\u2014\u53f3\u4e0b\u5bf9\u89d2\u7ebf\uff0c\u5de6\u8fb9\u7684\u5411\u4e0b\uff0c\u53f3\u8fb9\u7684\u5411\u5de6\uff1b\u7b49\u7b49\u3002\u5177\u4f53\u7684\u53ef\u4ee5\u770b\u4ee3\u7801\u3002\n\n\u5728\u6bcf\u4e00\u79cd\u53ef\u80fd\u4e2d\uff0c\u6700\u5148\u76f8\u649e\u7684\u4e00\u5b9a\u662f\u4e24\u4e2a\u76f8\u90bb\u7684\u70b9\u3002\u4e00\u65e6\u9047\u5230\u4e24\u4e2a\u76f8\u649e\uff0c\u5c31\u8981\u5220\u53bb\u8fd9\u4e24\u4e2a\u70b9\uff0c\u8003\u8651\u65b0\u4ea7\u751f\u7684\u76f8\u90bb\u5bf9\uff0c\u4e8e\u662f\u4f7f\u7528\u94fe\u8868\u3002\n\n\u6309\u7167 $6$ \u79cd\u60c5\u5f62\uff0c$4$ \u4e2a\u65b9\u5411\u6392\u5e8f\uff0c\u6392\u5e8f\u540e\u6784\u5efa\u94fe\u8868\u3002\u7136\u540e\u5c06\u6240\u6709\u76f8\u649e\u6309\u65f6\u95f4\u653e\u5165\u4e00\u4e2a\u5806\u4e2d\uff0c\u6bcf\u6b21\u53d6\u51fa\u67d0\u4e2a\u65f6\u523b\u6240\u6709\u7684\u76f8\u649e\uff0c\u5224\u65ad\u662f\u5426\u5b58\u5728\uff08\u53ef\u80fd\u5df2\u7ecf\u649e\u8fc7\uff09\u3002\u5982\u679c\u662f\u5b58\u5728\u7684\u76f8\u649e\uff0c\u5c31\u66f4\u65b0\u94fe\u8868\u548c\u5806\u3002\n\n\u7ec6\u8282\uff1a\n1. \u6392\u5e8f\u7684\u65f6\u5019\u8981\u5148\u6309\u7167\u65b9\u5411\u5206\u5f00\u3002\n2. \u53ef\u4ee5\u5047\u8bbe\u8d28\u70b9\u6bcf\u79d2\u8fd0\u52a8\u534a\u4e2a\u65b9\u683c\u8fb9\u957f\uff0c\u8fd9\u6837\u6240\u6709\u7684\u65f6\u95f4\u90fd\u662f\u6574\u6570\u3002\n\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=2e5+5,INF=1<<30;\nint n,W,H,X[N<<1];ll ans;\nstruct P{int no,x,y,d,nxt[6],lst[6],t,ex;}a[N];\nint fir[]={0,3,0,3,0,1},sec[]={2,1,1,2,3,2},dx[]={1,0,-1,0},dy[]={0,-1,0,1};\nbool cmp(P a,P b){return a.no<b.no;}\nbool cmp1(P a,P b){\n\tif((a.d==0||a.d==2)&&(b.d==1||b.d==3))return true;\n\tif((b.d==0||b.d==2)&&(a.d==1||a.d==3))return false;\n\treturn a.y!=b.y?a.y<b.y:a.x<b.x;\n}\nbool cmp2(P a,P b){\n\tif((a.d==1||a.d==3)&&(b.d==0||b.d==2))return true;\n\tif((b.d==1||b.d==3)&&(a.d==0||a.d==2))return false;\n\treturn a.x!=b.x?a.x<b.x:a.y<b.y;\n}\nbool cmp3(P a,P b){\n\tif((a.d==0||a.d==1)&&(b.d==2||b.d==3))return true;\n\tif((b.d==0||b.d==1)&&(a.d==2||a.d==3))return false;\n\treturn a.x-a.y!=b.x-b.y?a.x-a.y<b.x-b.y:a.x<b.x;\n}\nbool cmp4(P a,P b){\n\tif((a.d==0||a.d==3)&&(b.d==1||b.d==2))return true;\n\tif((b.d==0||b.d==3)&&(a.d==1||a.d==2))return false;\n\treturn a.x+a.y!=b.x+b.y?a.x+a.y<b.x+b.y:a.x<b.x;\n}\nstruct hit{int t,p,q;};\nbool operator <(const hit &a,const hit &b){return a.t>b.t;}\npriority_queue<hit> Q;\nstruct ScanLine{\n\tll l,r,h;int op;\n\tbool operator <(const ScanLine &b){\n\t\treturn h<b.h;\n\t}\n}line[N<<1];\nstruct SegmentTree{\n\tint ls[N<<3],rs[N<<3],sum[N<<3];ll len[N<<3];\n\t#define lc p<<1\n\t#define rc p<<1|1\n\tvoid push_up(int p){\n\t\tif(sum[p])len[p]=X[rs[p]+1]-X[ls[p]];\n\t\telse len[p]=len[lc]+len[rc];\n\t}\n\tvoid build(int p,int l,int r){\n\t\tls[p]=l;rs[p]=r;len[p]=sum[p]=0;\n\t\tif(l==r)return;\n\t\tbuild(lc,l,l+r>>1);\n\t\tbuild(rc,(l+r>>1)+1,r);\n\t}\n\tvoid modify(int p,int L,int R,int c){\n\t\tif(X[rs[p]+1]<=L||R<=X[ls[p]])return;\n\t\tif(L<=X[ls[p]]&&X[rs[p]+1]<=R){sum[p]+=c;push_up(p);return;}\n\t\tmodify(lc,L,R,c);modify(rc,L,R,c);\n\t\tpush_up(p);\n\t}\n}seg;\nint main(){\n\tscanf(\"%d%d%d\",&W,&H,&n);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%d%d%d\",&a[i].x,&a[i].y,&a[i].d);\n\t\ta[i].ex=1;a[i].no=i;\n\t\tfor(int k=0;k<6;k++)a[i].nxt[k]=a[i].lst[k]=-1;\n\t\tswitch(a[i].d){\n\t\t\tcase 0:a[i].t=2*(W-a[i].x);break;\n\t\t\tcase 1:a[i].t=2*(a[i].y-1);break;\n\t\t\tcase 2:a[i].t=2*(a[i].x-1);break;\n\t\t\tcase 3:a[i].t=2*(H-a[i].y);break;\n\t\t}\n\t}\n\ta[n+1].d=2;a[0].d=0;\n\tsort(a+1,a+n+1,cmp1);\n\tfor(int i=1;i<n;i++){\n\t\tif(a[i].d==1||a[i].d==3)break;\n\t\tif(a[i].y==a[i+1].y)a[i].nxt[0]=a[i+1].no,a[i+1].lst[0]=a[i].no;\n\t}\n\tsort(a+1,a+n+1,cmp2);\n\tfor(int i=1;i<n;i++){\n\t\tif(a[i].d==0||a[i].d==2)break;\n\t\tif(a[i].x==a[i+1].x)a[i].nxt[1]=a[i+1].no,a[i+1].lst[1]=a[i].no;\n\t}\n\tsort(a+1,a+n+1,cmp3);\n\tfor(int i=0,op=2;i<n;i++){\n\t\tif((a[i].d==0||a[i].d==1)&&(a[i+1].d==2||a[i+1].d==3)){op=3;continue;}\n\t\tif(i!=0&&a[i].x-a[i].y==a[i+1].x-a[i+1].y)\n\t\t\ta[i].nxt[op]=a[i+1].no,a[i+1].lst[op]=a[i].no;\n\t}\n\tsort(a+1,a+n+1,cmp4);\n\tfor(int i=0,op=4;i<n;i++){\n\t\tif((a[i].d==0||a[i].d==3)&&(a[i+1].d==1||a[i+1].d==2)){op=5;continue;}\n\t\tif(i!=0&&a[i].x+a[i].y==a[i+1].x+a[i+1].y)\n\t\t\ta[i].nxt[op]=a[i+1].no,a[i+1].lst[op]=a[i].no;\n\t}\n\tsort(a+1,a+n+1,cmp);\n\tfor(int k=0;k<6;k++)\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tif(a[i].nxt[k]!=-1&&a[i].d==fir[k]&&a[a[i].nxt[k]].d==sec[k])\n\t\t\t\tQ.push({abs(a[i].x-a[a[i].nxt[k]].x)+abs(a[i].y-a[a[i].nxt[k]].y),i,a[i].nxt[k]});\n\twhile(!Q.empty()){\n\t\tint t0=Q.top().t;\n\t\twhile(!Q.empty()&&Q.top().t==t0){\n\t\t\thit tmp=Q.top();int i=tmp.p,j=tmp.q;Q.pop();\n\t\t\tif(!a[i].ex&&a[i].t!=t0||!a[j].ex&&a[j].t!=t0)continue;\n\t\t\tif(a[i].ex){\n\t\t\t\tfor(int k=0;k<6;k++){\n\t\t\t\t\tint LS=a[i].lst[k],NX=a[i].nxt[k];\n\t\t\t\t\tif(LS!=-1)a[LS].nxt[k]=NX;\n\t\t\t\t\tif(NX!=-1)a[NX].lst[k]=LS;\n\t\t\t\t\tif(LS!=-1&&NX!=-1&&a[LS].d==fir[k]&&a[NX].d==sec[k])\n\t\t\t\t\t\tQ.push({abs(a[LS].x-a[NX].x)+abs(a[LS].y-a[NX].y),LS,NX});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(a[j].ex){\n\t\t\t\tfor(int k=0;k<6;k++){\n\t\t\t\t\tint LS=a[j].lst[k],NX=a[j].nxt[k];\n\t\t\t\t\tif(LS!=-1)a[LS].nxt[k]=NX;\n\t\t\t\t\tif(NX!=-1)a[NX].lst[k]=LS;\n\t\t\t\t\tif(LS!=-1&&NX!=-1&&a[LS].d==fir[k]&&a[NX].d==sec[k])\n\t\t\t\t\t\tQ.push({abs(a[LS].x-a[NX].x)+abs(a[LS].y-a[NX].y),LS,NX});\n\t\t\t\t}\n\t\t\t}\n\t\t\ta[i].t=a[j].t=t0;a[i].ex=a[j].ex=0;\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tint dist=a[i].t,X1,Y1,X2,Y2;\n\t\tif(dist%2==0)dist/=2;\n\t\tswitch(a[i].d){\n\t\t\tcase 0:{X1=a[i].x;X2=a[i].x+dist+1;Y1=a[i].y;Y2=a[i].y+1;break;}\n\t\t\tcase 1:{X1=a[i].x;X2=a[i].x+1;Y1=a[i].y-dist;Y2=a[i].y+1;break;}\n\t\t\tcase 2:{X1=a[i].x-dist;X2=a[i].x+1;Y1=a[i].y;Y2=a[i].y+1;break;}\n\t\t\tcase 3:{X1=a[i].x;X2=a[i].x+1;Y1=a[i].y;Y2=a[i].y+dist+1;break;}\n\t\t}\n\t\tX[2*i-1]=X1;X[2*i]=X2;\n\t\tline[2*i-1]={X1,X2,Y1,1};line[2*i]={X1,X2,Y2,-1};\n\t}\n\tsort(line+1,line+2*n+1);\n\tsort(X+1,X+2*n+1);\n\tint tot=unique(X+1,X+2*n+1)-X-1;\n\tseg.build(1,1,tot-1);\n\tfor(int i=1;i<2*n;i++){\n\t\tseg.modify(1,line[i].l,line[i].r,line[i].op);\n\t\tans+=seg.len[1]*(line[i+1].h-line[i].h);\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1680185991,
        "uid": 87504,
        "name": "by_chance",
        "ccfLevel": 7,
        "title": "P3635 [APIO2012] \u82e6\u65e0 \u9898\u89e3"
    }
]