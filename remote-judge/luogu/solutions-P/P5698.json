[
    {
        "content": "\u5728[\u6211\u7684\u535a\u5ba2](https://macesuted.github.io/blog/solution-P5698/)\u4e2d\u98df\u7528\u4f53\u9a8c\u66f4\u4f73\u3002\n\n[\u9898\u9762](https://www.luogu.com.cn/problem/P5698)\n\n# \u9898\u610f\n\n\u7ed9\u4f60\u4e00\u4efd\u4ee3\u7801\uff0c\u4ec5\u5305\u542b `loop` `op` `break` `continue` \u56db\u4e2a\u547d\u4ee4\uff0c\u5206\u522b\u8868\u793a\u5faa\u73af\u82e5\u5e72\u6b21\uff0c\u6267\u884c\u82e5\u5e72\u5355\u4f4d\u64cd\u4f5c\uff0c\u8df3\u51fa\u6b64\u5c42\u5faa\u73af\uff0c\u8df3\u8fc7\u6b64\u5c42\u5faa\u73af\u5269\u4f59\u90e8\u5206\u3002\u8981\u4f60\u7b97\u51fa\u6b64\u4ee3\u7801\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002\n\n# \u5206\u6790\n\n\u6211\u4eec\u53ef\u4ee5\u5bf9\u6bcf\u4e00\u4e2a `loop` \u548c `op` \u64cd\u4f5c\u5efa\u4e00\u4e2a\u70b9\uff0c\u70b9\u6743\u5373\u4e3a\u8be5\u64cd\u4f5c\u540e\u9762\u7684 `x` \u503c\uff0c\u518d\u6309\u7167\u4ed6\u4eec\u7684\u5305\u542b\u5173\u7cfb\u5efa\u4e00\u68f5\u6811\u3002\u5982\u679c\u9047\u5230 `break`\uff0c\u5c06\u6b64\u5c42 `loop` \u5bf9\u5e94\u7684\u70b9\u7684\u70b9\u6743\u8bbe\u7f6e\u4e3a $1$\uff0c\u518d\u7565\u8fc7\u6b64\u5c42\u5269\u4f59\u90e8\u5206\u7684\u4ee3\u7801\uff1b\u5982\u679c\u9047\u5230 `continue`\uff0c\u5c06\u6b64\u5c42\u5269\u4f59\u90e8\u5206\u7684\u4ee3\u7801\u7565\u8fc7\u5373\u53ef\u3002\n\n\u6ce8\u610f\u70b9\u4e0a\u8fd8\u6709\u4fdd\u5b58\u4e00\u4e2a\u6807\u8bb0\uff0c\u8868\u793a\u8be5\u70b9\u662f\u5426\u5b58\u5728\u5b9e\u9645\u8d21\u732e\uff08\u5c31\u662f\u8be5\u70b9\u5bf9\u5e94\u7684\u64cd\u4f5c\u662f\u4e0d\u662f `op`\uff09\uff0c\u56e0\u4e3a `loop` \u64cd\u4f5c\u672c\u8eab\u663e\u7136\u5e76\u4e0d\u5bf9\u7b54\u6848\u5b58\u5728\u8d21\u732e\u3002\n\n# \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <string>\n#include <vector>\n\nconst int maxDep = 25;\n\nclass Node {\n   public:\n    Node(Node* fa, int value, bool isLeaf) : father(fa), val(value), leaf(isLeaf) { return; }\n\n    int val;                  //\u6743\u503c\n    bool leaf;                //\u662f\u5426\u4e3a\u53f6\u5b50\uff08\u662f\u5426\u9700\u8981\u7b97\u5165\u590d\u6742\u5ea6\uff09\n    std::vector<Node> child;  //\u513f\u5b50\u8282\u70b9\n    Node* father;             //\u7236\u4eb2\u6307\u9488\n};\n\nint stringToInt(const std::string& str) {\n    int num = 0;\n    for (std::string::const_iterator i = str.begin(); i != str.end(); i++) num = (num << 3) + (num << 1) + (*i ^ 48);\n    return num;\n}\nvoid readUntilEnd(void) {\n    std::string str;\n    int cnt = 1;\n    while (cnt) {\n        std::cin >> str;\n        if (str == \"loop\") cnt++;\n        if (str == \"end\") cnt--;\n    }\n    return;\n}\n\nNode root(NULL, 0, false);  //\u6839\u8282\u70b9\nint answer[maxDep];\n\nvoid dfs(const Node& p, int x, int y) {\n    if (p.leaf) {\n        answer[x] += y;  //\u7edf\u8ba1\u7b54\u6848\n        return;\n    }\n    for (std::vector<Node>::const_iterator i = p.child.begin(); i != p.child.end(); i++)\n        (i->val == -1) ? dfs(*i, x + 1, y) : dfs(*i, x, y * i->val);  //\u6839\u636e\u6b64\u5b50\u8282\u70b9\u6743\u503c\u66f4\u6539\u53c2\u6570\n    return;\n}\n\nint main() {\n    std::string cmd;\n    Node* ptr = &root;\n    while (true) {\n        std::cin >> cmd;\n        if (cmd == \"op\") {\n            std::string x;\n            std::cin >> x;\n            ptr->child.push_back((Node){ptr, x == \"n\" ? -1 : stringToInt(x), true});\n        } else if (cmd == \"loop\") {\n            std::string x;\n            std::cin >> x;\n            if (x == \"0\") x = \"n\";  //\u6570\u636e\u95ee\u9898\uff0c\u8be6\u89c1https://www.luogu.com.cn/discuss/show/271086\n            ptr->child.push_back((Node){ptr, x == \"n\" ? -1 : stringToInt(x), false});\n            ptr = &ptr->child.back();\n        } else if (cmd == \"break\") {\n            if (ptr == &root) continue;\n            ptr->val = 1;  //\u7531\u4e8e\u5faa\u73af\u81f3\u6b64\u5fc5\u7136\u7ed3\u675f\uff0c\u5c31\u76f8\u5f53\u4e8e\u5faa\u73af\u53ea\u8fd0\u884c\u4e86\u4e00\u904d\n            ptr = ptr->father;\n            readUntilEnd();\n        } else if (cmd == \"continue\") {\n            if (ptr == &root) continue;\n            ptr = ptr->father;\n            readUntilEnd();  //\u4ece\u8fd9\u53e5\u8bdd\u5230\u7ed3\u5c3e\u7684\u6240\u6709\u8bdd\u90fd\u53ef\u4ee5\u65e0\u89c6\n        } else if (cmd == \"end\") {\n            if (ptr == &root) break;\n            ptr = ptr->father;\n        }\n    }\n    dfs(root, 0, 1);\n    bool first = true;\n    for (int i = maxDep - 1; ~i; i--)\n        if (answer[i]) {\n            if (!first) putchar('+');\n            first = false;\n            if (answer[i] != 1 || !i) printf(\"%d\", answer[i]);\n            if (i > 1)\n                printf(\"n^%d\", i);\n            else if (i == 1)\n                putchar('n');\n        }\n    if (first) putchar('0');\n    puts(\"\");\n    return 0;\n}\n```\n\n\n\n",
        "postTime": 1603940035,
        "uid": 98482,
        "name": "Macesuted",
        "ccfLevel": 0,
        "title": "P5698"
    },
    {
        "content": "## \u9898\u89e3\n\n\u672c\u9898\u7684\u5faa\u73af\u4ec5\u5b58\u5728\u6570\u5b57\u548c $n$ \u4e24\u79cd\u60c5\u51b5\uff0c\u5e76\u4e14**\u4e0d\u5b58\u5728\u5224\u65ad\u8bed\u53e5**\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5c06\u6574\u4e2a\u7a0b\u5e8f\u8f6c\u6362\u4e3a**\u4e00\u4e2a\u8868\u8fbe\u5f0f**\uff1a\n\n- \u5bf9\u4e8e $\\text{op}$ \u64cd\u4f5c\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u505a\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u653e\u7f6e\u4e86\u4e00\u4e2a\u6570\u5b57\uff08\u64cd\u4f5c\u6b21\u6570\uff09\u3002**\u540c\u65f6\u5728\u5b83\u524d\u9762\u52a0\u4e00\u4e2a\u52a0\u53f7**\u3002\n\n- \u5bf9\u4e8e $\\text{continue}$ \u548c $\\text{break}$ \u64cd\u4f5c\uff0c\u6bcf\u5f53\u6211\u4eec\u8bfb\u53d6\u5230\u5b83\u4eec\u65f6\uff0c\u5c31**\u5ffd\u7565**\u63a5\u4e0b\u6765\u7684\u6240\u6709\u8fd0\u7b97\uff0c\u76f4\u5230\u78b0\u5230\u5f53\u524d\u5faa\u73af\u7684 $\\text{end}$ \u8bed\u53e5\u3002\n\n- \u5bf9\u4e8e $\\text{loop}$ \u8bed\u53e5\uff08\u548c $\\text{begin}$ \u8bed\u53e5\uff09\uff0c\u6211\u4eec\u5728\u8be5\u51fa\u653e\u7f6e\u4e00\u4e2a\u5de6\u62ec\u53f7\uff0c**\u540c\u65f6\u5728\u5de6\u62ec\u53f7\u524d\u8fb9\u653e\u4e00\u4e2a\u52a0\u53f7\u3001\u540e\u8fb9\u653e\u4e00\u4e2a\u6570\u5b57** $\\bm 0$\u3002\u5982\u679c\u5bf9\u5e94\u7684\u5faa\u73af\u7ed3\u6784\u5185\u5b58\u5728 $\\text{break}$\uff0c\u90a3\u4e48\u5728\u5de6\u62ec\u53f7\u4e4b\u524d\u653e\u7f6e\u4e00\u4e2a\u6570\u5b57 $1$\uff1b\u5426\u5219\u653e\u7f6e $\\text{loop}$ \u8bed\u53e5\u6267\u884c\u7684\u6b21\u6570\uff08\u6570\u5b57\u6216\u8005 $n$\uff09\u3002\n\n- \u5bf9\u4e8e $\\text{end}$ \u8bed\u53e5\uff0c\u76f4\u63a5\u653e\u7f6e\u4e00\u4e2a\u53f3\u62ec\u53f7\uff0c\u5373\u53ef\u548c\u5bf9\u5e94 $\\text{loop}$ \u8bed\u53e5\u7684\u5de6\u62ec\u53f7\u5339\u914d\u3002\n\n\u7136\u540e\u2026\u2026\u5bf9\u5176\u4e2d\u7f00\u8868\u8fbe\u5f0f\u6c42\u503c\uff0c\u5c31\u505a\u5b8c\u4e86\u3002\u4ee5\u4e0b\u6211\u4eec\u4e3e\u4e2a\u4f8b\u5b50\uff08\u4f7f\u7528\u4e86\u6837\u4f8b\uff09\uff1a\n\n$$\n\\begin{gathered}\\boxed{\\begin{aligned}\n&\\verb!begin!\\cr\n&\\verb!  loop n!\\cr\n&\\verb!    loop 3!\\cr\n&\\verb!      loop n!\\cr\n&\\verb!        op 20!\\cr\n&\\verb!      end!\\cr\n&\\verb!    end!\\cr\n&\\verb!  end!\\cr\n&\\verb!  loop n!\\cr\n&\\verb!    op 3!\\cr\n&\\verb!    break!\\cr\n&\\verb!  end!\\cr\n&\\verb!  loop n!\\cr\n&\\verb!    loop n!\\cr\n&\\verb!      op 1!\\cr\n&\\verb!    break!\\cr\n&\\verb!    end!\\cr\n&\\verb!  end!\\cr\n&\\verb!end!\\cr\n\\end{aligned}} \\Rightarrow\n\\boxed{\\begin{aligned}\n&\\verb!begin!\\cr\n&\\verb!  loop n!\\cr\n&\\verb!    loop 3!\\cr\n&\\verb!      loop n!\\cr\n&\\verb!        op 20!\\cr\n&\\verb!      end!\\cr\n&\\verb!    end!\\cr\n&\\verb!  end!\\cr\n&\\verb!  loop 1!\\cr\n&\\verb!    op 3!\\cr\n&\\verb!!\\cr\n&\\verb!  end!\\cr\n&\\verb!  loop n!\\cr\n&\\verb!    loop 1!\\cr\n&\\verb!      op 1!\\cr\n&\\verb!!\\cr\n&\\verb!    end!\\cr\n&\\verb!  end!\\cr\n&\\verb!end!\\cr\n\\end{aligned}} \\Rightarrow\n\\boxed{\\begin{aligned}\n&\\verb!+(0!\\cr\n&\\verb!  +n(0!\\cr\n&\\verb!    +3(0!\\cr\n&\\verb!      +n(0!\\cr\n&\\verb!        +20!\\cr\n&\\verb!      )!\\cr\n&\\verb!    )!\\cr\n&\\verb!  )!\\cr\n&\\verb!  +1(0!\\cr\n&\\verb!    +3!\\cr\n&\\verb!!\\cr\n&\\verb!  )!\\cr\n&\\verb!  +n(0!\\cr\n&\\verb!    +1(0!\\cr\n&\\verb!      +1!\\cr\n&\\verb!!\\cr\n&\\verb!    )!\\cr\n&\\verb!  )!\\cr\n&\\verb!)!\\cr\n\\end{aligned}}\n\\end{gathered}\n$$\n\n\u63a5\u7740\u6211\u4eec\u53bb\u9664\u6240\u6709\u591a\u4f59\u7684\u7a7a\u683c\u548c\u6362\u884c\u7b26\u3002\u7ec8\u4e8e\uff0c\u6211\u4eec\u5f97\u5230\u4e86\uff1a\n\n$$+(0+n(0+3(0+n(0+20)))+1(0+3)+n(0+1(0+1)))$$\n\n\u8ba1\u7b97\u5b83\u7684\u503c\uff1a\n\n$$n(3\\times 20n)+1\\times 3+n\\times 1\\times 1=60n^2+n+3$$\n\n\u5177\u4f53\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u5c31\u76f4\u63a5\u4f7f\u7528\u4e24\u4e2a\u6808\u8fdb\u884c\u4e2d\u7f00\u8868\u8fbe\u5f0f\u6c42\u503c\u3002\uff08\u66f4\u8be6\u7ec6\u7684\u53ef\u4ee5\u770b[\u8fd9\u7bc7](https://www.luogu.com.cn/blog/over-knee-socks/solution-p2229)\uff09\u3002\u5176\u4e2d\u4e00\u4e2a\u6808\u7ef4\u62a4\u5904\u7406\u5230\u7684\u6570\u5b57\uff0c\u53e6\u5916\u4e00\u4e2a\u6808\u7ef4\u62a4\u5904\u7406\u5230\u7684\u8fd0\u7b97\u7b26\u3002\u6570\u5b57\u5165\u6570\u5b57\u6808\uff1b\u6bcf\u5f53\u78b0\u5230\u8fd0\u7b97\u7b26\u65f6\uff0c\u4e0d\u65ad\u53d6\u51fa\u8fd0\u7b97\u7b26\u6808\u7684\u6808\u9876\uff0c\u82e5\u4f18\u5148\u7ea7\u4e0d\u5c0f\u4e8e\u5f53\u524d\u7684\u8fd0\u7b97\u7b26\uff0c\u5219\u4e0d\u65ad\u53d6\u51fa\u6570\u5b57\u6808\u6808\u9876\u7684\u4e24\u4e2a\u6570\u5b57\uff0c\u8fd0\u7b97\u540e\u518d\u63a8\u5165\u6570\u5b57\u6808\uff0c\u6700\u540e\u518d\u5c06\u8be5\u8fd0\u7b97\u7b26\u5165\u6808\uff1b\u5bf9\u4e8e\u5de6\u62ec\u53f7\u76f4\u63a5\u5165\u6808\uff0c\u78b0\u5230\u53f3\u62ec\u53f7\u5219\u4e0d\u65ad\u53d6\u8fd0\u7b97\u7b26\u6808\u6808\u9876\u8fdb\u884c\u8fd0\u7b97\uff0c\u77e5\u9053\u78b0\u5230\u5bf9\u5e94\u7684\u5de6\u62ec\u53f7\u3002\n\n## \u53c2\u8003\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define up(l,r,i) for(int i=l,END##i=r;i<=END##i;++i)\n#define dn(r,l,i) for(int i=r,END##i=l;i>=END##i;--i)\nusing namespace std;\ntypedef long long i64;\nconst int INF =2147483647;\nstruct Node{\n    vector<i64> A; Node(){} Node(vector <i64> _A){A=_A;}\n    Node operator +(const Node &t){\n        Node r; r.A.resize(max(A.size(),t.A.size()));\n        for(int i=0;i<r.A.size();++i)\n            r.A[i]+=(i<A.size()?A[i]:0)+(i<t.A.size()?t.A[i]:0); return r;\n    }\n    Node operator *(const Node &t){\n        Node r; r.A.resize(A.size()+t.A.size()-1);\n        for(int i=0;i<A.size();++i)\n            for(int j=0;j<t.A.size();++j)\n                r.A[i+j]+=A[i]*t.A[j]; return r;\n    }\n    void wrt(){\n        bool h=true; dn((int)A.size()-1,0,i) if(A[i]){\n            if(!h) cout<<\"+\"; h=false;\n            if(A[i]!=1||i==0) cout<<A[i];\n            if(i==1) cout<<\"n\"    ; else\n            if(i!=0) cout<<\"n^\"<<i;\n        }\n        if(h) cout<<\"0\"; cout<<endl;\n    }\n};\nstring x,y; stack<int> T; stack<Node> S; int n,f,g;\nint main(){\n    ios_base::sync_with_stdio(false); T.push(0);\n    do{\n        cin>>x;\n        if(x==\"begin\"){\n            T.push(0); S.push(Node({1})),S.push(Node({0}));\n        } else\n        if(x==\"end\"){\n            if(g>1){--g;continue;}\n            while(T.top()!=0){\n                Node a=S.top(); S.pop();\n                Node b=S.top(); S.pop();\n                S.push(a+b),T.pop();\n            }\n            Node a=S.top(); S.pop();\n            Node b=S.top(); S.pop();\n            if(f==2) S.push(a); else S.push(a*b);T.pop(),f=0,--n;\n        } else if(x==\"loop\"){\n            if(f) {++g;continue;}\n            cin>>y; T.push(1),T.push(0),++n;\n            if(y==\"n\"||y==\"0\") S.push(Node({0,1}));\n            else               S.push(Node({atoi(y.c_str())}));\n            S.push(Node({0}));\n        } else if(!f&&x==\"op\"){\n            cin>>y; T.push(1);\n            if(y==\"n\"||y==\"0\") S.push(Node({0,1}));\n            else               S.push(Node({atoi(y.c_str())}));\n        }\n        else if(!f&&x==\"continue\"&&n!=0) f=1,g=1;\n        else if(!f&&x==\"break\"   &&n!=0) f=2,g=1;\n    }while(T.size()>1);\n    S.top().wrt();\n    return 0;\n}\n```",
        "postTime": 1630202486,
        "uid": 330759,
        "name": "\u56e7\u4ed9",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5698 \u3010[CTSC1998]\u7b97\u6cd5\u590d\u6742\u5ea6\u3011"
    },
    {
        "content": "### \u9898\u76ee\u5927\u610f\n\n\u7ed9\u4f60\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u8ba9\u4f60\u7b97\u51fa\u7a0b\u5e8f\u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u8fd8\u8981\u8ba1\u7b97\u5e38\u6570\u3002\n\n### \u9898\u76ee\u601d\u8def\n\n\u8fd9\u9053\u9898\u53ef\u4ee5\u5f53\u505a\u4e00\u4e2a\u9012\u5f52\u7a0b\u5e8f\u3002\n\n\u56e0\u4e3a\u5728\u4e00\u4e2a ```loop``` \u5f53\u4e2d\uff0c\u5b83\u7684\u7b97\u6cd5\u590d\u6742\u5ea6\u9012\u5f52\u4e86\u4e0b\u53bb\uff0c\u63a5\u7740\u53c8\u56de\u6eaf\u56de\u6765\u4e86\u3002\n\n\u62ff\u6837\u4f8b\u505a\u89e3\u91ca\uff1a\n\n```\nbegin loop n loop 3 loop n\nop 20\nend end end\nloop n op 3 break end\nloop n loop n\nop 1\nbreak\nend end\nend\n```\n\n\u5982\u56fe\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/3xtizvdk.png)\n\n\u8fd9\u6837\u9012\u5f52\u4e0b\u53bb\uff0c\u6bcf\u6b21\u4f20\u4e0a\u6765\u4e00\u4e2a\u6267\u884c\u5b8c\u5faa\u73af\u5185\u5bb9\u7684\u4e00\u4e2a\u590d\u6742\u5ea6\u3002\n\n\u6bcf\u6b21\u9047\u5230 `break` \u5c31\u5c06\u8fd9\u6b21\u5faa\u73af\u53ea\u6267\u884c\u4e00\u6b21.\n\n\u6bcf\u6b21\u9047\u5230 `continue` \u5c31\u53ea\u6267\u884c `continue` \u4e4b\u524d\u7684\u64cd\u4f5c\u3002\n\n### \u4ee3\u7801\u5b9e\u73b0\n\n\u6211\u4eec\u7528\u4e00\u4e2a $p$ \u6570\u7ec4\u6765\u5b58\u8fd9\u4e00\u5c42\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002\n\n\u5176\u4e2d $p_i$ \u8868\u793a\u6709\u51e0\u500d\u7684 $n^i$\u3002\n\n\u63a5\u7740\u6211\u4eec\u7528\u4e00\u4e2a\u6808\u6765\u8868\u793a\u8fd9\u4e00\u5c42\u7684\u4fe1\u606f\u3002\n\n\u7528\u4e00\u4e2a $ts$ \u53d8\u91cf\u6765\u50a8\u5b58\u8fd9\u4e00\u5c42\u662f\u5426\u6709 `break`\u3002\n\n\u9047\u5230 `break` \u6216 `continue`\uff0c\u90a3\u4e48\u5c31\u4e00\u76f4\u8bfb\u5230\u5173\u4e8e\u8fd9\u4e00\u5c42\u7684 `end`\u3002\n\n[\u4ee3\u7801](https://www.luogu.com.cn/paste/1uk93ibx)",
        "postTime": 1633439600,
        "uid": 377787,
        "name": "Hooch",
        "ccfLevel": 6,
        "title": "P5698"
    },
    {
        "content": "# \u9898\u610f\u7b80\u8ff0\n------------\n\u7ed9\u4e00\u6bb5\u5305\u542b ```loop x end``` ```op x``` ```break``` ```continue``` \u56db\u79cd\u8bed\u53e5\u7684\u4ee3\u7801\uff0c\u8ba1\u7b97\u51fa\u5176\u7cbe\u786e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff08\u5373\u5e38\u6570\u9879\u548c\u7cfb\u6570\u4e0d\u5ffd\u7565\uff09\u3002\n  \n\u5176\u4e2d\u5faa\u73af\u8bed\u53e5 ```loop x end``` \u76f8\u5f53\u4e8e\u5faa\u73af ```x``` \u6b21\uff0c\u6267\u884c\u8bed\u53e5 ```op``` \u4e3a\u6267\u884c ```x``` \u6b21\u64cd\u4f5c\uff0c ```break``` \u4e3a\u8df3\u51fa\u5f53\u524d\u5faa\u73af\uff0c```continue``` \u4e3a\u8df3\u8fc7\u5faa\u73af\u4e2d\u5269\u4f59\u8bed\u53e5\uff0c ```x``` \u4e3a\u6b63\u6574\u6570\u6216 n\u3002\u5faa\u73af\u8bed\u53e5\u53ef\u4ee5\u5d4c\u5957\u3002\n\n# \u9898\u76ee\u5206\u6790\u53ca\u5b9e\u73b0\n------------\n\u6839\u636e\u9898\u76ee\u7684\u6570\u636e\u8303\u56f4\u548c\u5faa\u73af\u7ed3\u6784\u5d4c\u5957\u7684\u7279\u70b9\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e24\u4e2a\u6808\u6765\u5904\u7406\u95ee\u9898\u3002\n\n## \u8bfb\u5165\n\n\u901a\u8fc7\u51fd\u6570 ```read()``` \u5c31\u53ef\u4ee5\u628a\u9898\u76ee\u4e2d\u7684\u6240\u6709\u8bed\u53e5\u8f6c\u5316\u4e3a\u4e00\u4e2a\u6574\u578b\uff0c\u65b9\u4fbf\u5904\u7406\u3002\n\n#### \u53c2\u8003\u4ee3\u7801\uff1a\n```cpp\nint read()  \n{\n\tchar c;\n\twhile ((c>'z'||c<'a')&&(c<'0'||c>'9'))\n\t  c=getchar();\n      \n\tint k;\n\tif ((c>='a')&&(c<='z'))\n\t{\n      if (c=='b') //begin,break\u8fd4\u56de\u503c\n        k=-2;\n      if (c=='l') //loop\u8fd4\u56de\u503c\n        k=-3;\n      if (c=='n') //n\u8fd4\u56de\u503c\n        k=-4;\n      if (c=='c') //continue\u8fd4\u56de\u503c\n        k=-5;\n      if (c=='e') //end\u8fd4\u56de\u503c\n        k=-6;\n      if (c=='o') //op\u8fd4\u56de\u503c  \n        k=-7;\n\t  while ((c>='a')&&(c<='z'))\n\t    c=getchar();\n\t  return k;\n    }\n\n\tk=0;\n\twhile ((c>='0')&&(c<='9')) //\u6b63\u6574\u6570\u5c31\u8fd4\u56de\u6b63\u6574\u6570\u503c\n\t{\n\t\tk=k*10+c-'0';\n\t\tc=getchar();\n\t}\n\tif (k==0)//\u4fee\u6b63\u9519\u8bef\uff0c\u89c1https://www.luogu.com.cn/discuss/show/271086\n\t  k=-4;\n \n\treturn k;\n}\n```\n\n\n## \u5b9a\u4e49\u53d8\u91cf\u4ee5\u53ca\u9700\u8981\u4f7f\u7528\u7684\u51fd\u6570\n \n\u5bf9\u4e8e\u50a8\u5b58\u64cd\u4f5c\u6570\u7684\u6570\u7ec4 ```a[]``` \uff0c ```a[0]``` \u4ee3\u8868\u65f6\u95f4\u590d\u6742\u5ea6\u591a\u9879\u5f0f\u6b21\u6570\u52a0 1\uff0c\u800c ```a[i]``` \uff08i>1\uff09 \u4ee3\u8868\u591a\u9879\u5f0f\u7684 i-1 \u6b21\u9879\u7684\u7cfb\u6570\u3002\n\n\u6bcf\u4e2a\u6808\u6570\u7ec4\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u4ee3\u8868\u6808\u4e2d\u5143\u7d20\u4e2a\u6570\n\n#### \u53c2\u8003\u4ee3\u7801\uff1a\n\n```cpp\nint h,fl=1,css,r34;\nint zhanx[50]; //\u50a8\u5b58loop x\u4e2dx\u7684\u6808 \nint now[50]; //\u50a8\u5b58\u5f53\u524d\u5faa\u73af\u72b6\u6001\u64cd\u4f5c\u6570 \nint re[50]; //\u7528\u4e8e\u4e58\u6cd5\u64cd\u4f5c\u7684\u4e00\u4e2a\u6570\u7ec4 \nint ans[50]; //\u50a8\u5b58\u6700\u7ec8\u7b54\u6848 \nint zhan[50][50]; //zhan[i][j] \u50a8\u5b58\u5728\u7b2ci-1\u5c42\u7684\u64cd\u4f5c\u6570\u7684\u6808 \n\nvoid add() //\u5c06ans\u52a0\u4e0anow \n{\n    int g=now[0]>ans[0]?now[0]:ans[0];\n\tfor (int i=1; i<=g; i++)\n       ans[i]+=now[0]>=i?now[i]:0;\n    ans[0]=g;\n}\n\nvoid add(int as) //\u5c06now\u52a0\u4e0azhan[as]\n{\n    int g=now[0]>zhan[as][0]?now[0]:zhan[as][0];\n\tfor (int i=1; i<=g; i++)\n       now[i]+=zhan[as][0]>=i?zhan[as][i]:0;\n    now[0]=g;\n}\n\nvoid cun(int d) //\u5c06now\u6682\u65f6\u50a8\u5b58\u81f3zhan[d][]\n{\n   for (int i=0; i<=now[0]; i++)\n     zhan[d][i]=now[i];\n}\n\nvoid addx(int x) //\u5c06now\u52a0\u4e0ax (x\u7b49\u4e8e-4\u65f6\u89c6\u4e3an,\u4ee5\u4e0b\u540c\u7406) \n{\n\tif (x<0)\n\t  now[2]++;\n\telse\n\t  now[1]+=x;\n\tif (now[0]<2)\n\t  if (now[2]>0)\n\t     now[0]=2;\n\tif (now[0]<1)\n\t  if (now[1]>0)\n\t     now[0]=1;\t  \n}\n\nvoid times(int x) //\u5c06now\u4e58\u4e0ax \n{\n\tif (now[0]==0)\n\t  return;\t  \n\tif (x<0)\n\t{  \n\t    for (int i=1; i<=now[0]; i++)\n\t    {\n\t      re[i]=now[i];\n\t      now[i]=0;\n        }\n    \n\t    for (int i=1+1; i<=now[0]+1; i++)\n\t      now[i]=re[i-1];\n         now[0]+=1;\n    }\n    else\n    {\n    \tfor (int i=1; i<=now[0]; i++)\n    \t  now[i]*=x;\n\t}\n}\n\nvoid clera() //\u6e05\u7a7anow \n{\n\tfor (int i=1; i<=now[0]; i++)\n\t  now[i]=0;\n    now[0]=0;\n}\n\nvoid clera(int x) //\u6e05\u7a7azhan[x] \n{\n    for (int i=1; i<=zhan[x][0];i++)\n      zhan[x][i]=0;\n    zhan[x][0]=0;\n}\n```\n## \u6838\u5fc3\u4ee3\u7801\u5b9e\u73b0\n\u7a0b\u5e8f\u8bfb\u5165 ```begin``` \u540e\u8fd0\u884c\u8ba1\u7b97\u590d\u6742\u5ea6\u7684\u4ee3\u7801\uff0c\u76f4\u5230\u5faa\u73af\u5d4c\u5957\u6570\u4e3a 0 \u4e14\u8bfb\u5165\u5230 ```end``` \u65f6\u7ed3\u675f\uff0c\u5f00\u59cb\u8f93\u51fa\u3002\n\n#### \u5bf9\u4e8e ```break``` ```continue``` \u8bed\u53e5\uff1a\n1. \u5728\u5faa\u73af\u5d4c\u5957\u6570\u4e3a 0 \u65f6\u5ffd\u7565\uff1b\n1. \u5728\u5faa\u73af\u5d4c\u5957\u6570\u5927\u4e8e 0 \u65f6\u8981\u8fdb\u884c\u4e00\u4e2a\u6807\u8bb0\uff0c\u8df3\u8fc7\u5f53\u524d\u5faa\u73af\u5269\u4e0b\u7684\u6240\u6709\u8bed\u53e5\u3002\n\n#### \u5bf9\u4e8e ```loop x``` \u8bed\u53e5\uff1a\n1. \u5982\u679c\u5904\u4e8e\u88ab\u8df3\u8fc7\u72b6\u6001\uff0c\u4e0d\u6267\u884c\uff0c\u4f46\u8981\u6ce8\u610f\u5224\u65ad\u4e0e ```end``` \u7684\u5339\u914d\uff1b\n1. \u5c06 ```x``` \u538b\u5165\u6808 ```zhanx[]``` \u4e2d\uff1b\n1. \u5982\u679c\u5c06\u8981\u8fdb\u5165\u7b2c\u4e00\u5c42\u5faa\u73af\uff0c\u9700\u8981\u5c06 ```now``` \u52a0\u5230 ```ans``` \u4e2d\uff0c\u6e05\u7a7a ```now```\uff1b\n1. \u5982\u679c\u5c06\u8981\u8fdb\u5165\u7b2c d \u5c42\u7684\u5faa\u73af (d>1)\uff0c\u5219\u9700\u8981\u5c06 ```now``` \u6682\u65f6\u50a8\u5b58\u5728 ```zhan[d-1][]```\u4e2d\uff0c\u518d\u6e05\u7a7a ```now```\u3002\n\n#### \u5bf9\u4e8e ```op x``` \u8bed\u53e5\uff1a\n1. \u5982\u679c\u5904\u4e8e\u88ab\u8df3\u8fc7\u72b6\u6001\uff0c\u4e0d\u6267\u884c\uff1b\n1. \u5c06 ```now``` \u52a0\u4e0a ```x```\u3002\n\n#### \u5bf9\u4e8e ```end``` \u8bed\u53e5\uff1a\n1. \u5982\u679c\u5904\u4e8e\u88ab\u8df3\u8fc7\u72b6\u6001\uff0c\u4e0d\u6267\u884c\uff0c\u4f46\u8981\u6ce8\u610f\u5224\u65ad\u4e0e ```loop x``` \u7684\u5339\u914d\uff1b\n1. \u5c06\u6808 ```zhanx[]``` \u6808\u9876\u5143\u7d20\u53d6\u51fa\uff0c\u5c06 ```now``` \u4e58\u4e0a\u8be5\u5143\u7d20\uff0c\u4f46\u5bf9\u5904\u4e8e ```break``` \u72b6\u6001\u7684\u5faa\u73af\u4e0d\u6267\u884c\u4e58\u6cd5\u64cd\u4f5c\uff1b\n1. \u5982\u679c\u5c06\u8981\u9000\u51fa\u7b2c\u4e00\u5c42\u5faa\u73af\uff0c\u9700\u8981\u5c06 ```now``` \u52a0\u5230 ```ans``` \u4e2d\uff0c\u6e05\u7a7a ```now```\uff0c\u5c06 ```zhan[1][]``` \u9000\u6808\uff1b\n1. \u5982\u679c\u5c06\u8981\u9000\u51fa\u7b2c d \u5c42\u7684\u5faa\u73af (d>1)\uff0c\u5219\u9700\u8981\u5c06 ```now``` \u52a0\u4e0a ```zhan[d-1][]```\u4e2d\uff0c\u518d\u5c06 ```zhan[d][]``` \u9000\u6808\uff1b\n1. \u5bf9\u6700\u540e\u4e00\u4e2a ```end``` \u8981\u8bb0\u5f97\u5c06 ```now``` \u52a0\u5230 ```ans```\u3002\n\n#### \u53c2\u8003\u4ee3\u7801\uff1a\n```cpp\n    h=read();\t\t\n\tdo\n\t{\n       h=read(); \n\t   if ((h==-6)&&(zhanx[0]==0))\n\t     break;\n\t   \n\t   if ((h==-3)&&(fl>0)) //loop\n\t   {\n\t   \t  if (zhanx[0]==0) \n\t   \t  {\n\t\t\t  add();\n\t   \t      clera();\n\t      }\n          else\n          {\n            cun(zhanx[0]);\n            clera();\n          }\n\t      zhanx[0]++;\n\t\t  h=read();\n\t\t  zhanx[zhanx[0]]=h;\t \n\t\t  continue;\n\t   }\n\t   else\n\t     if ((fl<0)&&(h==-3))\n\t     { \n\t\t   h=read();\n\t       css++;\n\t       continue;\n\t     }\n\n\t   \n\t   if ((h==-5)&&(fl>0)&&(zhanx[0]>0)) //continue;\n\t   {\n\t     fl=-5;\n\t     continue;\n\t   }\n\t   \n\t   if ((h==-2)&&(fl>0)&&(zhanx[0]>0))//break;\n\t   {\n\t     fl=-2;\n\t     continue; \n\t   }\n\t     \n\t   if ((h==-7)&&(fl>0)) //op\n\t     {\n\t     \th=read();\t     \t\t    \n            addx(h);\n\t     \tcontinue;\n\t\t }\n\t   else\n\t     if ((h==-7)&&(fl<0))\n\t       {\n\t       \t  h=read();\n\t       \t  continue;\n\t\t   }\n\t   \t   \n\t   if ((h==-6)&&(fl>0)) //end;\n\t   {\n\t\t  r34=zhanx[zhanx[0]];\n\t\t  times(r34);\t\t \n          zhanx[0]--;   \n\t\t \t\t \n\t\t  if (zhanx[0]==0)\n\t\t  {\n\t\t \t add();\n\t\t     clera();\n             clera(1);\n\t      }\n          else\n          {\n             add(zhanx[0]);\n             clera(zhanx[0]+1);\n          }\n\t   }\n\t   else \n\t     if ((fl<0)&&(h==-6))\n\t     {\n\t     \tif (css==0)\n\t        {\n\t\t        r34=zhanx[zhanx[0]];    \n                if (fl==-5)\n                  times(r34);\t    \t\t       \t\t\t   \n\t\t\t    fl=1;\t \n\t            zhanx[0]--;\t\t\t\t\t\t\t    \n\t\t\t\tif (zhanx[0]==0)\n\t\t        {\n\t\t \t       add();\n\t\t           clera();\n                   clera(1);\n\t            }  \n                else\n                {\n                   add(zhanx[0]);\n                   clera(zhanx[0]+1);\n                }\n\t\t\t}\n\t\t\telse\n\t\t\t  css--;\n\t\t }\t\n\t\t \t\t \t\t    \n\t} while (1);\n\tadd();\n```\n## \u8f93\u51fa\n#### \u51e0\u4e2a\u6ce8\u610f\u70b9 \uff08~~\u5176\u5b9e\u5c31\u662f\u5e73\u65f6\u7684\u4e66\u5199\u4e60\u60ef~~\uff09\n\n- \u7cfb\u6570\u4e3a 0 \u7684\u9879\u4e0d\u8f93\u51fa\n- \u5bf9\u4e8e\u6b21\u6570\u5927\u4e8e 1 \u4e14\u7cfb\u6570\u4e3a 1 \u7684\u9879\uff0c\u4e0d\u8f93\u51fa\u7cfb\u6570\n- \u6b21\u6570\u4e3a 1 \u7684\u9879\u4e0d\u8f93\u51fa\u6b21\u6570\n- \u5e38\u6570\u9879\u76f4\u63a5\u8f93\u51fa\n\n#### \u53c2\u8003\u4ee3\u7801\uff1a\n\n```cpp\nvoid sss(int hh) //\u8f93\u51fan\u7684hh\u6b21\u9879\uff08\u65e0\u7cfb\u6570\uff09\n{\n\tif (hh==1)\n\t{\n\t  putchar('n');\n\t  return;\n    }\n\tif (hh>1)\n\t{\n\t\tputchar('n');\n\t\tputchar('^');\n\t\tcout<<hh;\n\t}\n } \n```\n\n```cpp\n\tint asd=0;\n\tfor (int i=1; i<=ans[0]; i++)\n\t  if (ans[i]>0)\n\t  {\n\t  \tasd=i;\n\t  \tbreak;\n\t  }\n\t  \n\tfor (int i=ans[0]; i>=asd; i--)\n\t  if (i>asd)\n\t  {\n\t  \tif (ans[i]>0)\n\t  \t{\n\t  \t  if (ans[i]>1)\t\n\t  \t    cout<<ans[i];\n\t  \t  sss(i-1);\n\t  \t  putchar('+');\n\t    }\n\t  }\n\t  else\n\t    {\n\t    \tif (ans[i]>1)\n\t    \t  cout<<ans[i];\n\t    \tif ((i==1)&&(ans[i]==1))\n\t    \t  cout<<ans[i];\n\t    \tsss(i-1);\n        }\n```\n\n# \u603b\u7ed3\n------------\n\u8c03\u5230\u534a\u591c\u4e00\u70b9\u591a\u6ca1\u8c03\u51fa\u6765\uff0c\u7b2c\u4e8c\u5929\u7269\u7406\u8bfe\u4e0a\u624d\u60f3\u51fabug\u6240\u5728\uff0c\u5c31\u9a6c\u4e0a\u4fee\u6539\u4ee3\u7801\uff0c\u7136\u540e\u8fc7\u4e86\u3002\n\n\u633a\u597d\u7684\u4e00\u9053\u6a21\u62df\u9898\uff0c\u6df1\u523b\u52a0\u6df1\u4e86\u6211\u5bf9\u6808\u7684\u7406\u89e3\u3002",
        "postTime": 1619009485,
        "uid": 85077,
        "name": "Diana773",
        "ccfLevel": 6,
        "title": "P5698 [CTSC1998]\u7b97\u6cd5\u590d\u6742\u5ea6"
    }
]