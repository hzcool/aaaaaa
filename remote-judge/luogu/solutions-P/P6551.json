[
    {
        "content": "# **\u3010\u9898\u89e3\u3011Crni [P6551] [SP7884]**\n\n[$\\mathcal{My}\\ \\mathcal{Blog}$](https://www.cnblogs.com/Xing-Ling/p/11637590.html)\n \n**\u4f20\u9001\u95e8\uff1a[$\\text{Crni [P6551]}$](https://www.luogu.com.cn/problem/P6551) [$\\text{[SP7884]}$](https://www.spoj.com/problems/C2CRNI/)** \n\n-------\n\n## **\u3010\u5206\u6790\u3011**\n\n\u8fd9\u662f\u4e00\u9053\u5957\u8def\u9898\uff0c\u7528\u5230\u4e86\u5f88\u591a\u5173\u4e8e\u77e9\u9635\u7684\u5904\u7406\u6280\u5de7\uff0c\u4f46\u627e\u5230\u89e3\u51b3\u65b9\u6cd5\u540e\u4f1a\u53d1\u73b0\u5b83\u7684\u601d\u7ef4\u96be\u5ea6\u5176\u5b9e\u5e76\u4e0d\u9ad8\uff0c\u4e3b\u8981\u662f\u4ee3\u7801\u5b9e\u73b0\u8f83\u56f0\u96be\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u89c6\u5176\u4e3a\u819c\u4f60\u9898\u3002\n\n### **\u3010\u524d\u7f00\u548c\u7684\u5957\u8def\u3011**\n\n\u627e\u5b50\u77e9\u9635\u57fa\u672c\u90fd\u4f1a\u7528\u5230\u524d\u7f00\u548c\uff0c\u5e38\u89c1\u7684\u67e5\u8be2\u5b50\u77e9\u9635\u53ef\u4ee5\u76f4\u63a5\u5bb9\u65a5\uff0c\u4f8b\u5982\u7ef4\u62a4**\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4**\u65f6\u7528\u5230\u7684\u65b9\u6cd5\uff1a\n\n\u8bbe $S[x][y]=\\sum_{i=1}^{x} \\sum_{j=1}^{y} a[i][j]$\uff0c\u90a3\u4e48\u9012\u63a8\u5f0f\u4e3a $S[i][j]=$ $S[i-1][j]+S[i][j-1]-S[i-1][j-1]+a[i][j]$\n\n\u5982\u679c\u8981\u67e5\u8be2\u4ee5 $(x1,y1)$ \u4e3a\u5de6\u4e0b\u89d2\uff0c\u4ee5 $(x2,y2)$ \u4e3a\u53f3\u4e0b\u89d2\u7684\u77e9\u9635\u548c\uff0c$\\sum_{i={x_1}}^{y_1} \\sum_{j={x_2}}^{y_2} a[i][j]=$ $S[x2][y2]-S[x1-1][y2]-S[x2][y1-1]+S[x1-1][y1-1]$\n\n\u5728\u9884\u5904\u7406\u5f0f\u5b50\u65f6\u9700\u8981\u4ece\u5de6\u4e0a\u89d2\u4e00\u76f4\u9012\u63a8\u5230\u53f3\u4e0b\u89d2\uff0c\u800c\u7a0d\u590d\u6742\u4e00\u70b9\u7684\u9700\u8981\u7edf\u8ba1\u591a\u4e2a\u65b9\u5411\uff08\u6ca1\u9519\uff0c\u5c31\u662f\u6b64\u9898\u4e86\uff09\uff0c\u5373\u4ece\u6700\u591a $4$ \u4e2a\u89d2\u843d\uff08\u5de6\u4e0a\uff0c\u5de6\u4e0b\uff0c\u53f3\u4e0a\uff0c\u53f3\u4e0b\uff09\u5f00\u59cb\u5411\u5176\u5bf9\u89d2\u5904\u9012\u63a8\uff0c\u5f97\u5230\u591a\u4e2a\u52a9\u4e8e\u7edf\u8ba1\u7b54\u6848\u7684\u524d\u7f00\u548c\u6570\u7ec4\u3002\n\n### **\u3010\u9884\u5904\u7406\u3011**\n\n\u56de\u5230\u6b64\u9898\u3002\n\n\u4e3a\u65b9\u4fbf\u5904\u7406\uff0c\u5c06\u77e9\u9635\u4e2d\u7684\u9ed1\u70b9\u8bbe\u4e3a $1$\uff0c\u767d\u70b9\u8bbe\u4e3a $0$ \u3002\n\n\u5bf9\u4e8e\u6240\u6709\u7684\u9ed1\u70b9\uff0c\u5148\u9884\u5904\u7406\u51fa $4$ \u4e2a\u6570\u7ec4\uff1a\n\n$(1).$ $RD[i][j]$\uff1a \u4ee5 $(i,j)$ \u4e3a**\u53f3\u4e0b\u89d2**\u7684**\u9ed1\u77e9\u9635**\u4e2a\u6570\u3002\n\n$(2).$ $LU[i][j]$\uff1a \u4ee5 $(i,j)$ \u4e3a**\u5de6\u4e0a\u89d2**\u7684**\u9ed1\u77e9\u9635**\u4e2a\u6570\u3002\n\n$(3).$ $LD[i][j]$\uff1a \u4ee5 $(i,j)$ \u4e3a**\u5de6\u4e0b\u89d2**\u7684**\u9ed1\u77e9\u9635**\u4e2a\u6570\u3002\n\n$(4).$ $RU[i][j]$\uff1a \u4ee5 $(i,j)$ \u4e3a**\u53f3\u4e0a\u89d2**\u7684**\u9ed1\u77e9\u9635**\u4e2a\u6570\u3002\n\n\u4f46\u5982\u679c\u66b4\u529b\u679a\u4e3e\u7684\u8bdd $O(n^4)$ \u590d\u6742\u5ea6\u8fc7\u9ad8\uff0c\u9700\u8981\u8003\u8651\u5408\u7406**\u7ee7\u627f**\u524d\u9762\u6c42\u51fa\u7684\u4fe1\u606f\u3002\n\n\u4ee5 $RD$ \u4e3a\u4f8b\uff0c\u4e3a\u4fbf\u4e8e\u63a8\u5bfc\uff0c\u6211\u4eec\u5148\u5728\u77e9\u9635\u4e2d\u679a\u4e3e\u4e00\u6761\u8f85\u52a9\u7ebf\uff0c\u5047\u8bbe\u5df2\u7ecf\u6c42\u51fa\u4e86\u7b2c $i$ \u884c\u524d $j-1$ \u5217\u7684 $RD$ \u4fe1\u606f\uff0c\u5982\u56fe\u4e3a $i=4,j=4$ \u7684\u60c5\u51b5\uff1a\n![](https://cdn.luogu.com.cn/upload/image_hosting/24n4h1nl.png)\n\n\u5b9a\u4e49 $H[i][j]$ \u4e3a\u70b9 $(i,j)$ \u5411\u4e0a\u6700\u591a\u53ef\u4ee5\u5ef6\u4f38\u7684\u8ddd\u79bb\uff08\u6216\u8005\u8bf4\u9ad8\u5ea6\uff09\uff0c\u5982\u679c $a(i,j)$ \u4e3a\u767d\u5757\uff0c$H[i][j]=0$ \u3002\n\n\u5904\u7406\u65b9\u6cd5\u5982\u4e0b\uff1a\n\n\u5bf9\u4e8e\u70b9 $(i,j)$ \u627e\u5230\u540c\u4e00\u5217\u524d\u9762\u7b2c\u4e00\u4e2a $H$ \u5c0f\u4e8e\u5b83\u7684\u4f4d\u7f6e $(i,k)$\u3002\n\n\u7531\u4e8e $[k+1,j]$ \u7684\u9ad8\u5ea6\u90fd\u5927\u4e8e $j$\uff0c\u90a3\u4e48\u5c06\u4f1a\u6709 $H[i][j]*(j-k)$ \u4e2a\u70b9\u53ef\u4ee5\u4f5c\u4e3a**\u9ed1\u77e9\u5f62**\u7684**\u5de6\u4e0a\u89d2**\uff08**\u53f3\u4e0b\u89d2**\u4e3a $(i,j)$\uff09\uff0c\u4f46\u662f\u5c06 $(i,j)$ \u81ea\u5df1\u4f5c\u4e3a**\u5de6\u4e0a\u89d2**\u65f6**\u9ed1\u77e9\u9635**\u5927\u5c0f\u53ea\u6709 $1$\uff0c\u6240\u4ee5\u8981\u51cf\u53bb $1$ \u3002\n\n\u53e6\u5916\u4ee5 $(i,k)$ \u4e3a**\u53f3\u4e0b\u89d2**\u7684**\u9ed1\u77e9\u9635**\u90fd\u53ef\u4ee5\u5c06\u957f\u5ea6\u6269\u5927 $j-k$\uff0c\u5373\u53d8\u6210\u4ee5 $(i,j)$ \u4e3a**\u53f3\u4e0b\u89d2**\uff0c\u4f46\u4ee5 $(i,k)$ \u4e3a**\u53f3\u4e0b\u89d2**\u7684\u60c5\u51b5\u6ca1\u6709\u8ba1\u7b97\u5728 $RD[i][k]$ \u4ee5\u5185\uff0c\u6240\u4ee5\u8981\u52a0\u4e0a $1$ \u3002\n\n\u5f97\u5230\u9012\u63a8\u5f0f\u4e3a\uff1a$RD[i][j]=H[i][j]*(j-k)-1+RD[i][k]+1$ \u3002\n\n\u4e8e\u662f\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u88ab\u4f18\u5316\u5230\u4e86 $O(n^3)$\uff0c\u4f46\u8fd8\u4e0d\u591f\u4f18\u79c0\u3002\n\n\u73b0\u5728\u7684\u95ee\u9898\u662f\u5982\u4f55\u5feb\u901f\u627e $k$\uff0c\u65b9\u6cd5\u540c [$\\text{Largest}$ $\\text{Rectangle}$ $\\text{in}$ $\\text{a}$ $\\text{Histogram}$](https://www.luogu.org/problem/SP1805) [\uff08\u9898\u89e3\uff09](https://www.cnblogs.com/Xing-Ling/p/10935693.html)\uff0c\u76f4\u63a5\u5355\u8c03\u6808\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u5728\u4e0a\u9762\u90a3\u5f20\u56fe\u4e2d $H[4][1]=1,H[4][2]=2,H[4][3]=4,H[4][4]=3$\uff0c\u6240\u4ee5 $j=4$ \u65f6\u7684\u51b3\u7b56\u70b9 $k=2$\uff0c\u56e0\u6b64 $RD[3][4]=3*2-1+RD[3][2]+1$ \u3002\n\n\u540c\u7406\u53ef\u5f97 $LU,LD,RU$ \u3002\n\n### **\u3010\u7edf\u8ba1\u7b54\u6848\u3011**\n\n\u4f9d\u65e7\u662f\u679a\u4e3e\u8f85\u52a9\u7ebf\uff1a  \n![](https://cdn.luogu.com.cn/upload/image_hosting/89a72vbb.png)\n\n\u5148\u6c42\u51fa**\u4e0b\u8fb9\u754c\u5728\u7ea2\u7ebf\u4e0a\u9762**\u7684**\u9ed1\u77e9\u5f62**\u4e2a\u6570\uff0c\u5373 $\\sum_{i=1}^{x} \\sum_{j=1}^{n} RD[i][j]$\uff08\u6216\u8005 $LD[i][j]$\uff09\uff0c\n\n\u518d\u6c42\u51fa**\u4e0a\u8fb9\u754c\u7d27\u8d34\u5728\u7ea2\u7ebf\u4e0b\u9762**\u7684**\u9ed1\u77e9\u9635**\u4e2a\u6570\uff0c\u5373 $\\sum_{j=1}^{n}LU[x+1][j]$\uff08\u6216\u8005 $RU[x+1][j]$\uff09\uff0c\n\n\u5c06\u4e8c\u8005\u76f8\u4e58\uff0c\u518d\u5bf9\u4e8e\u6bcf\u4e00\u6761\u8f85\u52a9\u7ebf\u7b97\u51fa\u7684\u7ed3\u679c\u6c42\u548c\uff0c\u5f97\u5230**\u76f8\u5bf9\u4f4d\u7f6e\u4e3a\u4e0a\u4e0b**\u7684**\u9ed1\u77e9\u5f62**\u603b\u5bf9\u6570\u3002\uff08\u5176\u5b9e\u4e5f\u53ef\u4ee5\u56fa\u5b9a\u7ea2\u7ebf\u4e0a\u9762\uff0c\u7ea2\u7ebf\u4e0b\u9762\u6c42\u603b\u4e2a\u6570\uff09\n\n\u540c\u7406\u679a\u4e3e**\u7ad6\u7ebf**\uff0c\u53ef\u5f97**\u76f8\u5bf9\u4f4d\u7f6e\u4e3a\u5de6\u53f3**\u7684**\u9ed1\u77e9\u5f62**\u603b\u5bf9\u6570\u3002\n\n\u4f46\u8fd9\u6837\u4f1a\u6709\u7b97\u91cd\u590d\u7684\u60c5\u51b5\uff0c\u5982\u4e0b\u56fe\u7eff\u8272\u90e8\u5206\u548c\u84dd\u8272\u90e8\u5206\uff1a  \n![](https://cdn.luogu.com.cn/upload/image_hosting/gz6se8m3.png)\n\n\u56e0\u6b64\u8fd8\u8981\u51cf\u53bb**\u76f8\u5bf9\u4f4d\u7f6e\u65e2\u6709\u4e0a\u4e0b\u53c8\u6709\u5de6\u53f3**\u7684**\u9ed1\u77e9\u5f62**\u5bf9\u6570\uff0c\u4e5f\u5c31\u662f\u5728\u5341\u5b57\u7ebf\u5bf9\u89d2\u8c61\u9650\u7684**\u9ed1\u77e9\u5f62**\u5bf9\u6570\uff0c\u6c42\u6cd5\u548c\u524d\u9762\u5927\u81f4\u76f8\u540c\u3002\u4e3a\u65b9\u4fbf\u5904\u7406\uff0c\u8981\u4efb\u9009\u4e24\u4e2a\u65b9\u5411\u8ba1\u7b97\u77e9\u9635\u524d\u7f00\u548c\uff08\u9012\u63a8\u5f0f\u548c\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u7684\u4e00\u6837\uff09\uff1a\n\n$(1).$ $S_{RD}[x][y]=\\sum_{i=1}^{x} \\sum_{j=1}^{y} RD[i][j]$  \n\u524d\u7f00\u548c\u9012\u63a8\u65b9\u5411\uff1a**\u5de6\u4e0a** \u2192 **\u53f3\u4e0b** \u3002  \n\u77e9\u9635\u524d\u7f00\u548c\u610f\u4e49\uff1a**\u53f3\u4e0b\u89d2**\u5728 $(i,j)$ **\u5de6\u4e0a\u9762**\u7684\u9ed1\u77e9\u9635\u4e2a\u6570\u3002\n\n$(2).$ $S_{LU}[x][y]=\\sum_{i=n}^{x} \\sum_{j=n}^{y} RD[i][j]$  \n\u524d\u7f00\u548c\u9012\u63a8\u65b9\u5411\uff1a**\u53f3\u4e0b** \u2192 **\u5de6\u4e0a** \u3002  \n\u77e9\u9635\u524d\u7f00\u548c\u610f\u4e49\uff1a**\u5de6\u4e0a\u89d2**\u5728 $(i,j)$ **\u53f3\u4e0b\u9762**\u7684\u9ed1\u77e9\u9635\u4e2a\u6570\u3002\n\n$(3).$ $S_{LD}[x][y]=\\sum_{i=1}^{x} \\sum_{j=n}^{y} RD[i][j]$  \n\u524d\u7f00\u548c\u9012\u63a8\u65b9\u5411\uff1a**\u53f3\u4e0a** \u2192 **\u5de6\u4e0b** \u3002  \n\u77e9\u9635\u524d\u7f00\u548c\u610f\u4e49\uff1a**\u5de6\u4e0b\u89d2**\u5728 $(i,j)$ **\u53f3\u4e0a\u9762**\u7684\u9ed1\u77e9\u9635\u4e2a\u6570\u3002\n\n$(4).$ $S_{RU}[x][y]=\\sum_{i=n}^{x} \\sum_{j=1}^{y} RD[i][j]$  \n\u524d\u7f00\u548c\u9012\u63a8\u65b9\u5411\uff1a**\u5de6\u4e0b** \u2192 **\u53f3\u4e0a** \u3002  \n\u77e9\u9635\u524d\u7f00\u548c\u610f\u4e49\uff1a**\u53f3\u4e0a\u89d2**\u5728 $(i,j)$ **\u5de6\u4e0b\u9762**\u7684\u9ed1\u77e9\u9635\u4e2a\u6570\u3002\n\n\u6700\u540e\uff0c\u6b64\u9898\u7ec6\u8282\u8f83\u591a\uff0c\u53d8\u91cf\u540d\u6ca1\u8bbe\u597d\u7684\u8bdd\u5f88\u5bb9\u6613\u641e\u6df7\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a\uff1a$O(n^2)$ \u3002\n\n-------\n\n## **\u3010Code\u3011**\n\n```cpp\n#include<algorithm>\n#include<iostream>\n#include<cstring>\n#include<cstdlib>\n#include<cstdio>\n#define Re register int\n#define For(i,a,b) for(Re i=a;i<=b;++i)\n#define Por(i,a,b) for(Re i=a;i>=b;--i)\n#define print() for(Re i=1;i<=n;puts(\"\"),++i)for(Re j=1;j<=n;++j)\nusing namespace std;\nconst int N=1003,P=10007;\nint n,Q[N],A[N][N],H[N][N],SS[N][N];char ch[N];\ninline void in(Re &x){\n    int f=0;x=0;char c=getchar();\n    while(c<'0'||c>'9')f|=c=='-',c=getchar();\n    while(c>='0'&&c<='9')x=(x<<1)+(x<<3)+(c^48),c=getchar();\n    x=f?-x:x;\n}\nint RD[N][N];\ninline void get_RD(){//RD[i][j]: \u4ee5i,j\u4e3a\u53f3\u4e0b\u89d2\u7684\u9ed1\u77e9\u5f62\u4e2a\u6570(1,1)\u2192(n,n) \n    memset(H,0,sizeof(H));\n    For(i,1,n)For(j,1,n)if(A[i][j])H[i][j]=H[i-1][j]+1;\n//  print()printf(\"%d \",H[i][j]);puts(\"\");\n    For(i,1,n){\n    \tRe h=1,t=0;\n    \tFor(j,1,n)if(!A[i][j])RD[i][j]=-1;\n    \tRD[i][Q[++t]=0]=-1;\n    \tFor(j,1,n){\n            while(h<=t&&H[i][Q[t]]>=H[i][j])--t;\n            if(h<=t&&A[i][j])RD[i][j]=RD[i][Q[t]]+1+H[i][j]*(j-Q[t])-1;\n            Q[++t]=j;\n    \t}\n    \tFor(j,1,n)if(RD[i][j]<0)RD[i][j]=0;\n    }\n//  print()printf(\"%d \",RD[i][j]);puts(\"\");\n}\nint LU[N][N];\ninline void get_LU(){//LU[i][j]: \u4ee5i,j\u4e3a\u5de6\u4e0a\u89d2\u7684\u9ed1\u77e9\u5f62\u4e2a\u6570(n,n)\u2192(1,1) \n    memset(H,0,sizeof(H));\n    Por(i,n,1)Por(j,n,1)if(A[i][j])H[i][j]=H[i+1][j]+1;\n//  print()printf(\"%d \",H[i][j]);puts(\"\");\n    Por(i,n,1){\n    \tRe h=1,t=0;\n    \tPor(j,n,1)if(!A[i][j])LU[i][j]=-1;\n    \tLU[i][Q[++t]=n+1]=-1;\n    \tPor(j,n,1){\n            while(h<=t&&H[i][Q[t]]>=H[i][j])--t;\n            if(h<=t&&A[i][j])LU[i][j]=LU[i][Q[t]]+1+H[i][j]*(Q[t]-j)-1;\n            Q[++t]=j;\n    \t}\n    \tPor(j,n,1)if(LU[i][j]<0)LU[i][j]=0;\n    }\n//  print()printf(\"%d \",LU[i][j]);puts(\"\");\n}\nint LD[N][N];\ninline void get_LD(){//LD[i][j]: \u4ee5i,j\u4e3a\u5de6\u4e0b\u89d2\u7684\u9ed1\u77e9\u5f62\u4e2a\u6570(1,n)\u2192(n,1)\n    memset(H,0,sizeof(H));\n    For(i,1,n)Por(j,n,1)if(A[i][j])H[i][j]=H[i-1][j]+1;\n//  print()printf(\"%d \",H[i][j]);puts(\"\");\n    For(i,1,n){\n    \tRe h=1,t=0;\n    \tPor(j,n,1)if(!A[i][j])LD[i][j]=-1;\n    \tLD[i][Q[++t]=n+1]=-1;\n    \tPor(j,n,1){\n            while(h<=t&&H[i][Q[t]]>=H[i][j])--t;\n            if(h<=t&&A[i][j])LD[i][j]=LD[i][Q[t]]+1+H[i][j]*(Q[t]-j)-1;\n            Q[++t]=j;\n    \t}\n    \tPor(j,n,1)if(LD[i][j]<0)LD[i][j]=0;\n    }\n//  print()printf(\"%d \",LD[i][j]);puts(\"\");\n}\nint RU[N][N];\ninline void get_RU(){//RU[i][j]: \u4ee5i,j\u4e3a\u53f3\u4e0a\u89d2\u7684\u9ed1\u77e9\u5f62\u4e2a\u6570(n,1)\u2192(1,n)\n    memset(H,0,sizeof(H));\n    Por(i,n,1)Por(j,n,1)if(A[i][j])H[i][j]=H[i+1][j]+1;\n//  print()printf(\"%d \",H[i][j]);puts(\"\");\n    Por(i,n,1){\n    \tRe h=1,t=0;\n    \tFor(j,1,n)if(!A[i][j])RU[i][j]=-1;\n    \tRU[i][Q[++t]=0]=-1;\n    \tFor(j,1,n){\n            while(h<=t&&H[i][Q[t]]>=H[i][j])--t;\n            if(h<=t&&A[i][j])RU[i][j]=RU[i][Q[t]]+1+H[i][j]*(j-Q[t])-1;\n            Q[++t]=j;\n    \t}\n    \tFor(j,1,n)if(RU[i][j]<0)RU[i][j]=0;\n    }\n//  print()printf(\"%d \",RU[i][j]);puts(\"\");\n}\ninline int U_D(){//\u52a0\u4e0a-\u4e0b \n    Re ans=0,S=0;\n    For(i,1,n){\n    \tFor(j,1,n)(ans+=S*LU[i][j]%P)%=P;//\u7528\u3010\u5de6\u4e0a\u89d2\u4e3a(i,j)\u7684\u77e9\u9635LU\u3011\u56fa\u5b9a\u5728\u8f85\u52a9\u7ebf\u4e0b\u9762\n    \tFor(j,1,n)(S+=RD[i][j])%=P;//\u7528\u3010\u53f3\u4e0b\u89d2\u4e3a(i,j)\u7684\u77e9\u9635RD\u3011\u6c42\u8f85\u52a9\u7ebf\u4e0a\u8fb9\u7684\u603b\u4e2a\u6570\n    }\n    return ans%P;\n}\ninline int L_R(){//\u52a0\u5de6-\u53f3 \n    Re ans=0,S=0;\n    For(j,1,n){\n    \tFor(i,1,n)(ans+=S*LU[i][j]%P)%=P;//\u7528\u3010\u5de6\u4e0a\u89d2\u4e3a(i,j)\u7684\u77e9\u9635LU\u3011\u56fa\u5b9a\u5728\u8f85\u52a9\u7ebf\u53f3\u8fb9\n    \tFor(i,1,n)(S+=RD[i][j])%=P;//\u7528\u3010\u53f3\u4e0b\u89d2\u4e3a(i,j)\u7684\u77e9\u9635RD\u3011\u6c42\u8f85\u52a9\u7ebf\u5de6\u8fb9\u7684\u603b\u4e2a\u6570\n    }\n    return ans%P;\n}\ninline int LU_RD(){//\u51cf\u5de6\u4e0a-\u53f3\u4e0b \n    Re ans=0;memset(SS,0,sizeof(SS));\n    For(i,1,n-1)For(j,1,n-1){\n    \tSS[i][j]=((RD[i][j]+SS[i-1][j]+SS[i][j-1])%P-SS[i-1][j-1]+P)%P;\n    \t//\u5341\u5b57\u7ebf\u5de6\u4e0a\u89d2\u7684\u7528\u3010\u53f3\u4e0b\u89d2\u4e3a(i,j)\u7684\u77e9\u9635RD\u3011\u6c42\u603b\u548c\n    \t(ans+=SS[i][j]*LU[i+1][j+1]%P)%=P;//\u7528\u3010\u5de6\u4e0a\u89d2\u4e3a(i,j)\u7684\u77e9\u9635LU\u3011\u56fa\u5b9a\u5341\u5b57\u7ebf\u7684\u53f3\u4e0b\u89d2\n    }\n    return ans;\n}\ninline int RU_LD(){//\u51cf\u53f3\u4e0a-\u5de6\u4e0b \n    Re ans=0;memset(SS,0,sizeof(SS));\n    For(i,1,n-1)Por(j,n,2){\n    \tSS[i][j]=((LD[i][j]+SS[i-1][j]+SS[i][j+1])%P-SS[i-1][j+1]+P)%P;\n    \t//\u5341\u5b57\u7ebf\u53f3\u4e0a\u89d2\u7684\u7528\u3010\u5de6\u4e0b\u89d2\u4e3a(i,j)\u7684\u77e9\u9635LD\u3011\u6c42\u603b\u548c\n    \t(ans+=SS[i][j]*RU[i+1][j-1]%P)%=P;//\u7528\u3010\u53f3\u4e0a\u89d2\u4e3a(i,j)\u7684\u77e9\u9635RU\u3011\u56fa\u5b9a\u5341\u5b57\u7ebf\u7684\u5de6\u4e0b\u89d2\n    }\n    return ans;\n}\nint main(){\n//  freopen(\"crni.in\",\"r\",stdin);\n//  freopen(\"crni.out\",\"w\",stdout);\n    in(n);\n    For(i,1,n){\n    \tscanf(\"%s\",ch+1);\n    \tFor(j,1,n)A[i][j]=(ch[j]=='C');\n    }\n    get_RD(),get_LU(),get_LD(),get_RU();\n    printf(\"%d\\n\",((U_D()+L_R())%P-(LU_RD()+RU_LD())%P+P)%P);\n//  fclose(stdin);\n//  fclose(stdout);\n    return 0;\n}\n```\n",
        "postTime": 1592190333,
        "uid": 110985,
        "name": "\u8fb0\u661f\u51cc",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6551 \u3010[COCI2010-2011#2] CRNI\u3011"
    },
    {
        "content": "\u6211\u4eec\u63a5\u4e0b\u6765\u770b\u4e00\u4e2a $2X3$ \u7684\u77e9\u9635\u65b9\u6848\u6570\u7684\u7edf\u8ba1\u539f\u7406,\u518d\u8fdb\u884c\u62d3\u5c55,\u5176\u4e2d $a,b,c,d,e,f$ \u5747\u4e3a\u9ed1\u8272\u5355\u5143\u683c .\n\n| $a$ | $b$ | $c$ |\n| :----------: | :----------: | :----------: |\n| $d$ | $e$ | $f$ |\n\n\u5bf9\u4e8e\u6b64\u65f6\u7b54\u6848\u4e3a$a(b+c+d+e+f)+b(c+d+e+f)+c(d+e+f)+d(e+f)+ef\u3002$\n\n\u6211\u4eec\u5bf9\u5f0f\u5b50\u53d8\u5f62\u5904\u7406\u4e3a\uff1a $(a+b+c)(d+e+f)+(a+d)(b+c+e+f) - a(e+f) - d(b+c) + (b+e)(c+f) - bf - ec$ \n\n\u7406\u89e3\u5373\u4e3a\u628a\u6bcf\u4e00\u884c\u7684\u6240\u6709\u65b9\u6848\u6570 $*$ \u4e0b\u9762\u4e00\u5757\u533a\u57df\u7684\u6240\u6709\u65b9\u6848\u6570+\u6bcf\u4e00\u5217 $*$ \u53f3\u8fb9\u533a\u57df\u7684\u6240\u6709\u65b9\u6848\u6570 $-$  \u5f53\u524d\u5de6\u4e0b\u89d2\uff08\u4e0b\u770b\uff09 $*$ \u53f3\u4e0a\u6240\u6709 $-$  \u5f53\u524d\u5de6\u4e0a\u89d2\uff08\u4e0a\u770b\uff09 $*$ \u53f3\u4e0b\u89d2\u6240\u6709\u3002\n\n$code$ :\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int MAX=1005,TT=10007;\nint n,MP[MAX][MAX],h[MAX],ans[MAX][MAX],ul[MAX][MAX],dl[MAX][MAX],UL[MAX][MAX],UR[MAX][MAX],DL[MAX][MAX],DR[MAX][MAX];\nchar S[MAX];\nvoid flip_LR(int mat[MAX][MAX]){\n\tfor (int i=1;i<=n;i++)\n    for (int a=1,b=n;a<b;a++,b--) swap(mat[i][a],mat[i][b]);\n}\nvoid flip_UD(int mat[MAX][MAX]){\n\tfor (int a=1,b=n;a<b;a++,b--)\n    for (int j=1;j<=n;j++) swap(mat[a][j],mat[b][j]);\n}\n\nvoid Copy(int a[MAX][MAX],int b[MAX][MAX]){\n\tfor (int i=1;i<=n;i++)\n    for (int j=1;j<=n;j++)\n      b[i][j]=a[i][j];\n}\nvoid RC(int mat[MAX][MAX]){\n\tfor (int i=1;i<=n;i++)\n    for (int j=1;j<=n;j++)\n      mat[i][j]=((mat[i][j]+mat[i-1][j]+mat[i][j-1]-mat[i-1][j-1])%TT+TT)%TT;\n}\n\nvoid solve(){\n\tmemset(h,0,sizeof h);\n    for (int i=1;i<=n;i++){\n    \tfor (int j=1;j<=n;j++)\n          if (MP[i][j]) h[j]++;else h[j]=0;\n        stack<int> stk;\n        stk.push(0);\n        int area=0;\n        for (int j=1;j<=n;j++){\n        \twhile (stk.top()&&h[stk.top()]>=h[j]){\n        \t\tint a=stk.top();stk.pop();\n                int b=stk.top();\n                area-=(j-b-1)*(h[a]-max(h[j],h[b]));\n            }\n            stk.push(j);\n            area+=h[j];\n            ans[i][j]=max(area-1,0)%TT;\n        }\n    }\n}\nint main(){\n\tfreopen(\"crni.in\",\"r\",stdin);\n\tfreopen(\"crni.out\",\"w\",stdout);\n    scanf(\"%d\",&n);\n    for (int i=1;i<=n;i++){\n    \tscanf(\"%s\",S+1);\n        for (int j=1;j<=n;j++) MP[i][j]=S[j]=='C';\n    }\n    solve(),Copy(ans,ul),Copy(ans,UL),RC(UL);\n    flip_LR(MP),solve(),Copy(ans,UR),RC(UR),flip_LR(UR),flip_LR(MP);\n    flip_UD(MP),solve(),Copy(ans,dl),Copy(ans,DL),RC(DL),flip_UD(dl),flip_UD(DL);\n    flip_LR(MP),solve(),Copy(ans,DR),RC(DR),flip_LR(DR),flip_UD(DR);\n    int Ans=0;\n    for (int i=1;i<=n;i++){\n    \tAns+=(DL[1][i]-DL[1][i-1]+TT)*DR[1][i+1];//\u5f53\u524d\u7b2ci\u5217*\u53f3\u4e0b\u4e00\u6574\u5757\u533a\u57df \n        Ans+=(UL[i][n]-UL[i-1][n]+TT)*DL[i+1][n];//\u5f53\u524d\u7b2ci\u884c*\u5de6\u4e0b\u4e00\u6574\u5757\u533a\u57df \n        Ans%=TT;\n        for (int j=1;j<=n;j++){\n        \tAns-=ul[i][j]*DR[i+1][j+1];//\u5de6\u4e0a\u5355\u70b9*\u53f3\u4e0b\u4e00\u6574\u5757\u533a\u57df \n            Ans-=dl[i][j]*UR[i-1][j+1];//\u5de6\u4e0b\u5355\u70b9*\u53f3\u4e0a\u4e00\u6574\u5757\u533a\u57df \n            Ans=(Ans%TT+TT)%TT;\n        }\n    }\n    printf(\"%d\\n\",Ans);\n    return 0;\n}\n```\n",
        "postTime": 1598177289,
        "uid": 370354,
        "name": "yxy666",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P6551 \u3010[COCI2010-2011#2] CRNI\u3011"
    }
]