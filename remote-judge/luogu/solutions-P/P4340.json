[
    {
        "content": "\u6ce8\u610f\u5230\u6709\u8d21\u732e\u7684\u4e00\u5b9a\u662f\u5f00\u59cb\u7684\u4e00\u6bb5\u4e58\u6cd5\u6bb5\uff0c\u56e0\u4e3a\u540e\u9762\u7684\u6bb5\u4e00\u5b9a\u53c8\u6709 + \u53c8\u6709 -\u3002\n\n\u8bbe $S_n=\\prod_{i=1}^na_i$\uff0c\u4e8e\u662f\u7b54\u6848\u5c31\u4e3a\n$$\\sum_{i=1}^{n-1}S_i\\times2\\times3^{n-i-1}+S_n$$\n\n\u7ec4\u5408\u610f\u4e49\u5373\u4e3a\u679a\u4e3e\u7b2c\u4e00\u4e2a\u8fde\u7eed\u7684\u4e58\u6cd5\u6bb5\u7684\u6700\u540e\u4e00\u4e2a\u6570\u5728\u54ea\u91cc\uff0c\u90a3\u4e48\u4e0b\u4e00\u4e2a\u4f4d\u7f6e\u5fc5\u987b\u586b `+` \u6216 `-`\uff0c\u5176\u4f59\u7684\u968f\u4fbf\u586b\u3002\n\n\u5bf9\u4e8e $a_i$ \u7684\u5355\u70b9\u4fee\u6539\uff0c\u6709\u4e00\u4e2a\u663e\u7136\u7684\u60f3\u6cd5\u662f\u5bf9\u4e8e $S_i$ \u7684\u4e00\u6bb5\u540e\u7f00\u505a\u4e58\u6cd5\uff0c\u4e8e\u662f\u7528\u7ebf\u6bb5\u6811\u533a\u95f4\u4e58\u6cd5\uff0c\u7ef4\u62a4\u533a\u95f4\u548c\u5373\u53ef\u3002\n\n\u4f46\u662f\u4ee5\u4e0a\u7684\u505a\u6cd5\u662f**\u9519\u8bef**\u7684\uff01\n\n\u7531\u4e8e $0$ \u4e0d\u5b58\u5728\u9006\u5143\uff0c\u800c\u9898\u76ee\u4e2d\u8bf4\u662f\u975e\u8d1f\u6574\u6570\u6ca1\u6709\u4fdd\u8bc1\u4e0d\u4e3a $0$\uff0c\u6240\u4ee5\u8be5\u505a\u6cd5\u53ef\u4ee5\u88ab\u4ee5\u4e0b\u6570\u636e\u8f7b\u677e\u5361\u6389\uff1a\n```\n1 1\n0\n1 1\n```\n\n\u4f46\u662f\u7531\u4e8e\u8be5\u9898\u6570\u636e\u6bd4\u8f83\u6c34\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u3002\n\n\u6b63\u786e\u7684\u7ef4\u62a4\u65b9\u6cd5\u5e94\u8be5\u662f\uff1a\u4ecd\u7136\u662f\u5355\u70b9\u4fee\u6539\uff0c\u5728\u5411\u4e0a\u56de\u6eaf\u7684\u8fc7\u7a0b\u4e2d\u7ef4\u62a4\u533a\u95f4\u79ef $\\rm mul$ \u548c\u7b54\u6848 $\\rm ans$\u3002\u5219\n$$\\begin{aligned}\\rm mul&=\\rm mul_{lc}\\cdot mul_{rc}\\\\\\rm ans&=\\rm ans_{lc}+mul_{lc}\\cdot ans_{rc}\\end{aligned}$$\n\n```cpp\n#include <cstdio>\n\ntypedef unsigned long long ull;\nconst int Mod = 1000000007;\nconst int maxN = 100005, maxL = 1 << 18 | 1;\n\nint N, Q, A[maxN], Pow[maxN];\n\n#define lc i << 1\n#define rc i << 1 | 1\nint Mul[maxL], Ans[maxL];\nvoid build(int i, int l, int r)\n{\n\tif (l == r)\n\t{\n\t\tMul[i] = A[l];\n\t\tif (l == N)\n\t\t\tAns[i] = A[l];\n\t\telse\n\t\t\tAns[i] = A[l] * 2ULL * Pow[N - l - 1] % Mod;\n\t\treturn;\n\t}\n\tint m = (l + r) >> 1;\n\tbuild(lc, l, m);\n\tbuild(rc, m + 1, r);\n\tMul[i] = (ull)Mul[lc] * Mul[rc] % Mod;\n\tAns[i] = ((ull)Mul[lc] * Ans[rc] + Ans[lc]) % Mod;\n}\nvoid modify(int i, int l, int r, int pos, int v)\n{\n\tif (l == r)\n\t{\n\t\tA[l] = v;\n\t\tMul[i] = A[l];\n\t\tif (l == N)\n\t\t\tAns[i] = A[l];\n\t\telse\n\t\t\tAns[i] = A[l] * 2ULL * Pow[N - l - 1] % Mod;\n\t\treturn;\n\t}\n\tint m = (l + r) >> 1;\n\tif (pos <= m)\n\t\tmodify(lc, l, m, pos, v);\n\telse\n\t\tmodify(rc, m + 1, r, pos, v);\n\tMul[i] = (ull)Mul[lc] * Mul[rc] % Mod;\n\tAns[i] = ((ull)Mul[lc] * Ans[rc] + Ans[lc]) % Mod;\n}\n#undef lc\n#undef rc\n\nint main()\n{\n\tscanf(\"%d%d\", &N, &Q);\n\tfor (int i = 1; i <= N; ++i)\n\t\tscanf(\"%d\", A + i);\n\tPow[0] = 1;\n\tfor (int i = 1; i <= N; ++i)\n\t\tPow[i] = 3U * Pow[i - 1] % Mod;\n\n\tbuild(1, 1, N);\n\n\tfor (int t, v; Q--;)\n\t{\n\t\tscanf(\"%d%d\", &t, &v);\n\t\tmodify(1, 1, N, t, v);\n\t\tprintf(\"%d\\n\", Ans[1]);\n\t}\n\n\treturn 0;\n}\n```",
        "postTime": 1552987905,
        "uid": 3144,
        "name": "\u6d6e\u5c18ii",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4340 \u3010[SHOI2016]\u968f\u673a\u5e8f\u5217\u3011"
    },
    {
        "content": "\u770b\u9898\u89e3\u533a\u90fd\u53d1\u73b0\u4e86\u8fd9\u9898\u8d21\u732e\u4e3a\u4e00\u6bb5\u524d\u7f00\u79ef\u7684\u6027\u8d28\uff0c\u6765\u53d1\u4e00\u7bc7\u4e0d\u9700\u8981\u8fd9\u4e2a\u6027\u8d28\u7684\u9898\u89e3\u3002\n\n### \u524d\u7f6e\u829d\u58eb\uff1a\n\n\u52a8\u6001 DP\n\n### \u505a\u6cd5\uff1a\n\n\u9996\u5148\u8bbe\u8ba1 DP \u72b6\u6001\u3002\n\n\u8bbe $f_{i, 0/1/2}$ \u8868\u793a\u7b2c $i$ \u4f4d\u524d\u586b\u4e86 $\\times / + / -$ \u53f7\u65f6\u9664\u4e86\u6700\u540e\u4e00\u6bb5\u79ef\u4ee5\u5916\u524d\u9762\u6240\u6709\u5df2\u7ecf\u7ed3\u675f\u7684\u533a\u95f4\u79ef\u7684\u548c\u3002\n\n\u4e3e\u4e2a\u4f8b\u5b50\uff1a\n\n$$a_1 \\times a_2 \\times a_3 - a_4 \\times a_5 + a_6 \\times a_7$$\n\n\u6b64\u65f6\u5df2\u7ecf\u7ed3\u675f\u7684\u533a\u95f4\u79ef\u7684\u548c\u5c31\u662f $a_1 \\times a_2 \\times a_3 - a_4 \\times a_5$ \u3002\n\n\u8bbe $g_{i,0/1/2}$ \u8868\u793a\u7b2c $i$ \u4f4d\u524d\u586b\u4e86 $\\times / + / -$ \u53f7\u65f6\u6700\u540e\u4e00\u6bb5\u79ef\u7684\u4e58\u79ef\u3002\n\n\u518d\u6b21\u5f15\u7528\u4e0a\u9762\u90a3\u4e2a\u4f8b\u5b50\uff0c\u6700\u540e\u4e00\u6bb5\u79ef\u5373 $a_6 \\times a_7$ \u3002\n\n\u6ce8\u610f\uff1a\u6700\u540e\u4e00\u6bb5\u79ef\u8981\u8fde\u5e26\u524d\u9762\u7684\u7b26\u53f7\uff01\n\n\u8bbe $cnt_{i,0/1/2}$ \u8868\u793a\u7b2c $i$ \u4f4d\u524d\u586b\u4e86 $\\times / + / -$ \u53f7\u65f6\u7684\u65b9\u6848\u6570\u3002\n\n\u5219\u53ef\u5f97\u5230 DP \u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$\\begin{cases}f_{i,0}=f_{i-1,0}+f_{i-1,1}+f_{i-1,2}\\\\f_{i,1}=f_{i-1,0}+f_{i-1,1}+f_{i-1,2}+g_{i-1,0}+g_{i-1,1}+g_{i-1,2}\\\\f_{i,2}=f_{i-1,0}+f_{i-1,1}+f_{i-1,2}+g_{i-1,0}+g_{i-1,1}+g_{i-1,2}\\\\g_{i,0}=a_i \\times (g_{i-1,0}+g_{i-1,1}+g_{i-1,2})\\\\g_{i,1}=a_i \\times cnt_{i,1}\\\\g_{i,2}=(-a_i) \\times cnt_{i,2}\\\\cnt_{i,0}=cnt_{i-1,0}+cnt_{i-1,1}+cnt_{i-1,2}\\\\cnt_{i,1}=cnt_{i-1,0}+cnt_{i-1,1}+cnt_{i-1,2}\\\\cnt_{i,2}=cnt_{i-1,0}+cnt_{i-1,1}+cnt_{i-1,2}\\end{cases}$\n\n\u6240\u4ee5\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a $9 \\times 9$ \u7684\u77e9\u9635\uff1a\n\n$$\\begin{bmatrix}1&1&1&0&0&0&0&0&0\\\\1&1&1&1&1&1&0&0&0\\\\1&1&1&1&1&1&0&0&0\\\\0&0&0&a_i&a_i&a_i&0&0&0\\\\0&0&0&0&0&0&a_i&a_i&a_i\\\\0&0&0&0&0&0&-a_i&-a_i&-a_i\\\\0&0&0&0&0&0&1&1&1\\\\0&0&0&0&0&0&1&1&1\\\\0&0&0&0&0&0&1&1&1\\end{bmatrix}$$\n\n\u81f3\u6b64\uff0cDP \u8fc7\u7a0b\u5c31\u53ef\u4ee5\u7ebf\u6bb5\u6811\u52a8\u6001\u7ef4\u62a4\u4e86\u3002\n\n\u4f46\u662f\uff0c\u7531\u4e8e\u77e9\u9635\u662f $9 \\times 9$ \u7684\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u9ad8\u8fbe $O(9^3 \\times n \\log{n})$ \uff0c\u96be\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\n\u4e8e\u662f\u8003\u8651\u4f18\u5316\u3002\n\n\u53ef\u4ee5\u53d1\u73b0 $cnt$ \u6570\u7ec4\u7684\u4e09\u4e2a\u8f6c\u79fb\u662f\u91cd\u590d\u7684\uff0c\u53ef\u4ee5\u5220\u53bb\u4e24\u4e2a\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a $7 \\times 7$ \u7684\u77e9\u9635\uff1a\n\n$$\\begin{bmatrix}1&1&1&0&0&0&0\\\\1&1&1&1&1&1&0\\\\1&1&1&1&1&1&0\\\\0&0&0&a_i&a_i&a_i&0\\\\0&0&0&0&0&0&3a_i\\\\0&0&0&0&0&0&-3a_i\\\\0&0&0&0&0&0&3\\end{bmatrix}$$\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(7^3 \\times n \\log{n})$ \uff0c\u5f00 O2 \u53ef\u901a\u8fc7\u672c\u9898\u3002\n\n### AC Code\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define pr pair<int, int>\n#define mp make_pair\n#define pb push_back\n#define mid (l + r) / 2\n#define ls num << 1\n#define rs num << 1 | 1\n#define fi first\n#define se second\nconst int mod = 1e9 + 7, N = 1e5 + 5;\n\nstruct matrix {\n\tint time[7][7];\n\t\n\tmatrix() {\n\t\tmemset(time, 0, sizeof(time));\n\t}\n\t\n\tvoid reset(int x) {\n\t\tfor (int i = 0; i < 3; i++) time[0][i] = 1;\n\t\t\n\t\ttime[6][6] = 3;\n\t\t\n\t\tfor (int i = 0; i < 6; i++) time[1][i] = time[2][i] = 1;\n\t\tfor (int i = 3; i < 6; i++) time[3][i] = x;\n\t\t\n\t\ttime[4][6] = 3 * x % mod;\n\t\ttime[5][6] = 3 * (mod - x) % mod;\n\t}\n} tr[N << 2];\nint a[N];\n\n#define getchar() (uu == vv && (vv = (uu = cc) + fread(cc, 1, 1 << 21, stdin), uu == vv) ? EOF : *uu++)\nchar cc[1 << 21], *uu = cc, *vv = cc;\n\ntemplate <typename T_ = int> inline T_ read() {\n\tT_ x = 0;\n\tbool y = 0;\n\tchar c = getchar();\n\twhile (!isdigit(c)) {\n\t\tif (c == '-') y = 1;\n\t\tc = getchar();\n\t}\n\twhile (isdigit(c)) x = x * 10 + (c ^ 48), c = getchar();\n\treturn y ? ~(x - 1) : x;\n}\n\ninline void write(int x){\n\tif(x < 0){\n\t\tputchar('-');\n\t\twrite(-x);\n\t\treturn;\n\t}\n\tif(x >= 10) write(x / 10);\n\tputchar(x % 10 + '0');\n}\n\nmatrix operator * (const matrix &x, const matrix &y) {\n\tmatrix z;\n\t\n\tfor (int k = 0; k < 7; k++) {\n\t\tfor (int i = 0; i < 7; i++) {\n\t\t\tfor (int j = 0; j < 7; j++) {\n\t\t\t\tz.time[i][j] += x.time[i][k] * y.time[k][j] % mod;\n\t\t\t\t\n\t\t\t\tif (z.time[i][j] >= mod) z.time[i][j] -= mod;\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn z;\n}\n\nvoid print(matrix x) {\n\tfor (int i = 0; i < 7; i++) {\n\t\tfor (int j = 0; j < 7; j++) {\n\t\t\twrite(x.time[i][j]);\n\t\t\tputchar(' ');\n\t\t}\n\t\tputchar('\\n');\n\t}\n\tputchar('\\n');\n}\n\nvoid update(int num) {\n\ttr[num] = tr[rs] * tr[ls];\n}\n\nvoid build(int l, int r, int num) {\n\tif (l == r) {\n\t\ttr[num].reset(a[l]);\n\t\treturn;\n\t}\n\t\n\tbuild(l, mid, ls);\n\tbuild(mid + 1, r, rs);\n\t\n\tupdate(num);\n}\n\nvoid update(int l, int r, int x, int num) {\n\tif (l == r) {\n\t\ttr[num].reset(a[l]);\n\t\treturn;\n\t}\n\t\n\tif (x <= mid) update(l, mid, x, ls);\n\telse update(mid + 1, r, x, rs);\n\t\n\tupdate(num);\n}\n\nsigned main(){\n\tint n = read(), q = read();\n\t\n\tfor (int i = 0; i < n; i++) {\n\t\ta[i] = read();\n\t}\n\t\n\ta[n] = 1;\n\t\n\tbuild(1, n, 1);\n\t\n\tmatrix now;\n\t\n\tnow.time[6][0] = 1;\n\tnow.time[3][0] = a[0];\n\t\n\twhile (q--) {\n\t\tint x = read() - 1, y = read();\n\t\t\n\t\ta[x] = y;\n\t\t\n\t\tif (x) update(1, n, x, 1);\n\t\telse now.time[3][0] = y;\n\t\t\n\t\tmatrix ans = tr[1] * now;\n\t\t\n\t\twrite(ans.time[1][0]);\n\t\tputchar('\\n');\n\t}\n}\n```\n\n#### \u5c0f\u4f18\u5316\uff1a\n\n\u53d1\u73b0\u77e9\u4e58\u4e2d\u6709\u6781\u591a\u4e58\u6cd5\u662f\u65e0\u6548\u7684\uff0c\u5f62\u5982 $0 \\times 0=0$\uff0c\u6240\u4ee5\u53ef\u4ee5\u63d0\u524d\u627e\u51fa\u6709\u7528\u7684\u4e58\u6cd5\uff0c\u5927\u5927\u4f18\u5316\u77e9\u4e58\u7684\u590d\u6742\u5ea6\uff0c\u9884\u8ba1\u4e0d\u5f00 O2 \u4e5f\u53ef\u901a\u8fc7\u6b64\u9898\u3002",
        "postTime": 1681256850,
        "uid": 188286,
        "name": "cjZYZtcl",
        "ccfLevel": 6,
        "title": "P4340 [SHOI2016]\u968f\u673a\u5e8f\u5217"
    },
    {
        "content": "\u7ebf\u6bb5\u6811\u597d\u9898\u554a\n\n\u731c\u4e2d(\u5206\u660e\u662f\u4e25\u8c28\u800c\u5408\u7406\u7684\u63a8\u5012)\u7ed3\u8bba\u7684\u8bdd\uff0c\u4f3c\u4e4e\u975e\u5e38\u7b80\u5355\u7684\u6837\u5b50\uff1f\n\n## \u90a3\u4e48\u5f00\u59cb\u6109\u5feb\u7684\u63a8\u5012\u7ed3\u8bba\u5427~\n\n\u6211\u4eec\u53d1\u73b0\u4e00\u4e2a\u5f88\u5947\u602a\u7684\u4e8b\u5b9e\u662f\uff0c\u8fd9\u4e2a\u957f\u5ea6\u4e3an\u7684\u5e8f\u5217\u53ea\u6709n-1\u4e2a\u8fd0\u7b97\u7b26\u53f7\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c**\u7b2c\u4e00\u9879\u7684\u7cfb\u6570\u5fc5\u4e3a\u6b63**\n\n\u6240\u4ee5\u6211\u4eec\u5462\u8003\u8651\u53bb\u6389\u7b2c\u4e00\u9879\uff0c\u73b0\u5728\u53d8\u6210\u4e86\u6bcf\u4e00\u4f4d(\u7b2c\u4e00\u9879\u7b26\u53f7\u4e0d\u80fd\u4e3a\u4e58)\u90fd\u662f\u4efb\u610f\u7b26\u53f7\u7684\u5e8f\u5217\n\n\u90a3\u4e48\u6211\u4eec\u53d1\u73b0\uff0c\u5728\u8fd9\u4e2a\u7b26\u53f7\u4efb\u610f\u7684\u6240\u6709\u5e8f\u5217\u5f53\u4e2d\uff0c\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u5e8f\u5217\uff0c\u52a0\u51cf\u53f7\u53cd\u8f6c\u4e4b\u540e\u90fd\u4f1a\u5b58\u5728\u4e00\u4e2a\u5bf9\u5e94\u7684\u5e8f\u5217\u4e0e\u4e4b\u76f8\u5bf9\u5e94\u7136\u540e\u5982\u679c\u6211\u4eec\u628a\u8fd9\u4e9b\u5e8f\u5217\u4e24\u4e24\u914d\u5bf9\u76f8\u52a0\u4e4b\u540e\u603b\u548c\u4e00\u5b9a\u662f0(\u56e0\u4e3a\u6bcf\u4e00\u5bf9\u76f8\u52a0\u90fd\u662f0)\n\n\u90a3\u4e48\u6b64\u65f6\u8ba9\u6211\u4eec\u6765\u770b\u88ab\u5ffd\u7565\u7684\u9996\u9879\uff0c\u663e\u7136\u56e0\u4e3a\u7b2c\u4e00\u9879\u5fc5\u4e3a\u6b63\u6240\u4ee5\u80af\u5b9a\u662f\u6d88\u4e0d\u6389\u7684\n\u90a3\u4e48\u6211\u4eec\u6765\u679a\u4e3e\u8fd9\u4e2a\u9996\u9879\uff0c\u770b\u770b\u6709\u591a\u5c11\u4e2a\u9996\u9879\u662f\u6d88\u4e0d\u6389\u7684\uff0c\u6362\u53e5\u8bdd\u6765\u8bb2\u6211\u4eec\u5462\u7edf\u8ba1\u540e\u8fb9\u7684\u5e8f\u5217\u6709\u591a\u5c11\u4e2d\u53ef\u80fd\u6027\uff0c\u5047\u8bbe\u540e\u8fb9\u7684\u957f\u5ea6\u4e3alen\uff0c\u7b2c\u4e00\u4e2a\u7b26\u53f7\u663e\u7136\u4e0d\u53ef\u4ee5\u9009\u4e58\uff0c\u5176\u4ed6\u7684\u4efb\u610f\u9009\uff0c\u4e00\u5171\u6709$2\u00d73^n$\u79cd\u53ef\u80fd\u6027\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u5bf9\u8fd9\u4e2a\u9996\u9879\u4e58\u4e0a\u4e00\u4e2a\u7cfb\u6570\u5c31\u884c\u4e86\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u9996\u9879\u5462\u5c31\u662f\u5e8f\u5217\u7684\u524d\u7f00\u79ef\uff0c\u800c\u6211\u4eec\u8981\u7ef4\u62a4\u524d\u7f00\u79ef\u7684\u548c\uff0c\u53d1\u73b0\u6b64\u65f6\u5355\u70b9\u4fee\u6539=\u524d\u7f00\u79ef\u533a\u95f4\u4e58\u6cd5\uff0c\u6b64\u65f6\u6211\u4eec\u53ea\u9700\u8981\u5199\u4e00\u4e2a\u8d44\u74f7\u533a\u95f4\u4e58\u533a\u95f4\u6c42\u548c\u7684\u7ebf\u6bb5\u6811\u5c31\u53ef\u4ee5\u5b8c\u6210\u5355\u70b9\u8d4b\u503c\u7684\u64cd\u4f5c\u4e86~\n\n\u4e0a\u4ee3\u7801~\n\n```C\n#include<cstdio>\n#include<algorithm>\nusing namespace std;const int N=1e5+10;typedef long long ll;\nint n;int m;ll mod=1e9+7;ll mi[N];ll prm[N];ll val[N];//\u8bb0\u5f97\u5199\u4e58\u6cd5\u9006\u5143 \ninline ll po(ll a,ll p){ll r=1;for(;p;p>>=1,a=(a*a)%mod){if(p&1){r=(r*a)%mod;}}return r;}\nstruct linetree//\u533a\u95f4\u4e58\u533a\u95f4\u6c42\u548c\u7684\u7ebf\u6bb5\u6811~ \n{\n\tll val[4*N];ll mult[4*N]; \n\tinline void pushdown(int p)\n\t{\n\t\tval[p<<1]=val[p<<1]*mult[p]%mod;\n\t\tval[p<<1|1]=val[p<<1|1]*mult[p]%mod;\n\t\tmult[p<<1]=mult[p<<1]*mult[p]%mod;\n\t\tmult[p<<1|1]=mult[p<<1|1]*mult[p]%mod;mult[p]=1;\n\t}\n\tinline void setmul(int p,int l,int r,int dl,int dr,ll mul)\n\t{\n\t\tif(dl==l&&dr==r){mult[p]=mult[p]*mul%mod;val[p]=val[p]*mul%mod;return;}\n\t\tint mid=(l+r)/2;pushdown(p);\n\t\tif(dl<mid){setmul(p<<1,l,mid,dl,min(dr,mid),mul);}\n\t\tif(mid<dr){setmul(p<<1|1,mid,r,max(dl,mid),dr,mul);}\n\t\tval[p]=(val[p<<1]+val[p<<1|1])%mod;\n\t}\n\tinline ll getv(){return val[1];}\n\tinline void build(int p,int l,int r)\n\t{\n\t\tif(r-l==1){val[p]=prm[r];return;}int mid=(l+r)/2;mult[p]=1;\n\t\tbuild(p<<1,l,mid);build(p<<1|1,mid,r);val[p]=(val[p<<1]+val[p<<1|1])%mod;\n\t}\n}lt;\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);mi[0]=1;prm[0]=1;\n\tfor(int i=1;i<=n;i++){scanf(\"%lld\",&val[i]);}\n\tfor(int i=1;i<=n;i++){mi[i]=mi[i-1]*3%mod;}//\u5904\u74063\u7684\u5e42\u6b21 \n\tfor(int i=1;i<=n;i++){prm[i]=prm[i-1]*val[i]%mod;}//\u5904\u7406\u524d\u7f00\u79ef \n\tfor(int i=1;i<=n-1;i++){prm[i]=prm[i]*2*mi[n-i-1]%mod;}//\u4e58\u4e0a\u5bf9\u5e94\u7684\u7cfb\u6570 \n\tlt.build(1,0,n);//\u6784\u5efa\u7ebf\u6bb5\u6811~ \n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint t;ll v;scanf(\"%d%lld\",&t,&v);\n\t\tlt.setmul(1,0,n,t-1,n,v*po(val[t],mod-2)%mod);//\u4fee\u6539 \n\t\tval[t]=v;printf(\"%lld\\n\",lt.getv());//\u8f93\u51fa~ \n\t}return 0;//\u62dc\u62dc\u7a0b\u5e8f~ \n}\n```",
        "postTime": 1522762429,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4340 \u3010[SHOI2016]\u968f\u673a\u5e8f\u5217\u3011"
    },
    {
        "content": " P4340 [SHOI2016]\u968f\u673a\u5e8f\u5217\n \n\u9898\u89e3\u533a\u7adf\u7136\u6ca1\u6709\u52a8\u6001 dp \u7684\u505a\u6cd5\uff0c\u6211\u6765\u6c34\u4e00\u53d1\u9898\u89e3\u3002\n \n\u7ebf\u6bb5\u6811\u5927\u6c34\u9898\u3002\u7136\u800c\u6211\u5f3a\u884c\u628a\u5b83\u505a\u6210\u4e86\u52a8\u6001 dp \u6a21\u677f\u9898\u3002\n\u8fd9\u4e2a\u9898\u7b2c\u4e00\u773c\u770b\u4e0a\u53bb\u5f88\u5bb9\u6613\u614c\uff0c\u4f46\u662f\u51b7\u9759\u4e0b\u6765\u53d1\u73b0\u4e00\u8f66\u4e1c\u897f\u90fd\u4f1a\u88ab\u6d88\u53bb\u3002\n\n\u8bbe $f_i$ \u8868\u793a\u8003\u8651\u5230\u7b2c $i$ \u4e2a\u6570\u5b57\uff0c\u6240\u6709\u7b54\u6848\u7684\u548c\u3002\u90a3\u4e48\u6211\u4eec\u679a\u4e3e\u6700\u540e\u4e00\u6bb5\u8fde\u7eed\u4e58\u79ef\u4e58\u5230\u54ea\u91cc\uff0c\u56e0\u4e3a\u52a0\u51cf\u53f7\u7684\u5b58\u5728\uff0c\u6700\u540e\u4e00\u6bb5\u8fde\u7eed\u4e58\u79ef\u53ea\u8981\u4e0d\u662f\u4e00\u76f4\u4e58\u5230\u5f00\u5934\uff0c\u5c31\u5168\u90e8\u4f1a\u88ab\u6d88\u53bb\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u5b58\u5728\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$f_i=2\\sum_{j=0}^{i-1}f_j + \\prod_{i=1}^{n}a_i$ \uff1b\n$f_0=0$ \u3002\n\n\u4f7f\u7528\u524d\u7f00\u548c\u4f18\u5316\u8f6c\u79fb\u3002\n\n\u8bbe $s_i=\\sum_{j=0}^{i}f_j$\uff0c\n\u5b58\u5728\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$s_i=3 s_{i-1}+a_i\\prod_{j=1}^{i-1}a_j$ \u3002\n\n\u90a3\u4e48\u7b54\u6848\u5373\u4e3a $s_i-s_{i-1}$ \u3002\n\n\u518d\u4f7f\u7528\u77e9\u9635\u4e58\u6cd5\u4f18\u5316\u8f6c\u79fb\u3002\n\n\u8bbe $m_i=\\prod_{j=1}^i a_j$ \uff0c\u5b58\u5728\u8f6c\u79fb\u77e9\u9635\uff1a\n\n$\\begin{bmatrix} s_i & m_i \\end{bmatrix}=\\begin{bmatrix} s_{i-1} & m_{i-1} \\end{bmatrix}\\cdot \\begin{bmatrix} 3 & 0 \\\\ a_i & a_i \\end{bmatrix}$ \u3002\u521d\u59cb\u77e9\u9635\uff1a$\\begin{bmatrix} s_0 & m_0 \\end{bmatrix}= \\begin{bmatrix} 0 & 1 \\end{bmatrix}$ \u3002\n\n\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u77e9\u9635\u533a\u95f4\u4e58\u6cd5\uff0c\u53d1\u73b0\u6bcf\u6b21\u4fee\u6539 $a_i$ \u5373\u4e3a\u4fee\u6539 $\\log n$ \u4e2a\u77e9\u9635\u4e58\u79ef\uff0c\u53ef\u4ee5\u9ad8\u6548\u52a8\u6001\u7ef4\u62a4\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(m^3q\\log n)$ \uff0c\u5176\u4e2d $m=2$ \uff0c\u5e38\u6570\u8f83\u5c0f\u3002**\u8fd9\u79cd\u505a\u6cd5\u76f8\u6bd4\u8f83\u7ec4\u5408\u8ba1\u6570\u7684\u65b9\u6cd5\u89c4\u907f\u4e86\u5fc5\u987b\u5b58\u5728\u9006\u5143\u7684\u7f3a\u70b9\u3002**\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst long long mod=1e9+7;\nlong long n,q,a[100005],dp[100005],mul[100005];\nstruct Matrix{\n\tlong long A[3][3];\n\tvoid _clear(){memset(A,0,sizeof A);return ;}\n};\nMatrix T[400005];\ninline Matrix operator*(Matrix x,Matrix y){\n\tMatrix z;z._clear();\n\tfor(long long i=1;i<=2;++i){\n\t\tfor(long long j=1;j<=2;++j){\n\t\t\tfor(long long k=1;k<=2;++k){\n\t\t\t\tz.A[i][j]+=x.A[i][k]*y.A[k][j];\n\t\t\t\tz.A[i][j]%=mod;\n\t\t\t}\n\t\t}\n\t}\n\treturn z;\n}\nvoid Build_tree(long long x,long long l,long long r){\n\tif(l==r){\n\t\tT[x].A[1][1]=3ll,T[x].A[1][2]=0ll,\n\t\tT[x].A[2][1]=a[l],T[x].A[2][2]=a[l];\n\t\treturn ;\n\t}\n\tlong long mid=l+r>>1ll;\n\tBuild_tree(x<<1ll,l,mid);\n\tBuild_tree(x<<1ll|1ll,mid+1ll,r);\n\tT[x]=T[x<<1ll]*T[x<<1ll|1ll];\n\treturn ;\n}\nvoid Modify_tree(long long x,long long l,long long r,long long t){\n\tif(l==r){\n\t\tT[x].A[2][1]=a[l],T[x].A[2][2]=a[l];\n\t\treturn ;\n\t}\n\tlong long mid=l+r>>1ll;\n\tif(t<=mid) Modify_tree(x<<1ll,l,mid,t);\n\telse Modify_tree(x<<1ll|1ll,mid+1ll,r,t);\n\tT[x]=T[x<<1ll]*T[x<<1ll|1ll];\n\treturn ;\n}\nMatrix Ask_tree(long long x,long long l,long long r,long long L,long long R){\n\tif(l==L && r==R) return T[x];\n\tlong long mid=l+r>>1ll;\n\tif(R<=mid) return Ask_tree(x<<1ll,l,mid,L,R);\n\telse if(L>=mid+1ll) return Ask_tree(x<<1ll|1ll,mid+1ll,r,L,R);\n\telse return Ask_tree(x<<1ll,l,mid,L,mid)*Ask_tree(x<<1ll|1ll,mid+1,r,mid+1,R);\n}\nint main(){\n\tscanf(\"%lld%lld\",&n,&q);\n\tlong long x,y,X,Y;\n\tfor(long long i=1;i<=n;++i) scanf(\"%lld\",&a[i]);\n\tBuild_tree(1,1,n);\n\tfor(long long j=1;j<=q;++j){\n\t\tscanf(\"%lld%lld\",&x,&y);\n\t\ta[x]=y;\n\t\tModify_tree(1,1,n,x);\n\t\tX=T[1].A[2][1];\n\t\tY=Ask_tree(1,1,n,1,n-1).A[2][1];\n\t\tprintf(\"%lld\\n\",(X-Y+mod)%mod);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1652077525,
        "uid": 131591,
        "name": "\u849f\u84bb\u541bHJT",
        "ccfLevel": 7,
        "title": "P4340 [SHOI2016]\u968f\u673a\u5e8f\u5217 \u9898\u89e3"
    },
    {
        "content": "\u4e0d\u96be\u53d1\u73b0\u4e24\u4e2a\u7b26\u53f7\u5bf9\u79f0\u7684\u5f0f\u5b50\u53ea\u6709\u524d\u7f00\u79ef\u6709\u8d21\u732e\uff0c\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u524d\u7f00\u79ef\u7b97\u51fa\u5b83\u7684\u8d21\u732e\u6b21\u6570\u3002\n\n\u53d1\u73b0\u5982\u679c\u4e00\u4e2a\u524d\u7f00\u79ef\u8981\u6709\u8d21\u732e\uff0c\u90a3\u4e48\u4e00\u5b9a\u662f\u4e00\u4e32\u4e58\u53f7+\u52a0\u51cf\u7b26\u53f7\uff0c\u5269\u4e0b\u7684\u4f4d\u7f6e\u53ef\u4ee5\u968f\u4fbf\u586b\u3002\n\n\u8fd9\u6837\u5bf9\u4e8e\u4e00\u4e2a\u524d\u7f00 $i,(1\\le i<n)$ \u5b83\u80fd\u4ea7\u751f\u7684\u8d21\u732e\u662f $val_i=mul_i\\times2\\times3^{n-i-2},mul_i=\\prod_{j=1}^{i}a_j$\u3002\n\n\u518d\u5bf9 $n$ \u7684\u8d21\u732e\u7279\u5224\u4e00\u4e0b\u3002\n\n\u7b54\u6848\u5c31\u662f $\\sum_{i=1}^n val_i$\u3002\n\n\u5bf9\u4e8e\u4fee\u6539\uff0c\u53ef\u4ee5\u53d1\u73b0\u5c31\u662f\u5bf9 $val_{t\\sim n}$ \u8fd9\u4e9b\u4f4d\u7f6e\u9664\u4ee5 $a_t$ \u518d\u4e58\u4e0a $v$\uff0c\u53d1\u73b0\u8fd9\u4e2a\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u3002\n\n## Code \n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\n\nconst int mod = 1e9 + 7;\n\nint tr[400010], mul[100010], a[100010], tag[400010], n, pw[100010];\n\nvoid pushdown(int num)\n{\n\tif (tag[num] <= 1)\n\treturn;\n\ttag[num * 2] = tag[num * 2] * tag[num] % mod;\n\ttag[num * 2 + 1] = tag[num * 2 + 1] * tag[num] % mod;\n\ttr[num * 2] = tr[num * 2] * tag[num] % mod;\n\ttr[num * 2 + 1] = tr[num * 2 + 1] * tag[num] % mod;\n\ttag[num] = 1;\n}\n\nint qpow(int x, int y)\n{\n\tint ans = 1;\n\tfor (;y;x = x * x % mod, y >>= 1)\n\tif (y & 1)\n\t{\n\t\tans = ans * x % mod;\n\t}\n\treturn ans;\n}\n\nvoid build(int l, int r, int num)\n{\n\tif (l == r)\n\t{\n\t\ttr[num] = mul[l];\n\t\ttag[num] = 1;\n\t\treturn;\n\t}\n\tint mid = l + r >> 1;\n\tbuild(l, mid, num * 2);\n\tbuild(mid + 1, r, num * 2 + 1);\n\ttr[num] = (tr[num * 2] + tr[num * 2 + 1]) % mod;\n\ttag[num] = 1;\n}\n\nvoid change(int l, int r, int x, int _, int num)\n{\n\tif (r < _)\n\treturn;\n\tif (l >= _)\n\t{\n\t\ttag[num] = tag[num] * x % mod;\n\t\ttr[num] = tr[num] * x % mod;\n\t\treturn;\n\t}\n\tpushdown(num);\n\tint mid = l + r >> 1;\n\tchange(l, mid, x, _, num * 2);\n\tchange(mid + 1, r, x, _, num * 2 + 1);\n\ttr[num] = (tr[num * 2] + tr[num * 2 + 1]) % mod;\n}\n\nsigned main()\n{\n    ios::sync_with_stdio(0);\n    cin.tie(0);\n\tint q;\n\tcin >> n >> q;\n\tfor (int i = 1;i <= n;i++)\n\t{\n\t\tcin >> a[i];\n\t}\n\tmul[0] = 1;\n\tpw[0] = 1;\n\tfor (int i = 1;i <= n;i++)\n\tpw[i] = pw[i - 1] * 3 % mod;\n\tfor (int i = 1;i <= n;i++)\n\t{\n\t\tmul[i] = mul[i - 1] * a[i] % mod;\n\t}\n\tfor (int i = 1;i < n;i++)\n\t{\n\t\tmul[i] = mul[i] * pw[n - i - 1] % mod * 2 % mod;\n\t}\n\tbuild(1, n, 1);\n\tfor (int i = 1;i <= q;i++)\n\t{\n\t\tint x, y;\n\t\tcin >> x >> y;\n\t\ty = y * qpow(a[x], mod - 2) % mod;\n\t\ta[x] = a[x] * y % mod;\n\t\tchange(1, n, y, x, 1);\n\t\tcout << tr[1] << '\\n';\n\t}\n}\n```",
        "postTime": 1681211782,
        "uid": 173424,
        "name": "Hovery",
        "ccfLevel": 6,
        "title": "P4340"
    },
    {
        "content": "\u57fa\u672c\u601d\u8def\u662f**\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u79ef**\n\n\u6211\u4eec\u53d1\u73b0\n\n\n\u4e24\u4e2a\u6570$a_1$,$a_2$,\u7ecf\u8fc7\u5316\u7b80$ans=2a_1+a_1a_2$\n\n\u4e09\u4e2a\u6570$a_1,a_2,a_3$,\u7ecf\u8fc7\u5316\u7b80$ans=6a_1+2a_1a_2+a_1a_2a_3$\n\n......\n\n\u7531\u4e8e\u5176\u4ed6\u7684\u9879\u5df2\u7ecf\u52a0\u51cf\u62b5\u6d88\uff0c\u6211\u4eec\u7c7b\u6bd4\u63a8\u5e7f\u4e00\u4e0b\uff0c\n\n\u53d1\u73b0$ans=\\sum_{i=1}^{n-1}2 \\times3^{n-i-1}\\times s_i +s_n$,\u5176\u4e2d$s_n=\\prod_{i=1}^na_i$\n\n\n\n\u8fd9\u65f6\u5019\u5927\u591a\u6570\u7ae5\u978b\u90fd\u60f3\u5230\u4e86\u7528\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u524d\u7f00\u79ef,\u53c8\u56e0\u4e3a\u6709 $mod$\u64cd\u4f5c,\u6240\u4ee5\u6211\u4eec\u9884\u5904\u7406\u51fa\u9006\u5143\u3002\n\n\n\u4f46\u662f\uff0c\u8981\u77e5\u9053\u6570\u636e\u53ea\u4fdd\u8bc1$a_i$\u662f\u975e\u8d1f\u6574\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4$a_i$\u53ef\u4ee5\u4e3a $0$,$0$\u6ca1\u6709\u9006\u5143\uff01\uff01\u6240\u4ee5\u8fd9\u79cd\u505a\u6cd5\u662f\u4e0d\u5bf9\u7684\u3002\n\n\n\u6211\u4eec\u5176\u5b9e\u53ef\u4ee5\u76f4\u63a5\u7ebf\u6bb5\u6811\u5355\u70b9\u4fee\u6539\uff0c\u7ef4\u62a4\u533a\u95f4\u79ef\u548c\u533a\u95f4\u5bf9\u4e8e\u7b54\u6848\u7684\u8d21\u732e\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u7ebf\u6bb5\u6811\u7684\u57fa\u672c\u64cd\u4f5c\uff0c\u5728\u6b64\u4e0d\u5728\u8d58\u8ff0\u3002\n\n\n\n\n$Code$\n\n```cpp\n#include<cstdio>\n#define ll long long\n#define lc (o<<1)\n#define rc (o<<1|1)\nusing namespace std;\nconst int N=100005,p=1e9+7;\nstruct D{ll mul,ans;int l,r;}e[N<<2];\nll a[N],s[N];\nint n,q;\nvoid build(int o,int l,int r)\n{\n\te[o].l=l;e[o].r=r;\n\tif(l==r)\n\t{\n\t\te[o].mul=a[r];\n\t\tif(r==n) e[o].ans=a[r];\n\t\telse e[o].ans=2ll*s[n-r-1]*a[r]%p;\n\t\treturn;\n\t}\n\tint mid=l+r>>1;\n\tbuild(lc,l,mid);\n\tbuild(rc,mid+1,r);\n\te[o].mul=(e[lc].mul*e[rc].mul)%p;\n\te[o].ans=(e[lc].mul*e[rc].ans%p+e[lc].ans)%p;\n}\nvoid update(int o,int x,int k)\n{\n\tif(e[o].l==e[o].r)\n\t{\n\t\te[o].mul=k;\n\t\tif(e[o].r==n) e[o].ans=k;\n\t\telse e[o].ans=2ll*s[n-e[o].r-1]*k%p;\n\t\treturn;\n\t}\n\tint mid=e[o].l+e[o].r>>1;\n\tif(x<=mid) update(lc,x,k);\n\tif(x>mid) update(rc,x,k);\n\te[o].mul=e[lc].mul*e[rc].mul%p;\n\te[o].ans=(e[lc].mul*e[rc].ans%p+e[lc].ans)%p;\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&q);\n\tfor(int i=1;i<=n;i++)\n\tscanf(\"%lld\",&a[i]);\n\ts[0]=1;\n\tfor(int i=1;i<=n;i++)\n\ts[i]=s[i-1]*3%p;\n\tbuild(1,1,n);\n\twhile(q--)\n\t{\n\t\tint x,k;\n\t\tscanf(\"%d%d\",&x,&k);\n\t\tupdate(1,x,k);\n\t\tprintf(\"%lld\\n\",e[1].ans);\n\t}\n\treturn 0;\n}\n\n```\n",
        "postTime": 1602598563,
        "uid": 192156,
        "name": "Bitter_Tea",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P4340 \u3010[SHOI2016]\u968f\u673a\u5e8f\u5217\u3011"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P4340)\n\n\u3010\u601d\u8def\u3011\n\n\u63a8\u89c4\u5f8b+\u7ebf\u6bb5\u6811\u7ef4\u62a4\n\n\u6211\u4eec\u53ef\u4ee5\u624b\u73a9\u51e0\u4e2a\u6837\u4f8b\uff1a\n\n3 3\n\n1 2 3\n\n\u6211\u4eec\u4f1a\u53d1\u73b0\u9664\u4e86\u7b2c\u4e00\u9879\u4ee5\u5916,\u5176\u4ed6\u7684\u9879\u90fd\u662f\u4f1a\u52a0\u51cf\u76f8\u6d88\u7684,\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651\u4e58\u6cd5,\u8bbe $s_i=a_1*a_2*...*a_i$, \u90a3\u5bf9\u4e8e\u6bcf\u4e2a$s_i$\u7684\u8d21\u732e\u5c31\u662f$s_i*2*3^{n-i-1}$\u9879,\u5bf9\u4e8e\u6700\u540e\u4e00\u9879$s_n$\u7684\u8d21\u732e\u5c31\u662f$s_n$.\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u4fee\u6539\u64cd\u4f5c\uff0c\u6211\u4eec\u4fee\u6539\u4e00\u4e2a\u6570\u53ea\u4f1a\u5f71\u54cd\u5b83\u548c\u4ee5\u540e\u7684\u524d\u7f00\u79ef\uff0c\u6211\u4eec\u8003\u8651\u7ebf\u6bb5\u6811\u7ef4\u62a4\u6bcf\u4e2a\u533a\u95f4\u7684\u8d21\u732e,\u90a3$t_1$\u5c31\u662f\u6574\u4e2a\u5e8f\u5217\u7684\u8d21\u732e.\u6211\u4eec\u8fdb\u884c\u4fee\u6539\u540e,\u5b9e\u9645\u4e0a\u5c31\u662f\u6539\u53d8\u4e86\u8fd9\u4e2a\u503c\u4ee5\u540e\u7684\u533a\u95f4\u7684\u8d21\u732e,\u6211\u4eec\u8ba9\u8fd9\u4e2a\u533a\u95f4\u548c\u5148\u9664\u4ee5\u6539\u53d8\u524d\u7684\u503c,\u518d\u4e58\u4e0a\u6539\u53d8\u540e\u7684\u503c,\u4f46\u6211\u4eec\u8fc7\u7a0b\u4e2dmod\u6389\u4e86,\u6211\u4eec\u6ca1\u529e\u6cd5\u76f4\u63a5\u9664\u4e00\u4e2a\u6570,\u6240\u4ee5\u6211\u4eec\u6c42\u4e00\u4e2a\u9006\u5143\u6765\u8fdb\u884c\u8fd9\u9879\u64cd\u4f5c\u3002\n\n \u6ce8\uff1a\u5f00\u59cb\u65f6\u8981\u5c06\u6240\u6709\u7684 lazy  \u6807\u8bb0\u8bbe\u4e3a 1\u3002\n```cpp\n#include<iostream>\n#include<cstdio>\n#define mod 1000000007\n#define N 100010\n#define ll long long\nusing namespace std;\nll n,q,a[N],ans,w[N],jny[N],ny[N],maxx,sum[N],tz[N];\nstruct Node{\n\tll mul,lazy;\n\tint l,r;\n} s[N*4];\nvoid re(ll &x)\n{\n\tx=0;\n\tchar i=getchar();\n\twhile(i<'0'||i>'9') i=getchar();\n\twhile(i>='0'&&i<='9') x=(x<<1)+(x<<3)+i-'0',i=getchar();\n}\nll ksm(ll a,ll b)\n{\n\tll total=1;\n\twhile(b)\n\t{\n\t\tif(b&1) total=(total*a)%mod;\n\t\ta=(a*a)%mod;\n\t\tb>>=1;\n\t}\n\treturn total%mod;\n}\nvoid build(int p,int l,int r)\n{\n\ts[p].l=l;\n\ts[p].r=r;\n\tif(l==r)\n\t{\n\t\tif(n-l-1<0) s[p].mul=w[l];\n\t\telse s[p].mul=w[l]*2*tz[n-l-1];\n\t\ts[p].mul%=mod;\n\t\ts[p].lazy=1;\n\t\treturn;\n\t}\n\tint mid=(l+r)/2;\n\tbuild(p<<1,l,mid);\n\tbuild(p<<1|1,mid+1,r);\n\ts[p].mul=(s[p<<1].mul+s[p<<1|1].mul)%mod;\n\ts[p].lazy=1;\n}\nvoid pushdown(int p)\n{\n\ts[p<<1].lazy*=s[p].lazy;\n\ts[p<<1].lazy%=mod;\n\tif(!s[p<<1].lazy) s[p<<1].lazy=1;\n\ts[p<<1].mul*=s[p].lazy;\n\ts[p<<1].mul%=mod;\n\ts[p<<1|1].lazy*=s[p].lazy;\n\ts[p<<1|1].lazy%=mod;\n\tif(!s[p<<1|1].lazy) s[p<<1|1].lazy=1;\n\ts[p<<1|1].mul*=s[p].lazy;\n\ts[p<<1|1].mul%=mod;\n\ts[p].lazy=1;\n}\nvoid update(int p,int l,int r,ll xny)\n{\n\tif(s[p].l>=l&&s[p].r<=r)\n\t{\n\t\ts[p].mul*=xny;\n\t\ts[p].mul%=mod;\n\t\ts[p].lazy*=xny;\n\t\ts[p].lazy%=mod;\n\t\tif(!s[p].lazy) s[p].lazy=1;\n\t\treturn;\n\t}\n\tif(s[p].lazy>1) pushdown(p);\n\tint mid=(s[p].l+s[p].r)/2;\n\tif(l<=mid) update(p<<1,l,r,xny);\n\tif(r>mid) update(p<<1|1,l,r,xny);\n\ts[p].mul=(s[p<<1].mul+s[p<<1|1].mul)%mod;\n}\nint main()\n{\n//\tfreopen(\"rand.in\",\"r\",stdin);\n//\tfreopen(\"rand.out\",\"w\",stdout);\n\tre(n);re(q);\n\tw[0]=1;sum[0]=1;\n\tny[1]=1;tz[0]=1;\n\tfor(int i=1; i<=n; i++) \n\ttz[i]=tz[i-1]*3,tz[i]%=mod;\n\tfor(int i=1; i<=n; i++)\n\t{\n\t\tre(a[i]);\n\t\tw[i]=w[i-1]*a[i];\n\t\tw[i]%=mod;\n\t\tmaxx=max(maxx,a[i]);\n\t}\n\tfor(int i=1; i<=maxx; i++) sum[i]=sum[i-1]*i,sum[i]%=mod;\n\tjny[maxx]=ksm(sum[maxx],mod-2);\n\tfor(int i=maxx-1; i>=1; i--)\n\tjny[i]=jny[i+1]*(i+1)%mod;\n\tfor(int i=2; i<=maxx; i++)\n\tny[i]=jny[i]*sum[i-1]%mod;\n\tll x,y;\n\tbuild(1,1,n);\n\tfor(int i=1; i<=q; i++)\n\t{\n\t\tre(x);\n\t\tre(y);\n\t\tupdate(1,x,n,ny[a[x]]*y%mod);\n\t\ta[x]=y;\n\t\tprintf(\"%I64d\\n\",s[1].mul%mod);\n\t}\n\treturn 0;\n}",
        "postTime": 1602320945,
        "uid": 279885,
        "name": "_Xiuer",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P4340 \u3010[SHOI2016]\u968f\u673a\u5e8f\u5217\u3011"
    },
    {
        "content": "## \u524d\u6392\u8b66\u544a\u4e00\u5927\u6ce2\u8fa3\u9e21\u6392\u7248\u53ef\u80fd\u4f1a\u635f\u5bb3\u60a8\u7684\u89c6\u529b\n\n\u9996\u5148\u5148\u8003\u8651\u5982\u679c\u4e0d\u4fee\u6539\u8be5\u600e\u4e48\u529e\u3002\n\n\u6ce8\u610f\u5230\u50cf\uff1a\n\n$$a_1*a_2*a_3+a_4*a_5-a_6*a_7*a_8*a_9$$\n\n\u7684\u5f0f\u5b50\u4e00\u5b9a\u4f1a\u6709\u4e00\u4e2a\u5bf9\u79f0\u7684\uff1a\n\n$$a_1*a_2*a_3-a_4*a_5+a_6*a_7*a_8*a_9$$\n\n\u628a\u9664\u4e86$a_1*a_2*a_3$\u7684\u5176\u4ed6\u4e1c\u897f\u5168\u90e8\u6d88\u6389\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\u9664\u4e86\u7b2c\u4e00\u6bb5\u201c\u4e58\u6cd5\u6bb5\u201d\u4e00\u5b9a\u4f1a\u662f\u6b63\u7684\u4ee5\u5916\u5176\u4ed6\u7684\u90e8\u5206\u90fd\u4f1a\u88ab\u6d88\u6389\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0c\u6700\u7ec8\u6240\u6709\u53ef\u80fd\u5f0f\u5b50\u7684\u52a0\u548c\u53ea\u80fd\u662f\n\n$$\\text{\u6570\u4e2a}\\ a_1+\\text{\u6570\u4e2a}\\ a_1*a_2+\\text{\u6570\u4e2a}\\ a_1*a_2*a_3+\u2026$$\n\n\u5bf9\u4e8e$a_1*a_2*\u2026*a_i$\uff0c\u540e\u9762\u8fd8\u6709$n-i$\u4e2a\u7b26\u53f7\u8981\u586b\uff0c\u4f46\u662f\u4e0b\u4e00\u4e2a\u51b3\u4e0d\u80fd\u662f\u4e58\u53f7\uff08\u5426\u5219\u5c31\u8981\u7b97\u8fdb$a_1*a_2*\u2026*a_i*a_{i+1}$\u4e86\uff09\uff0c\u6240\u4ee5\u6709$2*3^{n-i-1}$\u79cd\u53ef\u80fd\u7684\u586b\u6cd5\u3002\u53ea\u6709$a_1*a_2*\u2026*a_n$\u6bd4\u8f83\u7279\u6b8a\uff0c\u5b83\u53ea\u6709\u4e00\u4e2a\u3002\n\n\u8bbe$S_i=a_1*a_2*\u2026*a_n$\uff0c\u7b54\u6848\u5c31\u662f\n\n$$S_1*2*3^{n-2}+S_2*2*3^{n-3}+\u2026+S_{n-1}*2*3^0+S_n$$\n\n------------\n\n\u518d\u770b\u4e00\u4e0b\u4fee\u6539\u8be5\u600e\u4e48\u529e\u3002\n\n\u4e00\u4e2a\u663e\u7136\u7684\u60f3\u6cd5\u662f\u7528\u7ebf\u6bb5\u6811\uff0c\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u548c\u7684\u6bcf\u4e2a\u5143\u7d20\u662f$S_i*2*3^{n-i-1}$\uff0c$sum[x]=S_l*2*3^{n-l-1}+\u2026+S_r*2*3^{n-r-1}$\uff08\u4f46\u8981\u6ce8\u610f$S_n$\u7684\u7279\u6b8a\u6027\uff09\uff0c\u6bcf\u6b21\u6539$a_i$\u4e3a$A_i$\u5c31\u5bf9$[i,n]$\u7684\u5143\u7d20\u9664\u4ee5$a_i$\uff08\u4e58\u4ee5$a_i$\u7684\u9006\u5143\uff09\u518d\u4e58\u4ee5$A_i$\u3002\n\n\u7136\u800c\u9898\u76ee\u91cc\u8bf4$a_i,A_i$\u90fd\u53ef\u4ee5\u662f0\uff0c\u800c0\u6ca1\u6709\u9006\u5143\uff0c\u4ece0\u4fee\u6539\u81f3\u5176\u4ed6\u6b63\u6570\u4f1a\u5b8c\u86cb\uff0c\u4ee5\u4e0a\u65b9\u6cd5\u662f\u4f1aWA\u7684\uff0c\u7136\u800c\u9898\u76ee\u91cc\u5e76\u6ca1\u6709\u8fd9\u79cd\u6bd2\u7624\u6570\u636e\u2026\u2026\n\n\u6240\u4ee5\u5f53\u7136\u6211\u4eec\u8fd8\u6709\u4e00\u4e2a\u529e\u6cd5\u3002\u6211\u4eec\u6539\u6210\u5355\u70b9\u4fee\u6539\uff0c\n\n$$sum=a_l*2*3^{n-l-1}+a_l*a_{l+1}*2*3^{n-l-2}+\u2026\u2026+a_l*\u2026*a_r*2*3^{n-r-1}$$\n\n\uff08\u52a1\u5fc5\u770b\u6e05\uff09\n\n\uff08\u4f46\u8981\u6ce8\u610f$n=r$\u65f6\u7279\u6b8a\u60c5\u51b5\uff09\n\n\u663e\u7136$l=1,r=n$\u65f6\u5c31\u662f\u6211\u4eec\u8981\u67e5\u8be2\u7684\u90a3\u73a9\u610f\u3002\n\n\u5728\u539f\u5148\u7684\u57fa\u7840\u4e0a\u518d\u52a0\u4e00\u4e2a$mul[\\ ]$\u6570\u7ec4\uff0c\u8868\u793a\u533a\u95f4\u7684$a_i$\u7684\u4e58\u79ef\u3002\u5bb9\u6613\u5199\u51fa\uff1a\n\n$$mul[x]=mul[x*2]*mul[x*2+1]$$\n\n$$sum[x]=sum[x*2+1]*mul[x*2]+sum[x*2]$$\n\n\u8fd9\u6837\u5c31\u5b8c\u7f8e\u6ee1\u8db3\u533a\u95f4\u52a0\u6cd5\u4e86\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define ull unsigned long long\nusing namespace std;\n\nconst int TT=1000000007,maxN=100005;\n\nint N,Q,A[maxN],POW3[maxN];\n\nint MUL[maxN*4],ANS[maxN*4];\nvoid push_up(int x){\n    MUL[x]=((ull)MUL[x*2]*MUL[x*2+1])%TT;\n    ANS[x]=(((ull)MUL[x*2]*ANS[x*2+1])%TT+ANS[x*2])%TT; \n}\nvoid Build(int x,int l,int r){\n    if(l==r){\n        MUL[x]=A[l];\n        if(l==N)\n            ANS[x]=A[l];\n        else\n            ANS[x]=((ull)A[l]*2)%TT*POW3[N-l-1]%TT;\n        return;\n    }\n    int mid=(l+r)/2;\n    Build(x*2,l,mid);Build(x*2+1,mid+1,r);\n    push_up(x);\n} \nvoid Update(int x,int l,int r,int POS,int K){\n    if(l==r){\n        A[l]=K;\n        MUL[x]=K;\n        if(l==N)\n            ANS[x]=A[l];\n        else\n            ANS[x]=((ull)A[l]*2)%TT*POW3[N-l-1]%TT;\n        return;\t\n    }\n    int mid=(l+r)/2;\n    if(POS<=mid) Update(x*2,l,mid,POS,K);\n    else Update(x*2+1,mid+1,r,POS,K);\n    push_up(x);\n}\n\nint main(){\n    scanf(\"%d%d\",&N,&Q);\n    for(int i=1;i<=N;i++) scanf(\"%d\",&A[i]);\n    POW3[0]=1;\n    for(int i=1;i<=N;i++) POW3[i]=((ull)POW3[i-1]*3)%TT;\n    \n    Build(1,1,N);\n    \n    while(Q--){\n        int POS,K;scanf(\"%d%d\",&POS,&K);\n        Update(1,1,N,POS,K);\n        printf(\"%d\\n\",ANS[1]);\n    }\n}\n```\n",
        "postTime": 1556531416,
        "uid": 58567,
        "name": "x\u4e49x",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4340 \u3010[SHOI2016]\u968f\u673a\u5e8f\u5217\u3011"
    },
    {
        "content": "\u8fd9\u9898\u662f\u4e2a\u63a8\u67ff\u5b50\u9898\n\n\u5927\u6982\u8bb2\u8bb2\u5fc3\u8def\u5386\u7a0b\uff1a\n\n\u9996\u5148\uff0c\u770b\u5230\u8fd9\u79cd\u9898\u76ee\u6211\u7684\u7b2c\u4e00\u53cd\u5e94\u662f dp\uff0c\u4f46\u662f\u597d\u50cf dp \u4e0d\u53ef\u505a\uff0c~~\u56e0\u4e3a\u6211\u600e\u4e48\u4e5f\u5199\u4e0d\u51fa\u8f6c\u79fb\u65b9\u7a0b~~\n\n\u7136\u540e\u5f00\u59cb\u8003\u8651\u6709\u6ca1\u6709\u4e00\u4e9b\u5947\u6280\u6deb\u5de7\u3002\n\n\u63a8\u63a8\u6570\u5b66\u5f0f\u5b50\u3002\n\n\u8003\u8651 $A={a1,a2,a3,...,an}$ \uff0c\u90a3\u4e48\u5176\u5b9e\u8003\u8651\u5176\u4e2d\u7684\u4e00\u9879 $ak$ \u7684\u540e\u9762\uff0c\u4f1a\u6709\u4e00\u4e2a\u7a7a\u683c\uff0c\u5176\u4e2d\u53ef\u4ee5\u586b\u4efb\u610f\u7684\u7b26\u53f7\uff0c\u90a3\u4e48\u5176\u5b9e\u4e0d\u96be\u60f3\u5230\uff0c\u5982\u679c\u6b64\u5904\u586b\u52a0\u53f7\u7684\u60c5\u51b5\u5c31\u4f1a\u548c\u51cf\u53f7\u7684\u60c5\u51b5\u5bf9\u4e8e**\u540e\u9762**\u7684\u8d21\u732e\u503c\u6b63\u597d\u62b5\u6d88\uff0c\u4e5f\u5373\u53ef\u4ee5\u770b\u51fa\u5bf9\u4e8e\u4e00\u4e2a\u5df2\u6709\u7b26\u53f7\u7684\u5e8f\u5217\u6765\u8bf4\uff0c\u53ea\u6709\u6700\u524d\u9762\u7684\u8fde\u7eed\u4e58\u53f7\u4f1a\u5bf9\u6574\u4e2a\u5e8f\u5217\u7684\u503c\u6709\u8d21\u732e\u3002\n\n\u73b0\u5728\u6765\u8ba1\u7b97\u8d21\u732e\u5927\u5c0f\u3002\n\n\u8bbe $Mul_i=\\prod\\limits_{j=1}^i a_j$ \uff0c\u90a3\u4e48\u56e0\u4e3a\u540e\u9762\u90fd\u7ea6\u6389\u4e86\uff0c\u800c\u540e\u4e00\u4e2a\u7a7a\u6709 $2$ \u79cd\u9009\u62e9\uff08\u52a0\u6216\u51cf\uff09\uff0c\u5176\u4ed6\u540e\u9762\u7684\u7a7a\u4f1a\u6709 $3$ \u79cd\u9009\u62e9\uff08\u52a0\u6216\u51cf\u6216\u4e58\uff09\uff0c\u5219\u8d21\u732e\u503c\u5e94\u8be5\u4e3a $s_i=2*3^{n-i-1}*Mul_i$\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u8981\u7ef4\u62a4\u4e00\u4e2a\u524d\u7f00\u79ef\u7684\u533a\u95f4\u548c\u5c31\u597d\u4e86\n\n---\n\n\u6865\u8c46\u9ebb\u888b\uff0c\u5c3d\u7ba1\u8fd9\u6837\u5199\u51fa\u6765\u7684\u4ee3\u7801\u4ea4\u4e0a\u53bb\u662f\u80fd\u591f\u5bf9\u7684\uff0c\u4f46\u662f\u662f\u56e0\u4e3a\u9898\u76ee\u592a\u6c34\u4e86\uff0c\u9898\u76ee\u4e2d\u672c\u8eab\u53ea\u4fdd\u8bc1\u662f\u975e\u8d1f\u6574\u6570\u800c\u975e\u6b63\u6574\u6570\uff0c\u6240\u4ee5\u5982\u679c\u6709\u4e00\u6b21\u4fee\u6539\u6210\u4e86 0 \u4e4b\u540e\u540e\u9762\u5c31\u5f88\u96be\u518d\u641e\u4e86\u3002\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u91cd\u65b0\u8003\u8651\u56de\u5355\u70b9\u4fee\u6539\u3002\n\n\u8003\u8651\u5982\u4f55\u5c06\u5de6\u5b50\u533a\u95f4\u548c\u53f3\u5b50\u533a\u95f4\u5408\u5e76\uff1a\n\n\u9996\u5148\u660e\u663e\u7684\uff0c\u4e58\u79ef\u6709\n$$Mul_x=Mul_{lc[x]}*Mul_{rc[x]}$$\n\n\u7136\u540e\u5462\uff0c\u6211\u4eec\u7684\u7b54\u6848\u672c\u6765\u662f\n\n$$Ans_x=2\\times3^{n-l-1}\\times s_i$$\n\n\u5408\u5e76\u65f6\u5c31\u53ef\u4ee5\u53d1\u73b0\uff0c\u56e0\u4e3a\u5b83\u662f\u524d\u7f00\u79ef\uff0c\u6240\u4ee5\u6211\u4eec\u5982\u679c\u8981\u628a\u53f3\u5b50\u533a\u95f4\u6bb5\u7684\u771f\u5b9e\u503c\u6c42\u51fa\uff0c\u8981\u5c06\u5b83\u4e58\u4e0a\u5de6\u5b50\u533a\u95f4\u7684\u4e58\u79ef\uff0c\u800c\u5de6\u5b50\u533a\u95f4\u662f\u4e0d\u53d8\u7684\uff08\u611f\u6027\u7406\u89e3\u4e00\u4e0b\uff09\n\n\u4e5f\u5373\n\n$$Ans_x=Ans_{lc[x]}+Ans_{rc[x]}\\times Mul_{lc[x]}$$\n\n\u521d\u59cb\u6761\u4ef6\u5f88\u5bb9\u6613\u5904\u7406\uff0c\u770b\u4ee3\u7801\n\n\u4e8e\u662f\u4e4e\u5c31\u6109\u5feb\u7684\u505a\u5b8c\u4e86~\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n\nusing namespace std;\n\nconst int N=100010;\nconst int M=10010;\nconst int p=1e9+7;\n\ntypedef long long ll;\n\nll pow3[N];\n\nint a[N],n,q,t,m;\n\nint lc[N<<2],rc[N<<2],cnt;\nll s1[N<<2],s2[N<<2];\n\nvoid build(int x,int l,int r){\n\t\n\tif(l==r){\n\t\t\n\t\ts1[x]=a[l];\n\t\t\n\t\tif(l==n)\n\t\t\ts2[x]=a[l];\n\t\telse\n\t\t\ts2[x]=2ll*pow3[n-l-1]*a[l]%p;\n\t\t\n\t\treturn;\n\t}\n\t\n\tint mid=l+r>>1;\n\t\n\t++cnt;\n\tlc[x]=cnt;\n\tbuild(lc[x],l,mid);\n\t\n\t++cnt;\n\trc[x]=cnt;\n\tbuild(rc[x],mid+1,r);\n\t\n\ts1[x]=(s1[lc[x]]*s1[rc[x]])%p;\n\ts2[x]=(s2[rc[x]]*s1[lc[x]]%p+s2[lc[x]])%p;\n}\n\nvoid modify(int x,int l,int r,int t,int m){\n\t\n\tif(l==r){\n\t\t\n\t\ts1[x]=a[l]=m;\n\t\t\n\t\tif(l==n)\n\t\t\ts2[x]=a[l];\n\t\telse\n\t\t\ts2[x]=2ll*pow3[n-l-1]*a[l]%p;\n\t\t\n\t\treturn;\n\t}\n\t\n\tint mid=l+r>>1;\n\t\n\tif(t<=mid)   modify(lc[x],l,mid,t,m);\n\tif(t>=mid+1) modify(rc[x],mid+1,r,t,m);\n\t\n\ts1[x]=(s1[lc[x]]*s1[rc[x]])%p;\n\ts2[x]=(s2[rc[x]]*s1[lc[x]]%p+s2[lc[x]])%p;\n}\n\nint main(){\n\t\n\tscanf(\"%d%d\",&n,&q);\n\t\n\tpow3[0]=1;\n\tfor(int i=1;i<=n;i++) pow3[i]=pow3[i-1]*3%p;\n\t\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\t\n\tcnt=1;\n\tbuild(1,1,n);\n\t\n\twhile(q--){\n\t\tscanf(\"%d%d\",&t,&m);\n\t\tmodify(1,1,n,t,m);\n\t\tprintf(\"%lld\\n\",s2[1]);\n\t}\n\t\n\treturn 0;\n}\n```\n\u8bf4\u5b9e\u8bdd\uff0c\u6211\u6253\u7ebf\u6bb5\u6811\u7684\u677f\u5b50\u662f\u8fd9\u79cd\u770b\u7740\u6bd4\u8f83\u6e05\u723d\u7684\u3002\n\n\u7801\u98ce\u5982\u679c\u4e0d\u5408\u53e3\u5473\u8f7b\u55b7",
        "postTime": 1650278694,
        "uid": 33063,
        "name": "Focus_on",
        "ccfLevel": 6,
        "title": "P4340 [SHOI2016]\u968f\u673a\u5e8f\u5217 \u9898\u89e3"
    },
    {
        "content": "\u6211\u4eec\u628a\u8868\u8fbe\u5f0f\u62c6\u6210\u82e5\u5e72\u4e2a\u4e58\u6cd5\u6bb5\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u7b2c\u4e00\u6bb5\u7684\u7cfb\u6570\u5fc5\u7136\u4e3a\u6b63\uff0c\u800c\u540e\u9762\u82e5\u5e72\u6bb5\u7684\u7cfb\u6570\u5fc5\u7136\u5b58\u5728\u4e00\u4e2a\u8868\u8fbe\u5f0f\u4e0e\u5176\u76f8\u62b5\u6d88\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u7528\u8003\u8651\u7b2c\u4e00\u6bb5\u7684\u8d21\u732e\u3002\n\n\u6211\u4eec\u8bbe $p_i=\\prod_{j=1}^ia_j$\uff0c\u663e\u7136\u6709\uff1a\n\n$$ans=\\sum_{i=1}^{n-1}p_i\\times2\\times3^{n-i-1}+p_n$$\n\n\u4e8e\u662f\u5efa\u7acb\u7ebf\u6bb5\u6811\uff0c\u8fdb\u884c\u533a\u95f4\u4e58\u6cd5\uff0c\u540c\u65f6\u7ef4\u62a4\u533a\u95f4\u548c\u5373\u53ef\u3002\n\n\u7136\u800c\u53ef\u80fd\u5b58\u5728 $a_i\\equiv0\\ (\\bmod{\\ 10^9+7})$ \u7684\u60c5\u51b5\uff0c\u8fd9\u65f6\u5019\u533a\u95f4\u4e58\u6cd5\u5c31\u4f1a\u88ab\u5361\u6389\u3002\n\n\u4e8e\u662f\u6211\u4eec\u8003\u8651\u76f4\u63a5\u5355\u70b9\u4fee\u6539\u3002\n\n\u6211\u4eec\u8bb0 $mul$ \u8868\u793a\u533a\u95f4\u79ef\uff0c$ans$ \u8868\u793a\u7b54\u6848\u3002\n\n\u663e\u7136\u6709\uff1a\n\n$$mul_o=mul_{lc}\\times mul_{rc}$$\n\n\u7136\u540e\u6211\u4eec\u5206\u7c7b\u8ba8\u8bba\uff0c\u53d1\u73b0\u524d\u7f00\u79ef\u53ef\u80fd\u5b8c\u5168\u4f4d\u4e8e\u5de6\u533a\u95f4\uff0c\u4e5f\u53ef\u80fd\u8de8\u8d8a\u5de6\u533a\u95f4\uff0c\u5219\uff1a\n\n$$ans_o=ans_{lc}+mul_{lc}\\times ans_{rc}$$\n\nCode:\n\n```cpp\n#include <cstdio>\n#define lc (o << 1)\n#define rc (o << 1 | 1)\nusing namespace std ; \ntypedef long long ll ;\nconst int MAXN = 1e5 + 10 , mod = 1e9 + 7 ;\nstruct sgt {\n\tll mul , ans ;\n\tint l , r ;\n} t[MAXN << 2] ;\nint n , q ; \nll a[MAXN] , pw[MAXN] ;\nvoid build (int o , int l , int r) {\n\tt[o].l = l ; t[o].r = r ;\n\tif (l == r) {\n\t\tt[o].mul = a[l] ;\n\t\tif (l == n) t[o].ans = a[l] ;\n\t\telse t[o].ans = 2LL * a[l] * pw[n - l - 1]  % mod ;\n\t\treturn ;\n\t}\n\tint mid = l + r >> 1 ;\n\tbuild (lc , l , mid) ;\n\tbuild (rc , mid + 1 , r) ;\n\tt[o].mul = t[lc].mul * t[rc].mul % mod ;\n\tt[o].ans = (t[lc].mul * t[rc].ans % mod + t[lc].ans) % mod ;\n}\nvoid update (int o , int x , int k) {\n\tif (t[o].l == t[o].r) {\n\t\tt[o].mul = k ;\n\t\tif (t[o].l == n) t[o].ans = k ;\n\t\telse t[o].ans = 2LL * k * pw[n - t[o].l - 1]  % mod ;\n\t\treturn ;\n\t}\n\tint mid = t[o].l + t[o].r >> 1 ;\n\tif (x <= mid) update (lc , x , k) ;\n\telse update (rc , x , k) ;\n\tt[o].mul = t[lc].mul * t[rc].mul % mod ;\n\tt[o].ans = (t[lc].mul * t[rc].ans % mod + t[lc].ans) % mod ;\n}\nint main () {\n\tscanf (\"%d %d\" , &n , &q) ;\n\tfor (int i = 1 ; i <= n ; i++)\n\t\tscanf (\"%lld\" , &a[i]) ;\n\tpw[0] = 1 ;\n\tfor (int i = 1 ; i <= n ; i++)\n\t\tpw[i] = pw[i - 1] * 3 % mod ;\n\tbuild (1 , 1 , n) ;\n\twhile (q--) {\n\t\tint x , k ;\n\t\tscanf (\"%d %d\" , &x , &k) ;\n\t\tupdate (1 , x , k) ;\n\t\tprintf (\"%lld\\n\" , t[1].ans) ;\n\t}\n\treturn 0 ;\n}\n```",
        "postTime": 1588325243,
        "uid": 122641,
        "name": "GIFBMP",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4340 \u3010[SHOI2016]\u968f\u673a\u5e8f\u5217\u3011"
    },
    {
        "content": "## \u9898\u76ee\u63cf\u8ff0\uff1a\n\u96fe\u3002\n## \u9898\u76ee\u5206\u6790\uff1a\n\u52a0\u51cf\u62b5\u6d88\u4e86\u3002\n\n\u5176\u5b9e\u7b54\u6848\u91cc\u53ea\u6709\u4e00\u4e9b\u524d\u7f00\u7684\u79ef\n\n$s[i]=a[1]*a[2]*...*a[i]$ \u90a3\u4e48 s[i]\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5373\u4e3a $s[i]*2*3^{n-i-1}$\n\n\u7531\u4e8e\u4fee\u6539\u4e00\u4e2a\u6570\u53ea\u4f1a\u5bf9\u5b83\u53ca\u540e\u9762\u7684\u524d\u7f00\u79ef\u4ea7\u751f\u5f71\u54cd\n\n\u90a3\u4e48\u5c31\u662f\u4e2a\u533a\u95f4\u4fee\u6539\uff0c\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5c31\u597d\u4e86\u3002\n\n\u9884\u5904\u7406\u9006\u5143\n## \u9898\u76ee\u94fe\u63a5\uff1a\n[Luogu 4340](https://www.luogu.org/problemnew/show/P4340)\n\n[BZOJ 4597](http://www.lydsy.com/JudgeOnline/problem.php?id=4597)\n\n[LOJ 2028](https://loj.ac/problem/2028)\n\n## Ac \u4ee3\u7801\uff1a\n```\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#define int long long\nconst int mod=1e9+7;\nconst int maxm=120000;\nstruct node{\n\tint sum,tag;\n}st[maxm<<2]; \nint a[maxm],pos[maxm],inv[maxm],bin[maxm],s[maxm];\nint n,q;\nvoid pushup(int o)\n{\n\tst[o].sum=(st[(o<<1)].sum%mod+st[(o<<1)|1].sum%mod)%mod;\n}\nvoid col(int o,int v)\n{\n  st[o].sum=(st[o].sum*v)%mod;\n  st[o].tag=(st[o].tag*v)%mod;\n}\nvoid pushdown(int o)\n{\n  if(st[o].tag==1) return;\n  col((o<<1),st[o].tag);\n  col((o<<1)|1,st[o].tag);\n  st[o].tag=1;\n}\nvoid build(int o,int l,int r)\n{\n\tst[o].tag=1;\n\tif(l>=r)\n\t{\n\t\tst[o].sum=(l!=n?(s[l]*bin[n-l-1]*2)%mod:s[l]);  \n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tbuild((o<<1),l,mid),build((o<<1)|1,mid+1,r);\n\tpushup(o);\n}\nvoid change(int o,int l,int r,int ql,int qr,int num)\n{\n\tif(ql<=l&&r<=qr)\n\t{\n\t\tcol(o,num);\n\t\treturn;\n\t}\n\tpushdown(o);\n\tint mid=(l+r)>>1;\n\tif(ql<=mid) change((o<<1),l,mid,ql,qr,num);\n\tif(qr>mid) change((o<<1)|1,mid+1,r,ql,qr,num);\n\tpushup(o);\n}\nmain()\n{\n\tscanf(\"%lld%lld\",&n,&q);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&a[i]);\n    bin[0]=1;  \n    for(int i=1;i<=n;i++) bin[i]=(bin[i-1]*3)%mod;  \n    inv[1]=1;  \n    for(int i=2;i<=10000;i++)  \n     inv[i]=(mod-mod/i*inv[mod%i]%mod);  \n    s[1]=a[1];  \n    for(int i=2;i<=n;i++) s[i]=(s[i-1]*a[i])%mod;  \n    build(1,1,n);  \n    //printf(\"%lld\\n\",st[1].sum);\n    for(int i=1;i<=q;i++)\n    {\n    \tint pos,y;\n    \tscanf(\"%lld%lld\",&pos,&y);\n    \tchange(1,1,n,pos,n,(y*inv[a[pos]])%mod);\n    \ta[pos]=y;\n    \tprintf(\"%lld\\n\",st[1].sum);\n    }\n    return 0;\n}\n```\n",
        "postTime": 1521883430,
        "uid": 19842,
        "name": "\u534a\u4ed9\u80e1\u5c0f\u6843",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4340 \u3010[SHOI2016]\u968f\u673a\u5e8f\u5217\u3011"
    },
    {
        "content": "\u4f17\u6240\u5468\u77e5\uff0c\u4e58\u6cd5\u4f1a\u6539\u53d8\u8fd0\u7b97\u987a\u5e8f\u3002\u5047\u8bbe\u5728\u539f\u5e8f\u5217\u4e2d\u653e\u4e00\u4e9b\u4e58\u53f7\uff0c\u518d\u653e\u5165\u52a0\u51cf\u53f7\u3002\u6b64\u65f6\uff0c\u82e5\u53d6\u53cd\u8fd9\u4e9b\u52a0\u51cf\u53f7\uff0c\u4e24\u5f0f\u76f8\u52a0\uff0c\u7b54\u6848\u5c31\u53ea\u4e0e\u7b2c\u4e00\u6bb5\u8fde\u4e58\u76f8\u5173\u3002\n\n\u5047\u8bbe $1$ \u5230 $i$ \u4e2a\u6570\u4e2d\u95f4\u90fd\u662f\u4e58\u53f7\uff0c\u90a3\u4e48\u94a6\u5b9a $a_i$ \u540e\u9762\u53ea\u80fd\u653e\u52a0\u51cf\u53f7\uff08\u5426\u5219\u4f1a\u7b97\u91cd\uff09\uff0c\u5269\u4e0b\u7684\u7b26\u53f7\u4efb\u610f\u3002\u7b80\u5355\u63a8\u5bfc\uff0c\u53ef\u4ee5\u53d1\u73b0\u7b54\u6848\u5c31\u662f\n\n$$\\sum_{i=1}^{N} 2\\times3^{N-i-1} \\prod_{j=1}^i a_j$$\n\n\u6709\u4e2a\u8fb9\u754c\u95ee\u9898\uff1a$i=N$ \u65f6\u4f1a\u591a\u4e58 $2$\uff0c\u4e14\u51fa\u73b0\u4e86 $3^{-1}$ \u3002\n\n\u5904\u7406\u4e00\u4e0b\uff0c\u5f97\u5230\n\n$$2 \\times \\left(\\sum_{i=1}^{N-1}3^{N-i-1}\\prod_{j=1}^i a_j \\right) + \\prod_{i=1}^N a_i$$\n\n\u4e8e\u662f\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u8fdb\u884c\u7ef4\u62a4\u62ec\u53f7\u5185\u7684\u4e1c\u897f\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u628a $3^{n-i-1}$ \u53d8\u6210 $3^{n-i}$ \u6765\u7ef4\u62a4\uff08\u5176\u4e2d $n$ \u662f\u7ebf\u6bb5\u957f\u5ea6\uff09\uff0c\u518d\u67e5\u8be2 $[1, N-1]$\uff0c\u4ee5\u907f\u514d $3^{-1}$ \u7684\u51fa\u73b0\u3002\n\n\u7ef4\u62a4\u5173\u4e8e\u524d\u7f00\u79ef\u7684\u4fe1\u606f\uff0c\u9700\u8981\u7ef4\u62a4**\u524d\u7f00\u79ef**\u548c**\u7b54\u6848**\u3002\n\n\u8003\u8651\u600e\u6837\u5408\u5e76\u4e24\u4e2a\u533a\u95f4\uff1a\u5408\u5e76\u540e\uff0c\u5de6\u533a\u95f4\u7684\u201c\u76f8\u5bf9\u53f3\u7aef\u70b9\u4f4d\u7f6e\u4f4d\u7f6e\u201d\u53d8\u5927\u4e86\uff0c\u7b54\u6848\u4e58\u4e0a $3^{\\operatorname{len_r}}$\uff0c\u800c\u53f3\u533a\u95f4\u5219\u8981\u4e58\u4e0a\u5de6\u533a\u95f4\u7684\u524d\u7f00\u79ef\u3002\u524d\u7f00\u79ef\u4fe1\u606f\u7684\u5408\u5e76\u662f\u5bb9\u6613\u7684\u3002\n\n\u4e8e\u662f\u5355\u6b21\u67e5\u8be2 $O(\\log N)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define ms(x, v) memset(x, v, sizeof(x))\n#define il inline\n#define pii pair<int, int>\n#define pil pair<int, long long>\n#define pll pair<long long, long long>\n#define U(i,l,r) for(int i(l),END##i(r);i<=END##i;++i)\n#define D(i,r,l) for(int i(r),END##i(l);i>=END##i;--i)\nusing namespace std;\n\ntypedef unsigned long long ull;\ntypedef long long ll;\ntypedef __int128_t i128;\ntypedef __uint128_t u128;\ntemplate <typename T>\nusing BS = basic_string<T>;\n\ntemplate <typename T>\nil int rd(T& s) {\n\tint c = getchar();\n    // if (c == EOF) return -1;\n\tT f = 1; s = 0;\n\twhile (c < '0' || c > '9') {\n\t\tif (c == '-') f = -1;\n        c = getchar();\n\t\t// if (c == EOF) return -1;\n\t}\n\twhile (c >= '0' && c <= '9') {\n\t\ts = (s << 1) + (s << 3) + (c ^ 48);\n\t\tc = getchar();\n\t}\n\ts *= f;\n    return 0;\n}\ntemplate <typename T, typename... Args>\nil int rd(T& x1, Args&... args) { return rd(x1) || rd(args...); }\ntemplate <typename T>\nil void pr(T s, bool fg = true) {\n    if (s < 0) { printf(\"-\"); s = -s; }\n    if (!s) {\n        if (fg) printf(\"0\");\n        return;\n    }\n    pr(s / 10, false);\n    printf(\"%d\", int(s % 10));\n}\n// \u4ee3\u7801\u5199\u7684\u662f\u5de6\u95ed\u53f3\u5f00\u533a\u95f4\uff0c\u6bd4\u8f83\u4e11\nconst int N = 100005;\nconst ll P = 1000000007;\n\nint n, q;\nll a[N], pow3[N]; // \u9884\u5904\u7406 3^N \u9632\u6b62\u590d\u6742\u5ea6\u9000\u5316\n\n#define mid ((l + r) >> 1)\n#define L(p) ((p) << 1)\n#define R(p) (((p) << 1) | 1)\n#define M(x) ((x) % P)\n\nstruct Node {\n    int l, r; // [l, r)\n    ll mul, ans;\n} tr[N << 2];\nNode merge(Node& l, Node& r) {\n    return {l.l, r.r, l.mul * r.mul % P, M(l.ans * pow3[r.r - r.l] % P + r.ans * l.mul % P) };\n}\nvoid build(int p = 1, int l = 0, int r = n) {\n    tr[p] = {l, r, a[l], a[l]};\n    if (r == l + 1) return;\n    build(L(p), l, mid);\n    build(R(p), mid, r);\n    tr[p] = merge(tr[L(p)], tr[R(p)]);\n}\nvoid update(int x, ll v, int p = 1, int l = 0, int r = n) {\n    if (r == l + 1) { tr[p] = {l, r, v, v}; return; }\n    if (x < mid) update(x, v, L(p), l, mid);\n    else update(x, v, R(p), mid, r);\n    tr[p] = merge(tr[L(p)], tr[R(p)]);\n}\nNode query(int b, int e, int p = 1, int l = 0, int r = n) {\n    if (b <= l && e >= r) { return tr[p]; }\n    if (b < mid && e <= mid) return query(b, e, L(p), l, mid);\n    else if (b >= mid && e > mid) return query(b, e, R(p), mid, r);\n    else {\n        Node la = query(b, e, L(p), l, mid), ra = query(b, e, R(p), mid, r);\n        return merge(la, ra);\n    }\n}\n\nint main() {\n    rd(n, q);\n    pow3[0] = pow3[1] = 1;\n    U (i, 1, n) pow3[i] = pow3[i - 1] * 3 % P;\n    U (i, 0, n - 1) rd(a[i]);\n    build();\n    while (q--) {\n        int x, v; rd(x, v);\n        update(x - 1, v);\n        Node p = query(0, n - 1);\n        printf(\"%lld\\n\", M(p.ans * 2 % P + tr[1].mul));\n    }\n    return 0;\n}\n```",
        "postTime": 1656120264,
        "uid": 120324,
        "name": "Yansuan_HCl",
        "ccfLevel": 7,
        "title": "[\u9898\u89e3] P4340 [SHOI2016]\u968f\u673a\u5e8f\u5217"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a_i$\uff0c\u4f60\u9700\u8981\u5728\u6bcf\u4e24\u9879\u4e4b\u95f4\u6dfb\u52a0\u4e00\u4e2a $\\{+, -, \\times\\}$ \u4f7f\u5176\u5f62\u6210\u4e00\u4e2a\u8868\u8fbe\u5f0f\uff0c\u5e76\u652f\u6301 $q$ \u6b21\u5355\u70b9\u4fee\u6539\u540e\u6c42\u51fa\u6240\u6709 $3^{n-1}$ \u4e2a\u8868\u8fbe\u5f0f\u4e4b\u548c\uff0c\u7b54\u6848\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n## \u5927\u4f53\u601d\u8def\n\u9996\u5148\uff0c\u624b\u7b97 $n=3, 4$ \u7b49\u5c0f\u8303\u56f4\u6570\u636e\u53ef\u4ee5\u53d1\u73b0\uff0c\u6700\u7ec8\u53ea\u5269\u4e0b $a_1,\\ a_1a_2,\\ a_1a_2a_3\\cdots $ \u9879\u3002\n\n\u5bf9\u5176\u8fdb\u884c\u5f52\u7eb3\u603b\u7ed3\uff0c\u5e76\u5206\u5f00\u8ba1\u7b97\u8d21\u732e\uff1a\u5047\u8bbe $a_i(i<n)$ \u53ca\u5176\u4e4b\u524d\u90fd\u662f\u4e58\u53f7\uff0c\u800c $a_i,\\ a_{i+1}$ \u4f7f\u7528 $\\pm$ \u8fdb\u884c\u8fde\u63a5\uff0c\u5219\u540e\u9762\u6240\u6709\u9879\u90fd\u53ef\u4ee5\u7528\u4e00\u4e2a $+$ \u4e0e\u4e00\u4e2a $-$ \u62b5\u6d88\uff0c\u6240\u4ee5\u5355\u4e2a\u7684\u8d21\u732e\u5747\u4e3a $\\prod_{j=1}^i a_j$\u3002\u7531\u4e8e\u540e\u9762\u6709 $n-i$ \u4e2a\u4f4d\u7f6e\u53ef\u4ee5\u586b\u5199\u8fd0\u7b97\u7b26\uff0c\u7b2c\u4e00\u4e2a\u4f4d\u7f6e\u53ea\u80fd\u586b $\\pm$\uff0c\u540e\u9762\u6bcf\u4e2a\u4f4d\u7f6e\u6709\u4e09\u79cd\uff0c\u603b\u8d21\u732e\u4e3a $2\\times 3^{n-i-1}\\prod_{j=1}^i a_j$\u3002\u6ce8\u610f\u9700\u8981\u5355\u72ec\u52a0\u4e0a $\\prod_{j=1}^n a_j$\uff0c\u6240\u4ee5\uff0c\u9898\u76ee\u6240\u6c42\u7684\u7b54\u6848\u4e3a \n$$\\left(\\prod_{j=1}^n a_j+\\sum_{i=1}^{n-1}2\\times 3^{n-i-1}\\cdot\\prod_{j=1}^ia_j\\right) \\bmod 10^9+7$$\n\n\u8fd9\u6837\uff0c\u6bcf\u6b21\u7ebf\u6027\u8ba1\u7b97\uff0c\u590d\u6742\u5ea6 $O(nq)$\uff0c\u62ff\u5230\u4e86 $50\\%$ \u7684\u90e8\u5206\u5206\u3002\n\n\u8fdb\u4e00\u6b65\u601d\u8003\u6b63\u89e3\uff1a\u6211\u4eec\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u6bcf\u4e2a\u53f6\u5b50\u8282\u70b9 $i(i<n)$ \u50a8\u5b58 $2\\times 3^{n-i-1}a_i$\uff0c\u7279\u6b8a\u5730\uff0c\u6700\u540e\u4e00\u4e2a\u53f6\u8282\u70b9 $i=n$ \u50a8\u5b58 $a_n$\u3002\u7136\u540e\uff0c\u6bcf\u6b21\u5408\u5e76\u5de6\u53f3\u533a\u95f4\uff0c\u9700\u8981\u4e58\u4ee5 $a_1a_2\\cdots a_{i-1}$\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6bcf\u4e2a\u8282\u70b9\u7ef4\u62a4\u4e24\u4e2a\u503c $mul, sum$\uff0c\u5206\u522b\u8868\u793a\u533a\u95f4\u7684\u4e58\u6570\u548c\u8d21\u732e\u548c\u3002pushup \u65f6\uff0c\u4ee4 \n$$mul_i\\leftarrow mul_{lson}\\times mul_{rson},\\ \\ sum_i\\leftarrow sum_{lson}+mul_{lson}\\times sum_{rson}$$\n\u7136\u540e\uff0c\u5229\u7528\u7ebf\u6bb5\u6811\u57fa\u672c\u64cd\u4f5c\uff0c\u5e76\u9884\u5904\u7406 $3$ \u7684\u5e42\u6b21\u65b9\uff0c\u6700\u7ec8\u590d\u6742\u5ea6\u4e3a $O(n+q\\log n)$\u3002\n\n## \u5b8c\u6574\u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define rep(ii,aa,bb) for(re int ii = aa; ii <= bb; ii++)\n#define Rep(ii,aa,bb) for(re int ii = aa; ii >= bb; ii--)\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef double db;\ntypedef pair<int, int> PII;\nconst int maxn = 1e5 + 5, mod = 1e9 + 7;\nnamespace IO_ReadWrite {\n\t#define re register\n\t#define gg (p1 == p2 && (p2 = (p1 = _buf) + fread(_buf, 1, 1<<21, stdin), p1 == p2) ? EOF :*p1++)\n\tchar _buf[1<<21], *p1 = _buf, *p2 = _buf;\n\ttemplate <typename T>\n\tinline void read(T &x){\n\t\tx = 0; re T f=1; re char c = gg;\n\t\twhile(c > 57 || c < 48){if(c == '-') f = -1;c = gg;}\n\t\twhile(c >= 48 &&c <= 57){x = (x<<1) + (x<<3) + (c^48);c = gg;}\n\t\tx *= f;return;\n\t}\n\tinline void ReadChar(char &c){\n\t\tc = gg;\n\t\twhile(!isalpha(c)) c = gg;\n\t}\n\ttemplate <typename T>\n\tinline void write(T x){\n\t\tif(x < 0) putchar('-'), x = -x;\n\t\tif(x > 9) write(x/10);\n\t\tputchar('0' + x % 10);\n\t}\n\ttemplate <typename T>\n\tinline void writeln(T x){write(x); putchar('\\n');}\n}\nusing namespace IO_ReadWrite;\nll n, q, a[maxn], P[maxn], mul[maxn * 4], sum[maxn * 4];\ninline void pushup(int k) {\n\tmul[k] = (mul[k << 1] * mul[k << 1 | 1]) % mod;\n\tsum[k] = (sum[k << 1] + sum[k << 1 | 1] * mul[k << 1] % mod) % mod;\n}\ninline void build(int k, int l, int r) {\n\tif(l == r) {\n\t\tmul[k] = a[l];\n\t\tif(l == n) sum[k] = a[l];\n\t\telse sum[k] = (2ll * a[l] * P[n - l - 1]) % mod;\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tbuild(k << 1, l, mid), build(k << 1 | 1, mid + 1, r);\n\tpushup(k);\n}\ninline void modify(int k, int l, int r, int x, ll v) {\n\tif(l == r) {\n\t\ta[l] = mul[k] = v;\n\t\tif(l == n) sum[k] = a[l];\n\t\telse sum[k] = (2ll * a[l] * P[n - l - 1]) % mod;\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tif(x <= mid) modify(k << 1, l, mid, x, v);\n\telse modify(k << 1 | 1, mid + 1, r, x, v);\n\tpushup(k);\n}\nint main () {\n\tread(n); read(q);\n\trep(i, 1, n) read(a[i]);\n\tP[0] = 1;\n\trep(i, 1, n) P[i] = (P[i - 1] * 3ll) % mod;\n\tbuild(1, 1, n);\n\twhile(q --) {\n\t\tint t; ll v;\n\t\tread(t); read(v);\n\t\tmodify(1, 1, n, t, v);\n\t\twriteln(sum[1]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1646743694,
        "uid": 279197,
        "name": "Mars_Dingdang",
        "ccfLevel": 6,
        "title": "P4340 [SHOI2016]\u968f\u673a\u5e8f\u5217"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](http://zrzring.cn/index.php/archives/238)\n\n\u9996\u5148\u53ef\u4ee5\u53d1\u73b0\u5982\u679c\u4e24\u4e2a\u5f0f\u5b50\u4ec5\u52a0\u53f7\u548c\u51cf\u53f7\u4e92\u6362\u7684\u8bdd\uff0c\u8d21\u732e\u4ec5\u4e3a\u7b2c\u4e00\u4e2a\u52a0\u53f7\u6216\u51cf\u53f7\u524d\u9762\u7684\u8868\u8fbe\u5f0f\u7684\u503c\uff0c\u4e8e\u662f\u6211\u4eec\u679a\u4e3e\u7b2c\u4e00\u4e2a+\u6216-\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u90a3\u4e48\u7b54\u6848\u4e3a\n$$\n\\sum_{i = 1}^{n - 1}\\left(\\prod_{k = 1}^{i}a_i \\times 2 \\times 3^{n - i + 1}\\right) + \\prod_{k = 1}^{n}a_i\n$$\n\u56e0\u4e3a\u8981\u652f\u6301\u5355\u70b9\u4fee\u6539\uff0c\u8003\u8651\u7ebf\u6bb5\u6811\u7ef4\u62a4\u8fd9\u4e00\u4e2a\u7b54\u6848\uff0c\u5176\u5b9e\u8fd9\u4e2a\u5f0f\u5b50\u5728\u7ef4\u62a4\u4e00\u4e2a\u524d\u7f00\u79ef\u7684\u524d\u7f00\u548c\uff0c\u5bf9\u4e8e\u5408\u5e76\u4e24\u4e2a\u533a\u95f4\uff0c\u5408\u5e76\u5b8c\u7684\u53f3\u534a\u90e8\u5206\u7684\u7b54\u6848\u53ef\u4ee5\u63d0\u53d6\u516c\u56e0\u6570\uff0c\u516c\u56e0\u6570\u4e3a\u4e3a\u5de6\u533a\u95f4\u7684\u7d2f\u79ef\uff0c\u63d0\u53d6\u516c\u56e0\u6570\u540e\u5269\u4e0b\u7684\u4e3a\u53f3\u533a\u95f4\u7684\u7b54\u6848\n\n\u82e5\u8be5\u9898\u6ca1\u6709\u51fa\u73b0$0$\u4fee\u6539\u6210\u6b63\u6570\u7684\u64cd\u4f5c\u7684\u8bdd\uff0c\u8fd8\u53ef\u4ee5\u8f6c\u5316\u4e3a\u53f6\u5b50\u8282\u70b9\u7ef4\u62a4\u524d\u7f00\u79ef\uff0c\u7ebf\u6bb5\u6811\u7ef4\u62a4\u548c\uff0c\u6bcf\u6b21\u5bf9\u533a\u95f4$(x,n)$\u4e58$x$\u4f4d\u7f6e\u4e0a\u7684\u6570\u7684\u9006\u5143\u518d\u4e58\u4e0a\u8981\u4fee\u6539\u7684\u6570\u5373\u53ef\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cmath>\n#include <cstring>\n#include <algorithm>\n#include <queue>\nusing namespace std;\nvoid file() {\n    freopen(\"std.in\", \"r\", stdin);\n    freopen(\"wa.out\", \"w\", stdout);\n}\nconst int N = 1e6 + 10, inf = 1e9, dsq = 1e9 + 7;\ninline int read() {\n    bool sym = 0; int res = 0; char ch = getchar();\n    while (!isdigit(ch)) sym |= (ch == '-'), ch = getchar();\n    while (isdigit(ch)) res = (res << 3) + (res << 1) + (ch ^ 48), ch = getchar();\n    return sym ? -res : res;\n}\nint n, m, a[N], m3[N];\nnamespace SEG {\n    int ans[N], mul[N];\n    #define ls x << 1\n    #define rs x << 1 | 1\n    void pushup(int x) {\n        mul[x] = 1ll * mul[ls] * mul[rs] % dsq;\n        ans[x] = (ans[ls] + 1ll * ans[rs] * mul[ls] % dsq) % dsq;\n    }\n    void build(int x, int l, int r) {\n        if (l == r) {\n            mul[x] = a[l]; if (l == n) ans[x] = a[l]; else ans[x] = 2ll * a[l] * m3[n - l - 1] % dsq;\n            return;\n        }\n        int mid = l + r >> 1;\n        build(ls, l, mid); build(rs, mid + 1, r);\n        pushup(x);\n    }\n    void modify(int x, int l, int r, int pos, int t) {\n        if (l == r) {\n            mul[x] = t; if (l == n) ans[x] = t; else ans[x] = 2ll * t * m3[n - l - 1] % dsq;\n            return;\n        }\n        int mid = l + r >> 1;\n        if (mid >= pos) modify(ls, l, mid, pos, t);\n        else modify(rs, mid + 1, r, pos, t);\n        pushup(x);\n    }\n}\nint main() {\n    n = read(); m = read(); m3[0] = 1;\n    for (int i = 1; i <= n; i++) a[i] = read(), m3[i] = 3ll * m3[i - 1] % dsq;\n    using namespace SEG; build(1, 1, n);\n    for (int i = 1; i <= m; i++) {\n        int x = read(), t = read();\n        modify(1, 1, n, x, t); printf(\"%d\\n\", ans[1]);\n    }\n    return 0;\n}\n```",
        "postTime": 1598263112,
        "uid": 28392,
        "name": "zrzring",
        "ccfLevel": 5,
        "title": "P4340 \u3010[SHOI2016]\u968f\u673a\u5e8f\u5217\u3011"
    },
    {
        "content": "\u8003\u8651\u586b\u5165\u4e00\u7ec4\u8fd0\u7b97\u7b26\u4e4b\u540e\u4e00\u6bb5\u4e58\u8d77\u6765\u7684\u6570\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff1a\n\n\u82e5\u8fd9\u4e00\u6bb5\u524d\u9762\u53ef\u4ee5\u586b\u7684\u8fd0\u7b97\u7b26\u6709+\u548c-\u4e24\u79cd\uff0c\u5219+\u7684\u65b9\u6848\u548c-\u7684\u65b9\u6848\u4e4b\u95f4\u5b58\u5728\u4e00\u4e00\u5bf9\u5e94\u5173\u7cfb\uff0c\u6d88\u53bb\u8fd9\u4e00\u6bb5\u4e58\u8d77\u6765\u7684\u6570\u7684\u8d21\u732e\uff1b\n\n\u6240\u4ee5\u5bf9\u7b54\u6848\u6709\u8d21\u732e\u7684\u4e00\u5b9a\u662f\u4e00\u4e2a\u524d\u7f00\u7684\u79ef\uff08\u53ef\u4ee5\u89c6\u4e3a\u7b2c\u4e00\u4e2a\u6570\u524d\u9762\u53ea\u80fd\u586b\u52a0\u53f7\uff09\u3002\n\n\u4e0d\u59a8\u8bbe$\\prod_{i=1}^ka_i=P_k$\uff0c\n\u53d1\u73b0\u4e00\u4e2a\u957f\u5ea6\u4e3a$i(1\\le i<n)$\u7684\u524d\u7f00\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a$P_k\\times3^{n-i-1}\\times2$\u3002\n\u8fd9\u662f\u5bb9\u6613\u89e3\u91ca\u7684\uff0c\u56e0\u4e3a\u5728\u8fd9\u4e2a\u524d\u7f00\u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u8fd0\u7b97\u7b26\u53ea\u80fd\u586b\u5165+\u6216\u8005-\u4e24\u79cd;\u518d\u5f80\u540e\u7684\u6240\u6709\u8fd0\u7b97\u7b26\u90fd\u662f\u4efb\u610f\u7684\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u6709\u4e09\u79cd\u586b\u6cd5\u3002\n\n\u7279\u522b\u5730\uff0c\u957f\u5ea6\u4e3a$n$\u7684\u524d\u7f00\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f$P_n$\u3002\n\n\u8003\u8651\u5230$P_k$\u540e\u9762\u7684\u7cfb\u6570\u770b\u8d77\u6765\u4e0d\u592a\u6e05\u723d\uff0c\u6211\u4eec\u4ee4\u6240\u6709\u7684$a_i$\u90fd\u9664\u4ee5$3$\u5f97\u5230$b_i$\uff0c\u518d\u8003\u8651\u4ed6\u4eec\u7684\u524d\u7f00\u79ef$Q_i$\uff0c\u4e0d\u96be\u53d1\u73b0\u6211\u4eec\u7684\u7b54\u6848\u5c31\u662f\n$$3^nQ_n +3^{n-1}\\sum_{i=1}^{n-1}Q_{i}$$\n\n\u8003\u8651\u4e00\u4e2a\u652f\u6301\u533a\u95f4\u4e58\u3001\u533a\u95f4\u6c42\u548c\u7684\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4$Q_i$\uff0c\u5c06$b_x$\u4fee\u6539\u4e3a$y$\u65f6\u53ea\u8981\u5c06\u533a\u95f4$[x,n]$\u90fd\u4e58\u4ee5$\\frac{y}{b_x}$\u5373\u53ef......\u5417\uff1f\n\n\u4e8b\u5b9e\u4e0a\u6211\u4eec\u4ecd\u9700\u8003\u8651$a_x=0$\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a$0$\u662f\u4e0d\u80fd\u4f5c\u4e3a\u5206\u6bcd\u7684\u3002\u6ce8\u610f\u5230\u53ea\u8981\u5b58\u5728\u67d0\u4e2a$a_p=0$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6240\u6709$p\\le i$\uff0c\u6709$Q_i=P_i=0$\u3002\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u6240\u6709$a_p=0$\u7684\u4f4d\u7f6e$p$\u4e2d\u7684\u6700\u9760\u524d\u7684\u4e00\u4e2a\uff0c\u8fd9\u91cc\u6211\u4f7f\u7528\u4e86\u4e00\u4e2aset\u3002\n\n\u5728\u51fa\u73b0\u6d89\u53ca\u5230\u5c06$a_x$\u4fee\u6539\u4e3a$0$\u7684\u64cd\u4f5c\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u5728\u7ebf\u6bb5\u6811\u4e0a\u5b9e\u9645\u4fee\u6539\uff0c\u800c\u662f\u5c06$x$\u4e22\u8fdbset\u91cc\u9762\uff0c\u4fdd\u7559\u539f\u6709\u7684$b_x$\uff1b\n\u5c06$a_x$\u4ece$0$\u4fee\u6539\u4e3a\u975e$0$\u6570$y$\u65f6\u518d\u4eceset\u91cc\u9762\u5220\u6389\uff0c\u5e76\u4e14\u7528\u5148\u524d\u7684$b_x$\u8fdb\u884c\u66f4\u65b0\uff08\u53ef\u4ee5\u770b\u4ee3\u7801\uff09\u3002\n\n\u67e5\u8be2\u533a\u95f4\u548c\u65f6\u5b9e\u9645\u4e0a\u53ea\u8981\u67e5\u5230set\u4e2d\u6700\u5c0f\u4f4d\u7f6e\u4e4b\u524d\u7684\u4e00\u4e2a\u4f4d\u7f6e\u5373\u53ef\uff0c\u540e\u9762\u5168\u662f$0$\u4e0d\u7528\u7ba1\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdlib>\n#include <cstring>\n#include <cstdio>\n#include <set>\n#define setit set<int>::iterator\n#define mod 1000000007ll\n#define inv3 333333336ll\n\nusing namespace std;\ntypedef long long ll;\nconst int MAXN = 100005;\nint n,q;\nll a[MAXN],b[MAXN],pre[MAXN];\nstruct Node\n{\n\tint l,r;\n\tll sum,lazy;\n}t[MAXN<<2];\ninline void buildtree(int id, int l, int r)\n{\n    t[id].l = l, t[id].r = r;\n    t[id].lazy = 1;\n    if(l==r)\n    {\n        t[id].sum = pre[l];\n        return;\n\t}\n\tint mid = (l+r)>>1;\n\tbuildtree(id<<1,l,mid);\n\tbuildtree(id<<1|1,mid+1,r);\n\tt[id].sum = (t[id<<1].sum+t[id<<1|1].sum)%mod;\n}\ninline void pushdown(int id)\n{\n\tt[id<<1].lazy = t[id<<1].lazy*t[id].lazy%mod;\n\tt[id<<1|1].lazy = t[id<<1|1].lazy*t[id].lazy%mod;\n\tt[id].sum = t[id].sum*t[id].lazy%mod;\n\tt[id].lazy = 1;\n}\ninline void pushup(int id)\n{\n\tt[id].sum = (t[id<<1].lazy*t[id<<1].sum%mod+t[id<<1|1].lazy*t[id<<1|1].sum%mod)%mod;\n}\ninline void modify(int id, int l, int r, ll d)\n{\n\tif(t[id].l==l&&t[id].r==r)\n\t{\n\t    t[id].lazy = t[id].lazy*d%mod;\n\t    return;\n\t}\n\tpushdown(id);\n    int mid = (t[id].l+t[id].r)>>1;\n    if(r<=mid)\n        modify(id<<1,l,r,d);\n    else if(l>mid)\n        modify(id<<1|1,l,r,d);\n    else\n        modify(id<<1,l,mid,d), modify(id<<1|1,mid+1,r,d);\n    pushup(id);\n}\ninline ll query(int id, int l, int r)\n{\n\tif(l>r)\n\t    return 0;\n\tif(t[id].l==l&&t[id].r==r)\n\t    return t[id].lazy*t[id].sum%mod;\n    pushdown(id);\n    int mid = (t[id].l+t[id].r)>>1;\n    if(r<=mid)\n        return query(id<<1,l,r);\n    else if(l>mid)\n        return query(id<<1|1,l,r);\n    else\n        return (query(id<<1,l,mid)+query(id<<1|1,mid+1,r))%mod;\n}\nset<int> st;\ninline int getMin()\n{\n\treturn *st.begin();\n}\ninline ll qpow(ll a, int b)\n{\n\tll res = 1;\n\tfor(; b; a = a*a%mod, b >>= 1)\n\t    if(b&1)\n\t\t    res = res*a%mod;\n\treturn res; \n}\ninline ll getInv(ll x)\n{\n\treturn qpow(x,mod-2);\n}\n\nint main()\n{\n\tcin >> n >> q;\n    pre[0] = 1;\n\tfor(int i = 1; i<=n; i++)\n\t{\n\t    scanf(\"%lld\",&a[i]);\n        b[i] = a[i]*inv3%mod;\n\t    if(!b[i])\n\t    {\n\t        st.insert(i);\n\t        b[i] = 1;\n\t\t}  \n        pre[i] = pre[i-1]*b[i]%mod;\n\t}\n\tbuildtree(1,1,n);\n\tint x,y;\n\twhile(q--)\n\t{\n\t    scanf(\"%d%d\",&x,&y);\n       //\u6ce8\u610f\u6b64\u5904\u64cd\u4f5c\n\t    if(y==0)\n\t    {\n\t        st.insert(x);\n\t        a[x] = 0;\n\t\t}\n\t\telse\n\t\t{\n\t        if(a[x]==0)\n\t            st.erase(x);\n\t        ll tmp = y*inv3%mod;\n\t        modify(1,x,n,getInv(b[x])*tmp%mod);\n\t\t\tb[x] = tmp; \n\t\t}\n     //\u67e5\u8be2\n\t\tif(st.empty())\n\t\t{\n\t        ll res = query(1,1,n-1)*qpow(3,n-1)%mod*2%mod;\n\t        res = (res+query(1,n,n)*qpow(3,n)%mod)%mod;\n\t        printf(\"%lld\\n\",res);\n\t\t}\n\t\telse\n\t\t{\n\t        int pos = getMin();\n\t        if(pos==1)\n\t        {\n\t            printf(\"0\\n\");\n\t            continue;\n\t\t\t}\n\t\t    ll res = query(1,1,pos-1)*qpow(3,n-1)%mod*2%mod;\n\t\t    printf(\"%lld\\n\",res);\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1566959899,
        "uid": 31098,
        "name": "Caro23333",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4340 \u3010[SHOI2016]\u968f\u673a\u5e8f\u5217\u3011"
    },
    {
        "content": "[\u83b7\u53d6\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c$QwQ$](https://ctz45562.github.io/2019/03/12/%E9%A2%98%E8%A7%A3-%E6%B4%9B%E8%B0%B7-P4340-%E3%80%90-SHOI2016-%E9%9A%8F%E6%9C%BA%E5%BA%8F%E5%88%97%E3%80%91/)\n\n[\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P4340)\n\n\u8fd9\u79cd\u9898\u4e00\u822c\u5c31\u6162\u6162\u63a8\u5f0f\u5b50\u5427\u3002\u3002\u3002\n\n\n\u5bf9\u4e00\u4e2a\u6570\u5217\uff0c\u5728\u4efb\u610f\u6dfb\u52a0\u7b26\u53f7\u65f6\u5019\u4f60\u4f1a\u53d1\u73b0\uff0c**\u67d0\u4e2a\u6570\u5b57\u524d\u9762\u6709\u591a\u5c11\u79cd\u60c5\u51b5\u6dfb\u52a0\u52a0\u53f7\uff0c\u5c31\u6709\u591a\u5c11\u79cd\u60c5\u51b5\u6dfb\u52a0\u51cf\u53f7\uff0c\u5c31\u4f1a\u76f8\u4e92\u62b5\u6d88**\u3002\u800c\u7b2c\u4e00\u4e2a\u6570\u5b57\u524d\u9762\u52a0\u4e0d\u4e86\u4e1c\u897f\uff0c\u4e0d\u53d7\u8fd9\u4e2a\u89c4\u5f8b\u5f71\u54cd\u3002\n\n\u6240\u4ee5\u7ecf\u8fc7\u4e00\u7cfb\u5217\u5408\u5e76\u6700\u540e\u5269\u4e0b\u7684\u4e00\u5b9a\u662f\u82e5\u5e72\u4e2a\u524d\u7f00\u4e58\uff08\u7c7b\u6bd4\u4e8e\u524d\u7f00\u548c\uff09\u7684\u548c\u3002\n\n\u6240\u4ee5\u524d\u7f00\u4e58\u7ec4\u5408\u60c5\u51b5\u662f\u600e\u4e48\u6837\u7684\u5462\uff1f\u4ee4$g(i)=\\prod\\limits_{i=1}^{n}a[i]$\uff0c\u5373\u524d\u7f00\u4e58\u3002\n\n\u5047\u8bbe\u6570\u5217\u6709$5$\u4e2a\u6570\u5b57\uff0c\u4e3a$a,b,c,d,e$\u3002$g(5)=a*b*c*d*e$\u3002\u663e\u7136$g(5)$\u53ea\u4f1a\u51fa\u73b0$1$\u6b21\u3002\n\n\u628a\u6700\u540e\u4e00\u4e2a\u4e58\u53f7\u66ff\u6362\u4e3a\u52a0\u53f7\u548c\u51cf\u53f7\uff0c$a*b*c*d+e$\u548c$a*b*c*d-e$\u5c31\u4f1a\u76f8\u52a0\u76f8\u4e92\u62b5\u6d88\uff0c\u5f97\u5230$2$\u4e2a$g(4)$\u3002\n\n\u518d\u628a$g(5)$\u548c$g(4)$\u7684\u6bcf\u79cd\u60c5\u51b5\u7684\u5012\u6570\u7b2c\u4e8c\u4e2a\u4e58\u53f7\u66ff\u6362\u4e3a\u52a0\u53f7\u548c\u51cf\u53f7\uff0c\u76f8\u52a0\u540e\u5c31\u4f1a\u5f97\u5230$6$\u4e2a$g(3)$\u3002\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6709$18$\u4e2a$g(2)$\uff0c$54$\u4e2a$g(1)$\u3002\u8fd9\u6837\u89c4\u5f8b\u5c31\u6bd4\u8f83\u660e\u663e\u4e86\uff1a**\u6bcf\u4e2a$g(i)$\u90fd\u73c2\u4ee5\u7531$g(k)(i<k\\le n)$\u4fee\u6539\u5bf9\u5e94\u4f4d\u7f6e\u7684\u4e58\u53f7\uff0c\u5f97\u5230$2$\u4e2a$g(i)$\u3002**\n\n\u5b9a\u4e49\u51fd\u6570$f(i)=\\begin{cases}1&i=1\\\\\\sum\\limits_{j=1}^{i-1}f(j)*2&i>1\\end{cases}$\n\n\u7b54\u6848\u5c31\u662f $ans=\\sum\\limits_{i=1}^{i\\le n}g(i)*f(n-i+1)$\n\n~~\uff08\u5176\u5b9e\u8fd9\u4e2a\u89c4\u5f8b\u5b8c\u5168\u53ef\u4ee5\u7206\u641c\u7528\u77aa\u773c\u6cd5\u5f97\u51fa\u6765\uff09~~\n\n$f(i)$\u548c$g(i)$\u73c2\u4ee5\u76f4\u63a5\u9884\u5904\u7406\u51fa\u6765\uff0c\u7136\u540e\u76f4\u63a5\u4e0a\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u6bcf\u4e2a\u8282\u70b9\u7ef4\u62a4\u6240\u4ee3\u8868\u533a\u95f4\u7684$\\sum\\limits_{i=l}^{r}g(i)*f(n-i+1)$\u3002\n\n\u5bf9\u4e8e\u4fee\u6539\uff1a\u6bd4\u5982\u8fd8\u662f\u90a3\u4e94\u4e2a\u6570\uff0c\u8981\u4fee\u6539\u7b2c\u4e09\u4e2a\u6570$c$\u4e3a$k$\u3002\u7c7b\u4f3c\u4e8e\u524d\u7f00\u548c\uff0c\u5355\u70b9\u4fee\u6539\u5f71\u54cd\u7684\u662f$g(3),g(4),g(5)$\uff0c\u4e5f\u5c31\u662f\u8981\u628a\n\n$f(3)*a*b*c+f(2)*a*b*c*d+f(1)*a*b*c*d*e$\n\n\u4fee\u6539\u4e3a\n\n$f(3)*a*b*k+f(2)*a*b*k*d+f(1)*a*b*k*d*e$\n\n\u5c31\u73c2\u4ee5\u628a\u539f\u5f0f\u4e58\u4e0a$\\frac{k}{c}$\u3002\u6709\u9664\u6cd5\u8fd8\u8981\u53d6\u6a21\u663e\u7136\u8981\u7528\u5230\u4e58\u6cd5\u9006\u5143\uff0c\u5373\u4e3a\u628a\u5e26\u4fee\u70b9\u5230$n$\u7684\u533a\u95f4\u4e58\u4e0a$k*inv(c)$\uff0c\u5c31\u662f\u4e2a\u7ebf\u6bb5\u6811\u533a\u95f4\u4e58\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\n#include <cstring>\n\n#define maxn 100005\n#define inf 0x3f3f3f3f\n\nconst long long mod = 1000000007;\n\nusing namespace std;\n\ninline int read(){\n\tint x=0,y=0;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')y=1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn y?-x:x;\n}\ntemplate<typename T>\ninline T read(){\n\tT x=0;\n\tint y=0;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')y=1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn y?-x:x;\n}\nint n,a[maxn];\nlong long f[maxn],g[maxn],inv[maxn]={0,1};\nstruct Segment_Tree{\n\tlong long dat[maxn<<2],tag[maxn<<2];\n#define ls(x) (x<<1)\n#define rs(x) (x<<1|1)\n\tinline void update(int node){\n\t\tdat[node]=(dat[ls(node)]+dat[rs(node)])%mod;\n\t}\n\tinline void datadown(int node,long long d){\n\t\t(dat[node]*=d)%=mod;\n\t\t(tag[node]*=d)%=mod;\n\t}\n\tinline void pushdown(int node){\n\t\tdatadown(ls(node),tag[node]);\n\t\tdatadown(rs(node),tag[node]);\n\t\ttag[node]=1;\n\t}\n\tvoid build(int l,int r,int node){\n\t\ttag[node]=1;\n\t\tif(l==r){\n\t\t\tdat[node]=g[l]*f[n-l+1]%mod;\n\t\t\treturn;\n\t\t}\n\t\tint mid=l+r>>1;\n\t\tbuild(l,mid,ls(node));\n\t\tbuild(mid+1,r,rs(node));\n\t\tupdate(node);\n\t}\n\tvoid add(int L,int R,int l,int r,int node,long long d){\n\t\tif(L<=l&&R>=r){\n\t\t\tdatadown(node,d);\n\t\t\treturn;\n\t\t}\n\t\tif(tag[node]!=1)pushdown(node);\n\t\tint mid=l+r>>1;\n\t\tif(L<=mid)add(L,R,l,mid,ls(node),d);\n\t\tif(R>mid)add(L,R,mid+1,r,rs(node),d);\n\t\tupdate(node);\n\t}\n}st;\nint main(){\n\tfor(register int i=2;i<=10000;++i)\n\t\tinv[i]=1ll*(mod-mod/i)*inv[mod%i]%mod;//\u6570\u636e\u8303\u56f4\u662f\u5141\u8bb8\u9884\u5904\u7406\u51fa\u9006\u5143\u7684\n\tn=read();\n    int m=read();\n\tlong long sum=1;\n\tf[1]=1,g[0]=1;\n\tfor(register int i=2;i<=n;++i)\n\t\tf[i]=(sum<<1)%mod,(sum+=f[i])%=mod;//\u9884\u5904\u7406f\u6570\u7ec4\n\tfor(register int i=1;i<=n;++i)\n\t\ta[i]=read(),g[i]=g[i-1]*a[i]%mod;//\u9884\u5904\u7406\u524d\u7f00\u4e58\n\tst.build(1,n,1);\n\twhile(m--){\n\t\tint x=read(),d=read();\n\t\tst.add(x,n,1,n,1,1ll*d*inv[a[x]]%mod);\n\t\tprintf(\"%lld\\n\",st.dat[1]);\n\t\ta[x]=d;\n\t}\n}\n\n```\n\n",
        "postTime": 1552459154,
        "uid": 111762,
        "name": "_ctz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4340 \u3010[SHOI2016]\u968f\u673a\u5e8f\u5217\u3011"
    }
]