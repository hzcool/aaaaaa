[
    {
        "content": "### \u9898\u76ee\u63cf\u8ff0:\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a_i$\u3002\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u5e8f\u5217\u7684\u5212\u5206\u662f\u5c06\u4e00\u4e2a\u5e8f\u5217\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u533a\u95f4\uff0c\u8fd9 \u4e9b\u533a\u95f4\u4f9d\u6b21\u8fde\u63a5\u8d77\u6765\u5c31\u53ef\u4ee5\u8fd8\u539f\u6574\u4e2a\u5e8f\u5217\u3002\u4f8b\u5982\uff1a\u533a\u95f4 [1 3]\\[1 4][3 6] \u5c31\u662f\u5e8f\u5217 1 3 1 4 3 6 \u7684\u4e00\u4e2a \u5408\u6cd5\u5212\u5206\u3002\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u533a\u95f4\u7684\u6743\u503c\u4e3a**\u533a\u95f4\u5185\u7684\u6700\u5927\u503c\u51cf\u53bb\u533a\u95f4\u5185\u7684\u6700\u5c0f\u503c\u3002\u5b9a\u4e49\u5728\u8fd9\u4e2a\u533a\u95f4\u5212\u5206\u4e0b\uff0c\u5e8f\u5217\u7684\u6743\u503c\u4e3a\u5404\u4e2a\u533a\u95f4\u7684\u6743\u503c\u7684\u548c\u3002**\n\n\u4f8b\u5982\uff1a\u5728\u533a\u95f4\u5212\u5206 [1 3]\\[1 4][3 6] \u7684\u60c5\u51b5\u4e0b\uff0c\u5e8f\u5217\u7684\u6743\u503c\u4e3a $(3-1)+(4-1)+(6-3)=9$\u3002 \n\n\u4f60\u7684\u4efb\u52a1\u662f\uff1a\u6c42\u51fa\u5e8f\u5217 $a_i$ \u6743\u503c\u6700\u5927\u7684\u533a\u95f4\u5212\u5206\u6240\u5bf9\u5e94\u7684\u5e8f\u5217\u6743\u503c\u3002 \n\n\u9700\u8981\u652f\u6301 $q$ \u6b21\u4fee\u6539\u64cd\u4f5c\uff0c\u4fee\u6539\u64cd\u4f5c\u5f62\u5f0f\u5982\u4e0b:\u5c06\u4e0b\u6807\u533a\u95f4 [ $l,r$ ] \u4e2d\u7684 $a_i$ \u52a0\u4e0a $x$ \u3002\u4f60\u9700\u8981\u5728\u6bcf\u4e00\u6b21\u4fee\u6539\u64cd\u4f5c\u4e4b\u540e\uff0c\u8f93\u51fa\u65b0\u7684\u5e8f\u5217\u7684\u6743\u503c\u6700\u5927\u7684\u533a\u95f4\u5212\u5206\u6240\u5bf9\u5e94\u7684\u6743\u503c\u3002\n\n### \u8f93\u5165\u63cf\u8ff0:\n\n\u8f93\u5165\u7684\u7b2c\u4e00\u884c\u5305\u62ec\u4e24\u4e2a\u6574\u6570 $n$ \u548c $q(1\\leq n,q\\leq 2\\times10^5)$\uff0c\u5206\u522b\u8868\u793a\u5e8f\u5217\u7684\u957f\u5ea6\u5df2\u7ecf\u66f4\u65b0\u64cd\u4f5c\u7684\u6b21\u6570\u3002 \u7b2c\u4e8c\u884c\u5305\u542b $n$ \u4e2a\u6574\u6570 $a_i(-10^8\\leq a_i\\leq 10^8)$\uff0c\u8868\u793a\u5e8f\u5217\u7684\u521d\u503c $a_i$\u3002 \u63a5\u4e0b\u6765\u7684 $q$ \u884c\uff0c\u6bcf\u884c\u5305\u62ec\u4e09\u4e2a\u6574\u6570 $l,r(1\\leq l\\leq r\\leq n)$ \u548c $x(-10^8\\leq x\\leq 10^8)$\uff0c\u63cf\u8ff0\u4e00\u4e2a\u4fee\u6539\u64cd\u4f5c\u3002\n\n### \u8f93\u51fa\u63cf\u8ff0:\n\n\u8f93\u51fa $q$ \u884c\uff0c\u6bcf\u884c\u4e00\u4e2a\u6574\u6570\uff0c\u8868\u793a\u6bcf\u4e00\u6b21\u66f4\u65b0\u64cd\u4f5c\u4e4b\u540e\u5e8f\u5217\u6700\u5927\u7684\u53ef\u80fd\u7684\u533a\u95f4\u5212\u5206\u7684\u6743\u503c\u3002\n\n### \u5206\u6790:\n\n#### 30pts:\n\n\u4ee4 $dp_i$ \u4e3a\u5bf9\u4e8e\u524d $i$ \u4e2a\u6570\u636e\u7684\u533a\u95f4\u80fd\u53d6\u5230\u7684\u6700\u5927\u6743\u503c\uff0c\u5219 $dp_{i+j}=dp_i+a_{max}-a_{min}$\u3002\n\n\u800c\u5bf9\u4e8e\u533a\u95f4\u4fee\u6539\uff0cfor\u5faa\u73af\u4e00\u4e2a\u4e00\u4e2a\u5730\u52a0\u5c31\u884c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u53ea\u6709 $O(qn)$\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(qn^2)$\u3002\n\n#### 60pts:\t\n\n\u6700\u77ed\u8def\u4f18\u5316\uff0c\u5c06\u975e\u5355\u8c03\u533a\u95f4\u62c6\u5206\u6210\u82e5\u5e72\u4e2a\u5355\u8c03\u533a\u95f4\uff0c\u4f7f\u5f97\u6700\u7ec8\u7b54\u6848\u4e00\u5b9a\u4e0d\u52a3\u3002\n\n\u4ee4 $d_i$ \u4e3a $a_i$ \u4e0e $a_{i-1}$ \u7684\u5dee\u503c\uff0c\u5219 $d_i=a_i-a_{i-1}\\ \\&\\ d_1=0$\u3002\n\n\u82e5\u5bf9\u4e8e\u533a\u95f4 $[l,r]$\uff0c\u4f7f\u5f97 $d_{l+1},d_{l+2},...,d_r$ \u7684\u7b26\u53f7\u4e00\u5b9a\u662f\u4e00\u6837\u7684\uff0c\u5219\u5f53\u524d\u533a\u95f4 $[l,r]$ \u6240\u80fd\u63d0\u4f9b\u7684\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a $\\sum_{l+1}^r|d_i|$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(qn)$\u3002\n\n#### 100pts:\n\n\u5f15\u5165\u7ebf\u6bb5\u6811\u8fdb\u884c\u7ef4\u62a4\uff0c\u8bb0\u5f55\u7ebf\u6bb5\u6811\u8282\u70b9 $T[x][0/1][0/1]$\uff0c\u8868\u793a\u7ebf\u6bb5\u6811\u8282\u70b9\u4e3a$x$\u6240\u4ee3\u8868\u7684\u533a\u95f4\u80fd\u53d6\u5230\u7684\u533a\u95f4\u6700\u503c\u3002\n\n\u540e\u9762\u7684\u4e24\u4e2a 0/1 \u5206\u522b\u8868\u793a\u5de6\u7aef\u70b9\u7684 $d_i$ \u53d6\u8fd8\u662f\u4e0d\u53d6\uff0c\u4ee5\u53ca\u53f3\u7aef\u70b9 $d_i$ \u53d6\u8fd8\u662f\u4e0d\u53d6\u3002\n\n\u4fee\u6539\u65f6\u53ea\u9700\u8981\u4fee\u6539\u6240\u9700\u8981\u4fee\u6539\u7684\u533a\u95f4\u7684\u5de6\u7aef\u70b9\u4ee5\u53ca\u53f3\u7aef\u70b9\u7136\u540e\u66f4\u65b0\u5230\u7ebf\u6bb5\u6811\u4e0a\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(q\\log_2n)$\u3002\n\n### \u4ee3\u7801:\n\n```C++\n#include<bits/stdc++.h>\n#define van long long\n#define N 1000100\nusing namespace std;\nvan n,a[N],q,d[N];\nvan t[N*4][2][2];//\u7ebf\u6bb5\u6811\nvoid update(van p,van num)\n{\n\tfor (int i=0;i<2;i++) for (int j=0;j<2;j++)\n\t{\n\t\tt[p][i][j]=-1e18;\n\t\tfor (int k=0;k<2;k++) for (int l=0;l<2;l++) if (l!=1||k!=1||d[num]*d[num+1]>=0) t[p][i][j]=max(t[p][i][j],t[p*2][i][k]+t[p*2+1][l][j]);\n\t}\n}//\u66f4\u65b0\u7ebf\u6bb5\u6811p\u8282\u70b9\u4e0a\u7684\u503c\nvoid add(van p,van l,van r,van where)\n{\n\tif (l==r)\n\t{\n//\t\tcout<<\"add \"<<l<<\" \"<<d[l]<<endl;\n\t\tt[p][1][1]=abs(d[l]);\n\t\treturn;\n\t}\n\tvan mid=l+r>>1;\n\tif (where<=mid) add(p*2,l,mid,where);\n\tif (where>mid) add(p*2+1,mid+1,r,where);\n\tupdate(p,mid);\n}//\u66f4\u65b0\u7ebf\u6bb5\u6811(\u5355\u70b9\u4fee\u6539)\nvan query(van x)\n{\n\treturn max(t[x][0][0],max(t[x][0][1],max(t[x][1][0],t[x][1][1])));\n}//\u67e5\u8be2\u7ebf\u6bb5\u6811\u4e0ax\u8282\u70b9\u7684\u6700\u5927\u503c\nint main()\n{\n//\tifstream ywhin(\"sjeckanje.in\");\n//\tofstream ywhout(\"sjeckanje.out\");\n\t#define ywhin cin\n\t#define ywhout cout\n\tywhin>>n>>q;\n\tfor (int i=1;i<=n;i++) ywhin>>a[i];\n\tfor (int i=1;i<=n;i++) d[i]=i==1?0:a[i]-a[i-1],add(1,1,n,i);//\u5dee\u5206\u5e76\u63d2\u5165\u7ebf\u6bb5\u6811\u4e0a\n\twhile (q--)\n\t{\n\t\tvan l,r,k;\n\t\tywhin>>l>>r>>k;\n\t\tif (l!=1)\n\t\t{\n\t\t\td[l]+=k;\n\t\t\tadd(1,1,n,l);\n\t\t}//\u6dfb\u52a0\u5de6\u7aef\u70b9\n\t\tif (r!=n)\n\t\t{\n\t\t\td[r+1]-=k;\n\t\t\tadd(1,1,n,r+1);\n\t\t}//\u6dfb\u52a0\u53f3\u7aef\u70b9\n\t\tcout<<query(1)<<endl;//\u67e5\u8be2[1,n]\u7684\u533a\u95f4\u6700\u503c\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1629621472,
        "uid": 185758,
        "name": "LittleYang0531",
        "ccfLevel": 7,
        "title": "[COCI2020-2021#5] Sjeckanje \u9898\u89e3"
    },
    {
        "content": "# \u524d\u8a00\n\n\u7ffb\u9898\u5355\u7684\u65f6\u5019\u7a81\u7136\u53d1\u73b0\u5fd8\u8bb0\u5199\u8fd9\u9053\u9898\u9898\u89e3\u4e86\u3002\uff08\u4e0d\u662f\n\n# \u6b63\u6587\n\n\u7eaf\u66b4\u529b\u80af\u5b9a\u4e0d\u884c\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u6211\u4eec\u53d1\u73b0\u4e00\u4e2a\u6027\u8d28\uff1a**\u6700\u4f18\u5212\u5206\u4e00\u5b9a\u80fd\u5c06\u539f\u6570\u7ec4\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u5355\u8c03\u5e8f\u5217\u3002**\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u8003\u8651\u4e00\u76f4\u5206\u5272\u3002\u8fd9\u6837\u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u88c2\u5f00\u5462\uff1f\n\n\u4e0b\u9762\u5bf9\u4e00\u7ec4\u6837\u4f8b\u8fdb\u884c\u89e3\u91ca\uff1a$[1, 3, 2, 4, 5, 7, 6]$\n\n\u5206\u5272\u4e4b\u540e\uff1a$[1, 3] [2, 4, 5, 7] [6]$\n\n\u5219\u7b54\u6848\u4e3a $2 + 5 + 0 = 7$.\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c\u4e0d\u662f\u5355\u8c03\u5e8f\u5217\uff0c\u90a3\u4e48\u6709\u4e9b\u90e8\u5206\u7684\u4ef7\u503c\u5c31\u88ab\u57cb\u6ca1\u4e86\u3002\n\n\u6bd4\u5982 $[1, 3, 2, 4, 5, 7]$, \u5982\u679c\u4f60\u5206\u6210 $[1, 3, 2] [4, 5, 7]$, \u90a3\u4e48\u663e\u7136 $2, 4$ \u662f\u5355\u72ec\u53ef\u4ee5\u521b\u9020\u4ef7\u503c\u7684\u3002\n\n\u6570\u5b66\u8868\u793a\uff08~~\u968f\u4fbf\u778e\u5199\u7684~~\uff09\uff1a\n$$\n\\forall 1 \\le i < k < j \\le N, s.t. \\max_{x = i}^{k}{a_x} - \\min_{x = i}^{k}{a_x} + \\max_{x = k + 1}^{j}{a_x} - \\min_{x = k + 1}^{j}{a_x} > \\max_{x = i}^{j}{a_x} - \\min_{x = i}^{j}{a_x}\n$$\n\u90a3\u4e48\u5c31\u77e5\u9053\u7b56\u7565\u4e86\u3002\u6211\u4eec\u4f7f\u7528\u5dee\u5206\u3002\n\n\u4ee4 $d_i = a_i - a_{i - 1}$, \u82e5\u6709\u533a\u95f4 $[l, r]$, \u4f7f\u5f97 $d_l, d_{l + 1}, \\cdots, d_{r - 1}, d_{r}$ \u7686\u4e3a\u540c\u53f7\uff08\u5b9a\u4e49 $0$ \u4e0e\u4efb\u4f55\u5b9e\u6570\u540c\u53f7\uff09\uff0c\u5219\u8fd9\u4e2a\u5e8f\u5217\u4e00\u5b9a\u5355\u8c03\u3002\u5219\u5b83\u7684\u8d21\u732e\u4e3a\uff1a\n$$\n\\sum_{i = l}^r{|d_i|}\n$$\n\u90a3\u4e48\u4fee\u6539\u7684\u65f6\u5019\u53ea\u9700\u7ef4\u62a4\u5dee\u5206\u6570\u7ec4 $d$ \u5373\u53ef\u3002\n\n\u7136\u9e45\u53d1\u73b0\u590d\u6742\u5ea6\u662f $\\mathcal{O}(QN)$, \u8fd8\u662f\u8fc7\u4e0d\u4e86......\n\n\u8003\u8651\u7ebf\u6bb5\u6811\u4f18\u5316\uff1a\u8bbe $SegmentTree_{p, i_1, i_2} (i_1,i_2 \\in S(0, 1))$ \u8868\u793a\u7f16\u53f7\u4e3a $p$ \u7684\u8282\u70b9\u6240\u5bf9\u5e94\u7684\u533a\u95f4 $[l, r]$ \u7684\u5de6\u53f3\u7aef\u70b9\u662f\u5426\u80fd\u53d6\u5230\u65f6\u7684 $\\sum_{i = l}^r{|d_i|}$.\n\n\u7136\u540e\u4fee\u6539\u7684\u65f6\u5019\u53ea\u9700\u8981\u628a\u5de6\u7aef\u70b9\u6216\u8005\u53f3\u7aef\u70b9\u7684 $d_i$ \u66f4\u65b0\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $\\mathcal{O}(Q \\log_2 N)$, \u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\n# \u4ee3\u7801\n\n\u534a\u5e74\u4e4b\u524d\u7684\u4ee3\u7801\uff0c\u6709\u70b9\u4e11\u3002\n\n~~\u4f60\u4eec\u6700\u60f3\u8981\u7684..~~ \n\nTalk is$\\color{white}\\text{n't}$ cheap, $\\color{white}\\text{Don't}$ show me the code...\n\n``` cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nint N, Q;\nlong long arr[200005];\nlong long seg[800005][2][2];\nlong long dis[200005];\n\nvoid merge(int mid, int p);\nvoid insert(int i, int now_l, int now_r, int p);\nlong long getans(int p);\n\nint main()\n{\n\tcin >> N >> Q;\n\tfor(int i = 1; i <= N; ++ i)\n\t\tcin >> arr[i];\n\t\n\tfor(int i = 1; i <= N; ++ i)\n\t{\n\t\tif(i != 1)\n\t\t{\n\t\t\tdis[i] = arr[i] - arr[i - 1];\n\t\t\tinsert(i, 1, N, 1);\n\t\t}\n\t}\n\t\n\tfor(int i = 1; i <= Q; ++ i)\n\t{\n\t\tint l, r, x;\n\t\tcin >> l >> r >> x;\n\t\tif(l != 1)\n\t\t{\n\t\t\tdis[l] += x;\n\t\t\tinsert(l, 1, N, 1);\n\t\t}\n\t\n\t\tif(r != N)\n\t\t{\n\t\t\tdis[r + 1] -= x;\n\t\t\tinsert(r + 1, 1, N, 1);\n\t\t}\n\t\n\t\tcout << getans(1) << endl;\n\t}\n    \n\treturn 0;\n}\n\nvoid merge(int mid, int p)\n{\n\tfor(int i1 = 0; i1 <= 1; ++ i1)\n\t{\n\t\tfor(int i2 = 0; i2 <= 1; ++ i2)\n\t\t{\n\t\t\tseg[p][i1][i2] = -1919810;\n\t\t\tfor(int i3 = 0; i3 <= 1; ++ i3)\n\t\t\t{\n\t\t\t\tfor(int i4 = 0; i4 <= 1; ++ i4)\n\t\t\t\t{\n\t\t\t\t\tif(i3 != 1 || i4 != 1 || dis[mid] * dis[mid + 1] >= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tseg[p][i1][i2] = max(seg[p][i1][i2], seg[p << 1][i1][i3] + seg[(p << 1) | 1][i4][i2]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid insert(int i, int now_l, int now_r, int p)\n{\n\tif(now_l == now_r)\n\t{\n\t\tseg[p][1][1] = abs(dis[i]);\n\t\treturn;\n\t}\n\t\n\tint mid = (now_l + now_r) >> 1;\n\tif(i <= mid) \n\t\tinsert(i, now_l, mid, p << 1);\n        \n\tif(i >= mid + 1) \n   \t\tinsert(i, mid + 1, now_r, (p << 1) | 1);\n        \n\tmerge(mid, p);\n}\n\nlong long getans(int p)\n{\n\treturn max(max(seg[p][0][0], seg[p][0][1]), max(seg[p][1][0], seg[p][1][1]));\n}\n```\n# \u540e\u8a00\n\n\u4f5c\u4e3a\u7ebf\u6bb5\u6811\u7eff\u9898\uff0c\u96c0\u98df\u6709\u96be\u5ea6\u3002",
        "postTime": 1652354621,
        "uid": 224558,
        "name": "JackMerryYoung",
        "ccfLevel": 5,
        "title": "P7402 [COCI2020-2021#5] Sjeckanje \u9898\u89e3"
    }
]