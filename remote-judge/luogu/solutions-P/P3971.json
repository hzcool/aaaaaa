[
    {
        "content": "\u539f\u5e8f\u5217\u4e3a$x$\uff0c\u8f93\u5165\u7684\u5e8f\u5217\u4e3a$a$\u3002  \n\u56e0\u4e3a\u9898\u76ee\u4e2d\u662f**\u4e0a\u5347\u5b50\u5e8f\u5217**\u548c**\u4e0b\u964d\u5b50\u5e8f\u5217**\uff0c\u6240\u4ee5\u539f\u5e8f\u5217\u4e2d\u76f8\u540c\u7684\u5143\u7d20\u6ca1\u6709\u8d21\u732e\uff0c\u56e0\u6b64\u4e0d\u59a8\u8bbe$x$\u4e3a$1$~$n$\u7684\u4e00\u4e2a\u6392\u5217  \n$a_i$\u662f\u4ee5$x_i$\u4e3a\u7ed3\u5c3e\u7684\u6700\u957f\u4e0a\u5347\u5b50\u5e8f\u5217\u7684\u957f\u5ea6\uff0c\u6240\u4ee5\u5bf9\u4e8e\u6240\u6709\u7684$a_k = a_i - 1$\uff0c\u4e00\u5b9a\u5b58\u5728\u81f3\u5c11\u4e00\u4e2a$k$\u4f7f$x_k < x_i$  \n\u5982\u679c\u8981\u4f7fBob\u5f97\u5206\u5c3d\u91cf\u9ad8\uff0c\u53ef\u4ee5\u8d2a\u5fc3\u7684\u4f7f$a_i$\u8f83\u5927\u7684$x_i$\u5c3d\u91cf\u5c0f\uff0c$a_i$\u76f8\u540c\u7684\u4f7f$i$\u8f83\u5927\u7684$x_i$\uff08\u5373\u76f8\u5bf9\u9760\u540e\u7684\u5143\u7d20\uff09\u5c3d\u91cf\u5c0f\n\n\u8003\u8651\u5982\u4f55\u6784\u9020\u51fa\u7b26\u5408\u4e0a\u8ff0\u6761\u4ef6\u7684$x$  \n\u5bf9\u4e8e$i$\uff0c\u6211\u4eec\u53ef\u4ee5\u5411\u79bb\u5b83\u6700\u8fd1\u7684\u6ee1\u8db3$a_k = a_i-1$\u7684$k$\u8fde\u4e00\u6761\u8fb9\uff0c\u8fd9\u6837\u53ef\u4ee5\u6784\u9020\u51fa\u4e00\u68f5\u6811\uff08\u4ee5$0$\u4e3a\u6839\uff09  \n\u6211\u4eec\u76f4\u63a5\u5bf9\u8fd9\u68f5\u6811\u6c42\u51fa\u5b83\u7684dfs\u5e8f\u6570\u7ec4$dfn$\uff0c\u5219$dfn$\u5c31\u662f\u4e00\u4e2a\u6ee1\u8db3\u4e0a\u8ff0\u6761\u4ef6\u7684\u5e8f\u5217  \n\u56e0\u4e3a\u524d\u5411\u661f\u6709\u4e00\u4e2a\u7279\u6b8a\u7684\u6027\u8d28\uff1a\u665a\u8fde\u4e0a\u7684\u8fb9\u4f1a\u88ab\u5148\u904d\u5386\u5230\u3002\u540c\u65f6\u56e0\u4e3adfs\u5148\u5e8f\u904d\u5386\u7684\u7279\u6027\uff08\u8282\u70b9\u7684dfs\u5e8f\u5c0f\u4e8e\u5b83\u7684\u5b50\u6811\u4e2d\u4efb\u610f\u70b9\u7684dfs\u5e8f\uff09\uff0c\u6c42\u51fa\u6765\u7684$dfn$\u4e00\u5b9a\u662f\u6ee1\u8db3\u4e0a\u8ff0\u6240\u6709\u6761\u4ef6\u7684\n\n$0$\u662f\u865a\u6839\uff0c\u53ef\u4ee5\u65b9\u4fbf\u6211\u4eec\u904d\u5386\uff0c\u4e0d\u8fc7\u5b83\u4f1a\u4f7f$x_i$\u5168\u90fd\u52a0$1$\uff0c\u4f46\u8fd9\u6837\u663e\u7136\u4e0d\u4f1a\u5bf9\u7b54\u6848\u9020\u6210\u5f71\u54cd\n\n\u6700\u540e\u5bf9$dfn$\u6570\u7ec4\u7edf\u8ba1\u7b54\u6848\u5c31\u53ef\u4ee5\u4e86\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n#define LL long long\nusing namespace std;\nLL read() {\n\tLL k = 0, f = 1; char c = getchar();\n\twhile(c < '0' || c > '9') {\n\t\tif(c == '-') f = -1;\n\t\tc = getchar();\n\t}\n\twhile(c >= '0' && c <= '9')\n\t\tk = k * 10 + c - 48, c = getchar();\n\treturn k * f;\n}\nstruct zzz {\n\tint t, nex;\n}e[100010 << 1]; int head[100010], tot;\ninline void add(int x, int y) {\n\te[++tot].t = y;\n\te[tot].nex = head[x];\n\thead[x] = tot;\n}\nint a[100010], b[100010], dfn[100010], cnt, num;\nvoid dfs(int x, int fa) {\n\tdfn[x] = ++cnt;\n\tfor(int i = head[x]; i; i = e[i].nex) {\n\t\tif(e[i].t == fa) continue;\n\t\tdfs(e[i].t, x);\n\t}\n}\nint main() {\n\tint n = read();\n\tfor(int i = 1; i <= n; ++i) {\n\t\tint x = read();\n\t\tadd(a[x-1], i); add(i, a[x-1]); a[x] = i;\n\t}\n\tdfs(0, 0); LL ans = 0;\n\tfor(int i = n; i >= 1; --i) {\n\t\tint pos = 0;\n\t\tif(dfn[i] > b[num]) b[++num] = dfn[i], pos = num;\n\t\telse pos = upper_bound(b+1, b+num+1, dfn[i]) - b;\n\t\tb[pos] = min(b[pos], dfn[i]);\n\t\tans += (LL)pos;\n\t}\n\tcout << ans << endl;\n\treturn 0;\n}\n```",
        "postTime": 1571712146,
        "uid": 34188,
        "name": "MorsLin",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3971 \u3010[TJOI2014]Alice and Bob\u3011"
    },
    {
        "content": "[Mychael\u7684\u65e0\u58f0\u4e50\u7ae0](https://i.cnblogs.com/EditPosts.aspx?postid=9035227)\n\n\u9898\u4e2d\u6240\u7ed9\u7684\u6700\u957f\u4e0a\u5347\u5b50\u5e8f\u5217\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u9650\u5236\u6761\u4ef6\n\u6211\u4eec\u8981\u6784\u9020\u51fa\u6700\u5927\u7684\u4ee5$i$\u5f00\u5934\u7684\u6700\u957f\u4e0b\u964d\u5b50\u5e8f\u5217\uff0c\u5c31\u9700\u8981\u7f16\u53f7\u5927\u7684\u70b9\u7684\u6743\u503c\u5c3d\u91cf\u5c0f\n\n\u76f8\u540c\u65f6\u5f53\u7136\u5c31\u6ca1\u6709\u8d21\u732e\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u59a8\u4ee4\u6743\u503c\u4e3a\u4e00\u4e2a$1$\u5230$n$\u7684\u6392\u5217\n\n\u8003\u8651\u5982\u4f55\u6ee1\u8db3\u9650\u5236\u6761\u4ef6\n\n\u5bf9\u4e8e\u6240\u6709$a[i] = v$\u7684\u70b9\uff0c\u70b9\u4e0e\u70b9\u4e4b\u95f4\u4e00\u5b9a\u662f\u5355\u8c03\u4e0b\u964d\u7684\uff0c\u8fde\u6709\u5411\u8fb9\n\n\u5bf9\u4e8e\u4f4d\u7f6e$i$\uff0c\u5982\u679c$a[i] = v$\uff0c\u90a3\u4e48$i$\u81f3\u5c11\u8981\u6bd4\u4e0a\u4e00\u4e2a$a[j] = v - 1$\u7684\u4f4d\u7f6e\u5927\uff0c\u8fde\u6709\u5411\u8fb9\n\n\u7136\u540e\u7528\u5927\u9876\u5806\u62d3\u6251\u6392\u5e8f\u5373\u53ef\u5f97\u5230\u6bcf\u4e2a\u70b9\u6700\u4f18\u7684\u6743\u503c\n$O(nlogn)$\u6c42\u4e00\u904d\u6700\u957f\u4e0b\u964d\u5b50\u5e8f\u5217\u957f\u5ea6\u5373\u53ef\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<queue>\n#include<cstring>\n#include<algorithm>\n#define LL long long int\n#define Redge(u) for (int k = h[u],to; k; k = ed[k].nxt)\n#define REP(i,n) for (int i = 1; i <= (n); i++)\n#define cls(s) memset(s,0x3f3f3f3f,sizeof(s))\nusing namespace std;\nconst int maxn = 100005,maxm = 100005,INF = 1000000000;\ninline int read(){\n\tint out = 0,flag = 1; char c = getchar();\n\twhile (c < 48 || c > 57){if (c == '-') flag = -1; c = getchar();}\n\twhile (c >= 48 && c <= 57){out = (out << 3) + (out << 1) + c - 48; c = getchar();}\n\treturn out * flag;\n}\nint h[maxn],ne = 2,de[maxn];\nstruct EDGE{int to,nxt;}ed[maxn << 1];\ninline void build(int u,int v){\n\ted[ne] = (EDGE){v,h[u]}; h[u] = ne++;\n\tde[v]++;\n}\nint last[maxn],n,a[maxn],cnt,x[maxn],f[maxn],bac[maxn];\npriority_queue<int> q;\nvoid work(){\n\tREP(i,n) if (!de[i]) q.push(i);\n\tint u;\n\twhile (!q.empty()){\n\t\tu = q.top(); q.pop();\n\t\tx[u] = ++cnt;\n\t\tRedge(u) if (!(--de[to = ed[k].to])) q.push(to);\n\t}\n}\nint getn(int t){\n\tint l = 0,r = n,mid;\n\twhile (l < r){\n\t\tmid = (l + r + 1) >> 1;\n\t\tif (bac[mid] < t) l = mid;\n\t\telse r = mid - 1;\n\t}\n\treturn l;\n}\nvoid cal(){\n\tcls(bac); bac[0] = 0;\n\tfor (int i = n; i; i--){\n\t\tf[i] = getn(x[i]) + 1;\n\t\tbac[f[i]] = min(bac[f[i]],x[i]);\n\t}\n\tLL ans = 0;\n\tREP(i,n) ans += f[i];\n\tprintf(\"%lld\\n\",ans);\n}\nint main(){\n\tn = read();\n\tREP(i,n) a[i] = read();\n\tfor (int i = 1; i <= n; i++){\n\t\tif (a[i] > 1) build(last[a[i] - 1],i);\n\t\tif (last[a[i]]) build(i,last[a[i]]);\n\t\tlast[a[i]] = i;\n\t}\n\twork();\n\tcal();\n\treturn 0;\n}\n\n```",
        "postTime": 1526268581,
        "uid": 32842,
        "name": "Mychael",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P3971 \u3010[TJOI2014]Alice and Bob\u3011"
    },
    {
        "content": "\u5199\u5728\u6587\u7ae0\u524d\uff1a\u4f3c\u4e4e\u5927\u5bb6\u90fd\u5728\u7528 dfs\uff0c\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e2a\u4e0d\u540c\u7684\u2014\u2014\u62d3\u6251\u6392\u5e8f $+$ \u8d2a\u5fc3\n\n# \u9898\u76ee\u5927\u610f\uff1a\n\n\u7ed9\u51fa\u4e00\u4e2a\u5e8f\u5217\u7684\u4ee5\u6bcf\u4e00\u9879\u7ed3\u5c3e\u7684 LIS \u7684\u957f\u5ea6 $a$\uff0c\u6c42\u4e00\u4e2a\u5e8f\u5217\uff0c\u4f7f\u5f97\u4ee5\u6bcf\u4e00\u9879\u4e3a\u5f00\u5934\u7684\u6700\u957f\u4e0b\u964d\u5b50\u5e8f\u5217\u7684\u957f\u5ea6\u4e4b\u548c\u6700\u5927\u3002\n\n$n \\le 10^5$\u3002\n\n# \u601d\u8def\u5206\u6790\uff1a\n\n\u4e00\u4e2a\u7ed3\u8bba\uff1a\u6700\u4f18\u89e3\u4e00\u5b9a\u662f\u4e00\u4e2a\u6392\u5217\uff0c\u56e0\u4e3a\u5982\u679c\u4e24\u4e2a\u6570\u5b57\u7684\u5927\u5c0f\u76f8\u540c\uff0c\u5b8c\u5168\u53ef\u4ee5\u533a\u522b\u4ed6\u4eec\u7684\u5927\u5c0f\uff0c\u4ee5\u5f97\u5230\u66f4\u591a\u7684\u8d21\u732e\u3002\n\n\u8003\u8651\u7684 $a$ \u7ed9\u5b9a\u7684\u9650\u5236\uff0c\u663e\u7136\u5bf9\u4e8e\u6240\u6709\u7684\u76f8\u540c\u5927\u5c0f\u7684 $a$\uff0c\u524d\u4e00\u9879 $a_{p1}$ \u8981\u5927\u4e8e\u540e\u4e00\u9879 $a_{p2}$\uff0c\u5426\u5219\u4e00\u5b9a\u4f1a\u4ea7\u751f\u66f4\u957f\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\u3002\u8fde\u8fb9 $p1$ $\\rightarrow$ $p2$ \u8868\u793a $p2$ \u7684\u503c\u5c0f\u4e8e $p1$\u3002\n\n\u5bf9\u4e8e $i$\uff0c\u627e\u5230\u4e0a\u4e00\u6b21\u51fa\u73b0 $a[i]-1$ \u7684\u4f4d\u7f6e\uff0c\u5e76\u8fde\u8fb9 $ pos_{a[i]-1} $ $\\rightarrow$ $i$ \uff0c\u8868\u793a $i$ \u8981\u5927\u4e8e\u6b64\u4f4d\u7f6e\u7684\u503c\u3002\n\n\u7136\u540e\u8fdb\u884c\u8d2a\u5fc3\u7684\u64cd\u4f5c\uff0c\u6bcf\u6b21\u5728\u6240\u6709\u5165\u5ea6\u4e3a $0$ \u7684\u70b9\u4e2d\u9009\u62e9\u7f16\u53f7\u6700\u5927\u7684\u5e76\u8d4b\u4e0a\u6700\u5c0f\u7684\u6743\u503c\u3002\u786e\u5b9a\u6570\u503c\u4e4b\u540e\u4f9d\u6b21\u786e\u5b9a $b$ \u7684\u503c\u5c31\u597d\u4e86\u3002\n\n\u6b63\u786e\u6027\u663e\u7136\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u76f8\u540c\u7684 $a_x$ \u6765\u8bf4\u6211\u4eec\u4f1a\u4f18\u5148\u8003\u8651\u6700\u9760\u540e\u7684 $last$\uff0c\u540c\u65f6\u9760\u524d\u7684\u4e0d\u4f1a\u5411 $last$ \u540e\u8fb9\u8fde\u8fb9\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n \\log n)$\uff0c\u4e3b\u8981\u662f BIT \u7684\u590d\u6742\u5ea6\u3002\n\n\n# Code\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<cmath>\n#include<cctype>\n#include<queue>\n#include<vector>\nusing namespace std;\n#define fi first\n#define se second\n#define mp make_pair\n#define pb push_back\n#define rep(i,a,b) for(int i=a;i<=b;++i)\n#define go(u) for(int i=head[u],v=e[i].to;i;i=e[i].last,v=e[i].to)\ntypedef long long LL;\ntypedef pair<int,int> pii;\ninline int gi(){\n  int x=0,f=1;char ch=getchar();\n  while(!isdigit(ch)){if(ch=='-') f=-1;ch=getchar();}\n  while(isdigit(ch)){x=(x<<3)+(x<<1)+ch-48;ch=getchar();}\n  return x*f;\n}\ntemplate<typename T>inline bool Max(T &a,T b){return a<b?a=b,1:0;}\ntemplate<typename T>inline bool Min(T &a,T b){return a>b?a=b,1:0;}\nconst int N=1e5 + 7;\nint n,edc;\nint head[N],ind[N],lst[N],a[N],b[N],f[N];\nstruct edge{\n\tint last,to;\n\tedge(){}edge(int last,int to):last(last),to(to){}\n}e[N*2];\nvoid Add(int a,int b){\n\te[++edc]=edge(head[a],b),head[a]=edc;\n\t++ind[b];\n}\nint tr[N];\nint lowbit(int x){return x&-x;}\nvoid modify(int x,int y){for(int i=x;i<=n;i+=lowbit(i)) Max(tr[i],y);}\nint query(int x){int res=0;for(int i=x;i;i-=lowbit(i)) Max(res,tr[i]);return res;}\npriority_queue<int>Q;\nvoid topo(){\n\trep(i,1,n) if(!ind[i]) Q.push(i);int tmp=0;\n\twhile(!Q.empty()){\n\t\tint u=Q.top();Q.pop();\n\t\tb[u]=++tmp;\n\t\tgo(u)\n\t\t\tif(--ind[v]==0) Q.push(v);\n\t}\n}\nint main(){\n\tn=gi();\n\trep(i,1,n){\n\t\ta[i]=gi();\n\t\tif(lst[a[i]]) Add(i,lst[a[i]]);\n\t\tif(lst[a[i]-1]) Add(lst[a[i]-1],i);\n\t\tlst[a[i]]=i;\n\t}\n\ttopo();\n\tLL ans=0;\n\tfor(int i=n;i;--i){\n\t\tf[i]=query(b[i]-1)+1;\n\t\tmodify(b[i],f[i]);\n\t\tans+=f[i];\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n\n```\n",
        "postTime": 1645889825,
        "uid": 480516,
        "name": "xiaomimxl",
        "ccfLevel": 5,
        "title": "[TJOI2014]Alice and Bob"
    },
    {
        "content": "## Solution\n\n\u7531\u4e8e $x$ \u4e2d\u76f8\u540c\u7684\u5143\u7d20\u6ca1\u6709\u8d21\u732e\uff0c\u56e0\u6b64\u6211\u4eec\u94a6\u5b9a $x$ \u662f $1\\sim n$ \u7684\u6392\u5217\u3002\n\n\u9898\u76ee\u7ed9\u51fa\u4e86 $a$ \u5e8f\u5217\uff0c\u8981\u6700\u5927\u5316 $b$ \u5e8f\u5217\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6839\u636e $a$ \u5e8f\u5217\u6765\u7ea6\u675f $x$ \u5e8f\u5217\uff0c\u4ece\u800c\u5f97\u5230\u6700\u5927\u7684 $b$ \u5e8f\u5217\u3002\n\n\u5bf9\u4e8e $i<j$\uff0c\u5982\u679c $a_i\\ge a_j$\uff0c\u5219\u8bf4\u660e $x_i>x_j$\uff0c\u53cd\u4e4b\u5219\u53ef\u4ee5\u5c06 $x_j$ \u63a5\u5728 $x_i$ \u540e\u9762\u3002\n\n\u5982\u679c $a_i+1=a_j$\uff0c\u5219\u81f3\u5c11\u6709\u4e00\u4e2a $i$ \u6ee1\u8db3 $x_i<x_j$\u3002\n\n\u90a3\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u7528 $\\mathrm{dfs}$ \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a $a_i$\uff0c\u627e\u5230\u6700\u9760\u8fd1\u7684 $a_j$ \u6ee1\u8db3 $a_j+1=a_i$\uff0c\u8fde\u4e00\u6761 $(i,j)$ \u7684\u8fb9\u3002\n\n\u6ce8\u610f\u8981\u4f7f\u7528\u524d\u5411\u661f\uff0c\u56e0\u4e3a\u524d\u5411\u661f\u7684\u7279\u6027\u5c31\u662f**\u540e\u52a0\u5165\u7684\u8fb9\u5148\u904d\u5386**\u3002\n\n\u7136\u540e\u6c42\u51fa $\\mathrm{dfs}$ \u5e8f\uff0c\u53ef\u4ee5\u8bc1\u660e $\\mathrm{dfs}$ \u5e8f\u5c31\u662f $x$ \u5e8f\u5217\u3002\n\n\u6c42\u51fa $x$ \u5e8f\u5217\u540e\uff0c\u53ef\u4ee5\u7528 $\\mathcal O(n\\log n)$ \u6c42\u51fa $b$ \u5e8f\u5217\u3002\n\n## Code\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define N 100005\n#define ll long long\nusing namespace std;\nstruct node\n{\n    int to,next;\n}a[N<<1];\nint n,x,tot,cnt,len,t[N],head[N],dfn[N],b[N],c[N];\nll ans;\nvoid add(int x,int y)\n{\n    a[++tot].to=y;\n    a[tot].next=head[x];\n    head[x]=tot;\n}\nvoid dfs(int x,int fa)\n{\n    dfn[x]=++cnt;\n    for (int i=head[x];i!=-1;i=a[i].next)\n    {\n        int v=a[i].to;\n        if (v==fa) continue;\n        dfs(v,x);\n    }\n}\nint main()\n{\n    freopen(\"alice.in\",\"r\",stdin);\n    freopen(\"alice.out\",\"w\",stdout);\n    memset(head,-1,sizeof(head));\n    scanf(\"%d\",&n);\n    for (int i=1;i<=n;++i)\n    {\n        scanf(\"%d\",&x);\n        add(t[x-1],i);add(i,t[x-1]);\n        t[x]=i;\n    }\n    dfs(0,-1);\n    for (int i=1;i<=n;++i)\n        --dfn[i];\n    for (int i=1;i<=n;++i)\n        b[i]=dfn[n-i+1];\n    len=0;\n    for (int i=1;i<=n;++i)\n    {\n        int l=1,r=len,mid;\n        while (l<=r)\n        {\n            mid=(l+r)>>1;\n            if (b[i]>c[mid]) l=mid+1;\n            else r=mid-1;\n        }\n        len=max(len,l);\n        c[l]=b[i];\n        ans=ans+(ll)l;\n    }\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n```\n\n",
        "postTime": 1642251748,
        "uid": 166078,
        "name": "Thunder_S",
        "ccfLevel": 6,
        "title": "P3971 [TJOI2014]Alice and Bob"
    }
]