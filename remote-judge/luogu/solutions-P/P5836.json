[
    {
        "content": "# \u4e0d\u5f97\u4e0d\u8bf4\uff0c\u8fd9\u9898\u770b\u4e0a\u53bb\u5c31\u662f\u4e00\u9053\u88f8\u7684LCA...\n\u4f46\u662f\uff0c\u6211\u4eec\u8981\u8bb0\u4f4f\uff0cUSACO\u7684**silver**\u5e76\u4e0d\u96be\uff01\n\n\u4e8e\u662f\uff0c\u5c31\u51fa\u73b0\u4e86\uff08\u5e76\u67e5\u96c6\uff09\u8fd9\u4e2a\u4ee3\u7801\u96be\u5ea6\u6781\u5c0f\u7684\u505a\u6cd5\n\n\u8fd9\u4e00\u68f5\u6811\u53ea\u6709\u4e24\u79cd\u989c\u8272\uff0c\u6545\u6211\u4eec\u53ea\u8981\u8bb0\u5f55\u6811\u4e0a\u4e00\u4e2a\u4e2a\u989c\u8272\u76f8\u540c\u7684\u8fde\u901a\u5757\uff0c\u53ea\u6709\u5f53\u6240\u67e5\u8be2\u4e24\u70b9\u662f\u540c\u4e00\u8fde\u901a\u5757\u4e14\u8fde\u901a\u5757\u989c\u8272\u4e0e\u76ee\u6807\u989c\u8272\u4e0d\u540c\u65f6\u8f93\u51fa0\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint fa[100010],ans[100010],M,N;\nchar col[100010];\nint find(int x)\n{\n\tif(x==fa[x])\treturn x;\n\treturn fa[x]=find(fa[x]);\n}\nvoid merge(int x,int y)\n{\n\tfa[find(x)]=find(y);\n}\nint main()\n{\n\tint cnt=0;\n\tcin>>N>>M;\n\tfor(int i=1;i<=N;i++)\n\t{\n\t\tfa[i]=i;\n\t\tcin>>col[i];\n\t}\t\n\tfor(int i=1;i<=N-1;i++)\n\t{\n\t\tint u,v;cin>>u>>v;\n\t\tif(col[u]==col[v])\tmerge(u,v);\n\t}\n\tfor(int i=1;i<=M;i++)\n\t{\n\t\tint a,b;\tcin>>a>>b;\n\t\tchar c;\t\tcin>>c;\n\t\tif(find(a)==find(b)&&col[a]!=c)\t\tans[++cnt]=0;//\u5224\u65ad\u8def\u5f84\u4e0a\u662f\u5426\u6709\u504f\u597d\u7684\u725b\u5976\n\t\telse\tans[++cnt]=1;\n\t}\n\tfor(int i=1;i<=cnt;i++)\tcout<<ans[i];\n\treturn 0;\n}\n```\n\n\u542c\u5927\u4f6c\u8bf4\uff0c\u6709\u5229\u7528\u8fde\u901a\u5757\u7684O\uff08n\uff09\u505a\u6cd5\uff0c\u53ef\u4ee5\u7559\u7ed9\u5927\u5bb6\u81ea\u884c\u601d\u8003",
        "postTime": 1578150070,
        "uid": 105161,
        "name": "ycmir27",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5836 \u3010[USACO19DEC]Milk Visits(silver)\u3011"
    },
    {
        "content": "\u53ef\u4ee5\u7528\u7c7b\u4f3cLCA\u7684\u65b9\u6cd5\u6765\u505a\u8fd9\u4e00\u9898\n\n\u6211\u4eec\u5b9a\u4e49,$hv[x][i][1]$\u4e3a$x$\u8282\u70b9\u5411\u7236\u4eb2\u65b9\u5411\u8d70$2^i$\u6b65\u6240\u7ecf\u8fc7\u7684\u70b9\u662f\u5426\u542b\u6709'H'(\u5305\u62ec\u81ea\u5df1)\n\n\u7c7b\u4f3c\u5730,$hv[x][i][2]$\u4e3a$x$\u8282\u70b9\u5411\u7236\u4eb2\u65b9\u5411\u8d70$2^i$\u6b65\u6240\u7ecf\u8fc7\u7684\u70b9\u662f\u5426\u542b\u6709'G'(\u5305\u62ec\u81ea\u5df1)\n\n\u7279\u522b\u5730,\u5b9a\u4e49$hv[x][i][0]$\u4e3a$x$\u8282\u70b9\u5411\u7236\u4eb2\u65b9\u5411\u8d70$2^i$\u6b65\u6240\u7ecf\u8fc7\u5230\u7684\u70b9\n\n\u6240\u4ee5\u6211\u4eec\u5148\u500d\u589e\u6c42hv,\u518d\u60f3LCA\u90a3\u6837\u4e24\u4e2a\u70b9\u5411\u4e0a\u8df3,\u5982\u679c\u9047\u5230\u76f8\u5e94\u7684\u5976\u725b\u79cd\u7c7b\u5c31\u8fd4\u56de1\u5e76\u8f93\u51fa,\u76f4\u5230\u7ed3\u675f\u90fd\u6ca1\u6709\u5c31\u8fd4\u56de0\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(N~logN)$\n\n\u6bd4\u8f83\u591a\u7684\u7ec6\u8282\u53ef\u4ee5\u770b\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e5+5;\nint n,m,cow[N],dep[N],fa[N],ft[N],nx[2*N],to[2*N];//cow[i]\u4e3a\u5976\u725b\u79cd\u7c7b,dep\u4e3a\u70b9\u7684\u6df1\u5ea6,fa\u6211\u70b9\u7684\u7236\u4eb2,ft,nx,to\u8bb0\u5f55\u8def\u5f84\nint hv[N][21][3];//\u5b9a\u4e49\u5728\u4e0a\u9762\ninline int read()\n{\n    char c=getchar();int sum=0,f=1;\n    while(!(c>='0'&&c<='9')) {if(c=='-') f=-1;c=getchar();}\n    while(c>='0'&&c<='9') {sum=((sum<<1)+(sum<<3))+(c-'0');c=getchar();}\n    return sum*f;\n}\nint cnt;//\u8bb0\u5f55\u8def\u5f84\u6570,\u8f93\u5165\u7528\nvoid add(int x,int y)\n{\n\tnx[++cnt]=ft[x];\n\tft[x]=cnt;\n\tto[cnt]=y;\n}\nvoid dfs(int x,int d)\n{\n\tdep[x]=d;//\u8bb0\u5f55\u6df1\u5ea6\n\thv[x][0][0]=fa[x];//\u8df32^0\u6b65\u4e3a\u8df3\u5230\u7236\u8282\u70b9\n\thv[x][0][1]=(cow[x]==1)||(cow[fa[x]]==1);//\u81ea\u5df1\u4e0e\u7236\u8282\u70b9\u4e2d\u53ea\u8981\u6709\u4e00\u4e2a\u5305\u542bH\u5373\u4e3a1(\u8def\u5f84\u4e2d\u6709H)\n\thv[x][0][2]=(cow[x]==2)||(cow[fa[x]]==2);//\u540c\u4e0a\n\tfor(int i=1;(1<<i)<=dep[x];i++)//1<<i\u7b49\u540c\u4e8e2^i\n\t{\n\t\thv[x][i][0]=hv[hv[x][i-1][0]][i-1][0];//\u5411LCA\u90a3\u6837\u66f4\u65b0\n\t\thv[x][i][1]=(hv[x][i-1][1])||(hv[hv[x][i-1][0]][i-1][1]);//\u7c7b\u4f3c\u524d\u9762\n\t    hv[x][i][2]=(hv[x][i-1][2])||(hv[hv[x][i-1][0]][i-1][2]);//\u540c\u4e0a\n\t}\n\tfor(int i=ft[x];i;i=nx[i])\n\t{\n\t\tif(to[i]!=fa[x])/*\u4fdd\u8bc1\u4e0d\u5f80\u56de\u8d70*/ fa[to[i]]=x,dfs(to[i],d+1);//\u7ee7\u7eed\u5411\u4e0b\n\t}\n}\nint jp(int x,int y,int w)///\u5f00\u59cb\u8df3,w\u4e3a\u8981\u6c42\u79cd\u7c7b\n{\t\n\tif(dep[x]>dep[y]) swap(x,y);//LCA\n\tfor(int i=(int)log2(dep[y]-dep[x]);i>=0;i--)//\u8fd9\u91ccdep[x]=dep[y]\u65f6,log2(0)=-\u65e0\u7a77\u5927,\u4e0d\u4f1a\u8fdb\u884c\u5faa\u73af\n\t{\n\t\tif(dep[hv[y][i][0]]>=dep[x])\n\t\t{\n\t\t\tif(hv[y][i][w]) return 1;//\u53ea\u8981\u627e\u5230\u5c31\u8fd4\u56de\n\t\t\ty=hv[y][i][0];//\u8df3\n\t\t}\n\t}\n\tif(x==y)//LCA\u4e2d\u6709\u8be6\u7ec6\u89e3\u91ca,\u5982\u679c\u53d1\u73b0\u8df3\u5230\u91cd\u5408\u4e86\n\t{\n\t\tif(cow[x]==w) return 1;//\u867d\u7136\u4e00\u822c\u60c5\u51b5\u524d\u9762\u5224\u5b9a\u8fc7\u4e86,\u4f46\u662f\u5982\u679cx\u4e00\u5f00\u59cb\u5c31\u7b49\u4e8ey\u65f6\u524d\u9762\u5faa\u73af\u6ca1\u6709\u8fdb\u884c,\u6ca1\u8fdb\u884c\u8fc7\u5224\u5b9a,\u6240\u4ee5\u9700\u8981\u518d\u5224\u4e00\u6b21\n\t\telse return 0;\n\t}\n\tfor(int i=(int)log2(dep[x]);i>=0;i--)//\u8df3\n\t{\n\t\tif((1<<i)<=dep[x])\n\t\t{\n\t\t\tif(hv[x][i][0]!=hv[y][i][0])//LCA\n\t\t\t{\n\t\t\t\tif(hv[x][i][w]||hv[y][i][w]) return 1;//\u627e\u5230\n\t\t\t\tx=hv[x][i][0],y=hv[y][i][0];\n\t\t\t}\n\t\t}\n\t}\n\tif(hv[x][0][w]||hv[y][0][w]) return 1;//\u5dee\u4e00\u6b65\u8df3\u5230\u4ed6\u4eec\u7684\u516c\u5171\u7956\u5148,\u540c\u4e0a\u9762\u7684\u539f\u56e0,\u53ef\u80fd\u524d\u9762\u7684\u5faa\u73af\u5185\u64cd\u4f5c\u6ca1\u6709\u8fdb\u884c\u8fc7,\u6240\u4ee5\u8981\u7528hv[x][0][w]||hv[y][0][w]\u987a\u4fbf\u5224\u65ad\u4e00\u4e0b\u4ed6\u4eec\u81ea\u8eab\n\treturn 0;//\u90fd\u6ca1\u6709\u8fd4\u56de0\n}\nint main()\n{\n\tn=read();m=read();\n\tfor(int i=1;i<=n;i++) \n\t{\n\t\tchar c;\n\t\tscanf(\"%c\",&c);\n\t\tif(c=='H') cow[i]=1;//\u8bb0H\u4e3a1\n\t\telse cow[i]=2;//G\u4e3a2\n\t}\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint x=read(),y=read();\n\t\tadd(x,y);\n\t\tadd(y,x);\n\t}\n\tdfs(1,0);//\u6c42hv\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint a=read(),b=read(),w;\n\t\tchar c;\n\t\tscanf(\"%c\",&c);\n\t\tif(c=='H') w=1;\n\t\telse w=2;\n\t\tcout<<jp(a,b,w);//\u8df3\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1584542248,
        "uid": 199270,
        "name": "Y_B_Y",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5836 \u3010[USACO19DEC]Milk Visits S\u3011"
    },
    {
        "content": "### \u505a\u9898\u5168\u8fc7\u7a0b\n\n\u505a\u5b8cSilver T1\u4e4b\u540e\u5c31\u770b\u8fd9\u9053\u9898\u4e86\u3002\n\n\u7531\u4e8eT2\u770b\u8d77\u6765\u662f\u4e00\u9053\u6a21\u62df(\u5bf9\u4e8e\u6211\u6765\u8bf4)\uff0c\u5c31\u5148\u653e\u4e00\u8fb9\u4e86\u3002\n\n\u626b\u4e86\u4e00\u773cT3\uff0c\u53d1\u73b0\u4e86\u6811\u4e0a\u8def\u5f84\u8fd9\u4e2a\u4e1c\u897f\u3002\n\nLCA\u5728\u6211\u8111\u4e2d\u663e\u73b0\uff0c\u6211\u5f00\u59cb\u6572\u500d\u589e(Tips:\u5728\u8fd9\u91cc\u6253\u6811\u5256\u660e\u663e\u6162\u4e86\u5f88\u591a\uff0c\u5728\u8fd9\u79cd\u666e\u901a\u7684LCA\u4f7f\u7528\u4e2d\u53ef\u4ee5\u7528\u500d\u589e\u52a0\u5feb\u5199\u4ee3\u7801\u901f\u5ea6)\u3002\n\n\u53c8\u770b\u4e86\u4e00\u773c\u9898\u76ee\uff0c\u53d1\u73b0\u53ea\u6709\u4e24\u79cd\u72b6\u6001\u8981\u7ef4\u62a4\u3002\n\n\u820d\u7136\u5927\u559c\u3002\u5f00\u4e86\u4e24\u4e2a\u6570\u7ec4\u7ef4\u62a4\u5c31\u884c\u4e86\u3002\n\n\u601d\u7ef4Correct!\u4e4b\u540e\u53ea\u5269\u4ee3\u7801\u4e86\u3002\n\n\u63d0\u4ea4\u7684\u65f6\u5019\u8fd8\u60f3\u7740\u4e3a\u4ec0\u4e48\u53ea\u6709\u4e24\u79cd\u72b6\u6001\u2026\u2026\u600e\u4e48\u4e0d\u641e\u4e00\u4e2aN\u79cd\u7684\u5462\u2026\u2026\n\n---\n\n### \u9898\u610f\u7b80\u8ff0\n\n\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u6811\u4e0a\u7684\u70b9\u53ea\u6709\u4e24\u79cd\u72b6\u6001\u2014\u2014H\u6216G\u3002\n\nQ\u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u4e24\u70b9\u95f4\u8def\u5f84\u6709\u6ca1\u6709H\u6216\u8005G\u3002\n\n---\n\n### \u505a\u6cd5\n\n\u6b63\u5982\u6211\u7684\u505a\u9898\u8fc7\u7a0b\u6240\u8bf4\u7684\uff0c\u8fd9\u9053\u9898\u9700\u8981\u4f7f\u7528LCA\u8fd9\u4e2a\u4e1c\u897f\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\uff0c\u6811\u4e0a\u4e24\u70b9\u95f4\u8def\u5f84\u53ef\u4ee5\u8fd9\u4e48\u8868\u793a\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/lvmc2cwo.png)\n\n\u84dd\u8272=P1+P2-2*P3+(LCA\u4e0a\u7684\u4fe1\u606f)\u3002\n\n(\u8fd9\u5f20\u56fe\u4e2d\u6ca1\u6709\u8868\u793a\u51faLCA\u88ab\u52a0\u51cf\u7684\u6b21\u6570\uff0c\u8bf7\u8bfb\u8005\u81ea\u884c\u601d\u8003)\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u53ea\u7ef4\u62a4\u4e00\u4e2a\u8282\u70b9\u5230\u6839\u8282\u70b9\u8def\u5f84\u4e0aH\u548cG\u7684\u6570\u91cf\u5c31\u884c\u3002\n\n\u7531\u4e8e\u4e00\u4e2a\u8282\u70b9\u7684\u4fe1\u606f\u548c\u5176\u7236\u4eb2\u7684\u4fe1\u606f\u53ea\u5dee1\uff0c\u6240\u4ee5\u8fd9\u5f88\u597d\u4fee\u6539\u3002\n\n\u90a3\u4e48\u590d\u6742\u5ea6\u5c31\u662f$O(N+QlogN)$(\u524d\u9762\u662fDFS\uff0c\u540e\u9762\u662fLCA)\u3002\n\nCode:\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\nusing namespace std;\nint N,M;\nchar PZ[100010];\nint qxx[200010][2],tt[100010],nn;\nint fa[100010],dep[100010];\nint bz[100010][20];\nint H[100010],G[100010];\nvoid ad(int u,int v){\n\tqxx[++nn][0]=v;\n\tqxx[nn][1]=tt[u];\n\ttt[u]=nn;\n}\nvoid dfs(int u){\n\tH[u]=H[fa[u]]+(PZ[u]=='H');\n\tG[u]=G[fa[u]]+(PZ[u]=='G');\n\tdep[u]=dep[fa[u]]+1;\n\tfor(int i=tt[u];i;i=qxx[i][1]){\n\t\tint v=qxx[i][0];\n\t\tif(v==fa[u])\tcontinue;\n\t\tfa[v]=u;\n\t\tdfs(v);\n\t}\n}\nint lca(int u,int v){\n\tif(dep[u]<dep[v])\tswap(u,v);\n\tfor(int i=17;i+1;i--)\n\t\tif(dep[bz[u][i]]>=dep[v])\tu=bz[u][i];\n\tif(u==v)\treturn u;\n\tfor(int i=17;i+1;i--)\n\t\tif(bz[u][i]!=bz[v][i])\tu=bz[u][i],v=bz[v][i];\n\treturn fa[u];\n}\nint main(){\n\tfreopen(\"milkvisits.in\",\"r\",stdin);\n\tfreopen(\"milkvisits.out\",\"w\",stdout);\n\tscanf(\"%d%d\",&N,&M);\n\tscanf(\" %s\",PZ+1);\n\tfor(int i=1,a,b;i<N;i++){\n\t\tscanf(\"%d%d\",&a,&b);\n\t\tad(a,b);ad(b,a);\n\t}\n\tfa[1]=1;dfs(1);\n\tfor(int i=1;i<=N;i++)\tbz[i][0]=fa[i];\n\tfor(int i=1;i<18;i++)\n\t\tfor(int j=1;j<=N;j++)\n\t\t\tbz[j][i]=bz[bz[j][i-1]][i-1];\n\tfor(int i=1,a,b;i<=M;i++){\n\t\tscanf(\"%d%d\",&a,&b);\n\t\tchar c;scanf(\" %c\",&c);\n\t\tint u=lca(a,b);\n\t\tint hh=H[a]+H[b]-H[u]*2+(PZ[u]=='H');\n\t\tint gg=G[a]+G[b]-G[u]*2+(PZ[u]=='G');\n\t\tif(c=='H'){\n\t\t\tif(hh)\tprintf(\"1\");\n\t\t\telse\tprintf(\"0\");\n\t\t}\n\t\telse{\n\t\t\tif(gg)\tprintf(\"1\");\n\t\t\telse\tprintf(\"0\");\n\t\t}\n\t}\n\tfclose(stdin);\n\tfclose(stdout);\n\treturn 0;\n}\n```",
        "postTime": 1576770630,
        "uid": 60864,
        "name": "tiger2005",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5836 \u3010[USACO19DEC]Milk Visits(silver)\u3011"
    },
    {
        "content": "\u5373\u662f\u53ea\u7528\u4e8610min\u4e0d\u5230\uff0c\u7531\u5927\u5e38\u6570\u9009\u624b\u7f16\u5199\uff0c$O(n)$\u8fd8\u662f\u6beb\u65e0\u60ac\u5ff5\u62ff\u4e86\u6700\u4f18\u89e3\u3002\n\n\u5927\u5bb6\u90fd\u628a\u95ee\u9898\u60f3\u590d\u6742\u4e86\uff0c\u8fd9\u9898\u6839\u672c\u7528\u4e0d\u5230lca\u3002\n\n\u4e3a\u4ec0\u4e48\u8fd9\u9053\u9898\u7279\u610f\u53ea\u7ed9\u4e86\u4e24\u79cd\u989c\u8272\uff1f\n\n\u56e0\u4e3a\u53ea\u6709\u4e24\u79cd\u989c\u8272\u65f6\uff0c\u60f3\u8981\u8f93\u51fa0\uff0c\u5fc5\u987b\u662f\u4e00\u6761\u8def\u5f84\u4e0a\u5168\u90fd\u662f\u53e6\u4e00\u79cd\u989c\u8272\u3002\u56e0\u6b64\u6211\u4eec\u628a\u9898\u76ee\u8f6c\u5316\u4e3a\u4e86\u5982\u4f55\u5224\u65ad\u4e00\u6761\u8def\u5f84\u662f\u5426\u540c\u8272\u3002\n\n\u6211\u4eec\u7528$top[i]$\u8868\u793a$i$\u53f7\u70b9\u5411\u4e0a\u8fde\u7eed\u4e0e\u5b83\u540c\u8272\u6700\u591a\u80fd\u8d70\u5230\u54ea\u91cc\u3002\u5373\n\n$top[i]=$\n\n$top[father[i]],if(color[father[i]]==color[i])$\n\n$i,if(color[father[i]]!=color[i])$\n\n\u90a3\u4e48\u8def\u5f84$i->j$\u540c\u8272\u5f53\u4e14\u4ec5\u5f53$top[i]==top[j]$\n\n$O(n)$\u5927\u5e38\u6570\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```\n#include<cstdio>\ntypedef long long ll;\ntypedef long double ld;\nconst int N=1e5+10;\nvoid file(const char *str){\n    char in[100],out[100];\n    sprintf(in,\"%s.in\",str),sprintf(out,\"%s.out\",str);\n    freopen(in,\"r\",stdin),freopen(out,\"w\",stdout);\n}\n#define fast_io\n#ifdef fast_io\nconst int _IB=1e6;\nchar _ibuf[_IB],*_s,*_t;\n#define getchar()\\\n (_s==_t&&(_t=(_s=_ibuf)+fread(_ibuf,1,_IB,stdin),_s==_t)?EOF:*_s++)\n#endif\nll read(){\n    ll a=0;int op=1;char ch=getchar();\n    while(ch<'0'||'9'<ch){if(ch=='-')op=-1;ch=getchar();}\n    while('0'<=ch&&ch<='9'){a=(a<<3)+(a<<1)+(48^ch);ch=getchar();}\n    return a*op;\n}\nint read_color(){\n    char c;\n    while((c=getchar())!=EOF){\n        switch(c){\n            case 'H':return 0;\n            case 'G':return 1;\n        }\n    }\n    return -1;\n}\nstruct L{\n    int to,next;\n};\nint head[N];\nL l[N<<1];\nint lcount;\nvoid add(int from,int to){\n    l[++lcount].to=to;\n    l[lcount].next=head[from];\n    head[from]=lcount;\n}\n#define REPL(S,I,T) for(int I=head[S],T;T=l[I].to,I;I=l[I].next)\nint n,m;\nint c[N];\nint top[N];\nvoid dfs(int now=1,int t=1,int f=0){\n    top[now]=t;\n    REPL(now,i,to)if(f!=to)dfs(to,c[to]==c[now]?t:to,now);\n}\nvoid input(){\n    n=read();\n    m=read();\n    for(int i=1;i<=n;i++)c[i]=read_color();\n    int p1,p2;\n    for(int i=1;i<n;i++){\n        p1=read();\n        p2=read();\n        add(p1,p2);\n        add(p2,p1);\n    }\n}\nvoid ini(){\n    dfs();\n}\nvoid solve(){\n    int p1,p2,p3;\n    for(int i=0;i<m;i++){\n        p1=read();\n        p2=read();\n        p3=read_color();\n        printf(\"%d\",c[p1]==p3||c[p2]==p3||top[p1]!=top[p2]?1:0);\n    }\n}\nvoid output(){\n}\nvoid test(){\n    input();\n    ini();\n    solve();\n    output();\n}\nvoid all(){\n    file(\"tmp\");\n    test();\n}\nint main(){\n    all();\n    return 0;\n}\n```",
        "postTime": 1577717261,
        "uid": 81705,
        "name": "\u5bc6\u671f\u671b",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5836 \u3010[USACO19DEC]Milk Visits(silver)\u3011"
    },
    {
        "content": "\u62a2\u7b2c\u4e00\u7bc7\u9898\u89e3\n\n\n\u9898\u610f\n>\u6c42\u8def\u5f84u-v\u4e0a\u662f\u5426\u6709\u989c\u8272$H/G$\n\n\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4e2a\u597d\u7684[\u65b9\u6cd5](https://www.luogu.com.cn/blog/onlinewlq123/solution-p5838)\uff08\u72d7\u5934\n\n\u4f46\u663e\u7136\u5e76\u4e0d\u9700\u8981\u8fd9\u4e48\u590d\u6742\n\n\u6211\u4eec\u5bf9$1-i$\u8def\u5f84\u4e0a\u8bb0\u5f55\u989c\u8272$H/G$\u7684\u4e2a\u6570\uff08\u6811\u4e0a\u524d\u7f00\u548c\u5373\u53ef\n\n\u67e5\u8be2\u65f6\u76f4\u63a5\u6811\u4e0a\u5dee\u5206\u5373\u53ef\n\n$O(NlogN)$\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=a;i<=b;i++)\nusing namespace std;\n#define N 100005\nint n,m,h[N],tot;\nstruct edge{\n\tint to,nxt;\n}e[N<<1];\nvoid add(int x,int y){\n\te[++tot].to=y;e[tot].nxt=h[x];h[x]=tot;\n}\nchar s[N];\nint H[N],G[N],f[N][20],t,d[N];\nvoid dfs(int x,int fa){\n\td[x]=d[fa]+1;f[x][0]=fa;\n\tif(s[x]=='H')H[x]=1;\n\telse G[x]=1;\n\tH[x]+=H[fa];G[x]+=G[fa];\n\trep(i,1,t)f[x][i]=f[f[x][i-1]][i-1];\n\tfor(int i=h[x];i;i=e[i].nxt)\n\t  if(e[i].to!=fa)dfs(e[i].to,x);\n}\nint lca(int x,int y){\n\tif(d[x]<d[y])swap(x,y);\n\tfor(int i=t;i>=0;i--)if(d[f[x][i]]>=d[y])x=f[x][i];\n\tif(x==y)return x;\n\tfor(int i=t;i>=0;i--)if(f[x][i]!=f[y][i])x=f[x][i],y=f[y][i];\n\treturn f[x][0];\n}\nint main(){\n\t//freopen(\"milkvisits.in\",\"r\",stdin);\n\t//freopen(\"milkvisits.out\",\"w\",stdout);\n\tscanf(\"%d%d\",&n,&m);\n\tscanf(\"%s\",s+1);\n\trep(i,1,n-1){\n\t\tint x,y;scanf(\"%d%d\",&x,&y);\n\t\tadd(x,y);add(y,x);\n\t}\n\tt=log2(n);\n\tdfs(1,0);\n\t//cout<<endl<<endl;\n\t//rep(i,1,n)printf(\"%d %d\\n\",H[i],G[i]);\n\t//cout<<endl<<endl;\n\tint x,y;char op[2];\n\trep(i,1,m){\n\t\tscanf(\"%d%d%s\",&x,&y,op);\n\t\tint val,L=lca(x,y);\n\t\tif(op[0]=='H')val=H[x]+H[y]-H[L]-H[f[L][0]];\n\t\telse val=G[x]+G[y]-G[L]-G[f[L][0]];\n\t\tif(val)putchar('1');\n\t\telse putchar('0');\n\t\t//cout<<val<<\" \"<<L<<endl;\n\t}\n\tputchar('\\n');\n\treturn 0;\n}\n```",
        "postTime": 1576766947,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5836 \u3010[USACO19DEC]Milk Visits(silver)\u3011"
    },
    {
        "content": "\u4ecb\u7ecd\u4e00\u79cd\u5e76\u67e5\u96c6\u7684\u5199\u6cd5\n\n\u56e0\u4e3a\u9898\u76ee\u53ea\u67092\u79cd\u989c\u8272\uff0c\u90a3\u4e48\u6211\u4eec\u628a\u540c\u4e00\u79cd\u989c\u8272\u8fde\u5728\u4e00\u8d77\u7684\u653e\u5728\u540c\u4e00\u4e2a\u8fde\u901a\u5757\u91cc\u9762\uff0c\u4e5f\u5c31\u662f\u628a\u4e24\u4e2a\u70b9\u5408\u5e76\uff0c\u67e5\u8be2\u7684\u65f6\u5019\u5982\u679c\u4e24\u4e2a\u70b9\u6ca1\u6709\u516c\u5171\u7956\u5148\uff0c\u90a3\u4e48\u4ed6\u4e00\u5b9a\u7ecf\u8fc7\u4e862\u79cd\u989c\u8272\uff0c\u5982\u679c\u662f\u76f8\u540c\u7684\u516c\u5171\u7956\u5148\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u5224\u65ad\u5b83\u7684\u8282\u70b9\u7684\u989c\u8272\u662f\u4e0d\u662f\u67e5\u8be2\u7684\u989c\u8272\u3002\n\n~~\u5177\u4f53\u5199\u6cd5\u770b\u4ee3\u7801\uff0c\u5982\u679c\u4f1a\u5e76\u67e5\u96c6\u7684\u8bdd\u7406\u89e3\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u3002~~\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ninline int read(){\n\tint s=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){\n\t\tif(c=='H'||c=='G')return c;\n\t\tif(c=='-')f=-1;c=getchar();\n\t}\n\twhile(c>='0'&&c<='9'){\n\t\ts=(s<<1)+(s<<3)+(c^48);c=getchar();\n\t}\n\treturn f*s;\n}\nconst int N=1555555;\nint n,m,b[N];\nchar c[N];\nvector<int>q[N];\nint find(int x){\n\tif(b[x]!=x){\n\t\tb[x]=find(b[x]);\n\t}\n\treturn b[x];\n}\nint main(){\n\tn=read(),m=read();\n\tscanf(\"%s\",c+1);\n\tfor(int i=1;i<=n;i++)b[i]=i;\n\tfor(int i=1;i<n;i++){\n\t\tint x=read(),y=read();\n\t\tif(c[x]==c[y])b[find(x)]=find(y);\n\t}\n\tfor(int i=1;i<=m;i++){\n\t\tint x=read(),y=read(),z=read();\n\t\tprintf(\"%d\",find(x)!=find(y)||c[x]==z);\n\t}\n\treturn 0;\n}\n```\n\u5982\u679c\u4ee3\u7801\u6709\u95ee\u9898\u5e0c\u671b\u5927\u4f6c\u80fd\u591f\u6307\u6b63",
        "postTime": 1583909657,
        "uid": 155626,
        "name": "\u8001\u54b8\u9c7c\u4e86",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5836 \u3010[USACO19DEC]Milk Visits S\u3011"
    },
    {
        "content": "\u8fd9\u9898\u662f\u6574\u4e2a 12 \u6708\u94f6\u7ec4\u91cc\u9762\u6700\u6ca1\u601d\u7ef4\u96be\u5ea6\u7684\u9898\u2026\u2026\u500d\u589e LCA \u677f\u5b50\u8fd8\u884c\u2026\u2026  \n[\u6d1b\u8c37\u6a21\u677f](https://www.luogu.com.cn/problem/P3379)\n\n\u4f46\u662f\u94f6\u7ec4\u53c2\u8d5b\u8005\u4e0d\u4e00\u5b9a\u4f1a\u5b66\u5230 LCA\uff0c\u8fd9\u91cc\u7b80\u5355\u8bb2\u4e00\u4e0b\u3002\n\n\u5173\u952e\u6570\u7ec4 $f$\uff1a$f(i, j)$ \u8868\u793a\u4ece\u70b9 $i$ \u5f00\u59cb\u5411\u6839\u7684\u65b9\u5411\u8d70 $2^j$ \u6761\u8fb9\u6240\u80fd\u5230\u8fbe\u7684\u70b9\u3002\n\n\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a$f(i, j) = f(\\ f(i, j-1), j-1)$\u3002  \n\u521d\u503c\uff1a$f(i, 0) = \\mathrm{parent}(i)$\u3002\n\n\u9884\u5904\u7406\uff1a\u4ece\u6839\u5f00\u59cb\u5f80\u4e0b dfs \u6216 bfs\uff0c\u5904\u7406\u597d\u521d\u503c\u5e76\u8bb0\u5f55\u6df1\u5ea6\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(N)$\u3002\u518d\u5bf9\u6bcf\u4e2a\u70b9\u505a\u4e00\u6b21 dp\uff0c\u5728 dfs \u6216 bfs \u5185\u5916\u90fd\u884c\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(N \\log N)$\u3002\n\n\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u91cc\u7684 $f$ \u6570\u7ec4\u53ef\u4ee5\u63a8\u5e7f\u4e00\u4e0b\uff0c\u4fdd\u5b58\u6bcf\u4e2a\u70b9\u5f80\u6839\u65b9\u5411\u7684\u8def\u5f84\u4e0a\u5404\u4e2a\u8fb9/\u70b9\u7684\u6027\u8d28\u3002\u5e38\u89c1\u7684\u7ef4\u62a4\u503c\u6709\u8def\u5f84\u957f\u5ea6\uff08\u6811\u4e0a\u6c42\u6700\u77ed\u8def\uff09\u4ee5\u53ca\u70b9\u7684\u7279\u6b8a\u6027\u8d28\uff08\u6bd4\u5982\u672c\u9898\u4e2d\u5404\u4e2a\u519c\u573a\u7684\u5976\u725b\u79cd\u7c7b\uff09\u7b49\u3002\n\n\u5728\u672c\u9898\u5f53\u4e2d\uff0c\u6211\u4eec\u518d\u5f00\u4e00\u4e2a\u5e03\u5c14\u6570\u7ec4 $g(i, j, k\\in \\{0,1\\}\\ )$\uff0c\u8868\u793a\u4ece\u70b9 $i$ \u5f00\u59cb\u5411\u6839\u7684\u65b9\u5411\u8d70 $2^j$ \u6761\u8fb9\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6709\u6ca1\u6709\u78b0\u5230 $k$ \u7c7b\u578b\u7684\u5976\u725b\u3002\n\n\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a$g(i, j, k)\\ |= g(i, j-1, k)\\ |\\ g(\\ g(i, j-1), j-1, k)$\uff0c\u5176\u4e2d $|$ \u8868\u793a\u6309\u4f4d\u6216\uff08\u6b64\u9898\u4e5f\u53ef\u7528\u903b\u8f91\u6216\uff09\u3002  \n\u521d\u503c\uff1a$g(i, 0, k)$ \u4fdd\u5b58\u81ea\u5df1\u548c\u53cc\u4eb2\u8282\u70b9\u8fd9\u4e24\u4e2a\u70b9\u4e2d\u6709\u6ca1\u6709 $k$ \u7c7b\u578b\u7684\u5976\u725b\u3002\n\n\u6700\u540e\u5904\u7406 LCA \u8be2\u95ee\uff0c\u8bbe\u8be2\u95ee\u4e24\u70b9\u4e3a $x,y\\ (\\operatorname{dep}(x) \\le \\operatorname{dep}(y)\\ )$\uff0c\u5148\u4ece\u5927\u5230\u5c0f\u679a\u4e3e $j$\uff0c\u628a $y$ \u8df3\u5230\u548c $x$ \u6df1\u5ea6\u4e00\u6837\uff0c\u6b64\u65f6\u7279\u5224\uff1a`if (x == y) return x;` \u5426\u5219\u63a5\u7740\u8df3\uff0c\u518d\u4ece\u5927\u5230\u5c0f\u679a\u4e3e $j$\uff0c\u5f53\u4e24\u70b9\u4e0d\u4e00\u6837\u65f6\u5c31\u5f80\u4e0a\u8df3\uff0c\u6700\u540e\u72b6\u6001\u662f $x$ \u548c $y$ \u8df3\u5230\u8fd8\u5dee\u4e00\u6b65\u5c31\u76f8\u9047\u4e86\u3002\n\nLCA \u4ee3\u7801\uff1a\n```cpp\nil void init()\n{\n    que.push(s);\n    dep[s]=1;\n    while(que.size())\n    {\n        int x=que.front();\n        que.pop();\n        for(rgi i=fst[x];i;i=nxt[i])\n        {\n            int y=v[i];\n            if(dep[y])\n                continue;\n            dep[y]=dep[x]+1;\n            f[y][0]=x;\n            for(rgi j=1;j<=t;++j)\n                f[y][j]=f[f[y][j-1]][j-1];\n            que.push(y);\n        }\n    }\n    return;\n}\nil int lca(int x,int y)\n{\n    if(dep[x]>dep[y])\n        swap(x,y);\n    for(rgi i=t;i>=0;--i)\n        if(dep[f[y][i]]>=dep[x])\n            y=f[y][i];\n    if(x==y)\n        return x;\n    for(rgi i=t;i>=0;--i)\n        if(f[x][i]!=f[y][i])\n            x=f[x][i],y=f[y][i];\n    return f[x][0];\n}\n```\n\u63a5\u4e0b\u6765\u628a $g$ \u5e26\u4e0a\uff0c\u8f6c\u79fb $f$ \u540c\u65f6\u8f6c\u79fb $g$\uff0c\u8be2\u95ee\u65f6\u5b9a\u4e49\u4e00\u4e2a\u53d8\u91cf\u6309\u4f4d/\u903b\u8f91\u6216\u4e0a\u6cbf\u9014\u9047\u5230\u7684 $g$ \u5373\u53ef\u3002\n\n\u5b8c\u6574\u4ee3\u7801\uff1a\n```cpp\n#include <cstdio>\n#include <cctype>\n#include <queue>\n#include <cmath>\n#define il inline\n#define rgi register int\nusing namespace std;\nconst int maxn=1e5+5,maxm=maxn<<1;\nint n,m,q,t,s;\nint u[maxm],v[maxm],fst[maxn],nxt[maxm];\nint dep[maxn],f[maxn][20];\nchar str[maxn];\nbool book[maxn],dp[maxn][20][2];\nqueue<int> que;\nil int ri()\n{\n\tregister int o1=0;\n\tregister char o3=getchar();\n\twhile(!isdigit(o3))\n\t\to3=getchar();\n\twhile(isdigit(o3))\n\t\to1=(o1<<1)+(o1<<3)+(o3^48),o3=getchar();\n\treturn o1;\n}\nvoid inital()\n{\n    que.push(s);\n    dep[s]=1;\n    while(!que.empty())\n    {\n        int x=que.front();\n        que.pop();\n        for(rgi i=fst[x];i;i=nxt[i])\n        {\n            int y=v[i];\n            if(dep[y])\n                continue;\n            dep[y]=dep[x]+1;\n            f[y][0]=x,dp[y][0][book[x]]=1;\n            que.push(y);\n        }\n    }\n}\nint lca(int x,int y,bool z)\n{\n    bool ret=0;\n\tif(dep[x]>dep[y])\n        swap(x,y);\n    for(rgi i=t;i>=0;--i)\n        if(dep[f[y][i]]>=dep[x])\n            ret|=dp[y][i][z],y=f[y][i];\n    if(x==y)\n        return ret;\n    for(rgi i=t;i>=0;--i)\n        if(f[x][i]!=f[y][i])\n        {\n            ret|=dp[x][i][z],ret|=dp[y][i][z];\n\t        x=f[x][i],y=f[y][i];//\u5f80\u4e0a\u8df3\u7684\u65f6\u5019\u5148 dp \u518d\u8df3 x \u548c y\uff0c\u53ef\u4ee5\u8003\u8651\u4e00\u4e0b\u4e0d\u8fd9\u6837\u505a\u7684\u540e\u679c\n        }\n    ret|=dp[x][0][z],ret|=dp[y][0][z];//\u6ce8\u610f\u8fd9\u6b65\u522b\u4e22\n    return ret;\n}\nint main()\n{\n    // freopen(\"milkvisits.in\",\"r\",stdin);\n    // freopen(\"milkvisits.out\",\"w\",stdout);\n\tn=ri(),q=ri();\n    s=1,m=n-1,t=log(n)/log(2)+1;\n    scanf(\"%s\",str+1);\n    for(rgi i=1;i<=n;++i)\n    {\n    \tif(str[i]=='H')\n    \t\tbook[i]=1;\n    \tfor(rgi j=0;j<=t;++j)\n\t\t\tdp[i][j][book[i]]=1;//\u8fd9\u4e48\u5199\u4e5f\u884c\n    }\n    for(rgi i=1;i<=m;++i)\n    {\n        u[i]=ri(),v[i]=ri();\n        nxt[i]=fst[u[i]];\n        fst[u[i]]=i;\n        u[i+m]=v[i];\n        v[i+m]=u[i];\n        nxt[i+m]=fst[u[i+m]];\n        fst[u[i+m]]=i+m;\n    }\n    inital();\n    for(rgi j=1;j<=t;++j)\n\t\tfor(rgi y=1;y<=n;++y)\n        {\n            f[y][j]=f[f[y][j-1]][j-1];\n\t\t\tdp[y][j][0]|=(dp[y][j-1][0]|dp[f[y][j-1]][j-1][0]);\n\t\t\tdp[y][j][1]|=(dp[y][j-1][1]|dp[f[y][j-1]][j-1][1]);\n\t\t}\n    while(q--)\n    {\n        int x=ri(),y=ri();\n        char z=getchar();\n        bool b=0;\n        while(z!='H'&&z!='G')\n        \tz=getchar();\n        if(z=='H')\n        \tb=1;\n        if(x==y)\n        \tprintf(\"%1d\",book[x]==b);\n        //\u8fd9\u4e2a\u7279\u5224\u8981\u52a0\uff0c\u56e0\u4e3a g \u6570\u7ec4\u4e0d\u4f1a\u4fdd\u5b58\u5355\u4e2a\u70b9\u7684\u6027\u8d28\n        else\n\t\t{\n\t\t\tint ans=lca(x,y,b);\n        \tprintf(\"%1d\",ans);\n\t\t}\n    }\n    putchar(10);\n    return 0;\n}\n```",
        "postTime": 1576825374,
        "uid": 78302,
        "name": "gznpp",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5836 \u3010[USACO19DEC]Milk Visits(silver)\u3011"
    },
    {
        "content": "# \u8fde\u901a\u5757\u505a\u6cd5\n\u9996\u5148\uff0c\u8fd9\u662f\u4e00\u9897\u53ea\u6709\u4e24\u79cd\u989c\u8272\u7684\u6811\u3002\n\u6839\u636e\u9898\u9762\u6211\u4eec\u77e5\u9053\uff0c\u5f53\u4e00\u4e2a\u8bbf\u5ba2\u4e0d\u9ad8\u5174\u65f6\u4ec5\u9650\u4e8e\u4ed6\u6240\u7ecf\u8fc7\u7684\u8def\u5f84\u4e0a\u6ca1\u6709\u4ed6\u60f3\u8981\u7684\u989c\u8272\uff0c\u5373\u8fd9\u6761\u8def\u5f84\u4e0a\u5168\u4e3a\u53e6\u4e00\u79cd\u989c\u8272\u3002\n\n\u8fd9\u79cd\u60c5\u51b5\u662f\u6781\u4e3a\u7f55\u89c1\u7684\uff0c\u56e0\u4e3a\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u4e00\u6761\u8def\u5f84\u662f\u4e24\u79cd\u989c\u8272\u90fd\u6709\u7684\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5c06\u540c\u4e00\u79cd\u989c\u8272\u4e14\u76f8\u8fde\u7684\u8282\u70b9\u89c6\u4f5c\u4e00\u4e2a\u8054\u901a\u5757\u3002\n\n1. \u8be2\u95ee\u7684\u4e24\u70b9\u4e0d\u5904\u4e8e\u540c\u4e00\u8fde\u901a\u5757 \u6b64\u65f6\u4e24\u79cd\u989c\u8272\u90fd\u6709\n\n2. \u8be2\u95ee\u7684\u4e24\u70b9\u5c5e\u4e8e\u540c\u4e00\u8fde\u901a\u5757\uff0c\u4e14\u4e3a\u60f3\u8981\u7684\u989c\u8272\n\n2. \u8be2\u95ee\u7684\u4e24\u70b9\u5c5e\u4e8e\u540c\u4e00\u8fde\u901a\u5757\uff0c\u4e3a\u4e0d\u60f3\u8981\u7684\u989c\u8272\n\n\u53e6\u5916\u8fd8\u6709LCA\u505a\u6cd5\uff08\u66f4\u96be\uff09",
        "postTime": 1584097018,
        "uid": 124918,
        "name": "LinkyChristian",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5836 \u3010[USACO19DEC]Milk Visits S\u3011"
    },
    {
        "content": "\u4f7f\u7528\u6811\u94fe\u5256\u5206\uff0c\u628a\u6bcf\u4e00\u4e2a\u503c\u4e3a$H$\u7684\u70b9\u8d4b\u503c\u4e3a$1$\uff0c\u6bcf\u4e00\u4e2a\u503c\u4e3a$G$\u7684\u70b9\u8d4b\u503c\u4e3a$0$\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u672c\u6765\u7684\u627e\u5143\u7d20\u5728\u8def\u5f84\u4e0a\u6709\u6ca1\u6709\u51fa\u73b0\u8f6c\u5316\u4e3a\u6c42\u8def\u5f84\u7684\u503c\u3002\u5982\u679c\u8fd9\u4e2a\u503c$>0$\uff0c\u90a3\u4e48\u4e00\u5b9a\u7ecf\u8fc7\u8fc7\u542b$H$\u7684\u70b9\uff0c\u5982\u679c\u8fd9\u4e2a\u503c\u4e0d\u7b49\u4e8e$dep[u]+dep[v]-2*dep[lca(u,v)]+1$\uff0c\u90a3\u4e48\u4e00\u5b9a\u7ecf\u8fc7\u8fc7\u542b$G$\u7684\u70b9\u3002\n\n\u7528\u6811\u94fe\u5256\u5206lca\u4f1a\u6bd4\u8f83\u5feb\uff0c\u800c\u4e14\u5728\u5904\u7406\u540e\u9762\u5143\u7d20\u51fa\u73b0\u65f6\u4f1a\u6bd4\u8f83\u65b9\u4fbf\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u662f$O(n\\log n+ m(\\log^2n+\\log n))=O(n\\log^2n)$\n\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=(a);i<=(b);++i) \n#define gc() getchar()\n#define endll putchar('\\n')\nusing namespace std;\ntypedef long long ll;\ninline ll read(){\n    char ch=gc();\n    ll x=0,f=1;\n    while(ch<'0'||ch>'9'){\n\tif(ch=='-') f=-1;\n\tch=gc();\n    }\n    while(ch>='0'&&ch<='9'){\n\tx=x*10+ch-'0';\n\tch=gc();\n    }\n    return x*f;\n}\ninline void print(ll k){\n    if(k<0) k=-k,putchar('-');\n    if(k>9) print(k/10);\n    putchar(k%10+48);\n}\ninline void println(ll k){\n    print(k);\n    endll;\n}\ninline void printsp(ll k){\n    print(k);\n    putchar(' ');\n}\nconst int maxn=200499;\nint seg[maxn<<2],tag[maxn<<2];\nint head[maxn],nextt[maxn],to[maxn],tot;\nint MOD;\nint cnt;\nint n,m,r;\nint siz[maxn];\nint ans[maxn];\nint son[maxn],id[maxn],fa[maxn],top[maxn],wt[maxn],w[maxn];\nint dep[maxn];\nint tmp[maxn];\ninline int lson(int p){\n    return p<<1;\n}\ninline int rson(int p){\n    return p<<1|1;\n}\ninline void push_up(int p){\n    seg[p]=(seg[lson(p)]+seg[rson(p)]);\n}\ninline void addedge(int u,int v){\n    to[++tot]=v;\n    nextt[tot]=head[u];\n    head[u]=tot;\n}\ninline void build(int p,int l,int r){\n    tag[p]=0;\n    if(l==r){\n        seg[p]=wt[l];\n        //seg[p]=tmp[l];\n        return;\n    }\n    int mid=(l+r)>>1;\n    build(lson(p),l,mid);\n    build(rson(p),mid+1,r);\n    push_up(p);\n}\ninline void f(int p,int l,int r,int k){\n    tag[p]+=k;\n    seg[p]=(seg[p]+k*(r-l+1));\n}\ninline void push_down(int p,int l,int r){\n    int mid=(l+r)>>1;\n    f(lson(p),l,mid,tag[p]);\n    f(rson(p),mid+1,r,tag[p]);\n    tag[p]=0;\n}\nint query(int dl,int dr,int l,int r,int p){\n    int res=0;\n    if(dl<=l&&r<=dr) return seg[p];\n    int mid=(l+r)>>1;\n    push_down(p,l,r);\n    if(dl<=mid) res=(query(dl,dr,l,mid,lson(p))+res);\n    if(dr>mid) res=(query(dl,dr,mid+1,r,rson(p))+res);\n    return res;\n}\ninline int qrange(int x,int y){\n    int ans=0;\n    int res;\n    while(top[x]!=top[y]){\n        if(dep[top[x]]<dep[top[y]]) swap(x,y);\n        res=0;\n        res=query(id[top[x]],id[x],1,n,1);\n        ans=(ans+res);\n        x=fa[top[x]];\n    }\n    if(dep[x]>dep[y]) swap(x,y);\n    res=query(id[x],id[y],1,n,1);\n    ans+=res;\n    return ans;\n}\nvoid dfs1(int x,int f,int deep){\n    dep[x]=deep;\n    fa[x]=f;\n    siz[x]=1;\n    int maxson=-1;\n    for(int i=head[x];i;i=nextt[i]){\n        int y=to[i];\n        if(y==f) continue;\n        dfs1(y,x,deep+1);\n        siz[x]+=siz[y];\n        if(siz[y]>maxson) son[x]=y,maxson=siz[y];\n    }\n}\ninline void dfs2(int x,int topf){\n    id[x]=++cnt;\n    wt[cnt]=w[x];\n    top[x]=topf;\n    if(!son[x]) return ;\n    dfs2(son[x],topf);\n    for(int i=head[x];i;i=nextt[i]){\n        int y=to[i];\n        if(y==fa[x]||y==son[x]) continue;\n        dfs2(y,y);\n    }\n}\nint lca(int x,int y){\n    while(top[x]!=top[y]){\n        if(dep[top[x]]>=dep[top[y]]) x=fa[top[x]];\n        else y=fa[top[y]];\n    }\n    if(dep[x]>dep[y]) swap(x,y);\n    return x;\n}\nint main(){\n    n=read(),m=read();\n    r=1;\n    string tt;\n    cin>>tt;\n    rep(i,0,tt.length()-1){\n        if(tt[i]=='H') w[i+1]=1;\n        else w[i+1]=0;\n    }\n    rep(i,1,n-1){\n        int u=read(),v=read();\n        addedge(u,v);\n        addedge(v,u);\n    }\n    dfs1(r,0,1);\n    dfs2(r,r);\n    build(1,1,n);\n    rep(i,1,m){\n        int u=read(),v=read();\n        char tmp;\n        cin>>tmp;\n        if(u==v){\n            if(tmp=='H'){\n                if(w[u]==1) ans[i]=1;\n                else ans[i]=0;\n            }\n            else{\n                if(w[u]==0) ans[i]=1;\n                else ans[i]=0;\n            }\n        }\n        int opt=qrange(u,v);\n        //cout<<\"opt:\"<<opt<<endl;\n        if(tmp=='H'){\n            if(opt>0) ans[i]=1;\n            else ans[i]=0;\n        }\n        else{\n            if(opt!=(dep[u]+dep[v]-2*dep[lca(u,v)]+1))  ans[i]=1;\n            else ans[i]=0;\n        }\n    }\n    for(int i=1;i<=m;++i) print(ans[i]);\n    return 0;\n}\n\n```\n",
        "postTime": 1577018573,
        "uid": 52356,
        "name": "Anfangen",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5836 \u3010[USACO19DEC]Milk Visits(silver)\u3011"
    }
]