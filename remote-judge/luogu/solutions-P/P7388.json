[
    {
        "content": "[**\u66f4\u597d**\u7684\u9605\u8bfb\u4f53\u9a8c](http://zrzring.cn/index.php/archives/651/)\n\n\u8003\u8651\u8981\u8ba1\u7b97\u7684\u603b\u8d21\u732e\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u4eba\u7684$c_i$\u7ed9\u5b9a\u4e00\u4e2a\u7cfb\u6570\uff0c\u8fd9\u4e2a\u7cfb\u6570\u4e3a\u8fd9\u4e2a\u4f24\u5bb3\u7684\u8d21\u732e\u3002\n\n\u5982\u679c\u8003\u8651\u6bcf\u79cd\u65b9\u6848\u7684\u8bdd\uff0c\u8fd9\u4e2a\u4f24\u5bb3\u4f1a\u4ece\u8d77\u70b9\u987a\u7740\u4e00\u6761\u8fde\u7eed\u7684\u94fe\u8fdb\u884c\u6570\u6b21\u8d21\u732e\uff0c\u76f4\u5230\u8fd9\u4e2a\u4f24\u5bb3\u88ab\u672b\u5c3e\u7684\u4eba\u5f80\u56de\u6253\uff0c\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u8fd8\u662f\u5f97\u679a\u4e3e\u6240\u6709\u60c5\u51b5\u7684\u6240\u6709\u94fe\u3002\n\n\u4e00\u6761\u94fe\u53ef\u4ee5\u5728\u6bcf\u4e00\u9636\u6bb5\u90fd\u8fdb\u884c\u4e00\u6b21\u8d21\u732e\uff0c\u6211\u4eec\u628a\u5b83\u62c6\u5f00\u5355\u72ec\u8003\u8651\u8fd9\u4e2a\u8d21\u732e\u7684\u957f\u5ea6\uff0c\u8fd9\u6837\u4e00\u6765$c_i$\u786e\u5b9a\uff0c\u8def\u5f84\u4e0a\u7684$k_i$\u4e5f\u786e\u5b9a\uff0c\u6bcf\u6b21\u7684\u8d21\u732e\u7684\u4f24\u5bb3\u91cf\u90fd\u662f\u786e\u5b9a\u7684\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5bf9\u4e8e\u91cd\u590d\u7684\u8d21\u732e\u8fdb\u884c\u7edf\u4e00\u8ba1\u7b97\u4e86\u3002\n\n\u94a6\u5b9a\u76ee\u524d\u8fd9\u4e2a\u4eba\u7684\u653b\u51fb\u4f1a\u9014\u5f84$x$\u4e2a\u4eba\uff0c\u5e76\u628a\u8fd9$x$\u4e2a\u4eba\u7684$k_i$\u4e58\u4e0a\uff0c\u8fd9\u6761\u94fe\u7684\u6700\u540e\u4e00\u4e2a\u4eba\u4f1a\u6709\u4e00\u4e2a\u653b\u51fb\u76ee\u6807\uff0c\u6211\u4eec\u4e0d\u7ba1\u8fd9\u4e2a\u653b\u51fb\u76ee\u6807\u662f\u8c01\uff0c\u8fd9\u4e2a\u4f24\u5bb3\u603b\u4f1a\u91ca\u653e\u51fa\u53bb\uff0c\u5c31\u662f\u8fd9\u4e2a\u653b\u51fb\u9020\u6210\u7684\u4e00\u6b21\u8d21\u732e\uff0c\u518d\u4e58\u4e0a\u6ee1\u8db3\u4e0a\u8ff0\u6761\u4ef6\u7684\u65b9\u6848\u6570\u5373\u53ef\u3002\n\n\u679a\u4e3e\u6bcf\u4e2a\u4eba\u5e76\u679a\u4e3e\u4f24\u5bb3\u7ecf\u8fc7\u7684\u4eba\u6570\uff0c\u80fd\u5f97\u5230\u539f\u5f0f\n\n$$\n\\sum_{i = 1}^{n} c_i \\times \\left(\\sum_{j = 0}^{n - 1}2^{n - j}\\binom{n}{j + 1}(n - j - 1)!\\left(\\prod_{l = i + 1}^{i + j}k_l + \\prod_{l = i - j}^{i - 1}k_l\\right)\\right)\n$$\n\n\u7b80\u5355\u5904\u7406\u4e00\u4e0b\u5c31\u670940\u5206\u4e86\u3002\n\n\u8003\u8651\u5230\u4e2d\u95f4\u51e0\u9879\u53ea\u548c$j$\u6709\u5173\uff0c\u628a$c_i$\u4e58\u8fdb\u53bb\uff0c\u63d0\u53d6\u51fa$j = 0$\u9879\uff0c\u5bf9\u540e\u9762\u7684\u7528\u5dee\u5206\u5904\u7406\uff0c\u628a\u52a0\u53f7\u62c6\u5f00\uff0c\u53ef\u4ee5\u5f97\u5230\n\n$$\n\\sum_{i = 1}^{n}2^{n + 1}c_in! + \\sum_{i = 1}^{n}\\sum_{j = 1}^{n - 1}\\frac{f(j)g_1(i + j)}{g_2(i)} + \\sum_{i = 1}^{n}\\sum_{j = 1}^{n - 1}\\frac{f(j)g_3(i)}{g_4(i - j)}\n$$\n\n\u5316\u5f0f\u5b50\u90fd\u662f\u57fa\u7840\uff0c\u6240\u4ee5\u6211\u5c31\u4e3a\u4e86\u7b80\u6d01\u660e\u4e86\u76f4\u63a5\u7528\u51fd\u6570\u4ee3\u66ff\u4e86\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5f0f\u5b50\u76f4\u63a5\u5377\u79ef\u8ba1\u7b97\u5373\u53ef\uff0c\u590d\u6742\u5ea6$O(n\\log n)$\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cmath>\n#include <cstring>\n#include <algorithm>\n#include <queue>\n\n#define inv3 332748118\n#define file(s) freopen(s\".in\", \"r\", stdin), freopen(s\".out\", \"w\", stdout);\n\nusing namespace std;\n\nconst int N = 2e6 + 10, mod = 998244353;\n\ninline int read() {\n\tbool sym = 0; int res = 0; char ch = getchar();\n\twhile (!isdigit(ch)) sym |= (ch == '-'), ch = getchar();\n\twhile (isdigit(ch)) res = (res << 3) + (res << 1) + (ch ^ 48), ch = getchar();\n\treturn sym ? -res : res;\n}\n\nint n, m, ans, rev[N], c[N], r[N], W[2][N];\n\nint mul[N], rmul[N], irmul[N], inv[N], C[N];\n\nint f[N], g1[N], g2[N], g3[N], g4[N];\n\nvoid MOD(int &x) {while (x >= mod) x -= mod; while (x < 0) x += mod;}\n\nint power(int a, int x) {\n\tint res = 1;\n\twhile (x) {if (x & 1) res = 1ll * res * a % mod; a = 1ll * a * a % mod; x >>= 1;}\n\treturn res;\n}\n\nvoid init() {\n\tm = 1; while (m <= 3 * n) m <<= 1;\n\tfor (int i = 0; i < m; i++) rev[i] = rev[i >> 1] >> 1 | (i & 1 ? m >> 1 : 0);\n\tmul[0] = rmul[0] = inv[1] = 1; C[1] = n;\n\tfor (int i = 1; i <= n; i++) mul[i] = 1ll * mul[i - 1] * i % mod;\n\tfor (int i = 2; i <= m; i++) inv[i] = 1ll * (mod - mod / i) * inv[mod % i] % mod;\n\tfor (int i = 2; i <= n; i++) C[i] = 1ll * C[i - 1] * (n - i + 1) % mod * inv[i] % mod;\n\tfor (int i = 1; i <= 3 * n; i++) rmul[i] = 1ll * rmul[i - 1] * r[i] % mod;\n\tfor (int i = 1; i <= 3 * n; i++) irmul[i] = power(rmul[i], mod - 2);\n\tfor (int i = 1; i <= n - 1; i++) f[i] = 1ll * C[i + 1] * mul[n - i - 1] % mod * power(2, n - i) % mod;\n\tfor (int i = n + 2; i <= 3 * n - 1; i++) g1[i] = rmul[i];\n\tfor (int i = n + 1; i <= 2 * n; i++) g2[i] = 1ll * irmul[i] * c[i] % mod;\n\tfor (int i = n + 1; i <= 2 * n; i++) g3[i] = 1ll * rmul[i - 1] * c[i] % mod;\n\tfor (int i = 2; i <= 2 * n - 1; i++) g4[i] = irmul[i - 1];\n\tfor (int i = 1; i < m; i <<= 1) {\n\t\tW[0][i] = power(inv3, (mod - 1) / (i << 1));\n\t\tW[1][i] = power(3, (mod - 1) / (i << 1));\n\t}\n}\n\nvoid ntt(int a[], int opt) {\n\tfor (int i = 0; i < m; i++) if (i < rev[i]) swap(a[i], a[rev[i]]);\n\tfor (int i = 1; i < m; i <<= 1) {\n\t\tint t = W[opt][i];\n\t\tfor (int j = 0; j < m; j += i << 1) {\n\t\t\tint w = 1;\n\t\t\tfor (int k = j; k < j + i; k++) {\n\t\t\t\tint x = a[k], d = 1ll * w * a[k + i] % mod;\n\t\t\t\tMOD(a[k] = x + d); MOD(a[k + i] = x - d); w = 1ll * w * t % mod;\n\t\t\t}\n\t\t}\n\t}\n\tif (!opt) {for (int i = 0; i < m; i++) a[i] = 1ll * a[i] * inv[m] % mod;}\n}\n\nint main() {\n\tn = read();\n\tfor (int i = 1; i <= n; i++) c[i + n] = read(), MOD(ans += c[i + n]);\n\tfor (int i = 1; i <= n; i++) r[i] = r[i + n] = r[i + 2 * n] = read();\n\tinit(); ans = 1ll * ans * mul[n] % mod * power(2, n) % mod;\n\tntt(f, 1); ntt(g2, 1); ntt(g4, 1);\n\tfor (int i = 0; i < m; i++) g2[i] = 1ll * g2[i] * f[i] % mod, g4[i] = 1ll * g4[i] * f[i] % mod;\n\tntt(g2, 0); ntt(g4, 0);\n\tfor (int i = n + 2; i <= 3 * n - 1; i++) MOD(ans += 1ll * g1[i] * g2[i] % mod);\n\tfor (int i = n + 1; i <= 2 * n; i++) MOD(ans += 1ll * g3[i] * g4[i] % mod);\n\tprintf(\"%d\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1612762152,
        "uid": 28392,
        "name": "zrzring",
        "ccfLevel": 5,
        "title": "P7388 \u300cEZEC-6\u300d\u4fae\u8511"
    }
]