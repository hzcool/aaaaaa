[
    {
        "content": "\u8fd9\u9898\u554a\u2026\u2026\u771f\u7684\u662f\u65e0\u8bdd\u53ef\u8bf4\u4e86\uff0c\u505a\u5b8c\u6d51\u8eab\u8212\u7545\u7684\u90a3\u79cd\u3002\n\n\u6211\u4eec\u5148\u4e0d\u8003\u8651 corner case\u3002\n\n\u9996\u5148\u80af\u5b9a\u662f\u6309\u5957\u8def\u5047\u8bbe\u4e00\u8f6e\u8fc7\u5b8c\u4e4b\u540e\u8d77\u70b9\u79fb\u52a8\u7684\u5411\u91cf\u662f $(dx,dy)$\u3002\n\n\u6211\u4eec\u8003\u8651\u6bcf\u4e00\u6b21\u7684\u5230\u8fbe\u7684\u70b9\u5176\u5b9e\u662f\u5f88\u6709\u89c4\u5f8b\u7684\uff0c\u5bf9\u5e94\u70b9\u5750\u6807\u4e4b\u95f4\u4f1a\u6070\u597d\u5dee\u4e00\u4e2a $(dx,dy)$\u3002\u90a3\u6211\u4eec\u4e0d\u96be\u60f3\u5230\u7ed9\u5b83\u53d6\u6a21\u4e00\u4e0b\uff08\u4e0d\u59a8 $dx>0$\uff09\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u7528 $(x,y,t)$ \u6765\u8868\u793a $(x+t\\times dx,y+t\\times dy)$\uff0c\u540c\u65f6\u8981\u6c42 $x\\in[0,dx)$\u3002\n\n\u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u5982\u679c\u5148\u66b4\u529b\u8d70\u4e00\u8f6e\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e00\u4e2a\u8d70\u5230\u7684\u70b9 $(x,y,r)$\uff08\u6ce8\u610f\u8fd9\u91cc $r$ \u4e0d\u4e00\u5b9a\u7b49\u4e8e $0$\uff0c\u56e0\u4e3a\u6709\u53ef\u80fd\u8d70\u5230 $dx$ \u5916\u9762\u53bb\uff09\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u80fd\u8d70\u5230\u7684\u70b9\u662f $(x,y,r),(x,y,r+1),\\cdots,(x,y,r+k-1)$\uff0c\u8fd9\u672c\u8eab\u662f\u4e00\u4e2a\u5f88\u597d\u770b\u7684\u533a\u95f4\u5f62\u5f0f\u3002\u6ce8\u610f\u8d77\u59cb\u70b9\u8981\u7279\u5224\u4e00\u4e0b\uff0c\u4e0d\u8fc7\u8fd9\u4e0d\u91cd\u8981\u3002\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u6b63\u65b9\u5f62\u7684\u56db\u4e2a\u9876\u70b9\u3002\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u5982\u679c\u5bf9\u4e8e\u4e00\u4e2a $r$\uff0c\u8fd9\u56db\u4e2a\u70b9\u7684\u524d\u4e24\u7ef4\u5750\u6807\u90fd\u662f\u5408\u6cd5\u7684\uff0c\u90a3\u4e48\u5c31\u4f1a\u4ea7\u751f $1$ \u7684\u8d21\u732e\u3002\u90a3\u4e48\u6211\u4eec\u4e0d\u59a8\u6362\u5b83\u4e00\u4e0b\uff0c\u679a\u4e3e\u56db\u4e2a\u9876\u70b9\u7684\u524d\u4e24\u7ef4\u5750\u6807\uff08\u5b9e\u9645\u4e0a\u53ea\u4f1a\u6709\u7ebf\u6027\u4e2a\u8fd9\u6837\u7684\u5750\u6807\uff0c\u56e0\u4e3a\u5b83\u4eec\u4e00\u5b9a\u90fd\u5728\u7b2c\u4e00\u8f6e\u4e2d\u51fa\u73b0\u8fc7\uff09\uff0c\u7136\u540e\u8003\u8651\u5b83\u4eec\u51fa\u73b0\u7684\u4f4d\u7f6e\uff08\u4e00\u5b9a\u5206\u522b\u662f\u82e5\u5e72\u4e2a\u533a\u95f4\u7684\u5e76\uff0c\u8fd9\u4e2a\u5f00\u59cb\u626b\u4e00\u904d\u5c31\u53ef\u4ee5\u641e\u5b9a\uff09\u7684\u4ea4\uff0c\u8fd9\u73a9\u610f\u5c31\u5f88\u597d\u5904\u7406\u4e86\uff0c\u6765\u6311\u6218\u8fd9\u9053\u9898\u7684\u4eba\u60f3\u5fc5\u90fd\u4f1a\u3002\u6ce8\u610f\u6709\u53ef\u80fd\u6bd4\u5982\u679a\u4e3e\u5de6\u4e0b\u89d2\u7684\u65f6\u5019\u53d1\u73b0\u53e6\u5916\u4e09\u4e2a\u70b9\u91cc\u6709\u70b9\u7684 $x$ \u5750\u6807\u8fbe\u5230\u4e86 $dx$\uff0c\u90a3\u6ca1\u6709\u5173\u7cfb\uff0c\u8fd8\u662f\u5148\u8f6c\u6362\u6210\u6211\u4eec\u7684\u6807\u51c6\u5750\u6807\u5f62\u5f0f\uff0c\u5bf9\u641e\u51fa\u6765\u7684\u8303\u56f4\u5e73\u79fb\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n\u63a5\u4e0b\u6765\u662f\u4e00\u4e9b corner case\u3002\n\n1. $dx<0$\n\n\u628a\u6240\u6709 `E` \u548c `W` \u4ea4\u6362\u5c31\u597d\u4e86\u3002\n\n2. $dx=0,dy\\not=0$\n\n\u628a $dx$ \u548c $dy$ \u4ea4\u6362\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\u6709\u53ef\u80fd\u9700\u8981\u7528\u4e0a\u9762\u7b2c\u4e00\u79cd\u60c5\u51b5\u989d\u5916\u5904\u7406\u4e00\u4e0b\u3002\n\n3. $dx=dy=0$\n\n\u6bcf\u4e00\u8f6e\u90fd\u4e00\u6837\uff0c\u8d70\u4e00\u8f6e\u5c31\u597d\u4e86\u3002\u53ef\u4ee5\u628a $dx$ \u624b\u52a8\u6539\u6210\u5145\u5206\u5927\u6765\u56de\u907f\u5176\u4ed6\u95ee\u9898\u3002\n\n\u4ee3\u7801\uff08\u91c7\u7528\u7684\u533a\u95f4\u662f\u5de6\u95ed\u53f3\u5f00\u7684\uff09\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef pair<int,int>itv;\nint dx,dy;\nmap<itv,set<itv>>cnt;\nvoid init(){\n\tint n,k;\n\tstring s;\n\tcin>>n>>k>>s;\n\tauto op=[](int&x,int&y,char c){\n\t\tswitch(c){\n\t\t\tcase 'E':++x;break;\n\t\t\tcase 'N':++y;break;\n\t\t\tcase 'W':--x;break;\n\t\t\tcase 'S':--y;break;\n\t\t}\n\t};\n\tfor(char c:s)op(dx,dy,c);\n\tauto trans=[&s](vector<pair<char,char>>trs){\n\t\tfor(char&c:s)\n\t\t\tfor(auto[c1,c2]:trs)\n\t\t\t\tif(c==c1)c=c2;\n\t\t\t\telse if(c==c2)c=c1;\n\t};\n\tif(!dx){\n\t\tswap(dx,dy),trans({{'E','N'},{'W','S'}});\n\t\tif(!dx)dx=250637,k=1;\n\t}\n\tif(dx<0)dx=-dx,trans({{'E','W'}});\n\tauto ins=[](itv pos,itv val){\n\t\tauto&st=cnt[pos];\n\t\tauto itl=st.lower_bound({val.first,INT_MIN});\n\t\tif(itl!=st.begin()&&prev(itl)->second>=val.first)--itl;\n\t\tauto itr=st.upper_bound({val.second,INT_MAX});\n\t\tif(itl==itr)st.insert(val);\n\t\telse{\n\t\t\tint l=min(itl->first,val.first),r=max(prev(itr)->second,val.second);\n\t\t\tst.erase(itl,itr),st.emplace(l,r);\n\t\t}\n\t};\n\tins({0,0},{0,1});\n\tfor(int x=0,y=0;char c:s){\n\t\top(x,y,c);\n\t\tint dt=x/dx,px=x-dt*dx,py=y-dt*dy;\n\t\tif(px<0)px+=dx,py+=dy,--dt;\n\t\tins({px,py},{dt,k+dt});\n\t}\n}\nsigned main(){\n\tlong long ans=0;\n\tauto atval=[](int x,int y){\n\t\tvector<itv>ret;\n\t\tint dt=0;\n\t\tif(x==dx)x-=dx,y-=dy,dt=1;\n\t\tif(auto it=cnt.find({x,y});it!=cnt.end()){\n\t\t\tret.reserve(it->second.size());\n\t\t\tcopy(it->second.begin(),it->second.end(),back_inserter(ret));\n\t\t\tfor(auto&[l,r]:ret)l-=dt,r-=dt;\n\t\t}\n\t\treturn ret;\n\t};\n\tauto merge=[](auto x,auto y){\n\t\tvector<itv>ret;\n\t\tfor(auto pos=y.begin();auto[l,r]:x)\n\t\t\twhile(pos!=y.end()){\n\t\t\t\twhile(pos!=y.end()&&pos->second<=l)++pos;\n\t\t\t\tif(pos==y.end()||pos->first>=r)break;\n\t\t\t\tret.emplace_back(max(l,pos->first),min(r,pos->second));\n\t\t\t\tif(pos->second>=r)break;\n\t\t\t\telse ++pos;\n\t\t\t}\n\t\treturn ret;\n\t};\n\tfor(init();auto[pos,iv]:cnt){\n\t\tauto[x,y]=pos;\n\t\tfor(auto[l,r]:merge(merge(atval(x,y),atval(x+1,y+1)),merge(atval(x+1,y),atval(x,y+1))))\n\t\t\tans+=r-l;\n\t}\n\treturn cout<<ans<<endl,0;\n}\n```",
        "postTime": 1646966202,
        "uid": 250637,
        "name": "UnyieldingTrilobite",
        "ccfLevel": 9,
        "title": "\u8d85\u8d85\u8d85\u8d85\u8d85\u723d\u7684\u4e00\u9053\u9898\uff01"
    },
    {
        "content": "\u8def\u5f84\u4e0a\u7ecf\u8fc7\u7684\u6240\u6709\u70b9\u53ef\u4ee5\u7528\u6309\u7167\u8f6e\u6b21\u548c\u4f4d\u7f6e\u8868\u793a\u4e3a$(x,y,r)$\u8868\u793a\u7b2c$r$\u8f6e\u8d70\u5728$(x,y)$\u4f4d\u7f6e\n\n\u5982\u679c\u6211\u4eec\u9ed8\u8ba4\u6bcf\u6b21\u7684\u8d77\u70b9\u90fd\u662f$(0,0)$\u90a3\u4e48$(x,y,r)$\u8868\u793a\u7684\u5c31\u662f$(x+r\\times tx,y+r\\times ty)$\n\n\u6211\u4eec\u5982\u679c\u628a\u6240\u6709\u7684\u70b9\u7684$x$\u5750\u6807\u90fd\u9650\u5236\u5728$0$\u5230$tx$\u8303\u56f4\u5185\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u628a\u6240\u6709\u672c\u8d28\u4e00\u6837\u7684\u70b9\u90fd\u538b\u5728\u4e86\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u53ea\u8981\u8f6e\u6570\u4e00\u81f4\uff0c\u90a3\u5c31\u662f\u5b8c\u5168\u91cd\u5408\u7684\u4e24\u4e2a\u70b9\n\n\u5bf9\u4e8e$x$\u4e0d\u5728$0$\u5230$tx$\u4e4b\u95f4\u7684\u70b9\uff0c\u6211\u4eec\u901a\u8fc7\u8c03\u6574\u8f6e\u6570\u4f7f\u5b83\u5728\u5408\u6cd5\u533a\u95f4\u5185\n\n\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u53ef\u4ee5\u5904\u7406\u51fa\u5b58\u5728\u7684\u8f6e\u6570\u533a\u95f4\uff0c\u8003\u8651\u6bcf\u4e2a\u5e97\u4f5c\u4e3a\u5de6\u4e0b\u89d2\u65f6\uff0c\u5176\u5b83\u4e09\u4e2a\u70b9\u5bf9\u5e94\u7684\u4f4d\u7f6e\u548c\u8f6e\u6570\u533a\u95f4\uff0c\u56db\u4e2a\u70b9\u6240\u5bf9\u5e94\u7684\u8f6e\u6570\u540c\u65f6\u5408\u6cd5\u90a3\u5c31\u8ba1\u5165\u7b54\u6848\uff0c\u4e5f\u5c31\u662f\u5c06\u533a\u95f4\u7edf\u4e00\u6807\u51c6\u540e\u6c42\u4ea4\u96c6\u5373\u53ef\n\n$tx=0$\u7684\u65f6\u5019\u8981\u7279\u5224\n\n\u5177\u4f53\u7ec6\u8282\u53ef\u4ee5\u770b\u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<queue>\n#include<algorithm>\n#include<cstring>\n#include<set>\n#include<vector>\n#include<cmath>\n#include<map>\n#define PII pair<int,int>\n#define pb push_back\n#define ep emplace_back\n#define mp make_pair\n#define fi first\n#define se second\nusing namespace std;\ninline int read(){\n\tint x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){ if(c=='-') f=-1; c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<3)+(x<<1)+(c^48);c=getchar();}\n\treturn f==1?x:~x+1;\n}\ninline void print(int x){\n\tif(x<0) putchar('-'),x=~x+1;\n\tif(x>=10) print(x/10);\n\tputchar((x%10)|48);\n}\nint n,k;\nchar str[100010];\nmap<PII,vector<PII> >Map;\nint tx,ty;\nvoid merge(vector<PII>&s,vector<PII>t){\n\tvector<PII>res;\n\tauto it=t.begin();\n\tfor(auto i:s){\n\t\twhile(it!=t.end()){\n\t\t\twhile(it!=t.end()&&it->se<i.fi) ++it;\n\t\t\tif(it==t.end()) break ;\n\t\t\tif(it->fi>i.se) break ;\n\t\t\tres.ep(max(it->fi,i.fi),min(it->se,i.se));\n\t\t\tif(it->se>i.se) break ;\n\t\t\t++it;\n\t\t}\n\t}\n\ts=res;\n}\nint main(){\n\tn=read(),k=read();\n\tscanf(\"%s\",str+1);\n\tfor(int i=1;i<=n;++i){\n\t\tswitch(str[i]){\n\t\t\tcase 'E':++tx;break ;\n\t\t\tcase 'N':++ty;break ;\n\t\t\tcase 'W':--tx;break ;\n\t\t\tcase 'S':--ty;break ;\n\t\t}\n\t}\n\tif(tx==0&&ty==0) {k=1;tx=1e9;}\n\telse if(tx==0){\n\t\tswap(tx,ty);\n\t\tfor(int i=1;i<=n;++i){\n\t\t\tswitch(str[i]){\n\t\t\t\tcase 'E':str[i]='N';break;\n\t\t\t\tcase 'N':str[i]='E';break;\n\t\t\t\tcase 'W':str[i]='S';break;\n\t\t\t\tcase 'S':str[i]='W';break;\n\t\t\t}\n\t\t}\n\t}\n\tif(tx<0){\n\t\tfor(int i=1;i<=n;++i){\n\t\t\tswitch(str[i]){\n\t\t\t\tcase 'E':str[i]='W';break;\n\t\t\t\tcase 'W':str[i]='E';break;\n\t\t\t}\n\t\t}\n\t\ttx=-tx;\n\t}\n\tif(ty<0){\n\t\tfor(int i=1;i<=n;++i){\n\t\t\tswitch(str[i]){\n\t\t\t\tcase 'N':str[i]='S';break;\n\t\t\t\tcase 'S':str[i]='N';break;\n\t\t\t}\n\t\t}\n\t\tty=-ty;\n\t}\n\tMap[mp(0,0)].pb(mp(1,k));\n\tfor(int i=1;i<=n;++i){\n\t\tstatic int x=0,y=0;\n\t\tswitch(str[i]){\n\t\t\tcase 'E':++x;break ;\n\t\t\tcase 'N':++y;break ;\n\t\t\tcase 'W':--x;break ;\n\t\t\tcase 'S':--y;break ;\n\t\t}\n//\t\tprintf(\"i:%d,x:%d,y:%d\\n\",i,x,y);\n\t\tint d=x/tx;\n\t\tint ax=x-d*tx,ay=y-d*ty;\n\t\tif(ax<0) --d,ax+=tx,ay+=ty;\n//\t\tprintf(\"d:%d,ax:%d,ay:%d\\n\\n\\n\",d,ax,ay);\n\t\tMap[mp(ax,ay)].pb(mp(d+1,d+k));\n\t}\n\tfor(auto &i:Map){\n\t\tauto &v=i.se;\n\t\tsort(v.begin(),v.end());\n\t\tint l=-1e6,r=-1e6;\n\t\tvector<PII>nw;\n\t\tfor(auto p:v){\n\t\t\tif(l==-1e6){\n\t\t\t\tl=p.fi,r=p.se;\n\t\t\t}\n\t\t\telse if(p.fi<=r) r=max(r,p.se);\n\t\t\telse{\n\t\t\t\tnw.ep(l,r);\n\t\t\t\tl=p.fi,r=p.se;\n\t\t\t}\n\t\t}\n\t\tnw.ep(l,r);\n\t\tv=nw;\n\t}\n\tauto mt=[&](PII x){\n\t\tif(x.fi>=tx) x.fi-=tx,x.se-=ty;\n\t\treturn x;\n\t};\n\tlong long ans=0;\n\tfor(auto i:Map){\n\t\tPII nod=i.fi;\n\t\tPII x2=mp(nod.fi+1,nod.se),x3=mp(nod.fi,nod.se+1),x4=mp(nod.fi+1,nod.se+1);\n\t\tif(Map.count(mt(x2))&&Map.count(mt(x3))&&Map.count(mt(x4))){\n\t\t\tauto gs=[&](PII x){\n\t\t\t\tif(x.fi>=tx){\n\t\t\t\t\tx.fi-=tx,x.se-=ty;\n\t\t\t\t\tvector<PII>t=Map[x];\n\t\t\t\t\tvector<PII>res(t.size());\n\t\t\t\t\tauto minus=[&](PII a){\n\t\t\t\t\t\treturn mp(a.fi-1,a.se-1);\n\t\t\t\t\t};\n//\t\t\t\t\tprintf(\"Mns:\\n\");\n//\t\t\t\t\tfor(auto a:t) printf(\"%d %d\\n\",a.fi,a.se);\n\t\t\t\t\tstd::transform(t.begin(),t.end(),res.begin(),minus);\n//\t\t\t\t\tprintf(\"Res:\\n\");\n//\t\t\t\t\tfor(auto a:res) printf(\"%d %d\\n\",a.fi,a.se);\n//\t\t\t\t\tprintf(\"\\n\\n\");\n\t\t\t\t\treturn res;\n\t\t\t\t}\n\t\t\t\telse return Map[x];\n\t\t\t};\n\t\t\tvector<PII>v=i.se;\n\t\t\tmerge(v,gs(x2));merge(v,gs(x3));merge(v,gs(x4));\n\t\t\tfor(auto x:v) ans+=x.se-x.fi+1;\n//\t\t\tprintf(\"%d %d ans:%d\\n\",nod.fi,nod.se,ans);\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1608555720,
        "uid": 131933,
        "name": "sunzh",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5102 \u3010[JOI 2016 Final]\u9886\u5730\u3011"
    }
]