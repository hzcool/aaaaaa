[
    {
        "content": "\u8003\u8651\u6700\u5927\u7684$f(i,j)=| \\sum_{p=i}^j a_p |$\u672c\u8d28\u662f\u4ec0\u4e48\r\n\r\n\u6362\u4e3a\u524d\u7f00\u548c\u7684\u5f62\u5f0f $f(i,j)=|pre_j - pre_i|$\r\n\r\n\u5c06\u7edd\u5bf9\u503c\u62c6\u6389 $$f(i,j)=\\left\\{\\begin{matrix} pre_j-pre_i & if\\ pre_{j}>pre_{i}\\\\ pre_i-pre_j & if\\ pre_{j} \\le pre_{i} \\end{matrix}\\right.$$\r\n\r\n\u6240\u4ee5$\\max_{1 \\le i \\le j \\le n} f(i,j)$\r\n\r\n$=\\max pre_i - \\min pre_j$\r\n\r\n\u5982\u679c\u7ed9\u6574\u4e2a\u6570\u7ec4\u52a0\u4e0a $x$\uff0c\u90a3\u4e48 $pre'_i=pre_i+ix$\r\n\r\n\u90a3\u4e48\u5f53\u6211\u4eec\u786e\u5b9a\u4e86\u6574\u4e2a\u6570\u7ec4\u52a0\u4e0a\u7684\u6570\u5b57$x$\uff0c\u6211\u4eec\u5c31\u80fd\u786e\u5b9a\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u524d\u7f00\u548c\uff0c\u8003\u8651\u5982\u4f55\u6c42\u51fa\u6700\u5927\u7684\u524d\u7f00\u548c\u548c\u6700\u5c0f\u7684\u524d\u7f00\u548c\u3002\r\n\r\n\u8fd9\u4e2a\u662f\u4e2a\u4e00\u6b21\u51fd\u6570\u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u524d\u9762\u7684 $n+1$ \u4e2a\u4e00\u6b21\u51fd\u6570\u52a0\u5165\u5750\u6807\u7cfb\uff0c\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u5305\u8868\u793a\u6574\u4e2a\u6570\u7ec4\u52a0\u4e0a$x$\u65f6\u6700\u5927\u7684\u524d\u7f00\u548c\uff0c\u7ef4\u62a4\u4e00\u4e2a\u4e0a\u51f8\u5305\u8868\u793a\u6700\u5c0f\u7684\u524d\u7f00\u548c\u3002\r\n\r\n\u8fd9\u4e2a\u662f\u6837\u4f8b\u7684\u56fe\uff0c\u5176\u4e2d\u7d2b\u8272\u7684\u4e3a5\u6761\u4e00\u6b21\u51fd\u6570\uff0c\u9ec4\u8272\u7684\u4e3a\u4e0b\u51f8\u5305\uff0c\u7ea2\u8272\u7684\u4e3a\u4e0b\u51f8\u5305\u3002\u90a3\u4e48\u5f53\u6211\u4eec\u8981\u6c42\u6574\u4e2a\u6570\u7ec4\u52a0\u4e0a$h$\u7684\u7b54\u6848\u65f6\uff0c$x$\u5750\u6807\u4e3a$h$\u7684\u4e0b\u51f8\u5305\u7684$y$\u5750\u6807\u51cf\u53bb$x$\u5750\u6807\u4e3a$h$\u7684\u4e0a\u51f8\u5305\u7684$y$\u5750\u6807\u5f97\u5230\u7684\u5dee\u5373\u4e3a\u8be2\u95ee\u7684\u7b54\u6848\u3002\r\n\r\n![](https://cdn.luogu.com.cn/upload/pic/23616.png)\r\n\r\n\u90a3\u4e48\u6211\u4eec\u7ef4\u62a4\u51f8\u5305\uff0c\u8bb0\u4e0b\u51f8\u5305\u4e0a\u6bcf\u6761\u7ebf\u6bb5\u4e24\u7aef\u7684\u4f4d\u7f6e\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4e8c\u5206\u6a2a\u5750\u6807$h$\u662f\u5728\u54ea\u4e2a\u7ebf\u6bb5\u4e0a\uff0c\u6c42\u51fa\u76f8\u5e94\u7684$y$\u503c\u3002\r\n\r\n\u6700\u540e\u4e0a\u51f8\u5305\u7684\u503c-\u4e0b\u51f8\u5305\u7684\u503c\u5373\u4e3a\u7b54\u6848\u3002\r\n\r\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n\\ log\\ n)$\r\n\r\n```cpp\r\n#include <bits/stdc++.h>\r\n#define MN 200005\r\n#define ll long long\r\nusing namespace std; \r\n    int n,m,l,r,mid,a,b,x;\r\n    ll s[MN],mx[MN],mxn,mn[MN],mnn,pre;\r\n    double mxp[MN],mnp[MN];\r\ninline int read()\r\n{\r\n    int x=0,f=1;char c;\r\n    while((c=getchar())<'0'||c>'9')if(c=='-')f=-1;\r\n    for(;c>='0'&&c<='9';c=getchar())x=x*10+c-'0';\r\n    return x*f;\r\n}\r\ninline double cal(int a,int b){return double(s[b]-s[a])/(a-b);}\r\nint main()\r\n{\r\n    n=read();m=read();\r\n    for(int i=1;i<=n;i++)\r\n    {\r\n        s[i]=s[i-1]+read();\r\n        while(mxn&&cal(i,mx[mxn])<=cal(i,mx[mxn-1]))--mxn;mx[++mxn]=i;\r\n        while(mnn&&cal(i,mn[mnn])>=cal(i,mn[mnn-1]))--mnn;mn[++mnn]=i;\r\n    }\r\n    for(int i=1;i<=mxn;i++)mxp[i]=cal(mx[i],mx[i-1]);\r\n    for(int i=1;i<=mnn;i++)mnp[i]=cal(mn[i],mn[i-1]);\r\n    while(m--)\r\n    {\r\n        x=(read()+pre)%(4*n+1)-2*n;\r\n        if(x<=mxp[1])a=0;\r\n        else for(l=1,r=mxn;l<=r;)\r\n        {\r\n            mid=(l+r)>>1;         \r\n            if(x>=mxp[mid])a=mx[mid],l=mid+1;\r\n            else r=mid-1;\r\n        }\r\n        if(x>=mnp[1])b=0;\r\n        else for(l=1,r=mnn;l<=r;)\r\n        {\r\n            mid=(l+r)>>1;\r\n            if(x<=mnp[mid])b=mn[mid],l=mid+1;\r\n            else r=mid-1;\r\n        }\r\n        printf(\"%lld\\n\",pre=(ll)(a-b)*x+s[a]-s[b]);\r\n    }\r\n    return 0;\r\n}\r\n```",
        "postTime": 1531582495,
        "uid": 9433,
        "name": "FlierKing",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4756 \u3010Added Sequence\u3011"
    },
    {
        "content": "# P4756 Added Sequence 2018\u6d1b\u8c377\u6708\u6708\u8d5b T5\n## \u9898\u76ee\u63cf\u8ff0\n\u5b9a\u4e49\n$~~~~~~~~~~f(i,j)=\u2223\\sum_{p=i} ^j a_p\u2223$   \n\u5176\u4e2d $|x|$ \u8868\u793a $x$ \u7684\u7edd\u5bf9\u503c\u3002  \n\u5b9a\u4e49\u4e00\u4e2a\u6570\u7ec4\u7684\u7f8e\u4e3d\u5ea6\u4e3a $ max_{1\\leq i\\leq j\\leq N}f(i,j)$\u3002  \n\u6bcf\u5f53\u4ed6\u5c06\u6574\u4e2a\u6570\u7ec4\u52a0\u4e0a $x$ \uff0c\u8bf7\u4f60\u56de\u7b54\u6b64\u65f6\u7684\u7f8e\u4e3d\u5ea6\u3002  \n~~\u6ce8\u610f\uff0c\u4f60\u7684\u7b97\u6cd5\u5fc5\u987b\u4e3a\u5728\u7ebf\u7684\u3002~~( \u7f16\u8005\u624b\u52a8\u5220\u9664 \uff09\n## \u5206\u6790\n$1$ . \u770b\u5230\u4e24\u4e2a\u5f0f\u5b50\u4e0d\u8981\u614c\uff0c\u5148\u5316\u7b80\u518d\u8bf4\u3002  \n$2$ . \u8fd9\u4e00\u9898\u9700\u8981\u8ba1\u7b97\u51e0\u4f55\u4e2d\u7684**\u51f8\u5305**\u77e5\u8bc6\uff0c\u5982\u679c\u6ca1\u6709\u5b66\u8fc7\u7684\u53ef\u4ee5\u770b\u4e00\u770b\u6211\u7684\u53e6\u4e00\u7bc7[\u4e8c\u7ef4\u51f8\u5305](https://www.luogu.org/blog/cyx-TombRaider/p2742-mu-ban-er-wei-tu-bao-by-hydranazis)\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u5148\u625340\u5206\u7684\u66b4\u529b\u3002\n## \u89e3\u7b54\n\u6570\u5b66\u90e8\u5206\uff1a  \n$~~~~~~~~~~~~~~~~~~~~~~~~f(i,j)=$ $a_i$\u5230$a_j$\u7684\u548c\u7684\u7edd\u5bf9\u503c $=|pre_j-pre_i |$  \n\u663e\u7136\uff0c\u5f53\u4e14\u4ec5\u5f53 $pre_i$\u548c $pre_j$ \u4e2d\u4e00\u4e2a\u6700\u5c0f\uff0c\u4e00\u4e2a\u6700\u5927\u65f6\uff0c$f(i,j)$\u624d\u53ef\u4ee5\u53d6\u5230\u6700\u503c\uff1a\n$~~~~~~~~~~~~~~~~~~~~~~~~max(f(i,j))=max(pre_i)-min(pre_j)$  \n\u90a3\u4e48\uff0c\u6574\u4e2a\u6570\u7ec4\u52a0\u4e0a $x$ \u4f7f\u5f97\u524d\u7f00\u548c\u6570\u7ec4\u52a0\u4e0a\u533a\u95f4\u548c\uff0c\u53d1\u73b0\u662f\u4e2a\u4e00\u6b21\u51fd\u6570\u7684\u5f62\u5f0f\uff1a  \n$~~~~~~~~~~~~~~~~~~~~~~~~pre_i^\\prime=pre_i+i\\times x$   \n\u7136\u540e$max(f(i,j))$\u5c31\u662f\u56fe\u5f62\u7684\u6700\u5927\u51cf\u53bb\u6700\u5c0f \n![](https://cdn.luogu.com.cn/upload/pic/24933.png)\n\u90a3\u4e48\u4f60\u5c31\u4f1a\u95ee\uff0c\u4f60\u8fd9\u4e2a\u9898\u89e3\u4e0d\u5c31\u662f\u548c\u4e0a\u9762\u7684\u4e00\u6837\u5417\uff01  \n\u7ee7\u7eed\u770b,\u6211\u4eec\u6c42\u76f8\u90bb\u4e24\u6761\u76f4\u7ebf\u7684\u4ea4\u70b9\u7684\u5750\u6807\uff1a  \n$~~~~~~~~~~~~~~~~~~~~~~~~pre_i+i\\times x=pre_{(i+1)}+(i+1)\\times x$  \n\u5316\u7b80\u5f97\uff1a  \n$~~~~~~~~~~~~~~~~~~~~~~~~x=pre_i-pre_{(i+1)}=-a_{(i+1)}$  \n\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u51cf\u5c0f\u6211\u4eec\u7684\u8ba1\u7b97\u91cf\u3002  \n\u901a\u8fc7\u4e8c\u7ef4\u51f8\u5305\u7684\u5206\u522b\u5bf9\u4e0a\u548c\u4e0b\u7684\u7ef4\u62a4\uff0c\u6211\u4eec\u518d\u6765\u4e8c\u5206 $x$ \u5728\u51f8\u5305\u4e0a\u7684\u4f4d\u7f6e\u5373\u53ef\u7b97\u51fa\u3002  \n\u5176\u5b9e\u9898\u76ee\u4e2d\u7684\u5f3a\u5236\u5728\u7ebf\u662f\u5047\u7684\uff0c\u6570\u636e\u8303\u56f4$-2n $~$ 2n$, \u5b8c\u5168\u53ef\u4ee5\u5b9e\u73b0\uff08 \u6709\u5de8\u4f6c[newbie314159](https://www.luogu.org/space/show?uid=54979)\u5df2\u7ecf\u6210\u529f\u5b9e\u73b0\uff0c\u53bb\u56f4\u89c2\u4e00\u4e0b \uff09\nOK\uff0c\u5982\u679c\u4e0d\u4f1a\u51f8\u5305\u5c31\u770b\u4e0b\u4ee3\u7801\uff1a\n```cpp\n// luogu-judger-enable-o2\n#include <cstdio>\n#include <iostream>\n#include <cmath>\n#include <cstring>\n#include <cstdlib>\n#include <algorithm>\n#include <queue>\n#include <vector>\n#include <stack>\n#define N 300001\n#define inf 2147483647\n#define LL long long\n#define mod 99999997\n#define ls (p*2)\n#define rs (p*2+1)\nusing namespace std;\ninline LL read()\n{\n  LL f=1,x=0;char ch=getchar();\n  while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n  while(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n  return f*x;\n}\nLL n,m,x[N],pre[N],a[N],max_st[N],max_top=1,min_st[N],min_top=1,maxi,mini,maxx,minn,l,r,mid;//st->\u50a8\u5b58\u51f8\u5305\u76f4\u7ebf\u7684\u6808\uff0ctop->\u6808\u9876\uff0ci->\u4e8c\u5206\u65f6\u5728\u51f8\u5305\u7684\u54ea\u4e00\u90e8\u5206\uff0cx->\u6700\u5927\u548c\u6700\u5c0f\u503c\u3002\ninline bool judge_slope(int a,int b,int c)\n{\n  return (pre[a]-pre[b])*(b-c)<=(pre[b]-pre[c])*(a-b);//\u8ba1\u7b97\u659c\u7387\uff0c\u6211\u559c\u6b22\u7528\u53d8\u5f62\u540e\u7528\u4e58\u6cd5\uff0c\u4e0d\u6389\u7cbe\u3002\n}\nint main()\n{\n  n=read(),m=read();\n  for(int i=1;i<=n;i++)pre[i]=pre[i-1]+(a[i]=read());\n  for(int i=1;i<=n;i++)\n  {\n    while(max_top>1&&judge_slope(max_st[max_top-1],max_st[max_top],i))max_top--;\n    max_st[++max_top]=i;\n    while(min_top>1&&!judge_slope(min_st[min_top-1],min_st[min_top],i))min_top--;\n    min_st[++min_top]=i;//\u6807\u51c6\u7684\u51f8\u5305\u7ef4\u62a4\u3002\n  }\n  //for(int i=1;i<=max_top;i++)cout<<max_st[i]<<' ';cout<<endl;\n  //for(int i=1;i<=min_top;i++)cout<<min_st[i]<<' ';cout<<endl;\n  for(int i=1;i<=m;i++)\n  {\n    x[i]=read();\n    x[i]=(x[i]+x[i-1])%(4*n+1)-2*n;//\u522b\u5fd8\u4e86\u52a0\u4e0a\u4e0a\u4e00\u6b21\u7684\u3002\n    //cout<<x[i]<<endl;\n    l=2,r=max_top,maxi=0;\n    while(l<=r)\n    {\n      mid=(l+r)/2;\n      //cout<<\"mid \"<<mid<<endl;\n      if((double)(pre[max_st[mid-1]]-pre[max_st[mid]])/(double)(max_st[mid-1]-max_st[mid])>=-x[i])//\u4e3a\u4ec0\u4e48\u662f-x\uff0c\u56e0\u4e3a\u6211\u6240\u6709\u7684\u76f4\u7ebf\u5168\u90e8\u662f\u53cd\u7740\u5efa\u7684\u3002\n        maxi=mid,l=mid+1;\n      else r=mid-1;\n    }\n    //cout<<endl;\n    maxx=pre[max_st[maxi]]+x[i]*max_st[maxi];\n    //cout<<\"max:\"<<maxx<<endl;\n    l=2,r=min_top,mini=0;\n    while(l<=r)\n    {\n      mid=(l+r)/2;\n      //cout<<\"mid \"<<mid<<endl;\n      if((double)(pre[min_st[mid-1]]-pre[min_st[mid]])/(double)(min_st[mid-1]-min_st[mid])<=-x[i])\n        mini=mid,l=mid+1;\n      else r=mid-1;\n    }\n    minn=pre[min_st[mini]]+x[i]*min_st[mini];//\u5e26\u5165\u3002\n    //cout<<\"min:\"<<minn<<endl;\n    //x[i]=fabs(maxx-minn);\n    //cout<<\"x: \"<<x[i]<<endl;\n    printf(\"%lld\\n\",x[i]=fabs(maxx-minn));//\u4e00\u5b9a\u8981\u53d6\u7edd\u5bf9\u503c\u3002\n  }\n  return 0;\n}\n\n```\n## \u603b\u7ed3\n\u5b8c\u5168\u641e\u61c2\u8fd9\u4e2a\u6bd2\u7624\u9898\u7684\u51f8\u5305\u82b1\u4e86\u6211\u4e00\u4e2a\u661f\u671f\u7684\u65f6\u95f4\uff0c\u624d\u628a\u8fd9\u9053\u9898\u6253\u5b8c\u3002\u4f46\u662f\u4e00\u770b\u5927\u5bb6\u4ea4\u7684\u4ee3\u7801\uff0c\u5475\u5475~~",
        "postTime": 1532393790,
        "uid": 60089,
        "name": "Trinity",
        "ccfLevel": 0,
        "title": "P4756 Added Sequence by HydraNazis"
    },
    {
        "content": "\u8fd9\u9053\u9898\u53ef\u4ee5\u7528\u674e\u8d85\u7ebf\u6bb5\u6811\u505a\uff0c\u4e0d\u4f1a\u7684\u540c\u5b66\u8bf7\u51fa\u95e8\u5de6\u8f6c\uff0c~~\u91cd\u5b66\u5c0f\u5b66\u4e8c\u5e74\u7ea7~~  \n\u53ef\u4ee5\u53d1\u73b0\u8fd9\u9053\u9898\u5c31\u662f\u6c42\u6700\u5927\u524d\u7f00\u548c\u548c\u6700\u5c0f\u524d\u7f00\u548c\u7136\u540e\u505a\u5dee\u5373\u53ef  \n\u4e00\u4e2a\u70b9\u7684\u524d\u7f00\u548c\u4e0e\u5168\u5c40\u52a0\u7684\u6570\u662f\u4e00\u4e2a\u4e00\u6b21\u51fd\u6570\uff0c\n\u6c42\u5176\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\u5c31\u662f\u674e\u8d85\u6811\u7684\u6a21\u677f\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e6+5;\nstruct line{\n\tlong long k,b;\n\tline(long long x=0,long long y=0){k=x;b=y;}\n\tinline long long operator()(long long x){return k*x+b;}\n}p[N];\nstruct lct{\n\t#define ls (now<<1)\n\t#define rs (now<<1|1)\n\t#define mid (lef+rig>>1)\n\t#define lc ls,lef,mid\n\t#define rc rs,mid+1,rig\n\t#define nc now,lef,rig\n\tint tr[N<<2];\n\tvoid ins(int x,int now=1,int lef=-1e6,int rig=1e6){\n\t\tif(!tr[now]){tr[now]=x;return ;}\n\t\tif(p[x](mid)>p[tr[now]](mid))swap(x,tr[now]);\n\t\tif(p[x](lef)>p[tr[now]](lef))ins(x,lc);\n\t\tif(p[x](rig)>p[tr[now]](rig))ins(x,rc);\n\t}long long ask(int x,int now=1,int lef=-1e6,int rig=1e6){\n\t\tif(!tr[now])return -1e18;\n\t\tlong long ans=p[tr[now]](x);\n\t\tif(x<=mid)ans=max(ask(x,lc),ans);\n\t\telse ans=max(ask(x,rc),ans);\n\t\treturn ans;\n\t}\n\t#undef ls\n\t#undef rs\n\t#undef mid\n\t#undef lc\n\t#undef rc\n\t#undef nc\n}A,B;\nint n,m;\nlong long sum,lastans;\nint main(){\n\tscanf(\"%d%d\",&n,&m);n++;A.ins(1);B.ins(n+1);\n\tfor(int x,i=2;i<=n;i++){\n\t\tscanf(\"%d\",&x);sum+=x;\n\t\tp[i]=line(i-1,sum);p[i+n]=line(-i+1,-sum);\n\t\tA.ins(i);B.ins(i+n);\n\t}for(int x;m--;){\n\t\tscanf(\"%d\",&x);\n\t\tx=(x+lastans)%(4*n-3)-2*n+2;\n\t\tprintf(\"%lld\\n\",lastans=A.ask(x)+B.ask(x));\n\t}return 0;\n}\n```",
        "postTime": 1607912202,
        "uid": 103990,
        "name": "asd_a",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4756 \u3010Added Sequence\u3011"
    },
    {
        "content": "\u8fd9\u9898\u5c31\u662f\u4e00\u4e2a\u5168\u5c40\u52a0\u5168\u5c40\u6700\u5927\u5b50\u6bb5\u548c\u3002\u7edd\u5bf9\u503c\u53ef\u4ee5\u901a\u8fc7\u6b63\u8d1f\u4e24\u79cd\u60c5\u51b5\u5408\u5e76\u628a\u5b83\u53bb\u6389\u3002\n\n\u9898\u76ee\u4e2d\u7684\u5f3a\u5236\u5728\u7ebf\uff0c\u5b9e\u9645\u4e0a\u503c\u57df\u8303\u56f4\u53ea\u6709$-2n\\sim 2n$\uff0c\u53ef\u4ee5\u5168\u90e8\u8be2\u95ee\u51fa\u6765\u3002\u4e8e\u662f\u53ef\u4ee5\u79bb\u7ebf\u3002\n\n\u5982\u679c\u505a\u8fc7[\\[Ynoi2015\\]\u4e16\u4e0a\u6700\u5e78\u798f\u7684\u5973\u5b69](https://www.luogu.org/problemnew/show/P5073)\u6216\u8005[\\[Ynoi2018\\]\u672b\u65e5\u65f6\u5728\u505a\u4ec0\u4e48?\u6709\u6ca1\u6709\u7a7a?\u53ef\u4ee5\u6765\u62ef\u6551\u5417?](https://www.luogu.org/problemnew/show/P4680)\u7684\u8bdd\uff0c\u5e94\u8be5\u5bf9\u8fd9\u79cd\u4e1c\u897f\u6bd4\u8f83\u654f\u611f\u3002\n\n\u6211\u4eec\u4ee4$(i,mx)$\u8868\u793a\u957f\u5ea6\u4e3a$i$\u65f6\uff0c\u5176\u6700\u5927\u5b50\u6bb5\u548c\u4e3a$x$\uff0c\u5219\u5176\u5168\u5c40\u52a0\u4e0a\u4e00\u4e2a\u6570\u540e\uff0c\u80fd\u53d6\u5230\u6700\u5927\u503c\u7684\u70b9\u4e00\u5b9a\u5728\u8fd9\u6837\u7684\u70b9\u6784\u6210\u7684\u51f8\u5305\u4e0a\u3002\n\n\u6c42\u8fd9\u4e2a\u51f8\u5305\u5c31\u53ef\u4ee5\u7528\u5230\u7ecf\u5178\u7684\u7b97\u6cd5\uff0c\u5206\u6cbb+\u95f5\u53ef\u592b\u65af\u57fa\u548c\u5408\u5e76\u51f8\u5305\u4e86\u3002\n\n\u5373\u4ee4$L$\u8868\u793a\u5de6\u534a\u8fb9\u7684\u6700\u5927\u5b50\u6bb5\u548c\u51f8\u5305\uff0c$R$\u8868\u793a\u53f3\u534a\u8fb9\u7684\u6700\u5927\u5b50\u6bb5\u548c\u51f8\u5305\uff0c$s$\u8868\u793a\u5de6\u534a\u8fb9\u7684\u540e\u7f00\u548c\u51f8\u5305\uff0c$p$\u8868\u793a\u53f3\u534a\u8fb9\u7684\u524d\u7f00\u548c\u51f8\u5305\u3002\n\n\u5219\u8de8\u8d8a\u4e2d\u70b9\u7684\u6700\u5927\u5b50\u6bb5\u548c\u4fe1\u606f\u53ef\u4ee5\u4ee5\u901a\u8fc7$s$\u548c$p$\u4e2d\u7684\u70b9\u4e24\u4e24\u76f8\u52a0\u5f97\u5230\uff0c\u800c\u8fd9\u4e2a\u70b9\u96c6\u7684\u51f8\u5305\u5c31\u901a\u8fc7\u95f5\u53ef\u592b\u65af\u57fa\u548c\u5f97\u5230\u3002\u7136\u540e\u518d\u548c$L,R$\u5206\u522b\u5408\u5e76\u5373\u4e3a\u6574\u4e2a\u533a\u95f4\u7684\u51f8\u5305\u3002\u603b\u590d\u6742\u5ea6$O(n\\log n)$\u3002\u8be6\u7ec6\u7684\u4e5f\u53ef\u4ee5\u53c2\u8003\u4e0a\u9762\u4e24\u9053Ynoi\u7684\u9898\u89e3\u3002\n\n\u7136\u540e\u7531\u4e8e\u8d44\u74f7\u79bb\u7ebf\u4e86\uff0c\u53ef\u4ee5\u770b\u6210\u52a0\u7684\u6570\u5355\u8c03\u9012\u589e\uff0c\u90a3\u4e48\u53d6\u5230\u6700\u5927\u503c\u7684\u70b9\u4e5f\u662f\u5355\u8c03\u7684\uff0c\u4e8e\u662f\u76f4\u63a5\u7528\u4e00\u4e2a\u6307\u9488\u5728\u51f8\u5305\u4e0a\u626b\u5373\u53ef\u3002\u603b\u590d\u6742\u5ea6$O(n)$\u3002\n\n\u4e8e\u662f\u8be2\u95ee\u53ef\u4ee5$O(1)$\u89e3\u51b3\u3002\u603b\u590d\u6742\u5ea6$O(m)$\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6$O(n\\log n+m)$\uff0c\u76f8\u6bd4\u7528\u524d\u7f00\u51f8\u5305\u76f4\u63a5\u76f8\u51cf\uff0c\u8fd9\u4e2a\u4e1c\u897f\u8fd8\u662f\u6bd4\u8f83\u6162\u7684\uff0c\u800c\u4e14\u53ef\u80fd\u6bd4\u8f83\u96be\u5199~~\uff0c\u4f46\u597d\u60f3~~\u3002\n\n## Code\uff1a\n```cpp\n#include<vector>\n#include<iostream>\nusing namespace std;\nconst int N=2e5+5;\ntypedef long long LL;\nstruct hull{\n\tstruct point{\n\t\tint x;LL y;\n\t\tinline point operator-(const point&b)const{return(point){x-b.x,y-b.y};}\n\t\tinline point operator+(const point&b)const{return(point){x+b.x,y+b.y};}\n\t};\n\tinline int cross(const point&a,const point&b){return a.x*b.y>a.y*b.x?1:(a.x*b.y==a.y*b.x?0:-1);}\n\tvector<point>vec;\n\tint it;\n\tinline hull(){it=0;}\n\tinline void insert(const point&a){\n\t\twhile(vec.size()>1)\n\t\tif(cross(a-vec[vec.size()-2],vec.back()-vec[vec.size()-2])<=0)vec.pop_back();else break;\n\t\tvec.push_back(a);\n\t}\n\tinline void insert(int x,LL y){insert((point){x,y});}\n\thull operator*(const hull&b){\n\t\thull c;\n\t\tint i1=0,i2=0;\n\t\twhile(i1!=vec.size()-1||i2!=b.vec.size()-1){\n\t\t\tpoint pr=vec[i1]+b.vec[i2];\n\t\t\tc.vec.push_back(pr);\n\t\t\tif(i1==vec.size()-1)++i2;else\n\t\t\tif(i2==b.vec.size()-1)++i1;else{\n\t\t\t\tconst point b1=vec[i1+1]+b.vec[i2],b2=vec[i1]+b.vec[i2+1];\n\t\t\t\tif(cross(b1-pr,b2-pr)<0)++i1;else ++i2;\n\t\t\t}\n\t\t}\n\t\tc.vec.push_back(vec.back()+b.vec.back());\n\t\treturn c;\n\t}\n\tinline LL query(int x){\n\t\twhile(it!=vec.size()-1)\n\t\tif((LL)vec[it].x*x+vec[it].y>(LL)vec[it+1].x*x+vec[it+1].y)break;else++it;\n\t\treturn(LL)vec[it].x*x+vec[it].y;\n\t}\n}h;\nint n,m,a[N];\nvoid merge(hull a,hull b,hull&c){\n\tc.it=0,c.vec.clear();\n\tint i1=0,i2=0;\n\twhile(i1!=a.vec.size()&&i2!=b.vec.size())\n\tif(a.vec[i1].x<b.vec[i2].x)c.insert(a.vec[i1++]);else c.insert(b.vec[i2++]);\n\twhile(i1!=a.vec.size())c.insert(a.vec[i1++]);\n\twhile(i2!=b.vec.size())c.insert(b.vec[i2++]);\n}\nvoid build(int l,int r,hull&mx){\n\tif(l==r)mx.insert(0,0),mx.insert(1,a[l]);else{\n\t\thull L,R;\n\t\tconst int mid=l+r>>1;\n\t\tbuild(l,mid,L),build(mid+1,r,R);\n\t\tmerge(L,R,mx);\n\t\tL=hull(),R=hull();\n\t\tLL x=0;\n\t\tL.insert(0,0),R.insert(0,0);\n\t\tfor(int i=mid;i>=l;--i)L.insert(mid-i+1,x+=a[i]);\n\t\tx=0;\n\t\tfor(int i=mid+1;i<=r;++i)R.insert(i-mid,x+=a[i]);\n\t\tmerge(mx,L*R,mx);\n\t}\n}\nLL ans[N*4];\nint main(){\n\tios::sync_with_stdio(0),cin.tie(0),cout.tie(0);\n\tcin>>n>>m;\n\tfor(int i=1;i<=n;++i)cin>>a[i],a[i]-=2*n;\n\tbuild(1,n,h);\n\tfor(int i=0;i<=4*n;++i)ans[i]=h.query(i);\n\tfor(int i=1;i<=n;++i)a[i]+=4*n,a[i]*=-1;\n\th=hull();\n\tbuild(1,n,h);\n\tfor(int i=0;i<=4*n;++i)ans[4*n-i]=max(ans[4*n-i],h.query(i));\n\tfor(LL pre=0;m--;){\n\t\tint x;\n\t\tcin>>x;\n\t\tx=(x+pre)%(4*n+1)-2*n;\n\t\tcout<<(pre=ans[x+2*n])<<'\\n';\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1561698360,
        "uid": 6813,
        "name": "mrsrz",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4756 \u3010Added Sequence\u3011"
    },
    {
        "content": "\u600e\u4e48\u611f\u89c9\u5927\u5bb6\u90fd\u662f\u7b97\u534a\u5e73\u9762\u4ea4\u505a\u7684\u8fd9\u9053\u9898\u554a\u2026\u2026\uff08\u96be\u9053\u662f\u81ea\u5df1\u592a\u83dc\u4e86\uff1f\uff09\n\n\u8fd9\u9053\u9898\u5e94\u8be5\u53ef\u4ee5\u7528\u88f8\u7684\u51f8\u5305+\u4e09\u5206\u6c34\u8fc7\n\n\u8fd9\u9053\u9898\u4e0a\u6765\u5c31\u53ef\u4ee5\u53d1\u73b0\u662f\u524d\u7f00\u548c\u51cf\u4e00\u4e0b\u505a\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\uff0c\u6211\u4eec\u9700\u8981\u505a\u7684\u662f\u533a\u95f4\u52a0\u4e0b\u6807\u7684\u64cd\u4f5c\uff0c\u663e\u7136\u533a\u95f4\u52a0\u4e0b\u6807\u4e0d\u4f1a\u7834\u574f\u51f8\u5305\u7684\u51f8\u6027\u3002\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5728\u4e00\u5f00\u59cb\u4ee5(\u4e0b\u6807\uff0c\u524d\u7f00\u548c)\u5efa\u70b9\u5206\u522b\u6c42\u51fa\u4e0a\u51f8\u5305\u548c\u4e0b\u51f8\u5305\uff0c\u8fd9\u6837\u6bcf\u6b21\u7684\u6700\u5927\u503c\u5fc5\u7136\u5728\u4e0a\u51f8\u5305\u4e0a\uff0c\u6700\u5c0f\u503c\u5fc5\u7136\u5728\u4e0b\u51f8\u5305\u4e0a\u3002\u4e09\u5206\u4e00\u4e0b\u5c31\u53ef\u4ee5\u505a\u5b8c\u4e86\u3002\u603b\u590d\u6742\u5ea6O(nlogn)\n\nPS:\u8fd9\u9053\u9898\u6bd4\u8f83\u6c34\uff0c\u5982\u679c\u6539\u4e00\u4e0b\u5462\uff1f\u5982\u679c\u4e0d\u662f\u6240\u6709\u6570\u5b57\u4e00\u8d77\u52a0\u4e0ax\uff0c\u800c\u662f\u6bcf\u6b21\u4e00\u6bb5\u533a\u95f4\u4e2d\u52a0\u4e0ax\uff0c\u600e\u4e48\u7834\uff1f\n\n\u53ef\u4ee5\u8003\u8651\u5206\u5757\u7ef4\u62a4\u51f8\u5305\uff0c\u8fd9\u6837\u53ea\u6709\u4e24\u4e2a\u64cd\u4f5c\uff1a\u533a\u95f4\u52a0\u4e0b\u6807\uff0c\u533a\u95f4\u52a0\u5e38\u6570\uff0c\u663e\u7136\u90fd\u53ef\u4ee5\u5728\u5757\u4e0a\u6253\u6807\u8bb0\u3002\u67e5\u8be2\u7684\u8bdd\u96f6\u6563\u5757\u66b4\u529b\uff0c\u5176\u4ed6\u5757\u4e09\u5206\u4e00\u4e0b\uff0c\u603b\u590d\u6742\u5ea6\u53ef\u4ee5\u505a\u5230O(n*sqrt(nlogn))\u3002\uff08\u5f53\u7136\u8fd9\u53ea\u662f\u6211\u7684\u60f3\u6cd5\uff0c\u53ef\u80fd\u6709\u66f4\u597d\u7684\u7b97\u6cd5\uff0c\u6b22\u8fce\u5927\u4f6c\u4eec\u6307\u5bfc\u672c\u849f\u84bb\uff09\u3002\n\u6211\u51f8\u5305\u548c\u4e09\u5206\u5199\u7684\u5f88\u4e11\uff0c\u90fd\u4e0d\u6562\u62ff\u51fa\u6765\u4e86\u2026\u2026\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\n\nconst int maxn = 200005, maxr = 10000000;\nll sum[maxn];\nint que[maxn], up[maxn], down[maxn], n, m, cnt1, cnt2;\ndouble slope(int a, int b){\n\treturn (sum[a] - sum[b]) * 1.0 / (a - b);\n}\nchar prt[maxr]; int ppos;\nvoid print(ll x, char c){\n\tif(x > 0){\n\t\tstatic char sta[20];\n\t\tint tp = 0;\n\t\tfor(; x; x /= 10) sta[tp++] = x % 10 + '0';\n\t\twhile(tp > 0) prt[ppos++] = sta[--tp];\n\t} else prt[ppos++] = '0';\n\tprt[ppos++] = c;\n}\nint main(){\n\tscanf(\"%d%d\", &n, &m);\n\tfor(int i = 1; i <= n; i++){\n\t\tint t; scanf(\"%d\", &t);\n\t\tsum[i] = sum[i - 1] + t;\n\t}\n\tint ta = 0; ll la = 0;\n\tfor(int i = 0; i <= n; i++){\n\t\twhile(ta >= 2 && slope(que[ta], que[ta - 1]) < slope(que[ta - 1], i)) --ta;\n\t\t++ta, up[ta] = que[ta] = i;\n\t}\n\tcnt1 = ta, ta = 0;\n\tfor(int i = 0; i <= n; i++){\n\t\twhile(ta >= 2 && slope(que[ta], que[ta - 1]) > slope(que[ta - 1], i)) --ta;\n\t\t++ta, down[ta] = que[ta] = i;\n\t}\n\tcnt2 = ta;\n\twhile(m--){\n\t\tint x; scanf(\"%d\", &x);\n\t\tx = (x + la) % (4 * n + 1) - 2 * n;\n\t\tint l = 1, r = cnt1;\n\t\twhile(l + 3 <= r){\n\t\t\tint k = (r - l + 1) / 3, m1 = l + k, m2 = r - k;\n\t\t\tif((ll)up[m1] * x + sum[up[m1]] > (ll)up[m2] * x + sum[up[m2]]) r = m2;\n\t\t\telse l = m1;\n\t\t}\n\t\tll res = 0, mn = 1E17;\n\t\tfor(int i = l; i <= r; i++) res = max(res, (ll)up[i] * x + sum[up[i]]);\n\t\tl = 1, r = cnt2;\n\t\twhile(l + 3 <= r){\n\t\t\tint k = (r - l + 1) / 3, m1 = l + k, m2 = r - k;\n\t\t\tif((ll)down[m1] * x + sum[down[m1]] < (ll)down[m2] * x + sum[down[m2]]) r = m2;\n\t\t\telse l = m1;\n\t\t}\n\t\tfor(int i = l; i <= r; i++) mn = min(mn, (ll)down[i] * x + sum[down[i]]);\n\t\tprint(la = res - mn, '\\n');\n\t}\n\tfwrite(prt, 1, ppos, stdout);\n\treturn 0;\n}\n```\n\u52a0\u4e2a\u8f93\u5165\u8f93\u51fa\u4f18\u5316\u8fd8\u662f\u86ee\u5feb\u7684\u2026\u2026",
        "postTime": 1532405616,
        "uid": 30575,
        "name": "waaadreamer",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4756 \u3010Added Sequence\u3011"
    }
]