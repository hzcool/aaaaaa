[
    {
        "content": "\u9996\u5148\uff0c\u6070\u597d\u7b49\u4e8e$k$\u7684\u6982\u7387\u53ef\u4ee5\u901a\u8fc7\u5dee\u5206\u8f6c\u5316\u4e3a\u5c0f\u4e8e\u7b49\u4e8e$k$\u7684\u6982\u7387\u51cf\u53bb\u5c0f\u4e8e\u7b49\u4e8e$k-1$\u7684\u6982\u7387\u3002\n\t\n\u8003\u8651\u600e\u4e48\u6c42\u5c0f\u4e8e\u7b49\u4e8e$k$\u7684\u6982\u7387\u3002\u8bbe$f_n$\u4e3a\u5e95\u90e8\u5bbd\u4e3a$n$\u65f6\u7684\u7b54\u6848\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u6700\u540e\u8fde\u7eed\u7684\u4e00\u6bb5\u767d\u8272\u7684\u957f\u5ea6\uff0c\u5373$\\displaystyle f_n=\\sum_{i=0}^{k}f_{n-i-1}\\cdot\\sum_{j=2}^{\\lfloor{k/i}\\rfloor+1}dp_{i,j}$\u3002\u5176\u4e2d$dp_{i,j}$\u8868\u793a\u4e00\u4e2a\u5bbd\u4e3a$i$\u7684\u77e9\u5f62\uff0c\u9ad8\u5ea6\u4e3a$1$\u81f3$j-1$\u90fd\u5168\u90e8\u662f\u767d\u8272\uff0c\u9ad8\u5ea6\u4e3a$j$\u7684\u4e00\u884c\u5f00\u59cb\u51fa\u73b0\u969c\u788d\uff0c\u5e76\u4e14\u5305\u542b\u7684\u6240\u6709\u8d34\u4f4f\u5e95\u90e8\u7684\u767d\u8272\u77e9\u5f62(\u5305\u62ec\u5bbd\u4e0d\u4e00\u5b9a\u4e3a$i$\u548c\u9ad8\u8d85\u8fc7$j$\u7684\u90a3\u4e9b)\u5927\u5c0f\u90fd\u4e0d\u8d85\u8fc7$k$\u7684\u6982\u7387\u3002\u8bb0$g_{i,j}=\\sum_{l\\geq j}dp_{i,l}$\u3002\n\t\n\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u6c42\u51fa$dp$\u548c$g$\u6570\u7ec4\uff0c\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u5c31\u53d8\u6210\u4e86\u9f50\u6b21\u5e38\u7cfb\u6570\u7ebf\u6027\u9012\u63a8\u7684\u5f62\u5f0f\uff1a$\\displaystyle f_n=\\sum_{i=0}^{k}f_{n-i-1}\\cdot g_{i,2}$\u3002\u6ce8\u610f\u5230$k$\u6bd4\u8f83\u5927\uff0c\u4f20\u7edf\u7684\u77e9\u9635\u4e58\u6cd5\u4e3a$O(k^3\\log n)$\u65e0\u6cd5\u901a\u8fc7\uff0c\u53ef\u4ee5\u7528\u591a\u9879\u5f0f\u53d6\u6a21\u7684\u65b9\u6cd5\u6765\u505a\u3002\n\n\u5148\u8003\u8651\u600e\u4e48\u6c42\u51fa$dp$\u548c$g$\u3002\u679a\u4e3e\u9ad8\u5ea6\u4e3a$j$\u5904\u7684\u7b2c\u4e00\u4e2a\u969c\u788d\uff0c\n\t\n$\\displaystyle dp_{i,j}=[i\\cdot(j-1)\\leq k](1-p)p^{j-1}\\sum_{l=1}^{i}\\left(\\sum_{q>j}dp_{l-1,q}\\right)\\left(\\sum_{q\\geq j}dp_{i-l,q}\\right)$\n\t\n\u524d\u7f00\u548c\u4f18\u5316\u4e00\u4e0b\uff0c\u5c31\u53ef\u4ee5\u505a\u5230$O(k^2\\log k)$\u4e86\uff0c\u56e0\u4e3a\u5408\u6cd5\u7684\u72b6\u6001\u4e2d\u8981\u6c42$i\\cdot(j-1)\\leq k$\uff0c\u6240\u4ee5\u4e00\u5171\u6709$\\sum_{i=1}^{k}\\lfloor{k/i}\\rfloor=O(k\\log k)$\u4e2a\u975e\u96f6\u72b6\u6001\uff0c\u6bcf\u6b21\u8f6c\u79fb\u4e3a$O(k)$\uff0c\u5df2\u7ecf\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\u5b9e\u9645\u4e0a\u8fd8\u53ef\u4ee5\u7528FFT\u4f18\u5316\u5230$k\\log^2k$\u3002\n\t\n$~$\n\t\n\u4e0b\u9762\u662f\u7528\u591a\u9879\u5f0f\u53d6\u6a21\u4f18\u5316\u9f50\u6b21\u5e38\u7cfb\u6570\u7ebf\u6027\u9012\u63a8\u7684\u65b9\u6cd5\uff1a\n\t\n\u5bf9\u4e8e\u9012\u63a8$f_n=\\sum_{i=1}^ka_kf_{n-k}$\n\t\n\u8bbe\u77e9\u9635\u4e58\u6cd5\u4e2d\u7684\u8f6c\u79fb\u77e9\u9635\u4e3a$A$\uff0c\u8bbe\u521d\u59cb\u72b6\u6001\u77e9\u9635\u4e3a$B[f_k,f_{k-1},...,f_1]$\uff0c\u6211\u4eec\u73b0\u5728\u8981\u6c42$BA^n$\uff0c\u5373\u6c42$A^n$\u3002\n\t\n\u8003\u8651$A$\u7684\u7279\u5f81\u591a\u9879\u5f0f$\\lambda(x)=det(xI-A)$\uff0c$I$\u4e3a\u5355\u4f4d\u77e9\u9635\u3002\u7531\u4e8e\u8f6c\u79fb\u77e9\u9635\u7684\u7279\u6b8a\u6027\uff0c\u5728\u6b64\u5904\u6211\u4eec\u53ef\u4ee5\u624b\u52a8\u6c42\u4e00\u4e0b\u7279\u5f81\u591a\u9879\u5f0f\uff0c$\\lambda(x)=x^k-\\sum_{i=1}^ka_ix^{k-i}$\uff0c\u662f\u4e00\u4e2a$k$\u6b21\u591a\u9879\u5f0f\uff0c\u5e76\u4e14\u6ee1\u8db3$\\lambda(A)=0$\u3002\n\t\n\u5982\u679c\u6211\u4eec\u628a$A^n$\u8868\u793a\u6210\u82e5\u5e72\u500d\u7684$\\lambda(A)$\uff0c\u5373$A^n=\\lambda(A)g(A)+r(A)$\u3002\u7531\u4e8e$\\lambda(A)=0$\uff0c\u6240\u4ee5$A^n=r(A)$\u3002\u800c$r(A)=A^n\\mod\\lambda(A)$\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa$x^n$\u6a21\u7279\u5f81\u591a\u9879\u5f0f\u540e\u7684\u591a\u9879\u5f0f\uff0c\u7136\u540e\u5c06$A$\u5e26\u5165\u5373\u53ef\u6c42\u51fa$A^n$\u3002\n\t\n$~$\n\t\n\u591a\u9879\u5f0f\u53d6\u6a21\u53ef\u4ee5\u4f7f\u7528Picks\u7684\u65b9\u6cd5\uff0c\u7528FFT\u505a\u5230$k\\log k$\uff0c\u52a0\u4e0a\u591a\u9879\u5f0f\u5feb\u901f\u5e42\u590d\u6742\u5ea6\u5c31\u662f$O(k\\log k\\log n)$\uff0c\u8fb9\u4e58\u8fb9\u53d6\u6a21\u3002\u5f53\u7136\u5728\u8fd9\u91cc\u6ca1\u6709\u5fc5\u8981\uff0c\u76f4\u63a5\u66b4\u529b\u53d6\u6a21\u5373\u53ef\u3002\n\t\n$~$\n\t\n\u5982\u4f55\u66b4\u529b\u53d6\u6a21?\u5047\u8bbe\u8981\u6c42$f(x)\\mod g(x)$\uff0c\u8bbe$f(x)=g(x)h(x)+r(x)$\uff0c\u6211\u4eec\u5c31\u662f\u8981\u6c42$r(x)$\uff0c\u5e76\u4e14\u8981\u6c42$r(x)$\u7684\u6b21\u6570\u5c0f\u4e8e$g(x)$\u7684\u6b21\u6570\u3002\u4e0d\u59a8\u5c06$g(x)$\u770b\u6210$0$\uff0c\u90a3\u4e48\u6b64\u65f6$f(x)$\u5c31\u7b49\u4e8e$r(x)$\u3002\u8bbe$g(x)=\\sum_{i=0}^kb_ix^i=0$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa$\\displaystyle x^k=-\\sum_{i=0}^{k-1}\\frac{b_i}{b_k}x^i$\uff0c\u6211\u4eec\u53ea\u9700\u8981\u628a$f(x)$\u4e2d\u7cfb\u6570\u8fc7\u5927\u7684\u4e00\u90e8\u5206\u8fed\u4ee3\uff0c\u5373\u53ef\u5c06\u7cfb\u6570\u4e00\u6b65\u6b65\u538b\u5230\u6bd4$k$\u5c0f\u3002\n\t\n\u4e24\u4e2a$k$\u6b21\u591a\u9879\u5f0f\u76f8\u4e58\uff0c\u8d85\u51fa\u7684\u90e8\u5206\u7cfb\u6570\u662f$O(k)$\u7684\uff0c\u6240\u4ee5\u66b4\u529b\u53d6\u6a21\u7684\u590d\u6742\u5ea6\u4e3a$O(k^2)$\uff0c\u5957\u4e0a\u5feb\u901f\u5e42\u5c31\u662f$O(k^2\\log n)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\t\n$~$\n\t\n\u7136\u540e\u6211\u4eec\u8003\u8651\u600e\u4e48\u7edf\u8ba1\u7b54\u6848\u3002\u6211\u4eec\u5df2\u7ecf\u7528\u4e00\u4e2a\u5173\u4e8e$A$\u7684$k-1$\u6b21\u591a\u9879\u5f0f$A^n=R(A)=\\sum_{i=0}^{k-1}r_iA^i$\u8868\u793a\u51fa\u4e86$A^n$\u3002\n\t\n\u6839\u636e\u77e9\u9635\u4e58\u6cd5\u7684\u5206\u914d\u5f8b\uff0c$B\\cdot R(A)=\\sum_{i=0}^{k-1}r_i\\cdot B\\cdot A^i$\u3002\u6211\u4eec\u8981\u7684\u7ed3\u679c\u662f\u77e9\u9635\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\uff0c\u800c$B\\cdot A^i$\u7684\u7b2c\u4e00\u4e2a\u5143\u7d20\u5c31\u662f$f_{k+i}$\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u5148\u6c42\u51fa$f_k,f_{k+1},...,f_{2k}$\uff0c\u7136\u540e\u76f4\u63a5\u626b\u4e00\u904d\u7edf\u8ba1\u7b54\u6848\u5373\u53ef\u3002\n\t\n$~$\n    \n\u590d\u6742\u5ea6$O(k^2(\\log k+\\log n))$\uff0c\u5176\u5b9e\u53ef\u4ee5\u505a\u5230$O(k\\log k(\\log k+\\log n))$\u3002\n\n\n\u6211\u4ee3\u7801\u4e2d\u7684dp\u90e8\u5206\u548c\u4e0a\u9762\u5199\u7684\u8f6c\u79fb\u4e0d\u592a\u4e00\u6837\u3002\n\n```\n#include<bits/stdc++.h>\n\n#define For(i,_beg,_end) for(int i=(_beg),i##end=(_end);i<=i##end;++i)\n#define Rep(i,_beg,_end) for(int i=(_beg),i##end=(_end);i>=i##end;--i)\n\ntemplate<typename T>T Max(const T &x,const T &y){return x<y?y:x;}\ntemplate<typename T>T Min(const T &x,const T &y){return x<y?x:y;}\ntemplate<typename T>int chkmax(T &x,const T &y){return x<y?(x=y,1):0;}\ntemplate<typename T>int chkmin(T &x,const T &y){return x>y?(x=y,1):0;}\ntemplate<typename T>void read(T &x){\n\tT f=1;char ch=getchar();\n\tfor(;ch<'0'||ch>'9';ch=getchar())if(ch=='-')f=-1;\n\tfor(x=0;ch>='0'&&ch<='9';ch=getchar())x=x*10+ch-'0';\n\tx*=f;\n}\n\ntypedef long long LL;\nconst int N=1010,mod=998244353;\nint n,m;\nLL a,b,p,q,dp[N][N],g[N][N],pw[N];\nLL A[N],f[N<<1];\n\nLL power(LL,LL);\nLL Solve(int);\n\nint main(){\n\tread(n);read(m);read(a);read(b);\n\tp=a*power(b,mod-2)%mod;q=(mod+1-p)%mod;\n\tpw[0]=1;\n\tFor(i,1,m) pw[i]=pw[i-1]*p%mod;\n\t\n\tprintf(\"%lld\\n\",(Solve(m)-Solve(m-1)+mod)%mod);\n\treturn 0;\n}\n\nLL Solve(int k){\n\tmemset(dp,0,sizeof dp);\n\tmemset(g,0,sizeof g);\n\tFor(i,1,k+2) g[0][i]=dp[0][i]=1;\n\tFor(i,1,k) Rep(j,k/i+1,2){\n\t\tFor(l,1,i) dp[i][j]=(dp[i][j]+g[l-1][j+1]*g[i-l][j]%mod*pw[l-1]%mod*q)%mod;\n\t\tg[i][j]=(g[i][j+1]*pw[i]+dp[i][j])%mod;\n\t}\n\tmemset(A,0,sizeof A);\n\tFor(i,0,k) A[i+1]=q*g[i][2]%mod*pw[i]%mod;\n\tmemset(f,0,sizeof f);\n\tf[0]=1;\n\tFor(i,1,k){\n\t\tf[i]=g[i][2]*pw[i]%mod;\n\t\tFor(j,1,i) f[i]=(f[i]+A[j]*f[i-j])%mod;\n\t}\n\tk++;\n\tFor(i,k,k<<1) For(j,1,k) f[i]=(f[i]+A[j]*f[i-j])%mod;\n\tif(n<=k)return f[n];\n\tint y=n-k,len=1,L=0;\n\tLL res[N<<2],tmp[N<<2],x[N<<2];\n\tmemset(res,0,sizeof res);\n\tmemset(x,0,sizeof x);\n\tres[0]=1;x[1]=1;\n\tfor(;y;y>>=1){\n\t\tif(y&1){\n\t\t\tFor(i,0,L+len) tmp[i]=0;\n\t\t\tFor(i,0,L) For(j,0,len) tmp[i+j]=(tmp[i+j]+res[i]*x[j])%mod;\n\t\t\tL+=len;\n\t\t\tRep(i,L,k) For(j,1,k) tmp[i-j]=(tmp[i-j]+tmp[i]*A[j])%mod;\n\t\t\tchkmin(L,k-1);\n\t\t\tFor(i,0,L) res[i]=tmp[i];\n\t\t}\n\t\tFor(i,0,len+len) tmp[i]=0;\n\t\tFor(i,0,len) For(j,0,len) tmp[i+j]=(tmp[i+j]+x[i]*x[j])%mod;\n\t\tlen<<=1;\n\t\tRep(i,len,k) For(j,1,k) tmp[i-j]=(tmp[i-j]+tmp[i]*A[j])%mod;\n\t\tchkmin(len,k-1);\n\t\tFor(i,0,len) x[i]=tmp[i];\n\t}\n\tLL ans=0;\n\tFor(i,0,k-1) ans=(ans+res[i]*f[i+k])%mod;\n\treturn ans;\n}\nLL power(LL x,LL y){\n\tLL res=1;\n\tfor(;y;y>>=1,x=x*x%mod) if(y&1) res=res*x%mod;\n\treturn res;\n}\n```",
        "postTime": 1527065014,
        "uid": 20176,
        "name": "Salamander",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3824 \u3010[NOI2017]\u6cf3\u6c60\u3011"
    },
    {
        "content": "dp\u795e\u9898\u2026\u2026+\u8fc7\u6c14\u7ebf\u6027\u4ee3\u6570\u9b54\u6cd5\n\n\u5176\u5b9e\u91cd\u70b9\u662fdp\uff0c\u8fd9\u9053\u9898\u8003\u70b9\u5176\u5b9e\u5e76\u4e0d\u5728\u5e38\u7cfb\u6570\u7ebf\u6027\u9f50\u6b21\u9012\u63a8\u5f0f\u7684\u5316\u7b80\u4e0a\u2026\u2026\n\n\u56e0\u4e3a\u5e76\u6ca1\u6709\u5c06\u6570\u636e\u8303\u56f4\u5f00\u52301e5\u6240\u4ee5\u66b4\u529b\u591a\u9879\u5f0f\u53d6\u6a21\u5373\u53ef\u901a\u8fc7\u672c\u9898\n\n______________________________\n\n## \u672c\u9898\u9898\u89e3\n\n### \u6734\u7d20\u7684dp\n\n\u9996\u5148\u53d1\u73b0\u6c42\u6070\u597d\u4e3ak\u4e0d\u592a\u597d\u505a\uff0c\u53d8\u6210\u6781\u5927\u5b50\u77e9\u5f62\u5c0f\u4e8ek\u7684\u6982\u7387\u51cf\u5c0f\u4e8ek-1\u7684\u6982\u7387\n\n\u7136\u540e\u6211\u4eec\u8bbe$f_{i}$\u8868\u793a\u8fd9\u79cd\u56fe\u5f62\u51fa\u73b0\u7684\u6982\u7387\uff1a\u5bbd\u4e3ai\uff0c\u5e95\u90e8\u7b2ci\u4e2a\u70b9\u6070\u597d\u662f\u574f\u70b9\uff0c\u4e14\u8fd9\u4e2ai\u00d71001\u7684\u77e9\u5f62\u4e2d\u4e0d\u5b58\u5728\u5927\u4e8ek\u7684\u6781\u5927\u5b50\u77e9\u5f62\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u7684\u7b54\u6848\u5c31\u662f$\\frac{f_{n+1}}{1-q}$\u56e0\u4e3a\u53ea\u9700\u8981\u9664\u6389\u90a3\u4e2a\u574f\u70b9\u51fa\u73b0\u7684\u6982\u7387\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u524dn\u5217\u662f\u4efb\u53d6\u7684\n\n\u90a3\u4e48\u6211\u4eec\u4ed4\u7ec6\u770b\u4e00\u4e0b\u8fd9\u4e2a$f$\u6570\u7ec4\u662f\u53ef\u4ee5\u9012\u63a8\u7684\n\n\u6211\u4eec\u679a\u4e3e\u5e95\u90e8\u4e0a\u4e00\u4e2a\u574f\u70b9\u7684\u4f4d\u7f6e\uff0c\u663e\u7136\u8fd9\u4e24\u4e2a\u574f\u70b9\u8ddd\u79bb\u4e0d\u4f1a\u8d85\u8fc7k\uff0c\u4e0d\u7136\u5c31\u4f1a\u51fa\u73b0\u4e00\u4e2a\u5927\u4e8ek\u7684\u5b50\u77e9\u5f62\u4e86\n\n\u90a3\u4e48$f_{x}$\u5e94\u8be5\u7b49\u4e8e\u8fd9\u4e2a\u4e1c\u897f\n\n\u8fb9\u754c\u6761\u4ef6$f_{0}=1$\n\n## $f_{x}=\\sum_{i=1}^{min(k,i)}f_{x-i}p_{i}$\n\n\u5176\u4e2d$p_{i}$\u5e94\u8be5\u8868\u793a\u8fd9\u79cd\u56fe\u5f62\u51fa\u73b0\u7684\u6982\u7387:\u5bbd\u5ea6\u4e3ai\u7684\u77e9\u5f62\uff0c\u4e14\u8fd9\u4e2ai\u00d71001\u91cc\u9762\u4e0d\u5b58\u5728\u9762\u79ef\u5927\u4e8ek\u7684\u6781\u5927\u5b50\u77e9\u5f62\u3002\n\n\u4f3c\u4e4e$p_{i}$\u6ca1\u6709\u4ec0\u4e48\u4f18\u79c0\u7684\u8ba1\u7b97\u65b9\u5f0f\u597d\u50cf\u4e5f\u4e0d\u80fd\u9012\u63a8\u2026\u2026\n\n\u6240\u4ee5\u6211\u4eec\u8003\u8651\u628a$P_{i}$\u62c6\u6210\u4e00\u5806\u6570\u7684\u548c\uff0c\u6362\u53e5\u8bdd\u8bf4\u6211\u4eec\u628a$P$dp\u51fa\u6765\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u679a\u4e3e\u8fd9\u4e2a\u77e9\u5f62\u574f\u70b9\u9ad8\u5ea6\u7684\u6700\u5c0f\u503c\n\n\u6240\u4ee5\u6211\u4eec\u8bbe$dp_{i,j}$\u8868\u793a\u8fd9\u79cd\u56fe\u5f62\u7684\u51fa\u73b0\u6982\u7387:\u5bbd\u4e3ai\u7684\u77e9\u5f62\uff0c\u574f\u70b9\u9ad8\u5ea6\u6700\u5c0f\u503c\u4e3aj+1\uff0c\u4e14\u8fd9\u4e2a\u77e9\u5f62\u4e2d\u4e0d\u4f1a\u51fa\u73b0\u9762\u79ef\u5927\u4e8ek\u7684\u6781\u5927\u5b50\u77e9\u5f62\n\n\u90a3\u4e48\u6211\u4eec\u8ba4\u771f\u89c2\u5bdf\u4e00\u4e0b\u4f1a\u53d1\u73b0$dp$\u6570\u7ec4\u662f\u53ef\u4ee5\u9012\u63a8\u7684\uff01\n\n\u6211\u4eec\u53ef\u4ee5\u4ece\u9ad8\u5230\u4f4e\u7684\u679a\u4e3e\u574f\u70b9\u9ad8\u5ea6\u7684\u6700\u5c0f\u503c\uff0c\u7136\u540e\u4ece\u5de6\u5230\u53f3\u679a\u4e3e\u7b2c\u4e00\u4e2a\u574f\u70b9\u7684\u4f4d\u7f6e\u8fdb\u884c\u8f6c\u79fb\uff0c\u53e6\u5916\u663e\u7136\u5bbd\u5ea6\u4e3ai\u7684\u77e9\u5f62\u574f\u70b9\u9ad8\u5ea6\u6700\u5c0f\u503c\u4e0d\u5f97\u8d85\u8fc7$k/i+1$\uff0c\u6240\u4ee5i\u00d7j\u5927\u4e8ek\u7684dp\u503c\u6211\u4eec\u65e0\u9700\u4e5f\u4e0d\u80fd\u8ba1\u7b97\u51fa\u6765\n\n\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u5927\u6982\u957f\u8fd9\u6837\n\n## $dp_{i,j}=(1-q)q^{j}\\sum_{t=1}^{i}(\\sum_{p=j+1}^{\\infty}dp_{t-1,p})(\\sum_{p=j}^{\\infty}dp_{i-t,p})$\n\n\u5982\u679c\u6211\u4eec\u8bb0sdp\u4e3a\u8fd9\u4e2a\u4e1c\u897f(\u5176\u5b9e\u5c31\u662f\u540e\u7f00\u548c)\n\n## $sdp_{i,j}=\\sum_{p=j}^{\\infty}dp_{i,p}$\n\n\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u5c31\u662f\n\n## $dp_{i,j}=(1-q)q^{j}\\sum_{m+n=i-1}sdp_{m,j+1}sdp_{n,j}$\n\n\u5f53\u7136\u4f60\u53ef\u4ee5\u7528ntt\u52a0\u4e0a\u591a\u9879\u5f0f\u6c42\u9006\u5747\u644a$O(logn)$\u7684\u8f6c\u79fb\n\n\u4f46\u662f\u8fd9\u91cc\u66b4\u529b\u5377\u79ef\u5c31\u884c\u4e86\u56e0\u4e3ak\u53ea\u67091000\n\n\u6211\u4eec\u4ed4\u7ec6\u89c2\u5bdf\u4e00\u4e0b\u4f1a\u53d1\u73b0\uff0c\u5982\u679c\u6211\u4eec\u4ee5\u679a\u4e3e\u574f\u70b9\u9ad8\u5ea6\u6700\u5c0f\u503c\u7684\u65b9\u5f0f\u8ba1\u7b97p\u7684\u8bdd\u6211\u4eec\u4f1a\u53d1\u73b0p\u5927\u6982\u662f\u8fd9\u4e2a\u5f0f\u5b50\n\n## $p_{i}=\\sum_{p=1}^{\\infty}dp_{i,p}=sdp_{i,1}$\n\n\n\u6240\u4ee5\u6211\u4eec\u7684p\u5c31\u88ab\u6c42\u51fa\u6765\u4e86\u2026\u2026\n\n\u90a3\u4e48\u6b64\u65f6\u6211\u4eec\u7684\u76ee\u6807\u662f\u6c42$f_{n+1}$\n\n\u66b4\u529b\u8ba1\u7b97$O(nk)$\u77e9\u9635\u5feb\u901f\u5e42\u8ba1\u7b97$O(k^3logn)$\u54ea\u4e2a\u597d\u50cf\u90fd\u8fc7\u4e0d\u53bb\u2026\u2026\n\n\u7136\u800c\u6211\u4eec\u4ed4\u7ec6\u7684\u60f3\u4e00\u4e0b\uff0c\u6211\u4eec\u771f\u7684\u9700\u8981\u8f6c\u79fb\u77e9\u9635\u7684n\u6b21\u5e42\u5417?\n\n\u5176\u5b9e\u4e0d\u662f\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8f6c\u79fb\u77e9\u9635\u4e58\u4ee5\u521d\u503c\u5411\u91cf\u7684\u4e4b\u540e\u7684\u5411\u91cf\uff0c\u6211\u4eec\u751a\u81f3\u4e0d\u9700\u8981\u8fd9\u4e2a\u5411\u91cf\uff0c\u6211\u4eec\u53ea\u9700\u8981\u4ed6\u7684\u6700\u540e\u4e00\u4f4d\n\n\u4e0b\u9762\u5462\u5c31\u662f\u4e00\u79cd\u5904\u7406\u5e38\u7cfb\u6570\u9f50\u6b21\u7ebf\u6027\u9012\u63a8\u5f0f\u7684\u6280\u672f\u4e86\n\n________________\n\n### \u5e38\u7cfb\u6570\u9f50\u6b21\u7ebf\u6027\u9012\u63a8\u5f0f\u7684\u5feb\u901f\u8ba1\u7b97\n\n\u5148\u89e3\u91ca\u4e00\u4e0b\u6211\u4eec\u8981\u5e72\u4ec0\u4e48\n\n\u6211\u4eec\u8981\u5feb\u901f\u8ba1\u7b97\u4e00\u4e2a\u201c\u9012\u63a8\u5f0f\u201d\n\n\u800c\u8fd9\u4e2a\u9012\u63a8\u5f0f\u6ee1\u8db3\u4e0b\u9762\u51e0\u4e2a\u6761\u4ef6\n\n1.\u5b83\u662f\"\u7ebf\u6027\"\u7684\u6362\u53e5\u8bdd\u8bf4\u9012\u63a8\u5f0f\u4e2d\u53ea\u6709\u5e38\u6570\u9879\u548c\u4e00\u6b21\u9879\uff0c\u4e14\u5fc5\u987b\u6709\u4e00\u6b21\u9879\n\n2.\u5b83\u662f\"\u9f50\u6b21\"\u7684\uff0c\u6240\u6709\u9879\u7684\u6b21\u6570\u5fc5\u987b\u76f8\u7b49\uff0c\u7ed3\u5408\u5b83\u662f\u201c\u7ebf\u6027\u201d\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u8fd9\u4e2a\u9012\u63a8\u5f0f\u91cc\u6ca1\u6709\u5e38\u6570\u9879\n\n3.\u5b83\u662f\"\u5e38\u7cfb\u6570\"\u7684,\u6240\u6709\u9879\u7684\u7cfb\u6570\u5fc5\u987b\u662f\u4e00\u4e2a\u5e38\u6570\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u5927\u6982\u8981\u5feb\u901f\u8ba1\u7b97\u8fd9\u4e2a\u9012\u63a8\u5f0f\u7684\u7b2cn\u9879\n\n## $f_{n}=\\sum_{i=1}^{k}f_{n-i}a_{i}$\n\n\u5f53\u7136\u53ef\u4ee5\u77e9\u9635\u5feb\u901f\u5e42\u8ba1\u7b97\uff0c\u590d\u6742\u5ea6\u662f$O(k^3logn)$\u7684\n\n\u4f46\u662f\u6211\u4eec\u6362\u4e00\u4e2a\u60f3\u6cd5\n\n\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u628a\u8f6c\u79fb\u77e9\u9635$A$\u7684n\u6b21\u5e42\u8f6c\u5316\u4e3a\u8fd9\u6837\u7684\u5f62\u5f0f\n\n\u81f3\u4e8e$C_{i}$\u662f\u4ec0\u4e48\u4f60\u53ef\u4ee5\u8ba4\u4e3a\u90a3\u662f\u6211\u4eec\u6784\u9020\u7684\u5965\u5999\u91cd\u91cd\u7684\u4e00\u7ec4\u6570\uff0c\u56e0n\u7684\u4e0d\u540c\u800c\u4e0d\u540c\n\n## $A^{n}=\\sum_{i=0}^{k-1}A^{i}c_{i}$\n\n\u90a3\u4e48\u6211\u4eec\u56e0\u4e3a\u8981\u6c42\u7684\u662f\u521d\u59cb\u5411\u91cfSt\u4e58\u8f6c\u79fb\u77e9\u9635\u7684n\u6b21\u5e42\u4e4b\u540e\u7684\u5411\u91cf\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u7b49\u5f0f\u4e24\u8fb9\u540c\u65f6\u5de6\u4e58\u4e00\u4e2aSt\n\n## $StA^{n}=\\sum_{i=0}^{k-1}StA^{i}c_{i}$\n\n\u7531\u4e8e\u6211\u4eec\u8981\u7b97\u7684\u662f\u5411\u91cf$St\u00d7A^{n}$\u7684\u7b2c1\u9879\n\n\u6240\u4ee5\u521a\u624d\u7684\u7b49\u5f0f\u5e94\u8be5\u5bf9\u6240\u6709\u5411\u91cf\u7684\u7b2c1\u9879\u4e5f\u6210\u7acb\n\n## $(StA^{n})_{1}=\\sum_{i=0}^{k-1}c_{i}(StA^{i})_{1}$\n\n\u7b49\u7b49,\u6211\u4eec\u8981\u6c42$St\u00d7A^{i}$\u7684\u7b2c1\u9879\uff1f\n\n\u90a3\u4e0d\u5c31\u662fSt\u7684\u7b2ci\u9879\u5417\uff1f\n\n\u6240\u4ee5\u6211\u4eec\u5f97\u5230\u4e86\u8fd9\u4e2a\u5f0f\u5b50\n\n## $(StA^{n})_{1}=\\sum_{i=0}^{k-1}c_{i}St_{i}$\n\n\u6240\u4ee5\u6362\u53e5\u8bdd\u8bf4\u6211\u4eec\u53ea\u8981\u80fd\u6784\u9020\u51fa\u8fd9\u4e2a\u5965\u5999\u91cd\u91cd\u7684$c$\u6211\u4eec\u5c31\u53ef\u4ee5\u6210\u529f\u8ba1\u7b97$f_{n}$\u4e86\n\n\u600e\u4e48\u6784\u9020\u5462\uff1f\n\n\u6211\u4eec\u5047\u8bbe\u8bf4\u6211\u4eec\u6784\u9020\u51fa\u4e86\u8fd9\u6837\u4e00\u4e2a\u795e\u5947\u7684\u591a\u9879\u5f0f$f$\u4f7f\u5f97\u4e0b\u5217\u7b49\u5f0f\u6210\u7acb,\u8fd9\u91cc\u76840\n\u662f0\u77e9\u9635\u7684\u610f\u601d\n\n## $\\sum_{i=0}^{k}f_{i}A^{i}=0$\n\n\u90a3\u4e48\u6211\u4eec\u5bf9\u4e8e$A^{n}$\u53ef\u4ee5\u628a\u5b83\u8868\u793a\u6210\u8fd9\u79cd\u5f62\u5f0f\n\n\u5176\u4e2dG\uff0cC\u662f\u53e6\u5916\u4e24\u4e2a\u591a\u9879\u5f0f\n\n## $A^{n}=G(A)f(A)+C(A)$\n\n\u56e0\u4e3a\u521a\u624d\u7684\u7b49\u5f0f\uff0c\u6240\u4ee5\n\n## $A^{n}=C(A)=\\sum_{i=0}^{k}c_{i}A^{i}$\n\n\u6362\u53e5\u8bdd\u8bf4\uff0c\u6211\u4eec\u53ea\u9700\u8981\u628aA^{n}\u8868\u793a\u521a\u624d\u7684\u5f62\u5f0f\u5c31\u884c\u4e86\uff0c\u7136\u540e\u63d0\u53d6\u591a\u9879\u5f0fC\u7684\u7cfb\u6570\u5c31\u662f\u6211\u4eec\u9700\u8981\u7684c\u4e86\n\n\u521a\u624d\u7684\u5f0f\u5b50\u597d\u50cf\u662f\u591a\u9879\u5f0f\u53d6\u6a21\u7684\u5f0f\u5b50\uff1f\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u5e42\u6c42\u51fa$A^{n}modf(A)$\u7684\u503c\n\n\u6700\u540e\u4e00\u4e2a\u95ee\u9898\uff0c\u600e\u4e48\u6c42$F(A)$?\n\n\u5982\u679cf(A)\u975e\u5e38\u597d\u6c42\u7684\u8bdd\u77e9\u9635\u5feb\u901f\u5e42\u5c31\u6ca1\u6709\u4ec0\u4e48\u5b58\u5728\u7684\u4ef7\u503c\u4e86\n\n\u6240\u4ee5\u5b83\u4e00\u822c\u6765\u8bb2\u4e0d\u662f\u5f88\u597d\u6c42\uff0c\u636e\u8bf4\u9700\u8981\u9ad8\u65af\u6d88\u5143\n\n\u4f46\u662f\uff0c\u5e38\u7cfb\u6570\u9f50\u6b21\u7ebf\u6027\u9012\u63a8\u7684\u77e9\u9635\u662f\u7279\u6b8a\u7684\u2026\u2026\n\n\u6240\u4ee5\u6211\u4eec\u7684f(A)\u7684\u7cfb\u6570\u53ef\u4ee5$O(1)$\u5f97\u77e5\n\n## $F_{k}=1$\n\n## $F_{k-i}=a_{i}$\n\n\u5176\u4e2d$a_{i}$\u662f\u9012\u63a8\u7cfb\u6570\n\n\u6240\u4ee5\u6709\u4e86\u8fd9\u4e2a\u4ee5\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5feb\u901f\u5e42+\u591a\u9879\u5f0f\u53d6\u6a21\u641e\u51fac\u6765\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u6c42\u51fa$f_{n}$\u4e86~\n\n\u591a\u9879\u5f0f\u53d6\u6a21\u53ef\u4ee5\u53bb\u6d1b\u8c37\u6a21\u677f\u533a\uff0c\u5f53\u7136\u8fd9\u9053\u9898\u4e0d\u9700\u8981ntt\u7248\u7684\u591a\u9879\u5f0f\u53d6\u6a21\n\n\u76f4\u63a5\u5382\u9664\u6cd5\u8fdb\u884c\u591a\u9879\u5f0f\u53d6\u6a21\u5c31\u884c\u4e86\n\n\u4e0a\u4ee3\u7801~\n\n```C\n#include<cstdio>\n#include<algorithm>\nusing namespace std;const int N=2048;typedef unsigned long long ll;const ll mod=998244353;\nint n;int k;ll p;ll q;ll x;ll y;\ninline ll po(ll a,ll p){ll r=1;for(;p;p>>=1,a=a*a%mod)if(p&1)r=r*a%mod;return r;}\nll sdp[N][N];ll st[N];ll ret[N];ll tr[N];ll f[N];ll cp1[N];ll cp2[N];ll a[N];\ninline ll solve(int k)\n{\n\tfor(int i=0;i<=k+1;i++)sdp[i][0]=1;//dp\n\tfor(int j=k;j>=1;j--)\n\t\tfor(int i=1;i*j<=k;i++)\n\t\t{\n\t\t  \tll ret=0;for(int t=1;t<=i;t++)(ret+=sdp[j+1][t-1]*sdp[j][i-t])%=mod;\n\t\t  \tret=ret*p%mod*po(q,j)%mod;sdp[j][i]=(sdp[j+1][i]+ret)%mod;\n\t\t}\n\tk++;tr[1]=p;for(int i=1;i<=k-1;i++)tr[i+1]=sdp[1][i]*p%mod;//\u8f6c\u79fb\u7cfb\u6570\n\tst[0]=1;for(int i=1;i<k;i++)for(int j=0;j<i;j++)(st[i]+=st[j]*tr[i-j])%=mod;//\u521d\u503c\n\tfor(int i=1;i<=k;i++)f[k-i]=mod-tr[i];f[k]=1;ret[0]=1;a[1]=1;int t=n+1;\n\twhile(t)//\u5feb\u901f\u5e42\n\t{\n\t\tif(t&1)\n\t\t{\n\t\t\tfor(int i=0;i<=k;i++)cp1[i]=ret[i],ret[i]=0;\n\t\t\tfor(int i=0;i<=k;i++)for(int j=0;j<=k;j++)(ret[i+j]+=cp1[i]*a[j])%=mod;//\u5377\u79ef\n\t\t\tfor(int i=2*k;i>=k;i--)//\u5382\u9664\u6cd5\u53d6\u6a21\n\t\t\t\tfor(int j=0;j<=k;j++)(ret[i-k+j]+=mod-ret[i]*f[j]%mod)%=mod;\n\t\t}\n\t\tfor(int i=0;i<=k;i++)cp1[i]=a[i];for(int i=0;i<=k;i++)cp2[i]=a[i],a[i]=0;\n\t\tfor(int i=0;i<=k;i++)for(int j=0;j<=k;j++)(a[i+j]+=cp1[i]*cp2[j])%=mod;\n\t\tfor(int i=2*k;i>=k;i--)\n\t\t\tfor(int j=0;j<=k;j++)(a[i-k+j]+=mod-a[i]*f[j]%mod)%=mod;t>>=1;\n\t}ll ans=0;for(int i=0;i<k;i++)(ans+=st[i]*ret[i])%=mod;\n\tfor(int i=0;i<=k+1;i++)for(int j=0;j<=k+1;j++)sdp[i][j]=0;\n\tfor(int i=0;i<=k;i++)a[i]=0;for(int i=0;i<=k;i++)ret[i]=0;\n\tfor(int i=0;i<=k;i++)st[i]=0;return ans*po(p,mod-2)%mod;\u8f93\u51fa\n}\nint main()\n{\n\tscanf(\"%d%d%lld%lld\",&n,&k,&x,&y);q=x*po(y,mod-2)%mod;p=(1+mod-q)%mod;\n\tprintf(\"%lld\",(solve(k)+mod-solve(k-1))%mod);return 0;//\u62dc\u62dc\u7a0b\u5e8f~\n}\n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        "postTime": 1529807641,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3824 \u3010[NOI2017]\u6cf3\u6c60\u3011"
    },
    {
        "content": "~~\u597d\u50cf\u6211\u7684\u8f6c\u79fb\u65b9\u6cd5\u548c\u5927\u5bb6\u90fd\u4e0d\u540c\uff0c\u90a3\u5c31\u987a\u4fbf\u6765\u53d1\u4e2a\u9898\u89e3\u5427...~~\n\n\u76f4\u63a5\u7b97\u6700\u5927\u9762\u79ef\u4e3a $k$ \u6bd4\u8f83\u96be\u5904\u7406\uff0c\u5219\u8003\u8651\u5dee\u5206\uff1a\u5148\u6c42\u51fa\u6700\u5927\u9762\u79ef $\\le k$ \u7684\u6982\u7387\uff0c\u518d\u51cf\u53bb\u6700\u5927\u9762\u79ef $\\le k-1$ \u7684\u6982\u7387\uff0c\u5c31\u5f97\u5230\u4e86\u6700\u5927\u9762\u79ef $=k$ \u7684\u6982\u7387\u4e86\u3002\n\n\u7136\u540e\u8003\u8651\u8bbe\u8ba1\u72b6\u6001 $f_{h, w}$ \u4e3a\uff1a\n\n\u5f53\u524d\u4fdd\u8bc1\u6709\u4e00\u4e2a\u9ad8\u4e3a $h$\uff0c\u5bbd\u4e3a $w$ \u7684\u5b89\u5168\u533a\u57df\uff0c\u4e14\u9ad8\u4e3a $h+1$ \u4ee5\u4e0a\u7684\u4f4d\u7f6e\u4efb\u610f\u4e14\u5408\u6cd5\u9762\u79ef\u4e0d\u8d85\u8fc7 $k$ \u7684\u6982\u7387\u662f\u591a\u5c11\u3002\n\n\u6ce8\u610f\u5230\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u9ad8\u5ea6\u4e3a $h+1$ \u7684\u90a3\u4e00\u884c\uff0c\u5de6\u4fa7\u7b2c\u4e00\u4e2a\u5371\u9669\u7684\u70b9\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u5219\u6709\u8f6c\u79fb\uff1a\n\n$$ f_{h, w} = p^w \\times f_{h+1,w}+\\sum_{i=1}^{w} f_{h+1,i-1} \\times f_{h,w-i} \\times p^{i-1}\\times (1-p) $$\n\n\u7136\u540e\u6700\u540e\u7684\u7b54\u6848\u5c31\u662f $f_{0, n}$ \u4e86\u3002\n\n\u4e4d\u4e00\u770b\uff0c\u72b6\u6001\u6570 $O(n^2)$ \u8f6c\u79fb\u6570 $O(n)$\uff0c\u590d\u6742\u5ea6\u5c31\u6210\u4e86 $O(n^3)$\u3002\u4f46\u662f\u4e8b\u5b9e\u4e0a\u9488\u5bf9\u6700\u5927\u9762\u79ef\u4e0d\u8d85\u8fc7 $k$ \u8fd9\u4e2a\u9650\u5236\u6761\u4ef6\uff0c\u6211\u4eec\u771f\u6b63\u6709\u7528\u7684\u72b6\u6001\u6570\u662f\u53ea\u6709 $O(k \\log k)$ \u4e2a\u7684\u3002\u5219\u5224\u65ad $h \\times w \\le k$ \u4e4b\u540e\uff0c\u5b9e\u9645\u590d\u6742\u5ea6\u662f $O(k^2 \\log k)$ \u7684\u3002\n\n\u8fd9\u4e2a `dp` \u6211\u662f\u4f7f\u7528\u9012\u5f52\u5b9e\u73b0\u7684\uff0c\u5199\u8d77\u6765\u5f88\u65b9\u4fbf\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528\u9012\u63a8\uff0c\u4f46\u662f\u9700\u8981\u6ce8\u610f\u5faa\u73af\u7684\u987a\u5e8f\uff08$h$ \u4ece\u5927\u5230\u5c0f\u679a\u4e3e\uff0c$w$ \u4ece\u5c0f\u5230\u5927\u679a\u4e3e\uff0c\u8fd9\u4e2a\u4e0d\u80fd\u4e71\u987a\u5e8f\uff09\n\n\u7136\u540e\u6211\u4eec\u5c31\u89e3\u51b3\u4e86 $n, k \\leq 10^3$ \u7684\u90e8\u5206\uff0c\u5230\u8fd9\u91cc\u5c31\u53ef\u4ee5\u62ff\u5230 $70$ \u5206\u4e86\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u4e00\u4e0b $n$ \u5f88\u5927\u7684\u65f6\u5019\uff0c$f_{0, n}$ \u7684\u8f6c\u79fb\u3002\u6ce8\u610f\u5230\u5bf9\u4e8e\u6240\u6709 $x \\ge k$\uff0c$f_{0, x}$ \u90fd\u4f1a\u7528\u5230 $f_{1,0}, f_{1,1},\\ldots,f_{1,k}$ \u8fdb\u884c\u8f6c\u79fb\u3002\n\n\u6ce8\u610f\u5230\uff0c\u5982\u679c\u6211\u4eec\u5148\u7b97\u51fa $f_{1,0}, f_{1,1},\\ldots,f_{1,k}$\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u7b97\u51fa $f_{0, x}$ \u4e86\u3002\n\n\u8003\u8651\u8bbe $G_i=f_{1,i}\\times p^i \\times q$\uff0c$F_n=f{0,n}$\uff0c\u5219\u6211\u4eec\u6700\u540e\u60f3\u77e5\u9053\u7684\u662f $F_n$\uff0c\u4e14 $F$ \u53ef\u4ee5\u901a\u8fc7 $G$ \u4e92\u76f8\u8f6c\u79fb\uff1a\n\n$$ F_n = \\sum_{i=1}^{k+1} G_{i-1} \\times F_{n-i} (n > k)$$\n\n\u4f7f\u7528\u77e9\u9635\u4e58\u6cd5\u52a0\u901f\u8f6c\u79fb\uff0c\u7ed3\u5408\u4e0a\u9762\u7684\u66b4\u529b `dp` \u5c31\u53ef\u4ee5\u83b7\u5f97 $90$ \u5206\u7684\u597d\u6210\u7ee9\u3002\n\n\u7136\u540e\uff0c\u5982\u679c\u4f60\u8fd8\u4f1a[\u5e38\u7cfb\u6570\u9f50\u6b21\u7ebf\u6027\u9012\u63a8](https://www.luogu.com.cn/problem/P4723)\u7684\u8bdd\uff0c\u4f60\u5c31\u4f1a\u53d1\u73b0\u5199\u51fa\u8fd9\u4e2a\u9012\u63a8\u5f0f\u4e4b\u540e\u5c31\u53ef\u4ee5\u5957\u4e0a\u677f\u5b50\u4e86\u3002\u5982\u679c\u4e0d\u4f1a\u7684\u8bdd\uff0c\u5efa\u8bae\u5728\u6709\u4e00\u5b9a\u6570\u7406\u57fa\u7840\u7684\u60c5\u51b5\u4e0b\u518d\u53bb\u5b66\u4e60\u3002\n\n\u7531\u4e8e\u6b64\u9898\u4e2d $k \\leq 10^3$\uff0c\u6240\u4ee5\u591a\u9879\u5f0f\u4e58\u6cd5\u548c\u53d6\u6a21\u53ef\u4ee5\u66b4\u529b\u5b9e\u73b0\u3002\n\n\u90e8\u5206\u4ee3\u7801\uff1a\n\n```cpp\ntypedef long long ll;\n\nconst int mod = 998244353;\nconst ll MOD = 8ll * mod * mod;\n\ninline int Mod(int x) { return x >= mod ? x - mod : x; }\ninline void ADD(ll &x, ll y) { x += y, x -= x >= MOD ? MOD : 0; }\ninline int fsp(int x, int k = mod - 2) {\n\tint s = 1;\n\twhile(k) {\n\t\tif(k & 1) s = 1LL * s * x % mod;\n\t\tx = 1LL * x * x % mod, k >>= 1;\n\t} return s;\n}\n\nint F[3010], lf;\nint Q[3010], lq;\nint S[3010], ls;\nint G[3010], lg;\nll tmp[3010];\nint A[3010];\n\ninline void PolyMul(int a[], int b[], int c[], int &n, int m) {\n\tfor(int i = 0; i <= n; i++)\n\t\tfor(int j = 0; j <= m; j++)\n\t\t\tADD(tmp[i + j], 1LL * b[i] * c[j]);\n\tn += m;\n\tfor(int i = 0; i <= n; i++) a[i] = tmp[i] % mod, tmp[i] = 0;\n}\n\ninline void PolyMod(int a[], int &n) {\n\tfor(int i = n; i >= lq; i--) {\n\t\tif(!a[i]) continue;\n\t\tint mul = mod - a[i];\n\t\tfor(int j = 0; j <= lq; j++)\n\t\t\ta[i - j] = (a[i - j] + 1LL * mul * Q[lq - j]) % mod;\n\t} chkmin(n, lq - 1);\n\twhile(n && !a[n]) --n;\n}\n\ninline int calc(int n, int k) {\n\tmemset(Q, 0, sizeof(Q));\n\tmemset(S, 0, sizeof(S));\n\tmemset(G, 0, sizeof(G));\n\n\tQ[k] = 1, lq = k;\n\tfor(int i = 0; i < k; i++) Q[k - i - 1] = mod - A[i];\n\n\tS[0] = 1, ls = 0;\n\tG[1] = 1, lg = 1;\n\twhile(n) {\n\t\tif(n & 1) PolyMul(S, S, G, ls, lg), PolyMod(S, ls);\n\t\tPolyMul(G, G, G, lg, lg), PolyMod(G, lg), n >>= 1;\n\t}\n\n\tint res = 0;\n\tfor(int i = 0; i < k; i++)\n\t\tres = (res + 1LL * F[i] * S[i]) % mod;\n\treturn res;\n}\n\nint p, q;\nint pw_p[1100000];\nint pw_q[1100000];\nint f[1010][1010];\n\ninline int dp(int h, int w, int k) {\n\tif(w == 0) return 1;\n\tif(h * w > k) return 0;\n\tif(~f[h][w]) return f[h][w];\n\tint &F = f[h][w] = 1LL * pw_p[w] * dp(h + 1, w, k) % mod;\n\tfor(int i = 1; i <= w; i++)\n\t\tF = (F + 1LL * dp(h + 1, i - 1, k) * q % mod * pw_p[i - 1] % mod * dp(h, w - i, k)) % mod;\n\treturn F;\n}\n\ninline int solve(int n, int k) {\n\tmemset(f, -1, sizeof(f));\n\tdp(0, k, k);\n\tmemset(F, 0, sizeof(F));\n\tmemset(A, 0, sizeof(A));\n\tfor(int i = 0; i <= k; i++) {\n\t\tF[i] = i ? f[0][i] : 1;\n\t\tA[i] = !i ? q : 1LL * f[1][i] * q % mod * pw_p[i] % mod;\n\t} return calc(n, k + 1);\n}\n\nint main() {\n\tint n = ri, k = ri, x = ri, y = ri;\n\tp = 1LL * x * fsp(y) % mod, q = mod + 1 - p;\n\tint N = min(1000, max(n, k)) * 1001;\n\n\tpw_p[0] = pw_q[0] = 1;\n\tfor(int i = 1; i <= N; i++) {\n\t\tpw_p[i] = 1LL * pw_p[i - 1] * p % mod;\n\t\tpw_q[i] = 1LL * pw_q[i - 1] * q % mod;\n\t}\n\n\tint r1 = solve(n, k);\n\tint r2 = solve(n, k - 1);\n\tprintf(\"%d\\n\", Mod(r1 + mod - r2));\n\n\treturn 0;\n}\n```",
        "postTime": 1596502792,
        "uid": 20782,
        "name": "CYJian",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3824 \u3010[NOI2017]\u6cf3\u6c60\u3011"
    },
    {
        "content": "\u7b49\u4e8e $K$ \u7684\u6982\u7387\u7b49\u4e8e\u5c0f\u4e8e\u7b49\u4e8e $K$ \u7684\u6982\u7387\u51cf\u53bb\u5c0f\u4e8e\u7b49\u4e8e $K-1$ \u7684\u6982\u7387\uff0c\u9898\u76ee\u53d8\u4e3a\u6c42\u6700\u5927\u5168\u7a7a\u957f\u65b9\u5f62\u5927\u5c0f\u5c0f\u4e8e\u7b49\u4e8e $K$ \u7684\u6982\u7387\u3002\n\n\u8bbe $g_{r\\ c}$ \u4e3a\uff0c\u5df2\u77e5 $r$ \u884c $c$ \u5217\u5168\u7a7a\uff0c\u6700\u5927\u5e95\u90e8\u5728\u8fd9 $c$ \u5217\u91cc\u7684\u957f\u65b9\u5f62\u9762\u79ef\u5c0f\u4e8e\u7b49\u4e8e $K$ \u7684\u6982\u7387\u3002\u5219\uff1a\n\n - \u5f53 $c=0$\uff0c$g_{r\\ c} = 1$\uff1b\n - \u5f53 $r\\times c>K$\uff0c$g_{r\\ c}=0$\uff1b\n - \u5426\u5219\uff0c$g_{r\\ c}$ \u53ef\u4ee5\u8fd9\u6837\u8ba1\u7b97\uff1a\n\n\u6709 $p^c$ \u6982\u7387\u7b2c $r+1$ \u884c\u5168\u7a7a\uff0c\u4e8e\u662f $p^cg_{r+1\\ c}\\rightarrow g_{r\\ c}$\u3002  \n\u5426\u5219\u679a\u4e3e $r+1$ \u884c\u7b2c\u4e00\u5217\u6545\u969c\u662f\u5728\u54ea\u91cc\uff0c\u5b9a\u8fd9\u4e2a\u4e3a\u7b2c $i$ \u5217\uff08\u4ece 0 \u5f00\u59cb\u7f16\u53f7\uff09\u3002  \n\u6211\u4e48\u6709 $p^i(1-p)$ \u7684\u6982\u7387\u8fd9\u4e2a\u4f4d\u7f6e\u662f\u7b2c\u4e00\u4e2a\u6545\u969c\u3002\u6211\u4eec\u77e5\u9053 $0$ \u5230 $i-1$ \u6ca1\u6709\u6545\u969c\uff0c\u6240\u4ee5\u5e95\u90e8\u5728 $0$ \u5230 $i-1$ \u7684\u957f\u65b9\u5f62\u53ef\u4ee5\u7684\u6982\u7387\u662f $g_{r+1\\ i}$\u3002 \u5269\u4e0b $i+1$ \u5230 $n-1$ \u4ecd\u7136\u53ef\u80fd\u5728\u7b2c $r+1$ \u884c\u6709\u6545\u969c\uff0c\u6240\u4ee5\u6982\u7387\u662f $g_{r\\ n-i-1}$\u3002\u7efc\u4e0a\uff0c$p^i(1-p)g_{r+1\\ i}g_{r\\ n-i-1}\\rightarrow g_{r\\ c}$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u6709\n\n$$g_{r\\ c}=p^cg_{r+1\\ c}+\\sum_{i=0}^{n-1}p^i(1-p)g_{r+1\\ i}g_{r\\ n-i-1}$$\n\n\u6211\u4eec\u60f3\u8981\u7684\u7b54\u6848\u5c31\u662f $g_{0\\ n}$\uff0c\u4f46\u662f\u8fd9\u76f4\u63a5\u8ba1\u7b97\u662f\u4e0d\u53ef\u80fd\u7684\u3002~~\u4f46\u662f\u8fd9\u6837\u76f4\u63a5\u505a\u5c31\u6709 70 \u5206\uff0c\u606d\u559c\u4f60\u7528\u666e\u53ca\u7ec4\u77e5\u8bc6\u62ff\u5230 NOI \u9898\u7684 70 \u5206\u3002~~ \u89c2\u5bdf\u5230\u7b2c\u4e8c\u4e2a\u6761\u4ef6\uff1a\u5982\u679c $r\\times c>k$\uff0c\u5219 $g_{r\\ c}=0$\u3002\u6211\u4eec\u518d\u66ff\u4ee3\u8fdb\u53bb $r=0$\uff1a\n\n$$g_{0\\ c}=p^cg_{1\\ c}+\\sum_{i=0}^{n-1}p^i(1-p)g_{1\\ i}g_{0\\ n-i-1}$$\n\n\u5982\u679c $c>k$\uff0c\u90a3\u4e48\u5c31\u6709\u7279\u522b\u591a\u7684\u9879\u6839\u672c\u4e0d\u53ef\u80fd\u4ea7\u751f\u8d21\u732e\uff0c\u56e0\u4e3a $1\\times i>k$ \u554a\uff01\u4e8e\u662f\u5982\u679c $c>k$ \u5c31\u6709  \n\n$$g_{0\\ c}=\\sum_{i=0}^{k-1}p^i(1-p)g_{1\\ i}g_{0\\ n-i-1}$$\n\n\u5b9a $c_i=p^i(1-p)g_{1\\ i}$\uff1a\n\n$$g_{0\\ c}=\\sum_{i=0}^{k-1}c_ig_{0\\ n-i-1}$$\n\n\u8fd9\u660e\u663e\u662f\u5e38\u7cfb\u6570\u7ebf\u6027\u9f50\u6b21\u9012\u63a8\u3002\n\u5148\u7528\u8bb0\u4e00\u5316\u641c\u7d22\u9884\u5904\u7406 $g_{0\\ 0},g_{0\\ 1},\\dots,g_{0\\ k}$\u548c $g_{1\\ 0},g_{1\\ 1},\\dots,g_{1\\ k}$\uff0c\u76f4\u63a5\u7528\u6a21\u677f\u641e\u5373\u53ef\u3002\n\n\u6709 $O(k\\log k)$ \u53ef\u80fd\u7684 $(r,c)$ \u5bf9\u9700\u8981\u9884\u5904\u7406\uff1b\u4e8e\u662f\u9884\u5904\u7406\u7684\u65f6\u95f4\u662f $O(k^2\\log k)$\u3002  \n\u6c42\u5e38\u7cfb\u6570\u7ebf\u6027\u9f50\u6b21\u9012\u63a8\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $O(k\\log k\\log n)$\u3002  \n\u603b\u5171\u65f6\u95f4\u590d\u6742\u5ea6 $O(k^2\\log k+k\\log k\\log n)$ \u89e3\u51b3\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n// writer: w33z8kqrqk8zzzx33\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define iter(i, a, b) for(int i=(a); i<(b); i++)\n#define rep(i, a) iter(i, 0, a)\n#define rep1(i, a) iter(i, 1, (a)+1)\n#define fi first\n#define se second\n#define pb push_back\n \n#define ll long long\n#define pii pair<int, int>\n//#define int ll\nconst int MOD = 998244353;\n\n#define intsize (sizeof(int))\n\nnamespace poly {\n\tconst int MOD = 998244353;\n\tconst int NTTG = 3;\n\tint rev[262160];\n\tint minv[262160];\n\tint w[20][2][262160];\n\t\n\tint qpow(int b, int e) {\n\t\tint re=1;\n\t\twhile(e){\n\t\t\tif(e&1)re=1ll*re*b%MOD;\n\t\t\tb=1ll*b*b%MOD;e>>=1;\n\t\t}\n\t\treturn re;\n\t}\n\t\n\tvoid constructrev(int n) {\n\t\tfor(int i=1, j=0; i < n; i++) {\n\t\t\tint bit=n>>1;\n\t\t\tfor(;j&bit;bit>>=1)j^=bit;\n\t\t\tj^=bit; rev[i] = j;\n\t\t}\n\t}\n\n\tvoid constructroot(int n) {\n\t\tminv[1] = 1;\n\t\titer(i, 2, n+1)\n\t\t\tminv[i]=1ll*(MOD-MOD/i)*minv[MOD%i]%MOD;\n\t\tfor(int l=1; (1<<l)<=n; l++)\n\t\t\trep(inv, 2) {\n\t\t\t\tint re = inv?qpow(minv[NTTG],(MOD-1)>>l):qpow(NTTG,(MOD-1)>>l);\n\t\t\t\tw[l][inv][0] = 1;\n\t\t\t\trep1(i,(1<<(l-1))-1) w[l][inv][i] = 1ll*w[l][inv][i-1]*re%MOD;\n\t\t\t}\n\t}\n\t\n\tvoid ntt(int *v, int n, bool inv) {\n\t\trep(i, n) if(i < rev[i]) swap(v[i], v[rev[i]]);\n\t\tfor(int l=1;(1<<l)<=n;l++)\n\t\t\tfor(int i=0;i<n;i+=(1<<l)) {\n\t\t\t\tint p=i+(1<<(l-1));\n\t\t\t\titer(j, i, p) {\n\t\t\t\t\tint a=v[j],b=1ll*v[j+(1<<(l-1))]*w[l][inv][j-i]%MOD;\n\t\t\t\t\tv[j]=(a+b>=MOD?a+b-MOD:a+b);\n\t\t\t\t\tv[j+(1<<(l-1))]=(a<b?a+MOD-b:a-b);\n\t\t\t\t}\n\t\t\t}\n\t\tif(inv) rep(i, n) v[i] = 1ll*v[i]*minv[n]%MOD;\n\t}\n\t\n\tvoid mult(int *a, int as, int *b, int bs, int *o, bool construct, bool clean = 0, int thr = 10000000) {\n\t\tint n = as+bs-1;\n\t\twhile(n - (n & (-n))) n += (n & (-n));\n\t\tif(construct) constructroot(n);\n\t\tconstructrev(n);\n\t\tntt(a, n, 0); ntt(b, n, 0);\n\t\trep(i, n) o[i] = 1ll*a[i]*b[i]%MOD;\n\t\tntt(o, n, 1);\n\t\titer(i, thr, n) o[i] = 0;\n\t\tif(clean) rep(i, n) a[i] = b[i] = 0;\n\t}\n\n\tvoid cfn(int* a, int as, int *o) {\n\t\tstatic int tmp[262160];\n\t\tif(as == 1) { tmp[0] = a[0]; o[0] = qpow(a[0], MOD - 2); return; }\n\t\tcfn(a, (as+1)/2, o); int le = 0;\n\t\twhile((1 << le) < (as << 1)) le++;\n\t\tconstructrev(1 << le);\n\t\trep(i, as) tmp[i] = a[i];\n\t\titer(i, as, 1<<le) tmp[i] = o[i] = 0;\n\t\tntt(tmp, 1<<le, 0); ntt(o, 1<<le, 0);\n\t\trep(i, 1<<le) o[i] = 1ll * (MOD + (2 - 1ll * tmp[i] * o[i]) % MOD) * o[i] % MOD;\n\t\tntt(o, 1<<le, 1);\n\t\titer(i, as, 1<<le) o[i] = 0;\n\t}\n\n\tvoid init(int n) { constructroot(n); }\n\t\n\tvoid divide(int *a, int as, int *b, int bs, int *MEMORY, int *q, int *r) {\n\t\tif(as < bs) {\n\t\t\tmemcpy(r, a, (bs-1) * intsize);\n\t\t\treturn;\n\t\t}\n\t\tstatic int ar[262160], br[262160], bin[262160];\n\t\tint th = as, re = as-bs+1;\n\t\t//th = re+1;\n\t\trep(i, as) ar[i] = a[as-1-i];\n\t\trep(i, bs) br[i] = b[bs-1-i];\n\t\tmemcpy(bin, MEMORY, (sizeof(int))*re);\n\t\tmult(ar, th, bin, re, q, 0, 1, re);\n\t\tfor(int l = 0, r = re-1; l < r; l++, r--) swap(q[l], q[r]);\n\t\trep(i, re) bin[i] = q[i];\n\t\tmult(bin, re, b, bs, r, 0, 1, bs - 1);\n\t\trep(i, bs - 1) r[i] = (MOD + a[i] - r[i]) % MOD;\n\t}\n}\nint rem[262160], dg;\nint ans[262160];\nint A[262160], B[262160], C[262160];\nint BULLSHIT[262160], BATSHIT[262160];\nint me[262160];\nvoid calc(int n) {\n\tif(n + 1 < dg) {\n\t\tans[n] = 1;\n\t\treturn;\n\t}\n\tcalc(n/2);\n\tint sz = dg - 1 + dg - 1 + (n % 2) - 1;\n\tmemcpy(A, ans, (dg - 1) * intsize);\n\tmemcpy(B + (n % 2), ans, (dg - 1) * intsize);\n\tpoly::mult(A, dg-1, B, dg-1+(n%2), C, 0, 1);\n\tmemcpy(BATSHIT, rem, dg * intsize);\n\tpoly::divide(C, sz, BATSHIT, dg, me, BULLSHIT, ans);\n}\nint run(int n, int k, vector<int> dt, vector<int> ini) {\n    if(n<ini.size())return ini[n];\n\tint h = 1; while(h < (k << 2)) h <<= 1;\n\tpoly::init(h);\n    memset(rem, 0, sizeof rem);\n    memset(ans, 0, sizeof ans);\n    memset(me, 0, sizeof me);\n\trem[k] = 1; dg = k+1;\n\trep1(i, k) {\n\t\tint p = dt[i-1]; p = -p;\n\t\tp = ((p + MOD) % MOD + MOD) % MOD;\n\t\trem[k-i] = p;\n\t}\n\tmemcpy(BATSHIT, rem, dg * intsize);\n\treverse(BATSHIT, BATSHIT+dg);\n\tpoly::cfn(BATSHIT, dg, me);\n\tcalc(n);\n\tint re = 0;\n\trep(i, k) {\n\t\tint p = ini[i];\n\t\tp = ((p + MOD) % MOD + MOD) % MOD;\n\t\tre = (re + 1ll * p * ans[i]) % MOD;\n\t}\n\treturn re;\n}\nint n,k,q;\nint qpow(int b,int e=MOD-2){\n    int a=1;while(e){\n        if(e&1)a=1ll*a*b%MOD;\n        b=1ll*b*b%MOD;e>>=1;\n    }return a;\n}\nint qe[1005];\nint smdp[1005][1005];\nint f(int row,int col){\n    if(row*col>k)return 0;\n    if(!col)return 1;\n    int&g=smdp[row][col];\n    if(g!=-1)return g;\n    g=1ll*qe[col]*f(row+1,col)%MOD;\n    rep(i,col)g=(g+1ll*qe[i]*(MOD+1-q)%MOD*f(row+1,i)%MOD*f(row,col-i-1))%MOD;\n    return g;\n}\nint solve(int kv){\n    memset(smdp,-1,sizeof smdp);\n    vector<int> dt,ini;\n    k=kv;\n    rep(i,k+1) dt.pb(1ll*qe[i]*(MOD+1-q)%MOD*f(1,i)%MOD);\n    rep(i,k+1) ini.pb(f(0,i));\n    return run(n,k+1,dt,ini);\n}\nint main() {\n    ios_base::sync_with_stdio(false); \n\tcin.tie(0);\n\tint k,x,y; cin >>n>>k>>x>>y;\n    qe[1]=q=1ll*x*qpow(y)%MOD;qe[0]=1;\n    iter(i,2,k+1)qe[i]=1ll*qe[i-1]*q%MOD;\n    cout <<(solve(k)-solve(k-1)+MOD)%MOD<<endl;\n    return 0;\n}\n\n```",
        "postTime": 1610861296,
        "uid": 220037,
        "name": "w33z8kqrqk8zzzx33",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3824 \u3010[NOI2017] \u6cf3\u6c60\u3011"
    }
]