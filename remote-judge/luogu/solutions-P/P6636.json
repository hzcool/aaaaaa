[
    {
        "content": "\u524d\u7f6e\u77e5\u8bc6\uff1a [\u6709\u7406\u6570\u53d6\u4f59](https://www.luogu.com.cn/problem/P2613)\u3001\u9ad8\u4e2d\u751f\u7269\n\n~~\u53e6\u5916\u5410\u69fd\u4e00\u4e0b\uff0c\u6211\u592a\u83dc\u4e86\uff0c\u6ca1\u770b\u61c2\u6bd4\u8d5b\u7684\u9898\u89e3\uff0c\u53ea\u597d\u778e\u641e\u4e86\u4e00\u4e2a\u505a\u6cd5\uff08\u7b97\u662f\u524d\u7f00\u548c\u5427\uff09~~\n\n\u9996\u5148\u4ee4$p(i,j)$\u4e3a\u4ee5$1...i$\u4e3a\u7ed3\u5c3e\u7684\u5e8f\u5217\u4e2d\u542b\u6709$j$\u4e2a\u53cc\u773c\u76ae\u57fa\u56e0\u7684\u6982\u7387\u548c\u3002\n\n\n\u6240\u6709\u5b50\u5e8f\u5217\u53cc\u773c\u76ae\u7684\u6982\u7387\u548c\u5373\u4e3a $p(n,1)+p(n,2)$\n\u3002\n\n\u90a3\u4e48\u6211\u4eec\u7684\u95ee\u9898\u5c31\u662f\u5982\u4f55\u4ece $p(i-1,j)$ \u6c42\u5f97 $p(i,j)$\u3002\n\n$p(i,j)=p(i-1,j)+$ \u4ee5$i$\u4e3a\u7ed3\u5c3e\u7684\u5e8f\u5217\u4e2d\u542b\u6709$j$\u4e2a\u53cc\u773c\u76ae\u57fa\u56e0\u7684\u6982\u7387\u548c\u3002\n\n\u4ee5\u4e0b\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\uff1a $a_0$\u76f4\u63a5\u548c$a_i$\u4ea4\u914d\uff0c$a_0$\u5148\u548c$a_{1...i-1}$\u4ea4\u914d\u4e4b\u540e\u624d\u548c$a_i$\u4ea4\u914d\u3002\n\n$a_0$\u76f4\u63a5\u548c$a_i$\u4ea4\u914d\uff1a\u76f4\u63a5\u6839\u636e\u4e24\u8005\u57fa\u56e0\u8ba1\u7b97\uff0c\u5171\u4e5d\u79cd\u60c5\u51b5\u3002\n\n$a_0$\u5148\u548c$a_{1...i-1}$\u4ea4\u914d\u4e4b\u540e\u624d\u548c$a_i$\u4ea4\u914d\uff1a\u6211\u4eec\u53d1\u73b0\uff0c\u548c$a_{1...i-1}$\u4ea4\u914d\u7684\u6982\u7387\u5c31\u662f$p(i-1,j)$\uff0c\u5171\u4e09\u79cd\u60c5\u51b5\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u3002\n\n$ a_1 $~$ a_n$\u7684\u5b50\u5e8f\u5217\u5171\u6709$2^n-1$\u4e2a\uff0c\u7edf\u8ba1\u597d\u7b54\u6848\u4e4b\u540e\u518d\u9664\u4ee5\u8fd9\u4e2a\u6570\u3002\n\n### \u6ce8\u610f\uff1a\u4ee5\u4e0a\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u9700\u8981\u65f6\u65f6\u523b\u523b\u5bf9mod\u53d6\u6a21\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst long long mod=998244353;\nlong long a[6000000];\nlong long p[3];//\u53d1\u73b0p(i,j)\u4ec5\u4e0ep(i-1,j)\u6709\u5173\uff0c\u6240\u4ee5\u7b2c\u4e00\u7ef4\u53ef\u7701\u53bb\nlong long ksm(long long a,long long n)//\u7528\u6765\u6c42\u9006\u5143\n{\n\tlong long ans=1;\n\twhile(n)\n\t{\n\t\tif(n&1)ans=ans*a%mod;\n\t\ta=a*a%mod;\n\t\tn/=2;\n\t}\n\treturn ans;\n}\nint main()\n{\n\tios::sync_with_stdio(false);\n\tlong long n;\n\tcin>>n;\n\tfor(long long i=0;i<=n;i++)cin>>a[i];\n\tlong long ans=0;\n\tlong long er=ksm(2,mod-2),si=ksm(4,mod-2);//\u8fd9\u4e24\u4e2a\u6570\u7528\u5f97\u592a\u591a\u4e86\uff0c\u5c31\u9884\u5904\u7406\u4e00\u4e0b\n\tfor(long long i=1;i<=n;i++)\n\t{\n\t\tlong long help[3];//\u50a8\u5b58\u4ee5i\u4e3a\u7ed3\u5c3e\u7684\u5e8f\u5217\u4e2d\u542b\u6709\u4e2a\u53cc\u773c\u76ae\u57fa\u56e0\u7684\u6982\u7387\u548c\n\t\tif(a[i]==0)//a0\u5148\u548ca1...ai-1\u4ea4\u914d\u4e4b\u540e\u624d\u548cai\u4ea4\u914d\uff0c\u5206\u4e09\u79cd\u60c5\u51b5\u8ba8\u8bba\n\t\t{\n\t\t\thelp[0]=(p[0]+p[1]*er%mod)%mod;\n\t\t\thelp[1]=(p[2]+p[1]*er%mod)%mod;\n\t\t\thelp[2]=0;\n\t\t}\n\t\telse if(a[i]==1)\n\t\t{\n\t\t\thelp[0]=(p[0]*er%mod+p[1]*si%mod)%mod;\n\t\t\thelp[1]=(p[0]*er%mod+p[1]*er%mod+p[2]*er%mod)%mod;\n\t\t\thelp[2]=(p[2]*er%mod+p[1]*si%mod)%mod;\n\t\t}\n\t\telse if(a[i]==2)\n\t\t{\n\t\t\thelp[0]=0;\n\t\t\thelp[1]=(p[0]+p[1]*er%mod)%mod;\n\t\t\thelp[2]=(p[2]+p[1]*er%mod)%mod;\n\t\t}\n\t\tif(a[0]==0&&a[i]==0)//a0\u76f4\u63a5\u548cai\u4ea4\u914d\uff0c\u5206\u4e5d\u4e2d\u60c5\u51b5\u8ba8\u8bba\n\t\t{\n\t\t\thelp[0]+=1;\n\t\t\thelp[1]+=0;\n\t\t\thelp[2]+=0;\n\t\t}\n\t\telse if(a[0]==0&&a[i]==1)\n\t\t{\n\t\t\thelp[0]+=er;\n\t\t\thelp[1]+=er;\n\t\t\thelp[2]+=0;\n\t\t}\n\t\telse if(a[0]==0&&a[i]==2)\n\t\t{\n\t\t\thelp[0]+=0;\n\t\t\thelp[1]+=1;\n\t\t\thelp[2]+=0;\n\t\t}\n\t\telse if(a[0]==1&&a[i]==0)\n\t\t{\n\t\t\thelp[0]+=er;\n\t\t\thelp[1]+=er;\n\t\t\thelp[2]+=0;\n\t\t}\n\t\telse if(a[0]==1&&a[i]==1)\n\t\t{\n\t\t\thelp[0]+=si;\n\t\t\thelp[1]+=er;\n\t\t\thelp[2]+=si;\n\t\t}\n\t\telse if(a[0]==1&&a[i]==2)\n\t\t{\n\t\t\thelp[0]+=0;\n\t\t\thelp[1]+=er;\n\t\t\thelp[2]+=er;\n\t\t}\n\t\telse if(a[0]==2&&a[i]==0)\n\t\t{\n\t\t\thelp[0]+=0;\n\t\t\thelp[1]+=1;\n\t\t\thelp[2]+=0;\n\t\t}\n\t\telse if(a[0]==2&&a[i]==1)\n\t\t{\n\t\t\thelp[0]+=0;\n\t\t\thelp[1]+=er;\n\t\t\thelp[2]+=er;\n\t\t}\n\t\telse if(a[0]==2&&a[i]==2)\n\t\t{\n\t\t\thelp[0]+=0;\n\t\t\thelp[1]+=0;\n\t\t\thelp[2]+=1;\n\t\t}\n\t\tp[0]=(p[0]+help[0])%mod;\n\t\tp[1]=(p[1]+help[1])%mod;\n\t\tp[2]=(p[2]+help[2])%mod;\n\t}\n   ans=(p[1]+p[2])%mod;\n\tcout<<ans*ksm((ksm(2,n)+mod-1)%mod,mod-2)%mod;//\u6700\u540e\u522b\u5fd8\u4e86\u8981\u9664\u4ee5\u5b50\u5e8f\u5217\u7684\u4e2a\u6570\n\treturn 0;\n}\n```\n",
        "postTime": 1593656637,
        "uid": 8291,
        "name": "zumgze",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P6636 \u3010\u300cJYLOI Round 1\u300d\u6027\u72b6\u3011"
    },
    {
        "content": "## \u601d\u8def\n\n\u8003\u8651 $dp_{i,0/1/2}$\uff0c\u8868\u793a\u770b\u5230\u7b2c $i$ \u4e2a\u4eba\uff0c\u76ee\u524d\u8fd9\u4e2a\u4eba\u7684\u57fa\u56e0\u4e3a `aa,aA,AA` \u7684\u6240\u6709\u65b9\u6848\u6982\u7387\u4e4b\u548c\u3002\u8003\u8651\u5bf9\u4e8e\u7b2c $i$ \u4e2a\u4eba\uff0c\u6211\u4eec\u6709\u4e24\u79cd\u505a\u6cd5\uff0c\u4e00\u79cd\u662f\u589e\u52a0\u4ed6\uff0c\u4e00\u79cd\u4e0d\u589e\u52a0\u4ed6\uff0c\u4e0d\u589e\u52a0\u7684\u65b9\u6848\u663e\u7136\uff1a\n\n$$dp_{i,0/1/2}+=dp_{i-1,0/1/2}$$\n\n\u5982\u679c $a_i=0$\uff0c\u5219\uff1a\n\n$$dp_{i,0}+=(dp_{i-1,0}+\\frac{1}{2}dp_{i-1,1})$$\n\n$$dp_{i,1}+=(dp_{i-1,2}+\\frac{1}{2}dp_{i-1,1})$$\n\n\u5982\u679c $a_i=1$\uff0c\u5219\uff1a\n\n$$dp_{i,0}+=(\\frac{1}{2}dp_{i-1,0}+\\frac{1}{4}dp_{i-1,1})$$\n\n$$dp_{i,0}+=(\\frac{1}{2}dp_{i-1,0}+\\frac{1}{2}dp_{i-1,1}+\\frac{1}{2}dp_{i-1,2})$$\n\n$$dp_{i,2}+=(\\frac{1}{2}dp_{i-1,2}+\\frac{1}{4}dp_{i-1,1})$$\n\n\u5982\u679c $a_i=2$\uff0c\u5219\uff1a\n\n$$dp_{i,2}+=(dp_{i-1,2}+\\frac{1}{2}dp_{i-1,1})$$\n\n$$dp_{i,1}+=(dp_{i-1,0}+\\frac{1}{2}dp_{i-1,1})$$\n\n\u6309\u8f6c\u79fb\u65b9\u7a0b\u8f6c\u79fb\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $\\Theta(n)$\uff0c\u5373\u53ef\u901a\u8fc7\u672c\u9898\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int mod=998244353;\nint qp(int a,int b){\n\tint ans=1;\n\twhile(b){\n\t\tif(b&1) ans=(ans*a)%mod;\n\t\ta=(a*a)%mod;\n\t\tb>>=1;\n\t}\n\treturn ans;\n}\nint dp[5000005][4];\nint a[5000005];\nint inv2=499122177;\nsigned main(){\n\tint n;\n\tcin>>n;\n\tfor(int i=0;i<=n;i++) scanf(\"%lld\",&a[i]);\n\tdp[0][a[0]]=1;\n\tfor(int i=1;i<=n;i++){\n\t\tdp[i][0]=dp[i-1][0];\n\t\tdp[i][1]=dp[i-1][1];\n\t\tdp[i][2]=dp[i-1][2];\n\t\tif(a[i]==0){\n\t\t\t//j=0\n\t\t\tdp[i][0]=(dp[i][0]+dp[i-1][0])%mod;\n\t\t\t//j=1\n\t\t\tdp[i][0]=(dp[i][0]+inv2*dp[i-1][1]%mod)%mod;\n\t\t\tdp[i][1]=(dp[i][1]+inv2*dp[i-1][1]%mod)%mod;\n\t\t\t//j=2\n\t\t\tdp[i][1]=(dp[i][1]+dp[i-1][2]%mod)%mod;\n\t\t}\n\t\tif(a[i]==1){\n\t\t\t//j=0\n\t\t\tdp[i][0]=(dp[i][0]+inv2*dp[i-1][0]%mod)%mod;\n\t\t\tdp[i][1]=(dp[i][1]+inv2*dp[i-1][0]%mod)%mod;\n\t\t\t//j=1\n\t\t\tdp[i][0]=(dp[i][0]+inv2*inv2%mod*dp[i-1][1]%mod)%mod;\n\t\t\tdp[i][1]=(dp[i][1]+inv2%mod*dp[i-1][1]%mod)%mod;\n\t\t\tdp[i][2]=(dp[i][2]+inv2*inv2%mod*dp[i-1][1]%mod)%mod;\n\t\t\t//j=2\n\t\t\tdp[i][2]=(dp[i][2]+inv2*dp[i-1][2]%mod)%mod;\n\t\t\tdp[i][1]=(dp[i][1]+inv2*dp[i-1][2]%mod)%mod;\n\t\t}\n\t\tif(a[i]==2){\n\t\t\t//j=0\n\t\t\tdp[i][1]=(dp[i][1]+dp[i-1][0]%mod)%mod;\n\t\t\t//j=1\n\t\t\tdp[i][2]=(dp[i][2]+inv2*dp[i-1][1]%mod)%mod;\n\t\t\tdp[i][1]=(dp[i][1]+inv2*dp[i-1][1]%mod)%mod;\n\t\t\t//j=2\n\t\t\tdp[i][2]=(dp[i][2]+dp[i-1][2])%mod;\n\t\t}\n\t}\n\tdp[n][a[0]]=(dp[n][a[0]]+mod-1)%mod;\n\tcout<<(dp[n][1]+dp[n][2])%mod*qp(qp(2,n)-1,mod-2)%mod;\n\treturn 0;\n}\n```",
        "postTime": 1647854901,
        "uid": 116664,
        "name": "Daniel_lele",
        "ccfLevel": 8,
        "title": "P6636 \u300cJYLOI Round 1\u300d\u6027\u72b6"
    }
]