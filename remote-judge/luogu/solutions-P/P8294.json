[
    {
        "content": "### Problem Statement\n\n\u7ed9\u5b9a $n$ \u4e2a\u70b9\u7684\u4e8c\u53c9\u6811\uff0c\u70b9\u6709\u6743\u503c $d_{1 \\dots n}$\u3002\u9700\u8981\u4f9d\u6b21\u5220\u9664\u6240\u6709\u8fb9\u3002\u5220\u8fb9\u4ee3\u4ef7\u4e3a\u4e24\u7aef\u70b9\u6743\u503c\u548c\uff1b\u5220\u8fb9\u524d\u4f1a\u4ea4\u6362\u4e24\u7aef\u70b9\u6743\u503c\u3002\u6c42\u6700\u5c0f\u603b\u4ee3\u4ef7\u3002\n\n### Constraints\n\n$1 \\le n \\le 5 \\times 10^3, 1 \\le d_i \\le 10^9$\u3002\n\n---\n\n### Solution\n\n> Changelog: \u4fee\u6b63\u4e86\u90e8\u5206\u7b14\u8bef\uff0c\u63d0\u4f9b\u4e86\u907f\u514d\u659c\u7387\u4f18\u5316\u7684\u505a\u6cd5\u3002\n\n\u8bb0 $S_r$ \u8868\u793a\u4ee5 $r$ \u4e3a\u6839\u7684\u5b50\u6811\u3002\u8ba4\u4e3a\u70b9\u6743\u662f\u5728\u6811\u4e0a\u79fb\u52a8\u7684\u3002\n\n\u8bbe $f_{u, v}$ \u8868\u793a $S_{\\operatorname{lca}(u, v)}$ \u4e2d\uff0c\u5c06 $d_u$ \u79fb\u51fa\uff0c\u79fb\u5165\u7684\u70b9\u6743\u6700\u7ec8\u505c\u7559\u5728 $v$\uff0c\u5220\u53bb\u5b50\u6811\u4e2d\u6240\u6709\u8fb9\u4ee5\u53ca $\\operatorname{lca}(u, v)$ \u5165\u8fb9\u7684\u6700\u5c0f\u603b\u4ee3\u4ef7\uff08\u4e0d\u5305\u62ec\u6362\u5165\u7684\u70b9\u6743\uff09\u3002\n\n\u6309 $r = \\operatorname{lca}(u, v)$ \u81ea\u4e0b\u800c\u4e0a\u7684\u987a\u5e8f\u8f6c\u79fb\u3002\u4e0b\u6587\u4e2d\u300c\u6734\u7d20\u8f6c\u79fb\u300d\u610f\u4e3a\u679a\u4e3e\u6240\u6709\u5408\u6cd5\u8f6c\u79fb\u3002\u4e0b\u6587 $d$ \u53ef\u80fd\u8868\u793a\u8282\u70b9\uff0c\u4f46\u4e0d\u4f1a\u9020\u6210\u6b67\u4e49\uff0c\u8bf7\u6ce8\u610f\u533a\u5206\u3002\u7531\u4e8e\u516c\u5f0f\u8f83\u591a\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u7b14\u8bef\u3002\n\n- \u82e5 $\\deg r = 0$\uff1a$f_{r, r} = d_r$\u3002\n\n- \u82e5 $\\deg r = 1$\uff1a\n\n  - \u8bb0 $d$ \u4e3a $r$ \u7684\u5b69\u5b50\u3002\n  - \u82e5 $u = r$\uff1a$f_{u, v} = \\min \\lbrace d_u + f_{w, v} \\rbrace \\pod { \\operatorname{lca}(v, w) = d }$\u3002\u679a\u4e3e $v, w$\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\u3002\n  - \u82e5 $v = r$\uff1a$f_{u, v} = \\min \\lbrace f_{u, w} + d_u + d_v(\\operatorname{dep}_w - \\operatorname{dep}_v) \\rbrace \\pod {\\operatorname{lca}(u, w) = d}$\u3002\u679a\u4e3e $u, w$\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n- \u82e5 $\\deg r = 2$\uff1a\n\n  - \u82e5 $u = r$\uff1a\n\n    \u8bb0 $d$ \u4e3a $r$ \u5728 $v$ \u4e00\u4fa7\u7684\u5b69\u5b50\uff0c$d'$ \u4e3a\u53e6\u4e00\u4fa7\u7684\u5b69\u5b50\u3002\u6613\u77e5\uff1a\u5e94\u5148\u5220\u6389 $r$ \u7684\u5165\u8fb9\uff1b\u518d\u5220\u6389 $r \\to d$ \u7684\u8fb9\uff1b\u518d\u5220\u6389 $r \\to d'$ \u7684\u8fb9\u3002\n\n    \u679a\u4e3e $w$ \u4f7f\u5f97 $d_w$ \u7531 $S_d$ \u79fb\u81f3 $S_{d'}$\uff1b\u679a\u4e3e $x$ \u7531 $S_{d'}$ \u79fb\u81f3 $r$\uff1b\u679a\u4e3e $d_w$ \u79fb\u81f3\u7684\u70b9 $y$\uff1b\u5219\u6709\uff1a\n    $$\n    \\begin{aligned}\n    f_{u, v} &= \\min_{w, x, y} \\lbrace d_u + f_{w, v} + f_{x, y} + d_w({\\operatorname{dep}}_y - {\\operatorname{dep}}_u) \\rbrace \\cr\n    &= d_u + \\min_{y} \\lbrace \\min_x f_{x, y} + \\min_w \\lbrace ({\\operatorname{dep}}_y - {\\operatorname{dep}}_u) \\cdot d_w + f_{w, v} \\rbrace \\rbrace \\cr\n    &= d_u + \\min_w \\lbrace f_{w, v} + \\min_y \\lbrace (\\operatorname{dep}_y - \\operatorname{dep}_u) \\cdot d_w + \\min_x f_{x, y} \\rbrace \\rbrace\n    \\end{aligned}\n    \\pod{ \\operatorname{lca}(v, w) = d, \\operatorname{lca}(x, y) = d'}\n    $$\n    \u6309\u7167\u7b2c\u4e8c\u884c\u7684\u5f0f\u5b50\uff0c\u53d1\u73b0 $v$ \u786e\u5b9a\u65f6\u7b2c\u4e8c\u5c42\u5927\u62ec\u53f7\u5185\u90e8\u5f62\u5982\u4e00\u4e2a\u5173\u4e8e $\\operatorname{dep}_y - \\operatorname{dep}_u$ \u7684\u4e00\u6b21\u51fd\u6570\u3002\u53ef\u4ee5\u659c\u7387\u4f18\u5316\u3002\u679a\u4e3e $w$ \u9884\u5904\u7406\uff1b\u679a\u4e3e $y$ \u8f6c\u79fb\uff1b\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\u3002\n    \n    \u6b64\u5916\uff0c\u82e5\u6309\u7167\u7b2c\u4e09\u884c\u7684\u5f0f\u5b50\uff0c\u53d1\u73b0\u7b2c\u4e09\u5c42 $\\min$ \u4ec5\u4e0e $y$ \u6709\u5173\uff0c\u7b2c\u4e8c\u5c42 $\\min$ \u4ec5\u4e0e $w$ \u6709\u5173\uff1b\u53ef\u4ee5\u679a\u4e3e $y, x$ \u9884\u5904\u7406\u6bcf\u4e2a $y$ \u5bf9\u5e94\u7684\u7b2c\u4e09\u5c42\u7684\u503c\uff0c\u679a\u4e3e $w, y$ \u9884\u5904\u7406\u6bcf\u4e2a $w$ \u5bf9\u5e94\u7684\u7b2c\u4e8c\u5c42\u7684\u503c\uff0c\u679a\u4e3e $v, w$ \u8fdb\u884c\u8f6c\u79fb\uff0c\u5373\u53ef\u907f\u514d\u659c\u7387\u4f18\u5316\u3002\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n  - \u82e5 $v = r$\uff1a\n\n    \u8bb0 $d$ \u4e3a $r$ \u5728 $u$ \u4e00\u4fa7\u7684\u5b69\u5b50\uff0c$d'$ \u4e3a\u53e6\u4e00\u4fa7\u7684\u5b69\u5b50\u3002\u6613\u77e5\uff1a\u5e94\u5148\u5220\u6389 $r \\to d'$ \u7684\u8fb9\uff1b\u518d\u5220\u6389 $r \\to d$ \u7684\u8fb9\uff1b\u518d\u5220\u6389 $r$ \u7684\u5165\u8fb9\u3002\n\n    \u679a\u4e3e $w$ \u4f7f\u5f97 $d_w$ \u7531 $S_{d'}$ \u79fb\u81f3 $S_d$\uff1b\u679a\u4e3e $d_r$ \u79fb\u81f3\u7684\u70b9 $x$\uff1b\u679a\u4e3e $d_w$ \u79fb\u81f3\u7684\u70b9 $y$\uff1b\u5219\u6709\uff1a\n    $$\n    \\begin{aligned}\n    f_{u, v} &= \\min_{w, x, y} \\lbrace f_{w, x} + d_v(\\operatorname{dep}_x - \\operatorname{dep}_v) + f_{u, y} + d_w(\\operatorname{dep}_y - \\operatorname{dep}_v) + d_u \\rbrace\\cr\n    &= d_u + \\min_y \\lbrace f_{u, y} + \\min_w \\lbrace d_w (\\operatorname{dep}_y - \\operatorname{dep}_v) + \\min_x \\lbrace f_{w, x}  + d_v (\\operatorname{dep}_x - \\operatorname{dep}_v) \\rbrace \\rbrace \\rbrace\n    \\end{aligned}\n    \\pod{\\operatorname{lca}(w, x) = d', \\operatorname{lca}(u, y) = d}\n    $$\n\n    \u53d1\u73b0\u7b2c\u4e8c\u5c42 $\\min$ \u4e0e $u$ \u65e0\u5173\uff0c\u7b2c\u4e09\u5c42 $\\min$ \u4e0e $y$ \u65e0\u5173\u3002\u679a\u4e3e $w, x$ \u9884\u5904\u7406\uff1b\u679a\u4e3e $y, w$ \u9884\u5904\u7406\uff1b\u679a\u4e3e $u, y$ \u8f6c\u79fb\uff1b\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n  - \u82e5 $u \\ne r, v \\ne r$\uff1a\n\n    \u8bb0 $d$ \u4e3a $r$ \u5728 $u$ \u4e00\u4fa7\u7684\u5b69\u5b50\uff0c$d'$ \u4e3a $r$ \u5728 $v$ \u4e00\u4fa7\u7684\u5b69\u5b50\u3002\u6613\u77e5\uff1a\u5e94\u5148\u5220\u6389 $r \\to d$ \u7684\u8fb9\uff1b\u518d\u5220\u6389 $r$ \u7684\u5165\u8fb9\uff1b\u518d\u5220\u6389 $r \\to d'$ \u7684\u8fb9\u3002\n\n    \u679a\u4e3e $d_r$ \u79fb\u81f3\u7684\u70b9 $w$\uff1b\u679a\u4e3e $x$ \u4f7f\u5f97 $d_x$ \u7531 $S_{d'}$ \u79fb\u81f3 $r$\uff1b\u5219\u6709\uff1a\n    $$\n    f_{u, v} = \\min_{w, x} \\lbrace f_{u, w} + d_r (\\operatorname{dep}_w - \\operatorname{dep}_r) + d_u + f_{x, v} \\rbrace\n    \\pod{ \\operatorname{lca}(u, w) = d, \\operatorname{lca}(v, x) = d' }\n    $$\n\n    \u679a\u4e3e $u, w$ \u9884\u5904\u7406\uff1b\u679a\u4e3e $u, v$ \u8f6c\u79fb\uff1b\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n\u65f6\u7a7a\u590d\u6742\u5ea6 $O(n^2)$\u3002",
        "postTime": 1650376655,
        "uid": 236807,
        "name": "Mitama",
        "ccfLevel": 9,
        "title": "[Solution] SX2022 mis"
    },
    {
        "content": "- \u5bf9\u81ea\u5df1\u7684\u95ee\u9898\u6ca1\u6709\u65b0\u7684\u4f53\u4f1a\u3002\n- \u98ce\u4ece\u5927\u5730\u5377\u6765\uff0c\n- \u96e8\u4ece\u5927\u5730\u5954\u6765\u3002\n- \u90ca\u539f\u5982\u6d77\uff0c\n- \u623f\u820d\u5982\u821f\u3002\n- \u6211\u6709\u5e74\u8f7b\u8235\u624b\u7684\u5fc3\uff0c\n- \u5728\u5927\u5730\u98ce\u96e8\u7684\u6d77\u4e0a\u3002\n- \u611f\u8c22[\u5927\u4f6c](https://www.luogu.com.cn/user/52170)\u7684\u4e00\u4e9b\u6307\u5bfc\uff0c\u795d\u613f\u5176\u4fe1\u606f\u5b66\u4e4b\u8def\u5149\u8292\u7480\u74a8\u3002\n- \u6b63\u89e3\u771f\u7684\u5f88\u5999\uff0c\u76f8\u6bd4\u4e4b\u4e0b\u8fd9\u4e2a\u5927\u66b4\u529b\u5199\u6302\u4e5f\u6ca1\u5565\u597d\u8bf4\u7684\u3002\n\n**\u9898\u610f**\n- [\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P8294)\u3002\n- \u7ed9\u51fa\u4e00\u4e2a\u4e8c\u53c9\u6811\uff0c\u6bcf\u4e2a\u70b9\u6709\u70b9\u6743\uff0c\u6309\u987a\u5e8f\u5207\u65ad\u5b83\u7684 $n-1$ \u6761\u8fb9\uff0c\u4ee3\u4ef7\u662f\u8fb9\u6240\u8fde\u7684\u4e24\u4e2a\u70b9\u7684\u6743\u503c\u548c\uff0c\u4e14\u65ad\u8fb9\u4e4b\u540e\u4e24\u70b9\u4f1a\u4ea4\u6362\u6743\u503c\uff0c\u4f60\u7684\u76ee\u7684\u662f\u6700\u5c0f\u5316\u6743\u503c\u548c\u3002\n\n**\u5206\u6790**\n- \u4f60\u8fc5\u901f\u60f3\u5230\u4e86\u6811\u5f62 $\\text{DP}$ \u7684\u601d\u8def\uff0c\u4f46\u4f3c\u4e4e\u96be\u4ee5\u5165\u624b\u3002\n- \u4e8c\u53c9\u6811\u7684\u6027\u8d28\u4f7f\u5f97\u5b83\u4fbf\u4e8e\u5408\u5e76\uff0c\u4f60\u5c1d\u8bd5\u601d\u8003\uff0c\u53d1\u73b0\u5bf9\u4e8e\u4e00\u4e2a\u8282\u70b9\uff08\u65c1\u8fb9\u7684 $3$ \u6761\u8fb9\uff09\uff0c\u65ad\u8fb9\u7684\u6b21\u5e8f\u60c5\u51b5\u81f3\u591a\u6709 $3!$ \u79cd\u60c5\u51b5\uff0c\u5c1d\u8bd5\u6839\u636e\u5b83\u5217\u4e00\u4e2a\u7b80\u5355\u7684\u52a8\u6001\u89c4\u5212\u3002\n![](https://cdn.luogu.com.cn/upload/image_hosting/d2xdvf1a.png)\n- \u6bd4\u5982\u8bf4\uff1a$f(u,a,b)$ \u8868\u793a\u5b50\u6811 $u$ \u5728\u65ad\u6389\u4e0a\u9762\u8fde\u7684\u4e00\u6761\u8fb9\u4e4b\u524d\u539f\u6765\u8282\u70b9 $a$ \u8dd1\u5230\u4e86\u8fd9\u91cc\uff0c\u65ad\u6389\u4e4b\u540e\uff0c\u8282\u70b9 $b$ \u8dd1\u5230\u8fd9\u91cc\u7684\u6700\u77ed\u8ddd\u79bb\uff0c\u5c31\u662f\u7b97\u7b54\u6848\u6709\u70b9\u9ebb\u70e6\uff0c\u6700\u66b4\u529b\u7684\u5b9e\u73b0\u662f $O(n^4)$ \u7684\uff0c[\u4ee3\u7801](https://www.luogu.com.cn/paste/y5umj0dn)\uff0c\u4f46\u662f\u5bf9\u4e8e $6$ \u79cd\u8f6c\u79fb\u7a0d\u5fae\u9488\u5bf9\u4e0b\uff0c\u5bb9\u6613\u4f18\u5316\u5230 $O(n^3)$\uff0c[\u4ee3\u7801](https://www.luogu.com.cn/paste/hkoli7b2)\u3002\n- \u4f46\u662f\u5f88\u60b2\u5267\u7684\u95ee\u9898\u662f\u6211\u4eec\u8fd9\u4e2a\u52a8\u6001\u89c4\u5212\u7684\u72b6\u6001\u603b\u6570\u5c31\u662f $O(n^3)$\uff0c\u6240\u4ee5\u7ee7\u7eed\u6cbf\u7740\u8fd9\u6761\u9053\u8def\u4f18\u5316\u5c31\u884c\u4e0d\u901a\u4e86\u2026\u2026\n- \u4f60\u8fc5\u901f\u5730\u53d1\u73b0\uff0c\u5728\u5bf9\u539f\u672c\u7684\u52a8\u6001\u89c4\u5212\u8fdb\u884c\u8f6c\u79fb\u7684\u65f6\u5019\uff0c\u6709\u51e0\u79cd\u60c5\u51b5\u662f\u4e0d\u5fc5\u8bbe $O(n^3)$ \u7684\u72b6\u6001\u7684\uff1a\n- \u6bd4\u5982\u8bf4\uff1a\u7b2c\u4e8c\u4e2a\u4f4d\u79fb\u56fe\u6697\u793a\u5b83\u53ea\u4f1a\u8f93\u51fa\u8282\u70b9 $u$\uff0c\u7b2c\u4e09\u4e2a\u4f4d\u79fb\u56fe\u6697\u793a\u8f93\u5165\u7684\u8282\u70b9\u6839\u672c\u65e0\u6cd5\u52a8\u5f39\u3002\n- \u800c\u7b2c\u4e00\u79cd\u4f4d\u79fb\u4f3c\u4e4e\u662f\u6700\u590d\u6742\u7684\uff0c\u4f46\u662f\u5b83\u7ed9\u7684\u6697\u793a\u4e5f\u6700\u660e\u786e\uff1a\u5b83\u6697\u793a\u5b83\u7684\u5de6\u5b50\u6811\u53ea\u4f1a\u63a5\u53d7\u5b83\u7236\u4eb2\u7684\u7ed9\u4e88\uff0c\u800c\u53f3\u5b50\u6811\u8f93\u51fa\u7684\u8282\u70b9\u6839\u672c\u65e0\u6cd5\u52a8\u5f39\u3002\n- \u5b83\u7684\u5b9e\u8d28\u5c31\u662f\u5229\u7528\u4e09\u79cd\u4f4d\u79fb\u56fe\u7684\u90a3\u4e2a\u4e0d\u8fde\u7eed\u7684\u201c\u65ad\u8fb9\u201d\u4f18\u5316\u72b6\u6001\u3002\n- \u56e0\u6b64\u4f60\u7528\u4e00\u79cd\u6781\u5176\u5947\u602a\u7684\u65b9\u5f0f\u505a\u5230\u4e86 $O(n^2)$ \u7684\u72b6\u6001\u6570\uff0c\u4f46\u662f\u5b83\u7684\u590d\u6742\u5ea6\u662f\u5426\u771f\u7684\u66f4\u597d\u4e00\u70b9\u5462\uff1f\n- \u90a3\u5f53\u7136\u53d6\u51b3\u4e8e\u6211\u4eec\u7684\u52a8\u6001\u89c4\u5212\u65b9\u6cd5\uff0c\u4f60\u5217\u51fa\u4e86\u5982\u4e0b\u65b9\u7a0b\uff08\u4ee5\u4e0a\u6240\u6709\u5f0f\u5b50\u90fd\u4e0d\u4e25\u683c\uff0c\u5177\u4f53\u5b9e\u73b0\u8981\u53e6\u5916\u8003\u8651\uff09\uff1a\n- $f(u,i,j)$ \u8868\u793a\u5b50\u6811 $u$ \u5728\u65ad\u6389\u4e0a\u9762\u8fde\u7684\u4e00\u6761\u8fb9\u4e4b\u524d\u539f\u6765\u8282\u70b9 $i$ \u8dd1\u5230\u4e86\u8fd9\u91cc\uff0c\u65ad\u6389\u4e4b\u540e\uff0c\u8282\u70b9 $j$ \u8dd1\u5230\u8fd9\u91cc\u7684\u6700\u77ed\u8ddd\u79bb\u3002\n- $f_0(u,i)=f(u,u,i)$\uff0c\u8f93\u51fa $u$ \u7684\u60c5\u51b5\u3002\n- $f_1(u,i)$ \u8868\u793a\u5b50\u6811 $u$ \u4f1a\u8f93\u51fa\u8282\u70b9 $i$\uff0c\u540c\u65f6\u53ea\u8ba9\u5916\u6765\u8282\u70b9\u5728 $u$ \u4e0a\u505c\u7559\u7684\u60c5\u51b5\u3002\n- $f_2(u,i)=f(u,i,\\text{fa}(u))$\uff0c\u76f4\u63a5\u4e0e\u5b83\u7236\u4eb2\u4ea4\u6362\u7684\u60c5\u51b5\u3002\n- $f_3(u,i)=\\min_{j=1}^nf(u,j,i)+w_i+w_j$\uff0c\u8003\u8651\u8f93\u51fa\u8282\u70b9\u65e0\u6cd5\u52a8\u5f39\u7684\u60c5\u51b5\u3002\n- \u7136\u540e\u4f60\u53d1\u73b0\uff1a\n- $f_0(u,i)\\to f(u,u,i)$\uff0c$f_1(u,i)+w_i+w_j\\to f(u,i,j)$\u3002\n- \u5982\u679c $u$ \u6709\u4e24\u4e2a\u513f\u5b50 $a,b$\uff1a$f_2(a,i)+f_3(b,j)\\to f(u,i,j)$\u3002\n- \u521a\u624d\u7684\u63a8\u5bfc\u544a\u8bc9\u6211\u4eec\u53ea\u9700\u8981\u8fd9\u4e09\u7c7b\u8d21\u732e\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa $f(u,i,j)$\uff0c\u4e5f\u5c31\u662f\u8bf4\u5b83\u5b9e\u9645\u4e0a\u53ef\u4ee5 $O(1)$ \u8ba1\u7b97\uff0c\u5982\u679c\u76f4\u63a5\u66b4\u529b\u63a8\u5bfc\u7684\u8bdd\u6211\u4eec\u5c31\u727a\u7272\u4e86\u4e00\u70b9\u5e38\u6570\u6362\u6765\u4e86\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n^2)$ \u7684 $O(n^3)$ \u505a\u6cd5\uff08\u56e0\u4e3a $f_2,f_3$ \u5f88\u6709\u7528\uff09\uff0c[\u4ee3\u7801](https://www.luogu.com.cn/paste/t2ex2woi)\u3002\n- \u7136\u540e\u5b83\u53ef\u4ee5\u4f18\u5316\u4e3a $O(n^2)$\uff08\u53ea\u6709\u4e00\u4e2a $f$ \u7684\u6c42\u503c\u5176\u5b9e\u5f88\u597d\u4f18\u5316\uff09\uff0c\u5927\u6982\u5c31\u662f\u628a\u91cc\u9762\u7684\u51fd\u6570\u66b4\u529b\u5c55\u5f00\u4e0b\u5c31\u597d\u4e86\uff08\u5982\u679c\u4f60\u60f3\u542c\u7684\u8be6\u7ec6\u70b9\u7684\u8bdd\uff1a\u91cc\u9762\u7684\u5f0f\u5b50\u8981\u4e48\u53ea\u548c $i$ \u6709\u5173\u8981\u4e48\u4e4b\u548c $j$ \u6709\u5173\uff0c\u53ef\u4ee5\u5148\u4e00\u6b21\u5faa\u73af\u6c42\u51fa\u6700\u503c\uff0c\u518d\u4e00\u6b21\u5faa\u73af\u66f4\u65b0\uff09\uff0c\u600e\u4e48\u8bf4\u5462\uff0c\u601d\u7ef4\u96be\u5ea6\u6781\u4f4e\uff08\u8fd9\u4e2a DP \u4f18\u5316\u751a\u81f3\u53ef\u4ee5\u5728\u4e00\u4e9b\u9ec4\u9898\u91cc\u627e\u5230\uff09\uff0c\u4ee3\u7801\u96be\u5ea6\u4f4e\uff08\u7edd\u5927\u90e8\u5206\u7684\u60c5\u51b5\u90fd\u662f\u590d\u5236\u7c98\u8d34\uff09[\u4ee3\u7801](https://www.luogu.com.cn/paste/abrb2kbq)\u3002",
        "postTime": 1651114009,
        "uid": 260884,
        "name": "WeLikeStudying",
        "ccfLevel": 0,
        "title": "\u6700\u5927\u6743\u72ec\u7acb\u96c6\u95ee\u9898"
    },
    {
        "content": "[\u6d1b\u8c37\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P8294)\n\n\u5de8\u5927\u7cbe\u795e\u6c61\u67d3\u9898\u3002\n\n\u9996\u5148\u8003\u8651 $n^3$ \u505a\u6cd5\uff1a$dp_{i,j,k}$ \u8868\u793a\u76ee\u524d\u5df2\u7ecf\u65ad\u6389\u4e86 $i$ \u5b50\u6811\u5185\u6240\u6709\u8fb9\u4ee5\u53ca $i$ \u4e0e\u7236\u4eb2\u7684\u8fb9\uff0c\u5047\u8bbe\u521d\u59cb\u65f6 $k$ \u88ab\u6362\u5230\u4e86 $i$ \u7684\u7236\u4eb2\u7684\u4f4d\u7f6e\uff0c\u8981\u5c06 $j$ \u6362\u51fa $i$ \u7684\u5b50\u6811\uff0c$k$ \u6362\u5165 $i$ \u7684\u5b50\u6811\u6240\u9700\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\u5217\u51fa\u72b6\u6001\u540e\uff0c\u8f6c\u79fb\u5e94\u8be5\u662f\u6bd4\u8f83\u663e\u7136\u7684\uff1a\n$$\ndp_{i,j,k}=\n\\begin{cases}\nd_j+d_k&(\\text{leftson}=\\varnothing,\\text{rightson}=\\varnothing)\\\\\nd_j+d_k+\\min\\limits_{l\\in\\text{subtree}(i),l\\ne i}dp_{ls,l,k}&(\\text{leftson}\\ne\\varnothing,\\text{rightson}=\\varnothing,j=i)\\\\\nd_j+d_k+dp_{ls,j,i}&(\\text{leftson}\\ne\\varnothing,\\text{rightson}=\\varnothing,j\\ne i)\\\\\nd_j+d_k+\\min\\limits_{x\\in\\text{subtree}(ls_i)}\\min\\limits_{y\\in\\text{subtree}(rs_i)}\\min(dp_{ls,x,k}+dp_{rs,y,x},dp_{rs,y,k}+dp_{ls,x,y})&(\\text{leftson}\\ne\\varnothing,\\text{rightson}\\ne\\varnothing,j=i)\\\\\nd_j+d_k+\\min\\limits_{x\\in\\text{subtree}(rs_i)}\\min(dp_{ls,j,i}+dp_{rs,x,k},dp_{rs,x,i}+dp_{ls,j,x})&(\\text{leftson}\\ne\\varnothing,\\text{rightson}\\ne\\varnothing,j\\in\\text{subtree}(ls))\\\\\n\\end{cases}\n$$\n\u5176\u4e2d $son_i$ \u8868\u793a $i$ \u70b9\u7684\u513f\u5b50\u4e2a\u6570\uff0c\u4e0a\u9762\u8f6c\u79fb\u65b9\u7a0b\u4e2d\u53ef\u80fd\u6709\u4e00\u4e9b\u5bf9\u79f0\u7684\u8f6c\u79fb\u6ca1\u6709\u5217\u51fa\u6765\uff0c\u8fd9\u662f\u65e0\u5173\u7d27\u8981\u7684\u3002\n\n\u76f4\u63a5\u8fd9\u6837\u5199\u53ef\u4ee5\u83b7\u5f97 44 \u5206\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\nconst int MAXN = 500;\nint n, d[MAXN + 5], fa[MAXN + 5], sub[MAXN + 5][MAXN + 5];\nint ls[MAXN + 5], rs[MAXN + 5];\nll dp[MAXN + 5][MAXN + 5][MAXN + 5];\nint main() {\n\tscanf(\"%d\", &n);\n\tfor (int i = 1; i <= n; i++) scanf(\"%d\", &d[i]);\n\tfor (int i = 2; i <= n; i++) scanf(\"%d\", &fa[i]);\n\tfor (int i = 1; i <= n; i++) sub[i][i] = 1;\n\tfor (int i = 2; i <= n; i++) {\n\t\tif (!ls[fa[i]]) ls[fa[i]] = i;\n\t\telse rs[fa[i]] = i;\n\t}\n\tmemset(dp, 63, sizeof(dp));\n\tfor (int i = n; i; i--) {\n\t\tfor (int j = 1; j <= n; j++) sub[fa[i]][j] |= sub[i][j];\n\t\tfor (int j = 1; j <= n; j++) if (sub[i][j])\n\t\t\tfor (int k = 1; k <= n; k++) if (!sub[i][k]) {\n\t\t\t\tif (!ls[i]) dp[i][j][k] = d[j] + d[k];\n\t\t\t\telse if (!rs[i]) {\n\t\t\t\t\tint a = ls[i];\n\t\t\t\t\tif (j == i) {\n\t\t\t\t\t\tfor (int l = 1; l <= n; l++) if (sub[a][l])\n\t\t\t\t\t\t\tchkmin(dp[i][j][k], d[j] + d[k] + dp[a][l][k]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdp[i][j][k] = dp[a][j][i] + d[j] + d[k];\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tint a = ls[i], b = rs[i];\n\t\t\t\t\tif (j == i) {\n\t\t\t\t\t\tfor (int x = 1; x <= n; x++) if (sub[a][x])\n\t\t\t\t\t\t\tfor (int y = 0; y <= n; y++) if (sub[b][y]) {\n\t\t\t\t\t\t\t\tchkmin(dp[i][j][k], d[j] + d[k] + dp[a][x][k] + dp[b][y][x]);\n\t\t\t\t\t\t\t\tchkmin(dp[i][j][k], d[j] + d[k] + dp[b][y][k] + dp[a][x][y]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t} else if (sub[a][j]) {\n\t\t\t\t\t\tfor (int x = 1; x <= n; x++) if (sub[b][x]) {\n\t\t\t\t\t\t\tchkmin(dp[i][j][k], dp[a][j][i] + d[j] + d[k] + dp[b][x][k]);\n\t\t\t\t\t\t\tchkmin(dp[i][j][k], dp[b][x][i] + dp[a][j][x] + d[j] + d[k]);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfor (int x = 1; x <= n; x++) if (sub[a][x]) {\n\t\t\t\t\t\t\tchkmin(dp[i][j][k], dp[b][j][i] + d[j] + d[k] + dp[a][x][k]);\n\t\t\t\t\t\t\tchkmin(dp[i][j][k], dp[a][x][i] + dp[b][j][x] + d[j] + d[k]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n//\t\t\t\tprintf(\"dp[%d][%d][%d] = %lld\\n\", i, j, k, dp[i][j][k]);\n\t\t\t}\n\t}\n\tll mn = 1e18;\n\tif (!rs[1]) {\n\t\tint a = ls[1];\n\t\tfor (int i = 2; i <= n; i++) chkmin(mn, dp[a][i][1]);\n\t} else {\n\t\tint a = ls[1], b = rs[1];\n\t\tfor (int i = 2; i <= n; i++) if (sub[a][i])\n\t\t\tfor (int j = 2; j <= n; j++) if (sub[b][j]) {\n\t\t\t\tchkmin(mn, dp[a][i][1] + dp[b][j][i]);\n\t\t\t\tchkmin(mn, dp[b][j][1] + dp[a][i][j]);\n\t\t\t}\n\t}\n\tprintf(\"%lld\\n\", mn);\n\treturn 0;\n}\n```\n\n\u8003\u8651\u4f18\u5316\uff0c\u6211\u4eec\u8003\u8651\u5728\u6bcf\u4e00\u8f6e DP \u7684\u65f6\u5019\u5904\u7406\u51fa\u4ee5\u4e0b\u6570\u7ec4\uff1a\n\n- $f0_{i,j}$ \u8868\u793a\u6839\u8282\u70b9\u4e3a $i$\uff0c\u628a $i$ \u6362\u51fa\u53bb\uff0c$j$ \u6362\u8fdb\u6765\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u5373 $dp_{i,i,j}$\u3002\n- $f1_{i,j}$ \u8868\u793a\u6839\u8282\u70b9\u4e3a $i$\uff0c\u628a $j$ \u6362\u51fa\u53bb\uff0c$fa_i$ \u6362\u8fdb\u6765\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u5373 $dp_{i,j,fa_i}$\u3002\n- $f2_{i,j}$ \u8868\u793a\u628a $i$ \u5b50\u6811\u5185\u4efb\u4f55\u4e00\u4e2a\u70b9\u6362\u51fa\u53bb\uff0c$j$ \u6362\u8fdb\u6765\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u5373 $\\min\\limits_{x\\in\\text{subtree}(i)}dp_{i,x,j}$\u3002\n- $f3_{i,j}$ \u8868\u793a\u5148\u4ea4\u6362 $j$ \u76f8\u5bf9\u4e8e $i$ \u7684\u53e6\u4e00\u4fa7\u5b50\u6811\u5185\u67d0\u4e2a\u8282\u70b9 $x$\uff0c\u5e76\u628a $x$ \u6362\u51fa\u53bb\u3001\u628a $i$ \u6362\u8fdb\u53e6\u4e00\u4fa7\u5b50\u6811\uff0c\u518d\u5c06 $x$ \u6362\u8fdb $j$ \u8fd9\u4e00\u4fa7\u5b50\u6811\uff0c$j$ \u6362\u51fa\u53bb\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\u8fd9\u53e5\u8bdd\u8bfb\u8d77\u6765\u7a0d\u5fae\u6709\u70b9\u62d7\u53e3\uff0c\u5199\u6210\u5f0f\u5b50\u7684\u5f62\u5f0f\u5c31\u662f\u5982\u679c $j$ \u5728 $x$ \u5de6\u513f\u5b50\u5b50\u6811\u5185\uff0c\u90a3\u4e48 $f3_{i,j}=\\min\\limits_{x\\in\\text{subtree}(rs_i)}dp_{rs,x,i}+dp_{ls,j,x}$\uff0c\u5bf9\u4e8e\u53f3\u5b50\u6811\u7684\u60c5\u51b5\u4e5f\u7c7b\u4f3c\u3002\n\n\u6c42\u51fa\u8fd9\u56db\u4e2a\u6570\u7ec4\u6709\u4ec0\u4e48\u597d\u5904\u5462\uff1f\u4e0d\u96be\u53d1\u73b0\u6709\u4e86\u8fd9\u56db\u4e2a\u6570\u7ec4\u540e\u6211\u4eec\u5c31\u53ef\u4ee5 $\\mathcal O(1)$ \u5730\u6c42\u51fa $dp_{i,j,k}$\uff0c\u5373\n$$\ndp_{i,j,k}=\n\\begin{cases}\nf0_{i,k}&(j=i)\\\\\nf1_{ls,j}+d_j+d_k&(\\text{leftson}\\ne\\varnothing,\\text{rightson}=\\varnothing)\\\\\n\\min(f1_{ls,j}+f2_{rs,k},f3_{ls,j})+d_j+d_k&(\\text{leftson}\\ne\\varnothing,\\text{rightson}=\\varnothing,j\\in\\text{subtree(ls)})\\\\\n\\end{cases}\n$$\n\u8fd9\u6837\u7a7a\u95f4\u590d\u6742\u5ea6\u5c31\u964d\u5230\u4e86 $n^2$\uff0c\u4f46\u662f\u65f6\u95f4\u590d\u6742\u5ea6\u8fd8\u662f $n^3$\uff0c\u5927\u6982\u53d6\u51b3\u4e8e\u5b9e\u73b0\u53ef\u4ee5\u901a\u8fc7\u90e8\u5206 $n\\le 1000$ \u7684\u6d4b\u8bd5\u70b9\u3002\n\n\u9644\uff1a\u8fd9\u90e8\u5206\u7684\u4ee3\u7801\uff1a\n\n```cpp\nconst int MAXN = 5000;\nint n, d[MAXN + 5], fa[MAXN + 5], sub[MAXN + 5][MAXN + 5];\nint ls[MAXN + 5], rs[MAXN + 5];\nvector<int> vec[MAXN + 5];\nll f0[MAXN + 5][MAXN + 5], f1[MAXN + 5][MAXN + 5], f2[MAXN + 5][MAXN + 5], f3[MAXN + 5][MAXN + 5];\nll calc(int i, int j, int k) {\n\tif (j == i) return f0[i][k];\n\telse if (!rs[i]) return f1[ls[i]][j] + d[j] + d[k];\n\telse {\n\t\tint a = ls[i], b = rs[i];\n\t\tif (sub[a][j]) return min(f1[a][j] + f2[b][k], f3[i][j]) + d[j] + d[k];\n\t\telse return min(f1[b][j] + f2[a][k], f3[i][j]) + d[j] + d[k];\n\t}\n}\nint main() {\n\tscanf(\"%d\", &n);\n\tfor (int i = 1; i <= n; i++) scanf(\"%d\", &d[i]);\n\tfor (int i = 2; i <= n; i++) scanf(\"%d\", &fa[i]);\n\tfor (int i = 1; i <= n; i++) sub[i][i] = 1, vec[i].pb(i);\n\tfor (int i = 2; i <= n; i++) {\n\t\tif (!ls[fa[i]]) ls[fa[i]] = i;\n\t\telse rs[fa[i]] = i;\n\t}\n\tfor (int i = n; i > 1; i--) {\n\t\tfor (int j = 1; j <= n; j++) sub[fa[i]][j] |= sub[i][j];\n\t\tfor (int x : vec[i]) vec[fa[i]].pb(x);\n\t\tfor (int k = 1; k <= n; k++) if (!sub[i][k]) {\n\t\t\tif (!ls[i]) f0[i][k] = d[i] + d[k];\n\t\t\telse if (!rs[i]) f0[i][k] = d[i] + d[k] + f2[ls[i]][k];\n\t\t\telse {\n\t\t\t\tint a = ls[i], b = rs[i];\n\t\t\t\tf0[i][k] = 1e18;\n\t\t\t\tfor (int x : vec[a]) for (int y : vec[b]) {\n\t\t\t\t\tchkmin(f0[i][k], d[i] + d[k] + calc(a, x, k) + calc(b, y, x));\n\t\t\t\t\tchkmin(f0[i][k], d[i] + d[k] + calc(b, y, k) + calc(a, x, y));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (rs[i]) {\n\t\t\tint a = ls[i], b = rs[i];\n\t\t\tfor (int x : vec[a]) f3[i][x] = 1e18;\n\t\t\tfor (int x : vec[b]) f3[i][x] = 1e18;\n\t\t\tfor (int x : vec[a]) for (int y : vec[b]) chkmin(f3[i][x], calc(b, y, i) + calc(a, x, y));\n\t\t\tfor (int x : vec[a]) for (int y : vec[b]) chkmin(f3[i][y], calc(a, x, i) + calc(b, y, x));\n\t\t}\n\t\tfor (int j : vec[i]) f1[i][j] = calc(i, j, fa[i]);\n\t\tfor (int j = 1; j <= n; j++) if (!sub[i][j]) {\n\t\t\tf2[i][j] = 1e18;\n\t\t\tfor (int x : vec[i]) chkmin(f2[i][j], calc(i, x, j));\n\t\t}\n\t}\n\tll mn = 1e18;\n\tif (!rs[1]) {\n\t\tint a = ls[1];\n\t\tfor (int i = 2; i <= n; i++) chkmin(mn, calc(a, i, 1));\n\t} else {\n\t\tint a = ls[1], b = rs[1];\n\t\tfor (int i : vec[a])  for (int j : vec[b]) {\n\t\t\tchkmin(mn, calc(a, i, 1) + calc(b, j, i));\n\t\t\tchkmin(mn, calc(b, j, 1) + calc(a, i, j));\n\t\t}\n\t}\n\tprintf(\"%lld\\n\", mn);\n\treturn 0;\n}\n/*\n10\n9 5 6 3 8 7 1 4 1 3\n1 2 2 4 1 4 3 8 5\n*/\n```\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u7565\u5fae\u6709\u70b9 dirty work \u7684\u5730\u65b9\u4e86\uff0c\u6ce8\u610f\u5230\u5728\u4e0a\u9762\u7684 DP \u8fc7\u7a0b\u4e2d\uff0c\u6c42\u89e3 $f1$ \u7684\u90e8\u5206\u590d\u6742\u5ea6\u80af\u5b9a\u4e0d\u4f1a\u51fa\u9519\uff0c$f3$ \u90e8\u5206\u7684\u590d\u6742\u5ea6\u5206\u6790\u7c7b\u4f3c\u4e8e\u6811\u5f62 DP\uff0c\u4e5f\u662f $\\mathcal O(n^2)$ \u7684\uff0c\u590d\u6742\u5ea6\u74f6\u9888\u5728\u4e8e $f0$ \u548c $f2$\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u7740\u624b\u53bb\u4f18\u5316\u5b83\u3002\u4ee5 $f2$ \u4e3a\u4f8b\uff0c\u6211\u4eec\u56fa\u5b9a\u4e86 $i$\uff0c\u8981\u5bf9\u4e8e\u6bcf\u4e2a $j$\uff0c\u6c42\u51fa $\\min\\limits_{x\\in\\text{subtree}(i)}dp_{i,x,j}$\uff0c\u4e0d\u59a8\u5148\u7279\u5224 $x=i$\uff0c\u5bf9\u4e8e $x\\ne i$\uff0c\u6309\u7167\u4e0a\u9762\u7684\u516c\u5f0f\u5c55\u5f00 $dp_{i,x,j}$\uff0c\u5206\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n- \u5982\u679c $i$ \u6ca1\u6709\u53f3\u513f\u5b50\uff0c\u90a3\u4e48 $dp_{i,x,j}=d_x+d_j+f1_{ls,x}$\uff0c\u56e0\u6b64\u6211\u4eec\u904d\u5386\u6240\u6709 $x$ \u5e76\u7ef4\u62a4 $d_x+f1_{ls,x}$ \u7684\u6700\u5c0f\u503c\u3002\n- \u5982\u679c $i$ \u6709\u53f3\u513f\u5b50\uff0c\u90a3\u4e48\u8fd9\u91cc\u4e0d\u59a8\u8003\u8651 $x$ \u5728 $i$ \u5de6\u5b50\u6811\u5185\u60c5\u51b5\uff0c\u53e6\u4e00\u90e8\u5206\u955c\u50cf\u4e00\u4e0b\u5373\u53ef\u3002\u5219 $dp_{i,x,j}=\\min(f1_{ls,x}+f2_{rs,j},f3_{i,x})+d_x+d_j$\uff0c\u6211\u4eec\u5c06\u4e24\u90e8\u5206\u5206\u522b\u6c42 $\\min$\uff0c\u5373\u6c42 $f1_{ls,x}+f2_{rs,j}+d_x+d_j$ \u548c $f3_{i,x}+d_x+d_j$ \u7684\u6700\u5c0f\u503c\uff0c\u8fd9\u6837\u6211\u4eec\u53ea\u7528\u904d\u5386 $x$ \u7684\u540c\u65f6\u7ef4\u62a4 $f1_{ls,x}+d_x$ \u548c $f3_{i,x}+d_x$ \u7684\u6700\u5c0f\u503c\u5373\u53ef\u3002\n\n$f0$ \u7684\u5904\u7406\u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u53c2\u53d8\u5206\u79bb\u7684\u601d\u60f3\u3002\u8fd9\u6837\u65f6\u7a7a\u590d\u6742\u5ea6\u5747\u964d\u5230\u4e86 $\\mathcal O(n^2)$\u3002\u7ec6\u8282\u5f88\u591a\u3002\n\n```cpp\nconst int MAXN = 5000;\nint n, d[MAXN + 5], fa[MAXN + 5], sub[MAXN + 5][MAXN + 5];\nint ls[MAXN + 5], rs[MAXN + 5];\nvector<int> vec[MAXN + 5];\nll f0[MAXN + 5][MAXN + 5]; // f0[i][j] \u8868\u793a\u6839\u8282\u70b9\u4e3a i\uff0c\u628a i \u6362\u51fa\u53bb\uff0cj \u6362\u8fdb\u6765\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002 \nll f1[MAXN + 5][MAXN + 5]; // f1[i][j] \u8868\u793a\u6839\u8282\u70b9\u4e3a i\uff0c\u628a j \u6362\u51fa\u53bb\uff0cfa[i] \u6362\u8fdb\u6765\u7684\u6700\u5c0f\u4ee3\u4ef7 \nll f2[MAXN + 5][MAXN + 5]; // f2[i][j] \u8868\u793a\u53ef\u4ee5\u628a i \u5b50\u6811\u5185\u4efb\u4f55\u4e00\u4e2a\u70b9\u6362\u51fa\u53bb\uff0cj \u6362\u8fdb\u6765\u7684\u6700\u5c0f\u4ee3\u4ef7 \nll f3[MAXN + 5][MAXN + 5];\n// f3[i][j] \u8868\u793a\u5148\u4ea4\u6362 j \u76f8\u5bf9\u4e8e i \u7684\u53e6\u4e00\u4fa7\u5b50\u6811\u5185\u67d0\u4e2a\u8282\u70b9 x\uff0c\u5e76\u628a x \u6362\u51fa\u53bb\u3001\u628a i \u6362\u8fdb\u53e6\u4e00\u4fa7\u5b50\u6811\uff0c\u518d\u5c06 x \u6362\u8fdb j \u8fd9\u4e00\u4fa7\u5b50\u6811\uff0cj \u6362\u51fa\u53bb\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\nll calc(int i, int j, int k) {\n\tif (j == i) return f0[i][k];\n\telse if (!rs[i]) return f1[ls[i]][j] + d[j] + d[k];\n\telse {\n\t\tint a = ls[i], b = rs[i];\n\t\tif (sub[a][j]) return min(f1[a][j] + f2[b][k], f3[i][j]) + d[j] + d[k];\n\t\telse return min(f1[b][j] + f2[a][k], f3[i][j]) + d[j] + d[k];\n\t}\n}\nint main() {\n\tfreopen(\"mis.in\", \"r\", stdin);\n\tfreopen(\"mis.out\", \"w\", stdout);\n\tscanf(\"%d\", &n);\n\tfor (int i = 1; i <= n; i++) scanf(\"%d\", &d[i]);\n\tfor (int i = 2; i <= n; i++) scanf(\"%d\", &fa[i]);\n\tfor (int i = 1; i <= n; i++) sub[i][i] = 1, vec[i].pb(i);\n\tfor (int i = 2; i <= n; i++) {\n\t\tif (!ls[fa[i]]) ls[fa[i]] = i;\n\t\telse rs[fa[i]] = i;\n\t}\n\tfor (int i = n; i > 1; i--) {\n\t\tfor (int j = 1; j <= n; j++) sub[fa[i]][j] |= sub[i][j];\n\t\tfor (int x : vec[i]) vec[fa[i]].pb(x);\n\t\tif (!ls[i]) {\n\t\t\tfor (int k = 1; k <= n; k++) if (!sub[i][k])\n\t\t\t\tf0[i][k] = d[i] + d[k];\n\t\t}\n\t\telse if (!rs[i]) {\n\t\t\tfor (int k = 1; k <= n; k++) if (!sub[i][k])\n\t\t\t\tf0[i][k] = d[i] + d[k] + f2[ls[i]][k];\n\t\t}\n\t\telse {\n\t\t\tint a = ls[i], b = rs[i];\n\t\t\tfor (int k = 1; k <= n; k++) if (!sub[i][k]) f0[i][k] = 1e18;\n\t\t\tll mn1 = 1e18, mn2 = 1e18, mn3 = 1e18;\n\t\t\tfor (int x : vec[a]) {\n\t\t\t\tll mn = 1e18;\n\t\t\t\tfor (int y : vec[b]) chkmin(mn, calc(b, y, x));\n\t\t\t\tif (x == a) {\n\t\t\t\t\tfor (int k = 1; k <= n; k++) if (!sub[i][k])\n\t\t\t\t\t\tchkmin(f0[i][k], d[i] + d[k] + calc(a, x, k) + mn);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (!rs[a]) chkmin(mn1, mn + d[i] + f1[ls[a]][x] + d[x]);\n\t\t\t\telse {\n\t\t\t\t\tint aa = ls[a], ab = rs[a];\n\t\t\t\t\tif (sub[aa][x]) {\n\t\t\t\t\t\t// calc(a, x, k) = min(f1[aa][x] + f2[ab][k], f3[a][x]) + d[x] + d[k]\n\t\t\t\t\t\tchkmin(mn2, f1[aa][x] + d[x] + mn + d[i]);\n\t\t\t\t\t\tchkmin(mn1, d[x] + mn + d[i] + f3[a][x]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchkmin(mn3, f1[ab][x] + d[x] + mn + d[i]);\n\t\t\t\t\t\tchkmin(mn1, d[x] + mn + d[i] + f3[a][x]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!rs[a]) {\n\t\t\t\tfor (int k = 1; k <= n; k++) if (!sub[i][k])\n\t\t\t\t\tchkmin(f0[i][k], mn1 + d[k] + d[k]);\n\t\t\t} else {\n\t\t\t\tint aa = ls[a], ab = rs[a];\n\t\t\t\tfor (int k = 1; k <= n; k++) if (!sub[i][k]) {\n\t\t\t\t\tchkmin(f0[i][k], mn1 + d[k] + d[k]);\n\t\t\t\t\tchkmin(f0[i][k], mn2 + f2[ab][k] + d[k] + d[k]);\n\t\t\t\t\tchkmin(f0[i][k], mn3 + f2[aa][k] + d[k] + d[k]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tswap(a, b);\n\t\t\tmn1 = 1e18, mn2 = 1e18, mn3 = 1e18;\n\t\t\tfor (int x : vec[a]) {\n\t\t\t\tll mn = 1e18;\n\t\t\t\tfor (int y : vec[b]) chkmin(mn, calc(b, y, x));\n\t\t\t\tif (x == a) {\n\t\t\t\t\tfor (int k = 1; k <= n; k++) if (!sub[i][k])\n\t\t\t\t\t\tchkmin(f0[i][k], d[i] + d[k] + calc(a, x, k) + mn);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tif (!rs[a]) chkmin(mn1, mn + d[i] + f1[ls[a]][x] + d[x]);\n\t\t\t\telse {\n\t\t\t\t\tint aa = ls[a], ab = rs[a];\n\t\t\t\t\tif (sub[aa][x]) {\n\t\t\t\t\t\t// calc(a, x, k) = min(f1[aa][x] + f2[ab][k], f3[a][x]) + d[x] + d[k]\n\t\t\t\t\t\tchkmin(mn2, f1[aa][x] + d[x] + mn + d[i]);\n\t\t\t\t\t\tchkmin(mn1, d[x] + mn + d[i] + f3[a][x]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchkmin(mn3, f1[ab][x] + d[x] + mn + d[i]);\n\t\t\t\t\t\tchkmin(mn1, d[x] + mn + d[i] + f3[a][x]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!rs[a]) {\n\t\t\t\tfor (int k = 1; k <= n; k++) if (!sub[i][k])\n\t\t\t\t\tchkmin(f0[i][k], mn1 + d[k] + d[k]);\n\t\t\t} else {\n\t\t\t\tint aa = ls[a], ab = rs[a];\n\t\t\t\tfor (int k = 1; k <= n; k++) if (!sub[i][k]) {\n\t\t\t\t\tchkmin(f0[i][k], mn1 + d[k] + d[k]);\n\t\t\t\t\tchkmin(f0[i][k], mn2 + f2[ab][k] + d[k] + d[k]);\n\t\t\t\t\tchkmin(f0[i][k], mn3 + f2[aa][k] + d[k] + d[k]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (rs[i]) {\n\t\t\tint a = ls[i], b = rs[i];\n\t\t\tfor (int x : vec[a]) f3[i][x] = 1e18;\n\t\t\tfor (int x : vec[b]) f3[i][x] = 1e18;\n\t\t\tfor (int x : vec[a]) for (int y : vec[b]) chkmin(f3[i][x], calc(b, y, i) + calc(a, x, y));\n\t\t\tfor (int x : vec[a]) for (int y : vec[b]) chkmin(f3[i][y], calc(a, x, i) + calc(b, y, x));\n\t\t}\n\t\tfor (int j : vec[i]) f1[i][j] = calc(i, j, fa[i]);\n\t\tfor (int j = 1; j <= n; j++) if (!sub[i][j]) f2[i][j] = calc(i, i, j);\n\t\tif (!rs[i]) {\n\t\t\tll mn = 1e18;\n\t\t\tfor (int v : vec[ls[i]]) chkmin(mn, d[v] + f1[ls[i]][v]);\n\t\t\tfor (int k = 1; k <= n; k++) if (!sub[i][k]) chkmin(f2[i][k], mn + d[k]);\n\t\t} else {\n\t\t\tll mn1 = 1e18, mn2 = 1e18, mn3 = 1e18;\n\t\t\tint a = ls[i], b = rs[i];\n\t\t\tfor (int v : vec[a]) chkmin(mn1, f1[a][v] + d[v]), chkmin(mn3, f3[i][v] + d[v]);\n\t\t\tfor (int v : vec[b]) chkmin(mn2, f1[b][v] + d[v]), chkmin(mn3, f3[i][v] + d[v]);\n\t\t\tfor (int k = 1; k <= n; k++) if (!sub[i][k]) {\n\t\t\t\tchkmin(f2[i][k], mn1 + f2[b][k] + d[k]);\n\t\t\t\tchkmin(f2[i][k], mn2 + f2[a][k] + d[k]);\n\t\t\t\tchkmin(f2[i][k], mn3 + d[k]);\n\t\t\t}\n\t\t}\n\t}\n\tll mn = 1e18;\n\tif (!rs[1]) {\n\t\tint a = ls[1];\n\t\tfor (int i = 2; i <= n; i++) chkmin(mn, calc(a, i, 1));\n\t} else {\n\t\tint a = ls[1], b = rs[1];\n\t\tfor (int i : vec[a])  for (int j : vec[b]) {\n\t\t\tchkmin(mn, calc(a, i, 1) + calc(b, j, i));\n\t\t\tchkmin(mn, calc(b, j, 1) + calc(a, i, j));\n\t\t}\n\t}\n\tprintf(\"%lld\\n\", mn);\n\treturn 0;\n}\n/*\n10\n9 5 6 3 8 7 1 4 1 3\n1 2 2 4 1 4 3 8 5\n*/\n```\n\n",
        "postTime": 1654497679,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P8294 [\u7701\u9009\u8054\u8003 2022] \u6700\u5927\u6743\u72ec\u7acb\u96c6\u95ee\u9898"
    },
    {
        "content": "#### \u9898\u89e3\r\n\r\n\u9996\u5148\u4e0d\u96be\u60f3\u5230 dp\uff1a$f_{u,x,y}$ \u8868\u793a\u5b50\u6811 $u$ \u5185 $x$ \u6362\u51fa\u53bb\uff0c$y$ \u6362\u8fdb\u6765\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\r\n\r\n$x$ \u8fd9\u4e00\u7ef4\u7c7b\u4f3c\u4e8e\u6811\u4e0a\u80cc\u5305\uff0c\u4e0d\u4f1a\u5f71\u54cd\u6548\u7387\uff0c\u4f46 $y$ \u8fd9\u4e00\u7ef4\u663e\u7136\u65e0\u6cd5\u7ee7\u7eed\u4f18\u5316\u4e86\u3002\u4e8e\u662f $y$ \u6539\u4e3a\u8bb0\u5f55\u6362\u8fdb\u6765\u7684\u70b9\u6700\u7ec8\u4f4d\u7f6e\u4e3a $y$\uff0c\u5728\u6362\u8fdb\u6765\u65f6\u518d\u8003\u8651\u8fd9\u4e2a\u70b9\u4ea7\u751f\u7684\u8d21\u732e\u3002\r\n\r\n\u8f6c\u79fb\u65f6\u9700\u8981\u679a\u4e3e\u4e24\u4e2a\u513f\u5b50\u7684 $x,y$\uff0c\u4f46\u6ce8\u610f\u5230\u8fd9\u56db\u4e2a\u4fe1\u606f\u603b\u662f\u6709\u82e5\u5e72\u4e2a\u662f\u76f8\u4e92\u72ec\u7acb\u7684\uff0c\u56e0\u6b64\u9884\u5904\u7406\u7c7b\u4f3c\u4e8e\u524d\u7f00 $\\min$ \u7684\u4e1c\u897f\u4e4b\u540e\u53ea\u9700\u8981\u679a\u4e3e\u4e24\u7ef4\u3002\u8fd9\u6837\u4e24\u7ef4\u7684\u5408\u5e76\u4f9d\u65e7\u4e0e\u6811\u5f62\u80cc\u5305\u7c7b\u4f3c\uff0c\u8003\u8651\u70b9\u5bf9\u95f4\u7684\u8d21\u732e\u53ef\u4ee5\u5f97\u5230\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2)$\u3002\r\n\r\n\u5b9e\u73b0\u65f6\u4e3a\u4e86\u65b9\u4fbf\u53ef\u4ee5\u76f4\u63a5\u8bb0\u5f55 $y$ \u8ddd\u79bb $u$ \u7684\u6df1\u5ea6\u800c\u975e\u8282\u70b9\uff0c\u4f46\u9700\u8981\u6ce8\u610f\u5bf9 $y$ \u7684\u8303\u56f4\u8fdb\u884c\u9650\u5236\u3002\r\n\r\n\u65f6\u95f4\u548c\u7a7a\u95f4\u590d\u6742\u5ea6\u5747\u4e3a $O(n^2)$\u3002\r\n\r\n#### \u4ee3\u7801\r\n\r\n```cpp\r\n#include <bits/stdc++.h>\r\nconst long long inf = 1LL << 60;\r\nint n, a[5010], fa[5010], ch[5010][2], dep[5010]; long long ans = inf;\r\nstd::vector<int> S[5010]; std::vector<long long> f[5010][5010];\r\nsigned main ()\r\n{\r\n\tscanf(\"%d\", &n); dep[0] = -1;\r\n\tfor (int i = 1; i <= n; i++) scanf(\"%d\", &a[i]);\r\n\tfor (int i = 2; i <= n; i++) scanf(\"%d\", &fa[i]), ch[fa[i]][ch[fa[i]][0] > 0] = i;\r\n\tfor (int i = n; i; i--)\r\n\t{\r\n\t\tS[i].push_back(i);\r\n\t\tdep[i] = std::max(dep[ch[i][0]], dep[ch[i][1]]) + 1;\r\n\t\tfor (int j : S[ch[i][0]]) S[i].push_back(j);\r\n\t\tfor (int j : S[ch[i][1]]) S[i].push_back(j);\r\n\t\tf[i][i].resize(dep[i] + 1);\r\n\t\tfor (int j : S[ch[i][0]]) f[i][j].resize(dep[ch[i][1]] + 2);\r\n\t\tfor (int j : S[ch[i][1]]) f[i][j].resize(dep[ch[i][0]] + 2);\r\n\t\tfor (int d = 0; d <= dep[i]; d++) f[i][i][d] = inf;\r\n\t\tfor (int j : S[ch[i][0]]) for (int d = 0; d <= dep[ch[i][1]] + 1; d++) f[i][j][d] = inf;\r\n\t\tfor (int j : S[ch[i][1]]) for (int d = 0; d <= dep[ch[i][0]] + 1; d++) f[i][j][d] = inf;\r\n\t\tif (!ch[i][0]) f[i][i][0] = a[i];\r\n\t\telse if (!ch[i][1])\r\n\t\t{\r\n\t\t\tfor (int j : S[ch[i][0]]) for (int d = 0; d < (int)f[ch[i][0]][j].size(); d++)\r\n\t\t\t\tf[i][i][d + 1] = std::min(f[i][i][d + 1], f[ch[i][0]][j][d] + a[i]),\r\n\t\t\t\tf[i][j][0] = std::min(f[i][j][0], f[ch[i][0]][j][d] + a[j] + 1LL * (d + 1) * a[i]);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tint maxp = 0, maxq = 0; long long tmp1[5010] = {0}, tmp2[5010] = {0}, tmp3[5010] = {0}, tmp4[5010] = {0};\r\n\t\t\tfor (int j : S[ch[i][0]]) maxp = std::max(maxp, (int)f[ch[i][0]][j].size()), tmp3[j] = inf;\r\n\t\t\tfor (int k : S[ch[i][1]]) maxq = std::max(maxq, (int)f[ch[i][1]][k].size()), tmp4[k] = inf;\r\n\t\t\tfor (int p = 0; p < maxp; p++) tmp1[p] = inf;\r\n\t\t\tfor (int q = 0; q < maxq; q++) tmp2[q] = inf;\r\n\t\t\tfor (int j : S[ch[i][0]]) for (int p = 0; p < (int)f[ch[i][0]][j].size(); p++) tmp1[p] = std::min(tmp1[p], f[ch[i][0]][j][p]);\r\n\t\t\tfor (int k : S[ch[i][1]]) for (int q = 0; q < (int)f[ch[i][1]][k].size(); q++) tmp2[q] = std::min(tmp2[q], f[ch[i][1]][k][q]);\r\n\t\t\tfor (int j : S[ch[i][0]]) for (int p = 0; p < (int)f[ch[i][0]][j].size(); p++) tmp3[j] = std::min(tmp3[j], f[ch[i][0]][j][p] + 1LL * (p + 1) * a[i]);\r\n\t\t\tfor (int k : S[ch[i][1]]) for (int q = 0; q < (int)f[ch[i][1]][k].size(); q++) tmp4[k] = std::min(tmp4[k], f[ch[i][1]][k][q] + 1LL * (q + 1) * a[i]);\r\n\t\t\tfor (int j : S[ch[i][0]])\r\n\t\t\t{\r\n\t\t\t\tlong long tmp = inf;\r\n\t\t\t\tfor (int q = 0; q < maxq; q++) tmp = std::min(tmp, tmp2[q] + 1LL * (q + 1) * a[j]);\r\n\t\t\t\tfor (int p = 0; p < (int)f[ch[i][0]][j].size(); p++) f[i][i][p + 1] = std::min(f[i][i][p + 1], f[ch[i][0]][j][p] + a[i] + tmp);\r\n\t\t\t}\r\n\t\t\tfor (int j : S[ch[i][0]])\r\n\t\t\t{\r\n\t\t\t\tlong long tmp = inf;\r\n\t\t\t\tfor (int p = 0; p < (int)f[ch[i][0]][j].size(); p++) tmp = std::min(tmp, f[ch[i][0]][j][p] + 1LL * (p + 1) * a[i]);\r\n\t\t\t\tfor (int q = 0; q < maxq; q++) f[i][j][q + 1] = std::min(f[i][j][q + 1], a[j] + tmp2[q] + tmp);\r\n\t\t\t}\r\n\t\t\tfor (int k : S[ch[i][1]])\r\n\t\t\t{\r\n\t\t\t\tlong long tmp = inf;\r\n\t\t\t\tfor (int p = 0; p < maxp; p++) tmp = std::min(tmp, tmp1[p] + 1LL * (p + 1) * a[k]);\r\n\t\t\t\tfor (int q = 0; q < (int)f[ch[i][1]][k].size(); q++) f[i][i][q + 1] = std::min(f[i][i][q + 1], f[ch[i][1]][k][q] + a[i] + tmp);\r\n\t\t\t}\r\n\t\t\tfor (int k : S[ch[i][1]])\r\n\t\t\t{\r\n\t\t\t\tlong long tmp = inf;\r\n\t\t\t\tfor (int q = 0; q < (int)f[ch[i][1]][k].size(); q++) tmp = std::min(tmp, f[ch[i][1]][k][q] + 1LL * (q + 1) * a[i]);\r\n\t\t\t\tfor (int p = 0; p < maxp; p++) f[i][k][p + 1] = std::min(f[i][k][p + 1], a[k] + tmp1[p] + tmp);\r\n\t\t\t}\r\n\t\t\tfor (int p = 0; p < maxp; p++) tmp1[p] = inf;\r\n\t\t\tfor (int q = 0; q < maxq; q++) tmp2[q] = inf;\r\n\t\t\tfor (int p = 0; p < maxp; p++) for (int k : S[ch[i][1]]) tmp1[p] = std::min(tmp1[p], tmp4[k] + 1LL * (p + 1) * a[k]);\r\n\t\t\tfor (int q = 0; q < maxq; q++) for (int j : S[ch[i][0]]) tmp2[q] = std::min(tmp2[q], tmp3[j] + 1LL * (q + 1) * a[j]);\r\n\t\t\tfor (int k : S[ch[i][1]]) for (int q = 0; q < (int)f[ch[i][1]][k].size(); q++) f[i][k][0] = std::min(f[i][k][0], tmp2[q] + f[ch[i][1]][k][q] + a[k]);\r\n\t\t\tfor (int j : S[ch[i][0]]) for (int p = 0; p < (int)f[ch[i][0]][j].size(); p++) f[i][j][0] = std::min(f[i][j][0], tmp1[p] + f[ch[i][0]][j][p] + a[j]);\r\n\t\t}\r\n\t}\r\n\tfor (int d = 0; d < (int)f[1][1].size(); d++) ans = std::min(ans, f[1][1][d] + 1LL * (d - 1) * a[1]);\r\n\treturn !printf(\"%lld\\n\", ans);\r\n}\r\n```",
        "postTime": 1661749536,
        "uid": 46197,
        "name": "_RSY_",
        "ccfLevel": 10,
        "title": "\u3010\u9898\u89e3\u3011P8294"
    },
    {
        "content": "\u663e\u7136\u505a\u8fd9\u9898\u662f waste of time\u3002\n\n\u9996\u5148\uff0c\u6709\u4e00\u4e2a dp \u65b9\u6cd5\u662f\uff0c\u8bbe\u91cc\u9762\u4ea4\u6362\u51fa\u6765\u7684\u662f $p$\uff0c\u5916\u9762\u4ea4\u6362\u8fdb\u53bb\u7684\u662f $q$\u3002\u9057\u61be\u7684\u662f\u72b6\u6001 $n^3$ \u4e2a\u3002\n\n\u8fd9\u4e2a dp \u8003\u573a\u4e0a\u90fd\u4e0d\u4f1a\uff0cintuition \u5e94\u8be5\u662f\u56e0\u4e3a\u5b50\u6811\u5185\u548c\u5916\u754c\u7684\u8054\u7cfb\u4ec5\u4ec5\u53ea\u4e0e\u201c\u5185\u5916\u4ea4\u6362\u201d\u8fd9\u4e00\u6b21\u6709\u5173\u3002\n\n\u8003\u8651\u5176\u5b9e dp \u72b6\u6001\u7684\u590d\u6742\u5ea6\u6765\u6e90\u4e8e q\uff0c\u6539\u6210\u5b9a\u4e49\u5916\u9762\u4ea4\u6362\u8fdb\u53bb\u7684**\u90a3\u4e2a**\u5bf9\u5185\u90e8\u8d21\u732e\u6709 $q$ \u7684\u8d21\u732e\u3002\n\n\u8bbe $f(x,p,q)$ \u8868\u793a\u5b50\u6811\u5185\u5f80\u5916\u6362\u51fa\u53bb\u7684\u662f $p$\uff0c\u5f80\u91cc\u6362\u8fdb\u6765\u7684\u7cfb\u6570\u5728\u5185\u90e8\u4ea4\u6362\u4e2d\uff08\u5305\u62ec\u6839\u548c\u7236\u4eb2\u7684\u4ea4\u6362\uff09\u8d21\u732e\u7cfb\u6570\u662f $q$\u3002\u6ce8\u610f $q$ \u4e0d\u8d85\u8fc7 $p$ \u53e6\u4e00\u8fb9\u513f\u5b50\u5927\u5c0f\uff0c\u6240\u4ee5\u72b6\u6001\u6570\u5bf9\u7684\u3002\n\n\u6765\u8f6c\u79fb\u3002\n\n- $x$ \u662f\u53f6\u5b50\uff0c$f(x,x,1)=a_x$\u3002\n\n- $x$ \u53ea\u6709\u5de6\u513f\u5b50 $y$\u3002\n\n  - \u7236\u8fb9 - \u513f\u5b50\u8fb9\u3002\u5916\u9762\u8fdb\u6765\u7684 $u$ \u6362\u4e00\u6b21\u4e4b\u540e\u6362\u8fdb\u513f\u5b50\u3002$f(y,w,q-1)+a_x\\to f(x,x,q)$\uff0c\u66b4\u529b\u8f6c\u79fb\u3002\n  - \u513f\u5b50\u8fb9 - \u7236\u8fb9\u3002$f(y,w,q)+qa_x+a_w\\to f(x,w,1)$\u3002\uff08\u8fd9\u79cd\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u8f6c\u79fb\uff09\n\n- $x$ \u6709\u4e24\u4e2a\u513f\u5b50 $y,z$\u3002\n\n  - \u7236\u8fb9 - \u5de6\u513f\u5b50 - \u53f3\u513f\u5b50\u3002$f(y,w,p-1)+f(z,v,q)+a_x+a_wq\\to f(x,x,p)$\u3002\n\n    \u9884\u5904\u7406 $g3(q)=\\min f(z,v,q)$\u3002\n    $$\n    f(y,w,p-1)+g3(q)+a_x+a_wq\\to f(x,x,p)\n    $$\n\n    \u679a\u4e3e $w,q$ \u9884\u5904\u7406 $g4(w)=\\min g3(q)+a_wq$\u3002\u8fd9\u90e8\u5206\u662f $O(ls\\times rs)$\u3002\n    $$\n    f(y,w,p-1)+g4(w)+a_x\\to f(x,x,p)\n    $$\n\n  - \u5de6\u513f\u5b50 - \u7236\u8fb9 - \u53f3\u513f\u5b50\u3002$f(y,w,p)+f(z,v,q-1)+pa_x+a_w\\to f(x,w,q)$\u3002\n\n    \u4e0e $p$ \u6709\u5173\u7684\u53ea\u6709 $a_xp$\u3002\u9884\u5904\u7406 $g1(w)=\\min f(y,w,p)+pa_x$\u3002\u9884\u5904\u7406 $g3(q)=\\min f(z,v,q)$\u3002\n    $$\n    g1(w)+a_w+g3(q-1)\\to f(x,w,q)\n    $$\n\n  - \u5de6\u513f\u5b50 - \u53f3\u513f\u5b50 - \u7236\u8fb9\u3002$f(y,w,p)+f(z,v,q)+a_xp+a_wq+a_v\\to f(x,v,1)$\u3002\n\n    \u4e0e $p$ \u6709\u5173\u7684\u53ea\u6709 $a_xp$\u3002\u9884\u5904\u7406 $g1(w)=\\min f(y,w,p)+a_xp$\u3002\n    $$\n    g1(w)+f(z,v,q)+a_wq+a_v\\to f(x,v,1)\n    $$\n    \u9884\u5904\u7406 $g2(q)=\\min g1(w)+a_wq$\u3002\u8fd9\u91cc\u590d\u6742\u5ea6\u662f $O([q]\\times [w])=O(ls\\times rs)$\u3002\n    $$\n    g2(q)+f(z,v,q)+a_v\\to f(x,v,1)\n    $$\n\n- \u6c42\u7b54\u6848\u3002\n\n  - \u53ea\u6709\u5de6\u513f\u5b50\u3002$f(y,w,q)+a_1q$\u3002\n\n  - \u90fd\u6709\u3002\u5de6\u513f\u5b50 - \u53f3\u513f\u5b50\uff1a$f(y,w,q)+g3(p)+a_wp+a_1q$\u3002\n\n    \u9884\u5904\u7406 $g4(w)=\\min g3(p)+a_wp$ \u5373\u53ef\u3002\n    \nhttps://uoj.ac/submission/576207",
        "postTime": 1660143614,
        "uid": 42156,
        "name": "feecle6418",
        "ccfLevel": 0,
        "title": "\u7701\u9009 D2T3 \u6700\u5927\u6743\u72ec\u7acb\u96c6\u95ee\u9898"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P8294)\u3002\n\n### \u6b63\u6587\n\n\u5176\u5b83\u4e24\u7bc7\u5df2\u7ecf\u8bb2\u7684\u5f88\u8be6\u7ec6\u4e86\uff0c\u672c\u7bc7\u9898\u89e3\u4e3b\u8bb2 `dp` \u7684\u8bbe\u8ba1\u72b6\u6001\u3002\n\n\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u7406\u89e3\u662f `dp[x][v][i]` \u8868\u793a $x$ \u5b50\u6811\u88ab\u6254\u5230\u5b50\u6811\u5916\u7684\u662f $v$ \u8fd9\u4e2a\u70b9\u7684\u503c\uff0c\u7136\u540e\u88ab\u6254\u8fdb\u6765\u7684\u6570\u5728\u5b50\u6811\u5185\u5bf9\u7b54\u6848\u8d21\u732e\u4e86 $i$\u3002\n\n\u6211\u4eec\u6ce8\u610f\u5230\u8fd9\u4e2a\u72b6\u6001\u662f $n^2$ \u7684\uff0c\u4f46\u7531\u4e8e\u662f\u4e8c\u53c9\u6811\uff0c\u6211\u4eec\u53ef\u4ee5 $3!$ \u9636\u4e58\u679a\u4e3e\u5b50\u6811\u6839\u8282\u70b9\u5468\u56f4\u7684\u8fb9\u65ad\u8fb9\u987a\u5e8f\u3002\n\n\u53ea\u8981\u628a\u9700\u8981\u5728\u8f6c\u79fb\u65f6\u7528\u7684\u6570\u636e\u9884\u5904\u7406\u51fa\u6765\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u4e2a\u4eba\u611f\u89c9\u8fd8\u662f\u5f88\u597d\u7406\u89e3\u7684\u3002",
        "postTime": 1654510475,
        "uid": 539747,
        "name": "\u67f3\u4e0b\u60e0",
        "ccfLevel": 0,
        "title": "P8294 [\u7701\u9009\u8054\u8003 2022] \u6700\u5927\u6743\u72ec\u7acb\u96c6\u95ee\u9898 \u9898\u89e3"
    }
]