[
    {
        "content": "# \u9898\u89e3 - $\\mathrm{P6297 }$ \u66ff\u6362\n\n[$$\\huge\\color{blue}\\boxed{\\color{Violet}\\mathfrak{There\\ is \\ my \\ blog}}$$](https://www.luogu.com.cn/blog/wyy2020/)\n\n### \u9898\u76ee\u610f\u601d\n* [P6297](https://www.luogu.com.cn/problem/P6297)\n* \u6c42\u4e00\u6bb5\u56de\u6587\u4e32$[l,r]$\u4f7f\u5f97$\\prod\\limits_{i=l}^r\\ a_i$ \u6700\u5927\n\n### $\\mathrm{Sol}$\n\n* \u524d\u7f6e\u77e5\u8bc6\uff1a**\u5bf9\u6570**\n* \u5bf9\u6570\u8f6c\u6362\u7684\u601d\u7ef4\u53ef\u4ee5\u770b\uff1a[\u53e6\u4e00\u9053\u9898](https://www.luogu.com.cn/problem/P3237)\n\n* \u4f17\u6240\u5468\u77e5$\\log(a\\times b)=\\log(a)+\\log(b)$\n* \u90a3\u4e48\u6211\u4eec\u4e0d\u76f4\u63a5\u5730\u8ba1\u7b97$\\prod\\limits_{i=l}^r\\ a_i$\u6765\u6bd4\u8f83\u5927\u5c0f\uff08\u6781\u9650\u60c5\u51b5\uff1a$1e9^{10^3}$\u663e\u7136\u5b58\u4e0d\u4e0b\u7684\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u901a\u8fc7\u6bd4\u8f83$\\sum\\limits_{i=l}^r \\log(a_i)$\u6765\u6bd4\u8f83\u5927\u5c0f\u8fd9\u6837\u5c31\u65b9\u4fbf\u591a\u4e86\u3002\n* \u540e\u6765\u5c31\u662f\u56de\u6587\u7684\u5224\u65ad\uff08\u6ce8\u610f\u5224\u65ad\u5947\u5076\u4e24\u79cd\u60c5\u51b5\uff09\n* \u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(3\\times n^2)$\n\n### $\\mathrm{Code}$\n\n```cpp\n#include <bits/stdc++.h>\n#define pb push_back\n#define int long long \nusing namespace std;\n\ninline int read()\n{\n\tint sum=0,ff=1; char ch=getchar();\n\twhile(!isdigit(ch))\n\t{\n\t\tif(ch=='-') ff=-1;\n\t\tch=getchar();\n\t}\n\twhile(isdigit(ch))\n\t\tsum=sum*10+(ch^48),ch=getchar();\n\treturn sum*ff;\n}\n\nconst int N=1005;\nconst int mod=1e9+7;\n\nint n,m,a[N],Log[N],ansx,ansy;\ndouble b[N];\n\nsigned main()\n{\n\tn=read();\n\tm=read();\n\tfor ( int i=1;i<=n;i++ ) \n\t{\n\t\ta[i]=read();\n\t\tb[i]=b[i-1]+log2(a[i]);//\u53d6\u5bf9\u6570\u505a\u524d\u7f00\u548c\n\t}\n\tdouble mx=0;\n\tfor ( int i=1;i<=n;i++ )\n\t{\n\t\tint l=i,r=i,gs=m;\n\t\tif(log2(a[l])>mx)\n\t\t{\n\t\t\tmx=log2(a[l]);\n\t\t\tansx=l,ansy=l;\n\t\t}\n\t\twhile(l>=1&&r<=n)//\u5bfb\u627e\u56de\u6587\n\t\t{\n\t\t\tl--,r++;\n\t\t\tif(a[l]!=a[r]) \n\t\t\t{\n\t\t\t\tif(gs>0) gs--;\n\t\t\t\telse break;\n\t\t\t}\n\t\t\tif(b[r]-b[l-1]>mx)\n\t\t\t{\n\t\t\t\tmx=b[r]-b[l-1];\n\t\t\t\tansx=l,ansy=r;//\u5bfb\u627e\u6700\u5927\u533a\u95f4\n\t\t\t}\n\t\t}\n\t}//\u5947\u6570\u957f\u5ea6\u56de\u6587\u4e32\u60c5\u51b5\n\tfor ( int i=1;i<=n;i++ )\n\t{\n\t\tint l=i-1,r=i,gs=m;\n\t\tif(a[l]!=a[i]) gs--;\n\t\tif(log2(a[l])+log2(a[i])>mx)\n\t\t{\n\t\t\tmx=log2(a[l])+log2(a[i]);\n\t\t\tansx=l;\n\t\t\tansy=i;\n\t\t}\n\t\twhile(l>=1&&r<=n)\n\t\t{\n\t\t\tl--,r++; \n\t\t\tif(a[l]!=a[r]) \n\t\t\t{\n\t\t\t\tif(gs>0) gs--;\n\t\t\t\telse break;\n\t\t\t}\n\t\t\tif(b[r]-b[l-1]>mx)\n\t\t\t{\n\t\t\t\tmx=b[r]-b[l-1];\n\t\t\t\tansx=l,ansy=r;\n\t\t\t}\n\t\t}\n\t}\n\tfor ( int i=1;i<=n;i++ )\n\t{\n\t\tint l=i,r=i+1,gs=m;\n\t\tif(a[r]!=a[i]) gs--;\n\t\tif(log2(a[r])+log2(a[i])>mx)\n\t\t{\n\t\t\tmx=log2(a[r])+log2(a[i]);\n\t\t\tansx=l;\n\t\t\tansy=i;\n\t\t}\n\t\twhile(l>=1&&r<=n)\n\t\t{\n\t\t\tl--,r++;\n\t\t\tif(a[l]!=a[r]) \n\t\t\t{\n\t\t\t\tif(gs>0) gs--;\n\t\t\t\telse break;\n\t\t\t}\n\t\t\tif(b[r]-b[l-1]>mx)\n\t\t\t{\n\t\t\t\tmx=b[r]-b[l-1];\n\t\t\t\tansx=l,ansy=r;\n\t\t\t}\n\t\t}\n\t}//\u5076\u6570\u957f\u5ea6\u56de\u6587\u4e32\u60c5\u51b5\n\tint ans=1;\n\tfor ( int i=ansx;i<=ansy;i++ ) ans=(ans*a[i]%mod+mod)%mod;\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1586139580,
        "uid": 308464,
        "name": "\u5947\u7c73",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6297 \u3010\u66ff\u6362\u3011"
    },
    {
        "content": "# Subtask 1:\n\n\u66b4\u529bDFS\u3002\u3002\u3002\n\n# Subtask 2:\n\n\u66b4\u529b\u679a\u4e3e\u6bcf\u4e2a\u533a\u95f4\u662f\u5426\u7b26\u5408\u4fee\u6539 $k$ \u6b21\u80fd\u591f\u6210\u56de\u6587\u5e8f\u5217\uff0c\u7136\u540e\u518d\u8fdb\u884c\u53d6\u6700\u5927\u503c\u5c31\u53ef\u4ee5\u4e86\u3002\u3002\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n^3)$\n\n# Subtask 3,4:\n\n\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u5411\u5916\u8fdb\u884c\u6269\u5c55\uff0c\u6bcf\u6269\u5c55\u4e00\u5c42\u5224\u65ad\u4e24\u4e2a\u6570\u662f\u5426\u76f8\u7b49\uff0c\u4e0d\u76f8\u7b49\u90a3\u4e48\u9700\u8981\u4fee\u6539\u7684\u6570\u7684\u4e2a\u6570\u5c31\u591a\u4e00\u4e2a\uff0c\u76f4\u5230\u6269\u5c55\u5230\u8fb9\u754c\u6216\u8005\u9700\u8981\u4fee\u6539\u7684\u6570\u7684\u4e2a\u6570\u5df2\u7ecf\u8fbe\u5230 $k$ \u4e2a\u4e86\u4f46\u662f\u6269\u5c55\u5230\u4e0b\u4e00\u5c42\u8fd8\u662f\u9700\u8981\u589e\u52a0\u9700\u8981\u4fee\u6539\u7684\u6570\u7684\u4e2a\u6570\u3002\u90a3\u4e48\u5c31\u505c\u6b62\u6269\u5c55\uff0c\u8ddf\u5df2\u77e5\u7684\u6700\u5927\u503c\u8fdb\u884c\u6bd4\u8f83\u66f4\u65b0\u6700\u5927\u503c\u3002\u7136\u540e\u53d6\u6a21\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n^2)$\n# Subtask 5:\n\n\u56e0\u4e3a $k=0$ \u6240\u4ee5\u5c31\u53d8\u6210\u4e86 manacher \u7b97\u6cd5\u4e86\uff0c\u76f4\u63a5\u5199\u4e0a\u518d\u7a0d\u5fae\u4fee\u6539\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\u3002\u3002\u3002\n\n\u56e0\u4e3a $(10^9+7)^{1000}$ \u4f1a\u4e25\u91cd\u7206\u70b8\uff0c\u6240\u4ee5\u4f60\u9700\u8981\u5199\u9ad8\u7cbe\u3002\u3002\u3002\uff08\u653e\u5fc3\uff0c\u6309\u7167 Subtask 3,4 \u7684\u601d\u8def\u6765\u5c31\u4e0d\u4f1a\u8d85\u65f6\u3002\u3002\u3002~~\u5f53\u7136\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u522b\u7684\u65b9\u6cd5~~\uff09\n\n~~\u795d\u5927\u5bb6\u5199\u9ad8\u7cbe\u6109\u5feb\u3002\u3002\u3002~~",
        "postTime": 1586159290,
        "uid": 80614,
        "name": "ZCPB",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6297 \u3010\u66ff\u6362\u3011"
    },
    {
        "content": "### Preface\n\n\u6bd4\u8f83\u7b80\u5355\u5957\u8def\u7684\u9898\u76ee\uff0c\u96be\u5ea6\u5927\u6982\u666e\u53ca\u7ec4 T2\u3002\u5927\u6982\u53ef\u4ee5\u8bc4\u9ec4\uff1f\n\n\u6ce8\u610f\u7ec6\u8282\u5c31\u597d\u4e86\uff0c\u522b\u8003\u573a\u5904\u5904\u9505\u3002\n\n### Description\n\n\u7ed9\u51fa $n$ \u4e2a\u6570\u548c $k$ \u6b21\u6539\u52a8\u6570\u5b57\u7684\u673a\u4f1a\uff0c\u627e\u5230\u4e00\u4e2a\u56de\u6587\u4e32\uff0c\u4f7f\u5f97\u56de\u6587\u4e32\u5185\u6240\u6709\u6570\u5b57\u7684\u79ef\u6700\u5927\u3002\u8f93\u51fa\u8fd9\u4e2a\u79ef\u5e76\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n### Solution\n\n\u8fd9\u91cc\u5c31\u4e0d\u8bb2\u90e8\u5206\u5206\u4e86\uff0c\u7b80\u5355\u9898\u76f4\u63a5\u4e0a\u6b63\u89e3\u3002\n\n\u679a\u4e3e\u56de\u6587\u4e32\u4e00\u4e2a\u5f88\u5957\u8def\u7684\u505a\u6cd5\uff0c\u5c31\u662f**\u679a\u4e3e\u56de\u6587\u4e2d\u5fc3\uff0c\u5e76\u5411\u4e24\u8fb9\u6269\u5c55**\uff0c\u76f4\u5230\u4e0d\u7b26\u5408\u56de\u6587\u6761\u4ef6\u505c\u6b62\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2)$\u3002\n\n\u7531\u4e8e\u6709 $k$ \u6b21\u6539\u52a8\u673a\u4f1a\uff0c\u679a\u4e3e\u7684\u65f6\u5019\u5141\u8bb8\u81f3\u591a $k$ \u6b21\u56de\u6587\u4e0d\u5339\u914d\u3002\n\n\u5f53\u7136\uff0c\u679a\u4e3e\u56de\u6587\u603b\u662f\u8981\u5206\u5947\u5076\u7684\u3002\n\n\u4f46\u662f\u8fd9\u91cc\u6709\u4e2a**\u5c0f\u6280\u5de7**\u3002\u501f\u9274 manacher \u7b97\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u539f\u6765\u7684\u6570\u5217\u4e2d\uff0c\u5728**\u6570\u5217\u9996\u548c\u4e24\u4e24\u4e4b\u95f4**\u63d2\u5165\u6570\u5b57 $1$\u3002\u56e0\u4e3a $1$ \u4e58\u4efb\u4f55\u6570\u4e0d\u53d8\uff0c\u6240\u4ee5\u4e0d\u5f71\u54cd\u7b54\u6848\uff0c\u800c\u4e14\u8fd8\u907f\u514d\u4e86\u5206\u5947\u5076\u679a\u4e3e\u7684\u7e41\u7410\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u66f4\u65b0\u7b54\u6848\u3002\u4e0d\u96be\u60f3\u5230\uff0c\u76f4\u63a5\u76f8\u4e58\u80af\u5b9a\u4e0d\u53ef\u884c\u3002\n\n\u5982\u679c\u6253\u9ad8\u7cbe\u5ea6\uff0c\u6211\u65e0\u8bdd\u53ef\u8bf4\u3002\u8981\u9ad8\u7cbe\u4e58\u9ad8\u7cbe\u53d6\u6a21\u6211\u662f\u4e0d\u4f1a\u9009\u8fd9\u79cd\u65b9\u6cd5\u7684\u3002\n\n\u628a\u79ef\u8f6c\u5316\u4e3a\u548c\u4e0d\u5c31\u65b9\u4fbf\u4e86\u5417\uff1f\u4e8e\u662f\u8054\u60f3\u5230\u4e86 $\\log_2(a\\times b)=\\log_2(a)+\\log_2(b)$\u3002\u4e0d\u77e5\u9053\u7684\u8bf7\u81ea\u884c\u767e\u5ea6\u6709\u5173\u5bf9\u6570\u7684\u8fd0\u7b97\u3002\u987a\u63d0\u4e00\u53e5\uff0c$\\log_2(1)=0$\uff0c\u4e4b\u524d\u63d2\u5165\u7684 $1$ \u4ece\u8fd9\u91cc\u770b\uff0c\u4e5f\u5bf9\u66f4\u65b0\u7b54\u6848\u6ca1\u6709\u5f71\u54cd\u3002\n\n\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u80fd\u7528\u548c\u8868\u793a\u79ef\u3002\u7528**\u524d\u7f00\u548c**\u9884\u5904\u7406\u53ef\u4ee5\u505a\u5230 $O(1)$ \u66f4\u65b0\u7b54\u6848\u3002\n\n\u539f\u6765\u7684\u79ef\u7ee7\u7eed\u5b58\uff0c\u8fb9\u4e58\u8fb9\u53d6\u6a21\uff0c\u53ef\u4ee5\u7684\u65f6\u5019\u5c31\u66f4\u65b0\u3002\n\n\u81f3\u6b64\uff0c\u4e00\u9053\u7b80\u5355\u9898\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u81f3\u4e8e $n\\le10^6,k=0$ \u7684 subtask\uff0c\u5c31\u662f\u88f8\u7684 manacher\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$\u3002\u56e0\u4e3a\u5f3a\u884c\u628a\u6a21\u677f\u4e8c\u5408\u4e00\u4e0a\u53bb\uff0c\u8d28\u91cf\u592a\u4f4e\u5c31\u88ab\u51fa\u9898\u4eba\u5220\u4e86\uff0c\u4e5f\u597d\u3002\n\n### Notice\n\n1. \u5728\u539f\u6570\u5217\u4e2d\u63d2\u5165 $1$ \u4ee5\u907f\u514d\u5206\u5947\u5076\u679a\u4e3e\u7684\u9ebb\u70e6\u3002\n\n1. `<cmath>`\u91cc\u6709`std::log2()`\uff0c\u76f4\u63a5\u7528\u3002\u524d\u7f00\u548c\u6570\u7ec4\u7528`double`\u3002\u4f46\u5b9e\u6d4b`long long`\u4e5f\u884c\uff0c\u5927\u6982\u662f\u56e0\u4e3a\u6570\u5f88\u5927\u6240\u4ee5\u4e0d\u4f1a\u51b2\u7a81\uff1f\uff08\u6216\u8bb8\u6570\u636e\u592a\u5f31\uff09\n\n1. \u5f00\u4e86 `pair`\uff0c\u4e00\u4e2a\u5b58\u50a8\u53d6\u6a21\u540e\u7684\u4e58\u79ef\uff0c\u53e6\u4e00\u4e2a\u5b58\u50a8\u5bf9\u6570\u7684\u533a\u95f4\u548c\u3002\u6ce8\u610f\u66f4\u65b0\u7684\u65f6\u5019\u53ef\u80fd\u9047\u5230 $\\log$ \u533a\u95f4\u548c\u76f8\u540c\u7684\u60c5\u51b5\uff0c\u8fd9\u65f6\u6bd4\u8f83\u53d6\u6a21\u540e\u7684\u4e58\u79ef\u3002\n\n1. \u6ce8\u610f\u679a\u4e3e\u56de\u6587\u4e32\u65f6\uff0c\u5de6\u53f3\u7aef\u70b9\u7684\u79fb\u52a8\u65f6\u673a\u3002\n\n1. \u4fdd\u9669\u8d77\u89c1\uff0c\u8fd8\u662f\u90fd\u5f00 `long long` \u5427\u3002\n\n### Code\n\n\u8fd9\u6837\u4e0b\u6765\uff0c\u6211\u7684\u597d\u50cf\u6bd4\u697c\u4e0b@[\u5947\u7c73](https://www.luogu.com.cn/user/308464) \u5927\u4f6c\u7684\u9898\u89e3\u4ee3\u7801\u77ed\u5f97\u591a\u2026\u2026\n\n\u5206\u5947\u5076\u679a\u4e3e\u7684\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u63d2\u5165 $1$\u3002\u6211\u4eec\u53ef\u4ee5\u5f00\u4e00\u4e2a\u81ea\u5b9a\u4e49\u51fd\u6570\u6765\u7b80\u5316\u5206\u5947\u5076\u7684\u4efb\u52a1\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cmath> \nusing namespace std;\n\ntypedef unsigned long long ll;\nconst ll MAXN=1e6+5;\nconst ll MOD=1e9+7;\nll n,k;\nll a[MAXN];\ndouble s[MAXN];//log2\u7684\u524d\u7f00\u548c\n#define pll pair<ll,ll>\n#define val first//\u53d6\u6a21\u540e\u7684\u4e58\u79ef\n#define logg second//log2\u7684\u533a\u95f4\u548c\u8868\u793a\u5b8c\u6574\u4e58\u79ef\npll ans;\n\nvoid update(ll l,ll r,const ll ctr)//\u679a\u4e3e\u4e00\u6b21\u56de\u6587\u4e32\n{\n\tll t=0;\n\tpll sum=pll{ctr,0LL};\n\twhile(1<=l && r<=n)\n\t{\n\t\tif(a[l]!=a[r])\tt++;\n\t\tif(t>k)\t\t\tbreak;\n\t\tsum.val=sum.val*a[l]%MOD*a[r]%MOD;\n\t\tsum.logg=s[r]-s[l-1];\n\t\tl--;r++;\n\t} \n\tif(sum.logg>ans.logg || (sum.logg==ans.logg && sum.val>ans.val))//\u6ce8\u610f\u8fd9\u91cc\n\t ans=sum;\n}\n\nint main()\n{\n    ios_base::sync_with_stdio(false);\n    cin>>n>>k;\n    for(ll i=1;i<=n;i++)\n     cin>>a[i];\n    for(ll i=1;i<=n;i++)\n     s[i]=s[i-1]+log2(a[i]);\n    for(ll i=1;i<=n;i++)\n    {\n    \tupdate(i-1,i+1,a[i]);//\u5947\u6570\u957f\u5ea6\n    \tupdate(i,i+1,1LL);//\u5076\u6570\u957f\u5ea6\n\t}\n\tcout<<ans.val<<endl;\n\treturn 0;\n}\n```\n\n\u4e0d\u5206\u5947\u5076\u7684\uff0c\u4e5f\u5c31\u662f\u63d2\u5165\u4e86 $1$ \u7684\u3002\u4ee3\u7801\u5927\u540c\u5c0f\u5f02\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cmath> \nusing namespace std;\n\ntypedef unsigned long long ll;\nconst ll MAXN=1e6+5;\nconst ll MOD=1e9+7;\nint n,k;\nll a[MAXN];\ndouble s[MAXN];\n#define pll pair<ll,ll>\n#define val first\n#define logg second\npll ans;\n\nint main()\n{\n    ios_base::sync_with_stdio(false);\n    cin>>n>>k;\n    int cnt=1;\n    a[cnt]=1LL;//\u6570\u5217\u9996\u63d2\u51651\n    for(int i=1;i<=n;i++)\n    {\n    \tll x;cin>>x;\n    \ta[++cnt]=x;a[++cnt]=1LL;//\u4e24\u4e24\u4e4b\u95f4\u63d2\u51651\u3002\u6700\u540e\u4e00\u4e2a\u867d\u7136\u4e5f\u63d2\u5165\u4e861\uff0c\u4f46\u662f\u5b9e\u9645\u679a\u4e3e\u5e76\u6ca1\u6709\u5f71\u54cd\n\t }\n    for(int i=1;i<=cnt;i++)//\u6ce8\u610f\u679a\u4e3e\u957f\u5ea6\u53d8\u6210cnt\u800c\u4e0d\u662fn\n     s[i]=s[i-1]+log2(a[i]);//\u9884\u5904\u7406\u524d\u7f00\u548c\n    for(int i=1;i<=cnt;i++)//\u6ce8\u610f\u679a\u4e3e\u957f\u5ea6\u53d8\u6210cnt\u800c\u4e0d\u662fn\n    {\t//\u4e0b\u9762\u90fd\u662f\u4e00\u6837\u7684\n    \tint t=0,l=i-1,r=i+1;\n\t\tpll sum=pll{a[i],0LL};\n\t\twhile(1<=l && r<=cnt)\n\t\t{\n\t\t\tif(a[l]!=a[r])\tt++;\n\t\t\tif(t>k)\t\t\tbreak;\n\t\t\tsum.val=sum.val*a[l]%MOD*a[r]%MOD;\n\t\t\tsum.logg=s[r]-s[l-1];\n\t\t\tl--;r++;\n\t\t}\n\t\tif(sum.logg>ans.logg || (sum.logg==ans.logg && sum.val>ans.val))\n\t\t ans=sum;\n\t}\n\tcout<<ans.val<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1586767298,
        "uid": 80049,
        "name": "Hexarhy",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6297 \u3010\u66ff\u6362\u3011"
    }
]