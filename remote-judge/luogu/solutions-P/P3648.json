[
    {
        "content": "\u9996\u5148\uff0c\u8fd9\u9898**\u7b54\u6848\u4e0e\u5207\u7684\u987a\u5e8f\u65e0\u5173**\n\n\u8bc1\u660e\u5f88\u597d\u8bc1\uff0c\u8003\u8651\u5c06\u4e00\u5757$abc$\u5206\u4e3a$a,b,c$\u4e09\u5757\n\n\u65b9\u6cd5\u4e00\uff1a\u5148\u5206\u6210$a,bc$\u3002\u7b54\u6848\u4e3a$a (b + c) + bc = ab + ac + bc$\n\n\u65b9\u6cd5\u4e8c\uff1a\u5148\u5206\u6210$ab,c$\u3002\u7b54\u6848\u4e3a$c (a + b) + ab = ab + ac + bc$\n\n\u7b54\u6848\u76f8\u540c\u3002\n\n\u7136\u540e\u8003\u8651$dp$\u65b9\u7a0b\uff1a\u82e5$s[x]=\\sum_{i=1}^x a[i]$\uff0c\u4ee4$f[i][j]$\u8868\u793a\u524d$i$\u4e2a\u6570\u5206$j$\u6b21\u7684\u6700\u5927\u5f97\u5206\n\n$f[i][j]=min_{0\\leq l<i}(f[l][j - 1] + s[l] * (s[i] - s[l]))$\n\n\u9700\u8981\u6eda\u52a8\u6570\u7ec4\u5b58\uff0c\u4ee5\u4e0b\u7528$f[i]$\u8868\u793a$f[i][j-1]$\uff08\u524d\u9a71\u72b6\u6001\uff09\n\n\u7136\u540e\u8003\u8651\u5f53$i$\u9009$j$\u8f6c\u79fb\u4f18\u4e8e$l$\u65f6\uff1a\uff08\u4ee5\u4e0b\u9ed8\u8ba4$j < l$\uff09\n\n$$f[j] + s[j]s[i] - s[j]^2 > f[l] + s[l]s[i] - s[l]^2$$\n\n$$f[j] - s[j]^2 - (f[l] - s[l]^2) > (s[l]- s[j])s[i]$$\n\n$$\\frac{f[j] - s[j]^2 - (f[l] - s[l]^2)}{- s[j] -(-s[l])} > s[i]$$\n\n\u628a\u6bcf\u4e2a\u70b9\u770b\u505a$P_i(-s[i],f[i]-s[i]^2)$\uff0c\u90a3\u4e48\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e00\u4e2a\u70b9\u96c6\uff0c\u659c\u7387\u9012\u589e\n\n\u8fd9\u4e9b\u70b9\u5f62\u6210\u4e86\u4e00\u4e2a\u5728\u7b2c\u4e09\u8c61\u9650\u7684\u4e0b\u51f8\u5305\n\n\u64cd\u4f5c\uff1a\n\n\u961f\u5934\u66f4\u65b0\uff1a\u82e5$slope(q[head], q[head + 1]) \\leq s[i]$\u5219\u51fa\u961f\uff08\u663e\u7136\uff09\n\n\u961f\u5c3e\u66f4\u65b0\uff1a\u82e5$slope(q[back - 1], q[back]) \\geq slope(q[back], i)$\u5219\u51fa\u961f\n\n**\u961f\u5c3e\u64cd\u4f5c\u7684\u8bc1\u660e**\uff08\u4e5f\u5c31\u662f**\u5bf9\u51f8\u5305\u7684\u8bc1\u660e**\uff09\uff1a\n\n\u8003\u8651$q[back]$\u53ef\u4e0d\u53ef\u80fd\u505a\u961f\u5934\u3002\u82e5\u6ee1\u8db3\u521a\u521a\u4e0a\u65b9\u7684\u6761\u4ef6\uff0c\u5219\uff1a\n\n\u82e5$slope(q[back],q[back-1]) \\leq s[i]$\u4f7f\u5f97$q[back]$\u6210\u4e86\u961f\u9996\n\n\u8fd9\u65f6\u5019\u5f53\u524d\u7684$slope$\u6bd4\u521a\u521a\u7684\u8fd8\u8981\u5c0f\uff0c\u56e0\u6b64\u5c06\u7ee7\u7eed\u51fa\u961f\uff0c$q[back]$\u65e0\u6cd5\u505a\u961f\u5934\u3002\n\n\u659c\u7387\u9012\u589e\uff0c\u6545\u662f\u4e00\u4e2a\u51f8\u5305\n\n\u8fd8\u6709\u4e00\u4e2a\u7ec6\u8282\uff1a\u6ce8\u610f\u53ef\u80fd\u4f1a\u51fa\u73b0$a[i]=0$\uff0c\u5bfc\u81f4\u5b58\u5728$s[i] = s[j]$\uff0c\u56e0\u6b64\u8ba1\u7b97\u659c\u7387\u5e94\u6ce8\u610f\u6a2a\u5750\u6807\u76f8\u540c\u7684\u60c5\u51b5\uff0c\u659c\u7387\u4e3a$-\\infty$.\n\n```cpp\n#include <algorithm>\n#include <cstring>\n#include <cstdio>\nusing namespace std;\n\ntypedef long long LL;\n\nconst int N = 1e5 + 10;\n\nint n, k, fa[205][N];\nLL s[N], f[N], g[N];\n\ndouble slope(int a, int b) {\n\tLL x1 = - s[a], y1 = g[a] - s[a] * s[a];\n\tLL x2 = - s[b], y2 = g[b] - s[b] * s[b];\n\tif(x1 == x2) return -1e18;\n\treturn (y2 - y1) / (double) (x2 - x1);\n}\n\nint main() {\n\tscanf(\"%d%d\", &n, &k);\n\tfor(int i = 1; i <= n; i ++) {\n\t\tscanf(\"%lld\", s + i);\n\t\ts[i] += s[i - 1];\n\t}\n\tstatic int q[N], hd, bk;\n\tfor(int t = 1; t <= k; t ++) {\n\t\tfor(int i = 1; i <= n; i ++) g[i] = f[i]; \n\t\thd = bk = 0;\n\t\tfor(int i = 1; i <= n; i ++) {\n\t\t\tfor(; bk - hd >= 2 && slope(q[hd], q[hd + 1]) <= s[i]; hd ++) ;\n\t\t\tf[i] = 0;\n\t\t\tif(hd < bk) {\n\t\t\t\tint & j = q[hd]; fa[t][i] = j;\n\t\t\t\tf[i] = g[j] + s[j] * (s[i] - s[j]);\n\t\t\t}\n\t\t\tfor(; bk - hd >= 2 && slope(q[bk - 1], q[bk - 2]) >= slope(i, q[bk - 1]); bk --) ;\n\t\t\tq[bk ++] = i;\n\t\t}\n\t}\n\tprintf(\"%lld\\n\", f[n]);\n\tfor(int x = fa[k][n]; k; x = fa[-- k][x])\n\t\tprintf(\"%d \", x);\n\treturn 0;\n}\n```\n\n> upd: \u611f\u8c22@chennengkuan \u6307\u51fa\u5b9a\u4e49\u7684\u5c0f\u9519\u8bef",
        "postTime": 1545907852,
        "uid": 20375,
        "name": "hongzy",
        "ccfLevel": 9,
        "title": "\u300cAPIO2014\u300d\u5e8f\u5217\u5206\u5272\u300c\u659c\u7387\u4f18\u5316\u300d"
    },
    {
        "content": "[$$\\Large\\texttt{My Blog}$$](https://hydingsy.github.io/articles/problem-APIO-2014-Split-the-Sequence/)\n\n---\n\n## Description\n\n> \u9898\u76ee\u94fe\u63a5\uff1a[Luogu 3648](https://www.luogu.org/problemnew/show/P3648)\n\n\u4f60\u6b63\u5728\u73a9\u4e00\u4e2a\u5173\u4e8e\u957f\u5ea6\u4e3a $n$ \u7684\u975e\u8d1f\u6574\u6570\u5e8f\u5217 $a_i$ \u7684\u6e38\u620f\u3002\u8fd9\u4e2a\u6e38\u620f\u4e2d\u4f60\u9700\u8981\u628a\u5e8f\u5217\u5206\u6210 $k+1$ \u4e2a\u975e\u7a7a\u7684\u5757\u3002\u4e3a\u4e86\u5f97\u5230 $k+1$ \u5757\uff0c\u4f60\u9700\u8981\u91cd\u590d\u4e0b\u9762\u7684\u64cd\u4f5c $k$ \u6b21\uff1a\n\n1. \u9009\u62e9\u4e00\u4e2a\u6709\u8d85\u8fc7\u4e00\u4e2a\u5143\u7d20\u7684\u5757\uff08\u521d\u59cb\u65f6\u4f60\u53ea\u6709\u4e00\u5757\uff0c\u5373\u6574\u4e2a\u5e8f\u5217\uff09\n2. \u9009\u62e9\u4e24\u4e2a\u76f8\u90bb\u5143\u7d20\u628a\u8fd9\u4e2a\u5757\u4ece\u4e2d\u95f4\u5206\u5f00\uff0c\u5f97\u5230\u4e24\u4e2a\u975e\u7a7a\u7684\u5757\u3002\n\n\u6bcf\u6b21\u64cd\u4f5c\u540e\u4f60\u5c06\u83b7\u5f97\u90a3\u4e24\u4e2a\u65b0\u4ea7\u751f\u7684\u5757\u7684\u5143\u7d20\u548c\u7684\u4e58\u79ef\u7684\u5206\u6570\u3002\u4f60\u60f3\u8981\u6700\u5927\u5316\u6700\u540e\u7684\u603b\u5f97\u5206\u3002\n\n\u6570\u636e\u8303\u56f4\uff1a$2\\le n\\le 10^5$\uff0c$1\\le k\\le \\min(n-1,200)$\uff0c$0\\le a_i\\le 10^4$\n\n------\n\n## Solution\n\n\u6211\u4eec\u9996\u5148\u8bc1\u660e**\u7b54\u6848\u548c\u5206\u5272\u987a\u5e8f\u65e0\u5173**\u3002\n\n\u5982\u679c\u6211\u4eec\u6709\u957f\u5ea6\u4e3a $3$ \u7684\u5e8f\u5217 $x,y,z$ \u5c06\u5176\u5206\u4e3a $3$ \u90e8\u5206\uff0c\u6709\u5982\u4e0b\u4e24\u79cd\u5206\u5272\u65b9\u6cd5\uff1a\n\n1. \u5148\u5728 $x$ \u540e\u9762\u5206\u5272\uff0c\u7b54\u6848\u4e3a $x(y+z)+yz$ \u5373\u4e3a $xy+yz+zx$\u3002\n2. \u5148\u5728 $y$ \u540e\u9762\u5206\u5272\uff0c\u7b54\u6848\u4e3a $(x+y)z+xy$ \u5373\u4e3a $xy+yz+zx$\u3002\n\n\u7136\u540e\u8fd9\u4e2a\u7ed3\u8bba\u53ef\u4ee5\u6269\u5c55\u5230\u4efb\u610f\u957f\u5ea6\u7684\u5e8f\u5217\uff08\u5206\u6790\u4e00\u4e0b\u8d21\u732e\uff09\uff0c\u8bc1\u660e\u5b8c\u6bd5 QAQ\n\n\u90a3\u4e48\u6211\u4eec\u5b9a\u4e49 $F_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u8fdb\u884c $j$ \u6b21\u5207\u5272\u7684\u6700\u5927\u5f97\u5206\u3002\u6211\u4eec\u8bb0 $a_i$ \u7684\u524d\u7f00\u548c\u4e3a $s_i$\uff0c\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a\n$$F_{i,k}=\\max\\{F_{j,k-1}+s_j(s_i-s_j)\\}\\quad (0\\le j<i)$$\n\u4e3a\u4e86\u65b9\u4fbf\u8868\u8ff0\uff0c\u6211\u4eec\u8bb0 $F_{i,k}$ \u4e3a $f_i$\uff0c$F_{j,k-1}$ \u4e3a $g_j$\uff0c\u76f8\u5f53\u4e8e\u628a $F$ \u7684\u7b2c\u4e8c\u7ef4\u6eda\u52a8\u6389\u4e86\u3002\n\n\u90a3\u4e48\u65b9\u7a0b\u4e3a\uff1a\n$$f_i=\\max\\{g_j+s_j(s_i-s_j)\\}\\quad (0\\le j<i)$$\n\u611f\u89c9\u662f\u4e00\u4e2a\u5f88\u663e\u7136\u7684\u53ef\u4ee5**\u659c\u7387\u4f18\u5316**\u7684\u5f0f\u5b50\uff01\n\n\u6211\u4eec\u4efb\u53d6 $j,k$ \u6ee1\u8db3 $0\\le k<j<i$ \u4e14 $j$ \u6bd4 $k$ **\u66f4\u4f18**\uff0c\u90a3\u4e48\u6709\u5982\u4e0b\u4e0d\u7b49\u5f0f\uff1a\n\n$$g_j+s_j(s_i-s_j)\\ge g_k+s_k(s_i-s_k)$$\n$$\\frac{(g_j-{s_j}^2)-(g_k-{s_k}^2)}{s_k-s_j}\\le s_i$$\n\n\u7ef4\u62a4\u4e00\u4e2a**\u4e0b\u51f8\u58f3**\u7136\u540e\u659c\u7387\u4f18\u5316\u5373\u53ef\u3002\n\n**\u6ce8\u610f**\uff1a\u672c\u9898\u4e2d $a_i$ \u662f**\u975e\u8d1f\u6574\u6570**\uff0c\u6240\u4ee5 $s_k-s_j$ \u53ef\u80fd\u7b49\u4e8e $0$\u3002\u8fd9\u79cd\u60c5\u51b5\u9700\u8981\u7279\u5224\uff0c$\\text{slope}$ \u9700\u8981\u8fd4\u56de $-\\text{INF}$\u3002\n\n**\u65f6\u95f4\u590d\u6742\u5ea6**\uff1a$O(nk)$\uff08\u8c8c\u4f3c\u8fd8\u53ef\u4ee5\u51f8\u4f18\u5316\uff1f\u5e26\u6743\u4e8c\u5206\uff1f\uff09\n\n------\n\n## Code\n\n```cpp\n#include <cstdio>\n#include <cstring>\n\nconst int N=1e5+5,M=205;\nint n,k,a[N],q[N],pre[N][M];\nlong long s[N],f[N],g[N];\n\ndouble slope(int i,int j) {\n\tif(s[i]==s[j]) return -1e18;\n\treturn 1.0*((g[i]-s[i]*s[i])-(g[j]-s[j]*s[j]))/(s[j]-s[i]);\n}\nint main() {\n\tscanf(\"%d%d\",&n,&k);\n\tfor(int i=1;i<=n;++i) scanf(\"%d\",&a[i]),s[i]=s[i-1]+a[i];\n\tfor(int j=1;j<=k;++j) {\n\t\tint l=1,r=0;\n\t\tq[++r]=0;\n\t\tfor(int i=1;i<=n;++i) {\n\t\t\twhile(l<r&&slope(q[l],q[l+1])<=s[i]) ++l;\n\t\t\tf[i]=g[q[l]]+s[q[l]]*(s[i]-s[q[l]]);\n\t\t\tpre[i][j]=q[l];\n\t\t\twhile(l<r&&slope(q[r-1],q[r])>=slope(q[r],i)) --r;\n\t\t\tq[++r]=i;\n\t\t}\n\t\tmemcpy(g,f,sizeof(f));\n\t}\n\tprintf(\"%lld\\n\",f[n]);\n\tfor(int x=n,i=k;i>=1;--i) x=pre[x][i],printf(\"%d%c\",x,\" \\n\"[i==1]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1549596228,
        "uid": 49725,
        "name": "Siyuan",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3648 \u3010[APIO2014]\u5e8f\u5217\u5206\u5272\u3011"
    },
    {
        "content": "\u5bf9\u4e8e\u4e00\u7c7b DP \u5f62\u5982 $f[i] = \\min_{L_i \\le j \\le R_i}(f[j] + sum(i, j))$\uff0c\u659c\u7387\u4f18\u5316\u53ef\u4ee5\u7ef4\u62a4 DP \u4e2d\u7684\u6700\u4f73\u7ee7\u627f\u3002\n\n\u8fd9\u9898\u4e5f\u8bb8\u662f\u4e00\u9053\u5f88\u597d\u7684\u659c\u7387\u4f18\u5316\u5165\u95e8\u9898\u3002\n\n### \u72b6\u6001\u7b80\u5316\n\n\u5207\u7684\u987a\u5e8f\u53ef\u4ee5\u81ea\u5b9a\uff0c\u4f3c\u4e4e\u72b6\u6001\u5f88\u590d\u6742\u3002\n\n\u5c3d\u53ef\u80fd\u7b80\u5316\u72b6\u6001\u3002\u770b\u770b\u6709\u6ca1\u6709\u8fd9\u6837\u4e00\u4e2a\u7ed3\u8bba\uff1a**\u5207\u7684\u4f4d\u7f6e\u53ef\u4ee5\u5b8c\u5168\u51b3\u5b9a\u83b7\u5f97\u7684\u5206\u6570**\uff08\u5373\u4e0e\u987a\u5e8f\u65e0\u5173\uff09\u3002\n\n\u600e\u4e48\u9a8c\u8bc1\uff1f\u4ece**\u6bcf\u4e2a\u5143\u7d20\u83b7\u5f97\u7684\u7cfb\u6570**\u6765\u8003\u8651\uff08\u5373\u201c\u6211\u5230\u5e95\u4e0e\u54ea\u4e9b\u6570\u5b57\u76f8\u4e58\u4e86\u201d\uff09\u3002\n\n___\n\n\u5047\u8bbe\u6253\u7b97\u8fd9\u6837\u5206\u5272\uff08\u5706\u5708\u5e8f\u53f7\u8868\u793a\u5206\u5272\u7684\u4f4d\u7f6e\uff09\uff1a\n\n8 7\u3000*\u2460*\u30006 3 **17**\u3000*\u2461*\u300020 14 15\u3000*\u2462*\u30000 2 3\n\n\u53ef\u4ee5\u8003\u8651\u6570\u5b57 17 \u4e0e\u8c01\u76f8\u4e58\uff1a\n\n* \u4e0d\u7ba1\u6309\u4ec0\u4e48\u987a\u5e8f\u5207\u5272\uff0c\u4e0e\u5757\u5185\u7684\u5143\u7d20\u4ece\u6765\u4e0d\u4f1a\u76f8\u4e58\u3002\n\n* \u90a3\u4e48\u548c\u53f3\u8fb9\u90a3\u4e2a 2 \u76f8\u4e58\u8fc7\u5417\uff1f\u5728**\u9996\u6b21\u548c 2 \u5206\u79bb**\u7684\u65f6\u5019\uff08\u4e0d\u7ba1\u5148\u5207 *\u2461* \u8fd8\u662f *\u2462*\uff09\u76f8\u4e58\u4e86\uff0c\u6b64\u540e**\u4e24\u8005\u65e0\u6cd5\u518d\u6b21\u201c\u5206\u79bb\u201d\uff0c\u4e00\u5b9a\u4e0d\u4f1a\u518d\u6b21\u76f8\u4e58\u3002**\n\n \u8ddf\u5176\u5b83**\u5757\u5916\u5143\u7d20**\u4e5f\u4e00\u6837\uff0c\u5206\u79bb\u80af\u5b9a\u8981\u5206\uff0c\u4f46\u53ea\u5206\u79bb\u4e00\u6b21\u3002\n\n___\n\n\u4e0d\u7ba1\u5207\u7684\u987a\u5e8f\u5982\u4f55\uff0c\u5bf9\u4e8e\u67d0\u4e2a\u5757\u5185\u7684\u5355\u4e2a\u5143\u7d20\uff0c\u5b83\uff1a\n\n* \u4e0e**\u5757\u5185\u7684\u5143\u7d20**\u80af\u5b9a\u4e0d\u4f1a\u76f8\u4e58\uff1b\n\n* \u4e0e**\u5176\u5b83\u5757\u5185\u7684\u4efb\u4f55\u4e00\u4e2a\u5143\u7d20**\u80af\u5b9a\u76f8\u4e58\u6070\u597d\u4e00\u6b21\u3002\n\n\u6240\u4ee5\uff0c**\u5207\u7684\u4f4d\u7f6e\u51b3\u5b9a\u83b7\u5f97\u7684\u5206\u6570\uff0c\u4ec0\u4e48\u987a\u5e8f\u90fd\u4e00\u6837**\u3002\n\n\u4e0b\u9762\u90fd\u662f\u72b6\u6001\u90fd\u662f**\u5047\u5b9a\u4ece\u524d\u5f80\u540e\u5206\u5272**\uff0c\u6bd4\u8f83\u65b9\u4fbf\u3002\n\n\u73b0\u5728\u751a\u81f3\u53ef\u4ee5\u7528 $dp[i][t]$ \u8868\u793a\u5728\u524d $i$ \u4e2a\u6570\u4e2d\u5207\u4e86 $t$ \u5200\uff08\u4e3a\u4e86\u65b9\u4fbf\u7ee7\u627f\uff0c\u5b9a\u6700\u540e\u4e00\u4e2a\u5207\u5272\u4f4d\u7f6e\u4e3a $i$\uff09\u80fd\u83b7\u5f97\u7684\u6700\u9ad8\u5206\u6570\u3002\u6bd4\u8f83\u76f4\u89c2\u7684\u7ee7\u627f\u65b9\u5f0f\u662f\u679a\u4e3e\u4e0a\u4e00\u4e2a\u5207\u5272\u4f4d\u7f6e\uff0c\u7136\u540e\u5207 $i$ \u83b7\u5f97\u6b64\u6b21\u5206\u6570\u3002\n\n```cpp\nfor (int i = 1; i <= n; ++i)\n  for (int t = 1; t <= k; ++t) {\n    // \u73b0\u5728\u6c42 dp[i][t]\n    \n    for (int j = 1; j <= i - 1; ++j) // \u9009\u62e9\u54ea\u4e2a\u4f4d\u7f6e\u4f5c\u4e3a\u201c\u4e0a\u4e00\u4e2a\u5206\u5272\u4f4d\u7f6e\u201d\uff1f\u8fd9\u662f\u51b3\u7b56\n      if (dp[j][t - 1] + // \u8be5\u5207\u5272\u4f4d\u7f6e\u7684\u5df2\u5f97\u5206\u6570\n         (sum[i] - sum[j]) * (sum[n] - sum[i]);// \u8fd9\u662f\u672c\u6b21\u5207\u5272\u7684\u5206\u6570\uff0c\u7528\u524d\u7f00\u548c\u5f88\u65b9\u4fbf\u5730\u8868\u793a\u51fa\u5de6\u53f3\u4e24\u5757\n  }\n```\n\n\u8fd9\u6837\u80fd\u6c42\u51fa\u7b54\u6848\uff0c\u4f46\u662f\u8d85\u65f6\u3002\u6211\u89c9\u5f97\u7ee7\u627f\u5927\u6982\u8981 $O(1)$\uff0c\u600e\u4e48\u7ef4\u62a4\u6700\u4f18\u51b3\u7b56\uff1f\n\n### \u659c\u7387\u4f18\u5316\n\n\u73b0\u5728\u773c\u524d\u6709\u4e24\u4e2a\u9009\u62e9\uff1a**\u7ee7\u627f $j1$** \u6216**\u7ee7\u627f $j2 (j1 < j2)$**\u3002\n\n\u5982\u679c $j1$ \u4f18\u4e8e $j2$\uff0c\u5373\uff1a\n\n$$ dp[j1] + (sum[i] - sum[j1]) * (sum[n] - sum[i]) > dp[j2] + (sum[i] - sum[j2]) * (sum[n] - sum[i]) $$\n\n*\u6682\u65f6\u7701\u7565 dp \u6570\u7ec4\u7684\u7b2c\u4e8c\u7ef4*\n\n\u79fb\u9879\uff1a\n\n$$ (sum[n] - sum[i]) * (sum[j2] - sum[j1]) > dp[j2] - dp[j1] $$\n\n\u518d\u79fb\u9879\uff0c\u540c\u65f6\u6ce8\u610f\u7b26\u53f7\uff0c$sum[j2] - sum[j1]$ \u80af\u5b9a\u975e\u8d1f\uff08\u53ef\u80fd\u4e3a $0$\uff0c\u9700\u53e6\u52a0\u8003\u8651\uff09\u3002\n\n$$ \\frac{dp[j2] - dp[j1]}{sum[j2] - sum[j1]} < sum[n] - sum[i] $$\n\n**\u5bf9\u4e8e $i$ \u6765\u8bf4**\uff0c$j1$ \u548c $j2$ \u53ea\u8981\u6ee1\u8db3\u8fd9\u4e2a\u4e0d\u7b49\u5f0f\u5c31\u8bf4\u660e\u51b3\u7b56 $j1$ \u4f18\u4e8e $j2$\u3002\n\n\u73b0\u5728\u65bd\u52a0\u53ef\u89c6\u5316\u9b54\u6cd5\u3002\u5728\u5750\u6807\u7cfb\u4e0a\uff0c\u4ee5 $sum[j]$ \u4e3a\u6a2a\u5750\u6807\uff0c$dp[j]$ \u4e3a\u7eb5\u5750\u6807\uff0c\u628a\u6bcf\u4e2a\u51b3\u7b56\u8868\u793a\u4e3a**\u70b9**\u3002\n\n![](https://mant.ink/Picture/Solution/APIO2014/01.png)\n\n*\u8fd9\u91cc\u6709 4 \u4e2a\u5907\u9009\u51b3\u7b56\u3002\u6ce8\u610f\uff0csum[] \u548c dp[] \u90fd\u662f\u5355\u8c03\u4e0d\u51cf\u7684\u3002*\n\n\u73b0\u5728\u4e0d\u7b49\u5f0f\u5de6\u8fb9\u53ef\u4ee5\u89c6\u4e3a **$j1$\u3001$j2$ \u8fde\u7ebf\u7684\u659c\u7387**\uff1b\u800c $j1$ \u4f18\u4e8e $j2$ \u7684**\u6761\u4ef6**\u662f\u659c\u7387\u8db3\u591f\u5c0f\uff08\u5c0f\u4e8e\u201c$i$ \u7684\u67d0\u4e2a\u5e38\u6570\u201d\uff09\u3002\n\n\u89c2\u5bdf\u3002$j2$ \u770b\u8d77\u6765\u50cf\u662f\u201c\u4e0b\u6c89\u70b9\u201d\uff0c\u5373\u5b83\u6709\u4e00\u4e2a\u7cdf\u7cd5\u7684\u7279\u5f81\uff1a\u659c\u7387 $k(j1, j2) < k(j2, j3)$\uff1b**\u5982\u679c $j2$ \u4f18\u4e8e $j3$\uff0c\u90a3\u4e48\u7531\u4e0a\u9762\u7684\u6761\u4ef6\u53ef\u77e5\uff0c$j1$ \u4e00\u5b9a\u4f18\u4e8e $j2$\uff0c\u6240\u4ee5\u5b83\u4e0d\u53ef\u80fd\u6210\u4e3a\u6700\u4f73\u51b3\u7b56\u3002** \u6211\u4eec\u5220\u6389\u4e0b\u6c89\u70b9 $j2$\uff0c\u7559\u4e0b\u7684\u70b9\u4e4b\u95f4\uff0c\u659c\u7387\u5355\u8c03\u9012\u51cf\u3002\n\n ![](https://mant.ink/Picture/Solution/APIO2014/02.png)\n\n* \u73b0\u5728\u5907\u9009\u51b3\u7b56\u4e4b\u95f4\uff0c\u76f8\u90bb\u70b9\u659c\u7387\u5355\u8c03\u9012\u51cf\u3002\u53ef\u80fd\u662f 7\u30006\u30004\u30003.5\u30001\u30000.9\u3002\n\n* \u518d\u56de\u987e\u4e00\u4e0b\u201c\u66f4\u4f18\u201d\u7684\u6761\u4ef6\uff1a**\u659c\u7387\u8db3\u591f\u5c0f**\u3002\n\n\u4e8c\u5206\u67e5\u627e\u5230\u7b2c\u4e00\u4e2a\u5c0f\u4e8e $sum[n] - sum[i]$ \u7684\u659c\u7387\u3002\u7531\u4e8e\u51b3\u7b56\u4e4b\u95f4\u7684\u659c\u7387\u662f\u9012\u51cf\u7684\uff0c\u4fdd\u8bc1**\u524d\u9762\u7684\u51b3\u7b56\u90fd\u6ca1\u5b83\u597d\uff0c\u5b83\u6bd4\u540e\u9762\u7684\u51b3\u7b56\u90fd\u597d**\u3002\n\n\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u4ee3\u66ff\u4e8c\u5206\u67e5\u627e\uff1a\n\n- \u6ce8\u610f\u5230 \u201c$i$ \u7684\u5e38\u6570\u201d\uff08\u5373 $sum[n] - sum[i]$\uff09 \u662f\u5355\u8c03\u9012\u51cf\u7684\u3002\n\n- \u8ba1\u7b97 $dp[i][t]$ \u7684\u6b65\u9aa4\uff1a\u5bf9 \u201c\u5df2\u5207 $t - 1$ \u5200\u201d\u5907\u9009\u51b3\u7b56\u961f\u5217\u8fdb\u884c\u7b5b\u9009\uff0c\u4ece\u524d\u5f80\u540e\u5220\u6389\u659c\u7387\u592a\u5927\u7684\uff0c\u76f4\u5230\u961f\u9996\u659c\u7387\u5c0f\u4e8e $sum[n] - sum[i]$\uff0c\u961f\u9996\u5c31\u662f\u5bf9\u4e8e $i$ \u6700\u4f18\u7684\u3002\n\n\t\u56e0\u4e3a\u968f\u7740 $i$ \u7684\u4e0a\u5347\uff0c\u7b5b\u9009\u53ea\u4f1a\u8d8a\u6765\u8d8a\u4e25\u683c\uff0c\u6240\u4ee5\u4e0d\u5fc5\u7ba1\u4e4b\u524d\u5c31\u88ab\u7b5b\u6389\u7684\u51b3\u7b56\uff0c\u4e8e\u662f\u5355\u8c03\u961f\u5217\u53ef\u4ee5\u7ef4\u62a4\u3002\n    \n- \u7b97\u51fa $dp[i][t]$ \u540e\uff0c\u66f4\u65b0 $t$ \u7684\u51b3\u7b56\u961f\u5217\uff0c\u4ece\u540e\u5f80\u524d\u5220\u6389\u4e0b\u6c89\u70b9\uff0c\u518d\u52a0\u5165 $dp[i][t]$\u3002\n\n\u6ce8\u610f\uff1a\n\n* \u5bf9\u4e8e\u7b2c\u4e8c\u7ef4\u7684\u6bcf\u4e2a $t$\uff08\u5df2\u5207\u7684\u5200\u6570\uff09\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u961f\u5217\u3002\n\n* \u7ee7\u627f\u4e86 $t - 1$ \u7684\u6700\u4f18\u7b56\u7565\u4ee5\u540e\uff0c\u66f4\u65b0 $t$ \u7684\u5907\u9009\u51b3\u7b56\u3002\n\n* \u5e8f\u5217\u5143\u7d20\u53ea\u662f\u975e\u8d1f\uff0c\u56e0\u6b64\u53ef\u80fd\u4f1a\u6709\u6a2a\u5750\u6807\u76f8\u540c\u7684\u70b9\u3002\u5904\u7406\u65b9\u6cd5\u53ef\u89c1\u4ee3\u7801\u3002\n\n* \u53ef\u4ee5\u76f4\u63a5\u8bb0\u5f55\u51b3\u7b56\u3002\n\n* \u6700\u540e\u5bfb\u627e\u7b54\u6848\uff0c\u9700\u8981\u770b\u770b\u6700\u540e\u4e00\u5200\u5207\u5728\u54ea\u91cc\u662f\u6700\u4f18\u7684\u3002\n   \n```cpp\n#include <cstdio>\n#include <cctype>\ntypedef long long LL;\n\nconst int N = 100010;\n\nint n, k, q[N][210], l[210], r[210], d[210], pre[N][210];\nLL a[N], sum[N], dp[N][210];\ninline double K(int t, int j1, int j2) {\n  if (sum[j1] == sum[j2])\n    return 1e18;// \u8d4b\u6781\u5927\u503c\uff0c\u5165\u961f\u65f6\u4f1a\u628a\u6a2a\u5750\u6807\u76f8\u540c\u7684\u70b9\u6392\u6324\u6389 \n  return (double)(dp[j2][t] - dp[j1][t]) /\n    (sum[j2] - sum[j1]);\n}\n\nint main() {\n  scanf(\"%d %d\", &n, &k);\n  for (int i = 1; i <= n; ++i)\n    scanf(\"%lld\", &a[i]), sum[i] = sum[i - 1] + a[i];\n  \n  for (int t = 0; t <= k; ++t)\n    q[l[t] = r[t] = 1][t] = 0; // \u8be5\u5c42\u7684\u5355\u8c03\u961f\u5217 \n  \n  for (int i = 1; i <= n; ++i) {\n    double k_top = sum[n] - sum[i]; // \u8003\u5b98\u7684\u8981\u6c42\n    \n    for (int t = k; t >= 1; --t) { // \u5012\u5e8f\u679a\u4e3e\u697c\u5c42\uff0c\u9632\u6b62\u81ea\u5df1\u201c\u9009\u62e9\u81ea\u5df1\u4f5c\u4e3a\u4e0a\u4e00\u4e2a\u5206\u5272\u70b9\u201d\u3002\u5176\u5b9e\u6b63\u5e8f\u4e5f\u4e0d\u4f1a\u9519\uff0c\u56e0\u4e3a\u8be5\u9009\u62e9\u592a\u5dee\n      \n      while (l[t - 1] <= r[t - 1] - 1) {\n        int j1 = q[l[t - 1]][t - 1], j2 = q[l[t - 1] + 1][t - 1];\n        double k = K(t - 1, j1, j2);\n        if (k > k_top)\n          ++l[t - 1];\n        else\n          break;\n      }\n      \n      int v = q[l[t - 1]][t - 1];// \u51b3\u7b56 \n      dp[i][t] = dp[v][t - 1] +\n        (sum[n] - sum[i]) * (sum[i] - sum[v]);\n      \n      pre[i][t] = v;\n      \n      // \u6dfb\u52a0\u65b0\u7684\u51b3\u7b56\uff08\u5165\u961f\uff09\uff0c\u6ce8\u610f\u7b2c\u4e8c\u7ef4\u4e0d\u540c\u4e86 \n      while (r[t] >= l[t] + 1) {\n        double k2 = K(t, q[r[t]][t], i),\n          k1 = K(t, q[r[t] - 1][t], q[r[t]][t]);\n        if (k1 < k2)\n          --r[t];\n        else\n          break;\n      }\n      q[++r[t]][t] = i;\n    }\n  }\n  \n\n  {\n    int t = k, i = 0; LL ans = 0;\n    for (int j = 1; j <= n; ++j) // \u679a\u4e3e\u6700\u540e\u4e00\u5200\n      if (dp[j][k] > ans)\n        ans = dp[j][k], i = j;\n    \n    printf(\"%lld\\n\", ans);\n    \n    while (t) {\n      d[t] = i;\n      i = pre[i][t--];\n    }\n    \n    for (int j = 1; j <= k; ++j)\n      printf(\"%d\", d[j]), putchar((j == k) ? ('\\n') : (' '));\n  }\n  return 0;\n}\n```",
        "postTime": 1548567251,
        "uid": 49474,
        "name": "\u5b66\u59d4",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3648 \u3010[APIO2014]\u5e8f\u5217\u5206\u5272\u3011"
    },
    {
        "content": "# Solution\n\n**\u5982\u679c\u4f60\u8fd8\u4e0d\u77e5\u9053\u659c\u7387\u4f18\u5316\uff0c\u5b89\u5229\u4e00\u7bc7\u4e0d\u9519\u7684[blog](http://blog.csdn.net/force_chl/article/details/79096609)(from chlience dalao)**\n\n\n\u9996\u5148\u5bf9\u4e8e\u4e00\u4e2a\u6570\u5217\uff0c\u82e5\u8981\u5c06\u5176\u5206\u4e3a\u4e09\u6bb5\uff0c\u603b\u548c\u5206\u522b\u662fa,b,c\u3002\u6709\u4e24\u79cd\u5206\u6cd5\uff1a\n\n$a(b+c)+bc=ab+ac+bc$\n\n$(a+b)c+ab=ab+ac+bc$\n\n\u7ecf\u8fc7\u63a8\u5e7f\uff0c\u53ef\u4ee5\u53d1\u73b0\u5207\u7684\u987a\u5e8f\u5bf9\u4e8e\u7ed3\u679c\u6ca1\u6709\u5f71\u54cd\u3002\n\n\u65e2\u7136\u5982\u6b64\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u65b9\u4fbf\u5730\u5b9a\u4e49\u72b6\u6001f[p][i]\u8868\u793a\u5728\u524d i \u4e4b\u4e2d\u5207 p \u5200\u7684\u7b54\u6848\uff0c\u5219\u6709\n\n$f[p][i]=\\max_{j<i}{(f[p-1][j]+sum[j]\\times(sum[i]-sum[j]))}$\n\n\u81f3\u4e8e\u5f53\u524d\u65b9\u6848\u7684\u8d21\u732e\u4e3a $sum[j] \\times (sum[i]-sum[j])$ \u7684\u539f\u56e0\uff0c\u56e0\u4e3a\u987a\u5e8f\u5bf9\u7b54\u6848\u4e0d\u5f71\u54cd\uff0c\u5bf9\u4e8e\u73b0\u5728dp\u5230i\u65f6\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u5728\u8fd8\u672a\u8fdb\u884cdp\u7684 [i+1,n] \u7684\u8303\u56f4\u662f\u5df2\u7ecf\u5207\u597d\u4e86\u7684\uff0c\u800c\u4e4b\u524ddp\u51fa\u7684\u6700\u4f18\u65b9\u6848\u662f\u4ee5\u540e\u624d\u5207\u7684\uff0c\u5373\u4ece\u540e\u5f80\u524d\u5207\u3002\u4e0d\u59a8\u5047\u4ee4 j \u4e3a\u8fd9 [1,i] \u4e2d\u7684\u7b2c\u4e00\u5200\uff0c\u90a3\u4e48\u8fd9\u4e00\u5200\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5373\u4e3a$sum[j]\\times(sum[i]-sum[j])$\u3002\n\n\u8fd9\u4e2a\u6734\u7d20DP\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n^2k)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a$O(nk)$\u3002\u7a7a\u95f4\u65f6\u95f4\u90fd\u70b8\u4e86\uff0c\u59a5\u59a5\u7684\u3002\n\n\n\u5bb9\u6613\u60f3\u5230\u6bcf\u4e00\u6b21\u7684\u72b6\u6001\u8f6c\u79fb\u53ea\u4e0e\u4e0a\u4e00\u6b21\u6709\u5173\uff0c\u90a3\u4e48\u7528\u6eda\u52a8\u6570\u7ec4\u538b\u6210\u4e24\u7ef4\u5373\u53ef\u3002\n\n\u5176\u6b21\uff0c\u65b9\u7a0b\u4e2d\u6709\u524d\u7f00\u548c\uff0c\u800c\u6570\u5217\u4e3a\u975e\u8d1f\u6574\u6570\uff0c\u90a3\u4e48\u524d\u7f00\u548c\u662f\u5355\u8c03\u9012\u589e\uff0c\u5bb9\u6613\u60f3\u5230\u659c\u7387\u4f18\u5316\u3002**\u4e3a\u4e86\u65b9\u4fbf\u8868\u8fbe\uff0c\u73b0\u5728\u7701\u53bb f \u6570\u7ec4\u7684\u7b2c\u4e00\u7ef4\uff0c\u5927\u5bb6\u53ef\u4ee5\u9ed8\u8ba4\u4e3a\u4e0b\u65b9\u516c\u5f0f\u4e2d\u7684 f \u6570\u7ec4\u6307\u4e0a\u4e00\u6b21dp\u7684\u72b6\u6001\uff0c\u5373 f[p-1]\u3002**\n\n\u4ee4\u73b0\u5728\u6709 j,k \u4e24\u4e2a\u4f4d\u7f6e\uff0c\u6ee1\u8db3j>k\uff0c\u6211\u4eec\u4e0d\u59a8\u5047\u8bbe\u9009\u62e9 k \u8981\u4f18\u4e8e\u9009\u62e9 j \u3002\n\n\u90a3\u4e48\u9700\u8981\u6ee1\u8db3\n\n$f[j]+sum[j]* (sum[i]-sum[j]) \\leq f[k]+sum[k] * (sum[i]-sum[k])$\n\n$\\Rightarrow sum[i] \\leq \\frac{f[k]-sum[k]^2-f[j]+sum[j]^2}{sum[j]-sum[k]}$\n\n\u7136\u540e\u7531\u6b64\u7b97\u659c\u7387\u4f18\u5316\u3002\u4f46\u662f\u6709\u4e00\u4e2a\u5751\u70b9\uff0c\u5c31\u662f\u6570\u5217\u4e3a\u975e\u8d1f\u6574\u6570\uff0c\u56e0\u6b64\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0$sum[j]-sum[k]=0$\uff0c\u800c\u9664\u4ee5\u4e00\u4e2a0\u5c31RE/WA\u4e86\uff01\u800c\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0c\u53ef\u4ee5\u77e5\u9053\u4e0d\u7ba1\u5728\u4e0d\u5728\u8fd9\u4e2a\u5730\u65b9\u5207\u5f00\u5bf9\u7b54\u6848\u5e94\u8be5\u6ca1\u6709\u5f71\u54cd\uff0c\u6240\u4ee5\u7279\u5224\u4e00\u4e0b\uff0creturn\u4e00\u4e2a\u6781\u5c0f/\u5927\u503c\u3002\n\n#Unsolved Problem\n\n\u672c\u849f\u84bb\u5e76\u6ca1\u6709\u60f3\u5230\u5982\u4f55\u5bf9\u8bb0\u5f55\u8def\u5f84\u7684to\u6570\u7ec4\u8fdb\u884c\u538b\u7ef4\uff0c\u5bf9\u4e8e\u7a7a\u95f4\u7684\u4f18\u5316\u4e0d\u5c3d\u5982\u4eba\u610f\u3002**\u5982\u679c\u6709dalao\u6709\u4ec0\u4e48\u597d\u65b9\u6cd5\u7684\u8bdd\u8bf7\u6307\u51fa\u554a** QAQ\n\n# Code\n```cpp\n#include <iostream>\n#include <cstdio>\nusing namespace std;\ntypedef long long ll;\nconst int maxn=100010;\nint n,k,x,r,h,t,to[210][maxn],q[maxn];\nll sum[maxn],f[2][maxn];\ninline ll pow(ll a){return a*a;}\ninline double slope(int j,int k)\n{\n    if(sum[j]==sum[k]) return -1e18;\n    return (f[r&1^1][k]-pow(sum[k])-f[r&1^1][j]+pow(sum[j]))*1.0/(sum[j]-sum[k]);\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&k);\n    for(int i=1;i<=n;i++)scanf(\"%d\",&x),sum[i]=sum[i-1]+x;\n    for(r=1;r<=k;r++)\n    {\n        h=t=0;\n        for(int i=1;i<=n;i++)\n        {\n            while(h<t&&slope(q[h],q[h+1])<=sum[i]) h++;\n            f[r&1][i]=f[r&1^1][q[h]]+sum[q[h]]*(sum[i]-sum[q[h]]);\n            to[r][i]=q[h];\n            while(h<t&&slope(q[t-1],q[t])>=slope(q[t],i)) t--;\n            q[++t]=i;\n        }\n    }\n    printf(\"%lld\\n\",f[k&1][n]);\n    for(int i=k,u=n;i>=1;i--)\n    {\n        u=to[i][u];\n        printf(\"%d \",u);\n    }\n    return 0;\n}\n```",
        "postTime": 1516364927,
        "uid": 20602,
        "name": "Rayment",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3648 \u3010[APIO2014]\u5e8f\u5217\u5206\u5272\u3011"
    },
    {
        "content": "### Solution\n#### \u7b97\u6cd5\n\u5bb9\u6613\u53d1\u73b0\u4ea7\u751f\u7684\u5f97\u5206\u53ea\u548c\u5207\u7684\u4f4d\u7f6e\u6709\u5173\u548c\u5207\u7684\u987a\u5e8f\u65e0\u5173.\n\n\u8bbe$f(i,j)$\u8868\u793a\u524d$i$\u4e2a\u6570\u5207$j$\u5200\u4ea7\u751f\u7684\u6700\u5927\u5f97\u5206,$s_i=\\sum_{i=1}^ia_i$(\u5373\u524d\u7f00\u548c).\n\u90a3\u4e48\u5207$j$\u5200\u53ef\u4ee5\u770b\u6210\u662f**\u7b2c\u4e00\u5200**\u5728\u7b2c$l$\u4e2a\u4f4d\u7f6e\u5207\u4e00\u5200, \u90a3\u4e48\u7b2c$l+1\\sim i$\u4e2a\u6570\u548c\u524d$l$\u4e2a\u6570\u4ea7\u751f\u4e86$(s_i-s_l)s_l$\u7684\u5f97\u5206, **\u7136\u540e\u518d\u5bf9\u524d$l$\u4e2a\u6570\u8fdb\u884c\u5212\u5206**, \u90a3\u4e48\u8fd9\u6837\u5207\u7684\u603b\u5f97\u5206\u5c31\u662f$f(l,j-1)+(s_i-s_l)s_l$.\n\n\u90a3\u4e48\u53ef\u4ee5\u5f97\u5230\u8f6c\u79fb\u65b9\u7a0b\n$$f(i,j)=\\max f(k,j-1)+(s_{i}-s_k)s_k$$\n\u82e5$$f(k)+s_{k}^2-s_is_k>f(l)+s_l^2-s_is_l$$\n$$(s_l-s_k)s_i>s_l^2-s_k^2+f(l)-f(k)$$\n$$s_i>\\frac{s_l^2-s_k^2+f(l)-f(k)}{s_l-s_k}$$\n\u53ef\u4ee5\u7528\u659c\u7387\u4f18\u5316\u8fdb\u884c\u4f18\u5316, \u4f18\u5316\u540edp\u7684\u590d\u6742\u5ea6\u4e3a$O(nk)$.\n\u63a8\u8350\u659c\u7387\u4f18\u5316\u4e00\u9053\u9898[\u73a9\u5177\u88c5\u7bb1](https://www.luogu.org/problemnew/show/P3195).\n#### \u5b9e\u73b0\n\u56e0\u4e3a\u5f00\u4e8c\u7ef4\u6570\u7ec4\u6240\u9700\u7a7a\u95f4\u8fc7\u5927, \u53c8\u56e0\u4e3a\u6bcf\u6b21\u90fd\u662f\u4ece$f(i,j-1)$\u8f6c\u79fb\u5230$f(k,j)$.\u6240\u4ee5\u53ef\u4ee5\u7528\u6eda\u52a8\u6570\u7ec4\u4f18\u5316.\n\n\u8fd9\u91cc\u6211\u5f00\u4e86\u4e24\u4e2a\u4e00\u7ef4\u6570\u7ec4$ff[],gg[]$,\u7136\u540e\u7528\u4e24\u4e2a\u6307\u9488$f=ff,g=gg$.\n\u8f6c\u79fb\u5b8c\u4e00\u7ef4\u65f6\u76f4\u63a5 **\u4ea4\u6362$f,g$** \u5373\u53ef.\u65e2\u65b9\u4fbf\u53c8\u597d\u7528.\n#### Code\n```c++\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#define N 100005\n#define int long long\nusing namespace std;\n\nint n,k;\nint q[N],h,t;\nint fa[N][205];\nint s[N],ff[N],gg[N];\nlong double pq(int b,int a,int *f){\n    if(s[a]==s[b])return -1e9;\n    return (s[b]*s[b]-s[a]*s[a]-f[b]+f[a])/(1.0*(s[b]-s[a]));\n}\nmain(){\n    int tr;\n    scanf(\"%lld%lld\",&n,&k);\n    for(int i=1;i<=n;++i){\n        scanf(\"%lld\",&tr);\n        s[i]=s[i-1]+tr;\n    }\n    int *f,*g;\n    f=ff,g=gg;\n    for(int j=1;j<=k;++j){\n        h=t=0;\n        for(int i=1;i<=n;++i){\n            while(h<t&&pq(q[h],q[h+1],g)<=s[i])++h;\n            f[i]=g[q[h]]+(s[i]-s[q[h]])*s[q[h]];\n            fa[i][j]=q[h];\n            while(h<t&&pq(q[t],i,g)<=pq(q[t-1],q[t],g))--t;\n            q[++t]=i;\n        }\n        swap(f,g);\n    }\n    printf(\"%lld\\n\",g[n]);\n    int q=fa[n][k],p=k;\n    while(p){\n        printf(\"%d \",q);\n        q=fa[q][--p];\n    }\n    return 0;\n}\n```",
        "postTime": 1530930904,
        "uid": 39067,
        "name": "aiyougege",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3648 \u3010[APIO2014]\u5e8f\u5217\u5206\u5272\u3011"
    },
    {
        "content": "## \u9898\u9762\u63cf\u8ff0\n[\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P3648)\n\n## \u601d\u8def\n## \u5bf9\u4e8e\u540c\u4e00\u79cd\u5206\u5272\u65b9\u5f0f\uff0c\u987a\u5e8f\u4e0d\u4f1a\u5f71\u54cd\u6700\u7ec8\u7ed3\u679c\u3002\n\u5206\u6790\u6837\u4f8b$(4,1,3,4,0,2,3)$\uff0c\n\n\u5982\u679c\u5148\u5207$5$,\u5219$(4+1+3+4+0)*(2+3)=60$\n\n\u518d\u5207$3$,\u5219$(4+1+3)*(4+0)=32$\n\n\u6700\u540e\u5207$1$,\u5219$4*(1+3)=16$\n\n\u7ed3\u679c$60+32+16=108$\n\n\u901a\u8fc7~~\u7384\u5b66\u7814\u7a76~~\u89c2\u5bdf\uff0c\u6211\u4eec\u53d1\u73b0\u6700\u540e\u5206\u6210\u5757\u7684\u5143\u7d20:\n\n1. \u4e00\u5b9a\u4e0d\u4f1a\u4e0e\u540c\u5757\u7684\u5143\u7d20**\u76f8\u4e58**\u5bf9\u7b54\u6848\u4ea7\u751f\u8d21\u732e\n(\u56e0\u4e3a\u53ea\u6709\u5206\u5757\u65f6\uff0c\u624d\u4f1a\u8fdb\u884c\u64cd\u4f5c\uff0c\u5bf9\u7b54\u6848\u4ea7\u751f\u8d21\u732e)\n3. \u4f1a\u4e0e\u5176\u4ed6\u5757\u7684**\u6240\u6709**\u5143\u7d20\u8fdb\u884c**\u76f8\u4e58\u4e14\u4ec5\u4e58\u4e00\u6b21**\uff0c\u5bf9\u7b54\u6848\u4ea7\u751f\u8d21\u732e\n\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5224\u65ad:\n\n\u5bf9\u4e8e\u540c\u4e00\u79cd\u5206\u5272\u65b9\u5f0f\uff0c\u987a\u5e8f\u4e0d\u4f1a\u5f71\u54cd\u6700\u7ec8\u7ed3\u679c.\n\n## \u56e0\u6b64\u4ec5\u6709\u5207\u7684\u4f4d\u7f6e\u4f1a\u5f71\u54cd\u7ed3\u679c\n\n\u6240\u4ee5\u8fd9\u662f\u6211\u4eec\u53ef\u4ee5\u63a8\u51fa\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n\n\u8bbe$s$\u4e3a$a$\u7684\u524d\u7f00\u548c\n\n$$F_{i,p+1}=\\max(F_{j,p}+s_j*(s_i-s_j))$$\n\n\u6b63\u597d\u7b26\u5408\n\n1. \u4e00\u5b9a\u4e0d\u4f1a\u4e0e\u540c\u5757\u7684\u5143\u7d20**\u76f8\u4e58**\u5bf9\u7b54\u6848\u4ea7\u751f\u8d21\u732e\n(\u56e0\u4e3a\u53ea\u6709\u5206\u5757\u65f6\uff0c\u624d\u4f1a\u8fdb\u884c\u64cd\u4f5c\uff0c\u5bf9\u7b54\u6848\u4ea7\u751f\u8d21\u732e)\n3. \u4f1a\u4e0e\u5176\u4ed6\u5757\u7684**\u6240\u6709**\u5143\u7d20\u8fdb\u884c**\u76f8\u4e58\u4e14\u4ec5\u4e58\u4e00\u6b21**\uff0c\u5bf9\u7b54\u6848\u4ea7\u751f\u8d21\u732e\n\n## \u51b3\u7b56\u5355\u8c03\u6027\n\n\u8bbe\n\n$$F_{k,p}+s_k*(s_i-s_k)\\ge F_{j,p}+s_j*(s_i-s_j)(j<k<i)$$\n\n\n\n\n\u5728\u672a\u6765\u72b6\u6001$t$\u4e0b\uff0c\n\n\u8bc1\u660e:\n\n$$F_{k,p}+s_k*(s_t-s_k)\\ge F_{j,p}+s_j*(s_t-s_j)$$\n\n \u7531\u4e8e$s_t=s_i+val$\uff0c\n \n$$F_{k,p}+s_k*(s_i+val-s_k)\\ge F_{j,p}+s_j*(s_i+val-s_j)$$\n\n\u53ea\u9700\u8bc1\u660e:\n\n$$s_k*val\\ge s_j*val$$\n\n\u7531\u4e8e$val>0,s_k\\ge s_j$\n\n\u8bc1\u6bd5\u3002\n\n\u6ce8\u610f\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5355\u8c03\u6027\uff0c\u6211\u4eec\u8981\u907f\u514d$s_k== s_j$\uff0c\u907f\u514d\u51fa\u9505\n\n## \u8e22\u961f\u5934\n$$F_{k,p}+s_k*(s_i-s_k)\\ge F_{j,p}+s_j*(s_i-s_j)(j<k<i)$$\n \n$$F_{k,p}+s_k*(s_i-s_k)\\ge F_{j,p}+s_j*(s_i-s_j)$$\n\n$$F_{j,p}-F_{k,p}-{s_j}^2+{s_k}^2\\le s_i*(s_k-s_j)$$\n\n\u7531\u4e8e$s_k-s_j>0$\uff0c\n\n$$calc(j,k)=\\frac{F_{j,p}-F_{k,p}-{s_j}^2+{s_k}^2}{s_k-s_j}\\le s_i$$\n\n\u5f53$calc(j,k)\\le s_i$\u65f6\uff0c$k$\u4f18\u4e8e$j$.\n\n\u56e0\u6b64\u5f53$$calc(q_{head},q_{head+1})\\le s_i$$\n\n$head+1$\u4f18\u4e8e$head$\u3002\n\n\u7531\u4e8e$s_i$\u968f$i$\u589e\u5927\u800c\u589e\u5927\uff0c\u90a3\u4e48$calc(q_{head},q_{head+1})$\u968f$head$\u589e\u5927\u800c\u589e\u5927\uff0c\u624d\u7b26\u5408$head$\u4e3a\u6700\u4f18\u89e3\uff0c\u56e0\u6b64\u659c\u7387\u662f\u4e0d\u65ad\u9012\u589e\u7684\uff0c\u8981\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u58f3\u3002\n\n## \u8e22\u961f\u5c3e\n\n\u6839\u636e\u659c\u7387\u662f\u4e0d\u65ad\u9012\u589e\u7684\uff0c\u4ec5\u5f53\n\n$$calc(q_{tail},i)\\ge calc(q_{tail-1},q_{tail})$$\n\n\u659c\u7387\u624d\u6ee1\u8db3\u4e0d\u65ad\u9012\u589e\u3002\n\n\u6545\u5f53\n\n$$calc(q_{tail},i)\\le calc(q_{tail-1},q_{tail})$$\n\n\u5220\u53bb\u961f\u5c3e\u3002\n\n## AC code\n```cpp\n#include<cstdio>\n#include<cstdlib>\n#include<algorithm>\n#include<cstdlib>\n#include<cmath>\n#include<cstring>\n#define ll long long \n#define gc getchar()\nusing namespace std;\nconst int N=1e5+10;\ninline void qr(ll &x)\n{\n\tx=0;int f=1;char c=gc;\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=gc;}\n\twhile(c>='0'&&c<='9'){x=x*10+(c^48);c=gc;}\n\tx*=f;\n}\ninline void qw(ll x)\n{\n\tif(x<0)x=-x,putchar('-');\n\tif(x/10)qw(x/10);\n\tputchar(x%10+48);\n}\nll f[N],g[N],s[N];\nint q[N],l,r,pre[N][210];\ninline double calc(int j,int k)\n{\n\tif(s[k]==s[j]) return -1e18;\n\treturn (double)(g[j]-g[k]-s[j]*s[j]+s[k]*s[k])/(s[k]-s[j]);\n}\nint main()\n{\n\tint n,k;scanf(\"%d%d\",&n,&k);\n\tfor(int i=1;i<=n;i++)\n\t{\t\n\t\tqr(s[i]);s[i]+=s[i-1];\n\t}\n\tint tot=0;\n\tfor(int i=1;i<=k;i++)\n\t{\n\t\tl=1;r=1;q[1]=0;memcpy(g,f,sizeof(g));\n\t\tfor(int j=1;j<=n;j++)\n\t\t{\n\t\t\twhile(l<r&&calc(q[l],q[l+1])<=(double)s[j])++l;\n\t\t\tf[j]=g[q[l]]+s[q[l]]*(s[j]-s[q[l]]);\n\t\t\tpre[j][i]=q[l];\n\t\t\twhile(l<r&&calc(j,q[r])<=calc(q[r-1],q[r]))--r;\n\t\t\tq[++r]=j;\n\t\t}\n\t}\n\tqw(f[n]);puts(\"\");\n\tint j=n,i=k;\n\twhile(pre[j][i])printf(\"%d \",pre[j][i]),j=pre[j][i],--i;\n\treturn 0;\n}\n```",
        "postTime": 1562047528,
        "uid": 106232,
        "name": "_Sein",
        "ccfLevel": 0,
        "title": "[APIO2014]\u5e8f\u5217\u5206\u5272"
    },
    {
        "content": "\u6211\u6000\u7591\u6211\u8822\u7206\u4e86\u3002\n\n\u4f30\u8ba1\u4e5f\u5c31\u53ea\u6709\u6211\u8fd9\u79cd\u849f\u84bb\u90fd\u5df2\u7ecf\u53d1\u73b0\u4e86\u659c\u7387\u4f18\u5316\u7684\u5f0f\u5b50\uff0c\u7136\u540eRE\u597d\u51e0\u904d\u624d\u53d1\u73b0\u5e94\u8be5\u7528\u6eda\u52a8\u6570\u7ec4\u3002\n\n\u4e8e\u662f\u5c31\u5f00\u59cb\u5207\u8fd9\u9053\u9898\u4e86\u3002\n\n\u9996\u5148\u662fdp\u5f0f\u3002\n\n\u8fd9\u9898\u7684dp\u5f0f\u5e94\u8be5\u8fd8\u662f\u6bd4\u8f83\u597d\u60f3\u5230\u7684\uff0c\u9996\u5148\u4f1a\u8f7b\u677e\u53d1\u73b0\u5207\u7684\u987a\u5e8f\u4e0e\u6700\u7ec8\u503c\u65e0\u5173\uff0c\u6240\u4ee5\u5f97\u51fa\u6700\u7ec8\u503c\u53ea\u4e0e\u5207\u7684\u4f4d\u7f6e\u6709\u5173\u3002\n\n\uff08\u7a0d\u5fae\u89e3\u91ca\u4e00\u4e0b\u4e3a\u4ec0\u4e48\u4e0e\u5207\u7684\u987a\u5e8f\u65e0\u5173\uff0c\u6bd4\u5982x1,x2,x3\u8fd9\u4e2a\u5e8f\u5217\uff0c\u53ea\u6709\u4e24\u79cd\u5207\u6cd5\uff0c\u7b2c\u4e00\u79cd\u662f(x1+x2)*x3+x1*x2,\u7b2c\u4e8c\u79cd\u662f(x2+x3)*x1+x2*x3\uff0c\u62c6\u6389\u540e\u5c31\u662f\u4e00\u6837\u7684\u3002\uff09\n\n\u65e2\u7136\u53ea\u6709\u5207\u7684\u4f4d\u7f6e\u6709\u5173\uff0c\u90a3\u4e48dp[i][j]\u4e5f\u5c31\u80fd\u8868\u793a\u6210\u524dj\u4e2a\u6570\u5207i\u5200\u6240\u5f97\u7684\u503c\u3002\u4e8e\u662fdp\u5f0f\u5c31\u8f7b\u800c\u6613\u53d6\u5730\u5f97\u51fa\u4e86\n\ndp[i][j]=max{dp[i-1][k]+sum[k]*(sum[j]-sum[k])}\n\n\u5176\u4e2dk<j\n\n\u9996\u5148\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u7a7a\u95f4\u4e0a\u663e\u7136\u80fd\u4f18\u5316\u3002\u7531\u4e8e\u7b2ci\u4e2a\u9636\u6bb5\u53ea\u4e0e\u7b2ci-1\u4e2a\u9636\u6bb5\u6709\u5173\uff0c\u6eda\u52a8\u6570\u7ec4\u8d70\u4e00\u6ce2\u5c31\u884c\u4e86\u3002\n\n\u7136\u540e\u4e00\u4ea4\u4ee3\u7801\uff0c\u5c31\u53d1\u73b0\u4e86\u8d85\u65f64\u4e2a\u70b9\u3002\u5728\u51a5\u601d\u82e6\u60f3\u65f6\uff0c\u7a81\u7136\u5c31\u60f3\u5230\u659c\u7387\u4f18\u5316\uff08\u4e3b\u8981\u662f\u770b\u5230j\u5e94\u8be5\u5728\u4e00\u7ec4\u72b6\u6001\u5e94\u8be5\u8981\u4fdd\u6301\u4e0d\u52a8\uff09\uff0c\u6309\u7167\u659c\u7387\u4f18\u5316\u7684\u6b63\u5e38\u5957\u8def\uff0c\u5047\u8bbek\u72b6\u6001\u6bd4k\u2019\u72b6\u6001\u66f4\u4f18\uff0c\u4e24\u5f0f\u4e00\u4f5c\u5dee\uff0c\u7136\u540e\u628a\u4e00\u6837\u7684sum[j]\u63d0\u51fa\u6765\uff0c\u5c31\u53d1\u73b0\u4e86\n\nsum[j]>=((sum[k]*sum[k]-dp[k])-(sum[k']*sum[k']-dp[k']))/(sum[k]-sum[k'])\n\n~~\u63a5\u4e0b\u6765\u5c31\u5f88\u8f7b\u677e\u5566\uff01\u961f\u5217\u7ef4\u62a4\u4e00\u4e0b\u659c\u7387\uff0c\u5c31\u8f7b\u677eAC\u4e86\u3002~~\uff08\u4e0d\u77e5\u9053\u659c\u7387\u4f18\u5316\u7684\u8bf7\u770bhttps://www.luogu.org/blog/league/solution-p3195\uff09\n\n\u5176\u5b9e\u8fd9\u9898\u8fd8\u6ca1\u5b8c\uff0c\u8fd9\u4e2a\u5c0f\u7ec6\u8282\u5361\u4e86\u6211\u534a\u5c0f\u65f6\uff1a\n\n\u5982\u679csum[k]=sum[k']\uff0c\u659c\u7387\u4e0d\u5c31\u6ca1\u6709\u4e86\u5417\uff1f\n\n\u6240\u4ee5\u5462\uff0c\n```\n#include<bits/stdc++.h>\nusing namespace std;\n#define res register LL\n#define LL long long\n#define inf 0x3f3f3f3f\ninline LL read(){\n    LL s=0,w=1;\n    char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9')s=s*10+ch-'0',ch=getchar();\n    return s*w;\n}\nconst LL K=300+10;\nconst LL N=1e5+10; \nLL dp[2][N],sum[N];\nLL way[K][N],q[N];\ninline double slope(LL x,LL y,LL l){\n\tif(sum[x]==sum[y])return -1e18;\n\treturn ((sum[x]*sum[x]-dp[l&1^1][x])-(sum[y]*sum[y]-dp[l&1^1][y]))/(1.0*(sum[x]-sum[y]));\n}\nint main(){ \n\tLL n=read(),k=read();\n\tfor(res i=1;i<=n;i++)\n\t\tsum[i]=sum[i-1]+read();\n\tfor(res i=1;i<=k;i++){\n\t\tLL head=0,tail=0;\n\t\tfor(res j=1;j<=n;j++){\n\t\twhile(head<tail&&slope(q[head],q[head+1],i)<=sum[j])head++;\n        LL t=q[head];\n        dp[i&1][j]=dp[i&1^1][q[head]]+sum[q[head]]*(sum[j]-sum[q[head]]);\n        way[i][j]=q[head];\n        while(head<tail&&slope(q[tail],j,i)<=slope(q[tail-1],q[tail],i))tail--;\n        q[++tail]=j;\n        }\n\t}\n    printf(\"%lld\\n\",dp[k&1][n]);\n    LL nn=n;\n    for(res i=k;i>=1;i--){\n    \tnn=way[i][nn];\n        printf(\"%lld \",nn);\n    }\n\treturn 0;\n}\n```",
        "postTime": 1526040820,
        "uid": 32878,
        "name": "foreverlasting",
        "ccfLevel": 7,
        "title": "\u3010APIO2014\u3011\u5e8f\u5217\u5206\u5272"
    },
    {
        "content": "/\\*\n50\u5206\u7684\u66b4\u529b: \u590d\u6742\u5ea6: O(kn^2)\n\n\u9996\u5148\u8981\u53d1\u73b0\u4e00\u4e2a\u6027\u8d28: \u53ea\u8981\u9009\u5b9a\u4e86\u5207\u7684\u4f4d\u7f6e,\u4e0d\u8bba\u4ec0\u4e48\u987a\u5e8f\u5207,\u7b54\u6848\u90fd\u662f\u4e00\u6837\n\n\u4f8b\u5982: \u628a\u5e8f\u5217\u5207\u4e24\u6b21,\u6bcf\u6bb5\u7684\u548c\u5206\u4e3a x1 x2 x3,\n\n\u5148\u57281,2\u95f4\u5207\u7684\u5f97\u5206: x1\\*(x2+x3)+x2\\*x3 = x1\\*x2+x1\\*x3+x2\\*x3\n\n\u5148\u57281,3\u95f4\u5207\u7684\u5f97\u5206: x3\\*(x1+x2)+x1\\*x2 = x1\\*x3+x1\\*x2+x1\\*x2\n\n\u6240\u4ee5\u5c31\u53ef\u4ee5\n\n\u7528dp(i,j) \u8868\u793a\u524dj\u4e2a\u6570\u5207i\u6b21\u7684\u603b\u5f97\u5206,sum\u662f\u524d\u7f00\u548c\n\ndp(i,j) = max(dp(i-1, k) + (sum(j)-sum(k))\\*sum(k));\n\nk\u662f\u679a\u4e3e<j\u7684\u533a\u95f4\u91cc\u7684\u4e00\u4e2a\u5207\u70b9\n\n\\*/\n    \n    \n```cpp\n#include<cstdio>\n#include<cstring>\n#include<cstdlib>\n#include<iostream>\nusing namespace std;\nconst int maxx=1e5+5;\n#define For(i,a,b) for(register int i=(a);i<=(b);++i)\n#define Rep(i,a,b) for(register int i=(a);i>=(b);--i)\n#define LL long long\nint read(){\n    char x=getchar(); int u=0;\n    while(!isdigit(x)) x=getchar();\n    while(isdigit(x)) u=(u<<3)+(u<<1)+(x^48), x=getchar();\n    return u;\n}\nLL sum[maxx],dp[201][maxx],to[201][maxx],n,k;\nint main(){\n#ifndef ONLINE_JUDGE\n    freopen(\"a.in\",\"r\",stdin);\n    freopen(\"a.out\",\"w\",stdout);\n#endif\n    n=read(); k=read();\n    For(i,1,n)\n        sum[i]=sum[i-1]+read();\n    For(i,1,n)\n        For(j,1,i-1)\n            For(p,1,k)\n                if(dp[p][i]<=dp[p-1][j]+sum[j]*(sum[i]-sum[j])){\n                    dp[p][i]=dp[p-1][j]+sum[j]*(sum[i]-sum[j]);\n                    to[p][i]=j;\n                }\n    printf(\"%lld\\n\",dp[k][n]);\n    int i=n;\n    Rep(j,k,1){\n        i=to[j][i];\n        printf(\"%d \",i);\n    }\n    return 0;\n}\n```\n/\\*\n100\u5206:\n\n\u572850\u5206\u7684\u66b4\u529b\u57fa\u7840\u4e0a,\u56e0\u4e3a\u539f\u5f0f\u5927\u6982\u4e3a\n\n     dp(i)=max(dp(k) + sum(i) \\* sum(k) - sum(k)^2);\n\n\u53ef\u4ee5\u659c\u7387\u4f18\u5316\n\n\u5047\u8bbe j<k \u5373\u53ef\u4ee5\u4ecek\u8f6c\u79fb\n\nsum(i) > [ sum(j)^2-sum(k)^2 + dp(k) - dp(j) ] / (sum(j) -sum(k);\n\n\u8f93\u51fa\u65b9\u6848\u65f6,\u53ea\u9700\u8981\u8bb0\u5f55\u6bcf\u6b21\u7531\u8c01\u8f6c\u79fb\n\n\u6d1b\u8c37\u4e0a\u53ea\u5f00\u4e86128M,uoj\u4e0a\u5f00\u4e86256M,\u6240\u4ee5\u6d1b\u8c37\u4e0a\u4f1aMLE\n\n\u5e78\u597ddp(i,j) =max(dp(i-1, k) +sum(...))\n\n\u6bcf\u6b21\u53ea\u7531\u4e0a\u4e00\u5c42\u8f6c\u79fb\u8fc7\u6765,\u6240\u4ee5\u53ef\u4ee5\u5f00\u6eda\u52a8\u6570\u7ec4\n\n\\*/\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<cstdlib>\n#include<iostream>\nusing namespace std;\nconst int maxx=1e5+1;\n#define For(i,a,b) for(register int i=(a);i<=(b);++i)\n#define Rep(i,a,b) for(register int i=(a);i>=(b);--i)\n#define LL long long\n#define sqr(x) ((x)*(x))\nint read(){\n    char x=getchar(); int u=0;\n    while(!isdigit(x)) x=getchar();\n    while(isdigit(x)) u=(u<<3)+(u<<1)+(x^48), x=getchar();\n    return u;\n}\nLL sum[maxx],dp[2][maxx],n,k,p;\nint to[201][maxx];\nint q[maxx],l,r;\nbool type=0;\ndouble slope(int x,int y){            // \u659c\u7387\n    if(sum[x]==sum[y]) return -1e18;\n    return (double)(sqr(sum[x]) - sqr(sum[y])-dp[type^1][x] + dp[type^1][y]) / (double) (sum[x]-sum[y]);\n}\nint main(){\n#ifndef ONLINE_JUDGE\n    freopen(\"a.in\",\"r\",stdin);\n    freopen(\"a.out\",\"w\",stdout);\n#endif\n    n=read(); k=read();\n    For(i,1,n)\n        sum[i]=sum[i-1]+read();\n    for(p=1; p<=k; ++p){\n        l=r=0; type^=1;\n        For(i,1,n){\n            while(l<r && slope(q[l],q[l+1]) <= sum[i]) ++l;\n            dp[type][i]=dp[type^1][q[l]]+sum[q[l]]*(sum[i]-sum[q[l]]);\n            to[p][i]=q[l];\n            while(l<r && slope(q[r-1],q[r]) >= slope(q[r],i)) --r;\n            q[++r]=i;\n        }\n    }\n    printf(\"%lld\\n\",dp[type][n]);\n    int i=n;\n    Rep(j,k,1){\n        i=to[j][i];\n        printf(\"%d \",i);\n    }\n    return 0;\n}\n```",
        "postTime": 1506518288,
        "uid": 19622,
        "name": "\u7f57\u65c5\u6d32",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3648 \u3010[APIO2014]\u5e8f\u5217\u5206\u5272\u3011"
    },
    {
        "content": "# \u5e8f\u5217\u5206\u5272\u9898\u89e3\n\u770b\u4e0a\u53bb\u662f\u533a\u95f4$DP$\u9898\uff0c\u5b9e\u5219\u4e0d\u7136\uff1a\n\n\u6bd5\u7adf\u533a\u95f4$DP$ $O(n^3)$\u7684\u590d\u6742\u5ea6\u96be\u4ee5\u4f18\u5316\uff0c\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u662f\u4e0d\u662f\u53ef\u4ee5\u60f3\u5230\uff0c\n\n\u6bcf\u4e00\u5757\u7684\u8d21\u732e\u662f\u5426\u4e0e\u5207\u5272\u987a\u5e8f\u65e0\u5173\uff1f\n\n\u8bc1\u660e\u4e00\u4e0b\uff1a\n\n\u5047\u8bbe\u533a\u95f4$[l_{1},r_{3}]$,\u88ab\u5206\u5272\u4e3a$[l_{1},r_{1}],[l_{2},r_{2}],[l_{3},r_{3}]$\uff0c\n\n\u6211\u4eec\u7b97\u4e00\u7b97$[l_{1},r_{1}]$\u7684\u8d21\u732e,\n\n\u5148\u5206\u5272$r_{1},l_{2}$\uff0c\u518d\u5206\u5272$r_{2},l_{3}$,\u53ea\u6709\u4e00\u6b21\u8d21\u732e,\n\u4e3a:\n$(sum[r_{1}]-sum[l_{1}-1])*(sum[r_{3}]-sum[r_{1}])$\n\n\u5148\u5206\u5272$r_{2},l_{3}$\uff0c\u518d\u5206\u5272$r_{1},l_{2}$,\u6709\u4e24\u6b21\u8d21\u732e,\u4e3a:$(sum[r_{1}]-sum[l_{1}-1])*[(sum[r_{3}]-sum[r_{2}])+(sum[r_{2}]-sum[r_{1}])]=(sum[r_{1}]-sum[l_{1}-1])*(sum[r_{3}]-sum[r_{1}])$\n\n\u4e5f\u53ef\u4ee5\u611f\u6027\u7406\u89e3\u4e00\u4e0b\uff0c\n\n\u6bcf\u79cd\u60c5\u51b5\u90fd\u53ef\u89c6\u4e3a\u5c06$[l,r]$\u540e\u9762\u7684$[r+1,n]$\u4ece\u53f3\u81f3\u5de6\u5206\u6210k\u6bb5,\n\n\u5176\u8d21\u732e\u4e3a:\n$(sum[r]-sum[l-1])*\\sum_{i=1}^{k}(sum[r_{i}]-sum[r_{i-1}])=(sum[r]-sum[l-1])*(sum[n]-sum[r])$\n\n\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u8d39\u7528\u524d\u79fb\u7b97\u51fa\u8d21\u732e\u4e86\u3002\n\n\u6240\u4ee5,\u66b4\u529b\u7ebf\u6027DP\u65b9\u7a0b\u4e3a\uff1a$f[i][j]=f[i-1][k]+(sum[j]-sum[k])*(sum[n]-sum[j])$\n\n\u62c6\u62ec\u53f7,\u79fb\u9879:\n$f[i-1][k]=sum[k]*(sum[n]-sum[j])+f[i][j]-(sum[n]-sum[j])*sum[j]$\n\n$\\bullet y=f[i-1][k]$\n\n$\\bullet k=sum[n]-sum[j]$\n\n$\\bullet x=sum[k]$\n\n$\\bullet b=f[i][j]-(sum[n]-sum[j])*sum[j]$\n\n\u7531\u4e8ek\u9012\u51cf\u4f46\u5927\u4e8e0,x\u9012\u589e,\u6c42\u6700\u5927\u503c,\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u8fd9\u6837\u7684\u51f8\u58f3\uff1a\n\n![\u89e3\u91ca](https://img2018.cnblogs.com/blog/1655789/201908/1655789-20190822192547390-21439279.png)\n\u63a5\u4e0b\u6765\u5c31\u662f\u659c\u7387\u4f18\u5316\u7684\u677f\u5b50\u4e86\u3002\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int N=100006,K=206;\nint o=1,n,k,head=1,tail=1,pre[K][N];\nll t,f[K][N],sum[N];\nstruct point{ll x,y; int p;}tmp,q[N];\nbool check(point u,point v,int z){return v.y-u.y>=(sum[n]-sum[z])*(v.x-u.x);}\nbool check2(point u,point v,point z){return (v.y-u.y)*(z.x-v.x)<=(z.y-v.y)*(v.x-u.x);}\ninline int read(){\n   int T=0,F=1; char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-') F=-1; ch=getchar();}\n   while(ch>='0'&&ch<='9') T=(T<<3)+(T<<1)+(ch-48),ch=getchar();\n   return F*T;\n}\nvoid dfs(int u,int v){\n     if(!u) return;\n     dfs(u-1,pre[u][v]);\n     if(v!=n) printf(\"%d \",v);\n}\nint main(){\n   n=read(),k=read(),++k;\n   for(int i=1;i<=n;++i) t=read(),sum[i]=sum[i-1]+t;\n   for(int j=1;j<=k;++j){\n       q[1].x=q[1].y=q[1].p=0,head=tail=1;\n       for(int i=1;i<=n;++i){\n           while(head<tail&&check(q[head],q[head+1],i)) ++head;\n           pre[j][i]=q[head].p,f[j][i]=q[head].y+(sum[n]-sum[i])*(sum[i]-q[head].x),tmp.x=sum[i],tmp.y=f[j-1][i],tmp.p=i;\n           while(head<tail&&check2(q[tail-1],q[tail],tmp)) --tail;\n           q[++tail]=tmp;\n      }\n   }\n   printf(\"%lld\\n\",f[k][n]);\n   dfs(k,n);\n   return 0;\n} \n```",
        "postTime": 1566645385,
        "uid": 44180,
        "name": "ljk123",
        "ccfLevel": 0,
        "title": "\u5e8f\u5217\u5206\u5272\u9898\u89e3"
    },
    {
        "content": "\n\u5176\u5b9e\u53ef\u4ee5\u53d1\u73b0\u6211\u4eec\u9009\u62e9\u5207\u7684\u987a\u5e8f\u53ef\u4ee5\u98a0\u6362\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8bbe$dp(i,j)$\u8868\u793a\u4e3a\u524d$i$\u4e2a\u5171\u5207$j$\u7684\u6700\u5927\u5f97\u5206\uff0c\u7136\u540e$dp(i,j)=max(dp(i-1,z)+s[z] \\times (s[i]-s[z])),s[i]=\\sum_{i=1}^i  a_i$\u3002\n\n\u7136\u540e\u53d1\u73b0\u8fd9\u662f\u4e2a\u659c\u7387\u4f18\u5316\u7684\u5f0f\u5b50\uff0c\u4f46\u662f\u659c\u7387\u53ea\u6709\u4e00\u9879\uff0c\u4e14\u4e3a-$dp(i,j)$\uff0c\u6240\u4ee5\u6211\u4eec\u867d\u7136\u662f\u8981\u53bb\u7ef4\u62a4\u4e0a\u51f8\u58f3\u4f46\u5176\u5b9e\u4e8b\u5b9e\u4e0a\u7ef4\u62a4\u4e0b\u51f8\u58f3\u3002\u7136\u540e\u5c31\u57fa\u672c\u659c\u7387\u4f18\u5316\u64cd\u4f5c\u4e86\u3002\n```\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#include<algorithm>\n#define int long long\nusing namespace std;\ninline int read(){\n    int f=1,ans=0;char c=getchar();\n    while(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n    while(c>='0'&&c<='9'){ans=ans*10+c-'0';c=getchar();}\n    return f*ans;\n}\nconst int N=100011;\nconst int K=211;\nint f[K][N],n,k,s[N],last[K][N],que[N],dp[N],g[N],X[N],Y[N];\nsigned main(){\n//    freopen(\"10.in\",\"r\",stdin);\n    n=read(),k=read();\n    for(int i=1;i<=n;i++) s[i]=s[i-1]+read();\n    for(int p=1;p<=k;p++){\n        int l,r;l=r=1;que[1]=0;\n        for(int i=1;i<=n;i++) g[i]=f[p-1][i];\n        Y[0]=s[0]*s[0]-g[0],X[0]=s[0];\n        for(int i=1;i<=n;i++){\n            while(l<r&&(Y[que[l+1]]-Y[que[l]])<=s[i]*(X[que[l+1]]-X[que[l]])) l++;\n            f[p][i]=f[p-1][que[l]]+s[que[l]]*(s[i]-s[que[l]]);\n            last[p][i]=que[l];\n            X[i]=s[i],Y[i]=s[i]*s[i]-g[i];\n            while(l<r&&(Y[que[r]]-Y[que[r-1]])*(X[i]-X[que[r]])>=(Y[i]-Y[que[r]])*(X[que[r]]-X[que[r-1]])) r--;\n            que[++r]=i;\n        }\n    }\n    int r=n;\n    printf(\"%lld\\n\",f[k][n]); \n    for(int i=k;i>=1;i--){\n        printf(\"%d \",last[i][r]);\n        r=last[i][r];\n    }\n}\n```",
        "postTime": 1546008163,
        "uid": 87382,
        "name": "_sry",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3648 \u3010[APIO2014]\u5e8f\u5217\u5206\u5272\u3011"
    },
    {
        "content": " [\u5b89\u5229\u4e00\u6ce2\u535a\u5ba2](https://www.cnblogs.com/cold-cold/p/10125401.html)\n\n\u6b64\u9898\u6211\u770b\u5230\u7b2c\u4e00\u773c\u7684\u60f3\u6cd5\u662f\n\n\u533a\u95f4DP\uff0c\u590d\u6742\u5ea6\u5927\u7ea6O(n^4)\n\n\u4f46\u662f\u6211\u5728\u63a8\u6837\u4f8b\u7684\u65f6\u5019\u53d1\u73b0\u4e86\u4e00\u4e2a\u91cd\u8981\u7684\u6027\u8d28\n\n\u6700\u540e\u7684\u7ed3\u679c\u53ea\u4e0e\u5207\u7684\u4f4d\u7f6e\u6709\u5173\u800c\u4e0e\u5207\u7684\u987a\u5e8f\u65e0\u5173\n\n\u5c06\u72b6\u6001\u8bbe\u8ba1\u4e3af[i][j]\u8868\u793a\u524di\u4e2a\u6570\uff0c\u5207j\u5200\uff0c\u7b2cj\u5200\u5207\u5728i\u5904\u6240\u6700\u5f97\u5230\u7684\u6700\u5927\u7684\u5206\n\n\n\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u63a8\u51faDP\u5f0f\u5b50\uff1a\n```cpp \nf[i][k+1]=f[j][k]+sum[j]*(sum[i]-sum[j]);\n```\n\n\u4f46\u8fd9\u6837\u7684\u590d\u6742\u5ea6\u4ecd\u7136\u4e0d\u5bf9\n\n\u770b\u5230\u5f0f\u5b50\u7684\u5f62\u72b6\uff0c\u6211\u4eec\u4f3c\u4e4e\u53ef\u4ee5\u91c7\u7528\u659c\u7387\u4f18\u5316\n\n```cpp\nf[j][k]-sum[j]*sum[j]=f[i][k+1]-sum[i]*sum[j];\n```\n\n\u8fd9\u91cc\u6211\u4eec\u8981\u6ce8\u610f\u4e24\u4e2a\u70b9\u5728\u540c\u4e00\u4e2a\u6a2a\u5750\u6807\u7684\u60c5\u51b5\n\n\u53e6\u5916\u6211\u4eec\u53ea\u7528\u5f00\u4e00\u4e2a\u961f\u5217Q\n\n\u56e0\u4e3a\u867d\u7136\u8f6c\u79fb\u5f97\u5230\u7684\u622a\u8ddd\u4e3ak+1\u7684\uff0c\u4f46\u662f\u70b9(x,y)\u90fd\u662fk\u7684\n\n\u5b9e\u73b0\u5982\u4e0b\uff1a\n\n```cpp\n#include <algorithm>\n#include <iostream>\n#include <cmath>\n#include <cstring>\n#include <map>\n#include <string>\n#include <vector>\n#include <queue>\n#include <stack>\n#include <cstdio>\n#include <cstdlib>\nusing namespace std;\ntypedef long long ll;\ninline ll read()\n{\n    register ll p(1),a(0);register char ch=getchar();\n    while((ch<'0'||ch>'9')&&ch!='-') ch=getchar();\n    if(ch=='-') p=-1,ch=getchar();\n    while(ch>='0'&&ch<='9') a=a*10+ch-48,ch=getchar();\n    return a*p;\n}\n//f[i][k]=f[j][k-1]+sum[j]*(sum[i]-sum[j]);\n//f[j][k-1]-sum[j]*sum[j]=f[i][k]-sum[i]*sum[j];\nconst ll N=100100,M=210,INF=0x3f3f3f3f;\nll n,kk,f[N][M],to[N][M],sum[N],Q[N],head=0,tail=0;\ninline long double getx(int x){return sum[x];}\ninline long double gety(int x,int now){return f[x][now]-sum[x]*sum[x];}\ninline long double che(int x,int y,int now)\n{return getx(y)==getx(x)?-INF:(gety(y,now)-gety(x,now))/(getx(x)-getx(y));}\ninline void pri(int xx,int yy){if(xx)pri(to[xx][yy],yy-1),printf(\"%lld \",xx);}\nint main()\n{\n    freopen(\"input\",\"r\",stdin);\n    freopen(\"output\",\"w\",stdout);\n    n=read(),kk=read();\n    for(register int i=1;i<=n;i++) sum[i]=sum[i-1]+read();\n    for(register int k=1;k<=kk;k++,head=tail=0)\n        for(register int i=1,j;i<=n;i++)\n            {\n                while(head<tail&&che(Q[head],Q[head+1],k)<=sum[i]) ++head;\n                j=Q[head];f[i][k+1]=f[j][k]+sum[j]*(sum[i]-sum[j]);\n                to[i][k+1]=j;\n                while(head<tail&&che(Q[tail-1],Q[tail],k)>=che(Q[tail],i,k)) --tail;\n                Q[++tail]=i;\n            }\n    printf(\"%lld\\n\",f[n][kk+1]);\n    pri(to[n][kk+1],kk);\n    return 0;\n}\n/*\n\n*/\n\n```",
        "postTime": 1544888996,
        "uid": 48934,
        "name": "cold_cold",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3648 \u3010[APIO2014]\u5e8f\u5217\u5206\u5272\u3011"
    },
    {
        "content": "\u53e6\u4e00\u79cd\u659c\u7387\u4f18\u5316(\u5f0f\u5b50\u4e0d\u592a\u4e00\u6837)\n\n\u663e\u7136\uff0c\u6211\u662f\u849f\u84bb\uff0c\u6240\u4ee5\u4e0d\u77e5\u9053\u600e\u4e48\u8bb0\u8d21\u732e\uff0c\u6240\u4ee5\u6211\u9009\u62e9\u6bcf\u4e00\u6b21**\u76f4\u63a5\u8bb0\u5f55\u7b54\u6848**\n\n\u5bf9\u4e8e\u6bcf\u4e00\u6b21\u4ecej\u8f6c\u79fb\u5230i\u589e\u52a0\u7684\u7b54\u6848\u4e3a $(sum[n] - sum[i])(sum[i] - sum[j])$\n\n\u8fd9\u5341\u5206\u7684\u76f4\u89c2(\u6309\u9898\u610f\u6a21\u62df),\u6240\u4ee5\u6211\u4e0d\u60f3\u89e3\u91ca\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u659c\u7387\u4f18\u5316\uff1a\n\n$-\\frac{dp[j]-dp[k]}{sump[j] - sump[k]}>=sum[i] - sum[n]$\n\n\u7531\u4e8e\u63a8\u5f0f\u5b50\u7684\u8fc7\u7a0b\u53ea\u7528\u5230\u4e86\u521d\u4e00\u6570\u5b66\uff0c\u6211\u4e5f\u4e0d\u518d\u8d58\u8ff0\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u5957\u8defDP\u4e86,\n\n\u7531\u4e8e\u849f\u84bb\u6211\u4e0d\u4f1a\u6eda\u52a8\u6570\u7ec4\u7b49\u9a9a\u64cd\u4f5c\uff0c\u4e8e\u662f\u5c31\u6709\u4e86\u4e00\u4e0b\u8fd9\u4e9b\u5f88\u70c2\u7684\u4ee3\u7801\uff0c\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\nlong long line[100005];\nlong long dp  [100005][205];\n\nint j;\n\nlong double Y(int now){ return dp[now][j];}\nlong double X(int now){ return line[now] ;}\nlong double K(int x,int y){ if(X(x) == X(y))return -1e18;return - ( Y(x) - Y(y) ) * 1.0 / ( X(x) - X(y) ) ;}\n\nint head[305];\nint tail[305];\nint Q  [305][100005];\nint pre[100005][305];\nint main(){\n\tint n,k;cin >> n >> k;\n\tfor(int i = 1;i <= n;i ++)cin >> line[i],line[i] += line[i - 1];\n\tfor(int i = 1;i <= n;i ++){\n\t\tfor(j = 0;j < k;j ++){\n\t\t\twhile( head[j] < tail[j] and K( Q[j][head[j]],Q[j][head[j] + 1]) <= line[i] - line[n] )head[j] ++;\n\t\t\tint ft = Q[j][head[j]];\n\t\t\tdp [i][j + 1] = dp[ft][j] + (line[n] - line[i])*(line[i] - line[ft]);\n\t\t\tpre[i][j + 1] = ft;\n\t\t\twhile( head[j] < tail[j] and K( Q[j][tail[j]-1],Q[j][tail[j]]) >= K( Q[j][tail[j]],i ) )tail[j] --;\n\t\t\tQ[j][++tail[j]] = i;\n\t\t}\n\t}\n\tlong long ans = 0,t = 0;\n\tfor(int i = 1;i <= n;i ++){if( dp[i][k] > ans )ans = dp[i][k],t = i; }\n\tcout << ans << \"\\n\";\n\tstack<int>A;\n\tfor(int i = k;i >= 1;i --){\n\t\tA.push(t);\n\t\tt = pre[t][i];\n\t}\n\twhile(!A.empty())cout << A.top() << \" \",A.pop();\n\treturn 0;\n}\n```\n\n###Tips:\n - \u8bb0\u5f97\u5f00long long\n - \u8bb0\u5f97\u5f00long double\n - ~~\u8bb0\u5f97\u5f00$O_2$~~\n",
        "postTime": 1527994669,
        "uid": 47240,
        "name": "bzy369258147",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3648 \u3010[APIO2014]\u5e8f\u5217\u5206\u5272\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u6bd5\u7adf\u7ed9\u4e86\u4f60\u4e00\u4e2a\u53cb\u5584\u7684\u6837\u4f8b\u3002\u3002\u3002\u3002\u3002\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u5212\u5206\u987a\u5e8f\uff0c\u5bf9\u4e8e\u6bcf\u4e2af[i],\u5c31\u662f\u6bcf\u6b21\u5148\u5c06\u5212\u53bb\u6700\u540e\u51e0\u4e2a\u6570\uff08\u8bbe\u5212\u5206\u70b9\u4e3ap\uff09\uff0c\u4ed6\u4eec\u4ea7\u751f\u7684\u8d21\u732e\u7b49\u4e8e(s[i]-s[p])*s[p],\u5c31\u53ef\u4ee5\u8f6c\u79fb\u5230\u4e0a\u4e00\u6b65\u7684j\u4e86\n\n\u5177\u4f53\u6765\u8bf4\uff0cf[i][k]=max(f[j][k-1]+(s[i]-s[j])*s[j])\n\n\u7b49\u7b49\uff0c\u8fd9\u91cc\u6709\u4e2ak\u600e\u4e48\u529e\u5440\u3002\u5b9a\u775b\u4e00\u770b\uff0ck\u53ea\u4e0ek-1\u6709\u5173\uff0c\u53ef\u4ee5\u7f29\u6389\u4e00\u7ef4\u3002\n\n\u518d\u5b9a\u775b\u4e00\u770b\uff0c\u8fd9\u9898k\u975e\u5e38\u5c0f\uff0c\u4e8e\u662f\u53ef\u4ee5\u66b4\u529b\u679a\u4e3ek\uff0c\u7136\u540e\u5c06\u4e0a\u4e00\u6b21\u7684f[i]\u8bb0\u4e3ag[i].\n\n\u7ecf\u8fc7\u4e00\u5806~~\u7e41\u7410~~\u7684\u5316\u7b80\u4e4b\u540e\uff0c\u67ff\u5b50\u53d8\u6210\u4e86\u8fd9\u4e2a\u4e1c\u897f\uff1af[i]-s[i]s[j]=g[j]-s[j]^2\n\n\u5c06f[i]\u5f53\u505a\u622a\u8ddd\uff0c\u6b32\u4f7f\u622a\u8ddd\u6700\u5927\uff0c\u90a3\u4e48\u659c\u7387\u9012\u51cf\uff0c\u7ef4\u62a4\u4e0a\u51f8\u58f3\uff0c\u5373\u5c06-s[i]\u5f53\u505a\u659c\u7387\n\n\u5b8c\u7ed3\u6492\u82b1!\uff08\u6ce8\u610f\u4e00\u4e0b\u659c\u7387\u4e0d\u5b58\u5728\u7684\u65f6\u5019\uff0cslope\u51fd\u6570\u8fd4\u56de-1e8\uff09\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=100001;\ntypedef long long ll;\nint n,k;\nll f[N],s[N],g[N];\ninline ll X(int u){\n\treturn s[u];\n}\ninline ll Y(int u){\n\treturn g[u]-s[u]*s[u];\n}\ninline double slope(int u,int v){\n\tif(s[u]==s[v])return -1e8;//attention!!!\n\treturn 1.0*((1.0*(Y(u)-Y(v)))/(1.0*(X(u)-X(v))));\n}\nint q[N],lst[N][201],a[N],cnt;\nint main(){\n\tregister int i;\n\tcin>>n>>k;\n\tfor(i=1;i<=n;++i)scanf(\"%lld\",&s[i]),s[i]+=s[i-1];\n\tfor(int tim=1;tim<=k;++tim){\n\t\tint h=1,t=1;\n\t\tmemset(q,0,sizeof(q));\n\t\tfor(i=1;i<=n;++i){\n\t\t\twhile(h<t&&slope(q[h],q[h+1])>=-s[i])h++;\n\t\t\tf[i]=g[q[h]]+s[q[h]]*(s[i]-s[q[h]]);\n\t\t\tlst[i][tim]=q[h];//\u8bb0\u5f55\u8def\u5f84\n\t\t\twhile(h<t&&slope(q[t],q[t-1])<=slope(q[t-1],i))t--;\n\t\t\tq[++t]=i;\n\t\t}\n\t\tfor(i=1;i<=n;++i)g[i]=f[i];\n\t}\n\tcout<<f[n]<<endl;\n\tint p=n;\n\twhile(p){\n\t\ta[++cnt]=p;\n\t\tp=lst[p][k];\n\t\tk--;\n\t}\n\tfor(i=cnt;i>=2;i--)printf(\"%d \",a[i]);\n\treturn 0;\n}\n```\n",
        "postTime": 1574855822,
        "uid": 127915,
        "name": "Bosun",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3648 \u3010[APIO2014]\u5e8f\u5217\u5206\u5272\u3011"
    },
    {
        "content": "[$myblog$](https://www.cnblogs.com/Isaunoya/p/11658409.html)\n\n\n\u6bd2\u7624\u9898\u2026\u2026\u5c11\u4e86\u4e00\u4e2a\u5224\u65ad\u68c0\u67e5\u4e86$40min$\n\n\u770b\u5230\u9898\u76ee \u9996\u5148\u6709\u4e2a $O(n^2k)$ \u7684 DP \u505a\u6cd5\n\n\u5c31\u662f\n\n\u8bbe $sum(x)$ = $\\sum_{i=1}^{x}a_i$ \n\n $f_{i,j}$=$max${$f_{i-1,k} + sum(k) * (sum(j) - sum(k))$}\n\n\u8fd9\u6837\u76f4\u63a5\u9884\u5904\u7406\u51fa$sum_x=\\sum_{i=1}^{x}$ \u5373\u524d\u7f00\u548c \u7136\u540e $O(n^2k)$ \u5c31\u53ef\u4ee5\u505a\u51fa\u6765\u4e86\n\n\u8003\u8651\u659c\u7387\u4f18\u5316\n\n\u5047\u8bbe $x$ \u4f18\u4e8e $y$\n\n\u90a3\u4e48 \n\n$f_{i-1,x}+sum_x*(sum_j-sum_x) > f_{i-1.y}+sum_y*(sum_j-sum_y)$\n\n\u5c55\u5f00\u5f97\u5230\n\n$f_{i-1,x}+sum_x*sum_j-sum_x^2 > f_{i-1,y} + sum_y*sum_j - sum_y^2$\n\n\u79fb\u9879\u5f97\u5230\n\n$(sum_x-sum_y)*sum_j > f_{i-1,y}-sum_y^2-f_{i-1,x}+sum_x^2$\n\n\u5316\u7b80\u5f97\u5230\n\n$sum_j > \\frac{f_{i-1,y}-sum_y^2-f_{i-1,x}+sum_x^2}{sum_x-sum_y}$\n\n\u8bbe $S(x)=sum_x^2-f_{i-1,x}$\n\n$sum_j>\\frac{S(x)-S(y)}{sum_x-sum_y}$\n\n\u6109\u5feb\u7684\u5f00\u59cb\u659c\u7387\u4f18\u5316\u2026\n\n\u4f46\u662f\u9700\u8981\u7279\u5224$sum_x==sum_y$\u7684\u60c5\u51b5\n\n```cpp\n// Isaunoya\n#include<bits/stdc++.h>\nusing namespace std ;\n#define int long long\n#define fi first\n#define se second\n#define pb push_back\ninline int read() {\n  register int x = 0 , f = 1 ;\n  register char c = getchar() ;\n  for( ; ! isdigit(c) ; c = getchar()) if(c == '-') f = -1 ;\n  for( ; isdigit(c) ; c = getchar()) x = (x << 1) + (x << 3) + (c & 15) ;\n  return x * f ;\n}\ntemplate < typename T > inline bool cmax(T & x , T y) {\n\treturn x < y ? (x = y) , 1 : 0 ;\n}\ntemplate < typename T > inline bool cmin(T & x , T y) {\n\treturn x > y ? (x = y) , 1 : 0 ;\n}\ninline int QP(int x , int y , int Mod){ int ans = 1 ;\n  for( ; y ; y >>= 1 , x = (x * x) % Mod)\n    if(y & 1) ans = (ans * x) % Mod ;\n  return ans ;\n}\n\nint n , k ;\nconst int N = 1e5 + 10 ;\nconst int M = 205 ;\nint sum[N] , pre[M][N] ;\nint q[N] ;\nint f[N] , g[N] ;\ninline int S(int x) {\n  return (sum[x] * sum[x] - g[x]) ;\n}\ninline double slope(int x , int y) {\n  if(sum[x] == sum[y]) return -1e18 ;\n  return 1.0 * (S(x) - S(y)) / (sum[x] - sum[y]) ;\n}\nsigned main() {\n  n = read() ; k = read() ;\n  for(register int i = 1 ; i <= n ; i ++) sum[i] = sum[i - 1] + read() ;\n  memset(f , 0 , sizeof(f)) ; memset(g , 0 , sizeof(g)) ;\n  for(register int i = 1 ; i <= k ; i ++) {\n    int h = 1 , t = 0 ;\n    q[++ t] = 0 ;\n    for(register int j = 1 ; j <= n ; j ++) {\n      while(h < t && slope(q[h] , q[h + 1]) <= sum[j]) ++ h ;\n      f[j] = g[q[h]] + sum[q[h]] * (sum[j] - sum[q[h]]) ;\n      pre[i][j] = q[h] ;\n      while(h < t && slope(q[t - 1] , q[t]) >= slope(q[t] , j)) -- t ;\n      q[++ t] = j ;\n    }\n    memcpy(g , f , sizeof(f)) ;\n  } printf(\"%lld\\n\" , f[n]) ;\n  for(register int i = n ; k ; -- k)\n    printf(\"%lld \" , i = pre[k][i]) ;\n\treturn 0 ;\n}\n\n```",
        "postTime": 1570842352,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3648 \u3010[APIO2014]\u5e8f\u5217\u5206\u5272\u3011"
    },
    {
        "content": "\u659c\u7387\u4f18\u5316\n\n\u53ef\u4ee5\u8bc1\u660e\u5f97\u5206\u4e0e\u5206\u5272\u987a\u5e8f\u65e0\u5173\uff08\u7136\u800c\u6211\u4e0d\u4f1a\uff09\n\n\u4ee4$s_i=\\sum_{j=1}^{i}a_j$\n\n\u5f97\u5230\u4e00\u4e2a\u5f88\u663e\u7136\u7684\u66b4\u529bdp\n\n$dp_{i,j}\u8868\u793a\u5230\u7b2ci\u4e2a\u6570\uff0c\u5206\u5272\u4e86j\u6b21$\n\n$dp_{i,j}=max(dp_{k,j-1}+s_k(s_i-s_k))$\n\n\u4e0a\u5957\u8def\n\n\u5b58\u5728\u4e24\u4e2a\u51b3\u7b56$x,y(x<y)$\uff0c\u82e5y\u66f4\u4f18\uff0c\u5fc5\u7136\u6ee1\u8db3\n\n$dp_{x,j-1}+s_x(s_i-s_x)<=dp_{y,j-1}+s_y(s_i-s_y)$\n\n\u6574\u7406\u5f97\n\n$\\frac{dp_{x,j-1}-s_x^2-dp_{y.j-1}+s_y^2}{s_y-s_x}<=s_i$\n\n\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u659c\u7387\u9012\u589e\u7684\u4e0b\u51f8\u58f3\u5373\u53ef\n\n\u7a7a\u95f4\u4e0a\u8fd8\u5b58\u5728\u7740\u4e00\u4e9b\u95ee\u9898\uff0c\u53d1\u73b0\u7b2c\u4e8c\u7ef4\u53ef\u4ee5\u6eda\u52a8\n\n\u81f3\u4e8e\u6253\u5370\u65b9\u6848\uff0c\u53ea\u80fd\u8bb0\u5f55\u4e00\u4e2a\u4e8c\u7ef4\u7684pre\u6570\u7ec4\u4e86\n\n\u6709\u4e00\u4e2a\u5751\u70b9\u5c31\u662f\u6b64\u9898\u7684$s_i$\u5e76\u4e0d\u662f\u9012\u589e\u7684\uff0c\u800c\u662f\u4e0d\u4e0b\u964d\u7684\uff0c\u6240\u4ee5\u53ef\u80fd\u51fa\u73b0\u5206\u6bcd\u4e3a0\u7684\u60c5\u51b5\uff0c\u6b64\u65f6\u8fd4\u56de-oo\n\nCode\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#define maxn 100010\n#define LL long long\nusing namespace std;\nint n, m, Pre[maxn][210], q[maxn];\nLL s[maxn], dp[maxn][2];\n\ninline int read(){\n\tint s = 0, w = 1;\n\tchar c = getchar();\n\tfor (; !isdigit(c); c = getchar()) if (c == '-') w = -1;\n\tfor (; isdigit(c); c = getchar()) s = (s << 1) + (s << 3) + (c ^ 48);\n\treturn s * w;\n}\n\ndouble slope(int opt, int x, int y){ return s[x] == s[y] ? -1e18 : 1.0 * (dp[x][opt] - s[x] * s[x] - dp[y][opt] + s[y] * s[y]) / (s[y] - s[x]); }\n\nint main(){\n\tn = read(), m = read();\n\tfor (int i = 1; i <= n; ++i) s[i] = read() + s[i - 1];\n\tfor (int j = 1; j <= m; ++j){\n\t\tint now = j & 1, pre = now ^ 1, h = 0, t = 0;\n\t\tfor (int i = 1; i <= n; ++i){\n\t\t\twhile (h < t && slope(pre, q[h], q[h + 1]) <= s[i]) ++h;\n\t\t\tdp[i][now] = dp[q[h]][pre] + s[q[h]] * (s[i] - s[q[h]]);\n\t\t\tPre[i][j] = q[h];\n\t\t\twhile (h < t && slope(pre, q[t - 1], q[t]) >= slope(pre, q[t], i)) --t;\n\t\t\tq[++t] = i;\n\t\t}\n\t}\n\tprintf(\"%lld\\n\", dp[n][m & 1]);\n\twhile (m) printf(\"%d \", Pre[n][m]), n = Pre[n][m], --m;\n\treturn 0;\n}\n```\n",
        "postTime": 1565411398,
        "uid": 51719,
        "name": "ModestCoder_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3648 \u3010[APIO2014]\u5e8f\u5217\u5206\u5272\u3011"
    },
    {
        "content": "[\u535a\u5ba2](http://39.106.169.220)\u98df\u7528\u6548\u679c\u66f4\u4f73\u3002\n#### \u9898\u76ee\u63cf\u8ff0\n\u4f60\u6b63\u5728\u73a9\u4e00\u4e2a\u5173\u4e8e\u957f\u5ea6\u4e3a $n$ \u7684\u975e\u8d1f\u6574\u6570\u5e8f\u5217\u7684\u6e38\u620f\u3002\u8fd9\u4e2a\u6e38\u620f\u4e2d\u4f60\u9700\u8981\u628a\u5e8f\u5217\u5206\u6210$k+1$ \u4e2a\u975e\u7a7a\u7684\u5757\u3002\u4e3a\u4e86\u5f97\u5230 $k + 1$ \u5757\uff0c\u4f60\u9700\u8981\u91cd\u590d\u4e0b\u9762\u7684\u64cd\u4f5c $k$ \u6b21\uff1a\n\u9009\u62e9\u4e00\u4e2a\u6709\u8d85\u8fc7\u4e00\u4e2a\u5143\u7d20\u7684\u5757\uff08\u521d\u59cb\u65f6\u4f60\u53ea\u6709\u4e00\u5757\uff0c\u5373\u6574\u4e2a\u5e8f\u5217\uff09\n\u9009\u62e9\u4e24\u4e2a\u76f8\u90bb\u5143\u7d20\u628a\u8fd9\u4e2a\u5757\u4ece\u4e2d\u95f4\u5206\u5f00\uff0c\u5f97\u5230\u4e24\u4e2a\u975e\u7a7a\u7684\u5757\u3002\n\u6bcf\u6b21\u64cd\u4f5c\u540e\u4f60\u5c06\u83b7\u5f97\u90a3\u4e24\u4e2a\u65b0\u4ea7\u751f\u7684\u5757\u7684\u5143\u7d20\u548c\u7684\u4e58\u79ef\u7684\u5206\u6570\u3002\u4f60\u60f3\u8981\u6700\u5927\u5316\u6700\u540e\u7684\u603b\u5f97\u5206\u3002\n\n#### \u89e3\u9898\u601d\u8def\n\u9996\u5148\u6211\u4eec\u8981\u53d1\u73b0\u7684\u4e00\u70b9\u5c31\u662f\u9009\u597d\u65ad\u70b9\u540e\uff0c\u65ad\u5f00\u7684\u987a\u5e8f\u662f\u4e0d\u5f71\u54cd\u7b54\u6848\u7684\u3002\n\u4e8e\u662f\u66b4\u529b\u8f6c\u79fb\u65b9\u7a0b\u6bd4\u8f83\u7b80\u5355\uff1a\n`dp[i][k]=min{dp[j][k-1]+sum[j]*(sum[i]-sum[j])}`\n\u5199\u4e0b\u8f6c\u79fb\u65b9\u7a0b\u5c31\u4f1a\u53d1\u73b0\u8fd9\u662f\u4e00\u9053\u6bd4\u8f83\u6a21\u677f\u7684\u659c\u7387\u4f18\u5316\u3002\n\n#### AC\u4ee3\u7801\n```cpp\n#include<algorithm>\n#include<iostream>\n#include<cstring>\n#include<cstdio>\n#include<cctype>\nusing namespace std;\n#define int long long\ntypedef long long llt;\n\nconst int N=2e5+10;\nint n,k,head,tail,a[N],Q[N],pre[N][300];\nllt s[N],f[N],g[N];\n\ninline void read(int&x){\n\tint k=1;x=0;char c=getchar();\n\twhile(!isdigit(c)) if(c=='-')c=getchar(),k=-1;else c=getchar();\n\twhile(isdigit(c)) x=(x<<3)+(x<<1)+(c^48),c=getchar();x*=k;\n}\ninline long double Slope(int a,int b){\n\tif(s[a]==s[b]) return -1e18;\n\treturn 1.0*((g[a]-s[a]*s[a])-(g[b]-s[b]*s[b]))/(s[b]-s[a]);\n}\nsigned main(){\n\tread(n),read(k);\n\tfor(int i=1;i<=n;++i) read(a[i]),s[i]=s[i-1]+a[i];\n\tfor(int j=1;j<=k;++j){\n\t\thead=1,tail=1,Q[1]=0;\n\t\tfor(int i=1;i<=n;++i){\n\t\t\twhile(head<tail&&Slope(Q[head],Q[head+1])<=s[i]) ++head;\n\t\t\tf[i]=g[Q[head]]+s[Q[head]]*(s[i]-s[Q[head]]);\n\t\t\twhile(head<tail&&Slope(Q[tail-1],Q[tail])>=Slope(Q[tail],i)) --tail;\n\t\t\tpre[i][j]=Q[head],Q[++tail]=i;\n\t\t}\n\t\tmemcpy(g,f,sizeof(f));\n\t}\n\tprintf(\"%lld\\n\",f[n]);\n\tfor(int x=n,i=k;i>=1;--i) \n\t\tx=pre[x][i],printf(\"%d \",x);\n\treturn 0;\n}\n```",
        "postTime": 1553848940,
        "uid": 26512,
        "name": "Christopher_Yan",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3648 \u3010[APIO2014]\u5e8f\u5217\u5206\u5272\u3011"
    },
    {
        "content": " [$$ \\Large \\texttt{My Blog} $$](http://blog.flyinthesky.win/bzoj3675/)\n\n------------\n\n\n\n\u5f15\u7406\uff1a\n> \u6700\u7ec8\u7b54\u6848\u548c\u5206\u5272\u987a\u5e8f\u65e0\u5173\u3002\n\n\u8bc1\u660e\uff1a\u82e5\u5206\u4e86$3$\u5757\uff0c\u8bbe\u4e3a$a_1,a_2,a_3$\n\n\u5219\n$$a_1 a_2 + (a_1+a_2)a_3 = a_2 a_3 + (a_2 + a_3)a_1$$\n\u6240\u4ee5\u4e24\u8005\u7b49\u4ef7\uff0c\u5e76\u4e14\u5bb9\u6613\u6269\u5c55\u5230\u66f4\u591a\u5757\u7684\u60c5\u51b5\u3002\u5e76\u4e14\u7b54\u6848\u662f$a$\u4e24\u4e24\u76f8\u4e58\u7684\u548c(\u6216\u8005\u662f$a_1 + (a_1+a_2)a_3 + (a_1+a_2+a_3)a_4 +\\dots + (a_1+a_2+ \\dots + a_{k-1})a_k$)\n\n\u90a3\u4e48\u8bbe$dp(k,i)$\u4e3a\u524d$i$\u4e2a\u5206\u4e86$k$\u6b21\u7684\u6700\u5927\u503c\u3002\u6839\u636e\u4e0a\u9762\u7684\u5f0f\u5b50\uff0c\u53ef\u4ee5\u6709DP\u65b9\u7a0b\n$$dp(k,i)=\\max\\{dp(k-1, j)+s(j) \\cdot (s(i) - s(j))\\}$$\n\u5176\u4e2d$s(i)$\u4e3a\u524d\u7f00\u548c\u3002\n\u663e\u7136\u53ef\u4ee5\u659c\u7387\u4f18\u5316\u3002\n\n\n```c++\n#include<cstdio> \n#include<cstring>\n#include<algorithm>\n#include<iostream>\n#include<cmath>\n#include<map>\n#include<vector>\n#define ms(i, j) memset(i, j, sizeof i)\n#define LL long long\n#define db long double\n#define fir first\n#define sec second\n#define mp make_pair\nusing namespace std;\n\nnamespace flyinthesky {\n\n\tconst LL MAXN = 100000 + 5;\n\t\n\tLL n, K, a[MAXN], s[MAXN], dp[205][MAXN], pre[205][MAXN];\n\tLL q[MAXN], l, r;\n\tvector<LL > vec;\n\t\n\tLL getx(LL j) {return s[j];}\n\tLL gety(LL j, LL k) {return dp[k - 1][j] - s[j] * s[j];}\n\tdb getsl(LL a, LL b, LL k) {\n\t\tif (getx(a) == getx(b)) return -1e18;\n\t\treturn 1.0 * (gety(a, k) - gety(b, k)) / (getx(a) - getx(b));\n\t}\n\t\n    void clean() {\n    \tms(pre, 0), ms(s, 0), ms(dp, 0);\n\t}\n    int solve() {\n\n    \tclean();\n    \tcin >> n >> K;\n    \t\n    \tfor (LL i = 1; i <= n; ++i) scanf(\"%lld\", &a[i]), s[i] = a[i] + s[i - 1];\n\n\t\tfor (LL k = 1; k <= K; ++k) {\n\t\t\tl = 1, r = 1, q[1] = 0;\n\t\t\tfor (LL i = 1; i <= n; ++i) {\n\t\t\t\twhile (l < r && getsl(q[l], q[l + 1], k) >= -s[i]) ++l;\n\t\t\t\tdp[k][i] = dp[k - 1][q[l]] + s[q[l]] * (s[i] - s[q[l]]);\n\t\t\t\tpre[k][i] = q[l];\n\t\t\t\twhile (l < r && getsl(q[r - 1], q[r], k) <= getsl(q[r], i, k)) --r;\n\t\t\t\tq[++r] = i;\n\t\t\t}\n\t\t}\n\t\t\n\t\tprintf(\"%lld\\n\", dp[K][n]);\n\t\tLL cur = n, tms = K;\n\t\twhile (cur != 0) {\n\t\t\tvec.push_back(cur);\n\t\t\tcur = pre[tms][cur], --tms;\n\t\t}\n\t\tsort(vec.begin(), vec.end());\n\t\tfor (LL i = 0; i < (LL)vec.size() - 1; ++i) printf(\"%lld \", vec[i]);\n\n        return 0;\n    }\n}\nint main() {\n    flyinthesky::solve();\n    return 0;\n}\n```",
        "postTime": 1550212850,
        "uid": 12943,
        "name": "FlyInTheSky",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3648 \u3010[APIO2014]\u5e8f\u5217\u5206\u5272\u3011"
    }
]