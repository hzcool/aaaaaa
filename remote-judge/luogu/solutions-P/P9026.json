[
    {
        "content": "## \u601d\u8def\n\n\u6700\u4f18\u65b9\u6848\u4e00\u5b9a\u662f\u53ea\u4ece\u8d77\u70b9\u5f00\u59cb\u5750\u4e00\u6bb5\u5730\u94c1\u3002\n\n\u56e0\u4e3a\uff0c\u5982\u679c\u4f60\u5750\u4e24\u6bb5\uff0c\u8fd8\u4f1a\u5b58\u5728\u7b49\u5730\u94c1\u8fd9\u79cd\u4e8b\u60c5\uff0c\u4e00\u5b9a\u4e0d\u4f1a\u66f4\u4f18\u3002\n\n---------\n\n\u5efa\u53cd\u56fe\u4ece\u7ec8\u70b9\u5f00\u59cb\u8dd1\u4e00\u904d bfs\uff0c\u5f97\u5230\u6bcf\u4e2a\u70b9\u5230\u7ec8\u70b9\u7684\u8ddd\u79bb\u3002\n\n\u6bcf\u4e2a\u70b9\u5230\u8d77\u70b9\u7684\u8ddd\u79bb\u5c31\u662f $S$ \u7684\u9006\u6392\u5217\u3002\u9006\u6392\u5217\u5c31\u662f\u628a\u4e0b\u6807\u548c\u6570\u503c\u6362\u4e00\u4e0b\uff0c\u6211\u4ee3\u7801\u91cc\u8bb0\u505a `a`\u3002\n\n\u4e24\u4e2a\u62fc\u8d77\u6765\uff0c\u53d6\u6700\u5c0f\u503c\u5c31\u662f\u7b54\u6848\u3002\n\n\u56e0\u4e3a\u6709\u4fee\u6539\uff0c\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u4e00\u4e0b\u3002\n\n## code\n\n\u7528 `set` \u5b9e\u73b0\uff0c\u8dd1\u7684\u5f88\u6162\u3002\n\n```cpp\n#include<stdio.h>\n#include<deque>\n#include<set>\n#define N 222222\n#define pr pair<int,int> \nusing namespace std;\ninline char nc()\n{\n\tstatic char buf[99999],*l,*r;\n\treturn l==r&&(r=(l=buf)+fread(buf,1,99999,stdin),l==r)?EOF:*l++;\n}\ninline void read(int&x)\n{\n\tchar c=nc();for(;c<'0'||'9'<c;c=nc());\n\tfor(x=0;'0'<=c&&c<='9';x=(x<<3)+(x<<1)+(c^48),c=nc());\n}\nint n,m,d,s[N],a[N],h[N],e[N],nxt[N],dis[N];set<pr>qwq;\ndeque<int>q;\nmain()\n{\n\tread(n);read(m);read(d);\n\tfor(int i=1,u,v;i<=m;++i)read(u),read(v),--u,--v,\n\t\te[i]=u,nxt[i]=h[v],h[v]=i;\n\tfor(int i=0,x;i<n;read(s[i]),a[--s[i]]=i,dis[i++]=1<<30);\n\tq.emplace_back(n-1);dis[n-1]=0;\n\tfor(int i;q.size();)\n\t{\n\t\ti=q.front();q.pop_front();\n\t\tfor(int j=h[i];j;j=nxt[j])if(dis[e[j]]>>30)\n\t\t\tdis[e[j]]=dis[i]+1,q.emplace_back(e[j]);\n\t}\n\tfor(int i=0;i<n;++i)qwq.emplace(dis[i]+a[i],i);\n\tfor(int u,v;d--;printf(\"%d\\n\",qwq.begin()->first))\n\t{\n\t\tread(u);read(v);--u;--v;\n\t\tswap(s[u],s[v]);\n\t\tu=s[u];v=s[v];\n\t\tqwq.erase((pr){dis[u]+a[u],u});qwq.erase((pr){dis[v]+a[v],v});\n\t\tswap(a[u],a[v]);\n\t\tqwq.emplace(dis[u]+a[u],u);qwq.emplace(dis[v]+a[v],v);\n\t}\n}\n```\n\n## code\n\n\u7528\u5806\u5b9e\u73b0\uff0c\u8dd1\u7684\u5f88\u5feb\u3002\n\n```cpp\n#include<stdio.h>\n#include<queue>\n#define N 222222\n#define pr pair<int,int> \nusing namespace std;\ninline char nc()\n{\n\tstatic char buf[99999],*l,*r;\n\treturn l==r&&(r=(l=buf)+fread(buf,1,99999,stdin),l==r)?EOF:*l++;\n}\ninline void read(int&x)\n{\n\tchar c=nc();for(;c<'0'||'9'<c;c=nc());\n\tfor(x=0;'0'<=c&&c<='9';x=(x<<3)+(x<<1)+(c^48),c=nc());\n}\ninline void pc(const char&c)\n{\n\tstatic char buf[99999],*r=buf;\n\t(!c||(*r++=c,r==buf+99999))&&(fwrite(buf,1,r-buf,stdout),r=buf);\n}\ninline void pi(const int&x){if(x>9)pi(x/10);pc(x%10+'0');}\nint n,m,d,s[N],a[N],h[N],e[N],nxt[N],dis[N];\npriority_queue<pr,vector<pr>,greater<pr> >qwq;deque<int>q;\nmain()\n{\n\tread(n);read(m);read(d);\n\tfor(int i=1,u,v;i<=m;++i)read(u),read(v),--u,--v,\n\t\te[i]=u,nxt[i]=h[v],h[v]=i;\n\tfor(int i=0,x;i<n;read(s[i]),a[--s[i]]=i,dis[i++]=1<<30);\n\tq.emplace_back(n-1);dis[n-1]=0;\n\tfor(int i;q.size();)\n\t{\n\t\ti=q.front();q.pop_front();\n\t\tfor(int j=h[i];j;j=nxt[j])if(dis[e[j]]>>30)\n\t\t\tdis[e[j]]=dis[i]+1,q.emplace_back(e[j]);\n\t}\n\tfor(int i=0;i<n;++i)qwq.emplace(dis[i]+a[i],i);\n\tfor(int u,v;d--;pi(qwq.top().first),pc('\\n'))\n\t{\n\t\tread(u);read(v);--u;--v;\n\t\tswap(s[u],s[v]);\n\t\tu=s[u];v=s[v];\n\t\tswap(a[u],a[v]);\n\t\tqwq.emplace(dis[u]+a[u],u);qwq.emplace(dis[v]+a[v],v);\n\t\tfor(;qwq.top().first^dis[qwq.top().second]+a[qwq.top().second];\n\t\t\tqwq.pop());\n\t}\n\tpc(0);\n}\n```\n\n",
        "postTime": 1675571986,
        "uid": 90693,
        "name": "_\u2022\u0301\u3078\u2022\u0301\u256c_",
        "ccfLevel": 7,
        "title": "P9026 [CCC2021 S4] Daily Commute \u9898\u89e3"
    },
    {
        "content": "# [Daily Commute](https://www.luogu.com.cn/problem/P9026)\n## by [jr_zch](https://www.luogu.com.cn/blog/jr-zch-code-garden/) \u535a\u5ba2\u98df\u7528\u66f4\u4f73\u55b5~\n## Part 1\uff1a\u9898\u76ee\u5927\u610f \n\u7ed9\u4f60\u4e00\u4e2a $n$ \u4e2a\u70b9 $w$ \u6761\u8fb9\u7684**\u6709\u5411\u56fe**\uff0c\u6bcf\u6761\u8fb9\u7684\u6743\u503c\u5747\u4e3a $1$\uff0c\u6b64\u5916\u8fd8\u6709\u4e00\u6761\u5730\u94c1\uff0c\u901a\u8fc7\u8fd9\u6761\u5730\u94c1\u4f60\u53ef\u4ee5\u82b1\u8d39 $1$ \u5206\u949f\u4ee5\u6307\u5b9a\u987a\u5e8f\u901a\u8fc7\u6240\u6709 $n$ \u4e2a\u70b9 $($ \u5373 $s$ \u6570\u7ec4 $)$\uff0c\u4f46\u662f\u5f53\u65f6\u95f4\u4e3a $t$ \u65f6\uff0c\u4f60\u53ea\u80fd\u5728 $s_{t \\bmod n}$ \u8fd9\u4e2a\u70b9\u8fdb\u5165\u5730\u94c1\u3002\n\n## Part 2\uff1a\u89e3\u9898\u601d\u8def\n### $O(n^2 \\log_2n)$\uff1a\u6bcf\u4e00\u5929\u90fd\u8dd1\u4e00\u904d `dijkstra` \u5373\u53ef\u3002\n### $O(n \\log_2n)$\uff1a\u6b63\u89e3\u5982\u4e0b\n\u628a\u6240\u6709\u666e\u901a\u8fb9\u5efa\u6210**\u53cd\u56fe**\uff0c\u7136\u540e\u4ece $n$ \u70b9\u5f00\u59cb\u8dd1\u4e00\u904d `dijkstra` \u5f97\u5230\u6bcf\u4e2a\u70b9\u8ddd $n$ \u7684\u8ddd\u79bb $dis$ \u6570\u7ec4\u3002\n\n\u56e0\u4e3a\u5730\u94c1\u5e76\u4e0d\u662f\u60f3\u8fdb\u5c31\u53ef\u4ee5\u8fdb\u5165\u7684\uff0c\u9700\u8981\u7b49\u5f85\uff0c\u90a3\u4e48\u5f88\u663e\u7136\uff0c\u6700\u4f18\u89e3**\u4e0d\u53ef\u80fd\u8fde\u7eed\u5750\u4e24\u6bb5\u5730\u94c1** $($ \u660e\u660e\u53ef\u4ee5\u4e00\u76f4\u5728\u5730\u94c1\u91cc\u5f85\u7740\uff0c\u4e3a\u4f55\u8981\u51fa\u6765\uff0c\u8d70\u4e00\u6bb5\u8def\uff0c\u518d\u7b49\u5730\u94c1\uff0c\u7136\u540e\u5230\u8fbe\u76ee\u7684\u5730\u5462\uff1f$)$\u3002\n\n\u90a3\u4e48\u53ea\u9700\u8981\u679a\u4e3e\u5730\u94c1\u5750\u5230\u54ea\u91cc\uff0c\u65e0\u4fee\u6539\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log_2n)$\u3002\n\n\u5728\u6709\u4fee\u6539\u7684\u60c5\u51b5\u4e0b\u4e5f\u5f88\u7b80\u5355\uff0c\u56e0\u4e3a\u8981\u6c42\u6700\u5c0f\u503c\uff0c\u5f88\u5bb9\u6613\u60f3\u5230\u7528**\u5c0f\u6839\u5806**\u7ef4\u62a4\u4e00\u4e0b\u3002\n\n\u4f46\u662f\u4f18\u5148\u961f\u5217\u91cc\u8981\u5b58 $3$ \u4e2a\u503c\uff1a\n\n1. \u5750\u5730\u94c1\u5230\u8fd9\u4e2a\u70b9\u6240\u9700\u4e0e\u8d70\u5230\u7ec8\u70b9\u6240\u9700\u7684\u603b\u65f6\u95f4\u3002\n2. \u8fd9\u4e2a\u70b9\u7684\u7f16\u53f7\u3002\n3. \u8fd9\u4e2a\u70b9\u4e00\u5171\u4ea4\u6362\u8fc7\u51e0\u6b21\u3002\n\n\u6bcf\u4e00\u6b21\u4fee\u6539\u5c31\u628a\u4fee\u6539\u540e\u7684\u5165\u961f\uff0c\u7136\u540e `while` \u5224\u65ad\uff0c\u5982\u679c\u5806\u9876\u5143\u7d20\u7684\u4ea4\u6362\u6b21\u6570\u4e0e\u8fd9\u4e2a\u70b9\u5f53\u524d**\u603b\u5171\u4ea4\u6362\u6b21\u6570**\u4e0d\u76f8\u7b49\u5c31\u5f39\u51fa\u3002\n\n` while(r.top().day!=a[r.top().p]) r.pop(); `\n#### tips\uff1a\n* \u6700\u77ed\u8def\u7684 $dis$ \u6570\u7ec4\u8bb0\u5f97\u521d\u59cb\u5316\u6210**\u6781\u5927\u503c**\u3002\n* \u91cd\u8f7d\u8fd0\u7b97\u7b26\u65f6\u6ce8\u610f\u7ec6\u8282\u3002\n\n## Part 3\uff1aCode\n```cpp\n#include <bits/stdc++.h>\n#define pair pair<int,int>\nusing namespace std;\n\nconst int maxn=2e5+7;\nint n,m,d,u,v;\nint s[maxn],dis[maxn],a[maxn];\nbool vis[maxn];\nstruct node{\n\tint len,p,day;\n\tconst bool operator>(const node& x) const{\n    \treturn len>x.len;\n  \t}\n};\nvector<int> e[maxn];\npriority_queue<pair,vector<pair >,greater<pair > > q;\npriority_queue<node,vector<node>,greater<node> > r;\n\nvoid dijkstra(int st){\n\tmemset(dis,0x3f,sizeof(dis));\n\tdis[st]=0,q.push(make_pair(0,st));\n\twhile(q.size()){\n\t\tint u=q.top().second;\n\t\tq.pop();\n\t\tif(vis[u]) continue;\n\t\tvis[u]=1;\n\t\tfor(int i=0;i<e[u].size();i++){\n\t\t\tint v=e[u][i];\n\t\t\tif(dis[v]>dis[u]+1){\n\t\t\t\tdis[v]=dis[u]+1;\n\t\t\t\tq.push(make_pair(dis[v],v));\n\t\t\t}\n\t\t}\n\t}\n\treturn ;\n}\n\nint main(){\n\tscanf(\"%d%d%d\",&n,&m,&d);\n\tfor(int i=1;i<=m;i++){\n\t\tscanf(\"%d%d\",&u,&v);\n\t\te[v].push_back(u);\n\t}\n\tdijkstra(n);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&s[i]);\n\tfor(int i=1;i<=n;i++) r.push({i+dis[s[i]]-1,s[i],0});\n\tfor(int i=1;i<=d;i++){\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tr.push({v+dis[s[u]]-1,s[u],++a[s[u]]});\n\t\tr.push({u+dis[s[v]]-1,s[v],++a[s[v]]});\n\t\twhile(r.top().day!=a[r.top().p]) r.pop();\n\t\tprintf(\"%d\\n\",r.top().len);\n\t\tswap(s[u],s[v]);\n\t}\n\treturn 0;\n}\n```\n## Thanks for your reading",
        "postTime": 1683615638,
        "uid": 772999,
        "name": "jr_zch",
        "ccfLevel": 0,
        "title": "Daily Commute"
    }
]