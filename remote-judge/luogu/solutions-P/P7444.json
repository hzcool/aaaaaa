[
    {
        "content": "\u5b9e\u611f 2D \u4e25\u683c\u5c0f\u4e8e 2C\u3002\u53ef\u80fd\u98ce\u683c\u4e0d\u592a\u5408\u53e3\u5473\u3002\n\n\u663e\u7136\u6839\u636e $c_1$ \u6211\u4eec\u53ef\u4ee5\u786e\u5b9a $0$ \u5728\u6574\u4e2a\u5e8f\u5217\u7684\u6700\u591a\u4e24\u4e2a\u5408\u6cd5\u7684\u4f4d\u7f6e\u3002\n\n\u76f4\u63a5\u7b97\u80af\u5b9a\u662f\u4e0d\u592a\u884c\u7684\uff0c\u8003\u8651\u5c06\u6570\u4e00\u4e2a\u4e00\u4e2a\u52a0\u8fdb\u53bb\u3002\u5b9a\u4e49 $dp_{i,l,r}$ \u8868\u793a\uff0c\u586b\u4e86 $0 \\sim i-1$\uff0c\u5728\u6392\u5217\u91cc\u6784\u6210\u7684\u6781\u5927\u533a\u95f4\u4e3a $[l,r]$ \u7684\u5408\u6cd5\u6392\u5217\u4e2a\u6570\u3002\u5206\u7c7b\u8ba8\u8bba\u3002\n\n\u5047\u8bbe $c_i=0$\uff0c\u90a3\u4e48\u65b0\u52a0\u5165\u7684\u8fd9\u4e2a\u6570\u4e00\u5b9a\u5b58\u5728\u4e8e\u4e4b\u524d\u7684\u533a\u95f4 $[l,r]$\u3002\u53ef\u4ee5\u6839\u636e $i$ \u5f97\u5230 $[l,r]$ \u7684\u7a7a\u4f4d\u5269\u4e0b\u591a\u5c11\uff0c\u968f\u4fbf\u52a0\u4e00\u4e2a\u5c31\u884c\u4e86\u3002\u8f6c\u79fb\u663e\u7136\u3002\n\n\u5426\u5219\uff0c\u65b0\u52a0\u5165\u7684\u6570\u53ef\u80fd\u5728 $[l,r]$ \u5de6\u8fb9\u6216\u8005\u53f3\u8fb9\u3002\u4ee5\u5de6\u8fb9\u4e3a\u4f8b\u3002\u8003\u8651 $c_i$ \u7684\u6784\u6210\uff0c\u5047\u8bbe\u6211\u4eec\u63d2\u5165\u7684\u4f4d\u7f6e\u4e3a $L$\uff0c\u90a3\u4e48\u5c31\u4f1a\u6709 $(l-L+1) \\times (n-r+1)$ \u4e2a $\\operatorname{mex}$ \u7b49\u4e8e $i$ \u7684\u5b50\u6570\u7ec4\u3002\u90a3\u4e48\u663e\u7136 $c_i | n-r+1$\u3002\u8fd9\u4e2a\u65f6\u5019\u5224\u65ad\u968f\u4fbf\u7b97\u7b97\u6269\u5927\u533a\u95f4\u5c31\u884c\u4e86\u3002\u53ef\u4ee5\u770b 80pts \u4ee3\u7801\u5b9e\u73b0\u3002\n\n\u5b9e\u9645\u4e0a\u5230\u8fd9\u91cc\u53ef\u4ee5\u731c\u6d4b\u56e0\u4e3a\u9650\u5236\u5341\u5206\u7d27\u53ef\u4ee5\u731c\u6d4b\u5b9e\u9645\u53ef\u4ee5\u5f97\u5230\u7684\u72b6\u6001\u5f88\u5c11\u6240\u4ee5\u7528\u4e2a\u5565 `map` \u5b58\u4e00\u5b58\u8f6c\u79fb\u5c31\u53ef\u4ee5\u5f97\u5230 80pts \u4e86\u3002\u8fd9\u9898\u8fd9\u70b9\u4e0d\u884c\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nconst LL MOD=998244353;\nchar buf[1<<21],*p1=buf,*p2=buf;\n#define getchar() (p1==p2 && (p2=(p1=buf)+fread(buf,1,1<<18,stdin),p1==p2)?EOF:*p1++)\nLL read()\n{\n\tLL x=0;\n\tchar c=getchar();\n\twhile(c<'0' || c>'9')\tc=getchar();\n\twhile(c>='0' && c<='9')\tx=(x<<1)+(x<<3)+(c^'0'),c=getchar();\n\treturn x;\n}\nvoid write(LL x)\n{\n\tif(x>9)\twrite(x/10);\n\tputchar(x%10+'0');\n}\nstruct State{\n\tLL i,l,r;\n\tState(){}\n\tState(LL I,LL L,LL R){i=I,l=L,r=R;}\n\tbool operator < (State ano) const\n\t{\n\t\tif(i!=ano.i)\treturn i<ano.i;\n\t\tif(l!=ano.l)\treturn l<ano.l;\n\t\tif(r!=ano.r)\treturn r<ano.r;\n\t\treturn false;\n\t}\n};\nmap<State,bool> al;\nmap<State,LL> dp;\nqueue<State> Q;\nLL n,c[500005];\nLL Calc(LL x){return x*(x+1)/2;}\nint main(){\n\tn=read();\n\tfor(LL i=1;i<=n;++i)\tc[i]=read();\n\tfor(LL i=1;i<=n;++i)\n\t{\n\t\tLL l=i-1,r=i+1;\n\t\tif(Calc(l)+Calc(n-r+1)==c[1])\n\t\t{\n\t\t\tState tmp=State(1,i,i);\n\t\t\tdp[tmp]=1;\n\t\t\tQ.push(tmp);\n\t\t}\n\t}\n\twhile(!Q.empty())\n\t{\n\t\tState now=Q.front();\n\t\tQ.pop();\n\t\tif(al[now])\tcontinue;\n\t\tal[now]=true;\n\t\tLL nxt=now.i+1,l=now.l,r=now.r;\n\t\tif(nxt>n)\tcontinue;\n\t\tif(c[nxt]==0)\n\t\t{\n\t\t\tLL rest=(r-l+1)-now.i;\n\t\t\tif(rest>0)\n\t\t\t{\n\t\t\t\tState stt=State(nxt,l,r);\n\t\t\t\t(dp[stt]+=dp[now]*rest)%=MOD;\n\t\t\t\tQ.push(stt);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tLL L=0,R=0;\n\t\t\tLL lef=l,rig=n-r+1;\n\t\t\tif(c[nxt]%lef==0)\n\t\t\t{\n\t\t\t\tR=r+c[nxt]/lef;\n\t\t\t\tif(R<=n)\n\t\t\t\t{\n\t\t\t\t\tState stt=State(nxt,l,R);\n\t\t\t\t\t(dp[stt]+=dp[now])%=MOD;\n\t\t\t\t\tQ.push(stt);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(c[nxt]%rig==0)\n\t\t\t{\n\t\t\t\tL=l-c[nxt]/rig;\n\t\t\t\tif(L>=1)\n\t\t\t\t{\n\t\t\t\t\tState stt=State(nxt,L,r);\n\t\t\t\t\t(dp[stt]+=dp[now])%=MOD;\n\t\t\t\t\tQ.push(stt);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tState Ans=State(n,1,n);\n\twrite(dp[Ans]);\n\treturn 0;\n}\n```\n\n\u5c06\u4e0a\u9762\u7684\u4ee3\u7801\u5199\u6210\u6570\u7ec4 dp \u7684\u5f62\u5f0f\u7684\u7a7a\u95f4\u4e3a $O(n^3)$\u3002\u6eda\u52a8\u6570\u7ec4\u53ef\u4ee5\u4f18\u5316\u4e00\u7ef4\u3002\u8003\u8651\u5230 $l,r$ \u7684\u6d88\u606f\u4e0d\u597d\u6d88\u9664\uff0c\u5c06 dp \u5185\u5bb9\u8f93\u51fa\u53ef\u4ee5\u53d1\u73b0 $dp_{i,l}$ \u4e2d\u6700\u591a\u6709\u4e00\u4e2a $r$ \u4f7f\u5f97 $dp_{i,l,r} \\neq 0$\u3002\n\n\u8bc1\u660e\u53ef\u4ee5\u8003\u8651\u8f6c\u79fb\u7684\u8fc7\u7a0b\u4e2d\u7684\u4e24\u79cd\u4e0d\u540c\u60c5\u51b5\u5de6\u7aef\u70b9\u4e00\u5b9a\u4e0d\u540c\u3002\u5b58\u4e0b\u533a\u95f4\u5de6\u7aef\u70b9\u4e5f\u6ca1\u5b98\u65b9\u9898\u89e3\u8bf4\u7684\u90a3\u4e48\u9ebb\u70e6\uff0c\u5f00\u4e2a\u6570\u7ec4\u5c31\u884c\u4e86\u3002\u8fd9\u6837\u7a7a\u95f4\u5c31\u88ab\u538b\u5230 $O(n)$ \u4e86\u3002\n\n\u6700\u540e\u9700\u8981\u8003\u8651\u7684\u662f\u8bc1\u660e\u72b6\u6001\u6570\u8db3\u591f\u5c11\u3002\u6839\u636e\u6211\u4eec\u4e0a\u9762\u7684\u53d1\u73b0\u663e\u7136\u72b6\u6001\u6570\u4e0a\u754c $O(n^2)$\u3002\u4ed4\u7ec6\u8003\u8651 $a_i$ \u4e4b\u540e\u53d1\u73b0\u6240\u6709\u7684\u72b6\u6001\u6570\u5b9e\u9645\u4f1a\u548c $\\sum \\sqrt{a_i}$ \u626f\u4e0a\u5173\u7cfb\u3002\u901a\u8fc7\u67ef\u897f\u4e0d\u7b49\u5f0f\u8bc1\u660e\u5176\u5c0f\u4e8e\u7b49\u4e8e $n \\sqrt n$\uff0c\u53ef\u4ee5\u628a\u65f6\u95f4\u590d\u6742\u5ea6\u770b\u4e3a $O(n \\sqrt n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define Sunset namespace\n#define Toybox std\nusing Sunset Toybox;\ntypedef long long LL;\nconst LL MOD=998244353;\nchar buf[1<<21],*p1=buf,*p2=buf;\n#define getchar() (p1==p2 && (p2=(p1=buf)+fread(buf,1,1<<18,stdin),p1==p2)?EOF:*p1++)\nLL read()\n{\n\tLL x=0;\n\tchar c=getchar();\n\twhile(c<'0' || c>'9')\tc=getchar();\n\twhile(c>='0' && c<='9')\tx=(x<<1)+(x<<3)+(c^'0'),c=getchar();\n\treturn x;\n}\nvoid write(LL x)\n{\n\tif(x>9)\twrite(x/10);\n\tputchar(x%10+'0');\n}\nLL Calc(LL x){return x*(x+1)/2;}\nLL n,c[500005],dp[2][500005],st[2][500005];\nbool vis[500005];\nvector<LL> sp,pre,nxt;\nint main(){\n\tn=read();\n\tfor(LL i=0;i<n;++i)\tc[i]=read();\n\tfor(LL i=1;i<=n;++i)\n\t{\n\t\tLL l=i-1,r=i+1;\n\t\tif(Calc(l)+Calc(n-r+1)==c[0])\tsp.push_back(i);\n\t}\n\tif(LL(sp.size())==0)\treturn puts(\"0\")&0;\n\tdp[0][sp[0]]=1;\n\tst[0][sp[0]]=sp[0];\n\tpre.push_back(sp[0]);\n\tfor(LL i=1;i<n-1;++i)\n\t{\n\t\tnxt.clear();\n\t\tLL lst=(i-1)&1;\n\t\tfor(auto j:pre)\n\t\t{\n\t\t\tLL l=j,r=st[lst][l];//dp{i,l} -> r\n\t\t\tif(vis[l])\tcontinue;\n\t\t\tvis[l]=true;\n\t\t\tif(!c[i])\n\t\t\t{\n\t\t\t\tif(r-l-i>=0)\n\t\t\t\t{\n\t\t\t\t\t(dp[i&1][l]+=dp[lst][l]*(r-l+1-i)%MOD)%=MOD;\n\t\t\t\t\tst[i&1][l]=r;\n\t\t\t\t\tnxt.push_back(l);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tLL lef=l,rig=n-r+1;\n\t\t\t\tif(c[i]%rig==0)\n\t\t\t\t{\n\t\t\t\t\tLL L=l-c[i]/rig;\n\t\t\t\t\t(dp[i&1][L]+=dp[lst][l])%=MOD;\n\t\t\t\t\tst[i&1][L]=r;\n\t\t\t\t\tnxt.push_back(L);\n\t\t\t\t}\n\t\t\t\tif(c[i]%lef==0)\n\t\t\t\t{\n\t\t\t\t\tLL R=r+c[i]/lef;\n\t\t\t\t\t(dp[i&1][l]+=dp[lst][l])%=MOD;\n\t\t\t\t\tst[i&1][l]=R;\n\t\t\t\t\tnxt.push_back(l);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(auto j:pre)\tvis[j]=false,dp[lst][j]=0;\n\t\tnxt.swap(pre);\n\t}\n\tLL ans=0;\n\tfor(LL i=1;i<=n;++i)\t(ans+=dp[(n-2)&1][i])%=MOD;\n\twrite(ans*LL(sp.size())%MOD);\n\treturn 0;\n}\n```",
        "postTime": 1616502723,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "P7444 \u9898\u89e3"
    },
    {
        "content": "\u63d0\u793a\uff1a\u4e0b\u5217\u8bbe Alice \u7ed9\u51fa\u7684\u6570\u4e3a $a_1,a_2, \\ldots ,a_n$\uff0c\u4ed6\u624b\u4e2d\u7684\u6392\u5217\u4e3a $b_1,b_2, \\ldots ,b_n$\u3002\n\n### $\\texttt{Subtask 1}$ \n\n\u5565\u90fd\u4e0d\u7528\u8bf4\u4e86\uff0c\u7206\u641c\u5427\uff08\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^3 \\times n!)$ \n\n\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u65e0\u804a\u5730\u5c06\u5b83\u4f18\u5316\u6210 $O(n^2 \\times n!)$ \u2026\u2026 \u4e0d\u8fc7\u4e0d\u9700\u8981\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$5$\n\n### $\\texttt{Subtask 2}$ \n\n\u4e13\u95e8\u7559\u7ed9\u4e00\u4e9b\u6307\u6570\u505a\u6cd5\u548c\u7206\u641c\u526a\u679d\u505a\u6cd5\uff0c\u542c\u4e00\u4e9b\u795e\u4ed9\u8bf4\u597d\u50cf\u53ef\u4ee5\u3002\n\n\u81ea\u5df1\u6ca1\u8bd5\u8fc7\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(?)$\n\n\u671f\u671b\u5f97\u5206\uff1a $15$\n\n### $\\texttt{Subtask 3}$ \n\n\u9996\u5148\u7ecf\u8fc7\u4e00\u5b9a\u7684\u601d\u8003\u8fc7\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u505a\u5b8c\u540e\u518d check \u7684\u65b9\u6cd5\u5e76\u4e0d\u597d\u3002\n\n\u90a3\u5c31\u8003\u8651\u80fd\u4e0d\u80fd\u4ece\u5c0f\u5230\u5927\u585e\u8fdb\u53bb\u3002\n\n\u56e0\u4e3a\u5f88\u663e\u7136\uff0c\u82e5 $i>j$\uff0c\u5219 $i$ \u7684\u4f4d\u7f6e\u4e0d\u4f1a\u5f71\u54cd $j$\u3002 \n\n\u6362\u800c\u8a00\u4e4b\uff0c\u5c31\u662f\u53ea\u6709\u5f53 $i \\leq j$ \u65f6\uff0c$i$ \u7684\u4f4d\u7f6e\u624d\u4f1a\u5f71\u54cd $j$\u3002\n\n\u90a3\u4e48\u9996\u5148\uff0c\u82e5\u9700 $f_{l,r}=j$ ,\u5219 $b_l,b_{l+1},...,b_r$ \u5fc5\u987b\u5305\u542b $1 - (j-1)$ \u4e2d\u6240\u6709\u7684\u6570\u3002\n\n\u5219\u8bbe\u5305\u542b\u8fd9\u4e9b\u6570\u7684\u6700\u5c0f\u533a\u95f4\u7684\u5de6\u7aef\u70b9\u4e3a $L$\uff0c\u53f3\u7aef\u70b9\u4e3a $R$\u3002\n\n\u5206\u4e09\u79cd\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n- $j$ \u5728 $[L,R]$ \u4e2d\n\n\n\n\u90a3\u4e48\u5f88\u663e\u7136\uff0c\u6b64\u65f6\u5fc5\u987b\u6ee1\u8db3 $a_j=0 $\u3002 \n\n- $j$ \u5728 $[1,L-1]$ \u4e2d\n\n\n\n\u6b64\u65f6\uff0c\u8bbe $j$ \u7684\u4f4d\u7f6e\u4e3a $pos$\uff0c\u5219\u5de6\u7aef\u70b9\u53ef\u4ee5\u9009\u53d6 $[pos+1,L]$\uff0c\u53f3\u7aef\u70b9\u53ef\u4ee5\u9009\u53d6 $[R,n]$\uff0c\u6240\u4ee5 $a_j=(n-R+1) \\times (L-pos)$\u3002\n\n- $j$ \u5728 $[R+1,n]$ \u4e2d\n\n\n\n\u4e0e\u4e0a\u9762\u5b8c\u5168\u5bf9\u79f0\uff0c\u53ef\u4ee5\u5f97\u51fa $a_j=L \\times (pos-R)$\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c $a_j$ \u7684\u503c\u5b8c\u5168\u53ea\u4e0e $L,R,pos$ \u6709\u5173\u3002\u800c\u4e14\u5f88\u663e\u7136\uff0c $pos$ \u53ef\u4ee5\u8f7b\u677e\u7528 $a_j,L,R$ \u8868\u793a\u548c\u68c0\u9a8c\u662f\u5426\u6210\u7acb\u3002\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u7528 $dp_{i,l,r}$ \u6765\u8868\u793a\u5f53\u9009\u4e86 $i$\uff0c\u6ee1\u8db3 $a_i$ \u7684\u6761\u4ef6\u4e14\u5305\u542b $1-i$ \u7684\u6700\u5c0f\u533a\u95f4\u4e3a $[l,r]$ \u7684\u60c5\u51b5\u79cd\u6570\u3002\n\n\u8f6c\u79fb\u65b9\u7a0b\u5e94\u8be5\u4ee5 $i-1$ \u8f6c\u79fb\u5230 $i$ \u6765\u5199\u66f4\u52a0\u65b9\u4fbf\uff08\u4e2a\u4eba\u8ba4\u4e3a\uff09\u3002\n\n\u82e5 $a_i = 0$\uff0c\u56e0\u4e3a $i$ \u5fc5\u987b\u653e\u5728 $[l,r]$ \u4e2d\u95f4\uff0c\u6240\u4ee5 $dp_{i,l,r}=dp_{i-1,l,r} \\times [r-l+1-(i-1)]=dp_{i-1,l,r} \\times (r-l-i+2)$\u3002\n\n\u82e5 $a[i] \\neq 0$\uff0c\u5206\u4e24\u79cd\u60c5\u51b5\uff1a\n\n- \u82e5 $pos<l$\n\n\u5219\u6839\u636e\u4e0a\u6587\u63a8\u51fa\u7684\u7ed3\u8bba\uff0c\u5f53 $(n-r+1)\\mid a_i$ \u65f6\uff0c\u8bbe $\\dfrac{a_i}{n-r+1}=p$\u3002\n\n\u5219 $l-pos=p$\uff0c$pos=l-p$\uff0c\u533a\u95f4\u6269\u5f20\u6210 $[pos,r]$ \u5373 $[l-p,r]$\uff0c\n\n\u6240\u4ee5\u53ef\u4ee5\u5f97\u5230 $dp_{i,l-p,r}+=dp_{i-1,l,r}$\u3002\n\n- \u82e5 $pos>r$\n\n\u63a8\u7406\u8fc7\u7a0b\u4e0e\u4e0a\u9762\u7c7b\u4f3c\uff0c\u6700\u7ec8\u53ef\u4ee5\u5f97\u5230\u8bbe $\\dfrac{a_i}{l}=p$\uff0c\u5219\u533a\u95f4\u6269\u5f20\u6210 $[l,r+p]$\uff0c\u6240\u4ee5\u53ef\u4ee5\u5f97\u5230 $dp_{i,l,r+p}+=dp_{i-1,l,r}$\u3002\n\n\u53ea\u9700\u679a\u4e3e $i,l,r$ \u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^3)$\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a $35$ \n\n### $\\texttt{Subtask 4}$  \n\n\u56e0\u4e3a\u5728 $\\texttt{Subtask 3}$ \u4e2d\uff0c\u5b9a\u4e49\u7684\u72b6\u6001\u662f\u4e09\u7ef4\u7684\uff0c\u663e\u7136\u8fc7\u4e0d\u4e86\u8fd9\u4e2a\u70b9\u3002\n\n\u90a3\u4e48\u5c31\u8981\u5c1d\u8bd5\u5c06\u5b83\u538b\u5230\u4e8c\u7ef4\u7684\u3002\n\n\u901a\u8fc7\u4e00\u756a\u627e\u89c4\u5f8b\uff0c\u53ef\u4ee5\u53d1\u73b0\uff1a\n\n**\u6bcf\u4e00\u4e2a $dp_{i,l,r}$\uff0c\u5f53\u5b83\u7684\u72b6\u6001\u662f\u5b58\u5728\u7684\u65f6\u4faf\uff0c\u4e00\u4e2a $l$ \u53ea\u5bf9\u5e94\u552f\u4e00\u7684 $r$**\n\n\u8bc1\u660e\u5982\u4e0b\uff1a\n\n\u56e0\u4e3a\u53ef\u4ee5\u5f97\u5230\u6240\u6709 $1-i$ \u7684\u6570\u90fd\u5728\u533a\u95f4 $[l,r]$ \u5185\uff0c\u6240\u4ee5\u82e5 $f_{l_1,r_1}> i$ ,\u5219 $l_1\\leq l,r_1 \\geq r$\u3002\n\n\u6545\u6839\u636e\u4e58\u6cd5\u539f\u7406\u5f97 $\\sum_{k=i+1}^{n+1}a_k=l \\times (n-r+1)$ \u3002\n\n\u800c $\\sum_{k=i+1}^{n+1}a_k$ \u662f\u539f\u6709\u7684\u3002\n\n\u6240\u4ee5\u5f53\u4e00\u4e2a $l$ \u56fa\u5b9a\u65f6\uff0c $n-r+1$ \u4e5f\u662f\u56fa\u5b9a\u7684\u3002\n\n\u56e0\u6b64 $r$ \u662f\u56fa\u5b9a\u7684\u3002\n\n\u8ba1\u7b97 $\\sum_{k=i+1}^{n+1}$ \u65f6\u53ef\u5148\u7b97\u51fa $\\sum_{p=1}^{i}a_p$ ,\u7136\u540e\u56e0\u4e3a\n\n\n$\\sum_{k=i+1}^{n+1}a_p=\\sum_{j=1}^{n+1}a_j-\\sum_{p=1}^{i}a_p $\u3002 \n\n\n\u6240\u4ee5 $\\sum_{k=i+1}^{n}a_k$ \u4e5f\u5c31\u7b97\u51fa\u6765\u4e86\u3002\n\n\u56e0\u6b64\u6bcf\u4e00\u4e2a $l$ \u53ef\u4ee5\u8f7b\u677e\u7b97\u51fa\u53e6\u4e00\u4e2a $r$ \uff0c\u6210\u529f\u628a\u72b6\u6001\u538b\u6210\u4e86 $2$ \u4f4d\u3002\n\n\u5f53\u7136\u4f60\u628a\u4ed6\u4f18\u5316\u6210\u6eda\u52a8\u6570\u7ec4\u90a3\u66f4\u597d\uff08\n\n**\u6ce8\u610f\u7279\u5224 $i=1$**\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a $65$\n\n### $\\texttt{Subtask 5}$  \n\n\u53ef\u4ee5\u53d1\u73b0 $\\texttt{Subtask 4}$ \u7684\u505a\u6cd5\u4e2d\u6709\u5f88\u591a\u65e0\u7528\u72b6\u6001\uff0c\u4e0d\u9700\u8981\u5168\u90e8\u679a\u4e3e\u3002\n\n- \u82e5 $a_i \\neq 0$\n\n\u6b64\u65f6 $dp_{i-1,l}$ \u5bf9 $dp_{i,k}$ \u6709\u8d21\u732e\u7684\u8bdd\u5fc5\u987b\u6ee1\u8db3 $l\\mid a_i$ \u6216 $(n-r+1)\\mid a_i$\u3002\n\n\u90a3\u4e48\u679a\u4e3e $l$ \u548c $(n-r+1)$ \u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\sum\\sqrt{a_i})$\u3002\n\n\u800c\u6839\u636e\u67ef\u897f\u4e0d\u7b49\u5f0f\uff1a\n\n$$(\\sum_{i=1}^{n} \\sqrt{a_i})^2\\leq (1 \\times n)(\\sum_{i=1}^{n}a_i)=(1\\times n)(n\\times(n+1)/2)<n^{\\frac{3}{2}}$$\n\n\u53ef\u4ee5\u5f97\u5230\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\sqrt n)$\n\n- \u82e5 $a_i=0$\n\n\u6839\u636e $\\texttt{Subtask 3}$ \u7684\u601d\u8def\uff0c\u5f53 $a_i=0$ \u65f6\u5de6\u533a\u95f4\u7684\u957f\u5ea6\u8981\u4ece  $1-(n-i+1)$ \u5168\u90e8\u904d\u5386\u4e00\u904d\u6765\u8f6c\u79fb\u3002\n\n\u9996\u5148\u53ef\u4ee5\u53d1\u73b0\uff0c$0$ \u7684\u4e2a\u6570\u53ef\u80fd\u5f88\u591a\uff0c\u6bd4\u5982\u628a $1,2$ \u653e\u4e24\u7aef\uff0c\u5219\u4f1a\u6709 $n-2$ \u4e2a $0$\u3002\n\n\u6240\u4ee5\u7b97\u6cd5\u53ef\u80fd\u4f1a\u9000\u5316\u6210 $O(n^2)$\u3002\n\n\u4f46\u8003\u8651\u5230\u8fd9\u6837\u505a\u6709\u70b9\u6d6a\u8d39\uff0c\u56e0\u4e3a\u5f88\u591a $dp(i,l)$ \u5bf9\u540e\u9762\u7684\u7b54\u6848\u4f1a\u9020\u6210\u5f71\u54cd\u3002\n\n\u53c8\u53ef\u4ee5\u53d1\u73b0\uff0c\u5728\u8fd9\u4e9b\u6570\u653e\u7684\u65f6\u5019\uff0c$l,r$ \u7684\u503c\u662f\u4e0d\u53d8\u7684\u3002\n\n\u53c8\u56e0\u4e3a\u8f6c\u79fb\u5f0f\u5b50\u662f $dp_{i,l}=dp_{i-1,l}\\times (r-l-i+2)$\u3002\n\n\u6240\u4ee5\u82e5\u5f53 $i$ \u5728\u533a\u95f4 $[L,R]$ \u5185\u65f6 $a_i=0$\u3002\n\n\u5219\u53ef\u4ee5\u5f97\u5230\u8f6c\u79fb\u5f0f\u5b50\uff1a\n\n\u5f53 $l\\mid a_i$ \u65f6\uff1a\n\n$$dp_{R+1,l}+=dp_{L-1,l}\\times \\prod_{k=r-l-R+2}^{r-l-L+2} k(r-l-R+2>0)$$\n\n\u800c \n\n$$\\prod_{k=r-l-R+2}^{r-l-L+2} k=\\frac{(r-l-L+2)!}{(r-l-R+1)!}$$\n\n\u53ef\u4ee5\u9884\u5904\u7406\u9636\u4e58\u7684\u6a21\u6570\u548c\u9006\u5143\uff0c\u6545\u662f $O(1)$ \u7684\u3002\n\n\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\sqrt n)$ ,\u8db3\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$100$\n\n###  $\\texttt{Extra}$\uff1a\n\n\u53ef\u4ee5\u53d1\u73b0\u8fd9\u6837\u505a\u5e38\u6570\u6709\u70b9\u5927\u3002\n\n\u800c\u7ecf\u8fc7\u4e00\u756a\u601d\u8003\uff0c\u53ef\u4ee5\u53d1\u73b0\u65e0\u7528\u72b6\u6001\u6570\u592a\u591a\u4e86\u3002\n\n\u90a3\u600e\u6837\u5462\uff1f\u4ece\u4e0a\u4e00\u6b65\u8f6c\u79fb\u8fc7\u6765\uff01\n\n\u8fd9\u6837\u53ef\u4ee5\u7701\u53bb\u5f88\u591a\u5e38\u6570\u3002\n\n\u7ecf\u8fc7\u4e00\u4e9b\u8ba1\u7b97\uff0c\u53ef\u4ee5\u53d1\u73b0\u56e0\u4e3a\u4e0a\u4e00\u4e2a\u72b6\u6001\u6570\u5f88\u96be\u5230 $\\sqrt n$\u3002\n\n\u6240\u4ee5\u8fd9\u6837\u505a\u7684\u5e38\u6570\u662f\u5f88\u5c0f\u7684\u3002\u8dd1\u7684\u4f1a\u66f4\u5feb\u4e00\u4e9b\u3002\n \n### \u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\ninline long long read()\n{\n\tlong long sum=0,nega=1;char ch=getchar();\n\twhile(ch>'9'||ch<'0'){if(ch=='-')nega=-1;ch=getchar();}\n\twhile(ch<='9'&&ch>='0')sum=sum*10+ch-'0',ch=getchar();\n\treturn sum*nega;\n}\nconst long long N=5e5+9,mod=998244353;\nlong long n,ans,a[N],dp[2][N],fac[N],inv[N],sum=1,len,pos,cnt,use[2][N],tot[2],l,r,p,check[2][N],res;\ninline long long Pow(long long x,long long y)\n{\n\tlong long res=1,base=x;\n\twhile(y)\n\t{\n\t\tif(y&1)res=res*base%mod;\n\t\tbase=base*base%mod;\n\t\ty>>=1;\n\t}\n\treturn res;\n}\ninline long long Gcd(long long x,long long y)\n{\n\tif(y==0)return x;\n\treturn Gcd(y,x%y);\n}\nsigned main()\n{\n\tn=read();\n\tfor(register int i=1;i<=n;i++)a[i]=read(),sum=sum+a[i];\n\tfac[0]=1;\n\tif(sum!=n*(n+1)/2)\n\t{\n\t\tputs(\"0\");\n\t\treturn 0;\n\t}\n\tfor(register int i=1;i<=n;i++)fac[i]=fac[i-1]*i%mod;\n\tinv[n]=Pow(fac[n],mod-2);\n\tfor(register int i=n-1;i>=1;i--)inv[i]=inv[i+1]*(i+1)%mod;\n\tinv[0]=1;\n\tsum-=a[1];\n\tcnt=1,pos=1;\n\tfor(register int i=1;i<=n;i++)\n\t\tif(i*(i-1)/2+(n-i)*(n-i+1)/2==a[1])\n\t\t{\n\t\t\tdp[1][i]=1,tot[cnt]++,use[cnt][tot[cnt]]=i;\n\t\t}\n\tfor(register int i=2;i<=n;i++)\n\t{\n\t\tif(a[i]!=0)\n\t\t{\t\n\t\t\tcnt++;\n\t\t\tlong long x=Gcd(a[i],sum);\n\t\t\tfor(register int j=1;j<=tot[((cnt-1)&1)];j++)\n\t\t\t{\n\t\t\t\tl=use[((cnt-1)&1)][j];r=n+1-sum/l;\n\t\t\t\tif(x%(n+1-r)==0)\n\t\t\t\t{\n\t\t\t\t\tp=a[i]/(n+1-r);\n\t\t\t\t\tif(l-p>=1&&l<=r)\n\t\t\t\t\t{\t\n\t\t\t\t\t\tdp[(cnt&1)][l-p]=(dp[(cnt&1)][l-p]+dp[((cnt-1)&1)][l]*fac[r-l-pos+1]%mod*inv[r-l-i+2]%mod)%mod;\n\t\t\t\t\t\tif(check[((cnt)&1)][l-p]==0)tot[(cnt&1)]++,use[(cnt&1)][tot[(cnt&1)]]=l-p,check[((cnt)&1)][l-p]=1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(x%l==0)\n\t\t\t\t{\n\t\t\t\t\tp=a[i]/l;\n\t\t\t\t\tif(r+p<=n&&r>=l)\n\t\t\t\t\t{\n\t\t\t\t\t\tdp[(cnt&1)][l]=(dp[(cnt&1)][l]+dp[((cnt-1)&1)][l]*fac[r-l-pos+1]%mod*inv[r-l-i+2]%mod)%mod;\n\t\t\t\t\t\tif(check[((cnt)&1)][l]==0)tot[(cnt&1)]++,use[(cnt&1)][tot[(cnt&1)]]=l,check[((cnt)&1)][l]=1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor(register int j=1;j<=tot[((cnt-1)&1)];j++)\n\t\t\t\tdp[((cnt-1)&1)][use[((cnt-1)&1)][j]]=0,check[((cnt-1)&1)][use[((cnt-1)&1)][j]]=0;\n\t\t\tres+=tot[(cnt-1)&1];\n\t\t\ttot[(cnt-1)&1]=0; \t\n\t\t\tpos=i;\n\t\t}\n\t\tsum-=a[i];\n\t}\n\tif(dp[(cnt&1)][1]==0)puts(\"0\");\n\telse printf(\"%lld\\n\",dp[(cnt&1)][1]*fac[n-pos]%mod);\n\treturn 0;\n}\n```\n",
        "postTime": 1614078910,
        "uid": 97304,
        "name": "Mophie",
        "ccfLevel": 0,
        "title": "P7444 \u300cEZEC-7\u300d\u731c\u6392\u5217 \u5b98\u65b9\u9898\u89e3"
    }
]