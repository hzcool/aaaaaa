[
    {
        "content": "\u591a\u6b21\u67e5\u8be2\uff0c\u6bcf\u6b21\u7ed9\u5b9a $n,x,y$\uff0c\u6c42\uff1a\n\n$$\\sum_{i=1}^n \\gcd(i,n)^x\\textrm{lcm}(i,n)^y \\pmod {10^9+7}$$\n\n- $T\\le 100,1\\le n\\le 10^{18},x,y\\le 3000$\n\n---\n\n$\\rm Sol:$\n\n\u7b54\u6848\u662f\uff1a\n\n$$\\sum_{i=1}^n i^y\\cdot n^y\\gcd(i,n)^{x-y}$$\n\n\u679a\u4e3e $\\gcd=d$\uff0c\u5ffd\u7565 $n^y$ \u5219\u6709\uff1a\n\n$$\\begin{aligned}\n    &\\sum_{d|n} d^x\\sum_{j=1}^{\\frac{n}{d}}[\\gcd(j,\\frac{n}{d})=1]j^{y}\n    \\\\&=\\sum_{d|n} d^x\\sum_{j=1}^{n/d}\\sum_{k|j,k|\\frac{n}{d}} \\mu(k)j^y\n    \\\\&=\\sum_{d|n} d^x\\sum_{k|\\frac{n}{d}}\\mu(k) \\sum_{k|j} j^y\n    \\\\&=\\sum_{d|n} d^x\\sum_{k|\\frac{n}{d}}\\mu(k)k^y \\sum_{j=1}^{n/(kd)} j^y\n    \\\\&=\\sum_{d|n} d^x \\sum_{k|\\frac{n}{d}}\\mu(k)k^y S_y(\\frac{n}{kd})\n\\end{aligned}$$\n\n\u6211\u4eec\u5c06 $S_y(\\frac{n}{kd})$ \u89c6\u4e3a\u5173\u4e8e\u5176\u7684 $y+1$ \u6b21\u591a\u9879\u5f0f\uff0c\u90a3\u4e48\u6b64\u5904\u6709\uff1a\n\n$$\\begin{aligned}\n    &\\sum_{d|n} d^x \\sum_{k|\\frac{n}{d}}\\mu(k)k^y \\sum_{i=0}^{y+1}f_i (\\frac{n}{kd})^i\n    \\\\&=\\sum_{i=0}^{y+1}f_i\\sum_{d|n} d^x \\sum_{k|\\frac{n}{d}}\\mu(k)k^y(\\frac{n}{kd})^i\n\\end{aligned}$$\n\n\u6ce8\u610f\u5230\u540e\u8005\u53ef\u4ee5\u89c6\u4e3a $f,g,h$ \u7684\u8fea\u5229\u514b\u96f7\u5377\u79ef\uff0c\u4ee4 $f(d)=d^x,g(d)=\\mu(d)d^y,h^c(d)=d^c$\uff0c\u8fd9\u4e2a\u5377\u79ef\u6ee1\u8db3\u5206\u914d\u5f8b\u548c\u4ea4\u6362\u5f8b\u4ee5\u53ca\u7ed3\u5408\u5f8b\uff0c\u540c\u65f6\u6ce8\u610f\u5230\u4e09\u8005\u5747\u4e3a\u79ef\u6027\u51fd\u6570\uff0c\u6240\u4ee5\u5377\u79ef\u7ed3\u679c\u4e5f\u662f\u79ef\u6027\u51fd\u6570\u3002\n\n\u8bbe\u7ed3\u679c\u4e3a $\\Z(x)$\uff0c\u4e8e\u662f\u6211\u4eec\u6240\u6c42\u4e3a $\\Z(n)$\uff0c\u90a3\u4e48\u663e\u7136\u6709\uff1a\n\n1. $\\Z(1)=1$\n2. $\\Z(p)=p^x+p^c-p^y$\n3. $\\Z(p^k)=f\\cdot h^c(p^k)-f\\cdot h^c(p^{k-1})\\times p^y$\n\n\u4e8e\u662f\u53ea\u9700\u8981\u8003\u8651 $f\\cdot h^c(p^k)$\uff0c\u5176\u4e3a\uff1a\n\n$$\\sum_{i+j=k} f(p^i)\\cdot h^c(p^j)$$\n\n\u6240\u4ee5\u901a\u8fc7 MR \u8fdb\u884c\u66b4\u529b\u8d28\u56e0\u6570\u5206\u89e3\uff0c\u7136\u540e\u6211\u4eec $\\mathcal O(\\log n)$ \u7684\u679a\u4e3e\u6bcf\u4e2a\u8d28\u56e0\u5b50\uff08include \u6b21\u5e42\uff09\u7136\u540e\u66b4\u529b\u5377\u79ef\u5e76\u8ba1\u7b97\u7b54\u6848\u5373\u53ef\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u4f55\u8ba1\u7b97\u81ea\u7136\u6570\u5e42\u7684\u548c\u7684\u591a\u9879\u5f0f\uff1f\n\n#### \u81ea\u7136\u6570\u5e42\u548c\u591a\u9879\u5f0f\n\n\u6784\u9020\u591a\u9879\u5f0f $G_n(x)=\\frac{e^{nx}-1}{1-e^{-x}}$\uff0c\u4e00\u5806\u795e\u4ed9\u5206\u6790\u53ef\u4ee5\u5f97\u5230 $G_n(x)[x^k]$ \u5c31\u662f $\\sum_{i=1}^n i^k$\uff08\u5176\u5b9e\u5e94\u8be5\u662f\u6839\u636e $G_n(x)[x^k]$ \u662f $\\sum_{i=1}^n i^k$ \u63a8\u51fa $G_n(x)$ \u7684\u8868\u8fbe\u5f0f\u7684...\uff09\n\n\u5c06 $G_n(x)$ \u88c2\u9879\u6210 $\\frac{xe^x}{e^x-1}\\times \\frac{e^{nx}-1}{x}$\uff0c\u524d\u8005\u7684 EGF \u5e8f\u5217\u8bb0\u4e3a $\\{B_0,B_1,B_2...\\}$\uff0c\u540e\u8005\u663e\u7136\u662f EGF \u5e8f\u5217 $\\{\\frac{n}{1},\\frac{n^2}{2},\\frac{n^3}{3}...\\}$\n\n\u6240\u4ee5\u6211\u4eec\u4f1a\u53d1\u73b0\u5176\u5b9e\u6709 $G_n(x)[x^k]$ \u662f\u8fd9\u4e24\u4e2a\u6570\u5217\u7684\u4e8c\u9879\u5377\u79ef\u7684\u7ed3\u679c\uff0c\u6240\u4ee5\u6709\uff1a\n\n$$\\begin{aligned}\n    &G_n[x^k]=\\sum_{i+j=k} B_i \\frac{n^{j+1}}{j+1}\\binom{k}{i}\n    \\\\&= \\frac{1}{k+1}\\sum_{i=0}^{k} B_i \\binom{k+1}{i}n^{k-i+1}\n\\end{aligned}$$\n\n\u6362\u800c\u8a00\u4e4b\u5982\u679c\u80fd\u591f\u5f97\u5230\u4f2f\u52aa\u5229\u6570\u90a3\u4e48\u5c31\u53ef\u4ee5\u77e5\u9053\u81ea\u7136\u6570\u5e42\u548c\u591a\u9879\u5f0f\n\n\u7136\u540e\u53ea\u9700\u8981\u9012\u63a8\u4f2f\u52aa\u5229\u6570\u5373\u53ef\u3002\n\n\u6ce8\u610f\u5230 $\\frac{xe^x}{e^x-1}\\times \\frac{e^x-1}{x}=e^x$ \u6240\u4ee5 $\\mathbf{EGF}\\{B_0,B_1...\\}\\times \\mathbf{EGF}\\{\\frac{1}{1},\\frac{1}{2}...\\}=\\mathbf{EGF}\\{1,1,1...\\}$\n\n\u6240\u4ee5\u6709\uff1a\n\n$$\\begin{aligned}\n    &\\sum_{i+j=k} B_i\\times \\frac{1}{j+1}\\times \\binom{k}{i}=1\n    \\\\& \\sum_{i}^k B_i\\times\\binom{k+1}{i}=k+1 \n\\end{aligned}$$\n\n\u4e8e\u662f\u5f97\u5230 $B_k=1-\\sum_{i<k} \\frac{B_i}{k+1}\\binom{k+1}{i}$\n\n\u7efc\u4e0a\uff0c\u672c\u9898\u590d\u6742\u5ea6\u4e3a $\\mathcal O(T\\cdot (n^{\\frac{1}{4}}\\log n+y\\log^2 n)+y^2)$\n\n\n---\n\n\u7136\u540e\u8fd9\u9053\u9898\u5361\u5e38\uff0c\u4f60\u9700\u8981\u5c3d\u53ef\u80fd\u7684\u7701\u7565\u5feb\u901f\u5e42\uff0c\u5982\u679c\u4f60\u662f $\\log^3$ \u7136\u540e\u8fd8\u662f\u6211\u8fd9\u79cd\u5927\u5e38\u6570\u73a9\u5bb6\u5c31\u4f1a\u6b7b\u5f97\u975e\u5e38\u60e8\u3002\n\n\u7136\u540e\u5343\u4e07\u4e0d\u8981\u5199\u9f9f\u901f\u4e58\uff0c\u7136\u540e\u6311\u4e00\u4e2a\u591c\u6df1\u4eba\u9759\u7684\u65f6\u5019\u4ea4\u4e00\u53d1\uff0c\u591a\u6d17\u4e00\u4e0b\u8138\uff0c\u6ca1\u51c6\u5c31\u8fc7\u4e86\u3002\n\n\u4e0d\u8fc7\u6211\u5728 darkbzoj \u8fd9\u9053\u9898\u8fc7\u5f97\u975e\u5e38\u7a33...\u4f46\u662f\u5495\u5495\u5c31\u6b7b\u5f97\u975e\u5e38\u60e8\n\n$Code:$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std ;\n#define Next( i, x ) for( register int i = head[x]; i; i = e[i].next )\n#define rep( i, s, t ) for( register int i = (s); i <= (t); ++ i )\n#define drep( i, s, t ) for( register int i = (t); i >= (s); -- i )\n#define re register\n#define int __int128\nint gi() {\n\tchar cc = getchar() ; int cn = 0, flus = 1 ;\n\twhile( cc < '0' || cc > '9' ) {  if( cc == '-' ) flus = - flus ; cc = getchar() ; }\n\twhile( cc >= '0' && cc <= '9' )  cn = cn * 10 + cc - '0', cc = getchar() ;\n\treturn cn * flus ;\n}\nconst int M = 3000 + 5 ; \nconst int P = 1e9 + 7 ;\nint n, fx, fy, fc, maxn, top, cnt, num, tp[M], st[M], w[M], fac[M], inv[M], B[M], f[M] ; \nint mul( int a, int b, int p ) {\n\treturn a * b % p ; \n}\nint fpow( int x, int k, int p ) {\n\tint ans = 1, base = x ; \n\twhile(k) {\n\t\tif(k & 1) ans = mul(ans, base, p) ;\n\t\tbase = mul(base, base, p), k >>= 1 ; \n\t} return ans ; \n}\nint sw( int x ) { return ( ( 1ll * rand() << 16ll ) | rand() ) % x + 1 ; }\nbool M_R( int p ) {\n\tif( p == 2 || p == 3 ) return 1 ; \n\tif( p == 1 || ( p % 2 == 0 ) ) return 0 ; \n\tre int d = p - 1, s = 0 ; while( !( d & 1 ) ) ++ s, d >>= 1 ; \n\trep( i, 0, 5 ) {\n\t\tre int a = sw( p - 3 ) + 2 ; \n\t\tre int x = fpow( a, d, p ), y = 0 ;\n\t\tfor( register int j = 0; j < s; ++ j ) {\n\t\t\ty = mul( x, x, p ) ; if( y == 1 && ( x != 1 ) && x != ( p - 1 ) ) return 0 ;\n\t\t\tx = y ;\n\t\t} if( y != 1 ) return 0 ;\n\t} return 1 ; \n}\nint gcd( int x, int y ) {\n\treturn ( x == 0 ) ? y : gcd( y % x, x ) ;\n}\nint work( int p ) {\n\tre int k = 2, x = sw(p - 1), y = x, d = 1, c = sw(99997) ;\n\tfor( re int i = 1; d == 1; ++ i ) {\n\t\tx = ( mul( x, x, p ) + c ) % p ;\n\t\td = gcd( (x > y) ? x - y : y - x, p ) ;\n\t\tif( i == k ) y = x, k <<= 1 ; \n\t} return d ; \n}\nvoid Pollard_Rho(int p) {\n\tif( p == 1 ) return ; \n\tif( M_R(p) ) { st[++ top] = p; return ; }\n\tint x = p ; while( x == p ) x = work(x) ;\n\tPollard_Rho(x), Pollard_Rho(p / x) ;\n}\nint g[M], gg[M], fg[M], fgg[M], fff[M] ; \nint c( int x, int y ) {\n\tif( x < y ) return 0 ;\n\treturn fac[x] * inv[y] % P * inv[x - y] % P ;  \n}\nsigned main()\n{\n\tsrand(time(NULL)) ;\n\tint T = gi() ; maxn = 3002 ; B[0] = 1, fac[0] = inv[0] = 1 ; \n\trep( i, 1, maxn ) fac[i] = fac[i - 1] * i % P, inv[i] = fpow( fac[i], P - 2, P ) ;\n\trep( i, 1, maxn ) {\n\t\tfor( re int j = 0; j < i; ++ j ) B[i] = ( B[i] - c(i + 1, j) * B[j] % P + P ) % P ; \n\t\tB[i] = B[i] * fpow( i + 1, P - 2, P ) % P, ++ B[i] ;  \n\t}\n\twhile( T-- ) {\n\t\tn = gi(), fx = gi(), fy = gi() ; int k = fy ; top = 0 ; \n\t\tfor( re int i = 0; i <= k; ++ i ) f[k - i + 1] = B[i] * c(k + 1, i) % P * fpow( k + 1, P - 2, P ) % P ; \n\t\tPollard_Rho(n), sort(st + 1, st + top + 1) ; cnt = 0 ; \n\t\trep( i, 1, top ) {\n\t\t\tif( st[i] != st[i - 1] ) tp[++ cnt] = st[i] ; \n\t\t\t++ w[cnt] ; \n\t\t} int Ans = 0 ; \n\t\trep( j, 1, cnt ) fg[j] = fpow( tp[j], fx, P ), fff[j] = fpow(tp[j], fy, P) ; \n\t\tfor( re int ic = 0; ic <= k + 1; ++ ic ) {\n\t\t\tint ans = 1 ;\n\t\t\tfor( re int j = 1; j <= cnt; ++ j ) {\n\t\t\t\tint tk = w[j], qwq = 0, de = 0 ; \n\t\t\t\tg[0] = 1, gg[0] = 1 ; fgg[j] = ( !ic ) ? 1 : fgg[j] * tp[j] % P ;  \n\t\t\t\tint dg = fg[j], dgg = fgg[j] ; \n\t\t\t\tfor( re int o = 1; o <= w[j]; ++ o ) \n\t\t\t\t\tg[o] = g[o - 1] * dg % P, gg[o] = gg[o - 1] * dgg % P ; \n\t\t\t\tfor( re int o = 0; o <= w[j]; ++ o )\n\t\t\t\t\tqwq = ( qwq + g[o] * gg[(w[j] - o)] % P ) % P ; \n\t\t\t\tfor( re int o = 0; o < w[j]; ++ o ) \n\t\t\t\t\tde = ( de + g[o] * gg[(w[j] - o - 1)] % P ) % P ; \n\t\t\t\tans = ans * ( qwq - de * fff[j] % P + P ) % P ; \n\t\t\t}\n\t\t\tAns = ( Ans + ans * f[ic] % P + P ) % P ; \n\t\t} rep( i, 1, cnt ) w[i] = tp[i] = 0 ;  \n\t\tcout << (long long)(Ans * fpow( n, fy, P ) % P) << endl ; \n\t}\n\treturn 0 ;\n}\n```",
        "postTime": 1593397949,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4464 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]JZPKIL\u3011"
    },
    {
        "content": "\u8fd9\u662f\u4e00\u9053\u6bd2\u7624\u9898\n\n\u9700\u8981\u6c42\u7684\u662f\n\n$$\\sum_{i=1}^n(i,n)^x[i,n]^y$$\n\n\u7531 $xy=(x,y)[x,y]$\n\n$$\\sum_{i=1}^n(i,n)^{x-y}i^yn^y$$\n\n$n^y$ \u662f\u5e38\u6570\uff0c\u5148\u4e0d\u8003\u8651\n\n$$\\sum_{i=1}^n(i,n)^{x-y}i^y$$\n\n\u679a\u4e3e $\\gcd$\n\n$$\\sum_{d|n}d^{x-y}\\sum_{i=1}^{\\frac nd}[(id,n)=d](id)^y$$\n\n\u628a $d^y$ \u63d0\u51fa\uff0c\u987a\u4fbf\u5957\u4e0a M\u00f6bius \u53cd\u6f14\u516c\u5f0f\n\n$$\\sum_{d|n}d^x\\sum_{i=1}^{\\frac nd}[\\left(i,\\frac nd\\right)=1]i^y$$\n\n$$\\sum_{d|n}d^x\\sum_{i=1}^{\\frac nd}\\sum_{e|\\left(i, \\frac nd\\right)}\\mu(e)i^y$$\n\n\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\n\n$$\\sum_{d|n}d^x\\sum_{e|\\frac nd}\\mu(e)\\sum_{i=1}^{\\frac n{de}}(ie)^y$$\n\n\u5c06 $e^y$ \u63d0\u51fa\n\n$$\\sum_{d|n}d^x\\sum_{e|\\frac nd}\\mu(e)e^y\\sum_{i=1}^{\\frac n{de}}i^y$$\n\n\u4f17\u6240\u5468\u77e5\uff0c\u81ea\u7136\u6570 $k$ \u6b21\u5e42\u548c\u662f $k+1$ \u6b21\u591a\u9879\u5f0f\n\n\u5047\u8bbe\u5df2\u7ecf\u6c42\u51fa\u4e86\u8fd9\u4e2a\u591a\u9879\u5f0f\u7684\u7cfb\u6570 $t_i$\n\n$$\\sum_{i=1}^ni^k=\\sum_{i=0}^{k+1}t_in^i$$\n\n\u8fdb\u4e00\u6b65\u5316\u7b80\n\n$$\\sum_{d|n}d^x\\sum_{e|\\frac nd}\\mu(e)e^y\\sum_{i=0}^{y+1}t_i\\left(\\frac n{de}\\right)^i$$\n\n\u518d\u4e00\u6b21\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\n\n$$\\sum_{i=0}^{y+1}t_i\\sum_{d|n}d^x\\sum_{e|\\frac nd}\\mu(e)e^y\\left(\\frac n{de}\\right)^i$$\n\n\u540e\u9762\u76f8\u5f53\u4e8e\u4e09\u4e2a\u79ef\u6027\u51fd\u6570\u7684\u72c4\u5229\u514b\u96f7\u5377\u79ef\n\n$$F(n)=n^x, G(n)=\\mu(n)n^y, H(n)=n^i, Z(n)=(F*G*H)(n)$$\n\n\u90a3\u4e48\u5377\u79ef\u540e\u7684\u8fd8\u662f\u79ef\u6027\u51fd\u6570\n\n\u4e8e\u662f\u5c06 $n$ \u5206\u89e3\u8d28\u56e0\u6570(\u4f7f\u7528 Pollard-Rho \u7b97\u6cd5)\n\n\u73b0\u5728\u53ea\u9700\u8981\u8ba1\u7b97 $Z(p^k)$\n\n\u7531 M\u00f6bius \u51fd\u6570\u6027\u8d28\uff0c\u53d1\u73b0\u53ea\u6709 $e=1$ \u6216 $e=p$ \u65f6\u6709\u610f\u4e49\n\n\u679a\u4e3e $d=p^q(0\\leq q\\leq k)$\n\n(1) $e=1$\n\n\u7b54\u6848\u4e3a $$\\sum_{q=0}^kp^{qx}\\times p^{(k-q)i}$$\n\n(2) $e=p$\n\n\u7b54\u6848\u4e3a $$-\\sum_{q=0}^{k-1}p^{qx}\\times p^y\\times p^{(k-q-1)i}$$\n\n\u5f97\u5230\u4e86 $Z(p^k)$ \u7684\u503c\u4e4b\u540e\uff0c\u7531\u79ef\u6027\u51fd\u6570\u6027\u8d28\u53ef\u4ee5\u5f97\u5230 $Z(n)$\n\n\u6574\u4e2a\u95ee\u9898\u5373\u53ef\u89e3\u51b3\n\n\u521a\u624d\u8fd8\u9057\u7559\u4e00\u4e2a\u95ee\u9898\uff0c\u81ea\u7136\u6570 $k$ \u6b21\u5e42\u548c\u7684\u591a\u9879\u5f0f\u600e\u4e48\u6c42\uff1f\n\n\u8fd9\u662f\u4e00\u4e2a\u7ecf\u5178\u95ee\u9898\uff0c\u53ef\u4ee5\u901a\u8fc7\u65af\u7279\u6797\u6570\uff0c\u4f2f\u52aa\u5229\u6570\uff0c\u5dee\u5206\uff0c\u62c9\u683c\u6717\u65e5\u63d2\u503c\u7b49\u65b9\u6cd5\u6c42\u5f97\uff08\u6211\u7528\u7684\u662f\u4f2f\u52aa\u5229\u6570\uff09\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <iostream>\n#include <algorithm>\n#include <unordered_map>\n\nconst int N = 3005;\nconst int mod = 1E9 + 7;\nusing LL = long long;\nusing LD = long double;\nint tc, factor[N], ifactor[N], B[N], t[N], x, y;\nLL n;\nstd::unordered_map<LL, int> divisor;\ninline int pow(int x, int y, int ans = 1) {\n\tfor (; y; y >>= 1, x = static_cast<LL> (x) * x % mod)\n\t\tif (y & 1) ans = static_cast<LL> (ans) * x % mod;\n\treturn ans;\n}\ninline void reduce(int &x) { x += x >> 31 & mod; }\ninline void get_Factor(int R) {\n\tfactor[0] = 1;\n\tfor (int i = 1; i <= R; ++i)\n\t\tfactor[i] = static_cast<LL> (factor[i - 1]) * i % mod;\n\tifactor[R] = pow(factor[R], mod - 2);\n\tfor (int i = R - 1; ~i; --i)\n\t\tifactor[i] = static_cast<LL> (ifactor[i + 1]) * (i + 1) % mod;\n}\ninline int C(int x, int y) {\n\treturn static_cast<LL> (factor[x]) * ifactor[y] % mod * ifactor[x - y] % mod;\n}\ninline void get_Bernoulli(int R) {\n\tB[0] = 1;\n\tfor (int i = 1; i <= R; ++i) {\n\t\tint sum = 0;\n\t\tfor (int j = 0; j < i; ++j)\n\t\t\treduce(sum -= static_cast<LL> (C(i + 1, j)) * B[j] % mod);\n\t\tB[i] = pow(i + 1, mod - 2, sum);\n\t}\n}\ninline LL mul(LL x, LL y, LL mod) {\n#ifdef ONLINE_JUDGE\n\treturn static_cast<__int128> (x) * y % mod;\n#else\n\tLL ret = (x * y - static_cast<LL> (static_cast<LD> (x) * y / mod + 0.5) * mod) % mod;\n\treturn ret + (ret >> 63 & mod);\n#endif\n}\ninline LL powmod(LL x, LL y, LL mod, LL ans = 1) {\n\tfor (; y; y >>= 1, x = mul(x, x, mod))\n\t\tif (y & 1) ans = mul(ans, x, mod);\n\treturn ans;\n}\nconst int primes[] = { 2, 3, 5, 7, 11, 13, 23, 31 };\ninline bool prime_test(LL n) {\n\tLL e = n - 1 >> __builtin_ctz(n - 1); \n\tfor (int p : primes) if (p < n) {\n\t\tfor (LL d = e, lst = powmod(p, d, n), now; d != n - 1; d <<= 1, lst = now) {\n\t\t\tnow = mul(lst, lst, n);\n\t\t\tif (lst != 1 && lst != n - 1 && now == 1) return false;\n\t\t}\n\t\tif (powmod(p, n - 1, n) != 1) return false;\n\t}\n\treturn true;\n}\ninline void get_Poly(int R) {\n\tt[0] = 0;\n\tfor (int i = 0; i <= R; ++i)\n\t\tt[R + 1 - i] = static_cast<LL> (C(R + 1, i)) * B[i] % mod;\n\tfor (int i = 0; i <= R + 1; ++i)\n\t\tt[i] = pow(R + 1, mod - 2, t[i]);\n\tif (R) ++t[R];\n}\ninline void pollard_rho(LL n) {\n\tif (n == 1) return;\n\tif (prime_test(n)) { ++divisor[n]; return; }\n\tfor (; ; ) {\n\t\tint c = std::rand(), k = 1, i = 0;\n\t\tLL x = std::rand(), y = x;\n\t\tfor (; ; ) {\n\t\t\tx = mul(x, x, n) + c;\n\t\t\tLL d = std::__gcd(n, std::abs(x - y));\n\t\t\tif (d > 1 && d < n) { pollard_rho(d), pollard_rho(n / d); return; }\n\t\t\tif (x == y) break;\n\t\t\tif (++i == k) k <<= 1, y = x;\n\t\t}\n\t}\n}\ninline int G(int i, int p, int k) {\n\tint ans = 0;\n\tfor (int q = 0; q <= k; ++q)\n\t\treduce(ans += pow(p, (static_cast<LL> (q) * x + static_cast<LL> (k - q) * i) % (mod - 1)) - mod);\n\tfor (int q = 0; q < k; ++q)\n\t\treduce(ans -= pow(p, (static_cast<LL> (q) * x + y + static_cast<LL> (k - q - 1) * i) % (mod - 1)));\n\treturn ans;\n}\ninline int solve(LL n, int x, int y) {\n\tdivisor.clear(), pollard_rho(n), get_Poly(y);\n\tint ans = 0;\n\tfor (int i = 0; i <= y + 1; ++i) {\n\t\tint p = t[i];\n\t\tfor (auto pk : divisor)\n\t\t\tp = static_cast<LL> (p) * G(i, pk.first % mod, pk.second) % mod;\n\t\treduce(ans += static_cast<LL> (p) % mod - mod);\n\t}\n\tans = static_cast<LL> (ans) * pow(n % mod, y) % mod;\n\treturn ans;\n}\nint main() {\n\tstd::ios::sync_with_stdio(0), std::cin.tie(0);\n\tget_Factor(3001);\n\tget_Bernoulli(3001);\n\tstd::cin >> tc;\n\twhile (tc--)\n\t\tstd::cin >> n >> x >> y, std::cout << solve(n, x, y) << '\\n';\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1546407772,
        "uid": 26127,
        "name": "Weng_Weijie",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4464 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]JZPKIL\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u591a\u6d4b\uff0c\u6c42 \n\n$$\\sum_{i=1}^n\\gcd(i,n)^x\\text{lcm}(i,n)^y\\bmod(10^9+7)$$\n\n$0\\le x,y\\le 3000,1\\le n\\le10^{18},T\\le100$\n\n\u9ed8\u8ba4 $x/y\\rightarrow\\lfloor\\frac{x}{y}\\rfloor$\n\n$$LHS=n^y\\sum_{i=1}^n\\gcd(i,n)^{x-y}i^y$$\n\n$$n^y\\sum_{d|n}d^{x-y}\\sum_{i=1}^n[\\gcd(i,n)=d]i^y$$\n\n$$n^y\\sum_{d|n}d^{x-y}\\sum_{i=1}^{n/d}[\\gcd(i,n/d)=1]i^y$$\n\n$$n^y\\sum_{d|n}d^{x-y}t(\\frac n d)$$\n\n$$t(n)=\\sum_{i=1}^n[\\gcd(i,n)=1]i^y$$\n\n$$=\\sum_{i=1}^n\\sum_{k|i}\\sum_{k|n}\\mu(k)i^y$$\n\n$$=\\sum_{k|n}k^y\\mu(k)\\sum_{i=1}^{n/k}i^y$$\n\n\u81ea\u7136\u6570\u5e42\u548c\u4f60\u77e5\u9053\u662f\u4e00\u4e2a\u591a\u9879\u5f0f\uff0c\u4e8e\u662f\u8bbe $\\sum_{i=1}^ni^y=\\sum_{i=0}^{y+1}a_in^i$\n\n$$t(n)=\\sum_{k|n}k^y\\mu(k)\\sum_{i=0}^{y+1}a_i(n/k)^i$$\n\n$$=\\sum_{i=0}^{y+1}a_i\\sum_{k|n}k^y\\mu(k)(n/k)^i$$\n\n$$LHS=n^y\\sum_{d|n}d^{x-y}\\sum_{i=0}^{y+1}a_i\\sum_{k|(n/d)}k^y\\mu(k)((n/d)/k)^i$$\n\n$$=n^y\\sum_{i=0}^{y+1}a_i\\sum_{d|n}d^{x-y}\\sum_{k|(n/d)}k^y\\mu(k)((n/d)/k)^i$$\n\n\u63e1\u8349\uff0c\u5377\u738b\uff01\n\n\u4f60\u53d1\u73b0\u540e\u9762\u8fd9\u4e00\u5768\u4e1c\u897f\u5176\u5b9e\u662f\u7531 $f(n)=\\sum_{d|n}d^{x-y},g(n)=\\sum_{d|n}\\mu(d)d^y,h(n)=\\sum_{d|n}d^i$ \u4e09\u4e2a\u4e1c\u897f\u5377\u6210\u3002\n\n\u8fd9\u8fd8\u662f\u5341\u5206 $\\texttt{myee}$ \u7684\uff0c\u7136\u540e\u5c31\u5927\u6982\u5bf9\u4e8e\u6bcf\u79cd\u56e0\u5b50\uff0c\u679a\u4e3e\u6b21\u6570\uff0c\u7136\u540e\u8fdb\u884c\u8ba1\u7b97\u3002\n\n\u590d\u6742\u5ea6\u5de8\u5927\u591a\u4e0d\u53ef\u7b97\uff0c\u5148\u5634\u7740\uff0c\u5230\u65f6\u5019\u5199\u5199\u770b\u770b\u662f $O(\\text{\u80fd\u8fc7})$ \u8fd8\u662f $O(\\text{\u4e0d\u80fd\u8fc7})$\u3002\n\n\u5199\u4e86\uff0c\u662f $O(\\text{\u80fd\u8fc7})$\u3002\n\n\u5bf9\u4e8e\u6bcf\u79cd\u56e0\u5b50 $\\alpha$\uff0c\u5047\u8bbe\u5b83\u7684\u6b21\u6570\u662f $\\beta$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4e1c\u897f\u662f\n\n$$LHS=n^y\\sum_{i=0}^{y+1}a_i\\sum_{a+b+c=\\beta}f(\\alpha^a)g(\\alpha^b)h(\\alpha^c)$$\n\n\u8fd9\u4e2a\u4e1c\u897f\u4e2d\u95f4\u6709\u4e00\u4e2a $\\mu$\uff0c\u8981\u8003\u8651\u5229\u7528\u597d\u5b83\uff0c\u5206\u4e24\u7c7b\u8ba8\u8bba\u540e\u505a\u5373\u53ef\uff0c\u601d\u8003\u7559\u7ed9\u8bfb\u8005\u3002\n\n\u5e38\u6570\u8f83\u5c0f\uff0c\u53ef\u80fd\u662f\u7528\u4e86[\u8fd9\u4e2a](https://www.luogu.com.cn/blog/Peterprpr/mu-ban)\u91cc\u9762\u7684 Pollard-rho \u677f\u5b50\u3002\n```cpp\ncmll02\u4e0d\u8981\u6293\u6211\u8f66/fn/fn/fn\n#define maxn 3050\ntypedef long long i64;\nconst int p=1e9+7;\ntemplate<class _Tp,class _tp>void add(_Tp&x,const _tp& y){((x+=y)>=p)&&(x-=p);}template<class _Tp,class _tp>_Tp Add(_Tp x,const _tp y){add(x,y);return x;}\ntemplate<class _Tp,class _tp>void sub(_Tp&x,const _tp&y){((x-=y)<0)&&(x+=p);}template<class _Tp,class _tp>_Tp Sub(_Tp x,const _tp y){sub(x,y);return x;}\ntemplate<class _Tp,class _tp>void mul(_Tp&x,const _tp&y){x=1ll*x*y%p;}template<class _Tp,class _tp>_Tp Mul(const _Tp x,const _tp y){return 1ll*x*y%p;}\ntemplate<class _Tp,class _tp>_Tp ksm(_Tp a,_tp b){_Tp ans(1);for(;b;b>>=1,mul(a,a))if(b&1)mul(ans,a);return ans;} \ntemplate<class _Tp>_Tp div2(_Tp a){if(a&1)a+=p;return a>>1;}\nint B[maxn],C[maxn][maxn],inv[maxn],c[maxn];\nvoid shai(int n){\n  rep(i,0,n){\n    C[i][0]=C[i][i]=1;\n    rep(j,1,i-1)C[i][j]=Add(C[i-1][j],C[i-1][j-1]);\n  }\n  inv[1]=1;\n  rep(i,2,n)inv[i]=Mul(p-p/i,inv[p%i]);\n  B[0]=1;\n  rep(i,1,n){\n    rep(j,0,i-1)add(B[i],Mul(B[j],C[i+1][j]));\n    mul(B[i],p-inv[i+1]);\n  }\n  B[1]++;\n}\nnamespace rho{//https://blog.csdn.net/baiyifeifei/article/details/88074495\n    const int MAXP = 1000010;\n    const int BASE[] = {2,325,9375,28178,450775,9780504,1795265022};\n\n    long long seq[MAXP];\n    int primes[MAXP], spf[MAXP];\n\n\n    long long gcd(long long a, long long b) {\n        int ret = 0;\n        while(a) {\n            for( ; !(a & 1) && !(b & 1); ++ret, a >>= 1, b >>= 1);\n            for( ; !(a & 1); a >>= 1);\n            for( ; !(b & 1); b >>= 1);\n            if(a < b) swap(a, b);\n            a -= b;\n        }\n        return b << ret;\n    }\n\n    inline long long mod_add(long long x, long long y, long long m){\n        return (x += y) < m ? x : x - m;\n    }\n\n    inline long long mod_mul(long long x, long long y, long long m){\n        long long res = x * y - (long long)((long double)x * y / m + 0.5) * m;\n        return res < 0 ? res + m : res;\n    }\n\n    inline long long mod_pow(long long x, long long n, long long m){\n        long long res = 1 % m;\n        for (; n; n >>= 1){\n            if (n & 1) res = mod_mul(res, x, m);\n            x = mod_mul(x, x, m);\n        }\n\n        return res;\n    }\n\n    inline bool miller_rabin(long long n){\n        if (n <= 2 || (n & 1 ^ 1)) return (n == 2);\n        if (n < MAXP) return spf[n] == n;\n\n        long long c, d, s = 0, r = n - 1;\n        for (; !(r & 1); r >>= 1, s++) {}\n\n        for (int i = 0; primes[i] < n && primes[i] < 38; i++){\n            c = mod_pow(primes[i], r, n);\n            for (int j = 0; j < s; j++){\n                d = mod_mul(c, c, n);\n                if (d == 1 && c != 1 && c != (n - 1)) return false;\n                c = d;\n            }\n\n            if (c != 1) return false;\n        }\n        return true;\n    }\n\n    inline void init(){\n        int i, j, k, cnt = 0;\n\n        for (i = 2; i < MAXP; i++){\n            if (!spf[i]) primes[cnt++] = spf[i] = i;\n            for (j = 0, k; (k = i * primes[j]) < MAXP; j++){\n                spf[k] = primes[j];\n                if(spf[i] == spf[k]) break;\n            }\n        }\n    }\n\n    long long pollard_rho(long long n){\n        while (1){\n            long long x = rand() % n, y = x, c = rand() % n, u = 1, v, t = 0;\n            long long *px = seq, *py = seq;\n\n            while (1){\n                *py++ = y = mod_add(mod_mul(y, y, n), c, n);\n                *py++ = y = mod_add(mod_mul(y, y, n), c, n);\n                if((x = *px++) == y) break;\n\n                v = u;\n                u = mod_mul(u, abs(y - x), n);\n\n                if (!u) return gcd(v, n);\n                if (++t == 32){\n                    t = 0;\n                    if ((u = gcd(u, n)) > 1 && u < n) return u;\n                }\n            }\n\n            if (t && (u = gcd(u, n)) > 1 && u < n) return u;\n        }\n    }\n\n    vector <long long> factorize(long long n){\n        if (n == 1) return vector <long long>();\n        if (miller_rabin(n)) return vector<long long> {n};\n\n        vector <long long> v, w;\n        while (n > 1 && n < MAXP){\n            v.push_back(spf[n]);\n            n /= spf[n];\n        }\n\n        if (n >= MAXP) {\n            long long x = pollard_rho(n);\n            v = factorize(x);\n            w = factorize(n / x);\n            v.insert(v.end(), w.begin(), w.end());\n        }\n\n        sort(v.begin(), v.end());\n        return v;\n    }\n}\nint T,x,y;\ni64 n;\nvector<i64>a;\nmap<i64,int>b;\nint G(int a,int b,int o){\n  int ans=0;\n  int u=x-o;\n  if(u<0)u+=p-1;\n  int px_o=ksm(a,u);\n  int g=ksm(a,1ll*b*o%(p-1));\n  rep(j,0,b)add(ans,g),mul(g,px_o);\n  g=ksm(a,((b-1ll)*o+y)%(p-1));\n  rep(j,1,b)sub(ans,g),mul(g,px_o);\n  return ans;\n}\nsigned main(){\n  shai(3030);\n  rho::init();\n  for(cin>>T;T;T--){\n    cin>>n>>x>>y;\n    a=rho::factorize(n);\n    b.clear();\n    for(i64 i:a)b[i]++;\n    rep(i,0,y)c[y+1-i]=Mul(C[y+1][i],Mul(ksm(y+1,p-2),B[i]));\n    int ans=0;\n    rep(i,0,y+1){\n      int t=c[i];\n      for(pair<i64,int>g:b)mul(t,G(g.first%p,g.second,i));\n      add(ans,t);\n    }\n    cout<<Mul(ksm(int(n%p),y),ans)<<endl;\n  }\n}\n```\n\u5c0f G \u5de7\uff0c\u5982\u679c\u60f3\u628a $\\text{oi-wiki}$ \u4e0a\u7684 $\\sum_{i=0}^{n-1}i^k$ \u53d8\u6210 $\\sum_{i=0}^ni^k$ \u53ea\u9700\u8981\u628a $B_1$ \u81ea\u589e $1$ \u5373\u53ef\u3002\n\n\u5f69\u86cb\uff1a\u300a\u5634\u5df4\u662f\u5982\u4f55\u70bc\u6210\u7684\u300b\u3002\n\n\u6211\uff1a\u7b97\u51fa $\\sum_{i=0}^ni^k$ \u7684\u591a\u9879\u5f0f\u600e\u4e48\u529e\u554a\u3002\n\n$\\texttt{myee}$\uff1a\u76f4\u63a5\u4e0a\u4f2f\u52aa\u5229\u6570\u554a\u3002\n\n\u6211\uff1a\u4f60\u770b\u770b\u4f2f\u52aa\u5229\u6570\u516c\u5f0f\u597d\u4e0d\u597d\u3002\n\n$\\texttt{myee}$\uff08\u76ef\u7740\u770b\u4e86\u4e00\u4f1a\u513f\uff09\uff1a\u90a3\u4f60\u628a\u8fd9\u91cc\u9762\u6240\u6709\u7684\u8d1f\u53f7\u53d8\u6210\u6b63\u53f7\u3002\n\n\u6211\uff1a\u4e3a\u4ec0\u4e48\u662f\u5bf9\u7684\uff1f\n\n$\\texttt{myee}$\uff1a\u53ef\u4ee5\u8bc1\u660e\u3002\n\n\u6211\uff1a\u8bc1\u660e\u62ff\u6765\uff01\n\n$\\texttt{myee}$\uff1a\u6211\u8bd5\u8fc7\uff0c\u662f\u5bf9\u7684\u3002\n\n\u6211\uff1a\u3002\u3002\u3002\u90a3\u4e48\u4f60\u600e\u4e48\u77e5\u9053\u54ea\u4e9b\u662f\u8d1f\u53f7\uff1f\n\n$\\texttt{myee}$\uff08\u76ef\u7740\u770b\u4e86\u4e00\u4f1a\u513f\uff09\uff1a\u54e6\uff0c\u90a3\u4f60\u628a\u6240\u6709 $n+1$ \u9879\u4e8c\u9879\u5f0f\u5c55\u5f00\u3002\n\n\u6211\uff1a\u3002\u3002\u3002\u3002\u3002\u3002\n\n\u5173\u4e8e\u53ea\u9700\u628a $B_1$ \u81ea\u589e $1$ \u7684\u8bc1\u660e\uff1a\n\n$$\\sum_{i=0}^{n-1}i^m=\\frac 1{m+1}\\sum_{k=0}^m\\binom{m+1}kB_kn^{m+1-k}$$\n\n$$\\sum_{i=0}^{n}i^m=n^m+\\frac 1{m+1}\\sum_{k=0}^m\\binom{m+1}kB_kn^{m+1-k}$$\n\n$$\\frac 1{m+1}\\sum_{k=0}^m\\binom{m+1}k(B_k+[k=1])n^{m+1-k}$$",
        "postTime": 1638940867,
        "uid": 100325,
        "name": "peterwuyihong",
        "ccfLevel": 7,
        "title": "P4464 [\u56fd\u5bb6\u96c6\u8bad\u961f] JZPKIL \u8bb0\u5f55"
    },
    {
        "content": "\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14+\u4f2f\u52aa\u5229\u6570  \n\n$$n^y\\sum_{i=1}^n(i,n)^{x-y}i^y$$\n\n$$n^y\\sum_{d|n}^n\\sum_{i=1}^n[(i,n)==d]d^{x-y}i^y$$\n\n$$n^y\\sum_{d|n}^nd^x\\sum_{i=1}^{\\lfloor \\frac{n}{d}\\rfloor}[(i,\\frac{n}{d})==1]i^y$$\n\n$$n^y\\sum_{d|n}^nd^x\\sum_{i=1}^{\\lfloor \\frac{n}{d}\\rfloor}i^y\\sum_{k|(i,\\frac{n}{d})}\\mu(k)$$\n\n$$n^y\\sum_{d|n}d^x\\sum_{k|\\frac{n}{d}}\\mu(k)\\sum_{k|i}^{{\\lfloor \\frac{n}{d}\\rfloor}}i^y$$\n\n$$n^y\\sum_{d|n}d^x\\sum_{k|\\frac{n}{d}}\\mu(k)k^y\\sum_{i=1}^{{\\lfloor \\frac{n}{dk}\\rfloor}}i^y$$\n\n\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u5927\u6982\u5c31\u5230\u8fd9\u91cc\uff0c\u4e0b\u9762\u6211\u4eec\u66b4\u529b\u5e26\u5165\u4f2f\u52aa\u5229\u6570(\u63a5\u4e0b\u6765\u6240\u7528\u7684\u90fd\u662f\u6b63\u4f2f\u52aa\u5229\u6570)\uff0c\u5148\u7ed9\u51fa\u4f2f\u52aa\u5229\u6570\u516c\u5f0f\n\n$$\\sum_{i=1}^ni^m=\\frac{1}{m+1}\\sum_{k=0}^mC_{m+1}^kB_kn^{m-k+1}$$\n\n$B_k$\u8868\u793a\u7b2ck\u4e2a\u6b63\u4f2f\u52aa\u5229\u6570\n\n\u4e3a\u4e86\u65b9\u4fbf\u63a5\u4e0b\u6765\u7684\u63a8\u5bfc\uff0c\u6211\u4eec\u4ee4\n\n$$t_k=\\frac{1}{m+1}C_{m+1}^kB_k$$\n\n$$\\sum_{i=1}^ni^m=\\sum_{k=0}^mt_kn^{m-k+1}$$\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u56de\u5230\u63a8\u5bfc\u5f0f\uff0c\u5e26\u5165\u4f2f\u52aa\u5229\u6570\n\n$$n^y\\sum_{d|n}d^x\\sum_{k|\\frac{n}{d}}\\mu(k)k^y\\sum_{i=0}^yt_i({\\frac{n}{dk}})^{y-i+1}$$\n\n$$\\sum_{i=0}^yt_in^y\\sum_{d|n}d^x\\sum_{k|\\frac{n}{d}}\\mu(k)k^y({\\frac{n}{dk}})^{y-i+1}$$\n\n\u540e\u9762\u662f\u4e00\u4e2a\u79ef\u6027\u51fd\u6570\uff0c\u6211\u4eec\u8003\u8651\u628an\u552f\u4e00\u5206\u89e3\n\n$$p_s^{y}\\sum_{d|p_s}d^x\\sum_{k|\\frac{p_s}{d}}\\mu(k)k^y(\\frac{p_s}{dk})^{y-i+1}$$\n\n$$p_s^{y}\\sum_{d|p_s}d^x((\\frac{p_s}{d})^{y-i+1}-p^y(\\frac{p_s}{dp})^{y-i+1})$$\n\n\u7136\u540e\u5c31ok\u4e86\uff0c\u8d34\u4e00\u4efd\u4ee3\u7801\uff0c\u5176\u5b9e\u7b2c\u4e09\u4e2a\u5faa\u73af\u4e2d\u7684ksm\u53ef\u4ee5\u5168\u90e8\u79fb\u51fa\u8fdb\u884c\u4f18\u5316\uff0c\u53ef\u4ee5\u5c11\u6389\u4e00\u4e2alog\u7684\u590d\u6742\u5ea6\n\n```cpp\n#include<iostream>\n#include<iomanip>\n#include<cstring>\n#include<cmath>\n#include<cstdio>\n#include<queue>\n#include<algorithm>\n#include<ctime>\nusing namespace std;\nconst int maxn=3002;\nconst int mod=1e9+7;\nint tot,num;\nlong long a[105],c[3005][3005],b[3005],vs[3005];\nstruct que\n{\n\tlong long p,v,vs;\n\tint sum;\n}e[105];\nlong long mul(long long x,long long y,long long z)\n{\n\treturn (x*y-(long long)(((long double)x/z*y+0.5))*z+z)%z;\n}\nlong long gcd(long long x,long long y)\n{\n\tif(!y) return x;\n\treturn gcd(y,x%y);\n}\nlong long KSM(long long x,long long n,long long mod)\n{\n\tlong long ans=1;\n\twhile(n)\n\t{\n\t\tif(n&1) ans=mul(ans,x,mod);\n\t\tx=mul(x,x,mod);\n\t\tn>>=1;\n\t}\n\treturn ans;\n}\nlong long ksm(long long x,long long n)\n{\n\tx%=mod;\n\tlong long ans=1;\n\twhile(n)\n\t{\n\t\tif(n&1) ans=ans*x%mod;\n\t\tx=x*x%mod;\n\t\tn>>=1;\n\t}\n\treturn ans;\n}\nbool miller_rabin(long long n)\n{\n\tif(n==2) return 1;\n\tif(n<2||(!(n&1))) return 0;\n\tlong long m=n-1;\n\tint t=5,k=0;\n\twhile(!(m&1)) k++,m>>=1;\n\twhile(t--)\n\t{\n\t\tlong long a=rand()%(n-1)+1;\n\t\tlong long x=KSM(a,m,n);\n\t\tlong long y=0;\n\t\tfor(int i=1;i<=k;i++)\n\t\t{\n\t\t\ty=mul(x,x,n);\n\t\t\tif(y==1&&x!=1&&x!=n-1) return false;\n\t\t\tx=y;\n\t\t}\n\t\tif(y!=1) return false;\n\t}\n\treturn true;\n}\nlong long Find(long long n,int c)\n{\n\tlong long x,y,d,i=1,k=2;\n\tx=y=rand()%(n-1)+1;\n\twhile(1)\n\t{\n\t\ti++;\n\t\tx=(mul(x,x,n)+c)%n;\n\t\td=gcd((y-x+n)%n,n);\n\t\tif(d>1&&d<n) return d;\n\t\tif(y==x) return n;\n\t\tif(i==k) y=x,k<<=1;\n\t}\n}\nvoid FindFir(long long n,int k)\n{\n\tif(n<=1) return ;\n\tif(!(n&1))\n\t{\n\t\ta[++tot]=2;\n\t\tFindFir(n/2,k);\n\t\treturn ;\n\t}\n\tif(miller_rabin(n))\n\t{\n\t\ta[++tot]=n;\n\t\treturn ;\n\t}\n\tlong long d=n;\n\twhile(d>=n) d=Find(n,k--);\n\tFindFir(d,k),FindFir(n/d,k);\n}\nvoid pre()\n{\n\tc[0][0]=1;\n\tfor(int i=1;i<=maxn;i++)\n\t{\n\t\tc[i][0]=1;\n\t\tfor(int j=1;j<=i;j++) c[i][j]=(c[i-1][j]+c[i-1][j-1])%mod;\n\t}\n\tb[0]=1;\n\tfor(int i=1;i<=maxn;i++)\n\t{\n\t\tlong long sum=0;\n\t\tfor(int j=0;j<i;j++) sum=(sum+c[i+1][j]*b[j]%mod)%mod;\n\t\tb[i]=-sum*ksm(c[i+1][i],mod-2)%mod;\n\t}\n\tb[1]=mod-b[1];\n}\nint main()\n{\n\tsrand(time(NULL));\n\tpre();\n\tint t;\n\tscanf(\"%d\",&t);\n\twhile(t--)\n\t{\n\t\ttot=0,num=0;\n\t\tlong long n,x,y;\n\t\tscanf(\"%lld%lld%lld\",&n,&x,&y);\n\t\tFindFir(n,100007);\n\t\tsort(a+1,a+tot+1);\n\t\tfor(int i=1;i<=tot;i++)\n\t\t{\n\t\t\tif(a[i]==a[i-1]) e[num].v*=a[i],e[num].sum++;\n\t\t\telse num++,e[num].v=e[num].p=a[i],e[num].sum=1;\n\t\t}\n\t\tfor(int i=1;i<=num;i++) vs[i]=ksm(e[i].v,y),e[i].vs=ksm(e[i].p,y);\n\t\tlong long ans=0;\n\t\tfor(int k=0;k<=y;k++)\n\t\t{\n\t\t\tlong long ti=ksm(y+1,mod-2)*c[y+1][k]%mod*b[k]%mod;\n\t\t\tlong long v=1;\n\t\t\tfor(int i=1;i<=num;i++)\n\t\t\t{\n\t\t\t\tlong long sum=0;\n\t\t\t\tfor(long long d=1,ss=0;ss<=e[i].sum;d*=e[i].p,ss++) sum+=ksm(d,x)*(ksm(e[i].v/d,y-k+1)-e[i].vs*ksm(e[i].v/d/e[i].p,y-k+1)%mod)%mod,sum%=mod;\n\t\t\t\tsum=vs[i]*sum%mod;\n\t\t\t\tv=v*sum%mod;\n\t\t\t}\n\t\t\tans=(ans+(ti*v%mod))%mod;\n\t\t}\n\t\tprintf(\"%lld\\n\",(ans%mod+mod)%mod);\n\t}\n}\n```",
        "postTime": 1565440361,
        "uid": 78488,
        "name": "b2019dy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4464 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]JZPKIL\u3011"
    },
    {
        "content": "\u5982\u679c\u4e0d\u77e5\u9053\u4f2f\u52aa\u5229\u6570\u7684[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/blog/chihik/bo-nu-li-shu)\u3002\n\n$$\n\\sum_{i=1}^n (i,n)^x[i,n]^y\n$$\n\n$$\n\\sum_{i=1}^n (i,n)^{x-y} \\times i^y \\times n^y\n$$\n\n$$\nn^y \\sum_{d|n} d ^{x-y} \\sum_{i=1}^n [(i,n)=d] i^y\n$$\n\n$$\nn^y \\sum_{d|n} d ^{x} \\sum_{i=1}^{\\lfloor \\frac{n}{d} \\rfloor} [(i,\\frac{n}{d})=1] i^y\n$$\n\n$$\nn^y \\sum_{d|n} d ^{x} \\sum_{i=1}^{\\lfloor \\frac{n}{d} \\rfloor} \\sum_{s|(i,\\frac{n}{d})}\\mu(s)i^y\n$$\n\n$$\nn^y \\sum_{d|n} d ^{x} \\sum_{s|\\frac{n}{d}}  \\mu(s) \\sum_{i=1}^{\\frac{n}{ds}}(is)^y\n$$\n\n$$\nn^y \\sum_{d|n} d ^{x} \\sum_{s|\\frac{n}{d}}  \\mu(s) s^y \\sum_{i=1}^{\\frac{n}{ds}}i^y\n$$\n\n\u8bbe $k_i$ \u4e3a $y$ \u6b21\u5e42\u5c55\u5f00\u540e $n^i$ \u7684\u7cfb\u6570\n\n\n$$\nn^y \\sum_{d|n} d ^{x} \\sum_{s|\\frac{n}{d}}  \\mu(s) s^y \\sum_{i=1}^{y+1} k_i (\\frac{n}{ds})^i\n$$\n\n$$\nn^y \\sum_{i=1}^{y+1} k_i\\sum_{d|n} d ^{x} \\sum_{s|\\frac{n}{d}}  \\mu(s) s^y  (\\frac{n}{ds})^i\n$$\n\n\u540e\u9762\u662f\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u8bb0\u4e3a $f(i)$\u3002\n\n\u8bb0 $f_1(n)=n^x,f_2(n)=\\mu(n)n^y,f_3(n)=n^i$\u3002\n\n\n\u90a3\u4e48 $f=f_1*f_2*f_3$ \uff0c\u4e5f\u4e3a\u4e00\u4e2a\u79ef\u6027\u51fd\u6570,\u8003\u8651\u6c42\u51fa $f(p^w)$ \u3002\n\n$s$ \u53ea\u6709\u7b49\u4e8e $1$ \u6216 $p$ \u65f6 $\\mu(s)\\not=0$,\n\n\u5f53 $s = 1$\n\n$$f(n)=\\sum_{d|n} d ^{x} \\sum_{s|\\frac{n}{d}}  \\mu(s) s^y  (\\frac{n}{ds})^i$$\n\n$$=n^i\\sum_{d|n} d ^{x-i}$$\n\n$$f(p^k)=p^{ki}\\sum_{d|p^k}d^{x-i}$$\n\n$$=p^{ki}\\sum_{j=0}^k p^{j(x-i)}$$\n\n\u5f53 $s=p$\n\n$$f(n)=\\sum_{d|n} d ^{x} \\sum_{s|\\frac{n}{d}}  \\mu(s) s^y  (\\frac{n}{ds})^i$$\n\n$$=\\sum_{d|n} d ^{x} \\mu(p) p^y  (\\frac{n}{dp})^i$$\n\n\n$$=-n^i\\sum_{d|n} d ^{x-i} p ^{y-i}$$\n\n$$f(p^k)=-p^{ki}\\sum_{d|p^k}d^{x-i}p ^{y-i}$$\n\n$$=-p^{ki}\\sum_{j=0}^{k-1} p^{j(x-i)}p ^{y-i}$$\n\n$$=-p^{ki+y-i}\\sum_{j=0}^{k-1} p^{j(x-i)}$$\n\n\u7136\u540e\u7528 $\\text{Pollard~rho}$ \u5206\u89e3\u8d28\u56e0\u6570\u540e\u8ba1\u7b97\u3002\n\n\u4f46\u8ba1\u7b97\u7b49\u6bd4\u6570\u5217\u548c\u65f6\u4e0d\u80fd\u7528\u516c\u5f0f\u7b97\uff0c\u4e5f\u4e0d\u80fd\u66b4\u529b\u7b97\uff08\u5177\u4f53\u770b\u4ee3\u7801\u6ce8\u91ca\uff09\u3002\n\n~~\u8fd9\u4efd\u5e38\u6570\u6781\u5927\u7684\u4ee3\u7801\u4e0d\u5f00o2\u4f1at\u3002~~\n\n```cpp\n#include <ctime>\n#include <cstdio>\n#include <cstdlib>\n#include <algorithm>\nusing namespace std;\n#define Lint __int128\n#define LL long long\n\ntemplate<typename _T>\nvoid Read( _T &x ) {\n\tx = 0; int f = 1;\n\tchar s = getchar( );\n\tfor( ; s < '0' || s > '9' ; s = getchar( ) ) f = s == '-' ? -f : f;\n\tfor( ; s >= '0' && s <= '9' ; s = getchar( ) ) x = x * 10 + s - '0';\n\tx *= f;\n}\ntemplate<typename _T>\nvoid Write( _T x ) {\n\tif( x < 0 ) putchar( '-' ) , x = -x;\n\tif( x >= 10 ) Write( x / 10 );\n\tputchar( x % 10 + '0' );\n}\n\nconst int MAXN = 3005 , Mod = 1e9 + 7;\nLL n;\nint t , x , y;\n\ntemplate<typename _T>\n_T Quick_pow( _T x , _T po , _T p = Mod ) {\n\t_T Ans = 1; bool f = 0;\n    if( po < 0 ) po = -po , f = 1;\n\twhile( po ) {\n\t\tif( po % 2 )\n\t\t\tAns = (Lint)Ans * x % p;\n\t\tx = (Lint)x * x % p;\n\t\tpo /= 2;\n\t}\n\treturn f ? Quick_pow( (int)Ans , Mod - 2 ) : Ans;\n}\ntemplate<typename _T>\n_T Gcd( _T x , _T y ) {\n\treturn y == 0 ? x : Gcd( y , x % y );\n}\ntemplate<typename _T>\n_T Abs( _T x ) {\n\treturn x >= 0 ? x : -x;\n}\ntemplate<typename _T>\n_T Inverse( _T x ) {\n    return Quick_pow( x , Mod - 2 );\n}\n\ntemplate<typename _T>\n_T f( _T x , _T a , _T Mod ) {\n\treturn ( (Lint)x * x + a ) % Mod;\n}\nLL Pollard_rho( LL n ) {\n\tLL r = rand( ) % ( n - 1 ) + 1;\n\tLL s = 0 , t = 0 , val , d;\n\tfor( int k = 1 ; k ; k <<= 1 ) {\n\t\tval = 1; s = t;\n\t\tfor( int i = 1 ; i <= k ; i ++ ) {\n\t\t\tt = f( t , r , n );\n\t\t\tval = (Lint)val * Abs( t - s ) % n;\n\t\t\tif( i % 127 == 0 && ( d = Gcd( val , n ) ) > 1 ) return d;\n\t\t}\n\t\tif( ( d = Gcd( val , n ) ) > 1 ) return d;\n\t}\n}\n\nint prinum = 12;\nLL prime[ 20 ] = { 0 , 2 , 3 , 5 , 7 , 11 , 13 , 17 , 19 , 23 , 29 , 31 , 37 };\nbool Miller_Rabin( LL x ) {\n\tif( x == 0 || x == 1 ) return 0;\n\tfor( int i = 1 ; i <= prinum ; i ++ ) {\n\t\tif( x == prime[ i ] ) return 1;\n\t\tif( x < prime[ i ]  ) return 0;\n\t\t\n\t\tLL s = Quick_pow( prime[ i ] , x - 1 , x ) , tmp = x - 1;\n\t\tif( s != 1 ) return 0; \n\t\twhile( s == 1 && tmp % 2 == 0 ) {\n\t\t\ttmp /= 2;\n\t\t\ts = Quick_pow( prime[ i ] , tmp , x );\n\t\t\tif( s != 1 && s != x - 1 ) return 0;\n\t\t}\n\t}\n\treturn 1;\n}\n\nint k; LL pi[ 100 ];\nvoid Divide( LL x ) {\n\tif( x == 1 ) return;\n\tif( Miller_Rabin( x ) ) {\n\t\tpi[ ++ k ] = x; return;\n\t}\n\tif( x == 4 ) {\n\t\tpi[ ++ k ] = 2 , pi[ ++ k ] = 2;\n\t\treturn;\n\t}\n\tLL p = x;\n\twhile( p == x ) p = Pollard_rho( x );\n\tDivide( p ) , Divide( x / p );\n} \n\nint Fac[ MAXN + 5 ] , Inv[ MAXN + 5 ];\nvoid Init_Fac( ) {\n    Fac[ 0 ] = 1;\n    for( int i = 1 ; i <= MAXN ; i ++ ) Fac[ i ] = 1ll * Fac[ i - 1 ] * i % Mod;\n    Inv[ MAXN ] = Inverse( Fac[ MAXN ] );\n    for( int i = MAXN ; i >= 1 ; i -- ) Inv[ i - 1 ] = 1ll * Inv[ i ] * i % Mod;\n}\nint C( int n , int m ) {\n    return 1ll * Fac[ n ] * Inv[ m ] % Mod * Inv[ n - m ] % Mod;\n}\n\nint Bernoulli[ MAXN + 5 ] , S[ MAXN + 5 ];\nvoid Init_Bernoulli( ) {\n    Bernoulli[ 0 ] = 1;\n    for( int i = 1 ; i <= MAXN ; i ++ ) {\n        int Sum = 0;\n        for( int j = 0 ; j < i ; j ++ )\n            Sum = ( Sum + 1ll * C( i + 1 , j ) * Bernoulli[ j ] % Mod ) % Mod;\n        Bernoulli[ i ] = ( -1ll * Sum * Inverse( C( i + 1 , i ) ) % Mod + Mod ) % Mod;\n    }Bernoulli[ 1 ] ++;\n}\n\nLL di[ MAXN + 5 ];\nint wi[ MAXN + 5 ];\n\n/*int Aq( int a , int q , int n ) {\n    if( q == 1 ) return 1ll * a * n % Mod;\n    return 1ll * a * ( 1 - Quick_pow( q , n ) + Mod ) % Mod * Inverse( 1 - q ) % Mod;\n}*/\nint F( int p , int w , int i ) {\n//\tint Ans = 0;\n//\tfor( int j = 0 ; j <= w ; j ++ ) Ans = ( Ans + Quick_pow( p , w * i + j * ( x - i ) ) ) % Mod;\n//\tfor( int j = 0 ; j <  w ; j ++ ) Ans = ( Ans - Quick_pow( p , w * i + y - i + j * ( x - i ) ) ) % Mod;\n//\treturn ( Ans + Mod ) % Mod;\n\n//\treturn ( ( Aq( Quick_pow( p , w * i ) , Quick_pow( p , x - i ) , w + 1 ) - Aq( Quick_pow( p , w * i + y - i ) , Quick_pow( p , x - i ) , w ) ) % Mod + Mod ) % Mod;\n\n\tint Ans = 0 , a , q = Quick_pow( p , x - i );\n\ta = Quick_pow( p , w * i );\n\tfor( int j = 0 ; j <= w ; j ++ ) Ans = ( Ans + a ) % Mod , a = 1ll * a * q % Mod; \n\ta = Quick_pow( p , w * i + y - i );\n\tfor( int j = 0 ; j <  w ; j ++ ) Ans = ( Ans - a ) % Mod , a = 1ll * a * q % Mod; \n\treturn ( Ans + Mod ) % Mod;\n}\n\n/*\np^{wi}*p^{j(x-i)}\na1:p^{wi} q:p^(x-i) n:w+1\n\np^{wi+y-i}*p^{j(x-i)}\na1:p^{wi+y-i} q:p^(x-i) n:w\n*/\n\nint Solve( LL n , int x , int y ) {\n\tif( n == 0 ) return 0;\n\tk = 0; Divide( n );\n\tsort( pi + 1 , pi + k + 1 );\n\t\n\tS[ 0 ] = 0;\n\tfor( int i = 0 ; i <= y ; i ++ )\n\t\tS[ y + 1 - i ] = 1ll * Inverse( y + 1 ) * C( y + 1 , i ) % Mod * Bernoulli[ i ] % Mod;\n\n\tint cnt = 0;\n\tfor( int i = 1 ; i <= k ; i ++ ) {\n\t\tif( pi[ i ] != di[ cnt ] ) di[ ++ cnt ] = pi[ i ] , wi[ cnt ] = 1;\n\t\telse wi[ cnt ] ++;\n\t}\n\n\tint Ans = 0;\n\tfor( int i = 0 ; i <= y + 1 ; i ++ ) {\n\t\tint tmp = 1;\n\t\tfor( int j = 1 ; j <= cnt ; j ++ )\n\t\t\ttmp = 1ll * tmp * F( (int)( di[ j ] % Mod ) , wi[ j ] , i ) % Mod;\n        Ans = ( Ans + 1ll * S[ i ] * tmp % Mod ) % Mod;\n\t}\n\treturn 1ll * Quick_pow( int( n % Mod ) , y ) * Ans % Mod;\n}\n\nsigned main() {\n//\tfreopen(\"1.out\",\"w\",stdout);\n\n    srand( time( 0 ) );\n    Init_Fac( );\n    Init_Bernoulli( );\n\n\tRead( t );\n    while( t -- ) {\n        Read( n ) , Read( x ) , Read( y );\n\t\tWrite( Solve( n , x , y ) ) , putchar('\\n');\n    }\n    return 0;\n}\n```\n",
        "postTime": 1592546626,
        "uid": 123802,
        "name": "chihik",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4464 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]JZPKIL\u3011"
    },
    {
        "content": "\u5f0f\u5b50\u9898\uff1a\n\n\u6c42\uff1a\n\n$1 \\leq n \\leq 10^{18} ,1 \\leq x,y\\leq 3000$\n\n$$\\sum\\limits_{i=1}^n (i,n)^x \\text{lcm}(i,n)^y$$\n\n\u633a\u88f8\u7684\u9898\uff0c\u76f4\u63a5\u63a8\u5f00\u5c31\u884c\uff1a\n\n$$\\sum\\limits_{i=1}^n (i,n)^{x-y} (in)^y$$\n\n$$=n^y\\sum\\limits_{d|n} d^{x-y} \\sum\\limits_{i|\\frac{n}{d}} (id)^y[(i,\\dfrac{n}{d})=1]$$\n\n$$=n^y\\sum\\limits_{d|n} d^{x} \\sum\\limits_{i|\\frac{n}{d}} i^y \\sum\\limits_{k|i,k|\\frac{n}{d}} \\mu(k)$$\n\n$$=n^y\\sum\\limits_{d|n} d^{x} \\sum\\limits_{k|\\frac{n}{d}} \\mu(k) \\sum\\limits_{i=1}^{\\frac{n}{dk}} (ik)^y$$\n\n$$=n^y\\sum\\limits_{d|n} d^{x} \\sum\\limits_{k|\\frac{n}{d}} \\mu(k) k^y \\sum\\limits_{i=1}^{\\frac{n}{dk}} i^y$$\n\n\u770b\u5230\u540e\u9762\u7684\u6c42\u548c\u975e\u5e38\u5957\u8def\uff0c\u8fd9\u662f\u4e00\u4e2a\u5173\u4e8e $\\dfrac{dk}{n}$ \u7684 $y+1$ \u6b21\u51fd\u6570\u3002\n\n\u8bbe $\\sum\\limits_{i=1}^{n} i^y=\\sum\\limits_{i=0}^{y+1} f_in^i$\u3002\n\n\u6709\uff1a\n\n$$n^y\\sum\\limits_{d|n} d^{x} \\sum\\limits_{k|\\frac{n}{d}} \\mu(k) k^y \\sum\\limits_{i=1}^{\\frac{n}{dk}} i^y$$\n\n$$=n^y\\sum\\limits_{d|n} d^{x} \\sum\\limits_{k|\\frac{n}{d}} \\mu(k) k^y \\sum\\limits_{i=1}^{y+1} f_i(\\dfrac{n}{dk})^i$$\n\n$$=n^y \\sum\\limits_{i=1}^{y+1} f_i \\left( \\sum\\limits_{d|n} d^{x} \\sum\\limits_{k|\\frac{n}{d}} \\mu(k) k^y (\\dfrac{n}{dk})^i \\right)$$\n\n\u8fd9\u73a9\u610f\u5c31\u662f $n^y\\sum\\limits_{i=1}^{y+1} f_i \\left ( (\\mu \\times n^y) * n^x * n^i\\right)(n)$\n\n\u628a\u540e\u9762\u7684 $n^x * n^i$ \u5377\u6389\u3002\n\n\u8003\u8651\u600e\u4e48\u7b97 $\\left ( (\\mu \\times n^y) * n^x * n^i\\right)(n)$\u3002\n\n\u8003\u8651\u5230\u8fd9\u662f\u79ef\u6027\u51fd\u6570\uff0c\u53ef\u4ee5\u5c06 $n$ \u56e0\u5f0f\u5206\u89e3\u540e\u4e58\u79ef\u3002\n\n\u53d1\u73b0 $\\mu(x)$ \u7684\u53d6\u503c\u4e0d\u4e3a $0$ \u65f6\uff0c$x$ \u4e0d\u542b\u5e73\u65b9\u56e0\u5b50\uff0c\u6240\u4ee5\u8fd9\u8fd9\u90e8\u5206\u5377\u7684\u65f6\u5019\u662f $O(1)$ \u7684\uff0c\u7136\u540e\u540e\u9762\u6709\u4e00\u4e2a\u5feb\u901f\u5e42\u7684 $O( \\log x)$\u3002\n\n\u603b\u7684\u8fd8\u6709\u679a\u4e3e\u8d28\u56e0\u5b50\u7684 $O( \\log  n)$\u3002\n\n\u5916\u5c42\u8fd8\u6709\u4e00\u4e2a $y$ \uff0c\u590d\u6742\u5ea6 $O(Ty \\log n \\log x)$\u3002\n\n\u5bf9\u4e8e\u8d28\u56e0\u6570\u5206\u89e3\uff0c\u53ef\u7528 $\\text{Pollard-Pho}$ \u505a\u5230\u4e00\u7ec4\u6570\u636e $O(n^{\\frac{1}{4}})$\u3002\n\n\u5bf9\u4e8e\u591a\u9879\u5f0f\u7cfb\u6570 $f_i$\uff0c\u6211\u4eec\u6709 $\\sum\\limits_{i=0}^{n-1} i^m=\\sum_{k=1}^{m+1} C^{k}_{m+1}B_{y+1-i}n^k$\u3002\n\n\u5176\u4e2d $B_i$ \u4e3a\u4f2f\u52aa\u5229\u6570\uff0c\u53ef\u4ee5 $O(y^2)$ \u9884\u5904\u7406\u3002\n\n\u603b\u7684\u590d\u6742\u5ea6\u5c31\u662f $O(Tn^{\\frac{1}{4}}+Ty \\log n \\log x+y^2)$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\nint T,n,x,y;\ninline int gcd(int a,int b){return !b?a:gcd(b,a%b);}\nint ksm(int a,int b){\n\tint res=1;a%=mod;\n\twhile(b){\n\t\tif(b&1) res=res*a%mod;\n\t\ta=a*a%mod;b>>=1; \n\t}return res;\n}\nint qpow(int a,int b,int p){\n\tint res=1;\n\twhile(b){\n\t\tif(b&1) res=(__int128)res*a%p;\n\t\ta=(__int128)a*a%p;b>>=1; \n\t}return res;\n}\nbool MB(int p){\n\tif(p<2) return 0;if(p==2||p==3) return 1;\n\tint d=p-1,r=0;\n\twhile(!(d&1)) r++,d>>=1;\n\tfor(int k=0;k<15;k++){\n\t\tint a=rnd()%(p-2)+2;int x=qpow(a,d,p);\n\t\tif(x==1||x==p-1) continue;\n\t\tfor(int i=0;i<r-1;i++){x=(__int128)x*x%p;if(x==p-1) break;}\n\t\tif(x!=p-1) return 0;\n\t}\n\treturn 1;\n}\nint p_pho(int x){\n\tint s=0,t=0,c=rnd()%(x-1)+1,d;\n\tint st=0,gl=1,val=1;\n\tfor(gl=1;;gl<<=1,s=t,val=1){\n\t\tfor(st=1;st<=gl;st++){\n\t\t\tt=((__int128)t*t+c)%x;\n\t\t\tval=(__int128)val*abs(t-s)%x;\n\t\t\tif(st%127==0) if((d=gcd(val,x))>1) return d;\n\t\t}\n\t\tif((d=gcd(val,x))>1) return d;\n\t}\n}\nint p[N],pcnt,B[M+10],C[M+10][M+10];\nvoid fac(int x,int e){\n\tif(x<2) return ;\n\tif(MB(x)){for(int i=1;i<=e;i++) p[++pcnt]=x;return void();}\n\tint y=x,o=0;\n\twhile(y>=x) y=p_pho(x);\n\twhile(x%y==0) x/=y,o++;\n\tfac(x,e);fac(y,e*o);\n}\ninline int f(int p,int c){return ksm(p,c*y)*(c?mod-1:1)%mod;}\nint g(int p,int c,int i){\n\tint a=min(x,i),b=abs(x-i),res=0;int r=ksm(p,b);\n\tfor(int j=0;j<=c;j++) res=(res+ksm(r,j))%mod;\n\tres=res*ksm(p,c*a)%mod;\n\treturn res;\n}\nvoid solve(){\n\tn=read();x=read();y=read();pcnt=0;fac(n,1);\n\tsort(p+1,p+pcnt+1);int ans=0;\n\tfor(int i=1;i<=y+1;i++){\n\t\tint ret=1;\n\t\tfor(int j=1;j<=pcnt;j++){\n\t\t\tint c=1,pri=p[j],res=0;\n\t\t\twhile(j<pcnt&&pri==p[j+1]) j++,c++;\n\t\t\tfor(int w=0;w<=min(c,1ll);w++){\n\t\t\t\tres=(res+f(pri,w)*g(pri,c-w,i))%mod;\n\t\t\t}\n\t\t\tret=ret*res%mod;\n\t\t}\n\t\tans=(ans+ksm(y+1,mod-2)*B[y+1-i]%mod*C[y+1][i]%mod*ret)%mod;\n\t}\n\tprintf(\"%lld\\n\",ans*ksm(n,y)%mod);\n}\nsigned main(){\n\tC[0][0]=1;\n\tfor(int i=1;i<M;i++){\n\t\tC[i][0]=1;\n\t\tfor(int j=1;j<=i;j++) C[i][j]=(C[i-1][j]+C[i-1][j-1])%mod;\n\t}\n\tB[0]=1;\n\tfor(int i=1;i<M-1;i++){\n\t\tfor(int j=0;j<i;j++){\n\t\t\tB[i]=(B[i]+C[i+1][j]*B[j])%mod;\n\t\t}\n\t\tB[i]=(mod-B[i])%mod;B[i]=B[i]*ksm(C[i+1][i],mod-2)%mod;\n\t}B[1]++;\n\tT=read();while(T--) solve();\n\treturn 0;\n}\n```\n",
        "postTime": 1682760557,
        "uid": 436389,
        "name": "Vidoliga",
        "ccfLevel": 6,
        "title": "P4464 [\u56fd\u5bb6\u96c6\u8bad\u961f] JZPKIL \u9898\u89e3"
    },
    {
        "content": "\u4eca\u5929\u5fc3\u60c5\u4e0d\u597d\uff0c\u6240\u4ee5\u53c8\u6765\u505a\u6570\u8bba\u9898\u4e86......\n\n---\n\n## \u9898\u76ee\u5927\u610f\n\n\u6c42\n\n$$\\sum_{i=1}^n\\text{g.c.d}^x(i,n)\\text{l.c.m}^y(i,n)$$\n\u7684\u503c.\n\n\u5176\u4e2d$n\\le10^{18},x,y\\le 3000$.\n\n## \u9898\u89e3\n\n\u6839\u636e\u57fa\u672c\u5957\u8def\u5148\u63a8\u4e00\u6ce2\u5f0f\u5b50\n$$\\begin{aligned}\\sum_{i=1}^n\\text{g.c.d}^n(i,n)\\text{l.c.m}^y(i,n)&=n^y\\sum_{i=1}^ni^y\\text{g.c.d}^{x-y}(i,n)\\\\&=n^y\\sum_{d|n}d^{x-y}\\sum_{i=1}^ni^y[\\text{g.c.d}(i,n)=d]\\\\&=n^y\\sum_{d|n}d^{x-y}\\sum_{i=1}^{n/d}(id)^y[i\\perp n]\\\\&=n^y\\sum_{d|n}d^{x}\\sum_{i=1}^{n/d}i^y[i\\perp n]\\end{aligned}$$\n\u7b2c\u4e8c\u4e2a\u548c\u5f0f\u5c31\u662f\u300c\u4e00\u4e2a\u4eba\u7684\u6570\u8bba\u300d\uff0c\u5199\u8fc7\u4e86\u7684\u8bfb\u8005\u53ef\u4ee5\u8df3\u8fc7\u4e0b\u9762\u8fd9\u4e00\u90e8\u5206\n\n> \u4ee4\n> $$S(n)=\\sum_{i=1}^ni^y[i\\perp n]$$\n> \u5219\u6709\n> $$\\begin{aligned}S(n)&=\\sum_{i=1}^ni^y\\sum_{k|i,k|n}\\mu(k)\\\\&=\\sum_{k|n}\\mu(k)\\sum_{i=1}^{n/k}(ik)^y\\\\&=\\sum_{k|n}\\mu(k)k^y\\sum_{i=1}^{n/k}i^y\\\\&=\\sum_{k|n}\\mu(k)k^y\\sum_{i=1}^{y+1}a_i\\left(\\frac{n}{k}\\right)^i\\\\&=\\sum_{i=1}^{y+1}a_i\\sum_{k|n}\\mu(k)k^{y}\\left(\\frac{n}{k}\\right)^i\\end{aligned}$$\n\n\u56de\u5230\u4e3b\u7ebf\uff0c\u4ee3\u56de\u539f\u5f0f\u5f97\n$$\\begin{aligned}n^y\\sum_{d|n}d^{x}\\sum_{i=1}^{n/d}i^y[i\\perp n]&=n^y\\sum_{d|n}d^x\\sum_{i=1}^{y+1}a_i\\sum_{kd|n}\\mu(k)k^y\\left(\\frac{n}{kd}\\right)^i\\\\&=n^y\\sum_{i=1}^{y+1}a_i\\sum_{d|n}d^x\\sum_{kd|n}\\mu(k)k^y\\left(\\frac{n}{kd}\\right)^i\\\\&=n^y\\sum_{i=1}^{y+1}a_i\\sum_{T|n}\\left[\\sum_{k|T}\\mu(k)k^y\\left(\\frac{T}{k}\\right)^x\\right]\\left(\\frac{n}{T}\\right)^i\\end{aligned}$$\n\u6ce8\u610f\u5230\u6700\u540e\u4e24\u5c42\u7684\u548c\u5f0f\u5d4c\u5957\u5b9e\u9645\u4e0a\u662f\u4e09\u4e2a\u51fd\u6570\u7684\u8fea\u5229\u514b\u96f7\u5377\u79ef\uff0c\u4ee4$f(n)=\\mu(n)n^y$\uff0c\u5219\u6709\n$$n^y\\sum_{i=1}^{y+1}a_i\\sum_{T|n}\\left[\\sum_{k|T}\\mu(k)k^y\\left(\\frac{T}{k}\\right)^x\\right]\\left(\\frac{n}{T}\\right)^i=n^y\\sum_{i=1}^{y+1}a_i(f*\\text{id}_x*\\text{id}_i)(n)$$\n\u8003\u8651\u5230$(f*\\text{id}_x*\\text{id}_i)(n)$\u662f\u79ef\u6027\u51fd\u6570\uff0c\u6240\u4ee5\u8003\u8651\u6c42\u51fa\u5176\u5728\u8d28\u6570\u7684\u82e5\u5e72\u6b21\u5e42\u5904\u7684\u503c\n$$(f*\\text{id}_x*\\text{id}_i)(p^c)=(\\text{id}_x*\\text{id}_i)(p^c)-p^y(\\text{id}_x*\\text{id}_i)(p^{c-1})$$\n\u800c\u540e\u9762\u7684\u4e24\u90e8\u5206\u5c31\u662f\u4e00\u4e2a\u7b49\u6bd4\u6570\u5217\u6c42\u548c\uff0c\u66b4\u529b\u7b97\u5373\u53ef\uff08\u6ca1\u5fc5\u8981\u5feb\u901f\u5e42\uff0c\u90fd\u662f${\\log}$\u7ea7\u522b\u7684\uff09\n\n\u7136\u540ePollard-\u03c1\u8d28\u56e0\u6570\u5206\u89e3\uff0c\u5b9e\u73b0\u4e0d\u597d\u53ef\u80fd\u4f1aTLE.",
        "postTime": 1618466045,
        "uid": 139340,
        "name": "Gauss0320",
        "ccfLevel": 0,
        "title": "Solution\u300c\u56fd\u5bb6\u96c6\u8bad\u961f JZPKIL\u300d"
    },
    {
        "content": "## \u9898\u610f\n\u7ed9\u51fa $n,x,y$ \u6c42\uff1a\n$$\\sum_{i=1}^n\\gcd(i,n)^x\\mathrm{lcm}(i,n)^y\\bmod {10^9+7}$$\n$n\\le 10^{18},x,y\\le 3000$\uff0c\u591a\u7ec4\u8be2\u95ee\n## \u9898\u89e3\n\u6bd4\u8f83\u5957\u8def\uff0c\u4e0d\u8fc7\u8fd8\u662f\u8981 $\\rm stO$\u51fa\u9898\u4eba\u3002\n$$\n\\begin{aligned}\n&\\sum_{i=1}^n\\gcd(i,n)^x\\mathrm{lcm}(i,n)^y\\\\\n=&\\sum_{i=1}^n\\gcd(i,n)^x(in)^y\\gcd(i,n)^{-y}\\\\\n=&n^y\\sum_{i=1}^ni^y\\gcd(i,n)^{x-y}\\\\\n=&n^y\\sum_{d|n}\\sum_{i=1}^{\\frac nd}(id)^yd^{x-y} [\\gcd(i,\\frac nd)=1]\\\\\n=&n^y\\sum_{d|n}\\sum_{i=1}^{\\frac nd}i^yd^x \\sum_{a|\\gcd(i,\\frac nd)}\\mu(a)\\\\\n=&n^y\\sum_{a|n}\\mu(a)\\sum_{d|\\frac na}d^x\\sum_{i=1}^\\frac{n}{da}(ia)^y\\\\\n=&n^y\\sum_{a|n}\\mu(a)a^y\\sum_{d|\\frac na}d^x\\sum_{i=1}^\\frac{n}{da}i^y\n\\end{aligned}\n$$\n\u5957\u8def\u5730\uff0c\u8003\u8651\u8bbe $T=da$\n$$\n=n^y\\sum_{T|n}\\left(\\sum_{a|T}\\mu(a)a^y\\left(\\frac{T}{a}\\right)^x\\right)\\left(\\sum_{i=1}^\\frac nT i^y\\right)\n$$\n\u8003\u8651\u540e\u9762\u7684\u4e00\u5768\u53ef\u4ee5\u770b\u505a\u5173\u4e8e $\\frac nT$ \u7684 $y+1$ \u6b21\u591a\u9879\u5f0f\n\n\u8bbe $F(x)=\\sum_{i=1}^xi^y=\\sum_{i=0}^{y+1}f_ix^i$\n$$\\begin{aligned}\n=&n^y\\sum_{T|n}\\left(\\sum_{a|T}\\mu(a)a^y\\left(\\frac Ta\\right)^x\\right)\\left(\\sum_{i=0}^{y+1}f_i\\left(\\frac nT\\right)^i\\right)\\\\\n=&n^y\\sum_{i=0}^{y+1}f_i\\sum_{T|n}\\left(\\sum_{a|T}\\mu(a)a^y\\left(\\frac Ta\\right)^x\\right)\\left(\\frac nT\\right)^i\\\\\n\\end{aligned}$$\n\u8bbe $f_1(d)=\\mu(d)d^y,f_2(d)=d^x,f_3(d)=d^i$\n\n$$\n=n^y\\sum_{i=0}^{y+1}f_i(f_1*f_2*f_3)(n)\n$$\n\u663e\u7136 $f_1,f_2,f_3$ \u90fd\u4e3a\u79ef\u6027\u51fd\u6570,$(f_1*f_2*f_3)$ \u540c\u6837\u4e3a\u79ef\u6027\u51fd\u6570\n$$\\begin{aligned}\n=&n^y\\sum_{i=0}^{y+1}f_i\\prod_{p^\\alpha|n}(f_1*f_2*f_3)(p^\\alpha)\\\\\n=&n^y\\sum_{i=0}^{y+1}f_i\\prod_{p^\\alpha|n}\\sum_{a+b+c=\\alpha}\\mu(p^a)p^{ay}p^{bx}p^{ci}\\\\\n=&n^y\\sum_{i=0}^{y+1}f_i\\prod_{p^\\alpha|n}\\sum_{a=0}^1\\mu(p^a)p^{ay}\\sum_{b=0}^{\\alpha-a}p^{bx}p^{(\\alpha-a-b)i}\\\\\n\\end{aligned}\n$$\n\u5173\u4e8e\u7cfb\u6570\u7684\u6c42\u6cd5\u53ef\u4ee5\u53c2\u89c1[$\\color{skyblue}\\text{\u83dc\u9e21\u306e}\\mathbb{BLOG}$](https://chen-jia-liang.gitee.io/article/ji-lei-shu.html#_1)\n\n\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u4f2f\u52aa\u5229\u6570\u7684\u591a\u9879\u5f0f\u662f\u4e0d\u5305\u62ec $n^y$ \u6b21\u7684\uff0c\u8981\u624b\u52a8\u52a0\u4e0a\u53bb\u3002\n\n\u5269\u4e0b\u7684\u5c31\u662f\u8003\u9a8c $\\rm Pollard-Rho$ \u7684\u5e38\u6570\u4e86\u3002\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define faster\nnamespace in{\n    #ifdef faster\n    char buf[1<<21],*p1=buf,*p2=buf;\n    inline int getc(){return p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++;}\n    #else\n    inline int getc(){return getchar();}\n    #endif\n    template <typename T>inline void read(T& t){\n        t=0;int f=0;char ch=getc();while (!isdigit(ch)){if(ch=='-')f = 1;ch=getc();}\n        while(isdigit(ch)){t=t*10+ch-48;ch = getc();}if(f)t=-t;\n    }\n    template <typename T,typename... Args> inline void read(T& t, Args&... args){read(t);read(args...);}\n}\nnamespace out{\n    char buffer[1<<21];int p1=-1;const int p2 = (1<<21)-1;\n    inline void flush(){fwrite(buffer,1,p1+1,stdout),p1=-1;}\n    inline void putc(const char &x) {if(p1==p2)flush();buffer[++p1]=x;}\n    template <typename T>void write(T x) {\n        static char buf[15];static int len=-1;if(x>=0){do{buf[++len]=x%10+48,x/=10;}while (x);}else{putc('-');do {buf[++len]=-(x%10)+48,x/=10;}while(x);}\n        while (len>=0)putc(buf[len]),--len;\n    }\n}\nusing std::sort;\nusing std::swap;\nusing std::__gcd;\nconst int N=6e3+100;\nconst int mod=1e9+7,M=sqrt(mod);\ntypedef std::mt19937 Random_mt19937;\nRandom_mt19937 rnd(time(0));\nlong long factor[50];int cnt=0;\n#define ll long long\n#define int __int128\nint ksm(int a,int b,int p){\n\tint res=1;\n\twhile(b){\n\t\tif(b&1)res=res*a%p;\n\t\ta=a*a%p,b>>=1;\n\t}return res;\n}\ninline bool mr(ll x,ll b){\n\tll k=x-1;\n\twhile(k){\n\t\tll cur=ksm(b,k,x);\n\t\tif(cur!=1&&cur!=x-1)return false;\n\t\tif((k&1)==1||cur==x-1)return true;\n\t\tk>>=1;\n\t}return true;\n}\ninline bool prime(ll x){\n\tif(x==46856248255981ll||x<2)\n        return false;\n    if(x==2||x==3||x==7||x==61||x==24251)\n        return true;\n    return mr(x,2)&&mr(x,61);\n}\nint rd(int x){return ((1ll*rnd()<<16ll)|rnd())%x+1;}\nint f(int x,int c,int n){\n\treturn (x*x+c)%n;\n}\nint PR(int p) {\n\tint k=2,x=rd(p-1),y=x,d=1,c=rd(99997) ;\n\tfor(int i=1;d==1;i++){\n\t\tx=f(x,c,p);\n\t\td=__gcd((x>y)?x-y:y-x,p);\n\t\tif(i==k)y=x,k<<=1; \n\t}return d;\n}\nvoid Gfac(int p) {\n\tif(p==1)return; \n\tif(prime(p)){\n\t\tfactor[++cnt]=p;\n\t\treturn;\n\t}\n\tint x=p;\n\twhile(x==p)x=PR(x);\n\tGfac(x),Gfac(p/x);\n}\n#undef int\nstruct modint{\n    int x;\n    modint(int o=0){x=o;}\n    modint &operator = (int o){return x=o,*this;}\n    modint &operator +=(modint o){return x=x+o.x>=mod?x+o.x-mod:x+o.x,*this;}\n    modint &operator -=(modint o){return x=x-o.x<0?x-o.x+mod:x-o.x,*this;}\n    modint &operator *=(modint o){return x=1ll*x*o.x%mod,*this;}\n    modint &operator ^=(int b){\n        modint a=*this,c=1;\n        for(;b;b>>=1,a*=a)if(b&1)c*=a;\n        return x=c.x,*this;\n    }\n    modint &operator /=(modint o){return *this *=o^=mod-2;}\n    modint &operator +=(int o){return x=x+o>=mod?x+o-mod:x+o,*this;}\n    modint &operator -=(int o){return x=x-o<0?x-o+mod:x-o,*this;}\n    modint &operator *=(int o){return x=1ll*x*o%mod,*this;}\n    modint &operator /=(int o){return *this *= ((modint(o))^=mod-2);}\n    template<class I>friend modint operator +(modint a,I b){return a+=b;}\n    template<class I>friend modint operator -(modint a,I b){return a-=b;}\n    template<class I>friend modint operator *(modint a,I b){return a*=b;}\n    template<class I>friend modint operator /(modint a,I b){return a/=b;}\n    friend modint operator ^(modint a,int b){return a^=b;}\n    friend bool operator ==(modint a,int b){return a.x==b;}\n    friend bool operator !=(modint a,int b){return a.x!=b;}\n    bool operator ! () {return !x;}\n    modint operator - () {return x?mod-x:0;}\n    modint &operator++(signed){return *this+=1;}\n};\nmodint fac[N],ifac[N],F[N];\nmodint B[N];\nmodint C(int n,int m){if(m>n)return 0;return fac[n]*ifac[m]*ifac[n-m];}\nsigned main(){\n\t//freopen(\"JZPKIL.in\",\"r\",stdin);\n\t//freopen(\"JZPKIL.out\",\"w\",stdout); \n    fac[0]=1;for(int i=1;i<N;i++)fac[i]=fac[i-1]*i;\n    ifac[N-1]=1/fac[N-1];for(int i=N-1;i;i--)ifac[i-1]=ifac[i]*i;\n    B[0]=1;\n    for(int m=1;m<=3000;m++){\n    \tmodint tmp=0;\n    \tfor(int i=0;i<m;i++)\n    \t\ttmp+=C(m+1,i)*B[i];\n    \tB[m]=-tmp/C(m+1,m);\n    }\n    int t=1;\n\tin::read(t);\n    while(t--){\n    \tlong long n=970436691605084065;int x= 2312,y= 2977;\n    \tin::read(n,x,y);\n\t\tcnt=0;Gfac(n);\n    \tsort(factor+1,factor+1+cnt);\n    \tmodint Inv=modint(1)/(y+1);\n    \tfor(int i=0;i<=y;i++)\n    \t\tF[y-i+1]=C(y+1,i)*B[i]*Inv;\n    \tF[y]++;\n\t\tmodint ans=0;\n\t\tF[0]=0;\n    \tfor(int i=0;i<=y+1;i++){\n\t    \tmodint res=1;\n\t\t\tfor(int l=1;l<=cnt;l++){\n\t    \t\tint j=l;while(factor[j]==factor[l]&&j<=cnt)j++;\n\t    \t\tint alpha=j-l;long long p=factor[l]%mod;l=j-1;\n\t    \t\tmodint tmp=0;\n\t    \t\t\n\t\t    \t\tfor(int a=0;a<=1;a++){\n\t\t    \t\t\tif(a==0){\n\t\t    \t\t\t\tfor(int b=0;b<=alpha-a;b++)\n\t\t    \t\t\t\t\t//tmp+=(modint(p)^b*x)*(1-(modint(p)^i*(alpha-a-b+1)))/(1-(modint(p)^i));\n\t\t    \t\t\t\t\t//for(int c=0;c<=alpha-a-b;c++)\n\t\t    \t\t\t\t\t//\ttmp+=(modint(p)^b*x)*(modint(p)^c*i);\n\t\t\t\t\t\t\t\ttmp+=(modint(p)^b*x+i*(alpha-a-b));\n\t\t\t\t\t\t}else{\n\t\t    \t\t\t\tmodint kk=-(modint(p)^y);\n\t\t    \t\t\t\tfor(int b=0;b<=alpha-a;b++)\n\t\t    \t\t\t\t\t//tmp+=kk*(modint(p)^b*x)*(1-(modint(p)^i*(alpha-a-b+1)))/(1-(modint(p)^i));\n\t\t    \t\t\t\t\t//for(int c=0;c<=alpha-a-b;c++)\n\t\t    \t\t\t\t\t//\ttmp+=kk*(modint(p)^b*x)*(modint(p)^c*i);\n\t\t\t\t\t\t\t\ttmp+=kk*(modint(p)^b*x+i*(alpha-a-b));\n\t\t    \t\t\t}\n\t\t    \t\t}\n\t    \t\tres*=tmp;\n\t    \t}\n\t    \tans+=res*F[i];\n    \t}\n    \tans*=modint(n%mod)^y;\n    \tout::write(ans.x);\n    \tout::putc('\\n');\n    }\n    out::flush();\n}\n```",
        "postTime": 1615438588,
        "uid": 174304,
        "name": "jun\u5934\u5409\u5409",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4464 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f] JZPKIL\u3011"
    },
    {
        "content": "\n$$\n\\begin{aligned}\n\\sum_{i}\\gcd(i,n)^x\\operatorname{lcm}(i,n)^y&=\\sum_{i}(in)^y\\gcd(i,n)^{x-y}\\\\\n&=\\sum_{d|n}\\sum_{d|i}(in)^yd^{x-y}[\\gcd(i,n)=d]\\\\\n&=\\sum_{d|n}d^xn^y\\sum_{i}i^y[\\gcd(i,\\frac{n}{d})=1]\\\\\n&=\\sum_{d|n}d^xn^y\\sum_{i}i^y\\sum_{k|i,k|\\frac{n}{d}}\\mu(k)\\\\\n&=n^y\\sum_{d|n}d^x\\sum_{k|\\frac{n}{d}}\\mu(k)\\sum_{k|i}i^y\\\\\n&=n^y\\sum_{d|n}d^x\\sum_{k|\\frac{n}{d}}\\mu(k)k^yS_y(\\frac{n}{kd})\n\\end{aligned}\n$$\n\u5176\u4e2d\n$$\nS_y(n)=\\sum_{i=1}^{n}i^y\n$$\n\u662f\u5173\u4e8e $n$ \u7684 $y+1$ \u9636\u591a\u9879\u5f0f\uff0c\u8bbe $f_i=[x^i]S_y(n)$\uff0c\u5219\n$$\n\\begin{aligned}\n\\sum_{i}\\gcd(i,n)^x\\operatorname{lcm}(i,n)^y&=n^y\\sum_{d|n}d^x\\sum_{k|\\frac{n}{d}}\\mu(k)k^yS_y(\\frac{n}{kd})\\\\\n&=n^y\\sum_{d|n}d^x\\sum_{k|\\frac{n}{d}}\\mu(k)k^y\\sum_{i}(\\frac{n}{kd})^if_i\\\\\n&=n^y\\sum_{i}f_i\\sum_{d|n}d^x\\sum_{k|\\frac{n}{d}}\\mu(k)k^y(\\frac{n}{kd})^i\\\\\n&=n^y\\sum_{i}f_i\\sum_{D|n}(\\frac{n}{D})^i\\sum_{d|D}d^x\\mu(\\frac{D}{d})(\\frac{D}{d})^y\\\\\n&=n^y\\sum_{i}f_i\\sum_{D|n}(\\frac{n}{D})^i((d^x)*(\\mu(d)d^y))(D)\\\\\n&=n^y\\sum_{i}f_i((d^i)*(d^x)*(\\mu(d)d^y))(n)\n\\end{aligned}\n$$\n\u5176\u4e2d $*$ \u8868\u793a\u72c4\u5229\u514b\u96f7\u5377\u79ef\u3002\n\n\u6ce8\u610f\u5230 $f(d)=d^i$\uff0c$g(d)=d^x$\uff0c$h(d)=\\mu(d)d^y$ \u90fd\u662f\u79ef\u6027\u51fd\u6570\uff0c\u6240\u4ee5 $F=f*g*h$ \u4e5f\u662f\u79ef\u6027\u51fd\u6570\u3002\n\n\u8003\u8651\u8ba1\u7b97 $F(p^k)$\u3002\n$$\nF(p^k)=\\sum_{i=0}^{k}h(p^i)(f*g)(p^{k-i})=(f*g)(p^k)-p^y(f*g)(p^{k-1})\n$$\n\u6240\u4ee5\u53ea\u8981\u8003\u8651\u7b97 $(f*g)(p^k)$ \u5373\u53ef\u3002\n$$\n(f*g)(p^k)=\\sum_{t=0}^{k}p^{it}p^{(k-t)x}=\\sum_{t=0}^{k}p^{kx+(i-x)t}\n$$\n\u53ef\u4ee5\u7528\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\u8ba1\u7b97\u3002\n\n\u56e0\u6b64\u6211\u4eec\u4f7f\u7528 Pollard-rho \u5bf9 $n$ \u8fdb\u884c\u56e0\u6570\u5206\u89e3\uff0c\u5c31\u53ef\u4ee5\u5206\u522b\u7b97\u51fa $F(k)$\u3002\n\n\u6700\u540e\u8003\u8651\u8ba1\u7b97 $f_i$\uff0c\u76f4\u63a5\u63d2\u503c/\u4f2f\u52aa\u5229\u6570\uff0c$O(n^2)$\u3002",
        "postTime": 1611415556,
        "uid": 121027,
        "name": "Spasmodic",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4464 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]JZPKIL\u3011"
    }
]