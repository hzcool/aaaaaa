[
    {
        "content": "[\u539f\u9898\u94fe\u63a5](https://www.luogu.com.cn/problem/P7377)\n\n## \u524d\u8a00\n\u8003\u573a\u4e0a\u5fd8\u8bb0\u4e86\u5b57\u5178\u6811\u600e\u4e48\u5199\uff0c\u4e34\u65f6\u6253\u4e86\u4e2a\u66b4\u529b\u52a0\u4e0a\u4e00\u70b9\u4f18\u5316\u7adf\u7136\u8fc7\u4e86\uff01\uff1f~~\uff08\u6570\u636e\u8fc7\u6c34\uff09~~\n\n## \u5206\u6790\n\u4e3a\u4e86\u907f\u514d\u7b54\u6848\u7b97\u91cd\uff0c\u6211\u4eec\u4ece $1$ \u5f00\u59cb\u987a\u6b21\u8003\u8651 $n$ \u4e2a\u5b57\u7b26\u4e32\uff0c\u5bf9\u4e8e\u5f53\u524d\u5b57\u7b26\u4e32\uff0c\u53ea\u8003\u8651\u524d\u9762\u7684\u5b57\u7b26\u4e32\u4e0e\u5b83\u6210\u5bf9\u7684\u60c5\u51b5\u3002\n\n\u5bf9\u4e8e\u5f53\u524d\u5b57\u7b26\uff0c\u6211\u4eec\u8003\u8651\u54ea\u4e9b\u5b57\u7b26\u53ef\u4ee5\u4e0e\u5b83\u6210\u5bf9\u3002\u5982\u679c\u7b2c $i$ \u4e2a\u5b57\u7b26\u662f $\\texttt ?$\uff0c\u90a3\u4e48\u524d\u9762\u6bcf\u4e2a\u5b57\u7b26\u4e32\u7684\u7b2c $i$ \u4e2a\u662f\u4ec0\u4e48\u90fd\u968f\u610f\uff1b\u5426\u5219\u5982\u679c\u662f $ch$\uff0c\u90a3\u4e48\u53ea\u6709\u524d\u9762\u5b57\u7b26\u4e32\u7684\u7b2c $i$ \u4e2a\u4e5f\u662f $ch$ \u6216\u8005\u662f $\\texttt ?$ \u624d\u80fd\u4e0e\u5176\u6210\u5bf9\u3002\u5230\u8fd9\u4e00\u6b65\uff0c\u6211\u4eec\u8003\u8651\u5b8c $m$ \u4f4d\u4e4b\u540e\uff0c\u53ea\u9700\u8981\u5c06\u6bcf\u4e00\u4f4d\u53ef\u80fd\u9009\u62e9\u7684**\u4ea4\u96c6\u5927\u5c0f**\u7d2f\u52a0\u5230\u7b54\u6848\u4e2d\u5373\u53ef\u3002\n\n\u4ee4 $f[j][ch]$ \u8868\u793a\u7b2c $j$ \u4e2a\u5b57\u7b26\u662f $ch$ \u7684\u96c6\u5408\uff0c\u5982\u679c\u7b2c $i$ \u4e2a\u5b57\u7b26\u4e32\u6ee1\u8db3\u7b2c $j$ \u4e2a\u5b57\u7b26\u662f $ch$\uff0c\u5219 $f[j][ch][i] = 1$\uff0c\u53cd\u4e4b $f[j][ch][i] = 0$\u3002\u8bbe\u7f6e\u4e00\u4e2a\u5168\u96c6 $tmp$\uff0c\u5176\u4e2d\u6bcf\u4e00\u4f4d\u90fd\u662f $1$\u3002\u5bf9\u4e8e\u7b2c $i$ \u4e2a\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u7b2c $j$ \u4e2a\u5b57\u7b26\u662f $\\texttt ?$\uff0c\u76f8\u5f53\u4e8e\u524d\u9762\u6bcf\u4e00\u4e2a\u90fd\u53ef\u4ee5\u9009\uff0c\u5219\u96c6\u5408\u7684\u4ea4\u96c6\u4e0d\u53d8\uff1b\u5982\u679c\u7b2c $j$ \u4e2a\u5b57\u7b26\u662f $ch$\uff0c\u90a3\u4e48 $tmp = tmp \\ \\cap \\ (f[j][ch] \\ \\cup \\ f[j][\\texttt ?])$\uff0c\u6700\u540e\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f $tmp$ \u4e2d $1$ \u7684\u4e2a\u6570\u3002\u6b64\u5916\uff0c\u9700\u8981\u7279\u5224\u5982\u679c\u4e00\u4e2a\u5b57\u7b26\u4e32\u5168\u662f $\\texttt ?$ \u7684\u60c5\u51b5\uff0c\u867d\u7136\u6b64\u65f6 $tmp$ \u662f\u5168\u96c6\uff0c\u4f46\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u53ea\u6709 $i - 1$\u3002\n\n\u8fd9\u6837\u5b50\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n^2m)$ \u7684\uff0c\u4f46\u662f\u96c6\u5408\u7684\u5e76\u96c6\u4ea4\u96c6\u7b49\u7684\u5904\u7406\u53ef\u4ee5\u4f7f\u7528 bitset \u4f18\u5316\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u964d\u5230\u4e86 $O(\\displaystyle \\frac {n^2m} {w} )$\u3002\u867d\u7136\u7406\u8bba\u4e0a\u754c\u662f\u8981\u8d85\u65f6\u7684\uff0c\u4f46\u662f $3s$ \u52a0\u4e0a\u67d0\u8c37\u4f18\u79c0\u7684\u8bc4\u6d4b\u673a\u8fd8\u662f[\u8f7b\u677e\u8dd1\u8fc7](https://www.luogu.com.cn/record/89771771)\u3002~~\uff08\u624d\u4e0d\u662f\u6570\u636e\u8fc7\u6c34\uff09~~\n\n## Code\n```cpp\ninclude <bits/stdc++.h>\nusing namespace std;\n\nconst int N = 5e4 + 10;\nchar str[N][10];\nint n, m, ans;\nbitset<N> f[10][30], tmp, st;\n\nint main() {\n\tst.set();\n\t//\u7528\u4e8e\u5224\u65ad\u5168\u662f ? \u7684\u5168\u96c6\uff0c\u5168\u90e8\u521d\u59cb\u5316\u4e3a1 \n\tcin >> n >> m;\n\tfor (int i = 1; i <= n; i++) scanf(\"%s\", str[i]);\n\tfor (int i = 1; i <= n; i++) {\n\t\ttmp.set();\n\t\t//\u521d\u59cb\u5316\u4e3a\u5168\u96c6 \n\t\tfor (int j = 0; j < m; j++)\n\t\t\tif (str[i][j] != '?') {\n\t\t\t\tint t = str[i][j] - 'a';\n\t\t\t\ttmp = (tmp & (f[j][26] | f[j][t]));\n\t\t\t\t//0 ~ 25 \u8868\u793a a ~ z, 26 \u8868\u793a ?\n\t\t\t}\n\t\tif (tmp == st) ans += i - 1;\n\t\telse ans += tmp.count();\n\t\t//\u5bf9\u7b54\u6848\u7684\u8d21\u732e \n\t\tfor (int j = 0; j < m; j++)\n\t\t\tif (str[i][j] == '?') f[j][26][i] = 1;\n\t\t\telse f[j][str[i][j] - 'a'][i] = 1;\n\t\t//\u653e\u5165\u96c6\u5408\u4e2d \n\t}\n\tcout << ans;\n\treturn 0;\n}\n```\n",
        "postTime": 1665710348,
        "uid": 482965,
        "name": "Zheng07",
        "ccfLevel": 6,
        "title": "P7377 [COCI2018-2019#5] Parametriziran \u9898\u89e3"
    },
    {
        "content": "### step 0:\n\n$O(n^2m)$ \u66b4\u529b ,$60 pts$\uff0c\u4ee3\u7801\u7565\n\n### step 1:\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u65b0\u8bfb\u5165\u7684\u5b57\u7b26\u4e32\uff0c\u6211\u4eec\u60f3\u8981\u66f4\u52a0\u5feb\u901f\u7684\u7edf\u8ba1\u51fa\u6765\u5b83\u524d\u9762\u591a\u5c11\u4e2a\u5b57\u7b26\u4e32\u4e0e\u5b83\u76f8\u4f3c\u3002\u6ce8\u610f\u5230\u6570\u636e\u8303\u56f4\u4e2d\u4e00\u4e2a\u4e0d\u5bfb\u5e38\u7684\u70b9\uff1a $m \\leq 6$\u3002\u4ece\u8fd9\u4e00\u70b9\u5165\u624b\uff0c\u4e0d\u96be\u60f3\u5230\u4e00\u4e2a $naive$ \u7684\u89e3\u6cd5\uff1a\u52a8\u6001\u5f00\u70b9\u5efa\u7acb $2^6$ \u9897\u5b57\u5178\u6811\u3002\n\n\u6bcf\u9897\u5b57\u5178\u6811\u7684\u6839\u8282\u70b9\u6709\u4e00\u4e2a $6$ \u4f4d\u7684 $01$ \u4e32\uff0c\u5206\u522b\u8868\u793a\u662f\u5426\u8003\u8651\u8fd9\u516d\u4f4d\u4e0a\u5177\u4f53\u662f\u4ec0\u4e48\u5b57\u6bcd\u3002\u66f4\u5177\u4f53\u5730\uff0c\u4f5c\u4e3a $1$ \u7684\u4f4d\u7f6e\u6709'a'~'z'\u4ee5\u53ca'?'\u7b49\u513f\u5b50\u8fdb\u884c\u5206\u7c7b\uff0c\u800c\u4f5c\u4e3a $0$ \u7684\u4f4d\u7f6e\u4e0d\u8bba\u539f\u4e32\u662f\u591a\u5c11\u7edf\u4e00\u770b\u4f5c\u662f'?'\u3002\n\n\u63d2\u5165\u7684\u65f6\u5019\u5728**\u6240\u6709**\u5b57\u5178\u6811\u4e0a\u63d2\u5165\u3002\u6bcf\u4e00\u4f4d\u5982\u679c\u5b57\u5178\u6811\u5bf9\u5e94\u4f4d\u7f6e\u662f1,\u5c31\u63d2\u5230\u76f8\u5bf9\u5e94\u5b57\u6bcd\uff08\u5b57\u7b26\uff09\u7684\u513f\u5b50\u4f4d\u7f6e\uff1b\u5982\u679c\u5b57\u5178\u6811\u5bf9\u5e94\u4f4d\u7f6e\u662f0\uff0c\u7edf\u4e00\u89c6\u4f5c'?'\u63d2\u5230'?'\u5bf9\u5e94\u7684\u513f\u5b50\u7f16\u53f7\u3002\n\n\u8be2\u95ee\u7684\u65f6\u5019\u5728**\u4e00\u68f5**\u5b57\u5178\u6811\u4e0a\u8be2\u95ee\uff0c\u5b57\u5178\u6811\u7684 $01$ \u4e32\u4e0e\u8be2\u95ee\u4e32\u8be5\u4f4d\u7f6e\u662f\u5426\u662f\u95ee\u53f7\u4e00\u4e00\u5bf9\u5e94\uff1a $0$ \u8868\u793a\u95ee\u53f7\uff0c $1$ \u8868\u793a\u82f1\u6587\u5b57\u6bcd\u3002\u4f46\u5728\u8fd9\u4e00\u68f5\u6811\u4e0a\uff0c\u5bf9\u4e8e $1$ \u7684\u5206\u53c9\u5e94\u8be5\u540c\u65f6\u52a0\u4e0a\u539f\u672c\u5b57\u6bcd\u513f\u5b50\u7684\u7b54\u6848\u548c'?'\u513f\u5b50\u7684\u7b54\u6848\u3002\n\n\u663e\u7136\u8fd9\u6837\u7edf\u8ba1\u5c31\u4e0d\u91cd\u4e0d\u6f0f\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m;\nchar a[100005][7];\nlong long anss;\n\nstruct Trie{\n\tint P;\n\tint root[65],trie[600005][30],tot;\n\tint cntwd[600005];\n\tinline void ins(int &x,int i,int sta)\n\t{\n\t\tif(!x) x=++tot;\n\t\tif(i==m+1) {cntwd[x]++;return ;}\n\t\tint y=(sta&(1<<(i-1)))&&a[P][i]!='?'? a[P][i]-'a':26;\n\t\tins(trie[x][y],i+1,sta);\n\t}\n\tint ask(int x,int i,int sta)\n\t{\n\t\tif(!x) return 0;\n\t\tif(i==m+1) return cntwd[x];\n\t\tint y=a[P][i]=='?'? 26:a[P][i]-'a';\n\t\tint ans=ask(trie[x][y],i+1,sta)+((sta&(1<<(i-1)))&&y!=26? ask(trie[x][26],i+1,sta):0); \n\t\treturn ans;\n\t}\n}TR;\n\nint main()\n{\n\tcin>>n>>m;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=m;j++)\n\t\t\tcin>>a[i][j];\n\t\t\t\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tTR.P=i;int sta=0;\n\t\tfor(int j=m;j;j--) sta<<=1,sta|=(a[i][j]!='?');\n\t\tanss+=TR.ask(TR.root[sta],1,sta);\n\t\tfor(int j=0;j<(1<<m);j++)TR.ins(TR.root[j],1,j);\n\t}\n\t\n\tcout<<anss<<'\\n';\n\treturn 0;\n}\n```\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nm2^m)$,\u7a7a\u95f4\u590d\u6742\u5ea6\u4e0a\u754c $O(nm2^m*30)$\n\n\u7136\u800c\u6b64\u9898\u7a7a\u95f4\u53ea\u6709 $64MB$\uff0c\u5bfc\u81f4\u6b64\u505a\u6cd5 $MLE 84pts$\u3002\u4ed4\u7ec6\u8ba1\u7b97\u540e\u53d1\u73b0\u65e0\u8bba\u5982\u4f55\u5361\u7a7a\u95f4\u90fd\u5361\u4e0d\u8fc7\uff0c\u56e0\u6b64\u4e0d\u80fd\u76f4\u63a5\u5b57\u5178\u6811\u3002\n\n### step 2:\n\n\u518d\u6b21\u5229\u7528\u6570\u636e\u8303\u56f4\u3002\u56e0\u4e3a\u5b57\u7b26\u4e32\u975e\u5e38\u77ed\uff0c\u56e0\u6b64\u76f4\u63a5 ```hash``` \u4e5f\u4e0d\u4f1a\u8d85\u8fc7 ```int``` \u8303\u56f4\u3002\u7528```unordered_map + hash``` \u4ee3\u66ff\u5b57\u5178\u6811\u5c31\u53ef\u4ee5\u8ba9\u7a7a\u95f4\u590d\u6742\u5ea6\u5c11\u4e00\u4e2a $m*30$\u3002\u5176\u4ed6\u601d\u8def\u4e0e\u5b57\u5178\u6811\u57fa\u672c\u5b8c\u5168\u4e00\u81f4\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m;\nchar a[7];\nunordered_map<int,int> mp[65];\nlong long anss;\n\ninline int hs(int sta)\n{\n\tint ans=0;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint y=((sta&(1<<(i-1)))&&a[i]!='?')? a[i]-'a':26;\n\t\tans=ans*28+y;\n\t}return ans;\n}\n\nint main()\n{\n\tcin>>n>>m;\n\t\t\t\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=1;j<=m;j++)cin>>a[j];\n\t\tint sta=0;\n\t\tfor(int j=m;j;j--) sta<<=1,sta|=(a[j]!='?');\n\t\tfor(int j=sta;j;j=sta&(j-1)) anss+=mp[sta][hs(j)]; anss+=mp[sta][hs(0)];\n\t\tfor(int j=0;j<(1<<m);j++)mp[j][hs(j)]++;\n\t}\n\t\n\tcout<<anss<<'\\n';\n\treturn 0;\n}\n```\n\n\u7136\u540e\u4f60\u81ea\u4fe1\u4e00\u4ea4\uff0c\u5374\u53d1\u73b0\u2014\u2014\n\n\u300a105pts,MLEon#18\u300b\n\n### step 2.001:\n\n\u53ef\u80fd\u4e0e ```unordered_map``` \u5185\u90e8\u7684\u5b9e\u73b0\u673a\u5236\u6709\u5173\uff0c\u76f4\u63a5\u7528\u4e0b\u6807\u8bbf\u95ee\u5b83\u5185\u90e8\u4e00\u4e2a\u4f4d\u7f6e\u7684\u65f6\u5019\uff0c\u5373\u4f7f\u8fd9\u4e2a\u4f4d\u7f6e\u539f\u672c\u4e0d\u5b58\u5728\uff0c\u5b83\u4e5f\u4f1a\u5c06\u8fd9\u4e2a\u4f4d\u7f6e\u65b0\u5efa\u51fa\u6765\u4e4b\u540e\u518d\u8fd4\u56de $0$ \u3002\u56e0\u6b64\u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u4f4d\u7f6e\u4f1a\u8ba9\u7a7a\u95f4\u65e0\u7aef\u53d8\u5927\u3002\n\n\u56e0\u6b64\u53ea\u8981\u5728\u8bbf\u95ee\u4e4b\u524d\u5148\u67e5\u770b\u4e00\u4e0b\u54c8\u5e0c\u8868\u4e2d\u662f\u5426\u6709\u8fd9\u4e2a\u4f4d\u7f6e\u5c31\u53ef\u4ee5\u8282\u7701\u8bb8\u591a\u7a7a\u95f4\u3002\u5b9e\u6d4b\u5c45\u7136\u8282\u7701\u4e86 $20MB$ \u4e43\u81f3 $30MB^+$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m;\nchar a[7];\nmap<int,int> mp[65];\nlong long anss;\n\ninline int hs(int sta)\n{\n\tint ans=0;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint y=((sta&(1<<(i-1)))&&a[i]!='?')? a[i]-'a':26;\n\t\tans=ans*28+y;\n\t}return ans;\n}\n\nint main()\n{\n\tcin>>n>>m;\n\t\t\t\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=1;j<=m;j++)cin>>a[j];\n\t\tint sta=0;\n\t\tfor(int j=m;j;j--) sta<<=1,sta|=(a[j]!='?');\n\t\tfor(int j=sta;j;j=sta&(j-1)) if(mp[sta].count(hs(j)))anss+=mp[sta][hs(j)]; if(mp[sta].count(hs(0)))anss+=mp[sta][hs(0)];\n\t\tfor(int j=0;j<(1<<m);j++)mp[j][hs(j)]++;\n\t}\n\t\n\tcout<<anss<<'\\n';\n\treturn 0;\n}\n```\n\n\u6b64\u5916\u7ecf\u8fc7\u5b9e\u6d4b\uff0c $map$ \u7a7a\u95f4\u4e0a\u4e0e $unordered\\_map$ \u5dee\u4e0d\u591a\uff0c\u4f46\u662f\u4f1aTLE,\u5f00 $O(2)$ \u53ef\u8fc7\u3002",
        "postTime": 1635411318,
        "uid": 220799,
        "name": "\u5165\u6237\u529f\u592b",
        "ccfLevel": 7,
        "title": "\u3010\u9898\u89e3\u3011 P7377 [COCI2018-2019#5] Parametriziran"
    },
    {
        "content": "\u9996\u5148\u89c2\u5bdf\u5230 $m \\leq 6$ \u4e14\u53ea\u6709 $26$ \u4e2a\u5b57\u6bcd\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5927\u529b\u54c8\u5e0c\u3002\n\n\u8003\u8651\u679a\u4e3e\u5230\u67d0\u4e00\u4e2a\u4e32\u600e\u4e48\u5224\u65ad\u5b83\u548c\u4e4b\u524d\u6709\u591a\u5c11\u4e2a\u76f8\u4f3c\u7684\u3002\u5bf9\u4e8e\u5b83\u7684\u6bcf\u4e00\u4e2a\u5b57\u6bcd\uff08\u975e `?` \u5b57\u7b26\uff09\uff0c\u679a\u4e3e\u5b83\u76f8\u4f3c\u7684\u4e32\u7684\u6240\u6709\u53ef\u80fd\uff08\u4e5f\u5c31\u662f\u76f8\u4f3c\u4e32\u7684\u5bf9\u5e94\u5b57\u7b26\u662f\u539f\u5b57\u7b26\u6216\u662f `?`\uff09\uff0c\u7136\u540e\u54c8\u5e0c\u51fa\u6765\u4e22 `map` \u67e5\u7b54\u6848\u3002\n\n\u81f3\u4e8e\u66f4\u65b0\uff0c\u66b4\u529b\u679a\u4e3e\u6240\u6709\u60c5\u51b5\uff0c\u7136\u540e\u54c8\u5e0c\u5b8c\u4e22 `map` \u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $O(n2^m)$\uff0c\u6ce8\u610f\u67e5\u7b54\u6848\u65f6\u8981\u5148\u5224\u65ad\u5bf9\u5e94 `map` \u662f\u5426\u7a7a\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define FOR(i,a,b) for(register int i = (a);i<=(b);++i)\nusing namespace std;\nint n,m;\nchar str[10];\nmap<int,int> mp[65];\nint ans;\ninline int hs(char ch){\n\tif(ch == '?') return 26;\n\telse return ch-'a';\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tFOR(i,1,n){\n\t\tscanf(\"%s\",str);\n\t\tint has = 0,opt = 0,tt = -1;char tmp[10];\n\t\tFOR(j,0,m-1){\n\t\t\tif(str[j] != '?'){\n\t\t\t\topt |= (1<<j);\n\t\t\t\thas = (has<<1)|1;\n\t\t\t\ttmp[++tt] = str[j];\n\t\t\t}\n\t\t}\n\t\tif(opt == 0) ans += i-1;\n\t\telse{\n\t\t\tFOR(j,0,has){\n\t\t\t\tint cnt = 0;\n\t\t\t\tfor(int k = 0;(1<<k) <= has;++k){\n\t\t\t\t\tif((1<<k) & j) cnt = cnt*30+26;\n\t\t\t\t\telse cnt = cnt*30+(tmp[k]-'a');\n\t\t\t\t}\n\t\t\t\t//printf(\"%d %d\\n\",i,cnt);\n\t\t\t\tif(mp[opt].count(cnt)) ans += mp[opt][cnt];\n\t\t\t}\n\t\t}\n\t\tFOR(j,1,(1<<m)-1){\n\t\t\tint cnt = 0;\n\t\t\tFOR(k,0,m-1){\n\t\t\t\tif((1<<k) & j) cnt = cnt*30+hs(str[k]);\n\t\t\t}//printf(\"%d %d\\n\",i,cnt);\n\t\t\tmp[j][cnt]++;\n\t\t}\n\t}\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1614330018,
        "uid": 114173,
        "name": "Computer1828",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7377 [COCI2018-2019#5] Parametriziran"
    },
    {
        "content": "[Loj#3133](https://loj.ac/p/3133) / [LGP7377](https://www.luogu.com.cn/problem/P7377).\n\n\u8bb0\u5355\u8bcd\u4e3a $w_{0 \\dots n - 1}$\uff0c\u5355\u8bcd\u4e2d\u5b57\u7b26\u7f16\u53f7 $[0, m)$\u3002\n\n\u4e24\u4e2a\u5355\u8bcd $s, t$ **\u4e0d\u76f8\u4f3c**\uff0c\u5f53\u4e14\u4ec5\u5f53 $\\exists i \\space s_i \\ne \\texttt ? \\land t_i \\ne \\texttt ? \\land s_i \\ne t_i$\u3002\n\n\u8003\u8651\u5bb9\u65a5\u3002\n\n\u8003\u8651\u4e24\u5355\u8bcd $s, t$\u3002\u5176\u8d21\u732e\u4e3a\uff1a\n\n$$\n\\begin{aligned}\n& [s \\sim t] \\cr\n= & \\sum_{S \\subset [0, m) \\cap \\mathbb Z} (-1)^{|S|} [\\forall i \\in S \\space s_i \\ne \\texttt ? \\land t_i \\ne \\texttt ? \\land s_i \\ne t_i] \\cr\n= & \\sum_{S \\subset [0, m) \\cap \\mathbb Z} (-1)^{|S|} \\sum_{T \\subset S} (-1)^{|T|} [\\forall i \\in T \\space s_i = t_i \\ne \\texttt ?]. \\cr\n\\end{aligned}\n$$\n\n\u8fdb\u4e00\u6b65\u5730\uff0c\u7b54\u6848\u4e3a\uff1a\n\n$$\n\\sum_{i \\ne j} [s_i \\sim s_j] = \\sum_{S \\subset [0, m) \\cap \\mathbb Z} \\sum_{t \\subset S} (-1)^{|S| + |T|} \\sum_{i \\ne j} [\\forall k \\in T \\space s_k = t_k \\ne \\texttt ?].\n$$\n\n\u672c\u8d28\u5c31\u662f\u4e24\u6b21\u5bb9\u65a5\u3002\u5176\u4e2d\u6700\u540e\u4e00\u4e2a $\\sum$ \u53ef\u4ee5\u4f7f\u7528\u54c8\u5e0c\u8868\u5feb\u901f\u89e3\u51b3\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(3^m \\cdot nm)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(nm)$\u3002\n\n```cpp\nnamespace Main { namespace Main {\n  struct hash { inline lu operator()(lu const x) const { static lu const r(rand()); return x ^ r; } };\n  constexpr hu const n_max(5e4), m_max(6);\n  hu n, m; char w[n_max][m_max + 1]; lu ans;\n  inline void main(dint, char * []) {\n    io >> n >> m; for (hu i{}; i < n; ++i) get(w[i]);\n    for (hu i{}; i < 0b1 << m; ++i)\n      for (hu j(i); ; j = (j - 1) & i) {\n        static unordered_map<lu, hu, hash> cnt;\n        for (hu k{}; k < n; ++k) {\n          { bool f{}; for (hu l{}; l < m; ++l) f = f || (i & 0b1 << l && w[k][l] == '?'); if (f) continue; }\n          lu hash{}; for (hu l{}; l < m; ++l) if (j & 0b1 << l) hash |= (w[k][l] - 'a') << l * 5; ++cnt[hash];\n        }\n        hd sign(+1);\n        { for (hu k{}; k < m; ++k) if (i & 0b1 << k) sign = -sign; for (hu k{}; k < m; ++k) if (j & 0b1 << k) sign = -sign; }\n        for (auto const & p: cnt) ans += 1ul * p.second * (p.second - 1) / 2 * sign;\n        cnt.clear();\n        if (!j) break;\n      }\n    put(ans, '\\n');\n  }\n} }\n```",
        "postTime": 1643536429,
        "uid": 236807,
        "name": "Mitama",
        "ccfLevel": 9,
        "title": "[Solution] [COCI2018-2019#5] Parametriziran"
    }
]