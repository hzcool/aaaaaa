[
    {
        "content": "## \u9898\u610f\r\n\r\n\r\n\u73b0\u5728\u6709\u4e00\u5f20 $ N \\times M $ \u7684\u7f51\u683c\u56fe\uff0c\u5728\u8fd9\u5f20\u56fe\u4e2d\u6709\u4e00\u4e9b\u969c\u788d\u7269\u3002\r\n\r\n\u73b0\u5728\u8981\u6c42\u4ece\u5de6\u4e0b\u89d2\u51fa\u53d1\u4e14\u65b9\u5411\u5411\u4e0a\uff0c\u4e2d\u95f4\u53ea\u80fd\u76f4\u884c\u6216\u53f3\u8f6c\uff0c\u5e76\u4e14\u4e0d\u80fd\u91cd\u590d\u7ecf\u8fc7\u4e00\u4e2a\u70b9\uff0c\u5230\u8fbe\u7ec8\u70b9\u8def\u5f84\u6761\u6570\u3002\r\n\r\n\u7b54\u6848\u5bf9k\u53d6\u6a21\u3002\r\n\r\n- ## \u5206\u6790\r\n\r\n- ### \u6b63\u5e38dp\r\n\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u65e2\u7136\u53ea\u80fd\u53f3\u8f6c\uff0c\u90a3\u4e48\u8fd0\u52a8\u7684\u8def\u5f84\u5c31\u6070\u597d\u662f\u4e2a\u87ba\u65cb\u72b6\uff0c\u800c\u87ba\u65cb\u72b6\u7684\u672c\u8d28\u5c31\u662f\u4e00\u4e2a\u4e2a\u4e0d\u65ad\u7f29\u5c0f\u7684\u77e9\u9635\r\n\r\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u53d1\u73b0\uff0c\u53f3\u8f6c\u7684\u8fc7\u7a0b\u5b9e\u8d28\u4e0a\u662f\u5728\u5207\u5272\u5927\u77e9\u5f62\u3002\u5982\u56fe\uff0c\u7ea2\u7ebf\u4e3a\u8def\u5f84\uff0c\u9ed1\u7ebf\u4e3a\u77e9\u5f62\u3002\r\n\r\n![](https://cdn.luogu.com.cn/upload/image_hosting/uohppzrb.png)\r\n\r\n\r\n\u4ee4 $ f_{u,r,d,l,p} $ \u8868\u793a\u5728\u4e0a\u4e3a $ u $ \u4e0b\u4e3a $ d $ \u5de6\u4e3a $ l $ \u53f3\u4e3a $ r $ \u7684\u77e9\u9635\u4e0a\u65b9\u5411\u4e3a $ p $ (\u5176\u4e2d 0-3 \u5206\u522b\u8868\u793a\u4e0a\u53f3\u4e0b\u5de6\uff09\u7684\u8fb9\u4e0a\u8fd0\u52a8\u65f6\u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\u5c0f\u77e9\u5f62\u5c31\u662f\u5927\u77e9\u5f62\u7684\u5b50\u95ee\u9898\uff0c\u4e14\u6ee1\u8db3\u52a0\u6cd5\u539f\u7406\u3002\r\n\r\n\u90a3\u4e48\uff0c\u73b0\u5728\u6211\u4eec\u4e0d\u8003\u8651\u969c\u788d\u7269\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u7684\u65b9\u7a0b\u3002\u53ea\u8981\u679a\u4e3e\u5728\u54ea\u4e2a\u70b9\u7684\u5730\u65b9\u8f6c\u5f2f\u5373\u53ef\r\n\r\n$ f_{u,r,d,l,0}=\\Sigma f_{k,r,d,l+1,1} $\r\n\r\n$ f_{u,r,d,l,1}=\\Sigma f_{u+1,k,d,l,2} $\r\n\r\n$ f_{u,r,d,l,2}=\\Sigma f_{u,r-1,k,l,3} $\r\n\r\n$ f_{u,r,d,l,3}=\\Sigma f_{u,r,d-1,k,0} $\r\n\r\n\u82e5\u8003\u8651\u969c\u788d\u7269\uff0c\u5c31\u6709\u4e86\u8fd9\u6837\u7684\u4f2a\u4ee3\u7801\r\n```cpp\r\nfor(int k;;)\r\nf[u][r][d][l][0]+=f[k][r][d][l+1][0]*(\u8def\u5f84\u4e0a\u65e0\u969c\u788d?1:0) \r\nfor(int k;;)\r\nf[u][r][d][l][1]+=f[u+1][k][d][l][1]*(\u8def\u5f84\u4e0a\u65e0\u969c\u788d?1:0)\r\nfor(int k;;)\r\nf[u][r][d][l][2]+=f[u][r-1][k][l][2]*(\u8def\u5f84\u4e0a\u65e0\u969c\u788d?1:0)\r\nfor(int k;;)\r\nf[u][r][d][l][3]+=f[u][r][d-1][k][3]*(\u8def\u5f84\u4e0a\u65e0\u969c\u788d?1:0)\r\n```\r\n\u4e3a\u65b9\u4fbf\u8d77\u89c1\uff0c\u4ee5\u4e0b\u5c06(\u8def\u5f84\u4e0a\u65e0\u969c\u788d?1:0)\u7b80\u8bb0\u4e3a $ check(k) $\u3002\r\n\r\n\r\n- ### \u8003\u8651\u4f18\u5316\r\n\r\n\u4f46\u662f\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u6837\u590d\u6742\u5ea6\u662f $ O(n^5) $ \u7684\uff0c\u663e\u7136\u4f1a\u8d85\u65f6\uff0c\u5fc5\u987b\u628a $ k $ \u7684\u679a\u4e3e\u4f18\u5316\u6389\r\n\r\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u516c\u5f0f\r\n\r\n\u4ee5\u5411\u4e0a\u4e3a\u4f8b\uff0c\u6709\u5982\u4e0b\u5f0f\u5b50\r\n\r\n$ f_{u,r,d,l,0}=(\\Sigma f_{k,r,d,l+1,1} \\times check(k) )+f_{u,r,d,l+1,1} \\times check(u) =f_{u+1,r,d,l,0}+f_{u,r,d,l+1,1} \\times check(u)$\r\n\r\n\u6ca1\u6709\u4e86 $ k $ \u7684\u679a\u4e3e\uff0c\u77ac\u95f4\u53d8\u6210\u4e86 $ O(n^4) $ !\r\n\r\n\u4f46\u662f\u8fd9\u6837\u7684\u7a7a\u95f4\u4f9d\u65e7\u4f1a\u8d85\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u6eda\u52a8\u6570\u7ec4\uff0c\u7136\u540e\u53d1\u73b0\u6bcf\u6b21\u679a\u4e3e\u7684\u4e24\u4e2a\u5b50\u72b6\u6001\u90fd\u6ee1\u8db3\u884c\u6570\u548c\u5217\u6570\u7684\u548c\u521a\u597d\u6bd4\u539f\u72b6\u6001\u5c11 1\uff0c\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u6309\u884c\u5217\u6570\u4e4b\u548c\u4ece\u5c0f\u5230\u5927\u679a\u4e3e\u3002\r\n\r\n- ## \u6ce8\u610f\u4e8b\u9879\r\n\r\n\u8f93\u5165\u7ec8\u70b9\u5750\u6807\u65f6\uff0c\u5148\u8f93\u5165\u5217\u518d\u8f93\u5165\u884c\uff0c\u8bfb\u5165\u65f6\u5e94\u6ce8\u610f\r\n\r\n- ## \u4ee3\u7801\r\n```cpp\r\n/*\r\n\u6700\u521d\u7684\u65b9\u7a0b: \r\nf[u][r][d][l][\u4e0a]=\u2211f[k][r][d][l+1][\u53f3]*(\u8def\u5f84\u4e0a\u65e0\u969c\u788d?1:0) \r\nf[u][r][d][l][\u53f3]=\u2211f[u+1][k][d][l][\u4e0b]*(\u8def\u5f84\u4e0a\u65e0\u969c\u788d?1:0)\r\nf[u][r][d][l][\u4e0b]=\u2211f[u][r-1][k][l][\u5de6]*(\u8def\u5f84\u4e0a\u65e0\u969c\u788d?1:0)\r\nf[u][r][d][l][\u5de6]=\u2211f[u][r][d-1][k][\u4e0a]*(\u8def\u5f84\u4e0a\u65e0\u969c\u788d?1:0)\r\n\u8fd9\u4e2a\u663e\u7136\u662fn^5\u7684\uff0c\u65f6\u95f4\u4f1a\u70b8\r\n\u4f46\u662f\u6211\u4eec\u4ed4\u7ec6\u4e00\u770b\u5c31\u4f1a\u53d1\u73b0 \r\nf[u][r][d][l][\u4e0a]=\u2211f[k][r][d][l+1][\u53f3]*check(k)+f[u][r][d][l+1][\u53f3]*check(u)\r\nf[u][r][d][l][\u53f3]=\u2211f[u+1][k][d][l][\u4e0b]*check(k)+f[u+1][r][d][l][\u4e0b]*check(u)\r\nf[u][r][d][l][\u4e0b]=\u2211f[u][r-1][k][l][\u5de6]*check(k)+f[u][r-1][d][l][\u5de6]*check(u)\r\nf[u][r][d][l][\u5de6]=\u2211f[u][r][d-1][k][\u4e0a]*check(k)+f[u][r][d-1][l][\u4e0a]*check(u)\r\n\u5176\u4e2dk\u7684\u8303\u56f4\u4f1a\u7f29\u5c0f\u4e00\u6b65\u3002\r\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u8f6c\u79fb\u65b9\u7a0b\u53ef\u4ee5\u5199\u6210\u8fd9\u6837 \r\nf[u][r][d][l][\u4e0a]=f[u][r][d][l+1][\u53f3]*(\u8def\u5f84\u4e0a\u65e0\u969c\u788d?1:0)+f[u+1][r][d][l][\u4e0a]\r\nf[u][r][d][l][\u53f3]=f[u+1][r][d][l][\u4e0b]*(\u8def\u5f84\u4e0a\u65e0\u969c\u788d?1:0) +f[u][r-1][d][l][\u53f3]\r\nf[u][r][d][l][\u4e0b]=f[u][r-1][d][l][\u5de6]*(\u8def\u5f84\u4e0a\u65e0\u969c\u788d?1:0)+f[u][r][d-1][l][\u4e0b]\r\nf[u][r][d][l][\u5de6]=f[u][r][d-1][l][\u4e0a]*(\u8def\u5f84\u4e0a\u65e0\u969c\u788d?1:0)+f[u][r][d][l+1][\u5de6]\r\n\u4f46\u662f\u53d1\u73b0\u7a7a\u95f4\u4e0d\u591f\u7528 \r\n\u4e0d\u8fc7\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u7684\u662f\uff0c\u6bcf\u6b21\u8f6c\u79fb\uff0c\u884c\u6570+\u5217\u6570\u6070\u597d\u51cf\u5c111,\u7136\u540e\u521a\u597d\u8f6c\u79fb\u4e5f\u662f\u4e00\u6b65\u6b65\u6765\u7684\uff0c\u53ef\u4ee5\u6eda\u52a8\u6570\u7ec4\u4f18\u5316\u6389\r\n*/              \r\n#include<bits/stdc++.h>\r\nusing namespace std;\r\nint n,m,mod,y,x,s1[101][101],s2[101][101],dp[2][101][101][101][4];\r\nint main() {\r\n    cin>>n>>m>>mod>>y>>x;\r\n    for (int i=1;i<=n;++i)\r\n    for (int j=1;j<=m;++j)\r\n\t{\r\n        char c='.';\r\n        while (c!='+' && c!='*') c=getchar();\r\n        s1[i][j]=s1[i][j-1]+(c=='*'),\r\n        s2[i][j]=s2[i-1][j]+(c=='*');\r\n    }\r\n    for (int s=2;s<=n+m;s++)\r\n    for (int i=1;i<s;i++)\r\n    for(int l=1;l<=y&&l<=m-s+i+1;l++)\r\n\tfor(int u=1;u<=x&&u<=n-i+1;u++)\r\n    {\r\n    int d=u+i-1,r=l+s-i-1;\r\n    if (d<x||r<y) continue;\r\n\tdp[s&1][u][l][d][0]=(dp[(s-1)&1][u+1][l][d][0]+(s2[d][l]==s2[u-1][l])*(dp[(s&1)^1][u][l+1][d][1]+(u==x&&l==y)))%mod;\r\n\tdp[s&1][u][l][d][1]=(dp[(s-1)&1][u][l][d][1]+(s1[u][r]==s1[u][l-1])*(dp[(s&1)^1][u+1][l][d][2]+(u==x&&r==y)))%mod;\r\n    dp[s&1][u][l][d][2]=(dp[(s-1)&1][u][l][d-1][2]+(s2[d][r]==s2[u-1][r])*(dp[(s&1)^1][u][l][d][3]+(d==x&&r==y)))%mod;\r\n    dp[s&1][u][l][d][3]=(dp[(s-1)&1][u][l+1][d][3]+(s1[d][r]==s1[d][l-1])*(dp[(s&1)^1][u][l][d-1][0]+(d==x&&l==y)))%mod;\r\n    }\r\n    cout<<dp[(n+m)&1][1][1][n][0];\r\n}\r\n```\r\n\r\n",
        "postTime": 1625465018,
        "uid": 147670,
        "name": "\u91d1\u73c2\u62c9",
        "ccfLevel": 0,
        "title": "P3473"
    }
]