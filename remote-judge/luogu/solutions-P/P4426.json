[
    {
        "content": "## [\u9898\u610f](https://blog.csdn.net/BeNoble_/article/details/80036891)\n\n\u6c42\u4e00\u5e45\u56fe\u7684\u6700\u5927\u72ec\u7acb\u96c6\u65b9\u6848\u6570\n\n$n\\le10^5,$\u6ee1\u8db3\u975e\u6811\u8fb9$\\le11$\u6761\n\n---\n\n$AFO$\u4e4b\u540e\u8fd9\u7bc7\u9898\u89e3\u6401\u4e86\u597d\u4e45$=.=$\n\n---\n\n## \u9898\u89e3\n\n### $1.$\u8003\u8651\u4e00\u68f5\u6811\u600e\u4e48\u505a\n\n\u548c\u666e\u901a\u6c42\u72ec\u7acb\u96c6\u4e00\u6837\u679a\u4e3e\u8fd9\u4e2a\u70b9\u9009\u4e0d\u9009\u7136\u540e\u7528\u4e58\u6cd5\u539f\u7406\u8ba1\u7b97\u5373\u53ef\n\n```\nf[u][1]=f[u][1]*f[v][0];\nf[u][0]=f[u][0]*(f[v][0]+f[v][1]);\n```\n\n### $2.$\u8003\u8651\u600e\u4e48\u5904\u7406\u975e\u6811\u8fb9\n\n\u56e0\u4e3a\u53ea\u6709$11$\u6761\u975e\u6811\u8fb9$,$\u6240\u4ee5\u53ef\u4ee5\u679a\u4e3e\u8fd9\u4e9b\u8fb9\u7684\u4e24\u4e2a\u7aef\u70b9\u7684\u9009\u62e9\u60c5\u51b5\n\n\u53ef\u4ee5\u53d1\u73b0\u53ea\u6709$3$\u79cd\u60c5\u51b5$(1,0),(0,0),(0,1)$\n\n\u4f46\u662f\u5b9e\u9645\u4e0a\u53ef\u4ee5\u53d1\u73b0\u53ea\u9700\u8981\u679a\u4e3e\u4e0a\u9762\u90a3\u4e2a\u70b9\u9009\u4e0d\u9009$,$\u5373$(0,0)$\u548c$(0,1)$\u53ef\u4ee5\u5408\u5e76\u8d77\u6765\n\n\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e00\u79cd\u72b6\u6001\u518d\u6734\u7d20\u505a\u4e00\u904d\u6811$DP$\n\n\u590d\u6742\u5ea6$O(2^{m-n+1}n)$\n\n```\n#include<bits/stdc++.h>\n#define fp(i,a,b) for(register int i=a,I=b+1;i<I;++i)\n#define fd(i,a,b) for(register int i=a,I=b-1;i>I;--i)\n#define go(u) for(register int i=fi[u],v=e[i].to;i;v=e[i=e[i].nx].to)\n#define file(s) freopen(s\".in\",\"r\",stdin),freopen(s\".out\",\"w\",stdout)\ntemplate<class T>inline bool cmax(T&a,const T&b){return a<b?a=b,1:0;}\ntemplate<class T>inline bool cmin(T&a,const T&b){return a>b?a=b,1:0;}\nusing namespace std;\nchar ss[1<<17],*A=ss,*B=ss;\ninline char gc(){return A==B&&(B=(A=ss)+fread(ss,1,1<<17,stdin),A==B)?-1:*A++;}\ntemplate<class T>inline void sd(T&x){\n    char c;T y=1;while(c=gc(),(c<48||57<c)&&c!=-1)if(c==45)y=-1;x=c-48;\n    while(c=gc(),47<c&&c<58)x=x*10+c-48;x*=y;\n}\nchar sr[1<<21],z[20];int C=-1,Z;\ninline void Ot(){fwrite(sr,1,C+1,stdout),C=-1;}\ntemplate<class T>inline void we(T x){\n    if(C>1<<20)Ot();if(x<0)sr[++C]=45,x=-x;\n    while(z[++Z]=x%10+48,x/=10);\n    while(sr[++C]=z[Z],--Z);sr[++C]='\\n';\n}\nconst int N=1e5+5,P=998244353;\ntypedef int arr[N];\ntypedef long long ll;\nstruct eg{int nx,to;}e[N<<1];\nint n,m,ans,dft,Cnt,f[N][2],fg[N][2];arr fi,fa,eu,ev,Mi,dfn,vis;\ninline int pls(int a,int b){return a+=b,a<P?a:a-P;}\nvoid dfs(int u){\n    dfn[u]=++dft;\n    go(u)if(v^fa[u]){\n        if(!dfn[v])fa[v]=u,dfs(v);\n        else if(dfn[u]<dfn[v])eu[++Cnt]=u,ev[Cnt]=v;\n    }\n}\nvoid dp(int u){\n    f[u][0]=!fg[u][1],f[u][1]=!fg[u][0],vis[u]=1;\n    go(u)if(!vis[v]){\n        dp(v);\n        f[u][1]=(ll)f[u][1]*f[v][0]%P;\n        f[u][0]=(ll)f[u][0]*(f[v][0]+f[v][1])%P;\n    }\n}\ninline void add(int u,int v){static int ce=0;e[++ce]={fi[u],v},fi[u]=ce;}\nint main(){\n    #ifndef ONLINE_JUDGE\n        file(\"s\");\n    #endif\n    sd(n),sd(m);int u,v;\n    fp(i,1,m)sd(u),sd(v),add(u,v),add(v,u);\n    dfs(1);Mi[1]=1;fp(i,2,Cnt)Mi[i]=Mi[i-1]<<1;\n    fp(s,0,(1<<Cnt)-1){\n        fp(i,1,Cnt)\n            if(s&Mi[i])fg[eu[i]][1]=fg[ev[i]][0]=1;\n            else fg[eu[i]][0]=1;\n        fp(i,1,n)vis[i]=0;dp(1);ans=pls(ans,pls(f[1][1],f[1][0]));\n        fp(i,1,Cnt)\n            if(s&Mi[i])fg[eu[i]][1]=fg[ev[i]][0]=0;\n            else fg[eu[i]][0]=0;\n    }\n    printf(\"%d\\n\",ans);\nreturn 0;\n}\n```\n\n~~\u8fd9\u6837\u5c31\u53ef\u4ee5\u62ff\u5230$75$\u5206\u4e86~~\n\n### $3.$\u8003\u8651\u600e\u4e48\u4f18\u5316\n\n\u53ef\u4ee5\u53d1\u73b0\u4e0a\u9762\u7684~~\u66b4\u529b~~\u7b97\u6cd5\u4e2d\u6709\u5f88\u591a\u72b6\u6001\u90fd\u662f\u91cd\u590d\u8ba1\u7b97\u4e86\u7684\n\n\u6211\u4eec\u628a\u8fde\u6709\u975e\u6811\u8fb9\u7684\u70b9\u5f53\u505a\u5173\u952e\u70b9\n\n\u56e0\u4e3a\u6bcf\u6b21\u5f71\u54cd$DP$\u503c\u7684\u5c31\u53ea\u6709\u8fd9\u4e9b\u5173\u952e\u70b9\n\n\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5efa\u51fa\u8fd9$22$\u4e2a\u5173\u952e\u70b9\u7684\u865a\u6811\n\n\u5bf9\u4e8e\u865a\u6811\u4e0a\u4e00\u6761\u8fb9$u\\to v,dp$\u65b9\u7a0b\u53ef\u4ee5\u5316\u4e3a\n\n$$f[u][0/1]=\\prod k_{v,0/1,0}f[v][0]+k_{v,0/1,1}f[v][1]$$\n\n\u53ef\u4ee5\u53d1\u73b0\u6bcf\u6761\u8fb9\u7684\u7cfb\u6570\u662f\u4e0d\u4f1a\u6539\u53d8\u7684\n\n\u6240\u4ee5\u5173\u952e\u5c31\u5728\u4e8e\u600e\u4e48\u6c42\u51fa\u6bcf\u4e00\u6761\u8fb9\u7684\u7cfb\u6570\n\n\u5bf9\u4e8e\u4e00\u6761\u865a\u6811\u8fb9$u\\to v,$\u5c06\u539f\u6811\u4e2d$u\\to v$\u7684\u8def\u5f84\u63d0\u51fa\u6765\n\n\u4ece$v$\u8282\u70b9\u5411\u4e0a\u8df3\u5e76\u66b4\u529b\u8f6c\u79fb\u7cfb\u6570$,$\u82e5\u9047\u5230\u5206\u53c9\u5219\u989d\u5916\u8f6c\u79fb\u4e0a\u5206\u53c9\u5904\u7684\u7cfb\u6570\n\n\u5982\u679c\u9047\u5230\u4e00\u4e2a\u65b0\u7684\u5173\u952e\u70b9\u5c31\u91cd\u7f6e\u7cfb\u6570\n\n\u6839\u636e\u865a\u6811\u7684\u6027\u8d28$,$\u4e00\u4e2a\u5206\u53c9\u70b9\u8981\u4e48\u662f\u5173\u952e\u70b9\u8981\u4e48\u5b50\u6811\u91cc\u5c31\u4e00\u4e2a\u5173\u952e\u70b9\n\n\u53ef\u4ee5\u53d1\u73b0\u8fd9\u6837\u8f6c\u79fb\u7684\u603b\u590d\u6742\u5ea6\u662f$O(n)$\u7684\n\n\u5bf9\u4e8e\u865a\u6811\u4e0a\u7684\u8fb9\u6211\u4eec\u8fd8\u662f\u6309\u7167\u4e0a\u9762\u7684\u60f3\u6cd5\u679a\u4e3e\u7aef\u70b9\u7684\u60c5\u51b5\n\n\u4ee4$s=m-n+1,$\u90a3\u4e48\u590d\u6742\u5ea6\u5c31\u662f$O(n+s2^s)$\n\n```\n#include<bits/stdc++.h>\n#define fp(i,a,b) for(register int i=a,I=b+1;i<I;++i)\n#define fd(i,a,b) for(register int i=a,I=b-1;i>I;--i)\n#define go(u) for(register int i=fi[u],v=e[i].to;i;v=e[i=e[i].nx].to)\n#define file(s) freopen(s\".in\",\"r\",stdin),freopen(s\".out\",\"w\",stdout)\ntemplate<class T>inline bool cmax(T&a,const T&b){return a<b?a=b,1:0;}\ntemplate<class T>inline bool cmin(T&a,const T&b){return a>b?a=b,1:0;}\nusing namespace std;\nchar ss[1<<17],*A=ss,*B=ss;\ninline char gc(){return A==B&&(B=(A=ss)+fread(ss,1,1<<17,stdin),A==B)?-1:*A++;}\ntemplate<class T>inline void sd(T&x){\n    char c;T y=1;while(c=gc(),(c<48||57<c)&&c!=-1)if(c==45)y=-1;x=c-48;\n    while(c=gc(),47<c&&c<58)x=x*10+c-48;x*=y;\n}\nchar sr[1<<21],z[20];int C=-1,Z;\ninline void Ot(){fwrite(sr,1,C+1,stdout),C=-1;}\ntemplate<class T>inline void we(T x){\n    if(C>1<<20)Ot();if(x<0)sr[++C]=45,x=-x;\n    while(z[++Z]=x%10+48,x/=10);\n    while(sr[++C]=z[Z],--Z);sr[++C]='\\n';\n}\nconst int N=1e5+15,P=998244353;\ntypedef int arr[N];\ntypedef long long ll;\nstruct eg{int nx,to;}e[N<<1];\nint n,m,ans,dft,Cnt,f[N][2],p[N][2],fg[N][2];arr fi,fa,sz,eu,ev,Mi,dfn,vis,mark;\nvoid dfs(int u){\n    dfn[u]=++dft;\n    go(u)if(v^fa[u]){\n        if(!dfn[v])fa[v]=u,dfs(v),sz[u]+=sz[v];\n        else{mark[u]=1;\n            if(dfn[u]<dfn[v])eu[++Cnt]=u,ev[Cnt]=v;\n        }\n    }mark[u]|=sz[u]>=2;sz[u]=sz[u]||mark[u];\n}\ninline int pls(int a,int b){return a+=b,a<P?a:a-P;}\nstruct Coe{\n    int x,y;\n    inline Coe operator+(const Coe b){return{pls(x,b.x),pls(y,b.y)};}\n    inline Coe operator*(const int b){return{int((ll)x*b%P),int((ll)y*b%P)};}\n}k[N][2];\nstruct Vg{int nx,to;Coe a,b;}E[N];int Fi[N];\ninline void ADD(int u,int v,Coe a,Coe b){static int ce=0;E[++ce]={Fi[u],v,a,b},Fi[u]=ce;}\nint Vt(int u){\n    p[u][0]=p[u][1]=1;vis[u]=1;int pos=0,w;\n    go(u)if(!vis[v]){\n        w=Vt(v);\n        if(!w){\n            p[u][1]=(ll)p[u][1]*p[v][0]%P;\n            p[u][0]=(ll)p[u][0]*(p[v][0]+p[v][1])%P;\n        }else if(mark[u])ADD(u,w,k[v][0]+k[v][1],k[v][0]);\n        else k[u][1]=k[v][0],k[u][0]=k[v][0]+k[v][1],pos=w;\n    }\n    if(mark[u])k[u][0]={1,0},k[u][1]={0,1},pos=u;\n    else k[u][0]=k[u][0]*p[u][0],k[u][1]=k[u][1]*p[u][1];\n    return pos;\n}\nvoid dp(int u){\n    f[u][0]=fg[u][1]?0:p[u][0],\n    f[u][1]=fg[u][0]?0:p[u][1];\n    for(int i=Fi[u],v=E[i].to;i;v=E[i=E[i].nx].to){\n        dp(v);int p=f[v][0],q=f[v][1];\n        f[u][0]=(ll)f[u][0]*((ll)E[i].a.x*p%P+(ll)E[i].a.y*q%P)%P;\n        f[u][1]=(ll)f[u][1]*((ll)E[i].b.x*p%P+(ll)E[i].b.y*q%P)%P;\n    }\n}\ninline void add(int u,int v){static int ce=0;e[++ce]={fi[u],v},fi[u]=ce;}\nint main(){\n    #ifndef ONLINE_JUDGE\n        file(\"s\");\n    #endif\n    sd(n),sd(m);int u,v;\n    fp(i,1,m)sd(u),sd(v),add(u,v),add(v,u);\n    dfs(1);mark[1]=1;\n\tVt(1);Mi[1]=1;fp(i,2,Cnt)Mi[i]=Mi[i-1]<<1;\n    fp(s,0,(1<<Cnt)-1){\n        fp(i,1,Cnt)\n            if(s&Mi[i])fg[eu[i]][1]=fg[ev[i]][0]=1;\n            else fg[eu[i]][0]=1;\n        dp(1);ans=pls(ans,pls(f[1][1],f[1][0]));\n        fp(i,1,Cnt)\n            if(s&Mi[i])fg[eu[i]][1]=fg[ev[i]][0]=0;\n            else fg[eu[i]][0]=0;\n    }\n    printf(\"%d\\n\",ans);\nreturn 0;\n}\n```",
        "postTime": 1524365610,
        "uid": 20156,
        "name": "Kelin",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4426 \u3010[HNOI/AHOI2018]\u6bd2\u7624\u3011"
    },
    {
        "content": "\u601d\u8def\u975e\u5e38\u7cbe\u5999\u7684\u4e00\u9053\u865a\u6811\u9898\n\n\u7b80\u5355\u9898\u610f\uff1a\u7ed9\u4e00\u5f20\u56fe\uff0c\u6c42\u8fd9\u5f20\u56fe\u4e0a\u7684\u72ec\u7acb\u96c6\u6570\u91cf\n\n\u5bf9\u4e8e\u4e00\u68f5\u6811\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u8bbe$dp_{u,0/1}$\u8868\u793a\u8282\u70b9$u$\u9009/\u4e0d\u9009\u7684\u65b9\u6848\u6570\n\n\u663e\u7136\u6709\uff1a\n\n$$dp_{u,0}=\\prod (dp_{v,1}+dp_{v,0})$$\n\n$$dp_{u,1}=\\prod dp_{v,0}$$\n\n\u63a5\u4e0b\u6765\u8003\u8651\u975e\u6811\u8fb9\n\n\u6b63\u5e38$dp$\u7684\u8bdd\u90a3\u4e48\u8f6c\u79fb\u5e94\u8be5\u662f$O(n)$\u7684\n\n\u6211\u4eec\u53d1\u73b0\u975e\u6811\u8fb9\u5f88\u5c11\uff0c\u6240\u4ee5\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6765\uff0c\u7136\u540e\u679a\u4e3e\u5176\u8fde\u63a5\u7684\u4e24\u70b9\u4e4b\u95f4\u7684\u72b6\u6001\n\n\u4e0d\u96be\u53d1\u73b0\u72b6\u6001\u53ea\u6709\u5982\u4e0b\u4e09\u79cd\uff1a$(0,0),(0,1),(1,0)$\n\n\u53ef\u4ee5\u53d1\u73b0$(0,0)$\u548c$(0,1)$\u53ef\u4ee5\u5408\u5e76\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u53ea\u9700\u8981\u679a\u4e3e\u6240\u6709\u7684\u975e\u6811\u8fb9\u5176\u8fde\u63a5\u7684$\\rm dfn$\u8f83\u5c0f\u7684\u70b9\u7684\u72b6\u6001\u5c31\u53ef\u4ee5\u4e86\n\n\u590d\u6742\u5ea6$O(n*2^{11})$\u53ef\u4ee5\u5f97\u5230$75pts$\u7684\u9ad8\u5206\n\n\u63a5\u4e0b\u6765\u662f\u4e00\u4e2a\u5f88\u5999\u7684\u505a\u6cd5\uff1a\n\n\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5c06\u6240\u6709\u975e\u6811\u8fb9\u4e0a\u7684\u70b9\u62ff\u4e0b\u6765\u5efa\u865a\u6811\n\n\u8fd9\u5e94\u8be5\u662f\u4e00\u4e2a\u5927\u5c0f$\\le(44+1)$\u7684\u865a\u6811\n\n\u6ce8\u610f\u5230\uff0c\u6211\u4eec\u7684$dp$\u8f6c\u79fb\u672c\u5e94\u5982\u6b64\uff1a\n\n\n$$dp_{u,0}=\\prod (dp_{v,1}+dp_{v,0})$$\n\n$$dp_{u,1}=\\prod dp_{v,0}$$\n\n\u4f46\u662f\u653e\u5728\u865a\u6811\u4e0a\u8fd9\u6837\u663e\u7136\u662f\u9519\u7684\n\n\u6211\u4eec\u53d1\u73b0\u865a\u6811\u662f\u7ef4\u62a4\u4e86\u70b9\u4e4b\u95f4\u7684\u5173\u7cfb\u5e76\u6784\u5efa\u4e86\u5176$lca$\uff0c\u6240\u4ee5\u865a\u6811\u4e0a\u7684\u70b9\u548c\u5176\u7236\u4eb2\u4e24\u4e24\u4e4b\u95f4\u662f\u4e00\u6761\u94fe\u7684\u5173\u7cfb\n\n\u6211\u4eec\u4ed4\u7ec6\u601d\u8003\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u5c45\u7136\u53ea\u662f\u989d\u5916\u9644\u5e26\u4e86\u4e00\u4e2a\u7cfb\u6570\u800c\u5df2...\n\n\u4e0d\u59a8\u8bbe\u865a\u6811\u4e0a\u7684\u4e00\u6761\u8fb9$u,v$\u4e3a$u->k_1->k_2...->k_r->v$\uff0c\u663e\u7136\u4e2d\u95f4\u662f\u6ca1\u6709\u5176\u4ed6\u5173\u952e\u70b9\u7684\n\n\u6211\u4eec\u53d1\u73b0$v$\u5bf9\u4e8e$u$\u9020\u6210\u7684\u8d21\u732e\u5b9e\u9645\u4e0a\u662f\u53ef\u4ee5\u8ba1\u7b97\u51fa\u6765\u7684\n\n\u56e0\u4e3a\u6ca1\u6709\u5176\u4ed6\u513f\u5b50\uff0c\u6240\u4ee5$k_r$\u672c\u8eab\u7684$dp$\u503c\u53ef\u4ee5\u8ba1\u7b97\u51fa\u6765\uff0c\u8003\u8651$dp_{v,0}$\u5bf9\u5176\u9020\u6210\u7684\u8d21\u732e\uff0c\u6709\uff1a$dp_{k_r,1}*=dp_{v,0},dp_{k_r,0}*=(dp_{v,0}+dp_{v,1})$\n\n$dp_{k_{r-1},1}*=dp_{k_r,0}$\u5373$dp_{k_{r-1},1}*=(dp_{k_r,0}'*(dp_{v,0}+dp_{v,1}))$\n\n$dp_{k_{r-1},0}*=(dp_{k_r,0}+dp_{k_r,1})$\u5373$dp_{k_{r-1},0}*=(dp_{k_r,0}'*(dp_{v,0}+dp_{v,1})+dp_{k_r,1}'*dp_{v,0})$\n\n\u597d\u50cf\u8fd9\u6837\u7c7b\u4f3c\u4e0b\u53bb\u8fd9\u6837\u7684\u7cfb\u6570\u662f\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6765\u7684\u6b38\u6b38\u6b38\uff1f\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u628a\u865a\u6811\u4e0a\u7684\u8f6c\u79fb\u5f0f\u6539\u6210\u8fd9\u6837\uff1a\n\n$$dp_{u,0}=\\prod(k_{v,1->0}*dp_{v,1}+k_{v,0->0}*dp_{v,0})$$\n\n$$dp_{u,1}=\\prod(k_{v,1->1}*dp_{v,1}+k_{v,0->1}*dp_{v,0})$$\n\n\u5269\u4e0b\u7684\u5de5\u4f5c\u5c31\u662f\u9884\u5904\u7406\u7cfb\u6570\u4e86qwq\n\n\u6211\u4eec\u8003\u8651\u5982\u4f55\u6c42\u89e3\u7cfb\u6570\uff0c\u6211\u4eec\u7c7b\u6bd4\u4e8e\u4e0a\u9762\u5c55\u5f00\u90a3\u4e2a\u5f0f\u5b50\u7684\u8fc7\u7a0b\uff0c\u5c06\u5176\u4e2d\u7684$dp_{kr,0/1}'$\u6362\u6210\u5230\u90a3\u4e2a\u70b9\u65f6\u5019\u7684\u7cfb\u6570\n\n\u5c31\u53ef\u4ee5\u5f97\u5230\u7cfb\u6570\u7684\u9012\u63a8\u5f0f\u4e86\uff0c\u5177\u4f53\u5c55\u5f00\u975e\u5e38\u9ebb\u70e6\uff0c\u5c31\u4e0d\u5199\u4e86\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u5728\u865a\u6811\u4e0a$dp$\uff0c\u4ec5\u4ec5\u7ed9\u6bcf\u4e2a\u70b9\u989d\u5916\u9644\u4e0a\u4e00\u4e2a\u7cfb\u6570\u5c31\u53ef\u4ee5\u4e86\u5417\uff1f\n\n\u5f53\u7136\u662f\u4e0d\u884c\u7684\uff0c\u6bcf\u4e2a\u70b9\u7684$dp$\u521d\u503c\u4e5f\u4e0d\u662f\u6211\u4eec\u4e00\u5f00\u59cb\u6240\u8bf4\u7684$dp$\u503c$1$\u4e86\n\n\u6240\u4ee5\u6211\u4eec\u8fd8\u8981\u5bf9\u865a\u6811\u4e0a\u7684\u6bcf\u4e2a\u70b9\u505a$dp$\u4ee5\u8ba1\u7b97\u521d\u503c\uff0c\u4e0d\u8fc7\u8fd9\u4e00\u6b65\u76f8\u5bf9\u7b80\u5355\uff0c\u56e0\u4e3a\u4ed4\u7ec6\u8003\u8651\u6211\u4eec\u4f1a\u53d1\u73b0\u5982\u679c\u4e00\u4e2a\u70b9\u7684\u67d0\u68f5\u5b50\u6811\u5185\u6709\u88ab\u6807\u8bb0\u7684\u70b9\uff0c\u90a3\u4e48\u663e\u7136\u8fd9\u4e2a\u5b50\u6811\u4f1a\u88ab\u8868\u793a\u6210\u865a\u6811\u4e0a\u7684\u4e00\u6761\u8fb9\uff0c\u7cfb\u6570\u5df2\u7ecf\u8ba1\u7b97\u51fa\u6765\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u5b9e\u9645\u4e0a\u8981\u5904\u7406\u7684$dp$\u503c\u53ea\u6709\u90a3\u4e9b\u5b50\u6811\u5185\u6ca1\u6709\u88ab\u6807\u8bb0\u70b9\u7684$dp$\u503c\n\n\u4e00\u9053\u865a\u6811\u7684\u9898\u6211\u786c\u751f\u751f\u5199\u4e86$5kb$....\u6c57\uff0c\u4e0d\u4e8f\u662f[\u6bd2\u7624]\n\n\n\u4e0d\u8fc7\u6211\u7684\u4ee3\u7801\u5e94\u8be5\u8fd8\u6bd4\u8f83\u6e05\u6670qwq\n\n\u8bbe$s=m-n+1$\uff0c\u5c3d\u7ba1\u5efa\u6811\u770b\u4f3c\u50cf\u904d\u5386\u4e86$s$\u904d\u5168\u6811\uff0c\u4f46\u5b9e\u9645\u4e0a\u53ea\u6709\u4e00\u904d....\n\n\u6240\u4ee5\u590d\u6742\u5ea6\u4e3a$O(n+s*2^s)$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define Next2( i, x ) for( register int i = fire[x]; i; i = p[i].next ) \n#define Next( i, x ) for( register int i = head[x]; i; i = e[i].next )\n#define rep( i, s, t ) for( register int i = s; i <= t; ++ i )\n#define re register\n#define int long long \nint gi() {\n\tchar cc = getchar(); int cn = 0, flus = 1;\n\twhile(cc < '0' || cc > '9') {  if( cc == '-' ) flus = -flus;  cc = getchar();  }\n\twhile(cc >= '0' && cc <= '9')  cn = cn * 10 + cc - '0', cc = getchar();\n\treturn cn * flus;\n}\nconst int P = 998244353 ; \nconst int N = 1e5 + 5 ;\nconst int M = 55 ; \nint dp[N][2], dfn[N], head[N], fire[N], Ans, n, m, cnt ;\nint num, Cnt, Fr[N], Ed[N], vis[N], s[M], top, Rev[N][2] ; \nint Fa[N], Top[N], dep[N], sz[N], Son[N], k0[N][2], k1[N][2] ; \nstruct E {\n\tint to, next ; \n} e[N * 2], p[N * 2] ;\nvoid add( int x, int y ) {\n\te[++ cnt] = (E){ y, head[x] }, head[x] = cnt , \n\te[++ cnt] = (E){ x, head[y] }, head[y] = cnt ; \n}\nvoid add2( int x, int y ) {\n\tp[++ cnt] = (E){ y, fire[x] }, fire[x] = cnt ,\n\tp[++ cnt] = (E){ x, fire[y] }, fire[y] = cnt ;  \n}\n//\u5efa\u6811 \ninline void dfs( int x, int fa ) {\n\tdfn[x] = ++ num, Fa[x] = fa, dep[x] = dep[fa] + 1, sz[x] = 1 ; \n\tNext( i, x ) {\n\t\tint v = e[i].to ; if( v == fa ) continue ; \n\t\tif( !dfn[v] ) {\n\t\t\tdfs( v, x ), sz[x] += sz[v] ;\n\t\t\tif( sz[v] > sz[Son[x]] ) Son[x] = v ; \n\t\t}\n\t\telse if( dfn[v] < dfn[x] ) Fr[++ Cnt] = v, Ed[Cnt] = x, vis[v] = vis[x] = 1 ; \n\t}\n}\ninline void dfs2( int x, int high ) {\n\tTop[x] = high ; \n\tif( Son[x] ) dfs2( Son[x], high ), vis[x] += vis[Son[x]] ;\n\tNext( i, x ) {\n\t\tint v = e[i].to ; if( v == Fa[x] || v == Son[x] ) continue ; \n\t\tdfs2( v, v ), vis[x] += vis[v] ;\n\t}\n}\nint LCA( int x, int y ) {\n\twhile( Top[x] != Top[y] ) {\n\t\tif( dep[Top[x]] < dep[Top[y]] ) swap( x, y ) ;\n\t\tx = Fa[Top[x]] ; \n\t}\n\treturn ( dep[x] > dep[y] ) ? y : x ; \n}\nint K[50], tot ; \nbool cmp( int x, int y ) {\n\treturn dfn[x] < dfn[y] ; \n}\ninline void insert( int x ) {\n\tif( top == 1 && x != 1 ) { s[++ top] = x ; return ; }\n\tint lca = LCA( s[top], x ) ; if( lca == x ) return ; \n\twhile( top > 1 && dfn[lca] < dfn[s[top - 1]] ) add2( s[top - 1], s[top] ), -- top ;\n\tif( dfn[lca] < dfn[s[top]] ) add2( lca, s[top] ), -- top ;\n\tif( dfn[lca] > dfn[s[top]] ) s[++ top] = lca ; \n\ts[++ top] = x ; \n}\n//\u5efa\u7acb\u865a\u6811 \nvoid Maker() {\n\tcnt = 0 ;\n\trep( i, 1, Cnt ) K[++ tot] = Fr[i], K[++ tot] = Ed[i] ; \n\tsort( K + 1, K + tot + 1, cmp ) ; s[top = 1] = 1 ; \n\trep( i, 1, tot ) insert( K[i] ) ;\n\twhile( top > 1 ) add2( s[top - 1], s[top] ), -- top ;\n}\nvoid init() {\n\tn = gi(), m = gi() ; \n\trep( i, 1, m ) add( gi(), gi() ) ; cnt = 0 ; \n\tdfs( 1, 1 ), memset( head, 0, sizeof(head) ) ;\n\trep( i, 1, n ) if( Fa[i] != i ) add( Fa[i], i ) ;\n\tdfs2( 1, 1 ), Maker() ; \n}\n//\u8f85\u52a9\u8ba1\u7b97\u7cfb\u6570 \ninline void DP( int x, int u ) {\n\tdp[x][1] = dp[x][0] = 1 ; \n\tNext( i, x ) {\n\t\tint v = e[i].to ; if( v == Fa[x] || v == u ) continue ; \n\t\tDP( v, x ), dp[x][1] *= dp[v][0], dp[x][1] %= P ;\n\t\tdp[x][0] *= ( dp[v][1] + dp[v][0] ), dp[x][0] %= P ; \n\t}\n}\n//\u8ba1\u7b97\u7cfb\u6570... \ninline void Get( int u, int fa ) {\n\tint v = u ; k0[u][0] = 1, k0[u][1] = 1, k1[u][0] = 1 ; \n\twhile( Fa[v] != fa ) {\n\t\tDP( Fa[v], v ) ; int r0 = k0[u][0], r1 = k0[u][1] ;\n\t\tk0[u][0] = ( dp[Fa[v]][0] * r0 + dp[Fa[v]][1] * k1[u][0] ) % P ;\n\t\tk0[u][1] = ( dp[Fa[v]][0] * r1 + dp[Fa[v]][1] * k1[u][1] ) % P ;\n\t\tk1[u][1] = dp[Fa[v]][0] * r1 % P, k1[u][0] = dp[Fa[v]][0] * r0 % P ;\n\t\tv = Fa[v] ; \n\t}\n}\n//\u8ba1\u7b97dp\u521d\u503c \ninline void Get_DP( int x, int fa ) {\n\tRev[x][0] = Rev[x][1] = 1 ; \n\tNext( i, x ) {\n\t\tint v = e[i].to ; if( v == fa || vis[v] ) continue ; \n\t\tGet_DP( v, x ), Rev[x][0] *= ( Rev[v][0] + Rev[v][1] ), Rev[x][0] %= P ;\n\t\tRev[x][1] *= Rev[v][0], Rev[x][1] %= P ;\n\t}\n} \n//\u8ba1\u7b97\u51fa\u6bcf\u6761\u8fb9\u7684\u7cfb\u6570\uff0c\u6bcf\u4e2a\u70b9\u7684dp\u521d\u503c \ninline void dfs_init( int x, int fa ) {\n\tGet_DP( x, fa ), K[++ tot] = x ; \n\tif( x != fa ) Get( x, fa ) ;\n\tNext2( i, x ) {\n\t\tint v = p[i].to ; if( v == fa ) continue ;\n\t\tdfs_init( v, x ) ; \n\t}\n}\n//\u771f\u6b63\u7684dp\uff0c\u524d\u9762\u7684\u90fd\u662f\u9884\u5904\u7406 \ninline void Dp( int x, int fa ) {\n\tNext2( i, x ) {\n\t\tint v = p[i].to ; if( v == fa ) continue ; \n\t\tDp( v, x ) ; dp[x][0] *= ( k0[v][0] * dp[v][0] % P + k0[v][1] * dp[v][1] % P ), dp[x][0] %= P ;\n\t\tdp[x][1] *= ( k1[v][0] * dp[v][0] % P + k1[v][1] * dp[v][1] % P ), dp[x][1] %= P ;\n\t}\n}\nsigned main()\n{\n\tinit(), tot = 0, dfs_init( 1, 1 ) ; \n\tint maxn = ( 1 << Cnt ) - 1 ;\n\trep( i, 0, maxn ) {\n\t\trep( i, 1, tot ) dp[K[i]][0] = Rev[K[i]][0], dp[K[i]][1] = Rev[K[i]][1] ; \n\t\tfor( re int j = 1; j <= Cnt; ++ j ) {\n\t\t\tif( ( 1 << ( j - 1 ) ) & i ) dp[Fr[j]][0] = 0, dp[Ed[j]][1] = 0 ; \n\t\t\telse dp[Fr[j]][1] = 0 ; \n\t\t}\n\t\tDp( 1, 1 ), Ans = ( Ans + dp[1][0] + dp[1][1] ) % P ;\n\t}\n\tprintf(\"%d\\n\", Ans % P ) ;\n\treturn 0;\n}\n```",
        "postTime": 1569120822,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4426 \u3010[HNOI/AHOI2018]\u6bd2\u7624\u3011"
    },
    {
        "content": "\u5927\u5bb6\u597d\u6211\u975e\u5e38\u559c\u6b22\u786c\u6838\u6570\u636e\u7ed3\u6784\uff0c\u6240\u4ee5\u6572\u4e86\u4e2a\u52a8\u6001dp\u8fc7\u4e86\u8fd9\u9898\n\n\u53ef\u80fd\u5e38\u6570\u6709\u70b9\u4e22\u4eba(\u5176\u5b9e\u5c31\u662f\u6811\u7684\u70b9\u4f1a\u8dd1200\u6765ms)\u7136\u540e\u4ee3\u7801\u91cf\u4f3c\u4e4e\u548c\u5f88\u591a\u4eba\u5dee\u4e0d\u591a\uff1f(4k\u5de6\u53f3)\n\n\u8fd9\u91cc\u5f3a\u70c8\u5b89\u5229\u4e00\u4e0b\u5168\u5c40\u5e73\u8861\u4e8c\u53c9\u6811\u8fd9\u4e2a\u52a8\u6001dp\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u8fd9\u4e2a\u7b97\u6cd5\u6709\u4e00\u4e2a\u597d\u5904\u5c31\u662f\u5e38\u6570\u771f\u7684\u5c0f\uff0c\u6240\u4ee5\u5c31\u7b97\u4f60\u80e1\u4e71\u5b9e\u73b0\u4e5f\u80fd\u8fc7\u9898(\u5c3d\u7ba1\u8fd9\u4e1c\u897f\u901a\u5e38\u4e0d\u662f\u6807\u7b97\u4f46\u662f1e5\u5185\u5361\u4e0d\u4f4f)\u6bd4\u5982\u4eca\u5e74noip\u7684d2t3\u4e5f\u80fd\u62ff\u8fd9\u4e2a\u7b97\u6cd5\u8fc7\u6389(\u5c3d\u7ba1\u5e76\u6572\u4e0d\u51fa\u6765)\n\n________________________\n\n### \u524d\u7f6e\u77e5\u8bc6\uff1a\u52a8\u6001dp\n\n\u4e0d\u4f1a\u8fd9\u4e1c\u897f\u7684\u53ef\u4ee5\u51fa\u95e8\u5de6\u8f6c\u4f60\u7ad9\u6a21\u677f\u533a\u53bb\u5b66\u4e60\u4e00\u4e0b\n\n\u6ca1\u51c6\u6811\u5256\u4e5f\u80fd\u8fc7\u8fd9\u9898\uff1f\n\n## \u672c\u9898\u9898\u89e3\n\n\u9898\u76ee\u610f\u601d\u7b80\u5355\u6613\u61c2\uff0c\u7ed9\u4f60\u4e00\u5f20\u8fde\u901a\u56fe\uff0c\u6c42\u72ec\u7acb\u96c6\u7684\u65b9\u6848\u6570\uff0c\u4fdd\u8bc1\u975e\u6811\u8fb9\u6700\u591a11\u6761\n\n\u90a3\u4e48\u6211\u4eec\u5148\u4e0d\u7ba1\u975e\u6811\u8fb9\u505a\u4e00\u904d\u6811\u5f62dp\uff0c\u8bbe$dp(u,0/1)$\u8868\u793a\u5f53u\u9009\u53d6\u6216\u8005\u4e0d\u9009\u53d6\u7684\u65f6\u5019,u\u7684\u5b50\u6811\u4e2d\u7684\u72ec\u7acb\u96c6\u65b9\u6848\u6570\n\n\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u5f53\u7136\u5341\u5206\u7684\u663e\u7136\u4e86\uff0c\u5047\u8bbe\u6211\u4eec\u6b63\u5728\u5408\u5e76\u4e00\u6761\u6811\u8fb9$(u,v)$\u5e76\u4e14u\u662fv\u7684\u7236\u4eb2\n\n$$dp(u,0)=dp(u,0)(dp(v,0)+dp(v,1))$$\n\n$$dp(u,1)=dp(u,1)dp(v,0)$$\n\n\u90a3\u4e48\u6b64\u65f6\u663e\u7136\u6211\u4eec\u8ba1\u6570\u8bb0\u591a\u4e86\uff0c\u53d1\u73b0\u72ec\u7acb\u96c6\u9650\u5236(\u4e5f\u5c31\u662f\u975e\u6811\u8fb9)\u6700\u591a\u670911\u6761\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5$O(2^{11})$\u679a\u4e3e\u4e00\u4e0b\u5230\u5e95\u6253\u7834\u4e86\u54ea\u51e0\u4e2a\u9650\u5236\uff0c\u7136\u540e\u7528\u81f3\u5c11\u6253\u78340\u4e2a\u9650\u5236-\u81f3\u5c11\u6253\u78341\u4e2a\u9650\u5236+\u81f3\u5c11\u6253\u78342\u4e2a\u9650\u5236-\u81f3\u5c11\u6253\u78343\u4e2a\u9650\u5236....\u5982\u6b64\u8fd9\u822c\u7684\u5bb9\u65a5\u4e0b\u6765\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230\u7b54\u6848\u4e86\n\n\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u94a6\u5b9a\u4e86\u4e00\u4e9b\u975e\u6811\u8fb9\u73b0\u5728\u6211\u4eec\u8981\u5168\u90e8\u6253\u7834\u8fd9\u4e9b\u9650\u5236\n\n\u90a3\u8fd9\u4e2a\u64cd\u4f5c\u5b9e\u5728\u662f\u5bb9\u6613\uff0c\u94a6\u5b9a\u8fd9\u4e9b\u6811\u8fb9\u7684\u7aef\u70b9\u5168\u90e8\u51fa\u73b0\u5728\u72ec\u7acb\u96c6\u4e2d\u5c31\u884c\u4e86\uff0c(\u800c\u4e14\u4f3c\u4e4e\u4f60\u4e5f\u53ea\u80fd\u8fd9\u4e48\u505a)\n\n\u63a5\u4e0b\u6765\u5982\u679c\u6211\u4eec\u6bcf\u6b21\u66b4\u529b\u8dd1\u4e2a\u6811\u5f62dp\u4f3c\u4e4e\u590d\u6742\u5ea6\u6709\u4e9b\u6349\u6025$O(2^{11}n)$\n\u80af\u5b9a\u662ftle\u7684\n\n\u90a3\u4e48\u6211\u4eec\u600e\u4e48\u529e\u5462\uff1f\n\n\u5f53\u7136\u662f\u52a8\u6001dp\u5927\u6cd5\u5566~\n\n\u6765\u6765\u6765\u8ba9\u6211\u4eec\u628adp\u7684\u8f6c\u79fb\u5199\u6210\u8f7b\u91cd\u94fe\u5256\u5206\u4e4b\u540e\u77e9\u9635dp\u7684\u5f62\u5f0f\n\n\u8bb0\n\n$$ldp(u,0)=\\prod_{v \\in u.lightson}dp(v,0)+dp(v,1)$$\n\n$$ldp(u,1)=\\prod_{v \\in u.lightson}dp(v,0)$$\n\n\u8bb0$dp(i,0/1)$\u8868\u793a\u4e00\u6761\u91cd\u94fe\u6309\u7167\u6df1\u5ea6\u6392\u5e8f\u4e4b\u540e\u7684\u7b2ci\u5927\u7684\u70b9\u7684dp\u503c\n\n\u5219\u6211\u4eec\u6709\n\n$$\\begin{bmatrix} dp_{i-1,0} \\\\ dp_{i-1,1} \\end{bmatrix} \u00d7 \\begin{bmatrix} ldp_{i,0} & ldp_{i,1} \\\\ ldp_{i,0} & 0 \\end{bmatrix}=\\begin{bmatrix} dp_{i,0} \\\\ dp_{i,1} \\end{bmatrix}$$\n\n\u8fd9\u91cc\u7684\u4e24\u4e2a\u5217\u5411\u91cf\u5176\u5b9e\u662f\u884c\u5411\u91cf\uff0c\u6211\u4e3b\u8981\u662f\u56e0\u4e3a\u8fd9\u6837\u770b\u8d77\u6765\u6bd4\u8f83\u723d\u624d\u6572\u6210\u8fd9\u6837\u7684\n\n\u90a3\u4e48\u6211\u4eec\u91c7\u7528\u5168\u5c40\u5e73\u8861\u4e8c\u53c9\u6811\u7ef4\u62a4\u4e00\u4e0b\u6bcf\u6761\u91cd\u94fe\u7684\u77e9\u9635\u8fde\u4e58\u79ef\u5c31\u505a\u5b8c\u8fd9\u9898\u4e86\uff1f\n\n\u4e0d\u4f60\u5ffd\u7565\u4e86\u4e00\u4e2a\u95ee\u9898\u2026\u2026,\u5728\u4f60\u8df3\u8dc3\u5168\u5c40\u5e73\u8861\u4e8c\u53c9\u6811\u4e0a\u7684\u4e00\u6761\u8f7b\u8fb9\u7684\u65f6\u5019\u4f60\u9700\u8981\u5728$ldp(fa(p),0/1)$\u4e2d\u5220\u6389$dp(p,0/1)$\u7684\u503c\uff0c\u6362\u53e5\u8bdd\u8bb2\u5c31\u662f\u505a\u9664\u6cd5,\u800c\u663e\u7136\u8fd9\u4e1c\u897f\u5728$dp(p,0/1)$\u662f0\u7684\u65f6\u5019\u662f\u9664\u4e0d\u6389\u7684\u2026\u2026\n\n\u90a3\u4e48\u600e\u4e48\u529e\u5462\uff1f\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e00\u4e2a$ldp(u,0/1)$\u5982\u679c\u4ed6\u7684\u503c\u662f0\u5c31\u989d\u5916\u8bb0\u4e00\u4e0b\u5230\u5e95\u6709\u51e0\u4e2a0\u4e58\u5230\u4e86\u91cc\u9762\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u505a\u9664\u6cd5\u4e86\uff08\u56e0\u4e3a\u6211\u4eec\u53ea\u662f\u60f3\u8981\u5220\u9664\u4e00\u4e2a\u503c\u800c\u4e0d\u662f\u771f\u7684\u505a\u9664\u6cd5\uff09\n\n\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u5904\u7406\u96640\u7684\u95ee\u9898\u4e86\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5927\u529b\u7684\u52a8\u6001dp\u8fc7\u4e86\u8fd9\u9898\n\n\u53ea\u662f\u9700\u8981\u6ce8\u610f\u4e00\u70b9\u6734\u7d20\u7684\u679a\u4e3e\u96c6\u5408\u52a0\u52a8\u6001dp\u7684\u590d\u6742\u5ea6\u662f$O(11\u00d72^{11}log^2n+nlogn)$\u7684\u53ef\u80fd\u5e38\u6570\u4e0d\u4f18\u79c0\u5c31tle\u4e86\u2026\u2026\n\n\u6ca1\u5173\u7cfb\u6211\u4eec\u628a\u679a\u4e3e\u96c6\u5408\u6362\u6210dfs\u7136\u540e\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u603b\u7684\u4fee\u6539\u91cf\u5c31\u662f$O(2^{11})$\u7ea7\u522b\u7684,\u7136\u540e\u8fd9\u9898\u7b80\u76f4\u968f\u4fbf\u8fc7\n\n\u5982\u679c\u4f60\u89c9\u5f97\u64a4\u9500\u64cd\u4f5c\u96be\u5199\u7684\u8bdd\u53ef\u4ee5\u50cf\u6211\u4e00\u6837\u6bcf\u4e2a\u8282\u70b9\u5f00\u4e00\u4e2a\u6808\u4e13\u95e8\u7528\u6765\u56de\u64a4\n\n\u7136\u540e\u8fd9\u9898\u5c31\u6109\u5feb\u7684\u505a\u5b8c\u4e86~\n\n\u4e0a\u4ee3\u7801~\n\n```C\n// luogu-judger-enable-o2\n#include<cstdio>\n#include<algorithm>\nusing namespace std;const int N=1e5+10;typedef long long ll;const ll mod=998244353;\ninline ll po(ll a,ll p){ll r=1;for(;p;p>>=1,a=a*a%mod)if(p&1)r=r*a%mod;return r;}\nstruct nod//\u7528\u6765\u505a\u9664\u6cd5\u7684\u7ed3\u6784\u4f53 \n{\n    ll v1;int c1;ll v2;int c2;\n    inline void ins(const ll& t1,const ll& t2)\n    {(v1*=(t1)?t1:1)%=mod;c1+=(t1==0);(v2*=(t2)?t2:1)%=mod;c2+=(t2==0);}\n    inline void del(const ll& t1,const ll& t2)\n    {\n        (v1*=(t1)?po(t1,mod-2):1)%=mod;c1-=(t1==0);\n        (v2*=(t2)?po(t2,mod-2):1)%=mod;c2-=(t2==0);\n    }\n};\nstruct mar//\u77e9\u9635 \n{\n    ll mp[2][2];\n    inline ll* operator [](const int& x){return mp[x];}\n    friend mar operator *(mar a,mar b)\n    {\n        mar c;\n        c[0][0]=((ll)a[0][0]*b[0][0]+(ll)a[0][1]*b[1][0])%mod;\n        c[0][1]=((ll)a[0][0]*b[0][1]+(ll)a[0][1]*b[1][1])%mod;\n        c[1][0]=((ll)a[1][0]*b[0][0]+(ll)a[1][1]*b[1][0])%mod;\n        c[1][1]=((ll)a[1][0]*b[0][1]+(ll)a[1][1]*b[1][1])%mod;return c;\n    }\n    void operator =(const nod& b)\n    {mp[1][0]=mp[0][0]=(b.c1)?0:b.v1;mp[0][1]=(b.c2)?0:b.v2;}\n};\nint v[2*N];int x[2*N];int ct;int al[N];int n;int m;ll ans;\nint eu[22];int ev[22];int hd;int siz[N];int h[N];int mi[N];\ninline void add(int u,int V){v[++ct]=V;x[ct]=al[u];al[u]=ct;}\nstruct bcj//\u667a\u5546\u4e0d\u591f\u6570\u636e\u7ed3\u6784\u6765\u51d1\uff0c\u968f\u624b\u6572\u4e86\u4e2a\u5e76\u67e5\u96c6\u5224\u975e\u6811\u8fb9 \n{\n    int fa[N];\n    inline int f(int x){return fa[x]=(x==fa[x])?x:f(fa[x]);}\n    inline void u(int x,int y){fa[f(x)]=f(y);}\n    inline void ih(){for(int i=1;i<=n;i++)fa[i]=i;}\n    inline void ins(int U,int V)\n    {if(f(U)==f(V))eu[++hd]=U,ev[hd]=V;else add(U,V),add(V,U),u(U,V);}\n}ufs;\ninline int dfs1(int u,int f)//\u8f7b\u91cd\u94fe\u5256\u5206 \n{\n    for(int i=al[u];i;i=x[i])\n        if(v[i]!=f)siz[u]+=dfs1(v[i],u),h[u]=(siz[h[u]]<siz[v[i]])?v[i]:h[u];return ++siz[u];\n}\nstruct global_biased_tree//\u5168\u5c40\u5e73\u8861\u4e8c\u53c9\u6811 \n{\n    mar mul_bas[N][22];mar we_bas[N][22];nod ld_bas[N][22];int s[N][2];\n    mar* nmul[N];mar* nwe[N];nod* nld[N];//\u4e3a\u4e86\u5199\u7684\u723d\u6bcf\u4e2a\u70b9\u5f00\u4e86\u4e2a\u6307\u9488\u6a21\u62df\u6808 \n    int st[N];int tp;int wsiz[N];int rot;int fa[N];//define n\u8fde\u5b9e\u73b0\u6808 \n    # define mul(p) (*nmul[p])\n    # define we(p) (*nwe[p])\n    # define incm(p) (*(nmul[p]+1)=*nmul[p],++nmul[p])\n    # define decm(p) (--nmul[p])\n    # define incw(p) (*(nwe[p]+1)=*nwe[p],++nwe[p])\n    # define decw(p) (--nwe[p])\n    # define ld(p) (*nld[p])\n    # define incl(p) (*(nld[p]+1)=*nld[p],++nld[p])\n    # define decl(p) (--nld[p])\n    inline void ud(int p){mul(p)=mul(s[p][0])*we(p)*mul(s[p][1]);}//\u66f4\u65b0 \n    inline void ih()//\u521d\u59cb\u5316\u6307\u9488 \n    {\n        for(int i=0;i<=n;i++)nmul[i]=mul_bas[i];for(int i=0;i<=n;i++)nwe[i]=we_bas[i];\n        for(int i=0;i<=n;i++)nld[i]=ld_bas[i];\n        for(int i=0;i<=21;i++)mul_bas[0][i][0][0]=1,mul_bas[0][i][1][1]=1;\n    }\n    inline int sbuild(int l,int r)//\u6bcf\u6761\u91cd\u94fe\u5efabst \n    {\n        if(l>r)return 0;\n        int mid=l;int sum=0;for(int i=l;i<=r;i++)sum+=wsiz[st[i]];\n        for(int pre=0;(pre<<1)<sum;mid++)pre+=wsiz[st[mid]];mid--;\n        s[st[mid]][0]=sbuild(l,mid-1);fa[s[st[mid]][0]]=st[mid];\n        s[st[mid]][1]=sbuild(mid+1,r);fa[s[st[mid]][1]]=st[mid];ud(st[mid]);\n        return st[mid];\n    }\n    inline int solve(int u,int f)//\u94fe\u5206\u6cbb \n    {\n        for(int p=u,nf=f;p;nf=p,p=h[p])\n        {\n            wsiz[p]++;ld(p).v1++;ld(p).v2++;\n            for(int j=al[p];j;j=x[j])\n                if(v[j]!=h[p]&&v[j]!=nf)\n                {\n                    int ve=solve(v[j],p);fa[ve]=p;wsiz[p]+=siz[v[j]];\n                    ld(p).ins((mul(ve)[0][0]+mul(ve)[0][1])%mod,mul(ve)[0][0]);\n                }we(p)=ld(p);\n        }tp=0;for(int p=u;p;p=h[p])st[++tp]=p;reverse(st+1,st+tp+1);return sbuild(1,tp);\n    }\n    inline void modify(int u)//\u4fee\u6539 \n    {\n        incw(u);incl(u);ld(u).v1=0;we(u)=ld(u);\n        for(int p=u;p;p=fa[p])\n            if(fa[p]&&s[fa[p]][0]!=p&&s[fa[p]][1]!=p)\n            {\n                int f=fa[p];incw(f);incl(f);\n                ld(f).del((mul(p)[0][0]+mul(p)[0][1])%mod,mul(p)[0][0]);incm(p),ud(p);\n                ld(f).ins((mul(p)[0][0]+mul(p)[0][1])%mod,mul(p)[0][0]);we(f)=ld(f);\n            }else incm(p),ud(p);\n    }\n    inline void undo(int u)//\u64a4\u9500 \n    {\n        decw(u);decl(u);\n        for(int p=u;p;p=fa[p])\n            if(fa[p]&&s[fa[p]][0]!=p&&s[fa[p]][1]!=p)decw(fa[p]),decl(fa[p]),decm(p);\n            else decm(p);\n    }\n    inline ll calc(){return (mul(rot)[0][0]+mul(rot)[0][1])%mod;}\n}gbt;\ninline void dfs(int stp,int siz)//dfs+\u5bb9\u65a5 \n{\n    if(stp==hd+1)\n    {\n        if(siz&1)(ans+=mod-gbt.calc())%=mod;\n        else (ans+=gbt.calc())%=mod;return;\n    }dfs(stp+1,siz);\n    if(!mi[eu[stp]]){mi[eu[stp]]=stp;gbt.modify(eu[stp]);}\n    if(!mi[ev[stp]]){mi[ev[stp]]=stp;gbt.modify(ev[stp]);}\n    dfs(stp+1,siz+1);\n    if(mi[ev[stp]]==stp){mi[ev[stp]]=0;gbt.undo(ev[stp]);}\n    if(mi[eu[stp]]==stp){mi[eu[stp]]=0;gbt.undo(eu[stp]);}\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&m);ufs.ih();\n    for(int i=1,u,v;i<=m;i++)scanf(\"%d%d\",&u,&v),ufs.ins(u,v);dfs1(1,0);\n    gbt.ih();gbt.rot=gbt.solve(1,0);dfs(1,0);printf(\"%lld\",ans);return 0;//\u62dc\u62dc\u7a0b\u5e8f~ \n}\n```\n\n\n\n\n\n\n\n\n\n\n\n\n",
        "postTime": 1543236896,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4426 \u3010[HNOI/AHOI2018]\u6bd2\u7624\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u7ed9\u4e00\u5f20\u65e0\u5411\u8fde\u901a\u56fe\uff0c\u6c42\u5176\u72ec\u7acb\u96c6\u4e2a\u6570\u3002$n\\leq 10^5, m-n\\leq10$\n\n\u6c42\u72ec\u7acb\u96c6\u4e2a\u6570\uff0c\u5e76\u4e14$m-n\\le10$\uff0c\u5f88\u81ea\u7136\u5730\u5f80\u6811\u4e0a\u60f3\u3002\u90a3\u4e48\u5c31\u662f\u4e00\u4e2a\uff08\u751f\u6210\uff09\u6811\u4e0a\u72ec\u7acb\u96c6\u4e2a\u6570\u95ee\u9898\uff0c\u518d\u7279\u6b8a\u8003\u8651\u4e00\u4e9b\u8fb9\u548c\u70b9\u3002\u6811\u7684\u72ec\u7acb\u96c6\u4e2a\u6570\u5f88\u597dDP\uff0c\u8bbe\u8ba1\u72b6\u6001\u5f3a\u5236\u5b50\u6811\u6839\u8282\u70b9\u9009/\u4e0d\u9009\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u8bbe$k=m-n+1$\uff0c\u5219\u6700\u76f4\u63a5\u7684\u60f3\u6cd5\u5c31\u662f$O(3^k)$\u679a\u4e3e\u7279\u6b8a\u70b9\u7684\u72b6\u6001\uff0c\u7136\u540e\u518dDP\u5904\u7406\u3002\u53e6\u4e00\u4e2a\u66f4\u597d\u7684\u60f3\u6cd5\u662f\u5bb9\u65a5\uff0c\u8bbe$f(S)$\u8868\u793a\u201c\u81f3\u5c11\u6709\u96c6\u5408$S$\u4e2d\u7684\u8fb9\u4e24\u8fb9\u7684\u70b9\u51b2\u7a81\uff08\u5373\u90fd\u9009\uff09\u201d\u7684\u65b9\u6848\u6570\uff0c$E'$\u8868\u793a\u975e\u6811\u8fb9\u7684\u96c6\u5408\uff0c\u90a3\u4e48\n$$ans=\\sum_{S\\subseteq E'} (-1)^{|S|}f(S).$$\n\n\u8fd9\u91cc\u7684\u590d\u6742\u5ea6\u5c31\u964d\u5230\u4e86$O(2^k)$\u3002\u4e0b\u6587\u8ba8\u8bba\u7684\u505a\u6cd5\u5747\u4f7f\u7528\u540e\u8005\u3002\n\n\u73b0\u5728\u7684\u4efb\u52a1\u5c31\u662f\u52a0\u901f\u4e00\u4e2a\u5e26\u5c11\u91cf\u4fee\u6539\u7684DP\u7684\u8fc7\u7a0b\u3002\u8fd9\u91cc\u63d0\u4f9b\u4e24\u79cd\u601d\u8def\u3002\n\n## \u601d\u8def\u4e00 \u865a\u6811+\u6811\u5f62DP\n\u9274\u4e8e\u4f1a\u88ab\u4fee\u6539\u7684\u70b9\u7684\u4e2a\u6570\u662f$O(k)$\u7ea7\u522b\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u5176\u5efa\u51fa\u4e00\u68f5\u865a\u6811\uff08\u8fd9\u91cc\u4e0d\u9700\u8981$O(k\\log k)$\u5efa\uff0c$O(n)$dfs\u4e00\u904d\u5efa\u6811\u5373\u53ef\uff09\u3002\n\n\u9884\u5904\u7406\u65f6\uff0c\n\n* \u5bf9\u4e8e\u8fd9\u68f5\u865a\u6811\u4e4b\u5916\u7684\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5dp\u3002\n\n* \u5bf9\u4e8e\u8fd9\u68f5\u865a\u6811\u4e4b\u4e0a\u5e76\u4e14\u88ab\u538b\u7f29\u7684\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u7b54\u6848\u8868\u793a\u6210$a\\times dp[s][0]+b\\times dp[s][1]+c$\uff0c$s$\u8868\u793a\u865a\u6811\u4e0a\u8be5\u70b9\u4e0b\u65b9\u7684\u7b2c\u4e00\u4e2a\u70b9\uff08\u663e\u7136\u552f\u4e00\uff09\uff0c\u7ef4\u62a4\u8fd9\u6837\u7684\u6bcf\u4e2a\u70b9\u7684$a$\u3001$b$\u548c$c$\u5373\u53ef\u3002\n\n* \u5bf9\u4e8e\u8fd9\u68f5\u865a\u6811\u4e4b\u4e0a\u5e76\u4e14\u6ca1\u6709\u88ab\u538b\u7f29\u7684\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5176\u865a\u6811\u4e4b\u5916\u7684\u513f\u5b50\u5148dp\u51fa\u6765\uff0c\u548c\u865a\u6811\u6709\u5173\u7684\u513f\u5b50\u5148\u4e0d\u7ba1\u3002\n\n\u73b0\u5728\u8003\u8651\u6bcf\u6b21\u4fee\u6539\u540e\u7684DP\uff0c\u6211\u4eec\u6bcf\u6b21\u53ea\u4f1a\u8d70\u5230\u865a\u6811\u4e0a\u6ca1\u6709\u88ab\u538b\u7f29\u7684\u70b9\uff0c\u6b64\u65f6\u679a\u4e3e\u6bcf\u4e2a\u865a\u6811\u4e0a\u7684\u513f\u5b50\u8f6c\u79fb\u5373\u53ef\u3002\n\n\u4e00\u4e2a\u5c0f\u6280\u5de7\u662f\u53ef\u4ee5\u628a\u4e00\u4e2a\u7279\u6b8a\u70b9\u4f5c\u4e3a\u6839\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u7279\u6b8a\u8003\u8651\u628a\u6839\u8282\u70b9\u52a0\u5165\u865a\u6811\u4e86\u3002\n\n$O(n+k2^k)$\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<cctype>\nusing namespace std;\n#define G getchar()\nint read()\n{\n\tint x=0; char ch=G;\n\tfor (;!isdigit(ch);ch=G);\n\tfor (;isdigit(ch);ch=G) x=(x<<3)+(x<<1)+(ch^48);\n\treturn x;\n}\ntypedef long long ll;\nconst int Mod=998244353;\n\n\nint n,m,f[100010];\nint dp[100010][2][3];\nnamespace V\n{\n\tstruct Edge{\n\t\tint to,nxt,v;\n\t}edge[1000];\n\tint cnt,last[100010];\n\tinline void addedge(int x,int y,int v)\n\t{\n\t\tedge[++cnt]=(Edge){y,last[x],v},last[x]=cnt;\n\t}\n\tvoid dfs3(int);\n}\nint find(int x)\n{\n\treturn f[x]?f[x]=find(f[x]):x;\n}\nstruct Edge{\n\tint to,nxt;\n}edge[200100];\nint cnt=1,last[100010];\ninline void addedge(int x,int y)\n{\n\tedge[++cnt]=(Edge){y,last[x]},last[x]=cnt;\n\tedge[++cnt]=(Edge){x,last[y]},last[y]=cnt;\n}\nstruct Rec{\n\tint u,v;\n}rec[20]; int rectop;\nint bin[40],bintop;\n\nbool exst[100010],mrk[100010],mrk0[100010];\nint rt[100010];\nvoid dfs1(int cur,int fat)\n{\n\tint exsttot=0;\n\tfor (int i=last[cur];i;i=edge[i].nxt)\n\t\tif (edge[i].to^fat)\n\t\t{\n\t\t\tdfs1(edge[i].to,cur);\n\t\t\texsttot+=exst[edge[i].to];\n\t\t}\n\tif (mrk0[cur]||exsttot>=2)\n\t{\n\t\texst[cur]=mrk[cur]=true,rt[cur]=cur;\n\t\tfor (int i=last[cur];i;i=edge[i].nxt)\n\t\t\tif (edge[i].to!=fat&&exst[edge[i].to])\n\t\t\t\tV::addedge(cur,rt[edge[i].to],edge[i].to);\n\t}\n\telse if (exsttot==1)\n\t{\n\t\texst[cur]=true;\n\t\tfor (int i=last[cur];i;i=edge[i].nxt)\n\t\t\tif (edge[i].to!=fat&&exst[edge[i].to])\n\t\t\t{\n\t\t\t\trt[cur]=rt[edge[i].to]; break;\n\t\t\t}\n\t}\n}\nvoid dfs2(int cur,int fat)\n{\n\tif (!exst[cur])\n\t{\n\t\tdp[cur][0][2]=dp[cur][1][2]=1;\n\t\tfor (int i=last[cur];i;i=edge[i].nxt)\n\t\t\tif (edge[i].to!=fat)\n\t\t\t{\n\t\t\t\tdfs2(edge[i].to,cur);\n\t\t\t\tdp[cur][0][2]=1LL*dp[cur][0][2]*(dp[edge[i].to][0][2]+dp[edge[i].to][1][2])%Mod;\n\t\t\t\tdp[cur][1][2]=1LL*dp[cur][1][2]*dp[edge[i].to][0][2]%Mod;\n\t\t\t}\n\t\treturn;\n\t}\n\tif (mrk[cur])\n\t{\n\t\tdp[cur][0][2]=dp[cur][1][2]=1;\n\t\tfor (int i=last[cur];i;i=edge[i].nxt)\n\t\t\tif (edge[i].to!=fat&&!exst[edge[i].to])\n\t\t\t{\n\t\t\t\tdfs2(edge[i].to,cur);\n\t\t\t\tdp[cur][0][2]=1LL*dp[cur][0][2]*(dp[edge[i].to][0][2]+dp[edge[i].to][1][2])%Mod;\n\t\t\t\tdp[cur][1][2]=1LL*dp[cur][1][2]*dp[edge[i].to][0][2]%Mod;\n\t\t\t}\n\t\t\telse if (edge[i].to!=fat) dfs2(edge[i].to,cur);\n\t\treturn;\n\t}\n\tint tmp0=1,tmp1=1,tmppos;\n\tfor (int i=last[cur];i;i=edge[i].nxt)\n\t\tif (edge[i].to!=fat&&!exst[edge[i].to])\n\t\t{\n\t\t\tdfs2(edge[i].to,cur);\n\t\t\ttmp0=1LL*tmp0*(dp[edge[i].to][0][2]+dp[edge[i].to][1][2])%Mod;\n\t\t\ttmp1=1LL*tmp1*dp[edge[i].to][0][2]%Mod;\n\t\t}\n\t\telse if (edge[i].to!=fat) dfs2(edge[i].to,cur),tmppos=edge[i].to;\n\tint a,b,c,d,e,f;\n\tif (mrk[tmppos]) a=1,b=1,c=0,d=1,e=0,f=0;\n\telse a=(dp[tmppos][0][0]+dp[tmppos][1][0])%Mod,b=(dp[tmppos][0][1]+dp[tmppos][1][1])%Mod,c=(dp[tmppos][0][2]+dp[tmppos][1][2])%Mod,\n\t\td=dp[tmppos][0][0],e=dp[tmppos][0][1],f=dp[tmppos][0][2];\n\tdp[cur][0][0]=1LL*tmp0*a%Mod,dp[cur][0][1]=1LL*tmp0*b%Mod,dp[cur][0][2]=1LL*tmp0*c%Mod;\n\tdp[cur][1][0]=1LL*tmp1*d%Mod,dp[cur][1][1]=1LL*tmp1*e%Mod,dp[cur][1][2]=1LL*tmp1*f%Mod;\n}\n\nint subdp[100010][2];\nbool cond[100010];\nvoid V::dfs3(int cur)\n{\n\tsubdp[cur][0]=dp[cur][0][2],subdp[cur][1]=dp[cur][1][2];\n\tfor (int i=last[cur];i;i=edge[i].nxt)\n\t{\n\t\tdfs3(edge[i].to);\n\t\tif (edge[i].v==edge[i].to)\n\t\t{\n\t\t\tsubdp[cur][0]=1LL*subdp[cur][0]*(subdp[edge[i].to][0]+subdp[edge[i].to][1])%Mod;\n\t\t\tsubdp[cur][1]=1LL*subdp[cur][1]*subdp[edge[i].to][0]%Mod;\n\t\t\tcontinue;\n\t\t}\n\t\tsubdp[cur][0]=subdp[cur][0]*(1LL*(dp[edge[i].v][0][0]+dp[edge[i].v][1][0])*subdp[edge[i].to][0]%Mod+\n\t\t\t\t1LL*(dp[edge[i].v][0][1]+dp[edge[i].v][1][1])*subdp[edge[i].to][1]%Mod+(dp[edge[i].v][0][2]+dp[edge[i].v][1][2]))%Mod;\n\t\tsubdp[cur][1]=subdp[cur][1]*(1LL*dp[edge[i].v][0][0]*subdp[edge[i].to][0]%Mod+1LL*dp[edge[i].v][0][1]*subdp[edge[i].to][1]%Mod+\n\t\t\t\t\t\t\t\tdp[edge[i].v][0][2])%Mod;\n\t}\n\tif (cond[cur]) subdp[cur][0]=0;\n}\n\nint main()\n{\n\tn=read(),m=read();\n\tfor (int i=1,x,y,a,b;i<=m;i++)\n\t{\n\t\tx=read(),y=read();\n\t\tif ((a=find(x))^(b=find(y))) f[b]=a,addedge(x,y);\n\t\telse rec[++rectop]=(Rec){x,y},bin[++bintop]=x,bin[++bintop]=y;\n\t}\n\tsort(bin+1,bin+bintop+1);\n\tbintop=unique(bin+1,bin+bintop+1)-bin-1;\n\tfor (int i=1;i<=bintop;i++) mrk0[bin[i]]=true;\n\tint RT=(rectop?rec[1].u:1);\n\tdfs1(RT,0);\n\tdfs2(RT,0);\n\tif (m==n-1) return printf(\"%d\\n\",(dp[RT][0][2]+dp[RT][1][2])%Mod),0;\n\tint ans=0;\n\tfor (int i=0;i<(1<<m-n+1);i++)\n\t{\n\t\tint tot=0;\n\t\tfor (int j=1;j<=m-n+1;j++) tot+=((i>>j-1)&1);\n\t\ttot=(tot&1?-1:1);\n\t\tfor (int j=1;j<=bintop;j++) cond[bin[j]]=false;\n\t\tfor (int j=1;j<=m-n+1;j++) if ((i>>j-1)&1) cond[rec[j].u]=cond[rec[j].v]=true;\n\t\tV::dfs3(RT);\n\t\tans=(ans+tot*(subdp[RT][0]+subdp[RT][1])%Mod)%Mod;\n\t}\n\tprintf(\"%d\\n\",(ans+Mod)%Mod)%Mod;\n\treturn 0;\n}\n\n```\n\n\n## \u601d\u8def\u4e8c \u52a8\u6001DP\n\u201c\u73b0\u5728\u7684\u4efb\u52a1\u5c31\u662f\u52a0\u901f\u4e00\u4e2a\u5e26\u5c11\u91cf\u4fee\u6539\u7684DP\u7684\u8fc7\u7a0b\u201d\uff0c\u8fd9\u662f\u4e00\u4e2a\u52a8\u6001DP\u95ee\u9898\uff0c\u76f4\u63a5\u6811\u5256+\u7ebf\u6bb5\u6811\u6216\u8005\u4f7f\u7528\u5168\u5c40\u5e73\u8861\u4e8c\u53c9\u6811\u5373\u53ef\u3002\u8be5\u505a\u6cd5\u80fd\u89e3\u51b3\u7684\u95ee\u9898\u5c31\u4e0d\u53ea\u5c40\u9650\u4e8e\u53ef\u80fd\u88ab\u4fee\u6539\u7684\u70b9\u5f88\u5c11\u7684\u60c5\u51b5\u4e86\u3002\n\n\u6ce8\u610f\u5728\u52a8\u6001DP\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u4e58\u4e0a\u4e00\u4e2a0\u6216\u8005\u64a4\u56de\u4e58\u4e0a\u4e00\u4e2a0\uff0c\u9274\u4e8e0\u6ca1\u6709\u9006\u5143\uff0c\u53ef\u4ee5\u8bb0\u4e00\u4e0b\u4e58\u4e0a\u4e86\u51e0\u4e2a0\uff0c\u5bf9\u4e8e0\u5c31\u76f4\u63a5\u5728\u8be5\u6807\u8bb0\u5904\u52a0\u52a0\u51cf\u51cf\u5c31\u884c\u4e86\u3002\n\n\u4e00\u4e2a\u5c0f\u6280\u5de7\u662f\u5bb9\u65a5\u7684\u65f6\u5019\u53ef\u4ee5\u66f4\u6539\u4e00\u4e0b\u987a\u5e8f\uff0c\u53ef\u4ee5\u6784\u9020\u4e00\u4e2a\u76f8\u90bb\u4e24\u4e2a\u6570\u4e8c\u8fdb\u5236\u53ea\u5dee\u4e00\u4f4d\u7684$[0,2^k)$\u7684\u6392\u5217\uff0c\u8fd9\u6837\u6bcf\u6b21\u4fee\u6539\u5c31\u53ea\u6709$O(1)$\u6b21\u4e86\u3002\u5177\u4f53\u65b9\u6cd5\u662f\u500d\u589e\uff0c\u6bcf\u6b21\u628a\u5df2\u7ecf\u6784\u9020\u51fa\u7684$[0,2^{i-1})$\u7684\u5e8f\u5217\u590d\u5236\u4e00\u904d\uff0c\u6700\u9ad8\u4f4d\u5168\u90e8\u52a0\u4e0a\u4e00\u4e2a1\uff0c,\u987a\u5e8f\u7ffb\u8f6c\u8fc7\u6765\u63a5\u5230\u672b\u5c3e\u3002\u5f53\u7136\u76f4\u63a5dfs\u4e5f\u53ef\u4ee5\u505a\u5230\u76f8\u540c\u7684\u590d\u6742\u5ea6\u3002\n\n$O(n\\omega^3\\log n+2^k(k+ (\\log Mod+\\omega^3)\\log n))$\uff0c$\\omega=2$\u4e3a\u77e9\u9635\u5927\u5c0f\u3002\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<cctype>\nusing namespace std;\n#define G getchar()\nint read()\n{\n\tint x=0; char ch=G;\n\tfor (;!isdigit(ch);ch=G);\n\tfor (;isdigit(ch);ch=G) x=(x<<3)+(x<<1)+(ch^48);\n\treturn x;\n}\ntypedef long long ll;\nconst int Mod=998244353;\nint qpow(int x,int y)\n{\n\tint res=1;\n\tfor (;y;y>>=1,x=1LL*x*x%Mod)\n\t\tif (y&1) res=1LL*res*x%Mod;\n\treturn res;\n}\n\nint n,m;\nint f[100010];\nint find(int x)\n{\n\treturn f[x]?f[x]=find(f[x]):x;\n}\nstruct Edge{\n\tint to,nxt;\n}edge[200010];\nint cnt=1,last[100010];\ninline void addedge(int x,int y)\n{\n\tedge[++cnt]=(Edge){y,last[x]},last[x]=cnt;\n\tedge[++cnt]=(Edge){x,last[y]},last[y]=cnt;\n}\nint fat[100010],son[100010],siz[100010];\nvoid dfs1(int cur,int fat)\n{\n\t::fat[cur]=fat; siz[cur]=1;\n\tfor (int i=last[cur];i;i=edge[i].nxt)\n\t\tif (edge[i].to^fat)\n\t\t{\n\t\t\tdfs1(edge[i].to,cur);\n\t\t\tsiz[cur]+=siz[edge[i].to];\n\t\t\tif (!son[cur]||siz[edge[i].to]>siz[son[cur]]) son[cur]=edge[i].to;\n\t\t}\n}\nstruct Num{\n\tint val,ztot;\n}g[100010][2];\nNum operator*(Num x,Num y)\n{\n\treturn (Num){1LL*x.val*y.val%Mod,x.ztot+y.ztot};\n}\nNum operator/(Num x,Num y)\n{\n\treturn (Num){y.val==1?x.val:1LL*x.val*qpow(y.val,Mod-2)%Mod,x.ztot-y.ztot};\n}\nstruct Matrix{\n\tint mp[2][2];\n};\nMatrix operator*(Matrix x,Matrix y)\n{\n\tMatrix res;\n\tres.mp[0][0]=(1LL*x.mp[0][0]*y.mp[0][0]+1LL*x.mp[0][1]*y.mp[1][0])%Mod;\n\tres.mp[0][1]=(1LL*x.mp[0][0]*y.mp[0][1]+1LL*x.mp[0][1]*y.mp[1][1])%Mod;\n\tres.mp[1][0]=(1LL*x.mp[1][0]*y.mp[0][0]+1LL*x.mp[1][1]*y.mp[1][0])%Mod;\n\tres.mp[1][1]=(1LL*x.mp[1][0]*y.mp[0][1]+1LL*x.mp[1][1]*y.mp[1][1])%Mod;\n\treturn res;\n}\nstruct Node{\n\tMatrix val,sum;\n\tint lson,rson,fat;\n}node[100010];\nint seq[100010]; int seqtot;\nbool isroot(int cur)\n{\n\treturn node[node[cur].fat].lson!=cur&&node[node[cur].fat].rson!=cur;\n}\nvoid pushup(int cur)\n{\n\tif (node[cur].rson) node[cur].sum=node[node[cur].rson].sum*node[cur].val;\n\telse node[cur].sum=node[cur].val;\n\tif (node[cur].lson) node[cur].sum=node[cur].sum*node[node[cur].lson].sum;\n}\nint build(int l,int r)\n{\n\tint siztot=0;\n\tfor (int i=l;i<=r;i++) siztot+=siz[seq[i]];\n\tint sizl=0;\n\tfor (int i=l;i<=r;i++)\n\t{\n\t\tsizl+=siz[seq[i]];\n\t\tif ((sizl<<1)>=siztot)\n\t\t{\n\t\t\tint ls,rs;\n\t\t\tif (l<i) ls=build(l,i-1),node[seq[i]].lson=ls,node[ls].fat=seq[i];\n\t\t\tif (i<r) rs=build(i+1,r),node[seq[i]].rson=rs,node[rs].fat=seq[i];\n\t\t\tpushup(seq[i]);\n\t\t\treturn seq[i];\n\t\t}\n\t}\n}\nint dfs2(int cur)\n{\n\tfor (int i=cur;i;i=son[i])\n\t{\n\t\tg[i][0]=g[i][1]=(Num){1,0};\n\t\tfor (int j=last[i];j;j=edge[j].nxt)\n\t\t\tif (edge[j].to!=fat[i]&&edge[j].to!=son[i])\n\t\t\t{\n\t\t\t\tint t=dfs2(edge[j].to);\n\t\t\t\tnode[t].fat=i;\n\t\t\t\tint tmp=node[t].sum.mp[0][0];\n\t\t\t\tg[i][1]=g[i][1]*(tmp?(Num){tmp,0}:(Num){1,1});\n\t\t\t\ttmp=(node[t].sum.mp[0][0]+node[t].sum.mp[0][1])%Mod;\n\t\t\t\tg[i][0]=g[i][0]*(tmp?(Num){tmp,0}:(Num){1,1});\n\t\t\t}\n\t\tint a=(g[i][0].ztot?0:g[i][0].val),b=(g[i][1].ztot?0:g[i][1].val);\n\t\tnode[i].val=(Matrix){{{a,b},{a,0}}};\n\t}\n\tseqtot=0;\n\tfor (int i=cur;i;i=son[i]) seq[++seqtot]=i,siz[i]-=siz[son[i]];\n\treturn build(1,seqtot);\n}\nbool cond[100010]; int covertot[100010];\nvoid modify(int x,bool y)\n{\n\tif (cond[x]==y) return;\n\tcond[x]=y;\n\tint a=(g[x][0].ztot?0:g[x][0].val),b=(g[x][1].ztot?0:g[x][1].val);\n\tif (y) node[x].val=(Matrix){{{0,b},{0,0}}};\n\telse node[x].val=(Matrix){{{a,b},{a,0}}};\n\tfor (int i=x;i;i=node[i].fat)\n\t\tif (isroot(i)&&node[i].fat)\n\t\t{\n\t\t\tint t=node[i].fat;\n\t\t\ta=node[i].sum.mp[0][0],b=(node[i].sum.mp[0][0]+node[i].sum.mp[0][1])%Mod;\n\t\t\tg[t][0]=g[t][0]/(b?(Num){b,0}:(Num){1,1});\n\t\t\tg[t][1]=g[t][1]/(a?(Num){a,0}:(Num){1,1});\n\t\t\tpushup(i);\n\t\t\ta=node[i].sum.mp[0][0],b=(node[i].sum.mp[0][0]+node[i].sum.mp[0][1])%Mod;\n\t\t\tg[node[i].fat][0]=g[node[i].fat][0]*(b?(Num){b,0}:(Num){1,1});\n\t\t\tg[node[i].fat][1]=g[node[i].fat][1]*(a?(Num){a,0}:(Num){1,1});\n\t\t\t\n\t\t\ta=(g[t][0].ztot?0:g[t][0].val),b=(g[t][1].ztot?0:g[t][1].val);\n\t\t\tif (cond[t]) node[t].val=(Matrix){{{0,b},{0,0}}};\n\t\t\telse node[t].val=(Matrix){{{a,b},{a,0}}};\n\t\t}\n\t\telse pushup(i);\n}\nstruct Rec{\n\tint u,v;\n}rec[100]; int rectop;\nint bin[100]; int bintop;\n\nint main()\n{\n\tn=read(),m=read();\n\tfor (int i=1,x,y,a,b;i<=m;i++)\n\t{\n\t\tx=read(),y=read();\n\t\tif ((a=find(x))^(b=find(y))) f[b]=a,addedge(x,y);\n\t\telse rec[++rectop]=(Rec){x,y},bin[++bintop]=x,bin[++bintop]=y;\n\t}\n\tsort(bin+1,bin+bintop+1);\n\tbintop=unique(bin+1,bin+bintop+1)-bin-1;\n\tdfs1(1,0); int rt=dfs2(1);\n\tint k=m-n+1;\n\tseqtot=0; seq[seqtot++]=0;\n\tfor (int i=1;i<=k;i++)\n\t{\n\t\tfor (int j=(1<<i-1)-1;j>=0;j--)\n\t\t\tseq[seqtot++]=seq[j]|(1<<i-1);\n\t}\n\tint ans=(node[rt].sum.mp[0][0]+node[rt].sum.mp[0][1])%Mod;\n\tfor (int i=1,kk=-1;i<seqtot;i++,kk=-kk)\n\t{\n\t\tint pos; bool cnd;\n\t\tfor (int j=1;j<=k;j++) if ((seq[i-1]^seq[i])==(1<<j-1)){pos=j,cnd=(seq[i]>>j-1)&1;break;}\n\t\tif (cnd) covertot[rec[pos].u]++,covertot[rec[pos].v]++;\n\t\telse covertot[rec[pos].u]--,covertot[rec[pos].v]--;\n\t\tmodify(rec[pos].u,covertot[rec[pos].u]);\n\t\tmodify(rec[pos].v,covertot[rec[pos].v]);\n\t\tans=(ans+kk*(node[rt].sum.mp[0][0]+node[rt].sum.mp[0][1])%Mod)%Mod;\n\t}\n\tprintf(\"%d\\n\",(ans+Mod)%Mod);\n\treturn 0;\n}\n```\n\n***\n\u8bf7\u6279\u8bc4\u6307\u6b63\uff01",
        "postTime": 1570074348,
        "uid": 38182,
        "name": "dqa2022",
        "ccfLevel": 9,
        "title": "P4426 [HNOI/AHOI2018]\u6bd2\u7624 \u9898\u89e3"
    },
    {
        "content": "## $\\mathcal{Foreword}$\n\n\u7b97\u662f\u849f\u84bb\u7b2c\u4e00\u6b21\u53d1\u7684\u9ed1\u9898\u9898\u89e3\u5427\uff01\n\n~~\uff08\u672c\u6765 [P4887 \u3010\u6a21\u677f\u3011\u83ab\u961f\u4e8c\u6b21\u79bb\u7ebf\uff08\u7b2c\u5341\u56db\u5206\u5757(\u524d\u4f53)\uff09](https://www.luogu.com.cn/problem/P4887)\u8fd8\u662f\u9ed1\u9898\u7684\uff09~~\n\n## $\\mathcal{Question}$\n\n[P4426 [HNOI/AHOI2018]\u6bd2\u7624](https://www.luogu.com.cn/problem/P4426)\n\n\u9898\u76ee\u5c31\u662f\u8ba9\u4f60\u6c42\u4e00\u5e45\u56fe\u7684\u6700\u5927\u72ec\u7acb\u96c6\u7684\u65b9\u6848\u6570\u3002\n\n## $\\mathcal{Solution}$\n\n\u6211\u4eec\u4f1a\u795e\u5947\u7684\u53d1\u73b0\u6d4b\u8bd5\u70b9 5~6 \u7684\u6570\u636e\u8303\u56f4\u662f $m = n - 1$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u9996\u5148\u4ece\u4e00\u68f5\u6811\u5165\u624b\uff0c\u8003\u8651\u5982\u4f55\u6c42\u4e00\u68f5\u6811\u7684\u6700\u5927\u72ec\u7acb\u96c6\u7684\u65b9\u6848\u6570\u3002\n\n\u8bbe $f_{u,0}$ \u8868\u793a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u4e0d\u9009 $u$ \u8282\u70b9\u7684\u6700\u5927\u72ec\u7acb\u96c6\u7684\u65b9\u6848\u6570\u3002\n\n\u8bbe $f_{u,1}$ \u8868\u793a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u9009\u62e9 $u$ \u8282\u70b9\u7684\u6700\u5927\u72ec\u7acb\u96c6\u7684\u65b9\u6848\u6570\u3002\n\n\u5047\u8bbe $v$ \u662f $u$ \u7684\u4e00\u4e2a\u5b50\u8282\u70b9\uff0c\u6613\u5f97\uff1a\n\n$$f_{u,0} = f_{u,0} \\times (f_{v,0} + f_{v,1})$$\n\n$$f_{u,1} = f_{u,1} \\times f_{v,0}$$\n\n\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u5730\u6253\u51fa\u4ee3\u7801\uff1a\n\n```cpp\ninline void dfs(int u, int fa) {\n\tf[u][0] = f[u][1] = 1; // \u6ce8\u610f\u521d\u59cb\u5316\n\tfor (auto v: G[u]) {\n\t\tif (v != fa) {\n\t\t\tdfs(v, u);\n\t\t\t(f[u][0] *= (f[v][1] + f[v][0])) %= mod;\n\t\t\t(f[u][1] *= f[v][0]) %= mod;\n\t\t}\n\t}\n}\n```\n\u6700\u540e\u7b54\u6848\u5c31\u662f $f_{Root,0} + f_{Root,1}$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u62ff\u5230 10 \u5206\u7684\u9ad8\u5206\u3002\n\n\u6211\u4eec\u8003\u8651\u5982\u4f55\u6c42\u4e00\u4e2a\u56fe\u7684\u6700\u5927\u72ec\u7acb\u96c6\u7684\u65b9\u6848\u6570\u3002\n\n\u6211\u4eec\u4f1a\u53d1\u73b0 $n - 1 \\le m \\le n + 10$\u3002\n\n\u4e5f\u5c31\u4ee3\u8868\u4e00\u5e45\u56fe\u4e2d\u6c42\u51fa\u4e00\u68f5\u751f\u6210\u6811\u540e\uff0c\u5269\u4e0b\u7684\u975e\u6811\u8fb9\u6700\u591a\u53ea\u6709 $11$ \u6761\u3002\n\n\u8003\u8651\u66b4\u529b\u679a\u4e3e\u6bcf\u4e00\u6761\u975e\u6811\u8fb9\u4e24\u7aef\u8282\u70b9\u7684\u9009\u4e0e\u4e0d\u9009\u7684\u72b6\u6001\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u6761\u975e\u6811\u8fb9\u4e24\u7aef\u8282\u70b9\uff0c\u5982\u679c\u90fd\u9009\u4e86\u660e\u663e\u662f\u6253\u7834\u4e86\u9650\u5236\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5957\u7528\u5bb9\u65a5\u539f\u7406\uff0c\u6700\u7ec8\u7684\u7b54\u6848\u5c31\u662f\uff1a\n\n\u6253\u7834 $0$ \u4e2a\u9650\u5236\u7684\u65b9\u6848\u6570 $-$ \u6253\u7834 $1$ \u4e2a\u9650\u5236\u7684\u65b9\u6848\u6570 $+$ \u6253\u7834 $2$ \u4e2a\u9650\u5236\u7684\u65b9\u6848\u6570\u2026\u2026\n\n\u5927\u6982\u5c31\u662f\u8fd9\u6837\u7684\uff1a\n\n```cpp\ninline void dfs(int x, int siz) { // siz \u8868\u793a\u6253\u7834\u7684\u9650\u5236\u7684\u4e2a\u6570\n\tif (x == len + 1) { // len \u8868\u793a\u975e\u6811\u8fb9\u7684\u6570\u91cf\n\t\tif (siz & 1) (ans += (mod - ...)) %= mod;\n\t\telse (ans += ...) %= mod; // ... \u8868\u793a\u6bcf\u6b21\u8fd9\u4e2a\u9009\u4e0e\u4e0d\u9009\u72b6\u6001\u4e0b\u7684\u751f\u6210\u6811\u7684\u6700\u5927\u72ec\u7acb\u96c6\u65b9\u6848\u6570\n\t}\n\tdfs(x + 1, siz);\n\t... // \u9009\u62e9\u8fd9\u6761\u975e\u6811\u8fb9\u4e24\u7aef\u7684\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u6253\u7834\u8fd9\u4e2a\u9650\u5236\n\tdfs(x + 1, siz + 1);\n\t... // \u8fd8\u539f\u6253\u7834\u7684\u8fd9\u4e2a\u9650\u5236\n}\n```\n\n\u5982\u679c\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u72b6\u6001\u90fd\u66b4\u529b\u7684\u8dd1\u4e00\u904d dp\uff0c\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u4f1a\u53d8\u6210 $\\Theta (2^{11}n)$\u3002\n\n~~\u8fd9\u6837\u4eff\u4f5b\u80fd\u591f\u62ff\u5230 75 \u5206\u7684\u9ad8\u5206\uff1f~~\n\n\u8fd9\u6837\u80af\u5b9a\u662f\u4f1a\u8d85\u65f6\u7684\u3002\n\n\u5f3a\u5236\u9009\u62e9\u4e00\u4e2a\u8282\u70b9 $u$ \u660e\u663e\u5c31\u662f\u5c06 $g_{u,0}$ \u4e58\u4e0a $0$ \uff08\u5c31\u662f\u4e0d\u80fd\u4e0d\u9009 $u$ \u7684\u610f\u601d\uff09\uff0c\n\n\u800c\u8fd8\u539f\u8fd9\u4e2a\u5f3a\u5236\u5730\u9009\u62e9\u660e\u663e\u5c31\u662f\u518d\u5c06 $g_{u,0}$ \u9664\u4ee5 $0$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u52a8\u6001 dp\u3002\n\n\uff08\u4e0d\u4f1a\u52a8\u6001 dp \u7684\u5de6\u8f6c [P4719 \u3010\u6a21\u677f\u3011\"\u52a8\u6001 DP\"&\u52a8\u6001\u6811\u5206\u6cbb](https://www.luogu.com.cn/problem/P4719)\uff09\n\n\u8fd9\u6837\u5355\u6b21\u4fee\u6539\u548c\u67e5\u8be2\u90fd\u662f $\\Theta (log^2\\ n)$ \u7684\u3002\n\n\u6211\u4eec\u9996\u5148\u8003\u8651\u6811\u94fe\u5256\u5206\u3002\n\n\u8bbe $g_{u,0}$ \u8868\u793a\u53ea\u8003\u8651 $u$ \u7684\u8f7b\u513f\u5b50\u7684\u4e0d\u9009 $u$ \u8282\u70b9\u7684\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u7684\u6700\u5927\u72ec\u7acb\u96c6\u3002\n\n\u8bbe $g_{u,1}$ \u8868\u793a\u53ea\u8003\u8651 $u$ \u7684\u8f7b\u513f\u5b50\u7684\u9009\u62e9 $u$ \u8282\u70b9\u7684\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u7684\u6700\u5927\u72ec\u7acb\u96c6\u3002\n\n\u8bbe $hson_u$ \u8868\u793a $u$ \u8282\u70b9\u7684\u91cd\u513f\u5b50\uff0c\u6613\u5f97\uff1a\n\n$$f_{u,0} = g_{u,0} \\times (f_{hson_u,0} + f_{hson_u,1})$$\n\n$$f_{u,1} = g_{u,1} \\times f_{hson_u,0}$$\n\n\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u8f6c\u6362\u6210\u77e9\u9635\uff1a\n\n$\\left[ \\begin{matrix} g_{u,0} & g_{u,0} \\\\ g_{u,1} & 0\\end{matrix} \\right] \\times \\left[ \\begin{matrix} f_{hson_u,0}\\\\f_{hson_u,1}\\end{matrix}\\right] = \\left[ \\begin{matrix} f_{u,0} \\\\ f_{u,1} \\end{matrix} \\right]$\n\n\u8fd9\u4e2a\u77e9\u9635\u4e58\u6cd5\u662f\u6ee1\u8db3\u7ed3\u5408\u5f8b\u7684\uff0c\u660e\u663e\u6211\u4eec\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u77e9\u9635\u7684\u4e58\u79ef\uff0c\u4fee\u6539\u65f6\u987a\u7740\u91cd\u94fe\u5f80\u4e0a\u8df3\u5c31\u884c\u4e86\u3002\n\n\u4f46\u662f\u8fd9\u9053\u9898\u548c [P4719 \u3010\u6a21\u677f\u3011\"\u52a8\u6001 DP\"&\u52a8\u6001\u6811\u5206\u6cbb](https://www.luogu.com.cn/problem/P4719) \u4e0d\u4e00\u6837\u3002\n\n\u90a3\u9053\u9898\u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u662f\u52a0\u7684\uff0c\u6240\u4ee5\u4fee\u6539\u662f\u52a0\u51cf\u6cd5\u3002\n\n\u4f46\u8fd9\u9053\u9898\u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u662f\u4e58\u7684\uff0c\u6240\u4ee5\u4fee\u6539\u662f\u4e58\u9664\u6cd5\u3002\n\n~~\uff08\u4e58\u9664\u6cd5\u4e0d\u662f\u9006\u5143\u5c31\u884c\u4e86\u561b\uff1f\uff09~~\n\n\u4f46\u8fd9\u9053\u9898\u6709\u65f6\u5019\u4f1a\u9700\u8981\u9664\u4ee5 $0$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u9700\u8981\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8282\u70b9 $i$ \u7684 $g_{i,0}$ \u4e0e $g_{i,1}$\u3002\n\n\u90fd\u5f00\u4e00\u4e2a\u6570\u7ec4 $Zero_{i,0}$ \u548c $Zero_{i,1}$\u3002\n\n\u6bcf\u4e00\u6b21\u4e58 $0$ \u5c31 ```Zero[u][0 or 1]++;```\u3002\n\n\u6bcf\u4e00\u6b21\u9664\u4ee5 $0$ \u5c31 ```Zero[u][0 or 1]--;```\u3002\n\n\u6bcf\u4e00\u6b21\u67e5\u8be2\u4e00\u4e2a\u8282\u70b9 $x$ \u7684 $g_{x,opt}$ \u7684\u503c\uff1a\n\n```cpp\ninline void val(int x, int opt) {\n\treturn (Zero[x][opt] > 0? 0: g[u][opt]);\n}\n```\n\n\u8fd9\u6837\u5c31\u80fd\u89e3\u51b3\u9664\u4ee5 $0$ \u7684\u95ee\u9898\u4e86\u3002\n\n\u628a\u77e9\u9635\u4e58\u6cd5\u518d\u6539\u4e00\u4e0b\uff1a\n\n$\\left[ \\begin{matrix} val(u,0) & val(u,0) \\\\ val(u,1) & 0\\end{matrix} \\right] \\times \\left[ \\begin{matrix} f_{hson_u,0}\\\\f_{hson_u,1}\\end{matrix}\\right] = \\left[ \\begin{matrix} f_{u,0} \\\\ f_{u,1} \\end{matrix} \\right]$\n\n\u6700\u540e\u8bf4\u4e00\u53e5\uff1a\n\n\u4e0d\u5f00 long long \u89c1\u7956\u5b97\u3002\n\n## $\\mathcal{Code}$\n\n\u597d\u50cf\u5c31\u6211\u4e00\u4e2a\u7801\u4e86 5 KB ~~\uff08\u6211\u8fd8\u662f\u592a\u900a\u4e86\uff09~~\u3002\n\n```cpp\n// Best wishes!\n#include <bits/stdc++.h>\n\nusing namespace std;\n\n#define IOS ios::sync_with_stdio(false); cin.tie(0); cout.tie(0)\n#define pb push_back\n\ntypedef long long LL;\n\nconst int MAXN = 1e5 + 10;\nconst int mod = 998244353;\n\nint n, m, father[MAXN];\nvector <int> G[MAXN];\n\nint A[MAXN], B[MAXN], len = 0;\nint fa[MAXN], dep[MAXN], siz[MAXN], hson[MAXN];\nint tot = 0, seg[MAXN], rev[MAXN], top[MAXN], End[MAXN];\n\nLL f[MAXN][2], g[MAXN][2];\nLL ans = 0;\n\nint Zero[MAXN][2];\n\ninline int find(int x) {\n\tif (father[x] != x) father[x] = find(father[x]);\n\treturn father[x];\n}\n\ninline LL val(int u, int opt) {\n\treturn (Zero[u][opt] > 0? 0: g[u][opt]);\n}\n\nstruct _Matrix {\n\tLL Matrix[2][2];\n\tint n, m;\n\t\n\t_Matrix() {\n\t\tn = m = 0;\n\t\t\n\t\tfor (int i = 0; i < 2; i++)\n\t\t\tfor (int j = 0; j < 2; j++)\n\t\t\t\tMatrix[i][j] = 0;\n\t}\n\tinline void Initialize(int x) {\n\t\tn = m = 2;\n\t\t\n\t\tMatrix[0][0] = val(x, 0); Matrix[0][1] = val(x, 0);\n\t\tMatrix[1][0] = val(x, 1); Matrix[1][1] = 0;\n\t}\n\t_Matrix operator * (const _Matrix &A) {\n\t\t_Matrix C; C.n = n; C.m = A.m;\n\t\t\n\t\tfor (int i = 0; i < C.n; i++)\n\t\t\tfor (int j = 0; j < C.m; j++)\n\t\t\t\tfor (int k = 0; k < m; k++)\n\t\t\t\t\t(C.Matrix[i][j] += Matrix[i][k] * A.Matrix[k][j]) %= mod;\n\t\t\t\t\t\n\t\treturn C; \n\t}\n};\n\nstruct Node {\n\tint l, r;\n\t_Matrix data;\n}t[ MAXN << 2 ];\n\ninline void build(int p, int l, int r) {\n\tt[p].l = l; t[p].r = r;\n\t\n\tif (l == r) {\n\t\tt[p].data.Initialize(rev[l]);\n\t\treturn ;\n\t}\n\t\n\tint mid = l + r >> 1;\n\t\n\tbuild(p << 1, l, mid);\n\tbuild(p << 1 | 1, mid + 1, r);\n\t\n\tt[p].data = t[p << 1].data * t[p << 1 | 1].data;\n}\n\ninline void change(int p, int x) {\n\tif (t[p].l == t[p].r) {\n\t\tt[p].data.Initialize(rev[x]);\n\t\treturn ;\n\t}\n\t\n\tint mid = t[p].l + t[p].r >> 1;\n\t\n\tif (x <= mid) change(p << 1, x);\n\telse change(p << 1 | 1, x);\n\t\n\tt[p].data = t[p << 1].data * t[p << 1 | 1].data;\n}\n\ninline _Matrix query(int p, int x, int y) {\n\tif (t[p].l >= x && t[p].r <= y) return t[p].data;\n\t\n\tint mid = t[p].l + t[p].r >> 1;\n\t\n\tif (y <= mid) return query(p << 1, x, y);\n\tif (mid < x) return query(p << 1 | 1, x, y);\n\t\n\treturn query(p << 1, x, y) * query(p << 1 | 1, x, y); \n}\n\ninline void dfs1(int u, int F) {\n\tfa[u] = F;\n\tdep[u] = dep[F] + 1;\n\tsiz[u] = 1;\n\t\n\tfor (auto v: G[u]) {\n\t\tif (v != F) {\n\t\t\tdfs1(v, u);\n\t\t\t\n\t\t\tsiz[u] += siz[v];\n\t\t\tif (siz[ hson[u] ] < siz[v]) hson[u] = v;\n\t\t}\n\t}\n}\n\ninline void dfs2(int u, int Top) {\n\ttop[u] = Top;\n\tseg[u] = ++tot;\n\trev[tot] = u;\n\t\n\tf[u][0] = f[u][1] = g[u][0] = g[u][1] = 1ll;\n\tZero[u][0] = Zero[u][1] = 0;\n\t\n\tif (hson[u]) {\n\t\tdfs2(hson[u], Top);\n\t\t(f[u][0] *= (f[ hson[u] ][0] + f[ hson[u] ][1])) %= mod;\n\t\t(f[u][1] *= f[ hson[u] ][0]) %= mod;\n\t}\n\telse End[Top] = u;\n\t\n\tfor (auto v: G[u]) {\n\t\tif (v != fa[u] && v != hson[u]) {\n\t\t\t\n\t\t\tdfs2(v, v);\n\t\t\t\n\t\t\t(f[u][0] *= (f[v][0] + f[v][1])) %= mod;\n\t\t\t(f[u][1] *= f[v][0]) %= mod;\n\t\t\t(g[u][0] *= (f[v][0] + f[v][1])) %= mod;\n\t\t\t(g[u][1] *= f[v][0]) %= mod; \n\t\t}\n\t}\n}\n\ninline LL quick(LL x, int p) {\n\tLL _ans = 1ll;\n\twhile (p > 0) {\n\t\tif (p & 1) _ans = _ans * x % mod;\n\t\tx = x * x % mod;\n\t\tp >>= 1;\n\t}\n\treturn _ans;\n}\n\ninline void update(int u, int w) {\n\tif (w == 0) {\n\t\tZero[u][0]++;\n\t} else Zero[u][0]--; // We use array Zero to record the num of 0.\n\t\n\t_Matrix Before, After;\n\t\n\twhile (u != 0) {\n\t\tBefore = query(1, seg[ top[u] ], seg[ End[ top[u] ] ]);\n\t\tchange(1, seg[u]);\n\t\tAfter = query(1, seg[ top[u] ], seg[ End[ top[u] ] ]);\n\t\t\n\t\tu = fa[ top[u] ];\n\t\t\n\t\tif (After.Matrix[0][0] + After.Matrix[1][0] == 0)\n\t\t\tZero[u][0]++;\n\t\telse g[u][0] = g[u][0] * (After.Matrix[0][0] + After.Matrix[1][0]) % mod;\n\t\t\n\t\tif (After.Matrix[0][0] == 0)\n\t\t\tZero[u][1]++;\n\t\telse g[u][1] = g[u][1] * After.Matrix[0][0] % mod;\n\t\t\n\t\tif (Before.Matrix[0][0] + Before.Matrix[1][0] == 0)\n\t\t\tZero[u][0]--;\n\t\telse g[u][0] = g[u][0] * quick(Before.Matrix[0][0] + Before.Matrix[1][0], mod - 2) % mod;\n\t\t\n\t\tif (Before.Matrix[0][0] == 0)\n\t\t\tZero[u][1]--;\n\t\telse g[u][1] = g[u][1] * quick(Before.Matrix[0][0], mod - 2) % mod;\n\t}\n}\n\ninline void dfs(int x, int siz) {\n\tif (x == len + 1) {\n\t\t_Matrix Ans = query(1, seg[1], seg[ End[1] ]);\n\t\t\n\t\tif (siz & 1) (ans += mod - (Ans.Matrix[0][0] + Ans.Matrix[1][0]) % mod) %= mod;\n\t\telse (ans += Ans.Matrix[0][0] + Ans.Matrix[1][0]) %= mod;\n\t\t\n\t\treturn ;\n\t}\n\tdfs(x + 1, siz);\n\t\n\tupdate(A[x], 0); // Choose (1, 1) and break the limitation.\n\tupdate(B[x], 0);\n\t\n\tdfs(x + 1, siz + 1);\n\t\n\tupdate(A[x], 1); // Return back.\n\tupdate(B[x], 1);\n}\n\nint main() {\n\tIOS;\n\t\n\tcin >> n >> m;\n\t\n\tfor (int i = 1; i <= n; i++)\n\t\tfather[i] = i;\n\t\t\n\tfor (int i = 1; i <= m; i++) {\n\t\tint u, v;\n\t\tcin >> u >> v;\n\t\tint fx = find(u), fy = find(v);\n\t\tif (fx != fy) {\n\t\t\tfather[fx] = fy;\n\t\t\tG[u].pb(v);\n\t\t\tG[v].pb(u);\n\t\t}\n\t\telse {\n\t\t\t++len;\n\t\t\tA[len] = u;\n\t\t\tB[len] = v;\n\t\t}\n\t}\n\t\n\tdfs1(1, 0); dfs2(1, 1);\n\tbuild(1, 1, n);\n\t\n\tdfs(1, 0);\n\t\n\tcout << ans << endl;\n\t\n\treturn 0;\n}\n```\n\u5b8c\u7ed3\u6492\u82b1 ^_\u306e\u3002",
        "postTime": 1645241531,
        "uid": 355448,
        "name": "Fido_Puppy",
        "ccfLevel": 0,
        "title": "P4426 [HNOI/AHOI2018]\u6bd2\u7624"
    },
    {
        "content": "[P4426 [HNOI/AHOI2018]\u6bd2\u7624](https://www.luogu.com.cn/problem/P4426)\n\n\u8fd9\u9898\u548c\u5b83\u7684\u540d\u5b57\u4e00\u6837\u6bd2\u7624\uff01~~\u8fd9\u76f4\u63a5\u5bfc\u81f4\u4e86\u6211\u5931\u53bb\u4e86\u4e00\u665a\u4e0a\u7684\u5feb\u4e50\u9893\u5e9f\u65f6\u5149~~\n\n\u4e00\u53e5\u8bdd\u9898\u610f\uff1a\u6c42\u4e00\u5e45\u56fe\u7684\u72ec\u7acb\u96c6\u65b9\u6848\u6570\u3002\n\n**\u66b4\u529b\uff1a**\n\n\u9996\u5148\u8003\u8651\u6811\u4e0a\u600e\u4e48\u505a\u3002\u8bbe $dp[u][0/1]$ \u8868\u793a\u4e0d\u9009/\u9009 $u$ \u7684\u65b9\u6848\u6570\uff0c\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0cdp \u65b9\u7a0b\u663e\u7136\uff1a\n$$\ndp[u][0]=\\prod  (dp[v][1]+dp[v][0])\\\\dp[u][1]=\\prod dp[v][0]\n$$\n\u53d1\u73b0 $m-n$ \u5f88\u5c0f\uff0c\u6211\u4eec\u66b4\u529b\u679a\u4e3e\u975e\u6811\u8fb9\u53ef\u80fd\u7684\u60c5\u51b5\uff0c\u5373$(1,0),(0,0),(0,1)$\u3002\u53d1\u73b0\u540e\u4e24\u79cd\u60c5\u51b5\u53ef\u4ee5\u5408\u5e76\u4e3a\u4e00\u79cd\u3002\u4e8e\u662f\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a $O(2^{m-n+1}n)$ \u7684\u505a\u6cd5\u3002\u53ef\u4ee5\u5f97 75pts\uff0c\u4ee3\u7801\u975e\u5e38\u597d\u5199\u3002\uff08\u542c\u8bf4\u6781\u81f4\u5361\u5e38\u7684\u8bdd\u80fd\u8fc7\uff1f\uff09\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nnamespace FGF\n{\n\tint n,m;\n\tconst int N=1e5+5,mo=998244353;\n\tint dfn[N],num,eu[N],ev[N],tot,dp[N][2],op[N][2],ans;\n\tbool vis[N];\n\tvector<int> g[N];\n\tint read()\n\t{\n\t\tint s=0;char ch=getchar();\n\t\twhile(!isdigit(ch))ch=getchar();\n\t\twhile(isdigit(ch))s=s*10+ch-'0',ch=getchar();\n\t\treturn s;\n\t}\n\tvoid dfs1(const int &u,const int &f)\n\t{\n\t\tdfn[u]=++num;\n\t\tfor(auto v:g[u])\n\t\t{\n\t\t\tif(v==f)continue;\n\t\t\tif(!dfn[v])dfs1(v,u);\n\t\t\telse if(dfn[u]<dfn[v])eu[tot]=u,ev[tot++]=v;\n\t\t}\n\t}\n\tvoid getdp(const int &u)\n\t{\n\t\tdp[u][0]=!op[u][1],dp[u][1]=!op[u][0],vis[u]=1;\n\t\tfor(auto v:g[u])\t\t\n\t\t{\n\t\t\tif(vis[v])continue;\n\t\t\tgetdp(v);\n\t\t\tdp[u][0]=1ll*dp[u][0]*(dp[v][0]+dp[v][1])%mo;\n\t\t\tdp[u][1]=1ll*dp[u][1]*dp[v][0]%mo;\n\t\t}\n\t}\n\tvoid work()\n\t{\n\t\tn=read(),m=read();\n\t\tfor(int i=1,u,v;i<=m;i++)\n\t\t{\n\t\t\tu=read(),v=read();\n\t\t\tg[u].push_back(v),g[v].push_back(u);\n\t\t}\n\t\tdfs1(1,0);\n\t\tfor(int i=0;i<(1<<tot);i++)\n\t\t{\n\t\t\tfor(int j=0;j<tot;j++)\n\t\t\t\tif((i>>j)&1)op[eu[j]][1]=op[ev[j]][0]=1;\n\t\t\t\t\telse op[eu[j]][0]=1;\n\t\t\tgetdp(1);\n\t\t\tmemset(vis,0,sizeof(bool[n+1]));\n\t\t\tans=(1ll*ans+dp[1][0]+dp[1][1])%mo;\n\t\t\tfor(int j=0;j<tot;j++)\n\t\t\t\tif((i>>j)&1)op[eu[j]][1]=op[ev[j]][0]=0;\n\t\t\t\t\telse op[eu[j]][0]=0;\n\t\t}\n\t\tprintf(\"%d\",ans);\n\t}\n}\nint main()\n{\n\tFGF::work();\n\treturn 0;\n}\n```\n\n**\u6b63\u89e3**\n\n\u53d1\u73b0\u6bcf\u6b21\u72b6\u6001\u53d8\u5316\u7684\u53ea\u6709\u975e\u6811\u8fb9\u6d89\u53ca\u7684\u70b9\uff0c\u8fd9\u6837\u7684\u70b9\u70b9\u6570\u5f88\u5c11\u3002\u5bf9\u8fd9\u4e9b\u70b9\u5efa**\u865a\u6811**\u3002\u8003\u8651\u865a\u6811\u4e0a\u7684\u7236\u5b50\u4e4b\u95f4\u600e\u4e48\u8f6c\u79fb\u3002\u5bf9\u4e8e\u4e00\u6761 $u\\to x_1\\to x_2\\to\\dots x_k \\to v$\uff0c\u6709\u8f6c\u79fb\n\n$dp[x_k][0]=dp'[x_k][0]\\times (dp[v][1]+dp[v][0]),dp[x_k][1]=dp'[x_k][1]\\times dp[v][0]$\n\n$dp[x_{k-1}][0]=dp'[x_{k-1}][0]\\times (dp[x_k][1]+dp[x_k][0])=dp'[x_{k-1}][0]\\times (dp'[x_k][1]\\times dp[v][0]+dp'[x_k][0]\\times (dp[v][1]+dp[v][0])),\\\\dp[x_{k-1}][1]=dp'[x_{k-1}][1]\\times dp[x_k][0]=dp'[x_{k-1}][1]\\times dp'[x_k][0]\\times (dp[v][1]+dp[v][0])$\n\n\u4f9d\u6b21\u7c7b\u63a8\uff0c\u8f6c\u79fb\u65b9\u7a0b\u53ef\u4ee5\u5316\u4e3a $dp[u][0/1]=\\prod (k[0/1][0]dp[v][0]+k[0/1][1]dp[v][1])$\u3002\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u8f6c\u79fb\u7cfb\u6570 $k$ \u5373\u53ef\u3002 $k$ \u7684\u8f6c\u79fb\u548c\u539f\u6765\u7684 dp \u5f0f\u5b50\u57fa\u672c\u76f8\u540c\uff0c\u4f46\u9700\u8981\u5728 $u$ \u4e3a\u5173\u952e\u70b9\u65f6\u91cd\u7f6e\u4e14\u9700\u8981\u7edf\u8ba1\u5206\u53c9\u7684\u8d21\u732e\uff08\u5373\u4e0a\u9762\u7684 $dp'$\uff09\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u5728\u865a\u6811\u4e0a dp \u65f6 $dp[u]$ \u7684\u521d\u59cb\u503c\u4e0d\u518d\u662f 1 \uff0c\u8fd8\u9700\u8981\u9884\u5904\u7406\u51fa dp \u7684\u521d\u59cb\u503c\u3002\n\n\u590d\u6742\u5ea6\u4e3a $O(n+2^{m-n+1}(m-n+1))$\n\n\u611f\u89c9\u8fd8\u662f\u6709\u4e00\u5b9a\u5b9e\u73b0\u4e0a\u7684\u96be\u5ea6\u7684\uff0c\u4ee3\u7801\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u53c2\u8003\u4e86\u7b2c\u4e00\u7bc7\u9898\u89e3\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nnamespace FGF\n{\n\tint n,m;\n\tconst int N=1e5+5,mo=998244353;\n\tint siz[N],dfn[N],num,eu[N],ev[N],tot,dp[N][2],p[N][2],op[N][2],ans;\n\tbool vis[N],is[N];\n\tvector<int> g[N];\n\tstruct Node{\n\t\tint x,y;\n\t\tNode(){}\n\t\tNode(int xx,int yy):x(xx),y(yy){};\n\t}k[N][2];\n\tNode operator +(Node a,Node b){return Node((a.x+b.x)%mo,(a.y+b.y)%mo);}\n\tNode operator *(Node a,int b){return Node(1ll*a.x*b%mo,1ll*a.y*b%mo);}\n\tstruct edg{\n\t\tint to,nxt;Node a,b;\n\t}e[N<<1];\n\tint cnt,head[N];\n\tvoid add(int u,int v,Node a,Node b)\n\t{\n\t\tcnt++;\n\t\te[cnt].to=v;\n\t\te[cnt].nxt=head[u];\n\t\thead[u]=cnt;\n\t\te[cnt].a=a,e[cnt].b=b;\n\t}\n\tvoid dfs1(int u,int f) \n\t{\n\t\tdfn[u]=++num;\n\t\tfor(auto v:g[u])\n\t\t{\n\t\t\tif(v==f)continue;\n\t\t\tif(!dfn[v])dfs1(v,u),siz[u]+=siz[v];\n\t\t\telse\n\t\t\t{\n\t\t\t\tis[u]=1;//\u628a\u865a\u6811\u4e0a\u7684\u70b9\u6807\u8d77\u6765 \n\t\t\t\tif(dfn[u]<dfn[v])eu[tot]=u,ev[tot++]=v;//\u8bb0\u5f55\u975e\u6811\u8fb9 \n\t\t\t}\n\t\t}\n\t\tis[u]|=siz[u]>=2;\n\t\tsiz[u]=siz[u]||is[u];\n\t}\n\tint predp(int u)\n\t{\n\t\tvis[u]=1;\n\t\tp[u][0]=p[u][1]=1;//\u521d\u59cbdp\u503c \n\t\tint pos=0,x;\n\t\tfor(auto v:g[u])\n\t\t{\n\t\t\tif(vis[v])continue;\n\t\t\tx=predp(v);//\u539f\u6811\u5b50\u6811\u5185\u79bb\u81ea\u5df1\u6700\u8fd1\u7684\u865a\u6811\u4e0a\u7684\u70b9 \n\t\t\tif(!x)p[u][0]=1ll*p[u][0]*(p[v][0]+p[v][1])%mo,p[u][1]=1ll*p[u][1]*p[v][0]%mo;\n\t\t\telse if(is[u])add(u,x,k[v][1]+k[v][0],k[v][0]);\n\t\t\telse k[u][1]=k[v][0],k[u][0]=k[v][1]+k[v][0],pos=x;\n\t\t}\n\t\tif(is[u])k[u][0]={1,0},k[u][1]={0,1},pos=u;//\u8fd9\u91cck[u][0]={1,0}\u662f\u56e0\u4e3a\u521d\u59cbk[u][0]+k[u][1]={1,1} \n\t\telse k[u][0]=k[u][0]*p[u][0],k[u][1]=k[u][1]*p[u][1];\n\t\treturn pos;\n\t}\n\tvoid getdp(int u)\n\t{\n\t\tdp[u][0]=(op[u][1]^1)*p[u][0],dp[u][1]=(op[u][0]^1)*p[u][1];\n\t\tfor(int i=head[u];i;i=e[i].nxt)\n\t\t{\n\t\t\tint v=e[i].to;\n\t\t\tgetdp(v);\n\t\t\tdp[u][0]=1ll*dp[u][0]*((1ll*e[i].a.x*dp[v][0]%mo+1ll*e[i].a.y*dp[v][1]%mo)%mo)%mo;\n\t\t\tdp[u][1]=1ll*dp[u][1]*((1ll*e[i].b.x*dp[v][0]%mo+1ll*e[i].b.y*dp[v][1]%mo)%mo)%mo;\n\t\t}\n\t}\n\tvoid work()\n\t{\n\t\tscanf(\"%d%d\",&n,&m);\n\t\tfor(int i=1,u,v;i<=m;i++)\n\t\t{\n\t\t\tscanf(\"%d%d\",&u,&v);\n\t\t\tg[u].push_back(v),g[v].push_back(u);\n\t\t}\n\t\tdfs1(1,0);is[1]=1;\n\t\tpredp(1);\n\t\tfor(int i=0;i<(1<<tot);i++)\n\t\t{\n\t\t\tfor(int j=0;j<tot;j++)\n\t\t\t\tif((i>>j)&1)op[eu[j]][1]=op[ev[j]][0]=1;//op:\u5f3a\u5236\u9009\u67d0\u4e00\u79cd\u60c5\u51b5 \n\t\t\t\t\telse op[eu[j]][0]=1;\n\t\t\tgetdp(1);\n\t\t\tans=(1ll*ans+dp[1][0]+dp[1][1])%mo;\n\t\t\tfor(int j=0;j<tot;j++)\n\t\t\t\tif((i>>j)&1)op[eu[j]][1]=op[ev[j]][0]=0;\n\t\t\t\t\telse op[eu[j]][0]=0;\n\t\t}\n\t\tprintf(\"%d\",ans);\n\t}\n}\nint main()\n{\n\tFGF::work();\n\treturn 0;\n}\n```\n",
        "postTime": 1611068913,
        "uid": 224403,
        "name": "\u6728xx\u6728\u5927",
        "ccfLevel": 9,
        "title": "P4426 [HNOI/AHOI2018]\u6bd2\u7624\uff08\u865a\u6811dp)"
    },
    {
        "content": "~~\u56e0\u4e3a\u6807\u7b7e\u662f\u865a\u6811\u6240\u4ee5\u8003\u8651\u6811~~\n\u770b\u52305~6\u7684\u6570\u636e\u70b9\uff0c\u53d1\u73b0\u56fe\u662f\u68f5\u6811\uff0c\u4e8e\u662f\u5feb\u4e50\u5730\u628a5~6\u6570\u636e\u70b9\u4f5c\u4e3a\u5207\u5165\u70b9\n\n\u5176\u5b9e\u5c31\u662f\u4e48\u6709\u4e0a\u53f8\u7684\u821e\u4f1a\u662f\u5427\n\n $$f[x][0]=\u03a3f[v][0]+f[v][1]$$\n $$f[x][1]=\u03a3f[v][0]$$\n\u90a3\u4e48\u6211\u4eec\u5bf9\u4e8e\u4e00\u4e2a\u56fe\u5c31\u76f4\u63a5\u5730\u628a\u56fe\u7834\u6210\u6811\u597d\u4e86\uff0c\u679a\u4e3e\u6bcf\u6761\u8fb9\u662f\u5426\u9009\u62e9\uff0c\u5f3a\u884c\u8dd1\u6811DP\uff0c\u4f46\u662f\u8fb9\u592a\u591a\u4e86\u6240\u4ee5\u5fc5\u6b7b\u65e0\u7591\n\n~~\u4f46\u662f\u8003\u8651\u6807\u7b7e\u662f\u865a\u6811~~\u4f46\u662f\u770b\u5230\u6570\u636e\uff0c$m$\u53ea\u6bd4$n$\u5927$11$\uff0c\u901a\u8fc7\u865a\u6811\u53ef\u4ee5\u8ba9\u679a\u4e3e\u6b21\u6570\u5927\u5927\u964d\u4f4e\uff0c\u53e6\u5916\uff0c\u56e0\u4e3a\u6bcf\u6b21\u53ea\u4f1a\u6709\u4e00\u4e9b\u7279\u6b8a\u7684\u70b9(\u5c31\u662f\u73af\u4e0a\u7684\u70b9)\u5bf9\u7b54\u6848\u505a\u51fa\u8d21\u732e\uff0c\u53ef\u4ee5\u7528\u865a\u6811\u6765\u4f18\u5316\n\n\u800c\u6700\u5927\u7684$m \\leq n+11$\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e9b\u591a\u51fa\u6765\u7684\u70b9\u62ce\u51fa\u6765\u6784\u5efa\u865a\u6811\uff0c\u5e76\u5728\u865a\u6811\u4e0aDP\n\n### \u6ce8\u610f\uff0c\u63a5\u4e0b\u6765\u662f\u672c\u9898\u6700\u6076\u5fc3\u7684\u5730\u65b9\n\u6211\u4eec\u5047\u8bbe\u6709\u4e0b\u9762\u8fd9\u6761\u94fe\uff08\u8fd9\u6761\u94fe\u5c06\u88ab\u7528\u6765\u5efa\u7acb\u865a\u6811\uff0c\u6211\u4eec\u4f1a\u5728\u8fd9\u6761\u8fb9\u4e0aDP\uff09\n![graph.png](https://i.loli.net/2020/07/30/F1m93pizYnCPN5d.png)\ndp\u6570\u7ec4\u5411\u4e0a\u4f20\u9012\u662f\u6709\u4e00\u5b9a\u89c4\u5f8b\u7684\n $$f[5][0]=\\prod f[6][0]+f[6][1]$$\n $$f[5][1]=\\prod f[6][0]$$\n $$f[4][0]=\\prod f[5][0]+f[5][1]$$\n $$\u5373$$\n $$f[4][0]=\\prod (f[6][0]+f[6][1])+f[6][0]$$\n $$f[4][1]=\\prod f[6][0]+f[6][1]$$\n $$f[3][0]=\\prod f[4][0]+f[4][1]$$\n $$f[3][0]=\\prod ((f[6][0]+f[6][1])+f[6][0])+(f[6][0]+f[6][1])$$\n $$f[3][1]=\\prod f[4][0]$$\n $$f[3][1]=\\prod f[6][0]+f[6][1]+f[6][0]$$\n\u6211\u4eec\u53d1\u73b0\n $$f[6][0] \u548c f[6][1]$$\n\u6bcf\u6b21\u9012\u5f52\u4f1a\u4f20\u9012\u4e00\u6b21\u8fd9\u73a9\u610f\uff0c\u800c\u865a\u6811\u8fb9\u4e0a\u7684\u70b9\u662f\u56fa\u5b9a\u7684\uff0c\u6240\u4ee5\u8fd9\u4e24\u4e2a\u73a9\u610f\u88ab\u52a0\u4e0a\u7684\u6b21\u6570\u662f\u53ef\u4ee5\u9012\u5f52\u5904\u7406\u51fa\u6765\u7684\n\n\u6240\u4ee5\u6211\u4eec\u5f97\u5230\u8fd9\u4e2a\u65b9\u7a0b(v\u662fx\u5728\u865a\u6811\u4e0a\u7684\u7236\u4eb2)\n\n $$f[x][1]=k0[v][1]*f[v][0]+k1[v][1]*f[v][1]$$\n $$f[x][0]=k0[v][0]*f[v][0]+k1[v][0]*f[v][0]$$\n\u9884\u5904\u7406\u51fak\u5c31\u80fd\u8212\u670dDP\n\n\u800c\u9884\u5904\u7406\u7684\u65b9\u6cd5\u6bd4\u8f83\u5751\n\n\u6211\u4eec\u5148\u8003\u8651x\u539f\u6811\u4e0a\u7684\u4e00\u4e2a\u513f\u5b50t\n\n\u8bbe\u5728\u6dfb\u52a0t\uff08\u6811DP\u7684\u65f6\u5019\uff09\u524d$f[x][1]$\u4e3a$ovo[x][1]$\n $$f[x][1]=ovo[x][1]*[(f[v][0]*k1[v][0])+(f[v][1]*k0[v][1])]$$\n \u6240\u4ee5\u8003\u8651\u521a\u624d\u5bf9k\u6570\u7ec4\u7684\u7406\u89e3\n $$k1[v][0]=ovo[x][1]*k0[v][0]$$\n## \u6700\u540e\u68b3\u7406\u4e0bdp\u7684\u6d41\u7a0b\n\u9884\u5904\u7406\u51fak\u6570\u7ec4\n\n\u6bcf\u6b21\u66b4\u529b\u679a\u4e3e\u52a0\u5165\u4e86\u54ea\u4e9b\u975e\u6811\u8fb9\n\n\u6811DP\n```\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define ll long long\n#define N 100020 \n#define mod 998244353\nusing namespace std;\nll head[N],hh[N],dfn[N],dep[N],f[25][N],ff[N][3],k0[N][3],k1[N][3],dp[N][3];\nll b[25],bj[N],in[N],g[N][3],p[N],st[N];\nll n,m,cnt=1,ret,tmp,T,tt,tp,ans;\nbool vis[N],en[N*2];\n\nstruct Tuck{\n      ll u1,v1;\n}tr[N];\n\nstruct The_World{\n      ll to,nxt;\n}q[N*10];\n\nstruct Star_Platinum{\n      ll v,nx;\n}e[N*10];\n\nbool cmp(ll x,ll y){\n      return dfn[x]<dfn[y];\n}\n\nvoid add(ll u,ll v){\n      q[++cnt].to=v,q[cnt].nxt=head[u];\n      head[u]=cnt;\n      q[++cnt].to=u,q[cnt].nxt=head[v];\n      head[v]=cnt;\n}\n\nvoid edd(ll u,ll v){\n\te[++ret].v=v,e[ret].nx=hh[u];\n\thh[u]=ret;\n}\n\nvoid dfs(ll x,ll fa){\n      dfn[x]=++tmp;\n      dep[x]=dep[fa]+1;\n      vis[x]=1;\n      for(ll i=1;i<=20&&f[i-1][x];i++){\n            f[i][x]=f[i-1][f[i-1][x]];\n      }\n      for(ll i=head[x];i;i=q[i].nxt){\n            ll v=q[i].to;\n            if(v!=fa){\n                  if(!vis[v]){\n                        f[0][v]=x;\n                        dfs(v,x);\n                  }\n                  else {\n                        T++;\n                        tr[T].u1=x,tr[T].v1=v;\n                        en[i]=en[i^1]=1;\n                  }\n            }\n      }\n}\n\nll LYCA(ll x,ll y){\n      if(dep[x]<dep[y])swap(x,y);\n      for(ll i=20;i>=0;i--){\n            if(dep[f[i][x]]>=dep[y]){\n                  x=f[i][x];\n            }\n            if(x==y)return x;\n      }\n      for(ll i=20;i>=0;i--){\n            if(f[i][x]!=f[i][y]){\n                  x=f[i][x];\n                  y=f[i][y];\n            }\n      }\n      return f[0][x];\n}\n\nvoid build_vtree(ll x){\n      if(tt==1){\n            st[++tt]=x;\n            return ;\n      }\n      ll lca=LYCA(st[tt],x);\n      while(tt>1&&dfn[st[tt-1]]>=dfn[lca]){\n            edd(st[tt-1],st[tt]);\n            tt--;\n      }\n      if(st[tt]!=lca){\n            in[lca]=1;\n            edd(lca,st[tt]);\n            st[tt]=lca;\n      }\n      st[++tt]=x;\n}\n\nvoid dp1(ll x,ll o){\n      ff[x][0]=ff[x][1]=1;\n      in[x]=1;\n      for(ll i=head[x];i;i=q[i].nxt){\n            ll v=q[i].to;\n            if(v==f[0][x]||v==o||in[v]||en[i])continue;\n            dp1(v,o);\n            ff[x][0]=ff[x][0]*(ff[v][0]+ff[v][1])%mod;\n            ff[x][1]=ff[x][1]*ff[v][0]%mod;\n      }\n}\n\nvoid getk(ll x,ll y){\n      k0[x][0]=1,k1[x][1]=1;\n      for(ll i=x;f[0][i]!=y;i=f[0][i]){\n            dp1(f[0][i],i);\n            ll t0=k0[x][0],t1=k1[x][0];\n            k0[x][0]=ff[f[0][i]][0]*(k0[x][0]+k0[x][1])%mod;\n            k1[x][0]=ff[f[0][i]][0]*(k1[x][0]+k1[x][1])%mod;\n            k0[x][1]=ff[f[0][i]][1]*t0%mod;\n            k1[x][1]=ff[f[0][i]][1]*t1%mod;\n      }\n}\n\nvoid yu_work(ll x){\n      for(ll i=hh[x];i;i=e[i].nx){\n            ll v=e[i].v;\n            yu_work(v),getk(v,x);\n      }\n      ff[x][0]=ff[x][1]=1;\n      for(ll i=head[x];i;i=q[i].nxt){\n            ll v=q[i].to;\n            if(in[v]||en[i]||v==f[0][x])continue;\n            dp1(v,0);\n            ff[x][0]=ff[x][0]*(ff[v][0]+ff[v][1])%mod;\n            ff[x][1]=ff[x][1]*ff[v][0]%mod;\n      }\n}\n\nvoid DP2(ll x){\n      g[x][0]=ff[x][0],g[x][1]=ff[x][1];\n      for(ll i=hh[x];i;i=e[i].nx){\n            ll v=e[i].v;\n            if(v!=f[0][x]){\n                  DP2(v);\n                  ll f0=(k0[v][0]*g[v][0]%mod+k1[v][0]*g[v][1]%mod)%mod;\n                  ll f1=(k0[v][1]*g[v][0]%mod+k1[v][1]*g[v][1]%mod)%mod;\n                  g[x][0]=g[x][0]*(f0+f1)%mod;\n                  g[x][1]=g[x][1]*f0%mod;\n            }\n      }\n      if(bj[x]==1)g[x][0]=0;\n      if(bj[x]==-1)g[x][1]=0;\n}\n\nint main(){\n      scanf(\"%lld%lld\",&n,&m);\n      for(ll i=1;i<=m;i++){\n            ll a1,a2;\n            scanf(\"%lld%lld\",&a1,&a2);\n            add(a1,a2);\n      }\n      dfs(1,0);\n      for(ll i=1;i<=T;i++){\n            if(!in[tr[i].u1])in[tr[i].u1]=1,p[++tp]=tr[i].u1;\n            if(!in[tr[i].v1])in[tr[i].v1]=1,p[++tp]=tr[i].v1;\n      }\n      sort(p+1,p+1+tp,cmp);\n      st[tt=1]=1;\n      for(ll i=1;i<=tp;i++){\n            if(p[i]==1)continue;\n            build_vtree(p[i]);\n      }\n      while(tt>1){\n            edd(st[tt-1],st[tt]);\n            tt--;\n      }\n      yu_work(1);\n      b[1]=1;\n      for(ll i=2;i<=tp+1;i++)b[i]=b[i-1]*2;\n      for(ll i=0;i<b[tp+1];i++){\n            for(ll j=1;j<=tp;j++){\n                  if(i&b[j])bj[p[j]]=1;\n                  else bj[p[j]]=-1;\n            }\n            bool pool=0;\n            for(ll j=1;j<=T;j++){\n                if(bj[tr[j].u1]==1&&bj[tr[j].v1]==1){\n                      pool=1;break;\n                }\n            }\n          if(pool)continue;\n          DP2(1);\n          ans=(ans+(g[1][0]+g[1][1])%mod)%mod;\n    }\n    printf(\"%lld\",ans);\n}\n```",
        "postTime": 1596114921,
        "uid": 251882,
        "name": "\u849f\u84bb\u4e01",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4426 \u3010[HNOI/AHOI2018]\u6bd2\u7624\u3011"
    },
    {
        "content": "# \u9898\u76ee\u5206\u6790\n\n[\u4f60\u771f\u7684\u4e0d\u60f3\u6765\u53ef\u7231\u7684\u6211\u7684\u535a\u5ba2\u91cc\u7785\u4e00\u773c\u5417\uff1f](https://blog.csdn.net/litble/article/details/80437073)\n\n\u8fd9\u662f\u4e00\u9053\u867d\u7136\u4e0d\u662f\u6570\u636e\u7ed3\u6784\uff0c\u4f46\u4e5f\u8db3\u591f\u6bd2\u7624\u4e86\u7684\u6bd2\u7624\u9898\u3002\n\n\u539f\u56fe\u5e94\u8be5\u662f\u4e00\u68f5\u6811+\u82e5\u5e72\u975e\u6811\u8fb9\uff0c\u9898\u610f\u8f6c\u5316\u4e3a\u6c42\u72ec\u7acb\u96c6\u6570\u91cf\u3002\n\n\u5148\u8003\u8651\u66b4\u529b\u505a\u6cd5\uff0c\u5bf9\u4e8e\u4e0e\u975e\u6811\u8fb9\u76f8\u8fde\u7684\u70b9\uff0c\u6211\u4eec\u66b4\u529b\u679a\u4e3e\u5b83\u662f\u9009\uff0c\u8fd8\u662f\u4e0d\u9009\u3002\u7136\u540e\u518d\u8dd1\u4e00\u904d\u6811\u5f62dp\u7edf\u8ba1\u7b54\u6848\uff0c\u65b9\u7a0b\u663e\u800c\u6613\u89c1\uff1a\n\n`f[x][0]=f[x][0]*(f[son][0]+f[son[1]);`\n\n`f[x][1]=f[x][1]*f[son][0];`\n\n\u5f53\u7136\u8fd9\u4e2a\u505a\u6cd5\u8fd8\u662f\u53ef\u4ee5\u7528\u5bb9\u65a5\u4f18\u5316\u7684\uff0c\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u62ff\u523070~80\u5206\u7684\u597d\u5206\u6570\uff0c\u867d\u7136\u5212\u7b97\u4f46\u8fd9\u5e76\u4e0d\u662f\u6211\u4eec\u7684\u91cd\u70b9\u3002\n\n\u90a3\u4e48\u6709\u6ca1\u6709\u4ec0\u4e48\u4f18\u7f8e\u4e00\u70b9\u7684\u505a\u6cd5\u5462\uff1f\u8003\u8651\u6211\u4eecdp\u7684\u65f6\u5019\u53ef\u4ee5\u4e0d\u6574\u68f5\u6811\u5f04\u4e00\u6b21\uff0c\u800c\u662f\u53ea\u628a\u90a3\u4e9b\u4e0e\u975e\u6811\u8fb9\u76f8\u8fde\u7684\u70b9\u62ff\u51fa\u6765\u5f04\u4e00\u5f04.......\u8ba9\u6211\u4eec\u6765\u5efa\u865a\u6811\u5427\uff01\n\n\u90a3\u4e48\u5efa\u51fa\u865a\u6811\u540e\uff0c\u8981\u600e\u4e48\u5feb\u901fdp\u5462\uff1f\n\n\u5047\u8bbe\u5728\u865a\u6811\u4e0a\u6709\u4e24\u4e2a\u70b9x,y\uff0cy\u662fx\u7684\u7236\u4eb2\u3002\u5728\u539f\u6811\u4e0a\uff0cy\u7684\u513f\u5b50\u662ft,\u5e76\u4e14\u5b58\u5728:\n\n`f[t][0]=k0[x][0]*f[x][0]+k1[x][0]*f[x][1];`\n\n`f[t][1]=k0[x][1]*f[x][0]+k1[x][1]*f[x][1];`\n\n\u90a3\u4e48\u5047\u8bbe\u9664\u53bbt\u8fd9\u68f5\u5b50\u6811\u7684\u8d21\u732e\u540e\uff0cf(y,0)\u548cf(y,1)\u5206\u522b\u8bb0\u4e3aorz(y,0),orz(y,1),\u5c31\u6709\uff1a\n\n`f[y][0]=orz[y][0]*(k0[x][0]+k0[x][1])*f[x][0]+orz[y][0]*(k1[x][0]+k1[x][1])*f[x][1]);`\n\n`f[y][1]=orz[y][1]*k0[x][0]*f[x][0]+orz[y][1]*k1[x][0]*f[x][1];`\n\n\u7531\u6b64\u53ef\u89c1\uff0ck0\u548ck1\u662f\u53ef\u4ee5\u8fdb\u884cdp\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u505a\u4e00\u6b21\u9884\u5904\u7406\uff0c\u5728\u4e0d\u8003\u8651\u4ee5\u865a\u6811\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u7684\u524d\u63d0\u4e0b\u5f04\u51faorz\uff0c\u7136\u540e\u518d\u5bf9k0\u548ck1\u8fdb\u884cdp\uff0c\u6700\u540e\u6c42\u51fa\u6765\u3002\n\n\u7136\u540e\u679a\u4e3e\u6240\u6709\u4e0e\u975e\u6811\u8fb9\u76f8\u8fde\u7684\u70b9\u662f\u9009\u8fd8\u662f\u4e0d\u9009\uff0c\u7136\u540e\u5728\u865a\u6811\u4e0adp\uff0c\u6bcf\u6b21dp\u5230y\u65f6\uff0c\u53ef\u4ee5O(1)\u6c42\u51faf(t,0)\u548cf(t,1)\uff0c\u5c31\u53ef\u4ee5\u6109\u2642\u5feb\u5730dp\u5566\uff01\n\n# \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint read() {\n\tint q=0;char ch=' ';\n\twhile(ch<'0'||ch>'9') ch=getchar();\n\twhile(ch>='0'&&ch<='9') q=q*10+ch-'0',ch=getchar();\n\treturn q;\n}\n#define RI register int\nconst int mod=998244353,N=100020;\nint n,m,now,K,js,top,ans;\nint fa[N][17],dep[N],pos[N],vis[N],u[20],v[20],eno[N<<1];\nstruct tree{\n\tint tot,h[N],ne[N<<1],to[N<<1];\n\tvoid add(int x,int y) {to[++tot]=y,ne[tot]=h[x],h[x]=tot;}\n}T1,T2;\n\nvoid dfs(int x,int las) {\n\tpos[x]=++now,dep[x]=dep[las]+1,fa[x][0]=las,vis[x]=1;\n\tfor(RI i=1;i<=16;++i) fa[x][i]=fa[fa[x][i-1]][i-1];\n\tfor(RI i=T1.h[x];i;i=T1.ne[i])\n\t\tif(T1.to[i]!=las) {\n\t\t\tif(!vis[T1.to[i]]) dfs(T1.to[i],x);\n\t\t\telse ++K,u[K]=x,v[K]=T1.to[i],eno[i]=eno[i^1]=1;\n\t\t}\n}\nint lca(int x,int y) {\n\tif(dep[x]<dep[y]) swap(x,y);\n\tfor(RI i=16;i>=0;--i) if(dep[fa[x][i]]>=dep[y]) x=fa[x][i];\n\tif(x==y) return x;\n\tfor(RI i=16;i>=0;--i)\n\t\tif(fa[x][i]!=fa[y][i]) x=fa[x][i],y=fa[y][i];\n\treturn fa[x][0];\n}\nint inT2[N],st[100],p[100];\nbool cmp(int x,int y) {return pos[x]<pos[y];}\nvoid buildT2() {//\u5efa\u865a\u6811\n\tfor(RI i=1;i<=K;++i) {\n\t\tif(!inT2[u[i]]) inT2[u[i]]=1,p[++js]=u[i];\n\t\tif(!inT2[v[i]]) inT2[v[i]]=1,p[++js]=v[i];\n\t}\n\tsort(p+1,p+1+js,cmp);\n\tif(!inT2[1]) inT2[1]=1,st[++top]=1;\n\tfor(RI i=1;i<=js;++i) {\n\t\tint x=p[i],o=0;\n\t\twhile(top) {\n\t\t\to=lca(st[top],x);\n\t\t\tif(top>1&&dep[st[top-1]]>dep[o]) T2.add(st[top-1],st[top]),--top;\n\t\t\telse if(dep[st[top]]>dep[o]) {inT2[o]=1,T2.add(o,st[top]),--top;break;}\n\t\t\telse break;\n\t\t}\n\t\tif(st[top]!=o) inT2[o]=1,st[++top]=o;\n\t\tst[++top]=x;\n\t}\n\twhile(top>1) T2.add(st[top-1],st[top]),--top;\n}\n\nint f[N][2],k0[N][2],k1[N][2],g[N][2],bin[25],bj[N];\nvoid predp(int x,int no) {//\u8fdb\u884c\u66b4\u529b\u7b97\u6cd5\u4e2d\u7684dp\uff0c\u4f46\u662f\u4ee5no\u4e3a\u6839\u7684\u5b50\u6811\u4e0d\u8003\u8651\n\tf[x][0]=f[x][1]=1,inT2[x]=1;\n\tfor(RI i=T1.h[x];i;i=T1.ne[i]) {\n\t\tif(T1.to[i]==fa[x][0]||T1.to[i]==no||inT2[T1.to[i]]||eno[i]) continue;\n\t\tpredp(T1.to[i],no);\n\t\tf[x][0]=1LL*f[x][0]*(f[T1.to[i]][0]+f[T1.to[i]][1])%mod;\n\t\tf[x][1]=1LL*f[x][1]*f[T1.to[i]][0]%mod;\n\t}\n}\nvoid getk(int x,int y) {//\u83b7\u5f97k0,k1\u7684\u503c\n\tk0[x][0]=1,k1[x][1]=1;\n\tfor(RI i=x;fa[i][0]!=y;i=fa[i][0]) {\n\t\tpredp(fa[i][0],i);\n\t\tint t0=k0[x][0],t1=k1[x][0];\n\t\tk0[x][0]=1LL*f[fa[i][0]][0]*(k0[x][0]+k0[x][1])%mod;\n\t\tk1[x][0]=1LL*f[fa[i][0]][0]*(k1[x][0]+k1[x][1])%mod;\n\t\tk0[x][1]=1LL*f[fa[i][0]][1]*t0%mod;\n\t\tk1[x][1]=1LL*f[fa[i][0]][1]*t1%mod;\n\t}\n}\nvoid prework(int x) {//\u9884\u5904\u7406\n\tfor(RI i=T2.h[x];i;i=T2.ne[i]) prework(T2.to[i]),getk(T2.to[i],x);\n\tf[x][0]=f[x][1]=1;\n\tfor(RI i=T1.h[x];i;i=T1.ne[i]) {//\u5bf9\u4e8e\u6ca1\u6709\u865a\u6811\u70b9\u7684\u5b50\u6811\u8fdb\u884c\u9884\u5904\u7406dp\n\t\tif(inT2[T1.to[i]]||eno[i]||T1.to[i]==fa[x][0]) continue;\n\t\tpredp(T1.to[i],0);\n\t\tf[x][0]=1LL*f[x][0]*(f[T1.to[i]][0]+f[T1.to[i]][1])%mod;\n\t\tf[x][1]=1LL*f[x][1]*f[T1.to[i]][0]%mod;\n\t}\n}\nvoid dp(int x) {//\u7edf\u8ba1\u7b54\u6848\n\tg[x][0]=f[x][0],g[x][1]=f[x][1];\n\tfor(RI i=T2.h[x];i;i=T2.ne[i]) {\n\t\tint y=T2.to[i];dp(y);\n\t\tint f0=(1LL*k0[y][0]*g[y][0]%mod+1LL*k1[y][0]*g[y][1]%mod)%mod;\n\t\tint f1=(1LL*k0[y][1]*g[y][0]%mod+1LL*k1[y][1]*g[y][1]%mod)%mod;\n\t\tg[x][0]=1LL*g[x][0]*(f0+f1)%mod,g[x][1]=1LL*g[x][1]*f0%mod;\n\t}\n\tif(bj[x]==1) g[x][0]=0;\n\tif(bj[x]==-1) g[x][1]=0;\n}\n\nint qm(int x) {return x>=mod?x-mod:x;}\nint main()\n{\n\tint x,y;\n\tn=read(),m=read(),T1.tot=1;\n\tfor(RI i=1;i<=m;++i) x=read(),y=read(),T1.add(x,y),T1.add(y,x);\n\tdfs(1,0),buildT2(),prework(1);\n\tbin[1]=1;for(RI i=2;i<=js+1;++i) bin[i]=bin[i-1]<<1;\n\tfor(RI zt=0;zt<bin[js+1];++zt) {//\u679a\u4e3e\u4e0e\u975e\u6811\u8fb9\u76f8\u8fde\u7684\u70b9\u7684\u72b6\u6001\n\t\tfor(RI i=1;i<=js;++i)\n\t\t\tif(zt&bin[i]) bj[p[i]]=1;\n\t\t\telse bj[p[i]]=-1;\n\t\tint flag=0;\n\t\tfor(RI i=1;i<=K;++i) if(bj[u[i]]==1&&bj[v[i]]==1) {flag=1;break;}\n\t\tif(flag) continue;\n\t\tdp(1),ans=qm(ans+qm(g[1][0]+g[1][1]));\n\t}\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1527152218,
        "uid": 20604,
        "name": "litble",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4426 \u3010[HNOI/AHOI2018]\u6bd2\u7624\u3011"
    },
    {
        "content": "\u672c\u7bc7\u9898\u89e3\u4e3a\u66b4\u529b\u5361\u5e38\u3002\u9644\u5728[\u6d1b\u8c37](/record/list?pid=P4426&user=128570)\u548c [loj](https://loj.ac/s?problemDisplayId=2496&submitter=XG0000) \u7684\u63d0\u4ea4\u8bb0\u5f55\u5217\u8868\u94fe\u63a5\uff0c\u53ef\u4ee5\u6b64\u8f85\u52a9\u9605\u8bfb\u9898\u89e3\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/fizhex4n.png)\n\n------------\n\n\u9996\u5148\u8bb0 $k=m-n+1$ \u4e3a\u975e\u6811\u8fb9\u6570\u91cf\u3002\n\n\u5728\u5ea7\u5927\u4f19\u80af\u5b9a\u90fd\u77e5\u9053\u6811\u4e0a\u72ec\u7acb\u96c6\u8ba1\u6570\u5982\u4f55\u505a\u3002\u8bbe $f_{u,0/1}$ \u8868\u793a\u94a6\u5b9a $u$ \u4e0d\u9009/\u9009\u65f6\u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\u6709\n\n$$f_{u,0}=\\prod_{v\\in son_u}(f_{v,0}+f_{v,1}),f_{u,1}=\\prod_{v\\in son_u}f_{v,0}$$\n\n\u5bf9\u4e8e\u975e\u6811\u8fb9\uff0c\u6211\u4eec\u94a6\u5b9a\u679a\u4e3e\u5176\u4e2d\u4e00\u4e2a\u9009\u6216\u4e0d\u9009\uff0c\u94a6\u5b9a\u9009\u65f6\u5219\u8fd9\u6761\u8fb9\u7684\u53e6\u4e00\u4e2a\u70b9\u5fc5\u4e0d\u9009\uff0c\u4fee\u6539\u521d\u503c\u5373\u53ef\u3002\u8fd9\u91cc\u6211\u4eec\u94a6\u5b9a\u679a\u4e3e\u4e24\u7aef\u70b9\u4e2d\u8f83\u6d45\u7684\u70b9\u3002\u4e8e\u662f\u6211\u4eec\u83b7\u5f97\u4e86\u4e00\u4e2a $\\mathcal O(n2^k)$ \u7684\u505a\u6cd5\u3002\n\n\u8003\u8651\u5361\u5e38\u3002\u74f6\u9888\u5728\u4e8e\u6211\u4eec\u5171\u8981\u904d\u5386 $2^k$ \u6b21\u6811\u8fdb\u884c dp\uff0c\u4e8e\u662f\u60f3\u5230\u8bb0\u5f55 dfs \u5e8f\uff0c\u5c06\u9012\u5f52\u641c\u7d22\u6539\u4e3a\u5faa\u73af\u3002\n\n\u65e0\u7b26\u53f7\u6570\u5bf9\u5e38\u6570\u53d6\u6a21\u6709\u901f\u5ea6\u4f18\u52bf\uff0c\u6240\u4ee5\u5728\u8f6c\u79fb\u4e2d\u505a\u4e58\u6cd5\u65f6\u5f3a\u5236\u8f6c\u6362\u4e3a ull \u800c\u4e0d\u662f ll\u3002\n\n\u4f17\u6240\u5468\u77e5\u6570\u7ec4\u8fde\u7eed\u8bbf\u95ee\u662f\u8f83\u5feb\u7684\uff0c\u6240\u4ee5\u5c06\u70b9\u6309 dfs \u5e8f\u91cd\u6807\u53f7\uff0c\u8fd9\u6837\u5c31\u80fd\u5728 dp \u65f6\u8fde\u7eed\u8bbf\u95ee dp \u6570\u7ec4\uff0c\u52a0\u5feb\u901f\u5ea6\u3002\n\n\u4f7f\u7528[\u6570\u7ec4\u524d\u5411\u661f](/blog/zhjxaoini/yi-zhong-gao-xiao-de-cun-tu-fang-shi-shu-zu-qian-xiang-xing)\u4fdd\u5b58\u6811\u8fb9\uff0c\u8fd9\u6837\u5b58\u8fb9\u6570\u7ec4\u7684\u8bbf\u95ee\u4e5f\u53ef\u4ee5\u8fde\u7eed\u3002\u74f6\u9888\u4e0d\u5728\u6b64\u5904\u6240\u4ee5\u5176\u4e2d\u7684\u6392\u5e8f\u7528 sort \u5c31\u53ef\u4ee5\u3002\n\n\u53e6\u5916\u4e0d\u8981\u5fd8\u4e86\u5438 O2\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u83b7\u5f97 90pts \u7684\u9ad8\u5206\uff0c\u89c1\u6d1b\u8c37\u63d0\u4ea4\u8bb0\u5f55\u7b2c\u4e8c\u6761\u6216 loj \u63d0\u4ea4\u8bb0\u5f55\u7b2c\u4e8c\u6761\u3002\n\n\u56de\u5934\u770b\u770b\u5bf9\u975e\u6811\u8fb9\u7684\u5904\u7406\uff0c\u5bb9\u6613\u53d1\u73b0\u5f53\u5b58\u5728\u4e00\u4e2a\u70b9 $u$ \u7684 $f_{u,0/1}$ \u521d\u503c\u5747\u4e3a $0$ \u65f6\u6574\u68f5\u6811\u7684\u65b9\u6848\u6570\u5747\u4e3a $0$\uff0c\u53ef\u4ee5\u76f4\u63a5\u8df3\u8fc7\u8fd9\u79cd\u60c5\u51b5\u3002\u52a0\u5165\u6b64\u7279\u5224\u5373\u53ef AC \u672c\u9898\uff0c\u89c1\u6d1b\u8c37\u63d0\u4ea4\u8bb0\u5f55\u7b2c\u56db\u6761\u6216 loj \u63d0\u4ea4\u8bb0\u5f55\u7b2c\u4e00\u6761\u3002~~\u5fd8\u8bb0\u52fe\u9009 O2~~ \u4e0d\u5f00 O2 \u53ef\u4ee5\u83b7\u5f97 75pts\uff0c\u89c1\u6d1b\u8c37\u63d0\u4ea4\u8bb0\u5f55\u7b2c\u4e09\u6761\u3002\n\n\u8fd9\u4e2a\u6545\u4e8b\u544a\u8bc9\u6211\u4eec\uff0c\u611f\u8c22 O2\uff0c\u611f\u8c22 NOILinux2.0\u3002\n\n\u601d\u8003\u4e00\u4e0b\u8fd9\u6837\u7279\u5224\u7684\u9053\u7406\u3002\u53bb loj \u628a\u521a\u624d TLE \u7684\u6570\u636e\u70b9 #19 #20 \u6252\u4e0b\u6765\uff0c\u53d1\u73b0\u5b83\u4eec\u5747\u6ee1\u8db3 $n=10^5,m=n+10$\u3002\u62ff\u4e00\u4e2a set \u8bb0\u5f55\u4e00\u4e0b\u975e\u6811\u8fb9\u7aef\u70b9\uff0c\u8f93\u51fa\u8fd9\u4e2a set \u7684 size() \u53d1\u73b0\u5747\u4e3a $21$\uff0c\u4e5f\u5c31\u662f\u6070\u6709\u4e00\u4e2a\u7aef\u70b9\u4f5c\u4e3a\u975e\u6811\u8fb9\u7684\u4ea4\u3002\u8fd9\u65f6\u52a0\u5165\u4e0a\u9762\u7684\u7279\u5224\uff0c\u6709\u673a\u4f1a\u5c06\u6240\u679a\u4e3e\u7684\u60c5\u51b5\u6570\u51cf\u5c11 1/2 \u6216 1/4\uff0c\u4e8e\u662f\u4fbf\u8db3\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\n\u6df1\u5165\u601d\u8003\u5e76\u5c1d\u8bd5\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u5728\u5904\u7406\u975e\u6811\u8fb9\u65f6\u94a6\u5b9a\u679a\u4e3e\u7684\u662f\u8f83\u6df1\u7684\u70b9\uff0c\u5219\u4ecd\u83b7\u5f97 90pts\uff0c\u89c1 loj \u63d0\u4ea4\u8bb0\u5f55\u7b2c\u4e09\u6761\u3002\u6240\u4ee5\u8bf4\u8fd9\u79cd\u505a\u6cd5\u662f\u4e0d\u9760\u8c31\u7684\u9762\u5411\u6570\u636e\uff0c\u8981\u8d70\u6b63\u9053\u8fd8\u662f\u5f97\u8001\u5b9e\u5199\u865a\u6811\u3002~~\u73b0\u5728\u60a8\u53ef\u4ee5\u56de\u5230\u7b2c\u4e00\u9875\u53bb\u770b\u5176\u4ed6\u9898\u89e3\u4e86\u3002~~\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/cfs7bf1e.png)",
        "postTime": 1678676270,
        "uid": 128570,
        "name": "StarLbright40",
        "ccfLevel": 9,
        "title": "P4426 \u66b4\u529b\u9898\u89e3"
    },
    {
        "content": "[\u9898\u4f20](https://www.luogu.com.cn/problem/P4426)\n\n\u7eaa\u5ff5\u4e00\u624b 800 AC\u3002\n\nDP \u725b\u725b\u9898\uff0c\u865a\u6811 \u677f\u677f\u9898\u3002\n\n\u82e5 $m=n-1$\uff0c\u5219\u8fd9\u662f\u4e00\u68f5\u6811\uff0c\u90a3\u4e48\u663e\u7136\u6709\u4e2a\u5f88 easy \u7684\u52a8\u6001\u89c4\u5212\uff0c\u8bbe $f_{x, 0/1}$ \u4e3a\u5f53\u524d\u5b50\u6811\u4e2d \u4e0d\u9009/\u9009 \u6839\u7684\u65b9\u6848\u6570\uff1a\n\n$$f_{x,0}=\\prod_{(x, y) \\in T} (f_{y, 0}+f_{y, 1})$$\n\n$$f_{x,1}=\\prod_{(x, y) \\in T} f_{y, 0}$$\n\n\u53d1\u73b0 $m-(n-1) \\le 11$\uff0c\u4ec0\u4e48\u610f\u601d\u5462\uff1f\u6211\u4eec\u5728\u539f\u56fe\u4e2d\u6784\u9020\u4e00\u9897\u751f\u6210\u6811\uff0c\u5219\u975e\u6811\u8fb9\u4e0d\u8d85\u8fc7 $11$ \u6761\uff0c\u6211\u4eec\u5f04\u51fa\u6765\u8fd9 $11$ \u6761\u8fb9\u5bf9\u5e94\u7684\u70b9\u96c6 $D$\u3002\n\n\u8003\u8651\u66b4\u529b\u679a\u4e3e\u96c6\u5408 $D$ \u4e2d\u7684\u6240\u6709\u70b9\u7684\u72b6\u6001\uff08\u662f\u5426\u5728\u6700\u7ec8\u5907\u9009\u96c6\u5408\u4e2d\uff09\uff0c\u90a3\u4e48\u5c31\u73c2\u4ee5\u65e0\u89c6\u8fd9 $11$ \u6761\u989d\u5916\u8fb9\u4e86\uff0c\u6b64\u65f6\u4ecd\u7136\u8fd8\u662f\u6811\u5f62 DP\uff0c\u590d\u6742\u5ea6 $O(2^{22}n)$\uff0c\u663e\u7136\u8fc7\u4e0d\u53bb\u3002\n\n\n\u8003\u8651\u5230\u6bcf\u6b21\u53ea\u6709\u4e00\u5806\u5173\u952e\u70b9\uff08$D$ \u4e2d\u7684\u70b9\uff09\u7684\u9650\u5236\u6761\u4ef6\u88ab\u6539\u53d8\uff0c\u8fd9\u8ba9\u6211\u4eec\u8054\u60f3\u5230\u4e86\u865a\u6811\uff0c\u90a3\u4e48\u5efa\u51fa\u865a\u6811\uff0c\u8003\u8651\u5982\u4f55\u7b97\u865a\u6811\u4e0a\u76f8\u90bb\u4e24\u70b9\u4e4b\u95f4\u7684\u8d21\u732e\uff0c\u4e0d\u96be\u53d1\u73b0\u4e2d\u95f4\u8fd9\u4e2a\u90e8\u5206\u8fd8\u662f\u4e00\u68f5\u5c0f\u6811\uff0c\u4e14\u8fd9\u68f5\u6811\u5185\u663e\u7136\u662f\u6ca1\u6709\u5176\u4ed6\u5173\u952e\u70b9\u7684\uff08\u4e0d\u7136\u5c31\u4e0d\u6ee1\u8db3\u865a\u6811\u5b9a\u4e49\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u63d0\u524d\u5c06\u8fd9\u4e2a\u90e8\u5206\u7684\u7b54\u6848\u9884\u5904\u7406\u597d\uff0c\u7136\u540e\u679a\u4e3e $D$ \u72b6\u6001\u7684\u65f6\u5019\u5728\u865a\u6811\u4e0a\u8dd1\u4e00\u904d\u8ba1\u6570 DP \u5c31\u884c\u4e86\u3002\n\n\u8bbe $g(x, y, 0/1, 0/1)$ \u4e3a \u539f\u6811\u4e0a $x-y$ \u8def\u5f84\u6240\u5728\u8fde\u901a\u5757\u4e2d\uff0c\u6ee1\u8db3 $x$ \u9009/\u4e0d\u9009\uff0c$y$ \u9009/\u4e0d\u9009 \u7684\u65b9\u6848\u6570\uff0c\u5219\uff1a\n\n$$f_{x,ty1}=k_x\\prod_y (\\sum_{ty2} f_{y,ty2} \\times g(x, y, ty1, ty2))$$\n\n\u6ce8\u610f\u865a\u6811\u4e0a\u7684\u70b9\u5728\u539f\u6811\u4e2d\u9664\u4e86\u8fde\u5411\u513f\u5b50\u7684\u8fb9\u5916\u53ef\u80fd\u8fd8\u6709\u4e00\u4e9b\u5355\u94fe\uff0c\u8fd9\u4e9b\u6784\u6210\u4e86\u4e0a\u5f0f\u7684\u7cfb\u6570 $k_x$\u3002\n\n[$Code$](https://loj.ac/s/1527985)",
        "postTime": 1658695287,
        "uid": 341102,
        "name": "ReKoJ",
        "ccfLevel": 0,
        "title": "P4426 [HNOI/AHOI2018]\u6bd2\u7624"
    },
    {
        "content": "\u849f\u84bb\u8fd9\u9053\u9898\u505a\u4e86\u5f88\u4e45\uff0c\u8fd9\u7bc7\u9898\u89e3\u5176\u5b9e\u662f\u5bf9 @Soulist \u5927\u4f6c\u7684\u4ee3\u7801\u7684\u8865\u5145\u3002\u8865\u5145\u4e86\u7cfb\u6570\u7684\u63a8\u5bfc\uff0c\u4ee5\u53ca\u4e00\u4e9b\u7ec6\u8282\u95ee\u9898\u3002\u53ef\u4ee5\u642d\u914d\u7740\u5927\u4f6c\u7684\u98df\u7528\u3002\u6240\u4ee5\u6211\u7701\u7565\u4e86\u53ef\u4ee5\u627e\u7cfb\u6570\u7684\u8fc7\u7a0b\u7684\u63a8\u5bfc\u3002\n\n\u9996\u5148\u627e\u51fa\u6240\u6709\u7684\u975e\u6811\u8fb9\uff0c\u5bf9\u8fd9\u4e9b\u975e\u6811\u8fb9\u7684\u7aef\u70b9\u8fdb\u884c\u53bb\u91cd\uff0c\u5efa\u7acb\u865a\u6811\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u9700\u8981\u5904\u7406\u4e24\u4e2a\u4e1c\u897f\uff1a\n\n1. \u865a\u6811\u4e0a\u7684\u8282\u70b9\uff0c\u9664\u8fc7\u6709\u5173\u952e\u70b9\u7684\u5b50\u6811\uff0c\u5176\u5176\u4ed6\u5b50\u6811\u7684\u603b\u7b54\u6848\u3002\n\n2. \u627e\u5230\u6bcf\u4e2a\u70b9\u5411\u7236\u4eb2\u8f6c\u79fb\u65f6\u7684\u7cfb\u6570\u3002\n\n\u5173\u4e8e 1. \u6211\u4eec\u53ef\u4ee5\u76f4\u63a5 $\\text{DP}$ \u89e3\u51b3\u3002\u6240\u4ee5\u6700\u4e3b\u8981\u7684\u95ee\u9898\u5c31\u662f 2.\n\n\u4ee5\u4e0b\u56fe\u4e3a\u4f8b\u5b50\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/cgie420z.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n\n\u6211\u4eec\u5047\u8bbe $1,5$ \u65f6\u865a\u6811\u4e0a\u7684\u8282\u70b9\uff0c$2,3,4$ \u662f\u88ab\u7f29\u5230\u8fb9\u4e0a\u7684\u8282\u70b9\uff0c\u663e\u7136 $2,3,4$ \u9664\u8fc7\u8fd9\u4e9b\u94fe\u4e0a\u7684\u8282\u70b9\u6240\u5728\u7684\u5b50\u6811\u4e4b\u5916\uff0c\u8fd8\u6709\u5176\u4ed6\u5b50\u6811\uff0c\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u8bb0\u4e3a $g_{x,0/1}$\uff0c\u5176\u6240\u6709\u5b50\u6811\u7684\u7b54\u6848\u8bb0\u4e3a $f_{x,0/1}$\u3002\u8bb0 $k0_{0}$ \u662f\u94a6\u5b9a\u5f53\u524d\u8ba1\u7b97\u5230\u7684\u8282\u70b9 $x$ \u7684\u7236\u4eb2\u4e0d\u9009\u65f6\uff0c$f_{1,0}$ \u7684\u7cfb\u6570\u3002\u90a3\u4e48\u6211\u4eec\u4ece $1$ \u5f00\u59cb\u5411\u4e0a\u65b9\u8fdb\u884c\u8ba1\u7b97\u3002\u4e5f\u5c31\u662f\u8bf4\u6700\u5f00\u59cb\uff0c$2,1$ \u4e4b\u95f4\u7684\u8f6c\u79fb\uff0c\u90a3\u4e48\u6700\u65e9\u7684\u7cfb\u6570\uff0c\u5c31\u5e94\u8be5\u662f $k0_{0}=1,k0_{1}=1,k1_{0}=1,k1_{1}=0$\u3002\u7136\u540e\u6211\u4eec\u5f00\u59cb\u5411\u4e0a\u8f6c\u79fb\uff0c\u73b0\u5728\u8003\u8651\u7684\u662f $3$ \u7684\u7cfb\u6570\uff0c\u6bd4\u5982\u8bf4 $k0_0$ \u3002\u5176\u65b9\u7a0b\u5e94\u8be5\u662f$f_{3,0}=g_{3,0} \\times (f_{2,0}+f_{2,1})$\uff0c\u4e5f\u5c31\u662f\u8bf4\u73b0\u5728\u6240\u8c13\u7684\u7cfb\u6570\u5c31\u662f\u5c06 $(f_{2,0}+f_{2,1})$ \u5c55\u5f00\u6210\u5e26\u7cfb\u6570\u7684\u65b9\u5f0f\uff0c$f_{2,0}+f_{2,1}= g_{2,0} \\times(k0_0 \\times f_{1,0}+k0_1 \\times f_{1,1})+g_{2,1}\\times(k1_0 \\times f_{1,0}+k1_1 \\times f_{1,1})$\uff0c\u5c06\u5176\u5c55\u5f00\uff0c\u770b $f_{1,0}$ \u7684\u7cfb\u6570\u5c31\u53ef\u4ee5\u5c31\u662f\u5f53\u524d\u7684 $k0_{0}$ \uff0c\u5728\u5f80\u4e0a\u7ee7\u7eed\u63a8\uff0c\u53d1\u73b0\u89c4\u5f8b\u662f\u4e00\u6837\u7684\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6240\u6709\u7684\u7cfb\u6570\u3002\n\n\u4ee3\u7801\u4e5f\u5c31\u975e\u5e38\u7b80\u5355\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long \n#define mod 998244353\n#define N 201005\n#define pii pair<int,int>\n#define fi first\n#define se second\n#define mp make_pair\n#define pb push_back\nusing namespace std;\nint n,m,ffa[N];\nint k,h[N];\nint head[N],idx,tot;\nstruct edge{\n    int v,next;\n}e[N];\nvoid add(int u,int v){\n    e[++idx].v=v;\n    e[idx].next=head[u];\n    head[u]=idx;\n}\nint k0[N][2],k1[N][2],vis[N];//k0[x][0]\u8868\u793a\u94a6\u5b9a fa[x] \u4e0d\u9009\uff0cdp[x][0] \u7684\u7cfb\u6570 \npii E[N];//\u975e\u6811\u8fb9\nvector<int> g[N];\nint get(int x){\n    if(x==ffa[x]) return x;\n    return ffa[x]=get(ffa[x]);\n}\nint fa[N][30],dep[N],dfn[N],cnt;\nvoid dfs(int x,int f){\n    fa[x][0]=f;\n    dfn[x]=++cnt;\n    dep[x]=dep[f]+1;\n    for(int i=1;i<=20;i++) fa[x][i]=fa[fa[x][i-1]][i-1];\n    for(auto y: g[x]){\n        if(y==f) continue;\n        dfs(y,x);\n        vis[x]+=vis[y];\n    }\n}\nint LCA(int x,int y){\n    if(dep[x]<dep[y]) swap(x,y);\n    for(int i=20;i>=0;i--) if(dep[fa[x][i]]>=dep[y]) x=fa[x][i];\n    if(x==y) return x;\n    for(int i=20;i>=0;i--) if(fa[x][i]!=fa[y][i]) x=fa[x][i],y=fa[y][i];\n    return fa[x][0];\n}\nint stk[N],top;\nbool cmp(int x,int y){\n    return dfn[x]<dfn[y];\n}\nvoid build(){\n    for(int i=1;i<=tot;i++) h[++k]=E[i].fi,h[++k]=E[i].se;\n    sort(h+1,h+k+1);\n    k=unique(h+1,h+k+1)-h-1;\n    sort(h+1,h+k+1,cmp);\n    stk[top=1]=1;\n    for(int i=1;i<=k;i++){\n        if(h[i]==1) continue;\n        int lca=LCA(stk[top],h[i]);\n        if(lca!=stk[top]){\n            while(dfn[lca]<dfn[stk[top-1]]){\n                add(stk[top-1],stk[top]);\n                top--;\n            }\n            if(dfn[lca]!=dfn[stk[top-1]]){\n                add(lca,stk[top]);\n                stk[top]=lca;\n            }\n            else add(lca,stk[top]),top--;\n        }\n        stk[++top]=h[i];\n    }\n    for(int i=1;i<top;i++) add(stk[i],stk[i+1]);\n}\nint dp[N][2]; \nint f1[N][2];\nvoid dp1(int x,int son){//\u8f85\u52a9\u8ba1\u7b97\u7cfb\u6570,\u4e5f\u5c31\u662f\u865a\u6811\u4e0a\u88ab\u7f29\u6389\u7684\u70b9\u5230\u5bf9\u5e94\u513f\u5b50\u90a3\u6761\u94fe\u4e4b\u5916\u7684\u7b54\u6848\n\tdp[x][0]=dp[x][1]=1;\n\tfor(auto y:g[x]){\n\t\tif(y==fa[x][0]||y==son) continue;//\u9664\u5f00\u90a3\u6761\u94fe\u4e0d\u80fd\u7b97 \n\t\tdp1(y,x);\n\t\tdp[x][0]=(dp[x][0]*(dp[y][0]+dp[y][1])%mod)%mod;\n    \tdp[x][1]=(dp[x][1]*dp[y][0])%mod;\n\t}\n} \nvoid calc(int x,int f){//\u73b0\u5728\u8ba1\u7b97 x-> f \u8fd9\u6761\u8fb9\u4e0a\u7684\u7cfb\u6570\n\t int p=x;k0[x][0]=k0[x][1]=k1[x][0]=1;//\u6700\u521d\u7684\u65f6\u5019\uff0c\u8fd9\u4e09\u9879\u7684\u7cfb\u6570\u90fd\u5e94\u8be5\u4e3a 1\n\t while(fa[p][0]!=f){//\u6ce8\u610f\u73b0\u5728\u5411\u4e0a\u722c\u5230\u7684\u70b9\u65f6 fa[p]\n\t \tdp1(fa[p][0],p);\n\t\tint t0=k0[x][0],t1=k0[x][1];\n\t\tk0[x][0]=(dp[fa[p][0]][0]*t0+dp[fa[p][0]][1]*k1[x][0])%mod;\n\t\tk0[x][1]=(dp[fa[p][0]][0]*t1+dp[fa[p][0]][1]*k1[x][1])%mod;\n\t\tk1[x][1]=dp[fa[p][0]][0]*t1%mod,k1[x][0]=dp[fa[p][0]][0]*t0%mod;\n\t\tp=fa[p][0];\n\t } \n}\nvoid dp2(int x,int f){//\u8981\u6c42\u8ba1\u7b97\u4ee5 x \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\uff0c\u9664\u53bb\u5305\u542b\u5173\u952e\u70b9\u7684\u5b50\u6811\u7684\u7b54\u6848 \uff0c\u4e5f\u5c31\u662f\u6bcf\u4e2a\u70b9\u7684DP\u7684\u521d\u503c \n    f1[x][0]=f1[x][1]=1;\n    for(auto y:g[x]){\n    \tif(y==f||vis[y]) continue;\n    \tdp2(y,x);\n    \tf1[x][0]=(f1[x][0]*(f1[y][0]+f1[y][1])%mod)%mod;\n    \tf1[x][1]=(f1[x][1]*f1[y][0])%mod;\n\t}\n}\nvoid predfs(int x,int f){//\u6ce8\u610f\u8fd9\u91cc\u5df2\u7ecf\u662f\u865a\u6811\u4e0a\u4e86 \n\tdp2(x,f),h[++k]=x ; \n\tif(x!=f) calc(x,f) ;\n\tfor(int i=head[x];i;i=e[i].next){\n\t\tint y=e[i].v;\n\t\tpredfs(y,x); \n\t}\n}\nvoid dp3(int x){\n\tfor(int i=head[x];i;i=e[i].next){\n\t\tint y=e[i].v;\n\t\tdp3(y);\n\t\tdp[x][0]*=(k0[y][0]*dp[y][0]%mod+k0[y][1]*dp[y][1]%mod),dp[x][0]%=mod;\n\t\tdp[x][1]*=(k1[y][0]*dp[y][0]%mod+k1[y][1]*dp[y][1]%mod),dp[x][1]%=mod;\n\t}\n}\nint ans;\nsigned main(){\n    scanf(\"%lld%lld\",&n,&m);\n    for(int i=1;i<=n;i++) ffa[i]=i;\n    for(int i=1;i<=m;i++){\n        int u,v;\n        scanf(\"%lld%lld\",&u,&v);\n        if(get(u)!=get(v)){\n            g[u].pb(v);\n            g[v].pb(u);\n\t\t\tffa[get(v)]=get(u);\n        }\n        else{\n            E[++tot]=mp(u,v);\n            vis[u]=vis[v]=1; \n        }\n    }   \n    dfs(1,0);\n    build();\n    int maxn=(1<<tot)-1;\n\tk=0; \n    predfs(1,1);\n    for(int i=0;i<=maxn;i++){\n\t\tfor(int i=1;i<=k;i++) dp[h[i]][0]=f1[h[i]][0],dp[h[i]][1]=f1[h[i]][1] ; \n\t\tfor(int j=1;j<=tot;j++){\n\t\t\tif((1<<(j-1))&i) dp[E[j].fi][0]=0, dp[E[j].se][1]=0; \n\t\t\telse dp[E[j].fi][1]=0; \n\t\t}\n\t\tdp3(1),ans=(ans+dp[1][0]+dp[1][1])%mod ;\n\t}\n\tprintf(\"%lld\\n\",ans%mod) ;\n    return 0;\n}\n```\n",
        "postTime": 1620308875,
        "uid": 128870,
        "name": "chen_qian",
        "ccfLevel": 7,
        "title": "P4426"
    },
    {
        "content": "\u4e00\u7bc7\u6bd2\u7624\u4e14\u4e0d\u5931\u7cbe\u81f4\n\n\u4ee3\u7801\u4e0d\u77ed\u4e5f\u4e0d\u957f\u7684\u9898\u89e3\n\n\u5982\u679c\u95ee\u9898\u8f6c\u5316\u4e3a\uff1a\u7ed9\u5b9a\u4e00\u68f5\u6811\u6bcf\u6b21\u8868\u793a\u67d0\u4e2a\u70b9\u53ea\u80fd\u9009\u5565\n\n\u90a3\u4e48\u8fd9\u4e0d\u8fc7\u662fDDP\u7684\u5957\u8def \u5728\u94fe\u5206\u6cbb\u4e0b\u628a\u77e9\u9635\u6539\u4e00\u4e0b\u5373\u53ef\n\n\u4f46\u662f\u5b9e\u9645\u4e0a\u5bf9\u4e8e\u672c\u9898\uff0c\u8fb9\u5f88\u5c11\uff0c\u90a3\u4e48\u4f55\u59a8\u4e0d\u9002\u7528\u66b4\u529b\u679a\u4e3e\u975e\u6811\u8fb9\u6765\u5efa\u53ef\u4e0d\u53ef\u884c\n\n\u90a3\u4e48\u8fd9\u548cDDP\u6ca1\u6709\u672c\u8d28\u533a\u522b\n\n\u4f46\u662f\u95ee\u9898\u662f2^2n\u53ea\u670985\u5206 \u6240\u4ee5\u8003\u8651\u4e00\u4e0b2^n\u679a\u4e3e\n\n\u7136\u540eDDP\u7684\u65f6\u5019\u7531\u4e8e\u662f\u8986\u76d6 \u6ce8\u610f\u8f6c\u6362\u4e00\u4e0b\u6807\u8bb0\n\n```\n#include<iostream>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<cstdio>\n#include<stack>\n#include<ctime>\n#include<vector>\ntypedef long long LL;\nusing namespace std;\nconst int N=2e5+100;\nconst int mod=998244353;\ninline void read(int &x){\n\tx=0;\n\tint f=1;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){\n\t\tif(ch=='-')f=-1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0'&&ch<='9'){\n\t\tx=x*10+ch-'0';\n\t\tch=getchar();\n\t}\n\tx*=f;\n}\nLL Quick_Pow(LL x,int k){\n\tLL ret=1;\n\twhile(k){\n\t\tif(k&1)ret=ret*x%mod;\n\t\tx=x*x%mod;\n\t\tk>>=1;\n\t}\n\treturn ret;\n}\nstruct DivZero{\n\tLL x,cnt;\n\tDivZero(const LL &_x=0,const LL &_cnt=0):x(_x),cnt(_cnt){}\n\tLL val(){return cnt?0:x;}\n\tfriend DivZero operator * (DivZero A,LL a){\n\t\tif(!a)A.cnt++;\n\t\telse A.x=A.x*a%mod;\n\t\treturn A;\n\t}\n\tfriend DivZero operator / (DivZero A,LL a){\n\t\tif(!a)A.cnt--;\n\t\telse A.x=A.x*Quick_Pow(a,mod-2)%mod;\n\t\treturn A;\n\t}\n\tvoid Clr(){\n\t\tcnt=x=0;\n\t}\n}F[N][2];\nint n,m;\nstruct Front_Star{\n\tint u,v,nxt;\n}e[N<<2];\nint cnt=1;\nint first[N];\nvoid add(int u,int v){\n\t++cnt;\n\te[cnt].u=u;\n\te[cnt].v=v;\n\te[cnt].nxt=first[u];\n\tfirst[u]=cnt;\n}\nint fa[N];\nint dep[N];\nint son[N];\nint siz[N];\nint top[N];\nint bot[N];\nint tree[N];\nint dfn_tot=0;\nvoid DFS1(int u,int fat,int depth){\n\tfa[u]=fat;\n\tdep[u]=depth;\n\tsiz[u]=1;\n\tfor(int i=first[u];i;i=e[i].nxt){\n\t\tint v=e[i].v;\n\t\tif(v==fat)continue;\n\t\tDFS1(v,u,depth+1);\n\t\tsiz[u]+=siz[v];\n\t\tif(!son[u]||siz[son[u]]<siz[v])son[u]=v;\n\t}\n}\nvoid DFS2(int u,int tp){\n\ttree[u]=++dfn_tot;\n\ttop[u]=tp;\n\tbot[tp]=u;\n\tif(son[u]){\n\t\tDFS2(son[u],tp);\n\t}\n\tfor(int i=first[u];i;i=e[i].nxt){\n\t\tint v=e[i].v;\n\t\tif(son[u]==v||fa[u]==v)continue;\n\t\tDFS2(v,v);\n\t}\n}\nstruct Matrix{\n\tLL a[2][2];\n\tMatrix(){memset(a,0,sizeof(a));}\n\tfriend Matrix operator * (const Matrix &A,const Matrix &B){\n\t\tMatrix ret;\n\t\tfor(int i=0;i<2;++i){\n\t\t\tfor(int j=0;j<2;++j){\n\t\t\t\tfor(int k=0;k<2;++k){\n\t\t\t\t\tret.a[i][j]=(ret.a[i][j]+A.a[i][k]*B.a[k][j])%mod;\t\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}\n\tvoid Print(){\n\t\tcout<<\"G: \\n\";\n\t\tfor(int i=0;i<2;++i){\n\t\t\tfor(int j=0;j<2;++j){\n\t\t\t\tcout<<a[i][j]<<\" \";\n\t\t\t}\n\t\t\tcout<<'\\n';\n\t\t}\n\t}\n};\nstruct Segment_Tree{\n\t#define lc (p<<1)\n\t#define rc (p<<1|1)\n\tstruct Segment_Node{\n\t\tint lson,rson;\n\t\tMatrix A;\n\t}T[N<<2];\n\tvoid PushUp(int p){\n\t\tT[p].A=T[rc].A*T[lc].A;\n\t}\n\tvoid Build(int p,int l,int r){\n\t\tT[p].lson=l;\n\t\tT[p].rson=r;\n\t\tif(l==r)return;\n\t\tint mid=(l+r)>>1;\n\t\tBuild(lc,l,mid);\n\t\tBuild(rc,mid+1,r);\n\t\tPushUp(p);\n\t}\n\tvoid Update(int p,int pos,Matrix A){\n\t\tif(T[p].lson==T[p].rson){\n\t\t\tT[p].A=A;\n\t\t\treturn;\n\t\t}\n\t\tint mid=(T[p].lson+T[p].rson)>>1;\n\t\tif(pos<=mid)Update(lc,pos,A);\n\t\telse Update(rc,pos,A);\n\t\tPushUp(p);\n\t}\n\tMatrix Query(int p,int l,int r){\n\t\tif(l<=T[p].lson&&T[p].rson<=r){\n\t\t\treturn T[p].A;\n\t\t}\n\t\tint mid=(T[p].lson+T[p].rson)>>1;\n\t\tif(l<=mid&&mid>=r)return Query(lc,l,r);\n\t\tif(mid< l&&mid< r)return Query(rc,l,r);\n\t\treturn Query(rc,l,r)*Query(lc,l,r);\n\t}\n\t#undef lc\n\t#undef rc \n}T;\nvoid Pre(int u){\n\tstack<int>S;\n\tint x=u;\n\tS.push(x);\n\tfor(;son[x];x=son[x])S.push(son[x]);\n\twhile(!S.empty()){\n\t\tint x=S.top();\n\t\tS.pop();\n\t\tF[x][0]=DivZero(1,0);\n\t\tF[x][1]=DivZero(1,0);\n\t\tfor(int i=first[x];i;i=e[i].nxt){\n\t\t\tint v=e[i].v;\n\t\t\tif(v==son[x]||v==fa[x])continue;\n\t\t\tPre(v);\n\t\t\tMatrix now=T.Query(1,tree[top[v]],tree[bot[top[v]]]);\n\t\t\tF[x][0]=F[x][0]*(now.a[0][0]+now.a[0][1]);\n\t\t\tF[x][1]=F[x][1]*now.a[0][0];\n\t\t}\n\t\tMatrix now;\n\t\tif(son[x]){\n\t\t\tnow.a[0][0]=F[x][0].val();\n\t\t\tnow.a[1][0]=F[x][0].val();\n\t\t\tnow.a[0][1]=F[x][1].val();\n\t\t}\n\t\telse{\n\t\t\tnow.a[0][0]=now.a[0][1]=1;\n\t\t}\n\t\tT.Update(1,tree[x],now);\n\t}\n}\nint USE[N];\nvoid Modify(int x,int opt){\n\tfor(int u=x;fa[top[u]];u=fa[top[u]]){\n\t\tMatrix now=T.Query(1,tree[top[u]],tree[bot[top[u]]]);\n\t\tint P=fa[top[u]];\n\t\tF[P][0]=F[P][0]/(now.a[0][0]+now.a[0][1]);\n\t\tF[P][1]=F[P][1]/now.a[0][0];\n\t\tnow=T.Query(1,tree[P],tree[P]);\n\t}\n\tif(son[x]){\n\t\tMatrix now=T.Query(1,tree[x],tree[x]);\n\t\tif(!opt){\n\t\t\tnow.a[0][1]=0;\n\t\t}\n\t\telse{\n\t\t\tnow.a[0][0]=now.a[1][0]=0;\n\t\t}\n\t\tT.Update(1,tree[x],now);\n\t}\n\telse{\n\t\tMatrix now=T.Query(1,tree[x],tree[x]);\n\t\tif(!opt){\n\t\t\tnow.a[0][1]=0;\n\t\t}\n\t\telse now.a[0][0]=0;\n\t\tT.Update(1,tree[x],now);\n\t}\n\tfor(int u=x;fa[top[u]];u=fa[top[u]]){\n\t\tMatrix now=T.Query(1,tree[top[u]],tree[bot[top[u]]]);\n\t\tint P=fa[top[u]];\n\t\tF[P][0]=F[P][0]*(now.a[0][0]+now.a[0][1]);\n\t\tF[P][1]=F[P][1]*now.a[0][0];\n\t\tnow.a[0][1]=F[P][1].val();\n\t\tnow.a[0][0]=now.a[1][0]=F[P][0].val();\t\n\t\tif(USE[P]==0){\n\t\t\tnow.a[0][1]=0;\n\t\t}\n\t\tif(USE[P]==1){\n\t\t\tnow.a[0][0]=0;\n\t\t\tnow.a[1][0]=0;\n\t\t}\n\t\tT.Update(1,tree[P],now);\n\t}\n}\nvoid ReBack(int x){\n\tUSE[x]=-1;\n\tfor(int u=x;fa[top[u]];u=fa[top[u]]){\n\t\tMatrix now=T.Query(1,tree[top[u]],tree[bot[top[u]]]);\n\t\tint P=fa[top[u]];\n\t\tF[P][0]=F[P][0]/(now.a[0][0]+now.a[0][1]);\n\t\tF[P][1]=F[P][1]/now.a[0][0];\n\t}\n\tif(son[x]){\n\t\tMatrix now;\n\t\tnow.a[0][0]=F[x][0].val();\n\t\tnow.a[1][0]=F[x][0].val();\n\t\tnow.a[0][1]=F[x][1].val();\n\t\tT.Update(1,tree[x],now);\n\t}\n\telse{\n\t\tMatrix now;\n\t\tnow.a[0][0]=now.a[0][1]=1;\n\t\tT.Update(1,tree[x],now);\n\t}\n\tfor(int u=x;fa[top[u]];u=fa[top[u]]){\n\t\tMatrix now=T.Query(1,tree[top[u]],tree[bot[top[u]]]);\n\t\tint P=fa[top[u]];\n\t\tF[P][0]=F[P][0]*(now.a[0][0]+now.a[0][1]);\n\t\tF[P][1]=F[P][1]*now.a[0][0];\n\t\tnow.a[0][1]=F[P][1].val();\n\t\tnow.a[0][0]=now.a[1][0]=F[P][0].val();\n\t\tif(USE[P]==0){\n\t\t\tnow.a[0][1]=0;\n\t\t}\n\t\tif(USE[P]==1){\n\t\t\tnow.a[0][0]=0;\n\t\t\tnow.a[1][0]=0;\n\t\t}\t\t\n\t\tT.Update(1,tree[P],now);\n\t}\t\n}\nint FA[N];\nint GetFa(int x){\n\tif(FA[x]==x)return x;\n\telse return FA[x]=GetFa(FA[x]);\n}\nvoid Merge(int x,int y){\n\tFA[GetFa(x)]=GetFa(y);\n}\nvector<pair<int,int> >Gra;\nLL ans=0;\nint tot=0;\nbool vis[21];\nint A[N];\nbool Judge(){\n\tbool GG=0;\n\tfor(int i=0;i<tot;++i){\n\t\tUSE[Gra[i].first]=USE[Gra[i].second]=-1;\n\t}\n\tfor(int i=0;i<tot;++i){\n\t\tif(vis[i+1]){\n\t\t\tif(USE[Gra[i].first]==0)GG=1;\n\t\t\tUSE[Gra[i].first]=1;\n\t\t\tif(USE[Gra[i].second]==1)GG=1;\n\t\t\tUSE[Gra[i].second]=0;\n\t\t}\n\t\telse{\n\t\t\tif(USE[Gra[i].first]==1)GG=1;\n\t\t\tUSE[Gra[i].first]=0;\n\t\t}\n\t}\n\treturn GG;\n}\nvoid Check(){\n\tif(Judge())return;\n\tfor(int i=1;i<=A[0];++i){\n\t\tif(USE[A[i]]==-1)continue;\n\t\tModify(A[i],USE[A[i]]);\n\t}\n\tMatrix now=T.Query(1,tree[1],tree[bot[1]]);\n\tans=(ans+now.a[0][0]+now.a[0][1])%mod;\n\tfor(int i=1;i<=A[0];++i){\n\t\tif(USE[A[i]]==-1)continue;\n\t\tReBack(A[i]);\n\t}\n}\nvoid DFS(int Id){\n\tif(Id==tot+1){\n\t\tCheck();\n\t\treturn;\n\t}\n\tvis[Id]=1;\n\tDFS(Id+1);\n\tvis[Id]=0;\n\tDFS(Id+1);\n}\nint main(){\n//\tfreopen(\"P4426.in\",\"r\",stdin);\n//\tfreopen(\"P4426.out\",\"w\",stdout);\n\tread(n);read(m); \n\tfor(int i=1;i<=n;++i)FA[i]=i;\n\t\n\tmemset(USE,-1,sizeof(USE));\n\t\n\tfor(int i=1;i<=m;++i){\n\t\tint u,v;\n\t\tread(u);read(v);\n\t\tif(GetFa(u)==GetFa(v)){\n\t\t\tGra.push_back(make_pair(u,v));\n\t\t\tA[++A[0]]=u;\n\t\t\tA[++A[0]]=v;\n\t\t}\n\t\telse{\n\t\t\tMerge(u,v);\n\t\t\tadd(u,v);add(v,u);\t\n\t\t}\t\n\t}\n\tsort(A+1,A+1+A[0]);\n\tA[0]=unique(A+1,A+1+A[0])-A-1;\n\tDFS1(1,0,1);\n\tDFS2(1,1);\n\tT.Build(1,1,n);\n\tPre(1);\n//\texit(0); \n\tif(m==n-1){\n\t\tMatrix now=T.Query(1,tree[1],tree[bot[1]]);\n\t\tans=(now.a[0][0]+now.a[0][1])%mod;\t\n\t}\n\telse{\n\t\ttot=m-(n-1);\n\t\tDFS(1);\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```\n",
        "postTime": 1552651738,
        "uid": 28147,
        "name": "\u5289\u5b50\u98ba",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4426 \u3010[HNOI/AHOI2018]\u6bd2\u7624\u3011"
    },
    {
        "content": "### [[HNOI/AHOI2018]\u6bd2\u7624](https://www.luogu.com.cn/problem/P4426)\n\n\u8003\u8651\u666e\u901a\u7684\u6811\u4e0a\u72ec\u7acb\u96c6 dp\u3002\n\n$f_{i,0/1}$ \u8868\u793a\u8003\u8651 $i$ \u7684\u5b50\u6811\u4e2d\uff0c\u9009/\u4e0d\u9009 $i$ \u5f62\u6210\u7684\u72ec\u7acb\u96c6\u7684\u65b9\u6848\u6570\u3002\n\n$f_{i,0}=\\prod\\limits_{u\\in son_i} f_{u,0}+f_{u,1}$\n\n$f_{i,1}=\\prod\\limits_{u\\in son_i}f_{u,0}$\n\n\u73b0\u5728\u8003\u8651\u6bcf\u4e00\u6761\u975e\u6811\u8fb9\u7684\u9650\u5236\uff0c\u5047\u5982\u662f $u\\to v$ \u90a3\u4e48\u4e24\u6b21\u8003\u8651\uff0c$u$ \u9009\uff0c\u90a3\u4e48 $f_{v,1}$ \u6e05\u96f6\uff0c\u91cd\u65b0\u505a\u4e00\u904d\u3002\u5426\u5219 $u$ \u4e0d\u9009\uff0c$v$ \u968f\u610f\uff0c$f_{u,1}$ \u6e05\u96f6\u91cd\u65b0\u505a\u4e00\u904d\uff0c\u90a3\u4e48\u53c8\u56e0\u4e3a\u6709 $11$ \u4e2a\u9650\u5236\uff0c\u6240\u4ee5\u662f $2^{11}\\times n$ \u7684\u590d\u6742\u5ea6\u3002\n\n\u4f46\u662f\u5bb9\u6613\u53d1\u73b0\uff0c\u66f4\u6539\u540e\u53ea\u6709\u975e\u6811\u8fb9\u7684\u8def\u5f84\u4e0a\u7684\u70b9\u7684 $f$ \u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u4f46\u8fd9\u8fd8\u4e0d\u591f\uff0c\u56e0\u4e3a\u6570\u91cf\u7ea7\u522b\u8fd8\u662f $O(n)$ \u7684\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5bf9\u8fd9 $22$ \u4e2a\u7279\u6b8a\u70b9\u5efa\u51fa\u865a\u6811\uff0c\u90a3\u4e48\u8003\u8651\u865a\u6811\u4e0a\u7684\u4e00\u6761\u8fb9\u7684\u5b9e\u9645\u4e0a\u53ef\u4ee5\u600e\u4e48\u8f6c\u79fb\uff0c\u7ed3\u8bba\u5c31\u662f\u4e00\u6761\u8fb9\uff08\u8fde\u63a5 $u,v$ \u4e14 $dep_u<dep_v$\uff09\u53ef\u4ee5\u5199\u6210 $f_{u,0/1}=a\\times f_{v,0}+b\\times f_{v,1}$ \u4e5f\u5c31\u662f\u4e00\u4e2a\u5e38\u6570\u500d\u3002\n\n\u4e00\u4e9b\u5c0f\u7ec6\u8282\uff1a\u5bf9\u4e8e\u865a\u6811\u4e0a\u7684\u4e00\u6761\u8fb9\uff0c\u66b4\u529b\u8df3\u5230\u8fb9\u9876\u7684\u65f6\u5019\u6ce8\u610f\u4e0d\u80fd\u76f4\u63a5\u4e58\u4e0a\u6743\u503c\u3002\n\n\u5728\u865a\u6811\u4e0a\u7684\u70b9\u7684\u4e0d\u5728\u865a\u6811\u4e0a\u7684\u513f\u5b50\u8981\u7279\u6b8a\u7edf\u8ba1\u3002\n\n\n### $\\text{CODE}$\n\n```cpp\n#include<bits/stdc++.h>\n#define N 200005\n#define mod 998244353\nusing namespace std;\nint read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\treturn x*f;\n}\nint n,m,s[N][2][2],u[N],v[N],g[N],tot,p[N][2],q[N],cnt,ans,e[N][2];\nint find(int x)\n{\n\tif(g[x]==x)return x;\n\treturn g[x]=find(g[x]);\n}\nbool vis[N][2],kl[N],awa[N];\nint mul(int a,int b){return (1ll*a*b)%mod;}\nint adt(int a,int b){return (1ll*a+b)%mod;}\nstruct fig\n{\n\tstruct node\n\t{\n\t\tint to,next,from;\n\t}k[N*2];\n\tint head[N],tot,dfn[N],cnt,dp[N][2],dep[N],f[N][21];\n\tvoid add(int from,int to)\n\t{\n\t\tk[++tot].to=to;\n\t\tk[tot].from=from;\n\t\tk[tot].next=head[from];\n\t\thead[from]=tot;\n\t}\n\tvoid dfs(int now,int fa)\n\t{\n\t\tdfn[now]=++cnt;\n\t\tf[now][0]=fa;dep[now]=dep[fa]+1;\n\t\tfor(int i=1;i<=20;i++)f[now][i]=f[f[now][i-1]][i-1];\n\t\tfor(int i=head[now];i;i=k[i].next)\n\t\t{\n\t\t\tif(k[i].to==fa)continue;\n\t\t\tdfs(k[i].to,now);\n\t\t}\n\t}\n\tvoid dne(int now)\n\t{\n\t\tdp[now][0]=dp[now][1]=1;\n\t\te[now][0]=e[now][1]=1;\n\t\tfor(int i=head[now];i;i=k[i].next)\n\t\t{\n\t\t\tif(k[i].to==f[now][0])continue;\n\t\t\tdne(k[i].to);\n\t\t\tdp[now][0]=mul(dp[now][0],adt(dp[k[i].to][0],dp[k[i].to][1]));\n\t\t\tdp[now][1]=mul(dp[now][1],dp[k[i].to][0]);\n\t\t\tif(!awa[k[i].to])\n\t\t\t{\n\t\t\t\te[now][0]=mul(e[now][0],adt(dp[k[i].to][0],dp[k[i].to][1]));\n\t\t\t\te[now][1]=mul(e[now][1],dp[k[i].to][0]);\n\t\t\t}\n\t\t}\n\t}\n\tvoid get(int u,int v)\n\t{\n\t\tint last=v,g=v;\n\t\ts[v][0][0]=1;s[v][1][1]=1;\n\t\ts[v][0][1]=s[v][1][0]=0;\n\t\tv=f[v][0];\n\t\twhile(v!=f[u][0])\n\t\t{\n\t\t\ts[v][0][0]=adt(s[last][0][0],s[last][1][0]);\n\t\t\ts[v][0][1]=adt(s[last][0][1],s[last][1][1]);\n\t\t\ts[v][1][0]=s[last][0][0];\n\t\t\ts[v][1][1]=s[last][0][1];\n\t\t\tfor(int i=head[v];i;i=k[i].next)\n\t\t\t{\n\t\t\t\tif(v==u)break;\n\t\t\t\tif(k[i].to==last||k[i].to==f[v][0]||awa[k[i].to])continue;\n\t\t\t\ts[v][1][0]=mul(s[v][1][0],dp[k[i].to][0]);\n\t\t\t\ts[v][1][1]=mul(s[v][1][1],dp[k[i].to][0]);\n\t\t\t\ts[v][0][0]=mul(s[v][0][0],adt(dp[k[i].to][0],dp[k[i].to][1]));\n\t\t\t\ts[v][0][1]=mul(s[v][0][1],adt(dp[k[i].to][0],dp[k[i].to][1]));\n\t\t\t}\n\t\t\tlast=v;v=f[v][0];\n\t\t}\n\t\ts[g][0][0]=s[last][0][0];\n\t\ts[g][1][0]=s[last][1][0];\n\t\ts[g][0][1]=s[last][0][1];\n\t\ts[g][1][1]=s[last][1][1];\n\t}\n\tvoid solve(int now)\n\t{\n\t\tdp[now][0]=dp[now][1]=1;\n\t\tif(vis[now][0])dp[now][0]=0;\n\t\tif(vis[now][1])dp[now][1]=0;\n\t\tfor(int i=head[now];i;i=k[i].next)\n\t\t{\n\t\t\tif(k[i].to==f[now][0])continue;\n\t\t\tsolve(k[i].to);\n\t\t\tdp[now][0]=mul(dp[now][0],adt(mul(s[k[i].to][0][0],dp[k[i].to][0]),mul(s[k[i].to][0][1],dp[k[i].to][1])));\n\t\t\tdp[now][1]=mul(dp[now][1],adt(mul(s[k[i].to][1][0],dp[k[i].to][0]),mul(s[k[i].to][1][1],dp[k[i].to][1])));\n\t\t}\n\t\tdp[now][0]=mul(dp[now][0],e[now][0]);\n\t\tdp[now][1]=mul(dp[now][1],e[now][1]);\n\t}\n\tint kth(int a,int b)\n\t{\n\t\tfor(int i=19;i>=0;i--)\n\t\t{\n\t\t\tif((b>>i)&1)\n\t\t\ta=f[a][i];\n\t\t}\n\t\treturn a;\n\t}\n\tint lca(int a,int b)\n\t{\n\t\tif(dep[a]<dep[b])swap(a,b);\n\t\tfor(int i=19;i>=0;i--)if(dep[f[a][i]]>=dep[b])a=f[a][i];\n\t\tif(a==b)return a;\n\t\tfor(int i=19;i>=0;i--)if(f[a][i]!=f[b][i])a=f[a][i],b=f[b][i];\n\t\treturn f[a][0];\n\t}\n}T1,T2;\nbool cmp(int a,int b)\n{\n\treturn T1.dfn[a]<T1.dfn[b];\n}\nsigned main()\n{\n\tn=read();m=read();\n\tfor(int i=1;i<=n;i++)g[i]=i;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tu[i]=read();v[i]=read();\n\t\tif(find(u[i])==find(v[i]))\n\t\t{\n\t\t\tkl[i]=1;\n\t\t\tp[++tot][0]=u[i];\n\t\t\tp[tot][1]=v[i];\n\t\t\tq[++cnt]=u[i];\n\t\t\tq[++cnt]=v[i];\n\t\t}\n\t\telse g[g[u[i]]]=g[v[i]];\n\t}\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tif(kl[i])continue;\n\t\tT1.add(u[i],v[i]);\n\t\tT1.add(v[i],u[i]);\n\t}\n\tT1.dfs(1,0);\n\tstack<int> t;t.push(1);\n\tsort(q+1,q+1+cnt,cmp);\n\tcnt=unique(q+1,q+1+cnt)-q-1;\n\tfor(int i=1;i<=cnt;i++)\n\t{\n\t\tif(q[i]==1)continue;\n\t\tint last=0,x=q[i];\n\t\twhile(T1.lca(t.top(),x)!=t.top())\n\t\t{\n\t\t\tif(last)\n\t\t\t{\n\t\t\t\tT2.add(t.top(),last);\n\t\t\t\tawa[T1.kth(last,T1.dep[last]-T1.dep[t.top()]-1)]=1;\n\t\t\t}\n\t\t\tlast=t.top();\n\t\t\tt.pop();\n\t\t}\n\t\tif(last)\n\t\t{\n\t\t\tint y=T1.lca(last,x);\n\t\t\tif(y!=t.top())t.push(y);\n\t\t\tT2.add(t.top(),last);\n\t\t\tawa[T1.kth(last,T1.dep[last]-T1.dep[t.top()]-1)]=1;\n\t\t}\n\t\tt.push(x);\n\t}\n\twhile(t.size()>1)\n\t{\n\t\tint x=t.top();t.pop();\n\t\tT2.add(t.top(),x);\n\t\tawa[T1.kth(x,T1.dep[x]-T1.dep[t.top()]-1)]=1;\n\t}\n\tT1.dne(1);\n\tfor(int i=1;i<=T2.tot;i++)T1.get(T2.k[i].from,T2.k[i].to);\n\tint lim=(1<<tot)-1;\n\tfor(int i=0;i<=lim;i++)\n\t{\n\t\tfor(int j=1;j<=tot;j++)\n\t\t{\n\t\t\tif((i>>(j-1))&1)vis[p[j][0]][0]=1,vis[p[j][1]][1]=1;\n\t\t\telse vis[p[j][0]][1]=1;\n\t\t}\n\t\tT2.solve(1);\n\t\tans=adt(ans,adt(T2.dp[1][0],T2.dp[1][1]));\n\t\tfor(int j=1;j<=tot;j++)\n\t\t{\n\t\t\tif((i>>(j-1))&1)vis[p[j][0]][0]=0,vis[p[j][1]][1]=0;\n\t\t\telse vis[p[j][0]][1]=0;\n\t\t}\n\t}\n\tcout<<ans<<\"\\n\";\n\treturn 0;\n}\n\n```",
        "postTime": 1683715792,
        "uid": 331947,
        "name": "hegm",
        "ccfLevel": 0,
        "title": "P4426 [HNOI/AHOI2018]\u6bd2\u7624 \u9898\u89e3"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u79cd\u4e0d\u4e00\u6837\u7684\u505a\u6cd5\u3002\n\n\u53d1\u73b0 $m-n$ \u5f88\u5c0f\uff0c\u4fbf\u53ef\u4ee5\u8054\u60f3\u5230**\u5e7f\u4e49\u4e32\u5e76\u8054\u56fe\u65b9\u6cd5**\uff1a\u901a\u8fc7\u5220\u4e00\u5ea6\u70b9\uff0c\u7f29\u4e8c\u5ea6\u70b9\uff0c\u53e0\u5408\u91cd\u8fb9\u7684\u529e\u6cd5\uff0c\u4f7f\u6574\u5f20\u56fe\u7684\u70b9\u5ea6\u6570\u81f3\u5c11\u4e3a $3$\u3002\n\n\u90a3\u4e48\u8fd9\u5f20\u56fe\u6709\u4ec0\u4e48\u6027\u8d28\uff1f\u9996\u5148\u5220\u4e00\u5ea6\u70b9\u548c\u7f29\u4e8c\u5ea6\u70b9\u64cd\u4f5c\u90fd\u4f1a\u4f7f\u6574\u5f20\u56fe\u51cf\u5c11\u4e00\u4e2a\u70b9\u548c\u4e00\u6761\u8fb9\uff0c\u53e0\u5408\u91cd\u8fb9\u53ea\u4f1a\u51cf\u5c11\u4e00\u6761\u8fb9\u3002\u6240\u4ee5\u4e0d\u7ba1\u8fdb\u884c\u4ec0\u4e48\u64cd\u4f5c\uff0c$m-n$ \u53ea\u51cf\u4e0d\u589e\uff0c\u540c\u65f6\u64cd\u4f5c\u540e\u7684\u70b9\u5ea6\u6570\u81f3\u5c11\u4e3a $3$\uff0c\u53ef\u5f97 $3n\\le 2m$\uff0c\u5373 $n\\le 2(m-n)$\uff0c\u8fd9\u6837 $n,m$ \u5747\u7f29\u5c0f\u5230\u4e0e $m-n$ \u540c\u9636\uff0c\u4e14 $n\\le 2(m-n),m\\le 3(m-n)$\uff0c\u53ef\u4ee5\u62ff\u8fd9\u5f20\u56fe\u505a\u4e00\u4e9b\u539f\u56fe\u4e0a\u65e0\u6cd5\u5728\u9650\u5b9a\u65f6\u95f4\u5185\u5b8c\u6210\u7684\u9ad8\u590d\u6742\u5ea6\u66b4\u529b\u3002\n\n\u56de\u5230\u8fd9\u9053\u9898\uff0c\u8bbe $f_{u,0/1}$ \u4ee3\u8868\u70b9 $u$ \u9009\u6216\u4e0d\u9009\u7684\u65b9\u6848\u6570\uff0c\u521d\u59cb\u65f6 $f_{u,0/1}=1$\u3002\n\n\u518d\u8bbe $g_{e,0/1,0/1}$ \u4ee3\u8868\u8fb9 $e$ \u5de6\u7aef\u70b9\u9009/\u4e0d\u9009\u4e14\u53f3\u7aef\u70b9\u9009/\u4e0d\u9009\u7684\u65b9\u6848\u6570\uff0c\u521d\u59cb\u65f6 $g_{e,0,0}=g_{e,0,1}=g_{e,1,0}=1,g_{e,1,1}=0$\u3002\n\n\u5220\u4e00\u5ea6\u70b9\u65f6\uff0c\u5047\u8bbe\u5220\u6389\u8fb9 $(u,v)$ \u548c\u70b9 $u$\uff08\u8fd9\u91cc\u94a6\u5b9a\u4e8c\u5143\u7ec4\u5de6\u8fb9\u7684\u5143\u7d20\u662f\u8fb9\u7684\u5de6\u7aef\u70b9\uff0c\u53f3\u8fb9\u7684\u662f\u53f3\u7aef\u70b9\uff09\uff0c\u90a3\u4e48\u5c31\u5c06 $f_{v,0}\\leftarrow f_{v,0}(f_{u,0}\\times g_{(u,v),0,0}+f_{u,1}\\times g_{(u,v),1,0}),f_{v,1}\\leftarrow f_{v,1}(f_{u,0}\\times g_{(u,v),0,1}+f_{u,1}\\times g_{(u,v),1,1})$\n\n\u7f29\u4e8c\u5ea6\u70b9\u65f6\uff0c\u5047\u8bbe\u5220\u6389\u8fb9 $(u,t),(t,v)$ \u548c\u70b9 $t$\uff0c\u5e76\u65b0\u589e $(u,v)$\uff0c\u90a3\u4e48\u65b0\u589e\u7684\u8fb9 $(u,v)$ \u4ee3\u8868\u7684 $g$ \u5c31\u662f\uff1a\n$$\ng_{(u,v),0,0}=g_{(u,t),0,0}\\times f_{t,0}\\times g_{(t,v),0,0}+g_{(u,t),0,1}\\times f_{t,1}\\times g_{(t,v),1,0}\n$$\n\n$$\ng_{(u,v),0,1}=g_{(u,t),0,0}\\times f_{t,0}\\times g_{(t,v),0,1}+g_{(u,t),0,1}\\times f_{t,1}\\times g_{(t,v),1,1}\n$$\n\n$$\ng_{(u,v),1,0}=g_{(u,t),1,0}\\times f_{t,0}\\times g_{(t,v),0,0}+g_{(u,t),1,1}\\times f_{t,1}\\times g_{(t,v),1,0}\n$$\n\n$$\ng_{(u,v),1,1}=g_{(u,t),1,0}\\times f_{t,0}\\times g_{(t,v),0,1}+g_{(u,t),1,1}\\times f_{t,1}\\times g_{(t,v),1,1}\n$$\n\n\u53e0\u5408\u91cd\u8fb9\u5c31\u628a\u4e24\u6761\u8fb9\u7684 $g$ \u5bf9\u5e94\u7684\u503c\u4e58\u8d77\u6765\u5373\u53ef\u3002\n\n\u7528\u62d3\u6251\u6392\u5e8f\u6765\u6a21\u62df\u6574\u4e2a\u8fc7\u7a0b\uff0c\u52a0\u8fb9\uff0c\u5220\u8fb9\uff0c\u67e5\u627e\u8fb9\u90fd\u53ef\u4ee5\u7528\u54c8\u5e0c\u8868\u7ef4\u62a4\uff0c\u4f46\u662f\u7528 vector \u904d\u5386\u8fb9\u7684\u65f6\u5019\u4e0d\u9700\u8981\u5220\u6389\u54c8\u5e0c\u8868\u6ca1\u6709\u7684\u8fb9\uff0c\u56e0\u4e3a\u6700\u591a\u52a0 $m+n$ \u6761\u8fb9\uff0c\u5e76\u4e14\u6bcf\u4e2a\u70b9\u53ea\u4f1a\u88ab\u8bbf\u95ee\u4e00\u6b21\u3002\n\n\u4f7f\u7528\u5e7f\u4e49\u4e32\u5e76\u8054\u56fe\u65b9\u6cd5\u540e\u6211\u4eec\u5c31\u76f4\u63a5\u679a\u4e3e\u6bcf\u4e2a\u70b9\u9009/\u4e0d\u9009\uff0c\u5c31\u53ef\u4ee5\u5728 $O(n+m+4^{m-n}(m-n))$ \u5185\u6c42\u51fa\u7b54\u6848\uff0c\u5f53\u7136\u53ef\u4ee5\u518d\u5957\u7528 $75$ \u5206\u505a\u6cd5\u505a\u5230 $O(n+m+2^{m-n}(m-n))$\uff0c\u8fd9\u6837\u5c31\u548c\u865a\u6811\u505a\u6cd5\u4e00\u4e2a\u590d\u6742\u5ea6\u4e86\u3002\n\n\u8fd9\u4e2a\u505a\u6cd5\u7684\u597d\u5904\u662f\u6bd4\u8f83\u5957\u8def\uff0c\u7801\u91cf\u867d\u7136\u6709\u70b9\u5927\u4f46\u5199\u8d77\u6765\u65b9\u4fbf\u8bb8\u591a\uff0c\u57fa\u672c\u5c31\u662f\u4e09\u4e2a\u5f0f\u5b50\u590d\u5236\u4e2a\u51e0\u904d\uff0c\u518d\u5199\u4e2a\u54c8\u5e0c\u8868\u3001\u62d3\u6251\u6392\u5e8f\u548c\u66b4\u529b\u5c31\u5b8c\u4e8b\u4e86\uff0c\u800c\u4e14\u8fd9\u4e09\u4e2a\u5f0f\u5b50\u4e5f\u5f88\u663e\u7136\u3002\n\n# AC Code\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nusing ll=long long;\nusing uint=unsigned int;\nusing ull=unsigned long long;\n#define endl '\\n'\n#define lb lower_bound\n#define ub upper_bound\n#define ne nth_element\n#define eb emplace_back\n#define ump unordered_map\n#define pq priority_queue\n#define clz __builtin_clz\n#define ctz __builtin_ctz\n#define sz(x) (int)x.size()\n#define np next_permutation\n#define clzl __builtin_clzll\n#define ctzl __builtin_ctzll\n#define ppc __builtin_popcount\n#define all(x) x.begin(),x.end()\n#define ppcl __builtin_popcountll\n#define fpi(x) freopen(x,\"r\",stdin)\n#define fpo(x) freopen(x,\"w\",stdout)\n#define uid uniform_int_distribution\n#define me(x,y) memset(x,y,sizeof(x))\n#define dbg(x) cerr<<\"In Line \"<<__LINE__<<' '<<#x<<\" = \"<<(x)<<'\\n'\n#define base 194833\n#define mod 998244353\n#define inf 0x3f3f3f3f\nstruct hgsh{\n\tll num;int nxt,f0,f1,f2,f3;\n}e[200005];\nint head[base],tot,n,deg[100005],val[100005][2];\nbool yes[100005];\nvector<int> edge[100005];\nstruct line{\n\tint to,f[4];\n};\nvector<line> G[100005];\ninline void add(int u,int v,int f0,int f1,int f2,int f3){\n\tif(u>v) swap(f1,f2),swap(u,v);\n\tll x=(ll)u*n+v;int p=x%base;\n\tfor(int i=head[p];i;i=e[i].nxt) if(e[i].num==x){\n\t\te[i].f0=(ll)e[i].f0*f0%mod;\n\t\te[i].f1=(ll)e[i].f1*f1%mod;\n\t\te[i].f2=(ll)e[i].f2*f2%mod;\n\t\te[i].f3=(ll)e[i].f3*f3%mod;\n\t\treturn ;\n\t}\n\tedge[u].eb(v),edge[v].eb(u);\n\tdeg[u]++,deg[v]++;\n\te[++tot]={x,head[p],f0,f1,f2,f3},head[p]=tot;\n}\ninline vector<int> find(int u,int v){\n\tbool flag=0;\n\tif(u>v) flag=1,swap(u,v);\n\tll x=(ll)u*n+v;\n\tfor(int i=head[x%base];i;i=e[i].nxt) if(e[i].num==x){\n\t\tif(flag) return vector<int>{e[i].f0,e[i].f2,e[i].f1,e[i].f3};\n\t\treturn vector<int>{e[i].f0,e[i].f1,e[i].f2,e[i].f3};\n\t}\n\treturn vector<int>{-1,-1,-1,-1};\n}\ninline void del(int u,int v){\n\tdeg[u]--,deg[v]--;\n\tif(u>v) swap(u,v);\n\tll x=(ll)u*n+v,lst=0;\n\tint p=x%base;\n\tfor(int i=head[p];i;i=e[i].nxt){\n\t\tif(e[i].num==x){\n\t\t\tif(lst) e[lst].nxt=e[i].nxt;else head[p]=e[i].nxt;\n\t\t\treturn ;\n\t\t}\n\t\tlst=i;\n\t}\n}\ninline int rmod(int x){\n\treturn x-mod+(x-mod>>31&mod);\n}\nint s[25],cnt;\nbool isdel[100005];\nint main(){\n//\tfpi(\".out\");\n//\tfpo(\".out\");\n\t#ifndef CCPSDCGK\n\tios::sync_with_stdio(0),cin.tie(0);\n\t#endif\n\tint m;cin>>n>>m;\n\tfor(int i=1;i<=n;i++) val[i][0]=val[i][1]=1;\n\twhile(m--){\n\t\tint u,v;cin>>u>>v;\n\t\tadd(u,v,1,1,1,0);\n\t}\n\tqueue<int> q;\n\tfor(int i=1;i<=n;i++) if(deg[i]<3) q.emplace(i);\n\twhile(!q.empty()){\n\t\tint f=q.front();q.pop();\n\t\tif(!deg[f]) continue;\n\t\tisdel[f]=1;\n\t\tif(deg[f]==1){\n\t\t\tfor(int v:edge[f]){\n\t\t\t\tauto ret=find(f,v);\n\t\t\t\tif(~ret[0]){\n\t\t\t\t\tval[v][0]=(ll)val[v][0]*(((ll)val[f][0]*ret[0]+(ll)val[f][1]*ret[2])%mod)%mod;\n\t\t\t\t\tval[v][1]=(ll)val[v][1]*(((ll)val[f][0]*ret[1]+(ll)val[f][1]*ret[3])%mod)%mod;\n\t\t\t\t\tdel(f,v);\n\t\t\t\t\tif(deg[v]&&deg[v]<3) q.emplace(v);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tint u1=0,u2=0;\n\t\t\tvector<int> ret1,ret2;\n\t\t\tfor(int v:edge[f]){\n\t\t\t\tauto ret=find(f,v);\n\t\t\t\tif(~ret[0]){\n\t\t\t\t\tif(u1) u2=v,ret2=ret;else u1=v,swap(ret[1],ret[2]),ret1=ret;\n\t\t\t\t\tdel(f,v);\n\t\t\t\t}\n\t\t\t}\n\t\t\tadd(u1,u2,\n\t\t\t((ll)ret1[1]*ret2[2]%mod*val[f][1]+(ll)ret1[0]*ret2[0]%mod*val[f][0])%mod,\n\t\t\t((ll)ret1[1]*ret2[3]%mod*val[f][1]+(ll)ret1[0]*ret2[1]%mod*val[f][0])%mod,\n\t\t\t((ll)ret1[3]*ret2[2]%mod*val[f][1]+(ll)ret1[2]*ret2[0]%mod*val[f][0])%mod,\n\t\t\t((ll)ret1[3]*ret2[3]%mod*val[f][1]+(ll)ret1[2]*ret2[1]%mod*val[f][0])%mod);\n\t\t\tif(deg[u1]&&deg[u1]<3) q.emplace(u1);\n\t\t\tif(deg[u2]&&deg[u2]<3) q.emplace(u2);\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++) if(!isdel[i]) s[cnt++]=i;\n\tfor(int i=0;i<base;i++) for(int j=head[i];j;j=e[j].nxt){\n\t\tint v=(e[j].num-1)%n+1,u=(e[j].num-v)/n;\n\t\tG[u].eb(line{v,{e[j].f0,e[j].f1,e[j].f2,e[j].f3}});\n\t}\n\tint ans=0;\n\tfor(int i=0;i<1<<cnt;i++){\n\t\tfor(int j=0;j<cnt;j++) if(i>>j&1) yes[s[j]]=1;\n\t\tint mul=1;\n\t\tfor(int j=0;j<cnt;j++){\n\t\t\tmul=(ll)mul*val[s[j]][i>>j&1]%mod;\n\t\t\tfor(auto k:G[s[j]]) mul=(ll)mul*k.f[(i>>j&1)*2|yes[k.to]]%mod;\n\t\t}\n\t\tans=rmod(ans+mul);\n\t\tfor(int j=0;j<cnt;j++) yes[s[j]]=0;\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```",
        "postTime": 1675505343,
        "uid": 80614,
        "name": "ZCPB",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4426"
    },
    {
        "content": "\u524d\u7f6e\u829d\u58eb\uff1a[\u52a8\u6001 dp](https://oi-wiki.org/dp/dynamic/)\u3001[\u6808](https://oi-wiki.org/ds/stack/)\n\n\u4e0d\u96be\u60f3\u5230\u672c\u9898\u53ef\u4ee5\u62bd\u8c61\u4e3a\uff1a\u7ed9\u5b9a\u4e00\u5f20 $n$ \u4e2a\u70b9\u3001$m$ \u6761\u8fb9\u7684\u65e0\u5411\u56fe\uff0c\u6c42\u5176**\u53ef\u7a7a**\u72ec\u7acb\u96c6\u7684\u6570\u91cf $\\bmod 998244353$\u3002\n\n\u72ec\u7acb\u96c6\u95ee\u9898\u662f\u4e00\u4e2a NP \u95ee\u9898\u3002\u4f46\u7531\u4e8e $0 \\leq m - n + 1 \\leq 11$\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u6c42\u51fa\u5b83\u7684\u4e00\u68f5\u751f\u6210\u6811\uff0c\u5e76\u679a\u4e3e\u975e\u6811\u8fb9\u7684\u4e24\u4e2a\u7aef\u70b9\u662f\u5426\u88ab\u9009\u4e2d\u3002\u8003\u8651\u94a6\u5b9a\u5176\u4e2d\u4e00\u4e2a\u7aef\u70b9\u4e0d\u88ab\u9009\u4e2d\uff0c\u53e6\u4e00\u4e2a\u7aef\u70b9\u4efb\u610f\u548c\u5176\u4e2d\u4e00\u4e2a\u7aef\u70b9\u88ab\u9009\u4e2d\u548c\u53e6\u4e00\u4e2a\u7aef\u70b9\u4e0d\u88ab\u9009\u4e2d\u7684\u60c5\u51b5\uff0c\u5219\u679a\u4e3e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(2^{m - n + 1})$\u3002\n\n\u73b0\u5728\u5148\u8003\u8651 $m = n - 1$\uff08\u5373\u539f\u56fe\u4e3a\u4e00\u68f5\u6811\u7684\u60c5\u51b5\uff09\uff0c\u663e\u7136\u53ef\u4ee5 dp\u3002\u8bbe $dp_{u, 0 / 1}$ \u8868\u793a $u$ \u4e0d\u88ab / \u88ab\u9009\u4e2d\u65f6 $u$ \u5b50\u6811\u5185\u7684\u65b9\u6848\u6570\u3002\n\n\u8f6c\u79fb\uff1a$dp_{u, 0} = \\displaystyle\\prod_{v \\in son_u} (dp_{v, 0} + dp_{v, 1})$\uff0c$dp_{u, 1} = \\displaystyle\\prod_{v \\in son_u} dp_{v, 0}$\u3002\n\n\u7b54\u6848\uff1a$dp_{1, 0} + dp_{1, 1}$\u3002\n\n\u8003\u8651\u94a6\u5b9a $u$ \u4e0d\u88ab / \u88ab\u9009\u4e2d\u7684\u60c5\u51b5\uff0c\u53d1\u73b0\u6b64\u65f6\u6211\u4eec\u76f8\u5f53\u4e8e\u94a6\u5b9a $dp_{u, 1 / 0} = 0$\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u52a8\u6001 dp\u3002\u5957\u8def\u5730\uff0c\u8bbe $dp'_{u, 0 / 1}$ \u8868\u793a $u$ \u4e0d\u88ab / \u88ab\u9009\u4e2d\u65f6 $u$ \u5b50\u6811\u5185\uff08\u4e0d\u5305\u62ec $u$ \u7684\u91cd\u513f\u5b50\uff09\u7684\u65b9\u6848\u6570\u3002\n\n\u8f6c\u79fb\uff1a$dp'_{u, 0} = \\displaystyle\\prod_{v \\in son_u, v \\neq hs_u} (dp_{v, 0} + dp_{v, 1})$\uff0c$dp_{u, 0} = dp'_{u, 0} (dp_{hs_u, 0} + dp_{hs_u, 1})$\uff0c$dp'_{u, 1} = \\displaystyle\\prod_{v \\in son_u, v \\neq hs_u} dp_{v, 0}$\uff0c$dp_{u, 1} = dp'_{u, 1} dp_{hs_u, 0}$\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u5f97\u51fa\u8f6c\u79fb\u77e9\u9635\uff1a$\\begin{bmatrix} dp_{hs_u, 0}\\ dp_{hs_u, 1} \\end{bmatrix} \\begin{bmatrix} dp'_{u, 0}\\ dp'_{u, 1}\\\\ dp'_{u, 0}\\ 0 \\end{bmatrix} = \\begin{bmatrix} dp_{u, 0}\\ dp_{u, 1} \\end{bmatrix}$\u3002\n\n\u76f4\u63a5\u4e0a\u52a8\u6001 dp \u5373\u53ef\u3002\u6ce8\u610f\u4e58\u6cd5\u65f6\u53ef\u80fd\u4f1a\u9047\u5230 $0$\uff0c\u6b64\u65f6\u6211\u4eec\u76f4\u63a5\u7528\u4e00\u4e2a\u6808\u5b58\u50a8\u66f4\u6539\u524d\u7684\u72b6\u6001\uff0c\u64a4\u9500\u65f6\u4ece\u6808\u4e2d\u53d6\u51fa\u5143\u7d20\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n + m + 2^{n - m + 1} \\log^2 n)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <iostream>\n#include <stack>\n#include <cstring>\n\nusing namespace std;\n\ntypedef long long ll;\n\ntypedef struct {\n\tint nxt;\n\tint end;\n} Edge;\n\ntypedef struct Matrix_tag {\n\tint n;\n\tint m;\n\tll a[3][3];\n\tMatrix_tag(){}\n\tMatrix_tag(int n_, int m_){\n\t\tn = n_;\n\t\tm = m_;\n\t\tmemset(a, 0, sizeof(a));\n\t}\n} Matrix;\n\ntypedef struct {\n\tint l;\n\tint r;\n\tMatrix product;\n} Node;\n\nint cnt = 0, mod = 998244353;\nMatrix e(2, 2);\nint root[100007], head[100007], from[17], to[17], fa[100007], depth[100007], size[100007], hs[100007], dfn[100007], rnk[100007], top[100007], bottom[100007], id[100007], mark[100007], dot[17];\nll dp1[100007][7], dp2[100007][7];\nEdge edge[200007];\nNode tree[400007];\nstack<Matrix> s;\n\nMatrix operator *(const Matrix a, const Matrix b){\n\tMatrix ans(a.n, b.m);\n\tfor (register int i = 1; i <= a.n; i++){\n\t\tfor (register int j = 1; j <= b.m; j++){\n\t\t\tfor (register int k = 1; k <= a.m; k++){\n\t\t\t\tans.a[i][j] = (ans.a[i][j] + a.a[i][k] * b.a[k][j] % mod) % mod;\n\t\t\t}\n\t\t}\n\t}\n\treturn ans;\n}\n\nMatrix operator *=(Matrix &a, const Matrix b){\n\treturn a = a * b;\n}\n\ninline void init(int n){\n\te.a[1][1] = e.a[2][2] = 1;\n\tfor (register int i = 1; i <= n; i++){\n\t\troot[i] = i;\n\t}\n}\n\nint get_root(int x){\n\tif (root[x] == x) return x;\n\treturn root[x] = get_root(root[x]);\n}\n\ninline void add_edge(int start, int end){\n\tcnt++;\n\tedge[cnt].nxt = head[start];\n\thead[start] = cnt;\n\tedge[cnt].end = end;\n}\n\nvoid dfs1(int u, int father){\n\tfa[u] = father;\n\tdepth[u] = depth[father] + 1;\n\tsize[u] = 1;\n\tfor (register int i = head[u]; i != 0; i = edge[i].nxt){\n\t\tint x = edge[i].end;\n\t\tif (x != father){\n\t\t\tdfs1(x, u);\n\t\t\tsize[u] += size[x];\n\t\t\tif (hs[u] == 0 || size[hs[u]] < size[x]) hs[u] = x;\n\t\t}\n\t}\n}\n\nvoid dfs2(int u){\n\tdp1[u][0] = dp1[u][1] = 1;\n\tfor (int i = head[u]; i != 0; i = edge[i].nxt){\n\t\tint x = edge[i].end;\n\t\tif (x != fa[u]){\n\t\t\tdfs2(x);\n\t\t\tif (x != hs[u]){\n\t\t\t\tdp1[u][0] = dp1[u][0] * (dp2[x][0] + dp2[x][1]) % mod;\n\t\t\t\tdp1[u][1] = dp1[u][1] * dp2[x][0] % mod;\n\t\t\t}\n\t\t}\n\t}\n\tdp2[u][0] = dp1[u][0];\n\tdp2[u][1] = dp1[u][1];\n\tif (hs[u] != 0){\n\t\tdp2[u][0] = dp2[u][0] * (dp2[hs[u]][0] + dp2[hs[u]][1]) % mod;\n\t\tdp2[u][1] = dp2[u][1] * dp2[hs[u]][0] % mod;\n\t}\n}\n\nvoid dfs3(int u, int cur_top, int &id){\n\tid++;\n\tdfn[u] = id;\n\trnk[id] = u;\n\ttop[u] = cur_top;\n\tif (hs[u] == 0){\n\t\tbottom[cur_top] = u;\n\t} else {\n\t\tdfs3(hs[u], cur_top, id);\n\t\tfor (register int i = head[u]; i != 0; i = edge[i].nxt){\n\t\t\tint x = edge[i].end;\n\t\t\tif (x != fa[u] && x != hs[u]) dfs3(x, x, id);\n\t\t}\n\t}\n}\n\ninline void update(int x){\n\ttree[x].product = tree[x * 2 + 1].product * tree[x * 2].product;\n}\n\nvoid build(int x, int l, int r){\n\ttree[x].l = l;\n\ttree[x].r = r;\n\tif (l == r){\n\t\ttree[x].product = Matrix(2, 2);\n\t\ttree[x].product.a[1][1] = tree[x].product.a[2][1] = dp1[rnk[l]][0];\n\t\ttree[x].product.a[1][2] = dp1[rnk[l]][1];\n\t\tid[rnk[l]] = x;\n\t\treturn;\n\t}\n\tint mid = (l + r) >> 1;\n\tbuild(x * 2, l, mid);\n\tbuild(x * 2 + 1, mid + 1, r);\n\tupdate(x);\n}\n\nMatrix get_product(int x, int l, int r){\n\tif (l <= tree[x].l && tree[x].r <= r) return tree[x].product;\n\tint mid = (tree[x].l + tree[x].r) >> 1;\n\tMatrix ans = e;\n\tif (r > mid) ans *= get_product(x * 2 + 1, l, r);\n\tif (l <= mid) ans *= get_product(x * 2, l, r);\n\treturn ans;\n}\n\ninline ll query(int u){\n\tMatrix product = get_product(1, dfn[u], dfn[bottom[top[u]]]);\n\treturn (product.a[1][1] + product.a[1][2]) % mod;\n}\n\nvoid do_modify(int x, int pos, Matrix mat){\n\tif (tree[x].l == tree[x].r){\n\t\ttree[x].product = mat;\n\t\treturn;\n\t}\n\tif (pos <= ((tree[x].l + tree[x].r) >> 1)){\n\t\tdo_modify(x * 2, pos, mat);\n\t} else {\n\t\tdo_modify(x * 2 + 1, pos, mat);\n\t}\n\tupdate(x);\n}\n\ninline ll quick_pow(ll x, ll p, ll mod){\n\tll ans = 1;\n\twhile (p){\n\t\tif (p & 1) ans = ans * x % mod;\n\t\tx = x * x % mod;\n\t\tp >>= 1;\n\t}\n\treturn ans;\n}\n\ninline void modify(int u, Matrix mat){\n\twhile (u != 0){\n\t\tMatrix pre = get_product(1, dfn[top[u]], dfn[bottom[top[u]]]), cur;\n\t\tdo_modify(1, dfn[u], mat);\n\t\tcur = get_product(1, dfn[top[u]], dfn[bottom[top[u]]]);\n\t\tu = fa[top[u]];\n\t\tif (u == 0) break;\n\t\tmat = tree[id[u]].product;\n\t\ts.push(mat);\n\t\tmat.a[1][1] = mat.a[2][1] = mat.a[1][1] * quick_pow(pre.a[1][1] + pre.a[1][2], mod - 2, mod) % mod * (cur.a[1][1] + cur.a[1][2]) % mod;\n\t\tmat.a[1][2] = mat.a[1][2] * quick_pow(pre.a[1][1], mod - 2, mod) % mod * cur.a[1][1] % mod;\n\t}\n}\n\ninline void mustnot(int u){\n\tMatrix mat = tree[id[u]].product;\n\ts.push(mat);\n\tmat.a[1][2] = 0;\n\tmodify(u, mat);\n}\n\ninline void must(int u){\n\tMatrix mat = tree[id[u]].product;\n\ts.push(mat);\n\tmat.a[1][1] = mat.a[2][1] = 0;\n\tmodify(u, mat);\n}\n\ninline void rollback(int u){\n\tint cnt = 0;\n\tfor (register int i = u; i != 0; i = fa[top[i]]){\n\t\tdot[++cnt] = i;\n\t}\n\tfor (register int i = cnt; i >= 1; i--){\n\t\tMatrix cur = s.top();\n\t\ts.pop();\n\t\tdo_modify(1, dfn[dot[i]], cur);\n\t}\n}\n\nll dfs(int cur, int n){\n\tif (cur > n) return query(1);\n\tint cur_i = cur + 1;\n\tll ans = 0;\n\tif (mark[from[cur]] != 2){\n\t\tint x = mark[from[cur]];\n\t\tmark[from[cur]] = 1;\n\t\tmustnot(from[cur]);\n\t\tans = dfs(cur_i, n);\n\t\trollback(from[cur]);\n\t\tmark[from[cur]] = x;\n\t}\n\tif (mark[from[cur]] != 1 && mark[to[cur]] != 2){\n\t\tint x = mark[from[cur]], y = mark[to[cur]];\n\t\tmark[from[cur]] = 2;\n\t\tmark[to[cur]] = 1;\n\t\tmust(from[cur]);\n\t\tmustnot(to[cur]);\n\t\tans = (ans + dfs(cur_i, n)) % mod;\n\t\trollback(to[cur]);\n\t\trollback(from[cur]);\n\t\tmark[from[cur]] = x;\n\t\tmark[to[cur]] = y;\n\t}\n\treturn ans;\n}\n\nint main(){\n\tint n, m, k = 0, id = 0;\n\tcin >> n >> m;\n\tinit(n);\n\tfor (register int i = 1; i <= m; i++){\n\t\tint u, v, u_root, v_root;\n\t\tcin >> u >> v;\n\t\tu_root = get_root(u);\n\t\tv_root = get_root(v);\n\t\tif (u_root != v_root){\n\t\t\troot[u_root] = v_root;\n\t\t\tadd_edge(u, v);\n\t\t\tadd_edge(v, u);\n\t\t} else {\n\t\t\tk++;\n\t\t\tfrom[k] = u;\n\t\t\tto[k] = v;\n\t\t}\n\t}\n\tdfs1(1, 0);\n\tdfs2(1);\n\tdfs3(1, 1, id);\n\tbuild(1, 1, n);\n\tcout << dfs(1, k);\n\treturn 0;\n}\n```",
        "postTime": 1645795787,
        "uid": 201007,
        "name": "Leasier",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4426 \u3010[HNOI/AHOI2018] \u6bd2\u7624\u3011"
    },
    {
        "content": "[\u4e0d\u77e5\u9053\u66f4\u597d\u8fd8\u662f\u66f4\u574f\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/Illusory-dimes/p/15483565.html)\n\n## Description\n\n\u7ed9\u5b9a $n$ \u4e2a\u70b9\uff0c $m$ \u6761\u7ea6\u675f\u5173\u7cfb $a$ \u548c $b$ \uff0c\u8868\u793a $a$ \u548c $b$ \u4e0d\u80fd\u540c\u65f6\u88ab\u9009\u62e9\u3002\n\n\u95ee\u6709\u591a\u5c11\u79cd\u9009\u62e9\u65b9\u6848\uff0c\u7b54\u6848\u5bf9 998244353 \u53d6\u6a21\u3002\n\n\u9898\u610f\u6982\u62ec\uff1a\u6c42\u4e00\u5f20\u56fe\u4e0a\u7684\u72ec\u7acb\u96c6\u6570\u91cf\uff08\u4e3a\u4e86\u51f8\u663e\u903c\u683c\u3002\u3002\uff09\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/2wydm5kn.png)\n\n\n$n \\leq 10 ^ 5\\ ,\\ n - 1\\leq m \\leq n + 10$\n\n## Analysis\n\n\u8fd9\u4e2a $m$ \u7684\u8303\u56f4\u6709\u70b9\u8be1\u5f02\uff0c\u5982\u679c\u628a\u56fe\u5efa\u51fa\u6765\uff0c\u6700\u591a\u53ea\u4f1a\u6709 $11$ \u6761\u975e\u6811\u8fb9\uff0c\u6216\u8bb8\u53ef\u4ee5\u4ee5\u6b64\u4f5c\u4e3a\u5207\u5165\u70b9\u5462\u3002\n\n\u4e00\u4e2a\u6bd4\u8f83\u6b63\u5e38\u7684\u60f3\u6cd5\uff0c\u5148\u53bb\u60f3\u5bf9\u4e8e\u4e00\u4e2a\u6811\u7684\u8bdd\uff0c\u600e\u4e48\u505a\u8fd9\u9053\u9898\u3002\n\n\u8fd9\u5e94\u8be5\u662f\u4e00\u4e2a\u57fa\u7840\u5230\u5bb6\u4e86\u7684\u6811\u5f62 DP \u5427\uff0c$F_{u, 0/1}$ \u8868\u793a\u4ee5 u \u4e3a\u6839\u7684\u5b50\u6811\u91cc\u9762\uff0c u \u8fd9\u4e2a\u8282\u70b9\u9009 / \u4e0d\u9009\u7684\u65b9\u6848\u6570\uff0c\u6700\u7ec8\u7b54\u6848\u5c31\u662f $F_{1, 0} + F_{1, 1}$ \u3002\n\n\u8f6c\u79fb\u5f0f\u5b50\u5c31\u662f\uff1a\n\n$$\nF_{u, 0} = \\prod_{(u, v) \\in S} {(F_{v, 0} + F_{v, 1})}\n$$\n\n$$\nF_{u, 1} = \\prod_{(u, v) \\in S} {F_{v, 0}}\n$$\n\n\u7136\u540e\u5c31\u53bb\u8981\u53bb\u60f3\u600e\u4e48\u6269\u5c55\u5230\u4e00\u4e2a\u975e\u6811\u8fb9\u4e0d\u8d85\u8fc7 $11$ \u4e2a\u7684\u56fe\u4e0a\u3002\n\n## Solution\n\n### Part1\n\n\u7531\u4e8e\u8fb9\u5f88\u5c11\uff0c\u6211\u4eec\u751a\u81f3\u53ef\u4ee5\u76f4\u63a5\u679a\u4e3e\uff0c\u5bf9\u4e8e\u6bcf\u6761\u8fb9 $(u, v)$ \uff08\u540c\u65f6\u94a6\u5b9a $u$ \u7684 dfn \u5e8f\u5c0f\u4e8e $v$ \uff09\u7684\u72b6\u6001\u5c31\u662f $(1, 0)\\ ,\\ (0, 1)\\ ,\\ (0, 0)$ \uff08 $1$ \u8868\u793a\u9009\uff0c $0$ \u8868\u793a\u4e0d\u9009\uff09\uff0c\u540c\u65f6\u6ce8\u610f\u5230\u540e\u9762\u4e24\u79cd\u5e76\u4e0d\u6392\u65a5\uff0c\u53ef\u4ee5\u4e00\u5757\u8ba1\u7b97\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u4ee5 $u$ \u9009 / \u4e0d\u9009\u4f5c\u4e3a\u4e00\u6761\u8fb9\u7684\u72b6\u6001\uff0c $O\\Big(2 ^ {m - (n - 1)}\\Big)$ \u7684\u53bb\u679a\u4e3e\uff0c\u7136\u540e $O(n)$ \u7684\u7b97\u3002\n\n\u603b\u4f53\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $O\\Big(2^{m - (n - 1)} \\cdot n\\Big)$ \u7684\u5566\u3002\n\n\u4ece\u6570\u636e\u4e0a\u6765\u770b\u8fd9\u5b8c\u5b8c\u5168\u5168\u80fd\u62ff\u5230 $70pts$ \u5440\uff01\n\n\u7136\u540e\u5199\u5b8c\u8fc7\u540e\u5b9e\u6d4b\u6709 $75pts$ \u3002\u3002\n\n\uff08\u5230\u8fd9\u91cc\u7684\u8bdd\uff0c\u4e2a\u4eba\u8bc4\u4ef7\u662f\u9053\u84dd\u4ee5\u4e0b\u7684 DP \u9898\uff09\n\n### Part2 \n\n\u53ef\u4ee5\u611f\u89c9\u5230\u6bcf\u6b21\u90fd\u662f\u8fdb\u884c\u7684\u76f8\u540c\u7684\u64cd\u4f5c\uff0c\u53ea\u662f\u5bf9\u4e8e\u6709\u4e9b\u70b9\u53ef\u80fd\u786e\u5b9a\u4e86\u9009 / \u4e0d\u9009\uff0c\u4e0d\u518d\u5b58\u5728\u8d21\u732e\uff0c\u5c31\u4f1a\u5f71\u54cd\u4e86\u6574\u4e2a\u6811\u6574\u4f53\u7684\u7b54\u6848\uff0c\u7136\u540e\u6211\u4eec\u5c31\u56e0\u6b64\u91cd\u65b0\u7b97\u4e86\u4e00\u904d\uff0c\u5c5e\u5b9e\u6709\u70b9\u4e8f\u3002\n\n\u7136\u540e\u60f3\u8d77\u6765\u975e\u6811\u8fb9\u4e00\u5171\u5c31 $11$ \u6761\uff0c\u8003\u8651\u628a\u6240\u6709\u591a\u4f59\u7684\u8fb9\u5bf9\u5e94\u7684\u70b9\u62ce\u51fa\u6765\u5efa\u6210\u865a\u6811\uff0c\u90a3\u4e48\u8fd9\u6837\u7684\u8bdd\u6700\u591a\u4f1a\u6709 $22$ \u4e2a\u5173\u952e\u70b9\uff0c\u865a\u6811\u5927\u5c0f\u4e5f\u662f $\\leq (44 + 1)$ \u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u5728\u865a\u6811\u4e0a\u9884\u5904\u7406\u51fa\u6765\u4e00\u70b9\u4ec0\u4e48\u3002\n\n\u60f3\u5230\u4e00\u5f00\u59cb\u7684\u90a3\u4e24\u4e2a\u5f0f\u5b50\uff0c\u5f88\u663e\u7136\u4e0d\u80fd\u76f4\u63a5\u786c\u7b97\uff0c\u56e0\u4e3a\u865a\u6811\u4e24\u4e2a\u6709\u8fb9\u7684\u70b9\u4e4b\u95f4\u53ef\u80fd\u6709\u4e0d\u5c11\u88ab\u7701\u7565\u7684\u70b9\uff0c\u8fd9\u6837\u5c31\u76f8\u5f53\u4e8e\u4e00\u6761\u8fb9\u5728\u539f\u6811\u4e0a\u53ef\u80fd\u662f\u4e00\u6761\u94fe\u3002\n\n\u56e0\u4e3a\u4e2d\u95f4\u7684\u70b9\u80fd\u88ab\u7701\u7565\u6389\uff0c\u8bf4\u660e\u80af\u5b9a\u4e0d\u662f\u5173\u952e\u70b9\uff0c\u6240\u4ee5\u53ef\u4ee5\u6b63\u5e38\u8f6c\u79fb\uff0c\u90a3\u4e48\u5bf9\u4e8e\u539f\u6811\u4e0a\u4e00\u6761\u94fe $u \\Rightarrow x_1 \\Rightarrow x_2 \\Rightarrow ... \\Rightarrow x_k \\Rightarrow v$ \uff0c\u5047\u8bbe $F_{i, 0 / 1}$ \u8f6c\u79fb\u524d\u7684\u503c\u4e3a $G_{i, 0 / 1}$ \uff0c\u8f6c\u79fb\u5f0f\u5b50\u6709\uff1a\n\n$$\n\\left\\{\n\\begin{aligned}\nF_{x_k\\ , 0}& = G_{x_k\\ , 0} \\cdot (F_{v, 0} + F_{v, 1})\n\\\\\nF_{x_k\\ , 1}& = G_{x_k\\ , 0} \\cdot F_{v, 0}\n\\end{aligned}\n\\right.\n\n\\left\\{\n\\begin{aligned}\nF_{x_{k - 1}\\ \\ , 0}& = G_{x_{k - 1}\\ \\ , 0} \\cdot (F_{x_k\\ , 0} + F_{x_k\\ , 1})\n\\\\\nF_{x_{k - 1}\\ \\ , 1}& = G_{x_{k - 1}\\ \\ , 0} \\cdot F_{x_k\\ , 0}\n\\end{aligned}\n\\right.\n$$\n\n\u5408\u5e76\u5e26\u5165\u6709\uff1a\n\n$$\n\\left\\{\n\\begin{aligned}\nF_{x_{k - 1}\\ \\ , 0}& = G_{x_{k - 1}\\ \\ , 0} \\cdot (G_{x_k\\ , 0} \\cdot (F_{v, 0} + F_{v, 1}) + G_{x_k\\ , 0} \\cdot F_{v, 0})\n\\\\\nF_{x_{k - 1}\\ \\ , 1}& = G_{x_{k - 1}\\ \\ , 0} \\cdot (G_{x_k\\ , 0} \\cdot F_{v, 0})\n\\end{aligned}\n\\right.\n$$\n\n$$\n\\Longrightarrow\n$$\n\n$$\n\\left\\{\n\\begin{aligned}\nF_{x_{k - 1}\\ \\ , 0}& = (2\\cdot G_{x_{k - 1}\\ \\ , 0} \\cdot G_{x_k\\ , 0}) \\cdot F_{v, 0} + (G_{x_{k - 1}\\ \\ , 0} \\cdot G_{x_k\\ , 0}) \\cdot F_{v, 1}\n\\\\\nF_{x_{k - 1}\\ \\ , 1}& = (G_{x_{k - 1}\\ \\ , 0} \\cdot G_{x_k\\ , 0}) \\cdot F_{v, 0}\n\\end{aligned}\n\\right.\n$$\n\n\u603b\u7684\u6765\u8bf4\uff0c\u8fd9\u4f1a\u8f6c\u5316\u6210\u4e00\u4e2a\u5e26\u7cfb\u6570 $coe$ \u7684\u5f0f\u5b50\uff0c\u5927\u6982\u5c31\u662f\uff1a\n\n$$\n\\left\\{\n\\begin{aligned}\nF_{u, 0}& = coe_{0, 0} \\cdot F_{v, 0} + coe_{0, 1} \\cdot F_{v, 1}\n\\\\\nF_{u, 1}& = coe_{1, 0} \\cdot F_{v, 0} + coe_{1, 1} \\cdot F_{v, 1}\n\\end{aligned}\n\\right.\n$$\n\n\u90a3\u4e48\u5bf9\u4e8e\u865a\u6811\u4e0a\u4efb\u610f\u4e24\u4e2a\u76f8\u8fde\u7684\u70b9\uff0c\u90fd\u6709\u7c7b\u4f3c\u7684\u5f0f\u5b50\uff0c\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u8fd9\u4e2a $coe$ \uff0c\u7531\u4e8e\u8fd9\u73a9\u610f\u771f\u7684\u7279\u522b\u50cf $F$ \uff0c\u540c\u6837\u53ef\u4ee5\u9009\u62e9\u5927\u6cd5\u5e08\u5904\u7406\uff0c\u4e5f\u662f $O(n)$ \u3002\n\n\u540c\u6837\uff0c\u6811\u4e0a\u6240\u6709\u70b9\u7684 $F$ \u4e5f\u4e0d\u5168\u90fd\u662f $1$ \u4e86\uff0c\u56e0\u4e3a\u8003\u8651\u5230\u6211\u4eec\u5904\u7406\u7684\u7cfb\u6570\u4ec0\u4e48\u7684\u90fd\u662f\u8ddf\u865a\u6811\u4e0a\u7684\u70b9\u6709\u5173\uff0c\u6240\u4ee5\u53ea\u8981\u5b50\u6811\u5185\u4e0d\u5305\u542b\u865a\u6811\u4e0a\u7684\u70b9\u7684\u8bdd\uff0c\u81f3\u59cb\u81f3\u7ec8\u7b54\u6848\u90fd\u662f\u4e00\u6837\u7684\uff0c\u5c31\u628a\u8fd9\u4e9b\u70b9\u7684 $F$ \u6309\u7167\u6b63\u5e38\u7684 DP \u505a\u6cd5\u5904\u7406\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u7edf\u8ba1\u7b54\u6848\u7684\u8bdd\uff0c\u8fd8\u662f\u5148\u679a\u4e3e\u6240\u6709\u975e\u6811\u8fb9\u7684\u9009\u70b9\u7684\u72b6\u6001\uff0c\u7136\u540e\u6309\u7167\u8fd9\u4e2a\u628a\u865a\u6811\u4e0a\u7684\u70b9\u7684\u521d\u503c\u8d4b\u597d\u6211\u4eec\u5df2\u7ecf\u9884\u5904\u7406\u597d\u7684\u7cfb\u6570\uff0c\u8dd1\u4e00\u904d\u865a\u6811\u66f4\u65b0\u7b54\u6848\u5c31\u884c\u4e86\u3002\n\n\u8fd9\u6837\u6309\u7167\u6211\u4eec\u524d\u9762\u8bbe\u60f3\u7684\u7cfb\u6570\u7684\u542b\u4e49\uff0c\u76f8\u5f53\u4e8e\u662f\u8df3\u8fc7\u4e86\u6ca1\u6709\u5fc5\u8981\u518d\u6b21\u8ba1\u7b97\u7684\u975e\u865a\u6811\u70b9\uff0c\u76f4\u63a5\u4e00\u6b65\u5230\u4f4d\uff0c\u7136\u540e\u8fbe\u5230\u4e86\u8282\u7701\u65f6\u95f4\u7684\u76ee\u7684\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O\\Big(n + 2^{m - (n - 1)} \\cdot (m - (n - 1))\\Big)$ \u3002\n\n\uff08\u7531\u4e8e\u5b9e\u73b0\u96c0\u98df\u6709\u70b9\u9ebb\u70e6\u6211\u8fd8\u662f\u53c2\u8003\u4e86 [Soulist](https://www.luogu.com.cn/user/30036 \"Soulist\") \u7684\u5199\u6cd5\uff0c\u96c0\u98df\u975e\u5e38\u7b80\u6d01\u6613\u61c2\uff09\n\n## Code\n\n```cpp\n/*\n\n*/\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N = 1e5 + 10;\nconst int mod = 998244353;\nint n, m, num, lim, k, a[N], fst[N], tot, ifst[N], itot;\nint _k, _a[N], vis[N], cnt, banx[N], bany[N];\nint ft[N], fa[N][18], dfn[N], tim, dep[N], sta[N], top;\nll f[N][2], g[N][2], coe[2][N][2], ans;\nstruct edge {\n\tint nxt, to;\n} e[N << 1], ie[N << 1];\ninline int read() {\n\tchar ch = getchar();\n\tint s = 0, w = 1;\n\twhile (ch < '0' || ch > '9') {if(ch == '-') w = -1; ch = getchar();}\n\twhile (ch >= '0' && ch <= '9') {s = (s << 3) + (s << 1) + ch - '0'; ch = getchar();}\n\treturn s * w;\n}\ninline int find(int x) {\n\tif (ft[x] == x) return ft[x];\n\treturn ft[x] = find(ft[x]);\n}\ninline void add(int u, int v) {\n\te[++tot] = (edge) {fst[u], v};\n\tfst[u] = tot;\n}\ninline void iadd(int u, int v) {\n\tie[++itot] = (edge) {ifst[u], v};\n\tifst[u] = itot;\n}\ninline void dfs1(int u, int fth) {\n\tdep[u] = dep[fth] + 1;\n\tdfn[u] = ++tim; fa[u][0] = fth;\n\tfor (int i = 1; i <= 17; ++i) {\n\t\tfa[u][i] = fa[fa[u][i - 1]][i - 1];\n\t}\n\tfor (int i = fst[u]; i; i = e[i].nxt) {\n\t\tint v = e[i].to;\n\t\tif (v == fth) continue;\n\t\tdfs1(v, u);\n\t\tvis[u] += vis[v];//\u8981\u8bb0\u5f97\u4e92\u76f8\u5f71\u54cd\u4f46\u662f\u4e0d\u5728\u865a\u6811\u4e0a\u7684\u70b9\u4e5f\u4e0d\u80fd\u904d\u5386\n\t}\n}\ninline int lca(int u, int v) {\n\tif (dep[u] < dep[v]) swap(u, v);\n\tfor (int i = 17; ~i; --i) {\n\t\tif (dep[fa[u][i]] >= dep[v]) {\n\t\t\tu = fa[u][i];\n\t\t}\n\t}\n\tif (u == v) return v;\n\tfor (int i = 17; ~i; --i) {\n\t\tif(fa[u][i] != fa[v][i]) {\n\t\t\tu = fa[u][i]; v = fa[v][i];\n\t\t}\n\t}\n\treturn fa[u][0];\n}\ninline bool cmp(int x, int y) {\n\treturn dfn[x] < dfn[y];\n}\ninline void IllusoryTree() {\n\t_k = k;\n\tfor (int i = 1; i <= k; ++i) _a[i] = a[i];\n\tsort(a + 1, a + 1 + k, cmp);\n\tsta[top = 1] = 1; ifst[1] = 0;\n\tfor (int i = 1; i <= k; ++i) {\n\t\tif (a[i] == 1) continue;\n\t\tint Lca = lca(sta[top], a[i]);\n\t\tif (sta[top] != Lca) {\n\t\t\twhile (dfn[sta[top - 1]] > dfn[Lca]) {\n\t\t\t\tiadd(sta[top - 1], sta[top]); --top;\n\t\t\t}\n\t\t\tif (sta[top - 1] == Lca) {\n\t\t\t\tiadd(sta[top - 1], sta[top]); --top;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t_a[++_k] = Lca;\n\t\t\t\tvis[Lca] = 1;\n\t\t\t\tifst[Lca] = 0;\n\t\t\t\tiadd(Lca, sta[top]);\n\t\t\t\tsta[top] = Lca;\n\t\t\t}\n\t\t}\n\t\tsta[++top] = a[i]; ifst[a[i]] = 0;\n\t}\n\tfor (int i = 1; i < top; ++i) {\n\t\tif (!vis[sta[i]]) {\n\t\t\t_a[++_k] = sta[i];\n\t\t\tvis[sta[i]] = 1;\n\t\t}\n\t\tiadd(sta[i], sta[i + 1]);\n\t}\n\tfor (int i = 1; i <= _k; ++i) a[i] = _a[i];\n\tk = _k;\n}\ninline void dp_init(int u, int fth) {\n\tg[u][0] = g[u][1] = 1;\n\tfor (int i = fst[u]; i; i = e[i].nxt) {\n\t\tint v = e[i].to;\n\t\tif (v == fth || vis[v]) continue;\n\t\tdp_init(v, u);\n\t\t(g[u][0] *= (g[v][0] + g[v][1])) %= mod;\n\t\t(g[u][1] *= g[v][0]) %= mod;\n\t}\n}\ninline void dp_help(int u, int son) {\n\tf[u][0] = f[u][1] = 1;\n\tfor (int i = fst[u]; i; i = e[i].nxt) {\n\t\tint v = e[i].to;\n\t\tif (v == son || v == fa[u][0]) continue;\n\t\tdp_help(v, u);\n\t\t(f[u][0] *= (f[v][0] + f[v][1])) %= mod;\n\t\t(f[u][1] *= f[v][0]) %= mod;\n\t}\n}\ninline void calc_coe(int u, int fth) {\n\tint p = u;\n\tcoe[0][u][0] = coe[0][u][1] = coe[1][u][0] = 1;\n\twhile (fa[p][0] != fth) {\n\t\tint q = fa[p][0];\n\t\tdp_help(q, p);\n\t\tll coe00 = coe[0][u][0], coe01 = coe[0][u][1];\n\t\tll coe10 = coe[1][u][0], coe11 = coe[1][u][1];\n\t\tcoe[0][u][0] = (coe00 * f[q][0] + coe10 * f[q][1]) % mod;\n\t\tcoe[1][u][0] = coe00 * f[q][0] % mod;\n\t\tcoe[0][u][1] = (coe01 * f[q][0] + coe11 * f[q][1]) % mod;\n\t\tcoe[1][u][1] = coe01 * f[q][0] % mod;\n\t\tp = q;\n\t}\n}\ninline void dfs2(int u, int fth) {\n\tdp_init(u, fth); a[++k] = u; vis[u] = 1;\n\tif (u != fth) calc_coe(u, fth);\n\tfor (int i = ifst[u]; i; i = ie[i].nxt) {\n\t\tint v = ie[i].to;\n\t\tif (v == fth) continue;\n\t\tdfs2(v, u);\n\t}\n}\ninline void dp_calc(int u, int fth) {\n\tfor (int i = ifst[u]; i; i = ie[i].nxt) {\n\t\tint v = ie[i].to;\n\t\tif (v == fth) continue;\n\t\tdp_calc(v, u);\n\t\t(f[u][0] *= (coe[0][v][0] * f[v][0] + coe[0][v][1] * f[v][1]) % mod) %= mod;\n\t\t(f[u][1] *= (coe[1][v][0] * f[v][0] + coe[1][v][1] * f[v][1]) % mod) %= mod;\n\t}\n}\nint main() {\n\tn = read(); m = read();\n\tnum = m - n + 1; lim = (1 << num);\n\tfor (int i = 1; i <= n; ++i) ft[i] = i;\n\tfor (int i = 1; i <= m; ++i) {\n\t\tint u = read(), v = read();\n\t\tint x = find(u), y = find(v);\n\t\tif (x != y) {\n\t\t\tadd(u, v); add(v, u);\n\t\t\tft[x] = y;\n\t\t}\n\t\telse {\n\t\t\tif (!vis[u]) a[++k] = u, vis[u] = 1;\n\t\t\tif (!vis[v]) a[++k] = v, vis[v] = 1;\n\t\t\tbanx[++cnt] = u; bany[cnt] = v;\n\t\t}\n\t}\n\tdfs1(1, 1);\n\tIllusoryTree();\n\tk = 0;\n\tdfs2(1, 1);\n\t/*if (!k) a[++k] = 1, vis[1] = k;\n\tsort(a + 1, a + 1 + k, cmp);*/\n\tfor (int i = 0; i < lim; ++i) {\n\t\tfor (int j = 1; j <= k; ++j) {\n\t\t\tf[a[j]][0] = g[a[j]][0];\n\t\t\tf[a[j]][1] = g[a[j]][1];\n\t\t}\n\t\tfor (int j = 1; j <= cnt; ++j) {\n\t\t\tif ((1 << (j - 1)) & i) {\n\t\t\t\tf[banx[j]][0] = 0;\n\t\t\t\tf[bany[j]][1] = 0;\n\t\t\t}\n\t\t\telse f[banx[j]][1] = 0;\n\t\t}\n\t\tdp_calc(1, 0);\n\t\tans += f[1][0] + f[1][1];\n\t}\n\tprintf(\"%lld\\n\", ans % mod);\n\treturn 0;\n}\n```",
        "postTime": 1635574993,
        "uid": 206024,
        "name": "Illusory_dimes",
        "ccfLevel": 7,
        "title": "[HNOI/AHOI2018]\u6bd2\u7624"
    },
    {
        "content": "[\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P4426)\n\n\u795e\u4ed9\u865a\u6811\u9898\u3002\n\n\u9996\u5148\u8003\u8651\u6700 trival \u7684\u60c5\u51b5\uff1a$m=n-1$\uff0c\u4e5f\u5c31\u662f\u4e00\u68f5\u6811\u7684\u60c5\u51b5\u3002\u8fd9\u4e2a\u6211\u76f8\u4fe1\u521a\u5b66\u6811\u5f62 $dp$ \u7684\u90fd\u80fd\u591f\u79d2\u6389\u7f62\uff08\u786e\u4fe1\uff09\u3002\u76f4\u63a5\u8bbe $dp_{i,0/1}$ \u5728\u8868\u793a $i$ \u7684\u5b50\u6811\u5185\u9009\u62e9\uff0c$i$ \u9009/\u4e0d\u9009\u7684\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u5c31 $dp_{u,0}=\\prod\\limits_{v\\in son_u}(dp_{v,0}+dp_{v,1}),dp_{u,1}=\\prod\\limits_{v\\in son_u}dp_{v,0}$ \u5373\u53ef\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u6709\u975e\u6811\u8fb9\u7684\u60c5\u51b5\uff0c\u9996\u5148\u6211\u4eec\u4e00\u904d DFS \u627e\u51fa\u6240\u6709\u975e\u6811\u8fb9\u7ec4\u6210\u7684\u96c6\u5408 $E_t$\uff08\u663e\u7136 $|E_t|=m-n+1$\uff09\u6ce8\u610f\u5230 $m\\le n+10$\uff0c\u6545 $|E_t|\\le 11$\uff0c\u6211\u4eec\u8003\u8651\u66b4\u529b\u679a\u4e3e\u6bcf\u6761\u975e\u6811\u8fb9\u7684\u9009\u62e9\u60c5\u51b5\u2014\u2014\u5171\u6709 $(0,0),(0,1),(1,0)$ \u4e09\u79cd\u60c5\u51b5\uff0c\u4f46\u5b9e\u9645\u4e0a\u6211\u4eec\u53d1\u73b0\u5982\u679c\u5de6\u7aef\u70b9\u4e0d\u9009\uff0c\u90a3\u53f3\u7aef\u70b9\u5c31\u6ca1\u6709\u9650\u5236\u4e86\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u679a\u4e3e\u5de6\u7aef\u70b9\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a $ban_{u,x}$ \u8868\u793a\u70b9 $u$ \u9009/\u4e0d\u9009\u662f\u5426\u4e0d\u53ef\u884c\uff0c\u90a3\u4e48\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u9700\u6539\u4e3a $dp_{u,0}=\\prod\\limits_{v\\in son_u}(dp_{v,0}+dp_{v,1})\\times(1-ban_{u,0}),dp_{u,1}=\\prod\\limits_{v\\in son_u}dp_{v,0}\\times(1-ban_{u,1})$\u3002\u8fd9\u6837\u590d\u6742\u5ea6\u662f $n2^{|E_t|}$ \u7684\uff0c\u5927\u7ea6\u53ef\u4ee5\u62ff\u5230 $75$ \u5206\u7684\u597d\u6210\u7ee9\u3002\n\n\u8003\u8651\u8fdb\u4e00\u6b65\u4f18\u5316\uff0c\u6ce8\u610f\u5230\u867d\u7136\u72b6\u6001\u6570\u5f88\u591a\uff0c\u4f46\u6ee1\u8db3 $ban_{u,0}=1\\lor ban_{u,1}=1$ \u7684\u70b9\u5e76\u4e0d\u591a\uff0c\u6700\u591a\u53ea\u6709 $22$ \u4e2a\uff0c\u56e0\u6b64\u6211\u4eec\u8003\u8651\u5bf9\u8fd9\u4e9b\u5173\u952e\u70b9\u5efa\u7acb**\u865a\u6811**\uff0c\u4f46\u662f\u7531\u4e8e\u5728\u5efa\u7acb\u865a\u6811\u7684\u8fc7\u7a0b\u4e2d\u6211\u4eec\u5c06\u6709\u7684\u94fe\u7f29\u6210\u4e86\u8fb9\uff0c\u56e0\u6b64\u6211\u4eec\u5c31\u4e0d\u80fd\u518d\u50cf\u4e4b\u524d\u90a3\u6837\u8f6c\u79fb\u4e86\uff0c\u6211\u4eec\u8003\u8651\u5bf9\u6bcf\u6761\u865a\u6811\u4e0a\u7684\u8fb9 $e=(u,v)$\uff08$u$ \u662f $v$ \u7684\u7236\u4eb2\uff09\u9884\u5904\u7406\u4e00\u4e2a\u7cfb\u6570 $k_{e,0/1,0/1}$\uff0c\u8868\u793a $dp_{u,0}=\\prod\\limits_{e\\in E_u}(dp_{v,0}\\times k_{e,0,0}+dp_{v,1}\\times k_{e,0,1}),dp_{u,1}=\\prod\\limits_{e\\in E_u}(dp_{v,0}\\times k_{e,1,0}+dp_{v,1}\\times k_{e,1,1})$\uff08\u6709\u70b9\u7c7b\u4f3c\u4e8e\u77e9\u9635\u4e58\u6cd5\uff09\uff0c\u5176\u4e2d $E_u$ \u4e3a\u4ee5 $u$ \u4e3a\u4e0a\u7aef\u8282\u70b9\u7684\u865a\u94fe\u7684\u96c6\u5408\uff0c\u663e\u7136\u5982\u679c\u6211\u4eec\u6c42\u51fa\u4e86 $k_{e,0/1,0/1}$ \u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u865a\u6811\u4e0a $dp$ \u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u5c31\u964d\u5230\u4e86 $|E_t|\\times 2^{|E_t|}$\u3002\n\n\u4e8e\u662f\u73b0\u5728\u6211\u4eec\u7684\u4efb\u52a1\u5c31\u662f\u6c42\u51fa $k_{e,0/1,0/1}$\uff0c\u9996\u5148\u5bf9\u4e8e\u6bcf\u4e2a\u865a\u6811\u8fb9 $(u,v)$ \u7684\u5bf9\u5e94\u94fe\u4e0a\u7684\u70b9 $w$\uff0c$w$ \u5b50\u6811\u5185\u8ddd\u79bb $w$ \u6700\u8fd1\u7684\u5728\u865a\u6811\u4e0a\u7684\u70b9\u662f\u552f\u4e00\u7684\uff0c\u8fd9\u4e2a\u70b9\u5c31\u662f $v$\uff0c\u56e0\u6b64\u6211\u4eec\u518d\u5efa\u4e00\u4e2a\u6570\u7ec4 $dk_{w,0/1,0/1}$ \u8868\u793a $dp_{w,0}=dp_{v,0}\\times dk_{w,0,0}+dp_{v,1}\\times dk_{w,0,1},dp_{w,1}=dp_{v,0}\\times dk_{w,1,0}+dp_{v,1}\\times dk_{w,1,1}$\uff0c\u663e\u7136\u5bf9\u4e8e\u5173\u952e\u70b9 $u$\uff0c$dp_{u,0,0}=dp_{u,1,1}=1,dp_{u,1,0}=dp_{u,0,1}=0$\u3002\u8003\u8651\u600e\u6837\u901a\u8fc7 $w$ \u5b50\u6811\u7684 $dk$ \u6c42\u51fa $dk_w$\uff0c\u663e\u7136\u5bf9\u4e8e $w$ \u7684\u6240\u6709\u513f\u5b50\uff0c\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\u5728 $u\\to v$ \u8fd9\u6761\u865a\u94fe\u4e0a\uff0c\u6211\u4eec\u5047\u8bbe\u8fd9\u4e2a\u70b9\u4e3a $x$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u5176\u4ed6\u7684 $w$ \u7684\u513f\u5b50 $y\\ne x$\uff0c$dp_{y,0},dp_{y,1}$ \u663e\u7136\u662f\u5b9a\u503c\uff0c\u6839\u636e\u524d\u9762\u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u662f\u76f4\u63a5\u4e58\u4e0a\u5373\u53ef\uff0c\u5373 $dk_{w,0,0/1}$ \u4e58\u4e0a $dp_{y,0}+dp_{y,1}$\uff0c$dk_{w,1,0/1}$ \u4e58\u4e0a $dp_{y,0}$\u3002\u800c\u5bf9\u4e8e $w$ \u5728\u5173\u952e\u94fe\u4e0a\u7684\u513f\u5b50\uff0c\u6839\u636e $dp_{x,0}=dp_{v,0}\\times dk_{x,0,0}+dp_{v,1}\\times dk_{x,0,1},dp_{x,1}=dp_{v,0}\\times dk_{x,1,0}+dp_{v,1}\\times dk_{x,1,1}$\uff0c\u53ef\u4ee5\u5f97\u51fa $x$ \u5bf9 $dp_{w,0}$ \u7684\u8d21\u732e\u662f $dp_{x,0}+dp_{x,1}=dp_{v,0}\\times(dk_{x,0,0}+dk_{x,1,0})+dp_{v,1}\\times(dk_{x,0,1}+dk_{x,1,1})$\uff0c\u5bf9 $dp_{w,1}$ \u7684\u8d21\u732e\u662f $dp_{v,0}\\times dk_{x,0,0}+dp_{v,1}\\times dk_{x,0,1}$\uff0c\u6545\u6211\u4eec\u9700\u4ee4 $dk_{w,0,0}\\leftarrow dk_{w,0,0}\\times(dk_{x,0,0}+dk_{x,1,0}),dk_{w,1,0}\\leftarrow dk_{w,1,0}\\times dk_{x,0,0}$\uff0c\u8fd9\u6837\u5373\u53ef\u6c42\u51fa $k_{e,0/1,0/1}$\uff0c\u5177\u4f53\u89c1\u4ee3\u7801\u7f62\u3002\n\n```cpp\nconst int MAXN=1e5+10;\nconst int MAXK=11;\nconst int MOD=998244353;\nint n,m,hd[MAXN+5],to[MAXN*2+5],nxt[MAXN*2+5],ec=1,ans=0;\nbool ist[MAXN+5],onv[MAXN+5];\nvoid adde(int u,int v){to[++ec]=v;nxt[ec]=hd[u];hd[u]=ec;}\nint dfn[MAXN+5],tim=0;pii et[MAXK+5];int ecnt=0;\nvoid dfs1(int x,int f){\n\tdfn[x]=++tim;\n\tfor(int e=hd[x];e;e=nxt[e]){\n\t\tint y=to[e];if(y==f) continue;\n\t\tif(!dfn[y]) dfs1(y,x);\n\t\telse{\n\t\t\tonv[x]=onv[y]=1;ist[e>>1]=1;\n\t\t\tif(dfn[x]<dfn[y]) et[++ecnt]=mp(x,y);\n\t\t}\n\t}\n}\nint cnt[MAXN+5];\nvoid dfs2(int x,int f){\n\tfor(int e=hd[x];e;e=nxt[e]){\n\t\tint y=to[e];if(y==f||ist[e>>1]) continue;\n\t\tdfs2(y,x);cnt[x]+=cnt[y];\n\t} onv[x]|=(cnt[x]>=2);cnt[x]=!!(cnt[x]+onv[x]);\n}\npii k[MAXN+5][2];int dp0[MAXN+5][2];\nvector<pair<int,pair<pii,pii> > > g[MAXN+5];\npii operator +(pii lhs,pii rhs){return mp((lhs.fi+rhs.fi)%MOD,(lhs.se+rhs.se)%MOD);}\npii operator *(pii lhs,int rhs){return mp(1ll*lhs.fi*rhs%MOD,1ll*lhs.se*rhs%MOD);}\nint dfs3(int x,int f){\n\tdp0[x][0]=dp0[x][1]=1;int z=0;\n\tfor(int e=hd[x];e;e=nxt[e]){\n\t\tint y=to[e];if(y==f||ist[e>>1]) continue;\n\t\tint dw=dfs3(y,x);\n\t\tif(!dw){\n\t\t\tdp0[x][0]=1ll*dp0[x][0]*(dp0[y][0]+dp0[y][1])%MOD;\n\t\t\tdp0[x][1]=1ll*dp0[x][1]*dp0[y][0]%MOD;\n\t\t} else if(onv[x]) g[x].pb(mp(dw,mp(k[y][0]+k[y][1],k[y][0])));\n\t\telse k[x][0]=k[y][0]+k[y][1],k[x][1]=k[y][0],z=dw;\n\t} if(onv[x]) k[x][0]=mp(1,0),k[x][1]=mp(0,1),z=x;\n\telse k[x][0]=k[x][0]*dp0[x][0],k[x][1]=k[x][1]*dp0[x][1];\n//\tprintf(\"%d %d %d %d %d\\n\",x,k[x][0].fi,k[x][0].se,k[x][1].fi,k[x][1].se);\n//\tprintf(\"%d %d\\n\",dp0[x][0],dp0[x][1]);\n\treturn z;\n}\nbool ban[MAXN+5][2];int dp[MAXN+5][2];\nvoid dfs4(int x){\n\tdp[x][0]=(!ban[x][0])*dp0[x][0];\n\tdp[x][1]=(!ban[x][1])*dp0[x][1];\n\tfor(int i=0;i<g[x].size();i++){\n\t\tint y=g[x][i].fi;dfs4(y);\n\t\tpii p0=g[x][i].se.fi,p1=g[x][i].se.se;\n\t\tdp[x][0]=1ll*dp[x][0]*((1ll*dp[y][0]*p0.fi+1ll*dp[y][1]*p0.se)%MOD)%MOD;\n\t\tdp[x][1]=1ll*dp[x][1]*((1ll*dp[y][0]*p1.fi+1ll*dp[y][1]*p1.se)%MOD)%MOD;\n\t} //printf(\"%d %d %d\\n\",x,dp[x][0],dp[x][1]);\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1,u,v;i<=m;i++) scanf(\"%d%d\",&u,&v),adde(u,v),adde(v,u);\n\tdfs1(1,0);dfs2(1,0);onv[1]=1;dfs3(1,0);\n//\tfor(int i=1;i<=n;i++) printf(\"%d%c\",onv[i],\" \\n\"[i==n]);\n//\tfor(int i=1;i<=ecnt;i++) printf(\"%d %d\\n\",et[i].fi,et[i].se);\n\tfor(int i=0;i<(1<<ecnt);i++){\n\t\tfor(int j=1;j<=ecnt;j++){\n\t\t\tif(i>>(j-1)&1) ban[et[j].fi][0]=1,ban[et[j].se][1]=1;\n\t\t\telse ban[et[j].fi][1]=1;\n\t\t} dfs4(1);ans=(ans+dp[1][0])%MOD;ans=(ans+dp[1][1])%MOD;\n\t\tfor(int j=1;j<=ecnt;j++){\n\t\t\tif(i>>(j-1)&1) ban[et[j].fi][0]=0,ban[et[j].se][1]=0;\n\t\t\telse ban[et[j].fi][1]=0;\n\t\t}\n\t} printf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1624783691,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4426 [HNOI/AHOI2018]\u6bd2\u7624"
    },
    {
        "content": "\u8003\u8651\u76f4\u63a5\u66b4\u529b\u3002\n```cpp\nf[x][1]=f[x][1]*f[y][0];\nf[x][0]=f[x][0]*(f[y][0]+f[y][1]);\n```\n\u90a3\u4e48\u663e\u7136\uff0c\u5bf9\u4e8e\u4e00\u6761\u975e\u6811\u8fb9\uff0c\u53ea\u6709\u4e24\u79cd\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u4e09\u79cd\uff0c\u6211\u4eec\u76f4\u63a5\u4e8c\u8fdb\u5236\u679a\u4e3e\u8fd9\u4e9b\u72b6\u6001\uff0c\u628a\u4e0d\u5408\u6cd5\u7684continue\u6389\uff0c\u5361\u5361\u5e38\u5c31\u8fc7\u4e86\u3002\u7406\u8bba\u590d\u6742\u5ea6\u67092e8\uff0c\u4f46\u662fluogu\u5f00\u4e86O2\u53ef\u4ee5\u57281s\u4e4b\u5185\u8dd1\u51fa\u6765\u3002\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nnamespace IO\n{\n    const int __S=(1<<21)+5;char __buf[__S],*__H,*__T;\n    inline char getc()\n    {\n        if(__H==__T) __T=(__H=__buf)+fread(__buf,1,__S,stdin);\n        if(__H==__T) return -1;return *__H++;\n    }\n    template <class __I>inline void read(__I &__x)\n    {\n        __x=0;int __fg=1;char __c=getc();\n        while(!isdigit(__c)&&__c!='-') __c=getc();\n        if(__c=='-') __fg=-1,__c=getc();\n        while(isdigit(__c)) __x=__x*10+__c-'0',__c=getc();\n        __x*=__fg;\n    }\n    inline void readd(double &__x)\n    {\n        __x=0;double __fg=1.0;char __c=getc();\n        while(!isdigit(__c)&&__c!='-') __c=getc();\n        if(__c=='-') __fg=-1.0,__c=getc();\n        while(isdigit(__c)) __x=__x*10.0+__c-'0',__c=getc();\n        if(__c!='.'){__x=__x*__fg;return;}else while(!isdigit(__c)) __c=getc();\n        double __t=1e-1;while(isdigit(__c)) __x=__x+1.0*(__c-'0')*__t,__t=__t*0.1,__c=getc();\n        __x=__x*__fg;\n    }\n    inline void reads(char *__s,int __x)\n    {\n        char __c=getc();int __tot=__x-1;\n        while(__c<'!'||__c>'~') __c=getc();\n        while(__c>='!'&&__c<='~') __s[++__tot]=__c,__c=getc();\n        __s[++__tot]='\\0';\n    }\n    char __obuf[__S],*__oS=__obuf,*__oT=__oS+__S-1,__c,__qu[55];int __qr;\n    inline void flush(){fwrite(__obuf,1,__oS-__obuf,stdout);__oS=__obuf;}\n    inline void putc(char __x){*__oS++ =__x;if(__oS==__oT) flush();}\n    template <class __I>inline void print(__I __x)\n    {\n        if(!__x) putc('0');\n        if(__x<0) putc('-'),__x=-__x;\n        while(__x) __qu[++__qr]=__x%10+'0',__x/=10;\n        while(__qr) putc(__qu[__qr--]);\n    }\n    inline void prints(const char *__s,const int __x)\n    {\n        int __len=strlen(__s+__x);\n        for(int __i=__x;__i<__len+__x;__i++) putc(__s[__i]);\n    }\n    inline void printd(double __x,int __d)\n    {\n        long long __t=(long long)floor(__x);print(__t);putc('.');__x-=(double)__t;\n        while(__d--)\n        {\n            double __y=__x*10.0;__x*=10.0;\n            int __c=(int)floor(__y);\n            putc(__c+'0');__x-=floor(__y);\n        }\n    }\n    inline void el(){putc('\\n');}inline void sp(){putc(' ');}\n}using namespace IO;\n#define N 100100\n#define P 998244353\nint n,m,x,y,ok,cnt,ans,he[N],ne[N*2],to[N*2],f[N],g[N],u[N],v[N],a[N],b[N],dfn[N],d[N],I,t1,t2,t3;\nvoid add(int x,int y){to[cnt]=y;ne[cnt]=he[x];he[x]=cnt++;}\nint inc(int x,int y){return x+y>=P?x+y-P:x+y;}\nvoid dfs(int x,int fa)\n{\n    dfn[x]=++I;\n    for(int i=he[x],y;~i;i=ne[i]) if((y=to[i])!=fa)\n    {\n        if(dfn[y]&&dfn[y]<dfn[x]) a[++t1]=y,b[t1]=x,d[++t3]=y,d[++t3]=x;\n        else if(!dfn[y]) u[++t2]=x,v[t2]=y,dfs(y,x);\n    }\n}\nint main()\n{\n    read(n);read(m);memset(he,-1,sizeof(he));\n    for(register int i=1;i<=m;i++) read(x),read(y),add(x,y),add(y,x);\n    dfs(1,0);\n    for(register int s=0;s<(1<<t1);s++)\n    {\n        for(register int i=1;i<=n;i++) f[i]=g[i]=1;\n        for(register int i=1;i<=t1;i++) if((1<<(i-1))&s) g[a[i]]=0;else f[a[i]]=g[b[i]]=0;\n        ok=1;for(int i=1;i<=t3;i++) if(!f[d[i]]&&!g[d[i]]){ok=0;break;}\n        if(!ok) continue;\n        for(register int i=n-1;i;i--) x=u[i],y=v[i],f[x]=1ll*f[x]*(f[y]+g[y])%P,g[x]=1ll*g[x]*f[y]%P;\n        ans=inc(ans,inc(f[1],g[1]));\n    }\n    printf(\"%d\\n\",ans);\n}\n```",
        "postTime": 1550728494,
        "uid": 70545,
        "name": "Awar3ness",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4426 \u3010[HNOI/AHOI2018]\u6bd2\u7624\u3011"
    },
    {
        "content": "\uff08\u6ce8\u610f\uff1a\u672c\u9898\u89e3\u53ea\u662f\u5206\u4eab\u4e00\u4e0b\u6211\u7684\u4e00\u79cd\u5947\uff08\u8fa3\uff09\u7279\uff08\u9e21\uff09\u7684\u601d\u8def\uff0c\u65e0\u6cd5AC\u6b64\u9898\uff09\n\n\u770b\u5230\u8fd9\u9898\u8fdf\u8fdf\u6ca1\u6709\u4eba\u53d1\u9898\u89e3\uff0c\u6211\u53c8\u770b\u4e0d\u61c2\u7f51\u4e0a\u7684\u6807\u7b97\uff0c\u4e8e\u662f\u6211\u5728\u6323\u624e\u4e2dYY\u7740\u7b97\u6cd5\uff0c\u4e8e\u662f\u4ea7\u751f\u4e86\u4e0b\u9762\u8fd9\u4e2a\u534a\u6210\u54c1\u3002\u4f5c\u4e3a\u9ad8\u4e00\u7684\u6e23\u6e23\uff0c\u6211\u53ea\u80fd\u5199\u51fa\u8fd9\u79cd\u8fa3\u9e21\u505a\u6cd5\u4e86\uff0c65\u5206\uff0c\u7136\u540e\u5c31\u4f1aT\u3002\n\n\u6211\u662f\u8fd9\u4e48\u60f3\u7684\uff0c\u6211\u5728\u5efa\u6811\u7684\u65f6\u5019\u4f1a\u6709\u4e00\u4e9b\u8fb9\u65e0\u6cd5\u52a0\u5165\u68ee\u6797\u91cc\uff0c\u5426\u5219\u5c31\u4f1a\u6784\u6210\u73af\u3002\u6240\u4ee5\u6211\u5c31\u60f3\u5148\u751f\u6210\u4e00\u9897\u6811\uff0c\u7136\u540e\u628a\u90a3\u4e9b\u591a\u4f59\u8fb9\u6240\u8fde\u63a5\u7684\u70b9\u5168\u90fd\u62a0\u6389\u5c31\u53d8\u6210\u4e86\u4e00\u4e2a\u6b8b\u4f59\u68ee\u6797\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u5bf9\u8fd9\u4e2a\u6b8b\u4f59\u68ee\u6797\u5148\u8fdb\u884c\u4e00\u6b21\u88f8\u7684DP\uff0c\u7136\u540e\u679a\u4e3e\u90a3\u4e9b\u88ab\u62a0\u6389\u7684\u70b9\u662f\u5426\u52a0\u5165\u68ee\u6797\u3002\u6700\u591a\u670922\u4e2a\u70b9\uff0c\u7136\u540e\u8fd9\u4e9b\u52a0\u5165\u68ee\u6797\u7684\u70b9\u6807\u8bb0\u4e3a\u5fc5\u987b\u9009\u62e9\u518d\u7b97\u65b9\u6848\uff0c\u6bcf\u6b21\u5f97\u5230\u5408\u6cd5\u7684\u68ee\u6797\u65f6\u90fd\u4f1a\u7b97\u51fa\u5f3a\u884c\u540c\u65f6\u9009\u62e9\u7684\u90a3\u4e9b\u591a\u4f59\u70b9\u7684\u65b9\u6848\uff0c\u6700\u540e\u628a\u6bcf\u6b21\u7684\u7ed3\u679c\u76f8\u52a0\u5c31\u662f\u603b\u65b9\u6848\u6570\u3002\n\n\u4f46\u662f\u6709\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u6bcf\u6b21\u5224\u65ad\u4f60\u679a\u4e3e\u7684\u70b9\u52a0\u5165\u68ee\u6797\u662f\u5426\u53ef\u4ee5\u5408\u6cd5\u800c\u4e0d\u6784\u6210\u73af\uff08\u5982\u679c\u4e00\u4e2a\u70b9\u52a0\u5165\u4e86\u68ee\u6797\uff0c\u90a3\u4e48\u4e0e\u4e4b\u76f8\u5173\u7684\u6240\u6709\u8fb9\u90fd\u8981\u52a0\u8fdb\u68ee\u6797\uff0c\u5f53\u7136\u4e0d\u9009\u7684\u70b9\u9664\u5916\uff09\u3002\u4e8e\u662f\u6211\u60f3\u5230\u4e86\u4e00\u4e2a\u529e\u6cd5\uff0c\u6211\u5148\u5904\u7406\u51fa\u539f\u59cb\u68ee\u6797\u7684\u5e76\u67e5\u96c6\u72b6\u6001\uff0c\u6bcf\u6b21\u52a0\u5165\u65b0\u70b9\u7684\u65f6\u5019\u4f1a\u5c06\u5e76\u67e5\u96c6\u66f4\u65b0\uff0c\u4ed4\u7ec6\u60f3\u60f3\u4f1a\u53d1\u73b0\uff0c\u6211\u4eec\u6bcf\u6b21\u5c06\u5e76\u67e5\u96c6\u66f4\u65b0\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u628a\u4e00\u4e9b\u7236\u5b50\u540c\u4f53\u7684\u70b9\u7684\u7236\u4eb2\u53d8\u6210\u522b\u7684\u70b9\uff0c\u90a3\u4e48\u6211\u4eec\u7528\u4e00\u4e2a\u961f\u5217\u8bb0\u5f55\u4e0b\u88ab\u66f4\u65b0\u8fc7\u7684\u70b9\uff0c\u5728\u6bcf\u6b21\u5b8c\u6210\u5224\u65ad\u540e\u518d\u628a\u4ed6\u4eec\u7684\u7236\u4eb2\u8d4b\u56de\u5b83\u4eec\u81ea\u5df1\u3002\n\n\u6211\u6ee1\u6000\u5fd0\u5fd1\u7684\u6253\u5b8c\u8fd9\u4e2a\u4ee3\u7801\uff0c\u7136\u540e\u53d1\u73b0\u590d\u6742\u5ea6\u679c\u7136\u4e0d\u5bf9\uff0c\u4e00\u4e2a\u662f\u6211\u4e0d\u77e5\u9053\u5408\u6cd5\u7684\u65b9\u6848\u6570\u4f1a\u6709\u591a\u5c11\uff0c\u6bcf\u6b21\u5f97\u5230\u4e00\u4e2a\u65b9\u6848\u4f1a\u6267\u884c\u4e00\u6b21On\u7684dp\uff0c\u53ef\u80fd\u4f1a\u5f88\u5927\uff0c\u7136\u540e\u6bcf\u6b21\u6211\u4eec\u901a\u8fc7\u52a0\u8fb9\u5224\u65ad\u68ee\u6797\u7684\u5408\u6cd5\u6027\u65f6\uff0c\u6bcf\u4e2a\u70b9\u6240\u8fde\u63a5\u7684\u8fb9\u53ef\u80fd\u4f1a\u5f88\u591a\uff0c\u6240\u4ee5\u4f1aT\u3002\n\n\u4e0b\u9644\u8fa3\u9e21\u4ee3\u7801\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<queue>\n#include<cstring>\n#define LL long long\nusing namespace std;\nconst int maxn=1e5+10;\nconst LL mod=998244353;\ninline void read(int &x)\n{\n\tx=0;char c=getchar();int f=1;\n\twhile((c<'0'||c>'9')&&c!='-')c=getchar();\n\tif(c=='-')f=-1;\n\twhile(c<='9'&&c>='0')x=(x<<1)+(x<<3)+(c^'0'),c=getchar();\n\tx=x*f;\n}\nint n,m;\nint a[maxn],b[maxn];\nint fa[maxn];\nbool vis[maxn];\nint s[maxn],ls;\nLL dp[maxn][2],ans,sum;\nint que[maxn],lq;\nint q[maxn],ll;\nint to[maxn<<1],nex[maxn<<1],beg[maxn],e,inq[maxn];\nbool ins[maxn],intree[maxn],must[maxn];\nint find(int x) {return fa[x]==x?x:fa[x]=find(fa[x]);}\ninline void add(int u,int v)\n{\n\tto[++e]=v;\n\tnex[e]=beg[u];\n\tbeg[u]=e;\n}\nvoid dfsdp(int u)\n{\n\tvis[u]=1;\n\tif(must[u])dp[u][1]=1,dp[u][0]=0;\n\telse {dp[u][1]=dp[u][0]=1;}\n\tfor(register int i=beg[u];i;i=nex[i])\n\t{\n\t\tint v=to[i];\n\t\tif(vis[v]||!intree[v])continue;\n\t\tdfsdp(v);\n\t\tdp[u][0]=dp[u][0]*(dp[v][1]+dp[v][0])%mod;\n\t\t(dp[u][1]*= dp[v][0])%=mod;\n\t}\n}\ninline void pd()\n{\n\tint flag=0;\n\tll=0;\n\tfor(register int i=1;i<=lq;++i)\n\t{\n\t\tint u=que[i];\n\t\tfor(register int j=beg[u];j;j=nex[j])\n\t\t{\n\t\t\tint v=to[j];\n\t\t\tif(!intree[v])continue;\n\t\t\tif(must[u]&&must[v]){flag=1;break;}\n\t\t\tif(find(u)==find(v)){flag=1;break;}\n\t\t\telse \n\t\t\t{\n\t\t\t\tq[++ll]=find(u);\n\t\t\t\tfa[find(u)]=find(v);\n\t\t\t}\n\t\t}\n\t\tif(flag)break;\n\t}\n\t\twhile(ll)\n\t\t{\n\t\t\tfa[q[ll]]=q[ll];\n\t\t\t--ll;\n\t\t}\n\tif(flag)\n\t{\n\t\t/*for(register int i=1;i<=n;++i)\n\t\t\tif(intree[i])printf(\"%d \",i);\n\t\tputs(\"\");*/\n\t\treturn;\n\t}\n\telse\n\t{\n\t\t/*for(register int i=1;i<=n;++i)\n\t\t\tif(intree[i])printf(\"%d \",i);\n\t\tputs(\"\");*/\n\t\tmemset(vis,0,sizeof(vis));\n\t\tsum=1;\n\t\tfor(register int i=1;i<=n;++i)\n\t\tif(intree[i]&&!vis[i])\n\t\t{\n\t\t\tdfsdp(i);\n\t\t\t(sum*=dp[i][0]+dp[i][1])%=mod;\n\t\t}\n\t\t(ans+=sum)%=mod;\n\t\treturn;\n\t}\n}\nvoid dfs(int k)\n{\n\tif(k>ls)\n\t{\n\t\tif(!lq)return;\n\t\tpd();\n\t\treturn;\n\t}\n\tdfs(k+1);\n\tque[++lq]=s[k];\n\tintree[s[k]]=1;\n\tinq[s[k]]=lq;\n\tdfs(k+1);\n\tintree[s[k]]=0;\n\tinq[s[k]]=0;\n\t--lq;\n}\nint main()\n{\n\tread(n),read(m);\n\tfor(register int i=1;i<=m;++i)\n\t\tread(a[i]),read(b[i]),add(a[i],b[i]),add(b[i],a[i]);\n\tfor(register int i=1;i<=n;++i)fa[i]=i;\n\tfor(register int i=1;i<=m;++i)\n\t{\n\t\tif(find(a[i])!=find(b[i]))\n\t\t{\n\t\t\tfa[find(a[i])]=find(b[i]);\n\t\t\tvis[i]=1;\n\t\t}\n\t}\n\tfor(register int i=1;i<=m;++i)\n\tif(!vis[i])\n\t{\n\t\tif(!ins[a[i]])ins[a[i]]=1,s[++ls]=a[i];\n\t\tif(!ins[b[i]])ins[b[i]]=1,s[++ls]=b[i];\n\t}\n\tfor(register int i=1;i<=n;++i)\n\t\tif(!ins[i])intree[i]=1;\n\t\telse must[i]=1;\n\tfor(register int i=1;i<=n;++i)fa[i]=i;\n\tfor(register int i=1;i<=m;++i)\n\t\tif(intree[a[i]]&&intree[b[i]])fa[find(a[i])]=find(b[i]);\n\tsum=1;\n\tmemset(vis,0,sizeof(vis));\n\tfor(register int i=1;i<=n;++i)\n\t\tif(intree[i]&&!vis[i])\n\t\t{\n\t\t\tdfsdp(i);\n\n\t\t\t(sum*=dp[i][0]+dp[i][1])%=mod;\n\t\t}\n\t(ans+=sum)%=mod;\n\tif(ls)\n\tdfs(1);\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n\n```",
        "postTime": 1524139018,
        "uid": 20822,
        "name": "cn_lemon",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4426 \u3010[HNOI/AHOI2018]\u6bd2\u7624\u3011"
    }
]