[
    {
        "content": "**\u524d\u8a00.**\n\n\u5199\u8fd9\u7bc7\u6587\u7ae0\u4e3b\u8981\u662f\u56e0\u4e3a\u5927\u90e8\u5206\u9898\u89e3\u91cc\u8981\u4e48\u4ee3\u7801\u5b9e\u73b0\u7684\u65f6\u5019\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u5047\u7684\uff0c\u8981\u4e48\u53ea\u662f\u6c42\u89e3\u534a\u652f\u914d\u70b9\u540e\u76f4\u63a5\u7528 DAG \u4e0a\u6811\u4e0a\u500d\u589e\u7684\u65b9\u6cd5\u505a\uff0c\u8fd9\u91cc\u60f3\u5199\u4e00\u4efd\u590d\u6742\u5ea6\u6b63\u786e\u7684\u9898\u89e3\u4e0e\u4ee3\u7801\u3002\n\n\u7531\u4e8e\u672c\u4eba\u6c34\u5e73\u6709\u9650\uff0c\u8fd9\u91cc\u53ea\u662f\u5927\u6982\u4ecb\u7ecd\u600e\u4e48\u505a\uff0c\u4e0d\u4ecb\u7ecd\u5982\u4f55\u8bc1\u660e\u3002\n\n**\u652f\u914d\u6811\u6982\u5ff5.**\n\n\u5bf9\u4e8e\u4e00\u5f20\u6709\u5411\u56fe\uff0c\u6211\u4eec\u786e\u5b9a\u4e00\u4e2a\u8d77\u70b9 $S$\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u70b9 $k$\uff0c\u79f0 $x$ \u4e3a\u5176\u652f\u914d\u70b9\u5f53\u4e14\u4ec5\u5f53\uff0c\u5220\u53bb\u70b9 $x$ \u540e\uff0c$S$ \u65e0\u6cd5\u5230\u8fbe $k$\uff0c\u5373 $S$ \u5230\u8fbe $k$ \u7684\u6240\u6709\u8def\u5f84\u90fd\u5fc5\u987b\u901a\u8fc7 $x$\u3002\n\n\u5bb9\u6613\u53d1\u73b0\uff0c\u4e00\u4e2a\u70b9\u7684\u652f\u914d\u70b9\u4e0d\u6b62\u4e00\u4e2a\u3002\n\n\u540c\u65f6\uff0c\u4e5f\u5f88\u5bb9\u6613\u53d1\u73b0\uff0c\u5982\u679c\u6211\u4eec\u5c06\u4e00\u4e2a\u70b9 $k$ \u4e0e\u5176\u6700\u8fd1\u7684\u652f\u914d\u70b9\u8fde\u8fb9\uff0c\u90a3\u4e48\u4f1a\u5f62\u6210\u4e00\u4e2a\u6811\u5f62\u7ed3\u6784\uff0c\u8fd9\u4e2a\u6811\u5f62\u7ed3\u6784\u5373\u652f\u914d\u6811\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u6240\u79f0\u7684\u652f\u914d\u70b9\u4e00\u822c\u6307\u5176\u5728\u652f\u914d\u6811\u4e0a\u7684\u7236\u4eb2\u3002\n\n\u6c42\u89e3\u652f\u914d\u6811\u7684\u4e00\u4e2a\u4f18\u79c0\u505a\u6cd5\u662f Lengauer-Tarjan \u7b97\u6cd5\uff0c\u53ef\u4ee5\u505a\u5230\u5728 $O(n\\alpha(n))$ \u6216 $O(n\\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u6c42\u89e3\u652f\u914d\u6811\u3002\n\n**DAG \u4e0a\u7684\u652f\u914d\u6811\u6784\u9020 .**\n\n\u867d\u7136\u8fd9\u90e8\u5206\u4e0e Lengauer-Tarjan \u7b97\u6cd5\u5e76\u6ca1\u6709\u4ec0\u4e48\u5173\u7cfb\uff0c\u4e0d\u8fc7\u8fd8\u662f\u4ecb\u7ecd\u4e00\u4e0b\u5427\u3002\n\n\u9996\u5148\uff0c\u663e\u7136\u4e00\u4e2a\u70b9 $k$ \u7684\u652f\u914d\u70b9\u662f\u6240\u6709\u80fd\u591f\u76f4\u63a5\u5230\u8fbe $k$ \u7684\u70b9\u5728\u652f\u914d\u6811\u4e0a\u7684 LCA\u3002\n\n\u90a3\u4e48\u5c31\u5f88\u7b80\u5355\u4e86\uff0c\u6211\u4eec\u6309\u7167\u62d3\u6251\u5e8f\u4f9d\u6b21\u505a\u4e0b\u53bb\uff0c\u5efa\u7acb\u53cd\u56fe\u627e\u5230\u6240\u6709\u80fd\u591f\u76f4\u63a5\u5230\u8fbe\u5f53\u524d\u70b9\u7684\u70b9\uff0c\u500d\u589e\u6c42\u89e3 LCA \u5373\u53ef\u3002\n\n**Lengauer-Tarjan \u7b97\u6cd5**\n\nLengauer-Tarjan \u7b97\u6cd5\u7684\u5206\u4e3a\u4e09\u6b65\uff1a\n1. \u6c42\u51fa dfs \u6811\uff0c\u5f97\u5230\u6bcf\u4e2a\u70b9 $k$ \u7684 dfs \u5e8f $d_k$\u3002\n2. \u6c42\u89e3\u534a\u652f\u914d\u70b9\u3002\n3. \u6c42\u89e3\u652f\u914d\u70b9\u3002\n\n**\u5f15\u5165\u534a\u652f\u914d\u70b9.**\n\nLengauer-Tarjan \u7b97\u6cd5\u7684\u7cbe\u9ad3\u5728\u4e8e\u5f15\u5165\u4e86\u534a\u652f\u914d\u70b9\u8fd9\u4e2a\u6982\u5ff5\u3002\n\n\u4e00\u4e2a\u70b9 $k$ \u7684\u534a\u652f\u914d\u70b9\u662f\u6307\u4e00\u4e2a dfs \u5e8f\u6700\u5c0f\u7684\u70b9 $x$\uff0c\u4f7f\u5f97 $x$ \u53ef\u4ee5\u901a\u8fc7\u4e00\u6761\u8def\u5f84 $x,x_1,x_2,\\cdots,x_c,k$ \u5230\u8fbe\u70b9 $k$ \uff0c\u6c42\u6ee1\u8db3\u5bf9\u4e8e\u4efb\u610f $1\\leq i\\leq c$\uff0c\u6709 $d_{x_i}>d_k$\u3002\n\n\u53ea\u8981\u80fd\u6c42\u51fa\u534a\u652f\u914d\u70b9\uff0c\u5c31\u6709\u529e\u6cd5\u6c42\u89e3\u652f\u914d\u70b9\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u6765\u6c42\u89e3\u534a\u652f\u914d\u70b9\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u53ef\u4ee5\u76f4\u63a5\u5230\u8fbe\u70b9 $k$ \u7684\u70b9 $x$\uff0c\u6709\u4e24\u79cd\u53ef\u80fd\u7684\u60c5\u51b5\uff1a\n1. \u82e5 $d_x<d_k$\uff0c\u5219 $x$ \u53ef\u80fd\u662f $k$ \u7684\u534a\u652f\u914d\u70b9\u3002\n2. \u82e5 $d_x>d_k$\uff0c\u5219\u8003\u8651\u5176\u6240\u6709\u7956\u5148 $u$ \u6ee1\u8db3 $d_u>d_k$\uff0c$u$ \u7684\u534a\u652f\u914d\u70b9\u53ef\u80fd\u662f\u70b9 $k$ \u7684\u534a\u652f\u914d\u70b9\u3002\n\n\u53ef\u4ee5\u8bc1\u660e\u8fd9\u4e24\u79cd\u60c5\u51b5\u662f\u5145\u5206\u7684\u3002\n\n\u8003\u8651\u6309\u7167 dfs \u5e8f\u5012\u5e8f\u8003\u8651\u6240\u6709\u70b9 $k$\u3002\u679a\u4e3e\u6240\u6709\u80fd\u591f\u76f4\u63a5\u5230\u8fbe\u70b9 $k$ \u7684\u70b9 $x$\uff0c\u7b2c\u4e00\u79cd\u60c5\u51b5\u53ef\u4ee5\u5feb\u901f\u7ef4\u62a4\uff0c\u4f46\u7b2c\u4e8c\u79cd\u60c5\u51b5\u9700\u8981\u8003\u8651\u5176\u6240\u6709\u7956\u5148\uff0c\u6211\u4eec\u4e0d\u80fd\u66b4\u529b\u679a\u4e3e\u3002\n\n\u8003\u8651\u7ef4\u62a4\u4e00\u4e2a\u5e26\u6743\u5e76\u67e5\u96c6\uff0c\u6bcf\u6b21\u5904\u7406\u5b8c\u4e00\u4e2a\u70b9 $k$\uff0c\u6211\u4eec\u5c31\u5c06 $k$ \u5f80\u5176 dfs \u6811\u4e0a\u7684\u7236\u4eb2\u5408\u5e76\uff0c\u540c\u65f6\u7ef4\u62a4\u4e00\u4e2a\u70b9\u5e76\u67e5\u96c6\u4e2d\u9664\u6839\u4ee5\u5916\u7684\u6240\u6709\u7956\u5148\u4e2d\uff0c\u534a\u652f\u914d\u70b9 dfs \u5e8f\u6700\u5c0f\u7684\u90a3\u4e2a\u70b9\uff0c\u5c31\u53ef\u4ee5\u5728\u4e00\u6b21 $O(\\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u5b8c\u6210\u7b2c\u4e8c\u79cd\u60c5\u51b5\u7684\u67e5\u8be2\u3002\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u5df2\u7ecf\u5728 $O(n\\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u5b8c\u6210\u4e86\u534a\u652f\u914d\u70b9\u7684\u6c42\u89e3\u3002\n\n**\u5229\u7528\u534a\u652f\u914d\u70b9\u6c42\u89e3\u652f\u914d\u70b9.**\n\n\u8003\u8651\u70b9 $k$ \u5230\u5176\u534a\u652f\u914d\u70b9 $x$ \u7684\u8fd9\u6761\u94fe\uff08\u4e0d\u5305\u62ec $x$\uff09\u4e0a\u534a\u652f\u914d\u70b9 dfs \u5e8f\u6700\u5c0f\u7684\u70b9 $u$ \u53ca\u5176\u534a\u652f\u914d\u70b9 $v$\uff0c\u5219 $k$ \u5728\u652f\u914d\u70b9\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\n1. \u82e5 $x=v$\uff0c\u5219 $k$ \u7684\u652f\u914d\u70b9\u5c31\u662f $x$\u3002\n2. \u82e5 $d_x>d_v$\uff0c\u5219 $k$ \u7684\u652f\u914d\u70b9\u662f $u$ \u7684\u652f\u914d\u70b9\u3002\n\n\u53ef\u4ee5\u8bc1\u660e\u8fd9\u4e24\u79cd\u60c5\u51b5\u662f\u5145\u5206\u5fc5\u8981\u7684\u3002\n\n\u6211\u4eec\u518d\u6b21\u8003\u8651\u6309\u7167 dfs \u5e8f\u5012\u5e8f\u5904\u7406\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u70b9 $k$\uff0c\u6211\u4eec\u8003\u8651\u5176\u5728\u534a\u652f\u914d\u70b9 $x$\uff0c\u73b0\u5728\u9700\u8981\u5b8c\u6210\u5728 dfs \u6811\u4e0a\u67e5\u8be2 $k$ \u5230 $x$ \u8fd9\u6761\u94fe\uff08\u4e0d\u5305\u542b $x$\uff09\u4e2d\u534a\u652f\u914d\u70b9 dfs \u5e8f\u6700\u5c0f\u7684\u70b9\u3002\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u67e5\u8be2\u5c31\u5728\u534a\u652f\u914d\u70b9\u7684\u6c42\u89e3\u4e2d\u51fa\u73b0\u8fc7\u3002\n\n\u8003\u8651\u5728\u6c42\u89e3\u534a\u652f\u914d\u70b9\u540c\u65f6\u6c42\u89e3\u652f\u914d\u70b9\u3002\u5f53\u6211\u4eec\u6c42\u51fa $k$ \u7684\u534a\u652f\u914d\u70b9\u540e\uff0c\u5c06 $k$ \u7684\u534a\u652f\u914d\u70b9\u4e0e $k$ \u8fde\u8fb9\uff0c\u7ef4\u62a4\u534a\u652f\u914d\u6811\u3002\u540c\u65f6\u4ee4 $x$ \u4e3a $k$ \u5728 dfs \u6811\u4e0a\u7684\u7236\u4eb2\uff0c\u679a\u4e3e $x$ \u5728\u534a\u652f\u914d\u6811\u4e0a\u7684\u513f\u5b50 $y$\uff0c\u5bb9\u6613\u53d1\u73b0\u5f53\u524d\u5e76\u67e5\u96c6\u4e2d\u7ef4\u62a4\u7684\u6b63\u597d\u5c31\u662f $y$ \u5230 $x$\uff08\u4e0d\u5305\u542b $x$\uff09\u4e2d\u534a\u652f\u914d\u70b9 dfs \u5e8f\u6700\u5c0f\u7684\u70b9\u3002\n\n\u4e0d\u8fc7\u4e00\u4e2a\u95ee\u9898\u662f\uff0c\u5982\u679c\u67e5\u8be2\u51fa\u6765\u7684\u7ed3\u679c\u662f\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u6b64\u65f6\u6211\u4eec\u5e76\u4e0d\u77e5\u9053\u5f97\u5230\u70b9\u7684\u652f\u914d\u70b9\uff0c\u6240\u4ee5\u628a\u5f97\u5230\u70b9\u5148\u5b58\u4e0b\u6765\uff0c\u6700\u540e\u518d\u6309\u7167 dfs \u5e8f\u6b63\u5e8f\u5904\u7406\u4e00\u904d\u5c31\u597d\u4e86\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c\u6211\u4eec\u6bcf\u4e00\u6b21\u90fd\u679a\u4e3e $k$ \u7684\u7236\u4eb2 $x$ \u5728\u534a\u652f\u914d\u6811\u4e2d\u7684\u6240\u6709\u513f\u5b50\uff0c\u4f1a\u5bfc\u81f4\u591a\u6b21\u679a\u4e3e\u4e86\u67d0\u4e9b\u70b9\uff0c\u6240\u4ee5\u6bcf\u6b21\u679a\u4e3e\u5b8c\u4e4b\u540e\u9700\u8981\u5c06\u8fd9\u4e9b\u513f\u5b50\u6e05\u7a7a\u624d\u80fd\u4fdd\u8bc1\u590d\u6742\u5ea6\u6b63\u786e\u3002\u8fd9\u4e5f\u662f\u5927\u90e8\u5206\u9898\u89e3\u590d\u6742\u5ea6\u9519\u8bef\u7684\u539f\u56e0\u3002\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u5df2\u7ecf\u5728 $O(n\\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u5b8c\u6210\u4e86\u652f\u914d\u70b9\u7684\u6c42\u89e3\uff0c\u4e5f\u5c31\u5b8c\u6210\u4e86\u6574\u4e2a Lengauer-Tarjan \u7b97\u6cd5\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\ntypedef long long LL;\n\nconst int N=200000,M=300000;\n\nint n,m;\nstruct side{\n  int y,next;\n}e[M*2+N+9];\nint lin[3][N+9],cs;\n//0\u4e3a\u539f\u56fe\uff0c1\u4e3a\u53cd\u56fe\uff0c2\u4e3a\u534a\u652f\u914d\u6811\n\nvoid Ins(int id,int x,int y){e[++cs].y=y;e[cs].next=lin[id][x];lin[id][x]=cs;}\n\nvoid into(){\n  scanf(\"%d%d\",&n,&m);\n  for (int i=1;i<=m;++i){\n    int x,y;\n    scanf(\"%d%d\",&x,&y);\n    Ins(0,x,y);Ins(1,y,x);\n  }\n}\n\nint dfn[N+9],ord[N+9],co;\nint fa[N+9];\n\nvoid Tarjan(int k){\n  ord[dfn[k]=++co]=k;\n  for (int i=lin[0][k];i;i=e[i].next)\n    if (!dfn[e[i].y]){\n      fa[e[i].y]=k;\n      Tarjan(e[i].y);\n    }\n}\n\nint idom[N+9],sdom[N+9];\nint uni[N+9],mn[N+9];\n\nint Query_uni(int k){\n  if (k==uni[k]) return k;\n  int res=Query_uni(uni[k]);\n  if (dfn[sdom[mn[uni[k]]]]<dfn[sdom[mn[k]]]) mn[k]=mn[uni[k]];\n  return uni[k]=res;\n}\n\nvoid Contract(int st){\n  Tarjan(st);\n  for (int i=1;i<=n;++i) sdom[i]=uni[i]=mn[i]=i;\n  for (int i=co;i>=2;--i){\n    int t=ord[i];\n    for (int i=lin[1][t];i;i=e[i].next){\n      int y=e[i].y;\n      if (!dfn[y]) continue;\n      //\u5982\u679c\u65e0\u6cd5\u5230\u8fbey\u5219\u76f4\u63a5\u8df3\u8fc7\n      Query_uni(y);\n      if (dfn[sdom[mn[y]]]<dfn[sdom[t]]) sdom[t]=sdom[mn[y]];\n    }\n    uni[t]=fa[t];\n    //\u534a\u652f\u914d\u70b9\u7684\u6c42\u89e3\u8fc7\u7a0b\n    Ins(2,sdom[t],t);\n    //\u7ef4\u62a4\u534a\u652f\u914d\u6811\n    for (int i=lin[2][t=fa[t]];i;i=e[i].next){\n      int y=e[i].y;\n      Query_uni(y);\n      idom[y]=t==sdom[mn[y]]?t:mn[y];\n    }\n    //\u652f\u914d\u70b9\u7684\u6c42\u89e3\u8fc7\u7a0b\n    lin[2][t]=0;\n    //\u6e05\u7a7a\u5df2\u626b\u8fc7\u7684\u513f\u5b50\n  }\n  for (int i=2;i<=co;++i){\n    int t=ord[i];\n    if (idom[t]^sdom[t]) idom[t]=idom[idom[t]];\n  }\n  //\u6700\u540e\u7684\u6b63\u5e8f\u626b\u63cf\n}\n\nint ans[N+9];\n\nvoid Get_ans(){\n  for (int i=co;i>=2;--i) ans[idom[ord[i]]]+=++ans[ord[i]];\n  ++ans[1];\n}\n\nvoid work(){\n  Contract(1);\n  Get_ans();\n}\n\nvoid outo(){\n  for (int i=1;i<=n;++i)\n    printf(\"%d \",ans[i]);\n  puts(\"\");\n}\n\nint main(){\n  into();\n  work();\n  outo();\n  return 0;\n}\n```",
        "postTime": 1597580873,
        "uid": 32331,
        "name": "hezlik",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5180 \u3010\u3010\u6a21\u677f\u3011\u652f\u914d\u6811\u3011"
    },
    {
        "content": "# [My Blog](https://www.cnblogs.com/xzyxzy/p/10213341.html)\n**\u706d\u7edd\u6811\u548c\u652f\u914d\u6811\u5e94\u8be5\u662f\u4e00\u79cd\u4e1c\u897f**\n\n\u7528\u4e8e$O((n+m)logn)$\u6216\u8005$O((n+m)\\alpha)$\u6c42\u89e3\u4e00\u7c7b\u5982\u4e0b\u95ee\u9898\uff1a\n\n>\u5728\u4e00\u5f20\u6355\u98df\u56fe\u4e0a\uff08\u4ece\u6355\u98df\u8005\u5411\u88ab\u6355\u98df\u8005\u6709\u8fde\u8fb9\uff09\uff0c\u82e5\u67d0\u751f\u7269\u7684\u6240\u6709\u98df\u7269\u90fd\u706d\u7edd\u4e86\uff0c\u5219\u8be5\u751f\u7269\u706d\u7edd\u3002\n\u706d\u7edd\u6811\u4fbf\u662f\u6b64\u56fe\u7684\u4e00\u79cd\u751f\u6210\u6811\uff0c\u4f7f\u5f97\u6ee1\u8db3\u706d\u7edd\u6811\u4e0a\u67d0\u70b9\u706d\u7edd\uff0c\u8be5\u70b9\u5b50\u6811\u5185\u6240\u6709\u70b9\u90fd\u706d\u7edd\n\n# \u4e8c\u3001\u5b9e\u73b0\u65b9\u5f0f\n\n\u628a\u56fe\u5206\u6210\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\u8003\u8651\n\n## \u6811\n\n\u672c\u8eab\u5c31\u662f\u81ea\u5df1\u7684\u706d\u7edd\u6811\n\n## DAG\n\n- [ZJOI2012]\u707e\u96be \n- [Codeforces757F]Team Rocket Rises Again \n\n\u5206\u4ee5\u4e0b\u51e0\u6b65\n\n- \u6c42\u51faDAG\u7684\u62d3\u6251\u5e8f\n- \u7167\u62d3\u6251\u5e8f\uff0c\u4ece\u51fa\u5ea6\u4e3a0\u7684\u70b9\u5f00\u59cb\uff0c\u67d0\u70b9\u7684\u706d\u7edd\u6811\u4e0a\u7236\u4eb2\u5c31\u662f\u8be5\u70b9\u5728DAG\u4e0a\u7684\u6240\u6709\u51fa\u70b9 \u5728\u706d\u7edd\u6811\u4e0a\u7684LCA\n- \u5982\u679c\u6ca1\u6709\u51fa\u5ea6\uff0c\u8fde\u5411\u4e00\u4e2a\u865a\u62df\u70b90\u65b9\u4fbf\u8ba1\u7b97\n\n\u627eLCA\u7528\u500d\u589e\u5b9e\u73b0\u5373\u53ef\n## \u4e00\u822c\u6709\u5411\u56fe\n\u4f8b\u9898\uff1a[HDU4694 Important Sisters](https://vjudge.net/problem/HDU-4694)\uff1a\u6c42\u4e00\u822c\u56fe\u6bcf\u4e2a\u70b9\u652f\u914d\u6811\u4e0a\u7684\u7956\u5148\u7f16\u53f7\u4e4b\u548c\n\n$orz\\ Tarjan$\n\n\u9996\u5148\u628a\u539f\u56fe$dfs$\u4e00\u904d\uff0c\u6c42\u51fa$dfn$\u5e8f\n### \u534a\u652f\u914d\u70b9\n**\u5b98\u65b9\u5b9a\u4e49\uff1a**$semi[x]=min\\{v |$\u6709\u8def\u5f84$v->v0->v1...->v_k->x$\u4f7f\u5f97$dfn[v_i]>dfn[x]$\u5bf9$1<=i<=k$\u6210\u7acb$\\}$\uff0c$min$\u6307$dfn$\u6700\u5c0f\n\n**\u901a\u4fd7\u4e00\u70b9\uff1a**\u4ece$semi[x]$\u5230$x$\u7684\u8def\u5f84\uff0c\u6390\u5934\u53bb\u5c3e\uff0c\u90fd\u8d70\u7684$dfn$\u5927\u4e8e$x$\u7684\u70b9\n\n\u753b\u4e2a\u56fe\u5927\u6982\u5c31\u662f\u5982\u4e0b\uff0c$dfn[]=\\{0,1,2,3,4,5,7,6\\}$\uff0c$2->6->5$\u6390\u5934\u53bb\u5c3e\u7684$dfn$\u90fd\u5927\u4e8e$dfn[5]$\n![](http://images.cnblogs.com/cnblogs_com/xzyxzy/1374475/o_%E7%81%AD%E7%BB%9D%E6%A0%911.png)\n\n**\u91cd\u8981\u6027\u8d28\uff1a**\n\u4ee5\u4e0b\u7956\u5148\u5173\u7cfb\u5747\u6307$dfs$\u6811\u7684\u7956\u5148\u5173\u7cfb\n\n- 1.\u4e0d\u5728$dfs$\u6811\u4e0a\u7684\u8fb9\u4e00\u5b9a\u662f\u7531$dfn$\u5927\u7684\u70b9\u6307\u5411$dfn$\u5c0f\u7684\u70b9\n- 2.$semi[x]$\u4e00\u5b9a\u662f$x$\u7684\u7956\u5148\n- 3.\u5728$dfs$\u6811\u4e0a\u4ece$semi[x]$\u5411$x$\u8fde\u8fb9\uff0c\u5220\u6389\u5176\u4ed6\u8fb9\uff0c\u706d\u7edd\u5173\u7cfb\u4e0d\u53d8\n\n\u6027\u611f\u5730\u7406\u89e3\u5c31\u662f\uff1a$semi[x]$\u5230$x$\u7684\u8def\u5f84\u76f8\u5f53\u4e8e\u662f\u5728$dfs$\u6811\u5916\u6709\u4e00\u6761\u8def\uff0c\u4e14$semi[x]$\u662f\u79bb\u6839\u6700\u8fd1\u7684\u90a3\u4e2a\u70b9\uff0c\u4ece$semi[x]$\u90fd\u8d70\u4e0d\u5230$x$\u4e86\uff0c\u90a3\u5176\u4ed6\u7684\u70b9\u66f4\u8d70\u4e0d\u5230\u4e86\n\n\u7531\u6b64\u53ef\u4ee5\u5f97\u51fa\u4e00\u79cd\u505a\u6cd5\uff0c\u6c42\u51fa$semi$\u540e\u8f6cDAG\u7684\u505a\u6cd5\uff0c\u590d\u6742\u5ea6$O(nlogn)$\n\n### \u6c42\u534a\u652f\u914d\u70b9\n\u5341\u5206\u7684\u5de7\u5999\n\n\u6309\u7167$dfn$\u5e8f\u4ece\u5927\u5230\u5c0f\u505a\uff0c\u5bf9\u4e8e$x$\uff0c\u679a\u4e3e$R$\u5b58\u5728$R->x$\u8fd9\u6761\u8fb9\n```cpp\nfor(int w=n;w>=2;w--)\n{\n\tint x=id[w],res=n;\n\tfor(int i=rA.head[x];i;i=rA.a[i].next)\n\t{\n\t\tint R=rA.a[i].to;//\u53cd\u56fe\n\t\tif(!dfn[R]) continue;//\u6709\u53ef\u80fdroot\u4e0d\u80fd\u8d70\u5230y\n\t\tif(dfn[R]<dfn[x]) res=min(res,dfn[R]);\n\t\telse find(R),res=min(res,dfn[semi[mn[R]]]);\n\t}\n\t//anc[x]\u8868\u793ax\u5728dfs\u6811\u4e0a\u7684\u7236\u4eb2\n\tsemi[x]=id[res];fa[x]=anc[x];B.link(semi[x],x);\n}\n```\n\u5176\u4e2d$find(R)$\u8868\u793a\u8def\u5f84\u538b\u7f29\u7684\u5e26\u6743\u5e76\u67e5\u96c6\uff0c\u7ef4\u62a4$R$\u5230\u5176\u5df2\u7ecf\u88ab\u641c\u8fc7\u7684\u7956\u5148\u7684 $dfn$\u7684\u6700\u5c0f\u503c$mn[R]$\uff0c\u7528$semi[mn[R]]$\u53bb\u66f4\u65b0$semi[x]$\n\u7136\u540e\u4f8b\u9898\u5c31\u5f97\u5230\u4e86\u4e00\u79cd$O(nlog)$\u7684\u505a\u6cd5\n```cpp#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<queue>\n#include<vector>\n#include<cstring>\n#define pb push_back\nusing namespace std;\nconst int N=3e5+10;\nint n,m,ans[N],dfn[N],id[N],tot,dep[N];\nint anc[N],fa[N],semi[N],mn[N],in[N],ff[20][N];\nint q[N],top;\nqueue<int> Q;\nvector<int> E[N];\nstruct Map\n{\n\tstruct edge {int next,to;}a[N<<1];\n\tint head[N],cnt;\n\tvoid reset() {cnt=0;memset(head,0,sizeof(head));}\n\tvoid link(int x,int y) {a[++cnt]=(edge){head[x],y};head[x]=cnt;}\n}A,rA,B,C;\nvoid reset()\n{\n\tA.reset();rA.reset();B.reset();C.reset();\n\ttot=top=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tdfn[i]=id[i]=ans[i]=in[i]=anc[i]=dep[i]=0;\n\t\tfa[i]=mn[i]=semi[i]=i;\n\t\tE[i].clear();\n\t\tfor(int j=0;j<=18;j++) ff[j][i]=0;\n\t}\n}\nvoid dfs(int x,int fr)\n{\n\tdfn[x]=++tot;id[tot]=x;\n\tanc[x]=fr;B.link(fr,x);\n\tfor(int i=A.head[x];i;i=A.a[i].next)\n\t\tif(!dfn[A.a[i].to]) dfs(A.a[i].to,x);\n}\nvoid dfscalc(int x,int fr)\n{\n\tans[x]=1;\n\tfor(int i=C.head[x];i;i=C.a[i].next)\n\t\tdfscalc(C.a[i].to,x),ans[x]+=ans[C.a[i].to];\n}\nint find(int x)\n{\n\tif(x==fa[x]) return x;\n\tint tt=fa[x];fa[x]=find(fa[x]);\n\tif(dfn[semi[mn[tt]]]<dfn[semi[mn[x]]]) mn[x]=mn[tt];\n\treturn fa[x];\n}\nint LCA(int x,int y)\n{\n\tif(dep[x]<dep[y]) swap(x,y);\n\tint d=dep[x]-dep[y];\n\tfor(int i=18;i>=0;i--) if(d&(1<<i)) x=ff[i][x];\n\tfor(int i=18;i>=0;i--)\n\t\tif(ff[i][x]^ff[i][y])\n\t\t\tx=ff[i][x],y=ff[i][y];\n\treturn x==y?x:ff[0][x];\n}\nvoid Work()\n{\n\tdfs(n,0);\n\tfor(int w=n;w>=2;w--)\n\t{\n\t\tint x=id[w],res=n;\n\t\tif(!x) continue;\n\t\tfor(int i=rA.head[x];i;i=rA.a[i].next)\n\t\t{\n\t\t\tint R=rA.a[i].to;\n\t\t\tif(!dfn[R]) continue;\n\t\t\tif(dfn[R]<dfn[x]) res=min(res,dfn[R]);\n\t\t\telse find(R),res=min(res,dfn[semi[mn[R]]]);\n\t\t}\n\t\tsemi[x]=id[res];fa[x]=anc[x];B.link(semi[x],x);\n\t}\n\n\tfor(int x=1;x<=n;x++)\n\t\tfor(int i=B.head[x];i;i=B.a[i].next)\n\t\t\tin[B.a[i].to]++,E[B.a[i].to].pb(x);\n\tfor(int x=1;x<=n;x++) if(!in[x]) Q.push(x);\n\twhile(!Q.empty())\n\t{\n\t\tint x=Q.front();Q.pop();q[++top]=x;\n\t\tfor(int i=B.head[x];i;i=B.a[i].next)\n\t\t\tif(!--in[B.a[i].to]) Q.push(B.a[i].to);\n\t}\n\tfor(int i=1;i<=top;i++)\n\t{\n\t\tint x=q[i],f=0,l=E[x].size();\n\t\tif(l) f=E[x][0];\n\t\tfor(int j=1;j<l;j++) f=LCA(f,E[x][j]);\n\t\tff[0][x]=f;dep[x]=dep[f]+1;C.link(f,x);\n\t\tfor(int p=1;p<=18;p++) ff[p][x]=ff[p-1][ff[p-1][x]];\n\t}\n\tans[0]=0;dfscalc(n,0);\n}\nint main()\n{\n\tcin>>n>>m;\n\treset();\n\tfor(int i=1,x,y;i<=m;i++)\n\t{\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tx=n-x+1;y=n-y+1;\n\t\tA.link(x,y),rA.link(y,x);\n\t}\n\tWork();\n\tfor(int i=n;i>=1;i--) printf(\"%d \",ans[i]);\n\treturn 0;\n}\n\n\n```\n### \u66f4\u9ad8\u6548\u7684\u505a\u6cd5\nhttps://www.cnblogs.com/fenghaoran/p/dominator_tree.html\n",
        "postTime": 1546693620,
        "uid": 43628,
        "name": "xzyxzy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5180 \u3010\u3010\u6a21\u677f\u3011\u652f\u914d\u6811\u3011"
    },
    {
        "content": "\u770b\u4e86\u8bb8\u591a\u5927\u4f6c\u7684\u8bb2\u89e3\uff0c\u5c31\u7528\u81ea\u5df1\u7684\u8bed\u8a00\u8bf4\u4e00\u904d\uff0c\u53ef\u80fd\u8bb2\u5f97\u4e0d\u597d\uff08\u6bd5\u7adf\u8fd8\u662f\u592a\u83dc\u4e86\uff09\n\n### \u9898\u76ee\u5927\u533b\n\u7ed9\u5b9a\u4e00\u5f20\u6709\u5411\u56fe\uff0c\u6c42\u4ece\u8d77\u70b9\u51fa\u53d1\uff0c\u6c42\u6240\u6709\u70b9\u518d\u53bb\u6389\u7684\u60c5\u51b5\u4e0b\u6709\u591a\u5c11\u4e2a\u70b9\u5230\u8fbe\u4e0d\u4e86\uff08\u5c31\u662f\u652f\u914d\u70b9\u7684\u6982\u5ff5\uff09\u3002\n\n$n\\leq 2\\cdot10^5$ \uff0c $m\\leq 3\\cdot 10^5$\n\n### \u524d\u80a2\u5047\u60f3\n\u6839\u636e\u9898\u76ee\uff0c\u6211\u4eec\u4ee5\u6b64\u6765\u5efa\u4e00\u4e2a\u6811\uff0c\u79f0\u4e4b\u4e3a\u201c\u652f\u914d\u6811\u201d\n\n\u6ee1\u8db3\u201c\u652f\u914d\u6811\u201d\u8981\u6ee1\u8db3\u8fd9\u4e9b\u6027\u8d28\uff1a\n\n1.\u8fd9\u662f\u4e00\u4e2a\u6811\uff08\u800c\u4e0d\u662f\u56fe\uff09\uff0c\u6839\u8282\u70b9\u5c31\u662f\u8d77\u70b9\uff1b\n\n2.\u5bf9\u4e8e\u4efb\u610f\u70b9 $u$ \uff0c\u4ece\u6839\u5230\u5b83\u7684\u7b80\u5355\u8def\u5f84\u4e0a\u7684\u6240\u6709\u70b9\u90fd\u662f\u5b83\u7684\u652f\u914d\u70b9\uff1b\n\n3.\u5bf9\u4e8e\u4efb\u610f\u70b9 $u$ \uff0c\u5b83\u652f\u914d\u5b83\u7684\u5b50\u6811\u4e0a\u6240\u6709\u7684\u5b50\u5b59\u8282\u70b9\u3002\n\n\u5982\u679c\u80fd\u8fd9\u6837\u9020\u51fa\u6765\uff0c\u95ee\u9898\u5c31\u89e3\u51b3\u4e86\u3002\n\n### \u524d\u80a2\u5f15\u5165\n$Lengauer-Tarjan$ \u7b97\u6cd5\n\n\u54ea\u91cc\u90fd\u6709 Tarjan \u8001\u7237\u5b50\u3002\u3002\u3002 Tarjan orz \uff01\n\n$Lengauer-Tarjan$ \u7b97\u6cd5\u4e3b\u8981\u5206\u4e86\u4e09\u4e2a\u6b65\u9aa4\uff1a\n\n1.\u4ece\u8d77\u70b9\u5f00\u59cb\u9020 $dfs$ \u6811\u5e76\u6c42\u51fa\u6240\u6709\u70b9\u7684 $dfn$ \uff1b\n\n2.\u6c42\u51fa\u6240\u6709\u70b9\u7684\u534a\u652f\u914d\u70b9\uff1b\uff08\u6682\u8bbe\u6570\u7ec4 $semi(i)$ \uff09\n\n3.\u6c42\u51fa\u6240\u6709\u70b9\u7684\u652f\u914d\u70b9\u3002\uff08\u6682\u8bbe\u6570\u7ec4 $idom(i)$ \uff09\n\n\u5176\u4e2d\u534a\u652f\u914d\u70b9\u662f\u4e00\u4e2a\u65b0\u6982\u5ff5\uff0c\u4e5f\u662f\u95f4\u63a5\u6c42\u652f\u914d\u70b9\u7684\u7cbe\u9ad3\u3002\n\n\u5bf9\u4e8e\u4efb\u610f\u70b9 $u$ \u7684\u534a\u652f\u914d\u70b9\u8868\u793a\u6240\u6709\u70b9\u4e2d\u6709 dfn \u6700\u5c0f\u7684\u70b9 $v$ \uff0c\u80fd\u4f7f $v$ \u6ee1\u8db3\u6709\u4e00\u6761\u8def\u5f84\u80fd\u591f\u5230\u8fbe u \u4e14\u8def\u5f84\u4e0a\u7684\u6240\u6709\u70b9\uff08 $u$ \u548c $v$ \u90fd\u4e0d\u7b97\uff09\u7684 $dfn$ \u90fd\u5927\u4e8e $dfn(u)$ \u3002\n\n### \u732a\u8e44\u5185\u5bb9\n\u5c31\u53ea\u8bb2\u8bb2\u4e00\u822c\u6709\u5411\u56fe\u5427\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u89e3\u51b3\u4e86\u5176\u4ed6\u7684\u5c31\u90fd\u89e3\u51b3\u4e86\uff08\u5982\u6811\uff0c DAG \uff09\u3002\n\n### \u4e1d~~\u7ef8\u4e4b~~\u8def\u7684\u8bde\u751f\u4e4b\u534a\u652f\u914d\u70b9\n\u8bbe\u76ee\u524d\u6211\u4eec\u5728\u7814\u7a76\u70b9 $u$ \uff0c\u90a3\u4e48\u518d\u8bbe\u70b9 $v$ \u6307\u6240\u6709\u76f4\u63a5\u8fde\u5411 $u$ \u7684\u70b9\u3002\n\n**\u5206\u7c7b\u8ba8\u8bba**\uff08\u738b\u9053\uff01\uff09\n\n1.$dfn(v)=dfn(u)$\n\n\u76f4\u63a5\u65e0\u89e3\u3002\u3002\u8df3\u8fc7\u3002\n\n2.$dfn(v)<dfn(u)$\n\n\u5982\u679c\u8981\u4ece\u8fd9\u6761\u8def\u5f84\u4e0a\u8d70\u7684\u8bdd\uff0c\u521a\u5f00\u59cb\u5c31\u7ed3\u675f\u4e86\uff08\u6839\u636e\u5b9a\u4e49\u6765\uff09\uff0c\u6240\u4ee5\u628a $v$ \u548c\u53ef\u80fd\u5b58\u5728\u7684 $semi(u)$ \u62e9\u4f18\u66f4\u65b0\u5c31\u597d\u4e86\u3002\n\n3.$dfn(v)>dfn(u)$\n\n\u90a3\u4e48\u5c31\u5728 $dfs$ \u6811\u4e0a\u4ece $v$ \u627e\u4e00\u4e2a\u7956\u5148 $w$ \u4e14 $dfn(w)>dfn(u)$ \uff0c\u7136\u540e\u5c31\u628a\u53ef\u80fd\u5b58\u5728\u7684 $semi(w)$ \u548c\u53ef\u80fd\u5b58\u5728\u7684 $semi(u)$ \u62e9\u4f18\u66f4\u65b0\u3002\n\n\u56e0\u4e3a\u65e2\u7136\u6709\u4e86 $semi(w)$ \uff0c\u8fd9\u4e00\u6bb5\u8def\u5f84\u4e0a\u6240\u6709 $dfn$ \u90fd\u5927\u4e8e $dfn(u)$ \uff08\u5b9a\u4e49\u6765\u7684\uff09\uff0c $w$ \u53c8\u662f\u4ece $semi(u)$ \u5230 $u$ \u7684\u8def\u5f84\u4e0a\u641c\u5230\u7684\uff0c\u6240\u4ee5 $w$ \u4e4b\u540e\u7684\u70b9\u4e5f\u6ee1\u8db3\u3002\n\n\uff08\u4e0d\u662f\u5f88\u61c2\uff1f\uff1f\u6b63\u5e38\uff0c\u6211\u4e5f\u6709\u70b9\u4e91\u91cc\u96fe\u91cc\u7684\uff08\u5c31\u7b97\u660e\u767d\u4e86\uff0c\u4e00\u4f1a\u4e5f\u5c31\u5fd8\u4e86\uff09\uff0c\u4f46\u5173\u952e\u597d\u80cc\uff01\uff01\uff09\n\n\u81f3\u6b64\uff0c\u534a\u652f\u914d\u70b9\u5b8c\u7ed3\uff01\n\n### \u4e1d~~\u7ef8\u4e4b~~\u8def\u7684\u8bde\u751f\u4e4b\u652f\u914d\u70b9\n\u8003\u8651\u5728\u534a\u652f\u914d\u70b9\u7684\u80a9\u8180\u4e0a\u6c42\u51fa\u652f\u914d\u70b9\u3002\n\n\u8bbe\u76ee\u524d\u6211\u4eec\u5728\u7814\u7a76\u70b9 $u$ \u3002\n\n\u7136\u540e\u8bb0\u4e00\u4e2a\u70b9\u96c6 $\\large\\xi$ \u8868\u793a\u5728 $dfs$ \u6811\u4e0a\u4ece $semi(u)$ \u5230 $u$ \u7684\u8def\u5f84\u7684\u70b9\u96c6\uff0c\uff08\u4f46\u4e0d\u5305\u62ec $semi(u)$ \uff09\u5176\u4e2d\u70b9 $\\alpha$ \u662f $\\large\\xi$ \u4e2d $dfn(semi)$ \u6700\u5c0f\u7684\u70b9\u3002\n\n\u90a3\u4e48\uff0c**\u5206\u7c7b\u8ba8\u8bba**\uff08\u738b\u9053\uff01\uff09\n\n\uff08\u80af\u5b9a\u662f\u5224\u65ad $semi$ \u76f8\u7b49\u800c\u4e0d\u662f\u6bd4\u8f83 $dfn$ \u5927\u5c0f\u4e86\u5440\uff09\n\n1.$semi(\\alpha)=semi(u)$\n\n\u5219 $idom(u)=semi(u)$ \u3002\n\n\u56e0\u4e3a $\\alpha$ \u5df2\u7ecf\u662f $semi(u)$ \u5230 $u$ \u8def\u5f84\u4e2d\u6240\u6709\u70b9\u7684\u4e0b\u9650\uff08 $dfn(semi)$ \uff09\u4e86\uff0c\u5982\u82e5\u5f53\u524d\u60c5\u51b5\u5c31\u662f $\\large\\xi$ \u6210\u4e86\u4e2a\u5c01\u95ed\u7684\u70b9\u96c6\uff0c $semi(u)$ \u662f\u552f\u4e00\u76f4\u63a5\u76f8\u8fde\u7684\u70b9\uff0c\u81ea\u7136\u5c31\u6709\u4e86 $idom(u)=semi(u)$ \u3002\n\n2.$semi(\\alpha)\\neq semi(u)$\n\n\u5219 $idom(u)=idom(\\alpha)$ \u3002\n\n\u611f\u6027\u7406\u89e3\uff1a\n\n\u5018\u82e5\u6709\u8fd9\u4e48\u4e00\u4e2a\u201c\u4e2d\u95f4\u70b9\u201d $\\beta$ \u3002\n\n\u6211\u4eec\u5047\u8bbe\u6ca1\u6709\u4e86 $idom(\\alpha)$ \uff0c $u$ \u8fd8\u53ef\u4ee5\u80fd\u591f\u5230\u8fbe\u3002\u90a3\u4e48\u8bf4\u660e $idom(\\alpha)$ \u7956\u5148\u4f1a\u6709\u4e00\u4e2a\u70b9\u6709\u4e00\u6761\u975e $dfs$ \u6811\u8fb9\u8fde\u5411\u4e86 $idom(\\alpha)$ \u548c $u$ \u4e2d\u95f4\u7684\u4e00\u4e2a\u70b9 $\\beta$ \u3002\n\n\u5176\u4e2d\uff0c $\\alpha$ \u5fc5\u662f $\\beta$ \u7684\u7956\u5148\uff0c\u5426\u5219\u6ca1\u6709\u4e86 $idom(\\alpha)$ \u4e5f\u80fd\u5230\u8fbe $\\alpha$ \uff0c\u663e\u7136\u4e0e\u5b9a\u4e49\u4e0d\u7b26\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/0goksvl8.png)\n\n\u5982\u82e5\u5982\u6b64\uff0c $\\beta$ \u4fbf\u4e00\u5b9a\u5728 $\\large\\xi$ \u4e2d\u4e86\u3002\n\n\u770b\u5f97\u51fa\u6765\uff0c $semi$ \u7684\u8981\u6c42\u6bd4 $idom$ \u9ad8\u4e00\u4e9b\uff0c\u4ece\u6ee1\u8db3\u6761\u4ef6\u7684\u96be\u5ea6\u4e0a\uff0c\u6240\u4ee5 $dfn(idom(\\alpha))\\leq dfn(semi(\\alpha))$ \u663e\u7136\u3002\uff08\u8bb0\u4f4f\uff0c\u8fd9\u662f\u611f\u6027\u3002\u3002\uff09\n\n\u4f46 $idom(\\alpha)$ \u7684\u7956\u5148\u6709\u4e00\u6761\u975e $dfs$ \u6811\u8fb9\u8fde\u5411\u4e86 $\\beta$ \uff0c\u6240\u4ee5\u65e0\u8bba\u5982\u4f55 $dfn(semi(\\beta))<dfn(idom(\\alpha))$ \u3002\n\n\u7ed3\u5408\u4e0a\u9762\u7684\u4e24\u6bb5\u5185\u5bb9\uff0c\u53d1\u73b0\u4f1a\u4e0e $\\large\\xi$ \u5173\u4e8e $\\alpha$ \u7684\u5b9a\u4e49\u4e0d\u7b26\u4e86\u3002\u6240\u4ee5\u6ca1\u6709\u4e86 $idom(\\alpha)$ \uff0c $u$ \u4e00\u5b9a\u4e0d\u80fd\u591f\u5230\u8fbe\u3002\n\n\u81f3\u6b64\uff0c\u652f\u914d\u70b9\u5b8c\u7ed3\uff01\n\n### \u4ece\u4e1d~~\u7ef8\u4e4b~~\u8def\u5230\u5b9e\u9645\u5b9e\u73b0\n1.\u534a\u652f\u914d\u70b9\n\n\u5982\u679c\u8fd8\u6709\u70b9\u5370\u8c61\u7684\u8bdd\uff0c\u5e94\u8be5\u80fd\u77e5\u9053\u6c42\u89e3\u8fc7\u7a0b\u90fd\u662f dfn \u4ece\u5927\u5230\u5c0f\u7684\u9006\u63a8\uff0c\u6240\u4ee5\u53ef\u4ee5\u5012\u5e8f dfn \u5904\u7406\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\u60c5\u51b5\uff08\u7b2c\u4e00\u4e2a\u5c31\u3002\u3002\uff09\u76f4\u63a5\u5e72\uff0c\u800c\u7b2c\u4e09\u79cd\u60c5\u51b5\uff0c\u80af\u5b9a\u662f\u4e0d\u4f1a\u66b4\u529b\u679a\u4e3e\u7684\u3002\n\n\u4e8e\u662f\u8003\u8651\u4e00\u4e2a\u5e26\u6743\u5e76\u67e5\u96c6\uff08\u8bf4\u7684\u597d\u50cf\u8981\u600e\u4e48\u6837\uff0c\u4f46\u4ee3\u7801\u5c31\u662f\u597d\u80cc\uff09\uff0c\u6bcf\u6b21\u5904\u7406\u5b8c\u4e00\u4e2a\u70b9\uff0c\u5c31\u5f80\u5b83\u5728 dfs \u6811\u4e0a\u7684\u70b9\u5408\u5e76\uff0c\u6309\u7167\u652f\u914d\u70b9\u4e2d $\\large\\xi$ \u7684\u8981\u6c42\u7ef4\u62a4\u5bf9\u5e94\u7684\u4e1c\u897f\u3002\n\n2.\u652f\u914d\u70b9\n\n\u5f88\u591a\u8f85\u52a9\u4e1c\u897f\u90fd\u4e0e\u534a\u652f\u914d\u70b9\u4e00\u5e76\u6574\u597d\u4e86\uff0c\u53ea\u9700\u8981\u628a\u5df2\u7ecf\u6c42\u7684 semi \u4e0e\u5bf9\u5e94\u7684\u70b9\u8fde\u8fb9\uff0c\u6784\u9020\u534a\u652f\u914d\u6811\uff0c\u5c31\u80fd\u540c\u65f6\u6c42\u89e3\u652f\u914d\u70b9\u3002\n\n\u7531\u4e8e\u53ef\u80fd\u5b58\u5728\u641c\u7d22\u7684\u65f6\u5019 idom \u5e76\u672a\u627e\u5230\uff0c\u53ef\u4ee5\u5148\u8bb0\u5f55\u4e0b\u6765\uff0c\u6700\u540e\u987a\u5e8f dfn \u518d\u989d\u5916\u5904\u7406\u3002\n\n\u6709\u4e00\u4e2a\u5c0f\u6ce8\u610f\u53ef\u89c1[\u8fd9\u4f4d\u5927\u4f6c\u5728\u4ee3\u7801\u4e0a\u65b9\u7684\u8bb2\u8ff0](https://www.luogu.com.cn/blog/hezlik/solution-p5180)\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log_{2}{n})$ \uff0c\u4f18\u96c5\u7684\u8be0\u91ca\u4e86$Lengauer-Tarjan$ \u7b97\u6cd5\u7684\u4f18\u8d8a\u6027\u3002\n\n\uff08\u6ca1\u529e\u6cd5\uff0c Tarjan \u8001\u7237\u5b50\u5c31\u8fd9\u4e48\u5389\u5bb3\u3002\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=2e5+10,M=3e5+10;\nint n,m,ans[N],tot;\nint fst[N][3],nxt[M+M+N],to[M+M+N];\nint dfn[N],ord[N],cnt,fth[N];\nint idom[N],semi[N],uni[N],mn[N];\ninline ll read()\n{\n\tll s=0,w=1;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n\treturn s*w;\n}\ninline void add(int u,int v,int id)\n{\n\tnxt[++tot]=fst[u][id];\n\tto[tot]=v,fst[u][id]=tot;\n}\ninline void Tarjan(int u)\n{\n\tord[dfn[u]=++cnt]=u;\n\tfor(int i=fst[u][0];i;i=nxt[i])\n\t{\n\t\tint v=to[i];\n\t\tif(!dfn[v])\n\t\t{\n\t\t\tfth[v]=u;\n\t\t\tTarjan(v);\n\t\t}\n\t}\n}\ninline int uni_query(int u)\n{\n\tif(u==uni[u])return u;\n\tint tmp=uni_query(uni[u]);\n\tif(dfn[semi[mn[u]]]>dfn[semi[mn[uni[u]]]])mn[u]=mn[uni[u]];\n\treturn uni[u]=tmp;\n}\ninline void Lengauer_Tarjan(int s)\n{\n\tTarjan(s);\n\tfor(int i=1;i<=n;++i)semi[i]=uni[i]=mn[i]=i;\n\tfor(int id=cnt;id>=2;--id)\n\t{\n\t\tint u=ord[id];\n\t\tfor(int i=fst[u][1];i;i=nxt[i])\n\t\t{\n\t\t\tint v=to[i];\n\t\t\tif(!dfn[v])continue;\n\t\t\tuni_query(v);\n\t\t\tif(dfn[semi[u]]>dfn[semi[mn[v]]])semi[u]=semi[mn[v]];\n\t\t}\n\t\tuni[u]=fth[u];\n\t\tadd(semi[u],u,2);\n\t\tu=fth[u];\n\t\tfor(int i=fst[u][2];i;i=nxt[i])\n\t\t{\n\t\t\tint v=to[i];\n\t\t\tuni_query(v);\n\t\t\tidom[v]=(u==semi[mn[v]]?u:mn[v]);\n\t\t}\n\t\tfst[u][2]=0;\n\t}\n\tfor(int i=2;i<=cnt;++i)\n\t{\n\t\tint u=ord[i];\n\t\tif(idom[u]^semi[u])\n\t\tidom[u]=idom[idom[u]];\n\t}\n}\nint main()\n{\n\tn=read(),m=read();\n\tfor(int i=1;i<=m;++i)\n\t{\n\t\tint x=read(),y=read();\n\t\tadd(x,y,0),add(y,x,1);\n\t}\n\tLengauer_Tarjan(1);\n\tfor(int i=cnt;i>=2;--i)ans[idom[ord[i]]]+=(++ans[ord[i]]);\n\t++ans[1];\n\tfor(int i=1;i<=n;++i)printf(\"%d \",ans[i]);\n\treturn 0;\n}\n```\n\u53ea\u6c42\u80fd\u5e2e\u52a9\u5230\u51e0\u4e2a\u4eba\u7f62\u3002\u3002",
        "postTime": 1618648284,
        "uid": 206024,
        "name": "Illusory_dimes",
        "ccfLevel": 7,
        "title": "\u3010\u6a21\u677f\u3011\u652f\u914d\u6811 \u9898\u89e3"
    },
    {
        "content": "# \u652f\u914d\u6811 \u5b66\u4e60\u7b14\u8bb0\n\n\u7ed9\u5b9a\u4e00\u5f20\u6709\u5411\u56fe\uff0c\u8bbe\u5b9a\u6e90\u70b9\u4e3a $s$\uff0c\u5219\u4ece $s$ \u51fa\u53d1\u5230 $x$ \u5fc5\u987b\u7ecf\u8fc7\u7684\u70b9\uff08\u4e0d\u5305\u62ec $x$\uff09\u79f0\u4e3a\u652f\u914d\u70b9\u3002\uff08\u542b\u4e0d\u542b\u81ea\u5df1\u5f71\u54cd\u4e0d\u5927\uff0c\u7075\u6d3b\u5904\u7406\u5c31\u597d\uff09\n\n\u82e5 $a$ \u652f\u914d $b$\uff0c\u5219 $a$ \u662f $b$ \u7684\u652f\u914d\u70b9\uff0c\u5728\u56fe\u4e2d\u5220\u53bb $a$ \u70b9\u540e\u4e0d\u80fd\u4ece $s$ \u5230\u8fbe $b$\u3002\n\n\u652f\u914d\u5173\u7cfb\u662f\u4f20\u9012\u7684\u3001\u53cd\u5bf9\u79f0\u7684\u3002\n\n\u82e5 $b$ \u652f\u914d $a$\uff0c\u4e14 $c$ \u652f\u914d $a$\uff0c\u5fc5\u7136\u6709 $b$ \u652f\u914d $c$ \u6216\u8005 $c$ \u652f\u914d $b$\u3002\u663e\u7136\u4e00\u4e2a\u70b9\u7684\u6240\u6709\u652f\u914d\u70b9\u53ef\u4ee5\u6784\u6210\u4e00\u4e2a\u94fe\uff0c\u6240\u6709\u70b9\u4e0e\u5176\u6700\u8fd1\u652f\u914d\u70b9\u8fde\u7ebf\u53ef\u4ee5\u6784\u6210\u4e00\u4e2a\u6811\u3002\n\n\u4ee5\u4e0b\u7684\u8ba8\u8bba\u5efa\u7acb\u5728\u67d0\u4e00\u9897dfs\u6811\u4e0a\u3002\u5f3a\u70c8\u5efa\u8bae\u9605\u8bfb\u65f6\u81ea\u5df1\u753b\u753b\u8349\u56fe\u793a\u610f\u3002\n\n\u5b9a\u4e49 $\\operatorname{idom}_{x}$ \u8868\u793a $x$ \u7684\u6700\u8fd1\u652f\u914d\u70b9\uff0c \u4e5f\u662f\u6df1\u5ea6\u6700\u5927\u7684\u3002\u5b9a\u4e49 $\\operatorname{semi}_x$ \u8868\u793a $x$ \u7684\u534a\u652f\u914d\u70b9\u3002\u534a\u652f\u914d\u70b9 $\\operatorname{semi}_x$ \u4e3a $\\operatorname{dfn}$ \u6700\u5c0f\u7684\u70b9 $y$\uff0c\u6ee1\u8db3\u5b58\u5728\u4e00\u6761\u8def\u5f84 $(y,v_1,v_2,\\cdots,v_c,x)$ \u4f7f\u5f97 $\\forall i\\in\\{1,2,\\cdots,c\\}$\uff0c$\\operatorname{dfn}[v_i]> \\operatorname{dfn}[x]$\u3002\n\n\n\n$\\operatorname{semi}_x$ \u7684\u4e00\u79cd\u542b\u4e49\u662f\uff0c\u5728\u53cd\u56fe\u4e0a\uff0c\u5728\u4ece $x$ \u51fa\u53d1\uff0c\u53ea\u9014\u7ecf\uff08\u4e0d\u5305\u62ec\u7aef\u70b9\uff09 $\\operatorname{dfn}$ \u5927\u4e8e $\\operatorname{dfn}[x]$ \u7684\u70b9\u80fd\u5230\u8fbe\u7684 $\\operatorname{dfn}$ \u6700\u5c0f\u7684\u70b9\u3002\n\n\n\n#### \u534a\u652f\u914d\u70b9\u7684\u6027\u8d28\uff1a\n\n* \u6bcf\u4e2a\u70b9\u7684 $\\operatorname{semi}$ \u7684\u552f\u4e00\u7684\u3002\uff08 $\\operatorname{dfn}$ \u7684\u6709\u5e8f\u6027\uff09\n* $\\operatorname{semi}_x$ \u662f $x$ \u5728dfs\u6811\u4e0a\u7684\u7956\u5148\u3002\n  \u8bc1\u660e\uff1a\u9996\u5148\u8bc1\u660e $\\operatorname{dfn}[\\operatorname{semi}_x]<\\operatorname{dfn}[x]$\u3002\u8003\u8651\u4e00\u4e2a\u70b9 $y$\uff0c$\\operatorname{dfn}[y]>\\operatorname{dfn}[x]$\uff0c\u5b58\u5728\u4e00\u6761\u6ee1\u8db3\u6761\u4ef6\u7684\u8def\u5f84\uff0c\u90a3\u4e48 $y$ \u7684\u7236\u8282\u70b9\u4e5f\u6ee1\u8db3\u6761\u4ef6\u3002\u5982\u679c\u7236\u8282\u70b9\u7684 $\\operatorname{dfn}$ \u4ecd\u5927\u4e8e $\\operatorname{dfn}[x]$\uff0c\u91cd\u590d\u627e\u7236\u8282\u70b9\u5373\u53ef\u3002\u518d\u8bc1\u660e\uff0c\u82e5 $\\operatorname{dfn}[y]<\\operatorname{dfn}[x]$ \u4e14 $y$ \u4e0d\u662f $x$ \u7684\u7956\u5148\uff0c\u4e00\u5b9a\u4e0d\u5b58\u5728\u6ee1\u8db3\u8be5\u6761\u4ef6\u7684\u8def\u5f84\u3002\u53cd\u8bc1\u6cd5\uff0c\u82e5\u5b58\u5728\u8def\u5f84\uff0c\u5219dfs\u8fc7\u7a0b\u4e2d\uff0c$y$ \u8282\u70b9\u56de\u6eaf\u524d\uff0c\u5df2\u8bbf\u95ee\u8fc7 $x$\uff0c$x$ \u5728 $y$ \u5b50\u6811\u5185\u3002\n* \u5982\u679c\u6709\u8fb9 $(y,x)$\uff0c\u4e14 $\\operatorname{dfn}[x]<\\operatorname{dfn}[y]$\uff0c\u6709 $\\operatorname{dfn}[\\operatorname{semi}_x]\\le \\operatorname{dfn}[\\operatorname{semi}_y]$\u3002\n\n\n\n#### \u534a\u652f\u914d\u70b9\u548c\u652f\u914d\u70b9\u7684\u5173\u7cfb\n\n* $\\operatorname{semi}_x$ \u4e0d\u4e00\u5b9a\u662f $\\operatorname{idom}_x$\u3002\n* $\\operatorname{idom}_x$ \u5728 $\\operatorname{semi}_x$ \uff08\u542b\uff09\u5230\u6839\u8282\u70b9\u7684\u94fe\u4e0a\u3002\n* \u5229\u7528 $\\operatorname{semi}$ \u6c42 $\\operatorname{idom}$\u3002\uff08\u4e0d\u7136\u4e3a\u4ec0\u4e48\u5f15\u5165\u534a\u652f\u914d\u70b9\u7684\u6982\u5ff5\uff01\uff09\n\n\n\n#### \u5982\u4f55\u6c42 $\\operatorname{idom}$ \uff1f\n\n\u5728 dfs \u6811\u4e0a\uff0c\u62bd\u51fa $\\operatorname{semi}_x$ \u5230 $x$ \u7684\u94fe\uff08\u4e0d\u542b\u7aef\u70b9\uff09\u3002\n\n\u8bbe\u5176\u4e2d $z$ \u70b9\u7684 $\\operatorname{semi}$ \u7684 $\\operatorname{dfn}$ \u6700\u5c0f\u3002\u5fc5\u6709 $\\operatorname{dfn}[\\operatorname{semi}_z]\\le \\operatorname{dfn}[\\operatorname{semi}_x]$ \uff0c\u56e0\u4e3a\u94fe\u4e0a\u7b2c\u4e00\u4e2a\u70b9\u7684 $\\operatorname{semi}$ \u53ea\u53ef\u80fd\u662f $\\operatorname{semi}_x$ \u53ca\u5176\u7956\u5148\u3002\n\n* \u5982\u679c $\\operatorname{semi}_z = \\operatorname{semi}_x$\uff0c\u90a3\u4e48 $\\operatorname{idom}_x=\\operatorname{semi}_x$\u3002\n* \u5982\u679c $\\operatorname{dfn}[\\operatorname{semi}_z]<\\operatorname{dfn}[\\operatorname{semi}_x]$\uff0c\u90a3\u4e48 $\\operatorname{idom}_x=\\operatorname{idom}_z$\u3002\n  \u8bc1\u660e\uff1a\n  \u56e0\u4e3a $\\operatorname{dfn}[\\operatorname{semi}_z]<\\operatorname{dfn}[\\operatorname{semi}_x]$ \uff0c\u6240\u4ee5\u4ece $\\operatorname{semi}_z$ \u5230 $z$ \u4e0d\u9700\u8981\u7ecf\u8fc7 $\\operatorname{semi}_x$\u3002$z$ \u80fd\u5230\u8fbe $x$\uff0c\u6240\u4ee5\u5b58\u5728\u8def\u5f84\u4e0d\u7ecf\u8fc7 $\\operatorname{semi}_x$\uff0c\u6545 $\\operatorname{semi}_x$ \u4e0d\u662f $x$ \u7684\u652f\u914d\u70b9\u3002\u540c\u7406\uff0c\u4ece $\\operatorname{semi}_x$\uff08\u542b\uff09\u5230 $\\operatorname{semi}_z$\uff08\u4e0d\u542b\uff09\u94fe\u4e0a\u6bcf\u4e00\u70b9\u90fd\u4e0d\u662f\u652f\u914d\u70b9\u3002\n  \u6b64\u540e\uff0c\u628a $\\operatorname{semi}_x$ \u5230 $\\operatorname{semi}_z$ \u8fd9\u6bb5\u4e5f\u62bd\u51fa\u6765\u8003\u8651\uff0c\u91cd\u590d\u4e0a\u8ff0\u8fc7\u7a0b\u3002\u7a0d\u52a0\u601d\u7d22\u5f52\u7eb3\u5c31\u4f1a\u53d1\u73b0\uff0c\u5bf9 $x$ \u548c $z$ \u7684\u652f\u914d\u70b9\u4ea7\u751f\u5f71\u54cd\u7684\u662f\u540c\u4e00\u6761\u94fe\uff0c\u6545 $\\operatorname{idom}_x=\\operatorname{idom}_z$\u3002\n\n\n#### \u5982\u4f55\u6c42 $\\operatorname{semi}$ \uff1f\n\n\u8003\u8651\u6709\u4e00\u6761\u8fb9\uff08\u4e0d\u662f\u8def\u5f84\uff09$(y,x)$\u3002\n\n* \u5982\u679c $\\operatorname{dfn}[y] < \\operatorname{dfn}[x]$\uff0c$y$ \u662f\u5b83\u53ef\u80fd\u7684\u534a\u652f\u914d\u70b9\u3002\n* \u5982\u679c $\\operatorname{dfn}[y] > \\operatorname{dfn}[x]$\uff0c\u8bf7\u4e0a\u53bb\u56de\u770b\u4e00\u4e0b\u542b\u4e49\uff0c\u5f52\u7ed3\u8d77\u6765\u662f $y$ \u5230\u6839\u94fe\u4e0a\u6240\u6709 $\\operatorname{dfn}$ \u5927\u4e8e $\\operatorname{dfn}[x]$ \u7684\u70b9\u7684 $\\operatorname{semi}$ \uff08\u8fd9\u6837\u80fd\u8986\u76d6\u6240\u6709\u60c5\u51b5\uff0c\u800c\u4e14\u4e5f\u6ca1\u6709\u4e0d\u7b26\u5408\u7684\u60c5\u51b5\uff09\u3002\n\n\n\n#### \u5177\u4f53\u7b97\u6cd5\uff1aLengauer Tarjan\n\n##### \u6c42 $\\operatorname{semi}$\n\n\u53d1\u73b0\u5f71\u54cd\u70b9 $x$ \u7684\uff0c\u7b2c\u4e00\u7c7b\u76f4\u63a5\u66f4\u65b0\uff0c\u7b2c\u4e8c\u7c7b\u90fd\u6ee1\u8db3 $\\operatorname{dfn}[y]>\\operatorname{dfn}[x]$\u3002\n\n\u505a\u6cd5\u662f\u9006\u7740dfs\u5e8f\u6765\uff0c\u7136\u540e\u8003\u8651\u5b8c\u4e00\u4e2a\u70b9\uff0c\u628a\u5b83\u7684 $\\operatorname{semi}$ \u4fe1\u606f\u5408\u5e76\u5230\u4ed6\u7684\u7236\u8282\u70b9\u4e0a\u3002\u7528\u5e26\u6743\u5e76\u67e5\u96c6\u7ef4\u62a4\uff0c\u6bcf\u4e2a\u70b9\u7684\u6743\u503c\u4e3a\u5230\u6839\u7684\u8def\u5f84\u4e0a\u7684min\u3002\n\n\u6c42 $\\operatorname{semi}_x$ \u65f6\uff0c\u5bf9\u4e8e\u4e00\u6761\u5165\u8fb9 $(y,x)$ \u4e14 $\\operatorname{dfn}[x]<\\operatorname{dfn}[y]$ \u7684\u60c5\u51b5\uff0c\u67e5\u8be2 $y$ \u5728\u5e76\u67e5\u96c6\u4e2d\u7684\u6743\u3002\n\n##### \u6c42 $\\operatorname{idom}$\n\n\u6c42 $\\operatorname{idom}$ \u65f6\u6709\u64cd\u4f5c\u662f\u67e5\u8be2\u4e00\u6761\u94fe\u4e0a\u7684\u6700\u5c0f $\\operatorname{semi}$\uff0c\u4e00\u4e2a\u663e\u7136\u7684\u601d\u8def\u662f\u6811\u5256... \u4f46\u8fd9\u6837\u4e0d\u4f18\u96c5\u3002\u53d1\u73b0\u53ef\u4ee5\u7528\u6c42 $\\operatorname{semi}$ \u65f6\u7684\u90a3\u4e2a\u5e76\u67e5\u96c6\u6765\u505a\u3002\n\n\u5f53\u6c42 $\\operatorname{semi}$ \u7684\u8fc7\u7a0b\u63a8\u8fdb\u5230\u70b9 $x$ \u7684 $\\operatorname{semi}_x$ \u65f6\uff0c\u5728\u5e76\u67e5\u96c6\u4e0a\u6c42 $x$ \u7684\u503c\u5c31\u662f\u6c42 $x$ \u5230 $\\operatorname{semi}_x$ \u8fd9\u4e2a\u94fe\u4e0a\u6700\u5c0f\u503c\u3002\u6545\u6c42 $\\operatorname{idom}$ \u548c\u6c42 $\\operatorname{semi}$ \u540c\u65f6\u8fdb\u884c\uff0c\u628a\u6c42 $\\operatorname{idom}_x$ \u8fd9\u4ef6\u4e8b\u653e\u5230\u6c42 $\\operatorname{semi}_{\\operatorname{semi}_x}$ \u65f6\u3002\n\n\n\n\u5177\u4f53\u770b\u4ee3\u7801\u5427\n\n```cpp\n#include <cstdio>\n#include <queue>\nint const maxn = 200003, maxm = 300003;\n\ntemplate<int N, int M>\nstruct Graph {\n\tint head[N], nxt[M], to[M], cnt;\n\tvoid insert(int u, int e) { nxt[++cnt] = head[u]; head[u] = cnt; to[cnt] = e; }\n\tvoid clear(int n) { cnt = 0; for (int i = 0; i <= n; ++i) head[i] = 0;}\n};\n\nint n = 0, m = 0;\n\nGraph<maxn, maxm> G, F;\nGraph<maxn, maxn> T;\n\nint fa[maxn], dfn[maxn], idfn[maxn], cdfn = 0;\nint semi[maxn], idom[maxn];\n\nvoid dfs(int x) {\n\tdfn[x] = ++cdfn; idfn[cdfn] = x;\n\tfor (int i = G.head[x]; i; i = G.nxt[i])\n\t\tif (!dfn[G.to[i]]) {\n\t\t\tfa[G.to[i]] = x;\n\t\t\tdfs(G.to[i]);\n\t\t}\n}\n\ninline int min_dfn(int x, int y) { return dfn[x] < dfn[y] ? x : y; }\n\nnamespace ADT {\n\tint fa[maxn], val[maxn];\n\tinline void init() {\n\t\tfor (int i = 1; i <= n; ++i) fa[i] = i;\n\t\t// val is 0, and dfn[0] is put bigger than n.\n\t}\n\tint find(int x) {\n\t\tif (fa[x] == x) return x;\n\t\tint y = fa[x];\n\t\tfa[x] = find(fa[x]);\n\t\tif (dfn[semi[val[x]]] > dfn[semi[val[y]]]) val[x] = val[y];\n\t\treturn fa[x];\n\t}\n\tinline void merge(int x, int y) { // x <-- y\n\t\tx = find(x); y = find(y);\n\t\tfa[y] = x;\n\t}\n};\n\nint deg[maxn], siz[maxn];\n\nint main() {\n\tscanf(\"%d %d\", &n, &m);\n\tint x = 0, y = 0;\n\tfor (int i = 1; i <= m; ++i) {\n\t\tscanf(\"%d %d\", &x, &y);\n\t\tG.insert(x, y);\n\t\tF.insert(y, x);\n\t}\n\n\tdfs(1);\n\tdfn[0] = n + 1; // prepare for comparation\n\tADT::init();\n\n\tfor (int i = n; i >= 1; --i) {\n\t\tx = idfn[i];\n\t\tfor (int j = F.head[x]; j; j = F.nxt[j]) { // get semi[x]\n\t\t\ty = F.to[j];\n\t\t\tif (dfn[y] < dfn[x]) semi[x] = min_dfn(semi[x], y);\n\t\t\telse {\n\t\t\t\tADT::find(y);\n\t\t\t\tsemi[x] = min_dfn(semi[x], semi[ADT::val[y]]);\n\t\t\t}\n\t\t}\n\t\tfor (int j = T.head[x]; j; j = T.nxt[j]) { // work for the \"y\"s which semi[y] = x\n\t\t\ty = T.to[j];\n\t\t\tADT::find(y);\n\t\t\tint z = ADT::val[y];\n\t\t\tif (dfn[semi[z]] == dfn[x]) idom[y] = x; // equal to idom[y]=semi[y]\n\t\t\telse idom[y] = z; // coorect later\n\t\t}\n\n\t\tADT::val[x] = x;\n\t\tADT::merge(fa[x], x);\n\t\tT.insert(semi[x], x); // a query.\n\t}\n\tfor (int i = 2; i <= n; ++i) {\n\t\tx = idfn[i];\n\t\tif (idom[x] != semi[x]) idom[x] = idom[idom[x]];\n\t}\n\n\tfor (int i = n; i >= 1; --i) {\n\t\tx = idfn[i];\n\t\t++siz[x];\n\t\tif (idom[x]) siz[idom[x]] += siz[x];\n\t}\n\n\tfor (int i = 1; i <= n; ++i) printf(\"%d \", siz[i]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1623577163,
        "uid": 128771,
        "name": "\u738b\u9cb2\u9e4f",
        "ccfLevel": 7,
        "title": "\u652f\u914d\u6811\u5b66\u4e60\u7b14\u8bb0"
    },
    {
        "content": "### \u849f\u84bb\u7684\u9898\u89e3\n\n**\u9898\u76ee\u5206\u6790\uff1a** \u9996\u5148\u80af\u5b9a\u662f\u4e2a\u6a21\u677f\u9898\u5566\uff0c\u4e00\u4e2a\u6709\u5411\u56fe\uff0c\u7ed9\u4f60\u4e00\u4e2a\u8d77\u70b9\uff0c\u6c42\u6bcf\u4e2a\u70b9\u7684\u652f\u914d\u7684\u70b9\u7684\u4e2a\u6570\n\n- **\u4e00\u4e9b\u5b9a\u4e49\uff1a**\n\n**\u652f\u914d\u70b9\uff1a** \u4eceu\u5230v\u7684\u6240\u6709\u8def\u5f84\u5982\u679c\u90fd\u7ecf\u8fc7\u4e00\u4e2a\u70b9p\uff0c\u90a3\u4e48\u6211\u4eec\u79f0\u8fd9\u4e2a\u70b9p\u4e3av\u7684\u652f\u914d\u70b9\uff0c\u5982\u679c\u628ap\u5207\u6389\uff0c\u90a3\u4e48u\u5c06\u65e0\u6cd5\u5230\u8fbev\uff0c\u663e\u7136\u4e00\u4e2a\u70b9\u7684\u652f\u914d\u70b9\u53ef\u4ee5\u6709\u5f88\u591a\u4e2a(\u6bd4\u5982\uff1a)\n![](https://cdn.luogu.com.cn/upload/pic/67611.png)\n\u5bf9\u4e8e\u8fd9\u4e2a\u56fe \u4ece0\u51fa\u53d1\uff0c7\u7684\u652f\u914d\u70b9\u67093\u548c6\n\n**\u534a\u652f\u914d\u70b9\uff1a** \u5b58\u5728\u4ece\u4e00\u4e2a\u70b9u\u5230v\u7684\u8def\u5f84\u4e2d(\u4e0d\u5305\u62ecu\uff0cv)\uff0c\u6240\u6709\u7684\u70b9pi\u7684dfn\u90fd\u5927\u4e8ev\u7684dfn(\u4e0b\u9762\u4e24\u4e2a\u70b9\u7684\u6bd4\u8f83\u5927\u5c0f\u90fd\u6307\u7684\u662f\u4ed6\u4eec\u7684dfn)(\u6211\u4eec\u5728\u505a\u9898\u524d\u662f\u8981\u6263\u51fa\u4e00\u4e2adfs\u6811\u7684)\uff0c\u5f53\u7136\u5982\u679cu\u662fv\u5728dfs\u6811\u4e0a\u7684\u7236\u8282\u70b9\uff0c\u90a3\u4e48u\u4e5f\u662fv\u7684\u534a\u652f\u914d\u70b9\n\n- \u4e00\u4e9b\u51c6\u5907:\n\n**\u4e3a\u4ec0\u4e48\u8981\u6c42\u652f\u914d\u70b9\uff1a** \u56e0\u4e3a\u6211\u4eec\u662f\u505a\u4e0d\u5230\u76f4\u63a5\u6c42\u652f\u914d\u70b9\u7684\uff0c\u652f\u914d\u70b9\u4e00\u5b9a\u662f\u534a\u652f\u914d\u70b9\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u627e\u5230\u6240\u6709\u70b9\u7684\u534a\u652f\u914d\u70b9\uff0c\u7136\u540e\u53bb\u6c42\u652f\u914d\u70b9\uff0c\u6240\u6709\u534a\u652f\u914d\u70b9\u90fd\u6709\u673a\u4f1a\u6210\u4e3a\u652f\u914d\u70b9\uff0c\u6211\u4eec\u7528semi[v]\u6570\u7ec4\u6765\u8868\u793av\u70b9\u7684\u6240\u6709\u534a\u652f\u914d\u70b9\u7684\u6700\u5c0f\u7684\u90a3\u4e2a\n\n**\u539f\u7406\uff1a** \u5177\u4f53\u539f\u7406\u5176\u5b9e\u5f88\u591a[\u5927\u4f6c](https://www.luogu.org/blog/214gtx/zhi-pei-shu-yang-xie)\u5df2\u7ecf\u8bb2\u5f97[\u5f88\u8be6\u7ec6\u4e86](https://www.cnblogs.com/fenghaoran/p/dominator_tree.html)\uff0c\u6b22\u8fce\u770b\u5b8c\u4e86[\u4ed6\u4eec](https://www.cnblogs.com/meowww/archive/2017/02/27/6475952.html)\u7684\u8bb2\u89e3\u518d\u6765\u770b\u6211\u7684\u9898\u89e3\uff0c\u7136\u540e\u6211\u5e2e\u4f60\u6c34\u8fc7\u8fd9\u4e2a\u9898(\u56e0\u4e3a\u4ed6\u4eec\u8bb2\u7684\u592a\u8fc7\u8be6\u7ec6(\u6240\u4ee5\u5c31\u4e0d\u4e00\u5b9a\u80fd\u591f\u5b8c\u5168\u770b\u7684\u61c2))(\u6700\u597d\u8fd8\u662f\u5148\u53bb\u4ed6\u4eec\u90a3\u91cc\u6c34\u4e2a\u51e0\u4e2a\u5c0f\u65f6) \u56e0\u4e3a\u8fd9\u91cc\u7684\u5c0f\u849f\u84bb \u5e76\u4e0d\u4f1a\u8bb2\u592a\u591a\u7684\u539f\u7406 \u57fa\u672c\u6ca1\u6709\n\n**\u57fa\u672c\u601d\u8def\uff1a** \n- **\u6811** \u5982\u679c\u539f\u56fe\u662f\u4e00\u4e2a\u6811\u90a3\u4e48\u4ed6\u5c31\u662f\u6211\u4eec\u8981\u7684\u652f\u914d\u6811\uff0cdfs\u4e00\u904d\u6c42\u51fa\u6bcf\u4e2a\u70b9\u7684\u6240\u5728\u5b50\u6811\u7684\u5927\u5c0f\u5c31\u662f\u652f\u914d\u7684\u70b9\u6570\u5566\n\n- **DAG** \u5bf9\u4e8e\u4e00\u4e2aDAG\uff0c\u6211\u4eec\u5148\u62d3\u6251\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9u\uff0c\u4ed6\u7684\u76f4\u63a5\u524d\u9a71f1\uff0cf2.....fn \u8fd9\u4e9bf\u7684lca(\u8bbe\u4ed6\u4e3afafa)\uff0c\u90a3\u4e48fafa\u5c31\u662fu\u5728\u652f\u914d\u6811\u4e0a\u7684\u7236\u8282\u70b9\uff0c\u90a3\u4e48\u6211\u4eec\u652f\u914d\u6811\u5c31\u5efa\u5b8c\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u68f5\u6811\uff0c\u7136\u540e\u770b\u4e0a\u9762\n\n- **\u4e00\u822c\u56fe** \u5bf9\u4e8e\u4e00\u822c\u7684\u56fe\uff0c\u6211\u4eec\u9700\u8981\u5148\u6263\u51fa\u4e00\u4e2adfs\u6811\uff0c\u7136\u540e\u6c42\u51fa\u6240\u6709\u7684\u70b9u(\u4e0d\u5305\u62ec\u8d77\u70b9)\u7684semi[u]\uff0c\u7136\u540e\u518d\u5728dfs\u6811\u4e0a\u8fde\u63a5\uff08semi[u],u\uff09\uff08\u8fd9\u6837\u6240\u6709\u7684\u70b9\u7684\u652f\u914d\u5173\u7cfb\u662f\u4e0d\u53d8\u7684\uff09\u7136\u540e\u6211\u4eec\u5c31\u628a\u8fd9\u4e2adfs\u6811\u53d8\u6210\u4e86\u4e00\u4e2aDAG\uff0c\u7136\u540e\u770b\u4e0a\u9762\uff0c\u7136\u540e\u5927\u5bb6\u53ef\u4ee5\u5148\u505a\u4e00\u4e0b\u8fd9\u9053\u9898[p2597](https://www.luogu.org/problem/P2597)\u548c[\u8fd9\u4e2a\u9898](https://www.luogu.org/problem/CF757F)\uff08\u8fd9\u4e24\u4e2a\u90fd\u662fDAG\uff0c\u53ef\u4ee5\u7ec3\u7ec3\u624b\uff09\n- **\u6211\u89c9\u5f97\u6709\u5fc5\u8981\u7ed9\u51fa\u6837\u4f8b\u7684\u56fe**\n![](https://cdn.luogu.com.cn/upload/pic/67609.png)\n\n****\u4e0a\u4ee3\u7801\uff1a****\n```cpp\n# include <iostream>\n# include <cstdio>\n# include <cstring>\n# include <queue>\n# define sz 20\n# define FOR(i,st,ed) for(int i=st;i<=ed;++i)\n# define _FOR(tu,u) for(int v,i=tu.hd[u];i;i=tu.e[i].nt)\n# define _(tu) v=tu.e[i].to;\nusing namespace std;\nint re(){\n\tint s=0,f=1;char ch=getchar();\n\twhile(!isdigit(ch)){if(ch=='-')f=-1;ch=getchar();}\n\twhile(isdigit(ch)){s=(s<<1)+(s<<3)+ch-'0';ch=getchar();}\n\treturn s*f;\n}//\u5feb\u8bfb\u5c31\u4e0d\u89e3\u91ca\u4e86\n\nconst int N=2e5+7;\nstruct MAP{\n\tstruct edge{\n\t\tint to,nt;\n\t}e[N<<1];int cnt,hd[N];\n\tvoid link(int x,int y){e[++cnt]=(edge){y,hd[x]};hd[x]=cnt;}\n}xx,a,ra,t,rt,z;//\u6392\u9664xx\uff0c\u4f9d\u6b21\u8868\u793a\u539f\u56fe\uff0c\u539f\u56fe\u7684\u53cd\u56fe\uff0cdfs\u6811\n//dfs\u6811\u7684\u53cd\u56fe\uff0c\u548c\u6700\u540e\u7684\u652f\u914d\u6811\nint n,m;\n\nint dfn[N],dji,id[N],ff[N];//ff\u8868\u793adfs\u6811\u4e0a\u7684\u7236\u8282\u70b9\nvoid dfs(int u){\n\tid[dfn[u]=++dji]=u;\n\t_FOR(a,u){\n\t\t_(a);\n\t\tif(!dfn[v]) dfs(v),ff[v]=u,t.link(u,v); \n\t}\n}//\u6263\u51fa\u4e00\u4e2adfs\u6811\n\nint anc[N],semi[N],mn[N];//\u8fd9\u4e2amn[v],\u8868\u793av\u70b9\u7684dfs\u6811\u4e0a\u7684\u7956\u5148\n//\u7684semi\u6700\u5c0f\u7684\u90a3\u4e2a\u7956\u5148\uff0c\u6240\u4ee5semi[mn[x]]=semi[x];\nvoid init(){\n\tFOR(i,1,n) anc[i]=semi[i]=mn[i]=i;\n}\nint find(int u){\n\tif(u!=anc[u]){\n\t\tint t=anc[u];anc[u]=find(anc[u]);\n\t\tif(dfn[semi[mn[u]]]>dfn[semi[mn[t]]]) mn[u]=mn[t];\n\t}\n\treturn anc[u];\n}//\u4ee5\u4e0a\u662f\u5e26\u6743\u5e76\u67e5\u96c6(\u8def\u5f84\u538b\u7f29)\nvoid len_tarjan(){\n\tinit();\n\tfor(int j=n;j>=2;--j){\n\t\tint u=id[j],res=j;\n\t\tif(!u) continue;\n\t\t_FOR(ra,u){\n\t\t\t_(ra);\n\t\t\tif(!dfn[v]) continue;\n\t\t\tif(dfn[v]<dfn[u]) res=min(res,dfn[v]);\n\t\t\telse find(v),res=min(res,dfn[semi[mn[v]]]);\n\t\t}\n\t\tsemi[u]=id[res];anc[u]=ff[u];t.link(semi[u],u); \n\t}\n}//\u6211\u4eec\u7684tarjan\u5927\u4f6c\u7684\u7b97\u6cd5\n\nint ru[N],dep[N],fa[N][25];\nint lca(int x,int y){\n\tif(dep[x]<dep[y]) swap(x,y);\n\tint del=dep[x]-dep[y];\n\tFOR(i,0,sz)\n\t\tif((1<<i)&del) x=fa[x][i];\n\tif(x==y) return x;\n\tfor(int i=sz;i>=0;--i)\n\t\tif(fa[x][i]!=fa[y][i]) x=fa[x][i],y=fa[y][i];\n\treturn fa[x][0];\n}/lca\nvoid work(int u){\n\tint t=rt.e[rt.hd[u]].to;\n\t_FOR(rt,u){\n\t\t_(rt);t=lca(t,v);\n\t}\n\tdep[u]=dep[t]+1;\n\tfa[u][0]=t;\n\tz.link(t,u);\n\tFOR(i,1,sz)\n\t\tfa[u][i]=fa[fa[u][i-1]][i-1]; \n}//\u5efa\u7acb\u652f\u914d\u6811\nvoid tpsort(){\n\tFOR(j,1,n)\n\t\t_FOR(t,j){\n\t\t\t_(t);\n\t\t\tru[v]++;rt.link(v,j); \n\t\t}\t\n\tFOR(i,1,n) if(!ru[i]) t.link(0,i),rt.link(i,0);\n\tqueue <int> q;q.push(0);\n\twhile(q.size()){\n\t\tint u=q.front();q.pop();\n\t\t_FOR(t,u){\n\t\t\t_(t);\n\t\t\tif((--ru[v])<=0) q.push(v),work(v);\n\t\t}\n\t} \n}\n\nint siz[N];\nvoid adfs(int u){\n\tsiz[u]=1;\n\t_FOR(z,u){\n\t\t_(z);adfs(v);siz[u]+=siz[v];\n\t}\n}//\u6700\u540eadfs\u7528\u6765\u641c\u7b54\u6848\nint main(){\n\tn=re();m=re();int x,y;\n\tFOR(i,1,m){\n\t\tx=re();y=re();\n\t\ta.link(x,y);ra.link(y,x);  \n\t}\n\tdfs(1);\n\tlen_tarjan();\n\ttpsort();\n\tadfs(0);\n\tFOR(i,1,n) cout<<siz[i]<<' ';\n\treturn 0;\n}//\u597d\u7684 \u6211\u4eec\u6210\u529f\u7684\u6c34\u4e86\u4e00\u9053\u9ed1\u9898!\n```\n",
        "postTime": 1564712318,
        "uid": 118118,
        "name": "\u51cc\u4e71",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5180 \u3010\u3010\u6a21\u677f\u3011\u652f\u914d\u6811\u3011"
    },
    {
        "content": "> \u739b\u5947\u739b\uff0c\u4e0d\uff0c\u300e\u652f\u914d\u4e4b\u6076\u9b54\u300f\n\n#### \u95ee\u9898\n\n[link](https://www.luogu.com.cn/problem/P5180)\n\n\u7ed9\u4e00\u4e2a\u5355\u6e90\u6709\u5411\u56fe\uff0c\u5bf9\u4e8e\u8d77\u70b9 $s$\uff0c\u5230\u4efb\u610f\u4e00\u4e2a\u70b9 $t$\uff0c\u5982\u679c\u5728\u56fe\u4e0a\u5220\u6389\u70b9 $k$ \u5c31\u80fd\u4f7f\u5f97 $s$ \u65e0\u6cd5\u5230\u8fbe\u70b9 $t$\uff0c\u90a3\u4e48\u79f0 $k$ \u652f\u914d $t$\uff0c$k$ \u662f $t$ \u7684\u652f\u914d\u70b9\u3002\n\n\u73b0\u5728\u8981\u6c42\u51fa\u4e00\u4e2a\u70b9\u652f\u914d\u591a\u5c11\u70b9\u3002\n\n#### \u5b9a\u4e49\n\n\u5bf9\u4e8e\u4e00\u4e2a\u70b9 $t$ \u7684\u652f\u914d\u70b9 $k$\uff0c\u5982\u679c $k$ \u7684\u6240\u6709\u652f\u914d\u70b9\u90fd\u80fd\u652f\u914d $t$\uff0c\u90a3\u4e48\u5c31\u8ba4\u4e3a $k$ \u662f $t$ \u7684\u6700\u8fd1\u652f\u914d\u70b9\uff0c\u5373 $idom_t$\uff0c\u5bb9\u6613\u53d1\u73b0\u6700\u8fd1\u652f\u914d\u70b9\u662f\u552f\u4e00\u7684\u3002\n\n\u9996\u5148\uff0c\u4ed6\u6709\u4f20\u9012\u6027\u548c\u53cd\u5bf9\u79f0\u6027\uff0c\u5373 $a$ \u652f\u914d $b$\uff0c$b$ \u652f\u914d $c$\uff0c\u5219 $a$ \u652f\u914d $c$\u3002\n\n$a$ \u652f\u914d $b$\uff0c$b$ \u4e0d\u4e00\u5b9a\u652f\u914d $a$\u3002\n\n\u53cd\u8bc1\u4e00\u4e0b\u53d1\u73b0\uff0c\u5982\u679c $a$ \u548c $b$ \u652f\u914d $c$\uff0c\u5e76\u4e14 $a$ \u4e0d\u652f\u914d $b$\uff0c$b$ \u4e0d\u652f\u914d $a$\uff0c\u5206\u7c7b\u8ba8\u8bba\u4e00\u4e0b\uff0c\u5982\u679c $a$ \u4e0d\u80fd\u5230 $b$\uff0c\u90a3\u4e48\u5220\u6389\u70b9 $b$ \u540e\u4ecd\u7136\u80fd\u4ece\u70b9 $a$ \u5230 $s$\uff0c\u51fa\u73b0\u77db\u76fe\uff1b\u5982\u679c $a$ \u80fd\u5230 $b$\uff0c\u5220\u6389\u70b9 $a$ \u80fd\u4f7f $s$ \u4e0e $c$ \u4e0d\u8fde\u901a\uff0c\u800c\u6b64\u65f6 $b$ \u548c $c$ \u8fde\u901a\uff0c\u6240\u4ee5 $s$ \u4e0e $b$ \u4e0d\u8054\u901a\uff0c\u5373 $a$ \u652f\u914d $b$\uff0c\u51fa\u73b0\u77db\u76fe\u3002\n\n\u5982\u679c\u6bcf\u4e2a\u70b9\u90fd\u8ba4\u81ea\u5df1\u7684 $idom$ \u4e3a\u7236\u4eb2\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e00\u68f5\u4ee5 $s$ \u4e3a\u6839\u8282\u70b9\u7684\u6811\uff0c\u5bb9\u6613\u53d1\u73b0\u8fd9\u6837\u5efa\u6811\u540e\uff0c\u70b9 $x$ \u88ab\u4ed6\u7684\u6240\u6709\u7956\u5148\u652f\u914d\uff0c\u540c\u65f6\u53c8\u652f\u914d\u4ed6\u5b50\u6811\u4e2d\u7684\u6240\u6709\u70b9\u3002\n\nLengauer-Tarjan \u53ef\u4ee5 $O\\left(n\\log n\\right)$ \u6c42\u89e3\u652f\u914d\u6811\u3002\n\n**\u6211\u4eec\u8ba4\u4e3a\u70b9 $x$ \u6bd4\u70b9 $y$ \u5927\uff0c\u5f53\u4e14\u4ec5\u5f53 $dfn_x>dfn_y$\u3002**\n\nLengauer-Tarjan \u7b97\u6cd5\u7684\u5de7\u5999\u4e4b\u5904\u5728\u4e8e\u5f15\u5165\u4e86\u534a\u652f\u914d\u70b9\u6c42\u89e3\u652f\u914d\u70b9\u3002\n\n\u82e5\u7b2c $sdom$ \u53f7\u4e3a\u7b2c $u$ \u53f7\u7ed3\u70b9\u7684\u534a\u652f\u914d\u70b9\uff0c\u5219 $sdom$ \u5230 $u$ \u7684\u8def\u5f84\u4e2d\u6240\u6709\u70b9\u90fd\u6bd4 $u$ \u8981\u5927\u3002\n\n\u7136\u540e\u7ecf\u5178\u7684 5 \u4e2a\u5f15\u7406\u548c 3 \u4e2a\u5b9a\u7406\u3002\n\n\u4ee5\u4e0b\u5f15\u7406\u6240\u63d0\u5230\u7684\u6811\u6ca1\u6709\u7279\u6b8a\u8bf4\u660e\u7686\u4e3a dfs \u6811\u3002\n\n**\u5f15\u7406 1\uff1a\u82e5\u4e24\u4e2a\u70b9 $u,v$ \u6ee1\u8db3 $u\\leqslant v$\uff0c\u5219\u4efb\u610f\u4e00\u6761 $u$ \u5230 $v$ \u7684\u8def\u5f84\u90fd\u8981\u7ecf\u8fc7dfs\u6811\u4e0a\u7684 $LCA(u,v)$\u3002**\n\n\u7136\u540e\u4f60\u8bf4\u4e3a\u4ec0\u4e48\u3002\u6811\u8fb9\u80af\u5b9a\u8981\u8de8 LCA\uff0c\u524d\u5411\u8fb9\u548c\u8fd4\u7956\u8fb9\u90fd\u4e0d\u80fd\u8de8\u8d8a\u5b50\u6811\uff0c\u800c\u6a2a\u53c9\u8fb9\u9700\u8981\u6ee1\u8db3 $v\\leqslant u$\uff0c\u56e0\u4e3a\u5982\u679c\u53cd\u8fc7\u6765\u7684\u8bdd\uff0c\u5373 $u$ \u5148\u641c\u5230\uff0c\u90a3\u4e48\u6a2a\u53c9\u8fb9\u5c31\u662f\u7531 $v$ \u7684\u5b50\u6811\u5f15\u8fc7\u6765\u7684\u3002\n\n**\u5f15\u7406 2\uff1a$u\\neq s$\uff0c$idom_u$ \u5fc5\u5b9a\u4e3a dfs \u6811\u4e0a $u$ \u7684\u7956\u5148**\n\n\u5982\u679c\u4e0d\u662f\uff0c\u76f4\u63a5\u987a\u7740 dfs \u6811\u5f80\u4e0b\u8dd1\u5c31\u884c\u4e86\u3002\n\n**\u5f15\u7406 3\uff1a$u\\neq s$\uff0c$sdom_u$ \u5fc5\u5b9a\u4e3a dfs \u6811\u4e0a $u$ \u7684\u7956\u5148**\n\n\u5982\u679c\u4e0d\u662f\uff0c\u90a3\u5c31\u4f1a\u5728\u522b\u7684\u5b50\u6811\u91cc\uff0c\u4ece\u522b\u7684\u5b50\u6811\u7684\u4efb\u610f\u4e00\u4e2a\u70b9 $v$ \u5230 $u$ \u7684\u8def\u5f84\u5fc5\u7136\u7ecf\u8fc7 $LCA\\left(u,v\\right)$\uff0c\u800c $LCA\\left(u,v\\right)$ \u5fc5\u7136\u4e0d\u6bd4 $u$ \u5927\uff0c\u4e0e\u5b9a\u4e49\u77db\u76fe\u3002\n\n**\u5f15\u7406 4\uff1a$idom_u$ \u5fc5\u5b9a\u662f $sdom_u$ \u7684\u7956\u5148\u3002**\n\n\u5982\u679c\u4e0d\u662f\uff0c\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u7b2c\u4e00\u79cd\u662f $idom_u$ \u5835\u4f4f\u4e86 $sdom_u$\uff0c\u5219 $s$ \u53ef\u4ee5\u76f4\u63a5\u6cbf\u7740\u641c\u7d22\u6811\u5f80\u4e0b\u627e\u5230 $u$\uff0c\u7b2c\u4e8c\u79cd\u662f $idom_u$ \u5835\u4f4f\u4e86 $s$\uff0c\u5219 $s$\u53ef\u4ee5\u6cbf\u7740 $sdom_u$ \u5f80\u4e0b\u627e\u5230 $u$\uff0c\u8fd9\u4e24\u79cd\u60c5\u51b5\u90fd\u4e0e\u5b9a\u4e49\u77db\u76fe\u3002\n\n**\u5f15\u7406 5\uff1a\u5728\u641c\u7d22\u6811\u4e0a\uff0c\u6240\u6709 $idom_u$ \u5230 $u$ \u7684\u8def\u5f84\u8981\u4e48\u5305\u542b\u8981\u4e48\u4e0d\u4ea4\u3002**\n\n\u5982\u679c\u4e0d\u662f\u90a3\u5c31\u8bf4\u660e\u6709\u7684\u70b9\u4ea4\u4e86\u4f46\u53ea\u4ea4\u4e86\u4e00\u90e8\u5206\uff0c\u5373 $idom_u$ \u88ab\u8def\u5f84 $(idom_v,v)$ \u5305\u542b\uff0c$idom_u$ \u80af\u5b9a\u662f $idom_v$ \u7684\u771f\u540e\u4ee3\uff0c\u4ed6\u5fc5\u7136\u4e0d\u652f\u914d $v$\uff0c\u5982\u679c\u5220\u6389\u4ed6\uff0c$s$ \u5c31\u53ef\u4ee5\u6cbf\u7740 $idom_v$ \u5230\u70b9 $v$ \u518d\u5230\u70b9 $u$\uff0c\u4e0e\u5b9a\u4e49\u77db\u76fe\u3002\n\n\u770b\u4e0a\u53bb\u975e\u5e38\u5389\u5bb3\uff0c\u6211\u4eec\u62ff\u8fd9\u4e9b\u5f15\u7406\u6765\u8bc1\u660e\u4e00\u4e0b\u6c42\u89e3 $idom$ \u7684\u5173\u952e\u7684 3 \u4e2a\u5b9a\u7406\u3002\n\n**\u5b9a\u7406 1\uff1a\u5bf9\u4e8edfs\u6811\u4e0a\u7684\u4e00\u6761\u8def\u5f84 $(sdom_w,w)$\uff0c\u82e5\u8def\u5f84\u4e0a\u6240\u6709\u70b9\u7684\u90fd\u6ee1\u8db3 $sdom_u\\geqslant sdom_w$\uff0c\u5219 $idom_w=sdom_w$\u3002**\n\n\u610f\u601d\u5c31\u662f $sdom_w$ \u5230 $w$ \u7684\u8def\u5f84\u5b8c\u5168\u5305\u542b\u4e86 $sdom_u$ \u5230 $u$ \u7684\u8def\u5f84\uff0c\u7531\u5f15\u74064\u53ef\u5f97\uff0c$idom_w$ \u4e3a $sdom_w$ \u7684\u7956\u5148\uff0c\u6240\u4ee5\u6211\u4eec\u73b0\u5728\u53ea\u9700\u8981\u8bc1\u660e $sdom_w$ \u652f\u914d $w$\u3002\n\n\u8003\u8651\u5728 $s$ \u5230\u70b9 $w$ \u7684\u8def\u5f84\u4e0a\u627e\u51fa\u6700\u540e\u4e00\u4e2a**\u7f16\u53f7**\u5c0f\u4e8e $sdom_w$ \u7684\u70b9 $x$\uff0c\u4ed6\u663e\u7136\u80fd\u591f\u5230\u8fbe $sdom_w$ \u5230 $w$ \u4e2d\u7684\u8def\u5f84\u7684\u4e00\u4e9b\u70b9\uff0c\u6211\u4eec\u79f0\u91cc\u9762\u6700\u5c0f\u7684\u70b9\u4e3a $y$\uff0c\u7531\u524d\u63d0\u6761\u4ef6\u53ef\u77e5\uff0c$sdom_y\\geqslant sdom_w$\uff0c\u6240\u4ee5 $x\\neq sdom_y$\u3002\u8003\u8651\u5bf9\u4e8e\u70b9 $y$\uff0c\u80af\u5b9a\u80fd\u591f\u627e\u5230\u4e00\u4e2a\u70b9 $v$ \u4f7f\u5f97 $x$ \u662f $v$ \u7684\u771f\u7956\u5148\u5e76\u4e14 $v$ \u662f $y$ \u7684\u771f\u7956\u5148\uff0c\u56e0\u4e3a $x$ \u662f\u6700\u5c0f\u7684\uff0c\u6240\u4ee5 $(sdom_w,v,w)$ \u4e00\u5b9a\u6784\u6210\u4e00\u6761\u94fe\u3002\n\n\u5982\u679c\u662f\u8fd9\u6837\u7684\u8bdd $y$ \u70b9\u548c $v$ \u70b9\u5c31\u77db\u76fe\u4e86\uff0c\u6240\u4ee5 $y$ \u70b9\u548c $sdom_w$ \u70b9\u4e4b\u95f4\u4e0d\u80fd\u6709\u522b\u7684\u70b9\uff0c\u6709\u522b\u7684\u70b9\u5c31\u4e00\u5b9a\u80fd\u591f\u5411\u4e0a\u9762\u4e00\u6837\u6784\u9020\u51fa\u4e00\u7ec4 $v$\u628a\u4ed6\u66ff\u4ee3\uff0c\u6240\u4ee5 $y=sdom_w$\uff0c\u5373\u6240\u6709\u4ece $s$ \u5230 $w$ \u7684\u9053\u8def\u90fd\u5fc5\u987b\u7ecf\u8fc7 $sdom_w$\uff0c\u5373 $idom_w=sdom_w$\u3002\n\n**\u5b9a\u7406 2\uff1a\u5bf9\u4e8e dfs \u6811\u4e0a\u7684\u4e00\u6761\u8def\u5f84 $(sdom_w,w)$\uff0c\u8bbe $u$ \u4e3a\u94fe\u4e0a $sdom_u$ \u6700\u5c0f\u7684\u70b9\uff0c\u82e5 $sdom_u\\leqslant sdom_w$\uff0c\u5219 $idom_w=idom_u$\u3002**\n\n\u7531\u5f15\u74065\u53ef\u5f97\uff0c$idom_w$ \u5230 $w$ \u7684\u8def\u5f84\u8981\u4e48\u5305\u542b $idom_u$ \u5230 $u$ \u7684\u8def\u5f84\u8981\u4e48\u4e0e\u8fd9\u6761\u8def\u5f84\u4e0d\u4ea4\uff0c\u53c8\u7531\u5f15\u7406 4 \u53ef\u5f97\uff0c$idom_w$ \u5fc5\u987b\u662f $sdom_w$ \u7684\u7956\u5148\uff0c\u6240\u4ee5 $idom_w$ \u5230\u70b9 $w$ \u4e4b\u95f4\u7684\u8def\u5f84\u5fc5\u7136\u5305\u542b $idom_u$ \u5230 $u$ \u7684\u8def\u5f84\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8bc1\u660e $idom_u$ \u662f\u5426\u652f\u914d $w$ \u5373\u53ef\u3002\n\n\u8fd9\u4e2a\u8bc1\u660e\u7c7b\u4f3c\u5b9a\u7406 $1$\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u6211\u4eec\u628a\u4e0a\u9762\u4e24\u4e2a\u5b9a\u7406\u7ed3\u5408\u4e00\u4e0b\uff0c\u53d1\u73b0\u4e00\u4e2a\u5f31\u667a\u63a8\u8bba\u3002\n\n**\u63a8\u8bba 1\uff1a\u5bf9\u4e8edfs\u6811\u4e0a\u7684\u4e00\u6761\u8def\u5f84 $(sdom_w,w)$\uff0c\u8bbe $u$ \u4e3a\u94fe\u4e0a $sdom_u$ \u6700\u5c0f\u7684\u70b9\uff0c\u82e5 $sdom_u=sdom_w$\uff0c\u5219 $idom_w=sdom_w$\uff0c\u82e5 $sdom_u<sdom_w$\uff0c\u5219 $idom_w=idom_u$\u3002**\n\n\u6ce8\u610f\u5230\u6700\u5c0f\u7684 $sdom_u$ \u5fc5\u7136\u4e0d\u6bd4 $sdom_w$ \u8981\u5927\uff0c\u56e0\u4e3a $u$ \u53ef\u4ee5\u53d6 $sdom_w$\u3002\n\n\u6839\u636e\u63a8\u8bba1\uff0c\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u7528 $sdom$ \u5feb\u901f\u6c42\u51fa $idom$ \u4e86\uff0c\u95ee\u9898\u53d8\u6210\u4e86\u5982\u4f55\u5feb\u901f\u6c42\u51fa $sdom$\u3002\n\n**\u5b9a\u7406 3\uff1a**![](https://pic.imgdb.cn/item/63759f6d16f2c2beb19e16c4.jpg)\n\n**$sdom(w)=min(v|(v,w)\\in E,v<w\\bigcup sdom(u)|u>w,\\exists(v,w)\\in E,v\\in (r\\rightsquigarrow v))))$**\n\n\u4e0d\u4f1a\u6253latex\u6240\u4ee5\u76f4\u63a5\u622a\u56fe\u3002\n\nupd\uff1a\u73b0\u5728\u6709latex\u5566\uff01\n\n\u8fd9\u6bb5\u5f0f\u5b50\u7ffb\u8bd1\u4e00\u4e0b\u5c31\u662f\u5982\u679c\u70b9 $v$ \u6ee1\u8db3 $v,w$ \u4e4b\u95f4\u76f4\u63a5\u6709\u8fb9\u76f8\u8fde\uff0c\u5e76\u4e14 $v<w$ \u5c31\u80fd\u53d6 $v$\uff0c\u5982\u679c $u>w$ \u5e76\u4e14 $u$ \u5728\u4ece $s$ \u5230 $w$ \u7684\u8def\u5f84\u4e0a\u540c\u65f6 $u\\neq w$\u5c31\u80fd\u53d6 $sdom_u$\u3002\n\n![](https://pic.imgdb.cn/item/6375aa8516f2c2beb1ae0ec7.jpg)\n\n\u6e90\u81ea[link](https://www.luogu.com.cn/blog/Zenislt/qian-tan-zhi-pei-shu-lengauer-tarjan-algorithm)\n\n\u6709\u7684\u5730\u65b9 $sdom$ \u6253\u6210 $sdow$ \u4e86\u3002\n\n\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u6c42\u51fa $sdom$ \u548c $idom$ \u4e86\uff0c\u4e8e\u662f\u652f\u914d\u6811\u6211\u4eec\u5c31\u5efa\u5b8c\u4e86\u3002\n\n\u8003\u8651\u5b9e\u73b0\u65b9\u6cd5\u3002\n\n\u5148\u6c42 $sdom$\uff0c\u9996\u5148\u662f\u53d6 $v$ \u7684\u90e8\u5206\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u76f4\u63a5\u5efa\u53cd\u56fe\u66f4\u65b0\uff1b\u7136\u540e\u662f\u53d6 $sdom_u$ \u7684\u90e8\u5206\uff0c\u6839\u636e\u5b9a\u74063\uff0c\u53ea\u6709 $u>w$ \u7684\u65f6\u5019 $sdom_u$ \u624d\u80fd\u53d6\u5230\uff0c\u90a3\u5c31\u5012\u5e8f\u679a\u4e3e $dfn$\u3002\n\n\u8003\u8651\u7b2c\u4e8c\u4e2a\u6761\u4ef6\u5982\u4f55\u6ee1\u8db3\uff0c\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2adfs\u6811\u4e0a\u7684\u5e26\u6743\u5e76\u67e5\u96c6\uff08\u6ce8\u610f\uff0c\u8fd9\u68f5\u6811\u662f\u53cd\u56fe\u4e0a\u7684\uff01\uff09\uff0c\u6bcf\u6b21\u5904\u7406\u4e00\u4e2a\u70b9\u5c31\u628a\u4ed6\u5408\u5e76\u5230\u4ed6\u7684\u7236\u4eb2\u8eab\u4e0a\uff08\u6ce8\u610f\uff0c\u8fd9\u4e2a\u7236\u4eb2\u662f\u6b63\u56fe\u4e0a\u7684\uff01\uff09\uff0c\u540c\u65f6\u7ef4\u62a4\u51fa\u4e00\u4e2a\u5e76\u67e5\u96c6\u91cc\u9762 $sdom$ \u7684\u6700\u5c0f\u503c\uff0c\u6bcf\u6b21\u53ef\u4ee5\u76f4\u63a5\u66f4\u65b0\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nvector<int> ljb[200005];\nvector<int> G[200005];\nvector<int> tree[200005];\nint n,m;\nint dfn[200005];\nint rnk[200005];\nint fa[200005];\nint cnt;\nvoid dfs(int cur){\n    dfn[cur]=++cnt;\n    rnk[cnt]=cur;\n    for(int v:ljb[cur]){\n        if(!dfn[v]){\n            fa[v]=cur;\n            dfs(v);\n        }\n    }\n    return;\n}\nint father[200005];\nint ans[200005];\nint sdom[200005];\nint idom[200005];\nint res[200005];\nint unionn(int x){\n    if(father[x]==x)return x;\n    int F=unionn(father[x]);\n    if(dfn[sdom[ans[father[x]]]]<dfn[sdom[ans[x]]]){\n        ans[x]=ans[father[x]];\n    }\n    return father[x]=F;\n}\nint main(){\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1;i<=m;i++){\n        int u,v;\n        scanf(\"%d%d\",&u,&v);\n        ljb[u].push_back(v);\n        G[v].push_back(u);\n    }\n    dfs(1);\n    for(int i=1;i<=n;i++){\n        sdom[i]=i;\n        father[i]=i;\n        ans[i]=i;\n    }\n    for(int i=cnt;i>1;i--){\n        int tmp=rnk[i];\n        for(int v:G[tmp]){\n            if(!dfn[v])continue;\n            unionn(v);\n            if(dfn[sdom[tmp]]>dfn[sdom[ans[v]]]){\n                sdom[tmp]=sdom[ans[v]];\n            }\n        }\n        father[tmp]=fa[tmp];\n        tree[sdom[tmp]].push_back(tmp);\n        tmp=father[tmp];\n        for(int v:tree[tmp]){\n            unionn(v);\n            if(tmp==sdom[ans[v]])idom[v]=tmp;\n            else idom[v]=ans[v];\n        }\n        tree[tmp].clear();\n    }\n    for(int i=2;i<=cnt;i++){\n        int tmp=rnk[i];\n        if(idom[tmp]^sdom[tmp]){\n            idom[tmp]=idom[idom[tmp]];\n        }\n    }\n    for(int i=cnt;i>1;i--){\n        res[rnk[i]]++;\n        res[idom[rnk[i]]]+=res[rnk[i]];\n    }\n    res[1]++;\n    for(int i=1;i<=n;i++){\n        printf(\"%d \",res[i]);\n    }\n    return 0;\n}\n```\n\n#### DAG \u4e0a\u652f\u914d\u6811\n\n[\u677f\u5b50-\u707e\u96be](https://www.luogu.com.cn/problem/P2597)\n\n\u5bb9\u6613\u53d1\u73b0\u9898\u76ee\u8981\u6c42\u7684\u5c31\u662f\u6bcf\u4e2a\u70b9\u652f\u914d\u591a\u5c11\u4e2a\u70b9\u3002\n\n\u4f60\u8bf4\uff0c\u8bf6\uff0c\u8fd9\u4e0d\u5c31\u662f\u652f\u914d\u6811\u677f\u5b50\uff1f\n\n\u591a\u8d77\u70b9\u554a\uff0c\u6240\u4ee5\u6211\u4eec\u865a\u62df\u51fa\u4e00\u4e2a\u8d85\u7ea7\u6e90\u70b9\u51fa\u6765\uff0c\u8fde\u5411\u6240\u6709\u5165\u5ea6\u4e3a $0$ \u7684\u70b9\u5373\u53ef\u3002\n\n\u7136\u540e\u5c31\u76f4\u63a5\u8dd1\u652f\u914d\u6811\u677f\u5b50\uff0c\u6ce8\u610f\u8fd9\u91cc\u6bcf\u4e2a\u70b9\u4e0d\u80fd\u652f\u914d\u4ed6\u81ea\u5df1\u3002\n\n\u8fd9\u4e8b\u8fd8\u6ca1\u5b8c\uff0c\u8003\u8651\u5230\u8fd9\u5f20\u56fe\u662f\u4e2a DAG\uff0c\u4f60\u601d\u8003 DAG \u53ef\u4ee5\u5e72\u561b\uff0c\u53ef\u4ee5\u8dd1\u62d3\u6251\u5bf9\u5427\uff0c\u5047\u8bbe\u73b0\u5728\u62d3\u6251\u5230\u7b2c $u$ \u53f7\u70b9\uff0c\u90a3\u4e48 $idom_u$ \u5c31\u662f $u$ \u7684\u6240\u6709\u524d\u9a71 $v$ \u5728\u652f\u914d\u6811\u4e0a\u7684 LCA\uff0c\u8fd9\u4e2a\u4e1c\u897f\u4e0d\u96be\u8bc1\uff0c\u9996\u5148 LCA \u80af\u5b9a\u652f\u914d $u$ \u7684\u6240\u6709\u524d\u9a71\u7684\u70b9\uff0c\u6240\u4ee5 LCA \u80af\u5b9a\u652f\u914d\u70b9 $u$\uff0c\u5176\u6b21\u5982\u679c\u4e0d\u8fd9\u4e48\u505a\uff0c\u6bd4\u5982\u8bf4 LCA \u5f80\u54ea\u68f5\u5b50\u6811\u8dd1\u4e00\u4e0b\uff0c\u5c31\u4f1a\u4f7f\u5f97\u67d0\u4e2a\u524d\u9a71 $v$ \u4e0d\u518d\u88ab LCA \u652f\u914d\uff0c\u800c $v$ \u90fd\u4e0d\u88ab\u652f\u914d\uff0c$u$ \u53ef\u4ee5\u987a\u7740 $v$ \u722c\u8fc7\u6765\uff0c\u4e8e\u662f $idom_u$ \u5c31\u662f\u70b9 $u$ \u7684\u6240\u6709\u524d\u9a71\u7684 LCA\u3002\n\n\u4e8e\u662f DAG \u4e0a\u652f\u914d\u6811\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O\\left(n\\log n\\right)$\u3002\n\n\u4e00\u822c\u56fe\u652f\u914d\u6811\u4ee3\u7801\u5982\u4e0b\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nvector<int> ljb[200005];\nvector<int> G[200005];\nvector<int> tree[200005];\nint n,m;\nint dfn[200005];\nint rnk[200005];\nint fa[200005];\nint cnt;\nvoid dfs(int cur){\n    dfn[cur]=++cnt;\n    rnk[cnt]=cur;\n    for(int v:ljb[cur]){\n        if(!dfn[v]){\n            fa[v]=cur;\n            dfs(v);\n        }\n    }\n    return;\n}\nint father[200005];\nint ans[200005];\nint sdom[200005];\nint idom[200005];\nint res[200005];\nint unionn(int x){\n    if(father[x]==x)return x;\n    int F=unionn(father[x]);\n    if(dfn[sdom[ans[father[x]]]]<dfn[sdom[ans[x]]]){\n        ans[x]=ans[father[x]];\n    }\n    return father[x]=F;\n}\nint main(){\n    scanf(\"%d\",&n);\n    n++;\n    for(int i=2;i<=n;i++){\n        int k;\n        scanf(\"%d\",&k);\n        if(k==0){\n            ljb[1].push_back(i);\n            G[i].push_back(1);\n        }\n        while(k){\n            k++;\n            ljb[k].push_back(i);\n            G[i].push_back(k);\n            scanf(\"%d\",&k);\n        }\n    }\n    dfs(1);\n    for(int i=1;i<=n;i++){\n        sdom[i]=i;\n        father[i]=i;\n        ans[i]=i;\n    }\n    for(int i=cnt;i>1;i--){\n        int tmp=rnk[i];\n        for(int v:G[tmp]){\n            if(!dfn[v])continue;\n            unionn(v);\n            if(dfn[sdom[tmp]]>dfn[sdom[ans[v]]]){\n                sdom[tmp]=sdom[ans[v]];\n            }\n        }\n        father[tmp]=fa[tmp];\n        tree[sdom[tmp]].push_back(tmp);\n        tmp=father[tmp];\n        for(int v:tree[tmp]){\n            unionn(v);\n            if(tmp==sdom[ans[v]])idom[v]=tmp;\n            else idom[v]=ans[v];\n        }\n        tree[tmp].clear();\n    }\n    for(int i=2;i<=cnt;i++){\n        int tmp=rnk[i];\n        if(idom[tmp]^sdom[tmp]){\n            idom[tmp]=idom[idom[tmp]];\n        }\n    }\n    for(int i=cnt;i>1;i--){\n        res[idom[rnk[i]]]+=res[rnk[i]]+1;\n    }\n    for(int i=2;i<=n;i++){\n        printf(\"%d\\n\",res[i]);\n    }\n    return 0;\n}\n```\n\nDAG \u4e0a\u652f\u914d\u6811\u4ee3\u7801\u5982\u4e0b\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n;\nvector<int> ljb[65550];\nvector<int> G[65550];\nvector<int> nt[65550];\nint rd[65550];\nint idom[65550][25];\nint dep[65550];\nint ans[65550];\nint lca(int x,int y){\n    if(dep[x]<dep[y])swap(x,y);\n    for(int i=20;i>=0;i--){\n        if(dep[idom[x][i]]>=dep[y]){\n            x=idom[x][i];\n        }\n    }\n    if(x==y)return x;\n    for(int i=20;i>=0;i--){\n        if(idom[x][i]^idom[y][i]){\n            x=idom[x][i];\n            y=idom[y][i];\n        }\n    }\n    return idom[x][0];\n}\nvoid toposort(){\n    queue<int> q;\n    q.push(1);\n    while(!q.empty()){\n        int tmp=q.front();\n        q.pop();\n        for(int v:ljb[tmp]){\n            rd[v]--;\n            if(!rd[v])q.push(v);\n        }\n        int LCA=0;\n        for(int pre:G[tmp]){\n            if(!LCA){\n                LCA=pre;\n                continue;\n            }\n            LCA=lca(LCA,pre);\n        }\n        idom[tmp][0]=LCA;\n        dep[tmp]=dep[LCA]+1;\n        for(int i=1;i<=20;i++){\n            idom[tmp][i]=idom[idom[tmp][i-1]][i-1];\n        }\n    }\n    return;\n}\nvoid dfs(int cur){\n    ans[cur]=0;\n    for(int v:nt[cur]){\n        dfs(v);\n        ans[cur]+=ans[v]+1;\n    }\n    return;\n}\nint main(){\n    scanf(\"%d\",&n);\n    n++;\n    for(int i=2;i<=n;i++){\n        int k;\n        scanf(\"%d\",&k);\n        if(k==0){\n            ljb[1].push_back(i);\n            G[i].push_back(1);\n            rd[i]++;\n        }\n        while(k){\n            k++;\n            ljb[k].push_back(i);\n            G[i].push_back(k);\n            rd[i]++;\n            scanf(\"%d\",&k);\n        }\n    }\n    toposort();\n    for(int i=2;i<=n;i++){\n        nt[idom[i][0]].push_back(i);\n    }\n    dfs(1);\n    for(int i=2;i<=n;i++){\n        printf(\"%d\\n\",ans[i]);\n    }\n    return 0;\n}\n```\n\n#### \u6811\u4e0a\u652f\u914d\u6811\n\n\u6811\u4e0a\u7684\u652f\u914d\u6811\u8fd8\u53ef\u4ee5\u968f\u7740\u6811\u7684\u5f62\u6001\u7684\u53d8\u5316\u800c\u52a8\u6001\u53d8\u5316\u3002\n\n[\u6a21\u677f](https://www.luogu.com.cn/problem/P3690)\n\n\u5bb9\u6613\u53d1\u73b0\u4e00\u68f5\u6811\u7684\u652f\u914d\u6811\u5c31\u662f\u4ed6\u81ea\u5df1\uff0c\u6240\u4ee5\u8fd9\u4e2a\u6ca1\u6709\u5e94\u7528\u3002\n\n#### \u603b\u7ed3\n\n\u82b1\u91cc\u80e1\u54e8\u7684\u652f\u914d\u6811\u6ca1\u4e00\u822c\u56fe\u652f\u914d\u6811\u597d\u5199\u597d\u7528\u597d\u5feb\u3002\n\n\u6ca1\u4e86\u3002",
        "postTime": 1668411178,
        "uid": 679749,
        "name": "EastSnowLotus",
        "ccfLevel": 0,
        "title": "\u652f\u914d\u6811\u4e4b\u4e0d\u62fc\u640f\u5c31\u4f1a\u88ab\u79d1\u6280\u54e5\u540a\u6253"
    },
    {
        "content": "\u65f6\u9694 ? \u5e74\u6211\u53c8\u6765\u5199\u652f\u914d\u6811\u9898\u89e3\u529b\uff01~~\u7136\u800c\u5185\u5bb9\u5e76\u6ca1\u6709\u53d8\u591a\u5c11\u5566233~~\n\n~~\u8fd8\u8bb0\u5f97\u5c0f\u7c89\u5154\u7684\u9000\u56de\u9898\u89e3\u4fe1\u606f\uff1a[\u6570\u636e\u5220\u9664]~~\n\n\u7136\u800c\u8fd9\u56de\u6211\u4fee\u597d $\\LaTeX$ \u529b\uff01\n\n\u4e0b\u9762\u662f\u6b63\u6587 .\n***\n\u53ef\u80fd\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff1a[cnblogs](https://www.cnblogs.com/CDOI-24374/p/15083198.html) .\uff08\u4e0d\u592a\u7528\u6d1b\u8c37\u535a\u5ba2\uff0c\u66f4\u65b0\u5e94\u8be5\u8fd8\u662f\u66f4\u5728 cnblogs\uff09\n\n\u4ee3\u7801\u90fd\u5728\u6700\u540e .\n\n\u5982\u679c\u5185\u5bb9\u6709\u8bef\u8bf7\u6307\u51faqwq\n\n## 1. \u652f\u914d\u6811\u7b80\u4ecb\n\u652f\u914d\u6811\u7684\u5b9a\u4e49\uff1a\n> \u5bf9\u4e8e\u4e00\u5f20\u6709\u5411\u56fe $\\mathrm G$\uff0c\u6307\u5b9a\u4e00\u8d77\u70b9 $s$ .\uff08\u6216\u8bb8\u4e5f\u88ab\u79f0\u4f5c\u6d41\u7a0b\u56fe\uff1f\uff09\n> \n> \u70b9 $u$ \u652f\u914d\u70b9 $v$\uff08\u5373 $u$ \u4e3a $v$ \u7684 **\u652f\u914d\u70b9**\uff09\u5f53\u4e14\u4ec5\u5f53 $s$ \u5230\u8fbe $v$ \u7684\u6240\u6709\u8def\u5f84\u90fd\u5fc5\u987b\u901a\u8fc7 $u$\uff08\u8fd9\u610f\u5473\u7740**\u5982\u679c\u53bb\u6389\u70b9 $\\textit{u}$ \u5219\u4ece $\\textit{s}$ \u4e0d\u53ef\u80fd\u5230\u8fbe $\\textit{v}$**\uff09\n> \n> \u5c06\u6240\u6709\u70b9 $u$ \u5411\u5176\u6700\u8fd1\u652f\u914d\u70b9\uff08\u5176\u5b9a\u4e49\u5728\u540e\u9762\uff09\u8fde\u8fb9\uff0c\u4e0d\u96be\u53d1\u73b0\uff0c\u4f1a\u5f97\u5230\u4e00\u68f5\u6811\uff0c\u8fd9\u68f5\u6811\u5c31\u53eb\u505a\u56fe $\\mathrm G$ \u7684\u652f\u914d\u6811\uff08Dominator Tree\uff09.\n\n\n## 2. \u652f\u914d\u6811\u7684\u6c42\u6cd5\n### 2.1. \u6811\u7684\u652f\u914d\u6811\n\u5373\u4e3a\u5176\u672c\u8eab\uff08\n### 2.2. DAG \u7684\u652f\u914d\u6811\n\u9898\u76ee\uff1a[\\[ZJOI2012\\]\u707e\u96be](https://www.luogu.com.cn/problem/P2597)\n\n\u7531\u4e8e\u4e0d\u5403\u4efb\u4f55\u4e1c\u897f\u7684\u751f\u7269\u53ef\u80fd\u6709\u591a\u79cd\uff0c\u5148\u52a0\u4e00\u4e2a\u865a\u62df\u8282\u70b9\u8fde\u5411\u6240\u6709\u4e0d\u5403\u4e1c\u897f\u7684\u751f\u7269 .\n\n\u4e0d\u96be\u53d1\u73b0\uff0c$u$ \u706d\u7edd\u5f53\u4e14\u4ec5\u5f53 $u$ \u7684\u6240\u6709\u76f4\u63a5\u98df\u7269\u7684 LCA \u706d\u7edd .\n\n\u6309\u652f\u914d\u6811\u5b9a\u4e49\uff0c\u628a $u$ \u7684\u6240\u6709\u76f4\u63a5\u98df\u7269\u7684 LCA \u548c $u$ \u8fde\u8fb9\uff0c\u652f\u914d\u6811\u5c31\u5efa\u597d\u529b .\n\n\u53ea\u9700\u6309\u62d3\u6251\u5e8f\u4f9d\u6b21\u52a0\u8fb9\uff0c\u5373\u53ef\u5efa\u6210\u652f\u914d\u6811 .\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u5bf9\u4e8e\u751f\u7269 $u$\uff0c$u$ \u5728\u652f\u914d\u6811\u4e0a\u7684\u5b50\u6811\u5927\u5c0f\u5373\u4e3a\u9898\u76ee\u8981\u6c42\u7684\u7b54\u6848 .\n\n### 3.3. \u4efb\u610f\u6709\u5411\u56fe\u7684\u652f\u914d\u6811\n\n\u58f0\u660e\uff1a\u5185\u5bb9\u90fd\u662f\u611f\u6027\u7406\u89e3\uff0c\u60f3\u770b\u8be6\u7ec6\u8bc1\u660e\u53ef\u89c1\uff1a<https://www.cnblogs.com/meowww/archive/2017/02/27/6475952.html>\n\n\u8bb0\u53f7\u58f0\u660e\uff1a\n- $\\operatorname{dfn}(u)$ \u4e3a $u$ \u7684\u56fe\u7684 DFS \u5e8f\u4e2d $u$ \u7684\u7f16\u53f7 .\n- $u\\mathrm{\\, dom\\,}v$ \u8868\u793a $u$ \u662f $v$ \u7684\u652f\u914d\u70b9 .\n- $\\operatorname{idom}(u)$ \u4e3a $u$ \u7684\u6700\u8fd1\u652f\u914d\u70b9 .\n- $\\operatorname{sdom}(u)$ \u4e3a $u$ \u7684\u534a\u652f\u914d\u70b9 .\n\n\u5148\u653e\u4e0a $\\operatorname{idom}$ \u548c $\\operatorname{sdom}$ \u7684\u5b9a\u4e49\uff1a\n\n\u6700\u8fd1\u652f\u914d\u70b9\uff08immediate dominator\uff09\u7684\u5b9a\u4e49\uff1a\n> \u5728\u652f\u914d $u$ \u7684\u70b9\u4e2d\uff0c\u5982\u679c\u4e00\u4e2a\u652f\u914d\u70b9 $v\\neq u$ \u6ee1\u8db3 $v$ \u88ab $u$ \u5269\u4e0b\u7684\u6240\u6709\u975e\u5e73\u51e1\u652f\u914d\u70b9\uff08\u5373\u4e0d\u662f\u81ea\u5df1\u6216\u8d77\u70b9\u7684\u652f\u914d\u70b9\uff09\u652f\u914d\uff0c\u5219\u8fd9\u4e2a $v$ \u79f0\u4f5c $u$ \u7684 **\u6700\u8fd1\u652f\u914d\u70b9**\uff0c\u8bb0\u4f5c $\\operatorname{idom}(u)$ .\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u6700\u8fd1\u652f\u914d\u70b9\u552f\u4e00 .\n\n\u534a\u652f\u914d\u70b9\uff08semi-dominator\uff09\u7684\u5b9a\u4e49\uff1a\n> \u5728 $u$ \u7684\u7956\u5148\u4e2d\uff0c\u901a\u8fc7\u975e\u6811\u679d\u8fb9\u53ef\u4ee5\u5230\u6253 $u$ \u6df1\u5ea6\u6700\u5c0f\u7684\u7956\u5148\uff0c\u79f0\u4f5c $u$ \u7684\u534a\u5fc5\u7ecf\u70b9\uff0c\u8bb0\u505a $\\operatorname{sdom}(u)$\uff08\u4e5f\u53ef\u8bb0  $\\operatorname{semi}(u)$\uff09.\n\n\u534a\u652f\u914d\u70b9\u663e\u7136\u552f\u4e00 .\n\n***\n\n\u7b97\u6cd5\u6d41\u7a0b\uff1a\n\n\u9996\u5148\uff0c\u6c42\u51fa\u539f\u56fe\u7684\u968f\u4fbf\u4e00\u68f5 DFS \u6811\uff0c\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u628a\u56fe\u4e0a\u7684\u8fb9\u5206\u4e3a\u56db\u7c7b\uff1a\n- \u6811\u679d\u8fb9\uff1a\u5728 DFS \u6811\u4e0a\u7684\u8fb9\uff08\u5176\u4f59\u8fb9\u79f0\u4f5c\u975e\u6811\u679d\u8fb9\uff09.\n- \u524d\u5411\u8fb9\uff1a\u4ece DFS \u6811\u4e0a\u7684\u7956\u5148\u6307\u5411\u540e\u4ee3 .\n- \u540e\u5411\u8fb9\uff1a\u4ece DFS \u6811\u4e0a\u7684\u540e\u4ee3\u6307\u5411\u7956\u5148 .\n- \u6a2a\u53c9\u8fb9\uff1a\u4ece\u4e00\u68f5\u5b50\u6811\u5185\u6307\u5411\u53e6\u4e00\u68f5\u5b50\u6811\u5185 .\n\n\u5148\u653e\u4e0a\u4e00\u5b9a\u7406\uff1a\n> \u5bf9\u4e8e $u\\neq S$\uff08$S$ \u662f\u8d77\u70b9\uff09\uff0c$v$ \u4e3a\u6240\u6709\u6ee1\u8db3 $\\operatorname{sdom}(u)$ \u53ef\u901a\u8fc7\u4e00\u6761\u6811\u679d\u8fb9\u5230\u8fbe $v$\uff0c$v$ \u53c8\u53ef\u901a\u8fc7\u4e00\u6761\u6811\u679d\u8fb9\u5230\u8fbe $u$\uff0c\u4e14 $\\operatorname{sdom}(u)\\neq v$\n>\n> $$\\large\\operatorname{idom}(u)=\\begin{cases}\\operatorname{sdom}(u)&\\operatorname{sdom}(u)=\\operatorname{sdom}(v)\\\\\\operatorname{idom}(v)&\\operatorname{sdom}(u)\\neq\\operatorname{sdom}(v)\\end{cases}$$\n\n\u8bc1\u660e\u53ef\u4ee5\u611f\u6027\u7406\u89e3\uff0c\u5373\u4e3a\u6309\u6700\u8fd1\u652f\u914d\u70b9\u662f\u5426\u53ef\u4ee5\u7ed5\u8fc7\u53bb\u5230\u8fbe $u$ \u70b9\u5206\u7c7b\u8ba8\u8bba .\n\n\u4ece\u8fd9\u4e2a\u5b9a\u7406\u81f3\u5c11\u53ef\u4ee5\u770b\u51fa\uff0c\u6c42\u51fa\u6bcf\u4e2a\u70b9\u7684 $\\operatorname{sdom}$ \u5c31\u53ef\u6c42\u51fa\u6bcf\u4e2a\u70b9\u7684 $\\operatorname{idom}$ .\n\n\u90a3\u4e48 $\\operatorname{sdom}$ \u600e\u4e48\u6c42\u5462\uff1f\n\n\u6211\u4eec\u6709\n> \u5bf9\u4e8e\u4efb\u610f $w\\neq S$\n> \n> $$\\large \\begin{aligned}\\operatorname{sdom}(w)=\\min\\{\\{v\\mid (v,w)\\in E,\\, v<w\\}\\cup\\{\\operatorname{sdom}(u)\\mid (v,w)\\in E,\\,u>w,\\,t(u,v)\\}\\}\\end{aligned}$$\n> \u5176\u4e2d $t(u,v)$ \u6307\u5728 DFS \u6811\u4e0a $u$ \u4e0e $v$ \u53ef\u901a\u8fc7\u4e00\u6761\u6811\u679d\u8fb9\u4e92\u901a .\n\n\u8fd9\u4e2a\u4e5f\u53ef\u4ee5\u611f\u6027\u7406\u89e3\uff0c\u524d\u9762\u90a3\u4e2a\u96c6\u5408\u662f\u540e\u5411\u8fb9\u548c\u6a2a\u53c9\u8fb9\uff0c\u540e\u9762\u90a3\u4e2a\u96c6\u5408\u662f\u524d\u5411\u8fb9\u548c\u6811\u679d\u8fb9 .\n\n\u6839\u636e\u4e0a\u9762\u90a3\u4e2a\u4e1c\u897f\u5c31\u80fd\u8f7b\u266a\u677e\u6c42\u51fa $\\operatorname{sdom}$ \u4e86\n\n\u4ee3\u7801\u4e5f\u5f88\u597d\u5199\uff0c\u7528\u5e26\u6743\u5e76\u67e5\u96c6\u53ef\u4ee5\u8f7b\u677e\u7ef4\u62a4\u6700\u5c0f\u503c .\n\n\u8fd9\u4e2a\u73a9\u610f\u5c31\u53eb\u505a **Lengauer-Tarjan \u7b97\u6cd5**\n## 2. \u9898\n\u9898\u5012\u662f\u86ee\u5c11\u7684\uff0c\u51fa\u51fa\u6765\u4e5f\u662f\u6a21\u677f\n\n\u611f\u89c9\u51fa\u9898\u7a7a\u95f4\u633a\u5927\u5427\n### 1. Codeforces 757F\n\u9898\u610f\uff1a\u7565\n\nDAG \u4e0a\u652f\u914d\u6811\u677f\u5b50\n### 2. Codechef GRAPHCNT\n\n\u9898\u610f\uff1a\n> \u95ee\u6709\u591a\u5c11\u4e2a\u70b9\u5bf9 $(x,y)$\uff0c\u6ee1\u8db3\u5b58\u5728\u8def\u5f84 $1\\to x$\uff0c$1\\to y$ \u6ee1\u8db3 \u4e24\u6761\u8def\u5f84\u516c\u5171\u70b9\u53ea\u6709\u70b9 $1$\n\n\u5c31\u662f\u652f\u914d\u6811\u4e0a LCA \u4e3a $1$ \u7684\u70b9\u5bf9\uff0c\u968f\u4fbf\u7edf\u8ba1\u4e0b\u5c31\u53ef .\n### 3. \u5c0fW\u4e0e\u65bd\u5de5\n\n\u9898\u610f\uff1a\n> \u4e00\u4e2a\u65e0\u73af\u6d41\u7a0b\u56fe\uff08\u542b\u8d77\u70b9 $s$\uff0c\u7ec8\u70b9 $t$ \u7684 DAG\uff09\uff0c$q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u53bb\u6389\u4e00\u6761\u8fb9\uff0c\u95ee $s$ \u5230 $t$ \u7684\u6700\u77ed\u8def\u662f\u5426\u53d1\u751f\u6539\u53d8 .\n\n\u8003\u8651 $s$ \u5230 $t$ \u7684\u6700\u77ed\u8def\u56fe\uff0c\u4e8e\u662f\u95ee\u9898\u53d8\u6210\u5220\u8fb9\u5224\u8fde\u901a\u6027 .\n\n\u8fd9\u4e2a\u53ef\u4ee5 DAG \u4e0a\u652f\u914d\u6811\u505a\u5230 $O(n\\log n)$ .\n\n\u6b64\u5904\u53ef\u4ee5 tarjan \u6c42\u5272\u8fb9\u505a\u5230\u7ebf\u6027 .\n## Code\n### 1. \u707e\u96be \u4ee3\u7801\uff08DAG \u7684\u652f\u914d\u6811\uff09\n```cpp\nusing namespace std;\ntypedef long long ll;\nconst int N=100005,M=2*N,MOD=1e9+7;\nint head[N],shead[N],ver[M],nxt[M],tot=-1; // \u94fe\u5f0f\u524d\u5411\u661f\u76f8\u5173\nint n,m,deg[N]; // \u8f93\u5165\u53ca\u62d3\u6251\u76f8\u5173\nint father[N],siz[N]; // \u652f\u914d\u6811\u76f8\u5173\uff0cfather[u] \u5c31\u662f u \u5728\u652f\u914d\u6811\u4e0a\u7684\u7236\u4eb2\nint dep[N],,f[N][33]; // \u500d\u589e LCA \u76f8\u5173\uff08\u8fd9\u91cc\u56e0\u4e3a\u500d\u589e\u65b9\u4fbf\u5c31\u7528\u500d\u589e\u529b\uff09\nvoid addedge(int head[],int u,int v){ver[++tot]=v; nxt[tot]=head[u]; head[u]=tot;}\nint lca(int p1,int p2) // \u500d\u589e LCA\n{\n    if (dep[p1]<dep[p2]) swap(p1,p2);\n    for (int i=18;i>=0;i--)\n        if (dep[f[p1][i]]>=dep[p2]) p1=f[p1][i];\n    if (p1==p2) return p2;\n    for (int i=18;i>=0;i--)\n        if (f[p1][i]!=f[p2][i]) p1=f[p1][i],p2=f[p2][i];\n    return f[p1][0];\n}\nvoid topsort() // \u62d3\u6251\u6392\u5e8f\n{\n\tqueue<int> q;\n\tfor (int i=1;i<=n;i++)\n\t\tif (!deg[i]) q.push(i),father[i]=0; // \u5728\u5165\u961f\u65f6\u987a\u4fbf\u8fde\u4e0a\u865a\u62df\u8282\u70b9\n\twhile (!q.empty())\n\t{\n\t\tint u=q.front(),fa=father[u]; q.pop();\n\t\taddedge(shead,fa,u);\n\t\tf[u][0]=fa; dep[u]=dep[fa]+1;\n\t\tfor (int i=1;i<=22;i++) f[u][i]=f[f[u][i-1]][i-1]; // \u500d\u589e LCA \u9884\u5904\u7406\n\t\tfor (int i=head[u];~i;i=nxt[i])\n\t\t{\n\t\t\tint v=ver[i]; --deg[v];\n\t\t\tif (!deg[v]) q.push(v);\n\t\t\tif (father[v]==-1) father[v]=u; // \u6240\u6709\u76f4\u63a5\u98df\u7269\u7684 LCA \u5373\u4e3a\u7236\u4eb2\n\t\t\telse father[v]=lca(father[v],u);\n\t\t}\n\t}\n}\nvoid dfs(int x) // \u7edf\u8ba1\u7b54\u6848\n{\n\tsiz[x]=1;\n\tfor (int i=shead[x];~i;i=nxt[i]){dfs(ver[i]); siz[x]+=siz[ver[i]];}\n}\nint main()\n{\n\tmemset(head,-1,sizeof head); memset(shead,-1,sizeof shead);\n\tmemset(father,-1,sizeof father);\n\tscanf(\"%d\",&n);\n\tfor (int i=1,x;i<=n;i++)\n\t\twhile (~scanf(\"%d\",&x)&&x) addedge(head,x,i),++deg[i];\n\ttopsort(); dfs(0);\n\tfor (int i=1;i<=n;i++) printf(\"%d\\n\",siz[i]-1); // -1 \u662f\u4e3a\u4e86\u53bb\u6389\u81ea\u5df1\n\treturn 0;\n}\n```\n### 2. \u3010\u6a21\u677f\u3011\u652f\u914d\u6811\n```cpp\n\ntypedef long long ll;\nconst int N=20500,M=20*N;\nint n,m;\nint head[N],shead[N],ihead[N],rhead[N],ver[M],nxt[M],tot=-1; // \u94fe\u5f0f\u524d\u5411\u661f\u76f8\u5173 \nint siz[N],father[N],fa[N]; // \u5e76\u67e5\u96c6\u4e0e\u652f\u914d\u6811\u76f8\u5173 \nint dfn[N],id[N],low[N],sdom[N],idom[N],cnt; // \u652f\u914d\u70b9\u76f8\u5173 \nvoid addedge(int head[],int u,int v){ver[++tot]=v; nxt[tot]=head[u]; head[u]=tot;}\nvoid init(int n){for (int i=1;i<=n;i++) sdom[i]=low[i]=fa[i]=i;}\nvoid dfs1(int u) // dfs \u6811\u76f8\u5173 \n{\n\tdfn[u]=++cnt; id[cnt]=u;\n\tfor (int i=head[u];~i;i=nxt[i])\n\t{\n\t\tint v=ver[i];\n\t\tif (dfn[v]) continue;\n\t\tfather[v]=u; dfs1(v);\n\t}\n}\nint get(int u) // \u5e76\u67e5\u96c6 \n{\n\tif (u==fa[u])return u;\n\tint root=get(fa[u]);\n\tif (dfn[sdom[low[fa[u]]]]<dfn[sdom[low[u]]]) low[u]=low[fa[u]];\n\treturn fa[u]=root;\n}\nvoid tarjan()\n{\n\tint v;\n\tfor (int i=cnt;i>1;i--) // \u4ece\u53f6\u5b50\u8282\u70b9\u5f00\u59cb\u6c42 sdom\n\t{\n\t\tint u=id[i];\n\t\tfor (int j=rhead[u];~j;j=nxt[j])\n\t\t{\n\t\t\tv=ver[j];\n\t\t\tif (!dfn[v]) continue;\n\t\t\tget(v);\n\t\t\tif (dfn[sdom[low[v]]]<dfn[sdom[u]]) sdom[u]=sdom[low[v]];\n\t\t}\n\t\taddedge(shead,sdom[u],u);\n\t\tfa[u]=father[u]; //\u5408\u5e76\n\t\tu=father[u];\n\t\tfor (int j=shead[u];~j;j=nxt[j]) // \u6c42 idom \n\t\t{\n\t\t\tv=ver[j]; get(v);\n\t\t\tif (sdom[low[v]]==u) idom[v]=u;\n\t\t\telse idom[v]=low[v];\n\t\t}\n\t\tshead[u]=-1; //\u6e05\u7a7a\u7236\u8282\u70b9\u7684\u8fb9\n\t}\n\tfor (int i=2;i<=cnt;i++)\n\t{\n\t\tint u=id[i];\n\t\tif (idom[u]!=sdom[u]) idom[u]=idom[idom[u]];  // \u7528\u5f15\u7406\u8c03\u6574 idom\n\t}\n}\nvoid dfs2(int u) // \u7edf\u8ba1 \n{\n\tsiz[u]=1;\n\tfor(int i=ihead[u];~i;i=nxt[i])\n\t{\n\t\tint v=ver[i];\n\t\tdfs2(v);\n\t\tsiz[u]+=siz[v];\n\t}\n}\nint main()\n{\n\tmemset(head,-1,sizeof head);\n\tmemset(ihead,-1,sizeof ihead);\n\tmemset(rhead,-1,sizeof rhead);\n\tmemset(shead,-1,sizeof shead);\n\tscanf(\"%d%d\",&n,&m);\n\tfor (int i=1,u,v;i<=m;i++){scanf(\"%d%d\",&u,&v); addedge(head,u,v); addedge(rhead,v,u);}\n\tinit(n); // !!!!!!\n\tdfs1(1);\n\ttarjan();\n\tfor (int i=2;i<=n;i++)\n\t\tif (idom[i]) addedge(ihead,idom[i],i);\n\tdfs2(1);\n\tfor (int i=1;i<=n;i++) printf(\"%d \",siz[i]);\n\treturn 0;\n}\n```",
        "postTime": 1645575420,
        "uid": 227514,
        "name": "jijidawang",
        "ccfLevel": 0,
        "title": "\u611f\u6027\u7406\u89e3\u652f\u914d\u6811"
    },
    {
        "content": "\u8bf4\u5b9e\u8bdd\u9898\u89e3\u5168\u5728\u6ce8\u91ca\u91cc\u4e86\n\n~~\u4e8b\u5b9e\u4e0a\u6211\u662f\u4e09\u7bc7\u535a\u5ba2\u4e00\u8d77\u770b\u624d\u7406\u89e3\u7684~~\n\n\u8fd9\u91cc\u63a8\u8350\u4e24\u7bc7\u4e0d\u9519\u7684\u535a\u5ba2\n\n[\u8bc1\u660e\u975e\u5e38\u4e25\u8c28\uff0c\u4e5f\u5f88\u597d\u61c2](https://blog.csdn.net/litble/article/details/83019578)\n\n[\u795e\u4ed9\u201c\u6027\u611f\u201d\u7406\u89e3\u6cd5](https://blog.csdn.net/litble/article/details/83019578)\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#define For(i,a,b) for(int i=a;i<=b;i++)\n#define Ford(i,a,b) for(int i=a;i>=b;i--)\nconst int N=2e5+100,M=3e5+1000;\nvoid read(int &x)\n{\n\tint t=0,opt=1;\n\tchar c=getchar();\n\twhile (c<'0'||c>'9') (c=='-'?opt=-1:0),c=getchar();\n\twhile ('0'<=c&&c<='9')\n\t{\n\t\tt=t*10+c-'0';\n\t\tc=getchar();\n\t}\n\tx=t*opt;return ;\n}\nint n,m,x,y,idom[N],sdom[N];\nint nex[N],pre[N],sdom_nex[N],idom_nex[N];\nint Next[2*M+N+N],d[2*M+N+N],tol=0;\nvoid Link(int *nex,int x,int y)\n{\n\tNext[tol]=nex[x];\n\tnex[x]=tol;\n\td[tol]=y;\n\ttol++;\n}\nint dfn[N],cnt,pos[N],pa[N];\nvoid dfs(int now)\n{\n\tdfn[now]=++cnt;pos[cnt]=now;\n\tfor (int p=nex[now];p!=-1;p=Next[p]) if (!dfn[d[p]]) \n\t\tpa[d[p]]=now,dfs(d[p]);\n}\nnamespace Set\n{\n\tint pa[N],min[N];\n\tint Find(int x)\n\t{\n\t\tif (x==pa[x]) return x;\n\t\tint ans=Find(pa[x]);\n\t\tif (dfn[sdom[min[pa[x]]]]<dfn[sdom[min[x]]]) min[x]=min[pa[x]];\n\t\treturn pa[x]=ans;\n\t}\n} ;\nvoid Tarjan()\n{\n\tFord(i,n,2) //\u5c06\u641c\u7d22\u6811\u4e0as\u5230\u4ed6\u7684\u8def\u5f84\u7406\u89e3\u4e3as\u5230\u4ed6\u7684\u7b2c\u4e00\u6761\u8def\u5f84\n\t{\n\t\tint now=pos[i];\n\t\t//\u628asdom\u89c6\u4e3a\u6811\u5916\u8fb9\uff08\u56e0\u4e3a\u6811\u4e0a\u8def\u5f84\u4e00\u5b9a\u662f\u7b2c\u4e00\u6761\u8def\u5f84\uff0csdom\u4e0d\u53ef\u80fd\u4ece\u5c0f\u4e8e\u5f53\u524d\u6839\u7684\u5b50\u6811\u8fc7\u6765\uff09\n\t\t//\u679a\u4e3e d[p]->now  \uff0c\u4ece\u4ed6\u4eec\u5230 \u4ed6\u4eec\u548cnow\u7684LCA \u7684\u8def\u4e0a\u53d6\u6700\u5c0f\u7684sdom[]\n\t\t//\u56e0\u4e3a\u7ecf\u8fc7d[p]\u5230now\u7684\u5408\u6cd5\u4e14\u53ef\u80fd\u66f4\u65b0sdom[now]\u7684\u8def\u5f84 \n\t\t//1\uff09\u8d77\u70b9\u4e00\u5b9a\u662fnow\u7684\u7956\u5148 \uff08sdom[now]<=fa[now],\u4e14\u5f15\u7406\uff1adfn\u5c0f\u4e8enow\u7684\u70b9\u5230now\u4e00\u5b9a\u7ecf\u8fc7\u5176\u548cnow\u7684\u7956\u5148\uff09\n\t\t//\t\u8bc1\u5f15\u7406\uff1a\u60f3\u8c61\u4e00\u4e0b\u6709\u4e00\u68f5\u5efa\u4e86\u4e00\u534a\u7684\u641c\u7d22\u6811\uff0c\u4e00\u4e2a\u70b9x\uff0c\u4ed6\u8981\u5230\u4e00\u4e2a\u8fd8\u6ca1\u6709\u904d\u5386\u7684\u70b9y\uff08dfn>x\uff09\uff0c\u90a3\u4e48\u4e00\u5b9a\u4f1a\u4ece\u4ed6\u6216\u8005\u4ed6\u7956\u5148\u4e0a\u7684\u4e00\u4e2a\u70b9\u8d70\u8fc7\u53bb\n\t\t//2\uff09\u4e00\u5b9a\u662f\u5148\u7ecf\u8fc7\u4e00\u6bb5\u975e\u6811\u8fb9\uff08\u6216\u8005\u662fLCA\u5230LCA\u5b69\u5b50\u7684\u4e00\u5c0f\u6bb5\uff09\uff08\u5373sdom\uff09\uff0c\u7136\u540e\u518d\u968f\u4fbf\u8d70\uff08\u6811\u8fb9\u6216\u975e\u6811\u8fb9\uff09\u5230d[p]\n\t\tfor(int p=pre[now];p!=-1;p=Next[p]) \t\n\t\t{\t\n\t\t\tSet::Find(d[p]);//d[p]\u7684\u7956\u5b97\u6700\u591a\u6709\u4e00\u4e2a\u70b9dfn\u5c0f\u4e8enow\uff0c\u4e14min\u7b49\u4e8e\u81ea\u5df1\uff0c\u6240\u4ee5\u662f\u5bf9\u7684\n\t\t\t//\u5e76\u67e5\u96c6min\u5b58\u7684\u662f\u4ed6\u5230\u7956\u5b97\u8def\u4e0asdom\u6700\u5c0f\u7684\u70b9\uff0c\u662f\u4e3a\u4e86\u66f4\u65b0idom\n\t\t\tif (dfn[sdom[Set::min[d[p]]]]<dfn[sdom[now]]) sdom[now]=sdom[Set::min[d[p]]];\n\t\t}\n\t\tLink(sdom_nex,sdom[now],now);//\u4e3a\u4e86\u7b97\u652f\u914d\u70b9\n\t\tSet::pa[now]=pa[now];//\u4ed6\u7684\u534a\u652f\u914d\u70b9\u89e3\u51b3\u4e86\uff0c\u5e76\u5230\u5e76\u67e5\u96c6\u91cc\n\t\tnow=pos[i-1];//\u6b64\u65f6sdom\u53ef\u80fd\u4e3anow\u7684\u70b9\u90fd\u89e3\u51b3\u4e86\n\t\tfor(int p=sdom_nex[now];p!=-1;p=Next[p])\n\t\t{\n\t\t\tSet::Find(d[p]);//\u6b64\u65f6d[p]\u7684\u7956\u5b97\u4e00\u5b9a\u662fnow\uff0cmin\u53ea\u4f1a\u53d6\u5230\u8def\u5f84\u4e0a\u70b9\uff08\u4e5f\u6709\u53ef\u80fd\u53d6\u5230now\uff0c\u4e0d\u8fc7\u6b64\u65f6sdom[now]=now\uff09\uff0c\u6240\u4ee5\u662f\u5bf9\u7684\n\t\t\t//https://blog.csdn.net/litble/article/details/83019578\n\t\t\tif (sdom[Set::min[d[p]]]==now) idom[d[p]]=now;\n\t\t\t\t//\u5bf9\u4e8e\u6240\u6709\u652f\u914d\u70b9\uff0c\u641c\u7d22\u6811\u6700\u6df1\u7684\u652f\u914d\u70b9\u624d\u662fidom\n\t\t\t\t//\u5148\u8003\u8651now\u662f\u4e0d\u662fd[p]\u7684\u652f\u914d\u70b9\uff0c\u5982\u679cnow\u4e0a\u9762\u6ca1\u6709\u4eba\u53ef\u4ee5\u4e0d\u7ecf\u8fc7now\u5230   now\u548cd[p] \u8def\u5f84\u4e2d\u7684\u70b9\uff08\u975enow\uff09\uff0c\u90a3\u4e48now\u652f\u914dd[p]\n\t\t\telse idom[d[p]]=Set::min[d[p]];\n\t\t\t\t//\u5982\u679cnow\u4e0d\u662fd[p]\u652f\u914d\u70b9\uff0c\u90a3\u4e48\u7684\u4e0b\u4e00\u4e2ad[p]\u7684\u53ef\u80fd\u652f\u914d\u70b9\u4e00\u5b9a\u662fnow+->u \u00b7->d[p]\u7684sdom\u6700\u5c0f\u7684\u90a3\u4e2au\uff0c\u7136\u540e\u5728\u5224\u65adsdom[u]\u662f\u4e0d\u662fu\u652f\u914d\u70b9\n\t\t\t\t//\u8fd9\u4e00\u8fc7\u7a0b\u53ef\u4ee5\u7406\u89e3\u4e3a\u9012\u5f52\uff0c\u7136\u540e\u76f8\u5f53\u4e0e\u7528idom\u8bb0\u5fc6\u5316 \u5373idom[d[p]]=idom[min[d[p]]]\n\t\t\t\t//\u53c8\u56e0\u4e3amin[d[p]]\u5c0f\u4e8enow\uff0c\u6240\u4ee5\u5148\u8bb0\u4e0b\u6765\u7136\u540e\u586b\u5751\n\t\t}\n\t}\n\tFor(i,2,n) if (idom[pos[i]]!=sdom[pos[i]]) idom[pos[i]]=idom[idom[pos[i]]];\n\tFor(i,2,n) Link(idom_nex,idom[i],i);\n}\nint ans[N];\nvoid dfs_ans(int now)\n{\n\tans[now]=1;\n\tfor(int p=idom_nex[now];p!=-1;p=Next[p]) dfs_ans(d[p]),ans[now]+=ans[d[p]];\n}\nint main()\n{\n//\tfreopen(\"xx.in\",\"r\",stdin);\n\tmemset(nex,-1,sizeof(nex));memset(pre,-1,sizeof(pre));\n\tmemset(idom_nex,-1,sizeof(idom_nex));\n\tmemset(sdom_nex,-1,sizeof(sdom_nex));\n\tread(n);read(m);\n\tFor(i,1,n) Set::min[i]=i,Set::pa[i]=i,sdom[i]=i;//dominate \u4e3b\u5bb0  \u8fd9\u6837\u521d\u59cb\u5316\uff0c\u4fdd\u8bc1\u7b54\u6848\u6b63\u786e\u6027\n\tFor(i,1,m) read(x),read(y),Link(nex,x,y),Link(pre,y,x);\n\tdfs(1);Tarjan();\n\tdfs_ans(1);For(i,1,n) printf(\"%d \",ans[i]);\n\treturn 0;\n}\n```\n",
        "postTime": 1557415052,
        "uid": 87510,
        "name": "\u54af\u54af\u54af",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5180 \u3010\u3010\u6a21\u677f\u3011\u652f\u914d\u6811\u3011"
    },
    {
        "content": "\u5e7f\u544a\uff1a\u540c\u6b65\u4e8e\u6211\u7684\u535a\u5ba2\u56ed [Charlie-Vinnie](https://www.cnblogs.com/Charlie-Vinnie/p/16767284.html)\n\uff0c\u98df\u7528\u6548\u679c\u66f4\u4f73\n\n---\n\n# \u652f\u914d\u6811\uff1a\u5728 $O(n\\log n)$ \u65f6\u95f4\u5185\u6c42\u51fa\u4e00\u5f20\u6709\u5411\u56fe\u4e2d\u80fd\u5207\u65ad\u4e00\u4e2a\u70b9\u5230\u8d77\u70b9\u7684\u6240\u6709\u8def\u5f84\u7684\u70b9\n\n\u5177\u4f53\u5730\uff0c\u5148\u5b9a\u4e49\u4e00\u4e2a\u8d77\u70b9 $S$\uff08\u8981\u6c42\u5b83\u80fd\u5230\u8fbe\u6240\u6709\u70b9\uff09\uff0c\u5bf9\u4e8e\u56fe\u4e2d\u4e00\u4e2a\u70b9 $u$\uff0c\u5b58\u5728\u4e00\u4e9b\u70b9 $v$\uff0c\u4f7f\u5f97\u5220\u53bb\u67d0\u4e2a $v$ \u540e $S$ \u65e0\u6cd5\u8d70\u5230 $u$\uff0c\u8fd9\u4e9b\u70b9 $v$ \u6240\u7ec4\u6210\u7684\u96c6\u5408\u5c31\u662f\u652f\u914d\u6811\u4e0a $u$ \u5230\u6839\u7684\u8def\u5f84\u3002\u7279\u522b\u5730\uff0c$u$ \u7684\u7236\u4eb2\u5c31\u662f\u79bb\u5b83\u6700\u8fd1\u7684\u652f\u914d\u70b9\u3002\n\n**\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u6027\u8d28\uff1a\u5bf9\u4e8e\u4efb\u610f\u70b9 $u$\uff0c\u5982\u679c $x$ \u652f\u914d $u$ \u4e14 $y$ \u652f\u914d $u$\uff0c\u5219 $x$ \u4e0e $y$ \u4e4b\u95f4\u5b58\u5728\u652f\u914d\u5173\u7cfb\u3002**\n\u8bc1\u660e\u663e\u7136\u3002\u7531\u6b64\u4e0d\u96be\u63a8\u51fa\u652f\u914d\u5173\u7cfb\u5f62\u6210\u4e00\u68f5\u6811\u3002\n\n## \u6c42\u652f\u914d\u6811\u7684\u65b9\u6cd5\uff1a\n\n### 1. DAG \u4e0a\u6c42\u652f\u914d\u6811\n\n\u6309\u7167**\u62d3\u6251\u5e8f**\u679a\u4e3e\u6240\u6709\u70b9\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u70b9 $u$\uff0c**\u6240\u6709\u80fd\u5230\u8fbe\u5b83\u7684\u70b9\u7684\u652f\u914d\u6811\u5df2\u7ecf\u6c42\u51fa\uff0c** \u4e8e\u662f\u6211\u4eec\u679a\u4e3e $u$ \u7684\u5165\u70b9 $v$\uff0c\u627e\u51fa\u5b83\u4eec\u5728**\u5df2\u6c42\u51fa\u7684\u652f\u914d\u6811**\u4e0a\u7684 LCA\uff0c\u5373\u4e3a $u$ \u7684\u652f\u914d\u70b9\uff08\u8bc1\u660e\u611f\u6027\u7406\u89e3\uff09\uff0c\u7136\u540e\u5c06 $u$ \u52a0\u5165\u652f\u914d\u6811\u3002\n\n\u6ce8\u610f\u6211\u4eec\u9700\u8981\u201c\u52a8\u6001\u201d\u6c42\u8fd9\u4e2a LCA\uff0c\u8fd9\u95ee\u9898\u4e0d\u5927\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6bcf\u627e\u5230\u4e00\u4e2a $u$ \u7684\u7236\u4eb2\u65f6\u5c31\u7acb\u5373\u66f4\u65b0\u5b83\u7684\u500d\u589e\u6570\u7ec4 `fa[u][i]` \u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u5c31 $O(n\\log n)$\u3002\n\n### 2. \u4e00\u822c\u56fe\u4e0a\u6c42\u652f\u914d\u6811\n\n\u6211\u4eec\u53d1\u73b0\u5728 DAG \u4e0a\u5f88\u597d\u505a\uff0c\u8003\u8651\u5c06\u4e00\u822c\u56fe\u9f13\u6363\u6210\u4e00\u4e2a DAG \u4e14\u652f\u914d\u5173\u7cfb\u4e0d\u53d8\u3002\n\n\u7528\u8457\u540d\u7684 Tarjan \u601d\u60f3\uff0c\u6211\u4eec\u5148\u641c\u51fa\u4e00\u68f5 dfs \u6811\u518d\u8bf4\u3002\u7acb\u5373\u53d1\u73b0\u4e00\u4e2a\u70b9 $u$ \u7684\u652f\u914d\u70b9\u4e00\u5b9a\u5728\u5b83\u7684**dfs\u6811**\u7684\u7956\u5148\u4e2d\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u5f15\u5165\u4e00\u4e2a\u5927\u5bb6\u521d\u5b66 Tarjan \u5c31\u719f\u77e5\u7684\u5b9a\u7406\uff1a**\u5bf9\u4e8e\u6709\u5411\u56fe\u7684 dfs \u6811\u800c\u8a00\uff0c\u53ea\u5b58\u5728\u524d\u5411\u8fb9\u4e0e\u53cd\u5411\u8fb9\uff0c\u4e0d\u5b58\u5728\u6a2a\u53c9\u8fb9\u3002**\n\u5373\u53ea\u6709\u7956\u5148\u5411\u5b59\u5b50\u8fde\u8fb9\u6216\u5b59\u5b50\u5411\u7956\u5148\u8fde\u8fb9\u3002\n\n\u540c\u6837 DAG \u90e8\u5206\uff0c\u8fd9\u6b21\u6211\u4eec\u6309**dfs\u5e8f\u9006\u5e8f**\u5bf9\u6bcf\u4e2a\u70b9 $u$ \u8003\u8651\u5b83\u7684\u6240\u6709\u5165\u70b9 $v$\uff0c\u7ef4\u62a4\u4e00\u4e2a\u201c\u534a\u652f\u914d\u70b9\u201d$semi_u$\u3002\n\u5206\u4e24\u79cd\u60c5\u51b5\uff1a\n1. $v$ \u4e3a $u$ \u7684\u7956\u5148\u3002\n\u6b64\u65f6 $v$ \u80fd\u4e00\u6b65\u8d70\u5230 $u$\uff0c\u6240\u4ee5\u4ece $v$ \u5230 $u$ \u7684\u8def\u5f84\u4e0a\u6240\u6709\u5176\u5b83\u70b9\u90fd\u4e0d\u53ef\u80fd\u6210\u4e3a $u$ \u7684\u652f\u914d\u70b9\uff08\u5426\u5219\u538b\u6839\u5207\u4e0d\u65ad\uff09\uff0c\u6240\u4ee5 $u$ \u7684\u771f\u5b9e**\u652f\u914d\u70b9**\u5e94\u8be5\u5728 $v$ **\u4e0a\u65b9**\uff0c\u6545\u7528 $v$ \u66f4\u65b0 $u$ \u7684**\u534a\u652f\u914d\u70b9**\u3002\uff08\u8fd9\u91cc\u7684\u66f4\u65b0\u6307\u53d6 **dfs \u5e8f\u6700\u5c0f**\u7684\u4f5c\u4e3a\u7b54\u6848\uff09\n2. $v$ \u4e3a $u$ \u7684\u5b50\u5b59\u3002\n\u6b64\u65f6\u6211\u4eec\u8003\u8651 $u$ \u5230 $v$ \u7684\u8def\u5f84\u4e0a\u6240\u6709\u70b9 $w$ \u4ee5\u53ca\u5b83\u4eec\u7684**\u534a\u652f\u914d\u70b9** $semi_w$\uff0c\u53d1\u73b0\u5982\u679c\u6211\u4eec\u5272\u7684\u70b9\u5728\u4efb\u610f\u4e00\u4e2a $semi_w$ \u4e0b\u65b9\uff0c\u90a3\u4e48\u4ece\u6839\u5c31\u53ef\u4ee5\u8d70\u8def\u5f84 $S\\rightarrow semi_w\\rightarrow w\\rightarrow v\\rightarrow u$ \u5230\u8fbe $u$\uff0c\u77db\u76fe\u3002\u56e0\u6b64\u7528\u6240\u6709 $w$ \u7684**\u534a\u652f\u914d\u70b9** $semi_w$ \u66f4\u65b0 $u$ \u7684**\u534a\u652f\u914d\u70b9** $semi_u$\u3002\n\u753b\u4e2a\u56fe\u7406\u89e3\u4e00\u4e0b\uff1a\n![](https://img2022.cnblogs.com/blog/2560578/202210/2560578-20221007222917091-341503606.png)\n\n\u66f4\u65b0\u5b8c\u6bd5\u540e\uff0c\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u6bcf\u4e2a\u70b9 $u$ \u7684\u201c\u534a\u652f\u914d\u70b9\u201d\u3002**\u201c\u534a\u652f\u914d\u70b9\u201d\u7684\u672c\u8d28\u610f\u4e49\u5728\u4e8e\uff0c$u$ \u7684\u771f\u5b9e\u652f\u914d\u70b9\u4e00\u5b9a\u5728\u5b83\u7684\u534a\u652f\u914d\u70b9\u5230\u6839\u7684\u8def\u5f84\u4e0a\u3002\u56e0\u6b64\u53ea\u4fdd\u7559 dfs \u6811\u4e0a\u7684\u8fb9\u4ee5\u53ca\u65b0\u52a0\u5165\u7684 $semi_u\\rightarrow u$ \u7684\u8fb9\uff0c\u6574\u5f20\u56fe\u7684\u652f\u914d\u5173\u7cfb\u4e0d\u53d8\u3002**\n\n\u4e8e\u662f\u6211\u4eec\u53ea\u4fdd\u7559\u539f dfs \u6811\u4e2d\u7684\u8fb9\uff0c\u5c06\u5176\u5b83\u8fb9\u7edf\u7edf\u5220\u6389\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a $u$ \u52a0\u5165\u8fb9 $semi_u\\rightarrow u$\uff0c\u5728\u8fd9\u4e2a\u65b0\u7684\u53ea\u6709 $2(n-1)$ \u6761\u8fb9\u7684 DAG \u4e0a\u8dd1\u505a\u6cd5 1 \u5373\u53ef\u3002\n\n\u73b0\u5728\u53ea\u5269\u4e0b\u600e\u4e48\u5feb\u901f\u5bf9\u4e00\u4e2a\u70b9 $v$ \u627e\u51fa $u$ \u5230 $v$ \u7684\u8def\u5f84\u4e0a\u6240\u6709 $w$ \u7684 $semi_w$ \u7684 dfs \u5e8f\u6700\u5c0f\u503c\u7684\u95ee\u9898\u4e86\u3002\n\n\u8003\u8651\u7ef4\u62a4\u6bcf\u4e2a\u70b9 $v$ **\u5df2\u8bbf\u95ee**\u7684\u7956\u5148\u4e2d $semi$ \u7684\u6700\u5c0f\u503c $mn_v$\uff0c\u67e5\u8be2\u65f6\u6070\u597d\u5c31\u662f\u67e5\u8be2 $v$ \u7684 $mn_v$\uff08\u56e0\u4e3a $v$ \u7684\u7956\u5148\u4e2d\u7b2c\u4e00\u4e2a\u672a\u8bbf\u95ee\u7684\u70b9\u5c31\u662f $u$\uff09\u3002\u7528\u5e76\u67e5\u96c6\u7ef4\u62a4\uff0c\u6bcf\u6b21\u8bbf\u95ee\u5b8c\u4e00\u4e2a\u8282\u70b9 $u$ \u5c31\u88ab\u5176\u7236\u4eb2 $fa_u$ \u5408\u5e76\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\alpha(n))$ \u6216 $O(n\\log n)$\uff08\u6211\u4eec\u90fd\u61d2\u5f97\u5199\u6309\u79e9\u5408\u5e76\u5bf9\u5427\uff09\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n\u4e0a\u4e00\u4e2a\u5c01\u88c5\u597d\u7684\u4ee3\u7801\uff1a\uff08\u6ce8\u610f\u4ee3\u7801\u4e2d $mn_u$ \u76f4\u63a5\u5199\u6210\u4e86 `semi[u]`\uff0c\u6240\u4ee5\u5fc5\u987b\u5728\u8bbf\u95ee\u5b8c\u4e00\u4e2a $u$ \u4e4b\u540e\u7acb\u5373\u5c06\u5176\u52a0\u5165\u65b0\u56fe\u4e2d\uff09\n\n[\u6d1b\u8c37 P5180 \u3010\u6a21\u677f\u3011\u652f\u914d\u6811](https://www.luogu.com.cn/problem/P5180)\n\n```cpp\n#include <bits/stdc++.h>\n#define For(i,a,b) for(int i=a;i<=b;i++)\n#define Rev(i,a,b) for(int i=a;i>=b;i--)\n#define Fin(file) freopen(file,\"r\",stdin)\n#define Fout(file) freopen(file,\"w\",stdout)\nusing namespace std;\nconst int N=2e5+5; typedef long long ll;\nclass DominatorTree{\n    int n,dfn[N],raw[N],dfscnt,semi[N],fa[N],pa[N],ffa[N][18],dep[N],in[N];\n    vector<int> to[N],from[N],cp[N],cv[N];\n    void dfs(int u){\n        raw[dfn[u]=++dfscnt]=u; for(int v:to[u]) if(!dfn[v]) { cp[u].push_back(v); pa[v]=u; dfs(v); }\n    }\n    int getfa(int x){\n        if(x!=fa[x]) { int t=getfa(fa[x]); semi[x]=min(semi[x],semi[fa[x]]); fa[x]=t; } return fa[x];\n    }\n    int lca(int x,int y){\n        if(dep[x]<dep[y]) swap(x,y);\n        Rev(i,17,0) if(dep[ffa[x][i]]>=dep[y]) x=ffa[x][i];\n        if(x==y) return x;\n        Rev(i,17,0) if(ffa[x][i]!=ffa[y][i]) { x=ffa[x][i]; y=ffa[y][i]; }\n        return ffa[x][0];\n    }\npublic:\n    void init(int _n) { n=_n; }\n    void add_edge(int x,int y) { to[x].push_back(y); from[y].push_back(x); }\n    void solve(int* ans){\n        dfs(1); assert(dfscnt==n);\n        For(i,1,n) { fa[i]=i; semi[i]=dfn[i]; }\n        Rev(i,n,2){\n            int u=raw[i]; for(int w:from[u]) { getfa(w); semi[u]=min(semi[u],semi[w]); }\n            fa[u]=pa[u]; cp[raw[semi[u]]].push_back(u); // Must do it right now!\n        }\n        For(u,1,n) for(int v:cp[u]) { cv[v].push_back(u); in[v]++; }\n        static int q[N],h,t; h=t=0; q[t++]=1;\n        while(h<t){\n            int u=q[h++]; ans[u]=0;\n            for(int v:cv[u]) if(ans[u]==0) ans[u]=v; else ans[u]=lca(ans[u],v);\n            dep[u]=dep[ffa[u][0]=ans[u]]+1; For(i,1,17) ffa[u][i]=ffa[ffa[u][i-1]][i-1];\n            for(int v:cp[u]) if((--in[v])==0) q[t++]=v;\n        }\n    }\n}T;\nint n,m,ans[N],siz[N]; vector<int> son[N];\nvoid dfs(int u) { siz[u]=1; for(int v:son[u]) { dfs(v); siz[u]+=siz[v]; } }\nsigned main(){\n    ios::sync_with_stdio(false); cin.tie(0); cout.tie(0);\n    cin>>n>>m; T.init(n); For(i,1,m) { int x,y; cin>>x>>y; T.add_edge(x,y); }  T.solve(ans);\n    // For(i,1,n) cerr<<ans[i]<<' ';  cerr<<endl;\n    For(i,2,n) son[ans[i]].push_back(i);\n    dfs(1); For(i,1,n) cout<<siz[i]<<' '; cout<<endl;\n    cerr<<\"Time = \"<<clock()<<\" ms\\n\";\n    return 0;\n}\n\n// START TYPING IF YOU DON'T KNOW WHAT TO DO\n```",
        "postTime": 1665154091,
        "uid": 340903,
        "name": "\u51b7\u6708\u846cT\u9b42",
        "ccfLevel": 8,
        "title": "P5180 \u652f\u914d\u6811 \u9898\u89e3"
    }
]