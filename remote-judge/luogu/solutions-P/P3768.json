[
    {
        "content": "\u5f88\u660e\u663e\u7684\u628a$gcd$\u63d0\u51fa\u6765\n\n$$\\sum_{d=1}^nd\\sum_{i=1}^n\\sum_{j=1}^nij[gcd(i,j)==d]$$\n\n\u4e60\u60ef\u6027\u7684\u63d0\u51fa\u6765\n\n$$\\sum_{d=1}^nd^3\\sum_{i=1}^{n/d}\\sum_{j=1}^{n/d}ij[gcd(i,j)==1]$$\n\n\u540e\u9762\u8fd9\u73a9\u610f\u5f88\u660e\u663e\u7684\u6765\u4e00\u53d1\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\n\n$$\\sum_{d=1}^nd^3\\sum_{i=1}^{n/d}\\mu(i)i^2(1+2+...[\\frac{n}{id}])^2$$\n\n\u5199\u8d77\u6765\u597d\u9ebb\u70e6\u5440\n\n\u6211\u5c31\u8bbe$sum(x)=1+2+3+...x$\n\n\u4ee4$T=id$\n\n\u63d0\u51fa\u6765\uff01\n\n\n$$\\sum_{T=1}^nsum(\\frac{n}{T})^2\\sum_{d|T}d^3\\frac{T}{d}^2\\mu(\\frac{T}{d})$$\n\n\n\u6709\u4e9b$d$\u53ef\u4ee5\u7ea6\u6389\n\n$$\\sum_{T=1}^nsum(\\frac{n}{T})^2T^2\\sum_{d|T}d\\mu(\\frac{T}{d})$$\n\n\n\u73b0\u5728\u5982\u679c\u628a\u540e\u9762\u7ed9\u7b5b\u51fa\u6765\n\n\u53ef\u4ee5$O(\\sqrt n)$\u6c42\u5566\n\n\u73b0\u5728\uff0c\u95ee\u9898\u6765\u4e86\n\n$$T^2\\sum_{d|T}d\\mu(\\frac{T}{d})$$\u600e\u4e48\u7b97\uff1f\uff1f\n\n\n\u8003\u8651\u4e00\u4e2a\u5f0f\u5b50\uff1a\n\n$$(id*\\mu)(i)=\\varphi(i)$$\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c$\\mu$\u548c$id(x)=x$\u7684\u72c4\u5229\u514b\u96f7\u5377\u79ef\u7b49\u4e8e$\\varphi(i)$\n\n~~\u592a\u795e\u5947\u5566\uff01\uff01\uff01~~\n\n\n\u6240\u4ee5\u8bf4\uff0c\n\n$$T^2\\sum_{d|T}d\\mu(\\frac{T}{d})=T^2\\varphi(T)$$\n\n\n\u4ee4$$f(i)=i^2\\varphi(i)$$\n\n$$S(n)=\\sum_{i=1}^nf(i)$$\n\n\n\u675c\u6559\u7b5b\u5957\u8def\u7684\u5f0f\u5b50\u62ff\u51fa\u6765\n\n$$g(1)S(n)=\\sum_{i=1}^n(g*f)(i)-\\sum_{i=2}^ng(i)S(\\frac{n}{i})$$\n\n\u8fd8\u662f\u53d1\u73b0\u6709$\\varphi(i)$\u7684\u9879\n\n\u60f3\u5230$$\\sum_{d|i}\\varphi(d)=i$$\n\n\u6240\u4ee5\u4ee4$g(x)=x^2$\n\n\u6240\u4ee5\n$$S(n)=\\sum_{i=1}^n(g*f)(i)-\\sum_{i=2}^ng(i)S(\\frac{n}{i})$$\n\n\n$$(g*f)(i)=\\sum_{d|i}f(d)g(\\frac{i}{d})=\\sum_{d|i}d^2\\varphi(d)\\frac{i}{d}^2$$\n$$=i^2\\sum_{d|i}\\varphi(d)=i^3$$\n\n\n\u6240\u4ee5\n$$S(n)=\\sum_{i=1}^ni^3-\\sum_{i=2}^ni^2S(\\frac{n}{i})$$\n\n\u6839\u636e\u5c0f\u5b66\u5965\u6570\u7684\u7ecf\u9a8c\uff1a\n\n$1^3+2^3+....n^3=(1+2+....n)^2=sum(n)^2$\n\n\n\u6240\u4ee5\u73b0\u5728\u6709\uff1a\n\n$$ans=\\sum_{T=1}^nsum(\\frac{n}{T})^2\\ T^2\\sum_{d|T}d\\mu(\\frac{T}{d})$$\n\n\u524d\u9762\u53ef\u4ee5\u6570\u8bba\u5206\u5757\n\n\u540e\u9762\u7528\u675c\u6559\u7b5b\u53ef\u4ee5\u518d\u975e\u7ebf\u6027\u65f6\u95f4\u91cc\u9762\u6c42\u51fa\u524d\u7f00\u548c\n\n\u8fd9\u9053\u9898\u76ee\u5c31\u641e\u5b9a\u5566\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\n#include<set>\n#include<map>\n#include<vector>\n#include<queue>\nusing namespace std;\nint MAX=8000000;\n#define MAXN 8000000\n#define ll long long\ninline ll read()\n{\n    ll x=0,t=1;char ch=getchar();\n    while((ch<'0'||ch>'9')&&ch!='-')ch=getchar();\n    if(ch=='-')t=-1,ch=getchar();\n    while(ch<='9'&&ch>='0')x=x*10+ch-48,ch=getchar();\n    return x*t;\n}\nll MOD,n,inv6,inv2;\nint pri[MAXN],tot;\nll phi[MAXN+10];\nbool zs[MAXN+10];\nmap<ll,ll> M;\nll fpow(ll a,ll b)\n{\n    ll s=1;\n    while(b){if(b&1)s=s*a%MOD;a=a*a%MOD;b>>=1;}\n    return s;\n}\nvoid pre()\n{\n    zs[1]=true;phi[1]=1;\n    for(int i=2;i<=MAX;++i)\n    {\n        if(!zs[i])pri[++tot]=i,phi[i]=i-1;\n        for(int j=1;j<=tot&&i*pri[j]<=MAX;++j)\n        {\n            zs[i*pri[j]]=true;\n            if(i%pri[j])phi[i*pri[j]]=1ll*phi[i]*phi[pri[j]]%MOD;\n            else{phi[i*pri[j]]=1ll*phi[i]*pri[j]%MOD;break;}\n        }\n    }\n    for(int i=1;i<=MAX;++i)phi[i]=(phi[i-1]+1ll*phi[i]*i%MOD*i%MOD)%MOD;\n}\nll Sum(ll x){x%=MOD;return x*(x+1)%MOD*inv2%MOD;}\nll Sump(ll x){x%=MOD;return x*(x+1)%MOD*(x+x+1)%MOD*inv6%MOD;}\nll SF(ll x)\n{\n    if(x<=MAX)return phi[x];\n    if(M[x])return M[x];\n    ll ret=Sum(x);ret=ret*ret%MOD;\n    for(ll i=2,j;i<=x;i=j+1)\n    {\n        j=x/(x/i);\n        ll tt=(Sump(j)-Sump(i-1))%MOD;\n        ret-=SF(x/i)*tt%MOD;\n        ret%=MOD;\n    }\n    return M[x]=(ret+MOD)%MOD;\n}\nint main()\n{\n    MOD=read();n=read();\n    MAX=min(1ll*MAX,n);\n    inv2=fpow(2,MOD-2);\n    inv6=fpow(6,MOD-2);\n    pre();\n    ll ans=0;\n    for(ll i=1,j;i<=n;i=j+1)\n    {\n        j=n/(n/i);\n        ll tt=Sum(n/i);tt=tt*tt%MOD;\n        ll gg=(SF(j)-SF(i-1))%MOD;\n        ans+=gg*tt%MOD;\n        ans%=MOD;\n    }\n    printf(\"%lld\\n\",(ans+MOD)%MOD);\n    return 0;\n}\n\n```",
        "postTime": 1516101207,
        "uid": 21283,
        "name": "yybyyb",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u8fd9\u6837\u53cd\u6f14\u597d\u50cf\u66f4\u7b80\u5355\uff1f\u5c31\u662f\u5904\u7406$gcd(i,j)$\u7684\u601d\u8def\u53c2\u7167[[NOI2010]\u80fd\u91cf\u91c7\u96c6](https://www.luogu.org/problemnew/show/1447)\uff0c\u7528$\u03c6$\u5377\u79ef\u505a\n\n$\\sum ^{n}_{i=1}\\sum ^{n}_{j=1}ij\\gcd \\left( i,j\\right)$\n\n\n$=\\sum ^{n}_{i=1}\\sum ^{n}_{j=1}ij\\sum _{k|i,k|j} \u03c6(k)$\n\n$=\\sum ^{n}_{k=1} \u03c6(k) \\sum _{k|i}\\sum _{k|j}ij$\n\n$=\\sum ^{n}_{k=1}\\varphi \\left( k\\right) \\cdot k^{2}\\cdot (\\sum ^{n/k}_{i=1}i)^{2}$\n\n\n$=\\sum ^{n}_{k=1}\\varphi \\left( k\\right) \\cdot k^{2}\\cdot \\sum ^{n/k}_{i=1}i^{3}$\n\n``` cpp\n#include<bits/stdc++.h>\n#define maxn 4600000\n#define ll long long\nusing namespace std;\n\nint pri[maxn],phi[maxn],pricnt=0;\nll sphi[maxn],p,n,inv;\nbool notpri[maxn];\nmap<ll,ll> mp;\nll pw(ll a,ll b){\n    ll ret=1;\n    while(b){\n        if(b&1)\n            (ret*=a)%=p;\n        (a*=a)%=p;\n        b>>=1;\n    }\n    return ret;\n}\nvoid init(){\n    inv=pw(6,p-2);\n    phi[1]=1;\n    for(int i=2;i<maxn;i++){\n        if(!notpri[i]){\n            pri[++pricnt]=i;\n            phi[i]=i-1;\n        }\n        for(int j=1;j<=pricnt;j++){\n            if(i*pri[j]>=maxn)\n                break;\n            notpri[i*pri[j]]=true;\n            if(i%pri[j]==0){\n                phi[i*pri[j]]=phi[i]*pri[j];\n                break;\n            }\n            phi[i*pri[j]]=phi[i]*(pri[j]-1);\n        }\n    }\n    for(int i=1;i<maxn;i++)\n        sphi[i]=(sphi[i-1]+1LL*i*i%p*phi[i]%p)%p;\n}\nll s2(ll x){\n    x%=p;\n    return x*(x+1)%p*(2*x+1)%p*inv%p;\n} \nll s3(ll x){\n    x%=p;\n    return (x*(x+1)/2)%p*((x*(x+1)/2)%p)%p;\n}\nll calc(ll x){\n    if(x<maxn)\n        return sphi[x];\n    if(mp[x])\n        return mp[x];\n    ll pos,ret=s3(x);\n    for(ll i=2;i<=x;i=pos+1){\n        pos=x/(x/i);\n        (ret-=1LL*(s2(pos)-s2(i-1)+p)%p*calc(x/i)%p)%=p;\n    }\n    (ret+=p)%=p;\n    return mp[x]=ret;\n}\nll solve(){\n    ll pos,ret=0;\n    for(ll i=1;i<=n;i=pos+1){\n        pos=n/(n/i);\n        (ret+=1LL*(calc(pos)-calc(i-1)+p)%p*s3(n/i)%p)%=p;\n    }\n    (ret+=p)%=p;\n    return ret;\n}\nint main(){\n    scanf(\"%lld%lld\",&p,&n);\n    init();\n    printf(\"%lld\\n\",solve());\n    return 0;\n}\n```",
        "postTime": 1514367607,
        "uid": 31564,
        "name": "zhoutb2333",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u9898\u76ee\u8981\u6211\u4eec\u6c42\u4e00\u4e2a\u5f88\u6bd2\u7624\u7684\u4e1c\u4e1c\uff1a\n\n$$\\sum_{i=1}^n\\sum_{j=1}^n gcd(i,j)*ij$$\n\n\u6211\u4eec\u53ef\u4ee5\u5f88\u5957\u8def\u5730\u53bb\u5316\u7b80\u8fd9\u4e2a\u5f0f\u5b50\uff1a\uff08$x$\u4e3a\u679a\u4e3e\u7684$gcd$\uff09\n\n$$\\sum_{x=1}^nx^3\\sum_{i=1}^{n/x}\\sum_{j = 1}^{n/x}ij{[gcd(i,j)==1]}$$\n\n\u4e5f\u5c31\u662f\uff1a\n\n$$\\sum_{x=1}^nx^3\\sum_{i=1}^{n/x}\\sum_{j = 1}^{n/x}ij\\sum_{d|gcd(i,j)}\\mu(d)$$\n\n\u4e00\u822c\u5730\uff0c\u6211\u4eec\u628a$\\mu$\u653e\u5230\u524d\u9762\u53bb\u3002\n\n$$\\sum_{x=1}^nx^3\\sum_{d=1}^{n/x}d^2\\mu(d)*\\sum_{i=1}^{n/(x*d)}\\sum_{j=1}^{n/(x*d)}ij $$\n\n\u540e\u9762\u90a3\u4e00\u5768\u5176\u5b9e\u53ea\u548c$(n/(x*d))$\u6709\u5173\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u4e00\u70b9\u6570\u5b66\u77e5\u8bc6\u5316\u7b80\uff1a\n\n\u8bb0$g(x) = \\dfrac{x^2(x+ 1)^2}{4}$x\n\n\u6240\u4ee5\u539f\u6765\u7684\u5f0f\u5b50\u5176\u5b9e\u5c31\u662f\uff1a\n\n$$\\sum_{x=1}^nx^3\\sum_{d=1}^{n/x}d^2\\mu(d)*g(\\left\\lfloor\\dfrac{n}{xd}\\right\\rfloor)$$\n\n\u8003\u8651\u5957\u8def\uff1a\u8bb0$T = xd$\n\n\u6240\u4ee5\u539f\u6765\u7684\u5f0f\u5b50\u5c31\u662f\uff1a\n\n$$\\sum_{T=1}^n g(\\left\\lfloor\\dfrac{n}{xd}\\right\\rfloor)*(xd)^2\\sum_{x|T}\\mu(d)*(x)\\quad(d = T/x)$$\n\n\u5176\u5b9e\u4e5f\u5c31\u662f\uff1a\n\n$$\\sum_{T=1}^n g(\\left\\lfloor\\dfrac{n}{T}\\right\\rfloor)T^2\\sum_{x|T}\\mu(x)*(T/x)$$\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u4e24\u4e2a\u79ef\u6027\u51fd\u6570\u7684\u5377\u79ef\uff1a\n\n$\\sum_{d|x} f(d)*g(x/d)$\uff0c\uff08\u4e00\u822c\u4e5f\u5199$(f*g)(x)$\u4e3a$f(x)$\u4e0e$g(x)$\u7684\u5377\u79ef\uff09\u5176\u5b9e\uff0c\u4e24\u4e2a\u79ef\u6027\u51fd\u6570\u7684\u5377\u79ef\u5177\u6709\u4e00\u4e9b\u6bd4\u8f83\u5947\u5999\u7684\u6027\u8d28\u3002\n\n\u8fd9\u91cc\u9700\u8981\u7528\u5230\u7684\u662f\u8fd9\u4e24\u4e2a\uff1a\n\n**\u8fd9\u91cc\u7ed9\u51fa\u4e86\u4e00\u4e9b\u79ef\u6027\u51fd\u6570\u7684\u5377\u79ef\u662f\u4ec0\u4e48\u7684\u8bc1\u660e\uff0c\u53ef\u8df3\u8fc7**\n\n$(\\phi*I)(x) = Id(x)$\n\n$(\\mu*Id)(x) = \\phi(x)$\n\n\u5176\u4e2d\uff1a$\\phi$\u4e3a\u6b27\u62c9\u51fd\u6570\uff0c$\\mu$\u4e3a\u83ab\u6bd4\u4e4c\u65af\u51fd\u6570\uff0c$I(x) = 1$  $(x$\u4e3a\u4efb\u610f\u6570$)$\uff0c$Id(x) = x$\uff08\u540e\u9762\u8fd9\u4e24\u4e2a\u90fd\u662f\u5b8c\u5168\u79ef\u6027\u51fd\u6570\uff09\n\n\u7b80\u5355\u8bc1\u660e\u4e00\u4e0b\uff1a\n\n$(\\phi*I)(x) = Id(x)$\n\n\u5176\u5b9e\u5c31\u662f\uff1a\n\n$\\sum_{i|x} \\phi(i) * I(x/i)$\uff0c \u5176\u4e2d$I(x/i) = 1$\n\n\u4e5f\u5c31\u662f:\n\n$\\sum_{i|x}\\phi(i)$\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u6b27\u62c9\u51fd\u6570\u7684\u5b9e\u9645\u610f\u4e49\uff0c$\\phi(i)$\u8868\u793a\u4e3a$1-i$\u4e2d\u4e0e$i$\u4e92\u8d28\u7684\u6570\u7684\u4e2a\u6570\u3002\n\n\u90a3\u4e48\u6211\u4eec\u4e0d\u59a8\u5047\u8bbe$n$\u7684\u56e0\u5b50\u4f9d\u6b21\u4e3a\uff1a$1,p1,p2.......n(p_i$\u4e0d\u4e00\u5b9a\u4e3a\u8d28\u6570\uff01$)$\n\n\u63a5\u7740\u6211\u4eec\u8003\u8651\u5bf9\u4e8e$gcd(n, a) = 1$\uff0c \u5176\u4e2d\uff0c\u6ee1\u8db3\u8fd9\u4e2a\u5f0f\u5b50\u7684$a$\u7684\u4e2a\u6570\u5c31\u662f$\\phi(n)$\n\n\u8003\u8651$gcd(n, a) = d$\u7684\u65f6\u5019\uff0c\u90a3\u4e48$d|n$\u4e14$d|a$\uff0c\u6240\u4ee5\u5176\u5b9e\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u662f\uff1a $gcd(n/d, a/d) = 1$ \uff0c\u6ee1\u8db3\u8fd9\u4e2a\u5f0f\u5b50\u7684$a$\u7684\u4e2a\u6570\u4e3a$:\\phi(n/d)$\u4e2a\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff1a$\\sum_{i|x}\\phi(i) = \\sum_{i|x} \\phi(x/i)$ \u800c\u8fd9\u4e2a\u5f0f\u5b50\u7684\u7b54\u6848\u7684\u610f\u4e49\u4e3a\uff1a\u4e0e$x$\u7684$gcd$\u4f9d\u6b21\u4e3a$1,p_1...p_n$\u7684\u6570\u7684\u4e2a\u6570\uff0c\u8fd9\u4e2a\u6570\u7684\u4e2a\u6570\u4e3a$x$\n\n\u6240\u4ee5\uff1a$\\sum_{i|x}\\phi(i) = x = Id(x)$\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8bc1\u660e\u8fd9\u4e2a\uff1a$(\\mu*Id)(x) = \\phi(x)$\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u5377\u79ef\u5176\u5b9e\u5177\u6709\u4ea4\u6362\u5f8b\u3002$(f*g*h)(x) = (f*h*g)(x)$\n\n\u6240\u4ee5\uff1a$\\mu*Id*I = \\mu*I*Id = \\phi*I$\n\n\u5373\uff1a$\\mu*Id*I = \\phi* I$\uff0c\u6545\uff1a$\\mu*Id = \\phi$\n\n**\u5b8c\u6bd5$QWQ$**\n\n\u56de\u5230\u539f\u6765\u7684\u5f0f\u5b50\uff1a\n\n$$\\sum_{T=1}^n g(\\left\\lfloor\\dfrac{n}{T}\\right\\rfloor)T^2\\sum_{x|T}\\mu(x)*(T/x)$$\n\n\u5176\u5b9e\u5c31\u662f\uff1a\n\n$$\\sum_{T=1}^n g(\\left\\lfloor\\dfrac{n}{T}\\right\\rfloor)T^2\\sum_{x|T}\\mu(x)*Id(T/x)$$\n\n\u540e\u9762\u90a3\u4e00\u90e8\u5206\u5176\u5b9e\u5c31\u662f\uff1a$(\\mu*Id)(T) = (\\phi)(T)$\n\n\u6240\u4ee5\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f\uff1a\n\n$$\\sum_{T=1}^n g(\\left\\lfloor\\dfrac{n}{T}\\right\\rfloor)T^2\\phi(T)$$\n\n\u8003\u8651\u8bb0$f(x) = x^2\\phi(x)$\n\n\u7136\u540e\u6211\u4eec\u4e0d\u96be\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a\u79ef\u6027\u51fd\u6570\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f\uff1a\n\n$$\\sum_{T=1}^n g(\\left\\lfloor\\dfrac{n}{T}\\right\\rfloor)f(T)$$\n\n\u8fd9\u4e00\u90e8\u5206\u53ef\u4ee5\u6574\u9664\u5206\u5757\uff0c\u800c\u540e\u9762\u7684\u90e8\u5206\uff0c\u56e0\u4e3a$f(x)$\u4e3a\u79ef\u6027\u51fd\u6570\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u675c\u6559\u7b5b\u3002\n\n\u5047\u5b9a\u5b58\u5728$h(x)$\u6ee1\u8db3$(h*f)(x)$\u53ef\u4ee5\u8f83\u5feb\u7684\u7b97\u51fa\u6765\n\n\u90a3\u4e48\u8fd9\u4e24\u4e2a\u7684\u5377\u79ef\u5c31\u662f\uff1a\n\n$$\\sum_{i|x}f(i)*h(x/i)$$\n\n\u6211\u4eec\u628a$f(i)$\u4ee3\u56de\u53bb\uff0c\u5c31\u662f\uff1a\n\n$$\\sum_{i|x} i^2\\phi(i)*h(x/i)$$\n\n\u8fd9\u4e2a\u91cc\u9762\u6700\u9ebb\u70e6\u7684\u662f\u4ec0\u4e48\u5462\uff1f\u662f\u5728$\\phi(i)$\u524d\u9762\u7684$i^2$\uff0c\u8fd9\u4e2a\u4e1c\u897f\u6709\u4ec0\u4e48\u529e\u6cd5\u88ab\u6211\u4eec\u53bb\u6389\u5462\uff1f\n\n\u662f\u8fd9\u4e2a\uff1a$i*(x/i) = x$\n\n\u6240\u4ee5\uff1a$i^2 * (x/i)^2 = x^2$\n\n\u6545\u6211\u4eec\u53ef\u4ee5\u4ee4$h(x) = x^2$\n\n\u4e8e\u662f\u6211\u4eec\u6240\u6c42\u5373\uff1a$\\sum_{i|x} i^2\\phi(i)*(x/i)^2$\n\n\u7cdf\u7cd5\uff0c\u662f\u5fc3\u52a8\u7684\u611f\u89c9\uff1a$i^2*(x/i)^2 = x^2$!\n\n\u6362\u4e0b\u987a\u5e8f\uff0c\u518d\u5229\u7528\u4e00\u4e0b\u4e58\u6cd5\u5206\u914d\u5f8b\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u662f\uff1a$x^2\\sum_{i|x}\\phi(i)$\n\n\u4f46\u662f\u540e\u9762\u8fd9\u4e2a\uff0c\u6211\u4eec\u7ed9\u5b83\u4e58\u4e0a\u4e00\u4e2a$1$\uff1a\n\n$\\sum_{i|x}\\phi(i) = \\sum_{i|x}\\phi(i) * 1 = \\sum_{i|x}\\phi(i) * I(x/i) = (\\phi*I)(x) = Id(x)$\n\n\uff08\u6700\u540e\u4e00\u6b65\u662f\u4e4b\u524d\u8bc1\u660e\u7684\uff1a$(\\phi*I = Id)$\uff09\n\n\u6240\u4ee5\u6211\u4eec\u540e\u9762\u7684\u8fd9\u4e00\u5768\u4e5f\u5c31\u662f\uff1a$x$\n\n\u4e8e\u662f\uff1a\n$$\\sum_{i|x}f(i)*h(x/i)$$\n\n\u5c31\u662f\uff1a\uff08\u5176\u4e2d$h(x) = x^2$\uff09\n$$x^3$$\n\n\u7136\u540e\u6211\u4eec\u628a\u675c\u6559\u7b5b\u7684\u5f0f\u5b50\u5957\u4e0a\u53bb\uff0c\n\n\u8bb0$S(n) = \\sum_{i=1}^nf(i)$\n\n\u6240\u4ee5\uff1a\n\n$$h(1)S(n) = \\sum_{i=1}^nh(i)S(\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor) - \\sum_{i=2}^nh(i)S(\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor)$$\n\n\u56e0\u4e3a$h(1) = 1^2 = 1$\uff0c\u6240\u4ee5\uff1a\n\n$$S(n) = \\sum_{i=1}^nh(i)S(\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor) - \\sum_{i=2}^nh(i)S(\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor)$$\n\n\u800c\u524d\u9762\u8fd9\u4e00\u5768\uff1a\n\n$\\sum_{i=1}^nh(i)S(\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor)$\u5176\u5b9e\u662f\u8fd9\u6837\u6765\u7684\uff1a\n\n$\\sum_{i=1}^n(h*f)(i) $\n\n$= \\sum_{i=1}^n\\sum_{d|i}h(d)f(i/d)$\n\n$=\\sum_{d=1}^nh(d)*\\sum_{i=1}^{n/d}f(i) = \\sum_{d=1}^nh(d)*S(\\left\\lfloor\\dfrac{n}{d}\\right\\rfloor)$\n\n\u7136\u800c\uff0c\u89c2\u5bdf\u7b2c\u4e00\u4e2a\u5f0f\u5b50\uff0c\u5176\u5c31\u662f\uff1a$(h*f)$\u8fd9\u4e2a\u51fd\u6570\u7684\u524d\u7f00\u548c\n\n\u7136\u800c\u5f53$h(x) = x^2$\u65f6\uff0c$(h*f) = x^3$\n\n\u90a3\u4e48$\\sum_{i=1}^n(h*f)(i) = \\sum_{i=1}^ni^3$ \n\n\u8fd9\u4e2a\u4e1c\u897f\u600e\u4e48\u7b97\uff1f\n\n$1^3 + 2^3+3^3+4^3+....... + n^3$\n\n\u76f8\u4fe1\u5927\u5bb6\u5176\u5b9e\u4e0a\u8fc7\u5c0f\u5b66\u5965\u6570$QAQ,$\u5176$=\\dfrac{n^2(n+1)^2}{4}$\n\n\u6240\u4ee5\u539f\u5f0f\uff1a\n$$S(n) = \\dfrac{n^2(n+1)^2}{4} - \\sum_{i=2}^nh(i)S(\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor)$$\n\n\u7136\u540e\u540e\u9762\u8fd9\u4e2a\u4ecd\u7136\u53ef\u4ee5\u6574\u9664\u5206\u5757\u6c42\uff0c\u800c\u4e14\u518d\u5229\u7528\u9012\u5f52\u53bb\u505a\u3002\n\n\u4f46\u662f\uff0c\u6574\u9664\u5206\u5757\u7684\u8fc7\u7a0b\u6ce8\u610f\u5230\uff1a\n\n\u5047\u8bbe$l-r$\u7684$\\left\\lfloor\\dfrac{n}{l}\\right\\rfloor$\u90fd\u76f8\u540c\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u4e58\u6cd5\u5206\u914d\u5f8b\uff1a\n\n\u5373\uff1a$S(\\left\\lfloor\\dfrac{n}{l}\\right\\rfloor) * \\sum_{i=l}^rh(i)$\n\n\u56e0\u4e3a$h(i) = i^2$\n\n\u6240\u4ee5\u6211\u4eec\u8981\u6c42$l-r$\u8fd9\u4e00\u6bb5\u533a\u95f4\u7684\u5e73\u65b9\u548c\u3002\n\n\u53ef\u4ee5\u5229\u7528\uff1a$1^2 + 2^2 + 3^2+......+n^2$\n\n$ = \\dfrac{n*(n+1)*(2n+1)}{6}$\n\n\u53ef\u4ee5\u8bb0$sum(n) =  \\dfrac{n*(n+1)*(2n+1)}{6}$\n\n\uff08\u5c0f\u5b66\u6570\u5b66\uff09\n\n\u518d\u505a\u4e00\u4e2a\u51cf\u6cd5\uff0c\u6240\u4ee5$\\sum_{i=l}^ri^2 = sum(r) - sum(l - 1)$\n\n\u6240\u4ee5\u6700\u540e\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a\u6bd4\u8f83\u4f18\u79c0\u7684\u5f0f\u5b50\uff1a\n\n$$S(n) = \\dfrac{n^2(n+1)^2}{4} - \\sum_{i=2}^nS(\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor)h(i)$$\n\n\u5229\u7528\u6574\u9664\u5206\u5757\uff0c\u5bf9$h(l)$\u5230$h(r)$\u7684\u524d\u7f00\u548c\u5229\u7528\u524d\u9762\u6240\u8bb2$O(1)$\u6c42\u51fa\uff0c\u7136\u540e\u9012\u5f52\u5730\u53bb\u5f97\u5230$S(n/i)$\u7684\u503c\uff0c\u5f53\u7136\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u63d0\u524d\u6c42\u51fa\u8f83\u591a\u7684$S(1)-S(m)$\u7684\u503c\uff0c\u81f3\u4e8e\u8fd9\u4e2a\u503c\u9700\u8981\u5229\u7528\u6b27\u62c9\u7b5b\u6c42\u6b27\u62c9\u51fd\u6570\u6765\u5904\u7406\u3002\n\n\u6bd5\u7adf\uff1a$S(x) = \\sum_{i=1}^xi^2\\phi(i)$\n\n\u6240\u4ee5\u4e0d\u96be\u5f97\u5230\u9012\u63a8\uff1a$S(x) = S(x - 1) + x^2\\phi(x)$\n\n\u6839\u636e\u5b9e\u6d4b\uff0c\u5927\u6982$m$\u53d6$500W$\u5de6\u53f3\u7684\u65f6\u5019\u901f\u5ea6\u6bd4\u8f83\u5feb\uff0c\u5f53\u7136$300W-1000W$\u7684\u65f6\u5019\u4e5f\u90fd\u662f\u80fd\u8fc7\u7684\uff01\n\n\u5199\u8fd9\u7bc7\u9898\u89e3\u7b97\u662f\u5e2e\u81ea\u5df1\u540c\u65f6\u590d\u4e60\u675c\u6559\u7b5b\u548c\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u5427$QAQ$\uff08\u8bb0\u5f97\u7b97$h(x)$\u7684\u524d\u7f00\u548c\u5229\u7528\u5230\u7684\u5f0f\u5b50\u9700\u8981\u9664\u4ee5$6$\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u9700\u8981\u4e58\u4e0a$6$\u7684$inv$,\u4ee5\u53ca\u8fd9\u9053\u9898\u6076\u5fc3\u7684\u4e00\u70b9\u5c31\u662f\u5230\u5904\u90fd\u9700\u8981\u53d6\u6a21...........\u7136\u540e\u8981\u5f00$long long$\uff09\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define int unsigned long long\n\nint read() {\n\tchar cc = getchar(); int cn = 0, flus = 1;\n\twhile(cc < '0' || cc > '9') {  if( cc == '-' ) flus = -flus;  cc = getchar();  }\n\twhile(cc >= '0' && cc <= '9')  cn = cn * 10 + cc - '0', cc = getchar();\n\treturn cn * flus;\n}\n\nconst int N = 5e6 + 5;\n#define inf 9999999\n#define g(x) (((( (x % mod) * ((x + 1) % mod) / 2 ) % mod) * ( (x % mod) * ((x + 1) % mod) / 2 % mod)) % mod)\n#define g2(x) (( (x % mod) * ((x + 1) % mod) % mod * ((2 * x + 1) % mod) % mod * inv6 % mod) % mod)\n\nint n, phi[N], pr[N], f[N], top, mod, inv6, inv2;\nbool isp[N];\n\nmap<int, int> map1;\nvoid init() {\n\tphi[1] = f[1] = 1;\n\tfor ( int i = 2; i <= n; ++ i ) {\n\t\tif( !isp[i] )  pr[++top] = i, phi[i] = i - 1;\n\t\tfor ( int j = 1; j <= top; ++ j ) {\n\t\t\tif( i * pr[j] > n ) break;\n\t\t\tisp[i * pr[j]] = 1;\n\t\t\tif( i % pr[j] == 0 ) {\n\t\t\t\tphi[i * pr[j]] = phi[i] * pr[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i * pr[j]] = phi[i] * phi[pr[j]];\n\t\t}\n\t\tf[i] = f[i - 1] + ((1ll * phi[i] * i) % mod * i) % mod; f[i] %= mod;\n\t}\n} \n\nint fpow( int x, int k ) {\n\tint base = x, ans = 1;\n\twhile( k ) {\n\t\tif( k & 1 ) ans *= base, ans %= mod;\n\t\tbase *= base, base %= mod;\n\t\tk >>= 1;\n\t}\n\treturn ans;\n}\n\nint phi_sum( int x ) {\n\tif( x <= n ) return f[x];\n\tif( map1[x] ) return map1[x];\n\tint sumId = g(x % mod) % mod, ans = 0;\n\tint l, r;\n\tfor ( l = 2; l <= x; l = r + 1 ) {\n\t\tr = ( x / ( x / l ) );\n\t\tans += ((1ll * (( g2(r) - g2((l - 1)) + mod ) % mod ) * phi_sum( x / l )) % mod);\n\t\tans %= mod;\n\t}\n\treturn map1[x] = ( (sumId - ans + mod) % mod );\n}\n\nint solve1( int x ) {\n\tint l, r, ans = 0;\n\tfor ( l = 1; l <= x; l = r + 1 ) {\n\t\tr = ( x / ( x / l ) );\n\t\tint ret = g( x / l ) % mod;\n\t\tret = ret * ((phi_sum(r) - phi_sum(l - 1) + mod) % mod), ret %= mod; \n\t\tans += ret, ans %= mod;\n\t}\n\treturn (ans + mod) % mod;\n}\n\nsigned main()\n{\n\tmod = read(); \n//\tinv2 = fpow( 2, mod - 2 );\n\tinv6 = fpow( 6, mod - 2 ); \n\tint x = read();\n\tn = 5000000;  init();\n\tprintf(\"%lld\", solve1(x));\n\treturn 0;\n}\n\n```",
        "postTime": 1551448460,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "$\\mathrm{update\\ 2020/8/6:}$ \u4fee\u6539\u4e86\u4e4b\u524d\u4e0d\u89c4\u8303\u7684\u6570\u5b66\u7b26\u53f7\u548c\u9519\u8bef\u7684\u590d\u6742\u5ea6\u3002\n\n---\n\n\u9996\u5148\u8981\u77e5\u9053\uff1a\uff08\u6b27\u62c9\u53cd\u6f14\uff09\n\n$$\\varphi*1=\\mathrm{id}$$\n\n\u5373 \n\n$$\\sum\\limits_{d\\mid n}\\varphi(d)=n$$\n\n\u8fd9\u9053\u9898\u5c31\u662f\u8ba9\u6c42\uff1a\n\n$$\\sum\\limits_{i=1}^n{\\sum\\limits_{j=1}^{n}{ij\\cdot \\mathrm{id}\\left(\\gcd(i,j)\\right)}}$$\n\n\u5e26\u5165\u6700\u5f00\u5934\u8bf4\u7684\u90a3\u4e2a\u5f0f\u5b50\u5f97\u5230\uff1a\n\n(\u7531\u4e8e $d$ \u80fd\u88ab $\\gcd(i,j)$ \u6574\u9664\uff0c\u6240\u4ee5 $d$ \u65e2\u80fd\u88ab $i$ \u6574\u9664\u4e5f\u80fd\u88ab $j$ \u6574\u9664\uff0c$d$ \u7684\u53d6\u503c\u8303\u56f4\u5c31\u73c2\u4ee5\u5199\u6210\uff1a$d\\mid i,d\\mid j$ \uff09\n\n$$\\sum\\limits_{i=1}^n{\\sum\\limits_{j=1}^{n}{ij\\sum\\limits_{d\\mid i,d\\mid j}\\varphi(d)}}$$\n\n\u5957\u8def\u7684\uff0c\u6211\u4eec\u628a $d$ \u641e\u51fa\u6765\u679a\u4e3e\uff1a\n\n$$\\sum\\limits_{d=1}^{n}{\\varphi(d)}\\sum\\limits_{d\\mid i}\\sum\\limits_{d\\mid j}ij$$\n\n\u7531\u4e8e $i,j$ \u90fd\u662f $d$ \u7684\u500d\u6570\uff0c\u6240\u4ee5\u6211\u4eec\u73c2\u4ee5\u628a\u5b83\u4eec\u90fd\u9664\u4ee5 $d$,\u522b\u5fd8\u4e86\u628a $d$ \u518d\u4e58\u56de\u53bb\uff01\n\n$$\\sum\\limits_{d=1}^{n}{\\varphi(d)\\cdot d^2}\\sum\\limits_{i=1 }^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor}\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor}ij$$\n\n\u53d1\u73b0 $i,j$ \u7684\u53d6\u503c\u8303\u56f4\u662f\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u76f4\u63a5\u628a\u5b83\u4eec\u5408\u5e76\u6389\uff01\n\n$$\\sum\\limits_{d=1}^{n}{\\varphi(d)\\cdot d^2}\\left(\\sum\\limits_{i=1 }^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor}i\\right)^2$$\n\n\u540e\u9762\u7684\u90a3\u4e2a\u6c42\u548c\u5c31\u73c2\u4ee5\u6570\u8bba\u5206\u5757\u5566\uff01\n\n\u6c42\u7684\u8bdd\u73c2\u4ee5 $\\mathcal{O}(1)$ \u641e\u6389 (\u76f8\u4fe1\u53ea\u8981\u4e0a\u8fc7\u5c0f\u5b66\u7684\u4eba\u90fd\u4f1a\uff09\uff1a\n\n$$\\left(\\sum\\limits_{i=1}^{n}i\\right)^2=\\frac{n^2(n+1)^2}{4}$$\n\n\u524d\u9762\u7684 $\\sum\\limits_{d=1}^{n}{\\varphi(d)\\cdot d^2}$ \u600e\u4e48\u529e\uff1f\n\n[**\u675c\u6559\u7b5b**\uff01\uff01](https://www.luogu.com.cn/problem/P4213)\n\n\u4ee4 $f=\\varphi \\cdot \\mathrm{id}^2$,\u9700\u8981\u518d\u627e\u4e00\u4e2a\u5408\u9002\u7684 $g$\n\n\u4e3a\u4e86\u8ba9 $(f*g)(n)$ \u6c42\u524d\u7f00\u548c\u65b9\u4fbf\uff0c\u6211\u4eec\u6700\u597d\u4e0d\u8ba9\u5f0f\u5b50\u91cc\u6709\u9664 $n$ \u4ee5\u5916\u7684\u53d8\u91cf\u3002\n\n\u7531\u4e8e $d\\cdot \\frac{n}{d}=n$ \uff08\u5e9f\u8bdd\u3002\u3002\uff09\n\n\u6211\u4eec\u5c31\u8ba9 $g=\\mathrm{id}^2$ \u6765\u6d88\u6389 $d$\n\n\u90a3\u4e48:\n\n$$\\begin{aligned}{(f*g)(n)}&=\\sum\\limits_{d\\mid n}\\left(\\varphi(d)*d^2\\right)\\left(\\frac{n}{d}\\right)^2 \\\\\n&=n^2\\sum\\limits_{d\\mid n}\\varphi(d) \\\\\n&=n^3\n\\end{aligned}$$\n\n(\u6700\u540e\u4e00\u6b65\u4f9d\u7136\u7528\u5230\u4e86\uff1a$\\varphi*1=\\mathrm{id}$ )\n\n\u4ee4 $S(n)=\\sum\\limits_{d=1}^{n}{\\varphi(d)\\cdot d^2}$\n\n\u76f4\u63a5\u5957\u675c\u6559\u7b5b\u7684\u516c\u5f0f\u5373\u53ef\uff1a\n\n$$S(n)=\\frac{\\sum\\limits_{i=1}^{n}(f*g)(n)-\\sum\\limits_{i=2}^{n}{g(i)S}\\left(\\left\\lfloor\\frac{n}{i}\\right\\rfloor\\right)}{g(1)}$$\n\n\u6c42 $(f*g)(n)$ \u548c $g(n)$ \u7684\u524d\u7f00\u548c\u8fd8\u662f\u5c0f\u5b66\u751f\u96be\u5ea6\uff1a\n\n$$\\sum\\limits_{i=1}^{n}(f*g)(i)=\\sum\\limits_{i=1}^{n}i^3=\\frac{n^2(n+1)^2}{4}$$\n\n$$\\sum_{i=1}^{n}g(i)=\\sum\\limits_{i=1}^{n}i^2=\\frac{n(n+1)(2n+1)}{6}$$\n\n\u5148\u7b5b\u51fa\u6765\u5927\u7ea6 $n^{\\frac{2}{3}}$ \u4e2a $S(i)$\uff0c\u8fd9\u6837 $S(n)$ \u5c31\u53ef\u4ee5\u5728 $\\mathcal{O}(n^{\\frac{2}{3}})$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u6c42\u51fa\u6765\u3002\n\n\u867d\u7136\u5916\u9762\u518d\u5957\u4e00\u4e2a\u6570\u8bba\u5206\u5757\uff0c\u4f46\u590d\u6742\u5ea6\u8fd8\u662f $\\mathcal{O}(n^{\\frac{2}{3}})$\uff08\u4e0d\u8fc7\u5982\u679c\u5957\u4e24\u5c42\u6570\u8bba\u5206\u5757\u5c31\u4e0d\u4e00\u5b9a\u4e86\uff09\u3002\n\n---\n\n***code:***\n\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<map>\nusing namespace std;\n#define N 5000050\ntypedef long long ll;\nconst int MAX=5000000;\ninline ll read(){\n    ll x=0,f=1;\n    char c=getchar();\n    while(c<'0'||c>'9'){\n        if(c=='-')f=-1;\n        c=getchar();\n    }\n    while(c>='0'&&c<='9'){\n        x=(x<<3)+(x<<1)+c-'0';\n        c=getchar();\n    }\n    return x*f;\n}\n#define ck(x) (x>=mod?x-mod:x)\nmap<ll,ll> mp;\nll mod,n,Sphi[N],inv6;\nint phi[N],primes[N>>2],pn;\nbool ntp[N];\nll qpow(ll a,ll b){\n\tll ans=1;\n\twhile(b){\n\t\tif(b&1)ans=ans*a%mod;\n\t\ta=a*a%mod;\n\t\tb>>=1;\n\t}\n\treturn ans;\n}\nvoid init(int n){//\u9884\u5904\u7406S(i)\n\tntp[1]=true,phi[1]=1;\n\tfor(register int i=2;i<=n;++i){\n\t\tif(!ntp[i])primes[++pn]=i,phi[i]=i-1;\n\t\tfor(int j=1;j<=pn&&primes[j]*i<=n;++j){\n\t\t\tntp[primes[j]*i]=true;\n\t\t\tif(i%primes[j]==0){\n\t\t\t\tphi[i*primes[j]]=phi[i]*primes[j];\n\t\t\t\tbreak; \n\t\t\t}\n\t\t\tphi[i*primes[j]]=phi[i]*(primes[j]-1);\n\t\t}\n\t}\n\tfor(register int i=1;i<=n;i++){\n\t\tSphi[i]=Sphi[i-1]+1LL*i*i%mod*phi[i]%mod;\n\t\tSphi[i]=ck(Sphi[i]);\n\t}\n}\ninline ll S2(ll n){//\u5e73\u65b9\u548c\n\tn%=mod;\n\treturn n*(n+1)%mod*(2*n+1)%mod*inv6%mod;\n}\ninline ll S3(ll n){//\u7acb\u65b9\u548c\n\tn%=mod;\n\treturn (n*(n+1)/2%mod)*(n*(n+1)/2%mod)%mod;\n}\ninline ll Get(ll n){//\u675c\u6559\u7b5b\u6c42S(n)\n\tif(n<=MAX)return Sphi[n]%mod;\n\tif(mp.count(n))return mp[n];\n\tll r=0,ans=S3(n);\n\tfor(ll l=2;l<=n;l=r+1){\n\t\tr=(n/(n/l));\n\t\tans-=(S2(r)-S2(l-1)+mod)%mod*Get(n/l)%mod;\n\t\tans=ck(ans+mod);\n\t} \n\treturn mp[n]=ans;\n}\nll Solve(ll n){\n\tll r=0,ans=0;\n\tfor(ll l=1;l<=n;l=r+1){//\u5148\u5728\u5916\u5c42\u6570\u8bba\u5206\u5757\u4e00\u4e0b\n\t\tr=(n/(n/l));\n\t\tans+=S3(n/l)*(Get(r)-Get(l-1)+mod)%mod;\n\t\tans=ck(ans);\n\t}\n\treturn ans;\n}\nint main(){\n\tmod=read(),n=read();\n\tinit(MAX),inv6=qpow(6,mod-2);\n\tprintf(\"%lld\\n\",Solve(n));\n\treturn \u5471\u5471\uff01\n}\n\n```\n\n[*Froggy's blog*](https://www.luogu.org/blog/1445353309froggy/)\n\n#### \u5471!!\n\n\n",
        "postTime": 1581169281,
        "uid": 100285,
        "name": "Froggy",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u6211\u6765\u7ed9\u4e00\u4e2a\u4e0d\u9700\u8981\u8bc1(gong)\u660e(lue)\u76f4\u63a5\u5f3a\u63a8\u7684\u505a\u6cd5\n\n\u6ce8\u610f\u4ee5\u4e0b\u5f0f\u5b50\u4e2d\u7684\u9664\u6cd5\u7686\u4e3a**\u5411\u4e0b\u53d6\u6574**\n\n$\\sum _{i=1}^n \\sum _{j=1}^n ij \\gcd (i,j) $\n\n(\u679a\u4e3e $\\gcd(i,j)=d$)\n\n= $\\sum _d d^3 \\sum _{i=1}^{\\frac{n}{d}} \\sum _{j=1}^{\\frac{n}{d}} ij [\\gcd (i,j)=1] $\n\n(\u518d\u679a\u4e3e $\\gcd(i,j)=p$ \u505a\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14)\n\n= $\\sum _d d^3 \\sum _{p=1}^{\\frac{n}{d}} \\mu(p) p^2 \\sum _{i=1}^{\\frac{n}{dp}} \\sum _{j=1}^{\\frac{n}{dp}} ij $\n\n(\u4ee4 $F(n)=\\sum _{i=1}^n \\sum _{j=1}^n ij=\\sum _{i=1}^n i^3 $)\n\n= $\\sum _d d^3 \\sum _{p=1}^{\\frac{n}{d}} \\mu(p) p^2 F(\\frac{n}{dp}) $\n\n(\u4ee4 $a=dp$\uff0c\u53ef\u4ee5\u628a\u679a\u4e3e $d$ \u548c $p$ \u8f6c\u6362\u6210\u679a\u4e3e $a$)\n\n= $\\sum _{a=1}^n \\sum _{d|a} d^3 \\mu(\\frac{a}{d}) \\frac{a^2}{d^2} F(\\frac{n}{a}) $\n\n=$\\sum _{a=1}^n a^2 F(\\frac{n}{a})\\sum _{d|a} d\\mu(\\frac{a}{d}) $\n\n(\u6ce8\u610f\u5230 $\\mu*id=\\mu*I*\\phi=e*\\phi=\\phi$ \uff0c\u8fd9\u91cc $*$ \u662f\u72c4\u5229\u514b\u96f7\u5377\u79ef)\n\n=$\\sum _{a=1}^n a^2 F(\\frac{n}{a})\\phi(a) $\n\n\u8fd9\u5c31\u662f\u51fa\u9898\u4eba\u9898\u89e3\u5f00\u5934\u63d0\u5230\u7684\"**\u53ef\u4ee5\u53d1\u73b0...\u5219\u7b54\u6848\u7b49\u4e8e**\"\u7684\u5f0f\u5b50\uff0c\u7136\u540e\u76f4\u63a5\u675c\u6559\u7b5b\u3002\n",
        "postTime": 1494476898,
        "uid": 12461,
        "name": "scPointer",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "#### \u7b80\u5355\u7684\u6570\u5b66\u9898\n\n\n\u6c42$\\sum_{i=1}^n\\sum_{j=1}^nijgcd(i,j)$\u3002\n\n\n\u4e8b\u5b9e\u4e0a\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u7b97$\\sum_{i=1}^n\\sum_{j=1}^n [gcd(i,j)=1]ij$\uff0c\u53ef\u4ee5\u53d1\u73b0\u7b54\u6848\u7b49\u4e8e$\\sum_{i=1}^n i^2\\varphi(i)$\u3002\n\n\n\u90a3\u4e48\u8bbe$F(n)=\\sum_{i=1}^n i^2\\varphi(i)$\uff0c\u5219\u7b54\u6848\u7b49\u4e8e$\\sum_{g=1}^n g^3 F(\\frac{n}{g})$\uff0c\u5bf9g\u6839\u53f7\u5206\u6bb5\u540e\u675c\u6559\u7b5b\u5373\u53ef\u3002\n\n\u8bc1\u660e\u53ea\u9700\u6ce8\u610f\u5230$\\sum_{i=1}^n [gcd(i,n)=1]i=(n\\varphi(n)+[n=1])/2$\uff08\u7531\u4e8e$i$\u548c$n-i$\u548c$n$\u540c\u4e92\u8d28\u6216\u540c\u4e0d\u4e92\u8d28\uff09\uff0c\u90a3\u4e48$\\sum_{i=1}^n\\sum_{j=1}^n [gcd(i,j)=1]ij=1+2\\sum_{i=2}^ni\\sum_{j=1}^{i}[gcd(i,j)=1]j=1+2\\sum_{i=2}^ni^2\\varphi(i)/2=\\sum_{i=1}^ni^2\\varphi(i)$\u3002\n",
        "postTime": 1494252320,
        "uid": 4134,
        "name": "fjzzq2002",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u5514\uff0c\u5b66\u4e86\u4e24\u5929**Min_25**\u7b5b\u7ec8\u4e8e\u4f1a\u4e86\u3002\u3002\u3002\n\u76f8\u4fe1 ~~\u5927\u5bb6\u90fd\u80fd\u63a8\u5230~~ \u522b\u7684\u9898\u89e3\u5df2\u7ecf\u5199\u7684\u5f88\u6e05\u695a\u4e86\n$$ans=\\sum_{i=1}^n i^2\\varphi(i)*(\\sum_{j=1}^{\\lfloor \\frac{n}{i}\\rfloor} i)^2$$\n\u5bf9\u4e8e\u540e\u534a\u90e8\u5206\uff0c\u6211\u4eec\u53ef\u4ee5\u6570\u8bba\u5206\u5757\u505a\u5230$O(\\sqrt{n})$\uff0c\u7136\u540e\u76f4\u63a5**Min_25**\u7b5b\u5c31\u6ca1\u4e86\u3002\n\n------\n\n\u597d\u5427\uff0c\u63a5\u4e0b\u6765\u8bb2\u8bb2\u5565\u662f**Min_25**\u7b5b\u3002\n\n\u5148\u63a8\u8350\u4e24\u7bc7\u4e0d\u9519\u7684\u535a\u5ba2\uff1a\n\n[\u5b66\u4e60\u770b\u8fd9\u91cc](https://www.cnblogs.com/DreamlessDreams/p/9997874.html)\n\n[\u4f8b\u9898\u770b\u8fd9\u91cc](https://cmxrynp.github.io/2018/12/03/Min-25%E7%AD%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/)\n\n## \u7b80\u4ecb\n\n**Min_25**\u7b5b\u80fd\u5feb\u901f\u6c42\u79ef\u6027\u51fd\u6570\u524d\u7f00\u548c\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(\\frac{n^{\\frac{3}{4}}}{logn})$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6$O(\\sqrt n)$\u3002\n\n**Min_25**\u7b5b\u8981\u6c42$f(p^k)$\u80fd\u5feb\u901f\u6c42\u51fa\uff0c\u5176\u4e2d$p$\u4e3a\u8d28\u6570\uff0c\u4e14\u8981\u6c42$f(p)$\u80fd\u62c6\u89e3\u6210\u82e5\u5e72**\u5b8c\u5168\u79ef\u6027\u51fd\u6570**\u3002\n\n### \u5316\u7b80\u5f0f\u5b50\u5e76\u53d8\u5f62\n\n\u5bf9\u4e8e\u672c\u9898\uff0c\u6211\u4eec\u4ee4\n$$f(i)=i^2*\\varphi(i)$$\n\u5219\u5728$i$\u4e3a\u8d28\u6570\u65f6\uff0c\u6709\uff1a\n$$f(p)=p^2(p-1)=p^3-p^2$$\n\u4e8e\u662f\u6211\u4eec\u4ee4\n$$g(p)=p^3,h(p)=p^2$$\n\u90a3\u4e48\n$$f(p)=g(p)-h(p)$$\n\n## \u9884\u5904\u7406\n\n\u9996\u5148\u8003\u8651\u8d28\u6570\u8d21\u732e\u7684\u524d\u7f00\u548c\uff0c\u6839\u636e\u4ee5\u4e0a\u5b9a\u4e49\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u8ba1\u7b97\u51fa\u5404**\u5b8c\u5168\u79ef\u6027\u51fd\u6570**\u7684\u8d28\u6570\u524d\u7f00\u548c\uff0c\u518d\u76f8\u52a0\u51cf\u5c31\u662f\u539f\u51fd\u6570\u53ea\u7b97\u8d28\u6570\u90e8\u5206\u7684\u524d\u7f00\u548c\u4e86\u3002\u90a3\u4e48\u6211\u4eec\u5148\u5355\u72ec\u8003\u8651\u5982\u4f55\u6c42\u4e00\u4e2a**\u5b8c\u5168\u79ef\u6027\u51fd\u6570**$g(p)$\u7684\u8d28\u6570\u524d\u7f00\u548c\u3002\n\n\u6211\u4eec\u4ee4\n$$sg(n)=\\sum_{i=1}^n g(P_i)$$\n\u5176\u4e2d$P_i$\u8868\u793a\u7b2c$i$\u4e2a\u8d28\u6570\u3002\n$$G(n,m)=\\sum_{i=1}^n [minP_i>P_m~\\text{\u6216}~i~is~prime]g(i)$$\n\u5176\u4e2d$minP_i$\u8868\u793a$i$\u7684\u6700\u5c0f\u8d28\u56e0\u5b50\uff0c\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f$G(n,\\infty)$\u3002\u8003\u8651\u9012\u63a8\u6765\u6c42\uff1a\n$$G(n,m)=\\begin{cases}G(n,m-1), & p_m^2>n\\\\G(n,m-1)-g(P_i)\\times \\left(G\\left(\\left\\lfloor \\frac{n}{P_i} \\right\\rfloor,i-1\\right)-sg(i-1)\\right), & P_m^2\\le n\\end{cases}$$\n\u5047\u8bbe$P_i$\u662f\u522b\u7684\u6570\u4e00\u4e2a\u8d28\u56e0\u5b50\uff0c\u5b83\u80fd\u4ea7\u751f\u7684\u5408\u6570\u8d21\u732e\u662f$g(P_i)\\times G(\\left\\lfloor\\frac{n}{P_i}\\right\\rfloor,i-1)$\u3002\u4f46\u662f\u7531\u4e8e$P_i$\u4e0d\u4e00\u5b9a\u662f\u6700\u5c0f\u7684\u8d28\u56e0\u5b50\uff0c\u8fd8\u8981\u52a0\u56de\u591a\u51cf\u7684\u5c0f\u8d28\u6570\u5373$sg(i-1)$\u3002\n\n\u7531\u4e8e$\\lfloor \\frac{n}{ab}\\rfloor=\\left \\lfloor \\frac {\\lfloor \\frac {n}{a} \\rfloor}{b} \\right \\rfloor $\uff0c\u6545\u82e5\u8981\u6c42$G(n,*)$\u9700\u8981\u4ece$G(\\lfloor \\frac{n}{d} \\rfloor,*)$\u3002~~\u4f17\u6240\u5468\u77e5~~$\\lfloor \\frac{n}{d} \\rfloor$\u6709$O(\\sqrt{n})$\u79cd\u53d6\u503c\uff0c\u800c\u5bf9\u4e8e$G(*,m)$\u53ea\u9700\u8981\u4ece$G(*,m-1)$\u63a8\u6765\uff0c\u6545\u53ef\u5c06\u7b2c\u4e8c\u7ef4\u6eda\u6389\u3002\u4e8e\u662f\u53ea\u9700\u5f00\u4e00\u4e2a$G[\\sqrt{n}]$\u7684\u6570\u7ec4\u5373\u53ef\u3002\u590d\u6742\u5ea6$O(\\frac{n^\\frac{3}{4}}{\\log n})$\u3002\n\n\u6309\u4ee5\u4e0a\u65b9\u6cd5\uff0c\u6211\u4eec\u5c31\u80fd\u5728\u4f4e\u4e8e\u7ebf\u6027\u590d\u6742\u5ea6\u7684\u65f6\u95f4\u5185\u5904\u7406\u51fa\u5404**\u5b8c\u5168\u79ef\u6027\u51fd\u6570**\u7684\u524d\u7f00\u548c\u3002\u5c06\u5b83\u4eec\u5408\u5e76\u540e\u5c31\u53ef\u4ee5\u5f97\u5230\u539f\u79ef\u6027\u51fd\u6570\u8d28\u6570\u90e8\u5206\u7684\u524d\u7f00\u548c\uff0c\u6211\u4eec\u8bbe\u4e3a$g(x)$\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684$g(x)$\u7684\u5b9a\u4e49\u548c\u524d\u6587**\u4e0d\u4e00\u6837**\uff0c$g(x)=\\sum_{i=1}^x [i~is~prime]f(i)$\u3002\n\n## \u8ba1\u7b97\u7b54\u6848\n\n\u6211\u4eec\u4ee4\n$$S(n,m)=\\sum_{i=2}^n [minP_i \\ge P_m]f(i)$$\n\u90a3\u4e48\u6211\u4eec\u8981\u6c42\u7684\u7b54\u6848\u5373\u4e3a$S(n,1)$\u3002\u8003\u8651\u9012\u5f52\u6c42\u89e3\uff1a\n$$S(n,m)=\\begin{cases}0, & n<P_m\\\\g(n)-g(P_{m-1})+\\sum_{k=m}^{P_k^2\\le n}\\sum_{e=1}^{P_k^{e+1}\\le n}f(P_k^e)*S(\\left \\lfloor\\frac{n}{P_k^e}\\right \\rfloor,k+1)+f(P_k^{e+1}), & n\\ge P_m\\end{cases}$$\n\u540e\u9762\u7684$\\Sigma$\u90e8\u5206\u5373\u679a\u4e3e\u5f53\u524d\u9009\u62e9\u7684\u6700\u5c0f\u8d28\u56e0\u6570\u4ee5\u53ca\u6570\u91cf\u6b21\u6570\uff0c\u540c\u65f6\u8ba1\u7b97\u5f62\u5982$P^k$\u7684\u5408\u6570\u8d21\u732e\u3002\u8fd9\u90e8\u5206\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u662f$O(\\frac{n^\\frac{3}{4}}{\\log n})$\u3002\n\n\u4f46\u662f\u5bf9\u4e8e\u672c\u9898\uff0c\u6211\u4eec\u8981\u8ba1\u7b97\n$$ans=\\sum_{i=1}^n f(i)*(\\sum_{j=1}^{\\lfloor \\frac{n}{i}\\rfloor} i)^2$$\n\u662f\u8981\u591a\u6b21\u8be2\u95ee$f(i)$\u7684\u524d\u7f00\u548c\u7684\u3002\u5bf9\u4e8e\u4e0a\u8ff0\u65b9\u6cd5\u5e76\u4e0d\u9002\u7528\uff0c\u5b9e\u6d4b\u53ea\u6709$60$\u5206\uff0c\u90a3\u8be5\u548b\u529e\u561e\uff1f\n\n\u6ca1\u9519\uff0c\u6211\u4eec\u60f3\u5230\u5728\u9012\u5f52$S(*,1)$\u65f6\u4f1a\u591a\u6b21\u6c42\u5230\u540c\u4e00\u4e2a$S(n,m)$\u3002\u6211\u4eec\u52a0\u4e00\u53d1\u8bb0\u5fc6\u5316\u3002\u901a\u8fc7$vector$\u7684\u64cd\u4f5c\u5c31\u80fd~~(\u4e5f\u8bb8\u6211\u81ea\u5e26\u5927\u5e38\u6570)~~\u5f97\u5230$80$\u5206\u3002\u90a3\u6211\u4eec\u80fd\u5426\u50cf\u6c42$G(n,m)$\u90a3\u6837\u9012\u63a8\u5462\uff1f\u7b54\u6848\u662f\u80af\u5b9a\u7684\u3002\n\n\u6211\u4eec\u8003\u8651\u91cd\u65b0\u5b9a\u4e49\uff1a\n$$S(n,m)=\\sum_{i=2}^n [minP_i \\ge P_m~\\text{\u6216}~i~is~prime]f(i)$$\n\u6211\u4eec\u5355\u72ec\u8003\u8651$P_m$\u7684\u8d21\u732e\uff0c\u6bcf\u6b21\u52a0\u5165$minP_i=P_m$\u7684\u6570\uff1a\n$$S(n,m)=\\begin{cases}S(n,m+1), & n\\le P_m^2\\\\S(n,m+1)+\\sum_{i=1}^{P_m^{i+1}\\le n} (f(P_m^i)*(S(\\lfloor\\frac{n}{P_m^i}\\rfloor,m+1)-g(P_m))+f(P_m^{i+1})), & n\\ge P_m^2\\end{cases}$$\n\n$S(n,\\infty)=G(n,\\infty)=g(n)$\n\n\u501f\u9274\u6c42$G$\u7684\u601d\u8def\uff0c\u6211\u4eec\u4ecd\u5148\u679a\u4e3e$m$\u8fd9\u4e00\u7ef4\uff0c\u4e8e\u662f\u7b2c\u4e8c\u7ef4\u5c31\u53c8\u53ef\u4ee5\u6eda\u6389\uff0c\u590d\u6742\u5ea6\u4f9d\u65e7\u662f$O(\\frac{n^\\frac{3}{4}}{\\log n})$\u3002\n\n\u5904\u7406\u51fa$S(n,1)$\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5$O(1)$\u56de\u7b54$f(i)$\u7684\u524d\u7f00\u548c\uff0c\u4fbf\u901a\u8fc7\u4e86\u6b64\u9898\u3002\n\n------\n\n\u4ee3\u7801\uff1a\n\n$Tips:$\u8fd9\u91cc\u63d0\u4f9b\u4e86\u4e00\u4efd**Min_25**\u7b5b\u677f\u5b50\u3002\n\n```cpp\n// \u5c06\u79ef\u6027\u51fd\u6570f\u62c6\u89e3\u6210g+h\u7684\u5f62\u5f0fg\uff0ch\u662f\u5b8c\u5168\u79ef\u6027\u51fd\u6570\u5e76\u4e14\u53ef\u4ee5\u5feb\u901f\u6c42\u524d\u7f00\u548c\u3002\u6c42f\u524d\u7f00\u548c\u3002\n#include<cstdio>\n#include<cmath>\n#include<cstdlib>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\ntypedef long long ll;\nconst int N=2E5+10;\nconst int ret=1+2;//f(1)\u7684\u8d21\u732e\u548c\u4e00\u4e9b\u5947\u5947\u7ed9\u7ed9\u7684\u90e8\u5206\nconst int flag=0;// 1\uff1a\u53ea\u6c42S(n,1) or 0\uff1a\u591a\u6b21\u6c42\u524d\u7f00\u548c\nll n,q[N];\nint sz,cnt,inv6,mod;\nint id1[N],id2[N];\nint vis[N],pr[N],tot;\nint sg[N],sh[N],g[N],h[N],s[N];\ninline void mo(int&x){(x>=mod)&&(x-=mod);}\ninline void pre(void){// \u662f\u5426\u6709\u8fb9\u754c\u8981\u7279\u5224\n\treturn;\n    if(n==1){puts(\"1\");exit(0);}\n}\ninline int query_g(const int x){//g\u7684\u8868\u8fbe\u5f0f\n    return 1ll*x*x*x%mod;\n}\ninline int query_h(const int x){//h\u7684\u8868\u8fbe\u5f0f\n\treturn 1ll*x*x%mod;\n}\ninline int sumof_g(const int x){//g\u7684\u524d\u7f00\u548c\n\treturn (1ll*x*(x+1)/2%mod)*(1ll*x*(x+1)/2%mod)%mod;\n}\ninline int sumof_h(const int x){//h\u7684\u524d\u7f00\u548c\n\treturn 1ll*(x+x+1)*(x+1)%mod*x%mod*inv6%mod;\n}\ninline void mix_s(register int&x,const int y){//\u5408\u5e76g\uff0ch\u7684\u8868\u8fbe\u5f0f(\u8d28\u6570\u90e8\u5206Tips:\u8fd9\u91cc\u4e3a\u4e86\u65b9\u4fbf\u5904\u7406\u51fasg(x)=g(P_x).\n    mo(x+=mod-y);\n}\ninline void mix_tot(register int&x,const int y){//\u5408\u5e76g\uff0ch\u7684\u8868\u8fbe\u5f0f(\u5168\u90e8\n\tmo(x+=mod-y);\n}\ninline int query_f(const int p,const int k){//f(p^k)\u7684\u603b\u8868\u8fbe\u5f0f O(1)\n\treturn p^k;\n}\ninline int query_f0(const int p){//f(p)\u7684\u8868\u8fbe\u5f0f O(1)\n\treturn 1ll*(p-1)*p*p%mod;\n}\ninline int query_fq(const int p){//f(p^k)\u9012\u63a8\u5f0f\u7684\u516c\u6bd4 O(1)\n\treturn 1ll*p*p*p%mod;\n}\ninline int ksm(const int x,const int y){return y==1?x:1ll*ksm(1ll*x*x%mod,y>>1)*((y&1)?x:1)%mod;}\ninline void init(void){\n\tsz=sqrt(n);tot=cnt=0;\n\tinv6=ksm(6,mod-2);\n\tfor(int i=2;i<=sz;i++){\n\t\tif(!vis[i]) pr[++tot]=i,mo(sg[tot]=sg[tot-1]+query_g(i)),mo(sh[tot]=sh[tot-1]+query_h(i));\n\t\tfor(int j=1;j<=tot&&i*pr[j]<=sz;j++){\n\t\t\tvis[i*pr[j]]=1;\n\t\t\tif(i%pr[j]==0) break;\n\t\t}\n\t}\n\tfor(ll i=1,v;i<=n;i=n/(n/i)+1){\n\t\tq[++cnt]=v=n/i;\n\t\tif(v<=sz) id1[v]=cnt;\n\t\telse id2[n/v]=cnt;\n\t\tv%=mod;\n\t\tg[cnt]=sumof_g(v)-1;\n\t\th[cnt]=sumof_h(v)-1;\n\t}\n}\ninline int id(const ll x){return x<=sz?id1[x]:id2[n/x];}\ninline void mix(void){\n\tfor(int i=1;i<=tot;i++) mix_s(sg[i],sh[i]);\n\tfor(int i=1;i<=cnt;i++) mix_tot(g[i],h[i]);\n}\ninline int S(const ll n,const int m){\n\tif(n<=1||pr[m]>n) return 0;\n\tint res=g[id(n)]-sg[m-1]+mod;mo(res);\n\tfor(int k=m;1ll*pr[k]*pr[k]<=n&&k<=tot;k++){\n//\t\tfor(ll v=pr[k],e=1;v*pr[k]<=n;v*=pr[k],e++){\n//\t\t\tmo(res+=(1ll*query_f(pr[k],e)*S(n/v,k+1)+query_f(pr[k],e+1))%mod);\n//\t\t}\n\t\tfor(ll v=pr[k],p=query_f0(pr[k]),e=query_fq(pr[k]);v*pr[k]<=n;v*=pr[k],p=p*e%mod){\n\t\t\tmo(res+=1ll*(S(n/v,k+1)+e)*p%mod);\n\t\t}\n\t}\n\treturn res;\n}\ninline void sol(void){\n\tfor(int i=1;i<=cnt;i++) s[i]=g[i];\n\tfor(int i=1;i<=tot;i++) mo(sg[i]=mod-sg[i]);\n\tfor(int i=tot;i;i--){\n\t\tconst ll vv=1ll*pr[i]*pr[i];\n\t\tfor(int j=1;j<=cnt&&q[j]>=vv;j++){\n\t\t\tfor(ll v=pr[i],p=query_f0(pr[i]),e=query_fq(pr[i]);v*pr[i]<=q[j];v*=pr[i],p=p*e%mod){\n\t\t\t\tmo(s[j]+=1ll*(0ll+s[id(q[j]/v)]+sg[i]+e)*p%mod);\n\t\t\t}\n\t\t}\n\t}\n\tint res=sumof_g(n%mod);\n\tfor(ll i=1;i<=n;i=n/(n/i)+1){\n\t\tmo(res+=1ll*sumof_g((n/i)%mod)*(s[id(n/(n/i))]-s[id(i-1)]+mod)%mod);\n\t}\n\tprintf(\"%d\\n\",res);\n}\nint main(){\n\tscanf(\"%d%lld\",&mod,&n);\n\tpre();init();\n\tfor(int i=1;i<=tot;i++){\n\t\tconst ll v=1ll*pr[i]*pr[i];\n\t\tfor(int j=1;j<=cnt&&q[j]>=v;j++){\n\t\t\tconst int k=id(q[j]/pr[i]);\n\t\t\tmo(g[j]+=mod-1ll*query_g(pr[i])*(g[k]-sg[i-1]+mod)%mod);\n\t\t\tmo(h[j]+=mod-1ll*query_h(pr[i])*(h[k]-sh[i-1]+mod)%mod);\n\t\t}\n\t}\n\tmix();\n\tif(flag) printf(\"%d\\n\",S(n,1)+ret);\n\telse sol();\n\treturn 0;\n}\n```\n\n\u81ea\u5e26\u5927\u5e38\u6570\u671b\u89c1\u8c05\u3002~~\u8dd1\u4e0d\u8fc7\u675c\u6559\u7b5b\uff0c\u6211\u597d\u83dc\u554a~~",
        "postTime": 1547876623,
        "uid": 24337,
        "name": "zhangchengkai",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "$$\\sum_{i=1}^{n}\\sum_{j=1}^{n} ij\\gcd(i,j)$$\n$$=\\sum_{d=1}^{n} d \\sum_{i=1}^{n}\\sum_{j=1}^{n} ij[\\gcd(i,j)==d]$$\n$$=\\sum_{d=1}^{n} d^3 \\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor} \\sum_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor} ij[\\gcd(i,j)==1]$$\n$$=\\sum_{d=1}^{n} d^3 \\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor} \\sum_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor} ij[\\gcd(i,j)==1]$$\n\u56e0\u4e3a $\\sum_{t|n} \\mu(t) = [n == 1]$\n\u6240\u4ee5\n$$=\\sum_{d=1}^{n} d^3 \\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor} \\sum_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor} ij \\sum_{t|\\gcd(i,j)} \\mu(t)$$\n$$=\\sum_{d=1}^{n} d^3 \\sum_{t=1}^{\\lfloor\\frac{n}{d}\\rfloor} \\mu(t) t^2 \\sum_{i=1}^{\\lfloor\\frac{n}{td}\\rfloor} \\sum_{j=1}^{\\lfloor\\frac{n}{td}\\rfloor} ij$$\n\n\u8bbe $sum_x = \\sum_{i=1}^{x}$\n\n\u5219\u539f\u5f0f\u7b49\u540c\u4e8e \n\n$$=\\sum_{d=1}^{n} d^3 \\sum_{t=1}^{\\lfloor\\frac{n}{d}\\rfloor} \\mu(t) t^2 (sum_{\\lfloor \\frac{n}{td} \\rfloor})^2$$\n\n\u8bbe $T=td$\n\n$$=\\sum_{T=1}^{n} T^2 (sum_{\\lfloor \\frac{n}{T} \\rfloor})^2 \\sum_{d|t} \\mu (\\frac{T}{d}) d $$\n\n\u56e0\u4e3a\n$$\\sum_{d|n} \\frac{\\mu(d)}{d} = \\frac{\\varphi(n)}{n}$$\n\n\u6839\u636e\u72c4\u5229\u514b\u96f7\u5377\u79ef\n$$id(x) = x , id * \\mu = \\varphi$$\n\n\u90a3\u4e48\u8fd9\u4e2a\u67ff\u5b50\u53d8\u6210\u4e86\n\n$$\\sum_{T=1}^{n}T^2 \\varphi(T) (sum_{\\lfloor \\frac{n}{T} \\rfloor})^2$$\n\n\u7136\u540e\u6211\u4eec\u672c\u8eab\u77e5\u9053 \u5f62\u5982 $\\lfloor \\frac{n}{T} \\rfloor$ \u4e4b\u7c7b\u7684\u73a9\u610f\u53ef\u4ee5\u6570\u8bba\u5206\u5757\n\n\u7136\u540e $f_x = x^2 \\varphi(x)$ \u7684\u524d\u7f00\u548c\n\n\u8bbe $s_x$ \u662f $f_x$ \u7684\u524d\u7f00\u548c\uff0c\u7136\u540e\u8003\u8651 $g$ \u51fd\u6570\n\n\u7136\u540e\u6211\u4eec\u77e5\u9053\n\n$$\\sum_{d|n} \\varphi(d) = n$$\n\n\u8003\u8651 $g$ \u51fd\u6570\u4e3a $g_i = i^2$\n\n$$(g*f)(i) = \\sum_{d|i} d^2 \\varphi (d) \\frac{i^2}{d^2} = \\sum_{d|i}\\varphi (d) i^2 = i^3$$\n\n$$s_n = \\sum_{i=1}^{n} i^3 - \\sum_{i=2}^{n} i^2 s_{\\frac{n}{i}}$$\n\n\u56e0\u4e3a\n$$\\sum_{i=1}^{n}i^3 = (\\sum_{i=1}^{n}i)^2$$\n$$\\sum_{i=1}^{n}i^2 = \\frac{n(n+1)(2n+1)}{6}$$\n\nQ.E.D.\n\n\u675c\u6559\u7b5b\u4e00\u624b\uff0c\u8fd9\u9898\u6ca1\u4e86\u3002\n\n```cpp\n// powered by c++11\n// by Isaunoya\n#include<bits/stdc++.h>\n#define rep(i , x , y) for(register int i = (x) ; i <= (y) ; ++ i)\n#define Rep(i , x , y) for(register int i = (x) ; i >= (y) ; -- i)\nusing namespace std ;\nusing db = double ;\nusing ll = long long ;\nusing uint = unsigned int ;\n#define int long long\nusing pii = pair < int , int > ;\n#define ve vector\n#define Tp template\n#define all(v) v.begin() , v.end()\n#define sz(v) ((int)v.size())\n#define pb emplace_back\n#define fir first\n#define sec second\n// the cmin && cmax\nTp < class T > void cmax(T & x , const T & y) { if(x < y) x = y ; }\nTp < class T > void cmin(T & x , const T & y) { if(x > y) x = y ; }\n// sort , unique , reverse\nTp < class T > void sort(ve < T > & v) { sort(all(v)) ; }\nTp < class T > void unique(ve < T > & v) { sort(all(v)) ; v.erase(unique(all(v)) , v.end()) ; }\nTp < class T > void reverse(ve < T > & v) { reverse(all(v)) ; }\nconst int SZ = 0x191981 ;\nstruct FILEIN {\n\t~ FILEIN () {} char qwq[SZ] , * S = qwq , * T = qwq , ch ;\n\tchar GETC() { return (S == T) && (T = (S = qwq) + fread(qwq , 1 , SZ , stdin) , S == T) ? EOF : * S ++ ; }\n\tFILEIN & operator >> (char & c) { while(isspace(c = GETC())) ; return * this ; }\n\tFILEIN & operator >> (string & s) {\n\t\twhile(isspace(ch = GETC())) ; s = \"\" + ch ;\n\t\twhile(! isspace(ch = GETC())) s += ch ; return * this ;\n\t}\n\tTp < class T > void read(T & x) {\n\t\tbool sign = 1 ; while((ch = GETC()) < 0x30) if(ch == 0x2d) sign = 0 ;\n\t\tx = (ch ^ 0x30) ; while((ch = GETC()) > 0x2f) x = x * 0xa + (ch ^ 0x30) ;\n\t\tx = sign ? x : -x ;\n\t}\n\tFILEIN & operator >> (int & x) { return read(x) , * this ; }\n\tFILEIN & operator >> (signed & x) { return read(x) , * this ; }\n\tFILEIN & operator >> (unsigned & x) { return read(x) , * this ; }\n} in ;\nstruct FILEOUT { const static int LIMIT = 0x114514 ;\n\tchar quq[SZ] , ST[0x114] ; signed sz , O ;\n\t~ FILEOUT () { sz = O = 0 ; }\n\tvoid flush() { fwrite(quq , 1 , O , stdout) ; fflush(stdout) ; O = 0 ; }\n\tFILEOUT & operator << (char c) { return quq[O ++] = c , * this ; }\n\tFILEOUT & operator << (string str) {\n\t\tif(O > LIMIT) flush() ; for(char c : str) quq[O ++] = c ; return * this ;\n\t}\n\tTp < class T > void write(T x) {\n\t\tif(O > LIMIT) flush() ; if(x < 0) { quq[O ++] = 0x2d ; x = -x ; }\n\t\tdo { ST[++ sz] = x % 0xa ^ 0x30 ; x /= 0xa ; } while(x) ;\n\t\twhile(sz) quq[O ++] = ST[sz --] ; return ;\n\t}\n\tFILEOUT & operator << (int x) { return write(x) , * this ; }\n\tFILEOUT & operator << (signed x) { return write(x) , * this ; }\n\tFILEOUT & operator << (unsigned x) { return write(x) , * this ; }\n} out ;\n\nint n , p ;\nconst int maxn = 5e6 + 10 ;\nint phi[maxn + 5] ;\nint iv2 , iv6 ;\nint qpow(int x , int y) {\n\tint res = 1 ;\n\tfor( ; y ; y >>= 1 , x = x * x % p)\n\t\tif(y & 1)\n\t\t\tres = res * x % p ;\n\treturn res ;\n}\nint sum(int x) {\n\tx = x - (x / p) * p ;\n\treturn (x + 1) * x % p * iv2 % p ;\n}\nint sum2(int x) {\n\tx = x - (x / p) * p ;\n\treturn (x + 1) * x % p * (x + x + 1) % p * iv6 % p ;\n}\n\nunordered_map < int , int > _phi ;\nint s(int x) {\n\tif(x <= maxn) return phi[x] ;\n\tif(_phi[x]) return _phi[x] ;\n\tint ans = sum(x) ;\n\tans = ans * ans % p ;\n\tfor(int l = 2 , r ; l <= x ; l = r + 1) {\n\t\tr = x / (x / l) ;\n\t\tans = (ans - (sum2(r) - sum2(l - 1) + p) % p * s(x / l) % p + p) % p ;\n\t}\n\treturn _phi[x] = ans ;\n}\nsigned main() {\n#ifdef _WIN64\n\tfreopen(\"testdata.in\" , \"r\" , stdin) ;\n#else\n\tios_base :: sync_with_stdio(false) ;\n\tcin.tie(nullptr) , cout.tie(nullptr) ;\n#endif\n// code begin.\n\tin >> p >> n ;\n\tiv2 = qpow(2 , p - 2) ;\n\tiv6 = qpow(6 , p - 2) ;\n\tphi[1] = 1 ;\n\tfor(int i = 2 ; i <= maxn; i ++) {\n\t\tif(phi[i]) \n\t\t\tcontinue ;\n\t\tfor(int j = i ; j <= maxn ; j += i) {\n\t\t\tif(! phi[j]) \n\t\t\t\tphi[j] = j ;\n\t\t\tphi[j] = phi[j] / i * (i - 1) ;\n\t\t}\n\t}\n\tfor(int i = 1 ; i <= maxn ; i ++) \n\t\tphi[i] = (phi[i - 1] + 1ll * i * i % p * phi[i] % p) % p ;\n\tint ans = 0 ;\n\tfor(int l = 1 , r ; l <= n ; l = r + 1) {\n\t\tr = n / (n / l) ;\n\t\tint k = sum(n / l) ;\n\t\tk = k * k % p ;\n\t\tans = (ans + (s(r) - s(l - 1) + p) % p * k % p) % p ;\n\t}\n\tout << ans << '\\n' ;\n\treturn out.flush() , 0 ;\n// code end.\n}\n```",
        "postTime": 1580479025,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "$$\n\\sum_{i=1}^n\\sum_{j=1}^nijgcd(i,j)\n$$\n\n$$\n\\sum_{k=1}^n\\sum_{i=1}^n\\sum_{j=1}^nij[gcd(i,j)=k]\n$$\n\n$$\n\\sum_{k=1}^nk^3\\sum_{i=1}^{\\lfloor \\frac{n}{k} \\rfloor}\\sum_{j=1}^{}ij[gcd(i,j)=1]\n$$\n\n$$\n\\sum_{k=1}^nk^3\\sum_{d=1}^{\\lfloor \\frac{n}{k} \\rfloor}\\mu(d)~d^2\\sum_{i=1}^{\\lfloor \\frac{n}{kd} \\rfloor}\\sum_{j=1}^{\\lfloor \\frac{n}{kd} \\rfloor}ij\n$$\n\n\u4ee4$sum^2(n)=\\sum_{i=1}^ni^2 , sum^3(n)=\\sum_{i=1}^ni^3$\n\n\u5229\u7528\u5c0f\u5b66\u5965\u6570\u77e5\u8bc6\u6709:\n\n$$\nsum^2(n)=\\frac{n(n+1)(2n+1)}{6} ~~~ , ~~~ sum^3(n)=\\frac{n^2(n+1)^2}{4}\n$$\n\n\u4e0a\u5f0f\u4e3a\uff1a\n\n$$\n\\sum_{k=1}^nk^3\\sum_{d=1}^{\\lfloor \\frac{n}{k} \\rfloor}\\mu(d)~d^2sum^3(\\frac{n}{kd})\n$$\n\n\u8bb0 $T=kd$ \uff0c \u5219\u539f\u5f0f\u53ef\u7ee7\u7eed\u5316\u7b80\u4e3a\n\n$$\n\\sum_{T=1}^n \\sum_{k|T}k^3 \\mu(\\frac{T}{k})(\\frac{T}{k})^2sum^3(\\frac{n}{T})\n$$\n\n$$\n\\sum_{T=1}^n sum^3(\\frac{n}{T})~T^2 \\sum_{k|T}k \\mu(\\frac{T}{k})\n$$\n\n\u540e\u9762\u662f\u4e00\u4e2a\u5377\u79ef\u5f62\u5f0f: $id*\\mu=\\varphi$\n\n$$\n\\sum_{T=1}^n sum^3(\\frac{n}{T})~T^2 \\varphi(T)\n$$\n\n\u73b0\u5728\u53ea\u9700\u6c42\u5f97 $\\varphi \\times id \\times id$ \u7684\u524d\u7f00\u548c\u5c31\u53ef\u4ee5\u6574\u9664\u5206\u5757\u4e86\u3002\n\n***\n\n$$\nf(n)=\\varphi(n) \\times n \\times n\n$$\n\n$$\ng(n)=n \\times n\n$$\n\n$$\nh(n)=\\sum_{d|n}f(d)* g(\\frac{n}{d})\n$$\n\n$$\n~~ ~~~~~~~~~~~~~~~~~~~~~~~ =\\sum_{d|n}\\varphi(d) \\times d \\times d * \\frac{n}{d} * \\frac{n}{d}\n$$\n\n$$\n~~ ~~~~ =n^2\\sum_{d|n}\\varphi(d)=n^3\n$$\n\n$$\ng(1)S(n)=\\sum_{i=1}^{n}h(i)-\\sum_{d=2}^ng(d)S(\\lfloor \\frac{n}{d} \\rfloor)\n$$\n\n$$\nS(n)=sum^3(n)-\\sum_{d=2}^ng(d)S(\\lfloor \\frac{n}{d} \\rfloor)\n$$\n\n\u8fd9\u9053\u9898\u5c31\u5b8c\u4e86\u3002\n\n```cpp\n#include <map>\n#include <cstdio>\nusing namespace std;\n\nconst int MAXN = 8000000;\nlong long n;\nint p , inv4 , inv6 , k , prime[ MAXN + 5 ] , phi[ MAXN + 5 ] , f[ MAXN + 5 ];\nbool vis[ MAXN + 5 ];\n\nvoid sieve( ) {\n\tf[ 1 ] = phi[ 1 ] = 1;\n\tfor( int i = 2 ; i <= MAXN ; i ++ ) {\n\t\tif( !vis[ i ] ) {\n\t\t\tprime[ ++ k ] = i;\n\t\t\tphi[ i ] = i - 1;\n\t\t}\n\t\tfor( int j = 1 ; j <= k && 1ll * i * prime[ j ] <= MAXN ; j ++ ) {\n\t\t\tvis[ i * prime[ j ] ] = 1;\n\t\t\tif( i % prime[ j ] == 0 ) {\n\t\t\t\tphi[ i * prime[ j ] ] = phi[ i ] * prime[ j ];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t\tphi[ i * prime[ j ] ] = phi[ i ] * ( prime[ j ] - 1 );\t\n\t\t}\n\t\tf[ i ] = ( f[ i - 1 ] + 1ll * i * i % p * phi[ i ] % p ) % p;\n\t}\n}\n\nmap< long long , int > Map;\nint sum2( long long x ) {\n\tx %= p;\n\treturn 1ll * x * ( x + 1 ) % p * ( 2 * x + 1 ) % p * inv6 % p;\n}\nint sum3( long long x ) {\n\tx %= p;\n\treturn 1ll * x * x % p * ( x + 1 ) % p * ( x + 1 ) % p * inv4 % p; \n} \nint Sumphii( long long n ) {\n\tif( n <= MAXN ) return f[ n ];\n\tif( Map[ n ] ) return Map[ n ];\n\t\n\tint Ans = sum3( n );\n\tfor( long long l = 2 , r ; l <= n ; l = r + 1 ) {\n\t\tr = n / ( n / l );\n\t\tAns = ( Ans - 1ll * ( sum2( r ) - sum2( l - 1 ) ) % p * Sumphii( n / l ) % p ) % p; \n\t}\n\treturn Map[ n ] = ( Ans + p ) % p;\n}\nint solve( long long n ) {\n\tint Ans = 0;\n\tfor( long long l = 1 , r ; l <= n ; l = r + 1 ) {\n\t\tr = n / ( n / l );\n\t\tAns = ( Ans + 1ll * ( Sumphii( r ) - Sumphii( l - 1 ) ) * sum3( n / l ) % p ) % p;\n\t}\n\treturn ( Ans + p ) % p;\n}\n\nint Quick_pow( int x , int po ) {\n\tint Ans = 1;\n\twhile( po ) {\n\t\tif( po & 1 ) Ans = 1ll * Ans * x % p;\n\t\tx = 1ll * x * x % p;\n\t\tpo /= 2;\n\t}\n\treturn Ans;\n}\nint Inv( int x ) {\n\treturn Quick_pow( x , p - 2 );\n}\n\nsigned main( ) {\n\tscanf(\"%d %lld\",&p,&n);\n\tsieve( ); \n\tinv4 = Inv( 4 ) , inv6 = Inv( 6 );\n\tprintf(\"%d\", solve( n ) );\n\treturn 0;\n}\n```\n\n\n",
        "postTime": 1577149042,
        "uid": 123802,
        "name": "chihik",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u4e0d\u9519\u7684\u9898\u554a\n\n\n\u8981\u662f\u516c\u5f0f\u5d29\u4e86\u5c31\u5230[\u6211\u7684blog](http://www.yhzq-blog.cc/bzoj2154\u548cluogu3768/)\u4e0a\u770b\u5427\n\n\n#### \u9898\u610f\n\n\n\u6c42\n\n$$\\sum_{i=1}^n\\sum_{j=1}^nijgcd(i,j) \\bmod p$$\n\n\n\u5176\u4e2d$n\\leq 10^{10},p \\in \u8d28\u6570$\n\n\n#### \u9898\u89e3\n\n\n\u8fd9\u4e2a\u9898\u548cbzoj2154\u60ca\u4eba\u7684\u7c7b\u4f3c\u554a\n\n\n\u53cd\u6f14\u5427\n\n\n\u6211\u4eec\u8bbe$gcd(i,j)=d$\n\n\n\u73b0\u5728\u60f3\u8981\u679a\u4e3e$d$\uff0c\u5c31\u786e\u5b9a$ij$\u5982\u4f55\u53d6\u3002\u90a3\u4e48\u5c31\u53ef\u4ee5\u5148\u628a$i,j$\u4e2d\u7684$d$\u56e0\u5b50\u53bb\u6389\u5c31\u53ef\u4ee5\u4e86\u3002\u4e5f\u5c31\u662f$gcd(i/d,j/d)=1$\u3002\n\n\n\u8bbe\n\n$F(x, y) = \\sum_{i=1}^{x} \\sum_{j=1}^{y} ij[gcd(i,j)=1]$\n\n\n\u90a3\u4e48\u539f\u5f0f\u4e2d\u8fd8\u9700\u8981\u4e58\u4e0a$d^2$\uff0c\u56e0\u4e3a\u9664\u6389\u4e86\u4e24\u4e2a\uff1a\n\n\n$\u539f\u5f0f=\\sum_{d=1}^{n} d^3 F( \\frac{n}{d} ,  \\frac{n}{d} )$\n\n\n\u8003\u8651\u5316\u7b80\u4e00\u4e0b\n\n\n$F(x, y)= \\sum_{i=1}^{x} \\sum_{j=1}^{y} ij[gcd(i,j)=1]$\n\n\n\u53cd\u6f14\u4e00\u4e0b\n\n\n$= \\sum_{i=1}^{x} \\sum_{j=1}^{y} ij \\sum_{d|(i,j)} \\mu (d) $\n\n\n\u6539\u6210\u679a\u4e3e$d$\uff0c\u8ba1\u7b97\u4e00\u4e0b\u8d21\u732e\n\n\n$= \\sum_{d=1}^{x} \\mu (d) \\sum_{d|i}^{x} i \\sum_{d|j}^{y} j$\n\n\u6362\u4e2a\u5143\n\n\n$= \\sum_{d=1}^{x} \\mu (d) d^2 \\sum_{i=1}^{ \\frac{x}{d}} i \\sum_{j=1}^{\\frac{y}{d}} j$\n\n\n\u7b49\u5dee\u6570\u5217\u516c\u5f0f\n\n\n$= \\sum_{d=1}^{x} \\mu (d) d^2 \\frac{\\frac{x}{d} ( \\frac{x}{d}+1)}{2} \\frac{\\frac{y}{d} (\\frac{y}{d} +1)}{2} $\n\n\n\u5e26\u56de\u539f\u5f0f\n\n\n$\u539f\u5f0f=\\sum_{d=1}^{n} d^3 F( \\frac{n}{d} ,  \\frac{n}{d} )$\n\n\n\u5e26\u5165\n\n$\\large = \\sum_{d=1}^{n} d^3 \\sum_{i=1}^{ \\frac{n}{d} } \\mu (i) i^2 (\\frac{ \\frac{ \\frac{n}{d} }{i}  ( \\frac{ \\frac{n}{d} }{i}  +1)}{2} )^@ $\n\n\n\u628a$d$\u4e58\u4e0b\u6765\n\n\n$= \\sum_{d=1}^{n} d^3 \\sum_{i=1}^{ \\frac{n}{d} } \\mu (i) i^2( \\frac{ \\frac{n}{di}  ( \\frac{n}{di}  +1)}{2})^2$\n\n\n\u4ee4$T=di$\uff0c\u5219$i|T,d=T/i$\uff0c\u6362\u4e2a\u5143\n\n\n$= \\sum_{T=1}^{n} (\\frac{ \\frac{n}{T}  ( \\frac{n}{T}  +1)}{2})^2 \\sum_{i|T} (\\frac{T}{i})^3 \\mu (i) i^2 $\n\n\n\u628a$T$\u5e26\u51fa\u6765\n\n\n$= \\sum_{T=1}^{n} (\\frac{ \\frac{n}{T}  ( \\frac{n}{T}  +1)}{2})^2 T^2 \\sum_{i|T} \\mu (i) \\frac{T}{i} $\n\n\n\u6240\u4ee5$T \\over i$\u4e5f\u662f\u4e00\u4e2a\u56e0\u5b50\uff0c\u90fd\u662f\u7b49\u4ef7\u7684\uff0c\u6240\u4ee5\u548c\u4e0b\u9762\u662f\u4e00\u6837\u7684\n\n\n$= \\sum_{T=1}^{n} (\\frac{ \\frac{n}{T}  ( \\frac{n}{T}  +1)}{2})^2 T^2 \\sum_{i|T} \\mu (\\frac{T}{i}) i $\n\n\n\u6211\u4eec\u73b0\u5728\u5c31\u8981\u7814\u7a76\u8fd9\u4e2a\u51fd\u6570\n\n\n$f(x)=x^2\\sum_{i|x}\\mu({x \\over i})i$\n\n\n\u5904\u7406\u51fa\u5b83\u7684\u524d\u7f00\u548c\u5c31\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u9898\u4e86\n\n\n\u6211\u4eec\u518d\u6765\u770b\u4e00\u4e0b\u5b83\u7684\u5185\u51fd\u6570\n\n\n$g(x)=\\sum_{i|x}\\mu({x \\over i})i =\\sum_{i|x}\\mu(i){x \\over i}$\n\n\u518d\u7528\u7ebf\u6027\u7b5b\u7684\u601d\u8def\u8bd5\u8bd5\n\n\n\u5728\u7ebf\u6027\u7b5b\u4e2d\uff0c\u5916\u5c42\u4e3a$k$\uff0c\u5185\u5c42\u4e3a$p$\uff0c\u6240\u4ee5\u6c42\n\n\n$g(kp)=\\sum_{i|kp} \\mu({kp \\over i})i=\\sum_{i|kp} \\mu(i){kp \\over i}$\n\n\u5f53$p|k$\u65f6\n\n\n\u5f53$i$\u53d6\u7684\u6570\u7684\u56e0\u5b50\u4e2d\u4e0d\u5305\u542b\u65b0\u52a0\u5165\u7684$p$\u65f6\uff0c\u7b54\u6848\u5c31\u662f$f(k)$\n\n\n\u5f53$i$\u53d6\u5305\u542b\u65b0\u52a0\u5165\u7684\u56e0\u5b50$p$\u65f6\uff0c\u8bbe$i=ap$\n\n\n$=\\mu({kp \\over ap})ap=\\mu({k \\over a})ap$\n\n\n\u4e5f\u5c31\u662f\u591a\u4e86\u4e2a$p$\n\n\n\u7efc\u4e0a\uff0c\u5f53$p|k$\u65f6\uff0c\u7b54\u6848\u4e3a$g(k)p$\n\n\n\u5f53$p \\nmid k$\u65f6\u5f53\n\n\n$i$\u53d6\u7684\u6570\u7684\u56e0\u5b50\u4e2d\u4e0d\u5305\u542b\u65b0\u52a0\u5165\u7684$p$\u65f6\uff0c\u540c\u4e0a\uff0c\u7b54\u6848\u662f$g(k)$\n\n\n\u5f53$i$\u53d6\u7684\u6570\u7684\u56e0\u5b50\u5305\u542b\u65b0\u52a0\u5165\u7684$p$\u65f6\uff0c\u7531\u4e8e\u6307\u6570\u4e3a$1$\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651$i=ap$\uff0c\u539f\u5f0f\u53d8\u4e3a\n\n\n$\\sum_{i|x} \\mu({x \\over i})i$\n\n\n$= \\sum_{ap|kp} \\mu(ap){kp \\over ap} $\n\n\n$= \\sum_{a|k} \\mu (a) \\mu(p) {k \\over a}$\n\n\n$= -\\sum_{a|k} \\mu(a) a $\n\n\n$= - g(k) $\n\n\n\u7efc\u4e0a\uff0c\u5f53$p_y \\nmid k$\u65f6\uff0c\u7b54\u6848\u4e3a$(p-1)g(k)$\n\n\n\u7b5b\u7684\u65f6\u5019\u53d1\u73b0\u8fd9\u4e2a\u51fd\u6570\u7adf\u7136\u662f$\\phi$\uff01\n\n\n\u8fd9\u4e2a\u65b9\u6cd5\u975e\u5e38\u7384\u5b66\u3002\u6211\u4eec\u7528\u66f4\u52a0\u6b63\u7ecf\u7684\u65b9\u6cd5\u8bc1\u660e\u4e00\u4e0b\u3002\n\n\n\u4ee4$h(i)=i$\uff0c\u90a3\u4e48\n\n\n$g(x)=(h\\*\\mu)(x)$\n\n\n\u6211\u4eec\u7ed9$f(x)$\u5377\u4e00\u4e2a1\u8bd5\u8bd5\n\n\n$h\\*\\mu\\*1=h\\*(\\mu\\*1)=h\\*\\epsilon=h$\n\n\n\u4e5f\u5c31\u662f$(h\\*\\mu)\\*1=h$\n\n\n\u53c8\u56e0\u4e3a$\\phi \\*1=h$\n\n\n\u6240\u4ee5$g(x)=\\phi(x),f(x)=x^2\\phi(x)$\n\n\n\u73b0\u5728\u5c31\u662f\u8981\u7528\u675c\u6559\u7b5b\u6765\u89e3\u51b3\u8fd9\u4e2a\u51fd\u6570\u7684\u524d\u7f00\u548c\u3002\n\n\n\u4ee4$c(x)=x^2$\n\n\n\u90a3\u4e48\uff1a\n\n\n$(f\\*c)(x)$\n\n\n$=\\sum_{d|x}f(x)c({x\\over d})$\n\n\n$=\\sum_{d|x}d^2\\phi{x^2 \\over d^2}$\n\n\n$=x^2\\sum_{d|x}\\phi(x)=x^3$\n\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u675c\u6559\u7b5b\u4e86\u3002\u3002\u3002\n\n\n\u4ee4$s(n)=\\sum_{i=1}^nf(x)$\n\n\n\u90a3\u4e48\n\n$c(1)s(n)=\\sum_{i=1}^n(f\\*c)(i)-\\sum_{i=2}^nc(i)s({n \\over i})$\n\n\n$s(n)=\\sum_{i=1}^ni^3-\\sum_{i=2}^ni^2s({n\\over i})$\n\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u505a\u4e86\n\n\n\u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n#include <map>\n#define maxn 4700000\n#define N 4700050\nusing namespace std;\ntypedef long long ll;\nll p,n;\nll inv2,inv6;\nll phi[N],prime[N],tot;\nbool not_prime[N];\nmap <ll,ll> ma;\nll pow(ll x,ll y,ll p)\n{\n    ll ans=1;\n    for (;y;y>>=1,x=x*x%p) \n        if (y&1)\n            ans=ans*x%p;\n    return ans;\n}\nll sqr(ll x) {x%=p;return x*x%p;}\nll g(ll x){x%=p;return sqr((x*(1+x)>>1)%p);}\nll get_h(ll x){x%=p;return x*(x+1)%p*(2*x+1)%p*inv6%p;}\nll min(ll a,ll b){if (a<b) return a;return b;}\nvoid init(ll n)\n{\n    phi[1]=1;\n    for (ll i=2;i<=n;i++)\n    {\n        if (!not_prime[i])\n            prime[++tot]=i,phi[i]=i-1;\n        for (ll j=1;j<=tot;j++)\n        {\n            ll temp=prime[j]*i;\n            if (temp>n)\n                break;\n            not_prime[temp]=1;\n            if (i%prime[j]==0)\n            {\n                phi[temp]=(phi[i]*prime[j])%p;\n                break;\n            }\n            phi[temp]=(phi[i]*(prime[j]-1))%p;\n        }\n    }\n    for(ll i=1;i<=n;i++)\n        phi[i]=(phi[i]*sqr(i)%p+phi[i-1])%p;\n    inv2=pow(2,p-2,p),inv6=pow(6,p-2,p);\n}\nll get_f(ll n)\n{\n    if (n<=maxn) return phi[n];\n    if (ma.count(n)) return ma[n];\n    ll temp=g(n);\n    for (ll i=2,last;i<=n;i=last+1)\n    {\n        last=n/(n/i);\n        temp=(temp-(get_h(last)-get_h(i-1))*get_f(n/i)%p)%p;\n    }\n    return ma[n]=temp;\n}\nmain()\n{\n    scanf(\"%lld%lld\",&p,&n);\n    init(min(maxn,n));\n    ll ans=0;\n    for (ll i=1,last;i<=n;i=last+1)\n    {\n        last=n/(n/i);\n        ans=(ans+g(n/i)*((get_f(last)-get_f(i-1))%p)%p)%p;\n    }\n    printf(\"%lld\\n\",(ans+p)%p);\n}\n```\n",
        "postTime": 1495325270,
        "uid": 17689,
        "name": "\u8fdc\u822a\u4e4b\u66f2",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u975e\u5e38\u6076\u5fc3\u7684\u4e00\u9053\u6570\u5b66\u9898\uff0c\u63a8\u5f0f\u5b50\u63a8\u5230\u5410\u8840\u3002\n\n\u5149\u662f$\\gcd$\u6c42\u548c\u6211\u8fd8\u662f\u4f1a\u7684\uff0c\u4f46\u662f\u591a\u4e86\u4e2a$ij$\u662f\u4ec0\u4e48\u9b3c\u4e1c\u897f\u3002\n\n$$\\sum_{i=1}^n\\sum_{j=1}^nij\\gcd(i,j)=\\sum_{d=1}^nd\\sum_{i=1}^n\\sum_{j=1}^nij[\\gcd(i,j)=d]$$\n\n\u5f88\u5957\u8def\u7684\u628a\u540e\u9762\u7684$d$\u63d0\u51fa\u6765\uff1a\n\n$$\\sum_{d=1}^nd\\sum_{i=1}^n\\sum_{j=1}^nij[\\gcd(i,j)=d]=\\sum_{d=1}^nd^3\\sum_{i=1}^{\\lfloor\\frac{n}{d} \\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{d} \\rfloor} ij[\\gcd(i,j)=1]$$\n\n\u5229\u7528$\\sum_{d|n}\\mu(d)=[n=1]$\u66ff\u6362\u6389$[\\gcd(i,j)=1]$\u5c31\u6709\uff1a\n\n$$\\sum_{d=1}^nd^3\\sum_{i=1}^{\\lfloor\\frac{n}{d} \\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{d} \\rfloor} ij[\\gcd(i,j)=1]=\\sum_{d=1}^nd^3\\sum_{i=1}^{\\lfloor\\frac{n}{d} \\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{d} \\rfloor} ij\\sum_{x|\\gcd(i,j)}\\mu(x)$$\n\n\u7136\u540e\u7b2c\u4e00\u4e2a\u96be\u70b9\u6765\u4e86\uff0c\u6211\u4eec\u628a$x$\u5f04\u5230\u524d\u9762\u53bb\u679a\u4e3e\uff0c\u7136\u540e\u5229\u7528**\u548c\u5f0f\u7684\u53d8\u6362**\uff0c\u679a\u4e3e$i,j$\u662f$x$\u7684\u591a\u5c11\u500d\uff0c\u7136\u540e\u7528\u5206\u914d\u7387\u51d1\u5728\u4e00\u8d77\u5c31\u6709\uff1a\n\n$$\\sum_{d=1}^nd^3\\sum_{i=1}^{\\lfloor\\frac{n}{d} \\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{d} \\rfloor} ij\\sum_{x|\\gcd(i,j)}\\mu(x)=\\sum_{d=1}^nd^3\\sum_{x=1}^{\\lfloor\\frac{n}{d} \\rfloor}\\mu(x) (\\sum_{i=1}^{\\lfloor\\frac{n}{dx} \\rfloor})^2x^2$$\n\nPS:\u5982\u679c\u4e0a\u9762\u7406\u89e3\u4e86\u90a3\u4e48\u4e0b\u9762\u5c31\u4e0d\u96be\u4e86\uff0c\u6211\u4eec\u8bbe$T=dx$\u5e26\u8fdb\u53bb\u5c31\u6709\uff1a\n\n$$\\sum_{d=1}^nd^3\\sum_{x=1}^{\\lfloor\\frac{n}{d} \\rfloor}\\mu(x) (\\sum_{i=1}^{\\lfloor\\frac{n}{dx} \\rfloor})^2x^2=\\sum_{T=1}^n(\\sum_{i=1}^{\\lfloor\\frac{n}{T} \\rfloor}i)^2\\sum_{d|T}d^3\\mu(\\frac{T}{d})(\\frac{T}{d})^2$$\n\n\u540e\u9762\u90a3\u4e2a\u4e1c\u897f\u53ef\u4ee5\u76f4\u63a5\u63d0\u51fa\u6765\u5c31\u5f97\u5230\uff1a\n\n$$\\sum_{T=1}^n(\\sum_{i=1}^{\\lfloor\\frac{n}{T} \\rfloor}i)^2\\sum_{d|T}d^3\\mu(\\frac{T}{d})(\\frac{T}{d})^2=\\sum_{T=1}^n(\\sum_{i=1}^{\\lfloor\\frac{n}{T} \\rfloor}i)^2\\sum_{d|T}dT^2\\mu(\\frac{T}{d})$$\n\n\u628a$T^2$\u63d0\u5230\u524d\u9762\u53bb\uff1a\n\n$$\\sum_{T=1}^n(\\sum_{i=1}^{\\lfloor\\frac{n}{T} \\rfloor}i)^2\\sum_{d|T}dT^2\\mu(\\frac{T}{d})=\\sum_{T=1}^n(\\sum_{i=1}^{\\lfloor\\frac{n}{T} \\rfloor}i)^2T^2\\sum_{d|T}d\\mu(\\frac{T}{d})$$\n\n\u540e\u9762\u90a3\u4e2a$\\sum_{d|T}d\\mu(\\frac{T}{d})$\u663e\u7136\u5c31\u662f**\u72c4\u5229\u514b\u96f7\u5377\u79ef**\u7684\u5f62\u5f0f\u554a\uff0c\u8fd9\u5c31\u7b49\u4e8e$(id\\ast\\mu)(T)$\n\n\u7136\u540e\u56de\u5fc6\u4e00\u4e0b\uff0c$(id\\ast\\mu)(T)$\u4e0d\u5c31\u662f$\\phi$\u4e48\uff0c\u56e0\u6b64\u5e26\u8fdb\u53bb\u5c31\u6709\uff1a\n\n$$\\sum_{T=1}^n(\\sum_{i=1}^{\\lfloor\\frac{n}{T} \\rfloor}i)^2T^2\\sum_{d|T}d\\mu(\\frac{T}{d})=\\sum_{T=1}^n(\\sum_{i=1}^{\\lfloor\\frac{n}{T} \\rfloor}i)^2T^2\\phi(T)$$\n\n\u628a$\\sum_{i=1}^{\\lfloor\\frac{n}{T} \\rfloor}i$\u7528**\u7b49\u5dee\u6570\u5217**\u6c42\u548c\u7684\u516c\u5f0f\u5c55\u5f00\u5c31\u53d8\u6210\uff1a\n\n$$\\sum_{T=1}^n(\\sum_{i=1}^{\\lfloor\\frac{n}{T} \\rfloor}i)^2T^2\\phi(T)=\\sum_{T=1}^n(\\frac{(1+\\lfloor\\frac{n}{T} \\rfloor)\\cdot\\lfloor\\frac{n}{T} \\rfloor}{2})^2T^2\\phi(T)$$\n\n\u5982\u679c\u6211\u4eec\u5bf9$\\lfloor\\frac{n}{T}\\rfloor$\u505a**\u9664\u6cd5\u5206\u5757**\uff0c\u90a3\u4e48\u73b0\u5728\u8981\u6c42\u7684\u5c31\u662f$T^2\\phi(T)$\u7684\u524d\u7f00\u548c\u4e86\n\n\u8003\u8651\u7528**\u675c\u6559\u7b5b**\u7684\u65b9\u6cd5\u5316\u5f0f\u5b50\uff0c\u6211\u4eec\u8bbe$f(i)=i^2\\phi(i)$\uff0c\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u8981\u627e\u4e00\u4e2a$g$\u548c$f$\u5377\u8d77\u6765\u53ef\u4ee5\u65b9\u4fbf\u6c42\u3002\n\n\u7531\u4e8e$i^2$\u5f88\u70e6\uff0c\u6211\u4eec\u8003\u8651\u5148\u628a\u5b83\u6d88\u53bb\u3002\u4ee4$g(i)=i^2$\uff0c\u5219\u6709\uff1a\n\n$h(n)=(f\\ast g)(n)=\\sum_{d|n} d^2\\phi(d)(\\frac{n}{d})^2=n^2\\ast(\\phi\\ast \\epsilon)(n)=n^3$\n\n\u6240\u4ee5\u7528\u675c\u6559\u7b5b\u7684\u5957\u8def\u5f0f\u5c31\u662f$g(1)f(n)=h(n)-\\sum_{d=2}^ng(d)f(\\lfloor\\frac{n}{d}\\rfloor)$\n\n\u5373$f(n)=\\sum_{i=1}^ni^3-\\sum_{d=2}^ng(d)f(\\lfloor\\frac{n}{d}\\rfloor)$\uff0c\u6211\u4eec\u77e5\u9053$\\sum_{i=1}^ni^3=(\\frac{n(n+1)}{2})^2,\\sum_{i=1}^ni^2=\\frac{n(n+1)(2n+1)}{6}$\uff0c\u6240\u4ee5\u90fd\u53ef\u4ee5$O(1)$\u6c42\u5566\u3002\n\nCODE\n\n```cpp\n#include<cstdio>\n#include<map>\n#define RI register int\n#define RL register LL\nusing namespace std;\ntypedef long long LL;\nconst int P=10000000;\nmap <LL,int> sum_f; LL n; int prime[P+5],phi[P+5],cnt,f[P+5],mod,inv2,inv6,ans; bool vis[P+5];\ninline void inc(int &x,int y)\n{\n    if ((x+=y)>=mod) x-=mod;\n}\ninline void dec(int &x,int y)\n{\n    if ((x-=y)<0) x+=mod;\n}\ninline int quick_pow(int x,int p,int mul=1)\n{\n    for (;p;p>>=1,x=1LL*x*x%mod) if (p&1) mul=1LL*mul*x%mod; return mul;\n}\ninline int sum(int x)\n{\n    return 1LL*x*(x+1)%mod*inv2%mod;\n}\ninline int sqr(int l,int r)\n{\n    int t=1LL*r*(r+1)%mod*((r<<1LL)+1)%mod*inv6%mod;\n    dec(t,1LL*l*(l-1)%mod*((l<<1LL)-1)%mod*inv6%mod); return t;\n}\n#define Pi prime[j]\ninline void Euler(void)\n{\n    vis[1]=phi[1]=1; RI i,j; for (i=2;i<=P;++i)\n    {\n        if (!vis[i]) prime[++cnt]=i,phi[i]=i-1;\n        for (j=1;j<=cnt&&i*Pi<=P;++j)\n        {\n            vis[i*Pi]=1; if (i%Pi) phi[i*Pi]=phi[i]*(Pi-1);\n            else { phi[i*Pi]=phi[i]*Pi; break; }\n        }\n    }\n    for (i=1;i<=P;++i) f[i]=f[i-1],inc(f[i],1LL*phi[i]*i%mod*i%mod);\n}\n#undef Pi\ninline int F(LL x)\n{\n    if (x<=P) return f[x]; if (sum_f.count(x)) return sum_f[x];\n    int ans=sum(x%mod); ans=1LL*ans*ans%mod; for (RL l=2,r;l<=x;l=r+1)\n    {\n        r=x/(x/l);\n        int t=sqr(l%mod,r%mod);\n        dec(ans,1LL*t*F(x/l)%mod);\n    }\n    return sum_f[x]=ans;\n}\nint main()\n{\n    //freopen(\"CODE.in\",\"r\",stdin); freopen(\"CODE.out\",\"w\",stdout);\n    scanf(\"%d%lld\",&mod,&n); Euler(); inv2=quick_pow(2,mod-2);\n    inv6=quick_pow(6,mod-2); for (RL l=1,r;l<=n;l=r+1)\n    {\n        r=n/(n/l); int t=sum(n/l%mod); t=1LL*t*t%mod;\n        int Fs=F(r); dec(Fs,F(l-1)); inc(ans,1LL*t*Fs%mod);\n    }\n    return printf(\"%d\",ans),0;\n}\n```",
        "postTime": 1546241092,
        "uid": 41698,
        "name": "hl666",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "## \u524d\u8a00\n\n\u5efa\u8bae\u5230 [\u672c\u849f\u84bb\u7684\u535a\u5ba2](https://www.cnblogs.com/disangan233/p/11142293.html) \u89c2\u770b\u4ee5\u4eab\u53d7\u6700\u597d\u7684\u4f53\u9a8c\u3002\n\n## \u9898\u610f\u7b80\u8ff0\n\n\u6c42\u51fa\u8fd9\u4e2a\u5f0f\u5b50\n\n$$\n\\sum_{i=1}^n\\sum_{j=1}^n ij(i,j) \\bmod p\n$$\n\n## \u505a\u6cd5\n\n\u5148\u7528\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u62c6\u4e00\u4e0b\u5f0f\u5b50\u3002\uff08\u56e0\u4e3a luogu \u7684\u535a\u5ba2\u4e0d\u652f\u6301 `split` \uff0c\u6240\u4ee5\u91c7\u7528pdf\u622a\u56fe\u7684\u65b9\u5f0f\uff09\n\n![shizi](https://cdn.luogu.com.cn/upload/pic/62339.png)\n\n\u6240\u4ee5\u675c\u6559\u7b5b\u76f4\u63a5\u505a $\\sum_i \\varphi(i)$\uff0c\u6b64\u9898\u7ed3\u675f\u3002  \n\n## \u4ee3\u7801\u5b9e\u73b0\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define re register int\n#define db double\n#define ll long long\n#define ak *\n#define in inline\nin char getch()\n{\n\tstatic char buf[10000],*p1=buf,*p2=buf;\n\treturn p1==p2&&(p2=(p1=buf)+fread(buf,1,10000,stdin),p1==p2)?EOF:*p1++;\n} \nchar qwq;\n#define gc() getch()\nin ll read()\n{\n\tll cz=0,ioi=1;qwq=gc();\n\twhile(qwq<'0'||qwq>'9') ioi=qwq=='-'?~ioi+1:1,qwq=gc();\n\twhile(qwq>='0'&&qwq<='9') cz=(cz<<3)+(cz<<1)+(qwq^48),qwq=gc();\n\treturn cz ak ioi;\n}\nconst int lim=5000000;\nll inv2,inv6,mod,a,b,c,d,k,t,mu[5000005],vis[5000005],prime[500005],phi[5000005];\nunordered_map<ll,ll>smu,sphi;\nin void get()\n{\n    mu[1]=phi[1]=1;\n    for(re i=2;i<=lim;i++)\n    {\n        if(!vis[i]) prime[++prime[0]]=i,mu[i]=-1,phi[i]=i-1;\n        for(re j=1;j<=prime[0];j++)\n        {\n            if(i*prime[j]>lim) break;\n            vis[i*prime[j]]=1;\n            if(i%prime[j]==0) {mu[i*prime[j]]=0;phi[i*prime[j]]=prime[j]*phi[i]%mod;break;}\n            else mu[i*prime[j]]=-mu[i],phi[i*prime[j]]=(prime[j]-1)*phi[i]%mod;\n        }\n    }\n    for(re i=2;i<=lim;i++) phi[i]=(phi[i]*1ll*i%mod*i)%mod;\n    for(re i=2;i<=lim;i++) phi[i]=(phi[i-1]+phi[i])%mod;\n}\nin ll get1(ll l,ll r)\n{\n\tl%=mod;r%=mod;\n    ll dy=(l+r)%mod*(r-l+1)%mod*inv2%mod;\n    return dy*dy%mod;\n}\nin ll get2(ll l,ll r)\n{\n\tl%=mod;r%=mod;\n    return (r%mod*(r+1)%mod*(2ll*r+1)%mod*inv6%mod-(l-1)%mod*(2ll*(l-1)+1)%mod*l%mod*inv6%mod+mod)%mod;\n}\nll get_phi(ll n)\n{\n    if(n<=lim) return phi[n];\n    if(sphi[n]) return sphi[n];\n    ll res=get1(1,n);\n    for(ll l=2,r;l<=n;l=r+1)\n    r=n/(n/l),res=(res-get2(l,r)*get_phi(n/l)%mod+mod)%mod;\n    return sphi[n]=res;\n}\ninline ll qpow(ll x,ll y,ll z=1)\n{\n    for(;y;y>>=1,x=x*x%mod) z=(y&1)?x*z%mod:z;\n    return z;\n}\nint main()\n{\n    mod=read();get();\n    ll n=read(),ans=0ll;\n    inv2=qpow(2,mod-2);inv6=qpow(6,mod-2);\n    for(ll l=1,r,s;l<=n;l=r+1)\n    {\n        r=n/(n/(l));\n        ans=(ans+(get_phi(r)-get_phi(l-1)+mod)%mod*get1(1,n/l)%mod)%mod;\n        ans=(ans+mod)%mod;\n    }\n    cout<<ans<<endl;\n    return 0;\n}\n```",
        "postTime": 1562391816,
        "uid": 72679,
        "name": "disangan233",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u5148\u7ed9\u4e24\u4e2a\u516c\u5f0f\u7684\u63a8\u5bfc\n\n$$1^2+2^2+3^2+...+n^2=?$$\n\n$$1^3+2^3+3^3+...+n^3=?$$\n\n\u5de8\u4f6c\u90fd\u8bf4\u6839\u636e\u5c0f\u5b66\u5965\u6570\uff0c\u7136\u800c~~\u849f\u84bb\u5c0f\u5b66\u6ca1\u5b66\u8fc7\u5965\u6570~~\uff0c\u8fd8\u662f\u6709\u5fc5\u8981\u63a8\u4e00\u4e0b\u7684\n\n\u8fd9\u663e\u7136\u662f\u81ea\u7136\u6570\u5e42\u548c\u7684\u4e24\u79cd\u7279\u6b8a\u60c5\u51b5\uff0c~~\u7528\u4f2f\u52aa\u5229\u6570\u53ef\u4ee5\u8f7b\u677e\u89e3\u51b3~~\n\n\u4ee5\u4e0b\u662f\u624b\u7b97\u65b9\u6cd5\n\n$$1^2+2^2+3^2+...+n^2=1+2+3+...+n+1*0+2*1+...+n(n-1)$$\n\n\u4e00\u4e2a\u663e\u7136\u7684\u5f0f\u5b50\n\n$$n(n-1)=\\frac{(n+1)n(n-1)-n(n-1)(n-2)}{3}$$\n\n\u6240\u4ee5\u6709\u539f\u5f0f=\n\n$$\\frac{n(n+1)}{2}+\\frac{-1*0*1+0*1*2-0*1*2+1*2*3-...-n(n-1)(n-2)+(n-1)n(n+1)}{3}$$\n\n$$=\\frac{n(n+1)}{2}+\\frac{(n-1)n(n+1)}{3}$$\n\n$$=\\frac{n(n+1)(2n-1)}{6}$$\n\n\u540c\u7406$\\sum_{i=1}^{n}i^3$\u7684\u5f0f\u5b50\u53ef\u4ee5\u81ea\u5df1\u63a8\u4e00\u4e0b\n\n\u7136\u540e\u53cd\u6f14\n\n\u6709\u516c\u5f0f\n\n$$\\sum_{i|d}\\phi(i)=d$$\n\n\u76f4\u63a5\u5957\u516c\u5f0f\n\n$$\\sum_{i=1}^n\\sum_{j=1}^nij\\sum_{k|i,k|j}\\phi(k)$$\n\n$$=\\sum_{k=1}^nk^2\\phi(k)\\sum_{i=1}^{\\lfloor\\frac{n}{k}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{k}\\rfloor}ij$$\n\n\u4ee4$F(n)=\\sum_{i=1}^{n}i=\\frac{n(n+1)}{2}$\n\n$$\\sum_{k=1}^nk^2\\phi(k)F^2(\\lfloor\\frac{n}{k}\\rfloor)$$\n\n$k^2\\phi(k)$\u663e\u7136\u662f\u79ef\u6027\u51fd\u6570\uff0c\u8003\u8651\u675c\u6559\u7b5b\n\n\u6211\u4eec\u7ed9\u5b83\u5377\u4e0a\u4e00\u4e2a$g(x)=x^2$\n\n$$(f*g)(n)$$\n\n$$=\\sum_{i|n}\\frac{n^2}{i^2}i^2\\phi(i)$$\n\n$$=n^2\\sum_{i|n}\\phi(i)$$\n\n$$=n^3$$\n\n$n^3$ $n^2$\u7684\u524d\u7f00\u548c\u90fd\u5f88\u597d\u7b97\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u6109\u5feb\u5730\u5957\u675c\u6559\u7b5b\u516c\u5f0f\u8fa3\n\nCode:\n```cpp\n#include<stdio.h>\n#include<iostream>\n#include<map>\nusing namespace std;\ntypedef long long ll;\nconst ll N=5000000;\nll p,n,i,j,inv2,inv6,k,s;\nll prime[1000005],phi[5000005];\nmap<int,int> ans;\nll qpow(ll a,ll b)\n{\n    ll s=a,ans=1;\n    while(b)\n    {\n        if(b&1)\n            ans=ans*s%p;\n        s=s*s%p;\n        b>>=1;\n    }\n    return ans;\n}\nll S(ll n)\n{\n    return n%p*(n%p+1)%p*(2*n%p+1)%p*inv6%p;\n}\nll Sum(ll n)\n{\n    if(n<=N)\n        return phi[n];\n    if(ans[n])\n        return ans[n];\n    ll i,j,s=0;\n    for(i=2;i<=n;)\n    {\n        j=n/(n/i);\n        s+=(S(j)-S(i-1))%p*Sum(n/i)%p;\n        i=j+1;\n    }\n    s%=p;\n    ll t=n%p*(n%p+1)%p*inv2%p;\n    t=t*t%p;\n    return ans[n]=t-s;\n}\nint main()\n{\n    cin>>p>>n;\n    inv2=qpow(2,p-2);\n    inv6=qpow(6,p-2);\n    for(i=1;i<=N;i++)\n        phi[i]=i;\n    for(i=2;i<=N;i++)\n    {\n        if(phi[i]==i)\n        {\n            prime[++k]=i;\n            phi[i]=i-1;\n        }\n        for(j=1;j<=k&&prime[j]*i<=N;j++)\n        {\n            phi[prime[j]*i]=phi[prime[j]]*phi[i];\n            if(i%prime[j]==0)\n            {\n                phi[prime[j]*i]=phi[i]*prime[j];\n                break;\n            }\n        }\n    }\n    for(i=2;i<=N;i++)\n    {\n        phi[i]=phi[i]%p*i%p*i%p+phi[i-1];\n        phi[i]%=p;\n    }\n    for(i=1;i<=n;)\n    {\n        j=n/(n/i);\n        s=(s+(Sum(j)-Sum(i-1))%p*(1+(n/i)%p)%p*((n/i)%p)%p*inv2%p*(1+(n/i)%p)%p*((n/i)%p)%p*inv2%p)%p;\n        i=j+1;\n    }\n    cout<<(s%p+p)%p<<endl;\n}\n```\n",
        "postTime": 1561389426,
        "uid": 26800,
        "name": "Sshenyyyu",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u770b\u5230$\\gcd$\u6211\u4eec\u5c31\u6765\u5957\u8def\u4e00\u6ce2\uff0c\u679a\u4e3e\u56e0\u6570\u53ef\u5f97\n\n$$\\sum\\limits_{d=1}^nd^3\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}ij[\\gcd(i,j)=1]$$\n\n\u7136\u540e\u5bf9\u6700\u540e\u7684$\\gcd$\u53cd\u6f14\u5f97\n\n$$\\sum\\limits_{d=1}^nd^3\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}ij\\sum\\limits_{x|i,x|j}\\mu(x)$$\n\n\u7136\u540e\u6211\u4eec\u66f4\u6539\u4e00\u4e0b\u679a\u4e3e\u987a\u5e8f\u5f97\n\n$$\\sum\\limits_{d=1}^nd^3\\sum\\limits_{x=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(x)\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{dx}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{dx}\\rfloor}x^2ij$$\n\n$$\\sum\\limits_{d=1}^nd^3\\sum\\limits_{x=1}^{\\lfloor\\frac{n}{d}\\rfloor}x^2\\mu(x)(\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{dx}\\rfloor}i)^2$$\n\n\u7136\u540e\u6211\u4eec\u8bbe$h(x)=\\sum\\limits_{i=1}^ni$\uff0c\u4ee4$T=dx$\uff0c\u7136\u540e\u518d\u6b21\u66f4\u6539\u679a\u4e3e\u987a\u5e8f\u53ef\u5f97\n\n$$\\sum\\limits_{T=1}^nh(\\dfrac{n}{T})^2\\sum\\limits_{d|T}d^3\u00d7(\\dfrac{T}{d})^2\\mu(\\dfrac{T}{d})$$\n\n$$\\sum\\limits_{T=1}^nh(\\dfrac{n}{T})^2\\sum\\limits_{d|T}T^2d\\mu(\\dfrac{T}{d})$$\n\n$T^2$\u90a3\u4e1c\u897f\u53ef\u4ee5\u63d0\u5230\u5916\u9762\uff0c\u4e8e\u662f\u91cc\u9762\u53ea\u5269\u4e0b$\\sum\\limits_{d|T}d\\mu(\\dfrac{T}{d})$\uff0c\u8fd9\u662f\u4e2a\u5377\u79ef\u5f62\u5f0f\uff0c\u5377\u79ef\u540e\u7684\u7ed3\u679c\u5373\u4e3a$\\varphi(T)$\uff0c\u6211\u4eec\u8bbe$f(T)=T^2\\varphi(T)$\uff0c\u90a3\u4e48\u539f\u5f0f\u53d8\u4e3a\n\n$$\\sum\\limits_{T=1}^nh(\\dfrac{n}{T})^2f(T)$$\n\n\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u6c42\u51fa$f(T)$\u7684\u524d\u7f00\u548c\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6570\u8bba\u5206\u5757$O(\\sqrt n)$\u505a\u5b8c\u8fd9\u9898\u4e86\n\n\u7136\u540e\u4f60\u53d1\u73b0\u8fd9\u9898$n\\leqslant 10^{10}$\uff0c\u7136\u540e\u7ebf\u7b5b\u80af\u5b9a\u4e0d\u884c\u2026\u2026\u6211\u4eec\u9700\u8981\u7528\u5230[\u675c\u6559\u7b5b](https://www.cnblogs.com/Wolfycz/p/10266081.html)\n\n\u7136\u540e\u6211\u4eec\u9700\u8981\u627e\u5230\u4e00\u4e2a\u4f18\u79c0\u7684$g$\uff0c\u4f7f\u5f97$\\sum\\limits_{i=1}^n(f*g)(i)$\u80fd\u591f\u5728$O(1)$\u7684\u65f6\u95f4\u5185\u7b97\u51fa\u6765\uff0c\u6839\u636e\u4eba\u7c7b\u667a\u6167~~(\u5176\u5b9e\u662f\u6253\u8868)~~\uff0c\u5f53$g(i)=i^2$\u65f6\uff0c\u53ef\u4ee5\u5f97\u5230\n\n$$\\begin{aligned}(f*g)(n)&=\\sum\\limits_{d|n}f(d)g(\\dfrac{n}{d})\\\\&=\\sum\\limits_{d|n}d^2\\varphi(d)(\\dfrac{n}{d})^2\\\\&=n^2\\sum\\limits_{d|n}\\varphi(d)\\\\&=n^3\\end{aligned}$$\n\n\u6240\u4ee5$\\sum\\limits_{i=1}^n(f*g)(i)=\\sum\\limits_{i=1}^ni^3$\uff0c\u8fd9\u4e1c\u897f\u7684\u524d\u7f00\u548c\u662f\u5f88\u597d\u7b97\u7684\uff0c\u4e3a$h(n)^2$\uff08\u8bc1\u660e\u8bf7\u81ea\u884cGoogle\uff09\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u7528\u675c\u6559\u7b5b\u5f97\u5230$f(T)$\u7684\u524d\u7f00\u548c\uff0c\u914d\u5408\u4e4b\u524d\u7684\u5f0f\u5b50\u8fdb\u884c\u4e00\u4e0b\u6570\u8bba\u5206\u5757\u5373\u53ef\n\n```cpp\n/*program from Wolfycz*/\n#include<map>\n#include<cmath>\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#define Fi first\n#define Se second\n#define inf 0x7f7f7f7f\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned int ui;\ntypedef unsigned long long ull;\ninline char gc(){\n\tstatic char buf[1000000],*p1=buf,*p2=buf;\n\treturn p1==p2&&(p2=(p1=buf)+fread(buf,1,1000000,stdin),p1==p2)?EOF:*p1++;\n}\ninline int frd(){\n\tint x=0,f=1; char ch=gc();\n\tfor (;ch<'0'||ch>'9';ch=gc())\tif (ch=='-')\tf=-1;\n\tfor (;ch>='0'&&ch<='9';ch=gc())\tx=(x<<3)+(x<<1)+ch-'0';\n\treturn x*f;\n}\ninline int read(){\n\tint x=0,f=1; char ch=getchar();\n\tfor (;ch<'0'||ch>'9';ch=getchar())\tif (ch=='-')\tf=-1;\n\tfor (;ch>='0'&&ch<='9';ch=getchar())\tx=(x<<3)+(x<<1)+ch-'0';\n\treturn x*f;\n}\ninline void print(int x){\n\tif (x<0)\tputchar('-'),x=-x;\n\tif (x>9)\tprint(x/10);\n\tputchar(x%10+'0');\n}\nconst int N=1e7;\nint prime[N+10],phi[N+10],sh[N+10];//sh(x)=\\sum\\limits_{i=1}^i h(i); h(x)=x^2*\\varphi(x)\nbool inprime[N+10];\nint p,inv2,inv4,inv6;\nmap<ll,int>Mp;\nvoid prepare(){\n\tsh[1]=phi[1]=1; int tot=0;\n\tfor (int i=2;i<=N;i++){\n\t\tif (!inprime[i])\tprime[++tot]=i,phi[i]=i-1;\n\t\tfor (int j=1;j<=tot&&i*prime[j]<=N;j++){\n\t\t\tinprime[i*prime[j]]=1;\n\t\t\tif (i%prime[j]==0){\n\t\t\t\tphi[i*prime[j]]=phi[i]*prime[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i*prime[j]]=phi[i]*(prime[j]-1);\n\t\t}\n\t\tsh[i]=(sh[i-1]+1ll*i*i%p*phi[i]%p)%p;\n\t}\n}\nint s2(ll n){n%=p;return 1ll*(2*n+1)*(n+1)%p*n%p*inv6%p;}\nint SH(ll n){\n\tif (n<=N)\treturn sh[n];\n\tmap<ll,int>::iterator it=Mp.find(n);\n\tif (it!=Mp.end())\treturn it->Se;\n\tint tmp=n%p,res=1ll*tmp*tmp%p*(tmp+1)%p*(tmp+1)%p*inv4%p;\n\tfor (ll i=2,pos;i<=n;i=pos+1){\n\t\tpos=n/(n/i);\n\t\tres=(res-1ll*(s2(pos)-s2(i-1))*SH(n/i)%p)%p;\n\t}\n\tres=(res+p)%p;\n\tMp.insert(map<ll,int>::value_type(n,res));\n\treturn res;\n}\nint s1(ll n){n%=p;return 1ll*n*(n+1)%p*inv2%p;}\nint mlt(int a,int b){\n\tint res=1;\n\tfor (;b;b>>=1,a=1ll*a*a%p)\tif (b&1)\tres=1ll*res*a%p;\n\treturn res;\n}\nint main(){\n\tll n;\n\tscanf(\"%d%lld\",&p,&n);\n\tinv2=mlt(2,p-2);\n\tinv4=mlt(4,p-2);\n\tinv6=mlt(6,p-2);\n\tprepare(); int Ans=0;\n\tfor (ll i=1,pos;i<=n;i=pos+1){\n\t\tpos=n/(n/i);\n\t\tAns=(Ans+1ll*(SH(pos)-SH(i-1))*s1(n/i)%p*s1(n/i)%p)%p;\n\t}\n\tprintf(\"%d\\n\",(Ans+p)%p);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1547618510,
        "uid": 21633,
        "name": "Wolfycz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u5148\u770b\u4e00\u4e0b\u8fd9\u9053\u9898\u7684\u7b80\u5316\u7248\uff1a\n\n$$\\sum_{i=1}^n\\sum_{j=1}^n gcd(i,j)$$\n\n\u7531\u4e8e$gcd$\u4e0d\u597d\u5904\u7406\uff0c\u8003\u8651\u628a\u5b83\u53bb\u6389\u3002\n\n\u6b27\u62c9\u51fd\u6570\u6709\u4e00\u4e2a\u6027\u8d28\uff1a\n\n$$\\sum_{d|n}\\phi(d)=n$$\n\n\u4ee3\u5165\u4e4b\u540e\u53d8\u6210\uff1a\n\n$$\\sum_{i=1}^n\\sum_{j=1}^n\\sum_{d|gcd(i,j)}\\phi(d)$$\n\n\u4ea4\u6362\u4e00\u4e0b\u6c42\u548c\u7b26\u53f7\uff1a\n\n$$\\sum_d\\phi(d)\\sum_{d|i}\\sum_{d|j}1$$\n\n\u5316\u7b80\u4e00\u4e0b\uff1a\n\n$$\\sum_{d}\\phi(d)\\lfloor{m\\over d}\\rfloor\\lfloor{n\\over d}\\rfloor$$\n\n------------------------------------------\n\n\u8fd9\u9053\u9898\u53ef\u4ee5\u7528\u76f8\u540c\u7684\u5957\u8def\u5f97\u5230\uff1a\n\n$$\\sum_{i=1}^n\\sum_{j=1}^n ijgcd(i,j)$$\n\n$$=\\sum_{i=1}^n\\sum_{j=1}^nij\\sum_{k|gcd(i,j)}\\phi(k)$$\n\n\u4f9d\u7136\u4ea4\u6362\u6c42\u548c\u53f7\uff1a\n\n$$\\sum_d\\phi(d)\\sum_{d|i}\\sum_{d|j}ij$$\n\n\u5316\u7b80\u4e00\u4e0b\u5373\u662f\uff1a\n\n$$=\\sum_d d^2\\phi(d)\\sum_{i=1}^{\\lfloor{n\\over d}\\rfloor}i^3$$\n\n\u4ee3\u7801\u7684\u8bdd\u675c\u6559\u7b5b+\u6574\u9664\u5206\u5757\u5c31\u641e\u5b9a\u4e86",
        "postTime": 1565423200,
        "uid": 98096,
        "name": "Smallbasic",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "#### luogu P3768 \u7b80\u5355\u7684\u6570\u5b66\u9898\n\n$$\\large \\Big(\\sum_{i=1}^n\\sum_{j=1}^m i*j* gcd(i,j)\\Big) mod p$$\n\n\u679a\u4e3e$gcd$\u7684\u53d6\u503c\n\n$$\\large ~~ \\sum_{k=1}^n k \\sum_{i=1}^n \\sum_{j=1}^m i*j [gcd(i,j)==k]$$\n\n$$\\large \\sum_{k=1}^n k^3 \\sum_{i=1}^n \\sum_{j=1}^m i*j [gcd(i,j)==k]$$\n\n$$\\large \\sum_{k=1}^n k^3 \\sum_{i=1}^{\\lfloor \\frac{n}{k} \\rfloor} \\sum_{j=1}^{\\lfloor \\frac{m}{k} \\rfloor} i*j [gcd(i,j)==1]$$\n\n$$\\large  n'=\\Big \\lfloor \\frac{n}{k} \\Big\\rfloor~~,~~ m'=\\lfloor \\frac{m}{k} \\rfloor$$\n\n$$\\large ~f(x)=\\sum_{i=1}^{n'} \\sum_{j=1}^{m'} i*j [gcd(i,j)==x]$$\n\n$$\\large g(x)=\\sum_{x|d} f(d) = \\sum_{i=1}^{n'} \\sum_{j=1}^{m'} i*j [x|gcd(i,j]$$\n\n$$\\large = \\sum_{i=1}^{\\lfloor \\frac{n'}{x} \\rfloor} \\sum_{j=1}^{\\lfloor \\frac{m'}{x} \\rfloor} i*j [1|gcd(i,j)]$$\n\n$$\\large = \\sum_{i=1}^{\\lfloor \\frac{n}{kx} \\rfloor} \\sum_{j=1}^{\\lfloor \\frac{m}{kx} \\rfloor} i*j$$\n\n$$\\large \\because ~~ \\sum_{i=1}^a \\sum_{j=1}^b i*j = \\frac{ab(a+1)(b+1)}{4}$$\n\n$$\\large \\therefore ~~ g(x)=\\frac { \\lfloor \\frac{n}{kx} \\rfloor \\lfloor \\frac{m}{kx} \\rfloor (\\lfloor \\frac{n}{kx} \\rfloor +1)(\\lfloor \\frac{m}{kx} \\rfloor+1)}{4}$$\n\n\u8fd9\u91cc\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u9898\u76ee\u5f88\u53cb\u597d\u7684$n,m$\u7684\u503c\u4e00\u6837\n\n$$\\large g(x)=\\frac {\\lfloor \\frac{n}{kx} \\rfloor^2 (\\lfloor \\frac{n}{kx} \\rfloor+1)^2} {4}$$\n\n$$\\large f(x)=\\sum_{d=1}^{n'}\\mu(d)g(d)$$\n\n$$\\large Ans= \\sum_{k=1}^n k^3 \\sum_{d=1}^{\\lfloor\\frac{n}{k}\\rfloor}\\mu(d)g(d)$$\n\n$$ T=kd$$\n\n$$\\large Ans=\\sum_{T=1}^n \\frac {\\lfloor \\frac{n}{T} \\rfloor^2 (\\lfloor \\frac{n}{T} \\rfloor+1)^2} {4} \\sum_{k|T} k^3  \\mu\\Big({\\frac{T}{k}}\\Big)$$\n\n$$\\large Ans=\\sum_{T=1}^n sum\\Big(\\Big\\lfloor\\frac{n}{k}\\Big\\rfloor\\Big)^2 T^2  \\varphi(T)$$\n\n\u7136\u540e\u5bf9\u4e8e\u540e\u9762\u7684\u90e8\u5206\u6211\u4eec\u8003\u8651\u675c\u6559\u7b5b\n\n$$\\large f(x)=x^2  \\varphi(x)= \\varphi(x)*id^2~~~ ~~g(x)=id^2$$\n\n$$\\large (f*g)(n)=\\sum_{d|n}( \\varphi(d)d^2)\\Big(\\frac{n}{d} \\Big)^2=n^2\\sum_{d|n} \\varphi(d)=n^3$$\n\n\n \u8fd9\u4e2a\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u7528\u675c\u6559\u7b5b\u6765\u505a\u4e86\n\n\n$$\\large \\sum_{i=1}^n (f*g)(i)=\\sum_{i=1}^n i^3=sum(i)^2$$\n\n~~\u4e2a\u4eba\u611f\u89c9\u89e3\u91ca\u975e\u5e38\u6e05\u695a~~",
        "postTime": 1560775642,
        "uid": 216081,
        "name": "\u5b50\u887f\u541b",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "**\u53cd\u6f14\u795e\u4ed9\u9898\u7eaa\u5ff5!**\n\n\u5728\u9065\u8fdc\u7684\u8fc7\u53bb,\u8fde\u4e58\u6cd5\u9006\u5143\u90fd\u4e0d\u4f1a\u6c42\u7684\u6211,\u6f2b\u6b65\u5728luogu\u4e2d,\u770b\u5230\u4e86\u8fd9\u9053\u8c8c\u4f3c\u53cb\u5584\u7684\u9898,\u70b9\u5f00\u9898\u89e3\u5c31\u88ab\u5927\u4f6c\u4eec\u90a3\u4e00\u5428\u516c\u5f0f\u7ed9\u529d\u9000\u4e86,\u594b\u6597\u4e86\u4e00\u5e74\u534a\u4ee5\u540e,\u7ec8\u4e8eAC\u4e86!\n\n\u4e2a\u4eba\u611f\u89c9\u8fd9\u662f\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u91cc\u9762\u4e2d\u9ad8\u96be\u5ea6\u7684\u4e00\u9053\u9898\u4e86,\u95e8\u69db\u4e5f\u6bd4\u8f83\u9ad8,\u9700\u8981\u719f\u7ec3\u5730\u63a8\u5bfc\u5408\u5f0f\u4e0e\u5b66\u4f1a\u675c\u6559\u7b5b,\u7efc\u4e0a,A\u4e86\u8fd9\u9053\u9898\u8bf4\u660e\u4f60\u7684\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u57fa\u672c\u5165\u95e8\u6210\u529f\u5566!\n\n\u5982\u679c\u4f60\u5bf9\u4e0a\u8ff0\u64cd\u4f5c\u611f\u5230\u56f0\u96be,\u53ef\u4ee5\u67e5\u770b\u6211\u7684[$\\large{\\text{\u6570\u8bba\u4e13\u9898}}$](https://www.luogu.org/blog/command-block/shuo-lun-zhuan-ti)\u3002\n\n\u597d\u4e86,\u6211\u4eec\u9ed8\u8ba4\u4f60\u4f1a\u675c\u6559\u7b5b\u4e86(\u5343\u4e07\u4e0d\u8981\u62ff\u8fd9\u9053\u9898\u6765\u5165\u95e8\u675c\u6559\u7b5b),\u90a3\u5c31\u5f00\u59cb\u5427\u2026\u2026\n\n[\u539f\u9898\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P3768)\n\n\u9644:[\u4e00\u9053\u76f8\u4f3c\u7684\u9898\u76ee](https://www.luogu.org/problemnew/show/P1829)(\u4e0d\u7528\u675c\u6559\u7b5b)\n\n\u6c42:$\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^mij*gcd(i,j)$\n\n\u6309\u7167\u5957\u8def,\u679a\u4e3e$gcd$\u3002\n\n$=\\sum\\limits_{d=1}^n\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^nijd[(i,j)==d]$\n\n$=\\sum\\limits_{d=1}^md\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^nij[(i,j)==d]$\n\n\u540e\u65b9\u540c\u65f6\u9664\u4ee5$d$,\u4e3a\u4e86\u590d\u539f,$ij$\u9879\u9700\u8981\u4e58\u4ee5$d^2$\u8fd8\u539f\u3002\n\n$\\sum\\limits_{d=1}^nd\\sum\\limits_{i=1}^{n/d}\\sum\\limits_{j=1}^{n/d}ijd^2[(i,j)==1]$\n\n$\\sum\\limits_{d=1}^nd^3\\sum\\limits_{i=1}^{n/d}\\sum\\limits_{j=1}^{n/d}ij[(i,j)==1]$\n\n\u6211\u4eec\u8bbe$f(x,n)=\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}ij[(i,j)==x]$\n\n$F(x,n)=\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}ij[x|(i,j)]$\n\n\u5f88\u660e\u663e$F(x,n)=\\sum\\limits_{k=1}^\u221ef(kx,n)$\n\n\u6839\u636e\u53cd\u6f14\u5b9a\u7406\u53ef\u5f97$f(x,n)=\\sum\\limits_{k}^\u221e\\mu(k)F(kx,n)$\n\n\u6211\u4eec\u8981\u6c42$f(1,n)$,\u6839\u636e\u4e0a\u5f0f\u5f97$ANS=\\sum\\limits_{k}^\u221e\\mu(k)F(k,n)$\n\n\u73b0\u5728\u6765\u6c42$F(x,n)$\u3002\n\n$F(x)=\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}ij[x|(i,j)]$\n\n\u628a\u6240\u6709\u7684\u6570\u9664\u4ee5$x$,\u5176\u4e2d\u7684$ij$\u8981\u4e58\u56de$x^2$\n\n\u5f97\u5230$=\\sum\\limits_{i=1}^{n/x}\\sum\\limits_{j=1}^{n/x}ijx^2[1|(i,j)]$\n\n$=x^2\\sum\\limits_{i=1}^{n/x}\\sum\\limits_{j=1}^{n/x}ij$\n\n\u6211\u4eec\u8bbe$sum(x)=\\sum\\limits_{i=1}^{x}\\sum\\limits_{j=1}^{x}ij$\n\n\u53ef\u63a8\u51fa$sum(x)=\\sum\\limits_{i=1}^{x}\\sum\\limits_{j=1}^{x}ij=\\sum\\limits_{i=1}^{x}i\\sum\\limits_{j=1}^{x}j=(\\dfrac{x(x+1)}{2})^2$\n\n\u6240\u4ee5\u4e0a\u5f0f$=x^2*sum(n/x)$\n\n\u6211\u4eec\u56de\u4ee3,\u5f97\u5230$f(1,n)=\\sum\\limits_{k}^\u221e\\mu(k)k^2*sum(n/k)$\n\n\u56de\u4ee3\u81f3\u4e0a\u65b9\u7684$ANS=\\sum\\limits_{d=1}^nd^3\\sum\\limits_{i=1}^{n/d}\\sum\\limits_{j=1}^{n/d}ij[(i,j)==1]$\n\n\u5f97\u5230$ANS=\\sum\\limits_{d=1}^nd^3*f(1,n/d)$\n\n\u6309\u7167\u4e0a\u4e00\u9898\u7684\u505a\u6cd5\u5c31\u53ef\u4ee5$O(n)$\u4e86,\u53ef\u4ee5\u5f97\u523060\u5206\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#define MaxNum 1000500\nusing namespace std;\nint p[MaxNum/10],tn,n,mod;\nlong long mu[MaxNum+500];\nbool e[MaxNum+500];\nvoid getmu()\n{\n  e[1]=1;mu[1]=1;\n  for (int i=2;i<=MaxNum;i++){\n    if (!e[i]){p[++tn]=i;mu[i]=-1;}\n    for (int j=1;j<=tn&&p[j]*i<=MaxNum;j++){\n      mu[p[j]*i]=i%p[j]==0 ? 0 : -mu[i];\n      e[p[j]*i]=1;\n      if (i%p[j]==0)break;\n    }\n  }\n}\nlong long sum(long long n)\n{\n  return ((n*(n+1)/2)%mod)*((n*(n+1)/2)%mod)%mod;\n}\nlong long calc(int n)\n{\n  long long ans=0;\n  for (int l=1,r=0;l<=n;l=r+1){\n    r=n/(n/l);\n    ans=(ans+(mu[r]-mu[l-1])*sum(n/l))%mod;\n  }return ans;\n}\nint main()\n{\n  cin>>mod>>n;\n  getmu();\n  for (int i=2;i<=MaxNum;i++)\n   mu[i]=(mu[i]*i%mod*i+mu[i-1])%mod;\n  long long ans=0;\n  for (long long i=1;i<=n;i++)\n   ans=(ans+i*i%mod*i%mod*calc(n/i))%mod;\n  cout<<(ans+mod)%mod<<endl;\n  return 0;\n}\n```\n\n\u4f46\u662f\u8fd9\u4e0d\u591f\u4f18\u79c0,\u6211\u4eec\u628a\u5f0f\u5b50\u90fd\u5199\u5728\u4e00\u8d77\u770b\u770b:\n\n$ANS=\\sum\\limits_{d=1}^nd^3*\\sum\\limits_{k}^\u221e\\mu(k)k^2*sum(\\dfrac{n}{dk})$\n\n$=\\sum\\limits_{d=1}^nd^3*\\sum\\limits_{k=1}^{n/d}\\mu(k)k^2*sum(\\dfrac{n}{dk})$\n\n\u4ee4$T=dk$,\u597d\u597d\u7406\u89e3\u54e6:\n\n$=\\sum\\limits_{T=1}^n*\\sum\\limits_{k|T}\\mu(k)d^3k^2*sum(\\dfrac{n}{T})$\n\n$=\\sum\\limits_{T=1}^nsum(\\dfrac{n}{T})*\\sum\\limits_{k|T}\\mu(k)(\\dfrac{T}{k})^3k^2$\n\n\u7ea6\u6389\u4e00\u4e9b$k$\n\n$=\\sum\\limits_{T=1}^nsum(\\dfrac{n}{T})*\\sum\\limits_{k|T}\\mu(k)\\dfrac{T^3}{k}$\n\n\u6ce8\u610f\u5230$k|T$,\u540e\u9762\u7684\u53ef\u4ee5\u63d0\u4e00\u4e2a$T^2$,\u53ef\u4ee5\u51d1\u51fa$\\mu*id=\\varphi$\n\n$=\\sum\\limits_{T=1}^nT^2sum(\\dfrac{n}{T})*\\sum\\limits_{k|T}\\mu(k)\\dfrac{T}{k}$\n\n$=\\sum\\limits_{T=1}^nT^2sum(\\dfrac{n}{T})*\\varphi(T)$\n\n\u6574\u7406\u4e00\u4e0b:\n\n$=\\sum\\limits_{T=1}^nsum(\\dfrac{n}{T})*\\varphi(T)*T^2$\n\n\u73b0\u5728\u5f88\u660e\u663e\u4e86,\u5c31\u662f$f(x)=varphi(x)*x^2$\u8fd9\u4e2a\u51fd\u6570\u4e0a\u6574\u9664\u5206\u5757\u800c\u5df2\u3002\n\n\u7136\u540e\u6211\u4eec\u8981\u5bf9$f(x)$\u6765\u4e00\u4e2a\u675c\u6559\u7b5b\u5c31\u597d\u5566\u3002\n\n\u5957\u8def\u5f0f\u5b50$g(1)S(n)=RS(n)-\\sum\\limits_{d=2}g(d)S(\\lfloor n/d\\rfloor)$\n\ng\u51fd\u6570\u9009\u4ec0\u4e48\u5462?\n\n$R(n)=(g*f)(n)=\\sum\\limits_{d|n}d^2*\\varphi(d)*g(n/d)$\n\n\u4ee4$g=id^2$,\u5f97\u5230\n\n$R(n)=\\sum\\limits_{d|n}d^2*\\varphi(d)*(n/d)^2=n^2\\sum\\limits_{d|n}\\varphi(d)$\n\n\u6839\u636e$\\sum\\limits_{d|n}\\varphi(d)=n$\n\n$R(n)=n^3$\n\n\u6240\u4ee5$RS(n)=1+2^3+...+n^3=(\\dfrac{n(n+1)}{2})^2$\n\n$GS(n)=1+2^2+...+n^2=\\dfrac{n(n+1)(2n+1)}{6}$\n\n(\u8fd9\u91cc\u8981\u6c426\u7684\u9006\u5143)\n\n\u73b0\u5728\u53ef\u4ee5\u5f00\u7b5b\u5566!\n\n```cpp\n#include<cstdio>\n#include<bitset>\n#include<map>\n#include<ctime>\n#define Limit 10000000\nusing namespace std;\nlong long T,N,inv6;\nbitset<Limit+500> e;\nint tn,p[Limit+500],mod,rLimit;\nlong long phi[Limit+500];\nlong long powM(long long a,long long t=mod-2)\n{\n  long long ans=1;\n  while(t){\n  \tif (t&1)ans=ans*a%mod;\n  \ta=a*a%mod;\n  \tt>>=1;\n  }return ans;\n}\nvoid getsth()\n{\n  e[1]=1;phi[1]=1;\n  for (int i=2,t;i<=rLimit;i++){\n    if (!e[i]){\n      p[++tn]=i;\n      phi[i]=i-1;\n    }\n    for (int j=1;j<=tn&&(t=p[j]*i)<=rLimit;j++){\n      phi[t]=phi[i]*(i%p[j]==0 ? p[j] : p[j]-1);\n      e[t]=1;\n      if (i%p[j]==0)break;\n    }\n  }\n}\ninline long long GS(long long p)\n{\n  p%=mod;\n  return p*(p+1)%mod*(2*p+1)%mod*inv6%mod;\n}\ninline long long RS(long long p)\n{\n  p%=mod;p=p*(p+1)/2%mod;\n  return p*p%mod;\n}\nmap<long long,long long> savphi;\nlong long S(long long p)\n{\n  if (p<=Limit)return phi[p];\n  if (savphi.count(p))return savphi[p];\n  long long ans=RS(p);\n  long long l=2,r;\n  for (;l<=p;l=r+1){\n    r=p/(p/l);\n    ans=(ans-S(p/l)*(GS(r)-GS(l-1)))%mod;\n  }return savphi[p]=(ans+mod)%mod;\n}\ninline long long Sum(long long p)\n{\n  p%=mod;p=p*(p+1)/2%mod;\n  return p*p%mod;\n}\nint main()\n{\n  scanf(\"%d%lld\",&mod,&N);\n  inv6=powM(6);\n  if (N<Limit)rLimit=N;\n  else rLimit=Limit;\n  getsth();\n  for (long long i=2;i<=rLimit;i++)\n    phi[i]=(phi[i]*i%mod*i+phi[i-1])%mod;\n  long long l=1,r=N,ans=0;\n  for (;l<=N;l=r+1){\n  \tr=N/(N/l);\n  \tans=(ans+Sum(N/l)*(S(r)-S(l-1)))%mod;\n  }printf(\"%lld\",(ans+mod)%mod);\n  return 0;\n}\n```\n\n\u4e3a\u4e86\u8dd1\u8fdb\u6700\u4f18\u89e3\u524d\u4e09\u9875,\u7a0d\u5fae\u5361\u4e86\u4e00\u4e0b\u5e38\u6570QAQ",
        "postTime": 1554641994,
        "uid": 58705,
        "name": "command_block",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u8fd9\u662f\u4e00\u9053\u7ed9\u4eba\u542f\u793a\u7684\u4e00\u9053\u6570\u5b66\u9898\n\n\u4f46\u662f\u6211\u592a\u83dc\u4e86\uff0c\u53ea\u4f1a\u63a8\u4e00\u4e0b\u7248\u7248\u7684\u5f0f\u5b50\n\n\u539f\u5f0f\uff1a\n\n$$\\sum_{i=1}^n\\sum_{j=1}^ni*j*gcd(i,j)$$\n\n\u5316\u7b80\uff1a\n\n$$\\sum_{d=1}^nd^3\\sum_{i=1}^{[n/d]}\\sum_{j=1}^{[n/d]}i*j*[gcd(i,j)==1]$$\n\n\u63a5\u7740\uff1a\n\n$$\\sum_{d=1}^nd^3\\sum_{i=1}^{[n/d]}\\sum_{j=1}^{[n/d]}i*j\\sum_{k|gcd(i,j)}\\mu(k)$$\n\n\u628a$\\mu(k)$\u63d0\u524d\n\n\u7136\u540e\uff1a\n\n$$\\sum_{d=1}d^3\\sum_{k=1}^{[n/d]}\\mu(k)*k^2\\sum_{i=1}^{[n/kd]}\\sum_{i=1}^{[n/kd]}i*j$$\n\n\u6211\u4eec\u8bb0$S(k)$\u4e3a$(\\sum_{i=1}^ki)^2$\n\n\u6211\u4eec\u4ee4$T=k*d$\n\n$$\\sum_{T=1}^nT^2*\\sum_{k|T}\\mu(k)*id(T/d)*S(T)$$\n\n$$\\sum_{T=1}^nT^2\\phi(T)*S(T)$$\n\n\u6211\u4eec\u77e5\u9053$f(x)=x^2$\u548c$\\phi(x)$\u662f\u79ef\u6027\u51fd\u6570\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u72c4\u5229\u514b\u96f7\u5377\u79ef\n\n\u4ee4$h(x)=T^2*\\phi(T)$,\u6211\u4eec\u73b0\u5728\u9700\u8981\u4e00\u4e2a\u9002\u5408\u7684\u51fd\u6570$g(x)$\n\n$$\\sum_{i=1}^n(h*g)(i)$$\n\n$$\\sum_{i=1}^n\\sum_{d|i}h(i)*g(i/d)$$\n\n\u4e8e\u662f\uff1a\n\n$$\\sum_{i=1}^n\\sum_{T|i}^nT^2*\\phi(T)*g(i/T)$$\n\n\u90a3\u4e48\u6211\u4eec\u9700\u8981\u627e\u5230\u4e00\u4e2a\u5408\u9002\u7684$g$\n\n\u4e8e\u662f\u731b\u7136\u53d1\u73b0\u51fd\u6570$f(x)=x^2$\u662f\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\n\n$$\\sum_{i=1}\\sum_{T|i}\\phi(i)*i^2$$\n\n\u7136\u800c\uff1a\n$$\\sum_{i|n}\\phi(i)=n$$\n\n\u2234\n=\n\n$$\\sum_{i=1}^n(f*g)(i)=\\sum_{i=1}i^3$$\n\n\u53c8\u6709\u4e0d\u77e5\u9053\u4ece\u54ea\u91cc\u77e5\u9053\u7684\uff1a\n\n$$\\sum_{i=1}^ni^3=S(n)$$\n\n\u4e8e\u662f\u6211\u4eec\u8fbe\u5230\u4e86\u76ee\u7684\uff0c\u5728$O(1)$\u65f6\u95f4\u5185\u6c42\u51fa\u5377\u79ef\n\n$$\\sum_{i=1}(f*g)(i)$$\n\n\u7684\u503c\uff0c\u5e76\u4e14\u5feb\u901f\u6c42\u51fa\u51fd\u6570\n\n$$g(x)=x^2$$\n\n\u7684\u524d\u7f00\u548c\n\n\u8fd8\u662f\u4e0d\u77e5\u9053\u662f\u5728\u54ea\u79bb\u5b66\u7684:\n\n$$\\sum_{i=1}^ni^2=n*(n+1)*(2*n+1)/6$$\n\n\u5176\u4e2d$S(n)$\u662f\u524d\u9762\u63d0\u5230\u7684\n\n\u4e8e\u662f\u6211\u4eec\u4fbf\u53ef\u4ee5\u6570\u8bba\u5206\u5757\u518d\u5957\u4e00\u4e2a\u675c\u6559\u7b5b\u89e3\u51b3\u6b64\u9898\n\n\u800c\u6211\u8fd8\u662f\u592a\u83dc\u4e86\uff0c\u8fd8\u662f\u53ea\u4f1a\u63a8\u4e00\u4e9b\u6b7b\u7684\u5f0f\u5b50\n\n\u8d34\u4e00\u6ce2\u849f\u84bb\u7684\u4ee3\u7801\uff0c\u597d\u8ba9\u5927\u4f6c\u5632\u8bbd\n\n\u6a21\u6570\u53ebremoon\uff0c\u4e0d\u6015\u4e0dA\u9898\uff0c\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<algorithm>\n#include<map>\nusing namespace std;\n#define int long long\nconst int N = 5000000 ;\nint vis[N+1000] , p[N+1000] , phi[N+1000] , sumphi[N+1000] ;\nint num , n , remoon , inv ;\nmap<int ,int> pphi ;\nint pow(int a , int b)\n{\n    int Ans = 1;\n    while(b) {\n        if(b & 1) Ans = Ans * a % remoon;\n        a = a * a % remoon , b >>= 1;\n    }\n    return Ans;\n}\nvoid find(int x)\n{\n    sumphi[1] = 1 ;\n    phi[1] = 1 ;\n    vis[1] = 1 ;\n    for(int i = 2 ; i <=  x + 10; i++ ){\n        if( !vis[i] ) p[++num] = i , phi[i] = i - 1 ;\n        for(int j = 1 ; j <=num ; j++ ){\n            if( p[j] * i > x + 10 ) break ;\n            vis[ i * p[j] ] = 1 ;\n            if( i % p[j] == 0 )\n            {\n                phi[ p[j] * i ] = phi[i] * p[j] ;\n                break ;\n            }\n            phi[ i * p[j] ] = ( p[j] - 1 ) * phi[i] ;\n        }\n    }\n    for(int i = 2 ; i <= x ; i++ ) ( sumphi[i] = ( sumphi[i - 1] + i % remoon * i % remoon * phi[i] % remoon )) %= remoon ;\n    return ;\n}\nint h(int x)\n{\n    x %= remoon ;\n    return x * (x + 1) % remoon * (x + x + 1) % remoon * inv % remoon ;\n}\nint s(int x)\n{\n    x %= remoon ;\n    return (x * (x + 1) / 2) % remoon * ((x * (x + 1) / 2) % remoon) % remoon; \n}\nint get_phisum(int x)\n{\n    if(x < N) return sumphi[x];\n    if(pphi[x]) return pphi[x];\n    int Ans = s(x);\n    for(int l =  2 , r ; l <= x ; l = r + 1) {\n        r = x / (x / l);\n        (Ans -= (h(r) - h(l - 1) + remoon) % remoon * get_phisum(x / l) % remoon) %= remoon ;\n        //printf(\"%lld\\n\" , Sum_Phi(x / l));\n    }\n    (Ans += remoon) %= remoon;\n    return pphi[x] = Ans;\n}\nsigned main()\n{\n   // freopen(\"toutput.out\",\"w\",stdout) ;\n    scanf(\"%lld%lld\" , &remoon , &n ) ;\n    inv = pow( 6 , remoon - 2 ) ;\n    find(N + 3) ;\n    int Ans = 0 ;\n    for(int l = 1 , r ; l <= n ; l = r + 1) {\n        r = n / (n / l);\n        //printf(\"%lld %lld %lld\\n\" , Sum_Phi(r) , Sum_Phi(l - 1) , Sum3(n / l));\n        (Ans += ( get_phisum(r) - get_phisum(l - 1) + remoon) % remoon * s(n / l) % remoon) %= remoon ;\n    }\n    \n    printf(\"%lld\\n\" , ( Ans += remoon ) %= remoon ) ;\n    return 0 ;\n}\n```\n\n\n\n\u6700\u540e\u819c\u4e00\u53d1zyx\uff1a\n\nzyx\uff1a\u6211\u66fe\u7ecf\u5728\u6bd4\u8d5b\u7684\u65f6\u5019\u6253\u4e86\u4e2a\u66b4\u529b\u5c31\u8fc7\u6765\uff0c\u540e\u6765\u6709\u4eba\u544a\u8bc9\u6211\uff1a\u8fd9\u4e2a\n\n\u5176\u5b9e\u662f\u53ef\u6301\u4e45\u5316zkw\u7ebf\u6bb5\u6811\u5957\u53ef\u6301\u4e45\u5316\u5e73\u8861\u6811\u4ee5\u7ef4\u62a4\u4e0a\u4e0b\u51f8\u5305\u5e76\u4ee5\u7c7b\u4f3c\n\nCDQ\u5206\u6cbb\u7684\u65b9\u6cd5\u8fdb\u884c\u4e0d\u5f3a\u5236\u5728\u7ebf\u7684\u52a8\u6001\u5feb\u901f\u6392\u5e8f\u6765\u89e3\u51b3\u659c\u7387\u4f18\u5316\u52a0\u56db\u8fb9\n\n\u5f62\u4e0d\u7b49\u5f0f\u4f18\u5316\u52a8\u6001dp\u95ee\u9898\u4ee5\u5b9e\u73b0\u53ef\u6301\u4e45\u5316\u5e76\u67e5\u96c6\u5728\u5bf9\u5076\u56fe\u4e0a\u8dd1\n\ndijkstra\u4ee3\u66ff\u539f\u56fe\u4e2d\u7528HLPP\u4f18\u5316\u4e0a\u4e0b\u754c\u7684\u7f51\u7edc\u6700\u5927\u6d41\u5c06\u6a21\u6570\u7528\u552f\u4e00\u5206\n\n\u89e3\u5b9a\u7406\u5206\u89e3\u540e\u7b54\u6848\u7528\u62d3\u5c55\u5362\u5361\u65af\u5b9a\u7406\u6c42\u51fa\u5e76\u7528\u4e2d\u56fd\u5269\u4f59\u5b9a\u7406\u5408\u5e76\u7b54\u6848\n\n\u6700\u540e\u4f7f\u7528\u5957\u6b27\u62c9\u51fd\u6570\u548c\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u8fdb\u884c\u4e00\u6b21\u6811\u4e0a\u83ab\u961f\u5206\u5757\u518d\u5c06\u6700\u540e\n\n\u7684\u7b54\u6848\u4f7f\u7528\u77e9\u9635\u4f18\u5316\u6590\u6ce2\u90a3\u5951\u6570\u5217\u5957\u5feb\u901f\u5e42\u6c42\u51fa\u8fd8\u8981\u8bb0\u5f97\u7528\u7ebf\u6027\u65f6\u95f4\n\n\u6c42\u51fa\u9006\u5143\u3002",
        "postTime": 1553928102,
        "uid": 119610,
        "name": "Regimes",
        "ccfLevel": 7,
        "title": "P3768 \u7b80\u5355\u7684\u6570\u5b66\u9898"
    },
    {
        "content": "\u6c42$\u2211_{i=1}^n\u2211_{j=1}^nijgcd(i,j)$\n\n\u5148\u4e0a\u53cd\u6f14\u5957\u8def\uff1a\n$$\n\\sum_{i=1}^ni\\sum_{j=1}^nj\\sum_{d=1}^{n}[gcd(i,j)=d]\\times d\n$$\n\u6574\u7406\u4e0b\u5f0f\u5b50\n$$\n\\sum_{d=1}^{n}d\\sum_{i=1}^{n/d}i\\sum_{j=1}^{n/d}j[gcd(i,j)=1]\n$$\n\n\u53cd\u6f14\n$$\n\\sum_{d=1}^{n}d\\sum_{i=1}^{n/d}i\\times d\\sum_{j=1}^{n/d}j\\times d\\sum_{k|i,k|j}\\mu(k)\n$$\n\u628ak\u63d0\u5230\u524d\u9762\uff0c\u679a\u4e3ek\u7684\u500d\u6570\n$$\n\\sum_{d=1}^{n}d^3\\sum_{k=1}^{n/d}\\mu(k)\\sum_{i=1}^{n/dk}i\\times k\\sum_{j=1}^{n/dk}j\\times k\n$$\n\u679a\u4e3eT=dk\n$$\n\\sum_{T=1}^n\\sum_{d|T}d^3\\times (\\frac{T}{d})^2\\times\\mu(\\frac{T}{d})\\sum_{i=1}^{n/T}i\\sum_{j=1}^{n/T}j\n$$\n\u6574\u7406\u4e00\u4e0b\uff0c\uff08\u4e2d\u95f4$k^2$\u90a3\u91cc\u6709\u70b9\u8df3\u6b65\uff0c\u4e0d\u8fc7\u5e94\u8be5\u65e0\u4f24\u5927\u96c5\uff09\n$$\n\\sum_{T=1}^nT^2\\sum_{d|T}d\\times\\mu(\\frac{T}{d})\\sum_{i=1}^{n/T}i\\sum_{j=1}^{n/T}j\n$$\n\u8fd9\u6837\u4f60\u5c31\u6709\u4e86\u4e00\u4e2a60\u5206\u7684\u53cd\u6f14\u505a\u6cd5\uff0c\u4e0d\u8fc7\u5982\u679c\u4f60\u50cf\u6211\u4e00\u6837SB\u7684\u8bdd\u5206\u6570\u4f1a\u572810~60\u4e0d\u5b9a\u3002\n\n\u8fd9\u4e2a\u5f0f\u5b50\u663e\u7136\u540e\u9762\u6574\u9664\u5206\u5757\uff0c\u524d\u9762\u7ebf\u7b5b+\u57c3\u7b5b\u7b5b\u51fa$f(T)=T^2\\sum_{d|T}d\\times \\mu(d)$\u7684\u524d\u7f00\u548c\u5373\u53ef\uff0c\u662f$n\\ logn\u200b$\u7684\u3002\n\n\u4f46\u662f\u5176\u5b9e$\\sum_{d|T}d\\times\\mu(\\frac{T}{d})$\u7b49\u4e8e\u6b27\u62c9\u51fd\u6570\uff0c\u4e5f\u5c31\u662f$id*\\mu=\\phi\u200b$\u3002~~\u6211\u4eca\u5929\u624d\u77e5\u9053~~\n\n\u90a3\u4e48\u4f60\u5c31\u53ef\u4ee5\u4e22\u6389\u57c3\u7b5b\u7684log\uff0c$O(n)$\u505a\u4e86\uff0c\u597d\u7684\u8fd8\u662f60\u5206\u3002\n\n\u4e0d\u8fc7$f(x)=x^2\\phi(x)$\u770b\u8d77\u6765\u5c31\u53ef\u4ee5\u675c\u6559\u7b5b\u3002\n\n\u4e0a\u675c\u6559\u7b5b\u516c\u5f0f\uff08h(x)\u8868\u793a\u5377\u79ef\u7684\u524d\u7f00\u548c\uff0cg(x)\u8868\u793a\u675c\u6559\u7b5b\u7528\u7684\u90a3\u4e2a\u51fd\u6570\uff0cs(x)\u8868\u793af(x)\u7684\u524d\u7f00\u548c\uff09\uff1a\n$$\ng(1)s(n)=\\sum_{i=1}^nh(i)-\\sum_{i=2}^ng(i)s(\\frac{n}{i})\n$$\ng\u6211\u4eec\u53d6$id^2$\uff0c\u90a3\u4e48\u6709\u200b\n$$\n\\sum_{i=1}^nh(i)=\\sum_{i=1}^n\\sum_{d|i}d^2\\times\\phi(d)\\times(\\frac{i}{d})^2\\\\\n\n=\\sum_{i=1}^ni^2\\times\\sum_{d|i}\\phi(d)\n$$\n\u800c\u4f60\u6240\u4e0d\u77e5\u9053\u7684\u662f\uff0c$\\phi*1=id$~~\u6211\u4eca\u5929\u624d\u77e5\u9053~~\n\n\u90a3\u4e48\n$$\n\\sum_{i=1}^nh(i)=\\sum_{i=1}^ni^3=(\\frac{n\\times(n+1)}{2})^2\n$$\n\u8fd9\u4e2a\u4e1c\u897f\u662f\u4e2a\u516c\u5f0f\uff0c\u6211\u592a\u83dc\u4e86\uff0c\u6ca1\u4e0a\u8fc7\u5c0f\u5b66\uff0c\u4f46\u6211\u4f1a\u6253\u8868\uff1a\n\n$1^3=1^2$\n\n$1^3+2^3=9=3^2=(1+2)^2$\n\n$1^3+2^3+3^3=36=6^2=(1+2+3)^2$\n\n$1^3+2^3+3^3+...+n^3=(1+2+3+...+n)^2$\n\n\u597d\u7684\u90a3\u6211\u4eec\u53ea\u6709\u6700\u540e\u4e00\u4e2a\u95ee\u9898\u4e86\uff0c\u6c42$\\sum_{i=1}^ni^2$\uff0c\u8fd9\u4e2a\u6211\u4f1a\uff01\uff01\uff01\uff0c\u662f$\\frac{n\\times\\ (n+1)\\times (2n+1)}{6}$\u3002\n\n\u606d\u559c\u4f60\uff0c\u901a\u8fc7\u4e86\u672c\u9898\u3002\n\nps:\u7136\u800c\u5e76\u6ca1\u6709\u4e0a\u9762\u8bf4\u7684\u90a3\u4e48\u7b80\u5355\uff0c\u4f60\u8981\u5c0f\u5fc3\u8fd9\u4e9b\u9519\u8bef\uff1a\n\n```c++\nfor (int i=1; i<=blo; i++) phi[i]=i*i%mod*phi[i]%mod;\n```\n\n\u5e94\u8be5\u4e58\u4e0a1LL\n\n```c++\nll num=x*(x+1)%mod*inv[2]%mod;\n```\n\n\u6362\u6210\u4e00\u822c\u9898\u770b\u8d77\u6765\u5f88\u6b63\u5e38\u5bf9\u5427\uff0c\u4f46\u662fx\u8303\u56f4\u662f1e10\uff0c\u5c31\u662f\u8bf4\u4f60\u5fc5\u987b\u5199\u4e00\u4e2a\u53d8\u91cf\u52a0\u4e00\u4e2a%mod\n\n\u8fd8\u6709\uff0c\u7ebf\u6027\u7b5b\u9884\u5904\u7406\u7684\u9608\u503c\u5f00\u52301e7\u662f\u6700\u5feb\u7684\uff0c2e6\u5c31\u662f\u4e2a\u5f1f\u5f1f\u3002\n\n```c++\n#include<map>\n#include<cmath>\n#include<cstdio>\n#include<iostream>\n#include <tr1/unordered_map>\n#define ll long long\nusing namespace std;\nusing namespace tr1;\nll n,mod,blo,ans,inv[7],phi[10000011];\nint o[10000011],prime[5000010];\ninline void euler(){\n\to[1]=phi[1]=1;\n\tfor (int i=2; i<=blo; i++){\n\t\tif (!o[i]){\n\t\t\to[i]=1; prime[++prime[0]]=i; phi[i]=i-1;\n\t\t}\n\t\tfor (int j=1; j<=prime[0]&&prime[j]*i<=blo; j++){\n\t\t\to[i*prime[j]]=1;\n\t\t\tif (i%prime[j]==0){\n\t\t\t\tphi[i*prime[j]]=phi[i]*prime[j]%mod;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i*prime[j]]=phi[i]*phi[prime[j]]%mod;\n\t\t}\n\t}\n\tfor (int i=1; i<=blo; i++) phi[i]=1LL*i*i%mod*phi[i]%mod;\n\tfor (int i=1; i<=blo; i++) phi[i]=(phi[i]+phi[i-1])%mod;\n}\nunordered_map<ll,ll> m;\nll get_phi(ll x){\n\tif (x<=blo) return phi[x];\n\t// puts(\"ok\");\n\tif (m[x]) return m[x];\n\tll num=x%mod*(x+1)%mod*inv[2]%mod; num=num*num%mod;\n\tll cl,cr;\n\tfor (ll l=2,r; l<=x; l=r+1){\n\t\tr=x/(x/l);\n\t\tcl=(2*l-1)%mod*l%mod*(l-1)%mod*inv[6]%mod;\n\t\tcr=(2*r+1)%mod*r%mod*(r+1)%mod*inv[6]%mod;\n\t\tnum=(num-(cr-cl)%mod*get_phi(x/l)%mod)%mod;\n\t}\n\tnum=(num+mod)%mod; m[x]=num;\n\treturn num;\n}\nint main(){\n\tscanf(\"%lld%lld\",&mod,&n);\n\tblo=1e7; blo=min(blo,n); euler(); inv[1]=1;\n\tfor (int i=2; i<=6; i++) inv[i]=(mod-mod/i)*inv[mod%i]%mod;\n\t// for (int i=1; i<=n; i++){\n\t// \tans=(ans+1LL*phi[i]*sum[n/i]%mod*sum[n/i]%mod)%mod;\n\t// }\n\tll a,b;\n\tfor (ll l=1,r; l<=n; l=r+1){\n\t\tr=n/(n/l); ll m=n/l;\n\t\ta=(get_phi(r)-get_phi(l-1))%mod,b=(m+1)%mod*m%mod*inv[2]%mod;\n\t\tb=b*b%mod; ans=(ans+b*a%mod)%mod;\n\t}\n\tprintf(\"%lld\\n\",(ans+mod)%mod);\n\treturn 0;\n}\n```",
        "postTime": 1552484024,
        "uid": 63661,
        "name": "Taduro",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u52aa\u529b\u5199\u4e2a\u6700\u5bb9\u6613\u61c2\u7684\u9898\u89e3  \n\u9898\u610f\u662f\u6c42\n$$\\sum_{i=1}^{n}\\sum_{j=1}^{n}ijgcd(i,j)$$\n\u663e\u7136\u5148\u628agcd\u679a\u4e3e\u4e00\u4e0b\uff0c\u5047\u8bbegcd(i,j)==k\n\u539f\u5f0f\u5c31\u4e3a\n$$\\sum_{k=1}^{n}k\\sum_{i=1}^{n}\\sum_{j=1}^{n}ij[gcd(i,j)==k]$$\n\u540e\u9762\u8fd9\u4e2a\u5f0f\u5b50\u6839\u636e\u5957\u8def\u53ef\u4ee5\u5f80\u5916\u63d0\u4e00\u4e0b\n$$\\sum_{k=1}^{n}k^3\\sum_{i=1}^{n/k}\\sum_{j=1}^{n/k}ij[gcd(i,j)==1]$$\n\u8fd9\u6837\u5b50\u770b\u7740\u4e00\u8138\u53ef\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u7684\u6837\u5b50\uff0c\u4ee4\n$$f(x)=\\sum_{i=1}^{x}\\sum_{j=1}^{x}ij[gcd(i,j)==1]$$\n\n\u6839\u636e\u67d0\u5f15\u7406\n$$\\sum_{d|x}\\mu(d)=[x=1]$$\n$$f(x)=\\sum_{i=1}^{x}\\sum_{j=1}^{x}\\sum_{d|gcd(i,j)}\\mu(d)$$\n\u6362\u8fc7\u6765\u679a\u4e3ed\n$$f(x)=\\sum_{d=1}^{x}\\mu(d)\\sum_{d|i}\\sum_{d|j}ij$$\n\u540e\u9762\u90a3\u73a9\u610f\u53ef\u4ee5O(1)\u7b97\u7684\n$$f(x)=\\sum_{d=1}^{x}\\mu(d)d^2(1+2+3+...+[\\frac{x}{d}])^2$$\n\u53cd\u6f14\u5b8c\u4e86\uff0c\u6211\u4eec\u628a\u5b83\u4ee3\u56de\u53bb\n$$\\sum_{k=1}^{n}k^3f([\\frac{n}{k}])$$\n$$\\sum_{k=1}^{n}k^3\\sum_{d=1}^{n/k}\\mu(d)d^2(1+2+3+...+[\\frac{n}{kd}])^2$$\n\u4ee4$sum(x)=1+2+3+...+x,g=kd$\u679a\u4e3eg,\u518d\u968f\u4fbf\u679a\u4e3e\u4e2ak\n$$\\sum_{g=1}^{n}sum(g)^2\\sum_{k|g}k^3(\\frac{g}{k})^2\\mu(\\frac{g}{k})$$\n\u6709\u4e9b\u9879\u53ef\u4ee5\u6d88\u6389\n$$\\sum_{g=1}^{n}sum(g)^2\\sum_{k|g}g^2k\\mu(\\frac{g}{k})$$\n\u663e\u7136$g^2$\u53ef\u4ee5\u63d0\u51fa\u6765\n$$\\sum_{g=1}^{n}sum(\\frac{n}{g})^2g^2\\sum_{k|g}k\\mu(\\frac{g}{k})$$\n\u663e\u7136\u524d\u9762\u53ef\u4ee5\u6574\u9664\u5206\u5757  \n\u4e3b\u8981\u9700\u8981\u5feb\u901f\u6c42\u51fa\u540e\u9762\u7684\n$$g^2\\sum_{k|g}k\\mu(\\frac{g}{k})$$\n\u8fd9\u65f6\u5019\u72c4\u5229\u514b\u96f7\u5377\u79ef\u5c31\u6709\u7528\u4e86  \n\u5e38\u89c1\u7684\u51e0\u4e2a\u72c4\u5229\u514b\u96f7\u5377\u79ef  \n$d=1*1$  \n$\\sigma=1*id$  \n$e=1*\\mu$  \n$\\phi=\\mu*id$  \n$id=\\phi*1$    \n$id$\u8868\u793a$f(x)=x$  \n\u663e\u7136\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u7528\u7684\u662f$\\phi=\\mu*id$  \n\u5377\u5b8c\u4ee5\u540e\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\n$$f(g)=g^2\\phi(g)$$\n\u8fd9\u65f6\u5019\u9700\u8981\u8ba1\u7b97\u4e0a\u9762\u51fd\u6570\u7684\u524d\u7f00\u548c$s(n)$\uff0c\u90a3\u4e48\u5c31\u662f\u675c\u6559\u7b5b\u7684\u5957\u8def\n$$g(1)s(n)=\\sum_{i=1}^{n}(g*f)(i)-\\sum_{i=2}^{n}g(i)s(\\frac{n}{i})$$\n\u770b\u770b\u8981\u5377\u7684\u4e1c\u897f\n$$(g*f)(i)=\\sum_{d|i}g(d)f(\\frac{i}{d}) =\\sum_{d|i}g(d)(\\frac{i}{d})^2\\phi(\\frac{i}{d})$$\n\u663e\u7136\u4ee4$g(x)=x^2$\u5c31\u53ef\u4ee5\u628a$(\\frac{i}{d})^2$\u6d88\u6389\n$$i^2\\sum_{d|i}\\phi(\\frac{i}{d})$$\n$$1*\\phi(i)=id$$\n$$i^2\\sum_{d|i}\\phi(\\frac{i}{d})=i^3$$\n$$s(n)=\\sum_{i=1}^{n}i^3-\\sum_{i=2}^{n}i^2s(\\frac{n}{i})$$\n\u8fd9\u4e2a\u524d\u7f00\u548c\u7528\u675c\u6559\u7b5b\u5904\u7406\u4e4b\u540e\uff0c\u603b\u590d\u6742\u5ea6\u662f$O(n^{\\frac{2}{3}})$",
        "postTime": 1551605619,
        "uid": 185441,
        "name": "\u30cb\u30d2\u30eb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u5927\u529b\u63a8\u5f0f\u5b50\u5427\uff08\u597d\u9ebb\u70e6\u554a\u2026\u2026\u8fd8\u4e0d\u5982\u7528$\\phi$\u53cd\u6f14\uff09\u2026\u2026\n\n$\\begin{aligned}\\sum_{i=1}^{n}\\sum_{j=1}^{n}ij(i,j)&=\\sum_{d=1}^{n}d\\sum_{i=1}^{n}\\sum_{j=1}^{n}ij[(i,j)=d] \\\\ &=\\sum_{d=1}^{n}d^3\\sum_{i=1}^{\\lfloor \\frac{n}{d} \\rfloor}\\sum_{j=1}^{\\lfloor \\frac{n}{d} \\rfloor}ij\\sum_{x \\mid (i,j)} \\mu(x) \\\\ &=\\sum_{d=1}^{n}d^3\\sum_{i=1}^{\\lfloor \\frac{n}{d} \\rfloor}\\sum_{j=1}^{\\lfloor \\frac{n}{d} \\rfloor}ij\\sum_{x \\mid (i,j)} \\mu(x) \\\\ &=\\sum_{d=1}^{n}d^3\\sum_{x=1}^{\\lfloor \\frac{n}{d} \\rfloor}\\mu(x)(\\sum_{i=1}^{\\lfloor \\frac{n}{dx} \\rfloor}i)^2x^2\\end{aligned}$\n\n\u8bbe$T=dx$\n\n\u5219\n\n$\\begin{aligned}\\sum_{i=1}^{n}\\sum_{j=1}^{n}ij(i,j)&=\\sum_{d=1}^{n}d^3\\sum_{x=1}^{\\lfloor \\frac{n}{d} \\rfloor}\\mu(x)(\\sum_{i=1}^{\\lfloor \\frac{n}{dx} \\rfloor}i)^2x^2 \\\\&=\\sum_{T=1}^{n}(\\sum_{i=1}^{\\lfloor \\frac{n}{T} \\rfloor}i)^2\\sum_{d|T}d^3\\mu(\\frac{T}{d})(\\frac{T}{d})^2 \\\\&=\\sum_{T=1}^{n}(\\sum_{i=1}^{\\lfloor \\frac{n}{T} \\rfloor}i)^2\\sum_{d|T}d^3\\mu(\\frac{T}{d})(\\frac{T}{d})^2 \\\\&=\\sum_{T=1}^{n}(\\sum_{i=1}^{\\lfloor \\frac{n}{T} \\rfloor}i)^2\\sum_{d|T}dT^2\\mu(\\frac{T}{d}) \\\\&=\\sum_{T=1}^{n}(\\sum_{i=1}^{\\lfloor \\frac{n}{T} \\rfloor}i)^2T^2\\sum_{d|T}d\\mu(\\frac{T}{d}) \\\\&=\\sum_{T=1}^{n}(\\sum_{i=1}^{\\lfloor \\frac{n}{T} \\rfloor}i)^2T^2 (id \\times \\mu)(T) \\\\&=\\sum_{T=1}^{n}(\\sum_{i=1}^{\\lfloor \\frac{n}{T} \\rfloor}i)^2T^2 \\phi(T) \\\\&=\\sum_{T=1}^{n}(\\frac{(1+\\lfloor \\frac{n}{T} \\rfloor)\\lfloor \\frac{n}{T} \\rfloor}{2})^2(T^2 \\phi(T)) \\\\\\end{aligned}$\n\n\u4e0d\u59a8\u5bf9$\\lfloor \\frac{n}{T} \\rfloor$\u8fdb\u884c\u6570\u8bba\u5206\u5757\uff0c\u53ea\u9700\u8981\u5feb\u901f\u8ba1\u7b97$T^2\\phi(T)$\u5373\u53ef\n\n\u8bbe$f(n)=n^2\\phi(n)$\uff0c\u6b64\u65f6\u9700\u8981\u627e\u4e00\u4e2a$g$\uff0c\u4f7f\u5f97$g$\u548c$f \\times g$\u90fd\u53ef\u4ee5\u5feb\u901f\u8ba1\u7b97\n\n\u4e0d\u59a8\u8bbe$g(n)=n^2$\n\n\u5219$h(n)=(f \\times g)(n)= \\sum_{d|n}d^2\\phi(d)(\\frac{n}{d})^2=n^2 \\times (\\phi \\times 1)(n)=n^2 \\times n=n^3$\n\n\u675c\u6559\u7b5b\u544a\u8bc9\u6211\u4eec\uff0c$g(1)F(n)=H(n)-\\sum_{d=2}^{n}g(d)F(\\lfloor \\frac{n}{d} \\rfloor)$\n\n\u5373$F(n)=\\sum_{i=1}^{n}i^3-\\sum_{d=2}^{n}d^2F(\\lfloor \\frac{n}{d} \\rfloor )$\n\n\u4e5f\u5c31\u662f\u8bf4$F(n)=(\\frac{(1+n)n}{2})^2-\\sum_{d=2}^{n}d^2F(\\lfloor \\frac{n}{d} \\rfloor)$\n\n\u540c\u65f6\u6709$D(n)=\\sum_{i=1}^{n}i^2=\\frac{n(n+1)(2n+1)}{6}$\n\n---\n\n``` cpp\n#include \"bits/stdc++.h\"\nusing namespace std;\ntypedef long long ll;\nconst int N = 1e7 + 10;\nll n, p, f[N], phi[N], inv2, inv6;\nint vis[N], pri[N], tot;\n\nmap<ll, ll> mp;\n\nll sum2(ll n) {\n\tn %= p;\n\treturn n * (n + 1) % p * inv2 % p;\n}\n\nll sum3(ll n) {\n\tn %= p;\n\treturn n * (n + 1) % p * (2 * n + 1) % p * inv6 % p;\n}\n\nll F(ll n) {\n\tif(n <= (int) 1e7) {\n\t\treturn f[n];\n\t} else if(mp.find(n) != mp.end()) {\n\t\treturn mp[n];\n\t} else {\n\t\tll res = sum2(n); res = res * res % p;\n\t\tfor(ll i = 2, j ; i <= n ; i = j + 1) {\n\t\t\tj = n / (n / i);\n\t\t\tll t = (sum3(j) - sum3(i - 1)) % p;\n\t\t\tres = (res - t * F(n / i) % p) % p;\n\t\t}\n\t\treturn mp[n] = res;\n\t}\n}\n\nll pw(ll a, ll b) {\n\tll r = 1;\n\tfor( ; b ; b >>= 1, a = (ll) a * a % p) if(b & 1) r = (ll) r * a % p;\n\treturn r;\n}\n\nll sol(ll n) {\n\tll res = 0;\n\tfor(ll i = 1, j ; i <= n ; i = j + 1) {\n\t\tj = n / (n / i);\n\t\tll sum = ((1 + n / i) % p) % p * ((n / i) % p) % p * inv2 % p;\n\t\tsum = sum * sum % p;\n\t\tll same = (F(j) - F(i - 1)) % p;\n\t\tres = (res + sum * same % p) % p;\n\t}\n\treturn res;\n}\n\nint main() {\n\n\tscanf(\"%lld%lld\", &p, &n);\n\tinv2 = pw(2, p - 2), inv6 = pw(6, p - 2);\n\n\tphi[1] = 1;\n\tfor(int i = 2 ; i <= (int) 1e7 ; ++ i) {\n\t\tif(!vis[i]) {\n\t\t\tpri[++ tot] = i;\n\t\t\tphi[i] = i - 1;\n\t\t}\n\t\tfor(int j = 1 ; j <= tot && (ll) i * pri[j] <= (int) 1e7 ; ++ j) {\n\t\t\tvis[i * pri[j]] = 1;\n\t\t\tif(i % pri[j] == 0) {\n\t\t\t\tphi[i * pri[j]] = phi[i] * pri[j];\n\t\t\t\tbreak;\n\t\t\t} else phi[i * pri[j]] = phi[i] * phi[pri[j]];\n\t\t}\n\t}\n\tfor(int i = 1 ; i <= (int) 1e7 ; ++ i) {\n\t\tf[i] = (f[i - 1] + phi[i] * i % p * i % p) % p;\n\t}\n\n\tprintf(\"%lld\\n\", (sol(n) % p + p) % p);\n}\n```",
        "postTime": 1530697902,
        "uid": 47111,
        "name": "nekko",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u6211\u521a\u521a\u5199\u4e86\u4e00\u7bc7\u8d85\u957f\u7684[\u535a\u5ba2](http://www.cnblogs.com/cellular-automaton/p/8241128.html \"\u535a\u5ba2\")qwq\n\n\u4e0d\u8fc7\u8fd8\u662f\u628a\u5185\u5bb9\u590d\u5236\u4e00\u4e0b\u6bd4\u8f83\u597d\n\n\u6211\u4eec\u4ece\u6700\u57fa\u672c\u7684\u9898\u610f\u5f00\u59cb\uff0c\u4e00\u6b65\u6b65\u5f80\u4e0b\u63a8\n\n\n\u9996\u5148\u9898\u9762\u7ed9\u51fa\u7684\u516c\u5f0f\u662f\u2211i=1n\u2211j=1nijgcd(i,j)\n\n\n\u679a\u4e3egcd(i,j)=w\uff0c\u5f97\u5230\n\n\n\u2211w=1nw\u2211i=1n\u2211j=1nij[w=gcd(i,j)]\n\n\n\u8fd9\u65f6\u5019\u6211\u4eec\u8bbe\u4e00\u4e2af(x)=\u2211i=1n\u2211j=1nij[x=gcd(i,j)]\n\n\n\u4e00\u4e2aF(x)=\u2211i=1n\u2211j=1nij[x|gcd(i,j)]\n\n\n\u5bb9\u6613\u53d1\u73b0\uff08\u5176\u5b9e\u5c31\u662f\u4e3a\u4e86\u51d1\u83ab\u6bd4\u4e4c\u65af\u516c\u5f0f\u624d\u641e\u7684\u8fd9\u4e24\u4e2a\u51fd\u6570\uff0c\u5728\u6784\u9020\u51fd\u6570\u4e4b\u524d\u5c31\u201c\u5bb9\u6613\u53d1\u73b0\u201d\u4e86\uff09\n\n\n\n\u3000\u3000F(x)=\u2211x|df(d)\n\n\u600e\u4e48\u6837\u2026\u2026\u50cf\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u516c\u5f0f\u5427\n\n\n\n\u3000\u3000f(d)=\u2211d|x\u03bc(xd)F(x)\n\n\u7136\u540e\u539f\u5f0f\u5c31\u53d8\u6210\u4e86\n\n\n\u2211w=1nw\u2211w|t\u03bc(tw)F(t)\n\n\n\u636e\u8bf4\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u6784\u9020\u7684F(x)\u4e00\u5b9a\u8981\u7b80\u5355\u6613\u6c42\n\n\n\u7136\u540e\u2026\u2026\u81ea\u5df1\u627e\u51e0\u7ec4\u89c4\u5f8b\u53ef\u4ee5\u53d1\u73b0F(x)=(x+2x+3x+......+nxx)2\n\n\n\u7136\u540e\u2026\u2026\u7ee7\u7eed\u627e\u89c4\u5f8b\u53d1\u73b0\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u4f60\u53ef\u4ee5\u628ax\u63d0\u51fa\u6765\u3002qwq\u3002\n\n\n\u4e8e\u662fF(x)\u6210\u529f\u7684\u53d8\u6210\u4e86x2(1+2+3+......+nx)2\n\n\n\u7136\u540e\u6211\u4eec\u56de\u5934\u53bb\u627e\u6254\u6389\u7684\u539f\u5f0fqwq\n\n\n\u539f\u5f0f=\u2211w=1nw\u2211w|t\u03bc(tw)F(t)\n\n\n=\u2211w=1nw3\u2211w|t\u03bc(tw)tw2(1+.......+nt)2\n\n\nemm\u6211\u4eec\u4f3c\u4e4e\u53d1\u73b0\u4e86\u4ec0\u4e48\u2026\u2026\n\n\n\u4e8e\u662f\u5c31\u8bbed=tw\n\n\n\u7136\u540e\u628a\u539f\u5f0f\u5c31\u6574\u7406\u6210\u4e86\n\n\n\u2211w=1nw3\u2211d=1nw\u03bc(d)d2(1+.......+nwd)2\n\n\n\u5230\u6b64\u4e3a\u6b62\u5c31\u670960\u5206\u5566\u3002\u4e0d\u9700\u8981\u675c\u6559\u7b5b\u72c4\u5229\u514b\u96f7\u5377\u79ef\u4ec0\u4e48\u4e71\u4e03\u516b\u7cdf\u7684\u73a9\u610f\u3002\n\n\n\uff08\u7136\u540e\u5269\u4e0b40\u5206\u82b1\u6389\u4e86\u6211\u4e00\u5929+22\u4e2a\u534a\u5c0f\u65f6\uff09\n\n\n\u7136\u540e\u6211\u81ea\u5df1\u5dee\u4e0d\u591a\u5c31\u60f3\u5230\u8fd9\u91cc\u4e3a\u6b62\u4e86\u3002\u5269\u4e0b\u7684\u662frqy\u7684\u8111\u8865\u3002\n\n\n\u770b\u5230\u8fd9\u91cc\u9762\u4e00\u5927\u5806\u4e0b\u53d6\u6574\u7684\u73a9\u610f\u6211\u4eecrqy\u975e\u5e38\u4e0d\u723d\u3002\n\n\n\u7136\u540e\u4ed6\u5148\u628a\u516c\u5f0f\u98a0\u5012\u4e86\u4e00\u4e0b\n\n\n\u2211d=1n\u03bc(d)d2\u2211w=1ndw3(1+......+nwd)2\n\n\n\u53c8\u4ee4k=wd\n\n\n\u7136\u540e\u6539\u6210\u679a\u4e3ek\n\n\n\u5f0f\u5b50\u5c31\u53d8\u6210\u4e86\u2211k=1n\u2211d|k\u03bc(kd)(kd)2d3(1+....+nk)2\n\n\n=\u2211k=1n\u2211d|k\u03bc(kd)k2d(1+....+nk)2\n\n\n\u53d1\u73b0\u6709\u4e24\u9879k2\n\n\n,(1+....+nk)2\n\n\u8ddfd\u6ca1\u4ec0\u4e48\u5375\u5173\u7cfb\n\n\n\u63d0\u51fa\u6765\u63d0\u51fa\u6765\n\n\n\u2211k=1nk2(1+....+nk)2\u2211d|k\u03bc(kd)d\n\n\n\u597d\uff0c\u606d\u559c\u4f60\u2211d|k\u03bc(kd)d=\u03d5(k)\n\n\n\u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3a\u6839\u636e\u72c4\u5229\u514b\u96f7\u5377\u79ef\u516c\u5f0f\u03bc\u22171=e\n\n\n\u03d5\u22171=n\n\n\n\u6240\u4ee5n\u2217\u03bc=\u03d5\u22171\u2217\u03bc=\u03d5\u2217e=\u03d5\n\n\n\u7136\u540e\u4f60\u5217\u4e00\u5217\u8fd9\u4e2a\u5377\u79ef\u516c\u5f0f\u3002\n\n\n\u60ca\u4e0d\u60ca\u559c\uff1f\u610f\u4e0d\u610f\u5916\uff1f\n\n\n\u7136\u540e\u539f\u5f0f\u53d8\u6210\u4e86\u2211k=1nk2(1+....+nk)2\u03d5(k)\n\n\n\u7136\u540e\u4e00\u770b\u5230nk\n\n\n\u6709\u6839\u53f7n\u79cd\uff0c\u975e\u5e38\u6fc0\u52a8\uff0c\n\n\n\u7136\u540e\u73b0\u5728\u7684\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u600e\u4e48\u5feb\u901f\u6c42k2\u03d5(k)\n\n\n\u7684\u524d\u7f00\u548c\n\n\n\u7136\u540e\u53d1\u73b0\u8fd9\u4e2a\u73a9\u610f\u7528\u675c\u6559\u7b5b\u597d\u50cf\u5f88\u53ef\u505a\u7684\u6837\u5b50\n\n\n\u7801\u4e86\u7801\u4e86\n",
        "postTime": 1515378633,
        "uid": 25815,
        "name": "\u5c01\u766b",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\n```cpp\n\\begin{align*}\nans&=\\sum_{i=1}^n\\sum_{j=1}^nij\\gcd(i,j)\\\\\n&=\\sum_{d=1}^n d \\sum_{d|i}\\mu (\\frac{i}{d})\\sum_{i|j}\\sum_{i|k}jk\\\\\n&=\\sum_{d=1}^n d \\sum_{d|i}\\mu (\\frac{i}{d})\\frac{i^2\\lfloor\\frac{n}{i}\\rfloor^2(1+\\lfloor\\frac{n}{i}\\rfloor)^2}{4}\\\\\n&=\\sum_{i=1}^n \\frac{i^2\\lfloor\\frac{n}{i}\\rfloor^2(1+\\lfloor\\frac{n}{i}\\rfloor)^2}{4} \\sum_{d|i}d\\cdot \\mu(\\frac{i}{d})\n\\end{align*}\n```\n\u56e0\u4e3a\u6709 $\\mu * id = \\varphi$\uff0c\u5176\u4e2d $*$ \u4e3aDirichlet\u5377\u79ef\uff0c\u5373$$\\sum_{d|i}\\mu(d)\\cdot \\frac{i}{d}=\\varphi(i)$$\n\n\u5219\u539f\u5f0f\u4e3a\n\n\n```cpp\n\\begin{align*}\n&\\sum_{i=1}^n \\frac{i^2\\lfloor\\frac{n}{i}\\rfloor^2(1+\\lfloor\\frac{n}{i}\\rfloor)^2}{4}\\varphi(i)\\\\\n=& \\sum_{i=1}^n \\frac{\\lfloor\\frac{n}{i}\\rfloor^2(1+\\lfloor\\frac{n}{i}\\rfloor)^2}{4} i^2\\cdot \\varphi(i)\n\\end{align*}\n```\n\u82e5\u80fd\u6c42\u51fa $f(i)=i^2\\cdot \\varphi(i)$ \u7684\u503c\uff0c\u5373\u53ef\u5229\u7528\u4e0b\u5e95\u51fd\u6570\u7684\u5206\u5757\u505a\u5230 $O(\\sqrt{n} + T(QueryF))$\n\n\u8bbe $S(i)=\\sum_{j=1}^if(j)$\uff0c\u5219\n\n\n\n```cpp\n\\begin{align*}\n&\\sum_{i=1}^n(f*id^2)(i) \\\\\n=&\\sum_{i=1}^ni^3\\\\\n=&\\sum_{j=1}^nj^2\\cdot S(\\lfloor\\frac{n}{j}\\rfloor)\n\\end{align*}\n```\n\u4e8e\u662f $$S(n)=\\sum_{i=1}^ni^3-\\sum_{i=2}^ni^2\\cdot S(\\lfloor \\frac{n}{i}\\rfloor)$$\n\n\u5229\u7528\u7ebf\u6027\u7b5b\u9884\u5904\u7406\u524d $O(n^{\\frac{2}{3}})$ \u7684\u90e8\u5206\uff0c\u7136\u540e\u6c42\u524d\u7f00\u548c\u7684\u590d\u6742\u5ea6\u5c31\u53ea\u6709 $O(n^{\\frac{2}{3}})$ \u4e86\u3002\n\n\n\u6ce8\u610f $n$ \u6bd4\u8f83\u5927\uff0c\u8981\u7528\u5230 $O(1)$ \u7684\u5feb\u901f\u4e58\u3002\n",
        "postTime": 1494339858,
        "uid": 30363,
        "name": "pengyihao",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3768 \u3010\u7b80\u5355\u7684\u6570\u5b66\u9898\u3011"
    },
    {
        "content": "\u9898\u76ee:[link](https://www.luogu.org/problem/P3768)\n\n-------------------\n\n\u539f\u5f0f\n$$\\sum_{i=1}^{n}\\sum_{j=1}^n{ijgcd(i,j)}$$\n\u679a\u4e3e $gcd$ \u5f97\u5230\n$$\\sum_{d=1}^n\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}ijd^3[gcd(i,j)=1]$$\n\u628a $d^3$ \u63d0\u5230\u524d\u9762\n$$\\sum_{d=1}^nd^3\\sum_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}ij[gcd(i,j)=1]$$\n\u8bbe\u51fd\u6570\n$$f(n)=\\sum_{i=1}^{n}\\sum_{j=1}^nij[gcd(i,j)=1]$$\n$$s(n)=\\sum_{i=1}^{n}\\sum_{j=1}^nij$$\n\u5219\u539f\u5f0f\u7b49\u4e8e\n$$\\sum_{d=1}^nd^3f(\\lfloor\\frac{n}{d}\\rfloor)$$\n\u53ef\u4ee5\u770b\u51fa\u662f\u6570\u8bba\u5206\u5757\uff0c\u5176\u4e2d\u7acb\u65b9\u90e8\u5206\u548c\u4e3a\n$$\\sum_{i=1}^{n}i^3=(\\sum_{i=1}^ni)^2=[\\frac{n(n+1)}{2}]^2$$\n\u6c42\u51fa\u524d\u7f00\u505a\u5dee\u5373\u53ef\n\n--------------\n\u8003\u8651\u5feb\u901f\u6c42 $f(n)$\uff0c\u975e\u5e38\u663e\u7136\n$$s(n)=\\sum_{i=1}^{n}\\sum_{j=1}^nij=[\\frac{n(n+1)}{2}]^2$$\n\u800c\u5bf9\u4e8e $s(n)$ \u540c\u6837\u679a\u4e3e $gcd$ \u53ef\u5f97\n$$s(n)=\\sum_{i=1}^{n}\\sum_{j=1}^nij=\\sum_{t=1}^{n}\\sum_{i=1}^{\\lfloor\\frac{n}{t}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{n}{t}\\rfloor}t^2ij[gcd(i,j)=1]$$\n\u7528 $f(n)$ \u66ff\u6362\u4e0a\u5f0f\u5f97\n$$s(n)=\\sum_{t=1}^{n}t^2f(\\lfloor\\frac{n}{t}\\rfloor)=f(n)+\\sum_{t>1}t^2f(\\lfloor\\frac{n}{t}\\rfloor)$$\n\u6240\u4ee5\u6709\n$$f(n)=s(n)-\\sum_{t>1}t^2f(\\lfloor\\frac{n}{t}\\rfloor)=[\\frac{n(n+1)}{2}]^2-\\sum_{t>1}t^2f(\\lfloor\\frac{n}{t}\\rfloor)$$\n\u5230\u4e86\u6b64\u523b\u5df2\u7ecf\u975e\u5e38\u5bb9\u6613\u6c42\u4e86\uff0c\u6570\u8bba\u5206\u5757\u5373\u53ef\uff0c\u5176\u4e2d\n$$\\sum_{i=1}^{n}i^2=\\frac{n(n+1)(2n+1)}{6}$$\n\u505a\u6cd5\u540c\u7acb\u65b9\u548c\uff0c\u524d\u7f00\u505a\u5dee\n\n--------------\n\u8003\u8651\u9884\u5904\u7406 $f(n)$ \u90e8\u5206\n$$f(n)=\\sum_{i=1}^{n}\\sum_{j=1}^nij[gcd(i,j)=1]=f(n-1)+2\\sum_{i=1}^{n}in[gcd(i,n)=1]$$\n\n\u90a3\u4e48\u9700\u8981\u5feb\u901f\u6c42\u5f97\n$$\\sum_{i=1}^ni[gcd(i,n)=1]$$\n\u53d1\u73b0\u8fd9\u5c31\u662f\u4e0e $n$ \u4e92\u8d28\u7684\u6570\u7684\u548c\uff0c\u5c31\u7b49\u4e8e\n$$n\\frac{\\varphi(n)}{2}$$\n\u8be6\u7ec6\u8bc1\u660e\u53c2\u8003[\u94fe\u63a5](https://blog.csdn.net/SM_545/article/details/81157057)\n\n\u5e26\u56de\u539f\u5f0f\u5f97\u5230\n$$f(n)=f(n-1)+n^2\\varphi(n)$$\n\u7ebf\u6027\u7b5b\u9884\u5904\u7406\u5373\u53ef\n\n-------------\n\nCode\uff1a\n```cpp\n#pragma GCC optimize(2)\n#include<stdio.h>\n#include<string.h>\n#include<cassert>\n#define Mod p\n#define LL long long\n#define N 5000000\n\ntemplate<class T>\ninline void read(T &x){\n\tx=0;char c=getchar();T flag=1;\n\twhile(c<'0'||c>'9'){if(c=='-')flag=-1;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<1)+(x<<3)+c-48;c=getchar();}\n\tx*=flag;\n}\n\nLL n,p,inv,inv6;\nint cnt,P[N];\nbool mark[N];\nLL phi[N],f[N],F[N];\n\ninline LL qpow(LL a,LL b){\n\tif(!b) return 1LL;\n\tif(b==1LL) return a;\n\tLL t=qpow(a,b>>1LL);\n\tt=t*t%Mod;\n\tif(b&1LL) t=t*a%Mod;\n\tassert(t>=0);\n\treturn t;\n}\ninline LL pow2(LL x){//\u5e73\u65b9\u524d\u7f00\u548c\n\treturn ((inv6*x)%Mod)*(((x+1LL)%Mod)*((2LL*x+1LL)%Mod)%Mod)%Mod;\n}\ninline LL pow2(LL l,LL r){\u5e73\u65b9\u533a\u95f4\u548c\n\treturn ((pow2(r)-pow2(l-1LL))%Mod+Mod)%Mod;\n}\ninline LL pow3(LL x){\u7acb\u65b9\u524d\u7f00\u548c\n\treturn qpow(((x%Mod)*(x+1LL)%Mod)*inv%Mod,2LL);\n}\ninline LL pow3(LL l,LL r){\u7acb\u65b9\u533a\u95f4\u548c\n\treturn ((pow3(r)-pow3(l-1LL))%Mod+Mod)%Mod;\n}\ninline void Prework(int x){//\u7ebf\u6027\u7b5b\u9884\u5904\u7406 f(n)\n\tcnt=0;\n\tf[1]=phi[1]=1;\n\tfor(int i=2;i<=x;++i){\n\t\tif(!mark[i]){\n\t\t\tP[cnt++]=i;\n\t\t\tphi[i]=i-1;\n\t\t}\n\t\tfor(int j=0;j<cnt&&i*P[j]<=x;++j){\n\t\t\tmark[i*P[j]]=1;\n\t\t\tif(!(i%P[j])){\n\t\t\t\tphi[i*P[j]]=phi[i]*P[j];\n\t\t\t\tbreak;\n\t\t\t}else phi[i*P[j]]=phi[i]*(P[j]-1);\n\t\t}\n\t\tLL ret=qpow(i,2LL)*phi[i]%Mod;\n\t\tf[i]=(f[i-1]+ret)%Mod;\n\t}\n}\ninline LL solve(LL x){//\u675c\u6559\u7b5b\n\tif(x<=N-3) return f[x];\n\tif(~F[n/x]) return F[n/x];\n\tF[n/x]=qpow(((x%Mod)*((x+1)%Mod)%Mod)*inv%Mod,2);\n\tfor(LL l=2,r;l<=x;l=r+1){\n\t\tr=x/(x/l);\n\t\tF[n/x]=((F[n/x]-(pow2(l,r)*solve(x/l)%Mod))%Mod+Mod)%Mod;\n\t}\n\treturn F[n/x];\n}\nint main(){\n\tmemset(F,-1,sizeof(F));\n\tread(p),read(n);\n\tinv=qpow(2LL,p-2);//2\u7684\u9006\u5143\n\tinv6=qpow(6LL,p-2);//6\u7684\u9006\u5143\n\tPrework(N-3);\n\tLL ans=0;\n\tfor(LL l=1,r;l<=n;l=r+1){//\u539f\u5f0f\n\t\tr=n/(n/l);\n\t\tans=(ans+(pow3(l,r)*solve(n/l))%Mod)%Mod;\n\t}\n\tprintf(\"%lld\",ans);\n}\n/*\n998244353 2\n*/\n```",
        "postTime": 1570189267,
        "uid": 83337,
        "name": "wwlw",
        "ccfLevel": 7,
        "title": "\u7b80\u5355\u7684\u6570\u5b66\u9898"
    }
]