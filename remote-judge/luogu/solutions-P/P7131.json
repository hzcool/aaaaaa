[
    {
        "content": "\u9996\u5148\uff0c\u6211\u4eec\u8003\u8651\u8fde\u7eed\u51e0\u6b21\u53d8\u6362\u540e\u5f0f\u5b50\u4f1a\u53d8\u6210\u4ec0\u4e48\u3002\n\n$$f_1(x)=\\lfloor\\frac x{p_1}\\rfloor+q_1=\\lfloor\\frac {x+p_1q_1}{p_1}\\rfloor$$\n\n$$f_2(f_1(x))=\\lfloor\\frac {\\lfloor\\frac {x+p_1q_1}{p_1}\\rfloor+p_2q_2}{p_2}\\rfloor=\\lfloor\\frac {x+p_1q_1+p_1p_2q_2}{p_1p_2}\\rfloor$$\n\n\u663e\u7136\uff0c\u8fde\u7eed\u4efb\u610f\u6b21\u7684\u53d8\u6362\u90fd\u53ef\u4ee5\u8868\u793a\u4e3a $\\lfloor\\frac{x+c}a\\rfloor$ \u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u8981\u5feb\u901f\u7ef4\u62a4 $a$ \u548c $c$ \u5373\u53ef\u3002  \n\n\u4f46\u662f\uff0c\u8fd9\u91cc\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5373\u8fd9\u91cc\u7684 $a$ \u548c $c$ \u53ef\u80fd\u8fbe\u5230 $1000^{100000}$\uff0c\u8ba1\u7b97\u4f1a\u5f7b\u5e95\u70b8\u6389\u3002\n\n\u6211\u4eec\u91cd\u65b0\u8bbe\u82e5\u5e72\u6b21\u53d8\u6362\u4e3a $\\lfloor\\frac{x+c}a\\rfloor+b\\ (c\\lt a)$\uff0c\u6613\u77e5 $b$ \u4e00\u5b9a\u5728\u53ef\u8fd0\u7b97\u8303\u56f4\u5185\uff0c\u6570\u91cf\u7ea7\u5927\u7ea6\u662f $10^3$\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u53ea\u9700\u8981\u8ba9 $a$ \u548c $c$ \u4e0d\u8981\u592a\u5927\u5c31\u597d\u3002 \n\n1. $c\\lt a\\lt 10^6$  \n\t\u4fdd\u6301\u539f\u6837\u4e0d\u7ba1\u3002\n    \n2. $a\\gt 10^6$  \n\t\u7531\u4e8e $x\\lt 10^6\\lt a$\uff0c\u6240\u4ee5\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u5373\u5f53 $x\\lt a-c$ \u65f6\uff0c$\\lfloor\\frac{x+c}a\\rfloor=0$\uff1b\u5f53 $x\\ge a-c$ \u65f6\uff0c$\\lfloor\\frac{x+c}a\\rfloor=1$\u3002  \n    \u6211\u4eec\u53ea\u8981\u4ee4 $a'=10^6+1,c'=\\max(0,a'-(a-c))$ \u5c31\u597d\u3002\n    \n\u603b\u7ed3\u4e00\u4e0b\uff0c\u6211\u4eec\u73b0\u5728\u6bcf\u6b21\u5408\u5e76\u4e24\u79cd\u53d8\u6362\u6709\u4e24\u4ef6\u4e8b\uff1a  \n\n1. $\\lfloor\\frac{\\lfloor\\frac{x+c_1}{a_1}\\rfloor+b_1+c_2}{a_2}\\rfloor+b_2=\\lfloor\\frac{x+c_1+a_1(b_1+c_2)}{a_1a_2}\\rfloor+b_2$\uff0c\u6240\u4ee5\u4ee4 $a=a_1a_2,b=b_2,c=c_1+a_1(b_1+c_2)$\uff0c\u7136\u540e\u8c03\u6574\u4f7f $c<a$\u3002\n\n2. \u82e5 $a\\gt 10^6$\uff0c\u5219\u4ee4 $a'=10^6+1,c'=\\max(0,a'-(a-c))$\n\n\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5c31\u597d\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathbf O((n+m)\\log n)$\uff0c\u4e0d\u77e5\u9053\u51fa\u9898\u4eba\u4e3a\u4ec0\u4e48\u53ea\u5f00\u4e86 $10^5$\u3002\n\n\u4ee3\u7801   \n```cpp\n#include<cstdio>\nconst int N=1e5+10;\nint n,p[N],q[N];\ninline long long max(long long a,long long b){return a>b?a:b;}\nstruct node\n{\n\tlong long a,b,c;\n\tnode(long long a=0,long long b=0,long long c=0):a(a),b(b),c(c){}\n\tinline node operator+ (const node &x) const\n\t{\n\t\tlong long ra=a*x.a,rb=x.b,rc=c+a*(b+x.c);rb+=rc/ra;rc%=ra;\n\t\tif(ra>1e6)rc=max(0,(int)1e6+1-ra+rc),ra=1e6+1;\n\t\treturn node(ra,rb,rc);\n\t}\n\tinline long long query(int x)\n\t{\n\t\treturn (x+c)/a+b;\n\t}\n}t[N<<2];\nvoid build(int rt,int l,int r)\n{\n\tif(l==r)return (void)(t[rt]=node(p[l],q[l],0));\n\tint m=(l+r)>>1;\n\tbuild(rt<<1,l,m);build(rt<<1|1,m+1,r);\n\tt[rt]=t[rt<<1]+t[rt<<1|1];\n}\nvoid update(int rt,int l,int r,int x)\n{\n\tif(l==r)return (void)(t[rt]=node(p[l],q[l],0));\n\tint m=(l+r)>>1;\n\tx<=m?update(rt<<1,l,m,x):update(rt<<1|1,m+1,r,x);\n\tt[rt]=t[rt<<1]+t[rt<<1|1];\n}\nnode query(int rt,int l,int r,int ql,int qr)\n{\n\tif(ql==l&&r==qr)return t[rt];\n\tint m=(l+r)>>1;\n\tif(qr<=m)return query(rt<<1,l,m,ql,qr);\n\telse if(ql>m)return query(rt<<1|1,m+1,r,ql,qr);\n\telse return query(rt<<1,l,m,ql,m)+query(rt<<1|1,m+1,r,m+1,qr);\n}\nint main()\n{\n\tint i,m,x,y;char op[5];\n\tscanf(\"%d%d\",&n,&m);\n\tfor(i=1;i<=n;i++)scanf(\"%d\",&p[i]);\n\tfor(i=1;i<=n;i++)scanf(\"%d\",&q[i]);\n\tbuild(1,1,n);\n\twhile(m--)\n\t{\n\t\tscanf(\"%s%d%d%d\",op,&i,&x,&y);\n\t\tif(op[0]=='m')p[i]=x,q[i]=y,update(1,1,n,i);\n\t\telse printf(\"%lld\\n\",query(1,1,n,x,y).query(i));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1621585919,
        "uid": 35137,
        "name": "a___",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P7131 \u300cRdOI R1\u300d\u53d8\u6362(turn)"
    }
]