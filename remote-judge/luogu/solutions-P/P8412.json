[
    {
        "content": "Official Editorial.\n\n## \u9898\u610f\n\n\u5b9a\u4e49\u51fd\u6570 $f_k(x)$\uff0c\u7ed9\u5b9a $k,p$\uff0c\u6784\u9020 $l,r$ \u4f7f\u5f97\n\n$$\n\\sum\\limits_{i=l}^rf_k(i^i)=p\n$$\n\n## \u89e3\u6cd5\n\n### Subtask 1\n\n\u76f4\u63a5\u8f93\u51fa $\\texttt{-1}$ \u5373\u53ef\u3002\n\n### Subtask 2\n\n\u76f4\u63a5\u66b4\u529b\u679a\u4e3e\u5e76\u7528 map \u7ef4\u62a4\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(T N \\log N)$\u3002\n\n### Subtask 3\n\n\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053 $f$ \u51fd\u6570\u6ee1\u8db3 $f(A) = (A - 1) \\bmod (k - 1) + 1$\u3002\n\n\u8bc1\u660e\uff1a\u4ee4 $A$ \u5728 $k$ \u8fdb\u5236\u4e0b\u5404\u4f4d\u5206\u522b\u4e3a $a_0, a_1, \\cdots, a_m$\uff0c$f'(x) = \\displaystyle\\sum_{i = 0}^m a_i$\uff0c\u5219 $f'(A)$ \u8868\u793a $A$ \u5728 $k$ \u8fdb\u5236\u4e0b\u6bcf\u4e00\u4f4d\u7684\u548c\uff0c\u4e14 $d(A)$ \u5373\u4e3a\u4e0d\u65ad\u5730\u4ee4 $A \\leftarrow f'(A)$ \u76f4\u5230 $A < k$\u3002\n\n\u56e0\u4e3a $k^i \\equiv 1 \\pmod{k - 1}$\uff0c\u6240\u4ee5 $A = \\displaystyle\\sum_{i = 0}^m k^i a_i \\equiv f'(A) \\pmod{k - 1}$\u3002\u8bc1\u6bd5\u3002\n\n\u6ce8\u610f\u5230 $f(A)$ \u5728\u8fd9\u91cc\u4e0d\u80fd\u4e3a $0$\uff0c\u4e8e\u662f\u5f53 $k - 1 \\mid A$\uff0c\u4ee4 $f(A) = k$ \u5373\u53ef\u3002\n\n\u63a5\u4e0b\u6765\u6839\u636e\u6784\u9020\u51fa\u7684 $l, r$ \u5206\u7c7b\u8ba8\u8bba\u3002\n\n1. $1\\le l\\le r\\le\\varphi(k-1)$\\\n\u76f4\u63a5\u66b4\u529b\u5904\u7406 $f(i^i)$ \u7684\u524d\u7f00\u548c\u5e76\u5c06\u5176\u5b58\u5165 map\uff0c\u679a\u4e3e\u8ba1\u7b97\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(k \\log k)$\u3002\n2. $1\\le l\\le\\varphi(k-1)<r$\\\n\u5c06\u5176\u5206\u4e3a\u4e24\u90e8\u5206\u5904\u7406\u3002\n   - $l\\le i\\le\\varphi(k-1)$\uff1a\u540c\u4e0a\u3002\n   - $\\varphi(k-1)<r$\uff1a\u8003\u8651\u6269\u5c55\u6b27\u62c9\u5b9a\u7406\uff0c\u53d1\u73b0\u6b64\u65f6 $f(i^i)$ \u5b58\u5728\u5faa\u73af\u8282\uff0c\u5faa\u73af\u8282\u8d77\u70b9\u4e3a $\\varphi(k-1) + 1$\uff0c\u5faa\u73af\u8282\u957f\u5ea6\u4e3a $\\operatorname{lcm}(k-1,\\varphi(k-1))$\u3002\u8003\u8651\u9884\u5904\u7406\u51fa**\u6574\u4e2a\u5faa\u73af\u8282\u4e2d\u524d\u7f00\u548c $\\leq p$ \u7684\u90e8\u5206**\u5e76\u679a\u4e3e\u5faa\u73af\u6b21\u6570\u4ee5\u53ca\u5728 map \u4e2d\u67e5\u8be2\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\log k(k^2 + \\frac{p}{k}))$\u3002\n3. $\\varphi(k-1)<l\\le r$\\\n\u8003\u8651\u94a6\u5b9a $l$ \u4f4d\u4e8e\u7b2c\u4e00\u4e2a\u5faa\u73af\u8282\u4e2d\uff08\u53cd\u6b63\u90fd\u8981\u5faa\u73af\uff09\u3002\\\n\u63a5\u4e0b\u6765\u5148\u7279\u5224 $l,r$ \u5747\u4f4d\u4e8e\u7b2c\u4e00\u4e2a\u5faa\u73af\u8282\u7684\u60c5\u51b5\uff0c\u7136\u540e\u518d\u679a\u4e3e $r$ \u4f4d\u4e8e\u7b2c\u51e0\u4e2a\u5faa\u73af\u8282\u3002\u8bbe\u4e00\u4e2a\u5faa\u73af\u8282\u5185 $f(i^i)$ \u7684\u548c\u4e3a $sum$\uff0c\u8003\u8651\u5230 $l \\sim r$ \u4e4b\u95f4\uff08\u4e0d\u5305\u62ec $l,r$ \u6240\u5728\u5faa\u73af\u8282\uff09\u7684\u5faa\u73af\u8282\u6570 $cnt$ \u4e00\u5b9a\u6ee1\u8db3 $cnt\\cdot sum\\le p\\le sum\\cdot(cnt+2)$\uff0c\u76f4\u63a5\u679a\u4e3e\u81f3\u591a\u4e09\u4e2a\u5faa\u73af\u8282\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(k^2 \\log k)$\u3002\n\n\u7efc\u4e0a\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(T \\log k(k^2 + \\frac pk))$\u3002\n\n### Subtask 4\n\n\u52a0\u4e0a\u54c8\u5e0c\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(T(k^2 \\log k + \\frac pk))$\u3002\n\n## \u4ee3\u7801\n\n\u5411 CSP_Sept \u6216\u6d1b\u8c37\u6c2a\u91d1\u5373\u53ef\u83b7\u5f97\u3002",
        "postTime": 1655880815,
        "uid": 224931,
        "name": "CSP_Sept",
        "ccfLevel": 6,
        "title": "The Solution of P8412"
    },
    {
        "content": "\u9996\u5148\uff0c\n $$ f(i)=\\left\\{\n\\begin{aligned}\ni \\bmod {K-1},((K-1) \\nmid i) \\\\\n{K-1},({(K-1)}\\mid i) \\\\\n\\end{aligned}\n\\right.\n$$\n \u7136\u540e\u8003\u8651 $i^i \\bmod {K-1}$ \u7684\u5468\u671f\u3002\n \n \u524d $\\varphi_{K-1}$ \u4e2a $i$ \u6ca1\u6709\u5468\u671f\uff0c\u7136\u540e\u540e\u9762\u6709\u957f\u5ea6\u4e3a $\\text{lcm}(K-1,\\varphi_{K-1})$ \u7684\u5468\u671f\u3002\n \n \u4e8e\u662f\u629b\u5f03\u524d $\\varphi_{K-1}$ \u4e2a\uff0c\u7b97\u51fa\u4e00\u4e2a\u5468\u671f\u7684\u548c\u3002\n \n \u628a\u4e00\u79cd\u65b9\u6848\u7684\u5b8c\u6574\u8fde\u7eed\u5468\u671f\u53bb\u9664\uff0c\u5269\u4e0b\u7684\u62fc\u5728\u4e00\u8d77\uff0c\u4e00\u5b9a\u662f\u4e00\u4e2a\u5468\u671f\u590d\u5236\u4e24\u904d\u7684\u4e00\u4e2a\u8fde\u7eed\u5b50\u5e8f\u5217\u3002\n \n\u904d\u5386\u4e00\u4e2a\u5468\u671f\u590d\u5236\u4e24\u904d\uff0c\u5f00\u4e00\u4e2a $\\text{umap}$ \u8bb0\u5f55\u6bcf\u4e00\u4e2a\u524d\u7f00\u548c\u7684\u51fa\u73b0\u4f4d\u7f6e\u5373\u53ef\u3002\n\n\u53ef\u80fd\u9700\u8981\u5361\u5361\u5e38\u6570\u3002",
        "postTime": 1655947607,
        "uid": 366807,
        "name": "lgvc",
        "ccfLevel": 5,
        "title": "P8412 \u9898\u89e3"
    },
    {
        "content": "### Subtask $1$\n\u76f4\u63a5\u8f93\u51fa $-1$ \u5373\u53ef\u3002\n### Subtask $2$\n\u76f4\u63a5\u66b4\u529b\u679a\u4e3e\u5e76\u7528 map \u7ef4\u62a4\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(TN \\log N)$\u3002\n### Subtask $3$\n\u524d\u7f6e\u829d\u58eb\uff1a[\u6269\u5c55\u6b27\u62c9\u5b9a\u7406\uff08exEuler\uff09](https://oi-wiki.org/math/number-theory/fermat/#_5)\n\n\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053 $f$ \u51fd\u6570\u6ee1\u8db3 $f(A) = (A - 1) \\bmod (k - 1) + 1$\u3002\n\n\u8bc1\u660e\uff1a\u4ee4 $A$ \u5728 $k$ \u8fdb\u5236\u4e0b\u5404\u4f4d\u5206\u522b\u4e3a $a_0, a_1, \\cdots, a_m$\uff0c$f'(x) = \\displaystyle\\sum_{i = 0}^m a_i$\uff0c\u5219 $f'(A)$ \u8868\u793a $A$ \u5728 $k$ \u8fdb\u5236\u4e0b\u6bcf\u4e00\u4f4d\u7684\u548c\uff0c\u4e14 $d(A)$ \u5373\u4e3a\u4e0d\u65ad\u5730\u4ee4 $A \\leftarrow f'(A)$ \u76f4\u5230 $A < k$\u3002\n\n\u56e0\u4e3a $k^i \\equiv 1 \\pmod{k - 1}$\uff0c\u6240\u4ee5 $A = \\displaystyle\\sum_{i = 0}^m k^i a_i \\equiv f'(A) \\pmod{k - 1}$\u3002\u8bc1\u6bd5\u3002\n\n\u6ce8\u610f\u5230 $f(A)$ \u5728\u8fd9\u91cc\u4e0d\u80fd\u4e3a $0$\uff0c\u4e8e\u662f\u5f53 $k - 1 \\mid A$\uff0c\u4ee4 $f(A) = k$ \u5373\u53ef\u3002\n\n\u63a5\u4e0b\u6765\u6839\u636e\u6784\u9020\u51fa\u7684 $l, r$ \u5206\u7c7b\u8ba8\u8bba\u3002\n\n1. $1 \\leq l \\leq r \\leq \\varphi(k - 1)$\n\n\u76f4\u63a5\u66b4\u529b\u5904\u7406 $f(i^i)$ \u7684\u524d\u7f00\u548c\u5e76\u5c06\u5176\u5b58\u5165 map\uff0c\u679a\u4e3e\u8ba1\u7b97\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(k \\log k)$\u3002\n\n2. $1 \\leq l \\leq \\varphi(k - 1) < r$\n\n\u5c06\u5176\u5206\u4e3a\u4e24\u90e8\u5206\u5904\u7406\u3002\n\n- $l \\leq i \\leq \\varphi(k - 1)$\n\n\u540c\u4e0a\u3002\n\n- $\\varphi(k - 1) < r$\n\n\u8003\u8651\u6269\u5c55\u6b27\u62c9\u5b9a\u7406\uff0c\u53d1\u73b0\u6b64\u65f6 $f(i^i)$ \u5b58\u5728\u5faa\u73af\u8282\uff0c\u5faa\u73af\u8282\u8d77\u70b9\u4e3a $\\varphi(k - 1) + 1$\uff0c\u5faa\u73af\u8282\u957f\u5ea6\u4e3a $\\operatorname{lcm}(k - 1, \\varphi(k - 1))$\u3002\n\n\u8003\u8651\u9884\u5904\u7406\u51fa**\u6574\u4e2a\u5faa\u73af\u8282\u4e2d\u524d\u7f00\u548c $\\leq p$ \u7684\u90e8\u5206**\u5e76\u679a\u4e3e\u5faa\u73af\u6b21\u6570\u4ee5\u53ca\u5728 map \u4e2d\u67e5\u8be2\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\log k(k^2 + \\frac{p}{k}))$\u3002\n\n3. $\\varphi(k - 1) < l \\leq r$\n\n\u8003\u8651\u94a6\u5b9a $l$ \u4f4d\u4e8e\u7b2c\u4e00\u4e2a\u5faa\u73af\u8282\u4e2d\uff08\u53cd\u6b63\u90fd\u8981\u5faa\u73af\uff09\u3002\n\n\u63a5\u4e0b\u6765\u5148\u7279\u5224 $l, r$ \u5747\u4f4d\u4e8e\u7b2c\u4e00\u4e2a\u5faa\u73af\u8282\u7684\u60c5\u51b5\uff0c\u7136\u540e\u518d\u679a\u4e3e $r$ \u4f4d\u4e8e\u7b2c\u51e0\u4e2a\u5faa\u73af\u8282\u3002\u8bbe\u4e00\u4e2a\u5faa\u73af\u8282\u5185 $f(i^i)$ \u7684\u548c\u4e3a $sum$\uff0c\u8003\u8651\u5230 $l \\sim r$ \u4e4b\u95f4\uff08\u4e0d\u5305\u62ec $l, r$ \u6240\u5728\u5faa\u73af\u8282\uff09\u7684\u5faa\u73af\u8282\u6570 $cnt$ \u4e00\u5b9a\u6ee1\u8db3 $cnt \\times sum \\leq p \\leq sum \\times (cnt + 2)$\uff0c\u76f4\u63a5\u679a\u4e3e\u81f3\u591a\u4e09\u4e2a\u5faa\u73af\u8282\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(k^2 \\log k)$\u3002\n\n\u7efc\u4e0a\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(T \\log k(k^2 + \\frac{p}{k}))$\u3002\n### Subtask $4$\n\u524d\u7f6e\u829d\u58eb\uff1a[\u54c8\u5e0c\uff08Hash\uff09](https://oi-wiki.org/ds/hash/)\n\n\u5176\u5b9e\u672c\u6765\u662f\u6ca1\u6709\u8fd9\u4e2a Subtask \u7684\u3002\u52a0\u4e0a\u54c8\u5e0c\u662f\u56e0\u4e3a Subtask $2$ \u7684\u505a\u6cd5\u53ef\u4ee5\u5728\u9884\u5904\u7406\u5faa\u73af\u4f46\u4e0d\u8fdb\u884c\u4e0a\u8ff0\u8ba8\u8bba\u7684\u60c5\u51b5\u4e0b\u51b2\u8fc7 Subtask $3$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(T(k^2 \\log k + \\frac{p}{k}))$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <stdio.h>\n\ntypedef long long ll;\n\nconst int N = 993012 + 7, mod = 1e6 + 7;\n\ntypedef struct {\n\tint cnt = 0;\n\tint head[mod];\n\tint nxt[N];\n\tint val[N];\n\tll key[N];\n\t\n\tinline void clear(){\n\t\tfor (register int i = 0; i < mod; i++){\n\t\t\thead[i] = 0;\n\t\t}\n\t\tfor (register int i = 1; i <= cnt; i++){\n\t\t\tnxt[i] = val[i] = key[i] = 0;\n\t\t}\n\t\tcnt = 0;\n\t}\n\t\n\tinline int find(ll cur_key){\n\t\tll pos = cur_key % mod;\n\t\tif (head[pos] == 0){\n\t\t\tcnt++;\n\t\t\thead[pos] = cnt;\n\t\t\tkey[cnt] = cur_key;\n\t\t\treturn cnt;\n\t\t}\n\t\tint pre = 0, cur = head[pos];\n\t\twhile (cur != 0 && key[cur] != cur_key){\n\t\t\tpre = cur;\n\t\t\tcur = nxt[cur];\n\t\t}\n\t\tif (cur == 0){\n\t\t\tnxt[pre] = cur = ++cnt;\n\t\t\tkey[cur] = cur_key;\n\t\t}\n\t\treturn cur;\n\t}\n\t\n\tinline void assign(ll cur_key, int k){\n\t\tval[find(cur_key)] = k;\n\t}\n\t\n\tinline bool count(ll cur_key){\n\t\tfor (register int i = head[cur_key % mod]; i != 0; i = nxt[i]){\n\t\t\tif (key[i] == cur_key) return true;\n\t\t}\n\t\treturn false;\n\t}\n\t\n\tinline int query(ll cur_key){\n\t\tfor (register int i = head[cur_key % mod]; i != 0; i = nxt[i]){\n\t\t\tif (key[i] == cur_key) return val[i];\n\t\t}\n\t\treturn 0;\n\t}\n} Hash;\n\nconst int M = 1e3 + 7;\nHash mp1, mp2;\nint prime[M], phi[M];\nll sum1[M], sum2[N];\nbool p[M];\n\ninline void init(){\n\tint cnt = 0;\n\tp[0] = p[1] = true;\n\tphi[1] = 1;\n\tfor (register int i = 2; i < M; i++){\n\t\tif (!p[i]){\n\t\t\tprime[++cnt] = i;\n\t\t\tphi[i] = i - 1;\n\t\t}\n\t\tfor (register int j = 1; j <= cnt && i * prime[j] < M; j++){\n\t\t\tint t = i * prime[j];\n\t\t\tp[t] = true;\n\t\t\tif (i % prime[j] == 0){\n\t\t\t\tphi[t] = phi[i] * prime[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[t] = phi[i] * (prime[j] - 1);\n\t\t}\n\t}\n}\n\ninline ll quick_pow(ll x, ll p, ll mod){\n\tll ans = 1;\n\twhile (p){\n\t\tif (p & 1) ans = ans * x % mod;\n\t\tx = x * x % mod;\n\t\tp >>= 1;\n\t}\n\treturn ans;\n}\n\nint gcd(int a, int b){\n\treturn b == 0 ? a : gcd(b, a % b);\n}\n\ninline int lcm(int a, int b){\n\treturn a * b / gcd(a, b);\n}\n\ninline ll max(ll a, ll b){\n\treturn a > b ? a : b;\n}\n\nint main(){\n\tint t;\n\tscanf(\"%d\", &t);\n\tinit();\n\tfor (register int i = 1; i <= t; i++){\n\t\tint k, p, kd, n, ansl = -1, ansr = -1;\n\t\tscanf(\"%d %d\", &k, &p);\n\t\tkd = k - 1;\n\t\tn = phi[kd];\n\t\tmp1.clear();\n\t\tmp1.assign(0, 0);\n\t\tfor (register int j = 1; j <= n; j++){\n\t\t\tsum1[j] = sum1[j - 1] + ((quick_pow(j, j, kd) - 1) % kd + kd) % kd + 1;\n\t\t\tif (sum1[j] >= p && mp1.count(sum1[j] - p)){\n\t\t\t\tansl = mp1.query(sum1[j] - p) + 1;\n\t\t\t\tansr = j;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmp1.assign(sum1[j], j);\n\t\t}\n\t\tif (ansl == -1 && ansr == -1){\n\t\t\tint m = lcm(kd, n);\n\t\t\tmp2.clear();\n\t\t\tmp2.assign(0, 0);\n\t\t\tfor (register int j = 1; j <= m; j++){\n\t\t\t\tsum2[j] = sum2[j - 1] + ((quick_pow(j + n, j % n + n, kd) - 1) % kd + kd) % kd + 1;\n\t\t\t\tif (sum2[j] >= p && mp2.count(sum2[j] - p)){\n\t\t\t\t\tansl = mp2.query(sum2[j] - p) + n + 1;\n\t\t\t\t\tansr = j + n;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tmp2.assign(sum2[j], j);\n\t\t\t}\n\t\t\tif (ansl == -1 && ansr == -1){\n\t\t\t\tfor (register int j = 0; j * sum2[m] <= p; j++){\n\t\t\t\t\tll t = j * sum2[m];\n\t\t\t\t\tfor (register int x = n; x >= 1 && t + (sum1[n] - sum1[x - 1]) <= p; x--){\n\t\t\t\t\t\tif (mp2.count(p - (j * sum2[m] + (sum1[n] - sum1[x - 1])))){\n\t\t\t\t\t\t\tansl = x;\n\t\t\t\t\t\t\tansr = n + j * m + mp2.query(p - (t + (sum1[n] - sum1[x - 1])));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (ansl != -1 && ansr != -1) break;\n\t\t\t\t}\n\t\t\t\tif (ansl == -1 && ansr == -1){\n\t\t\t\t\tfor (register int j = max((p - 1) / sum2[m] - 1, 0); j * sum2[m] <= p; j++){\n\t\t\t\t\t\tll t = j * sum2[m];\n\t\t\t\t\t\tfor (register int x = m; x >= 1 && t + (sum2[m] - sum2[x - 1]) <= p; x--){\n\t\t\t\t\t\t\tif (mp2.count(p - (t + (sum2[m] - sum2[x - 1])))){\n\t\t\t\t\t\t\t\tansl = n + x;\n\t\t\t\t\t\t\t\tansr = n + m * (j + 1) + mp2.query(p - (t + (sum2[m] - sum2[x - 1])));\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (ansl != -1 && ansr != -1) break;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tprintf(\"%d %d\\n\", ansl, ansr);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1655942225,
        "uid": 201007,
        "name": "Leasier",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P8412 \u3010\u300cSvR-1\u300dHack Function!\u3011"
    }
]