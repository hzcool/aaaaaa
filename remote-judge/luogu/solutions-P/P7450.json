[
    {
        "content": "$\\text{A Solution with Code}$\n\n[\u5de7\u514b\u529b](https://www.luogu.com.cn/problem/P7450)\n\n> \u7ed9\u5b9a $n\\times m$ \u7684\u7f51\u683c\u4ee5\u53ca\u4e24\u4e2a\u53c2\u6570 $a,c$\u3002\n>\n> \u8981\u6c42\u9009\u51fa\u4e00\u4e2a\u8fde\u901a\u5757\uff0c\u4e0d\u5305\u542b $c=-1$ \u7684\u7f51\u683c\uff0c\u4e14 $c$ \u7684\u79cd\u7c7b\u6570 $\\geq k$\u3002\n>\n> \u5728\u6b64\u524d\u63d0\u4e0b\u6700\u5c0f\u5316\u8fde\u901a\u5757\u5927\u5c0f\uff0c\u5e76\u5728\u6b64\u524d\u63d0\u4e0b\u6700\u5c0f\u5316 $a$ \u7684\u4e2d\u4f4d\u6570\u3002\n\n\u4e2d\u4f4d\u6570\u76f4\u63a5\u5957\u8def\u7684\u4e8c\u5206\u89e3\u51b3\uff0c\u4e0d\u662f\u672c\u9898\u7684\u91cd\u70b9\u3002\u770b\u5230 $k\\leq 5$ \u5f88\u96be\u4e0d\u60f3\u5230\u4e00\u4e9b\u504f\u4e71\u641e\u7684\u505a\u6cd5\u3002\n\n\u5f53 $n\\times m$ \u8f83\u5c0f\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5 $\\binom{n\\times m}{k}$ \u94a6\u5b9a\u5173\u952e\u70b9\uff0c\u8dd1\u6700\u5c0f\u65af\u5766\u7eb3\u6811\u7684\u6a21\u677f\u3002\n\n\u5bf9\u66f4\u5927\u7684\u60c5\u51b5\uff0c\u8003\u8651\u968f\u673a\u5316\uff0c\u5c06\u6240\u6709\u989c\u8272\u4efb\u610f\u6620\u5c04\u81f3 $[0,k)$ \u4e2d\u3002\n\n\u5f53\u6700\u4f18\u89e3\u5305\u542b\u7684 $k$ \u4e2a\u70b9\u88ab\u5206\u914d\u5230\u4e0d\u540c\u7684\u989c\u8272\u4e2d\u5373\u53ef\u6b63\u786e\uff0c\u4e00\u6b21\u6210\u529f\u7684\u6982\u7387\u5927\u6982\u662f $P=k!/k^k$\u3002\n\n\u7531\u4e8e $(1-P)^{200}$ \u65e9\u5df2 $<1\\%$\uff0c\u6545\u6b63\u786e\u6027\u4e5f\u57fa\u672c\u4e0a\u6ca1\u5565\u95ee\u9898\u3002\n\n\u5b9e\u73b0\u4e0a\uff0c\u8fd9\u91cc\u7684\u65af\u5766\u7eb3\u6811\u5c06\u6240\u6709\u540c\u8272\u8282\u70b9\u90fd\u8fd1\u4f3c\u7684\u7f29\u6210\u4e86\u4e00\u4e2a\u70b9\uff0c\u6545\u521d\u59cb\u5316\u7684\u65f6\u5019\u6709\u4e9b\u7279\u6b8a\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u5927\u6982\u662f $O(Tnm3^k\\log V)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\ntypedef long long LL;\n#define rep(i, s, t) for(int i = (s); i <= (t); i ++)\n#define per(i, s, t) for(int i = (s); i >= (t); i --)\n#define Ede(i, u) for(int i = head[u]; i; i = e[i].nxt)\nusing namespace std;\n\nconst int N = 300;\nconst int INF = 0x3f3f3f3f;\nint n, m, k, c[N][N], a[N][N], w[N][N], tt, col[N], to[N];\nint f[N][N][1 << 6]; bool vis[N][N];\nmt19937 myrand(20060814);\n\n#define MP make_pair\ntypedef pair<int, int> PII;\nqueue<PII> q;\nint dx[] = {1, -1, 0, 0};\nint dy[] = {0, 0, 1, -1};\n\nint read() {\n\tint x = 0, f = 1; char c = getchar();\n\twhile(c < '0' || c > '9') f = (c == '-') ? -1 : 1, c = getchar();\n\twhile(c >= '0' && c <= '9') x = x * 10 + c - 48, c = getchar();\n\treturn x * f;\n}\n\nvoid spfa(int s) {\n\twhile(! q.empty()) {\n\t\tPII now = q.front(); q.pop();\n\t\tint x = now.first, y = now.second;\n\t\tvis[x][y] = false;\n\t\trep(o, 0, 3) {\n\t\t\tint tx = x + dx[o], ty = y + dy[o];\n\t\t\tif(tx < 1 || tx > n || ty < 1 || ty > m || c[tx][ty] == - 1) continue;\n\t\t\tif(f[x][y][s] + w[tx][ty] < f[tx][ty][s]) {\n\t\t\t\tf[tx][ty][s] = f[x][y][s] + w[tx][ty];\n\t\t\t\tif(! vis[tx][ty]) q.push(MP(tx, ty)), vis[tx][ty] = true;\n\t\t\t}\n\t\t}\n\t}\n}\n\nint work() {\n\tint ans = INF;\n\trep(Q, 1, 233) {\n\t\tshuffle(col + 1, col + tt + 1, myrand);\n\t\trep(i, 1, tt) to[col[i]] = i % k;\n\t\trep(i, 1, n) rep(j, 1, m) {\n\t\t\trep(s, 0, (1 << k) - 1) f[i][j][s] = INF;\n\t\t\tif(~ c[i][j]) f[i][j][1 << to[c[i][j]]] = w[i][j];\n\t\t}\n\t\trep(s, 1, (1 << k) - 1) {\n\t\t\trep(i, 1, n) rep(j, 1, m) if(~ c[i][j]) {\n\t\t\t\tfor(int t = (s - 1) & s; t; t = (t - 1) & s)\n\t\t\t\t\tf[i][j][s] = min(f[i][j][s], f[i][j][t] + f[i][j][s ^ t] - w[i][j]);\n\t\t\t\tif(f[i][j][s] < 1e9) q.push(MP(i, j)), vis[i][j] = true;\n\t\t\t}\n\t\t\tspfa(s);\n\t\t}\n\t\trep(i, 1, n) rep(j, 1, m) ans = min(ans, f[i][j][(1 << k) - 1]);\n\t}\n\treturn ans;\n}\n\nint main() {\n\tint T = read();\n\twhile(T --) {\n\t\ttt = 0;\n\t\tn = read(), m = read(), k = read();\n\t\trep(i, 1, n) rep(j, 1, m) c[i][j] = col[++ tt] = read();\n\t\trep(i, 1, n) rep(j, 1, m) a[i][j] = read(), w[i][j] = 1;\n\t\tsort(col + 1, col + tt + 1);\n\t\ttt = unique(col + 1, col + tt + 1) - (col + 1);\n\n\t\tint rec = work();\n\t\tif(rec == INF) {puts(\"-1 -1\"); continue;}\n\t\tint l = 0, r = 1e6;\n\t\twhile(l < r) {\n\t\t\tint mid = (l + r) >> 1;\n\t\t\trep(i, 1, n) rep(j, 1, m) w[i][j] = ((a[i][j] <= mid) ? 9999 : 10001);\n\t\t\tint now = work();\n\t\t\tif(now <= rec * 10000) r = mid; else l = mid + 1;\n\t\t}\n\t\tprintf(\"%d %d\\n\", rec, l);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1643980020,
        "uid": 117941,
        "name": "_LPF_",
        "ccfLevel": 9,
        "title": "P7450 [THUSCH2017] \u5de7\u514b\u529b"
    },
    {
        "content": "\u9996\u5148\u770b\u5230\u8fd9\u4e2a $k\\le 5$ \u6211\u4eec\u5c31\u89c9\u5f97\u4e0d\u5bf9\u52b2\uff0c\u663e\u7136\u662f\u4e2a\u6307\u6570\u7ea7\u7684\u73a9\u610f\u3002\u6211\u4eec\u4e5f\u4e0d\u53ef\u80fd\u66b4\u679a\u9009\u54ea\u51e0\u79cd\u989c\u8272\uff0c\u8fd9\u4e2a\u4e2d\u4f4d\u6570\u7684\u9650\u5236\u4e5f\u76f8\u5f53\u79bb\u8c31\uff0c\u4e8e\u662f\u6211\u4eec\u5148\u8003\u8651\u53ea\u6709 $k$ \u79cd\u989c\u8272\u4e14\u4e0d\u7ba1\u7b2c\u4e8c\u6761\u9650\u5236\u7684\u60c5\u51b5\u3002\n\n\u8bbe $f_{i,j,S}$ \u4e3a $S$ \u4e3a\u4e0e $(i,j)$ \u8fde\u901a\u7684\u989c\u8272\u96c6\u5408\u7684\u5b50\u96c6\u65f6\u9700\u8981\u7684\u6700\u5c11\u683c\u6570\uff0c\u7279\u522b\u5730\uff0c\u8bb0 $f_{i,j,0}=0$\uff0c\u90a3\u4e48 $(i,j)$ \u663e\u7136\u53ef\u4ee5\u7531\u56db\u4e2a\u65b9\u5411\u8f6c\u79fb\u5f97\u5230\uff1a\n$$f_{i,j,S}=\\min_{S\\subseteq S_1\\cup S_2\\cup S_3\\cup S_4\\cup\\{c_{i,j}\\}}\\{f_{i-1,j,S_1}+f_{i,j-1,S_2}+f_{i+1,j,S_3}+f_{i,j+1,S_4}\\}+1$$\n\n\u663e\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u8981\u6c42 $S_1,S_2,S_3,S_4$ \u4e24\u4e24\u65e0\u4ea4\uff0c\u8fd9\u6837\u901a\u8fc7\u679a\u4e3e\u5b50\u96c6\u53ef\u4ee5\u505a\u5230\u5355\u6b21\u8f6c\u79fb $O(3^k)$\uff0c\u603b\u590d\u6742\u5ea6\u5c31\u662f $O(nm3^k)$\u3002\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u5c31\u662f\u4e0d\u8981\u8ba9 $S_i=S$\uff0c\u5426\u5219\u4f1a\u6709\u540e\u6548\u6027\u7684\u95ee\u9898\uff0c\u53ea\u9700\u8981\u6bcf\u6b21\u6574\u5b8c\u4ece\u5c0f\u5f80\u5927\u641c\u4e00\u904d\u5c31\u884c\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u52a0\u4e0a\u7b2c\u4e8c\u6761\u9650\u5236\u3002\u8fd9\u4e5f\u662f\u4e00\u4e2a\u6bd4\u8f83\u7ecf\u5178\u7684\u6a21\u578b\u3002\u9996\u5148\u663e\u7136\u9700\u8981\u4e8c\u5206\u7b54\u6848\uff0c\u628a\u5927\u4e8e\u4e8c\u5206\u503c\u7684\u70b9\u7684\u6743\u503c\u8bb0\u4e3a $1001$\uff0c\u5176\u4f59\u70b9\u6743\u503c\u8bb0\u4e3a $1000$\uff0c\u8fd9\u6837\uff0c\u6211\u4eec\u4ecd\u7136\u53ef\u4ee5\u6309\u4e4b\u524d\u7684\u8f6c\u79fb\u505a\u3002\u56e0\u4e3a\u53ea\u8981\u591a\u9009\u51fa\u4e00\u4e2a\u683c\u5b50\uff0c\u5c31\u4f1a\u628a\u7b2c\u4e8c\u7ef4\u66f4\u4f18\u7684\u90e8\u5206\u5168\u90e8\u8986\u76d6\uff0c\u6700\u540e\u53ea\u8981\u901a\u8fc7$\\mod 1000$ \u5224\u65ad\u662f\u5426\u8d85\u8fc7 $\\lfloor \\dfrac n2\\rfloor$ \u5373\u53ef\uff0c\u590d\u6742\u5ea6 $O(nm3^k\\log nm)$\u3002\n\n\u6700\u540e\u6211\u4eec\u628a\u989c\u8272\u6570\u9650\u5236\u653e\u5f00\uff0c\u8ba1\u7b97\u4e00\u4e0b\u4e0a\u9762\u7684\u8fd0\u7b97\u91cf\uff0c\u53d1\u73b0\u8fd8\u4e0d\u5230 $10^6$\uff0c\u751a\u81f3\u90fd\u8dd1\u4e0d\u6ee1\u3002\u8fd9\u5c31\u542f\u793a\u6211\u4eec\u4f7f\u7528\u968f\u673a\u5316\uff08\n\n\u6211\u4eec\u6bcf\u6b21\u628a\u989c\u8272\u968f\u673a\u5206\u6210 $k$ \u7ec4\uff0c\u628a\u6bcf\u7ec4\u770b\u6210\u4e00\u79cd\u989c\u8272\uff0c\u7136\u540e\u8fdb\u884c\u4e0a\u9762\u7684\u8fc7\u7a0b\uff0c\u53d6\u4e2a\u6700\u4f18\u89e3\u5c31\u884c\u4e86\u3002\n\n\u90a3\u4e48\u6211\u4eec\u9700\u8981\u968f\u591a\u5c11\u6b21\u5462\uff1f\u663e\u7136\uff0c\u6700\u4f18\u89e3\u7684\u989c\u8272\u6b63\u597d\u9519\u6392\u7684\u6982\u7387\u662f $\\dfrac {k!}{k^k}$\uff0c\u5927\u7ea6\u662f $3.8\\%$\uff0c\u90a3\u4e48\u6211\u4eec\u968f\u673a $200$ \u6b21\uff0c\u51fa\u9519\u7684\u6982\u7387\u5c31\u4e0d\u5230\u5343\u5206\u4e4b\u4e00\u4e86\uff0c\u590d\u6742\u5ea6 $O(Tnm3^k\\log nm)$\uff0c\u5176\u4e2d $T$ \u4e3a\u968f\u673a\u6b21\u6570\u3002\u7531\u4e8e\u526a\u679d\u6bd4\u8f83\u5f3a\uff0c\u53ef\u4ee5\u8f7b\u677e\u8dd1\u8fc7\u3002\n",
        "postTime": 1620915482,
        "uid": 77174,
        "name": "FunnyCreatress",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P7450 \u3010[THUSCH2017] \u5de7\u514b\u529b\u3011"
    },
    {
        "content": ">\u300c\u4eba\u751f\u5c31\u50cf\u4e00\u76d2\u5de7\u514b\u529b\uff0c\u4f60\u6c38\u8fdc\u4e0d\u77e5\u9053\u5403\u5230\u7684\u4e0b\u4e00\u5757\u662f\u4ec0\u4e48\u5473\u9053\u3002\u300d\n\n\u539f\u9898\u9898\u610f\uff1a\u7ed9\u4f60 $n\u00d7m$ \u4e2a\u70b9\uff0c\u6bcf\u4e2a\u70b9\u542b\u6709\u4e24\u4e2a\u5143\u7d20 $a_{i,j}$ \u548c $c_{i,j}$ \u4ee3\u8868\u8fd9\u4e2a\u70b9\u7684\u7f8e\u5473\u503c\u5927\u5c0f\u548c\u989c\u8272\uff0c\u8981\u6c42\u8f93\u51fa\u5305\u542b\u81f3\u5c11 $k$ \u79cd\u989c\u8272\u7684\u8054\u901a\u5757\u4f7f\u5f97\u5728\u70b9\u6570\u6700\u5c11\u7684\u60c5\u51b5\u4e0b\u7f8e\u5473\u5ea6\u7684\u4e2d\u4f4d\u6570\u6700\u5c0f\u5e76\u8f93\u51fa\u4ed6\u4eec\u3002\n\n\u8003\u8651\u5230\u8fd9\u4e2a $k$ \u5f88\u5c0f\uff0c\u6bd4\u8f83\u7b26\u5408\u65af\u5766\u7eb3\u6811\u7684\u6761\u4ef6\uff0c\u6240\u4ee5\u5728\u5bf9\u4e8e\u989c\u8272\u603b\u6570\u8f83\u5c0f\u7684\u60c5\u51b5\u4e0b\u76f4\u63a5\u8dd1\u65af\u5766\u7eb3\u6811\u5373\u53ef\u3002\u4f46\u662f\u989c\u8272\u7684\u603b\u6570\u53ef\u80fd\u5f88\u5927\uff0c\u9009\u62e9\u7684\u65b9\u6848\u6709\u5f88\u591a\uff0c\u4e0d\u53ef\u4ee5\u5168\u90e8\u90fd\u679a\u4e3e\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u796d\u51fa**\u968f\u673a\u5316**\u3002\u4e5f\u5c31\u662f\u5c06\u989c\u8272\u968f\u673a\u6620\u5c04\u5230 $[0,k)$ \u4e0a\u3002\n\n\u4e3a\u4ec0\u4e48\u8fd9\u9053\u9898\u76ee\u53ef\u4ee5\u8fdb\u884c\u968f\u673a\u5316\uff1f\n\n\u8003\u8651\u67d0\u6b21\u65af\u5766\u7eb3\u6811\u9009\u62e9\u7684\u89e3\u6070\u597d\u4e3a\u6700\u4f18\u89e3\u9009\u62e9\u7684 $k$\uff0c\u6700\u4f18\u89e3\u7684\u79cd\u7c7b\u60c5\u51b5\u5c31\u662f\u5bf9\u4e8e $k$ \u7684\u5168\u6392\u5217\uff0c\u4e5f\u5c31\u662f\u65b9\u6848\u6570\u4e3a $k!$\uff0c\u7136\u540e\u8003\u8651\u603b\u65b9\u6848\u6570, \u603b\u5171 $k$ \u4e2a\u4f4d\u7f6e\u4e0a\u6bcf\u4e2a\u4f4d\u7f6e\u90fd\u6709 $k$ \u4e2d\u9009\u62e9\uff0c\u65b9\u6848\u6570\u4e3a $k^k$\uff0c \u6240\u4ee5\u6210\u529f\u7684\u6982\u7387\u4e3a $P=k!/k^k$\u3002\u5f53 $k=5$ \u65f6\uff0c\u6210\u529f\u6982\u7387 $P$ \u53ea\u6709 $0.0384$\uff0c\u8fd9\u6837\u8dd1\u4e00\u6b21\u662f\u660e\u663e\u4e0d\u591f\u7684\u3002\n\n\u5f88\u660e\u663e\u505a $T$ \u6b21\u968f\u673a\u5316\u4e4b\u540e $(1-P)^{T}$ \u660e\u663e\u5f53 $T$ \u53d8\u5f97\u5f88\u5927\u65f6\u9519\u8bef\u7387\u4f1a\u5f88\u5c0f\u3002\u4e5f\u5c31\u662f $0.9616 ^{T}$, \u5927\u6982\u7b97\u4e2a $100$ \u6b21\u7684\u65f6\u5019\uff0c\u9519\u8bef\u7387\u5c31\u53ef\u4ee5\u964d\u5230 $2\\%$ \u4ee5\u5185\u4e86\uff0c\u518d\u591a\u7b97\u51e0\u6b21\u9519\u8bef\u7387\u5c31\u4f1a\u964d\u5230\u5f88\u5c0f\u5f88\u5c0f\uff0c\u8003\u8651\u548c\u65f6\u95f4\u590d\u6742\u5ea6\u7ed3\u5408\u5206\u6790\u9009\u62e9 $T$ \u7684\u5927\u5c0f\u3002~~\u901a\u8fc7\u7814\u7a76\u8868\u660e~~\uff0c\u505a $200$ \u6b21\u968f\u673a\u5316\u662f\u5b8c\u5168\u53ef\u884c\u7684\u3002 \n\n\u7136\u540e\u8003\u8651\u7684\u662f\u5982\u4f55\u6c42\u51fa\u7f8e\u5473\u503c\u7684\u4e2d\u4f4d\u6570\uff0c\u8003\u8651\u8fdb\u884c\u4e8c\u5206\uff0c\u5bf9\u4e8e\u5176\u5c0f\u4e8e $mid$ \u7684\u7f8e\u5473\u503c\u5c06\u5176\u6743\u91cd\u53d8\u4e3a $\\inf-1$ \u5927\u4e8e $mid$ \u7684\u7f8e\u5473\u503c\u5c06\u5176\u6743\u91cd\u53d8\u4e3a $\\inf+1$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u662f\u5728\u5176\u70b9\u6570\u6700\u5c0f\u7684\u60c5\u51b5\u4e0b\u53d6\u5230\u7684\u4e2d\u4f4d\u6570\u6700\u5c0f\u503c\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(T \\cdot 3^k \\cdot nm \\cdot \\log_2nm)$\uff0c\u7a0d\u5fae\u4f30\u4e00\u4e0b $T$ \u7684\u5927\u5c0f\u8dd1 $T$ \u904d\u968f\u673a\u5316\u5373\u53ef\uff0c\u7531\u4e8e\u6709 $5$ \u7ec4\u4e14\u65f6\u9650\u4e3a $5$ s\uff0c\u6240\u4ee5\u6309\u4e0a\u8ff0\u65f6\u95f4\u590d\u6742\u5ea6\u8003\u8651\u8303\u56f4\u5373\u53ef\uff0c\u8fd9\u91cc\u53d6\u5f97\u662f $210$ \u6b21\u3002 ~~(\u7edd\u5bf9\u6ca1\u6709\u4ec0\u4e48\u7279\u6b8a\u7684\u542b\u4e49)~~ \n\n\u4e00\u4e2a\u5c0f\u70b9\u662f\u5728\u5408\u5e76\u65f6\u5176\u503c\u4f1a\u7b97\u4e24\u6b21\uff0c\u6240\u4ee5\u8981\u51cf\u53bb\u70b9\u6743\u3002\n\n```\n#include<bits/stdc++.h>\n#define Debug if(true)\n#define x first\n#define y second\n#define pb push_back\n#define For(i,a,b) for(int i=(a);i<=(b);i++)\n#define Rep(i,a,b) for(int i=(a);i>=(b);i--)\nusing namespace std;\nconst int maxn=235,maxk=7,inf=0x3f3f3f3f;\ninline int read()\n{\n\tint x=0,f=1;char c;\n\tfor(;!isdigit(c);c=getchar()) if(c=='-') f=-f;\n\tfor(;isdigit(c);c=getchar()) x=(x<<1)+(x<<3)+(c^48);\n\treturn x*f;\n}\nmt19937 cjlak1o1(11451419);\n//\u8dd1n\u591a\u6b21\u65af\u5766\u7eb3\u6811\uff0c\u968f\u673a\u5316\uff0c\u7ed9mid\u8d4b\u5927\u6743\u503c\nint n,m,k;\nint dp[maxn][maxn][1<<maxk];\nint c[maxn][maxn],w[maxn][maxn],a[maxn][maxn];\nint col[maxn],cnt,to[maxn];\n\nint dx[4]={0,0,1,-1};\nint dy[4]={-1,1,0,0};\nqueue<pair<int,int> > que;\nbool inq[maxn][maxn];\ninline bool in_map(int x,int y)\n\t{return (x>=1)&&(x<=n)&&(y>=1)&&(y<=m);}\ninline void SPFA(int st)\n{\n\twhile(!que.empty())\n\t{\n\t\tpair<int,int> u=que.front();que.pop(),inq[u.x][u.y]=false;\n\t\tFor(i,0,3)\n\t\t{\n\t\t\tint tx=u.x+dx[i],ty=u.y+dy[i];\n\t\t\tif(!in_map(tx,ty)||c[tx][ty]==-1) continue;\n\t\t\tif(dp[u.x][u.y][st]+w[tx][ty]<dp[tx][ty][st])\n\t\t\t{\n\t\t\t\tdp[tx][ty][st]=dp[u.x][u.y][st]+w[tx][ty];\n\t\t\t\tif(!inq[tx][ty]) que.push({tx,ty}),inq[tx][ty]=true;\n\t\t\t}\n\t\t}\n\t}\n}\ninline int stenenior_tree(int ans=inf)\n{\n\tFor(_,1,210)\n\t{\n\t\tshuffle(col+1,col+1+cnt,cjlak1o1);\n\t\tFor(i,1,cnt) to[col[i]]=i%k;\n\t\tint maxs=1<<k;\n\t\tFor(st,1,maxs-1) For(i,1,n) For(j,1,m) dp[i][j][st]=inf;\n\t\tFor(i,1,n) For(j,1,m) if(~c[i][j]) dp[i][j][1<<to[c[i][j]]]=w[i][j];\n\t\tFor(st,1,maxs-1)\n\t\t{\n\t\t\tFor(i,1,n)\n\t\t\t\tFor(j,1,m) \n\t\t\t\t\tif(~c[i][j])\n\t\t\t\t\t{\n\t\t\t\t\t\tfor(int sub=st&(st-1);sub;sub=(sub-1)&st)\n\t\t\t\t\t\t\tdp[i][j][st]=min(dp[i][j][st],dp[i][j][sub]+dp[i][j][st^sub]-w[i][j]);\n\t\t\t\t\t\tif(dp[i][j][st]!=inf) que.push({i,j});\n\t\t\t\t\t}\n\t\t\tSPFA(st);\n\t\t}\n\t\tFor(i,1,n) For(j,1,m) ans=min(ans,dp[i][j][maxs-1]);\n\t}\n\treturn ans;\n}\nsigned main()\n{\n\tint T=read();\n\twhile(T--)\n\t{\n\t\tcnt=0;\n\t\tn=read(),m=read(),k=read();\n\t\tFor(i,1,n) For(j,1,m) c[i][j]=col[++cnt]=read();\n\t\tFor(i,1,n) For(j,1,m) a[i][j]=read(),w[i][j]=1;\n\t\tsort(col+1,col+1+cnt);\n\t\tcnt=unique(col+1,col+1+cnt)-col-1;\n\t\tint ans=stenenior_tree();\n\t\tif(ans==inf) {puts(\"-1 -1\");continue;}\n\t\tint l=0,r=1e6,res=0;\n\t\twhile(l<=r)\n\t\t{\n\t\t\tint mid=(l+r)>>1;\n\t\t\tFor(i,1,n) For(j,1,m)\n\t\t\t\tw[i][j]=(a[i][j]<=mid)?9999:10001;\n\t\t\tif(stenenior_tree()<=ans*10000) res=mid,r=mid-1;\n\t\t\telse l=mid+1;\n\t\t}\n\t\tprintf(\"%d %d\\n\",ans,res);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1656473659,
        "uid": 235855,
        "name": "shenxinge",
        "ccfLevel": 6,
        "title": "\u597d\u4e45\u6ca1\u5199\u535a\u5ba2\u4e865"
    },
    {
        "content": "\u4e3b\u8981\u8bb2\u8bb2\u8fd9\u7c7b\u7b97\u6cd5\u7684\u6b63\u786e\u7387\u600e\u4e48\u5206\u6790\uff0c\u8fd9\u6837\u4ee5\u540e\u5c31\u4e0d\u7528\u778e\u731c\u4e86\u3002\n\n\u987a\u4fbf\u63d0\u4e00\u4e0b\uff0c\u8fd9\u9898\u7528\u7684\u968f\u673a\u5316 trick \u5728\u5b66\u672f\u754c\u53eb\u4f5c color-coding\uff0c\u662f\u5f88\u6b63\u7ecf\u7684\u7b97\u6cd5\uff0c\u5927\u5bb6\u53ef\u4ee5\u53bb\u641c\u4e00\u4e0b\u8bba\u6587\u3002\n\ncolor-coding \u7684\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1a\u5c06\u6bcf\u79cd\u56fe\u6848\u968f\u673a\u6620\u5c04\u5230 $[0,k-1]$ \u4e2d\u7684\u4e00\u4e2a\u6574\u6570\uff0c\u4ece\u800c\u5c06\u95ee\u9898\u5f52\u7ea6\u5230\u4e00\u4e2a\u65b0\u95ee\u9898\uff1a\u627e\u51fa\u4e00\u4e2a\u8054\u901a\u5757\uff0c\u4f7f\u5f97 $0\\sim k-1$ \u5728\u5176\u4e2d\u81f3\u5c11\u51fa\u73b0\u4e00\u6b21\uff0c\u6700\u5c0f\u5316\u8054\u901a\u5757\u7684\u5927\u5c0f\uff0c\u5982\u679c\u8054\u901a\u5757\u5927\u5c0f\u76f8\u540c\uff0c\u5219\u6700\u5c0f\u5316\u7f8e\u5473\u5ea6\u7684\u4e2d\u4f4d\u6570\u5927\u5c0f\u3002\n\n\u5728\u4ecb\u7ecd\u65b0\u95ee\u9898\u7684\u89e3\u6cd5\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u7b80\u5355\u5206\u6790\u4e00\u4e0b\u8fd9\u4e2a\u7b97\u6cd5\u7684\u6b63\u786e\u7387\u3002\n\n\u5047\u8bbe\u5b58\u5728\u4e00\u4e2a\u5305\u542b\u6070\u597d $k$ \u79cd\u56fe\u6848\u7684\u8054\u901a\u5757\uff0c\u4e14\u5b83\u662f\u6700\u4f18\u7684\u3002\u8003\u8651\u8fd9\u4e2a\u8054\u901a\u5757\u4e2d\u7684\u56fe\u6848\uff0c\u6240\u6709\u53ef\u80fd\u7684\u67d3\u8272\u65b9\u6848\u603b\u5171 $k^k$ \u79cd\u3002\u5176\u4e2d\uff0c\u6070\u597d\u662f\u4e00\u4e2a $0\\sim k-1$ \u6392\u5217\u7684\u67d3\u8272\u65b9\u6848\u603b\u5171 $k!$ \u79cd\u3002\n\n\u6240\u4ee5\uff0c\u8fd0\u884c\u4e00\u6b21\u4e0a\u8ff0\u7b97\u6cd5\uff0c\u627e\u51fa\u8fd9\u4e2a\u8054\u901a\u5757\u7684\u6982\u7387\u5c31\u662f $P=\\frac{k!}{k^k}$\u3002$k=5$ \u65f6\uff0c$P\u2248\\frac{1}{26}$\u3002\n\nbtw\uff0c\u5982\u679c $k$ \u4efb\u610f\uff0c\u6839\u636e\u65af\u7279\u6797\u516c\u5f0f\uff0c\u6709\u5982\u4e0b\u4f30\u8ba1\uff1a$P\u2248 \\frac{\\sqrt{2\\pi k}}{e^k}$\uff0c\u867d\u7136\u5e76\u4e0d practical\u3002\n\n\u5982\u679c\u6700\u4f18\u8054\u901a\u5757\u5305\u542b\u7684\u56fe\u6848\u6570\u5927\u4e8e $k$ \u79cd\uff0c\u627e\u51fa\u5b83\u7684\u6982\u7387\u4e00\u5b9a\u5927\u4e8e $\\frac{k!}{k^k}$\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8003\u8651 $P=\\frac{k!}{k^k}$ \u7684\u60c5\u51b5\u3002\n\n\u5047\u8bbe\u6211\u4eec\u8fd0\u884c\u4e86 $T$ \u6b21\uff0c\u90a3\u4e48\u9519\u8bef\u7387 $\\epsilon=(1-P)^T$\u3002\n\n\u8fd9\u4e2a\u4e1c\u897f\u4e0d\u5bb9\u6613\u5206\u6790\uff0c\u6211\u4eec\u5148\u5bf9\u5b83\u8fdb\u884c\u4e00\u4e9b\u5904\u7406\u3002\n\n\u4ee4 $\\lambda=\\frac{1}{P}$\uff0c\u5219\n\n$$\\begin{aligned}\n\\epsilon=& \\left(1-\\frac{1}{\\lambda}\\right)^T\n\\\\=&\\left(\\frac{\\lambda-1}{\\lambda}\\right)^T\n\\\\=&\\left(\\frac{1}{1+\\frac{1}{\\lambda-1}}\\right)^T\n\\\\=&\\left(\\left(\\frac{1}{1+\\frac{1}{\\lambda-1}}\\right)^{\\lambda-1}\\right)^{\\frac{T}{\\lambda-1}}\n\\\\=&\\left(\\frac{1}{\\left(1+\\frac{1}{\\lambda-1}\\right)^{\\lambda-1}}\\right)^{\\frac{T}{\\lambda-1}}\n\\end{aligned}\n$$\n\n\u4f17\u6240\u5468\u77e5 $\\lim_{n\\to \\infty}{\\left(1+\\frac{1}{n}\\right)}^n=e$\uff0c\u6240\u4ee5 $\\epsilon \u2248\\left(\\frac{1}{e}\\right)^{\\frac{T}{\\lambda-1}}$\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u6bcf\u8fd0\u884c $\\lambda-1$ \u6b21\u7b97\u6cd5\uff0c\u9519\u8bef\u7387\u5c31\u4f1a\u53d8\u4e3a\u539f\u6765\u7684 $\\frac{1}{e}$\uff0c\u8fd9\u4e2a\u7ed3\u8bba\u53ef\u4ee5\u8bb0\u4e00\u4e0b\u3002\n\n\u4ee3\u5165\u6570\u636e\u7b97\u4e00\u4e0b\uff0c\u53d6 $T=150\\sim 200$ \uff0c\u5f97\u5230\u7684\u7b54\u6848\u5c31\u975e\u5e38\u51c6\u786e\u4e86\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u65b0\u95ee\u9898\u600e\u4e48\u505a\u3002\n\n\u7b2c\u4e00\u4e2a\u9650\u5236\u662f\u597d\u5904\u7406\u7684\uff0c\u4eff\u7167 Steiner Tree \u7684\u601d\u8def\uff0c\u8bbe $f_{S,i,j}$ \u4ee3\u8868\u5305\u542b\u4e86\u989c\u8272\u96c6\u5408 $S$\uff0c\u5f53\u524d\u6811\u6839\u4f4d\u4e8e$ (i,j)$\uff0c\u6700\u5c0f\u7684\u8054\u901a\u5757\u5927\u5c0f\u3002\n\n\u552f\u4e00\u4e0d\u540c\u7684\u662f\u8d21\u732e\u5728\u70b9\u4e0a\uff0c\u6240\u4ee5\u6bcf\u6b21\u679a\u4e3e\u5b50\u96c6\u7684\u65f6\u5019\u8981\u51cf\u53bb\u6839\u8282\u70b9\u7684\u8d21\u732e\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\u9650\u5236\uff0c\u6211\u4eec\u8003\u8651\u5e38\u89c1\u7684\u5957\u8def\uff1a\u4e8c\u5206 $mid$\uff0c\u5c06\u7f8e\u5473\u5ea6 $\\le mid$ \u7684\u5de7\u514b\u529b\u7684\u6743\u503c\u8bbe\u4e3a $-1$\uff0c\u5426\u5219\u8bbe\u4e3a $1$\u3002\n\n\u5982\u679c\u5b58\u5728\u6743\u503c\u548c\u5c0f\u4e8e $0$ \u7684\u6700\u5c0f\u8054\u901a\u5757\uff0c\u8bf4\u660e\u6700\u5c0f\u4e2d\u4f4d\u6570 $\\le  mid$\uff0c\u4e8c\u5206\u5de6\u8fb9\u754c\uff1b\u5426\u5219\u4e8c\u5206\u53f3\u8fb9\u754c\u3002\n\n\u5982\u4f55\u5b9e\u73b0 check \u51fd\u6570\u5462\uff1f\n\n\u6211\u4eec\u5c06 $f_{S,i,j}$ \u8bbe\u4e3a\u4e00\u4e2a\u4e8c\u5143\u7ec4 $(cnt,sum)$\uff0c\u5206\u522b\u8868\u793a\u8054\u901a\u5757\u5927\u5c0f\u548c\u6743\u503c\u548c\u3002\u5f53 $cnt$ \u76f8\u7b49\u65f6\uff0c\u6700\u5c0f\u5316 $sum$ \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(T \\log nm (3^k nm+2^knm\\log nm))$\u3002\uff08\u5199\u5b8c\u624d\u53d1\u73b0\u8fd9\u91cc\u7684\u8fd0\u884c\u6b21\u6570 $T$ \u597d\u50cf\u548c\u6570\u636e\u7ec4\u6570\u91cd\u590d\u4e86\uff0c\u53cd\u6b63\u4f60\u4eec\u7406\u89e3\u5c31\u884c\uff09\n\n\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e2a\u526a\u679d\uff1a\u56e0\u4e3a\u6bcf\u6b21\u4e8c\u5206\u6c42\u51fa\u7684\u8054\u901a\u5757\u5927\u5c0f\u90fd\u662f\u76f8\u7b49\u7684\uff0c\u5982\u679c\u8fd9\u4e2a\u8054\u901a\u5757\u5927\u5c0f\u5927\u4e8e\u5f53\u524d\u6700\u4f18\u89e3 $ans$\uff0c\u53ef\u4ee5\u4e0d\u7528\u4e8c\u5206\u3002\n\n\u4eb2\u6d4b\u975e\u5e38\u6709\u6548\uff0c\u5bf9\u4e8e\u6211\u8fd9\u79cd STL \u9009\u624b\uff0c\u8fd0\u884c\u65f6\u95f4\u76f4\u63a5\u4ece 5s \u964d\u5230\u4e86 1.3s\u3002\n\n\u4ee3\u7801\u5f88\u4e11\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define vi vector<int>\n#define vvi vector<vi>\n#define pII pair<int,int>\n#define fi first\n#define se second\n#define rep(i,x,y) for(int i=(x);i<=(y);++i)\nusing namespace std;\nconst int inf=0x3f3f3f3f;\nmt19937 gen(time(0));\nint dx[4]={0,1,0,-1},dy[4]={1,0,-1,0};\nint T,n,m,k,V,C,clr[250],num[250];\npII ans=make_pair(inf,inf);\nvvi c,a;\nvector<vector<pII>>f[1<<5];\nvector<vector<bool>>vs;\npII operator+(const pII&a,const pII&b){return make_pair(a.fi+b.fi,a.se+b.se);}\npII operator-(const pII&a,const pII&b){return make_pair(a.fi-b.fi,a.se-b.se);}\npII operator-(const pII&b){return make_pair(-b.fi,-b.se);}\nint id(int x){return lower_bound(num+1,num+V+1,x)-num;}\nint sgn(int x){return x&1?-1:1;}\nbool valid(int x,int y){return x>=1&&x<=n&&y>=1&&y<=m&&~c[x][y];}\nint now=inf,mid;\npII add(int x,int y){return make_pair(1,sgn(a[x][y]<=mid));}\nvoid dij(int p){\n\tpriority_queue<pair<pII,pII>>q;\n\tvs=vector<vector<bool>>(n+1,vector<bool>(m+1));\n\trep(i,1,n)rep(j,1,m)if(valid(i,j))q.emplace(-f[p][i][j],make_pair(i,j));\n\twhile(q.size()){\n\t\tpII now=q.top().se;q.pop();\n\t\tint x=now.fi,y=now.se;\n\t\tif(vs[x][y])continue;\n\t\tvs[x][y]=1;\n\t\trep(k,0,3){\n\t\t\tint nx=x+dx[k],ny=y+dy[k];\n\t\t\tif(!valid(nx,ny))continue;\n\t\t\tif(f[p][nx][ny]>f[p][x][y]+add(nx,ny)){\n\t\t\t\tf[p][nx][ny]=f[p][x][y]+add(nx,ny);\n\t\t\t\tq.emplace(-f[p][nx][ny],make_pair(nx,ny));\n\t\t\t}\n\t\t}\n\t}\n}\nbool check(){\n\trep(p,0,(1<<k)-1)f[p]=vector<vector<pII>>(n+1,vector<pII>(m+1,make_pair(inf,inf)));\n\trep(i,1,n)rep(j,1,m)if(valid(i,j))\n\t\tf[1<<clr[c[i][j]]][i][j]=add(i,j);\n\trep(p,1,(1<<k)-1){\n\t\tfor(int q=p&p-1;q;q=q-1&p)rep(i,1,n)rep(j,1,m)if(valid(i,j)){ \n\t\t\tf[p][i][j]=min(f[p][i][j],f[q][i][j]+f[p-q][i][j]-add(i,j));\n\t\t}\n\t\tdij(p);\n\t}\n\tpII ans=make_pair(inf,inf);\n\trep(i,1,n)rep(j,1,m)ans=min(ans,f[(1<<k)-1][i][j]);\n\tnow=ans.fi;\n\treturn ans.se<=0;\n}\nint main(){\n\tcin>>T;\n\twhile(T--){\n\t\tcin>>n>>m>>k;\n\t\tans=make_pair(inf,inf);V=C=0;\n\t\tc=a=vvi(n+1,vi(m+1));\n\t\trep(i,1,n)rep(j,1,m)scanf(\"%d\",&c[i][j]),C=max(C,c[i][j]);\n\t\trep(i,1,n)rep(j,1,m)scanf(\"%d\",&a[i][j]),num[++V]=a[i][j];\n\t\tsort(num+1,num+V+1);V=unique(num+1,num+V+1)-(num+1);\n\t\trep(i,1,n)rep(j,1,m)a[i][j]=id(a[i][j]);\n\t\tint tt=150;\n\t\twhile(tt--){\n\t\t\trep(i,1,C)clr[i]=gen()%k;\n\t\t\tnow=inf;\n\t\t\tint l=1,r=V;\n\t\t\twhile(l<r){\n\t\t\t\tmid=l+r>>1;\n\t\t\t\tif(check())r=mid;\n\t\t\t\telse l=mid+1;\n\t\t\t\tif(now>ans.fi)break;\n\t\t\t}\n\t\t\tans=min(ans,make_pair(now,num[l]));\n\t\t}\n\t\tif(ans.fi==inf)puts(\"-1 -1\");\n\t\telse cout<<ans.fi<<\" \"<<ans.se<<endl;\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1675079785,
        "uid": 362346,
        "name": "TianyiLemon",
        "ccfLevel": 0,
        "title": "P7450 [THUSCH2017]\u5de7\u514b\u529b"
    }
]