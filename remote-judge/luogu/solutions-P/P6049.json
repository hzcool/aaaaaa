[
    {
        "content": "\u524d\u7f6e\u77e5\u8bc6\uff1a\u62c9\u683c\u6717\u65e5\u63d2\u503c\r\n\r\n\u7ed9\u4e00\u4e2a\u4e0d\u7528 $\\operatorname{prufer}$ \u5e8f\u5217\u7684\u505a\u6cd5\u3002\r\n\r\n\u9996\u5148\u6c42\u7ed9\u5b9a\u4e00\u68f5\u6811\u8d4b\u6743\u7684\u65b9\u6cd5\uff0c\u4ee5 $f_{i,j}$ \u8868\u793a\u7b2c $i$ \u4e2a\u8282\u70b9\u8d4b\u503c\u4e3a $j$ \u7684\u65b9\u6848\uff0c\u90a3\u4e48\u6709\r\n$$\r\nf_{i,j}=\\prod_{(i,x) \\in E,x \u2260fa_i}\\sum_{i=1}^j f_{x,i}\r\n$$\r\n\r\n\u5bb9\u6613\u53d1\u73b0 $f_{i,j}$ \u53ef\u4ee5\u770b\u505a\u5173\u4e8e $j$ \u7684\u81f3\u591a $n+1$ \u6b21\u591a\u9879\u5f0f\uff0c\u4ee5 $F_i(j)$ \u8868\u793a\uff0c\u6240\u4ee5\u53ea\u8981\u6c42\u51fa\u6839\u8282\u70b9\u8d4b\u6743 $[1,m+1]$ \u7684\u65b9\u6848\uff0c\u518d\u62c9\u683c\u6717\u65e5\u63d2\u503c\u5373\u53ef\u3002\r\n\r\n\u8003\u8651\u5982\u4f55\u8ba1\u7b97 $n$ \u4e2a\u8282\u70b9\uff0c\u6839\u8282\u70b9\u8d4b\u6743\u4e3a $i,i \\in [1,m+1]$ \u7684\u65b9\u6cd5\uff0c\u8003\u8651\u5bf9\u4e8e\u4e00\u4e2a\u8282\u70b9 $x$\uff0c\u82e5\u5176\u6709 $k$ \u4e2a\u5b69\u5b50\uff0c\u5176\u8d4b\u6743\u65b9\u5f0f\u4ee5\u53ca\u6811\u7684\u7ed3\u6784\u5747\u76f8\u540c\uff0c\u90a3\u4e48\u663e\u7136\u65b9\u6848\u4e2d\u6709\u7cfb\u6570 $\\frac{1}{k!}$\u3002\r\n\r\n\u8003\u8651\u5728\u5df2\u77e5 $f_{i,x},x \\in [1,j)$ \u7684\u60c5\u51b5\u4e0b\uff0c\u679a\u4e3e\u8ba1\u7b97 $f_{i,j}$\u3002\r\n\r\n\u6709\r\n$$\r\nf_{i,j}=[x^j] \\prod_{c=1}^{j-1} e^{cx \\times f_{i,c}}\r\n$$\r\n\r\n\u8003\u8651\u66b4\u529b\u8ba1\u7b97\uff0c\u590d\u6742\u5ea6\u4e3a $O(n^4 \\log n)$\uff0c\u65e0\u6cd5\u63a5\u53d7\u3002\r\n\r\n\u4f46\u53d1\u73b0\u8be5\u5f0f\u4e2d\uff0c$i$ \u76f8\u540c\u7684\u60c5\u51b5\u4e0b,$f_{i,j}$ \u5230 $f_{i,j+1}$ \u7684\u591a\u9879\u5f0f\u4e2d\u672c\u8d28\u4e0a\u53ea\u5c11\u4e86\u4e00\u4e2a $e^{xj \\times f_{i,j}}$\uff0c\u5176\u7cfb\u6570\u5728 $[0,n]$ \u4e2d\u6709\u610f\u4e49\u9879\u53ea\u6709 $\\frac{n}{j}$ \u4e2a\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u4e3a\r\n$$\r\nn^2\\sum_{i=1}^n \\frac{n}{i}=n^3\\ln n\r\n$$\r\n\r\n\u6700\u540e\u4e0d\u8981\u5fd8\u4e86\u4e58\u4e0a $n!$\u3002\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\nusing namespace std;\r\nconst int N=4e3+7,p=998244353; long long v;\r\nint n,m,r[N],w[N],fac[N],f[N][N]; long long g[N];\r\ninline long long pows(long long u,int v){\r\n\tlong long ans=1; while(v>0) {if(v&1) ans=ans*u%p; u=u*u%p,v=v>>1;} return ans;\r\n}\r\nint main(){\r\n\tcin>>n>>m,f[1][1]=1,r[0]=1,fac[0]=1;\r\n\tfor(int i=1;i<=n;i++) r[i]=r[i-1]*pows(i,p-2)%p,fac[i]=pows(r[i],p-2);\r\n\tfor(int i=1;i<=n+3;i++){\r\n\t\tf[1][i]=i,g[0]=1;\r\n\t\tfor(int x=1;x<=n;x++) g[x]=pows(i,x)*r[x]%p;\r\n\t\tfor(int x=2;x<=n;x++){\r\n\t\t\tf[x][i]=g[x-1];\r\n\t\t\tif(f[x][i]+f[x][i-1]>=p) f[x][i]=f[x][i]+f[x][i-1]-p;\r\n\t\t\telse f[x][i]=f[x][i]+f[x][i-1];\r\n\t\t\tfor(int c=1;c*x<=n;c++) w[c]=pows(f[x][i],c)*r[c]%p;\r\n\t\t\tfor(int c=n;c>=x;c--)\r\n\t\t\t\tfor(int t=1;t*x<=c;t++)\r\n\t\t\t\t\tg[c]=(g[c]+g[c-t*x]*w[t])%p;\r\n\t\t}\r\n\t}\r\n\tv=1; long long op=0;\r\n\tfor(int i=1;i<=n;i++) v=1ll*v*i%p;\r\n\tif(m<=n+3) op=f[n][m];\r\n\telse{\r\n\t\tfor(int i=1;i<=n+3;i++){\r\n\t\t\tlong long val=f[n][i];\r\n\t\t\tfor(int j=1;j<=n+3;j++){\r\n\t\t\t\tif(i==j) continue;\r\n\t\t\t\tval=val*(m-j)%p*pows(i-j,p-2)%p;\r\n\t\t\t}\r\n\t\t\top=(op+val)%p;\r\n\t\t}\r\n\t}\r\n\tcout<<(op+p)*v%p<<endl;\r\n\treturn 0;\r\n}\r\n```",
        "postTime": 1580740975,
        "uid": 41918,
        "name": "_QAQ",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6062 \u3010\u71d4\u796d sacrificial\u3011"
    },
    {
        "content": "**\u9898\u610f** : \u8981\u6c42\u7edf\u8ba1\u6ee1\u8db3\u5982\u4e0b\u8981\u6c42\u7684\u5e26\u6807\u53f7\u6709\u6839\u6811\u3002\n\n- \u6709 $n$ \u4e2a\u8282\u70b9\u3002\n\n- \u70b9\u6743\u4e3a $[1,m]$ \u5185\u6574\u6570,\u4e14\u6ee1\u8db3\u5806\u7684\u6027\u8d28\u3002\n\n\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u3002\n\n$n\\leq 400$ ,\u65f6\u9650$\\texttt{2s}$\u3002\n\n------------\n\n~~\u770b\u4e0d\u61c2\u9898\u89e3\u7136\u540e\u81ea\u5df1\u80e1\u7f16\u4e2a\u505a\u6cd5\u8fc7\u4e86\uff0c\u592a\u611f\u52a8\u4e86~~\n\n\u65b9\u6848\u6570\u6709\u4e00\u4e2a\u663e\u7136\u7684\u7c97\u7565\u4e0a\u754c $(nm)^n$ \uff0c\u8fd9\u63d0\u793a\u6211\u4eec\u7b54\u6848\u662f\u5173\u4e8e $m$ \u7684 $n$ \u6b21\u591a\u9879\u5f0f\u3002\n\n\u8bbe $F[i][j]$ \u4e3a $i$ \u4e2a\u70b9\u7684\u6811\u6839\u70b9\u6743\u4e3a $j$ \u7684\u65b9\u6848\u6570\uff0c\u6c42\u51fa $F[n][1...n+1]$ \u540e\u63d2\u503c\u5373\u53ef\u3002\n\n\u8bbe $F_k(x)=\\sum\\limits_{i=0}\\dfrac{x^iF[i][k]}{i!}$ \uff0c\u5373 $\\rm EGF$\u3002\n\n\u8bbe $G_k(x)=\\sum\\limits_{i=1}^kF_i(x)$\u3002\n\n\u8003\u8651\u4e00\u4e2a\u6839\u6743\u503c\u4e3a $k$ \u7684\u6811\u662f\u600e\u4e48\u9020\u51fa\u6765\u7684 \uff1a \u9009\u82e5\u5e72\u6839\u6743\u503c $\\leq k$ \u7684\u6811\uff0c\u6807\u53f7\u6df7\u5408\u4e4b\u540e\uff0c\u8fde\u5411\u6839\u3002\n\n\u5219\u6709 $F_k(x)=x \\exp G_k(x)$ \uff0c\u5373 $F_k(x)=x \\exp (F_k(x)+G_{k-1}(x))$\u3002\n\n\u7b49\u4ef7\u4e8e \uff1a \u7ed9\u51fa $G$ \uff0c\u6709 $F=x\\exp (F+G)$ \uff0c\u6c42 $F$\u3002\n\n$\\Rightarrow F=x\\exp G\\exp F$\n\n$\\Rightarrow F[n]=\\sum\\limits_{i+j=n-1}(\\exp G)[i](\\exp F)[j]$\n\n\u800c\u4f17\u6240\u5468\u77e5\u53ef\u4ee5\u5728 $O(n^2)$ \u5185\u9010\u9879\u7531 $F[1...n]$ \u9012\u63a8\u5f97\u5230 $(\\exp F)[1...n]$\u3002\n\n\u8fb9\u754c \uff1a $F_1[n]=n^{n-1}$ \uff0c\u5373\u6709\u6807\u53f7\u6709\u6839\u6811\u3002\n\n\u590d\u6742\u5ea6\u4e3a $O(n^3)$\u3002\u7406\u8bba\u53ef\u4ee5\u505a\u5230 $O(n^2\\log n)$\u3002\n\n```cpp\n#include<cstdio>\n#define ll long long\n#define MaxN 410\nusing namespace std;\nconst int mod=998244353;\nll powM(ll a,int t=mod-2){\n  ll ans=1;\n  while(t){\n    if (t&1)ans=ans*a%mod;\n    a=a*a%mod;t>>=1;\n  }return ans;\n}\nll fac[MaxN],ifac[MaxN];\nvoid Init(int n)\n{\n  fac[0]=1;\n  for (int i=1;i<=n;i++)\n    fac[i]=fac[i-1]*i%mod;\n  ifac[n]=powM(fac[n]);\n  for (int i=n;i;i--)\n    ifac[i-1]=ifac[i]*i%mod;\n}\nll pl[MaxN],pr[MaxN];\nvoid calc(int m,ll x,ll *y)\n{\n  ll ans=0;\n  pl[0]=pr[m+1]=1;\n  for (int i=1;i<=m;i++)\n    pl[i]=pl[i-1]*(x-i)%mod;\n  for (int i=m;i;i--)\n    pr[i]=pr[i+1]*(x-i)%mod;\n  for (int i=1;i<=m;i++){\n    ll buf=pl[i-1]*pr[i+1]%mod*ifac[i-1]%mod*ifac[m-i]%mod*y[i]%mod;\n    if ((m-i)&1)ans-=buf;\n    else ans+=buf;\n  }printf(\"%lld\",(ans%mod+mod)%mod);\n}\nvoid exp(ll *F,int n)\n{\n  static ll dF[MaxN];\n  for (int i=1;i<=n;i++)dF[i-1]=i*F[i]%mod;\n  F[0]=1;\n  for (int k=1;k<=n;k++){\n    F[k]=0;\n    for (int i=0;i<k;i++)\n      F[k]=(F[k]+dF[i]*F[k-i-1])%mod;\n    F[k]=F[k]*ifac[k]%mod*fac[k-1]%mod;\n  }\n}\nvoid trans(ll *F,ll *G,int n)\n{\n  static ll eF[MaxN],S[MaxN],dF[MaxN];\n  for (int i=0;i<=n;i++)S[i]=G[i];\n  exp(S,n);\n  eF[0]=1;\n  for (int k=1;k<=n;k++){\n    F[k]=0;\n    for (int i=0;i<k;i++)\n      F[k]=(F[k]+eF[i]*S[k-i-1])%mod;\n    dF[k-1]=F[k]*k%mod;\n    eF[k]=0;\n    for (int i=0;i<k;i++)\n      eF[k]=(eF[k]+dF[i]*eF[k-i-1])%mod;\n    eF[k]=eF[k]*ifac[k]%mod*fac[k-1]%mod;\n  }\n}\nll F[MaxN][MaxN],G[MaxN][MaxN],s[MaxN];\nint n,m,D;\nint main()\n{\n  scanf(\"%d%d\",&n,&D);m=n+1;\n  Init(n+5);\n  for (int i=1;i<=n;i++)\n    G[1][i]=F[1][i]=powM(i,i-1)*ifac[i]%mod;\n  for (int k=2;k<=m;k++){\n    trans(F[k],G[k-1],n);\n    for (int i=0;i<=n;i++)\n      G[k][i]=(G[k-1][i]+F[k][i])%mod;\n  }for (int k=1;k<=m;k++)\n    s[k]=G[k][n]*fac[n]%mod;\n  calc(m,D,s);\n  return 0;\n}\n```",
        "postTime": 1580789696,
        "uid": 58705,
        "name": "command_block",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6049 \u3010\u71d4\u796d\u3011"
    }
]