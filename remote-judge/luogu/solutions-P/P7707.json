[
    {
        "content": "### \u4e00\u4e9b\u788e\u788e\u5ff5\n\n\u51e0\u4e2a\u6708\u524d\u8d5b\u65f6\u5306\u5fd9\u5199\u51fa\u7684\u4ee3\u7801\u7801\u91cf\u8fbe\u5230\u4e86 $\\text{3.2K}$\uff0c\u6700\u8fd1\u5bf9\u90a3\u4efd\u4ee3\u7801\u8fdb\u884c\u4e86\u4e00\u4e9b\u7cbe\u7b80\uff0c\u91cd\u6784\u4e4b\u540e\u7801\u91cf\u51cf\u5c11\u4e86 $\\text{1K}$\uff0c\u800c\u4e14\u53bb\u6389\u4e86\u5f88\u591a\u5197\u4f59\u7684\u53d8\u91cf\u548c\u6b65\u9aa4\u3002\n\n\u4e0b\u9762\u4ecb\u7ecd\u4e00\u79cd\u4e24\u679a $\\log$ \u7684\u505a\u6cd5\u3002\u8fd9\u79cd\u505a\u6cd5\u4e0d\u4ec5\u601d\u7ef4\u3001\u4ee3\u7801\u96be\u5ea6\u90fd\u5f88\u4f4e\uff08\u6bd4 std \u77ed\u5f97\u591a\uff09\uff0c\u800c\u4e14\u8dd1\u5f97\u5f88\u5feb\uff08\u4fe9 $\\log$ \u78be\u6807\u7b97\uff09\u3002\u6700\u91cd\u8981\u7684\u662f\u5b8c\u5168\u4e0d\u4f1a\u88ab\u5361\u7a7a\u95f4\uff08\u6bd4\u5982\u5c31\u4e0d\u7528 std \u7684\u795e\u5fc5 short \u5361\u7a7a\u95f4\u6280\u5de7\uff09\u3002\n\n> \u672c\u573a\u6bd4\u8d5b\u5e94\u8be5\u53ea\u6709\u8fd9\u4e2a Subtask \u7b97\u662f\u5361\u5e38\u7684\n\n\u54c8\u54c8\u3002\n\n\u5176\u5b9e\u8d5b\u65f6\u58a8\u67d3\u7a7a\u540c\u5fd7\u5199\u7684\u5c31\u662f\u8fd9\u79cd\u505a\u6cd5\uff08\u89c1\u56e7\u5973\u58eb\u9898\u89e3\u8bc4\u8bba\u533a\uff09\uff0c\u4f46\u662f\u4ed6\u60e8\u906d MLE \u6253\u51fb\u2026\u2026\u6216\u8bb8\u662f\u6ca1\u6709\u7528\u6307\u9488\u4f18\u5316\u7a7a\u95f4\u7684\u7f18\u6545\uff1f\n\n### \u89e3\u6cd5\n\n\u4e0d\u77e5\u9053\u5927\u5bb6\u6709\u6ca1\u6709\u505a\u8fc7 [\u5411\u91cf\u96c6](https://www.luogu.com.cn/problem/P3309) \u8fd9\u9053\u9898\u76ee\u3002\u90a3\u9053\u9898\u76ee\u540c\u6837\u662f\u5f3a\u5236\u5728\u7ebf\u672b\u5c3e\u63d2\u5165\u3001\u533a\u95f4\u67e5\u8be2\uff0c\u6211\u4eec\u4f7f\u7528\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u51f8\u5305\u3002\u5177\u4f53\u5730\uff0c\u5f53\u5411\u6811\u4e0a\u67d0\u4e2a\u8282\u70b9\u4e2d\u63d2\u5165\u4fe1\u606f\u65f6\uff0c\u6211\u4eec\u5c06\u8be5\u4fe1\u606f\u6682\u65f6\u6401\u7f6e\u3002\u7b49\u5230\u4e00\u4e2a\u8282\u70b9\u88ab\u63d2\u6ee1\u4e4b\u540e\uff0c\u6211\u4eec\u4f7f\u7528\u5f52\u5e76\u6392\u5e8f\u601d\u60f3\u5c06\u5176\u5bf9\u5e94\u7684\u51f8\u5305\u5efa\u51fa\u3002\n\n\u8fd9\u79cd\u601d\u60f3\u5b8c\u5168\u53ef\u4ee5\u5957\u7528\u81f3\u672c\u9898\u4e2d\u3002\u540c\u6837\u662f\u5c06\u67d0\u4e2a\u8282\u70b9\u63d2\u6ee1\u4e4b\u540e\u7edf\u8ba1\u5b50\u8282\u70b9\u7684\u533a\u95f4\u4fe1\u606f\uff0c\u4e0b\u9762\u6211\u4eec\u8003\u8651\u5982\u4f55\u8f83\u4e3a\u5b8c\u6574\u5730\u8bb0\u5f55\u5f53\u524d\u8282\u70b9\u7684\u4fe1\u606f\uff0c\u5e76\u5bf9\u6765\u81ea\u5b50\u533a\u95f4\u7684\u4fe1\u606f\u8fdb\u884c\u5408\u5e76\u3002\n\n\u5bf9\u4e8e\u4fe1\u606f\u7684\u8bb0\u5f55\uff0c\u5982\u679c\u53bb\u6389\u9ad8\u5ea6\u8303\u56f4\u7684\u9650\u5236\uff0c\u533a\u95f4\u989c\u8272\u6bb5\u6570\u662f\u4e00\u4e2a\u7ecf\u5178\u95ee\u9898\uff0c\u4e24\u4e2a\u533a\u95f4\u4fe1\u606f\u7684\u5408\u5e76\u53ef\u4ee5 $O(1)$ \u5b8c\u6210\u3002\u73b0\u5728\u52a0\u4e0a\u4e86\u9ad8\u5ea6\u8303\u56f4\u7684\u9650\u5236\uff0c\u6211\u4eec\u4e0d\u5f97\u4e0d\u4fdd\u5b58\u5c06\u8282\u70b9\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5bf9\u8c61\u4f5c\u4e3a\u9650\u5ea6\u65f6\u7684\u7b54\u6848\u3002\u5177\u4f53\u5730\uff0c\u5728\u7ecf\u5178\u533a\u95f4\u989c\u8272\u6bb5\u6570\u95ee\u9898\u4e2d\uff0c\u6211\u4eec\u5bf9\u6bcf\u4e00\u4e2a\u533a\u95f4\u7ef4\u62a4\u4e86\u4e09\u4e2a\u91cf\uff1a$cnt,lc,rc$\uff0c\u5206\u522b\u8868\u793a\u989c\u8272\u6bb5\u6570\u548c\u4e24\u7aef\u70b9\u989c\u8272\u3002\u5728\u672c\u9898\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u533a\u95f4 $[l,r]$ \u7ef4\u62a4 $(r-l+1)$ \u4e2a\u56db\u5143\u7ec4 $\\{h,cnt,lc,rc\\}$\uff0c$h$ \u8868\u793a\u9650\u5236\u7684\u6700\u5927\u9ad8\u5ea6\uff0c\u5176\u4ed6\u4e09\u4e2a\u91cf\u540c\u7ecf\u5178\u95ee\u9898\u3002\n\n\u5408\u5e76\u65b9\u5f0f\u7c7b\u4f3c\u5411\u91cf\u96c6\u4e00\u9898\uff0c\u8003\u8651\u5bf9\u5b50\u533a\u95f4\u7ef4\u62a4\u7684\u6240\u6709\u4fe1\u606f\u8fdb\u884c\u5f52\u5e76\u3002\u5f52\u5e76\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u65ad\u5bfb\u627e\u4e24\u4e2a\u5b50\u8282\u70b9\u4e2d\u8bb0\u5f55\u7684 $h$ \u4e2d\u8f83\u5c0f\u7684\u4e00\u65b9\uff0c\u5e76\u5728\u53e6\u4e00\u4e2a\u5b50\u8282\u70b9\u4e2d\u627e\u51fa $h$ \u4e0d\u9ad8\u4e8e\u5f53\u524d\u4fe1\u606f\u7684\u6700\u5927\u56db\u5143\u7ec4\uff0c\u5bf9\u8fd9\u4e24\u4e2a\u533a\u95f4\u4fe1\u606f\u8fdb\u884c $O(1)$ \u5408\u5e76\u5373\u53ef\u3002\n\n\u5982\u4f55\u5904\u7406\u67e5\u8be2\uff1f\u540c\u6837\u5957\u7528\u5411\u91cf\u96c6\u7684\u505a\u6cd5\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u6b21\u67e5\u8be2\uff0c\u6211\u4eec\u5728 $O(\\log n)$ \u4e2a\u533a\u95f4\u4e2d\u8fdb\u884c\u4e8c\u5206\uff0c\u5e76\u540c\u6837\u7528\u5904\u7406\u7ecf\u5178\u533a\u95f4\u989c\u8272\u6bb5\u6570\u95ee\u9898\u7684\u65b9\u5f0f\u5408\u5e76\u533a\u95f4\u4fe1\u606f\u3002\n\n\u5bf9\u4e8e\u4fe1\u606f\u7684\u4fdd\u5b58\uff0c\u7528 $\\text{vector}$ \u5f53\u7136\u662f\u53ef\u4ee5\u7684\uff0c\u4f46\u662f\u542c\u8bf4\u4f1a\u5361\u7a7a\u95f4\uff0c\u6240\u4ee5\u6211\u91c7\u7528\u4e86\u53e6\u4e00\u79cd\uff08\u53ef\u80fd\u4f1a\u66f4\u4f18\u79c0\u7684\uff09\u5b58\u50a8\u65b9\u5f0f\uff1a\u5f00\u4e00\u4e2a\u5927\u6570\u7ec4\u5b58\u4e0b\u6574\u68f5\u6811\u4e0a\u6240\u6709\u8282\u70b9\u7684\u4fe1\u606f\uff0c\u5e76\u7528\u6307\u9488\u5b58\u4e0b\u6bcf\u4e2a\u8282\u70b9\u4fe1\u606f\u5728\u5927\u6570\u7ec4\u4e0a\u5bf9\u5e94\u7684\u4f4d\u7f6e\u3002\n\n\u81f3\u6b64\uff0c\u672c\u9898\u5f97\u5230\u5b8c\u7f8e\u89e3\u51b3\u3002\n\n\u4ee3\u7801\uff1a\n\n```c++\nstruct ret{\n\tint mx,cnt,lc,rc;\n\tret(){lc=rc=cnt=0;}\n\tret(int mm,int cc,int ll,int rr){mx=mm;cnt=cc;lc=ll;rc=rr;}\n\tret operator +(const ret b){\n\t\tif(!cnt)return b;\n\t\tif(!b.cnt)return *this;\n\t\treturn ret(Max(mx,b.mx),cnt+b.cnt-(rc==b.lc),lc,b.rc);\n\t}\n\tbool operator <=(const ret b)const{return mx<=b.mx;}\n\tbool operator <(const int x)const{return mx<x;}\n};\nbool operator <(const int x,const ret y){return x<y.mx;}\nbool change(int k,int l,int r,int x,int y,int h){\n\tif(l==r){\n\t\tinfo[k]=inp;inp++;info[k][0]=ret(h,1,y,y);//inp\u548cinfo\u4e3a\u4e0a\u6587\u63d0\u5230\u8fc7\u7684\u7d22\u5f15\u6307\u9488\n\t\treturn true;\n\t}\n\tint mid=(l+r)>>1;\n\tif(x<=mid)change(k<<1,l,mid,x,y,h);\n\telse change(k<<1|1,mid+1,r,x,y,h);\n\tif(x!=r)return true;\n\tint l1=mid-l+1,l2=r-mid;int i=0,j=0,np=0;\n\tinfo[k]=inp;inp+=(r-l+1);\n\twhile(i<l1||j<l2){\n\t\tif((info[k<<1][i]<=info[k<<1|1][j]&&i<l1&&j<l2)||j>=l2){\n\t\t\tinfo[k][np]=info[k<<1][i]+(j==0?ret():info[k<<1|1][j-1]);\n\t\t\ti++;np++;\n\t\t}\n\t\telse{\n\t\t\tinfo[k][np]=(i==0?ret():info[k<<1][i-1])+info[k<<1|1][j];\n\t\t\tj++;np++;\n\t\t}\n\t}\n\treturn true;\n}\nret ask(int k,int l,int r,int x,int y,int h){\n\tif(l>=x&&r<=y){\n\t\tif(info[k][0].mx>h)return ret();\n\t\tint pos=std::upper_bound(info[k],info[k]+r-l+1,h)-info[k]-1;\n\t\treturn info[k][pos];\n\t}\n\tint mid=(l+r)>>1;\n\tif(y<=mid)return ask(k<<1,l,mid,x,y,h);\n\tif(mid<x)return ask(k<<1|1,mid+1,r,x,y,h);\n\tret xx=ask(k<<1,l,mid,x,y,h)+ask(k<<1|1,mid+1,r,x,y,h);\n\treturn xx;\n}\nint main(){\n\tn=read();m=read();len=n+m;int k=read();inp=ii;//ii\u4e3a\u4e0a\u6587\u63d0\u5230\u8fc7\u7684\u5927\u6570\u7ec4\n\tfor(int i=1;i<=n;i++)ta[i]=read();\n\tfor(int i=1;i<=n;i++)change(1,1,len,i,read(),ta[i]);\n\tfor(int i=1;i<=m;i++){\n\t\tint opt=read();\n\t\tif(opt&1){\n\t\t\tint l=read()^(k*lans);int r=read()^(k*lans);int x=read()^(k*lans);\n\t\t\tret ans=ask(1,1,len,l,r,x);\n\t\t\tprintf(\"%d\\n\",lans=ans.cnt);\n\t\t}\n\t\telse{\n\t\t\tint h=read()^(k*lans);int y=read()^(k*lans);\n\t\t\tchange(1,1,len,++n,y,h);\n\t\t}\n\t}\n}\n```",
        "postTime": 1634738186,
        "uid": 26551,
        "name": "LFCode",
        "ccfLevel": 0,
        "title": "P7707 \u767e\u82b1\u9f50\u653e\u7684\u592a\u9633\u82b1\u7530\uff1a\u7206\u6807"
    },
    {
        "content": "[P7707 \u767e\u82b1\u9f50\u653e\u7684\u592a\u9633\u82b1\u7530](https://www.luogu.com.cn/problem/P7707)\n\n\u611f\u89c9\u9898\u76ee\u770b\u4e0a\u53bb\u5c31\u5f88\u7ebf\u6bb5\u6811\uff0c\u8003\u8651\u7528\u7ebf\u6bb5\u6811\u53bb\u66b4\u529b\u7ef4\u62a4\u3002\n\n\u6b63\u5e38\u5f00\u4e00\u9897\u7ebf\u6bb5\u6811\u3002\n\n\u6211\u4eec\u5bf9\u7ebf\u6bb5\u6811\u4e0a\u6bcf\u4e2a\u8282\u70b9\uff0c\u90fd\u7ef4\u62a4\u4e00\u4e2a\u5e8f\u5217\uff0c\u5206\u522b\u8868\u793a\u5728\u67d0\u4e2a\u9ad8\u5ea6\u4e0b\u7684\u989c\u8272\u6bb5\u6570\uff0c\u4e24\u8fb9\u662f\u4ec0\u4e48\u989c\u8272\u3002\n\n\u7136\u540e\u5408\u5e76\u5c31\u4f7f\u7528\u7c7b\u4f3c\u4e8e\u5f52\u5e76\u6392\u5e8f\u7684\u65b9\u6cd5\uff0c\u8fdb\u884c\u5408\u5e76\u3002\n\n\u8003\u8651\u8fd9\u6837\u505a\u7684\u590d\u6742\u5ea6\uff1a\n\n\u5982\u679c\u8bf4\u4e00\u4e2a\u8282\u70b9\u7ef4\u62a4\u4e86\u591a\u4e2a\u4fe1\u606f\uff0c\u90a3\u4e48\u770b\u4e0a\u53bb\uff0c\u8fd9\u590d\u6742\u5ea6\u8c8c\u4f3c\u662f $O(n^2)$~~\uff08\u5b9e\u9645\u4e0a\u5982\u679c\u5199\u6cd5\u5047\u4e86\u4e5f\u786e\u5b9e\u5c31\u662f $n^2$ \u7684\uff09~~\u3002\n\n\u4f46\u5b9e\u9645\u4e0a\uff0c\u5176\u5b9e\u4e00\u4e2a\u8282\u70b9\u5185\u90e8\u4e0d\u4f1a\u7ef4\u62a4 $O(n)$ \u4e2a\u90a3\u4e48\u591a\u7684\u4fe1\u606f\u3002\u90a3\u600e\u4e48\u5206\u6790\u590d\u6742\u5ea6\u5462\uff1f\n\n\u663e\u7136\u7684\u4e00\u4ef6\u4e8b\u60c5\uff0c\u5c31\u662f\u5982\u679c\u8bf4\u60f3\u5361\u5230\u6700\u6ee1\uff0c\u90a3\u4e48\u6bcf\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u9ad8\u5ea6\u90fd\u5e94\u662f\u4e0d\u540c\u7684\u3002\uff08\u5f52\u5e76\u6392\u5e8f\u590d\u6742\u5ea6\u662f $O(\u957f\u5ea6)$ \u7684\uff09\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u7ebf\u6bb5\u6811\u4e0a\u7684\u4e00\u5c42\uff0c\u6700\u591a\u5c31\u4f1a\u7ef4\u62a4 $O(n)$ \u4e2a\u4fe1\u606f\uff08\u6307\u7684\u662f\u8fd9\u4e00\u6574\u5c42\u7684\u6240\u6709\u4fe1\u606f\uff09\u3002\u6240\u4ee5\u7ef4\u62a4\u7684\u4fe1\u606f\u7684\u4e2a\u6570\u5c31\u662f $O(n\\log n)$ \u7684\u3002\n\n\u6216\u8005\u8bf4\u6362\u4e2a\u60f3\u6cd5\uff1a\u5bf9\u4e8e\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\uff0c\u4ed6\u6700\u591a\u5411\u4e0a\u4e0a\u4f20 $\\log$ \u6b21\uff0c\u6240\u4ee5\u6700\u591a\u4f1a\u6709 $\\log$ \u4e2a\u8282\u70b9\u5e26\u6709\u4ed6\u7684\u4fe1\u606f\u3002\u6240\u4ee5\u6700\u591a\u4f1a\u6709 $n\\log n$ \u4e2a\u4fe1\u606f\u3002\n\n\u81f3\u4e8e\u67e5\u8be2\u64cd\u4f5c\uff0c\u5176\u5b9e\u5c31\u628a\u7ebf\u6bb5\u6811\u4e0a\u7684 $\\log$ \u4e2a\u533a\u95f4\uff0c\u6311\u51fa\u6765\u8981\u6c42\u9ad8\u5ea6\u7684\u5e95\u4e0b\u6700\u9ad8\u7684\u90a3\u4e2a\u9ad8\u5ea6\u7684\u4fe1\u606f\u5373\u53ef\uff0c\u7136\u540e\u5408\u5e76\u8fd9 $\\log$ \u4e2a\u4fe1\u606f\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u81f3\u4e8e\u63d2\u5165\u64cd\u4f5c\uff0c\u63d0\u524d\u628a\u7ebf\u6bb5\u6811\u7684\u5927\u5c0f\u5f00\u6210\u662f $n+m$ \u7684\uff0c\u628a\u4f4d\u7f6e\u7ed9\u4ed6\u9884\u7559\u51fa\u6765\uff0c\u4e4b\u540e\u6bcf\u6b21\u4fee\u6539\u4e00\u4e2a\u4f4d\u7f6e\u518d\u4e0a\u4f20\u4e00\u4e2a\u6807\u8bb0\u3002\n\n\u5176\u5b9e\u5982\u679c\u4ed4\u7ec6\u60f3\u60f3\uff0c\u5982\u679c\u8bf4\u5bf9\u6bcf\u6b21\u7684\u4fee\u6539\uff0c\u56de\u6eaf\u65f6\u90fd\u8981\u628a\u8def\u5f84\u4e0a\u7684 $\\log$ \u4e2a\u8282\u70b9\u90fd\u8fdb\u884c\u4e00\u6b21pushup\uff0c\u5c31\u4f1a\u53d1\u73b0\u8fd9\u6837\u76f4\u63a5\u4e0a\u4f20\u6807\u8bb0\u7684\u590d\u6742\u5ea6\u4e5f\u662f\u4e0d\u5bf9\u7684\uff0c\u5230\u4e86 $O(n)$ \u7684\u7ea7\u522b\u3002~~\u771f\u65e0\u8bed\u4f4f\u4e86\uff0c\u4e00\u4e2a\u9898\uff0c\u5168\u662f\u5751~~\n\n\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u4e0d\u7528\u4e0a\u4f20\u7528\u4e0d\u5230\u7684\u8282\u70b9\u7684\u4fe1\u606f\u3002\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u8bf4\u67d0\u6b21\u4ece\u6700\u540e\u63d2\u5165\u4e00\u4e2a\u503c\uff0c\u8fd9\u4e2a\u4f4d\u7f6e\u662f\u7ebf\u6bb5\u6811\u4e0a\u67d0\u51e0\u4e2a\u533a\u95f4\u7684\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u90a3\u4e48\u6211\u4eec\u624d\u9700\u8981\u628a\u8fd9\u4e2a\u8282\u70b9\u7684\u4fe1\u606f\u4e0a\u4f20\uff0c\u5426\u5219\u4ed6\u4e00\u5b9a\u4e0d\u4f1a\u626b\u5230\u8fd9\u4e2a\u8282\u70b9\uff0c\u4e00\u5b9a\u4f1a\u5411\u4e0b\u9012\u5f52\uff0c\u6240\u6709\u5c31\u53ef\u4ee5\u4e0d\u7528\u7ba1\u8fd9\u4e2a\u5177\u4f53\u4fe1\u606f\u4e86\u3002\n\n\u8fd9\u4e48\u4fee\u6539\u590d\u6742\u5ea6\u5747\u644a\u4e00\u4e0b\u5c31\u663e\u7136\u662f\u6b63\u786e\u7684\u4e86\u3002\n\n\u5177\u4f53\u590d\u6742\u5ea6\u6ca1\u7b97\u8fc7\uff0c\u53cd\u6b63\u6700\u591a\u4fe9log\uff0c\u80af\u5b9a\u8d85\u4e0d\u8fc7\u53bb\u3002~~\u6700\u591a\u5e38\u6570\u5927\u70b9\uff1f~~\n\n\u5177\u4f53\u5b9e\u73b0\u7684\u8bdd\uff0c\u5bf9\u7ebf\u6bb5\u6811\u4e0a\u6bcf\u4e2a\u8282\u70b9\u5f00\u4e2avector\u4fdd\u5b58\u4fe1\u606f\u5c31\u597d\u4e86\uff1f\n\n\u7a7a\u95f4\u5e38\u6570\u8fd8\u662f\u5f88\u5c0f\u7684\uff0c\u867d\u7136\u6b63\u89e3\u7684\u505a\u6cd5\u5361\u7a7a\u95f4\uff0c\u4f46\u8fd9\u4e2a\u4e0d\u5361/doge\u3002\u968f\u4fbf\u5199\u5199\uff0c\u4e0d\u7528\u5361\u7a7a\u95f4\u5c31\u80fd\u8fc7\u3002\n\nCode:\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <vector>\n#include <bits/stdc++.h> \nusing namespace std ;\n\nconst int N = 1000005 ;\nint n , m , k , lans , now , a[N] ;\n\nstruct Node\n{\n\tint h , s , l , r ;\n\tNode ( int _h = 0 , int _s = 0 , int _l = 0 , int _r = 0 ) :\n\t\th ( _h ) , s ( _s ) , l ( _l ) , r ( _r ) { }\n\tfriend bool operator < ( Node u , Node v )\n\t{\n\t\treturn u .h < v .h ;\n\t}\n} ;\n\nvector < Node > t[N<<2] ;\n#define IT vector<Node>::iterator\n\nvoid pushup ( int k , int l , int r )\n{\n\tIT itl = t [ k << 1 ] .begin ( ) , itr = t [ k << 1 | 1 ] .begin ( ) ;\n//\tcout << \" pushup : \" << l << \" - \" << r << endl ;\n\twhile ( itl != t [ k << 1 ] .end ( ) && itr != t [ k << 1 | 1 ] .end ( ) )\n\t{\n\t\tif ( itl -> h <= itr -> h )\n\t\t{\n\t\t\tif ( itl -> h != itr -> h )\n\t\t\t{\n\t\t\t\tif ( itr == t [ k << 1 | 1 ] .begin ( ) )\n\t\t\t\t{\n\t\t\t\t\tt [ k ] .push_back ( Node ( itl -> h , itl -> s , itl -> l , itl -> r ) ) ;\n\t\t\t\t\t++ itl ;\n\t\t\t\t\tcontinue ;\n\t\t\t\t}\n\t\t\t\t-- itr ;\n\t\t\t}\n\t\t\tif ( itl -> r == itr -> l )\n\t\t\t\tt [ k ] .push_back ( Node ( itl -> h , itl -> s + itr -> s - 1 , itl -> l , itr -> r ) ) ;\n\t\t\telse\n\t\t\t\tt [ k ] .push_back ( Node ( itl -> h , itl -> s + itr -> s , itl -> l , itr -> r ) ) ;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif ( itl == t [ k << 1 ] .begin ( ) )\n\t\t\t{\n\t\t\t\tt [ k ] .push_back ( Node ( itr -> h , itr -> s , itr -> l , itr -> r ) ) ;\n\t\t\t\t++ itr ;\n\t\t\t\tcontinue ;\n\t\t\t}\n\t\t\t-- itl ;\n\t\t\tif ( itl -> r == itr -> l )\n\t\t\t\tt [ k ] .push_back ( Node ( itr -> h , itl -> s + itr -> s - 1 , itl -> l , itr -> r ) ) ;\n\t\t\telse\n\t\t\t\tt [ k ] .push_back ( Node ( itr -> h , itl -> s + itr -> s , itl -> l , itr -> r ) ) ;\n\t\t}\n\t\t++ itl ;\n\t\t++ itr ;\n\t}\n\tif ( itl != t [ k << 1 ] .end ( ) )\n\t{\n\t\t-- itr ;\n\t\twhile ( itl != t [ k << 1 ] .end ( ) )\n\t\t\tt [ k ] .push_back ( Node ( itl -> h , itl -> s + itr -> s - ( itl -> r == itr -> l ) , itl -> l , itr -> r ) ) , ++ itl ;\n\t}\n\telse if ( itr != t [ k << 1 | 1 ] .end ( ) )\n\t{\n\t\t-- itl ;\n\t\twhile ( itr != t [ k << 1 | 1 ] .end ( ) )\n\t\t\tt [ k ] .push_back ( Node ( itr -> h , itl -> s + itr -> s - ( itl -> r == itr -> l ) , itl -> l , itr -> r ) ) , ++ itr ;\n\t}\n}\n\nvoid change ( int k , int l , int r , int x , int y , int z )\n{\n\tif ( l == r )\n\t{\n\t\tt [ k ] .push_back ( Node ( z , 1 , y , y ) ) ;\n\t\treturn ;\n\t}\n\tint mid = ( l + r ) >> 1 ;\n\tif ( x <= mid )\n\t\tchange ( k << 1 , l , mid , x , y , z ) ;\n\telse\n\t\tchange ( k << 1 | 1 , mid + 1 , r , x , y , z ) ;\n\tif ( x == r )\n\t\tpushup ( k , l , r ) ;\n}\n\nstruct Leaf\n{\n\tint s , l , r ;\n\tLeaf ( int _s = 0 , int _l = 0 , int _r = 0 ) : s ( _s ) , l ( _l ) , r ( _r ) { }\n} ;\n\nLeaf query ( int k , int l , int r , int x , int y , int z )\n{\n\tif ( x <= l && r <= y )\n\t{\n\t\tif ( z < t [ k ] [ 0 ] .h )\n\t\t{\n//\t\t\tcout << \" query : \" << l << \" - \" << r << \" : res ( 0 , 0 , 0 ) \" << endl ;\n\t\t\treturn Leaf ( 0 , 0 , 0 ) ;\n\t\t}\n\t\tIT it = upper_bound ( t [ k ] .begin ( ) , t [ k ] .end ( ) , Node ( z ) ) ;\n\t\t-- it ;\n//\t\tcout << \" query : \" << l << \" - \" << r << \" : res ( \" << it -> s << \" , \" << it -> l << \" , \" << it -> r << \" )\" << endl ;\n\t\treturn Leaf ( it -> s , it -> l , it -> r ) ;\n\t}\n\tint mid = ( l + r ) >> 1 ;\n\tif ( y <= mid )\n\t{\n//\t\tLeaf res = query ( k << 1 , l , mid , x , y , z ) ;\n//\t\tcout << \" query : \" << l << \" - \" << r << \" : res ( \" << res .s << \" , \" << res .l << \" , \" << res .r << \" )\" << endl ;\n//\t\treturn res ;\n\t\treturn query ( k << 1 , l , mid , x , y , z ) ;\n\t}\n\tif ( x > mid )\n\t{\n//\t\tLeaf res = query ( k << 1 | 1 , mid + 1 , r , x , y , z ) ;\n//\t\tcout << \" query : \" << l << \" - \" << r << \" : res ( \" << res .s << \" , \" << res .l << \" , \" << res .r << \" )\" << endl ;\n//\t\treturn res ;\n\t\treturn query ( k << 1 | 1 , mid + 1 , r , x , y , z ) ;\n\t}\n\tLeaf res1 , res2 ;\n\tres1 = query ( k << 1 , l , mid , x , y , z ) ;\n\tres2 = query ( k << 1 | 1 , mid + 1 , r , x , y , z ) ;\n//\tcout << \" query : \" << l << \" - \" << r << \" : \" ;\n//\tcout << \" res1 : ( \" << res1 .s << \" , \" << res1 .l << \" , \" << res1 .r << \" ) , \" ;\n//\tcout << \" res2 : ( \" << res2 .s << \" , \" << res2 .l << \" , \" << res2 .r << \" ) \" << endl ;\n\tif ( res1 .s == 0 )\n\t\treturn Leaf ( res2 .s , res2 .l , res2 .r ) ;\n\tif ( res2 .s == 0 )\n\t\treturn Leaf ( res1 .s , res1 .l , res1 .r ) ;\n\treturn Leaf ( res1 .s + res2 .s - ( res1 .r == res2 .l ) , res1 .l , res2 .r ) ;\n}\n\nvoid dfs ( int k , int l , int r )\n{\n\tint siz = t [ k ] .size ( ) ;\n\tif ( siz )\n\t{\n\t\tcout << \" dfs : \" << l << \" - \" << r << endl ;\n\t\tfor ( int i = 0 ; i < siz ; ++ i )\n\t\t\tcout << t [ k ] [ i ] .h << \" : \" << t [ k ] [ i ] .s << \" , \" << t [ k ] [ i ] .l << \" - \" << t [ k ] [ i ] .r << endl ;\n\t\tcout << endl ;\n\t}\n\tif ( l == r )\n\t\treturn ;\n\tint mid = ( l + r ) >> 1 ;\n\tdfs ( k << 1 , l , mid ) ;\n\tdfs ( k << 1 | 1 , mid + 1 , r ) ;\n}\n\nint main ( )\n{\n\tcin >> n >> m >> k ;\n\tfor ( int i = 1 ; i <= n ; ++ i )\n\t{\n\t\tcin >> a [ i ] ;\n\t}\n\tfor ( int i = 1 ; i <= n ; ++ i )\n\t{\n\t\tint x ;\n\t\tcin >> x ;\n\t\tchange ( 1 , 1 , n + m , i , x , a [ i ] ) ;\n\t}\n\tnow = n ;\n\tn += m ;\n//\tdfs ( 1 , 1 , n ) ;\n\tfor ( int i = 1 ; i <= m ; ++ i )\n\t{\n\t\tint op , x , y ;\n\t\tcin >> op >> x >> y ;\n\t\tx = x ^ ( k * lans ) ;\n\t\ty = y ^ ( k * lans ) ;\n\t\tif ( op == 1 )\n\t\t{\n\t\t\tint z ;\n\t\t\tcin >> z ;\n\t\t\tz = z ^ ( k * lans ) ;\n\t\t\tcout << ( lans = query ( 1 , 1 , n , x , y , z ) .s ) << endl ;\n//\t\t\tif ( x == 4 && y == 6 )\n//\t\t\t\tdfs ( 1 , 1 , n ) ;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tchange ( 1 , 1 , n , ++ now , y , x ) ;\n\t\t}\n//\t\tdfs ( 1 , 1 , n ) ;\n\t}\n\treturn 0 ;\n}\n```\n\n~~\u7801\u98ce\u6709\u70b9\u9b3c\u755c\uff0c\u8bf7\u8c28\u614e\u4f7f\u7528\uff1f~~",
        "postTime": 1657105363,
        "uid": 68882,
        "name": "\u7075\u534e",
        "ccfLevel": 6,
        "title": "P7707 \u767e\u82b1\u9f50\u653e\u7684\u592a\u9633\u82b1\u7530 \u9898\u89e3"
    },
    {
        "content": "- Subtask 1\n\n  \u76f4\u63a5 $O(nm)$ \u66b4\u529b\n  \n- Subtask 2\n\n  \u663e\u7136\u5982\u679c\u6ca1\u6709\u5f3a\u5236\u5728\u7ebf\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8fdb\u884c\u5b8c\u6240\u6709\u64cd\u4f5c\u4e8c\u540e\u518d\u5904\u7406\u67e5\u8be2\n  \n  \u7136\u540e\u6211\u4eec\u6309\u7167 $a_i$ \u8fdb\u884c\u6392\u5e8f\uff0c\u6309 $a_i$ \u4ece\u5c0f\u5230\u5927\u52a0\u5165\u6bcf\u4e2a $b_i$\uff0c\u4f7f\u7528\u7ebf\u6bb5\u6811\u52a8\u6001\u7ef4\u62a4\u6bcf\u6b21\u52a0\u5165\u540e\u5e8f\u5217\u7684\u989c\u8272\u6bb5\u4fe1\u606f\n  \n  \u7136\u540e\u5bf9\u67e5\u8be2\u6309\u7167 $x$ \u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff0c\u5904\u7406 $x = a_i$ \u7684\u67e5\u8be2\u5373\u53ef\n  \n- Subtask 3\n\n  \u56e0\u4e3a\u4fee\u6539\u64cd\u4f5c\u5f88\u795e\u5947\uff0c\u662f\u5728\u672b\u5c3e\u63d2\u5165\uff0c\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u7ef4\u62a4\u524d\u7f00\u4fe1\u606f\n  \n  \u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u524d\u7f00 $[1,i]$\uff0c\u52a8\u6001\u7ef4\u62a4\u6240\u6709 $x$ \u7684\u7b54\u6848\n  \n  \u8003\u8651\u5982\u4f55\u7531 $[1,i - 1]$ \u63a8\u53ca $[1,i]$\uff1a\u52a0\u5165 $a_i$ \u7684\u4fe1\u606f\uff0c\u53ea\u4f1a\u4f7f $x \\ge a_i$\uff0c\u4e14 $lst_x \\neq b_i$ \u7684 $x$ \u7b54\u6848\u589e\u52a0 $1$\uff0c$lst$ \u662f\u6211\u4eec\u7ef4\u62a4\u7684\u6bcf\u4e2a $x$ \u5bf9\u5e94\u7684\u6700\u540e\u4e00\u4e2a\u989c\u8272\u7684\u503c\n  \n  \u4e4d\u4e00\u770b\u5982\u679c\u8981\u7ef4\u62a4\uff0c\u590d\u6742\u5ea6\u4f1a\u76f8\u5f53\u9ad8\u3002\u4f46\u662f\u5728\u8fdb\u884c\u5b8c\u8fd9\u6b21\u64cd\u4f5c\u540e\uff0c\u6240\u6709 $x \\ge a_i$ \u7684 $lst_x$ \u90fd\u4f1a\u53d8\u4e3a $b_i$\uff0c\u8fd9\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u989c\u8272\u6bb5\u5747\u644a\n  \n  \u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u5c06 $lst$ \u76f8\u540c\u7684\u4e00\u4e9b\u8fde\u7eed\u7684 $x$ \u7f29\u6210\u4e00\u4e2a\u6bb5\uff0c\u653e\u5230\u4e00\u4e2a set \u91cc\uff0c\u6bcf\u6b21\u5728\u672b\u5c3e\u63d2\u5165\u65f6\uff0c\u904d\u5386\u6240\u6709\u6d89\u53ca\u7684\u6bb5\uff0c\u770b\u662f\u5426\u9700\u8981\u7ed9\u8fd9\u4e00\u6bb5\u7684 $x$ \u7b54\u6848 +1\uff0c\u6700\u540e\u5220\u6389\u6240\u6709\u6d89\u53ca\u7684\u6bb5\uff0c\u653e\u5165\u4e00\u4e2a\u5927\u6bb5\u5373\u53ef\n  \n  \u7ed9\u8fd9\u4e00\u6bb5 $x$ \u7b54\u6848 + 1 \u7684\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811\uff0c\u5148\u8ba9 $[1,i]$ \u7684\u7b54\u6848\u7ee7\u627f $[1,i - 1]$ \u7684\u4fe1\u606f\uff0c\u7136\u540e\u7ed9\u9700\u8981 +1 \u7684\u90a3\u4e9b\u6bb5\u8fdb\u884c\u533a\u95f4\u52a0\u64cd\u4f5c\n  \n  \u8fd9\u6837\u67e5\u8be2\u5c31\u662f\u4e00\u4e2a\u5355\u70b9\u67e5\u8be2\n  \n  \u5b9e\u9645\u4e0a\u6ca1\u6709\u5fc5\u8981\u771f\u7684\u5199\u533a\u95f4\u52a0\uff0c\u5355\u70b9\u67e5\u8be2\uff0c\u53ef\u4ee5\u901a\u8fc7\u5dee\u5206\u652f\u6301\u5355\u70b9\u52a0\uff0c\u533a\u95f4\u6c42\u548c\n  \n- Subtask 4\n\n  \u7ed9\u4e00\u4e9b $O(m \\log^2 n)$ \u6216 $O(m \\sqrt n)$ \u7684\u89e3\u6cd5\n  \n- Subtask 5\n\n  \u533a\u95f4\u989c\u8272\u6bb5\u6570\u5b9e\u9645\u4e0a\u5177\u6709\u4e00\u5b9a\u7684\u53ef\u51cf\u6027\uff0c$[l,r]$ \u7684\u7b54\u6848\u76f8\u5f53\u4e8e $[1,r] - [1,l - 1] + [lst = fst]$\uff0c$lst$ \u8868\u793a $[1,l - 1]$ \u4e2d\u6700\u540e\u4e00\u4e2a $a_i \\le x$ \u7684 $b_i$\uff0c$fst$ \u8868\u793a $[l,r]$ \u4e2d\u7b2c\u4e00\u4e2a $a_i \\le x$ \u7684 $b_i$\n  \n  \u90a3\u4e48\u53ea\u8981\u80fd\u591f\u627e\u5230 $lst,fst$ \u5c31\u89e3\u51b3\u95ee\u9898\u4e86\n  \n  \u6211\u4eec\u53ef\u4ee5\u5199\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u7ef4\u62a4 $a_i$ \u7684\u533a\u95f4 $\\min$\uff0c\u7136\u540e\u4ece $l$ \u5206\u522b\u5411\u5de6\uff0c\u5411\u53f3\u4e8c\u5206\uff0c\u5c31\u53ef\u4ee5\u627e\u5230\u7b2c\u4e00\u4e2a $a_i \\le x$ \u7684\u4f4d\u7f6e\n  \n  \u56e0\u4e3a\u4e8c\u5206\u6709\u4e00\u4e2a $\\log$\uff0c\u6240\u4ee5\u8981\u652f\u6301 $O(1)$ \u67e5\u8be2\u624d\u80fd\u4fdd\u8bc1\u590d\u6742\u5ea6\uff0c\u56e0\u4e3a\u53ea\u5728\u672b\u5c3e\u63d2\u5165\uff0c\u53ef\u4ee5\u4f7f\u7528 ST \u8868\uff0c$ST_{i,j}$ \u7ef4\u62a4 $[j - 2^i + 1,j]$ \u7684 $\\min$\uff08\u8fd9\u4e2a\u4e1c\u897f\u8c8c\u4f3c\u6709\u4e9b\u4eba\u53eb\u505a\u52a8\u6001ST\u8868\uff09\n  \n  \u5f53\u7136\u4f60\u5199\u4e2a\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u4e4b\u7c7b\u4e5f\u662f\u53ef\u4ee5\u7684\n  \n  \u7efc\u4e0a\uff0c\u8fd9\u662f\u4e00\u4e2a\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O((n' + m) \\log n)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(n' \\log n)$ \u7684\u7b97\u6cd5\n  \n- Subtask 6\n\n  \u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u7a7a\u95f4\u5e38\u6570\n  \n  \u9996\u5148\uff0c\u52a0\u5165 $i$ \u7684\u4fe1\u606f\u4f1a\u589e\u52a0 $1$ \u4e2a\u989c\u8272\u6bb5\uff0c\u56e0\u6b64\u4e00\u5171\u4f1a\u6709 $n'$ \u4e2a\u989c\u8272\u6bb5\uff0c\u6bcf\u4e2a\u989c\u8272\u6bb5\u53ef\u80fd\u5f15\u8d77\u4e24\u6b21\u5355\u70b9\u4fee\u6539\n  \n  \u800c\u52a0\u5165 $i$ \u7684\u4fe1\u606f\u9700\u8981\u4e00\u6b21\u5355\u70b9\u4fee\u6539\uff0c\u4e8e\u662f\u4f60\u4e00\u5171\u9700\u8981 $3n'$ \u6b21\u5355\u70b9\u4fee\u6539\n  \n  \uff08\u5982\u679c\u4f60\u5b9e\u73b0\u4e0d\u592a\u597d\uff0c\u5206\u88c2 $a_i$ \u6240\u5728\u6bb5\u5f97\u5230\u7684\u540e\u534a\u90e8\u5206\u6070\u5de7 $lst = b_i$ \u7684\u8bdd\uff0c\u4f1a\u8fbe\u5230 $5n'$\uff09\n  \n  \u56e0\u6b64\u4f60\u9700\u8981 $4.5 \\times 10^7$ \u4e2a\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u9700\u8981\u4e09\u4e2a `int`\uff0c\u7136\u540e\u4f60\u6302\u4e86\n  \n  \u8003\u8651\u600e\u4e48\u4f18\u5316\uff0c\u9996\u5148\u53ef\u4ee5\u5408\u5e76\u76f8\u90bb\u540c\u8272\u989c\u8272\u6bb5\uff0c\u8fd9\u6837\u4f60\u63a8\u6389 $s$ \u4e2a\u6bb5\uff0c\u81f3\u591a\u53ea\u6709 $\\left \\lceil \\frac{s}{2} \\right \\rceil$ \u4e2a\u6bb5\u9700\u8981\u8fdb\u884c\u4e24\u6b21\u5355\u70b9\u4fee\u6539\uff0c\u4fee\u6539\u6570\u662f $s + 1$ \u7ea7\u522b\u7684\n  \n  \u4ec0\u4e48\u65f6\u5019\u80fd\u5361\u5230 $s + 1$ \u5462\uff1f\u7b54\u6848\u662f\u5f00\u5934\u4e0e\u7ed3\u5c3e\u90fd\u662f $lst = y$ \u7684\u60c5\u51b5\uff0c\u7279\u5224\u6389\u5f00\u5934\u5c31\u53ef\u4ee5\u4e86\n  \n  \u4e8e\u662f\u53ea\u8981 $2n'$ \u6b21\u5355\u70b9\u4fee\u6539\uff0c\u8fd9\u6837\u4f1a\u6709 $3.1 \\times 10^7$ \u4e2a\u8282\u70b9\n  \n  \u4f46\u662f\u8fd9\u6837\u4f60\u8fd8\u662f\u8fc7\u4e0d\u53bb\uff0c\u5927\u6982\u9700\u8981 343M \u7684\u6837\u5b50\n  \n  \u8003\u8651\u4e3b\u5e2d\u6811\u7684\u7ed3\u6784\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u7684\u6807\u53f7\u65b9\u5f0f\u662f\u5f00\u4e00\u4e2a $cnt$\uff0c\u6bcf\u6b21\u5206\u914d\u7b2c $cnt$ \u4e2a\u4f4d\u7f6e\u7684\u8bdd\uff0c\u4f60\u4f1a\u53d1\u73b0\u5bf9\u4e8e\u6811\u4e0a\u6bcf\u4e2a\u8282\u70b9 $rt$\uff0c\u5176\u5de6\u53f3\u513f\u5b50\u4e2d\uff0c\u5fc5\u5b9a\u6709\u4e00\u4e2a\u7684\u7f16\u53f7\u662f $rt + 1$\n  \n  \u4e8e\u662f\u6211\u4eec\u53ea\u5b58\u4e0d\u662f $rt + 1$ \u90a3\u4e2a\u4f4d\u7f6e\u7684\u7f16\u53f7 $x$\uff0c\u52a0\u4e00\u4f4d\u6807\u793a\u54ea\u4e2a\u513f\u5b50\u662f $rt + 1$\n  \n  \u5269\u4e0b\u5b58\u533a\u95f4\u548c\u662f\u65e0\u6cd5\u907f\u514d\u7684\uff0c\u8fd9\u6837\u7684\u4fe1\u606f\u91cf\u662f $5 \\times 10 ^ 5 \\times 3.1 \\times 10^7 \\times 2 = 3.1 \\times 10^{13} < 2^{48}$\n  \n  \u4e8e\u662f\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a `unsigned int` \u548c\u4e00\u4e2a `unsigned short` \u538b\u7f29\u5b58\u50a8\u4fe1\u606f\n  \n  \u5177\u4f53\u5206\u914d\uff1a`unsigned int` \u7684 $0 \\sim 24$ \u4f4d\u5b58\u50a8 $x$\uff0c\u7b2c $25$ \u4f4d\u662f\u6807\u793a\u7b26\uff0c$26 \\sim 30$ \u4f4d\u5b58 $val \\bmod 2^5$\uff0c$31$ \u4f4d\u5b58\u50a8 $val$ \u6b63\u8d1f\u6027\uff0c`unsigned short` \u5b58 $\\left \\lfloor \\dfrac{val}{2^5} \\right \\rfloor$ \n  \n  \u4e3b\u5e2d\u6811\u90e8\u5206\u9700\u8981 172M \u5de6\u53f3\uff0c\u5269\u4e0b\u7684\u6570\u7ec4\u7684\u7a7a\u95f4\u5f00\u9500\u5e76\u4e0d\u5927\n  \n  \u672c\u573a\u6bd4\u8d5b\u5e94\u8be5\u53ea\u6709\u8fd9\u4e2a Subtask \u7b97\u662f\u5361\u5e38\u7684",
        "postTime": 1622962726,
        "uid": 330759,
        "name": "\u56e7\u4ed9",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 \u3010SR2.7-T3\u3011\u3010\u767e\u82b1\u9f50\u653e\u7684\u592a\u9633\u82b1\u7530\u3011"
    },
    {
        "content": "#### \u524d\u8a00\uff1a\n\n\u8fd9\u7bc7\u9898\u89e3\u7684\u4e3b\u8981\u601d\u8def\u4e0e[\u56e7\u4ed9\u5927\u5927\u7684\u9898\u89e3](https://www.luogu.com.cn/blog/over-knee-socks/solution-Wdsr2o7-T3) \u4e00\u81f4\uff0c\u53ea\u4e0d\u8fc7\u8bb2\u7684\u66f4\u8be6\u7ec6\u4e00\u4e9b\u3002\n\n#### \u63d0\u524d\u8bf4\u660e\uff1a\n\n\u9898\u9762\u4e2d\u82b1\u7684\u79cd\u7c7b\u5728\u672c\u7bc7\u9898\u89e3\u4e2d\u79f0\u4f5c\u82b1\u7684\u989c\u8272\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u7406\u89e3\u5148\u8bf4\u660e\u4e00\u4e0b\u53d8\u91cf\u542b\u4e49\uff1a\n\n1. $n$ \u8868\u793a\u5f53\u524d\u5e8f\u5217\u957f\u5ea6\u3002\n2. $ht(i)$ \u8868\u793a\u7b2c $i$ \u6735\u82b1\u7684\u9ad8\u5ea6\u3002\n3. $ty(i)$ \u8868\u793a\u7b2c $i$ \u6735\u82b1\u7684\u989c\u8272\u3002\n4. $f(i,h)$ \u8868\u793a\u4ece\u524d $i$ \u6735\u82b1\u4e2d\u53d6\u51fa\u9ad8\u5ea6\u4e0d\u8d85\u8fc7 $h$ \u7684\u82b1\u5e76\u6392\u6210\u4e00\u5217\u540e\u7684\u4e0d\u540c\u989c\u8272\u6bb5\u7684\u4e2a\u6570\u3002\n5. $lst(i, h)$ \u8868\u793a\u524d $i$ \u6735\u82b1\u4e2d\u6700\u540e\u4e00\u6735\u9ad8\u5ea6\u4e0d\u8d85\u8fc7 $h$ \u7684\u82b1\u7684\u989c\u8272\u3002\n\n#### \u9898\u89e3\uff1a\n\n\u5219\u72b6\u6001\u7684\u8f6c\u79fb\u53ef\u4ee5\u8868\u793a\u6210\uff1a\n\n$$ f(i+1,h)=\\left\\{\n\n\\begin{aligned}\n\n& f(i,h) &(h < ht(i+1)) \\\\\n\n& f(i,h) + (ty(i+1) \\neq lst(i, h)) & (h \\geq ht(i+1))\\\\\n\n\\end{aligned}\n\n\\right.\n\n$$\n\n\u4ee5\u53ca\uff1a\n\n$$ lst(i+1,h) = \\left\\{\n\n\\begin{aligned}\n\n& lst(i,h) & (h < ht(i+1))\\\\\n\n& ty(i+1) & (h \\geq ht(i+1))\\\\\n\n\\end{aligned}\n\n\\right.\n\n$$\n\n\u6ce8\u610f\u6240\u6709 $h \\geq ht(i+1)$ \u7684 $lst$ \u503c\u90fd\u88ab\u66f4\u65b0\u4e3a\u4e86\u540c\u4e00\u503c\u3002\n\n\u8003\u8651\u5982\u4f55\u56de\u7b54\u67e5\u8be2 $1$ $l$ $r$ $h$\u3002\n\n\u4e0d\u59a8\u5148\u5047\u8bbe $ht(l) \\leq h$\uff0c\u5426\u5219\u5c31\u5148\u5728\u95ed\u533a\u95f4 $[l,r]$ \u4e2d\u5bfb\u627e\u5230\u6700\u5c0f\u7684 $l^\\prime$ \u4f7f\u5f97 $ht(l^\\prime) \\leq h $\uff0c\u7136\u540e\u8ba9 $l^\\prime$ \u4f5c\u4e3a\u65b0\u7684 $l$\uff0c\u6613\u77e5\u7b54\u6848\u4e0d\u53d8\u3002\n\n$l^\\prime$ \u53ef\u4ee5\u7528\u4e8c\u5206 + $\\text{st}$ \u8868\u5b9e\u73b0 $O(\\log n)$ \u67e5\u627e\u3002\n\n\u56e0\u4e3a\u989c\u8272\u6bb5\u6570\u5177\u5907\u4e00\u5b9a\u7684\u53ef\u51cf\u6027\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u524d\u7f00\u548c\u76f8\u51cf\uff0c\u7136\u540e\u518d\u52a0\u4e0a\u4e00\u4e2a\u4fee\u6b63\u56e0\u5b50\u5f97\u5230\u7b54\u6848\uff0c\u5219\u672c\u6b21\u67e5\u8be2\u7684\u7b54\u6848\u4e3a\uff1a\n\n$ f(r,h) - f(l-1,h) + (lst(l-1,h)==ty(l))$\n\n$lst(l-1,h)$ \u4e5f\u53ef\u4ee5\u7528\u4e8c\u5206 + $\\text{st}$ \u8868\u5b9e\u73b0 $O(\\log n)$ \u67e5\u627e\u3002\n\n\u6240\u4ee5\u63a5\u4e0b\u6765\u53ea\u9700\u8981\u8003\u8651\u5982\u4f55\u7ef4\u62a4 $f(i,h)$ \u548c $lst(i,h)$\u4e86\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5f00\u4e00\u4e2a\u4e3b\u5e2d\u6811\uff0c\u5bf9\u6bcf\u4e00\u4e2a\u7248\u672c $f_i$ \u7ef4\u62a4\u4e00\u9897\u503c\u57df\u4e3a $[1,10^9]$ \u7684\u7ebf\u6bb5\u6811\uff0c\u8bbe $f_i(h)$ \u8868\u793a\u7b2c $i$ \u9897\u7ebf\u6bb5\u6811\u4e0a\u7b2c $h$ \u4e2a\u4f4d\u7f6e\u7684\u503c\uff0c\u5219\u8fd9\u91cc\u7ebf\u6bb5\u6811\u4e0a\u503c $f_i(h)$ \u7684\u610f\u4e49\u5c31\u662f $f(i,h)$\u3002\n\n\u5f53\u6211\u4eec\u52a0\u5165\u7b2c $i+1$ \u6735\u82b1\u65f6\uff0c\u4f1a\u4f7f\u5168\u90e8 $h \\geq ht(i+1)$ \u7684 $lst$ \u66f4\u65b0\u4e3a $ty(i+1)$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u7528\u5355\u8c03\u6808\u52a8\u6001\u7ef4\u62a4\u6bcf\u4e2a\u65f6\u523b $i$ \u7684\u6240\u6709\u7684 $lst(i,h)$\uff0c\u5355\u8c03\u6808\u91cc\u4fdd\u5b58\u7684\u662f\u6bcf\u6bb5 $h$ \u8fde\u7eed\u7684 $lst$\uff0c\u4e14\u540c\u4e00\u6bb5\u4e2d $lst$ \u7684\u503c\uff08\u4e5f\u5373\u989c\u8272\uff09\u90fd\u76f8\u540c\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u662f\u5bf9\u6808\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20 $stk(j)$\uff0c\u7ef4\u62a4\u4e09\u4e2a\u53d8\u91cf $low_j$ $high_j$ \u548c $type_j$\uff0c\u8868\u793a\u6240\u6709 $low_j \\leq h \\leq high_j$ \u7684 $lst(i,h)$ \u90fd\u7b49\u4e8e $type_j$\u3002\n\n\u6808\u4e2d\u4efb\u610f\u76f8\u90bb\u5143\u7d20 $stk(i)$ \u548c $stk(i+1)$ \u5747\u6ee1\u8db3\uff0c$high_i + 1= low_{i+1}$\u3002\n\n\u4e14\u6808\u5e95\u5143\u7d20 $stk_1$ \u6ee1\u8db3 $low_1 = 1$\uff0c\u6808\u9876\u5143\u7d20 $stk_{top}$ \u6ee1\u8db3 $high_{top} = 10^9$\uff0c\u5206\u522b\u4ee3\u8868\u6700\u4f4e\u9ad8\u5ea6\u548c\u6700\u9ad8\u9ad8\u5ea6\u3002 \n\n\u5355\u8c03\u6808\u7684\u56fe\u793a\u5982\u4e0b\uff1a\n\n![illustration](https://cdn.luogu.com.cn/upload/image_hosting/7f3ua84r.png)\n\n\u4e00\u5f00\u59cb\uff08\u6ca1\u6709\u52a0\u5165\u4efb\u4f55\u82b1\u7684\u65f6\u5019\uff09\u5355\u8c03\u6808\u53ea\u6709\u4e00\u4e2a\u5143\u7d20 $stk(1)$\u3002\n\n\u4e14\u6709 $low_1 = 1$\uff0c$high_1 = 10^9$ \u4ee5\u53ca $type_1 = 0$\uff0c\u6ce8\u610f\u5230\u9898\u76ee\u4e2d\u989c\u8272\u7684\u6570\u636e\u8303\u56f4\u662f $1 \\leq t_i \\leq 10^9$\uff0c$type_1 = 0$ \u4e0d\u4f1a\u4e0e\u4efb\u4f55\u989c\u8272\u51b2\u7a81\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u52a0\u5165\u4e00\u6735\u82b1\u65f6\u5982\u4f55\u5bf9\u4e3b\u5e2d\u6811\u548c\u5355\u8c03\u6808\u4fee\u6539\u4ee5\u7ef4\u62a4 $f(i,h)$ \u548c $lst(i,h)$\u3002\n\n\u5f53\u6211\u4eec\u52a0\u5165\u7b2c $i+1$ \u6735\u82b1\u65f6\uff0c\u9010\u4e2a\u5f39\u51fa\u6808\u9876\u5143\u7d20\u3002\n\n\u8bbe\u63a5\u4e0b\u6765 $stk(top)$ \u59cb\u7ec8\u8868\u793a\u5f53\u524d\u7684\u6808\u9876\u5143\u7d20\u3002\n\n\u82e5 $type_{top} \\neq ty(i+1)$\uff0c\u5219\u5bf9\u7248\u672c\u4e3a $f_{i+1}$ \u7684\u7ebf\u6bb5\u6811\u505a\u4e00\u6b21\u533a\u95f4\u52a0\uff0c\u5373\u5728\u7248\u672c $f_i$ \u7684\u57fa\u7840\u4e0a\u8ba9\u6240\u6709 $low_{top} \\leq h \\leq high_{top}$ \u7684 $f_{i+1}(h)$ \u5747\u52a0 $1$\u3002\n\n\u82e5 $type_{top} = ty(i+1) $\uff0c\u5219\u4e0d\u8fdb\u884c\u533a\u95f4\u52a0\u3002\n\n\u8fd9\u5c31\u76f8\u5f53\u4e8e\u8fdb\u884c\u4e86 $f(i+1,h)$ \u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u4e2d\u7684\u7b2c\u4e8c\u884c\u8f6c\u79fb\u3002\n\n\u5f39\u51fa\u6808\u9876\u76f4\u5230 $ht(i+1) \\geq low_{top}$ \u65f6\u624d\u505c\u6b62\uff0c\u56e0\u4e3a\u5bf9\u4e8e $h < ht(i+1)$ \u7684 $f(i+1,h)$ \u548c $lst(i+1,h)$ \u4e0d\u4f1a\u88ab\u66f4\u65b0\u3002\n\n\u5e76\u8ba9\u6240\u6709 $ht(i+1) \\leq h \\leq high_{top}$ \u7684 $f_{i+1}(h)$ \u5747\u52a0 $1$\u3002\n\n\u7136\u540e\u82e5 $ht(i+1) > low_{top}$\uff0c\u5219\u5c06 $high_{top}$ \u4fee\u6539\u6210 $ht(i+1)-1$\uff0c$stk(top)$ \u7684\u5176\u5b83\u4e24\u9879\u4e0d\u53d8\uff0c\u4ee3\u8868\u8fd9\u4e00\u6bb5\u7684 $lst$ \u4ece\u4e2d\u95f4\u88ab\u5207\u65ad\u4e86\u3002\n\n\u5426\u5219 $ht(i+1) = low_{top}$\uff0c\u5c06 $stk(top)$ \u4e5f\u5f39\u51fa\uff0c\u4ee3\u8868\u8fd9\u4e00\u6bb5 $lst$ \u90fd\u4f1a\u88ab\u66f4\u65b0\u3002\n\n\u7136\u540e\u518d\u5165\u6808\u4e00\u4e2a\u65b0\u5143\u7d20 $stk(top+1)$\uff0c\u6ee1\u8db3 $low_{top+1} = ht(i+1)$\uff0c$high_{top+1} = 10^9$ \u4ee5\u53ca $type_{top+1} = ty(i+1)$\uff0c\u65b0\u5143\u7d20\u4ee3\u8868\u4e86\u65b0\u4e00\u6bb5\u7684 $lst$\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u5229\u7528\u4e3b\u5e2d\u6811\u548c\u5355\u8c03\u6808\u540c\u65f6\u7ef4\u62a4\u4e86 $f(i,h)$ \u548c $lst(i,h)$\u3002\n\n#### \u65f6\u95f4\u590d\u6742\u5ea6\uff1a\n\n\u8003\u8651\u4e00\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u6bcf\u52a0\u5165\u4e00\u6735\u82b1\u65f6\u6700\u591a\u4f7f\u5355\u8c03\u6808\u589e\u591a\u4e00\u4e2a\u5143\u7d20\uff0c\u6bcf\u4e2a\u5143\u7d20\u53ea\u6709\u5728\u88ab\u5f39\u51fa\u6216\u88ab\u5207\u65ad\u65f6\u624d\u4f1a\u5728\u4e3b\u5e2d\u6811\u4e0a\u8fdb\u884c\u533a\u95f4\u52a0\u64cd\u4f5c\uff0c\u6bcf\u6b21\u533a\u95f4\u52a0\u6700\u591a\u5f71\u54cd $O(\\log R)$ \u4e2a\u8282\u70b9\uff0c\u5176\u4e2d $R$ \u7ebf\u6bb5\u6811\u503c\u57df\uff08\u5728\u672c\u9898\u4e2d $R = 10^9$\uff09\uff0c \u6240\u4ee5\u4fee\u6539\u7684\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n\\log R)$\u3002\n\n\u6b64\u5916\u8fd8\u8981\u7528 $O(n\\log n)$ \u7ef4\u62a4\u4e00\u4e2a\u652f\u6301\u5728\u672b\u5c3e\u63d2\u5165\u5143\u7d20\u7684 $\\text{st}$ \u8868\u3002\n\n\u5bf9\u4e8e\u67e5\u8be2\u64cd\u4f5c\uff0c\u5219\u6d89\u53ca\u5230\u4e8c\u5206 + $\\text{st}$ \u8868\u7684\u67e5\u8be2\u548c\u5728\u4e3b\u5e2d\u6811\u4e0a\u7684\u5355\u70b9\u67e5\u8be2\uff0c\u8bbe\u67e5\u8be2\u6b21\u6570\u4e3a $q$\uff0c\u5219\u67e5\u8be2\u7684\u603b\u590d\u6742\u5ea6\u4e3a $O(q\\log R + q\\log n)$\u3002\n\n\u9898\u89e3\u4e2d\u8bf4\u7684\u4e3b\u5e2d\u6811\u8981\u652f\u6301\u533a\u95f4\u52a0\u548c\u5355\u70b9\u67e5\u8be2\uff0c\u4f46\u5b9e\u9645\u4e0a\u4e5f\u53ef\u4ee5\u5dee\u5206\u540e\u8f6c\u5316\u4e3a\u5355\u70b9\u52a0\u548c\u533a\u95f4\u6c42\u548c\uff0c\u4fee\u6539\u548c\u67e5\u8be2\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e0d\u53d8\u3002\n\n#### \u7ed3\u675f\uff1a\n\n\u5230\u8fd9\u91cc\u672c\u7bc7\u9898\u89e3\u5c31\u57fa\u672c\u7ed3\u675f\u4e86\uff0c\u5982\u679c\u4e0d\u8003\u8651\u5361\u7a7a\u95f4\uff0c\u6309\u4e0a\u9762\u7684\u601d\u8def\u5199\u4e00\u4efd\u4ee3\u7801\u4f1a\u6709 $90$ \u7684\u597d\u6210\u7ee9\uff0c\u5269\u4e0b\u90a3 $10$ \u5206\u56e7\u4ed9\u5927\u5927\u7684\u9898\u89e3\u91cc\u5199\u7684\u5f88\u6e05\u695a\uff0c\u672c\u7bc7\u9898\u89e3\u5c31\u4e0d\u8d58\u8ff0\u4e86\u3002\n\n![\u5206\u6570](https://cdn.luogu.com.cn/upload/image_hosting/6pzhyrvu.png)\n\n\u8d34\u4e00\u4efd\u4ee3\u7801\uff08\u4e0d\u8003\u8651\u5361\u7a7a\u95f4\u7684\u4ee3\u7801\uff09\uff1a\n\n\u4ee3\u7801\u4e2d\u4e3b\u5e2d\u6811\u652f\u6301\u7684\u662f\u5355\u70b9\u52a0\u548c\u533a\u95f4\u6c42\u548c\u64cd\u4f5c\u3002\n\n\u53ea\u7528\u4e86\u5e38\u91cf\u5b8f\u548c\u5faa\u73af\u5b8f\u3002\n\n```cpp\n#include <stdio.h>\n#include <algorithm>\nusing namespace std;\n\n#define re register\n#define _for(i, a, b) for(re int (i) = (a); (i) < (b); ++(i))\n#define _rfor(i, a, b) for(re int (i) = (a); (i) <= (b); ++(i))\n#define maxn 500005\n#define maxnn 30000005\n#define lbmaxn 25\n#define maxrg 1e9\n\nint rdnt(){\n\tregister int x = 0, sign = 1;\n\tregister char c = getchar();\n\twhile (c < '0' || c > '9') { if (c == '-') sign = -1; c = getchar(); }\n\twhile (c >= '0' && c <= '9') x = (x<<3) + (x<<1) + (c ^ 48), c = getchar();\n\treturn x * sign;\n}\n\nint \n\tn, //\u5f53\u524d\u82b1\u7684\u6735\u6570 \n\ttop = 0, //\u6808\u9876 \n\tstk[maxn][3], //\u5355\u8c03\u6808\uff1a\u4e09\u4e2a\u5143\u7d20\u5206\u522b\u4ee3\u8868 low high \u548c type \n\t\n\tlb[maxn], //\u4ee5\u4e8c\u4e3a\u5e95\u7684\u5bf9\u6570 \n\tst[lbmaxn][maxn], //st \u8868 \n\t\n\tht[maxn], //\u82b1\u7684\u9ad8\u5ea6 \n\tty[maxn], //\u82b1\u7684\u79cd\u7c7b \n\t\n\tncnt, //\u4e3b\u5e2d\u6811\u7684\u8282\u70b9\u6570 \n\trg, //\u7ebf\u6bb5\u6570\u7684\u503c\u57df \n\trt[maxn], //\u6bcf\u4e2a\u7248\u672c\u7ebf\u6bb5\u6811\u7684\u6839 \n\tlc[maxnn], //\u5de6\u513f\u5b50 \n\trc[maxnn], //\u53f3\u513f\u5b50 \n\tval[maxnn]; //\u503c \n\nvoid init(){\n\tlb[0] = -1;\n\t_rfor(i, 1, maxn-5) lb[i] = lb[i>>1]+1;\n\t\n\trg = maxrg;\n\tn = ncnt = val[0] = lc[0] = rc[0] = rt[0] = 0;\n\t\n\t//\u5355\u8c03\u6808\u7684\u521d\u59cb\u5316 \n\ttop = 1;\n\tstk[top][0] = 1; stk[top][1] = maxrg; stk[top][2] = 0;\n}\n\t\n///////\u4e3b\u5e2d\u6811\n\n//\u5f97\u5230\u4e00\u4e2a\u7ee7\u627f\u65e7\u8282\u70b9 x \u7684\u65b0\u8282\u70b9 \nint new_node(re int x){\n\t++ncnt;\n\tlc[ncnt] = lc[x]; rc[ncnt] = rc[x]; val[ncnt] = val[x];\n\treturn ncnt;\n}\n\n//\u5355\u70b9\u52a0 \nvoid add_point(re int x, re int p, re int dlt){\n\tre int tl = 1, tr = rg, mi, ox = x = rt[x];\n\twhile(tr > tl){\n\t\tmi = (tl+tr)>>1;\n\t\tval[x] += dlt;\n\t\tif (p <= mi){\n\t\t\tif (lc[x] < ox) lc[x] = new_node(lc[x]);\n\t\t\tx = lc[x], tr = mi;\n\t\t}\n\t\telse{\n\t\t\tif (rc[x] < ox) rc[x] = new_node(rc[x]);\n\t\t\tx = rc[x], tl = mi+1;\n\t\t}\n\t}\n\tval[x] += dlt;\n}\n\n//\u5dee\u5206\u540e\u5c06\u533a\u95f4\u52a0\u8f6c\u5316\u4e3a\u5355\u70b9\u52a0 \nvoid add(int x, int l, int r){\n\tadd_point(x, l, 1);\n\tif (r < rg) add_point(x, r+1, -1);\n}\n\n//\u5dee\u5206\u540e\u5c06\u5355\u70b9\u67e5\u8be2\u8f6c\u5316\u4e3a\u533a\u95f4\u6c42\u548c \nint qry(int x, int l, int r, int tl, int tr){\n\tif (!x) return 0;\n\tif (l == tl && r == tr) return val[x];\n\tint mi = (tl+tr)>>1;\n\tif (r <= mi) return qry(lc[x], l, r, tl, mi);\n\telse if (l > mi) return qry(rc[x], l, r, mi+1, tr);\n\telse return qry(lc[x], l, mi, tl, mi) + qry(rc[x], mi+1, r, mi+1, tr);\n}\n\n//\u5f97\u5230\u9898\u89e3\u4e2d\u8bf4\u7684 f(r,h) - f(l-1,h) \nint qry_seg(int l, int r, int h){\n\treturn qry(rt[r], 1, h, 1, rg) - qry(rt[l-1], 1, h, 1, rg);\n}\n\n//////\u4e3b\u5e2d\u6811\n\n//////st \u8868 \n\n//\u5728 st \u8868\u672b\u5c3e\u52a0\u5165\u5143\u7d20(\u82b1\u7684\u9ad8\u5ea6) \nvoid add_st(re int h){\n\tst[0][n+1] = h;\n\tre int lbn = lb[n+1], j;\n\t_rfor(i, 1, lbn){\n\t\tj = n+1-(1<<i)+1;\n\t\tst[i][j] = min(st[i-1][j], st[i-1][j+(1<<(i-1))]);\n\t}\n}\n\n//\u5bf9 st \u8868\u7684\u67e5\u8be2 \nint qry_st(re int l, re int r){\n\tre int lbl = lb[r-l+1];\n\treturn min(st[lbl][l], st[lbl][r-(1<<lbl)+1]);\n}\n//////st \u8868 \n\n//\u5f97\u5230\u9898\u89e3\u4e2d\u8bf4\u7684\u4fee\u6b63\u56e0\u5b50 (lst(l-1,h) == ty(l)) \nint qry_lst(re int l, re int r, re int h){\n\tre int le, ri, mi, t1, t2;\n\t//\u4e8c\u5206\u627e\u5230 l' \n\tle = l, ri = r+1, t1 = l-1;\n\twhile(ri > le){\n\t\tmi = (le+ri)>>1;\n\t\tif (qry_st(l, mi) > h) t1 = mi, le = mi+1;\n\t\telse ri = mi;\n\t}\n\t++t1;\n\t//\u82e5 l' \u4e0d\u5b58\u5728\u5219\u8fd4\u56de 0 \n\tif (t1 > r) return 0;\n\t\n\t//\u4e8c\u5206\u627e\u5230 lst(i-1,h) \n\tle = 1, ri = l, t2 = l;\n\twhile(ri > le){\n\t\tmi = (le+ri)>>1;\n\t\tif (qry_st(mi, l-1) > h) ri = t2 = mi;\n\t\telse le = mi+1;\n\t}\n\t--t2;\n\t\n\treturn (ty[t1] == ty[t2]);\n}\n\n//\u52a0\u5165\u65b0\u4e00\u6735\u82b1\n//\u4f20\u5165\u7684\u53c2\u6570 h \u4ee3\u8868\u65b0\u82b1\u7684\u9ad8\u5ea6\uff0ct \u4ee3\u8868\u65b0\u82b1\u7684\u989c\u8272 \nvoid add_flower(re int h, re int t){\n\tht[n+1] = h; ty[n+1] = t;\n\t\n\t//\u5728st \u8868\u672b\u5c3e\u52a0\u5165\u5143\u7d20 \n\tadd_st(h);\n\t\n\t//\u65b0\u7248\u672c\u7684\u7ebf\u6bb5\u6811\u7ee7\u627f\u65e7\u7248\u672c\u7684\u7ebf\u6bb5\u6570 \n\trt[n+1] = new_node(rt[n]);\n\t\n\tre int low, high, type;\n\t//\u4e0d\u65ad\u5f39\u51fa\u6808\u9876 \n\twhile(true){\n\t\tlow = stk[top][0]; high = stk[top][1]; type = stk[top][2];\n\t\tif (type != t) add(n+1, max(h, low), high);\n\t\t\n\t\t//\u5224\u65ad\u662f\u5426\u8be5\u505c\u6b62\u4e0d\u65ad\u5f39\u51fa\u6808\u9876\u7684\u64cd\u4f5c \n\t\tif (h >= low){\n\t\t\tif (h == low) --top;\n\t\t\telse stk[top][1] = h-1;\n\t\t\tbreak;\n\t\t}\n\t\t--top;\n\t}\n\t//\u5165\u6808\u65b0\u5143\u7d20 \n\t++top;\n\tstk[top][0] = h; stk[top][1] = maxrg; stk[top][2] = t;\n\t++n;\n}\n\nint main(){\n\t\n\tre int tn = rdnt(), m = rdnt(), k = rdnt(), l, r, x, y, opt, last_ans = 0;\n\t\n\tinit();\n\t\n\t_rfor(i, 1, tn) ht[i] = rdnt();\n\t_rfor(i, 1, tn) ty[i] = rdnt();\n\t_rfor(i, 1, tn) add_flower(ht[i], ty[i]);\n\t\n\t_rfor(i, 1, m){\n\t\topt = rdnt();\n\t\tif (opt == 1){\n\t\t\tl = rdnt()^(k*last_ans);\n\t\t\tr = rdnt()^(k*last_ans);\n\t\t\tx = rdnt()^(k*last_ans);\n\t\t\tlast_ans = qry_seg(l, r, x) + qry_lst(l, r, x);\n\t\t\tprintf(\"%d\\n\", last_ans);\n\t\t}\n\t\telse if (opt == 2){\n\t\t\tx = rdnt()^(k*last_ans);\n\t\t\ty = rdnt()^(k*last_ans);\n\t\t\tadd_flower(x, y);\n\t\t}\n\t}\n\t\n\treturn 0;\n}\n\n\n```\n",
        "postTime": 1628477650,
        "uid": 474113,
        "name": "MoYuFang",
        "ccfLevel": 7,
        "title": "\u3010P7707 \u300cWdsr-2.7\u300d\u767e\u82b1\u9f50\u653e\u7684\u592a\u9633\u82b1\u7530\u3011\u9898\u89e3"
    }
]