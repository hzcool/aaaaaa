[
    {
        "content": "## ~~\u8fd9\u9053\u9898\u4e3a\u4ec0\u4e48\u662f\u7d2b\u9898\uff1f~~\n\n\u8fd9\u9053\u9898\u5f88\u660e\u663e\u4e00\u5f00\u59cb\u8981\u5148\u6c42\u4e2a\u524d\u7f00\u548c\uff0c\u8fd9\u4e2a\u95ee\u9898\u5c31\u8f6c\u6362\u6210\u6c42i< j\uff0cs[j]-s[i]>=L\u4e14s[j]-s[i]<=R\u7684\u5bf9\u6570\uff080<=i< n)\u3002\u611f\u89c9\u8fd9\u4e2a\u5f62\u5f0f\u8ddf\u9006\u5e8f\u5bf9\u6709\u70b9\u50cf\uff0c\u4e8e\u662f\u4fbf\u60f3\u5230\u4e86\u5f52\u5e76\u6392\u5e8f\u3002\u4f46\u6709\u70b9\u533a\u522b\uff0c\u90a3\u5c31\u662f\u7b54\u6848\u7684\u7edf\u8ba1\u65b9\u5f0f\u5c31\u6ca1\u6709\u90a3\u4e48\u7b80\u5355\u4e86\u3002 \n\n\n\u4f46\u5176\u5b9e\u6211\u4eec\u5316\u4e00\u4e0b\u5f0f\u5b50\uff0c\u53d8\u6210s[i]-s[j]>=L,s[i]-s[j]<=R\uff08\u770b\u4ee3\u7801\u5c31\u80fd\u7406\u89e3\u4e86\uff09\uff0c\u53d1\u73b0\u5c31\u53ef\u4ee5\u7528\u961f\u5217\u6765\u7ef4\u62a4\uff0c\u90a3\u8fd9\u9898\u5c31\u89e3\u51b3\u4e86\uff0c\u6ce8\u610f\u5f00long long\u3002\n\n[cdq\u5206\u6cbb](https://www.luogu.org/blog/Owencodeisking/post-xue-xi-bi-ji-cdq-fen-zhi-hu-zheng-ti-er-fen)\u6c34\u9898\n\n```cpp\n#include<bits/stdc++.h>//\u4e07\u80fd\u5934\u6587\u4ef6\nusing namespace std;\nlong long L,R,ans,s[110000];\nvoid cdq(int l,int r)\n{\n    if(l==r)return ;\n    int mid=(l+r)/2;\n    cdq(l,mid),cdq(mid+1,r);\n    int head=l,tail=l-1;\n    for(int i=mid+1;i<=r;i++)\n    {\n        while(tail+1<=mid && s[i]>=s[tail+1]+L)tail++;\n        while(head<=mid && s[i]>s[head]+R)head++;\n        ans+=tail-head+1;\n    }\n    sort(s+l,s+r+1);\n}//cdq\u5206\u6cbb\nint main()\n{\n    int n;\n    scanf(\"%d%lld%lld\",&n,&L,&R);\n    for(int i=1;i<=n;i++)\n    {\n        int x;\n        scanf(\"%d\",&x);\n        s[i]=s[i-1]+x;//\u524d\u7f00\u548c\n    }\n    cdq(0,n);\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n\n```\n\n",
        "postTime": 1562835761,
        "uid": 111801,
        "name": "shentao1",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5459 \u3010[BJOI2016]\u56de\u8f6c\u5bff\u53f8\u3011"
    },
    {
        "content": "## Description\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $\\{a\\}$\uff0c\u73b0\u5728\u8981\u4ece\u4e2d\u9009\u51fa\u4e00\u6bb5\u8fde\u7eed\u5b50\u5e8f\u5217 $[l,r]$\uff0c\u4f7f\u5f97 $L \\leq \\sum\\limits_{i=l}^r a_i \\leq R$\uff0c\u6c42\u65b9\u6848\u6570\u3002\n\n$(1 \\leq n \\leq 10^5, | a_i | \\leq 10^5, 1 \\leq L,R \\leq 10^9)$\n\n## Solution\n\n\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e $r = 1 \\sim n$\uff0c\u6c42\u51fa\u5bf9\u4e8e\u6bcf\u4e2a $r$ \u6709\u591a\u5c11 $l$ \u7b26\u5408\u6761\u4ef6\uff0c\u7d2f\u52a0\u5373\u662f\u7b54\u6848\u3002\n\n\u5148\u9884\u5904\u7406\u51fa\u524d\u7f00\u548c\u6570\u7ec4 $pre$\uff0c\u90a3\u4e48 $\\sum\\limits_{i=l}^r a_i$ \u7684\u503c\u4e3a $pre_r - pre_{l - 1}$\uff0c\u5f53\u4e14\u4ec5\u5f53 $L \\leq pre_r - pre_{l - 1} \\leq R$ \u65f6 $l$ \u7b26\u5408\u6761\u4ef6\u3002\n\n\u53d8\u5f62\u4e00\u4e0b\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u53ef\u5f97 $pre_r - R \\leq pre_{l - 1} \\leq pre_r -L$ \u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u627e\u5230\u6709\u591a\u5c11\u4e2a $pre_{l - 1} \\left(l \\in [1,r] \\right)$ \u5728 $[pre_r - R,pre_r - L]$ \u533a\u95f4\u5185\u3002\u5355\u70b9\u4fee\u6539\uff0c\u533a\u95f4\u67e5\u8be2\uff0c\u53ef\u4ee5\u79bb\u6563\u5316\u540e\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\uff0c\u8fd9\u91cc\u6211\u4f7f\u7528\u4e86\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\uff0c\u539f\u7406\u76f8\u540c\uff08\u4e0d\u8981\u5fd8\u8bb0\u521d\u59cb\u65f6\u63d2\u5165 $pre_0 = 0$\uff09\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n \\log n)$ \u3002\n\n## Code\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\n\ntemplate <class T>\ninline void read(T &x) {\n    x = 0;\n    char c = getchar();\n    bool f = 0;\n    for (; !isdigit(c); c = getchar()) f ^= c == '-';\n    for (; isdigit(c); c = getchar()) x = x * 10 + (c ^ 48);\n    x = f ? -x : x;\n}\n\ntemplate <class T>\ninline void write(T x) {\n    if (x < 0) {\n        putchar('-');\n        x = -x;\n    }\n    T y = 1;\n    int len = 1;\n    for (; y <= x / 10; y *= 10) ++len;\n    for (; len; --len, x %= y, y /= 10) putchar(x / y + 48);\n}\n\nconst int MAXN = 1e5, LOG = 34;\nconst LL MAXM = 1e10;\nint n, l, r;\nLL ans, pre[MAXN + 5];\nstruct SegmentTree {//\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\n    int root, tot, sum[MAXN * LOG * 4 + 5], lson[MAXN * LOG * 4 + 5], \n    rson[MAXN * LOG * 4 + 5];\n    \n    inline void pushUp(int x) {\n        sum[x] = sum[lson[x]] + sum[rson[x]];\n    }\n    void update(int &x, LL q, LL p, LL l = -MAXM, LL r = MAXM) {\n        if (!x) x = ++tot;\n        if (l == r) {\n            sum[x] += p;\n            return;\n        }\n        LL mid = (l + r) >> 1;\n        if (q <= mid) update(lson[x], q, p, l, mid);\n        else update(rson[x], q, p, mid + 1, r);\n        pushUp(x);\n    }\n    int query(int &x, LL ql, LL qr, LL l = -MAXM, LL r = MAXM) {\n        if (!x) x = ++tot;\n        if (ql <= l && qr >= r) return sum[x];\n        LL res = 0, mid = (l + r) >> 1;\n        if (ql <= mid) res += query(lson[x], ql, qr, l, mid);\n        if (qr > mid) res += query(rson[x], ql, qr, mid + 1, r);\n        return res;\n    }\n} tr;\n\nint main() {\n    read(n), read(l), read(r);\n    for (int x, i = 1; i <= n; ++i) {\n        read(x);\n        pre[i] = pre[i - 1] + x;//\u9884\u5904\u7406\u524d\u7f00\u548c\n    }\n    tr.update(tr.root, pre[0], 1);//\u63d2\u5165 pre[0]\n    for (int i = 1; i <= n; ++i) {//\u679a\u4e3e\u53f3\u7aef\u70b9\n        ans += tr.query(tr.root, pre[i] - r, pre[i] - l);\n        //l - 1 \u5728\u533a\u95f4 [0,r) \u5185\n        tr.update(tr.root, pre[i], 1);//\u63d2\u5165 pre[i]\n    }\n    write(ans);\n    putchar('\\n');\n    return 0;\n}\n```",
        "postTime": 1562915894,
        "uid": 32139,
        "name": "Heartlessly",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5459 \u3010[BJOI2016]\u56de\u8f6c\u5bff\u53f8\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u6c42\u6709\u591a\u5c11\u4e2a $[l,\\,r]$ \u4f7f $L \\leq \\sum_{i=l}^r a_i \\leq R$\u3002\n\n\u53ef\u4ee5\u4f7f\u7528\u524d\u7f00\u548c\u7684\u601d\u60f3\uff0c\u5c06\u9898\u76ee\u8f6c\u5316\u4e3a\uff1a\n\n$$L \\leq \\sum_{i=1}^r a_i - \\sum_{i=1}^{l-1} a_i \\leq R$$\n\n$$\\sum_{i=1}^r a_i - R \\leq \\sum_{i=1}^{l-1} a_i \\leq \\sum_{i=1}^r a_i - L$$\n\n\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u4e00\u4e0b\uff0c\u6211\u7528\u7684\u662f fhq Treap\uff0c\u5148\u63d2\u5165\u4e00\u4e2a $0$\uff08\u5426\u5219\u65e0\u6cd5\u8ba1\u7b97 $[1,\\,r$] \u7684\u60c5\u51b5\uff09\uff0c\u7136\u540e\u6bcf\u6b21\u63d2\u5165 $pre_i$\uff0c\u5e76\u67e5\u8be2\u3002\n\n\u6570\u636e\u8303\u56f4\u5b9e\u9645\u5e94\u4e3a $0 \\leq L,\\,R \\leq 10^9$\u3002\u9700\u8981\u6ce8\u610f\uff0c\u56e0\u4e3a\u63d2\u5165\u4e86 $0$\uff0c\u5f53 $L=0$ \u65f6\u6bcf\u6b21\u67e5\u8be2\u4f1a\u591a $+1$\uff08\u5f53\u53d6\u51fa\u7684\u662f\u7a7a\u5b50\u6bb5\u65f6\uff09\u3002\u6240\u4ee5\u5f53 $L=0$ \u4f7f\u7b54\u6848\u9700\u8981\u51cf\u53bb $n$\u3002\n\n$\\text{Code}$\uff1a\n\n```cpp\ndef(N, int, 1e5 + 5)\n\nstruct FHQ {\n\tint ls, rs, sze, rnd;\n\tll val;\n} t[N];\n\nint n, x, y, root;\nint w[N];\nll pre[N], ans;\n\nint New(ll x) {\n\tstatic int r = 0;\n\t++r;\n\t\n\tt[r].ls = t[r].rs = 0;\n\tt[r].sze = 1;\n\tt[r].rnd = rand();\n\tt[r].val = x;\n\t\n\treturn r;\t\n}\n\nvoid pushup(int x) { t[x].sze = t[t[x].ls].sze + t[t[x].rs].sze + 1; }\n\nint merge(int x, int y) {\n\tif(!x || !y) return x + y;\n\tif(t[x].rnd < t[y].rnd) {\n\t\tt[x].rs = merge(t[x].rs, y);\n\t\tpushup(x);\n\t\treturn x;\n\t}\n\telse {\n\t\tt[y].ls = merge(x, t[y].ls);\n\t\tpushup(y);\n\t\treturn y;\n\t}\n}\n\nvoid split(int rt, int &x, int &y, ll k) {\n\tif(!rt) return x = y = 0, void();\n\tif(t[rt].val <= k) {\n\t\tx = rt;\n\t\tsplit(t[rt].rs, t[rt].rs, y, k);\n\t}\n\telse {\n\t\ty = rt;\n\t\tsplit(t[rt].ls, x, t[rt].ls, k);\n\t}\n\tpushup(rt);\n}\n\nvoid insert(ll x) {\n\tint l, r;\n\tsplit(root, l, r, x - 1);\n\troot = merge(l, merge(New(x), r));\t\n}\n\nint query(ll x) {\n\tint l, mid, r;\n\tsplit(root, l, r, x - ::x);\n\tsplit(l, l, mid, x - y - 1);\n\tint ret = t[mid].sze;\n\troot = merge(l, merge(mid, r));\n\treturn ret;\t\n}\n\nint main() {\n\tsrand(19260817);\n\tqread(n, x, y);\n\trep(i, 1, n) qread(w[i]), pre[i] = pre[i - 1] + w[i];\n\tinsert(0);\n\trep(i, 1, n) {\n\t\tinsert(pre[i]);\n\t\tint x = query(pre[i]);\n\t\tans += x;\n\t\t//printf(\"%d\\n\", x);\n\t}\n\tprintf(\"%lld\\n\", ans - (x == 0 ? n : 0));\n \treturn 0;\n}\n```\n",
        "postTime": 1622333594,
        "uid": 242543,
        "name": "BreezeEnder",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5459 [BJOI2016]\u56de\u8f6c\u5bff\u53f8"
    },
    {
        "content": "\u9898\u76ee\u94fe\u63a5[link](https://www.luogu.com.cn/problem/P5459)\n\n## \u9898\u76ee\u5927\u610f\n\n\n\u7ed9\u51fa\u4e00\u4e2a\u6709 $n$ \u4e2a\u6570\u7684\u5e8f\u5217 ${a}$ \u548c\u8fb9\u754c $L,R$\uff0c\u6c42\u95ee\u6709\u591a\u5c11\u8fde\u7eed\u5b50\u5e8f\u5217\u4f7f $L\\le \\sum\\limits_{i=l}^r a_i \\le R $\n\n## \u601d\u8def\n\n\u53ef\u4ee5\u5c06\u6574\u4e2a\u5e8f\u5217\u8f6c\u5316\u4e3a\u524d\u7f00\u548c\u5e8f\u5217 ${sum}$\uff0c\u4e4b\u540e\u5bf9\u8fd9\u4e2a\u5e8f\u5217\u8fdb\u884c\u63d2\u5165\u548c\u67e5\u8be2\u64cd\u4f5c\uff0c\u5f88\u5bb9\u6613\u60f3\u5230 `CDQ\u5206\u6cbb`\u3002\u4f9d\u636e\u9898\u610f\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4\u4e00\u4e0b\u548c\u5728 $L$ \u548c $R$ \u4e4b\u95f4\u7684\u5b50\u5e8f\u5217\u3002\u540c\u65f6\uff0c `CDQ\u5206\u6cbb` \u662f\u53ef\u884c\u7684\uff0c\u56e0\u4e3a\u5728\u7ef4\u62a4\u540e\u5de6\u53f3\u533a\u95f4\u7684\u503c\u548c $L,R$ \u4e4b\u95f4\u7684\u4e0b\u8868\u90fd\u53d8\u4e3a\u9012\u589e\u7684\uff0c\u7b54\u6848\u7edf\u8ba1\u4e5f\u662f\u6ca1\u6709\u95ee\u9898\u7684\u3002\u56e0\u6b64\uff0c\u53ea\u9700\u8981\u5f52\u5e76\u6392\u5e8f\u5e76\u7ef4\u62a4\u5373\u53ef\u3002\n\n## \u4ee3\u7801\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<sstream>\n#include<queue>\n//#include<map>\n#include<vector>\n#include<math.h>\nusing namespace std;\n#define int long long\n#define forr(i,a,b) for(int i=a;i<=b;i++)\n#define repp(i,a,b) for(int i=a;i>=b;i--)\n#define INF 1e9\n#define ll long long\n#define MAXN 2000005\nconst int _x[]={0,1,0,-1,0},_y[]={0,0,1,0,-1};\n#define mem(a,n) memset(a,n,sizeof(a));\n#define chkmax(a,b) a=a>b?a:b;\n#define chkmin(a,b) a=a<b?a:b;\n#include<set>\n#include<stack>\n#define DE puts(\"check\");\n#define inr int\ninr a[MAXN];\ninr N,L,R;\nint ans;\nvoid cdq(int pl,int pr);\nsigned main(){\n\tscanf(\"%lld%lld%lld\",&N,&L,&R);\n\tforr(i,1,N){\n\t\tint tmp;\n\t\tscanf(\"%lld\",&tmp);\n\t\ta[i]=a[i-1]+tmp;\n\t}\n\tcdq(0,N);\n\tprintf(\"%lld\",ans);\n}\nvoid cdq(inr pl,int pr){\n\tif(pl==pr){\n\t\treturn;\n\t}\n\tint mid=pl+pr>>1;\n\tcdq(pl,mid),cdq(mid+1,pr);\n\tint l=pl;\n\tinr r=pl-1;\n\tforr(i,mid+1,pr){\n\t\tfor(r;r+1<=mid and a[i]>=a[r+1]+L;r++){\n\t\t\t;\n\t\t}\n\t\tfor(l;l<=mid and a[i]>a[l]+R;l++){\n\t\t\t;\n\t\t}\n\t\tans+=r-l+1;\n\t}\n\tsort(a+pl,a+pr+1);\n}\n```",
        "postTime": 1622274534,
        "uid": 352464,
        "name": "JJA_",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011P5459 [BJOI2016]\u56de\u8f6c\u5bff\u53f8"
    },
    {
        "content": "1A\n\n\u6211\u7684\u505a\u6cd5\u662f\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u4f4d\u7f6epos\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u7edf\u8ba1$x \\in [1, pos]$\u5185\u6709\u591a\u5c11\u4e2a$x$\u4f7f\u5f97$\\sum\\limits_{i = x}^{pos}a[i]$\u5728$L$\u5230$R$\u4e4b\u95f4\n\n\u5148\u6c42\u51fa\u524d\u7f00\u548c$sum[i]$\n\n\u5bf9\u4e8e\u4e00\u4e2a\u4f4d\u7f6e$pos$\u8981\u627e\u7684\u6570\u5b57\n\n$L \\le sum[i] - val \\le R$\n\n\u5373\u5f97\n\n$val \\in [sum[i] - R, sum[i] - L]$\n\n\u5bf9\u8fd9\u4e2a\u524d\u7f00\u548c\u79bb\u6563\u5316\uff0c\u65b9\u4fbf\u6811\u72b6\u6570\u7ec4\u64cd\u4f5c\n\n```cpp\nconst int N = 1e5 + 10;\n\nint n, ql, qr, ans;\nint a[N], s[N];\nint lsh[N], qaq;\nint tree[N];\n\ninline void add(int x, int k)\n{\n\tfor(; x <= n; x += x & -x) tree[x] += k;\n}\n\ninline int ask(int x)\n{\n\tint res = 0;\n\tfor(; x; x -= x & -x) res += tree[x];\n\treturn res;\n}\n\nsigned main()\n{\n\tinto();\n\tread(n); read(ql); read(qr);\n\tfor(R int i = 1; i <= n; i++) read(a[i]), s[i] = s[i - 1] + a[i], lsh[i] = s[i];\n\tlsh[n + 1] = 0;\n\tsort(lsh + 1, lsh + n + 2);\n\tqaq = unique(lsh + 1, lsh + n + 2) - lsh - 1;\n\tadd(lower_bound(lsh + 1, lsh + qaq + 1, 0) - lsh, 1);\n\tfor(R int i = 1; i <= n; i++)\n\t{\n\t\tR int lim_l = lower_bound(lsh + 1, lsh + qaq + 1, s[i] - qr) - lsh - 1, lim_r = upper_bound(lsh + 1, lsh + qaq + 1, s[i] - ql) - lsh - 1;\n\t\tans += ask(lim_r) - ask(lim_l);\n\t\tadd(lower_bound(lsh + 1, lsh + qaq + 1, s[i]) - lsh, 1);\n\t}\n\twriteln(ans);\n\treturn 0;\n}\n```",
        "postTime": 1605793966,
        "uid": 103023,
        "name": "AvA_sleeper",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5459 \u3010[BJOI2016]\u56de\u8f6c\u5bff\u53f8\u3011"
    },
    {
        "content": "# \u7ebf\u6bb5\u6811\u505a\u6cd5\n# \u9898\u610f\n\u5bf9\u4e8e\u6570\u5217 $a_i(1<= i <= n)$ \u6c42\u5176\u4e2d\u6ee1\u8db3\u548c\u5728 $L$ \u5230 $R$ \u533a\u95f4\u7684\u5b50\u6bb5\u6570\u91cf\u4e3a\u591a\u5c11\u3002\n# \u89e3\u6790\n\u533a\u95f4\u548c\u6211\u4eec\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u6765\u4f18\u5316\u3002\n\n\u90a3\u533a\u95f4 $a_j$ \u5230 $a_i$ \u7684\u548c\u6211\u4eec\u53ef\u4ee5\u8868\u793a\u4e3a $pre[i] - pre[j]$ \u3002\n\n\u5176\u4e2d\u6ee1\u8db3\u6761\u4ef6\u7684\u533a\u95f4\u4e3a:\n\n```cpp\nL <= pre[i] - pre[j] <= R\n\nL - pre[i] <= -pre[j] <= R - pre[i]\n\npre[i] - R <= pre[j] <= pre[i] - L\n```\n\n\n\u4e8e\u662f\u6211\u4eec\u4e0d\u96be\u53d1\u73b0\uff0c\u8fd9\u4e0d\u5c31\u662f\u4e00\u4e2a\u533a\u95f4\u6c42\u548c\u7684\u95ee\u9898\u5417\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $pre[i]$ \u6c42\u51fa\u6ee1\u8db3\u6761\u4ef6\u7684 $pre[j]$ \u7684\u6570\u91cf\u6c42\u4e2a\u548c\u5c31\u884c\u4e86\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5bf9 $pre$ \u6570\u7ec4\u5efa\u4e00\u4e2a\u7ebf\u6bb5\u6811\uff0c\u679a\u4e3e $i$ \u518d\u533a\u95f4\u67e5\u8be2\u6ee1\u8db3\u6761\u4ef6\u7684 $j$ \u7684\u4e2a\u6570\u5c31\u884c\u4e86\u3002\u6ce8\u610f\u5bff\u53f8\u662f\u6709\u51fa\u73b0\u7684\u65f6\u95f4\u5148\u540e\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u4e00\u5f00\u59cb\u5c31\u5168\u90e8\u63d2\u5165\u7ebf\u6bb5\u6811\uff0c\u5e94\u8be5\u5728\u679a\u4e3e\u5b8c $i$ \u4e4b\u540e\u518d\u628a $i$ \u63d2\u5165\u7ebf\u6bb5\u6811\u3002\u6ce8\u610f\u6211\u4eec\u8fd8\u8981\u5148\u5c06 $pre[0]$\u63d2\u5165\u7ebf\u6bb5\u6811\u4e2d\u3002\n# \u611f\u8c22\n\u611f\u8c22Nerovix\u5927\u4f6c\u7684\u53ca\u65f6\u56de\u590d\uff0c\u5e2e\u6211\u627e\u51fa\u4e86\u6211\u7206\u96f6\u4ee3\u7801\u7684\u95ee\u9898\u3002\u6211\u4f1a\u5728\u4ee3\u7801\u4e2d\u6807\u51fa\u3002\n\n```cpp\n#include<cstdio>\n#define LL long long\nconst int N = 3.4e6 + 5;//\u7a7a\u95f4\u8981\u8db3\u591f\u5927\nconst LL MAXN = 1e10;\nstruct SegmentTree {\n\tint lc,rc,dat;\n}tr[4 * N];//\u7a7a\u95f4\u8981\u8db3\u591f\u5927\nint n,root,tot = 0,le,ri;\nlong long pre[N],res = 0;\nint build() {\n\ttot++;//\u5343\u4e07\u4e0d\u8981\u5199\u6210tr[++tot],\u4f1a\u5199\u5047\n\ttr[tot].lc = tr[tot].rc = tr[tot].dat = 0;\n\treturn tot;\n}\nvoid insert(int p,LL val,int add,LL L = -MAXN,LL R = MAXN) {\n\tif(L == R) {\n\t\ttr[p].dat += add;\n\t\treturn;\n\t}\n\tLL mid = (L + R) >> 1;\n\tif(val <= mid) {\n\t\tif(!tr[p].lc) tr[p].lc = build();\n\t\tinsert(tr[p].lc,val,add,L,mid);\n\t}\n\telse {\n\t\tif(!tr[p].rc) tr[p].rc = build();\n\t\tinsert(tr[p].rc,val,add,mid + 1,R);\n\t}\n\ttr[p].dat = tr[tr[p].lc].dat + tr[tr[p].rc].dat;\n}\nint query(int p,LL lf,LL rg,LL L = -MAXN,LL R = MAXN) {\n\tif(lf <= L && R <= rg) return tr[p].dat;\n\tLL mid = (L + R) >> 1; int ans = 0;\n\tif(lf <= mid) {\n\t\tif(!tr[p].lc) tr[p].lc = build();\n\t\tans += query(tr[p].lc,lf,rg,L,mid);\n\t}\n\tif(rg >  mid) {\n\t\tif(!tr[p].rc) tr[p].rc = build();\n\t\tans += query(tr[p].rc,lf,rg,mid + 1,R);\n\t}\n\treturn ans;\n}\ninline int read() {\n\tint x = 0,flag = 1;\n\tchar ch = getchar();\n\twhile(ch < '0' || ch > '9'){if(ch == '-')flag = -1;ch = getchar();}\n\twhile(ch >='0' && ch <='9'){x = (x << 3) + (x << 1) + ch - 48;ch = getchar();}\n\treturn x * flag;\n}\nint main() {\n\tn = read(),le = read(),ri = read();\n\tfor(int i = 1,x; i <= n; i++) {\n\t\tx = read();\n\t\tpre[i] = pre[i - 1] + x;\n\t}\n\troot = build();\n\tinsert(root,pre[0],1);\n\tfor(int i = 1; i <= n; i++) {\n\t\tres += query(root,pre[i] - ri,pre[i] - le);\n\t\tinsert(root,pre[i],1);\n\t}\n\tprintf(\"%lld\",res);\n\treturn 0;\n}\n/*\n5 5 9\n1 2 3 4 5\n*/\n```\n",
        "postTime": 1617097909,
        "uid": 385145,
        "name": "\u795e\u7737\u4e4b\u6a31\u82b1",
        "ccfLevel": 4,
        "title": "P5459 \u9898\u89e3"
    },
    {
        "content": "\u8fd9\u9898\u63a8\u5f0f\u5b50\u7684\u9898\u89e3\u597d\u50cf\u90fd\u6709\u4e00\u4e2a\u7ec6\u8282\u95ee\u9898\u6ca1\u63d0\u5230...~~\uff08\u53ef\u80fd\u53ea\u6709\u6211\u592a\u83dc\u89c9\u5f97\u9700\u8981\u63d0...\uff09~~ \u5c31\u662f\u67e5\u8be2\u533a\u95f4\u5e94\u8be5\u548c\u63d2\u5165**\u540c\u6b65\u8fdb\u884c**\uff0c\u56e0\u4e3a\u533a\u95f4\u524d\u7f00\u548c\u4e0d\u4fdd\u8bc1\u9012\u589e\u3002\n\n## \u89e3\u6790\n\n\u9996\u5148\u9898\u76ee\u662f\u8981\u6c42\u6211\u4eec\u6c42\u6240\u6709\u6ee1\u8db3\u533a\u95f4\u548c\u5728 $[L, R]$ \u8303\u56f4\u5185\u7684\u533a\u95f4\u3002\u5982\u679c\u76f4\u63a5\u505a\u7684\u8bdd\u4f1a\u975e\u5e38\u9ebb\u70e6 ~~\uff08\u5f53\u7136\u4e0d\u6392\u9664\u5927\u4f6c\u76f4\u63a5\u5404\u79cd\u65b9\u6cd5\u66b4\u8349QAQ\uff09~~ \uff0c\u53ef\u4ee5\u8003\u8651\u8bd5\u7740\u63a8\u4e0b\u5f0f\u5b50\u3002\n\n\u9996\u5148\u533a\u95f4\u548c\u53ef\u4ee5\u7528\u524d\u7f00\u548c\uff08$sum[.]$\uff09\u8868\u793a\uff0c\u9898\u76ee\u5c31\u662f\u8981\u6c42\u6c42\u6240\u6709 $l, r$ \u6ee1\u8db3 $L\\leqslant sum[r]-sum[l-1] \\leqslant R$\u3002\n\n\u53ef\u4ee5\u60f3\u5230\u5982\u679c\u53ea\u7edf\u8ba1\u4e00\u4e2a\u70b9\u7684\u6570\u91cf\u7ef4\u62a4\u4f1a\u6bd4\u8f83\u65b9\u4fbf\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u5316\u6210 $sum[r]-R\\leqslant sum[l-1]\\leqslant sum[r]-L$\uff0c\u8fd9\u663e\u7136\u53ea\u9700\u7528\u6743\u503c\u7ebf\u6bb5\u6811\u52a8\u6001\u5f00\u70b9\uff08\u6216\u8005\u79bb\u6563\u5316\uff09\uff0c\u679a\u4e3e $r$ \u5c31\u53ef\u4ee5\u4e86\u3002\n\n---\n\n\u4f46\u5728\u5b9e\u73b0\u65f6\u6709\u4e00\u4e2a\u7ec6\u8282\u5c24\u5176\u503c\u5f97\u6ce8\u610f\uff1a\n\n\u56e0\u4e3a\u6ee1\u610f\u5ea6\u662f\u6709\u53ef\u80fd\u4e3a\u8d1f\u6570\u7684\uff0c\u8fd9\u4ee3\u8868\u533a\u95f4\u548c\u4e0d\u662f\u9012\u589e\u7684\uff1a\u5177\u4f53\u7684\u6765\u8bf4\uff0c\u5047\u8bbe\u6709 $l \\leqslant r$ \u6ee1\u8db3\u6761\u4ef6\uff0c\u53c8\u6709 $l' > r$ \u4e0d\u6ee1\u8db3\u6761\u4ef6\uff0c\u5b83\u4eec\u7684\u524d\u7f00\u548c $sum$ \u662f\u6709\u53ef\u80fd\u76f8\u7b49\u7684\u3002\n\n\u56e0\u6b64\u6211\u4eec\u9700\u8981\u8fb9\u63d2\u5165\u8fb9\u67e5\u8be2\uff0c\u5f53\u63d2\u5165\u5230 $r$ \u7684\u65f6\u5019\u540c\u65f6\u8be2\u95ee $sum[r]-R\\leqslant sum[l-1]\\leqslant sum[r]-L$ \u7684\u4e2a\u6570\uff0c\u5c31\u80fd\u4fdd\u8bc1 $l$ \u5408\u6cd5\u3002\n\n## CODE\n\n\u8fd9\u91cc\u7ef4\u62a4\u7528\u7684\u662f\u6743\u503c\u7ebf\u6bb5\u6811\u52a8\u6001\u5f00\u70b9\u3002\n\n```cpp\n#include <cstdio>\n#define ll long long\n\nconst ll N =((1ll)<<35), MAXN =1e5+50;\n\nint cnt[MAXN<<10], ls[MAXN<<10], rs[MAXN<<10], top, CNT;\n\ninline int pushup(int s){ return cnt[s] =cnt[ls[s]]+cnt[rs[s]], s; }\n\nint modify(ll x, int s, ll nl =1, ll nr =N){\n\tif(!s) s =++CNT;\n\tif(nl == nr) return ++cnt[s], s;\n\tll mid =(nl+nr)>>1;\n\tif(x <= mid) ls[s] =modify(x, ls[s], nl, mid);\n\telse rs[s] =modify(x, rs[s], mid+1, nr);\n\treturn pushup(s);\n}\n\nint query(ll l, ll r, int s, ll nl =1, ll nr =N){\n\tif(l <= 0 || r <= 0) return 0;\n\tif(!s) return 0;\n\tif(l == nl && r == nr) return cnt[s];\n\tll mid =(nl+nr)>>1;\n\tif(r <= mid) return query(l, r, ls[s], nl, mid);\n\telse if(l > mid) return query(l, r, rs[s], mid+1, nr);\n\telse return query(l, mid, ls[s], nl, mid)+query(mid+1, r, rs[s], mid+1, nr);\n}\n\ninline int read(){\n\tint x =0; bool f =0; char c =getchar();\n\twhile(c < '0' || c > '9') (c == '-') ? f =1, c =getchar() : c =getchar();\n\twhile(c >= '0' && c <= '9') x =(x<<1)+(x<<3)+(c^48), c =getchar();\n\treturn (f) ? -x : x;\n}\n\nint n, L, R;\nll sum[MAXN];\n\nint main(){\n\tn =read(), L =read(), R =read();\n\tfor(int i =1; i <= n; ++i) sum[i] =sum[i-1]+read();\n\tll ans =0;\n\t/*\u6ce8\u610f l-1 \u53ef\u53d6 0\uff0c\u4e14\u4e0d\u53ef\u53d6 n*/\n\tfor(int r =1; r <= n; ++r) top =modify(sum[r-1]+1e10+1, top), ans +=query(sum[r]-R+1e10+1, sum[r]-L+1e10+1, top);\n\tprintf(\"%lld\", ans);\n}\n```\n",
        "postTime": 1591529705,
        "uid": 105254,
        "name": "Piwry",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5459 \u3010[BJOI2016]\u56de\u8f6c\u5bff\u53f8\u3011"
    },
    {
        "content": "# CDQ\u5206\u6cbb+\u961f\u5217\u7ef4\u62a4 #\n\n\u6682\u65f6\u770b\u672c\u9898\u8fd8\u6ca1\u4ec0\u4e48\u9898\u89e3\uff0c\u5c31\u53d1\u4e00\u7bc7\u3002\u53d1\u73b0\u6b63\u89e3\u5e94\u8be5\u662f\u6811\u5957\u6811\uff1f\u4e0d\u8fc7\u672c\u9898\u662f\u6211\u770b\u540c\u673a\u623f\u5927\u4f6c[\u9752\u8471](https://www.luogu.org/space/show?uid=139717)\u5728\u505a\u7684\u4e00\u9053\u9898\uff0c\u4ed6\u8bf4\u53ef\u4ee5\u7528CDQ\u5206\u6cbb\u505a\uff0c\u6b63\u597d\u6211\u6700\u8fd1\u7ec3\u4e60CDQ\u5206\u6cbb\uff0c\u5c31\u770b\u4e86\u4e00\u773c\uff0c\u5e76\u53d7\u9752\u8471\u5927\u4f6c\u7684\u6307\u70b9\uff0c\u672c\u849f\u84bb\u7ec8\u4e8e\u505a\u51fa\u4e86\u8fd9\u9053\u9898\u3002\n\n\n\n------------\n\u672c\u9898\u89e3\u4f1a\u52a0\u5165\u4e00\u4e9b\u7b14\u8005\u5bf9CDQ\u5206\u6cbb\u7684\u7406\u89e3\uff0c\u597d\u4e86\uff0c\u5e9f\u8bdd\u4e0d\u591a\u8bf4\n\n\u9898\u610f\uff1a\u6709$n$\u4e2a\u70b9\u7ec4\u6210\u7684\u5e8f\u5217\uff0c\u5bf9\u4e8e\u7b2c$k$\u4e2a\u70b9\uff08$1<=k<=n$\uff09\uff0c\u8be2\u95ee\u4ece\u7b2c$k$\u4e2a\u70b9\u5230\u7b2c$j$\u4e2a\u70b9\u7684\u548c\u5927\u4e8e\u7b49\u4e8e$L$,\u5c0f\u4e8e\u7b49\u4e8e$R$\uff08$j<=k$\uff09\uff0c\u6c42\u6240\u6709$k$\u6ee1\u8db3\u8981\u6c42\u7684$j$\u7684\u6570\u91cf\u4e4b\u548c\u3002\n\n**\u5982\u679c\u5b66\u8fc7CDQ\u5206\u6cbb\u7684dalao\u4eec\u53ef\u4ee5\u8df3\u5230\u7b2c\u4e8c\u677f\u5757**\n\n## 1\u3001\u6d45\u8c08CDQ\u5206\u6cbb ##\n\u6700\u57fa\u672c\u7684CDQ\u5206\u6cbb\uff1a\u62e5\u6709\u63d2\u5165\u548c\u67e5\u8be2\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u5b8c\u6210\u5e8f\u5217\u4e0a\u7684\u6570\u91cf\u67e5\u8be2\u3002\n\n### CDQ\u5206\u6cbb\u603b\u7ed3\uff1a\n\u5de6\u533a\u95f4\u4fee\u6539\uff08\u63d2\u5165\uff09\uff0c\u53f3\u533a\u95f4\u8bb0\u5f55\u5de6\u533a\u95f4\u5bf9\u53f3\u533a\u95f4\u7684\u5f71\u54cd\n\n### CDQ\u5206\u6cbb\u7684\u7406\u89e3\uff1a\n\u770b\u4e86\u5f88\u591a\u8bb2\u89e3\uff0c\u4e00\u76f4\u5bf9\u5de6\u533a\u95f4\u548c\u53f3\u533a\u95f4\u6ca1\u4ec0\u4e48\u76f4\u89c2\u611f\u53d7\uff0c\u8fd9\u8981\u6162\u6162\u81ea\u884cyy\u3002\u5728\u6b64\u591a\u8bf4\u4e00\u4e9b\u81ea\u5df1\u7684\u7406\u89e3\uff1a\u5728\u5e8f\u5217\u4e0a\uff0c**\u4e00\u4e2a\u67e5\u8be2\u662f\u7531\u4e4b\u524d\u5c31\u5b58\u5728\uff08\u63d2\u5165\uff09\u7684\u503c\u6765\u5f71\u54cd\u7684**\u3002\n\n\u6bd4\u5982$1$ ,$3$ ,$7$ ,$2$ ,$5$ ,$4$ ,$8$\u8fd9\u4e2a\u5e8f\u5217\uff0c\u6c42\u503c\u4e3a$5$\u7684\u6570\u4e4b\u524d\u6709\u591a\u5c11\u6570\u6bd4\u4ed6\u5c0f\uff0c\u663e\u7136\u6709$1$, $3$, $2$, \u4e09\u4e2a\u6570\uff0c\u800c\u6392\u5728$5$\u540e\u9762\u7684$4$\u6ca1\u6709\u5f71\u54cd\u5230$5$\u7684\u7edf\u8ba1\u3002\n\n\u660e\u767d\u8fd9\u4e00\u70b9\u4e4b\u540e\uff0cCDQ\u5206\u6cbb\u7684\u6838\u5fc3\u57fa\u672c\u5df2\u7ecf\u8bb2\u6e05\u695a\u4e86\u3002\n\n\u63a5\u7740\uff0c\u6211\u4eec\u5c06CDQ\u5206\u6cbb \uff0c\u5206\u4e3a**CDQ**\u548c**\u5206\u6cbb**\uff08\u81ea\u5df1\u5f3a\u884c\u5206\u5f00\uff09\n\n**\u5206\u6cbb**\uff1a\u5728\u6b64\u4e0d\u591a\u8bf4\uff0c\u53ef\u4ee5\u770b[p1908 \u9006\u5e8f\u5bf9](https://www.luogu.org/problemnew/show/P1908)\u7684\u9898\u89e3\uff0c\u5e76\u81ea\u5df1\u505a\u4e00\u505a\u3002\u5206\u6cbb\u5c31\u662f\u5c06\u5e8f\u5217\u9012\u5f52\u5230\u6700\u4f4e\u5c42\uff0c\u5e76\u8fd4\u56de\u7684\u65f6\u5019\uff0c\u6839\u636e\u5927\u5c0f\u5f52\u5e76\u6392\u5e8f\u3002\n\n**CDQ**:\u5c06\u63d2\u5165\u548c\u67e5\u8be2\u6839\u636e\u65f6\u95f4\u653e\u5165\u5e8f\u5217\uff0c\u6240\u4ee5\u6211\u4eec\u5206\u4e3a\u56db\u4e2a\u90e8\u5206\uff1a\n\n\u5de6\u533a\u95f4\u4e2d\u63d2\u5165\uff1a\u7531\u4e8e\u5de6\u533a\u95f4\u53ef\u4ee5\u5bf9\u53f3\u533a\u95f4\u5f71\u54cd\uff08\u56e0\u4e3a\u5de6\u533a\u95f4\u5728\u524d\u9762\uff09\n\n\u5de6\u533a\u95f4\u7684\u67e5\u8be2\uff1a\u7531\u4e8e\u5de6\u533a\u95f4\u7684\u67e5\u8be2\u5df2\u7ecf\u7ed3\u675f\uff0c\u53f3\u533a\u95f4\u4e0d\u80fd\u5bf9\u5de6\u533a\u95f4\u5f71\u54cd\uff0c\u6240\u4ee5\u5de6\u533a\u95f4\u7684\u67e5\u8be2\u53ef\u4ee5\u4e0d\u7528\u7ba1\n\n\u53f3\u533a\u95f4\u7684\u63d2\u5165:\u7531\u4e8e\u53f3\u533a\u95f4\u7684\u63d2\u5165\u4e0d\u80fd\u5bf9\u5de6\u533a\u95f4\u7684\u67e5\u8be2\u9020\u6210\u5f71\u54cd\uff0c\u6240\u4ee5\u53ef\u4ee5\u4e0d\u7528\u7ba1\n\n\u53f3\u533a\u95f4\u7684\u67e5\u8be2\uff1a\u7531\u4e8e\u53f3\u533a\u95f4\u7684\u67e5\u8be2\u53ef\u4ee5\u88ab\u5de6\u533a\u95f4\u7684\u63d2\u5165\u503c\u6240\u5f71\u54cd\uff0c\u6545\u5c06\u5de6\u533a\u95f4\u7684\u5408\u6cd5\u5f71\u54cd\u7edf\u8ba1\u4e0b\u6765\uff08\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\uff09\n\n**\u5bf9\u4e8e\u5de6\u533a\u95f4\u7684\u7edf\u8ba1\uff0c\u5df2\u7ecf\u5728\u4e0a\u4e00\u5c42\u5e8f\u5217\u7edf\u8ba1\u5b8c\u4e86\uff0c\u800c\u53f3\u533a\u95f4\u7684\u7edf\u8ba1\uff0c\u4e0a\u4e00\u5c42\u5e8f\u5217\u503c\u7edf\u8ba1\u4e86\u4e00\u90e8\u5206\uff0c\u5728\u8fd9\u4e00\u5c42\u8fd8\u6709\u6bd4\u5b83\u66f4\u524d\u9762\u7684\u6570\u6ca1\u6709\u7edf\u8ba1**\n\n\u5728\u6b64\uff0cCDQ\u5206\u6cbb\u7684\u57fa\u672c\u5df2\u7ecf\u8bb2\u5b8c\u4e86\u3002\n\n\u6211\u63a8\u8350\u51e0\u9053\u9898\uff1a\n[p3374\u6811\u72b6\u6570\u7ec41](\uff08https://www.luogu.org/problemnew/show/p3374\uff09)  [p3810\u4e09\u7ef4\u504f\u5e8f](https://www.luogu.org/problemnew/show/p3810)  [p2163\u56ed\u4e01\u7684\u70e6\u607c](https://www.luogu.org/problemnew/show/p2163)  [p3157\u52a8\u6001\u9006\u5e8f\u5bf9](https://www.luogu.org/problemnew/show/p2163)\n\n## 2\u3001\u672c\u9898\u8bb2\u89e3\n\u6211\u4eec\u5148\u6765\u5206\u6790\u4e00\u4e0b\u4e3a\u4ec0\u4e48\u80fd\u7528CDQ\u5206\u6cbb\uff1a1\uff09\u4e00\u4e2a\u5e8f\u5217 2\uff09\u6709\u63d2\u5165\u6709\u67e5\u8be2\uff08\u53ea\u4e0d\u8fc7\u8fd9\u9053\u9898\u67e5\u8be2\u548c\u63d2\u5165\u5728\u4e00\u8d77\uff09 \n\n\u6ee1\u8db3\u8981\u6c42\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u4e0aCDQ\u5206\u6cbb\u4e86\u3002\u56e0\u4e3a\u662f\u8fde\u7eed\u7684\u5b50\u5e8f\u5217\uff0c\u6240\u4ee5\u6211\u4eec\u5f88\u5bb9\u6613\u60f3\u5230\u7528\u524d\u7f00\u548c\uff0c\u7528\u4e24\u70b9\u7684\u5dee\u4ee3\u8868\u5e8f\u5217\u3002\u63a5\u7740\u6839\u636e\u5e8f\u5217\u7684\u987a\u5e8f\u8fdb\u884cCDQ\u5206\u6cbb\uff0c\u5728CDQ\u5206\u6cbb\u91cc\u9762\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u961f\u5217\u7ef4\u62a4\u5e8f\u5217\u548c\u5927\u4e8e\u7b49\u4e8e$L$\u548c\u5c0f\u4e8e\u7b49\u4e8e$R$\u7684\u4f4d\u7f6e\uff0c\u56e0\u4e3aCDQ\u5206\u6cbb\u540e\uff0c\u5de6\u533a\u95f4\u548c\u53f3\u533a\u95f4\u5185\u7684\u503c\u90fd\u662f\u6709\u5e8f\u9012\u589e\u7684\uff0c\u90a3\u4e48$L$\u548c$R$\u7684\u6ee1\u8db3\u7684\u4e0b\u6807\u4e5f\u662f\u9012\u589e\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528\u961f\u5217\u7ef4\u62a4\u8fb9\u754c\u3002\n\n\u4e0a\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define MAXN 100010\nint n,vl,vr,sum[MAXN],tmp[MAXN],q[MAXN],ans;\n\nvoid CDQ(int l, int r){\n\tif(l == r) return;\n\tint mid = l+r>>1;\n\tCDQ(l,mid); CDQ(mid+1,r);\n\tint p1 = l, p2 = mid+1, t = l-1, cur = l-1, cl = l, cr = l;\n\twhile(p1 <= mid && p2 <= r){\n\t\tif(sum[p1] <= sum[p2]){//\u5f52\u5e76\u6392\u5e8f\uff0c\u6bd4\u8f83\u503c\n\t\t\tq[++cur] = sum[p1];\n\t\t\ttmp[++t] = sum[p1++];\n\t\t}else{\n\t\t\twhile(cl<=cur && sum[p2]-q[cl] >= vl) cl++;\n\t\t\twhile(cr<=cur && sum[p2]-q[cr] > vr) cr++;\n\t\t\tans += cl-cr;\n\t\t\ttmp[++t] = sum[p2++];\n\t\t}\n\t}\n\twhile(p1 <= mid){\n\t\ttmp[++t] = sum[p1++];\n\t}\n\twhile(p2 <= r){\n\t\twhile(cl<=cur && sum[p2]-q[cl] >= vl) cl++;\n\t\twhile(cr<=cur && sum[p2]-q[cr] > vr) cr++;\n\t\tans += cl-cr;\n\t\ttmp[++t] = sum[p2++];\n\t}\n\tfor(int i=l; i<=r; i++){\n\t\tsum[i] = tmp[i];\n\t}\n}\n\nint main(){\n\tscanf(\"%d%d%d\",&n,&vl,&vr);\n\tfor(int i=1; i<=n; i++){\n\t\tscanf(\"%d\",&sum[i]);\n\t\tsum[i] += sum[i-1];\n\t}\n\tCDQ(0,n);//\u6ce8\u610f\u8981\u4ece0\u5f00\u59cb\uff0c\u56e0\u4e3a\u662f\u8bb0\u5f55\u524d\u7f00\u548c\uff0c\u4e0d\u71361\u7684\u503c\u6ca1\u6cd5\u8868\u793a\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n\n```\n\u81ea\u5df1\u7684\u4ee3\u7801\u5b9e\u5728\u6709\u70b9\u4e11\uff0c\u53ef\u80fd\u662f\u6700\u521d\u5b66\u7684CDQ\u5206\u6cbb\u6a21\u677f\u4e0d\u4e00\u6837\uff0c\u5bfc\u81f4\u81ea\u5df1\u7684\u7248\u672c\u7684CDQ\u5206\u6cbb\u592a\u957f\u4e86\u3002\u8fd8\u6709\u6709\u4eba\u7528sort\u5728CDQ\u5206\u6cbb\u91cc\u9762\u6392\u5e8f\uff0c\u5f88\u7b80\u6d01\u7f8e\u89c2\uff0c\u4e0d\u8fc7\u4e0d\u662f\u7a33\u5b9a\u7684$O(logn)$\u590d\u6742\u5ea6\u3002",
        "postTime": 1563677344,
        "uid": 173068,
        "name": "Robert2259960864",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5459 \u3010[BJOI2016]\u56de\u8f6c\u5bff\u53f8\u3011"
    },
    {
        "content": "\u771f\u5b9e\u96be\u5ea6\u9ec4\u9898\u3002\n\n\u4ee4 $b_i=\\sum\\limits_{k=1}^ia_k$\uff0c$b_0=0$ \u3002\n\n\u5219\u9898\u610f\u53ef\u8f6c\u5316\u4e3a\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $b_i$ \uff0c\u5728 $0\\sim i-1$ \u4e2d\u6709\u591a\u5c11\u4e2a $j$ \u6ee1\u8db3 $b_j\\in[b_i-R,b_i-L]$ \u3002\n\n\u663e\u7136\u53ef\u4ee5\u7528\u5e73\u8861\u6811\u7ef4\u62a4\u3002\n\n\u4e0d\u8fc7\u672c\u9898\u6570\u636e $\\texttt{1e5}$ \uff0c\u6b6a\u89e3\u968f\u4fbf\u8fc7\uff0c\u4f7f\u7528 $\\texttt{vector}$ \u7ef4\u62a4\u4e00\u4e0b\u63d2\u6392\u6570\u7ec4\uff0c\u6bcf\u6b21\u8be2\u95ee\u65f6 $\\texttt{vector}$ \u4e0a\u4e8c\u5206\u4e00\u4e0b\u5c31\u884c\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define inf 0x7fffffff\n#define timeused() (double)clock()/CLOCKS_PER_SEC\n#define rep(i,a,b) for(register int i=a,i##end=b;i<=i##end;++i)\n#define repp(i,a,b) for(register int i=a,i##end=b;i>=i##end;--i)\n#define mp make_pair\n#define pb push_back\ntypedef long long ll;\ntypedef unsigned long long ull;\ntemplate<typename T> inline T rd(T& x){\n   T f=1;x=0;char c=getchar();\n   for(;!isdigit(c);c=getchar()) if(c=='-') f=-1;\n   for(; isdigit(c);c=getchar()) x=(x<<3)+(x<<1)+(T)(c-'0');\n   x*=f;\n   return x;\n}\nll n,l,r,a[100005],sum;\nvector<ll> v;\nint main(){\n   rd(n);\n   rd(l);\n   rd(r);\n   v.pb(0);\n   rep(i,1,n){\n      rd(a[i]);\n      a[i]+=a[i-1];\n      sum+=v.size()-(lower_bound(v.begin(),v.end(),a[i]-r)-v.begin());\n      sum-=v.size()-(upper_bound(v.begin(),v.end(),a[i]-l)-v.begin());\n      v.insert(lower_bound(v.begin(),v.end(),a[i]),a[i]);\n   }\n   printf(\"%lld\",sum);\n}\n```\n",
        "postTime": 1622336026,
        "uid": 223797,
        "name": "Remake_",
        "ccfLevel": 7,
        "title": "P5459 [BJOI2016]\u56de\u8f6c\u5bff\u53f8 \u9898\u89e3"
    },
    {
        "content": "\u95ee\u9898\u53ef\u4ee5\u7b80\u5316\u6210\u6709\u591a\u5c11\u4e2a $l,r$ \u6ee1\u8db3 $L \\leq \\sum\\limits_{i=l}^r a_i \\leq R$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u628a $\\sum\\limits_{i=l}^r a_i$ \u8868\u793a\u6210\u524d\u7f00\u548c\u76f8\u51cf\uff0c\u5373 $\\sum\\limits_{i=1}^r a_i - \\sum\\limits_{i=1}^{l-1} a_i$\u3002\n\n\u7136\u540e\u6211\u4eec\u4ece\u5de6\u5f80\u53f3\u4f9d\u6b21\u679a\u4e3e\u6bcf\u4e2a\u53f3\u7aef\u70b9\uff0c\u6765\u8003\u8651\u6709\u591a\u5c11\u4e2a\u6ee1\u8db3\u8981\u6c42\u7684\u5de6\u7aef\u70b9\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u63a8\u5f97\uff1a\n\n$\\sum\\limits_{i=1}^r a_i - R \\leq \\sum\\limits_{i=1}^{l-1}a_i \\leq \\sum\\limits_{i=1}^ra_i - L$\n\n\u7528\u67d0\u4e2a\u795e\u5947\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u5c31\u884c\u4e86\uff0c\u5c31\u6bd4\u5982\u5e73\u8861\u6811\u3001\u503c\u57df\u7ebf\u6bb5\u6811\u3001\u503c\u57df\u6811\u72b6\u6570\u7ec4\u3002\n\n\u83dc\u9e21\u7528\u7684\u503c\u57df\u6811\u72b6\u6570\u7ec4\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<stdio.h>\n#include<algorithm>\nconst int maxn=100001;long long qwq[maxn];int a[maxn],C[maxn+1],n,m,l,r;\ninline int lowbit(int x){return x&-x;}\ninline void ins(int x){for(;x<=m;x+=lowbit(x))++C[x];}\ninline int rank(int x){int ans=0;for(;x;x-=lowbit(x))ans+=C[x];return ans;}\ninline int key(long long x){return std::lower_bound(qwq,qwq+m,x)-qwq;}\nint main(){\n    scanf(\"%d%d%d\",&n,&l,&r);\n    for(int i=1;i<=n;++i)scanf(\"%d\",a+i),qwq[i]=qwq[i-1]+a[i];\n    std::sort(qwq,qwq+n+1);m=std::unique(qwq,qwq+n+1)-qwq;\n    long long sum=1,ans=0;ins(key(1));\n    for(int i=1;i<=n;++i){\n        sum+=a[i];\n        ans+=rank(key(sum-l))-rank(key(sum-r-1));\n        ins(key(sum));\n    }\n    printf(\"%lld\",ans);\n    return 0;\n}\n```",
        "postTime": 1622297929,
        "uid": 203008,
        "name": "toaru",
        "ccfLevel": 5,
        "title": "P5459 [BJOI2016]\u56de\u8f6c\u5bff\u53f8 \u9898\u89e3"
    },
    {
        "content": "\u9996\u5148\u62ff\u5230\u8fd9\u9053\u9898\u65f6\u6211\u5148\u60f3\u7684\u662f $N^2$ \u7684\u66b4\u529b\u505a\u6cd5\uff0c\u53ea\u9700\u8981\u5904\u7406\u4e00\u4e2a\u524d\u7f00\u548c\u540e\u679a\u4e3e\u5de6\u53f3\u7aef\u70b9\u5224\u65ad\u662f\u5426\u6ee1\u8db3\u9898\u76ee\u6240\u7ed9\u6761\u4ef6\u7136\u540e\u7d2f\u52a0\u7b54\u6848\u5373\u53ef\uff0c\u4f46\u662f\u6570\u636e\u8303\u56f4 $N\\leqslant10^5$ \u76f4\u63a5\u706d\u6740\u4e86\u6211\u4eec\u7684\u8fd9\u4e2a\u5ff5\u5934\uff0c\u4e8e\u662f\u601d\u8003\u5982\u4f55\u5bf9\u8fd9\u4e2a\u601d\u8def\u8fdb\u884c\u4f18\u5316\u3002\n\n\u4f17\u6240\u5468\u77e5\u7684\u662f\uff0c\u4e3b\u5e2d\u6811\u5373\u53ef\u4ee5\u770b\u4f5c\u4e00\u4e2a\u524d\u7f00\u548c\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u53c8\u6070\u597d\u662f $O(N\\log N)$ \u6240\u4ee5\u6211\u4eec\u8fd9\u9053\u9898\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e3b\u5e2d\u6811\u6765\u4f18\u5316\u524d\u7f00\u548c\u3002\n\n\u7531\u4e8e\u8981\u6ee1\u8db3 $L \\leqslant sum[r]-sum[l-1] \\leqslant R$\n\n\u79fb\u9879\u53ef\u5f97,\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u53f3\u7aef\u70b9 $r$ \uff0c\u53ea\u9700\u8981\u627e\u51fa\u6ee1\u8db3 $sum[r]-R\\leqslant sum[l-1] \\leqslant sum[r]-L$ \u7684\u5de6\u7aef\u70b9\u5373\u53ef\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u679a\u4e3e\u6bcf\u4e00\u4e2a\u53f3\u7aef\u70b9\uff0c\u627e\u51fa\u6ee1\u8db3\u6761\u4ef6\u7684\u5de6\u7aef\u70b9\u4e2a\u6570\u5e76\u7d2f\u52a0\u7b54\u6848\uff0c\u7136\u540e\u5c06\u8fd9\u4e2a\u53f3\u7aef\u70b9\u7684\u524d\u7f00\u548c\u52a0\u5165\u4e3b\u5e2d\u6811\u7ee7\u7eed\u4e0b\u4e00\u4e2a\u679a\u4e3e\uff0c\u6700\u540e\u5c31\u53ef\u4ee5\u5f97\u5230\u7b54\u6848\u3002\n\n\u77e5\u9053\u4e86\u8fd9\u4e2a\u4e4b\u540e\uff0c\u4ee3\u7801\u5b9e\u73b0\u5c31\u5f88\u7b80\u5355\u3002\n\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\nusing namespace std;\ntypedef long long ll;\nconst int N = 1e5 + 5;\nconst ll MAXN = 1e10 + 1e5 + 5;\nint n, L, R;\nint tot;\nstruct Node{\n    int ls, rs;\n    int cnt;\n} Tree[N * 100];\nll sum[N];\nvoid insert(int now,ll l,ll r,ll x)\n{\n    if(l==r)\n    {\n        Tree[now].cnt++;\n        return;\n    }\n    ll mid = l + r >> 1;\n    if(x<=mid)\n    {\n        if(!Tree[now].ls)\n            Tree[now].ls = ++tot;\n        insert(Tree[now].ls, l, mid, x);\n    }\n    else \n    {\n        if(!Tree[now].rs)\n            Tree[now].rs = ++tot;\n        insert(Tree[now].rs, mid + 1, r, x);\n    }\n    Tree[now].cnt = Tree[Tree[now].ls].cnt + Tree[Tree[now].rs].cnt;\n}\nint query(int now, ll l, ll r, ll ql, ll qr) \n{\n    if(!Tree[now].cnt||!now)\n        return 0;\n    if(ql<=l&&r<=qr)\n        return Tree[now].cnt;\n    ll mid = l + r >> 1;\n    int res = 0;\n    if(ql<=mid)\n        res += query(Tree[now].ls, l, mid, ql, qr);\n    if(qr>mid)\n        res += query(Tree[now].rs, mid + 1, r, ql, qr);\n    return res;\n}\nint main()\n{\n    scanf(\"%d%d%d\", &n, &L, &R);\n    for (int i = 1; i <= n;i++)\n    {\n        int a;\n        scanf(\"%d\", &a);\n        sum[i] = sum[i - 1] + a;\n    }\n    ll ans = 0;\n    tot = 1;\n    insert(1, 1, MAXN << 1, MAXN);\n    for (int r = 1; r <= n;r++)\n    {\n        ans += query(1, 1, MAXN << 1, sum[r] - R + MAXN, sum[r] - L + MAXN);\n        insert(1, 1, MAXN << 1, sum[r] + MAXN);\n    }\n    printf(\"%lld\\n\", ans);\n}\n```\n",
        "postTime": 1614516682,
        "uid": 278481,
        "name": "Link_Space",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 OF  [BJOI2016]\u56de\u8f6c\u5bff\u53f8\uff08P5459\uff09"
    },
    {
        "content": "\u629b\u5f00\u90a3\u4e9b\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\uff08\u6211\u7ecf\u5e38\u5199\u4e0d\u51fa\u7684\u90a3\u79cd\uff09\uff0c\u6765\u770b\u4e00\u770b\u8fd9\u9898\u7684\u6570\u636e\n\n\u9996\u5148\u5904\u7406\u524d\u7f00\u548c\uff0cs[0]=0,s[n]=s[n-1]+a[n];\n\n\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e9b\u524d\u7f00\u548c\u7684**\u6570\u636e\u70b9**\u653e\u5230\u4e00\u4e2a\u56fe\u4e2d\uff0c\u4ece1\u5230n\u6392\u597d\n\n\u8981\u6c42\u7684\u4e5f\u5c31\u662f\u5bf9\u4e8e\u6bcf\u4e00\u4e2a**\u6570\u636e\u70b9**n\uff0c\u5728\u4ed6\u524d\u9762\u7684\u524d\u7f00\u548cs[n]-l<=s[i]<=s[n]-r\u7684\u4e2a\u6570\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u8fd9\u4e2a**\u6570\u636e\u70b9**\u7684\u4f4d\u7f6e\u4e0a\u589e\u52a0\u4e24\u4e2a**\u8be2\u95ee\u70b9**\uff0c\u503c\u5206\u522b\u4e3as[n]-(l-1)\u548cs[n]-r,**\u8be2\u95ee\u70b9**\u53ef\u4ee5\u8bb0\u5f55n\u4e4b\u524d\u6709\u591a\u5c11\u4e2a\u524d\u7f00\u548c\u7684**\u6570\u636e\u70b9**\u5c0f\u4e8e\u7b49\u4e8e\u8be2\u95ee\u503c\n\n\u90a3\u4e48\u6211\u4eec\u628a\u8fd9\u4e9b\u70b9\u753b\u5728\u4e00\u4e2a\u56fe\u4e0a\uff08**\u8be2\u95ee\u70b9**\u753b\u5728**\u6570\u636e\u70b9**\u540e\u9762\uff09\uff0c\u5c31\u53d1\u73b0\u8fd9\u4e9b\u70b9\u6784\u6210\u4e00\u4e2a\u5e8f\u5217\uff0c\u6211\u4eec\u628a**\u6570\u636e\u70b9**\u7684\u6743\u503c\u5b9a\u4e3a1\uff0c**\u8be2\u95ee\u70b9**\u7684\u6743\u503c\u5b9a\u4e3a0\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e2a**\u8be2\u95ee\u70b9**\uff0c\u6c42\u51fa\u5176\u4e4b\u524d\u6240\u6709\u6570\u503c\u4e0d\u5927\u4e8e\u4ed6\u7684\u70b9\u7684\u6743\u503c\u548c\uff0c\u5c31\u662f\u5403\u5230n\u4e3a\u6b62\u6ee1\u8db3\u6761\u4ef6\u7684\u4e2a\u6570\n\n### \u6700\u7b80\u5355\u7684\u505a\u6cd5\u5c31\u662f\u5c06\u6574\u4e2a\u6570\u5217\u5f52\u5e76\u6392\u5e8f\u6c42\u9006\u5e8f\u6743\u503c\u548c\n\n\u4e0d\u4f1a\u6c42\u9006\u5e8f\u5bf9\u7684\u770b\u8fd9\u4e2a\n[\u9006\u5e8f\u5bf9\u6a21\u677f](https://www.luogu.com.cn/problem/P1908)\n\n\u6a21\u677f\u91cc\u9762\u5c31\u662f\u6bcf\u4e2a\u6570\u6743\u503c\u4e3a1\u7684\u7279\u6b8a\u60c5\u5f62\uff0c\u628a\u4ed6\u4e00\u822c\u5316\uff0c\u7d2f\u52a0\u7684\u65f6\u5019\u52a0\u6743\u503c\u800c\u4e0d\u662f\u7b80\u5355+1\u5c31ok\u4e86\n# \u4ee3\u7801\u5982\u4e0b\n```cpp\n#include <iostream>\n#include <algorithm>\nusing namespace std;\ntypedef long long ll;\nll a0=0;\nstruct vs{\n\tll p, n, val, d;\n}vc[400001];\nbool operator<(vs a,vs b)\n{\n\treturn a.n<b.n||(a.n==b.n&&a.d>b.d);\n}\nll a[400001],ans[400001],rq[400001];\nvs s0[400001];\nvoid mgsort(ll l,ll r)\n{\n\tif (l==r) return;\n\tll mid=(l+r)/2;\n\tmgsort(l,mid);\n\tmgsort(mid+1,r);\n\tll a=l,b=mid+1;\n\tll m=0,r0=0;\n\twhile (1)\n\t{\n\t\tif (a>mid&&b>r) break;\n\t\tif (a>mid)\n\t\t{\n\t\t\ts0[++m]=vc[b];\n\t\t\tans[vc[b].d]+=r0;\n\t\t\tb++;\n\t\t\tcontinue;\n\t\t}\n\t\tif (b>r)\n\t\t{\n\t\t\ts0[++m]=vc[a];\n\t\t\tr0+=vc[a].val;\n\t\t\ta++;\n\t\t\tcontinue;\n\t\t}\n\t\tif (vc[a].p>=vc[b].p)\n\t\t{\n\t\t\ts0[++m]=vc[a];\n\t\t\tr0+=vc[a].val;\n\t\t\ta++;\n\t\t}\n\t\telse {\n\t\t\ts0[++m]=vc[b];\n\t\t\tans[vc[b].d]+=r0;\n\t\t\tb++;\n\t\t}\n\t}\n\tfor (ll i=l;i<=r;i++)\n\t\tvc[i]=s0[i-l+1];\n}\nint main()\n{\n\tll n,l,r;\n\tcin>>n>>l>>r;\n\tvc[0].p=0;\n\tvc[0].n=0;\n\tvc[0].d=0;\n\tvc[0].val=1;\n\tfor (ll i=1;i<=n;i++){\n\t\tcin>>a[i];\n\t\tvc[i].p=vc[i-1].p+a[i];\n\t\tvc[i].n=vc[i].d=i;\n\t\tvc[i].val=1;\n\t}\n\tfor (ll i=1;i<=n;i++)\n\t{\n\t\tvc[i+n].p=vc[i].p-r;\n\t\tvc[i+n].n=i;\n\t\tvc[i+n].d=i+n;\n\t\tvc[i+n].val=0;\n\t}\n\tfor (ll i=1;i<=n;i++)\n\t{\n\t\tvc[i+2*n].p=vc[i].p-l+1;\n\t\tvc[i+2*n].n=i;\n\t\tvc[i+2*n].d=i+2*n;\n\t\tvc[i+2*n].val=0;\n\t}\n\tsort(vc+1,vc+3*n+1);\n\tll sum=0;\n\tfor (ll i=1;i<=n;i++)\n\t\tsum+=ans[i+n]-ans[i+2*n];\n\tcout<<sum<<endl;\n}\n```\n",
        "postTime": 1587801811,
        "uid": 57978,
        "name": "\u80e1\u5c14\u514bHULK",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5459 \u3010[BJOI2016]\u56de\u8f6c\u5bff\u53f8\u3011"
    },
    {
        "content": "\u9996\u5148\u5bf9$a_i$\u6c42\u524d\u7f00\u548c$s_i$\n\n\u6211\u4eec\u8981\u6c42\u6709\u591a\u5c11\u5bf9$(l,r)$\uff0c\u6ee1\u8db3$L\\leq s_r-s_{l-1}\\leq R$\n\n\u53d8\u5f62\u4e00\u4e0b\u5c31\u662f$s_r-R\\leq s_{l-1}\\leq s_r-L$\n\n\u90a3\u4e48\u679a\u4e3e\u53f3\u7aef\u70b9$r$\uff0c\u67e5\u8be2\u5728\u8fd9\u4e2a\u503c\u57df\u8303\u56f4\u5185\u7684\u6570\u6709\u591a\u5c11\u4e2a\uff0c\u7528\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4\u5373\u53ef\uff0c\u67e5\u5b8c\u628a$s_r$\u52a0\u8fdb\u6811\u72b6\u6570\u7ec4\u3002\n\n\u4e00\u5f00\u59cb\u5c06\u6240\u6709\u7684$s_i,s_i-L,s_i-R$\u6df7\u5728\u4e00\u8d77\u79bb\u6563\u5316\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n\\log n)$\n\n```cpp\n#include <cctype>\n#include <cstdio>\n#include <climits>\n#include <algorithm>\n\ntemplate <typename T> inline void read(T& x) {\n    int f = 0, c = getchar(); x = 0;\n    while (!isdigit(c)) f |= c == '-', c = getchar();\n    while (isdigit(c)) x = x * 10 + c - 48, c = getchar();\n    if (f) x = -x;\n}\ntemplate <typename T, typename... Args>\ninline void read(T& x, Args&... args) {\n    read(x); read(args...); \n}\ntemplate <typename T> void write(T x) {\n    if (x < 0) x = -x, putchar('-');\n    if (x > 9) write(x / 10);\n    putchar(x % 10 + 48);\n}\ntemplate <typename T> inline void writeln(T x) { write(x); puts(\"\"); }\ntemplate <typename T> inline bool chkmin(T& x, const T& y) { return y < x ? (x = y, true) : false; }\ntemplate <typename T> inline bool chkmax(T& x, const T& y) { return x < y ? (x = y, true) : false; }\n\ntypedef long long LL;\n\nconst int maxn = 1e5 + 307, maxsize = 3e5 + 207;\n\nLL bit[maxsize], a[maxn], s[maxn], tmp[maxsize];\nint n, L, R, all;\n\ninline int query(int l, int r) {\n    int ans = 0;\n    for (; r; r -= r & -r) ans += bit[r];\n    for (--l; l; l -= l & -l) ans -= bit[l];\n    return ans;\n}\ninline void insert(int x) {\n    for (; x <= all; x += x & -x) ++bit[x];\n}\n\nint main() {\n    read(n, L, R);\n    tmp[++all] = 0;\n    for (int i = 1; i <= n; ++i) {\n        read(a[i]);\n        s[i] = s[i - 1] + a[i];\n        tmp[++all] = s[i];\n        tmp[++all] = s[i] - L;\n        tmp[++all] = s[i] - R;\n    }\n    std::sort(tmp + 1, tmp + all + 1);\n    all = std::unique(tmp + 1, tmp + all + 1) - (tmp + 1);\n    LL ans = 0;\n    insert(std::lower_bound(tmp + 1, tmp + all + 1, 0) - tmp);\n    for (int r = 1; r <= n; ++r) {\n        int x = std::lower_bound(tmp + 1, tmp + all + 1, s[r] - R) - tmp;\n        int y = std::lower_bound(tmp + 1, tmp + all + 1, s[r] - L) - tmp;\n        ans += query(x, y);\n        int z = std::lower_bound(tmp + 1, tmp + all + 1, s[r]) - tmp;\n        insert(z);\n    }\n    writeln(ans);\n    return 0;\n}\n```\n",
        "postTime": 1562943788,
        "uid": 72071,
        "name": "GKxx",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5459 \u3010[BJOI2016]\u56de\u8f6c\u5bff\u53f8\u3011"
    },
    {
        "content": "## \u9898\u76ee\u63cf\u8ff0\n\n\u6c42\u4e00\u4e2a\u5b50\u5e8f\u5217\uff0c\u4f7f\u5b50\u5e8f\u5217\u7684\u548c\u5927\u4e8e\u7b49\u4e8e $L$ \u5c0f\u4e8e\u7b49\u4e8e $R$ \u7684\u65b9\u6848\u6570\u3002\n\n## \u7ebf\u6bb5\u6811\u89e3\u6cd5\n\n\u8003\u8651\u7528\u524d\u7f00\u548c\u4f18\u5316\u3002\n\n\u5c06\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42 $L\\leq sum_{r} - sum_{l} \\leq R$\u3002 \u76f4\u63a5 $\\Theta(n^2)$ \u66b4\u529b\u6c42\u89e3\uff0c\u663e\u7136\u4f1a\u6302\u3002\n\n\u5c06\u5f0f\u5b50\u53d8\u5f62\u4e3a $sum_{r} - R\\leq sum_{l}\\leq sum_{r} - L$\u3002 \u6bcf\u6b21\u63d2\u5165\u4e00\u4e2a\u503c\u4e4b\u524d\uff0c\u67e5\u8be2\u5b83\u4e4b\u524d\u6ee1\u8db3\u6761\u4ef6\u7684\u65b9\u6848\u6570\uff0c\u518d\u63d2\u5165\u3002**\u6ce8\u610f\u4e00\u5f00\u59cb\u8981\u63d2\u5165 $sum_{0}$\u3002**\n\n\u8003\u8651\u5230\u7a7a\u95f4\u95ee\u9898\uff0c\u91c7\u7528\u52a8\u6001\u5f00\u70b9\u3002\n\n## \u4ee3\u7801\u5c55\u793a\n\n```cpp\n#include<cstdio>\n#define LL long long\nusing namespace std;\n\nconst int MAXN = 1e5 + 5;\nconst LL INF = 1e10;\n\nint n, l, r, root, tot;\nLL sum[MAXN];\n\nstruct node {\n\tint l, r;\n\tLL val;\n}tr[MAXN * 20];\n\nvoid updata(int &now, LL lf, LL rg, LL val) {\n\tif(now == 0) {\n\t\tnow = ++tot;\n\t\ttr[now].l = tr[now].r = tr[now].val = 0;\n\t}\n\t++tr[now].val;\n\tif(lf == rg) return ;\n\tLL mid = (lf + rg) >> 1ll;\n\tif(val <= mid) updata(tr[now].l, lf, mid, val);\n\telse updata(tr[now].r, mid + 1, rg, val);\n}\n\nLL query(int &now, LL lf, LL rg, LL L, LL R) {\n\tif(!now || lf > R || rg < L) return 0;\n\tif(L <= lf && rg <= R) return tr[now].val;\n\tLL mid = (lf + rg) >> 1ll;\n\tLL res = 0ll;\n\tif(L <= mid) res = query(tr[now].l, lf, mid, L, R);\n\tif(R > mid) res += query(tr[now].r, mid + 1, rg, L, R);\n\treturn res;\n}\n\nint main() {\n\tscanf(\"%d%d%d\",&n, &l, &r);\n\tfor(int i = 1; i <= n; i++) {\n\t\tscanf(\"%lld\",&sum[i]);\n\t\tsum[i] += sum[i - 1];\n\t}\n\tupdata(root, -INF, INF, 0ll);\n\tLL res = 0ll;\n\tfor(int i = 1; i <= n; i++) {\n\t\tres += query(root, -INF, INF, sum[i] - r, sum[i] - l);\n\t\tupdata(root, -INF, INF, sum[i]);\n\t}\n\tprintf(\"%lld\\n\",res);\n\treturn 0;\n}\n```\n",
        "postTime": 1617706150,
        "uid": 304556,
        "name": "zym417",
        "ccfLevel": 7,
        "title": "\u56de\u8f6c\u5bff\u53f8"
    },
    {
        "content": "# Link\n[P5459 [BJOI2016]\u56de\u8f6c\u5bff\u53f8](https://www.luogu.com.cn/problem/P5459)\n\n# Solve\n\u8fd9\u9053\u9898\u7684\u9898\u9762\u63cf\u8ff0\u53ef\u80fd\u6709\u70b9\u95ee\u9898\uff0c\u8fd9\u9053\u9898\u9898\u9762\u4e0a\u8bf4\u662f\u5b50\u5e8f\u5217\uff0c\u5b9e\u9645\u4e0a\u9009\u7684\u662f\u4e00\u4e2a\u8fde\u7eed\u7684\u5b50\u5e8f\u5217\u3002\n\n\u7531\u4e8e\u6bcf\u6b21\u53ea\u80fd\u9009\u8fde\u7eed\u7684\u4e00\u6bb5\uff0c\u6211\u4eec\u5c31\u6c42\u4e00\u4e2a\u524d\u7f00\u548c$S[i]= \\sum_{j=1}^ia[i]$\n\n\u9898\u76ee\u95ee\u7684\u662f\u8fde\u7eed\u4e00\u6bb5\u7684\u603b\u4ee3\u4ef7\u5728$[L,R]$\uff0c\u6240\u4ee5\n\n$L\u2264 \\sum_{k=i}^{j} a[i]\u2264R$ $\\Rightarrow L\u2264S[i]-S[j-1]\u2264R$\n\n$\\Rightarrow S[i]-R\u2264S[j-1]\u2264S[i]-L,(j\u2264i)$\n\n\u9898\u76ee\u5c31\u8f6c\u5316\u6210\uff0c\u679a\u4e3e\u5230\u4e00\u4e2a$S[i]$\u6c42\u4e4b\u524d\u7684\uff0c\u5728$[S[i]-R,S[i]-L]$\u4e0a$S[j]$\u7684\u4e2a\u6570\n\n\u7528\u6811\u72b6\u6570\u7ec4\u6216\u8005\u7ebf\u6bb5\u6811\u5c31\u53ef\u4ee5\u5904\u7406\u4e86\n\n# Code\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nconst int maxn=100005;\nconst LL maxR=1e10;\nint N,tot,root;\nLL L,R,S[maxn],ans;\nstruct node{\n\tint lson,rson,sum;\n}Tree[13600005];\ninline int read(){\n\tint ret=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-f;ch=getchar();}\n\twhile(ch<='9'&&ch>='0')ret=ret*10+ch-'0',ch=getchar();\n\treturn ret*f;\n}\n\ninline void push_up(int x){\n\tTree[x].sum=Tree[Tree[x].lson].sum+Tree[Tree[x].rson].sum;\n\treturn ;\n}\n\ninline int build(){\n\t++tot;Tree[tot].lson=Tree[tot].rson=Tree[tot].sum=0;\n\treturn tot;\n}\n\nint update(int x,LL l,LL r,LL pos,int val){\n\tif(!x)x=build();\n\tif(l==r){Tree[x].sum+=val;return x;}\n\tLL mid=r+l>>1;\n\tif(pos<=mid)Tree[x].lson=update(Tree[x].lson,l,mid,pos,val);\n\telse Tree[x].rson=update(Tree[x].rson,mid+1,r,pos,val);\n\tpush_up(x);\n\treturn x;\n}\n\nint query(int x,LL l,LL r,LL ql,LL qr){\n\tif(!x)x=build();\n\tif(ql<=l&&r<=qr)return Tree[x].sum;\n\tLL ret=0,mid=l+r>>1;\n\tif(ql<=mid)  ret+=query(Tree[x].lson,l,mid,ql,qr);\n\tif(qr> mid)ret+=query(Tree[x].rson,mid+1,r,ql,qr);\n\treturn ret;\n}\n\nint main(){\n\tfreopen(\"P5459.in\",\"r\",stdin);\n\tfreopen(\"P5459.out\",\"w\",stdout);\n\tN=read();L=read();R=read();\n\tfor(int i=1;i<=N;i++)S[i]=S[i-1]+read();\n\troot=update(root,-maxR,maxR,S[0],1);\n\tfor(int i=1;i<=N;i++){\n\t\tans+=query(root,-maxR,maxR,S[i]-R,S[i]-L);\n\t\tupdate(root,-maxR,maxR,S[i],1);\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1607041189,
        "uid": 128822,
        "name": "OI\u754c\u7684\u5c0f\u6df7\u6df7",
        "ccfLevel": 6,
        "title": "P5459 [BJOI2016]\u56de\u8f6c\u5bff\u53f8 \u9898\u89e3"
    },
    {
        "content": "# P5459 [BJOI2016]\u56de\u8f6c\u5bff\u53f8 \u9898\u89e3\n\n\n## [\u95f4\u9699](https://www.luogu.com.cn/problem/P5459)\n\n## \u524d\u7f6e\u77e5\u8bc6\n\n- ## \u524d\u7f00\u548c,\u6743\u503c\u7ebf\u6bb5\u6811,\u52a8\u6001\u5f00\u70b9\n\n\u5982\u679c\u60a8\u8fd8\u4e0d\u4f1a\u6743\u503c\u7ebf\u6bb5\u6811\u8ddf\u52a8\u6001\u5f00\u70b9\u7684\u8bdd,\u63a8\u8350\u53bb\u770b\u4e00\u4e0b[**\u8fd9\u4e2a\u6559\u7a0b**](https://www.bilibili.com/video/BV1Zg4y1q7aY?t=1726)\n\n## \u5927\u81f4\u9898\u610f\n\n\u7ed9\u4e00\u4e2a\u5e8f\u5217,\u73b0\u4ece\u4e2d\u53d6\u51fa\u4e00\u6bb5\u8fde\u7eed\u5b50\u5e8f\u5217,\u4f7f\u5176\u5b50\u5e8f\u5217\u5185\u6570\u503c\u603b\u548c$a$\u6ee1\u8db3$L\\le a\\le R$\n\n\u6c42\u603b\u65b9\u6848\u6570\u3002\n\n## \u5206\u6790\n\n\u533a\u95f4\u6c42\u548c,\u5f88\u5bb9\u6613\u5148\u8054\u60f3\u5230\u524d\u7f00\u548c\n\n\u4e0d\u59a8\u5148\u8bbe$sum[i]$\u4e3a\u524d$i$\u4e2a\u6570\u7684\u524d\u7f00\u548c\n\n\u6613\u5f97\u5f0f\u5b50:\n\n$L \\le sum[r] - sum[l-1] \\le R$\n\n\u79fb\u9879\u4e00\u4e0b\n\n$sum[r]-L \\le sum[l-1]  \\le sum[r]-R $\n\n\n\n\u8fd9\u6837\u539f\u95ee\u9898\u5c31\u8f6c\u5316\u4e3a\u4e86**\u5728\u533a\u95f4$[sum[r]-L,sum[r]-R]$\u4e2d\u6709\u591a\u5c11\u4e2a$sum[l-1]$($l \\in[1,r]$ )**\n\n**\u6bcf\u4e00\u4e2a$r$\u4e5f\u5c31\u76f8\u5f53\u4e8e\u662f\u67e5\u8be2\u533a\u95f4$[sum[r]-L,sum[r]-R]$\u4e2d$sum[l-1]$\u7684\u603b\u548c**($l \\in[1,r]$ )\n\n\u53ef\u4ee5\u4f7f\u7528\u6743\u503c\u7ebf\u6bb5\u6811$+$\u52a8\u6001\u5f00\u70b9\u6765\u7ef4\u62a4\u3002\n\n## \u4ee3\u7801\u5b9e\u73b0\n\n\u4ece$1$~$n$\u679a\u4e3e$r$\u7684\u503c,\u628a\u6bcf\u4e00\u4e2a$r$\u5f53\u4f5c\u4e00\u6b21\"\u67e5\u8be2\"\n\n\u540c\u65f6\u4e0d\u8981\u5fd8\u8bb0\u5728\u8fdb\u884c\u4e0b\u4e00\u6b21\"\u67e5\u8be2\" \u524d\u628a $l$ \u7684\u503c \"\u66f4\u65b0\"(\u6307\u63d2\u5165\u65b0\u7684\u503c)\n\n\u5177\u4f53\u7684\u6ce8\u91ca\u91cc\u6709\u8bb2\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nlong long MAXN = 1e10;\nconst int N = 1e5+5;\nlong long sum[N];//\u524d\u7f00\u548c \nint n,l,r;\nlong long ans = 0;\nint tot = 0;\nstruct st{\n\tint l,r,sum;//\u5de6\u513f\u5b50,\u53f3\u513f\u5b50,\u603b\u65b9\u6848\u6570 \n}tree[N<<10];\n\nvoid pushup(int node){//\u4e0a\u4f20\u64cd\u4f5c \n\ttree[node].sum = tree[tree[node].l].sum+tree[tree[node].r].sum;\n}\nvoid insert(int &node,long long x,long long l = -MAXN , long long r = MAXN){//\u66f4\u65b0 \u6ce8\u610f,l\u7684\u521d\u59cb\u503c\u8981\u8bbe\u6210\u8d1f\u6570,\u4e00\u5f00\u59cb\u5728\u8fd9\u91cc\u5361\u4e86\u597d\u4e45\\kk \n\t\n\tif(!node) node = ++tot;//\u52a8\u6001\u5f00\u70b9 \n\tif(l==r){//\u5982\u679c\u4e3a\u6839\u8282\u70b9 \n\t\ttree[node].sum++;\n\t\treturn;\n\t}\n\tlong long mid = (l + r)>>1;\n\tif(x<=mid) update(tree[node].l,x,l,mid);\n\telse update(tree[node].r,x,mid+1,r);\n\tpushup(node);//\u66f4\u65b0\u7236\u8282\u70b9\u7684\u503c \n\t\n}\n\nlong long query(int &node,long long x,long long y,long long l =-MAXN,long long r = MAXN){//\u67e5\u8be2\u64cd\u4f5c \n\tif(!node) node = ++tot;//\u52a8\u6001\u5f00\u70b9 \n\tif(x<=l&&y>=r){//\u5305\u542b\u5728\u67e5\u8be2\u8303\u56f4\u5185 \n\t\treturn tree[node].sum;\n\t}\n\tlong long res = 0;\n\tlong long mid = (l+r)>>1;\n\tif(x<=mid) res+=query(tree[node].l,x,y,l,mid); \n\tif(y>mid) res+=query(tree[node].r,x,y,mid+1,r); \n\treturn res;\n}\nint main(){\n\tint root = 0;\n\tscanf(\"%d%d%d\",&n,&l,&r);\n\tfor(int i=1;i<=n;i++){\n\t\tint a;\n\t\tscanf(\"%d\",&a);\n\t\tsum[i] = sum[i-1] + a;//\u524d\u7f00\u548c \n\t}\n\tinsert(root,0);//\u4e0d\u8981\u5fd8\u8bb0\u63d2\u51650,\u4e5f\u5c31\u662f\u8bf4\u4e00\u4e2a\u90fd\u4e0d\u5403\u7684\u60c5\u51b5 \n\tfor(int i=1;i<=n;i++){\n\t\tans+=query(root,sum[i] - r,sum[i] - l);//\u52a0\u65b9\u6848\u6570 \n\t\tinsert(root,sum[i]);//\"\u66f4\u65b0\"l\u7684\u503c \n\t}\n\tcout<<ans;\n} \n```\n\n\n\n\n\n",
        "postTime": 1596519881,
        "uid": 244466,
        "name": "xcxc82",
        "ccfLevel": 0,
        "title": "P5459 [BJOI2016]\u56de\u8f6c\u5bff\u53f8 \u9898\u89e3"
    },
    {
        "content": "\u9996\u5148\uff0c\u679a\u4e3e\u6bcf\u4e2a $r = 1 \\sim n$\uff0c  \n\u7edf\u8ba1\u5bf9\u4e8e\u6bcf\u4e2a $r$\uff0c\u6709\u591a\u5c11\u4e2a $l$ \u6ee1\u8db3\u6761\u4ef6\u3002  \n\u8003\u8651\u5982\u4f55\u7edf\u8ba1\uff1a  \n\u628a\u5e8f\u5217 $\\{a\\}$\u7684\u524d\u7f00\u548c\u8bb0\u4e3a $sum[i]$\u3002  \n\u95ee\u9898\u8f6c\u5316\u4e3a:  \n\u5bf9\u4e8e\u6bcf\u4e2a $r$\uff0c\u6709\u591a\u5c11 $l$ \u6ee1\u8db3  \n$L \\leq sum_r - sum_{l - 1} \\leq R$  \n\u79fb\u9879\uff0c\u5f97  \n$sum_r - R \\leq pre_{l - 1} \\leq sum_r -L$  \n\u53d1\u73b0\u53ea\u8981\u7edf\u8ba1   \n\u533a\u95f4$[sum_r - R,sum_r - L]$ \u91cc $sum_{l - 1}$\u7684\u51fa\u73b0\u6b21\u6570\u3002   \n\u7136\u540e\u7edf\u8ba1\u5b8c\u4e86\u63d2\u5165 $sum_r$ \u5373\u53ef\u3002  \n\u9898\u89e3\u533a\u91cc\u6709\u5f88\u591adalao\u7528\u6811\u72b6\u6570\u7ec4\uff0ccdq\u5206\u6cbb\u7b49\u89e3\u6cd5\u3002  \n\u6211\u4f7f\u7528\u7684\u662f\u5e73\u8861\u6811\uff0c\u4e2a\u4eba\u8ba4\u4e3a\u66f4\u52a0\u7b80\u5355\u6613\u61c2\u3002  \n~~\u5176\u5b9e\u662f\u6211\u8fd9\u4e9b\u90fd\u4e0d\u4f1a~~  \ncode\uff1a\n```\n#include <bits/stdc++.h>\n#define N 100031\n#define int long long\nusing namespace std;\n\nint n, L, R, cnt, root;\nint sum[N];\nint size[N], ch[N][2], val[N], rd[N];\n\ninline int read() {\n\tint x = 0, flag = 1;\n\tchar ch = getchar();\n\twhile (!isdigit(ch)) {\n\t\tif (ch == '-') flag = -1;\n\t\tch = getchar();\n\t}\n\twhile (isdigit(ch)) {\n\t\tx = x * 10 + ch - 48;\n\t\tch = getchar();\n\t}\n\treturn x * flag;\n}\n\nvoid update(int x) {size[x] = size[ch[x][0]] + size[ch[x][1]] + 1;}\n\nint new_node(int v) {\n\tsize[++cnt] = 1;\n\tval[cnt] = v;\n\trd[cnt] = rand();\n\treturn cnt;\n}\n\nvoid split(int now, int k, int &x, int &y) {\n\tif (!now) x = y = 0;\n\telse {\n\t\tif (val[now] <= k) {\n\t\t\tsplit(ch[now][1], k, ch[now][1], y);\n\t\t\tupdate(x = now);\n\t\t} else {\n\t\t\tsplit(ch[now][0], k, x, ch[now][0]);\n\t\t\tupdate(y = now);\n\t\t}\n\t}\n} \n\nint merge(int x, int y) {\n\tif (!x || !y) {\n\t\treturn x | y;\n\t}\n\tif (rd[x] > rd[y]) {\n\t\tch[x][1] = merge(ch[x][1], y);\n\t\tupdate(x);\n\t\treturn x;\n\t}\n\telse {\n\t\tch[y][0] = merge(x, ch[y][0]);\n\t\tupdate(y);\n\t\treturn y;\n\t}\n}\n\nvoid ins(int v) {\n    int x, y;\n\tsplit(root, v, x, y);\n\troot = merge(merge(x, new_node(v)), y);\n}\n\nint rk(int v) {\n    int x, y, res;\n\tsplit(root, v - 1, x, y);\n\tres = size[x];\n\troot = merge(x, y);\n\treturn res;\n}\n\nsigned main() {\n    srand(time(0));\n\tn = read(), L = read(), R = read();\n\tlong long ans = 0;\n\tfor (int i = 1; i <= n; ++i) {\n\t\tint x = read();\n\t\tsum[i] = sum[i - 1] + x;\n\t}\n\tfor (int i = 0; i <= n; ++i) {\n\t\tans += (rk(sum[i] - L + 1) - rk(sum[i] - R));\n\t\tins(sum[i]);\n\t}\n\tprintf(\"%lld\\n\", ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1569078507,
        "uid": 93286,
        "name": "Yuno",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5459 \u3010[BJOI2016]\u56de\u8f6c\u5bff\u53f8\u3011"
    },
    {
        "content": "\u4f3c\u4e4e\u6ca1\u6709\u4eba\u6253\u5e73\u8861\u6811\u7684\u9898\u89e3\uff0c\u90a3\u6211\u5c31\u6765\u6c34\u4e00\u53d1~\n\n\u6211\u4eec\u5c06\u9898\u76ee\u505a\u4e00\u4e2a\u7b80\u5355\u7684\u8f6c\u5316\uff1a\n\n\u8bbe$sum_i = \\sum_{j=1}^{i} a_j$\n\n\u90a3\u4e48\u7b54\u6848\u5c31\u662f$\\sum_{i=1}^{n}\\sum_{j=1}^{i} (L \\leq (sum_i - sum_{j-1}) \\leq R)$\n\n\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5bb9\u65a5\u7684\u601d\u60f3\u8fdb\u884c\u7b80\u5355\u662f\u8f6c\u5316\uff1a\n\n$\\sum_{i=1}^{n}\\sum_{j=1}^{i} (L \\leq (sum_i - sum_{j-1})) - \\sum_{i=1}^{n}\\sum_{j=1}^{i} (R < (sum_i - sum_{j-1}))$\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u53ea\u7528\u679a\u4e3e$sum_i$\uff0c\u5e76\u5728\u4e00\u4e2a\u53ef\u4ee5\u63a5\u53d7\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u5206\u522b\u627e\u5230\u76f8\u5bf9\u5e94\u7684$j$\u7684\u6570\u76ee\uff0c\u5373$sum_{j - 1} \\leq sum_i - L$\u7684$j$\u7684\u4e2a\u6570\u548c$sum_{j - 1} \\leq sum_i - R - 1$\u7684$j$\u7684\u6570\u91cf\uff0c\u5e76\u628a\u4ed6\u4eec\u76f8\u51cf\u3002\n\n\u800c\u67e5\u627e\u8fd9\u4e9b\u6570\u76ee\u5b8c\u5168\u53ef\u4ee5\u7528\u5e73\u8861\u6811\u6765\u5b9e\u73b0\uff0c\u4e0b\u9762\u7684\u4ee3\u7801\u6253\u7684\u662f$treap$\uff0c\u4ec5\u4f9b\u53c2\u8003\u3002\n\n\u6ce8\uff1a\u9898\u76ee\u7684\u6570\u636e\u8303\u56f4\u4f3c\u4e4e\u6709\u95ee\u9898\uff0c\u4f3c\u4e4e\u662f$0 \\leq L , R\\leq 10^9$\n\n```cpp\n#include <cstdio>\n#include <ctime>\n#include <algorithm>\nusing namespace std;\ntypedef long long LL;\nconst int MAXN = 1e5 + 5;\n\nstruct node {\n\tLL lc , rc , data , pri , si , cnt;\n}t[MAXN];\n\nvoid Zig(LL &k) {\n\tLL y = t[k].lc;\n\tt[k].lc = t[y].rc;\n\tt[y].rc = k;\n\tt[y].si = t[k].si;\n\tt[k].si = t[t[k].lc].si + t[t[k].rc].si + t[k].cnt;\n\tk = y;\n}\n\nvoid Zag(LL &k) {\n\tLL y = t[k].rc;\n\tt[k].rc = t[y].lc;\n\tt[y].lc = k;\n\tt[y].si = t[k].si;\n\tt[k].si = t[t[k].lc].si + t[t[k].rc].si + t[k].cnt;\n\tk = y;\n}\n\nLL num = 0;\nvoid Insert(LL &k , LL key) {\n\tif(!k) {\n\t\tk = ++num;\n\t\tt[k].data = key;t[k].pri = rand();\n\t\tt[k].si = 1;t[k].cnt = 1;\n\t\treturn;\n\t} \n\tt[k].si ++;\n\tif(t[k].data == key) t[k].cnt ++;\n\telse if(t[k].data < key) {\n\t\tInsert(t[k].rc , key);\n\t\tif(t[t[k].rc].pri < t[k].pri) Zag(k);\n\t}\n\telse {\n\t\tInsert(t[k].lc , key);\n\t\tif(t[t[k].lc].pri < t[k].pri) Zig(k);\n\t}\n}\n\nLL n , rt;\n\nLL x_rank(LL x) {\n\tLL k = rt , ans = 0;\n\twhile(k) {\n\t\tif(x == t[k].data) return ans + t[t[k].lc].si + t[k].cnt;\n\t\tif(x > t[k].data) ans += t[t[k].lc].si + t[k].cnt , k = t[k].rc;\n\t\telse k = t[k].lc;\n\t}\n\treturn ans;\n}\n\nLL L , R , a[MAXN];\nint main() {\n\tsrand(19491001);\n\tscanf(\"%lld %lld %lld\" , &n , &L , &R);\n\tfor (int i = 1; i <= n; ++i) {\n\t\tscanf(\"%lld\" , &a[i]);\n\t\ta[i] += a[i - 1];\n\t}\n\tLL ans = 0;\n\tInsert(rt , 0);\n\tfor (int i = 1; i <= n; ++i) {\n\t\tans += x_rank(a[i] - L);\n\t\tans -= x_rank(a[i] - R - 1); \n\t\tInsert(rt , a[i]);\n\t}\n\tprintf(\"%lld\" , ans);\n\treturn 0;\n}\n```",
        "postTime": 1591077151,
        "uid": 171554,
        "name": "Reanap",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5459 \u3010[BJOI2016]\u56de\u8f6c\u5bff\u53f8\u3011"
    },
    {
        "content": "\u5176\u5b83\u7684\u5168\u90e8\u662fcdq\u548c\u6811\u72b6\u6570\u7ec4\u7684......\n\n\u6240\u4ee5\u5199\u4e00\u4e2a\u4e3b\u5e2d\u6811\u7684.\n\n\u5c31\u662f\u5728\u4e00\u4e2a\u6811\u53f3\u8fb9\u6709\u591a\u5c11\u5728\u4e00\u4e2a\u8303\u56f4\u5185\u7684\u4ec0\u4e48\u9b3c......\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u7528\u4e00\u4e2a\u4e3b\u5e2d\u6811\u5199\u4e86......\n\n\u5982\u679c\u4e0d\u61c2\u76f4\u63a5\u770b\u4ee3\u7801\u5c31\u884c\u4e86......\n\n```cpp\n#include<iostream>\n#define mid ((l+r)>>1)\nusing namespace std;\nnamespace fio{\n\tstreambuf*in=cin.rdbuf();\n\tchar bb[1000000],*s=bb,*t=bb;\n\t#define gc() (s==t&&(t=(s=bb)+in->sgetn(bb,1000000),s==t)?EOF:*s++)\n\tinline int read(){\n\t\tint x=0,w=1;\n\t\tchar ch=gc();\n\t\twhile(ch<48)w=(ch=='-')?-1:1,ch=gc();\n\t\twhile(ch>=48)x=x*10+ch-48,ch=gc();\n\t\treturn x*w;\n\t}\n}using fio::read;\nint n,l,r;long long arr[100005];\nint siz[10000005],ls[10000005],rs[10000005],cnt;\nint root[100005];\nvoid insert(int &root,int x,long long l,long long r,long long v){\n\tsiz[root=++cnt]=siz[x]+1;\n\tif(l!=r)\n\t\tif(v<=mid)rs[root]=rs[x],insert(ls[root],ls[x],l,mid,v);\n\t\telse ls[root]=ls[x],insert(rs[root],rs[x],mid+1,r,v);else;\n}\nint query(int x,int y,long long l,long long r,long long s,long long t){// \u4e3b\u5e2d\u6811\u677f\u5b50\n\tif(r<s||l>t)return 0;\n\tif(s<=l&&r<=t)return siz[x]-siz[y];\n\treturn query(ls[x],ls[y],l,mid,s,t)+query(rs[x],rs[y],mid+1,r,s,t);\n}\nlong long ans;\nint main(){\n\tn=read(),l=read(),r=read();\n\tfor(int i=1;i<=n;i++)arr[i]=arr[i-1]+read(),insert(root[i],root[i-1],-10000000000,10000000000,arr[i]);\n\tfor(int i=1;i<=n;i++)ans+=query(root[n],root[i-1],-10000000000,10000000000,l+arr[i-1],r+arr[i-1]);\n\tcout<<ans;\n}\n```\n",
        "postTime": 1575194937,
        "uid": 38485,
        "name": "Erina",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5459 \u3010[BJOI2016]\u56de\u8f6c\u5bff\u53f8\u3011"
    }
]