[
    {
        "content": "\u8fd9\u9898\u771f\u7684\u592a\u5999\u4e86\uff01\uff01\uff01\uff01\uff01\uff01\uff01\n\n\u4f60\u80fd\u60f3\u5230\u7684\u6734\u7d20 dp \u8ddf\u6b63\u89e3\u90fd\u6ca1\u6709\u5173\u7cfb\uff08\u786e\u4fe1\n\n\u4ec0\u4e48 $O(n^2k)$ \u548c $O(nk\\log n)$ \u7684\u3002\n\n\u6b63\u89e3\u4e0d\u662f\u659c\u4f18\uff0c\u4e5f\u6ca1\u6cd5\u659c\u4f18\u3002\n\n\u4f60\u4f1a\u53d1\u73b0\u5212\u5206 $k$ \u6bb5\u5f88\u70e6\u4eba\uff0c\u8bf4\u767d\u4e86\uff0c\u8fd9\u4e2a\u6839\u672c\u6ca1\u6709\u524d\u9014\u3002\n\n\u4e0d\u59a8\u4e0d\u8003\u8651\u5212\u5206\uff0c\u8003\u8651\u8f6c\u5316\uff0c\u56e0\u4e3a\u4f60\u6bcf\u4e2a\u5b50\u533a\u95f4\u53ea\u6709\u6700\u5927\u6700\u5c0f\u503c\u6709\u7528\uff0c\u6240\u4ee5\u4e0d\u59a8\u53ea\u8003\u8651\u9009\u6700\u5927\u6700\u5c0f\u503c\u7684\u60c5\u51b5\u3002\n\n\u5177\u4f53\u600e\u4e48\u9009\uff1f\n\n\u629b\u5f00\u5212\u5206\u533a\u95f4\u7684\u5f71\u54cd\uff0c\u8bbe $dp_{i,j,0/1/2}$ \u4e3a\u5728\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u5185\u5df2\u7ecf\u786e\u5b9a\u597d\u4e86 $j$ \u4e2a\u533a\u95f4\uff0c\u7b2c $(j+1)$ \u4e2a\u533a\u95f4\u5df2\u7ecf\u786e\u5b9a\u4e86\u8fd9\u4e2a\u533a\u95f4\u7684/nothing/\u6700\u5c0f\u503c/\u6700\u5927\u503c\u3002\n\n\u53d1\u73b0\u8fd9\u4e2a\u5176\u5b9e\u662f\u597d\u8f6c\u79fb\u7684\uff0c\u7136\u540e\u5c31\u505a\u5b8c\u4e86\uff01\uff01\uff01\n\n\u6ce8\u610f\uff1a\u4e00\u4e2a\u6570\u53ef\u4ee5\u540c\u65f6\u5f53\u4e00\u4e2a\u533a\u95f4\u5185\u7684\u6700\u5c0f\u6700\u5927\u503c\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(nk)$\n\n# AC code\uff1a\n```cpp\n__int128 dp[5005][3];\nint a[5005],b[5005];\nint main(){\n\tint n=read(n),k=read(k),i,j,l;\n\tfor(i=1;i<=n;i++) read(a[i]);\n\tfor(i=1;i<=k;i++) read(b[i]);\n\tfor(i=0;i<=k;i++) dp[i][0]=dp[i][1]=dp[i][2]=-(__int128)1000000000000000000000000000000;\n\tdp[0][0]=0;\n\tfor(i=1;i<=n;i++){\n\t\tfor(j=k-1;~j;j--){\n\t\t\t__int128 mul=1;\n\t\t\tfor(l=1;l<=b[j+1];l++) mul*=a[i];\n\t\t\tdp[j][1]=max(dp[j][1],dp[j][0]+mul);\n\t\t\tdp[j][2]=max(dp[j][2],dp[j][0]-mul);\n\t\t}\n\t\tfor(j=k;j;j--){\n\t\t\t__int128 mul=1;\n\t\t\tfor(l=1;l<=b[j];l++) mul*=a[i];\n\t\t\tdp[j][0]=max(dp[j][0],max(dp[j-1][1]-mul,dp[j-1][2]+mul));\n\t\t}\n\t}\n\tprint(dp[k][0]);\n\treturn 0;\n}\n```",
        "postTime": 1648476300,
        "uid": 80614,
        "name": "ZCPB",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8239"
    },
    {
        "content": "$$\\texttt{Preface}$$\n\n\u63d0\u4f9b\u4e00\u4efd $\\Theta(kn \\log n)$ \u7684\u975e\u6b63\u89e3\u7b97\u6cd5\u3002\n\n\u4e4b\u524d\u4e00\u76f4\u662f $\\text{TLE}\\ 74\\ \\text{pts}$\uff0c\u540e\u6765\u53d1\u73b0\u90a3\u65f6\u5199\u7684 $\\text{ST}$ \u8868\u8ddf\u3010\u6570\u636e\u5220\u9664\u3011\u4e00\u6837\uff0c\u91cd\u65b0\u5199\u4e86\u4e00\u53d1\u5c31\u8fc7\u4e86\u3002\n\n$$\\texttt{Solution}$$\n\n\u9996\u5148\u6211\u4eec\u8003\u8651\u4e00\u4e0b\u6734\u7d20\u7684 $\\text{DP}$\uff0c\u8bbe $f(i, j)$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u5206\u6210 $j$ \u6bb5\u7684\u6700\u5927\u5f97\u5206\u3002\n\n$$f(i, j) = \\max_{k < i} f(k, j - 1) + {\\left(\\max_{l = k + 1}^i a_l\\right)} ^ {b_j} - {\\left( \\min_{l = k + 1}^i a_l \\right)} ^ {b_j}$$\n\n\u660e\u663e\u8fd9\u4e2a\u7528 $\\text{ST}$ \u8868\u53ef\u4ee5\u505a\u5230 $\\Theta(n ^ 2 k)$\u3002\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u8f6c\u79fb\u957f\u7684\u5f88\u6709\u51b3\u7b56\u5355\u8c03\u6027\u7684\u6837\u5b50\uff0c\u6240\u4ee5\u8003\u8651\u8bc1\u660e\u3002\n\n\u8fd9\u4e2a\u8f6c\u79fb\u53ef\u4ee5\u7c7b\u4f3c\u4e3a\uff1a\n\n$$f(i,j) = f(k, j - 1) + w(k + 1, i)$$\n\n\u5176\u4e2d\uff1a\n\n$$w(i, j) = {\\left(\\max_{k = i}^j a_k\\right)} ^ b - {\\left( \\min_{k = i}^j a_k \\right)} ^ b$$\n\n$$\\because \\forall i, a_i \\ge 0$$\n\n$$\\therefore w(i, j) = \\max_{k = i}^j {a_k}^b - \\min_{k = i}^j {a_k} ^ b$$\n\n\u8fd9\u91cc\u5176\u5b9e\u53ef\u4ee5\u770b\u5230\u5f53 $b \\in [1, 3]$ \u65f6\uff0c\u51b3\u7b56\u5355\u8c03\u6027\u7684\u8bc1\u660e\u662f\u76f8\u540c\u7684\uff0c\u53ea\u4e0d\u8fc7\u628a $a_i$ \u66ff\u6362\u6210 ${a_i} ^ b$ \u800c\u5df2\uff0c\u6240\u4ee5\u4e0b\u9762\u53ea\u5bf9 $b = 1$ \u7684\u60c5\u51b5\u8fdb\u884c\u8bc1\u660e:\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/hqe5gajm.png)\n\n\u8003\u8651\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\uff0c\u7531\u4e8e\u8fd9\u91cc\u53d6 $\\max$\uff0c\u6240\u4ee5 $w$ \u9700\u6ee1\u8db3**\u5305\u542b $\\le$ \u4ea4\u53c9**\u3002\n\n\u5982\u4e0a\u56fe\u6240\u793a\uff0c$a, b, c$ \u5206\u522b\u8868\u793a\u5bf9\u5e94\u533a\u95f4\u5185\u7684 $\\max$\u3002\n\n**\u5305\u542b**\u5373**\u7ea2\u8272**\u7684\u533a\u95f4\u52a0\u4e0a**\u6a59\u8272**\u7684\u533a\u95f4\uff0c**\u4ea4\u53c9**\u5373**\u7eff\u8272**\u7684\u533a\u95f4\u52a0\u4e0a**\u84dd\u8272**\u7684\u533a\u95f4\u3002\n\n\u5305\u542b $= b + \\max(a, b, c)$\uff0c\u4ea4\u53c9 $= \\max(a, b) + \\max(b, c)$\u3002\n\n\u5f00\u59cb\u5927\u529b\u5206\u8ba8\uff1a\n\n+ $b \\ge \\max(a, c)$\n\n$$\\text{Lhs} = 2b = \\text{Rhs}$$\n\n+ $\\max(a, c) \\ge b \\ge \\min(a, c)$\n\n$$\\text{Lhs} = b + \\max(a, c) = \\text{Rhs}$$\n\n+ $\\max(a, c) \\ge \\min(a, c) \\ge b$\n\n$$\\text{Lhs} = b + \\max(a, c) \\le a + c = \\text{Rhs}$$\n\n\u5bb9\u6613\u53d1\u73b0 $\\min$ \u7684\u90e8\u5206\u4e0e $\\max$ \u7684\u90e8\u5206\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u4e0d\u4f5c\u8d58\u8ff0\u3002\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c$w$ \u6ee1\u8db3\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\uff0c\u6240\u4ee5 $f$ \u6ee1\u8db3\u51b3\u7b56\u5355\u8c03\u6027\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u5206\u6cbb\u89e3\u51b3\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(kn \\log n)$\u3002\n\n$$\\texttt{Code}$$\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\nint n, k, a[5005], b[5005];\n__int128 dp[2][5005];\nint Min[15][5005], Max[15][5005], lg[5005];\n\n__int128 calc(__int128 x, int p) {\n    switch (p) {\n        case 1 : return x;\n        case 2 : return x * x;\n        case 3 : return x * x * x;\n    }\n\n    return 0;\n}\n\nint qryMin(int l, int r) {\n    int t = lg[ r - l + 1 ];\n    return min(Min[t][l], Min[t][ r - (1 << t) + 1 ]);\n}\n\nint qryMax(int l, int r) {\n    int t = lg[ r - l + 1 ];\n    return max(Max[t][l], Max[t][ r - (1 << t) + 1 ]);\n}\n\nvoid solve(int cnt, int l, int r, int L, int R) {\n    if (l > r or L > R) return ;\n\n    int mid = (l + r) / 2, p;\n    __int128& res = dp[ cnt & 1 ][mid] = -(__int128)(1000000000000000000);\n\n    for (int i = L; i <= R && i < mid; ++i) {\n        __int128 now = dp[ cnt & 1 ^ 1 ][i] + calc(qryMax(i + 1, mid), b[cnt]) - calc(qryMin(i + 1, mid), b[cnt]);\n\n        if (now > res) {\n            res = now;\n            p = i;\n        }\n    }\n\n    solve(cnt, l, mid - 1, L, p);\n    solve(cnt, mid + 1, r, p, R);\n}\n\nvoid print(__int128 x) {\n\tstack <int> s;\n\t\n\twhile (x) {\n\t\ts.push(x % 10);\n\t\tx /= 10;\n\t}\n\t\n\twhile (!s.empty()) {\n\t\tcout << s.top();\n\t\ts.pop();\n\t}\n\t\n\tcout << '\\n';\n}\n\nint main() {\n    ios :: sync_with_stdio(0), cin.tie(0);\n\n    cin >> n >> k;\n\n    for (int i = 1; i <= n; ++i) {\n        cin >> a[i];\n        Min[0][i] = Max[0][i] = a[i];\n    }\n\n    for (int i = 1; i <= k; ++i) {\n        cin >> b[i];\n    }\n\n    for (int i = 1; (1 << i) <= n; ++i) {\n        for (int j = 1; j + (1 << i) - 1 <= n; ++j) {\n            Min[i][j] = min(Min[ i - 1 ][j], Min[ i - 1 ][ j + (1 << i - 1) ]);\n            Max[i][j] = max(Max[ i - 1 ][j], Max[ i - 1 ][ j + (1 << i - 1) ]);\n        }\n    }\n\n    lg[1] = 0;\n\n    for (int i = 2; i <= n; ++i) {\n        lg[i] = lg[ i >> 1 ] + 1;\n    }\n\n    for (int i = 1; i <= n; ++i) {\n        dp[1][i] = calc(qryMax(1, i), b[1]) - calc(qryMin(1, i), b[1]);\n    }\n\n    for (int i = 2; i <= k; ++i) {\n        solve(i, i, n, i - 1, n);\n    }\n\n    print(dp[ k & 1 ][n]);\n\n    return 0;\n}\n```\n\n\n$$\\texttt{Thanks for watching!}$$",
        "postTime": 1670816315,
        "uid": 355448,
        "name": "Fido_Puppy",
        "ccfLevel": 0,
        "title": "P8239 [AGM 2022 \u8d44\u683c\u8d5b] \u5206\u88c2"
    }
]