[
    {
        "content": "\u5728\u535a\u5ba2\u56ed\u98df\u7528\u66f4\u4f73\uff1a[https://www.cnblogs.com/PinkRabbit/p/CTS2019D1T1.html](https://www.cnblogs.com/PinkRabbit/p/CTS2019D1T1.html)\u3002\n\n### \u9898\u610f\u7b80\u8ff0\uff1a\n\n\u9898\u76ee\u8bf4\u7684\u5f88\u6e05\u695a\u4e86\u3002\n\n### \u9898\u89e3\uff1a\n\n\u8bb0\u6070\u597d\u6709 $i$ \u4e2a\u6781\u5927\u7684\u6570\u7684\u65b9\u6848\u6570\u4e3a $\\mathrm{cnt}[i]$\uff0c\u5219\u7b54\u6848\u4e3a $\\frac{\\mathrm{cnt}[k]}{(nml)!}$\u3002\n\n\u201c\u6070\u597d\u201d\u8fd9\u4e2a\u8bcd\u975e\u5e38\u7684\u96be\u53d7\uff0c\u6211\u4eec\u8003\u8651\u5bb9\u65a5\uff1a  \n\u8bb0 $\\mathrm{f}[i]$ \u4e3a\u5b58\u5728 $i$ \u4e2a\u6781\u5927\u7684\u6570\u7684\u65b9\u6848\u6570\uff0c\u82e5\u6070\u597d\u6709 $j$ \u4e2a\u6781\u5927\u7684\u6570\uff0c\u4f1a\u88ab\u76f8\u5e94\u5730\u7edf\u8ba1 $\\binom{j}{i}$ \u6b21\u3002\n\n\u5219\u6709\uff1a\n\n$$\\mathrm{f}[i]=\\sum_{j}\\binom{j}{i}\\mathrm{cnt}[j]$$\n\n\u6839\u636e\u4e8c\u9879\u5f0f\u53cd\u6f14\uff0c\u6709\uff1a\n\n$$\\mathrm{cnt}[i]=\\sum_{j}(-1)^{j-i}\\binom{j}{i}\\mathrm{f}[j]$$\n\n\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u51fa\u6bcf\u4e00\u4e2a $\\mathrm{f}[i]$\u3002\n\n----\n\n\u9996\u5148\u8003\u8651\u4ee5\u4e0b\u4e8b\u5b9e\uff1a\n\n- \u4e0d\u4f1a\u6709\u8d85\u8fc7 $\\min(n,m,l)$ \u4e2a\u6781\u5927\u7684\u6570\u3002\n\n- \u6bcf\u4e24\u4e2a\u6781\u5927\u7684\u6570\u5fc5\u7136\u4e0d\u53ef\u80fd\u6709\u4efb\u610f\u4e00\u7ef4\u7684\u5750\u6807\u76f8\u540c\uff0c\u8fd9\u662f\u56e0\u4e3a\u6bcf\u4e2a\u6781\u5927\u7684\u6570\u9700\u8981\u5927\u4e8e\u6240\u6709\u4e0e\u5b83\u6709\u4efb\u610f\u4e00\u7ef4\u5750\u6807\u76f8\u540c\u7684\u70b9\u4e0a\u7684\u6570\u3002\n\n- \u82e5\u81f3\u5c11\u5b58\u5728 $i$ \u4e2a\u6781\u5927\u7684\u6570\uff0c\u5219\u6709 $i$ \u884c\uff0c$i$ \u5217\u548c $i$ \u4e2a\u7eb5\u622a\u9762\u88ab\u81f3\u5c11\u4e00\u4e2a\u6781\u5927\u7684\u6570\u201c\u63a7\u5236\u201d\u3002\n\n\u6240\u4ee5\uff0c\u5269\u4f59\u7684 $(n-i)(m-i)(l-i)$ \u4e2a\u6570\u662f\u6ca1\u6709\u4efb\u4f55\u9650\u5236\u7684\uff0c\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u4ec5\u9700\u4fdd\u8bc1\u81f3\u5c11\u5b58\u5728 $i$ \u4e2a\u6781\u5927\u7684\u6570\u3002\u82e5\u5269\u4e0b\u7684\u6570\u4e2d\u53c8\u51fa\u73b0\u4e86\u6781\u5927\u7684\u6570\u4e5f\u6ca1\u5173\u7cfb\uff0c\u8fd9\u5b9e\u9645\u4e0a\u5e76\u4e0d\u5728\u8003\u8651\u8303\u56f4\u5185\u3002\n\n\u53c8\u6709\uff0c\u6781\u5927\u7684\u6570\u7684\u6761\u4ef6\u4ec5\u548c\u5927\u5c0f\u5173\u7cfb\u6709\u5173\uff0c\u800c\u4e0e\u6570\u7684\u7edd\u5bf9\u5927\u5c0f\u65e0\u5173\uff0c\u6240\u4ee5\u53ef\u4ee5\u770b\u4f5c\u4e58\u4e0a\u4e86\u4e00\u4e2a\u201c$nml$ \u53d6\u51fa $(n-i)(m-i)(l-i)$ \u4e2a\u6570\u8fdb\u884c\u6392\u5217\u7684\u65b9\u6848\u6570\u201d\uff0c\u5373\u4e00\u4e2a\u6392\u5217\u6570\u7684\u7cfb\u6570\uff0c\u800c\u5269\u4e0b\u7684\u9700\u8981\u5355\u72ec\u8003\u8651\u3002\n\n\u4f46\u662f\u5148\u522b\u7740\u6025\uff0c\u6211\u4eec\u5148\u5199\u51fa\u76ee\u524d\u5f97\u5230\u7684\u5f0f\u5b50\uff08\u4e0b\u5217\u5f0f\u5b50\u4e2d\u5747\u5c06\u6392\u5217\u6570\u5199\u4f5c\u4e0b\u964d\u5e42\u7684\u5f62\u5f0f\uff09\uff1a\n\n$$\\mathrm{f}[i]=\\left(n^{\\underline{i}}m^{\\underline{i}}l^{\\underline{i}}\\right)\\times\\left((nml)^{\\underline{(n-i)(m-i)(l-i)}}\\right)\\times\\mathrm{g}[i]$$\n\n\u7b2c\u4e00\u4e2a\u62ec\u53f7\u4ee3\u8868\u6709\u987a\u5e8f\u5730\u9009\u51fa\uff08\u5373\u4e00\u4e2a\u6392\u5217\uff09$i$ \u4e2a\u4e09\u7ef4\u5750\u6807\u5747\u4e92\u4e0d\u76f8\u540c\u7684\u70b9\uff0c\u8fd9\u4e2a\u987a\u5e8f\u5373\u4e3a\u4e4b\u540e\u7684\u5927\u5c0f\u987a\u5e8f\u3002\n\n\u7b2c\u4e8c\u4e2a\u62ec\u53f7\u4ee3\u8868\u5bf9\u65e0\u5173\u70b9\u8fdb\u884c\u6807\u53f7\uff0c\u4e5f\u662f\u4e00\u4e2a\u6392\u5217\u6570\u3002\n\n\u800c $\\mathrm{g}[i]$ \u4ee3\u8868\u5728\u5269\u4e0b\u7684 $nml-(n-i)(m-i)(l-i)$ \u4e2a\u70b9\u4e2d\u6309\u7167\u89c4\u5b9a\u7684\u5927\u5c0f\u987a\u5e8f\u8fdb\u884c\u6807\u53f7\u7684\u65b9\u6848\u6570\u3002\n\n----\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u6c42\u51fa $\\mathrm{g}[i]$\uff1a\n\n\u8ba9\u6211\u4eec\u5148\u8003\u8651 $i$ \u4e2a\u6781\u5927\u503c\u4e2d\u6700\u5927\u7684\u90a3\u4e2a\uff0c\u5b83\u7684\u4f4d\u7f6e\u5df2\u7ecf\u88ab\u786e\u5b9a\u4e86\uff0c\u5b83\u7684\u503c\u4e5f\u88ab\u786e\u5b9a\u4e3a\u53ef\u9009\u7684\u503c\u4e2d\u7684\u6700\u5927\u7684\u90a3\u4e00\u4e2a\uff0c\u800c\u6240\u6709\u4e0e\u5b83\u6709\u5173\u8054\uff08\u6709\u4e00\u7ef4\u5750\u6807\u76f8\u540c\uff09\u7684\u4f4d\u7f6e\u90fd\u5f3a\u5236\u5c0f\u4e8e\u5b83\u3002\n\n\u4f46\u662f\uff0c\u5148\u7b49\u7b49\uff01\u8fd9\u4e9b\u4f4d\u7f6e\u4e0a\u7684\u6570\uff0c\u4e0d\u4e00\u5b9a\u53ea\u6709\u6700\u5927\u503c\u7ed9\u4e88\u7684\u4e00\u4e2a\u9650\u5236\uff0c\u5982\u679c\u8fd9\u4e2a\u4f4d\u7f6e\u540c\u65f6\u548c\u5176\u5b83\u6781\u5927\u503c\u6709\u5173\u8054\uff0c\u90a3\u4e48\u4e0d\u80fd\u5355\u7eaf\u7528\u53ea\u6700\u5927\u503c\u5bf9\u5176\u8fdb\u884c\u9650\u5236\u3002\n\n\u4e0d\u8fc7\u5462\uff0c\u5176\u5b9e\u8fd9\u662f\u6ca1\u6709\u5f71\u54cd\u7684\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7ba1\u90a3\u4e9b\u201c\u53ea\u548c\u6700\u5927\u503c\u6709\u5173\u8054\u201d\u7684\u4f4d\u7f6e\uff0c\u82e5\u548c\u5176\u5b83\u6781\u5927\u503c\u6709\u5173\u8054\uff0c\u6211\u4eec\u653e\u5230\u4e4b\u540e\u518d\u53bb\u5904\u7406\u5373\u53ef\u3002  \n\u4ece\u8fd9\u91cc\u5c31\u53ef\u4ee5\u770b\u51fa\u5148\u8003\u8651\u6700\u5927\u503c\u7684\u9ad8\u660e\u4e4b\u5904\uff0c\u56e0\u4e3a\u8d8a\u5c0f\u7684\u6781\u5927\u503c\u7684\u9650\u5236\u8d8a\u4e25\u683c\uff0c\u6211\u4eec\u91c7\u53d6\u4ece\u5927\u5230\u5c0f\u8003\u8651\u7684\u65b9\u5f0f\uff0c\u5c31\u53ef\u4ee5\u53ea\u8003\u8651\u6700\u540e\u7684\u9650\u5236\u3002\n\n\u800c\u8003\u8651\u5b8c\u6700\u5927\u503c\u4ee5\u53ca\u201c\u53ea\u548c\u6700\u5927\u503c\u6709\u5173\u8054\u201d\u7684\u4f4d\u7f6e\u540e\uff0c\u6b21\u5927\u503c\u7684\u6570\u503c\u5c31\u5e94\u8be5\u4e3a\u5269\u4e0b\u7684\u503c\u4e2d\u6700\u5927\u7684\u90a3\u4e00\u4e2a\u3002\n\n\u6309\u7167\u4e0a\u8ff0\u65b9\u5f0f\u7c7b\u63a8\uff1a\u5bf9\u4e8e\u6700\u5927\u7684\u6781\u5927\u503c\uff0c\u53ea\u8981\u8003\u8651\u90a3\u4e9b\u548c\u6700\u5927\u503c\u6709\u5173\u8054\u7684\u90e8\u5206\uff0c\u4f46\u662f\u5fc5\u987b\u53bb\u9664\u548c\u201c\u6bd4\u6700\u5927\u503c\u5c0f\u7684\u6781\u5927\u503c\u201d\u6709\u5173\u8054\u7684\u4f4d\u7f6e\u3002  \n\u5bf9\u4e8e\u6b21\u5927\u7684\uff0c\u53ea\u8981\u8003\u8651\u548c\u6b21\u5927\u503c\u6709\u5173\u8054\u7684\u90e8\u5206\uff0c\u4f46\u662f\u8981\u53bb\u6389\u548c\u201c\u6bd4\u6b21\u5927\u503c\u5c0f\u7684\u6781\u5927\u503c\u201d\u6709\u5173\u8054\u7684\u4f4d\u7f6e\u3002\n\u4ee5\u6b64\u7c7b\u63a8\u2026\u2026\n\n\u4e3a\u4e86\u4fbf\u4e8e\u7406\u89e3\uff0c\u6211\u4eec\u5c55\u793a $n=8,m=11,i=5$ \u65f6\u7684\u4e8c\u7ef4\u793a\u4f8b\u56fe\uff08\u4f60\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a $l=1$ \u7684\u4e09\u7ef4\u60c5\u51b5\uff09\uff1a\n\n![](https://cdn.luogu.com.cn/upload/pic/59379.png)\n\n\u56e0\u4e3a\u6781\u5927\u503c\u7684\u4f4d\u7f6e\u4e0e\u7b54\u6848\u65e0\u5173\uff0c\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6309\u7167**\u4ece\u5c0f\u5230\u5927**\u7684\u987a\u5e8f\u4ece\u5de6\u4e0a\u89d2\u4f9d\u6b21\u6392\u4e0b\u3002\n\n\u767d\u8272\u662f\u65e0\u5173\u4f4d\u7f6e\uff0c\u6a59\u8272\u662f\u6781\u5927\u503c\u6240\u5728\u4f4d\u7f6e\uff0c\u6df1\u7eff\u8272\u662f\u4ec5\u548c\u4e00\u4e2a\u6781\u5927\u503c\u6709\u5173\u8054\u7684\u4f4d\u7f6e\uff0c\u9ec4\u7eff\u8272\u662f\u540c\u65f6\u548c\u4e24\u4e2a\u6781\u5927\u503c\u6709\u5173\u8054\u7684\u4f4d\u7f6e\u3002\n\n\u5bf9\u4e8e\u4e0d\u662f\u65e0\u5173\u4f4d\u7f6e\u7684\u683c\u5b50\uff0c\u5199\u4e0a\u7684\u6570\u5c31\u8868\u793a\u5b83\u662f\u5728\u7b2c\u51e0\u8f6e\u88ab\u8003\u8651\u7684\u3002\n\n\u53ef\u4ee5\u770b\u51fa\uff0c\u6df1\u7eff\u8272\u90e8\u5206\u5728\u8003\u8651\u5bf9\u5e94\u7684\u6781\u5927\u503c\u65f6\u7684\u540c\u4e00\u8f6e\u65f6\u5c31\u88ab\u7edf\u8ba1\uff0c\u800c\u9ec4\u7eff\u8272\u90e8\u5206\u987b\u7b49\u5230\u5bf9\u5e94\u7684\u8f83\u5c0f\u7684\u6781\u5927\u503c\u7684\u540c\u4e00\u8f6e\u624d\u4f1a\u88ab\u7edf\u8ba1\u3002\n\n\u8fd9\u5f20\u56fe\u7684\u586b\u6570\u6a21\u5f0f\u662f\u6d45\u663e\u6613\u61c2\u7684\uff0c\u5f88\u7b80\u5355\u5c31\u80fd\u770b\u51fa\u5176\u4e2d\u89c4\u5f8b\u3002\n\n\u5c1d\u8bd5\u5199\u51fa\u5176\u5bf9\u5e94\u7684 $\\mathrm{g}[i]$ \u7684\u503c\u5427\uff1a$\\mathrm{g}[i]=69^{\\underline{9}}\\cdot 59^{\\underline{11}}\\cdot 47^{\\underline{13}}\\cdot 33^{\\underline{15}}\\cdot 17^{\\underline{17}}$\u3002  \n\u6bcf\u4e2a\u4e0b\u964d\u5e42\uff08\u6392\u5217\u6570\uff09\u5c31\u5bf9\u5e94\u7740\u76f8\u5e94\u7684\u8f6e\u6570\uff0c\u4f8b\u5982\u7b2c\u4e00\u8f6e\u4e2d\u662f $69$ \u4e2a\u6570\u9009\u51fa $9$ \u4e2a\u6765\u6392\u5217\u3002\n\n\u8fdb\u4e00\u6b65\u5730\uff0c\u6211\u4eec\u5c1d\u8bd5\u5199\u51fa\u5f62\u5f0f\u5316\u7684\u516c\u5f0f\uff08\u4e3a\u4e86\u65b9\u4fbf\u8868\u8ff0\uff0c**\u5b9a\u4e49\u8bb0\u53f7** $\\varrho(x)=(n-x)(m-x)(l-x)$\uff09\uff1a  \n\u5bf9\u4e8e\u67d0\u4e2a $i$ \u503c\u7684\u7b2c $i-j+1$ \u8f6e\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u4e5f\u5c31\u662f\u56fe\u4e2d**\u4ece\u5916\u5f80\u91cc\u6570**\u7684\u7b2c $j$ \u5c42\uff0c  \n\u4e4b\u524d**\u586b\u5b8c\u5269\u4f59\u7684\u6570**\u7684\u6570\u91cf\u4e3a $nml-(n-j)(m-j)(l-j)-1$ \u4e2a\uff0c\u5373 $\\varrho(0)-\\varrho(j)-1$\uff0c  \n\u800c**\u9700\u8981\u586b\u7684\u4f4d\u7f6e**\u7684\u6570\u91cf\u4e3a $(n-j+1)(m-j+1)(l-j+1)-(n-j)(m-j)(l-j)-1$ \u4e2a\uff0c\u5373 $\\varrho(j-1)-\\varrho(j)-1$\u3002  \n\u6240\u4ee5\u5c31\u9700\u8981\u4e58\u4e0a\uff1a\u4ece\u201c\u5269\u4f59\u7684\u6570\u201d\u4e2d\u53d6\u51fa\u201c\u9700\u8981\u586b\u7684\u4f4d\u7f6e\u201d\u90a3\u4e48\u591a\u6570\u8fdb\u884c\u6392\u5217\u4ee5\u586b\u5165\u4f4d\u7f6e\u4e2d\u7684\u65b9\u6848\u6570\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u6392\u5217\u6570\u3002\n\n\u5219 $\\mathrm{g}[i]=\\prod_{j=1}^{i}(\\varrho(0)-\\varrho(j)-1)^{\\underline{\\varrho(j-1)-\\varrho(j)-1}}$\u3002  \n\u5199\u6210\u9636\u4e58\u7684\u5f62\u5f0f\u5c31\u662f $\\mathrm{g}[i]=\\prod_{j=1}^{i}\\frac{(\\varrho(0)-\\varrho(j)-1)!}{(\\varrho(0)-\\varrho(j-1))!}$\u3002  \n\u8fd9\u65f6\u5c31\u4e00\u76ee\u4e86\u7136\u4e86\uff0c\u4e0d\u96be\u5316\u6210\u5982\u4e0b\u5f62\u5f0f\uff1a\n\n$$\\mathrm{g}[i]=(\\varrho(0)-\\varrho(i)-1)!\\prod_{j=1}^{i-1}\\frac{1}{\\varrho(0)-\\varrho(j)}$$\n\n----\n\n\u90a3\u4e48\uff0c\u5c06 $\\mathrm{g}[i]$ \u4ee3\u56de $\\mathrm{f}[i]$ \u4e2d\u5427\uff01\n\n$$\\begin{aligned}\\mathrm{f}[i]&=\\left(n^{\\underline{i}}m^{\\underline{i}}l^{\\underline{i}}\\right)\\times\\left((nml)^{\\underline{(n-i)(m-i)(l-i)}}\\right)\\times(\\varrho(0)-\\varrho(i)-1)!\\prod_{j=1}^{i-1}\\frac{1}{\\varrho(0)-\\varrho(j)}\\\\&=\\left(n^{\\underline{i}}m^{\\underline{i}}l^{\\underline{i}}\\right)\\frac{(nml)!}{(nml-\\varrho(i))!}(nml-\\varrho(i)-1)!\\prod_{j=1}^{i-1}\\frac{1}{nml-\\varrho(j)}\\\\&=\\left(n^{\\underline{i}}m^{\\underline{i}}l^{\\underline{i}}\\right)(nml)!\\prod_{j=1}^{i}\\frac{1}{nml-\\varrho(j)}\\end{aligned}$$\n\n\u5219\u7b54\u6848\u4e3a\uff1a$\\frac{\\mathrm{cnt}[k]}{(nml)!}=\\frac{1}{(nml)!}\\sum_{i}(-1)^{i-k}\\binom{i}{k}\\mathrm{f}[i]$\n\n\u6ce8\u610f\u5230\u548c $\\mathrm{f}[i]$ \u91cc\u9762\u7684 $(nml)!$ \u62b5\u6d88\u6389\u4e86\uff0c\u5e72\u8106\u4e24\u8fb9\u90fd\u4e0d\u5199\u4e86\u5427\uff1a\n\n$$\\tilde{\\mathrm{f}}[i]=\\left(n^{\\underline{i}}m^{\\underline{i}}l^{\\underline{i}}\\right)\\prod_{j=1}^{i}\\frac{1}{nml-\\varrho(j)}$$\n\n$$\\mathbf{Ans}=\\sum_{i}(-1)^{i-k}\\binom{i}{k}\\tilde{\\mathrm{f}}[i]$$\n\n----\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u6700\u540e\u7684\u95ee\u9898\uff0c\u6211\u4eec\u9700\u8981\u5728\u5747\u644a $\\mathcal{O}(1)$ \u7684\u65f6\u95f4\u5185\u6c42\u51fa\u6bcf\u4e2a $\\mathrm{f}[i]$\uff08$0\\le k\\le\\min(n,m,l)$\uff09\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u74f6\u9888\u5728\u4e8e\u6c42\u9006\u5143\u4e0a\uff0c\u53ea\u8981\u7528\u5230[\u8fd9\u9898](https://loj.ac/problem/161)\u7684\u65b9\u6cd5\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u4e0b\u9762\u662f\u4ee3\u7801\uff1a\n\n```cpp\n#include <cstdio>\n\ntypedef long long LL;\nconst int Mod = 998244353;\nconst int MN = 5000005;\n\nvoid exgcd(int a, int b, int &x, int &y) {\n\tif (!b) x = 1, y = 0;\n\telse exgcd(b, a % b, y, x), y -= a / b * x;\n}\ninline int Inv(int a) {\n\tint x, y;\n\texgcd(a < 0 ? a + Mod : a, Mod, x, y);\n\treturn x;\n}\n\nint Invs[MN];\ninline void Init(int N) {\n\tInvs[1] = 1;\n\tfor (int i = 2; i <= N; ++i)\n\t\tInvs[i] = -(LL)(Mod / i) * Invs[Mod % i] % Mod;\n}\n\nint N, M, L, Q, K, Ans;\nint Vals[MN], iVals[MN];\n\ninline int R(int x) { return (LL)(N - x) * (M - x) % Mod * (L - x) % Mod; }\n\nint main() {\n\tInit(5000000);\n\tint T; scanf(\"%d\", &T);\n\twhile (T--) {\n\t\tscanf(\"%d%d%d%d\", &N, &M, &L, &K), Ans = 0;\n\t\tQ = N < M ? N < L ? N : L : M < L ? M : L;\n\t\tiVals[0] = 1;\n\t\tfor (int i = 1; i <= Q; ++i)\n\t\t\tVals[i] = R(0) - R(i),\n\t\t\tiVals[i] = (LL)iVals[i - 1] * Vals[i] % Mod;\n\t\tint iV = Inv(iVals[Q]);\n\t\tfor (int i = Q; i >= 1; --i)\n\t\t\tiVals[i] = (LL)iV * iVals[i - 1] % Mod,\n\t\t\tiV = (LL)iV * Vals[i] % Mod;\n\t\tint C = 0, S = 1;\n\t\tfor (int i = 1; i <= Q; ++i) {\n\t\t\tS = (LL)S * R(i - 1) % Mod * iVals[i] % Mod;\n\t\t\tif (i == K) C = 1;\n\t\t\tif (i > K) C = -(LL)C * i % Mod * Invs[i - K] % Mod;\n\t\t\tAns = (Ans + (LL)C * S) % Mod;\n\t\t}\n\t\tprintf(\"%d\\n\", Ans < 0 ? Ans + Mod : Ans);\n\t}\n\treturn 0;\n}\n```\n\n\u611f\u8c22 [@Winniechen](https://www.luogu.org/space/show?uid=52299) \u4e0e\u6211\u4ea4\u6d41\u505a\u6cd5\u3002",
        "postTime": 1558715934,
        "uid": 10703,
        "name": "\u5c0f\u7c89\u5154",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5400 \u3010[CTS2019]\u968f\u673a\u7acb\u65b9\u4f53\u3011"
    },
    {
        "content": "\u9898\u76eeLink:[P5400 [CTS2019]\u968f\u673a\u7acb\u65b9\u4f53](https://www.luogu.org/problemnew/show/P5400)\n\nMC\u5927\u6cd5\u597d!**MC\u9020\u56fe**\u89e3\u6b64\u9898!\n\n\u6709\u4e00\u4e2a $n\\times m\\times l$ \u7684\u7acb\u65b9\u4f53\uff0c\u7acb\u65b9\u4f53\u4e2d\u6bcf\u4e2a\u683c\u5b50\u4e0a\u90fd\u6709\u4e00\u4e2a\u6570\uff0c\u5982\u679c\u67d0\u4e2a\u683c\u5b50\u4e0a\u7684\u6570\u6bd4\u4e09\u7ef4\u5750\u6807**\u81f3\u5c11\u6709\u4e00\u7ef4\u76f8\u540c**\u7684\u5176\u4ed6\u683c\u5b50\u4e0a\u7684\u6570\u90fd\u8981\u5927\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u79f0\u5b83\u662f\u6781\u5927\u7684\u3002\n\n\u5c06 $1\\sim n\\times m\\times l$ \u8fd9 $n\\times m\\times l$ \u4e2a\u6570\u7b49\u6982\u7387\u968f\u673a\u586b\u5165 $n\\times m\\times l$ \u4e2a\u683c\u5b50\uff08\u5373\u4efb\u610f\u6570\u5b57\u51fa\u73b0\u5728\u4efb\u610f\u683c\u5b50\u4e0a\u7684\u6982\u7387\u5747\u76f8\u7b49\uff09\uff0c\u4f7f\u5f97\u6bcf\u4e2a\u6570\u6070\u51fa\u73b0\u4e00\u6b21\uff0c\u6c42**\u6070\u6709** $k$ \u4e2a\u6781\u5927\u7684\u6570\u7684\u6982\u7387\u3002\u7b54\u6848\u5bf9 $998244353$\uff08\u4e00\u4e2a\u8d28\u6570\uff09\u53d6\u6a21\u3002\n\n\u591a\u7ec4\u6570\u636e\u3002\n\n$1\\le n,m,l\\le 5000000$\uff0c$1\\le k\\le 100$\uff0c$1\\le T\\le 10$\n\n\u8bbe$G(k)$\u662f\u6c42**\u6070\u6709** $k$ \u4e2a\u6781\u5927\u7684\u6570\u7684**\u65b9\u6848\u6570**\u3002\n\n\u9996\u5148\u8fd9\u4e2a**\u6070\u597d**\u975e\u5e38\u96be\u53d7,\u6211\u4eec\u6309\u7167\u5957\u8def\u91c7\u7528**\u91cd\u590d\u7edf\u8ba1**,\u5373:\u9996\u5148\u5f04\u51fa$k$\u4e2a\u6781\u5927\u503c,\u7136\u540e\u653e\u4efb\u81ea\u6d41,\u8fd9\u6837\u65b9\u6848\u6570\u79f0\u4e3a$F(k)$\u3002\n\n\u5bb9\u6613\u5f97\u5230:\u6ca1\u6709\u4e24\u4e2a\u7ea7\u5927\u6570\u4f1a\u5728\u540c\u4e00\u4e2a\u5e73\u9762\u4e0a,\u6240\u4ee5\u6700\u591a\u6709$min(n,m,l)$\u4e2a\u7ea7\u5927\u6570,\u8bbe$R=min(n,m,l)$\u3002\n\n\u8fd9\u91cc\u8981\u7279\u5224\u4e00\u4e0b,\u5982\u679c$k>R$\u5219\u8f93\u51fa0\u3002\n\n\u90a3\u4e48\u5c31\u80fd\u5f97\u5230$F(k)=\\sum\\limits_{i=k}^R\\dbinom{i}{k}G(i)$\n\n\u89e3\u91ca\u4e00\u4e0b\u4e3a\u4ec0\u4e48:\u5982\u679c\u4e00\u4e2a\u65b9\u6848\u4e2d\u6709$i$\u4e2a\u6781\u5927\u503c,\u90a3\u4e48\u4f60\u53ea\u8981\u9009\u4e2d\u5176\u4e2d\u7684$k$\u4e2a,\u8fd9\u4e2a\u65b9\u6848\u5c31\u4f1a\u88ab\u7edf\u8ba1\u4e00\u6b21,\u968f\u610f\u4e00\u5171\u88ab\u7edf\u8ba1\u4e86$\\dbinom{i}{k}$\u6b21\u3002\n\n\u6240\u4ee5\u8fd9\u91cc\u8981\u518d\u6b21\u58f0\u660e:\u6240\u8c13\u7684$F(k)$\u5e76**\u4e0d\u662f**\u81f3\u5c11\u6709$k$\u4e2a\u6781\u5927\u7684\u6570\u7684\u65b9\u6848\u6570,\u5426\u5219\u7684\u8bdd$F(k)-F(k-1)$\u5c31\u662f\u7b54\u6848\u4e86\u3002\n\n(\u8fd9\u4e2a\u9519\u8bef\u597d\u50cf\u5927\u591a\u6570\u9898\u89e3\u90fd\u6709\u72af\u8fc7,\u6211\u521d\u5b66\u7684\u65f6\u5019\u4e00\u76f4\u8ba4\u4e3a$ANS=F(k)-F(k-1)$,WA\u4e86\u4e00\u7248\u4e4b\u540e\u624d\u610f\u8bc6\u5230\u9519\u8bef)\n\n[$\\text{\u4e8c\u9879\u5f0f\u53cd\u6f14}$](https://www.luogu.org/blog/command-block/yi-suo-ji-guai-di-fan-yan)\u53ef\u5f97$G(k)=\\sum\\limits_{i=k}^R(-1)^{i-k}\\dbinom{i}{k}F(i)$\n\n\u53ea\u7528\u6c42$G(k)$,\u6240\u4ee5\u4e0a\u8ff0\u5f0f\u5b50\u6211\u4eec\u76f4\u63a5\u66b4\u529b\u7b97\u590d\u6742\u5ea6\u6b63\u786e\u3002\n\n\u95ee\u9898\u5728\u4e8e\u5982\u4f55\u6c42\u51fa$F(k...R)$\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf,\u8fd9\u91cc\u8bbe$T=nml$.\n\n$F(k)=$\u9009\u51fa$k$\u4e2a\u7ea7\u5927\u6570\u4f4d\u7f6e\u7684\u65b9\u6848\u6570$*$\u88ab\u7ea7\u5927\u6570\u5f71\u54cd\u7684\u6570\u7684\u586b\u5199\u65b9\u6cd5$*$\u4e0d\u88ab\u5f71\u54cd\u7684\u6570\u7684\u586b\u5199\u65b9\u6cd5\u3002\n\n- \u9009\u51fa$k$\u4e2a\u7ea7\u5927\u6570\u7684\u65b9\u6848\u6570\n\n\u6ca1\u6709\u4e24\u4e2a\u7ea7\u5927\u6570\u4f1a\u5728\u540c\u4e00\u4e2a\u5e73\u9762\u4e0a,\u6240\u4ee5\u8fd9\u4e2a\u4e1c\u897f\u5e76\u4e0d\u662f\u7b80\u5355\u5730\u7b49\u4e8e$T^{\\underline{k}}$\n\n\u7b2c\u4e00\u4e2a\u7ea7\u5927\u6570\u653e\u7f6e\u4e4b\u540e,\u6709\u4e09\u4e2a\u5e73\u9762\u7684\u6570\u5fc5\u987b\u5c0f\u4e8e\u8be5\u6570,\u5176\u4ed6\u7684\u4f4d\u7f6e\u5e76\u6ca1\u6709\u5f71\u54cd\u3002\n\n\u6240\u4ee5\u53ef\u9009\u7684\u4f4d\u7f6e\u53d8\u6210\u4e86$(n-1)(m-1)(l-1)$\u4e2a,\u6211\u4eec\u53d1\u73b0\u5c31\u662f\u628a\u539f\u6765\u7684\u7a7a\u95f4\u4ece\u5404\u4e2a\u65b9\u5411\u5206\u522b\u524a\u53bb\u4e861,\u53d8\u6210\u4e86\u5b50\u95ee\u9898\u3002\n\n\u90a3\u4e48\u603b\u7684\u65b9\u6848\u6570\u662f$\\frac{1}{k!}\\prod\\limits_{i=0}^{k-1}(n-i)(m-i)(l-i)$,\u56e0\u4e3a\u8fd9\u4e9b\u6781\u5927\u503c\u4e4b\u95f4\u662f\u65e0\u5e8f\u7684\u3002\n\n- \u88ab\u7ea7\u5927\u6570\u5f71\u54cd\u7684\u6570\u7684\u586b\u5199\u65b9\u6cd5\n\n\u672c\u9898\u6700\u9ebb\u70e6\u7684\u4e1c\u897f\u3002\n\n\u8fd9$k$\u4e2a\u6781\u5927\u503c\u5f71\u54cd\u7684\u7684\u6570\u7684\u4e2a\u6570\u662f\u53ef\u4ee5\u6c42\u7684,\u5373\u4e3a$T-(n-k)(m-k)(l-k)$\n\n\u8bbe$G_i=T-(n-i)(m-i)(l-i)$.\n\n\u6211\u4eec\u5148\u8981\u9009\u51fa$G_k$\u4e2a\u6570\u503c,\u8fd9\u90e8\u5206\u65b9\u6848\u6570\u662f$\\dbinom{T}{G_k}$.\n\n\u6b64\u5916,\u6211\u4eec\u8fd8\u8981\u8003\u8651\u8fd9$G_k$\u4e2a\u6570\u600e\u4e48\u6446\u653e\u3002\n\n\u7b2c\u4e00\u4e2a\u7ea7\u5927\u6570\u653e\u7f6e\u4e4b\u540e,\u6709\u4e09\u4e2a\u5e73\u9762\u7684\u6570\u5fc5\u987b\u5c0f\u4e8e\u8be5\u6570,\u5176\u4ed6\u7684\u4f4d\u7f6e\u5e76\u6ca1\u6709\u5f71\u54cd\u3002\n\n\u7b2c\u4e8c\u4e2a\u7ea7\u5927\u6570\u653e\u7f6e\u4e4b\u540e,\u6709\u4e09\u4e2a\u5e73\u9762\u7684\u6570\u5fc5\u987b\u5c0f\u4e8e\u8be5\u6570,\u5176\u4ed6\u7684\u4f4d\u7f6e\u5e76\u6ca1\u6709\u5f71\u54cd\u3002\n\n\u95ee\u9898\u5728\u4e8e\u8fd9\u516d\u4e2a\u5e73\u9762**\u6709\u4ea4**,\u90a3\u6837\u5b50\u662f\u65e0\u6cd5\u5206\u6790\u7684\u3002\n\n\u4e0d\u8fc7\u6211\u4eec\u53d1\u73b0,\u5047\u5982\u7b2c\u4e00\u4e2a\u6570\u5c0f\u4e8e\u7b2c\u4e8c\u4e2a\u6570\u7684\u8bdd,\u90a3\u4e48\u7b2c\u4e00\u4e2a\u6570\u63a7\u5236\u7684\u4e09\u4e2a\u5e73\u9762\u5fc5\u7136\u90fd\u5c0f\u4e8e\u7b2c\u4e8c\u4e2a\u6570,\u4e5f\u5c31\u662f\u8bf4,**\u6ca1\u6709\u5f71\u54cd**\u3002\n\n\u5bb9\u6613\u53d1\u73b0,\u5bf9\u4e8e\u4e00\u79cd\u5408\u6cd5\u65b9\u6848,\u6211\u4eec\u53ef\u4ee5\u4efb\u610f\u4ea4\u6362\u4e24\u4e2a\u9762,\u4ea4\u6362\u540e\u4ecd\u7136\u5408\u6cd5\u3002\n\n\u90a3\u4e48\u6211\u4eec\u524d\u9762\u5df2\u7ecf\u94a6\u5b9a\u4e86$k$\u4e2a\u6781\u5927\u503c\u7684\u4f4d\u7f6e,\u90a3\u4e48\u6211\u4eec\u628a\u5b83\u4eec\u4e00\u987fswap,\u5f97\u5230\u4e0b\u56fe:\n\n\u7531\u4e8e\u6211\u4eec\u5728\u8fd9\u91cc\u94a6\u5b9a\u4e86\u6781\u5927\u503c\u7684\u76f8\u5bf9\u5927\u5c0f,\u6240\u4ee5\u8fd9\u91cc\u8fd8\u8981\u4e58\u4e0a$(k!)$\n\n![](https://cdn.luogu.com.cn/upload/pic/64260.png)\n\n![](https://cdn.luogu.com.cn/upload/pic/64263.png)\n\n\u5f69\u8272\u7f8a\u6bdb\u8868\u793a\u6781\u5927\u503c,\u73bb\u7483\u8868\u793a\u8fd9\u4e9b\u6781\u5927\u503c\u7684\u63a7\u5236\u8303\u56f4\u3002\n\n\u90a3\u4e48\u5982\u56fe,\u5bf9\u5e94\u989c\u8272\u73bb\u7483\u73bb\u7483\u5c31\u662f\u8be5\u989c\u8272\u7f8a\u6bdb\u7684\u63a7\u5236\u533a\u57df\u3002\n\n\u8bbe$\\text{\u9ec4}<\\text{\u84dd}<\\text{\u7ea2}<\\text{\u7eff}$,\u53cd\u6b63\u662f\u53ef\u4ee5\u968f\u4fbf\u4ea4\u6362\u7684\u3002\n\n\u90a3\u4e48,\u5bf9\u4e8e\u84dd\u8272\u7684\u533a\u57df,\u5b83\u4eec**\u53ea\u9700\u8981**\u6ee1\u8db3\u5c0f\u4e8e\u84dd\u8272\u7f8a\u6bdb\u5c31\u597d\u4e86\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5bb9\u6613\u5730\u7b97\u51fa\u6bcf\u4e2a\u533a\u57df\u7684\u5927\u5c0f,\u6bd4\u5982\u84dd\u8272\u533a\u57df\u7684\u5927\u5c0f\u662f$(n-1)(m-1)(l-1)-(n-2)(m-2)(l-2)$\n\n\u4e3a\u4e86\u65b9\u4fbf,\u6211\u4eec\u8bbe$g_i=(n-i)(m-i)(l-i)$.\n\n\u90a3\u4e48\u7b2c$i$\u5c42(\u4ece\u5916\u5230\u91cc)\u7684\u5927\u5c0f\u4e3a$g_{i-1}-g_i$\n\n\u6211\u4eec\u628a\u8fd9\u4e2a\u4e1c\u897f**\u4ece\u91cc\u5230\u5916**\u4e00\u5c42\u4e00\u5c42\u5265\u5f00\u6765\u7406\u89e3:\n\n\u663e\u800c\u6613\u89c1\u7684,\u503c$nml$\u4e00\u5b9a\u662f\u6781\u5927\u503c,\u6240\u4ee5$\\text{\u7eff}=nml$\n\n\u8fd9\u91cc$k=4$\u3002\n\n\u6211\u4eec\u77e5\u9053$|\\text{\u7eff}|=g_3-g_4$,\u6570\u503c\u4e0a\u6709\u5168\u90e8\u7684$G_4$\u4e2a\u53ef\u968f\u610f\u6392\u5217\u3002\n\n\u90a3\u4e48\u65b9\u6848\u603b\u6570\u662f$A_{G_4-1}^{g_3-g_4-1}=\\dfrac{(G_4-1)!}{(G_4-1-(g_3-g_4-1))!}=\\dfrac{(G_4-1)!}{G_3!}$.\n\n(z\u8fd9\u91cc\u4e4b\u6240\u4ee5\u51cf1\u662f\u56e0\u4e3a\u6211\u4eec\u94a6\u5b9a\u4e86\u4e00\u4e2a\u6570\u4f5c\u4e3a\u6781\u5927\u503c)\n\n\u5bf9\u4e8e\u4e0b\u4e00\u5c42,\u53ef\u4ee5\u770b\u505a\u53d8\u6210\u4e86$k$\u5c0f\u4e861(\u4ece\u91cc\u9762\u88ab\u5265\u6389\u4e86\u4e00\u5c42)\u7684\u5b50\u95ee\u9898\u3002\n\n\u6240\u4ee5\u603b\u65b9\u6848\u6570\u662f$\\prod\\limits_{i=1}^k\\dfrac{(G_i-1)!}{G_{i-1}!}$\n\n\u8fd9\u90e8\u5206\u7684\u603b\u65b9\u6848\u6570\u4e58\u8d77\u6765\u5c31\u662f$k!\\dbinom{N}{G_k}\\prod\\limits_{i=1}^k\\dfrac{(G_i-1)!}{G_{i-1}!}$\n\n- \u5176\u4ed6\u7684\u6570\u7684\u586b\u6cd5\n\n\u653e\u4efb\u81ea\u6d41\u5c31\u597d\u4e86,\u5269\u4e0b$g_k$\u4e2a\u6570,\u90a3\u4e48\u76f4\u63a5$g_k!$\u5373\u53ef\u3002\n\n\u6211\u4eec\u628a\u516c\u5f0f\u6c47\u603b\u4e00\u4e0b:\n\n$F(k)=\\frac{1}{k!}\\prod\\limits_{i=0}^{k-1}g_ig_k!k!\\dbinom{N}{G_k}\\prod\\limits_{i=1}^k\\dfrac{(G_i-1)!}{G_{i-1}!}$\n\n$=\\dfrac{N!}{g_k!G_k!}\\prod\\limits_{i=0}^{k-1}g_ig_k!\\prod\\limits_{i=1}^k\\dfrac{(G_i-1)!}{G_{i-1}!}$\n\n\u56e0\u4e3a\u6211\u4eec\u8fd9\u91cc\u7b97\u7684\u662f\u65b9\u6848\u6570,\u8fd9\u91cc\u9664\u4ee5$N!$\u5c31\u662f\u6982\u7387\u3002\n\n$=\\dfrac{1}{G_k!}\\prod\\limits_{i=0}^{k-1}g_i\\prod\\limits_{i=1}^k\\dfrac{(G_i-1)!}{G_{i-1}!}$\n\n\u90a3\u4e48\u5230\u4e86\u8fd9\u91cc,\u4f60\u4f1a\u6ce8\u610f\u5230$G_k$\u662f$O(nk)$\u7ea7\u522b\u7684,\u90a3\u4e48\u66b4\u529b\u9884\u5904\u7406\u6240\u6709\u7684$G!$\u5c31\u80fd\u5f97\u523080\u5206\u3002\n\n\u6211\u4eec\u53d1\u73b0\u5f0f\u5b50\u7684\u524d\u9762\u6709\u4e00\u4e2a$\\dfrac{1}{G_k!}$,\u628a\u5b83\u585e\u8fdb\u540e\u9762\u7684$\\prod$\u91cc\u9762\u3002\n\n$=\\prod\\limits_{i=0}^{k-1}g_iG_0!\\prod\\limits_{i=1}^k\\dfrac{(G_i-1)!}{G_i!}$\n\n$=\\prod\\limits_{i=0}^{k-1}g_iG_0!\\prod\\limits_{i=1}^k\\dfrac{1}{G_i}$\n\n\u7531\u4e8e$G_0!=0!=1$\u5f97\u5230$F(k)=\\prod\\limits_{i=0}^{k-1}g_i\\prod\\limits_{i=1}^k\\dfrac{1}{G_i}$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u5341\u5206\u7684\u7b80\u6d01,\u4e0d\u8fc7\u6211\u4eec\u5bf9\u4e8e$G$\u8981\u91c7\u7528\u7ebf\u6027\u6c42\u9006\u5143\u624d\u884c,\u5426\u5219\u590d\u6742\u5ea6\u591a\u4e00\u4e2alog\u3002\n\n\u6c42\u51fa$F$\u4e4b\u540e\u66b4\u529b\u4e8c\u9879\u5f0f\u53cd\u6f14\u5373\u53ef\u3002\n\n\u603b\u590d\u6742\u5ea6$O((n+k)T)$(\u6ce8\u610f\u5361\u5e38\u6570)\n\n\u7531\u4e8e\u8fd9\u9898\u65f6\u95f4\u9650\u5236\u5f88\u677e,\u6211\u5c31$O((n+k)Tlog(mod))$\u8279\u8fc7\u53bb\u4e86\u2026\u2026\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#define mod 998244353\n#define MaxN 5000500\nusing namespace std;\nlong long powM(long long a,long long t=mod-2)\n{\n  a=(a%mod+mod)%mod;\n  long long ans=1;\n  while(t){\n  \tif(t&1)ans=(ans*a)%mod;\n  \ta=(a*a)%mod;\n  \tt>>=1;\n  }return ans;\n}\nlong long fac[MaxN],inv[MaxN];\nvoid Init()\n{\n  fac[0]=fac[1]=inv[0]=inv[1]=1;\n  for (int i=2;i<=5000000;i++){\n    fac[i]=fac[i-1]*i%mod;\n    inv[i]=(mod-mod/i)*inv[mod%i]%mod;\n  }for (int i=2;i<=5000000;i++)\n    inv[i]=inv[i]*inv[i-1]%mod;\n}\nlong long C(int n,int m)\n{return fac[n]*inv[n-m]%mod*inv[m]%mod;}\nint F[MaxN],G[MaxN],Gl[MaxN],R,n,m,l,k,T;\ninline int g(int k)\n{return 1ll*(n-k)*(m-k)%mod*(l-k)%mod;}\nint main()\n{\n  Init();Gl[0]=1;\n  int qt;\n  scanf(\"%d\",&qt);\n  while(qt--){\n\tscanf(\"%d%d%d%d\",&n,&m,&l,&k);\n\tR=min(n,min(m,l));\n\tif (k>R){printf(\"0\\n\");continue;}\n\tT=1ll*n*m%mod*l%mod;\n\tfor (int i=1;i<=R;i++)\n\t  G[i]=powM((T-g(i)+mod)%mod);\n\tlong long buf=1;\n\tfor (int i=1;i<=R;i++)\n\t  F[i]=buf=buf*g(i-1)%mod*G[i]%mod;\n    buf=0;\n\tfor (int i=k;i<=R;i++)\n\t  if ((i-k)&1)\n\t    buf=(buf-C(i,k)*F[i])%mod;\n\t  else buf=(buf+C(i,k)*F[i])%mod;\n\tprintf(\"%lld\\n\",(buf+mod)%mod);\n  }return 0;\n}\n```\n\n",
        "postTime": 1563344188,
        "uid": 58705,
        "name": "command_block",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5400 \u3010[CTS2019]\u968f\u673a\u7acb\u65b9\u4f53\u3011"
    },
    {
        "content": "[\u6ecb\u78c1\u53bb\u6211\u7684\u535a\u5ba2\u770b\u5416](https://vixbob.moe/16.html)\n\n\u8c22\u8c22$\\text{Dew}$\u795e\u4ed9\u6307\u51fa\u7684\u51e0\u5904\u7b14\u8bef\u3002$\\text{Update:2019.5.20}$\n\n\u76f4\u63a5\u505a\u597d\u50cf\u4e0d\u592a\u661f\uff0c\u8003\u8651\u5bb9\u65a5\u3002\n\n\u8bbe$f_i$\u8868\u793a\u81f3\u5c11\u6709$i$\u4e2a\u6781\u5927\u7684\u6570\u7684\u65b9\u6848\u6570\uff0c$N = n \\times m \\times l$\u3002\u5219\u6709\uff1a\n$$\nf_i=\\binom{N}{g_i}b_i\\times h_i\\times (N - g_i)!\n$$\n$b_i$\u8868\u793a\u9009\u51fa$i$\u4e2a\u4e09\u7ef4\u5750\u6807\u90fd\u4e0d\u76f8\u540c\u7684\u70b9\u7684\u65b9\u6848\u6570\u3002($i$\u4e2a\u6781\u5927\u7684\u6570)\n\n$g_i$\u8868\u793a\u548c$i$\u4e2a\u6781\u5927\u7684\u6570\u4e2d\u4efb\u610f\u4e00\u4e2a\u81f3\u5c11\u6709\u4e00\u7ef4\u5750\u6807\u76f8\u540c\u7684\u70b9\u7684\u4e2a\u6570\u3002\n\n$h_i$\u8868\u793a\u5c06$g_i$\u4e2a\u6570\u5b57\u5206\u914d\u7ed9$g_i$\u7684\u4e2a\u70b9\u7684**\u5408\u6cd5**\u5206\u914d\u7684\u65b9\u6848\u6570\u3002(\u5408\u6cd5\u6307\u7684\u662f$i$\u4e2a\u6781\u5927\u7684\u6570\u53ef\u4ee5\u540c\u65f6\u5b58\u5728)\n\n\u6211\u4eec\u4e00\u4e2a\u4e00\u4e2a\u8003\u8651\u3002\n\n\u8003\u8651$b_i$\u600e\u4e48\u7b97\uff1a\n\n\u4f60\u6bcf\u9009\u62e9\u51fa\u6765\u4e00\u4e2a\u70b9$(x_0,y_0,z_0)$\u5e76\u94a6\u5b9a\u5b83\u4e3a\u6781\u5927\u7684\uff0c$x=x_0,y=y_0,z=z_0$\u8fd9\u4e09\u4e2a\u5e73\u9762\u4e0a\u7684\u70b9\u90fd\u4e0d\u80fd\u518d\u4f5c\u4e3a\u6781\u5927\u7684\u70b9\u4e86\uff0c\u76f8\u5f53\u4e8e\u7acb\u65b9\u4f53\u4ece$n \\times m \\times l$\u53d8\u6210\u4e86$(n-1)\\times (m-1)\\times (l-1)$\u3002\u6240\u4ee5\u663e\u7136\u6709\uff1a\n$$\nb_i =\\frac{1}{i!}\\prod_{j=0}^{i-1}(n-j)\\times(m-j)\\times(l-j)\n$$\n\u8003\u8651$g_i$\u600e\u4e48\u7b97\uff1a\n\n\u90fd\u77e5\u9053$b_i$\u600e\u4e48\u7b97\u4e86\uff0c\u663e\u7136\u6709\n$$\ng_i=n\\times m\\times l-(n-i)\\times (m-i)\\times (l-i)\n$$\n\u8003\u8651$h_i$\u600e\u4e48\u7b97\uff1a\n\n\u8bbe\u9700\u8981\u6bd4\u7b2c$i$\u4e2a\u6781\u5927\u7684\u70b9\u8981\u5c0f\u7684\u70b9\u4e0a\u6570\u5b57\u96c6\u5408\u4e3a$S_i$\uff0c$a_i$\u8868\u793a\u7b2c$i$\u4e2a\u6781\u5927\u7684\u70b9\u4e0a\u7684\u6570\u5b57\u3002\n\n\u6211\u4eec\u5148\u94a6\u5b9a$i$\u4e2a\u6781\u5927\u7684\u70b9\u4e0a\u7684\u6570\u5b57\u7684\u5927\u5c0f\u5173\u7cfb\u3002\u6211\u4eec\u7531\u6570\u5b57\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u4f9d\u6b21\u8003\u8651\u8fd9\u4e2a$i$\u4e2a\u6781\u5927\u7684\u70b9\u3002\u8003\u8651\u52a0\u5165\u7b2c$j$\u4e2a\u6781\u5927\u7684\u70b9\u540e\u65b9\u6848\u6570\u7684\u53d8\u5316\uff1a\n\n\u56e0\u4e3a\u65b0\u52a0\u5165\u6781\u5927\u7684\u70b9$j$\u6bd4\u5df2\u7ecf\u52a0\u5165\u7684$j-1$\u4e2a\u6781\u5927\u7684\u70b9\u90fd\u8981\u5927\uff0c\u6240\u4ee5\u6709\uff1a\n$$\na[j] > k, \\forall k\\in {S_j{\\large\\cap} S_r}(r\\in [1,j-1])\n$$\n\u6240\u4ee5\u6211\u4eec\u53ea\u7528\u8003\u8651\uff1a$S_j$\u548c\u524d$j-1$\u6781\u5927\u7684\u70b9\u7684\u96c6\u5408\u4e0d\u4ea4\u7684\u90e8\u5206\u3002\u5e76\u4e14\u8fd9\u90e8\u5206\u548c\u524d$j-1$\u4e2a\u6781\u5927\u7684\u70b9\u7684\u96c6\u5408\u7684\u4ea4\u96c6\u6ca1\u6709\u660e\u786e\u7684\u5927\u5c0f\u5173\u7cfb\u3002\u8bbe$S_i$\u548c\u524d$i-1$\u4e2a\u96c6\u5408\u7684\u5e76\u96c6\u7684\u4e0d\u4ea4\u90e8\u5206\u7684\u5927\u5c0f\u4e3a$R$\uff0c\u5219\u6709\uff1a\n$$\nh_i=h_{i-1}\\times \\left(\\left|{\\large\\cup}_{j=1}^{i-1}S_j\\right|+1\\right)^{\\overline{R}}\n$$\nPS\uff1a$x^{\\overline{n}}$\u8868\u793a$x$\u7684$n$\u6b21\u4e0a\u5347\u5e42\u3002\n\n\u5e76\u4e14\u6709$R=g_i-g_{i-1}-1, \\left|{\\large\\cup}_{j=1}^{i-1}S_j\\right| = g_i$\u3002\u6240\u4ee5\uff1a\n$$\n\\begin{aligned}h_i&=h_{i-1}\\times (g_{i-1}+1)^{\\overline{g_{i}-g_{i-1}}}\\\\&=h_{i-1} \\times \\frac{(g_i-1)!}{g_{i-1}!}\\\\&=\\prod_{j=1}^i\\frac{(g_{j}-1)!}{g_{j-1}!}\\end{aligned}\n$$\n\n(\u539f\u6587\u4e3a$R=g_i-g_{i-1},\\left|{\\large\\cup}_{j=1}^{i-1}S_j\\right| = g_{i}$\u3002\u5df2\u66f4\u6b63\uff0c\u8c22\u8c22$\\text{Zhang}\\_\\text{RQ}$\u805a\u805a\u6307\u51fa\u7684\u9519\u8bef\u3002$\\text{Update:2019.7.8}$)\n\n\u8bb0\u5f97\u6700\u540e\u6211\u4eec\u5bf9\u4e8e$h_i$\u8fd8\u8981\u4e58\u4e0a$i$\u7684\u9636\u4e58\uff0c\u56e0\u4e3a\u4e00\u5f00\u59cb\u6211\u4eec\u94a6\u5b9a\u4e86\u5927\u5c0f\u987a\u5e8f\u3002\n\n\u7136\u540e\u628a\u6240\u6709\u7684\u4e1c\u897f\u90fd\u4ee3\u56de\u53bb\uff0c\u5219\u6709\uff1a\n$$\n\\begin{aligned}f_i&=\\binom{N}{g_i}b_i\\times i!\\prod_{j=1}^i\\frac{(g_j-1)!}{g_{j-1}!}\\times (N - g_i)!\\\\&=\\frac{N!}{(N-g_i)!g_i!}\\times i!\\prod_{j=1}^i\\frac{(g_j-1)!}{g_{j-1}!}\\times (N - g_i)!\\times b_i\\end{aligned}\n$$\n\u53d1\u73b0\u6211\u4eec\u6700\u540e\u7b97\u6982\u7387\u7684\u65f6\u5019\u8981\u4e58\u4e0a$\\frac{1}{N!}$\u5e76\u4e14\u5f0f\u5b50\u7684\u6700\u540e\u6709\u4e00\u4e2a$(N-g_i)!$\uff0c\u5219\u6709\uff1a\n$$\n\\begin{aligned}f_i&=\\frac{i!}{g_i!}\\times \\prod _{j=1}^i\\frac{(g_j-1)!}{g_{j-1}!}\\\\&=i!\\prod_{j=1}^i\\frac{(g_j-1)!}{g_j!}\\\\&=i!\\prod_{j=1}^i\\frac{1}{g_j}\\end{aligned}\n$$\n\u6700\u540e\u4e8c\u9879\u5f0f\u53cd\u6f14\u4e00\u4e0b\u6709\uff1a\n$$\nans = \\sum_{i=k}^{\\min(n,m,l)}(-1)^{i-k}\\binom{i}{k}f_i\n$$\n\n\n\u7136\u540e\u6709\u56e0\u4e3a\u6211\u4eec\u6700\u591a\u53ea\u80fd\u9009\u51fa$\\min(n,m,l)$\u4e2a\u6781\u5927\u7684\u70b9\u5e76\u4e14\u8981\u6c42\u4e00\u4e2a$g_i$\u7684\u9006\u5143\uff0c\u6240\u4ee5\u73b0\u5728\u590d\u6742\u5ea6\u4e3a$O(T\\min(n,m,l)\\log P)$\u3002\u53ef\u4ee5\u83b7\u5f97$80$\u5206\u7684\u597d\u6210\u7ee9....\n\n\u7136\u540e\u8fd9\u4e2a\u5730\u65b9\u6211\u4eec\u6709\u4e00\u4e2a\u5c0f$\\text{trick}$\uff1a\u6211\u4eec\u9884\u5904\u7406\u51fa\u6765$g_i$\u7684\u524d\u7f00\u79ef\uff0c\u6c42\u6700\u540e\u4e00\u9879\u7684\u9006\u5143\u540e\u53ef\u4ee5\u9006\u63a8\u6bcf\u4e00\u4e2a\u524d\u7f00\u79ef\u7684\u9006\u5143....\u5c31\u548c\u9006\u63a8\u9636\u4e58\u7684\u9006\u5143\u662f\u4e00\u4e2a\u9053\u7406\u3002\u6700\u7ec8\u590d\u6742\u5ea6\u4e3a$O(T\\min(n,m,l))$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n/*\n * 3119.cpp\n * This file is part of 3119\n *\n * Copyright (C) 2019 - ViXbob\n *\n * 3119 is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 2.1 of the License, or (at your option) any later version.\n *\n * 3119 is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with 3119. If not, see <http://www.gnu.org/licenses/>.\n */\n\n/**\n * There is no end though there is a start in space. ---Infinity.\n * It has own power, it ruins, and it goes though there is a start also in the star. ---Finite.\n * Only the person who was wisdom can read the most foolish one from the history.\n * The fish that lives in the sea doesn't know the world in the land.\n * It also ruins and goes if they have wisdom.\n * It is funnier that man exceeds the speed of light than fish start living in the land.\n * It can be said that this is an final ultimatum from the god to the people who can fight.\n *\n * Steins;Gate\n */\n#include <bits/stdc++.h>\n#define rep(i, j, k) for(int i = j; i <= k; ++i)\n#define dep(i, j, k) for(int i = j; i >= k; --i)\n#define SIZE(x) ((int)x.size())\n#define mp(x, y) make_pair(x, y)\n#define pb(x) push_back(x)\n#define inv(x) (ksm(x, P - 2))\n#define getd(i) (1ll * (n - (i)) * (m - (i)) % P * (l - (i)) % P)\n\ntypedef long long ll;\ntypedef unsigned long long ull;\n\nusing namespace std;\n\nconst int maxn = 5e6 + 5;\nconst int P = 998244353;\nconst int inf = 0x3f3f3f3f;\n\ninline int read() {\n\tchar ch = getchar(); int u = 0, f = 1;\n\twhile(!isdigit(ch)) { if(ch == '-') f = -1; ch = getchar(); }\n\twhile(isdigit(ch))  { u = u * 10 + ch - 48; ch = getchar(); } return u * f;\n}\n\nint n, m, l, k, N, T, c[maxn], g[maxn], h[maxn], f[maxn], ifac[maxn], fac[maxn], mn, b[maxn], pre[maxn];\n\ninline int pls(int x, int y) { x += y; return x >= P ? x - P : x; }\ninline int dec(int x, int y) { x -= y; return x < 0 ? x + P : x; }\ninline int mul(int x, int y) { return 1ll * x * y % P; }\ninline int C(int n, int m) { return 1ll * fac[n] * ifac[m] % P * ifac[n - m] % P; }\ninline int ksm(int x, int k, int rnt = 1) { \n\tfor(int i = k; i; i >>= 1, x = 1ll * x * x % P) if(i & 1) rnt = 1ll * rnt * x % P;\n\treturn rnt;\n}\n\nint main() {\n//\tfreopen(\"1.in\", \"r\", stdin);\n//\tfreopen(\"my.out\", \"w\", stdout);\n\tT = read(); fac[0] = 1;\n\trep(i, 1, maxn - 1) fac[i] = 1ll * fac[i - 1] * i % P;\n\tifac[maxn - 1] = inv(fac[maxn - 1]);\n\tdep(i, maxn - 2, 0) ifac[i] = 1ll * ifac[i + 1] * (i + 1) % P;\n\twhile(T--) {\n\t\tn = read(); m = read(); l = read(); k = read(); h[0] = 1; b[0] = 1; pre[0] = 1;\n\t\tN = n * m * l; mn = min(n, min(m, l));\n//\t\trep(i, 1, mn) c[i] = (n - i + 1) * (m - i + 1) * (l - i + 1) - (n - i) * (m - i) * (l - i);\n\t\trep(i, 1, mn) g[i] = pls(g[i - 1], dec(getd(i - 1), getd(i)));\n\t\trep(i, 1, mn) pre[i] = 1ll * pre[i - 1] * g[i] % P;\n\t\t\t// g[i] = nml - (n - i) * (m - i) * (l - i)\n\t\t\t// \n\t\trep(i, 1, mn) b[i] = 1ll * b[i - 1] * getd(i - 1) % P;\n//\t\trep(i, 1, mn) g[i] = g[i - 1] + getd(i - 1) - getd(i);\n//\t\th[1] = fac[g[1] - 1];\n//\t\trep(i, 1, mn) h[i] = 1ll * h[i - 1] * fac[g[i] - 1] % P * ifac[g[i - 1]] % P;\n//\t\trep(i, 1, mn) f[i] = 1ll * b[i] * h[i] % P * fac[N - g[i]] % P * C(N, g[i]) % P;\n//\t\trep(i, 1, mn) h[i] = 1ll * h[i - 1] * inv(g[i]) % P;\n\t\tpre[mn] = inv(pre[mn]);\n\t\tdep(i, mn, 1) pre[i - 1] = 1ll * pre[i] * g[i] % P;\n\t\trep(i, 1, mn) f[i] = 1ll * b[i] * pre[i] % P;\n\t\tint ans = 0;\n\t\trep(i, k, mn) if((i - k) & 1) ans = dec(ans, 1ll * C(i, k) * f[i] % P);\n\t\t\t\telse ans = pls(ans, 1ll * C(i, k) * f[i] % P);\n\t\tcout << 1ll * ans % P << endl;\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1558252669,
        "uid": 50971,
        "name": "ViXbob",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5400 \u3010[CTS2019]\u968f\u673a\u7acb\u65b9\u4f53\u3011"
    },
    {
        "content": "\u6211\u4eec\u5148\u8003\u8651\u4e00\u4e9b\u4e8b\u5b9e\n\n- \u5982\u679c\u6211\u4eec\u5728\u4f4d\u7f6e$(x_0,y_0,z_0)$\u94a6\u5b9a\u4e86\u4e00\u4e2a\u6781\u5927\u6570$p$\uff0c\u90a3\u4e48\u6211\u4eec\u9700\u8981\u628a$x=x_0$\uff0c$y=y_0$\u4e0e$z=z_0$\u7684\u4e09\u4e2a\u5e73\u9762\u7684\u4ea4\u4e2d\u586b\u4e0a\u6bd4$p$\u5c0f\u7684\u6570\u5b57\uff0c\u8fd9\u6837\uff0c\u5269\u4e0b\u7684\u6b63\u65b9\u4f53\u5c31\u6210\u4e86\u4e00\u4e2a\u957f\u5bbd\u9ad8\u5206\u522b\u4e3a$(n-1)(m-1)(l-1)$\u7684\u5b50\u95ee\u9898\u4e86\u3002\n- \u8003\u8651\u5230\u6211\u4eec\u4f7f\u7528\u7684\u662f\u6570\u5b57\u7684\u76f8\u5bf9\u5927\u5c0f\u5173\u7cfb\uff0c\u800c\u4e0d\u662f\u6570\u5b57\u7684\u503c\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4efb\u610f\u7684$k$\u4e2a\u6570\u5b57\uff0c\u53d1\u6325\u7684\u4f5c\u7528\u662f\u5b8c\u5168\u4e00\u6837\u7684\uff0c\u4ed6\u4eec\u4e92\u4e0d\u76f8\u540c\u3002\n\n\u4ee5\u4e0a\u4e24\u4e2a\u4e8b\u5b9e\u90fd\u53ef\u4ee5\u542f\u53d1\u6211\u4eec\u5f80\u5bb9\u65a5\u7684\u65b9\u5411\u60f3\uff0c\u8003\u8651\u5bb9\u65a5\u3002\n\n\u8bbe$dp_i$\u4e3a\u81f3\u5c11\u6709$i$\u4e2a\u6781\u5927\u6570\u5b57\u7684\u65b9\u6848\u6570\uff0c\u7136\u540e\u6211\u4eec\u8fdb\u884c\u94a6\u5b9a\u3002\n\n$dp_i$\u7b49\u4e8e(\u94a6\u5b9a$i$\u4e2a\u6781\u5927\u6570\u7684\u4f4d\u7f6e\u65b9\u6848\u6570)$\\times$(\u6781\u5927\u6570\u5220\u53bb\u5e73\u9762\u7684\u4ea4\u7684\u586b\u5145\u65b9\u6848\u6570)$\\times$(\u5269\u4e0b\u968f\u610f\u53d1\u6325\u7684\u5269\u4f59\u6b63\u65b9\u4f53\u586b\u5145\u65b9\u6848\u6570)\n\n\u9996\u5148\u6211\u4eec\u9700\u8981\u628a\u6240\u6709\u7684\u6570\u5b57\u5206\u6210\u4e24\u90e8\u5206\uff0c\u5220\u53bb\u7684\u5e73\u9762\u4ea4\u4e0e\u5269\u4f59\u7684\u6b63\u65b9\u4f53\u3002\n\n\u8fd9\u91cc\u8bbe$N=n\\times m\\times l$,$g_i$\u4e3a\u94a6\u5b9a$i$\u4e2a\u6781\u5927\u503c\u540e\u5220\u53bb\u5e73\u9762\u4ea4\u7684\u65b9\u5757\u6570\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6570\u5b57\u7684\u5212\u5206\u65b9\u6848\u6570\u5c31\u662f$\\binom{N}{g_i}$\n\n$g_i$\u7684\u8868\u8fbe\u5f0f\u4e5f\u5f88\u7b80\u5355\uff0c$g_i=nml-(n-i)(m-i)(l-i)$\n\n\u7136\u540e\u6328\u4e2a\u8003\u8651$dp$\u7684\u7ec4\u6210\u6210\u5206\uff0c\u8bbe$f_i$\u7b49\u4e8e\u94a6\u5b9a$i$\u4e2a\u6781\u5927\u7684\u4f4d\u7f6e\u7684\u65b9\u6848\u6570\uff0c\u56e0\u4e3a\u6bcf\u6b21\u90fd\u662f\u5b50\u95ee\u9898\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a\u5f88\u7b80\u5355\n\n$$f_i=\\prod_{j=0}^{i-1}(n-j)(m-j)(l-j)$$\n\n\u8bbe$h_i$\u8868\u793a\u5220\u53bb\u7684\u5e73\u9762\u4ea4\u7684\u586b\u5145\u65b9\u6848\u6570\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e2a\u4e1c\u897f\u4e00\u4e0b\u5b50\u6c42\u4e0d\u6765\uff0c\u53ef\u4ee5\u8003\u8651\u4e00\u4e0b\u9012\u63a8\u7684\u65b9\u6cd5\u3002\n\n\u6211\u4eec\u518d\u8003\u8651\u4e00\u4e2a\u4e8b\u5b9e\n\n- \u5982\u679c\u5148\u94a6\u5b9a\u4e86$x$\uff0c\u7136\u540e\u5220\u53bb\u4e86\u76f8\u5173\u5e73\u9762\uff0c\u518d\u94a6\u5b9a$y$\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8ba9\u5220\u53bb\u7684\u5e73\u9762\u4e2d\u7684\u586b\u5145\u4e0d\u5f71\u54cd$y$\uff0c\u6211\u4eec\u9700\u8981\u6ee1\u8db3\u6761\u4ef6$x<y$\n\n\u8fd9\u542f\u53d1\u6211\u4eec\u5148\u8fdb\u884c\u6570\u503c\u5927\u7684\u5916\u9762\u7684\u586b\u5145\n\n\u6211\u4eec\u5148\u628a$g_i$\u4e2a\u6570\u4e2d\u6700\u5927\u7684\u6570\u503c\u62ff\u51fa\u6765\uff0c\u586b\u5230\u5bf9\u5e94\u4f4d\u7f6e\uff0c\u7136\u540e\u5269\u4e0b\u7684$g_i-g_{i-1}+1$\u4e2a\u4f4d\u7f6e\uff08\u5c31\u662f\u7b2c$i$\u6b21\u5220\u53bb\u7684\u5e73\u9762\uff09\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u53ef\u4ee5\u968f\u4fbf\u9009\u62e9\u4e00\u4e2a\u6570\uff0c\u65b9\u6848\u6570\u4e3a$\\frac{(g_i-1)!}{g_{i-1}!}$\uff0c\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5269\u4e0b\u7684\u6570\u7684\u586b\u5145\u5c31\u662f\u5b50\u95ee\u9898$h_{i-1}$\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\n\n$$\\begin{aligned}h_i&=\\frac{(g_i-1)!}{g_{i-1}!}\\times h_{i-1}\\\\&=\\prod_{j=0}^{i-1}\\frac{(g_{j+1}-1)!}{g_j!}\\end{aligned}$$\n\n\u6700\u540e\u9762\u968f\u610f\u586b\u5145\u5c31\u7b80\u5355\u4e86\u5c31\u662f$(N-g_i)!$\n\n\u7136\u540e\u6211\u4eec\u5e26\u56de\u53bb\u5316\u7b80\u4e00\u4e0b\n\n$$\\begin{aligned}dp_i&=\\binom{N}{g_i}f_ih_i(N-g_i)!\\\\&=N!f_i\\prod_{j=1}^{i}(g_j-1)!\\prod_{j=0}^{i}\\frac{1}{g_j!}\\\\&=N!f_i\\prod_{j=1}^{i}\\frac{1}{g_j}\\end{aligned}$$\n\n\u6211\u4eec\u73b0\u5728\u6c42\u7684\u662f\u65b9\u6848\u6570\uff0c\u4f46\u9898\u610f\u662f\u6982\u7387\u3002\u6240\u4ee5\u8fd9\u4e2a$N!$\u5176\u5b9e\u76f4\u63a5\u6254\u4e86\u5c31\u597d\u3002\n\n\u4ee4$dp_i$\u4ee3\u8868\u81f3\u5c11$i$\u4e2a\u6781\u5927\u6570\u7684\u6982\u7387\uff0c\u90a3\u4e48\n\n$$dp_i=f_i\\prod_{j=1}^i\\frac{1}{g_j}$$\n\n\u6211\u4eec\u77e5\u9053\uff0c\u5982\u679c$a\\times b=c$\uff0c\u90a3\u4e48\u53ef\u4ee5\u6709\n\n$$a^{-1}\\equiv c^{-1}b\\pmod p$$\n\n\u6709\u4e86\u8fd9\u4e2a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7ebf\u6027\u6c42$g$\u7684\u9006\u5143\u4e86\uff0c\u8fd9\u4e5f\u662f\u6211\u4eec\u719f\u77e5\u7684\u9636\u4e58\u9006\u5143\u7684\u65b9\u6cd5\u3002\n\n\u8fd8\u6709\u6700\u540e\u4e00\u6b65\uff0c\u8bbe$ans_i$\u4e3a\u6070\u597d$i$\u4e2a\u6781\u5927\u6570\u7684\u6982\u7387\n\n\u8bbe$mi=\\min(n,m,l)$\n\n\u6211\u4eec\u6709\n\n$$dp_i=\\sum_{j=i}^{mi}ans_j\\binom{j}{i}$$\n\n\u7531\u4e8c\u9879\u5f0f\u53cd\u6f14\u53ef\u5f97\n\n$$ans_i=\\sum_{j=i}^{mi}dp_j\\binom{j}{i}(-1)^{j-i}$$\n\n------\n\n\u4ec0\u4e48\uff1f\u4f60\u4e0d\u4f1a\u4e8c\u9879\u5f0f\u53cd\u6f14\uff1f\uff08~~\u5176\u5b9e\u6211\u81ea\u5df1\u5fd8\u4e86\u5c31\u5c1d\u8bd5\u63a8\u4e86\u4e00\u4f1a\u513f\uff0c\u4f46\u6211\u5e76\u4e0d\u4f1a\u6bd4\u8f83\u611f\u6027\u7406\u89e3\u7684\uff0c\u53ea\u4f1a\u4e00\u4e2a\u63a8\u5f0f\u5b50\u7684~~\uff09\n\n\u82e5\n\n$$A_i=\\sum_{j=i}^n\\binom{j}{i}B_j$$\n\n\u8bbe$\\delta_{i,j}$\u4e3a\u6ee1\u8db3\n\n$$B_i=\\sum_{j=i}^n\\delta_{i,j}A_j$$\n\n\u7684\u4e1c\u897f\uff0c\u8003\u8651\u6c42\u51faTa\n\n$$\\begin{aligned}B_i&=\\sum_{j=i}^n\\delta_{i,j}A_j\\\\&=\\sum_{j=i}^n\\delta_{i,j}\\sum_{k=j}^n\\binom{k}{j}B_k\\\\&=\\sum_{k=i}^nB_k\\sum_{j=i}^k\\delta_{i,j}\\binom{k}{j}\\end{aligned}$$\n\n\u53ef\u4ee5\u5f97\u5230\uff0c\u6211\u4eec\u9700\u8981\u6ee1\u8db3\n\n$$\\sum_{j=i}^k\\delta_{i,j}\\binom{k}{j}=[k=i]$$\n\n\u5728\u4f18\u79c0\u7684\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u7684\u67d0\u6b65\u8bc1\u660e\u4e2d\uff0c\u6211\u4eec\u7528\u5230\u4e86\u8fd9\u4e2a\u5f0f\u5b50\n\n$$\\sum_{i=0}^n(-1)^i\\binom{n}{i}=[n=0]$$\n\n\u8bc1\u660e\u65b9\u6cd5\u5f88\u591a\uff0c\u4e0d\u8bf4\u4e86\n\n\u968f\u4fbf\u628a\u8fd9\u4e2a\u5f0f\u5b50\u53d8\u4e00\u53d8\n\n$$\\sum_{j=i}^k(-1)^{j-i}\\binom{k-i}{k-j}=[k=i]$$\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\n\n$$\\delta_{i,j}\\binom{k}{j}=(-1)^{j-i}\\binom{k-i}{k-j}$$\n\n\u7136\u540e\u4f60\u89e3\u51fa\u6765\u5c31\u53ef\u4ee5\u4e86\uff0c\u4f46\u662f\u6211\u4eec\u5e73\u5e38\u5199\u8d77\u6765\u5176\u5b9e\u5e94\u8be5\u4e0d\u662f\u8fd9\u6837\u7684\n\n\u6ce8\u610f\u5230\u4e00\u4e2a\u7ec4\u5408\u5f0f\n\n$$\\binom{k}{j}\\binom{j}{i}=\\binom{k}{i}\\binom{k-i}{k-j}$$\n\n\u8fd9\u4e2a\u8bc1\u660e\u65b9\u6cd5\u4e5f\u591a\uff0c\u4f60\u62c6\u5f00\u6216\u8005\u7ec4\u5408\u610f\u4e49\u7406\u89e3\u90fd\u884c\n\n\u800c\n\n$$\\binom{k}{i}\\sum_{j=i}^k(-1)^{j-i}\\binom{k-i}{k-j}=[k=i]$$\n\n\u5c31\u662f\u628a\u8fd9\u4e2a\u52a0\u5230\u524d\u9762\u5e76\u4e0d\u4f1a\u5f71\u54cd\u4ec0\u4e48\n\n\u4e8e\u662f\u6211\u4eec\u6709\n\n$$\\delta_{i,j}=(-1)^{j-i}\\binom{j}{i}$$\n\n\u7efc\u4e0a\n$$B_i=\\sum_{j=i}^n(-1)^{j-i}\\binom{j}{i}A_j$$\n\n------\n\n**Code:**\n\n```cpp\n#include <cstdio>\n#include <cctype>\n#include <algorithm>\nusing std::min;\nconst int SIZE=1<<21;\nchar ibuf[SIZE],*iS,*iT;\n//#define gc() (iS==iT?(iT=(iS=ibuf)+fread(ibuf,1,SIZE,stdin),iS==iT?EOF:*iS++):*iS++)\n#define gc() getchar()\ntemplate <class T>\nvoid read(T &x)\n{\n\tx=0;char c=gc();\n\twhile(!isdigit(c)) c=gc();\n\twhile(isdigit(c)) x=x*10+c-'0',c=gc();\n}\nconst int mod=998244353;\nint inline add(int x,int y){return x+y>=mod?x+y-mod:x+y;}\n#define mul(x,y) (1ll*(x)*(y)%mod)\nint qp(int d,int k){int f=1;while(k){if(k&1)f=mul(f,d);d=mul(d,d),k>>=1;}return f;}\nconst int N=5e6+1;\nint fac[N],inv[N],dp[N],f[N],g[N],invg[N],yuy[N];\nint C(int m,int n){return mul(mul(fac[m],inv[n]),inv[m-n]);}\nint main()\n{\n\tfac[0]=1;for(int i=1;i<N;i++) fac[i]=mul(fac[i-1],i);\n\tinv[N-1]=qp(fac[N-1],mod-2);\n\tfor(int i=N-2;~i;i--) inv[i]=mul(inv[i+1],i+1);\n\tint T,n,m,l,k;read(T);\n\twhile(T--)\n\t{\n\t\tread(n),read(m),read(l),read(k);\n\t\tint mi=min(n,min(m,l));\n\t\tif(k>mi)\n\t\t{\n\t\t\tputs(\"0\");\n\t\t\tcontinue;\n\t\t}\n\t\tf[0]=1;\n\t\tfor(int i=0;i<mi;i++) f[i+1]=mul(f[i],yuy[i]=mul(n-i,mul(m-i,l-i)));\n\t\tint fg=1,tot=yuy[0];\n\t\tyuy[mi]=0;\n\t\tfor(int i=1;i<=mi;i++)\n\t\t{\n\t\t\tg[i]=add(tot,mod-yuy[i]);\n\t\t\tfg=mul(fg,g[i]);\n\t\t}\n\t\tinvg[mi]=qp(fg,mod-2);\n\t\tfor(int i=mi-1;~i;i--) invg[i]=mul(invg[i+1],g[i+1]);\n\t\tfor(int i=1;i<=mi;i++) dp[i]=mul(f[i],invg[i]);\n\t\tint ans=0;\n\t\tfor(int i=k;i<=mi;i++)\n\t\t{\n\t\t\tif(i-k&1) ans=add(ans,mod-mul(C(i,k),dp[i]));\n\t\t\telse ans=add(ans,mul(C(i,k),dp[i]));\n\t\t}\n\t\tprintf(\"%d\\n\",ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1558345442,
        "uid": 63727,
        "name": "ButterflyDew",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5400 \u3010[CTS2019]\u968f\u673a\u7acb\u65b9\u4f53\u3011"
    },
    {
        "content": "[\u4f60\u5c31\u4e0d\u60f3\u8bd5\u7740\u70b9\u70b9\u8fd9\u4e2a\u8fde\u63a5\u5417qwq](https://www.cnblogs.com/penth/p/11389506.html)\n\n\u6211\u770b\u8fd9\u91cc\u5176\u4ed6\u7684\u9898\u89e3\u5e76\u6ca1\u6709\u770b\u61c2\uff0c\u8fd9\u7bc7\u9002\u5408\u516c\u5f0f\u6050\u60e7\u75c7\u60a3\u8005\u670d\u7528 \\_(:\u0437\u309d\u2220)\\_\n\n## Problem\n\n[$\\mathtt {loj-3119}$](https://loj.ac/problem/3119)\n\n\u9898\u610f\u6982\u8981\uff1a\u4e00\u4e2a $n\\times m\\times l$ \u7684\u7acb\u65b9\u4f53\uff0c\u7acb\u65b9\u4f53\u4e2d\u6bcf\u4e2a\u683c\u5b50\u4e0a\u90fd\u6709\u4e00\u4e2a\u6570\uff0c\u5982\u679c\u67d0\u4e2a\u683c\u5b50\u4e0a\u7684\u6570\u6bd4\u4e09\u7ef4\u5750\u6807\u4e2d**\u81f3\u5c11\u6709\u4e00\u7ef4**\u76f8\u540c\u7684\u5176\u4ed6\u683c\u5b50\u4e0a\u7684\u6570\u90fd\u8981\u5927\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u79f0\u5b83\u662f\u6781\u5927\u7684\u3002\u5c06 $n\\times m\\times l$ \u7684\u6392\u5217\u968f\u673a\u586b\u5165\u8fd9\u4e9b\u683c\u5b50\uff0c\u6c42\u6070\u6709 $k$ \u4e2a\u6781\u5927\u7684\u6570\u7684\u6982\u7387\u3002$T$ \u7ec4\u6570\u636e\u3002\n\n$T\\le 10,\\ 1\\le n,m,l\\le 5\\times 10^6,\\ 1\\le k \\le 100$\uff0c\u65f6\u9650 $5s$\n\n## Solution\n\n\u6839\u636e\u8fd9\u4e00\u4e2a\u6708\u6765\u7684\u6570\u6570\u7ecf\u9a8c\u2026\u2026\u53d1\u73b0\uff1a\n\n- \u6c42\u7b54\u6848\u4e3a $k$ \uff08\u6743\u503c\uff09\u7684\u9898\uff1a\u5e94\u8be5\u662f\u8f6c\u6362\u6210 \u201c\u7b54\u6848\u5c0f\u4e8e\u7b49\u4e8e $k$\u201d \u51cf\u53bb \u201c\u7b54\u6848\u5c0f\u4e8e\u7b49\u4e8e $k-1$\u201d\u3002\n- \u6c42\u6070\u597d $k$ \u4e2a\uff08\u6570\u91cf\uff09\u7684\u9898\uff1a\u5e94\u8be5\u662f\u8f6c\u6362\u6210 \u201c\u81f3\u5c11\u6709 $k$ \u4e2a\u201d\uff0c\u518d\u5229\u7528\u4e8c\u9879\u5f0f\u53cd\u6f14\u5f97\u5230\u7b54\u6848\u3002\n\n\u6240\u4ee5\u8fd9\u91cc\u8bbe $f[i]$ \u8868\u793a\u81f3\u5c11\u6709 $i$ \u4e2a\u6781\u5927\u503c\u7684\u6982\u7387\uff0c\u7b54\u6848\u5373\u4e3a\uff1a\n$$\n\\sum_{i=k}^{\\min\\{n,m,l\\}}(-1)^{i-k}\\binom ik f[i]\n$$\n\u95ee\u9898\u8f6c\u6362\u6210\u6c42 $f[i]$\u3002\n\n\u9996\u5148\u9009\u51fa\u8fd9 $i$ \u4e2a\u786e\u5b9a\u7684\u6781\u5927\u503c\u7684\u5750\u6807\uff0c\u7cfb\u6570\u4e3a\uff1a$P_n^iP_m^iP_l^i$\uff08\u8003\u8651\u987a\u5e8f\uff0c\u540e\u8fb9\u8981\u7528\u5230\uff09\n\n>  \u5b9a\u4e49\u4e00\u4e2a\u5750\u6807 $(x_0,y_0,z_0)$ \u7684\u63a7\u5236\u8303\u56f4\u4e3a \u4e09\u4e2a\u5e73\u9762 $x=x_0,y=y_0,z=z_0$ \u7684\u5e76\uff08\u6240\u4ee5\u6781\u5927\u503c\u7684\u5b9a\u4e49\u5373\u4e3a\uff1a\u8be5\u70b9\u6743\u503c \u4e3a \u5176\u63a7\u5236\u8303\u56f4\u4e0a\u70b9\u7684\u6743\u503c\u6700\u5927\u503c\uff09\n\n\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u8fd9 $i$ \u4e2a\u5750\u6807\u7684**\u63a7\u5236\u8303\u56f4\u7684\u5e76**\u5185\uff0c\u6709\u591a\u5c11\u79cd\u5b89\u6392\u6570\u5b57**\u987a\u5e8f**\uff08\u4e0d\u662f\u6743\u503c\u800c\u662f\u5927\u5c0f\u5173\u7cfb\uff0c\u56e0\u4e3a\u76ee\u524d\u5df2\u7ecf\u9009\u51fa\u4e86\u8fd9\u4e9b\u5750\u6807\uff0c\u5e76\u4e14\u73b0\u5728\u8981\u6c42\u7684\u662f\u6982\u7387\uff0c\u800c\u975e\u65b9\u6848\u6570\uff09\u7684\u65b9\u6cd5\uff0c\u4f7f\u5f97\u5bf9\u4e8e\u6bcf\u4e2a\u9009\u5b9a\u7684\u5750\u6807\uff0c\u5176\u90fd\u4e3a\u81ea\u5df1\u63a7\u5236\u8303\u56f4\u5185\u7684\u6700\u5927\u503c\u3002\n\n\u76f4\u63a5\u8003\u8651\u8fd9\u4e2a\u95ee\u9898\u4e0d\u597d\u8003\u8651\uff0c\u9700\u8981\u627e\u5230\u7a81\u7834\u53e3\uff0c\u800c\u8fd9\u91cc\u7684\u7a81\u7834\u53e3\u5c31\u662f \u201c\u8fd9\u4e9b\u63a7\u5236\u8303\u56f4\u7684\u5e76\u5185\uff0c\u6700\u5927\u503c\u4e00\u5b9a\u662f\u4e00\u4e2a\u6781\u5927\u503c\u201d\u3002\u7531\u4e8e\u6211\u4eec\u5728\u9009\u51fa\u8fd9 $i$ \u4e2a\u5750\u6807\u7684\u65f6\u5019\uff0c\u5df2\u7ecf\u8003\u8651\u4e86\u987a\u5e8f\u95ee\u9898\uff0c\u6240\u4ee5\u82e5 **\u8fd9$i$\u4e2a\u6781\u5927\u503c\u63a7\u5236\u8303\u56f4\u7684\u5e76** \u5927\u5c0f\u4e3a $S_i$\uff0c\u5219\u8fd9\u4ef6\u4e8b\u60c5\u53d1\u751f\u7684\u6982\u7387\u4e3a $\\frac 1{S_i}$\uff0c\u5e76\u4e14\u53d1\u751f\u8fd9\u4ef6\u4e8b\u60c5\u540e\uff0c\u6240\u6709**\u53ea**\u88ab\u8fd9\u4e2a\u6781\u5927\u503c\u63a7\u5236\u7684\u70b9\u90fd\u6ca1\u7528\u4e86\uff0c\u5219\u5c06\u95ee\u9898\u8f6c\u5316\u4e3a\u9009\u51fa $i-1$ \u4e2a\u5750\u6807\u7684\u60c5\u51b5\uff0c\u5982\u6b64\u9012\u5f52\uff0c\u8ba1\u7b97\u5f97\u5230\u7684\u6743\u503c\u4e3a $\\prod_{j=1}^i\\frac 1{S_j}$\n\n\u81f3\u4e8e\u5982\u4f55\u8ba1\u7b97 $S_i$\uff0c\u53ef\u4ee5\u53d1\u73b0\u53d6\u5168\u5c40\u51cf\u591a\u4f59\u53ef\u5f97 $S_i=nml-(n-i)(m-i)(l-i)$\uff0c\u6216\u662f\u76f4\u63a5\u8003\u8651\u5bb9\u65a5 $S_i=(nm+nl+ml)i-(n+m+l)i^2+i^3$\n\n\u6c47\u603b\u4e00\u4e0b\uff0c\u5f97\u5230\uff1a\uff08\u6d1b\u8c37\u7684markdown\u4e0d\u652f\u6301\u516c\u5f0f\u6362\u884c\uff0c\u53ef\u524d\u5f80\u6211\u7684\u535a\u5ba2\u7ee7\u7eed\u9605\u8bfb\uff09\n\n$$f[i]=P_n^iP_m^iP_l^i\\prod_{j=1}^i\\frac 1{S_j}=P_n^iP_m^iP_l^i\\prod_{j=1}^i\\frac 1{nml-(n-i)(m-i)(l-i)}$$\n\n$$Ans=\\sum_{i=k}^{\\min\\{n,m,l\\}}(-1)^{i-k}\\binom ikf[i]=\\sum_{i=k}^{\\min\\{n,m,l\\}}(-1)^{i-k}\\binom ikP_n^iP_m^iP_l^i\\prod_{j=1}^i\\frac 1{nml-(n-i)(m-i)(l-i)}$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u662f\u7ebf\u6027\u7684\uff0c\u4f46\u7531\u4e8e\u540e\u5934\u90a3\u4e2a $\\prod$ \u9700\u8981\u6c42\u9006\u5143\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u4e3a $O(\\min\\{n,m,l\\}\\log p)$\uff0c\u5982\u6b64\u80fd\u8fc7 $80$\u3002\n\n\u8003\u8651\u5230\u8fd9\u4e2a\u4e1c\u897f\u5b9e\u9645\u4e0a\u662f\u8981\u6c42\u6bcf\u4e00\u4e2a\u524d\u7f00\u79ef\u7684\u9006\u5143\uff0c\u548c\u6c42\u9636\u4e58\u9006\u5143\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u5148\u6c42\u51fa\u6574\u4e2a\u524d\u7f00\u79ef\u7684\u9006\u5143\uff0c\u518d\u4ece\u540e\u9762\u5f80\u524d\u4e58\uff0c\u590d\u6742\u5ea6 $O(\\min\\{n,m,l\\}+\\log p)$\n\n> \u8bbe\uff1a\n> $$a_i=nml-(n-i)(m-i)(l-i),\\ b_i=\\prod_{j=1}^ia_j,\\ c_i=\\frac 1{b_i}$$\n> \u53ef\u4ee5 $O(1)$ \u5f97\u5230 $a_i$\uff0c$O(n)$ \u5f97\u5230 $b_i$\uff0c$O(\\log p)$ \u5f97\u5230 $c_n=\\frac 1{b_n}$\uff0c$O(n)$ \u5f97\u5230 $c_i=c_{i+1}\\cdot a_{i+1}$\n\n## Code\n\n```cpp\n//loj-3119\n#include <cstdio>\ntypedef long long ll;\n\nconst int N = 5001010, p = 998244353;\nint fac[N], ifac[N];\nint coe[N], h[N], ih[N];\nint n, m, l, k;\n\ninline int qpow(int A, int B) {\n\tint res = 1; while(B) {\n\t\tif(B&1) res = (ll)res * A%p;\n\t\tA = (ll)A * A%p, B >>= 1;\n\t} return res;\n}\n\nint main() {\n\tfac[0] = 1;\n\tfor(int i=1;i<N;++i) fac[i] = (ll)fac[i-1] * i%p;\n\tifac[N-1] = qpow(fac[N-1], p-2);\n\tfor(int i=N-1;i;--i) ifac[i-1] = (ll)ifac[i] * i%p;\n\t\n\tint T; scanf(\"%d\",&T);\n\twhile(T--) {\n\t\tscanf(\"%d%d%d%d\", &n, &m, &l, &k);\n\t\tif(n > m) n ^= m, m ^= n, n ^= m;\n\t\tif(n > l) n ^= l, l ^= n, n ^= l;\n\t\t\n\t\tconst int s2 = ((ll)n*m + (ll)m*l + (ll)n*l)%p, s1 = n+m+l;\n\t\tfor(int i=h[0]=1;i<=n;++i) {\n\t\t\tcoe[i] = (s2 - (ll)s1 * i + (ll)i*i + (ll)p*p)%p * i%p;\n\t\t\th[i] = (ll)h[i-1] * coe[i]%p;\n\t\t}\n\t\tih[n] = qpow(h[n], p-2);\n\t\tfor(int i=n;i;--i) ih[i-1] = (ll)ih[i] * coe[i]%p;\n\t\t\n\t\tconst int nml_k = (ll)fac[n] * fac[m]%p * fac[l]%p * ifac[k]%p;\n\t\t\n\t\tint Ans = 0;\n\t\tfor(int i=k;i<=n;++i) {\n\t\t\tint vl = (ll)nml_k * fac[i]%p * ifac[i-k]%p * ifac[n-i]%p * ifac[m-i]%p * ifac[l-i]%p;\n\t\t\tvl = (ll)vl * ih[i]%p;\n\t\t\tif(i-k&1) vl = p - vl;\n\t\t\t(Ans += vl) >= p && (Ans -= p);\n\t\t}\n\t\tprintf(\"%d\\n\", Ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1566376628,
        "uid": 22112,
        "name": "Mirach",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5400 \u3010[CTS2019]\u968f\u673a\u7acb\u65b9\u4f53\u3011"
    },
    {
        "content": "## \u9898\u610f\n\u6709\u4e00\u4e2a $n\\times m\\times l$ \u7684\u7acb\u65b9\u4f53\uff0c\u7acb\u65b9\u4f53\u4e2d\u6bcf\u4e2a\u683c\u5b50\u4e0a\u90fd\u6709\u4e00\u4e2a\u6570\uff0c\u5982\u679c\u67d0\u4e2a\u683c\u5b50\u4e0a\u7684\u6570\u662f\u6240\u5728\u7684\u4e09\u4e2a\u5e73\u9762\u5185\u6700\u5927\u7684\uff0c\u6211\u4eec\u5c31\u79f0\u5b83\u662f\u6781\u5927\u7684\u3002\n\n\u73b0\u5728\u5c06 $1\\sim n\\times m\\times l$ \u8fd9 $n\\times m\\times l$ \u4e2a\u6570\u7b49\u6982\u7387\u968f\u673a\u586b\u5165 $n\\times m\\times l$ \u4e2a\u683c\u5b50\uff0c\u4f7f\u5f97\u6bcf\u4e2a\u6570\u6070\u51fa\u73b0\u4e00\u6b21\uff0c\u6c42\u6070\u6709 $k$ \u4e2a\u6781\u5927\u7684\u6570\u7684\u6982\u7387\u3002\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u3002\n## \u9898\u89e3\n\u4e00\u4e2a~~\u975e\u5e38\u6709\u8da3~~\u7684**\u795e\u4ed9\u9898**\u3002\n\n$3$ \u7ef4\u7684\u9898\u76ee\u5c31\u662f\u6bd2\u7624\n\n\u9996\u5148\u6070\u597d\u5e76\u4e0d\u597d\u505a\uff0c\u8003\u8651**\u94a6\u5b9a**+\u4e8c\u9879\u5f0f\u53cd\u6f14\u3002\n\n\u8bb0 $dp_i$ \u8868\u793a**\u94a6\u5b9a** $i$ \u4e2a\u6781\u5927\u70b9\u7684\u65b9\u6848\u6570\uff0c\u6709\uff1a\n$$dp_i=\\sum_{j=i}\\binom{j}{i}ans_j\\Leftrightarrow ans_i=\\sum_{j=i}(-1)^{j-i}\\binom{j}{i}dp_j$$\n\u8fd9\u4e2a $dp$ \u770b\u4e0a\u53bb\u4e5f\u4e0d\u662f\u5f88\u597d\u6c42\uff0c\u90a3\u4e48\u4e00\u6b65\u6b65\u6765\u5206\u6790\u3002\n\n\u9996\u5148\u82e5\u662f**\u94a6\u5b9a**\u7684\u6781\u5927\u70b9\u6570\u91cf\u5df2\u77e5\uff0c\u90a3\u4e48\u4e8e\u8fd9\u4e9b\u70b9\u5171\u9762\u7684\u70b9\u4e5f\u5c31\u81ea\u7136\u5df2\u77e5\uff0c\u8bb0\u4e3a $g_i$\u3002\u663e\u7136\u4e00\u4e2a\u6781\u5927\u70b9\u4f1a\u5360\u7528\u4e00\u884c\u3001\u4e00\u5217\u3001\u4e00\u5c42\uff0c\u6ca1\u6709\u4e24\u4e2a\u6781\u5927\u70b9\u5171\u9762\u3002\u56e0\u6b64\u5269\u4e0b\u7684\u662f $(n-i)(m-i)(l-i)$\uff0c\u5373\uff1a\n$$g_i=nml-(n-i)(m-i)(l-i)$$\n\u8bbe\u603b\u6570\u4e3a $N=nml$\uff0c\u90a3\u4e48\u6211\u4eec**\u94a6\u5b9a**  $i$ \u4e2a\u6781\u5927\u503c\u4f1a\u6709 $g_i$ \u4e2a\u4f4d\u7f6e\u6709\u9650\u5236\uff0c\u9009\u51fa\u8fd9\u4e9b\u6570\u7684\u65b9\u6848\u4e3a $\\binom{N}{g_i}$\u3002\u5269\u4e0b $N-g_i$ \u4e2a\u4f4d\u7f6e\u653e\u4efb\u81ea\u6d41\uff0c\u4e3a $(N-g_i)!$\u3002\n\n\u4f46\u662f\u73b0\u5728\u6211\u4eec\u65e0\u6cd5\u533a\u5206\u4e24\u4e2a\u9009\u62e9\u6570\u76f8\u540c\u3001\u6446\u653e\u4e0d\u540c\u7684\u65b9\u6848\u3002\u6211\u4eec\u8bb0 $f_i$ \u4e3a $i$ \u4e2a\u6781\u5927\u503c\u7684\u6446\u653e\u65b9\u6848\uff0c\u56e0\u4e3a\u5750\u6807\u4e92\u4e0d\u5f71\u54cd\uff0c\u53ea\u9700\u4e24\u4e24\u4e92\u4e0d\u76f8\u540c\uff0c\u7531\u4e58\u6cd5\u539f\u7406\u5f97\u5230\uff1a\n$$f_i=n^{\\underline{i}}m^{\\underline{i}}l^{\\underline{i}}$$\n\u4e8e\u662f\u6211\u4eec\u73b0\u5728\u53ea\u5269\u4e0b\u6446\u653e\u90a3 $g_i$ \u4e2a\u6570\u7684\u65b9\u6848\u3002\u6b64\u65f6\u4e0d\u7528\u7ba1\u662f\u90a3\u4e9b\u6570\uff0c\u4e5f\u4e0d\u7528\u7ba1\u5728\u90a3\u4e9b\u4f4d\u7f6e\u3002\u56e0\u4e3a\u4ea4\u6362\u884c\u3001\u5217\u3001\u5c42\u4e0d\u5f71\u54cd\u516c\u5171\u90e8\u5206\uff08\u5373\u7ea6\u675f\u6761\u4ef6\uff09\u3002\n\n\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u8ba4\u4e3a\u6211\u4eec\u8981\u6c42\u7684\u662f\u8fd9\u4e48\u6446\u653e\u7684\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/eflhqjxh.png)\n\n\u5e76\u4e14\u6709 $\\color{green}\\text{\u7eff}\\color{black}\\text{\u5757}>\\color{blue}\\text{\u84dd}\\color{black}\\text{\u5757}>\\color{yellow}\\text{\u9ec4}\\color{black}\\text{\u5757}>\\color{red}\\text{\u7ea2}\\text{\u5757}$\n\n\u8003\u8651\u53ea\u6709\u7ea2\u5757\uff0c\u90a3\u4e48\u65b9\u6848\u6570\u4e3a $(g_1-1)!$\uff0c\u56e0\u4e3a\u6700\u5927\u503c\u5fc5\u5b9a\u5728\u7ea2\u5757\u3002\u8bb0\u4e3a\u8fd9\u4e2a\u503c $h_1$\u3002\n\n\u6b64\u65f6\u82e5\u662f\u52a0\u5165\u9ec4\u5757\uff0c\u663e\u7136\u5fc5\u5b9a\u53ef\u4ee5\u52a0\u5165\u4e14\u6210\u4e3a\u6781\u5927\u70b9\u3002\u4f1a\u65b0\u589e $g_2-g_1$ \u4e2a\u4f4d\u7f6e\u3002\u8fd9\u4e9b\u4f4d\u7f6e\u600e\u4e48\u653e\u4e0d\u4f1a\u5f71\u54cd\u7ea2\u5757\u3002\u6b64\u65f6\u65b9\u6848\u6570\u4e3a $(g2-1)^{\\underline{g_2-g_1-1}}\\times h_1$\u3002\u628a\u6700\u5927\u503c\u653e\u5728\u9ec4\u5757\u4e0a\uff0c\u9009 $g_2-g_1-1$ \u4e2a\u503c\u653e\u5728\u591a\u51fa\u6765\u7684\u4f4d\u7f6e\u3002\u5269\u4e0b $g_1$ \u4e2a\u5c31\u6cbf\u7528 $h_1$ \u7684\u65b9\u6848\uff0c\u5373 $h_2=\\frac{(g_2-1)!}{g_1!}h_1$\u3002\n\n\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\u53ef\u4ee5\u63a8\u51fa $h_3=\\frac{(g_3-1)!}{g_2!}h_2$\u3002\u66f4\u4e00\u822c\u7684\uff0c\u6709\uff1a\n$$\\begin{aligned}\nh_i&=\\frac{(g_i-1)!}{g_{i-1}!}h_{i-1}\\\\\n&=\\prod_{j=1}^i\\frac{(g_j-1)!}{g_{j-1}!}\\\\\n&=\\frac{\\prod_{j=1}^ig_j!}{\\prod_{j=1}^ig_j\\prod_{j=1}^ig_{j-1}!}\\\\\n&=\\frac{\\sout{\\prod_{j=1}^{i-1}g_j!}\\times g_i!}{\\prod_{j=1}^ig_j\\sout{\\prod_{j=1}^{i-1}g_j!}}\\\\\n&=g_i!\\prod_{j=1}^i\\frac{1}{g_j}\n\\end{aligned}$$\n\n\u4e0d\u96be\u53d1\u73b0 $h_i$ \u5c31\u662f $i$ \u4e2a\u6781\u5927\u503c\u65f6\u7684\u65b9\u6848\u6570\u4e86\u3002\n\n\u4e8e\u662f\u5c31\u53ef\u4ee5\u5199\u51fa $dp_i$ \u7684\u8868\u8fbe\u5f0f\u4e86\uff1a\n$$\n\\begin{aligned}\ndp_i&=\\binom{N}{g_i}(N-g_i)!f_ih_i\\\\\n&=\\frac{N!}{g_i!(N-g_i)!}(N-g_i)!f_ig_i!\\prod_{j=1}^i\\frac1{g_j}\\\\\n&=N!f_i\\prod_{j=1}^i\\frac1{g_j}\n\\end{aligned}\n$$\n\u7531\u4e8e\u6700\u540e\u6c42\u7684\u662f\u6982\u7387\uff0c\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u5728\u8fd9\u4e00\u6b65\u5c31\u628a $N!$ \u9664\u6389\uff0c\u5f97\u5230 $\\hat{dp_i}=f_i\\prod_{j=1}^i\\frac1{g_j}$\n\n\u4e8e\u662f\u5199\u51fa\u6700\u7ec8\u7684\u67ff\u5b50\uff1a\n$$\\frac{\\sum_{j=k}(-1)^{j-k}\\binom{j}{k}dp_j}{N!}$$\n$$\\sum_{j=k}(-1)^{j-k}\\binom{j}{k}\\hat{dp_j}$$\n\u6700\u540e\u5c31\u662f\u51e0\u4e2a\u5b9e\u73b0\u7684\u95ee\u9898\u4e86\uff1a\n- \u8ba1\u7b97 $f$ \u65f6\u53ef\u4ee5\u9012\u63a8\n- $\\prod_{j=1}^i\\frac1{g_j}$ \u9700\u8981\u7528\u7ebf\u6027\u6c42\u6cd5\n\n\u5b9e\u73b0\u8d77\u6765\u5e76\u4e0d\u662f\u5f88\u96be\u3002\n## \u4ee3\u7801\n\u8fd9\u91cc\u4ec5\u7ed9\u51fa\u6838\u5fc3\u4ee3\u7801\u3002\n```cpp\nint t;mint fac[N],ifac[N];\nmint g[N],f[N],dp[N];\nmint prod[N],inv[N];\nmint C(int n,int m){return fac[n]*ifac[m]*ifac[n-m];}\nvoid work(){\n\tint n,m,l,k;\n\tin::read(n,m,l,k);\n\tmint N=mint(1)*n*m*l;\n\tint mi=min(n,min(m,l));\n\tf[0]=1;\n\tfor(int i=1;i<=mi;i++)\n\t\tf[i]=f[i-1]*(n-i+1)*(m-i+1)*(l-i+1);\n\tfor(int i=0;i<=mi;i++)\n\t\tg[i]=N-mint(1)*(n-i)*(m-i)*(l-i);\n\tprod[0]=1;for(int i=1;i<=mi;i++)prod[i]=prod[i-1]*g[i];\n\tinv[mi]=1/prod[mi];for(int i=mi;i;i--)inv[i-1]=inv[i]*g[i];\n\tfor(int i=1;i<=mi;i++)dp[i]=f[i]*inv[i];\n\tmint ans=0;\n\tfor(int j=k;j<=mi;j++)\n\t\tif((j-k)&1)ans-=C(j,k)*dp[j];\n\t\telse ans+=C(j,k)*dp[j];\n\tout::write(ans.x);\n\tout::putc('\\n'); \n}\nsigned main(){\n\tfac[0]=1;for(int i=1;i<N;i++)fac[i]=fac[i-1]*i;\n\tifac[N-1]=1/fac[N-1];for(int i=N-1;i;i--)ifac[i-1]=ifac[i]*i;\n\tin::read(t);while(t--)work();\n\tout::flush();\n\treturn 0;\n}\n```",
        "postTime": 1614578982,
        "uid": 174304,
        "name": "jun\u5934\u5409\u5409",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5400 \u3010[CTS2019]\u968f\u673a\u7acb\u65b9\u4f53\u3011"
    },
    {
        "content": "> \u9898\u76ee\u94fe\u63a5\uff1a[\\[CTS2019\\] \u968f\u673a\u7acb\u65b9\u4f53](https://www.luogu.com.cn/problem/P5400)\n\n> **\u672c\u9898\u89e3\u540c\u6b65\u53d1\u5e03\u4e8e [My Blog](http://www.cxy07.blog/index.php/archives/126/)**\n\n\u9898\u610f\uff1a\n\n> \u6709\u4e00\u4e2a $n\\times m\\times l$ \u7684\u7acb\u65b9\u4f53\uff0c\u7acb\u65b9\u4f53\u4e2d\u6bcf\u4e2a\u683c\u5b50\u4e0a\u90fd\u6709\u4e00\u4e2a\u6570\uff0c\u5982\u679c\u67d0\u4e2a\u683c\u5b50\u4e0a\u7684\u6570\u6bd4\u4e09\u7ef4\u5750\u6807\u81f3\u5c11\u6709\u4e00\u7ef4\u76f8\u540c\u7684\u5176\u4ed6\u683c\u5b50\u4e0a\u7684\u6570\u90fd\u8981\u5927\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u79f0\u5b83\u662f\u6781\u5927\u7684\u3002\n\n> \u73b0\u5728\u5c06 $1\\sim n\\times m\\times l$ \u8fd9 $n\\times m\\times l$ \u4e2a\u6570\u7b49\u6982\u7387\u968f\u673a\u586b\u5165 $n\\times m\\times l$ \u4e2a\u683c\u5b50\uff08\u5373\u4efb\u610f\u6570\u5b57\u51fa\u73b0\u5728\u4efb\u610f\u683c\u5b50\u4e0a\u7684\u6982\u7387\u5747\u76f8\u7b49\uff09\uff0c\u4f7f\u5f97\u6bcf\u4e2a\u6570\u6070\u51fa\u73b0\u4e00\u6b21\uff0c\u6c42\u6070\u6709 $k$ \u4e2a\u6781\u5927\u7684\u6570\u7684\u6982\u7387\u3002\n\n> $1\\le T\\le 10, 1\\le n\\le 5\\times 10^6$\u3002\n\n~~\u9e3d\u8fd9\u9898\u4e0d\u77e5\u9053\u9e3d\u4e86\u591a\u4e45\uff0c\u73b0\u5728\u6765\u8865\u5751~~\n\n\u53d1\u73b0\u6070\u597d\u6709 $k$ \u4e2a\u6781\u5927\u7684\u4e0d\u597d\u7b97\uff0c\u8003\u8651\u4e8c\u9879\u5f0f\u53cd\u6f14\u4e4b\u540e\u53d8\u6210\u94a6\u5b9a $k$ \u4e2a\u6781\u5927\u7684\u4f4d\u7f6e\u3002\n\n\u8bbe $f_i$ \u662f\u94a6\u5b9a $i$ \u4e2a\u6781\u5927\u4f4d\u7f6e\u7684\u6982\u7387\uff0c$g_i$ \u8868\u793a\u6709\u5e8f\u5730\u9009\u51fa $i$ \u4e2a\u6781\u5927\u4f4d\u7f6e\u7684\u65b9\u6848\u6570\u3002\u7531\u4e8e\u663e\u7136\u6781\u5927\u7684\u4f4d\u7f6e\u4e09\u7ef4\u5750\u6807\u90fd\u4e0d\u76f8\u540c\uff0c\u6240\u4ee5\uff1a\n\n$$\ng_i=\\prod_{j=0}^{i-1} (n-j)(m-j)(l-j)\n$$\n\n\u4e5f\u5c31\u662f\u76f4\u63a5\u7ed9\u6bcf\u4e2a\u4f4d\u7f6e\u9009\u4e09\u7ef4\u7684\u5750\u6807\u3002\n\n\u8bbe $c_i$ \u8868\u793a\u9009\u51fa $i$ \u4e2a\u6781\u5927\u4f4d\u7f6e\u4e4b\u540e\uff0c\u4e0e\u8fd9\u4e9b\u6781\u5927\u4f4d\u7f6e\u6709\u5173\u7cfb\u7684\u4f4d\u7f6e\u7684\u4e2a\u6570\u3002\u6709\u5173\u7cfb\u6307\u4e0e\u81f3\u5c11\u4e00\u4e2a\u6781\u5927\u4f4d\u7f6e\u7684\u81f3\u5c11\u4e00\u7ef4\u5750\u6807\u76f8\u540c\u3002\n\n\u8003\u8651\u62ff\u603b\u6570\u51cf\u53bb\u4e09\u7ef4\u90fd\u4e0d\u548c\u6781\u5927\u4f4d\u7f6e\u76f8\u540c\u7684\u4f4d\u7f6e\u4e2a\u6570\uff0c\u56e0\u6b64\uff1a\n\n$$\nc_i=nml-(n-i)(m-i)(l-i)\n$$\n\n\u8bbe $h_i$ \u8868\u793a\u6709\u5e8f\u5730\u9009\u51fa $i$ \u4e2a\u6781\u5927\u4f4d\u7f6e\u4e4b\u540e\uff0c\u6709\u591a\u5c11\u79cd\u65b9\u6848\u7ed9 $c_i$ \u4e2a\u4f4d\u7f6e\u5206\u914d\u6807\u53f7\uff0c\u4f7f\u5f97\u6070\u597d\u6781\u5927\u4f4d\u7f6e\u90fd\u662f\u6781\u5927\u7684\u3002\n\n\u8003\u8651\u4ece\u5927\u5230\u5c0f\u4f9d\u6b21\u586b\u5165\u6570\u5b57\u3002\u9996\u5148\uff0c\u663e\u7136\u6700\u5927\u7684\u6570\u5b57\u4e00\u5b9a\u8981\u586b\u5165\u94a6\u5b9a\u6700\u5927\u7684\u6781\u5927\u4f4d\u7f6e\uff0c\u7136\u540e\u4fbf\u53ea\u5269\u4e0b $i-1$ \u4e2a\u6781\u5927\u4f4d\u7f6e\u3002\u8fd9\u6307\u5f15\u6211\u4eec\u5c06\u95ee\u9898\u8f6c\u53d8\u4e3a $h_{i-1}$ \u7684\u5b50\u95ee\u9898\u3002\u5728 $h_{i-1}$ \u4e2d\uff0c\u5171 $c_{i-1}$ \u4e2a\u4f4d\u7f6e\u6709\u7528\uff0c$h_i$ \u4e2d\u6709 $c_i$ \u4e2a\uff0c\u4e14\u5df2\u7ecf\u586b\u5165\u4e86\u4e00\u4e2a\u6700\u5927\u503c\uff0c\u56e0\u6b64\u8fd8\u5269\u4e0b $(c_i-c_{i-1}-1)$ \u4e2a\u6570\u5b57\u53ef\u4ee5\u968f\u4fbf\u586b\u6570\u5b57\uff08\u56e0\u4e3a\u4ed6\u4eec\u548c $h_{i-1}$ \u7684\u5b50\u95ee\u9898\u4e5f\u6ca1\u6709\u8054\u7cfb\u4e86\uff09\uff0c\u56e0\u6b64\uff1a\n\n$$\nh_i=h_{i-1}\\times \\dfrac{(c_i-1)!}{c_{i-1}!}=\\prod_{j=1}^i \\dfrac{(c_j-1)!}{c_{j-1}!}\n$$\n\n\u5219 $f_i$ \u6ee1\u8db3\u5f0f\u5b50\uff1a\n\n$$\nf_i=\\dfrac{1}{(nml)!}\\binom{nml}{c_i}(nml-c_i)!\\times g_i\\times h_i\n$$\n\n\u8868\u793a\u5148\u9009\u51fa $c_i$ \u4e2a\u6807\u53f7\u7528\u4e8e\u6781\u5927\u4f4d\u7f6e\u548c\u4e0e\u6781\u5927\u4f4d\u7f6e\u76f8\u5173\u7684\u4f4d\u7f6e\uff0c\u5269\u4e0b\u4f4d\u7f6e\u4efb\u610f\u6392\u5217\uff1b\u518d\u9009\u51fa $i$ \u4e2a\u6781\u5927\u4f4d\u7f6e\uff0c\u5e76\u5728\u4e0a\u9762\u5408\u6cd5\u5730\u586b\u5165\u6570\u5b57\u3002\u56e0\u4e3a\u662f\u6982\u7387\u6240\u4ee5\u8981\u4e58 $\\dfrac{1}{(nml)!}$\n\n\u5316\u7b80\u4e00\u4e0b\uff0c\u53ef\u5f97\uff1a\n\n$$\nf_i=g_i\\prod_{j=1}^i \\dfrac{1}{c_j}\n$$\n\n\u5176\u4e2d $\\prod_{j=1}^i \\dfrac{1}{c_j}$ \u53ef\u4ee5\u901a\u8fc7\u7c7b\u4f3c\u9636\u4e58\u6c42\u9006\u5143\u7684\u65b9\u5f0f\u505a\u5230 $\\mathcal{O}(n)$ \u6c42\u89e3\u3002\u5219\u7b54\u6848\u4e3a\uff1a\n\n$$\n\\text{ans}_k=\\sum_{i=k}^{\\min(n,m,l)} \\binom{i}{k}(-1)^{i-k}f_i\n$$\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(T\\times n)$\u3002\n\n```cpp\n//Code By CXY07\n#include<bits/stdc++.h>\nusing namespace std;\n\n//#define FILE\n#define int long long\n#define file(FILENAME) freopen(FILENAME\".in\", \"r\", stdin), freopen(FILENAME\".out\", \"w\", stdout)\n#define randint(l, r) (rand() % ((r) - (l) + 1) + (l))\n#define LINE() cout << \"LINE = \" << __LINE__ << endl\n#define debug(x) cout << #x << \" = \" << x << endl\n#define abs(x) ((x) < 0 ? (-(x)) : (x))\n#define inv(x) qpow((x), mod - 2)\n#define lowbit(x) ((x) & (-(x)))\n#define ull unsigned long long\n#define pii pair<int, int>\n#define LL long long\n#define mp make_pair\n#define pb push_back\n#define scd second\n#define vec vector\n#define fst first\n#define endl '\\n'\n\nconst int MAXN = 5e6 + 10;\nconst int INF = 2e9;\nconst double eps = 1e-6;\nconst double PI = acos(-1);\n//const int mod = 1e9 + 7;\nconst int mod = 998244353;\n//const int G = 3;\n//const int base = 131;\n\nint T, n, m, l, k, V, lim, Ans;\nint fac[MAXN], ifac[MAXN];\nint g[MAXN], c[MAXN], ic[MAXN];\n\ntemplate<typename T> inline bool read(T &a) {\n\ta = 0; char c = getchar(); int f = 1;\n\twhile(c < '0' || c > '9') {if(c == '-') f = -1; c = getchar();}\n\twhile(c >= '0' && c <= '9') {a = a * 10 + (c ^ 48); c = getchar();}\n\treturn a *= f, true;\n}\n\ntemplate<typename A, typename ...B>\ninline bool read(A &x, B &...y) {return read(x) && read(y...);}\n\nint qpow(int x, int b) {\n\tint res = 1;\n\tfor(; b; b >>= 1, (x *= x) %= mod) if(b & 1) (res *= x) %= mod;\n\treturn res;\n}\n\nint C(int x, int y) {\n\tif(x < y) return 0;\n\treturn fac[x] * ifac[y] % mod * ifac[x - y] % mod;\n}\n\nvoid init() {\n\tfac[0] = ifac[0] = 1;\n\tfor(int i = 1; i < MAXN; ++i) fac[i] = fac[i - 1] * i % mod;\n\tifac[MAXN - 1] = inv(fac[MAXN - 1]);\n\tfor(int i = MAXN - 2; i; --i) ifac[i] = ifac[i + 1] * (i + 1) % mod;\n}\n\nvoid solve() {\n\tread(n), read(m), read(l), read(k); \n\tV = n * m % mod * l % mod, Ans = 0;\n\tlim = min(n, min(m, l)); g[0] = ic[0] = 1;\n\tfor(int i = 1; i <= lim; ++i) {\n\t\tg[i] = g[i - 1] * (n - i + 1) % mod * (m - i + 1) % mod * (l - i + 1) % mod;\n\t\tc[i] = (V - (n - i) * (m - i) % mod * (l - i) % mod + mod) % mod;\n\t\tic[i] = ic[i - 1] * c[i] % mod;\n\t}\n\tic[lim] = inv(ic[lim]);\n\tfor(int i = lim - 1; i; --i) ic[i] = ic[i + 1] * c[i + 1] % mod;\n\tfor(int i = k, opt = 1; i <= lim; ++i) {\n\t\t(Ans += C(i, k) * opt % mod * g[i] % mod * ic[i] % mod) %= mod;\n\t\topt = (mod - opt) % mod;\n\t}\n\tprintf(\"%lld\\n\", Ans);\n}\n\nsigned main () {\n#ifdef FILE\n\tfreopen(\".in\", \"r\", stdin);\n\tfreopen(\".out\", \"w\", stdout);\n#endif\n\tread(T); init();\n\twhile(T--) solve();\n\treturn 0;\n}\n```",
        "postTime": 1629530803,
        "uid": 53489,
        "name": "CXY07",
        "ccfLevel": 9,
        "title": "\u3010\u9898\u89e3\u3011[CTS2019]\u968f\u673a\u7acb\u65b9\u4f53"
    },
    {
        "content": "### \u524d\u7f6e\u77e5\u8bc6\n\u4e8c\u9879\u5f0f\u53cd\u6f14\uff0c\u6811\u7684\u62d3\u6251\u5e8f\n\n\u8fd9\u91cc\u63d0\u4e0b\u6811\u7684\u62d3\u6251\u5e8f\n\n\u8003\u8651\u8fd9\u6837\u4e00\u4e2a\u95ee\u9898\uff1a\u5bf9\u4e8e\u4e00\u9897 $n$ \u4e2a\u70b9\u7684\u6709\u6839\u6709\u6807\u53f7\u7684\u53f6\u5411\u6811\uff0c\u5b83\u6709\u591a\u5c11\u4e2a\u4e0d\u540c\u7684\u62d3\u6251\u5e8f\u5462\uff1f\n\n\u8bb0\u8282\u70b9 $i$ \u7684\u5b50\u6811\u5927\u5c0f\u4e3a $siz_i$\n\n\u8003\u8651\u4e00\u4e2a\u6392\u5217\u4e3a\u6811\u7684\u5408\u6cd5\u62d3\u6251\u5e8f\u5f53\u4e14\u4ec5\u5f53**\u5bf9\u4e8e\u6240\u6709 $i$\uff0c$i$ \u5b50\u6811\u4e2d\u7684\u6240\u6709\u6570\u51fa\u73b0\u4f4d\u7f6e\u5728 $i$ \u4e4b\u540e**\n\n\u5bf9\u4e8e\u5b50\u6811 $i$\uff0c\u6211\u4eec\u5c06\u6392\u5217\u4e2d\u5c5e\u4e8e\u5b50\u6811 $i$ \u7684 $siz_i$ \u4e2a\u4f4d\u7f6e\u62ff\u51fa\u6765\uff0c$i$ \u6709 $\\frac 1 {siz_i}$ \u7684\u6982\u7387\u5904\u4e8e\u7b2c\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u663e\u7136\u5b50\u6811\u4e4b\u95f4\u72ec\u7acb\n\n\u6545\u6709 $n!\\prod_{i=1}^n\\frac 1 {siz_i}$\n\n### $\\texttt{Solution}$\n\n\u4e0d\u59a8\u8bbe $n\\leq m\\leq l$\n\n\u56de\u5230\u6b64\u9898\uff0c\u6211\u4eec\u5bf9\u201c**\u6070\u597d**\u201d\u975e\u5e38\u654f\u611f\uff0c\u5c06\u5b83\u4e8c\u9879\u5f0f\u53cd\u6f14\u6389\n\n\u8bb0 $f_i$ \u8868\u793a\u6709\u6070\u597d $i$ \u4e2a\u6781\u5927\u70b9\u7684\u6982\u7387\uff0c$f_k$ \u5373\u4e3a\u6240\u6c42\n\n\u8bb0 $g_i$ \u8868\u793a\u6709\u81f3\u5c11 $i$ \u4e2a\u6781\u5927\u70b9\u7684\u6982\u7387\n\n$g_k=\\sum_{i=k}^n\\tbinom i kf_i\\iff f_k=\\sum_{i=k}^n(-1)^{i-k}\\tbinom i kg_i$\n\n\u8003\u8651\u8ba1\u7b97 $g_i$\n\n\u6211\u4eec\u9996\u5148**\u6709\u987a\u5e8f\u7684**\u9009\u51fa $i$ \u4e2a\u6781\u5927\u70b9\uff0c\u663e\u7136\uff0c\u8fd9\u4e9b\u70b9\u7684\u4e09\u7ef4\u5750\u6807\u5206\u522b\u4e92\u4e0d\u76f8\u540c\n\n\u5373 $n^{\\underline i}m^{\\underline i}l^{\\underline i}$\n\n\u4e0d\u59a8\u8bbe\u9009\u51fa\u6765\u7684\u987a\u5e8f\u662f\u5176\u586b\u6570\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\n\n\u4ece\u5c0f\u5230\u5927\u8003\u8651\u6781\u5927\u70b9\u5bf9\u5176\u5b83\u70b9\u7684\u9650\u5236\uff0c\u6211\u4eec\u53d1\u73b0\u5176\u5f62\u6210\u4e86\u4e00\u4e2a\u6811\u5f62\u7ed3\u6784\n\n\u8fd9\u91cc\u7ed9\u51fa\u4e00\u4e2a\u4e8c\u7ef4\u60c5\u5f62\u7684\u793a\u610f\u56fe\n\n![](https://img.imgdb.cn/item/60387ed75f4313ce25ec5ad5.png)\n\n\u9ed1\u8272\u7f16\u53f7\u4ee3\u8868\u5173\u952e\u70b9\u7684\u5927\u5c0f\u987a\u5e8f\n\n1\u53f7\u70b9\u9700\u5927\u4e8e\u9ed1\u8272\u5341\u5b57\u67b6\u4e0a\u7684\u5176\u4ed6\u70b9\uff0c\u6211\u4eec\u5c06\u8fd9\u4e9b\u70b9\u7684\u7236\u4eb2\u5b9a\u4e3a1\u53f7\u70b9\n\n2\u53f7\u70b9\u9700\u5927\u4e8e\u84dd\u8272\u5341\u5b57\u67b6\u7684\u90e8\u5206\u4e0e1\u53f7\u70b9\uff0c\u6211\u4eec\u628a1\u53f7\u70b9\u7684\u7236\u4eb2\u5b9a\u4e3a2\u53f7\u70b9\uff0c\u628a\u84dd\u8272\u5341\u5b57\u67b6\u4e0a\u7684\u975e\u9ed1\u8272\u5341\u5b57\u67b6\u90e8\u5206\u7684\u7236\u4eb2\u5b9a\u4e3a2\u53f7\u70b9\n\n\u8fd9\u68f5\u6811\u91cc\u4e00\u5171\u6709 $(n-i)(m-i)(l-i)$ \u4e2a\u70b9\uff0c\u5bb9\u6613\u53d1\u73b0\u7ed9\u8fd9\u4e9b\u70b9\u8d4b\u6743\u5c31\u662f\u6811\u7684\u62d3\u6251\u5e8f\u95ee\u9898\n\n\u6211\u4eec\u53d1\u73b0\u6811\u4e2d\u5b50\u6811\u5927\u5c0f\u53ef\u80fd\u8d85\u8fc72\u7684\u53ea\u6709 $i$ \u4e2a\u6781\u5927\u70b9\n\n\u65b9\u6848\u6570\u4e3a $(nml)!\\prod_{j=1}^i\\frac 1 {(n-j)(m-j)(l-j)}$\n\n\u6982\u7387\u53bb\u6389 $(nml)!$ \u5373\u53ef\n\n\u6211\u4eec\u5f97\u5230\u4e86 $g_i=n^{\\underline i}m^{\\underline i}l^{\\underline i}\\prod_{j=1}^i\\frac 1 {(n-j)(m-j)(l-j)}$\n\n\u5957\u56de\u4e8c\u9879\u5f0f\u53cd\u6f14\u7684\u5f0f\u5b50\u53ef\u4ee5\u5728 $O(n)$ \u7684\u65f6\u95f4\u5185\u89e3\u51b3\u6b64\u95ee\u9898\n\n\u6ce8\u610f\u9700\u8981\u5728\u7ebf\u6027\u65f6\u95f4\u5185\u8dd1\u51fa $\\prod$ \u91cc\u9762\u7684\u9006\u5143\n\n[\u4ee3\u7801](https://www.luogu.com.cn/paste/2nanj1zg)",
        "postTime": 1614315929,
        "uid": 98527,
        "name": "juju527",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5400 \u3010[CTS2019]\u968f\u673a\u7acb\u65b9\u4f53\u3011"
    },
    {
        "content": "\u8003\u8651\u5bb9\u65a5\uff0c\u5c06\u6070\u597d\u5b58\u5728$k$\u4e2a\u6781\u5927\u503c\u8f6c\u5316\u4e3a\u5b58\u5728\u5927\u4e8e\u7b49\u4e8e$k$\u4e2a\u6781\u5927\u503c\uff0c\u5c06\u8fd9\u6837\u7684\u65b9\u6848\u6570\u8bb0\u4e3a$f_k$\u3002\n\n\u90a3\u4e48\u8003\u8651$f_k$\u7684\u6784\u6210\uff0c\u9996\u5148\u94a6\u5b9a$k$\u4e2a\u6781\u5927\u7684\u6570\uff0c\u7136\u540e\u8fd9\u4e9b\u6570\u4f1a\u9650\u5236\u6240\u5728\u7684$k$\u4e2a$x,y,z$\u5750\u6807\u4e0a\u7684\u6240\u6709\u70b9\u3002\n\n\u8bbe\u88ab\u9650\u5236\u4e86\u7684\u4f4d\u7f6e\u6709$a_k$\u4e2a\uff0c\u88ab\u9650\u5236\u4e86\u7684\u4f4d\u7f6e\u7684\u586b\u7684\u65b9\u6848\u6570\u4e3a$b_k$\uff0c$N=n\\times m\\times l$\uff0c\u90a3\u4e48\u6709\uff1a\n\n$$f_k=\\binom{m}{k}\\binom{n}{k}\\binom{l}{k}\\binom{N}{a_k}(N-a_k)!b_k$$\n\n\u6ce8\u610f\u5230$b_k$\u7684\u5b9a\u4e49\u5b9e\u9645\u4e0a\u662f\u53ea\u8003\u8651\u88ab\u9650\u5236\u4f4d\u7f6e\u7684\u76f8\u5bf9\u5927\u5c0f\u5173\u7cfb\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5f0f\u5b50\u7684\u610f\u4e49\u5c31\u5f88\u663e\u7136\u4e86\uff1a\u9009\u62e9$k$\u4e2a\u70b9\u51fa\u6765\uff0c\u5e76\u5c06\u88ab\u8fd9$k$\u4e2a\u70b9\u9650\u5236\u7684\u4f4d\u7f6e\u4e5f\u9009\u51fa\u6765\uff0c\u6ca1\u88ab\u9650\u5236\u7684\u4f4d\u7f6e\u968f\u610f\u6392\u5217\uff0c\u5728\u4e58\u4e0a\u88ab\u9650\u5236\u4e86\u7684\u4f4d\u7f6e\u7684\u65b9\u6848\u6570\u3002\n\n$a_k$\u5f88\u597d\u8ba1\u7b97\uff0c\u56e0\u4e3a\u6ca1\u6709\u88ab\u9650\u5236\u7684\u4f4d\u7f6e\u5f88\u663e\u7136\u662f$(n-k)(m-k)(l-k)$\uff0c\u6240\u4ee5$a_k=N-(n-k)(m-k)(l-k)$\u3002\n\n\u90a3\u4e48\u53ea\u9700\u8981\u8ba1\u7b97$b_k$\u4e86\u3002\u8003\u8651\u5230\u5148\u586b\u7684\u6570\u4f1a\u5f71\u54cd\u5230\u540e\u9762\u586b\u4e0a\u7684\u6570\uff0c\u6240\u4ee5\u53ef\u4ee5\u6309\u7167\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u586b\u5165$k$\u4e2a\u6781\u5927\u7684\u6570\u3002\n\n\u56e0\u4e3a\u88ab\u5148\u586b\u7684\u6570\u9650\u5236\u7684\u6240\u6709\u7684\u70b9\u90fd\u5c0f\u4e8e\u5df2\u7ecf\u586b\u5165\u7684\u6781\u5927\u6570\uff0c\u800c\u8fd9\u4e9b\u6781\u5927\u6570\u90fd\u5c0f\u4e8e\u5f53\u524d\u586b\u5165\u7684\u6781\u5927\u6570\uff0c\u6240\u4ee5\u5148\u586b\u7684\u6570\u4e0d\u4f1a\u5bf9\u5269\u4e0b\u6781\u5927\u6570\u7684\u586b\u5165\u9020\u6210\u5f71\u54cd\u3002\n\n\u90a3\u4e48\u5f53\u524d\u586b\u5165\u7684\u6781\u5927\u7684\u6570\u4e00\u5b9a\u662f\u5269\u4e0b\u7684\u6570\u4e2d\u6700\u5927\u7684\u4e00\u4e2a\uff0c\u65b9\u6848\u552f\u4e00\u3002\u9700\u8981\u8003\u8651\u7684\u5b9e\u9645\u4e0a\u662f\u88ab\u5f53\u524d\u7684\u6781\u5927\u6570\u9650\u5236\u7684\u6240\u6709\u4f4d\u7f6e\uff0c\u8fd9\u4e9b\u4f4d\u7f6e\u53ea\u9700\u8981\u6ee1\u8db3\u5c0f\u4e8e\u5f53\u524d\u7684\u6781\u5927\u7684\u6570\uff0c\u4e0e\u4e4b\u524d\u586b\u5165\u7684\u4f4d\u7f6e\u6ca1\u6709\u5173\u7cfb\u3002\n\n\u56e0\u4e3a$b_k$\u53ea\u8003\u8651\u6570\u7684\u76f8\u5bf9\u5927\u5c0f\u5173\u7cfb\uff0c\u6240\u4ee5\u53ef\u4ee5\u770b\u505a\u628a\u8fd9\u4e9b\u8981\u88ab\u586b\u5165\u7684\u6570\u63d2\u5165\u5df2\u7ecf\u63d2\u5165\u7684\u6570\u7684\u6709\u5e8f\u8868\u4e2d\u3002\n\n\u5f88\u660e\u663e\u5df2\u7ecf\u586b\u5165\u4e86$a_{k-1}$\u4e2a\u6570\uff0c\u6b63\u5728\u586b\u5165\u7684\u6570\u6709$a_k-a_{k-1}-1$\u4e2a\uff08\u4e0d\u8ba1\u73b0\u5728\u586b\u5165\u7684\u6781\u5927\u6570\uff09\u3002\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u63cf\u8ff0\u4e86\uff1a\n\n$$b_k=(k!)^3b_{k-1}(a_{k-1}+1)^{\\underline{a_k-a_{k-1}-1}}$$\n\n\u8fd9\u91cc\u4e58\u4e0a$(k!)^3$\u662f\u56e0\u4e3a\u6700\u540e\u9700\u8981\u5728\u4e09\u4e2a\u5750\u6807\u4e0a\u8fd8\u539f\u94a6\u5b9a\u7684\u5927\u5c0f\u5173\u7cfb\u3002\n\n\u5373\uff1a\n\n$$b_k=(k!)^3b_{k-1}\\frac{(a_k-1)!}{a_{k-1}!}=a_k!\\prod_{i=1}^{k}\\frac{(a_i-1)!}{a_i!}=\\frac{a_k!}{\\prod_{i=1}^{k}a_i}$$\n\n\u4ee3\u5165\u539f\u5f0f\uff0c\u987a\u4fbf\u6574\u7406\u4e00\u4e0b\uff1a\n\n$$f_k=\\frac{n!}{k!(n-k)!}\\cdot\\frac{m!}{k!(m-k)!}\\cdot\\frac{l!}{k!(l-k)!}\\cdot\\frac{N!}{a_k!(N-a_k)!}(N-a_k)!b_k$$\n\n$$=\\frac{n!m!l!}{(n-k)!(m-k)!(l-k)!}\\cdot\\frac{N!}{\\prod_{i=1}^{k}a_i}$$\n\n\u5404\u4e2a\u90e8\u5206\u597d\u50cf\u90fd\u80fd\u7b97\uff0c\u9664\u4e86$N!$\u8fd9\u4e2a\u4e1c\u897f\u4f1a\u5927\u5f97\u8d85\u8fc7\u6a21\u6570\u3002\u4f46\u662f\u56e0\u4e3a\u6700\u540e\u6c42\u7684\u662f\u6982\u7387\uff0c\u6700\u540e\u4f1a\u9664\u4ee5$N!$\uff0c\u8fd9\u4e00\u9879\u6839\u672c\u4e0d\u7528\u8003\u8651\u3002\n\n\u90a3\u4e48$f_k$\u5c31\u5168\u90e8\u6c42\u51fa\u6765\u4e86\u3002\n\n\u56e0\u4e3a\u6c42\u7684\u662f\u6070\u597d\u6709$k$\u4e2a\u6781\u5927\u503c\uff08\u8bbe\u4e3a$g_k$\uff09\uff0c$f_k$\u8868\u793a\u7684\u662f\u81f3\u5c11\u6709$k$\u4e2a\u6781\u5927\u503c\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u4e8c\u9879\u5f0f\u53cd\u6f14\uff1a\n\n$$f_k=\\sum_{i=k}^{\\infty}\\binom{i}{k}g_i\\Longleftrightarrow g_k=\\sum_{i=k}^{\\infty}(-1)^{k-i}\\binom{i}{k}f_i$$\n\n\u90a3\u4e48\u76f4\u63a5\u8ba1\u7b97\u5373\u53ef\uff0c\u6ce8\u610f\u8981\u4f7f\u7528\u7ebf\u6027\u5904\u7406\u9006\u5143\u7684\u65b9\u6cd5\uff0c\u590d\u6742\u5ea6\u4e3a$O(T\\min(n,m,l))$\u3002\n\n```cpp\n#include<cstdio>\n#include<cstdlib>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\n#define rnt re int\n#define re register\n#define I inline int\n#define V inline void\n#define ll long long int\n#define isnum(ch) ('0'<=ch&&ch<='9')\n#define FOR(i,a,b) for(rnt i=a;i<=b;i++)\n#define ROF(i,a,b) for(rnt i=a;i>=b;i--)\n#define gc (_op==_ed&&(_ed=(_op=_buf)+fread(_buf,1,100000,stdin),_op==_ed)?EOF:*_op++)\nchar _buf[100000],*_op(_buf),*_ed(_buf);\nI getint(){\n    rnt _s=0;re char _ch=gc;\n    while(!isnum(_ch))_ch=gc;\n    while(isnum(_ch))_s=_s*10+_ch-48,_ch=gc;\n    return _s;\n}\nconst int N=5e6+1,mod=998244353;\nI Pow(ll t,rnt x){\n\tll s=1;\n\twhile(x){\n\t\tif(x&1)s=s*t%mod;\n\t\tt=t*t%mod,x>>=1;\n\t}\n\treturn s;\n}\nI min(const int&x,const int&y){return x<y?x:y;}\nint n,m,l,k,lim,T,ans;\nint fac[N],fac_inv[N];\nint a[N],sa[N],inv[N],f[N];\nV input(){n=getint(),m=getint(),l=getint(),k=getint(),lim=min(n,min(m,l));}\nV init(){\n\tsa[0]=inv[0]=1,ans=0;\n\tconst int sum=1ll*n*m%mod*l%mod+mod;\n\tFOR(i,1,lim)a[i]=(sum-1ll*(n-i)*(m-i)%mod*(l-i)%mod)%mod;\n\tFOR(i,1,lim)sa[i]=1ll*sa[i-1]*a[i]%mod;\n\tinv[lim]=Pow(sa[lim],mod-2);\n\tROF(i,lim-1,1)inv[i]=1ll*inv[i+1]*a[i+1]%mod;\n}\nI C(rnt x,rnt y){return 1ll*fac[x]*fac_inv[y]%mod*fac_inv[x-y]%mod;}\nV work(){\n\tconst int sum=1ll*fac[n]*fac[m]%mod*fac[l]%mod;\n\tFOR(i,1,lim)\n\t\tf[i]=1ll*sum*inv[i]%mod*fac_inv[n-i]%mod*fac_inv[m-i]%mod*fac_inv[l-i]%mod;\n\tFOR(i,k,lim)\n\t\tif((i-k)&1)ans=(mod+ans-1ll*C(i,k)*f[i]%mod)%mod;\n\t\telse ans=(1ll*C(i,k)*f[i]%mod+ans)%mod;\n\tcout<<ans<<'\\n';\n}\nint main(){\n\tn=N-1,fac[0]=fac_inv[0]=1;\n\tFOR(i,1,n)fac[i]=1ll*fac[i-1]*i%mod;\n\tfac_inv[n]=Pow(fac[n],mod-2);\n\tROF(i,n-1,1)fac_inv[i]=1ll*fac_inv[i+1]*(i+1)%mod;\n\tT=getint();\n\twhile(T--){\n\t\tinput();\n\t\tinit();\n\t\twork();\n\t}\n\treturn 0;\n}\n\n```\n\n\n\n\n\n\n\n",
        "postTime": 1565404418,
        "uid": 109236,
        "name": "Fuyuki",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5400 [CTS2019]\u968f\u673a\u7acb\u65b9\u4f53"
    },
    {
        "content": "### [\u539f\u9898\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P5400)\n\n### [\u66f4\u597d\u7684\u9605\u8bfb(\u672c\u6587\u6709\u4e9b\u63a8\u5bfc\u8fc7\u7a0b\u7684markdown\u6302\u4e86\u5c31\u6ca1\u5199\u4e0a\u53bb)](https://www.cnblogs.com/yzhang-rp-inf/p/10952096.html)\n\n#### ~~\u6bd2\u7624\u8ba1\u6570\u9898~~\n\n#### \u6211\u4eec\u8bbe$dp_i$\u8868\u793a\u81f3\u5c11\u6709$i$\u4e2a\u6781\u5927\u6570\u5b57\u7684\u6982\u7387\uff0c$ans_i$\u8868\u793a\u6070\u597d\u6709$i$\u4e2a\u6781\u5927\u6570\u7684\u6982\u7387\uff0c$mi=Min(n,m,l)$\n\n#### \u6613\u77e5\uff1a\n\n$$dp_i=\\sum_{j=i}^{mi} ans_j \\tbinom{j}{i}$$\n\n#### \u7531\u4e8c\u9879\u5f0f\u53cd\u6f14\u5f97\uff1a\n\n$$ans_i=\\sum_{j=i}^{mi} dp_j \\tbinom{j}{i} (-1)^{j-i}$$\n\n#### \u6211\u5c31\u4e0d\u5728\u6b64\u8bc1\u660e~~\uff08\u5b9e\u9645\u662f\u6211\u4e0d\u4f1a\u8bc1\u660e\uff09~~\n\n#### \u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5feb\u901f\u6c42\u51fadp\u6570\u7ec4\uff0c\u5c31\u73c2\u4ee5\u5feb\u901f\u5f97\u5230\u7b54\u6848\n\n#### \u6211\u4eec\u9700\u8981\u5229\u7528\u4ee5\u4e0b\u7ed3\u8bba\uff1a\n\n#### 1.\u6211\u4eec\u4f1a\u53d1\u73b0\u5f53$(x_0,y_0,z_0)$\u662f\u6781\u5927\u503c\u70b9\u65f6\uff0c$x=x_0,y=y_0,z=z_0$\u4e09\u4e2a\u5e73\u9762\u4e0a\u4e0d\u73c2\u80fd\u518d\u6709\u6781\u5927\u503c\u70b9\u4e14\u90fd\u586b\u4e0a\u5c0f\u4e8e$(x_0,y_0,z_0)$\u7684\u503c\uff0c\u5269\u4e0b\u7684\u5c31\u50cf\u662f\u4e00\u4e2a$(n-1)(m-1)(l-1)$\u7684\u5b50\u95ee\u9898\n\n#### 2.\u6211\u4eec\u6240\u586b\u7684\u6570\u503c\u662f\u79bb\u6563\u5316\u540e\u76f8\u5bf9\u7684\u6570\u503c\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u8981\u9009\u51fa\u7684\u6570\u79bb\u6563\u5316\u540e\u6ee1\u8db3\u67d0\u5173\u7cfb\uff0c\u5c31\u662f\u4e00\u79cd\u5408\u6cd5\u7684\u72b6\u6001\n\n#### \u8bbe$g_i$\u8868\u793a\u9009\u5b9a\u4e86$i$\u4e2a\u6781\u5927\u503c\u70b9\u540e\u5f71\u54cd\u5230\u7684\u5e73\u9762\u7684\u4ea4\u96c6\u7684\u65b9\u5757\u6570\uff0c\u7531\u7ed3\u8bba2\u53ef\u77e5\u8fd9\u65f6\u5019\u8d21\u732e\u8981\u4e58\u4e0a$\\tbinom{N}{g_i}(N=nml)$\uff08\u4e0b\u6587$N$\u4e0e\u6b64\u65f6\u7684$N$\u540c\u4e49\uff09\n\n#### \u6613\u77e5$g_i=N-(n-i)(m-i)(l-i)$\n\n#### \u8bbe$f_i$\u8868\u793a\u9009\u5b9a$i$\u4e2a\u6781\u5927\u503c\u70b9\u7684\u65b9\u6848\u6570\uff0c\u6613\u77e5\uff1a\n\n$$f_i=\\prod_{j=0}^{i-1}(n-j)(m-j)(l-j)$$\n\n#### \u8bbe$h_i$\u8868\u793a\u586b\u5145\u9009\u5b9a\u4e86$i$\u4e2a\u6781\u5927\u503c\u70b9\u540e\u5f71\u54cd\u5230\u7684\u5e73\u9762\u7684\u4ea4\u96c6\u7684\u65b9\u6848\u6570\uff0c\u6613\u77e5\uff1a\n\n$$h_i = \\prod_{j=0}^{i-1} \\frac{(g_{j+1}-1)!}{g_j!} $$\n\n#### \u6211\u4eec\u8fd9\u662f\u5c31\u73c2\u4ee5\u6c42\u51fa$dp_i \\times N!$\u4e86\uff0c\u5373\u81f3\u5c11\u6709$i$\u4e2a\u6781\u5927\u6570\u5b57\u7684\u79cd\u7c7b\u6570\uff0c\u90a3\u4e48$dp_i$\u4e5f\u5c31\u73c2\u4ee5\u6c42\u51fa\n\n$$dp_i*N! = N! f_i \\prod_{j=1}^i\\frac{1}{g_j}$$\n\n$$dp_i=f_i \\prod_{j=1}^i\\frac{1}{g_j}$$\n\n#### \u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u5feb\u901f\u6c42\u51fa\u7b54\u6848\u4e86\uff0c\u590d\u6742\u5ea6\u4e3a$O(T Min(n_i,m_i,l_i))$\n\n```cpp\n#include <bits/stdc++.h>\n#define N 5000005\n#define mod 998244353 \n#define getchar nc\nusing namespace std;\ninline char nc(){\n    static char buf[100000],*p1=buf,*p2=buf;\n    return p1==p2&&(p2=(p1=buf)+fread(buf,1,100000,stdin),p1==p2)?EOF:*p1++;\n}\ninline int read()\n{\n    register int x=0,f=1;register char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9')x=(x<<3)+(x<<1)+ch-'0',ch=getchar();\n    return x*f;\n}\ninline void write(register int x)\n{\n    if(!x)putchar('0');if(x<0)x=-x,putchar('-');\n    static int sta[20];register int tot=0;\n    while(x)sta[tot++]=x%10,x/=10;\n    while(tot)putchar(sta[--tot]+48);\n}\ninline int Min(register int a,register int b)\n{\n    return a<b?a:b;\n}\ninline int fastpow(register int a,register int b)\n{\n    int res=1;\n    while(b)\n    {\n        if(b&1)\n            res=1ll*res*a%mod;\n        a=1ll*a*a%mod;\n        b>>=1;\n    }\n    return res;\n}\nint T,n,m,l,k,mi,ans;\nint fac[N],invf[N];\nint f[N],g[N],invg[N],dp[N];\ninline int C(register int m,register int n)\n{\n    return 1ll*fac[m]*invf[n]%mod*invf[m-n]%mod;\n}\nint main()\n{\n    fac[0]=1;\n    for(register int i=1;i<N;++i)\n        fac[i]=1ll*fac[i-1]*i%mod;\n    invf[N-1]=fastpow(fac[N-1],mod-2);\n    for(register int i=N-1;i;--i)\n        invf[i-1]=1ll*invf[i]*i%mod;\n    T=read();\n    while(T--)\n    {\n    \tn=read(),m=read(),l=read(),k=read();\n    \tmi=Min(n,Min(m,l));\n    \tif(k>mi)\n    \t{\n    \t\tputs(\"0\");\n    \t\tcontinue;\n        }\n        f[0]=1;\n        for(register int i=0;i<mi;++i)\n        {\n            g[i]=1ll*(n-i)*(m-i)%mod*(l-i)%mod;\n            f[i+1]=1ll*f[i]*g[i]%mod;\n        }\n        int fg=1,tot=g[0];\n        g[mi]=0;\n        for(register int i=1;i<=mi;++i)\n        {\n            g[i]=(0ll+tot+mod-g[i])%mod;\n            fg=1ll*fg*g[i]%mod;\n        }\n        invg[mi]=fastpow(fg,mod-2);\n        for(register int i=mi;i;--i)\n            invg[i-1]=1ll*invg[i]*g[i]%mod;\n        for(register int i=1;i<=mi;++i)\n            dp[i]=1ll*f[i]*invg[i]%mod;\n        ans=0;\n        for(register int i=k;i<=mi;++i)\n            if((i-k)&1)\n                ans=(0ll+ans+mod-1ll*C(i,k)*dp[i]%mod)%mod;\n            else\n                ans=(0ll+ans+1ll*C(i,k)*dp[i]%mod)%mod;\n        write(ans),puts(\"\");\n    }\n    return 0;\n}\n```",
        "postTime": 1559396255,
        "uid": 37881,
        "name": "yzhang",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5400 \u3010[CTS2019]\u968f\u673a\u7acb\u65b9\u4f53\u3011"
    },
    {
        "content": " [\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P5400)\n\n\u4e0d\u662f\u5f88\u96be\uff0c\u6bd4\u8f83\u8003\u9a8c\u719f\u7ec3\u7a0b\u5ea6\uff08\u53ef\u60dc\u8fd8\u662f\u6ca1\u6cd5\u81ea\u5df1\u505a\u51fa\u6765 /kk\uff09\u3002\n\n\u9996\u5148\uff0c\u8bbe $N=nml$\uff0c\u5e76\u8ba4\u4e3a $n\\leqslant m, l$\u3002\n\n\u53d1\u73b0\u76f4\u63a5\u7b97\u6bd4\u8f83\u96be\u7b97\uff0c\u53c8\u770b\u5230\u9898\u9762\u4e2d\u201c\u6070\u597d\u201d\u4e24\u5b57\uff0c\u4e0d\u96be\u60f3\u5230\u4e8c\u9879\u5f0f\u53cd\u6f14\u3002\n\n\u6211\u4eec\u8bbe $f_i$ \u4e3a\u94a6\u5b9a\u4e86 $i$ \u4e2a\u6781\u5927\u7684\u683c\u5b50\uff0c\u5269\u4e0b\u968f\u4fbf\u586b\u7684\u65b9\u6848\u6570\u3002\u5219\u6709\n$$\nans=\\frac{\\sum\\limits_{i=k}^n\\binom{i}{k}(-1)^{i-k}f(i)}{N!}\n$$\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5bf9 $i=k\\rightarrow n$ \u6c42\u51fa $f_i$\u3002\n\n\u8bbe $g_i$ \u4e3a\u9009\u51fa $i$ \u4e2a\u6781\u5927\u70b9\u540e\u53d7\u5230\u5f71\u54cd\uff08\u4e5f\u5c31\u662f\u4e0e\u81f3\u5c11\u4e00\u4e2a\u6781\u5927\u70b9\u7684\u67d0\u4e00\u7ef4\u5750\u6807\u76f8\u7b49\uff09\u7684\u6240\u6709\u70b9\u7684\u6570\u91cf\uff0c$b_i$ \u4e3a\u9009\u51fa $i$ \u4e2a\u6781\u5927\u70b9\u7684\u65b9\u6848\u6570\uff0c$h_i$ \u4e3a\u7ed9\u5b9a $g_i$ \u4e2a\u6570\uff0c\u5f80 $g_i$ \u4e2a\u70b9\u91cc\u586b\u4e14\u6ee1\u8db3\u9898\u610f\u7684\u65b9\u6848\u6570\u3002\n\n\u90a3\u4e48\u6709\n$$\nf_i=\\binom{N}{g_i}(N-g_i)!b_ih_i\n$$\n\u5373\u6211\u4eec\u5148\u9009\u51fa $g_i$ \u4e2a\u8981\u586b\u7684\u6570\uff0c\u7136\u540e\u5269\u4e0b\u7684\u6570\u968f\u4fbf\u586b\uff0c\u7136\u540e\u6211\u4eec\u94a6\u5b9a\u683c\u5b50\u7684\u65b9\u6848\u6570\u4e3a $b_i$\uff0c\u5f80\u683c\u5b50\u91cc\u586b\u6570\u7684\u65b9\u6848\u6570\u4e3a $h_i$\u3002\n\n\u5bf9\u4e8e $g$\uff0c\u6709 $g_i=N-(n-i)(m-i)(l-i)$\uff0c\u5373\u7528\u6240\u6709\u6570\u51cf\u53bb\u4e09\u7ef4\u5750\u6807\u90fd\u4e0d\u4e0e\u4efb\u4f55\u4e00\u4e2a\u70b9\u76f8\u540c\u7684\u70b9\u7684\u4e2a\u6570\u3002\n\n\u663e\u7136 $b_i=\\frac{\\prod\\limits_{j=0}^{i-1}(n-j)(m-j)(l-j)}{i!}$\uff0c\u4e5f\u5c31\u662f\u4f60\u9009\u7b2c $j$ \u4e2a\u6570\u65f6\u5019\u7684\u4e09\u7ef4\u5750\u6807\u7684\u65b9\u6848\u6570\uff0c\u56e0\u4e3a\u6781\u5927\u70b9\u662f\u65e0\u7f16\u53f7\u7684\u6240\u4ee5\u8981\u9664\u4ee5 $i!$\uff0c\u6216\u8005\u53ef\u4ee5\u5199\u6210 $\\binom{n}{i}\\binom{m}{i}\\binom{l}{i}(i!)^2$\u3002\n\n\u5bf9\u4e8e $h$\uff0c\u6211\u4eec\u8003\u8651\u6309\u7167\u6781\u5927\u70b9\u4e0a\u7684\u6570\u7684\u5927\u5c0f\u4ece\u5c0f\u5230\u5927\u6dfb\u52a0\u6781\u5927\u70b9\u548c\u4e0e\u5176\u5173\u8054\u7684\u70b9\u3002\u5373\u6211\u4eec\u8003\u8651\u4ece $h_{i-1}$ \u9012\u63a8\u51fa $h_i$\u3002\u9996\u5148\u7531\u4e8e\u6211\u4eec\u5f3a\u5236\u4ece\u5c0f\u5230\u5927\u586b\u6781\u5927\u70b9\uff0c\u6240\u4ee5\u5f53\u524d\u586b\u7684\u6781\u5927\u70b9\u4e0a\u7684\u6570\u4e00\u5b9a\u6bd4\u4efb\u4f55\u5176\u5b83\u70b9\u7684\u6570\u90fd\u5927\u7684\uff0c\u7136\u540e\u6211\u4eec\u8003\u8651\u65b0\u5173\u8054\u7684\u70b9\u7684\u586b\u6cd5\uff08\u6ce8\u610f\u6709\u7684\u70b9\u53ef\u80fd\u4e0e\u4e0d\u6b62\u4e00\u4e2a\u6781\u5927\u70b9\u67d0\u4e00\u7ef4\u5750\u6807\u76f8\u540c\uff09\uff0c\u5177\u4f53\u5730\uff0c\u5982\u679c\u6211\u4eec\u77e5\u9053\u4e00\u5f00\u59cb\u6709 $s$ \u4e2a\u70b9\uff0c\u8fd9\u6b21\u65b0\u589e\u7684\u6709\u5173\u8054\u7684\u70b9\uff08\u4e0d\u5305\u62ec\u6781\u5927\u70b9\uff09\u7684\u4e2a\u6570\u4e3a $r$\uff0c\u5219\u6709\n$$\nh_i=i(s+1)^{\\overline{r}}h_{i-1}\n$$\n\u5176\u4e2d $(s+1)^{\\overline{r}}$ \u8868\u793a $s+1$ \u7684 $r$ \u6b21\u4e0a\u5347\u5e42\uff0c\u5373 $(s+1)(s+2)\\dots (s+r)$\n\n\u56e0\u4e3a\u6211\u4eec\u8fd9\u91cc\u8981\u586b\u7684\u6240\u6709\u70b9\u548c\u4e4b\u524d\u7684\u70b9\u4ee5\u53ca\u8fd9\u6b21\u65b0\u589e\u7684\u70b9\uff08\u9664\u4e86\u6781\u5927\u70b9\uff09\u4e4b\u95f4\u90fd\u6ca1\u6709\u5927\u5c0f\u8981\u6c42\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4efb\u610f\u63d2\u7a7a\uff0c\u8fd9\u6837\u63d2\u5165\u7b2c\u4e00\u4e2a\u70b9\u6709 $s+1$ \u4e2a\u7a7a\uff0c\u7b2c\u4e8c\u4e2a\u6709 $s+2$ \u4e2a\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002\u7136\u540e\u8981\u4e58\u4e00\u4e2a $i$ \u662f\u56e0\u4e3a\u6211\u4eec\u8fd9\u91cc\u56fa\u5b9a\u4e86\u5927\u5c0f\u987a\u5e8f\uff0c\u9700\u8981\u8865\u4e0a\u3002\n\n\u6211\u4eec\u6ce8\u610f\u5230\uff0c\u5176\u5b9e $s=g_{i-1}$\uff0c$r=g_i-g_{i-1}-1$\uff0c\u6ce8\u610f\u6709\u4e2a $-1$ \u662f\u56e0\u4e3a\u8981\u53bb\u6389\u6781\u5927\u70b9\u3002\u8fd9\u6837\u5c31\u6709\n$$\nh_i=i\\frac{(g_i-1)!}{g_{i-1}!}h_{i-1}\n$$\n\u7136\u540e\u6211\u4eec\u4e00\u8def\u63a8\u4e0b\u53bb\uff0c\u53ef\u4ee5\u5f97\u5230 $h$ \u7684\u901a\u9879\u516c\u5f0f\n$$\nh_i=i!(g_i-1)!\\prod\\limits_{j=1}^{i-1}\\frac{1}{g_j}\n$$\n\u628a $b,h$ \u5e26\u5165\uff0c\u5219\u6709\n$$\nf_i=\\frac{N!}{g_i!(N-g_i)!}(N-g_i)!\\frac{\\prod\\limits_{j=0}^{i-1}(n-j)(m-j)(l-j)}{i!}i!(g_i-1)!\\prod\\limits_{j=1}^{i-1}\\frac{1}{g_j}\n$$\n\u4e3a\u4e86\u65b9\u4fbf\u6211\u4eec\u5728\u8fd9\u91cc\u5c31\u628a $N!$ \u9664\u6389\uff0c\u5e76\u4e14\u5316\u7b80\u53ef\u5f97\n$$\nf_i=\\prod_{j=0}^{i-1}(n-j)(m-j)(l-j)\\prod_{j=1}^{i}\\frac{1}{g_j}\n$$\n\u8fd9\u4e2a\u5f0f\u5b50\u5f88\u597d\u4ece $f_{i-1}$ \u9012\u63a8\u51fa\u6765\u3002\u7136\u540e\u5982\u679c\u5bf9\u4e8e\u6bcf\u4e2a $i$ \u90fd\u7528\u5feb\u901f\u5e42\u6c42\u51fa $g_i$ \u7684\u9006\u5143\uff0c\u603b\u590d\u6742\u5ea6\u662f $O(Tn\\log p)$ \u7684\uff0c\u96be\u4ee5\u901a\u8fc7\uff0c\u6211\u4eec\u8003\u8651\u5148\u7b97\u51fa\u6765 $\\prod g_i$ \u7684\u9006\u5143\uff0c\u7136\u540e\u7b97\u4e00\u4e0b\u524d\u7f00\u79ef\u548c\u540e\u7f00\u79ef\u4e00\u4e58\u5c31\u53ef\u4ee5 $O(1)$ \u6c42\u51fa $\\frac{1}{g_i}$ \u4e86\u3002\n\n\u636e\u540c\u673a\u623f\u795e\u4ed9 @jiqimao \u8bf4\u53ef\u4ee5\u628a\u4e0d\u7b49\u5173\u7cfb\u8f6c\u5316\u6210\u4e00\u4e2a\u5916\u5411\u6811\u7684\u62d3\u6251\u5e8f\u4e2a\u6570\u95ee\u9898\uff0c\u8fd9\u6837\u53ef\u4ee5\u7b80\u5316\u63a8\u51fa $h$ \u7684\u8fc7\u7a0b\uff0c\u672c\u8d28\u4e0a\u662f\u4e00\u6837\u7684\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint const p=998244353;\nint fac[5000005],inv[5000005],prod[5000005],prod2[5000005],f[5000005];\nint pw(int x,int y)\n{\n    int res=1;\n    while(y)\n    {\n        if(y&1)res=1ll*res*x%p;\n        x=1ll*x*x%p;\n        y>>=1;\n    }\n    return res;\n}\nint main()\n{\n    fac[0]=inv[0]=1;\n    for(int i=1;i<=5000000;i++)fac[i]=1ll*fac[i-1]*i%p;\n    inv[5000000]=pw(fac[5000000],p-2);\n    for(int i=4999999;i>=1;i--)inv[i]=1ll*inv[i+1]*(i+1)%p;\n    int t;\n    scanf(\"%d\",&t);\n    while(t--)\n    {\n        int n,m,l,k,N,I;\n        scanf(\"%d%d%d%d\",&n,&m,&l,&k);\n        N=1ll*n*m%p*l%p;\n        if(n>m)swap(n,m);\n        if(n>l)swap(n,l);\n        prod[0]=prod2[n+1]=1;\n        for(int i=1;i<=n;i++)\n            prod[i]=1ll*prod[i-1]*(N-1ll*(n-i)*(m-i)%p*(l-i)%p+p)%p;\n        for(int i=n;i>=1;i--)\n            prod2[i]=1ll*prod2[i+1]*(N-1ll*(n-i)*(m-i)%p*(l-i)%p+p)%p;\n        I=pw(prod[n],p-2);\n        f[0]=1;\n        for(int i=1;i<=n;i++)\n            f[i]=1ll*f[i-1]*(n-i+1)%p*(m-i+1)%p*(l-i+1)%p*prod[i-1]%p*prod2[i+1]%p*I%p;\n        int ans=0;\n        for(int i=k;i<=n;i++)\n            ans=(ans+1ll*fac[i]*inv[k]%p*inv[i-k]%p*(((i-k)&1)?(p-1):1)%p*f[i]%p)%p;\n        printf(\"%d\\n\",ans);\n    }\n    return 0;\n}\n```",
        "postTime": 1595852054,
        "uid": 96912,
        "name": "AzusaCat",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5400 \u3010[CTS2019]\u968f\u673a\u7acb\u65b9\u4f53\u3011"
    }
]