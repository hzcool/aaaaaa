[
    {
        "content": "\u83dc\u7684\u4e0d\u884c\u7684shadowice1984\u53ea\u4f1a\u6839\u53f7\u505a\u6cd5\n\n~~\u6b22\u8fce\u4f1alog\u505a\u6cd5\u7684\u805a\u805a\u7206\u8e29\u6211~~\n\n_________________\n\n\n\u9898\u76ee\u610f\u601d\u7b80\u5355\u660e\u4e86\uff0c\u7ed9\u5b9a\u6570\u7ec4$a$\u548c$b$,\u5b9a\u4e49\u6570\u7ec4$c$\u4e3a\n\n$$c_{i}=\\max_{j=1}^{i}a_{j}$$\n\n\u6c42\n\n$$\\prod_{i=1}^{n}min(b_{i},c_{i})$$\n\n\u591a\u7ec4\u5355\u70b9\u4fee\u6539a\u548cb\u6570\u7ec4\u7684\u503c\uff0c\u4fdd\u8bc1\u53ea\u4f1a\u5f80\u5927\u91cc\u6539\u4e0d\u4f1a\u5f80\u5c0f\u91cc\u6539\n\n# \u672c\u9898\u9898\u89e3\n\n\u90a3\u4e48\u4e00\u770b\u8fd9\u4e1c\u897f\u8fd9\u4e48\u9b3c\u755c\u7ebf\u6bb5\u6811\u4ec0\u4e48\u7684\u80af\u5b9a\u662f\u505a\u4e0d\u4e86\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u5f00\u59cb\u8003\u8651\u5206\u5757\u600e\u4e48\u505a\n\n\u65e2\u7136\u662f\u5206\u5757\u5c31\u6709\u5206\u5757\u9898\u7684\u4e00\u822c\u5957\u8def\u53ef\u4ee5\u4f7f\uff0c\u6211\u4eec\u5c1d\u8bd5\u7740\u628a\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u9898\u5f80\u5206\u5757\u7684\u6a21\u677f\u4e0a\u53bb\u5957\n\n\u7b2c\u4e00\u6b65\uff0c\u5c06\u5e8f\u5217\u5206\u6210$\\sqrt{N}$\u5757\uff0c\u6bcf\u4e2a\u5757\u4e0a\u5355\u72ec\u7ef4\u62a4\u4e00\u4e0b\u9898\u76ee\u4e2d\u8981\u6c42\u6211\u4eec\u6c42\u7684\u5f0f\u5b50\u7684\u503c\n\n\u7b2c\u4e8c\u6b65\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u8be2\u95ee\uff0c\u6211\u4eec\u66b4\u529b\u7684for\u4e00\u4e0b\u6240\u6709\u7684\u5757\uff0c\u5c06\u4e0a\u9762\u7ef4\u62a4\u7684\u7b54\u6848\u4e58\u5230\u4e00\u8d77\u5c31\u662f\u6211\u4eec\u8981\u7684\u7b54\u6848\n\n\u7b2c\u4e09\u6b65\uff0c\u5bf9\u4e8e\u4fee\u6539b\u6570\u7ec4\u7684\u64cd\u4f5c\uff0c\u6211\u4eec\u53d1\u73b0\u8fd9\u4ec5\u4ec5\u662f\u4e2a\u5355\u70b9\u4fee\u6539\u64cd\u4f5c\uff0c\u66b4\u529b\u91cd\u6784\u5176\u6240\u5728\u7684\u5757\u5373\u53ef\n\n\u7b2c\u56db\u6b65\uff0c\u5bf9\u4e8e\u4fee\u6539a\u6570\u7ec4\u7684\u64cd\u4f5c$(x,y)$\u6211\u4eec\u53d1\u73b0\u56e0\u4e3a\u53ea\u4f1a\u5f80\u5927\u91cc\u6539\uff0c\u6240\u4ee5\u8bf4\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u7b49\u4ef7\u4e8e\u5c06$(x,n)$\u8fd9\u6bb5\u540e\u7f00\u7684$c$\u503c\u5168\u90e8\u5bf9$y$\u8fdb\u884c\u53d6$max$\u64cd\u4f5c(\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e9b$c$\u503c$max=y$)\uff0c\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u4e2a\u4fee\u6539\uff0c\u4ed6\u4f1a\u4fee\u6539\u4e0d\u8d85\u8fc7$\\sqrt{N}$\u4e2a\u6563\u70b9\uff0c\u6211\u4eec\u76f4\u63a5\u91cd\u6784\u8fd9\u4e2a\u6563\u70b9\u6240\u5728\u7684\u5757\uff0c\u5bf9\u4e8e\u5269\u4e0b\u88ab\u4fee\u6539\u7684\u6574\u5757\uff0c**\u6211\u4eec\u7ed9\u8fd9\u4e2a\u5757\u6253\u4e00\u4e2a\u5bf9$y$\u53d6$max$\u7684\u61d2\u6807\u8bb0\uff0c\u7136\u540e\u66f4\u65b0\u8fd9\u4e9b\u5757\u7684\u7b54\u6848**\n\n\u53d1\u73b0\u4e00\u4ef6\u4e8b\u662f\u521a\u624d\u7684\u7b97\u6cd5\u6d41\u7a0b\u4e2d\u522b\u7684\u90fd\u662f\u6bd4\u8f83\u663e\u7136\u7684\uff0c\u552f\u4e00\u9700\u8981\u6211\u4eec\u89e3\u51b3\u7684\u5c31\u662f\uff0c\u6211\u4eec\u9700\u8981\u5728\u8fd9\u4e2a\u5757\u5185\u88ab\u6253\u4e86\u4e00\u4e2a\u5bf9$y$\u53d6$max$\u7684\u61d2\u6807\u8bb0\u4e4b\u540e\u4f9d\u7136\u53ef\u4ee5\u5feb\u901f\u7684\u6c42\u51fa\u9898\u76ee\u4e2d\u8981\u6c42\u7ed9\u7684\u5f0f\u5b50\u7684\u503c\n\n\u597d\u4e86\u73b0\u5728\u6211\u4eec\u9700\u8981\u89e3\u51b3\u7684\u95ee\u9898\u662f\uff0c\u6211\u8fd9\u4e2a\u5757\u4e0a\u88ab\u6253\u4e86\u4e00\u4e2a\u5bf9$label$\u53d6$max$\u7684\u6807\u8bb0\n\n\u6211\u60f3\u5feb\u901f\u7684\u6c42\u51fa\u8fd9\u4e2a\u503c\n\n$$\\prod_{i=1}^{block.size}min(b_{i},c_{i})$$\n\n\u90a3\u4e48\u8ba9\u6211\u4eec\u6765\u4ed4\u7ec6\u5206\u6790\u4e00\u4e0b\u5f0f\u5b50\u7684\u7279\u70b9\uff0c\u6211\u4eec\u8003\u8651\u4e00\u4e2a\u5143\u7d20$(b_{i},c_{i})$\u4ec0\u4e48\u65f6\u5019\u503c\u4f1a\u53d1\u751f\u6539\u53d8\uff0c\u4f1a\u53d8\u6210\u4ec0\u4e48\u503c\n_______________________\n\n## case1:$b\\leq c$\n\n\u6211\u4eec\u53d1\u73b0\u4e00\u4ef6\u4e8b\u662f\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4e0d\u7ba1\u6807\u8bb0\u662f\u4ec0\u4e48\u8fd9\u4e2a\u5143\u7d20\u7684\u503c\u4e00\u76f4\u662f$b$\u4e0d\u52a8\uff0c\u6240\u4ee5\u5bf9\u4e8e\u8fd9\u79cd\u5143\u7d20\u6211\u4eec\u6ca1\u5fc5\u8981\u7ba1\u4ed6\n_________________________\n\n## case2:$c \\leq label \\leq b$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8fd9\u4e2a\u5143\u7d20\u7684\u503c\u662f\u7b49\u4e8elabel\u7684\n_________________________\n\n## case3:$c \\leq b \\leq label$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8fd9\u4e2a\u5143\u7d20\u7684\u503c\u4f1a\u88ab\u5361\u6b7b\u5728b\u4e0a\uff0c\u6211\u4eec\u77e5\u9053\u4ee5\u540elabel\u53ea\u4f1a\u8d8a\u53d8\u8d8a\u5927\uff0c\u6240\u4ee5\u4ece\u6b64\u4ee5\u540e\u8fd9\u4e2a\u5143\u7d20\u7684\u503c\u4fdd\u6301\u5728b\u4e0d\u53d8\n_______________________\n\n## case4:$label \\leq c \\leq b$\n\n\u8fd9\u79cd\u60c5\u51b5\u4e0b\u7531\u4e8elabel\u592a\u5f31\u9e21\u4e86\u6240\u4ee5\u8fd9\u4e2a\u5143\u7d20\u7684\u503c\u7ef4\u6301\u5728c\u4e0d\u53d8\n_________________________\n\n\u90a3\u4e48\u6839\u636e\u4e0a\u9762\u7684\u5206\u60c5\u51b5\u8ba8\u8bba\u6211\u4eec\u53d1\u73b0\u4f3c\u4e4e\u53ea\u9700\u8981\u8bb0\u4e00\u4e0b\u5904\u4e8e$case2$(\u4e5f\u5c31\u662f\u8bf4\u503c\u7b49\u4e8elabel)\u7684\u5143\u7d20\u6709\u591a\u5c11\u4e2a,\u5b58\u5728\u53d8\u91cf$cntlb$\u91cc\uff0c\u7136\u540e\u518d\u8bb0\u4e00\u4e0b\u5904\u4e8e$case1,3,4$\u7684\u5143\u7d20\u7684\u6743\u503c\u7684\u4e58\u79ef$mul$\u5c31\u53ef\u4ee5\u4e86\uff0c\u6700\u540e\u6211\u4eec\u8981\u66f4\u65b0\u7684\u7b54\u6848\u5c31\u662f$lable^{cntlb}\u00d7mul$\n\n\u90a3\u4e48\u6211\u4eec\u600e\u4e48\u7ef4\u62a4\u8fd9\u4e2a\u8fc7\u7a0b\u5462\uff1f\n\n\u6211\u4eec\u968f\u7740label\u7684\u589e\u5927(\u663e\u7136\u4e00\u4e2a\u5757\u4e0a\u7684label\u53ea\u4f1a\u53d8\u5927\u4e0d\u4f1a\u53d8\u5c0f)\uff0c\u4e00\u4e2a\u5143\u7d20\u5fc5\u662f\u7ecf\u5386\u4e86$case4-case2-case3$\u7684\u53d8\u5316\u8fc7\u7a0b\u7684\n\n\u6362\u53e5\u8bdd\u8bf4\uff0c\u6bcf\u4e00\u4e2a\u5143\u7d20\u4f1a\u88ab\u6211\u4eec\u4ece\u8bb0\u5f55\u5904\u4e8e$case1,3,4$\u5143\u7d20\u7684\u4e58\u79ef\u53d8\u91cf\u4e2d\u6070\u597d\u5220\u53bb\u4e00\u6b21\uff0c\u4e5f\u4f1a\u88ab\u6070\u597d\u52a0\u5165\u4e00\u6b21(\u53ea\u4e0d\u8fc7\u5220\u53bb\u7684\u65f6\u5019\u8fd9\u4e2a\u5143\u7d20\u7684\u503c\u8fd8\u662fc\uff0c\u56de\u6765\u7684\u65f6\u5019\u5c31\u53d8\u6210\u4e86b\u4e86)\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u6709\u4e86\u4e00\u4e2a\u975e\u5e38\u68d2\u7684\u60f3\u6cd5\u4e86\uff0c\u6211\u4eec\u5c06\u6240\u6709$c\\leq b$\u7684\u5143\u7d20\u7684b\u503c\u548cc\u503c\u653e\u4e00\u8d77\u6392\u597d\u5e8f\uff0c\u7136\u540e\u5728\u8fd9\u4e2a\u6570\u7ec4\u4e0a\u7ef4\u62a4\u4e00\u4e2a\u6307\u9488$np$\u8868\u793a$label$\u5728\u5f53\u524d\u6570\u7ec4\u4e2d\u6240\u5904\u7684\u6392\u540d\n\n\u90a3\u4e48\u5f53$label$\u589e\u5927\u7684\u65f6\u5019\u6211\u4eec\u66b4\u529b\u7684\u8ba9$np$\u5411\u53f3\u722c\uff0c\u76f4\u5230\u78b0\u5230\u4e86\u4e00\u4e2a\u6bd4$label$\u5927\u7684\u503c,\u5728\u6211\u4eec\u8ba9\u8fd9\u4e2a\u6307\u9488\u5411\u53f3\u722c\u7684\u65f6\u5019\uff0c$np$\u6bcf\u722c\u8fc7\u4e00\u4e2ab\u503c\uff0c\u6211\u4eec\u5c31\u8ba9$cntlb--$(\u8fd9\u8bf4\u660e\u6709\u4e00\u4e2a\u5143\u7d20\u7684\u503c\u4ece$label$\u53d8\u6210\u4e86$b$)\uff0c\u540c\u65f6$mul\u00d7=b$(\u56e0\u4e3a\u8fd9\u4e2a\u5143\u7d20\u7684\u503c\u53d8\u6210\u4e86b)\n\n\u5f53\u6211\u4eec\u722c\u8fc7\u4e00\u4e2a$c$\u503c\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u8ba9$cntlb++$(\u8fd9\u8bf4\u660e\u6709\u4e00\u4e2a\u5143\u7d20\u7684\u503c\u7531$c$\u53d8\u6210\u4e86$label$)\u540c\u65f6$mul/=c$\u56e0\u4e3a\u8fd9\u4e2a\u5143\u7d20\u7684\u503c\u53d8\u6210\u4e86$label$\n\n\u6700\u540e\u6211\u4eec\u5feb\u901f\u5e42\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4fee\u6539\u7b54\u6848\u4e86~\n\n\u4e0d\u8fc7\u521a\u624d\u7684\u590d\u6742\u5ea6\u5206\u6790\u4f3c\u4e4e\u6709\u70b9\u4e0d\u9760\u8c31\u554a\uff0c\u6211\u4eec\u662f\u66b4\u529b\u5411\u53f3\u722c\u7684\u6307\u9488\uff0c\u8fd9\u6837\u7684\u8bdd\u7ed9\u4e00\u4e2a\u5757\u6253\u6807\u8bb0\u7684\u590d\u6742\u5ea6\u662f\u6700\u574f$O(blocksize)$\u7684\u554a\n\n\u4e0d\u8fc7\u6211\u4eec\u60f3\u4e00\u4e0b\uff0c\u6bcf\u6b21\u5c06\u6307\u9488\u5411\u53f3\u722c\u76f8\u5f53\u4e8e\u5220\u6389\u4e00\u4e2a\u70b9\uff0c\u4e00\u5f00\u59cb\u6709n\u4e2a\u70b9\uff0c\u6bcf\u6b21\u91cd\u6784\u4e00\u4e2a\u5757\u4f1a\u52a0\u5165$O(blocksize)$\u4e2a\u65b0\u70b9\uff0c\u90a3\u4e48\u6211\u4eec\u6307\u9488\u5411\u53f3\u722c\u7684\u603b\u590d\u6742\u5ea6\u5c31\u662f$O(n\u00d7blocksize)$\u7684\uff0c\u4e5f\u5c31\u662f\u5747\u644a$O(1)$\u7684\n\n\u771f\u6b63\u5bf9\u590d\u6742\u5ea6\u6709\u5f71\u54cd\u7684\u662f\u6bcf\u6b21\u6253\u6807\u8bb0\u4e4b\u540e\u7684\u5feb\u901f\u5e42\uff0c\u8fd9\u4e2a\u4e1c\u897f\u7684\u590d\u6742\u5ea6\u624d\u662f\n$O(logn)$\u56e0\u6b64\u6211\u4eec\u7ed9\u4e00\u4e2a\u5757\u6253\u6807\u8bb0\u7684\u590d\u6742\u5ea6\u662f$O(logn)$\u7684\n\n\u6240\u4ee5\u6211\u4eec\u8fd9\u4e2a\u7b97\u6cd5\u7684\u603b\u590d\u6742\u5ea6\u5c31\u662f$O(nlogn\\sqrt{n})$\u53ef\u4ee5\u8f7b\u677e\u7684\u901a\u8fc7\u672c\u9898\u5566~\n\n\u5bf9\u4e86\uff0c\u6700\u540e\u7684\u7ec6\u8282\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u521a\u624d\u7684\u7b97\u6cd5\u6d41\u7a0b\u4e2d\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e580\u548c\u96640\u7684\u73b0\u8c61\u4ea7\u751f\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6211\u4eec\u8fd8\u8981\u8bb0\u4e00\u4e0b0\u7684\u4e2a\u6570\uff0c\u8fd9\u6837\u624d\u80fd\u786e\u4fdd\u6211\u4eec\u65e2\u53ef\u4ee5\u4e580\u4e5f\u53ef\u4ee5\u96640\uff0c\u5177\u4f53\u5b9e\u73b0\u89c1\u4ee3\u7801~\n\n\u4e0a\u4ee3\u7801~\n\n```C\n// luogu-judger-enable-o2\n// luogu-judger-enable-o2\n#include<cstdio>\n#include<algorithm>\n#include<map>\nusing namespace std;const int N=1e5+10;const int B=270;typedef long long ll;const ll mod=1e9+7;\ninline ll po(ll a,ll p){ll r=1;for(;p;p>>=1,a=a*a%mod)if(p&1)r=r*a%mod;return r;}\nint n;int m;int bi[N];int bj[N];int sa[N];int sb[N];struct data{ll a;ll b;};\nstruct nod {ll v;int tp;friend bool operator <(nod a,nod b){return a.v<b.v;}};\nstruct num//\u5141\u8bb8\u4e580\u96640\u7684\u7ed3\u6784\u9898\n{\n    ll v;int cntz;\n    inline void mul(ll x){if(x)(v*=x)%=mod;else cntz++;}\n    inline void div(ll x){if(x)(v*=po(x,mod-2))%=mod;else cntz--;}\n    inline ll ck(){return (cntz)?0:v;}\n};\nstruct block\n{\n    nod a[2*B+10];data ori[B+10];int tp;int siz;int np;ll lb;num ret;int cntlb;ll ans;\n    inline data& operator [](const int& x){return ori[x];}\n    inline void modify(const nod& p)//\u66f4\u6539\u4e00\u4e2a\u8282\u70b9\n    {if(p.tp==0)ret.div(p.v),cntlb++;else ret.mul(p.v),cntlb--;}\n    inline void rebuild()//\u91cd\u6784\n    {\n        for(int i=1;i<=siz;i++){ori[i].a=max(ori[i].a,lb);}\n        tp=0;np=1;lb=0;ret=(num){1,0};cntlb=0;\n        for(int i=1;i<=siz;i++)ret.mul(min(ori[i].a,ori[i].b));ans=ret.ck();\n        for(int i=1;i<=siz;i++)\n            if(ori[i].a<ori[i].b)a[++tp]=(nod){ori[i].a,0},a[++tp]=(nod){ori[i].b,1};\n        sort(a+1,a+tp+1);\n    }\n    inline void lb_change(int nx)//\u6253\u6807\u8bb0\uff0c\u5411\u53f3\u722c\u4e00\u4e0b\u6307\u9488\n    {\n        if(lb>=nx)return;lb=max(lb,(ll)nx);if(np>tp)return;\n        while(np<=tp&&a[np].v<=lb)modify(a[np]),np++;\n        ans=ret.ck()*po(lb,cntlb)%mod;\n    }\n}bl[(N/B)+10];\nint main()\n{\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1;i<=n;i++)scanf(\"%d\",&sa[i]);\n    for(int i=1;i<=n;i++)scanf(\"%d\",&sb[i]);\n    for(int i=1;i<=n;i++)sa[i]=max(sa[i],sa[i-1]);\n    for(int i=1;i<=n;i++)bj[i]=(i-1)%B+1,bi[i]=((i-1)/B)+1;\n    for(int i=1;i<=n;i+=B)//\u5206\u5757\u4e00\u822c\u5957\u8def\n    {\n        int p=bi[i];\n        for(int k=i;k<=min(i+B-1,n);k++)bl[p][++bl[p].siz]=(data){sa[k],sb[k]};\n        bl[p].rebuild();\n    }\n    for(int z=1,t,x,y;z<=m;z++)\n    {\n        scanf(\"%d%d%d\",&t,&x,&y);\n        if(t==1){bl[bi[x]][bj[x]].b=y;bl[bi[x]].rebuild();}\n        else \n        {\n            for(int i=x;bi[x]==bi[i];i++)bl[bi[i]][bj[i]].a=max(bl[bi[i]][bj[i]].a,(ll)y);\n            for(int i=bi[x]+1;i<=bi[n];i++)bl[i].lb_change(y);bl[bi[x]].rebuild();\n        }\n        ll ret=1;for(int i=1;i<=bi[n];i++)(ret*=bl[i].ans)%=mod;\n        printf(\"%lld\\n\",ret);\n    }return 0;//\u62dc\u62dc\u7a0b\u5e8f~\n}\n```\n\n\n",
        "postTime": 1537749207,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4891 \u3010\u5e8f\u5217\u3011"
    },
    {
        "content": "@chen_qian \u5148\u5199\u4e86\u8fd9\u4e00\u79cd\u505a\u6cd5\uff0c\u8fd9\u7bc7\u9898\u89e3\u6743\u5f53\u662f\u4e00\u4e2a\u5bf9\u4ed6\u7684\u9898\u89e3\u7684\u8865\u5145\u3002\n\n~~\u5176\u5b9e\u4e3b\u8981\u662f\u611f\u89c9\u4ed6\u5199\u7684\u592a\u957f\u4e86~~\n\n___\n\n\u8003\u8651\u6bcf\u4e00\u79cd\u64cd\u4f5c\u5bf9\u6240\u6709\u6570\u7ec4\u9020\u6210\u7684\u5f71\u54cd\u3002\n\n- \u5bf9\u4e8e 0 \u64cd\u4f5c\uff0c\u56e0\u4e3a\u53ea\u4f1a\u6539\u5927\uff0c\u5e76\u4e14 C \u6570\u7ec4\u4e5f\u9012\u589e\uff0c\u6240\u4ee5\u76f8\u5f53\u4e8e\u533a\u95f4 $[x,p)$ \u4e0a\u7684\u4e00\u4e2a**\u533a\u95f4 cover**\u3002\uff08p \u6307\u7b2c\u4e00\u4e2a\u5927\u4e8e y \u7684 C \u6570\u7ec4\u503c\u6240\u5728\u7684\u4e0b\u6807\uff09\n\n- \u5bf9\u4e8e 1 \u64cd\u4f5c\uff0c\u5355\u70b9\u4fee\u6539\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u51fa\u73b0\u4e86\u533a\u95f4 cover\uff0c\u5355\u70b9\u4fee\u6539\uff0c\u7ebf\u6bb5\u6811\u6ca1\u5f97\u8dd1\u4e86\u3002\n\n\u7531\u4e8e\u7ebf\u6bb5\u6811\u4e0a\u7ef4\u62a4\u7684\u90fd\u662f C \u6570\u7ec4\uff0c\u6240\u4ee5\u4e0b\u9762\u7684 A \u5c31\u4ee3\u6307 \u9898\u9762\u4e2d\u7684 C \u6570\u7ec4\u4e86\u3002\n\n\u63a5\u4e0b\u6765\u6765\u770b\u7b54\u6848\u7684\u7ef4\u62a4\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u6bcf\u4e00\u6b21\u5982\u679c\u8981\u7528 naive \u7684\u65b9\u5f0f\u6b63\u786e\u7ef4\u62a4\u6240\u6709\u533a\u95f4\uff0c\u90a3\u4e48\u5fc5\u7136\u9700\u8981\u9012\u5f52\u5230\u53f6\u5b50\u6765\u66b4\u529b\u4fee\u6539\u3002\u800c\u8fd9\u662f\u6211\u4eec\u6240\u4e0d\u80fd\u63a5\u53d7\u7684\u3002\n\n[\u4e4b\u524d\u6709\u4e00\u4e9b\u9898](https://www.luogu.com.cn/training/61113)\uff0c\u4e5f\u662f\u9700\u8981\u66b4\u529b\u9012\u5f52\u5230\u53f6\u5b50\uff0c\u6211\u4eec\u7684\u4f18\u5316\u65b9\u5f0f\u662f\u4ec0\u4e48\uff1f\n\n\u53c2\u8003\u64cd\u4f5c\u672c\u8eab\u7684\u6027\u8d28\uff0c\u901a\u8fc7\u4e00\u5b9a\u7684\u526a\u679d\uff0c\u4f7f\u5f97**\u533a\u95f4\u53ef\u4ee5\u88ab\u5408\u5e76\u5904\u7406**\uff0c\u8fbe\u5230\u964d\u4f4e\u590d\u6742\u5ea6\u7684\u76ee\u7684\u3002\n\n\u90a3\u5c31\u6765\u770b\u770b\u8fd9\u4e2a\u9898\u4ec0\u4e48\u65f6\u5019\u533a\u95f4\u80fd\u591f\u5408\u5e76\u5904\u7406\u5427\u3002\uff08\u5bf9\u4e8e\u533a\u95f4 cover \u64cd\u4f5c\uff09\n\n- $A_{\\min} \\geq B_{\\max}$ , \u8fd9\u6837\u56e0\u4e3a\u53ea\u4f1a\u6539\u5927\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5bf9\u533a\u95f4\u7684\u7b54\u6848\u9020\u6210\u4efb\u4f55\u5f71\u54cd\u3002\u6253\u4e0a\u533a\u95f4 cover \u7684 tag \u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u3002\n\n- $v \\leq B_{\\min}$ , \u8fd9\u6837\u4e00\u6574\u4e2a\u533a\u95f4\u7684\u7b54\u6848\u6570\u7ec4\u90fd\u5c06\u4f1a\u662f\u6539\u4e3a\u7684\u503c\uff0c\u6253\u4e0a\u533a\u95f4 cover \u7684 tag\uff0c\u66f4\u65b0\u533a\u95f4\u7684\u7b54\u6848\uff0c\u8fd4\u56de\u3002\n\n- \u5176\u4ed6\u60c5\u51b5\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u3002\u53ea\u80fd\u9012\u5f52\u5230\u53f6\u5b50\u66b4\u529b\u66f4\u65b0\u3002\n\n\u8003\u8651\u8fd9\u6837\u505a\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u7ea7\u522b\u3002\n\n\u5982\u679c\u6211\u4eec\u5c06 $A_i < B_i$\n \u7684\u4e2a\u6570\u770b\u505a\u603b\u52bf\u80fd\u7684\u8bdd\uff0c\u6bcf\u4e00\u6b21\u9012\u5f52\u5230\u53f6\u5b50\u7684\u64cd\u4f5c\u90fd\u4f1a\u4f7f\u5f97\u603b\u52bf\u80fd -1\u3002\n \n \u800c\u552f\u4e00\u80fd\u591f\u589e\u52a0\u52bf\u80fd\u7684\u65b9\u5f0f\u5c31\u662f\u5bf9\u4e8e B \u7684 \u5355\u70b9\u4fee\u6539\u3002\u6bcf\u4e00\u6b21\u6700\u591a\u4f7f\u5f97\u603b\u52bf\u80fd +1\u3002\n \n \u7531\u4e8e\u603b\u52bf\u80fd\u5728 $O(n+q)$ \u7ea7\u522b\uff0c\u6240\u4ee5\u9012\u5f52\u5230\u53f6\u5b50\u7684\u64cd\u4f5c\u6700\u591a\u6267\u884c\u8fd9\u4e48\u591a\u6b21\u3002\n \n \u5176\u4f59\u7684\u64cd\u4f5c\u90fd\u53ef\u4ee5\u770b\u505a\u662f\u9012\u5f52\u5230\u53f6\u5b50\u8def\u4e0a\u7684\u957f\u5ea6\u4e3a 1 \u7684\u5c0f\u5206\u652f\uff0c\u65e0\u8db3\u8f7b\u91cd\u3002\n \n \u6240\u4ee5\u8fd9\u4e48\u505a\u7684\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u88ab\u8bc1\u660e\u4e86\u662f $O(n\\log^2 n$)\u7684\uff08\u8ba4\u4e3a n,q \u7b49\u4ef7\uff09\u3002\n \n ____\n \n \u5173\u4e8e\u5b9e\u73b0\uff1a~~\uff08\u8fd9\u624d\u662f\u4e07\u6076\u4e4b\u6e90\uff09~~\n \n \u5176\u5b9e\u6839\u672c\u4e0d\u7528\u50cf @chen_qian \u7684\u9898\u89e3\u90a3\u6837\u7ef4\u62a4\u8fd9\u4e48\u591a\u4e1c\u897f /lh\n \n \u5bf9\u4e8e\u6bcf\u4e2a\u8282\u70b9\uff0c\u7ef4\u62a4 $Amx,Amn,Bmx,Bmn,tag,tagty,ans$ \u5373\u53ef\u3002\n \n \u6ce8\u91ca\uff1a\n - tag : \u533a\u95f4cover tag\u3002\n \n - tagty \uff1a \u56e0\u4e3a\u8981\u8003\u8651\u8fd9\u4e00\u6b21\u7684\u533a\u95f4cover\u662f\u5426\u8981\u66f4\u65b0\u5b50\u533a\u95f4\u7684\u7b54\u6848\uff08\u8ba8\u8bba\u4e2d\u60c5\u51b5 1&2 \u7684\u533a\u522b\uff09\uff0c\u6240\u4ee5\u52a0\u4e00\u4e2a\u8fd9\u4e2a\u6807\u8bb0\u3002\n \n - \u5176\u4ed6\uff1a\u5c31\u6bd4\u8f83\u663e\u7136\u3002\n \n \u5173\u4e8e\u5982\u4f55\u627e\u5230\u533a\u95f4 cover \u7684\u53f3\u7aef\u70b9\uff1a\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u5373\u53ef\u3002\u6211\u7684\u5b9e\u73b0\u6bd4\u8f83\u4e11\uff0c\u5c06\u5c31\u7740\u770b\u5427\u3002\n \n \u5176\u4ed6\u90fd\u662f\u7ebf\u6bb5\u6811\u57fa\u672c\u64cd\u4f5c\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002\n \n ___\n \n \u4ee3\u7801\uff1a\n \n```cpp\n#include <cstdio>\n#include <cstring>\nconst int maxn = 1e5+5,mod = 1e9+7;\ninline int min(int a,int b) {return a<b?a:b;}\ninline int max(int a,int b) {return a>b?a:b;}\ninline int ksm(int a,int x) {\n\tint base=a,ans=1;\n\twhile(x) {\n\t\tif(x&1)ans = 1ll*ans*base%mod;\n\t\tbase = 1ll*base*base%mod;\n\t\tx >>= 1;\n\t}\n\treturn ans;\n}\nint n,m,tmp,a[maxn],b[maxn],amn[maxn<<2],amx[maxn<<2],bmn[maxn<<2],bmx[maxn<<2],ans[maxn<<2],tag[maxn<<2],ty[maxn<<2];\nvoid pushup(int k) {\n\tans[k] = 1ll*ans[k<<1]*ans[k<<1|1]%mod;\n\tamx[k] = max(amx[k<<1],amx[k<<1|1]),bmx[k] = max(bmx[k<<1],bmx[k<<1|1]);\n\tamn[k] = min(amn[k<<1],amn[k<<1|1]),bmn[k] = min(bmn[k<<1],bmn[k<<1|1]);\n}\nvoid build(int k,int l,int r) {\n\tif(l == r)return amn[k]=amx[k]=a[l],bmx[k]=bmn[k]=b[l],ans[k]=min(a[l],b[l]),void();\n\tint mid = l+r>>1;\n\tbuild(k<<1,l,mid),build(k<<1|1,mid+1,r),pushup(k);\n}\nvoid gtag(int k,int l,int r,int v,int typ) {\n\ttag[k] = v,ty[k] = typ,amn[k] = amx[k] = v;\n\tif(typ&1)ans[k] = ksm(v,r-l+1);\n}\nvoid pushdown(int k,int l,int r,int mid) {if(~tag[k])gtag(k<<1,l,mid,tag[k],ty[k]),gtag(k<<1|1,mid+1,r,tag[k],ty[k]),tag[k] = -1,ty[k] = 0;}\nint getpos(int k,int l,int r,int v) {\n\tif(amx[k]<=v)return n+1;\n\tif(l==r)return l;\n\tint mid = l+r>>1;\n\tpushdown(k,l,r,mid);\n\tif((tmp=getpos(k<<1,l,mid,v)) != n+1)return tmp;\n\treturn getpos(k<<1|1,mid+1,r,v);\n}\nvoid cover(int k,int l,int r,int x,int y,int v) {\n\tif(l>y||r<x)return ;\n\tif(l>=x&&r<=y) {\n\t\tif(amn[k] >= bmx[k])return gtag(k,l,r,v,2);\n\t\tif(max(amx[k],v) <= bmn[k])return gtag(k,l,r,v,1);\n\t\tif(l == r)return amn[k]=amx[k]=v,ans[k]=bmn[k],void();\n\t}\n\tint mid = l+r>>1;\n\tpushdown(k,l,r,mid);\n\tcover(k<<1,l,mid,x,y,v),cover(k<<1|1,mid+1,r,x,y,v),pushup(k);\n}\nvoid update(int k,int l,int r,int p,int v) {\n\tif(l == r)return bmn[k] = bmx[k] = v,ans[k] = min(amn[k],bmn[k]),void();\n\tint mid = l+r>>1;\n\tpushdown(k,l,r,mid);\n\tp<=mid?update(k<<1,l,mid,p,v):update(k<<1|1,mid+1,r,p,v);\n\tpushup(k);\n}\nint main() {\n\tmemset(tag,-1,sizeof(tag));\n\tscanf(\"%d %d\",&n,&m);\n\tfor(int i=1; i<=n; ++i)scanf(\"%d\",&a[i]),a[i] = max(a[i],a[i-1]);\n\tfor(int i=1; i<=n; ++i)scanf(\"%d\",&b[i]);\n\tbuild(1,1,n);\n\twhile(m--) {\n\t\tint ty,x,y;\n\t\tscanf(\"%d %d %d\",&ty,&x,&y);\n\t\tif(ty == 0) {\n\t\t\tint pos = getpos(1,1,n,y);\n\t\t\tif(x<=pos-1)cover(1,1,n,x,pos-1,y);\n\t\t}\n\t\tif(ty == 1)update(1,1,n,x,y);\n\t\tprintf(\"%d\\n\",ans[1]);\n\t}\n\treturn 0;\n}\n```\n\nupd: \u4fee\u590d\u4e86\u90e8\u5206\u7b14\u8bef\u4ee5\u53ca\u4ee3\u7801\u7f29\u8fdb\u95ee\u9898\u3002",
        "postTime": 1615516584,
        "uid": 114153,
        "name": "Sali\u0435ri",
        "ccfLevel": 7,
        "title": "P4891 \u5e8f\u5217 - \u9898\u89e3"
    },
    {
        "content": "\u8fd9\u9898\uff0c\u7a0d\u5fae\u770b\u4e86\u4e00\u4f1a\uff0c\u60f3\u4e86\u4e2a$O(n\\sqrt n)$\u7684\u5206\u5757\u3002\u770b\u5230shadowice1984\u795e\u4ed9\u4e5f\u5199\u7684\u5206\u5757\uff0c\u548c\u6211\u7684\u601d\u8def\u4e00\u6837\uff0c\u4f46\u4e3a\u5565\u591a\u4e2a$\\log$\u554a\uff1f\u90a3\u4e2a\u5feb\u901f\u5e42\u7684$\\log$\u6ca1\u5361\u4e0b\u6765\uff1f\n\n\u8bbe\u5757\u5927\u5c0f\u4e3a$S$\u3002\u6211\u4eec\u8003\u8651\u7ef4\u62a4\u6bcf\u4e2a\u5757\u5185\u7684\u4e58\u79ef\uff0c\u7136\u540e\u8be2\u95ee\u7684\u65f6\u5019\u628a\u6240\u6709\u5757\u7684\u7b54\u6848\u4e58\u8d77\u6765\u5373\u53ef\u3002\u90a3\u4e48\u5355\u6b21\u590d\u6742\u5ea6\u4e3a$O(\\frac n S)$\u3002\n\n\u8003\u8651\u4fee\u6539$B$\uff0c\u8fd9\u4e2a\u5c31\u662f\u4e2a\u7eaf\u7eaf\u7684\u5355\u70b9\u4fee\u6539\uff0c\u90a3\u4e48\u76f4\u63a5\u5728\u5b83\u6240\u5728\u5757\u4e2d\u66b4\u529b\u4fee\u6539\u5373\u53ef\u3002\u5355\u6b21\u590d\u6742\u5ea6$O(S)$\u3002\n\n\u8003\u8651\u4fee\u6539$A$\u3002\u53d1\u73b0$C$\u662f$A$\u7684\u524d\u7f00\u6700\u5927\u503c\u6570\u7ec4\uff0c\u4e00\u5b9a\u662f\u5355\u8c03\u4e0d\u4e0b\u964d\u7684\u3002\u90a3\u4e48\u5355\u70b9\u4fee\u6539$A_x$\u4e3a$y$\uff0c\u76f8\u5f53\u4e8e\u628a$x$\u53ca\u5176\u4e4b\u540e\u4f4d\u7f6e\uff0c\u6bd4$y$\u5c0f\u7684\u90fd\u8d4b\u6210$y$\u3002\u6211\u4eec\u8981\u627e\u8fd9\u4e2a\u88ab\u4fee\u6539\u7684\u533a\u95f4\u7684\u53f3\u7aef\u70b9\u3002\u7531\u4e8e\u5355\u8c03\u6027\uff0c\u6211\u4eec\u5148\u627e\u51fa\u5b83\u6240\u5728\u5757\uff0c\u7136\u540e\u5728\u5757\u91cc\u66b4\u529b\u626b\uff0c\u5f97\u5230\u5177\u4f53\u4f4d\u7f6e\u5373\u53ef\u3002\u5355\u6b21\u590d\u6742\u5ea6$O(S+\\frac n S)$\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u5bf9$C$\u6570\u7ec4\u7684\u533a\u95f4\u4fee\u6539\u4e86\u3002\u8fb9\u89d2\u76f4\u63a5\u66b4\u529b\u4fee\u6539\u3001\u66b4\u529b\u91cd\u65b0\u8ba1\u7b97\u7b54\u6848\u3002\u90a3\u4e48\u95ee\u9898\u5c31\u662f\u4e2d\u95f4\u7684\u6574\u5757\u3002\n\n\u7531\u4e8e\u4e2d\u95f4\u7684\u662f\u6574\u5757\u4fee\u6539\uff0c\u6240\u4ee5\u8fd9\u4e2a\u5757\u7684\u7b54\u6848\u662f$\\prod\\limits_i \\min(B_i,y)$\uff0c\u5373\u5bf9\u4e00\u4e2a\u5b9a\u503c\u53d6$\\min$\u3002\u90a3\u4e48\uff0c\u53ea\u6709\u5c0f\u4e8e$y$\u7684$B_i$\u7684\u503c\u662f\u6709\u8d21\u732e\u7684\uff0c\u5176\u5b83\u7684\u8d21\u732e\u5747\u4e3a$y$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5bf9\u6bcf\u4e2a\u5757\u7684$B$\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u7136\u540e\u5904\u7406\u51fa\u524d\u7f00\u79ef\uff08\u4e0d\u5f71\u54cd\u5355\u70b9\u4fee\u6539$B$\u7684\u590d\u6742\u5ea6\uff09\u3002\u8fd9\u6837\u53ef\u4ee5\u4e8c\u5206\u51fa\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e$y$\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u524d\u9762\u7684\u7528\u524d\u7f00\u79ef\u89e3\u51b3\uff0c\u540e\u9762\u7684\u7528\u5feb\u901f\u5e42\u89e3\u51b3\u3002\u8fd9\u6837\u590d\u6742\u5ea6\u4e3a$O(\\log S)$\u3002\n\n\u8003\u8651\u53bb\u6389\u8fd9\u4e2a\u4e8c\u5206\u3002\u7531\u4e8e$A$\u662f\u4e0d\u65ad\u53d8\u5927\u7684\uff0c\u90a3\u4e48$C$\u4e5f\u662f\u4e0d\u65ad\u53d8\u5927\u7684\uff0c\u6240\u4ee5\u6bcf\u6b21\u5728$B$\u4e2d\u4e8c\u5206\u5230\u7684\u4e34\u754c\u70b9\u662f\u4e0d\u65ad\u53f3\u79fb\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u6307\u9488\u8bb0\u4e00\u4e0b\u5f53\u524d\u4e34\u754c\u70b9\u7684\u4f4d\u7f6e\uff0c\u4fee\u6539\u7684\u65f6\u5019\u76f4\u63a5\u5f80\u53f3\u79fb\u5373\u53ef\u3002\u5728\u91cd\u6784\u5757\u7684\u65f6\u5019\u8981\u91cd\u7f6e\u6307\u9488\u3002\u7531\u4e8e\u91cd\u7f6e\u7684\u6b21\u6570\u4e3a$O(n)$\u6b21\uff0c\u6240\u4ee5\u6307\u9488\u603b\u79fb\u52a8\u6b21\u6570\u4e3a$O(nS)$\uff0c\u6240\u4ee5\u662f\u5747\u644a$O(1)$\u7684\u3002\n\n\u4f46\u662f\u8fd8\u662f\u5b58\u5728\u8fd9\u4e2a\u5feb\u901f\u5e42\u7684$\\log$\u3002\u6211\u4eec\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4e00\u6b21\u533a\u95f4\u4fee\u6539\uff0c\u5b83\u7684$y$\u662f\u76f8\u540c\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u5728\u4fee\u6539\u524d\u5148\u9884\u5904\u7406\u51fa$y^0,y,y^2,\\dots,y^S$\uff0c\u7136\u540e\u4fee\u6539\u7684\u65f6\u5019\u76f4\u63a5$O(1)$\u83b7\u5f97\u5bf9\u5e94\u5e42\u6b21\u5373\u53ef\u3002\u4e8e\u662f\u8fd9\u91cc\u7684\u590d\u6742\u5ea6\u88ab\u964d\u5230\u4e86$O(1)$\u5355\u6b21\u4fee\u6539\u3002\u4e00\u6b21\u533a\u95f4\u4fee\u6539\u7684\u603b\u590d\u6742\u5ea6\u5c31\u4e3a$O(S+\\frac n S)$\u3002\n\n\u8fd9\u91cc\u53ea\u6d89\u53ca\u4e58\u6cd5\uff0c\u4e5f\u4e0d\u5b58\u5728\u9664\u4ee50\u7684\u95ee\u9898\u3002\n\n\u5f53$S=\\sqrt n$\u65f6\uff0c\u590d\u6742\u5ea6\u8fbe\u5230\u7406\u8bba\u6700\u4f18\u503c\uff0c\u4e3a$O(n\\sqrt n)$\u3002\n\n## Code\uff1a\n```cpp\n#include<iostream>\n#include<algorithm>\nusing namespace std;\nconst int N=1e5+6,siz=320,D=siz+2,K=N/siz+2,md=1e9+7;\ntypedef long long LL;\n#define bel(x)((x-1)/siz+1)\nint n,m,c[N],a[N],blocks,L[K],R[K],b[N],_[N];\nstruct Blo{\n\tint pre[D],ans,c[D],L,R,len,tag,it,mxc;\n\tstruct bp{\n\t\tint val,id;\n\t\tinline int operator<(const bp&rhs)const{return val<rhs.val;}\n\t}b[D];\n\tvoid init(int l,int r){\n\t\tL=l,R=r,len=r-l+1;\n\t\tfor(int i=l;i<=r;++i)\n\t\tc[i-l+1]=::c[i],b[i-l+1]=(bp){::b[i],i};\n\t\tans=1,it=1;\n\t\tfor(int i=1;i<=len;++i)ans=(LL)ans*min(c[i],b[i].val)%md;\n\t\tpre[0]=1;\n\t\tsort(b+1,b+len+1),tag=-1;\n\t\tfor(int i=1;i<=len;++i)pre[i]=(LL)pre[i-1]*b[i].val%md;\n\t\tmxc=c[len];\n\t}\n\tvoid modify_b(int x,int y){\n\t\tif(tag!=-1)\n\t\tfor(int i=1;i<=len;++i)c[i]=tag;tag=-1;\n\t\tint pos=0;\n\t\tfor(int i=1;i<=len&&!pos;++i)if(b[i].id==x)pos=i;\n\t\tb[pos].val=y;\n\t\tfor(int i=pos+1;i<=len;++i)if(b[i]<b[i-1])swap(b[i-1],b[i]);else break;\n\t\tans=1,it=1;\n\t\tfor(int i=1;i<=len;++i)ans=(LL)ans*min(b[i].val,c[b[i].id-L+1])%md,pre[i]=(LL)pre[i-1]*b[i].val%md;\n\t}\n\tinline int getc(int pos){return tag==-1?c[pos-L+1]:tag;}\n\tvoid modify_c(int l,int r,int val){\n\t\tif(tag!=-1)\n\t\tfor(int i=1;i<=len;++i)c[i]=tag;tag=-1;\n\t\tfor(int i=l;i<=r;++i)c[i-L+1]=val;\n\t\tans=1,it=1;\n\t\tfor(int i=1;i<=len;++i)ans=(LL)ans*min(b[i].val,c[b[i].id-L+1])%md;\n\t\tmxc=c[len];\n\t}\n\tinline void allc(int val){\n\t\ttag=mxc=val;\n\t\twhile(it!=len+1&&b[it].val<val)++it;\n\t\tans=pre[it-1]*(LL)_[len-it+1]%md;\n\t}\n}G[K];\ninline int getr(int val){\n\tfor(int i=1;i<=blocks;++i)\n\tif(G[i].mxc>=val)\n\tfor(int j=L[i];j<=R[i];++j)\n\tif(G[i].getc(j)>=val)return j-1;\n\treturn n;\n}\nvoid modify_c(int l,int r,int val){\n\tconst int bL=bel(l),bR=bel(r);\n\tif(bL==bR)G[bL].modify_c(l,r,val);\n\telse{\n\t\t_[0]=1;\n\t\tfor(int i=1;i<=siz;++i)_[i]=(LL)_[i-1]*val%md;\n\t\tG[bL].modify_c(l,R[bL],val),G[bR].modify_c(L[bR],r,val);\n\t\tfor(int i=bL+1;i<bR;++i)G[i].allc(val);\n\t}\n}\nint main(){\n\tios::sync_with_stdio(0),cin.tie(0),cout.tie(0);\n\tcin>>n>>m;\n\tfor(int i=1;i<=n;++i)cin>>a[i];\n\tfor(int i=1;i<=n;++i)cin>>b[i];\n\tc[1]=a[1];\n\tfor(int i=2;i<=n;++i)c[i]=max(c[i-1],a[i]);\n\tblocks=bel(n);\n\tfor(int i=1;i<=blocks;++i)L[i]=R[i-1]+1,R[i]=i*siz;R[blocks]=n;\n\tfor(int i=1;i<=blocks;++i)G[i].init(L[i],R[i]);\n\tfor(int opt,x,y;m--;){\n\t\tcin>>opt>>x>>y;\n\t\tif(opt)G[bel(x)].modify_b(x,y);else\n\t\tif(G[bel(x)].getc(x)<y){\n\t\t\tint r=getr(y);\n\t\t\tmodify_c(x,r,y);\n\t\t}\n\t\tint ans=1;\n\t\tfor(int i=1;i<=blocks;++i)ans=(LL)ans*G[i].ans%md;\n\t\tcout<<ans<<'\\n';\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1562153885,
        "uid": 6813,
        "name": "mrsrz",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4891 \u3010\u5e8f\u5217\u3011"
    },
    {
        "content": "\u5bf9\u4e8e\u8fd9\u4e2a\u9898\u76ee\uff0c\u6211\u5f88\u60f3\u5410\u69fd\u3002\n\n\u5bf9\u4e8e$10$%\u2026\u2026\u4ec0\u4e48\u9b3c\uff1f\u53ea\u6709$5$\u4e2a\u70b9\u4f60\u8bf4$10$%\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\n\n\u8fd8\u6709\u8fd9\u4e2a\u6570\u636e\u4e5f\u592a\u6c34\u4e86\u5427\uff0c\u6211\u66b4\u529b\u90fd\u53ef\u4ee5\u78be\u6807\u7b97\u4e86\uff0c\u8fd8\u8dd1\u4e86$rank\\ 1$\uff1f\uff1f\uff1f\n\n\u6211\u7684\u66b4\u529b\u662f$O(n \\times q\\times log_2mod)$\u7684\u3002\n\n\u9996\u5148\u9884\u5904\u7406\u521d\u59cb\u7684\u7b54\u6848\u3002\n\n\u5bf9\u4e8e\u8be2\u95ee$opt=0,x,y$, \u66b4\u529b\u4fee\u6539$[x,n]$\u7684\u6bcf\u4e00\u4e2a$c[i]$,\u7136\u540e\u7528\u4e58\u6cd5\u9006\u5143\u4fee\u6539\u7b54\u6848(\u9664\u539f\u6765\u7684\u518d\u4e58\u65b0\u7684),\u590d\u6742\u5ea6$O(n\\times log_2mod)$\n\n\u6709\u4e00\u4e2a\u526a\u679d,\u5982\u679c\u5f53\u524d\u7684$c[i]>=y$,\u76f4\u63a5\u9000\u51fa\u5faa\u73af,\u56e0\u4e3a$c[i+1]>=c[i]$\n\n\u5bf9\u4e8e\u8be2\u95ee$opt=1,x,y$, \u76f4\u63a5\u4fee\u6539$b[x]$,\u7136\u540e\u7528\u4e58\u6cd5\u9006\u5143\u4fee\u6539\u7b54\u6848,\u590d\u6742\u5ea6$O(log_2mod)$\n\n\u7ed3\u679c\u8fc7\u4e86\uff1f\uff1f\uff1f\u8fd9\u90fd\u53ef\u4ee5\u8fc7\uff1f\uff1f\uff1f\uff1f\uff1f\uff1f\n\n\u6211\u4e5f\u5f88\u7edd\u671b\u554a\u3002\n\n\u4ee3\u7801\u5982\u4e0b:\n```\n#include<bits/stdc++.h>\n#define ljc 1000000007\nusing namespace std;\nint n,q,a[200005],b[200005],c[200005];\nlong long ans=1;\ninline int read(){\n    int x=0;char ch=getchar();\n    while (!isdigit(ch)) ch=getchar();\n    while (isdigit(ch)) x=(x<<1)+(x<<3)+ch-'0',ch=getchar();\n    return x;\n}\ninline long long fast_pow(int a,int b,int p){\n    long long s=1,t=a,k=b;\n    while (k){\n        if (k%2) s=s*t%p;\n        t=t*t%p;\n        k/=2;\n    }\n    return s;\n}\ninline long long max(long long a,long long b){\n    if (a>b) return a;return b;\n}\ninline long long min(long long a,long long b){\n    if (a<b) return a;return b;\n}\nint main(){\n    n=read(),q=read();\n    for (register int i=1;i<=n;i++){\n        a[i]=read();\n        c[i]=max(c[i-1],a[i]);\n    }\n    for (register int i=1;i<=n;i++){\n        b[i]=read();\n        ans=min(b[i],c[i])*ans%ljc;\n    }\n    int opt,x,y;\n    for (register int i=1;i<=q;i++){\n        opt=read(),x=read(),y=read();\n        if (opt==1){\n            if (b[x]<c[x]){\n                ans=ans*fast_pow(b[x],ljc-2,ljc)%ljc;\n                ans=ans*min(y,c[x])%ljc;\n            }\n            b[x]=y;\n        }\n        if (opt==0){\n            a[x]=y;\n            while (y>c[x]&&x<=n){\n                if (c[x]<b[x]){\n                    ans=ans*fast_pow(c[x],ljc-2,ljc)%ljc;\n                    ans=ans*min(y,b[x])%ljc;\n                }\n                c[x++]=y;\n            }\n        }\n        printf(\"%lld\\n\",ans);\n    }\n    return 0;\n}\n\n\n\n```\n\n",
        "postTime": 1537698504,
        "uid": 20309,
        "name": "Fading",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4891 \u3010\u5e8f\u5217\u3011"
    },
    {
        "content": "\uff08\u521a\u624dubuntu\u81ea\u5e26\u8f93\u5165\u6cd5\u53c8\u53cc\u53d2\u53d5\u51fa\u95ee\u9898\u4e86\uff0c\u4e0d\u723d\uff09\n\n\u7ed9\u4e00\u4e2a\u590d\u6742\u5ea6\uff08\u4e5f\u8bb8\uff09\u6b63\u786e\u7684\u505a\u6cd5\uff1a$O((n+q) log^2{n})$ \u7684\u3002\u6bd4\u8d5b\u65f6\u60f3\u5230\u8fd9\u4e2a\u505a\u6cd5\u57fa\u672c\u6ca1\u52a8\u8111\u5b50\u3002\u4f46\u662f\u5199\u7684\u6b32\u54ed\u65e0\u6cea\u3002\u6210\u529f\u7684\u70b8\u96f6\u4e86\u3002\u6bd4\u8d5b\u7ed3\u675f\u540e\u53c8\u8c03\u4e86\u4e00\u4e2a\u5c0f\u65f6\u624d\u8fc7\u3002\n\n~~\u8bdd\u8bf4\u6211\u5982\u6b64\u4f18\u79c0\u7684\u590d\u6742\u5ea6\u4e3a\u4ec0\u4e48\u6700\u4f18\u89e3\u5012\u6570\uff1f\u4e0d\u670d\u3002~~\n\n**[\u6211\u7684\u535a\u5ba2](https://www.luogu.org/blog/474D/)**\n\n\u6ce8\u610f\u5230\u6bcf\u6b21\u4fee\u6539A\u90fd\u662f\u628aA\u4e2d\u7684\u4e00\u4e2a\u6570\u53d8\u5927\u3002\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u8fd9\u6837\u4e00\u4ef6\u4e8b\uff1a\u5047\u8bbe\u4e00\u4e2a\u6570\u6bd4\u5b83\u4e4b\u524d\u7684\u6240\u6709\u6570\u90fd\u8981\u5927\uff0c\u90a3\u4e48\u5728\u6240\u6709\u65f6\u523b\u4e2d\"\u8fd9\u6837\u7684\u6570\u201c\u96c6\u5408\u80af\u5b9a\u53d8\u52a8\u4e0d\u8d85\u8fc7$O(n+q)$\u6b21\u3002\u53ef\u4ee5\u611f\u6027\u7406\u89e3\u4e00\u4e0b\u3002\u6240\u4ee5\u5bb9\u6613\u60f3\u5230\u7528\u4e00\u4e2aset\u6765\u7ef4\u62a4\u8fd9\u4e2a\u96c6\u5408\u3002\n\n\u73b0\u5728\u8003\u8651\u6bcf\u6b21\u8fd9\u4e2a\u96c6\u5408\u4e2d\u4e00\u4e2a\u6570a\u548ca\u7684\u4e0b\u4e00\u4e2a\u6570b\u4e4b\u95f4\uff08\u5de6\u95ed\u53f3\u5f00\uff09\u7684\u90a3\u4e00\u6bb5\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e00\u6bb5\u7684C\u503c\u90fd\u662f\u4e00\u6837\u7684\u3002\u6240\u4ee5\u53ea\u8981\u77e5\u9053\u533a\u95f4\u4e2d\u6709\u591a\u5c11\u4e2ab\u503c\u5c0f\u4e8e\u533a\u95f4\u7684C\u503c\u4ee5\u53ca\u8fd9\u4e9bb\u503c\u7684\u4e58\u79ef\u3002\u7528\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u5373\u53ef\uff08\u6211\u7528\u7684\u662f\u6811\u72b6\u6570\u7ec4\u5957\u4e3b\u5e2d\u6811\uff09\u3002\u7136\u540e\u5c31\u7edf\u8ba1\u4e00\u4e0b\u533a\u95f4\u4e58\u79ef\uff0c\u4e58\u4e0aC\u7684\u67d0\u4e2a\u6b21\u5e42\u5373\u53ef\u3002\n\n\u5bf9\u4e8e1\u64cd\u4f5c\uff0c\u76f4\u63a5\u5728\u6811\u72b6\u6570\u7ec4\u5957\u4e3b\u5e2d\u6811\u91cc\u4fee\u6539\u5c31\u884c\u4e86\u30022\u64cd\u4f5c\u7ec6\u8282\u975e\u5e38\u591a\u3002\u9996\u5148\u8981\u4e8c\u5206\u51fa\u5f53\u524d\u7684\u503c\u5728\u5e8f\u5217\u7684\u54ea\u4e00\u6bb5\u662f\u6700\u5927\u503c\uff08\u8fd9\u91cc\u4e5f\u8981\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4\uff09\u3002\u5982\u679c\u662f\u7a7a\u533a\u95f4\u76f4\u63a5\u8df3\u8fc7\uff08\u6211\u8fd9\u91cc\u56e0\u4e3a\u76f4\u63a5continue\uff0c\u5fd8\u4e86\u8f93\u51fa\u7b54\u6848\uff0c\u8c03\u4e86\u597d\u4e45\uff09\u3002\u5047\u8bbe\u533a\u95f4\u662f[l,r],\u7136\u540e\u5728set\u91cc\u67e5\u8be2\u4e00\u4e0b\uff0c\u8981\u628aset\u4e2d\u5305\u542bl\u548c\u5305\u542br\u7684\u533a\u95f4\uff08**\u53ef\u80fd\u662f\u540c\u4e00\u4e2a**\uff1b\u8fd9\u91cc\u7684\u533a\u95f4\uff0c\u6307\u7684\u662f\u4e00\u4e2a\u6570a\u548ca\u7684\u4e0b\u4e00\u4e2a\u6570b\u4e4b\u95f4\uff08\u5de6\u95ed\u53f3\u5f00\uff09\u7684\u90a3\u4e00\u6bb5\uff0c\u5982\u679c\u6ca1\u6709\u4e0b\u4e00\u4e2a\u6570\u5c31\u662f\u5230\u5e8f\u5217\u7ed3\u5c3e\uff09**\u53ef\u80fd\u9700\u8981**\u5206\u88c2\u4e00\u4e0b\uff0c\u7136\u540e\u628al\u548cr\u4e2d\u95f4\u7684\u533a\u95f4\u5168\u90fd\u5220\u6389\uff0c\u540c\u65f6\u7edf\u8ba1\u8fd9\u4e9b\u533a\u95f4\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u6700\u540e\u5728set\u4e2d\u63d2\u5165l\uff0c\u8868\u793a\u8fd9\u4e2a\u65b0\u7684\u533a\u95f4\u3002\n\n\u8fd8\u6709\u7a7a\u95f4\u9700\u8981\u5361\u4e00\u5361\uff0c\u4e3b\u5e2d\u6811\u7684\u8282\u70b9\u4e2d\u533a\u95f4\u4e58\u79ef\u5fc5\u987b\u5f00int\uff0c\u5426\u5219\u8981\u4e48MLE\u8981\u4e48RE\u3002\u6211\u7684\u7a7a\u95f4\u7528\u4e86\u8fd1500MB\u3002\n\n\u4e0b\u9762\u662f\u4ee3\u7801\uff1a\uff08\u5f53\u7136\u662f\u6211\u6700\u7231\u7684C++17\uff09\n```cpp\n// luogu-judger-enable-o2\n#include<bits/stdc++.h>\n#define maxn 100010\n#define int64 long long\n#define L(x) (a[x].ch[0])\n#define R(x) (a[x].ch[1])\nusing namespace std;\nmultiset<pair<int,int64>> s;\n//\u8bf4\u597d\u7684set\u600e\u4e48\u53d8\u6210multiset\u4e86\uff1f\u56e0\u4e3a\u6211\u662f\u5148\u63d2\u5165\u65b0\u533a\u95f4\u518d\u5220\u9664\u65e7\u533a\u95f4\u7684\uff0c\u53ef\u80fd\u4e24\u4e2a\u533a\u95f4\u5b8c\u5168\u76f8\u540c\u3002\nconst int64 mod=1e9+7;\nint n,q,a[maxn],b[maxn],c1[maxn],rt[maxn];\nint64 ans=1;\nint64 power(int64 a,int64 b){\n    if(!b)return 1;\n    int64 ret=power(a,b>>1);\n    ret=(ret*ret)%mod;\n    if(b&1)ret=(ret*a)%mod;\n    return ret;\n}\nstruct segtree{\n    struct node{int cnt,ch[2],mul=1;}a[30000010];\n    //\u5fc5\u987b\u5c31\u662f3000W\uff0c\u591a\u4e00\u6bebMLE\uff0c\u5c11\u4e00\u6bebRE\n    int tot,_cnt;int64 _mul;\n    void ins(int x,int v,int modi,int &p,int tl=1,int tr=1e9){\n        if(!p)p=++tot;\n        if(tl==tr){a[p].mul=(1ll*a[p].mul*v)%mod;a[p].cnt+=modi;return;}\n        int mid=tl+tr>>1;\n        if(x<=mid)ins(x,v,modi,L(p),tl,mid);\n        else ins(x,v,modi,R(p),mid+1,tr);\n        a[p].mul=(1ll*a[L(p)].mul*a[R(p)].mul)%mod;\n        a[p].cnt=a[L(p)].cnt+a[R(p)].cnt;\n    }\n    void qry(int l,int r,int p,int tl=1,int tr=1e9){\n        if(!p)return;\n        if(l<=tl && tr<=r){(_mul*=a[p].mul)%=mod,_cnt+=a[p].cnt;return;}\n        int mid=tl+tr>>1;\n        if(l<=mid)qry(l,r,L(p),tl,mid);\n        if(r>mid)qry(l,r,R(p),mid+1,tr);\n    }\n}tr;\nvoid chkmax(int &a,int b){a=max(a,b);}\nvoid ins(int p,int v){for(;p<=n;p+=p&-p)chkmax(c1[p],v);}\nint qry(int p){int r=0;for(;p;p&=p-1)chkmax(r,c1[p]);return r;}\nvoid Ins(int p,int v,int tp=1){\n    int t=p;\n    for(;p<=n;p+=p&-p){\n        if(tp)tr.ins(b[t],power(b[t],mod-2),-1,rt[p]);\n        tr.ins(v,v,1,rt[p]);\n    }\n    b[t]=v;\n}\nint64 Qry(int l,int r,int u){\n    int d=r-l+1;int64 mul=1,cnt=0;\n    for(l--;l;l&=l-1){\n        tr._mul=1,tr._cnt=0;\n        tr.qry(0,u,rt[l]);\n        (mul*=power(tr._mul,mod-2))%=mod,cnt-=tr._cnt;\n    }\n    for(;r;r&=r-1){\n        tr._mul=1,tr._cnt=0;\n        tr.qry(0,u,rt[r]);\n        (mul*=tr._mul)%=mod,cnt+=tr._cnt;\n    }\n    return power(u,d-cnt)*mul%mod;\n}\nint main(){\n    scanf(\"%d%d\",&n,&q);\n    for(int i=1;i<=n;i++)scanf(\"%d\",a+i),ins(i,a[i]);\n    for(int i=1;i<=n;i++)scanf(\"%d\",b+i),Ins(i,b[i],0);\n    for(int i=1,l=0;i<=n+1;i++)if(i>n || qry(i)==a[i]){\n        if(l){\n            int64 t=Qry(l,i-1,a[l]);\n            s.insert(pair(l,t));\n            (ans*=t)%=mod;\n        }\n        l=i;\n    }\n    while(q--){\n        int op,x,y;scanf(\"%d%d%d\",&op,&x,&y);\n        if(op){\n            Ins(x,y);\n            auto it=s.upper_bound(pair(x,(int64)1e18)),nxt=it;\n            int64 t;--it;\n            (ans*=power(it->second,mod-2))%=mod;\n            s.insert(pair(it->first,\n                t=Qry(it->first,nxt==s.end()?n:nxt->first-1,qry(it->first))));\n            s.erase(it);\n            (ans*=t)%=mod;\n        }else{\n            int l=x,r=n+1;ins(x,y);\n            if(qry(x)!=y){printf(\"%lld\\n\",ans%mod);continue;}\n            while(l<r){\n                int mid=l+r>>1;\n                if(qry(mid)>y)r=mid;else l=mid+1;\n            }\n            l--;\n            auto it=s.upper_bound(pair(x,(int64)1e18)),nxt=it;\n            --it;\n            int stp=it->first;int64 t=1,t1;\n            vector<decltype(s.begin())> v; \n            //\u539f\u8c05\u6211C++17\u5b66\u827a\u4e0d\u7cbe\uff0c\u4e0d\u4f1a\u66f4\u7b80\u5355\u7684\u5199\u6cd5\n            for(;nxt!=s.end() && nxt->first<=l;++nxt,++it)\n                (ans*=power(it->second,mod-2))%=mod,v.push_back(it);\n            if(stp!=x)s.insert(pair(stp,t=Qry(stp,x-1,qry(stp)))); //\u5206\u88c2\u5f00\u5934\n            for(auto it:v)s.erase(it); //\u5220\u9664\u4e2d\u95f4\u533a\u95f4\n            int edp=nxt==s.end()?n:nxt->first-1;\n            if(l!=edp)s.insert(pair(l+1,t1=Qry(l+1,edp,qry(l+1)))),t=(t*t1)%mod; //\u5206\u88c2\u7ed3\u5c3e\n            (ans*=power(it->second,mod-2))%=mod;\n            (ans*=t)%=mod;\n            s.erase(it);\n            t=Qry(x,l,y);(ans*=t)%=mod;\n            s.insert(pair(x,t));\n        }\n        printf(\"%lld\\n\",ans%mod);\n    }\n    return 0;\n}\n```\n",
        "postTime": 1537755072,
        "uid": 30093,
        "name": "cosmicAC",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4891 \u3010\u5e8f\u5217\u3011"
    },
    {
        "content": "**update\uff1a\u4fee\u6539\u4e86\u4e00\u4e9b\u7b14\u8bef**\n\n\u770b\u5230\u9898\u89e3\u533a\u91cc\u9762\u597d\u50cf\u6ca1\u6709\u6bd4\u8f83\u6b63\u7edf\uff08\u5176\u5b9e\u5c31\u662f\u6211\u4e0d\u4f1a\u5206\u5757\uff09\u7684\u7ebf\u6bb5\u6811\u505a\u6cd5\u3002\u6240\u4ee5\u5199\u8fd9\u7bc7\u9898\u89e3\u3002\n\n\u672c\u9898\u7684\u96be\u70b9\u5c31\u5728\uff0c\u5f53 $a_x$ \u7684\u503c\u88ab\u66f4\u65b0\u4e4b\u540e\uff0c\u5982\u4f55\u6b63\u786e\u5730\u7ef4\u62a4 $c$ \u6570\u7ec4\u7684\u66f4\u6539\uff0c\u4ee5\u53ca $c$ \u6570\u7ec4\u66f4\u6539\u540e\u5bf9\u4e8e\u5168\u5c40\u7b54\u6848\u7684\u66f4\u6539\u3002\n\n\u663e\u7136\u7684\u662f\uff0c$a_x$ \u7684\u503c\u88ab\u66f4\u65b0\u4e4b\u540e\uff0c\u5047\u5982\u5bf9 $c$ \u6570\u7ec4\u6709\u5f71\u54cd\u3002\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\uff0c\u67e5\u627e\u5f53\u524d\u7b2c\u4e00\u4e2a $c_y$ \u5927\u4e8e $a_x$\uff0c\u7136\u540e\u5bf9\u4e8e $[x,y]$ \u8fdb\u884c\u533a\u95f4\u4fee\u6539\u7684\u64cd\u4f5c\u3002\n\n\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u7531\u4e8e $c$ \u672c\u8eab\u7684\u5b9a\u4e49\u662f $a$ \u6570\u7ec4\u7684\u524d\u7f00\u6700\u5927\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4e0d\u7528\u7ef4\u62a4\u7ebf\u6bb5\u6811\u7ef4\u62a4 $c$ \u6570\u7ec4\uff0c\u800c\u7ef4\u62a4 $a$ \u6570\u7ec4\uff0c\u7136\u540e\u5728\u9012\u5f52\u65f6\u7edf\u8ba1\u4e00\u4e0b\u6700\u503c\uff0c\u8fd9\u6837\u5c31\u7701\u7565\u4e86 $c$ \u6570\u7ec4\u7684\u7ef4\u62a4\uff0c\u800c\u53ea\u7528\u8003\u8651\u5982\u4f55\u7ef4\u62a4\u4e58\u79ef\u4e86\u3002\n\n\u7531\u4e8e $b$ \u7684\u5f71\u54cd\uff0c\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u91c7\u53d6\u61d2\u6807\u8bb0\u7684\u5f62\u5f0f\u6765\u8fdb\u884c\u8003\u8651\uff0c\u53ea\u80fd\u9012\u5f52\u5230\u53f6\u5b50\u66b4\u529b\u4fee\u6539\u3002\n\n\u533a\u95f4\u64cd\u4f5c\u5374\u53ea\u80fd\u66b4\u529b\uff1f\u8fd9\u6837\u7684\u64cd\u4f5c\u662f\u4e0d\u662f\u8ba9\u4f60\u60f3\u5230\u4e86[\u533a\u95f4\u5f00\u6839](https://www.luogu.com.cn/problem/P4145)\u5462\uff1f\u6211\u4eec\u501f\u7167\u8fd9\u4e2a\u9898\u91c7\u53d6\u52bf\u80fd\u7ebf\u6bb5\u6811\u6765\u8003\u8651\u3002\n\n\u5176\u5b9e\u52bf\u80fd\u7ebf\u6bb5\u6811\u672c\u8eab\u5e76\u4e0d\u662f\u4e00\u79cd\u7b97\u6cd5\uff0c\u4ed6\u53ea\u662f\u57fa\u4e8e\u52bf\u80fd\u6765\u5206\u6790\u7ebf\u6bb5\u6811\u4e0a\u7684\u4e00\u79cd\u7c7b\u4f3c\u526a\u679d\u7684\u4f18\u5316\u65b9\u6cd5\u7684\u590d\u6742\u5ea6\u7684\u65b9\u6cd5\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5148\u6765\u8003\u8651\u600e\u4e48\u526a\u679d\u3002\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u91c7\u53d6\u61d2\u6807\u8bb0\u7684\u539f\u56e0\u5176\u5b9e\u5c31\u662f\u62c5\u5fc3\uff0c\u533a\u95f4\u4fee\u6539\u4ee5\u540e\uff0c\u4e00\u4e9b\u539f\u6765\u5c0f\u7684 $c$ \uff0c\u6bd4 $b$ \u5927\u4e86\uff0c\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u6765\u89c4\u907f\u8fd9\u79cd\u60c5\u51b5\u3002\n\n\u90a3\u4e48\u5047\u5982\u8fd9\u4e2a\u533a\u95f4\u91cc\u9762\uff0c\u6240\u6709\u6bd4 $c$ \u5927\u7684 $b$ \u4e2d\u7684\u6700\u5c0f\u503c\u90fd\u6bd4\u4fee\u6539\u7684\u503c\u5927\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u5feb\u901f\u5e42\u8ba1\u7b97\u4e86\uff01\n\n\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\u5c31\u662f\u533a\u95f4\u6240\u6709\u7684 $c$ \u90fd\u6bd4 $b$ \u5927\uff0c\u56e0\u4e3a\u4fee\u6539\u5355\u8c03\u9012\u589e\uff0c\u8fd9\u6837\u6839\u672c\u4e0d\u4f1a\u6709\u5f71\u54cd\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5bf9\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4ee5\u4e0b\u51e0\u4e2a\u503c\u3002\u6ce8\u610f\u4e0b\u9762\u7684\u503c\u90fd\u7ef4\u62a4\u7684\u662f $p$ \u8282\u70b9\u5bf9\u5e94\u533a\u95f4\u7684\u503c\u3002\n\n- $mulb_p$ \u533a\u95f4\u4e2d\u6ee1\u8db3 $b_i \\le c_i$ \u7684 $b_i$ \u7684\u4e58\u79ef\n\n- $mulc_p$ \u533a\u95f4\u4e2d\u6ee1\u8db3 $b_i > c_i$ \u7684 $c_i$ \u7684\u4e58\u79ef\n\n- $cntb_p$ \u533a\u95f4\u4e2d\u6ee1\u8db3 $b_i \\le c_i$ \u7684 $b_i$ \u7684\u4e2a\u6570\n\n- $cntc_p$ \u533a\u95f4\u4e2d\u6ee1\u8db3 $b_i > c_i$ \u7684 $c_i$ \u7684\u4e2a\u6570\n\n- $maxc_p$ \u533a\u95f4\u6700\u5927 $a_i$ \n\n- $minb_p$ \u533a\u95f4\u4e2d\u6ee1\u8db3 $b_i > c_i$ \u7684 $b_i$ \u7684\u6700\u5c0f\u503c\uff0c\u5982\u679c\u6ca1\u6709\u8fd9\u6837\u7684\u6570\u5c31\u7f6e\u6210 **INF**\u3002\u8fd9\u6837\u5305\u542b\u4ee5\u4e0a\u4e24\u79cd\u60c5\u51b5\u3002\n\n- $lazy_p$ \u6807\u8bb0\u533a\u95f4\u662f\u5426\u5305\u542b\u4ee5\u4e0a\u4e24\u79cd\u60c5\u51b5\u4e4b\u4e00\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u89c1\u4ee3\u7801\u6ce8\u91ca\u3002\n\n\u90a3\u4e48\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u590d\u6742\u5ea6\u5427\u3002\n\n\u56e0\u4e3a\u4ee5\u4e0a\u505a\u6cd5\u662f\u5bf9\u4e8e $c_i < b_i$ \u7684\u60c5\u51b5\u5c55\u5f00\u8ba8\u8bba\u3002\u6211\u4eec\u4e0d\u59a8\u5c06 $c_i < b_i$ \u7684\u4e2a\u6570\u5f53\u505a\u52bf\u80fd\uff0c\u6211\u4eec $c$ \u6570\u7ec4\u7684\u533a\u95f4\u64cd\u4f5c\u5047\u5982\u88ab\u6210\u529f\u526a\u679d\u4e0d\u4f1a\u4f7f\u52bf\u80fd\u589e\u52a0\u3002\u5982\u679c\u9012\u5f52\u5230\u53f6\u5b50\u5c31\u80fd\u4f7f\u52bf\u80fd $-1$\u3002\u800c $b$ \u6570\u7ec4\u7684\u6539\u53d8\u81f3\u591a\u4f7f\u52bf\u80fd\u589e\u52a0 $1$\uff0c\u6240\u4ee5\u6700\u574f\u60c5\u51b5\u4e0b\u7684\u603b\u52bf\u80fd\u662f $n+q$\u3002\u8fd9\u610f\u5473\u7740\u6211\u4eec\u81f3\u591a\u4f1a\u5230 $n+q$ \u6b21\u53f6\u5b50\uff0c\u7b97\u4e0a\u5feb\u901f\u5e42\uff0c\u590d\u6742\u5ea6\u4e3a $O((n+q) \\log^{2}(n))$\u3002\n\n\u800c\u5b9e\u9645\u4e0a\u4f1a\u7a0d\u5fae\u5feb\u4e00\u70b9\uff0c\u56e0\u4e3a\u5feb\u901f\u5e42\u548c\u9012\u5f52\u5230\u53f6\u5b50\u7684\u60c5\u51b5\u4e0d\u4f1a\u540c\u65f6\u51fa\u73b0\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define N 100005\n#define mod 1000000007\n#define int long long\n#define INF 1e17\nusing namespace std;\nint n,m,a[N],c[N],b[N];\nint mulb[N<<2],mulc[N<<2],cntb[N<<2],cntc[N<<2],maxc[N<<2],minb[N<<2],lazy[N<<2];\nint qpow(int x,int b){\n\tint ans=1;\n\twhile(b){\n\t\tif(b&1) ans=(ans*x)%mod;\n\t\tb>>=1;\n\t\tx=(x*x)%mod; \n\t}\n\treturn ans%mod;\n}\nvoid push_tag(int p,int v){\n\tlazy[p]=v;\n\tmulc[p]=qpow(v,cntc[p]);//\u6ce8\u610f\u6307\u6570\n}\nvoid push_up(int p){\n\tmulb[p]=(mulb[p<<1]*mulb[p<<1|1])%mod;\n\tmulc[p]=(mulc[p<<1]*mulc[p<<1|1])%mod;\n\tcntb[p]=cntb[p<<1]+cntb[p<<1|1];\n\tcntc[p]=cntc[p<<1]+cntc[p<<1|1];\n\tmaxc[p]=max(maxc[p<<1],maxc[p<<1|1]);\n\tminb[p]=min(minb[p<<1],minb[p<<1|1]);\n}\nvoid push_down(int p,int l,int r){\n\tint mid=(l+r)>>1;\n\tif(lazy[p]!=-1){\n\t\tpush_tag(p<<1,lazy[p]);\n\t\tpush_tag(p<<1|1,lazy[p]);\n\t\tlazy[p]=-1; \n\t}\n}\nvoid build(int p,int l,int r){\n\tif(l==r){\n\t\tif(c[l]<b[l]){\n\t\t\tcntc[p]=1;\n\t\t\tmulc[p]=c[l];\n\t\t\tmulb[p]=1;\n\t\t\tcntb[p]=0;\n\t\t\tminb[p]=b[l]; \n\t\t}\n\t\telse{\n\t\t\tcntc[p]=0;\n\t\t\tmulc[p]=1;\n\t\t\tmulb[p]=b[l];\n\t\t\tcntb[p]=1;\n\t\t\tminb[p]=INF; \n\t\t}\n\t\tmaxc[p]=a[l];\n\t\tlazy[p]=-1;//lazy=-1\uff0c\u907f\u514d 0\n\t\treturn ;\n\t}\n\tlazy[p]=-1;\n\tint mid=(l+r)>>1;\n\tbuild(p<<1,l,mid);\n\tbuild(p<<1|1,mid+1,r);\n\tpush_up(p); \n}\nvoid modifya(int p,int l,int r,int x,int v){\n\tif(l==r){\n\t\tmaxc[p]=max(maxc[p],v);\n\t\treturn ;\n\t}\n\tpush_down(p,l,r);\n\tint mid=(l+r)>>1;\n\tif(x<=mid) modifya(p<<1,l,mid,x,v);\n\telse modifya(p<<1|1,mid+1,r,x,v);\n\tpush_up(p);\n} \nint Search(int p,int l,int r,int x){\n    if(maxc[p]<=x) return r+1;\n    int fmax=-1;//\u91cd\u70b9\u662f\u8fd9\u91cc\u8bb0\u5f55\u524d\u7f00\u7684\u6700\u5927\u503c\u7684\u64cd\u4f5c\n    while(l!=r){\n        int mid=(l+r)>>1;\n        if(max(fmax,maxc[p<<1])>x) r=mid,p<<=1;\n        else{\n        \tfmax=max(fmax,maxc[p<<1]);\n\t\t\tl=mid+1;p=p*2+1;\n\t\t}\n    }\n    return l;\n}\nint queryc(int p,int l,int r,int x){//\u67e5\u8be2\u5bf9\u5e94\u7684c\uff0c\u8fdb\u884c\u64cd\u4f5c\n\tint ans=-1;\n\twhile(l!=r){\n\t\tint mid=(l+r)>>1;\n\t\tif(x<=mid) r=mid,p<<=1;\n\t\telse{\n\t\t\tans=max(ans,maxc[p<<1]);\n\t\t\tl=mid+1,p=p*2+1;\n\t\t}\n\t}\n\treturn max(ans,maxc[p]);\n}\nvoid modifyc(int p,int l,int r,int ql,int qr,int x){\n\tif(ql<=l&&qr>=r&&minb[p]>x){\n\t\tpush_tag(p,x);//\u91cd\u70b9\n\t\treturn ;\n\t}\n\tif(l==r){\n\t\tmulc[p]=1,cntc[p]=0;\n\t\tmulb[p]=b[l],cntb[p]=1;\n\t\tminb[p]=INF;\n\t\treturn ;\n\t}\n\tpush_down(p,l,r);\n\tint mid=(l+r)>>1;\n\tif(ql<=mid) modifyc(p<<1,l,mid,ql,qr,x);\n\tif(qr>mid) modifyc(p<<1|1,mid+1,r,ql,qr,x);\n\tpush_up(p);\n}\nvoid modifyb(int p,int l,int r,int x,int v,int tc){//\u8fd9\u91cc\u4e5f\u8981\u8bb0\u5f55\u524d\u7f00\u6700\u5927\u503c\n\tif(l==r){\n\t\ttc=max(tc,maxc[p]);\n\t\tif(v>tc){\n\t\t\tmulc[p]=tc;cntc[p]=1;\n            mulb[p]=1;cntb[p]=0;\n            minb[p]=v;\n\t\t} \n\t\telse{\n\t\t\tmulc[p]=1,cntc[p]=0;\n\t\t\tmulb[p]=v,cntb[p]=1;\n\t\t\tminb[p]=INF;\n\t\t}\n\t\treturn ;\n\t}\n\tpush_down(p,l,r);\n\tint mid=(l+r)>>1;\n\tif(x<=mid) modifyb(p<<1,l,mid,x,v,tc);\n\telse modifyb(p<<1|1,mid+1,r,x,v,max(tc,maxc[p<<1]));\n\tpush_up(p);\n}\nsigned main(){\n\tscanf(\"%lld%lld\",&n,&m);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%lld\",&a[i]);\n\t\tc[i]=max(c[i-1],a[i]); \n\t} \n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&b[i]);\n\tbuild(1,1,n);\n\twhile(m--){\n\t\tint op,x,y;\n\t\tscanf(\"%lld%lld%lld\",&op,&x,&y);\n\t\tif(op==0){\n\t\t\tint s=queryc(1,1,n,x);\n\t\t\tmodifya(1,1,n,x,y);\n\t\t\tif(s<y){\n\t\t\t\tint w=Search(1,1,n,y)-1;\n\t\t\t\tmodifyc(1,1,n,x,w,y);\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tb[x]=y;\n\t\t\tmodifyb(1,1,n,x,y,-1);\n\t\t}\n\t\tint ans=(mulb[1]*mulc[1])%mod;\n\t\tprintf(\"%lld\\n\",ans);\n\t} \n\treturn 0;\n} \n/*\n\u9644\u8d60\u5bf9\u62cd\u6837\u4f8b\u4e00\u4efd\n4 5\n1 4 3 4 \n1 4 4 0 \n0 3 5\n1 4 1\n1 1 4\n1 2 8\n0 3 8\n*/\n```\n",
        "postTime": 1615464422,
        "uid": 128870,
        "name": "chen_qian",
        "ccfLevel": 7,
        "title": "P4891 \u9898\u89e3"
    },
    {
        "content": "\u9274\u4e8e\u53c9\u6389\u4e86@[Sali\u0435ri](https://www.luogu.com.cn/user/114153)\u7684\u4e00\u7bc7\u9898\u89e3\uff0c\u8fd9\u91cc\u6765\u8865\u4e00\u4e2a\u7ebf\u6bb5\u6811\u7684\u505a\u6cd5\u3002\n\n\u76f8\u4f3c\u7684\uff0c\u6211\u4eec\u5c06 $c_i\\le b_i$ \u7684\u70b9\u4e2a\u6570\u770b\u505a\u52bf\u80fd\uff0c\u6bcf\u6b21\u82e5\u9012\u5f52\u5230\u53f6\u5b50\u5219\u52bf\u80fd\u51cf\u4e00\u7684\u8bdd\u590d\u6742\u5ea6\u662f\u6b63\u786e\u7684\u3002\uff08\u4e00\u5171\u521d\u59cb $n$ \u70b9\u52bf\u80fd\uff0c\u6539\u4e00\u6b21 $b$ \u4f1a\u52a0\u4e00\u70b9\u52bf\u80fd\uff0c\u9012\u5f52\u5230\u53f6\u5b50\u590d\u6742\u5ea6\u662f $\\log n$ \uff0c\u4e00\u5171 $\\text{\u52bf\u80fd}\\times\\log$ \u590d\u6742\u5ea6\uff09\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u5982\u679c\u7ef4\u62a4\u7684\u4e8b\u60c5\u4e86\uff0c\u6211\u7528\u5230\u4e86 6 \u4e2a\u6570\u7ec4\uff0c\n\nans \u8868\u793a\u6574\u4e2a\u533a\u95f4\u4e58\u5728\u4e00\u8d77\u3002\n   \ncvt \u8868\u793a\u8fdb\u884c\u533a\u95f4 cover \u7684 tag\u3002\n\n \uff08\u533a\u95f4\u5728\u4e0d\u6539\u53d8 $c_i$ \u4e0e $b_i$ \u7684\u5927\u5c0f\u5173\u7cfb\u65f6\u8fdb\u884c cover \u64cd\u4f5c\u4fdd\u8bc1\u590d\u6742\u5ea6\uff09\n   \nmul \u8868\u793a\u5f53 $b_i<c_i$ \u65f6 $b_i$ \u7684\u4e58\u79ef\u3002\n\nct \u8868\u793a\u5f53 $c_i<b_i$ \u65f6 $c_i$ \u7684\u4e2a\u6570\u3002\n\nmxc \u8868\u793a\u533a\u95f4\u6700\u5927\u7684 $c_i$\u3002\n\nmn \u8868\u793a\u5f53 $c_i<b_i$ \u65f6\u533a\u95f4\u6700\u5c0f $b_i$ \u662f\u591a\u5c11\u3002\n\n\u5199\u51fa\u8fd9\u4e9b\u8f6c\u79fb\u5c31\u5f88\u65b9\u4fbf\u4e86\uff0c\u6539\u4e00\u4e2a $a_i$ \u76f8\u5f53\u4e8e\u5728\u7ebf\u6bb5\u6811\u4e8c\u5206\u4e00\u4e2a\u533a\u95f4\u8fdb\u884c\u8986\u76d6\u64cd\u4f5c\u3002\n\n\u5bf9\u4e8e\u5b58\u5728\u53ef\u4ee5\u6539\u53d8\u4f7f\u5f97 $b_i<c_i$ \u65f6\u6211\u4eec\u8fdb\u884c\u9012\u5f52\u64cd\u4f5c\uff0c\u5426\u5219\u533a\u95f4\u8986\u76d6\u3002\n\n\u6ce8\u610f\u5728\u533a\u95f4\u8986\u76d6\u7684\u65f6\u5019\u4f7f\u7528\u5230\u4e86\u5feb\u901f\u5e42\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u4e3a $(n+m)\\log ^2$\u3002\n\n\u4ee5\u4e0b\u662f `rank1` \u4ee3\u7801\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nint read()\n{\n\tchar c;\n\tint w=1;\n\twhile((c=getchar())>'9'||c<'0')if(c=='-')w=-1;\n\tint ans=c-'0';\n\twhile((c=getchar())>='0'&&c<='9')ans=(ans<<1)+(ans<<3)+c-'0';\n\treturn ans*w;\n}\nconst int xx=1e5+5,mod=1e9+7,inf=2e9;\nint n,q,a[xx],b[xx],c[xx];\nll mn[xx<<2],ct[xx<<2],mul[xx<<2],cvt[xx<<2],mxc[xx<<2],ans[xx<<2];\nll ksm(ll a,ll b)\n{\n\tll ans=1;\n\twhile(b)\n\t{\n\t\tif(b&1)ans*=a,ans%=mod;\n\t\ta*=a,a%=mod,b>>=1;\n\t}\n\treturn ans;\n}\nvoid upd(int k)\n{\n\tmn[k]=min(mn[k<<1],mn[k<<1|1]);\n\tmxc[k]=max(mxc[k<<1],mxc[k<<1|1]);\n\tans[k]=ans[k<<1]*ans[k<<1|1]%mod;\n\tct[k]=ct[k<<1]+ct[k<<1|1];\n\tmul[k]=mul[k<<1]*mul[k<<1|1]%mod;\n}\nvoid cv(int k,int z){cvt[k]=z,mxc[k]=z,ans[k]=mul[k]*ksm(z,ct[k])%mod;}\nvoid build(int k,int l,int r)\n{\n\tif(l==r)\n\t{\n\t\tmxc[k]=c[l];\n\t\tif(mxc[k]<b[l])ans[k]=mxc[k],mn[k]=b[l],mul[k]=1,ct[k]=1;\n\t\telse ans[k]=b[l],mn[k]=inf,mul[k]=b[l],ct[k]=0;\n\t\treturn;\n\t}\n\tint mid=l+r>>1;\n\tbuild(k<<1,l,mid);\n\tbuild(k<<1|1,mid+1,r);\n\tupd(k);\n}\nvoid pd(int k)\n{\n\tif(cvt[k])\n\t{\n\t\tcv(k<<1,cvt[k]);\n\t\tcv(k<<1|1,cvt[k]);\n\t\tcvt[k]=0;\n\t}\n}\nint find(int k,int l,int r,int x)\n{\n\tif(l==r)return mxc[k]<=x?l:l-1;\n\tif(mxc[k]<=x)return r;pd(k);\n\tint mid=l+r>>1;\n\tint s=find(k<<1,l,mid,x);\n\tif(s==mid)return find(k<<1|1,mid+1,r,x);\n\treturn s;\n}\nvoid cgc(int k,int l,int r,int x,int y,int z)\n{\n\tif(x>y)return;\n\tif(l==r)\n\t{\n\t\tif(z<b[l])ans[k]=z,mn[k]=b[l],mul[k]=1,ct[k]=1;\n\t\telse ans[k]=b[l],mn[k]=inf,mul[k]=b[l],ct[k]=0;\n\t\tmxc[k]=z;\n\t\treturn;\n\t}\n\tif(x<=l&&r<=y)\n\t\tif(mn[k]>z)return cv(k,z);\n\tpd(k);\n\tint mid=l+r>>1;\n\tif(x<=mid)cgc(k<<1,l,mid,x,y,z);\n\tif(mid<y)cgc(k<<1|1,mid+1,r,x,y,z);\n\tupd(k);\n}\nvoid cgb(int k,int l,int r,int x,int y)\n{\n\tif(l==r)\n\t{\n\t\tb[l]=y;\n\t\tif(mxc[k]<b[l])ans[k]=mxc[k],mn[k]=b[l],mul[k]=1,ct[k]=1;\n\t\telse ans[k]=b[l],mn[k]=inf,mul[k]=b[l],ct[k]=0;\n\t\treturn;\n\t}\n\tpd(k);\n\tint mid=l+r>>1;\n\tif(x<=mid)cgb(k<<1,l,mid,x,y);\n\telse cgb(k<<1|1,mid+1,r,x,y);\n\tupd(k);\n}\nsigned main(){\n\tn=read(),q=read();\n\tfor(int i=1;i<=n;i++)a[i]=read(),c[i]=max(a[i],c[i-1]);\n\tfor(int i=1;i<=n;i++)b[i]=read();\n\tbuild(1,1,n);\n\twhile(q--)\n\t{\n\t\tint op=read(),x=read(),y=read();\n\t\tif(op==0)\n\t\t{\n\t\t\tint s=find(1,1,n,y);\n\t\t\tcgc(1,1,n,x,s,y);\n\t\t}\n\t\telse cgb(1,1,n,x,y);\n\t\tcout<<ans[1]<<\"\\n\";\n\t}\n    return 0;\n}\n```\n\n",
        "postTime": 1631634747,
        "uid": 371852,
        "name": "\u4e00\u5ff5\u4e4b\u95f4\u3001\u3001",
        "ccfLevel": 0,
        "title": "P4891 \u5e8f\u5217"
    },
    {
        "content": "\u53c2\u8003[\u6b64blog](https://www.luogu.com.cn/blog/Mrsrz/solution-p4891),\u8c08\u8c08\u4e2a\u4eba\u7684\u7406\u89e3.\n\n# \u601d\u8def: \n$c$\u660e\u663e\u662f\u4e0d\u4e25\u683c\u9012\u589e\u6570\u5217.\n\n\u5982\u679c$a[x]$\u7684\u66f4\u65b0$(y)$\u80fd\u66f4\u65b0$c[x]$,\u90a3\u4e48\u6211\u4eec\u518d\u8003\u8651\u4e00\u4e0by\u7684\u6700\u8fdc\u5f71\u54cd\u8303\u56f4.\n\n\u8fd9\u4e2a\u53ef\u4ee5\u7528\u5206\u5757\u6c42.\n\n\u4f46\u662f\u8d21\u732e\u7684\u66f4\u65b0\u5c31\u6709\u70b9\u96be\u7ef4\u62a4\u4e86.\n\n\u50cf\u5f80\u5e38\u4e00\u6837,\u6211\u4eec\u8fb9\u89d2\u66b4\u529b,\u5927\u6bb5\u5feb\u901f\u5904\u7406.\n\n\u5047\u5982\u6211\u4eec\u6574\u5757\u7684$c$\u53d8\u4e3a\u4e86$y$,\u7531\u4e8e\u7b54\u6848\u53d6$\\min(b[i],y)$,\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5bf9$b$\u5728\u5757\u5185\u6392\u5e8f,\u8fd9\u6837\u8d21\u732e\u5c31\u5206\u4e24\u5757\u4e86.\n\n\u5bf9\u524d\u90e8\u53d6\u524d\u7f00\u79ef,\u5bf9\u540e\u4e00\u90e8\u5206\u6211\u4eec\u53ef\u4ee5\u5148\u9884\u5904\u7406$P[i]=y^i$(\u5757\u957f$sz$\u590d\u6742\u5ea6),\u7136\u540e\u540e\u4e00\u90e8\u5206$O(1)$.\n\n\u540c\u65f6,\u80fd\u66f4\u65b0$c$\u7684$y$\u4e00\u5b9a\u4f1a\u8d8a\u6765\u8d8a\u5927(\u4e0d\u7136\u5c31\u4e0d\u7528\u66f4\u65b0\u5566)\n\u6240\u4ee5\u5757\u5185\u6ee1\u8db3$b[i]<y$\u7684\u4e0a\u754c\u8d8a\u6765\u8d8a\u5927,\u6570\u91cf\u4e5f\u8d8a\u6765\u8d8a\u591a,\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u4e00\u4e2a\u6307\u9488\u6765\u5b58\u50a8\u540e\u4e00\u90e8\u5206\u7684\u5f00\u5934\u4f4d\u7f6e.\n\n\u8fd9\u6837\u6307\u9488\u7684\u79fb\u52a8\u53ef\u4ee5\u5747\u644a$O(1)$,\u53ea\u6709\u8fb9\u89d2\u5904\u7406$c$\u7684\u65f6\u5019\u8981\u628a\u6307\u9488\u632a\u524d.\n\n\u901a\u8fc7\u4e0a\u9762\u67e5\u8be2\u7684\u5feb\u901f\u5904\u7406\u7684\u65b9\u6cd5,\u6211\u4eec\u4fee\u6539$b$\u7684\u65f6\u5019\u5c31\u9700\u8981$O(\\sqrt n)$\u6765\u7ef4\u62a4\u6709\u5e8f\u7684b.\n\n\u4ece\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u8fd9\u6837\u5c31\u7531\u66b4\u529b\u7684\u67e5\u8be2$O(n)$,\u4fee\u6539$O(1)$\u5f04\u6210\u4e24\u7c7b\u90fd$O(\\sqrt n).$,\u603b\u65f6\u95f4\u590d\u6742\u5ea6$O(n\\log n+m\\sqrt n)$\n\n**\u8fd9\u7ed9\u6211\u4e00\u4e2a\u542f\u53d1,\u5bf9\u4e8e\u4fee\u6539\u548c\u8be2\u95ee\u5728\u66b4\u529b\u4e0a\u7684\u590d\u6742\u5ea6\u4e0d\u7edf\u4e00,\u6211\u4eec\u53ef\u4ee5\u5148\u60f3\u60f3\u5982\u4f55\u5feb\u901f\u7ef4\u62a4\u5927\u590d\u6742\u5ea6\u7684\u90a3\u4e2a,\u7136\u540e\u8ba9\u5c0f\u590d\u6742\u5ea6\u7684\u8fc1\u5c31\u5b83,\u4ece\u800c\u8fbe\u5230\u590d\u6742\u5ea6\u5e73\u8861.\u5982\u672c\u9898\u7531$O(n),O(1)\\rightarrow O(\\sqrt n).$**\n\nPS:\u672c\u4eba\u8c03\u8bd5\u8c03\u534a\u5929,\u539f\u56e0\u7adf\u7136\u662f\u6c42$r$\u7684\u65f6\u5019\u53ea$\\text{break}$\u6389\u4e00\u5c42.\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<iostream>\n#define gc getchar()\n#define ll long long\n#define pos(x) ((x-1)/sz+1) \nusing namespace std;\nconst int N=1e5+10,sz=320,T=sz+11,mod=1e9+7;\n\nvoid qr(int &x) {\n\tchar c=gc; x=0;\n\twhile(!isdigit(c))c=gc;\n\twhile(isdigit(c))x=x*10+c-'0',c=gc;\n}\nvoid qw(ll x) {\n\tif(x/10) qw(x/10);\n\tputchar(x%10+'0');\n}\nvoid pr2(ll x){qw(x); puts(\"\");}\n\nint n,m,t,a[N],b[N],L[T],R[T];\nll ans,P[T];\n\nstruct B {\n\tint L,R,tag,it,len,c[T],mx;\n\tll ans,pre[T];\n\tstruct rec {\n\t\tint v,id;\n\t\tbool operator <(rec b) const {return v<b.v;}\n\t}B[T];\n\tvoid bt(int l,int r) {\n\t\tL=l; R=r; len=r-l+1;\n\t\tans=pre[0]=it=1; tag=-1; \n\t\tfor(int i=l,j=1;i<=r;i++,j++) c[j]=a[i],B[j]=(rec){b[i],i},ans=ans*min(b[i],a[i])%mod;\n\t\tsort(B+1,B+len+1);mx=c[len];\n\t\tfor(int i=1;i<=len;i++) pre[i]=pre[i-1]*B[i].v%mod;\n\t}\n\tvoid lazy() {if(tag!=-1) {for(int i=1;i<=len;i++) c[i]=tag; it=1; tag=-1;}}\n\tvoid change_b(int x) {\n\t\tlazy();//\u8981\u66f4\u65b0\u7b54\u6848\u5fc5\u987b\u4e0b\u653ec\u7684\u6807\u8bb0 \n\t\tint pos=0;\n\t\tfor(int i=1;i<=len&&!pos;i++) if(B[i].id==x) pos=i;\n\t\tB[pos].v=b[x];\n\t\tfor(int i=pos+1;i<=len;i++) if(B[i-1].v>B[i].v) swap(B[i-1],B[i]); else break;\n\t\tans=1; if(it>1) it-=it>=pos;\n\t\tfor(int i=1;i<=len;i++) ans=ans*min(B[i].v,c[B[i].id-L+1])%mod,pre[i]=pre[i-1]*B[i].v%mod;\n\t}\n\tvoid change(int l,int r,int x) {\n\t\tlazy(); l-=L-1; r-=L-1;//\u8981\u66f4\u65b0c\u5c31\u8981\u63d0\u524d\u4e0b\u653e\u6807\u8bb0 \n\t\tfor(int i=l;i<=r;i++) c[i]=x;\n\t\tans=1; mx=c[len];\n\t\tfor(int i=1;i<=len;i++) ans=ans*min(B[i].v,c[B[i].id-L+1])%mod;\n\t}\n\tvoid all(int x) {\n\t\ttag=mx=x;\n\t\twhile(it<=len&&B[it].v<x) it++;\n\t\tans=pre[it-1]*P[len-it+1]%mod;\n\t}\n\tint& operator [](int x) {return tag!=-1?tag:c[x-L+1];}\n}g[T];\n\nint main() {\n\tqr(n); qr(m); t=pos(n);\n\tfor(int i=1;i<=n;i++) qr(a[i]),a[i]=max(a[i],a[i-1]);\n\tfor(int i=1;i<=n;i++) qr(b[i]);\n\tfor(int i=1;i<=t;i++) L[i]=R[i-1]+1,R[i]=i*sz; \t\tR[t]=n;\n\tfor(int i=1;i<=t;i++) g[i].bt(L[i],R[i]);\n\tint op,x,y,p,q,r;\n\twhile(m--) {\n\t\tqr(op); qr(x); qr(y); p=pos(x);\n\t\tif(op) b[x]=y,g[p].change_b(x);\n\t\telse if(g[p][x]<y) {\n\t\t\tq=t; r=n; bool flag=0;\n\t\t\tfor(int i=p;i<=t&&!flag;i++) if(g[i].mx>=y)\n\t\t\t\tfor(int j=L[i];j<=R[i];j++) \n\t\t\t\t\tif(g[i][j]>=y) \n\t\t\t\t\t\t{q=i; r=j-1;flag=1; break;}\n\t\t\tif(p==q) g[p].change(x,r,y);\n\t\t\telse {\n\t\t\t\tg[p].change(x,R[p],y);\n\t\t\t\tif(p+1<q) {\n\t\t\t\t\tP[0]=1;for(int i=1;i<=sz;i++) P[i]=P[i-1]*y%mod;\n\t\t\t\t\tfor(int i=p+1;i<q;i++) g[i].all(y);\n\t\t\t\t}\n\t\t\t\tg[q].change(L[q],r,y);\n\t\t\t}\n\t\t}\n\t\tans=1;\n\t\tfor(int i=1;i<=t;i++) ans=ans*g[i].ans%mod;\n\t\tpr2(ans);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1589501116,
        "uid": 118826,
        "name": "2018LZY",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4891 \u3010\u5e8f\u5217\u3011"
    },
    {
        "content": "\u4f7f\u7528\u7ebf\u6bb5\u6811\uff0c\u7ef4\u62a46\u4e2a\u53d8\u91cf\uff1a\r\n\r\n1. $ans$\uff1a\u533a\u95f4\u79ef\u3002\r\n\r\n2. $mx$\uff1a\u533a\u95f4\u6700\u5927 $c$ \u503c\u3002\r\n\r\n3. $mn$\uff1a\u6ee1\u8db3 $c<b$ \u7684 $b$ \u7684\u6700\u5c0f\u503c\u3002\r\n\r\n4. $cnt$\uff1a $c<b$ \u7684\u70b9\u7684\u4e2a\u6570\u3002\r\n\r\n5. $mul$\uff1a\u6ee1\u8db3 $c\\geq b$ \u7684 $b$ \u7684\u79ef\u3002\r\n\r\n6. $tg$\uff1a\u533a\u95f4\u8986\u76d6\u7684\u6807\u8bb0\u3002\r\n\r\n\u5bf9\u4e8e $b$ \u6570\u7ec4\u7684\u4fee\u6539\u64cd\u4f5c\uff0c\u76f4\u63a5\u4fee\u6539\u5c31\u884c\u4e86\u3002\r\n\r\n\u5bf9\u4e8e $a$ \u6570\u7ec4\u7684\u4fee\u6539\u64cd\u4f5c\uff0c\u7531\u4e8e $c$ \u5355\u8c03\u4e0d\u4e0b\u964d\uff0c\u56e0\u6b64\u5148\u5728\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u627e\u5230\u6700\u53f3\u8fb9\u7684 $c<y$ \u7684\u70b9\uff0c\u7136\u540e\u8fdb\u884c\u533a\u95f4\u8986\u76d6\u3002\r\n\r\n\u66b4\u529b\u8d4b\u503c\u663e\u7136\u4e0d\u884c\uff0c\u8003\u8651\u526a\u679d\uff1a\r\n\r\n\u82e5 $c>b$\uff0c\u7531\u4e8e $y>c$\uff0c\u6240\u4ee5 $\\min(b,c)$ \u4e0d\u53d8\u3002\r\n\r\n\u82e5 $c<y\\leq b$\uff0c\u5219 $\\min(b,c)$ \u53d8\u4e3a $y$\u3002\r\n\r\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e0a\u8ff0\u4e24\u79cd\u60c5\u51b5\u4e2d $b$ \u4e0e $c$ \u7684\u5927\u5c0f\u5173\u7cfb\u4e0d\u53d8\u3002\u82e5\u533a\u95f4\u4e2d\u6240\u6709\u70b9\u90fd\u6ee1\u8db3\u4e0a\u8ff0\u4e24\u79cd\u60c5\u51b5\u4e4b\u4e00\uff0c\u5373 $y\\leq mn$\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5feb\u901f\u4fee\u6539\uff0c\u5373 $ans=mul\\times y^{cnt}$\uff0c\u7136\u540e\u6253\u4e0a\u6807\u8bb0\u3002\r\n\r\n\u65f6\u95f4\u590d\u6742\u5ea6\u8c8c\u4f3c\u6ca1\u53d8\uff1f\r\n\r\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5f53\u4e14\u4ec5\u5f53\u533a\u95f4\u5b58\u5728 $c<b<y$ \u7684\u70b9\u65f6\uff0c\u9700\u8981\u7ee7\u7eed\u9012\u5f52\u3002\u4fee\u6539\u540e\uff0c$c$ \u4e0e $b$ \u7684\u5927\u5c0f\u5173\u7cfb\u53d1\u751f\u53d8\u5316\uff0c\u5373\u5f53\u4e14\u4ec5\u5f53 $c$ \u4e0e $b$ \u7684\u5927\u5c0f\u5173\u7cfb\u4ece $c<b$ \u53d8\u6210 $c>b$ \u65f6\uff0c\u4ea7\u751f $O(\\log n)$ \u7684\u65f6\u95f4\u3002\u7136\u800c\uff0c\u4ec5\u5f53 $b$ \u6570\u7ec4\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u624d\u6709\u53ef\u80fd\u4f7f $c>b$ \u53d8\u56de $c<b$\u3002\u56e0\u6b64\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+q)\\log n)$\u3002\u52a0\u4e0a\u5feb\u901f\u5e42\u4e3a $O((n+q)\\log^2n)$\u3002\r\n\r\n\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\n#define ll long long\r\nusing namespace std;\r\nconst int N=4e5+7,mo=1e9+7,inf=2e9;\r\nint n,Q,opt,x,y,a[N],b[N];\r\nstruct node{\r\n\tint ans,tg,mx,mn,cnt,mul;\r\n}t[N];\r\nint ksm(ll x,int y){ll s=1;for(;y;y>>=1,x=x*x%mo)if(y&1)s=s*x%mo;return s;}\r\nvoid tag(int o,int x)\r\n{\r\n\tt[o].ans=1ll*t[o].mul*ksm(x,t[o].cnt)%mo;\r\n\tt[o].mx=t[o].tg=x;\r\n}\r\nvoid down(int o)\r\n{\r\n\tif(t[o].tg!=-1) tag(o+o,t[o].tg),tag(o+o+1,t[o].tg),t[o].tg=-1;\r\n}\r\nvoid up(int o)\r\n{\r\n\tint ls=o+o,rs=o+o+1;\r\n\tt[o].ans=1ll*t[ls].ans*t[rs].ans%mo;\r\n\tt[o].mn=min(t[ls].mn,t[rs].mn);\r\n\tt[o].mx=max(t[ls].mx,t[rs].mx);\r\n\tt[o].cnt=t[ls].cnt+t[rs].cnt;\r\n\tt[o].mul=1ll*t[ls].mul*t[rs].mul%mo;\r\n}\r\nvoid nnode(node &u,int x,int y)\r\n{\r\n\tu.ans=min(x,y);u.mx=x;u.tg=-1;\r\n\tu.mn=x<y?y:inf;u.cnt=x<y?1:0;u.mul=x>=y?y:1;\r\n}\r\nint find(int l,int r,int o,int c)\r\n{\r\n\tif(l==r) return t[o].mx<c?l:l-1;\r\n\tint mid=l+r>>1;down(o);\r\n\tif(t[o+o].mx>=c) return find(l,mid,o+o,c);\r\n\treturn find(mid+1,r,o+o+1,c);\r\n}\r\nvoid updc(int l,int r,int o,int x,int y,int c)\r\n{\r\n\tif(l==r){nnode(t[o],c,b[l]);return;}\r\n\tif(x<=l&&r<=y&&c<=t[o].mn){tag(o,c);return;}\r\n\tint mid=l+r>>1;down(o);\r\n\tif(x<=mid) updc(l,mid,o+o,x,y,c);\r\n\tif(y>mid) updc(mid+1,r,o+o+1,x,y,c);\r\n\tup(o);\r\n}\r\nvoid updb(int l,int r,int o,int x,int c)\r\n{\r\n\tif(l==r){b[x]=c;nnode(t[o],t[o].mx,c);return;}\r\n\tint mid=l+r>>1;down(o);\r\n\tif(x<=mid) updb(l,mid,o+o,x,c);\r\n\telse updb(mid+1,r,o+o+1,x,c);\r\n\tup(o);\r\n}\r\nvoid bt(int l,int r,int o)\r\n{\r\n\tif(l==r){nnode(t[o],a[l],b[l]);return;}\r\n\tint mid=l+r>>1;t[o].tg=-1;\r\n\tbt(l,mid,o+o);bt(mid+1,r,o+o+1);\r\n\tup(o);\r\n}\r\nint main()\r\n{\r\n\tscanf(\"%d%d\",&n,&Q);\r\n\tfor(int i=1;i<=n;++i) scanf(\"%d\",&a[i]),a[i]=max(a[i],a[i-1]);\r\n\tfor(int i=1;i<=n;++i) scanf(\"%d\",&b[i]);\r\n\tbt(1,n,1);\r\n\twhile(Q--)\r\n\t{\r\n\t\tscanf(\"%d%d%d\",&opt,&x,&y);\r\n\t\tif(opt==1) updb(1,n,1,x,y);\r\n\t\telse\r\n\t\t{\r\n\t\t\tint z=find(1,n,1,y);\r\n\t\t\tif(x<=z) updc(1,n,1,x,z,y);\r\n\t\t}\r\n\t\tprintf(\"%d\\n\",t[1].ans);\r\n\t}\r\n}\r\n```",
        "postTime": 1669011437,
        "uid": 513838,
        "name": "\u5c0f\u5434\u540c\u5b66wtc",
        "ccfLevel": 0,
        "title": "P4891 \u5e8f\u5217 \u9898\u89e3"
    },
    {
        "content": "\n\n------------\n\n\u5173\u4e8e\u8fd9\u4e00\u9053\u9898\u7684\u8bdd\u3002\u3002\u3002\n\n\u6211\u4eec\u5148\u4ece\u9898\u5e72\u770b\u8d77\uff0c\u9898\u76ee\u8981\u6c42\u66f4\u6539A\u5e8f\u5217\u6216\u8005B\u5e8f\u5217\uff0c\u6700\u540e\u6c42\u4e00\u4e2amin\uff08Bi\uff0cCi\uff09\u7684\u603b\u4e58\u79ef\uff0c\u5176\u5b9e\u8981\u4fee\u6539B\u7684\u8bdd\u5f88\u5bb9\u6613\uff0cO(1)\u5373\u53ef\u3002\u4f46\u662f\u8981\u4fee\u6539A\u7684\u8bdd\uff0c\u4f1a\u5bfc\u81f4C\u5e8f\u5217\u5927\u5e45\u6539\u53d8\u3002\u4e8e\u662f\u8fd9\u65f6\u5019\u5c31\u6709\u540c\u5b66\u7ad9\u51fa\u6765\u8bf4\u8981\u7528\u7ebf\u6bb5\u6811\u4e86\uff0c\u4f46\u662f\u7b54\u6848\u662f\u8981\u4e00\u4e2a\u603b\u4e58\u79ef\u7684\uff0c\u5c31\u7b97\u5bf9\u4e8eC\u5e8f\u5217\u7684\u4fee\u6539\u65f6\u95f4\u590d\u6742\u5ea6\u964d\u4e0b\u53bb\u4e86\uff0c\u6c42\u79ef\u7684\u90e8\u5206\u4e5f\u4f1a\u5f88\u96be\u53d7\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u60f3\uff0c\u8981\u662f\u53ef\u4ee5\u7ef4\u62a4\u8fd9\u4e2a\u7b54\u6848\u5c31\u597d\u4e86\uff0c\u7136\u540e\u8fd9\u9053\u9898\u5c31\u53d8\u6210\u4e00\u9053\u7b80\u5355\u7684\u4e58\u6cd5\u9006\u5143\u7248\u5b50\u9898\u4e86\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u5efa\u7acb\u4e00\u4e2amul\u6570\u7ec4\u6765\u7ef4\u62a4\u6bcf\u4e00\u4f4d\u7684min(Bi,Ci),sum\u4e3a\u521d\u59cb\u7684\u7b54\u6848\u3002\n\n\u5728\u4fee\u6539B\u5e8f\u5217\u65f6\uff0c\u6211\u4eec\u76f4\u63a5\u66f4\u6539B[i]\uff0c\u7136\u540e\u5c06\u65b0\u7684min(Bi,Ci)\u4e0e\u539f\u6765\u7684mul[i]\u6bd4\u8f83\uff0c\u82e5\u6709\u4e0d\u540c\uff0c\u5219\u5c06\u539f\u6765\u7684\u9664\u6389\uff0c\u5c06\u65b0\u7684\u4e58\u4e0a\uff0c\u7136\u540e\u66f4\u65b0mul\u6570\u7ec4\u3002\n\n\u5bf9\u4e8eA\u5e8f\u5217\u7684\u4fee\u6539\uff0c\u6211\u4eec\u4ece\u8981\u4fee\u6539\u7684\u7b2ci\u4f4d\u5f00\u59cb\uff0c\u628a\u6bd4\u66f4\u6539\u7684\u503c\u5c0f\u7684C[i]\u5168\u90e8\u66f4\u65b0\u6210\u4fee\u6539\u540e\u7684\u503c\uff0c\u4e4b\u540e\u5c31\u662f\u7167\u846b\u82a6\u753b\u74e2\u3002\u4e0eB\u5e8f\u5217\u4fee\u6539\u4e00\u6837\u7684\u5904\u7406\u65b9\u5f0f\u3002\n\n\u5f53\u7136\uff0c\u8fd9\u9053\u9898\u662f\u8981\u6a21\u7684\uff0c\u7531\u4e8e\u8ba1\u7b97\u4e2d\u6d89\u5acc\u9664\u6cd5\u8fd0\u7b97\uff0c\u4e0d\u80fd\u76f4\u63a5\u6a21\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u8fd0\u7528\u4e58\u6cd5\u9006\u5143\n            \n                 (a/b) mod p == (a*b^(p-2)) mod p\t\n\u4e0b\u9762\u662fAC\u4ee3\u7801\n------------\n\n```\n#include<cstdio>\n#include<algorithm>\nusing namespace std;\nlong long n,q;\nlong long a[100010],b[100010],c[100010],sum=1,mul[100010];\nconst long long mod = 1e9+7;\n\nlong long ksm(long long a){\n\tlong long summ = 1,b = mod-2;\n\twhile(b){\n\t\tif(b&1)summ=(summ*a)%mod;\n\t\ta = (a*a)%mod;\n\t\tb>>=1;\n\t}\n\treturn summ;\n}\n\nint main(){\n\tscanf(\"%lld%lld\",&n,&q);\n\tfor(long long i = 1; i <= n; i++)scanf(\"%lld\",&a[i]);\n\tfor(long long i = 1; i <= n; i++)scanf(\"%lld\",&b[i]);\n\tfor(long long i = 1; i <= n; i++)c[i] = max(c[i-1],a[i]);\n\tfor(long long i = 1; i <= n; i++)sum=(sum*min(c[i],b[i]))%mod,mul[i]=min(c[i],b[i]);\n\twhile(q--){\n\t\tlong long op,id,val;\n\t\tscanf(\"%lld%lld%lld\",&op,&id,&val);\n\t\tif(op==1){\n\t\t\tb[id] = val%mod;\n\t\t\tif(min(c[id],b[id])!=mul[id]){\n\t\t\t\tsum = ((sum*ksm(mul[id])%mod)*min(c[id],b[id]))%mod;\n\t\t\t\tmul[id] = min(c[id],b[id]);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\twhile(c[id]<val){\n\t\t\t\tif(id>n)break;\n\t\t\t\tc[id] = val%mod;\n\t\t\t\tif(min(c[id],b[id])!=mul[id]){\n\t\t\t\t\tsum = ((sum*ksm(mul[id])%mod)*min(c[id],b[id]))%mod;\n\t\t\t\t\tmul[id] = min(c[id],b[id]);\n\t\t\t\t}\n\t\t\t\tid++;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\tprintf(\"%lld\\n\",sum%mod);\n\t}\n}\n```",
        "postTime": 1539596932,
        "uid": 92359,
        "name": "MisakaQAQ",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P4891 \u3010\u5e8f\u5217\u3011"
    }
]