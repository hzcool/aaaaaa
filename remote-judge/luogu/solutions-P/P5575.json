[
    {
        "content": "# \u5b98\u65b9\u9898\u89e3:\u9ed1\u767d\u56fe\n\n\u9996\u5148\u5927\u6982\u770b\u5f97\u51fa\u6765\u8fd9\u662f\u4e2a(\u94fe/\u6811/\u57fa\u73af\u6811)\u4e0a$DP$\u5427?\n\n(~~\u611f\u89c9\u81ea\u5df1\u60f3\u590d\u6742\u4e86,\u4e3a\u4ec0\u4e48\u6ce5\u840c\u7684\u89e3\u6cd5\u90fd\u8fd9\u4e48\u795e\u5947~~)\n\n## #1~#2\n\n\u679a\u4e3e\u9ed1\u767d\u72b6\u6001,\u7b97\u51fa\u76f8\u5e94\u6982\u7387,\u518dbfs\u8ba1\u7b97\u8054\u901a\u5757\u5927\u5c0fk\u6b21\u65b9\u548c\u5373\u53ef\u3002\n\n\u719f\u6089\u671f\u671b\u7684\u5b9a\u4e49\u5c31\u53ef\u4ee5\u5199\u51fa\u6765\u3002\n\n~~\u8fd9\u90fd\u5199\u4e0d\u6765\u529d\u4f60\u522b\u78b0\u8fd9\u9053\u9898\u2026\u2026~~\n\n```cpp\n#include<cstdio>\n#include<vector>\n#define mod 998244353\nusing namespace std;\nint k;\nvector<int> g[55];\nlong long p[55];\nlong long powM(long long a,long long t=mod-2)\n{\n  long long ans=1,buf=a;\n  while(t){\n  \tif(t&1)ans=(ans*buf)%mod;\n  \tbuf=(buf*buf)%mod;\n  \tt>>=1;\n  }return ans;\n}\nvoid addline(int from,int to)\n{\n  g[from].push_back(to);\n  g[to].push_back(from);\n}\nlong long pk[55];\nbool b[55],e[55];\nint dfs(int num)\n{\n  e[num]=1;\n  int tot=1;\n  for (int i=0,v;i<g[num].size();i++)\n   if (!e[g[num][i]]&&b[g[num][i]])\n     tot+=dfs(g[num][i]);\n  return tot;\n}\nlong long ans;\nint n,m;\nvoid dfspre(int pos,long long val)\n{\n  if (pos>n){\n    for (int i=1;i<=n;i++)e[i]=0;\n    long long sum=0;\n    for (int i=1;i<=n;i++)\n      if(!e[i]&&b[i])sum+=pk[dfs(i)];\n    ans=(ans+sum*val)%mod;\n    return ;\n  }b[pos]=0;dfspre(pos+1,val*(1-p[pos]+mod)%mod);\n  b[pos]=1;dfspre(pos+1,val*p[pos]%mod);\n}\nint main()\n{\n  scanf(\"%d%d%d\",&n,&m,&k);\n  for (int i=1;i<=n;i++){\n    scanf(\"%lld\",&p[i]);\n    p[i]=p[i]*powM(100)%mod;\n  }for (int i=1;i<=n;i++)pk[i]=powM(i,k);\n  for (int i=1,from,to;i<=m;i++){\n    scanf(\"%d%d\",&from,&to);\n    addline(from,to);\n  }dfspre(1,1);\n  printf(\"%lld\",ans);\n  return 0;\n}\n```\n\n## 50/50\u7279\u6b8a\u6027\u8d28\n\n\u7559\u7ed9\u90a3\u4e9b\u53ea\u4f1a\u6570\u65b9\u6848\u6570\u7684\u6570\u6570\u9009\u624b(~~\u6211\u60f3\u8fd9\u4e0d\u53ef\u80fd\u6709\u5427~~)\n\n## \u4e00\u6761\u94fe\n\n\u89c1[P1654 OSU!](https://www.luogu.org/problemnew/show/P1654)\n\n\u6240\u4ee5\u8fd9\u9053\u9898\u5c31\u662f\u628aOSU\u4e0a\u4e86\u6811/\u57fa\u73af\u6811\u3002\n\n\u7b80\u5355\u8bb2\u8bb2\u9ad8\u6b21\u671f\u671b\u7684\u5957\u8def:\n\n\u6211\u4eec\u4ece\u94fe\u7684\u5de6\u7aef\u5f00\u59cb:\n\n\u8bbe$f[u][p]$\u4e3a\u5728$u$\u4e4b\u524d$u$\u6240\u5728\u8054\u901a\u5757\u5927\u5c0f\u7684$p$\u6b21\u65b9\u671f\u671b\u3002\n\n$sum[u]$\u4e3a\u5728$u$**\u524d\u9762\u6ca1\u8fde\u4e0a\u7684\u8054\u901a\u5757\u5927\u5c0f\u7684$k$\u6b21\u65b9\u548c\u671f\u671b**\u3002\n\n\u8bbe$x$\u4e3a\u4e0a\u4e00\u4e2a\u8282\u70b9\u7684\u9ed1\u8272\u8fde\u901a\u5757\u5927\u5c0f\u3002\n\n\u5047\u8bbe\u8fd9\u4e00\u4e2a\u8282\u70b9\u4e3a\u9ed1\u8272,\u90a3\u4e48:\n\n$f[i][p]=E((x+1)^p)$,\u8fd9\u5f88\u597d\u7406\u89e3\u3002\n\n\u4f60\u53ef\u80fd\u8bb0\u5f97$E(xy)=E(x)E(y)$,\u6240\u4ee5\u4e0a\u5f0f=$E(x+1)^p$?\n\n\u4e0d,\u8fd9\u4e2a\u6027\u8d28\u53ea\u5f53$x,y$\u662f\u4e24\u4e2a\u4e0d\u76f8\u5173\u53d8\u91cf\u65f6\u624d\u6709\u6548,\u67d0\u4e2a\u53d8\u91cf\u81ea\u4e58\u662f\u4e0d\u80fd\u4f7f\u7528\u8be5\u6cd5\u5219\u62c6\u5206\u7684\u3002\n\n\u6211\u4eec\u4f7f\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00\u4e00\u4e0b\n\n$=E(\\dbinom{0}{p}x^p+\\dbinom{1}{p}x^{p-1}+...+\\dbinom{p-1}{p}x^1+\\dbinom{p}{p}1)$\n\n\u7136\u540e\u6839\u636e$E(x+y)=E(x)+E(y)$\u548c$E(cx)=c\u00b7E(x)$($c$\u4e3a\u5e38\u6570)\n\n$=\\dbinom{0}{p}E(x^p)+\\dbinom{1}{p}E(x^{p-1})...+\\dbinom{p-1}{p}E(x^1)+\\dbinom{p}{p}E(1)$\n\n\u5373$f[i][p]=\\sum\\limits_{t=0}^p\\dbinom{t}{p}f[i-1][t]$\n\n\u8fd9\u5c31\u53ef\u4ee5\u8f6c\u79fb\u4e86\u3002\n\n\u5047\u8bbe\u8fd9\u4e2a\u8282\u70b9\u662f\u767d\u8272,\u90a3\u4e48$sum[i]+=sum[i-1]$\u3002\n\n\u522b\u5fd8\u4e86\u628a\u8d21\u732e\u4e58\u4ee5\u5bf9\u5e94\u6982\u7387\u3002\n\n\u6700\u540e\u7edf\u8ba1\u5f97\u5230:\n\n$$f[i][p]=P[i]\\sum\\limits_{t=0}^p\\dbinom{t}{p}f[i-1][t]$$\n\n$$sum[i]=sum[i-1]+(1-P[i])f[i-1][k]$$\n\n(\u8fd9\u7c7b\u4f3c\u4e8e\u5377\u79ef)\n\n\u603b\u7684\u590d\u6742\u5ea6$O(nk^2)$\n\n\u7b54\u6848\u5c31\u662f$f[n][k]+sum[n]$.\n\n~~\u4ee3\u7801\u5c31\u4e0d\u7ed9\u4e86~~\n\n## \u6811\n\n\u51e0\u4e4e\u4e00\u6837\u7684\u5957\u8def\u3002\n\n\u8bbe$f[u][p]$\u4e3a\u5728$u$\u7684\u5b50\u6811\u4e2d,$u$\u6240\u5728\u8054\u901a\u5757\u5927\u5c0f\u7684$p$\u6b21\u65b9\u671f\u671b\u3002\n\n$sum[u]$\u4e3a\u5728$u$\u7684\u5b50\u6811\u4e2d\u4e0d\u662f$u$\u6240\u5728\u8054\u901a\u5757\u5927\u5c0f\u7684$k$\u6b21\u65b9\u548c\u671f\u671b\u3002\n\n\u6211\u4eec\u53d1\u73b0\u524d\u9762\u7684\u6a21\u578b$E((x+1)^p)$\u53ef\u80fd\u65e0\u6cd5\u9002\u5e94\u8fd9\u79cd\u5e7f\u4e49\u7684\u60c5\u51b5,\u6211\u4eec\u6539\u4e3a$E((x+y)^p)$\u5373\u53ef\u3002\n\n\u6700\u540e\u7684\u5f0f\u5b50\u5c31\u662f:\n\n$$(v\\text{\u662f}u\\text{\u7684\u513f\u5b50})$$\n\n$$\\text{\u521d\u59cb\u503c:}f[u][0]=1$$\n\n$$f[u][p]=\\sum\\limits_{t=0}^p\\dbinom{t}{p}f[u][t]\u00b7f[v][p-t]$$\n\n$$\\text{\u6700\u540e},f[u][p]=P[u]\\sum\\limits_{t=0}^p\\dbinom{t}{p}f[u][t]$$\n\n$$sum[u]=sum[v]+(1-P[u])\\sum\\limits_{v}f[v][k]$$\n\n\u4ee51\u4e3a\u6839$DP$\u7b54\u6848\u5c31\u662f$f[1][k]+sum[1]$\n\n\u503c\u5f97\u6ce8\u610f\u7684\u662f\u6811\u7684\u70b9\u91cc\u9762\u6709\u4e00\u4e2a$k=1$\u7684,\u90a3\u4e48\u628a\u6240\u6709\u6982\u7387\u52a0\u8d77\u6765\u5c31\u597d\u4e86,\u767d\u90018\u5206\u3002\n\n```cpp\n#include<string>\n#include<cstdio>\n#include<vector>\n#define MaxN 200500\n#define mod 998244353\n#define ll long long\nusing namespace std;\ninline int read()\n{\n  int X=0;char ch=0;\n  while(ch<48||ch>57)ch=getchar();\n  while(ch>=48&&ch<=57)X=X*10+(ch^48),ch=getchar();\n  return X;\n}\nint n,k;\nll p[MaxN],f[MaxN][6],sum[MaxN];\nvector<int> g[MaxN];\nvoid addline(int from,int to)\n{\n  g[from].push_back(to);\n  g[to].push_back(from);\n}\nll C[6][6];\nvoid dfs(int num)\n{\n  f[num][0]=1;\n  for (int i=0,v;i<g[num].size();i++)\n   if (!f[v=g[num][i]][0]){\n     dfs(v);\n     sum[num]=(sum[num]+(mod+1-p[num])*f[v][k]+sum[v])%mod;\n     for (int j=k;j;j--){\n       ll sav=0;\n       for (int p=0;p<=j;p++)\n         sav=(sav+C[j][p]*f[num][p]%mod*f[v][j-p])%mod;\n       f[num][j]=sav;\n     }\n   }\n  for (int j=k;j;j--){\n    ll sav=0;\n    for (int p=0;p<=j;p++)\n      sav=(sav+C[j][p]*f[num][p])%mod;\n    f[num][j]=sav*p[num]%mod;\n  }\n}\nint m;\nvoid solve()\n{\n  for (int i=1;i<=n;i++)\n    p[i]=828542813ll*read()%mod;\n  for (int i=1,from;i<n;i++){\n    from=read();\n    addline(from,read());\n  }\n  for (int i=0;i<=k;i++)\n   for (int j=0;j<=i;j++){\n     C[i][j]=1;\n     for (int p=1;p<=i;p++)C[i][j]*=p;\n     for (int p=1;p<=j;p++)C[i][j]/=p;\n     for (int p=1;p<=i-j;p++)C[i][j]/=p;\n   }\n  dfs(1);\n  printf(\"%lld\",(f[1][k]+sum[1])%mod);\n}\nint main()\n{\n  n=read();m=read();k=read();\n  if (n-1==m)solve();\n  return 0;\n}\n```\n\n## \u57fa\u73af\u6811\n\n\u5f00\u59cb\u6bd2\u7624\u4e86\u3002\n\n\u9996\u5148\u628a\u73af\u4e0a\u6302\u7684\u6bcf\u4e00\u68f5\u6811\u5355\u72ec\u505a\u4e00\u6b21$DP$,\u5f97\u5230\u7684$sum$\u503c\u52a0\u5230$ans$\u91cc,\u5176\u4ed6\u7684\u90fd\u653e\u5230\u73af\u4e0a\u3002\n\n\u6211\u4eec\u53d1\u73b0\u524d\u9762\u7684\u6a21\u578b$E((x+1)^p)$\u53ef\u80fd\u65e0\u6cd5\u9002\u5e94\u8fd9\u79cd\u5e7f\u4e49\u7684\u60c5\u51b5,\u6211\u4eec\u6539\u4e3a$E((x+y)^p)$\u5373\u53ef\u3002\n\n\u8bbe$h[i][p]=$\u67d0\u4e00\u68f5\u6811dp\u5b8c\u4e86\u4e4b\u540e\u5f97\u5230\u7684\u8fde\u63a5\u5904$E(x^p)$\u7684\u671f\u671b\u3002\n\n\u6700\u540e\u7684\u5f0f\u5b50\u5c31\u662f:\n\n$$f[i][p]=P[i]\\sum\\limits_{t=0}^p\\dbinom{t}{p}f[i-1][t]\u00b7h[i][p-t]$$\n\n$$sum[i]=sum[i-1]+(1-P[i])f[i-1][k]$$\n\n\u597d\u4e86\u73b0\u5728\u8fd9\u53d8\u6210\u4e86\u4e00\u4e2a\u73af\u4e0a\u7684\u95ee\u9898\u3002\n\n\u5047\u5982\u8fd9\u4e2a\u73af\u4e0a\u6709\u4e00\u4e2a\u70b9\u5fc5\u4e3a\u767d\u8272\u7684\u8bdd,\u5c31\u76f8\u5f53\u4e8e\u628a\u73af\u65ad\u6210\u4e86\u94fe\u3002\n\n\u6211\u4eec\u8003\u8651\u5bb9\u65a5,\u5148\u5047\u8bbe\u7b2c\u4e00\u4e2a\u70b9\u4e3a\u767d\u8272\u3002\n\n\u6211\u4eec\u771f\u7684\u628a\u8fd9\u4e2a\u70b9\u53d8\u4e3a\u767d\u8272,\u5e76\u4e14\u5728\u5b50\u6811\u91cc\u5c40\u90e8$DP$\u7b97\u51fa$f$\u548c$sum$\u3002\n\n\u5176\u4ed6\u7684\u8282\u70b9\u5c31\u53d8\u4e3a\u5e8f\u5217\u95ee\u9898\u4e86,\u94fe\u4e0adp$O(n)$\u641e\u5b9a\u3002\n\n\u90a3\u4e48\u7b2c\u4e00\u4e2a\u70b9\u4e3a\u767d\u8272\u7684\u8d21\u732e\u5c31\u8ba1\u7b97\u5b8c\u6bd5,\u6211\u4eec\u518d\u628a\u7b2c\u4e00\u4e2a\u70b9\u53d8\u4e3a\u4e3a\u9ed1\u8272,\u5e76\u4e14\u518d\u6b21\u5c40\u90e8$DP$\u7b97\u51fa$f$\u548c$sum$\u3002\n\n\u7531\u4e8e\u53ea\u4f1a\u5bf9\u6362\u4e0a\u7684\u6bcf\u4e2a\u8282\u70b9\u5c40\u90e8$dp$\u4e24\u6b21,\u8fd9\u90e8\u5206\u590d\u6742\u5ea6\u662f\u6ca1\u95ee\u9898\u7684\u3002\n\n\u6b64\u65f6\u4e0d\u80fd\u76f4\u63a5\u53d8\u4e3a\u5e8f\u5217\u95ee\u9898,\u6211\u4eec\u518d\u5bf9\u4e0b\u4e00\u4e2a\u70b9\u8ba8\u8bba\u3002\n\n\u2026\u2026\n\n\u6700\u540e,\u6240\u6709\u70b9\u90fd\u53d8\u6210\u4e86\u9ed1\u8272,**\u5219\u53ef\u4ee5\u968f\u4fbf\u65ad\u6389\u4e00\u6761\u8fb9**,\u53cd\u6b63\u8d21\u732e\u6613\u7b97\u3002\n\n**\u6ce8\u610f\u6240\u6709\u8d21\u732e\u90fd\u8981\u4e58\u4ee5\u5bf9\u5e94\u6982\u7387**!!!\n\n\u66b4\u529b\u8dd1\u5e8f\u5217$DP$\u53ef\u4ee5\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898,\u590d\u6742\u5ea6$O(n^2k^2)$\u3002\n\n\u5982\u4f55\u4f18\u5316?\u6ce8\u610f\u5230\u6211\u4eec\u6bcf\u6b21\u53ea\u662f\u5f3a\u5236\u5c06\u4e00\u4e2a\u70b9\u53d8\u9ed1\u6216\u8005\u53d8\u767d,\u5374\u8981\u91cd\u65b0\u94fe\u4e0a$DP$,\u672a\u514d\u6d6a\u8d39\u3002\n\n\u4e8e\u662f\u4e4e\u6211\u4eec\u53ef\u4ee5\u5206\u6790\u4e00\u4e0b\u6027\u8d28\u3002\n\n\u628a\u67d0\u4e2a\u70b9\u53d8\u62100,\u5c31\u662f\u628a\u8fd9\u4e2a\u73af\u65ad\u6210\u4e86\u4e24\u622a\u3002\n\n`11111 0 u...v`\n\n\u56e0\u4e3a\u8fd9\u662f\u4e2a\u73af,\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u6c42\u51fa:\n\n`u...v11111`\u7684\u671f\u671b\u8d21\u732e(\u6ce8\u610f\u62fc\u63a5\u987a\u5e8f)\u3002\n\n`u...v`\u662f\u4e00\u6bb5\u540e\u7f00,\u53ef\u4ee5\u5bf9\u4e8e\u540e\u7f00\u7684$f$\u6765$dp$\u9884\u5904\u7406\u3002\n\n`11111`\u7684\u53ef\u4ee5\u76f4\u63a5\u7b97\u4e86\u3002\n\n\u90a3\u4e48\u7b80\u5355\u7684\u628a\u8fd9\u4e24\u4e2a$f$\u5408\u5e76\u5c31\u597d\u4e86\u5417?\n\n\u5e03\u661f!$f$\u7684\u503c\u4e0e\u66f4\u65b0\u70b9\u7684\u4f4d\u7f6e\u662f\u6709\u5173\u7cfb\u7684!\n\n\u7531\u4e8e\u4ece\u540e\u5f80\u524d\u8ba1\u7b97,`u...v`\u7684\u66f4\u65b0\u70b9\u5728\u5de6\u8fb9,\u6211\u4eec\u7b97\u51fa\u7684\u662f$f[u][]$\u3002\n\n`u...v11111`\u7684\u8bdd\u4e24\u4e2a\u7aef\u53e3\u63a5\u4e0d\u4e0a,\u6ca1\u6cd5\u5408\u5e76\u2026\u2026\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u8981\u8ba1\u7b97\u7684\u662f$f[v][]$\n\n\u89c2\u5bdf\u5230$dp$\u7684\u5f0f\u5b50\u90fd\u662f**\u7ebf\u6027\u8d21\u732e**\u7684,\u4e5f\u5c31\u662f\u8bf4:\n\n\u8bbe `u...v`**\u5de6\u8fb9**\u8ddf\u4e86`....?`,\u5373`....?u...v`\n\n\u5bf9\u4e8e`....?`\u6211\u4eec\u628a$f[?][0...k]$**\u8bbe\u4e3a**$x[0...k]$\n\n\u7531\u4e8e\u7ebf\u6027\u7684\u8d21\u732e,`....?u...v`\u6700\u540e\u7684$f[v][]$\u80af\u5b9a\u662f\n\n$f[v][p]=c_0x[0]+c_1x[1]...+c_px[p]$\n\n\u5176\u4e2d$c$\u662f\u4e00\u4e9b\u5e38\u6570,\u4e0d\u96be\u5f97\u51fa\u8fd9\u4e9b\u5e38\u6570\u662f**\u7531`u...v`\u5177\u4f53\u63a7\u5236\u7684**\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5728\u4e0d\u77e5\u9053`....?`\u7684\u60c5\u51b5\u4e0b,\u8ba1\u7b97\u51fa$c$,\n\n\u7136\u540e\u4efb\u610f\u7ed9\u5b9a\u4e00\u4e9b\u4e1c\u897f**\u63a5\u5728**`u...v`**\u524d\u9762**,\u6211\u4eec\u90fd\u53ef\u4ee5\u5feb\u901f\u7b97\u51fa$dp$\u503c\u3002\n\n\u4e5f\u5c31\u89e3\u51b3\u4e86\u7aef\u70b9\u7684\u95ee\u9898\u3002\n\n\u5982\u4f55$dp$\u6c42$c$\u5462?\n\n\u6211\u4eec\u8bbe$c[u][p][t]$,\u4ee4\u539f\u6765\u7684$f[u][p]=\\sum\\limits_{i=0}^pc[u][p][i]$\n\n\u539f\u6765\u5f0f\u5b50\u91cc\u7684\u52a0\u6cd5\u53d8\u6210\u5217\u5411\u91cf\u52a0\u6cd5\u5c31\u597d,\u6570\u4e58\u53d8\u6210\u5411\u91cf\u6570\u4e58\u3002\n\n\u6709\u4e86\u8fd9\u4e2a\u4e1c\u897f\u6211\u4eec\u53ef\u4ee5\u4e0d\u91c7\u7528\u5f80\u540e\u52a0\u7684\u65b9\u5f0f,\u8fd8\u53ef\u4ee5\u91c7\u7528\u5f80\u524d\u52a0\u7684\u65b9\u5f0f,\u7a81\u7834\u4e86\u7aef\u70b9\u7684\u9650\u5236\u3002\n\n\u6211\u4eec\u5c31\u53ef\u4ee5\u7528$O(nk^3)$\u7684\u4ee3\u4ef7\u7ef4\u62a4\u8fd9\u4e9b\u4e1c\u897f\u4e86\u3002\n\n**Code:**\n\n\u5947\u957f\u65e0\u6bd4\u2026\u2026\n\n\u4e4b\u524d\u7684std\u7206`long long`\u4e86,\u5bfc\u81f4\u4e24\u4e2a\u6570\u636e\u51fa\u9505\u3002\n\n\u8fd9\u91cc\u5bf9\u8d5b\u65f6AC\u7684\u5de8\u4f6c@shdut\u8868\u793a\u6b49\u610f,\u540c\u65f6\u4e5f\u611f\u8c22\u4ed6\u627e\u5230\u4e86\u8fa3\u9e21std\u7684\u9505\u3002\n\n```cpp\n#include<cstdio>\n#include<vector>\n#define MaxN 200500\n#define mod 998244353\n#define ll long long\nusing namespace std;\ninline int read()\n{\n  int X=0;char ch=0;\n  while(ch<48||ch>57)ch=getchar();\n  while(ch>=48&&ch<=57)X=X*10+(ch^48),ch=getchar();\n  return X;\n}\nint n,k;\nll p[MaxN],f[MaxN][6],sum[MaxN];\nvector<int> g[MaxN];\nbool e[MaxN];\nvoid addline(int from,int to)\n{\n  g[from].push_back(to);\n  g[to].push_back(from);\n}\nll C[6][6];int flagp;\n//\u5904\u7406\u5355\u9897\u6811\nvoid dfs1(int num)\n{\n  f[num][0]=1;\n  for (int i=0,v;i<g[num].size();i++)\n    if (!f[v=g[num][i]][0]){\n      dfs1(v);\n      sum[num]=(sum[num]+(mod+1-p[num])*f[v][k]+sum[v])%mod;\n      for (int j=k;j;j--){\n        ll sav=0;\n        for (int p=0;p<=j;p++)\n          sav=(sav+C[j][p]*f[num][p]%mod*f[v][j-p])%mod;\n        f[num][j]=sav;\n      }\n    }\n  if (num!=flagp)\n    for (int j=k;j;j--){\n      ll sav=0;\n      for (int p=0;p<=j;p++)\n        sav=(sav+C[j][p]*f[num][p])%mod;\n      f[num][j]=sav*p[num]%mod;\n    }\n}\nint vis[MaxN],tp,tot,rng[MaxN];\n//\u627e\u73af\nvoid dfs2(int num,int fa)\n{\n  vis[num]=1;\n  for (int i=0,v;i<g[num].size();i++)\n    if ((v=g[num][i])!=fa){\n      if (vis[v]){tp=v;break ;}\n      dfs2(v,num);\n      if (tp||tot)break ;\n    }\n  if (tp)rng[++tot]=num;\n  if (num==tp)tp=0;\n}\nstruct Vec\n{\n  //\u5411\u91cf\u7ed3\u6784\u4f53 \n  ll x[6];\n  inline void clear()\n  {for (int i=0;i<=k;i++)x[i]=0;}\n  Vec operator + (const Vec &B) const{\n    Vec ret;\n    for (int i=0;i<=k;i++)\n      ret.x[i]=(B.x[i]+x[i])%mod;\n    return ret;\n  }\n  Vec operator * (const ll &B) const{\n    Vec ret;\n    for (int i=0;i<=k;i++)\n      ret.x[i]=x[i]*B%mod;\n    return ret;\n  }\n}ff[MaxN][6],s[MaxN];\nll h[MaxN][6],hp[MaxN];\nvoid solve2()\n{\n  //\u627e\u73af \n  dfs2(1,0);\n  rng[0]=rng[tot];\n  rng[tot+1]=rng[1];\n  ll ans=0;\n  //\u5f97\u51fa\u6302\u5728\u73af\u4e0a\u7684\u6bcf\u68f5\u6811\u7684\u4fe1\u606f \n  for (int i=1;i<=tot;i++){\n  \tf[flagp=rng[i]][0]=0;\n  \tf[rng[i-1]][0]=f[rng[i+1]][0]=1;\n  \tdfs1(rng[i]);\n  \tans=(ans+sum[rng[i]])%mod;\n  \thp[i]=p[rng[i]];\n  \tfor (int j=0;j<=k;j++)\n\t    h[i][j]=f[rng[i]][j];\n  }\n  \n  //\u6b63\u5e8f\u9884\u5904\u7406 \n  for (int i=0;i<=k;i++)ff[0][i].x[i]=1;\n  for (int i=1;i<=tot;i++){\n    ff[i][0].x[0]=1;\n    s[i]=s[i]+ff[i-1][k]*(mod+1-hp[i])+s[i-1]; \n    for (int j=k;j;j--){\n      Vec sav; sav.clear();\n      for (int p=0;p<=j;p++)\n        sav=sav+ff[i-1][j-p]*C[j][p]*h[i][p];\n      ff[i][j]=sav;\n    }\n    for (int j=k;j;j--){\n      Vec sav; sav.clear();\n      for (int p=0;p<=j;p++)\n        sav=sav+ff[i][p]*C[j][p];\n      ff[i][j]=sav*hp[i];\n    }\n  }\n  for (int i=0;i<=tot;i++)\n    for (int j=0;j<=k;j++)\n      s[i].x[j]=(s[i].x[j]+ff[i][k].x[j])%mod;\n  \n  //\u5012\u5e8f\u5bb9\u65a5,buf\u662f\u5bf9\u5e94\u6982\u7387,pp\u662f\u5c06\u8981\u62fc\u63a5\u7684\u4fe1\u606f \n  ll pp[6],buf=1; pp[0]=1;\n  for (int i=1;i<=k;i++)pp[i]=0;\n  for (int i=tot;i;i--){\n    ll savbuf=buf;\n    buf=buf*(mod+1-hp[i])%mod;\n    ll sav=0;\n    for (int j=0;j<=k;j++)\n      sav=(sav+pp[j]*s[i-1].x[j])%mod;\n    ans=(ans+buf*sav)%mod;\n    //\u8d21\u732e \n    buf=savbuf*hp[i]%mod;\n\n    for (int j=k;j;j--){\n      ll sav=0;\n      for (int p=0;p<=j;p++)\n        sav=(sav+C[j][p]*pp[j-p]%mod*h[i][p])%mod;\n      pp[j]=sav;\n    }\n    for (int j=k;j;j--){\n      ll sav=0;\n      for (int p=0;p<=j;p++)\n        sav=(sav+C[j][p]*pp[p])%mod;\n      pp[j]=sav;\n    }\n  }//\u6700\u540e\u53d8\u6210\u4e00\u6574\u4e2a\u73af\u7684\u60c5\u51b5 \n  ans=(ans+pp[k]*buf)%mod;\n  printf(\"%lld\\n\",ans);\n}\nint m;\nint main()\n{\n  n=read();m=read();k=read();\n  for (int i=1;i<=n;i++)\n    p[i]=828542813ll*read()%mod;\n  for (int i=1,from;i<=m;i++){\n    from=read();\n    addline(from,read());\n  }\n  for (int i=0;i<=k;i++)\n    for (int j=0;j<=i;j++){\n      C[i][j]=1;\n      for (int p=1;p<=i;p++)C[i][j]*=p;\n      for (int p=1;p<=j;p++)C[i][j]/=p;\n      for (int p=1;p<=i-j;p++)C[i][j]/=p;\n    }\n  if (m==n-1){\n    dfs1(1);\n    printf(\"%lld\",(f[1][k]+sum[1])%mod);\n  }else solve2();\n  return 0;\n}\n```",
        "postTime": 1570012311,
        "uid": 58705,
        "name": "command_block",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5575 \u3010[CmdOI2019]\u9ed1\u767d\u56fe\u3011"
    }
]