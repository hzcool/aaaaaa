[
    {
        "content": "### [\u6b64\u9898\u535a\u5ba2\u4f20\u9001\u95e8qwq](https://www.cnblogs.com/LLTYYC/p/10747067.html)\n\u9996\u5148\u9700\u8981\u61c2\u5f97$01$\u89c4\u5212\n\n\u8003\u8651\u5148\u5c06\u6bcf\u4e00\u79d1\u6309 $t/p$ \u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u679a\u4e3e\u6bcf\u4e00\u4e2a $D$\uff08\u5220\u9664\u7684\u8003\u8bd5\u6570\u91cf\uff09\n\n\u663e\u7136\u4e00\u5f00\u59cb\u7684\u6210\u7ee9\u662f $\\frac{\\sum_{i=d+1}^nt[i]}{\\sum_{i=d+1}^{n}p[i]}$\uff0c\u8bbe\u5b83\u4e3a $st[D]/sp[D]$\n\n\u7136\u540e\u6839\u636e$01$\u89c4\u5212\u7684\u5957\u8def\u8003\u8651\u628a\u6240\u6709\u7684\u6210\u7ee9 $t[i]$ \u51cf\u53bb $st[D]/sp[D]*p[i]$\n\n\u8fd9\u6837\u505a\u4e86\u4ee5\u540e\uff0c\u5982\u679c\u53ef\u4ee5\u4f7f\u6210\u7ee9\u66f4\u4f18\uff0c\u90a3\u4e48\u8bf4\u660e\u533a\u95f4 $[d+1,n]$ \u7684 $t[i]$ \u7684\u6700\u5c0f\u503c\u5c0f\u4e8e\u533a\u95f4 $[1,d]$ \u7684 $t[i]$ \u7684\u6700\u5927\u503c\n\n\uff08\u5c31\u662f\u8bf4\u6211\u4eec\u672c\u6765\u53ef\u4ee5\u9009\u4e00\u4e2a\u533a\u95f4 $[1,d]$ \u7684\u66f4\u4f18\u7684\u6570\uff0c\u4f46\u662f\u88ab\u5220\u6389\u4e86\uff09\n\n\u7136\u540e\u5c31\u6709\u4e00\u4e2a $n^2$ \u7684\u7b97\u6cd5\uff0c\u679a\u4e3e $D$\uff0c\u7136\u540e\u628a $t$ \u6309\u5957\u8def\u64cd\u4f5c\uff0c\u7136\u540e\u6c42 $[1,d]$ \u533a\u95f4\u6700\u5927\u503c\uff0c$[d+1,n]$ \u533a\u95f4\u6700\u5c0f\u503c\uff0c\u6bd4\u8f83\u4e00\u4e0b\u5c31\u597d\u4e86\n\n\u63a5\u4e0b\u6765\uff0c\u53d1\u73b0\u6709\u5f88\u591a\u4e1c\u897f\u662f\u5197\u4f59\u7684\uff0c\u6ca1\u6709\u5fc5\u8981\u6bcf\u6b21\u90fd\u91cd\u65b0\u7b97\uff0c\u8003\u8651 $D$ \u7684\u53d8\u5316\u4ea7\u751f\u7684\u5f71\u54cd\n\n\u60f3\u60f3\u524d\u9762\u679a\u4e3e\u5b8c\u4e00\u4e2a $D$ \u4e86\u4ee5\u540e\u8981\u5e72\u561b\uff0c\u6c42\u533a\u95f4 $[d+1,n]$ \u7684 $t[i]-st[D]/sp[D]*p[i]$ \u7684\u6700\u5c0f\u503c\uff0c\n\n\u6c42\u533a\u95f4 $[1,d]$ \u7684 $t[i]-st[D]/sp[D]*p[i]$ \u7684\u6700\u5927\u503c\u3002\n\n\u8bbe $f[i]$ \u8868\u793a\u533a\u95f4 $[1,d]$\uff0c$t$ \u53d8\u6362\u540e\u7684\u6700\u5927\u503c\uff0c\u90a3\u4e48\u663e\u7136 \n\n$f[i]=max(t[j]-st[i]/sp[i]*p[j])\\ ,\\ j \\in [1,d]$\uff0c\n\n\u53d1\u73b0\u597d\u50cf\u53ef\u4ee5\u659c\u7387\u4f18\u5316\uff1f\n\n$st[i]/sp[i]*p[j]+f[i]=t[j]$\uff0c\u90a3\u4e48 \n\n$k=st[i]/sp[i],x=p[j],b=f[i],y=t[j] $\uff0c\n\n\u539f\u5f0f\u5c31\u53d8\u6210\u4e86 $kx+b=y$ \u7684\u5f62\u5f0f\uff0c\u53ef\u4ee5\u659c\u7387\u4f18\u5316\uff01\n\n\u540c\u6837\u7684\u8bbe $g[i]$ \u8868\u793a\u533a\u95f4 $[i+1,n]$\uff0c$t$ \u53d8\u6362\u540e\u7684\u6700\u5c0f\u503c\uff0c\u90a3\u4e48 \n\n$g[i]=min(t[j]-st[i]/sp[i]*p[j]),\\ j \\in [i+1,n]$\uff0c\u540c\u6837\u53ef\u4ee5\u659c\u7387\u4f18\u5316\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u968f\u7740 $i$ \u7684\u589e\u52a0 $k=st[i]/sp[i]$ \u662f\u4e0d\u964d\u7684\uff0c\u4f46\u662f\u663e\u7136 $x$ \u662f\u4e0d\u5355\u8c03\u7684\n\n\u6240\u4ee5\u6211\u65e0\u8111\u5f3a\u884c\u4e0a\u4e86\u4e24\u904d $CDQ$ \u6c42 $f$ \u548c $g$\uff0c\u8c8c\u4f3c\u6709 $O(n)$ \u7528 $Graham$ \u7ef4\u62a4\u51f8\u5305\u7684\u66f4\u4f18\u89e3\u6cd5\uff1f\n\n\u6700\u540e\u679a\u4e3e $D$ \uff0c\u6bd4\u8f83\u4e00\u4e0b $f[d]$ \u548c $g[d]$ \u7684\u5927\u5c0f\u5173\u7cfb\u5c31\u597d\u5566\n\n\u5177\u4f53\u53ef\u4ee5\u770b\u4ee3\u7801\u6765\u7406\u89e3\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cmath>\n#include<cstring>\n#include<vector>\nusing namespace std;\ntypedef long long ll;\ntypedef double db;\ninline int read()\n{\n    int x=0,f=1; char ch=getchar();\n    while(ch<'0'||ch>'9') { if(ch=='-') f=-1; ch=getchar(); }\n    while(ch>='0'&&ch<='9') { x=(x<<1)+(x<<3)+(ch^48); ch=getchar(); }\n    return x*f;\n}\nconst int N=2e5+7;\nconst ll INF=1e18;\nint n,st[N],sp[N];\ndb f[N],g[N];\nstruct nod {//\u5b58\u6bcf\u4e00\u79d1\u7684\u6570\u636e \n    int p,t;//\u5206\u6bcd\uff0c\u5206\u5b50 \n    inline bool operator < (const nod &tmp) const {//\u6309\u5206\u5b50\u9664\u5206\u6bcd\u6392\u5e8f \n        return t*tmp.p<tmp.t*p;//\u907f\u514d\u9664\u6cd5\uff0c\u7528\u7b49\u4ef7\u7684\u4e58\u6cd5\u662f\u597d\u4e60\u60ef \n    }\n}d[N];\nstruct Poi {//\u659c\u7387\u4f18\u5316\u7684\u70b9 \uff08\u6216\u5411\u91cf\uff09 \n    int x,y;\n    Poi (int x=0,int y=0) : x(x) , y(y) {}\n    inline Poi operator - (const Poi &tmp) const {//\u70b9\u51cf\u70b9\u5c31\u662f\u5411\u91cf\uff0c\u7528\u5411\u91cf\u7ef4\u62a4\u51f8\u5305\u53ef\u4ee5\u907f\u514d\u7cbe\u5ea6\u95ee\u9898\uff0c\u901f\u5ea6\u4e5f\u5feb \n        return Poi(x-tmp.x,y-tmp.y);\n    }\n}T[N],tmp[N];\nint Q[N];//\u5b58\u5f53\u524d\u51f8\u5305 \ninline ll Cross(Poi A,Poi B) { return 1ll*A.x*B.y-1ll*B.x*A.y; }//\u5411\u91cf\u53c9\u79ef\u7ef4\u62a4\u51f8\u5305 \ninline db calc(int i,int j) { return 1.0*T[j].y-1.0*st[i]/sp[i]*T[j].x; }//\u8ba1\u7b97dp\u503c \ninline void merge(int l,int r,int mid)//\u6309x\u5f52\u5e76\u6392\u5e8f \n{\n    int pl=l,pr=mid+1;\n    for(int p=l;p<=r;p++)\n    {\n        if( pl<=mid && (pr>r||T[pl].x<T[pr].x) ) tmp[p]=T[pl++];\n        else tmp[p]=T[pr++];\n    }\n    for(int p=l;p<=r;p++) T[p]=tmp[p];\n}\nvoid CDQ_f(int l,int r)//CDQ\u6c42f\uff0c\u6c42i\u5c5e\u4e8e[l,r]\u7684f[i]\u503c  \n{\n    if(l==r) { f[l]=max(f[l],calc(l,l)); return; }//\u5f53\u524d\u533a\u95f4\u53ea\u6709\u4e00\u4e2a\u70b9\u4e86\uff0c\u7528\u81ea\u5df1\u66f4\u65b0\u81ea\u5df1 \n    int mid=l+r>>1,L=1,R=0;\n    CDQ_f(l,mid);//\u5148\u5904\u7406\u5de6\u8fb9[l,mid]\u7684\u6240\u6709f \n    //\u6b64\u65f6\u5de6\u8fb9\u6240\u6709\u70b9\u5df2\u7ecf\u6309x\u6392\u597d\u5e8f\u4e86 \n    for(int i=l;i<=mid;i++)//\u7ef4\u62a4\u5de6\u8fb9\u6240\u6709\u70b9\u7684\u51f8\u5305 \n    {\n        while( L<R && Cross(T[i]-T[Q[R-1]],T[Q[R]]-T[Q[R-1]])<=0 ) R--; \n        Q[++R]=i;\n    }\n    for(int i=mid+1;i<=r;i++)//\u659c\u7387\u6709\u5e8f\uff0c\u76f4\u63a5\u7528\u521a\u521a\u7ef4\u62a4\u597d\u7684\u51f8\u5305\u66f4\u65b0[mid+1,r]\u7684f \n    {\n        while( L<R && calc(i,Q[R-1])>=calc(i,Q[R]) ) R--;\n        int j=Q[R]; f[i]=max(f[i],calc(i,j));\n    }\n    CDQ_f(mid+1,r); merge(l,r,mid);//\u5904\u7406\u5b8c\u8bb0\u5f97\u6309x\u6392\u5e8f \n}\nvoid CDQ_g(int l,int r)//\u5904\u7406g\u540c\u7406 \n{\n    if(l==r) return;//\u6ce8\u610fg[i]\u7684\u533a\u95f4\u4e0d\u5305\u542bi (i<j<=n)\n    int mid=l+r>>1,L=1,R=0;\n    CDQ_g(mid+1,r);//\u6ce8\u610f\u73b0\u5728\u662f\u5148\u5904\u7406\u53f3\u8fb9\u7684g\u4e86 \n    for(int i=mid+1;i<=r;i++)//\u7ef4\u62a4\u53f3\u8fb9\u7684\u51f8\u5305 \n    {\n        while( L<R && Cross(T[i]-T[Q[R-1]],T[Q[R]]-T[Q[R-1]])>=0 ) R--;\n        Q[++R]=i;\n    }\n    for(int i=l;i<=mid;i++)//\u66f4\u65b0\u5de6\u8fb9 \n    {\n        while( L<R && calc(i,Q[L])>=calc(i,Q[L+1]) ) L++;\n        int j=Q[L]; g[i]=min(g[i],calc(i,j));\n    }\n    CDQ_g(l,mid); merge(l,r,mid);//\u540c\u6837\u8bb0\u5f97merge \n}\nvector <int> ans;//\u7ef4\u62a4\u7b54\u6848 \nint main()\n{\n    n=read();\n    for(int i=1;i<=n;i++) d[i].t=read(),d[i].p=read();\n    sort(d+1,d+n+1);//\u5148\u6309t/p\u6392\u5e8f \n    for(int i=n-1;i;i--) { st[i]=st[i+1]+d[i+1].t; sp[i]=sp[i+1]+d[i+1].p; }//\u6c42\u51fast,sp \n    for(int i=1;i<=n;i++)\n    {\n        T[i]=Poi(d[i].p,d[i].t);//\u521d\u59cb\u5316\u70b9 \n        f[i]=-INF; g[i]=INF;//\u6ce8\u610f\u521d\u59cb\u503c \n    }\n    //\u659c\u7387\u6709\u5e8f\n    CDQ_f(1,n);\n    for(int i=1;i<=n;i++) T[i]=Poi(d[i].p,d[i].t);//\u8bb0\u5f97\u8fd8\u539f\u56de\u521d\u59cb\u503c \n    CDQ_g(1,n);\n    for(int i=1;i<=n;i++)//\u679a\u4e3ed,\u66f4\u65b0ans \n        if(f[i]>g[i]) ans.push_back(i);\n    int len=ans.size();\n    printf(\"%d\\n\",len);\n    for(int i=0;i<len;i++) printf(\"%d\\n\",ans[i]);\n    return 0;\n}\n\n/*\n    f[i]=T[j]-st[i]/sp[i]*P[j] j<=i\n    st[i]/sp[i]*P[j]+f[i]=T[j] j<=i\n    k=st[i]/sp[i],x=P[j],b=f[i],y=T[j]\n    max,\u7ef4\u62a4\u4e0a\u51f8\u5305\n    g[i]=T[j]-st[i]/sp[i]*P[j] j>i\n    st[i]/sp[i]*P[j]+g[i]=T[j] j>i\n    min,\u7ef4\u62a4\u4e0b\u51f8\u5305\n*/\n```\n",
        "postTime": 1555854197,
        "uid": 34274,
        "name": "javalyc",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2877 \u3010[USACO07JAN]\u725b\u6821Cow School\u3011"
    },
    {
        "content": "# \u9898\u89e3 P2877 \u3010[USACO07JAN]\u725b\u6821Cow School\u3011\n\n[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P2877)\n\n\u8fd9\u9053\u9898\u53ef\u4ee5\u752801\u89c4\u5212\u52a0\u51b3\u7b56\u5355\u8c03\u6027\u5206\u6cbb\u6765\u505a\u3002\n\n[\u4ec0\u4e48\u662f01\u89c4\u5212\uff08\u8f6c\uff09](https://blog.csdn.net/hzoi_ztx/article/details/54898323)\n\n\u800c\u51b3\u7b56\u6027\u5206\u6cbb\u53ef\u4ee5\u89e3\u51b3\uff08\u4e14\u4e0d\u9650\u4e8e\uff09\u4e00\u4e9b\u659c\u7387\u4f18\u5316\u95ee\u9898\u3002\n\n~~\u5177\u4f53\u8bc1\u660e\u53ef\u4ee5\u6253\u8868\u3002~~\n\n\u6211\u4eec\u7528\n$ask(l,r,dl,dr)$\n\u8868\u793a\u5904\u7406\u533a\u95f4\n$[l,r]$\n\u65f6\uff0c\u8fd9\u6bb5\u533a\u95f4\u7684\u51b3\u7b56\u70b9\u5df2\u56fa\u5b9a\u5728\n$[dl,dr]$\n\u4e2d\n\u8bbe\n$mid=(l+r)/2$\n\uff0c\u66b4\u529b\u5904\u7406\n$mid$\n\u7684\u6700\u4f18\u51b3\u7b56\u70b9\n$dm$\n\u518d\u5411\u4e0b\u5206\u6cbb$ask(l,mid\u22121,dl,dm)$\uff0c\n$ask(mid+1,r,dm,dr)$\n\u5bf9\u4e8e\u672c\u9898\uff0c\u5148\u6309\n$t[i]/p[i]$\n\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff0c\u6392\u5e8f\u540e\u7684\u9ed8\u8ba4\u65b9\u6848\uff08\u5220\u6389\u540eD\u4e2a\uff09\u5373\u4e3a\n\u53d6\u533a\u95f4\n[1,n\u2212D]\n\uff0c\u820d\u53bb\u533a\u95f4\n[n\u2212D+1,D]\n\n\u90a3\u4e48\u5982\u4f55\u6c42\u6700\u4f18\u89e3\u53fb\uff1f\n\n\u6839\u636e01\u89c4\u5212\u57fa\u672c\u601d\u8def\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u8bbe\nr=st[i]/sp[i]\n\uff08\n$st[i],sp[i]$\n\u4e3a\u6392\u5e8f\u540e\n$t,p$\n\u7684\u524d\u7f00\u548c\uff09\n\u5728\n[1,n\u2212D]\n\u4e2d\u627e\u5230A=mint[i]\u2212r\u2217p[i]\n,\u5728[n\u2212D+1,n]\n\u4e2d\u627e\u5230 B=maxt[i]\u2212r*p[i]\n\u5982\u679c\n$A<B$\n\uff0c\u90a3\u4e48\u4ea4\u6362$A,B$\u53ef\u4ee5\u4f7f\u7b54\u6848\u66f4\u4f18\uff0c\u5373\u9ed8\u8ba4\u65b9\u6848\u4e0d\u662f\u6700\u4f73\u65b9\u6848\n\u4e8e\u662f\u5c31\u53ef\u4ee5\u5206\u6cbb\u5904\u7406\u8fa3\n\u590d\u6742\u5ea6\n$O(nlogn)$\n\n\u4e0a\u4ee3\u7801~\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\ntypedef long long ll;\n#define N 50005\nstruct data{ll t,p;}a[N];\nint n,ans; ll f[N],g[N],st[N],sp[N];\ninline bool cmp(data A,data B){return A.t*B.p>A.p*B.t;}\nvoid getf(int l,int r,int dl,int dr){\n    int mid=(l+r)>>1,dm;\n    f[mid]=1e16;\n    for(int i=dl;i<=min(mid,dr);++i){\n        ll tt=sp[mid]*a[i].t-st[mid]*a[i].p;\n        if(tt<f[mid]) f[mid]=tt,dm=i;\n    }\n    if(l<mid) getf(l,mid-1,dl,dm);\n    if(r>mid) getf(mid+1,r,dm,dr);\n}\nvoid getg(int l,int r,int dl,int dr){\n    int mid=(l+r)>>1,dm;\n    g[mid]=-1e16;\n    for(int i=dr;i>=max(mid+1,dl);--i){\n        ll tt=sp[mid]*a[i].t-st[mid]*a[i].p;\n        if(tt>g[mid]) g[mid]=tt,dm=i;\n    }\n    if(l<mid) getg(l,mid-1,dl,dm);\n    if(r>mid) getg(mid+1,r,dm,dr);\n}\nint main(){\n    scanf(\"%d\",&n);\n    for(int i=1;i<=n;++i) scanf(\"%lld%lld\",&a[i].t,&a[i].p);\n    sort(a+1,a+n+1,cmp);\n    for(int i=1;i<=n;++i) st[i]=a[i].t+st[i-1],sp[i]=a[i].p+sp[i-1];\n    getf(1,n-1,1,n); getg(1,n-1,1,n);\n    for(int i=1;i<n;++i) if(f[i]<g[i]) ++ans;\n    printf(\"%d\\n\",ans);\n    for(int i=n-1;i;--i) if(f[i]<g[i]) printf(\"%d\\n\",n-i);\n    return 0;\n}\n```\n\u840c\u65b0\u6c42\u8d5e\uff0cQwQ",
        "postTime": 1582364238,
        "uid": 225703,
        "name": "jyz666",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2877 \u3010[USACO07JAN]\u725b\u6821Cow School\u3011"
    },
    {
        "content": "\u597d\u5427\uff0c\u5c45\u7136\u6ca1\u4eba\u53d1\u9898\u89e3\uff1f\uff1f\uff1f~~\u849f\u84bb\u8868\u793a\u5f88\u4e0d\u89e3~~\n\n# \u6b63\u5f0f\u5f00\u59cb\uff01Cow School \u5206\u6570\u89c4\u5212\n\n\u8fd9\u4e2a\u9898\u76ee\u96be\u5ea6\u975e\u5e38\u5927\uff0c\u9996\u5148\u5bf9\u4e8e\u8001\u5e08\u7684\u4e00\u79cd\u65b9\u6848\uff0c\u5e94\u7528\u5206\u6570\u89c4\u5212\u7684\u4e00\u822c\u505a\u6cd5\uff0c\u6c42\u51fa\u6240\u6709\u7684c=t-rate*p\uff0c\u5982\u679c\u6ca1\u6709\u9009\u62e9\u7684c\u503c\u4e2d\u7684\u6700\u5927\u503c\u6bd4\u9009\u62e9\u4e86\u7684c\u503c\u4e2d\u7684\u6700\u5c0f\u503c\u5927\uff0c\u90a3\u4e48\u8fd9\u4e2a\u89e3\u662f\u53ef\u4ee5\u6539\u8fdb\u7684\u3002\n\n\u90a3\u4e48\u95ee\u9898\u5c31\u8f6c\u5316\u6210\u4e86\u600e\u4e48\u6c42\u6700\u5c0f\u7684c\u548c\u6700\u5927\u7684c\u3002\n\nt-rate*p \u6c42\u8fd9\u79cd\u7c7b\u578b\u7684\u6700\u503c\uff0c\u5e76\u4e14rate\u662f\u5355\u8c03\u7684\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8003\u8651\u5229\u7528\u659c\u7387\u4f18\u5316\u7684\u90a3\u79cd\u529e\u6cd5\u6765\u7ef4\u62a4\u51b3\u7b56\u70b9\u3002\n\n\u8003\u8651\u4e24\u4e2a\u51b3\u7b56\u70b9\uff0c\u5f97\u5230ti-tj>rate(pi-pj)  \u4f46\u662f\u8fd9\u4e2api pj\u7684\u5927\u5c0f\u4e0d\u80fd\u786e\u5b9a\uff0c\u6211\u4eec\u77e5\u9053\u53ef\u4ee5\u5229\u7528\u659c\u7387\u4f18\u5316\u7684\u95ee\u9898\u4e0d\u4ec5\u4ec5\u8981rate\u5355\u8c03\uff0c\u8fd8\u9700\u8981pi \u5355\u8c03 \u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u9700\u8981\u5229\u7528\u9898\u76ee\u4e2d\u7684\u6761\u4ef6\uff0c\u9898\u76ee\u4e2d\u4fdd\u8bc1\u4e86t/p\u5355\u8c03\uff0c\u6839\u636e\u8fd9\u4e2a\u6761\u4ef6\uff0c\u53ef\u4ee5\u63a8\u51fa\u6c42\u4e24\u79cd\u6700\u503c\u7684\u65f6\u5019\u90fd\u53ea\u6709\u5355\u8c03\u7684p\u624d\u662f\u6709\u53ef\u80fd\u6210\u4e3a\u51b3\u7b56\u70b9\u7684\u3002\u90a3\u4e48\u5c31\u53ef\u4ee5\u6309\u7167\u659c\u7387\u4f18\u5316\u6b65\u9aa4\u6765\u89e3\u9898\u4e86\u3002\u4e00\u4e2a\u662f\u7528\u5355\u8c03\u6808\u7ef4\u62a4\uff0c\u53e6\u5916\u4e00\u4e2a\u5229\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\nconst int maxn=5e4+9;\ndouble high[maxn],low[maxn];\nlong long sumt[maxn],sump[maxn];\nstruct D\n{\n    long long t,p;\n    bool operator <(const D & xx) const\n    {\n        return t*xx.p>xx.t*p;\n    }\n}test[maxn];\nint que[maxn];\n \nbool chk(int i,int j,int t,int s)\n{\n    long long a=(test[i].t-test[j].t)*(test[t].p-test[s].p);\n    long long b=(test[t].t-test[s].t)*(test[i].p-test[j].p);\n    return a>b;\n}\n \nbool chk2(int i,int j,long long t,long long p)\n{\n    long long a=(test[i].t-test[j].t)*p;\n    long long b=t*(test[i].p-test[j].p);\n    return a>b;\n}\nint main()\n{\n    int n;\n    while(scanf(\"%d\",&n)!=EOF)\n    {\n        for(int i=1;i<=n;i++)\n        scanf(\"%lld %lld\",&test[i].t,&test[i].p);\n        sort(test+1,test+1+n);\n \n        for(int i=1;i<=n;i++)\n        {\n            sumt[i]=sumt[i-1]+test[i].t;\n            sump[i]=sump[i-1]+test[i].p;\n        }\n \n        int front=1,end=0;\n        for(int i=1;i<=n;i++)\n        {\n            while(end>=front&&test[i].p>=test[que[end]].p)\n            end--;\n            while(end>front&&chk(que[end],i,que[end-1],que[end]))\n            end--;\n            que[++end]=i;\n            while(front<end&&chk2(que[front],que[front+1],sumt[i],sump[i])==1)\n            front++;\n            int u=que[front];\n            low[i]=test[u].t-(double)sumt[i]/sump[i]*test[u].p;\n        }\n        int top=0;\n        for(int i=n;i>=1;i--)\n        {\n            while(top>0&&test[i].p<=test[que[top]].p)\n            top--;\n            while(top>1&&chk(i,que[top],que[top],que[top-1]))\n            top--;\n            que[++top]=i;\n            while(top>1&&chk2(que[top],que[top-1],sumt[i-1],sump[i-1])==0)\n            top--;\n            int u=que[top];\n            high[i]=test[u].t-(double)sumt[i-1]/sump[i-1]*test[u].p;\n        }\n        int ans=0;\n        for(int i=1;i<n;i++)\n        if(high[i+1]>low[i])\n        ans++;\n        cout<<ans<<endl;\n        for(int i=n-1;i>=1;i--)\n        if(high[i+1]>low[i])\n        printf(\"%d\\n\",n-i);\n    }\n    return 0;\n}\n\n```\n\n\u539f\u6587\uff1a[haha](https://blog.csdn.net/yrleep/article/details/11540031#)",
        "postTime": 1540394026,
        "uid": 41717,
        "name": "\u4e00\u9897\u8d5b\u8247",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2877 \u3010[USACO07JAN]\u725b\u6821Cow School\u3011"
    },
    {
        "content": "\u663e\u7136\u53ef\u4ee5\u5bf9\u6240\u6709\u8003\u8bd5\u6392\u5e8f\u9884\u5904\u7406\u51fa\u6bcf\u4e2a $d$ \u7684\u539f\u59cb\u65b9\u6848\u6240\u5f97\u5206\u6570 $\\dfrac{S_d}{T_d}$\u3002\n\n\u8003\u8651\u66b4\u529b\uff0c\u5982\u679c\u4e00\u4e2a $d$ \u5408\u6cd5\uff0c\u5219\u53ef\u4ee5\u627e\u5230 $n-d$ \u6b21\u8003\u8bd5\uff0c\u4f7f\u5f97 $\\dfrac{\\sum a_{p_i}}{\\sum b_{p_i}}>\\dfrac{S_d}{T_d}$\uff0c\u5176\u4e2d $p$ \u8868\u793a\u4e00\u4e2a\u65b9\u6848\u7684\u7684\u4e0b\u6807\u96c6\u5408\u3002\n\n\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42 $\\max\\left\\{\\dfrac{\\sum a_{p_i}}{\\sum b_{p_i}}\\right\\}$\uff0c\u53ef\u4ee5\u7528 0/1 \u5206\u6570\u89c4\u5212 + 0/1 \u80cc\u5305\u5728 $O(n^2\\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e0b\u89e3\u51b3\u3002\n\n\u66f4\u8fdb\u4e00\u6b65\uff0c\u5982\u679c\u4e00\u4e2a $d$ \u5408\u6cd5\uff0c\u5219\u53ef\u4ee5\u5728\u539f\u59cb\u65b9\u6848\u4e2d\u66ff\u6362\u4e00\u4e2a $i$ \u53d8\u4e3a $j$\uff0c\u5176\u4e2d $i\\le d < j\\le n$\uff0c\u4f7f\u5f97\u65b9\u6848\u66f4\u4f18\uff0c\u5373 $\\dfrac{S_d-a_i+a_j}{T_d-a_i+a_j}>\\dfrac{S_d}{T_d}$\uff0c\u5316\u7b80\u5f97  $b_iS_d-a_iT_d< b_jS_d-a_jT_d$\uff0c\u8bbe\n$$\nf(d)=\\min\\{b_iS_d-a_iT_d\\}(1\\le i\\le d)\n$$\n$$\ng(d)=\\max\\{b_iS_d-a_iT_d\\}(d< i\\le n)\n$$\n\u5219 $d$ \u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u5408\u6cd5\u65b9\u6848\uff0c\u5f53\u4e14\u4ec5\u5f53 $f(d)< g(d)$\uff0c\u53ef\u4ee5 $O(n^2)$ \u679a\u4e3e\u89e3\u51b3\u3002\n\n\u8003\u8651\u4f18\u5316\uff0c\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u5f88\u50cf\u659c\u7387\u4f18\u5316\u3002\n\n\u4ee5 $f(d)$ \u4e3a\u4f8b\uff0c\u539f\u5f0f\u53ef\u5316\u4e3a $\\dfrac{f(d)}{S_d}=\\min\\left\\{b_i-\\dfrac{T_d}{S_d}a_i\\right\\}$\u3002\n\n\u8fd9\u91cc $b=\\dfrac{f(d)}{S_d}, y=b_i, k=\\dfrac{T_d}{S_d}, x=a_i$\u3002\u5373 $b=\\min\\{y-kx\\}$\uff0c\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u5305\uff0c\u4ee5\u4fdd\u8bc1\u51b3\u7b56\u6700\u4f18\u3002\n\n\u4e0e\u4e00\u822c\u7684\u659c\u7387\u4f18\u5316\u4e0d\u540c\u7684\u662f\uff0c\u8fd9\u9898\u7684\u6a2a\u5750\u6807 $x$ \u5e76\u4e0d\u662f\u9012\u589e\u7684\uff0c\u5373\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7\u4e00\u822c\u7684\u6570\u636e\u7ed3\u6784\uff08\u5355\u8c03\u961f\u5217\uff0c\u5355\u8c03\u6808\uff09\u7ef4\u62a4\uff0c\u8fd9\u91cc\u901a\u8fc7 CDQ \u5206\u6cbb\u7ef4\u62a4\u3002\n\n\u5728\u5206\u6cbb\u65f6\u7ef4\u62a4\u51f8\u5305\uff0c\u5148\u4fdd\u8bc1\u5de6\u534a\u90e8\u5206\u7684\u6a2a\u5750\u6807 $x$ \u9012\u589e\uff08\u7528\u5f52\u5e76\u6392\u5e8f\u4fdd\u8bc1\u65f6\u95f4\u590d\u6742\u5ea6\uff09\uff0c\u8ba1\u7b97\u5de6\u534a\u90e8\u5206\u7684\u51f8\u5305\u5bf9\u53f3\u534a\u90e8\u5206\u7684 $f(d)$ \u7684\u5f71\u54cd\uff0c\u4e0d\u65ad\u5411\u4e0b\u9012\u5f52\u5373\u53ef\u89e3\u51b3\u95ee\u9898\u3002\n\n\u6700\u540e\uff0c\u8003\u8651 $k=\\dfrac{T_d}{S_d}$ \u7684\u5355\u8c03\u6027\u3002\u53ef\u4ee5\u5148\u8bc1\u660e $\\dfrac{b_1}{a_1}>\\dfrac{b_1+b_2}{a_1+a_2}$\uff08\u56e0\u4e3a\u6211\u4eec\u5bf9\u8003\u8bd5\u8fdb\u884c\u4e86\u6392\u5e8f\uff0c\u5373\u4fdd\u8bc1\u4e86 $\\dfrac{a_i}{b_i}< \\dfrac{a_j}{b_j}(i< j)$\uff09\uff0c\u7136\u540e\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u53ef\u4ee5\u5f97\u51fa $\\dfrac{T_d}{S_d}$ \u5355\u8c03\u9012\u51cf\u3002\u6839\u636e\u659c\u7387\u4f18\u5316\u7684\u57fa\u672c\u64cd\u4f5c\uff0c\u8ba1\u7b97 $f$ \u65f6\u7528\u5355\u8c03\u6808\u7ef4\u62a4\u51f8\u5305\uff0c\u8ba1\u7b97 $g$ \u65f6\u7528\u5355\u8c03\u6808\u7ef4\u62a4\uff0c\u5373\u53ef\u5728 $O(n\\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e0b\u89e3\u51b3\u95ee\u9898\u3002\n\n## \u53c2\u8003\u4ee3\u7801\n```cpp\nconst int MAXN = 100000 + 5;\n\nint n, S[MAXN], T[MAXN], q[MAXN];\nlong long f[MAXN], g[MAXN];\n\nstruct node {\n    int a, b;\n    bool operator < (const node A) {return 1.0 * a / b < 1.0 * A.a / A.b;}\n} p[MAXN];\n\nstruct Query {int x, y;} Q[MAXN], tmp[MAXN];\n\nlong double slope(int i, int j) {\n    if (Q[i].x == Q[j].x) return Q[i].y < Q[j].y ? 1e18 : -1e18;\n    return 1.0 * (Q[i].y - Q[j].y) / (Q[i].x - Q[j].x);\n}\n\nvoid solve_f(int l, int r) {\n    if (l == r) return;\n    int mid = (l + r) >> 1, R = 0;\n    solve_f(l, mid);\n    for (int i = l; i <= mid; i++) {\n        while (R > 1 && slope(q[R - 1], q[R]) > slope(q[R], i)) R--;\n        q[++R] = i;\n    }\n    for (int i = mid + 1; i <= r; i++) {\n        while (R > 1 && slope(q[R - 1], q[R]) > 1.0 * T[i] / S[i]) R--;\n        f[i] = std::min(f[i], 1ll * Q[q[R]].y * S[i] - 1ll * Q[q[R]].x * T[i]);\n    }\n    solve_f(mid + 1, r);\n    for (int i = l, p1 = l, p2 = mid + 1; i <= r; i++)\n        if (p2 > r || (p1 <= mid && Q[p1].x < Q[p2].x)) tmp[i] = Q[p1++];\n        else tmp[i] = Q[p2++];\n    for (int i = l; i <= r; i++) Q[i] = tmp[i];\n}\n\nvoid solve_g(int l, int r) {\n    if (l == r) return;\n    int mid = (l + r) >> 1, R = 0, L = 1;\n    solve_g(mid + 1, r);\n    for (int i = mid + 1; i <= r; i++) {\n        while (L < R && slope(q[R - 1], q[R]) < slope(q[R], i)) R--;\n        q[++R] = i;\n    }\n    for (int i = l; i <= mid; i++) {\n        while (L < R && slope(q[L], q[L + 1]) > 1.0 * T[i] / S[i]) L++;\n        g[i] = std::max(g[i], 1ll * Q[q[L]].y * S[i] - 1ll * Q[q[L]].x * T[i]);\n    }\n    solve_g(l, mid);\n    for (int i = l, p1 = l, p2 = mid + 1; i <= r; i++)\n        if (p2 > r || (p1 <= mid && Q[p1].x < Q[p2].x)) tmp[i] = Q[p1++];\n        else tmp[i] = Q[p2++];\n    for (int i = l; i <= r; i++) Q[i] = tmp[i];\n}\n\nstd::vector<int> ans;\n\nint main() {\n    read(n);\n    for (int i = 1; i <= n; i++) read(p[i].a, p[i].b);\n    std::sort(p + 1, p + n + 1);\n    for (int i = n - 1; i; i--) S[i] = S[i + 1] + p[i + 1].a, T[i] = T[i + 1] + p[i + 1].b;\n    for (int i = 1; i <= n; i++) Q[i] = Query{p[i].a, p[i].b}, f[i] = 1ll * p[i].b * S[i] - 1ll * p[i].a * T[i];\n    solve_f(1, n);\n    memset(g, 0xcf, sizeof(g));\n    for (int i = 1; i <= n; i++) Q[i] = Query{p[i].a, p[i].b};\n    solve_g(1, n);\n    for (int i = 1; i <= n; i++)\n        if (f[i] < g[i]) ans.push_back(i);\n    write(ans.size(), '\\n');\n    for (auto res : ans) write(res, '\\n');\n    return 0;\n}\n```",
        "postTime": 1647152687,
        "uid": 188760,
        "name": "Henry__Chen",
        "ccfLevel": 7,
        "title": "USACO 2007 January Gold T3 Cow School Solution"
    },
    {
        "content": "\n[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P2877)\n\n[My blog](https://ctz45562.github.io/2019/12/30/USACO-07JAN-Cow-School/)\n\n\u8bd5\u56fe\u7528$kdt$\u5f3a\u4e0a\u51f8\u5305\u306e\u7ffb\u8f66\u73b0\u573a\u3002\n\n\u4ee5\u4e0b\u8bb0$a_i$\u4e3a$t[i]$\uff0c$b_i$\u4e3a$p[i]$\uff0c$S$\u4e3a\u53bb\u6389\u5f97\u5206\u6bd4\u524d$d$\u5c0f\u540e\u7684$\\sum a_i$\uff0c$T$\u4e3a\u53bb\u6389\u524d$d$\u5c0f\u540e\u7684$\\sum b_i$\u3002\n\n\u5982\u679c\u5b58\u5728\u4e00\u79cd\u66f4\u4f18\u7684\u65b9\u6848\uff0c\u4e00\u5b9a\u53ef\u4ee5\u5728\u524d$d$\u5c0f\u91cc\u9009$1$\u573a\u66ff\u6362\u6389\u5df2\u6709\u7684$1$\u573a\uff0c\u4f7f\u5f97\u5206\u66f4\u5927\u3002\n\n\u5373$\\dfrac{S-a_i+a_j}{T-b_i+b_j}>\\dfrac{S}{T}(j\\le d <i)$\n\n\u5316\u7b80\u4e00\u6ce2\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u6210\u4e86$Ta_j-Sb_j>Ta_i-Sb_i$\n\n\u4e8e\u662f\u9009\u51fa\u6700\u5927\u7684$Ta_j-Sb_j$\u548c\u6700\u5c0f\u7684$Ta_i-Sb_i$\u5224\u65ad\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u600e\u4e48\u641e\u5462\uff1f\n\n---\n\n\u7b2c\u4e00\u60f3\u6cd5\uff1a\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u957f\u5f97\u5f88$kdt$\uff08\u53c2\u89c1[\u5de7\u514b\u529b\u738b\u56fd](https://www.luogu.com.cn/problem/P4475)\uff09\u3002\n\n\u76f4\u63a5\u4e0a$kdt$\u778e\u641e\u4e00\u641e\u5c31\u884c\u4e86\uff0c\u8ba1\u7b97\u77e9\u5f62\u7aef\u70b9\u7684\u53d6\u503c\u526a\u679d\u3002**\u590d\u6742\u5ea6\u6ca1\u6709\u4fdd\u8bc1\uff0c\u53cd\u6b63$kdt$\u662f\u66b4\u529b**\u3002\n\n\u4ee3\u7801\uff1a\n\n``` cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\n#include <cstring>\n#include <time.h>\n\n#define maxn 50005\n\nconst long long inf = 1e18;\n\nusing namespace std;\n\ninline int read(){\n\tint x=0,y=0;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')y=1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn y?-x:x;\n}\n#define son(x,y) son[x][y]\n#define ls(x) son(x,0)\n#define rs(x) son(x,1)\n#define up(f,a,b) a[node][c[node]]=f(f(a[ls(node)][c[node]],a[rs(node)][c[node]]),p[node][b])\n#define dup(f,a) a[node][c[node]^1]=f(a[ls(node)][c[node]^1],a[rs(node)][c[node]^1])\nlong long s,t,res;\nint ans[maxn],id[maxn],fa[maxn],son[maxn][2],xl[maxn][2],xr[maxn][2],yl[maxn][2],yr[maxn][2],p[maxn][2],root,cnt,D;\nbool c[maxn];\nstruct grade{\n\tint a,b;\n\tbool operator < (const grade &x)const{return a*x.b<b*x.a;}\n}g[maxn];\nstruct point{\n\tint pos[2],id;\n\tbool operator < (const point &x)const{return pos[D]<x.pos[D];}\n}po[maxn];\ninline void update(int node){\n\tup(min,xl,0),up(max,xr,0),up(min,yl,1),up(max,yr,1);\n\tdup(min,xl),dup(max,xr),dup(min,yl),dup(max,yr);\n}\nvoid build(int l,int r,int &node){\n\tif(l>r)return;\n\tint mid=l+r>>1;\n\tnode=++cnt,D=rand()&1;\n\tnth_element(po+l,po+mid,po+r+1);\n\tmemcpy(p[node],po[mid].pos,sizeof p[node]),id[po[mid].id]=node;\n\tbuild(l,mid-1,ls(node)),build(mid+1,r,rs(node));\n\tfa[ls(node)]=fa[rs(node)]=node;\n\tupdate(node);\n}\ninline void toggle(int node){\n\tc[node]=1;\n\twhile(node)update(node),node=fa[node];\n}\ninline long long calc_max(int node){return node?t*xr[node][1]-s*yl[node][1]:-inf;}\ninline long long calc_min(int node){return node?t*xl[node][0]-s*yr[node][0]:inf;}\nvoid Max(int node){\n\tif(c[node])res=max(res,t*p[node][0]-s*p[node][1]);\n\tlong long d[2]={calc_max(ls(node)),calc_max(rs(node))};\n\tint t=d[1]>d[0];\n\tif(d[t]>res)Max(son(node,t));\n\tif(d[t^1]>res)Max(son(node,t^1));\n}\nvoid Min(int node){\n\tif(!c[node])res=min(res,t*p[node][0]-s*p[node][1]);\n\tlong long d[2]={calc_min(ls(node)),calc_min(rs(node))};\n\tint t=d[1]<d[0];\n\tif(d[t]<res)Min(son(node,t));\n\tif(d[t^1]<res)Min(son(node,t^1));\n}\ninline long long ma(){res=-inf,Max(root);return res;}\ninline long long mi(){res=inf,Min(root);return res;}\nint main(){\n\tsrand(time(0));\n\tint n=read(),cnt=0;\n\tfor(register int i=1;i<=n;++i)s+=(g[i].a=read()),t+=(g[i].b=read());\n\tsort(g+1,g+1+n);\n\tfor(register int i=1;i<=n;++i)po[i].id=i,po[i].pos[0]=g[i].a,po[i].pos[1]=g[i].b;\n\tbuild(1,n,root);\n\tfor(register int i=1;i<n;++i){\n\t\ts-=g[i].a,t-=g[i].b,toggle(id[i]);\n\t\tif(ma()>mi())ans[++cnt]=i;\n\t}\n\tprintf(\"%d\\n\",cnt);\n\tfor(register int i=1;i<=cnt;++i)printf(\"%d\\n\",ans[i]);\n}\n```\n\n$kdt$\u4e30\u7855\u7684\u6218\u679c\uff1a\n\n- **\u590d\u6742\u5ea6\u6ca1\u6709\u4fdd\u8bc1**\uff1a\u6700\u540e\u4e00\u4e2a\u70b9\u8dd1\u4e86$29s$\n- **\u53cd\u6b63$kdt$\u662f\u66b4\u529b**\uff1a\u559c\u63d0\u548c\u66b4\u529b\u4e00\u4e2a\u5206\n\n![](https://cdn.jsdelivr.net/gh/ctz45562/cdn@1.0/emojis/else/16.gif)\n\n---\n\n\u91cd\u65b0\u8003\u5bdf\u8fd9\u4e2a\u5f0f\u5b50$Ta_j-Sb_j>Ta_i-Sb_i$\uff1a\n\n\u4ee4$Ta_i-Sb_i=C$\uff0c\u53d8\u5f62\u4e00\u6ce2\u53c8\u6210\u4e86$\\frac{T}{S}a_i-\\frac{C}{S}=b_i$\u3002\n\n\u628a$\\frac{T}{S}$\u770b\u4f5c\u659c\u7387\uff0c$\\frac{C}{S}$\u4e3a\u622a\u8ddd\u3002\u76ee\u7684\u662f\u6700\u5c0f/\u6700\u5927\u5316$C$\u3002\n\n\u95ee\u9898\u5c31\u5f88\u659c\u7387\u4f18\u5316\u4e86\u3002\u7ef4\u62a4\u82e5\u5e72\u4e2a\u70b9\uff0c\u652f\u6301\uff1a\n\n- \u63d2\u5165\u4e00\u4e2a\u70b9\n- \u7ed9\u5b9a\u4e00\u6761\u76f4\u7ebf\u7684\u659c\u7387\uff0c\u4f7f\u5b83\u8fc7\u4e00\u4e2a\u70b9\uff0c\u6700\u5927/\u5c0f\u5316\u622a\u8ddd\n\n\u663e\u7136\u659c\u7387\u662f\u5355\u8c03\u7684\u3002\u6ca1\u4ec0\u4e48\u9ad8\u8bba\uff0c\u4e24\u904d$cdq$\u5206\u6cbb+\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u51f8\u5305\u89e3\u51b3\u3002\n\n\u4ee3\u7801\uff1a\n\n``` cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\n#include <cstring>\n\n#define maxn 50005\n\nconst long long inf = 1e18;\n\nusing namespace std;\n\ninline int read(){\n\tint x=0,y=0;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')y=1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn y?-x:x;\n}\ninline double calc(int x1,int y1,int x2,int y2){if(x1==x2)return 1e18;return double(y2-y1)/(x2-x1);}\nint ans[maxn];\nlong long mi[maxn],ma[maxn];\nstruct grade{\n\tint a,b;\n\tbool operator < (const grade &x)const{return a*x.b<b*x.a;}\n}g[maxn];\nstruct operation{\n\tbool t;//0 insert  1 ask\n\tint id;\n\tlong long x,y;//x:T   y:S\n}A[maxn<<1],B[maxn<<1];\nstruct Monoqueue{\n\tint xx[maxn],yy[maxn],pos[maxn],head,tail;\n\tvoid clear(){head=1,tail=0;}\n\tvoid push1(int x,int y,int p){\n\t\twhile(head<tail&&calc(xx[tail],yy[tail],xx[tail-1],yy[tail-1])>calc(xx[tail],yy[tail],x,y))--tail;\n\t\txx[++tail]=x,yy[tail]=y,pos[tail]=p;\n\t}\n\tint front1(double k){\n\t\twhile(head<tail&&calc(xx[head],yy[head],xx[head+1],yy[head+1])<k)++head;\n\t\tif(head<=tail)return pos[head];\n\t\treturn -1;\n\t}\n\tvoid push2(int x,int y,int p){\n\t\twhile(head<tail&&calc(xx[tail],yy[tail],xx[tail-1],yy[tail-1])<calc(xx[tail],yy[tail],x,y))--tail;\n\t\txx[++tail]=x,yy[tail]=y,pos[tail]=p;\n\t}\n\tint front2(double k){\n\t\twhile(head<tail&&calc(xx[head],yy[head],xx[head+1],yy[head+1])>k)++head;\n\t\treturn pos[head];\n\t}\n\tMonoqueue(){clear();}\n}q;\nvoid cdq1(int l,int r){\n\tif(l==r)return;\n\tint mid=l+r>>1,pl=l,pr=mid+1,p=l;\n\tcdq1(l,mid),q.clear();\n\tfor(register int i=l;i<=mid;++i)if(!A[i].t)q.push1(A[i].x,A[i].y,A[i].id);\n\tfor(register int i=mid+1;i<=r;++i){\n\t\tif(!A[i].t)continue;\n\t\tint j=q.front1((double)A[i].x/A[i].y);\n\t\tif(~j)mi[A[i].id]=min(mi[A[i].id],A[i].x*g[j].a-A[i].y*g[j].b);\n\t}\n\tcdq1(mid+1,r),q.clear();\n\twhile(pl<=mid&&pr<=r){\n\t\tif(A[pl].x>A[pr].x||(A[pl].x==A[pr].y&&A[pl].y<A[pr].y))B[p++]=A[pl++];\n\t\telse B[p++]=A[pr++];\n\t}\n\twhile(pl<=mid)B[p++]=A[pl++];\n\twhile(pr<=r)B[p++]=A[pr++];\n\tfor(register int i=l;i<=r;++i)A[i]=B[i];\n}\nvoid cdq2(int l,int r){\n\tif(l==r)return;\n\tint mid=l+r>>1,pl=l,pr=mid+1,p=l;\n\tcdq2(l,mid),q.clear();\n\tfor(register int i=l;i<=mid;++i)if(!A[i].t)q.push2(A[i].x,A[i].y,A[i].id);\n\tfor(register int i=mid+1;i<=r;++i){\n\t\tif(!A[i].t)continue;\n\t\tint j=q.front2((double)A[i].x/A[i].y);\n\t\tif(~j)ma[A[i].id]=max(ma[A[i].id],A[i].x*g[j].a-A[i].y*g[j].b);\n\t}\n\tcdq2(mid+1,r),q.clear();\n\twhile(pl<=mid&&pr<=r){\n\t\tif(A[pl].x>A[pr].x||(A[pl].x==A[pr].x&&A[pl].y>A[pr].y))B[p++]=A[pl++];\n\t\telse B[p++]=A[pr++];\n\t}\n\twhile(pl<=mid)B[p++]=A[pl++];\n\twhile(pr<=r)B[p++]=A[pr++];\n\tfor(register int i=l;i<=r;++i)A[i]=B[i];\n}\nint main(){\n\tmemset(mi,0x3f,sizeof mi),memset(ma,~0x3f,sizeof ma);\n\tlong long s=0,t=0;\n\tint n=read(),cnt=0,len=0;\n\tfor(register int i=1;i<=n;++i)g[i].a=read(),g[i].b=read();\n\tsort(g+1,g+1+n);\n\tfor(register int i=n;i;--i){\n\t\tA[++len]=(operation){1,i,t,s};\n\t\tA[++len]=(operation){0,i,g[i].a,g[i].b};\n\t\ts+=g[i].a,t+=g[i].b;\n\t}\n\tcdq1(1,len);\n\tlen=0;\n\tfor(register int i=1;i<=n;++i){\n\t\ts-=g[i].a,t-=g[i].b;\n\t\tA[++len]=(operation){0,i,g[i].a,g[i].b};\n\t\tA[++len]=(operation){1,i,t,s};\n\t}\n\tcdq2(1,len);\n\tfor(register int i=1;i<n;++i)if(ma[i]>mi[i])ans[++cnt]=i;\n\tprintf(\"%d\\n\",cnt);\n\tfor(register int i=1;i<=cnt;++i)printf(\"%d\\n\",ans[i]);\n}\n```",
        "postTime": 1577702776,
        "uid": 111762,
        "name": "_ctz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2877 \u3010[USACO07JAN]\u725b\u6821Cow School\u3011"
    }
]