[
    {
        "content": "\u9898\u610f\u662f\u5728\u6709\u8fb9\u6743\u7684\u6811\u4e0a\u5bfb\u627e\u5e73\u5747\u8fb9\u6743\u4e0e $k$ \u6700\u63a5\u8fd1\u7684\u94fe\u3002\u6811\u4e0a\u627e\u94fe\u7684\u95ee\u9898\u53ef\u4ee5\u8003\u8651\u70b9\u5206\u6cbb\uff0c\u800c\u70b9\u5206\u6cbb\u7684 $\\mathtt{Solve()}$ \u51fd\u6570\u8981\u5904\u7406\u8fc7\u91cd\u5fc3\u7684\u94fe\u3002\n\n\u8bb0 $dis_x$ \u4e3a $x$ \u5230\u91cd\u5fc3\u7684\u8fb9\u6743\u548c\uff0c $dep_x$ \u4e3a $x$ \u7684\u6df1\u5ea6\uff0c\u5219\u94fe $(x,y)$ \u7684\u5e73\u5747\u8fb9\u6743 $P=\\frac{dis_x+dis_y}{dep_x+dep_y}$\u3002\u4f7f\u5176\u6700\u5c0f\u5219\u662f\u4e00\u4e2a\u5206\u6570\u89c4\u5212\u95ee\u9898\uff0c\u8003\u8651\u4e8c\u5206 $\\lvert P-k \\rvert$\u3002\u8bb0\u4e3a $mid$\u3002\n\n$\\mathtt{Check()}$ \u51fd\u6570\u9700\u5224\u5b9a\u662f\u5426\u5b58\u5728 $P$ \u81f3\u5c11\u6ee1\u8db3 $k-mid \\leq P \\leq k$ \u4e0e $k \\leq P \\leq k +mid$ \u5176\u4e2d\u4e4b\u4e00\u3002\u4ee5\u524d\u8005\u4e3a\u4f8b\uff0c\u540e\u8005\u540c\u7406\u3002\u8be5\u6761\u4ef6\u7b49\u4ef7\u4e8e\uff1a\n\n$$\\begin{cases} (dis_x-dep_x*k)+(dis_y-dep_y*k)\\leq 0\\\\ (dis_x-dep_x*(k-mid))+(dis_y-dep_y*(k-mid))\\geq 0\\end{cases}$$\n\n\u4ee4 $f_x=dis_x-dep_x*k$ \uff0c $g_x=dis_x-dep_x*(k-mid)$\u3002 \u5c06\u6240\u6709\u70b9\u6309\u7167 $f_x$ \u6392\u5e8f\u540e\u5c3a\u53d6\u6cd5\u5904\u7406\uff1a\u904d\u5386 $x$ \u65f6\u5904\u7406\u6ee1\u8db3\u7b2c\u4e00\u4e2a\u6761\u4ef6\u7684 $y$ \u8303\u56f4\uff0c\u518d\u901a\u8fc7\u7ef4\u62a4 $g_y$ \u6700\u5927\u503c\u5224\u5b9a\u8303\u56f4\u5185\u662f\u5426\u5b58\u5728\u70b9\u6ee1\u8db3\u7b2c\u4e8c\u4e2a\u6761\u4ef6\u3002\n\n\u4e8c\u5206\u3001\u70b9\u5206\u6cbb\u3001\u6392\u5e8f\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log^2 n \\log k)$\u3002\n\n\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u7ec6\u8282\uff1a\n\n- \u70b9 $x$ \u4e0e $y$ \u9700\u4f4d\u4e8e\u4e0d\u540c\u5b50\u6811\uff0c\u6240\u4ee5\u7ef4\u62a4 $g_y$ \u6700\u5927\u503c\u65f6\u8fd8\u8981\u7ef4\u62a4\u4e00\u4e2a\u5176\u4ed6\u5b50\u6811\u4e2d\u7684\u6700\u5927\u503c\u3002\n\n- \u94fe\u7684\u7aef\u70b9\u53ef\u4ee5\u5728\u91cd\u5fc3\u4e0a\uff0c\u6240\u4ee5\u8981\u52a0\u5165\u4e00\u4e2a $dis_x=0,dep_x=0$ \u7684\u70b9\u3002\n\n- \u8f93\u51fa\u7b54\u6848\u4e0b\u53d6\u6574\uff0c\u4e8c\u5206\u8981\u6ce8\u610f\u7aef\u70b9\u7684\u5224\u5b9a\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5b9e\u6570\u4e8c\u5206\uff0c\u7a0d\u6162\u4f46\u662f\u4fdd\u9669\u3002\n\n- ~~\u70b9\u5206\u6cbb\u4e0d\u8981\u5199\u9519\uff01\u6211\u56e0\u4e3a\u70b9\u5206\u6cbb\u7684max\u6253\u6210min\u4ea4\u4e86\u4e24\u9875\u534a\u2026\u2026~~\n\n\u6838\u5fc3\u4ee3\u7801\uff1a\n\n```cpp\nbool CheckAbove(ld mid) {\n\tld mn=1e18,dif=1e18,flag; //dif\u662f\u4e0e\u6700\u5927\u503c\u5b50\u6811\u4e0d\u540c\u7684\u90e8\u5206\u6700\u5c0f\u503c \n\tint nmn=-1,ndif=-1; //\u4e24\u4e2a\u503c\u5206\u522b\u5bf9\u5e94\u7684\u5b50\u6811\u7f16\u53f7 \n\tfor(int l=1,r=top+1;l<=top;l++) {\n\t\twhile(r>1&&f(a[r-1])+f(a[l])>=0) { //\u5904\u7406\u53ef\u884cf \n\t\t\tr--;\n\t\t\tif(h(a[r],mid)<mn&&a[r].num!=nmn) {\n\t\t\t\tndif=nmn,nmn=a[r].num,dif=mn,mn=h(a[r],mid);\n\t\t\t} else if(h(a[r],mid)<mn&&a[r].num==nmn) {\n\t\t\t\tnmn=a[r].num,mn=h(a[r],mid);\n\t\t\t} else if(h(a[r],mid)<dif&&a[r].num!=nmn) {\n\t\t\t\tndif=a[r].num,dif=h(a[r],mid);\n\t\t\t} //\u7ef4\u62a4g\u3002\u7531\u4e8e\u91cd\u540d\u8fd9\u91cc\u7528h \n\t\t}\n\t\tif(nmn!=a[l].num) flag=h(a[l],mid)+mn; else flag=h(a[l],mid)+dif;\n\t\tif(flag<=0) {return 1;}\n\t}\n\treturn 0;\n}\n\n```\n\n20220414 \u66f4\u65b0\uff1a\u611f\u8c22 @A_Sunny_Day \u63d0\u9192\u590d\u6742\u5ea6\u4e3a $O(n \\log^2 n \\log k)$\u3002",
        "postTime": 1614053320,
        "uid": 34372,
        "name": "_wkjzyc",
        "ccfLevel": 0,
        "title": "P6670\u9898\u89e3"
    },
    {
        "content": "\u5c06\u6240\u6709\u8fb9\u6743\u51cf\u53bb $k$\uff0c\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u5e73\u5747\u8fb9\u6743\u7edd\u5bf9\u503c\u7684\u6700\u5c0f\u503c\n\n\u8003\u8651\u4e8c\u5206\u7b54\u6848 $mid$\uff0c\u7531\u4e8e\u662f\u5411\u4e0b\u53d6\u6574\uff0c\u5219 $-mid < \\overline{w_i} < mid$\n\n\u8def\u5f84\u95ee\u9898\u8003\u8651\u70b9\u5206\u6cbb\uff0c\u6211\u4eec\u628a\u4e00\u6761\u4ece\u5f53\u524d\u6839\u51fa\u53d1\u7684\u8def\u5f84\u8868\u793a\u4e3a $(sum_i,dep_i)$\uff0c$sum_i$ \u8868\u793a\u8fb9\u6743\u548c\uff0c$dep_i$ \u8868\u793a\u8def\u5f84\u4e0a\u8fb9\u7684\u4e2a\u6570\n\n\u5219 $-mid<\\dfrac{sum_i+sum_j}{dep_i+dep_j}<mid$\n\n\u6613\u77e5\uff0c$dep_i+dep_j>0$\uff0c\u5219\u53ea\u9700\u5bf9\u4e8e $sum_i+sum_j$ \u7684\u6b63\u8d1f\u8fdb\u884c\u8ba8\u8bba\uff0c\u4ee5 $sum_i+sum_j>0$ \u7684\u60c5\u51b5\u4e3a\u4f8b\uff1a\n\n$$sum_i+sum_j<mid(dep_i+dep_j)$$\n\n$$sum_i-mid\\times dep_i<mid\\times dep_j - sum_j$$\n\n\u6211\u4eec\u5c06\u6240\u6709 $(sum_i,dep_i)$ \u6309 $sum$ \u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u5219\u6211\u4eec\u5bb9\u6613\u7528\u53cc\u6307\u9488\u5904\u7406 $sum_i+sum_j>0$ \u7684\u9650\u5236\n\n\u6211\u4eec\u679a\u4e3e\u5de6\u6307\u9488\u4e3a $l$\uff0c\u5904\u7406\u53f3\u6307\u9488\u4e3a $r$\uff0c\u4f7f\u5f97\u6240\u6709 $j\\ge r$\uff0c\u6709 $sum_l+sum_j>0$\uff0c\u5219\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4 $sum_j-mid\\times dep_j$ \u7684\u6700\u5c0f\u503c\u5373\u53ef\n\n\u4f46\u662f\u53ef\u80fd\u51fa\u73b0 $(sum_l,dep_l)$ \u548c $(sum_j,dep_j)$ \u5728\u540c\u4e00\u68f5\u5b50\u6811\u7684\u60c5\u51b5\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u9700\u8981\u7ef4\u62a4\u6b21\u5c0f\u503c\n\n\u4e8c\u5206\u5199\u5728\u70b9\u5206\u6cbb\u5185\u90e8\u5927\u6982\u4f1a\u5feb\u4e00\u4e9b\u5427\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n\\log k)$\n\n```cpp\nconst int N = 50010,M = N;\nint n;ll k;EE(1);\nstruct node { ll sum;int dep,anc; }min1,min2;\nnode st[N];int top;\nll ans = LINF;\nint root,S,mx[N],siz[N],vis[N];\nvoid get_root(int u,int fa)\n{\n\tsiz[u] = 1,mx[u] = 0;\n\tfor(int i = head[u],v;i;i = e[i].nxt) if(!vis[v = e[i].to] && v ^ fa)\n\t\tget_root(v,u),siz[u] += siz[v],mx[u] = max(mx[u],siz[v]);\n\tmx[u] = max(mx[u],S - siz[u]);\n\tif(mx[u] < mx[root]) root = u;\n}\nvoid get_dis(int u,int fa,ll sum,int dep,int anc)\n{\n\tst[++top] = {sum,dep,anc};\n\tfor(int i = head[u],v;i;i = e[i].nxt) if(!vis[v = e[i].to] && v ^ fa)\n\t\tget_dis(v,u,sum + e[i].w,dep + 1,anc);\n}\nvoid update(node now,ll mid)\n{\n\tif(now.sum < min1.sum)\n\t{\n\t\tif(now.anc == min1.anc) { min1 = now;return; }\n\t\tmin2 = min1,min1 = now;return;\n\t}\n\tif(now.sum < min2.sum && now.anc ^ min1.anc) min2 = now;\n}\nbool check1(ll mid)\n{\n\tint j = top;\n\tmin1 = min2 = {LINF,-1,-1};\n\tfor(int i = 1;i <= top;i++)\n\t{\n\t\tfor(;j && st[i].sum + st[j].sum >= 0;j--)\n\t\t\tupdate({st[j].sum - st[j].dep * mid,-1,st[j].anc},mid);\n\t\tif(st[i].dep * mid - st[i].sum > (st[i].anc == min1.anc ? min2.sum : min1.sum))\n\t\t\treturn 1;\n\t}return 0;\n}\nbool check2(ll mid)\n{\n\tint j = 1;\n\tmin1 = min2 = {LINF,-1,-1};\n\tfor(int i = top;i;i--)\n\t{\n\t\tfor(;j <= top && st[i].sum + st[j].sum < 0;j++)\n\t\t\tupdate({-st[j].sum - st[j].dep * mid,-1,st[j].anc},mid);\n\t\tif(st[i].dep * mid + st[i].sum > (st[i].anc == min1.anc ? min2.sum : min1.sum))\n\t\t\treturn 1;\n\t}return 0;\n}\nvoid dfs(int u)\n{\n\tvis[u] = 1,get_root(u,0);\n\tst[top = 1] = {0,0,u};\n\tfor(int i = head[u],v;i;i = e[i].nxt) if(!vis[v = e[i].to])\n\t\tget_dis(v,u,e[i].w,1,v);\n\tsort(st + 1,st + top + 1,[&](node a,node b) { return a.sum < b.sum; });\n\tll l = 1,r = ans;\n\twhile(l <= r)\n\t{\n\t\tll mid = l + r >> 1;\n\t\tif(check1(mid) || check2(mid)) ans = mid - 1,r = mid - 1;\n\t\telse l = mid + 1;\n\t}\n\tfor(int i = head[u],v;i;i = e[i].nxt) if(!vis[v = e[i].to])\n\t\troot = 0,S = siz[v],get_root(v,u),dfs(root);\n}\nint main()\n{\n\tn = read(),k = read();\n\tfor(int i = 1;i < n;i++)\n\t{\n\t\tint u = read(),v = read();ll w = read();\n\t\tadd_edge(u,v,w - k),ans = min(ans,abs(w - k));\n\t}\n\tmx[root = 0] = S = n;\n\tget_root(1,0),dfs(1);\n\tfprint(ans);\n}\n```",
        "postTime": 1612939181,
        "uid": 53994,
        "name": "81179332_",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6670 \u3010[\u6e05\u534e\u96c6\u8bad2016] \u6c7d\u6c34\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u627e\u4e00\u6761\u94fe\uff0c\u4f7f\u5176\u5e73\u5747\u6743\u503c\u4e0e$k$\u7684\u5dee\u503c\u6700\u5c0f\u3002\n\n\u51fa\u9898\u4eba\u7ed9\u51fa\u7684\u505a\u6cd5\u662f\u4e8c\u5206+\u6811\u5206\u6cbb\uff0c$nlog^3n$ \u7684\u590d\u6742\u5ea6\uff0c\u53ef\u80fd\u6709\u70b9\u5361\u5e38\n\n\u8fd9\u91cc\u63d0\u4f9b\u4e00\u79cd\u548c\u6b63\u89e3\u5b8c\u5168\u4e0d\u540c\u7684\u505a\u6cd5\u3002\n\n\u9996\u5148,\u5e73\u5747\u6743\u503c\u4e0e$k$\u7684\u5dee\u503c\u6700\u5c0f\uff0c\u8fd9\u7b49\u4ef7\u4e8e\u5148\u5c06\u6bcf\u6761\u8fb9\u7684\u8fb9\u6743\u51cf\u53bb$k$,\u518d\u6700\u5c0f\u5316\u5e73\u5747\u6743\u503c\u7684\u7edd\u5bf9\u503c\u3002\n\n\u8003\u8651\u6211\u4eec\u627e\u5230\u7684\u7b54\u6848\u94fe\u4e3a\u4e24\u6761\u94fe\u5408\u5e76\u800c\u6210\u7684\uff0c\u5bf9\u4e8e\u7b2c$i$\u6761\u94fe\uff0c\u8bb0\u5176\u6743\u503c\u548c\u4e3a$y_i$ ,\u5176\u7ecf\u8fc7\u7684\u94fe\u7684\u6570\u76ee\u4e3a $x_i$ ,\u6211\u4eec\u5b9e\u9645\u4e0a\u662f\u5728\u6700\u5c0f\u5316 $ | \\frac{y_i+y_j}{x_i+x_j} | $ \n\n\u8fd9\u4e2a\u5f62\u5f0f\u4f3c\u4e4e\u4e0d\u592a\u597d\u5904\u7406\uff0c\u5982\u679c\u6211\u4eec\u662f\u6700\u5c0f\u5316 $ | \\frac{y_i-y_j}{x_i-x_j} | $\u5462\uff1f\u8fd9\u5c31\u5c06\u95ee\u9898\u8f6c\u5316\u6210\u4e86\uff0c\u5728\u4e00\u4e2a**\u4e8c\u7ef4\u5e73\u9762\u5185\u7ed9\u5b9a\u4e00\u4e2a\u70b9\uff0c\u6700\u5c0f\u5316\u4e24\u70b9\u659c\u7387\u7684\u7edd\u5bf9\u503c**\n\n\u5bf9\u4e8e\u4e24\u4e2a\u5b50\u6811$a,b$\uff0c\u5b83\u4eec\u5206\u522b\u5bf9\u5e94\u4e86\u70b9\u96c6$A,B$\uff0c\u6211\u4eec\u73b0\u5728\u5c06A\u5408\u5e76\u5230B\u4e0a\uff0c\u9700\u8981\u8fd9\u6837\u51e0\u4e2a\u6b65\u9aa4\uff1a\n\n\u4e00\uff1a\u56e0\u4e3a\u53c8\u7ecf\u8fc7\u4e86\u4e00\u6761\u8fb9\uff0c\u6211\u4eec\u9700\u8981 $A$ \u4e2d\u7684\u70b9\u5168\u90e8\u66f4\u65b0\uff0c\u5373\u5168\u5c40\u4fee\u6539\n\n\u4e8c\uff1a\u5c06$A$\u4e2d\u7684\u6240\u6709\u70b9\u5728$B$\u4e2d\u8be2\u95ee\u66f4\u65b0\u7b54\u6848\n\n\u4e09\uff1a\u5c06$A$\u4e2d\u7684\u70b9\u66b4\u529b\u63d2\u5165\u5230$B$\u4e2d\n\n\u663e\u7136\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u53ef\u4ee5\u542f\u53d1\u5f0f\u5730\u8fdb\u884c\n\n\u73b0\u5728\u6211\u4eec\u9700\u8981\u4e00\u79cd\u80fd\u652f\u6301\u8fd9\u4e9b\u5168\u5c40\u4fee\u6539\u3001\u5355\u70b9\u63d2\u5165\u3001\u8be2\u95ee\u659c\u7387\u6700\u5c0f\u503c\u7684\u6570\u636e\u7ed3\u6784\n\n\u56e0\u4e3a\u5728\u8fd9\u9898\u4e2d\uff0c\u8be2\u95ee\u7684\u70b9\u5bf9\u5e94\u7684$x$\u4e0d\u5c0f\u4e8e0,\u4e14\u88ab\u95ee\u7684\u70b9\u96c6\u4e2d\u4efb\u4e00\u70b9\u7684x\u4e0d\u5927\u4e8e0\n\n\u6545\u8fd9\u4e9b\u64cd\u4f5c\u53ef\u4ee5\u7528KDT\u6765\u5b9e\u73b0\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u6709\u4e86\u4e00\u4e2a**KDT\u7684\u542f\u53d1\u5f0f\u5408\u5e76\u7684\u505a\u6cd5**\n\n\u4e4d\u4e00\u770b\u8fd9\u4e2a\u505a\u6cd5\u7684\u590d\u6742\u5ea6\u662f$O(n\\sqrt n logn )$\u7684\n\n\u4f46\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u5bf9KDT\u7684\u526a\u679d\u662f\u5168\u5c40\u8fdb\u884c\u7684\uff0c\u4e5f\u5c31\u662f\u8be2\u95ee\u90e8\u5206\u7684\u5e38\u6570\u4f1a\u5c0f\u7684\u5f88\u5938\u5f20\n\n\u800c\u63d2\u5165\u548c\u4fee\u6539\u90e8\u5206\u7684\u590d\u6742\u5ea6\u4e0d\u4f1a\u8d85\u8fc7$log^2n$\n\n\u6240\u4ee5\u8fd9\u4e2a\u505a\u6cd5\u4f1a\u8dd1\u7684\u975e\u5e38\u5feb\uff0c\u5e76\u6210\u4e3a\u4e86\u6b64\u9898\uff08\u6682\u65f6\uff09\u7684\u6700\u4f18\u89e3\n\n\u8003\u573a\u4ee3\u7801\u6bd4\u8f83\u7b80\u964b\uff0c\u5c31\u8d34\u4e00\u4e0b\u6838\u5fc3\u90e8\u5206\u5427\n\n```cpp\nil void dp(int x,int FA){\n\tfor(re i=head[x],v;i;i=e[i].nex)\n\t\tif((v=e[i].to)!=FA){\n\t\t\tdp(v,x);//\u5904\u7406\u5b50\u6811\n\t\t\ttag[rt[v]].x[0]-=1,a[rt[v]].x[0]-=1,mx[rt[v]].x[0]-=1,mn[rt[v]].x[0]-=1;//\u5168\u5c40\u4fee\u6539\u5b50\u6811\n\t\t\ttag[rt[v]].x[1]-=e[i].w,a[rt[v]].x[1]-=e[i].w,mx[rt[v]].x[1]-=e[i].w,mn[rt[v]].x[1]-=e[i].w;\n\t\t\task(rt[v],(P){0,0});//\u66f4\u65b0\u7b54\u6848\n\t\t\tif(siz[rt[v]]>siz[rt[x]]) swap(rt[x],rt[v]);\n\t\t\tdfs(rt[v]);//\u5c06\u5b50\u6811\u4e2d\u7684\u6240\u6709\u70b9dfs\u51fa\u6765\n\t\t\tfor(auto y:vec)\n\t\t\t\task(rt[x],(P){-a[y].x[0],-a[y].x[1]});//\u66f4\u65b0\u7b54\u6848\n\t\t\tfor(auto y:vec)\n\t\t\t\tins(rt[x],1,a[y]);//\u66b4\u529b\u5408\u5e76\n\t\t\tfor(auto y:vec) del(y);//\u56de\u6536\u7a7a\u95f4\n\t\t\tvec.clear();\n\t\t}\n\tif(x!=1) ins(rt[x],1,(P){0,0});\n}\n```\n\n\n",
        "postTime": 1610768584,
        "uid": 220007,
        "name": "xzx34",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6670 \u3010[\u6e05\u534e\u96c6\u8bad2016] \u6c7d\u6c34\u3011"
    },
    {
        "content": "[\u6211\u7684\u535a\u5ba2\u94fe\u63a5](https://www.cnblogs.com/GK0328/p/13894955.html)\n\n\u7f51\u4e0a\u8bf4\u8fd9\u9053\u9898\u662f**\u70b9\u5206\u6cbb**\uff1f\n\n\u53cd\u6b63\u849f\u84bb\u7528**\u8fb9\u5206\u6cbb**\u5207\u4e86\u8fd9\u9053\u9898\u3002\n\n\u9898\u610f\u5c31\u662f\u6c42\u4e00\u6761\u94fe\uff0c\u4f7f\u5b83\u7684\u5e73\u5747\u6743\u503c\u4e0e$k$\u7684\u7edd\u5bf9\u503c\u6700\u5c0f\u3002\n\n\u8bbe\u4efb\u610f\u4e00\u6761\u94fe\u4e3a$\\{w_1,w_2,\\cdots ,w_t\\}$\u3002\n\n\u6c42\uff1a\n\n$$\n\\min  \\lvert \\frac{\\sum_{i=1}^t w_i}{t}-k \\rvert\n$$\n\n\u6211\u4eec\u8003\u8651\u4e8c\u5206\u7b54\u6848\uff0c\u7136\u540e\u6211\u4eec\u9700\u8981\u5224\u65ad\u662f\u5426\u5b58\u5728\u7b26\u5408\u6761\u4ef6\u7684\u94fe\u3002\n\n\u6211\u4eec\u4e8c\u5206\u7684\u662f$\\lvert \\frac{\\sum_{i=1}^t w_i}{t}-k \\rvert$\uff0c\u5b83\u662f\u975e\u8d1f\u7684\u3002\n\n\u5982\u679c\u6211\u4eec\u4e8c\u5206\u5230$mid$\u662f\u5408\u6cd5\u7684\uff0c\u5e94\u5f53\u5b58\u5728\u94fe\u6ee1\u8db3\uff1a\n\n$$\n\\lvert \\frac{\\sum_{i=1}^t w_i}{t}-k \\rvert \\le mid\n$$\n\n\u628a$k$\u52a0\u5165\u5206\u6bcd\u4e2d\u3002\n\n$$\n\\begin{aligned}\n\\frac{\\sum_{i=1}^t w_i}{t}-k=\\\\\n\\frac{(\\sum_{i=1}^t w_i)-tk}{t}=\\\\\n\\frac{\\sum_{i=1}^t (w_i-k)}{t}\n\\end{aligned}\n$$\n\n\u62c6\u5f00\u7edd\u5bf9\u503c\u3002\n\n$$\n-mid \\le \\frac{\\sum_{i=1}^t (w_i-k)}{t} \\le mid\n$$\n\n$$\n\\begin{cases}\n\\frac{\\sum_{i=1}^t (w_i-k-mid)}{t} \\le 0\\\\\n\\frac{\\sum_{i=1}^t (w_i-k+mid)}{t} \\ge 0\n\\end{cases}\n$$\n\n\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e00\u6761\u8fb9\u5b9a\u4e24\u4e2a\u8fb9\u6743$w_i-k-mid,w_i-k+mid$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e00\u6761\u94fe\uff0c\u6211\u4eec\u4f1a\u83b7\u5f97\u4e24\u4e2a\u94fe\u957f$L1,L2$\u3002\n\n\u6211\u4eec\u9700\u8981\u6ee1\u8db3$L1 \\le 0,L2 \\ge 0$\u3002\n\n\u8003\u8651\u8fb9\u5206\u6cbb\uff0c\u5bf9\u4e8e\u4e24\u7aef\u7684\u94fe\uff0c\u81ea\u5df1\u4f5c\u4e3a\u4e00\u6761\u94fe\u7edf\u8ba1\u8d21\u732e\uff0c\u4e0e\u53e6\u4e00\u4e2a\u8fde\u901a\u5757\u4e2d\u7684\u94fe\u5408\u5e76\u4ecd\u9700\u8981\u7edf\u8ba1\u8d21\u732e\u3002\n\n\u73b0\u5728\u5c31\u9700\u8981\u89e3\u51b3\u5feb\u901f\u94fe\u5408\u5e76\u3002\n\n\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u8f6c\u5316\u4e3a\u5e8f\u5217\u95ee\u9898\u4e86\u3002\n\n\u7ed9\u4f60\u4e24\u4e2a\u7531\u6570\u5bf9$(x,y)$\u7ec4\u6210\u7684\u5e8f\u5217$A,B$\uff0c\u4f60\u9700\u8981\u5224\u65ad\u662f\u5426\u5b58\u5728\u4e00\u4e2a$A$\u4e2d\u7684\u6570\u5bf9$p$\u548c$B$\u4e2d\u7684\u6570\u5bf9$q$\uff0c\u6ee1\u8db3$p_x+q_x \\le 0,p_y+q_y \\ge 0$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5148\u628a\u4e24\u4e2a\u5e8f\u5217\u6309$x$\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u4e00\u4e2a$A$\u4e2d\u7684\u6570\u5bf9$p$\uff0c\u4e0e$p$\u6ee1\u8db3$p_x+q_x \\le 0$\u7684$B$\u4e2d\u6570\u5bf9\u4e00\u5b9a\u5728\u4e00\u6bb5\u8fde\u7eed\u7684\u533a\u95f4\u4e2d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6bd4\u8f83$p_y$\u548c\u8fd9\u6bb5\u533a\u95f4\u4e2d$y$\u7684\u6700\u5927\u503c\u5339\u914d\u5373\u53ef\u3002\n\n\u89c2\u5bdf\u53d1\u73b0\uff0c\u5982\u679c\u6211\u4eec\u5bf9$A$\u4ece\u5927\u5230\u5c0f\u626b\u4e00\u904d\uff0c\u90a3\u4e48\u5408\u6cd5\u7684\u533a\u95f4\u4e00\u5b9a\u4ece$[1,z]$\u5f00\u59cb\uff08$z$\u53ef\u4ee5\u5c0f\u4e8e$1$\uff0c\u8868\u793a\u4e0d\u5b58\u5728\u5408\u6cd5\u65b9\u6848\uff09\uff0c$z$\u4e0d\u65ad\u6269\u5927\uff0c\u800c\u5de6\u7aef\u70b9$1$\u4e0d\u6539\u53d8\uff0c\u76f4\u63a5\u4e00\u4e2a\u6307\u9488\u626b\u8fc7\u53bb\u5c31\u597d\u4e86\u3002\n\n\u6ce8\u610f\u70b9\uff1a\n\n$1.$\u7531\u4e8e\u5355\u4e2a\u70b9\u4e0d\u80fd\u7b97\u4f5c\u4e00\u6761\u94fe\uff0c\u6211\u4eec\u5fc5\u987b\u5224\u65ad\u4e00\u4e2a\u8282\u70b9\u662f\u5426\u8d70\u8fc7\u4e00\u6761\u8fb9\uff0c\u5426\u5219\u4e0d\u80fd\u52a0\u5165\u5339\u914d\u5e8f\u5217\u4e2d\uff0c\u800c\u5728\u8fb9\u5206\u6811\u4e0a\u8d70\u8fc7\u4e00\u4e9b\u865a\u70b9\u540e\u5230\u8fbe\u5b83\u4eec\u7684\u7236\u4eb2\u8282\u70b9\u4ecd\u7136\u6ca1\u6709\u8d70\u8fc7\u4e00\u6761\u8fb9\uff0c\u9700\u8981\u7279\u5224\u3002\n\n$2.$\u4e8c\u5206\u7b54\u6848\u65f6\uff0c\u7531\u4e8e\u53ea\u9700\u8981\u4fdd\u7559\u6574\u6570\uff0c\u6211\u4eec\u6309\u6574\u6570\u6765\u4e8c\u5206\u3002\u8fd9\u9053\u9898\u9700\u8981\u5411\u4e0b\u53d6\u6574\uff0c\u6211\u4eec\u4e8c\u5206\u5230\u7684\u7b54\u6848\u53ef\u80fd\u9700\u8981$-1$\uff0c\u6bd4\u5982$1.5$\u4e8c\u5206\u5230\u7684\u7b54\u6848\u4e3a$2$\uff0c\u90a3\u4e48\u6211\u4eec\u5bf9\u4e8c\u5206\u5f97\u5230\u7684\u7b54\u6848\u8fdb\u884c\u4e00\u6b21\u8fb9\u5206\u6cbb\uff0c\u53ea\u8981\u5224\u65ad\u662f\u5426\u6709\u4e0d\u53d6\u7b49\u53f7\u7684\u89e3\u5373\u53ef\uff08\u64cd\u4f5c\u5c31\u662f\u628a\u6240\u6709\u7684$\\le,\\ge$\u6539\u6210$<,>$\uff09\u3002\n\n$Code:$\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<vector>\n#include<cstdlib>\n#define N 50005\n#define M 100005\n#define ll long long\n#define pr pair<int,ll>\n#define lpr pair<ll,ll>\n#define mp make_pair\nusing namespace std;\nconst ll INF=1919191919191919;\nconst int iINF=1000000009;\nvector< pr >E[N];\n#define IT vector< pr > :: iterator\nint n,x,y,rt,rtsz;\nll k,z,mx,mn,mid,ans;\nint tot=1,cnt;\nbool flag,flag2;\nstruct node\n{\n    int nxt,v;\n    ll cost;\n    node (int Nxt=0,int V=0,ll Cost=0)\n    {\n        nxt=Nxt,v=V,cost=Cost;\n    }\n}e[M << 1];\nint fr[M],sz[M],cp[M];\nbool vis[M << 1];\nll cdp1[M],cdp2[M];\nint qcp,cc[2];\nlpr c[2][N];\nvoid add(int x,int y,ll z)\n{\n    ++tot;\n    e[tot]=node(fr[x],y,z),fr[x]=tot;\n}\nvoid add_edge(int x,int y,ll z)\n{\n    add(x,y,z),add(y,x,z);\n}\nvoid build(int u,int F)\n{\n    int les=E[u].size()-(int)(u!=1);\n    int tt=0,lst;\n    for (IT it=E[u].begin();it!=E[u].end();++it)\n    {\n        int v=it->first;\n        ll cost=it->second;\n        if (v==F)\n            continue;\n        ++tt;\n        if (tt==1)\n            add_edge(u,v,cost),lst=u; else\n        if (tt==les)\n            add_edge(lst,v,cost); else\n            {\n                add_edge(lst,++cnt,0);\n                add_edge(cnt,v,cost);\n                lst=cnt;\n                cp[cnt]=u;\n            }\n        build(v,u);\n    }\n}\nvoid getrt(int u,int F,int rn)\n{\n    sz[u]=1;\n    for (int i=fr[u];i;i=e[i].nxt)\n    {\n        int v=e[i].v;\n        if (v==F || vis[i])\n            continue;\n        getrt(v,u,rn);\n        sz[u]+=sz[v];\n        if (max(sz[v],rn-sz[v])<rtsz)\n            rtsz=max(sz[v],rn-sz[v]),rt=i;\n    }\n}\nvoid dfs2(int u,int F,int cl)\n{\n    if (u<=n && u!=qcp)\n        c[cl][++cc[cl]]=mp(cdp1[u],cdp2[u]);\n    for (int i=fr[u];i;i=e[i].nxt)\n    {\n        int v=e[i].v;\n        ll cost=e[i].cost-k;\n        if (v==F || vis[i])\n            continue;\n        if (cp[u]!=v && cp[v]!=u && !(u>n && v>n))\n            cdp1[v]=cdp1[u]+cost-mid,cdp2[v]=cdp2[u]+cost+mid; else\n            cdp1[v]=cdp1[u],cdp2[v]=cdp2[u];\n        dfs2(v,u,cl);\n    }\n}\nvoid solve(int u,int s)\n{\n    rtsz=iINF;\n    getrt(u,0,s);\n    if (rtsz==iINF)\n        return;\n    vis[rt]=vis[rt^1]=true;\n    int v1=e[rt].v,v2=e[rt^1].v;\n    cc[0]=cc[1]=0;\n    if (v1<=n)\n        qcp=v1; else\n        qcp=cp[v1];\n    cdp1[v1]=cdp2[v1]=0;\n    dfs2(v1,0,0);\n    if (cp[v1]!=v2 && cp[v2]!=v1 && !(v1>n && v2>n))\n        cdp1[v2]=e[rt].cost-k-mid,cdp2[v2]=e[rt].cost-k+mid; else\n        {   \n            if (v2<=n)\n                qcp=v2; else\n                qcp=cp[v2];\n            cdp1[v2]=cdp2[v2]=0;\n        }\n    dfs2(v2,0,1);\n    for (int i=1;i<=cc[0];++i)\n        if ((!flag2 && c[0][i].first<=0 || flag2 && c[0][i].first<0) && (!flag2 && c[0][i].second>=0 || flag2 && c[0][i].second>0))\n        {\n            flag=true;\n            vis[rt]=vis[rt^1]=false;\n            return;\n        }\n    for (int i=1;i<=cc[1];++i)\n        if ((!flag2 && c[1][i].first<=0 || flag2 && c[1][i].first<0) && (!flag2 && c[1][i].second>=0 || flag2 && c[1][i].second>0))\n        {\n            flag=true;\n            vis[rt]=vis[rt^1]=false;\n            return;\n        }\n    sort(c[0]+1,c[0]+cc[0]+1),sort(c[1]+1,c[1]+cc[1]+1);\n    ll mx=-INF;\n    int l=1;\n    for (int i=cc[0];i;--i)\n    {\n        while (l<=cc[1] && (!flag2 && c[1][l].first+c[0][i].first<=0 || flag2 && c[1][l].first+c[0][i].first<0))\n        {\n            mx=max(mx,c[1][l].second);\n            ++l;\n        }\n        if (l!=1 && (!flag2 && mx+c[0][i].second>=0 || flag2 && mx+c[0][i].second>0))\n        {\n            flag=true;\n            vis[rt]=vis[rt^1]=false;\n            return;\n        }\n    }\n    int kt=rt,ts=s-sz[v1];\n    solve(v1,sz[v1]);\n    if (flag)\n    {\n        vis[kt]=vis[kt^1]=false;\n        return;\n    }\n    solve(v2,ts);\n    vis[kt]=vis[kt^1]=false;\n}\nbool check()\n{\n    flag=false;\n    solve(1,cnt);\n    return flag;\n}\nint main()\n{\n    scanf(\"%d%lld\",&n,&k),cnt=n;\n    mx=0,mn=INF;\n    for (int i=1;i<n;++i)\n    {\n        scanf(\"%d%d%lld\",&x,&y,&z);\n        E[x].push_back(mp(y,z)),E[y].push_back(mp(x,z));\n        mx=max(mx,z),mn=min(mn,z);\n    }\n    build(1,0);\n    ll l=0,r=min(abs(k-mx),abs(k-mn));\n    while (l<=r)\n    {\n        mid=(l+r) >> 1;\n        if (check())\n            ans=mid,r=mid-1; else\n            l=mid+1;\n    }\n    mid=ans;\n    flag2=true;\n    if (ans && check())\n        --ans;\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1603935309,
        "uid": 10341,
        "name": "GK0328",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6670 \u3010[\u6e05\u534e\u96c6\u8bad2016] \u6c7d\u6c34\u3011"
    }
]