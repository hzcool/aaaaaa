[
    {
        "content": "# \u5206\u6790\n\u9898\u76ee\u7ed9\u51fa\u4e86\u6bcf\u4e00\u5c42\u6389\u56de\u6811\u6839\u548c\u722c\u9ad8\u7684\u6982\u7387\uff0c\u9700\u6c42\u51fa\u722c\u5230\u6811\u9876\u7684\u671f\u671b\u65f6\u95f4\uff0c\u5f88\u660e\u663e\u662f\u4e00\u9053\u6982\u7387 dp \u9898\u3002   \n\u9996\u5148\u7531\u4e8e\u4efb\u4f55\u60c5\u51b5\u4e0b\u7532\u58f3\u866b\u90fd\u6709\u53ef\u80fd\u6389\u56de\u6811\u6839\uff0c\u6240\u4ee5\u6b63\u63a8\u8f83\u96be\uff0c\u8003\u8651\u9006\u63a8\u3002   \n\u9996\u5148\u4ee4 $f_i$ \u4e3a\u7532\u58f3\u866b\u4ece $i$ \u5230 $n$ \u7684\u671f\u671b\u65f6\u95f4\uff0c\u6240\u4ee5\u8fb9\u754c $f_n=0$\u3002   \n\u90a3\u4e48\u5c31\u53ef\u4ee5\u63a8\u51fa\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b $f_i=p_{i+1} f_0+(1-p_{i+1})f_{i+1}+1$\u3002   \n\u4f46\u662f\u8fd9\u4e2a\u5f0f\u5b50\u91cc\u6709\u9700\u8981\u6c42\u7684\u7b54\u6848 $f_0$\uff0c\u6240\u4ee5\u8003\u8651\u7c7b\u4f3c\u89e3\u65b9\u7a0b\u7684\u65b9\u6cd5\u6765\u63a8\u51fa $f_0$\u3002  \n$f_0=(1-p_1)f_1+p_1f_0+1$   \n$f_0=(1-p_1)[(1-p_2)f_2+p_2f_0+1]+p_1f_0+1$    \n$f_0=(1-p_1)(1-p_2)f_2+(1-p_2)p_1f_0+(1-p_1)+p_1f_0+1$    \n$f_0=(1-p_1)(1-p_2)f_2+f_0[(1-p_1)p_2+p_1]+[(1-p_1)+1]$     \n\u4f9d\u6b21\u7c7b\u63a8\uff0c\u53ef\u4ee5\u628a\u5f0f\u5b50\u5206\u6210\u4e09\u9879\uff0c\u90a3\u4e48\u6700\u540e\u53d8\u6210\u8fd9\u6837\u3002    \n$f_0=\\prod_{i=1}^{n}(1-p_i) f_n+f_0p_i\\sum_{i=1}^{n}\\prod_{j=1}^{i-1}(1-p_j)+\\sum_{i=1}^{n}\\prod_{j=1}^{i}(1-p_j)$   \n\u8bbe\u8fd9\u4e09\u4e2a\u7cfb\u6570\u4e3a $s1$,$s2$,$s3$\u3002   \n$f_0=s1f_n+s2f_0+s3$    \n\u8fd9\u4e09\u4e2a\u7cfb\u6570\u90fd\u80fd $O(n)$ \u6c42\u51fa\u3002   \n\u56e0\u4e3a $f_n=0$\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u6c42\u51fa\u7b54\u6848 $f_0=\\frac{s3}{1-s2}$\u3002 \n# \u4ee3\u7801\n\u4ee3\u7801\u90e8\u5206\u9700\u8981\u6ce8\u610f\u7684\u662f\u6709\u7406\u6570\u53d6\u6a21\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u6a21\u6570\u662f\u8d28\u6570\uff0c\u6240\u4ee5\u4f7f\u7528\u8d39\u9a6c\u5c0f\u5b9a\u7406\u6c42\u89e3\u3002\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N=1e5+5;\nconst int P=998244353;\nint n,a[N],b[N];\nint fp(int x,int y){ // \u5feb\u901f\u5e42\n    int res=1;\n    for(;y;y>>=1){\n        if(y&1) res=(1ll*res*x)%P;\n        x=(1ll*x*x)%P;\n    }\n    return res;\n}\nint main(){\n    scanf(\"%d\",&n);\n    for(int i=1;i<=n;i++) scanf(\"%d%d\",&a[i],&b[i]);\n    int s1=1,s2=0,s3=0;\n    for(int i=1;i<=n;i++){ \n        int p1=(1ll*a[i]*fp(b[i],P-2))%P; //\u8d39\u9a6c\u5c0f\u5b9a\u7406\u6c42\u51fa\u6982\u7387\n        int p2=(1ll*(b[i]-a[i])*fp(b[i],P-2))%P;\n        s3=(s3+s1)%P; // \u8ba1\u7b97\u7cfb\u6570\n        s2=(s2+1ll*s1*p1)%P;\n        s1=(1ll*s1*p2)%P;\n    }\n    printf(\"%d\",(1ll*s3*fp(1-s2+P,P-2))%P);\n    return 0;\n}\n```",
        "postTime": 1672911828,
        "uid": 511639,
        "name": "KevinLikesCoding",
        "ccfLevel": 5,
        "title": "P8774 [\u84dd\u6865\u676f 2022 \u7701 A] \u722c\u6811\u7684\u7532\u58f3\u866b \u9898\u89e3"
    },
    {
        "content": "#### \u9898\u76ee\u5927\u610f\n\n\n------------\n\u6709\u4e00\u53ea\u7532\u58f3\u866b\u722c\u4e00\u68f5\u9ad8\u4e3a $n$ \u7684\u6811\uff0c\u5728 $i$ \u5c42\u5c1d\u8bd5\u722c\u5230\u7b2c $i+1$ \u5c42\u65f6\uff0c\u6709 $P_i$ \u7684\u6982\u7387\u6389\u56de\u6811\u6839\uff0c\u6c42\u4ece\u6811\u6839\u5230\u9876\u90e8\u7684\u65f6\u95f4\u7684\u671f\u671b\u3002\n\n#### \u601d\u8def\u5206\u6790\n\n\n------------\n$f_i$ \u8868\u793a\u4ee5\u7b2c $i$ \u5c42\u4e3a\u8d77\u70b9\u722c\u5230\u7b2c $n$ \u5c42\u7684\u671f\u671b\u3002\n\n\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u5373\u4e3a\uff1a\n\n$$f_i = (1-p_i)\\times f_{i+1} + p_i\\times f_0 + 1$$\n\n\u53d1\u73b0 $f_0$ \u5176\u5b9e\u5c31\u662f\u9898\u76ee\u8981\u6c42\u7684\u7b54\u6848\uff0c\u4ece\u7b54\u6848\u63a8\u51fa\u7b54\u6848\u663e\u7136\u662f\u4e0d\u53ef\u884c\u7684\u3002\n\n$$f_{i+1} = (1-p_{i+1})\\times f_{i+2} + p_{i+1}\\times f_0 + 1$$\n$$f_i = (1-p_i)\\times [(1-p_{i+1})\\times f_{i+2} + p_{i+1}\\times f_0 + 1] + p_i \\times f_0 + 1$$\n\n$$f_i =(1-p_i)\\times(1-p_{i+1})f_{i+2} + [(1-p_i)\\times p_{i+1}+p_i]\\times f_0 + 2 - p_i$$\n\n\u53d1\u73b0\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u672c\u8d28\u4e0a\u662f\n\n$$f_i = p\\times f_n + q\\times f_0 + t$$\n\n\u7531\u4e8e $f_n = 0$\uff0c\u4ee4 $i=0$\uff0c\u4e0a\u5f0f\u5373\u4e3a $f_0 = q\\times f_0 + t$\n\n\u6545\u7b54\u6848 $f_0 = \\dfrac{t}{1-q}$\n\n\u53ea\u9700\u9012\u63a8\u6c42\u51fa $t,q$ \u5373\u53ef\u3002\n\n#### \u4ee3\u7801\u5b9e\u73b0\n\n\n------------\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cstdlib>\n#include<cmath>\n#include<climits>\n#include<queue>\n#include<vector>\n#define int long long\nusing namespace std;\nconst int INF = 0x3f3f3f3f;\nconst int mod = 998244353;\nconst int N = 2e5 + 10;\nconst int M = 1e5 + 10;\ninline int read(){\n\tint x=0,f=1;char ch=getchar();\n\tfor(;!isdigit(ch);ch=getchar()) if(ch=='-') f=-1;\n\tfor(; isdigit(ch);ch=getchar()) x=(x<<3)+(x<<1)+ch-'0';\n\treturn x*f;\n}\nint f[N],g[N],k[N];\nint x[N],y[N],p[N];\nint qpow(int n,int k){\n\tint res = 1;\n\twhile(k > 0){\n\t\tif(k & 1) res = (res * n) % mod;\n\t\tn = (n * n) % mod;\n\t\tk >>= 1;\n\t}\n\treturn res;\n}\nsigned main(){\n\tint n = read();\n\tfor(int i=0;i<n;i++){\n\t\tx[i] = read() , y[i] = read();\n\t\tp[i] = (x[i] * qpow(y[i],mod-2)) % mod;\n\t}\n\tfor(int i=n-1;i>=0;i--){\n\t\tf[i] = (f[i+1] * (y[i]-x[i]) % mod * qpow(y[i],mod-2) % mod) % mod;\n\t\tk[i] = (k[i+1] * (y[i]-x[i]) % mod * qpow(y[i],mod-2) % mod + 1) % mod;\n\t\tf[i] = (f[i] + p[i]) % mod;\n\t}\n\tf[0] = (k[0] * qpow(1 - f[0] + mod,mod-2) % mod) % mod;\n\tcout<<f[0]<<\"\\n\";\n\treturn 0;\n}\n```\n",
        "postTime": 1668328426,
        "uid": 335615,
        "name": "0xFF",
        "ccfLevel": 0,
        "title": "P8774"
    },
    {
        "content": "\u5047\u8bbe $f_i$ \u6307\u4ece $i$ \u5230 $n$ \u7684\u671f\u671b\u65f6\u95f4\uff0c\u5219\u53ef\u4ee5\u63a8\u51fa\uff1a\n\n$f_i=(1-p_{i+1})f_{i+1}+p_{i+1}f_0+1$\n\n\u4ece $i=0$ \u8003\u8651\uff0c\u5373 $f_0=(1-p_1)f_1+p_1f_0+1$\n\n\u5c06 $f_1=(1-p_2)f_2+p_2f_0+1$ \u4ee3\u5165\u5230\u4e0a\u5f0f\uff0c\u53ef\u5f97 $f_0=(1-p_1)[(1-p_2)f_2+p_2f_0+1]+p_1f_0+1=1+(1-p_1)+(1-p_1)(1-p_2)f_2+[(1-p_1)p_2+p_1]f_0$\n\n\u4ee5\u6b64\u7c7b\u63a8\uff0c\u53ef\u5f97 $f_0=1+(1-p_1)+(1-p_1)(1-p_2)+\\cdots+(1-p_1)(1-p_2)(1-p_3)\\cdots f_n+[p_1+(1-p_1)p_2+(1-p_1)(1-p_2)p_3+\\cdots]f_0$\n\n\u8bbe $A=1+(1-p_1)+(1-p_1)(1-p_2)+\\cdots,C=p_1+(1-p_1)p_2+(1-p_1)(1-p_2)p_3+\\cdots$\n\n\u7531\u9898\u610f\u5f97 $f_n=0$\n\n\u4ee3\u5165\u53ef\u5f97 $f_0=Cf_0+A$\n\n\u5373 $f_0=\\dfrac{A}{1-C}$\uff0c\u76f4\u63a5\u8ba1\u7b97\u5373\u53ef\n\n```cpp\n#include<cstdio>\nusing namespace std;\ntypedef long long ll;\nconst ll mod=998244353;\nll n;\nll inv(ll x){\n\tll z=1,y=mod-2;\n\twhile(y){\n\t\tif(y&1)z=z*x%mod;\n\t\tx=x*x%mod;\n\t\ty=y>>1; \n\t}\n\treturn z;\n}\nll p[100005];\n// A=1+(1-P1)+(1-P1)(1-P2)...\n// C=P1+(1-P1)P2+(1-P1)(1-P2)P3...\nll A=0,C=0;\nint main(){\n\tscanf(\"%lld\",&n);\n\tfor(ll i=1;i<=n;i++){\n\t\tll x,y;\n\t\tscanf(\"%lld%lld\",&x,&y);\n\t\tp[i]=x*inv(y)%mod;\n\t}\n\tll tmp=1;\n\tfor(ll i=1;i<=n;i++){\n\t\tA=(A+tmp)%mod;\n\t\tC=(C+tmp*p[i]%mod)%mod;\n\t\ttmp=tmp*((1+mod-p[i])%mod)%mod;\n\t}\n\tprintf(\"%lld\\n\",A*inv(1+mod-C)%mod);\n\treturn 0;\n}\n```\n",
        "postTime": 1685159125,
        "uid": 338147,
        "name": "01bit",
        "ccfLevel": 5,
        "title": "[P8774] \u722c\u6811\u7684\u7532\u58f3\u866b \u9898\u89e3"
    },
    {
        "content": "[\u9898\u76ee](https://www.luogu.com.cn/problem/P8774)\n\n\n------------\n\n\u6982\u7387\u4e3a $p_i$,\u90a3\u4e48\u5230\u8fbe $i+1$ \u7684\u6982\u7387\u4e3a $1-p_{i+1}$,\u6389\u5230 $0$ \u7684\u6982\u7387\u662f $p_{i+1}$\u3002    \n\u8bbe $f_i$ \u4e3a $i$ \u5230 $n$ \u7684\u671f\u671b,\u90a3\u4e48 $f_n=0$\u3002  \n$f_i$ \u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u5c31\u662f\uff1a\n$f_i=1+(1-p_{i+1})f_{i+1}+p_{i+1}f_0$  \n\u8868\u793a $f_i$ \u5230 $n$ \u671f\u671b\u4e3a\uff1a\u65f6\u95f4 $+$ \u5230 $i+\n1$ \u7684\u671f\u671b $+$ \u6389\u5230 $0$ \u540e$f_0$\u7684\u671f\u671b\u3002  \n\n\u96be\u9053\u4ee3\u7801\u5c31\u662f\u8fd9\u6837\u5417\uff1f\u5e76\u4e0d\u662f\u3002\u6211\u4eec\u89c2\u5bdf\u5f0f\u5b50\u53d1\u73b0\u6c42 $f_i$ \u65f6,\u672a\u77e5\u6570\u6709 $f_{i+1}$ \u548c $f_0$,\u5176\u4e2d\u53ef\u4ee5\u901a\u8fc7\u5012\u7740\u6c42\u5f97\u51fa $f_{i+1}$,\u4f46\u65e0\u6cd5\u5f97\u51fa $f_0$\u3002  \n\u6240\u4ee5\u6211\u4eec\u4ee5 $n=3$ \u4e3a\u4f8b,\u5c55\u5f00\u524d\u9762\u7684\u5f0f\u5b50\uff1a  \n$f_0=1+(1-p_{1})f_{1}+p_{1}f_0$  \n$f_1=1+(1-p_{2})f_{2}+p_{2}f_0$  \n$f_2=1+(1-p_{3})f_{3}+p_{3}f_0$    \n\u7136\u540e\u628a $f_1$ \u4ee3\u5165 $f_0$\uff1a\n$f_0=1+(1-p_{1})[1+(1-p_{2})f_{2}+p_{2}f_0]+p_{1}f_0$    \n$f_0=1+(1-p_{1})+(1-p_{1})(1-p_{2})f_{2}+[p_{1}+(1-p_1)p_2]f_0$    \n\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u627e\u5230\u4e00\u4e2a\u89c4\u5f8b\uff1a  \n$f_0=A+B+C$  \n$A=1+(1-p_1)+(1-p1)(1-p_2)+\\ldots+(1-p1)(1-p2)\\ldots(1-p_{n-1})$  \n$C=p_1+(1-p_1)p_2+\\ldots+(1-p1)(1-p_2)\\ldots(1-p_{n-1})p_n$  \n\u56e0\u4e3a $B$ \u4e58\u4e86 $f_n$ ,\u800c $f_n$ \u4e3a $0$,\u6240\u4ee5 $B$ \u53ef\u4ee5\u4e0d\u7b97\u3002\n\n\u8fd8\u9700\u8981\u6ce8\u610f\u4e00\u70b9,\u56e0\u4e3a\u9898\u76ee\u8981\u6c42\u4e00\u4e2a\u5206\u6570\u9664\u4ee5\u4e00\u4e2a\u7d20\u6570,\u6240\u4ee5\u8981\u7528\u5230\u9006\u5143\u3002\n\ncode\n---\n\n```\n#include<iostream>\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nconst int mod=998244353;\nconst int N=100005;\nint n;\nlong long a[N],b[N],A,C,p[N],p_1[N];\nlong long ksm(long long x,long long p)\n{\n\tlong long res=1;\n\twhile(p)\n\t{\n\t\tif(p&1)\n\t\t{\n\t\t\tres=res*x%mod;\n\t\t}\n\t\tx=x*x%mod;\n\t\tp>>=1;\n\t}\n\treturn res;\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%lld%lld\",&a[i],&b[i]);\n\t\tp[i]=a[i]*ksm(b[i],mod-2)%mod;\n\t\tp_1[i]=(b[i]-a[i])*ksm(b[i],mod-2)%mod;\n\t}\n\tA=1;\n\tlong long k=1;\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tA=(A+p_1[i]*k%mod)%mod;\n\t\tk=(p_1[i]*k)%mod;\n\t}\n\tk=1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tC=(C+p[i]*k%mod)%mod;\n\t\tk=(k*p_1[i])%mod;\n\t}\n\tC=(1-C+mod)%mod;\n\tlong long ans=A*ksm(C,mod-2)%mod;\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1685158925,
        "uid": 115613,
        "name": "MYJ_aiie",
        "ccfLevel": 5,
        "title": "P8774 [\u84dd\u6865\u676f 2022 \u7701 A] \u722c\u6811\u7684\u7532\u58f3\u866b"
    },
    {
        "content": "## \u5206\u6790\n\u6bcf\u4e0a\u5347\u4e00\u4e2a\u9ad8\u5ea6\u90fd\u6709 $p_i$ \u7684\u6982\u7387\u6389\u5230\u6811\u6839\uff0c\u8bbe $f_i$ \u8868\u793a\u4ece\u6811\u6839\u4e0a\u5230\u9ad8\u5ea6 $i$ \u7684\u671f\u671b\u65f6\u95f4\uff0c\u663e\u7136 $f_0=0$ \uff0c\u76ee\u6807\u4e3a $f_n$ \u3002\n\n\u8003\u8651\u5982\u4f55\u8f6c\u79fb\uff0c\u663e\u7136\u5c1d\u8bd5\u4ece $i-1$ \u9ad8\u5ea6\u5230 $i$ \u9ad8\u5ea61\u6b21\u7684\u671f\u671b\u8017\u8d39\u65f6\u95f4\u662f $f_{i-1}+1$ \uff0c\u5c1d\u8bd5\u6210\u529f\u7684\u6982\u7387\u4e3a $1-p_i$ \u6240\u4ee5\u671f\u671b\u5c1d\u8bd5\u6b21\u6570\u4e3a $(1-p_i)^{-1}$ \uff0c\u6240\u4ee5\u8f6c\u79fb\u65b9\u7a0b\u5c31\u662f \uff1a\n\n### $f_i=(f_{i-1}+1)\\times(1-p_i)^{-1}$ \u3002\n ### \u5173\u4e8e\u53d6\u6a21\n \n$c\\times b \\equiv a \\pmod p$ \u53ef\u4ee5\u5316\u6210 $c\\times{b}+{d}\\times{P}=a$ \uff0c\n\n\u76f4\u63a5\u6269\u6b27\u8ba1\u7b97\u5373\u53ef\u3002\n\n## \u4ee3\u7801\n\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long//\u4e0d\u5f00long long\u89c1\u7956\u5b97\u3002\nusing namespace std;\nint n,ans=1;\nint x,y;//\u8fd4\u56de\u4e24\u4e2a\u6570\u8981\u7528pair\uff0c\u4f46\u6211\u61d2\u5c31\u76f4\u63a5\u5f00\u5168\u5c40\u53d8\u91cf\u4e86\u3002\ninline void exgcd(int a,int b,int flag){\n\tif(b==0){\n\t\tx=flag,y=0;\n\t\treturn;\n\t}\n\texgcd(b,a%b,flag);\n\tint z=y;\n\ty=x-a/b*y;\n\tx=z;\n\treturn;\n}//\u6269\u6b27\u3002\nsigned main(){\n\tcin>>n;\n\twhile(n--){\n\t\tint fz,fm;\n\t\tscanf(\"%lld%lld\",&fz,&fm);\n\t\texgcd(fm-fz,998244353,fm);\n\t\tif(x>=0)x=x%998244353;\n\t\telse x+=((-x-1)/998244353+1)*998244353;\n\t\tans=(ans*x)%998244353;\n\t\tans++;\n\t}\n\tans--;\n\tcout<<ans%998244353<<endl;\n} \n```\n### \u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log n)$ \u3002\n",
        "postTime": 1675257197,
        "uid": 700717,
        "name": "why081023",
        "ccfLevel": 0,
        "title": "P8774 [\u84dd\u6865\u676f 2022 \u7701 A] \u722c\u6811\u7684\u7532\u58f3\u866b \u9898\u89e3"
    },
    {
        "content": "\u9898\u610f\uff1a \u7532\u58f3\u866b\u60f3\u8981\u722c\u4e0a\u9ad8\u5ea6\u4e3a $n$ \u7684\u6811\uff0c\u5f00\u59cb\u4f4d\u4e8e\u6811\u6839\uff0c\u9ad8\u5ea6\u4e3a $0$\uff0c\u5f53\u5b83\u5c1d\u8bd5\u4ece\u9ad8\u5ea6 $i - 1$ \u722c\u5230\u9ad8\u5ea6\u4e3a $i$ \u7684\u4f4d\u7f6e\u65f6\u6709 $Pi$ \u7684\u6982\u7387\u4f1a\u6389\u56de\u6811\u6839\uff0c\u6c42\u5b83\u4ece\u6811\u6839\u722c\u5230\u6811\u9876\u65f6\uff0c\u7ecf\u8fc7\u7684\u65f6\u95f4\u7684\u671f\u671b\u503c\u662f\u591a\u5c11\u3002\n\n\u7528 $dp_{i - 1}$ \u8868\u793a\u4ece\u9ad8\u5ea6 $i - 1$ \u51fa\u53d1\u5230\u9876\u90e8\u82b1\u8d39\u7684\u671f\u671b\u65f6\u95f4\u3002\u53ef\u4ee5\u5f97\u5230\u5982\u4e0b\u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$dp_{i - 1} = P_i \\times dp_{0} + ( 1 - P_i ) \\times dp_i + 1$\n\n$dp_n = 0$\n\n\u5c55\u5f00\u5e76\u7ef4\u62a4\u5176\u7cfb\u6570\u5f97\uff1a\uff08\u8bbe $dp_0$ \u7cfb\u6570\u4e3a $x$\uff0c\u5e38\u6570\u4e3a $y$ \uff09\n\n$dp_0=x \\times dp_0 + y$\n\n\u6240\u4ee5\u6c42\u89e3 $dp_0$ \u5c31\u76f8\u5f53\u4e8e\u6c42\u89e3:\n\n$(x - 1) \\times dp_0 + y \\equiv 0 \\pmod M$\n\n### \u603b\u7ed3\uff1a\u4e3b\u8981\u7528\u5230\u7684\u65b9\u6cd5\u6709\uff1a\u9ad8\u65af\u9006\u5143\u4e0e\u671f\u671bDP\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn = 1e5 + 10;\nconst int MOD = 998244353;\ntypedef long long ll;\nll x[maxn], y[maxn];\nll inv(ll x)\n{\n    return ksm(x, MOD - 2, MOD);\n}\nll extgcd(ll a, ll b, ll&x, ll&y)\n{\n    ll d = a;\n    if(b)\n    {\n       d = extgcd(b, a % b, y, x);\n       y -= (a / b) * x;\n    }\n    else x = 1, y = 0;\n    return d;\n}\nll ksm(ll a, ll b, ll m)\n{\n    ll ans = 1;\n    while(b)\n    {\n        if(b & 1)ans = ans * a % m;\n        b >>= 1;\n        a = a * a % m;\n    }\n    return ans;\n}\n\n\nint main()\n{\n    int n;\n    cin >> n;\n    for(int i = 1; i <= n; i++)\n    {\n        cin >> x[i] >> y[i];\n        ll g = __gcd(x[i], y[i]);\n        x[i] = x[i] / g;\n        y[i] = y[i] / g;\n    }\n    ll a = 0, b = 0;\n    for(int i = n; i >= 1; i--)\n    {\n        ll p = x[i] * inv(y[i]) % MOD, p_1 = (y[i] - x[i]) * inv(y[i]) % MOD;\n        a = (p + p_1 * a) % MOD;\n        b = (1 + p_1 * b) % MOD;\n    }\n    ll c = a - 1, d = MOD, x, y;\n    ll g = extgcd(c, d, x, y);\n    ll x1 = x * (MOD - b) / g;\n    ll y1 = y * (MOD - b) / g;\n    cout<<(x1 % MOD + MOD ) % MOD<<endl;\n    return 0;\n}\n```\n",
        "postTime": 1669455363,
        "uid": 719648,
        "name": "Lord_Sky2048",
        "ccfLevel": 4,
        "title": "\u671f\u671bDP"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://blog.makerlife.top/post/math-expectation/#P8774-%E7%88%AC%E6%A0%91%E7%9A%84%E7%94%B2%E5%A3%B3%E8%99%AB) | [Problem Link](https://www.luogu.com.cn/problem/P8774)\n\n### Explanation\n\n\u6709\u4e00\u53ea\u7532\u58f3\u866b\u60f3\u8981\u722c\u4e0a\u4e00\u9897\u9ad8\u5ea6\u4e3a $n$ \u7684\u6811\uff0c\u5b83\u4e00\u5f00\u59cb\u4f4d\u4e8e\u6811\u6839\uff0c\u9ad8\u5ea6\u4e3a $0$\uff0c\u5f53\u5b83\u5c1d\u8bd5\u4ece\u9ad8\u5ea6 $i-1$ \u722c\u5230\u9ad8\u5ea6\u4e3a $i$ \u7684\u4f4d\u7f6e\u65f6\u6709 $P_{i}$ \u7684\u6982\u7387\u4f1a\u6389\u56de\u6811\u6839\uff0c\u6c42\u5b83\u4ece\u6811\u6839\u722c\u5230\u6811\u9876\u65f6\uff0c\u6bcf\u6b21\u5c1d\u8bd5\u82b1\u8d39 $1$ \u4e2a\u5355\u4f4d\u65f6\u95f4\uff0c\u6c42\u7ecf\u8fc7\u7684\u65f6\u95f4\u7684\u671f\u671b\u503c\u662f\u591a\u5c11\u3002\n\n### Solution\n\n\u8bbe $f_i$ \u8868\u793a\u4ece $i$ \u5230\u6811\u9876 $n$ \u6240\u82b1\u8d39\u65f6\u95f4\u7684\u671f\u671b\u503c\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u8f6c\u79fb\uff0c\u5982\u679c\u8fd9\u6b21\u5c1d\u8bd5\u6210\u529f\uff0c\u5176\u671f\u671b\u4e3a $(1-p_{i+1})f_{i+1}$\u3002\u5982\u679c\u8fd9\u6b21\u5c1d\u8bd5\u5931\u8d25\uff0c\u56de\u5230\u6811\u6839\uff0c\u5219\u5176\u671f\u671b\u4e3a $p_{i+1}f_0$\u3002\n\n\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a\n$$\nf_i=1+(i-p_{i+1}f_{i+1})+p_{i+1}f_0\n$$\n\u89c2\u5bdf\u8f6c\u79fb\u65b9\u7a0b\uff0c\u53d1\u73b0\u5176\u4e2d $f_0$ \u548c $f_{i+1}$ \u9879\u662f\u672a\u77e5\u7684\u3002\u8003\u8651\u5012\u63a8\uff0c\u53ef\u4ee5\u6c42\u51fa $f_{i+1}$\uff0c\u4f46\u65e0\u8bba\u5982\u4f55\u90fd\u65e0\u6cd5\u6c42 $f_0$\uff0c\u6545\u591a\u5199\u51e0\u9879\u5bfb\u627e\u89c4\u5f8b\uff1a\n$$\nf_0=1+(i-p_1f_1)+p_1f_0\\\\ \nf_1=1+(i-p_2f_2)+p_2f_0\\\\ \nf_2=1+(i-p_3f_3)+p_3f_0\n$$\n\u6b64\u65f6\u5373\u53ef\u76f4\u63a5\u89e3\u65b9\u7a0b\uff0c\u8fdb\u884c\u5e26\u5165\uff0c\u5c55\u5f00\u540e\u4e3a\uff1a\n$$\nf_0=1+(1-p_1)+(1-p_1)(1-p_2)f_2+[p_1+(1-p_1)p_2]f_0\n$$\n\u56e0\u4e3a\u9898\u610f\u4e2d $f_n=0$\uff0c\u6240\u4ee5\u539f\u5f0f\u5316\u7b80\u4e3a\uff1a\n$$\nf_0=1+(1-p_1)+[p_1+(1-p_1)p_2]f_0\n$$\n\u5c06\u5176\u8868\u793a\u4e3a $f_0=A+B$ \u5f62\u5f0f\uff0c\u5219\u53ef\u4ee5\u8fdb\u884c\u5bf9\u5e94\uff1a\n$$\nA=1+(1-p_1)+(1-p_1)(1-p_2)+\\cdots+(1-p_1)(1-p_2)\\cdots(1-p_{n-1})\\\\\nB=p_1+p_2(1-p_1)+p_3(1-p_1)(1-p_2)+\\cdots+p_n(1-p_n)\\cdots(1-p_{n-1})\n$$\n$A, B$ \u90fd\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\uff0c\u5219\u672c\u9898\u89e3\u51b3\u3002\n\n\u53e6\u5916\u6ce8\u610f\u5230\u6570\u636e\u8981\u6c42\u8f93\u51fa $\\frac{a}{b}\\bmod P$ \u7684\u7ed3\u679c\uff0c\u9700\u8981\u7528\u5230\u4e58\u6cd5\u9006\u5143\uff0c\u7531\u4e8e $P$ \u4e3a\u8d28\u6570\uff0c\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u8d39\u9a6c\u5c0f\u5b9a\u7406\u6c42\u51fa\u3002\n\n### Core Code\n\n```cpp\nll ksm(ll x,ll y)//\u5feb\u901f\u5e42\n{\n\tll res=1;\n\twhile(y)\n\t{\n\t\tif(y&1) res=res*x%mod;\n\t\tx=x*x%mod;\n\t\ty>>=1;\n\t}\n\treturn res;\n}\nint main()\n{\n\tn=read();\n\tfor(int i=1;i<=n;i++)\n\t{\n        int a=read(),b=read();\n\t\tp1[i]=a*ksm(b,mod-2)%mod;//\u5931\u8d25\u6982\u7387\n\t\tp2[i]=(b-a)*ksm(b,mod-2)%mod;//\u6210\u529f\u6982\u7387\n\t}\n\tA=1;\n\tll t=1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tif(i!=n) A=(A+p2[i]*t%mod)%mod;\n        B=(B+p1[i]*t%mod)%mod;\n\t\tt=(p2[i]*t)%mod;\n\t}\n    write(A*ksm((1-B+mod)%mod,mod-2)%mod);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1685173267,
        "uid": 335621,
        "name": "makerlife",
        "ccfLevel": 4,
        "title": "P8774 \u722c\u6811\u7684\u7532\u58f3\u866b \u9898\u89e3"
    },
    {
        "content": "\u8bbe\u7f6e\u72b6\u6001 $f_{i}$ \u8868\u793a\u4ece\u9ad8\u5ea6 $i$ \u5230\u9ad8\u5ea6 $n$ \u7684\u671f\u671b\u65f6\u95f4\uff0c\u8003\u8651\u5982\u4f55\u8f6c\u79fb\uff1a\n\u9996\u5148\u4ece $i$ \u5230 $i+1$ \u4e00\u5b9a\u9700\u89811\u7684\u65f6\u95f4\uff0c\u7136\u540e\u5982\u679c\u7532\u58f3\u866b\u6210\u529f\u722c\u4e0a\u53bb\uff0c\u5176\u671f\u671b\u4e3a $(1-P_{i+1})f_{i+1}$  \u5982\u679c\u6389\u4e0b\u6765\u4e86\uff0c\u5176\u671f\u671b\u4e3a $P_{i+1}f_{0}$\n\u663e\u7136\u53ef\u4ee5\u5f97\u5230\uff1a  \n$f_{i}=1+(1-P_{i+1})f_{i+1}+P_{i+1}f_{0}$  \n\n\u4f46\u662f\uff0c\u4f46\u662f\uff0c\u4f46\u662f\uff0c\u5176\u4e2d\u51fa\u73b0\u4e86\u4e00\u4e2a\u6211\u4eec\u8fd8\u4e0d\u77e5\u9053\u7684\u72b6\u6001\uff1a$f_{0}$  \n\u4e0d\u7740\u6025\uff0c\u5148\u679a\u4e3e\u4e00\u4e0b $n=3$ \u7684\u60c5\u51b5:  \n$f_{0}=1+(1-P_{1})f_{1}+P_{1}f_{0}$  \n$f_{1}=1+(1-P_{2})f_{2}+P_{2}f_{0}$  \n$f_{2}=1+(1-P_{3})f_{3}+P_{3}f_{0}$  \n\u8003\u8651\u53bb\u89e3\u51b3\u4e00\u4e0b\u5b83\uff0c\u53ef\u4ee5\u628a $f_{1}$ \u5e26\u5165\u5230$f_{0}$ \u4e2d\uff0c\u628a $f_{2}$\u5e26\u5165\u5230 $f_{1}$\u4e2d\u53bb\u53c8\u56e0\u4e3a $n=3$ , \u6240\u4ee5 $f_{3}=0$\n\u4e8e\u662f\uff0c\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a\u5173\u4e8e $f_{0}$\u7684\u65b9\u7a0b\uff1a  \n$f_{0}=1+(1-P_{1})+(1-P_{1})(1-P_{2})+(P_{1}+(1-P_{1})P_{2}+(1-P_{1})(1-P_{2})P_{3}f_{0}$\n\n\u7136\u540e\uff0c\u5c31\u5f88\u5bb9\u6613\u53d1\u73b0\u89c4\u5f8b\uff1a\n\u5982\u679c  \n$f_{0}=A+Cf_{0}$\n\n\u90a3\u4e48  \n$A=1+(1-P_{1})+(1-P_{1})(1- P_{2})+...+(1-P_{1})(1-P_{2})...(1-P_{n-1})$  \n\n$C=P_{1} + P_{2} (1 - P_{1} )+P_{3} (1-P_{2})(1-P_{1})+...+P_{n}(1-P_{n-1})$\n\u4e8e\u662f\u8fd9\u9053\u9898\u5c31\u5f88\u5feb\u4e50\u5730\u89e3\u51b3\u6389\u4e86\uff0c\u552f\u4e00\u8fd8\u8981\u6ce8\u610f\u7684\u662f\u8981\u6c42\u9006\u5143\uff0c\u56e0\u4e3a\u6a21\u6570\u662f\u8d28\u6570\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528\u8d39\u9a6c\u5c0f\u5b9a\u7406\u3002\n\n# CODE\n\n```cpp\n#include<iostream>\n#include<cstdio>\nusing namespace std;\nlong long x[100005],y[100005];\nlong long mod=998244353;\nlong long ksm(int x,int y){\n\tlong long ans=1,base=x;\n\twhile(y){\n\t\tif(y&1)ans=(ans*base)%mod;\n\t\tbase=(base*base)%mod;\n\t\ty>>=1;\n\t}return ans;\n}long long fs(long long x,long long y){\n\treturn x%mod*ksm(y,mod-2)%mod;\n}\nint main(){\n\tint n;\n\tscanf(\"%d\",&n);\n\tlong long A=0,C=0;\n\tfor(int i=1; i<=n; i++){\n\t\tscanf(\"%d %d\",&x[i],&y[i]);\n\t}long long now=1;\n\tfor(int i=1; i<=n; i++){\n\t\tA=(A+now)%mod;\n\t\tC=(C+now*fs(x[i],y[i])%mod)%mod;\n\t\tnow=now*fs(y[i]-x[i],y[i])%mod;\n\t}\n\tC=(1-C+mod)%mod;\n\tprintf(\"%d\",fs(A,C));\n\treturn 0;\n}\n```\n",
        "postTime": 1685160114,
        "uid": 323849,
        "name": "kkksc03wzl",
        "ccfLevel": 5,
        "title": "[\u84dd\u6865\u676f 2022 \u7701 A] \u722c\u6811\u7684\u7532\u58f3\u866b \u9898\u89e3"
    }
]