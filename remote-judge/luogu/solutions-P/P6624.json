[
    {
        "content": "$2020.6.23\\ \\ \\mathrm{update}:$ \u52a0\u5165\u4ee3\u7801\u3002\n\n---\n\n\u6b64\u6b21\u7701\u9009\u6211\u552f\u4e00\u5207\u6389\u7684\u9898\u76ee\uff08\u5e76\u4e14\u5728\u4e0d FST \u7684\u60c5\u51b5\u4e0b\uff09\uff08\u6342\u8138\n\n---\n\n\n\n\u9996\u5148\u8fd9\u9898\u975e\u5e38\u7684 \u201c\u4e8c\u5408\u4e00\u201d\u3002\u524d\u9762\u7684\u5316\u5f0f\u5b50\u548c\u540e\u9762\u77e9\u9635\u6811\u5b9a\u7406\u7684\u4f7f\u7528\u57fa\u672c\u4e0a\u5272\u88c2\u5f00\u4e86\uff0c\u90a3\u6211\u4e5f\u5c31\u5206\u5f00\u6765\u8bb2\u3002\n\n## Part 1\uff1a\u5316\u7b80\u5f0f\u5b50\n\n\u540e\u9762\u4e00\u5768 $\\gcd$ \u9700\u8981\u53cd\u6f14\u6389\uff0c\u6bd4\u8f83\u61d2\u7684\u8bdd\u76f4\u63a5\u5957\u8fd9\u4e2a\u4f17\u6240\u5468\u77e5\u7684\u5f0f\u5b50\u5c31\u884c\uff1a\n\n$$\\varphi*1=\\mathrm{id}$$\n\n\u7136\u540e\u628a $\\varphi$ \u63d0\u5230\u524d\u9762\u6765\uff0c\u65b9\u4fbf\u4e4b\u540e\u4f7f\u7528\u77e9\u9635\u6811\u5b9a\u7406\u3002\n\n\u5177\u4f53\u63a8\u5f0f\u5b50\u8fc7\u7a0b\u5982\u4e0b\uff1a\n\n$$\\begin{aligned}\n\\text{answer}&=\\sum\\limits_{T}\\left(\\sum\\limits_{i=1}^{n-1}w_{e_i}\\right)\\times\\gcd(w_{e_1},\\cdots,w_{e_{n-1}}) \\\\\n\n&=\\sum\\limits_{T}\\left(\\sum\\limits_{i=1}^{n-1}w_{e_i}\\right)\\times\\sum\\limits_{d\\mid w_{e_1},\\cdots,d\\mid w_{e_{n-1}}}\\varphi(d) \\\\\n\n&=\\sum\\limits_{d=1}^{mx}\\varphi(d)\\sum\\limits_{T\\atop d\\mid w_{e_1},\\cdots,d\\mid w_{e_{n-1}}}\\left(\\sum\\limits_{i=1}^{n-1}w_{e_i}\\right)\n\\end{aligned}$$\n\n\n\uff08\u5176\u4e2d $mx$ \u4e3a $w_i$ \u7684\u6700\u5927\u503c\u3002\uff09\n\n---\n\n## Part 2\uff1a\u77e9\u9635\u6811\u5b9a\u7406\u7684\u4f7f\u7528\n\n\u5916\u5c42\u679a\u4e3e $d$\uff0c\u91cc\u5c42\u90a3\u4e00\u5768\u5c31\u9700\u8981\u77e9\u9635\u6811\u5b9a\u7406\u6765\u5904\u7406\u4e86\u3002\n\n\u6c42\u6240\u6709\u751f\u6210\u6811\u7684\u8fb9\u6743\u548c\u662f\u88ab\u51fa\u70c2\u7684\u8001\u7ecf\u5178\u9898\u4e86\u3002\u3002\u3002\n\n\u9996\u5148\u8003\u8651 $w_i$ \u90fd\u76f8\u540c\u7684\u60c5\u51b5\uff1a\u76f4\u63a5\u5957\u6a21\u677f\u5373\u53ef\uff0c\u6700\u540e\u7b54\u6848\u4e58\u4e0a $w_i$ \u5b8c\u4e8b\u3002\n\n\u6709\u4e0d\u540c\u7684\u60c5\u51b5\u5c31\u5148\u8003\u8651\u4e00\u79cd\u6700\u88f8\u7684\u505a\u6cd5\uff1a\u679a\u4e3e\u4e00\u6761\u8fb9\u7136\u540e\u6c42\u5305\u542b\u8fd9\u6761\u8fb9\u7684\u751f\u6210\u6811\u4e2a\u6570\u3002\n\n\u6709\u6728\u6709\u65b9\u6cd5\u628a\u6240\u6709\u8fb9\u7684\u7b54\u6848\u7684\u548c\u7ecf\u8fc7\u6c42\u4e00\u6b21\u884c\u5217\u5f0f\u5c31\u5168\u90e8\u7b97\u51fa\u6765\uff1f\n\n\u8fd8\u771f\u6709\uff0c\u77e9\u9635\u6bcf\u4e2a\u4f4d\u7f6e\u653e\u4e2a\u4e00\u6b21\u51fd\u6570\uff08\u4e00\u6b21\u591a\u9879\u5f0f\uff09\u5373\u53ef\u3002\n\n\u4e00\u6761\u8fb9\u7684\u8d21\u732e\u73c2\u4ee5\u5199\u6210 $w_ix+1$\uff0c\u6700\u540e\u7b54\u6848\u5c31\u662f\u884c\u5217\u5f0f\u7684\u4e00\u6b21\u9879\u7cfb\u6570\u3002\n\n\u6495\u70e4\u4e00\u4e0b\u4e3a\u4ec0\u4e48\uff1f\n\n\u7b54\u6848\u5b9e\u9645\u4e0a\u662f\u6c42 \u94a6\u5b9a\u4e00\u6761\u8fb9\u4e4b\u540e\u7684\u751f\u6210\u6811\u4e2a\u6570$\\times$\u8fd9\u6761\u8fb9\u7684\u8fb9\u6743 \u4e4b\u548c\uff0c\u90a3\u4e48\u7b54\u6848\u91cc\u88ab\u4e58\u4e0a\u4e00\u6b21\u9879\u7cfb\u6570\u7684\u8fb9\u5c31\u662f\u88ab\u94a6\u5b9a\u7684\u8fb9\u3002\n\n\u4e0b\u9762\u5c31\u662f\u4e00\u4e0b\u591a\u9879\u5f0f\u64cd\u4f5c\u4e86\uff1a$a+bx$ \u548c $c+dx$ \u7684\u56db\u5219\u8fd0\u7b97\u89c4\u5219\n\n\u52a0\u51cf\u5c31\u76f4\u63a5\u5bf9\u5e94\u9879\u9879\u52a0/\u51cf\uff0c\u4e0d\u8bf4\u4e86\u3002\n\n\u4e58\u6cd5\uff1a$(a+bx)(c+dx)=ac+(ad+bc)x$\u3002\n\n\u9664\u6cd5\uff1a$\\dfrac{a+bx}{c+dx}=\\dfrac{a}{c}+\\dfrac{bc-ad}{c^2}x$\n\n\u5bf9\u4e8e\u679a\u4e3e\u7684\u6bcf\u4e2a $d$ \u90fd\u6c42\u4e00\u904d\u884c\u5217\u5f0f\u7684\u8bdd\u590d\u6742\u5ea6\u662f $\\mathcal{O}(n^3mx)$\uff0c\u4e0d\u77e5\u9053\u80fd\u4e0d\u80fd\u8fc7\u3002\n\n\u4e0d\u8fc7\u73c2\u4ee5\u4f18\u5316\uff0c\u53ea\u5bf9\u53ef\u9009\u8fb9\u6570\u5927\u4e8e\u7b49\u4e8e $n-1$ \u7684 $d$ \u6c42\u884c\u5217\u5f0f\u5373\u53ef\uff0c\u8fd9\u6837\u590d\u6742\u5ea6\u5c31\u4f18\u5316\u5230\u4e86$\\mathcal{O}(n^2\\sum\\sigma_0(w_i))$\n\uff0c\u4e0a\u754c\u662f $144\\times n^4$\uff0c\u5b9e\u9645\u5b8c\u5168\u8dd1\u4e0d\u6ee1\u3002\n\n\u6ce8\uff1a\u8fd9\u4e2a $n^2\\sum\\sigma_0(w_i)$ \u5176\u5b9e\u5c31\u662f $n^3\\frac{\\sum\\sigma_0(w_i)}{n-1}$\u3002\n\n---\n\n***code:***\n\n```cpp\n#include<iostream>\n#include<cstring>\n#include<cstdio>\nusing namespace std;\nconst int mod=998244353;\n#define N 33\n#define M 200020\ninline int read(){\n\tint x=0,f=1;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9'){\n\t\tif(c=='-')f=-1;\n\t\tc=getchar();\n\t}\n\twhile(c>='0'&&c<='9'){\n\t\tx=(x<<1)+(x<<3)+c-'0';\n\t\tc=getchar();\n\t}\n\treturn x*f;\n}\ntypedef pair<int,int> pii;\nint n,m,ans,h[M];\nint qpow(int a,int b){\n\tint ans=1;\n\twhile(b){\n\t\tif(b&1)ans=1LL*ans*a%mod;\n\t\ta=1LL*a*a%mod;\n\t\tb>>=1;\n\t}\n\treturn ans;\n}\npii g[N][N]; //(\u5e38\u6570\u9879\u7cfb\u6570,\u4e00\u6b21\u9879\u7cfb\u6570)\npii operator +(const pii a,const pii b){\n\treturn make_pair((a.first+b.first)%mod,(a.second+b.second)%mod);\n}\npii operator -(const pii a,const pii b){\n\treturn make_pair((a.first-b.first+mod)%mod,(a.second-b.second+mod)%mod);\n}\npii operator *(const pii a,const pii b){\n\treturn make_pair(1LL*a.first*b.first%mod,(1LL*a.first*b.second+1LL*a.second*b.first)%mod);\n}\npii operator /(const pii a,const pii b){\n\tint inv=qpow(b.first,mod-2);\n\treturn make_pair(1LL*a.first*inv%mod,(1LL*a.second*b.first%mod-1LL*a.first*b.second%mod+mod)%mod*inv%mod*inv%mod);\n}\nint x[N*N],y[N*N],w[N*N],mx;\nint p[M],pn,phi[M];\nbool ntp[M];\nvoid init(int n){\n\tphi[1]=ntp[1]=1;\n\tfor(int i=2;i<=n;++i){\n\t\tif(!ntp[i])p[++pn]=i,phi[i]=i-1;\n\t\tfor(int j=1;j<=pn&&p[j]*i<=n;++j){\n\t\t\tntp[p[j]*i]=true;\n\t\t\tif(i%p[j]==0){\n\t\t\t\tphi[p[j]*i]=phi[i]*p[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[p[j]*i]=phi[i]*(p[j]-1);\n\t\t}\n\t}\n}\npii Guass(int n){\n\tpii ans=make_pair(1,0);\n\tbool rev=false;\n\tfor(int i=1;i<=n;++i){\n\t\tif(!g[i][i].first){\n\t\t\tfor(int j=i+1;j<=n;++j){\n\t\t\t\tif(g[j][i].first){\n\t\t\t\t\trev^=1;\n\t\t\t\t\tswap(g[i],g[j]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tpii inv=make_pair(1,0)/g[i][i];\n\t\tfor(int j=i+1;j<=n;++j){\n\t\t\tpii div=g[j][i]*inv;\n\t\t\tfor(int k=i;k<=n;++k){\n\t\t\t\tg[j][k]=g[j][k]-div*g[i][k];\n\t\t\t}\n\t\t}\n\t\tans=ans*g[i][i];\n\t}\n\treturn rev?make_pair(0,0)-ans:ans;\n}\nint Solve(int t){\n\tmemset(g,0,sizeof(g));\n\tfor(int i=1;i<=m;++i){\n\t\tif(w[i]%t)continue;\n\t\tg[x[i]][x[i]]=g[x[i]][x[i]]+make_pair(1,w[i]);\n\t\tg[y[i]][y[i]]=g[y[i]][y[i]]+make_pair(1,w[i]);\n\t\tg[x[i]][y[i]]=g[x[i]][y[i]]-make_pair(1,w[i]);\n\t\tg[y[i]][x[i]]=g[y[i]][x[i]]-make_pair(1,w[i]);\n\t}\n\treturn Guass(n-1).second;\n}\nvoid check(int x){\n\tfor(int i=1;i*i<=x;++i){\n\t\tif(x%i==0){\n\t\t\t++h[i];\n\t\t\tif(i*i!=x)++h[x/i];\n\t\t}\n\t}\n}\nint main(){\n\tfreopen(\"count.in\",\"r\",stdin);\n\tfreopen(\"count.out\",\"w\",stdout);\n\tn=read(),m=read();\n\tfor(int i=1;i<=m;++i){\n\t\tx[i]=read(),y[i]=read(),w[i]=read();\n\t\tcheck(w[i]);\n\t\tmx=max(mx,w[i]);\n\t}\n\tinit(mx);\n\tfor(int i=1;i<=mx;++i){\n\t\tif(h[i]<n-1)continue;\n\t\tans=(ans+1LL*phi[i]*Solve(i))%mod;\n\t}\n\tcout<<ans<<endl;\n\treturn 0;\n}\n```\n\n[*Froggy's blog*](https://www.luogu.org/blog/1445353309froggy/)\n\n#### \u5471!!\n\n\n",
        "postTime": 1592787045,
        "uid": 100285,
        "name": "Froggy",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6624 \u3010[2020 \u5e74\u8054\u8003 A \u5377] \u4f5c\u4e1a\u9898\u3011"
    },
    {
        "content": "\n\u8fd9\u4e00\u7bc7\u4f1a\u8be6\u7ec6\u89e3\u91ca\u5427\u3002\n\n\n\u770b\u5230\u8fd9\u4e2a\u67ff\u5b50\n\n$val(T) = {\\large{\\left(\\sum_{i=1}^{n-1} w_{e_i}\\right)}} \\times \\gcd(w_{e1}, w_{e2},...,w_{e_{n-1}})$\n\n\u9996\u5148\u8003\u8651\u6b27\u62c9\u53cd\u6f14\u3002\n\n$x = \\sum_{d|x} \\varphi(d)$\n\n\n\u7136\u540e\u539f\u5f0f\u53d8\u6210\n\n$val(T) = {\\large{\\left(\\sum_{i=1}^{n-1} w_{e_i}\\right)}} \\times \\sum_{d| \\gcd(w_{e1}, w_{e2},...,w_{e_{n-1}})} \\varphi(d)$\n\n\u679a\u4e3e $d$\n\n$\\sum_{d} \\varphi(d) \\times \\sum_T  {\\large{\\left(\\sum_{i=1}^{n-1} w_{e_i}\\right)}}$\n\n\n\u7136\u540e\u6211\u4eec\u53ea\u5173\u5fc3\u8fd9\u4e2a\u90e8\u5206 $\\sum_T  {\\large{\\left(\\sum_{i=1}^{n-1} w_{e_i}\\right)}}$ \u600e\u4e48\u7b97\u3002\n\n\u4f17\u6240\u5468\u77e5\u666e\u901a\u7684\u77e9\u9635\u6811\u5b9a\u7406\u53ea\u9002\u7528\u4e8e\u6c42 $\\sum_T \\prod (w_{e_1}, w_{e_2}, ..., w_{e_{n-1}})$\n\n\uff08\u6240\u4ee5\u5982\u679c\u60f3\u6c42\u751f\u6210\u6811\u4e2a\u6570\u76f4\u63a5\u4ee4\u6240\u6709\u7684\u8fb9 $w=1$\uff09\n\n\u7136\u540e\u8fd9\u9898\u7684\u91cd\u8981\u5957\u8def\u5c31\u51fa\u6765\u4e86\u3002\n\n\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a $1+w_ix$\n\n$\\prod_{i} (1+w_ix)$ \u7684\u4e00\u6b21\u9879\u7cfb\u6570\u5c31\u662f\u8fd9\u4e2a $\\sum$ \u7684\u503c\u3002\n\n\u8fd9\u6837\u7684\u8bdd\u5176\u4ed6\u9879\u5c31\u6ca1\u4ec0\u4e48\u4f5c\u7528\u4e86\u3002\n\n\u610f\u601d\u662f\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u5e38\u6570\u9879\u548c\u4e00\u6b21\u9879\u5c31\u591f\u4e86\u3002\n\n\u7136\u540e\u53d8\u6210\u4e86\u591a\u9879\u5f0f\u64cd\u4f5c\u3002\n\n```cpp\n// x \u662f\u5e38\u6570\u9879\uff0c y \u662f\u4e00\u6b21\u9879\u7cfb\u6570\u3002\ninline pair operator+(pair a, pair b) {\n  static pair res;\n  res.x = (a.x + b.x) % MOD;\n  res.y = (a.y + b.y) % MOD;\n  return res;\n}\ninline pair operator-(pair a, pair b) {\n  static pair res;\n  res.x = (a.x - b.x + MOD) % MOD;\n  res.y = (a.y - b.y + MOD) % MOD;\n  return res;\n}\ninline pair operator*(pair a, pair b) {\n  static pair res;\n  res.x = 1ll * a.x * b.x % MOD;\n  res.y = (1ll * a.x * b.y + 1ll * a.y * b.x) % MOD;\n  return res;\n}\ninline pair operator/(pair a, pair b) {\n  static pair res;\n  int iv = qpow(b.x, MOD - 2);\n  res.x = 1ll * a.x * iv % MOD;\n  res.y = ((1ll * a.y * b.x - 1ll * a.x * b.y) % MOD + MOD) % MOD * iv % MOD * iv % MOD;\n  return res;\n}\n```\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u52a0\u6cd5\u548c\u51cf\u6cd5\u90fd\u5f88 simple\u3002\n\n\u8fd9\u4e2a\u4e58\u6cd5\u76f4\u63a5\u5c55\u5f00\u5c31\u884c\u4e86\uff0c\u8fd9\u4e2a\u9664\u6cd5\u7684\u8bdd\u6709\u70b9\u96be\u7406\u89e3\u3002\n\n$\\frac{a + bx}{c + dx} = \\frac{a}{c} + \\frac{bc - ad}{c^2}x$\n\n\u7136\u540e\u5e38\u6570\u9879\u548c\u8fd9\u4e2a\u90fd\u51fa\u6765\u4e86\u3002\n\u8fd9\u4e2a\u600e\u4e48\u6c42\u51fa\u6765\u7684\u5462\uff1f~~\u591a\u9879\u5f0f\u6c42\u9006~~\n\n\u6211\u4eec\u5148\u6c42\u51fa\u6765 $\\frac{1}{c+dx}$\uff0c\u7136\u540e\u518d\u4e58\u8d77\u6765\u3002\n\n\u4ee4 $C+Dx = \\frac{1}{c+dx}$\u3002\n\n\u5373 $(C+Dx)(c+dx) = 1 (\\mod x^2)$\n\n$C \\times c = 1$ \u5373 $C = \\frac{1}{c}$\n\n\u56e0\u4e3a $Cdx + cDx = 0$\n\n$\\frac{d}{c} + cD = 0$\uff0c$D = -\\frac{d}{c^2}$\n\n\n\u7136\u540e $(a+bx) (C+Dx) = (a+bx)\\frac{1}{c+dx} =  \\frac{a}{c} + \\frac{bc - ad}{c^2}x$\n\n\u5c31\u6ca1\u4e86\u3002\n\n```cpp\n#include <bits/stdc++.h>\nconst int MOD = 998244353;\ninline int qpow(int x, int y) {\n  int res = 1;\n  while (y) {\n    if (y & 1) {\n      res = 1ll * res * x % MOD;\n    }\n    x = 1ll * x * x % MOD;\n    y >>= 1;\n  }\n  return res;\n}\n\nstruct pair {\n  int x, y;\n  pair() { x = y = 0; }\n  pair(int _x, int _y) { x = _x, y = _y; }\n};\ninline pair operator+(pair a, pair b) {\n  static pair res;\n  res.x = (a.x + b.x) % MOD;\n  res.y = (a.y + b.y) % MOD;\n  return res;\n}\ninline pair operator-(pair a, pair b) {\n  static pair res;\n  res.x = (a.x - b.x + MOD) % MOD;\n  res.y = (a.y - b.y + MOD) % MOD;\n  return res;\n}\ninline pair operator*(pair a, pair b) {\n  static pair res;\n  res.x = 1ll * a.x * b.x % MOD;\n  res.y = (1ll * a.x * b.y + 1ll * a.y * b.x) % MOD;\n  return res;\n}\ninline pair operator/(pair a, pair b) {\n  static pair res;\n  int iv = qpow(b.x, MOD - 2);\n  res.x = 1ll * a.x * iv % MOD;\n  res.y = ((1ll * a.y * b.x - 1ll * a.x * b.y) % MOD + MOD) % MOD * iv % MOD * iv % MOD;\n  return res;\n}\n\ninline int solve(std::vector<std::vector<pair>> g, int n) {\n  pair ans = pair(1, 0);\n  bool rev = false;\n  for (int i = 0; i < n; i++) {\n    if (g[i][i].x == 0) {\n      for (int j = i + 1; j < n; j++) {\n        if (g[j][i].x) {\n          rev ^= 1;\n          swap(g[i], g[j]);\n          break;\n        }\n      }\n    }\n    pair inv = pair(1, 0) / g[i][i];\n    for (int j = i + 1; j < n; j++) {\n      pair div = g[j][i] * inv;\n      for (int k = i; k < n; k++) {\n        g[j][k] = g[j][k] - div * g[i][k];\n      }\n    }\n  }\n  for (int i = 0; i < n; i++) {\n    ans = ans * g[i][i];\n  }\n  if (rev) {\n    return (pair(0, 0) - ans).y;\n  } else {\n    return ans.y;\n  }\n}\n\nint main() {\n  std::ios::sync_with_stdio(false);\n  std::cin.tie(nullptr);\n  int n, m;\n  std::cin >> n >> m;\n  std::vector<int> x(m), y(m), w(m);\n  int MAX = 0;\n  for (int i = 0; i < m; i++) {\n    std::cin >> x[i] >> y[i] >> w[i];\n    --x[i], --y[i];\n    MAX = std::max(MAX, w[i]);\n  }\n  MAX++;\n  std::vector<int> divisor_cnt(MAX, 0);\n  auto getDivisor = [&](int x) {\n    for (int i = 1; i <= sqrt(x); i++) {\n      if (x % i == 0) {\n        ++divisor_cnt[i];\n        if (i * i != x) {\n          ++divisor_cnt[x / i];\n        }\n      }\n    }\n  };\n  for (int i = 0; i < m; i++) {\n    getDivisor(w[i]);\n  }\n  std::vector<int> phi(MAX, 0);\n  phi[1] = 1;\n  for (int i = 2; i < MAX; i++) {\n    if (!phi[i]) {\n      phi[i] = i - 1;\n      for (int j = i * 2; j < MAX; j += i) {\n        if (!phi[j]) {\n          phi[j] = j;\n        }\n        phi[j] = phi[j] / i * (i - 1);\n      }\n    }\n  }\n  long long ans = 0;\n  auto getmat = [&](int div) {\n    std::vector<std::vector<pair>> g(n, std::vector<pair>(n));\n    for (int i = 0; i < m; i++) {\n      if (w[i] % div) {\n        continue;\n      } else {\n        int u = x[i], v = y[i];\n        g[u][u] = g[u][u] + pair(1, w[i]);\n        g[v][v] = g[v][v] + pair(1, w[i]);\n        g[u][v] = g[u][v] - pair(1, w[i]);\n        g[v][u] = g[v][u] - pair(1, w[i]);\n      }\n    }\n    return g;\n  };\n  for (int i = 1; i < MAX; i++) {\n    if (divisor_cnt[i] < n - 1) {\n      continue;\n    } else {\n      ans = (ans + 1ll * phi[i] * solve(getmat(i), n - 1)) % MOD;\n    }\n  }\n  std::cout << ans << '\\n';\n  return 0;\n}\n```\n",
        "postTime": 1593062755,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6624 \u3010[\u7701\u9009\u8054\u8003 2020 A \u5377] \u4f5c\u4e1a\u9898\u3011"
    },
    {
        "content": "\n$upd:$ \u7ecf\u9c7c\u9c7c\u63d0\u9192$,$\u4fee\u6539\u4e86\u4e00\u5904\u6709\u6b67\u4e49\u7684\u8868\u8ff0$.$\n\n\n\u8d34\u4e00\u4e2a[hack\u6570\u636e](https://www.luogu.com.cn/problem/U120185),\u53ef\u4ee5\u770b\u770b$O(n^3m\\times d)$\u7684\u66b4\u529b\u4f1a\u4e0d\u4f1a$T,$\u4e0d\u4fdd\u8bc1\u80fd\u5361\u6389\n\n\u8bb0 $ans_d$ \u4e3a \u8fb9\u6743 $gcd$ \u662f $d$ \u7684\u500d\u6570\u7684\u6240\u6709\u751f\u6210\u6811\u7684\u8fb9\u6743\u548c\u7684\u548c $.$\n\n\u8bb0 $sum_d$ \u4e3a \u8fb9\u6743 $gcd$ \u6b63\u597d\u7b49\u4e8e $d$ \u7684\u6240\u6709\u751f\u6210\u6811\u7684\u8fb9\u6743\u548c\u7684\u548c $.$\n\n\u5982\u679c\u8ba1\u7b97\u51fa\u4e86\u6240\u6709$ans_d$ $,$\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5728 $O(n\\ln n)$\u7684\u590d\u6742\u5ea6\u5185 \u8ba1\u7b97\u51fa$sum_d.$\n\n\u4e5f\u53ef\u4ee5\u53cd\u6f14$,$\u4f46\u662f\u8fd9\u4e2a\u4e0d\u5728\u590d\u6742\u5ea6\u4e0a$.$\n\n\u8003\u8651\u5982\u4f55\u6c42\u51fa$ans_d.$\n\n\u679a\u4e3e\u6bcf\u4e2a$d,$\u8003\u8651\u6c42\u53ea\u4fdd\u7559$w_i$\u662f$d$\u7684\u500d\u6570\u7684\u8fb9$,$\u6c42\u51fa\u6240\u6709\u751f\u6210\u6811\u7684\u8fb9\u6743\u548c\u7684\u548c$.$\n\n\u9996\u5148\u9664\u53bb\u56fe\u4e0d\u8fde\u901a\u7684\u60c5\u51b5$.$\u53ef\u4ee5\u8bc1\u660e\u5269\u4e0b\u7684\u60c5\u51b5\u603b\u6570\u53ea\u6709 $O(n \\times d)$ \u79cd $,$ \u5176\u4e2d $d$ \u4e3a\u503c\u57df\u5185\u7684\u6570\u4e2d\u6700\u5927\u7684\u7ea6\u6570\u4e2a\u6570 $,$ \u5176\u503c\u4e3a $144.$\n\n\u7136\u540e\u5bf9\u4e8e\u4e00\u6761\u8fb9 $,$ \u6211\u4eec\u628a\u8fb9\u6743 $w$ \u8bb0\u6210\u4e00\u4e2a\u4e00\u6b21\u5f0f $,$ $1+wx.$\n\n\u7136\u540e\u4f60\u4f1a\u53d1\u73b0\u5bf9\u8fd9\u4e2a\u6c42\u77e9\u9635\u6811\u5b9a\u7406 $,$ \u53d6\u7b54\u6848\u7684\u4e00\u6b21\u9879\u7cfb\u6570 $,$ \u5c31\u53ef\u4ee5\u6b63\u786e\u6c42\u51fa\u7b54\u6848 $.$\n\n\u590d\u6742\u5ea6 $O(n^4d).$\n\n---\n\n\u5173\u4e8e\u5982\u4f55\u5bf9\u4e00\u6b21\u51fd\u6570\u6c42\u77e9\u9635\u6811\u5b9a\u7406$?$\n\n\u96be\u70b9\u5728\u4e8e\u6c42\u9006\u5143 $.$\n\n\u4f46\u662f\u4f60\u4f1a\u53d1\u73b0 , $(1-ax)^{-1} \\equiv 1+ax \\pmod{x^2},$ \u90a3\u4e48\u6c42\u9006\u7684\u95ee\u9898\u5c31\u89e3\u51b3\u4e86 $.$\n\n---\n\n\u5173\u4e8e\u4ec0\u4e48\u662f $O(n\\ln n)$ \u7684\u5bb9\u65a5 $:$ ~~\u5982\u679c\u4e0d\u4f1a\u5efa\u8bae\u91cd\u5b66\u5bb9\u65a5~~\n\n\u4ece\u5927\u5230\u5c0f\u6c42\u7b54\u6848$,$\u679a\u4e3e\u500d\u6570\u5bb9\u65a5\u6389\u5c31\u53ef\u4ee5\u4e86 $.$\n\n---\n\n\u8003\u573a\u4ee3\u7801 $:$\n```cpp\n#include <bits/stdc++.h>\n#define LL long long\nusing namespace std;\nconst int P = 998244353,N = 32;\ninline int power(int x,int y){\n\tstatic int r; r = 1; while (y){ if (y&1) r = (LL)r * x % P; x = (LL)x * x % P; y >>= 1; } return r;\n}\ninline void upd(int &x,int y){ x = (x+y>=P)?(x+y-P):(x+y); }\nstruct Function{\n\tint a0,a1;\n\tFunction(int a00 = 0,int a11 = 0){ a0 = a00,a1 = a11; }\n};\nFunction operator + (Function A,Function B){\n\tstatic Function tmp; tmp = A,upd(tmp.a0,B.a0),upd(tmp.a1,B.a1);\n\treturn tmp;\n}\nFunction operator - (Function A,Function B){\n\tstatic Function tmp; tmp = A,upd(tmp.a0,P-B.a0),upd(tmp.a1,P-B.a1);\n\treturn tmp;\n}\nFunction operator * (Function A,Function B){\n\treturn Function((LL)A.a0 * B.a0 % P,((LL)A.a1 * B.a0 + (LL)A.a0 * B.a1)%P);\n}\nFunction Inv(Function X){\n\tstatic int w;\n\tif (X.a0 != 1){\n\t\tw = power(X.a0,P-2); w = (LL)w * w % P;\n\t\tX.a0 = (LL)X.a0 * w % P; X.a1 = (LL)X.a1 * w % P;\n\t} \n\tX.a1 = X.a1 ? (P-X.a1) : 0;\n\treturn X;\n}\nstruct Union_Find_Set{\n\tint n,fa[N],siz;\n\tinline void init(){ for (int i = 1; i <= n; ++i) fa[i] = i; siz = n; }\n\tinline int Find(int x){ return x == fa[x] ? x : (fa[x] = Find(fa[x])); }\n\tinline void Merge(int x,int y){\n\tx = Find(x),y = Find(y);\n\tif (x!=y) fa[x]=y,--siz;\n\t}\n\tinline bool ok(){ return siz == 1; }\n}S;\nint mxw;\nint n,m,ex[N*N],ey[N*N],ew[N*N];\nFunction d[N][N],g[N][N],A[N][N]; int G[N][N];\nint solve(){\n\tFunction Ans = Function(1,0),tmp;\n\tint i,j,k,x;\n\tfor (i = 2; i <= n; ++i){\n\t\tx = -1;\n\t\tfor (j = i; j <= n; ++j) if (A[j][i].a0){ x = j; break; }\n\t\tif (x == -1) return 0;\n\t\tif (x != i) for (j = i; j <= n; ++j) swap(A[i][j],A[x][j]);\n\t\tAns = Ans * A[i][i],tmp = Inv(A[i][i]); for (j = i; j <= n; ++j) A[i][j] = A[i][j] * tmp;\n\t\tfor (j = i+1; j <= n; ++j)\n\t\tfor (tmp = A[j][i],k = i; k <= n; ++k) A[j][k] = (A[j][k] - tmp * A[i][k]);\n\t}\n\treturn Ans.a1;\n}\ninline int work(int dd){\n\tint i,j;\n\tS.init(); static Function t;\n\tfor (i = 1; i <= n; ++i) for (j = i+1; j <= n; ++j) if (G[i][j] && G[i][j] % dd == 0) S.Merge(i,j);\n\tif (!S.ok()) return 0;\n\tfor (i = 1; i <= n; ++i) for (j = 1; j <= n; ++j) d[i][j] = g[i][j] = Function(0,0);\n\tfor (i = 1; i <= n; ++i) for (j = i+1; j <= n; ++j) if (G[i][j] && G[i][j] % dd == 0)\n\t\tg[i][j] = g[j][i] = t = Function(1,G[i][j]),d[i][i] = d[i][i] + t,d[j][j] = d[j][j] + t;\n\tfor (i = 1; i <= n; ++i) for (j = 1; j <= n; ++j) A[i][j] = d[i][j] - g[i][j];\n\treturn solve();\n}\n\nint ans[200000]; bool ok[200000];\nint main(){\n\tint i,j;\n\tfreopen(\"count.in\",\"r\",stdin); freopen(\"count.out\",\"w\",stdout);\n\tcin >> n >> m;\n\tmxw = 1; S.n = n;\n\tfor (i = 1; i <= m; ++i) cin >> ex[i] >> ey[i] >> ew[i],mxw = max(mxw,ew[i]);\n\tfor (i = 1; i <= m; ++i) G[ex[i]][ey[i]] = ew[i],G[ey[i]][ex[i]] = ew[i];\n\tfor (i = 1; i <= m; ++i) ok[ew[i]] = 1;\n\tfor (i = mxw; i >= 1; --i) if (!ok[i]) for (j = i<<1; j <= mxw; j += i) if (ok[j]){ ok[i] = 1; break; }\n\tfor (i = 1; i <= mxw; ++i) if (ok[i]) ans[i] = work(i);\n\tint Ans = 0;\n\tfor (i = mxw; i ; --i){\n\t\tfor (j = i + i; j <= mxw; j += i) ans[i] = (ans[i] - ans[j] + P) % P;\n\t\tAns = (Ans + (LL)ans[i] * i) % P;\n\t}\n\tcout << Ans << '\\n';\n\treturn 0;\n}\n```",
        "postTime": 1592891658,
        "uid": 52518,
        "name": "s_r_f",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6624 \u3010[2020 \u5e74\u8054\u8003 A \u5377] \u4f5c\u4e1a\u9898\u3011"
    },
    {
        "content": "# $\\texttt{Problem}$\n\u5c0f W \u521a\u521a\u5728\u79bb\u6563\u6570\u5b66\u8bfe\u5b66\u4e60\u4e86\u751f\u6210\u6811\u7684\u77e5\u8bc6\uff1a\u4e00\u4e2a\u65e0\u5411\u56fe $G=(V,E)$ \u7684\u751f\u6210\u6811 $T$ \u4e3a\u8fb9\u96c6 $E$ \u7684\u4e00\u4e2a\u5927\u5c0f\u4e3a $|V|-1$ \u7684\u5b50\u96c6\uff0c\u4e14\u4fdd\u8bc1 $T$ \u7684\u751f\u6210\u5b50\u56fe\u5728 $G$ \u4e2d\u8fde\u901a\u3002\n\n\u5c0f W \u5728\u505a\u4eca\u5929\u7684\u4f5c\u4e1a\u65f6\u88ab\u8fd9\u6837\u4e00\u9053\u9898\u76ee\u96be\u4f4f\u4e86\uff1a\n\n\u7ed9\u5b9a\u4e00\u4e2a $n$ \u4e2a\u9876\u70b9 $m$ \u6761\u8fb9\uff08\u70b9\u548c\u8fb9\u90fd\u4ece $1$ \u5f00\u59cb\u7f16\u53f7\uff09\u7684\u65e0\u5411\u56fe $G$\uff0c\u4fdd\u8bc1\u56fe\u4e2d\u65e0\u91cd\u8fb9\u548c\u65e0\u81ea\u73af\u3002\u6bcf\u4e00\u6761\u8fb9\u6709\u4e00\u4e2a\u6b63\u6574\u6570\u8fb9\u6743 $w_i$\uff0c\u5bf9\u4e8e\u4e00\u68f5 $G$ \u7684\u751f\u6210\u6811 $T$\uff0c\u5b9a\u4e49 $T$ \u7684\u4ef7\u503c\u4e3a\uff1a$T$ \u6240\u5305\u542b\u7684\u8fb9\u7684\u8fb9\u6743\u7684\u6700\u5927\u516c\u7ea6\u6570\u4e58\u4ee5\u8fb9\u6743\u4e4b\u548c\uff0c\u5373\uff1a\n\n$\nval(T)=\\left(\\sum\\limits_{i=1}^{n-1} w_{e_i}\\right) \\times \\gcd(w_{e_1},w_{e_2},\\dots,w_{e_{n-1}})\n$\n\n\u5176\u4e2d $e_1,e_2,\\dots,e_{n-1}$ \u4e3a $T$ \u5305\u542b\u7684\u8fb9\u7684\u7f16\u53f7\u3002\n\n\u5c0f W \u9700\u8981\u6c42\u51fa $G$ \u7684\u6240\u6709\u751f\u6210\u6811 $T$ \u7684\u4ef7\u503c\u4e4b\u548c\uff0c\u4ed6\u505a\u4e86\u5f88\u4e45\u4e5f\u6ca1\u505a\u51fa\u6765\uff0c\u8bf7\u4f60\u5e2e\u5e2e\u4ed6\u3002\u7531\u4e8e\u7b54\u6848\u53ef\u80fd\u5f88\u5927\uff0c\u4f60\u53ea\u9700\u8981\u7ed9\u51fa\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u540e\u7684\u7ed3\u679c\u3002\n\n# $\\texttt{Solution}$\n## \u521d\u6b65\u7684\u7b97\u6cd5\n\u9996\u5148\u8fd0\u7528\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\uff1a\n$$\nf(i)=\\sum_{i|d} \\mu(\\frac{d}{i}) F(d),\n\\text{ans}=\\sum_{i=1}^{\\text{up}} f(i)\\times i\n$$\n\u7136\u540e\u539f\u95ee\u9898\u8f6c\u5316\u4e3a\uff1a\n\n\u53d6\u51fa\u6240\u6709\u8fb9\u6743 $\\text{mod K=0}$ \u7684\u8fb9\uff0c\u7136\u540e\u6c42\u51fa\u5bf9\u4e8e\u6240\u6709\u751f\u6210\u6811$\\sum_{i=1}^{n-1} w_{e_i}$\u7684\u548c\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0c\u663e\u7136\u6709\u4e00\u4e2a\u505a\u6cd5\u662f\u6211\u4eec\u94a6\u5b9a\u90a3\u4e00\u6761\u8fb9\u662f\u4e00\u5b9a\u8981\u9009\u7684\uff0c\u7136\u540e\u5bf9\u8fd9\u6761\u8fb9\u53bb\u6389\u540e\u7684\u8fb9\u8fdb\u884c\u4e00\u6b21\u77e9\u9635\u6811\u5b9a\u7406\u7684\u8fd0\u7528\uff0c\u4f46\u662f\u8fd9\u6837\u4f1a\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u6211\u4eec\u8981\u5982\u4f55\u6c42\u51fa\u8fd9\u6761\u8fb9\u4e00\u5b9a\u5b58\u5728\u7684\u751f\u6210\u6811\u7684\u4e2a\u6570\u3002\n\n\u5176\u5b9e\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u6211\u4eec\u8003\u8651\u6b63\u96be\u5219\u53cd\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u5bf9\u6bcf\u4e00\u6761\u8fb9\u90fd\u505a\u4e00\u6b21\u77e9\u9635\u6811\u5b9a\u7406\u7684\u8fd0\u7528\uff0c\u7136\u540e\u603b\u65b9\u6848\u6570\u51cf\u53bb\u6ca1\u6709\u8fd9\u6761\u8fb9\u7684\u65b9\u6848\u6570\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$\\mathcal O(152501\\times m\\times n^3)$\n\n## \u7b97\u6cd5\u7684\u4f18\u5316\n\u6211\u4eec\u53d1\u73b0\u4e0a\u9762\u7684\u7b97\u6cd5\u7406\u8bba\u6700\u9ad8\u590d\u6742\u5ea6\u8fbe\u5230\u4e86\u60ca\u4eba\u7684 $\\mathcal O(152501\\times n^5)$\uff0c\u663e\u7136\u662f\u65e0\u6cd5\u901a\u8fc7\u7684\u3002\n\n\u4f46\u662f\u5982\u679c\u6211\u4eec\u5c06\u4ed6\u60f3\u8c61\u6210\u4e00\u4e2a\u591a\u9879\u5f0f\u7684\u8bdd\uff0c\u597d\u50cf\u95ee\u9898\u5c31\u4e0d\u7528\u8fd0\u7528\u6b63\u96be\u5219\u53cd\u4e86\uff0c\u5177\u4f53\u5982\u4e0b\uff1a\n$$\nG(i)=\\prod_{i=1}^{n-1} (c_i+1)\n$$\n\n\u90a3\u4e48\u6211\u4eec\u5c06 $G(i)$ \u7684\u503c\u60f3\u8c61\u6210\u4e00\u4e2a\u591a\u9879\u5f0f\uff0c\u6700\u540e\u7684\u7b54\u6848\u5c31\u662f $G(i)$ \u7684\u4e00\u6b21\u9879\u7684\u503c\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4eff\u4f5b\u4f18\u5316\u5230\u4e86 $\\mathcal O(n^4)$ \u7684\u7ea7\u522b\u3002\n\n\u8981\u5199\u4e00\u4e2a\u5de8\u5927\u591a\u9ebb\u70e6\u7684\u591a\u9879\u5f0f\u8fd0\u7b97\uff0c\u52a0\u51cf\u4e58\u90fd\u5341\u5206\u7b80\u5355\uff0c\u8fd9\u91cc\u7ed9\u51fa\u4e00\u4e0b\u9006\u5143\u7684\u8868\u793a\uff1a\n$$\n(ax+b)\\times (cx+d)\\equiv1(\\bmod x^2),\n\\begin{cases}\nb\\times d=1\\\\\nb\\times c+a\\times d=0\n\\end{cases},\n\\therefore\n\\begin{cases}\nd=\\dfrac{1}{b}\\\\\nc=-\\dfrac{a}{b^2}\n\\end{cases}\n$$\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u7528\u591a\u9879\u5f0f\u505a\u4e86\u3002\n\n\u590d\u6742\u5ea6\u5927\u6982\u662f $\\mathcal O(n^3\\times 144)$\n# $\\texttt{Code}$\n``` cpp\nstruct node{\n\tlong long x,y;\n} f[1010][1010];\nlong long pow(long long x,long long y,long long p){\n\tlong long ans=1;\n\tfor (;y;y>>=1,x=x*x % p)\n\t    if (y&1) ans=ans*x % p;return ans;\n}\nint Matrix(){\nint now,i;long long inv,inva,zg,zga,sym,G;\n\tN=n-1;\n\tnode ans=(node){0,1};\n\tfor (now=1;now<N;now++){\n\t\tfor (i=now+1;i<=N;i++)\n\t\t    if ((f[now][now].y==0)&&(f[i][now].y)){\n\t\t    \tans=(node){0,-ans.y};\n\t\t    \tswap(f[now],f[i]);break;\n\t\t\t}\n\t\t  for (i=now+1;i<=N;i++){\n\t\t  \tinva=pow(f[now][now].y,MOD-2,MOD);\n\t\t\tinv=(-inva*inva % MOD*f[now][now].x % MOD+MOD) % MOD;//(inva,inv)\n\t\t\tzg=f[i][now].x;zga=f[i][now].y;\n\t\t\tzg=(zg*inva+zga*inv) % MOD;zga=zga*inva % MOD;\n\t\t\t//a[i][now]*(a[now][now])^{-1}\n\t\t\tfor (j=now;j<=N;j++) \n\t\t\t     {\n\t\t\t     \t//(zg*x+zga)(inv*x+inva)=zg*inva+zga*inv,zga*inva\n\t\t\t     \t//(zg,zga)*(\n\t\t\t     \tf[i][j]=(node){((f[i][j].x-zg*f[now][j].y-zga*f[now][j].x) % MOD+MOD) % MOD,(f[i][j].y-zga*f[now][j].y% MOD+MOD) % MOD};\n\t\t\t     }\n\t\t  }\n\t}\n\nfor (i=1;i<=N;i++) ans=(node){(ans.x*f[i][i].y+ans.y*f[i][i].x) % MOD,ans.y*f[i][i].y % MOD};\nreturn ans.x;\n}\nlong long Main(){\n\tfor (i=1;i<=n;i++) deg[i]=0;\n\tfor (i=1;i<=m;i++)\n\t    if (c[i] % nowa==0) \n\t        {\n\t        f[a[i]][a[i]].x+=c[i];f[b[i]][b[i]].x+=c[i];\n\t\t\tf[a[i]][a[i]].y+=1;f[b[i]][b[i]].y+=1;\n\t\t\tf[a[i]][b[i]].x+=-c[i];f[a[i]][b[i]].y+=-1;\n\t\t\tf[b[i]][a[i]].x-=c[i];f[b[i]][a[i]].y+=-1;\n\t        }\n\tlong long tot=Matrix();\n//\tcout<<tot<<endl;\n\tfor (i=1;i<=n;i++)\n\t    for (j=1;j<=n;j++)\n\t         f[i][j].x=f[i][j].y=0;\n\treturn tot;\n}\nint main()\n{\n\tn=read();m=read();MOD=998244353;\n\tfor (i=1;i<=m;i++) a[i]=read(),b[i]=read(),c[i]=read(),up=max(up,c[i]),tem[c[i]]++;\n\tfor (i=1;i<=up;i++)\n\t   for (j=1;j<=up/i;j++)\n\t         fre[i]+=tem[i*j];\n    for (nowa=1;nowa<=up;nowa++)\n\t    if (fre[nowa]>=n-1)\n\t        {\n\t\t\t\n\t          F[nowa]=Main();\n\t         // printf(\"%lld-----%lld\\n\",nowa,F[nowa]);\n\t      }\n\tmu[1]=1;\n\tfor (i=2;i<=up;i++){\n\t\tif (vis[i]==false){\n\t\t\tprim[++len]=i;mu[i]=-1;\n\t\t}\n\t\tfor (j=1;j<=len&&i*prim[j]<=up;j++){vis[i*prim[j]]=true;\n\t\t\tmu[i*prim[j]]=mu[i]*mu[prim[j]];\n\t\t\tif (i % prim[j]==0) {mu[i*prim[j]]=0;break;}\n\t\t}\n\t}\n\tfor (i=1;i<=up;i++)\n\t   for (j=1;j<=up/i;j++)\n\t        tag[i]=(tag[i]+mu[j]*F[i*j] % MOD+MOD) % MOD;ans=0;\n\tfor (i=1;i<=up;i++) ans=(ans+tag[i]*i) % MOD;\n\tprintf(\"%lld\\n\",ans);\n    return 0;\n}\n\n\n```",
        "postTime": 1645797255,
        "uid": 508480,
        "name": "Albedo",
        "ccfLevel": 0,
        "title": "P6624\u9898\u89e3"
    },
    {
        "content": "\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u4e00\u6ce2\uff0c\u5f97\u5230\u7b54\u6848\u7b49\u4e8e $(\\sum\\limits_dd\\sum\\limits_g \\mu(g)) \\sum\\limits_{i=1}^m w_i \\times F(i,dg)$\uff0c\u5176\u4e2d $F(i,dg)$ \u662f\u6307\u7531\u6240\u6709\u8fb9\u6743\u4e3a $dg$ \u500d\u6570\u7684\u8fb9\u6784\u6210\u7684\u5305\u542b\u8fb9 $i$ \u7684\u751f\u6210\u6811\u4e2a\u6570\u3002\u6211\u4eec\u4e0d\u8003\u8651\u751f\u6210\u51fd\u6570\uff0c\u4f7f\u7528\u5bb9\u65a5\u89e3\u51b3\u8ba1\u7b97 $w_i \\times F(i,dg)$ \u7684\u95ee\u9898\u3002\u4f17\u6240\u5468\u77e5\u77e9\u9635\u6811\u5b9a\u7406\u53ef\u4ee5\u6c42\u89e3\u6240\u6709\u8fb9\u6743\u4e58\u79ef\u7684\u548c\uff0c\u6211\u4eec\u5148\u4ee4\u7b2c $i$ \u6761\u8fb9\u7684\u8fb9\u6743\u4e3a $w_i+1$ \u7b97\u4e00\u904d\u77e9\u9635\u6811\uff0c\u518d\u5c06\u5176\u8bbe\u4e3a $1$ \u7b97\u4e00\u904d\u77e9\u9635\u6811\uff0c\u4e24\u8005\u76f8\u51cf\u5373\u53ef\u5f97\u5230\u7b54\u6848\u3002\u53ef\u4ee5\u8fd9\u4e48\u7406\u89e3\uff1a\u5728\u524d\u8005\u91cc\uff0c\u6240\u6709\u5305\u542b\u8fb9 $i$ \u7684\u751f\u6210\u6811\u65b9\u6848\u6743\u503c\u4e3a $w_i+1$\uff0c\u51cf\u53bb\u540e\u8005\u540e\u53d8\u6210 $w_i$\uff0c\u6240\u6709\u4e0d\u5305\u542b\u8fb9 $i$ \u7684\u751f\u6210\u6811\u65b9\u6848\u6743\u503c\u4e3a $1$\uff0c\u51cf\u53bb\u540e\u8005\u540e\u53d8\u4e3a $0$\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\n#define mp std::make_pair\n#define pb push_back\n#define fr first\n#define se second\n\ntypedef std::pair<int, int> pii;\ntypedef std::vector<int> vi;\ntypedef long long ll;\n\ntemplate<class T> inline T max(const T &x, const T &y) { return x > y ? x : y; }\ntemplate<class T> inline T min(const T &x, const T &y) { return x < y ? x : y; }\ntemplate<class T> inline bool chkmax(T &x, const T &y) { return x < y ? x = y, true : false; }\ntemplate<class T> inline bool chkmin(T &x, const T &y) { return x > y ? x = y, true : false; }\n\ninline int read() {\n  register int x = 0, v = 1;\n  register char ch = getchar();\n  while (!isdigit(ch)) {\n    if (ch == '-') v = -1;\n    ch = getchar();\n  }\n  while (isdigit(ch)) {\n    x = x * 10 + ch - '0';\n    ch = getchar();\n  }\n  return x * v;\n}\n\nconst int MOD = 998244353;\nconst int MAXN = 32;\nconst int MAXM = 450;\nconst int MAXW = 152510;\n\ninline int add(int x, int y) { return x + y >= MOD ? x + y - MOD : x + y; }\ninline int sub(int x, int y) { return x < y ? x - y + MOD : x - y; }\n\nnamespace Number {\n  vi fac[MAXW | 1];\n  int ptot;\n  int prime[MAXW | 1], sumf[MAXW | 1], miu[MAXW | 1];\n  bool not_prime[MAXW | 1];\n  void Sieve() {\n    miu[1] = 1;\n    for (int i = 2; i <= MAXW; ++i) {\n      if (!not_prime[i]) prime[++ptot] = i, miu[i] = MOD - 1;\n      for (int j = 1; j <= ptot && i * prime[j] <= MAXW; ++j) {\n        not_prime[i * prime[j]] = 1;\n        miu[i * prime[j]] = 1ll * miu[i] * (MOD - 1) % MOD;\n        if (i % prime[j] == 0) {\n          miu[i * prime[j]] = 0;\n          break;\n        }\n      }\n    }\n    for (int i = 1; i <= MAXW; ++i) {\n      for (int j = i; j <= MAXW; j += i) {\n        sumf[j] = add(sumf[j], 1ll * i * miu[j / i] % MOD);\n        fac[j].pb(i);\n      }\n    }\n  }\n}\n\nusing namespace Number;\n\nint n, m, ans;\nint U[MAXM | 1], V[MAXM | 1], W[MAXM | 1];\nint det[MAXN | 2][MAXN | 2]; \n\nint fpow(int x, int y) {\n  int res = 1, base = x;\n  while (y > 0) {\n    if (y & 1) res = 1ll * res * base % MOD;\n    base = 1ll * base * base % MOD;\n    y >>= 1;\n  }\n  return res;\n}\n\nint Gauss() {\n  int res = 1;\n  for (int i = 1; i < n; ++i) {\n    int tmp = i;\n    for (int j = i; j < n; ++j) {\n      if (det[j][i]) {\n        tmp = j;\n        break;\n      }\n    }\n    if (tmp != i) std::swap(det[i], det[tmp]), res = MOD - res;\n    int inv = fpow(det[i][i], MOD - 2);\n    for (int j = i + 1; j < n; ++j) \n      for (int k = n - 1; k >= i; --k) \n        det[j][k] = sub(det[j][k], 1ll * det[j][i] * inv % MOD * det[i][k] % MOD);\n  }\n  for (int i = 1; i < n; ++i) res = 1ll * res * det[i][i] % MOD;\n  return res;\n}\n\nint work(int x, int d) {\n  int res = 0, tot = 0;\n  memset(det, 0, sizeof(det));\n  for (int i = 1; i <= m; ++i) {\n    if (W[i] % d == 0) {\n      ++tot;\n      ++det[U[i]][U[i]]; ++det[V[i]][V[i]];\n      det[U[i]][V[i]] = sub(det[U[i]][V[i]], 1); \n      det[V[i]][U[i]] = sub(det[V[i]][U[i]], 1);\n    }\n  }\n  if (tot < n - 1) return 0;\n  det[U[x]][V[x]] = sub(det[U[x]][V[x]], W[x]);\n  det[V[x]][U[x]] = sub(det[V[x]][U[x]], W[x]);\n  det[U[x]][U[x]] = add(det[U[x]][U[x]], W[x]);\n  det[V[x]][V[x]] = add(det[V[x]][V[x]], W[x]);\n  res = Gauss();\n  memset(det, 0, sizeof(det));\n  for (int i = 1; i <= m; ++i) {\n    if (W[i] % d == 0) {\n      ++det[U[i]][U[i]]; ++det[V[i]][V[i]];\n      det[U[i]][V[i]] = sub(det[U[i]][V[i]], 1); \n      det[V[i]][U[i]] = sub(det[V[i]][U[i]], 1);\n    }\n  }\n  return sub(res, Gauss());\n}\n\nint main() {\n  freopen(\"code.in\", \"r\", stdin);\n  freopen(\"code.out\", \"w\", stdout);\n  Sieve();\n  n = read(); m = read();\n  for (int i = 1; i <= m; ++i) U[i] = read(), V[i] = read(), W[i] = read();\n  for (int i = 1; i <= m; ++i) \n    for (int j : fac[W[i]]) \n      ans = add(ans, 1ll * sumf[j] * work(i, j) % MOD);\n  printf(\"%d\\n\", ans);\n  return 0;\n}\n```\n",
        "postTime": 1617759456,
        "uid": 24878,
        "name": "iodwad",
        "ccfLevel": 7,
        "title": "P6624"
    },
    {
        "content": "\u6839\u636e\u5957\u8def\uff0c\u5148\u53bb\u6389\u70e6\u4eba\u7684 $\\gcd$\u3002\n$$\n\\begin{aligned}\nval(T)&=\\left(\\sum\\limits_{i=1}^{n-1} w_{e_i}\\right) \\times \\gcd(w_{e_1},w_{e_2},\\dots,w_{e_{n-1}})\\\\&=\\left(\\sum\\limits_{i=1}^{n-1} w_{e_i}\\right) \\times \\sum\\limits_{d\\mid w_{e_1}\\land\\dots\\land d\\mid w_{e_{n-1}}}\\varphi(d)\\\\&=\\left(\\sum\\limits_{i=1}^{n-1} w_{e_i}\\right)\\sum\\limits_{d=1}^{max_v}\\varphi(d)[d\\mid w_{e_1}\\land\\dots\\land d\\mid w_{e_{n-1}}]\n\\end{aligned}\n$$\n\n\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $d$\uff0c\u5c06\u8fb9\u6743\u4e3a $d$ \u7684\u500d\u6570\u7684\u8fb9\u52a0\u5165\u56fe\u4e2d\uff0c\u7136\u540e\u53ea\u9700\u8981\u6c42\u6240\u6709\u751f\u6210\u6811\u7684\u8fb9\u6743\u548c\u5373\u53ef ~~\uff0c\u7136\u540e\u5c31\u4e0d\u4f1a\u4e86~~\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u77e9\u9635\u6811\u5b9a\u7406\u6c42\u5f97\u6240\u6709\u8fb9\u6743\u548c\u3002\n\n\u6211\u4eec\u77e5\u9053\uff0c\u77e9\u9635\u6811\u5b9a\u7406\u6c42\u7684\u662f\u751f\u6210\u6811\u4e0a\u6240\u6709\u8fb9\u4e58\u79ef\u7684\u548c\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8fb9\u6743\u4e3a $w$ \u7684\u8fb9\u7684\u8fb9\u6743\u53d8\u4e3a $wx+1$\uff0c\u6700\u540e\u6c42\u5f97\u7684\u7ed3\u679c\u7684\u4e00\u6b21\u9879\u7cfb\u6570\u5c31\u662f\u8fb9\u6743\u548c\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^3max_v)$\uff0c\u4e0d\u77e5\u9053\u80fd\u4e0d\u80fd\u8fc7\uff0c\u6211\u4eec\u53d1\u73b0\u5b9e\u9645\u4e0a\u5e76\u4e0d\u9700\u8981\u5bf9\u6bcf\u79cd $d$ \u90fd\u8dd1\u4e00\u904d\u77e9\u9635\u6811\uff0c\u53ea\u5bf9\u8fb9\u6570\u5927\u4e8e\u7b49\u4e8e $n-1$ \u7684 $d$ \u8dd1\u5373\u53ef\uff0c\u7136\u540e\u5c31\u80fd\u8fc7\u4e86\u3002\n\n\u66f4\u591a\u7ec6\u8282\u90fd\u5728\u4ee3\u7801\u91cc\u4e86\u3002\n```cpp\n#include<cstdio>\n#include<vector>\n#include<cstring>\n#include<algorithm>\n#include<utility>\n#define int long long\nlong long const mod=998244353;\nlong long pow(long long x,long long y){\n\tlong long res=1;\n\twhile(y){\n\t\tif(y&1) res=res*x%mod;\n\t\tx=x*x%mod; \n\t\ty>>=1;\n\t}\n\treturn res;\n}\nstruct node{\n\tlong long a,b;\n\tnode(long long const &_a,long long const &_b):a(_a),b(_b){}\n\tnode():a(),b(){}\n\tfriend node operator +(node const &x,node const &y){\n\t\treturn node((x.a+y.a)%mod,(x.b+y.b)%mod);\n\t}\n\tfriend node operator -(node const &x,node const &y){\n\t\treturn node((x.a-y.a+mod)%mod,(x.b-y.b+mod)%mod);\n\t}\n\tfriend node operator *(node const &x,node const &y){\n\t\treturn node((x.a*y.b%mod+y.a*x.b%mod)%mod,x.b*y.b%mod);\n\t}\n\tfriend node operator /(node const &x,node const &y){\n\t\tlong long inv=pow(y.b,mod-2);\n\t\treturn node((x.a*y.b%mod-x.b*y.a%mod+mod)*inv%mod*inv%mod,x.b*inv%mod);\n\t}\n\tnode& operator +=(node const &x){\n\t\t*this=*this+x;\n\t\treturn *this;\n\t}\n\tnode& operator -=(node const &x){\n\t\t*this=*this-x;\n\t\treturn *this;\n\t}\n\tnode& operator *=(node const &x){\n\t\t*this=*this*x;\n\t\treturn *this;\n\t}\n\tnode& operator /=(node const &x){\n\t\t*this=*this/x;\n\t\treturn *this;\n\t}\n}f[50][50];\nint n,m,u[1010],v[1010],w[1010],iinv[152502];\nstd::vector<int> p[152502];\nlong long ans;\nlong long phi(long long x){\n\tlong long res=x;\n\tfor(int i=2;i*i<=x;i++)\n\t\tif(x%i==0){\n\t\t\tres=res*(i-1)%mod;\n\t\t\tif(!iinv[i]) iinv[i]=pow(i,mod-2);\n\t\t\tres=res*iinv[i]%mod;\n\t\t\twhile(x%i==0) x/=i;\n\t\t} \n\tif(x!=1){\n\t\tres=res*(x-1)%mod;\n\t\tif(!iinv[x]) iinv[x]=pow(x,mod-2);\n\t\tres=res*iinv[x]%mod;\n\t}\n\treturn res;\n}\nsigned main(){\n\tscanf(\"%lld%lld\",&n,&m);\n\tfor(int i=1;i<=m;i++){\n\t\tscanf(\"%lld%lld%lld\",u+i,v+i,w+i);\n\t\tfor(int j=1;j*j<=w[i];j++)\n\t\t\tif(w[i]%j==0){\n\t\t\t\tp[j].push_back(i);\n\t\t\t\tif(j*j!=w[i]) p[w[i]/j].push_back(i);\n\t\t\t}\n\t}\n\tfor(int i=1;i<=152501;i++)\n\t\tif((int)(p[i].size())>=n-1){\n\t\t\tmemset(f,0,sizeof(f));\n\t\t\tfor(std::vector<int>::iterator it=p[i].begin();it!=p[i].end();++it){\n\t\t\t\tint u=::u[*it],v=::v[*it],w=::w[*it];\n\t\t\t\tf[u][v]-=node(w,1);\n\t\t\t\tf[v][u]-=node(w,1);\n\t\t\t\tf[u][u]+=node(w,1);\n\t\t\t\tf[v][v]+=node(w,1);\n\t\t\t}\n\t\t\tnode ans(0,1);\n\t\t\tint rev=0;\n\t\t\tfor(int i=1;i<n;i++){\n\t\t\t\tif(!f[i][i].b)\n\t\t\t\t\tfor(int j=i+1;j<n;++j)\n\t\t\t\t\t\tif(f[j][i].b){\n\t\t\t\t\t\t\trev^=1;\n\t\t\t\t\t\t\tstd::swap(f[i],f[j]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\tnode inv=node(0,1)/f[i][i];\n\t\t\t\tans=ans*f[i][i];\n\t\t\t\tfor(int j=i;j<n;j++) f[i][j]=f[i][j]*inv;\n\t\t\t\tfor(int j=1;j<n;j++)\n\t\t\t\t\tif(j!=i){\n\t\t\t\t\t\tnode tmp=f[j][i];\n\t\t\t\t\t\tfor(int k=i;k<n;k++)\n\t\t\t\t\t\t\tf[j][k]=f[j][k]-f[i][k]*tmp;\n\t\t\t\t\t}\n\t\t\t}\n\t\t\tif(rev) ans=node(0,0)-ans;\n\t\t\t::ans=(::ans+ans.a*phi(i)%mod)%mod;\n\t\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1605581680,
        "uid": 55707,
        "name": "gxy001",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6624 [\u7701\u9009\u8054\u8003 2020 A \u5377] \u4f5c\u4e1a\u9898"
    },
    {
        "content": "# \u9898\u76ee\n&emsp;&emsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/P6624)\u770b\u9898\u76ee\u3002  \n# \u5206\u6790\n&emsp;&emsp;\u8fd9\u9053\u9898\u5176\u5b9e\u662f\u4e24\u9053\u9898\u76ee\u3002   \n   \n&emsp;&emsp;\u9996\u5148\u53ef\u4ee5\u5a34\u719f\u5730\u53d8\u6362\u4e00\u4e0b\u67ff\u5b50\uff1a   \n   \n$$\n\\begin{aligned}\n\\sum_T val(T)\n&=\\sum_T \\left(\\sum_{e\\in T} w_e\\times \\gcd_{e\\in T}w_e\\right)\\\\\n&=\\sum_{d=1} d\\times \\left(\\sum_T \\sum_{e\\in T}w_e\\left[\\gcd_{e\\in T}w_e=d\\right]\\right)\\\\      \n\\end{aligned}\n$$\n   \n&emsp;&emsp;\u5c1d\u8bd5\u5b9a\u4e49\uff1a   \n   \n$$\n\\begin{aligned}\nf(d)&=\\sum_T \\sum_{e\\in T}w_e\\left[\\gcd_{e\\in T}w_e=d\\right]\\\\\nF(n)&=\\sum_{n|d} f(d)=\\sum_{T} \\sum_{e\\in T}w_e\\left[n\\ |\\gcd_{e\\in T}w_e\\right]\n\\end{aligned}\n$$   \n   \n&emsp;&emsp;\u7136\u540e\u53d1\u73b0$F(n)$\u76f8\u5bf9\u800c\u8a00\u597d\u6c42\u4e00\u4e9b\u3002\u77e5\u9053\u4e86$F$\uff0c\u5c31\u53ef\u4ee5\u7528\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u6216\u8005\u9006\u63a8\u65b9\u6cd5\u8ba1\u7b97\u51fa$f$\uff0c\u5c31\u89e3\u51b3\u4e86\u95ee\u9898\u3002   \n    \n&emsp;&emsp;\u53d1\u73b0\u827e\u5f17\u68ee\u62ec\u53f7\u5185\u7684\u9650\u5236\u53ef\u4ee5\u901a\u8fc7\u9650\u5236\u8fb9\u6765\u89e3\u51b3\u3002\u5bf9\u4e8e$F(n)$\uff0c\u6211\u4eec\u53ea\u7528$n|w_e$\u7684\u8fb9$e$\u6765\u8ba1\u7b97\uff0c\u5373\u53ef\u3002   \n   \n&emsp;&emsp;\u4e8e\u662f\u8003\u8651\u4e00\u4e2a\u56fe\u4e2d\uff0c\u6c42\u51fa\uff1a   \n   \n$$\\sum_T \\sum_{e\\in T}w_e$$   \n    \n&emsp;&emsp;~~\u597d\u50cf\u662f\u4e00\u4e2a\u8001 trick \u4e86\uff0c\u53ef\u662f\u6211\u4ece\u6ca1\u542c\u8bf4\u8fc7~~    \n    \n&emsp;&emsp;\u8003\u8651\u628a\u8fb9\u6743\u5199\u6210\u4e00\u6b21\u51fd\u6570\u7684\u5f62\u5f0f\uff1a$w\\Rightarrow 1+wx$   \n    \n&emsp;&emsp;\u7136\u540e\u53d1\u73b0\uff1a$(1+w_1x)(1+w_2x)=1+(w_1+w_2)x+w_1w_2x^2$   \n   \n&emsp;&emsp;\u5ffd\u7565\u4e8c\u6b21\u9879\uff0c\u5b83\u4eec\u7684\u4e00\u6b21\u9879\u7cfb\u6570\u52a0\u8d77\u6765\u4e86\uff01   \n   \n&emsp;&emsp;\u7136\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528**\u4e00\u6b21\u51fd\u6570**\u4ee3\u66ff\u539f\u6765\u7684**\u6570**\uff0c\u5e76\u5728$\\bmod{x^2}$\u7684\u610f\u4e49\u4e0b\u8ba1\u7b97\uff0c\u5229\u7528\u201c\u4e58\u6cd5\u201d\u548c\u77e9\u9635\u6811\u5b9a\u7406\u8ba1\u7b97\u8fb9\u6743\u548c\u3002    \n    \n&emsp;&emsp;\u5b9a\u4e49\u8fd9\u4e2a\u65b0\u7684\u7c7b\u578b\u7684\u57fa\u672c\u5f62\u5f0f\u4e3a$a+bx$\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u5b9a\u4e49\u201c\u56db\u5219\u8fd0\u7b97\u201d\uff1a   \n    \n&emsp;&emsp;\u52a0\u6cd5\uff1a$(a+bx)+(c+dx)=(a+c)+(b+d)x$\uff1b    \n   \n&emsp;&emsp;\u51cf\u6cd5\uff1a$(a+bx)-(c+dx)=(a-c)+(b-d)x$\uff1b   \n   \n&emsp;&emsp;\u4e58\u6cd5\uff1a$(a+bx)(c+dx)=ac+(bc+ad)x$\uff1b   \n   \n&emsp;&emsp;\u9664\u6cd5\uff1a\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u9006\u5143\uff1a$(a+bx)^{-1}=(a^{-1}-ba^{-2}x)$\uff0c\u63a8\u5bfc\u8fc7\u7a0b\u4e0d\u96be\uff1b   \n   \n&emsp;&emsp;\u7136\u540e\u5c31\u53ef\u4ee5\u679a\u4e3e\u6240\u6709\u56e0\u5b50\u8ba1\u7b97\u4e86\u3002\u8fd9\u91cc\u6709\u4e00\u4e2a\u526a\u679d\uff0c\u5373\u5f53\u5f53\u524d\u7684\u56fe\u4e0d\u8fde\u901a\u7684\u65f6\u5019\uff0c\u6211\u4eec\u76f4\u63a5\u8df3\u6389\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u5927\u6982\u662f$O(n^4d)$\uff0c\u5176\u4e2d$d\u2248144$\u3002   \n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <vector>\n#include <iostream>\nusing namespace std;\n\nconst int mod = 998244353;\nconst int MAXN = 35, MAXM = MAXN * MAXN, MAXV = 2e5 + 5;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0;char s = getchar();int f = 1;\n\twhile( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n\twhile( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n\tif( 9 < x ){ write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\ntemplate<typename _T>\n_T MAX( const _T a, const _T b )\n{\n\treturn a > b ? a : b;\n}\n\nint inv( const int );\nint qkpow( int, int );\n\nstruct linear\n{\n\tint k, b;\n\t//f(x)=ax+b\n\tlinear() { k = 0, b = 1; }\n\tlinear( const int B ) { k = 0, b = B; }\n\tlinear( const int K, const int B ) { k = K, b = B; }\n\t\n\tlinear getInv() const\n\t{\n\t\tint tmp = inv( b );\n\t\treturn linear( ( mod - 1ll * tmp * tmp % mod * k % mod + mod ) % mod, tmp );\n\t}\n\t\n\tlinear operator / ( const linear &g ) const { return g * getInv(); }\n\tlinear operator + ( const linear &g ) const { return linear( ( k + g.k ) % mod, ( b + g.b ) % mod ); }\n\tlinear operator - ( const linear &g ) const { return linear( ( k - g.k + mod ) % mod, ( b - g.b + mod ) % mod ); }\n\tlinear operator * ( const linear &g ) const { return linear( ( 1ll * k * g.b % mod + 1ll * b * g.k % mod ) % mod, 1ll * b * g.b % mod ); }\n\n\tvoid operator += ( const linear &g ) { *this = *this + g; }\n\tvoid operator -= ( const linear &g ) { *this = *this - g; }\n\tvoid operator *= ( const linear &g ) { *this = *this * g; }\n\tvoid operator /= ( const linear &g ) { *this = *this / g; }\n\tvoid operator ++ () { b = ( b + 1 >= mod ? b + 1 - mod : b + 1 ); }\n\t\n\toperator bool() const { return k || b; }\n};\n\nvector<int> vec[MAXV];\n\nlinear D[MAXN][MAXN], G[MAXN][MAXN], K[MAXN][MAXN];\nint fr[MAXM], to[MAXM], w[MAXM];\nint F[MAXV];\nint fa[MAXN];\nint N, M;\n\nint qkpow( int base, int indx )\n{\n\tint ret = 1;\n\twhile( indx )\n\t{\n\t\tif( indx & 1 ) ret = 1ll * ret * base % mod;\n\t\tbase = 1ll * base * base % mod, indx >>= 1;\n\t}\n\treturn ret;\n}\n\nint inv( const int a ) { return qkpow( a, mod - 2 ); }\n\nint det( linear T[][MAXN], const int n )\n{\n\tlinear ans, tmp, inver; int indx;\n\tfor( int i = 1 ; i <= n ; i ++ )\n\t{\n\t\tindx = -1;\n\t\tfor( int j = i ; j <= n ; j ++ )\n\t\t\tif( T[j][i] )\n\t\t\t{ indx = j; break; }\n\t\tif( indx == -1 ) return 0;\n\t\tif( indx ^ i ) ans.k *= -1;\n\t\tswap( T[i], T[indx] ), inver = T[i][i].getInv();\n\t\tfor( int j = i + 1 ; j <= n ; j ++ )\n\t\t\tif( T[j][i] )\n\t\t\t{\n\t\t\t\ttmp = T[j][i] * inver;\n\t\t\t\tfor( int k = i ; k <= n ; k ++ )\n\t\t\t\t\tT[j][k] -= T[i][k] * tmp;\n\t\t\t}\n\t\tans *= T[i][i];\n\t}\n\treturn ans.k;\n}\n\nvoid makeSet() { for( int i = 1 ; i <= N ; i ++ ) fa[i] = i; }\nint findSet( const int u ) { return fa[u] = ( fa[u] == u ? u : findSet( fa[u] ) ); }\nvoid unionSet( const int u, const int v ) { fa[findSet( u )] = findSet( v ); }\n\nint main()\n{\n\tint mxv = -1;\n\tread( N ), read( M );\n\tfor( int i = 1 ; i <= M ; i ++ ) read( fr[i] ), read( to[i] ), read( w[i] );\n\tfor( int i = 1 ; i <= M ; i ++ )\n\t\tfor( int x = 1 ; x * x <= w[i] ; x ++ )\n\t\t\tif( ! ( w[i] % x ) )\n\t\t\t{\n\t\t\t\tvec[x].push_back( i );\n\t\t\t\tif( x * x != w[i] ) vec[w[i] / x].push_back( i );\n\t\t\t}\n\tfor( int i = 1 ; i <= M ; i ++ ) mxv = MAX( mxv, w[i] );\n\tfor( int i = 1, cnt ; i <= mxv ; i ++ )\n\t{\n\t\tmakeSet();\n\t\tfor( int j = 0 ; j < vec[i].size() ; j ++ )\n\t\t\tunionSet( fr[vec[i][j]], to[vec[i][j]] );\n\t\tcnt = 0;\n\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\tif( fa[j] == j ) cnt ++;\n\t\tif( cnt > 1 ) continue;\n\t\tfor( int i = 1 ; i <= N ; i ++ )\n\t\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\t\tD[i][j] = G[i][j] = K[i][j] = 0;\n\t\tfor( int j = 0 ; j < vec[i].size() ; j ++ )\n\t\t\tG[fr[vec[i][j]]][to[vec[i][j]]] += linear( w[vec[i][j]], 1 ),\n\t\t\tG[to[vec[i][j]]][fr[vec[i][j]]] += linear( w[vec[i][j]], 1 );\n\t\tfor( int i = 1 ; i <= N ; i ++ )\n\t\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\t\tD[i][i] += G[i][j];\n\t\tfor( int i = 1 ; i <= N ; i ++ )\n\t\t\tfor( int j = 1 ; j <= N ; j ++ )\n\t\t\t\tK[i][j] = D[i][j] - G[i][j];\n\t\tF[i] = det( K, N - 1 );\n\t}\n\tfor( int i = mxv ; i ; i -- )\n\t\tfor( int j = i << 1 ; j <= mxv ; j += i )\n\t\t\tF[i] = ( F[i] - F[j] + mod ) % mod;\n\tint ans = 0;\n\tfor( int i = 1 ; i <= mxv ; i ++ ) ans = ( ans + 1ll * F[i] * i % mod ) % mod;\n\twrite( ans ), putchar( '\\n' );\n\treturn 0;\n}\n```",
        "postTime": 1593838053,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[NOI2020\u7701\u9009]\u4f5c\u4e1a\u9898"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/dysyn1314/p/13209932.html)\n\n[\u9898\u76ee\u94fe\u63a5](https://loj.ac/problem/3304)\n\n> \u524d\u7f6e\u77e5\u8bc6\uff1a(1) \u77e9\u9635\u6811\u5b9a\u7406\u3002(2) \u591a\u9879\u5f0f\u56db\u5219\u8fd0\u7b97\uff08\u52a0\u3001\u51cf\u3001\u4e58\u3001\u6c42\u9006\uff08\u725b\u987f\u8fed\u4ee3\uff09\uff09\u3002\n>\n> \u7f51\u4e0a\u7684\u4ecb\u7ecd\u5f88\u591a\u3002\u8fd9\u91cc\u5c31\u4e0d\u7ec6\u8bb2\u4e86\u3002\n\n\u9996\u5148\u8981\u628a\u8fd9\u4e2a$\\gcd$\u7ed9\u62c6\u6389\uff0c\u624d\u80fd\u7528\u6211\u4eec\u719f\u6089\u7684\u201c\u77e9\u9635\u6811\u5b9a\u7406\u201d\u7b49\u4e00\u7cfb\u5217\u65b9\u6cd5\u6765\u89e3\u9898\u3002\n\n\u4f17\u6240\u5468\u77e5\uff0c$\\sum_{d|x}\\varphi(d)=x$\u3002\u672c\u9898\u4e2d\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a$\\varphi$\u6765\u62c6\u6389$\\gcd$\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u7528$T$\u6765\u8868\u793a\u679a\u4e3e\u7684\u4e00\u68f5\u6811\uff0c$e_1,e_2,\\dots ,e_{n-1}$\u6765\u8868\u793a$T$\u5305\u542b\u7684\u8fb9\u7684\u7f16\u53f7\uff0c\u90a3\u4e48\u9996\u5148\uff0c\u7b54\u6848\u53ef\u4ee5\u8868\u793a\u4e3a\uff1a\n$$\n\\sum_{T}\\left(\\sum_{i=1}^{n-1}w_{e_i}\\right)\\times\\gcd(w_{e_1},w_{e_2},\\dots,w_{e_{n-1}})\n$$\n\u6211\u4eec\u628a$\\gcd(w_{e_1},w_{e_2},\\dots,w_{e_{n-1}})$\u7528\u4e0a\u8ff0\u7684\u516c\u5f0f\u5e26\u5165\uff0c\u5f97\u5230\uff1a\n$$\n=\\sum_{T}\\left(\\sum_{i=1}^{n-1}w_{e_i}\\right)\\times\\left(\\sum_{d|\\gcd(w_{e_1},w_{e_2},\\dots,w_{e_{n-1}})}\\varphi(d)\\right)\n$$\n\u7136\u540e\u5c31\u53ef\u4ee5\u628a\u8fd9\u4e2a$d$\uff0c\u653e\u5230\u524d\u9762\u6765\uff0c\u5f97\u5230\uff1a\n$$\n=\\sum_{d=1}^{W}\\varphi(d)\\times\\left(\\sum_{\\begin{gather*}T\\\\d|w_{e_1},\\dots ,d|w_{e_{n-1}}\\end{gather*}}\\sum_{i=1}^{n-1}w_{e_i}\\right)\n$$\n\u5176\u4e2d\uff0c$W$\u8868\u793a\u6700\u5927\u7684\u6743\u503c\u3002\u540e\u9762\u62ec\u53f7\u91cc\u7684\u90e8\u5206\uff0c\u76f8\u5f53\u4e8e\u3010\u6240\u6709\u3010$w_{e_i}$\u662f$d$\u7684\u500d\u6570\u7684\u8fb9\u3011\u7ec4\u6210\u7684\u5b50\u56fe\u3011\u7684\u6240\u6709\u751f\u6210\u6811\u7684\u8fb9\u6743\u548c\u3002\n\n\u666e\u901a\u7684**\u77e9\u9635\u6811\u5b9a\u7406**\uff0c\u53ef\u4ee5\u7528\u6765\u6c42\u6240\u6709\u751f\u6210\u6811\u7684**\u8fb9\u6743\u79ef**\u4e4b\u548c\u3002\u5176\u4e2d\u6700\u4e3a\u5927\u5bb6\u6240\u719f\u77e5\u7684\u5e94\u7528\uff0c\u5c31\u662f\u5f53\u6240\u6709\u8fb9\u6743\u90fd\u4e3a$1$\u65f6\uff0c\u5c31\u76f8\u5f53\u4e8e\u662f\u6c42\u751f\u6210\u6811\u7684\u6570\u91cf\uff0c\u4e5f\u5c31\u662f**\u751f\u6210\u6811\u8ba1\u6570\u95ee\u9898**\u3002\u5b83\u7684\u5b9e\u73b0\uff0c\u5c31\u662f\u6c42\u77e9\u9635\u884c\u5217\u5f0f\uff0c\u56e0\u4e3a\u9700\u8981\u7528\u5230\u9ad8\u65af\u6d88\u5143\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u662f$O(n^3)$\u7684\u3002\n\n\u4f46\u662f\u672c\u9898\u4e2d\uff0c\u8981\u6c42\u7684\u662f**\u8fb9\u6743\u548c**\uff0c\u800c\u4e0d\u662f\u201c\u8fb9\u6743\u79ef\u4e4b\u548c\u201d\u3002\u4e00\u79cd\u6734\u7d20\u7684\u60f3\u6cd5\u662f\u8003\u8651\u6bcf\u4e00\u6761\u8fb9\u7684\u8d21\u732e\uff0c\u4e5f\u5c31\u662f\u6c42\u3010\u5305\u542b\u8fd9\u6761\u8fb9\u7684\u751f\u6210\u6811\u6570\u91cf\u3011\u3002\u5b83\u53c8\u7b49\u4e8e\u3010\u539f\u56fe\u7684\u751f\u6210\u6811\u6570\u91cf\u3011\u51cf\u53bb\u3010\u539f\u56fe\u53bb\u6389\u8fd9\u6761\u8fb9\u540e\u7684\u751f\u6210\u6811\u6570\u91cf\u3011\u3002\u5bf9\u6bcf\u6761\u8fb9\u90fd\u6c42\u4e00\u6b21\u3010\u539f\u56fe\u53bb\u6389\u8fd9\u6761\u8fb9\u540e\u7684\u751f\u6210\u6811\u6570\u91cf\u3011\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(mn^3)$\u3002\u56e0\u4e3a\u5916\u5c42\u8fd8\u8981\u679a\u4e3e$d$\uff0c\u6240\u4ee5\u603b\u65f6\u95f4\u590d\u6742\u5ea6$O(W\\cdot mn^3)$\uff0c\u65e0\u6cd5\u901a\u8fc7\u672c\u9898\u3002\n\n\u6c42\u6240\u6709\u751f\u6210\u6811\u7684\u8fb9\u6743\u548c\uff0c\u5176\u5b9e\u6709\u66f4\u597d\u7684\u65b9\u6cd5\u3002\u6211\u4eec\u628a\u6bcf\u6761\u8fb9\u7684\u8fb9\u6743\uff0c\u770b\u505a\u4e00\u4e2a**\u591a\u9879\u5f0f**\uff1a$(1+w_{e_i}x)$\u3002\u5176\u4e2d\uff0c$x$\u4e0d\u662f\u4efb\u4f55\u5177\u4f53\u7684\u6570\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u7b26\u53f7\uff0c\u8868\u793a\u591a\u9879\u5f0f\u7684\u201c\u4e00\u6b21\u9879\u201d\u3002\u90a3\u4e48\uff0c\u4e00\u4e2a\u751f\u6210\u6811\uff0c\u5b83\u7684\u8fb9\u6743\u4e4b**\u79ef**\u7684\u201c\u4e00\u6b21\u9879\u201d\u524d\u7684\u7cfb\u6570\uff0c\u5c31\u662f\u8fd9\u9897\u751f\u6210\u6811\u7684\u8fb9\u6743**\u548c**\uff08\u8fd9\u53ef\u4ee5\u6839\u636e\u591a\u9879\u5f0f\u4e58\u6cd5\u7684\u5b9a\u4e49\u6765\u7406\u89e3\uff09\u3002\n\n\u5982\u6b64\u4ee5\u6765\uff0c\u6c42\u6240\u6709\u751f\u6210\u6811\u7684**\u8fb9\u6743\u548c**\u7684\u95ee\u9898\uff0c\u5f53\u6211\u4eec\u628a\u8fb9\u6743\u6362\u6210\u8fd9\u6837\u4e00\u4e2a\u591a\u9879\u5f0f\u540e\uff0c\u5c31\u8f6c\u5316\u4e3a\u4e86\u6c42\u6240\u6709\u751f\u6210\u6811\u7684**\u8fb9\u6743\u79ef**\u4e4b\u548c\u7684\u95ee\u9898\u3002\u53ea\u4e0d\u8fc7\uff0c\u73b0\u5728\u65b0\u7684\u8fb9\u6743\uff0c\u4e0d\u518d\u662f\u4e00\u4e2a\u6570\uff0c\u800c\u662f\u4e00\u4e2a\u591a\u9879\u5f0f\u3002\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5b9a\u4e49\u51fa\u591a\u9879\u5f0f\u7684\u56db\u5219\u8fd0\u7b97\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u7528\u77e9\u9635\u6811\u5b9a\u7406\u6c42\u89e3\u4e86\u3002\u53e6\u5916\uff0c\u6211\u4eec\u53ea\u5173\u5fc3\u591a\u9879\u5f0f\u7684\u201c\u4e00\u6b21\u9879\u201d\u7cfb\u6570\uff0c\u6240\u4ee5\u66f4\u9ad8\u7684\u9879\u53ef\u4ee5\u820d\u53bb\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6240\u6709\u7684\u591a\u9879\u5f0f\u8fd0\u7b97\uff0c\u53ef\u4ee5\u5728$\\bmod x^2$\u610f\u4e49\u4e0b\u8fdb\u884c\u3002\u90a3\u4e48\u628a\u591a\u9879\u5f0f\u5b9a\u4e49\u4e3a\u4e00\u4e2a$\\texttt{pair}$\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u591a\u9879\u5f0f\u7684\u52a0\u3001\u51cf\u3001\u4e58\u8fd0\u7b97\u90fd\u6bd4\u8f83\u7b80\u5355\u3002\u4e0d\u4e86\u89e3\u7684\u53ef\u4ee5\u770b\u5982\u4e0b\u4ee3\u7801\uff1a\n\n```cpp\ntypedef pair<int,int> pii;\n#define fi first\n#define se second\n//\u4e3a\u4e86\u4fbf\u4e8e\u7406\u89e3\uff0c\u8fd9\u91cc\u5c31\u4e0d\u53d6\u6a21\u4e86\npii operator+(const pii& a,const pii& b){\n\treturn mk(a.fi+b.fi,a.se+b.se);\n}\npii operator-(const pii& a,const pii& b){\n\treturn mk(a.fi-b.fi,a.se-b.se);\n}\npii operator*(const pii& a,const pii& b){\n\treturn mk(a.fi*b.fi,a.se*b.fi+b.se*a.fi);\n}\n```\n\n\u591a\u9879\u5f0f\u7684\u9664\u6cd5\uff0c\u56e0\u4e3a\u5728$\\bmod x^2$\u610f\u4e49\u4e0b\u8fdb\u884c\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u6c42\u51fa\u591a\u9879\u5f0f$\\bmod x^2$\u610f\u4e49\u4e0b\u7684\u9006\u5373\u53ef\u3002\u7528\u7ecf\u5178\u7684\u500d\u589e\u6cd5\u3002\u8bbe\u539f\u591a\u9879\u5f0f\u4e3a$A(x)$\uff0c\u8981\u6c42\u7684\u3001\u5b83\u7684\u9006\u4e3a$F(x)=A^{-1}(x)\\pmod{x^n}$\u3002\u5982\u679c\u5df2\u7ecf\u6c42\u51fa\u4e86$F_0(x)=A^{-1}(x)\\pmod{x^{\\lceil\\frac{n}{2}\\rceil}}$\uff0c\u90a3\u4e48\uff1a\n$$\nF(x)=2F_0(x)-F_0^2(x)A(x)\\pmod{x^{n}}\n$$\n\u5bf9\u672c\u9898\u6765\u8bf4\uff0c\u6211\u4eec\u5c31\u4e0d\u9700\u8981\u9012\u5f52\u4e86\u3002\u5148\u6c42\u51fa\u5e38\u6570\u9879\uff0c\u4e5f\u5c31\u662f\u6c42\u9006\u5143\u3002\u7136\u540e\u628a\u5e38\u6570\u9879\u4f5c\u4e3a$F_0(x)$\u5e26\u5165\u4e0a\u5f0f\u5373\u53ef\u3002\u5177\u4f53\u7684\u4ee3\u7801\uff1a\n\n```cpp\npii inv(const pii& a){\n\tint t=pow_mod(a.fi,MOD-2);\n\treturn mk(2*t,0)-mk(t,0)*mk(t,0)*a;\n}\npii operator/(const pii& a,const pii& b){\n\treturn a*inv(b);\n}\n```\n\n\u8fd8\u6709\u4e00\u4e2a\u5c0f\u7ec6\u8282\u662f\uff0c\u9ad8\u65af\u6d88\u5143\u6c42\u884c\u5217\u5f0f\u7684\u65f6\u5019\uff0c\u5982\u679c\u5f53\u524d\u884c\u7684\uff08\u8981\u4f5c\u4e3a\u88ab\u9664\u6570\uff09\u7684\u8fd9\u4e2a\u591a\u9879\u5f0f\uff0c\u5e38\u6570\u9879\u4e3a$0$\uff0c\u4e0a\u8ff0\u7684\u6c42\u9006\u7684\u65b9\u6cd5\u5c31\u4e0d\u7ba1\u7528\u4e86\uff0c\u56e0\u4e3a$0$\u6ca1\u6709\u9006\u5143\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u9996\u5148\u8003\u8651\uff0c\u5728\u5b83\u4e0b\u9762\uff0c\u627e\u4e00\u4e2a\u5e38\u6570\u9879\u4e0d\u4e3a$0$\u7684\u884c\uff0c\u4e0e\u5b83\u4ea4\u6362\uff08\u6839\u636e\u884c\u5217\u5f0f\u7684\u6027\u8d28\uff0c\u4e24\u884c\u4ea4\u6362\u540e\u884c\u5217\u5f0f\u8981\u53d8\u53f7\uff0c\u4e5f\u5c31\u662f$res:=-res$\uff09\u3002\u5982\u679c\u5b83\u4e0b\u9762\u6240\u6709\u884c\u5e38\u6570\u9879\u90fd\u4e3a$0$\uff0c\u90a3\u5bf9\u8fd9\u4e00\u5217\uff0c\u6211\u4eec\u5c31\u4e0d\u9700\u8981\u7ba1\u5e38\u6570\u9879\u4e86\uff0c\u76f4\u63a5\u62ff\u4e00\u6b21\u9879\u6d88\u5c31\u884c\uff08\u5c31\u628a\u6bcf\u4e00\u9879\u90fd\u770b\u6210\u666e\u901a\u7684\u6570\u800c\u4e0d\u662f\u591a\u9879\u5f0f\u5c31\u884c\uff09\u3002\n\n\u81f3\u6b64\uff0c\u6240\u6709\u56db\u5219\u8fd0\u7b97\u90fd\u53ef\u4ee5$O(1)$\u5b9e\u73b0\uff0c\u6240\u4ee5\u505a\u4e00\u6b21\u9ad8\u65af\u6d88\u5143\uff0c\u6c42\u51fa\u884c\u5217\u5f0f\u7684\u590d\u6742\u5ea6\u5c31\u662f$O(n^3)$\u7684\u3002\u5916\u5c42\u8fd8\u8981\u679a\u4e3e$d$\uff0c\u6240\u4ee5\u603b\u65f6\u95f4\u590d\u6742\u5ea6$O(Wn^3)$\u3002\u8fd9\u4e2a\u590d\u6742\u5ea6\u4ecd\u7136\u65e0\u6cd5\u901a\u8fc7\u672c\u9898\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u518d\u5bf9$W$\u8fd9\u90e8\u5206\u505a\u4e00\u4e9b\u4f18\u5316\u3002\n\n\u53d1\u73b0\u5bf9\u4e8e\u4e00\u4e2a$d$\u3002\u5982\u679c\u201c\u662f\u5b83\u7684\u500d\u6570\u201d\u7684\u8fb9\uff0c\u6570\u91cf\u5c0f\u4e8e$n-1$\u6761\uff0c\u90a3\u5fc5\u4e0d\u53ef\u80fd\u6709\u4efb\u4f55\u751f\u6210\u6811\u3002\u7279\u5224\u8fd9\u4e00\u60c5\u51b5\u540e\uff0c\u6211\u4eec\u60ca\u559c\u5730\u53d1\u73b0\uff0c\u590d\u6742\u5ea6\u964d\u4e3a\uff1a$O(\\frac{\\sum\\sigma_0(w_{e_i})}{n-1}\\cdot n^3)=O(n^2\\sum\\sigma_0(w_{e_i}))$\u3002\u5176\u4e2d$\\sigma_0(x)$\u8868\u793a$x$\u7684\u7ea6\u6570\u6570\u91cf\u3002\u8fd9\u4e2a\u590d\u6742\u5ea6\u5f88\u597d\u7406\u89e3\uff0c\u56e0\u4e3a\u6bcf\u4e2a$d$\uff0c\u8981\u4f5c\u4e3a\u7ea6\u6570\u51fa\u73b0$n-1$\u6b21\u624d\u88ab\u8ba1\u7b97\uff0c\u6240\u4ee5\u88ab\u8ba1\u7b97\u5230\u7684$d$\u6700\u591a\u53ea\u6709$\\frac{\\sum\\sigma_0(w_{e_i})}{n-1}$\u4e2a\u3002\u518d\u770b\u8fd9\u4e2a\u590d\u6742\u5ea6\uff0c\u4e00\u4e2a\u5c0f\u4e8e\u7b49\u4e8e$W$\u7684\u6570\uff0c\u7ea6\u6570\u4e2a\u6570\u662f$O(\\sqrt{W})$\u7ea7\u522b\u7684\uff0c\u53c8\u56e0\u4e3a\u8fb9\u6570\u662f$O(n^2)$\u7ea7\u522b\u7684\uff0c\u6240\u4ee5\u603b\u590d\u6742\u5ea6\u5c31\u662f$O(n^4\\sqrt{W})$\u3002\u4e8b\u5b9e\u4e0a\uff0c\u8fd9\u4e2a$\\sqrt{W}$\u53ea\u662f\u4e00\u4e2a\u7406\u8bba\u4e0a\u9650\uff0c\u5728\u672c\u9898\u7684\u6570\u636e\u8303\u56f4\u4e0b\uff0c\u6253\u8868\u53d1\u73b0\uff0c$w$\u7684\u7ea6\u6570\u4e2a\u6570\u6700\u591a\u4e3a$144$\u3002\u8db3\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n\u53c2\u8003\u4ee3\u7801\uff08[\u5728LOJ\u67e5\u770b](https://loj.ac/submission/849167)\uff09\uff1a\n\n```cpp\n//problem:LOJ3304\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define pb push_back\n#define mk make_pair\n#define lob lower_bound\n#define upb upper_bound\n#define fi first\n#define se second\n#define SZ(x) ((int)(x).size())\n\ntypedef unsigned int uint;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int> pii;\n\nconst int MOD=998244353;\ninline int mod1(int x){return x<MOD?x:x-MOD;}\ninline int mod2(int x){return x<0?x+MOD:x;}\ninline void add(int& x,int y){x=mod1(x+y);}\ninline void sub(int& x,int y){x=mod2(x-y);}\ninline int pow_mod(int x,int i){int y=1;while(i){if(i&1)y=(ll)y*x%MOD;x=(ll)x*x%MOD;i>>=1;}return y;}\n\npii operator+(const pii& lhs,const pii& rhs){\n\treturn mk(mod1(lhs.fi+rhs.fi),mod1(lhs.se+rhs.se));\n}\npii operator-(const pii& lhs,const pii& rhs){\n\treturn mk(mod2(lhs.fi-rhs.fi),mod2(lhs.se-rhs.se));\n}\npii operator*(const pii& lhs,const pii& rhs){\n\treturn mk((ll)lhs.fi*rhs.fi%MOD,((ll)lhs.se*rhs.fi+(ll)rhs.se*lhs.fi)%MOD);\n}\npii inv(const pii& a){\n\t//assert(a.fi!=0);\n\tint t=pow_mod(a.fi,MOD-2);\n\treturn mk(2LL*t%MOD,0)-mk(t,0)*mk(t,0)*a;//\u725b\u987f\u8fed\u4ee3\n}\npii operator/(const pii& lhs,const pii& rhs){\n\treturn lhs*inv(rhs);\n}\npii operator-(const pii& rhs){\n\treturn mk(mod2(-rhs.fi),mod2(-rhs.se));\n}//\u8d1f\u53f7\npii& operator+=(pii& lhs,const pii& rhs){\n\tlhs=lhs+rhs;\n\treturn lhs;\n}\npii& operator-=(pii& lhs,const pii& rhs){\n\tlhs=lhs-rhs;\n\treturn lhs;\n}\npii& operator*=(pii& lhs,const pii& rhs){\n\tlhs=lhs*rhs;\n\treturn lhs;\n}\npii& operator/=(pii& lhs,const pii& rhs){\n\tlhs=lhs/rhs;\n\treturn lhs;\n}\n\nconst int MAXW=152501;\nint p[MAXW+5],cnt,phi[MAXW+5];\nbool v[MAXW+5];\nvoid sieve(int lim){\n\tphi[1]=1;\n\tfor(int i=2;i<=lim;++i){\n\t\tif(!v[i]){\n\t\t\tphi[i]=i-1;\n\t\t\tp[++cnt]=i;\n\t\t}\n\t\tfor(int j=1;j<=cnt && p[j]*i<=lim;++j){\n\t\t\tv[i*p[j]]=1;\n\t\t\tif(i%p[j]==0){\n\t\t\t\tphi[i*p[j]]=phi[i]*p[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i*p[j]]=phi[i]*phi[p[j]];\n\t\t}\n\t}\n}//\u7ebf\u6027\u7b5b,\u6c42phi\n\nconst int MAXN=30;\nconst int MAXM=MAXN*(MAXN-1)/2;\nint n,m;\nstruct Edge{\n\tint u,v,w;\n}e[MAXM+5];\n\nstruct Matrix{\n\tint n;\n\tpii a[MAXN+5][MAXN+5];\n\tMatrix(){\n\t\tn=0;\n\t\tmemset(a,0,sizeof(a));\n\t}\n};\n\npii get_det2(Matrix A,int i){\n\t//\u5e38\u6570\u9879\u5168\u90e8\u4e3a0\n\tpii res=mk(1,0);\n\tint line=0;\n\tfor(int j=i;j<=A.n;++j){\n\t\tif(A.a[j][i].se!=0){\n\t\t\tline=j;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif(!line)return mk(0,0);\n\tif(line!=i){\n\t\tfor(int j=1;j<=A.n;++j)swap(A.a[i][j],A.a[line][j]);\n\t\tres=-res;\n\t}\n\tint _inv=pow_mod(A.a[i][i].se,MOD-2);\n\tfor(int j=i+1;j<=A.n;++j){\n\t\tint t=(ll)A.a[j][i].se*_inv%MOD;\n\t\tfor(int k=1;k<=A.n;++k)\n\t\t\tsub(A.a[j][k].se,(ll)A.a[i][k].se*t%MOD);\n\t}\n\tres*=A.a[i][i];\n\treturn res;\n}\npii get_det(Matrix A){\n\tpii res=mk(1,0);\n\tfor(int i=1;i<=A.n;++i){\n\t\tint line=0;\n\t\tfor(int j=i;j<=A.n;++j){\n\t\t\tif(A.a[j][i].fi!=0){\n\t\t\t\tline=j;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif(line==0){\n\t\t\tres*=get_det2(A,i);\n\t\t\tcontinue;\n\t\t}\n\t\tif(line!=i){\n\t\t\tfor(int j=1;j<=A.n;++j)swap(A.a[i][j],A.a[line][j]);\n\t\t\tres=-res;\n\t\t}\n\t\tpii _inv=inv(A.a[i][i]);\n\t\tfor(int j=i+1;j<=A.n;++j){\n\t\t\tpii t=A.a[j][i]*_inv;\n\t\t\tfor(int k=1;k<=A.n;++k)\n\t\t\t\tA.a[j][k]-=A.a[i][k]*t;\n\t\t}\n\t\tres*=A.a[i][i];\n\t}\n\treturn res;\n}\n\nint main() {\n\tcin>>n>>m;\n\tint max_w=0;\n\tfor(int i=1;i<=m;++i){\n\t\tcin>>e[i].u>>e[i].v>>e[i].w;\n\t\tmax_w=max(max_w,e[i].w);\n\t}\n\tsieve(max_w);\n\tint ans=0;\n\tfor(int i=1;i<=max_w;++i){\n\t\tint cnt_e=0;\n\t\tfor(int j=1;j<=m;++j)if(e[j].w%i==0)cnt_e++;\n\t\tif(cnt_e<n-1)continue;\n\t\t\n\t\tMatrix mat;\n\t\tfor(int j=1;j<=m;++j)if(e[j].w%i==0){\n\t\t\tmat.a[e[j].u][e[j].u]+=mk(1,e[j].w);\n\t\t\tmat.a[e[j].v][e[j].v]+=mk(1,e[j].w);\n\t\t\tmat.a[e[j].u][e[j].v]-=mk(1,e[j].w);\n\t\t\tmat.a[e[j].v][e[j].u]-=mk(1,e[j].w);\n\t\t}\n\t\tmat.n=n-1;\n\t\tpii det=get_det(mat);\n\t\tans=((ll)ans+(ll)phi[i]*det.se)%MOD;\n\t}\n\tcout<<ans<<endl;\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1593431396,
        "uid": 100674,
        "name": "duyi",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P6624 \u3010[\u7701\u9009\u8054\u8003 2020 A \u5377] \u4f5c\u4e1a\u9898\u3011"
    },
    {
        "content": "\n\u7ed9\u5b9a\u4e00\u5f20\u5e26\u8fb9\u6743\u7684\u7b80\u5355\u65e0\u5411\u8fde\u901a\u56fe\uff0c\u5b9a\u4e49\u4e00\u68f5\u751f\u6210\u6811 $T$ \u7684\u6743\u503c\u4e3a\n$$\nval(T)=\\left(\\sum\\limits_{i=1}^{n-1}w_{e_i}\\right)\\times\\gcd(w_{e_1},w_{e_2},\\dots,w_{e_{n-1}})\n$$\n\u6c42\u6240\u6709\u751f\u6210\u6811\u7684\u6743\u503c\u4e4b\u548c\u3002\n\n$n\\leqslant 30 , m\\leqslant\\frac{n(n-1)}{2},1\\leqslant w_i\\leqslant 152501$ \u3002\n\n\u9996\u5148\u6211\u4eec\u628a\u788d\u4e8b\u7684 $\\gcd$ \u6d88\u6389\uff0c\u8fd9\u91cc\u901a\u8fc7\u6b27\u62c9\u53cd\u6f14\uff0c\u5373 $\\varphi*I=id$ \uff08\u8bc1\u660e\u7684\u8bdd\u628a $1\\dots n$ \u7684\u6570\u6309\u4e0e $n$ \u7684 $\\gcd$ \u5206\u7c7b\uff09\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u76f4\u63a5\u51cf\u6389\u500d\u6570\u597d\u50cf\u8fd8\u66f4\u65b9\u4fbf\u3002\u90a3\u4e48\u7b80\u5355\u63a8\u4e0b\u5f0f\u5b50\uff1a\n$$\n\\begin{aligned}\n&\\sum\\limits_T\\left(\\sum\\limits_{i=1}^{n-1}w_{e_i}\\right)\\times\\gcd(w_{e_1},w_{e_2},\\dots,w_{e_{n-1}})\\\\\n=&\\sum\\limits_T\\left(\\sum\\limits_{i=1}^{n-1}w_{e_i}\\right)\\times\\sum\\limits_{d|\\gcd(w_{e_1},w_{e_2},\\dots,w_{e_{n-1}})}\\varphi(d)\\\\\n=&\\sum\\limits_{d=1}^{w_{max}}\\varphi(d)\\sum\\limits_{ T\\wedge\\forall i,d|w_{e_i}}\\left(\\sum\\limits_{i=1}^{n-1}w_{e_i}\\right)\n\\end{aligned}\n$$\n\u6211\u4eec\u679a\u4e3e $d$ \uff0c\u6bcf\u6b21\u627e\u51fa\u6240\u6709 $w_i$ \u4e3a $d$ \u7684\u500d\u6570\u7684\u8fb9\uff0c\u6211\u4eec\u73b0\u5728\u9700\u8981\u6c42\u51fa\u4ec5\u7531\u8fd9\u4e9b\u8fb9\u6784\u6210\u7684\u751f\u6210\u6811\u7684\u8fb9\u6743\u548c\u7684\u548c\u3002\u5bf9\u4e8e\u8fd9\u4e2a\uff0c\u6211\u4eec\u6784\u9020\u4e00\u4e2a\u6a21 $x^2$ \u610f\u4e49\u4e0b\u7684\u591a\u9879\u5f0f\u77e9\u9635\uff0c\u5bf9\u6bcf\u6761\u8fb9\u91cd\u65b0\u5b9a\u4e49\u8fb9\u6743\u4e3a $1+w_ix$ \u3002\u57fa\u5c14\u970d\u592b\u77e9\u9635\u7684\u4e3b\u4f59\u5b50\u5f0f\u7b49\u4e8e $\\sum\\limits_T\\prod\\limits_{i=1}^{n-1}w_i$ \uff08\u8fd9\u4e2a\u6211\u4e0d\u4f1a\u8bc1\u660e\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u628a\u91cd\u65b0\u5b9a\u4e49\u7684\u8fb9\u6743\u5e26\u8fdb\u53bb\u53d1\u73b0\u4e00\u6b21\u9879\u7cfb\u6570\u5c31\u662f\u6211\u4eec\u8981\u6c42\u7684\u8fb9\u6743\u548c\u4e4b\u548c\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651 $\\bmod x^2$ \u610f\u4e49\u4e0b\u7684\u591a\u9879\u5f0f\u56db\u5219\u8fd0\u7b97\uff0c\u52a0\u51cf\u6cd5\u6ca1\u6709\u533a\u522b\uff0c\u4e58\u6cd5\uff1a$(a+bx)(c+dx)=ac+(ad+bc)x$\uff0c\u9664\u6cd5\uff1a$\\frac{a+bx}{c+dx}=\\frac{a}{c}+\\frac{bc-ad}{c^2}x$ \uff08\u8bc1\u660e\u7684\u8bdd\u4e58\u4e00\u4e2a $c+dx$ \u5c31\u597d\u4e86\uff09\u3002\u5f53 $c=0$ \u600e\u4e48\u529e\uff1f\u5bf9\u4e8e\u9009\u53d6\u6bcf\u4e00\u884c\u7684\u4e3b\u5143\uff0c\u6211\u4eec\u627e\u5230\u4e0d\u4e3a0\u7684\u6b21\u6570\u6700\u4f4e\u7684\u90a3\u4e00\u9879\uff0c\u5982\u679c\u6b21\u6570\u4e3a0\u90a3\u4e48\u5c31\u76f4\u63a5\u505a\uff0c\u5982\u679c\u4e3a1\u8bf4\u660e\u8fd9\u4e00\u5217\u5728\u5f53\u524d\u884c\u540e\u9762\u7684\u5e38\u6570\u9879\u90fd\u4e3a0\uff0c\u6b64\u65f6\u9664\u6cd5\u5e94\u8be5\u7279\u5224\u4e3a $\\frac{bx}{dx}=\\frac{b}{d}$\uff08\u6211\u4e0d\u662f\u5f88\u786e\u5b9a\u8fd9\u91cc\u7684\u5fc5\u8981\u6027\uff0c\u4ee3\u7801\u662f\u5426\u7279\u5224\u90fd\u8fc7\u4e86\uff09\u3002\u8fd9\u6837\u7684\u8bdd\u5bf9 $1-w_{max}$ \u90fd\u505a\u4e00\u904d\u77e9\u9635\u6811\u590d\u6742\u5ea6\u662f $O(wn^3)$ \u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u505a\u4e00\u4e2a\u526a\u679d\uff0c\u5f53\u6dfb\u52a0\u5165\u7684\u8fb9\u5927\u4e8e\u7b49\u4e8e $n-1$ \u65f6\u624d\u53bb\u505a\u77e9\u9635\u6811\uff0c\u8fd9\u6837\u7684\u590d\u6742\u5ea6\u662f $O(n^3\\max\\sigma_0w)$ \u5373 $144\\times n^3$ \uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint const N=152501,p=998244353;\nint n,u[2505],v[2505],w[2505],phi[N+5],pr[50005],cnt;\nbool flag[N+5];\nvoid init()\n{\n    phi[1]=1;\n    for(int i=2;i<=N;i++)\n    {\n        if(!flag[i])pr[++cnt]=i,phi[i]=i-1;\n        for(int j=1;j<=cnt&&i*pr[j]<=N;j++)\n        {\n            flag[i*pr[j]]=1;\n            if(!(i%pr[j])){phi[i*pr[j]]=phi[i]*pr[j];break;}\n            phi[i*pr[j]]=phi[i]*(pr[j]-1);\n        }\n    }\n}\ninline int mod(const int &x){return x>=p?x-p:x;}\nint pw(int x,int y)\n{\n    int res=1;\n    while(y)\n    {\n        if(y&1)res=1ll*res*x%p;\n        x=1ll*x*x%p;\n        y>>=1;\n    }\n    return res;\n}\nstruct poly\n{\n    int x0,x1;\n    poly(){x0=x1=0;}\n    poly(int a,int b){x0=a,x1=b;}\n    friend poly operator +(poly a,poly b)\n        {return poly(mod(a.x0+b.x0),mod(a.x1+b.x1));}\n    friend poly operator -(poly a,poly b)\n        {return poly(mod(a.x0-b.x0+p),mod(a.x1-b.x1+p));}\n    friend poly operator *(poly a,poly b)\n        {return poly(1ll*a.x0*b.x0%p,mod(1ll*a.x0*b.x1%p+1ll*a.x1*b.x0%p));}\n    friend poly operator /(poly a,poly b)\n    {\n        if(a.x0==0&&b.x0==0)\n        {\n            int inv=pw(b.x1,p-2);\n            return poly(1ll*a.x1*inv%p,0);\n        }\n        int inv=pw(b.x0,p-2);\n        return poly(1ll*a.x0*inv%p,((1ll*a.x1*b.x0-1ll*a.x0*b.x1)%p*inv%p*inv%p+p)%p);\n    }\n}mat[31][31];\nint deg(poly a){return a.x0?0:(a.x1?1:2);}\nint det()\n{\n    int f=1;\n    for(int i=1;i<=n;i++)\n    {\n        int c=i;\n        for(int j=i+1;j<=n;j++)\n            if(deg(mat[j][i])<deg(mat[c][i]))c=j;\n        if(c!=i)swap(mat[i],mat[c]),f*=-1;\n        if(deg(mat[i][i])==2)return 0;\n        for(int j=i+1;j<=n;j++)\n        {\n            poly t=mat[j][i]/mat[i][i];\n            for(int k=i;k<=n;k++)\n                mat[j][k]=mat[j][k]-mat[i][k]*t;\n        }\n    }\n    poly res;\n    if(f==1)res=poly(1,0);\n    else res=poly(p-1,0);\n    for(int i=1;i<=n;i++)res=res*mat[i][i];\n    return res.x1;\n}\nint main()\n{\n    init();\n    int m,ans=0;\n    scanf(\"%d%d\",&n,&m);\n    n--;\n    for(int i=1;i<=m;i++)scanf(\"%d%d%d\",&u[i],&v[i],&w[i]);\n    for(int i=1;i<=N;i++)\n    {\n        memset(mat,0,sizeof(mat));\n        int cnt=0;\n        for(int j=1;j<=m;j++)\n            if(!(w[j]%i))\n            {\n                mat[u[j]][v[j]]=mat[u[j]][v[j]]-poly(1,w[j]);\n                mat[v[j]][u[j]]=mat[v[j]][u[j]]-poly(1,w[j]);\n                mat[u[j]][u[j]]=mat[u[j]][u[j]]+poly(1,w[j]);\n                mat[v[j]][v[j]]=mat[v[j]][v[j]]+poly(1,w[j]);\n                cnt++;\n            }\n        if(cnt<n)continue;\n        ans=mod(ans+1ll*det()*phi[i]%p);\n    }\n    printf(\"%d\",ans);\n    return 0;\n}\n```",
        "postTime": 1593416279,
        "uid": 96912,
        "name": "AzusaCat",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6624 \u3010[\u7701\u9009\u8054\u8003 2020 A \u5377] \u4f5c\u4e1a\u9898\u3011"
    },
    {
        "content": "\u9996\u5148\u5957\u8def\u53cd\u6f14\u4e00\u6ce2\uff0c\u8bbe $W(T)$ \u8868\u793a\u751f\u6210\u6811 $T$ \u7684\u8fb9\u6743\u96c6\u5408\uff0c$\\gcd(S)$ \u8868\u793a $S$ \u4ee5\u5185\u6240\u6709\u6570\u7684 $\\gcd$\uff0c$\\text{sum}(S)$ \u8868\u793a $S$ \u4ee5\u5185\u6240\u6709\u6570\u4e4b\u548c\uff0c\u5219\u6709\n$$\n\\sum_T\\gcd(W(T))\\times \\text{sum}(W(T))=\\sum_{d=1}^{V}\\varphi(d)\\sum_{d|\\gcd(W(T))}\\text{sum}(W(T))\n$$\n\u76f8\u5f53\u4e8e\u4fdd\u7559\u6240\u6709\u8fb9\u6743\u4e3a $d$ \u7684\u500d\u6570\u7684\u8fb9\uff0c\u6c42\u6240\u6709\u751f\u6210\u6811\u7684\u6743\u503c\u548c\u3002\n\n\u5728\u6bcf\u6761\u8fb9\u4e0a\u5199\u4e2a\u591a\u9879\u5f0f $1+w_ix$\uff0c\u91cd\u65b0\u5b9a\u4e49 $D$ \u8868\u793a\u8fd9\u4e2a\u70b9\u7684\u90bb\u8fb9\u4e0a\u6240\u6709\u591a\u9879\u5f0f\u4e4b\u548c\uff0c$G$ \u7c7b\u4f3c\uff0c\u6c42\u51fa\u6700\u7ec8\u7684\u884c\u5217\u5f0f\uff08\u8fd9\u662f\u4e00\u4e2a\u591a\u9879\u5f0f\uff09\uff0c\u4e00\u6b21\u9879\u7cfb\u6570\u5c31\u662f\u6240\u6709\u751f\u6210\u6811\u7684\u6743\u503c\u548c\u3002\n\n\u73b0\u5728\u8003\u8651\u591a\u9879\u5f0f\u600e\u4e48\u505a\u9ad8\u65af\u6d88\u5143\uff1b\u53d1\u73b0\u53ea\u9700\u8981\u5728 $\\bmod x^2$ \u610f\u4e49\u4e0b\u505a\u591a\u9879\u5f0f\u4e58\u6cd5\uff0c\u591a\u9879\u5f0f\u6c42\u9006\u7b49\u7b49\u3002\u53d1\u73b0\u6027\u8d28\u76f8\u5f53\u597d\uff0c\u53ea\u8981\u5e38\u6570\u9879\u4e0d\u4e3a $0$\uff0c\u591a\u9879\u5f0f\u5c31\u4e00\u5b9a\u5b58\u5728\u9006\u3002\u5177\u4f53\u6765\u8bf4\u6709\n\n$$\n(1+ax)^{-1}\\equiv 1-ax\\pmod{x^2}\n$$\n\n\u76f4\u63a5\u66b4\u529b\u7b97\u5c31\u884c\u4e86\uff0c\u590d\u6742\u5ea6\u5927\u6982\u662f $O(n^3\\sum d(w_i))$\uff0c\u4e0d\u4f1a\u8d85\u8fc7 $n^4\\times \\max d(w_i)\\le 2\\times 10^8$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n\n#define int long long\n\nusing namespace std;\n\ninline int read(){\n\tint x=0,f=1;char c=getchar();\n\tfor(;(c<'0'||c>'9');c=getchar()){if(c=='-')f=-1;}\n\tfor(;(c>='0'&&c<='9');c=getchar())x=x*10+(c&15);\n\treturn x*f;\n}\n\nconst int mod=998244353;\nint ksm(int x,int y,int p=mod){\n\tint ans=1;\n\tfor(int i=y;i;i>>=1,x=1ll*x*x%p)if(i&1)ans=1ll*ans*x%p;\n\treturn ans%p;\n}\nint inv(int x,int p=mod){return ksm(x,p-2,p)%p;}\nint randint(int l,int r){return rand()*rand()%(r-l+1)+l;}\nvoid add(int &x,int v){x+=v;if(x>=mod)x-=mod;}\n\nconst int N=35;\nconst int W=2e5+5;\nstruct F{\n\tint a,b;\n\tF(int A,int B):a(A),b(B){}\n\tF(){}\n}a[N][N];\nF Inv(F f){int iv=inv(f.a);return F(iv,mod-1ll*iv*iv%mod*f.b%mod);}\nF operator+(F f,F g){return F((f.a+g.a)%mod,(f.b+g.b)%mod);}\nF operator-(F f,F g){return F((f.a-g.a+mod)%mod,(f.b-g.b+mod)%mod);}\nF operator*(F f,F g){return F(f.a*g.a%mod,(f.a*g.b+f.b*g.a)%mod);}\nF operator/(F f,F g){return f*Inv(g);}\nF operator*(F f,int c){return F(f.a*c%mod,f.b*c%mod);}\nbool operator==(F f,F g){return f.a==g.a&&f.b==g.b;}\nbool operator==(F f,int c){return f.a==c;}\n\nint Gauss(int n){\n\tF res=F(1,0);\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=i;j<=n;j++){\n\t\t\tif(a[j][i]==0)continue;\n\t\t\tfor(int k=1;k<=n;k++)swap(a[i][k],a[j][k]);\n\t\t\tif(i!=j)res=F(0,0)-res;break;\n\t\t}\n\t\tF iv=Inv(a[i][i]);\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tif(i==j)continue;\n\t\t\tF r=a[j][i]*iv;\n\t\t\tfor(int k=1;k<=n;k++)a[j][k]=a[j][k]-a[i][k]*r;\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++)res=res*a[i][i];\n\treturn res.b;\n}\n\nint n,m;\nvector<pair<int,int> >E[W];\nF D[N][N],G[N][N];\n\n#define fi first\n#define se second\n#define mk make_pair\n\nint phi[W];bool vis[W];\nint solve(){\n\tfor(int i=1;i<=n-1;i++)for(int j=1;j<=n-1;j++)a[i][j]=D[i][j]-G[i][j];\n\tfor(int i=1;i<=n;i++)for(int j=1;j<=n;j++)D[i][j]=G[i][j]=F(0,0);\n\treturn Gauss(n-1);\n}\n\nsigned main(void){\n\n#ifndef ONLINE_JUDGE\n\tfreopen(\"in.in\",\"r\",stdin);\n#endif\n\n\tn=read(),m=read();int V=200000;\n\tfor(int i=1;i<=m;i++){\n\t\tint u=read(),v=read(),w=read();\n\t\tE[w].emplace_back(mk(u,v));\n\t}\n\t\n\tfor(int i=1;i<=V;i++)phi[i]=i;\n\tfor(int i=2;i<=V;i++){\n\t\tif(vis[i])continue;phi[i]=i-1;\n\t\tfor(int j=i+i;j<=V;j+=i)phi[j]=phi[j]/i*(i-1),vis[j]=1;\n\t}\n//\tfor(int i=1;i<=12;i++)cout<<phi[i]<<\" \";puts(\"\");\n\tint ans=0;\n\tfor(int i=1;i<=V;i++){\n\t\tint cnt=0;\n\t\tfor(int j=i;j<=V;j+=i){\n\t\t\tcnt+=E[j].size();\n\t\t\tfor(auto e:E[j]){\n\t\t\t\tint u=e.fi,v=e.se;\n\t\t\t\tD[u][u]=D[u][u]+F(1,j),D[v][v]=D[v][v]+F(1,j);\n\t\t\t\tG[u][v]=G[u][v]+F(1,j),G[v][u]=G[v][u]+F(1,j);\n\t\t\t}\n\t\t}\n\t\tif(cnt==0)continue;\n\t\tadd(ans,solve()*phi[i]%mod);\n\t}\n\tcout<<ans<<endl;\n\n\treturn 0;\n}\n```",
        "postTime": 1681963092,
        "uid": 307453,
        "name": "\u4e91\u6d45\u77e5\u5904",
        "ccfLevel": 6,
        "title": "\u4f5c\u4e1a\u9898"
    },
    {
        "content": "\u524d\u7f6e\u829d\u58eb\uff1aMartix-Tree \u5b9a\u7406\uff0cEuler \u53cd\u6f14\u3002  \nMatrix-Tree \u5b9a\u7406\u76f8\u4fe1\u5404\u4f4d\u90fd\u4f1a\uff0c\u4e0d\u7ec6\u8bf4\u4e86\u3002  \nEuler \u53cd\u6f14\u5176\u5b9e\u5c31\u662f\u8fd9\u4e2a\u67ff\u5b50\uff1a\n$$n=\\sum_{d|n}\\varphi(d)$$\n\u53e3\u80e1\u4e00\u4e2a\u8bc1\u660e\n$$n=\\sum_{d|n}\\sum_{i=1}^{n}[\\gcd(n,i)=d]$$\n\u4e0a\u5f0f\u56e0\u4e3a\u7b2c\u4e8c\u5c42 $\\sum$ \u6700\u540e\u4e00\u5b9a\u4f1a\u53d6\u6ee1\u6240\u4ee5\u663e\u7136\u3002\u7b2c\u4e8c\u5c42\u6839\u636e\u7ea6\u6570\u7565\u4f5c\u6539\u53d8\u5f97  \n$$\\quad =\\sum_{d|n}\\sum_{i=1}^{ \\frac{n}{d}}[\\gcd( \\frac{n}{d},i)=1]$$\n\u53d1\u73b0\u7b2c\u4e8c\u5c42\u5c31\u662f $\\varphi$\uff0c\u5373\u5f97\n$$=\\sum_{d|n}\\varphi(\\frac{n}{d})=\\sum_{d|n}\\varphi(d)$$\n\n---\n\u89c2\u5bdf\u539f\u5f0f\n$$\\sum_{T\\subseteq G }\\left(\\sum_{e_i\\in T}w_{e_i}\\right)\\times\\gcd(w_{e_1},...,w_{e_{n-1}})$$\ngcd \u8fd9\u4e2a\u4e1c\u897f\u770b\u7740\u5f88\u4e0d\u53cb\u597d\uff0cEuler \u53cd\u6f14\u6574\u4e00\u4e0b\uff1a\n$$\\sum_{T\\subseteq G }\\left(\\sum_{e_i\\in T}w_{e_i}\\right)\\times\\sum_{\\forall i,d|w_i}\\varphi(d)$$\n\u60ef\u7528\u4f0e\u4fe9\u679a\u4e3e\u4e00\u4e0b $d$\uff1a\n$$\\sum_{d=1}^{\\max\\{ w_i\\}}\\varphi(d)\\times\\sum_{T\\subseteq G,\\forall i,d|w_i}\\sum_{e_i\\in T}w_{e_i}$$\n\u524d\u9762\u8fd9\u4e2a\u67ff\u5b50\u770b\u7740\u5f88\u53cb\u597d\uff0c\u4e8e\u662f\u4e0d\u7ba1\u5b83\uff0c\u5173\u952e\u662f\u600e\u4e48\u6c42\u540e\u9762\u90a3\u5768\u3002Matrix-Tree \u5b9a\u7406\u975e\u5e38 naive\uff0c\u4e00\u822c\u53ea\u7528\u6765\u6c42\u751f\u6210\u6811\u4e2a\u6570\uff0c\u4e8e\u662f\u8003\u8651\u6539\u53d8\u77e9\u9635\u4e2d\u7684\u503c\u3002\u89c2\u5bdf\u53d1\u73b0\u5982\u679c\u628a\u6bcf\u4e2a\u503c\u90fd\u53d8\u4e3a $w_ix+1$\uff0c\u6700\u540e\u6240\u5f97\u7684\u4e00\u6b21\u9879\u7cfb\u6570\u5373\u4e3a\u8981\u6c42\u7684\u540e\u9762\u90a3\u5768\uff0c\u53ef\u4ee5\u62ff\u4e24\u4e09\u4e2a\u624b\u73a9\u4e00\u4e0b\uff0c\u53d1\u73b0\u662f\u5bf9\u7684\u3002  \n\u6b64\u5904\u518d\u53e3\u80e1\u4e00\u4e2a\u8bc1\u660e\uff0c\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\uff0c\u5047\u8bbe $k$ \u6761\u8fb9\u65f6\u7b54\u6848\u662f\u5bf9\u7684\uff0c\u5219 $k+1$ \u6761\u8fb9\u65f6\uff0c\u6709\n$$\\text{val}=\\left(...+\\left(\\sum_{i=1}^{k}w_i\\right)x+1\\right)\\times (w_{k+1}x+1)$$\n\u524d\u9762\u9ad8\u6b21\u7684\u5747\u4e0d\u7528\u8003\u8651\uff0c\u5219\u53ef\u4ee5\u53d1\u73b0\u65b0\u7684\u4e00\u6b21\u9879\u7cfb\u6570\u4e3a\n$$\\text{val}_1=\\left(\\sum_{i=1}^{k}w_i\\right)+w_{k+1}$$\n\u5f97\u8bc1\u3002  \n\n\u6b64\u5904\u4f60\u53ef\u80fd\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c$d|w_i$ \u8fd9\u4e2a\u600e\u4e48\u4fdd\u8bc1\u5462\uff1f\u53ea\u9700\u8981\u628a\u6ee1\u8db3 $d|w_i$ \u7684\u8fb9\u52a0\u5165\u77e9\u9635\u4e2d\uff0c\u5269\u4e0b\u7684\u4e0d\u8003\u8651\uff0c\u518d\u8fdb\u884c\u8ba1\u7b97\u5c31\u884c\u4e86\u3002  \n\u6700\u540e\u8003\u8651\u591a\u9879\u5f0f\u7684\u8fd0\u7b97\uff0c\u9274\u4e8e\u53ea\u9700\u8981\u4e00\u6b21\u9879\uff0c\u6240\u4ee5\u6bcf\u4e2a\u591a\u9879\u5f0f\u53ea\u8981\u5b58\u4e24\u4e2a\u7cfb\u6570\u5c31\u884c\u4e86\uff0c\u552f\u4e00\u6bd4\u8f83\u9ebb\u70e6\u7684\u9664\u6cd5\u5176\u4ed6\u9898\u89e3\u4e5f\u5199\u5f97\u975e\u5e38\u6e05\u695a\u4e86\uff0c\u5c31\u4e0d\u5728\u6b64\u8d58\u8ff0\u4e86\u3002\n```cpp\n#include<bits/stdc++.h>\n#define N 35\n#define M 200005\n#define reg register\n#define inl inline\n#define int long long\nusing namespace std;\nconst int Mod=998244353;\ninl int Pow(reg int x,reg int y)\n{\n\treg int res=1;\n\tfor(;y;y>>=1,x=x*x%Mod) if(y&1) res=res*x%Mod;\n\treturn res;\n}\nstruct Poly\n{\n\tint x,y;\n\tfriend Poly operator + (const Poly &a,const Poly &b)\n\t{\n\t\treturn ((Poly){(a.x+b.x)%Mod,(a.y+b.y)%Mod});\n\t}\n\tfriend Poly operator - (const Poly &a,const Poly &b)\n\t{\n\t\treturn ((Poly){(a.x-b.x+Mod)%Mod,(a.y-b.y+Mod)%Mod});\n\t}\n\tfriend Poly operator * (const Poly &a,const Poly &b)\n\t{\n\t\treturn ((Poly){a.x*b.x%Mod,(a.x*b.y+a.y*b.x)%Mod});\n\t}\n\tfriend Poly operator / (const Poly &a,const Poly &b)\n\t{\n\t\treg int inv=Pow(b.x,Mod-2);\n\t\treturn ((Poly){a.x*inv%Mod,(a.y*b.x-a.x*b.y+Mod)%Mod*inv%Mod*inv%Mod});\n\t}\n}a[N][N];\nint n,m,st[M],to[M],w[M],sum[M],ans;\nint pri[M],phi[M],tot;\nbool isp[M];\ninl void Init()\n{\n\tphi[1]=1;\n\tfor(reg int i=2;i<=M-5;i++)\n\t{\n\t\tif(!isp[i])\n\t\t{\n\t\t\tpri[++tot]=i;\n\t\t\tphi[i]=i-1;\n\t\t}\n\t\tfor(reg int j=1;j<=tot && i*pri[j]<=M-5;j++)\n\t\t{\n\t\t\tisp[i*pri[j]]=1;\n\t\t\tif(!(i%pri[j]))\n\t\t\t{\n\t\t\t\tphi[i*pri[j]]=phi[i]*pri[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse phi[i*pri[j]]=phi[i]*(pri[j]-1);\n\t\t}\n\t}\n}\ninl int Gauss()\n{\n\treg Poly res=((Poly){1,0});\n\treg bool fg=0;\n\tfor(reg int i=1;i<n;i++)\n\t{\n\t\treg int o;\n\t\tfor(o=i;o<n;o++)\n\t\t{\n\t\t\tif(a[o][i].x) break;\n\t\t}\n\t\tif(o==n) return 0;\n\t\tif(i!=o)\n\t\t{\n\t\t\tfg^=1;\n\t\t\tfor(reg int k=1;k<n;k++) swap(a[i][k],a[o][k]);\n\t\t}\n\t\treg Poly tmp=((Poly){1,0});\n\t\ttmp=tmp/a[i][i];\n\t\tfor(reg int j=i+1;j<n;j++)\n\t\t{\n\t\t\treg Poly cnt=tmp*a[j][i];\n\t\t\tfor(reg int k=i;k<n;k++) a[j][k]=a[j][k]-cnt*a[i][k];\n\t\t}\n\t\tres=res*a[i][i];\n\t}\n\tif(fg) res=((Poly){0,0})-res;\n\treturn res.y;\n}\ninl int Solve(reg int x)\n{\n\tfor(reg int i=1;i<=n;i++)\n\t{\n\t\tfor(reg int j=1;j<=n;j++) a[i][j].x=a[i][j].y=0;\n\t}\n\tfor(reg int i=1;i<=m;i++)\n\t{\n\t\tif(!(w[i]%x))\n\t\t{\n\t\t\ta[st[i]][to[i]]=a[st[i]][to[i]]-((Poly){1,w[i]});\n\t\t\ta[to[i]][st[i]]=a[to[i]][st[i]]-((Poly){1,w[i]});\n\t\t\ta[st[i]][st[i]]=a[st[i]][st[i]]+((Poly){1,w[i]});\n\t\t\ta[to[i]][to[i]]=a[to[i]][to[i]]+((Poly){1,w[i]});\n\t\t}\n\t}\n\treturn Gauss();\n}\nsigned main()\n{\n\tInit();\n\tscanf(\"%lld %lld\",&n,&m);\n\tfor(reg int i=1;i<=m;i++)\n\t{\n\t\tscanf(\"%lld %lld %lld\",&st[i],&to[i],&w[i]);\n\t\tfor(reg int j=1;j*j<=w[i];j++)\n\t\t{\n\t\t\tif(!(w[i]%j))\n\t\t\t{\n\t\t\t\tsum[j]++;\n\t\t\t\tif(j*j!=w[i]) sum[w[i]/j]++;\n\t\t\t}\n\t\t}\n\t}\n\tfor(reg int i=1;i<=M-5;i++) if(sum[i]>=n-1) ans=(ans+Solve(i)*phi[i]%Mod)%Mod;\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1599743266,
        "uid": 23243,
        "name": "VenusM1nT",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6624 \u3010[\u7701\u9009\u8054\u8003 2020 A \u5377] \u4f5c\u4e1a\u9898\u3011"
    },
    {
        "content": "### Part 1 Matrix-Tree \u5b9a\u7406 ###\n\n[OI-wiki \u94fe\u63a5](https://oi-wiki.org/graph/matrix-tree/)\u3002\n\n\u9274\u4e8e\u7b14\u8005\u6c34\u5e73\u6709\u9650\uff0c\u6545\u4e0d\u5199\u8bc1\u660e\uff08\u53ef\u4ee5\u5728\u4e0a\u65b9\u94fe\u63a5\u4e2d\u67e5\u770b\uff09\uff0c\u53ea\u5199\u7ed3\u8bba\u3002\n\n\u5bf9\u4e8e\u4e00\u5f20\u56fe $G$\uff0c\u6784\u9020\u4e00\u4e2a\u77e9\u9635 $D$\uff0c\u6ee1\u8db3\uff1a\n\n- $D_{i,i}=\\operatorname{deg}_i$\u3002\n- $D_{i,j}=-\\operatorname{cnt}_{i,j}$\u3002\n\n\u5176\u4e2d $\\operatorname{deg}_i$ \u4e3a $i$ \u7684\u5ea6\u6570\uff0c$\\operatorname{cnt}_{i,j}$ \u4e3a\u4e24\u70b9\u4e4b\u95f4\u7684\u8fb9\u6570\u3002\n\n\u5c06\u8fd9\u4e2a\u77e9\u9635 $D$ **\u4efb\u610f**\u53bb\u6389\u4e00\u884c**\u548c**\u4e00\u5217\uff0c\u5f97\u5230\u77e9\u9635 $D'$\uff0c\u6709\u77e9\u9635 $D'$ \u7684\u884c\u5217\u5f0f\u5373\u4e3a\u539f\u56fe\u7684\u751f\u6210\u6811\u6570\u91cf\u3002\n\n\u5bf9\u4e8e\u8981\u6c42\u539f\u56fe\u7684\u751f\u6210\u6811\u8fb9\u6743\u79ef\u4e4b\u548c\uff0c\u53ea\u9700\u5728\u4fee\u6539 $\\operatorname{deg}$ \u548c $\\operatorname{cnt}$ \u65f6\u52a0\u4e0a\u8fb9\u6743\u5373\u53ef\u3002\n\n\u4f8b\u9898\uff1a [P4111 [HEOI2015]\u5c0f Z \u7684\u623f\u95f4 ](https://www.luogu.com.cn/problem/P4111)\u3002\n\n### Part 2 \u4e8c\u9879\u5f0f\u8ba1\u7b97 ###\n\n\u5bf9\u4e8e\u4e24\u4e2a\u51fd\u6570 $f_1(x)=a_1x+b_1,f_2(x)=a_2x+b_2$\uff0c\u5176\u52a0\u3001\u51cf\u3001\u4e58\u3001\u9664\uff0c\u6709\uff1a\n\n- $f(x)=f_1(x)+f_2(x)=(a_1+a_2)x+(b_1+b_2)$\u3002\n- $f(x)=f_1(x)-f_2(x)=(a_1-a_2)x+(b_1-b_2)$\u3002\n- $f(x)=f_1(x)\\times f_2(x)=a_1a_2x^2+(a_1b_2+a_2b_1)x+b_1b_2$\n- $f(x)=\\dfrac{f_1(x)}{f_2(x)}=\\dfrac{a_1b_2-b_1a_2}{{a_2}^2}x+\\dfrac{a_1}{a_2}$\n\n### Part 3 P6624 \u9898\u89e3 ###\n\n\u5148\u8003\u8651\u628a $\\gcd$ \u6d88\u6389\u3002\n\n\u6211\u4eec\u6709\uff1a\n\n$$\n\n\\left(\\sum_{i=1}^{n-1}w_{e_i}\\right)\\times \\gcd (w_{e_1},w_{e_2}\\dots,w_{e_{n-1}}) \\\\ \n\n= \\left(\\sum_{i=1}^{n-1}w_{e_i}\\right) \\times\n\\sum_{d|\\gcd (w_{e_1},w_{e_2}\\dots,w_{e_{n-1}})}\\phi(d)\n\\\\\n= \\left(\\sum_{i=1}^{n-1}w_{e_i}\\right)\\sum_{d|\\gcd (w_{e_1},w_{e_2}\\dots,w_{e_{n-1}})}\\phi(d)\n\n$$\n\nLatex \u53ef\u80fd\u4f1a\u70b8\uff0c\u8fd9\u662f[\u4e91\u526a\u8d34\u677f\u7684\u94fe\u63a5](https://www.luogu.com.cn/paste/7i8cu36m)\u3002\n\n\u6211\u4eec\u7684\u77e9\u9635\u6811\u5b9a\u7406\u80fd\u6c42\u7684\u662f**\u751f\u6210\u6811\u8fb9\u6743\u79ef\u4e4b\u548c**\uff0c\u8003\u8651\u5982\u4f55\u5c06\u8fb9\u6743\u79ef\u5316\u4e3a\u8fb9\u6743\u548c\u3002\n\n\u660e\u663e\u5355\u4e00\u7528\u6570\u6765\u505a\u4e0d\u592a\u597d\u6c42\uff0c\u8003\u8651\u5c06\u8fb9\u6743 $w$ \u770b\u4f5c\u51fd\u6570 $f(x)=wx+1$\u3002\n\n\u6839\u636e Part 2 \u7684\u4e8c\u9879\u5f0f\u8ba1\u7b97\uff0c\u53d1\u73b0\u5728\u4e58\u7684\u65f6\u5019\uff0c\u7ed3\u679c\u7684\u4e00\u6b21\u9879\u7684\u7cfb\u6570\u6b63\u597d\u662f\u4e24\u4e2a $w$ \u76f8\u52a0\uff0c\u4e8c\u6b21\u9879\u5bf9\u7b54\u6848\u65e0\u5173\u3002\n\n\u6545\u6211\u4eec\u53ef\u4ee5\u5728\u6a21 $x^2$ \u7684\u610f\u4e49\u4e0b\u8fdb\u884c\u4e58\u6cd5\u3002\n\n\u6211\u4eec\u91cd\u65b0\u5b9a\u4e49\u52a0\u51cf\u4e58\u9664\uff0c\u5bf9\u8fd9\u4e2a\u77e9\u9635\u8fdb\u884c\u884c\u5217\u5f0f\u6c42\u503c\u5373\u53ef\u3002\n\n\u6ce8\u610f\u8981\u5f00 ``long long``\u3002\n\n\u4ee3\u7801\uff1a[\u94fe\u63a5](https://www.luogu.com.cn/paste/gzb1jl82)\u3002\n\n",
        "postTime": 1679928093,
        "uid": 358739,
        "name": "BFSDFS123",
        "ccfLevel": 0,
        "title": "\u77e9\u9635\u6811\u5b9a\u7406 / P6624 \u9898\u89e3"
    },
    {
        "content": "\u590d\u76d8 $\\color{black}{\\text{n}}\\color{red}{\\text{ealchen}}$ \u795e\u4ed9\u8bb2\u7684\u9898\u3002\n\n\u5b8c\u86cb\u6211\u6700\u8fd1\u597d\u50cf\u548c\u751f\u6210\u6811\u6760\u4e0a\u4e86\u3002\n\n## Description\n\n\u7ed9\u5b9a\u4e00\u4e2a\u56fe $G$ \uff0c\u8981\u5bf9\u5b83\u6240\u6709\u751f\u6210\u6811 $T$ \u6c42\u8fd9\u6837\u7684\u4e00\u4e2a\u6743\u503c\u548c\uff1a\n\n$$val(T) = \\Big(\\sum_{e \\in T} w_e\\Big) \\cdot \\gcd(w_{e_1}\\ ,w_{e_2}\\ ,...\\ ,w_{e_{n - 1}} \\;\\!)$$\n\n\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u3002\n\n$n \\leq 20,\\ m \\leq \\frac{n (n - 1)}{2},\\ w \\leq 152501$\n\n## Analysis\n\n\u5148\u53cd\u6f14\u6389\u70e6\u4eba\u7684 $\\gcd$ \uff0c\u7136\u540e\u5927\u6982\u53ef\u4ee5\u901a\u8fc7\u679a\u4e3e $\\gcd$ \u7136\u540e\u53bb\u5feb\u901f\u627e\u5355\u8fb9\u7684\u8d21\u732e\uff0c\u770b\u8d77\u6765\u5f88\u5bf9/hanx\n\n\u53ef\u80fd\u662f\u76ee\u524d\u6700\u77ed\u7684 Analysis \u4e86\u3002\n\n## Solution\n\n\u8be5\u6362\u679a\u4e3e $\\gcd$ \uff0c\u53ef\u4ee5\u76f4\u63a5\u7528\u6b27\u62c9\u53cd\u6f14\u4e00\u6b65\u5230\u4f4d\uff1a\n\n$$x = \\sum_{d | x} \\varphi(d)$$\n\n\uff08\u8fd9\u662f\u90a3\u4e2a\u72c4\u5229\u514b\u96f7\u5377\u79ef\u7684\u5f62\u5f0f\uff09\n\n$$\\sum_{T} \\Big(\\sum_{e \\in T} w_e\\Big) \\cdot \\gcd(w_{e_1}\\ ,w_{e_2}\\ ,...\\ ,w_{e_{n - 1}})$$\n\n$$\\Rightarrow \\sum_{T} \\Big(\\sum_{e \\in T} w_e\\Big) \\cdot \\sum_{d | \\gcd(w_{e_1}\\ ,w_{e_2}\\ ,...\\ ,w_{e_{n - 1}})} \\varphi(d)$$\n\n$$\\Rightarrow \\sum_{T} \\Big(\\sum_{e \\in T} w_e\\Big) \\cdot \\sum_{d = 1} ^ {\\max w} \\varphi(d) \\cdot [d | w_{e_1} \\wedge d | w_{e_2}\\ \\wedge...\\wedge d | w_{e_{n - 1}}]$$\n\n$$\\Rightarrow \\sum_{d = 1} ^ {\\max w} \\varphi(d) \\sum_{T \\wedge \\forall i,d | w_{e_i}} \\Big(\\sum_{e \\in T} w_e\\Big)$$\n\n\u6240\u4ee5\u73b0\u5728\u6765\u770b\u76ee\u7684\u5df2\u7ecf\u5f88\u660e\u786e\u4e86\uff0c\u5c31\u662f\u5bf9\u4e8e\u6bcf\u79cd\u56e0\u6570 $d$ \uff0c\u6211\u4eec\u9700\u8981\u6240\u6709\u662f $d$ \u7684\u500d\u6570\u7684\u8fb9\u6743\uff0c\u8ba9\u540e\u8ba9\u4ed6\u4eec\u7ec4\u6210\u751f\u6210\u6811\u3002\n\n\u6240\u4ee5\u8bf4\u6211\u4eec\u53ea\u4f1a\u6c42\u6570\u91cf\u554a\uff0c\u8fb9\u6743\u548c\u600e\u4e48\u529e\u5462\uff1f\n\n\u4e8e\u662f\u6709\u8fd9\u4e48\u4e00\u4e2a trick\uff08\u7b97\u662f\u5427\uff09\uff0c\u5728 CF917D \u91cc\u5e94\u8be5\u662f\u51fa\u73b0\u8fc7\u7684\uff0c\u5927\u6982\u5c31\u662f\u6211\u4eec\u8ba9\u57fa\u5c14\u970d\u592b\u77e9\u9635\u7684\u6570\u5e26\u4e0a\u5143 $x$ \uff0c\u4e5f\u5c31\u662f\u5f62\u5982 $(w_e x + 1)$ \uff0c\u6211\u4eec\uff08\u624b\u73a9\u624b\u73a9\uff09\u5c31\u80fd\u53d1\u73b0\u8fd9\u4e2a $\\prod$ \u7684\u4e00\u6b21\u9879\u5bf9\u5e94\u7684\u6b63\u597d\u662f\u5f53\u524d\u8fb9\u6743\u5b58\u5728\u7684\u6b21\u6570\uff0c\u6700\u7ec8\u6c42\u548c\u4e5f\u5c31\u662f\u603b\u7684\u8fb9\u6743\u548c\u3002\n\n\uff08\u5177\u4f53\u662f\u56e0\u4e3a\uff1a\u5bf9\u4e8e\u4e00\u79cd\u6811\uff0c\u80fd\u591f\u751f\u6210\uff0c\u90a3\u4e48\u4e00\u6b21\u9879\u5c31\u6b63\u597d\u4ec5\u5305\u542b\u4e00\u6761\u8fb9\u7684\u6743\u503c\uff0c\u5bf9\u4e8e\u6bcf\u6761\u8fb9\u7684\u5143\u90fd\u5982\u6b64\uff0c\u90a3\u4e48\u6c42\u5408\u8d77\u6765\u5c31\u662f\u4e00\u6574\u68f5\u6811\u7684\u6743\u503c\u548c\uff09\n\n\u5177\u4f53\u5b9e\u73b0\u4e5f\u4e0d\u9700\u8981\u591a\u9879\u5f0f\uff0c\u5e94\u4e3a\u4ec5\u4fdd\u7559\u4e00\u6b21\u9879\u548c\u5e38\u6570\u9879\uff0c\u6240\u4ee5\u4e00\u4e2a pair \u89e3\u51b3\u4e00\u5207\u3002\n\n\u5269\u4e0b\u5c31\u662f\u591a\u9879\u5f0f\u7684\u52a0\u51cf\u4e58\u9664\uff0c\u52a0\u51cf\u5f88\u6dfc\uff0c\u4e58\u5c55\u5f00\u4e00\u4e0b\u5f0f\u5b50 $(ax + b)(cx + d)$ \u5c31\u884c\u4e86\uff0c\u63a5\u4e0b\u6765\u662f\u9664\u6cd5\uff1a\n\n\u5373\u6211\u4eec\u8981\u6c42\uff1a\u5047\u5b9a $ux + v = \\frac{1}{cx + d}$ \uff0c\u5373\u6c42 $(ax + b)(ux + v)$ \u3002\n\n\u56e0\u4e3a\u53ea\u4fdd\u7559\u524d\u4e24\u9879\uff0c\u5373\u53ef\u4ee5\u7406\u89e3\u4e3a\u591a\u9879\u5f0f\u5728 $\\text{mod}\\ x ^ 2$ \u7684\u610f\u4e49\u4e0b\u3002\n\n$$(ux + v)(cx + d) \\equiv 1 (\\text{mod}\\ x ^ 2)$$\n\n\u6240\u4ee5\u5c31\u6709\u4e86\uff1a\n\n$$\n\t\\left\\{\n\t\t\\begin{array}{ll}\n\t\t\tdv = 1 \\\\\n\t\t\t(cv + du)x = 0\n\t\t\\end{array}\n\t\\right.\n$$\n\n$x$ \u4e0d\u53ef\u80fd\u662f\u96f6\uff08\u4e0d\u7136\u6709\u5c41\u7528\u554a\uff09\uff0c\u6240\u4ee5\u7a0d\u5fae\u89e3\u4e00\u4e0b\uff1a\n\n$$\n\t\\left\\{\n\t\t\\begin{array}{ll}\n\t\t\tu = -\\large\\frac{c}{d ^ 2} \\\\\n\t\t\tv = \\large\\frac{1}{d}\n\t\t\\end{array}\n\t\\right.\n$$\n\n\u7136\u540e\u4f60\u5e26\u56de $(ax + b)(ux + v)$ \u5c31\u53ef\u4ee5\u5566\u3002\n\n## Code\n\n```cpp\n/*\n \n*/\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define File(a) freopen(a\".in\", \"r\", stdin), freopen(a\".out\", \"w\", stdout);\n#define Check(a) freopen(a\".in\", \"r\", stdin), freopen(a\".ans\", \"w\", stdout);\n\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef std::pair<int, int> pii;\n#define fi first\n#define se second\n#define mp std::make_pair\n\nconst int mod = 998244353;\ntemplate <typename A>\ninline int M(A x) {return x;}\ntemplate <typename A, typename ...B>\ninline int M(A x, B ... args) {return 1ll * x * M(args...) % mod;}\n\nconst int N = 32, K = 152505;\n\ninline int ksm(int a, int b) {\n\tint tm = 1;\n\tfor (; b; b >>= 1, a = M(a, a)) if (b & 1) tm = M(tm, a);\n\treturn tm;\n}\n\ninline pii operator + (const pii a, const pii b) {\n\tpii p = mp(a.fi + b.fi, a.se + b.se);\n\t(p.fi >= mod) && (p.fi -= mod);\n\t(p.se >= mod) && (p.se -= mod);\n\treturn p;\n}\n\ninline pii operator - (const pii a, const pii b) {\n\tpii p = mp(a.fi - b.fi, a.se - b.se);\n\t(p.fi < 0) && (p.fi += mod);\n\t(p.se < 0) && (p.se += mod);\n\treturn p;\n}\n\ninline pii operator * (const pii a, const pii b) {\n\tpii p = mp(M(a.fi, b.fi), M(a.fi, b.se) + M(a.se, b.fi));\n\t(p.se >= mod) && (p.se -= mod);\n\treturn p;\n}\n\ninline pii operator / (const pii a, const pii b) {\n\tint in = ksm(b.fi, mod - 2);\n\tpii p = mp(M(a.fi, in), M(a.se, b.fi) - M(a.fi, b.se));\n\t(p.se < 0) && (p.se += mod); p.se = M(p.se, in, in);\n\treturn p;\n}\n\nint n, m;\npii a[N][N];\nstruct mdzz {int u, v, w;} p[N * N];\n\ninline void getpii(int di) {\n\tmemset(a, 0, sizeof(a));\n\n\tfor (int i = 1; i <= m; ++i) {\n\t\tif (p[i].w % di) continue;\n\t\t\n\t\tint u = p[i].u, v = p[i].v;\n\t\ta[u][u] = a[u][u] + mp(1, p[i].w); a[v][v] = a[v][v] + mp(1, p[i].w);\n\t\ta[u][v] = a[u][v] - mp(1, p[i].w); a[v][u] = a[v][u] - mp(1, p[i].w);\n\t}\n}\n\ninline int del(int n) {\n\tpii w = mp(1, 0);\n\n\tfor (int i = 1; i <= n; ++i) {\n\t\tfor (int j = i + 1; j <= n; ++j) {\n\t\t\tfor (pii div; a[i][i].fi > 0; ) {\n\t\t\t\tdiv = a[j][i] / a[i][i];\n\n\t\t\t\tfor (int k = i; k <= n; ++k) {\n\t\t\t\t\ta[j][k] = a[j][k] - div * a[i][k];\n\t\t\t\t}\n\t\t\t\tswap(a[i], a[j]); w = mp(0, 0) - w;\n\t\t\t}\n\t\t\tswap(a[i], a[j]); w = mp(0, 0) - w;\n\t\t}\n\t}\n\n\tfor (int i = 1; i <= n; ++i) w = w * a[i][i];\n\n\treturn w.se;\n}\n\nint cn[K], phi[K], ans;\n\nint main() {\n\tstd::ios::sync_with_stdio(false);\n\tstd::cin.tie(nullptr);\n\n\tstd::cin >> n >> m;\n\tint mx = 0;\n\tfor (int i = 1; i <= m; ++i) {\n\t\tstd::cin >> p[i].u >> p[i].v >> p[i].w;\n\t\tmx = std::max(mx, p[i].w);\n\n\t\tfor (int j = 1; j * j <= p[i].w; ++j) {\n\t\t\tif (p[i].w % j) continue;\n\t\t\t++cn[j];\n\t\t\t(j * j != p[i].w) && (++cn[p[i].w / j]);\n\t\t}\n\t}\n\n\tphi[1] = 1;\n\tfor (int i = 2; i <= mx; ++i) {\n\t\tif (phi[i]) continue;\n\t\tphi[i] = i - 1;\n\n\t\tfor (int j = i << 1; j <= mx; j += i) {\n\t\t\tif (!phi[j]) phi[j] = j;\n\t\t\tphi[j] = phi[j] / i * (i - 1);\n\t\t}\n\t}\n\n\tfor (int i = 1; i <= mx; ++i) {\n\t\tif (cn[i] < n - 1) continue;//\u65e0\u6cd5\u4f5c\u4e3agcd\u505a\u51fa\u8d21\u732e\n\t\tgetpii(i);\n\t\tans += M(phi[i], del(n - 1));\n\t\t(ans >= mod) && (ans -= mod);\n\t}\n\n\tstd::cout << ans << \"\\n\";\n\n\treturn 0;\n}\n```\n\n\u6df1\u6df1\u660e\u767d\u81ea\u5df1\u7684\u5f31\u5c0f\u3002",
        "postTime": 1657700893,
        "uid": 206024,
        "name": "Illusory_dimes",
        "ccfLevel": 7,
        "title": "[\u7701\u9009\u8054\u8003 2020 A \u5377] \u4f5c\u4e1a\u9898"
    },
    {
        "content": "\n\u770b\u8d77\u6765\u6bd4\u8f83\u6076\u5fc3\uff0c\u5176\u5b9e\u4e0d\u662f\u5f88\u590d\u6742\uff0c\u4f46\u662f\u6709\u4e00\u4e24\u6b65\u7684\u601d\u7ef4\u2026\u2026\n\n## \u9898\u610f\n\n>  \u7ed9\u5b9a\u4e00\u4e2a\u5e26\u6743\u65e0\u5411\u56fe\uff0c\u6c42\u5176\u6240\u6709\u751f\u6210\u6811\u7684\u6743\u503c\u548c\u3002\u4e00\u68f5\u6811 $T$ \u7684\u6743\u503c\u7684\u5b9a\u4e49\u4e3a\uff08$w_i$ \u4e3a\u8fb9\u6743\uff09\uff1a\n> $$\n \\left(\\sum_{e\\in T}^{n-1} w_{e} \\right) \\times \\gcd(w_{e_1},w_{e_2},\\ldots,w_{e_{n-1}})\n $$\n> \u5373\u6240\u6709\u8fb9\u6743\u7684\u548c\u4e58\u4e0a\u6240\u6709\u8fb9\u6743\u7684\u6700\u5927\u516c\u7ea6\u6570\u3002\n>\n> $n\\leqslant 30,w_i\\leqslant 152501$\uff0c\u56fe\u4e2d\u65e0\u91cd\u8fb9\u81ea\u73af\uff0c\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u3002\n\n## \u9898\u89e3\n\n\u56de\u987e\u77e9\u9635\u6811\u5b9a\u7406\u53ef\u4ee5\u6c42\u4ec0\u4e48\uff1a\u4e00\u4e2a\u56fe\u6240\u6709\u751f\u6210\u6811\u7684\u8fb9\u6743\u79ef\u7684\u548c\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u8981\u60f3\u529e\u6cd5\u628a\u5b83\u53d8\u6210\u8fd9\u6837\u7684\u5f62\u5f0f\u3002\n\n\u8003\u8651\u6b27\u62c9\u53cd\u6f14 $\\varphi\\ast 1 = \\mathrm{id}$\uff1a\n$$\n\\left(\\sum_{e\\in T}^{n-1} w_{e} \\right) \\times \\sum_{ d\\mid  w_{ e_1 } , w_{ e_2 } , \\ldots , w_{ e_{ m-1 }}} \\varphi(d)\n$$\n\u4e8e\u662f\u5c31\u53ef\u4ee5\u8003\u8651\u63d0\u51fa\u516c\u7ea6\u6570\uff08\u8001\u751f\u957f\u8c08\u4e86\u5427\uff09\uff0c\u8bb0 $W = \\max(w_i)$\uff1a\n$$\n\\sum_{d}^W \\varphi(d) \\sum_{ d\\mid  w_{ e_1 } , w_{ e_2 } , \\ldots , w_{ e_{ m-1 }}} \\left(\\sum_{e\\in T}^{n-1} w_{e} \\right)\n$$\n\u679a\u4e3e $d$\uff0c\u7136\u540e\u628a\u662f $d$ \u7684\u500d\u6570\u7684\u8fb9\u52a0\u5165\u5230\u56fe\u4e2d\uff0c\u7136\u540e\u6c42\u8fd9\u4e2a\u56fe\u7684\u6240\u6709\u751f\u6210\u6811**\u8fb9\u6743\u548c**\u7684\u548c\u5373\u53ef\u3002\u4f46\u8fd9\u548c\u524d\u9762\u9884\u60f3\u7684\u6709\u70b9\u4e0d\u592a\u4e00\u6837\uff0c\u56e0\u4e3a\u77e9\u9635\u6811\u5b9a\u7406\u662f\u7528\u6765\u6c42\u6240\u6709\u751f\u6210\u6811**\u8fb9\u6743\u79ef**\u7684\u548c\u7684\u3002\n\n~~\u5982\u679c\u4f60\u5168\u90e8 exp \u7136\u540e ln \u56de\u6765\u8fc7\u4e86\u90a3\u4f60\u633a\u5389\u5bb3\u7684\uff0c\u6211\u90fd\u4e0d\u77e5\u9053\u8fd9\u662f\u5426\u53ef\u884c~~\u3002\n\n\u90a3\u4e48\u600e\u4e48\u6c42\u751f\u6210\u6811\u8fb9\u6743\u548c\u7684\u548c\uff1f\u6211\u4eec\u8003\u8651\u628a\u548c\u8f6c\u5316\u4e3a\u53e6\u5916\u7684\u4e1c\u897f\u7684\u79ef\uff08\u5f53\u7136\u4e0d\u662f $\\exp,\\ln$\u2026\u2026\uff09\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8fb9\u6743 $a$\uff0c\u5c06\u5176\u5199\u6210\u4e00\u4e2a\u4e00\u6b21\u51fd\u6570 $1+ax$\uff0c\u90a3\u4e48\u4e24\u4e2a\u4e00\u6b21\u51fd\u6570\u7684\u79ef\uff1a\n$$\n(1+ax)(1+bx) = 1 + (a+b)x + abx^2\n$$\n\u7684\u4e00\u6b21\u9879\u7cfb\u6570\u5c31\u662f\u4e24\u4e2a\u4e00\u6b21\u51fd\u6570\u7684\u4e58\u79ef\u3002\n\n\u56e0\u6b64\u5728\u6a21 $x^2$ \u610f\u4e49\u4e0b\u5904\u7406\u5bf9\u4e00\u6b21\u51fd\u6570\u7684\u56db\u5219\u8fd0\u7b97\u5373\u53ef\uff0c\u6700\u96be\u7684\u4f30\u8ba1\u662f\u9664\u6cd5\uff1a\n\n+ \u52a0\uff1a$(k_1x + b_1)+(k_2x + b_2) = (k_1 + k_2)x + (b_1 + b_2)$\u3002\n+ \u51cf\uff1a\u540c\u52a0\u3002\n+ \u4e58\uff1a\u4e0a\u9762\u6709\u4e86\u3002\n+ \u9664\uff1a\u8003\u8651\u5b83\u7684\u9006\u5143\u662f\u4ec0\u4e48\uff1a$\\frac{1}{kx+b} = -\\frac{k}{b^2}x + \\frac{1}{b}$\u3002\n\n\u4e8e\u662f\u5c31\u53ef\u4ee5\u5feb\u4e50\u7206\u679a+\u77e9\u9635\u6811\u5b9a\u7406\u4e86\uff0c\u6ce8\u610f\u76f4\u63a5\u505a\u662f $\\mathcal O(n^3W)$ \u7684\uff0c\u7406\u8bba\u4e0a\u4e0d\u80fd\u901a\u8fc7\u3002\u4f46\u662f\u5982\u679c $d$ \u7684\u500d\u6570\u7684\u8fb9\u6743\u4e2a\u6570\u5c11\u4e8e $n-1$ \u662f\u6ca1\u6709\u5fc5\u8981\u7b97\u77e9\u9635\u7684\uff0c\u590d\u6742\u5ea6\u4e3a $\\mathcal O(n^3 \\frac{\\sum \\sigma_0 (w_i)} {n-1})$\u3002\n\n\u8fd9\u4e2a\u5f0f\u5b50\u770b\u8d77\u6765\u6bd4\u8f83\u7384\u5b66\uff0c\u6839\u636e OEIS \u7684\u5e8f\u5217 [A002182](http://oeis.org/A002182)\uff0c$w$ \u5168\u90e8\u53d6 $110880$\uff08\u6709 $144$ \u4e2a\u7ea6\u6570\uff09\u53ef\u4ee5\u5361\u5230\u4e00\u4e2a\u4e0d\u9519\u7684\u590d\u6742\u5ea6\uff0c\u53ef\u4ee5\u53d8\u6210 $n^4 \\times 144$\uff0c\u5728\u4e09\u79d2\u7684\u65f6\u9650\u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int max_n=33,max_m=200005,mod=998244353;\ninline int read(){\n    int x=0;bool w=0;char c=getchar();\n    while(c<'0' || c>'9') w|=c=='-',c=getchar();\n    while(c>='0' && c<='9') x=(x<<1)+(x<<3)+(c^48),c=getchar();\n    return w?-x:x;\n}\ninline void write(int x){\n    if(x<0) putchar('-'),x=-x;\n    if(x>9) write(x/10);\n    putchar(x%10^48);\n}\ninline int mi(int a,int p=mod-2){\n    int res=1;\n    while(p){\n        if(p&1) res*=a,res%=mod;\n        a*=a,a%=mod,p>>=1;\n    }\n    return res;\n}\n\nint pr[max_m],cntp,phi[max_m];\nbool isp[max_m];\ninline void Getpr(int n){\n    memset(isp,1,sizeof(isp)),isp[1]=0;\n    phi[1]=1;\n    for(register int i=2;i<=n;++i){\n        if(isp[i]){\n            pr[++cntp]=i,\n            phi[i]=i-1;\n        }\n        for(register int j=1;j<=cntp && i*pr[j]<=n;++j){\n            isp[i*pr[j]]=0;\n            if(i%pr[j]==0){\n                phi[i*pr[j]]=phi[i]*pr[j];\n                break;\n            }\n            phi[i*pr[j]]=phi[i]*phi[pr[j]];\n        }\n    }\n}\n\nstruct line{\n    int k,b;\n    line operator + (const line &b) const{\n        line a=*this,res;\n        res.k=(a.k+b.k)%mod,\n        res.b=(a.b+b.b)%mod;\n        return res;\n    }\n    line operator - (const line &b) const{\n        line a=*this,res;\n        res.k=(a.k-b.k+mod)%mod,\n        res.b=(a.b-b.b+mod)%mod;\n        return res;\n    }\n    line operator * (const line &b) const{\n        line a=*this,res;\n        res.k=(a.k*b.b+a.b*b.k)%mod,\n        res.b=a.b*b.b%mod;\n        return res;\n    }\n    line operator / (const line &b) const{\n        line a=*this,res;\n        int ivb=mi(b.b);\n        res.k=(a.k*b.b%mod-a.b*b.k%mod+mod)%mod*ivb%mod*ivb%mod,\n        res.b=a.b*ivb%mod;\n        return res;\n    }\n};\ninline line makel(int k,int b){\n    line res;\n    res.k=k,res.b=b;\n    return res;\n}\n\nint n,m,W,ans;\n\nstruct matrix{\n    line a[max_n][max_n];\n    inline void clear(){\n        for(register int i=0;i<=n;++i)\n            for(register int j=0;j<=n;++j)\n                a[i][j]=makel(0,0);\n    }\n    inline void add(int x,int y,line w){\n        a[x][x]=a[x][x]+w,\n        a[y][y]=a[y][y]+w,\n        a[x][y]=a[x][y]-w,\n        a[y][x]=a[y][x]-w;\n    }\n    inline int calc(){\n        line res=makel(0,1);\n        for(register int i=1;i<n;++i){\n            int pos=i;\n            while(pos<n && !a[pos][i].b)\n                ++pos;\n            if(pos!=i){\n                swap(a[pos],a[i]);\n                res=makel(0,0)-res;\n            }\n            for(register int j=i+1;j<n;++j){\n                line tmp=a[j][i]/a[i][i];\n                for(register int k=i;k<n;++k)\n                    a[j][k]=a[j][k]-(a[i][k]*tmp);\n            }\n        }\n        for(register int i=1;i<n;++i)\n            res=res*a[i][i];\n        return (res.k%mod+mod)%mod;\n    }\n}a;\n\nstruct edge{\n    int u,v,w;\n}e[max_m];\nvector<edge> ed[max_m];\n\nsigned main(){\n    n=read(),m=read();\n    for(register int i=1;i<=m;++i){\n        e[i].u=read(),e[i].v=read(),e[i].w=read();\n        W=max(W,e[i].w);\n    }\n    Getpr(W);\n    for(register int d=1;d<=W;++d)\n        for(register int i=1;i<=m;++i)\n            if(e[i].w%d==0)\n                ed[d].push_back(e[i]);\n    for(register int d=1;d<=W;++d){\n        int _n=ed[d].size();\n        if(_n<n-1) continue;\n        a.clear();\n        for(register int i=0;i<_n;++i)\n            a.add(ed[d][i].u,ed[d][i].v,makel(ed[d][i].w,1));\n        ans=(ans+phi[d]*a.calc())%mod;\n    }\n    write((ans%mod+mod)%mod);\n    return 0;\n}\n```\n\n",
        "postTime": 1645539162,
        "uid": 181776,
        "name": "_Arahc_",
        "ccfLevel": 7,
        "title": "P6624 \u4f5c\u4e1a\u9898"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P6624)\n\n\u597d\u9898\u554a\uff0c\u771f\u7684\u597d\u9898\u554a\uff01\n\n\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14+\u77e9\u9635\u6811\u5b9a\u7406\uff08\u751a\u81f3\u8fd8\u7b97\u52a0\u4e86\u4e00\u70b9\u70b9\u7684\u751f\u6210\u51fd\u6570\u7684\u539f\u7406\uff09\n\n---\n\n**\u3010\u5206\u6790\u3011**\n--\n\n\u6839\u636e\u9898\u610f\uff0c\u6c42\u5bf9\u6240\u6709\u7684\u6811 $T$ \u7684\u503c\uff1a\n\n$\\displaystyle ans=\\sum_{T}val(T)=\\sum_{T}(\\sum_{i=1}^{n-1}w_{e_i})\\gcd_{i=1}^{n-1} w_{e_i}$\n\n> $e_i$ \u8868\u793a\u6811 $T$ \u7684\u8fb9\n\n\u7531\u6b27\u62c9\u53cd\u6f14\u5f97\uff1a$\\displaystyle n=\\sum_{d\\mid n}\\boldsymbol \\varphi(d)$\n\n\u56e0\u6b64 $\\displaystyle \\gcd_{i=1}^{n-1} w_{e_i}=\\sum_{d\\mid \\gcd_{i=1}^{n-1}w_{e_i}}\\boldsymbol \\varphi(d)=\\sum_{\\forall i\\to d\\mid w_{e_i}}\\boldsymbol \\varphi(d)$\n\n\u56e0\u6b64 $\\displaystyle ans=\\sum_T(\\sum_{i=1}^{n-1}w_{e_i})\\sum_{\\forall i\\to d\\mid w_{e_i}}\\boldsymbol \\varphi(d)$\n\n\u8c03\u6362\u679a\u4e3e\u987a\u5e8f\u5f97 $\\displaystyle ans=\\sum_{d\\geq 1}\\boldsymbol \\varphi(d)\\sum_T[\\forall i\\to d\\mid w_{e_i}](\\sum_{i=1}^{n-1}w_{e_i})$\n\n\u4e8e\u662f\u5bf9\u4e8e\u6bcf\u4e2a $w_{e_i}$ \uff0c\u6211\u4eec\u5c06\u5b83\u585e\u8fdb\u5b83\u5404\u56e0\u6570\u7684 `vector` \u4e2d\u3002\u4e4b\u540e\uff0c\u6bcf\u4e2a\u6570 $d$ \u7684 `vector` \u4e2d\uff0c\u5b58\u7740\u6240\u6709\u8fb9\u6743\u4e3a\u5b83\u500d\u6570\u7684\u8fb9\n\n\u73b0\u8003\u8651\u7ed9\u5b9a\u4e00\u4e2a `vector` \uff0c\u91cc\u9762\u5b58\u7740\u82e5\u5e72\u8fb9\uff0c\u7528\u8fd9\u4e9b\u8fb9\u751f\u6210\u6811\u7684\u6743\u503c\u548c\u4e3a\u591a\u5c11\uff0c\u5373 $\\displaystyle f(d)=\\sum_{T\\in v_d}(\\sum_{i=1}^{n-1}w_{e_i})$\n\n$\\because \\displaystyle \\sum_{i=1}^{n-1}w_{e_i}=\\sum_{i=1}^{n-1}w_{e_i}\\cdot 1$\n\n\u82e5\u4ee4 $P_i(x)=1+w_{e_i}x$\n\n\u5219 $\\displaystyle \\sum_{i=1}^{n-1}w_{e_i}\\cdot 1=\\sum_{c_1+c_2+c_3+\\cdots+c_{n-1}=1}\\prod_{i=1}^{n-1}P_i[c_i]$\n\n\u540e\u9762\u8fd9\u73a9\u610f\u513f\u672c\u8d28\u4e0a\u5c31\u662f\u5377\u79ef\uff0c\u800c\u4e14\u8fd8\u662f $1$ \u6b21\u9879\u7684\u7cfb\u6570\n\n$\\therefore \\displaystyle \\sum_{i=1}^{n-1}w_{e_i}=(\\prod_{i=1}^{n-1}P_i(x))[1]$\n\n$\\therefore \\displaystyle f(d)=\\sum_{T\\in v_d}((\\prod_{i=1}^{n-1}P_i(x))[1])=(\\sum_{T\\in v_d}\\prod_{i=1}^{n-1}P_i(x))[1]$\n\n\u4e8e\u662f\u8fd9\u5c31\u6784\u6210\u4e86\u77e9\u9635\u6811\u7684\u5f62\u5f0f\u3002\u6211\u4eec\u5c06 `vector` \u4e2d\u7684\u8fb9\uff0c\u6784\u9020\u6210\u5bf9\u5e94\u7684\u4e00\u6b21\u51fd\u6570\uff0c\u653e\u8fdb\u77e9\u9635\u4e2d\uff0c\u6c42\u4e00\u4e0b\u884c\u5217\u5f0f\u5728\u6a21 $x^2$ \u610f\u4e49\u4e0b\u7684\u503c\u3002\u518d\u628a\u4e00\u6b21\u9879\u7cfb\u6570\u8fd4\u56de\uff0c\u5c31\u662f $f(d)$ \u7684\u7ed3\u679c\n\n> \u6d88\u5143\u65b9\u6cd5\u89c1\u4e0b\n\n\u8fd9\u6837\u4e00\u6765\uff0c$\\displaystyle ans=\\sum_{d\\geq 1}\\boldsymbol \\varphi(d)f(d)$\n\n\u5982\u679c\u6bcf\u4e2a $d$ \u90fd\u6c42\u89e3\uff0c\u590d\u6742\u5ea6\u5c06\u8fbe\u5230 $O(m\\cdot n^3)$ \uff0c\u5176\u4e2d $m$ \u4e3a\u8fb9\u7684\u6700\u5927\u503c\u3002\u590d\u6742\u5ea6\u76f4\u63a5\u7206\u70b8\u3002\n\n\u8003\u8651\u5c06 `vector` \u4e2d\u7684\u8fb9\u8dd1\u4e00\u4e0b\u5e76\u67e5\u96c6\u3002\u5982\u679c\u6700\u540e\u6ca1\u6709\u5e76\u6210\u4e00\u4e2a\u8fde\u901a\u5206\u91cf\uff0c\u90a3\u4e00\u5b9a\u4e0d\u4f1a\u751f\u6210\u6811\uff0c\u8d21\u732e\u4e3a $0$ \uff0c\u76f4\u63a5\u4e0d\u8dd1\u9ad8\u65af\u6d88\u5143\u3002\n\n\u8fd9\u6837\u7684\u526a\u679d\u76f8\u5f53\u4e8e\u989d\u5916\u589e\u52a0\u4e00\u4e2a $O(mn\\cdot \\alpha(n))$ \uff0c\u4f46\u611f\u89c9\u662f\u80fd\u6263\u9664\u4e00\u5927\u90e8\u5206\u9ad8\u65af\u6d88\u5143\u3002\u8bd5\u8bd5\u80fd\u4e0d\u80fd\u8fc7~~\uff08\u6700\u540e\u5f53\u7136\u662f\u8fc7\u4e86\uff09~~\u3002\n\n---\n\n\u7b80\u5355\u8bb2\u4e00\u4e0b\u591a\u9879\u5f0f\u600e\u4e48\u5728\u6a21 $x^2$ \u610f\u4e49\u4e0b\u9ad8\u65af\u6d88\u5143\u3002\u5c06 $P(x)=a+bx$ \u8bb0\u4e3a $(a,b)$ \u5219\uff1a\n\n$(a,b)\\pm(c,d)=(a\\pm c,b\\pm d)$\n\n$(a+bx)(c+dx)=ac+(ad+bc)x+bdx^2\\equiv ac+(ad+bc)x\\pmod {x^2}$\n\n\u5373 $(a,b)\\cdot (c,d)=(ac,ad+bc)$\n\n\u82e5 $(a+bx)(c+dx)\\equiv 1\\pmod {x^2}$\n\n\u5219 $ac=1,ad+bc=0$\n\n\u6545 $c=a^{-1},d=-(bc)\\cdot a^{-1}=-bc^2$\n\n\u56e0\u6b64 $(a,b)^{-1}=(a^{-1},-a^{-2}b)$\n\n\u6545 $(a,b)/(c,d)=(a,b)\\cdot (c,d)^{-1}$\n\n\u8fd9\u6837\u4e00\u6765\u5c31\u53ef\u4ee5\u91cd\u8f7d\u8fd0\u7b97\u7b26\u4e86\uff1a\n\n```cpp\ntypedef pair<int,int> pii;\n#define fi first\n#define se second\ninline pii operator ~ (const pii &p) { ll tmp=inv(p.fi); return pii(tmp,dis(0,tmp*tmp%MOD*p.se%MOD)); }\n//\u9006\u5143\ninline pii operator - (const pii &p) { return pii( dis(0,p.fi) , dis(0,p.se) ); }\ninline pii operator + (const pii &a,const pii &b) { return pii( add(a.fi,b.fi) , add(a.se,b.se) ); }\ninline pii operator += (pii &a,const pii &b) { return a=a+b; }\ninline pii operator - (const pii &a,const pii &b) { return pii( dis(a.fi,b.fi) , dis(a.se,b.se) ); }\ninline pii operator -= (pii &a,const pii &b) { return a=a-b; }\ninline pii operator * (const pii &a,const pii &b) { return pii( (ll)a.fi*b.fi%MOD , ((ll)a.fi*b.se+(ll)a.se*b.fi)%MOD ); }\ninline pii operator *= (pii &a,const pii &b) { return a=a*b; }\ninline pii operator / (const pii &a,const pii &b) { return a*(~b); }\ninline pii operator /= (pii &a,const pii &b) { return a=a/b; }\n```\n\n---\n\n**\u3010\u4ee3\u7801\u3011**\n--\n\n\u6700\u540e\u5949\u4e0a\u672c\u849f\u84bb\u7684\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef pair<int,int> pii;\n#define fi first\n#define se second\nconst int MOD=998244353,MAXN=32,Lim=152501;\ninline ll fpow(ll a,ll x) { ll ans=1; for(;x;x>>=1,a=a*a%MOD) if(x&1) ans=ans*a%MOD; return ans; }\n//\u5feb\u901f\u5e42\ninline ll inv(ll a) { return fpow(a,MOD-2); }\ninline int add(int a,int b) { return (a+b>=MOD)?(a+b-MOD):(a+b); }\ninline int dis(int a,int b) { return (a-b<0)?(a-b+MOD):(a-b); }\n//\u6c42\u4f59\u610f\u4e49\u4e0b\u7684\u9006\u5143\u3001\u52a0\u51cf\u6cd5\n\ninline pii operator ~ (const pii &p) { ll tmp=inv(p.fi); return pii(tmp,dis(0,tmp*tmp%MOD*p.se%MOD)); }\n//\u9006\u5143\ninline pii operator - (const pii &p) { return pii( dis(0,p.fi) , dis(0,p.se) ); }\ninline pii operator + (const pii &a,const pii &b) { return pii( add(a.fi,b.fi) , add(a.se,b.se) ); }\ninline pii operator += (pii &a,const pii &b) { return a=a+b; }\ninline pii operator - (const pii &a,const pii &b) { return pii( dis(a.fi,b.fi) , dis(a.se,b.se) ); }\ninline pii operator -= (pii &a,const pii &b) { return a=a-b; }\ninline pii operator * (const pii &a,const pii &b) { return pii( (ll)a.fi*b.fi%MOD , ((ll)a.fi*b.se+(ll)a.se*b.fi)%MOD ); }\ninline pii operator *= (pii &a,const pii &b) { return a=a*b; }\ninline pii operator / (const pii &a,const pii &b) { return a*(~b); }\ninline pii operator /= (pii &a,const pii &b) { return a=a/b; }\n//\u91cd\u8f7d\u8fd0\u7b97\u7b26\n\nstruct Matrix{\n    pii Num[MAXN][MAXN];\n    inline pii det(int N){//\u6c42\u884c\u5217\u5f0f\n        pii res=pii(1,0);\n        for(register int i=1;i<=N;++i){\n            int pos=i;\n            while(pos<=N&&Num[pos][i]==pii(0,0)) ++pos;\n            if(pos>N) return pii(0,0);\n            if(pos!=i) swap(Num[pos],Num[i]),res=-res;\n            res*=Num[i][i];\n            for(register int j=N;j>=i;j--) Num[i][j]/=Num[i][i];\n\n            for(register int k=i+1;k<=N;++k)\n                for(register int j=N;j>=i;--j)\n                    Num[k][j]-=Num[i][j]*Num[k][i];\n        }\n        return res;\n    }\n}M;\nstruct Edge{\n    int u,v,w;\n    Edge(int u_=0,int v_=0,int w_=0):u(u_),v(v_),w(w_) {}\n};\nint n,Pa[MAXN],CntSet;\nint find(int u) { return (u==Pa[u])?u:(Pa[u]=find(Pa[u])); }\ninline void merge(int u,int v){\n    if(find(u)==find(v)) return ;\n    Pa[find(u)]=find(v);\n    --CntSet;\n}\n//\u5e76\u67e5\u96c6\u76f8\u5173\u64cd\u4f5c\ninline int calc(const vector<Edge> &v){\n    //\u7ed9\u5b9a vector \uff0c\u6c42\u7b54\u6848\n    if(v.size()<n-1) return 0;\n    //\u4e00\u5b9a\u4e0d\u6210\u6811\n    iota(Pa+1,Pa+n+1,1); CntSet=n;\n    memset(M.Num,0,sizeof(M.Num));\n    //\u5e76\u67e5\u96c6\u548c\u77e9\u9635\u521d\u59cb\u5316\n    for(const auto &e : v)\n        merge(e.u,e.v),\n        M.Num[e.u][e.v]-=pii(1,e.w),\n        M.Num[e.v][e.u]-=pii(1,e.w),\n        M.Num[e.u][e.u]+=pii(1,e.w),\n        M.Num[e.v][e.v]+=pii(1,e.w);\n    if(CntSet!=1) return 0;//\u65e0\u6cd5\u751f\u6210\u6811\n    return M.det(n-1).se;\n}\nvector<Edge> e[Lim+1];\nll fc[Lim+1],phi[Lim+1],prime[Lim+1],cntprime;\ninline void sieve(){\n    //\u6b27\u62c9\u7b5b\u79ef\u6027\u51fd\u6570\n    phi[1]=1;\n    for(int i=2;i<=Lim;i++){\n        if(!fc[i]) phi[i]=(fc[i]=prime[++cntprime]=i)-1;\n        for(int j=1;j<=cntprime;j++)\n            if(i*prime[j]>Lim) break;\n            else if(fc[i]>prime[j]) fc[i*prime[j]]=prime[j],phi[i*prime[j]]=phi[i]*(prime[j]-1);\n            else{\n                fc[i*prime[j]]=prime[j];\n                phi[i*prime[j]]=phi[i]*prime[j];\n                break;\n            }\n    }\n}\ninline void pre(){\n    int m;\n    cin>>n>>m;\n    for(int i=1,u,v,w;i<=m;i++){\n        cin>>u>>v>>w;\n        for(int d=1;d*d<=w;d++) if(w%d==0) {\n            e[d].push_back( Edge(u,v,w) );\n            if(w/d!=d) e[w/d].push_back( Edge(u,v,w) );\n        }\n        //\u7ed9\u56e0\u6570\u6253\u4e0a\u6807\u8bb0\n    }\n}\nint main(){\n    ios::sync_with_stdio(0);\n    cin.tie(0); cout.tie(0);\n    pre();\n    sieve();\n    ll ans=0;\n    for(int i=1;i<=Lim;i++) ans+=phi[i]*calc(e[i])%MOD;\n    ans%=MOD;\n    cout<<ans;\n    cout.flush();\n    return 0;\n}\n```\n\n",
        "postTime": 1612148907,
        "uid": 36031,
        "name": "JustinRochester",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P6624 \u3010[\u7701\u9009\u8054\u8003 2020 A \u5377] \u4f5c\u4e1a\u9898\u3011"
    }
]