[
    {
        "content": "\u5409\u7237\u7237\u9898\u771f\u662f\u505a\u4e00\u9053\u4e0d\u4f1a\u4e00\u9053\u2026\u2026\n\n\u8d81\u6211\u8fd8\u6ca1\u5fd8\u8bb0\u8fd9\u9898\u8d76\u7d27\u5199\u4e00\u6ce2\u9898\u89e3\n\n__________________\n\n### \u524d\u7f6e\u829d\u58eb:\u4e00\u4e2a\u51b7\u9759\u7684\u8111\u5b50\n\n\u55ef\u505a\u8ba1\u6570\u9898\u6700\u91cd\u8981\u7684\u5c31\u662f\u63a8\u6027\u8d28\u63a8\u6027\u8d28\u8fd8\u6709\u63a8\u6027\u8d28\n\n## \u672c\u4f53\u9898\u89e3\n\n\u9996\u5148\u6211\u4eec\u770b\u5230\u8fd9\u4e2a\u673a\u5668\u4eba\u5c45\u7136\u53ef\u4ee5\u904d\u5386\u6574\u4e2a\u7f51\u683c(\u4e5f\u5c31\u662f\u8d70\u51fa\u4e86\u4e00\u4e2a\u54c8\u5bc6\u987f\u56de\u8def)\u5c31\u77e5\u9053\u8fd9\u9898\u5fc5\u7136\u6709\u9ad8\u8bba,\u6240\u4ee5\u5148\u8ba9\u6211\u4eec\u5750\u4e0b\u6765\u63a8\u51e0\u4e2a\u7ed3\u8bba\u518d\u8bf4\n\n### \u7ed3\u8bba1:\u5c5e\u4e8e\u540c\u4e00\u526f\u5bf9\u89d2\u7ebf\u7684\u4e24\u4e2a\u683c\u5b50\u65b9\u5411\u5fc5\u7136\u76f8\u540c\n\n\u8fd9\u91cc\u7684\u526f\u5bf9\u89d2\u7ebf\u6307\u7684\u662f\u4e0b\u9762\u8fd9\u5f20\u56fe\u91cc\u6570\u5b57\u76f8\u540c\u7684\u533a\u57df\uff0c\u4f60\u4f1a\u53d1\u73b0\u5c5e\u4e8e\u540c\u4e00\u526f\u5bf9\u89d2\u7ebf\u7684\u5143\u7d20\u4e0d\u4e00\u5b9a\u76f8\u90bb\n\n![](https://cdn.luogu.com.cn/upload/pic/47526.png)\n\n\u4f46\u662f\u7531\u4e8e\u6211\u4eec\u673a\u5668\u4eba\u7684\u8d70\u6cd5\u662f\u5faa\u73af\u7684\uff0c\u56e0\u6b64\u5982\u679c\u6211\u4eec\u628a\u8fd9\u4e2a\u77e9\u9635\u590d\u5236\u51e0\u4efd\u62fc\u5728\u4e00\u8d77\u4f60\u5c31\u53d1\u73b0\u540c\u4e00\u526f\u5bf9\u89d2\u7ebf\u7684\u5143\u7d20\u76f8\u90bb\u4e86\n\n![](https://cdn.luogu.com.cn/upload/pic/47528.png)\n\n\u90a3\u4e48\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462?\n\n\u6211\u4eec\u8003\u8651\u8fd9\u6837\u4e00\u79cd\u60c5\u51b5\n\n![](https://cdn.luogu.com.cn/upload/pic/47530.png)\n\n\u5982\u679c\u51fa\u73b0\u4e86\u540c\u4e00\u526f\u5bf9\u89d2\u7ebf\u683c\u5b50\u65b9\u5411\u4e0d\u540c\u7684\u60c5\u51b5\uff0c\u90a3\u4e48\u5c31\u4f1a\u51fa\u73b0\u56fe\u4e2d\u7eff\u8272\u6253\u683c\u5b50\u65e0\u6cd5\u88ab\u8d70\u5230\u7684\u60c5\u51b5\uff0c\u5c31\u7b97\u7eff\u8272\u7684\u683c\u5b50\u662f\u6700\u4e0a\u89d2\u7684\u683c\u5b50\uff0c\u90a3\u4e48\u8fd9\u610f\u5473\u7740\u6211\u4eec\u6ca1\u6cd5\u56de\u5230\u539f\u70b9\u548c\u9898\u610f\u4e5f\u662f\u4e0d\u7b26\u5408\u7684\n\n\u6709\u4e86\u8fd9\u4e2a\u7ed3\u8bba\u6211\u4eec\u53ef\u4ee5\u63a8\u51fa\u66f4\u5f3a\u7684\u7ed3\u8bba\u6765\n\n### \u7ed3\u8bba2:\u673a\u5668\u4eba\u7684\u52a8\u4f5c\u4e00\u5b9a\u662f\u5faa\u73af\u7684\u5e76\u4e14\u5faa\u73af\u8282\u4e3a$gcd(n,m)$\n\n\u6211\u4eec\u53d1\u73b0\u4e00\u4ef6\u4e8b\u60c5\uff0c\u7531\u4e8e\u4e00\u4e2a\u70b9\u5de6\u4e0b\u548c\u53f3\u4e0b\u7684\u5143\u7d20\u5c5e\u4e8e\u540c\u4e00\u5bf9\u89d2\u7ebf\uff0c\u90a3\u4e48\u6211\u4eec\u65e0\u8bba\u600e\u4e48\u8d70\u90fd\u4f1a\u8d70\u5230\u540c\u4e00\u4e2a\u5bf9\u89d2\u7ebf\u4e0a\uff0c\u5373\u4f7f\u6211\u4eec\u7a7f\u8fc7\u8fb9\u754c\u4ece$n$\u52301\u6216\u8005\u4ece$m$\u52301\u4e5f\u662f\u5982\u6b64\uff0c\u540c\u4e00\u4e2a\u7684\u5bf9\u89d2\u7ebf\u4e0a\u673a\u5668\u4eba\u7684\u884c\u4e3a\u76f8\u540c\u56e0\u6b64\u6211\u4eec\u673a\u5668\u4eba\u7684\u52a8\u4f5c\u81ea\u7136\u5c31\u662f\u5faa\u73af\u7684\n\n\u90a3\u4e48\u6211\u4eec\u52a8\u4f5c\u7684\u5faa\u73af\u8282\u81ea\u7136\u5c31\u662f\u4e0d\u5faa\u73af\u7684\u526f\u5bf9\u89d2\u7ebf\u7684\u6570\u76ee\u4e86\uff0c\u770b\u4e0a\u53bb\u5e94\u8be5\u662f$max(n,m)$\u4e0d\u8fc7\u6211\u4eec\u53d1\u73b0\u5176\u5b9e\u662f$gcd(n,m)$\n\n\u8bc1\u660e\u7684\u8bdd\u5c31\u662f\u628a\u8fd9\u4e2a\u77e9\u9635\u590d\u5236\u51e0\u4efd\u62fc\u5728\u4e00\u8d77\uff0c\u5982\u679c\u5faa\u73af\u8282\u4e0d\u662f$gcd(n,m)$\u90a3\u4e48\u5728\u4e24\u4e2a\u77e9\u5f62\u7684\u4ea4\u754c\u51fa\u4f1a\u51fa\u73b0\u526f\u5bf9\u89d2\u7ebf\u989c\u8272\u4e0d\u540c\u7684\u60c5\u51b5\uff0c\u800c\u5faa\u73af\u8282\u662f$gcd(n,m)$\u7684\u65f6\u5019\u76f8\u5f53\u4e8e\u4e00\u5806\u6b63\u65b9\u5f62\u62fc\u5728\u4e00\u8d77\u81ea\u7136\u4e0d\u4f1a\u51fa\u73b0\u95ee\u9898\n\n### \u7ed3\u8bba3:\u4e00\u4e2a\u884c\u52a8\u65b9\u6848\u5408\u6cd5\u5f53\u4e14\u4ec5\u5f53\u4ee5\u4e0b\u6761\u4ef6\u6210\u7acb\n\n\u5047\u8bbe\u6211\u4eec\u7684\u5faa\u73af\u8282\u957f\u5ea6\u662fd,d\u6b65\u4e2d\u6709dx\u6b65\u662f\u5411\u4e0b\u8d70,dy\u6b65\u5411\u53f3\u8d70\n\n$$1.gcd(dx,n)=1$$\n\n$$2.gcd(dy,m)=1$$\n\n$$3.gcd(dx,d)=1$$\n\n\u5fc5\u8981\u6027\u8fd8\u662f\u6bd4\u8f83\u663e\u7136\u7684,\u4e0d\u7136\u6839\u636e\u88f4\u8700\u5b9a\u7406\u6211\u4eec\u77e5\u9053\u6709\u4e9b\u5750\u6807\u6c38\u8fdc\u4e0d\u53ef\u80fd\u88ab\u8868\u793a\u51fa\u6765\n\n\u81f3\u4e8e\u5145\u5206\u6027\uff1f\u4e3a\u5565\u8fd9\u6837\u4e00\u5b9a\u6709\u89e3\u554a\uff1f\n\n~~\u6211\u4e5f\u4e0d\u77e5\u9053\uff0cnb\u4e00\u70b9\u7684\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u8bc1\u660e\u4e4b\u540e\u544a\u8bc9\u6211\u8fd9\u4e2a\u83dc\u9e21~~\n\n________________\n\n## dp\n\n\u597d\u4e86\u6709\u4e86\u4ee5\u4e0a\u4e09\u4e2a\u7ed3\u8bba\u6211\u4eec\u73b0\u5728\u6b63\u5f0f\u5f00\u59cb\u505a\u9898\n\n\u90a3\u4e48\u6211\u4eec\u7684\u601d\u8def\u975e\u5e38\u66b4\u529b\uff0c\u5c31\u662f\u679a\u4e3e\u4e4b\u540e\u7136\u540e\u5927\u529bdp\n\n\u4e3a\u4e86\u907f\u5f00\u70e6\u4eba\u7684\u8fb9\u754c\u60c5\u51b5(\u4e5f\u5c31\u662f\u649e\u4e0a\u5899\u4e4b\u540e\u4ece\u53e6\u4e00\u8fb9\u7ed5\u56de\u6765)\uff0c\u6211\u4eec\u628a\u77e9\u9635\u590d\u52363\u4efd\u5206\u522b\u62fc\u5728\u5de6\u4e0b\u89d2\u548c\u53f3\u4e0a\u89d2\u548c\u53f3\u4e0b\u89d2\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u907f\u5f00\u4e86\u5206\u7c7b\u8ba8\u8bba\u95ee\u9898\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u679a\u4e3e\u6240\u6709\u5408\u6cd5\u65b9\u6848\u7684dx\u503c\uff0c\u663e\u7136$dx+dy=d$\u6240\u4ee5\u786e\u5b9a\u4e86dx\u4e4b\u540edy\u4e5f\u552f\u4e00\u786e\u5b9a\u4e86\n\n\u73b0\u5728\u6211\u4eec\u5e0c\u671b\u8ba1\u7b97\u6240\u6709\u5faa\u73af\u8282\u5185\u8d70\u4e86$(dx,dy)$\u6b65\u7684\u65b9\u6848\u7684$f(S)$\u4e4b\u548c\n\n\u597d\u4e86\u770b\u8d77\u6765\u6211\u4eec\u8fd8\u662f\u6ca1\u6cd5\u505a\uff0c\u600e\u4e48\u529e\u5462\uff1f\n\n\u6211\u4eec\u63a5\u7740\u679a\u4e3e,\u6211\u4eec\u679a\u4e3e\u649e\u8f66\u7684\u70b9\u5750\u6807\u548c\u649e\u8f66\u65f6\u5df2\u7ecf\u8d70\u8fc7\u4e86\u51e0\u4e2a\u5faa\u73af\u8282\n\n\u5047\u8bbe\u6211\u4eec\u5728$(x,y)$\u8fd9\u4e2a\u5750\u6807\u649e\u8f66\u5e76\u4e14\u5728\u7b2c$tim$\u4e2a\u5faa\u73af\u8282\u624d\u649e\u8f66\n\n\u90a3\u4e48\u6211\u4eec\u9700\u8981\u660e\u786e\u4e00\u70b9\u7684\u662f\u65e0\u8bba\u6211\u4eec\u5185\u90e8\u7684\u65b9\u6848\u662f\u4ec0\u4e48\u6837\u5b50\u7684\uff0c\u5047\u8bbe\u6211\u4eec\u5728\u8fd9\u4e2a\u5faa\u73af\u8282\u5f00\u59cb\u524d\u4f4d\u4e8e$(x,y)$\u90a3\u4e48\u5728d\u6b65\u884c\u52a8\u4e4b\u540e\u6211\u4eec\u5fc5\u7136\u4f4d\u4e8e$(x+dx,y+dy)$\u8fd9\u4e2a\u70b9\u4e0a\uff0c\u5e76\u4e14\u6211\u4eec\u7ecf\u8fc7\u7684\u70b9\u4e5f\u53ea\u80fd\u4f4d\u4e8e$(x,y),(x+dx,y+dy)$\u8fd9\u4e2a\u77e9\u5f62\u4e2d\u95f4.\n\n\u6ce8\u610f\u8fd9\u91cc\u7531\u4e8e\u6211\u4eec\u628a\u9898\u76ee\u4e2d\u7684\u77e9\u9635\u989d\u5916\u590d\u5236\u4e863\u4efd\u7136\u540e\u628a\u8fd94\u4e2a\u77e9\u9635\u62fc\u5728\u4e86\u4e00\u8d77\u6240\u4ee5\u4e0d\u5b58\u5728\u8fb9\u754c\u95ee\u9898\n\n\u90a3\u4e48\u6211\u4eec\u6070\u597d\u5728\u7b2c$tim$\u8f6e\u5728$ax,ay$\u649e\u8f66\u5f53\u4e14\u4ec5\u5f53\u6211\u4eec\u524dtim\u8f6e\u8d70\u8fc7\u7684\u8def\u5f84\u90fd\u6ca1\u6709\u649e\u8f66,\u5e76\u4e14\u524d$tim-1$\u8f6e\u4ece$ax,ay$\u8d70\u5230$x+dx,y+dy$\u7684\u65f6\u5019\u90fd\u6ca1\u6709\u649e\u8f66\n\n\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u9650\u5236\u95ee\u9898\u6211\u4eec\u53ef\u4ee5\u628a\u524d$tim$\u8f6e\u8d70\u8fc7\u7684\u77e9\u5f62\u533a\u57df\u53e0\u5728\u4e00\u8d77\u505adp,\u8fd9\u6837\u6211\u4eec\u53ea\u9700\u8981\u8bbe\u4e00\u4e2a$dp(i,j)$\u8868\u793a\u4ece1,1\u8d70\u5230i,j\u4e2d\u95f4\u4e0d\u7ecf\u8fc71\u7684\u65b9\u6848\u6570\u5c31\u53ef\u4ee5\u4e86\n\n\u6211\u4eec\u8fd8\u8981\u89e3\u51b3\u524d$tim-1$\u8f6e\u7684\u95ee\u9898\uff0c\u6211\u4eec\u628a\u524d$tim-1$\u8f6e\u8d70\u8fc7\u7684\u77e9\u5f62\u533a\u57df\u53e0\u5728\u4e00\u8d77\u505adp,\u8bbe\u4e00\u4e2a$fdp(i,j)$\u8868\u793a\u4ece$i,j$\u8d70\u5230$(dx+1,dy+1)$\u4e2d\u95f4\u4e0d\u7ecf\u8fc7\u4efb\u4f551\u7684\u65b9\u6848\u6570\n\n\u5047\u8bbe\u6211\u4eec\u5728\u7b2ctim\u8f6e\u5f00\u59cb\u65f6\u4ece$(sx,sy)$\u8fd9\u4e2a\u4f4d\u7f6e\u51fa\u53d1,\u90a3\u4e48\u6211\u4eec\u5728$sx+a,sy+b$\u649e\u8f66\u7684\u65b9\u6848\u6570\u5c31\u662f\n\n$$(dp(a-1,b)+dp(a,b-1))fdp(a,b)$$\n\n\u5f53\u7136\u6211\u4eec\u9996\u5148\u4fdd\u8bc1\u8fd9\u4e2a\u4f4d\u7f6e\u662f1\n\n\u610f\u601d\u5c31\u662f\u5728\u53e0\u52a0\u77e9\u5f62\u610f\u4e49\u4e0b\u6211\u4eec\u524dtim\u8f6e\u8d70\u5230$a,b$\u7684\u8def\u5f84\u90fd\u6ca1\u6709\u649e\u8f66\uff0c\u524d$tim-1$\u8f6e\u6211\u4eec\u8d70\u7684\u5b8c\u6574\u7684\u8def\u5f84\u4e5f\u6ca1\u6709\u649e\u8f66\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u6070\u597d\u5728$sx+a,sy+b$\u649e\u8f66\u4e86\n\n\u8fd9\u6837\u6211\u4eec\u66b4\u529b\u7edf\u8ba1\u8d21\u732e\u5c31\u80fd\u7b97\u51fa\u7b54\u6848\u4e86\n\n\u590d\u6742\u5ea6\u7b97\u51fa\u6765\u5e94\u8be5\u662f$O(Tn^4)$\u4f46\u662f\u6ca1\u6709\u4e00\u4e2an\u662f\u6ee1\u7684\u6240\u4ee5\u4e0d\u77e5\u9053\u9664\u4e86\u591a\u5c11\u7684\u5e38\u6570\u2026\u2026\u603b\u4e4b\u8dd1\u7684\u98de\u5feb\n\n\u4e0a\u4ee3\u7801~\n\n```C\n#include<cstdio>\n#include<algorithm>\nusing namespace std;const int N=110;typedef long long ll;const ll mod=998244353;\nstruct mar\n{\n    int mp[N][N];\n    inline int* operator [](const int & x){return mp[x];}\n}mp,bas[2];char mde[N][N];\nll dp[N][N];ll fdp[N][N];ll dx;ll dy;ll ans;int n;int m;\ninline void solve(mar& p,mar& q,const int& sx,const int& sy,int rd)//\u4e24\u4e2a\u7b80\u5355dp \n{\n    for(int i=0;i<=dx;i++)\n        for(int j=0;j<=dy;j++)p[1+i][1+j]=q[1+i][1+j]|mp[sx+i][sy+j];\n    for(int i=1;i<=dx+1;i++)for(int j=1;j<=dy+1;j++)dp[i][j]=0;\n    for(int i=1;i<=dx+1;i++)for(int j=1;j<=dy+1;j++)fdp[i][j]=0;\n    if(p[1][1]==0)\n    {\n        dp[1][1]=1;ll v;\n        for(int i=1;i<=dx+1;i++)\n            for(int j=1;j<=dy+1;j++)\n                v=dp[i][j],(dp[i][j+1]+=(!p[i][j+1])*v)%=mod,(dp[i+1][j]+=(!p[i+1][j])*v)%=mod;\n    }\n    if(q[dx+1][dy+1]==0)\n    {\n        fdp[dx+1][dy+1]=1;ll v;\n        for(int i=dx+1;i>=1;i--)\n            for(int j=dy+1;j>=1;j--)\n                v=fdp[i][j],(fdp[i][j-1]+=(!q[i][j-1])*v)%=mod,(fdp[i-1][j]+=(!q[i-1][j])*v)%=mod;\n    }\n    for(int i=1;i<=dx+1;i++)\n        for(int j=1;j<=dy+1;j++)\n        {\n            ll fv;if(p[i][j]==0)continue;\n            if(i==1&&j==1)fv=1;else if(i==1)fv=dp[i][j-1];else if(j==1)fv=dp[i-1][j];\n            else fv=(dp[i][j-1]+dp[i-1][j])%mod;\n            (ans+=(ll)(rd+i+j-2)*fv%mod*fdp[i][j])%=mod;\n        }\n}\ninline int gcd(int a,int b){if(a<b)swap(a,b);while(b){int c=a%b;a=b;b=c;}return a;}\ninline void solve()\n{\n    scanf(\"%d%d\",&n,&m);for(int i=1;i<=n;i++)scanf(\"%s\",mde[i]+1);\n    for(int i=1;i<=n;i++)\n        for(int j=1;j<=m;j++)mp[i][j]=(mde[i][j]=='1');\n    for(int i=1;i<=n;i++)for(int j=1;j<=m;j++)mp[i+n][j]=mp[i][j];\n    for(int i=1;i<=n;i++)for(int j=1;j<=m;j++)mp[i][j+m]=mp[i][j];\n    for(int i=1;i<=n;i++)for(int j=1;j<=m;j++)mp[i+n][j+m]=mp[i][j];int d=gcd(n,m);\n    for(dx=0,dy=d;dx<=d;dx++,dy--)//\u679a\u4e3edx\u548cdy \n    {\n    \tif(dx==0&&n!=1)continue;if(dy==0&&m!=1)continue;\n        if(gcd(dx,d)!=1||gcd(dx,n)!=1||gcd(dy,m)!=1)continue;\n        for(int i=0;i<=dx+1;i++)for(int j=0;j<=dy+1;j++)bas[0][i][j]=0;\n        for(int i=0;i<=dx+1;i++)for(int j=0;j<=dy+1;j++)bas[1][i][j]=0;\n        for(int rd=0,p=1,q=0;rd<n*m;rd+=d,p^=1,q^=1)\n            solve(bas[p],bas[q],(rd*dx/d)%n+1,(rd*dy/d)%m+1,rd);\t\n    }printf(\"%lld\\n\",ans);ans=0;\n}\nint main(){int T;scanf(\"%d\",&T);for(int z=1;z<=T;z++)solve();return 0;}//\u62dc\u62dc\u7a0b\u5e8f~ \n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        "postTime": 1546177887,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4558 \u3010[JSOI2018]\u673a\u5668\u4eba\u3011"
    },
    {
        "content": "\u611f\u8c22xyx\u5927\u795e\u8a00\u4f20\u8eab\u6559\uff0c\u8ba9\u6211\u5f04\u61c2\u4e86\u8fd9\u4e00\u9898\u3002\n\n#### \u4e00\u9053\u795e\u4ed9\u9898\uff0c\u73b0\u573a\u53ea\u62ff\u4e8620\u5206\n\n\u5148\u8003\u8651\u7b2c2\u4e2a\u90e8\u5206\u5206\uff0c\u5373\u5168\u662f\u969c\u788d\u7684\u60c5\u51b5\uff0c\u4e5f\u5c31\u662f\u6c42\u89e3\u53ef\u884c\u7684\u65b9\u6848\u6570\u3002\n\n\u82e5n=m\u65f6\uff0c\u8003\u8651\u5982\u4e0b\u6027\u8d28\uff1a\n\n### \u5047\u8bbe\u70b9A\u6307\u5411\u4e86\u5176\u4e0b\u65b9\u7684\u70b9B\uff0c\u90a3\u4e48\u5176\u53f3\u65b9\u7684\u70b9C\u7684\u524d\u9a71\u5c31\u53ea\u80fd\u662f\u5176\u4e0a\u65b9\u7684\u70b9\u3002\n\n### \u6240\u4ee5\uff0c\u77e9\u9635\u7684\u6bcf\u4e00\u6761\u526f\u5bf9\u89d2\u7ebf\uff08\u5de6\u4e0b-\u53f3\u4e0a\uff09\u4e0a\u7684\u5143\u7d20\u65b9\u5411\u5e94\u5f53\u76f8\u540c\n\n## \u56e0\u6b64\u6bcf\u79cd\u65b9\u6848\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u5faa\u73af\u7684\u5411\u53f3/\u5411\u4e0b\u7684\u64cd\u4f5c\u5e8f\u5217\n\n~~\u6211\u4eec\u73b0\u5728\u5df2\u7ecf\u6709O\uff082^n\uff09\u6b21\u65b9\u7b97\u6cd5\u4e86~~\n\n\u8003\u8651n=m\u65f6\uff0c\u6211\u4eec\u679a\u4e3e\u4e86\u4e00\u79cd\u65b9\u6848\u540e\uff0c~~\u6253\u8868~~\u5206\u6790\u540e\u53d1\u73b0\uff1a\n#### \u5047\u8bbe\u6709x\u4e2a\u5411\u4e0b\u7684\u64cd\u4f5c\uff0cN\u2212x\u4e2a\u5411\u53f3\u64cd\u4f5c\uff0c\u5f53\u4e14\u4ec5\u5f53x\u22a5N\uff0c\u64cd\u4f5c\u5e8f\u5217\u5408\u6cd5\u3002\n\n\u8bd5\u7740~~\u53e3\u80e1~~\u8bc1\u660e\u4e00\u4e0b\uff1a\n\nn=m\u65f6\n\n1+k*x % n\n\n1+k*(n-x) % n\n\n\u5982\u679c\u4e0d\u4e92\u8d28\uff0c\u90a3\u6709\u4e9b\u4f4d\u7f6e\u6c38\u8fdc\u4e0d\u4f1a\u78b0\u5230\u3002\n\n\u5fc5\u8981\u6027\u8bc1\u660e\u5b8c\u6bd5\uff0c\u5145\u5206\u6027 ~~\u6bdb\u60f3\u60f3~~ \u5f88\u663e\u7136\u3002\n\n\u56e0\u6b64\u7b54\u6848\u4e3a \n\n\n$\\sum_{i=0}^n$[i\u22a5N]\u2217$C_n^i$\n\n\n\u8003\u8651N\u2260M,\u4ee4d=gcd(n,m)\n\n\u53ef\u4ee5\u53d1\u73b0\u6bcf\u4e2ad\u2217d\u7684\u6b63\u65b9\u5f62\u5185\u90e8\u7684\u65b9\u5411\u6392\u5e03\u662f\u4e00\u6837\u7684\uff0c\u611f\u6027\u8bc1\u660e\u6bd4\u8f83\u663e\u7136\uff0c\u5927\u5bb6\u753b\u753b\u56fe\u5c31\u77e5\u9053\u4e86\u3002\n\n\u7b54\u6848\u4e3a\n\n$\\sum_{i=0}^d$[i\u22a5d]\u2217[i\u22a5n]\u2217[(d-i)\u22a5m]\u2217$C_d^i$\n\n\u8003\u8651100%\u6570\u636e\uff1a\n\n## \u8003\u8651\u8f6c\u5316\u95ee\u9898\uff1a\u78b0\u5230\u969c\u788d\u524d\u8d70\u7684\u8def\u7a0b=\u78b0\u5230\u6bcf\u4e2a\u969c\u788d\u65f6\u8d70\u7684\u8def\u7a0b\u7684\u6700\u5c0f\u503c\u3002\n\n\u90a3\u4e48\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u5982\u4f55\u8ba1\u7b97\u78b0\u5230\u6bcf\u4e2a\u969c\u788d\u65f6\u8d70\u7684\u8def\u7a0b\u7684\u6700\u5c0f\u503c\u3002\n\n\u8003\u8651dp[i][j][k]\u8868\u793a\u5728\uff08i\uff0cj\uff09\u4e0a\uff0c\u78b0\u5230\u969c\u788d\u65f6\u8d70\u7684\u8def\u7a0b\u7684\u6700\u5c0f\u503c\u4e3ak\u7684\u65b9\u6848\u6570\u3002\n\n\u7531\u4e8e\u6bcf\u4e2ad\u2217d\u7684\u6b63\u65b9\u5f62\u5185\u90e8\u7684\u65b9\u5411\u6392\u5e03\u662f\u4e00\u6837\u7684\uff0c\u679a\u4e3e\u6709i\u4e2a\u5411\u4e0b\u7684\u64cd\u4f5c\uff0cj=d-i\u4e2a\u5411\u53f3\u64cd\u4f5c\uff0c\u9996\u5148\u8981\u6ee1\u8db3\u4e0a\u6587\u4e2d\u7684\u9650\u5236:[i\u22a5d]\u2217[i\u22a5n]\u2217[j\u22a5m]\u3002\n\n\u82e5\u4e0d\u8003\u8651\u969c\u788d\uff0c\u4ece(x,y)\u51fa\u53d1\uff0c\u7ecf\u8fc7d\u6b65\u540e\uff0c\u6211\u4eec\u5fc5\u7136\u4f1a\u8d70\u5230(i+x,j+y)\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\u8def\u7ebf\u88ab\u56fa\u5b9a\u4f4f\u4e86\uff01\n\n\u6240\u4ee5\u53ea\u8981\u5728[1~i+1][1~j+1]\u4e2ddp\u5c31\u597d\u4e86\u3002\n\n\u8bb0\u683c\u5b50(x,y)(1\u2264x\u2264i+1,1\u2264y\u2264j+1)\u7684\u6743\u503c\u4e3a\u8d70\u5230\u6709\u969c\u788d\u7684\u683c\u5b50(x+k\u2217i,y+k\u2217j)(k\u2208N)\u7684\u6700\u5c0f\u6b65\u6570\u3002\n\ndp[i][j][k]\u7684\u8f6c\u79fb\u5f88\u663e\u7136\uff0c\u5411dp[i+1][j][min(k,(i+1,j)\u7684\u6743\u503c)]\u548cdp[i][j+1][min(k,(i,j+1)\u7684\u6743\u503c)]\u8f6c\u79fb\u3002\n\n\u5177\u4f53\u7684\u53ef\u4ee5\u770b\u4ee3\u7801\uff0c\u89c9\u5f97\u6bd4\u6211\u8bb2\u7684\u6e05\u6670\u591a\u4e86\u2026\u2026\n\n```cpp\n// user:halahen\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=55;\nconst int mod=998244353;\nint i,j,k;\nchar c=' ';\nint n,m;\nint opt,T;\nint mp[maxn][maxn],f[maxn][maxn];\nint dp[maxn][maxn][maxn*maxn];\nint x,y,d,tx,ty,w,ans;\nint read(){\n    int tot=0,fh=1;\n    char c=getchar();\n    while ((c<'0')||(c>'9')){ if(c=='-') fh=-1; c=getchar(); }\n    while ((c>='0')&&(c<='9')){ tot=tot*10+c-'0'; c=getchar(); }\n    return tot*fh;\n}\nint gcd(int x,int y){\n    if (y==0) return x;\n    return gcd(y,x%y);\n}\nint main(){\n    T=read();\n    for (opt=1;opt<=T;opt++){\n        n=read(); m=read(); d=gcd(n,m); ans=0;\n        if ((n==1)&&(m==1)){ printf(\"1\\n\"); continue; }\n        for (i=1;i<=n;i++){\n            while ((c<'0')||(c>'9')){ c=getchar(); }\n            for (j=1;j<=m;j++){\n                mp[i][j]=c-'0';\n                c=getchar();\n            }\n        }\n        for (x=0;x<=d;x++){\n            y=d-x;\n            if (((x==0)&&(n==1))||((y==0)&&(m==1))||((gcd(x,d)==1)&&(gcd(y,d)==1)&&(gcd(x,n)==1)&&(gcd(y,m)==1))){\n                for (i=1;i<=x+1;i++){\n                    for (j=1;j<=y+1;j++){\n                        tx=i; ty=j; w=(i-1)+(j-1);\n                        f[i][j]=n*m;\n                        for (k=1;k<=n*m/d;k++){\n                            if (mp[tx][ty]==1){\n                                f[i][j]=min(f[i][j],w);\n                                break;\n                            }\n                            tx=tx+x; ty=ty+y; w=w+d;\n                            if (tx>n) tx=tx-n;\n                            if (ty>m) ty=ty-m; \n                        }\n                    }\n                }\n                memset(dp,0,sizeof(dp)); dp[1][1][f[1][1]]=1;\n                for (i=1;i<=x+1;i++){\n                    for (j=1;j<=y+1;j++){\n                        for (k=1;k<=n*m;k++){\n                            if (i+1<=x+1) dp[i+1][j][min(k,f[i+1][j])]=(dp[i+1][j][min(k,f[i+1][j])]+dp[i][j][k])%mod;\n                            if (j+1<=y+1) dp[i][j+1][min(k,f[i][j+1])]=(dp[i][j+1][min(k,f[i][j+1])]+dp[i][j][k])%mod;\n                        }\n                    }\n                }\n                for (i=1;i<=n*m;i++){\n                    ans=(ans+(long long)dp[x+1][y+1][i]*i)%mod;\n                }\n            }\n        }\n        printf(\"%d\\n\",ans);\n    }\n    return 0;\n}\n```",
        "postTime": 1538109632,
        "uid": 20310,
        "name": "\u8f6e\u56de\u4e4b\u7ec8\u672b",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4558 \u3010[JSOI2018]\u673a\u5668\u4eba\u3011"
    },
    {
        "content": "\u8865\u5145\u4e00\u4e0b\u8bc1\u660e\uff1a\n\n\u6211\u4eec\u5148\u5206\u6790\u201c\u53ef\u4ee5\u904d\u5386\u6240\u6709\u683c\u5b50\u201d\u7684\u65b9\u6848\u957f\u4ec0\u4e48\u6837\u3002\n\n- **\u6027\u8d281\uff1a** \u9996\u5148\uff0c\u4e24\u4e2a\u683c\u5b50\u7684\u65b9\u5411\u4e0d\u53ef\u80fd\u671d\u5411\u540c\u4e00\u4e2a\u683c\u5b50\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u673a\u5668\u4eba\u4e0d\u80fd\u904d\u5386\u5168\u90e8\u7684\u683c\u5b50\u3002\n\n\u7531\u6b64\u53ef\u4ee5\u5bfc\u51fa\u4e24\u4e2a\u63a8\u8bba\uff1a\n\n- **\u63a8\u8bba1\uff1a** \u77e9\u9635\u7684\u6bcf\u4e00\u6761\u201c\u5de6\u4e0b\u53f3\u4e0a\u201d\u5bf9\u89d2\u7ebf\u4e0a\uff0c\u683c\u5b50\u7684\u65b9\u5411\u76f8\u540c\u3002\n\n- **\u63a8\u8bba2\uff1a** \u5982\u679c\u4ece\u4e0a\u5230\u4e0b\u7ed9\u77e9\u9635\u7684\u6bcf\u6761\u5de6\u4e0a\u53f3\u4e0b\u5bf9\u89d2\u7ebf\u7f16\u53f7\uff0c\u5219\u7b2c$i$\u6761\u4e0e\u7b2c$i+gcd(n,m)$\u6761\u4e0a\uff0c\u683c\u5b50\u7684\u65b9\u5411\u76f8\u540c\u3002\n\n\u4e3a\u4ec0\u4e48\u5462\uff1f**\u63a8\u8bba1**\u5f88\u597d\u7406\u89e3\uff0c\u56e0\u4e3a\u5b83\u662f\u901a\u8fc7**\u6027\u8d281**\u76f4\u63a5\u5f97\u51fa\u7684\u3002\n\n**\u63a8\u8bba2**\u53ef\u4ee5\u8fd9\u6837\u770b\uff1a\u7531\u4e8e\u8de8\u8d8a\u4e0b\u8fb9\u754c\u548c\u53f3\u8fb9\u754c\u53c8\u4f1a\u56de\u5230\u4e0a\u8fb9\u754c\u548c\u5de6\u8fb9\u754c\uff0c\u6211\u4eec\u4e0d\u96be\u73b0\u8c61\u51fa\uff0c\u673a\u5668\u4eba\u5b9e\u9645\u4e0a\u662f\u5728\u4e00\u4e2a\u65e0\u7a77\u5927\u7684\u5e73\u9762\u5185\u884c\u8d70\u3002\u5982\u679c\u4ece$(1,1)$\u51fa\u53d1\uff0c\u884c\u8d70\u4e86$nm$\u6b65\uff0c\u6bcf\u4e00\u6b65\u90fd\u4e0d\u7ecf\u8fc7\u91cd\u590d\u7684\u70b9\uff0c\u610f\u5473\u7740\u201c\u53ef\u4ee5\u904d\u5386\u6240\u6709\u683c\u5b50\u201d\u3002\u8fd9\u4e2a\u65e0\u7a77\u5927\u7684\u5e73\u9762\u7531\u539f\u59cb\u77e9\u9635\u8d4b\u503c\u65e0\u7a77\u591a\u6b21\u8fde\u63a5\u800c\u6210\u3002\u800c\u8fd9\u4e2a\u65e0\u7a77\u77e9\u9635\u663e\u7136\u4e5f\u5f97\u6ee1\u8db3**\u63a8\u8bba1**\uff0c\u56e0\u6b64\uff0c\u901a\u8fc7\u7b80\u5355\u7684\u6570\u5b66\u63a8\u5bfc\u5f97\u5230\u4e86**\u63a8\u8bba2**.\n\n\u7531**\u63a8\u8bba2**\u8fdb\u4e00\u6b65\u5f97\u5230\uff0c\u673a\u5668\u4eba\u7684\u8fd0\u52a8\u65b9\u5f0f\u662f\u6bcf$\\gcd(n,m)$\u6b65\u4e3a\u4e00\u4e2a\u5468\u671f\u7684\u3002\n\n\u4ee4$d=\\gcd(n,m)$\uff0c$\\Delta x$\u4e3a\u6700\u5f00\u59cb\u7684$d$\u6b65\u4e2d\uff0c\u6709\u51e0\u6b65\u5411\u4e0b\u8d70\uff0c$\\Delta y$\u7c7b\u4f3c\u3002\u90a3\u4e48\uff0c\u7531\u4e8e\u7ecf\u8fc7\u4e86$nm$\u6b65\u6211\u4eec\u9700\u8981\u56de\u5230\u539f\u70b9\uff0c\u5e76\u4e14\u4e2d\u9014\u4e0d\u7ecf\u8fc7\u91cd\u590d\u7684\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u5217\u51fa\u4e0b\u5217\u5f0f\u5b50\uff1a\n\n\u7eb5\u5750\u6807\u7b2c\u4e00\u6b21\u56de\u5230$1$\u7684\u65f6\u95f4\u662f\uff1a$d*lcm(\\Delta x,n)/\\Delta(x)$\uff0c\u6a2a\u5750\u6807\u7b2c\u4e00\u6b21\u56de\u5230$1$\u7684\u65f6\u95f4\u662f$d*lcm(\\Delta y, m)/\\Delta y$\uff0c\u56e0\u6b64\u5b83\u4eec\u540c\u65f6\u56de\u5230$1$\u7684\u65f6\u95f4\u662f\uff1a\n$$\nd*lcm(\\frac{lcm(\\Delta x,n)}{\\Delta x},\\frac{lcm(\\Delta y, m)}{\\Delta y})\n$$\n\u53c8\u56e0\u4e3a\uff0c\u7b2c\u4e00\u6b21\u56de\u5230$1$\u7684\u65f6\u95f4\u5fc5\u987b\u662f$nm$\uff0c\u6240\u4ee5\u5217\u51fa\u65b9\u7a0b\uff1a\n$$\nlcm(\\frac{lcm(\\Delta x,n)}{\\Delta x},\\frac{lcm(\\Delta y, m)}{\\Delta y})=\\frac{nm}{gcd(n,m)}\n$$\n\u5c06\u8fd9\u4e2a\u65b9\u7a0b\u5316\u7b80\u53ef\u4ee5\u5f97\u5230\uff1a\n$$\ngcd(\\frac{\\Delta x}{gcd(\\Delta x, n)},\\frac{\\Delta y}{gcd(\\Delta y, m)})gcd(\\Delta x, n)gcd(\\Delta y, m) = 1\n$$\n\u7531\u6b64\u6211\u4eec\u53d1\u73b0\uff1a\n\n$$\ngcd(\\Delta x,n)=1\n$$\n$$\ngcd(\\Delta y,m)=1\n$$\n$$\ngcd(\\Delta x,\\Delta y)=1\n$$\n\n\u6211\u4eec\u628a\u8fd9\u4e2a\u53eb\u505a**\u63a8\u8bba\u4e09**\uff1a\n\n- **\u63a8\u8bba\u4e09\uff1a** \u4efb\u4f55\u4e00\u4e2a\u5408\u6cd5\u7684\u65b9\u6848\u90fd\u6ee1\u8db3$gcd(\\Delta x,n)=gcd(\\Delta y,m)=gcd(\\Delta x,\\Delta y)=1$\uff0c\u4e14$\\Delta x+\\Delta y=gcd(n,m)$\n\n\u65e2\u7136\u5f97\u5230\u4e86\u6240\u6709\u5408\u6cd5\u65b9\u6848\u7684\u901a\u5f0f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5c1d\u8bd5\u89e3\u51b3\u539f\u95ee\u9898\u4e86\u3002",
        "postTime": 1553822192,
        "uid": 41155,
        "name": "totorato",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4558 \u3010[JSOI2018]\u673a\u5668\u4eba\u3011"
    },
    {
        "content": "## [\u535a\u5ba2\u9605\u8bfb](https://www.cnblogs.com/wljss/p/12185155.html)\n\n\u7ed3\u8bba\u9898&DP\n\n\u53d1\u73b0\u9898\u76ee\u9650\u5236\u548c\u6761\u4ef6\u8f83\u591a\uff0c\u8ba9\u6211\u4eec\u5148\u5750\u4e0b\u6765\u6570\u4e00\u6570\u6761\u4ef6\uff0c\u63a8\u4e00\u63a8\u7ed3\u8bba\u3002\n\n\u673a\u5668\u4eba\u884c\u8d70\u8981\u6c42\uff1a\n\n1.\u673a\u5668\u4eba\u53ea\u80fd\u5411\u53f3\u6216\u5411\u4e0b\u3002\n\n2.\u673a\u5668\u4eba\u8d70\u5230\u8fb9\u754c\u540e\u4f1a\u56de\u5230\u884c/\u5217\u5750\u6807\u4e3a1\u7684\u5730\u65b9\u3002\n\n3.\u8981\u6c42\u673a\u5668\u4eba\u8d70\u8fc7\u6bcf\u4e00\u4e2a\u70b9\u4e14\u4ec5\u8d70\u4e00\u6b21\u3002\n\n4.\u662f\u5148\u89c4\u5b9a\u597d\u4e86\u673a\u5668\u4eba\u7684\u6bcf\u4e00\u79cd\u884c\u8d70\u8def\u7ebf\uff0c\u518d\u653e\u7684\u969c\u788d\u7269\u3002\n\n> #### 1.\u4ece\u5de6\u4e0b\u5230\u53f3\u4e0a\u76f4\u7ebf\u4e0a\u673a\u5668\u4eba\u7684\u884c\u8d70\u65b9\u5411\u76f8\u540c\u3002\n\n\u8fd9\u662f\u6700\u57fa\u672c\u7684\u4e00\u6761\u7ed3\u8bba\uff0c\u6211\u4eec\u89c2\u5bdf\u4e00\u4e0b\u5bf9\u4e8e $(i+1,j)$ \u548c $(i,j+1)$ \u8fd9\u4e24\u4e2a\u70b9\uff0c\u5018\u82e5\u5728\u8fd9\u4e24\u4e2a\u70b9\u8d70\u7684\u65b9\u5411\u4e0d\u4e00\u6837\uff0c\u90a3\u4e48 $(i+1,j+1)$ \u8fd9\u4e2a\u70b9\u8981\u4e48\u8d70\u4e0d\u5230\uff0c\u8981\u4e48\u4f1a\u8d70\u4e24\u904d\uff0c\u90fd\u4e0d\u7b26\u5408\u9898\u610f\u3002\n\n> #### 2.\u673a\u5668\u4eba\u884c\u52a8\u7684\u5faa\u73af\u8282\u662f $gcd(n,m)$ \u3002\n\n\u6211\u4eec\u4ece\u5de6\u4e0b\u5411\u53f3\u4e0a\u753b\u51fa\u6bcf\u4e00\u6761\u5bf9\u89d2\u7ebf\uff08\u6ce8\u610f\u8fd8\u6709\u53f3\u4e0b\u89d2\uff09\uff0c\u4e00\u5171\u6709$n+m$\u6761\uff0c\u5c06\u65b9\u5411\u4e00\u6837\u7684\u7528\u4e00\u79cd\u989c\u8272\u6d82\u4e0a\uff0c\u4e00\u79cd\u989c\u8272\u4f1a\u6d82 $\\displaystyle \\frac{lcm(n+m,n)}{n}$ \u6761\u7ebf\uff0c\u4e00\u5171\u5c31\u9700\u8981 $\\displaystyle \\frac {n+m} { \\frac{lcm(n+m,n)}{n}}=gcd(n,m)$ \u79cd\u989c\u8272\uff0c\u4e5f\u5c31\u662f\u5faa\u73af\u8282\u7684\u957f\u5ea6\u3002\n\n> #### 3.\u8bbe\u5728\u4e00\u4e2a\u5faa\u73af\u8282\u91cc\u673a\u5668\u4eba\u5411\u4e0b\u8d70\u4e86 $dx$ \u6b65\uff0c\u5411\u53f3\u8d70\u4e86 $dy$ \u6b65\uff0c\u673a\u5668\u4eba\u7684\u884c\u8d70\u65b9\u6848\u5408\u6cd5\u5f53\u4e14\u4ec5\u5f53 $gcd(dx,n)=1,gcd(dy,m)=1,gcd(dx,dy)=1$ \u3002\n\n\u524d\u4e24\u4e2a\u7528\u88f4\u8700\u5b9a\u7406\u5f88\u597d\u89e3\u91ca\uff0c\u5bf9\u4e8e\u7b2c\u4e09\u4e2a\uff0c\u6211\u4eec\u8bbe $d=gcd(n,m)$ ,\u90a3\u4e48 $dx+dy=d$ ,\u56e0\u4e3a $gcd(dx,n)=1$ ,\u6240\u4ee5 $gcd(dx,d)=1$ ,\u6240\u4ee5 $gcd(dx,dy)=1$ \u3002 \n\u56e0\u4e3a $n$ \u6bd4\u8f83\u5c0f\uff0c\u66b4\u529b\u679a\u4e3e\u4e00\u4e0b $dx$ \u5c31\u884c\u5566\u3002\n\nDP\u8bbe $val[x][y]$ \u4e3a\u6309\u7167 $dx,dy$ \u8d70\uff0c\u6700\u65e9\u4ec0\u4e48\u65f6\u5019\u649e\u4e0a\u969c\u788d\u7269\uff0c\u542b\u4e49\u5c31\u662f\u53ea\u8981\u7ecf\u8fc7\u4e86 $(x,y)$ \uff0c\u90a3\u4e48\u5728\u7b2c $val[x][y]$ \u6b65\u4e00\u5b9a\u4f1a\u649e\u4e0a\u969c\u788d\u7269\u3002\n\u8bbe $f[i][j][k]$ \u4e3a\u4ece\u8d77\u70b9\u5230 $(i,j)$ \u7684\u6240\u6709\u8def\u5f84\u4e2d\uff0c\u8def\u4e0a\u6700\u5c0f\u7684 $val$ \u662f $k$ \u7684\u65b9\u6848\u6570\uff0c\u56e0\u4e3a\u6211\u4eec\u786e\u5b9a\u4e86\u524d $d$ \u6b65\u6574\u5f20\u5730\u56fe\u7684\u884c\u8d70\u65b9\u6848\u5c31\u786e\u5b9a\u4e0b\u6765\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u7528DP\u5230 $(dx+1,dy+1)$ (\u6ce8\u610f\u6211\u4eec\u7684\u8d77\u70b9\u662f $(1,1)$ ).\u6700\u540e\u6c42\u4e00\u4e0b\u65b9\u6848\u6570*val\u4e4b\u548c\u5c31\u884c\u4e86\u3002\n```cpp\n#include<iostream>\n#include<cstdio>\n#define LL long long\nusing namespace std;\nint T, n, m, d, ans, x, y;\nconst int N = 52, mod = 998244353;\nint val[N][N], f[N][N][N * N];\nchar mp[N][N];\nint work(int x) {return x >= mod ? x - mod : x;}\nint GCD(int x, int y) {return y ? GCD(y, x % y) : x;}\nint DP(int dx, int dy) \n{\n\tfor (int i = 1; i <= dx + 1; ++i)\n\t\tfor (int j = 1; j <= dy + 1; ++j)\n\t\t\tfor (int k = 1; k <= n * m; ++k)f[i][j][k] = 0;\n\tf[1][1][val[1][1]] = 1;\n\tfor (int i = 1; i <= dx + 1; ++i)\n\t\tfor (int j = 1; j <= dy + 1; ++j)\n\t\t\tfor (int k = 1; k <= n * m; ++k) \n\t\t\t{\n\t\t\t\tif (!f[i][j][k])continue;\n\t\t\t\tint &t1 = f[i + 1][j][min(k, val[i + 1][j])], &t2 = f[i][j + 1][min(k, val[i][j + 1])];\n\t\t\t\tif (i <= dx)t1 = work(t1 + f[i][j][k]);\n\t\t\t\tif (j <= dy)t2 = work(t2 + f[i][j][k]);\n\t\t\t}\n\tint res = 0;\n\tfor (int i = 1; i <= n * m; ++i)res = work(res + (LL)i * f[dx + 1][dy + 1][i] % mod);\n\treturn res;\n}\nint main() \n{\n\tcin >> T;\n\twhile (T--) \n\t{\n\t\tscanf(\"%d%d\", &n, &m); d = GCD(n, m); ans = 0;\n\t\tfor (int i = 1; i <= n; ++i)scanf(\"%s\", mp[i] + 1);\n\t\tfor (int dx = 0, dy; dx <= d; ++dx) \n\t\t{\n\t\t\tdy = d - dx;\n\t\t\tif (GCD(dx, dy) != 1 || GCD(dx, n) != 1 || GCD(dy, m) != 1)continue;\n\t\t\tfor (int x = 1; x <= dx + 1; ++x)\n\t\t\t\tfor (int y = 1; y <= dy + 1; ++y) \n\t\t\t\t{\n\t\t\t\t\tint tx = x, ty = y, w = x + y - 2; val[x][y] = n * m;\n\t\t\t\t\tdo \n\t\t\t\t\t{\n\t\t\t\t\t\tif (mp[tx][ty] == '1') {val[x][y] = w; break;}\n\t\t\t\t\t\ttx += dx, ty += dy, w += d;\n\t\t\t\t\t\tif (tx > n)tx -= n; if (ty > m)ty -= m;\n\t\t\t\t\t} while (tx != x || ty != y);\n\t\t\t\t}\n\t\t\tans = work(ans + DP(dx, dy));\n\t\t}\n\t\tcout << ans << \"\\n\";\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1578973786,
        "uid": 153843,
        "name": "wljss",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4558 \u3010[JSOI2018]\u673a\u5668\u4eba\u3011"
    },
    {
        "content": "\u9996\u5148\u5fc5\u987b\u60f3\u5230\u4ece\u5fc5\u8981\u6761\u4ef6\u51fa\u53d1\u3002\u7531\u4e8e\u4ece $(1,1)$ \u51fa\u53d1\u56de\u5230 $(1,1)$ \u7684\u8def\u5f84\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u70b9\u6070\u597d\u88ab\u7ecf\u8fc7\u4e00\u6b21\uff0c\u6240\u56fe\u4e2d\u8fb9\u6570\u4e0e\u70b9\u6570\u76f8\u540c\uff0c\u6240\u4ee5\u6bcf\u4e00\u4e2a\u70b9\u7684\u5165\u5ea6\u4e3a $1$\u3002\u518d\u76f4\u89c2\u4e00\u70b9\u5462\uff1f\u5bf9\u4e8e\u4ece\u5de6\u4e0b\u5230\u53f3\u4e0a\u7684\u5bf9\u89d2\u7ebf\uff0c\u6bcf\u4e00\u6761\u5bf9\u89d2\u7ebf\u4e0a\u683c\u5b50\u7684\u6307\u5411\u76f8\u540c\u3002\n\n\u518d\u5c06\u8fb9\u754c\u7684\u60c5\u51b5\u8003\u8651\u8fdb\u53bb\uff0c\u53ef\u4ee5\u5f97\u5230\u6a2a\u7eb5\u5750\u6807\u4e4b\u548c $\\bmod \\gcd(n,m)$ \u76f8\u540c\u7684\u683c\u5b50\u6307\u5411\u76f8\u540c\uff08\u89c6\u4e3a\u4e00\u4e2a\u7b49\u4ef7\u7c7b\uff09\u3002\n\n\u73b0\u5728\u6211\u4eec\u6765\u8003\u5bdf\u4ece\u4e00\u4e2a\u7b49\u4ef7\u7c7b\u5230\u76f8\u540c\u7b49\u4ef7\u7c7b\u7684\u8fc7\u7a0b\uff0c\u5176\u4e2d\u5171\u8d70\u4e86 $d = \\gcd(n,m)$ \u6b65\uff0c\u8bbe\u4e24\u4e2a $n, m$ \u65b9\u5411\u5206\u522b\u8d70\u4e86 $x,y(x+y=d)$ \u6b65\u3002\n\n\u4ece $(1,1)$ \u51fa\u53d1\u518d\u56de\u5230 $(1,1)$ \u7ecf\u8fc7\u4e86\u82e5\u5e72\u4e2a\u8fd9\u6837\u7684\u8fc7\u7a0b\u3002$n$ \u65b9\u5411\u91cd\u65b0\u56de\u5230 $1$ \u81f3\u5c11\u9700\u8981 $\\frac {\\operatorname{lcm}(n,x)} {x}$ \u8fd9\u6837\u7684\u8fc7\u7a0b\uff0c$m$ \u65b9\u5411\u540c\u7406\u81f3\u5c11 $\\frac {\\operatorname{lcm}(m,y)} {y}$ \u6b65\u3002\u4ece $(1,1)$ \u518d\u8fd4\u56de\u81f3\u5c11 $\\operatorname{lcm}(\\frac {\\operatorname{lcm}(n,x)} {x},\\frac {\\operatorname{lcm}(m,y)} {y})$ \u8fd9\u6837\u7684\u8fc7\u7a0b\u3002\n\n\u8981\u4fdd\u8bc1\u6bcf\u4e2a\u683c\u5b50\u6070\u597d\u7ecf\u8fc7\u4e00\u6b21\uff0c\u5219\u6070\u597d\u7ecf\u8fc7 $nm$ \u4e2a\u683c\u5b50\uff0c\u6c47\u603b\u5982\u4e0b\uff1a\n$$\n\\operatorname{lcm}(\\frac {\\operatorname{lcm}(n,x)} {x},\\frac {\\operatorname{lcm}(m,y)} {y})d = nm\n$$\n\u5c06 $\\operatorname{lcm}(a,b)$ \u5c55\u5f00\u4e3a $\\frac {ab} {\\gcd(a,b)}$ \u5316\u7b80\u53ef\u5f97\uff1a\n$$\n\\gcd(\\frac {n} {\\gcd(x,n)},\\frac {m} {\\gcd(y,m)}) \\gcd(x,n)\\gcd(y,m)=\\gcd(n,m)\n$$\n\n$$\n\\gcd(n \\gcd(y,m),m  \\gcd(x,n))=\\gcd(n,m)\n$$\n\n\u9996\u5148 \n$$\n\\gcd(\\gcd(y,m),\\gcd(x,n))=1\n$$\n\u5373\n$$\n\\gcd(x,y)=1\n$$\n\u53c8\u7531\u4e8e\n$$\n\\gcd(\\frac {n} {\\gcd(n,m)}, \\gcd(x,n))=1\n$$\n\u5176\u4e2d\u6700\u53f3\u4fa7 $n$ \u7684\u9650\u5236\u88ab\u4e25\u683c\u5305\u542b\uff0c\u4e0d\u8003\u8651\u3002$n$ \u4e2d\u56e0\u5b50 $\\gcd(n,m)$ \u5bf9 $x$ \u5b8c\u5168\u4e0d\u4ea7\u751f\u5f71\u54cd\uff0c\u4e5f\u53ef\u4ee5\u5ffd\u7565\uff0c\u90a3\u4e48\u53ef\u4ee5\u540c\u7406\u5f97\u5230\n$$\n\\gcd(x,n)=1,\\gcd(y,m)=1\n$$\n\u8fd9\u4e24\u4e2a\u662f\u5145\u8981\u6761\u4ef6\u3002\u4e0a\u9762\u7684 $\\gcd(x,y) = 1$ \u88ab\u8fd9\u4e24\u4e2a\u6761\u4ef6\u4e25\u683c\u5305\u542b\uff0c\u6240\u4ee5\u4e0b\u9762\u53ea\u9700\u5bf9\u8fd9\u4e24\u4e2a\u6761\u4ef6\u6765\u8ba1\u6570\u3002\n\n\u8ba1\u6570\u8f83\u4e3a\u7b80\u5355\u3002\u53ef\u4ee5\u5148\u679a\u4e3e $x$\uff0c\u8fd9\u6837\u5c31\u77e5\u9053\u4e86\u6211\u4eec\u904d\u5386\u4e0e $(1, 1)$ \u76f8\u540c\u7b49\u4ef7\u7c7b\u683c\u5b50\u7684\u987a\u5e8f\uff0c\u518d\u679a\u4e3e\u6700\u7ec8\u505c\u6b62\u662f\u5728\u54ea\u4e2a\u8fc7\u7a0b\u4e2d\u3002\u8bbe $f_{i,j}$ \u8868\u793a\u8003\u8651\u5230 $(x_0 + i, y_0 + j)$ \u7684\u4f4d\u7f6e\u7684\u65b9\u6848\u6570\uff0c$x_0,y_0$ \u8868\u793a\u4e0e $(1, 1)$ \u76f8\u540c\u7b49\u4ef7\u7c7b\u683c\u5b50\u3002\u8f6c\u79fb\u65f6\u53ea\u9700\u8981\u63d0\u524d\u9884\u5904\u7406\u51fa $g_{i,j,t}$ \u8868\u793a\u4ece $(x_0 + i, y_0 + j)$ \u5f00\u59cb\u5230 $(x_0 + x, y_0 + y)$\uff0c\u6709\u591a\u5c11\u65b9\u6848\u53ef\u4ee5\u4e0d\u4f1a\u5728 $\\le t$ \u7684\u8fc7\u7a0b\u4e2d\u7206\u70b8\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(Tn^4)$\u3002\n\n```c++\n#include <bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define mp make_pair\n#define inf (ll)1e9\n#define pii pair <ll, ll>\nconst ll mod = 998244353;\n//char buf[1 << 21], *p1 = buf, *p2 = buf;\n//#define getchar() (p1 == p2 && (p2 = (p1 = buf) + fread(buf, 1, 1 << 18, stdin), p1 == p2) ? EOF : *p1++)\n#define fr first\n#define se second\ninline ll read () {\n\tll x = 0, f = 1;\n\tchar ch = getchar ();\n\twhile (ch < '0' || ch > '9') f = ((ch == '-') ? -1 : f), ch = getchar ();\n\twhile (ch >= '0' && ch <= '9') x = x * 10 + ch - '0', ch = getchar ();\n\treturn x * f;\n}\ninline void write (ll x) {\n\tif (x < 0) x = -x, putchar ('-');\n\tif (x >= 10) write (x / 10);\n\tputchar (x % 10 + '0');\n}\ninline void Add(ll &x, ll y) {\n\tx += y;\n\tif(x >= mod) x -= mod;\n}\nll n, m, d;\nchar ch[105][105];\n\nll tot;\npii p[5005];\nll f[55][55], g[55][55][55];\ninline ll solve(ll fx, ll fy) { \n\ttot = 0;\n\tll nx = 1, ny = 1;\n\twhile(1) {\n\t\tp[++tot] = mp(nx, ny);\n\t\tll nxtx = nx + fx, nxty = ny + fy;\n\t\tif(nxtx > n) nxtx -= n;\n\t\tif(nxty > m) nxty -= m;\n\t\tif(nxtx == 1 && nxty == 1) break; \n\t\tnx = nxtx, ny = nxty;\n\t}\n\tmemset(g, 0, sizeof g);\n\tfor(ll t = 0; t < tot; t++) {\n\t\tg[fx][fy][t] = 1;\n\t\tfor(ll i = fx; i >= 0; i--) {\n\t\t\tfor(ll j = fy; j >= 0; j--) {\n\t\t\t\tll fl = 1;\n\t\t\t\tfor(ll k = 1; k <= t; k++) fl &= (ch[p[k].fr+i][p[k].se+j] == '0');\n\t\t\t\tif(!fl) continue;\n\t\t\t\tif(i != fx) Add(g[i][j][t], g[i+1][j][t]);\n\t\t\t\tif(j != fy) Add(g[i][j][t], g[i][j+1][t]);\n\t\t\t}\n\t\t}\n\t}\n\tll Ans = 0;\n\tfor(ll t = 1; t <= tot; t++) {\n\t\tmemset(f, 0, sizeof f);\n\t\tf[0][0] = 1;\n\t\tfor(ll i = 1; i < t; i++) if(ch[p[i].fr][p[i].se] == '1') f[0][0] = 0;\n\t\tif(ch[p[t].fr][p[t].se] == '1') {\n\t\t\tAdd(Ans, f[0][0] * ((t - 1) * d) * g[0][0][t-1] % mod);\n\t\t\tf[0][0] = 0;\n\t\t}\n\t\tfor(ll i = 0; i <= fx; i++) {\n\t\t\tfor(ll j = 0; j <= fy; j++) {\n\t\t\t\tif(!f[i][j] || i + j + 1 == fx + fy) continue;\n\t\t\t\t// i + 1\n\t\t\t\tif(i != fx) {\n\t\t\t\t\tll val = f[i][j];\n\t\t\t\t\tfor(ll k = 1; k < t; k++) if(ch[p[k].fr+i+1][p[k].se+j] == '1') val = 0;\n\t\t\t\t\tif(ch[p[t].fr+i+1][p[t].se+j] == '1') {\n\t\t\t\t\t\tAdd(Ans, val * ((t - 1) * d + i + j + 1) % mod * g[i+1][j][t-1] % mod);\n\t\t\t\t\t\tval = 0;\n\t\t\t\t\t}\n\t\t\t\t\tAdd(f[i+1][j], val);\t\n\t\t\t\t}\n\t\t\t\t// j + 1\n\t\t\t\tif(j != fy) {\n\t\t\t\t\tll val = f[i][j];\n\t\t\t\t\tfor(ll k = 1; k < t; k++) if(ch[p[k].fr+i][p[k].se+j+1] == '1') val = 0;\n\t\t\t\t\tif(ch[p[t].fr+i][p[t].se+j+1] == '1') {\n\t\t\t\t\t\tAdd(Ans, val * ((t - 1) * d + i + j + 1) % mod * g[i][j+1][t-1] % mod);\n\t\t\t\t\t\tval = 0;\n\t\t\t\t\t}\n\t\t\t\t\tAdd(f[i][j+1], val);\t\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn Ans;\n}\nint main () {\n//\tfreopen (\".in\", \"r\", stdin);\n//\tfreopen (\".out\", \"w\", stdout);\n\tll T = read();\n\twhile(T--) {\n\t\tn = read(), m = read();\n\t\tfor(ll i = 1; i <= n; i++) scanf(\"%s\", ch[i] + 1);\n\t\tfor(ll i = 1; i <= n; i++) for(ll j = 1; j <= m; j++) ch[i+n][j] = ch[i][j+m] = ch[i+n][j+m] = ch[i][j];\n\t\td = __gcd(n, m);\n\t\tll Ans = 0;\n\t\tfor(ll fx = 0; fx <= d; fx++) {\n\t\t\tll fy = d - fx;\n\t\t\tif(__gcd(n, fx) != 1 || __gcd(m, fy) != 1) continue;\n\t\t\tAdd(Ans, solve(fx, fy));\n\t\t}\n\t\twrite(Ans), putchar('\\n');\n\t}\n\treturn 0;\n}\n/*\n*/\n```\n\n",
        "postTime": 1683125317,
        "uid": 161847,
        "name": "Para",
        "ccfLevel": 0,
        "title": "P4558"
    }
]