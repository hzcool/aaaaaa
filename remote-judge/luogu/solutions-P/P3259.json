[
    {
        "content": "[P3259 [JLOI2014]\u8def\u5f84\u89c4\u5212](https://www.luogu.org/problemnew/show/P3259)\n\n\u8fd9\u79cd\u9898\u4e3a\u4ec0\u4e48\u505a\u7684\u4eba\u8fd9\u4e48\u5c11\uff1f\uff1f\uff1f\n\n\u6211\u6765\u8d21\u732e\u4e00\u53d1\u9898\u89e3\u3002\n\n### \u9898\u76ee\u5927\u610f\uff1a\n\n\u7ed9\u5b9a\u4e00\u4e2a\u65e0\u5411\u56fe\uff0c\u6bcf\u6761\u8fb9\u6709\u8fb9\u6743\uff0c\u6709\u4e9b\u70b9\u6709\u70b9\u6743\uff0c\u4e00\u4e9b\u70b9\u662f\u52a0\u6cb9\u7ad9\u3002\n\n\u6c42\u4e00\u6761\u8d77\u70b9\u5230\u7ec8\u70b9\u7684\u6700\u77ed\u8def\uff0c\u4f7f\u7ecf\u8fc7\u6709\u70b9\u6743\u7684\u70b9\u4e0d\u8d85\u8fc7$k$\u6b21\uff0c\u4e00\u7ba1\u6cb9\u53ea\u80fd\u8d70$limit$\u7684\u65f6\u95f4\uff0c\u65f6\u95f4\u5230\u4e86\u5c31\u53ea\u80fd\u5230\u52a0\u6cb9\u7ad9\u82b1$cost$\u7684\u65f6\u95f4\u52a0\u6cb9\u3002\n\n### \u89e3\u6cd5\n\n\u90a3\u4e2a\u7ea2\u7eff\u706f\u7684\u8ba1\u7b97\u516c\u5f0f\u662f$\\frac{red^2}{2\\times(red+green)}$\u3002\n\n\u7136\u540e\u628a\u8fd9\u4e2a\u65f6\u95f4\u9644\u52a0\u5230\u8282\u70b9\u7684\u51fa\u8fb9\u4e0a\u3002\n\n\u7136\u540e\uff0c\u6211\u4eec\u5efa\u7acb\u5206\u5c42\u56fe\uff1a\n\n\u7b2c$i$\u5c42\u8868\u793a\u7ecf\u8fc7\u4e86$i$\u4e2a\u7ea2\u7eff\u706f\u65f6\uff0c\u4ece\u6e90\u70b9\u5230\u8be5\u70b9\u7684\u6700\u77ed\u8def\u5f84\u957f\u5ea6\u3002\n\n\u5982\u679c\u6ca1\u6709\u6cb9\u91cf\u9650\u5236\uff0c\u90a3\u4e48\u6211\u4eec\u76f4\u63a5\u8dd1\u6700\u77ed\u8def\u5c31\u884c\u4e86\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5982\u4f55\u53bb\u6389\u8fd9\u4e2a\u6cb9\u91cf\u9650\u5236\u3002\n\n\u6ce8\u610f\u5230\u52a0\u6cb9\u7ad9\u5f88\u5c11\uff0c\u4e8e\u662f\u6211\u4eec\u679a\u4e3e\u4ee5\u6bcf\u4e2a\u52a0\u6cb9\u7ad9\u4e3a\u8d77\u70b9\uff0c\u5411\u5176\u4ed6\u52a0\u6cb9\u7ad9\u7ecf\u8fc7\u82e5\u5e72\u4e2a\u7ea2\u7eff\u706f\u7684\u6700\u77ed\u8def\u5f84\u3002\n\n\u82e5\u6b64\u957f\u5ea6\u4e0d\u5927\u4e8e\u6700\u5927\u6cb9\u91cf\uff0c\u90a3\u4e48\u53ef\u4ee5\u76f4\u63a5\u8f6c\u79fb\u3002\n\n\u6211\u4eec\u7528\u8fd9\u79cd\u65b9\u6cd5\u6784\u9020\u65b0\u56fe\uff0c\u4f9d\u65e7\u662f\u5206\u5c42\u56fe\uff0c\u53ef\u662f\u6bcf\u4e00\u5c42\u4ec5\u6709$50$\u4e2a\u70b9\uff0c\u4e14\u6ca1\u6709\u6cb9\u91cf\u9650\u5236\u3002\n\n\u7136\u540e\u5c31\u80fd\u8dd1\u5206\u5c42\u56fe$SPFA$\u4e86\u3002\n\n\u6ce8\uff1a\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\uff0c\u6211\u7684$SPFA$\u8981\u52a0\u4e0a$SLF$\u4f18\u5316\u624d\u80fd\u8fc7\uff0c\u5426\u5219\u5c31\u662f#4 $TLE$\u3002\n\n[\u6709\u7a7a\u5c31\u5230\u672c\u849f\u84bb\u7684\u535a\u5ba2\u91cc\u5750\u5750\u561b\uff01](https://www.cnblogs.com/Yangrui-Blog/p/9535892.html)\n\n\u9644\u4ee3\u7801\uff1a\uff08\u6211\u81ea\u5df1\u90fd\u89c9\u5f97\u597d\u4e11\u554a\u3002\u3002\u3002\uff09\n```cpp\n#include<iostream>\n#include<algorithm>\n#include<cstdio>\n#include<map>\n#include<string>\n#include<deque>\n#include<cmath>\n#define MAXN 10010\n#define MAXM 200010\n#define eps (1e-7)\n#define MAX (1<<30)//\u4e00\u5927\u5806\u5b8f\u5b9a\u4e49\nusing namespace std;\n\nmap<string,int> name;//\u76f4\u63a5\u7528map\u5b58\u8282\u70b9\u7f16\u53f7\nint n,m,k,cost,limit,s,t;\nint top=0,gas_stack[MAXN],id[MAXN][12];\ndouble length[MAXN];\nbool gas[MAXN];\n\ninline int read(){\n\tint date=0,w=1;char c=0;\n\twhile(c<'0'||c>'9'){if(c=='-')w=-1;c=getchar();}\n\twhile(c>='0'&&c<='9'){date=date*10+c-'0';c=getchar();}\n\treturn date*w;\n}\n\nstruct SPFA{\n\tint c,head[MAXM];\n\tdouble path[MAXM];\n\tbool vis[MAXM];\n\tSPFA(){c=1;}\n\tstruct Graph{\n\t\tint next,to;\n\t\tdouble w;\n\t}a[MAXM<<2];\n\tinline int relax(int u,int v,double w){\n\t\tif(path[v]>path[u]+w){\n\t\t\tpath[v]=path[u]+w;\n\t\t\treturn 1;\n\t\t}\n\t\treturn 0;\n\t}\n\tinline void add(int u,int v,double w){\n\t\ta[c].to=v;a[c].w=w;a[c].next=head[u];head[u]=c++;\n\t}\n\tvoid spfa(int s){\n\t    int u,v;\n\t    deque<int> q;\n\t    for(int i=1;i<=n*(k+1);i++){path[i]=MAX;vis[i]=false;}\n\t    path[s]=0;\n\t    vis[s]=true;\n\t    q.push_back(s);\n\t    while(!q.empty()){\n\t        u=q.front();\n\t        q.pop_front();\n\t        vis[u]=false;\n\t        for(int i=head[u];i;i=a[i].next){\n\t            v=a[i].to;\n\t            if(relax(u,v,a[i].w)&&!vis[v]){\n\t                vis[v]=true;\n\t                if(!q.empty()){\n\t                    if(path[v]>path[q.front()])q.push_back(v);\n\t                    else q.push_front(v);\n\t                }\n\t                else q.push_back(v);\n\t            }\n\t        }\n\t    }\n\t}\n}one,two;//\u65e7\u56fe\u548c\u65b0\u56fe\n\ninline void add_edge(int u,int v,int w){//\u5efa\u7acb\u5206\u5c42\u56fe\n\tif(fabs(length[v])>eps)for(int j=0;j<k;j++)one.add(id[u][j],id[v][j+1],w+length[v]);\n\telse for(int j=0;j<=k;j++)one.add(id[u][j],id[v][j],w);\n}\nvoid work(){//\u6c42\u89e3\n\tdouble ans=MAX;\n\ttwo.spfa(s);\n\tfor(int i=0;i<=k;i++)ans=min(ans,two.path[t+i*n]);\n\tprintf(\"%.3lf\\n\",ans);\n}\nvoid init(){//\u8bfb\u5165+\u9884\u5904\u7406+\u5efa\u5206\u5c42\u56fe\n\tstring x;\n\tint u,v;\n\tdouble w;\n\tn=read();m=read();k=read();limit=read();cost=read();\n    \n\tfor(int i=0;i<=k;i++)\n\tfor(int j=1;j<=n;j++)\n\tid[j][i]=j+i*n;\n    \n\tfor(int i=1;i<=n;i++){\n\t\tcin>>x;\n\t\tname[x]=i;\n\t\tint red=read(),green=read();\n\t\tif(x==\"start\")s=i;\n\t\telse if(x==\"end\")t=i;\n\t\tif(x.find(\"gas\")!=string::npos)gas[i]=true;\n\t\tif(red)length[i]=1.00*red*red/(double)(2.00*(red+green));\n\t\telse length[i]=0;\n\t}\n    \n\tfor(int i=1;i<=m;i++){\n\t\tcin>>x;u=name[x];\n\t\tcin>>x;v=name[x];\n\t\tcin>>x;w=read();\n\t\tadd_edge(u,v,w);\n\t\tadd_edge(v,u,w);\n\t}\n    \n\tgas[s]=gas[t]=true;\n\tfor(int i=1;i<=n;i++)if(gas[i])gas_stack[++top]=i;\n    \n\tfor(int i=1;i<=top;i++){//\u65e7\u56fe\u4e0e\u65b0\u56fe\u7684\u8f6c\u6362\n\t\tone.spfa(gas_stack[i]);\n\t\tfor(int j=1;j<=top;j++){\n\t\t\tif(i==j)continue;\n\t\t\tw=(gas_stack[j]!=s&&gas_stack[j]!=t)?cost:0;\n\t\t\tfor(int l=0;l<=k;l++)\n\t\t\tif(one.path[id[gas_stack[j]][l]]<=limit)\n\t\t\tfor(int p=0;p+l<=k;p++)\n\t\t\ttwo.add(id[gas_stack[i]][p],id[gas_stack[j]][p+l],one.path[id[gas_stack[j]][l]]+w);\n\t\t}\n\t}\n}\nint main(){//\u4e3b\u51fd\u6570So easy!\n\tinit();\n\twork();\n    return 0;\n}\n```",
        "postTime": 1535212178,
        "uid": 49998,
        "name": "\u65af\u5fb7\u54e5\u5c14\u6469",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3259 \u3010[JLOI2014]\u8def\u5f84\u89c4\u5212\u3011"
    }
]