[
    {
        "content": "\u7b2c\u4e00\u611f\u89c9\u5c31\u662f\u6bd2\u7624\u8ba1\u7b97\u51e0\u4f55\uff0c\u7136\u540e\u770b\u4e86\u770b\u9898\u89e3\uff0c\u53d1\u73b0\u8981\u8f6c\u6362\u5750\u6807\u7cfb\uff0c\u628a\u7ed9\u5b9a\u7684\u5411\u91cf\u770b\u6210\u65b9\u5411\u5411\u91cf\uff0c\u4f5c\u4e3a\u57fa\u5e95\u89e3\u65b9\u7a0b\u3002\n\n$$a_i(x_1,y_1)+b_i(x_2,y_2)=(x_i,y_i)$$\n\n$$a_i=\\frac{x_iy_2-x_2y_i}{x_1y_2-x_2y_1},b_i=\\frac{x_1y_i-x_iy_1}{x_1y_2-x_2y_1}$$\n\n\u7136\u540e\u53d1\u73b0\u5206\u6bcd\u6ca1\u5565\u5f71\u54cd\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8f6c\u5316\u4e3a\u6c42\u4e00\u4e2a\u4e8c\u7ef4\u7684\u7b2c$K$\u5927\u3002\n\n\u5e26\u4fee\u4e3b\u5e2d\u6811\u543c\u554a\uff01 $\\rightarrow$    \u5361\u5185\u5b58\uff01\n\n\u6811\u5957\u6811\u543c\u554a\uff01$\\rightarrow$    \u5361\u5e38\u6570\uff01\uff08\u5f53\u7136\u636e\u8bf4\u7ebf\u6bb5\u6811\u5957\u5e73\u8861\u6811\u53ef\u4ee5\u8fc7\uff0c\u53ef\u60dc\u6211\u4eba\u4e11\u5e38\u6570\u5927\u3002\u3002\uff09\n\n\u4e8e\u662f\u53c8\u770b\u4e86\u770b\u9898\u89e3\uff0c\u53d1\u73b0\u53ef\u4ee5\u6574\u4f53\u4e8c\u5206\u3002\n\n$solve(L,R,l,r)$\u8868\u793a$l,r$\u8303\u56f4\u5185\u88ab\u7167\u4eae\u7684\u65f6\u95f4\u4e3a$L,R$\uff0c\u4e8c\u5206\u9012\u5f52\u4e0b\u53bb\u89e3\u51b3\u3002\u5173\u952e\u95ee\u9898\u662f\u6c42\u4e00\u76cf\u706f\u4ec0\u4e48\u65f6\u5019\u88ab\u70b9\u4eae\u3002\u8fd9\u4e2a\u7684\u5173\u952e\u5728\u4e8e\u6c42\u5b83\u5de6\u4e0b\u89d2\u6709\u591a\u5c11\u706f\u3002\u8fd9\u662f\u4e00\u4e2a\u7ecf\u5178\u7684\u4e8c\u7ef4\u6570\u70b9\u7684\u95ee\u9898\uff0c\u7b2c\u4e00\u7ef4\u6392\u5e8f\u7b2c\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u7edf\u8ba1\u5373\u53ef\uff0c\u5de6\u4e0b\u89d2$\\gt k_i$\u6216\u8005\u7f16\u53f7$\\gt mid$\n\u5c31\u5f52\u5230\u5de6\u533a\u95f4\u53bb\uff0c\u53cd\u4e4b\u53bb\u53f3\u533a\u95f4\u3002\n\n\u54e6\u5bf9\uff0c\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\u5149\u7ebf\u53ef\u80fd\u662f\u4e00\u6761\u76f4\u7ebf\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u628a\u5411\u91cf\u7a0d\u5fae\u504f\u79fb\u4e00\u4e2a\u89d2\u5ea6\u3002\n\n\u590d\u6742\u5ea6$O(nlog^2n)$\n\nupd\uff1a\u6ca1\u8fc7\u5ba1\u2026\u2026\u8865\u5145\u4e00\u70b9\u4ee3\u7801\u5b9e\u73b0\u7684\u7ec6\u8282\u5427\u3002\n\n\u9996\u5148\u662f\u5904\u7406\u89d2\u5ea6\uff0c\u8fd9\u4e2a\u5224\u65ad\u4e00\u4e0b\u662f\u5426\u4e3a\u76f4\u7ebf\u7136\u540e\u5904\u7406\u504f\u79fb\u5c31\u597d\u3002\n\n\u7136\u540e\u5c31\u662f\u8f6c\u6362\u5750\u6807\u7cfb\u5e76\u79bb\u6563\u5316\u5750\u6807\uff0c\u4e5f\u4e0d\u5fc5\u591a\u8bf4\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u6574\u4f53\u4e8c\u5206\u3002\u601d\u8def\u5c31\u662f\u8003\u8651\u7f16\u53f7$\\le mid$\u7684\u70b9\u548c\u5de6\u4e0b\u89d2$\\le k_i$\u7684\u70b9\u90fd\u5f52\u4e3a\u5de6\u533a\u95f4\uff0c\u7136\u540e\u628a\u8fd9\u4e2a\u70b9\u52a0\u5230\u6811\u72b6\u6570\u7ec4\u91cc\u53bb\uff0c\u5426\u5219\u5c31\u628a\u8fd9\u4e2a\u70b9\u7684$k_i$\u51cf\u53bb\u5b83\u5de6\u4e0b\u89d2\u6709\u7684\u70b9\u3002\n\n\u7136\u540e\u5c31\u662f\u9012\u5f52\u6c42\u89e3\uff0c\u4f46\u8981\u6ce8\u610f\u5224\u65ad\u8fb9\u754c\u3002\n\n```cpp\n#include<stdio.h>\n#include<algorithm>\n#define it register int\n#define ct const int\n#define il inline\nusing namespace std;\nconst int N=1000005;\nstruct ky{\n\tint x,y,id,k;\n}a[N];\nint ans[N],n,X1,Y1,X2,Y2,tr[N];\ntypedef long long ll;\nll x[N],y[N],tmp[N];\nil bool cmp(const ky p,const ky q){return p.x^q.x?p.x<q.x:p.y<q.y;}\ntemplate <class I>\nil void sp(I &p,I &q){I x=p;p=q,q=x;}\nil void add(it x,ct num){while(x<N) tr[x]+=num,x+=(x&-x);}\nil void que(it x,int &num){num=0;while(x) num+=tr[x],x-=(x&-x);}\nil void solve(ct u,ct v,ct l,ct r){\n\tif(u==v){\n\t\tfor(it i=l;i<=r;++i) ans[a[i].id]=u;\n\t\treturn;\n\t}\n\tct Mid=u+v>>1;it mid=l-1;\n\tstd::sort(a+l,a+r+1,cmp);\n\tfor(it i=l,now;i<=r;++i)\n\t\tque(a[i].y,now),(a[i].id<=Mid||now>=a[i].k)?add(a[i].y,1),++mid,sp(a[mid],a[i]),0:a[i].k-=now;//\u6309\u7167\u4e0a\u6587\u7684\u601d\u8def\u5199\n\tfor(it i=l;i<=mid;++i) add(a[i].y,-1);\n\tif(l<=mid) solve(u,Mid,l,mid);\n\tif(mid<r) solve(Mid+1,v,mid+1,r);\n}\ntemplate <class I>\nil I Max(I p,I q){return p>q?p:q;}\ntemplate <class I>\nil I A(I p){return p<0?-p:p;}\nil void cgd(int &x,int &y){\n\tct mx=Max(A(x),A(y)),d=((ll)2e9+mx-1)/mx;\n\tx*=d,y*=d,++x;\n}\nint main(){ \n\tscanf(\"%d%d%d%d%d\",&n,&X1,&Y1,&X2,&Y2);it i,xx,yy;\n\tif((0ll+X1)*Y2==(0ll+X2)*Y1) cgd(X1,Y1);//\u4e00\u6761\u76f4\u7ebf \u6539\u53d8\u89d2\u5ea6 \u504f\u79fb\u4e00\u4e0b\n\tif((0ll+X1)*Y2<(0ll+X2)*Y1) sp(X1,X2),sp(Y1,Y2);//\u8c03\u6574\u65b9\u5411\n\tfor(i=1;i<=n;++i)\n\t\tscanf(\"%d%d\",&xx,&yy),a[i].id=i,x[i]=(0ll+xx)*Y2-(0ll+X2)*yy,y[i]=(0ll+X1)*yy-(0ll+xx)*Y1;\n\tfor(i=1;i<=n;++i) scanf(\"%d\",&a[i].k);\n\tfor(i=1;i<=n;++i) tmp[i]=x[i];\n\tstd::sort(tmp+1,tmp+1+n),tmp[0]=std::unique(tmp+1,tmp+1+n)-tmp-1;\n\tfor(i=1;i<=n;++i) a[i].x=std::lower_bound(tmp+1,tmp+1+tmp[0],x[i])-tmp;\n\tfor(i=1;i<=n;++i) tmp[i]=y[i];\n\tstd::sort(tmp+1,tmp+1+n),tmp[0]=std::unique(tmp+1,tmp+1+n)-tmp-1;\n\tfor(i=1;i<=n;++i) a[i].y=std::lower_bound(tmp+1,tmp+1+tmp[0],y[i])-tmp; \n    //\u79bb\u6563\u5316\u5750\u6807\n\tsolve(1,n,1,n);//\u6574\u4f53\u4e8c\u5206\n\tfor(i=1;i<=n;++i) printf(\"%d \",ans[i]);\n\treturn 0; \n}\n\n",
        "postTime": 1586958447,
        "uid": 87724,
        "name": "\u58a8\u821e\u7075\u7eaf",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3578 \u3010[POI2014]LAM-Solar lamps\u3011"
    },
    {
        "content": "## Solar lamps\n\n\u4e8c\u7ef4\u5e73\u9762\u4e0a\u6709\u4e00\u5806\u706f\uff0c\u8fd9\u4e9b\u706f\u7684\u7167\u5c04\u8303\u56f4\u5728\u56fa\u5b9a\u7684\u4e24\u4e2a\u5411\u91cf $(x_1,y_1),(x_2,y_2)$ \u4e4b\u95f4\n\n\u4e00\u76cf\u706f $i$ \u88ab\u70b9\u4eae\u5f53\u4e14\u4ec5\u5f53\u5b83\u88ab\u901a\u7535\u6216\u88ab\u81f3\u5c11 $k_i$ \u76cf\u706f\u7167\u4eae\u3002\n\n\u95ee\u6bcf\u76cf\u706f\u88ab\u7167\u4eae\u7684\u6700\u77ed\u65f6\u95f4\u3002\n\n\u4e5f\u662f\u5f88\u663e\u7136\u7684\u4e00\u4e2a\u4e8c\u5206\u3002\n\n\u4f46\u662f\u8fd9\u4e2a\u5e73\u9762\u51e0\u4f55\u5f88\u96be\u5904\u7406\u554a\u3002\n\n\u7136\u540e\u5c31\u53bb\u770b\u4e86\u9898\u89e3\u3002\n\n\u7136\u540e\u624d\u77e5\u9053\u8981\u628a\u5750\u6807\u7cfb\u8f6c\u4e00\u4e0b\u53d8\u6210\u6807\u51c6\u7684\u4e8c\u7ef4\u5e73\u9762\u76f4\u89d2\u5750\u6807\u7cfb\u3002\n\u8fd9\u4e2a\u5c31\u6709\u70b9\u4e0d\u600e\u4e48\u65b9\u4fbf\u4e86\uff0c\u4f46\u662f\u5176\u5b9e\u53ef\u4ee5\u76f4\u63a5\u628a\u7ed9\u5b9a\u5411\u91cf\u770b\u6210\u65b9\u5411\u5411\u91cf\uff0c\u4f5c\u4e3a\u57fa\u5e95\uff0c\u76f4\u63a5\u4e58\u8fc7\u53bb\uff0c\u5c31\u8868\u793a\u4e86\u5411\u91cf\u5750\u6807\u7cfb\u7684\u70b9\u3002\n$a_i(x1,y1)+b_i(x2,y2)=(x_i,y_i);$\n\n$a_ix1+b_ix2=x_i;$\n\n$a_iy1+b_iy2=y_i$\n\n$a_i=\\frac{(x_iy2-y_ix2)}{(x1y2-y1x2)}$\n\n$b_i=\\frac{(x_iy1-y_ix1)}{(x1y2-y1x2)}$\n\n\n\n\n\u7531\u4e8e\u8fd9\u4e2a\u9898\u76ee\u5728\u8ddd\u79bb\u7b49\u6bd4\u53d8\u5316\u7684\u60c5\u51b5\u4e0b\u5e76\u6ca1\u6709\u5dee\u522b\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u628a\u5206\u6bcd\u5ffd\u7565\u3002\n\n\u90a3\u4e48\u5c31\u628a\u95ee\u9898\u53d8\u6210\u5728\u4e00\u4e2a\u4e8c\u7ef4\u5e73\u9762\u5185\u6c42\u4e00\u4e2a\u77e9\u9635\u91cc\u9762\u7684\u7b2ck\u4e2a\u88ab\u70b9\u4eae\u7684\u70b9\u3002\n\n\u8d77\u5148\u770b\u5230\u4e86\u4e0d\u5c0f\u5fc3\u70b9\u5f00\u6765\u7684 Tag \u53d1\u73b0\u6811\u5957\u6811\u6211\u8fd8\u662f\u4e0d\u4f1a\u5199\u554a\u3002\n\n\u4f46\u662f\u53d1\u73b0\u6240\u6709\u4eba\u90fd\u5199\u4e86\u6574\u4f53\u4e8c\u5206\uff0c\u90a3\u4e48\u5c31\u5199\u6574\u4f53\u4e8c\u5206\u5427\u3002\n\n\u8bdd\u8bf4\u8fd9\u9898\u5982\u679c\u6574\u4f53\u4e8c\u5206\u7684\u8bdd\u771f\u7684\u662f\u5341\u5206\u597d\u5199\n\u5c31\u662f\u7528\u6392\u5e8f\u53bb\u6389\u4e00\u7ef4\uff0c\u7528BIT\u7ef4\u62a4\u53e6\u4e00\u7ef4\uff0c\u90a3\u4e48\u5c31\u7279\u522b\u4f18\u79c0\u4e86\u3002\n\n\u590d\u6742\u5ea6 $\\Theta(n*log^2)$\n```c\n#include<bits/stdc++.h>\n#define ll long long\n#define pb push_back\n#define db double\n#define x1 mo\n#define y1 th\n#define x2 er \n#define y2 fu\n#define dot cker\nusing namespace std;\nconst int INF=2e9;\nconst int N=2e5+10;\nint n;\nvoid rot(ll &x,ll &y){\n\tll mx=max(abs(x),abs(y));\n\tmx=(mx+INF-1)/mx;\n\tx*=mx;\n\ty*=mx;\n\tx++;\n}\nstruct node{\n\tll x,y;\n\tint id;\n\t\n\t//first: x second: y \n\tbool operator <(const node &a)const{\n\t\tif(x!=a.x) return x<a.x;\n\t\treturn y<a.y;\t\n\t}\n};\nnode A[N],Left[N],Right[N];\nint k[N];//need\nint ori[N],ans[N];\nll x1,y1,x2,y2;\nvector<int>ve;\nint bit[N<<1];//the compressed indice of nodes might be twice as large as n\n\n//BIT\nvoid Add(int x,int a){\n\twhile(x<=n*2){\n\t\tbit[x]+=a;\n\t\tx+=x&-x;\n\t}\n}\nint Query(int x){\n\tint cnt=0;\n\twhile(x){\n\t\tcnt+=bit[x];\n\t\tx-=x&-x;\n\t}\n\treturn cnt;\n}\nvoid Solve(int L,int R,int l,int r){\n\tif(L>R) return ;\n\t\n\tif(L==R){\n\t\tfor(int i=l;i<=r;i++){\n\t\t\tans[A[i].id]=L;\n\t\t}\n\t\treturn ;\n\t}\n\t\n\tint mid=(L+R)>>1;\n\tsort(A+l,A+r+1);\n\t\n\t//clear\n\tve.clear();\n\tfor(int i=l;i<=r;i++) ori[i]=k[A[i].id];\n\t\n\t//scan\n\tfor(int i=l;i<=r;i++){\n\t\tint x=A[i].id,to=Query(A[i].y);\n\t\tk[x]-=to;\n\t\tif(k[x]<=0||x<=mid){\n\t\t\tAdd(A[i].y,1);\n\t\t\tve.pb(i);\n\t\t}\n\t}\n\t\n\t//recover\n\tint p=0,q=0;\n\tfor(int i=l;i<=r;i++){\n\t\tint x=A[i].id;\n\t\tif(k[x]>0&&x>mid){\n\t\t\tRight[++q]=A[i];\n\t\t}\n\t\telse{\n\t\t\tLeft[++p]=A[i];\n\t\t\tk[x]=ori[i];\n\t\t}\n\t}\n\tfor(int i=0;i<ve.size();i++) Add(A[ve[i]].y,-1);\n\t\n\tint pt=l;\n\tfor(int i=1;i<=p;i++) A[pt++]=Left[i];\n\tfor(int i=1;i<=q;i++) A[pt++]=Right[i];\n\t\n\tSolve(L,mid,l,l+p-1);\n\tSolve(mid+1,R,l+p,r);\n}\n\nvector<ll>xs;\nint main(){\n//\tfreopen(\"lamps.in\",\"r\",stdin);\n//\tfreopen(\"lamps.out\",\"w\",stdout);\n\t\n\tscanf(\"%d\",&n);\n\tscanf(\"%lld %lld %lld %lld\",&x1,&y1,&x2,&y2);\n\t\n\t//special condition\n\tif(x1*y2==x2*y1) rot(x1,y1);\n\tif(1ll*x1*y2<1ll*x2*y1)swap(x1,x2),swap(y1,y2);\n\t//redefination\n\tfor(int i=1;i<=n;i++){\n\t\tint x,y;\n\t\tscanf(\"%d %d\",&x,&y);\n\t\tA[i].x=(1ll*x*y2-y*x2);\n\t\tA[i].y=(1ll*x1*y-x*y1);\n\t\txs.pb(A[i].x);\n\t\txs.pb(A[i].y);\n\t}\n\t\n\t//compress\n\tsort(xs.begin(),xs.end());\n\txs.erase(unique(xs.begin(),xs.end()),xs.end());\n\tfor(int i=1;i<=n;i++){\n\t\tA[i].x=lower_bound(xs.begin(),xs.end(),A[i].x)-xs.begin()+1;\n\t\tA[i].y=lower_bound(xs.begin(),xs.end(),A[i].y)-xs.begin()+1;\n\t\tA[i].id=i;\n\t}\n\t\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&k[i]);\n\t\n\t//binary search\n\tSolve(1,n,1,n);\n\t\n\tfor(int i=1;i<=n;i++){\n\t\tprintf(\"%d\",ans[i]);\n\t\tif(i!=n) printf(\" \");\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1538055884,
        "uid": 71577,
        "name": "renhao",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3578 \u3010[POI2014]LAM-Solar lamps\u3011"
    }
]