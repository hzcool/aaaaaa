[
    {
        "content": "\n\u5b8c\u4e86...\u6ca1\u9ad8\u4e2d\u8bfb\u4e86QwQ\uff0c\u6211\u8981\u53bb\u6253\u5de5\u9001\u5feb\u9012\uff01\uff01\uff01QwQ\n\n\n### \u9898\u89e3\n\n\u8fd9\u9898\u5176\u5b9e\u8fd8\u662f\u633a\u597d\u73a9\u7684\u3002\n\n\u9996\u5148\u968f\u4fbf\u94a6\u5b9a\u4e00\u4e2a\u70b9\uff0c\u4e34\u65f6\u4f5c\u4e3a\u5feb\u9012\u4e2d\u5fc3 \u3002\n\n\u7136\u540e\u53ef\u4ee5$O(n)$\u8ba1\u7b97\u51fa\u6bcf\u4e00\u7ec4\u70b9\u5bf9\u5230\u5feb\u9012\u4e2d\u5fc3\u7684\u8ddd\u79bb\u548c\u3002\u8bbe\u70b9\u5bf9\u5230\u5feb\u9012\u4e2d\u5fc3\u6700\u5927\u8ddd\u79bb\u548c\u4e3a$Max$\uff0c\u53ef\u80fd\u6709\u591a\u4e2a\u70b9\u5bf9\u5230\u5feb\u9012\u4e2d\u5fc3\u7684\u8ddd\u79bb\u548c\u90fd\u662f$Max$\u90a3\u4e48\u5c31\u628a\u5b83\u4eec\u90fd\u5b58\u4e0b\u6765\u3002\n\n\u5982\u679c\u5f53\u524d\u7684\u5feb\u9012\u4e2d\u5fc3\u5728\u4efb\u610f\u4e00\u7ec4\u8ddd\u79bb\u6700\u5927\u7684\u70b9\u5bf9\u4e4b\u95f4\u6700\u77ed\u8def\u5f84\u4e0a\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u662f$Max$\u4e0d\u53ef\u80fd\u518d\u5c0f\u4e86\u3002\n\n\u5982\u679c\u6709\u4efb\u610f\u4e24\u7ec4\u8ddd\u79bb\u6700\u5927\u7684\u70b9\u5bf9\uff0c\u4e00\u7ec4\u5728\u5f53\u524d\u5feb\u9012\u4e2d\u5fc3\u7684\u4e00\u68f5\u5b50\u6811\u91cc\uff0c\u53e6\u4e00\u7ec4\u5728\u53e6\u4e00\u68f5\u5b50\u6811\u91cc\uff0c\u90a3\u4e48\u7b54\u6848\u540c\u6837\u4e5f\u65e0\u6cd5\u66f4\u5c0f\u3002\n\n\u5426\u5219\u7b54\u6848\u6700\u4f18\u65f6\u7684\u5feb\u9012\u4e2d\u5fc3\u5c31\u6709\u53ef\u80fd\u5728\u5f53\u524d\u552f\u4e00\u4e00\u68f5\u6709\u70b9\u5bf9\u7684\u5b50\u6811\u4e2d\uff0c\u90a3\u4e48\u5c31\u53d6\u8fd9\u68f5\u5b50\u6811\u7684\u91cd\u5fc3\u4f5c\u4e3a\u4e34\u65f6\u5feb\u9012\u4e2d\u5fc3\uff0c\u7136\u540e\u9012\u5f52\u3002\u7531\u4e8e\u6bcf\u6b21\u53d6\u7684\u90fd\u662f\u91cd\u5fc3\uff0c\u6240\u4ee5\u53ea\u4f1a\u9012\u5f52$\\log n$\u5c42\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n\\log n)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cstdlib>\nusing namespace std;\nconst int maxn=100005;\nint n,m,u[maxn],v[maxn],tot,lnk[maxn],son[maxn*2],w[maxn*2],nxt[maxn*2],sum,siz[maxn],maxp[maxn],rt,sub[maxn],dist[maxn],que[maxn],ans=1000000000;bool vis[maxn];\ninline int read()\n{\n\tint ret=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-f;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){ret=ret*10+ch-'0';ch=getchar();}\n\treturn ret*f;\n}\ninline void add_e(int x,int y,int z){tot++;son[tot]=y;w[tot]=z;nxt[tot]=lnk[x];lnk[x]=tot;}\nvoid GetRoot(int now,int fa)     //\u627e\u91cd\u5fc3\n{\n\tsiz[now]=1;maxp[now]=0;\n\tfor(int i=lnk[now];i;i=nxt[i])\n\t{\n\t\tif(vis[son[i]]||son[i]==fa) continue;\n\t\tGetRoot(son[i],now);siz[now]+=siz[son[i]];\n\t\tif(siz[son[i]]>maxp[now]) maxp[now]=siz[son[i]];\n\t}\n\tif(sum-siz[now]>maxp[now]) maxp[now]=sum-siz[now];\n\tif(maxp[now]<maxp[rt]) rt=now;\n}\nvoid GetDist(int now,int fa,int st)\n{\n\tsub[now]=st;\n\tfor(int i=lnk[now];i;i=nxt[i])\n\t\tif(son[i]!=fa)\n\t\t\t{dist[son[i]]=dist[now]+w[i];GetDist(son[i],now,st);}\n}\ninline void Print(){printf(\"%d\\n\",ans);exit(0);}   //\u8f93\u51fa\u7b54\u6848\nvoid Solve(int now)\n{\n\tif(vis[now]) Print();\n\tvis[now]=true;dist[now]=0;\n\tfor(int i=lnk[now];i;i=nxt[i])\n\t\t{dist[son[i]]=w[i];GetDist(son[i],now,son[i]);} //\u5148\u66b4\u529b\u8ba1\u7b97\u8ddd\u79bb\n\tint Max=0,len=0,las=0;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tif(dist[u[i]]+dist[v[i]]>Max){len=1;que[len]=i;Max=dist[u[i]]+dist[v[i]];}\n\t\telse if(dist[u[i]]+dist[v[i]]==Max) que[++len]=i; //\u5237\u6700\u5927\u8ddd\u79bb\u548c\n\t}\n\tif(Max<ans) ans=Max;\n\tfor(int i=1;i<=len;i++)\n\t{\n\t\tif(sub[u[que[i]]]!=sub[v[que[i]]]) Print();   //\u5206\u60c5\u51b5\u8003\u8651\u7b54\u6848\n\t\tif(!las) las=sub[u[que[i]]];\n\t\tif(sub[u[que[i]]]!=las) Print(); \n\t}\n\trt=0;sum=siz[las];GetRoot(las,0);Solve(rt);    //\u9012\u5f52\u89e3\u51b3\n}\nint main()\n{\n\tn=read();m=read();\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint a=read(),b=read(),c=read();\n\t\tadd_e(a,b,c);add_e(b,a,c);\n\t}\n\tfor(int i=1;i<=m;i++){u[i]=read();v[i]=read();}\n\tsum=maxp[0]=n;GetRoot(1,0);Solve(rt);\n\tPrint();\n\treturn 0;\n}\n```\n\n",
        "postTime": 1551777208,
        "uid": 42392,
        "name": "\u5f90\u81f4\u8fdc",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4886 \u3010\u5feb\u9012\u5458\u3011"
    },
    {
        "content": "~~\u7b2c\u4e00\u676f\u7fb9~~\n\n[\u535a\u5ba2](https://www.cnblogs.com/Qihoo360/p/9675522.html)\n\n\u8fd9\u9898\u56e0\u4e3a\u4e00\u4e9b\u5c0f\u7ec6\u8282\u8fd8\u662f$debug$\u4e86\u5f88\u4e45\u3002\u3002\u3002~~\u4e0d\u8fc7\u6211\u7b2c\u4e00\u6b21\u7528\u811a\u672c\u5bf9\u62cd\uff0c\u4e0d\u4e8f\u3002~~\n\n\u5148\u968f\u4fbf\u627e\u4e00\u4e2a\u70b9\u4f5c\u4e3a\u6839\uff0c\u7b97\u51fa\u7b54\u6848\uff0c\u5373\u6240\u6709\u70b9\u5bf9\u5230\u8fd9\u4e2a\u70b9\u7684\u8ddd\u79bb\u548c\u7684\u6700\u5927\u503c\uff0c\u5e76\u8bb0\u5f55**\u6240\u6709**\u8ddd\u79bb\u6700\u5927\u7684\u70b9\u5bf9\u3002\u5982\u679c\u8fd9\u4e2a\u70b9\u5728\u4efb\u610f\u4e00\u4e2a\u8ddd\u79bb\u6700\u5927\u7684\u70b9\u5bf9\u4e4b\u95f4\u7684\u8def\u5f84\u4e0a\uff0c\u90a3\u4e48\u7b54\u6848\u663e\u7136\u4e0d\u80fd\u518d\u4f18\u4e86\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u70b9\u5bf9\u7684\u7b54\u6848\u662f\u4e0d\u80fd\u51cf\u5c0f\u4e86\u7684\u3002\u5982\u679c\u6709\u4e24\u4e2a\u8ddd\u79bb\u6700\u5927\u7684\u70b9\u5bf9\u4e0d\u5728\u6839\u7684\u540c\u4e00\u5b50\u6811\u4e2d\uff0c\u7b54\u6848\u4e5f\u662f\u663e\u7136\u4e0d\u80fd\u518d\u4f18\u4e86\u7684\uff0c\u56e0\u4e3a\u4e00\u4e2a\u70b9\u5bf9\u7b54\u6848\u51cf\u5c0f\u7684\u540c\u65f6\uff0c\u53e6\u4e00\u4e2a\u4f1a\u589e\u5927\u3002\u53ea\u6709\u5f53\u6240\u6709\u8ddd\u79bb\u6700\u5927\u7684\u70b9\u5bf9\u5728\u6839\u7684\u540c\u4e00\u5b50\u6811\u4e2d\uff0c\u8fd9\u65f6\u66f4\u4f18\u7b54\u6848**\u53ef\u80fd**\u5728\u8fd9\u4e2a\u5b50\u6811\u91cc\uff0c\u5411\u8fd9\u4e2a\u5b50\u6811\u9012\u5f52\u5904\u7406\u5c31\u884c\u4e86\u3002\u4e3a\u4ec0\u4e48\u8bf4**\u53ef\u80fd**\uff1f\u56e0\u4e3a\u5f80\u8fd9\u4e2a\u5b50\u6811\u8d70\u7684\u540c\u65f6\u53ef\u80fd\u4f1a\u5b58\u5728\u5728\u53e6\u4e00\u4e2a\u5b50\u6811\u4e2d\u539f\u672c\u4e0d\u662f\u8ddd\u79bb\u6700\u5927\u7684\u70b9\u5bf9\u53d8\u4e3a\u8ddd\u79bb\u6700\u5927\u7684\u70b9\u5bf9\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u4e00\u76f4\u5bf9\u7b54\u6848\u53d6\u6700\u5c0f\u503c\u3002\u76f4\u63a5\u8d70\u6700\u591a\u4f1a\u8d70$n$\u6b21\uff0c\u800c\u5982\u679c\u6211\u4eec\u6bcf\u6b21\u90fd\u8d70\u5b50\u6811\u7684\u91cd\u5fc3\uff0c\u6700\u591a\u8d70$logN$\u6b21\uff0c\u6240\u4ee5\u603b\u65f6\u95f4\u590d\u6742\u5ea6$O(m\\log n)$\u3002\n\n\u73b0\u5728\u8bb2\u8bb2\u5177\u4f53\u600e\u4e48\u5b9e\u73b0\uff0c\u4e3b\u8981\u5c31\u96be\u5728\u600e\u4e48\u5224\u65ad\u6839\u5728\u4e0d\u5728\u4e24\u4e2a\u70b9\u4e4b\u95f4\u7684\u8def\u5f84\u4e0a\u3002\u6c42$LCA$\u662f\u6700\u7b80\u5355\u7c97\u66b4\u7684\u65b9\u6cd5\uff0c\u4f46\u65f6\u95f4\u590d\u6742\u5ea6\u8981\u591a\u4e00\u4e2a$log$\uff0c\u5176\u5b9e\u7c7b\u4f3c\u4e8e\u70b9\u5206\u6cbb\u91cc\u7684\u7edf\u8ba1\uff0c\u53ea\u9700\u8981\u770b\u8fd9\u4e2a\u70b9\u5bf9\u7684\u4e24\u4e2a\u70b9\u5728\u4e0d\u5728\u540c\u4e00\u5b50\u6811\u91cc\u5c31\u884c\u4e86\uff0c\u82e5\u5728\uff0c\u5219\u8def\u5f84\u4e0d\u7ecf\u8fc7\u6839\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002\n\n\u7136\u540e\uff0c\u770b$Code$\u5427\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#define INF 2147483647\nusing namespace std;\ninline int read(){\n\tint s = 0, w = 1;\n\tchar ch = getchar();\n\twhile(ch < '0' || ch > '9') { if(ch == '-') w = -1; ch = getchar(); }\n\twhile(ch >= '0' && ch <= '9') { s = s * 10 + ch - '0'; ch = getchar(); }\n\treturn s * w;\n}\nconst int MAXN = 100010;\nstruct Edge{\n\tint next, to, dis;\n}e[MAXN << 1];\nint head[MAXN], num, x[MAXN], y[MAXN], vis[MAXN], maxson[MAXN], p[MAXN], q[MAXN], belong[MAXN], deep[MAXN], size[MAXN];\nint n, m, root, Max, ans = 2147483647;\ninline void Add(int from, int to, int dis){\n\te[++num].to = to;\n\te[num].dis = dis;\n\te[num].next = head[from];\n\thead[from] = num;\n}\nvoid getRoot(int u,int fa,int ALL){   //\u627e\u91cd\u5fc3\n    size[u] = 1; maxson[u] = 0;\n    for(int i = head[u]; i; i = e[i].next)\n       if(e[i].to != fa && !vis[e[i].to]){\n \t     getRoot(e[i].to, u, ALL);\n\t     size[u] += size[e[i].to];\n         maxson[u] = max(maxson[u], size[e[i].to]);\n       }\n    maxson[u] = max(maxson[u], ALL - size[u]);\n    if(maxson[u] < Max) root = u, Max = maxson[u];\n}\nvoid dfs(int u, int fa, int dep, int rt){ //\u7b97\u51fa\u6bcf\u4e2a\u70b9\u7684\u6df1\u5ea6\uff0c\u5e76\u6807\u8bb0\u5c5e\u4e8e\u6839\u7684\u54ea\u68f5\u5b50\u6811\n    belong[u] = rt;\n    deep[u] = dep;\n    for(int i = head[u]; i; i = e[i].next)\n       if(e[i].to != fa)\n         dfs(e[i].to, u, dep + e[i].dis, rt);\n}\nvoid Solve(int u){\n    if(vis[u]){\n      printf(\"%d\\n\", ans);\n      exit(0);\n    }      \n    vis[u] = 1;\n    for(int i = head[u]; i; i = e[i].next)\n       dfs(e[i].to, u, e[i].dis, e[i].to);\n    deep[u] = 0;\n    Max = 0; p[0] = 0;\n    int last = 0;\n    for(int i = 1; i <= m; ++i)    //\u627e\u51fa\u6240\u6709\u8ddd\u79bb\u6700\u5927\u7684\u70b9\u5bf9\u5e76\u6c42\u51fa\u7b54\u6848\n       if(deep[x[i]] + deep[y[i]] > Max) \n         Max = deep[x[i]] + deep[y[i]], p[p[0] = 1] = i;\n       else if(deep[x[i]] + deep[y[i]] == Max)\n         p[++p[0]] = i;\n    ans = min(ans, Max);   //\u66f4\u65b0\u7b54\u6848\n    for(int i = 1; i <= p[0]; ++i){\n       if(belong[x[p[i]]] != belong[y[p[i]]]){  //\u5982\u679c\u6709\u4e00\u4e2a\u70b9\u5bf9\u4e4b\u95f4\u7684\u8def\u5f84\u7ecf\u8fc7\u6839\uff0c\u5f53\u524d\u7b54\u6848\u4e00\u5b9a\u662f\u6700\u4f18\u7684\n         printf(\"%d\\n\", ans);\n         exit(0);\n       }\n       else \n         if(!last) last = belong[x[p[i]]];\n         else if(last != belong[x[p[i]]]){  //\u5982\u679c\u4e24\u4e2a\u70b9\u5bf9\u4e0d\u5728\u540c\u4e00\u5b50\u6811\u91cc\uff0c\u5f53\u524d\u7b54\u6848\u4e5f\u4e00\u5b9a\u6700\u4f18\n           printf(\"%d\\n\", ans);\n           exit(0);\n         }\n    }\n    Max = 9996666;\n    getRoot(last, u, size[last]);  //\u627e\u5b50\u6811\u7684\u91cd\u5fc3\n    Solve(root);   //\u9012\u5f52\u5904\u7406\n}\nint a, b, c;\nint main(){\n    n = read(); m = read();\n    for(int i = 2; i <= n; ++i){\n       a = read(); b = read(); c = read(); \n       Add(a, b, c); Add(b, a, c);\n    }\n    for(int i = 1; i <= m; ++i){\n       x[i] = read(); y[i] = read();\n    }\n    Max = 9996666; getRoot(1, 0, n);\n    Solve(root);\n    return 0;\n}\n\n```",
        "postTime": 1537347692,
        "uid": 61834,
        "name": "Huami360",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4886 \u3010\u5feb\u9012\u5458\u3011"
    },
    {
        "content": "## [\u9898\u89e3] P4886 \u5feb\u9012\u5458\n\n> [\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P4886)\n\n### \u524d\u7f00\u90e8\u5206\n\n**\u524d\u7f00\u77e5\u8bc6\uff1a\u70b9\u5206\u6cbb\u3002**\n\n\u5bf9\u4e8e\u6b64\u9898\u800c\u8a00\uff0c\u4e0e\u5176\u8bf4\u662f\u70b9\u5206\u6cbb\u7684\u9898\uff0c\u4e0d\u5982\u8bf4\u662f\u5229\u7528\u4e86\u70b9\u5206\u6cbb\u7684\u9012\u5f52\u601d\u60f3\uff0c\u56e0\u6b64\u5982\u679c\u4f60\u6ca1\u6709\u5b66\u8fc7\u70b9\u5206\u6cbb\u4e5f\u6ca1\u95ee\u9898\u3002\n\n### \u9898\u89e3\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.luogu.com.cn/blog/AG-Liangsheng/solution-p4886)\n\n- \u9996\u5148\u662f\u6811\u4e0a\u8def\u5f84\u95ee\u9898\uff0c\u5f88\u81ea\u7136\u7684\u60f3\u5230\u70b9\u5206\u6cbb\u3002\n\n- \u9898\u610f\u4e0d\u518d\u8d58\u8ff0\uff0c\u4f46\u662f\u672c\u9898\u7684\u6700\u9ad8\u4ef7\u503c\u5c31\u5728\u4e8e**\u601d\u8003\u5982\u4f55\u624d\u80fd\u53d6\u5f97\u7b54\u6848\u6700\u4f18\u3002**\n\n**\u7b54\u6848\u6700\u4f18\u7684\u60c5\u51b5\uff08\u4e0b\u9762\u7684\u201c\u70b9\u5bf9\u201d\u90fd\u662f\u5bf9\u4e8e\u8ddd\u79bb\u6700\u957f\u7684\u70b9\u5bf9\u800c\u8a00\uff09**\n\n- \u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u5b58\u5728\u4e00\u7ec4\u70b9\u5bf9\u4f7f\u5f97\u4ed6\u4eec\u4e24\u4e2a\u4e4b\u95f4\u7684\u6700\u77ed\u8def\u5f84**\u7ecf\u8fc7\u5f53\u524d\u7684\u6839\u8282\u70b9**\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/wdgyc9q4.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n\n- \u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c**\u81f3\u5c11\u5b58\u5728\u4e24\u7ec4**\u70b9\u5bf9\u5206\u522b\u5206\u5e03\u5728\u4e0d\u540c\u7684\u70b9\u5bf9\u5185\u3002$e.g.$\uff0c$(u1,v1)\\in son1,(u2,v2)\\in son2$\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ryzv5su0.png?x-oss-process=image/resize,m_lfit,h_170,w_225)\n\n\u5982\u679c\u51fa\u73b0\u4e86\u4ee5\u4e0a\u4e24\u79cd\u60c5\u51b5\uff0c\u76f4\u63a5\u8f93\u51fa\u5f53\u524d\u7684\u6700\u5c0f $ans$ \u5373\u53ef\u3002\n\n\u5426\u5219\u9012\u5f52\u8fdb\u5165\u6700\u5927\u7684\u70b9\u5bf9\u6240\u5728\u7684\u90a3\u68f5\u5b50\u6811\u3002\n\n### \u7ec6\u8282\u90e8\u5206\n\n\u5bf9\u4e8e\u8fd9\u9053\u9898\u6765\u8bf4\uff0c\u9996\u5148\u8981\u660e\u767d\u5b83\u4e0d\u662f\u6bcf\u4e00\u68f5\u5b50\u6811\u90fd\u8981\u9012\u5f52\u7684\u3002\n\n\u6240\u4ee5\u5c31\u4e0d\u6392\u9664\u4e0b\u9762\u8fd9\u4e24\u79cd\u60c5\u51b5\uff1a\n\n- \u9012\u5f52\u5b50\u6811\u7684\u65f6\u5019\uff0c\u627e\u5230\u7684 $rt$ \u53ef\u80fd\u5df2\u7ecf\u88ab solve \u8fc7\u4e86\u3002\n\n- \u6709\u53ef\u80fd\u5b58\u5728\u4e24\u79cd\u60c5\u51b5\uff0c\u4f7f\u5f97\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4e92\u76f8\u8f6c\u6362\uff08\u4e92\u76f8\u9012\u5f52\uff09\u3002\n\n\u4ec0\u4e48\u610f\u601d\u5462\uff1f\n\n\u6bd4\u5982\u73b0\u5728\u6709\u4e24\u4e2a\u8282\u70b9 $rt1,rt2$\u3002\n\n\u4ee5\u8fd9\u4e24\u4e2a\u8282\u70b9\u4e3a\u6839\u65f6\uff0c\u7b97\u6cd5\u90fd\u8868\u73b0\u51fa\u4e86**\u9012\u5f52\u5411\u53e6\u4e00\u65b9**\u7684\u8d8b\u52bf\uff0c\u6240\u4ee5\u4f1a\u5bfc\u81f4 TLE\u3002\n\n\u8fd9\u5c31\u662f\u4e0b\u9762\u4ee3\u7801\u6240\u8bf4\u7684\u7ec6\u8282\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\ntemplate <typename T>\ninline T read(){\n\tT x=0;char ch=getchar();bool fl=false;\n\twhile(!isdigit(ch)){if(ch=='-')fl=true;ch=getchar();}\n\twhile(isdigit(ch)){\n\t\tx=(x<<3)+(x<<1)+(ch^48);ch=getchar();\n\t}\n\treturn fl?-x:x;\n}\nconst int maxn = 1e5 + 100;\nstruct edge{\n\tint to,nxt,w;\n}e[maxn<<1];\nint head[maxn],cnt=0;\ninline void link(int u,int v,int w){\n\te[++cnt].to=v;e[cnt].nxt=head[u];head[u]=cnt;e[cnt].w=w;\n}\n#define mp make_pair\nconst int INF = 0x3f3f3f3f;\nint n,m,S,rt=0;\nint mx[maxn],sz[maxn],de[maxn];\nbool vis[maxn];\npair<int,int> p[maxn];\nvoid find_rt(int u,int fa){\n\tsz[u]=1;mx[u]=0;\n\tfor(int i=head[u];i;i=e[i].nxt){\n\t\tint v=e[i].to;\n\t\tif(v==fa || vis[v])continue;\n\t\tfind_rt(v,u);\n\t\tsz[u]+=sz[v];\n\t\tmx[u]=max(mx[u],sz[v]);\n\t}\n\tmx[u]=max(mx[u],S-sz[u]);\n\tif(mx[rt]>mx[u])rt=u;\n}\nint col[maxn];\nvoid dfs(int u,int fa,int c){\n\tcol[u]=c;\n\tfor(int i=head[u];i;i=e[i].nxt){\n\t\tint v=e[i].to;\n\t\tif(v==fa)continue;\n\t\tde[v]=de[u]+e[i].w;\n\t\tdfs(v,u,c);\n\t}\n}\nint ans=INF;\n#include <vector>\n#define Pair pair<int,int>\nint s[maxn];\nvoid solve(int u){\n\tif(vis[u]){\n\t\tprintf(\"%d\\n\",ans);exit(0);\n\t}//\u7ec6\u8282\n\tvis[u]=true;de[u]=0;\n\tfor(int i=head[u];i;i=e[i].nxt){\n\t\tint v=e[i].to;\n\t\tde[v]=e[i].w;\n\t\tdfs(v,u,v);\n\t}\n\tint la=0,maxx=0;\n\ts[0]=0;\n\tfor(int i=1;i<=m;i++){\n\t\tif(de[p[i].first]+de[p[i].second]>maxx){\n\t\t\ts[0]=0;s[++s[0]]=i;maxx=de[p[i].first]+de[p[i].second];\n\t\t}\n\t\telse if(de[p[i].first]+de[p[i].second]==maxx){\n\t\t\ts[++s[0]]=i;\n\t\t}\n\t}\n\tans=min(ans,maxx);\n\tfor(int i=1;i<=s[0];i++){\n\t\tif(col[p[s[i]].first]!=col[p[s[i]].second]){\n\t\t\tprintf(\"%d\\n\",ans);exit(0);\n\t\t}\n\t\telse if(!la)la=col[p[s[i]].first];\n\t\telse if(la!=col[p[s[i]].first]){\n\t\t\tprintf(\"%d\\n\",ans);exit(0);\n\t\t}\n\t}\n\tmx[rt=0]=INF;S=sz[la];\n\tfind_rt(la,0);\n\tsolve(rt);\n}\n#define read() read<int>()\nint main(){\n\tn=read();m=read();\n\tfor(int i=1,u,v,w;i<n;i++){\n\t\tu=read();v=read();w=read();\n\t\tlink(u,v,w);link(v,u,w);\n\t}\n\tfor(int i=1;i<=m;i++){\n\t\tint u=read(),v=read();\n\t\tp[i]=mp(u,v);\n\t}\n\tS=n;mx[rt=0]=INF;\n\tfind_rt(1,0);\n\tsolve(rt);\n\treturn 0;\n}\n```",
        "postTime": 1622023533,
        "uid": 375110,
        "name": "\u00b6\u51c9\u7b19",
        "ccfLevel": 6,
        "title": "[\u9898\u89e3] P4886 \u5feb\u9012\u5458"
    },
    {
        "content": "\u8003\u8651\u4e00\u4e2a\u8282\u70b9\u6210\u4e3a\u6839\u8282\u70b9\u540e\uff0c\u5982\u4f55\u5224\u65ad\u5176\u4e3a\u6700\u4f18\u7684\u3002\n\n\u82e5\u6700\u957f\u8ddd\u79bb\u7684\u8def\u5f84\u4e2d\u7684\u4efb\u610f\u4e00\u6761\u6ee1\u8db3\u4e24\u4e2a\u7aef\u70b9\u5728\u5f53\u524d\u6839\u8282\u70b9\u7684\u4e24\u4e2a\u4e0d\u540c\u7684\u513f\u5b50\u4e2d\uff0c\u5219\u5f53\u524d\u6839\u8282\u70b9\u4e3a\u6700\u4f18\u7684\u3002\u56e0\u4e3a\u82e5\u5c06\u5176\u8c03\u6574\u4e3a\u4e0d\u5728\u8be5\u8def\u5f84\u4e0a\u7684\u70b9\uff0c\u6700\u957f\u8def\u5f84\u7684\u503c\u4f1a\u53d8\u5927\uff0c\u5c06\u5176\u8c03\u6574\u4e3a\u8be5\u8def\u5f84\u4e0a\u522b\u7684\u70b9\uff0c\u53ef\u80fd\u4f1a\u4ea7\u751f\u66f4\u957f\u7684\u8def\u5f84\uff0c\u56e0\u6b64\u8be5\u6839\u8282\u70b9\u4e3a\u6700\u4f18\u7684\u3002\n\n\u82e5\u5b58\u5728\u4e24\u6761\u6700\u957f\u8ddd\u79bb\u7684\u8def\u5f84\u7684\u7aef\u70b9\u4e0d\u6765\u81ea\u540c\u4e00\u4e2a\u513f\u5b50\uff0c\u5219\u5f53\u524d\u6839\u8282\u70b9\u4e3a\u6700\u4f18\u7684\u3002\u8fd9\u4e5f\u662f\u53ef\u4ee5\u7528\u8c03\u6574\u6765\u8bc1\u660e\u7684\u3002\n\n\u56e0\u6b64\u53ef\u4ee5\u8003\u8651\u70b9\u5206\u6cbb\uff0c\u5f53\u524d\u6839\u8282\u70b9\u82e5\u662f\u6700\u4f18\u7684\u5c31\u76f4\u63a5\u7ed3\u675f\u5206\u6cbb\uff0c\u5426\u5219\u5c31\u5230\u6700\u957f\u8ddd\u79bb\u7684\u8def\u5f84\u7aef\u70b9\u5bf9\u5e94\u7684\u90a3\u4e2a\u513f\u5b50\u4e2d\uff0c\u4ee5\u8be5\u5b50\u6811\u7684\u91cd\u5fc3\u4f5c\u4e3a\u4e0b\u6b21\u7684\u5206\u6cbb\u4e2d\u5fc3\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define maxn 200010\n#define inf 1000000000\nusing namespace std;\ntemplate<typename T> inline void read(T &x)\n{\n    x=0;char c=getchar();bool flag=false;\n    while(!isdigit(c)){if(c=='-')flag=true;c=getchar();}\n    while(isdigit(c)){x=(x<<1)+(x<<3)+(c^48);c=getchar();}\n    if(flag)x=-x;\n}\nint n,m,ans=inf,root,tot,top;\nint mx[maxn],siz[maxn],d[maxn],bel[maxn],st[maxn];\nbool vis[maxn];\nstruct edge\n{\n    int to,nxt,v;\n}e[maxn];\nint head[maxn],edge_cnt;\nvoid add(int from,int to,int val)\n{\n    e[++edge_cnt]={to,head[from],val},head[from]=edge_cnt;\n}\nstruct query\n{\n    int x,y;\n}q[maxn];\nvoid dfs_root(int x,int fa)\n{\n    siz[x]=1,mx[x]=0;\n    for(int i=head[x];i;i=e[i].nxt)\n    {\n        int y=e[i].to;\n        if(vis[y]||y==fa) continue;\n        dfs_root(y,x),siz[x]+=siz[y];\n        mx[x]=max(mx[x],siz[y]);\n    }\n    mx[x]=max(mx[x],tot-siz[x]);\n    if(mx[x]<mx[root]) root=x;\n}\nvoid dfs_dis(int x,int fa,int dis,int rt)\n{\n    bel[x]=rt,d[x]=dis;\n    for(int i=head[x];i;i=e[i].nxt)\n    {\n        int y=e[i].to;\n        if(y==fa) continue;\n        dfs_dis(y,x,dis+e[i].v,rt);\n    }\n}\nvoid solve(int x)\n{\n    vis[x]=true;\n    for(int i=head[x];i;i=e[i].nxt)\n        dfs_dis(e[i].to,x,e[i].v,e[i].to);\n    int val=0,p;\n    for(int i=1;i<=m;++i)\n    {\n        int v=d[q[i].x]+d[q[i].y];\n        if(v>val) val=v,st[top=1]=i;\n        else if(v==val) st[++top]=i;\n    }\n    ans=min(ans,val),p=bel[q[st[top]].x];\n    if(vis[p]) return;\n    for(int i=1;i<=top;++i)\n    {\n        int x=q[st[i]].x,y=q[st[i]].y;\n        if(bel[x]!=bel[y]||bel[x]!=p) return;\n    }\n    root=0,tot=siz[p],dfs_root(p,x),solve(root);\n}\nint main()\n{\n    read(n),read(m);\n    for(int i=1;i<n;++i)\n    {\n        int x,y,v;\n        read(x),read(y),read(v);\n        add(x,y,v),add(y,x,v);\n    }\n    for(int i=1;i<=m;++i) read(q[i].x),read(q[i].y);\n    tot=mx[0]=n,dfs_root(1,0),solve(1),printf(\"%d\",ans);\n    return 0;\n}\n```",
        "postTime": 1599307931,
        "uid": 172489,
        "name": "lhm_",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4886 \u3010\u5feb\u9012\u5458\u3011"
    },
    {
        "content": "\u5bf9\u6dc0\u7c89\u8d28\u601d\u60f3\u7684\u8fd0\u7528$qwq$\n\n\u6211\u4eec\u8003\u8651\u5bf9\u4e8e\u4e00\u4e2a\u70b9\u5bf9$(u,v)$\uff0c\u82e5\u5176\u4e3a\u6700\u5927\u503c\uff0c\u4e14\u70b9$rt$\u5728\u5176\u8def\u5f84\u4e0a\uff0c\u90a3\u4e48\u663e\u7136\u7b54\u6848\u662f\u4e0d\u80fd\u518d\u5c0f\u7684\uff0c\u5426\u5219\u7b54\u6848\u662f\u53ef\u80fd\u53ef\u4ee5\u66f4\u5c0f\u7684\u3002\n\n\u5177\u4f53\u7c7b\u6bd4\u4e0b\u6765\uff0c\u5bf9\u4e8e\u4e00\u4e2a$rt$\u800c\u8a00\uff0c\u5176\u80af\u5b9a\u4e3a\u7b54\u6848\u6709\u4e14\u4ec5\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\n\n$1.$\u8ddd\u79bb\u6700\u8fdc\u7684\u70b9\u5bf9$(u,v)$\u6ee1\u8db3\u5176\u5206\u5c45\u5728$rt$\u7684\u4e24\u68f5\u5b50\u6811\u5185\n\n$2.$\u5b58\u5728\u4e24\u4e2a\u53ca\u4ee5\u4e0a\u7684\u70b9\u5bf9$(u,v)$\u6ee1\u8db3\u8fd9\u4e24\u4e2a\u70b9\u5728\u540c\u4e00\u9897\u5b50\u6811\u5185\uff0c\u4f46\u662f\u8fd9\u591a\u4e2a\u5b50\u6811\u4e0d\u662f\u540c\u4e00\u9897\u3002\n\n\u5426\u5219\uff0c\u5982\u679c\u4e3a\u5982\u4e0b\u60c5\u51b5\uff0c\u7b54\u6848\u662f\u53ef\u80fd\u4f1a\u66f4\u5c0f\u3002\n\n$3.$\u5bf9\u4e8e\u6240\u6709\u7684\u8ddd\u79bb\u6700\u957f\u7684\u4e24\u4e2a\u70b9\u5bf9$(u,v)$\u90fd\u6709\u5176\u5904\u4e8e\u540c\u4e00\u9897\u5b50\u6811\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u5f80\u90a3\u9897\u5b50\u6811\u5185\u8d70\u5373\u53ef\u3002\n\n\u4f46\u662f\u76f4\u63a5\u8d70\u4e0b\u6765\u590d\u6742\u5ea6\u8fd8\u662f$O(n^2)$\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u6bcf\u6b21\u7edf\u8ba1\u7b54\u6848\u90fd\u662f\u66b4\u529b\u7edf\u8ba1\u3002\n\n\u8003\u8651\u6bcf\u6b21\u5bf9\u90a3\u9897\u5b50\u6811\u6c42\u4e00\u4e2a\u91cd\u5fc3\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5c06\u95ee\u9898\u89c4\u6a21\u7f29\u5c0f\u4e00\u534a\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u4ee5\u4fdd\u8bc1\u53ef\u80fd\u66f4\u5c0f\u7684\u70b9\u5c31\u5728\u8fd9\u9897\u5b50\u6811\u5185\u3002\n\n\u590d\u6742\u5ea6$O((n+m)\\log n)$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define Next( i, x ) for( register int i = head[x]; i; i = e[i].next )\n#define rep( i, s, t ) for( register int i = s; i <= t; ++ i )\n#define re register\nint read() {\n\tchar cc = getchar(); int cn = 0, flus = 1;\n\twhile(cc < '0' || cc > '9') {  if( cc == '-' ) flus = -flus;  cc = getchar();  }\n\twhile(cc >= '0' && cc <= '9')  cn = cn * 10 + cc - '0', cc = getchar();\n\treturn cn * flus;\n}\nconst int N = 1e5 + 5 ; \nstruct E {\n\tint to, next, w ; \n} e[N * 2] ;\nint head[N], dis[N], fr[N], ed[N], Ans, cnt, n, m ; \nint rt, sum, vis[N], sz[N], dp[N], book[N] ; \nvoid add( int x, int y, int z ) {\n\te[++ cnt] = (E){ y, head[x], z }, head[x] = cnt , \n\te[++ cnt] = (E){ x, head[y], z }, head[y] = cnt ; \n}\nvoid get_rt( int x, int fa ) {\n\tsz[x] = 1, dp[x] = 1 ; \n\tNext( i, x ) {\n\t\tint v = e[i].to ; if( v == fa || vis[v] ) continue ; \n\t\tget_rt( v, x ), sz[x] += sz[v], dp[x] = max( dp[x], sz[v] ) ;\n\t} \n\tdp[x] = max( dp[x], sum - sz[x] ) ;\n\tif( dp[x] < dp[rt] ) rt = x ; \n}\nvoid dfs( int x, int fa, int p ) {\n\tbook[x] = p ;\n\tNext( i, x ) {\n\t\tint v = e[i].to ; if( v == fa ) continue ; \n\t\tdis[v] = e[i].w + dis[x], dfs( v, x, p ) ;\n\t}\n}\nvoid out() {\n\tprintf(\"%d\\n\", Ans ) ; exit(0) ; \n}\nvoid solve( int x ) {\n\tif( vis[x] ) out() ; \n\tvis[x] = 1, dis[x] = 0 ;\n\tNext( i, x ) {\n\t\tint v = e[i].to ; dis[v] = dis[x] + e[i].w, dfs( v, x, v ) ;\n\t}\n\tint Mx = 0, zk = 0, chk = 0 ;\n\trep( i, 1, m ) {\n\t\tint u = fr[i], v = ed[i] ; \n\t\tif( dis[u] + dis[v] == Mx ) {\n\t\t\tif( book[u] != book[v] ) zk = 1 ; \n\t\t\tif( book[u] == book[v] && book[u] != chk ) zk = 1 ; \n\t\t}\n\t\tif( dis[u] + dis[v] > Mx ) {\n\t\t\tMx = dis[u] + dis[v], zk = 0 ; \n\t\t\tif( book[u] != book[v] ) zk = 1 ; \n\t\t\tif( book[u] == book[v] ) chk = book[u] ; \n\t\t}\n\t}\n\tAns = min( Ans, Mx ) ;\n\tif( zk ) out() ; \n\telse {\n\t\trt = 0, sum = dp[0] = sz[chk], get_rt( chk, x ) ; \n\t\tsolve( rt ) ; \n\t}\n}\nsigned main()\n{\n\tn = read(), m = read() ; int x, y, z ; \n\trep( i, 2, n ) x = read(), y = read(), z = read(), add( x, y, z ) ; \n\trep( i, 1, m ) fr[i] = read(), ed[i] = read() ; \n\trt = 0, dp[0] = sum = n, get_rt( 1, 0 ), Ans = 23333333 ;\n\tsolve( rt ) ;\n\treturn 0;\n}\n\n```",
        "postTime": 1567769257,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4886 \u3010\u5feb\u9012\u5458\u3011"
    },
    {
        "content": "\u70b9\u5206\u6cbb\u795e\u9898$orz$\n\n\u9996\u5148\u8003\u8651$O(nm)$\u7684\u66b4\u529b\uff0c\u5c31\u662f\u679a\u4e3e\u4efb\u610f\u70b9\u4f5c\u4e3a\u90ae\u9012\u7ad9\u4f5c\u6839\uff0c\u66b4\u529b$dfs$\uff0c\u6c42\u51fa\u6bcf\u7ec4\u914d\u9001\u7684\u6700\u5927\u4ee3\u4ef7\uff0c\u8bb0\u4f5c$cost_i$\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u6700\u4f18\u70b9\u4f5c\u6839\uff0c\u663e\u7136\u5bf9\u4e8e\u4efb\u610f\u4e00\u6761\u4ece\u6839\u5f00\u59cb\u7684\u94fe\uff0c$cost_i$\u90fd\u662f\u9012\u589e\u7684\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u70b9\u5206\u6cbb\u4e00\u4e0b\uff0c\u6bcf\u6b21\u505a\u51fa\u5f53\u524d\u5b50\u6811\u7684\u91cd\u5fc3\uff0c\u5bf9\u6240\u6709\u914d\u9001\u90fd\u6c42\u4e00\u904d\u4ee3\u4ef7\uff0c\u53d6$max$\n\n\u5bf9\u4e8e\u4e00\u6b21\u914d\u9001\uff0c\u82e5\u5176\u4ee3\u4ef7\u4e3a$max$,\u5e76\u4e14\u4e24\u70b9\u8de8\u8fc7\u91cd\u5fc3\uff0c\u6216\u8005\u591a\u7ec4\u914d\u9001\u5728\u91cd\u5fc3\u7684\u4e0d\u540c\u5b50\u6811\uff0c\u4ee3\u4ef7\u5747\u4e3a$max$\uff0c\u663e\u7136\u6b64\u65f6\u662f\u6700\u4f18\u70b9\n\n\u5426\u5219\u8fed\u4ee3\u7740\u7ee7\u7eed\u70b9\u5206\u6cbb\uff0c\u663e\u7136\u53ea\u6709$log$\u6b21\n\n\u590d\u6742\u5ea6\u4e3a$O(mlogn)$\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<cstdlib>\n#define rep(i,s,t) for(register int i=s;i<=t;++i)\n#define gi(x) read(x)\n#define gii(x,y) read(x),read(y)\n#define giii(x,y,z) read(x),read(y),read(z)\n#define ms(f,x) memset(f,x,sizeof f)\n#define open(x) freopen(#x\".in\",\"r\",stdin),freopen(#x\".out\",\"w\",stdout)\nnamespace IO{\n    #define gc getchar()\n    #define pc(x) putchar(x)\n    template<typename T>inline void read(T &x){\n        x=0;int f=1;char ch=gc;while(ch>'9'||ch<'0'){if(ch=='-')f=-1;ch=gc;}\n        while(ch>='0'&&ch<='9')x=(x<<3)+(x<<1)+ch-'0',ch=gc;x*=f;return;\n    }\n    template<typename T>inline void write(T x=0){\n        T wr[51];wr[0]=0;if(x<0)pc('-'),x=-x;if(!x)pc(48);\n        while(x)wr[++wr[0]]=x%10,x/=10;while(wr[0])pc(48+wr[wr[0]--]);return;\n    }\n}\nusing IO::read;\nusing IO::write;\nusing namespace std;\nconst int N=2e5+11;\nint n,m,tot,rt,ans;\nint nxt[N],las[N],to[N],w[N],sz[N],f[N],bel[N],dis[N],p[N];\nint x[N],y[N];\nbool vis[N];\ninline void add(int x,int y,int z){\n\tnxt[++tot]=las[x];\n\tlas[x]=tot;\n\tto[tot]=y;\n\tw[tot]=z;\n}\ninline void getroot(int x,int fa,int siz){\n\tsz[x]=1;f[x]=0;\n\tfor(register int e=las[x];e;e=nxt[e]){\n\t\tif(to[e]==fa||vis[to[e]])continue;\n\t\tgetroot(to[e],x,siz);\n\t\tsz[x]+=sz[to[e]];\n\t\tf[x]=max(f[x],sz[to[e]]);\n\t}\n\tf[x]=max(f[x],siz-sz[x]);\n\tif(f[x]<f[rt])rt=x;\n}\ninline void dfs(int x,int fa,int rt){\n\tbel[x]=rt;\n\tfor(register int e=las[x];e;e=nxt[e]){\n\t\tif(to[e]==fa)continue;\n\t\tdis[to[e]]=dis[x]+w[e];\n\t\tdfs(to[e],x,rt);\n\t}\n}\ninline void solve(int u){\n\tif(vis[u]){\n\t\tprintf(\"%d\\n\",ans);\n\t\texit(0);\n\t}\n\tvis[u]=1,dis[u]=0;\n\tfor(register int e=las[u];e;e=nxt[e])\n\t\tdis[to[e]]=w[e],dfs(to[e],u,to[e]);\n\tint Max=0,las=0;p[0]=0;\n\trep(i,1,m)\n\t\tif(dis[x[i]]+dis[y[i]]>Max)\n\t\t\tMax=dis[x[i]]+dis[y[i]],p[p[0]=1]=i;\n\t\telse\n\t\t\tif(Max==dis[x[i]]+dis[y[i]])\n\t\t\t\tp[++p[0]]=i;\n\tans=min(ans,Max);\n\trep(i,1,p[0])\n\t\tif(bel[x[p[i]]]!=bel[y[p[i]]]){\n\t\t\tprintf(\"%d\\n\",ans);\n\t\t\texit(0);\n\t\t}\n\t\telse{\n\t\t\tif(!las)las=bel[x[p[i]]];\n\t\t\telse \n\t\t\t\tif(bel[x[p[i]]]!=las){\n\t\t\t\t\tprintf(\"%d\\n\",ans);\n\t\t\t\t\texit(0);\n\t\t\t\t}\n\t\t}\n\trt=0;\n\tgetroot(las,u,sz[las]);\n\tsolve(rt);\n}\nint main(){\n\tgii(n,m);\n\trep(i,2,n){\n\t\tint u,v,w;\n\t\tgiii(u,v,w);\n\t\tadd(u,v,w),add(v,u,w);\n\t}\n\trep(i,1,m)\n\t\tgii(x[i],y[i]);\n\tans=1e9;\n\tf[rt=0]=n+1;\n\tgetroot(1,1,n);\n\tsolve(rt);\n\treturn 0;\n}\n```",
        "postTime": 1542197641,
        "uid": 45523,
        "name": "Stump",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4886 \u3010\u5feb\u9012\u5458\u3011"
    },
    {
        "content": "\n\n\u5148\u968f\u4fbf\u627e\u4e00\u4e2a\u70b9\u4f5c\u4e3a\u6839\uff0c\u8ba1\u7b97\u7b54\u6848\u3002\n\n\u8bb0\u5f55\u4e0b\u6765\u6240\u6709\u79bb\u6839\u8ddd\u79bb\u6700\u5927\u7684\u70b9\u5bf9\u3002\n\n\u5206\u60c5\u51b5\u67e5\u770b\uff08\u5176\u5b9e\u662f\u6211\u81ea\u5df1\u4e00\u70b9\u4e00\u70b9\u62fc\u51d1\u51fa\u6765\u7684\uff09\uff1a\n \n- \u5982\u679c\u76ee\u524d\u7684\u6839\u5728\u4efb\u610f\u4e00\u5bf9\u8ddd\u79bb\u6700\u5927\u7684\u70b9\u5bf9\u4e0a\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u662f\u4e00\u5b9a\u7684\uff0c\u4e0d\u53ef\u80fd\u66f4\u4f18\u4e86\u3002\n\n- \u5982\u679c\u6709\u4e24\u4e2a\u70b9\u5bf9\u4e0d\u5728\u6839\u7684\u540c\u4e00\u5b50\u6811\u4e2d\uff0c\u90a3\u4e48\u7b54\u6848\u4e5f\u4e0d\u53ef\u80fd\u66f4\u4f18\u4e86\u3002\n\n- \u5982\u679c\u6240\u6709\u8ddd\u79bb\u6700\u5927\u7684\u70b9\u5bf9\u90fd\u5728\u6839\u7684\u540c\u4e00\u5b50\u6811\u5185\uff0c\u90a3\u4e48\u7b54\u6848**\u53ef\u80fd**\u662f\u53ef\u4ee5\u589e\u52a0\u7684\uff0c\u5411\u8fd9\u4e2a\u5b50\u6811\u5185\u9012\u5f52\u5904\u7406\u5373\u53ef\u3002 \n\n\u66f4\u65b0\u7b54\u6848\u65f6\u4e00\u5b9a\u8981**\u53d6min**\uff0c\u56e0\u4e3a**\u4e0d\u4e00\u5b9a**\u5b50\u6811\u5185\u7684\u70b9\u5c31\u662f\u66f4\u4f18\u7684\u3002 \n\ncode:\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\nusing namespace std;\nconst int MAXN=100010;\nstruct Edge{\n\tint nxt,to,dis;\n}e[MAXN<<1];\nint head[MAXN],num;\nint x[MAXN],y[MAXN],vis[MAXN];\nint maxson[MAXN],p[MAXN],q[MAXN];\nint belong[MAXN],deep[MAXN],size[MAXN];\nint n,m,root,maxn,ans=2147483647;\ninline void add(int from,int to,int dis){\n\te[++num].to=to;\n\te[num].dis=dis;\n\te[num].nxt=head[from];\n\thead[from]=num;\n}\nvoid g_e(int u,int fa,int all_){  \n    size[u]=1;\n\tmaxson[u]=0;\n    for(int i=head[u];i;i=e[i].nxt){\n    \tif(e[i].to!=fa&&!vis[e[i].to]){\n\t\t    g_e(e[i].to,u,all_);\n\t        size[u]+=size[e[i].to];\n            maxson[u]=max(maxson[u], size[e[i].to]);\n        }\n\t} \n    maxson[u]=max(maxson[u],all_-size[u]);\n    if(maxson[u]<maxn){\n    \troot=u;\n\t\tmaxn=maxson[u];\n\t}\n}\nvoid dfs(int u,int fa,int dep,int rt){ \n    belong[u]=rt;\n    deep[u]=dep;\n    for(int i=head[u];i;i=e[i].nxt){\n    \tif(e[i].to!=fa) dfs(e[i].to,u,dep+e[i].dis,rt);\n\t}\n}\nvoid query(int u){\n    if(vis[u]){\n    \tcout<<ans<<endl;\n        exit(0);\n    }      \n    vis[u]=1;\n    for(int i=head[u];i;i=e[i].nxt) dfs(e[i].to,u,e[i].dis,e[i].to);\n    deep[u]=0;\n    maxn=0; \n\tp[0]=0;\n    int last=0;\n    for(int i=1;i<=m;i++){\n    \tif(deep[x[i]]+deep[y[i]]>maxn){\n    \t\tmaxn=deep[x[i]]+deep[y[i]];\n\t\t\tp[p[0]=1]=i;\n\t\t}\n        else if(deep[x[i]]+deep[y[i]]==maxn) p[++p[0]]=i;\n\t}\n    ans=min(ans,maxn);   \n    for(int i=1;i<=p[0];i++){\n        if(belong[x[p[i]]]!=belong[y[p[i]]]){  \n            cout<<ans<<endl;\n            exit(0);\n        }\n        else{\n        \tif(!last) last=belong[x[p[i]]];\n            else if(last!=belong[x[p[i]]]){  \n                cout<<ans<<endl;\n                exit(0);\n            }\n\t\t} \n    }\n    maxn=0x7fffffff;\n    g_e(last,u,size[last]);\n    query(root); \n}\nint main(){\n\tcin>>n>>m; \n    for(int i=1;i<n;i++){\n    \tint a,b,c;\n    \tcin>>a>>b>>c;\n        add(a,b,c); \n\t    add(b,a,c);\n    }\n    for(int i=1;i<=m;i++) cin>>x[i]>>y[i];\n    maxn=0x7fffffff; \n\tg_e(1,0,n);\n    query(root);\n}\n```\n",
        "postTime": 1616734095,
        "uid": 300024,
        "name": "miao5",
        "ccfLevel": 4,
        "title": "P4886"
    },
    {
        "content": "\u8fd9\u9053\u9898\u4e00\u770b\u5c31\u662f\u70b9\u5206\u6cbb\uff0c\u4f46\u5b83\u548c\u666e\u901a\u7684\u70b9\u5206\u6cbb\u6709\u70b9\u4e0d\u4e00\u6837\uff0c\u5e73\u5e38\u505a\u7684\u9898\uff0c\u4e3b\u8981\u662f\u8003\u8651\u5982\u4f55\u5728\u6bcf\u4e00\u5c42\u5185\u5feb\u901f\u7edf\u8ba1\u7b54\u6848\uff0c\u800c\u8fd9\u9053\u9898\u9700\u6211\u4eec\u786e\u5b9a\u5f53\u524d\u70b9\u662f\u5426\u4e3a\u6700\u4f18\u89e3\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u6765\u8003\u8651\uff1a\u9996\u5148\uff0c\u968f\u4fbf\u9009\u4e00\u4e2a\u70b9\u4f5c\u4e3a\u4e2d\u5fc3\uff0c\u66b4\u529b\u6c42\u51fa\u6bcf\u6761\u8def\u5f84\u957f\u5ea6\uff0c\u5e76\u53d6\u6700\u5927\u503c $max$ \uff0c\u5982\u679c\u6709\u591a\u4e2a\u5c31\u4e00\u8d77\u5b58\u4e0b\u6765\uff0c\u5728\u5c5e\u4e8e $max$ \u4e2d\u7684\u8def\u5f84\u4e2d\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u8981\u4e48\u7ecf\u8fc7\u8fd9\u4e2a\u70b9\uff0c\u8981\u4e48\u6ca1\u6709\u3002\n\n\u5982\u679c\u6709\u4e00\u6761\u8def\u5f84\u7ecf\u8fc7\uff0c\u8fd9\u5f53\u524d\u7684 $max$ \u5c31\u662f\u7b54\u6848\uff0c\u5b83\u6ca1\u6709\u66f4\u5c0f\u7684\u60c5\u51b5\u4e86\uff0c\u53ef\u4ee5\u81ea\u884c\u4e3e\u4f8b\u89c2\u5bdf\u3002\n\n\u5982\u679c\u4efb\u610f\u4e24\u6761\u8def\u5f84\uff0c\u90fd\u6ca1\u7ecf\u8fc7\u5f53\u524d\u8282\u70b9, \u5e76\u4e14\u5728\u4e0d\u540c\u5b50\u6811\u5185\uff0c $max$ \u4e5f\u4e0d\u4f1a\u66f4\u5c0f\uff0c\u4f60\u4e0d\u80fd\u627e\u51fa\u4e00\u79cd\u65b9\u6848\u4f7f\u4e24\u6761\u8def\u5f84\u8ddd\u79bb\u90fd\u51cf\u5c0f\u3002\n\n\u6700\u540e\uff0c\u6ee1\u8db3\u6240\u6709\u8def\u5f84\u90fd\u6ca1\u7ecf\u8fc7\u4e2d\u5fc3\u4e14\u5728\u4e00\u4e2a\u5b50\u6811\u5185\uff0c\u5c31\u6709\u53ef\u80fd\u6709\u66f4\u5c0f\u7684\u7b54\u6848\uff0c\u90a3\u4e48\u5c31\u627e\u90a3\u4e2a\u5b50\u6811\u7684\u91cd\u5fc3\u4f5c\u4e3a\u4e2d\u5fc3\uff0c\u518d\u6267\u884c\u4e4b\u524d\u7684\u8fc7\u7a0b\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=2e5+5;\nint head[N],ver[N],net[N],edge[N],tot;\nint n,m,s[N],d[N],ans=0x3f3f3f3f;\nint f[N],dist[N],p[N];\nbool st[N];\nvoid add(int a,int b,int c){\n\tnet[++tot]=head[a];\n\thead[a]=tot;\n\tver[tot]=b;\n\tedge[tot]=c;\n}\nint get_siz(int x,int fa){//\u6c42\u5b50\u6811\u5927\u5c0f \n\tif(st[x])return 0;\n\tint res=1;\n\tfor(int i=head[x];i;i=net[i]){\n\t\tint v=ver[i];\n\t\tif(v==fa)continue;\n\t\tres+=get_siz(v,x);\n\t}\n\treturn res;\n}\nint get_wc(int x,int fa,int sum,int &wc){//\u6c42\u91cd\u5fc3 \n\tif(st[x])return 0;\n\tint res=1,maxx=0;\n\tfor(int i=head[x];i;i=net[i]){\n\t\tint v=ver[i];\n\t\tif(v==fa)continue;\n\t\tint t=get_wc(v,x,sum,wc);\n\t\tmaxx=max(t,maxx);\n\t\tres+=t;\n\t}\n\tmaxx=max(maxx,sum-res);\n\tif(maxx<=sum/2)wc=x;\n\treturn res;\n}\nvoid get_dist(int x,int fa,int dis,int root){//\u9884\u5904\u7406\u8282\u70b9\u6240\u5c5e\u5b50\u6811\uff0c\u548c\u8def\u5f84\u8ddd\u79bb \n\tdist[x]=dis;\n\tf[x]=root;\n\tfor(int i=head[x];i;i=net[i]){\n\t\tint v=ver[i];\n\t\tif(v==fa)continue;\n\t\tget_dist(v,x,dis+edge[i],root);\n\t}\n}\nvoid calc(int x){//\u6267\u884c\u9012\u5f52\u8fc7\u7a0b \n\tif(st[x]){//\u9632\u6b62\u6b7b\u5faa\u73af \n\t\tprintf(\"%d\",ans);\n\t\texit(0);\n\t}\n\tst[x]=1;\n\tdist[x]=0;\n\tfor(int i=head[x];i;i=net[i]){\n\t\tint v=ver[i];\n\t\tget_dist(v,x,edge[i],v);\n\t}\n\tint maxx=0,pt=0;//p[]\u5b58\u7684\u662f\u8def\u5f84\u8ddd\u79bb\u4e3amax\u7684\u8def\u5f84\u7f16\u53f7 \n\tfor(int i=1;i<=m;i++){\n\t\tif(dist[s[i]]+dist[d[i]]>maxx){\n\t\t\tmaxx=dist[s[i]]+dist[d[i]];\n\t\t\tpt=1,p[pt]=i;\n\t\t}\n\t\telse if(dist[s[i]]+dist[d[i]]==maxx){\n\t\t\tp[++pt]=i;\n\t\t}\n\t}\n\tans=min(ans,maxx);\n\tint last=0;\n\tfor(int i=1;i<=pt;i++){\n\t\tif(f[s[p[i]]]!=f[d[p[i]]]){//\u8003\u8651\u4e4b\u524d\u8bf4\u7684\u7b2c\u4e00\u79cd\u60c5\u51b5 \n\t\t\tprintf(\"%d\",ans);\n\t\t\texit(0);\n\t\t}\n\t\telse{\n\t\t\tif(!last)last=f[s[p[i]]];\n\t\t\telse if(last!=f[s[p[i]]]){//\u7b2c\u4e8c\u79cd\u60c5\u51b5 \n\t\t\t\tprintf(\"%d\",ans);\n\t\t\t\texit(0);\n\t\t\t}\n\t\t}\n\t}\n\tget_wc(last,x,get_siz(last,x),last);//\u627e\u91cd\u5fc3 \n\tcalc(last);\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<n;i++){\n\t\tint a,b,c;\n\t\tscanf(\"%d%d%d\",&a,&b,&c);\n\t\tadd(a,b,c);\n\t\tadd(b,a,c);\n\t}\n\tfor(int i=1;i<=m;i++){\n\t\tscanf(\"%d%d\",&s[i],&d[i]);\n\t}\n\tint root=1;\n\tget_wc(1,0,n,root);\n\tcalc(root);\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1616402658,
        "uid": 277664,
        "name": "\u968f\u4fbfAK",
        "ccfLevel": 6,
        "title": "P4886 \u5feb\u9012\u5458  \u9898\u89e3"
    },
    {
        "content": "[\u5b89\u5229$blog$](https://ctz45562.github.io/2019/08/27/\u6d1b\u8c37-P4886-\u5feb\u9012\u5458/)\n\n[\u4f20\u9001\u95e8](https://www.luogu.org/problem/P4886)\n\n\u4ecb\u662f\u4f60\u6ca1\u6709\u4f53\u9a8c\u8fc7\u7684$chuan$\u65b0\u505a\u6cd5\u3002\n\n\u66b4\u529b\u70b9\u5206\u6cbb\u7b97\u51fa\u6bcf\u4e2a\u70b9\u4f5c\u4e3a\u4e2d\u5fc3\u65f6\u7684\u7b54\u6848\u3002\n\n\u5bf9\u4e8e\u8def\u5f84$c\\rightarrow u\\rightarrow c\\rightarrow v\\rightarrow c$\u7684\u957f\u5ea6\u9664\u4ee5$2$\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u505a$dis(u,v)+c$\u5230\u8def\u5f84$(u,v)$\u7684\u8ddd\u79bb\u4e58$2$\u3002\n\n\u628a\u8def\u5f84\u5206\u6210\u4e24\u7c7b\uff1a\n\n\u7ecf\u8fc7\u5206\u6cbb\u4e2d\u5fc3\u7684\uff1a\n\n![]( https://cdn.luogu.com.cn/upload/pic/75315.png )\n\n\u5bf9\u4e8e\u8fd9\u79cd\u8def\u5f84\uff0c$dfs$\u4e00\u904d\u6811\uff0c\u5f53\u8131\u79bb\u4e86\u67d0\u6761\u8def\u5f84\u65f6\uff0c\u6bd4\u5982\u8d70\u8fb9$(2,4)$\u6216$(2,5)$\uff0c\u5f00\u59cb\u8ba1\u7b97\u8be5\u8def\u5f84\u7684\u8d21\u732e\u3002\u5047\u8bbe\u8d70\u8fb9$(x,y)$\u8131\u79bb\u4e86\u8be5\u8def\u5f84\uff0c\u5219$y$\u5b50\u6811\u5185\u6bcf\u4e2a\u70b9$i$\u90fd\u4f1a\u6709$dis(i,x)\\times 2+dis(u,v)$\u7684\u8d21\u732e\u3002\n\n\u5177\u4f53\u5b9e\u73b0\uff1a\u7ed9\u6bcf\u6761\u8fb9\u7ef4\u62a4\u4e00\u4e2a\u6743\u503c$V$\uff0c\u5bf9\u6bcf\u6761\u8def\u5f84\u4e0a\u7684\u8fb9\u7684$V$\u5bf9$dis(u,v)$\u53d6$\\max$\u3002\u7b97\u51fa\u6bcf\u4e2a\u70b9\u6bcf\u6761\u51fa\u8fb9$V$\u7684\u6700\u5927\u503c\u548c\u6b21\u5927\u503c\u3002$dfs$\u65f6\u7ef4\u62a4\u5f53\u524d\u6700\u5927\u8d21\u732e$now$\uff0c\u5bf9\u6bcf\u4e2a\u70b9\uff0c\u7b49\u4e8e\u8be5\u70b9\u6700\u5927\u503c\u7684\u8fb9\u9009\u6b21\u5c0f\u503c\u66f4\u65b0$now$\uff0c\u5426\u5219\u9009\u6700\u5927\u503c\uff0c\u7d2f\u52a0\u8fb9\u6743\u4e58$2$\u5373\u53ef\u3002\n\n\u8fd9\u6837\u4f1a\u53d1\u73b0\u4ece\u6839\u8282\u70b9\u5f00\u59cb$dfs$\u65f6\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff1a\n\n![](https://cdn.luogu.com.cn/upload/pic/75316.png )\n\n\u6b64\u65f6\uff0c\u7ea2\u8272\u8def\u5f84\u548c\u7eff\u8272\u8def\u5f84\u4e3a\u6700\u5927\u548c\u6b21\u5927\u3002\n\n\u7531\u4e8e\u4e00\u6761\u8def\u5f84\u53ef\u80fd\u4f1a\u5360\u636e\u6839\u8282\u70b9\u7684\u4e24\u6761\u51fa\u8fb9\uff0c\u7ef4\u62a4\u6700\u5927\u503c\u548c\u6b21\u5927\u503c\u5c31\u51fa$bug$\u4e86\u3002\n\n\u8fd9\u6837\u6211\u4eec\u76f4\u63a5\u7ef4\u62a4\u4e00\u4e2a\u5806\u628a\u6bcf\u6761\u8def\u5f84\u52a0\u8fdb\u53bb\uff0c\u4ece\u6839\u8282\u70b9\u51fa\u53d1\u65f6\u628a\u6bcf\u6761\u7ecf\u8fc7\u8be5\u70b9\u7684\u8def\u5f84\u5220\u6389\uff0c\u7edf\u8ba1\u5b8c\u518d\u52a0\u56de\u53bb\u3002\n\n---\n\n\u4e0d\u7ecf\u8fc7\u5206\u6cbb\u4e2d\u5fc3\u7684\uff1a\n\n![](https://cdn.luogu.com.cn/upload/pic/75317.png )\n\n\u628a$(u,v)$\u7684$lca$\u6807\u8bb0\u4e3a\u5173\u952e\u70b9\uff0c\u5e76\u8d4b\u4e88\u4e00\u4e2a\u6743\u503c$mx$\u4e3a**\u6240\u6709\u6807\u8bb0\u5b83\u7684\u70b9\u5bf9\u4e2d\u6700\u5927\u7684$dis(u,v)$**\u3002\u8bb0$ma(i)$\u4e3a$i$\u5230\u5176\u5b50\u6811\u5185\u6240\u6709\u5173\u952e\u70b9\u4e2d\uff08\u8bbe\u5173\u952e\u70b9\u4e3a$p$\uff09\uff0c\u6700\u5927\u7684$mx(p)+dis(p,i)\\times 2$\u3002\n\n\u8f6c\u79fb\u5f88\u7b80\u5355\uff1a$ma(i)=\\max\\{mx(i),\\max\\limits_{edge(i,j)}\\{ma(j)+edge(i,j).l\\times 2\\}\\}$\n\n\u5bf9\u6839\u7ef4\u62a4\u4e00\u4e2a$ma1$\u548c$ma2$\u8868\u793a\u6839\u7684\u513f\u5b50\u4e2d\u6700\u5927\u548c\u6b21\u5927\u7684$ma$\u3002\n\n$dfs$\u6839\u7684\u6bcf\u4e2a\u513f\u5b50$i$\u7684\u5b50\u6811\uff0c\u540c\u6837\u7684\uff0c\u82e5$ma(i)=ma1$\u9009$ma2$\uff0c\u5426\u5219\u9009$ma1$\u4e3a$now$\uff0c\u5bf9\u6bcf\u4e2a\u70b9$j$\u7684\u8d21\u732e\u5c31\u662f$now+dis(root,j)\\times 2$\u3002\n\n\u6ce8\u610f\u4e0d\u7528\u4e5f\u4e0d\u80fd\u5728\u7edf\u8ba1\u65f6\u8fdb\u4e00\u6b65\u66f4\u65b0$now$\u4e86\u3002\n\n---\n\n\u7e41\u7410\u7684\u7ec6\u8282\uff1a\n\n\u5206\u7c7b\u8def\u5f84\u65f6\uff0c\u53ef\u4ee5\u5de7\u5999\u8fd0\u7528$tarjan\\ lca$\u3002\n\n\u5904\u7406\u8fb9\u7684$V$\u65f6\uff0c\u5176\u5b9e\u5c31\u662f\u94fe\u53d6$\\max$\u5355\u70b9\u67e5\u3002\u7531\u4e8e\u8fd9\u4e9b\u8def\u5f84\u90fd**\u7ecf\u8fc7\u6839\u8282\u70b9**\uff0c\u76f4\u63a5\u5bf9\u4e24\u7aef\u70b9\u53d6$\\max$\uff0c\u7edf\u8ba1\u5b50\u6811\u6700\u5927\u503c\u5373\u53ef\u3002\n\n\u76f4\u63a5\u4f4d\u4e8e\u8def\u5f84$(u,v)$\u7684\u70b9\u7b97\u4e0d\u4e0a$(u,v)$\u7684\u8d21\u732e\uff0c\u9700\u8981\u989d\u5916\u5904\u7406\uff0c\u53ef\u4ee5\u5728\u7edf\u8ba1$V$\u65f6\u4e00\u5757\u7b97\uff0c\u514d\u53bb\u4e86\u6811\u5256\u4e24\u4e2a$\\log$\u6216$lct$\u7684\u5927\u5e38\u6570\u3002\n\n\u7531\u4e8e\u4e00\u4e9b\u795e\u5947\u7684\u539f\u56e0\uff0c\u5f62\u5982$(u,u)$\u7684\u8def\u5f84\u4e0d\u4f1a\u88ab\u7b97\u5230\uff0c\u628a$u$\u62c6\u51fa\u6765$u'$\u8fde\u4e0a\u957f\u4e3a$0$\u7684\u8fb9\uff0c\u628a\u8def\u5f84\u6539\u4e3a$(u,u')$\u5373\u53ef\u3002\n\n\u5173\u4e8e\u6b63\u786e\u6027\uff1a\n\n\u5982\u679c\u4e00\u6761\u8def\u5f84\u7ecf\u8fc7\u6839\u8282\u70b9\uff0c\u5c31\u4f1a\u7edf\u8ba1\u4e0a\u5b83\u5bf9\u5f53\u524d\u6811\u5185\u6240\u6709\u70b9\u7684\u8d21\u732e\u3002\n\n\u5426\u5219\u4f1a\u7edf\u8ba1\u5b83\u5bf9**\u548c\u5b83\u4e0d\u5c5e\u4e8e\u6839\u8282\u70b9\u540c\u4e00\u4e2a\u513f\u5b50\u7684\u5b50\u6811\u7684\u8282\u70b9**\u7684\u8d21\u732e\uff0c\u7136\u540e\u5206\u6cbb\u5b83\u7684\u5b50\u6811\u3002\n\n\u6211\u4eec\u5c31\u80fd\u628a\u5b83\u5bf9\u6bcf\u4e2a\u70b9\u7684\u8d21\u732e\u7b97\u4e0a\u3002\n\n\u5173\u4e8e\u590d\u6742\u5ea6\uff1a\n\n\u968f\u4fbf\u60f3\u4e00\u60f3\u5c31\u4f1a\u53d1\u73b0\u590d\u6742\u5ea6\u662f$O((m+n)\\log n)$\u7684\u3002\n\n\u4ee3\u7801\uff1a\n\n\u6211\u7684$priority\\_queue$\u4e0d\u77e5\u9053\u4e3a\u5565\u4f1a\u5728\u7ed3\u675f\u7a0b\u5e8f\u65f6\u70b8\u6389\u4e8e\u662f~~\u6284~~\u624b\u5199\u7684\u5806\u3002\n\n\u5c3d\u91cf\u7cbe\u7b80\u4e86\u4ee3\u7801\u8fd8\u662f\u6709$200+$\u884c\u6bd5\u7adf\u662f\u66b4\u529b\u3002\n\n``` cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\n#include <cstring>\n#include <vector>\n#include <queue>\n\n#define maxn 200005\n#define inf 0x3f3f3f3f\n\nusing namespace std;\n\ninline int read(){\n\tint x=0,y=0;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')y=1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn y?-x:x;\n}\nnamespace origin{\n\tint h[maxn],num;\n\tstruct edge{\n\t\tint pre,to,l;\n\t}e[maxn<<1];\n\tinline void add(int from,int to,int l){\n\t\te[++num].pre=h[from],h[from]=num,e[num].to=to,e[num].l=l;\n\t\te[++num].pre=h[to],h[to]=num,e[num].to=from,e[num].l=l;\n\t}\n}\nint h[maxn],siz[maxn],top[maxn],son[maxn],deep[maxn],fa[maxn],F[maxn],qu[maxn][2],num,all,mx,root,cnt;\nint ma1[maxn],ma2[maxn],ema1[maxn],ema2[maxn],ans[maxn],dis[maxn],ee[maxn],bl[maxn],sp[maxn];\nvector<pair<int,int> >v[maxn];\nvector<int>poi[maxn];\nbool vis[maxn],ap[maxn];\nstruct heap{\n\tint H[maxn],heap_size;\n\tvoid push(int d){\n\t\tint now=++heap_size;\n\t\tH[heap_size]=d;\n\t\twhile(now>1){\n\t\t\tif(H[now]<H[now>>1]) return;\n\t\t\tswap(H[now],H[now>>1]);\n\t\t\tnow>>=1;\n\t\t}\n\t}\n\tvoid pop(){\n\t\tint now=1,next;\n\t\tH[1]=H[heap_size--];\n\t\twhile((now<<1)<=heap_size){\n\t\t\tnext=now<<1;\n\t\t\tif(next<heap_size&&H[next+1]>H[next]) next++;\n\t\t\tif(H[now]>H[next]) return;\n\t\t\tswap(H[now],H[next]);\n\t\t\tnow=next;                      \n\t\t} \n\t}\n\tbool empty(){return !(bool(heap_size));}\n};\nstruct del_heap{\n\theap q,d;\n\tvoid push(int x){q.push(x);}\n\tvoid del(int x){d.push(x);}\n\tvoid clear(){q.heap_size=d.heap_size=0;}\n\tint top(){\n\t\twhile(!d.empty()&&q.H[1]==d.H[1])q.pop(),d.pop();\n\t\tif(q.empty())return -inf;\n\t\treturn q.H[1];\n\t}\n}q;\nstruct edge{\n\tint pre,to,l,v;\n}e[maxn<<1];\nint find(int x){\n\tif(F[x]==x)return x;\n\treturn F[x]=find(F[x]);\n}\ninline void add(int from,int to,int l){\n\te[++num].pre=h[from],h[from]=num,e[num].to=to,e[num].l=l,e[num].v=-inf;\n}\nvoid dfs1(int node=1){\n\tsiz[node]=1;\n\tint x;\n\tfor(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(siz[x])continue;\n\t\tfa[x]=node,deep[x]=deep[node]+1,dis[x]=dis[node]+e[i].l;\n\t\tdfs1(x),siz[node]+=siz[x];\n\t\tif(siz[x]>siz[son[node]])son[node]=x;\n\t}\n}\nvoid dfs2(int node=1){\n\tvis[node]=1;\n\tif(son[node]){\n\t\ttop[son[node]]=top[node],dfs2(son[node]);\n\t\tint x;\n\t\tfor(register int i=h[node];i;i=e[i].pre){\n\t\t\tx=e[i].to;\n\t\t\tif(!vis[x])top[x]=x,dfs2(x);\n\t\t}\n\t}\n}\ninline int lca(int x,int y){\n\twhile(top[x]!=top[y])deep[top[x]]<deep[top[y]]?y=fa[top[y]]:x=fa[top[x]];\n\treturn deep[x]<deep[y]?x:y;\n}\ninline void check(int &m1,int &m2,int x){\n\tif(x>m1)m2=m1,m1=x;\n\telse if(x>m2)m2=x;\n}\nvoid getroot(int node,int f){\n\tint x,ma=0;\n\tfor(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(x==f||vis[x])continue;\n\t\tgetroot(x,node),ma=max(ma,siz[x]);\n\t}\n\tma=max(ma,all-siz[node]);\n\tif(ma<mx)mx=ma,root=node;\n}\nvoid init(int node,int f,int b){\n\tint x;\n\tbl[node]=b,ema1[node]=ema2[node]=ma1[node]=ma2[node]=-inf,ap[node]=1,F[node]=node;\n\tfor(vector<pair<int,int> >::iterator iter=v[node].begin();iter!=v[node].end();++iter)\n\t\tif(ap[iter->first]){\n\t\t\tx=find(iter->first);\n\t\t\tif(x!=root)ma1[x]=max(ma1[x],iter->second);\n\t\t\telse {\n\t\t\t\tee[iter->first]=max(ee[iter->first],iter->second),ee[node]=max(ee[node],iter->second);\n\t\t\t\tma2[node]=max(ma2[node],iter->second),poi[b].push_back(iter->second);\n\t\t\t\tif(iter->first!=root)poi[bl[iter->first]].push_back(iter->second),ma2[iter->first]=max(ma2[iter->first],iter->second);\n\t\t\t\tq.push(iter->second);\n\t\t\t}\n\t\t}\n\tfor(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(x==f||vis[x])continue;\n\t\tinit(x,node,b),F[x]=node,ma1[node]=max(ma1[node],ma1[x]+(e[i].l<<1));\n\t}\n}\nvoid calc(int node,int f,int now){\n\tsiz[node]=1,ans[node]=max(ans[node],now);\n\tint x;\n\tfor(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(x==f||vis[x])continue;\n\t\tcalc(x,node,max(e[i].v==ema1[node]?ema2[node]:ema1[node],max(now,ma2[node]))+(e[i].l<<1));\n\t\tsiz[node]+=siz[x];\n\t}\n}\nvoid calc_edge_value(int node,int f){\n\tint x;\n\tfor(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(x==f||vis[x])continue;\n\t\tcalc_edge_value(x,node);\n\t\tee[node]=max(ee[node],ee[x]),check(ema1[node],ema2[node],e[i].v=ee[x]);\n\t}\n\tans[node]=max(ans[node],ee[node]);\n}\nvoid clear(int node,int f){\n\tap[node]=0,ee[node]=-inf;\n\tint x;\n\tfor(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(x==f||vis[x])continue;\n\t\tclear(x,node),e[i].v=-inf;\n\t}\n}\nvoid solve(int node){\n\tq.clear(),vis[node]=1;\n\tint x;\n\tma1[node]=ma2[node]=-inf,F[node]=node,ap[node]=1,bl[node]=0;\n\tfor(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(vis[x])continue;\n\t\tinit(x,node,x),F[x]=node,check(ma1[node],ma2[node],ma1[x]+(e[i].l<<1));\n\t}\n\tcalc_edge_value(node,0);\n\tans[node]=max(ans[node],ma1[node]);\n\tfor(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(vis[x])continue;\n\t\tfor(register int j=0;j<poi[x].size();++j)q.del(poi[x][j]);\n\t\tcalc(x,node,max((ma1[x]+(e[i].l<<1)==ma1[node]?ma2[node]:ma1[node]),q.top())+(e[i].l<<1));\n\t\tfor(register int j=0;j<poi[x].size();++j)q.push(poi[x][j]);\n\t\tpoi[x].clear();\n\t}\n\tclear(node,0);\n\tfor(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(vis[x])continue;\n\t\tmx=inf,all=siz[x],getroot(x,node),solve(root);\n\t}\n}\nvoid rebuild(int node=1,int f=0,int gf=0){\n\tint x;\t\n\tif(node>all)for(register int i=h[node];i;i=e[i].pre){\n\t\tx=e[i].to;\n\t\tif(x==f)continue;\n\t\trebuild(x,node,f);\n\t}\n\telse for(register int i=origin::h[node];i;i=origin::e[i].pre){\n\t\tx=origin::e[i].to;\n\t\tif(x==f||x==gf)continue;\n\t\tif(sp[x])add(node,sp[x],origin::e[i].l),add(sp[x],node,origin::e[i].l),add(sp[x],x,0),add(x,sp[x],0),x=sp[x];\n\t\telse add(node,x,origin::e[i].l),add(x,node,origin::e[i].l);\n\t\trebuild(x,node,f);\n\t}\n}\nint DIS(int x,int y){\n\treturn dis[x]+dis[y]-(dis[lca(x,y)]<<1);\n}\nint main(){\n\tmemset(ee,~0x3f,sizeof ee);\n\tint n=all=read(),m=read(),k=n,x,y,z,res=inf;\n\tfor(register int i=1;i<n;++i)x=read(),y=read(),z=read(),origin::add(x,y,z);\n\tfor(register int i=1;i<=m;++i){\n\t\tqu[i][0]=x=read(),qu[i][1]=y=read();\n\t\tif(x==y&&!sp[x])sp[x]=++k,qu[i][1]=k;\n\t}\n\tif(sp[1])add(sp[1],1,0),add(1,sp[1],0);\n\trebuild(1,sp[1]),dfs1(),dfs2();\t\n\tfor(register int i=1;i<=m;++i){\n\t\tx=qu[i][0],y=qu[i][1],z=dis[x]+dis[y]-(dis[lca(x,y)]<<1);\n\t\tv[x].push_back((pair<int,int>){y,z}),v[y].push_back((pair<int,int>){x,z});\n\t}\n\tmemset(vis,0,sizeof vis);\n\tall=k,mx=inf,getroot(1,0),solve(root);\n\tfor(register int i=1;i<=n;++i)res=min(res,ans[i]);\n\tprintf(\"%d\\n\",res);\n}\n```\n\n",
        "postTime": 1566908966,
        "uid": 111762,
        "name": "_ctz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4886 \u3010\u5feb\u9012\u5458\u3011"
    }
]