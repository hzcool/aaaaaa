[
    {
        "content": "\u672c\u849f\u84bb\u7b2c\u4e00\u6b21\u505a\u8fd9\u79cd\u4ea6\u53ef\u8d5b\u8247\u7684DP\u4f18\u5316...\n\n\u771f\u662f\u5999\u4e0d\u53ef\u8a00\u554a\n\n\u9996\u5148\u6211\u4eec\u6709\u4e00\u4e2a\u66b4\u529b\u7684DP\uff1a$f(i,j)$\u8868\u793a\u524d$i$\u4e2a\u6570\u53d6\u503c\u57df\u8303\u56f4$[1,j]$\u7684\u6240\u6709\u4e0d\u540c\u5408\u6cd5\u5e8f\u5217\u7684\u503c\u4e4b\u548c\u3002\u4f46\u662f\u8fd9\u6837\u8f6c\u79fb\u5e76\u4e0d\u65b9\u4fbf\u3002\u6211\u4eec\u53ef\u4ee5\u53ea\u8003\u8651\u9012\u589e\u7684\u5e8f\u5217\uff0c\u8003\u8651\u7b2c$i$\u4e2a\u6570\u53d6\u4e0d\u53d6$j$\uff0c\u4e8e\u662f\u6709\u8f6c\u79fb\n\n$$f(i,j)=f(i-1,j-1)\\times j+f(i,j-1)$$\n\n\u6700\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u9012\u589e\u5e8f\u5217\u90fd\u53ef\u4ee5\u4efb\u610f\u91cd\u6392\uff0c\u6240\u4ee5\u7b54\u6848\u662f$f(n,A)\\times n!$\u3002\n\n\u8fd9\u6837\u505a\u7684\u590d\u6742\u5ea6\u662f$O(nA)$\u7684\uff0c\u5e76\u4e0d\u80fd\u901a\u8fc7\uff0c\u9700\u8981\u4f18\u5316\u3002\n\n\u9996\u5148\u4f60\u8981\u77e5\u9053\u4e00\u4e2a\u5b9a\u7406\uff1a\u5e73\u9762\u4e0a\u6a2a\u5750\u6807\u4e0d\u540c\u7684\u4efb\u610f$n+1$\u4e2a\u70b9\u53ef\u4ee5\u552f\u4e00\u786e\u5b9a\u4e00\u4e2a\u6b21\u6570\u4e0d\u9ad8\u4e8e$n$\u7684\u591a\u9879\u5f0f$p(x)$\uff0c\u53ef\u4ee5\u4f7f\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u516c\u5f0f\u6765\u786e\u5b9a\uff1a\n\n$$p(x)=\\sum\\limits_{i=0}^ny_i\\prod\\limits_{j\\neq i}\\frac{x-x_j}{x_i-x_j}$$\n\n\u5047\u8bbe$f(n,i)$\u662f\u5173\u4e8e$i$\u7684$g(n)$\u6b21\u591a\u9879\u5f0f\uff0c\u6211\u4eec\u6765\u63a8\u5bfc$g(n)$\u7684\u8868\u8fbe\u5f0f\u3002\n\n\u6ce8\u610f\u5230\uff1a\u5982\u679c$p(x)$\u662f$n$\u6b21\u591a\u9879\u5f0f\uff0c\u90a3\u4e48\u5dee\u5206$p(x)-p(x-1)$\u662f$n-1$\u6b21\u591a\u9879\u5f0f\u3002\u8bc1\u660e\u6bd4\u8f83\u663e\u7136\u3002\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0$f(n,i)$\u7684\u8f6c\u79fb\u65b9\u7a0b\u91cc\u6709\u5dee\u5206\u7684\u5f62\u5f0f\uff1a\n\n$$f(n,i)-f(n,i-1)=f(n-1,i-1)\\times i$$\n\n\u89c2\u5bdf\u8fd9\u4e2a\u5f0f\u5b50\u3002\u5de6\u8fb9\u662f\u5173\u4e8e$i$\u7684$g(n)-1$\u6b21\u591a\u9879\u5f0f\uff0c\u53f3\u8fb9\u662f\u5173\u4e8e$i$\u7684$g(n-1)+1$\u6b21\u591a\u9879\u5f0f\uff0c\u4e8e\u662f\u6211\u4eec\u6709\n\n$$g(n)-1=g(n-1)+1$$\n\n\u5f53$n=0$\u65f6\u663e\u7136\u6709\n\n$$g(0)=0$$\n\n\u4e0d\u96be\u53d1\u73b0$g(n)$\u662f\u7b49\u5dee\u6570\u5217\uff0c\u5f97\u5230$g(n)=2n$\n\n\u5229\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u76f4\u63a5\u6309\u7167\u8f6c\u79fb\u65b9\u7a0b\u5f52\u7eb3\u4e5f\u53ef\u4ee5\u8bc1\u660e\uff0c\u4f46\u6211\u8fd9\u91cc\u662f\u5728\u672a\u77e5\u7ed3\u8bba\u7684\u60c5\u51b5\u4e0b\u6b63\u9762\u63a8\u5bfc\u7684\u3002\n\n\u65e2\u7136$f(n,i)$\u662f\u5173\u4e8e$i$\u7684$2n$\u6b21\u591a\u9879\u5f0f\uff0c\u6211\u4eec\u5c31\u4e0d\u9700\u8981\u6c42\u51fa$f(n,A)$\uff0c\u53ea\u8981\u6c42\u51fa$f(n,1)$\u5230$f(n,2n+1)$\uff0c\u5c31\u6709\u4e86$2n+1$\u4e2a\u70b9\uff0c\u5229\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u5373\u53ef\u63d2\u51fa$f(n,A)$\u7684\u503c\u3002\n\n\u76f4\u63a5\u5229\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u516c\u5f0f\u662f$O(n^2)$\u7684\uff0c\u5f53\u6a2a\u5750\u6807\u662f\u8fde\u7eed\u7684\u6574\u6570\u7684\u65f6\u5019\u53ef\u4ee5\u9884\u5904\u7406\u524d\u7f00\u79ef\u548c\u540e\u7f00\u79ef\u6765\u4f18\u5316\u5230$O(n)$\uff0c\u53e6\u5916\u5c31\u7b97\u6a2a\u5750\u6807\u4e0d\u662f\u8fde\u7eed\u7684\u6574\u6570\u6211\u4eec\u4e5f\u53ef\u4ee5\u7528\u4e00\u4e9b\u7384\u5999\u7684\u505a\u6cd5[\u5feb\u901f\u63d2\u503c](https://www.luogu.org/problemnew/show/P5158)\u3002\u4f46\u662f\u672c\u9898$n\\leq500$\uff0c\u5c31\u968f\u610f\u5566\n\n\u4ee3\u7801\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u4e0d\u8d34\u4e86\u3002",
        "postTime": 1549180436,
        "uid": 72071,
        "name": "GKxx",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4463 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f] calc\u3011"
    },
    {
        "content": "~~\u4f60\u4eec\u554a\uff0c\u641e\u4ec0\u4e48\u62c9\u683c\u6717\u65e5\u63d2\u503c\uff0c\u771f\u662f too young\uff0ctoo simple\uff01~~  \n\u63d0\u4f9b\u4e00\u79cd\u6bd4\u8f83\u4f18\u79c0\u7684\u505a\u6cd5\u3002\n****  \nupdated\uff1a\u6539\u4e3a\u4e86\u5168\u7a0b\u7528\u751f\u6210\u51fd\u6570\u63a8\u5bfc\u3002\n\n\u4e0d\u59a8\u5148\u8f6c\u6362\u4e00\u4e0b\u9898\u610f\uff1a  \n\u5c06 **\u5e8f\u5217** \u53d8\u4e3a **\u96c6\u5408**\uff0c\u5373\u5c06\u6709\u5e8f\u5316\u4e3a\u65e0\u5e8f\uff0c\u6700\u540e\u7b54\u6848\u4e58 $n!$ \u5c31\u597d\u4e86\u3002  \n\n\u5bf9\u4e8e\u4e00\u4e2a\u6570 $i$\uff0c\u5982\u679c\u9009\u5b83\u5bf9\u4e58\u79ef\u7684\u8d21\u732e\u5c31\u662f $i$\uff0c\u4e0d\u9009\u5c31\u662f $1$\u3002  \n\u53c8\u7531\u4e8e\u4e0d\u80fd\u6709\u91cd\u590d\u7684\u6570\uff0c\u6240\u4ee5\u5176\u751f\u6210\u51fd\u6570\u4e3a $(1+ix)$\u3002  \n\n\u628a\u5b83\u4eec\u90fd\u4e58\u8d77\u6765\u5373\u662f $k$ \u56fa\u5b9a\u65f6\uff0c\u7b54\u6848\u7684\u751f\u6210\u51fd\u6570\n$$F(x)=\\prod_{i=1}^k(1+ix)$$\n\u7528\u4e00\u4e2a\u53d6 $\\ln$ \u7684\u5957\u8def\uff0c\u628a\u5b83\u4eec\u5148\u52a0\u8d77\u6765\uff0c\u4e4b\u540e\u518d $\\exp$\uff1a\n$$\\ln(1+kx)=\\int\\frac{k}{1+kx}\\text dx$$\n$$=\\int \\left( k\\sum_{i=0}^\\infty(-k)^ix^i\\right) \\text dx$$\n$$=\\sum_{i=1}^\\infty(-1)^{i-1}\\frac{k^i}{i}x^i$$\n$$[x^n]\\ln F(x)=\\frac{(-1)^{n-1}}{n}\\sum_{i=1}^ki^n$$\n\u8fd9\u662f\u4e00\u4e2a\u7ecf\u5178\u7684\u81ea\u7136\u6570\u5e42\u548c\u7684\u5f62\u5f0f\uff0c\u8003\u8651\u5217\u51fa\u5b83\u7684\u6307\u6570\u578b\u751f\u6210\u51fd\u6570\uff1a\n$$G(x)=\\sum_{n=0}^\\infty\\left( \\sum_{i=1}^ki^n \\right)\\frac{x^n}{n!}$$\n$$=\\sum_{i=1}^k\\sum_{n=0}^\\infty \\frac{i^nx^n}{n!}$$\n$$=\\sum_{i=1}^k\\text e^{ix}$$\n\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u5f97\u5230\n$$G(x)=\\frac{\\text e^{kx}-1}{1-\\text e^{-x}}$$\n\u4ec0\u4e48\uff0c\u4f60\u95ee\u5e38\u6570\u9879\u4e3a\u96f6\u600e\u4e48\u6c42\u9006\uff1f\u5206\u5b50\u5e38\u6570\u9879\u4e5f\u662f\u96f6\uff0c\u540c\u9664 $x$ \u5c31\u597d\u4e86\u3002   \n\u7136\u540e\u5c06 $G(x)$ \u7684\u7cfb\u6570\u4ee3\u5165\u4e0a\u9762\u7684\u5f0f\u5b50\n$$[x^n]\\ln F(x)=(-1)^{n-1}(n-1)![x^n]G(x)$$  \n\n\u591a\u9879\u5f0f $\\exp$ \u5373\u5f97 $F(x)$\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n \\log n)$\u3002  \n~~\u7136\u800c\u9700\u8981 MTT\uff0c\u975e\u5e38\u6bd2\u7624~~  \n\n\u53c2\u8003\u4ee3\u7801\uff1a  \n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\n#define N 2053\n#define ll long long\n#define reg register\n#define add(x,y) (x+y>=p?x+y-p:x+y)\n#define dec(x,y) (x<y?x-y+p:x-y)\n#define pi 3.141592653589793\nusing namespace std;\n\nint p;\n\ninline void read(int &x){\n    x = 0;\n    char c = getchar();\n    while(c<'0'||c>'9') c = getchar();\n    while(c>='0'&&c<='9'){\n        x = (x<<3)+(x<<1)+(c^48);\n        c = getchar();\n    }\n}\n\nvoid print(int x){\n    if(x>9) print(x/10);\n    putchar(x%10+'0');  \n}\n\ninline int power(int a,int t){\n    int res = 1;\n    while(t){\n        if(t&1) res = (ll)res*a%p;\n        a = (ll)a*a%p;\n        t >>= 1; \n    }\n    return res;\n}\n\nstruct complex{\n    double r,i;\n    inline complex(double r=0,double i=0):r(r),i(i){}\n\n    inline complex operator * (const complex& x) const{\n        return complex(r*x.r-i*x.i,i*x.r+r*x.i);\n    }\n    inline complex operator ~ () const{\n        return complex(r,-i);\n    }\n    inline complex operator + (const complex& x) const{\n        return complex(r+x.r,i+x.i);\n    }\n    inline complex operator - (const complex& x) const{\n        return complex(r-x.r,i-x.i);\n    }\n    inline complex operator / (const int& x) const{\n        return complex(r/x,i/x);\n    }\n};\n\nint rev[N],inv[N],fac[N],ifac[N];\ncomplex rt[N];\nint siz;\n\nvoid init(int n){\n    int lim = 1;\n    while(lim<=n) lim <<= 1,++siz;\n    for(reg int i=1;i!=lim;++i) rev[i] = (rev[i>>1]>>1)|((i&1)<<(siz-1));\n    inv[1] = 1;\n    rt[lim>>1] = complex(1,0);\n    for(reg int i=1;i!=(lim>>1);++i) rt[i+(lim>>1)] = complex(cos(pi*i/lim*2),sin(pi*i/lim*2));\n    for(reg int i=(lim>>1)-1;i;--i) rt[i] = rt[i<<1];\n    for(reg int i=2;i<=lim;++i) inv[i] = (ll)(p-p/i)*inv[p%i]%p;\n}\n\ninline int getlen(int n){\n    return 1<<(32-__builtin_clz(n));    \n}\n\ninline void FFT(complex *f,int type,int lim){\n    if(type==-1) reverse(f+1,f+lim);\n    static complex a[N],x;\n    int shift = siz-__builtin_ctz(lim);\n    for(reg int i=0;i!=lim;++i) a[rev[i]>>shift] = f[i];\n    for(reg int mid=1;mid!=lim;mid<<=1)\n    for(reg int j=0;j!=lim;j+=(mid<<1))\n    for(reg int k=0;k!=mid;++k){\n        x = a[j|k|mid]*rt[mid|k];\n        a[j|k|mid] = a[j|k]-x;\n        a[j|k] = a[j|k]+x;\n    }\n    for(reg int i=0;i!=lim;++i) f[i] = a[i];\n    if(type==1) return;\n    for(reg int i=0;i!=lim;++i) f[i] = f[i]/lim;\n}\n\nvoid multiply(const int *A,const int *B,int n,int m,int *R,int len){\n    static complex f[N],g[N],h[N],q[N];\n    register complex t,f0,f1,g0,g1;\n    register ll x,y,z;\n    int lim = getlen(n+m);\n     for(reg int i=0;i!=lim;++i){\n        f[i] = complex(A[i]>>15,A[i]&32767);\n        g[i] = complex(B[i]>>15,B[i]&32767);\n    } \n    FFT(f,1,lim),FFT(g,1,lim);\n    for(reg int i=0;i!=lim;++i){\n        t = ~f[i?lim-i:0];\n        f0 = (f[i]-t)*complex(0,-0.5),f1 = (f[i]+t)*0.5;\n        t = ~g[i?lim-i:0];\n        g0 = (g[i]-t)*complex(0,-0.5),g1 = (g[i]+t)*0.5;\n        h[i] = f1*g1;\n        q[i] = f1*g0 + f0*g1 + f0*g0*complex(0,1);\n    }\n    FFT(h,-1,lim),FFT(q,-1,lim);\n    for(reg int i=0;i<=len;++i){\n        x = (ll)(h[i].r+0.5)%p<<30;\n        y = (ll)(q[i].r+0.5)<<15;\n        z = q[i].i+0.5;\n        R[i] = (x+y+z)%p;\n    }\n}\n\ninline void inverse(const int *f,int n,int *R){\n    static int g[N],h[N];\n    memset(g,0,getlen(n<<1)<<2);\n    int lim = 1,top = 0;\n    int s[30];\n    while(n){\n        s[++top] = n;\n        n >>= 1;\n    }\n    g[0] = power(f[0],p-2);\n    while(top--){\n        n = s[top+1];\n        while(lim<=(n<<1)) lim <<= 1;\n        memcpy(h,f,(n+1)<<2);\n        memset(h+n+1,0,(lim-n)<<2);\n        multiply(h,g,n,n,h,n);\n        multiply(h,g,n,n,h,n);\n        for(reg int i=0;i<=n;++i) g[i] = dec(add(g[i],g[i]),h[i]);\n    }\n    memcpy(R,g,(n+1)<<2);\n}\n\ninline void log(int *f,int n){\n    static int g[N];\n    inverse(f,n,g);\n    for(reg int i=0;i!=n;++i) f[i] = (ll)f[i+1]*(i+1)%p;\n    f[n] = 0;\n    int lim = getlen(n<<1);\n    memset(g+n+1,0,(lim-n)<<2);\n    multiply(f,g,n,n,f,n);\n    for(reg int i=n;i;--i) f[i] = (ll)f[i-1]*inv[i]%p;\n    f[0] = 0;\n}\n\nvoid exp(const int *f,int n,int *R){\n    static int g[N],h[N];   \n    memset(g,0,getlen(n<<1)<<2);\n    int lim = 1,top = 0;\n    int s[30];\n    while(n){\n        s[++top] = n;\n        n >>= 1;    \n    }\n    g[0] = 1;\n    while(top--){\n        n = s[top+1];\n        while(lim<=(n<<1)) lim <<= 1;\n        memcpy(h,g,lim<<2);\n        log(g,n);\n        for(reg int i=0;i<=n;++i) g[i] = dec(f[i],g[i]);\n        g[0] = add(g[0],1);\n        multiply(g,h,n,n,g,n);\n    }\n    memcpy(R,g,(n+1)<<2);\n}\n\nint n,k;\nint F[N],G[N];\n\nint main(){\n    read(k),read(n),read(p);\n    init(n<<1|1);\n    int ans,lim = getlen(n<<1),pw = k;\n    ifac[0] = ifac[1] = fac[0] = fac[1] = 1;\n    for(reg int i=2;i<=n+1;++i) ifac[i] = fac[i] = (ll)fac[i-1]*i%p;\n    ifac[n+1] = power(fac[n+1],p-2);\n    for(reg int i=n;i;--i) ifac[i] = (ll)ifac[i+1]*(i+1)%p;\n    for(reg int i=0;i<=n;++i){\n        F[i] = (ll)pw*ifac[i+1]%p;\n        G[i] = (i&1)?p-ifac[i+1]:ifac[i+1];\n        pw = (ll)pw*k%p;\n    }\n    inverse(G,n,G);\n    multiply(F,G,n,n,G,n);\n    memset(F,0,sizeof(F));\n    for(reg int i=1;i<=n;++i){\n        F[i] = (ll)fac[i-1]*G[i]%p;\n        if((i-1)&1) F[i] = p-F[i];\n    }\n    exp(F,n,F);\n    ans = (ll)F[n]*fac[n]%p;\n    printf(\"%d\",ans);\n    return 0;   \n}\n```  \nps\uff1a\u7531\u4e8e\u6c42\u51fa\u4e86 $F_k(x)$ \u7684\u751f\u6210\u51fd\u6570\uff0c\u6240\u4ee5\u5bf9 $\\forall i \\le n$ \u7684\u7b54\u6848\u90fd\u53ef\u4ee5\u76f4\u63a5 $\\Theta(1)$ \u6c42\u51fa",
        "postTime": 1576949053,
        "uid": 115864,
        "name": "NaCly_Fish",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4463 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f] calc\u3011"
    },
    {
        "content": "\u7adf\u7136\u6ca1\u6709\u4eba\u5199\u5bb9\u65a5\u60f9\n\n\u8003\u8651\u5bb9\u65a5\uff1a\n\u4ee4$s(m) = \\sum i^m;$ \n\n\u4ee4f[i]\u8868\u793an==i\u65f6\u7684\u7b54\u6848\uff1a\n\n\u653e\u7b2ci\u4e2a\uff0c\u6bcf\u6b21\u9009\u62e9\u8ba9\u4e00\u4e2a\u76f8\u540c\uff0c\u4e24\u4e2a\u76f8\u540c\uff0c\uff0c\uff0cj\u4e2a\u76f8\u540c\n\n\u53ef\u4ee5\u6bd4\u8f83\u8270\u96be\u5730\u5f97\u51fa\uff1a\n\n$f[i] = \\sum_{j=1}^{i} (-1)^{j-1} * A_{i-1}^{j-1} * f[i-j]*s(j) ;$\n\n\u4e3a\u4ec0\u4e48\u662f\u6392\u5217\u5bb9\u65a5\uff1f\uff1f\n\n\u56e0\u4e3a\u6bcf\u6b21\u505a\u7684\u65f6\u5019\u4e0d\u540c\u7684\u987a\u5e8f\u662f\u4f1a\u88ab\u5206\u522b\u7edf\u8ba1\u7684\uff1b\n\n\u6216\u50cfcandyORZ\u4e00\u6837 \u63a8\u4e00\u63a8\u7ec4\u5408\u4e5f\u4f1a\u63a8\u4f1a\u56de\u6765 \uff1b\n\n\u9884\u5904\u7406S(m)\u81ea\u7136\u6570\u5e42\u53ef\u4ee5\u7528\u4f2f\u52aa\u5229\u6570\u505a\u5230K^2;\n\n\u4f2f\u52aa\u5229\u6570\u8be6\u89c1\uff1a\nhttps://blog.csdn.net/acdreamers/article/details/38929067\n\nhttps://blog.csdn.net/chhnz/article/details/79307351\n```\n#include<bits/stdc++.h>\n#define ll long long\n#define rg register\nusing namespace std;\nconst int N=510;\nint n,m,mod,C[N][N],A[N][N],B[N],S[N],fac[N],iv[N],pwn[N],f[N]; \nint main(){\n\tfreopen(\"bzoj2655.in\",\"r\",stdin);\n\tfreopen(\"bzoj2655.out\",\"w\",stdout);\n\tscanf(\"%d%d%d\",&n,&m,&mod);\n\tfor(rg int i=pwn[0]=fac[0]=1;i<=m+1;i++){\n\t\tfac[i]=(ll)fac[i-1]*i%mod;\n\t\tpwn[i]=(ll)pwn[i-1]*(n+1)%mod;\n\t}\n\tiv[1]=1;\n\tfor(rg int i=2;i<=m+1;i++)iv[i]=(ll)(mod-mod/i)*iv[mod%i]%mod;\n\tfor(rg int i=0;i<=m+1;i++)A[i][0]=C[i][0]=1;\n\tfor(rg int i=1;i<=m+1;i++)\n\tfor(rg int j=1;j<=m+1;j++){\n\t\tC[i][j] = (C[i-1][j-1] + C[i-1][j])%mod;\n\t\tA[i][j] = ((ll)j*A[i-1][j-1]%mod + A[i-1][j])%mod;\n\t}\n\tfor(rg int i=B[0]=1;i<=m+1;i++){\n\t\tfor(rg int j=0;j<i;j++){\n\t\t\tB[i] = (B[i] + (ll)C[i+1][j]*B[j]%mod)%mod;\n\t\t} \n\t\tB[i] = (mod - (ll)B[i]*iv[i+1]%mod)%mod;\n\t}\n\tS[0]=n;\n\tfor(rg int i=1;i<=m;i++){\n\t\tfor(rg int j=0;j<=i;j++){\n\t\t\tS[i] = (S[i] + (ll)C[i+1][j]*B[j]%mod*pwn[i+1-j]%mod)%mod;\n\t\t}\n\t\tS[i] = (ll)iv[i+1]*S[i]%mod;\n\t}\n\tf[0]=1;\n\tfor(rg int i=1;i<=m;i++){\n\t\tfor(rg int j=1;j<=i;j++){\n\t\t\tint fg = j&1 ? 1 : -1;\n\t\t\tf[i] = (f[i] + fg * (ll)A[i-1][j-1] * S[j] %mod * f[i-j] %mod)%mod;\n\t\t} \n\t\tf[i] = (f[i]+mod)%mod;\n\t}\n\tcout<<f[m]<<endl;\n\treturn 0;\n}\n\n```\n",
        "postTime": 1546054299,
        "uid": 40199,
        "name": "tkysss",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4463 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f] calc\u3011"
    },
    {
        "content": "## Solution\n- \u5148\u7edf\u8ba1\u5e8f\u5217\u5143\u7d20\u9012\u589e\u7684\u8d21\u732e\u548c\uff0c\u7b54\u6848\u5c31\u4e3a \u8d21\u732e\u548c $\\times n!$\u3002\n- \u8bbe $f[i][j]$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u9009\u7684\u6700\u5927\u7684\u6570 $\\le j$ \u7684\u8d21\u732e\u548c\uff0c\u8f6c\u79fb\u663e\u7136\u4e3a $f[i][j] = f[i - 1][j - 1] \\times j + f[i][j - 1]$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(nA)$\u3002\n- \u73b0\u5728\u6211\u4eec\u5c1d\u8bd5\u8bc1\u660e\uff1a$f[n][A]$ \u53ef\u4ee5\u7528\u4e00\u4e2a\u5173\u4e8e $A$ \u7684 $2n + 1$ \u6b21\u591a\u9879\u5f0f\u8868\u793a\u3002\n- \u8fd9\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u4f3c\u4e4e\u4e0d\u592a\u597d\u5f04\uff0c\u6211\u4eec\u5148\u8f6c\u6362\u4e00\u4e0b\u601d\u8def\u3002\n- \u8bbe $g[i][j]$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u9009\u7684\u6700\u5927\u7684\u6570 $= j$ \u7684\u8d21\u732e\u548c\uff0c\u8f6c\u79fb\u663e\u7136\u4e3a $g[i][j] = (\\sum \\limits_{k = 0}^{j - 1} g[i - 1][k]) \\times j$\uff0c\u5219 $f[n][A] = \\sum \\limits_{j = 0}^{A} g[n][j]$\u3002\n- \u82e5 $g[n][j]$ \u53ef\u4ee5\u7528\u4e00\u4e2a\u5173\u4e8e $j$ \u7684\u591a\u9879\u5f0f\u8868\u793a\uff0c\u6211\u4eec\u5bf9 $g[n][j]$ \u6c42\u524d\u7f00\u548c\u5b9e\u9645\u4e0a\u4f7f\u591a\u9879\u5f0f\u6b21\u6570 $+1$\uff0c\u56e0\u6b64\u73b0\u5728\u53ea\u8981\u8bc1\u660e $g[n][j]$ \u53ef\u4ee5\u7528\u4e00\u4e2a $2n$ \u6b21\u591a\u9879\u5f0f\u8868\u793a\u3002\n- \u8003\u8651\u6570\u5b66\u5f52\u7eb3\uff0c$n = 0$ \u65f6\u663e\u7136\u6210\u7acb\uff0c\u6bcf\u6b21\u8f6c\u79fb\u76f8\u5f53\u4e8e\u6c42\u524d\u7f00\u548c\u5e76 $\\times j(1 \\le j \\le A)$\uff0c\u591a\u9879\u5f0f\u6b21\u6570\u589e\u52a0 $2$\uff0c\u5f97\u8bc1\u3002\n- \u53c8\u56e0\u4e3a $f[n][0] = 0$\uff0c\u5e38\u6570\u9879\u80af\u5b9a\u4e3a $0$\uff0c\u7528 $2n + 1$ \u4e2a\u70b9\u5373\u53ef\u8868\u793a\u8fd9\u4e2a\u591a\u9879\u5f0f\u3002\n- \u76f4\u63a5\u66b4\u529b\u62c9\u683c\u6717\u65e5\u63d2\u503c\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n## Code\n\n```cpp\n#include <algorithm>\n#include <iostream>\n#include <cstring>\n#include <cstdlib>\n#include <cctype>\n#include <cstdio>\n#include <ctime>\n#include <cmath>\n\ntemplate <class T>\ninline void read(T &res)\n{\n\tchar ch; \n\twhile (ch = getchar(), !isdigit(ch));\n\tres = ch ^ 48;\n\twhile (ch = getchar(), isdigit(ch))\n\t\tres = res * 10 + ch - 48;\n}\n\nconst int N = 505;\nconst int M = 1005;\nint A, n, mod, m, y[M], f[N][M];\n\ninline void add(int &x, int y)\n{\n\tx += y;\n\tx >= mod ? x -= mod : 0;\n}\n\ninline int quick_pow(int x, int k)\n{\n\tint res = 1;\n\twhile (k)\n\t{\n\t\tif (k & 1) res = 1ll * res * x % mod;\n\t\tx = 1ll * x * x % mod; k >>= 1;\n\t}\n\treturn res;\n}\n\ninline int Lagrange(int x)\n{\n\tif (x >= 1 && x <= m)\n\t\treturn y[x];\n\n\tint res = 0;\n\tfor (int i = 1; i <= m; ++i)\n\t{\n\t\tint p = y[i], q = 1;\n\t\tfor (int j = 1; j <= m; ++j)\n\t\t\tif (i != j)\n\t\t\t{\n\t\t\t\tp = 1ll * p * (x - j) % mod;\n\t\t\t\tq = 1ll * q * (i - j) % mod;\n\t\t\t}\n\t\tp < 0 ? p += mod : 0;\n\t\tq < 0 ? q += mod : 0;\n\t\tres = (res + 1ll * p * quick_pow(q, mod - 2)) % mod;\n\t}\n\treturn res;\n}\n\nint main()\n{\n\tread(A); read(n); read(mod);\n\t\n\tint res = 1;\n\tfor (int i = 1; i <= n; ++i)\n\t\tres = 1ll * res * i % mod;\n\tm = n + n + 1;\n\tfor (int j = 0; j <= m; ++j)\n\t\tf[0][j] = 1;\n\tfor (int i = 1; i <= n; ++i)\n\t\tfor (int j = 1; j <= m; ++j)\n\t\t\tf[i][j] = (1ll * f[i - 1][j - 1] * j + f[i][j - 1]) % mod;\n\tfor (int j = 1; j <= m; ++j)\n\t\ty[j] = f[n][j];\n\tstd::cout << 1ll * res * Lagrange(A) % mod << std::endl;\n}\n```",
        "postTime": 1548941579,
        "uid": 17952,
        "name": "Log_x",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4463 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f] calc\u3011"
    },
    {
        "content": "### \u9898\u610f\u7b80\u8ff0\n\n&emsp;&emsp;[link](https://www.luogu.com.cn/problem/P4463).\n\n&emsp;&emsp;\u7ed9\u5b9a $k,n,p$\uff0c\u6c42\uff1a\n$$\n\\sum_{\\{a_n\\}}\\left[(\\forall i)\\left(a_i\\in[1,k]\\right)\\right]\\left[(\\forall i\\not=j)\\left(a_i\\not=a_j\\right)\\right]\\prod_{i=1}^n a_i\\bmod p\n$$\n\n### \u6570\u636e\u89c4\u6a21\n\n&emsp;&emsp;$n\\le500;~n+1<k<p\\le10^9$\u3002\n\n### Solution\n\n#### Step 1\n\n&emsp;&emsp;\u6709\u4e00\u4e2a\u6bd4\u8f83 naive \u7684 DP\uff1a\u4ee4 $f(i,j)$ \u8868\u793a\u524d $i$ \u4e2a\u5143\u7d20\u53d6\u503c\u5728 $[1,j]$ \u4e4b\u95f4\uff0c\u6784\u6210\u7684**\u5355\u589e\u5e8f\u5217**\u7684\u503c\uff08\u5373$\\prod_{t=1}^ia_t$\uff09\u4e4b\u548c\u3002\u6613\u6709\uff1a\n$$\nf(i,j)=j\\cdot f(i-1,j-1)+f(i,j-1)\n$$\n&emsp;&emsp;\u90a3\u4e48\u7b54\u6848\u4e3a\uff1a\n$$\nans=n!f(n,k)\n$$\n&emsp;&emsp;\u590d\u6742\u5ea6 $O(nk)$\uff0c\u4e0d\u53ef\u8fc7\u3002\n\n#### Step 2\n\n&emsp;&emsp;\u63a5\u4e0b\u6765\uff0c~~\u7ed3\u5408\u672c\u6587\u7684\u4e3b\u9898\uff0c~~\u6211\u4eec\u5c06\u4f1a\u8bc1\u660e\uff0c**\u5f53 $n$ \u4e3a\u5e38\u6570\uff0c$f(n,x)$ \u662f\u5173\u4e8e $x$ \u7684 $2n+1$ \u6b21\u7684\u51fd\u6570**\u3002\n\n##### \u8bc1\u660e\n\n&emsp;&emsp;\u5dee\u5206 $f(i)$\uff0c\u4ee4 $g(i,j)=f(i,j)-f(i,j-1)$\u3002\u7ed3\u5408\u539f\u9898\uff0c\u6709\u8f6c\u79fb\uff1a\n$$\ng(i,j)=j\\sum_{t=0}^{j-1}g(i-1,t)\n$$\n&emsp;&emsp;\u540c\u65f6\uff0c\u6709\uff1a\n$$\nf(i,j)=\\sum_{t=0}^jg(i,j)\n$$\n&emsp;&emsp;\u7531\u4e8e\u5bf9\u51fd\u6570 $f(i)$ \u5dee\u5206\u76f8\u5f53\u4e8e\u5c06\u5176\u6b21\u6570 $-1$\uff08\u6700\u9ad8\u6b21\u5c55\u5f00\u540e\u62b5\u6d88\uff09\u3002\u6545\u53ea\u9700\u8bc1 $g(n,x)$ \u662f\u5173\u4e8e $x$ \u7684 $2n$ \u6b21\u51fd\u6570\u3002\n\n&emsp;&emsp;\u8003\u8651\u5f52\u7eb3\uff1a\n\n- $1).$ \u5f53 $n=0$ \u65f6\uff0c$g(n,x)=[x=0]$\uff0c\u6210\u7acb\u3002\n\n- $2).$ \u5f53 $n=m$ \u65f6\u6210\u7acb\uff0c\u8003\u5bdf $n=m+1$ \u7684\u60c5\u51b5\uff1a\n    $$\n    g(m+1,x)=x\\sum_{t=0}^{x-1}g(m,t)\n    $$\n    &emsp;&emsp;\u6c42\u524d\u7f00\u548c\uff0c\u6b21\u6570 $+1$\uff0c\u518d\u5e26\u4e0a\u7cfb\u6570 $x$\uff0c\u6b21\u6570\u603b\u5171 $+2$\u3002\u7531\u4e8e $n=m$ \u662f\u6b21\u6570\u4e3a $2m$\uff0c\u6545 $n=m+1$ \u65f6\u6b21\u6570\u4e3a $2m+2=2(m+1)$\u3002\n\n    &emsp;&emsp;\u7531 $1).~2).$ $g(n,x)$ \u662f\u5173\u4e8e $x$ \u7684 $2n$ \u6b21\u51fd\u6570\u5f97\u8bc1\uff0c\u6545\u6709 $f(n,x)$ \u662f\u5173\u4e8e $x$ \u7684 $2n+1$ \u6b21\u51fd\u6570\uff0c\u8bc1\u6bd5\u3002\n\n\n\n&emsp;&emsp;\u7531\u6b64\uff0c\u5bf9\u4e8e $k\\le2n+1$ \u7684\u60c5\u51b5\uff0c\u6211\u4eec\u76f4\u63a5 DP \u5f97\u51fa\u7b54\u6848\uff1b\u5426\u5219\u53ea\u9700\u8981 DP \u51fa $f(n,1..2n+1)$ \u7684\u503c\uff0c\u7136\u540e\u5229\u7528 Lagrange \u63d2\u503c\u6cd5\u6c42\u51fa\u5df2\u88ab\u5f62\u5982 $\\left(x,f(n,x)\\right)$ \u7684 $2n+1$ \u4e2a\u70b9\u552f\u4e00\u786e\u5b9a\u7684 $2n+1$ \u6b21\u51fd\u6570\uff0c\u6700\u540e\u4ee3\u5165 $x=k$ \u6c42\u5f97\u7b54\u6848\u5373\u53ef\u3002\n\n&emsp;&emsp;\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n\nconst int MAXN = 500;\nint n, k, p, x[MAXN + 5], f[MAXN + 5][MAXN * 2 + 5];\n\ninline int qkpow ( int a, int b ) {\n\tint ret = 1;\n\tfor ( ; b; a = 1ll * a * a % p, b >>= 1 ) ret = 1ll * ret * ( b & 1 ? a : 1 ) % p;\n\treturn ret;\n}\n\ninline int lagrange ( const int n, const int* x, const int* y, const int k ) {\n\tint ret = 0;\n\tfor ( int i = 1; i <= n; ++ i ) {\n\t\tint num = y[i], den = 1;\n\t\tfor ( int j = 1; j <= n; ++ j ) {\n\t\t\tif ( i ^ j ) {\n\t\t\t\tnum = 1ll * num * ( k - x[j] + p ) % p;\n\t\t\t\tden = 1ll * den * ( x[i] - x[j] + p ) % p;\n\t\t\t}\n\t\t}\n\t\tret = ( ret + 1ll * num * qkpow ( den, p - 2 ) ) % p;\n\t}\n\treturn ret;\n}\n\nint main () {\n\tscanf ( \"%d %d %d\", &k, &n, &p );\n\tint fac = 1;\n\tfor ( int i = 0; i <= k && i <= ( n << 1 | 1 ); ++ i ) f[0][i] = 1;\n\tfor ( int i = 1; i <= n; fac = 1ll * fac * i ++ % p ) {\n\t\tfor ( int j = 1; j <= k && j <= ( n << 1 | 1 ); ++ j ) {\n\t\t\tf[i][j] = ( 1ll * j * f[i - 1][j - 1] + f[i][j - 1] ) % p;\n\t\t}\n\t}\n\tif ( k <= ( n << 1 | 1 ) ) return printf ( \"%d\\n\", int ( 1ll * fac * f[n][k] % p ) ), 0;\n\tfor ( int i = 1; i <= ( n << 1 | 1 ); ++ i ) x[i] = i;\n\treturn printf ( \"%d\\n\", int ( 1ll * fac * lagrange ( n << 1 | 1, x, f[n], k ) % p ) ), 0;\n}\n```\n",
        "postTime": 1592197352,
        "uid": 123807,
        "name": "Rainybunny",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4463 \u3010[\u96c6\u8bad\u961f\u4e92\u6d4b2012] calc\u3011"
    },
    {
        "content": "\u9898\u610f\u5f88\u660e\u786e\u3002\r\n\r\n\u8003\u8651\u4e00\u4e2a $\\rm DP$\u3002\u7531\u4e8e\u9650\u5236\u4e86\u4e92\u4e0d\u76f8\u540c\uff0c\u90a3\u4e48\u6211\u4eec\u8003\u8651\u4ece\u503c\u57df\u5f00\u59cb\u60f3\u3002\r\n\r\n\u8bbe $dp_{n,k}$ \u4e3a\u5728 $[1,n]$ \u4e2d\u9009\u4e86 $k$ \u4e2a\u6570\u7684\u6743\u503c\u4e4b\u548c\u3002\r\n\r\n\u5bb9\u6613\u5f97\u5230\u6709\uff1a\r\n$$dp_{n,k}=\\sum_{i=1}^{n-1}dp_{i,k-1} \\times n \\times (N-k+1)$$\r\n\u5f88\u660e\u663e\u8003\u8651 $0$ \u80af\u5b9a\u4e5f\u6ca1\u6709\u95ee\u9898\u3002\r\n\r\n\u63a5\u4e0b\u6765\u5f00\u59cb\u751f\u6210\u51fd\u6570\uff1a\r\n$$F_k(x)=\\sum_{i=0}^{\\infty}dp_{i,k}x^i$$\r\n\u9996\u5148\u8fd9\u4e2a $N-k+1$ \u80af\u5b9a\u80fd\u653e\u5230\u6700\u540e\u53bb\u4e58\u4e0a\u4e00\u4e2a\u9636\u4e58\uff0c\u4e8e\u662f\u5c31\u53d8\u6210\u4e86\u8ba1\u7b97\r\n$$dp_{n,k}=\\sum_{i=0}^{n-1}dp_{i,k-1} \\times n$$\r\n\u7528 GF \u6765\u5199\u7684\u8bdd\uff0c\u56e0\u4e3a $n$ \u7684\u5b58\u5728\uff0c\u8003\u8651\u6c42\u5bfc\uff1a\r\n$$F_k(x)=x(\\frac {xF_{k-1}(x)}{1-x})'$$\r\n\r\n\u7136\u540e\u6211\u4eec\u6709\u8fb9\u754c\u6761\u4ef6 $F_0(x)=1$\uff0c\u7b54\u6848\u662f $[x^n]\\frac {F_k(x)}{1-x}$\u3002\r\n\r\n\u6ce8\u610f\u5230 $F_k(x)$ \u4e00\u5b9a\u662f\u7c7b\u4f3c $\\frac {G(x)}{(1-x)^y}$ \u4e4b\u7c7b\u7684\uff0c\u6240\u4ee5\u8003\u8651\u9012\u63a8 $F_k(x)$\u3002\r\n\r\n\u6839\u636e $F_k(x)=x(\\frac {xF_k(x)}{1-x})'$\uff0c\u6211\u4eec\u76f4\u63a5\u4fdd\u5b58 $F_k(x)=\\frac {H(x)}{(1-x)^y}$\uff0c\u7136\u540e\u66b4\u529b\u8ba1\u7b97\u591a\u9879\u5f0f\u4e58\u6cd5\uff0c\u9664\u6cd5\u6c42\u5bfc\u5229\u7528 $(\\frac {F(x)}{G(x)})'=\\frac {F'(x)G(x)-F(x)G'(x)}{G^2(x)}$ \u5373\u53ef\u3002\r\n\r\n\u5177\u4f53\u6765\u8bf4\uff0c\u8ba1\u7b97\u8fd9\u4e2a\u4e1c\u897f\uff1a\r\n$$(\\frac {F(x)}{(1-x)^y})'$$\r\n\u6211\u4eec\u77e5\u9053 $(F^k(x))'=kF^{k-1}(x)F'(x)$\uff1a\r\n$$\\frac {F'(x)(1-x)^y+yF(x)(1-x)^{y-1}}{(1-x)^{2y}}$$\r\n$$\\frac {F'(x)(1-x)+yF(x)}{(1-x)^{y+1}}$$\r\n\u7b54\u6848\u662f\u7c7b\u4f3c $\\frac {F(x)}{(1-x)^{k+1}}$ \u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u53c8\u77e5\u9053 $\\frac 1 {(1-x)^{k+1}}=\\sum_{i=0}^{\\infty}\\binom {i+k}ix^i$\uff0c\u76f4\u63a5\u5377\u5c31\u597d\u4e86\u3002\r\n\r\n\u74f6\u9888\u5728\u9012\u63a8\uff0c\u590d\u6742\u5ea6 $O(k^2)$\u3002\r\n\r\n\u522b\u5fd8\u8bb0\u6700\u540e\u8981\u4e58\u4e0a\u4e00\u4e2a\u9636\u4e58\u3002\r\n```cpp\r\n#include<cstdio>\r\ntypedef unsigned ui;\r\nconst ui M=505;\r\nui n,k,mod,f[M<<1],C[M<<1];\r\ninline ui pow(ui a,ui b){\r\n\tui ans(1);for(a%=mod;b;b>>=1,a=1ull*a*a%mod)if(b&1)ans=1ull*ans*a%mod;return ans;\r\n}\r\nsigned main(){\r\n\tui i,j,inx,ans(0);scanf(\"%u%u%u\",&k,&n,&mod);C[inx=2*n+1>k?k:2*n+1]=f[0]=1;\r\n\tfor(i=1;i<=n;f[1]=f[0],f[0]=0,++i)for(j=i*2;j>=2;--j)f[j]=(1ull*f[j-1]*j+f[j-2]*(2ull*i-j))%mod;\r\n\tif(inx==2*n+1)for(i=1;i<=2*n;++i)C[inx]=1ull*C[inx]*(k-i)%mod*pow(i,mod-2)%mod;\r\n\tfor(i=inx-1;i<=2*n;--i)C[i]=C[i+1]*(k+2ull*n-i)%mod*pow(k-i,mod-2)%mod;\r\n\tfor(i=0;i<=n*2;++i)ans=(ans+1ull*C[i]*f[i])%mod;for(i=1;i<=n;++i)ans=1ull*ans*i%mod;\r\n\tprintf(\"%u\",ans);\r\n}\r\n```",
        "postTime": 1641971079,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u751f\u6210\u51fd\u6570 P4463\u9898\u89e3"
    },
    {
        "content": "## \u9898\u610f\n\u4e00\u4e2a\u5e8f\u5217$a_1,a_2,\\ldots,a_n$\u5408\u6cd5\uff0c\u5f53\u4e14\u4ec5\u5f53\uff1a\n- $\\forall i\\in[1,n],a_i\\in[1,k]$\n- $\\forall i\\not=j,a_i\\not=a_j$\n\n\u4e00\u4e2a\u5e8f\u5217\u7684\u503c\u4e3a\u5b83\u7684\u4e58\u79ef,\u5373$\\prod_{i=1}^na_i$\n\n\u7ed9\u5b9a$n,k$,\u6c42\u6240\u6709\u4e0d\u540c\u7684\u5e8f\u5217\u7684\u503c\u7684\u548c\u3002\n## \u9898\u89e3\n\u4e0d\u96be\u53d1\u73b0\u7b54\u6848\u53ef\u4ee5\u5199\u6210\u751f\u6210\u51fd\u6570\u7684\u5f62\u5f0f\uff1a\n$$F(x)=\\prod_{i=1}^k(1+ix)$$\n\u4f46\u6b64\u65f6\u662f\u65e0\u5e8f\u7684\uff0c\u56e0\u4e3a$a_1,a_2,\\ldots,a_n$\u4e92\u4e0d\u76f8\u7b49\uff0c\u4e58$n!$\u5373\u53ef\u3002\u6700\u540e\u7b54\u6848\u4e3a$n![x^n]F(x)$\n\n\u4e24\u8fb9\u540c\u53d6$\\ln$\u628a\u79ef\u53d8\u548c\u3002\n$$\\ln F(x)=\\sum_{i=1}^k\\ln(1+ix)$$\n\u5de6\u8fb9\u8fd9\u4e2a\u4e1c\u897f\u662f\u53ef\u4ee5\u5316\u4e3a\u591a\u9879\u5f0f\u7684\u3002\u5177\u4f53\u7684\uff1a\n$$\n\\begin{aligned}\n\\ln(1+ix)=&\\int(\\ln(1+ix))^\\prime dx\n&\\text{(\u6c42\u5bfc\u518d\u6c42\u539f)}\\\\\n=&\\int \\frac{i}{1+ix}dx\n&\\text{(\u590d\u5408\u51fd\u6570\u6c42\u5bfc)}\\\\\n=&\\int i\\sum_{j=0}^\\infty \n(-ix)^jdx\n&\\text{(\u8fd8\u539f\u7b49\u6bd4\u6570\u5217\u6c42\u548c)}\\\\\n=&\\int i\\sum_{j=0}^\\infty (-1)^ji^jx^jdx\n&\\text{(\u62c6\u62ec\u53f7)}\\\\\n=&\\sum_{j=0}^\\infty (-1)^ji^{j+1}\\int x^jdx\n&\\text{(\u4ea4\u6362\u6c42\u548c\u987a\u5e8f)}\\\\\n=&\\sum_{j=0}^\\infty (-1)^ji^{j+1}\\frac{x^{j+1}}{j+1}\n&\\text{(\u6c42\u539f\u51fd\u6570)}\\\\\n=&\\sum_{j=1}^\\infty(-1)^{j-1}i^j\\frac{x^j}{j}\n&\\text{(\u7528j-1\u66ff\u6362j)}\n\\end{aligned}\n$$\n\u4e8e\u662f\u4e4e\u5e26\u8fdb\u53bb\u3002\n$$\\ln F(x)=\\sum_{i=1}^k\\sum_{j=1}^\\infty(-1)^{j-1}i^j\\frac{x^j}{j}$$\n\u6574\u7406\u4e00\u4e0b\u4e0b\n$$\\sum_{j=1}^\\infty\\frac{(-1)^{j-1}}{j}(\\sum_{i=1}^ki^j)x^j$$\n\u8bb0$f_y(x)=\\sum_{i=1}^xi^y$\n$$\\sum_{j=1}^\\infty\\frac{(-1)^{j-1}}{j}f_j(k)x^j$$\n\u6839\u636e\u7ecf\u9a8c\u6211\u4eec\u77e5\u9053$f_y(x)=\\sum_{i=1}^xi^y$\u662f\u4e00\u4e2a\u5173\u4e8e$x$\u7684$y+1$\u6b21\u591a\u9879\u5f0f\uff0c\u53ef\u4ee5\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u5f97\u5230\u3002\n$$f(x)=\\sum_{i=0}^{n}y_i\\prod_{i\\not=j}\\frac{x-x_j}{x_i-x_j}$$\n\u6b64\u65f6\u6c42$f_y(x)$\u7684\u590d\u6742\u5ea6\u4e3a$\\mathcal{O}(y^2)$\uff0c\u4f46\u7531\u4e8e\u70b9\u662f\u6211\u4eec\u81ea\u5df1\u53d6\u7684\uff0c\u53d6\u8fde\u7eed\u7684\u70b9\u53ef\u4ee5\u505a\u5230$\\mathcal{O}(y)$\u3002\u6211\u4eec\u5df2\u77e5$i\\in[0,n]$\u65f6\u7684\u53d6\u503c$y_i$\uff0c\u90a3\u4e48\u9b54\u6539\u516c\u5f0f\uff1a\n$$f(k)=\\sum_{i=0}^ny_i\\prod_{i\\not=j}\\frac{k-j}{i-j}$$\n\u8bb0\n$$pre_i=\\prod_{j=0}^{i}k-j,suf_i=\\prod_{j=i}^nk-j$$\n\u6709\n$$f(k)=\\sum_{i=0}^ny_i\\frac{pre_{i-1}\\times suf_{i+1}}{i!(n-i)!(-1)^{n-i}}$$\n\u6ce8\u610f\u7b26\u53f7\u3002\n\n\u7b97\u51fa\u7cfb\u6570\u540e\u5728$\\exp$\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n\u7136\u540e\u5c31\u6709$\\mathcal{O}(n^2+n\\log n)$\u7684\u7b97\u6cd5\u4e86\u3002\n\n\u53ea\u4e0d\u8fc7\u9700\u8981`MTT`\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nnamespace in{\n\tchar buf[1<<21],*p1=buf,*p2=buf;\n\tinline int getc(){return p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++;}\n\ttemplate <typename T>inline void read(T& t){\n\t\tt=0;int f=0;char ch=getc();while (!isdigit(ch)){if(ch=='-')f = 1;ch=getc();}\n\t    while(isdigit(ch)){t=t*10+ch-48;ch = getc();}if(f)t=-t;\n\t}\n\ttemplate <typename T,typename... Args> inline void read(T& t, Args&... args){read(t);read(args...);}\n}\nnamespace out{\n\tchar buffer[1<<21];int p1=-1;const int p2 = (1<<21)-1;\n\tinline void flush(){fwrite(buffer,1,p1+1,stdout),p1=-1;}\n\tinline void putc(const char &x) {if(p1==p2)flush();buffer[++p1]=x;}\n\ttemplate <typename T>void write(T x) {\n\t\tstatic char buf[15];static int len=-1;if(x>=0){do{buf[++len]=x%10+48,x/=10;}while (x);}else{putc('-');do {buf[++len]=-(x%10)+48,x/=10;}while(x);}\n\t\twhile (len>=0)putc(buf[len]),--len;\n\t}\n}\ntypedef std::complex<double>complex;\nconst int N=4e6+10;const double PI=acos(-1);const complex I=complex(0,1);\nint rev[N];complex Wn[N];int M,mod;\nstruct modint{\n    int x;\n    modint(int o=0){x=o;}\n    modint &operator = (int o){return x=o,*this;}\n    modint &operator +=(modint o){return x=x+o.x>=mod?x+o.x-mod:x+o.x,*this;}\n    modint &operator -=(modint o){return x=x-o.x<0?x-o.x+mod:x-o.x,*this;}\n    modint &operator *=(modint o){return x=1ll*x*o.x%mod,*this;}\n    modint &operator ^=(int b){\n        modint a=*this,c=1;\n        for(;b;b>>=1,a*=a)if(b&1)c*=a;\n        return x=c.x,*this;\n    }\n    modint &operator /=(modint o){return *this *=o^=mod-2;}\n    modint &operator +=(int o){return x=x+o>=mod?x+o-mod:x+o,*this;}\n    modint &operator -=(int o){return x=x-o<0?x-o+mod:x-o,*this;}\n    modint &operator *=(int o){return x=1ll*x*o%mod,*this;}\n    modint &operator /=(int o){return *this *= ((modint(o))^=mod-2);}\n\ttemplate<class I>friend modint operator +(modint a,I b){return a+=b;}\n    template<class I>friend modint operator -(modint a,I b){return a-=b;}\n    template<class I>friend modint operator *(modint a,I b){return a*=b;}\n    template<class I>friend modint operator /(modint a,I b){return a/=b;}\n    friend modint operator ^(modint a,int b){return a^=b;}\n    friend bool operator ==(modint a,int b){return a.x==b;}\n    friend bool operator !=(modint a,int b){return a.x!=b;}\n    bool operator ! () {return !x;}\n    modint operator - () {return x?mod-x:0;}\n\tmodint &operator++(int){return *this+=1;}\n};\ninline long long num(complex x){double d=x.real();return d<0?(long long)(d-0.5)%mod:(long long)(d+0.5)%mod;}\nstruct poly{\n\tstd::vector<complex>a0,a1;\n\tint size(){return a0.size();}\n    void resize(int n){a0.resize(n);a1.resize(n);}\n\tvoid set(int x,modint y){\n\t\ta0[x]=y.x/M;\n\t\ta1[x]=y.x%M;\n\t}\n\tlong long get(int x){return (M*M*num(a0[x].real())%mod +\n\t\t\t\tM*(num(a0[x].imag())+num(a1[x].real()))%mod+num(a1[x].imag()))%mod;}\n\tmodint val(int x){return (long long)(M*a0[x].real()+a1[x].real()+mod)%mod;}\n};\npoly operator+(poly a,poly b){\n    int n=std::max(a.size(),b.size());a.resize(n),b.resize(n);\n    for(int i=0;i<n;i++)a.set(i,a.val(i)+b.val(i));return a;\n}\npoly operator-(poly a,poly b){\n    int n=std::max(a.size(),b.size());a.resize(n),b.resize(n);\n    for(int i=0;i<n;i++)a.set(i,a.val(i)-b.val(i));return a;\n}\ninline poly one(){poly a;a.resize(1);a.set(0,1);return a;}\ninline int ext(int n){int k=0;while((1<<k)<n)k++;return k;}\ninline void init(int k){\n\tint n=1<<k;\n\tfor(int i=0;i<n;i++)\n\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<(k-1));\n\tfor(int i=0;i<n;i++)\n\t\tWn[i]={cos(PI/n*i),sin(PI/n*i)};\n}\nvoid FFT(std::vector<complex>&A,int n,int t){\n\tif(t<0)for(int i=1;i<n;i++)if(i<(n-i))std::swap(A[i],A[n-i]);\n\tfor(int i=0;i<n;i++)\n\t\tif(i<rev[i])std::swap(A[i],A[rev[i]]);\n\tfor(int m=1;m<n;m<<=1)\n\t\tfor(int i=0;i<n;i+=m<<1)\n\t\t\tfor(int k=i;k<i+m;k++){\n\t\t\t\tcomplex W=Wn[1ll*(k-i)*n/m];\n\t\t\t\tcomplex a0=A[k],a1=A[k+m]*W;\n\t\t\t\tA[k]=a0+a1;A[k+m]=a0-a1; \n\t\t\t}\n\tif(t<0)for(int i=0;i<n;i++)A[i]/=n;\n}\nvoid MTT(poly &A,int n,int t){\n\tfor(int i=0;i<n;i++)A.a0[i]=A.a0[i]+I*A.a1[i];\n\tFFT(A.a0,n,t);\n\tfor(int i=0;i<n;i++)A.a1[i]=std::conj(A.a0[i?n-i:0]);\n\tfor(int i=0;i<n;i++){\n\t\tcomplex p=A.a0[i],q=A.a1[i];\n\t\tA.a0[i]=(p+q)*0.5;A.a1[i]=(q-p)*0.5*I;\n\t}\n}\ninline poly operator*(poly a,poly b){\n    int n=a.size()+b.size()-1,k=ext(n);\n    a.resize(1<<k),b.resize(1<<k),init(k);\n    MTT(a,1<<k,1);MTT(b,1<<k,1);\n\tfor(int i=0;i<(1<<k);i++){\n\t\tcomplex p=a.a0[i]*b.a0[i]+I*a.a1[i]*b.a0[i];\n\t\tcomplex q=a.a0[i]*b.a1[i]+I*a.a1[i]*b.a1[i];\n\t\ta.a0[i]=p,a.a1[i]=q;\n\t}\n    FFT(a.a0,1<<k,-1);FFT(a.a1,1<<k,-1);a.resize(n);\n\tlong long tmp;for(int i=0;i<n;i++)\n\t\ttmp=a.get(i),a.set(i,tmp);\n\treturn a;\n}\ninline poly deriv(poly a){//\u6c42\u5bfc \n    int n=a.size()-1;\n    for(int i=0;i<n;i++)a.set(i,a.val(i+1)*(i+1));\n    a.resize(n);return a;\n}\ninline poly inter(poly a){//\u6c42\u539f \n    int n=a.size()+1;a.resize(n);\n    for(int i=n;i>=1;i--)a.set(i,a.val(i-1)/i);\n    a.set(0,0);return a;\n}\npoly inv(poly F,int k){\n    int n=1<<k;F.resize(n);\n    if(n==1){F.set(0,modint(1)/F.val(0));return F;}\n    poly G,H=inv(F,k-1);\n    G.resize(n),H.resize(n<<1),F.resize(n<<1);\n    for(int i=0;i<n/2;i++)G.set(i,H.val(i)*2);\n    H=H*H;H.resize(n);H=H*F;H.resize(n);\n    G=G-H;return G;\n}\ninline poly inv(poly a){\n    int n=a.size();\n    a=inv(a,ext(n)),a.resize(n);return a;;\n}\ninline poly ln(poly a){\n    int n=a.size();\n    a=inter(deriv(a)*inv(a));\n    a.resize(n);return a;\n}\npoly exp(poly a,int k){\n\tint n=1<<k;a.resize(n);\n\tif(n==1)return one();\n\tpoly f0=exp(a,k-1);f0.resize(n);\n\treturn f0*(one()+a-ln(f0)); \n}\npoly exp(poly a){\n\tint n=a.size();\n\ta=exp(a,ext(n));a.resize(n);return a;\n}\nmodint y[1000];\nmodint *pre,*suf;modint aaa[2000];\nmodint fac[1000],ifac[1000];\nmodint get(int n,int k){\n\t//\u8ba1\u7b97\\sum_{i=1}^k i^n \u663e\u7136\u4e3a\u4e00\u4e2an+1\u6b21\u7684\u591a\u9879\u5f0f \u9700\u8981n+2\u4e2a\u70b9 \n\tmodint sum=0;\n\tfor(int i=0;i<=n+1;i++,sum+=(modint(i)^n))y[i]=sum;\n\tn=n+1;pre[-1]=suf[n+1]=1;\n\tfor(int i=0;i<=n;i++)pre[i]=pre[i-1]*(k-i);\n\tfor(int i=n;i>=0;i--)suf[i]=suf[i+1]*(k-i);\n\tsum=0;\n\tfor(int i=0;i<=n;i++)\n\t\tif((n-i)&1)sum-=y[i]*pre[i-1]*suf[i+1]*ifac[i]*ifac[n-i];\n\t\telse sum+=y[i]*pre[i-1]*suf[i+1]*ifac[i]*ifac[n-i];\n\treturn sum;\n}\nint n,k;\nsigned main(){\n\tin::read(k,n,mod);M=sqrt(mod);\n\tpre=&aaa[10];suf=&aaa[1010];ifac[0]=fac[0]=1;for(int i=1;i<1000;i++)fac[i]=fac[i-1]*i,ifac[i]=modint(1)/fac[i];\n\tpoly F;F.resize(n+1);\n\tfor(int i=1;i<=n;i++)\n\t\tif((i+1)&1)F.set(i,-get(i,k)/i);\n\t\telse F.set(i,get(i,k)/i);\n\t//for(int i=0;i<=n;i++)printf(\"%d \",F.val(i).x);puts(\"\");\n\tF=exp(F);out::write((F.val(n)*fac[n]).x);\n\tout::flush();\n\treturn 0;\n}\n```",
        "postTime": 1610170358,
        "uid": 174304,
        "name": "jun\u5934\u5409\u5409",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4463 \u3010[\u96c6\u8bad\u961f\u4e92\u6d4b2012] calc\u3011"
    },
    {
        "content": "\u4e0d\u59a8\u5148\u7b97\u51fa\u6570\u5217\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u540e\u7684\u7b54\u6848\uff0c\u518d\u4e58\u4e0a $n!$ \u5373\u4e3a\u6700\u7ec8\u7b54\u6848\n\n\u8bbe $f_i(j)$ \u8868\u793a\u524d $i$ \u4e2a\u6570\uff0c\u9009\u62e9\u7684\u6700\u5927\u7684\u6570\u4e0d\u8d85\u8fc7 $j$ \u7684\u7b54\u6848\uff0c\u5219\u6700\u7ec8\u7b54\u6848\u4e3a $n!\\cdot f_n(k)$\n\n\u5bb9\u6613\u5199\u51fa\u8f6c\u79fb\u65b9\u7a0b\uff1a$f_i(j)=j\\cdot f_{i-1}(j-1)+f_i(j)$\n\n\u590d\u6742\u5ea6\u662f $O(nk)$ \u7684\n\n\u8bbe $g_i(j)=f_i(j)-f_i(j-1)$\uff0c\u5bb9\u6613\u770b\u51fa\uff0c$g_i$ \u662f $f_i$ \u7684\u5dee\u5206\u6570\u7ec4\uff0c$g_i(j)$ \u8868\u793a\u8003\u8651\u524d $i$ \u4e2a\u6570\uff0c\u6700\u5927\u7684\u6570\u4e3a $j$ \u7684\u7b54\u6848\n\n\u5219\u5bf9\u4e8e $g$ \u7684\u8f6c\u79fb\u65b9\u7a0b\u4e3a $g_i(j)=j\\cdot \\sum\\limits_{k=0}^{j-1}g_{i-1}(k)$\n\n\u7ffb\u8bd1\u8fc7\u6765\u5373\u4e3a\uff1a$g_i(j)$ \u7684\u6bcf\u4e00\u9879\u662f $g_{i-1}$ \u7684\u524d\u7f00\u548c\u4e58\u4e0a $j$\uff0c\u5219\u5bb9\u6613\u53d1\u73b0\uff0c$g_i$ \u7684\u6b21\u6570\u6bd4 $g_{i-1}$ \u591a $2$\n\n\u7531\u4e8e $g_0$ \u7684\u6b21\u6570\u4e3a 0\uff0c\u5219 $g_n$ \u7684\u6b21\u6570\u4e3a $2n$\uff0c\u7531\u4e8e $g_n$ \u662f $f_n$ \u7684\u5dee\u5206\u6570\u7ec4\uff0c\u5219 $f_n$ \u7684\u6b21\u6570\u4e3a $2n+1$\uff0c\u62c9\u683c\u6717\u65e5\u63d2\u503c\u5373\u53ef\uff0c\u53ef\u4ee5\u505a\u5230 $O(n)$\n\n```cpp\nconst int N = 1010;\nint k,n,m;\nll f[N][N],y[N];\nll pre[N],suf[N],fac[N],ifac[N];\nll Lang(ll k)\n{\n\tif(k <= m) return f[n][k];\n\tsuf[m + 1] = 1,pre[0] = k;\n\tifac[m] = qpow(fac[m],mod - 2);for(int i = m;i;i--) ifac[i - 1] = ifac[i] * i % mod;\n\tfor(int i = 1;i <= m;i++) pre[i] = pre[i - 1] * (k - i) % mod;\n\tfor(int i = m;~i;i--) suf[i] = suf[i + 1] * (k - i) % mod;\n\tll ans = 0;\n\tfor(int i = 0;i <= m;i++)\n\t\tans = (ans + y[i] * (i == 0 ? 1 : pre[i - 1]) % mod * suf[i + 1] % mod\n\t\t\t * ifac[i] % mod * ((m - i & 1) ? mod - 1 : 1) % mod * ifac[m - i] % mod) % mod;\n\treturn ans;\n}\nint main()\n{\n\tk = read(),n = read(),mod = read();\n\tm = 2 * n + 1;\n\tfor(int i = 0;i <= m;i++) f[0][i] = 1;\n\tfor(int i = 1;i <= n;i++)\n\t\tfor(int j = 1;j <= m;j++)\n\t\t\tf[i][j] = (f[i - 1][j - 1] * j + f[i][j - 1]) % mod;\n\tfor(int i = 1;i <= m;i++)\n\t\ty[i] = f[n][i];\n\tfac[0] = 1;for(int i = 1;i <= m;i++) fac[i] = fac[i - 1] * i % mod;\n\tll ans = Lang(k);\n\tfprint(ans * fac[n] % mod);\n}\n```",
        "postTime": 1593955127,
        "uid": 53994,
        "name": "81179332_",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4463 \u3010[\u96c6\u8bad\u961f\u4e92\u6d4b2012] calc\u3011"
    },
    {
        "content": "[\u9898\u9762](https://www.luogu.org/problemnew/show/P4463)\n\n\u62c9\u683c\u6717\u65e5\u63d2\u503c\u3002\n\n\u9996\u5148\u63a8\u51fa\u4e00\u4e2a$DP$\u3002\n\n$dp[i][j]$\u8868\u793a\u5f53\u524d\u5339\u914d\u5230\u7b2c$i$\u4e2a\u6570\uff0c\u4e58\u79ef\u7684\u503c\u57df\u5728$[1,...,j]$\u3002\u8f6c\u79fb\u65b9\u7a0b\u4e5f\u5f88\u663e\u7136\uff0c$dp[i][j]$=$dp[i-1][j-1]*i*j+dp[i][j-1]$\u3002\u7136\u540e\u53d1\u73b0$A$\u592a\u5927\u4e86\uff0c\u7136\u540e\u4ed4\u7ec6\u89c2\u5bdf\u5f0f\u5b50\u3002\u6211\u4eec\u5047\u8bbe$dp[i][j]$\u4e3a\u4e00\u4e2a\u6700\u9ad8\u6b21\u4e3a$2*i$\u5173\u4e8e$j$\u7684\u591a\u9879\u5f0f\uff0c\u90a3\u4e48$dp[i+1][j]$=$dp[i][j]*i*j+dp[i+1][j]$\uff0c$dp[i][j]*i*j$\u662f\u6700\u9ad8\u6b21\u4e3a$2*i+1$\u5173\u4e8e$j$\u7684\u591a\u9879\u5f0f\uff0c$dp[i+1][j]$\u662f\u6700\u9ad8\u6b21\u4e3a$2*(i+1)$\u5173\u4e8e$j$\u7684\u591a\u9879\u5f0f\uff0c\u53ef\u89c1$dp[i+1][j]$\u662f\u6700\u9ad8\u6b21\u4e3a$2*(i+1)$\u5173\u4e8e$j$\u7684\u591a\u9879\u5f0f\u3002\u6240\u4ee5\u5f97\u51fa$dp[n][A]$\u662f\u6700\u9ad8\u6b21\u4e3a$n*2$\u5173\u4e8e$A$\u7684\u591a\u9879\u5f0f\u3002\u6240\u4ee5\u76f4\u63a5\u62c9\u683c\u6717\u65e5\u63d2\u503c\u5c31\u597d\u4e86\u3002\n\ncode\uff1a\n```\n//2018.10.11 by ljz\n#include<bits/stdc++.h>\nusing namespace std;\n#define res register int\n#define LL long long\n#define inf 0x3f3f3f3f\n#define eps 1e-15\ninline int read(){\n    res s=0;\n    bool w=0;\n    char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch=='-')w=1;ch=getchar();}\n    while(ch>='0'&&ch<='9')s=s*10+ch-'0',ch=getchar();\n    return w?-s:s;\n}\ninline void _swap(res &x,res &y){\n    x^=y^=x^=y;\n}\ninline int _abs(const res &x){\n    return x>0?x:-x;\n}\ninline int _max(const res &x,const res &y){\n    return x>y?x:y;\n}\ninline int _min(const res &x,const res &y){\n    return x<y?x:y;\n}\nconst int N=5e2+10;\nnamespace MAIN{\n    int A,n,kcz;\n    int dp[N][N<<1];\n    int ans;\n    inline int qpow(res x,res y){\n        res ret=1;\n        while(y){\n            if(y&1)ret=1LL*ret*x%kcz;\n            y>>=1,x=1LL*x*x%kcz;\n        }\n        return ret%kcz;\n    }\n    inline void add(res &x,const res &y){\n        x+=y;\n        x>=kcz?x-=kcz:1;\n        x<0?x+=kcz:1;\n    }\n    inline int calc(const res &x){\n        res tmp=1,ret=0,p=((n<<1)&1)?kcz-1:1;\n        for(res i=1;i<=n<<1;i++)tmp=1LL*tmp*(x-i)%kcz*qpow(i,kcz-2)%kcz;\n        for(res i=0;i<=n<<1;i++,p=kcz-p)\n            add(ret,1LL*p*dp[n][i]%kcz*tmp%kcz),tmp=1LL*tmp*(x-i)%kcz*qpow(x-i-1,kcz-2)%kcz*((n<<1)-i)%kcz*qpow(i+1,kcz-2)%kcz;\n        return ret;\n    }\n    inline void MAIN(){\n        A=read(),n=read(),kcz=read();\n        for(res i=0;i<=n<<1;i++)dp[0][i]=1;\n        for(res i=1;i<=n;i++)\n            for(res j=1;j<=n<<1;j++)\n                dp[i][j]=(1LL*dp[i-1][j-1]*i*j%kcz+dp[i][j-1])%kcz;\n        if(A<=n<<1)printf(\"%d\\n\",dp[n][A]);\n        else printf(\"%d\\n\",calc(A));\n    }\n}\nint main(){\n    MAIN::MAIN();\n    return 0;\n}\n```",
        "postTime": 1539246662,
        "uid": 32878,
        "name": "foreverlasting",
        "ccfLevel": 7,
        "title": "\u3010\u56fd\u5bb6\u96c6\u8bad\u961f\u3011calc"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u79cd\u5168\u65b0\u7684\u601d\u8def\uff0c\u7075\u611f\u6765\u81ea\u4e8e AK \u4e86\u5341\u5e74 IOI \u7684\u718a\u718a\u718a\u5927\u5e05\u54e5\u3002\n\n\u718a\u718a\u718a\u5927\u5e05\u54e5\u7684 blog\uff1a[\u4f20\u9001\u95e8](https://www.cnblogs.com/ustze/p/16578275.html)\n\n\u8003\u8651\u5bb9\u65a5\uff0c\u81ea\u7136\u7684\u60f3\u6cd5\u662f\u679a\u4e3e\u4e00\u4e2a\u96c6\u5408\u94a6\u5b9a\u5168\u90e8\u76f8\u7b49\uff0c\u4f46\u662f\u8fd9\u6837\u6211\u4eec\u5e76\u4e0d\u77e5\u9053\u6bcf\u4e2a\u72b6\u6001\u7684\u5bb9\u65a5\u7cfb\u6570\u662f\u4ec0\u4e48\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u8fd9\u91cc\u7684\u5bb9\u65a5\u7cfb\u6570\u5230\u5e95\u662f\u4ec0\u4e48\u3002\n\n\u628a\u95ee\u9898\u62bd\u8c61\u5230\u4e00\u4e2a $n$ \u4e2a\u70b9\u7684\u56fe\u4e0a\uff0c\u5982\u679c $a_i=a_j$ \u6211\u4eec\u5c31\u5728 $i,j$ \u4e4b\u95f4\u8fde\u8fb9\u3002\n\n\u6362\u4e00\u79cd\u601d\u8def\u5bb9\u65a5\uff0c\u6211\u4eec\u8003\u8651\u679a\u4e3e\u4e00\u4e2a\u8fb9\u96c6 $E$\uff0c\u94a6\u5b9a $E$ \u4e2d\u7684\u8fb9\u90fd\u8fde\uff0c\u8bb0 $f(S)$ \u8868\u793a $S$ \u4e2d\u5143\u7d20\u5168\u90e8\u76f8\u7b49\u7684\u5143\u7d20\u548c\uff0c\u4ed6\u5177\u4f53\u662f\u4ec0\u4e48\u6211\u4eec\u7559\u5230\u7a0d\u540e\u8003\u8651\uff0c\u8bb0 $C(E)$ \u4e3a\u8fde\u4e0a $E$ \u4e2d\u8fb9\u540e\u5f62\u6210\u7684\u8054\u901a\u5757\u96c6\u5408\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u6240\u6709\u6ee1\u8db3\u6761\u4ef6\u7684\u5e8f\u5217\u7684\u6743\u503c\u548c\u4e3a $\\sum\\limits_{E}(-1)^{|E|}\\prod\\limits_{S\\in C(E)}f(S)$\u3002\n\n\u8fd9\u4e2a\u65f6\u5019\u518d\u8003\u8651\u6bcf\u4e2a $C(E)$ \u7684\u8d21\u732e\uff0c\u53ef\u4ee5\u5f97\u5230 $\\sum\\limits_P(\\prod\\limits_{S\\in P}f(S))(\\sum\\limits_E[C(E)=P](-1)^{|E|})$\uff0c\u6ce8\u610f\u5230\u524d\u9762\u7684\u90e8\u5206\u5df2\u7ecf\u548c $E$ \u6ca1\u6709\u5173\u7cfb\u4e86\uff0c\u6211\u4eec\u53ea\u8981\u5bf9\u6bcf\u4e2a $P$ \u5feb\u901f\u6c42\u51fa\u540e\u9762\u62ec\u53f7\u7684\u7b54\u6848\u3002\n\n\u8bb0 $g(S)$ \u8868\u793a\u6240\u6709\u8ba9 $S$ \u8054\u901a\u7684\u8fde\u8fb9\u65b9\u6848 $E$ \u7684 $(-1)^{|E|}$ \u7684\u548c\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u7ee7\u7eed\u5316\u7b80\u5f97\u5230 $\\sum\\limits_P\\prod\\limits_{S\\in P}f(S)g(S)$\uff0c\u56e0\u4e3a\u6bcf\u6761\u8fb9\u7684\u8d21\u732e\u90fd\u662f $-1$\u3002\n\n\u518d\u6c42 $g(S)$\uff0c\u8bbe $h(S)$ \u8868\u793a $S$ \u5185\u90e8\u968f\u610f\u8fde\u8fb9\u7684\u5bb9\u65a5\u7cfb\u6570\u548c\uff0c$F(k)$ \u8868\u793a\u94a6\u5b9a\u628a $S$ \u5212\u5206\u6210 $k$ \u4e2a\u8054\u901a\u5757\uff0c\u8fde\u901a\u5757\u4e4b\u95f4\u4e0d\u8fde\u8fb9\u7684\u65b9\u6848\u7684\u5bb9\u65a5\u7cfb\u6570\u548c\uff0c$G(k)$ \u662f\u6070\u597d\u628a $S$ \u5212\u5206\u6210 $k$ \u4e2a\u8054\u901a\u5757\uff0c\u8fde\u901a\u5757\u4e4b\u95f4\u4e0d\u8fde\u8fb9\u7684\u65b9\u6848\u7684\u5bb9\u65a5\u7cfb\u6570\u548c\uff0c\u663e\u7136\u6709 $g(S)=G(1)$\u3002\n\n\u901a\u8fc7\u65af\u7279\u6797\u53cd\u6f14\u6765\u53bb\u6389\u8054\u901a\u7684\u9650\u5236\uff0c\u6709 $F(k)=\\sum\\limits_P[|P|=k]\\prod\\limits_{S\\in P}h(S)=\\sum\\limits_{i=k}^nS_2(i,k)G(i)$\uff0c\u5176\u4e2d $S_2$ \u662f\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u5f97\u5230 $G(k)=\\sum\\limits_{i=k}^n(-1)^{i-k}S_1(i,k)F(i)$\uff0c$S_1$ \u662f\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570\u3002\n\n\u6ce8\u610f\u5230\u5982\u679c\u96c6\u5408\u5212\u5206\u4e2d\u5b58\u5728\u4e00\u4e2a\u8054\u901a\u5757\u7684\u5927\u5c0f $\\geq 2$\uff0c\u90a3\u4e48\u6211\u4eec\u968f\u610f\u8fde\u8fb9\u7684\u65f6\u5019\u4efb\u9009\u4e00\u6761\u8fb9\u53d6\u53cd\u5c31\u53ef\u4ee5\u5c06\u6240\u6709\u8fde\u8fb9\u65b9\u6848\u4e24\u4e24\u914d\u5bf9\uff0c\u4e14\u6bcf\u4e00\u5bf9\u5947\u5076\u6027\u4e0d\u540c\uff0c\u6b64\u65f6 $h(S)=0$\u3002\n\n\u552f\u4e00 $h(S)\\neq 0$ \u7684\u60c5\u51b5\u662f\u6240\u6709\u8054\u901a\u5757\u5927\u5c0f\u90fd\u662f $1$\uff0c\u4e5f\u5c31\u662f\u94a6\u5b9a\u5212\u5206\u6210 $|S|$ \u4e2a\u8054\u901a\u5757\uff0c\u6b64\u65f6\u663e\u7136\u53ea\u6709\u4e00\u79cd\u8fde\u8fb9\u65b9\u6848\u5c31\u662f\u4ec0\u4e48\u4e5f\u4e0d\u8fde\uff0c\u56e0\u6b64\u8fd9\u65f6 $h(S)=1$\uff0c\u4ee3\u5165\u53ef\u4ee5\u5f97\u5230 $g(S)=G(1)=(-1)^{|S|-1}S_1(|S|,1)=(-1)^{|S|-1}(|S|-1)!$\u3002\n\n\u518d\u628a $g(S)$ \u5e26\u56de\u539f\u5f0f\uff0c\u53ef\u4ee5\u5f97\u5230\u8981\u6c42\u7b54\u6848\u5c31\u662f $\\sum\\limits_P\\prod\\limits_{S\\in P}f(S)(-1)^{|S|-1}(|S|-1)!$\u3002\n\n\u518d\u6765\u8003\u8651 $f(S)$\uff0c\u5728\u672c\u9898\u4e2d\u5373\u4e3a $\\sum\\limits_{i=1}^mi^{|S|}$\uff0c\u8fd9\u662f\u7ecf\u5178\u7684\u81ea\u7136\u6570\u5e42\u524d\u7f00\u548c\uff0c\u53ef\u4ee5\u62c9\u63d2\u5728 $O(|S|\\log |S|)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u6c42\u51fa\u3002\n\n\u4e8e\u662f\u76f4\u63a5\u679a\u4e3e\u5b50\u96c6\u8f6c\u79fb\u53ef\u4ee5\u505a\u5230 $O(3^n)$ \u663e\u7136\u662f\u8fc7\u4e0d\u53bb\u7684\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u4e8b\u5b9e\u4e0a\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u5143\u7d20\u5e76\u6ca1\u6709\u672c\u8d28\u7684\u533a\u522b\uff0c\u6211\u4eec\u5148\u5bf9\u65e0\u6807\u53f7\u5e8f\u5217\u8ba1\u6570\u5373\u53ef\u3002\n\n\u8003\u8651\u76f4\u63a5\u679a\u4e3e\u96c6\u5408\u5212\u5206\uff0c\u8bb0 $dp_{i,j}$ \u8868\u793a\u8003\u8651\u4e86\u5212\u5206\u4e2d\u6240\u6709\u5927\u5c0f $\\leq i$ \u7684\u96c6\u5408\uff0c\u548c\u4e3a $j$ \u7684\u6743\u503c\u548c\uff0c\u8f6c\u79fb\u7684\u65f6\u5019\u679a\u4e3e\u6709\u591a\u5c11\u4e2a\u96c6\u5408\u5927\u5c0f\u6070\u597d\u662f $i$ \u7136\u540e\u76f4\u63a5\u6309\u7167\u4e0a\u9762\u7684\u5f0f\u5b50\u8f6c\u79fb\u3002\u4f46\u662f\u8fd9\u6837\u4f1a\u7b97\u91cd\uff0c\u56e0\u4e3a\u540c\u6837\u5927\u5c0f\u7684\u96c6\u5408\u5728\u5212\u5206\u4e2d\u5b9e\u9645\u4e0a\u662f\u4e0d\u533a\u5206\u7684\uff0c\u56e0\u6b64\u5982\u679c\u6709 $k$ \u4e2a\u5927\u5c0f\u662f $i$ \u7684\u96c6\u5408\uff0c\u7cfb\u6570\u8981\u591a\u4e00\u4e2a $\\frac1{k!}$\uff0c\u8fd9\u6837\u76f4\u63a5\u8f6c\u79fb\u662f $O(\\sum\\limits_{i=1}^n\\sum\\limits_{j=1}^n\\frac ij)=O(n^2\\ln n)$ \u7684\uff0c\u524d\u9762\u63d2\u503c\u9700\u8981\u505a $n$ \u6b21\u590d\u6742\u5ea6\u4e5f\u662f $O(n^2\\log n)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\nusing namespace std;\ninline void init()\n{\n    ios::sync_with_stdio(0);\n    cin.tie(0);\n}\ninline int read()\n{\n    int x;\n    cin>>x;\n    return x;\n}\nconst int m=read(),n=read(),mod=read();\nint dp[501][501],fac[501],inv[501],sum[501],pre[505],suf[505];\ninline int pw(int a,int b)\n{\n    int res=1;\n    while(b)\n    {\n        if(b&1)\n            res=1ll*res*a%mod;\n        b>>=1;\n        a=1ll*a*a%mod;\n    }\n    return res;\n}\ninline int c(int x,int y)\n{\n    if(x<y||x<0||y<0)\n        return 0;\n    return 1ll*fac[x]*inv[y]%mod*inv[x-y]%mod;\n}\ninline int Mod(int x)\n{\n    return x>=mod? x-mod:x;\n}\ninline int calc(int cnt,int lim)\n{\n    pre[0]=suf[lim+1]=1;\n    for(int i=1;i<=lim;++i)\n        pre[i]=1ll*pre[i-1]*Mod(m-i+mod)%mod;\n    for(int i=lim;i>=1;--i)\n        suf[i]=1ll*suf[i+1]*Mod(m-i+mod)%mod;\n    int ans=0,tot=0;\n    for(int i=1;i<=lim;++i)\n    {\n        tot=Mod(tot+pw(i,cnt));\n        ans=Mod(ans+1ll*tot*pre[i-1]%mod*suf[i+1]%mod*inv[i-1]%mod*inv[lim-i]%mod*((lim-i)&1? mod-1:1)%mod);\n    }\n    return ans;\n}\nint main()\n{\n    init();\n    sum[0]=fac[0]=inv[0]=1;\n    for(int i=1;i<=n+2;++i)\n        fac[i]=1ll*fac[i-1]*i%mod;\n    inv[n+2]=pw(fac[n+2],mod-2);\n    for(int i=n+1;i>=1;--i)\n        inv[i]=1ll*inv[i+1]*(i+1)%mod;\n    for(int i=1;i<=n;++i)\n        sum[i]=calc(i,i+2);\n    dp[0][0]=1;\n    for(int i=1;i<=n;++i)\n        for(int j=0;j<=n;++j)\n        {\n            int w=1,val=1ll*inv[i]%mod*sum[i]%mod*(i&1? 1:mod-1)%mod*fac[i-1]%mod;\n            for(int k=0;i*k<=j;++k)\n            {\n                dp[i][j]=Mod(dp[i][j]+1ll*dp[i-1][j-i*k]*w%mod*inv[k]%mod);\n                w=1ll*w*val%mod;\n            }\n        }\n    cout<<1ll*fac[n]*dp[n][n]%mod<<'\\n';\n    cout.flush();\n    return 0;\n}\n```",
        "postTime": 1671632459,
        "uid": 85682,
        "name": "\u7edd\u9876\u6211\u4e3a\u5cf0",
        "ccfLevel": 8,
        "title": "P4463 [\u96c6\u8bad\u961f\u4e92\u6d4b 2012] calc \u9898\u89e3"
    },
    {
        "content": "$\\textbf{DP}$\u3002  \n\u8bb2\u9053\u7406\u6211\u8d85\u559c\u6b22\u8fd9\u9898\u7684\uff08  \n\u9996\u5148\u6211\u4eec\u770b\u5b50\u5e8f\u5217\u6570\u975e\u5e38\u591a\uff0c\u6211\u4eec\u8003\u8651\u7b97\u51fa $f_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u5185\u6700\u5927\u503c\u4e0d\u8d85\u8fc7 $j$ \u7684**\u9012\u589e\u5e8f\u5217**\u7684\u6743\u503c\u548c\uff0c\u7136\u540e\u6211\u4eec\u518d\u628a\u9012\u589e\u7684\u8f6c\u5316\u4e3a\u4efb\u610f\u7684\uff0c\u4e5f\u5c31\u662f\u4e58\u4e0a $n!$ \u5c31\u53ef\u4ee5\u4e86\u3002\u90a3\u4e48 $f_{i,j}$ \u600e\u4e48\u63a8\u5462\uff1f\u6709\u4e00\u4e2a\u663e\u7136\u7684\u9012\u63a8\u5f0f\u4e3a\uff1a\n$$f_{i,j}=f_{i,j-1}+f_{i-1,j-1}\\times j$$\n\u542b\u4e49\u5e94\u8be5\u4e0d\u96be\u7406\u89e3\u5427\uff0c\u4e0d\u591a\u89e3\u91ca\u4e86\uff08  \n\u90a3\u4e48\u8fd9\u4e2a\u4e1c\u897f\u7684\u8f6c\u79fb\u662f $\\text{O}(n\\times A)$ \u7684\uff0c\u663e\u7136\u590d\u6742\u5ea6\u70b8\u4e0a\u5929\uff0c\u90a3\u4e48\u600e\u4e48\u529e\u597d\u5462\uff1f\u6211\u4eec\u5bf9 $f_{n,i}$ \u8fdb\u884c\u8003\u8651\uff0c\u5b83\u662f\u7531 $f_{n,i-1}+f_{n-1,i-1}\\times i$ \u8f6c\u79fb\u8fc7\u6765\u7684\uff0c\u518d\u63a8\u4e00\u9879\uff0c\u4f1a\u53d1\u73b0 $f_{n,i}$ \u7684\u6700\u7ec8\u5c55\u5f00\u7684\u5f62\u5f0f\u957f\u5f97\u5f88\u50cf\u4e00\u4e2a\u5173\u4e8e $i$ \u7684\u591a\u9879\u5f0f\uff0c\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u786e\u5b9a\u82e5\u5e72\u4e2a\u70b9\u7684\u8bdd\uff0c\u5c31\u53ef\u4ee5\u5229\u7528 $\\textbf{Lagrange}$ **\u63d2\u503c\u6cd5** \u6765\u6c42\u51fa $f_{n,A}$ \u7684\u503c\u3002\u90a3\u4e48\u9996\u5148\u6211\u4eec\u8981\u786e\u5b9a\u7684\u662f\u8fd9\u4e2a\u591a\u9879\u5f0f\u7684\u6b21\u6570\u3002\u6211\u4eec\u53ef\u4ee5\u5047\u8bbe $f_{n,i}$ \u4e3a\u5173\u4e8e $i$ \u7684 $g_n$ \u6b21\u591a\u9879\u5f0f\uff0c\u4e00\u4e2a\u7ed3\u8bba\u662f\u5bf9\u4e8e $n$ \u6b21\u7684\u591a\u9879\u5f0f $h(x)$\uff0c$h(x)-h(x-1)$ \u7684\u6b21\u6570\u662f $n-1$ \u6b21\uff0c\u56e0\u4e3a\u5728\u8ba1\u7b97\u6700\u9ad8\u6b21\u7684\u65f6\u5019\uff0c\u4e24\u4e2a\u591a\u9879\u5f0f\u90fd\u4f1a\u51fa\u73b0\u5f62\u5982 $a\\times x^n$ \u7684\u5f62\u5f0f\uff0c\u76f8\u51cf\u5c31\u62b5\u6d88\u6389\u4e86\u3002\u6211\u4eec\u8003\u8651\u8fd9\u4e2a\u7ed3\u8bba\uff0c\u7136\u540e\u5bf9\u4e00\u5f00\u59cb\u7684\u9012\u63a8\u5f0f\u8fdb\u884c\u53d8\u5f62\uff0c\u5982\u4e0b\uff1a\n$$f_{n,i}-f_{n,i-1}=f_{n-1,i-1}\\times i$$\n\u5c06 $g_n$ \u4ee3\u5165\uff0c\u518d\u7528\u4e0a\u9762\u7684\u7ed3\u8bba\u5c31\u53ef\u4ee5\u5f97\u5230\uff1a\n$$g_n-1=g_{n-1}+1$$\n\u6ce8\u610f\u5230\u8fd9\u662f\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u7684\u683c\u5f0f\uff0c\u5219\u53ef\u4ee5\u5f97\u5230\u901a\u9879\u516c\u5f0f\uff1a\n$$g_n=n\\times 2$$\n\u6240\u4ee5 $f_{n,i}$ \u662f\u4e00\u4e2a\u5173\u4e8e $i$ \u7684 $n\\times2$ \u6b21\u591a\u9879\u5f0f\uff0c\u800c\u4e00\u4e2a $n\\times2$ \u6b21\u591a\u9879\u5f0f\u53ef\u4ee5\u7531 $n\\times2+1$ \u4e2a\u70b9\u6765\u786e\u5b9a\uff0c\u90a3\u4e48\u6211\u4eec\u76f4\u63a5\u5927\u529b\u6c42\u51fa $n\\times 2+1$ \u4e2a\u70b9\u7684\u503c\uff0c\u518d\u76f4\u63a5\u7528 $\\textbf{Lagrange}$ **\u63d2\u503c\u6cd5** \u5c31\u53ef\u4ee5\u5f97\u5230 $f_{n,A}$ \u7684\u503c\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define MAXN 505\n#define reg register\n#define inl inline\nusing namespace std;\nint A,n,Mod,a[MAXN],lim,f[MAXN][MAXN<<1],y[MAXN];\ninl int Add(reg int x,reg int y)\n{\n\treturn x+y>Mod?x+y-Mod:x+y;\n}\ninl int Del(reg int x,reg int y)\n{\n\treturn x-y<0?x-y+Mod:x-y;\n}\ninl int Mul(reg int x,reg int y)\n{\n\treturn 1ll*x*y-1ll*x*y/Mod*Mod;\n}\ninl int Pow(reg int x,reg int y)\n{\n\treg int res=1;\n\tfor(;y;y>>=1,x=Mul(x,x)) if(y&1) res=Mul(res,x);\n\treturn res;\n}\ninl int Lagrange(reg int x)\n{\n\tif(1<=x && x<=lim) return y[x];\n\treg int res=0;\n\tfor(reg int i=1;i<=lim;i++)\n\t{\n\t\treg int Up=1,Dn=1;\n\t\tfor(reg int j=1;j<=lim;j++)\n\t\t{\n\t\t\tif(i==j) continue;\n\t\t\tUp=Mul(Up,Del(x,j));\n\t\t\tDn=Mul(Dn,Del(i,j));\n\t\t}\n\t\tres=Add(res,Mul(y[i],Mul(Up,Pow(Dn,Mod-2))));\n\t}\n\treturn res;\n}\nint main()\n{\n\tscanf(\"%d %d %d\",&A,&n,&Mod);\n\tlim=(n<<1)+1;\n\tfor(reg int i=0;i<=lim;i++) f[0][i]=1;\n\tfor(reg int i=1;i<=n;i++)\n\t{\n\t\tfor(reg int j=1;j<=lim;j++) f[i][j]=Add(f[i][j-1],Mul(f[i-1][j-1],j));\n\t}\n\tfor(reg int i=1;i<=lim;i++) y[i]=f[n][i];\n\treg int ans=Lagrange(A);\n\tfor(reg int i=1;i<=n;i++) ans=Mul(ans,i);\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n\n\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u7528\u6a2a\u5750\u6807\u8fde\u7eed\u8fd9\u4e00\u7279\u70b9\u5bf9\u5176\u8fdb\u884c\u4f18\u5316\uff0c$\\textbf{Lagrange}$ **\u63d2\u503c\u6cd5** \u7684\u590d\u6742\u5ea6\u53ef\u4ee5\u4f18\u5316\u81f3 $n\\times2+1$\uff0c\u8fd0\u884c\u901f\u5ea6\u5feb\u4e86\u4e00\u500d\u4e0d\u6b62\u3002\n```cpp\n#include<bits/stdc++.h>\n#define MAXN 1005\n#define reg register\n#define inl inline\nusing namespace std;\nint A,n,Mod,a[MAXN],lim,f[MAXN][MAXN],y[MAXN],suf[MAXN],pre[MAXN],inv[MAXN];\ninl int Add(reg int x,reg int y)\n{\n\treturn x+y>Mod?x+y-Mod:x+y;\n}\ninl int Del(reg int x,reg int y)\n{\n\treturn x-y<0?x-y+Mod:x-y;\n}\ninl int Mul(reg int x,reg int y)\n{\n\treturn 1ll*x*y-1ll*x*y/Mod*Mod;\n}\ninl int Pow(reg int x,reg int y)\n{\n\treg int res=1;\n\tfor(;y;y>>=1,x=Mul(x,x)) if(y&1) res=Mul(res,x);\n\treturn res;\n}\ninl int Lagrange(reg int x)\n{\n\tif(1<=x && x<=lim) return y[x];\n\treg int res=0,prod=1;\n\tpre[0]=pre[lim+1]=suf[0]=suf[lim+1]=inv[0]=1;\n\tfor(reg int i=1;i<=lim;i++) pre[i]=Mul(pre[i-1],Del(A,i));\n\tfor(reg int i=lim;i>=1;i--) suf[i]=Mul(suf[i+1],Del(A,i));\n\tfor(reg int i=1;i<=lim;i++) prod=Mul(prod,i);\n\tinv[lim]=Pow(prod,Mod-2);\n\tfor(reg int i=lim-1;i>=1;i--) inv[i]=Mul(inv[i+1],i+1);\n\tfor(reg int i=1;i<=lim;i++)\n\t{\n\t\treg int x=Mul(y[i],Mul(pre[i-1],Mul(suf[i+1],Mul(inv[i-1],inv[lim-i]))));\n\t\tif((lim-i)&1) x=Del(Mod,x);\n\t\tres=Add(res,x);\n\t}\n\treturn res;\n}\nint main()\n{\n\tscanf(\"%d %d %d\",&A,&n,&Mod);\n\tlim=(n<<1)+1;\n\tfor(reg int i=0;i<=lim;i++) f[0][i]=1;\n\tfor(reg int i=1;i<=n;i++)\n\t{\n\t\tfor(reg int j=1;j<=lim;j++) f[i][j]=Add(f[i][j-1],Mul(f[i-1][j-1],j));\n\t}\n\tfor(reg int i=1;i<=lim;i++) y[i]=f[n][i];\n\treg int ans=Lagrange(A);\n\tfor(reg int i=1;i<=n;i++) ans=Mul(ans,i);\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1573046162,
        "uid": 23243,
        "name": "VenusM1nT",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4463 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f] calc\u3011"
    },
    {
        "content": "# \u9898\u76ee\n&emsp;&emsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/P4463)\u770b\u9898\u76ee\u3002   \n# \u5206\u6790   \n&emsp;&emsp;\u9996\u5148\u4e0d\u96be\u60f3\u5230\u53ef\u4ee5\u679a\u4e3e\u9012\u589e\u7684\u5e8f\u5217\uff0c\u6700\u540e\u5728\u7b54\u6848\u91cc\u9762\u4e58\u4e0a$n!$\uff0c\u4e8e\u662f\u6709$O(nk)$\u7684\u66b4\u529b DP \u4e00\u679a\uff1a   \n&emsp;&emsp;$f(i,j)$\u8868\u793a\u957f\u5ea6\u4e3a$i$\u3001\u6700\u5927\u503c$\\le j$\u7684\u5e8f\u5217\u7684\u8d21\u732e\u548c\u3002   \n&emsp;&emsp;\u8f6c\u79fb\u663e\u7136\uff1a   \n$$f(i,j)=j\\times f(i-1,j-1)+f(i,j-1)$$   \n&emsp;&emsp;\u90a3\u4e48\u53ef\u4ee5\u53d1\u73b0\uff0c\u5f53\u5e8f\u5217\u957f\u5ea6\u56fa\u5b9a\u7684\u65f6\u5019\uff0c$f(n,x)$\u80af\u5b9a\u662f\u5173\u4e8e$x$\u7684\u51fd\u6570\u3002\u73af\u987e\u56db\u5468\uff0cDP \u8f6c\u79fb\u65b9\u7a0b\u4e2d\u5e76\u4e0d\u5b58\u5728\u9664\u6cd5\u3001\u5f00\u65b9\u3001\u4f5c\u4e3a\u6307\u6570\u4e58\u65b9\u7b49\u8fd0\u7b97\uff0c\u6240\u4ee5\u53ef\u4ee5\u63a8\u6d4b$f(n,x)$\u5c31\u662f$x$\u7684\u591a\u9879\u5f0f\u51fd\u6570\u3002   \n&emsp;&emsp;\u90a3\u4e48\uff0c\u5b83\u7684\u6b21\u6570\u662f\u591a\u5c11\u5462\uff1f\u8fd9\u76f4\u63a5\u51b3\u5b9a\u4e86\u6211\u4eec\u5982\u4f55\u8fdb\u884c\u63d2\u503c\u3002\u8bbe$f(n,x)$\u7684\u6b21\u6570\u4e3a$g(n)$\uff0c\u8003\u8651\u5230\u8f6c\u79fb\u5de6\u53f3\u4e24\u8fb9\u7684\u6b21\u6570\u5e94\u8be5\u662f\u76f8\u7b49\u7684\uff0c\u5c31\u6709\uff1a   \n$$f(i,j)-f(i,j-1)=j\\times f(i-1,j-1)\\Rightarrow g(n)-1=g(n-1)+1$$   \n&emsp;&emsp;\u8865\u5145\u4e00\u4e0b\uff0c\u591a\u9879\u5f0f\u51fd\u6570\u505a\u5dee\u5206\uff0c\u5373$f(x)-f(x-1)$\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u7684\u6b21\u6570\u4f1a\u6bd4\u539f\u591a\u9879\u5f0f\u7684\u5c0f\u4e00\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00\u8bc1\u660e\u3002  \n&emsp;&emsp;\u7136\u540e\u53d1\u73b0\uff0c$g(n)=g(n-1)+2$\uff0c\u7531\u4e8e$f(0,x)=1$\uff0c\u6240\u4ee5$g(0)=0$\uff0c\u5f97\u5230\u901a\u9879\u516c\u5f0f$g(n)=2n$\u3002  \n&emsp;&emsp;\u7136\u540e\u6211\u4eec\u5c31\u77e5\u9053\u4e86$f(n,x)$\u662f\u5173\u4e8e$x$\u7684$2n$\u6b21\u7684\u591a\u9879\u5f0f\u51fd\u6570\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u7b97\u51fa$2n+1$\u4e2a\u70b9\u503c\uff0c\u7528\u4e8e\u63d2\u503c\u3002\u603b\u65f6\u95f4$O(n^2)$\u3002   \n```cpp\n#include <cstdio>\n\nconst int MAXN = 1005;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0;char s = getchar();int f = 1;\n\twhile( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n\twhile( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n\tif( 9 < x ){ write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\nint f[MAXN][MAXN], y[MAXN];\nint N, K, M, mod;\n\nint qkpow( int base, int indx )\n{\n\tint ret = 1;\n\twhile( indx )\n\t{\n\t\tif( indx & 1 ) ret = 1ll * ret * base % mod;\n\t\tbase = 1ll * base * base % mod, indx >>= 1;\n\t}\n\treturn ret;\n}\n\nint inver( const int a ) { return qkpow( a, mod - 2 ); }\nvoid add( int &x, const int v ) { x = ( x + v >= mod ? x + v - mod : x + v ); }\n\nint Lagrange()\n{\n\tif( K <= M ) return y[K];\n\tint ans = 0, tmp;\n\tfor( int i = 1 ; i <= M ; i ++ )\n\t{\n\t\ttmp = 1;\n\t\tfor( int j = 1 ; j <= M ; j ++ )\n\t\t\tif( i != j )\n\t\t\t\ttmp = 1ll * tmp * ( K - j ) % mod * inver( i - j + mod ) % mod;\n\t\tadd( ans, 1ll * tmp * y[i] % mod );\n\t}\n\treturn ans;\n}\n\nint main()\n{\n\tread( K ), read( N ), read( mod );\n\tM = 2 * N + 1;\n\tfor( int j = 0 ; j <= M ; j ++ )\n\t\tf[0][j] = 1; \n\tfor( int i = 1 ; i <= N ; i ++ )\n\t\tfor( int j = 1 ; j <= M ; j ++ )\n\t\t\tf[i][j] = ( 1ll * f[i - 1][j - 1] * j % mod + f[i][j - 1] ) % mod;\n\tfor( int i = 0 ; i <= M ; i ++ ) y[i] = f[N][i];\n\tint fac = 1; \n\tfor( int i = 1 ; i <= N ; i ++ ) fac = 1ll * fac * i % mod;\n\twrite( 1ll * fac * Lagrange() % mod ), putchar( '\\n' );\n\treturn 0;\n}\n```",
        "postTime": 1592145459,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[\u96c6\u8bad\u961f\u4e92\u6d4b]calc"
    },
    {
        "content": "WJMZBMR\u7684\u9898\u679c\u7136\u653e\u5728\u51e0\u5e74\u540e\u770b\u6765\u4ecd\u7136\u633a\u795e\uff0c\u63d0\u51fa\u4e86\u4e00\u79cd\u72ec\u7279\u7684\u4f18\u5316DP\u7684\u65b9\u5f0f\n\n\u9996\u5148\u6211\u4eec\u60f3\u4e00\u4e2a\u66b4\u529bDP\uff0c\u5148\u5b9a\u4e0b\u6240\u6709\u6570\u7684\u987a\u5e8f\uff08\u6bd4\u5982\u5f3a\u5236\u5b83\u9012\u589e\uff09\uff0c\u7136\u540e\u6700\u540e\u4e58\u4e0a$n!$\u79cd\u6392\u5217\u65b9\u5f0f\u5c31\u662f\u7b54\u6848\u4e86\n\n\u90a3\u4e48\u6211\u4eec\u5bb9\u6613\u60f3\u51fa\u4e00\u4e2aDP\uff0c\u4ee4$f_{i,j}$\u8868\u793a\u524d$i$\u4e2a\u6570\u4e2d\uff0c\u6700\u5927\u7684\u6570\u5c0f\u4e8e\u7b49\u4e8e$j$\u7684\u65b9\u6848\u6570\u662f\u591a\u5c11\n\n\u663e\u7136\u6709\u8f6c\u79fb\uff1a\n\n$$f_{i,j}=f_{i-1,j-1}\\times j+f_{i,j-1}$$\n\n\u4f46\u8fd9\u6837DP\u662f$O(nA)$\u7684\uff0c\u9700\u8981\u7528**\u62c9\u683c\u6717\u65e5\u63d2\u503c**\u8fdb\u884c\u4f18\u5316\uff0c\u4e0d\u4f1a\u62c9\u683c\u6717\u65e5\u63d2\u503c\u7684\u53ef\u4ee5\u770b\u4e00\u4e0b[\u6d45\u8c08\u62c9\u683c\u6717\u65e5\u63d2\u503c](https://www.cnblogs.com/cjjsb/p/11054853.html)\n\n\u5728\u91cc\u9762\u5c31\u63d0\u5230\u4e86\u63d2\u503c\u7684\u4e00\u4e2a\u5173\u952e\u70b9\u5c31\u662f\u6c42\u51fa\u7ed9\u5b9a\u591a\u9879\u5f0f\u7684\u6b21\u6570\u3002\u56e0\u6b64\u6211\u4eec\u89c2\u5bdf$f_{n,i}$\uff0c\u731c\u6d4b\u5b83\u662f\u5173\u4e8e$i$\u7684$t_n$\u6b21\u591a\u9879\u5f0f\n\n\u90a3\u4e48\u6211\u4eec\u628a\u8f6c\u79fb\u65b9\u7a0b\u79fb\u9879\u4e00\u4e0b\uff1a\n\n$$f_{i,j}-f_{i,j-1}=f_{i-1,j-1}\\times j$$\n\n\u6709\u5dee\u5206\u548c\u4e58\u79ef\u7684\u4e00\u4e9b\u76f8\u5173\u6027\u8d28\u53ef\u4ee5\u5f97\u51fa\u5b83\u4eec\u4e4b\u95f4\u6b21\u6570\u7684\u5173\u7cfb\uff1a\n\n$$t_n-1=t_{n-1}+1$$\n\n\u800c\u5f53$n=0$\u65f6\uff0c\u6709$t_0=0$\uff0c\u6240\u4ee5\u5bb9\u6613\u63a8\u51fa$t_n=2n$\n\n\u56e0\u6b64\u6211\u4eec\u77e5\u9053\u4e86$f_{n,i}$\u662f\u5173\u4e8e$i$\u7684$2n$\u6b21\u591a\u9879\u5f0f\uff0c\u90a3\u4e48\u76f4\u63a5\u66b4\u529bDP\u6c42\u51fa$f_{n,1}$\u5230$f_{n,2n+1}$\uff0c\u7136\u540e\u63d2\u503c\u51fa$f(n,A)$\u7684\u503c\u5373\u53ef\n\nCODE\n\n```cpp\n#include<cstdio>\n#define RI register int\n#define CI const int&\nusing namespace std;\nconst int N=505;\nint A,n,m,f[N][N<<1],g[N<<1],fact[N<<1],mod;\ninline int sum(CI a,CI b)\n{\n    int t=a+b; return t>=mod?t-mod:t;\n}\ninline int sub(CI a,CI b)\n{\n    int t=a-b; return t<0?t+mod:t;\n}\ninline int quick_pow(int x,int p=mod-2,int mul=1)\n{\n    for (;p;p>>=1,x=1LL*x*x%mod) if (p&1) mul=1LL*mul*x%mod; return mul;\n}\ninline void DP(CI n,CI m)\n{\n    RI i,j; for (RI i=0;i<=m;++i) f[0][i]=1;\n    for (i=1;i<=n;++i) for (j=1;j<=m;++j)\n    f[i][j]=sum(1LL*f[i-1][j-1]*j%mod,f[i][j-1]);\n}\ninline int Lagerange(CI n,int *f,CI k)\n{\n    if (k<=n) return f[k]; RI i; int ret=0,mt=1;\n    for (i=1;i<=n;++i) mt=1LL*mt*(k-i)%mod; for (i=1;i<=n;++i)\n    {\n        int tp=1LL*mt*quick_pow(k-i)%mod*f[i]%mod;\n        int dv=1LL*fact[i-1]*fact[n-i]%mod; tp=1LL*tp*quick_pow(dv)%mod;\n        if ((n-i)&1) ret=sub(ret,tp); else ret=sum(ret,tp);\n    }\n    return ret;\n}\nint main()\n{\n    scanf(\"%d%d%d\",&A,&n,&mod); DP(n,m=n<<1|1);\n    RI i; for (i=1;i<=m;++i) g[i]=f[n][i];\n    for (fact[0]=i=1;i<=m;++i) fact[i]=1LL*fact[i-1]*i%mod;\n    return printf(\"%d\",1LL*Lagerange(m,g,A)*fact[n]%mod),0;\n}\n```\n\n",
        "postTime": 1560950774,
        "uid": 41698,
        "name": "hl666",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4463 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f] calc\u3011"
    },
    {
        "content": "[\u535a\u5ba2\u4e5f\u6709\u8be6\u89e3\uff0c\u6b22\u8fce\u6765\u8e29](https://www.cnblogs.com/NaVi-Awson/p/9251080.html)\n\n## Description\n\n\u7ed9\u51fa $A,n,p$ \uff0c\u8ba9\u4f60\u5728\u6a21 $p$ \u610f\u4e49\u4e0b\u6c42\u6240\u6709\u5e8f\u5217 $a$ \u6ee1\u8db3\u201c\u957f\u5ea6\u4e3a $n$ \u4e14 $a_i\\in[1,A]$ \uff0c\u5e76\u4e14\u5bf9\u4e8e $i\\neq j,a_i\\neq a_j$\u201d\u7684\u4ef7\u503c\u548c\u3002\n\n\u4e00\u4e2a\u5e8f\u5217\u7684\u4ef7\u503c\u5b9a\u4e49\u4e3a $\\prod\\limits_{i=1}^n a_i$ \u3002\n\n$1\\leq A\\leq 10^9,1\\leq n\\leq 500,p\\leq 10^9$ \u5e76\u4e14 $p$ \u4e3a\u7d20\u6570\uff0c $p>A>n+1$ \u3002\n\n## Solution\n\n\u8003\u8651\u6734\u7d20\u7684 $\\text{DP}$ \u3002\n\n\u8bb0 $f_{i,j}$ \u4e3a\u957f\u5ea6\u4e3a $j$ \u7684\u5e8f\u5217\u53ea\u542b $[1,i]$ \u5185\u7684\u6570\u7684\u4ef7\u503c\u3002\n\n\u8f6c\u79fb\u662f\u8003\u8651\u662f\u5426\u52a0\u4e0a $i$ \u8fd9\u4e2a\u5143\u7d20\u5e76\u4e14\u5982\u679c\u52a0\u4e0a\u653e\u5728\u54ea\u4e00\u4f4d\uff0c\u90a3\u4e48\n\n$$f_{i,j}=f_{i-1,j-1}\\times j\\times i+f_{i-1,j}$$\n\n\u8fd9\u6837\u8f6c\u79fb\u662f $O(An)$ \u7684\uff0c\u8fc7\u4e0d\u4e86...\n\n[\u636e\u8bf4](https://blog.csdn.net/ez_yww/article/details/77221338) $f_{i,j}$ \u662f\u4e00\u4e2a\u5173\u4e8e $i$ \u6709\u5173\u7684 $2j$ \u6b21\u7684\u591a\u9879\u5f0f\u3002\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651 $\\text{DP}$ \u51fa $f_{i,n},i\\in[0,2n]$ \u7684\u503c\uff0c\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u6c42\u51fa\u552f\u4e00\u89e3\u5373\u53ef...\n\n## Code\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 1000+5;\n\nint f[N][N], a, n, p, x[N], y[N], ifac[N], inv[N];\n\nint quick_pow(int a, int b) {\n\tint ans = 1;\n\twhile (b) {\n\t\tif (b&1) ans = 1ll*ans*a%p;\n\t\tb >>= 1, a = 1ll*a*a%p;\n\t}\n\treturn ans;\n}\nint lagrange(int n, int *x, int *y, int xi) {\n\tint ans = 0, s1 = 1;\n\tfor (int i = 0; i <= n; i++) {\n\t\ts1 = 1ll*s1*(xi-x[i])%p;\n\t\tinv[i] = quick_pow(xi-x[i], p-2);\n\t}\n\tifac[1] = ifac[0] = 1;\n\tfor (int i = 2; i <= n; i++) ifac[i] = -1ll*p/i*ifac[p%i]%p;\n\tfor (int i = 2; i <= n; i++) ifac[i] = 1ll*ifac[i]*ifac[i-1]%p;\n\tfor (int i = 0; i <= n; i++)\n\t\t(ans += 1ll*y[i]*s1%p*inv[i]%p*ifac[i]%p*(((n-i)&1) ? -1 : 1)*ifac[n-i]%p) %= p;\n\treturn (ans+p)%p;\n}\nvoid work() {\n\tscanf(\"%d%d%d\", &a, &n, &p);\n\tfor (int i = 0; i <= n*2; i++) f[i][0] = 1;\n\tfor (int i = 1; i <= n*2; i++)\n\t\tfor (int j = 1; j <= n; j++)\n\t\t\tf[i][j] = (1ll*f[i-1][j-1]*i%p*j%p+f[i-1][j])%p;\n\tif (a <= 2*n) {printf(\"%d\\n\", f[a][n]); return; }\n\tfor (int i = 0; i <= 2*n; i++) x[i] = i, y[i] = f[i][n];\n\tprintf(\"%d\\n\", lagrange(2*n, x, y, a));\n}\nint main() {work(); return 0; }\n```",
        "postTime": 1530451884,
        "uid": 11773,
        "name": "NaVi_Awson",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4463 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f] calc\u3011"
    }
]