[
    {
        "content": "- [\u539f\u9898\u94fe\u63a5](https://www.luogu.com.cn/problem/P8757)\n\n- \u5c0f\u6e05\u65b0\u7ec4\u5408\u6570\u63a8\u5bfc\u3002\n\n------------\n\n\u9996\u5148\u8003\u8651\u5bf9\u4e8e\u4e00\u4e2a\u786e\u5b9a\u7684 $n$ \uff0c$n$ \u9636\u6700\u5927\u5b8c\u7f8e\u957f\u5ea6\u662f\u591a\u5c11\uff1f\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u7531\u4e8e\u5b8c\u7f8e\u5b50\u5e8f\u5217\u540e\u4e00\u9879\u662f\u524d\u4e00\u9879\u7684\u56e0\u5b50\uff0c\u6392\u5217\u53c8\u6ca1\u6709\u91cd\u590d\u5143\u7d20\uff0c\u6240\u4ee5\u5b8c\u7f8e\u5b50\u5e8f\u5217\u6bcf\u4e00\u9879\u81f3\u5c11\u9664\u4ee5\u4e8c\uff0c\u90a3\u6700\u4f18\u7684\u5b50\u5e8f\u5217\u5f53\u7136\u662f $2^k,2^{k-1},2^{k-2},....,2^{0}$ \u5982\u6b64\u6392\u5217\uff0c\u90a3\u4e48 $n$ \u9636\u6700\u5927\u5b8c\u7f8e\u957f\u5ea6\u5c31\u5e94\u8be5\u4e3a $\\lfloor \\log n \\rfloor + 1$ \uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u7528 $x$ \u4ee3\u66ff\u3002\n\n\u786e\u5b9a\u5b8c $x$ \u7684\u503c\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u8bd5\u7740\u63a8\u5bfc\u4e00\u4e0b\u5bf9\u4e8e\u4e00\u4e2a $1$ \u5230 $n$ \u7684\u6392\u5217\uff0c\u5b83\u53ef\u80fd\u7684\u957f\u5ea6\u7b49\u4e8e $x$ \u7684\u5b8c\u7f8e\u5b50\u5e8f\u5217\u6709\u54ea\u4e9b\uff1f\n\n\u9996\u5148\u4e00\u4e2a\u76f4\u89c2\u4e5f\u53ef\u8bf4\u662f\u7701\u4e8b\u7684\u60f3\u6cd5\u5c31\u662f\u53ea\u6709\u4e0a\u9762\u6240\u8bf4\u7684\u6700\u4f18\u5b50\u5e8f\u5217\u4e00\u79cd\uff0c\u53ef\u5f53 $n = 3$ \u65f6\u6211\u4eec\u53d1\u73b0 $(3,1)$ \u5c31\u51fa\u73b0\u4e86\u4f8b\u5916\u3002\u8fd9\u65f6\u4e0d\u8981\u6025\u4e8e\u5426\u5b9a\u81ea\u5df1\uff0c\u8ba9\u6211\u4eec\u4ed4\u7ec6\u60f3\u60f3\u8fd9\u6837\u7684\u4f8b\u5916\u591a\u5417\uff1f\n\n\u5176\u5b9e\u662f\u4e0d\u591a\u7684\u3002\u4ece $x$ \u7684\u8868\u8fbe\u5f0f\u53ef\u4ee5\u770b\u51fa\uff0c\u7c7b\u4f3c $2^k - 1$ \u7684\u8fd9\u79cd $n$ \u6700\u5bb9\u6613\u51fa\u73b0\u4f8b\u5916\uff0c\u5f53\u4f60\u968f\u4fbf\u5217\u4e3e\u51e0\u4e2a\u4f8b\u5982 $3,7,15$ \u8fd9\u6837\u7684 $n$ \u65f6\u5c31\u4f1a\u53d1\u73b0\uff1a\u54a6\uff1f\u597d\u50cf\u4f8b\u5916\u6700\u591a\u5c31\u662f\u5728\u67d0\u4e00\u5904\u76f8\u90bb\u4e24\u9879\u4e0d\u662f\u4e8c\u500d\u5173\u7cfb\uff0c\u800c\u662f\u4e09\u500d\u5173\u7cfb\u3002\n\n\u8fd9\u4e5f\u5f88\u5bb9\u6613\u8bc1\u660e\uff1a\u56e0\u4e3a\u5b8c\u7f8e\u5b50\u5e8f\u5217\u5fc5\u987b\u6ee1\u8db3\u6709 $x$ \u9879\uff0c\u7b2c\u4e00\u9879\u53c8\u4e0d\u80fd\u8d85\u8fc7 $2^x - 1$ \uff0c\u90a3\u4e48\u5982\u679c\u5b58\u5728\u4e00\u4e2a\u6709\u591a\u4e2a\u4e09\u500d\u5173\u7cfb\u6216\u8005\u4e00\u4e2a\u66f4\u9ad8\u500d\u5173\u7cfb\u7684\u5b50\u5e8f\u5217\uff0c\u90a3 $n$ \u9636\u6700\u5927\u5b8c\u7f8e\u957f\u5ea6\u7684\u503c\u5c31\u4e0d\u4f1a\u53ea\u662f $x$ \u4e86\u3002\n\n\u90a3\u4e48\u54ea\u4e9b $n$ \u53ef\u80fd\u51fa\u73b0\u4f8b\u5916\u5462\uff1f\u5fc5\u987b\u662f\u6ee1\u8db3 $2^{x-2} \\times 3 \\leq n$ \u624d\u884c\u3002\u5426\u5219\u5c31\u53ea\u6709\u6700\u4f18\u5b50\u5e8f\u5217\u4e00\u79cd\u60c5\u51b5\u3002\n\n\u65e2\u7136\u5df2\u7ecf\u786e\u5b9a\u4e86\u6709\u54ea\u4e9b\u7c7b\u578b\u7684\u957f\u5ea6\u4e3a $x$ \u7684\u5b8c\u7f8e\u5b50\u5e8f\u5217\uff0c\u90a3\u63a5\u4e0b\u6765\u5c31\u662f\u8ba1\u7b97\u8d21\u732e\u4e86\u3002\n\n\u7531\u4e8e\u8d21\u732e\u662f\u7531\u5b50\u5e8f\u5217\u800c\u6765\uff0c\u800c\u4e0d\u662f\u6392\u5217\u800c\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u7b97\u51fa\u6bcf\u79cd\u5408\u6cd5\u5b50\u5e8f\u5217\u7684\u6743\u503c\u548c\uff0c\u4e58\u4e0a\u5b83\u4eec\u5728\u6392\u5217\u4e2d\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u518d\u52a0\u8d77\u6765\u5c31\u884c\uff0c\u4e0d\u9700\u8981\u62c5\u5fc3\u56e0\u4e3a\u4e24\u4e2a\u5408\u6cd5\u5b50\u5e8f\u5217\u51fa\u73b0\u5728\u4e00\u4e2a\u6392\u5217\u800c\u7b97\u91cd\u3002\n\n\u9996\u5148\u770b\u6b21\u6570\uff0c\u56e0\u4e3a\u6bcf\u79cd\u5408\u6cd5\u5b50\u5e8f\u5217\u957f\u5ea6\u76f8\u540c\uff0c\u4e14\u90fd\u662f\u5728\u6392\u5217\u4e2d\uff0c\u6240\u4ee5\u5728\u6240\u6709\u6392\u5217\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\u4e5f\u5e94\u76f8\u540c\u3002\u8003\u8651 $x$ \u4e2a\u6570\u9996\u5148\u6392\u597d\uff0c\u5269\u4e0b $n-x$ \u4e2a\u6570\u968f\u4fbf\u6392\uff0c\u5c31\u662f $(n-x)!$ \uff0c\u7136\u540e\u6211\u4eec\u9700\u8981\u628a\u4e24\u7ec4\u6570\u6309\u5e8f\u5e76\u5728\u4e00\u8d77\uff0c\u7528\u63d2\u677f\u6cd5\u53ef\u5f97\u65b9\u6848\u6570\u4e3a $n \\choose x$ \uff0c\u90a3\u4e48\u51fa\u73b0\u6b21\u6570\u5c31\u4e3a $(n-x)! \\times {n \\choose x}$ \u3002\n\n\u63a5\u4e0b\u6765\u770b\u6743\u503c\u548c\uff0c\u9996\u5148\u6700\u4f18\u5b50\u5e8f\u5217\u7684\u6743\u503c\u548c\u597d\u8bf4\uff0c\u5c31\u662f $2^x - 1$ \u3002\u800c\u5bf9\u4e8e\u4f8b\u5916\uff0c\u76f8\u90bb\u4e24\u9879\u7684\u5546\u4e00\u5b9a\u662f $x-2$ \u4e2a $2$ \u548c $1$ \u4e2a $3$ \uff0c\u90a3\u4e48\u6839\u636e $3$ \u7684\u4f4d\u7f6e\u7684\u4e0d\u540c\u5c31\u53ef\u4ee5\u5217\u51fa\u4ee5\u4e0b\u5408\u5f0f\uff1a\n\n$$ \\sum_{k=0}^{x-2}{(\\sum_{i=0}^{k}{2^i} + \\sum_{i=k}^{x-2}{3 \\times 2^i})}$$\n\n\u5176\u4e2d\u5916\u5c42 $k$ \u662f\u679a\u4e3e $3$ \u7684\u4f4d\u7f6e\uff0c\u5185\u5c42\u662f\u5206\u4e24\u90e8\u5206\u8ba1\u7b97\u6743\u503c\u548c\u3002\n\n\u63a5\u4e0b\u6765\u518d\u5229\u7528\u4e00\u4e9b\u57fa\u672c\u7684\u548c\u5f0f\u6280\u5de7\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4ee5\u4e0b\u7b54\u6848\uff1a\n\n$$(3 \\times x -4) \\times 2^{x-1} - x + 2$$\n\n\u90a3\u5230\u6b64\u4e3a\u6b62\uff0c\u8fd9\u9053\u9898\u5c31\u5b8c\u6210\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$ \uff0c\u4e0b\u9644\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define LL long long\nconst int N=1e6+10,mod=1e9+7;\nint T,Log[N],pw[N],fct[N],inv[N],finv[N];\ninline void init()\n{\n\tpw[0]=fct[0]=inv[0]=finv[0]=fct[1]=inv[1]=finv[1]=1;\n\tpw[1]=2;\n\tfor(int i=2;i<N;i++)\n\t{\n\t\tLog[i]=Log[i/2]+1;\n\t\tpw[i]=pw[i-1]*2%mod;\n\t\tfct[i]=(LL)fct[i-1]*i%mod;\n\t\tinv[i]=(mod-(LL)mod/i*inv[mod%i]%mod)%mod;\n\t\tfinv[i]=(LL)finv[i-1]*inv[i]%mod;\n\t}\n}\ninline LL C(int x,int y)\n{\n\treturn (LL)fct[x]*finv[y]%mod*finv[x-y]%mod;\n}\nint main()\n{\n\tinit();\n\tscanf(\"%d\",&T);\n\twhile(T--)\n\t{\n\t\tint n,x,ans;\n\t\tscanf(\"%d\",&n);\n\t\tx=Log[n]+1;\n\t\tans=(LL)fct[n-x]*C(n,x)%mod*(pw[x]-1)%mod;\n\t\tif(x>=2&&pw[x-2]*3<=n)\tans=(ans+(LL)fct[n-x]*C(n,x)%mod*((((LL)x*3%mod-4+mod)%mod*pw[x-1]%mod-x+mod+2)%mod)%mod)%mod;\n\t\tprintf(\"%d\\n\",ans);\n\t}\n\treturn 0;\t\n} \n```\n\n- \u5b8c\u7ed3\u6492\u82b1~\n",
        "postTime": 1667639192,
        "uid": 297806,
        "name": "Demeanor_Roy",
        "ccfLevel": 6,
        "title": "P8757 \u5b8c\u7f8e\u5e8f\u5217 \u9898\u89e3"
    },
    {
        "content": "# \u9898\u89e3 P8757\n\n\u611f\u89c9\u96be\u5ea6\u5e94\u8be5\u5c31\u7eff\uff0c\u5728\u5b66\u6821\u4e94\u5206\u949f\u60f3\u51fa\u6765\u4e86\u3002\n\n------------\n\n\u9996\u5148\u8003\u8651**\u5b8c\u7f8e\u957f\u5ea6**\u662f\u591a\u5c11\uff0c\u663e\u7136\u5bf9\u4e8e\u4e00\u4e2a\u5b8c\u7f8e\u5b50\u5e8f\u5217\uff0c\u7b2c\u4e00\u4e2a\u5143\u7d20\u7684\u8d28\u56e0\u6570\u8d8a\u591a\uff0c\u5b83\u5f80\u540e\u80fd\u5ef6\u4f38\u7684\u5b8c\u7f8e\u5b50\u5e8f\u5217\u6700\u957f\u3002\u800c\u4ec0\u4e48\u6837\u7684\u6570\u8d28\u56e0\u6570\u6700\u591a\u5462\uff1f$2^k$\u3002\n\n\u6240\u4ee5\u6211\u4eec\u7b97\u51fa $k=\\lfloor\\log_2(n)\\rfloor$\uff0c$k+1$ \u5373\u4e3a $n$ \u9636\u6700\u5927\u5b8c\u7f8e\u957f\u5ea6\u3002\n\n\u7136\u540e\u518d\u6765\u8003\u8651\u600e\u4e48\u6784\u9020\u51fa\u957f\u5ea6\u4e3a $k+1$ \u7684\u5b8c\u7f8e\u5b50\u5e8f\u5217\uff0c\u663e\u7136\u6709\uff1a\n\n$$\n\\begin{matrix}\n2^{k}&2^{k-1}&...&4&2&1\n\\end{matrix}\n$$\n\n\u5f53 $n\\geq2^{k-1}\\times3$ \u65f6\uff0c\u8fd8\u6709\uff1a\n\n$$\n\\begin{matrix}\n2^{k-1}\\times3&2^{k-2}\\times3&...&6&3&1\\\\\n2^{k-1}\\times3&2^{k-2}\\times3&...&6&2&1\\\\\n...\\\\\n2^{k-1}\\times3&2^{k-2}&...&4&2&1\n\\end{matrix}\n$$\n\n\u6613\u8bc1\u53ef\u80fd\u7684\u60c5\u51b5\u5c31\u53ea\u6709\u8fd9\u4e24\u79cd\u3002\u56e0\u4e3a\u9898\u76ee\u975e\u5e38\u826f\u5fc3\uff0c\u4e0d\u8ba9\u6c42\u65b9\u6848\u6570\u53ea\u8ba9\u6c42\u548c\uff0c\u6240\u4ee5\u6211\u4eec\u8bbe $T$ \u4e3a\u4e0a\u8ff0\u6240\u6709\u53ef\u80fd\u65b9\u6848\u4e2d\u7684\u6240\u6709\u6570\u4e4b\u548c\uff0c\u7b54\u6848\u5373\u4e3a\uff1a\n\n$$T\\times\\dbinom{n}{k+1}\\times(n-k-1)!$$\n\n\u5176\u4e2d\u7ec4\u5408\u6570\u4ee3\u8868\u7740\u9009 $k+1$ \u4e2a\u4f4d\u7f6e\u4f5c\u4e3a\u5b8c\u7f8e\u5b50\u5e8f\u5217\uff0c\u9636\u4e58\u4ee3\u8868\u7740\u5176\u4ed6\u4f4d\u7f6e\u53ef\u4ee5\u968f\u4fbf\u653e\u7f6e\u3002\n\n```cpp\n/*\n    name: [\u84dd\u6865\u676f 2021 \u7701 A2] \u5b8c\u7f8e\u5e8f\u5217\n    id:   P8757\n    date: 2022/11/1\n*/\n\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\n\nconst int N = 1e6 + 10;\nconst ll P = 1e9 + 7;\nll fac[N], inv[N];\nint t, n;\n\nll qp(ll a, ll b){\n\tll ans = 1;\n\twhile(b){\n\t\tif(b & 1){\n\t\t\tans = ans * a % P;\n\t\t}\n\t\ta = a * a % P;\n\t\tb >>= 1;\n\t}\n\treturn ans;\n}\nll C(int n, int m){\n\treturn fac[n] * inv[m] % P * inv[n-m] % P;\n}\n\nint main(){\n\tfac[0] = 1;\n\tfor(int i = 1; i < N; ++ i){\n\t\tfac[i] = fac[i-1] * i % P;\n\t}\n\tinv[N-1] = qp(fac[N-1], P-2);\n\tfor(int i = N-2; i >= 0; -- i){\n\t\tinv[i] = inv[i+1] * (i+1) % P;\n\t}\n\tscanf(\"%d\", &t);\n\twhile(t--){\n\t\tscanf(\"%d\", &n);\n\t\tint k = log(n) / log(2);\n\t\tif(n == 1){\n\t\t\tputs(\"1\");\n\t\t\tcontinue;\n\t\t}\n\t\tll ans = (1 << k + 1) - 1;\n\t\tif(n >= (1 << k - 1) * 3){\n\t\t\tans += k;\n\t\t\tfor(int i = 1; i <= k; ++ i){\n\t\t\t\tans += (1 << i) * (k - i);\n\t\t\t\tans += (1 << i - 1) * 3 * i;\n\t\t\t\tans %= P;\n\t\t\t}\n\t\t}\n\t\tprintf(\"%lld\\n\", ans * C(n, k + 1) % P * fac[n-k-1] % P);\n\t}\n\treturn 0;\n}\n\n```\n\n\n\n\n\n\n\n",
        "postTime": 1667301347,
        "uid": 390770,
        "name": "AiRC0S",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8757 [\u84dd\u6865\u676f 2021 \u7701 A2] \u5b8c\u7f8e\u5e8f\u5217"
    },
    {
        "content": "## \u601d\u8def\n\n\u4e3a\u4f7f\u63cf\u8ff0\u65b9\u4fbf\uff0c\u5148\u4ee4\u9898\u76ee\u63cf\u8ff0\u4e2d\u7684\u201c\u5b8c\u7f8e\u5e8f\u5217\u201d\u53cd\u8f6c\uff08\u5373\u5e8f\u5217\u5355\u8c03\u9012\u589e\u4e14\u6bcf\u4e00\u4e2a\u6570\u90fd\u662f\u4e0a\u4e00\u4e2a\u6570\u7684\u500d\u6570\uff09\u3002\u539f\u201c\u5b8c\u7f8e\u5e8f\u5217\u201d\u4e0e\u53cd\u8f6c\u540e\u7684\u672c\u8d28\u76f8\u540c\u3002\n\n\u5148\u8003\u8651\u6700\u5927\u957f\u5ea6\u3002\n\n\u663e\u7136\uff0c\u5f53\u5b8c\u7f8e\u5e8f\u5217\u4e3a $1,2,4,...,2^k\\ (2^k\\le n<2^{k+1}\\text{\uff0c\u5373 }k=\\left\\lfloor\\log_2n\\right\\rfloor)$ \u65f6\u957f\u5ea6\u6700\u5927\uff0c\u957f\u5ea6\u4e3a $k+1$\uff08\u4e0b\u6587\u7684 $k$ \u5747\u6307\u4ee3 $\\left\\lfloor\\log_2n\\right\\rfloor$\uff09\u3002\n\n\u8003\u8651\u6709\u6ca1\u6709\u5176\u4ed6\u7b26\u5408\u8981\u6c42\u4e14\u957f\u5ea6\u4e3a $k+1$ \u7684\u5e8f\u5217\u3002\n\n\u5e8f\u5217\u7684\u6240\u6709\u6570\u90fd\u5c0f\u4e8e\u7b49\u4e8e $n$\uff0c\u7b49\u4ef7\u4e8e\u5e8f\u5217\u7684\u6700\u5927\u503c\u5c0f\u4e8e\u7b49\u4e8e $n$\u3002\u5e8f\u5217\u7684\u6700\u5927\u503c\u53ef\u4ee5\u770b\u4f5c\u662f $k$ \u4e2a\u5927\u4e8e $1$ \u7684\u6b63\u6574\u6570\u76f8\u4e58\uff0c\u76ee\u524d $k$ \u4e2a\u6570\u90fd\u662f $2$\u3002\u8003\u8651\u8c03\u6574\u8fd9 $k$ \u4e2a\u6570\u3002\n\n- \u5982\u679c\u8c03\u6574\u4e00\u4e2a $2$\uff0c\u5c06\u5176\u53d8\u6210 $3$\uff0c\u90a3\u4e48\u6700\u5927\u503c\u4e3a $2^{k-1}\\times3$\uff0c\u53ef\u80fd\u5c0f\u4e8e\u7b49\u4e8e $n$\uff1b\u4f46\u5982\u679c\u5c06\u4e00\u4e2a $2$ \u53d8\u4e3a $4$\uff0c\u90a3\u4e48\u6700\u5927\u503c\u4e3a $2^{k-1}\\times4=2^{k+1}>n$\uff0c\u56e0\u6b64\u4e0d\u53ef\u4ee5\uff0c\u800c\u5c06 $2$ \u53d8\u4e3a\u5927\u4e8e $4$ \u7684\u6570\u663e\u7136\u4e5f\u4e0d\u53ef\u4ee5\u3002\n\n- \u5982\u679c\u8c03\u6574\u4e24\u4e2a $2$\uff0c\u5c06\u5176\u53d8\u6210\u4e24\u4e2a $3$\uff0c\u90a3\u4e48\u6700\u5927\u503c\u4e3a $2^{k-2}\\times3^2>2^{k-2}\\times2^3>n$\uff0c\u56e0\u6b64\u4e0d\u53ef\u4ee5\u8c03\u6574\u4e24\u4e2a $2$\u3002\u8c03\u6574\u4e24\u4e2a\u4ee5\u4e0a\u7684 $2$ \u663e\u7136\u4e5f\u4e0d\u53ef\u4ee5\u3002\n\n\u7efc\u4e0a\uff0c\u7b26\u5408\u6761\u4ef6\u7684\u5e8f\u5217\u53ea\u6709\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\uff1a\n\n1. $\\begin{cases}a_1=1\\\\a_i=a_{i-1}\\times2&i\\in[2,k+1]\\end{cases}$\n\n1. $\\begin{cases}a_1=1\\\\a_i=a_{i-1}\\times2&i\\in[2,k+1]\\text{ \u4e14 }i\\ne t\\\\a_t=a_{t-1}\\times3&t\\text{ \u4e3a }[2,k+1]\\text{ \u4e2d\u7684\u4e00\u4e2a\u5e38\u6570}\\end{cases}$\n\n\u7b2c\u4e00\u79cd\u60c5\u51b5\u4e00\u5b9a\u6210\u7acb\uff0c\u7b2c\u4e8c\u79cd\u60c5\u51b5\u5728 $2^{k-1}\\times3\\le n$ \u65f6\u624d\u6210\u7acb\u3002\n\n\u56e0\u6b64\uff0c\u603b\u5171\u6709 $1$ \u79cd\u6216 $k+1$ \u79cd\u4e0d\u540c\u7684\u6700\u957f\u5b8c\u7f8e\u5e8f\u5217\u3002\n\n\u4e0d\u7ba1\u6709\u51e0\u79cd\u5e8f\u5217\uff0c\u6240\u6709\u6700\u957f\u5b8c\u7f8e\u5e8f\u5217\u7684\u957f\u5ea6\u90fd\u662f\u4e00\u6837\u7684\uff0c\u56e0\u6b64\u4ed6\u4eec\u5728\u6240\u6709 $n$ \u7684\u6392\u5217\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\u90fd\u76f8\u540c\u3002\u6211\u4eec\u53ea\u9700\u8ba1\u7b97\u51fa\u6240\u6709\u5e8f\u5217\u7684\u4ef7\u503c\u4e4b\u548c\uff0c\u518d\u4e58\u4e0a\u6bcf\u4e00\u79cd\u5e8f\u5217\u7684\u51fa\u73b0\u6b21\u6570\u5373\u53ef\u3002\n\n\u8ba1\u7b97\u6bcf\u4e00\u79cd\u5e8f\u5217\u7684\u51fa\u73b0\u6b21\u6570\u53ea\u9700\u7528\u63d2\u677f\u6cd5\uff0c\u539f\u672c\u6709 $k+1$ \u4e2a\u4e0d\u540c\u7684\u6570\uff0c\u9700\u5728\u5176\u4e2d\u4e0d\u65ad\u63d2\u5165\u4e0d\u540c\u7684\u6570\uff0c\u76f4\u5230\u6700\u7ec8\u6709 $n$ \u4e2a\u6570\uff0c\u56e0\u6b64\u51fa\u73b0\u6b21\u6570\u4e3a $(k+2)\\times(k+3)\\times ...\\times n=\\dfrac{n!}{(k+1)!}$\u3002\n\n\u8bbe\u6240\u6709\u6700\u957f\u5b8c\u7f8e\u5e8f\u5217\u7684\u4ef7\u503c\u4e4b\u548c\u4e3a $sum$\uff0c\u7b54\u6848\u5373\u4e3a $sum\\times\\dfrac{n!}{(k+1)!}$\u3002\n\n\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\uff0c\u8ba1\u7b97 $sum$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\log^2n)$\uff1b\u9884\u5904\u7406 $n$ \u4ee5\u5185\u7684\u9636\u4e58\u4e0e\u9636\u4e58\u9006\u5143\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n)$\u3002\u56e0\u6b64\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(T\\log^2n+n)$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define LL long long\nusing namespace std;\ninline int read() {\n\tint s=0,f=1; char ch=getchar();\n\twhile (ch<48 || ch>57) {if (ch=='-') f=-1; ch=getchar();}\n\twhile (ch>=48 && ch<=57) {s=(s<<3)+(s<<1)+(ch^48); ch=getchar();}\n\treturn s*f;\n}\nconst int N=1e6+5,P=1e9+7;\nLL fac[N],facinv[N];\nLL getinv(LL x) {\n\tLL res=1;\n\tfor (int y=P-2;y;y>>=1) {\n\t\tif (y&1) res=res*x%P;\n\t\tx=x*x%P;\n\t}\n\treturn res;\n}\nvoid init(int n) {\n\tfac[0]=1;\n\tfor (int i=1;i<=n;++i)\n\tfac[i]=fac[i-1]*i%P;\n\tfacinv[n]=getinv(fac[n]);\n\tfor (int i=n;i>=1;--i)\n\tfacinv[i-1]=facinv[i]*i%P;\n}\nint T,n;\nint main() {\n\tinit(1e6);\n\tT=read();\n\twhile (T--) {\n\t\tn=read();\n\t\tint k=log2(n);\n\t\tLL sum=(1<<k+1)-1;\n\t\tif ((1<<k-1)*3<=n) {\n\t\t\tfor (int i=1;i<=k;++i) {\n\t\t\t\tint x=1; sum=(sum+1)%P;\n\t\t\t\tfor (int j=1;j<=k;++j) {\n\t\t\t\t\tif (i==j) x*=3;\n\t\t\t\t\telse x<<=1;\n\t\t\t\t\tsum=(sum+x)%P;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tprintf(\"%lld\\n\",sum*(fac[n]*facinv[k+1]%P)%P);\n\t}\n\treturn 0;\n}\n\n```\n\n$\\text{114ms / 15.71MB}$\n",
        "postTime": 1667656310,
        "uid": 108043,
        "name": "\u6709\u7d20\u8d28\u76842B\u94c5\u7b14",
        "ccfLevel": 7,
        "title": "P8757 [\u84dd\u6865\u676f 2021 \u7701 A2] \u5b8c\u7f8e\u5e8f\u5217 \u9898\u89e3"
    }
]