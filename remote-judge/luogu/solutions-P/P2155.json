[
    {
        "content": "\u672c\u9898\u5728 [/discuss/show/338087](/discuss/show/338087) \u52a0\u5f3a\u6570\u636e\u524d\u7684\u9898\u89e3\u6709\u4e00\u4e9b\u662f\u9519\u8bef\u7684\uff0c\u5177\u4f53\u539f\u56e0\u4e0b\u9762\u4f1a\u8bf4\u660e\u3002\n\n\u9519\u8bef\u7684\u9898\u89e3\u5b58\u5728\u7684\u95ee\u9898\u662f\uff0c\u5f53 $n \\ge R$ \u65f6\u5c31\u76f4\u63a5\u8f93\u51fa $0$\uff0c\u5728\u539f\u6570\u636e\u4e0b\u662f\u80fd AC \u7684\u3002\n\n\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u8fd9\u6837\u7684\uff0c\u53ef\u4ee5\u8bd5\u8bd5\u8fd9\u4e2a\u6570\u636e\uff1a\n\n```plain\n1 3\n4 3\n```\n\n\u8f93\u51fa\u5e94\u8be5\u662f $2$\u3002\u4f46\u662f\u6211\u89c1\u5230\u7684\u5927\u90e8\u5206\u9898\u89e3\u8f93\u51fa\u90fd\u662f $0$\u3002\n\n\u4e3a\u4ec0\u4e48\u5462\uff1f\n\n\u6211\u4eec\u5148\u770b\u770b\u8fd9\u9898\u7684\u516c\u5f0f\uff1a$\\displaystyle \\mathrm{ans} = \\frac{n!}{m!} \\cdot \\varphi(m!)$\uff0c\u5176\u4e2d $\\varphi(x)$ \u4ee3\u8868 $x$ \u7684\u6b27\u62c9\u51fd\u6570\u3002\n\n\u5316\u7b80\uff1a\n\n$$ \\begin{aligned} \\mathrm{ans} &= \\frac{n!}{m!} \\cdot \\varphi(m!) \\\\ &= \\frac{n!}{m!} \\cdot m! \\prod_{p \\mid m!} \\frac{p - 1}{p} \\\\ &= n! \\cdot \\frac{\\displaystyle \\prod_{p \\in \\mathbb{P} \\mathbin{\\&} p \\le m} (p - 1)}{\\displaystyle \\prod_{p \\in \\mathbb{P} \\mathbin{\\&} p \\le m} p} \\end{aligned} $$\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u53ea\u8981\u5904\u7406 $\\displaystyle \\prod p$ \u5bf9 $R$ \u7684\u9006\u5143\u5417\uff1f\n\n\u9519\u4e86\uff0c\u56e0\u4e3a $n!$ \u4e2d\u7684\u56e0\u5b50 $R$ \u8fd8\u6709\u53ef\u80fd\u548c $\\displaystyle \\prod p$ \u4e2d\u7684 $R$ \u6d88\u6389\u3002\n\n\u6b63\u89e3\u5e94\u8be5\u662f\u5bf9 $n \\ge R$ \u7684 $n!$ \u6d88\u53bb\u4e00\u4e2a $R$\uff0c\u5bf9 $m \\ge R$ \u7684 $\\displaystyle \\prod p$ \u540c\u65f6\u6d88\u53bb\u4e00\u4e2a $R$ \u624d\u5bf9\u3002\n\n\u7531\u4e8e $\\displaystyle \\prod p$ \u4e2d\u6700\u591a\u542b\u6709\u4e00\u4e2a $R$ \u6240\u4ee5\u4e0d\u9700\u8981\u591a\u505a\u6d88\u53bb\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\n#define F(i,a,b) for(int i=(a);i<=(b);++i)\n#define F2(i,a,b) for(int i=(a);i<(b);++i)\nint T,Mod,n,m;\nint primes[664580], pnum=0;\nbool isn_prime[10000001];\nint pi[664580],inv[10000001];\nint in[664580],fct[10000001];\nint pos[10000001];\nvoid init(){\n\tisn_prime[0]=isn_prime[1]=1;\n\tF(i,2,10000000){\n\t\tif(!isn_prime[i]) primes[++pnum]=i;\n\t\tfor(int j=1;j<=pnum&&primes[j]*i<=10000000;++j){\n\t\t\tisn_prime[primes[j]*i]=1;\n\t\t\tif(i%primes[j]==0) break;\n\t\t}\n\t}\n\tinv[1]=1; for(int i=2;i<Mod&&i<=10000000;++i)\n\t\tinv[i]=1ll*(Mod-Mod/i)*inv[Mod%i]%Mod;\n\tpi[0]=1; F(i,1,pnum) pi[i]=1ll*pi[i-1]*(primes[i]-1)%Mod;\n\tin[0]=1; F(i,1,pnum) if(primes[i]!=Mod) in[i]=1ll*in[i-1]*inv[primes[i]%Mod]%Mod; else in[i]=in[i-1];\n\tfct[0]=1; F(i,1,10000000) if(i!=Mod) fct[i]=1ll*fct[i-1]*i%Mod; else fct[i]=fct[i-1];\n\tF(i,2,10000000) if(isn_prime[i]) pos[i]=pos[i-1]; else pos[i]=pos[i-1]+1; \n}\nint main(){\n\tscanf(\"%d%d\",&T,&Mod);\n\tinit();\n\twhile(T--){\n\t\tscanf(\"%d%d\",&n,&m);\n\t\tif(n>=Mod&&m<Mod) puts(\"0\");\n\t\telse printf(\"%d\\n\",1ll*fct[n]*pi[pos[m]]%Mod*in[pos[m]]%Mod);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1515227682,
        "uid": 10703,
        "name": "\u5c0f\u7c89\u5154",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P2155 \u3010[SDOI2008]\u6c99\u62c9\u516c\u4e3b\u7684\u56f0\u60d1\u3011"
    },
    {
        "content": "\u9898\u610f\u7b80\u8ff0\uff1a\u7ed9\u5b9a $N,M,R$\uff0c\u6c42 $[1,N!]$ \u4e2d\u4e0e $M!$ \u4e92\u8d28\u7684\u6570\u7684\u6570\u91cf\u3002\n\n\u4f1f\u5927\u7684\u6b27\u51e0\u91cc\u5f97\u5df2\u7ecf\u544a\u8bc9\u6211\u4eec\u8be5\u600e\u4e48\u505a\u4e86\u3002\n\n\u9898\u76ee\u4e2d\u9650\u5b9a\u4e86 $M \\leq N$\uff0c\u90a3\u4e48\u663e\u7136 $M! | N!$. \n\n\u5e38\u8bc6\u544a\u8bc9\u6211\u4eec\uff0c$gcd(a,b)=gcd(a+k\\times b,b)$.\u7136\u800c\u5e38\u8bc6\u5f88\u591a\u65f6\u5019\u662f\u5047\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u8bc1\u660e\u8fd9\u4e2a\u5f0f\u5b50\u3002\n\n\u8bbe $s=gcd(a,b)$, \u5219\u5b58\u5728 $x,y\\in\\mathbb{Z}$\u4f7f\u5f97 $a=x\\times s,b=y\\times s,gcd(x,y)=1$\uff0c\u4e8e\u662f $gcd(a+b\\times k,b)=gcd(x\\times s+y\\times s\\times k,y\\times s)=gcd(s\\times(x+y\\times k),s\\times y)=s\\times gcd(x+y\\times k,y)$.\n\n\u8bbe $m|(x+y\\times k)$ \u4e14 $m|y$\uff0c\u6240\u4ee5 $m|(y\\times k)$\uff0c\u6240\u4ee5 $m|x$.\u5373 $m|x$ \u4e14 $m|y$\uff0c\u53c8\u56e0\u4e3a $gcd(x,y)=1$\uff0c\u6240\u4ee5 $gcd(x+y\\times k,y)=m=1$\uff0c\u6240\u4ee5 $gcd(a+b\\times k,b)=s\\times gcd(x+y\\times k,y)=s=gcd(a,b)$.\n\n\u8fd9\u4e2a\u5f0f\u5b50\u80fd\u8bf4\u660e\u4ec0\u4e48\u5462\uff1f\u6211\u4eec\u4ee4 $b=M!$,\u663e\u7136\u53ef\u4ee5\u53d1\u73b0\uff1a\u5bf9\u4e8e $\\forall k\\in [1,\\frac{N!}{M!}],\\forall x\\in[1,M!]$ \u6709 $gcd(k*M!+x,M!)=gcd(x,M!)$.\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e $\\forall k\\in [1,\\frac{N!}{M!}]$, $[(k-1)\\times M!+1,k\\times M!]$ \u4e2d\u4e0e $M!$ \u4e92\u8d28\u7684\u6570\u662f\u76f8\u7b49\u7684\u3002\n\n\u5f97\u51fa\u8fd9\u4e2a\u7ed3\u8bba\u4e4b\u540e\u5c31\u7b80\u5355\u4e86\u3002\u7b54\u6848\u5c31\u662f $\\frac{N!}{M!}\\times \\phi(M!)$.\n\n$\\phi(M!)$ \u53c8\u662f\u4e2a\u4e0d\u53ef\u505a\u7684\u4e1c\u897f\u3002\u3002\u3002\u5417\uff1f\n\n\u6211\u4eec\u77e5\u9053 $\\phi(n)=n\\times\\Pi_{p|n}(1-\\frac{1}{p})$, \u8bbe $phifac_i=\\phi(i!)$\uff0c\u6211\u4eec\u5206\u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba\u3002\n\n$n$ \u4e3a\u7d20\u6570\u65f6\uff0c$phifac_i=n\\times(1-\\frac{1}{n})\\times(n-1)!\\times\\Pi_{p|n!\\&p\\neq n}(1-\\frac{1}{p})=(n-1)\\times (n-1)!\\times\\Pi_{p|(n-1)!}(1-\\frac{1}{p})=(n-1)\\times phifac_{n-1}$.\n\n$n$ \u4e3a\u5408\u6570\u65f6\uff0c\n$phifac_i=n\\times(n-1)!\\times\\Pi_{p|n!}(1-\\frac{1}{p})=n\\times phifac_{n-1}$.\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u9636\u4e58\u7684\u6b27\u62c9\u51fd\u6570\u7684\u9012\u63a8\u5f0f\u3002\n\n\u9884\u5904\u7406\u51fa\u9636\u4e58\u548c\u6b27\u62c9\u51fd\u6570\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\u8ba1\u7b97 $M!$ \u7684\u9006\u5143\u5373\u53ef\u3002\n\n\u4f46\u662f\u9898\u76ee\u4e2d\u6ca1\u6709\u89c4\u5b9a $R\\leq N$ \u6240\u4ee5\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0 $R|N!$\uff0c\u9884\u5904\u7406\u9636\u4e58\u548c\u6b27\u62c9\u51fd\u6570\u7684\u65f6\u5019\u8981\u8bb0\u5f97\u7279\u5224\u5982\u679c $R|i$ \u90a3\u4e48\u8981\u628a $i$ \u4e2d\u7684 $R$ \u56e0\u5b50\u5168\u90e8\u9664\u6389\u518d\u8ba1\u7b97\u3002\n\n\u6700\u540e\u7279\u5224\u4e00\u4e0b\uff0c\u5982\u679c $\\lfloor \\frac{N}{R}\\rfloor>\\lfloor\\frac{M}{R}\\rfloor$  \uff08\u5373 $N!$ \u4e2d $R$ \u56e0\u5b50\u66f4\u591a\uff09\u5219\u7b54\u6848\u4e3a $0$.\n\n```cpp\n#include <cstdio>\nusing namespace std;\ninline int read() {\n\tint res=0,f=1; char ch=getchar();\n\twhile(ch<'0'||ch>'9') {if(ch=='-') f=-1; ch=getchar();}\n\twhile(ch>='0'&&ch<='9') {res=res*10+ch-'0'; ch=getchar();}\n\treturn res*f;\n}\nconst int MAXN=10000005;\nint T,r,n,m;\nint ispr[MAXN];\nint pri[MAXN];\nint fct[MAXN];\nint phi[MAXN];\ninline void IsPrImE() {\n\tint cnt=0;\n\tispr[0]=ispr[1]=1;\n\tfor(register int i=2;i<MAXN;++i) {\n\t\tif(!ispr[i]) \n\t\t\tpri[++cnt]=i;\n\t\tfor(register int j=1;j<=cnt;++j) {\n\t\t\tif(1ll*i*pri[j]>=MAXN) break;\n\t\t\tispr[i*pri[j]]=1;\n\t\t\tif(!i%pri[j]) break;\n\t\t}\n\t}\n}\ninline long long qpow(int x,int p) {\n\tlong long res=1;\n\twhile(p) {\n\t\tif(p&1) res=1ll*res*x%r;\n\t\tp>>=1; x=1ll*x*x%r;\n\t}\n\treturn res;\n}\nsigned main() {\n\tIsPrImE();\n\tT=read(); r=read();\n\tfct[0]=phi[0]=1;\n\tfor(register int i=1;i<MAXN;++i) {\n\t\tint x=i,k=0;\n\t\twhile(x%r==0) x/=r,++k;\n\t\tfct[i]=fct[i-1]*1ll*x%r;\n\t\tx=i-1+ispr[i],k=0;\n\t\twhile(x%r==0) x/=r,++k;\n\t\tphi[i]=phi[i-1]*1ll*x%r;\n\t}\n\twhile(T--) {\n\t\tn=read(); m=read();\n\t\tlong long ans=1ll*fct[n]*phi[m]%r*qpow(fct[m],r-2)%r;\n\t\tif(n/r>m/r) ans=0;\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1630056898,
        "uid": 149815,
        "name": "Isprime",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P2155\u3010[SDOI2008] \u6c99\u62c9\u516c\u4e3b\u7684\u56f0\u60d1\u3011"
    },
    {
        "content": "## \u9898\u610f\u7b80\u8ff0\n\n**\u672c\u9898\u591a\u6d4b\u3002\u6700\u9ad8\u53ef\u8fbe 1w \u7ec4\u6d4b\u8bd5\u6570\u636e\u3002**\n\n\u6c42 $1\\sim N!$ \u4e2d\u4e0e $M!$ \u4e92\u8d28\u7684\u6570\u7684\u4e2a\u6570\uff0c\u5bf9 $R$ \u53d6\u6a21\u3002\n\n$N,M$ \u5728\u7ebf\u6027\u8303\u56f4\uff0c$R$ \u662f\u4e00\u4e2a\u53ef\u80fd\u5f88\u5927\u7684\u7d20\u6570\u3002\n\n## $\\rm Analysis$\n\n#### \u5f15\u7406 $1$\n\n\u8003\u8651\u67d0\u4e00\u4e2a\u6570 $x$\uff0c\u4e0e $M!$ \u4e92\u8d28\uff0c\u5373\n\n$$\\gcd(x,M!)=1$$\n\n\u5373\u4e0e\u6bcf\u4e00\u4e2a\u56e0\u5b50\u90fd\u4e92\u8d28\uff0c\u5373\n\n$$\\gcd(x,1),\\gcd(x,2),\\cdots,\\gcd(x,M)$$\n\n\u5747\u4e3a $1$\u3002\n\n\u90a3\u4e48\u67d0\u4e00\u4e2a\u5408\u6570\u56e0\u5b50\uff0c\u5fc5\u80fd\u8868\u793a\u6210\u591a\u4e2a\u4e0d\u5927\u4e8e $M$ \u7684\u8d28\u6570\u56e0\u5b50\u7684\u79ef\u3002\n\n\u9898\u610f\u5373\u8f6c\u6c42\n\n$$\\gcd(x,p_1),\\gcd(x,p_2),...,gcd(x,p_K)$$\n\n\u5747\u4e3a $1$\u3002\n\n\u5176\u4e2d $p_{1\\cdots K}$ \u8868\u793a\u4e0d\u5927\u4e8e $M$ \u7684\u5168\u4f53\u7d20\u6570\u3002\n\n\u90a3\u4e48\u7b54\u6848\u5373\u4e3a $1\\sim N!$ \u4e2d\u4e0e $\\{p_K\\}$ \u4e92\u8d28\u7684\u6570\u7684\u4e2a\u6570\u3002\n\n#### \u5f15\u7406 $2$\n\n\u82e5\u5b58\u5728\u4e24\u4e2a\u6570\uff0c$x\\le y$\uff0c\u7b54\u6848\u662f\u8981\u6c42 $1\\cdots x$ \u7684\u8d21\u732e\u3002\n\n\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8ba1\u7b97 $1\\cdots y$ \u7684\u8d21\u732e\u51cf\u53bb $x+1\\dots y$ \u7684\u8d21\u732e\u6765\u5f97\u5230 $1\\cdots x$ \u7684\u8d21\u732e\u3002\n\n#### \u6700\u540e\u4e00\u51fb\n\n\u7531\u5f15\u7406 $1$ \u53ef\u77e5\u7b54\u6848\u662f $1\\cdots N!$ \u4e2d\u4e0e $\\{p_K\\}$ \u4e92\u8d28\u7684\u6570\u7684\u4e2a\u6570\u3002\n\n\u7531\u5f15\u7406 $2$ \u53ef\u5c06\u4e0a\u9762\u7684\u95ee\u9898\u8f6c\u5316\u4e3a\uff1a\n\n$$\\begin{aligned}&\\text{(1}\\sim \\text{N! \u4e2d\u4e0e N! \u4e92\u8d28\u7684\u4e2a\u6570)}\\\\-&\\text{(1} \\sim\\text{N! \u4e2d\u4e0e (M+1)*(M+2)*..*(N-1)*N \u4e92\u8d28\u7684\u4e2a\u6570)}\\end{aligned}$$\n\n\u524d\u8005\uff0c$1\\sim N!$ \u4e2d\u4e0e $N!$ \u4e92\u8d28\u7684\u4e2a\u6570\uff0c\u5c31\u662f\u6b27\u62c9\u51fd\u6570 $\\varphi(N!)$\u3002\n\n$$\\varphi(N!)=N!\\times\\dfrac{p_1-1}{p_1}\\times\\dfrac{p_2-1}{p_2}\\times\\cdots\\times\\dfrac{p_K-1}{p_K}$$\n\n\u540e\u8005\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u662f\u96f6\u3002\n\n\u56e0\u4e3a\u82e5\u5b58\u5728\u56e0\u5b50 $p_i\\in(M\\sim N)$\uff0c\u4e0e $N!$ \u4e2a\u6570\u4e2d\u67d0\u4e9b\u6570\u4e92\u8d28\uff0c\u90a3 $p_i$ \u4e00\u5b9a\u4e0d\u4e0e $M!$ \u4e92\u8d28\u3002\n\n\u6545\u4e0d\u5b58\u5728\u8d21\u732e\u3002\n\n\u6240\u4ee5\u7b54\u6848\u5373\u4e3a\n\n$$N!\\times\\dfrac{(p_1-1)\\times(p_2-1)\\times\\cdots\\times(p_k-1)}{(p_1\\times p_2\\times\\cdots\\times p_k)}$$\n\n#### Hack \u6570\u636e\u539f\u7406\n\n\u5f53 $R\\le M\\le N$ \u65f6\uff0c$N!$ \u4e2d\u7684 $R$ \u4e0e\u5206\u6bcd\u4e2d\u7684 $R$ \u4f1a\u7ea6\u53bb\uff0c\u800c\u76f4\u63a5\u6c42\u9006\u5143\u4f1a\u5bfc\u81f4\u7b54\u6848\u4e3a $0$\u3002\n\n\u8003\u8651 $3$ \u79cd\u60c5\u51b5\uff1a\n\n- $R>N$: \u6b63\u5e38\u8be5\u600e\u4e48\u505a\u600e\u4e48\u505a\u3002\n\n- $R\\in[M,N]$\uff1a\u8fd9\u65f6\u5206\u5b50 $(N!)$ \u4e2d\u5b58\u5728 $R$ \u56e0\u5b50\uff0c\u5206\u6bcd $(M!)$ \u4e2d\u4e0d\u5b58\u5728 $R$ \u56e0\u5b50\uff0c\u7b54\u6848\u6070\u597d\u4e3a $0$\u3002\n\n- $R<M$\uff1a\u8fd9\u65f6\u5206\u5b50\u5206\u6bcd\u5747\u542b\u6709 $R$\uff0c\u82e5 $\\text{(\u5206\u5b50\\%R*\u5206\u6bcd\u9006\u5143\\%R)}$ \u7b54\u6848\u663e\u793a\u5e94\u662f\u96f6\uff0c\u4f46\u5b9e\u9645\u4e0d\u662f\u96f6\u3002\n\n\u5982\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a$\\dfrac{2!}{2!}=1$\uff0c$\\bmod~2$ \u610f\u4e49\u4e0b\u6b63\u89e3\u5e94\u4e3a $1$\u3002\n\n\u4f46\u5206\u5b50 $2!\\bmod 2=0$\uff0c\u518d\u4e58\u4e0a\u4e2a\u9006\u5143\uff0c\u4e0d\u7ba1\u9006\u5143\u662f\u591a\u5c11\uff0c\u6a21 $2$ \u5b83\u8fd8\u662f\u96f6\u3002\u8fd9\u5c31\u9519\u4e86\u3002\n\n\u89e3\u51b3\u529e\u6cd5\uff1a\u7279\u5224 $R\\le M$ \u65f6\uff0c\u5206\u5b50\u5206\u6bcd\u8ba1\u7b97\u7684\u65f6\u5019\u90fd\u4e0d\u4e58\u4e0a $R$ \u56e0\u5b50\uff0c\u7b49\u4e8e\u662f\u7ea6\u5206\u6389\u4e86\u3002\n\n```cpp\n#include<cstdio>\n#include<algorithm>\ninline int in();\ninline void wr(int);\nconst int N=(int)1e7+5,M=(int)3e6+5;\nint p[M],fac[N],p1[M],p2[M];bool vis[N];\ninline void prime();\ninline int quick_mod(int,int,int);\nint main(int argc,char**argv){\n\tprime();\n\tregister int T=in(),R=in();\n\tfac[0]=1;\n\tfor(register int i=1;i<N;++i)\n\t\tif(i!=R)fac[i]=fac[i-1]*1ll*i%R;\n\t\telse fac[i]=fac[i-1];\n\t\t/*\u7279\u5224\uff1a\u7ea6\u5206\uff01*/\n\tp1[1]=(p[1]-1)%R;p2[1]=p[1];\n\tfor(register int i=2;i<=p[0];++i)\n\t\tp1[i]=p1[i-1]*1ll*(p[i]-1)%R,p2[i]=p[i];\n\t/*p1[i]\u8868\u793a\u524di\u4e2a\u7d20\u6570-1\u76f8\u4e58\u7684\u7ed3\u679c*/\n\tfor(register int i=1;i<=p[0];++i)\n\t\tif(p[i]!=R)p[i]=quick_mod(p[i],R-2,R);\n\tfor(register int i=2;i<=p[0];++i)\n\t\tif(p[i]!=R)p[i]=p[i]*1ll*p[i-1]%R;\n\t\telse p[i]=p[i-1];\n\twhile(T--){\n\t\tregister int n=in(),m=in();\n\t\tif(m<R&&R<=n)\n\t\t\t{puts(\"0\");continue;}\n\t\tregister int id=std::upper_bound(p2+1,p2+1+p[0],m)-(p2+1);\n\t\tif(id<1)\n\t\t\twr(fac[n]),putchar('\\n');\n\t\telse\n\t\t\twr(fac[n]*1ll*p1[id]%R*1ll*p[id]%R),putchar('\\n');\n\t}\n}\ninline int quick_mod(int a,int b,int c){\n\tregister int s=1;\n\twhile(b){\n\t\tif(b&1)s=(s*1ll*a)%c;\n\t\ta=(a*1ll*a)%c;b>>=1;\n\t}\n\treturn s;\n}\ninline void prime(){\n\tfor(register int i=2;i<N;++i)\n\t\tif(!vis[i]){\n\t\t\tp[++p[0]]=i;\n\t\t\tif(i*1ll*i>=N)continue;\n\t\t\tfor(register int j=i*i;j<N;j+=i)\n\t\t\t\tvis[j]=1;\n\t\t}\n}\ninline int in(){\n\tregister char c=getchar();\n\tregister int x=0,f=1;\n\tfor(;c<'0'||c>'9';c=getchar())\n\t\tif(c=='-')f=-1;\n\tfor(;c>='0'&&c<='9';c=getchar())\n\t\tx=(x<<1)+(x<<3)+(c&15);\n\treturn x*f;\n}\ninline void wr(int x){\n\tif(x<0)putchar('-'),x=-x;\n\tif(x/10)wr(x/10);\n\tputchar(x%10+'0');\n}\n```\n",
        "postTime": 1630895989,
        "uid": 50606,
        "name": "\u8a00\u7422\u10d3",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011P2155 [SDOI2008] \u6c99\u62c9\u516c\u4e3b\u7684\u56f0\u60d1"
    },
    {
        "content": "\u6700\u4f18\u89e3\u6765\u5199\u9898\u89e3\u5566\uff08\n\n# \u9898\u76ee\u5927\u610f\uff1a\n\n\u591a\u6d4b\uff1a\n$$ \\sum_{i=1}^{n!}[\\gcd(i,m!)=1] $$\n\u6839\u636e $ \\rm gcd $ \u7684\u7ed3\u8bba\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u7b54\u6848\u5176\u5b9e\u662f\uff1a\n$$ \\frac {n!} {m!} \\times \\varphi(m!) $$\n\u6069\uff0c\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u505a\u4e86\n\n\u9884\u5904\u7406 $ n! $ \u53ca\u5176\u9006\u5143\uff0c\u4ee5\u53ca $ \\varphi(n!) $\u3002\n\n\u90a3\u4e48\u600e\u4e48\u5f97\u5230 $ \\varphi(n!) $ \u5462\uff1f\u8003\u8651\u4ece $ \\varphi((n-1)!) $ \u9012\u63a8\u8fc7\u6765\u3002\n\n\u6ce8\u610f\u5230 $ n! $ \u6709\u4e00\u4e2a\u6027\u8d28\uff0c\u5c31\u662f\u5176\u4e3a\u6240\u6709\u4e0d\u5927\u4e8e $ n $ \u7684\u8d28\u6570\u7684\u500d\u6570\u3002\u4e5f\u5c31\u662f\u8bf4 $ \\varphi(n!) $ \u53ef\u4ee5\u5199\u6210\uff1a\n$$ \\prod_p^n \\varphi(p^k) $$\n\u5176\u4e2d\u6240\u6709\u7684 $ k $ \u4e00\u5b9a\u90fd\u4e0d\u5c0f\u4e8e $ 1 $\u3002\n\u5206\u7c7b\u8ba8\u8bba\u4e00\u4e0b\uff1a\n\n1. \u5f53 $ n $ \u4e3a\u8d28\u6570\u65f6\uff0c$ \\varphi(n!)=\\varphi((n-1)!) \\times (n-1) $\n2. \u5f53 $ n $ \u4e0d\u4e3a\u8d28\u6570\u65f6\uff0c$ \\varphi(n!)=\\varphi((n-1)!) \\times n $\n\n\u4e8e\u662f\u53ef\u4ee5\u9012\u63a8\u5f97\u5230 $ \\varphi(n!) $\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u524d\u9762\u7684\u90a3\u4e2a\u5206\u6570\uff0c\u90fd\u77e5\u9053\u5f53 $ n \\geq mod $ \u5e76\u4e14 $ m \\geq mod $ \u65f6\u662f\u4e0d\u80fd\u76f4\u63a5\u7b97\u7684\uff0c\u56e0\u4e3a $ n! $ \u4e2d\u7684 $ mod $ \u548c $ m! $ \u4e2d\u7684 $ mod $ \u6709\u53ef\u80fd\u4f1a\u62b5\u6d88\u6389\u3002\n\n\u4e8e\u662f\u5728\u9012\u63a8\u9636\u4e58\u7684\u65f6\u5019\u53ef\u4ee5\u7279\u5224\u4e00\u4e0b\uff0c\u5f53 $ i=mod $ \u65f6\u76f4\u63a5\u4ee4 $ n!=(n-1)! $\u3002\n\n\u5728\u8ba1\u7b97\u7684\u65f6\u5019\u518d\u5224\u65ad\u4e00\u4e0b $ \\lfloor \\frac n {mod} \\rfloor $ \u662f\u5426\u7b49\u4e8e $ \\lfloor \\frac m {mod} \\rfloor $ \u5c31\u53ef\u4ee5\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\u4e86\u3002\n\n\u590d\u6742\u5ea6\u4e3a $ O(n+T) $\u3002\n\ncode:\n```cpp\n#include<cstdio>\ntypedef __uint128_t L;\ntypedef unsigned long long ull;\nconst int M=1e7+5;\nint T,P,mx,top,n[10005],m[10005],pri[M],phi[M],fac[M],ifac[M];bool zhi[M];\nstruct FastMod{\n    ull b,m;\n    FastMod(ull b):b(b),m(ull((L(1)<<64)/b)){}\n    friend inline ull operator%(const ull&a,const FastMod&mod){\n        ull q=(L(mod.m)*a)>>64;\n        ull r=a-q*mod.b;\n        return r>=mod.b?r-mod.b:r;\n    }\n}mod(2);\nsigned main(){\n\tregister int i,j,x;\n\tscanf(\"%d%d\",&T,&P);phi[1]=fac[1]=ifac[1]=1;mod=FastMod(ull(P));\n\tfor(i=1;i<=T;++i)scanf(\"%d%d\",n+i,m+i),mx=n[i]>mx?n[i]:mx,mx=m[i]>mx?m[i]:mx;\n\tfor(i=2;i<=mx;++i){\n\t\tif(!zhi[i])pri[++top]=i,phi[i]=1;\n\t\tfor(j=1;j<=top&&(x=i*pri[j])<=M;++j){\n\t\t\tzhi[x]=true;if(!(i%pri[j]))break;\n\t\t}\n\t\tphi[i]=i-phi[i];\n\t}\n\tfor(i=2;i<=mx;++i){\n\t\tif(i^P)fac[i]=1ull*fac[i-1]*i%mod,ifac[i]=1ull*(P-P/i)*ifac[P%i]%mod;\n\t\telse fac[i]=fac[i-1],ifac[i]=1;\n\t}\n\tfor(i=2;i<=mx;++i)phi[i]=1ull*phi[i-1]*phi[i]%mod,ifac[i]=1ull*ifac[i-1]*ifac[i]%mod;\n\tfor(i=1;i<=T;++i)printf(\"%d\\n\",n[i]-n[i]%P==m[i]-m[i]%P?1ull*fac[n[i]]*ifac[m[i]]%mod*phi[m[i]]%mod:0);\n}\n```",
        "postTime": 1628470076,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u6570\u8bba \u6b27\u62c9\u51fd\u6570 P2155\u9898\u89e3"
    },
    {
        "content": "\u9898\u610f\u662f $n!$ \u4ee5\u5185\u4e0e $m!$ \u4e92\u8d28\u7684\u6570\u7684\u4e2a\u6570 $(n\\geq m)$\u3002\n\n\u6839\u636e\u6b27\u51e0\u91cc\u5f97\u7b97\u6cd5 $\\gcd(a,b)=\\gcd(a+kb)$\uff0c\u90a3\u4e48\u5982\u679c $y|x$\uff0cx\u4ee5\u5185\u4e0ey\u4e92\u8d28\u7684\u6570\u7684\u4e2a\u6570\uff0c\u5c31\u662f $\\varphi(y)x/y$\uff0c\u6b64\u9898 $n!$ \u662f $m!$ \u7684\u500d\u6570\uff0c\u6240\u4ee5\u7b54\u6848\u4e3a\n$$\\frac{n!\\varphi(m)}{m!}=\\frac{n!\\prod_{i=1}^m(i-isprime(i))}{m!}$$\n\u7b5b\u6cd5\u6c42\u51fan\u4ee5\u5185\u7684\u7d20\u6570\uff0c\u9884\u5904\u7406\u9636\u4e58\u548cphi\uff0c\u6bcf\u6b21\u8be2\u95ee\u76f4\u63a5\u56de\u7b54\u3002\n\n\u4f46\u6ce8\u610f\u5230\u9898\u76ee\u5e76\u6ca1\u6709\u8bf4\u660e\u6a21\u6570R\u7684\u8303\u56f4\uff0c\u6240\u4ee51~n\u7684\u6570\u4e2d\u6709\u53ef\u80fd\u542b\u6709R\u7684\u500d\u6570\uff0c\u5f0f\u5b50\u4e2d\u6709\u9664\u6cd5\uff0c\u8be2\u95ee\u65f6\u4f7f\u7528\u9006\u5143\u53ef\u80fd\u4f1a\u51fa\u95ee\u9898\u3002\u53ef\u4ee5\u5c06\u6570\u8868\u793a\u6210 $a\\times R^k$ \u7684\u5f62\u5f0f\uff0c\u5206\u522b\u5b58\u50a8a\u548ck\uff0c\u505a\u4e58\u6cd5\u65f6a\u76f8\u4e58k\u76f8\u52a0\uff0c\u505a\u9664\u6cd5\u65f6a\u4e58\u9006\u5143k\u76f8\u51cf\uff0c\u5224\u65ad\u4e00\u4e0bk\u662f\u5426\u7b49\u4e8e0\uff0c\u5373\u53ef\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\u3002\n```c++\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n#include <cmath>\n#include <ctime>\n#include <cstdlib>\nusing namespace std;\n\n#define Rep(i,l,r) for (int i = (l); i <= (r); ++ i)\n#define RepD(i,r,l) for (int i = (r); i >= (l); -- i)\n#define RepG(i,x) for (int i = hd[x]; i; i = e[i].nxt)\n\ntypedef long long ll;\n\nconst int N = 10000005;\n\nbool np[N];\nint mod, n, m, fac[N], phi[N], fac0[N], phi0[N];\n\nll power (ll x, int n) {\n\tll s = 1;\n\twhile (n) {if (n&1) (s *= x) %= mod; (x *= x) %= mod, n >>= 1;}\n\treturn s;\n}\n\nint main () {\n\tint T, lim = 1e7;\n\tscanf (\"%d%d\", &T, &mod);\n\tnp[1] = 1;\n\tRep(i,2,lim) if (!np[i])\n\t\tfor (int j = 2*i; j <= lim; j += i) np[j] = 1;\n\tfac[0] = phi[0] = 1, fac0[0] = phi0[0] = 0;\n\tRep(i,1,lim) {\n\t\tint x = i, k = 0;\n\t\twhile (x%mod==0) x /= mod, ++ k;\n\t\tfac[i] = 1ll*fac[i-1]*x%mod, fac0[i] = fac0[i-1]+k;\n\t\tx = (np[i]? i: i-1), k = 0;\n\t\twhile (x%mod==0) x /= mod, ++ k;\n\t\tphi[i] = 1ll*phi[i-1]*x%mod, phi0[i] = phi0[i-1]+k;\n\t}\n\twhile (T --) {\n\t\tscanf (\"%d%d\", &n, &m);\n\t\tll ans = 1ll*fac[n]*phi[m]%mod*power (fac[m], mod-2)%mod;\n\t\tif (fac0[n]+phi0[m]-fac0[m]) ans = 0;\n\t\tprintf (\"%lld\\n\", ans);\n\t}\n\treturn 0;\n}\n\n```",
        "postTime": 1543392626,
        "uid": 18479,
        "name": "yhgalaxy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2155 \u3010[SDOI2008]\u6c99\u62c9\u516c\u4e3b\u7684\u56f0\u60d1\u3011"
    }
]