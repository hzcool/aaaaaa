[
    {
        "content": "# \u6d1b\u8c37 P7648 \u9898\u89e3\n\n[$\\text{Link}$](https://www.luogu.com.cn/problem/P7648)\n\n## \u601d\u8def\u5206\u6790\n\n\u8bbe $dp_{t,x,y,i}$ \u8868\u793a\u5f53\u524d\u65f6\u95f4 $t$ \u79d2\uff0c\u6bd4\u5206 $x:y$\uff0c\u7403\u5728 $i$ \u624b\u4e2d\uff0c\u6bcf\u6b21\u679a\u4e3e\u53ef\u80fd\u6027\u5927\u529b\u8f6c\u79fb\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(TR^2n^2)$\uff0c\u9700\u8981\u4e00\u5b9a\u7684\u5361\u5e38\u6280\u5de7\u624d\u80fd\u901a\u8fc7\u672c\u9898\u3002\n\n\u63d0\u4ea4\u8bb0\u5f55\uff1a[TLE on #12](https://www.luogu.com.cn/record/83403436)\uff0c[Code Link](https://www.luogu.com.cn/paste/2k421wp7)\uff0c\u5e38\u6570\u8fc7\u5927\uff0c\u6c42\u5927\u4f6c\u5e2e\u5fd9\u5361\u5e38\u3002\n\n\n\n\u663e\u7136\uff0c\u521a\u624d\u7684\u505a\u6cd5\u590d\u6742\u5ea6\u6709\u4e9b\u95ee\u9898\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5bf9 dp \u8fc7\u7a0b\u8fdb\u884c\u4f18\u5316\u3002\n\n\u6211\u4eec\u53d1\u73b0\u8fdb\u7403\u6570\u91cf\u548c\u65f6\u95f4\u4e0d\u5339\u914d\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u53ea\u8003\u8651\u6bcf\u6b21\u8fdb\u7403\u53d1\u751f\u7684\u65f6\u5019\uff0c\u4ee5\u6b64\u6765\u4f18\u5316\u8f6c\u79fb\u5e45\u5ea6\uff0c\u4ee5\u8fdb\u7403\u4e3a\u6807\u5fd7\uff0c\u6bcf\u6b21\u8f6c\u79fb\u591a\u4e2a\u4e8b\u4ef6\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u51fa $i$ \u961f\u6301\u7403\uff0c$t$ \u79d2\u4e4b\u540e $j$ \u961f\u8fdb\u7403\u7684\u6982\u7387\u3002\n\n\u8bbe $dp_{t,x,y,i}$ \u8868\u793a $t$ \u79d2\u4e4b\u540e\uff0c\u6bd4\u5206 $x:y$ \u4e14\u7403\u5728 $i$ \u961f\u4e00\u53f7\u624b\u4e0a\uff08\u5bf9\u9762\u521a\u521a\u8fdb\u7403\uff09\u3002\n\n \u679a\u4e3e\u4e0b\u4e00\u6b21\u8fdb\u7403\u7684\u65f6\u95f4\u5373\u53ef\u8f6c\u79fb\u3002\n\n\u6ce8\u610f\uff0c\u6709\u53ef\u80fd\u4ece\u67d0\u4e2a\u65f6\u523b\u5f00\u59cb\u6ca1\u6709\u8fdb\u7403\uff0c\u6b64\u65f6\u8981\u76f4\u63a5\u628a $dp_{t,x,y,i}$ \u5806\u5230 $ans[x:y]$ \u4e2d\u3002\n\n\u56e0\u6b64\u6211\u4eec\u9700\u8981\u9884\u5904\u7406 $i$ \u961f\u6301\u7403\u65f6 $t$ \u79d2\u6ca1\u6709\u8fdb\u7403\u7684\u60c5\u51b5\uff0c\u76f4\u63a5\u7528\u521a\u521a\u9884\u5904\u7406\u51fa\u7684\u6982\u7387\u7d2f\u52a0\u7136\u540e\u505a\u524d\u7f00\u548c\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(Tn^2+T^2R^2)$\u3002\n\n## \u4ee3\u7801\u5448\u73b0\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int MAXN=205,MAXT=505;\nint siz[MAXN];\nvector <int> E[MAXN],F[MAXN];\ndouble p[MAXN];\ndouble hold[MAXT][MAXN];\t // t time i player hold the ball (without any score)\ndouble score[2][2][MAXT]; \t // team i hold the ball, team j score at moment t\ndouble s[2][MAXT]; \t\t\t// team i hold the ball, someone score before moment t\ndouble dp[MAXT][11][11][2];  // time t, score x:y, ball give to team i\ndouble ans[11][11];\nsigned main() {\n\tint n,R,T;\n\tscanf(\"%d%d%d\",&n,&R,&T);\n\tfor(int i=1;i<=n;++i) {\n\t\tint e,f;\n\t\tscanf(\"%lf%d%d\",&p[i],&e,&f);\n\t\tsiz[i]=e+f+1;\n\t\twhile(e--) {\n\t\t\tint x;\n\t\t\tscanf(\"%d\",&x);\n\t\t\tE[i].push_back(x);\n\t\t}\n\t\twhile(f--) {\n\t\t\tint x;\n\t\t\tscanf(\"%d\",&x);\n\t\t\tF[i].push_back(x+n);\n\t\t}\n\t}\n\tfor(int i=n+1;i<=n+n;++i) {\n\t\tint e,f;\n\t\tscanf(\"%lf%d%d\",&p[i],&e,&f);\n\t\tsiz[i]=e+f+1;\n\t\twhile(e--) {\n\t\t\tint x;\n\t\t\tscanf(\"%d\",&x);\n\t\t\tE[i].push_back(x+n);\n\t\t}\n\t\twhile(f--) {\n\t\t\tint x;\n\t\t\tscanf(\"%d\",&x);\n\t\t\tF[i].push_back(x);\n\t\t}\n\t}\n\tfor(int team:{0,1}) {\n\t\tmemset(hold,0,sizeof(hold));\n\t\tif(team) hold[0][n+1]=1;\n\t\telse hold[0][1]=1;\n\t\tfor(int t=0;t<=T;++t) {\n\t\t\tfor(int i=1;i<=n;++i) {\n\t\t\t\tfor(int j:E[i]) hold[t+1][j]+=hold[t][i]/siz[i]; \n\t\t\t\tfor(int j:F[i]) hold[t+1][j]+=hold[t][i]/siz[i]; \n\t\t\t\thold[t+1][n+1]+=hold[t][i]*(1-p[i])/siz[i];\n\t\t\t\tscore[team][0][t+1]+=hold[t][i]*p[i]/siz[i];\n\t\t\t}\n\t\t\tfor(int i=n+1;i<=n+n;++i) {\n\t\t\t\tfor(int j:E[i]) hold[t+1][j]+=hold[t][i]/siz[i]; \n\t\t\t\tfor(int j:F[i]) hold[t+1][j]+=hold[t][i]/siz[i]; \n\t\t\t\thold[t+1][1]+=hold[t][i]*(1-p[i])/siz[i];\n\t\t\t\tscore[team][1][t+1]+=hold[t][i]*p[i]/siz[i];\n\t\t\t}\n\t\t\ts[team][t]=score[team][0][t]+score[team][1][t];\n\t\t\tif(t) s[team][t]+=s[team][t-1];\n\t\t}\n\t}\n\tdp[0][0][0][0]=1;\n\tfor(int t=0;t<=T;++t) {\n\t\tfor(int x=0;x<=R;++x) {\n\t\t\tfor(int y=0;y<=R;++y) {\n\t\t\t\tfor(int team:{0,1}) {\n\t\t\t\t\tif(x==R||y==R||t==T) {\n\t\t\t\t\t\tans[x][y]+=dp[t][x][y][team];\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tans[x][y]+=dp[t][x][y][team]*(1-s[team][T-t]);\n\t\t\t\t\tfor(int k=1;k+t<=T;++k) {\n\t\t\t\t\t\tdp[k+t][x][y+1][0]+=dp[t][x][y][team]*score[team][1][k];\n\t\t\t\t\t\tdp[k+t][x+1][y][1]+=dp[t][x][y][team]*score[team][0][k];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfor(int x=0;x<=R;++x) {\n\t\tfor(int y=0;y<=R;++y) {\n\t\t\tif(x==R&&y==R) continue;\n\t\t\tprintf(\"%.10lf\\n\",ans[x][y]);\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1660266044,
        "uid": 539618,
        "name": "DaiRuiChen007",
        "ccfLevel": 6,
        "title": "\u6d1b\u8c37 P7648 \u9898\u89e3"
    }
]