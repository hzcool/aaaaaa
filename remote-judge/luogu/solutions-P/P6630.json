[
    {
        "content": "\u6839\u636e\u671f\u671b\u7684\u7ebf\u6027\u6027\u5c55\u5f00\uff0c\u5206\u522b\u6c42\u6bcf\u4e2a\u8282\u70b9\u6700\u540e\u5b58\u5728\u6807\u8bb0\u7684\u6982\u7387\u3002\n\n\u4e00\u4e2a\u8282\u70b9\u5206\u4e09\u4e2a\u72b6\u6001\uff0c\u7956\u5148\u548c\u81ea\u5df1\u90fd\u6ca1\u6709\u6807\u8bb0\uff0c\u81ea\u5df1\u6709\u6807\u8bb0\uff0c\u7956\u5148\u6709\u6807\u8bb0\u3002\n\n\u5982\u679c\u7956\u5148\u6709\u6807\u8bb0\uff0c\u90a3\u4e48\u5728\u8bbf\u95ee\u5230\u5144\u5f1f\u8282\u70b9\u7684\u65f6\u5019\u81ea\u5df1\u4f1a\u5f97\u5230\u6807\u8bb0\u3002\n\n\u5982\u679c\u81ea\u5df1\u6709\u6807\u8bb0\uff0c\u5728\u8bbf\u95ee\u5230\u81ea\u5df1\u7684\u5b50\u6811\u5185\u8282\u70b9\u65f6\u6807\u8bb0\u4f1a\u5931\u53bb\u3002\n\n\u5982\u679c\u8986\u76d6\u7684\u60c5\u51b5\u4e0b\u8bbf\u95ee\u5230\u5f53\u524d\u8282\u70b9\uff0c\u90a3\u4e48\u65e0\u8bba\u4ec0\u4e48\u60c5\u51b5\uff0c\u81ea\u5df1\u90fd\u4f1a\u5f97\u5230\u6807\u8bb0\u3002\n\n\u7c7b\u4f3c\u8ba8\u8bba\u4e00\u4e0b\uff0c\u5206\u522b\u8ba1\u7b97\u51fa \u8bbf\u95ee\u81ea\u5df1\uff0c\u8bbf\u95ee\u7956\u5148\uff0c\u8bbf\u95ee\u513f\u5b50\uff0c\u8bbf\u95ee\u5144\u5f1f\uff0c\u8be2\u95ee\u4e0d\u4ea4 \u7684\u6982\u7387\uff0c\u7136\u540e\u4e09\u79cd\u72b6\u6001\u4e4b\u95f4\u7684\u8f6c\u79fb\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e9b\u6982\u7387\u8fdb\u884c\u8868\u793a\u3002\n\n\u53d1\u73b0\u8fd9\u4e9b\u8f6c\u79fb\u53ef\u4ee5\u5199\u6210\u77e9\u9635\u7684\u5f62\u5f0f\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u77e9\u9635\u5feb\u901f\u5e42\u6c42\u89e3\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n3^3logk)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define I inline int\n#define V inline void\n#define ll long long int\n#define isnum(ch) ('0'<=ch&&ch<='9')\n#define FOR(i,a,b) for(int i=a;i<=b;i++)\n#define gc (_op==_ed&&(_ed=(_op=_buf)+fread(_buf,1,100000,stdin),_op==_ed)?EOF:*_op++)\nchar _buf[100000],*_op(_buf),*_ed(_buf);\nI getint(){\n\tint _s=0;char _ch=gc;\n\twhile(!isnum(_ch))_ch=gc;\n\twhile(isnum(_ch))_s=_s*10+_ch-48,_ch=gc;\n\treturn _s;\n}\nconst int N=5e5,mod=998244353;\nint n,m,rt,tot,ans,bas;\nint mid[N],len[N],ls[N],rs[N],f[N],s[N],g[N],h[N];\nV check(int&x){x-=mod,x+=x>>31&mod;}\nI calc(int x){return 1ll*x*(x+1)/2%mod;}\nI calc(int l,int r){return(calc(r)+mod-calc(l-1))%mod;}\nI Pow(ll t,int x,ll s=1){for(;x;x>>=1,t=t*t%mod)if(x&1)s=s*t%mod;return s;}\n#define lc ls[p]\n#define rc rs[p]\n#define root rt,1,n\n#define lson lc,L,mid[p]\n#define rson rc,mid[p]+1,R\n#define mul(a,b,c){\\\n\t\tFOR(i,0,2)FOR(j,0,2)FOR(k,0,2)tmp[i][j]+=1ll*a[i][k]*b[k][j];\\\n\t\tFOR(i,0,2)FOR(j,0,2)c[i][j]=tmp[i][j]%mod,tmp[i][j]=0;}\nV init(int&p,int L,int R){\n\tif(len[p=++tot]=R-L+1,L==R)return;\n\tmid[p]=getint(),init(lson),init(rson);\n}\nV work(int p,int L,int R,int fa=0){\n\tstatic ll tmp[3][3],S[3][3],T[3][3];\n\th[p]=1ll*(calc(L-1)+calc(n-R))*bas%mod;\n\tf[p]=(1ll*L*(n+1-R)%mod*bas+mod-s[fa])%mod,check(s[p]=s[fa]+f[p]);\n\tll p1=f[p],p2=s[fa],p3=g[p],p4=(1ll*(R-L)*(n-R+L-1)+calc(R-L+1)-1)%mod*bas%mod,p5=h[fa];\n\tFOR(i,0,2)FOR(j,0,2)S[i][j]=i==j;\n\tT[0][0]=(p3+p4+p5)%mod,T[0][1]=p2,T[0][2]=p1;\n\tT[1][0]=p4,T[1][1]=(p2+p5)%mod,T[1][2]=(p1+p3)%mod;\n\tT[2][0]=p4,T[2][1]=0,T[2][2]=(p1+p2+p3+p5)%mod;\n\tfor(int x=m;x;x>>=1){if(x&1)mul(S,T,S);mul(T,T,T);}\n\tif(check(ans+=S[0][2]),L==R)return;\n\tg[lc]=(1ll*(R-mid[p])*(n-R)+calc(R-mid[p]))%mod*bas%mod;\n\tg[rc]=(1ll*(mid[p]-L+1)*(L-1)+calc(mid[p]-L+1))%mod*bas%mod;\n\twork(lson,p),work(rson,p);\n}\nint main(){\n\tn=getint(),m=getint(),bas=Pow(calc(n),mod-2);\n\tinit(root),work(root),cout<<ans;\n\treturn 0;\n}\n```\n",
        "postTime": 1593257238,
        "uid": 109236,
        "name": "Fuyuki",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6630 \u3010[ZJOI2020] \u4f20\u7edf\u827a\u80fd\u3011"
    },
    {
        "content": "\u540c\u6b65\u4e8e[\u6211\u7684 Blog](https://www.cnblogs.com/werner-yin/p/15862977.html)\n\n\n> \u6709\u4e00\u68f5\u5e7f\u4e49\u7ebf\u6bb5\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u6709\u4e00\u4e2a $m$ \u503c\u3002\u4e00\u5f00\u59cb `tag` \u6570\u7ec4\u5747\u4e3a $0$\uff0cBob \u4f1a\u6267\u884c $k$ \u6b21\u64cd\u4f5c\uff0c\u6bcf\u6b21\u64cd\u4f5c\u7b49\u6982\u7387\u968f\u673a\u9009\u62e9\u533a\u95f4 $[l, r]$ \u5e76\u6267\u884c `MODIFY(root,1,n,l,r);`\u3002\n> \u6700\u540e\u6240\u6709 `Node` \u4e2d\u6ee1\u8db3 `tag[Node]=1` \u7684\u671f\u671b\u6570\u91cf\u3002\n> $n \\le 2\\times 10^5$\n\n---\n\n\u3000\u3000\u770b\u7740\u9898\u89e3\u60f3\u9524\u4eba\u7684\u9898\u3002\u3002\u3002\n\n\u3000\u3000\u5f88\u591a\u9898\u89e3\u90fd\u4e0d\u8bb2\u6e05\u72b6\u6001\u7684\u8bbe\u8ba1\uff0c\u4ee5\u53ca\u4e3a\u4ec0\u4e48\u53ea\u8981\u4e00\u4e2a $3\\times3$ \u7684\u77e9\u9635\uff0c\u4e3a\u4ec0\u4e48\u72b6\u6001\u53ef\u4ee5\u8fd9\u4e48\u8bbe\u8ba1\uff0c\u4e8e\u662f\u81ea\u884c\u7814\u7a76\u4e86\u4e00\u4e2a $4\\times 4$ \u7684\u77e9\u9635\u7684\u505a\u6cd5\u624d\u660e\u767d\u539f\u56e0\u3002\u4e8e\u662f\u8fd9\u4e2a\u9898\u89e3\u8bb2\u4e00\u4e2a\u6bd4\u8f83\u597d\u7406\u89e3\u7684\u65b9\u5f0f\u3002\n\n\u3000\u3000\u9996\u5148\uff0c\u8003\u8651\u6839\u636e\u671f\u671b\u7684\u7ebf\u6027\u6027\u8ba1\u7b97\u7b54\u6848\uff0c\u8ba1\u7b97**\u6bcf\u4e2a\u8282\u70b9\u6700\u540e\u6709 tag \u7684\u6982\u7387**\uff0c\u6bd4\u8f83\u663e\u7136\u7684\u4e8b\u60c5\u5c31\u662f tag \u53ea\u6709\u4e24\u79cd\uff1a\u7956\u5148\u7684 tag\uff08\u662f\u5426\u5b58\u5728\u4e00\u4e2a\u7956\u5148\u7684 tag = 1\uff09 \u548c\u81ea\u5df1\u7684 tag\u3002\u63a5\u7740\u6211\u4eec\u53ef\u4ee5\u53ea\u8bb0\u5f55\u8fd9\u4e24\u79cd tag\uff0c\u5e76\u5c06\u6bcf\u6b21\u64cd\u4f5c\u7684\u8282\u70b9\u5206\u7c7b\uff1a\n\n* A. \u7236\u4eb2\u533a\u95f4\u548c\u64cd\u4f5c\u533a\u95f4\u6ca1\u6709\u4ea4\u96c6\uff1a\u4ec0\u4e48\u4e5f\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\u3002\n* B. \u7236\u4eb2\u533a\u95f4\u88ab\u64cd\u4f5c\u533a\u95f4\u5305\u542b\uff1a\u7956\u5148\u7684 tag = 1\uff0c\u81ea\u5df1\u7684 tag \u4e0d\u53d8\u3002\n* \u7236\u4eb2\u533a\u95f4\u548c\u64cd\u4f5c\u533a\u95f4**\u6709\u4ea4**\uff08\u4f46\u662f\u4e0d\u88ab\u5305\u542b\uff09\n\n  * C. \u81ea\u5df1\u4e0e\u64cd\u4f5c\u533a\u95f4\u6ca1\u6709\u4ea4\u96c6\uff1a\u81ea\u5df1\u7684 tag |= \u7956\u5148\u7684 tag\uff0c \u7956\u5148\u7684 tag = 0\u3002\n  * D. \u81ea\u5df1\u533a\u95f4\u88ab\u64cd\u4f5c\u533a\u95f4\u5305\u542b\uff1a\u7956\u5148\u7684 tag = 0\uff0c \u81ea\u5df1\u7684 tag = 1\u3002\n  * E. \u81ea\u5df1\u533a\u95f4\u548c\u64cd\u4f5c\u533a\u95f4\u6709\u4ea4\uff1a\u7956\u5148\u7684 tag = \u81ea\u5df1\u7684 tag = 0\u3002\n\n\u3000\u3000\u7136\u540e\u6309\u7167\u7f16\u53f7 ABCDE \u8ba1\u7b97\u65b9\u6848\u6570\u3002\n\n> \u5173\u4e8e\u65b9\u6848\u6570\u7684\u8ba1\u7b97\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5355\u4e2a\u8282\u70b9\u4e0e\u64cd\u4f5c\u533a\u95f4 \u6ca1\u6709\u4ea4\u96c6/\u88ab\u5305\u542b/\u6ca1\u6709\u88ab\u5305\u542b\u4f46\u662f\u6709\u4ea4\u96c6 \u7684\u6982\u7387\u662f\u6bd4\u8f83\u597d\u8ba1\u7b97\u7684\u3002\n> \u90a3\u4e48 $A,B$ \u53ef\u4ee5\u4ece\u7236\u4eb2\u8282\u70b9\u7ee7\u627f\u8fc7\u6765\uff0c$C$ \u5c31\u662f\u81ea\u5df1\u7684\u6ca1\u6709\u4ea4\u96c6\u7684\u6982\u7387-\u7236\u4eb2\u6ca1\u6709\u4ea4\u96c6\u7684\u6982\u7387\uff0c$D$ \u5c31\u662f\u81ea\u5df1\u88ab\u5305\u542b\u7684\u6982\u7387-\u7236\u4eb2\u88ab\u5305\u542b\u7684\u6982\u7387\uff0c\u6700\u540e\u4e00\u4e2a\uff0c$E =1-A-B-C-D$ \u5373\u53ef\u3002\n\n\u3000\u3000\u4e4b\u540e\u9b54\u5e7b\u7684\u4e8b\u60c5\u5c31\u6765\u4e86\uff0c\u5927\u90e8\u5206\u9898\u89e3\u90fd\u76f4\u63a5\u8bf4\u7ef4\u62a4\u4e00\u4e2a $3\\times3$ \u7684\u77e9\u9635\u7136\u540e\u641e\u641e\u641e\u641e\u641e\uff0c\u751a\u81f3\u6709\u7684\u6ca1\u6709\u8bb2\u6e05\u72b6\u6001\u7684\u5b9a\u4e49\uff0c\u4ee4\u4eba\u4e00\u8138\u8499 B\uff0c\u770b\u4e86\u534a\u5e74\uff08\u5c24\u5176\u662f\u5f0f\u5b50\u6bd4\u8f83\u590d\u6742\uff0c\u8fd8\u4e0d\u5982\u81ea\u5df1\u63a8\u4e00\u63a8\uff0c\u4e8e\u662f\u6211\u5c31\u63a8\u4e86\u5927\u534a\u5929\u624d\u660e\u767d\uff09\u3002\n\n\u3000\u3000\u6700\u6734\u7d20\u76f4\u63a5\u7684\u60f3\u6cd5\u5e94\u8be5\u662f\u8bbe $f_0, f_1, f_2, f_3$ \u8868\u793a \u7956\u5148\u548c\u81ea\u5df1 tag \u90fd\u4e3a 0 \u3001\u53ea\u6709\u81ea\u5df1\u7684 tag = 1\u3001\u5b58\u5728\u4e00\u4e2a\u7956\u5148 tag = 1\u3001\u81ea\u5df1 tag = 1 \u5e76\u4e14\u5b58\u5728\u4e00\u4e2a\u7956\u5148 tag = 1 \u7684\u6982\u7387\uff0c\u8f6c\u79fb\u7684\u8bdd\u53ef\u4ee5\u6839\u636e\u5b9a\u4e49\u4ee5\u53ca\u53d8\u5316\u5217\u51fa\u4ee5\u4e0b\u5f0f\u5b50\uff1a\n\n$$\n\\left\\{\n\\begin{aligned}\nf'_0 &= Af_0 + Cf_0 + E(f_0 + f_1 + f_2 + f_3)\\\\\nf'_1 &= Af_1 + C(f_1+f_2+f_3)+D(f_0+f_1+f_2+f_3)\\\\\nf'_2 &= Af_2 + B(f_0 + f_2)\\\\\nf'_3 &= Af_3 + B(f_1 + f_3)\n\\end{aligned}\n\\right.\n$$\n\n\u3000\u3000\u8fd9\u4e2a\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 $4\\times 4$ \u7684\u77e9\u9635\u7ef4\u62a4\uff0c\u6700\u540e\u7684\u7b54\u6848\u5c31\u662f $f_1+f_3$\u3002\n\n\n\u3000\u3000\u4f46\u662f\u4e3a\u4ec0\u4e48\u5f88\u591a\u9898\u89e3\u90fd\u62ff\u7684 $3\\times 3$ \u7684\u77e9\u9635\u5462\uff1f\n\n\u3000\u3000\u6211\u4eec\u53ef\u4ee5\u6ce8\u610f\u5230\uff0c\u6700\u540e\u7684\u7b54\u6848\u5c31\u662f $f_1+f_3$\uff0c\u7136\u540e\u518d\u81ea\u5df1\u89c2\u5bdf\u4e00\u4e0b\u4e24\u4e2a\u7684\u8f6c\u79fb\u7684\u5f0f\u5b50\uff0c\u5c31\u53ef\u4ee5\u53d1\u73b0\u53ef\u4ee5\u5c06\u4e24\u4e2a\u5f0f\u5b50\u5408\u5e76\u5230\u4e00\u8d77\uff0c\u4e8e\u662f\u53ef\u4ee5\u76f4\u63a5\u7ef4\u62a4\u4e00\u4e2a $3 \\times 3$ \u7684\u77e9\u9635\u4e86\u3002\n\n\u3000\u3000\u5177\u4f53\u5730\uff0c\u5c06 $f_1$ \u72b6\u6001\u8bbe\u4e3a **\u81ea\u5df1\u7684 tag=1\uff0c\u7956\u5148\u7684 tag \u4efb\u610f\u7684\u6982\u7387**\uff0c\u5176\u4f59\u4e0d\u53d8\uff0c\u7136\u540e\u5f0f\u5b50\u5927\u6982\u957f\u8fd9\u6837\uff1a\n\n$$\n\\left\\{\n\\begin{aligned}\nf'_0 &= Af_0 + Cf_0 + E(f_0 + f_1 + f_2)\\\\\nf'_1 &= Af_1 + C(f_1+f_2)+D(f_0+f_1+f_2)\\\\\nf'_2 &= Af_2 + B(f_0 + f_2)\\\\\n\\end{aligned}\n\\right.\n$$\n\n\u3000\u3000\u7136\u540e\u53ef\u4ee5\u4f7f\u7528 $3\\times3$ \u7684\u77e9\u9635\u7ef4\u62a4\u4e86\uff0c\u4e5f\u53ef\u4ee5\u6839\u636e $f_0 + f_1+f_2 = 1$ \uff0c\u5728\u77e9\u9635\u4e2d\u7ef4\u62a4\u4e24\u4e2a\u72b6\u6001 + \u4e00\u4e2a\u5355\u4f4d\u5143\u3002\n\n\u3000\u3000\u56e0\u4e3a $4\\times4$ \u7684\u53ef\u4ee5\u76f4\u63a5\u8fc7\uff0c\u4e8e\u662f $3\\times 3$ \u4ee3\u7801\u6ca1\u5199\uff0c\u4e0b\u9762\u7684\u662f $4\\times 4$ \u7684\u4ee3\u7801\uff0c\u6240\u4ee5\u5982\u679c $3\\times3$ \u7684\u5f0f\u5b50\u6709\u95ee\u9898\u53ef\u4ee5\u4e0e\u6211\u8054\u7cfb\u3002\n  \n\u3000\u3000[\u4ee3\u7801(gitee)](https://gitee.com/yinjinrun/code-public-2/blob/master/Luogu/P6630.cpp)\n  \n ```cpp\n #include <bits/stdc++.h>\n\n#define eb emplace_back\n#define ep emplace\n#define fi first\n#define se second\n#define in read<int>()\n#define lin read<ll>()\n#define rep(i, x, y) for(int i = (x); i <= (y); i++)\n#define per(i, x, y) for(int i = (x); i >= (y); i--)\n\nusing namespace std;\n\nusing ll = long long;\nusing db = double;\nusing pii = pair < int, int >;\nusing vec = vector < int >;\nusing veg = vector < pii >;\n\ntemplate < typename T > T read() {\n\tT x = 0; bool f = 0; char ch = getchar();\n\twhile(!isdigit(ch)) f |= ch == '-', ch = getchar();\n\twhile(isdigit(ch)) x = x * 10 + (ch ^ 48), ch = getchar();\n\treturn f ? -x : x;\n}\n\ntemplate < typename T > void chkmax(T &x, const T &y) { x = x > y ? x : y; }\ntemplate < typename T > void chkmin(T &x, const T &y) { x = x < y ? x : y; }\n\nconst int N = 2e5 + 10;\nconst int mod = 998244353;\nconst int inv2 = (mod + 1) >> 1;\n\nint n, K, iv, ans;\n\nll qp(ll x, int t) { ll res = 1; for(; t; t >>= 1, x = x * x % mod) if(t & 1) res = res * x % mod; return res; }\n\nstruct node {\n\tint a, b, c; // a : \u4e0d\u4ea4, b : \u88ab\u5305\u542b, c : \u4e0d\u88ab\u5305\u542b\u4f46\u662f\u6709\u4ea4\n\tnode(int l, int r) {\n\t\ta = (1ll * l * (l - 1) / 2 % mod * iv % mod + 1ll * (n - r + 1) * (n - r) / 2 % mod * iv % mod) % mod;\n\t\tb = 1ll * l * (n - r + 1) % mod * iv % mod;\n\t\tc = (mod * 2 - a - b + 1) % mod;\n\t} node(int _a, int _b, int _c) : a(_a), b(_b), c(_c) { }\n\tnode() { a = b = c = 0; }\n};\n\nstruct mat {\n\tint a[4][4];\n\tmat() { memset(a, 0, sizeof a); }\n\tint* operator [](int x) { return a[x]; }\n\tfriend mat operator * (mat a, mat b) {\n\t\tmat c;\n\t\trep(i, 0, 3) rep(j, 0, 3) if(a[i][j])\n\t\t\trep(k, 0, 3) c[i][k] = (c[i][k] + 1ll * a[i][j] * b[j][k] % mod) % mod;\n\t\treturn c;\n\t}\n} t;\n\t\nvoid solve(int l, int r, const node &lst) {\n\tt = mat(); node c(l, r);\n\tll A = lst.a, B = lst.b, C = (c.a - lst.a + mod) % mod, D = (c.b - lst.b + mod) % mod, E = (1ll - A - B - C - D + mod * 4ll) % mod;\n\t\n\t\n\tt[0][0] = (A + C + E) % mod; t[0][1] = D;                 t[0][2] = B;\n\tt[1][0] = E;                 t[1][1] = (A + C + D) % mod;                              t[1][3] = B;\n\tt[2][0] = E;                 t[2][1] = (C + D) % mod;     t[2][2] = (A + B) % mod; \n\tt[3][0] = E;                 t[3][1] = (C + D) % mod;     t[3][2] = 0;                 t[3][3] = (A + B) % mod;\n\t\n\tmat res = t; for(int v = K - 1; v; v >>= 1, t = t * t) if(v & 1) res = res * t;\n\tans = (ans + res[0][1]) % mod; ans = (ans + res[0][3]) % mod;\n\tif(l == r) return; int mid = in; solve(l, mid, c); solve(mid + 1, r, c);\n}\n\nint main() {\n#ifndef ONLINE_JUDGE\n\tfreopen(\"1.in\", \"r\", stdin);\n#endif\n\tn = in, K = in; iv = qp(1ll * n * (n + 1) / 2 % mod, mod - 2);\n\tsolve(1, n, node(0, 0, 1)); printf(\"%d\\n\", ans); return 0;\n}\n\n ```",
        "postTime": 1643963428,
        "uid": 167354,
        "name": "Werner_Yin",
        "ccfLevel": 9,
        "title": "P6630 [ZJOI2020] \u4f20\u7edf\u827a\u80fd \u9898\u89e3"
    },
    {
        "content": "## \u524d\u8a00\n\u8fd9\u9898\u548c [ZJOI2019]\u7ebf\u6bb5\u6811 \u5b8c\u5168\u4e00\u81f4\uff01\uff011\n## Section 1\n\u6211\u4eec\u76f4\u63a5\u628a\u603b\u671f\u671b\u5957\u8def\u5730\u62c6\u6210\u6bcf\u4e2a\u8282\u70b9\u6709 tag \u7684\u671f\u671b\u3002\u7531\u4e8e\u53ea\u6709 $O(n)$ \u4e2a\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u590d\u6742\u5ea6\u8fd8\u662f\u6bd4\u8f83\u5145\u88d5\u7684\u3002\n\n\u6211\u4eec\u4f9d\u65e7\u5ef6\u7eed\u524d\u4e00\u9898\u7684\u601d\u8def\uff0c\u5c06\u7ebf\u6bb5\u6811\u4e0a\u7684\u8282\u70b9\u5206\u4e3a $5$ \u7c7b\uff1a\n\n![](https://i.loli.net/2019/04/02/5ca2b0fce8b8c.png)\n\n\uff08\u56fe\u662f Sooke \u7684\uff09\n\n\u8fd9\u5f20\u56fe\u4e0a\u7684\u767d\uff0c\u6df1\u7070\uff0c\u6a59\uff0c\u6d45\u7070\uff0c\u9ec4\u5206\u522b\u5bf9\u5e94\u4e86\u8fd9\u4e94\u7c7b\u8282\u70b9\u7684\u4f4d\u7f6e\u3002\n## Section 2\n\u90a3\u4e48\u663e\u7136\u6bcf\u6b21\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u4e00\u4e2a\u8282\u70b9\u5404\u6709 $p_1,p_2,p_3,p_4,p_5$ \u7684\u6982\u7387\u6210\u4e3a\u8fd9\u4e94\u7c7b\u8282\u70b9\u3002\n\n\u6211\u4eec\u8003\u8651\u600e\u4e48\u7b97\u8fd9\u4e9b\u6982\u7387\u3002\n\n\u4e0b\u6587\u4e2d\uff0c\u4ee4\u67e5\u8be2\u7684\u533a\u95f4\u4e3a $A$\uff0c\u8282\u70b9\u4ee3\u8868\u7684\u533a\u95f4\u4e3a $B$\uff0c\u8282\u70b9\u7236\u4eb2\u4ee3\u8868\u7684\u533a\u95f4\u4e3a $F$\u3002\n\n\u7b2c\u4e00\u7c7b\uff1a\u767d\u8272\n\n$$A\\cap B\\neq\\varnothing,B\\not\\subseteq A$$\n\n\u7b2c\u4e8c\u7c7b\uff1a\u6df1\u7070\u8272\n\n$$B\\subseteq A,F\\not\\subseteq A$$\n\n\u7b2c\u4e09\u7c7b\uff1a\u6a59\u8272\n\n$$A\\cap B=\\varnothing,F\\cap B\\neq\\varnothing$$\n\n\u7b2c\u56db\u7c7b\uff1a\u6d45\u7070\u8272\n\n$$F\\subseteq A$$\n\n\u7b2c\u4e94\u7c7b\uff1a\u9ec4\u8272\n\n$$F\\cap B=\\varnothing$$\n\n\u7136\u540e\u4f60\u53d1\u73b0\u8fd9\u4e9b\u4e1c\u897f\u90fd\u53ef\u4ee5 $O(1)$ \u7b97\u3002\n## Section 3\n\u7136\u540e\u6211\u4eec\u6cbf\u7528\u4e0a\u4e00\u9898\u7684\u5957\u8def\uff0c\u8bb0 $f$ \u4e3a\u8fd9\u4e2a\u8282\u70b9\u6709 tag \u7684\u671f\u671b\uff0c$g$ \u4e3a\u8fd9\u4e2a\u8282\u70b9\u6240\u6709\u7956\u5148\u90fd\u6ca1\u6709 tag \u7684\u671f\u671b\u3002\n\n\u4e8e\u662f\u4e94\u7c7b\u70b9\u7684 $f,g$ \u8f6c\u79fb\u5c31\u80fd\u6c42\u51fa\u6765\u4e86\uff0c\u5177\u4f53\u53ef\u4ee5\u770b\u770b\u90a3\u9898\u7684\u9898\u89e3\u3002\n\n\u5c06\u6bcf\u4e2a\u70b9\u7684\u8f6c\u79fb\u4e58\u4e0a\u5bf9\u5e94\u7684\u6982\u7387 $p$\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230\u603b\u8f6c\u79fb\u65b9\u7a0b\u3002\u8fd9\u4e2a\u65b9\u7a0b\u663e\u7136\u53ef\u4ee5\u5316\u6210\u4e00\u4e2a $3\\times 3$ \u7684\u77e9\u9635\u7136\u540e\u5feb\u901f\u5e42\uff0c\u4e8e\u662f\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n\\log k)$\uff0c\u8981\u4e58\u4e0a\u77e9\u9635\u5feb\u901f\u5e42\u7684 $27$ \u500d\u5e38\u6570\u3002\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\ninline int read(){\n   int s=0,w=1;\n   char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}\n   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();\n   return s*w;\n}\nconst int p=998244353;\nstruct mat\n{\n\tint a[3][3];\n\tmat operator*(const mat&t)const\n\t{\n\t\tmat r;\n\t\tfor(int i=0; i<3; ++i) for(int j=0; j<3; ++j) r.a[i][j]=0;\n\t\tfor(int i=0; i<3; ++i) for(int j=0; j<3; ++j) for(int k=0; k<3; ++k) (r.a[i][k]+=a[i][j]*t.a[j][k])%=p;\n\t\treturn r;\n\t}\n};\nmat qp(mat x,int y)\n{\n\tmat res=x;\n\t--y;\n\tfor(mat t=x; y; y>>=1,t=t*t) if(y&1) res=res*t;\n\treturn res;\n}\nint qp(int x,int y)\n{\n\tint res=1;\n\tfor(int t=x; y; y>>=1,t=t*t%p) if(y&1) res=res*t%p;\n\treturn res;\n}\nint n=read(),k=read(),g=qp(((n*(n+1))>>1)%p,p-2),ans,qwq[200003];\nint calc(int l,int r,int fl,int fr)\n{\n\tmat m;\n\tfor(int i=0; i<3; ++i) for(int j=0; j<3; ++j) m.a[i][j]=0;\n\tm.a[2][2]=1;//f=0 g=1 1=1\n\tint A=(p*3+qwq[n]-(l*(n+1-r)%p)-qwq[l-1]-qwq[n-r])%p*g%p,\n\t    B=(l*(n-r+1)-fl*(n-fr+1))%p*g%p,\n\t\tC=(p*2+qwq[l-1]+qwq[n-r]-qwq[max(fl-1,0ll)]-qwq[n-fr])%p*g%p,\n\t\tD=fl*(n-fr+1)%p*g%p,\n\t\tE=(qwq[max(fl-1,0ll)]+qwq[n-fr])%p*g%p;\n\tassert((A+B+C+D+E)%p==1);\n\t(m.a[2][1]+=A)%=p,\n\t(m.a[2][0]+=B)%=p,\n\t(m.a[2][0]+=C)%=p,\n\t(m.a[1][0]+=p-C)%=p,\n\t(m.a[1][1]+=C)%=p,\n\t(m.a[0][0]+=D)%=p,\n\t(m.a[0][0]+=E)%=p,\n\t(m.a[1][1]+=E)%=p,\n\tm=qp(m,k);\n\treturn (m.a[1][0]+m.a[2][0])%p;\n}\nvoid dfs(int l,int r,int fl,int fr)\n{\n\t(ans+=calc(l,r,fl,fr))%=p;\n\tif(l==r) return ;\n\tint mid=read();\n\tdfs(l,mid,l,r),dfs(mid+1,r,l,r);\n\treturn ;\n}\nsigned main()\n{\n\tfor(int i=1; i<=n; ++i) qwq[i]=((i*(i+1))>>1)%p;\n\tdfs(1,n,0,n),printf(\"%lld\\n\",ans);\n    return 0;\n}\n\n\n```",
        "postTime": 1614046356,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P6630\u3010[ZJOI2020] \u4f20\u7edf\u827a\u80fd\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u6bcf\u4e2a\u7ed3\u70b9\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u6240\u4ee5\u4e0d\u59a8\u5206\u5f00\u8ba1\u7b97\u8d21\u732e\u3002\n\n\u6309\u7167[P5280](https://www.luogu.com.cn/problem/P5280)\u7684\u5957\u8def\uff0c\u6211\u4eec\u5b9a\u4e49 $P_o$ \u4e3a $o$ \u4e0a\u6709\u6807\u8bb0\u7684\u6982\u7387\uff0c$P_f$ \u4e3a $o$ \u53ca\u5176\u7956\u5148\u4e0a\u6709\u6807\u8bb0\u7684\u6982\u7387\uff0c\u540c\u65f6\u8bb0 $o$ \u63a7\u5236\u7684\u533a\u95f4\u4e3a $[L,R]$\uff0c$o$ \u7684\u7236\u4eb2\u7684\u4e3a $[l,r]$\uff08\u53ef\u4ee5\u907f\u514d\u5bf9\u5de6/\u53f3\u513f\u5b50\u7684\u5206\u7c7b\u8ba8\u8bba\uff09\uff0c\u4fee\u6539\u533a\u95f4\u4e3a $[x,y]$\u3002\n\n\u8003\u8651\u4ee5\u4e0b\u4e94\u79cd\u60c5\u51b5\uff1a\n\n1. \u4fee\u6539\u4e0d\u4f1a\u8fdb\u5165 $o$ \u7684\u7236\u4eb2\u3002\u5219 $1\\le x\\le y<l$ \u6216 $r<x\\le y\\le n$\uff0c\u6b64\u65f6 $P_o'=P_o,P_f'=P_f$\u3002\n2. \u4fee\u6539\u8fdb\u5165 $o$ \u7684\u7236\u4eb2\uff0c\u5e76\u5728 $o$ \u4e0a\u6253\u4e86\u6807\u8bb0\u3002\u5219 $1\\le x\\le L,R\\le y<r$ \u6216 $l<x\\le L,R\\le y\\le n$\uff0c\u6b64\u65f6 $P_o'=P_f'=1$\u3002\n3. \u4fee\u6539\u6807\u8bb0\u4e86 $o$ \u7684\u7956\u5148\u3002\u5219 $1\\le x\\le l,r\\le y\\le n$\uff0c\u6b64\u65f6 $P_o'=P_o,P_f'=1$\u3002\n4. \u4fee\u6539\u4e0b\u63a8\u4e86 $o$ \u7684\u7236\u4eb2\u7684\u6807\u8bb0\uff0c\u4f46\u6ca1\u6709\u8fdb\u5165 $o$\u3002\u5219 $l\\le y<L,1\\le x\\le y$ \u6216 $R<x\\le r,x\\le y\\le n$\uff0c\u6b64\u65f6 $P_o'=P_f'=P_f$\u3002\n5. \u4fee\u6539\u8fdb\u5165\u4e86 $o$\u3002\u5219 $P_o'=P_f'=0$\u3002\n\n\u663e\u7136\u6bcf\u6b21\u8f6c\u79fb\u7684\u7cfb\u6570\u90fd\u4e0d\u53d8\uff0c\u56e0\u6b64\u53ef\u4ee5\u7528\u77e9\u9635\u52a0\u901f\u3002\u540c\u65f6\uff0c\u6709\u4e00\u4e2a\u53ef\u4ee5\u5927\u5927\u51cf\u5c0f\u5e38\u6570\u7684 trick\uff1a\u53ef\u4ee5\u6ce8\u610f\u5230 $3\\times 3$ \u77e9\u9635\u4e2d\u5728\u53d8\u5316\u7684\u503c\u53ea\u6709 5 \u4e2a\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u8ba1\u7b97\u8fd9 5 \u4e2a\u503c\u5c31\u53ef\u4ee5\u4e86\uff0c\u53ef\u4ee5\u5c06\u4e58\u6cd5\u6b21\u6570\u51cf\u5c0f\u5230 7 \u6b21\uff0c\u53d6\u6a21\u6b21\u6570\u51cf\u5c0f\u5230 5 \u6b21\u3002\n\ncode:\n\n```cpp\n#include<cstdio>\ntypedef long long ll;\nconst int mod=998244353;\nconst int BUF=1<<21;\nchar rB[BUF],*rS,*rT;\ninline char gc(){return rS==rT&&(rT=(rS=rB)+fread(rB,1,BUF,stdin),rS==rT)?EOF:*rS++;}\ninline int rd(){\n    char c=gc();\n    while(c<48||c>57)c=gc();\n    int x=c&15;\n    for(c=gc();c>=48&&c<=57;c=gc())x=x*10+(c&15);\n    return x;\n}\nint n,k,div,ans;\ninline void inc(int&a,int b){a+=b;if(a>=mod)a-=mod;}\nvoid exgcd(int a,int b,int&x,int&y){\n\tif(!b){x=1;y=0;}\n\telse{\n\t\texgcd(b,a%b,y,x);\n\t\ty-=a/b*x;\n\t}\n}\ninline int inv(int a){\n\tint x,y;\n\texgcd(a,mod,x,y);\n\treturn x+((x>>31)&mod);\n}\nstruct mat{\n\tint a11,a12,a13,a22,a23;\n\tmat(int a,int b,int c,int d,int e):a11(a),a12(b),a13(c),a22(d),a23(e){}\n\tinline mat operator*(const mat&b)const{return mat((ll)a11*b.a11%mod,((ll)a11*b.a12+(ll)a12*b.a22)%mod,((ll)a11*b.a13+(ll)a12*b.a23+a13)%mod,(ll)a22*b.a22%mod,((ll)a22*b.a23+a23)%mod);}\n};\ninline int fp(mat a){\n\tmat s(1,0,0,1,0);\n\tfor(int p=k;p;p>>=1){\n\t\tif(p&1)s=s*a;\n\t\ta=a*a;\n\t}\n\treturn s.a13;\n}\nvoid solve(int L,int R,int l,int r){\n\tif(L<R){\n\t\tint M=rd();\n\t\tsolve(L,M,L,R);solve(M+1,R,L,R);\n\t}\n\tif(!l)inc(ans,div);  //o \u4e3a\u6839\u8282\u70b9\n\telse{\n\t\tint a=((ll)l*(l-1)+(ll)(n-r)*(n-r+1)>>1)%mod,b=((ll)L*(r-R)+(ll)(n-R+1)*(L-l))%mod,c=(ll)l*(n-r+1)%mod,d=((ll)(l+L-1)*(L-l)+(ll)(n*2-R-r+1)*(r-R)>>1)%mod;\n//a,b,c,d \u5bf9\u5e94\u60c5\u51b5 1,2,3,4\n\t\tinc(ans,fp(mat((ll)(a+c)*div%mod,(ll)d*div%mod,(ll)b*div%mod,(ll)(a+d)*div%mod,(ll)(b+c)*div%mod)));\n\t}\n}\nint main(){\n\tn=rd();k=rd();div=inv(((ll)n*(n+1)>>1)%mod);\n\tsolve(1,n,0,0);\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1594194153,
        "uid": 57926,
        "name": "Thinking",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6630 \u3010[ZJOI2020] \u4f20\u7edf\u827a\u80fd\u3011"
    },
    {
        "content": "\u8003\u8651\u5bf9\u4e8e\u7ebf\u6bb5\u6811\u7684\u6bcf\u4e2a\u8282\u70b9\uff0c\u6709\u591a\u5c11\u79cd\u65b9\u6848\u4f7f\u8fd9\u4e2a\u8282\u70b9\u6709\u6807\u8bb0\u3002\n\n\u8bb0 $t=\\dfrac{n(n+1)}{2}$\uff0c\u8bbe $a_i,b_i,c_i,d_i,e_i$ \u5206\u522b\u8868\u793a **\u80fd\u76f4\u63a5\u7ed9\u7b2c $i$ \u4e2a\u8282\u70b9\u6253\u4e0a\u6807\u8bb0\u7684\u533a\u95f4\u64cd\u4f5c\u6570\uff0c\u80fd\u76f4\u63a5\u5c06\u7b2c $i$ \u4e2a\u8282\u70b9\u7684\u6807\u8bb0\u62c6\u6389\u7684\u533a\u95f4\u64cd\u4f5c\u6570\uff0c\u4e0d\u80fd\u76f4\u63a5\u7ed9\u7b2c $i$ \u4e2a\u8282\u70b9\u6253\u4e0a\u6807\u8bb0\u4f46\u80fd\u5c06\u5176\u7956\u5148\u7684\u6807\u8bb0\u4f20\u7ed9\u8be5\u8282\u70b9\u7684\u533a\u95f4\u64cd\u4f5c\u6570\uff0c\u4e0d\u4f1a\u5bf9\u8be5\u8282\u70b9\u6807\u8bb0\u60c5\u51b5\u6709\u5f71\u54cd\u7684\u533a\u95f4\u64cd\u4f5c\u6570\uff0c\u80fd\u7ed9\u7b2c $i$ \u4e2a\u8282\u70b9\u6216\u5176\u7956\u5148\u6253\u4e0a\u6807\u8bb0\u7684\u533a\u95f4\u64cd\u4f5c\u6570**\u3002\n\n\u90a3\u4e48\u6839\u636e\u6837\u4f8b\u4e00\u6211\u4eec\u80fd\u5217\u51fa\u8fd9\u6837\u7684\u8868\u683c\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/yy0ga2qf.png)\n\n| $i$ | $a_i$ | $b_i$ | $c_i$ | $d_i$ | $e_i$ |\n| -----------: | -----------: | -----------: | -----------: | -----------: | -----------: |\n| $1$ | $1$ | $5$ | $0$ | $0$ | $1$ |\n| $2$ | $2$ | $0$ | $3$ | $1$ | $3$ |\n| $3$ | $1$ | $3$ | $1$ | $1$ | $2$ |\n| $4$ | $2$ | $0$ | $1$ | $3$ | $4$ |\n| $5$ | $1$ | $0$ | $2$ | $3$ | $3$ |\n\n\u6bd4\u5982\u5bf9\u4e8e $3$ \u53f7\u8282\u70b9\uff0c\u533a\u95f4 $(2,3)$ \u53ef\u4ee5\u76f4\u63a5\u7ed9\u5b83\u6253\u4e0a\u6807\u8bb0\uff1b\u533a\u95f4 $(1,2),(2,2),(3,3)$ \u80fd\u5c06\u5b83\u7684\u6807\u8bb0\u62c6\u6389\uff1b\u533a\u95f4 $(1,1)$ \u4e0d\u80fd\u76f4\u63a5\u7ed9\u5b83\u6253\u4e0a\u6807\u8bb0\uff0c\u4f46\u5982\u679c\u5b83\u7684\u7956\u5148\uff08$1$ \u53f7\u70b9\uff09\u6709\u6807\u8bb0\uff0c\u90a3\u4e48\u5b83\u7956\u5148\u7684\u6807\u8bb0\u4f1a\u88ab\u4f20\u7ed9\u5b83\uff1b\u533a\u95f4 $(1,3)$ \u5728\u672c\u6b21\u64cd\u4f5c\u65f6\u4e0d\u4f1a\u6539\u53d8\u5b83\u7684\u6807\u8bb0\u60c5\u51b5\uff1b\u533a\u95f4 $(1,3),(2,3)$ \u53ef\u4ee5\u5c06\u5176\u6216\u5176\u7956\u5148\u6253\u4e0a\u6807\u8bb0\u3002\n\n\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$\\begin{cases}a_i+b_i+c_i+d_i=t\\\\a_i=e_i-e_{fa_i}\\\\d_i=e_{fa_i}+\\dfrac{l_{fa_i}(l_{fa_i}-1)}{2}+\\dfrac{(n-r_{fa_i})(n-r_{fa_i}+1)}{2}\\\\e_i=l_i\\times(n-r_i+1)\\end{cases}$\n\n\u5176\u4e2d $l_i,r_i$ \u5206\u522b\u4e3a\u8be5\u8282\u70b9\u6240\u8bb0\u5f55\u7ebf\u6bb5\u7684 $l,r$\uff0c$fa_i$ \u4e3a\u8be5\u8282\u70b9\u7236\u4eb2\u7684\u7f16\u53f7\u3002\n\n\uff08\u7279\u522b\u7684\uff0c$a_1=e_1=1,b_1=t-1,c_1=d_1=0$\uff09\n\n\u95ee\u9898\u5c31\u5728\u4e8e\u5982\u4f55\u8ba1\u7b97 $b_i$ \u548c $c_i$ \u4e86\u3002\n\n\u53d1\u73b0\u5982\u679c\u4e00\u4e2a\u533a\u95f4\u6ee1\u8db3 \u4e0d\u80fd\u76f4\u63a5\u7ed9\u7b2c $i$ \u4e2a\u8282\u70b9\u6253\u4e0a\u6807\u8bb0\u4f46\u80fd\u5c06\u5176\u7956\u5148\u7684\u6807\u8bb0\u4f20\u7ed9\u8be5\u8282\u70b9\uff0c\u4e00\u5b9a\u6709\u67d0\u4e2a\u7aef\u70b9\u5728\u7b2c $i$ \u4e2a\u8282\u70b9\u7684\u5144\u5f1f\u8868\u793a\u7684\u7ebf\u6bb5\u5185\uff0c\u5e76\u4e14\u4e24\u4e2a\u7aef\u70b9\u5728\u7b2c $i$ \u7684\u8282\u70b9\u7684\u540c\u4fa7\u3002\u4e8e\u662f\u5c31\u53ef\u4ee5\u6c42\u51fa $c_i$ \u4e86\u3002\n\n\u5229\u7528 $b_i=t-a_i-c_i-d_i$ \u5c31\u53ef\u4ee5\u6c42\u51fa $b_i$ \u4e86\u3002\n\n\u7b80(fu)\u5355(za)\u6765\u8bb2\u5c31\u662f\uff1a\n```cpp\n//ca,cb,na,nc,cfa\u4f9d\u6b21\u5bf9\u5e94\u4e0a\u9762\u7684a,b,c,d,e\nvoid csh(int &w,ll L,ll R)\n{\n\tw=++tot,cfa[w]=L*(n-R+1)%p;\n\tif(L==R)return;\n\tll m=dr();\n\tcsh(ls[w],L,m),csh(rs[w],m+1,R);\n\tca[ls[w]]=L*(R-m)%p,ca[rs[w]]=(m+1-L)*(n-R+1)%p;\n\tnc[ls[w]]=nc[rs[w]]=(cfa[w]+((L*(L-1))>>1)+(((n-R)*(n-R+1))>>1))%p;\n\tna[ls[w]]=((((n<<1)-m-R+1)*(R-m))>>1)%p,na[rs[w]]=(((L+m)*(m-L+1))>>1)%p;\n\tcb[ls[w]]=(t-ca[ls[w]]-nc[ls[w]]-na[ls[w]]+p*3)%p,cb[rs[w]]=(t-ca[rs[w]]-nc[rs[w]]-na[rs[w]]+p*3)%p;\n}\nint main()\n{\n\t/* \u4ee3\u7801 */\n\tcsh(rt,1,n);\n\tca[rt]=cfa[rt]=1,cb[rt]=(t-1+p)%p;\n}\n```\n\n\n\u8bb0 $f_{i,j},g_{i,j}$ \u5206\u522b\u4e3a\u7b2c $i$ \u4e2a\u8282\u70b9\u5728 $j$ \u6b21\u64cd\u4f5c\u540e \u81ea\u5df1/\u81ea\u5df1\u6216\u5176\u67d0\u4e2a\u7956\u5148 \u6709\u6807\u8bb0\u7684\u65b9\u6848\u6570\u3002\n\n\u53ef\u5f97\uff1a\n\n$\\begin{cases}f_{i,j}=t^{j-1}\\times a_i+g_{i,j-1}\\times c_i+f_{i,j-1}\\times d_i\\\\g_{i,j}=t^{i-1}\\times e_i+g_{i,j-1}\\times(t-b_i-e_i)\\end{cases}$\n\n\uff08$g_{i,j}$ \u4e2d\u6700\u540e $-e_i$ \u662f\u56e0\u4e3a\u548c\u4e0a\u9762\u6709\u91cd\u590d\u6240\u4ee5\u51cf\u53bb\uff0c\u5176\u4ed6\u7531\u5b9a\u4e49\u53ef\u5f97\uff09\n\n\u7279\u522b\u7684\uff0c$f_{i,1}=a_i,g_{i,1}=e_i$\u3002\n\n\u7136\u540e\u5c31\u5bb9\u6613\u60f3\u5230\u7528\u77e9\u4e58\u505a\u4e86\u3002\n\n\u590d\u6742\u5ea6 $O(27n\\log k)$\u3002",
        "postTime": 1593938816,
        "uid": 104581,
        "name": "kkk\u7684\u5c0f\u8214\u72d7",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P6630 \u3010[ZJOI2020] \u4f20\u7edf\u827a\u80fd\u3011"
    },
    {
        "content": "\u8bbe $f_i$ \u8868\u793a\u8282\u70b9\u6709\u6807\u8bb0\uff0c $g_i$ \u8868\u793a\u5f53\u524d\u8282\u70b9\u6ca1\u6709\u6807\u8bb0\uff0c\u4f46\u7956\u5148\u6709\u6807\u8bb0\uff0c $h_i$ \u8868\u793a\u5f53\u524d\u8282\u70b9\u548c\u7956\u5148\u8282\u70b9\u90fd\u6ca1\u6709\u6807\u8bb0\u3002\n\n\u8fd9\u91cc\u603b\u5171\u6709 $3\\times 3$ \u79cd\u8f6c\u79fb\u7684\u60c5\u51b5\u3002\n\n\u8bbe\u603b\u65b9\u6848\u6570\u4e3a $A=n\\times(n+1)/2$\uff0c\u548c\u5f53\u524d\u65e0\u4ea4\u7684\u533a\u95f4\u65b9\u6848\u6570\u4e3a $B=l\\times(l-1)/2+(n-r)\\times(n-r+1)/2$ \uff0c\u5305\u542b\u5f53\u524d\u533a\u95f4\u7684\u65b9\u6848\u6570\u4e3a $C=l\\times(n-r+2)$ \uff0c\u4e0e\u5f53\u524d\u533a\u95f4\u6709\u4ea4\u7684\u65b9\u6848\u6570\u4e3a $D=A-B-C$\u3002\n\n1.$f\\rightarrow f$ \u53ea\u6709\u7ecf\u8fc7\u5f53\u524d\u8282\u70b9\u624d\u4f1a\u4e0d\u6ee1\u8db3\u3002\u5373\u6709\u4ea4\u7684\u88ab\u6392\u9664\u3002\u7b54\u6848\u4e3a B+C \u3002\n\n2.$f\\rightarrow g$ \u4e0d\u53ef\u80fd\uff0c\u7b54\u6848\u4e3a 0\u3002\n\n3.$f\\rightarrow h$ \u5373\u548c\u5f53\u524d\u533a\u95f4\u6709\u4ea4\uff0c\u7b54\u6848\u4e3a A-B-C \u3002\n\n4.$g\\rightarrow f$ \u5373\u548c\u7236\u4eb2\u76f8\u4ea4\uff0c\u5e76\u4e14\u7236\u4eb2\u4e0d\u80fd\u88ab\u5305\u542b\uff0c\u5e76\u4e14\u4e0d\u80fd\u4e0e\u5f53\u524d\u8282\u70b9\u76f8\u4ea4\uff0c\u7b54\u6848\u4e3a B+C-FB-FC \u3002\n\n5.$g\\rightarrow g$ \u5373\u5305\u542b\u7236\u4eb2\u6216\u4e0e\u7236\u4eb2\u65e0\u4ea4\uff0c\u7b54\u6848\u4e3a FB+FC\u3002\n\n6.$g\\rightarrow h$ \u5373\u7ecf\u8fc7\u5f53\u524d\u8282\u70b9\uff0c\u7b54\u6848\u4e3a A-B-C \u3002\n\n7.$h\\rightarrow f$ \u5373\u5f53\u524d\u8282\u70b9\u88ab\u5305\u542b\uff0c\u4e14\u4e0e\u7236\u4eb2\u76f8\u4ea4\uff0c\u7b54\u6848\u4e3a C-FC \u3002\n\n8.$h\\rightarrow g$ \u5373\u5f53\u524d\u7236\u4eb2\u8282\u70b9\u88ab\u5305\u542b\uff0c\u7b54\u6848\u4e3a FC \u3002\n\n9.$h\\rightarrow h$ \u5373\u4e0d\u5305\u542b\u5f53\u524d\u8282\u70b9\uff0c\u7b54\u6848\u4e3a A-C \u3002\n\n\u628a\u6bcf\u4e2a\u7b54\u6848\u4e58 A \u7684\u9006\u5c31\u662f\u6982\u7387\u4e86\u3002\u628a\u6bcf\u4e2a\u8f6c\u79fb\u7efc\u5408\u8d77\u6765\u5c31\u5f97\u5230\u4e86\u8f6c\u79fb\u65b9\u7a0b\u3002\u56e0\u4e3a\u6bcf\u6b21\u8f6c\u79fb\u90fd\u4e00\u6837\u6240\u4ee5\u53ef\u4ee5\u7528\u77e9\u9635\u4f18\u5316\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(27n\\log k)$ \u3002\n",
        "postTime": 1627817507,
        "uid": 541382,
        "name": "BelowHorizon",
        "ccfLevel": 0,
        "title": "P6630 [ZJOI2020] \u4f20\u7edf\u827a\u80fd"
    }
]