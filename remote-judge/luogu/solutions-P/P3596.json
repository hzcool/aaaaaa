[
    {
        "content": "# \u5c0f\u58f0$bb$\uff1a\n\n### \u5c45\u7136\u6ca1\u6709\u9898\u89e3\u3002\u3002\u8d76\u7d27\u6c34\u4e00\u6ce2\n\n### \u8c03\u4e86\u6211\u534a\u5929\u3002\u3002\u7ed3\u679c$if$\u91cc$==$\u5199\u6210\u4e86$=qwq$\n\n\n------------\n# \u56de\u5230\u6b63\u9898\uff1a\n\n\u5bf9\u4e8e\u6700\u5927\u503c\uff0c\u6211\u4eec\u628a\u4e00\u68f5\u6811\u62c6\u5f00\u540e\uff0c\u628a\u4e24\u68f5\u6811\u7684\u76f4\u5f84\u7684\u4e24\u7aef\u8fde\u8d77\u6765\u5c31\u53ef\u4ee5\u4e86\n\n\u5bf9\u4e8e\u6700\u5c0f\u503c\uff0c\u6211\u4eec\u628a\u4e00\u68f5\u6811\u62c6\u5f00\u540e\uff0c\u628a\u4e24\u68f5\u6811\u7684\u76f4\u5f84\u4e2d\u70b9\u76f8\u8fde\u5c31\u53ef\u4ee5\u4e86\n\n~~\uff08\u8bf4\u7684\u8f7b\u5de7\uff09~~\n\n\u90a3\u5c31\u8be6\u7ec6\u7684\u8bb2\u8bb2\u600e\u4e48\u6c42\u5427\n\n\n------------\n# \u53d8\u91cf\u58f0\u660e\uff1a\n\n$dep[i]$\uff1a$i$\u8282\u70b9\u7684\u6df1\u5ea6\n\n$f[i]$\uff1a\u4ee5$i$\u4e3a\u6839\u7684\u5b50\u6811\u7684\u6700\u957f\u76f4\u5f84\n\n$d[i][j](j\\in\\{0,1,2\\})$:\u5206\u522b\u8868\u793a\u4ece$i$\u8282\u70b9\u5411\u4e0b\u7684\u6700\u957f\u94fe\uff0c\u6b21\u957f\u94fe\uff0c\u548c\u6b21\u6b21\u957f\u94fe$qwq$\n\n$w[i][j](j\\in\\{0,1\\})$\uff1a\u5206\u522b\u8868\u793a\u4ee5$i$\u8282\u70b9\u7684\u5b50\u8282\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u6700\u957f\u76f4\u5f84\u548c\u6b21\u957f\u76f4\u5f84\n\n$lian[i]$\uff1a\u8868\u793a$i$\u8282\u70b9\u51fa\u53d1\u80fd\u8d70\u7684\u6700\u957f\u957f\u5ea6\uff0c\u4e5f\u5c31\u662f\u53ef\u80fd\u4f1a\u5f80\u4e0a\u9762\u8d70\uff0c\u5176\u5b9e\u5c31\u662f\u628a\u5f53\u524d\u8282\u70b9\u5f53\u505a\u6839\u8282\u70b9\u7684\u6700\u957f\u94fe\u957f\u5ea6\n\n$fa[i]$\uff1a\u5b58\u7684\u7236\u4eb2\u53ca\u8282\u70b9\n\n$g[i]$\uff1a\u8868\u793a\u5220\u9664$i$\u70b9\u4e0e$fa[i]$\u70b9\u4e4b\u95f4\u7684\u8fb9\u540e\uff0c\u4ee5$1$\u4e3a\u6839\u7684\u90a3\u68f5\u6811\u7684\u6700\u957f\u76f4\u5f84\n\n$head[i],edge[i]$\uff1a\u666e\u901a\u524d\u5411\u661f\n\n\n------------\n\n# \u5b9e\u73b0:\n\n\u9996\u5148\uff0c\u6211\u4eec\u7528\u4e00\u6b21$dfs$\u6c42\u51fa$f,fa,d,w,dep$\u6570\u7ec4\uff0c\u8be6\u7ec6\u8fc7\u7a0b\u5728\u4ee3\u7801\u4e2d\u6ce8\u91ca\u4e86\uff1a\n~~~cpp\nvoid Dfs1(int u)\n{\n\tfor(int i=head[u];i;i=edge[i].nxt)\n\t{\n\t\tint v=edge[i].to;\n\t\tif(v==fa[u])//\u4e0d\u662f\u7236\u4eb2 \n\t\t\tcontinue;\n\t\tdep[v]=dep[u]+1;//\u66f4\u65b0\u6df1\u5ea6 \n\t\tfa[v]=u;//\u66f4\u65b0\u7236\u4eb2\u8282\u70b9 \n\t\tDfs1(v);//\u9012\u5f52 \n\t\tf[u]=max(f[u],f[v]);//\u66f4\u65b0\u4ee5u\u6839\u7684\u5b50\u6811\u6700\u5927\u76f4\u5f84\uff0c\u521d\u59cb\u503c\u4e3a\u5b50\u6811\u7684\u6700\u5927\u76f4\u5f84 \n\t\tint tmp=d[v][0]+1;\n\t\tif(tmp>d[u][0])//\u66f4\u65b0d\u6570\u7ec4 \n\t\t{\n\t\t\td[u][2]=d[u][1];\n\t\t\td[u][1]=d[u][0];\n\t\t\td[u][0]=tmp;\n\t\t}\n\t\telse\n\t\t\tif(tmp>d[u][1])\n\t\t\t{\n\t\t\t\td[u][2]=d[u][1];\n\t\t\t\td[u][1]=tmp;\n\t\t\t}\n\t\t\telse\n\t\t\t\tif(tmp>d[u][2])\n\t\t\t\t\td[u][2]=tmp;\n\t\ttmp=f[v];\n\t\tif(tmp>w[u][0])//\u66f4\u65b0w\u6570\u7ec4 \n\t\t{\n\t\t\tw[u][1]=w[u][0];\n\t\t\tw[u][0]=tmp;\n\t\t}\n\t\telse\n\t\t\tif(tmp>w[u][1])\n\t\t\t\tw[u][1]=tmp;\n\t}\n\tf[u]=max(f[u],d[u][0]+d[u][1]);//\u66f4\u65b0\u76f4\u5f84 \n}\n~~~\n\u90a3\u4e48\u5904\u7406\u51fa\u8fd9\u4e9b\u540e\uff0c\u6211\u4eec\u5c31\u8981\u5f00\u59cb\u62c6\u8fb9\u4e86\uff0c\u6211\u4eec\u5047\u8bbe\u5f53\u524d\u8282\u70b9\u4e3a$u$\uff0c\u90a3\u4e48\u6211\u4eec\u679a\u4e3e\u5b50\u8282\u70b9$v$\uff0c\u90a3\u4e48\u62c6\u4e86\u8fd9\u6761\u8fb9\u540e\uff0c\u5c31\u66f4\u65b0$g$\u6570\u7ec4\uff0c\u8fd9\u65f6\u4faf\u6709$3$\u79cd\u60c5\u51b5\uff1a\n\n\u5148\u518d\u8d34\u4e00\u4e0b$g$\u7684\u5b9a\u4e49\uff1a\u5220\u9664$i$\u70b9\u4e0e$fa[i]$\u70b9\u4e4b\u95f4\u7684\u8fb9\u540e\uff0c\u4ee5$1$\u4e3a\u6839\u7684\u90a3\u68f5\u6811\u7684\u6700\u957f\u76f4\u5f84~~\uff08\u6211\u4e0d\u662f\u5728\u6c34\u5b57\u6570\uff09~~\n\n$1$\u3001\u5220\u9664\u7684$v$\u70b9\u5728$u$\u70b9\u7684\u6700\u957f\u94fe$d[u][0]$\u4e0a\n\n\u90a3\u4e48\u4ee5$1$\u4e3a\u6839\u7684\u5b50\u6811\u7684\u76f4\u5f84\u53ef\u80fd\u4f1a\u662f$u$\u8fd9\u4e2a\u70b9\u7684\u6b21\u957f\u94fe$d[u][1]$\u4e0e\u6b21\u6b21\u957f\u94fe$d[u][2]$\u76f8\u52a0\u7684\uff0c\u6216\u8005\u662f\u5f53\u524d\u70b9$u$\u5411\u4e0a\u8d70\u6700\u957f\u7684\u8def$lian[u]$\u4e0e\u6b21\u957f\u94fe$d[u][1]$\u76f8\u52a0\u7ec4\u6210\u76f4\u5f84\n\n\u4ee3\u7801\uff1a\n~~~cpp\nif(tmp==d[u][0])\n{\n\tg[v]=max(max(g[v],d[u][1]+d[u][2]),lian[u]+d[u][1]);\n\tlian[v]=max(lian[v],d[u][1]+1);//\u987a\u4fbf\u66f4\u65b0\n}\n~~~\n\n$2$\u3001\u5220\u9664\u7684$v$\u70b9\u5728$u$\u70b9\u7684\u6b21\u957f\u94fe$d[u][1]$\u4e0a\n\n\u90a3\u4e48\u4ee5$1$\u4e3a\u6839\u7684\u5b50\u6811\u7684\u76f4\u5f84\u53ef\u80fd\u4f1a\u662f$u$\u8fd9\u4e2a\u70b9\u7684\u6700\u957f\u94fe$d[u][0]$\u4e0e\u6b21\u6b21\u957f\u94fe$d[u][2]$\u76f8\u52a0\u7684\uff0c\u6216\u8005\u662f\u5f53\u524d\u70b9$u$\u5411\u4e0a\u8d70\u6700\u957f\u7684\u8def$lian[u]$\u4e0e\u6700\u957f\u94fe$d[u][0]$\u76f8\u52a0\u7ec4\u6210\u76f4\u5f84\n\n\u4ee3\u7801\uff1a\n~~~cpp\nif(tmp==d[u][1])\n{\n\tg[v]=max(max(g[v],d[u][0]+d[u][2]),lian[u]+d[u][0]);\n\tlian[v]=max(lian[v],d[u][0]+1);//\u987a\u4fbf\u66f4\u65b0\n}\n~~~\n\n$3$\u3001\u5220\u9664\u7684$v$\u70b9\u5728$u$\u70b9\u7684\u6b21\u6b21\u957f\u94fe$d[u][2]$\u4e0a\n\n\u90a3\u4e48\u4ee5$1$\u4e3a\u6839\u7684\u5b50\u6811\u7684\u76f4\u5f84\u53ef\u80fd\u4f1a\u662f$u$\u8fd9\u4e2a\u70b9\u7684\u6700\u957f\u94fe$d[u][0]$\u4e0e\u6b21\u957f\u94fe$d[u][1]$\u76f8\u52a0\u7684\uff0c\u6216\u8005\u662f\u5f53\u524d\u70b9$u$\u5411\u4e0a\u8d70\u6700\u957f\u7684\u8def$lian[u]$\u4e0e\u6700\u957f\u94fe$d[u][0]$\u76f8\u52a0\u7ec4\u6210\u76f4\u5f84\n\n\u4ee3\u7801\uff1a\n~~~cpp\nif(tmp==d[u][2])\n{\n\tg[v]=max(max(g[v],d[u][0]+d[u][1]),lian[u]+d[u][0]);\n\tlian[v]=max(lian[v],d[u][0]+1);//\u987a\u4fbf\u66f4\u65b0\n}\n~~~\n\u4f46\u662f\u4ec5\u4ec5\u8003\u8651\u4e0a\u8ff0\u60c5\u51b5\u8fd8\u4e0d\u591f\uff0c\u4ee5$1$\u4e3a\u6839\u7684\u5b50\u6811\u7684\u76f4\u5f84\u4e0d\u4e00\u5b9a\u4f1a\u7ecf\u8fc7$u$\u70b9\uff0c\u6240\u4ee5\u8fd8\u8981\u4e0e\u5b83\u5b50\u8282\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u7684\u76f4\u5f84\u53d6\u6700\u5927\u503c\n\n\u4ee3\u7801\uff1a\n~~~cpp\ntmp=f[v];\nif(tmp==w[u][0])\n\tg[v]=max(g[v],w[u][1]);\nelse\n\tg[v]=max(g[v],w[u][0]);\n~~~\n\n\u90a3\u4e48\u5f53\u6211\u4eec\u5220\u9664$u,v$\u4e4b\u95f4\u7684\u8fb9\u540e\uff0c\u628a\u4e24\u7aef\u76f8\u8fde\u5c31\u662f\u6700\u957f\u76f4\u5f84\uff0c\u4e5f\u5c31\u662f\n~~~cpp\nif(ansmax<g[u]+f[u]+1)\n{\n\tansmax=g[u]+f[u]+1;\n\tmaxx=fa[u],maxy=u;\n}\n~~~\n\n\u800c\u6700\u5c0f\u503c\u5c31\u662f\u4e24\u4e2a\u76f4\u5f84\u4e2d\u70b9\u76f8\u8fde\uff0c\u4e5f\u5c31\u662f\n~~~cpp\nint tmp=max(max(f[u],g[u]),(f[u]+1)/2+(g[u]+1)/2+1);\nif(ansmin>tmp)\n{\n\tansmin=tmp;\n\tminx=fa[u],miny=u;\n}\n~~~\n\u81ea\u7136\u7b2c\u4e8c\u6b21$dfs$\u53ef\u4ee5\u76f4\u63a5\u641e\u51fa\u6765\n\n\u4ee3\u7801\uff1a\n~~~cpp\nvoid Dfs2(int u)\n{\n\tif(u!=1)\n\t{\n\t\tif(ansmax<g[u]+f[u]+1)\n\t\t{\n\t\t\tansmax=g[u]+f[u]+1;\n\t\t\tmaxx=fa[u],maxy=u;\n\t\t}\n\t\tint tmp=max(max(f[u],g[u]),(f[u]+1)/2+(g[u]+1)/2+1);\n\t\tif(ansmin>tmp)\n\t\t{\n\t\t\tansmin=tmp;\n\t\t\tminx=fa[u],miny=u;\n\t\t}\n\t}\n\tfor(int i=head[u];i;i=edge[i].nxt)\n\t{\n\t\tint v=edge[i].to;\n\t\tif(v==fa[u])\n\t\t\tcontinue;\n\t\tlian[v]=max(lian[v],lian[u]+1);\n\t\tg[v]=max(g[v],g[u]);\n\t\tint tmp=d[v][0]+1;\n\t\tif(tmp==d[u][0])\n\t\t{\n\t\t\tg[v]=max(max(g[v],d[u][1]+d[u][2]),lian[u]+d[u][1]);\n\t\t\tlian[v]=max(lian[v],d[u][1]+1);\n\t\t}\n\t\telse\n\t\t\tif(tmp==d[u][1])\n\t\t\t{\n\t\t\t\tg[v]=max(max(g[v],d[u][0]+d[u][2]),lian[u]+d[u][0]);\n\t\t\t\tlian[v]=max(lian[v],d[u][0]+1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tg[v]=max(max(g[v],d[u][0]+d[u][1]),lian[u]+d[u][0]);\n\t\t\t\tlian[v]=max(lian[v],d[u][0]+1);\n\t\t\t}\n\t\ttmp=f[v];\n\t\tif(tmp==w[u][0])\n\t\t\tg[v]=max(g[v],w[u][1]);\n\t\telse\n\t\t\tg[v]=max(g[v],w[u][0]);\n\t\tDfs2(v);\n\t}\n}\n~~~\n\u5269\u4e0b\u7684\u8f93\u51fa\u70b9\u7684\u8bdd\u5c31\u53bb\u627e\u7aef\u70b9\u5c31$ok$\u5566\uff0c\u8be6\u7ec6\u89c1\u4ee3\u7801\n\n\u63a5\u4e0b\u6765\u662f\u7f8e\u6ecb\u6ecb\u7684\u4ee3\u7801\u65f6\u95f4\uff1a\n~~~cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<queue>\n#define N 500007\n#define inf 0x3f3f3f3f \nusing namespace std;\nstruct Edge\n{\n\tint to,nxt; \n}edge[N<<1];\nint n,cnt,ansmax,maxx,maxy,ansmin=inf,minx,miny;\nint head[N],dep[N],f[N],d[N][3],w[N][2],lian[N],fa[N],g[N];\nbool vis[N];\nqueue<int> q;\nvoid Add(int u,int v)\n{\n\tedge[++cnt]=(Edge){v,head[u]};\n\thead[u]=cnt;\n}\nvoid Dfs1(int u)\n{\n\tfor(int i=head[u];i;i=edge[i].nxt)\n\t{\n\t\tint v=edge[i].to;\n\t\tif(v==fa[u])//\u4e0d\u662f\u7236\u4eb2 \n\t\t\tcontinue;\n\t\tdep[v]=dep[u]+1;//\u66f4\u65b0\u6df1\u5ea6 \n\t\tfa[v]=u;//\u66f4\u65b0\u7236\u4eb2\u8282\u70b9 \n\t\tDfs1(v);//\u9012\u5f52 \n\t\tf[u]=max(f[u],f[v]);//\u66f4\u65b0\u4ee5u\u6839\u7684\u5b50\u6811\u6700\u5927\u76f4\u5f84\uff0c\u521d\u59cb\u503c\u4e3a\u5b50\u6811\u7684\u6700\u5927\u76f4\u5f84 \n\t\tint tmp=d[v][0]+1;\n\t\tif(tmp>d[u][0])//\u66f4\u65b0d\u6570\u7ec4 \n\t\t{\n\t\t\td[u][2]=d[u][1];\n\t\t\td[u][1]=d[u][0];\n\t\t\td[u][0]=tmp;\n\t\t}\n\t\telse\n\t\t\tif(tmp>d[u][1])\n\t\t\t{\n\t\t\t\td[u][2]=d[u][1];\n\t\t\t\td[u][1]=tmp;\n\t\t\t}\n\t\t\telse\n\t\t\t\tif(tmp>d[u][2])\n\t\t\t\t\td[u][2]=tmp;\n\t\ttmp=f[v];\n\t\tif(tmp>w[u][0])//\u66f4\u65b0w\u6570\u7ec4 \n\t\t{\n\t\t\tw[u][1]=w[u][0];\n\t\t\tw[u][0]=tmp;\n\t\t}\n\t\telse\n\t\t\tif(tmp>w[u][1])\n\t\t\t\tw[u][1]=tmp;\n\t}\n\tf[u]=max(f[u],d[u][0]+d[u][1]);//\u66f4\u65b0\u76f4\u5f84 \n}\nvoid Dfs2(int u)\n{\n\tif(u!=1)\n\t{\n\t\tif(ansmax<g[u]+f[u]+1)\n\t\t{\n\t\t\tansmax=g[u]+f[u]+1;\n\t\t\tmaxx=fa[u],maxy=u;\n\t\t}\n\t\tint tmp=max(max(f[u],g[u]),(f[u]+1)/2+(g[u]+1)/2+1);\n\t\tif(ansmin>tmp)\n\t\t{\n\t\t\tansmin=tmp;\n\t\t\tminx=fa[u],miny=u;\n\t\t}\n\t}\n\tfor(int i=head[u];i;i=edge[i].nxt)\n\t{\n\t\tint v=edge[i].to;\n\t\tif(v==fa[u])\n\t\t\tcontinue;\n\t\tlian[v]=max(lian[v],lian[u]+1);\n\t\tg[v]=max(g[v],g[u]);\n\t\tint tmp=d[v][0]+1;\n\t\tif(tmp==d[u][0])\n\t\t{\n\t\t\tg[v]=max(max(g[v],d[u][1]+d[u][2]),lian[u]+d[u][1]);\n\t\t\tlian[v]=max(lian[v],d[u][1]+1);\n\t\t}\n\t\telse\n\t\t\tif(tmp==d[u][1])\n\t\t\t{\n\t\t\t\tg[v]=max(max(g[v],d[u][0]+d[u][2]),lian[u]+d[u][0]);\n\t\t\t\tlian[v]=max(lian[v],d[u][0]+1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tg[v]=max(max(g[v],d[u][0]+d[u][1]),lian[u]+d[u][0]);\n\t\t\t\tlian[v]=max(lian[v],d[u][0]+1);\n\t\t\t}\n\t\ttmp=f[v];\n\t\tif(tmp==w[u][0])\n\t\t\tg[v]=max(g[v],w[u][1]);\n\t\telse\n\t\t\tg[v]=max(g[v],w[u][0]);\n\t\tDfs2(v);\n\t}\n}\nint Bfs(int x)\n{\n\tmemset(vis,false,sizeof(vis));\n\tvis[x]=true;\n\tq.push(x);\n\tint ret;\n\twhile(!q.empty())\n\t{\n\t\tint u=q.front();\n\t\tret=u;\n\t\tq.pop();\n\t\tfor(int i=head[u];i;i=edge[i].nxt)\n\t\t{\n\t\t\tint v=edge[i].to;\n\t\t\tif((u==minx&&v==miny)||(u==miny&&v==minx)||vis[v])\n\t\t\t\tcontinue;\n\t\t\tq.push(v);\n\t\t\tvis[v]=true;\n\t\t}\t\n\t}\n\treturn ret;\n}\nint Get(int x,int y,int len)\n{\n\tint now=len;\n\tif(dep[x]<dep[y])\n\t\tswap(x,y);\n\twhile(now!=(len+1)/2)\n\t\tx=fa[x],--now;\n\treturn x;\n}\nvoid Outputmax()\n{\n\tprintf(\"%d %d %d \",ansmax,maxx,maxy);\n\tmemset(vis,false,sizeof(vis));\n\tvis[maxx]=true;\n\tq.push(maxx);\n\twhile(!q.empty())\n\t{\n\t\tint u=q.front();\n\t\tmaxx=u;\n\t\tq.pop();\n\t\tfor(int i=head[u];i;i=edge[i].nxt)\n\t\t{\n\t\t\tint v=edge[i].to;\n\t\t\tif((v==maxx||v==maxy)||vis[v])\n\t\t\t\tcontinue;\n\t\t\tq.push(v);\n\t\t\tvis[v]=true;\n\t\t}\t\n\t}\n\tvis[maxy]=true;\n\tq.push(maxy);\n\twhile(!q.empty())\n\t{\n\t\tint u=q.front();\n\t\tmaxy=u;\n\t\tq.pop();\n\t\tfor(int i=head[u];i;i=edge[i].nxt)\n\t\t{\n\t\t\tint v=edge[i].to;\n\t\t\tif(vis[v])\n\t\t\t\tcontinue;\n\t\t\tq.push(v);\n\t\t\tvis[v]=true;\n\t\t}\t\n\t}\n\tprintf(\"%d %d\\n\",maxx,maxy);\n}\nint main()\n{\n\tfreopen(\"2.in\",\"r\",stdin);\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<n;++i)\n\t{\n\t\tint u,v;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tAdd(u,v);\n\t\tAdd(v,u);\n\t}\n\tDfs1(1); Dfs2(1);\n\tprintf(\"%d %d %d \",ansmin,minx,miny);\n\tint dianx1=Bfs(minx),diany1=Bfs(dianx1);\n\tint dianx2=Bfs(miny),diany2=Bfs(dianx2);\n\tprintf(\"%d %d\\n\",Get(dianx1,diany1,g[miny]),Get(dianx2,diany2,f[miny]));\n\tOutputmax();\n\treturn 0;\n}\n\n\n\n\n\n~~~\n",
        "postTime": 1547532109,
        "uid": 96968,
        "name": "3493441984zz",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3596 \u3010[POI2015]MOD\u3011"
    },
    {
        "content": "\u6765\u4e00\u7bc7\u975e DP \u7684\u9898\u89e3\uff08DFS \u6c42\u76f4\u5f84\u4e25\u683c\u4e0a\u8bf4\u4e5f\u662f DP\uff0c\u4e0d\u8fc7\u76f8\u6bd4\u4e8e\u6362\u6839\u4e4b\u7c7b\u7684\u505a\u6cd5\u4e5f\u4e0d\u7b97\u4ec0\u4e48 DP\uff09\u3002\u53e6\u5916\u5176\u5b9e\u8fd9\u4e2a\u9898\u4ee3\u7801\u5e76\u6ca1\u6709\u5f88\u96be\u5199\uff0c\u73b0\u6709\u9898\u89e3\u4ee3\u7801\u5927\u90fd\u8d85\u8fc7 3K\uff0c\u63d0\u4f9b\u4e00\u79cd 1.8K \u5c31\u80fd\u5199\u5b8c\u7684\u5199\u6cd5\u3002\n\n\u6211\u4eec\u5206\u5f00\u8003\u8651\u8fd9\u4e24\u4e2a\u95ee\u9898\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u89e3\u51b3\u95ee\u9898\u4e5f\u4e3a\u4e86\u65b9\u4fbf\u5199\u4ee3\u7801\uff0c\u6211\u4eec\u5148\u4e00\u8d9f DFS \u627e\u5230\u76f4\u5f84\uff0c\u5e76\u4ee5\u4e24\u4e2a\u76f4\u5f84\u7aef\u70b9\u5206\u522b\u4f5c\u6839\u5efa\u6811\u5e76\u6c42\u51fa\u6bcf\u4e00\u68f5\u5b50\u6811\u7684\u76f4\u5f84\u4ee5\u53ca\u76f4\u5f84\u7aef\u70b9\u3002\uff08\u76f8\u4fe1\u505a\u8fd9\u4e2a\u9898\u7684\u540c\u5b66\u8fd9\u65b9\u9762\u90fd\u6ca1\u4ec0\u4e48\u95ee\u9898\u5c31\u4e0d\u5c55\u5f00\u8bb2\u4e86\uff09\n\n### \u6c42\u6700\u5c0f\u53ef\u80fd\u76f4\u5f84\n\n\u9996\u5148\u53ef\u4ee5\u660e\u786e\uff0c\u539f\u6811\u76f4\u5f84\u662f\u7b54\u6848\u7684\u4e0b\u754c\uff0c\u6211\u4eec\u53ea\u8981\u65ad\u6389\u4e00\u6761\u8fb9\u518d\u91cd\u65b0\u8fde\u4e0a\u5c31\u80fd\u53d6\u5f97\u3002\n\n\u8fd9\u8bf4\u660e\u6211\u4eec\u5fc5\u987b\u8981\u65ad\u6389\u76f4\u5f84\u7684\u4e00\u6761\u8fb9\uff0c\u5426\u5219\u76f4\u5f84\u4e0d\u4f1a\u53d8\u5c0f\u3002\u8003\u8651\u6211\u4eec\u5728\u4ee5\u76f4\u5f84\u5176\u4e2d\u4e00\u4e2a\u7aef\u70b9\u4e3a\u6839\u7684\u60c5\u51b5\u4e0b\u64cd\u4f5c\uff0c\u4f9d\u6b21\u679a\u4e3e\u76f4\u5f84\u4e0a\u7684\u6bcf\u4e00\u6761\u8fb9\uff0c\u65ad\u6389\u4efb\u4f55\u4e00\u6761\u8fb9\u90fd\u4f1a\u628a\u8fd9\u68f5\u6811\u5206\u6210\u4e24\u4e2a\uff0c\u7136\u540e\u6211\u4eec\u8981\u5728\u8fd9\u4e24\u68f5\u6811\u4e2d\u5206\u522b\u9009\u4e00\u4e2a\u70b9\u8fde\u8d77\u6765\u3002\u6211\u4eec\u9700\u8981\u5224\u65ad\u5982\u4f55\u8fde\u63a5\u80fd\u4f7f\u5f97\u76f4\u5f84\u6700\u5c0f\u5e76\u4e14\u8981\u6c42\u51fa\u76f4\u5f84\u662f\u591a\u5c11\u6211\u4eec\u5c31\u80fd\u627e\u5230\u7b54\u6848\u3002\n\n\u6211\u4eec\u77e5\u9053\u6709\u4e00\u4e2a\u7ed3\u8bba\uff0c\u5373\u901a\u8fc7\u4e00\u6761\u8fb9\u8fde\u8d77\u6765\u7684\u4e24\u68f5\u6811\u7684\u76f4\u5f84\u7684\u7aef\u70b9\u5fc5\u7136\u4e5f\u662f\u539f\u6765\u4e24\u68f5\u6811\u7684\u56db\u4e2a\u76f4\u5f84\u7aef\u70b9\u4e4b\u4e8c\u3002\u90a3\u6211\u4eec\u8003\u8651\u8fd9\u6761\u8fb9\u8fde\u5728\u54ea\u91cc\u624d\u80fd\u8ba9\u8fd9\u56db\u4e2a\u70b9\u4e24\u4e24\u4e4b\u95f4\u7684\u6700\u957f\u8ddd\u79bb\u6700\u77ed\uff1f\u53ef\u4ee5\u60f3\u5230\u662f\u5206\u522b\u8fde\u4e24\u68f5\u6811\u76f4\u5f84\u5c3d\u91cf\u9760\u4e2d\u95f4\u7684\u70b9\uff0c\u56e0\u4e3a\u5982\u679c\u4e0d\u5728\u4e2d\u95f4\uff0c\u90a3\u4e48\u4e24\u6761\u76f4\u5f84\u8f83\u957f\u7684\u4e24\u534a\u62fc\u8d77\u6765\u5f97\u5230\u7684\u76f4\u5f84\u4e00\u5b9a\u6bd4\u5728\u4e2d\u95f4\u8fde\u7684\u957f\u3002\u90a3\u6b64\u65f6\u65b0\u6811\u7684\u76f4\u5f84\u5176\u5b9e\u5c31\u662f**\u539f\u6765\u4e24\u68f5\u6811\u5404\u81ea\u7684\u76f4\u5f84\u4e0e\u4e24\u6761\u76f4\u5f84\u957f\u5ea6\u9664\u4e8c\u5411\u4e0a\u53d6\u6574 $+1$ \u7684\u6700\u5927\u503c**\u3002\u753b\u51e0\u5f20\u793a\u610f\u56fe\u53ef\u4ee5\u65b9\u4fbf\u7406\u89e3\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/vqf6htgw.png)\n\n\u4e24\u6761\u9ed1\u7ebf\u662f\u4e24\u68f5\u5b50\u6811\u7684\u76f4\u5f84\uff0c\u7ea2\u7ebf\u662f\u6211\u4eec\u8fde\u4e0a\u53bb\u7684\u8fb9\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fde\u8fb9\u4f4d\u7f6e\u5c3d\u91cf\u9760\u8fd1\u4e2d\u95f4\u76f4\u5f84\u624d\u4f1a\u4f7f\u6700\u5c0f\u7684\u3002\n\n\u53e6\u5916\u53ef\u4ee5\u8bc1\u660e\u5982\u679c\u8fd9\u6761\u8fb9\u4e24\u7aef\u70b9\u4e0d\u5728\u539f\u6811\u76f4\u5f84\u4e0a\uff0c\u7b54\u6848\u4e00\u5b9a\u4e0d\u4f18\u3002\n\n\u4e8e\u662f\u5728\u6240\u6709\u60c5\u51b5\u91cc\u53d6\u4e2a\u6700\u5c0f\u7684\u5c31\u662f\u7b54\u6848\u3002\n\n### \u6c42\u6700\u5927\u53ef\u80fd\u76f4\u5f84\n\n\u4f9d\u65e7\u662f\u7c7b\u4f3c\u7684\u601d\u8def\uff0c\u6211\u4eec\u4ee5\u4e00\u4e2a\u76f4\u5f84\u7aef\u70b9\u4e3a\u6839\u3002\n\n\u663e\u7136\u5982\u679c\u6211\u4eec\u65ad\u6389\u4efb\u610f\u4e00\u6761\u8fb9\uff0c\u4f7f\u5f97\u76f4\u5f84\u6700\u957f\u7684\u62fc\u63a5\u65b9\u5f0f\u4e00\u5b9a\u662f\u5c06\u4e24\u68f5\u6811\u7684\u76f4\u5f84\u7aef\u70b9\u7ed9\u8fde\u8d77\u6765\u3002\n\n\u8003\u8651\u4e24\u79cd\u60c5\u51b5\uff1a\n\n#### \u65ad\u6389\u76f4\u5f84\u7684\u4e00\u6761\u8fb9\n\n\u56e0\u4e3a\u6211\u4eec\u5df2\u7ecf\u5206\u522b\u4ee5\u4e24\u4e2a\u76f4\u5f84\u7aef\u70b9\u4e3a\u6839\u6c42\u8fc7\u6bcf\u68f5\u5b50\u6811\u7684\u7b54\u6848\uff0c\u6240\u4ee5\u76f4\u63a5\u67e5\u4e24\u68f5\u6811\u5bf9\u5e94\u5b50\u6811\u76f4\u5f84\u957f\u5ea6\u52a0\u8d77\u6765\u52a0\u4e00\u7136\u540e\u53d6\u6700\u5927\u5c31\u53ef\u4ee5\u4e86\u3002\n\n#### \u65ad\u6389\u4e00\u6761\u975e\u76f4\u5f84\u8fb9\n\n\u90a3\u4e48\u663e\u7136\u5176\u4e2d\u4e00\u68f5\u6811\u7684\u76f4\u5f84\u5c31\u662f\u539f\u6765\u7684\u76f4\u5f84\uff0c\u5e76\u4e14\u53ef\u4ee5\u53d1\u73b0\u65ad\u6389\u548c\u76f4\u5f84\u70b9\u76f8\u8fde\u7684\u975e\u76f4\u5f84\u8fb9\u662f\u6700\u4f18\u7684\uff0c\u4e5f\u662f\u679a\u4e3e\u4e4b\u540e\u76f4\u63a5\u67e5\u4e4b\u524d\u6c42\u7684\u7b54\u6848\u53d6\u6700\u5927\u5c31\u53ef\u4ee5\u4e86\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ninline int read(){\n\tchar c;int f=1,res=0;\n\twhile(c=getchar(),!isdigit(c))if(c=='-')f*=-1;\n\twhile(isdigit(c))res=res*10+c-'0',c=getchar();\n\treturn res*f;\n}\nconst int N=5e5+5;\nint n;\nvector<int> ver[N];\nstruct eg{int u,v,w;}; \nstruct tr{\n\tint rt,d[N],fa[N];eg f[N],g[N];\n\tinline eg max(eg x,eg y)\n\t\t{return x.w>y.w?x:y;}\n\tvoid DFS(int u,int pr=0){\n\t\tif(!pr)rt=u;\n\t\td[u]=d[pr]+1;fa[u]=pr;\n\t\tint p0=u,p1=u;g[u]={u,u,0};\n\t\tfor(int v:ver[u]){\n\t\t\tif(v==pr)continue;\n\t\t\tDFS(v,u);g[u]=max(g[u],g[v]);\n\t\t\tif(d[f[v].u]>=d[p0])\n\t\t\t\tp1=p0,p0=f[v].u;\n\t\t\telse if(d[f[v].u]>d[p1])\n\t\t\t\tp1=f[v].u;\n\t\t}f[u]={p0,p1,d[p0]+d[p1]-2*d[u]};\n\t\tg[u]=max(g[u],f[u]);\n\t}\n}t,t0,t1,c;\ninline int find(eg x){\n\tc.DFS(x.u);\n\tfor(int i=1;i<=(x.w+1)/2;++i)\n\t\tx.v=c.fa[x.v];\n\treturn x.v;\n}\ninline void smn(){\n\tint p=0,ans=N,u=t1.rt;\n\twhile(u!=t0.rt){\n\t\teg x=t0.g[u],y=t1.g[t0.fa[u]];\n\t\tint upd=(x.w+1)/2+(y.w+1)/2+1;\n\t\tupd=max(upd,max(x.w,y.w));\n\t\tif(upd<ans)p=u,ans=upd;u=t0.fa[u];\n\t}printf(\"%d %d %d \",ans,p,t0.fa[p]);\n\teg x=t0.g[p],y=t1.g[t0.fa[p]];\n\tprintf(\"%d %d\\n\",find(x),find(y));\n}\ninline void smx(){\n\tint lst=0,u=t1.rt,p,ans=0;\n\tbool flg;\n\twhile(u){\n\t\tfor(int v:ver[u]){\n\t\t\tif(v==lst||v==t0.fa[u])\n\t\t\t\tcontinue;\n\t\t\tint upd=t.g[1].w+1+t0.g[v].w;\n\t\t\tif(upd>ans)ans=upd,p=v,flg=false;\n\t\t}if(t0.fa[u]){\n\t\t\tint upd=t0.g[u].w+1+t1.g[t0.fa[u]].w;\n\t\t\tif(upd>ans)ans=upd,p=u,flg=true;\n\t\t}lst=u;u=t0.fa[u];\n\t}printf(\"%d %d %d \",ans,p,t0.fa[p]);\n\tif(!flg)printf(\"%d %d\",t0.g[p].u,t0.rt);\n\telse printf(\"%d %d\",t0.g[p].u,t1.g[t0.fa[p]].u);\n}\nint main(){\n\tn=read();\n\tfor(int i=1;i<n;++i){\n\t\tint u=read(),v=read();\n\t\tver[u].push_back(v);\n\t\tver[v].push_back(u);\n\t}t.DFS(1);\n\tt0.DFS(t.g[1].u);\n\tt1.DFS(t.g[1].v);\n\tsmn();smx();\n\treturn 0;\n}\n\n```\n\n",
        "postTime": 1649919840,
        "uid": 206258,
        "name": "SDNetFriend",
        "ccfLevel": 7,
        "title": "P3596 [POI2015] MOD \u9898\u89e3"
    },
    {
        "content": "\u8fd9\u9898\u597d\u96be\u60f3\u554a\u2026\u2026\u6700\u540e\u8fd8\u662f\u770b\u4e86\u597d\u51e0\u7bc7\u9898\u89e3\u624d\u5199\u51fa\u6765\u7684\u2026\u2026\n\n\u9996\u5148,\u5728\u6211\u4eec\u5220\u6389\u4e00\u6761\u8fb9\u7684\u65f6\u5019,\u6211\u4eec\u4f1a\u5f97\u5230\u4e24\u9897\u5b50\u6811,\u5b83\u4eec\u6709\u81ea\u5df1\u7684\u76f4\u5f84\n\n\u6839\u636e\u8d2a\u5fc3\u7684\u601d\u60f3,\u6700\u5927\u503c\u5f88\u597d\u770b\u51fa,\u5373\u4e24\u68f5\u6811\u7684\u76f4\u5f84\u76f8\u52a0\u518d$+1$\u3002\u800c\u6700\u5c0f\u503c\u5176\u5b9e\u5c31\u662f\u628a\u4e24\u68f5\u6811\u76f4\u5f84\u7684\u4e2d\u70b9\u94fe\u63a5,\u8fd9\u6837\u5c31\u80fd\u4fdd\u8bc1\u4e00\u6574\u68f5\u6811\u7684\n\n\u5173\u952e\u5728\u4e8e\u5982\u4f55\u53bb\u64cd\u4f5c,\u8fd9\u9700\u8981\u7ec6\u5fc3\u53bb\u4f53\u4f1a\n\n\u6211\u4eec\u5728\u8fd9\u91cc\u5148\u8bbe\u5b9a\u51e0\u4e2a\u70b9\n\n$dep[i]:~i$\u8282\u70b9\u7684\u6df1\u5ea6\n\n$rt[i]:$ \u4ee5$i$\u4e3a\u6839\u7684\u5b50\u6811\u7684\u6700\u957f\u76f4\u5f84\n\n$dis[i][j](j\\in\\{0,1,2\\}):$ \u5206\u522b\u8868\u793a\u4ecei\u8282\u70b9\u5411\u4e0b\u7684\u6700\u957f\u94fe\uff0c\u6b21\u957f\u94fe\uff0c\u548c\u6b21\u6b21\u957f\u94fe\n\n$dis2[i][j](j\\in\\{0,1\\}):$ \u5206\u522b\u8868\u793a\u4ee5i\u8282\u70b9\u7684\u5b50\u8282\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u6700\u957f\u76f4\u5f84\u548c\u6b21\u957f\u76f4\u5f84\n\n$lian[i]:$ \u628a\u5f53\u524d\u8282\u70b9\u5f53\u505a\u6839\u8282\u70b9\u7684\u6700\u957f\u94fe\u957f\u5ea6\n\n$f[i]:$ \u5b58\u7684\u7236\u4eb2\u53ca\u8282\u70b9\n\n$g[i]:$ \u8868\u793a\u5220\u9664$i$\u70b9\u4e0e$f[i]$\u70b9\u4e4b\u95f4\u7684\u8fb9\u540e\uff0c\u4ee5$1$\u4e3a\u6839\u7684\u90a3\u68f5\u6811\u7684\u6700\u957f\u76f4\u5f84\n\n\u9996\u5148\u662f$dfs1$\n\n\u5728$dfs1$\u91cc\u9762,\u6211\u4eec\u8981\u8fdb\u884c\u66f4\u65b0\u7684\u6570\u7ec4\u662f$dis1,dis2$\u4e0e$rt$\uff0c\u4ee5\u4fbf\u4e8e\u540e\u9762$dfs2$\u7684\u8ba1\u7b97\n\n\u5728$dfs1$\u7ef4\u62a4\u5176\u5b9e\u662f\u633a\u7b80\u5355\u7684,\u8fd9\u91cc\u5c31\u4e0d\u7ec6\u8bb2\u4e86(\u8be6\u60c5\u89c1\u4ee3\u7801)\n\n\u5173\u952e\u5728\u4e8e$dfs2$\n\n\u5728$dfs2$,\u6211\u4eec\u4e3b\u8981\u8fdb\u884c\u66f4\u65b0\u7684\u6570\u7ec4\u662f$g,lian$,\u5e76\u4e14\u987a\u4fbf\u7ef4\u62a4\u4e00\u4e0b$ans\\_max,ans\\_min$\n\n\u800c\u5982\u4f55\u53bb\u7ef4\u62a4\u5462\n\n\u9996\u5148,\u6211\u4eec\u6839\u636e\u4e0a\u9762\u60f3\u5230\u7684\u7b54\u6848,\u53ef\u4ee5\u5f97\u5230\u5272\u6389\u5f53\u524d\u70b9\u4e0e\u4ed6\u7236\u4eb2\u4e4b\u95f4\u7684\u8fde\u7ebf\u540e\u518d\u63a5,\u6700\u957f\u94fe\u80af\u5b9a\u4e3a$rt[x]+g[x]+1$,\u8fd9\u65f6\u5019\u8fdb\u884c\u6bd4\u8f83\u5373\u53ef,\u8fd9\u6837\u5c31\u66f4\u65b0\u597d$ans\\_max$\u4e86\n\n\u800c$ans\\_min$\u7565\u5fae\u96be\u66f4\u65b0,\u56e0\u4e3a\u4ed6\u8fd8\u8981\u5224\u65ad\u5206\u5f00\u7684**\u4e24\u68f5\u6811\u8fde\u5728\u4e00\u8d77\u662f\u5426\u6bd4\u8fd9\u4e24\u68f5\u6811\u539f\u672c\u7684\u76f4\u5f84\u8fd8\u8981\u957f**,\u5373\u8fd9\u662f\u6211\u4eec\u6811\u7684\u76f4\u5f84\u4e3a$max(max(rt[x],g[x]),(rt[x]+1)/2+(g[x]+1)/2+1)$,\u8fd9\u4e4b\u540e\u518d\u53bb\u66f4\u65b0$ans_min$\u5373\u53ef\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u66f4\u65b0$g,lian$\u8fd9\u4e24\u4e2a\u6570\u7ec4\u4e86\n\n\u6211\u4eec\u8bb0\u5f53\u524d\u8bbf\u95ee\u5230\u7684\u5b50\u8282\u70b9\u4e3a$y$\n\n1. \u4ecedis\u66f4\u65b0\n\n\u6211\u4eec\u8ba8\u8bba\u5f53$y$\u4e3a$x$\u7684\u7b2c\u4e00\u957f\u94fe\u7684\u60c5\u51b5\n\n\u4e0d\u96be\u53d1\u73b0,\u6b64\u65f6$g[y]$\u53ef\u80fd\u4e3ax\u7684\u7b2c\u4e8c\u957f\u94fe+\u7b2c\u4e09\u957f\u94fe,\u6216\u8005\u7b2c\u4e8c\u957f\u94fe+\u5411\u4e0a\u8d70\u80fd\u6700\u591a\u8d70\u5230\u7684\u8ddd\u79bb\n\n\u800c\u6b64\u65f6$lian[y]$\u53c8\u80fd\u5c0f\u4e8ex\u7684\u7b2c\u4e8c\u957f\u94fe+1(\u4ece\u7b2c\u4e8c\u957f\u94fe\u53f6\u5b50\u7ed3\u70b9\u8d70\u4e0a\u53bb\u518d\u8d70\u5230\u5f53\u524d\u70b9)\n\n\u5f97\u5230\n\n$lian[y]=max(max(lian[y],dis[x][1]+dis[x][2]),dis[x][1]+lian[x])$\n\n\u540c\u7406,\u5f53\u5b83\u5728\u7b2c\u4e8c\u957f\u94fe\u6216\u8005\u7b2c\u4e09\u957f\u94fe\u6216\u8005\u66f4\u5c0f\u7684\u65f6\u5019,\u4e5f\u53ef\u4ee5~~\u8f7b\u677e\u5730~~\u63a8\u51fa\u7c7b\u4f3c\u7684\u65b9\u7a0b\n\n2. \u4ecedis2\u66f4\u65b0\n\n\u8fd9\u4e2d\u60c5\u51b5(\u6211\u4e2a\u4eba\u8ba4\u4e3a)\u6bd4\u60c5\u51b51\u96be\u60f3\u3002\n\n\u8fd9\u91cc\u4ee5$y$\u5728$dis2[x][0]$\u4e0a\u4e3a\u4f8b\n\n\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3:**\u5f53\u8fd9y\u4e0ex\u9694\u5f00\u4e86\u4ee5\u540e,\u4ee51\u4e3a\u6839\u7684\u76f4\u5f84\u4e0d\u4e00\u5b9a\u4f1a\u8d70\u5230x\u8fd9\u91cc,\u4f46\u662f\u6b64\u65f6\u5728dis2[x][1]\u4e0a\u9762\u7684x\u5b50\u8282\u70b9\u662f\u6ca1\u6709\u4e0ex\u9694\u5f00\u7684,\u56e0\u6b64\u4ee51\u4e3a\u6839\u7684\u76f4\u5f84\u76f8\u5f53\u4e8e\u4ee5\u8fd9\u4e2a\u8282\u70b9\u4e3a\u6839\u7684\u76f4\u5f84**\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\n\n$lian[y]=max(lian[y],dis2[x][1])$\n\n\u800c$y$\u4e0d\u518d$dis2[x][0]$\u65f6,\u4e5f\u7c7b\u4f3c\u5f97\u53ef\u4ee5\u5f97\u51fa\u65b9\u7a0b\n\n\u8fd9\u6837,\u6211\u4eec\u7684$ans\\_max$\u4e0e$ans\\_min$\u5c31\u51fa\u6765\u4e86\n\n\u6700\u540e,\u6211\u4eec\u8fd8\u8981\u627e\u5230$ans$\u7684\u6700\u5927\u503c\u4ee5\u53ca\u6700\u5c0f\u503c\u6240\u5bf9\u5e94\u7684\u8981\u6dfb\u52a0\u7684\u8fb9,\u90a3\u4e48\u8be5\u5982\u4f55\u53bb\u6dfb\u5462\uff1f\n\n\u5176\u5b9e,\u627e\u8fd9\u4e24\u4e2a\u70b9\u53ea\u9700\u8981\u627e\u5230\u5220\u6389\u7684\u8fb9\u7684\u90a3\u4e24\u4e2a\u7aef\u70b9,\u518d\u8dd1\u6811\u7684\u76f4\u5f84,\u627e\u51fa\u6ee1\u8db3\u6811\u7684\u76f4\u5f84\u7684\u6df1\u5ea6\u8f83\u5c0f\u7aef\u70b9,\u5411\u4e0a\u8d70\u4e00\u822c\u7684\u8ddd\u79bb\u540e\u518d\u8fde\u8d77\u6765,$ans\\_min$\u5c31\u51fa\u6765\u4e86\n\n\u800c\u5bf9\u4e8e$ans\\_max$,\u6211\u4eec\u627e\u5230\u4e24\u4e2a\u6811\u7684\u76f4\u5f84\u7684\u7aef\u70b9,\u8fde\u8d77\u6765\u5c31\u53ef\u4ee5\u4e86\n\n\u81f3\u6b64,\u6574\u4e2a\u95ee\u9898\u5c31\u89e3\u51b3\u4e86(~~\u597d\u9ebb\u70e6~~)\n\n#### Code:\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int M=500005,oo=1e9;\n\n/*\n\ndep[i]\uff1ai\u8282\u70b9\u7684\u6df1\u5ea6\n\nrt[i]\uff1a\u4ee5i\u4e3a\u6839\u7684\u5b50\u6811\u7684\u6700\u957f\u76f4\u5f84\n\ndis[i][j](j\u2208{0,1,2}):\u5206\u522b\u8868\u793a\u4ecei\u8282\u70b9\u5411\u4e0b\u7684\u6700\u957f\u94fe\uff0c\u6b21\u957f\u94fe\uff0c\u548c\u6b21\u6b21\u957f\u94fe\n\ndis2[i][j](j\u2208{0,1})\uff1a\u5206\u522b\u8868\u793a\u4ee5i\u8282\u70b9\u7684\u5b50\u8282\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u6700\u957f\u76f4\u5f84\u548c\u6b21\u957f\u76f4\u5f84\n\nlian[i]\uff1a\u628a\u5f53\u524d\u8282\u70b9\u5f53\u505a\u6839\u8282\u70b9\u7684\u6700\u957f\u94fe\u957f\u5ea6\n\nf[i]\uff1a\u5b58\u7684\u7236\u4eb2\u53ca\u8282\u70b9\n\ng[i]\uff1a\u8868\u793a\u5220\u9664i\u70b9\u4e0efa[i]\u70b9\u4e4b\u95f4\u7684\u8fb9\u540e\uff0c\u4ee51\u4e3a\u6839\u7684\u90a3\u68f5\u6811\u7684\u6700\u957f\u76f4\u5f84\n\n*/\n\nint dep[M],f[M],rt[M],dis[M][5],dis2[M][5],g[M],lian[M];\nint ans_max=-oo,ans_min=oo,x_max,y_max,x_min,y_min;\nstruct edge{\n\tint to,nxt;\n}Edge[M<<1];\nint head[M],tot;\n\nvoid AddEdge(int x, int y){\n\tEdge[++tot]=(edge)<%y,head[x]%>;\n\thead[x]=tot;\n}\n\ninline int max(int x, int y){\n\treturn x>y?x:y;\n}\n\ninline int min(int x, int y){\n\treturn x<y?x:y;\n}\n\nvoid dfs1(int x, int fa){\n\tdep[x]=dep[fa]+1;\n\tf[x]=fa;\n\tfor(int i=head[x]; i; i=Edge[i].nxt){\n\t\tint y=Edge[i].to;\n\t\tif(y==fa) continue;\n\t\tdfs1(y,x);\n\t\trt[x]=max(rt[x],rt[y]); //\u66f4\u65b0\n\t\tint now=dis[y][0]+1;\n\t\tif(now>dis[x][0]){ //\u66f4\u65b0\u5411\u4e0b\u7684\u6700\u957f\u94fe,\u6b21\u957f\u94fe,\u7b2c\u4e09\u94fe\n\t\t\tdis[x][2]=dis[x][1]; dis[x][1]=dis[x][0]; dis[x][0]=now;\n\t\t} else if(now>dis[x][1]){\n\t\t\tdis[x][2]=dis[x][1]; dis[x][1]=now;\n\t\t} else if(now>dis[x][2]) dis[x][2]=now;\n\t\tnow=rt[y];\n\t\tif(now>dis2[x][0]){//\u66f4\u65b0\u5b50\u8282\u70b9\u4e3a\u6839\u7684\u60c5\u51b5\n\t\t\tdis2[x][1]=dis2[x][0]; dis2[x][0]=now;\n\t\t}else if(now>dis2[x][1]){\n\t\t\tdis2[x][1]=now;\n\t\t}\n\t}\n\trt[x]=max(rt[x],dis[x][0]+dis[x][1]);\n}\n\nvoid dfs2(int x, int fa){\n\tif(x!=1){\n\t\tint now=g[x]+rt[x]+1;//\u5206\u5f00\u8fd9\u4e2a\u70b9\u4e0e\u4ed6\u7684\u7236\u4eb2\n\t\tif(ans_max<now){\n\t\t\tans_max=now; x_max=f[x]; y_max=x;\n\t\t}\n\t\tnow=max(max(rt[x],g[x]),(rt[x]+1)/2+(g[x]+1)/2+1); //\u9694\u5f00\u6765\u540e\u7b2c\u4e00\u68f5\u6811\u7684\u76f4\u5f84/\u7b2c\u4e8c\u68f5\u6811\u7684\u76f4\u5f84/\u4e24\u68f5\u6811\u5408\u5e76\u540e\u51fa\u73b0\u7684\u65b0\u957f\u94fe(\u6811\u7684\u76f4\u5f84\u7684\u5b9a\u4e49\u4e3a\u6700\u957f\u94fe)\n\t\tif(ans_min>now){\n\t\t\tans_min=now; x_min=f[x]; y_min=x;\n\t\t}\n\t}\n\tfor(int i=head[x]; i; i=Edge[i].nxt){\n\t\tint y=Edge[i].to;\n\t\tif(y==fa) continue;\n\t\tlian[y]=max(lian[y],lian[x]+1);//\u66f4\u65b0\u6700\u5927\u80fd\u8d70\u8ddd\u79bb\n\t\tg[y]=max(g[y],g[x]);//\u66f4\u65b0g\n\t\tint now=dis[y][0]+1;\n\t\tif(now==dis[x][0]){\n\t\t\tg[y]=max(max(g[y],dis[x][1]+dis[x][2]),dis[x][1]+lian[x]);//\u5b83\u7684\u4e24\u6761\u5b50\u94fe/\u5b83\u7684\u4e00\u6761\u5b50\u94fe+\u5411\u4e0a\u8d70\u7684\u6700\u957f\u94fe\n\t\t\tlian[y]=max(lian[y],dis[x][1]+1);//\u4e0d\u5206\u5f00\u7b97\n\t\t}else if(now==dis[x][1]){\n\t\t\tg[y]=max(max(g[y],dis[x][0]+dis[x][2]),dis[x][0]+lian[x]);\n\t\t\tlian[y]=max(lian[y],dis[x][0]+1);\n\t\t}else{\n\t\t\tg[y]=max(max(g[y],dis[x][0]+dis[x][1]),dis[x][0]+lian[x]);\n\t\t\tlian[y]=max(lian[y],dis[x][0]+1);\n\t\t}\n\t\tnow=rt[y];\n\t\tif(now==dis2[x][0]){//\u4ee51\u4f4d\u6839\u7684\u76f4\u5f84\u4e0d\u4e00\u5b9a\u7ecf\u8fc7x,\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u53d6max\u4e8ex\u8282\u70b9\n\t\t\tg[y]=max(g[y],dis2[x][1]);\n\t\t}else{\n\t\t\tg[y]=max(g[y],dis2[x][0]);\n\t\t}\n\t\tdfs2(y,x);\n\t}\n}\n\nbool mark[M];\nqueue<int>Q;\n\nint bfs(int x){//\u627e\u51fa\u4ee5\u8fd9\u4e2a\u70b9\u4e3a\u6839\u7684\u76f4\u5f84\u53e6\u4e00\u70b9\n\tint res=0;\n\tmemset(mark,0,sizeof mark);\n\tQ.push(x); mark[x]=1;\n\twhile(!Q.empty()){\n\t\tint now=Q.front(); Q.pop();\n\t\tres=now;\n\t\tfor(int i=head[now]; i; i=Edge[i].nxt){\n\t\t\tint y=Edge[i].to;\n\t\t\tif(mark[y] || (now==x_min && y==y_min) || (now==y_min && y==x_min)) continue;\n\t\t\tQ.push(y); mark[y]=1;\n\t\t}\n\t}\n\treturn res;\n}\n\nint Up(int x, int y, int z){ //GO UP\n\tint up=z;\n\tif(dep[x]<dep[y]) swap(x,y);\n\twhile(up!=(z+1)/2){\n\t\tx=f[x]; up--;\n\t}\n\treturn x;\n}\n\nvoid Print_Min(){//\u8f93\u51fa\u6700\u5c0f\u503c\n\tprintf(\"%d %d %d \",ans_min,x_min,y_min);\n\tint pointx=bfs(x_min),pointx1=bfs(pointx);\n\tint pointy=bfs(y_min),pointy1=bfs(pointy);\n\tprintf(\"%d %d\\n\",Up(pointx,pointx1,g[y_min]),Up(pointy,pointy1,rt[y_min]));\n}\n\nvoid Print_Max(){//\u8f93\u51fa\u6700\u5927\u503c\n\tprintf(\"%d %d %d \",ans_max,x_max,y_max);\n\tmemset(mark,0,sizeof mark);\n\tQ.push(x_max); mark[x_max]=1;\n\twhile(!Q.empty()){\n\t\tint now=Q.front(); Q.pop(); x_max=now;\n\t\tfor(int i=head[now]; i; i=Edge[i].nxt){\n\t\t\tint y=Edge[i].to;\n\t\t\tif(mark[y] || y==x_max || y==y_max) continue;\n\t\t\tmark[y]=1; Q.push(y);\n\t\t}\n\t}\n\tQ.push(y_max); mark[y_max]=1;\n\twhile(!Q.empty()){\n\t\tint now=Q.front(); Q.pop(); y_max=now;\n\t\tfor(int i=head[now]; i; i=Edge[i].nxt){\n\t\t\tint y=Edge[i].to;\n\t\t\tif(mark[y]) continue;\n\t\t\tmark[y]=1; Q.push(y);\n\t\t}\n\t}\n\tprintf(\"%d %d\\n\",x_max,y_max);\n}\n\nint main(){\n\tint n;\n\tscanf(\"%d\",&n);\n\tfor(int i=1,x,y; i<n; i++){\n\t\tscanf(\"%d %d\",&x,&y);\n\t\tAddEdge(x,y); AddEdge(y,x);\n\t}\n\tdfs1(1,0), dfs2(1,0);\n\tPrint_Min(); Print_Max();\n\treturn 0;\n}\n```\n\n~~\u6ca1\u60f3\u5230\u6d1b\u8c37\u768480\u5206/90\u5206\u662f\u56e0\u4e3a\u7528\u4e86vector\u6ca1\u7528\u524d\u5411\u661f~~",
        "postTime": 1563695364,
        "uid": 81715,
        "name": "ppp204",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3596 \u3010[POI2015]MOD\u3011"
    },
    {
        "content": "- Update on 2022.11.25 \u91cd\u5199\u9898\u89e3\uff0c\u539f\u9898\u89e3\u89c1 [\u94fe\u63a5](https://www.luogu.com.cn/paste/ugdktbes)\u3002\n\n[P3596 [POI2015] MOD](https://www.luogu.com.cn/problem/P3596)\n\n\u8003\u8651\u679a\u4e3e\u65ad\u6389\u7684\u8fb9\uff0c\u6211\u4eec\u5e0c\u671b\u5feb\u901f\u6c42\u51fa\u5f62\u6210\u7684\u4e24\u4e2a\u8fde\u901a\u5757\u7684\u76f4\u5f84 $d_1$ \u548c $d_2$\uff0c\u5219\u8fde\u4e00\u6761\u8fb9\u5f62\u6210\u7684\u76f4\u5f84\u6700\u5927\u957f\u5ea6\u4e3a $d_1 + d_2 + 1$\uff08\u8fde\u63a5\u4e24\u8fde\u901a\u5757\u76f4\u5f84\u4e00\u6bb5\uff09\uff0c\u6700\u5c0f\u76f4\u5f84\u957f\u5ea6\u4e3a $\\max(d_1, d_2, \\lceil \\frac {d_1} 2 \\rceil + \\lceil \\frac {d_2} 2\\rceil + 1)$\uff08\u8fde\u63a5\u4e24\u8fde\u901a\u5757\u76f4\u5f84\u4e2d\u70b9\uff09\u3002\n\n\u8bbe $f_i$ \u8868\u793a\u5b50\u6811\u6700\u957f\u7ad6\u76f4\u94fe\uff0c$g_i$ \u8868\u793a\u5b50\u6811\u76f4\u5f84\uff0c\u5219\n$$\n\\begin{aligned}\nf_i & = \\max\\limits_{u \\in \\mathrm{son}(i)} f_u + 1 \\\\\ng_i & = \\max\\left(\\max_{u\\in \\mathrm{son}(i)} g_u, \\max_{u, v\\in \\mathrm{son}(i), u\\neq v} f_u + f_v + 2\\right)\n\\end{aligned}\n$$\n\u6c42\u6bcf\u68f5\u5b50\u6811\u7684\u76f4\u5f84\u53ef\u76f4\u63a5\u6362\u6839 DP\u3002\u6362\u6839 DP \u8fc7\u7a0b\u4e2d\u9700\u8981\u5bf9 $i$ \u6c42\u51fa\u5c06\u6bcf\u4e2a\u513f\u5b50 $u$ \u4ece $\\mathrm{son}(i)$ \u4e2d\u5220\u9664\u540e\u65b0\u7684 $f$ \u548c $g$ \u503c\uff0c\u4f7f\u7528\u7ef4\u62a4\u524d\u540e\u7f00\u7684\u7ecf\u5178\u5957\u8def\uff0c$f$ \u5bb9\u6613\u7ef4\u62a4\uff0c$g$ \u5728\u5408\u5e76\u7684\u65f6\u5019\u8fd8\u9700\u8981\u548c\u524d\u7f00 $\\max f$ \u4e0e\u540e\u7f00 $\\max f$ \u4e4b\u548c\u53d6 $\\max$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n)$\u3002\u56e0\u9700\u6784\u9020\u65b9\u6848\uff0c\u6240\u4ee5\u9700\u8981\u7ef4\u62a4\u6700\u957f\u7ad6\u76f4\u94fe\u7684\u4e00\u6bb5\u548c\u76f4\u5f84\u4e24\u7aef\uff0c\u4f7f\u7528\u7ed3\u6784\u4f53\u53ef\u907f\u514d\u7e41\u7410\u7684\u5206\u7c7b\u8ba8\u8bba\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define TIME 1e3 * clock() / CLOCKS_PER_SEC\n\nconstexpr int N = 5e5 + 5;\nvector<int> e[N];\nint n;\nstruct chain {\n  int u, d;\n  chain operator + (const int &z) const {return {u, d + z};}\n  bool operator < (const chain &z) const {return d < z.d;}\n} f[N], ff[N];\nstruct diam {\n  int u, v, d;\n  void print() {cout << \"diameter: u = \" << u << \", v = \" << v << \", d = \" << d << \"\\n\";}\n  diam operator + (const int &z) const {return {u, v, d + z};}\n  bool operator < (const diam &z) const {return d < z.d;}\n} g[N], gg[N];\ndiam operator + (const chain &x, const chain &y) {return {x.u, y.u, x.d + y.d};}\n\nvoid dfs1(int id, int fa) {\n  f[id] = {id, 0}, g[id] = {id, id, 0};\n  for(int it : e[id]) {\n    if(it == fa) continue;\n    dfs1(it, id);\n    g[id] = max(g[id], max(g[it], f[id] + f[it] + 1));\n    f[id] = max(f[id], f[it] + 1);\n  }\n}\n\nint mxd, mxeu, mxev;\nint mnd = N, mneu, mnev;\ndiam mxu, mxv, mnu, mnv;\nvoid dfs2(int id, int fa) {\n  if(fa) {\n    // cout << \"dfs2 \" << id << \" \" << fa << \"\\n\";\n    // g[id].print(), g[fa].print();\n    int dist = g[id].d + g[fa].d + 1;\n    if(dist > mxd) mxd = dist, mxu = g[id], mxv = g[fa], mxeu = id, mxev = fa;\n    dist = max((g[id].d + 1 >> 1) + (g[fa].d + 1 >> 1) + 1, max(g[id].d, g[fa].d));\n    if(dist < mnd) mnd = dist, mnu = g[id], mnv = g[fa], mneu = id, mnev = fa;\n  }\n  static chain fp[N], fs[N];\n  static diam gp[N], gs[N];\n  int sz = e[id].size();\n  fp[0] = fs[sz + 1] = {id, 0};\n  gp[0] = gs[sz + 1] = {id, id, 0};\n  for(int i = 1; i <= sz; i++) {\n    int it = e[id][i - 1];\n    gp[i] = max(gp[i - 1], max(g[it], fp[i - 1] + f[it] + 1));\n    fp[i] = max(fp[i - 1], f[it] + 1);\n  }\n  for(int i = sz; i; i--) {\n    int it = e[id][i - 1];\n    gs[i] = max(gs[i + 1], max(g[it], fs[i + 1] + f[it] + 1));\n    fs[i] = max(fs[i + 1], f[it] + 1);\n  }\n  for(int i = 1; i <= sz; i++) {\n    int it = e[id][i - 1];\n    ff[it] = max(fp[i - 1], fs[i + 1]);\n    gg[it] = max(max(gp[i - 1], gs[i + 1]), fp[i - 1] + fs[i + 1]);\n  }\n  for(int it : e[id]) if(it != fa) f[id] = ff[it], g[id] = gg[it], dfs2(it, id);\n}\n\nvector<int> pu, pv;\nbool search(int id, int ff, int aim, vector<int> &arr) {\n  arr.push_back(id);\n  if(id == aim) return 1;\n  for(int it : e[id]) if(it != ff && search(it, id, aim, arr)) return 1;\n  arr.pop_back();\n  return 0;\n}\n\nint main() {\n  #ifdef ALEX_WEI\n    FILE* IN = freopen(\"1.in\", \"r\", stdin);\n    FILE* OUT = freopen(\"1.out\", \"w\", stdout);\n  #endif\n  ios::sync_with_stdio(0), cin.tie(0), cout.tie(0);\n  cin >> n;\n  for(int i = 1; i < n; i++) {\n    int u, v;\n    cin >> u >> v;\n    e[u].push_back(v), e[v].push_back(u);\n  }\n  dfs1(1, 0), dfs2(1, 0);\n  cout << mnd << \" \" << mneu << \" \" << mnev << \" \";\n  search(mnu.u, 0, mnu.v, pu), search(mnv.u, 0, mnv.v, pv);\n  cout << pu[mnu.d >> 1] << \" \" << pv[mnv.d >> 1] << \"\\n\";\n  cout << mxd << \" \" << mxeu << \" \" << mxev << \" \" << mxu.v << \" \" << mxv.u << \"\\n\";\n  return cerr << \"Time: \" << TIME << \" ms\\n\", 0;\n}\n```\n\n\u7ffb\u4e86\u4e00\u904d\u9898\u89e3\u533a\u53d1\u73b0 [SDNetFriend](https://www.luogu.com.cn/user/206258) \u7684\u505a\u6cd5\u975e\u5e38\u5de7\u5999\u3002\u5bf9\u4e8e\u76f4\u5f84\u6700\u5c0f\u503c\uff0c\u6211\u4eec\u4e00\u5b9a\u4f1a\u65ad\u6389\u76f4\u5f84\u7684\u4e00\u6761\u8fb9\uff0c\u6240\u4ee5\u53ea\u9700\u4ee5\u76f4\u5f84\u4e24\u7aef\u4e3a\u6839\u8fdb\u884c\u6811\u5f62 DP\u3002\u5bf9\u4e8e\u76f4\u5f84\u6700\u5927\u503c\uff0c\u82e5\u65ad\u6389\u975e\u76f4\u5f84\u4e0a\u7684\u8fb9\uff0c\u5219\u4e0d\u5305\u542b\u76f4\u5f84\u7684\u5b50\u6811\u5728\u76f4\u5f84\u4e24\u7aef DP \u65f6\u4e5f\u5df2\u7ecf\u6c42\u51fa\uff0c\u800c\u5305\u542b\u76f4\u5f84\u7684\u5b50\u6811\u7684\u76f4\u5f84\u5373\u539f\u6811\u76f4\u5f84\uff0c\u4ee5\u6b64\u907f\u514d\u8f83\u7e41\u7410\u7684\u6362\u6839 DP\u3002",
        "postTime": 1639124146,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "P3596 [POI2015]MOD"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P3596)\n# \u9898\u76ee\u5927\u610f\n\u7ed9\u51fa\u4e00\u4e2a $n$ \u4e2a\u70b9\u7684\u6811\uff0c\u53ef\u4ee5\u4fee\u6539\u4e00\u6761\u8fb9\uff0c\u95ee\u4fee\u6539\u540e\u7684\u76f4\u5f84\u6700\u5927\u6700\u5c0f\u503c\uff0c\u5e76\u8f93\u51fa\u65b9\u6848\u3002\n# \u601d\u8def\n\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u5bf9\u4e8e\u5220\u6389\u6bcf\u4e00\u6761\u8fb9\uff0c\u4e24\u68f5\u5b50\u6811\u7ef4\u62a4\u4e00\u4e2a\u6700\u5927\u76f4\u5f84\u5373\u53ef\u3002\u5bf9\u4e8e\u6700\u957f\u76f4\u5f84\u5f88\u663e\u7136\u662f\u628a\u76f4\u5f84\u8fde\u8d77\u6765\uff0c\u6700\u77ed\u76f4\u5f84\u5f88\u663e\u7136\u662f\u628a\u76f4\u5f84\u4e2d\u70b9\u8fde\u8d77\u6765\u3002\n\n\u81f3\u4e8e\u7ef4\u62a4\u76f4\u5f84\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u6362\u6839 dp\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6362\u6839\u65f6\u53ea\u9700\u8981\u8bb0\u5f55\u4e00\u4e0b\u4ee5\u8fd9\u70b9\u51fa\u53d1\u7684\u6700\u957f\u3001\u6b21\u957f\u3001\u8f83\u6b21\u957f\u94fe\u5373\u53ef\uff0c\u7136\u540e\u518d\u4e0e\u4e4b\u524d\u7684\u6700\u957f\u76f4\u5f84\u6bd4\u8f83\u5373\u53ef\u3002\n\n\u7ef4\u62a4\u7aef\u70b9\u7684\u8bdd\uff0c\u8fd8\u9700\u8981\u8bb0\u5f55\u6bcf\u4e2a\u6700\u4f18\u89e3\u662f\u5c5e\u4e8e\u54ea\u4e2a\u5b50\u6811\u7684\uff0c\u8fd9\u6837\u624d\u6bd4\u8f83\u597d\u5224\u65ad\u3002\n\n\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u53d1\u8fd9\u4efd\u9898\u89e3\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u8fd9\u4e2a\u9898\u6709\u70b9\u96be\u8c03\uff0c\u800c\u4e14\u81ea\u5df1\u7684\u4ee3\u7801\u4e5f\u6bd4\u8f83\u7b80\u77ed\uff0c\u6240\u4ee5\u6765\u5206\u4eab\u4e00\u4e0b\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u663e\u7136 $\\Theta(n)$\uff0c\u4e0d\u8fc7\u56e0\u4e3a SPJ \u6709\u95ee\u9898\uff0c\u6240\u4ee5\u4f60\u5f97\u6392\u4e2a\u5e8f\u624d\u4e0d\u4f1a\u88ab\u5361\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a\u662f $\\Theta(n\\log n)$ \u5f97\u3002\n# $\\texttt{Code}$\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define Int register int\n#define MAXN 500005\n\ntemplate <typename T> inline void read (T &t){t = 0;char c = getchar();int f = 1;while (c < '0' || c > '9'){if (c == '-') f = -f;c = getchar();}while (c >= '0' && c <= '9'){t = (t << 3) + (t << 1) + c - '0';c = getchar();} t *= f;}\ntemplate <typename T,typename ... Args> inline void read (T &t,Args&... args){read (t);read (args...);}\ntemplate <typename T> inline void write (T x){if (x < 0){x = -x;putchar ('-');}if (x > 9) write (x / 10);putchar (x % 10 + '0');}\ntemplate <typename T> inline void Mx (T &a,T b){a = max (a,b);}\ntemplate <typename T> inline void Mi (T &a,T b){a = min (a,b);}\n\nvector <int> G[MAXN];\nint n,ans1,ans2 = MAXN,par[MAXN][21],dep[MAXN];\n\n#define PII pair<int,int>\n\nint f1[MAXN][2],f2[MAXN],f3[MAXN],f4[MAXN];\nint pf1[MAXN][2],pf2[MAXN];PII pf3[MAXN],pf4[MAXN];\nvoid dfs1 (int u,int fa){\n\tdep[u] = dep[fa] + 1,par[u][0] = fa;\n\tfor (Int i = 1;i <= 20;++ i) par[u][i] = par[par[u][i - 1]][i - 1];\n\tpf1[u][0] = pf1[u][1] = u,pf3[u] = make_pair (u,u);\n\tfor (Int v : G[u]) if (v ^ fa){\n\t\tdfs1 (v,u);if (f3[v] > f3[u]) f3[u] = f3[v],pf3[u] = pf3[v];\n\t\tif (f1[v][0] + 1 > f1[u][0]) pf1[u][1] = pf1[u][0],f1[u][1] = f1[u][0],pf1[u][0] = pf1[v][0],f1[u][0] = f1[v][0] + 1;\n\t\telse if (f1[v][0] + 1 > f1[u][1]) f1[u][1] = f1[v][0] + 1,pf1[u][1] = pf1[v][0];\n\t}\n\tif (f1[u][0] + f1[u][1] > f3[u]) f3[u] = f1[u][0] + f1[u][1],pf3[u] = make_pair (pf1[u][0],pf1[u][1]);\n}\n\nPII pans1,pans1d,pans2[2],pans2d;\n\nvoid dfs2 (int u,int fa){\n\tif (fa){\n\t\tif (f3[u] + f4[u] + 1 > ans1) ans1 = f3[u] + f4[u] + 1,pans1 = make_pair (pf3[u].first,pf4[u].first),pans1d = make_pair (u,fa); \n\t\tif (max ((f3[u] + 1) / 2 + (f4[u] + 1) / 2 + 1,max (f3[u],f4[u])) < ans2){\n\t\t\tpans2d = make_pair (u,fa),pans2[0] = pf3[u],pans2[1] = pf4[u];\n\t\t\tans2 = max ((f3[u] + 1) / 2 + (f4[u] + 1) / 2 + 1,max (f3[u],f4[u]));\n\t\t}\n\t}\n\tint besx = f2[u],lesx = 0,wsex = 0;\n\tint pbesx = pf2[u],plesx = u,pwsex = u;\n\tint ins0[3] = {fa};\n\tfor (Int v : G[u]) if (v ^ fa){\n\t\tif (f1[v][0] + 1 > besx) ins0[2] = ins0[1],pwsex = plesx,wsex = lesx,ins0[1] = ins0[0],plesx = pbesx,lesx = besx,ins0[0] = v,pbesx = pf1[v][0],besx = f1[v][0] + 1;\n\t\telse if (f1[v][0] + 1 > lesx) ins0[2] = ins0[1],pwsex = plesx,wsex = lesx,ins0[1] = v,plesx = pf1[v][0],lesx = f1[v][0] + 1;\n\t\telse if (f1[v][0] + 1 > wsex) ins0[2] = v,pwsex = pf1[v][0],wsex = f1[v][0] + 1;\n\t}\n\tint besl = f4[u],lesl = 0;\n\tPII pbesl = pf4[u],plesl = make_pair (u,u);\n\tint ins1[2] = {fa};\n\tfor (Int v : G[u]) if (v ^ fa){\n\t\tif (f3[v] > besl) ins1[1] = ins1[0],plesl = pbesl,lesl = besl,ins1[0] = v,pbesl = pf3[v],besl = f3[v];\n\t\telse if (f3[v] > lesl) ins1[1] = v,plesl = pf3[v],lesl = f3[v];\n\t}\n\tfor (Int v : G[u]) if (v ^ fa){\n\t\tif (f1[v][0] + 1 == besx && ins0[0] == v) f2[v] = lesx + 1,pf2[v] = plesx;\n\t\telse f2[v] = besx + 1,pf2[v] = pbesx;\n\t\tif (ins0[0] == v) f4[v] = lesx + wsex,pf4[v] = make_pair (plesx,pwsex);\n\t\telse if (ins0[1] == v) f4[v] = besx + wsex,pf4[v] = make_pair (pbesx,pwsex);\n\t\telse f4[v] = besx + lesx,pf4[v] = make_pair (pbesx,plesx);\n\t\tif (ins1[0] == v && lesl > f4[v]) f4[v] = lesl,pf4[v] = plesl;\n\t\tif (ins1[0] != v && besl > f4[v]) f4[v] = besl,pf4[v] = pbesl;\n\t\tdfs2 (v,u);\n\t} \n}\n\nint LCA (int u,int v){\n\tif (dep[u] < dep[v]) swap (u,v);\n\tfor (Int dis = dep[u] - dep[v],i = 20;~i;-- i) if (dis >> i & 1) u = par[u][i];\n\tif (u == v) return u;\n\telse{\n\t\tfor (Int i = 20;~i;-- i) if (par[u][i] ^ par[v][i]) u = par[u][i],v = par[v][i];\n\t\treturn par[u][0];\n\t}\n}\n\nint Jump (int u,int k){\n\tfor (Int i = 20;~i;-- i) if (k >> i & 1) u = par[u][i];\n\treturn u;\n}\n\nint dist (int u,int v){\n\treturn dep[u] + dep[v] - dep[LCA (u,v)] * 2;\n}\n\nint Get (int x,int y){\n\tint lca = LCA (x,y),dis = dist (x,y);\n\tif (dep[x] - dep[lca] >= dis / 2) return Jump (x,dis / 2);\n\telse return Jump (y,dis - (int)dis / 2);\n}\n\nsigned main(){\n\tread (n);\n\tfor (Int i = 2,u,v;i <= n;++ i) read (u,v),G[u].push_back (v),G[v].push_back (u);\n\tfor (Int i = 1;i <= n;++ i) sort (G[i].begin(),G[i].end());\n\tdfs1 (1,0),pf2[1] = 1,dfs2 (1,0);\n\twrite (ans2),putchar (' '),write (pans2d.first),putchar (' '),write (pans2d.second),putchar (' ');\n\twrite (Get (pans2[0].first,pans2[0].second)),putchar (' '),write (Get (pans2[1].first,pans2[1].second)),putchar ('\\n');\n\twrite (ans1),putchar (' '),write (pans1d.first),putchar (' '),write (pans1d.second),putchar (' '),write (pans1.first),putchar (' '),write (pans1.second),putchar ('\\n');\n\treturn 0;\n}\n```",
        "postTime": 1603099318,
        "uid": 124781,
        "name": "Walking_Dead",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3596 \u3010[POI2015]MOD\u3011"
    },
    {
        "content": "\n### \u5b89\u5229\u535a\u5ba2$\\Longrightarrow\\Longrightarrow\\Longrightarrow$[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/y2823774827y/p/10275101.html)\n\n\u7b80\u5316\u9898\u76ee\uff1a\u91cd\u6784\u6811\u4f7f\u5f97\u5176\u76f4\u5f84\u6700\u5927/\u6700\u5c0f\n## \u505a\u6cd5\n\u5df2\u77e5\u4e24\u68f5\u6811\uff0c\u600e\u4e48\u8fde\u8fb9\u624d\u80fd\u4f7f\u76f4\u5f84\u6700\u5927/\u6700\u5c0f\n\n\u76f4\u5f84\u6700\u5927\uff1a\u4e24\u68f5\u6811\u627e\u76f4\u5f84\u7aef\u70b9\u76f8\u8fde\n\u76f4\u5f84\u6700\u5c0f\uff1a\u4e24\u68f5\u6811\u627e\u76f4\u5f84\u4e2d\u70b9\u76f8\u8fde\n\n\u8f6c\u5316\u95ee\u9898\uff0c\u6211\u4eec\u8981\u6c42\u7684\u5176\u5b9e\u662f\uff1a$Down_i$\u4e3a\u5b50\u6811\u76f4\u5f84\uff0c$Up_i$\u4e3a\u9664i\u5b50\u6811\u5916\u76f4\u5f84(\u5220\u6389$i$~$fa$\u540e\u4e0a\u65b9\u7684\u76f4\u5f84)\n\n\u5b50\u6811\u76f4\u5f84\u5f53\u7136\u597d\u6c42\uff0c\u513f\u5b50\u76f4\u5f84,\u6b21\u76f4\u5f84\uff0c$Down_i$\u662f\u9012\u5f52\u540e\u8fd4\u56de\u4ece\u4e0b\u4f20\u5230\u4e0a\u9762\n\n\u90a3$Up_i$\u663e\u7136\u8fd9\u90e8\u5206\u6211\u4eec\u662f\u8981\u5728\u9012\u5f52\u5230$i$\u4e4b\u524d\u5b8c\u6210\u7684\uff0c\u4e5f\u5c31\u662f\u4ece\u4e0a\u5230\u4e0b\u505a\u5b8c$Up_i$\n\n\u8003\u8651\u505a$Up_v$\uff0c$u$\u4e0a\u9762\u7684\u90e8\u5206\u5c31\u4ece$Up_u$\u8f6c\u79fb\u8fc7\u6765\u4e86\uff0c\u5269\u4e0b\u7684\u5c31\u8003\u8651$u$\u7684\u975e$v$\u5b50\u6811\u76f4\u5f84\u4e0e **\u7ed9** $v$\u5b50\u6811\u94fe\u548c$u$\u4e0a\u9762\u7ec4\u6210\u7684\u6700\u957f\u94fe(\u5f00\u4e2a\u6570\u7ec4$line$\u8bb0\u5f55)\n\n[\u5b8c\u6574\u4ee3\u7801\u53ca\u4e24\u7ec4\u826f\u5fc3\u6570\u636e](https://www.cnblogs.com/y2823774827y/p/10275101.html)\n",
        "postTime": 1547605584,
        "uid": 88804,
        "name": "y2823774827y",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3596 \u3010[POI2015]MOD\u3011"
    }
]