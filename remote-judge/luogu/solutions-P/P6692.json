[
    {
        "content": "\u8003\u8651\u5bb9\u65a5\u3002\n\n\u4e8e\u662f\u53ea\u8981\u6c42 $m^2\\sum\\limits_{i=1}^{n-1}\\sum\\limits_{j=i+1}^{n}(j-i)+n^2\\sum\\limits_{i=1}^{m-1}\\sum\\limits_{j=i+1}^{m}(j-i)-\\sum\\limits_{i=1}^k\\sum\\limits_{x=1}^{n}\\sum\\limits_{y=1}^{m}(\\left|x_i-x\\right|+\\left|y_i-y\\right|)+\\sum\\limits_{i=1}^{k-1}\\sum\\limits_{j=i+1}^{k}(\\left|x_i-x_j\\right|+\\left|y_i-y_j\\right|)$ \u5373\u53ef\u3002\n\n~~md\u600e\u4e48\u8fd9\u4e48\u590d\u6742\u3002~~\n\n\u8003\u8651\u5c06\u4e0a\u9762\u5f0f\u5b50\u5206\u6210\u4e09\u90e8\u5206\u3002\n\n+ $m^2\\sum\\limits_{i=1}^{n-1}\\sum\\limits_{j=i+1}^{n}(j-i)+n^2\\sum\\limits_{i=1}^{m-1}\\sum\\limits_{j=i+1}^{m}(j-i)$\n\n\u4e0a\u9762\u5f0f\u5b50\u662f\u5c06\u884c\u4e0e\u5217\u7684\u8d21\u732e\u5206\u5f00\u6765\u5355\u72ec\u8ba1\u7b97\u7684\u3002\n\n\u8003\u8651\u6539\u53d8\u679a\u4e3e\u987a\u5e8f\uff0c\u53d8\u6210\u5148\u679a\u4e3e $j-i$\u3002\n\n$\\begin{aligned}m^2\\sum\\limits_{i=1}^{n-1}\\sum\\limits_{j=i+1}^{n}(j-i)+n^2\\sum\\limits_{i=1}^{m-1}\\sum\\limits_{j=i+1}^{m}(j-i)&=m^2\\sum\\limits_{i=1}^{n-1}i\\times(n-i)+n^2\\sum\\limits_{i=1}^{m-1}i\\times(m-i)\\\\&=m^2n\\sum\\limits_{i=1}^{n-1}i-m^2\\sum\\limits_{i=1}^{n-1}i^2+n^2m\\sum\\limits_{i=1}^{m-1}i-n^2\\sum\\limits_{i=1}^{m-1}i^2\\end{aligned}$\n\n$\\sum i$ \u8ddf $\\sum i^2$ \u53ef\u4ee5\u76f4\u63a5\u4ee3\u516c\u5f0f $O(1)$ \u6c42\u51fa\u3002\n\n\uff08\u5982\u679c\u4f60\u4e0d\u77e5\u9053\u7684\u8bdd\u6211\u53ef\u4ee5\u544a\u8bc9\u4f60 $\\sum\\limits_{i=1}^{n}i=\\dfrac{n(n+1)}{2},\\sum\\limits_{i=1}^{n}i^2=\\dfrac{n(n+1)(2n+1)}{6}$\uff09\n\n~~\u5f53\u7136\u5982\u679c\u4f60\u60f3\u5f0f\u5b50\u597d\u770b\u4e00\u4e9b\u53ef\u4ee5\u5c06\u4e0a\u9762\u7684 $\\sum\\limits_{i=1}^{n-1}$ \u548c $\\sum\\limits_{i=1}^{m-1}$ \u90fd\u6362\u6210$\\sum\\limits_{i=1}^{n}$ \u548c $\\sum\\limits_{i=1}^{m}$\uff0c\u53cd\u6b63\u90fd\u4f1a\u88ab\u6d88\u6389\u5bf9\u7b54\u6848\u65e0\u5f71\u54cd\u3002~~\n\n+ $\\sum\\limits_{i=1}^k\\sum\\limits_{x=1}^{n}\\sum\\limits_{y=1}^{m}(\\left|x_i-x\\right|+\\left|y_i-y\\right|)$\n\n\u540c\u6837\u6211\u4eec\u5c06\u884c\u4e0e\u5217\u7684\u8d21\u732e\u5206\u5f00\u6765\u8ba1\u7b97\u3002\n\n$\\begin{aligned}\\sum\\limits_{i=1}^k\\sum\\limits_{x=1}^{n}\\sum\\limits_{y=1}^{m}(\\left|x_i-x\\right|+\\left|y_i-y\\right|)&=\\sum\\limits_{i=1}^{k}(m\\sum\\limits_{x=1}^{n}\\left|x_i-x\\right|+n\\sum\\limits_{x=1}^{m}\\left|y_i-y\\right|)\\\\&=\\sum\\limits_{i=1}^{k}(m\\sum\\limits_{x=1}^{x_i-1}(x_i-x)+m\\sum\\limits_{x=x_i+1}^{n}(x-x_i)+n\\sum\\limits_{y=1}^{y_i-1}(y_i-y)+n\\sum\\limits_{y=y_i+1}^{m}(y-y_i))\\end{aligned}$\n\n\u540c\u6837\u76f4\u63a5 $\\sum i$ \u516c\u5f0f\u4ee3\u8fdb\u53bb\u5373\u53ef\u3002\n\n+ $\\sum\\limits_{i=1}^{k-1}\\sum\\limits_{j=i+1}^{k}(\\left|x_i-x_j\\right|+\\left|y_i-y_j\\right|)$\n\n\u4f9d\u7136\u5c06\u884c\u4e0e\u5217\u7684\u8d21\u732e\u5206\u5f00\u6765\u8ba1\u7b97\u3002\n\n$\\sum\\limits_{i=1}^{k-1}\\sum\\limits_{j=i+1}^{k}(\\left|x_i-x_j\\right|+\\left|y_i-y_j\\right|)=\\sum\\limits_{i=1}^{k-1}\\sum\\limits_{j=i+1}^{k}\\left|x_i-x_j\\right|+\\sum\\limits_{i=1}^{k-1}\\sum\\limits_{j=i+1}^{k}\\left|y_i-y_j\\right|$\n\n\u8003\u8651\u6c42 $\\sum\\limits_{i=1}^{k-1}\\sum\\limits_{j=i+1}^{k}\\left|x_i-x_j\\right|$\u3002\n\n\u5c06\u6240\u6709\u969c\u788d\u70b9\u6309 $x_i$ \u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u3002\n\n$\\sum\\limits_{i=1}^{k-1}\\sum\\limits_{j=i+1}^{k}\\left|x_i-x_j\\right|=\\sum\\limits_{i=2}^{k}\\sum\\limits_{j=1}^{i-1}(x_i-x_j)$\n\n\uff08\u6ce8\u610f\u4e24\u6761\u5f0f\u5b50\u7684\u679a\u4e3e\u987a\u5e8f\uff09\n\n\u8bbe $f[k]=\\sum\\limits_{i=1}^{k-1}(x_k-x_i),f[1]=0$\u3002\n\n\u5bb9\u6613\u53d1\u73b0 $f[k+1]=f[k]+k\\times(x_{k+1}-x_k)$\u3002\n\n\u800c $\\sum\\limits_{i=1}^{k}f[i]$ \u5c31\u662f\u6211\u4eec\u8981\u6c42\u7684\uff0c\u6309\u987a\u5e8f\u76f4\u63a5\u626b\u4e00\u904d\u5373\u53ef\u3002\n\n$\\sum\\limits_{i=1}^{k-1}\\sum\\limits_{j=i+1}^{k}\\left|y_i-y_j\\right|$ \u7528\u540c\u6837\u7684\u65b9\u5f0f\u89e3\u51b3\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $O(k\\log k)$\u3002\n\n\uff08\u4e0a\u9762\u5f0f\u5b50\u5316\u5230\u4e0d\u540c\u7684\u7a0b\u5ea6\u5c31\u5bf9\u5e94\u76f8\u5e94\u7684\u90e8\u5206\u5206\u4e86\uff09",
        "postTime": 1591513655,
        "uid": 104581,
        "name": "kkk\u7684\u5c0f\u8214\u72d7",
        "ccfLevel": 8,
        "title": "\u51fa\u751f\u70b9 \u9898\u89e3"
    },
    {
        "content": "\u51fa\u9898\u4eba\u7684\u5f0f\u5b50\u5df2\u7ecf\u63a8\u7684\u5f88\u8be6\u7ec6\u4e86\uff0c\u5c31\u662f\u4e00\u4e2a\u5bb9\u65a5\uff0c\u6211\u8fd9\u91cc\u5c31\u4e0d\u8bf4\u4e86\u3002\n\n\u6211\u6765\u63d0\u4f9b\u4e00\u4e2a\u4ee3\u7801\uff0c\u5b8c\u5168\u6309\u7167\u51fa\u9898\u4eba\u7684\u5f0f\u5b50\u5199\u7684\uff0c\u7801\u98ce\u53ef\u8bfb\uff0c\u6709\u6ce8\u91ca\uff0c\u5206\u62103\u90e8\u5206\u5bf9\u5e943\u4e2a\u5f0f\u5b50\u3002\u4f9b\u5927\u5bb6\u5bf9\u7740\u67e5\u9519\u3002\n\n\u6ce8\u610f\u4e00\u4e2a\u70b9\uff0c$n,m\\le 10^9$ \uff0c\u4e5f\u5c31\u662f\u8bf4\u51fa\u9898\u4eba\u5f0f\u5b50\u4e2d\u7684 $n^2m$ \u5c31\u4f1a\u7206`long long`\uff0c\u4e8e\u662f\u6211~~\u5077\u61d2~~\u7528\u4e86`__int128`.\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#define int __int128\nusing namespace std;\nconst int p=1e9+7;\nint inline read()\n{\n\tint ans=0,f=1;\n\tchar ch=getchar();\n\twhile(!isdigit(ch))\n\t{\n\t\tif(ch=='-')\n\t\tf=-1;\n\t\tch=getchar();\n\t}\n\twhile(isdigit(ch))\n\t{\n\t\tans=ans*10+ch-'0';\n\t\tch=getchar();\n\t}\n\treturn ans*f;\n}\nint n,m,k,ans;\nstruct point\n{\n\tint x,y;\n}a[500005];\nint f[500005],g[500005]; \nbool cmpx(point aa,point b)\n{\n\treturn aa.x<b.x;\n}\nbool cmpy(point aa,point b)\n{\n\treturn aa.y<b.y;\n}\nint sum(int n)//\u6c421-n\u7684\u548c \n{\n\tif(n%2==0) return (n/2*(n+1))%p;\n\telse return ((n+1)/2*n)%p;\n}\nint sqr(int n)//\u6c421-n\u7684\u5e73\u65b9\u548c \n{\n\tif(n%2==0) return (n/2*(n+1)*(2*n+1)/3)%p;\n\telse return ((n+1)/2*n*(2*n+1)/3)%p;\n}\nsigned main()\n{\n\tn=read();m=read();k=read();\n\tfor(int i=1;i<=k;i++)\n\ta[i].x=read(),a[i].y=read();\n\t//\u7b2c\u4e00\u4e2a\u5f0f\u5b50 \n\tans=ans+((m*m*n)%p)*sum(n-1);\n\tans%=p;\n\tans=ans-((m*m)%p)*sqr(n-1);\n\tans=((ans%p)+p)%p;\n\tans=ans+((m*n*n)%p)*sum(m-1);\n\tans%=p;\n\tans=ans-((n*n)%p)*sqr(m-1);\n\tans=((ans%p)+p)%p;\n\t//\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\uff0c\u6ce8\u610f\u662f\u51cf\n\tfor(int i=1;i<=k;i++)\n\t{\n\t\tans-=(m*sum(a[i].x-1))%p+(m*sum(n-a[i].x))%p;\n\t\tans=((ans%p)+p)%p;\n\t\tans-=(n*sum(a[i].y-1))%p+(n*sum(m-a[i].y))%p;\n\t\tans=((ans%p)+p)%p;\n\t } \n\t //\u7b2c\u4e09\u4e2a\u5f0f\u5b50\n\tsort(a+1,a+k+1,cmpx);\n\tfor(int i=2;i<=k;i++)\n\t{\n\t\tf[i]=f[i-1]+((i-1)*(a[i].x-a[i-1].x))%p;\n\t\tf[i]%=p;\n\t\tans=ans+f[i];\n\t\tans%=p;\n\t}\n\tsort(a+1,a+k+1,cmpy);\n\tfor(int i=2;i<=k;i++)\n\t{\n\t\tg[i]=g[i-1]+((i-1)*(a[i].y-a[i-1].y))%p;\n\t\tg[i]%=p;\n\t\tans=ans+g[i];\n\t\tans%=p;\t\t\n\t}\n\tlong long an=ans%p;\n\tcout<<an;\n\treturn 0;\n}\n```\n",
        "postTime": 1596019112,
        "uid": 196899,
        "name": "lndjy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6692 \u3010\u51fa\u751f\u70b9\u3011"
    },
    {
        "content": "\u4e3a\u4e86\u5199\u8fd9\u9053\u9898\u6211\u8c03\u4e86\u4e24\u4e2a\u5c0f\u65f6\uff0c\u7ed3\u679c\u53d1\u73b0\u7b49\u5dee\u6570\u5217\u5fd8\u8bb0\u9664\u4ee5\u4e8c\uff0c\u8fd9\u9053\u9898\u7ec6\u8282\u592a\u591a\u4e86\u3002\n\n---\n### \u8fdb\u5165\u6b63\u9898\n\n\u5927\u5bb6\u90fd\u8bf4\u7684\u5f88\u660e\u767d\u4e86\uff0c\u8fd9\u9053\u9898\u7528\u5bb9\u65a5\uff0c\u5206\u4e3a\u4e09\u6b65\u3002\n\n#### \u7b2c\u4e00\u6b65\n\n\u5148\u4e0d\u8003\u8651\u969c\u788d\uff0c\u76f4\u63a5\u7b97\u51fa\u6bcf\u5bf9\u70b9\u7684 **\u66fc\u54c8\u987f\u8ddd\u79bb**\u3002\n\n\u7531\u4e8e $x$ \u5750\u6807\u548c $y$ \u5750\u6807\u662f\u5bf9\u79f0\u7684\uff0c\u6211\u4eec\u53ea\u5206\u6790 $x$ \u5750\u6807\u3002\n\n\u4e00\u5171\u6709 $m$ \u7ec4 $\\lbrace 1,2, \\cdots ,n-1,n\\rbrace$ \uff0c\u5bf9\u4e8e\u6bcf\u4e2a  $|x_i-x_j|$\uff0c\u76f4\u63a5\u5c06\u5b83\u770b\u4f5c\u4e00\u7ec4\uff0c\u6700\u540e\u4e58 $m^2$ \u5c31\u53ef\u4ee5\u4e86\uff0c\u539f\u56e0\u4e00\u697c\u8bf4\u7684\u5f88\u660e\u767d\u4e86\u3002\n\n$ \\quad s_{0x} $ \uff08\u4e00\u90e8\u5206\uff09\n\n\n$=\\frac{1}{2}\\big(|n-1|+|n-2|+\\cdots+|n-n|+|(n-1)-(n-1)|+\\cdots+|1-1|\\big)$ \uff08\u8fd9\u91cc\u8981\u53bb\u91cd\uff0c\u907f\u514d\u9006\u5143\u6d6a\u8d39\u65f6\u95f4\uff09\n\n$=\\frac{1}{2}\\big(n\\times(n-1)+(n-1)\\times(n-2)+\\cdots+2\\times1\\big)$ \n\n\u76f4\u63a5\u7528\u5c0f\u5965\u77e5\u8bc6\u6574\u6570\u88c2\u9879\uff0c\u61c2\u5f97\u8df3\u8fc7\u3002\n\n$\\quad\\frac{1}{2}\\big(n\\times(n-1)+(n-1)\\times(n-2)+\\cdots+2\\times1\\big)$ \n\n$=\\frac{1}{6}\\big((n+1)\\times n\\times (n-1)-(n-2)\\times n\\times (n-1)+\\cdots + 3\\times2\\times1-2\\times1\\times0\\big)$\n\n$=\\frac{1}{6}(n+1)\\times(n-1)\\times n$\n\n\u6240\u4ee5\n\n$s_1=s_x+s_y=\\frac{1}{6}m^2\\times(n+1)\\times(n-1)\\times n+\\frac{1}{6}n^2\\times(m+1)\\times(m-1)\\times m$\n\n#### \u7b2c\u4e8c\u6b65\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u969c\u788d\uff0c\u51cf\u53bb\u5176\u548c\u5176\u4ed6\u8282\u70b9\u7684\u8ddd\u79bb\u548c\u3002\n\u5047\u8bbe\u7b2c $i$ \u4e2a\u969c\u788d\u7684\u8282\u70b9\u4e3a $(x_i,y_i)$\u3002\n\n$\\quad s_2 $\n\n$= \\sum \\bigg(m\\times \\Big(|x_i-1|+\\cdots+|x_i-n|\\Big)+n\\times\\Big( |x_i-1|+\\cdots+|x_i-m|\\Big) \\bigg)$\n\n$=\\sum\\bigg( m\\times\\Big(\\frac{x_i\\times(x_i-1)}{2}+\\frac{(n-x_i+1)\\times(n-x_i)}{2}\\Big)+n\\times\\Big(\\frac{x_i\\times(x_i-1)}{2}+\\frac{(m-x_i+1)\\times(m-x_i)}{2}\\Big) \\bigg)$\n\n#### \u7b2c\u4e09\u6b65\n\n\u52a0\u4e0a\u6bcf\u5bf9\u969c\u788d\u7684\u66fc\u54c8\u987f\u8ddd\u79bb\uff0c\u76f4\u63a5\u6392\u5e8f\u7136\u540e\u624b\u7b97\u3002\n\n\u5047\u8bbe\u6392\u5e8f\u540e $x_1\\leqslant x_2 \\leqslant \\cdots \\leqslant x_k$\u3002\n\n\n\n$s_3=\\sum \\big(\\sum_{1\\leqslant i\\leqslant j\\leqslant k}^{}|x_i-x_j|\\big)=\\sum\\big(\\sum_{i=1}^{k} x_i\\times(i\\times2-k-1\\big)$\n\n\n\u6700\u540e $ans=s1-s2+s3$\uff0c\u505a\u5b8c\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=500005,mod=1e9+7;\nstruct node{\n\tlong long x,y;\n}p[N];\nlong long n,m,k;\nlong long s1,s2,s3,dx[N],dy[N];\nlong long Pow(long long a,int b){//\u5feb\u901f\u5e42 \n\tlong long ans=1;\n\tfor (;b;b>>=1){\n\t\tif (b&1) ans=ans*a%mod;\n\t\ta=a*a%mod;\n\t}\n\treturn ans;\n}\nlong long NY(long long a,long long b){//\u9006\u5143 \n\treturn a*Pow(b,mod-2)%mod;\n} \nsigned main(){\n\tscanf(\"%lld %lld %lld\",&n,&m,&k);\n\tfor (int i=1;i<=k;i++){\n\t\tscanf(\"%lld %lld\",&p[i].x,&p[i].y);\n\t}\n\ts1=NY(n*n%mod*m%mod*(m-1)%mod*(m+1)%mod,6)+NY(m*m%mod*n%mod*(n-1)%mod*(n+1)%mod,6);\n\tfor (int i=1;i<=k;i++) {\n\t\tlong long x=p[i].x,y=p[i].y,w;\n\t\tdx[i]=x,dy[i]=y;\n\t\tw=m*((x*(x-1)/2%mod+(n-x)*(n-x+1)/2%mod)%mod)%mod+n*((y*(y-1)/2%mod+(m-y)*(m-y+1)/2%mod)%mod)%mod;//\u6211\u4e4b\u524d\u5c31\u662f\u5fd8\u8bb0\u9664\u4ee52\u4e86\n\t\ts2+=w;\n\t}\n\tsort(dx+1,dx+k+1);\n\tsort(dy+1,dy+k+1);\n\tfor (int i=k;i;i--){\n\t\ts3=((s3+dx[i]*(2*i-k-1)%mod)%mod+mod)%mod;\n\t\ts3=((s3+dy[i]*(2*i-k-1)%mod)%mod+mod)%mod;\n\t}\n\tlong long h=((s1-s2+s3)%mod+mod)%mod;\n\tprintf(\"%lld\",h);\n\treturn 0;\n}\n```\n\n\u6492\u82b1*\u2605,\u00b0*:.\u2606(\uffe3\u25bd\uffe3)/$:*.\u00b0\u2605* \u3002",
        "postTime": 1656904819,
        "uid": 375242,
        "name": "ynxynx",
        "ccfLevel": 0,
        "title": "P6692\u9898\u89e3"
    }
]