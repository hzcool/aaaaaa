[
    {
        "content": "[\u5728\u535a\u5ba2\u67e5\u770b](https://www.cnblogs.com/chenxiaoran666/p/Luogu5644.html)\n\n**\u5927\u81f4\u9898\u610f\uff1a** \u6709$n$\u4e2a\u4eba\u76f8\u4e92\u5f00\u67aa\uff0c\u6bcf\u4e2a\u4eba\u6709\u4e00\u4e2a\u4ec7\u6068\u5ea6$a_i$\uff0c\u6bcf\u4e2a\u4eba\u6b7b\u540e\u4f1a\u5f00\u67aa\u518d\u6253\u6b7b\u53e6\u4e00\u4e2a\u8fd8\u6d3b\u7740\u7684\u4eba\uff0c\u4e14\u7b2c\u4e00\u67aa\u7531\u4f60\u6253\u54cd\u3002\u8bbe\u5f53\u524d\u5269\u4f59\u4eba\u4ec7\u6068\u5ea6\u603b\u548c\u4e3a$k$\uff0c\u5219\u6bcf\u4e2a\u4eba\u88ab\u6253\u4e2d\u7684\u6982\u7387\u4e3a$\\frac {a_i}k$\u3002\u6c42\u7b2c$1$\u4e2a\u4eba\u6700\u540e\u88ab\u6253\u6b7b\u7684\u6982\u7387\u3002\n\n### \u4e00\u4e2a\u91cd\u8981\u6027\u8d28\n\n\u5bf9\u4e8e\u8fd9\u9898\uff0c\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u7531\u4e8e\u4e00\u4e2a\u4eba\u6b7b\u540e\uff0c\u5176\u4ed6\u4eba\u88ab\u6253\u4e2d\u6982\u7387\u7684\u5206\u6bcd\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u4ea7\u751f\u4e86\u540e\u6548\u6027\uff0c\u4f3c\u4e4e\u5f88\u4e0d\u53ef\u7ef4\u62a4\u3002\n\n\u56e0\u6b64\u6211\u4eec\u9700\u8981\u77e5\u9053\u4e00\u4e2a\u91cd\u8981\u6027\u8d28\uff1a\u8bbe$tot=\\sum_{i=1}^na_i$\uff0c\u5219\u9898\u610f\u53ef\u4ee5\u8f6c\u5316\u4e3a\uff0c**\u6bcf\u4e2a\u4eba\u88ab\u6253\u4e2d\u7684\u6982\u7387\u4e3a$\\frac{a_i}{tot}$\uff0c\u4e0d\u65ad\u5f00\u67aa\u76f4\u81f3\u6253\u4e2d\u4e00\u4e2a\u8fd8\u6d3b\u7740\u7684\u4eba\uff0c\u5219\u8fd9\u4e2a\u4eba\u5c31\u4f1a\u6b7b\u6389**\u3002\n\n\u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u6b63\u786e\u5462\uff1f\u6211\u53e3\u80e1\u4e00\u4e0b\uff0c\u5e94\u8be5\u662f\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0c\u6b64\u65f6\u6d3b\u7740\u7684\u4eba\u88ab\u6253\u4e2d\u7684\u6982\u7387\u6bd4\u90fd\u662f\u4ec7\u6068\u5ea6\u4e4b\u6bd4\uff0c\u662f\u4e00\u6837\u7684\u3002\n\n### \u5bb9\u65a5\n\n\u77e5\u9053\u4e86\u8fd9\u4e2a\u6027\u8d28\uff0c\u8fd9\u9053\u9898\u5c31\u53ef\u505a\u7684\u591a\u4e86\u3002\n\n\u76f4\u63a5\u6c42$1$\u6700\u540e\u88ab\u6253\u6b7b\u7684\u6982\u7387\u4f3c\u4e4e\u4e0d\u592a\u5bb9\u6613\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5**\u5bb9\u65a5**\u4e00\u4e0b\u3002\n\n\u8bbe\u5728$1$\u4e4b\u540e\u6b7b\u6389\u7684\u4eba**\u81f3\u5c11\u5305\u542b\u70b9\u96c6$S$\u5185\u6240\u6709\u4eba**\u7684\u6982\u7387\u4e3a$p(S)$\u3002\n\n\u5219\u7b54\u6848\u5c31\u662f\uff1a\n\n$$ans=\\sum(-1)^{|S|}p(S)$$\n\n\u8fd9\u91cc\u7684\u5bb9\u65a5\u7cfb\u6570\u5e94\u8be5\u597d\u7406\u89e3\u5427\uff0c\u5c31\u662f\u5e38\u89c1\u7684\u5076\u6570\u60c5\u51b5\u65b9\u6848\u51cf\u53bb\u5947\u6570\u60c5\u51b5\u65b9\u6848\u3002\n\n\u8bbe$sum(S)=\\sum_{i\u2208S}a_i$\uff0c\u8003\u8651\u5982\u4f55\u6c42$p(S)$\u3002\n\n\u7531\u4e8e\u81f3\u5c11\u5305\u542b\u70b9\u96c6$S$\u5185\u7684\u6240\u6709\u4eba\uff0c\u90a3\u4e48\u5176\u5b9e\u5c31\u76f8\u5f53\u4e8e\u65e0\u9650\u5f00\u67aa\uff0c\u6bcf\u6b21\u53ef\u4ee5\u6253\u9664\u70b9$1$\u548c\u70b9\u96c6$S$\u5916\u7684\u4efb\u610f\u70b9\uff08\u4ec7\u6068\u5ea6\u603b\u548c\u4e3a$tot-a_1-sum(S)$\uff09\uff0c\u76f4\u81f3\u6253\u4e2d\u70b9$1$\u3002\n\n\u5982\u679c\u7528\u4e00\u4e2a\u5f0f\u5b50\u8868\u793a\uff0c\u4e5f\u5c31\u662f\uff1a\n\n$$p(S)=\\sum_{i=0}^\\infty(\\frac{tot-a_1-sum(S)}{tot})^i\\cdot\\frac{a_1}{tot}$$\n\n\u5355\u72ec\u8003\u8651$\\sum_{i=0}^\\infty(\\frac{tot-a_1-sum(S)}{tot})^i$\u8fd9\u4e00\u5f0f\u5b50\uff0c\u7531\u4e8e$\\frac{tot-a_1-sum(S)}{tot}$\u663e\u7136\u6ee1\u8db3\u5728$[0,1)$\u8303\u56f4\u5185\uff0c\u6240\u4ee5\u5b83\u7684$\\infty$\u6b21\u9879\u662f\u65e0\u9650\u63a5\u8fd1\u4e8e$0$\u7684\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\uff0c\u5f97\u5230\uff1a\n\n$$\\sum_{i=0}^\\infty(\\frac{tot-a_1-sum(S)}{tot})^i=\\frac{(\\frac{tot-a_1-sum(S)}{tot})^\\infty-1}{\\frac{tot-a_1-sum(S)}{tot}-1}=\\frac{0-1}{\\frac{tot-a_1-sum(S)}{tot}-1}=\\frac{1}{1-\\frac{tot-a_1-sum(S)}{tot}}=\\frac{1}{\\frac{a_1+sum(S)}{tot}}=\\frac{tot}{a_1+sum(S)}$$\n\n\u4ee3\u56de\u539f\u5f0f\u5f97\u5230\uff1a\n\n$$p(S)=\\frac{tot}{a_1+sum(S)}\\cdot\\frac{a_1}{tot}=\\frac{a_1}{a_1+sum(S)}$$\n\n\u628a$p(S)$\u4ee3\u5165$ans$\u4fbf\u53ef\u5f97\u5230\uff1a\n\n$$ans=\\sum(-1)^{|S|}\\frac{a_1}{a_1+sum(S)}$$\n\n\u6b64\u65f6\u7684\u5f0f\u5b50\u5df2\u7ecf\u597d\u6c42\u4e86\u8bb8\u591a\uff0c\u4f46\u4f3c\u4e4e\u4f9d\u65e7\u4e0d\u592a\u597d\u641e\u3002\n\n### \u751f\u6210\u51fd\u6570\n\n\u770b\u4e00\u4e0b\u6570\u636e\u8303\u56f4\uff0c\u6211\u4eec\u53d1\u73b0\u9898\u76ee\u4e2d\u4f3c\u4e4e\u7279\u610f\u6307\u51fa\uff0c$\\sum_{i=1}^na_i\\le10^5$\uff0c\u80af\u5b9a\u6709\u732b\u817b\uff01\n\n\u518d\u770b\u4e00\u773c\u4e0a\u9762\u7684\u5f0f\u5b50\uff0c\u7acb\u523b\u5c31\u80fd\u60f3\u5230\u679a\u4e3e$sum(S)$\uff01\n\n\u5982\u679c\u8bbe\uff1a\n\n$$f(i)=\\sum_{sum(S)=i}(-1)^{|S|}$$\n\n\u90a3\u4e48\u663e\u7136\u7b54\u6848\u5c31\u662f\uff1a\n\n$$ans=\\sum_{i=0}^{tot}f(i)\\frac{a_1}{a_1+i}$$\n\n\u4f46$f(i)$\u600e\u4e48\u6c42\u5462\uff1f\u4e0d\u96be\u60f3\u5230\u53ef\u4ee5\u5229\u7528\u751f\u6210\u51fd\u6570\u3002\n\n\u5982\u679c\u6ca1\u6709$(-1)^{|S|}$\u8fd9\u4e2a\u70e6\u4eba\u7684\u5bb6\u4f19\uff0c\u800c\u53ea\u662f\u7b80\u5355\u7684$\\sum_{sum(S)=i}1$\uff0c\u6211\u4eec\u4e0d\u96be\u60f3\u5230\uff0c\u5c31\u662f\u751f\u6210\u51fd\u6570$\\prod_{i=2}^n(1+x^{w_i})$\u7b2c$i$\u6b21\u9879\u7684\u7cfb\u6570\u3002\n\n\u7136\u800c\u51fa\u73b0\u4e86$(-1)^{|S|}$\uff0c\u5176\u5b9e\u4e5f\u5e76\u4e0d\u4f1a\u5f88\u96be\uff0c\u5176\u5b9e\u5c31\u76f8\u5f53\u4e8e\u751f\u6210\u51fd\u6570$\\prod_{i=2}^n(1-x^{w_i})$\u7b2c$i$\u6b21\u9879\u7684\u7cfb\u6570\u3002\n\n\u800c\u8fd9\u4e2a\u751f\u6210\u51fd\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u5206\u6cbb$NTT$\u6765\u6c42\u51fa\u3002\n\n### \u5206\u6cbb$NTT$\n\n\u4ec0\u4e48\u662f\u5206\u6cbb$NTT$\uff1f\n\n\u8bf4\u8d77\u6765\u662f\u4e2a\u5f88\u9ad8\u5927\u4e0a\u7684\u4e1c\u897f\uff0c\u4f46\u81f3\u5c11\u8fd9\u9053\u9898\u7684\u5206\u6cbb$NTT$\uff0c\u662f\u5f88\u7b80\u5355\u7684\u3002\n\n\u8003\u8651\u6211\u4eec\u5f53\u524d\u8981\u628a$[l,r]$\u8303\u56f4\u5185\u7684\u591a\u9879\u5f0f\u5168\u90e8\u4e58\u8d77\u6765\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u9012\u5f52\u6c42\u51fa$[l,mid]$\u548c$[mid+1,r]$\u4e2d\u591a\u9879\u5f0f\u5168\u90e8\u4e58\u8d77\u6765\u7684\u7ed3\u679c\uff0c\u7136\u540e\u4e58\u5728\u4e00\u8d77\uff0c\u5c31\u662f$[l,r]$\u8303\u56f4\u5185\u7684\u591a\u9879\u5f0f\u7684\u4e58\u79ef\u4e86\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define Tp template<typename Ty,typename... Ar>\n#define Reg register\n#define RI Reg int\n#define Con const\n#define CI Con int&\n#define I inline\n#define W while\n#define N 100000\n#define LN 20\n#define X 998244353\n#define Qinv(x) Qpow(x,X-2)\nusing namespace std;\nint n,a[N+5],tot[N+5],f[4*N+5];\nI int Qpow(RI x,RI y) {RI t=1;W(y) y&1&&(t=1LL*t*x%X),x=1LL*x*x%X,y>>=1;return t;}\nclass FastIO\n{\n\tprivate:\n\t\t#define FS 100000\n\t\t#define tc() (A==B&&(B=(A=FI)+fread(FI,1,FS,stdin),A==B)?EOF:*A++)\n\t\t#define tn (x<<3)+(x<<1)\n\t\t#define D isdigit(c=tc())\n\t\tchar c,*A,*B,FI[FS];\n\tpublic:\n\t\tI FastIO() {A=B=FI;}\n\t\tTp I void read(Ty& x) {x=0;W(!D);W(x=tn+(c&15),D);}\n}F;\ntemplate<int SZ,int PR> class Poly//\u591a\u9879\u5f0f\u7b97\u6cd5\uff0c\u6c42\u89e3\u5206\u6cbbNTT\n{\n\tprivate:\n\t\tint IPR,P,L,R[4*N+5],K,S[2*LN+5],g[2*LN+5][4*N+5];\n\t\tTp I void T(Ty *s,CI op)\n\t\t{\n\t\t\tRI i,j,k,U,S,x,y;for(i=0;i^P;++i) i<R[i]&&(x=s[i],s[i]=s[R[i]],s[R[i]]=x);\n\t\t\tfor(i=1;i^P;i<<=1) for(U=Qpow(~op?PR:IPR,(X-1)/(i<<1)),j=0;j^P;j+=i<<1)\n\t\t\t\tfor(S=1,k=0;k^i;++k,S=1LL*S*U%X) s[j+k]=((x=s[j+k])+(y=1LL*S*s[i+j+k]%X))%X,s[i+j+k]=(x-y+X)%X;\n\t\t}\n\tpublic:\n\t\tI Poly() {IPR=Qinv(PR);for(RI i=1;i<=2*LN;++i) S[++K]=i;}//\u521d\u59cb\u5316\u53ef\u7528\u591a\u9879\u5f0f\u7684\u6808\n\t\tTp I void Solve(Ty *a,Ty *f,CI l,CI r)//\u5206\u6cbbNTT\n\t\t{\n\t\t\tif(l==r) return (void)(f[0]=1,f[a[l]]=X-1);RI i,mid=l+r>>1,lc,rc;//\u8fb9\u754c\u76f4\u63a5\u8d4b\u503c\n\t\t\tlc=S[K--],Solve(a,g[lc],l,mid),rc=S[K--],Solve(a,g[rc],mid+1,r);//\u9012\u5f52\u5904\u7406\u5b50\u533a\u95f4\n\t\t\tP=1,L=0;W(P<=tot[r]-tot[l-1]) P<<=1,++L;for(i=0;i^P;++i) R[i]=(R[i>>1]>>1)|((i&1)<<L-1);//\u521d\u59cb\u5316\n\t\t\tfor(T(g[lc],1),T(g[rc],1),i=0;i^P;++i) f[i]=1LL*g[lc][i]*g[rc][i]%X;//NTT\n\t\t\tRI t=Qinv(P);for(T(f,-1),i=0;i<=tot[r]-tot[l-1];++i) f[i]=1LL*f[i]*t%X;//NTT\n\t\t\tfor(i=0;i^P;++i) g[lc][i]=g[rc][i]=0;S[++K]=lc,S[++K]=rc;//\u6e05\u7a7a\u540e\u6254\u56de\u6808\u4e2d\uff0c\u4ee5\u91cd\u590d\u5229\u7528\n\t\t}\n};Poly<N,3> P;\nint main()\n{\n\tRI i,ans=0;for(F.read(n),i=1;i<=n;++i) F.read(a[i]),tot[i]=tot[i-1]+a[i];//\u8bfb\u5165\uff0c\u6c42\u524d\u7f00\u548c\u65b9\u4fbf\u540e\u7eed\u5904\u7406\n\tfor(P.Solve(a,f,2,n),i=0;i<=tot[n]-tot[1];++i) ans=(1LL*f[i]*a[1]%X*Qinv((a[1]+i)%X)+ans)%X;//\u5206\u6cbbNTT\u540e\u7edf\u8ba1\u7b54\u6848\n\treturn printf(\"%d\",ans),0;\n}\n```",
        "postTime": 1576808785,
        "uid": 28382,
        "name": "TheLostWeak",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5644 \u3010[PKUWC2018]\u730e\u4eba\u6740\u3011"
    },
    {
        "content": "\n[\u672c\u849f\u84bb\u7684Blog](https://www.chnxuzhiyuan.cn/2019/12/19/%E3%80%8CPKUWC2018%E3%80%8D%E9%A2%98%E8%A7%A3-Solution/)\n\n### \u9898\u89e3\n\n\u5bf9\u4e8e\u8fd9\u4e00\u9053\u9898\uff0c\u4e00\u4e2a\u6bd4\u8f83\u9ebb\u70e6\u7684\u95ee\u9898\u5c31\u662f\u5f53\u6b7b\u4e86\u730e\u4eba\u4e4b\u540e\uff0c\u6bcf\u4e2a\u730e\u4eba\u7684\u4e2d\u67aa\u6982\u7387\u4f1a\u53d1\u751f\u6539\u53d8\u3002\n\n\u4e0d\u59a8\u5bf9\u95ee\u9898\u8fdb\u884c\u8fd9\u6837\u7684\u8f6c\u5316\uff1a\n\n\u5f53\u730e\u4eba\u4e2d\u67aa\u4e4b\u540e\uff0c\u4ed6\u7684\u5c38\u4f53\u8fd8\u5728\uff0c\u5e76\u4e14\u5728\u4e0b\u4e00\u6b21\u5f00\u67aa\u7684\u65f6\u5019\uff0c\u4ed6\u7684\u5c38\u4f53\u4ecd\u7136\u6709\u673a\u4f1a\u88ab\u6253\u4e2d\uff0c\u6253\u4e2d\u7684\u6982\u7387\u4e0d\u53d8\u3002\u5982\u679c\u4e00\u6b21\u5f00\u67aa\u6253\u4e2d\u4e86\u4e00\u5177\u5c38\u4f53\uff0c\u90a3\u4e48\u5c31\u7ee7\u7eed\u5f00\u67aa\uff0c\u76f4\u5230\u6253\u5230\u6d3b\u4eba\u4e3a\u6b62\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u8fd9\u6837\u8f6c\u5316\u95ee\u9898\u4e4b\u540e\uff0c\u95ee\u9898\u7684\u7b54\u6848\u5e76\u6ca1\u6709\u6539\u53d8\uff0c\u800c\u4e14\u6b64\u65f6\u6bcf\u6b21\u730e\u4eba\u4e2d\u67aa\u7684\u6982\u7387\u6ca1\u53d8\u3002\n\n\u5e76\u4e14\u76f4\u63a5\u8ba1\u7b97$1$\u53f7\u730e\u4eba\u6700\u540e\u6b7b\u4ea1\u7684\u6982\u7387\u5e76\u4e0d\u5bb9\u6613\uff0c\u8003\u8651\u5bb9\u65a5\uff1a\n$$\nans=1+\\sum_{T\\subseteq \\lbrace2,3,\\cdots n\\rbrace}{(-1)^{|T|}P(T)}\n$$\n\u5176\u4e2d$P(T)$\u8868\u793a\u96c6\u5408$T$\u4e2d\u7684\u730e\u4eba\u90fd\u5728$1$\u53f7\u730e\u4eba\u4e4b\u540e\u6b7b\u7684\u6982\u7387\u3002\n\n\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u4e00\u4e2a\u96c6\u5408\u5185\u7684\u6240\u6709\u730e\u4eba\u90fd\u5728$1$\u53f7\u730e\u4eba\u4e4b\u540e\u6b7b\u7684\u6982\u7387\u3002\n\n\u4ee4$S=\\sum_{i=1}^{n}w_i$\uff0c$W_T=\\sum_{i\\in T}W_i$\uff0c\u90a3\u4e48\u5c31\u6709\uff1a\n$$\nP(T)=\\sum_{i=1}^{+\\infty}{\\frac{W_1}{S}\\cdot(1-\\frac{W_T+W_1}{S})^{i-1}}=\\frac{W_1}{S}\\sum_{i=0}^{+\\infty}{(1-\\frac{W_T+W_1}{S})^i}=\\frac{W_1}{S}\\cdot\\frac{1}{1-(1-\\frac{W_T+W_1}{S})}=\\frac{W_1}{W_1+W_T}\n$$\n\u6240\u4ee5\uff0c\u96c6\u5408$T$\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u53ea\u4e0e$W_T$\u548c$|T|$\u6709\u5173\u3002\n\n\u4f46\u662f\u6570\u636e\u8303\u56f4\u975e\u5e38\u5927\uff0c\u76f4\u63a5\u80cc\u5305\u80af\u5b9a\u662f\u4e0d\u884c\u7684\uff0c\u8003\u8651\u751f\u6210\u51fd\u6570\uff1a\n$$\nF(x)=\\prod_{i=2}^{n}{(1-x^{W_i})}\n$$\n\u90a3\u4e48\u5c31\u6709\n$$\nans=1+\\sum_{i=1}^{S-W1}{[x^i]F(x)\\cdot\\frac{W_1}{W_1+i}}\n$$\n\u90a3\u4e2a\u751f\u6210\u51fd\u6570\u76f4\u63a5\u7528NTT\u6216\u8005FFT\u7136\u540e\u5206\u6cbb\u8ba1\u7b97\u4e00\u4e0b\u5c31\u597d\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(n\\log^2n)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\ntypedef long long LL;\nconst int maxn=100005,TT=998244353;\nint n,w[maxn],r[262160],ans,S;\ninline int read()\n{\n\tint ret=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-f;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){ret=ret*10+ch-'0';ch=getchar();}\n\treturn ret*f;\n}\ninline int QP(int a,int b)\n{\n\tint ret=1,w=a;\n\twhile(b)\n\t{\n\t\tif(b&1) ret=(LL)ret*w%TT;\n\t\tw=(LL)w*w%TT;b>>=1;\n\t}\n\treturn ret;\n}\nstruct Polynomial\n{\n\tint n;int* A;\n\tPolynomial(const Polynomial& b){n=b.n;A=new int[n+5];memcpy(A,b.A,4*(n+5));}\n\tPolynomial(int l=262160){n=l;A=new int[l+5];memset(A,0,(l+5)*sizeof(int));}\n\t~Polynomial(){delete A;}\n}TA,TB;\ninline void NTT(Polynomial& F,int limit,int typ)\n{\n\tfor(int i=0;i<limit;i++)\n\t\tif(i<r[i])\n\t\t\tswap(F.A[i],F.A[r[i]]);\n\tfor(int mid=1;mid<limit;mid<<=1)\n\t{\n\t\tint gn=QP(3,(TT-1)/(mid<<1));\n\t\tif(typ<0) gn=QP(gn,TT-2);\n\t\tfor(int j=0;j<limit;j+=(mid<<1))\n\t\t{\n\t\t\tint g=1;\n\t\t\tfor(int k=0;k<mid;k++,g=(LL)g*gn%TT)\n\t\t\t{\n\t\t\t\tint x=F.A[j+k],y=(LL)g*F.A[j+k+mid]%TT;\n\t\t\t\tF.A[j+k]=(x+y)%TT;\n\t\t\t\tF.A[j+k+mid]=(x-y+TT)%TT;\n\t\t\t}\n\t\t}\n\t}\n\tif(typ<0)\n\t{\n\t\tint inv=QP(limit,TT-2);\n\t\tfor(int i=0;i<limit;i++) F.A[i]=(LL)F.A[i]*inv%TT;\n\t}\n}\ninline Polynomial Calc(int L,int R)\n{\n\tif(L==R)\n\t{\n\t\tPolynomial C(w[L]);\n\t\tC.A[0]=1;C.A[w[L]]=TT-1;\n\t\treturn C;\n\t}\n\tint M=(L+R)>>1;\n\tPolynomial A=Calc(L,M),B=Calc(M+1,R);\n\tint limit=1,l=0;\n\twhile(limit<=A.n+B.n){limit<<=1;l++;}\n\tfor(int i=0;i<limit;i++)\n\t\tr[i]=(r[i>>1]>>1)|((i&1)<<(l-1));\n\tTA.n=A.n;TB.n=B.n;Polynomial C(limit);\n\tfor(int i=0;i<limit;i++) TA.A[i]=TB.A[i]=0;\n\tfor(int i=0;i<=A.n;i++) TA.A[i]=A.A[i];\n\tfor(int i=0;i<=B.n;i++) TB.A[i]=B.A[i];\n\tNTT(TA,limit,1);NTT(TB,limit,1);\n\tfor(int i=0;i<limit;i++) C.A[i]=(LL)TA.A[i]*TB.A[i]%TT;\n\tNTT(C,limit,-1);\n\tC.n=A.n+B.n;\n\treturn C;\n}\nint main()\n{\n\tn=read();\n\tfor(int i=1;i<=n;i++){w[i]=read();if(i>1) S+=w[i];}\n\tPolynomial res=Calc(2,n);ans=1;\n\tfor(int i=1;i<=S;i++)\n\t\tans=(ans+TT+(LL)res.A[i]*w[1]%TT*QP(i+w[1],TT-2)%TT)%TT;\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1576805613,
        "uid": 42392,
        "name": "\u5f90\u81f4\u8fdc",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5644 \u3010[PKUWC2018]\u730e\u4eba\u6740\u3011"
    },
    {
        "content": "## \u89e3\u9898\u601d\u8def\n\n\n\u8fd9\u9053\u9898\u7684\u96be\u70b9\u4e3b\u8981\u5728\u4e8e\u730e\u4eba\u6b7b\u4ea1\u540e\uff0c\u4f1a\u6539\u53d8\u5176\u5b83\u6240\u6709\u730e\u4eba\u88ab\u5c04\u4e2d\u7684\u6982\u7387\u3002\n\n#### \u7ed3\u8bba\uff1a\n\n\u539f\u95ee\u9898\u7b49\u4ef7\u4e8e\uff0c\u6bcf\u8f6e\u91cd\u590d\u5f00\u67aa\u76f4\u5230\u5c04\u4e2d\u4e00\u4e2a\u6ca1\u6709\u6b7b\u4ea1\u7684\u730e\u4eba\uff0c\u7b2c $i$ \u4e2a\u730e\u4eba\u88ab\u5c04\u4e2d\u7684\u6982\u7387\u4e3a $\\frac{w_i}{\\sum_{j=1}^nw_j}$\u3002\n\n#### \u8bc1\u660e\uff1a\n\n\u8bbe\u5f53\u524d\u6240\u6709\u730e\u4eba\u7684 $w_i$ \u4e4b\u548c\u4e3a $S$ \uff0c\u4f9d\u7136\u5b58\u6d3b\u7684\u730e\u4eba $w_i$ \u4e4b\u548c\u4e3a $P$\uff0c\u4e0b\u4e00\u6b21\u5c04\u6b7b\u730e\u4eba $i$ \u7684\u6982\u7387 $p$\u3002\n\n\u539f\u95ee\u9898 \n$$\np=\\frac{w_i}{P}\n$$\n\n\u73b0\u95ee\u9898\n\n$$\np=\\frac{w_i+(S-P)p}{S}=\\frac{w_i}{P}\n$$\n\n\u76f4\u63a5\u6c42 $1$ \u53f7\u730e\u4eba\u88ab\u6700\u540e\u5c04\u6b7b\u7684\u6982\u7387\u663e\u7136\u4e0d\u597d\u6c42\u3002\n\n\u8003\u8651\u5bb9\u65a5\uff0c\u679a\u4e3e\u5728 $1$ \u53f7\u730e\u4eba\u540e\u6b7b\u7684\u730e\u4eba\u3002\n\n\u6240\u6709\u730e\u4eba\u7684 $w_i$ \u4e4b\u548c\u4e3a $S$\uff0c\u679a\u4e3e\u7684\u730e\u4eba\u7684 $w_i$ \u548c\u4e3a $T$\u3002\n\n\u679a\u4e3e\u7684\u730e\u4eba\u96c6\u5408\u4e3a $A$\n$$\nans=\\sum_A(-1)^{|A|}\\frac{w_1}{S}\\sum_{i=0}^{\\infty}(1-\\frac{T+w_1}{S})^i\n$$\n\n\u53ef\u4ee5\u53d1\u73b0 $1-\\frac{T+w_1}{S}<1$ \n\n\u5373 $\\sum_{i=0}^{\\infty}(1-\\frac{T+w_1}{S})^i$ \u662f\u6536\u655b\u7684\n\n\u6240\u4ee5\n$$\nans=\\sum_{A}(-1)^{|A|}\\frac{w_i}{T+w_1}\n$$\n\n\u7b54\u6848\u53ea\u4e0e $T$ \u548c $|A|$ \u6709\u5173\u3002\n\n\u9898\u76ee\u4e2d $\\sum_{i=1}^nw_i\\leq 10^5$\uff0c\u663e\u7136\u4e0d\u80fd\u76f4\u63a5\u80cc\u5305\n\n\n\u6784\u9020\u751f\u6210\u51fd\u6570\n$$\nF(x)=\\prod_{i=2}^n(1-x^{w_i})\n$$\n\n\u90a3\u4e48\u6700\u540e\u7b54\u6848\u4e3a\n$$\nans=\\sum_{i=0}^{S-w_1}\\frac{w_1[x^i]F(x)}{T+w_1}\n$$\n\n\u6c42 $F(x)$ \u76f4\u63a5\u5206\u6cbb + NTT \u5373\u53ef\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int mod=998244353,g=3;\nconst int maxn=2e5+10;\nint lim,bit,rev[maxn<<2];\nint val[maxn];\nint Pow(int a,long long k)\n{\n\tint ret=1;\n\twhile(k)\n\t{\n\t\tif(k&1)ret=ret*1LL*a%mod;\n\t\tk>>=1,a=a*1LL*a%mod;\n\t}\n\treturn ret;\n } \nvoid init(int len)\n{\n\tlim=1,bit=0;\n\twhile(lim<=len)lim<<=1,bit++;\n\tfor(int i=0;i<lim;i++)rev[i]=(rev[i>>1]>>1)|((i&1)<<bit-1);\n}\nvoid NTT(int *A,int type)\n{\n\tfor(int i=0;i<lim;i++)if(rev[i]>i)swap(A[rev[i]],A[i]);\n\tfor(int mid=1;mid<lim;mid<<=1)\n\t{\n\t\tint w=Pow(g,(mod-1)/(mid<<1));\n\t\tif(type==-1)w=Pow(w,mod-2);\n\t\tfor(int j=0;j<lim;j+=mid<<1)\n\t\tfor(int k=0,wn=1;k<mid;k++,wn=wn*1LL*w%mod)\n\t\t{\n\t\t\tint x=A[j+k],y=wn*1LL*A[j+k+mid]%mod;\n\t\t\tA[j+k]=(x+y)%mod;\n\t\t\tA[j+k+mid]=(x+mod-y)%mod;\n\t\t}\n\t}\n\tif(type==-1)\n\t{\n\t\tint inv=Pow(lim,mod-2);\n\t\tfor(int i=0;i<lim;i++)A[i]=A[i]*1LL*inv%mod;\n\t}\n}\nint a[maxn<<2],b[maxn<<2];\nvector<int>Div(int l,int r)\n{\n\tvector<int>now,L,R;\n\tif(l==r){now.resize(val[l]+1),now[val[l]]=-1,now[0]=1;return now;}\n\tint mid=l+r>>1;\n\tL=Div(l,mid),R=Div(mid+1,r);\n\tinit(L.size()+R.size()-1);\n\tfor(int i=0;i<lim;i++)a[i]=b[i]=0;\n\tfor(int i=0;i<L.size();i++)a[i]=L[i];\n\tfor(int i=0;i<R.size();i++)b[i]=R[i];\n\tNTT(a,1),NTT(b,1);\n\tfor(int i=0;i<lim;i++)a[i]=a[i]*1LL*b[i]%mod;\n\tNTT(a,-1);\n\tfor(int i=0;i<L.size()+R.size()-1;i++)now.push_back(a[i]);\n\treturn now;\n}\nint n,tot=0;\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&val[i]),tot+=i>1?val[i]:0;\n\tvector<int>ans=Div(2,n);\n\tint ret=0;\n\tfor(int s=0;s<=tot;s++)ret=(ret+ans[s]*1LL*val[1]%mod*Pow(val[1]+s,mod-2)%mod)%mod;\n\tprintf(\"%d\\n\",ret);\n}\n```",
        "postTime": 1575775324,
        "uid": 19951,
        "name": "Reaepita",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5644 \u3010[PKUWC2018]\u730e\u4eba\u6740\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u521d\u59cb\u6709 $n$ \u4e2a\u4eba\uff0c\u6bcf\u4e2a\u4eba\u7684\u6743\u503c\u662f $w_i$\uff0c\u5047\u8bbe\u8fd9\u4e00\u8f6e\u5269\u4f59\u8fd8\u6ca1\u560e\u6389\u7684\u4eba\u603b\u6743\u503c\u662f $s$\uff0c\u90a3\u4e48\u8fd9\u4e00\u8f6e\u5b83\u6709 $\\frac{w_i}{s}$ \u7684\u6982\u7387\u560e\u6389\u3002\u6c42 $1$ \u6d3b\u5230\u6700\u540e\u7684\u6982\u7387\u662f\u591a\u5c11\u3002\n\n\u8003\u8651\u7b97\u6700\u540e\u4e00\u6b21\u560e\u7684\u6982\u7387\u5f88\u96be\u7b97\uff0c\u4f46\u662f\u5f88\u5bb9\u6613\u7b97\u7b2c\u4e00\u6b21\u560e\u7684\u6982\u7387\u3002\u6240\u4ee5\u5c31\u5bb9\u65a5\uff0c\u679a\u4e3e\u4e00\u4e2a\u96c6\u5408 $S$\uff0c\u94a6\u5b9a\u8fd9\u4e2a\u96c6\u5408 $S$ \u7684\u4eba\u4e0d\u6ee1\u8db3\u5728 $1$ \u540e\u9762\u560e\uff0c\u5176\u4f59\u4eba\u65e0\u6240\u8c13\u6ca1\u6709\u9650\u5236\uff0c\u90a3\u4e48\u5c31\u53ea\u770b $S$ \u8fd9\u4e2a\u96c6\u5408\u91cc\u9762 $1$ \u7b2c\u4e00\u6b21\u560e\u6389\u7684\u6982\u7387\uff0c\u6b64\u65f6\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f\uff1a\n\n$$\n(-1)^{|S|}\\frac{w_1}{\\left(\\sum_{i\\in S}w_i\\right)+w_1}\n$$\n\n\u73b0\u5728\u662f\u56fa\u5b9a $S$\uff08\u6216\u8005\u8bf4\uff0c\u679a\u4e3e $S$\uff09\uff0c\u7136\u540e\u8003\u8651\u8f6c\u4e3a\u56fa\u5b9a\u5176\u5b83\u4e1c\u897f\uff0c\u90a3\u5c31\u56fa\u5b9a $\\sum_{i\\in S}w_i$\uff0c\u90a3\u4e48\u8981\u8ba1\u7b97\u7684\u5c31\u662f $(-1)^{|S|}$ \u7684\u603b\u548c\u3002\n\n\u6bcf\u4e2a\u4eba\u7684 OGF \u662f $(1-z^{w_i})$\uff0c\u5206\u6cbb + NTT \u4e58\u8d77\u6765\u5c31\u884c\u4e86\u3002\n\n```cpp\n#include<cstdio>\n#include<vector>\n#include<queue>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#include<ctime>\n#include<random>\n#include<assert.h>\n#define pb emplace_back\n#define mp make_pair\n#define fi first\n#define se second\n#define dbg(x) cerr<<\"In Line \"<< __LINE__<<\" the \"<<#x<<\" = \"<<x<<'\\n';\n#define dpi(x,y) cerr<<\"In Line \"<<__LINE__<<\" the \"<<#x<<\" = \"<<x<<\" ; \"<<\"the \"<<#y<<\" = \"<<y<<'\\n';\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int>pii;\ntypedef pair<ll,int>pli;\ntypedef pair<ll,ll>pll;\ntypedef pair<int,ll>pil;\ntypedef vector<int>vi;\ntypedef vector<ll>vll;\ntypedef vector<pii>vpii;\ntypedef vector<pil>vpil;\ntemplate<typename T>T cmax(T &x, T y){return x=x>y?x:y;}\ntemplate<typename T>T cmin(T &x, T y){return x=x<y?x:y;}\ntemplate<typename T>\nT &read(T &r){\n\tr=0;bool w=0;char ch=getchar();\n\twhile(ch<'0'||ch>'9')w=ch=='-'?1:0,ch=getchar();\n\twhile(ch>='0'&&ch<='9')r=r*10+(ch^48),ch=getchar();\n\treturn r=w?-r:r;\n}\ntemplate<typename T1,typename... T2>\nvoid read(T1 &x,T2& ...y){read(x);read(y...);}\nconst int mod=998244353;\ninline void cadd(int &x,int y){x=(x+y>=mod)?(x+y-mod):(x+y);}\ninline void cdel(int &x,int y){x=(x-y<0)?(x-y+mod):(x-y);}\ninline int add(int x,int y){return (x+y>=mod)?(x+y-mod):(x+y);}\ninline int del(int x,int y){return (x-y<0)?(x-y+mod):(x-y);}\nint qpow(int x,int y){\n\tint s=1;\n\twhile(y){\n\t\tif(y&1)s=1ll*s*x%mod;\n\t\tx=1ll*x*x%mod;\n\t\ty>>=1;\n\t}\n\treturn s;\n}\nnamespace MyPoly\n{\n\tconst int T=17;//2^T>n+m\n\tint inv[(1<<T)+10],fac[(1<<T)+10];\n\tint w[T][(1<<(T-1))+10],iw[T][(1<<(T-1))+10];\n\tvoid prework(){\n\t\tfac[0]=1;\n\t\tfor(int i=1;i<=(1<<T);i++)fac[i]=1ll*fac[i-1]*i%mod;\n\t\tinv[1<<T]=qpow(fac[1<<T],mod-2);\n\t\tfor(int i=(1<<T)-1;~i;--i)inv[i]=1ll*inv[i+1]*(i+1)%mod;\n\t\tfor(int i=0;i<T;i++){\n\t\t\tint n=1<<(i+1);\n\t\t\tint W=qpow(3,(mod-1)/n);\n\t\t\tint IW=qpow(332748118,(mod-1)/n);\n\t\t\tw[i][0]=1;\n\t\t\tiw[i][0]=1;\n\t\t\tfor(int j=1;j<n/2;j++)w[i][j]=1ll*w[i][j-1]*W%mod,iw[i][j]=1ll*iw[i][j-1]*IW%mod;\n\t\t}\n\t}\n\tstruct Poly{\n\t\tvi a;\n\t\tPoly(){vi().swap(a);}\n\t\tint size(){return a.size();}\n\t\tvoid resize(int x){a.resize(x);}\n\t\tint &operator[](int i){return a[i];}\n\t};\n\tvoid DFT(Poly &a){ //\u8f6c\u7f6e\n\t\tint n=a.size();\n\t\tint p=__builtin_ctz(n);\n\t\tfor(int i=n/2;i;i>>=1){\n\t\t\t--p;\n\t\t\tfor(int j=0;j<n;j+=i<<1){\n\t\t\t\tfor(int k=0;k<i;++k){\n\t\t\t\t\tint u=a[j+k],v=a[j+i+k];\n\t\t\t\t\ta[j+k]=add(u,v);\n\t\t\t\t\ta[j+i+k]=del(1ll*u*w[p][k]%mod,1ll*v*w[p][k]%mod);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tvoid IDFT(Poly &a){\n\t\tint n=a.size();\n\t\tint p=-1;\n\t\tfor(int i=1;i<n;i<<=1){\n\t\t\t++p;\n\t\t\tfor(int j=0;j<n;j+=i<<1){\n\t\t\t\tfor(int k=0;k<i;++k){\n\t\t\t\t\tint v=1ll*a[j+i+k]*iw[p][k]%mod;\n\t\t\t\t\ta[j+i+k]=del(a[j+k],v);\n\t\t\t\t\tcadd(a[j+k],v);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tint iv=qpow(n,mod-2);\n\t\tfor(int i=0;i<n;i++)\n\t\t\ta[i]=1ll*a[i]*iv%mod;\n\t}\n\tPoly operator*(Poly &f,Poly &g){\n\t\tint n=f.size(),m=g.size();\n\t\tif (1ll*n*m<=1000){\n\t\t\tPoly h;\n\t\t\th.resize(n+m-1);\n\t\t\tfor(int i=0;i<n;i++)\n\t\t\t\tif(f[i])\n\t\t\t\t\tfor(int j=0;j<m;j++)\n\t\t\t\t\t\tif(g[j])\n\t\t\t\t\t\t\tcadd(h[i+j],1ll*f[i]*g[j]%mod);\n\t\t\treturn h;\n\t\t}\n\t\tint len=1,ct=0;\n\t\twhile(len<=n+m)len<<=1,++ct;\n\t\tf.resize(len);\n\t\tg.resize(len);\n\t\tDFT(f);\n\t\tDFT(g);\n\t\tfor(int i=0;i<len;i++)\n\t\t\tf[i]=1ll*f[i]*g[i]%mod;\n\t\tIDFT(f);\n\t\tf.resize(n+m-1);\n\t\treturn f;\n\t}\n}\nusing namespace MyPoly;\nconst int N=100010;\nint n,a[N];\nPoly solve(int l,int r){\n\tif(l==r){\n\t\tPoly f;f.resize(a[l]+1);\n\t\tf[0]=1;f[a[l]]=mod-1;\n\t\treturn f;\n\t}\n\tint mid=(l+r)>>1;\n\tPoly f=solve(l,mid),g=solve(mid+1,r);\n\treturn f*g;\n}\nsigned main(){\n\tprework();\n\tread(n);\n\tint s=0;\n\tfor(int i=1;i<=n;i++)s+=read(a[i]);\n\tPoly f=solve(2,n);\n\tint ans=0,len=f.a.size();\n\tfor(int i=0;i<len;i++)\n\t\tcadd(ans,1ll*f[i]*a[1]%mod*inv[i+a[1]]%mod*fac[i+a[1]-1]%mod);\n\tcout << ans << '\\n';\n\treturn 0;\n}\n```",
        "postTime": 1678958257,
        "uid": 223298,
        "name": "do_while_true",
        "ccfLevel": 8,
        "title": "\u300c\u9898\u89e3\u300d\u6d1b\u8c37 P5644 [PKUWC2018]\u730e\u4eba\u6740"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/yllcm/p/16467814.html)\n\n\u770b\u4e0d\u61c2\u5176\u5b83\u9898\u89e3\u7684\u667a\u6167\u8bc1\u660e/kk\uff0c\u4e8e\u662f\u81ea\u5df1\u53e3\u80e1\u4e86\u4e00\u4e2a\u3002\n\n\u8003\u8651\u94a6\u5b9a\u4e00\u4e9b\u4eba\u5728 $i$ \u540e\u9762\uff0c\u7136\u540e\u5bb9\u65a5\u3002\u73b0\u5728\u95ee\u9898\u8f6c\u53d8\u6210\u4e86\u6c42\u5bf9\u4e8e $S$\uff0c$\\{1\\}\\cup S$ \u4e2d $1$ \u662f\u7b2c\u4e00\u4e2a\u7684\u65b9\u6848\u6570\u3002\n\n\u8003\u8651 $S=\\{2,3,\\cdots,n\\}$\uff0c\u53d1\u73b0\u6982\u7387\u662f $w_1/\\sum_{i=1}^n w_i$\uff0c\u5f88\u81ea\u7136\u5730\u731c\u60f3\u5bf9\u4e8e\u96c6\u5408 $S$\uff0c\u6982\u7387\u662f\uff1a\n$$\n\\frac{w_1}{w_1+\\sum_{x\\in S}w_x}\n$$\n\u8fd9\u5f88\u7b26\u5408\u6211\u4eec\u7684\u76f4\u89c9\u3002\n\n\u5047\u8bbe $P(i,S)$ \u8868\u793a $i$ \u5728\u96c6\u5408 $S$ \u4e2d\u7b2c\u4e00\u4e2a\u51fa\u73b0\u7684\u6982\u7387\uff0c\u90a3\u4e48\u8bc1\u660e\u8fd9\u4e2a\u5f0f\u5b50\u51e0\u4e4e\u7b49\u4ef7\u4e8e\u8bc1\u660e\uff1a\n$$\n\\forall i,j,\\frac{P(i,S)}{P(j,S)}=\\frac{w_i}{w_j}\n$$\n\u8003\u8651 $P(i,S)$ \u7684\u5f0f\u5b50\u957f\u4ec0\u4e48\u6837\u3002\u679a\u4e3e $i$ \u524d\u9762\u7684\u6392\u5217 $T$\uff0c\u7136\u540e\u94a6\u5b9a $i$ \u5728 $T$ \u540e\u9762\u6070\u597d\u4e00\u4e2a\u5bc4\u6389\uff0c\u5f97\u5230\uff1a\n$$\n\\sum_{T\\cap S=\\varnothing}f(T)\\frac{w_i}{\\sum_{j=1}^n w_j-\\sum_{x\\in T}w_x-w_i}\n$$\n$f(T)$ \u662f\u524d\u9762\u7684\u8d21\u732e\uff0c\u6b64\u5904\u7701\u53bb\u3002\u5bf9\u6bd4 $P(i,S)$ \u548c $P(j,S)$ \u7684\u5f0f\u5b50\u4e0d\u96be\u8bc1\u660e\u3002\n\n\u7136\u540e\u5b9e\u9645\u4e0a\u53ea\u9700\u8981\u6c42\uff1a\n$$\n1+\\sum_S (-1)^{|S|}\\frac{w_1}{w_1+\\sum_{x\\in S}w_x}\n$$\n\u8003\u8651\u5230\u5f0f\u5b50\u53ea\u548c $\\sum_{x\\in S}w_x$ \u548c $|S|$ \u6709\u5173\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u505a\u4e2a\u80cc\u5305\u5c31\u597d\u4e86\uff0c\u5206\u6cbb+NTT \u53ef\u4ee5 $O(n\\log^2 n)$\u3002\n\n\u4e24\u8fb9\u5206\u6cbb\u7684\u65f6\u5019\u53ef\u4ee5\u5f00 $32$ \u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u91cc\u9762\u5b58\u591a\u9879\u5f0f\u3002\u6709\u70b9\u50cf\u6eda\u52a8\u6570\u7ec4\u7684\u64cd\u4f5c\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define ull unsigned long long\n#define db double\n#define ldb long double\n#define pb push_back\n#define mp make_pair\n#define pii pair<int, int>\nusing namespace std;\ninline int read() {\n    int x = 0; bool op = 0;\n    char c = getchar();\n    while(!isdigit(c))op |= (c == '-'), c = getchar();\n    while(isdigit(c))x = (x << 1) + (x << 3) + (c ^ 48), c = getchar();\n    return op ? -x : x;\n}\npii aprx(int p, int q, int A) {\n    int x = q, y = p, a = 1, b = 0;\n    while(x > A) {\n        swap(x, y); swap(a, b);\n        a -= (x / y) * b; x %= y;\n    }\n    return mp(x, a);\n}\nconst int N = (1 << 20) + 10;\nconst int P = 998244353;\nvoid add(int &a, int b) {a = (a + b) % P;}\nvoid sub(int &a, int b) {a = (a - b + P) % P;}\nint ksm(int x, int k) {\n    int res = 1;\n    for(int pw = x; k; (k & 1) ? res = 1ll * res * pw % P : 0, pw = 1ll * pw * pw % P, k >>= 1);\n    return res;\n}\nint n;\nint w[N];\nint fac[N], ifac[N], pw[N], ipw[N];\nvoid init() {\n    fac[0] = ifac[0] = 1;\n    for(int i = 1; i < N; i++)fac[i] = 1ll * fac[i - 1] * i % P;\n    ifac[N - 1] = ksm(fac[N - 1], P - 2);\n    for(int i = N - 2; i; i--)ifac[i] = 1ll * ifac[i + 1] * (i + 1) % P;\n    for(int i = 1; i <= 20; i++)pw[1 << i] = ksm(3, (P - 1) / (1 << i));\n    for(int i = 1; i <= 20; i++)ipw[1 << i] = ksm(pw[1 << i], P - 2);\n    return ;\n}\nint rev[N];\nint inv(int x) {return 1ll * ifac[x] * fac[x - 1] % P;}\nvoid NTT(int *f, int len, int op) {\n    for(int i = 0; i < len; i++)rev[i] = (rev[i >> 1] >> 1) | ((i & 1) * (len >> 1));\n    for(int i = 0; i < len; i++)if(i < rev[i])swap(f[i], f[rev[i]]);\n    for(int k = 2; k <= len; k <<= 1) {\n        for(int i = 0; i < len; i += k) {\n            int gn = (op == -1) ? ipw[k] : pw[k];\n            // printf(\"gn:%d %d\\n\", k, gn);\n            for(int j = i, g = 1; j < i + k / 2; j++, g = 1ll * g * gn % P) {\n                int x = f[j], y = 1ll * g * f[j + k / 2] % P;\n                f[j] = (x + y) % P; f[j + k / 2] = (x - y + P) % P;\n            }\n        }\n    }\n    if(op == -1) {\n        for(int i = 0; i < len; i++)f[i] = 1ll * f[i] * inv(len) % P;\n    }\n    return ;\n}\nint f[N], g[35][N], stk[N], top = 33;\nint solve(int cur, int l, int r) {\n    if(l == r)return g[cur][w[l]] = P - 1, g[cur][0] = 1, w[l];\n    int mid = l + r >> 1, len = 0, ls = stk[top--], rs = stk[top--];\n    len += solve(ls, l, mid); len += solve(rs, mid + 1, r);\n    int ln = 1; while(ln < len + 5)ln <<= 1;\n    NTT(g[ls], ln, 1); NTT(g[rs], ln, 1);\n    for(int i = 0; i < ln; i++)g[cur][i] = 1ll * g[ls][i] * g[rs][i] % P;\n    NTT(g[cur], ln, -1);\n    for(int i = 0; i < ln; i++)g[ls][i] = g[rs][i] = 0;\n    stk[++top] = ls; stk[++top] = rs;\n    return len;\n}\nint ans[N];\nint main() {\n    init();\n    n = read();\n    for(int i = 1; i <= n; i++)w[i] = read();\n    for(int i = 1; i <= 33; i++)stk[i] = i;\n    solve(0, 2, n);\n    int res = 1;\n    for(int i = 1; i <= 100000; i++) {\n        add(res, 1ll * g[0][i] * w[1] % P * inv(i + w[1]) % P);\n    }\n    printf(\"%d\\n\", res);     \n    return 0;\n}\n```\n",
        "postTime": 1657543139,
        "uid": 682934,
        "name": "yllcm",
        "ccfLevel": 0,
        "title": "Solution-P5644\uff08\u5bb9\u65a5\u3001NTT\uff09"
    },
    {
        "content": "[\u66f4\u597d\u9605\u8bfb\u4f53\u9a8c\uff0c\u535a\u5ba2](http://zhylj.cc/index.php/archives/46/)\n\n## \u9898\u76ee\n\n\u6709 $n$ \u4e2a\u4eba\uff0c\u7b2c $i$ \u4e2a\u4eba\u6709\u6743\u91cd $w_i$\uff0c\u6bcf\u6b21\u4ee5\u6b63\u6bd4\u4e8e\u6743\u91cd\u7684\u6982\u7387\u5e72\u6389\u67d0\u4e2a\u4eba\uff0c\u6c42\u7b2c\u4e00\u4e2a\u4eba\u6700\u540e\u4e00\u4e2a\u88ab\u5e72\u6389\u7684\u6982\u7387\u3002\n\n$1\\le n\\le 10^5$.\n\n## \u5206\u6790\n\n\u8bb0 $s = \\sum w_i$\uff0c$p_i = w_i/s$.\n\n\u9996\u5148\u8003\u8651\u6982\u7387\u4f1a\u53d8\u5316\u4e0d\u597d\u505a\uff0c\u4e8e\u662f\u8f6c\u5316\u4e3a\u6bcf\u6b21\u4efb\u53d6\u4e00\u4e2a\u4eba\uff0c\u82e5\u8fd8\u6ca1\u88ab\u5e72\u6389\u5c31\u5e72\u6389\u4ed6\uff0c\u5426\u5219\u5565\u4e5f\u4e0d\u5e72\uff0c\u663e\u7136\u65b0\u7684\u9898\u76ee\u4e0e\u539f\u5148\u662f\u7b49\u4ef7\u7684\u3002\n\n\u8003\u8651\u7b2c\u4e00\u4e2a\u6700\u540e\u4e00\u4e2a\u88ab\u5e72\u6389\u7684\u60c5\u51b5\uff0c\u76f8\u5f53\u4e8e\u8981\u6ee1\u8db3\uff1a\u5728\u7b2c\u4e00\u4e2a\u4eba\u88ab\u5e72\u6389\u7684\u65f6\u523b\u4e4b\u524d\uff0c\u6240\u6709\u4eba\u90fd\u88ab\u9009\u53d6\u4e86\u81f3\u5c11\u4e00\u6b21\uff0c\u4e14\u7b2c\u4e00\u4e2a\u4eba\u6ca1\u6709\u88ab\u9009\u53d6\u8fc7\u3002\n\n\u8bbe $f_n$ \u8868\u793a\u300c\u524d $n$ \u4e2a\u65f6\u523b\uff0c\u7b2c\u4e00\u4e2a\u4eba\u6ca1\u6709\u88ab\u9009\u53d6\uff0c\u4e14\u7b2c\u4e8c\u4e2a\u4eba\u5230\u7b2c $n$ \u4e2a\u4eba\u90fd\u88ab\u9009\u53d6\u8fc7\u7684\u6982\u7387\u300d\uff0c\u5bb9\u6613\u53d1\u73b0 $f_n$ \u53ef\u4ee5\u88ab\u8868\u793a\u4e3a\u540e $n - 1$ \u4e2a\u4eba\u7684\u8d21\u732e\u7684\u4e8c\u9879\u5377\u79ef\u3002\n\n\u8bb0 $\\langle p_1f_n\\rangle$ \u7684 EGF \u4e3a $\\widehat F(z)$\uff0c\u4e8e\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u5217\u51fa\u5f0f\u5b50\uff1a\n\n$$\n\\widehat F(z) = p_1\\prod_{2\\le i \\le n} \\left(\\sum_{j\\ge 1} \\frac {(p_iz)^j}{j!}\\right) = p_1\\prod_{2\\le i \\le n}(e^{p_iz}-1)\n$$\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u5c55\u5f00\u8fd9\u4e2a\u5f0f\u5b50\u6210 $\\sum_{i}a_ie^{iz}$ \u7684\u5f62\u5f0f\uff0c\u4e8e\u662f\u8003\u8651\u5148\u6362\u4e2a\u5143\uff1a\n\n$$\n\\begin{aligned}\nx & = e^{s^{-1}z}\\\\\np_1\\prod_{2\\le i \\le n}(e^{p_iz}-1) & = p_1\\prod_{2\\le i \\le n} (x^{w_i}-1)\\\\\n\\end{aligned}\n$$\n\n\u7136\u540e\u6211\u4eec\u5c31\u8981\u6c42 $a_k = [x^k]p_1\\prod_{2\\le i \\le n} (x^{w_i}-1)$ \u4e86\uff0c\u6839\u636e\u5957\u8def\uff0c\u6211\u4eec\u6709\uff1a\n\n$$\n\\begin{aligned}\np_1\\prod_{2\\le i\\le n} (x^{w_i}-1) & = p_1(-1)^{n-1}\\prod_{2\\le i \\le n} (1-x^{w_i})\\\\\n\\prod_{2\\le i \\le n} (1-x^{w_i}) & = \\exp\\left(\\sum_{2\\le i\\le n} \\ln(1-x^{w_i})\\right) \\\\\n& = \\exp\\left(\\sum_{2\\le i\\le n}\\sum_{j\\ge 1}\\frac{-x^{w_ij}}{j}\\right)\n\\end{aligned}\n$$\n\n\u4e8e\u662f\u9884\u5904\u7406\u4e00\u4e0b\u6bcf\u79cd $w_i$ \u51fa\u73b0\u4e86\u51e0\u6b21\uff0c\u968f\u4fbf\u7b97\u4e00\u4e0b\u7cfb\u6570\u518d $\\exp$ \u5c31\u53ef\u4ee5\u5728 $\\mathcal O(s\\log s)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u8ba1\u7b97\u6240\u6709 $a_k$ \u4e86\u3002\n\n\u6c42\u51fa $a_k$ \u6709\u4ec0\u4e48\u7528\u5462\uff1f\u6211\u4eec\u6ce8\u610f\u5230\u5982\u679c\u6211\u4eec\u6c42\u51fa $\\widehat F(z)$ \u7684\u7cfb\u6570\u5e8f\u5217\u7684 OGF $F(z)$\uff0c\u90a3\u4e48 $F(1)$ \u5c31\u4e3a\u7b54\u6848\uff0c\u4e8e\u662f\u6211\u4eec\u8003\u8651\u5982\u4f55\u628a $\\widehat F(z)$ \u5199\u6210 OGF \u7684\u5f62\u5f0f\u3002\n\n\u6ce8\u610f\u5230 $e^{cz}$ \u7684\u7cfb\u6570\u5e8f\u5217 $\\langle c^n\\rangle$ \u5bf9\u5e94\u7684 OGF \u4e3a $\\dfrac 1{1-cz}$\uff0c\u4e8e\u662f\u6211\u4eec\u6709\uff1a\n\n$$\n\\begin{aligned}\n\\widehat F(z) & = \\sum_{i\\ge 0} a_ie^{is^{-1}z} \\\\\n\\implies F(z) & = \\sum_{i\\ge 0} \\frac {a_i}{1-is^{-1}z} \\\\\nF(1) & = \\sum_{i\\ge 0} \\frac {a_i}{1 - is^{-1}}\n\\end{aligned}\n$$\n\n\u7136\u540e\u5c31\u505a\u5b8c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(s\\log s)$.\n\n~~\u7136\u800c\u7531\u4e8e\u6211\u5b9e\u73b0\u7684\u4e11\uff0c\u8dd1\u7684\u6bd4\u5176\u5b83\u5206\u6cbb NTT \u7684\u9898\u89e3\u6162\u3002~~\n\n## \u4ee3\u7801\n\n```cpp\nconst int N = 5e5 + 5, Mod = 998244353, g = 3, gInv = 332748118;\n\nint QPow(int a, int b) {\n\tint ret = 1, bas = a;\n\tfor(; b; b >>= 1, bas = 1LL * bas * bas % Mod)\n\t\tif(b & 1) ret = 1LL * ret * bas % Mod;\n\treturn ret;\n}\n\nint fac[N], fac_inv[N], inv[N];\nvoid Init(int n) {\n\tfac[0] = 1;\n\tfor(int i = 1; i <= n; ++i)\tfac[i] = 1LL * fac[i - 1] * i % Mod;\n\tfac_inv[n] = QPow(fac[n], Mod - 2);\n\tfor(int i = n - 1; ~i; --i) fac_inv[i] = 1LL * fac_inv[i + 1] * (i + 1) % Mod;\n\tfor(int i = 1; i <= n; ++i) inv[i] = 1LL * fac_inv[i] * fac[i - 1] % Mod;\n}\n\nnamespace Poly {\n\nint rev[N], ur[N];\nint GetRev(int x, int y) {\n\tint len = 1, h_bit = 0; ur[0] = 1;\n\tfor(x += y; len < x; len <<= 1, ++h_bit);\n\tfor(int i = 1; i < len; ++i)\n\t\trev[i] = (rev[i >> 1] >> 1) | ((i & 1) << (h_bit - 1));\n\treturn len;\n}\nvoid NTT(int f[], int len, bool flag) {\n\tfor(int i = 0; i < len; ++i)\n\t\tif(i < rev[i]) std::swap(f[i], f[rev[i]]);\n\tfor(int i = 1; i < len; i <<= 1) {\n\t\tint ur_1 = QPow(flag ? g : gInv, (Mod - 1) / (i << 1));\n\t\tfor(int j = 1; j < i; ++j)\n\t\t\tur[j] = 1LL * ur[j - 1] * ur_1 % Mod;\n\t\tfor(int j = 0; j < len; j += (i << 1))\n\t\t\tfor(int k = 0; k < i; ++k) {\n\t\t\t\tint fl = f[j + k], fr = 1LL * f[i + j + k] * ur[k] % Mod;\n\t\t\t\tf[j + k] = (fl + fr) % Mod;\n\t\t\t\tf[i + j + k] = (fl - fr + Mod) % Mod;\n\t\t\t}\n\t}\n\tif(!flag) {\n\t\tint len_inv = inv[len];\n\t\tfor(int i = 0; i < len; ++i)\n\t\t\tf[i] = 1LL * f[i] * len_inv % Mod;\n\t}\n}\nint tmp_f[N];\nvoid Inv(int f[], int f_inv[], int n) {\n\tif(n == 1) { f_inv[0] = QPow(f[0], Mod - 2); return; }\n\tInv(f, f_inv, (n + 1) / 2);\n\tint len = GetRev(n, n);\n\tfor(int i = 0; i < len; ++i) tmp_f[i] = f[i] * (i < n);\n\tfor(int i = n; i < len; ++i) f_inv[i] = 0;\n\tNTT(tmp_f, len, true); NTT(f_inv, len, true);\n\tfor(int i = 0; i < len; ++i)\n\t\tf_inv[i] = f_inv[i] * (2 - 1LL * f_inv[i] * tmp_f[i] % Mod + Mod) % Mod;\n\tNTT(f_inv, len, false);\n\tfor(int i = n; i < len; ++i) f_inv[i] = 0;\n}\nvoid Der(int f[], int f_d[], int n) {\n\tfor(int i = 0; i < n - 1; ++i)\n\t\tf_d[i] = 1LL * f[i + 1] * (i + 1) % Mod;\n\tf_d[n] = 0;\n}\nvoid Intg(int f[], int f_intg[], int n) {\n\tfor(int i = n - 1; i; --i)\n\t\tf_intg[i] = 1LL * f[i - 1] * inv[i] % Mod;\n\tf_intg[0] = 0;\n}\nint tmp_f_inv[N];\nvoid Ln(int f[], int f_ln[], int n) {\n\tInv(f, tmp_f_inv, n);\n\tDer(f, f_ln, n);\n\tint len = GetRev(n, n);\n\tfor(int i = n; i < len; ++i) tmp_f_inv[i] = f_ln[i] = 0;\n\tNTT(tmp_f_inv, len, true); NTT(f_ln, len, true);\n\tfor(int i = 0; i < len; ++i)\n\t\tf_ln[i] = 1LL * tmp_f_inv[i] * f_ln[i] % Mod;\n\tNTT(f_ln, len, false);\n\tIntg(f_ln, f_ln, n);\n\tfor(int i = n; i < len; ++i) f_ln[i] = 0;\n}\nint tmp_f_ln[N];\nvoid Exp(int f[], int f_exp[], int n) {\n\tif(n == 1) { f_exp[0] = 1; return; }\n\tExp(f, f_exp, (n + 1) / 2);\n\tLn(f_exp, tmp_f_ln, n);\n\tint len = GetRev(n, n);\n\tfor(int i = 0; i < n; ++i)\n\t\ttmp_f_ln[i] = ((i == 0) - tmp_f_ln[i] + f[i] + Mod) % Mod;\n\tfor(int i = n; i < len; ++i) f_exp[i] = tmp_f_ln[i] = 0;\n\tNTT(f_exp, len, true); NTT(tmp_f_ln, len, true);\n\tfor(int i = 0; i < len; ++i)\n\t\tf_exp[i] = 1LL * f_exp[i] * tmp_f_ln[i] % Mod;\n\tNTT(f_exp, len, false);\n\tfor(int i = n; i < len; ++i) f_exp[i] = 0;\n}\n\n}\n\nint n, s, s_inv, p, w[N], b[N], F[N], G[N];\nint main() {\n\trd(n); Init(N - 1);\n\tfor(int i = 1; i <= n; ++i) {\n\t\trd(w[i]);\n\t\ts += w[i];\n\t\tif(i > 1) {\n\t\t\t++b[w[i]];\n\t\t}\n\t}\n\ts_inv = QPow(s, Mod - 2);\n\tp = 1LL * w[1] * s_inv % Mod;\n\t++s;\n\tfor(int i = 1; i < s; ++i) {\n\t\tfor(int j = i; j < s; j += i)\n\t\t\tF[j] = (F[j] - 1LL * inv[j / i] * b[i] % Mod + Mod) % Mod;\n\t}\n\tPoly::Exp(F, G, s);\n\tfor(int i = 0; i < s; ++i) {\n\t\tif(n % 2 == 0) G[i] = (Mod - G[i]) % Mod;\n\t\tG[i] = 1LL * G[i] * p % Mod;\n\t}\n\tint ans = 0;\n\tfor(int i = 0; i < s; ++i)\n\t\tans = (ans + 1LL * G[i] * QPow((1 - 1LL * i * s_inv % Mod + Mod) % Mod, Mod - 2)) % Mod;\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1616122329,
        "uid": 34238,
        "name": "zhylj",
        "ccfLevel": 9,
        "title": "\u300cPKUWC 2018\u300d\u730e\u4eba\u6740"
    },
    {
        "content": "\u5982\u679c\u516c\u5f0f\u6302\u4e86 \u8bf7\u8fdb\u5165\u535a\u5ba2\u89c2\u770b \u6216\u8005[\u66f4\u597d\u7684\u4f53\u9a8c](https://www.zybuluo.com/computerkiller/note/1749384)\n\n## \u9898\u610f:\n\n$n$\u4e2a\u4eba\u968f\u673a\u5f00\u67aa,\u6bcf\u4e2a\u4eba\u4e2d\u5f39\u7684\u6982\u7387\u4e0d\u540c,\u75311\u53f7\u5f00\u59cb\u5f00\u67aa,\u95ee1\u53f7\u6d3b\u5230\u6700\u540e\u5730\u6982\u7387\n\n## solution\n\n\u8003\u8651\u5bb9\u65a5,\u4e0d\u5408\u6cd5\u7684\u7b54\u6848\u662f\u6709\u4e00\u4e9b\u6570\u57281\u4e4b\u540e\u624d\u88ab\u5220\u9664\n\n\u5b9a\u4e49\u5168\u96c6$A=\\{2,3,...,n\\}$,\u4ee5\u53ca\u4ee4$sum=\\displaystyle\\sum\\limits_{i=1}^n\\omega_i$\n\n\u90a3\u4e48\u6211\u4eec\u5f88\u5bb9\u6613\u5f97\u5230\u8fd9\u6837\u4e00\u4e2a\u4e0d\u5408\u6cd5\u6982\u7387\u7684\u5f0f\u5b50:\n$$\n\\begin{aligned}\n&\\displaystyle\\sum\\limits_{S\\subset A}\\displaystyle\\sum\\limits_{i=0}^{\\infty}(-1)^{|S|}\\left(\\cfrac{sum-\\omega_1-\\displaystyle\\sum\\limits_{x\\in S}\\omega_x}{sum}\\right)^i\\cfrac{\\omega_1}{sum}\\\\\n&=\\cfrac{\\omega_1}{sum}\\displaystyle\\sum\\limits_{S\\subset A}(-1)^{|S|}\\displaystyle\\sum\\limits_{i=0}^{\\infty}\\left(\\cfrac{sum-\\omega_1-\\displaystyle\\sum\\limits_{x\\in S}\\omega_x}{sum}\\right)^i\\\\\n\\end{aligned}\n$$\n\n\u800c\u6211\u4eec\u77e5\u9053:\n$$\n1+x+x^2+...+x^{n-1}+x^n+...=\\frac{1}{x-1}\n$$\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5f97\u5230:\n$$\n\\begin{aligned}\n&\\cfrac{\\omega_1}{sum}\\displaystyle\\sum\\limits_{S\\subset A}(-1)^{|S|}\\displaystyle\\sum\\limits_{i=0}^{\\infty}\\left(\\cfrac{sum-\\omega_1-\\displaystyle\\sum\\limits_{x\\in S}\\omega_x}{sum}\\right)^i\\\\\n&=\\cfrac{\\omega_1}{sum}\\displaystyle\\sum\\limits_{S\\subset A}(-1)^{|S|}\\frac{1}{\\cfrac{sum-\\omega_1-\\displaystyle\\sum\\limits_{x\\in S}\\omega_x}{sum}-1}\\\\\n&=-\\cfrac{\\omega_1}{sum}\\displaystyle\\sum\\limits_{S\\subset A}(-1)^{|S|}\\frac{sum}{\\omega_1+\\displaystyle\\sum\\limits_{x\\in S}\\omega_x}\\\\\n\\end{aligned}\n$$\n\n\u6211\u4eec\u8003\u8651\u5957\u8def\u5730\u66f4\u6362\u679a\u4e3e\u987a\u5e8f:\n$$\n-\\cfrac{\\omega_1}{sum}\\displaystyle\\sum\\limits_{S\\subset A}(-1)^{|S|}\\frac{sum}{\\omega_1+\\displaystyle\\sum\\limits_{x\\in S}\\omega_x}\\\\\n=-\\cfrac{\\omega_1}{sum}\\displaystyle\\sum\\limits_{x=1}^{sum-\\omega_1}\\frac{sum}{\\omega_1+x}\\displaystyle\\sum\\limits_{S\\subset A}(-1)^{|S|}[\\displaystyle\\sum\\limits_{u\\in S}\\omega_u==x]\\\\\n=-\\displaystyle\\sum\\limits_{x=1}^{sum-\\omega_1}\\frac{\\omega_1}{\\omega_1+x}\\displaystyle\\sum\\limits_{S\\subset A}(-1)^{|S|}[\\displaystyle\\sum\\limits_{u\\in S}\\omega_u==x]\n\\tag{1}\n$$\n\n\u6211\u4eec\u8003\u8651\u540e\u9762\u5730\u8fd9\u4e2a\u4e1c\u897f\u5e94\u8be5\u5982\u4f55\u8ba1\u7b97,\u4e0d\u59a8\u8003\u8651\u4ed6\u7684\u751f\u6210\u51fd\u6570:\n$$\nF(x)=\\displaystyle\\prod_{i=2}^n(1-x^{\\omega_i})\\tag{2}\n$$\n\n\u5bf9\u4e8e\u67d0\u4e2a\u6570$i$,$1$\u8868\u793a\u4e0d\u9009\u8fd9\u4e2a\u6570,\u800c$x^{\\omega_i}$\u8868\u793a\u9009\u8fd9\u4e2a\u6570,\u90a3\u4e48\u6211\u4eec\u6240\u8981\u7684\u5f0f\u5b50\u5c31\u662f:\n\n$$\n\\displaystyle\\sum\\limits_{S\\subset A}(-1)^{|S|}[\\displaystyle\\sum\\limits_{u\\in S}\\omega_u==x]=[x^n]F(x)\n$$\n\u6211\u4eec\u89c2\u5bdf\u6570\u636e\u8303\u56f4,\u53d1\u73b0(1)\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u4e58\u6cd5\u5f97\u5230,\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651(2)\u5f0f.\n\n(2)\u5f0f\u7684\u5904\u7406\u6211\u4eec\u8003\u8651\u4e00\u4e2a\u5206\u6cbb,\u5e76\u4e0d\u662f\u5206\u6cbbfft,\u53ea\u662f\u5355\u7eaf\u5730\u6bcf\u6b21\u5c06\u5176\u5206\u6210\u4e24\u90e8\u5206,\u518d\u5c06\u4e24\u90e8\u5206\u5408\u5e76\n\n\u6240\u4ee5\u6211\u4eec\u8981\u7684\u7b54\u6848\u5c31\u662f:\n$$\n1+\\displaystyle\\sum\\limits_{x=1}^{sum-\\omega_1}\\frac{\\omega_1}{\\omega_1+x}\\displaystyle\\sum\\limits_{S\\subset A}(-1)^{|S|}[\\displaystyle\\sum\\limits_{u\\in S}\\omega_u==x]\n$$\n\u4ee3\u7801\u88ab\u6211\u5361\u5e38\u5361\u5730\u6ca1\u6709\u53ef\u8bfb\u6027/kk \u5c31\u8d34\u4e2a[\u526a\u8d34\u677f](https://www.luogu.com.cn/paste/ct2i8hat)\u5427(",
        "postTime": 1602825966,
        "uid": 68030,
        "name": "serverkiller",
        "ccfLevel": 0,
        "title": "[PKUWC2018]\u730e\u4eba\u6740"
    },
    {
        "content": "#Solution\n##\u89c2\u5bdf\n\u5982\u679c\u6709\u4e00\u4e2a\u730e\u4eba\u6b7b\u4e86\uff0c\u90a3\u4e48\u5176\u4ed6\u730e\u4eba\u88ab\u6253\u4e2d\u7684\u6982\u7387\u7684\u5206\u6bcd\u5c31\u4f1a\u4e00\u8d77\u51cf\u5c0f\uff0c\u4f46\u4e0d\u96be\u53d1\u73b0\uff0c\u4ed6\u4eec\u88ab\u6253\u4e2d\u7684\u76f8\u5bf9\u6982\u7387\u5176\u5b9e\u5e76\u4e0d\u4f1a\u53d8\uff0c\u56e0\u6b64\u53ef\u4ee5\u770b\u4f5c\u730e\u4eba\u6b7b\u4e86\u4e4b\u540e\u6b7b\u5c38\u8fd8\u5728\u6253\u4e2d\u6b7b\u5c38\u4e5f\u6ca1\u5173\u7cfb\uff08\u56e0\u4e3a\u6211\u4eec\u5e76\u4e0d\u5173\u5fc3\u730e\u4eba\u88ab\u6253\u7684\u671f\u671b\u6b21\u6570\uff09\n##\u5bb9\u65a5\n\u90a3\u4e48\uff0c\u6211\u4eec\u8003\u8651\u5bb9\u65a5\uff0c\u663e\u7136 \n$$ans=\\sum_ { S\\subseteq \\left\\{2,3,4...n \\right\\} } (-1)^{|S|} P(S)$$\n\u5176\u4e2d $P(S)$ \u8868\u793a $S$ \u8fd9\u4e2a\u96c6\u5408\u5185\u6240\u6709\u6570\u90fd\u6b7b\u5728 $1$ \u4e4b\u540e\u7684\u6982\u7387\uff0c\u90a3\u4e48\u8bbe\u6240\u6709 $w_i$ \u7684\u548c\u4e3a $sum$,\u96c6\u5408 $S$ \u5185\u6240\u6709\u6570\u7684\u548c\u4e3a $s(S)$\uff0c\u5219\n\n$$P(S)=\\sum_{i=0}^\\infty ({{sum-a_1-s(S)} \\over sum})^i \\times {a_1 \\over sum}$$\n$$\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ ={a_1 \\over sum}\\times\\sum_{i=0}^\\infty ({{sum-a_1-s(S)} \\over sum})^i$$\n\u8003\u8651\u5bf9 $\\sum_{i=0}^\\infty ({{sum-a_1-s(S)} \\over sum})^i$ \u7b49\u6bd4\u6570\u5217\u6c42\u548c\u3002\n\u8bbe\n$$Sum=\\sum_{i=0}^\\infty ({{sum-a_1-s(S)} \\over sum})^i$$\n\u5219 \n$${{sum-a_1-s(S)} \\over sum}Sum=\\sum_{i=1}^\\infty ({{sum-a_1-s(S)} \\over sum})^i$$\n\u6240\u4ee5\n$$Sum={tot \\over {s(S)+a_1}}$$\n\u6240\u4ee5\n$$ans=\\sum_ { S\\subseteq \\left\\{2,3,4...n \\right\\} }(-1)^{|S|}\\times {tot \\over {s(S)+a_1}}$$\n\u8003\u8651\u5e73\u51e1\u5730\u53d8\u5316\u4e00\u4e0b\u8fd9\u4e2a\u5f0f\u5b50\u3002\n$$\\sum_{s(S)=i} (-1)^{|S|} \\times {tot \\over {a_1+i}}$$\n\n\u6211\u4eec\u53ef\u4ee5\u5c06 $(-1)^{|S|}$ \u548c ${tot \\over {a_1+i}}$ \u5206\u5f00\u7b97\u3002\n\u8bbe \n$$f(i)=\\sum_{s(S)=i}(-1)^{|S|}$$\n\n\u8003\u8651\u751f\u6210\u51fd\u6570\uff0c\u56e0\u4e3a $\\sum_{s(S)=i}1$ \u7684\u7b2c $i$ \u9879\u4e3a\u751f\u6210\u51fd\u6570 $\\prod_{i=2}^n(1+x^{w_i})$ \u7684\u7b2c $i$ \u9879\uff0c\u53c8\u53ef\u4ee5\u8003\u8651\u5230 $-1^{|S|}$ \u5b9e\u9645\u4e0a\u5c31\u610f\u5473\u7740\u6bcf\u52a0\u5165\u4e00\u4e2a\u6570\u5c31\u591a\u4e00\u4e2a $-1$ \u7684\u7cfb\u6570\uff0c\u56e0\u6b64\u5176\u751f\u6210\u51fd\u6570\u4e3a $\\prod_{i=2}^n (1-x^{w_i})$\u3002\n\u5904\u7406\u8fd9\u4e2a\u751f\u6210\u51fd\u6570\u53ef\u4ee5\u76f4\u63a5\u5206\u6cbb\u52a0 NTT\u3002\u5373\u7b97 $[l,r]$ \u533a\u95f4\u7684\u5377\u79ef\u65f6\u5148\u5206\u6cbb\u5730\u7b97 $[l,mid]$ \u548c $[mid,r]$ \u7684\u5377\u79ef\uff0c\u518d\u5c06\u4e24\u4e2a\u591a\u9879\u5f0f\u5377\u8d77\u6765\u3002\u8fd9\u6837\u4f60\u5c31\u7b97\u51fa\u4e86\u6bcf\u4e00\u9879\u7684\u7cfb\u6570\uff0c\u6700\u540e\u76f4\u63a5\u5c06\u7cfb\u6570\u4ee3\u5165\u8ba1\u7b97\u5373\u53ef\u3002\n\n[Code](https://www.luogu.com.cn/paste/2y6nq0iw)",
        "postTime": 1683374253,
        "uid": 360977,
        "name": "541forever",
        "ccfLevel": 0,
        "title": "P5644 [PKUWC2018]\u730e\u4eba\u6740"
    },
    {
        "content": "## \u4e00\u3001\u9898\u76ee\n\n~~\u542c\u8bf4\u8fc7\u8fd9\u9898\u5f88\u4e45\u4e86\uff0c\u8fd9\u4e48\u7ecf\u5178\u600e\u4e48\u80fd\u4e0d\u505a\u5462\uff1f~~\n\n[\u70b9\u6b64\u770b\u9898](https://www.luogu.com.cn/problem/P5644)\n\n## \u4e8c\u3001\u89e3\u6cd5\n\n\u7531\u4e8e\u6982\u7387\u4e00\u76f4\u5728\u53d8\u7b97\u7740\u9ebb\u70e6\u5f97\u5f88\uff0c\u6709\u4e00\u4e2a\u795e\u5947 $\\tt idea$ \u5c31\u662f\u6211\u4eec\u4e71\u5f00\u67aa\uff0c\u5982\u679c\u8fd9\u4e00\u67aa\u5728\u97ad\u5c38\u90a3\u4e48\u5c31\u518d\u5f00\u4e00\u67aa\uff0c\u77e5\u9053\u6253\u6b7b\u7b2c\u4e00\u4e2a\u4eba\u4e3a\u6b62\u3002\u8fd9\u79cd\u7b56\u7565\u7684\u8bc1\u660e\u4e5f\u4e0d\u96be\uff0c**\u5bf9\u4e8e\u4e00\u4e2a\u4eba\u88ab\u6253\u5230\u7684\u6982\u7387\u90fd\u53ea\u548c $w_i$ \u7684\u6bd4\u503c\u6709\u5173**\u3002\n\n\u7136\u540e\u8fd8\u662f\u4e0d\u4f1a\u505a\uff0c\u4e00\u4e2a\u60f3\u90fd\u4e0d\u6562\u60f3\u7684\u65b9\u6cd5\u662f\u6307\u6570\u7ea7\u5bb9\u65a5\uff0c\u679a\u4e3e\u96c6\u5408 $S$ \u8868\u793a\u81f3\u5c11\u96c6\u5408 $S$ \u4e2d\u7684\u4eba\u5728 $1$ \u7684\u540e\u9762\u6b7b\u6389\uff0c\u90a3\u4e48\u7b54\u6848\u662f\uff1a\n\n> \u8fd9\u4e00\u6b65\u5999\u6781\u4e86\uff0c\u6211\u4eec\u8981**\u4e3b\u52a8\u4f7f\u7528\u5bb9\u65a5**\u800c\u4e0d\u662f\u770b\u7740\u50cf\u5bb9\u65a5\u624d\u7528\uff08\u548c $\\tt cdq$ \u5dee\u4e0d\u591a\uff09\u800c\u4e0d\u662f\u770b\u7740\u5f88\u50cf\u518d\u7528\u5bb9\u65a5\uff0c\u6709\u5f88\u591a\u65b9\u6cd5\u80fd\u628a\u5bb9\u65a5\u7684\u590d\u6742\u5ea6\u964d\u4e0b\u6765\uff0c\u5e38\u89c1\u7684\u5c31\u662f $dp$ \u7ef4\u62a4\u5bb9\u65a5\u7cfb\u6570\u3002\n\n$$\\sum_{S}(-1)^{|S|}P(S)$$\n\n\u5176\u4e2d $P(S)$ \u8868\u793a\u81f3\u5c11\u96c6\u5408 $S$ \u4e2d\u7684\u4eba\u5728 $1$ \u540e\u9762\u6b7b\u7684\u6982\u7387\uff0c\u90a3\u4e48\u53ef\u4ee5\u6253\u65e0\u9650\u67aa\uff0c\u53ea\u8981\u4e0d\u6253\u5230 $1$ \u548c $S$ \u4e2d\u7684\u4eba\u5c31\u53ef\u4ee5\uff0c\u7136\u540e\u6211\u4eec\u518d\u7ed9 $1$ \u8865\u4e00\u67aa\uff0c\u8fd9\u6837\u53ef\u4ee5\u5199\u51fa $P(S)$ \u7684\u8868\u8fbe\u5f0f\u4e86\uff1a\n\n$$P(S)=\\sum_{i=0}^\\infty(\\frac{tot-a[1]-sum[S]}{tot})^i\\times\\frac{a[1]}{tot}$$\n\n\u76f4\u63a5\u628a\u4ed6\u5f53\u6bcd\u51fd\u6570\u5199\u95ed\u5f62\u5f0f\uff1a\n\n$$P(S)=\\frac{1}{1-\\frac{tot-a[1]-sum[S]}{tot}}\\times\\frac{a[1]}{tot}=\\frac{a[1]}{a[1]+sum[S]}$$\n\n\u53d1\u73b0\u5c31\u53ea\u6709 $sum[S]$ \u9700\u8981\u7b97\u4e00\u7b97\u4e86\uff0c\u53d1\u73b0\u8fd9\u5c31\u662f\u4e00\u4e2a\u80cc\u5305\u95ee\u9898\uff0c\u5f88\u5bb9\u6613 $O(n^2)$ \u89e3\u51b3\u554a\u3002\n\n\u518d\u56de\u53bb\u770b\u4e00\u773c\u9898\u76ee\uff0c$\\sum a_i\\leq 10^5$\uff0c\u4e5f\u5c31\u662f\u603b\u5bb9\u91cf\u662f\u5f88\u5c0f\u7684\uff0c\u90a3\u4e48\u4e0d\u96be\u60f3\u5230\u7528\u751f\u6210\u51fd\u6570\u4f18\u5316\u80cc\u5305\u3002\u6709 $n-1$ \u4e2a\u5f62\u5982 $1-x^{a}$ \u8fd9\u6837\u7684\u51fd\u6570\u6211\u4eec\u8981\u6c42\u4ed6\u7684\u5377\u79ef\uff0c\u90a3\u4e48\u76f4\u63a5\u5206\u6cbb\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u6ce8\u610f\u5206\u6cbb\u7684\u65f6\u5019\u8981**\u6309\u5bb9\u91cf\u5bf9\u534a\u5206**\uff0c\u7f51\u4e0a\u7684\u9898\u89e3\u5927\u591a\u662f\u4ece\u4e2d\u95f4\u5206\u4e00\u534a\uff0c\u6211\u89c9\u5f97\u8fd9\u6837\u662f\u9519\u7684\uff0c~~\u4f46\u662f\u6211\u4e0d\u662f\u7279\u522b\u6e05\u695a\u600e\u4e48\u5361\u989d~~\u3002\u4e00\u5b9a\u8981\u8fd9\u6837\u624d\u80fd\u8bf4\u660e\u590d\u6742\u5ea6\u662f $O(n\\log^2 n)$\n\n```c++\n#include <cstdio>\n#include <iostream>\nusing namespace std;\nconst int M = 200005;\nconst int MOD = 998244353;\n#define int long long\nint read()\n{\n\tint x=0,f=1;char c;\n\twhile((c=getchar())<'0' || c>'9') {if(c=='-') f=-1;}\n\twhile(c>='0' && c<='9') {x=(x<<3)+(x<<1)+(c^48);c=getchar();}\n\treturn x*f;\n}\nint n,ans,w[M],s[M],f[M];\nnamespace poly\n{\n\tint len,A[M],B[M],rev[M];\n\tint qkpow(int a,int b)\n\t{\n\t\tint r=1;\n\t\twhile(b>0)\n\t\t{\n\t\t\tif(b&1) r=r*a%MOD;\n\t\t\ta=a*a%MOD;\n\t\t\tb>>=1;\n\t\t}\n\t\treturn r;\n\t}\n\tvoid NTT(int *a,int len,int op)\n\t{\n\t\tfor(int i=0;i<len;i++)\n\t\t{\n\t\t\trev[i]=(rev[i>>1]>>1)|((len/2)*(i&1));\n\t\t\tif(i<rev[i]) swap(a[i],a[rev[i]]);\n\t\t}\n\t\tfor(int s=2;s<=len;s<<=1)\n\t\t{\n\t\t\tint t=s/2,w=(op==1)?qkpow(3,(MOD-1)/s):qkpow(3,MOD-1-(MOD-1)/s);\n\t\t\tfor(int i=0;i<len;i+=s)\n\t\t\t\tfor(int j=0,x=1;j<t;j++,x=x*w%MOD)\n\t\t\t\t{\n\t\t\t\t\tint fe=a[i+j],fo=a[i+j+t];\n\t\t\t\t\ta[i+j]=(fe+x*fo)%MOD;\n\t\t\t\t\ta[i+j+t]=((fe-x*fo)%MOD+MOD)%MOD;\n\t\t\t\t}\n\t\t}\n\t\tif(op==1) return ;\n\t\tint inv=qkpow(len,MOD-2);\n\t\tfor(int i=0;i<len;i++) a[i]=a[i]*inv%MOD;\n\t}\n\tvoid work(int n,int m,int *a,int *b,int *c)\n\t{\n\t\tlen=1;while(len<n+m) len<<=1;\n\t\tfor(int i=0;i<len;i++) A[i]=B[i]=0;\n\t\tfor(int i=0;i<n;i++) A[i]=a[i];\n\t\tfor(int i=0;i<m;i++) B[i]=b[i];\n\t\tNTT(A,len,1);NTT(B,len,1);\n\t\tfor(int i=0;i<len;i++) A[i]=A[i]*B[i]%MOD;\n\t\tNTT(A,len,-1);\n\t\tfor(int i=0;i<n+m;i++)\n\t\t\tc[i]=A[i];\n\t}\n}\nvoid cdq(int *a,int l,int r)\n{\n\tif(l==r)\n\t{\n\t\ta[0]=1;a[w[l]]=MOD-1;\n\t\treturn ;\n\t}\n\tint mid=l;\n\twhile(mid<r-1 && 2*(s[mid]-s[l-1])<s[r]-s[l-1]) mid++;\n\tint l1=s[mid]-s[l-1],l2=s[r]-s[mid];\n\tint f[2*l1]={},g[2*l2]={};\n\tcdq(f,l,mid);cdq(g,mid+1,r);\n\tpoly::work(l1+1,l2+1,f,g,a);\n}\nsigned main()\n{\n\tn=read();\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tw[i]=read();\n\t\ts[i]=s[i-1]+w[i];\n\t}\n\tcdq(f,2,n);\n\tfor(int i=0;i<=s[n];i++)\n\t{\n\t\tint tmp=w[1]*poly::qkpow(w[1]+i,MOD-2)%MOD;\n\t\tans=(ans+tmp*f[i])%MOD;\n\t}\n\tprintf(\"%lld\\n\",ans);\n}\n```\n\n",
        "postTime": 1617793339,
        "uid": 128239,
        "name": "C20203030",
        "ccfLevel": 0,
        "title": "[PKUWC2018] \u730e\u4eba\u6740"
    },
    {
        "content": "## [\u9898\u610f](https://www.luogu.com.cn/problem/P5644)\n\n\u53d1\u73b0\u539f\u95ee\u9898\u5f88\u9ebb\u70e6\uff0c\u56e0\u4e3a\u5982\u679c\u4e00\u4e2a\u4eba\u6b7b\u53bb\uff0c\u90a3\u4e48\u5269\u4e0b\u7684\u4eba\u7684\u6982\u7387\u90fd\u4f1a\u4ea7\u751f\u53d8\u5316\uff0c\u5373\u5206\u6bcd\u51cf\u53bb\u6b7b\u6389\u7684\u90a3\u4e2a\u4eba\u7684$w$\u3002\n\n\u8003\u8651\u8f6c\u5316\u4e0b\u95ee\u9898\uff1a  \n\u6bcf\u4e2a\u4eba\u6982\u7387\u4fdd\u6301\u4e0d\u53d8\uff0c\u5982\u679c\u5f00\u67aa\u6253\u4e2d\u7684\u4eba\u5df2\u7ecf\u6b7b\u4e86\u5c31\u7ee7\u7eed\u6253\uff0c\u76f4\u5230\u6253\u4e2d\u4e00\u4e2a\u6ca1\u6b7b\u7684\u4eba\u3002\u7531\u4e8e\u6d3b\u7740\u7684\u4eba\u7684\u6982\u7387\u6bd4\u5e76\u6ca1\u6709\u53d8\u5316\uff0c\u56e0\u6b64\u8fd9\u4e2a\u95ee\u9898\u548c\u539f\u95ee\u9898\u662f\u7b49\u4ef7\u7684\u3002\n\n\u8003\u8651\u5982\u4f55\u6c42\u89e3\uff1a  \n\u8ba9\u6700\u540e\u4e00\u4e2a\u4eba\u6070\u597d\u662f$1$\u4e0d\u597d\u6c42\uff0c\u4e0d\u59a8\u5148\u8003\u8651\u5bb9\u65a5\u3002\u8bbe$P(S)$\u8868\u793a\u5728$1$\u6b7b\u540e\uff0c$S$\u96c6\u5408\u5185\u7684\u6570\u624d\u88ab\u6740\u6b7b\u7684\u65b9\u6848\u6570\uff08\u4e0d\u5728$S$\u96c6\u5408\u5185\u7684\u6570\u4e5f\u53ef\u80fd\u88ab\u6740\uff09\u3002  \n$ans=\\sum (-1)^{|S|}P(S)$\n\n\u5148\u8003\u8651$P(S)$\u600e\u4e48\u6c42\uff1a  \n\u8bbe$tot=\\sum\\limits_{i=1}^na_i$\uff0c$sum(S)$\u8868\u793a$S$\u96c6\u5408\u5185\u7684\u6570\u7684$w$\u4e4b\u548c\u3002  \n\u679a\u4e3e\u6253\u5230$1$\u4e4b\u524d\u6253\u4e86\u591a\u5c11\u67aa\uff1a$P(S)=\\sum\\limits_{i=0}^{+\\infty}(\\frac{tot-a_1-sum(S)}{tot})^i\\frac{a_1}{tot}$  \n\u53c8\u56e0$\\sum\\limits_{i=0}^{+\\infty}x^i=\\frac{1}{1-x}$  \n\u539f\u5f0f$=\\frac{tot-a_1-sum(S)}{tot}\\frac{a_1}{tot}=\\frac{a_1}{sum(S)+a_!}$  \n\u4ee3\u5165\u539f\u5f0f\uff1a$ans=\\sum(-1)^{|S|}\\frac{a_!}{sum(S)+a_1}$  \n\n\u56e0\u4e3a$\\sum w_i\\leqslant 1e5$\uff0c\u6240\u4ee5\u8003\u8651\u679a\u4e3e$sum(S)$\uff1a  \n$ans=\\sum\\limits_{i=0}^{tot}(\\sum\\limits_{sum(S)=i}(-1)^{|S|})\\frac{a_!}{a_1+i}$\uff0c\u53d1\u73b0\u5982\u679c\u80fd\u6c42\u51fa$\\frac{a_1}{a_1+i}$\u7684\u7cfb\u6570\u5373\u53ef\u89e3\u51b3\u95ee\u9898\u3002  \n\n\u8bbe$f_i=\\sum\\limits_{sum(S)=i}(-1)^{|S|}$\uff0c\u6211\u4eec\u8003\u8651\u5982\u4f55\u6c42\u6c42\u51fa$f$\uff1a  \n\u5148\u8003\u8651$\\sum\\limits_{sum(S)=i}1$\uff0c\u5b83\u5373\u4e3a$\\prod\\limits_{j=2}^n(1-x^{w_j})$\u7684\u7b2c$i$\u9879\u7cfb\u6570\u3002  \n\u800c$\\sum\\limits_{sum(S)=i}(-1)^{|S|}$\u5373\u4e3a$\\prod\\limits_{j=2}^{n}(1-x^{w_j})$\u7684\u7b2c$i$\u9879\u7cfb\u6570\u3002  \n\u7528\u5206\u6cbb\u5957\u4e0a$NTT$\u5373\u53ef\u6c42\u51fa$f$\uff0c\u5373\u5148\u6c42\u51fa$[l,mid]$\uff0c\u518d\u6c42\u51fa$[mid+1,r]$\uff0c\u6700\u540e\u8fd9\u4e24\u4e2a\u591a\u9879\u5f0f\u518d\u4e58\u8d77\u6765\u3002\n\n\u6700\u540e\u76f4\u63a5\u7b97\u5373\u53ef\u3002\n\ncode:\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=4e5+10;\nconst int mod=998244353;\nconst int G=3;\nconst int invG=332748118;\nint n,now,ans;\nint a[maxn],sum[maxn],pos[maxn],f[maxn];\nint tmp[40][maxn];\ninline int read()\n{\n    char c=getchar();int res=0,f=1;\n    while(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n    while(c>='0'&&c<='9')res=res*10+c-'0',c=getchar();\n    return res*f;\n}\ninline int power(int x,int k)\n{\n    int res=1;\n    while(k)\n    {\n        if(k&1)res=1ll*res*x%mod;\n        x=1ll*x*x%mod;k>>=1;\n    }\n    return res;\n}\ninline void NTT(int* a,int op,int len)\n{\n    int lim=1,cnt=0;\n    while(lim<len)lim<<=1,cnt++;\n    for(int i=0;i<lim;i++)pos[i]=(pos[i>>1]>>1)|((i&1)<<(cnt-1));\n    for(int i=0;i<lim;i++)if(i<pos[i])swap(a[i],a[pos[i]]);\n    for(int l=1;l<lim;l<<=1)\n    {\n        int wn=power(op==1?G:invG,(mod-1)/(l<<1));\n        for(int i=0;i<lim;i+=l<<1)\n        {\n            int w=1;\n            for(int j=0;j<l;j++,w=1ll*w*wn%mod)\n            {\n                int x=a[i+j],y=1ll*w*a[i+l+j]%mod;\n                a[i+j]=(x+y)%mod;a[i+l+j]=(x-y+mod)%mod;\n            }\n        }\n    }\n    if(op==1)return;\n    int inv=power(lim,mod-2);\n    for(int i=0;i<lim;i++)a[i]=1ll*a[i]*inv%mod;\n}\nvoid solve(int* a,int* f,int l,int r)\n{\n\tif(l==r){f[0]=1;f[a[l]]=-1;return;}\n\tint mid=(l+r)>>1;\n\tint *tmp1=tmp[++now],*tmp2=tmp[++now];\n\tsolve(a,tmp1,l,mid);solve(a,tmp2,mid+1,r);\n\tint lim=1;\n\twhile(lim<=(sum[r]-sum[l-1]))lim<<=1;\n\tNTT(tmp1,1,lim);NTT(tmp2,1,lim);\n\tfor(int i=0;i<lim;i++)f[i]=1ll*tmp1[i]*tmp2[i]%mod;\n\tNTT(f,-1,lim);\n\tfor(int i=0;i<lim;i++)tmp1[i]=tmp2[i]=0;\n\tnow-=2;\n}\nint main()\n{\n\tn=read();\n\tfor(int i=1;i<=n;i++)a[i]=read(),sum[i]=sum[i-1]+a[i];\n\tsolve(a,f,2,n);\n\t//for(int i=0;i<=sum[n]-sum[1];i++)cerr<<f[i]<<endl;\n\tfor(int i=0;i<=sum[n]-sum[1];i++)ans=(ans+1ll*f[i]*a[1]%mod*power(a[1]+i,mod-2)%mod)%mod;\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1585457523,
        "uid": 145441,
        "name": "nofind",
        "ccfLevel": 6,
        "title": "P5644 [PKUWC2018]\u730e\u4eba\u6740(\u6982\u7387+\u5bb9\u65a5+\u751f\u6210\u51fd\u6570)"
    }
]