[
    {
        "content": "\u4e00\u9053\u5f88\u597d\u7684\u63d0\u9ad8\u7ec4\u6570\u636e\u7ed3\u6784\u7efc\u5408\u9898\u3002\uff08\u5f3a\u70c8\u63a8\u8350\uff01\uff09\n\n\u5e73\u8861\u6811\u7ef4\u62a4\u626b\u63cf\u7ebf+\u7ebf\u6bb5\u6811\u6216\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u6811\u94fe\u5256\u5206\n\n### \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a $n$ \u4e2a **\u4e92\u4e0d\u76f8\u4ea4** \u7684\u5706\u6216\u51f8\u591a\u8fb9\u5f62\uff0c\u6bcf\u4e2a\u56fe\u5f62\u8fd8\u6709\u4e00\u4e2a\u6743\u503c $v$ \uff0c $m$ \u6b21\u64cd\u4f5c\uff1a\n\n`Q x0 y0 x1 y1` \uff1a \u67e5\u8be2\u4ece $(x0,y0)$ \u5230 $(x1,y1)$ \u7684\u7ebf\u6bb5\u6240\u7ecf\u8fc7\u7684\u56fe\u5f62\u7684\u8fb9\u754c\u7684\u5f02\u6216\u548c\u3002\u8fd9\u4e2a\u7b54\u6848\u8981\u5f02\u6216\u4e0a\u4e00\u4e2a\u8be2\u95ee\u7684\u7b54\u6848\u3002\u4fdd\u8bc1 $(x0,y0)$ \u548c $(x1,y1)$ \u5747\u4e0d\u5728\u56fe\u5f62\u7684\u8fb9\u754c\u4e0a\u3002\n\n`C i v` \uff1a \u5c06\u7b2c $i$ \u4e2a\u7ed9\u51fa\u7684\u56fe\u5f62\u7684\u6743\u503c\u6539\u4e3a $v$ \u3002\n\n$1\\le n\\le 10^5,1\\le m\\le 10^5$ \uff0c\u5355\u4e2a\u51f8\u591a\u8fb9\u5f62\u7684\u70b9\u6570 $\\le 34$ \u3002\n\n\u51f8\u591a\u8fb9\u5f62\u7684\u9876\u70b9\u5750\u6807\u6309\u987a\u65f6\u9488\u987a\u5e8f\u7ed9\u51fa\u3002\n\n### \u6811\u94fe\u5256\u5206\u90e8\u5206\n\n\u4f18\u5148\u8003\u8651\u8fd9\u4e00\u90e8\u5206\u6709\u52a9\u4e8e\u6211\u4eec\u660e\u6670\u626b\u63cf\u7ebf\u90e8\u5206\u8981\u7ef4\u62a4\u54ea\u4e9b\u503c\u3002\n\n\u7531\u4e8e\u5f02\u6216\u7684\u6027\u8d28\uff0c\u9898\u76ee\u6240\u6c42\u7b49\u4ef7\u4e8e\u6c42\u4efb\u610f\u4e00\u6761\u4ece $(x0,y0)$ \u5230 $(x1,y1)$ \u7684\u4efb\u610f\u66f2\u7ebf\u7ecf\u8fc7\u7684\u56fe\u5f62\u8fb9\u754c\u7684\u6743\u503c\u548c\u3002\u5c06\u8fd9\u6761\u76f4\u7ebf\u7279\u6b8a\u5316\u4e3a\u4ece $(x0,y0)$ \u8d70\u5230\u5e73\u9762\u5185\u4e0d\u5728\u4efb\u4f55\u4e00\u4e2a\u56fe\u5f62\u5185\u7684\u5730\u65b9\uff0c\u518d\u4ece\u8fd9\u4e2a\u5730\u65b9\u8d70\u5230 $(x1,y1)$ \u7684\u6743\u503c\u548c\u3002\u8fd9\u6837\u53ef\u4ee5 **\u5c06\u4e00\u5bf9\u70b9\u7684\u8be2\u95ee\u62c6\u6210\u4e24\u4e2a\u5bf9\u5355\u70b9\u7684\u8be2\u95ee** \u3002\n\n\u7531\u4e8e\u7ed9\u51fa\u7684\u56fe\u5f62\u4e92\u4e0d\u76f8\u4ea4\uff0c\u5219\u4e24\u4e2a\u56fe\u5f62\u53ea\u6709\u76f8\u79bb\u548c\u5305\u542b\u4e24\u79cd\u60c5\u51b5\uff0c\u5219\u5b83\u4eec\u4e4b\u95f4\u7684\u76f8\u4e92\u5305\u542b\u5173\u7cfb\u6784\u6210\u4e86\u4e00\u68f5 **\u6811** \uff08\u82e5\u4e00\u4e2a\u56fe\u5f62 $A$ \u5b8c\u5168\u5305\u542b\u53e6\u4e00\u4e2a\u56fe\u5f62 $B$ \uff0c\u5219 $A$ \u5728\u6811\u4e0a\u4e3a $B$ \u7684\u7956\u5148\uff0c\u518d\u8bbe\u4e00\u4e2a\u8d85\u7ea7\u6839\u8282\u70b9\u8868\u793a\u6574\u4e2a\u5e73\u9762\uff09\u3002\n\n\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u901a\u8fc7\u626b\u63cf\u7ebf\u9884\u5904\u7406\u51fa\u4e86\u8fd9\u68f5\u6811\uff0c\u548c\u5305\u542b\u6bcf\u4e2a\u8be2\u95ee\u4e2d\u7684\u70b9\u7684\u6700\u5c0f\u56fe\u5f62\u3002\u4ee4\u6811\u4e0a\u4e00\u4e2a\u70b9\u7684\u6743\u503c\u4e3a\u8be5\u70b9\u5bf9\u5e94\u56fe\u5f62\u7684\u6743\u503c\u3002\u4e00\u4e2a\u70b9\u8d70\u5230\u5e73\u9762\u5185\u4e0d\u5728\u4efb\u4f55\u4e00\u4e2a\u56fe\u5f62\u5185\u7684\u533a\u57df\u7684\u6743\u503c\u5f02\u6216\u548c\uff0c\u4e3a\u8be5\u70b9\u6240\u5728\u6700\u5c0f\u56fe\u5f62\u5bf9\u5e94\u70b9\u5230\u6839\u7684\u8def\u5f84\u5f02\u6216\u548c\u3002\n\n\u6811\u4e0a\u5355\u70b9\u4fee\u6539\uff0c\u6811\u4e0a\u67e5\u8be2\u8def\u5f84\u5f02\u6216\u548c\uff0c\u8fd9\u4e00\u90e8\u5206\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u6216\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u6811\u94fe\u5256\u5206\u5b9e\u73b0\u3002\u53c2\u8003\u4ee3\u7801\u4e2d\u7528\u7684\u662f\u7ebf\u6bb5\u6811\u5b9e\u73b0\u3002\n\n### \u626b\u63cf\u7ebf\u90e8\u5206\n\n\u7531\u4e0a\u4e00\u90e8\u5206\u53ef\u77e5\uff0c\u626b\u63cf\u7ebf\u90e8\u5206\u8981\u6c42\u51fa\u56fe\u5f62\u5305\u542b\u5173\u7cfb\u7684\u6811\uff0c\u548c\u6bcf\u4e2a\u70b9\u6700\u5c0f\u88ab\u5305\u542b\u5728\u54ea\u4e2a\u56fe\u5f62\u5185\u3002\n\n\u8003\u8651\u4ee5 $x$ \u5750\u6807\u4e3a\u65f6\u95f4\u8fdb\u884c\u626b\u63cf\u7ebf\u3002\u6bcf\u4e2a\u56fe\u5f62\u6709\u8d21\u732e\u7684\u65f6\u95f4\u6bb5\u5c31\u662f\u8be5\u56fe\u5f62\u7684\u6700\u5de6\u548c\u6700\u53f3\u9876\u70b9\u7684 $x$ \u5750\u6807\u4e4b\u95f4\u7684\u533a\u95f4\u3002\u6211\u4eec\u5728\u5de6\u9876\u70b9 $x$ \u5750\u6807\u63d2\u5165\u8fd9\u4e2a\u56fe\u5f62\u7684\u4e0a\u4e0b\u8fb9\u754c\uff0c\u5728\u53f3\u9876\u70b9 $x$ \u5750\u6807\u5220\u9664\u8fd9\u4e2a\u56fe\u5f62\u7684\u4e0a\u4e0b\u8fb9\u754c\u3002\n\n\u5728\u63d2\u5165\u4e00\u4e2a\u56fe\u5f62 $a$ \u65f6\uff0c\u6c42\u51fa\u5728\u5b83 **\u4e0b\u65b9\u4e14\u6700\u8fd1** \u7684\u56fe\u5f62\u8fb9\u754c\u3002\u8bbe\u4e0b\u65b9\u7684\u8fb9\u754c\u5c5e\u4e8e\u56fe\u5f62 $b$ \u3002\u82e5\u8fd9\u4e2a\u8fb9\u754c\u662f $b$ \u7684\u4e0a\u8fb9\u754c\uff0c\u5219\u6070\u597d\u5305\u542b $a$ \u7684\u6700\u5c0f\u56fe\u5f62\u5e94\u662f\u6070\u597d\u5305\u542b $b$ \u7684\u6700\u5c0f\u56fe\u5f62\uff1b\u82e5\u662f\u4e0b\u8fb9\u754c\uff0c\u5219\u6070\u597d\u5305\u542b $a$ \u7684\u6700\u5c0f\u56fe\u5f62\u5e94\u662f $b$ \u3002\u6070\u597d\u5305\u542b $a$ \u7684\u6700\u5c0f\u56fe\u5f62\u5728\u6811\u4e0a\u5c31\u662f $a$ \u7684\u7236\u4eb2\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u70b9\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u6c42\u51fa\u5b83\u4e0b\u65b9\u7684\u6700\u8fd1\u7684\u56fe\u5f62\u8fb9\u754c\uff0c\u7528\u76f8\u540c\u7684\u65b9\u6cd5\u6c42\u51fa\u5305\u542b\u8be5\u70b9\u7684\u6700\u5c0f\u56fe\u5f62\u3002\n\n\u6211\u4eec\u53d1\u73b0\u5728\u65f6\u95f4\u53d8\u5316\u540e\uff0c\u6bcf\u4e2a\u8fb9\u754c\u7684 $y$ \u5750\u6807\u90fd\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u8fd9\u4e2a\u53d8\u5316\u4e0d\u53ef\u7ef4\u62a4\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u56fe\u5f62\u4e92\u4e0d\u76f8\u4ea4\uff0c\u8fb9\u754c\u4e4b\u95f4\u7684\u6392\u5217\u987a\u5e8f\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\u3002\u6211\u4eec\u53ef\u4ee5\u7528\u5e73\u8861\u6811\u6765\u7ef4\u62a4\u8fb9\u754c\u7684\u6392\u5217\u987a\u5e8f\uff0c\u5728\u67e5\u8be2\u65f6\u53ea\u9700\u6c42\u51fa\u5f53\u524d\u7ed3\u70b9\u5bf9\u5e94\u7684\u8fb9\u754c\u7684 $y$ \u5750\u6807\u503c\uff0c\u6765\u786e\u5b9a\u662f\u5411\u5de6\u8fd8\u662f\u5411\u53f3\u8d70\u3002\n\n\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O((n+m)\\log (n+m))$ \uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(n+m)$ \u3002\n\n### \u53c2\u8003\u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<cstdlib>\nusing namespace std;\nconst int maxn=400010;\nconst double inf=1e18;\nconst double eps=1e-9;\nbool eq(double x,double y){return fabs(x-y)<=eps;}\nint n,m,tid,nm[maxn][3],lst;\nchar op;\nstruct Query\n{\n\tchar op;\n\tdouble xa,ya,xb,yb;\n\tint aid,bid,id,v;\n}s[maxn];\nstruct Node\n{\n\tdouble x,y;int col;\n}a[maxn];\nstruct Poly\n{\n\tchar op;\n\tint v,l;\n\tdouble x[36],y[36],r;\n\tdouble upper(double t)\n\t{\n\t\tif(op=='C')return y[0]+sqrt(max(0.0,r*r-(x[0]-t)*(x[0]-t)));\n\t\tdouble ret=-inf;\n\t\tfor(int i=1;i<l;i++)\n\t\t{\n\t\t\tif(eq(x[i],x[i+1])&&eq(x[i],t))ret=max(ret,max(y[i],y[i+1])); \n\t\t\telse if(x[i]<=t&&t<=x[i+1])ret=max(ret,y[i]+(t-x[i])/(x[i+1]-x[i])*(y[i+1]-y[i]));\n\t\t\telse if(x[i+1]<=t&&t<=x[i])ret=max(ret,y[i+1]+(t-x[i+1])/(x[i]-x[i+1])*(y[i]-y[i+1]));\n\t\t}\n\t\tif(eq(x[1],x[l])&&eq(x[1],t))ret=max(ret,max(y[1],y[l]));\n\t\telse if(x[l]<=t&&t<=x[1])ret=max(ret,y[l]+(t-x[l])/(x[1]-x[l])*(y[1]-y[l]));\n\t\telse if(x[1]<=t&&t<=x[l])ret=max(ret,y[1]+(t-x[1])/(x[l]-x[1])*(y[l]-y[1]));\n\t\treturn ret;\n\t}\n\tdouble lower(double t)\n\t{\n\t\tif(op=='C')return y[0]-sqrt(max(0.0,r*r-(x[0]-t)*(x[0]-t)));\n\t\tdouble ret=inf;\n\t\tfor(int i=1;i<l;i++)\n\t\t{\n\t\t\tif(eq(x[i],x[i+1])&&eq(x[i],t))ret=min(ret,min(y[i],y[i+1])); \n\t\t\telse if(x[i]<=t&&t<=x[i+1])ret=min(ret,y[i]+(t-x[i])/(x[i+1]-x[i])*(y[i+1]-y[i]));\n\t\t\telse if(x[i+1]<=t&&t<=x[i])ret=min(ret,y[i+1]+(t-x[i+1])/(x[i]-x[i+1])*(y[i]-y[i+1]));\n\t\t}\n\t\tif(eq(x[1],x[l])&&eq(x[1],t))ret=min(ret,min(y[1],y[l]));\n\t\telse if(x[l]<=t&&t<=x[1])ret=min(ret,y[l]+(t-x[l])/(x[1]-x[l])*(y[1]-y[l]));\n\t\telse if(x[1]<=t&&t<=x[l])ret=min(ret,y[1]+(t-x[1])/(x[l]-x[1])*(y[l]-y[1]));\n\t\treturn ret;\n\t}\n}po[maxn];\nint cur;\nstruct Oper\n{\n\tint op,id;double t;\n\tbool operator<(Oper x)const{return t==x.t?op<x.op:t<x.t;}\n}q[maxn];\nstruct FHQ\n{\n\tint rt,cur,siz[maxn],fa[maxn],lc[maxn],rc[maxn],id[maxn],op[maxn];\n\tint newnode(int i,int o){cur++;siz[cur]=1;id[cur]=i;op[cur]=o;return cur;}\n\tvoid maintain(int o){siz[o]=siz[lc[o]]+siz[rc[o]]+1;}\n\tint merge(int x,int y)\n\t{\n\t\tif((!x)||(!y))return x+y;\n\t\tif(rand()%(siz[x]+siz[y])<siz[x]){rc[x]=merge(rc[x],y);fa[rc[x]]=x;maintain(x);return x;}\n\t\telse{lc[y]=merge(x,lc[y]);fa[lc[y]]=y;maintain(y);return y;}\n\t}\n\tvoid split_siz(int o,int k,int&x,int&y)\n\t{\n\t\tif(!o){x=y=0;return;}\n\t\tif(k<=siz[lc[o]]){y=o;fa[lc[y]]=0;split_siz(lc[y],k,x,lc[y]);fa[lc[y]]=y;maintain(y);}\n\t\telse{x=o;fa[rc[x]]=0;split_siz(rc[x],k-siz[lc[o]]-1,rc[x],y);fa[rc[x]]=x;maintain(x);}\n\t}\n\tvoid split(int o,double t,double v,int&x,int&y)\n\t{\n\t\tif(!o){x=y=0;return;}\n\t\tdouble u;if(op[o]==1)u=po[id[o]].upper(t);else u=po[id[o]].lower(t);\n\t\tif(u>v){x=o;fa[rc[x]]=0;split(rc[x],t,v,rc[x],y);fa[rc[x]]=x;maintain(x);}\n\t\telse{y=o;fa[lc[y]]=0;split(lc[y],t,v,x,lc[y]);fa[lc[y]]=y;maintain(y);}\n\t}\n\tint rnk(int o)\n\t{\n\t\tint ret=siz[lc[o]]+1;\n\t\twhile(fa[o]){if(o==rc[fa[o]])ret+=siz[lc[fa[o]]]+1;o=fa[o];}\n\t\treturn ret;\n\t}\n\tint leftist(int o){while(lc[o])o=lc[o];return o;}\n}st;\nint cnt,h[maxn],nxt[maxn],p[maxn];\nvoid add_edge(int x,int y)\n{\n\tcnt++;\n\tnxt[cnt]=h[x];\n\th[x]=cnt;\n\tp[cnt]=y;\n}\nint fa[maxn],dep[maxn],siz[maxn],son[maxn],top[maxn],clk,dfn[maxn],rnk[maxn];\nvoid dfs1(int x,int f)\n{\n\tsiz[x]=1;\n\tfor(int j=h[x];j;j=nxt[j])if(p[j]!=f)\n\t{\n\t\tfa[p[j]]=x;\n\t\tdep[p[j]]=dep[x]+1;\n\t\tdfs1(p[j],x);\n\t\tsiz[x]+=siz[p[j]];\n\t\tif((!son[x])||(siz[p[j]]>siz[son[x]]))son[x]=p[j];\n\t}\n}\nvoid dfs2(int x,int t)\n{\n\ttop[x]=t;\n\tdfn[x]=++clk;rnk[clk]=x;\n\tif(son[x])dfs2(son[x],t);\n\tfor(int j=h[x];j;j=nxt[j])if(p[j]!=fa[x]&&p[j]!=son[x])dfs2(p[j],p[j]);\n}\nint sum[maxn];\n#define lc (o<<1)\n#define rc (o<<1|1)\nvoid update(int o,int l,int r,int x,int v)\n{\n\tif(l==r){sum[o]=v;return;}\n\tint mid=(l+r)>>1;\n\tif(x<=mid)update(lc,l,mid,x,v);\n\telse update(rc,mid+1,r,x,v);\n\tsum[o]=sum[lc]^sum[rc];\n}\nint query(int o,int l,int r,int ql,int qr)\n{\n\tif(r<ql||l>qr)return 0;\n\tif(ql<=l&&r<=qr)return sum[o];\n\tint mid=(l+r)>>1;\n\treturn query(lc,l,mid,ql,qr)^query(rc,mid+1,r,ql,qr); \n}\nint qdist(int x)\n{\n\tint ret=0;\n\twhile(x)\n\t{\n\t\tret^=query(1,1,n+1,dfn[top[x]],dfn[x]);\n\t\tx=fa[top[x]];\n\t}\n\treturn ret;\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\" %c\",&op);po[i].op=op;\n\t\tif(op=='C')scanf(\"%lf%lf%lf%d\",&po[i].x[0],&po[i].y[0],&po[i].r,&po[i].v),q[++cur]={1,i,po[i].x[0]-po[i].r},q[++cur]={2,i,po[i].x[0]+po[i].r};\n\t\tif(op=='P')\n\t\t{\n\t\t\tscanf(\"%d\",&po[i].l);\n\t\t\tdouble minx=inf,maxx=-inf;\n\t\t\tfor(int j=1;j<=po[i].l;j++)scanf(\"%lf%lf\",po[i].x+j,po[i].y+j),minx=min(minx,po[i].x[j]),maxx=max(maxx,po[i].x[j]);\n\t\t\tq[++cur]={1,i,minx};q[++cur]={2,i,maxx};\n\t\t\tscanf(\"%d\",&po[i].v);\n\t\t}\n\t}\n\ttid=0;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tscanf(\" %c\",&s[i].op);\n\t\tif(s[i].op=='Q')\n\t\t{\n\t\t\tscanf(\"%lf%lf%lf%lf\",&s[i].xa,&s[i].ya,&s[i].xb,&s[i].yb);\n\t\t\ts[i].aid=++tid;q[++cur]={3,tid,s[i].xa};a[tid]={s[i].xa,s[i].ya};\n\t\t\ts[i].bid=++tid;q[++cur]={3,tid,s[i].xb};a[tid]={s[i].xb,s[i].yb};\n\t\t}\n\t\telse scanf(\"%d%d\",&s[i].id,&s[i].v);\n\t}\n\tsort(q+1,q+cur+1);\n\tfor(int i=1;i<=cur;i++)\n\t{\n\t\tif(q[i].op==1)\n\t\t{\n\t\t\tdouble v=po[q[i].id].upper(q[i].t);\n\t\t\tint a,b,c,d;\n\t\t\tst.split(st.rt,q[i].t,v,a,c);\n\t\t\tif(!st.siz[c])fa[q[i].id]=n+1;\n\t\t\telse\n\t\t\t{\n\t\t\t\td=st.leftist(c);\n\t\t\t\tif(st.op[d]==1)fa[q[i].id]=fa[st.id[d]];\n\t\t\t\telse fa[q[i].id]=st.id[d];\n\t\t\t}\n\t\t\tadd_edge(q[i].id,fa[q[i].id]);add_edge(fa[q[i].id],q[i].id);\n\t\t\tb=st.merge(st.newnode(q[i].id,1),st.newnode(q[i].id,2));\n\t\t\tnm[q[i].id][1]=st.cur-1;nm[q[i].id][2]=st.cur;\n\t\t\tst.rt=st.merge(st.merge(a,b),c);\n\t\t}\n\t\telse if(q[i].op==2)\n\t\t{\n\t\t\tint a,b,c,d;\n\t\t\td=st.rnk(nm[q[i].id][1]);\n\t\t\tst.split_siz(st.rt,d-1,a,b);\n\t\t\tst.split_siz(b,1,b,c);\n\t\t\tst.rt=st.merge(a,c);\n\t\t\td=st.rnk(nm[q[i].id][2]);\n\t\t\tst.split_siz(st.rt,d-1,a,b);\n\t\t\tst.split_siz(b,1,b,c);\n\t\t\tst.rt=st.merge(a,c);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdouble v=a[q[i].id].y;\n\t\t\tint A,B,C;\n\t\t\tst.split(st.rt,q[i].t,v,A,B);\n\t\t\tif(!st.siz[B])a[q[i].id].col=n+1;\n\t\t\telse\n\t\t\t{\n\t\t\t\tC=st.leftist(B);\n\t\t\t\tif(st.op[C]==1)a[q[i].id].col=fa[st.id[C]];\n\t\t\t\telse a[q[i].id].col=st.id[C];\n\t\t\t}\n\t\t\tst.rt=st.merge(A,B);\n\t\t}\n\t}\n\tdep[n+1]=1;dfs1(n+1,0);dfs2(n+1,n+1);\n\tfor(int i=1;i<=n;i++)update(1,1,n+1,dfn[i],po[i].v);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tif(s[i].op=='Q')printf(\"%d\\n\",lst^=(qdist(a[s[i].aid].col)^qdist(a[s[i].bid].col)));\n\t\telse update(1,1,n+1,dfn[s[i].id],s[i].v);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1600351326,
        "uid": 43486,
        "name": "hsfzLZH1",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5843 \u3010[SCOI2012]Blinker \u7684\u5669\u68a6\u3011"
    },
    {
        "content": "\u4e00\u9053\u5f3a\u884c\u4e8c\u5408\u4e00\u9898\u3002\n\n\u9996\u5148\u6839\u636e\u9898\u76ee\u4e2d\u56fe\u5f62\u4e0d\u4ea4\u7684\u6027\u8d28\uff0c\u60f3\u5230\u5efa\u6811\uff0c\u6bcf\u4e2a\u56fe\u5f62\u7684\u7236\u4eb2\u8868\u793a\u5305\u542b\u5176\u7684\u6700\u5c0f\u56fe\u5f62\u3002\n\n\u5efa\u6811\u7684\u8fc7\u7a0b\u53ef\u4ee5\u7528\u626b\u63cf\u7ebf\u3002\n\n\u4e00\u6761\u4e0e $y$ \u8f74\u5e73\u884c\u7684\u76f4\u7ebf\u4e0e\u67d0\u4e2a\u56fe\u5f62\u81f3\u591a\u6709\u4e24\u4e2a\u4ea4\u70b9\uff0c\u5176\u4e2d $y$ \u5750\u6807\u5c0f\u7684\u6240\u6709\u70b9\u79f0\u4e3a\u4e0a\u8fb9\u754c\uff0c$y$ \u5750\u6807\u5927\u7684\u79f0\u4e3a\u4e0b\u8fb9\u754c\u3002\n\n\u7ed9\u5b9a\u76f4\u7ebf\u7684 $x$ \u5750\u6807\u5982\u4f55\u6c42\u4ea4\u70b9\u7684\u7eb5\u5750\u6807\uff1f\u5706\u53ef\u4ee5\u76f4\u63a5\u5957\u89e3\u6790\u5f0f\uff0c\u591a\u8fb9\u5f62\u53ef\u4ee5\u679a\u4e3e\u6bcf\u6761\u8fb9\u5224\u65ad\uff0c\u6216\u8005\u4e8c\u5206\u3002\u6b64\u9898\u70b9\u6570\u4e0d\u8d85\u8fc7 $34$ \u6240\u4ee5\u4ee3\u7801\u4e2d\u662f\u679a\u4e3e\u3002\n\n\u4ece\u5de6\u5230\u53f3\u626b\u63cf\uff0c\u5728\u4e00\u4e2a\u56fe\u5f62\u7684\u5de6\u7aef\u70b9\u52a0\u5165\u4e0a\u4e0b\u8fb9\u754c\uff0c\u53f3\u7aef\u70b9\u5220\u9664\u3002\n\n\u6839\u636e\u56fe\u5f62\u4e0d\u4ea4\u7684\u6027\u8d28\uff0c\u6c42\u4e00\u4e2a\u56fe\u5f62\u7684\u7236\u4eb2\u76f8\u5f53\u4e8e\u6c42\u5176\u67d0\u4e2a\u9876\u70b9\u6240\u5728\u7684\u6700\u5c0f\u56fe\u5f62\u3002\n\n\u5c06\u6240\u6709\u8fb9\u754c\u6309 $y$ \u5750\u6807\u6392\u5e8f\uff0c\u4e8c\u5206\u627e\u5230\u8fd9\u4e2a\u70b9\u4e0b\u65b9\u7684\u7b2c\u4e00\u4e2a\u8fb9\u754c\u3002\u5982\u679c\u662f\u56fe\u5f62 $i$ \u7684\u4e0a\u8fb9\u754c\uff0c\u5219\u6240\u6c42\u4e3a $fa_i$\uff1b\u5982\u679c\u662f\u4e0b\u8fb9\u754c\uff0c\u5219\u6240\u6c42\u4e3a $i$\u3002\n\n\u9700\u8981\u652f\u6301\u63d2\u5165\u5220\u9664\u6c42\u540e\u7ee7\uff0c\u7528 set \u5b9e\u73b0\u3002\n\n\u5efa\u51fa\u6811\u4e4b\u540e\uff0c\u95ee\u9898\u8f6c\u5316\u4e3a\u5355\u70b9\u4fee\u6539\uff0c\u6c42\u67d0\u4e2a\u70b9\u5230\u6839\u8def\u5f84\u5f02\u6216\u548c\u3002\n\n\u6c42\u524d\u7f00\u5f02\u6216\u4e4b\u540e\uff0c\u76f8\u5f53\u4e8e\u5b50\u6811\u5f02\u6216\u4e00\u4e2a\u503c\uff0c\u5355\u70b9\u67e5\u8be2\uff0cdfs \u5e8f + \u6811\u72b6\u6570\u7ec4\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((nl+m)\\log n)$ \u6216\u8005 $O((n\\log l+m)\\log n)$\uff0c\u53d6\u51b3\u4e8e\u6c42\u4ea4\u70b9\u7684\u65b9\u5f0f\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nusing db=double;\nconst db eps=1e-7;\nconst int N=1e5+3,M=N*3;\ndb w,u;\nstruct C{//\u5706\n\tdb x,y,r;\n\tvoid in(){scanf(\"%lf%lf%lf\",&x,&y,&r),r=max(r,eps);}\n\tdb up(){return y-sqrt(abs(r*r-(x-w)*(x-w)));}\n\tdb dn(){return y+sqrt(abs(r*r-(x-w)*(x-w)));}\n};\nstruct P{//\u591a\u8fb9\u5f62\n\tint l;db x[37],y[37];\n\tvoid in(){\n\t\tscanf(\"%d\",&l);\n\t\tfor(int i=0;i<l;++i)scanf(\"%lf%lf\",x+i,y+i);\n\t\tx[l]=x[0],y[l]=y[0];\n\t}\n\tdb up(){\n\t\tdb r=1e99;\n\t\tfor(int i=0;i<l;++i)if((x[i]-eps<w&&x[i+1]+eps>w)||(x[i+1]-eps<w&&x[i]+eps>w))r=min(r,abs(x[i]-x[i+1])<eps?min(y[i],y[i+1]):(y[i+1]-y[i])/(x[i+1]-x[i])*(w-x[i])+y[i]);\n\t\treturn r;\n\t}\n\tdb dn(){\n\t\tdb r=-1e99;\n\t\tfor(int i=0;i<l;++i)if((x[i]-eps<w&&x[i+1]+eps>w)||(x[i+1]-eps<w&&x[i]+eps>w))r=max(r,abs(x[i]-x[i+1])<eps?max(y[i],y[i+1]):(y[i+1]-y[i])/(x[i+1]-x[i])*(w-x[i])+y[i]);\n\t\treturn r;\n\t}\n};\nstruct G{//\u56fe\u5f62\n\tbool o;C c;P p;\n\tvoid in(){char t;scanf(\" %c\",&t),t=='C'?c.in():(o=1,p.in());}\n\tdb up(){return o?p.up():c.up();}\n\tdb dn(){return o?p.dn():c.dn();}\n}g[N];\ndb get(int x){return x<M?(x<N?g[x].up():g[x-N].dn()):u;}\nstruct cmp{\n\tbool operator()(int x,int y)const{\n\t\tif(x+N==y||y+N==x)return x<y;\n\t\treturn get(x)<get(y);\n\t}\n};\nstruct D{//\u70b9\n\tdb x,y;int id,o;\n\tbool operator<(D a)const{return x<a.x;}\n}d[M];\nstruct Q{bool o;int u,v;}q[N];//\u8be2\u95ee\nset<int,cmp>s;\nint v[N],sv[N],fa[N],n,id,l[N],r[N],t[N];\nbasic_string<int>e[N];\nvoid dfs(int x){for(int i:e[x])l[i]=++id,sv[i]=sv[x]^v[i],dfs(i),r[i]=id+1;}\nvoid add(int x,int v){for(;x<=n;x+=x&-x)t[x]^=v;}\nint sum(int x){int r=0;for(;x;x-=x&-x)r^=t[x];return r;}//\u6811\u72b6\u6570\u7ec4\u90e8\u5206\nint main(){\n\tint m,i,j,k,t=0,ans=0;\n\tchar c;\n\tdb x0,y0,x1,y1;\n\tscanf(\"%d%d\",&n,&m),g[0].c.r=1e99;\n\tfor(i=1;i<=n;++i)if(g[i].in(),scanf(\"%d\",v+i),g[i].o){\n\t\tfor(j=0,x0=1e99,x1=-1e99;j<g[i].p.l;++j){\n\t\t\tif(x0>g[i].p.x[j])x0=g[i].p.x[j],y0=g[i].p.y[j];\n\t\t\tif(x1<g[i].p.x[j])x1=g[i].p.x[j],y1=g[i].p.y[j];\n\t\t}\n\t\td[++t]={x0,y0,i,0},d[++t]={x1,y1,i,3};\n\t}else d[++t]={g[i].c.x-g[i].c.r,g[i].c.y,i,0},d[++t]={g[i].c.x+g[i].c.r,g[i].c.y,i,3};\n\tfor(i=1;i<=m;++i)if(scanf(\" %c\",&c),c=='Q')scanf(\"%lf%lf%lf%lf\",&x0,&y0,&x1,&y1),d[++t]={x0,y0,i,1},d[++t]={x1,y1,i,2};\n\telse q[i].o=1,scanf(\"%d%d\",&q[i].u,&q[i].v);\n\tfor(sort(d+1,d+t+1),s.insert(0),s.insert(N),i=1;i<=t;++i)if(k=d[i].id,d[i].o>2)s.erase(k),s.erase(k+N);else{\n\t\tw=d[i].x,u=d[i].y,j=*s.upper_bound(M),j=j<N?fa[j]:j-N;\n\t\tif(!d[i].o)fa[k]=j,e[j]+=k,s.insert(k),s.insert(k+N);\n\t\telse if(d[i].o==1)q[k].u=j;else q[k].v=j;\n\t}//\u626b\u63cf\u7ebf\u90e8\u5206\n\tfor(dfs(0),i=1;i<=m;++i)if(q[i].o)j=q[i].u,k=q[i].v^v[j],v[j]=q[i].v,add(l[j],k),add(r[j],k);\n\telse printf(\"%d\\n\",ans^=sv[q[i].u]^sv[q[i].v]^sum(l[q[i].u])^sum(l[q[i].v]));\n\treturn 0;\n}\n```\n",
        "postTime": 1629191093,
        "uid": 221955,
        "name": "panyf",
        "ccfLevel": 10,
        "title": "P5843 [SCOI2012]Blinker \u7684\u5669\u68a6\uff08\u626b\u63cf\u7ebf\uff09"
    }
]