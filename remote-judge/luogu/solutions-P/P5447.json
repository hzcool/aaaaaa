[
    {
        "content": "# **\u3010\u9898\u89e3\u3011\u8d5b\u8247 [THUPC2018] [P5447]**\n\n[$\\mathcal{My}\\ \\mathcal{Blog}$](https://www.cnblogs.com/Xing-Ling/p/12380495.html)\n\n\u4f20\u9001\u95e8\uff1a[\u8d5b\u8247 $\\text{[THUPC2018] [P5447]}$](https://www.luogu.com.cn/problem/P5447)\n\n## **\u3010\u9898\u76ee\u63cf\u8ff0\u3011**\n\n\u7ed9\u51fa\u4e00\u4e2a\u53ea\u5305\u542b $01$ \u7684\u5927\u77e9\u9635\u548c\u4e00\u957f\u4e32\u8fd0\u52a8\u8f68\u8ff9\uff0c\u6c42\u8be5\u8f68\u8ff9\u5728\u5927\u77e9\u9635\u4e2d\u53ea\u8986\u76d6 $0$ \u7684\u5408\u6cd5\u5b89\u653e\u4f4d\u7f6e\u4e2a\u6570\u3002\n\n## **\u3010\u5206\u6790\u3011**\n\n\u4e00\u9053 $\\text{FFT}$ \u505a\u5b57\u7b26\u4e32\u5339\u914d\u7684\u6c34\u9898\uff08\u6ca1\u60f3\u5230 $\\text{THU}$ \u4e5f\u4f1a\u6709\u6211\u8fd9\u4e2a\u849f\u84bb\u80fd\u505a\u7684\u9898\u76ee QAQ\uff09\u3002\n\n\u8fd8\u4e0d\u4f1a\u8fd9\u79cd\u5957\u8def\u7684\u5f3a\u70c8\u5efa\u8bae\u53bb\u5eb7\u5eb7[\u8fd9\u4e2a](https://www.luogu.com.cn/blog/Ebola-Emperor/solution-p4173)\uff0c\u4fdd\u51c6\u4e00\u904d\u770b\u61c2\u3002\n\n\u8003\u8651\u5148\u5c06\u8fd0\u52a8\u8f68\u8ff9\u5bf9\u5e94\u7684\u653e\u5230\u5927\u77e9\u9635\u7684\u5de6\u4e0a\u89d2\uff08\u8d70\u8fc7\u7684\u4f4d\u7f6e\u8bbe\u4e3a $1$\uff0c\u5176\u4ed6\u4e3a $0$\uff09\uff0c\u6bd4\u5982\u6837\u4f8b\uff1a  \n![](https://cdn.luogu.com.cn/upload/image_hosting/1ocpw3jh.png)\n\n\u7136\u540e\u628a\u5927\u77e9\u9635\u548c\u8fd0\u52a8\u8f68\u8ff9\u5206\u522b\u6298\u53e0\u6210\u4e00\u7ef4\u6570\u7ec4 $f,g$\uff0c\u6309\u7167\u5957\u8def\u5377\u8d77\u6765\u5373\u53ef\uff0c\u5177\u4f53\u5b9e\u73b0\u5982\u4e0b\uff1a\n\n\u8bbe $PA(st)=\\sum_{i=1}^{n \\times m}f(st+i-1)g(i)$\uff0c\u7ffb\u8f6c $g$ \u5f97\u5230\uff1a$PA(st)=\\sum_{i=1}^{n \\times m}f(st+i-1)g(n \\times m-i+1)$ $=\\sum_{i+j=st+n \\times m}f(i)g(j)$\uff0c\u5f53 $PA(st)=0$ \u65f6\u53ef\u77e5 $st$ \u4e3a\u4e00\u4e2a\u5408\u6cd5\u5339\u914d\u7684\u8d77\u70b9\u3002\n\n\u4e3a\u4ec0\u4e48\u5bf9\u4e00\u7ef4\u5339\u914d\u6570\u7ec4\u8dd1\u5339\u914d\u5c31\u662f\u5bf9\u7684\u5462\uff1f\n\n\u611f\u89c9\u8d77\u6765\u4e0d\u592a\u597d\u7406\u89e3\uff0c\u753b\u4e2a\u56fe\u77ac\u95f4\u5c31\u61c2\u4e86\uff0c\u5982\u4e0b\uff08\u9ed1\u8272\u4e3a\u5927\u77e9\u9635\uff0c\u84dd\u8272\u4e3a\u8f68\u8ff9\u77e9\u9635\uff0c\u77e9\u9635\u4e2d\u7684\u6570\u5b57\u4e3a\u5bf9\u5e94\u5728\u4e00\u7ef4\u6570\u7ec4\u4e2d\u7684\u7f16\u53f7\uff0c\u5047\u8bbe\u5b9e\u9645\u8fd0\u52a8\u8f68\u8ff9\u53ea\u7ecf\u8fc7\u4e86\u84dd\u8272\u6570\u5b57 $\\{1,2,3,5,6,7\\}$\uff09\uff1a  \n![](https://cdn.luogu.com.cn/upload/image_hosting/osiyz314.png)\n\n\u5728\u4e0a\u56fe\u4e2d\uff0c\u5339\u914d\u8d77\u70b9 $st$ \u4e3a $(2,2)$\uff0c\u5bf9\u5e94\u4e00\u7ef4\u7f16\u53f7\u4e3a $6$\uff0c\u5982\u679c\u6839\u636e\u4e0a\u9762\u7684 $PA$ \u5b9a\u4e49\u5f0f\u6765\u770b\uff0c\u8f68\u8ff9\u77e9\u9635\u4e2d\u7684 $\\{1,2,3,4,5,6,7\\}$ \u5206\u522b\u4e0e\u5927\u77e9\u9635\u4e2d\u7684 $\\{6,7,8,9,10,11,12\\}$ \u8fdb\u884c\u4e86\u5339\u914d\uff0c\u5176\u4e2d\u53ea\u6709\u84dd\u8272\u8d8a\u754c\u6570\u5b57 $4$ \u5bf9\u5e94\u4e86\u9ed1\u8272\u8d8a\u754c\u6570\u5b57 $9$\uff0c\u800c\u5269\u4e0b\u7684 $\\{1,2,3,5,6,7\\}$ \u5339\u914d\u60c5\u51b5\u90fd\u4e0e\u4e0a\u56fe\u5b8c\u5168\u543b\u5408\u3002\n\n\u7531\u4e8e\u6211\u4eec\u5224\u65ad\u77e9\u9635\u662f\u5426\u5339\u914d\u53ea\u7528\u5173\u6ce8\u672a\u8d8a\u754c\u5408\u6cd5\u70b9\uff0c\u56e0\u6b64\u53ef\u4ee5\u8bc1\u660e\u4e0a\u8ff0\u505a\u6cd5\u662f\u6b63\u786e\u7684\u3002\n\n\u6ce8\u610f\u8fd8\u6709\u4e00\u4e2a\u5c0f\u95ee\u9898\uff1a\u5fc5\u987b\u8981\u4fdd\u8bc1\u8f68\u8ff9\u77e9\u9635\u7684\u5408\u6cd5\u70b9\uff08\u5373 $1$\uff09\u5168\u90e8\u5728\u5927\u77e9\u9635\u4ee5\u5185\u3002\u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7\u6539\u53d8 $st$ \u7684\u679a\u4e3e\u8303\u56f4\u6765\u5b9e\u73b0\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a\uff1a$O(nm\\log (nm))$ \u3002\n\n## **\u3010Code\u3011**\n\n```cpp\n#include<algorithm>\n#include<cstring>\n#include<cstdio>\n#define LL long long\n#define Re register int\nusing namespace std;\nconst int N=8388608+3,P=998244353,G=3,inf=2e9;char ch[5000003];\nint n,m,T,ans,invG,minx=1,miny=1,maxx,maxy,f[N],g[N],tr[N];\ninline void in(Re &x){\n    int f=0;x=0;char c=getchar();\n    while(c<'0'||c>'9')f|=c=='-',c=getchar();\n    while(c>='0'&&c<='9')x=(x<<1)+(x<<3)+(c^48),c=getchar();\n    x=f?-x:x;\n}\ninline int mi(Re x,Re k){\n    Re s=1;\n    while(k){\n        if(k&1)s=(LL)s*x%P;\n        x=(LL)x*x%P,k>>=1;\n    }\n    return s;\n}\ninline int inv(Re x){return mi(x,P-2);}\ninline void NTT(Re *f,Re n,Re op){\n    for(Re i=0;i<n;++i)if(i<tr[i])swap(f[i],f[tr[i]]);\n    for(Re p=2;p<=n;p<<=1){\n        Re len=p>>1,w1=mi(op?invG:G,(P-1)/p);\n        for(Re st=0;st<n;st+=p)\n            for(Re j=st,base=1;j<=st+len-1;++j){\n                Re tmp=(LL)base*f[j+len]%P;\n                f[j+len]=(f[j]-tmp+P)%P,(f[j]+=tmp)%=P;\n                base=(LL)base*w1%P;\n            }\n    }\n}\ninline void sakura(Re *f,Re n,Re *g,Re m){//\u5377\u5377\u5377\n    for(m+=n,n=1;n<=m;n<<=1);Re invn=inv(n);\n    for(Re i=1;i<n;++i)tr[i]=(tr[i>>1]>>1)|((i&1)?n>>1:0);\n    NTT(f,n,0),NTT(g,n,0);\n    for(Re i=0;i<n;++i)f[i]=(LL)f[i]*g[i]%P;\n    NTT(f,n,1);\n    for(Re i=0;i<=m;++i)f[i]=(LL)f[i]*invn%P;\n}\ninline int Poi(Re i,Re j){return (i-1)*m+j;}\ninline void move(Re &x,Re &y,char op){x+=(op=='s')-(op=='w'),y+=(op=='d')-(op=='a');}\nint main(){\n//    freopen(\"123.txt\",\"r\",stdin);\n    in(n),in(m),in(T),invG=inv(G);\n    for(Re i=1;i<=n;++i){\n        scanf(\"%s\",ch+1);\n        for(Re j=1;j<=m;++j)f[Poi(i,j)]=(ch[j]=='1');\n    }\n    scanf(\"%s\",ch+1);\n    for(Re i=1,x=1,y=1;i<=T;++i)\n        move(x,y,ch[i]),minx=min(minx,x),miny=min(miny,y);//\u83b7\u53d6\u6700\u5c0f\u5750\u6807minx,miny\u5f97\u5230\u76f8\u5bf9\u5dee\u503ccx,cy\n    Re cx=1-minx,cy=1-miny;g[n*m-Poi(maxx=1+cx,maxy=1+cy)+1]=1;//\u6ce8\u610f\u8d77\u70b9\u522b\u5fd8\u4e86\n    for(Re i=1,x=1+cx,y=1+cy;i<=T;++i)\n        move(x,y,ch[i]),maxx=max(maxx,x),maxy=max(maxy,y),g[n*m-Poi(x,y)+1]=1;//\u83b7\u53d6\u6700\u5927\u5750\u6807maxx,maxy\u65b9\u4fbf\u5224\u65ad\u8d8a\u754c\n    sakura(f,n*m,g,n*m);\n    for(Re i=1;i<=n-maxx+1;++i)\n        for(Re j=1;j<=m-maxy+1;++j)\n            ans+=(f[Poi(i,j)+n*m]==0);\n    printf(\"%d\\n\",ans);\n}\n```\n",
        "postTime": 1582898908,
        "uid": 110985,
        "name": "\u8fb0\u661f\u51cc",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5447 \u3010[THUPC2018]\u8d5b\u8247\u3011"
    }
]