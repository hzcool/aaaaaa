[
    {
        "content": "\u8fd9\u79cd\u505a\u6cd5\u57fa\u4e8e\u8fd9\u4e2a\u4e8b\u5b9e\uff1a\u5e73\u9762\u4e0a $n$ \u4e2a\u4e0d\u91cd\u70b9\u7ec4\u6210\u7684\u7b49\u8170\u4e09\u89d2\u5f62\u4e2a\u6570\u662f $O(n^{2.137})$ \u7ea7\u522b\u7684\uff08[\u8bc1\u660e\u5728\u8fd9\u91cc](https://link.springer.com/article/10.1007/s003730200063)\uff09\n\n\u90a3\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u4e00\u4e2a\u70b9\u4e3a\u6781\u70b9\uff0c\u7136\u540e\u628a\u6240\u6709\u70b9\u6309\u7167\u79bb\u6781\u70b9\u7684\u8ddd\u79bb\u6392\u5e8f\uff0c\u7136\u540e\u79bb\u6781\u70b9\u8ddd\u79bb\u76f8\u540c\u7684\u70b9\u5206\u6210\u4e00\u7ec4\u3002\u6211\u4eec\u5982\u679c\u679a\u4e3e\u7ec4\u5185\u70b9\u5bf9\u7684\u8bdd\uff0c\u662f\u4e0d\u4f1a $O(n^3)$ \u7684\u3002\n\n\u8fd9\u6837\u7684\u8bdd\u8fd9\u4e2a\u9898\u5c31\u6bd4\u8f83\u7b80\u5355\u4e86\uff1a\u6211\u4eec\u5148\u679a\u4e3e\u6bcf\u4e2a\u70b9\u4f5c\u4e3a $A$ \u70b9\uff0c\u7136\u540e\u679a\u4e3e\u7ec4\u5185\u70b9\u5bf9\uff0c\u8fdb\u800c\u6c42\u51fa\u6bcf\u4e2a $BC$ \u7ebf\u6bb5\u5de6\u9762\u3001\u53f3\u9762\u7684 $A$ \u70b9\u4e2a\u6570\u3002\n\n\u7136\u540e\u6211\u4eec\u518d\u679a\u4e3e\u6bcf\u4e2a\u70b9\u4f5c\u4e3a $D$ \u70b9\uff0c\u7ee7\u7eed\u679a\u4e3e\u7ec4\u5185\u70b9\u5bf9 $(B, C)$ \uff0c\u7136\u540e\u628a\u76f4\u7ebf $AD$ \u63d2\u5165\u6781\u89d2\u5e8f\u6392\u5e8f\uff08\u6240\u6709\u5408\u6cd5\u7684 $A$ \u90fd\u5728 $BC$ \u7684\u4e2d\u5782\u7ebf\u4e0a\uff09\u3002\u6700\u540e\u518d\u679a\u4e3e\u7ec4\u5185\u70b9\u5bf9 $(E, F)$ \uff0c\u5408\u6cd5\u7684\u76f4\u7ebf $AD$ \u7684\u6781\u89d2\u8303\u56f4\u662f\u4e00\u4e2a\u533a\u95f4\uff0c\u4e8c\u5206\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6\u662f $O(n^2 \\log n +n^{2.137})$ \uff08\u597d\u7384\u5b66\n\n[\u4ee3\u7801\u5728\u8fd9\u91cc](https://paste.ubuntu.com/p/jKwsnhgTPr/)",
        "postTime": 1554880031,
        "uid": 31564,
        "name": "zhoutb2333",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5286 \u3010[HNOI2019]\u9c7c\u3011"
    },
    {
        "content": "[\u5728\u535a\u5ba2\u67e5\u770b](https://www.cnblogs.com/chenxiaoran666/p/Luogu5286.html)\n\n**\u5927\u81f4\u9898\u610f\uff1a** \u7ed9\u4f60$n$\u4e2a\u70b9\uff0c\u8ba9\u4f60\u6c42\u9c7c\u5f62\u56fe\u7684\u6570\u91cf\u3002\n\n### \u6838\u5fc3\u601d\u8def\n\n\u9996\u5148\uff0c\u8003\u8651\u5230$n$\u8fd9\u4e48\u5c0f\uff0c\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u7ebf\u6bb5$AD$\uff0c\u518d\u53bb\u627e\u7b26\u5408\u6761\u4ef6\u7684$BC,EF$\u3002\n\n\u7136\u540e\uff0c\u4e0d\u96be\u53d1\u73b0$BC$\u4e0e$EF$\u4e92\u4e0d\u5f71\u54cd\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5206\u5f00\u6c42\u5bf9\u4e8e\u5df2\u77e5$AD$\u7684$BC$\u4e0e$EF$\u7684\u65b9\u6848\u6570\uff0c\u7136\u540e\u5c06\u5176\u76f8\u4e58\u3002\n\n\u90a3\u4e48\u6211\u4eec\u73b0\u5728\u7684\u95ee\u9898\u5c31\u5728\u4e8e\uff0c\u5982\u4f55\u6c42\u51fa$BC$\u4e0e$EF$\u7684\u65b9\u6848\u6570\u4e86\u3002\n\n### $BC$\u7684\u65b9\u6848\u6570\n\n#### \u9884\u5904\u7406\n\n\u8003\u8651\u5230$AB=AC,BD=CD$\uff0c\u7528\u6211\u8fd9\u70b9\u53ef\u601c\u7684\u521d\u4e2d\u6570\u5b66\u77e5\u8bc6\uff0c\u90fd\u80fd\u8bc1\u660e\u51fa$AD$\u5782\u76f4\u5e73\u5206$BC$\uff08\u8c8c\u4f3c\u4f5c\u4e1a\u91cc\u8fd8\u505a\u8fc7\u8fd9\u79cd\u9898\u76ee\uff09\u3002\n\n\u5219\uff0c\u6211\u4eec\u53ef\u4ee5\u6362\u4e00\u4e2a\u89d2\u5ea6\uff0c\u5982\u679c\u679a\u4e3e$BC$\uff0c\u90a3\u4e48\u7b26\u5408\u6761\u4ef6\u7684$AD$\u5fc5\u7136\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff1a\n\n- $\\because BC\\bot AD,\\therefore BC$\u4e0e$AD$\u7684\u659c\u7387\u76f8\u4e58\u4e3a$-1$\u3002\n- $\\because AD$\u5e73\u5206$BC,\\therefore AD$\u5fc5\u7136\u7ecf\u8fc7$BC$\u7684\u4e2d\u70b9\u3002\n\n\u800c\u5df2\u77e5\u659c\u7387\u548c\u76f4\u7ebf\u4e0a\u4e00\u70b9\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u63a8\u51fa\u8fd9\u6761\u76f4\u7ebf\u7684\u89e3\u6790\u5f0f\u5566\uff01\n\n\u8bbe$B(x_B,y_B),C(x_C,y_C)$\uff0c\u5219$BC$\u659c\u7387\u4e3a$\\frac{y_C-y_B}{x_C-x_B}$,$\\therefore AD$\u659c\u7387\u4e3a\uff1a\n\n$$-1\u00f7\\frac{y_C-y_B}{x_C-x_B}=\\frac{x_B-x_C}{y_C-y_B}$$\n\n\u53c8$\\because BC$\u4e2d\u70b9$G$\u5750\u6807\u4e3a$(\\frac{x_B+x_C}2,\\frac{y_B+y_C}2),\\therefore AD$\u622a\u8ddd\u4e3a\uff1a\n\n$$\\frac{x_B-x_C}{y_C-y_B}*\\frac{x_B+x_C}2-\\frac{y_B+y_C}2=\\frac{(x_B-x_C)(x_B+x_C)-(y_C-y_B)(y_B+y_C)}{2(y_C-y_B)}$$\n\n\u8fd9\u6837\u5176\u5b9e\u6211\u4eec\u5df2\u7ecf\u6c42\u51fa\u4e86$AD$\u7684\u659c\u7387\u548c\u622a\u8ddd\uff0c\u4f46\u5982\u679c\u4f60\u50cf\u6211\u4e00\u6837\u65e0\u804a\uff0c\u53ef\u4ee5\u770b\u4e00\u4e0b\u6211\u5bf9\u4e8e\u8fd9\u91cc\u622a\u8ddd\u7684\u8fdb\u4e00\u6b65\u5316\u7b80\u3002\n\n------\n\n\u8fd9\u4e2a\u622a\u8ddd\u7684\u5f0f\u5b50\u663e\u5f97\u8fc7\u4e8e\u5197\u957f\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u518d\u8f6c\u5316\u4e00\u4e0b\u5f97\u5230\uff1a\n\n$$\\frac{(x_B-x_C)(x_B+x_C)-(y_C-y_B)(y_B+y_C)}{2(y_C-y_B)}=\\frac{(x_B-x_C)(x_B+x_C)+(y_B-y_C)(y_B+y_C)}{2(y_C-y_B)}=\\frac {x_{B-C}*x_{B+C}+y_{B-C}*y_{B+C}}{2(y_C-y_B)}$$\n\n\u5176\u4e2d\uff0c$B-C,B+C$\u7686\u4e3a\u5411\u91cf\u3002\n\n\u7136\u540e\uff0c\u4e86\u89e3\u4e00\u4e9b\u8ba1\u7b97\u51e0\u4f55\u516c\u5f0f\u7684\u4eba\u5c31\u53ef\u4ee5\u53d1\u73b0\uff0c$x_{B-C}*x_{B+C}+y_{B-C}*y_{B+C}$\u5176\u5b9e\u662f\u4e00\u4e2a\u70b9\u79ef\u7684\u5f62\u5f0f\uff01\n\n\u4e8e\u662f\u6211\u4eec\u6700\u540e\u5f97\u5230\u4e00\u4e2a\u7b80\u5355\u7684\u5f0f\u5b50\uff1a\n\n$$\\frac{(B-C)\\cdot(B+C)}{2(y_C-y_B)}$$\n\n------\n\n\u800c\u6c42\u51fa\u4e86\u659c\u7387\u548c\u622a\u8ddd\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u76f8\u5f53\u4e8e\u6c42\u51fa\u4e86$AD$\u7684\u51fd\u6570\u8868\u8fbe\u5f0f\u3002\n\n\u5219\u53ef\u4ee5\u8003\u8651\u628a$AD$\u51fd\u6570\u8868\u8fbe\u5f0f\u76f8\u540c\u7684$BC$\u7684\u4fe1\u606f\u5168\u90e8\u6254\u5165\u540c\u4e00\u4e2a$vector$\u5b58\u50a8\u4e0b\u6765\uff0c\u65b9\u4fbf\u540e\u9762\u6c42\u7b54\u6848\u3002\n\n\u8fd8\u6709\u8981\u6ce8\u610f\u7684\u5c31\u662f\u5bf9\u4e8e$B,C$\u4e24\u70b9$y$\u76f8\u7b49\u7684\u60c5\u51b5\u8981\u7279\u5224\uff0c\u56e0\u4e3a\u6b64\u65f6$AD$\u5c31\u4e0d\u662f\u4e00\u6b21\u51fd\u6570\u4e86\u3002\n\n#### \u6c42\u7b54\u6848\n\n\u679a\u4e3e$AD$\u65f6\uff0c\u6211\u4eec\u9996\u5148\u5c31\u662f\u6c42\u51fa$AD$\u7684\u51fd\u6570\u8868\u8fbe\u5f0f\uff0c\u7136\u540e\u5230\u5bf9\u5e94$vector$\u91cc\u53bb\u6c42\u7b54\u6848\u3002\n\n\u6b64\u65f6\uff0c\u6211\u4eec\u4e3b\u8981\u662f\u8981\u6ee1\u8db3\u9898\u76ee\u4e2d\u7ed9\u51fa\u7684\u201c$\u2220BAD,\u2220BDA$\u4e0e$\u2220CAD,\u2220CDA$\u90fd\u662f\u9510\u89d2\u201d\u7684\u8981\u6c42\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u7ebf\u6bb5$AD$\u9700\u8981\u4e0e\u7ebf\u6bb5$BC$\u6709\u4ea4\u70b9\u3002\n\n\u6211\u4eec\u5148\u524d\u5df2\u7ecf\u63d0\u8fc7\u8981\u5f00$vector$\uff0c\u4f46\u5176\u5b9e\u4e0d\u9700\u8981\u76f4\u63a5\u5b58\u4e0b$BC$\uff0c\u56e0\u4e3a\u8fd9\u6837\u4e0d\u592a\u65b9\u4fbf\u3002\n\n\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u53ea\u8981\u5b58\u4e0b\u4e2d\u70b9\u67d0\u4e00\u5750\u6807\u7684\u4e24\u500d\uff08\u4e24\u500d\u662f\u4e3a\u4e86\u53ef\u4ee5\u76f4\u63a5\u7528$int$\u5b58\u50a8\uff09\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728$vector$\u4e2d\u901a\u8fc7$upper\\_bound$\u7684\u65b9\u5f0f\uff0c\u5206\u522b\u7528$A,D$\u4e24\u70b9\u7684\u76f8\u5e94\u5750\u6807\u67e5\u627e\u51fa\u4e24\u4e2a\u8303\u56f4\uff0c\u7136\u540e\u5229\u7528\u524d\u7f00\u548c\u601d\u60f3\u6765\u7528\u5927\u7684\u51cf\u5c0f\u7684\u5373\u53ef\u5f97\u51fa\u7b54\u6848\u3002\n\n\u81f3\u4e8e\u5e94\u8be5\u9009\u62e9\u54ea\u4e00\u5750\u6807\uff0c\u9700\u8981\u6839\u636e\u5177\u4f53\u51fd\u6570\u89e3\u6790\u5f0f\u6765\u5206\u6790\u4e86\u3002\n\n\u5982\u5f62\u5982$x=a$\u7684\u8868\u8fbe\u5f0f\u5fc5\u987b\u9009\u7eb5\u5750\u6807\uff0c\u5f62\u5982$y=a$\u7684\u8868\u8fbe\u5f0f\u5fc5\u987b\u9009\u6a2a\u5750\u6807\uff08\u56e0\u4e3a\u56fa\u5b9a\u7684\u65e0\u6cd5\u5224\uff09\uff0c\u5426\u5219\u4efb\u9009\u3002\n\n\u4e0d\u8fc7\u53cd\u6b63\u6211\u4eec\u8981\u7279\u5224$B,C$\u7eb5\u5750\u6807\u76f8\u7b49\uff0c\u5373$A,D$\u6a2a\u5750\u6807\u76f8\u7b49\u7684\u60c5\u51b5\uff0c\u5219\u6211\u4eec\u5e72\u8106\u5bf9\u4e8e\u6a2a\u5750\u6807\u76f8\u7b49\u7684\u53d6\u7eb5\u5750\u6807\uff0c\u4e0d\u76f8\u7b49\u7684\u53d6\u6a2a\u5750\u6807\uff0c\u4e5f\u65b9\u4fbf\u6211\u4eec\u5224\u65ad\u5e94\u7528\u54ea\u4e2a\u5750\u6807\u53bb$upper\\_bound$\u3002\n\n\u8fd9\u4e00\u8fc7\u7a0b\u6709\u4e00\u5b9a\u7ec6\u8282\uff0c\u5177\u4f53\u5b9e\u73b0\u8be6\u89c1\u4ee3\u7801\u3002\n\n### $EF$\u7684\u65b9\u6848\u6570\n\n\u5bf9\u4e8e\u8fd9\u4e2a\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\uff0c\u8fc7\u70b9$D$\u4f5c$AD$\u7684\u5782\u7ebf$l$\uff0c\u5219\u6211\u4eec\u5c06\u6574\u4e2a\u5e73\u9762\u5212\u5206\u6210\u4e86\u4e24\u4e2a\u534a\u5e73\u9762\uff0c\u800c\u6839\u636e\u9898\u76ee\u8981\u6c42\uff0c\u70b9$E,F$\u5fc5\u987b\u5728\u70b9$A$\u6240\u4e0d\u5728\u7684\u90a3\u4e2a\u534a\u5e73\u9762\u5185\u3002\n\n\u5219\u5982\u679c\u6211\u4eec\u679a\u4e3e\u70b9$D$\uff0c\u7136\u540e\u5c06\u5176\u4f59\u70b9\u6309\u6781\u89d2\u6392\u5e8f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528**\u53cc\u6307\u9488**\uff0c\u6765\u7ef4\u62a4\u5bf9\u4e8e\u6bcf\u4e2a\u70b9$A$\u53ef\u80fd\u4f5c\u4e3a\u70b9$E,F$\u7684\u6240\u6709\u70b9\u3002\n\n\u90a3\u4e48\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4e24\u4e2a\u70b9\u624d\u80fd\u4f5c\u4e3a\u4e00\u5bf9\u70b9$E,F$\u5462\uff1f\n\n\u6b63\u5982\u9898\u76ee\u4e2d\u8bf4\u7684\uff0c\u9700\u8981$DE=DF$\u3002\n\n\u56e0\u6b64\u6211\u4eec\u5f00\u4e2a$map$\uff0c\u7ef4\u62a4\u6bcf\u79cd\u5230\u70b9$D$\u7684\u8ddd\u79bb\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u7528\u7c7b\u4f3c\u4e8e\u83ab\u961f\u7684\u65b9\u5f0f\u8fdb\u884c\u7ef4\u62a4\u4e86\uff0c\u8fd9\u5e94\u8be5\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u3002\n\n\u6ce8\u610f\uff0c\u8fd9\u91cc\u6211\u5bf9\u4e8e\u76f8\u540c\u7684\u4e24\u4e2a\u70b9\u53ea\u7edf\u8ba1\u4e86\u4e00\u6b21\uff0c\u56e0\u4e3a\u6700\u540e\u6211\u5c06\u7b54\u6848\u4e58\u4e0a\u4e86$4$\uff0c\u5373$BC,EF$\u4e92\u6362\u7684\u60c5\u51b5\u3002\n\n\u8fd9\u4e00\u8fc7\u7a0b\u540c\u6837\u6709\u4e00\u5b9a\u7ec6\u8282\uff0c\u5177\u4f53\u5b9e\u73b0\u8be6\u89c1\u4ee3\u7801\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define Tp template<typename Ty>\n#define Ts template<typename Ty,typename... Ar>\n#define Reg register\n#define RI Reg int\n#define RL Reg LL\n#define Con const\n#define CI Con int&\n#define CL Con LL&\n#define I inline\n#define W while\n#define N 1000\n#define LL long long\n#define DB long double\n#define eps 1e-10\n#define swap(x,y) (x^=y^=x^=y)\nusing namespace std;\nint n,val[N+5][N+5];Con DB Pi=acos(-1); \nTp I Ty gcd(Con Ty& x,Con Ty& y) {return y?gcd(y,x%y):x;}\nstruct Fr//\u5b58\u50a8\u4e00\u4e2a\u5206\u6570\n{\n\tLL x,y;I Fr(CL a=0,CL b=1) {RL g=gcd(a,b);x=a/g,(y=b/g)<0&&(x=-x,y=-y);}//\u6ce8\u610f\u7ea6\u5206\n\tI bool operator != (Con Fr& o) Con {return x^o.x||y^o.y;}//\u4e0d\u7b49\u4e8e\n\tI bool operator < (Con Fr& o) Con {return x^o.x?x<o.x:y<o.y;}//\u8fd9\u4e2a\u5c0f\u4e8e\u4e0d\u662f\u771f\u7684\u5c0f\u4e8e\uff0c\u53ea\u662f\u7528\u4e8e\u533a\u5206\u4e0d\u540c\u5206\u6570\u6765\u5b58\u50a8\u5230map\u4e2d\n};\nstruct Line//\u5b58\u50a8\u4e00\u6761\u76f4\u7ebf\uff0c\u53ea\u5b58\u659c\u7387\u548c\u622a\u8ddd\n{\n\tFr Slope,Incre;I Line(Con Fr& s=Fr(),Con Fr& i=Fr()):Slope(s),Incre(i){}\n\tI bool operator < (Con Line& o) Con {return Slope!=o.Slope?Slope<o.Slope:Incre<o.Incre;}//\u7528\u4e8e\u533a\u5206\n};\nstruct Point//\u5b58\u50a8\u4e00\u4e2a\u70b9\n{\n\t#define Dot(A,B) (1LL*(A).x*(B).x+1LL*(A).y*(B).y)//\u70b9\u79ef\n\t#define Cro(A,B) (1LL*(A).x*(B).y-1LL*(A).y*(B).x)//\u53c9\u79ef\n\t#define Len(A) Dot(A,A)//\u6c42\u51fa\u957f\u5ea6\u7684\u5e73\u65b9\uff0c\u4e4b\u6240\u4ee5\u4e0d\u5f00\u653e\u662f\u4e3a\u9632\u70b8\u7cbe\u5ea6\uff0c\u800c\u4e14\u4e0d\u5f71\u54cd\u6bd4\u5927\u5c0f\n\tint x,y;I Point(CI a=0,CI b=0):x(a),y(b){}\n\tI Point operator + (Con Point& o) Con {return Point(x+o.x,y+o.y);}//\u70b9\u76f8\u52a0\n\tI Point operator - (Con Point& o) Con {return Point(x-o.x,y-o.y);}//\u70b9\u76f8\u51cf\n}p[N+5];\nstruct Data//\u5b58\u50a8\u6781\u89d2\u548c\u5bf9\u5e94\u70b9\u7f16\u53f7\u7528\u4e8e\u6392\u5e8f\n{\n\tint pos;DB ang;I Data(CI p=0,Con DB& a=0):pos(p),ang(a){}\n\tI bool operator < (Con Data& o) Con {return ang<o.ang;}\n}s[N<<1];\nmap<Line,int> pos;vector<int> v[N*N+5];map<LL,int> cnt;\nint main()\n{\n\tRI i,j,x,y,z,tot,Pc=0,H,T;RL ans=0;Line w;Point t;\n\tfor(scanf(\"%d\",&n),i=1;i<=n;++i) scanf(\"%d%d\",&x,&y),p[i]=Point(x,y);\n\tfor(i=1;i<=n;++i) for(j=i+1;j<=n;++j)\n\t{\n\t\tif(p[i].y==p[j].y)//\u7279\u5224y\u76f8\u7b49\n\t\t{\n\t\t\tw=Line(Fr(1,0),Fr(p[i].x+p[j].x,2)),//\u6c42\u51fa\u622a\u8ddd\n\t\t\tv[pos.count(w)?pos[w]:pos[w]=++Pc].push_back(p[i].y<<1);//\u5b58\u50a8\u4e2d\u70b9\u7eb5\u5750\u6807\u4e24\u500d\n\t\t\tcontinue;\n\t\t}\n\t\tt=p[j]-p[i],w=Line(Fr(-t.x,t.y),Fr(Dot(t,p[i]+p[j]),2LL*t.y)),//\u6c42\u51fa\u659c\u7387\u548c\u622a\u8ddd\n\t\tv[pos.count(w)?pos[w]:pos[w]=++Pc].push_back(p[i].x+p[j].x);//\u5b58\u50a8\u4e2d\u70b9\u6a2a\u5750\u6807\u4e24\u500d\n\t}\n\tfor(i=1;i<=Pc;++i) sort(v[i].begin(),v[i].end());//\u6392\u5e8f\uff0c\u7528\u4e8e\u4e4b\u540e\u7684upper_bound\n\tfor(i=1;i<=n;++i)//\u679a\u4e3e\u70b9D\n\t{\n\t\tfor(tot=0,j=1;j<=n;++j) i^j&&(s[++tot]=Data(j,atan2(p[j].y-p[i].y,p[j].x-p[i].x)),0);//\u5b58\u4e0b\u6781\u89d2\n\t\tfor(sort(s+1,s+n),j=1;j^n;++j) (s[j+n-1]=s[j]).ang+=2*Pi;//\u6392\u5e8f\uff0c\u7136\u540e\u5c06\u6bcf\u4e2a\u70b9\u590d\u5236\u4e00\u4efd\uff0c\u65b9\u4fbf\u540e\u9762\u7684\u53cc\u6307\u9488\n\t\tfor(cnt.clear(),tot=H=T=0,j=1;j^n;++j)//\u53cc\u6307\u9488\n\t\t{\n\t\t\tW(s[T+1].ang<s[j].ang+1.5*Pi-eps) ++T,tot+=cnt[Len(p[s[T].pos]-p[i])]++;//\u52a0\u5165\u65b0\u8fdb\u5165\u534a\u5e73\u9762\u7684\u70b9\n\t\t\tW(s[H+1].ang<s[j].ang+0.5*Pi+eps) ++H,tot-=--cnt[Len(p[s[H].pos]-p[i])];//\u5220\u9664\u65b0\u79bb\u5f00\u534a\u5e73\u9762\u7684\u70b9\n\t\t\tval[s[j].pos][i]=tot;//\u8bb0\u4e0b\u7ed3\u679c\n\t\t}\n\t}\n\tfor(i=1;i<=n;++i) for(j=i+1;j<=n;++j)//\u679a\u4e3eAD\n\t{\n\t\tp[i].x^p[j].x?(x=p[i].x,y=p[j].x):(x=p[i].y,y=p[j].y),x>y&&swap(x,y),t=p[i]-p[j],//\u6c42\u51fa\u5f53\u524d\u60c5\u51b5\u4e0b\u5bf9\u5e94\u54ea\u79cd\u5750\u6807\n\t\tw=(p[i].x^p[j].x?Line(Fr(t.y,t.x),Fr(Cro(t,p[i]),t.x)):Line(Fr(1,0),Fr(p[i].x,1))),//\u6c42\u51fa\u89e3\u6790\u5f0f\n\t\t#define UB(x) upper_bound(v[z].begin(),v[z].end(),x)\n\t\tpos.count(w)&&(z=pos[w],ans+=(UB((y<<1)-1)-UB(x<<1))*(val[i][j]+val[j][i]));//\u5982\u679c\u8be5\u89e3\u6790\u5f0f\u5b58\u5728\uff0c\u66f4\u65b0\u7b54\u6848\n\t}return printf(\"%lld\",ans<<2),0;//\u6ce8\u610f\u5c06\u7b54\u6848\u4e584\n}\n```",
        "postTime": 1555649405,
        "uid": 28382,
        "name": "TheLostWeak",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5286 \u3010[HNOI2019]\u9c7c\u3011"
    },
    {
        "content": "\u5728\u535a\u5ba2\u56ed\u98df\u7528\u66f4\u4f73\uff1a[https://www.cnblogs.com/PinkRabbit/p/HNOI2019D1T1.html](https://www.cnblogs.com/PinkRabbit/p/HNOI2019D1T1.html)\u3002\n\n### \u9898\u610f\u7b80\u8ff0\n\n\u7565\u3002\n\n### \u9898\u89e3\n\n\u9c7c\u5c3e\u548c\u9c7c\u8eab\u5206\u5f00\u8003\u8651\u3002\n\n\u8003\u8651\u56fa\u5b9a $D$ \u70b9\uff0c\u5176\u5b83\u70b9\u6309\u7167\u6781\u89d2\u6392\u5e8f\u3002\n\n\u6309\u7167\u6781\u89d2\u5e8f\u679a\u4e3e $A$ \u70b9\uff0c\u7136\u540e\u53cc\u6307\u9488\uff0c\u53ef\u4ee5\u7b97\u51fa\u5bf9\u4e8e\u6bcf\u4e2a $A$ \u53ef\u884c\u7684\u9c7c\u5c3e\u6570\u91cf\uff08$AD$ \u65b9\u5411\u4e3a\u534a\u5e73\u9762\u7684\u6cd5\u5411\u91cf\u65b9\u5411\uff0c\u534a\u5e73\u9762\u4e2d\u7684\u70b9\u6309\u7167\u4e0e $D$ \u7684\u8ddd\u79bb\u5206\u7c7b\u7edf\u8ba1\uff09\u3002\n\n\u7136\u540e\u518d\u8003\u8651\u786e\u5b9a $B, C$\uff0c\u9996\u5148\u53ef\u4ee5\u53d1\u73b0 $BC \\perp AD$\uff0c\u6240\u4ee5\u5148\u83b7\u53d6\u8981\u6c42\u7684 $BC$ \u7684\u659c\u7387\u4fe1\u606f\u3002\n\n\u5728 $\\mathcal O (n^2)$ \u7684\u65f6\u95f4\u5185\u9884\u5904\u7406\u51fa\u6bcf\u4e00\u5bf9 $BC$ \u5e76\u6309\u7167\u659c\u7387\u5206\u7c7b\uff0c\u5177\u4f53\u53ef\u4ee5\u7528\u6700\u7b80\u5206\u6570\u5b58\u50a8\u3002\n\n\u5728\u6bcf\u4e00\u7c7b\u4e2d\u518d\u4ee5\u4e2d\u70b9\u6240\u5728\u76f4\u7ebf\u5206\u7c7b\uff0c\u90a3\u4e48\u4e2d\u70b9\u5fc5\u987b\u5728 $AD$ \u4e0a\uff0c\u627e\u5230\u90a3\u4e00\u7c7b\u540e\u518d\u4f7f\u7528\u4e8c\u5206\u53ef\u4ee5\u83b7\u5f97\u5408\u6cd5\u7684 $BC$ \u6570\u91cf\u3002\n\n\u4e0e\u9c7c\u5c3e\u76f8\u4e58\u540e\u76f8\u52a0\uff0c\u518d\u4e58\u4ee5 $4$ \u5373\u53ef\u5f97\u5230\u7b54\u6848\u3002\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n#include <vector>\n#include <tuple>\n#include <map>\n\ntypedef long long LL;\n\ninline LL Abs(LL x) { return x < 0 ? -x : x; }\nLL Gcd(LL a, LL b) { return b ? Gcd(b, a % b) : a; }\n\nstruct Vec {\n\tLL x, y;\n\tVec() { x = y = 0; }\n\tVec(LL _x, LL _y) { x = _x, y = _y; }\n};\ninline bool operator < (Vec a, Vec b) { return a.x == b.x ? a.y < b.y : a.x < b.x; }\ninline Vec operator + (Vec a, Vec b) { return Vec(a.x + b.x, a.y + b.y); }\ninline Vec operator - (Vec a, Vec b) { return Vec(a.x - b.x, a.y - b.y); }\ninline Vec operator * (LL a, Vec b) { return Vec(a * b.x, a * b.y); }\ninline LL operator * (Vec a, Vec b) { return a.x * b.x + a.y * b.y; }\ninline LL operator / (Vec a, Vec b) { return a.x * b.y - a.y * b.x; }\ninline LL len(Vec a) { return a * a; }\ninline Vec Rotate(Vec a) { return Vec(-a.y, a.x); }\n\ntypedef std::pair<std::pair<LL, LL>, LL> plll;\nconst int MN = 1005, MS = 499505;\n\nint N, Cnt;\nVec P[MN];\nstd::map<plll, int> Num;\nstd::vector<Vec> D[MS];\nVec S[MN * 2];\nstd::map<LL, int> Buk;\nLL Ans;\n\ninline void getABC(Vec A, Vec B, LL &a, LL &b, LL &c) {\n\ta = B.y - A.y, b = B.x - A.x, c = A / B;\n\tLL d = Gcd(Abs(a), Gcd(Abs(b), Abs(c)));\n\ta /= d, b /= d, c /= d;\n\tif (a < 0 || (a == 0 && b < 0)) a = -a, b = -b, c = -c;\n}\n\nint main() {\n\tscanf(\"%d\", &N);\n\tfor (int i = 1; i <= N; ++i) scanf(\"%lld%lld\", &P[i].x, &P[i].y);\n\tfor (int j = 2; j <= N; ++j)\n\t\tfor (int i = 1; i < j; ++i) {\n\t\t\tVec A = P[i], B = P[j], C = A + B;\n\t\t\tVec tA = C + Rotate(2 * A - C);\n\t\t\tVec tB = C + Rotate(2 * B - C);\n\t\t\tLL a, b, c;\n\t\t\tgetABC(tA, tB, a, b, c);\n\t\t\tint &val = Num[{{a, b}, c}];\n\t\t\tif (!val) val = ++Cnt;\n\t\t\tD[val].push_back(C);\n\t\t}\n\tfor (int i = 1; i <= Cnt; ++i) std::sort(D[i].begin(), D[i].end());\n\tfor (int u = 1; u <= N; ++u) {\n\t\tint M = 0;\n\t\tfor (int i = 1; i <= N; ++i) if (i != u) S[++M] = P[i] - P[u];\n\t\tstd::sort(S + 1, S + M + 1, [&](Vec i, Vec j) {\n\t\t\tint zi = i.y > 0 || (i.y == 0 && i.x > 0);\n\t\t\tint zj = j.y > 0 || (j.y == 0 && j.x > 0);\n\t\t\tif (zi == zj) return i / j > 0;\n\t\t\treturn zi < zj;\n\t\t});\n\t\tfor (int i = 1; i <= M; ++i) S[M + i] = S[i];\n\t\tLL Sum = 0;\n\t\tint lb = 1, rb = 0;\n\t\tBuk.clear();\n\t\tfor (int i = 1; i <= M; ++i) {\n\t\t\twhile (rb < i + M - 1) {\n\t\t\t\tVec R = S[rb + 1];\n\t\t\t\tif (R * S[i] >= 0 && (R / S[i] > 0 || (R / S[i] == 0 && rb >= M))) break;\n\t\t\t\tSum += Buk[len(R)]++;\n\t\t\t\t++rb;\n\t\t\t}\n\t\t\twhile (lb <= i + M - 1) {\n\t\t\t\tVec R = S[lb];\n\t\t\t\tif (R * S[i] < 0 || (R / S[i] > 0 || (R / S[i] == 0 && lb > M))) break;\n\t\t\t\tSum -= --Buk[len(R)];\n\t\t\t\t++lb;\n\t\t\t}\n\t\t\tVec A = P[u], B = S[i] + P[u];\n\t\t\tif (B < A) std::swap(A, B);\n\t\t\tLL a, b, c, Val = 0;\n\t\t\tgetABC(2 * A, 2 * B, a, b, c);\n\t\t\tplll p = {{a, b}, c};\n\t\t\tif (Num.find(p) != Num.end()) {\n\t\t\t\tauto V = D[Num[p]];\n\t\t\t\tVal = std::lower_bound(V.begin(), V.end(), 2 * B) - std::upper_bound(V.begin(), V.end(), 2 * A);\n\t\t\t}\n\t\t\tAns += Sum * Val;\n\t\t}\n\t}\n\tprintf(\"%lld\\n\", Ans * 4);\n\treturn 0;\n}\n```",
        "postTime": 1585575167,
        "uid": 10703,
        "name": "\u5c0f\u7c89\u5154",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5286 \u3010[HNOI2019]\u9c7c\u3011"
    },
    {
        "content": "\u663e\u7136\u679a\u4e3eA\uff0cD\uff0c\u7136\u540e\u9c7c\u5934\u548c\u9c7c\u8eab\u5206\u5f00\u6765\u8003\u8651\u3002\n\n\u9c7c\u8eab\uff1a\u5148\u679a\u4e3eB,C\uff0c\u90a3\u4e48BC\u7684\u4e2d\u70b9\u4e00\u5b9a\u5728\u7ebf\u6bb5AD\uff08\u4e0d\u5305\u542b\u7aef\u70b9\uff09\u4e0a\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u6761\u76f4\u7ebf\u7ef4\u62a4\u4e00\u4e2avector\u5b58\u6240\u6709\u7684\u70b9\uff0c\u5c06\u8fd9\u4e2aBC\u7684\u4e2d\u70b9\u63d2\u5165\u8fdb\u7ebf\u6bb5BC\u7684\u5782\u76f4\u5e73\u5206\u7ebf\u7684vector\uff0c\u7136\u540e\u5bf9\u4e8e\u4e00\u7ec4AD\uff0c\u9c7c\u8eab\u7684\u65b9\u6848\u6570\u662fvector\u4e0aAD\u4e2d\u95f4\u7684\u70b9\u6570\uff0c\u53ef\u4ee5\u7528upper_bound\u6c42\u3002\n\n\u9c7c\u5c3e\uff1a\u679a\u4e3eD\uff0c\u5bf9\u6240\u6709\u5176\u4ed6\u70b9\u6781\u89d2\u6392\u5e8f\uff0c\u7528\u53cc\u6307\u9488\u626b\u4e00\u904d\u6240\u6709\u70b9\u5373\u53ef\u3002\u5177\u4f53\u96be\u4ee5\u63cf\u8ff0\u8bf7\u76f4\u63a5\u770b\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define il inline\n#define rg register\n#define vd void\n#define ll long long\nil int gi(){\n    int x=0,f=0;char ch=getchar();\n    while(!isdigit(ch))f^=ch=='-',ch=getchar();\n    while(isdigit(ch))x=x*10+ch-'0',ch=getchar();\n    return f?-x:x;\n}\nint n;\ntemplate<class T>il T gcd(T a,T b){return b?gcd(b,a%b):a;}\nstruct number{\n    ll x,y;\n    number(){}\n    number(const ll&a,const ll&b){\n        ll g=gcd(llabs(a),llabs(b));\n        x=a/g,y=b/g;\n        if(y<0)x=-x,y=-y;\n    }\n};\nil bool operator<(const number&a,const number&b){\n    if(a.x^b.x)return a.x<b.x;\n    return a.y<b.y;\n}\nil bool operator!=(const number&a,const number&b){return a.x!=b.x||a.y!=b.y;}\nstruct line{number k,b;};\nil bool operator<(const line&a,const line&b){\n    if(a.k!=b.k)return a.k<b.k;\n    return a.b<b.b;\n}\nstd::map<line,int>M;int cnt;\nint x[1010],y[1010];\nstruct yyb{int i;double at2;}s[2010];\nil bool operator<(const yyb&a,const yyb&b){return a.at2<b.at2;}\nstd::vector<int>vec[1000010];\nil ll getdist(int a,int b){\n    return 1ll*(x[a]-x[b])*(x[a]-x[b])+1ll*(y[a]-y[b])*(y[a]-y[b]);\n}\nint tail[1010][1010];\nstd::map<ll,int>mmp;\nint res,nowi;\nconst double eps=1e-10,pi=acos(-1);\nil vd insert(int x){res+=mmp[getdist(nowi,x)]++;}\nil vd delet(int x){res-=--mmp[getdist(nowi,x)];}\nint main(){\n    //freopen(\"fish.in\",\"r\",stdin);\n    //freopen(\"fish.out\",\"w\",stdout);\n    n=gi();\n    for(int i=1;i<=n;++i)x[i]=gi(),y[i]=gi();\n    for(int i=1;i<=n;++i)\n        for(int j=i+1;j<=n;++j)\n            if(y[i]==y[j]){\n                if(x[i]+x[j]&1)continue;\n                number k=(number){1,0},b=(number){(x[i]+x[j])/2,1};\n                if(M.find((line){k,b})==M.end())M[(line){k,b}]=++cnt;\n                vec[M[(line){k,b}]].push_back(y[i]*2);\n            }else{\n                number k=(number){x[i]-x[j],y[j]-y[i]},b=(number){-1ll*(x[i]-x[j])*(x[i]+x[j])+1ll*(y[j]-y[i])*(y[j]+y[i]),2ll*(y[j]-y[i])};\n                if(M.find((line){k,b})==M.end())M[(line){k,b}]=++cnt;\n                vec[M[(line){k,b}]].push_back(x[i]==x[j]?x[i]*2:y[i]+y[j]);\n            }\n    for(int i=1;i<=n;++i){\n        int m=0;\n        for(int j=1;j<=n;++j)if(j!=i)s[++m]=(yyb){j,atan2(y[j]-y[i],x[j]-x[i])};\n        std::sort(s+1,s+m+1);\n        for(int i=1;i<=m;++i)s[i+m]=s[i],s[i+m].at2+=pi*2;\n        mmp.clear();\n        res=0;nowi=i;\n        for(int j=1,p=0,q=0;j<=m;++j){\n            while(s[p+1].at2+eps<s[j].at2+1.5*pi)insert(s[++p].i);\n            while(s[q+1].at2<s[j].at2+0.5*pi+eps)delet(s[++q].i);\n            tail[s[j].i][i]=res;\n        }\n    }\n    for(int i=1;i<=cnt;++i)std::sort(vec[i].begin(),vec[i].end());\n    ll ans=0;\n    for(int i=1;i<=n;++i)\n        for(int j=i+1;j<=n;++j){\n            int xa=y[i],xb=y[j];\n            if(xa==xb)xa=x[i],xb=x[j];\n            if(xa>xb)std::swap(xa,xb);\n            number k,b;\n            if(x[i]==x[j])k=(number){1,0},b=(number){x[i],1};\n            else k=(number){y[i]-y[j],x[i]-x[j]},b=(number){-1ll*x[i]*(y[i]-y[j])+1ll*y[i]*(x[i]-x[j]),x[i]-x[j]};\n            if(M.find((line){k,b})==M.end())continue;\n            int veci=M[(line){k,b}];\n            ans+=(std::upper_bound(vec[veci].begin(),vec[veci].end(),xb*2-1)-std::upper_bound(vec[veci].begin(),vec[veci].end(),xa*2))*(tail[i][j]+tail[j][i]);\n        }\n    printf(\"%lld\\n\",ans*4);\n    return 0;\n}\n```",
        "postTime": 1554694856,
        "uid": 23118,
        "name": "\u03bb\u1d09\u028d",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5286 \u3010[HNOI2019]\u9c7c\u3011"
    },
    {
        "content": "## HNOI2019 \u9c7c \n\n\u663e\u7136\uff0c\u77e5\u9053AD\u90a3\u4e48BC\u548cEF\u53ef\u4ee5\u5206\u5f00\u7b97\u3002\n\n\u8003\u8651\u679a\u4e3eAD\u8fd9\u6761\u7ebf\uff0c\u90a3\u4e48\u659c\u7387\u548c\u622a\u8ddd\u76f8\u540c\u7684\u7ebf\u6211\u4eec\u53ef\u4ee5\u4e00\u8d77\u679a\u4e3e\uff08\u7528vector\uff09\u3002\u5e76\u4e14\u6ce8\u610f\u5230\u6bcf\u6761\u7ebf\u5bf9\u5e94\u7684\u4e2d\u5782\u7ebf\u53ea\u6709\u4e00\u6761\uff0c\u6211\u4eec\u53ef\u4ee5\u7528hash\u8868\u6765\u627e\u3002\u8003\u8651\u628a\u4e2d\u5782\u7ebf\u4e3aAD\u7684\u7ebf\uff08BC\uff09\u5bf9\u5e94\u5230\u8fd9\u6761\u7ebf\u4e0a\u53d8\u6210\u4e00\u4e2a\u70b9\uff0c\u52a0\u5165\u70b9\u96c6\uff0c\u6743\u503c\u4e3a0\uff0cAD\u8fd9\u6761\u7ebf\u4e0a\u7684\u70b9\u4e5f\u52a0\u5165\u5230\u70b9\u96c6\uff0c\u6743\u503c\u4e3a1\uff0c\u5e76\u4e14\u6309x\u548cy\u6392\u597d\u5e8f\uff0c\u90a3\u4e48\u6211\u4eec\u8981\u627e\u7684\u5c31\u662f\u5728\u6bcf\u4e2a1\u70b9\u4e4b\u524d\u7684\u6743\u503c\u5206\u522b\u4e3a10\u8fd9\u6837\u7684\u70b9\u5bf9\u4e2a\u6570\u518d\u4e58\u4e0a\u4ee5\u8fd9\u4e2a\u70b9\u4f5c\u4e3aD\u70b9\u7684EF\u7684\u7b54\u6848\u3002\n\n\u81f3\u4e8e10\u7684\u70b9\u5bf9\u4e2a\u6570\u600e\u4e48\u7b97\uff0c\u5b9a\u4e49$cnt1$\u662f1\u7684\u4e2a\u6570\uff0c$cnt0$\u662f10\u8fd9\u6837\u7684\u70b9\u5bf9\u4e2a\u6570\u3002\u6bcf\u9047\u52300\u5c31\u628acnt+=cnt1\uff0c\u9047\u52301\u5219cnt1++,\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e2a1\u4e4b\u524d\u768410\u70b9\u5bf9\u4e2a\u6570\u5c31\u662fcnt\u3002\n\n\u600e\u4e48\u8ba1\u7b97EF\u5462\uff1f\u6211\u4eec\u662f\u77e5\u9053AD\u8fd9\u6761\u7ebf\u7684\uff0c\u90a3\u4e48EF\u5bf9\u4e8eD\u7684\u6781\u89d2\u5c31\u5728\u4e00\u4e2a\u957f\u5ea6\u4e3a$\\pi$\u7684\u533a\u95f4\u91cc\uff08AD\u7684\u659c\u7387$\\pm\\frac \\pi 2$\u3002\u6211\u4eec\u628a\u6bcf\u4e2aD\u70b9\u7684\u8fd9\u4e9b\u9700\u8981\u7edf\u8ba1\u7684\u533a\u95f4\u79bb\u7ebf\u4e0b\u6765\uff0c\u7136\u540e\u6392\u597d\u5e8f\u5355\u8c03\u961f\u5217\u5373\u53ef\u3002\u8fd9\u91cc\u9762\u8fd8\u8981\u7528hash\u8868\u6216\u8005unordered_map\u6765\u5b58DE\uff08DF\uff09\u7684\u957f\u5ea6\uff0c\u8d21\u732e\u7ef4\u62a4\u6bcf\u4e2a\u957f\u5ea6\u51fa\u73b0\u6b21\u6570x\u7684$C(x,2)$\u4e4b\u548c\uff0c\u518d\u4e58\u4e0a\u79bb\u7ebf\u4e0b\u6765\u7684\u70b9\u5bf9\u4e2a\u6570\u3002\n\n\u6ce8\u610f\u6211\u4eec\u6309x\u548cy\u6392\u5e8f\uff0c\u4ece\u53f3\u5f80\u5de6\u548c\u4ece\u4e0a\u5f80\u4e0b\u7684\u9c7c\u4e0d\u4f1a\u88ab\u7b97\u5230\uff0c\u8fd8\u8981\u628a\u6bcf\u4e2a\u70b9\u6a2a\u7eb5\u5750\u6807\u53d6\u76f8\u53cd\u6570\u518d\u7b97\u4e00\u6b21\u3002\n\n\u6211WA\u8fd9\u4e48\u591a\u6b21\u4e3b\u8981\u662f\u7cbe\u5ea6\u95ee\u9898\uff0c\u8981\u591a\u8c03\u53c2\uff0c\u659c\u7387\u548c\u622a\u8ddd\u53ef\u4ee5\u75284\u4e2alonglong\u6765\u5b58\uff08\u5206\u5b50\u548c\u5206\u6bcd\uff09\u3002\u7279\u522b\u6ce8\u610f\u659c\u7387\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define db long double\n#define ll long long\n#define pr pair<ll,ll>\n#define pii pair<int,int>\n#define pdl pair<long double,ll>\n#define fi first\n#define se second\n#define mpr make_pair\n#define ull unsigned long long\n#define FOR(i,a,b) for(int i=a;i<=b;++i)\n#define ROF(i,a,b) for(int i=a;i>=b;++i)\nusing namespace std;\nll read(){\n\tll x=0,pos=1;char ch=getchar();\n\tfor(;!isdigit(ch);ch=getchar()) if(ch=='-') pos=0;\n\tfor(;isdigit(ch);ch=getchar()) x=(x<<1)+(x<<3)+ch-'0';\n\treturn pos?x:-x; \n} \nint n;\nconst int N =1021;\nstruct point{\n\tll x,y;\n\tpoint(ll x=0,ll y=0):x(x),y(y){} \n\tpoint operator -(point b){\n\t\treturn point(x-b.x,y-b.y);\n\t}\n\tll dis(){\n\t\treturn x*x+y*y;\n\t}\n}p[N];\nstruct EFP{\n\tlong double the;ll res;\n\tint operator < (EFP b){\n\t\treturn the<b.the;\n\t}\n}ef[N][N];\n\nint cnt=0;\nvector<pii>vec[1000021];\nll gcd(ll a,ll b){\n\treturn !b?a:gcd(b,a%b);\n}\nint vis[1021];\nconst ll mod1 = 998244353,mod2=1e9+7;\nconst ll base = 1331,ba2=31;\nstruct line{\n\tll kx,ky,bx,by;\n\tline(ll kx=0,ll ky=0,ll bx=0,ll by=0):kx(kx),ky(ky),bx(bx),by(by){}\n\tint hash(){\n\t\tll h1=(((kx*base%mod1+ky)%mod1*base+bx)%mod1*base+by)%mod1;\n\t\tll h2=(((kx*ba2%mod2+ky)%mod2*ba2+bx)%mod2*ba2+by)%mod2;\n\t\treturn (h2*100000000ll+h1)%4000000;\n\t}\n\tint operator == (line bb){\n\t\treturn kx==bb.kx&&ky==bb.ky&&bx==bb.bx&&by==bb.by;\n\t}\n};\nstruct NODE{\n\tint nex,cnt;line w;\n};\nstruct hash_table{\n\tNODE edge[4000021];\n\tint head[4000021],tup=0,nh[4000021],nt=0;\n\tvoid insert(line &now,int wi){\n\t\tint u=now.hash();\n\t\tif(!head[u]) nh[++nt]=u;\n\t\tedge[++tup].w=now;\n\t\tedge[tup].cnt=wi;\n\t\tedge[tup].nex=head[u];\n\t\thead[u]=tup;\n\t}\n\tint count(line &now){\n\t\tint u=now.hash();\n\t\tfor(int i=head[u];i;i=edge[i].nex){\n\t\t\tif(edge[i].w==now) return edge[i].cnt;\n\t\t}\n\t\treturn -1;\n\t}\n\tvoid clear(){\n\t\tfor(int i=1;i<=tup;i++){\n\t\t\tedge[i].nex=edge[i].cnt=0;edge[i].w=line(0,0,0,0);\n\t\t}tup=0;\n\t\tfor(int i=1;i<=nt;i++){\n\t\t\thead[nh[i]]=0;nh[i]=0;\n\t\t}nt=0;\n\t}\n}d,zd;\nint cntz=0;vector<pii>vecz[1000021];\ninline void getmin(ll &x,ll &y){\n\tif(x<0&&y<0) x*=-1ll,y*=-1ll;\n\tif(y>0&&x<0) y*=-1ll,x*=-1ll;\n\tif(x==0&&y==0){\n\t\treturn;\n\t}else if(y==0) return x=1,void();\n\telse if(x==0) return y=1,void(); \n\tll g=gcd(abs(y),abs(x));y/=g,x/=g;\n}\ninline line getline(ll dx,ll dy,ll sx,ll sy){\n\tgetmin(dx,dy);\n\tll by=sy*dx-sx*dy,bx=dx;\n\tgetmin(bx,by);\n\tif(dx==0) by=sx;\n\treturn line(dx,dy,bx,by);\n}\nstruct node{\n\tdb x,y;int col,id;\n\tnode(db x=0,db y=0,int col=0,int id=0):x(x),y(y),col(col),id(id){}\n}q[1021];int top=0;\nnode get_ty(int i,line now){\n\tif(now.kx==0){\n\t\treturn node(now.by,p[i].y,0,0);\n\t}\n\tlong double k=(long double)(now.ky)/now.kx,b=(long double)(now.by)/now.bx;\n\tlong double x0=p[i].x,y0=p[i].y;\n\tlong double x=(x0+y0*k-b*k)/(k*k+1.0),y=k*x+b;\n\treturn node(x,y,0,0);\n}\nline getiv(line now){\n\tswap(now.kx,now.ky);now.ky*=-1;\n\tif(now.ky>0&&now.kx<0) now.ky*=-1ll,now.kx*=-1ll;\n\tif(now.kx==0&&now.ky==0){\n\t\treturn now;\n\t}else if(now.ky==0) now.kx=1;\n\telse if(now.kx==0) return now.ky=1;\n\treturn now;\n}\nconst long double eps = 1e-2;\nint cmp0(node a,node b){\n\treturn fabs(a.x-b.x)<eps?fabs(a.y-b.y)<eps?a.col>b.col:a.y<b.y:a.x<b.x;\n}\nint cmp1(node a,node b){\n\treturn fabs(a.x-b.x)<eps?fabs(a.y-b.y)<eps?a.col<b.col:a.y>b.y:a.x<b.x;\n}\nvector<pdl> c[1021];\nll ans=0;\ninline void out(ll a){\n\tif(a>9 )out(a/10);\n\tputchar(a%10+'0');\n}\nvoid solve(int ord){\n\tFOR(i,1,n){\n\t\tFOR(j,1,n){\n\t\t\tif(i==j) continue;\n\t\t\tpoint tmp=(p[j]-p[i]);\n\t\t\tef[i][j-(j>i)].the=atan2(tmp.y,tmp.x);\n\t\t\tef[i][j-(j>i)].res=tmp.dis();\n\t\t}\n\t\tsort(ef[i]+1,ef[i]+n); \n\t}\n\tFOR(i,1,n){\n\t\tFOR(j,i+1,n){\n\t\t\tif(i==j) continue;\n\t\t\tll dy=(p[i].y-p[j].y),dx=(p[i].x-p[j].x);\n\t\t\tline now=getline(dx,dy,p[i].x,p[i].y);\n\t\t\tint nn=d.count(now);\n\t\t\tif(nn!=-1) vec[nn].push_back(mpr(i,j));\n\t\t\telse d.insert(now,++cnt),vec[cnt].push_back(mpr(i,j));\n\t\t\t\n\t\t\tnow.bx=(p[i].x+p[j].x)/2,now.by=(p[i].y+p[j].y)/2;\n\t\t\tnow=getline(-now.ky,now.kx,now.bx,now.by);\n\t\t\tnn=zd.count(now);\n\t\t\tif(nn!=-1) vecz[nn].push_back(mpr(i,j));\n\t\t\telse zd.insert(now,++cntz),vecz[cntz].push_back(mpr(i,j));\n\t\t}\n\t}\n\tfor(int i=1;i<=cnt;i++){\n\t\tint d1=vec[i][0].fi,d2=vec[i][0].se;\n\t\tll dy=(p[d1].y-p[d2].y),dx=(p[d1].x-p[d2].x);\n\t\tline now=getline(dx,dy,p[d1].x,p[d1].y);\n\t\ttop=0;\n\t\tfor(int j=0;j<vec[i].size();j++){\n\t\t\tif(!vis[vec[i][j].fi]) vis[vec[i][j].fi]=1,q[++top]=node(p[vec[i][j].fi].x,p[vec[i][j].fi].y,1,vec[i][j].fi);\n\t\t\tif(!vis[vec[i][j].se]) vis[vec[i][j].se]=1,q[++top]=node(p[vec[i][j].se].x,p[vec[i][j].se].y,1,vec[i][j].se);\n\t\t}\n\t\tint iv;\n\t\tint kk=zd.count(now);\n\t\tif(kk!=-1) iv=kk;\n\t\telse{\n\t\t\tfor(int j=0;j<vec[i].size();j++){\n\t\t\t\tvis[vec[i][j].fi]=0,vis[vec[i][j].se]=0;\n\t\t\t}\n\t\t\tcontinue;\n\t\t}\n\t\tfor(int j=0;j<vecz[iv].size();j++){\n\t\t\tif(!vis[vecz[iv][j].fi]) q[++top]=get_ty(vecz[iv][j].fi,now);\n\t\t\tvis[vecz[iv][j].fi]=1,vis[vecz[iv][j].se]=1;\n\t\t}\n\t\tfor(int j=0;j<vec[i].size();j++){\n\t\t\tvis[vec[i][j].fi]=0,vis[vec[i][j].se]=0;\n\t\t}\n\t\tfor(int j=0;j<vecz[iv].size();j++){\n\t\t\tvis[vecz[iv][j].fi]=0,vis[vecz[iv][j].se]=0;\n\t\t}\n\t\tsort(q+1,q+top+1,ord?cmp1:cmp0);\n\t\tll cntt=0,cnt1=0,res=0;\n\t\tdb pre=-1;int samep=0;\n\t\tfor(int j=1;j<=top;j++){\n\t\t\tif(now.kx!=0){\n\t\t\t\tif(fabs(q[j].x-pre)<eps) samep+=q[j].col;\n\t\t\t\telse pre=q[j].x,samep=q[j].col;\n\t\t\t}else{\n\t\t\t\tif(fabs(q[j].y-pre)<eps) samep+=q[j].col;\n\t\t\t\telse pre=q[j].y,samep=q[j].col;\n\t\t\t}\n\t\t\tif(q[j].col==0) cntt+=cnt1-samep;\n\t\t\telse{\n\t\t\t\tcnt1++;\n\t\t\t\tif(now.kx<0) now.kx*=-1,now.ky*=-1;\n\t\t\t\tlong double thi=atan2(now.ky,now.kx);\n\t\t\t\tif(now.kx==0){\n\t\t\t\t\tif(ord==0) thi=acos(-1)/2.0;\n\t\t\t\t\telse thi=-acos(-1)/2.0;\n\t\t\t\t}\n\t\t\t\tif(cntt){\n\t\t\t\t\tc[q[j].id].push_back(mpr(thi,cntt));\n\t\t\t\t//\tprintf(\"%d %d\\n\",i,q[j].id); \n\t\t\t\t} \n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tsort(c[i].begin(),c[i].end());\n\t\tlong double lm,rm;\n\t\tint l=1,r=0;\n\t\tll ri=0;unordered_map<ll,int>mp;\n\t\tfor(int j=0;j<c[i].size();j++){\n\t\t\tlm=c[i][j].fi-acos(-1)/2.0,rm=c[i][j].fi+acos(-1)/2.0;\n\t\t\twhile(r+1<n&&ef[i][r+1].the<rm-1e-10){\n\t\t\t\t\n\t\t\t\tr++;\n\t\t\t\tif(mp.count(ef[i][r].res)){\n\t\t\t\t\tll x=mp[ef[i][r].res];ri-=x*(x-1)/2ll;ri+=(x+1)*(x)/2ll;\n\t\t\t\t}\n\t\t\t\tmp[ef[i][r].res]++;//if(i==4)  //printf(\"%d %lld\\n\",r,ri);\n\t\t\t}\n\t\t\twhile(l<=r&&l<n&&ef[i][l].the<lm+1e-10){\n\t\t\t\tll x=mp[ef[i][l].res];ri-=x*(x-1)/2ll;ri+=(x-1)*(x-2)/2ll;\n\t\t\t\tmp[ef[i][l++].res]--;//if(i==4)  //printf(\"%d %lld\\n\",l,ri);\n\t\t\t}\n\t\t\tif(!ri||!c[i][j].se) continue;\n\t\t\tans+=4ll*ri*c[i][j].se;//printf(\"now:%d lm:%lf rm:%lf l:%d r:%d re:%d add:%lld\\n\",i,lm,rm,l,r,ri,4ll*ri*c[i][j].se);\n\t\t}\n\t\tc[i].clear();\n\t}\n\tfor(int i=1;i<=cnt;i++){\n\t\tvec[i].clear();\n\t}cnt=0;\n\tfor(int i=1;i<=cntz;i++){\n\t\tvecz[i].clear();\n\t}cntz=0;memset(ef,0,sizeof ef);memset(q,0,sizeof(q));d.clear(),zd.clear();top=0;\n\t//printf(\"%lld\\n\\n\\n\\n\",ans);\n}\nint main(){\n\tn=read();\n\tFOR(i,1,n){\n\t\tp[i].x=read()*2ll,p[i].y=read()*2ll;\n\t}\n\tsolve(0);\n\tFOR(i,1,n){\n\t\tp[i].x*=-1;p[i].y*=-1;\n\t}\n\tsolve(0);\n\tout(ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1589252958,
        "uid": 48744,
        "name": "TLE\u81ea\u52a8\u673a",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5286 \u3010[HNOI2019]\u9c7c\u3011"
    }
]