[
    {
        "content": "[\u6b22\u8fce\u60a8\u5728\u6211\u7684\u535a\u5ba2\u4e2d\u9605\u8bfb\u672c\u6587\uff0c\u8c22\u8c22\uff01](https://www.cnblogs.com/crab-in-the-northeast/p/luogu-p8818.html)\r\n\r\n\u672c\u6587\u4e2d A \u548c B \u5206\u522b\u4ee3\u8868\u5c0f L \u548c\u5c0f Q\uff0c\u800c\u539f\u9898\u4e2d\u7684 $A$\uff0c$B$ \u4e24\u4e2a\u6570\u7ec4\u5728\u672c\u9898\u4e2d\u5206\u522b\u7528 $a$ \u548c $b$ \u8868\u793a\u3002\r\n\r\n\u77e9\u9635\u8fd9\u4e2a\u63cf\u8ff0\u5c31\u662f\u969c\u773c\u6cd5\u3002\u7ffb\u8bd1\u4e00\u4e0b\u9898\u76ee\uff1a\r\n\r\nA \u5728 $a[l_1 \\cdots r_1]$ \u4e2d\u9009\u62e9\u4e00\u4e2a $x$\uff0c\u7136\u540e B \u5728 $b[l_2 \\cdots r_2]$ \u4e2d\u9009\u62e9\u4e00\u4e2a $y$\uff0c\u5206\u6570\u662f $x \\times y$\uff0cA \u60f3\u8ba9\u5206\u6570\u5c3d\u53ef\u80fd\u5927\uff0cB \u60f3\u8ba9\u5206\u6570\u5c3d\u53ef\u80fd\u5c0f\u3002\u6c42\u5206\u6570\u3002\r\n\r\n\u80af\u5b9a\u5148\u601d\u8003 B \u518d\u601d\u8003 A\uff0c\u56e0\u4e3a A \u4f1a\u601d\u8003 B \u7684\u601d\u8003\u3002\r\n\r\nB \u7684\u884c\u4e3a\u5c31\u662f\u5bf9\u4e8e $x$\uff0c\u627e\u5230\u4e00\u4e2a $b[l_2 \\cdots r_2]$ \u4e2d\u7684 $y$\uff0c\u4f7f\u5f97 $x \\times y$ \u6700\u5c0f\u3002\r\n\r\n\u5177\u4f53\u5730\uff1a\r\n\r\n- $x \\ge 0$ \u65f6\uff0cB \u4f1a\u9009\u62e9\u6700\u5c0f\u7684 $y$\uff1b\r\n- $x < 0$ \u65f6\uff0cB \u4f1a\u9009\u62e9\u6700\u5927\u7684 $y$\u3002\r\n\r\n\u90a3\u4e48 A \u7684\u884c\u4e3a\u662f\u4ec0\u4e48\u5462\uff1f\u8fd8\u662f\u6309\u7167\u6b63\u8d1f\u5206\u7c7b\u8ba8\u8bba\uff1a\r\n\r\n\u5982\u679c A \u8fd9\u6b21\u60f3\u8ba9 $x \\ge 0$\uff0c\u90a3\u4e48 B \u4f1a\u9009\u62e9\u6700\u5c0f\u7684 $y$\u3002\u5982\u679c\u8fd9\u4e2a $y \\ge 0$\uff0c\u90a3\u4e48 A \u4e00\u5b9a\u4f1a\u9009\u6700\u5927\u7684 $x$\uff1b\u5982\u679c\u8fd9\u4e2a $y < 0$\uff0c\u90a3\u4e48 A \u4e00\u5b9a\u4f1a\u9009\u6700\u5c0f\u7684\u975e\u8d1f\u6570 $x$\uff08\u522b\u5fd8\u4e86\u5f53\u524d\u5236\u7ea6\u6761\u4ef6 $x \\ge 0$\uff09\u3002\r\n\r\n\u5982\u679c A \u8fd9\u6b21\u60f3\u8ba9 $x < 0$\uff0c\u90a3\u4e48 B \u4f1a\u9009\u62e9\u6700\u5927\u7684 $y$\u3002\u5982\u679c\u8fd9\u4e2a $y \\ge 0$\uff0c\u90a3\u4e48 A \u4e00\u5b9a\u4f1a\u9009\u6700\u5927\u7684\u8d1f\u6570 $x$\uff1b\u5982\u679c\u8fd9\u4e2a $y <0$\uff0c\u90a3\u4e48 A \u4e00\u5b9a\u4f1a\u9009\u6700\u5c0f\u7684 $x$\u3002\r\n\r\n\u56e0\u6b64 A \u7684\u884c\u4e3a\u53ea\u6709\u56db\u79cd\uff1a\u9009\u62e9\u6700\u5927\u7684 $x$\uff1b\u6700\u5c0f\u7684 $x$\uff0c\u6700\u5927\u7684\u8d1f\u6570 $x$\uff0c\u6700\u5c0f\u7684\u975e\u8d1f\u6570 $x$\u3002\r\n\r\n\u5206\u522b\u8ba8\u8bba A \u9009\u62e9\u56db\u79cd\u884c\u4e3a\u65f6 B \u7684\u9009\u62e9\uff0c\u7b54\u6848\u53d6\u6700\u5927\u503c\u5373\u53ef\u3002\r\n\r\n\u7136\u540e\u5c31\u53d8\u6210\u4e86\u9759\u6001\u533a\u95f4\u6700\u503c\u7684\u677f\u5b50\u3002\u4f7f\u7528 6 \u4e2a ST \u8868\u5206\u522b\u5b58\u50a8\u4ee5\u4e0b\u4fe1\u606f\uff1a\r\n\r\n- $a$ \u7684\u533a\u95f4\u6700\u5927\u503c\uff1b\r\n- $a$ \u7684\u533a\u95f4\u6700\u5c0f\u503c\uff1b\r\n- $a$ \u7684\u8d1f\u6570\u533a\u95f4\u6700\u5927\u503c\uff1b\r\n    - \u5177\u4f53\u662f\u628a\u6240\u6709\u6ee1\u8db3 $a_i \\ge 0$ \u7684 $a_i$ \u5168\u90e8\u66ff\u6362\u4e3a $-\\infty$ \u4ee3\u8868\u8fd9\u4e2a\u4f4d\u7f6e\u4e0d\u5b58\u5728\u6570\uff0c\u81f3\u4e8e\u4e3a\u4f55\u662f $-\\infty$ \u8bf7\u8bfb\u8005\u81ea\u5df1\u601d\u8003\u3002\r\n- $a$ \u7684\u975e\u8d1f\u6570\u533a\u95f4\u6700\u5c0f\u503c\uff1b\r\n    - \u5177\u4f53\u662f\u628a\u6240\u6709\u6ee1\u8db3 $a_i < 0$ \u7684 $a_i$ \u5168\u90e8\u66ff\u6362\u4e3a $+\\infty$ \u4ee3\u8868\u8fd9\u4e2a\u4f4d\u7f6e\u4e0d\u5b58\u5728\u6570\u3002\r\n- $b$ \u7684\u533a\u95f4\u6700\u5927\u503c\uff1b\r\n- $b$ \u7684\u533a\u95f4\u6700\u5c0f\u503c\u3002\r\n\r\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log n + q)$\u3002\r\n\r\n\r\n```cpp\r\n/*\r\n * @Author: crab-in-the-northeast \r\n * @Date: 2022-10-30 22:49:26 \r\n * @Last Modified by: crab-in-the-northeast\r\n * @Last Modified time: 2022-10-30 23:15:25\r\n */\r\n#include <bits/stdc++.h>\r\n#define int long long\r\ninline int read() {\r\n    int x = 0;\r\n    bool f = true;\r\n    char ch = getchar();\r\n    for (; !isdigit(ch); ch = getchar())\r\n        if (ch == '-')\r\n            f = false;\r\n    for (; isdigit(ch); ch = getchar())\r\n        x = (x << 1) + (x << 3) + ch - '0';\r\n    return f ? x : (~(x - 1));\r\n}\r\ninline int max(int a, int b) {\r\n    return a > b ? a : b;\r\n}\r\ninline bool gmx(int &a, int b) {\r\n    return b > a ? a = b, true : false;\r\n}\r\ninline int min(int a, int b) {\r\n    return a < b ? a : b;\r\n}\r\n\r\nconst int maxn = (int)1e5 + 5;\r\nconst int maxm = (int)1e5 + 5;\r\nconst int mlgn = 25;\r\nconst int mlgm = 25;\r\n\r\nint amx[maxn][mlgn], amn[maxn][mlgn], afx[maxn][mlgn], azn[maxn][mlgn];\r\nint bmx[maxm][mlgm], bmn[maxm][mlgm];\r\n\r\n// 6 \u4e2a ST \u8868\r\n// amx\uff1aa \u7684\u533a\u95f4\u6700\u5927\u503c\uff0camn\uff1aa \u7684\u533a\u95f4\u6700\u5c0f\u503c\uff0cafx\uff1aa \u7684\u8d1f\u6570\u533a\u95f4\u6700\u5927\u503c\uff0cazn\uff1aa \u7684\u975e\u8d1f\u6570\u533a\u95f4\u6700\u5c0f\u503c\u3002\r\n// bmx\uff1ab \u7684\u533a\u95f4\u6700\u5927\u503c\uff0cbmn\uff1ab \u7684\u533a\u95f4\u6700\u5c0f\u503c\u3002\r\n\r\nint lg[maxn];\r\n\r\nconst int maxinf = LONG_LONG_MAX, mininf = LONG_LONG_MIN;\r\n\r\nsigned main() {\r\n    int n = read(), m = read(), q = read();\r\n    for (int i = 1; i <= n; ++i) {\r\n        int x = read();\r\n        amx[i][0] = amn[i][0] = x;\r\n        afx[i][0] = (x < 0 ? x : mininf);\r\n        azn[i][0] = (x >= 0 ? x : maxinf);\r\n    }\r\n\r\n    for (int i = 1; i <= m; ++i) {\r\n        int x = read();\r\n        bmx[i][0] = bmn[i][0] = x;\r\n    }\r\n\r\n    for (int i = 2; i <= max(n, m); ++i)\r\n        lg[i] = lg[i >> 1] + 1;\r\n\r\n    for (int j = 1; j <= lg[n]; ++j) {\r\n        for (int i = 1; i + (1 << j) - 1 <= n; ++i) {\r\n            int p = i + (1 << (j - 1));\r\n            amx[i][j] = max(amx[i][j - 1], amx[p][j - 1]);\r\n            afx[i][j] = max(afx[i][j - 1], afx[p][j - 1]);\r\n            amn[i][j] = min(amn[i][j - 1], amn[p][j - 1]);\r\n            azn[i][j] = min(azn[i][j - 1], azn[p][j - 1]);\r\n        }\r\n    }\r\n\r\n    for (int j = 1; j <= lg[m]; ++j) {\r\n        for (int i = 1; i + (1 << j) - 1 <= m; ++i) {\r\n            int p = i + (1 << (j - 1));\r\n            bmx[i][j] = max(bmx[i][j - 1], bmx[p][j - 1]);\r\n            bmn[i][j] = min(bmn[i][j - 1], bmn[p][j - 1]);\r\n        }\r\n    }\r\n\r\n    while (q--) {\r\n        int la = read(), ra = read(), lb = read(), rb = read();\r\n        int sa = lg[ra - la + 1], sb = lg[rb - lb + 1];\r\n        int pa = ra - (1 << sa) + 1, pb = rb - (1 << sb) + 1;\r\n\r\n        int amax = max(amx[la][sa], amx[pa][sa]);\r\n        int amin = min(amn[la][sa], amn[pa][sa]);\r\n        int afmx = max(afx[la][sa], afx[pa][sa]);\r\n        int azmn = min(azn[la][sa], azn[pa][sa]);\r\n        int bmax = max(bmx[lb][sb], bmx[pb][sb]);\r\n        int bmin = min(bmn[lb][sb], bmn[pb][sb]);\r\n\r\n        int ans = mininf;\r\n\r\n        gmx(ans, amax * (amax >= 0 ? bmin : bmax));\r\n        gmx(ans, amin * (amin >= 0 ? bmin : bmax));\r\n        if (afmx != mininf)\r\n            gmx(ans, afmx * (afmx >= 0 ? bmin : bmax));\r\n        if (azmn != maxinf)\r\n            gmx(ans, azmn * (azmn >= 0 ? bmin : bmax));\r\n        printf(\"%lld\\n\", ans);\r\n    }\r\n    return 0;\r\n}\r\n```\r\n\r\n\u5982\u679c\u89c9\u5f97\u8fd9\u7bc7\u9898\u89e3\u5199\u5f97\u597d\uff0c\u8bf7\u4e0d\u8981\u5fd8\u8bb0\u70b9\u8d5e\uff0c\u8c22\u8c22\uff01",
        "postTime": 1667150823,
        "uid": 120868,
        "name": "dbxxx",
        "ccfLevel": 6,
        "title": "P8818"
    },
    {
        "content": "\u95f2\u8bdd\uff1a\u6211\u662f\u6ca1\u6709\u4ee3\u7801\u80fd\u529b\u7684\u5c0f\u4e11/dk\u3002\n\n\u8003\u573a\u601d\u8def\uff0c\u4f46\u8d5b\u65f6\u6ca1\u5199\u5b8c\u3002\n\n### \u9898\u610f\n\n\u7ed9\u5b9a\u4e24\u4e2a\u533a\u95f4\uff0c\u5148\u624b\u5728 $A$ \u5e8f\u5217\u7ed9\u5b9a\u533a\u95f4\u5185\u9009\u62e9\u4e00\u4e2a\u6570\uff0c\u540e\u624b\u5728 $B$ \u5e8f\u5217\u7ed9\u5b9a\u533a\u95f4\u5185\u9009\u53e6\u4e00\u4e2a\u6570\u3002\u4e24\u4eba\u6240\u9009\u6570\u5b57\u4e58\u79ef\u4e3a\u5f97\u5206\u3002\u5148\u624b\u5e0c\u671b\u5f97\u5206\u5c3d\u91cf\u5927\uff0c\u540e\u624b\u5e0c\u671b\u5f97\u5206\u5c3d\u91cf\u5c0f\u3002\n\n### \u90e8\u5206\u5206\n\n#### \u7279\u6b8a\u6027\u8d28\u4e00\uff1a\u201c\u6743\u503c\u4e3a\u6b63\u201d\n\n\u56e0\u4e3a\u4e0d\u5b58\u5728\u76f8\u4e58\u6b63\u8d1f\u6027\u6539\u53d8\u7684\u95ee\u9898\u3002\u7531\u53cc\u65b9\u7b56\u7565\u53ef\u77e5\uff0c\u5148\u624b\u5fc5\u7136\u9009\u62e9\u533a\u95f4\u5185\u6700\u5927\u503c\uff0c\u540e\u624b\u5fc5\u7136\u9009\u62e9\u533a\u95f4\u5185\u6700\u5c0f\u503c\u3002\u56e0\u6b64\u4f7f\u7528\u7ebf\u6bb5\u6811/ST\u8868\u7ef4\u62a4\u533a\u95f4\u5185\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\u5373\u53ef\u3002\n\n#### \u7279\u6b8a\u6027\u8d28\u4e8c\uff1a\u5b58\u5728\u4e00\u65b9\u7684\u64cd\u4f5c\u533a\u95f4\u957f\u5ea6\u4e3a $1$\n\n\u82e5\u5148\u624b\u64cd\u4f5c\u533a\u95f4\u957f\u5ea6\u4e3a $1$\uff0c\u5219\u6709\u5982\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a\n\n1. \u5148\u624b\u5fc5\u987b\u9009\u7684\u6570\u662f $0$\uff0c\u6b64\u65f6\u7b54\u6848\u662f $0$\u3002\n\n2. \u5148\u624b\u5fc5\u987b\u9009\u7684\u6570\u662f\u6b63\u6570\uff0c\u6b64\u65f6\u540e\u624b\u7b56\u7565\u4e3a\u9009\u62e9\u5176\u533a\u95f4\u5185\u7684\u6700\u5c0f\u6570\u3002\n\n3. \u5148\u624b\u5fc5\u987b\u9009\u7684\u6570\u662f\u8d1f\u6570\uff0c\u6b64\u65f6\u540e\u624b\u7b56\u7565\u4e3a\u9009\u62e9\u5176\u533a\u95f4\u5185\u7684\u6700\u5927\u6570\u3002\n\n\u540e\u624b\u540c\u7406\uff1a\n\n1. \u540e\u624b\u5fc5\u987b\u9009\u7684\u6570\u662f $0$\uff0c\u6b64\u65f6\u7b54\u6848\u662f $0$\u3002\n\n2. \u540e\u624b\u5fc5\u987b\u9009\u7684\u6570\u662f\u6b63\u6570\uff0c\u6b64\u65f6\u5148\u624b\u7b56\u7565\u4e3a\u9009\u62e9\u5176\u533a\u95f4\u5185\u7684\u6700\u5927\u6570\u3002\n\n3. \u540e\u624b\u5fc5\u987b\u9009\u7684\u6570\u662f\u8d1f\u6570\uff0c\u6b64\u65f6\u540e\u624b\u7b56\u7565\u4e3a\u9009\u62e9\u5176\u533a\u95f4\u5185\u7684\u6700\u5c0f\u6570\u3002\n\n\u53ef\u4ee5\u8bc1\u660e\uff0c\u6309\u7167\u4e0a\u8ff0\u89c4\u5219\u9009\u6570\u53ef\u4ee5\u8fbe\u6210\u4e24\u4eba\u7684\u6700\u4f18\u7b56\u7565\u3002\n\n\u4f7f\u7528\u7ebf\u6bb5\u6811/ST\u8868\u7ef4\u62a4\u533a\u95f4\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\uff0c\u6309\u7167\u4e0a\u8ff0\u89c4\u5219\u8ba8\u8bba\u5373\u53ef\u3002\n\n### \u6b63\u89e3\n\n\u6b64\u65f6\u53cc\u65b9\u7684\u64cd\u4f5c\u533a\u95f4\u5185\u90fd\u6709\u591a\u4e2a\u6570\uff0c\u5176\u4e2d\u53cc\u65b9\u7684\u6700\u4f18\u7b56\u7565\u4f1a\u4f7f\u76f8\u4e58\u7684\u6b63\u8d1f\u53f7\u6539\u53d8\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5e94\u8be5\u6309\u7167\u53cc\u65b9\u64cd\u4f5c\u533a\u95f4\u5185\u7684\u6b63\u8d1f\u6570\u5b58\u5728\u60c5\u51b5\u8fdb\u884c\u8ba8\u8bba\u3002\n\n\u6211\u7684\u505a\u6cd5\u5c06\u6240\u6709\u60c5\u51b5\u5206\u4e3a\u516b\u7c7b\u3002\u4ee5\u4e0b\u7684\u201c\u6700\u5c0f\u201d\u201c\u6700\u5927\u201d\u5747\u6307\u6570\u672c\u8eab\u7684\u503c\u800c\u4e0d\u662f\u7edd\u5bf9\u503c\u3002\n\n1. \u540e\u624b\u65e0\u8d1f\u6570\u3002\n\n\t1.1 \u82e5\u6b64\u65f6\u5148\u624b\u6709\u6b63\u6570\uff0c\u5219\u5148\u624b\u5e94\u9009\u62e9\u533a\u95f4\u5185\u6700\u5927\u7684\u6b63\u6570\u6765\u4f7f\u7ed3\u679c\u5c3d\u53ef\u80fd\u5927\u3002\u82e5\u540e\u624b\u6709\u533a\u95f4\u5185 $0$\uff0c\u5219\u540e\u624b\u5e94\u9009\u62e9 $0$ \u4f7f\u5f97\u7b54\u6848\u6700\u5c0f\uff1b\u5426\u5219\u4ed6\u4f1a\u9009\u62e9\u533a\u95f4\u5185\u6700\u5c0f\u7684\u6b63\u6570\u3002\n   \n   1.2 \u82e5\u6b64\u65f6\u5148\u624b\u65e0\u6b63\u6570\uff0c\u5219\u82e5\u5148\u624b\u6709 $0$ \u5219\u4e00\u5b9a\u4f1a\u9009\u62e9 $0$\uff0c\u5426\u5219\u76f8\u4e58\u7ed3\u679c\u4e3a\u8d1f\uff0c\u4ed6\u4f1a\u9009\u62e9\u533a\u95f4\u5185\u6700\u5927\u7684\u8d1f\u6570\u6765\u4f7f\u76f8\u4e58\u7684\u7ed3\u679c\u5c3d\u91cf\u5927\u3002\u6b64\u65f6\u540e\u624b\u9009\u62e9\u533a\u95f4\u5185\u6700\u5927\u7684\u6b63\u6570\u3002\n   \n2. \u540e\u624b\u65e0\u6b63\u6570\u3002\n\n\t2.1 \u82e5\u6b64\u65f6\u5148\u624b\u6709\u8d1f\u6570\uff0c\u4ed6\u4e00\u5b9a\u4f1a\u9009\u62e9\u533a\u95f4\u5185\u6700\u5c0f\u7684\u8d1f\u6570\uff0c\u8d1f\u8d1f\u5f97\u6b63\u6765\u4f7f\u7ed3\u679c\u6700\u5927\u5316\u3002\u540e\u624b\u533a\u95f4\u5982\u679c\u6709 $0$ \u5219\u4e00\u5b9a\u4f18\u5148\u9009\u62e9 $0$\uff0c\u5426\u5219\u9009\u62e9\u533a\u95f4\u5185\u6700\u5927\u7684\u8d1f\u6570\u3002\n    \n   2.2 \u82e5\u6b64\u65f6\u5148\u624b\u65e0\u8d1f\u6570\uff0c\u5219\u7ed3\u679c\u5fc5\u7136\u4e0d\u5927\u4e8e $0$\uff0c\u5148\u624b\u533a\u95f4\u82e5\u6709 $0$ \u5219\u5fc5\u5b9a\u4f18\u5148\u9009 $0$\uff0c\u5426\u5219\u9009\u62e9\u5176\u533a\u95f4\u5185\u6700\u5c0f\u7684\u6b63\u6570\uff1b\u540e\u624b\u5219\u9009\u62e9\u5176\u533a\u95f4\u5185\u7684\u6700\u5c0f\u8d1f\u6570\u6765\u6700\u5c0f\u5316\u7ed3\u679c\u3002\n   \n3. \u540e\u624b\u65e2\u6709\u6b63\u6570\u53c8\u6709\u8d1f\u6570\n\n\t3.1 \u5148\u624b\u6709 $0$\uff0c\u5219\u5148\u624b\u9009 $0$\u3002\u9664 $0$ \u4ee5\u5916\uff0c\u5148\u624b\u65e0\u8bba\u9009\u4ec0\u4e48\uff0c\u540e\u624b\u90fd\u6709\u5e94\u5bf9\u7b56\u7565\u4f7f\u7ed3\u679c\u4e3a\u8d1f\u3002\n    \n   3.2 \u5148\u624b\u65e0\u6b63\u6570\u3002\u6b64\u65f6\u5148\u624b\u9009\u62e9\u533a\u95f4\u5185\u6700\u5927\u7684\u8d1f\u6570\uff0c\u800c\u540e\u624b\u9009\u62e9\u533a\u95f4\u5185\u6700\u5927\u7684\u6b63\u6570\u3002\n   \n   3.3 \u5148\u624b\u65e0\u8d1f\u6570\u3002\u6b64\u65f6\u5148\u624b\u9009\u62e9\u533a\u95f4\u5185\u6700\u5c0f\u7684\u6b63\u6570\uff0c\u800c\u540e\u624b\u9009\u62e9\u533a\u95f4\u5185\u6700\u5c0f\u7684\u8d1f\u6570\u3002\n   \n   3.4 \u5148\u624b\u65e2\u6709\u6b63\u6570\u4e5f\u6709\u8d1f\u6570\u3002\u6b64\u65f6\u5148\u624b\u53ef\u80fd\u59823.2\u4e2d\u9009\u62e9\u533a\u95f4\u5185\u6700\u5927\u7684\u8d1f\u6570\uff0c\u4e5f\u53ef\u80fd\u59823.3\u4e2d\u9009\u62e9\u533a\u95f4\u5185\u6700\u5c0f\u7684\u6b63\u6570\u3002\u7531\u4e8e\u5148\u624b\u6709\u4f18\u5148\u51b3\u7b56\u7684\u6743\u529b\uff0c\u6240\u4ee5\u4ed6\u4f1a\u4f1a\u9009\u62e93.2\u548c3.3\u4e24\u79cd\u7ed3\u679c\u4e2d\u66f4\u5927\u7684\u90a3\u4e00\u4e2a\u3002\u5373\u7b54\u6848\u4e3a $\\max(\\text{\u5148\u624b\u6700\u5927\u8d1f\u6570}\\times \\text{\u540e\u624b\u6700\u5927\u6b63\u6570},\\text{\u5148\u624b\u6700\u5c0f\u6b63\u6570}\\times \\text{\u540e\u624b\u6700\u5c0f\u8d1f\u6570})$\u3002\n   \n\u81ea\u6b64\uff0c\u6211\u4eec\u7684\u516b\u79cd\u60c5\u51b5\u5c31\u8ba8\u8bba\u5b8c\u4e86\u3002\n\n\u53e6\u5916\u4ee5\u4e0a\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\u6ca1\u6709\u8003\u8651\u5728\u5185\uff1a\u540e\u624b\u64cd\u4f5c\u533a\u95f4\u5185\u53ea\u6709 $0$\uff0c\u6b64\u65f6\u7b54\u6848\u4e00\u5b9a\u4e3a $0$\u3002\u7a0b\u5e8f\u4e2d\u53ef\u4ee5\u5c06\u8fd9\u79cd\u60c5\u51b5\u5e76\u5165\u5230\u4ee5\u4e0a\u7684\u60c5\u51b5\u4e2d\u3002\n\n\u4e3a\u8fdb\u884c\u4ee5\u4e0a\u7684\u5206\u7c7b\u8ba8\u8bba\uff0c\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u4ee5\u4e0b\u4fe1\u606f\uff1a\u533a\u95f4\u6700\u5927/\u6700\u5c0f\u6b63\u6570\u3001\u533a\u95f4\u6700\u5927/\u6700\u5c0f\u8d1f\u6570\u3001\u533a\u95f4\u662f\u5426\u6709 $0$\u3002\u4f7f\u7528\u7ebf\u6bb5\u6811\u6216ST\u8868\u7ef4\u62a4\u4e0a\u8ff0\u4fe1\u606f\uff0c\u6309\u4e0a\u8ff0\u5206\u7c7b\u8ba8\u8bba\u5373\u53ef\u3002\n\n\u5047\u8bbe $n,m$ \u540c\u7ea7\uff0c\u4f7f\u7528\u7ebf\u6bb5\u6811\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n+q\\log n)$\uff0cST\u8868\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log n +q)$\u3002\u5747\u53ef\u901a\u8fc7\u672c\u9898\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#define max(a,b) (((a)>(b))?(a):(b))\n#define min(a,b) (((a)<(b))?(a):(b))\n#define ls(p) ((p)<<1)\n#define rs(p) (((p)<<1)|1)\nconst int Nx=100010;\nint N,M,Q,A[Nx],B[Nx];\nstruct node{long long maz,miz,maf,mif,zro;};\nnode As[4*Nx],Bs[4*Nx];\nvoid pushnode(node &a,int val)\n{\n\tif(val==0)\n\t\ta.zro=1;\n\telse if(val>0)\n\t\ta.maz=a.miz=val;\n\telse if(val<0)\n\t\ta.maf=a.mif=val;\n}\nnode merge(node x,node y)\n{\n\tnode ret;\n\tret.zro=x.zro||y.zro;\n\tif(!x.maz||!y.maz)\n\t{\n\t\tret.maz=x.maz+y.maz;\n\t\tret.miz=x.miz+y.miz;\n\t}\n\telse\n\t{\n\t\tret.maz=max(x.maz,y.maz);\n\t\tret.miz=min(x.miz,y.miz);\n\t}\n\tif(!x.maf||!y.maf)\n\t{\n\t\tret.maf=x.maf+y.maf;\n\t\tret.mif=x.mif+y.mif;\n\t}\n\telse\n\t{\n\t\tret.maf=max(x.maf,y.maf);\n\t\tret.mif=min(x.mif,y.mif);\n\t}\n\treturn ret;\n}\nvoid build(int ll,int rr,int p,node seg[],int C[])\n{\n\tif(ll==rr)\n\t{\n\t\tpushnode(seg[p],C[ll]);\n\t\treturn;\n\t}\n\tint mid=(ll+rr)>>1;\n\tbuild(ll,mid,ls(p),seg,C);\n\tbuild(mid+1,rr,rs(p),seg,C);\n\tseg[p]=merge(seg[ls(p)],seg[rs(p)]);\n}\nnode query(int ll,int rr,int p,int L,int R,node seg[])\n{\n\tif(L<=ll&&rr<=R)\n\t\treturn seg[p];\n\tint mid=(ll+rr)>>1;\n\tif(L>mid)\n\t\treturn query(mid+1,rr,rs(p),L,R,seg);\n\tif(R<=mid)\n\t\treturn query(ll,mid,ls(p),L,R,seg);\n\treturn merge(query(ll,mid,ls(p),L,R,seg),query(mid+1,rr,rs(p),L,R,seg));\n}\nlong long get_ans(node ax,node bx)\n{\n\tlong long ret;\n\t//printf(\"%d %d %d %d %d   %d %d %d %d %d\\n\",ax.maz,ax.miz,ax.maf,ax.mif,ax.zro,bx.maz,bx.miz,bx.maf,bx.mif,bx.zro);\n\tif(bx.mif!=0&&bx.miz==0)//\u540e\u624b\u65e0\u6b63\u6570\n\t{\n\t\tif(ax.mif!=0)//\u5148\u624b\u6709\u8d1f\u6570\n\t\t\tret=(bx.zro)?0:ax.mif*bx.maf;\n\t\telse//\u5148\u624b\u65e0\u8d1f\u6570\n\t\t\tret=(ax.zro)?0:ax.miz*bx.mif;\n\t}\n\telse if(bx.mif==0&&bx.miz!=0)//\u540e\u624b\u65e0\u8d1f\u6570\n\t{\n\t\tif(ax.miz!=0)//\u5148\u624b\u6709\u6b63\u6570\n\t\t\tret=(bx.zro)?0:ax.maz*bx.miz;\n\t\telse//\u5148\u624b\u65e0\u6b63\u6570\n\t\t\tret=(ax.zro)?0:ax.maf*bx.maz;\n\t}\n\telse//\u540e\u624b\u6b63\u8d1f\u90fd\u6709/\u540e\u624b\u53ea\u67090\n\t{\n\t\tif(ax.zro)\n\t\t\tret=0;\n\t\telse if(ax.mif!=0&&ax.miz==0)//\u5148\u624b\u65e0\u6b63\u6570\n\t\t\tret=ax.maf*bx.maz;\n\t\telse if(ax.mif==0&&ax.miz!=0)//\u5148\u624b\u65e0\u8d1f\u6570\n\t\t\tret=ax.miz*bx.mif;\n\t\telse//\u5148\u624b\u6b63\u8d1f\u90fd\u6709\n\t\t\tret=max(ax.miz*bx.mif,ax.maf*bx.maz);\n\t}\n\treturn ret;\n}\nint main()\n{\n\tscanf(\"%d%d%d\",&N,&M,&Q);\n\tint i,j,k,la,ra,lb,rb;\n\tfor(i=1;i<=N;i++)\n\t\tscanf(\"%d\",&A[i]);\n\tfor(i=1;i<=M;i++)\n\t\tscanf(\"%d\",&B[i]);\n\tbuild(1,N,1,As,A);\n\tbuild(1,M,1,Bs,B);\n\tnode ax,bx;\n\twhile(Q--)\n\t{\n\t\tscanf(\"%d%d%d%d\",&la,&ra,&lb,&rb);\n\t\tax=query(1,N,1,la,ra,As);\n\t\tbx=query(1,M,1,lb,rb,Bs);\n\t\tprintf(\"%lld\\n\",get_ans(ax,bx));\n\t}\n}\n```\n",
        "postTime": 1667139273,
        "uid": 291481,
        "name": "novax",
        "ccfLevel": 7,
        "title": "CSP S \u7b56\u7565\u6e38\u620f"
    },
    {
        "content": "### \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u957f\u5ea6\u4e3a $n$\uff08$1 \\le n \\le 10^5$\uff09\u6574\u6570\u6570\u7ec4 $A$\uff08$-10^9 \\le A_i \\le 10^9$\uff09\u548c\u957f\u5ea6\u4e3a $m$\uff08$1 \\le m \\le 10^5$\uff09\u6574\u6570\u6570\u7ec4 $B$\uff08$-10^9 \\le B_i \\le 10^9$\uff09\uff0e\u7ed9\u51fa $q$\uff08$1 \\le q \\le 10^5$\uff09\u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u7ed9\u5b9a\u6574\u6570 $l_1,r_1,r_2,r_2$\uff08$1 \\le l_1 \\le r_1 \\le n$\uff0c$1 \\le l_2 \\le r_2 \\le m$\uff09\uff0c\u4f60\u9700\u8981\u6c42\u51fa\uff1a\n\n$$\n\\max_{i=l_1}^{r_1} \\min_{i=l_2}^{r_2} A_i \\cdot B_j.\n$$\n\n### \u7b80\u8981\u505a\u6cd5\n\n\u4e0d\u96be\u53d1\u73b0\u9009\u51fa\u7684 $A_i$ \u4e0e $B_j$ \u53ea\u4f1a\u662f\u4ee5\u4e0b\u56db\u79cd\u60c5\u51b5\u4e2d\u7684\u4e00\u79cd\uff1a\n\n- \u6700\u5c0f\u975e\u8d1f\u6570\uff0e\n- \u6700\u5927\u975e\u8d1f\u6570\uff0e\n- \u6700\u5c0f\u975e\u6b63\u6570\uff0e\n- \u6700\u5927\u975e\u6b63\u6570\uff0e\n\n\u8bc1\u660e\u5e73\u51e1\uff0e\n\n\u7ef4\u62a4\u533a\u95f4\u975e\u8d1f\u6570\u4e0e\u975e\u6b63\u6570 RMQ\uff0c\u4f9d\u6b21\u679a\u4e3e $4\\times 4 = 16$ \u79cd\u60c5\u51b5\u68c0\u67e5\u5373\u53ef\uff0e\n\n\u82e5\u4f7f\u7528 Method of Four Russians \u6280\u5de7\u7ef4\u62a4\u533a\u95f4 RMQ\uff0c\u5219\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n+m+q)$\uff0e\n",
        "postTime": 1667179864,
        "uid": 207996,
        "name": "yzy1",
        "ccfLevel": 9,
        "title": "P8818 \u9898\u89e3"
    },
    {
        "content": "\n### [\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://dregen-yor.eu.org/index.php/2022/11/01/csp-s-2022-b/)\u3002\n\n### [\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P8818)\u3002\n\n\n# \u601d\u8def\n\n\u9898\u76ee\u4e2d\u91cd\u8981\u6761\u4ef6\uff1a\n\n>**\u5c0f L \u7684\u76ee\u6807\u662f\u4f7f\u5f97\u8fd9\u4e2a\u5f97\u5206\u5c3d\u53ef\u80fd\u5927\uff0c\u5c0f Q \u7684\u76ee\u6807\u662f\u4f7f\u5f97\u8fd9\u4e2a\u5f97\u5206\u5c3d\u53ef\u80fd\u5c0f\u3002\u540c\u65f6\u4e24\u4eba\u90fd\u662f\u8db3\u591f\u806a\u660e\u7684\u73a9\u5bb6\uff0c\u6bcf\u6b21\u90fd\u4f1a\u91c7\u7528\u6700\u4f18\u7684\u7b56\u7565\u3002**\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5c0f L \u638c\u63e1\u4e3b\u52a8\u6743\uff0c\u5c0f L \u9009\u62e9\u540e\u5c0f Q \u624d\u4f1a\u4ece\u4e2d\u9009\u62e9\u4e00\u4e2a\u6570\uff0c\u4f7f $C_{xy}$ \u5c3d\u53ef\u80fd\u7684\u5c0f\uff0c\u5c0f L \u4f1a\u4ece\u6240\u6709\u53ef\u80fd\u7684 $C_{xy}$ \u4e2d\u9009\u62e9\u6700\u5927\u7684\u54ea\u4e00\u4e2a\u3002\n\n\u6211\u4eec\u6a21\u62df\u4e00\u4e0b\u90fd\u4f1a\u51fa\u73b0\u54ea\u4e9b\u60c5\u51b5\u3002\n\n- \u5c0f L \u548c\u5c0f Q \u90fd\u53ea\u80fd\u9009\u62e9\u6b63\u6574\u6570\uff0c\u6b64\u65f6\u5c0f L \u4f1a\u9009\u62e9\u6700\u5927\u7684\u6b63\u6574\u6570\uff0c\u5c0f Q \u4f1a\u9009\u62e9\u6700\u5c0f\u7684\u6b63\u6574\u6570\u3002\n\n- \u5c0f L \u548c\u5c0f Q \u90fd\u53ea\u80fd\u9009\u62e9\u8d1f\u6570\uff0c\u6b64\u65f6\u5c0f L \u4f1a\u9009\u62e9\u6700\u5c0f\u7684\u8d1f\u6570\uff0c\u5c0f Q \u4f1a\u9009\u62e9\u6700\u5927\u7684\u8d1f\u6570\u3002\n\n- \u5c0f L \u53ea\u80fd\u9009\u62e9\u6b63\u6574\u6570\uff0c\u5c0f Q \u65e2\u80fd\u9009\u62e9\u6b63\u6570\u53c8\u80fd\u9009\u62e9\u8d1f\u6570\uff0c\u6b64\u65f6\u5c0f L \u4f1a\u9009\u62e9\u6700\u5c0f\u7684\u6b63\u6574\u6570\uff0c\u5c0f Q \u4f1a\u9009\u62e9\u6700\u5c0f\u7684\u8d1f\u6570\u3002\n\n- \u5c0f L \u53ea\u80fd\u9009\u62e9\u8d1f\u6570\uff0c\u5c0f Q \u65e2\u80fd\u9009\u62e9\u6b63\u6570\u53c8\u80fd\u9009\u62e9\u8d1f\u6570\uff0c\u6b64\u65f6\u5c0f L \u4f1a\u9009\u62e9\u6700\u5927\u7684\u8d1f\u6570\uff0c\u5c0f Q \u4f1a\u9009\u62e9\u6700\u5927\u7684\u6b63\u6574\u6570\u3002\n\n- \u5c0f L \u65e2\u80fd\u9009\u62e9\u6b63\u6570\u53c8\u80fd\u9009\u62e9\u8d1f\u6570\uff0c\u5c0f Q \u53ea\u80fd\u9009\u62e9\u6b63\u6570\uff0c\u6b64\u65f6\u5c0f L \u4f1a\u9009\u62e9\u6700\u5927\u7684\u6b63\u6570\uff0c\u5c0f Q \u4f1a\u9009\u62e9\u6700\u5c0f\u7684\u6b63\u6570\u3002\n\n- \u5c0f L \u65e2\u80fd\u9009\u62e9\u6b63\u6570\u53c8\u80fd\u9009\u62e9\u8d1f\u6570\uff0c\u5c0f Q \u53ea\u80fd\u9009\u62e9\u8d1f\u6570\uff0c\u6b64\u65f6\u5c0f L \u4f1a\u9009\u62e9\u6700\u5c0f\u7684\u8d1f\u6570\uff0c\u5c0f Q \u4f1a\u9009\u62e9\u6700\u5927\u7684\u8d1f\u6570\u3002\n\n- \u5c0f L \u65e2\u80fd\u9009\u62e9\u6b63\u6570\u53c8\u80fd\u9009\u62e9\u8d1f\u6570\uff0c\u5c0f Q \u4e5f\u65e2\u80fd\u9009\u62e9\u6b63\u6570\u53c8\u80fd\u9009\u62e9\u8d1f\u6570\uff0c\u6b64\u65f6\u7b54\u6848\u4f1a\u51fa\u73b0\u4e0d\u540c\u60c5\u51b5\u3002\u5f53\u5c0f L \u9009\u62e9\u6b63\u6574\u6570\u65f6\uff0c\u5c0f Q \u4f1a\u9009\u62e9\u6700\u5c0f\u7684\u8d1f\u6570\uff1b\u5f53\u5c0f L \u9009\u62e9\u8d1f\u6570\u65f6\uff0c\u5c0f Q \u4f1a\u9009\u62e9\u6700\u5927\u7684\u6b63\u6570\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u65e0\u8bba\u5982\u4f55\u9009\u62e9\uff0c\u7ed3\u679c\u4e00\u5b9a\u662f\u8d1f\u6570\uff0c\u6211\u4eec\u8981\u60f3\u8ba9\u8fd9\u4e2a\u8d1f\u6570\u5c3d\u53ef\u80fd\u5730\u5927\uff0c\u90a3\u4e48\u5c0f L \u5728\u9009\u62e9\u6570\u7684\u65f6\u5019\u4e00\u5b9a\u8981\u9009\u62e9\u7edd\u5bf9\u503c\u76f8\u5bf9\u8f83\u5c0f\u7684\u6570\uff0c\u5373\u5c0f L \u5e94\u9009\u62e9\u6b63\u6570\u4e2d\u7684\u6700\u5c0f\u503c\u6216\u8d1f\u6570\u4e2d\u7684\u6700\u5927\u503c\uff0c\u6b64\u65f6\u5c0f Q \u9009\u62e9\u7684\u6570\u5206\u522b\u4e3a\u6700\u5c0f\u7684\u8d1f\u6570\u4e0e\u6700\u5927\u7684\u6b63\u6570\uff0c\u53d6\u4e24\u79cd\u60c5\u51b5\u7684\u6700\u5927\u503c\u5373\u53ef\u3002\n\n\u901a\u8fc7\u4e0a\u9762\u7684\u5206\u6790\uff0c\u6211\u4eec\u53d1\u73b0\u524d $6$ \u79cd\u60c5\u51b5\u90fd\u662f\u4ece\u4e24\u8fb9\u7684\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\u4e2d\u83b7\u5f97\u7684\uff0c\u53ea\u6709\u6700\u540e\u4e00\u79cd\u60c5\u51b5\u6d89\u53ca\u5230\u4e86\u5e8f\u5217 $a_i$ \u7684\u6b63\u6570\u4e2d\u7684\u6700\u5c0f\u503c\u548c\u8d1f\u6570\u4e2d\u7684\u6700\u5927\u503c\u3002\n\n\u6211\u4eec\u5728\u7edf\u8ba1\u7b54\u6848\u7684\u65f6\u5019\u53ea\u9700\u8981\u4ece\u4e24\u79cd\u6781\u503c\u7684\u9009\u62e9\u4e2d\u53d6\u6700\u5c0f\u503c\u6700\u5927\u7684\u60c5\u51b5\uff0c\u7136\u540e\u5224\u65ad\u662f\u5426\u5b58\u5728\u7b2c $7$ \u4e2d\u60c5\u51b5\uff0c\u53d6\u6700\u5927\u503c\u5373\u53ef\u3002\n\n\u81f3\u4e8e\u4e24\u4e2a\u5e8f\u5217\u7684\u6781\u503c\u7684\u67e5\u8be2\uff0c\u7531\u4e8e\u4e0d\u6d89\u53ca\u5230\u4fee\u6539\u64cd\u4f5c\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 ST \u8868\u6765\u7ef4\u62a4\u4e24\u4e2a\u5e8f\u5217\u7684\u4fe1\u606f\u3002\n\nST \u8868\u9884\u5904\u7406\u590d\u6742\u5ea6\u4e3a $\\mathcal O(n\\log n+m\\log m)$\uff0cST \u8868\u67e5\u8be2\u590d\u6742\u5ea6\u4e3a $\\mathcal O(1)$\uff0c\u603b\u5171 $q$ \u6b21\u67e5\u8be2\uff0c\u6240\u4ee5\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O(n\\log n+m\\log m +q)$\u3002\n\n# \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#include<cstdio>\nusing namespace std;\nint n,m,q,a[100010],b[100010];\nstruct re{\n    __int128 a,b,c,d;\n};\nstruct nod{\n    __int128 ST1[100010][20],ST2[100010][20],ST3[100010][20],ST4[100010][20];\n    void bulid(int *p,int len){\n        for(int i=1;i<=len;i++){\n            ST1[i][0]=p[i];\n            if(p[i]>=0){\n                ST2[i][0]=p[i];\n            }\n            else{\n                ST2[i][0]=2e9;\n            }\n            ST3[i][0]=p[i];\n            if(p[i]>0){\n                ST4[i][0]=-2e9;\n            }\n            else{\n                ST4[i][0]=p[i];\n            }\n        }\n        for(int j=1;j<=log2(len);j++){\n            for(int i=1;i<=len-(1<<j)+1;i++){\n                ST1[i][j]=min(ST1[i][j-1],ST1[i+(1<<(j-1))][j-1]);\n                ST2[i][j]=min(ST2[i][j-1],ST2[i+(1<<(j-1))][j-1]);\n                ST3[i][j]=max(ST3[i][j-1],ST3[i+(1<<(j-1))][j-1]);\n                ST4[i][j]=max(ST4[i][j-1],ST4[i+(1<<(j-1))][j-1]);\n            }\n        }\n    }\n    re query(int l,int r){\n        int len=r-l+1;\n        int p=log2(len);\n        int a=min(ST1[l][p],ST1[r-(1<<p)+1][p]);\n        int b=min(ST2[l][p],ST2[r-(1<<p)+1][p]);\n        int c=max(ST3[l][p],ST3[r-(1<<p)+1][p]);\n        int d=max(ST4[l][p],ST4[r-(1<<p)+1][p]);\n        return re{a,b,c,d};\n    }\n}ST1,ST2;\nsigned main(){\n    // freopen(\"game.in\",\"r\",stdin);\n    // freopen(\"game.out\",\"w\",stdout);\n    scanf(\"%lld%lld%lld\",&n,&m,&q);\n    for(int i=1;i<=n;i++){\n        scanf(\"%lld\",&a[i]);\n    }\n    for(int i=1;i<=m;i++){\n        scanf(\"%lld\",&b[i]);\n    }\n    ST1.bulid(a,n);\n    ST2.bulid(b,m);\n    while(q--){\n        int l1,r1,l2,r2;\n        scanf(\"%lld%lld%lld%lld\",&l1,&r1,&l2,&r2);\n        re tmp1=ST1.query(l1,r1);\n        re tmp2=ST2.query(l2,r2);\n        int ans=max(min(tmp1.c*tmp2.a,tmp1.c*tmp2.c),min(tmp1.a*tmp2.c,tmp1.a*tmp2.a));\n        if(tmp1.b<1e9){\n            ans=max(ans,(int)tmp1.b*(int)tmp2.a);\n        }\n        if(tmp1.d>-1e9){\n            ans=max(ans,(int)tmp1.d*(int)tmp2.c);\n        }\n        printf(\"%lld\\n\",ans);\n    }\n    return 0;\n}\n```\n",
        "postTime": 1667136101,
        "uid": 478585,
        "name": "Dregen_Yor",
        "ccfLevel": 4,
        "title": "[CSP-S 2022] \u7b56\u7565\u6e38\u620f \u9898\u89e3"
    },
    {
        "content": "## \u524d\u8a00\n\n\u5f00\u573a\u7684\u65f6\u5019\u770b\u5230\u8fd9\u4e2a\u9898\uff0c\u5185\u5fc3\uff1a\u201c\u3010\u3011\uff0c\u63d0\u9ad8\u7ec4\u8003\u535a\u5f08\u8bba\u4e86\uff1f\u201d\n\n\u7136\u800c\u5e76\u4e0d\u662f\uff0c\u8fd9\u5c31\u662f\u4e2a\u5f88\u611a\u8822\u7684\u8d2a\u5fc3\u9898\u3002\n\n## \u601d\u8def\n\n\u89c2\u5bdf\u5230\u9898\u76ee\u53c8\u662f\u77e9\u9635\u53c8\u662f\u4ec0\u4e48\u7684\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5728 $A$ \u91cc\u9762\u9009\u4e00\u4e2a $[l_1,r_1]$ \u4e4b\u95f4\u7684\u6570\uff0c$B$ \u91cc\u9762\u9009\u4e00\u4e2a $[l_2,r_2]$ \u4e4b\u95f4\u7684\u6570\uff0c\u7136\u540e\u5c0f L \u60f3\u8981\u4e58\u79ef\u6700\u5927\uff0c\u5c0f Q \u60f3\u8981\u4e58\u79ef\u6700\u5c0f\u3002\n\n\u9996\u5148\u6211\u4eec\u8003\u8651 $O(qnm)$ \u505a\u6cd5\uff0c\u4e5f\u5c31\u662f\u66b4\u529b\u679a\u4e3e\u5c0f L \u9009\u7684\u662f\u4ec0\u4e48\u6570\uff0c\u867d\u7136\u6211\u4eec\u8fd8\u4e0d\u77e5\u9053\u5c0f Q \u7684\u7b56\u7565\uff0c\u4f46\u662f\u5f88\u663e\u7136\u7531\u4e8e\u5c0f Q \u603b\u662f\u5c3d\u91cf\u8fdd\u80cc\u5c0f L \u7684\u610f\u613f\uff0c\u6240\u4ee5\u7b54\u6848\u5373\u4e3a\u5728\u4e24\u4eba\u7684\u6bcf\u4e00\u79cd\u9009\u6570\u914d\u5bf9\u4e2d\u7684\u6700\u5927\u503c\uff0c\u56e0\u4e3a\u5c0f L \u5c31\u662f\u60f3\u8ba9\u7b54\u6848\u6700\u5927\u3002\n\n\u8ba9\u6211\u4eec\u8003\u8651\u5c0f Q \u7684\u7b56\u7565\u3002\u5f53\u5c0f L \u9009\u6b63\u6570\u7684\u65f6\u5019\uff0c\u5c0f Q \u4f1a\u5c3d\u91cf\u9009\u62e9\u6700\u5c0f\u7684\u6570\uff1b\u5f53\u5c0f L \u9009\u8d1f\u6570\u7684\u65f6\u5019\uff0c\u5c0f Q \u53c8\u4f1a\u5c3d\u91cf\u9009\u62e9\u6700\u5927\u7684\u6570\uff1b\u5f53\u5c0f L \u9009 $0$ \u7684\u65f6\u5019\uff0c\u90a3\u65e0\u8bba\u5982\u4f55\u90fd\u662f $0$\u3002\u6240\u4ee5\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a $O(qn\\log m)$ \u7684\u505a\u6cd5\uff0c\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4 $B$ \u6570\u7ec4\u7684\u533a\u95f4 RMQ\u3002\n\n\u63a5\u4e0b\u6765\u518d\u89c2\u5bdf\u3002\u5f53\u5c0f L \u9009\u8d1f\u6570\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u5c0f Q \u4f1a\u9009\u62e9\u6700\u5927\u7684\u6570\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5f53\u5c0f Q \u9009\u62e9\u8d1f\u6570\u548c\u975e\u8d1f\u6570\u65f6\u7684\u60c5\u51b5\u3002\u5f53\u5c0f Q \u9009\u62e9\u7684\u6700\u5927\u503c\u662f\u8d1f\u6570\u7684\u65f6\u5019\uff0c\u552f\u4e00\u5bf9\u7b54\u6848\u6709\u8d21\u732e\u7684\u5c31\u662f\u5c0f L \u9009\u62e9\u6700\u5c0f\u8d1f\u6570\uff08\u6b64\u65f6\u4e58\u79ef\u6700\u5927\uff09\uff1b\u800c\u5c0f Q \u9009\u62e9\u7684\u6700\u5927\u503c\u662f\u975e\u8d1f\u6570\u7684\u65f6\u5019\uff0c\u552f\u4e00\u5bf9\u7b54\u6848\u6709\u8d21\u732e\u7684\u5c31\u662f\u5c0f L \u9009\u62e9\u6700\u5927\u8d1f\u6570\uff08\u6b64\u65f6\u4e58\u79ef\u6700\u5927\uff09\u3002\n\n\u540c\u7406\u5bf9\u6b63\u6570\u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\uff0c\u53ef\u4ee5\u5f97\u5230\u4ee5\u4e0b\u7ed3\u8bba\uff1a\n\n- \u5c0f L \u9009\u8d1f\u6570\u65f6\uff0c\u5c0f Q \u7684\u6700\u5927\u503c\u662f\u8d1f\u6570\uff0c\u5c0f L \u9009\u62e9\u6700\u5c0f\u8d1f\u6570\u3002\n- \u5c0f L \u9009\u8d1f\u6570\u65f6\uff0c\u5c0f Q \u7684\u6700\u5927\u503c\u662f\u975e\u8d1f\u6570\uff0c\u5c0f L \u9009\u62e9\u6700\u5927\u8d1f\u6570\u3002\n- \u5c0f L \u9009\u6b63\u6570\u65f6\uff0c\u5c0f Q \u7684\u6700\u5c0f\u503c\u662f\u8d1f\u6570\uff0c\u5c0f L \u9009\u62e9\u6700\u5c0f\u6b63\u6570\u3002\n- \u5c0f L \u9009\u6b63\u6570\u65f6\uff0c\u5c0f Q \u7684\u6700\u5c0f\u503c\u662f\u975e\u8d1f\u6570\uff0c\u5c0f L \u9009\u62e9\u6700\u5927\u6b63\u6570\u3002\n\n\u90a3\u4e48\u8003\u8651\u7ed9\u5c0f L \u4e5f\u9020\u4e00\u4e2a\u7ebf\u6bb5\u6811\uff0c\u7ef4\u62a4\u6700\u5c0f\u6b63\u6570\uff0c\u6700\u5927\u6b63\u6570\uff0c\u6700\u5927\u8d1f\u6570\uff0c\u6700\u5c0f\u8d1f\u6570\u4ee5\u53ca\u662f\u5426\u6709 $0$ \u5373\u53ef\u3002\n\n\u867d\u7136\u542c\u8d77\u6765\u5f88\u9707\u64bc\uff0c\u4f46\u662f\u5176\u5b9e\u5f88\u597d\u5199\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(q(\\log n+\\log m))$\n\n\n## \u4ee3\u7801\n\n\u4e0b\u9762\u662f\u4e11\u964b\u7684\u8d5b\u65f6\u4ee3\u7801\u3002\n\n```\n//Author: Zealous_YH in CSP-S2022\n//Su Chanzi & Xiaobao\n//Who AKs IOI and who not?\n//Who loves a person and who breaks up?\n//Who gets 1= and who not?\n//I, can do my best now.\n#include <bits/stdc++.h>\n#define ET return 0\n#define fr1(i,a,b) for(int (i)=(a);(i)<=(b);(i)++)\n#define fr2(i,a,b) for(int (i)=(a);(i)>=(b);(i)--)\n#define ll long long\n#define mp make_pair\n#define il inline\n#define pii pair<int,int>\n#define fi first\n#define se second\n#define il inline\n#define int ll\nusing namespace std;\nconst int N=1e5+10;\nint n,m,q;\nint a[N],b[N];\n//int f1=0,f2=0;\nint l1,r1,l2,r2;\n#define mid ((l+r)>>1)\nstruct node{\n\tint maxf,minf,maxz,minz,cnt0;\n};\nstruct Segment_Tree{\n\tint val[N<<2],minn[N<<2],maxn[N<<2],maxf[N<<2],minf[N<<2],maxz[N<<2],minz[N<<2],cnt0[N<<2];\n\tvoid pushup(int p){\n\t\tminn[p]=min(minn[p<<1],minn[p<<1|1]);\n\t\tmaxn[p]=max(maxn[p<<1],maxn[p<<1|1]);\n\t\tmaxf[p]=max(maxf[p<<1],maxf[p<<1|1]);\n\t\tminf[p]=min(minf[p<<1],minf[p<<1|1]);\n\t\tmaxz[p]=max(maxz[p<<1],maxz[p<<1|1]);\n\t\tminz[p]=min(minz[p<<1],minz[p<<1|1]);\n\t\tcnt0[p]=cnt0[p<<1]+cnt0[p<<1|1];\n\t}//\u6211\u628a\u4e24\u4e2a\u7ebf\u6bb5\u6811\u641e\u4e00\u8d77\u4e86\uff0c\u6240\u4ee5\u8981\u4e0a\u4f20\u4e03\u4e2a\u6807\u8bb0\n\tvoid merge(node &ans,node d){//\u533a\u95f4\u67e5\u8be2\u65f6\u5408\u5e76\u7b54\u6848\n\t\tans.cnt0+=d.cnt0;\n\t\tans.maxf=max(ans.maxf,d.maxf);\n\t\tans.minf=min(ans.minf,d.minf);\n\t\tans.maxz=max(ans.maxz,d.maxz);\n\t\tans.minz=min(ans.minz,d.minz);\n\t}\n\til void build(int p,int l,int r){//\u5efa\u6811\n\t\tmaxf[p]=LONG_LONG_MIN;\n\t\tminf[p]=0;\n\t\tmaxz[p]=0;\n\t\tcnt0[p]=0;\n\t\tminz[p]=LONG_LONG_MAX;//\u521d\u59cb\u5316\n\t\tif(l==r){\n\t\t\tminn[p]=maxn[p]=val[l];\n\t\t\tif(val[l]<0){\n\t\t\t\tmaxf[p]=val[l];\n\t\t\t\tminf[p]=val[l];\n\t\t\t}\n\t\t\telse if(val[l]>0){\n\t\t\t\tmaxz[p]=val[l];\n\t\t\t\tminz[p]=val[l];\n\t\t\t}\n\t\t\telse{\n\t\t\t\tcnt0[p]=1;\n\t\t\t}//\u8d4b\u521d\u503c\n\t\t\treturn;\n\t\t}\n\t\tbuild(p<<1,l,mid);\n\t\tbuild(p<<1|1,mid+1,r);\n\t\tpushup(p);\n\t}\n\til pii query(int p,int l,int r,int ml,int mr){//\u4e3a\u5c0f Q \u51c6\u5907\u7684\u533a\u95f4\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\n\t\tif(ml<=l&&r<=mr){\n\t\t\treturn mp(minn[p],maxn[p]);\n\t\t}\n\t\tpii ans=mp(LONG_LONG_MAX,LONG_LONG_MIN);\n\t\tif(ml<=mid){\n\t\t\tpii d=query(p<<1,l,mid,ml,mr);\n\t\t\tans.fi=min(ans.fi,d.fi);\n\t\t\tans.se=max(ans.se,d.se);\n\t\t}\n\t\tif(mid<mr){\n\t\t\tpii d=query(p<<1|1,mid+1,r,ml,mr);\n\t\t\tans.fi=min(ans.fi,d.fi);\n\t\t\tans.se=max(ans.se,d.se);\n\t\t}\n\t\treturn ans;\n\t}\n\til node queryb(int p,int l,int r,int ml,int mr){//\u4e3a\u5c0f L \u51c6\u5907\u7684\u533a\u95f4\u6700\u5927\u8d1f\u6570\uff0c\u6700\u5c0f\u8d1f\u6570\u7b49\u7b49\n\t\tif(ml<=l&&r<=mr){\n\t\t\treturn {maxf[p],minf[p],maxz[p],minz[p],cnt0[p]};\n\t\t}\n\t\tnode ans={LONG_LONG_MIN,0,0,LONG_LONG_MAX,0};\n\t\tif(ml<=mid){\n\t\t\tnode d=queryb(p<<1,l,mid,ml,mr);\n\t\t\tmerge(ans,d);\n\t\t}\n\t\tif(mid<mr){\n\t\t\tnode d=queryb(p<<1|1,mid+1,r,ml,mr);\n\t\t\tmerge(ans,d);\n\t\t}\n\t\treturn ans;\n\t}\n} T1,T2;\n#undef mid\nvoid solve2(){\n//\tint d1[N];\n\twhile(q--){\n\t\tint ans=LONG_LONG_MIN; \n\t\tcin>>l1>>r1>>l2>>r2;\n\t\tnode d=T1.queryb(1,1,n,l1,r1);\n\t\tint x=T2.query(1,1,m,l2,r2).fi;\n\t\tint y=T2.query(1,1,m,l2,r2).se;\n\t\tif(d.cnt0!=0){//\u5982\u679c\u6709 0 \u90a3\u7b54\u6848\u81f3\u5c11\u90fd\u662f 0\n\t\t\tans=0;\n\t\t}\n\t\tif(y>0&&d.minf!=0){\n\t\t\tans=max(ans,y*d.maxf);\n\t\t}\n\t\tif(y<=0&&d.maxf!=LONG_LONG_MIN){\n\t\t\tans=max(ans,y*d.minf);\n\t\t}\n\t\tif(x<=0&&d.minz!=LONG_LONG_MAX){\n\t\t\tans=max(ans,x*d.minz);\n\t\t}\n\t\tif(x>0&&d.maxz!=0){\n\t\t\tans=max(ans,x*d.maxz);\n\t\t}//\u5206\u7c7b\u8ba8\u8bba\n//\t\tcout<<d.cnt0<<\",\"<<d.maxf<<\",\"<<d.minf<<\",\"<<d.maxz<<\",\"<<d.minz<<endl;\n\t\tcout<<ans<<'\\n';//\u8b66\u60d5\u5361\u5e38\uff0c\u4e0d\u8981 endl\n\t}\n}\nsigned main(){\n// \tfreopen(\"game.in\",\"r\",stdin);\n// \tfreopen(\"game.out\",\"w\",stdout);\n\tios::sync_with_stdio(false);\n\tcin>>n>>m>>q;\n\tfr1(i,1,n){\n\t\tcin>>a[i];\n\t\tT1.val[i]=a[i];\n\t}\n\tfr1(i,1,m){\n\t\tcin>>b[i];\n\t\tT2.val[i]=b[i];\n\t}\n\tT1.build(1,1,n);\n\tT2.build(1,1,m);\n\tsolve2();//\u672c\u6765\u662f\u5199\u7684\u7279\u6b8a\u6027\u8d28\uff0c\u7ed3\u679c\u63a8\u51fa\u4e86\u6b63\u89e3\n\tET;\n}\n//RP++\n//Don't FST.\n/*\n10 10 1\n1 2 3 4 5 6 7 8 9 10\n2 3 4 5 6 7 1 2 3 7\n2 4 3 6\n*/\n```\n\n\u4e8e\u662f\u5c31\u53ef\u4ee5\u6109\u5feb\u7684 AC \u4e86\u3002\u8fd9\u4efd\u4ee3\u7801\u975e\u5e38\u597d\u8c03\u3002",
        "postTime": 1667099372,
        "uid": 399150,
        "name": "Shunpower",
        "ccfLevel": 7,
        "title": "P8818 [CSP-S 2022] \u7b56\u7565\u6e38\u620f \u9898\u89e3"
    },
    {
        "content": "\u4e3a\u4e86\u53d9\u8ff0\u65b9\u4fbf\uff0c\u4ee5\u4e0b\u8ba4\u4e3a $0$ \u662f\u6b63\u6570\u3002\n\n------------\n\n\u9996\u5148\u6211\u4eec\u53d1\u73b0\u77e9\u9635 $C$ \u5b9e\u9645\u6ca1\u6709\u7528\u5904\uff1a\u6bcf\u4e00\u8f6e\u7684\u5f97\u5206 $C_{xy}$ \u5373\u4e3a $A_xB_y$\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u8003\u8651\u5206\u6790\u5e8f\u5217 $A,B$\u3002\n\n\u6211\u4eec\u5148\u8003\u8651\u4e00\u4e2a\u7b80\u5316\u7684\u95ee\u9898\uff1a\u5982\u679c\u5e8f\u5217\u4e2d\u5168\u4e3a\u6b63\u6570\u8be5\u5982\u4f55\u505a\uff1f\n\n\u6b64\u65f6\uff0c\u5c0f L \u4e3a\u4f7f\u7ed3\u679c\u6700\u5927\uff0c\u4ed6\u4f1a\u9009\u62e9\u5e8f\u5217 $A$ \u4e2d\u6700\u5927\u7684\u6570\uff1b\u540c\u7406\uff0c\u5c0f Q \u4f1a\u9009\u62e9\u5e8f\u5217 $B$ \u4e2d\u6700\u5c0f\u7684\u6570\u3002\u4e24\u8005\u76f8\u4e58\u5373\u5f97\u7ed3\u679c\u3002\n\n\u4e0b\u9762\u6211\u4eec\u628a\u8d1f\u6570\u52a0\u5165\u8003\u8651\u3002\u8d1f\u6570\u5bf9\u7ed3\u679c\u7684\u5f71\u54cd\u662f\u7ed3\u679c\u53ef\u80fd\u4e3a\u8d1f\uff0c\u5bfc\u81f4\u5f97\u5206\u7684**\u7edd\u5bf9\u503c\u5927**\u65f6\u53cd\u800c\u53d8\u5c0f\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5206\u4ee5\u4e0b\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n1. \u5e8f\u5217 $A$ \u5168\u6b63\u3002\n\n\u82e5\u5e8f\u5217 $B$ \u5168\u6b63\uff0c\u90a3\u4e48\u53d6\u5e8f\u5217 $A$ \u7684\u6b63\u6570\u4e2d\u7684\u6700\u5927\u503c\u3001\u5e8f\u5217 $B$ \u7684\u6b63\u6570\u4e2d\u7684\u6700\u5c0f\u503c\u5373\u53ef\uff1b\n\n\u82e5\u5e8f\u5217 $B$ \u6709\u6b63\u6709\u8d1f\uff08\u6216\u5168\u8d1f\uff09\uff0c\u90a3\u4e48\u53d6\u5e8f\u5217 $A$ \u7684\u6b63\u6570\u4e2d\u7684\u6700\u5c0f\u503c\u3001\u5e8f\u5217 $B$ \u7684\u8d1f\u6570\u4e2d**\u7edd\u5bf9\u503c**\uff08\u4ee5\u4e0b\u4e0d\u518d\u5f3a\u8c03\uff09\u6700\u5927\u7684\u503c\uff08\u5373\u5b9e\u9645\u4e0a\u7684\u6700\u5c0f\u503c\uff09\u5373\u53ef\u3002\n\n2. \u5e8f\u5217 $A$ \u5168\u8d1f\u3002\n\n\u82e5\u5e8f\u5217 $B$ \u5168\u8d1f\uff0c\u90a3\u4e48\u53d6\u5e8f\u5217 $A$ \u7684\u8d1f\u6570\u4e2d\u7edd\u5bf9\u503c\u6700\u5927\u7684\u503c\u3001\u5e8f\u5217 $B$ \u7684\u8d1f\u6570\u4e2d\u7edd\u5bf9\u503c\u6700\u5c0f\u7684\u503c\u5373\u53ef\uff1b\n\n\u82e5\u5e8f\u5217 $B$ \u6709\u6b63\u6709\u8d1f\uff08\u6216\u5168\u6b63\uff09\uff0c\u90a3\u4e48\u53d6\u5e8f\u5217 $A$ \u7684\u8d1f\u6570\u4e2d\u7edd\u5bf9\u503c\u6700\u5c0f\u7684\u503c\u3001\u5e8f\u5217 $B$ \u7684\u6b63\u6570\u4e2d\u7684\u6700\u5927\u503c\u5373\u53ef\u3002\n\n3. \u5e8f\u5217 $A$ \u6709\u6b63\u6709\u8d1f\u3002\n\n\u82e5\u5e8f\u5217 $B$ \u5168\u6b63\uff0c\u5219\u4e0e\u5e8f\u5217 $A,B$ \u5168\u6b63\u76f8\u540c\uff1b\n\n\u82e5\u5e8f\u5217 $B$ \u5168\u8d1f\uff0c\u5219\u4e0e\u5e8f\u5217 $A,B$ \u5168\u8d1f\u76f8\u540c\uff1b\n\n\u82e5\u5e8f\u5217 $B$ \u4e5f\u6709\u6b63\u6709\u8d1f\uff0c\u5219\u9700\u8981\u8003\u8651\u5e8f\u5217 $A$ \u7684\u6b63\u6570\u4e2d\u7684\u6700\u5c0f\u503c\u3001\u5e8f\u5217 $B$ \u7684\u8d1f\u6570\u4e2d\u7edd\u5bf9\u503c\u6700\u5927\u7684\u503c\uff0c\u548c\u5e8f\u5217 $A$ \u7684\u8d1f\u6570\u4e2d\u7edd\u5bf9\u503c\u6700\u5c0f\u7684\u503c\u3001\u5e8f\u5217 $B$ \u7684\u6b63\u6570\u4e2d\u7684\u6700\u5927\u503c\uff0c\u5728\u4e24\u79cd\u60c5\u51b5\u4e2d\u9009\u51fa\u66f4\u5927\u7684\u90a3\u4e00\u4e2a\u3002\n\n\u7efc\u4e0a\uff0c\u6211\u4eec\u53ea\u8981\u5206\u522b\u7ef4\u62a4\u4e24\u4e2a\u5e8f\u5217\u6b63\u6570\u7684\u6700\u5927\u3001\u6700\u5c0f\u503c\uff0c\u548c\u8d1f\u6570\u7684\u7edd\u5bf9\u503c\u7684\u6700\u5927\u3001\u6700\u5c0f\u503c\uff08\u4e00\u5171\u7ef4\u62a4 $8$ \u4e2a\u4fe1\u606f\uff09\u5373\u53ef\u3002\u7531\u4e8e\u662f\u9759\u6001\u533a\u95f4\u53ef\u7528 ST \u8868\u89e3\u51b3\u533a\u95f4\u6781\u503c\u3002\n\n\u6700\u7ec8\u7684\u65f6\u7a7a\u590d\u6742\u5ea6\u5747\u4e3a $O(n\\log n)$\uff0c\u5e26\u4e00\u4e2a $8$ \u7684\u5e38\u6570\u3002\n\ncode :\n\n```cpp\n#include<iostream>\n#include<cstdio>\nusing namespace std;\nconst int inf=1<<30;\ntypedef long long ll;\nll a[100005],b[100005];int n,m,q,l1,r1,l2,r2,sa[100005],sb[100005],lg2[100005];\nstruct ST\n{\n\tll st[100005][17];\n\tint tp1,tp2;\n\tll query(int l,int r)\n\t{\n\t\tint k=lg2[r-l+1];\n\t\tif(tp1==1) return min(st[l][k],st[r-(1<<k)+1][k]);\n\t\tif(tp1==2) return max(st[l][k],st[r-(1<<k)+1][k]);\n\t}\n\tvoid build(int n,ll *f)\n\t{\n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tif(tp2==1) st[i][0]=(f[i]>=0?f[i]:(tp1==1?inf:-inf));\n\t\t\tif(tp2==2) st[i][0]=(f[i]<0?-f[i]:(tp1==1?inf:-inf));\n\t\t}\n\t\tfor(int i=1;i<=16;i++)\n\t\t\tfor(int j=1;j+(1<<i)-1<=n;j++)\n\t\t\t{\n\t\t\t\tif(tp1==1) st[j][i]=min(st[j][i-1],st[j+(1<<(i-1))][i-1]);\n\t\t\t\tif(tp1==2) st[j][i]=max(st[j][i-1],st[j+(1<<(i-1))][i-1]);\n\t\t\t}\n\t}\n} mxa1,mna1,mxa2,mna2,mxb1,mnb1,mxb2,mnb2;\nint main()\n{\n\tscanf(\"%d%d%d\",&n,&m,&q);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&a[i]);\n\tfor(int i=1;i<=m;i++) scanf(\"%lld\",&b[i]);\n\tfor(int i=1;i<=n;i++) sa[i]=sa[i-1]+(a[i]<0);\n\tfor(int i=1;i<=m;i++) sb[i]=sb[i-1]+(b[i]<0);\n\tfor(int i=2;i<=100000;i++) lg2[i]=lg2[i/2]+1;\n\tmxa1.tp1=2;mxa1.tp2=1;mxa1.build(n,a);\n\tmxa2.tp1=2;mxa2.tp2=2;mxa2.build(n,a);\n\tmna1.tp1=1;mna1.tp2=1;mna1.build(n,a);\n\tmna2.tp1=1;mna2.tp2=2;mna2.build(n,a);\n\tmxb1.tp1=2;mxb1.tp2=1;mxb1.build(m,b);\n\tmxb2.tp1=2;mxb2.tp2=2;mxb2.build(m,b);\n\tmnb1.tp1=1;mnb1.tp2=1;mnb1.build(m,b);\n\tmnb2.tp1=1;mnb2.tp2=2;mnb2.build(m,b);\n\twhile(q--)\n\t{\n\t\tscanf(\"%d%d%d%d\",&l1,&r1,&l2,&r2);\n\t\tint fa1=0,fa2=0,fb1=0,fb2=0;\n\t\tif(sa[r1]-sa[l1-1]==r1-l1+1) fa1=1;\n\t\tif(sa[r1]-sa[l1-1]==0) fa2=1;\n\t\tif(sb[r2]-sb[l2-1]==r2-l2+1) fb1=1;\n\t\tif(sb[r2]-sb[l2-1]==0) fb2=1;\n\t\tll amx1,amx2,amn1,amn2,bmx1,bmx2,bmn1,bmn2;\n\t\tamx1=mxa1.query(l1,r1);\n\t\tamx2=-mxa2.query(l1,r1);\n\t\tamn1=mna1.query(l1,r1);\n\t\tamn2=-mna2.query(l1,r1);\n\t\tbmx1=mxb1.query(l2,r2);\n\t\tbmx2=-mxb2.query(l2,r2);\n\t\tbmn1=mnb1.query(l2,r2);\n\t\tbmn2=-mnb2.query(l2,r2);\n\t\tif(fa1)\n\t\t{\n\t\t\tif(fb1) printf(\"%lld\\n\",amx2*bmn2);\n\t\t\telse printf(\"%lld\\n\",amn2*bmx1);\n\t\t}\n\t\telse if(fa2)\n\t\t{\n\t\t\tif(fb2) printf(\"%lld\\n\",amx1*bmn1);\n\t\t\telse printf(\"%lld\\n\",amn1*bmx2);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(fb1) printf(\"%lld\\n\",amx2*bmn2);\n\t\t\telse if(fb2) printf(\"%lld\\n\",amx1*bmn1);\n\t\t\telse printf(\"%lld\\n\",max(amn1*bmx2,amn2*bmx1));\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1667873618,
        "uid": 153687,
        "name": "donghanwen1225",
        "ccfLevel": 8,
        "title": "CSP-S 2022 T2 \u9898\u89e3"
    },
    {
        "content": "## problem\n\u957f\u5ea6\u4e3a $n$ \u7684\u6570\u7ec4 $a$\uff0c\u957f\u5ea6\u4e3a $m$ \u7684\u6570\u7ec4 $b$\u3002$q$ \u6b21\u535a\u5f08\uff0c\u6bcf\u6b21\u535a\u5f08\u7ed9\u51fa $[l_1,r_1],[l_2,r_2]$\uff0cAlice \u53ef\u4ee5\u9009\u62e9\u4e00\u4e2a $i\\in[l_1,r_1]$\uff0cBob **\u5728\u770b\u5230 Alice \u7684\u9009\u62e9\u540e**\u53ef\u4ee5\u9009\u62e9\u4e00\u4e2a $j\\in[l_2,r_2]$\uff0c\u6700\u7ec8\u6e38\u620f\u7684\u5f97\u5206\u4e3a $a_ib_j$\u3002Alice \u5e0c\u671b\u5f97\u5206\u5c3d\u53ef\u80fd\u5927\uff0cBob \u5e0c\u671b\u5f97\u5206\u5c3d\u53ef\u80fd\u5c0f\uff0c\u5728\u4ed6\u4eec\u90fd\u7edd\u9876\u806a\u660e\u7684\u60c5\u51b5\u4e0b\uff0c\u6bcf\u6b21\u6e38\u620f\u7684\u5f97\u5206\u5404\u662f\u591a\u5c11\uff1f\n\n## solution\n\u6211\u4f1a\u66b4\u529b\uff01\u679a\u4e3e Alice \u548c Bob \u9009\u7684\u6570\uff0c\u90a3\u4e48\u7b54\u6848\u662f\u8fd9\u4e2a\u4e1c\u897f\uff1a\n\n$$[*]=\\max_i\\{\\min_j a_ib_j\\}.$$\n\n\u8003\u8651\u4f18\u5316\u5b83\u3002\u5047\u5982\u6211\u4eec\u6709 $0<x<y<z$\uff0c\u5982\u679c $y$ \u662f\u4e00\u79cd\u51b3\u7b56\uff0c\u90a3\u4e48\u663e\u7136 $x,z$ \u5176\u4e2d\u4e4b\u4e00\u4f1a\u4f18\u4e8e $y$\uff0c\u90a3\u4e48 $y$ \u5c31\u6ca1\u7528\u4e86\u3002\u8d1f\u6570\u4e5f\u662f\u4e00\u6837\u7684\u3002\u7efc\u4e0a\uff0c\u771f\u6b63\u6709\u7528\u7684\u51b3\u7b56\u53ea\u6709 $\\min,\\max_{x<0}x,0,\\min_{x>0}x,\\max$\uff0c\u5176\u5b83\u4e00\u5b9a\u4e0d\u4f1a\u6210\u4e3a\u6700\u4f18\u51b3\u7b56\u3002\n\n\u8fd9\u4e94\u4e2a\u503c\u663e\u7136\u53ef\u4ee5 RMQ\uff0c\u800c\u679a\u4e3e\u90e8\u5206\u7684\u590d\u6742\u5ea6\u4e5f\u964d\u4e3a\u5e38\u6570\uff0c\u4e8e\u662f\u76f4\u63a5\u66b4\u529b\u5c31\u53ef\u4ee5\u4e86\u3002\n\n## code\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\ntypedef long long LL;\nint lg[100010];\ntemplate<int N,int D=1,class T=LL> struct STable{\n\tT f[21][N+10]; int cnt;\n\tSTable():cnt(0){}\n\tvoid insert(T x){\n\t\tf[0][++cnt]=x*D;\n\t\tfor(int j=1;1<<j<=cnt;j++){\n\t\t\tint i=cnt-(1<<j)+1;\n\t\t\tf[j][i]=min(f[j-1][i],f[j-1][i+(1<<(j-1))]);\n\t\t}\n\t}\n\tT query(int l,int r){\n\t\tint k=lg[r-l+1];\n\t\treturn min(f[k][l],f[k][r-(1<<k)+1])*D;\n\t}\n};\nint n,m,q,sa[100010],sb[100010];\nLL a[100010],b[100010];\nSTable<100010,1> tmin[4];\nSTable<100010,-1> tmax[4];\nint main(){\n\t//freopen(\"game.in\",\"r\",stdin),freopen(\"game.out\",\"w\",stdout);\n\tlg[0]=-1; for(int i=1;i<=1e5;i++) lg[i]=lg[i>>1]+1;\n\tscanf(\"%d%d%d\",&n,&m,&q);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%lld\",&a[i]);\n\t\tsa[i]=sa[i-1]+!a[i];\n\t\ttmin[0].insert(a[i]<0?a[i]:1e18);\n\t\ttmin[1].insert(a[i]>0?a[i]:1e18);\n\t\ttmax[0].insert(a[i]<0?a[i]:-1e18);\n\t\ttmax[1].insert(a[i]>0?a[i]:-1e18);\n\t}\n\tfor(int i=1;i<=m;i++){\n\t\tscanf(\"%lld\",&b[i]);\n\t\tsb[i]=sb[i-1]+!b[i];\n\t\ttmin[2].insert(b[i]<0?b[i]:1e18);\n\t\ttmin[3].insert(b[i]>0?b[i]:1e18);\n\t\ttmax[2].insert(b[i]<0?b[i]:-1e18);\n\t\ttmax[3].insert(b[i]>0?b[i]:-1e18);\n\t}\n\tfor(int l,r;q--;){\n\t\tscanf(\"%d%d\",&l,&r);\n\t\tLL pa[]={tmin[0].query(l,r),tmax[0].query(l,r),sa[r]-sa[l-1]?0:(LL)1e18,tmin[1].query(l,r),tmax[1].query(l,r)};\n\t\tscanf(\"%d%d\",&l,&r);\n\t\tLL pb[]={tmin[2].query(l,r),tmax[2].query(l,r),sb[r]-sb[l-1]?0:(LL)1e18,tmin[3].query(l,r),tmax[3].query(l,r)};\n\t\tLL ans=-1e18;\n\t\tfor(int i=0;i<5;i++){\n\t\t\tif(pa[i]==1e18||pa[i]==-1e18) continue;\n\t\t\tLL res=1e18;\n\t\t\tfor(int j=0;j<5;j++){\n\t\t\t\tif(pb[j]==1e18||pb[j]==-1e18) continue;\n\t\t\t\tres=min(res,pa[i]*pb[j]);\n\t\t\t}\n\t\t\tans=max(ans,res);\n\t\t}\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1667134157,
        "uid": 509229,
        "name": "yukimianyan",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8818\u3010[CSP-S 2022] \u7b56\u7565\u6e38\u620f\u3011"
    },
    {
        "content": "[link](https://www.luogu.com.cn/problem/P8818)\n\n\u5386\u5e74\u6765\u6700\u7b80\u5355\u7684 T2\u3002\n\n\u6211\u4eec\u76f4\u63a5\u66b4\u529b\u5206\u8ba8\uff1a\n\n\u9996\u5148\u4e0d\u8003\u8651 $0$\u3002\n\n1. A \u533a\u95f4\u5168\u4e3a\u6b63\u6570\n\n\t(1) B \u533a\u95f4\u5168\u4e3a\u6b63\u6570\uff0cA \u53d6\u6700\u5927\uff0c B \u53d6\u6700\u5c0f\n    \n\t(2) B \u533a\u95f4\u6709\u6b63\u6709\u8d1f\uff0cA \u53d6\u6700\u5c0f\uff0cB \u53d6\u6700\u5c0f\n    \n\t(3) B \u533a\u95f4\u5168\u4e3a\u8d1f\u6570\uff0cA \u53d6\u6700\u5c0f\uff0cB \u53d6\u6700\u5c0f\n    \n2. A \u533a\u95f4\u6709\u6b63\u6709\u8d1f\n\n\t(1) B \u533a\u95f4\u5168\u4e3a\u6b63\u6570\uff0cA \u53d6\u6700\u5927\uff0cB \u53d6\u6700\u5c0f\n    \n\t(2) B \u533a\u95f4\u6709\u6b63\u6709\u8d1f\uff0c$\\max$(A \u6b63\u6570\u6700\u5c0f $\\times$ B \u8d1f\u6570\u6700\u5c0f\uff0cA \u8d1f\u6570\u6700\u5927 $\\times$ B \u6b63\u6570\u6700\u5927)\n    \n\t(3) B \u533a\u95f4\u5168\u4e3a\u8d1f\u6570\uff0cA \u53d6\u6700\u5c0f\uff0cB \u53d6\u6700\u5927\n    \n3. A \u533a\u95f4\u5168\u4e3a\u8d1f\u6570\n\n\t(1) B \u533a\u95f4\u5168\u4e3a\u6b63\u6570\uff0cA \u53d6\u6700\u5927\uff0cB \u53d6\u6700\u5927\n    \n\t(2) B \u533a\u95f4\u6709\u6b63\u6709\u8d1f\uff0cA \u53d6\u6700\u5927\uff0cB \u53d6\u6700\u5927 \n    \n\t(3) B \u533a\u95f4\u5168\u4e3a\u8d1f\u6570\uff0cA \u53d6\u6700\u5c0f\uff0cB \u53d6\u6700\u5927\n\n\u4e0a\u9762\u8fd9\u90e8\u5206\u662f\u7ecf\u5178\u7684 RMQ \u95ee\u9898\uff0c\u4f7f\u7528\u7ebf\u6bb5\u6811/ST \u8868\u89e3\u51b3\u5747\u53ef\u3002\n\n\u56de\u5934\u6765\u770b\u6bd4\u8f83\u7279\u6b8a\u7684 $0$\uff1a\n\n\u82e5 A \u5b58\u5728 $0$\uff0c\u7b54\u6848\u5bf9 $0$ \u53d6 $\\max$\u3002\n\n\u82e5 B \u5b58\u5728 $0$\uff0c\u7b54\u6848\u5bf9 $0$ \u53d6 $\\min$\u3002\n\n\u7136\u540e\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n[code](http://119.27.163.117/submission/25929)",
        "postTime": 1667120088,
        "uid": 341102,
        "name": "ReKoJ",
        "ccfLevel": 0,
        "title": "P8818 [CSP-S 2022] \u7b56\u7565\u6e38\u620f"
    },
    {
        "content": "\u6709\u4e00\u4e2a\u4eba\u5148\u624b\uff0c\u80af\u5b9a\u8981\u9009\u62e9\u4f7f\u5f97\u6700\u574f\u60c5\u51b5\u6700\u4f18\u7684\u70b9\u3002\n\n\u8003\u8651\u5206\u8ba8\u533a\u95f4\u5185\u5143\u7d20\u60c5\u51b5\u3002\n\n1. $a$ \u4e3a\u81ea\u7136\u6570\uff0c$b$ \u4e3a\u81ea\u7136\u6570\u3002\n\n\u5148\u624b\u9009\u62e9 $\\max$\uff0c\u540e\u624b\u9009\u62e9 $\\min$\u3002\n\n2. $a$ \u4e3a\u81ea\u7136\u6570\uff0c$b$ \u4e3a\u8d1f\u6570\u3002\n\n\u5148\u624b\u9009\u62e9 $\\min$\uff0c\u540e\u624b\u9009\u62e9 $\\min$\u3002\u56e0\u4e3a\u5148\u624b\u5982\u9009\u62e9 $\\max$\uff0c\u5219\u540e\u624b\u9009 $\\min$ \u4f1a\u4f7f\u7b54\u6848\u66f4\u5c0f\u3002\n\n3. $a$ \u4e3a\u81ea\u7136\u6570\uff0c$b$ \u65e0\u7279\u6b8a\u9650\u5236\u3002\n\n\u540c 2 \u60c5\u51b5\u3002\n\n4. $a$ \u4e3a\u8d1f\u6570\uff0c$b$ \u4e3a\u81ea\u7136\u6570\u3002\n\n\u5148\u624b\u9009\u62e9 $\\max$\uff0c\u540e\u624b\u9009\u62e9 $\\max$\u3002\u8981\u4f7f\u5f97\u8d1f\u6570 $\\times$ \u6b63\u6570\u6700\u5927\uff0c\u5148\u624b\u9700\u8981\u8ba9\u8d1f\u6570\u7edd\u5bf9\u503c\u66f4\u5c0f\uff0c\u540e\u624b\u5219\u8d2a\u5fc3\u5730\u9009\u62e9\u8ba9\u4e58\u79ef\u66f4\u5c0f\uff0c\u9009\u62e9\u533a\u95f4\u6700\u5927\u503c\u3002\n\n5. $a$ \u4e3a\u8d1f\u6570\uff0c$b$ \u4e3a\u8d1f\u6570\u3002\n\n\u8fd9\u65f6\u5019\u8d1f\u8d1f\u5f97\u6b63\uff0c\u5148\u624b\u9009\u62e9 $\\min$ \u4f1a\u8ba9\u540e\u624b\u88ab\u8feb\u9009\u62e9 $\\max$\u3002\u539f\u56e0\u663e\u7136\u3002\n\n6. $a$ \u4e3a\u8d1f\u6570\uff0c$b$ \u65e0\u7279\u6b8a\u9650\u5236\u3002\n\n\u663e\u7136\u540e\u624b\u8981\u9009\u81ea\u7136\u6570\uff0c\u90a3\u4e48\u5148\u624b\u9009\u62e9 $\\max$\u3002\n\n7. $a$ \u65e0\u7279\u6b8a\u9650\u5236\uff0c$b$ \u4e3a\u81ea\u7136\u6570\u3002\n\n\u5148\u624b\u663e\u7136\u9009 $\\max$\uff0c\u540e\u624b\u663e\u7136\u9009 $\\min$\u3002\n\n8. $a$ \u65e0\u7279\u6b8a\u9650\u5236\uff0c$b$ \u4e3a\u8d1f\u6570\u3002\n\n\u5148\u624b\u663e\u7136\u9009 $\\min$\uff0c\u540e\u624b\u9009 $\\max$\uff0c\u8d1f\u8d1f\u5f97\u6b63\uff0c\u4e58\u79ef\u6700\u5c0f\u3002\n\n9. $a$ \u65e0\u7279\u6b8a\u9650\u5236\uff0c$b$ \u65e0\u7279\u6b8a\u9650\u5236\u3002\n\n\u8003\u8651\u4e24\u79cd\u60c5\u51b5\uff0c\u82e5\u5148\u624b\u9009\u6700\u5c0f\u7684\u81ea\u7136\u6570\uff0c\u5219\u540e\u624b\u4f1a\u9009\u6700\u5c0f\u7684\u8d1f\u6570\u6765\u56de\u5e94\u3002\n\n\u82e5\u5148\u624b\u9009\u6700\u5927\u7684\u8d1f\u6570\uff0c\u5219\u540e\u624b\u4f1a\u9009\u62e9\u6700\u5927\u7684\u81ea\u7136\u6570\u6765\u56de\u5e94\u3002\n\n\u53d6 $\\max$ \u5373\u53ef\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\nusing namespace std;\n\nconst int N = 1e5 + 10, Log = 20, inf = 1e9;\nint n, m, q, lg[N], bn[Log];\nll a[N], b[N], Min[3][Log][N], Max[3][Log][N];\n\ninline ll queryMin(int typ, int l, int r) {\n\tint k = lg[r - l + 1];\n\treturn min(Min[typ][k][l], Min[typ][k][r - bn[k] + 1]);\n} inline ll queryMax(int typ, int l, int r) {\n\tint k = lg[r - l + 1];\n\treturn max(Max[typ][k][l], Max[typ][k][r - bn[k] + 1]);\n}\n\ninline void solve() {\n\tint l1, r1, l2, r2; scanf(\"%d%d%d%d\", &l1, &r1, &l2, &r2);\n\tll Min1 = queryMin(0, l1, r1), Max1 = queryMax(0, l1, r1);\n\tll Min2 = queryMin(1, l2, r2), Max2 = queryMax(1, l2, r2);\n\tll ans = 0;\n\tif (Min1 >= 0) {\n\t\tif (Min2 >= 0) ans = Max1 * Min2;\n\t\telse if (Max2 < 0) ans = Min1 * Min2;\n\t\telse ans = Min1 * Min2;\n\t} else if (Max1 < 0) {\n\t\tif (Min2 >= 0) ans = Max1 * Max2;\n\t\telse if (Max2 < 0) ans = Min1 * Max2;\n\t\telse ans = Max1 * Max2;\n\t} else {\n\t\tif (Min2 >= 0) ans = Max1 * Min2;\n\t\telse if (Max2 < 0) ans = Min1 * Max2;\n\t\telse {\n\t\t\tll fi = queryMin(2, l1, r1), se = queryMax(2, l1, r1);\n\t\t\tans = max(fi * Min2, se * Max2);\n\t\t}\n\t}\n\tprintf(\"%lld\\n\", ans); return ;\n}\n\nint main() {\n\tscanf(\"%d%d%d\", &n, &m, &q);\n\tfor (int i = 1; i <= n; ++i) scanf(\"%lld\", &a[i]);\n\tfor (int i = 1; i <= m; ++i) scanf(\"%lld\", &b[i]);\n\tbn[0] = 1; for (int i = 1; i < Log; ++i) bn[i] = bn[i - 1] << 1;\n\tlg[0] = -1; for (int i = 1; i < N; ++i) lg[i] = lg[i >> 1] + 1;\n\tfor (int i = 1; i <= n; ++i) Min[0][0][i] = Max[0][0][i] = a[i];\n\tfor (int i = 1; i < Log; ++i)\n\t  for (int j = 1; j + bn[i] - 1 <= n; ++j) {\n\t  \tMin[0][i][j] = min(Min[0][i - 1][j], Min[0][i - 1][j + bn[i - 1]]);\n\t  \tMax[0][i][j] = max(Max[0][i - 1][j], Max[0][i - 1][j + bn[i - 1]]);\n\t\t}\n\tfor (int i = 1; i <= m; ++i) Min[1][0][i] = Max[1][0][i] = b[i];\n\tfor (int i = 1; i < Log; ++i)\n\t  for (int j = 1; j + bn[i] - 1 <= m; ++j) {\n\t\t  Min[1][i][j] = min(Min[1][i - 1][j], Min[1][i - 1][j + bn[i - 1]]);\n\t\t  Max[1][i][j] = max(Max[1][i - 1][j], Max[1][i - 1][j + bn[i - 1]]);\n\t  }\n  for (int i = 1; i <= n; ++i) {\n  \tif (a[i] >= 0) Min[2][0][i] = a[i]; else Min[2][0][i] = inf;\n  \tif (a[i] < 0) Max[2][0][i] = a[i]; else Max[2][0][i] = -inf;\n\t}\n\tfor (int i = 1; i < Log; ++i)\n\t  for (int j = 1; j + bn[i] - 1 <= n; ++j) {\n\t  \tMin[2][i][j] = min(Min[2][i - 1][j], Min[2][i - 1][j + bn[i - 1]]);\n\t  \tMax[2][i][j] = max(Max[2][i - 1][j], Max[2][i - 1][j + bn[i - 1]]);\n\t\t}\n  while (q--) solve();\n  return 0;\n}\n```",
        "postTime": 1667873876,
        "uid": 487752,
        "name": "MistZero",
        "ccfLevel": 0,
        "title": "P8818 \u7b56\u7565\u6e38\u620f Sol"
    },
    {
        "content": "\u524d\u7f6e\u829d\u58eb\uff1a[ST \u8868](https://oi-wiki.org/ds/sparse-table/)\n\n\u9996\u5148\u663e\u7136\u8981\u5206\u5c0f L \u9009\u4e86\u6b63 / $0$ / \u8d1f\u8ba8\u8bba\u4e24\u4eba\u7684\u7b56\u7565\u3002\n\n1. \u5c0f L \u9009\u6b63\u6570\n\n\u82e5 $[l_2, r_2]$ \u4e2d\u6709\u8d1f\u6570\uff0c\u5c0f L \u80af\u5b9a\u8981\u9009\u7edd\u5bf9\u503c\u6700\u5c0f\u7684\u6b63\u6570\uff0c\u5c0f Q \u80af\u5b9a\u8981\u9009\u7edd\u5bf9\u503c\u6700\u5927\u7684\u8d1f\u6570\u3002\n\n\u82e5 $[l_2, r_2]$ \u4e2d\u6ca1\u6709\u8d1f\u6570\uff0c\u5c0f L \u80af\u5b9a\u8981\u9009\u6700\u5927\u7684\u6b63\u6570\uff0c\u5c0f Q \u80af\u5b9a\u8981\u9009\u7edd\u5bf9\u503c\u6700\u5c0f\u7684\u975e\u8d1f\u6570\u3002\n\n2. \u5c0f L \u9009 $0$\n\n\u6b64\u65f6\u7b54\u6848\u6052\u4e3a $0$\u3002\n\n3. \u5c0f L \u9009\u8d1f\u6570\n\n\u82e5 $[l_2, r_2]$ \u4e2d\u6709\u6b63\u6570\uff0c\u5c0f L \u80af\u5b9a\u8981\u9009\u7edd\u5bf9\u503c\u6700\u5c0f\u7684\u8d1f\u6570\uff0c\u5c0f Q \u80af\u5b9a\u8981\u9009\u7edd\u5bf9\u503c\u6700\u5927\u7684\u6b63\u6570\u3002\n\n\u82e5 $[l_2, r_2]$ \u4e2d\u6ca1\u6709\u6b63\u6570\uff0c\u5c0f L \u80af\u5b9a\u8981\u9009\u6700\u5c0f\u7684\u8d1f\u6570\uff0c\u5c0f Q \u80af\u5b9a\u8981\u9009\u7edd\u5bf9\u503c\u6700\u5c0f\u7684\u975e\u6b63\u6570\u3002\n\nST \u8868\u7ef4\u62a4\u4e0a\u8ff0\u6240\u6709 RMQ \u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n \\log n + m \\log m + q)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <stdio.h>\n#include <math.h>\n\ntypedef long long ll;\n\ninline int min(int a, int b){\n\treturn a < b ? a : b;\n}\n\ninline int max(int a, int b){\n\treturn a > b ? a : b;\n}\n\ntypedef struct {\n\tint st_min[100007][17], st_max[100007][17], st_neg_abs_min[100007][17], st_non_pos_min[100007][17], st_non_neg_min[100007][17], st_pos_min[100007][17];\n\t\n\tinline void init(int n, int a[]){\n\t\tint m = log2(n);\n\t\tfor (register int i = 1; i <= n; i++){\n\t\t\tst_min[i][0] = st_max[i][0] = a[i];\n\t\t\tst_neg_abs_min[i][0] = a[i] < 0 ? a[i] : 0x80000000;\n\t\t\tst_non_pos_min[i][0] = a[i] <= 0 ? a[i] : 0x80000000;\n\t\t\tst_non_neg_min[i][0] = a[i] >= 0 ? a[i] : 0x7fffffff;\n\t\t\tst_pos_min[i][0] = a[i] > 0 ? a[i] : 0x7fffffff;\n\t\t}\n\t\tfor (register int i = 1; i <= m; i++){\n\t\t\tint id = i - 1, t1 = n - (1 << i) + 1, t2 = 1 << id;\n\t\t\tfor (register int j = 1; j <= t1; j++){\n\t\t\t\tint t3 = j + t2;\n\t\t\t\tst_min[j][i] = min(st_min[j][id], st_min[t3][id]);\n\t\t\t\tst_max[j][i] = max(st_max[j][id], st_max[t3][id]);\n\t\t\t\tst_neg_abs_min[j][i] = max(st_neg_abs_min[j][id], st_neg_abs_min[t3][id]);\n\t\t\t\tst_non_pos_min[j][i] = max(st_non_pos_min[j][id], st_non_pos_min[t3][id]);\n\t\t\t\tst_non_neg_min[j][i] = min(st_non_neg_min[j][id], st_non_neg_min[t3][id]);\n\t\t\t\tst_pos_min[j][i] = min(st_pos_min[j][id], st_pos_min[t3][id]);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tinline int get_min(int l, int r){\n\t\tint t = log2(r - l + 1);\n\t\treturn min(st_min[l][t], st_min[r - (1 << t) + 1][t]);\n\t}\n\t\n\tinline int get_non_pos_min(int l, int r){\n\t\tint t = log2(r - l + 1);\n\t\treturn max(st_non_pos_min[l][t], st_non_pos_min[r - (1 << t) + 1][t]);\n\t}\n\t\n\tinline int get_neg_abs_min(int l, int r){\n\t\tint t = log2(r - l + 1);\n\t\treturn max(st_neg_abs_min[l][t], st_neg_abs_min[r - (1 << t) + 1][t]);\n\t}\n\t\n\tinline int get_max(int l, int r){\n\t\tint t = log2(r - l + 1);\n\t\treturn max(st_max[l][t], st_max[r - (1 << t) + 1][t]);\n\t}\n\t\n\tinline int get_non_neg_min(int l, int r){\n\t\tint t = log2(r - l + 1);\n\t\treturn min(st_non_neg_min[l][t], st_non_neg_min[r - (1 << t) + 1][t]);\n\t}\n\t\n\tinline int get_pos_min(int l, int r){\n\t\tint t = log2(r - l + 1);\n\t\treturn min(st_pos_min[l][t], st_pos_min[r - (1 << t) + 1][t]);\n\t}\n} ST;\n\nST st1, st2;\nint a[100007], posa[100007], zeroa[100007], nega[100007], b[100007], posb[100007], zerob[100007], negb[100007];\n\ninline ll max(ll a, ll b){\n\treturn a > b ? a : b;\n}\n\nint main(){\n\tint n, m, q;\n\tscanf(\"%d %d %d\", &n, &m, &q);\n\tfor (register int i = 1; i <= n; i++){\n\t\tscanf(\"%d\", &a[i]);\n\t\tnega[i] = nega[i - 1] + (a[i] < 0 ? 1 : 0);\n\t\tzeroa[i] = zeroa[i - 1] + (a[i] == 0 ? 1 : 0);\n\t\tposa[i] = posa[i - 1] + (a[i] > 0 ? 1 : 0);\n\t}\n\tfor (register int i = 1; i <= m; i++){\n\t\tscanf(\"%d\", &b[i]);\n\t\tnegb[i] = negb[i - 1] + (b[i] < 0 ? 1 : 0);\n\t\tzerob[i] = zerob[i - 1] + (b[i] == 0 ? 1 : 0);\n\t\tposb[i] = posb[i - 1] + (b[i] > 0 ? 1 : 0);\n\t}\n\tst1.init(n, a);\n\tst2.init(m, b);\n\tfor (register int i = 1; i <= q; i++){\n\t\tint l1, r1, l2, r2;\n\t\tll ans = 0x8000000000000000ll;\n\t\tscanf(\"%d %d %d %d\", &l1, &r1, &l2, &r2);\n\t\tif (nega[r1] - nega[l1 - 1] > 0){\n\t\t\tint x, y;\n\t\t\tif (posb[r2] - posb[l2 - 1] == 0){\n\t\t\t\tx = st1.get_min(l1, r1);\n\t\t\t\ty = st2.get_non_pos_min(l2, r2);\n\t\t\t} else {\n\t\t\t\tx = st1.get_neg_abs_min(l1, r1);\n\t\t\t\ty = st2.get_max(l2, r2);\n\t\t\t}\n\t\t\tans = (ll)x * y;\n\t\t}\n\t\tif (zeroa[r1] - zeroa[l1 - 1] > 0 && ans < 0) ans = 0;\n\t\tif (posa[r1] - posa[l1 - 1] > 0){\n\t\t\tint x, y;\n\t\t\tif (negb[r2] - negb[l2 - 1] == 0){\n\t\t\t\tx = st1.get_max(l1, r1);\n\t\t\t\ty = st2.get_non_neg_min(l2, r2);\n\t\t\t} else {\n\t\t\t\tx = st1.get_pos_min(l1, r1);\n\t\t\t\ty = st2.get_min(l2, r2);\n\t\t\t}\n\t\t\tans = max(ans, (ll)x * y);\n\t\t}\n\t\tprintf(\"%lld\\n\", ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1667127646,
        "uid": 201007,
        "name": "Leasier",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P8818 \u3010[CSP-S 2022] \u7b56\u7565\u6e38\u620f\u3011"
    }
]