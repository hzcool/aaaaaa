[
    {
        "content": "## \u524d\u8a00\n\n\u867d\u7136 $\\Theta(n\\log^2n)$ \u4e5f\u80fd\u8fc7\uff0c\u4f46\u662f\u6ca1\u4ec0\u4e48\u610f\u4e49\uff0c\u53ea\u662f**\u8dd1\u7684\u5c31\u662f\u6bd4 $\\Theta(n\\log n)$ \u5feb**\u3002\n\n\u5728\u6211\u7684\u535a\u5ba2\u91cc\u770b\u53ef\u80fd\u516c\u5f0f\u4f1a\u66f4\u597d\u770b\u3002\n\n## Euler \u53d8\u6362\u7b80\u4ecb\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e0b\u5e42\u7ea7\u6570\u7684 $\\text{Euler}$ \u53d8\u6362\u3002\n\n$\\text{Euler}$ \u53d8\u6362\u7684\u5176\u4e2d\u4e00\u4e2a\u5b9a\u4e49\u5f0f\u5982\u4e0b\uff1a\n\n$$\\mathcal E(F(x))=\\prod_i{\\dfrac{1}{(1-x^i)^{f_i}}}$$\n\n\u8fd9\u4e2a\u53d8\u6362\u7c7b\u4f3c\u4e8e $\\text{EGF}$ \u4e2d\u7684 $\\exp$\u3002\n\n$$\\exp F(x)=\\sum_i\\dfrac{F^i(x)}{i!}$$\n\n$\\text{EGF}$ \u7684 $\\exp$ \u5177\u6709\u7684\u7ec4\u5408\u610f\u4e49\u662f\uff1a\u5c06 $1\\sim n$ \u5206\u6210\u82e5\u5e72**\u975e\u7a7a**\u7ec4\uff0c\u5927\u5c0f\u4e3a $i$ \u7684\u7ec4\u5185\u90e8\u5177\u6709 $f_i$ \u4e2d\u65b9\u6848\uff0c\u95ee\u6700\u540e\u7684\u603b\u65b9\u6848\u6570\u3002\n\n\u800c $\\text{Euler}$ \u53d8\u6362\u5c31\u662f**\u53bb\u9664\u4e86\u8fd9\u4e2a\u6807\u53f7**\u7684\u65b9\u6848\u6570\uff0c\u53bb\u6389\u6807\u53f7\u4f1a\u5bfc\u81f4\u300c\u5982\u679c\u4e24\u4e2a\u7ec4**\u5927\u5c0f\u548c\u5185\u90e8\u65b9\u6848\u5747\u76f8\u540c**\uff0c\u5219\u5b83\u4eec\u4e0d\u53ef\u533a\u5206\u300d\u3002\n\n\u56e0\u6b64 $\\text{Euler}$ \u7684\u7b2c\u4e00\u4e2a\u5b9a\u4e49\u5f0f\u5c31\u6613\u61c2\u4e86\u3002\uff08\u5373\u5927\u5c0f\u4e3a $i$ \u7684\u6bcf\u79cd\u5185\u90e8\u65b9\u6848\u90fd\u53ef\u4ee5\u9009\u82e5\u5e72\u4e2a\uff0c\u6bcf\u79cd\u5185\u90e8\u65b9\u6848\u7684\u751f\u6210\u51fd\u6570\u90fd\u662f $(1-x^i)^{-1}$\u3002\uff09\n\n\u73b0\u5728\u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u5f97\u5230 $\\text{Euler}$ \u53d8\u6362\u7684\u7b2c\u4e8c\u4e2a\u5b9a\u4e49\u5f0f\u3002\n\n### \u65b9\u6cd5\u4e00\uff1a\u4f7f\u7528\u6307\u6570\u3001\u5bf9\u6570\u65b9\u6cd5\n\n$$\\mathcal E(F(x))=\\exp\\left(\\sum_i\\ln\\dfrac{1}{(1-x^i)^{f_i}}\\right)\n$$\n$$=\\exp\\left(\\sum_i-f_i\\ln(1-x^i)\\right)$$\n$$=\\exp\\left(\\sum_if_i\\sum_{j}\\dfrac{x^{ij}}j\\right)$$\n$$=\\exp\\left(\\sum_j\\dfrac 1j\\sum_if_ix^{ij}\\right)$$\n$$=\\exp\\left(\\sum_j\\dfrac{F(x^j)}j\\right)$$\n\n\u56e0\u6b64\u6211\u4eec\u5f97\u5230\u4e86 $\\text{Euler}$ \u53d8\u6362\u7684\u7b2c\u4e8c\u4e2a\u5b9a\u4e49\u5f0f\u3002\n\n### \u65b9\u6cd5\u4e8c\uff1a\u4f7f\u7528 $\\text{Burnside}$ \u5f15\u7406 / $\\text{P\u00f3lya}$ \u5b9a\u7406\n\n\u9996\u5148\u679a\u4e3e\u5206\u6210\u51e0\u4e2a\u7ec4\uff0c\u8bbe\u6709 $n$ \u4e2a\u3002\n\n\u8fd9\u6837\u7684\u8bdd\uff0c\u5bb9\u6613\u53d1\u73b0\u5b9a\u7406\u4e2d\u7684\u7f6e\u6362\u7fa4\u5373\u4e3a **$n$ \u5143\u5bf9\u79f0\u7fa4 $S_n$**\u3002\n\n**\u5b9a\u7406\u5185\u5bb9\u5373\uff1a\u5bf9\u6240\u6709\u7684 $n$ \u5143\u7f6e\u6362\uff0c\u6c42\u5728\u8be5\u7f6e\u6362\u4f5c\u7528\u4e0b\u4e0d\u52a8\u70b9\u4e2a\u6570\u7684\u5e73\u5747\u503c\u3002**\n\n\u8fd9\u65f6\u5019\u8003\u8651 $k$ \u4e2a\u4f4d\u7f6e\u6784\u6210 $k$ \u9636\u5faa\u73af\u7684**\u6307\u6570\u751f\u6210\u51fd\u6570**\uff1a\n\n\u6b64\u65f6\u8fd9 $k$ \u4e2a\u4f4d\u7f6e\u5fc5\u987b\u9009\u62e9\u540c\u6837\u7684\u65b9\u6848\uff0c\u56e0\u6b64\u53ef\u4ee5\u770b\u505a\u4e00\u4e2a\u67d0\u4e2a\u65b9\u6848\u5927\u5c0f\u6269\u5927\u4e86 $k$ \u500d\u3002\u540c\u65f6 $k$ \u4e2a\u4f4d\u7f6e\u6784\u6210\u5faa\u73af\u65b9\u6848\u6570\u5373\u5706\u6392\u5217\u4e3a $(k-1)!$\u3002\n\n\u56e0\u6b64\u8fd9\u4e2a $\\text{EGF}$ \u4e3a\n\n$$C_k(x)=\\dfrac{1}{k!}(k-1)!\\cdot F(x^k)=\\dfrac{F(x^k)}{k}$$\n\n\u6839\u636e $\\exp$ \u7684\u7ec4\u5408\u610f\u4e49\uff0c\u53ef\u4ee5\u60f3\u5230\u5c06\u6240\u6709 $C_k(x)$ \u76f8\u52a0\uff0c\u518d\u505a $\\exp$ \u5f97\u5230\u6240\u6709\u7f6e\u6362\u7684\u8d21\u732e\u3002\n\n\u4e8b\u5b9e\u4e0a\u8fd9\u662f\u6b63\u786e\u7684\uff0c\u539f\u56e0\u662f\u5b9a\u7406\u4e2d\u7684\u9664\u4ee5\u7f6e\u6362\u7fa4\u5927\u5c0f\uff08\u5373 $n!$\uff09\u4e0e $\\text{EGF}$ \u5f97\u5230\u65b9\u6848\u6570\u65f6\u4e58\u7684 $n!$ \u62b5\u6d88\u4e86\u3002\uff08\u96be\u7406\u89e3\u7684\u8bdd\u53ef\u4ee5**\u591a\u8bbe\u4e00\u4e2a\u53d8\u5143\u8868\u793a\u7f6e\u6362\u7684\u5927\u5c0f**\u4ee5\u66f4\u597d\u5730\u7406\u89e3\uff09\n\n\u540c\u6837\u5f97\u5230\u4e86\u90a3\u4e2a\u5b9a\u4e49\u5f0f\uff1a\n\n$$\\mathcal E(F(x))=\\exp\\left(\\sum_k\\dfrac{F(x^k)}k\\right)$$\n\n## \u56de\u5230\u539f\u95ee\u9898\n\n### \u89e3\u51b3\u65e0\u6807\u53f7\u6709\u6839\u6811\u8ba1\u6570\u95ee\u9898\n\n\u9996\u5148\u89e3\u51b3**\u65e0\u6807\u53f7\u6709\u6839\u6811**\u7684\u95ee\u9898\u3002\n\n\u5bb9\u6613\u53d1\u73b0\uff0c\u7ed9\u5b9a\u6839\u4ee5\u540e\uff0c\u6240\u6709\u7684\u5b50\u6811\u53ef\u4ee5\u7406\u89e3\u6210\u6784\u6210\u5927\u5c0f\u4e3a $n-1$ \u7684\u82e5\u5e72\u4e2a\u7ec4\u3002\n\n\u56e0\u6b64\u6211\u4eec\u9700\u8981\u89e3\u7684\u65b9\u7a0b\u5373\uff1a\n\n$$F(x)=x\\cdot\\mathcal E(F(x))$$\n\n#### \u65b9\u6cd5\u4e00\uff1a\u5148\u6c42\u5bfc\u518d\u4f7f\u7528\u5206\u6cbb $\\text{FFT}$ \u89e3\u51b3\n\n\u5c06\u4e0a\u5f0f\u4e24\u8fb9\u6c42\u5bfc\u518d\u540c\u65f6\u4e58\u4e0a $x$\uff08\u5373\u4f7f\u7528 $\\vartheta$ \u7b97\u5b50\uff0c$x^n$ \u9879\u7684\u7cfb\u6570\u4e58\u4ee5 $n$\uff09\u3002\n\n\u8fd9\u91cc\u7565\u53bb\u4e86\u4e00\u4e9b\u4e2d\u95f4\u6b65\u9aa4\u3002\n\n$$\\vartheta F(x)=F(x)+F(x)\\left(\\sum_{k\\geq 1}F'(x^k)x^k\\right)$$\n\n\u8bbe $G(x)=\\sum\\limits_kF'(x^k)x^k$\u3002\n\n\u53ef\u4ee5\u89c2\u5bdf\u5230 $g_n=\\sum\\limits_{d|n}f_d\\cdot d$\u3002\n\n\u56e0\u6b64 $f_n=\\dfrac{1}{n-1}\\left(\\displaystyle\\sum_{k}f_kg_{n-k}\\right)$\uff0c$f_1=1$\u3002\n\n\u6b64\u65f6\u4fbf\u53ef\u4ee5\u4f7f\u7528\u5206\u6cbb $\\text{FFT}$ \u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n\n#### \u65b9\u6cd5\u4e8c\uff1a$\\text{Newton}$ \u8fed\u4ee3\u6cd5\n\n\u6211\u4eec\u9700\u8981\u89e3\u7684\u65b9\u7a0b\u662f\uff1a\n\n$$G(F(x))=F(x)-x\\cdot\\mathcal E(F(x))$$\n\n\u5047\u8bbe\u5f53\u524d\u5df2\u7ecf\u6c42\u51fa\u4e86 $F(x)\\bmod{x^n}$\uff0c\u9700\u8981\u6c42 $F(x)\\bmod{x^{2n}}$\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u7684\u662f\u5bf9 $k\\geq 2$\uff0c\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u4e86 $F(x^k)\\mod {x^{2n}}$ \u7684\u503c\u3002\n\n\u8fd9\u65f6\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u5e38\u6570\u6765\u4ee3\u66ff\u5b83\u3002\uff08\u5f3a\u8c03\u4e00\u4e0b**\u8fd9\u4e0d\u4ee3\u8868\u5b83\u539f\u6765\u662f\u4e00\u4e2a\u5e38\u6570**\uff0c\u4e5f\u5c31\u662f\u8bf4 $F(x^2)$ \u5bf9 $F(x)$ \u6c42\u5bfc\u5e76\u4e0d\u662f $0$\uff09\u3002\n\n\u8bbe\n\n$$P(x)=\\left(x\\exp\\left(\\sum_{k\\geq 2}\\dfrac{F(x^k)}k\\right)\\right)\\bmod{x^{2n}}$$\n\n\u7531\u4e8e $P(x)$ \u662f\u6211\u4eec\u89c4\u5b9a\u7684\u4e00\u4e2a\u5e38\u6570\uff0c\u5219 \n\n$$F(x)\\equiv P(x)\\exp F(x)\\pmod{x^{2n}}$$\n\n\u8fd9\u4e2a\u5f62\u5f0f\u5c31\u6613\u4e8e $\\text{Newton}$ \u8fed\u4ee3\u4e86\uff0c\u5177\u4f53\u8fc7\u7a0b\u4e0d\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u3002\n\n\u4e8b\u5b9e\u4e0a\u8fd9\u4e2a\u65b9\u6cd5\u9700\u8981\u505a $\\exp$\uff0c\u5bfc\u81f4\u5e38\u6570\u6bd4\u8f83\u5927\uff0c\u5b9e\u73b0\u4e0d\u4f18\u79c0\u5f88\u6709\u53ef\u80fd\u6bd4\u524d\u4e00\u4e2a\u65b9\u6cd5\u6162\u3002\n\n### \u89e3\u51b3\u65e0\u6807\u53f7\u65e0\u6839\u6811\u8ba1\u6570\u95ee\u9898\n\n\u8fd9\u4e2a\u95ee\u9898\u601d\u8def\u5927\u6982\u662f\uff1a\u7528\u6709\u6839\u6811\u7684\u65b9\u6848\u51cf\u53bb\u6839\u4e0d\u662f\u91cd\u5fc3\u7684\u65b9\u6848\u3002\n\n**\u5f53 $n$ \u662f\u5947\u6570\u65f6**\uff1a\n\n\u5982\u679c\u6839\u4e0d\u662f\u91cd\u5fc3\uff0c\u5fc5\u7136\u5b58\u5728\u6070\u597d\u4e00\u4e2a\u5b50\u6811\uff0c\u5b83\u7684\u5927\u5c0f\u8d85\u8fc7 $\\left\\lfloor\\dfrac n2\\right\\rfloor$\uff08\u8bbe\u5b83\u7684\u5927\u5c0f\u4e3a $k$\uff09\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5b50\u6811\u548c\u8fd9\u68f5\u5b50\u6811\u4ee5\u5916\u7684\u5176\u4ed6\u70b9\u7684\u65b9\u6848\u6570\u6070\u597d\u4e3a $f_k\\cdot f_{n-k}$\uff08\u53ef\u4ee5\u770b\u6210\u4e24\u68f5\u6709\u6839\u6811\uff09\u3002\n\n\u56e0\u6b64\u7b54\u6848\u4e3a\n$$f_n-\\sum_{k=\\lfloor\\frac n2\\rfloor+1}^{n-1}f_k\\cdot f_{n-k}$$\n\n**\u5f53 $n$ \u662f\u5076\u6570\u65f6**\uff1a\n\n\u51fa\u73b0\u7684\u95ee\u9898\u662f\uff0c\u6709\u53ef\u80fd\u5b58\u5728\u4e24\u4e2a\u91cd\u5fc3\uff0c\u4e14\u5176\u4e2d\u4e00\u4e2a\u662f\u6839\uff08\u5373\u5b58\u5728\u4e00\u68f5\u5b50\u6811\u5927\u5c0f\u6070\u4e3a $\\dfrac n2$\uff09\u3002\n\n\u90a3\u4e48\u5982\u679c\u8fd9\u4e2a\u5b50\u6811\u548c\u5265\u79bb\u8be5\u5b50\u6811\u540e\u7684\u6811\u5b8c\u5168\u76f8\u540c\uff0c\u8fd9\u6837\u7684\u65b9\u6848\u5728 $f_n$ \u53ea\u4f1a\u8ba1\u7b97\u4e00\u6b21\uff0c\u5373\u4e0d\u9700\u8981\u51cf\u53bb\u3002\n\n\u5982\u679c\u8fd9\u4e2a\u5b50\u6811\u548c\u53e6\u4e00\u68f5\u6811\u4e0d\u76f8\u540c\uff0c\u4f1a\u88ab\u7edf\u8ba1\u4e24\u6b21\uff0c\u9700\u8981\u51cf\u6389\u4e00\u6b21\u3002\n\n\u56e0\u6b64\u5076\u6570\u65f6\u989d\u5916\u51cf\u6389\u7684\u65b9\u6848\u6570\u4e3a\n\n$$\\binom{f_{\\frac n2}}2$$\n\n**\u81f3\u6b64\uff0c\u8fd9\u4e2a\u95ee\u9898\u5728 $O(n\\log n)$ \u6216 $O(n\\log^2n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u89e3\u51b3**\u3002\n\n### \u53c2\u8003\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n\ntypedef long long LL;\ntypedef unsigned long long ULL;\nconst int mod = 998244353, N = 262144;\n\nint wn[N], lim, s, rev[N], w[N];\nvoid reduce(int &x) { x += x >> 31 & mod; }\nint pow(int x, int y, int ans = 1) {\n\tfor (; y; y >>= 1, x = (LL) x * x % mod)\n\t\tif (y & 1) ans = (LL) ans * x % mod;\n\treturn ans;\n}\nvoid fftinit(int len) {\n\twn[0] = lim = 1, s = -1; while (lim < len) lim <<= 1, ++s;\n\tfor (int i = 0; i < lim; ++i) rev[i] = rev[i >> 1] >> 1 | (i & 1) << s;\n\tconst int g = pow(3, (mod - 1) / lim);\n\tfor (int i = 1; i < lim; ++i) wn[i] = (LL) wn[i - 1] * g % mod;\n}\nvoid fft(int *A, int typ) {\n\tstatic ULL tmp[N];\n\tfor (int i = 0; i < lim; ++i) tmp[rev[i]] = A[i];\n\tfor (int i = 1; i < lim; i <<= 1) {\n\t\tfor (int j = 0, t = lim / i / 2; j < i; ++j) w[j] = wn[j * t];\n\t\tfor (int j = 0; j < lim; j += i << 1)\n\t\t\tfor (int k = 0; k < i; ++k) {\n\t\t\t\tconst ULL x = tmp[k + j + i] * w[k] % mod;\n\t\t\t\ttmp[k + j + i] = tmp[k + j] + mod - x, tmp[k + j] += x;;\n\t\t\t}\n\t}\n\tfor (int i = 0; i < lim; ++i) A[i] = tmp[i] % mod;\n\tif (!typ) {\n\t\tconst int il = pow(lim, mod - 2); std::reverse(A + 1, A + lim);\n\t\tfor (int i = 0; i < lim; ++i) A[i] = (LL) A[i] * il % mod;\n\t}\n}\n\nint inv[N];\nint f[N], g[N], n;\nint a[N], b[N];\n\nvoid init(int n) {\n\tinv[0] = 1, inv[1] = 1;\n\tfor (int i = 2; i < n; ++i)\n\t\tinv[i] = (LL) (mod - mod / i) * inv[mod % i] % mod;\n}\n\nvoid solve(int l, int r) {\n\tif (r - l <= 32) {\n\t\tfor (int i = l; i < r; ++i) {\n\t\t\tfor (int j = l; j < i; ++j) {\n\t\t\t\tf[i] = (f[i] + (LL) f[j] * g[i - j]) % mod;\n\t\t\t\tif (l > 1) f[i] = (f[i] + (LL) g[j] * f[i - j]) % mod;\n\t\t\t}\n\t\t\tf[i] = (LL) f[i] * inv[i - 1] % mod;\n\t\t\tint v = (LL) f[i] * i % mod;\n\t\t\tfor (int p = i; p <= n; p += i) reduce(g[p] += v - mod);\n\t\t}\n\t\treturn;\n\t}\n\tint mid = l + r + 1 >> 1;\n\tsolve(l, mid), fftinit(r - l);\n\tauto update = [&] (int *f, int la, int *g, int lb) {\n\t\tstd::memcpy(a, f, la << 2), std::memset(a + la, 0, lim - la << 2);\n\t\tstd::memcpy(b, g, lb << 2), std::memset(b + lb, 0, lim - lb << 2);\n\t\tfft(a, 1), fft(b, 1);\n\t\tfor (int i = 0; i < lim; ++i) a[i] = (LL) a[i] * b[i] % mod;\n\t\tfft(a, 0);\n\t\tfor (int i = mid; i < r; ++i) reduce(::f[i] += a[i - l] - mod);\n\t};\n\tif (l > 1) update(f + l, mid - l, g, r - l);\n\tupdate(g + l, mid - l, f, l == 1 ? mid : r - l);\n\tsolve(mid, r);\n}\n\nint main() {\n\tstd::ios::sync_with_stdio(0), std::cin.tie(0);\n\tstd::cin >> n, f[1] = 1, init(n), solve(1, n + 1);\n\tint ans = f[n];\n\tfor (int i = n / 2 + 1; i < n; ++i)\n\t\tans = (ans + (LL) (mod - f[i]) * f[n - i]) % mod;\n\tif (n % 2 == 0) ans = (ans + mod - (LL) f[n / 2] * (f[n / 2] - 1) / 2 % mod) % mod;\n\tstd::cout << ans << '\\n';\n\treturn 0;\n}\n```\n",
        "postTime": 1578227353,
        "uid": 26127,
        "name": "Weng_Weijie",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5900 \u3010\u65e0\u6807\u53f7\u65e0\u6839\u6811\u8ba1\u6570\u3011"
    },
    {
        "content": "\u8bben\u4e2a\u70b9\u7684\u65e0\u6807\u53f7\u6709\u6839\u6811\u6709$f_n$\u4e2a\uff0c\u5bf9\u5e94\u7684\u751f\u6210\u51fd\u6570\u4e3a$F(x)$\u3002\n\n\u5bf9\u4e8e\u4e00\u68f5\u6811\u800c\u8a00\uff0c\u53bb\u6389\u6839\u8282\u70b9\u4e4b\u540e\u7684\u5404\u4e2a\u90e8\u5206\u4e92\u4e0d\u5173\u8054\uff0c\u53c8\u56e0\u4e3a\u6ca1\u6709\u6807\u53f7\uff0c\u6240\u4ee5\u53ef\u4ee5\u770b\u4f5c\u662f\u4e00\u4e2a\u80cc\u5305\u7684\u5173\u7cfb\u3002\u90a3\u4e48\u679a\u4e3e\u4e0e\u6839\u76f8\u8fde\u7684\u5b50\u6811\u5927\u5c0f\uff0c\u5c06\u80cc\u5305\u7684\u751f\u6210\u51fd\u6570\u5957\u8fdb\u53bb\uff1a\n\n$$f_n=[x^n]x\\prod_{k=1}^{\\infty}(\\sum_{i=0}^{\\infty}x^{ik})^{f_k}$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u76f8\u5f53\u4e8e\u679a\u4e3e\u5927\u5c0f\u4e3a$k$\u7684\u5b50\u6811\uff0c\u56e0\u4e3a\u5927\u5c0f\u4e3a$k$\u7684\u5b50\u6811\u6709$f_k$\u79cd\u9009\u6cd5\uff0c\u6bcf\u4e00\u79cd\u6709\u90fd\u6709\u65e0\u9650\u591a\u4e2a\uff0c\u6240\u4ee5\u603b\u8d21\u732e\u662f\u53f3\u8fb9\u90a3\u4e00\u5806\u4e1c\u897f\u3002\u800c\u8fd9\u4e2a\u603b\u8d21\u732e\u6709\u6ca1\u6709\u8ba1\u7b97\u6839\u7684\u5927\u5c0f\uff0c\u90a3\u4e48\u5c31\u518d\u5728\u5de6\u8fb9\u4e58\u4e0a\u4e00\u4e2a$x$\u3002\n\n\u719f\u6089\u751f\u6210\u51fd\u6570\u7684\u8bdd\uff0c\u5c31\u53ef\u4ee5\u5316\u7b80\u4e0b\u53f3\u8fb9\u7684\u90e8\u5206\uff1a\n\n$$F(x)=[x^n]x\\prod_{k=1}^{\\infty}(1-x^k)^{-f_k}$$\n\n\u8fd9\u4e2a\u65f6\u5019$[x^n]$\u5c31\u53ef\u4ee5\u62ff\u6389\u4e86\uff1a\n\n$$F(x)=x\\prod_{k=1}^{\\infty}(1-x^k)^{-f_k}$$\n\n\u8fde\u4e58\u8f6c\u8fde\u52a0\u7684\u8bdd\u5c31\u662f$\\ln$\u4e86\u5427\uff0c\u90a3\u4e48\u5c31\u5bf9\u6570\uff1a\n\n$$\\ln{F(x)}=\\ln{x}-\\sum_{k=1}^{\\infty}\\ln(1-x^k)$$\n\n\u5bf9\u6570\u4e0d\u597d\u5904\u7406\uff0c\u6c42\u5bfc\uff1a\n\n$$\\frac{F(x)'}{F(x)}=\\frac{1}{x}+\\sum_{k=1}^{\\infty}kf_k\\frac{x^{k-1}}{1-x^k}$$\n\n\u4e24\u8fb9\u540c\u65f6\u4e58\u4e0a$xF(x)$\uff0c\u53bb\u6389\u5206\u6bcd\uff1a\n\n$$xF(x)'=F(x)+F(x)\\sum_{k=1}^{\\infty}kf_k\\frac{x^k}{1-x^k}$$\n\n\u653e$[x^n]$\u4e0a\u53bb\uff1a\n\n$$nf_n=f_n+\\sum_{i=1}^{n-1}f_i\\sum_{k=1}^{n-1}kf_k([x^{n-i}]\\frac{x^k}{1-x^k})$$\n\n\u56e0\u4e3a\u6709\uff1a\n\n$$\\frac{x^k}{1-x^k}=\\sum_{i=1}^{\\infty}x^{ik}=\\sum_{i=1}^{\\infty}[k|i]x^i$$\n\n\u6240\u4ee5\u53ef\u4ee5\u5e26\u5165\u539f\u5f0f\uff1a\n\n$$nf_n=f_n+\\sum_{i=1}^{n-1}f_i\\sum_{k=1}^{n-1}kf_k[k|n-i]$$\n\n\u8f6c\u5316\u4e00\u4e0b\uff1a\n\n$$f_n=\\frac{\\sum_{i=1}^{n-1}f_i\\sum_{k=1}^{n-1}kf_k[k|n-i]}{n-1}$$\n\n\u5c06\u53f3\u8fb9\u7684\u90e8\u5206\u5f53\u505a\u53e6\u4e00\u4e2a\u591a\u9879\u5f0f\u7684$n-i$\u9879\uff0c\u90a3\u4e48\u8fd9\u5c31\u662f\u4e00\u4e2a\u7c7b\u4f3c\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u8003\u8651\u7528\u5206\u6cbb$FFT$\u4f18\u5316\u3002\n\n\u57fa\u4e8e\u8c03\u548c\u7ea7\u6570\uff0c\u5df2\u77e5$F(x)$\u7684\u8bdd\u66b4\u529b\u8ba1\u7b97\u53f3\u8fb9\u7684\u8f85\u52a9\u591a\u9879\u5f0f(\u8bbe\u4e3a$G(x)$)\u7684\u590d\u6742\u5ea6\u53ea\u6709$O(nlogn)$\uff0c\u90a3\u4e48\u5c31\u53ea\u7528\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u5206\u6cbb\u65f6\u5de6\u8fb9\u5bf9\u53f3\u8fb9\u7684\u8d21\u732e\u3002\n\n\u56e0\u4e3a$G(x)$\u7684\u4f4d\u6570\u4e0d\u591f\uff0c\u5f53\u5206\u6cbb\u7684\u5de6\u7aef\u70b9\u4e3a$1$\u65f6\u5de6\u533a\u95f4\u5bf9\u53f3\u8fb9\u7684\u8d21\u732e\u4e0d\u80fd\u5b8c\u5168\u8ba1\u7b97\u3002\u6240\u4ee5\u5c31\u5148\u4e0d\u8ba1\u7b97\u8fd9\u90e8\u5206\u7684\u8d21\u732e\uff0c\u6539\u4e3a\u5728\u8ba1\u7b97\u51fa\u4e00\u6bb5$G(x)$\u540e\u5377\u79ef\u4e24\u6b21\u6765\u5b8c\u6574\u8ba1\u7b97\u5de6\u533a\u95f4\u7684\u8d21\u732e\uff08\u4e00\u904d$F(x)$\u4e00\u904d$G(x)$\uff09\u3002\n\n\u6211\u5b9e\u73b0\u7684\u65f6\u5019\u51fa\u4e86\u70b9\u95ee\u9898\uff0c\u6240\u4ee5\u957f\u5ea6\u9700\u8981\u8865\u5230$2^k$\uff08\u8fd9\u4e00\u70b9\u6b22\u8fce\u8865\u5145\uff09\u3002\n\n\u73b0\u5728\u5df2\u7ecf\u6c42\u51fa\u4e86$n$\u4e2a\u70b9\u7684\u65e0\u6807\u53f7\u6709\u6839\u6811\u7684\u6570\u91cf\uff0c\u8003\u8651\u4f7f\u7528\u5bb9\u65a5\u8f6c\u5316\u51fa\u4e3a\u6807\u53f7\u65e0\u6839\u6811\u7684\u6570\u91cf\u3002\n\n\u56e0\u4e3a\u4e00\u68f5\u6811\u7684\u91cd\u5fc3\u975e\u5e38\u5c11\u5e76\u4e14\u53ef\u4ee5\u7528\u5b50\u6811\u5927\u5c0f\u6765\u63cf\u8ff0\uff0c\u90a3\u4e48\u5c31\u4f7f\u7528\u5bb9\u65a5\u53bb\u6389\u6240\u6709\u6839\u4e0d\u4e3a\u91cd\u5fc3\u7684\u5b50\u6811\uff0c\u5177\u4f53\u6765\u8bf4\u5c31\u662f\u679a\u4e3e\u6709\u54ea\u4e9b\u6811\u7684\u6839\u5305\u542b\u4e00\u4e2a\u5b50\u6811\u7684\u5927\u5c0f\u5927\u4e8e\u6574\u68f5\u6811\u5927\u5c0f\u7684\u4e00\u534a\u5c31\u53ef\u4ee5\u89e3\u51b3\u4e86\u3002\n\n\u5b9e\u9645\u5b9e\u73b0\u7684\u65f6\u5019\u8003\u8651\u679a\u4e3e\u65ad\u6389\u539f\u6765\u6811\u7684\u4e00\u6761\u4e2d\u5fc3\u8fb9\u6765\u5904\u7406\uff0c\u4e0b\u9762\u5047\u8bbe$h_n$\u4e3a$n$\u7684\u65e0\u6807\u53f7\u65e0\u6839\u6811\u7684\u6570\u91cf\u3002\n\n$$h_n=\\begin{cases}f_n-\\sum_{k=(n+1)/2}^{n-1}f_kf_{n-k},[2\\nmid n]\\\\f_n-\\sum_{k=n/2+1}^{n-1}f_kf_{n-k}-\\binom{f_{n/2}}{2},[2\\mid n]\\end{cases}$$\n\n\u56e0\u4e3a\u5076\u6570\u4e2a\u8282\u70b9\u7684\u6811\u53ef\u80fd\u6709\u4e24\u4e2a\u91cd\u5fc3\uff0c\u679a\u4e3e\u5224\u6389\u5373\u53ef\u3002\n\n\u90a3\u4e48\u8fd9\u4e2a\u4e1c\u897f\u7684\u4e2d\u95f4\u7684\u90e8\u5206\u5f88\u660e\u663e\u662f\u4e00\u4e2a\u5377\u79ef\uff0c$O(nlogn)$\u6c42\u51fa\u6765\u7136\u540e$O(n)$\u52a0\u52a0\u51cf\u51cf\u5c31\u53ef\u4ee5\u6c42\u51fa$\\{h_n\\}$\u3002\n\n\u603b\u590d\u6742\u5ea6$O(nlog^2n)$\uff0c\u4f46\u662f\u56e0\u4e3a\u5206\u6cbbFFT\u7684\u5c0f\u5e38\u6570\u8dd1\u8d77\u6765\u76f8\u5f53\u5feb\u3002\n\n\u4e0b\u9762\u662f\u4ee3\u7801\u73af\u8282\uff1a\n\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<algorithm>\nusing namespace std;\n#define rnt re int\n#define re register\n#define I inline int\n#define V inline void\n#define ll long long int\n#define FOR(i,A,B) for(rnt i=A;i<=B;++i)\n#define ROF(i,A,B) for(rnt i=A;i>=B;--i)\nconst int N=1<<19|1,mod=998244353,G=3,inv3=332748118,inv2=mod+1>>1;\nll Pow(ll t,int x){\n    ll s=1;\n    for(;x;x>>=1,t=t*t%mod)\n        if(x&1)s=s*t%mod;\n    return s;\n}\nnamespace poly{\n    int lmt(1),r[N],w[N];\n    V init(int n){\n        int l=0;\n        while(lmt<=n)lmt<<=1,++l;\n        FOR(i,1,lmt-1)r[i]=(r[i>>1]>>1)|((i&1)<<(l-1));\n        int wn=Pow(3,(mod-1)>>l);w[lmt>>1]=1;\n        FOR(i,(lmt>>1)+1,lmt-1)w[i]=(ll)w[i-1]*wn%mod;\n        ROF(i,(lmt>>1)-1,1)w[i]=w[i<<1];\n        lmt=__builtin_ctz(lmt);\n    }\n    I getLen(int n){return 1<<(32-__builtin_clz(n));}\n    V DFT(int*a,int l){\n        static unsigned long long int tmp[N];\n        re int u(lmt-__builtin_ctz(l)),t;\n        FOR(i,0,l-1)tmp[i]=a[r[i]>>u];\n        for(re int i=1;i<l;i<<=1)\n            for(re int j=0,step=i<<1;j<l;j+=step)\n                FOR(k,0,i-1)\n                    t=tmp[i+j+k]*w[i+k]%mod,tmp[i+j+k]=tmp[j+k]+mod-t,tmp[j+k]+=t;\n        FOR(i,0,l-1)a[i]=tmp[i]%mod;\n    }\n    V IDFT(int*a,int l){\n        reverse(a+1,a+l),DFT(a,l);\n        re int bk(mod-(mod-1)/l);\n        FOR(i,0,l-1)a[i]=(ll)a[i]*bk%mod;\n    }\n}\nusing poly::DFT;\nusing poly::IDFT;\nusing poly::getLen;\nint f[N],g[N],n,m,k,h[N];\nV init(const int&x){\n\tif(x^1)f[x]=1ll*f[x]*Pow(x-1,mod-2)%mod;\n\telse f[x]=1;\n\tfor(rnt j=x,t=1ll*f[x]*x%mod;j<=n;j+=x)g[j]=(g[j]+t)%mod;\n}\n#define mul() DFT(X,l),DFT(Y,l);FOR(i,0,l-1)X[i]=1ll*X[i]*Y[i]%mod;IDFT(X,l);\nV cdq(rnt L,rnt R){\n\tif(L==R)return init(L);\n\tstatic int X[N],Y[N];\n\tre int mid=L+R>>1,l;\n\tcdq(L,mid);\n\tif(L==1){\n\t\tFOR(i,L,mid)X[i-L]=f[i],Y[i-L]=g[i];\n\t\tl=getLen(R-L),mul();\n\t\tFOR(i,mid+1,R)f[i]=(f[i]+X[i-L-1])%mod;\n\t\tFOR(i,0,l-1)X[i]=Y[i]=0;\n\t}\n\telse{\n\t\tl=getLen(R+mid-L-L+1);\n\t\tFOR(i,L,mid)X[i-L]=f[i];\n\t\tFOR(i,1,R-L)Y[i-1]=g[i];mul()\n\t\tFOR(i,mid+1,R)f[i]=(f[i]+X[i-L-1])%mod;\n\t\tFOR(i,0,l-1)X[i]=Y[i]=0;\n\t\tFOR(i,L,mid)X[i-L]=g[i];\n\t\tFOR(i,1,R-L)Y[i-1]=f[i];mul()\n\t\tFOR(i,mid+1,R)f[i]=(f[i]+X[i-L-1])%mod;\n\t\tFOR(i,0,l-1)X[i]=Y[i]=0;\n\t}\n\tcdq(mid+1,R);\n}\nint main(){\n\tfreopen(\"tree.in\",\"r\",stdin);\n\tfreopen(\"tree.out\",\"w\",stdout);\n    cin>>n,n++,m=n,n=getLen(n),poly::init(n),cdq(1,n),n=m;\n\tre int l=getLen(n+n);\n\tstatic int X[N];\n\tFOR(i,0,l-1)X[i]=f[i]*(i<=n);DFT(X,l);\n\tFOR(i,0,l-1)X[i]=1ll*X[i]*X[i]%mod;IDFT(X,l);\n\tFOR(i,1,n)\n\t\tif(i&1)h[i]=(f[i]+mod-1ll*X[i]*inv2%mod)%mod;\n\t\telse\n\t\t\tX[i]=(X[i]-1ll*f[i>>1]*f[i>>1]%mod+mod)%mod,\n\t\t\th[i]=((ll)f[i]+mod*2-1ll*X[i]*inv2%mod-(1ll*f[i>>1]*(f[i>>1]-1)>>1)%mod)%mod;\n    cout<<h[n];\n    return 0;\n}\n```\n\n",
        "postTime": 1578313004,
        "uid": 109236,
        "name": "Fuyuki",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5900 \u3010\u65e0\u6807\u53f7\u65e0\u6839\u6811\u8ba1\u6570\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u9898\u5982\u5176\u540d\u3002\n\n[\u539f\u9898](https://www.luogu.com.cn/problem/P5900)\n\n\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4efd\u88ab\u5206\u6cbb $\\text{NTT}$ \u4e24\u53ea $\\log$ \u540a\u7740\u9524\u7684\u5355 $\\log$ \u725b\u987f\u8fed\u4ee3\u9898\u89e3\u3002\n\n\u9996\u5148\u662f $\\text{Euler}$ \u53d8\u6362\uff1a\n\n\u8ba9\u6211\u4eec\u628a\u4e00\u4e9b\u65e0\u6807\u53f7\u7269\u54c1\u5206\u6210\u82e5\u5e72\u7ec4\uff08\u975e\u7a7a\uff09\uff0c\u5927\u5c0f\u4e3a $k$ \u7684\u7ec4\u5185\u90e8\u6709 $f_k$ \u79cd\u65b9\u6848\uff0c\u6c42\u65b9\u6848\u6570\u3002\n\n\u5bf9\u4e8e\u65e0\u6807\u53f7\u95ee\u9898\uff0c\u5982\u679c\u51fa\u73b0\u5927\u5c0f\u4e0e\u65b9\u6848\u7686\u76f8\u540c\u7684\u4e24\u7ec4\uff0c\u5219\u5b83\u4eec\u6ca1\u6709\u533a\u522b\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e\u5927\u5c0f\u3001\u65b9\u6848\u7686\u76f8\u540c\u7684\u51e0\u7ec4\uff0c\u5f62\u6210\u5b83\u4eec\u7684\u65b9\u6848\u6570\u4e3a $1$ \u3002\n\n\u90a3\u4e48\uff0c\u679a\u4e3e\u5927\u5c0f $k$ \uff0c\u56fa\u5b9a\u4e00\u79cd\u65b9\u6848\uff0c\u5219\u5f97\u5230\u4e00\u4e2a\u751f\u6210\u51fd\u6570 $\\sum_{i=0}\\limits x^{ki} = \\dfrac{1}{1-x^k}$\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u5927\u5c0f $k$\uff0c\u65b9\u6848\u6570\u4e3a $f_k$ \uff0c\u90a3\u4e48\u6700\u540e\u603b\u65b9\u6848\u6570\u7684\u751f\u6210\u51fd\u6570\u5c31\u662f\n\n$$\\prod_{k=1} (\\frac{1}{1-x^k})^{f_k}$$\n\n\u5373 \n\n$$\\text{Euler}(f(x)) = \\prod_{k=1} (\\frac{1}{1-x^k})^{[x^k]f(x)}$$\n\n\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u5316\u6210\u53e6\u4e00\u4e2a\u66f4\u5b9e\u7528\u7684\u5f62\u5f0f\uff1a\n\n$$\\text{Euler}(f(x)) = \\exp (\\sum_{k=1} \\ln( (\\frac{1}{1-x^k})^{[x^k]f(x)}))=\\exp (\\sum_{k=1}[x^k]f(x) \\cdot \\ln(\\frac{1}{1-x^k}))$$\n\n\u505a\u8fc7\u4ed8\u516c\u4e3b\u7684\u80cc\u5305\u7684\u540c\u5fd7\u5e94\u8be5\u77e5\u9053\uff1a\n\n$$\\ln(\\frac{1}{1-x^k})=\\sum_{t=1} \\frac{x^{kt}}{t}$$\n\n\u5982\u679c\u6ca1\u505a\u8fc7\uff0c\u53ef\u4ee5\u5148\u5c06\u5176\u6c42\u5bfc\uff0c\u4e00\u987f\u64cd\u4f5c\uff0c\u7136\u540e\u79ef\u56de\u6765\u5f97\u5230\u4e0a\u5f0f\u3002\n\n\u90a3\u4e48\uff0c\n\n$$\\text{Euler}(f(x))=\\exp(\\sum_{k=1}[x^k]f(x)\\cdot (\\sum_{t=1}\\frac{x^{kt}}{t}))$$\n\n\u6539\u53d8\u6c42\u548c\u987a\u5e8f\uff0c\u5148\u679a\u4e3e $t$ \uff0c\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$\\text{Euler}(f(x))=\\exp(\\sum_{t=1} \\frac{f(x^t)}{t})$$\n\n\u5148\u6765\u770b\u770b\u65e0\u6807\u53f7\u6709\u6839\u6811\u7684\u8ba1\u6570\uff1a\n\n$$g(x) = x \\cdot \\text{Euler}(g(x))$$\n\n$$\\frac{g(x)}{x} = \\exp(\\sum_{t=1}\\frac{g(x^{t})}{t})$$\n\n\u4e24\u8fb9\u4e00\u8d77\u53d6 $\\ln$\uff0c\u5f97\u5230\n\n$$\\ln(\\frac{g(x)}{x})=\\sum_{t=1}\\frac{g(x^t)}{t}$$\n\n\u8bbe\u51fd\u6570 $f$ \uff0c\u4e14\u4ee4\n\n$$f(g(x))=\\ln(\\frac{g(x)}{x})-\\sum_{t=1}\\frac{g(x^t)}{t}$$\n\n\u5bf9\u8fd9\u4e2a\u4e1c\u897f\u4e0a\u725b\u987f\u8fed\u4ee3\uff1a\u6c42 $g(x)$ \u4f7f $f(g(x))\\equiv 0 \\pmod{x^n}$\n\n\u5047\u8bbe\u6211\u4eec\u9012\u5f52\u7684\u6c42\u51fa\u4e86 $g_0(x)$ \uff0c\u4f7f $f(g_0(x))\\equiv 0 \\pmod{x^{\\lceil \\frac{n}{2} \\rceil}}$\n\n\u6ce8\u610f\u5230 $g(x)$ \u548c $g_0(x)$ \u7684\u524d $\\lceil \\frac{n}{2} \\rceil$ \u9879\u662f\u4e00\u81f4\u7684\uff0c\u800c\u4e14 $\\dfrac{g(x^t)}{t}$ \u53ea\u4f1a\u8ddf $g(x)$ \u7684\u524d $\\lfloor \\dfrac{n}{t} \\rfloor$ \u9879\u6709\u5173\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e $t>=2$ \uff0c$\\dfrac{g(x^t)}{t}$ \u5df2\u7ecf\u88ab\u51b3\u5b9a\u4e86\u3002\u56e0\u4e3a\u6b64\u5904\u7684 $g$ \u5b8c\u5168\u53ef\u4ee5\u7528 $g_0$ \u6362\u6389\u3002\u90a3\u4e48\uff0c\u4ee4\n\n$$\\alpha = \\sum_{t=2}{\\frac{g_0(x^t)}{t}}$$\n\n\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u8c03\u548c\u7ea7\u6570\u5f97\u5230\u3002\u90a3\u4e48\uff1a\n\n$$f(g(x))=\\ln(\\frac{{g(x)}}{{x}})-g(x)-\\alpha$$\n\n\u5176\u4e2d $\\alpha$ \u4e0e $g(x)$ \u65e0\u5173\u3002$\\dfrac{1}{x}$ \u4e0e $g(x)$ \u4e5f\u65e0\u5173\u3002\n\n$$f'(g(x))=\\frac{1}{x} \\cdot \\frac{1}{\\frac{g(x)}{x}}-1$$\n\n\u4e0a\u725b\u8fed\u516c\u5f0f\uff1a\n\n$$g(x)\\equiv g_0(x)-\\frac{f(g_0(x))}{f'(g_0(x))} \\pmod {x^n}$$\n\n\u4ee4 $g_1(x)=\\dfrac{g_0(x)}{x}$\uff0c$g_2(x)=\\dfrac{g(x)}{x}$\n\n$$g(x)\\equiv g_0(x)-\\frac{\\ln(g_1(x))-g_0(x)-\\alpha}{\\frac{1}{x}\\cdot \\frac{1}{g_1(x)}-1} \\pmod{x^n}$$\n\n\u4e24\u8fb9\u4e00\u8d77\u9664\u6389 $x$\uff0c\u5f97\u5230\uff1a\n\n$$g_2(x) \\equiv g_1(x)-\\frac{\\ln(g_1(x))-g_0(x)-\\alpha}{\\frac{1}{g_1(x)}-x} \\pmod{x^n}$$\n\n\u4e8e\u662f\uff0c\u53ef\u4ee5\u5bf9 $\\dfrac{g(x)}{x}$ \u8fdb\u884c\u725b\u987f\u8fed\u4ee3\u6c42\u89e3\u3002\u4ece\u800c\u5f97\u5230 $g(x)$\u3002\n\n\u8fd9\u91cc\u590d\u6742\u5ea6\u662f $n \\log n$ \u7684\uff0c\u4f46\u662f\u5e38\u6570\u5de8\u5927\u3002\n\n\u6700\u540e\uff0c\u8003\u8651\u600e\u4e48\u7531\u65e0\u6807\u53f7\u6709\u6839\u6811\u5f97\u5230\u65e0\u6807\u53f7\u65e0\u6839\u6811\uff1a\u8ba9\u6bcf\u79cd\u60c5\u51b5\u53ea\u5728\u6839\u4e3a\u91cd\u5fc3\u65f6\u88ab\u7edf\u8ba1\u4e00\u6b21\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u7528\u603b\u65b9\u6848\u6570\u51cf\u53bb\u6839\u4e0d\u662f\u91cd\u5fc3\u7684\u65b9\u6848\u6570\u3002\n\n\u65e2\u7136\u6839\u4e0d\u662f\u91cd\u5fc3\uff0c\u90a3\u4e48\u6839\u4e00\u5b9a\u4f1a\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\u5b50\u6811\u7684\u5927\u5c0f\u5927\u4e8e\u7b49\u4e8e $\\lfloor \\dfrac{n}{2} \\rfloor+1$\u3002\n\n\u679a\u4e3e\u8fd9\u4e2a\u5927\u5c0f $k$ \uff0c\u51cf\u6389 $[x^k]g(x)\\cdot [x^{n-k}]g(x)$ \u5c31\u597d\u3002\n\n\u540c\u65f6\uff0c\u5982\u679c $n$ \u662f\u4e2a\u5076\u6570\uff0c\u90a3\u5b83\u6709\u53ef\u80fd\u4f1a\u6709\u4e24\u4e2a\u5b50\u6811\u5927\u5c0f\u4e3a $\\dfrac{n}{2}$ \u7684\u91cd\u5fc3\u3002\n\n\u5982\u679c\u8fd9\u4e24\u4e2a\u91cd\u5fc3\u7684\u5b50\u6811\u5185\u5f62\u72b6\u4e00\u81f4\uff0c\u5219\u4f1a\u88ab\u6b63\u786e\u7edf\u8ba1\u4e00\u6b21\u3002\n\n\u5426\u5219\uff0c\u4f1a\u7edf\u8ba1\u4e24\u6b21\u3002\u4e8e\u662f\u8981\u51cf\u6389\u591a\u51fa\u6765\u7684\u90a3\u4e00\u534a\uff0c\u4e5f\u5c31\u662f\n\n$$\\frac{[x^{\\frac{n}{2}}]g(x)\\cdot ([x^{\\frac{n}{2}}]g(x)-1)}{2}=\\binom{[x^{\\frac{n}{2}}]g(x)}{2}$$\n\n\u81f3\u6b64\u7ed3\u675f\u3002\u8fd9\u4e2a\u505a\u6cd5\u907f\u514d\u4e86 $\\exp$ \u8fd9\u4e2a\u5e38\u6570\u8981\u4eba\u547d\u7684\u4e1c\u897f\uff0c\u7136\u800c\u5e38\u6570\u4f9d\u7136\u5f88\u5927\uff0c\u5927\u5f97\u88ab\u4e24\u53ea $\\log$ \u540a\u8d77\u6765\u9524\u3002\n\n\uff08\u53ef\u80fd\u662f\u6211\u81ea\u5e26\u5927\u5e38\u6570\u2026\u2026\u677f\u5b50\u7684\u5b9e\u73b0\u592a\u4e0d\u4f18\u79c0\u4e86\uff09\n\n\u5269\u4e0b\u7684\uff0c\u89c1\u4ee3\u7801\uff1a\n\n```\n#include <cstdio>\n#include <cstring>\n\nconst int maxn = 6e5+5 , mod = 998244353;\n\ntemplate<typename T>\ninline T max(const T &a,const T &b){\n\treturn a>b?a:b;\n}\n\ntemplate<typename T>\ninline void swap(T &a,T &b){\n\tT temp=a;a=b;b=temp;\n}\n\ninline int mul(int a,int b){return 1ll*a*b%mod;}\n\nint fastpow(int x,int y){\n\tif(y==0) return 1;\n\tint tmp=fastpow(x,y>>1);\n\treturn y&1?mul(mul(tmp,tmp),x):mul(tmp,tmp);\n}\n\nnamespace Poly{\n\tconst int gate = 3,invg = fastpow(gate,mod-2);\n\tint lim,lg,sing[maxn];\n\tvoid init(int len){\n\t\tlim = 1,lg = 0;while(lim<len) lim<<=1,lg++;\n\t\tfor(int i=1;i<lim;i++) sing[i]=(sing[i>>1]>>1)|((i&1)<<(lg-1));\n\t}\n\tvoid NTT(int *Steins,int type){\n\t\tfor(int i=0;i<lim;i++) if(i<sing[i]) swap(Steins[i],Steins[sing[i]]);\n\t\tfor(int len=1;len<lim;len<<=1){\n\t\t\tint unit=fastpow(type==1?gate:invg,(mod-1)/(len<<1));\n\t\t\tfor(int i=0;i<lim;i+=(len<<1)){\n\t\t\t\tint w = 1;\n\t\t\t\tfor(int k=0;k<len;k++,w=mul(w,unit)){\n\t\t\t\t\tint x=Steins[i+k],y=mul(w,Steins[i+k+len]);\n\t\t\t\t\tSteins[i+k]=(x+y)%mod,Steins[i+k+len]=(x-y)%mod;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(type!=1){int Okabe=fastpow(lim,mod-2);for(int i=0;i<lim;i++) Steins[i]=mul(Steins[i],Okabe);}\n\t}\n\tint g[maxn];\n\tvoid get_inv(int *Alpha,int len,int *Beta){\n\t\t//\u4f7f\u7528\u524d\u6e05\u7a7aBeta\u6570\u7ec4\n\t\tif(len==1){Beta[0]=fastpow(Alpha[0],mod-2);return ;}\n\t\tget_inv(Alpha,(len+1)>>1,Beta);init(len+len-1);\n\t\tfor(int i=0;i<len;i++) g[i]=Alpha[i];for(int i=len;i<lim;i++) g[i]=0;\n\t\tNTT(Beta,1),NTT(g,1);\n\t\tfor(int i=0;i<lim;i++) Beta[i]=mul(Beta[i],2-mul(Beta[i],g[i]));\n\t\tNTT(Beta,-1);\n\t\tfor(int i=len;i<lim;i++) Beta[i]=0;\n\t}\n\tvoid convolution(int *Alpha,int la,int *Beta,int lb,int *Zeta){\n\t\tinit(la+lb-1);for(int i=lb;i<lim;i++) Beta[i]=0;\n\t\tfor(int i=la;i<lim;i++) Alpha[i]=0;\n\t\tNTT(Alpha,1),NTT(Beta,1);\n\t\tfor(int i=0;i<lim;i++) Zeta[i]=mul(Alpha[i],Beta[i]);\n\t\tNTT(Zeta,-1);\n\t\tfor(int i=la+lb-1;i<lim;i++) Zeta[i]=0;\n\t}\n\tconst int inv2=fastpow(2,mod-2);\n\tint t[maxn];\n\tvoid get_sqrt(int *Alpha,int len,int *Beta){\n\t\t//\u4f7f\u7528\u524d\u6e05\u7a7aBeta\u6570\u7ec4\n\t\tif(len==1){Beta[0]=1;return ;}\n\t\tget_sqrt(Alpha,(len+1)>>1,Beta);get_inv(Beta,len,t);\n\t\tinit(len+len-1);\n\t\tfor(int i=0;i<len;i++) g[i]=Alpha[i];for(int i=len;i<lim;i++) g[i]=0;\n\t\tNTT(g,1),NTT(t,1),NTT(Beta,1);\n\t\tfor(int i=0;i<lim;i++) Beta[i]=mul(inv2,(Beta[i]+mul(g[i],t[i]))%mod);\n\t\tNTT(Beta,-1);\n\t\tfor(int i=len;i<lim;i++) Beta[i]=0;for(int i=0;i<lim;i++) t[i]=0;\n\t}\n\tvoid derivative(int *Alpha,int len,int *Beta){\n\t\tfor(int i=1;i<len;i++) Beta[i-1]=mul(i,Alpha[i]);\n\t\tBeta[len-1] = 0;\n\t}\n\tvoid integral(int *Alpha,int len,int *Beta){\n\t\tfor(int i=1;i<len;i++) Beta[i]=mul(Alpha[i-1],fastpow(i,mod-2));\n\t\tBeta[0] = 0;\n\t}\n\tint f1[maxn],f2[maxn],f3[maxn];\n\tvoid get_ln(int *Alpha,int len,int *Beta){\n\t\tmemset(f2,0,sizeof(f2));\n\t\tderivative(Alpha,len,f1),get_inv(Alpha,len,f2);\n\t\tconvolution(f1,len,f2,len,f3);\n\t\tintegral(f3,len,Beta);\n\t}\n\tint e1[maxn],e2[maxn];\n\tvoid get_exp(int *Alpha,int len,int *Beta){\n\t\t//\u4f7f\u7528\u524d\u6e05\u7a7aBeta\u6570\u7ec4\n\t\tif(len==1) return void(Beta[0]=1);\n\t\tget_exp(Alpha,(len+1)>>1,Beta);get_ln(Beta,len,e1);\n\t\tinit(len+len-1);\n\t\tfor(int i=0;i<len;i++) e2[i]=Alpha[i];for(int i=len;i<lim;i++) e2[i]=0;\n\t\tNTT(e2,1),NTT(Beta,1),NTT(e1,1);\n\t\tfor(int i=0;i<lim;i++) Beta[i]=mul(Beta[i],(1-e1[i]+e2[i]));\n\t\tNTT(Beta,-1);\n\t\tfor(int i=len;i<lim;i++) Beta[i]=0;for(int i=0;i<lim;i++) e1[i]=0;\n\t}\n\tint g1[maxn],g2[maxn],g3[maxn];\n\tvoid division(int *Alpha,int la,int *Beta,int lb,int *Zeta,int *Gamma){\n\t\tif(la<lb){\n\t\t\tfor(int i=0;i<la;i++) Gamma[i] = Alpha[i];\n\t\t\treturn ;\n\t\t}\n\t\tfor(int i=0;i<la;i++) g1[i]=Alpha[la-i-1];for(int i=0;i<lb;i++) g2[i]=Beta[lb-i-1];\n\t\tfor(int i=lb;i<=la-lb;i++) g2[i]=0;\n\t\tPoly::init((la-lb+1)<<1|1);for(int i=0;i<lim;i++) g3[i]=0;\n\t\tget_inv(g2,la-lb+1,g3);\n\t\tconvolution(g1,la,g3,la-lb+1,Zeta);\n\t\tfor(int i=0;i<=la-lb;i++) if(i<la-lb-i) swap(Zeta[i],Zeta[la-lb-i]);else break;\n\t\tfor(int i=la-lb+1;i<lim;i++) Zeta[i]=0;\n\t\tfor(int i=0;i<lb;i++) g2[i]=Beta[i];for(int i=0;i<=la-lb;i++) g3[i]=Zeta[i];\n\t\tconvolution(g2,lb,g3,la-lb+1,g1);\n\t\tfor(int i=0;i<lb;i++) Gamma[i]=(Alpha[i]-g1[i])%mod;\n\t}\n}\n\nint n,Alpha[maxn],Beta[maxn],Gamma[maxn];\nint g1[maxn],g2[maxn];\n\nvoid Newton(int len,int *Alpha){\n\tif(len==1) return void(Alpha[0]=1);\n\tNewton((len+1)>>1,Alpha);\n\tfor(int i=0;i<len;i++) Gamma[i]=0;\n\tfor(int i=1;i<len;i++){\n\t\tint Okabe = fastpow(i,mod-2);\n\t\tfor(int j=1;j*i<len;j++) Gamma[j*i]=(Gamma[j*i]+mul(Okabe,Alpha[j-1]))%mod;\n\t}\n\t//\u6ce8\u610fi\u4ece1\u5f00\u59cb\uff0c\u8fd9\u91cc\u5c06g_0\u4e5f\u987a\u624b\u5408\u5e76\u4e86\u8fdb\u53bb\n\tmemset(g1,0,sizeof(g1));\n\tPoly::get_ln(Alpha,len,g1);for(int i=0;i<len;i++) g1[i]=(g1[i]-Gamma[i])%mod;\n\tmemset(g2,0,sizeof(g2));Poly::get_inv(Alpha,len,g2);\n\tg2[1]=(g2[1]-1)%mod;\n\tmemset(Beta,0,sizeof(Beta));Poly::get_inv(g2,len,Beta);\n\tPoly::convolution(g1,len,Beta,len,g1);\n\tfor(int i=0;i<len;i++) Alpha[i]=(Alpha[i]-g1[i])%mod;\n}\n\nint main(){\n\tscanf(\"%d\",&n);Newton(n,Alpha);//\u8fd9\u91cc\u5f97\u5230\u7684\u662f\u9664\u4ee5x\u4e4b\u540e\u7684\u7ed3\u679c\n\tint answer = Alpha[n-1];\n\tfor(int i=(n>>1)+1;i<=n-1;i++) answer = (answer-mul(Alpha[i-1],Alpha[n-i-1]))%mod;\n\tif(!(n&1)) answer = answer-mul(fastpow(2,mod-2),mul(Alpha[n/2-1],Alpha[n/2-1]-1));\n\tanswer%=mod;\n\tprintf(\"%d\\n\",(answer+mod)%mod);\n\treturn 0;\n}\n\n```\n\n\u6700\u540e\u7684\u6700\u540e\uff0c\u5173\u4e8e\u53e6\u4e00\u7bc7\u725b\u987f\u8fed\u4ee3\u9898\u89e3\u7684\u672a\u89e3\u4e4b\u8c1c2\uff0c\u6211\u76f8\u4fe1\u90a3\u662f\u5b83\u5199\u6cd5\u4e0a\u51fa\u4e86\u4ec0\u4e48\u610f\u5916\uff0c\u56e0\u4e3a\u6211\u8fd9\u91cc\u6570\u7ec4\u5f00\u5230 $6e5$ \u5c31\u8fc7\u4e86\u3002\n",
        "postTime": 1608552112,
        "uid": 101984,
        "name": "Rui_R",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5900 \u3010\u65e0\u6807\u53f7\u65e0\u6839\u6811\u8ba1\u6570\u3011"
    },
    {
        "content": "### \u9898\u610f\n\n\u6c42 $n$ \u4e2a\u70b9\u7684\u65e0\u6807\u53f7\u65e0\u6839\u6811\u6570\u91cf\u3002\n\n$\\texttt{Data Range:}1\\leq n\\leq 2\\times 10^5$\n\n### \u9898\u89e3\n\n\u53ef\u80fd\u662f\u4f60\u8c37\u6700\u8be6\u7ec6\u9610\u660e $\\texttt{Euler}$ \u53d8\u6362\u7684\u9898\u89e3\u4e86\u3002\n\n\u9996\u5148\u8003\u8651\u6709\u6839\u6811\u8ba1\u6570\uff0c\u8bbe $f_n$ \u662f $n$ \u4e2a\u70b9\u7684\u65e0\u6807\u53f7\u6709\u6839\u6811\u6570\u91cf\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u94a6\u5b9a\u67d0\u4e00\u4e2a\u70b9\u4e3a\u6839\uff0c\u5269\u4e0b\u7684\u5b50\u6811\u7684\u5927\u5c0f\u52a0\u8d77\u6765\u5fc5\u987b\u4e3a $n-1$\uff0c\u4f1a\u53d1\u73b0\u662f\u4e2a\u80cc\u5305\u3002\u4e8e\u662f\u8003\u8651\u4f7f\u7528\u751f\u6210\u51fd\u6570\u4f18\u5316\u4e00\u4e0b\uff1a\n\n$$f_n=[x^{n-1}]\\prod\\limits_{i=1}^{\\infty}\\left(\\frac{1}{1-x^i}\\right)^{f_i}$$\n\n\u73b0\u5728\u6211\u4eec\u6765\u5b9a\u4e49 $F(x)$ \u7684 $\\texttt{Euler}$ \u53d8\u6362\u4e3a\n\n$$\\mathcal{E}(F(x))=\\prod\\limits_{i=1}^{\\infty}\\left(\\frac{1}{1-x^i}\\right)^{f_i}$$\n\n\u8fd9\u91cc\u7ed9\u51fa\u53e6\u5916\u4e00\u79cd\u7ec4\u5408\u89e3\u91ca\uff0c\u5982\u679c $F(x)$ \u4e3a $n$ \u4e2a\u70b9\u6ee1\u8db3\u67d0\u79cd\u6027\u8d28\u7684\u65e0\u6807\u53f7\u8fde\u901a\u56fe\u6570\u91cf\uff0c\u90a3\u4e48 $\\mathcal{E}(F(x))$ \u4e3a $n$ \u4e2a\u70b9\u6ee1\u8db3\u8fd9\u79cd\u6027\u8d28\u7684\u65e0\u6807\u53f7\u56fe\u7684\u6570\u91cf\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u50cf\u4e0a\u9762\u90a3\u6837\uff0c\u679a\u4e3e\u8fde\u901a\u5757\u7684\u4e2a\u6570\u505a\u80cc\u5305\u5f97\u5230\uff0c\u7c7b\u4f3c\u4e8e\u6709\u6807\u53f7\u56fe\u8ba1\u6570\u4e2d\u7684 $\\exp$\u3002\n\n\u4f46\u662f\u8fd9\u4e2a\u5b9a\u4e49\u5f0f\u662f\u53ef\u4ee5\u4f18\u5316\u7684\uff0c\u5982\u679c\u4f60\u505a\u8fc7\u4ed8\u516c\u4e3b\u7684\u80cc\u5305\u8fd9\u4e2a\u9898\u76ee\u7684\u8bdd\u5e94\u8be5\u5bf9\u8fd9\u79cd\u4f18\u5316\u6bd4\u8f83\u719f\u6089\u3002\u6211\u4eec\u8bbe $G(x)=\\mathcal{E}(F(x))$\uff0c\u90a3\u4e48\u5bf9\u5b9a\u4e49\u5f0f\u7b49\u5f0f\u4e24\u7aef\u53d6\u5bf9\u6570\uff0c\u6709\n\n$$\\ln G(x)=-\\sum\\limits_{i=1}^{\\infty}f_i\\ln(1-x^i)$$\n\n\u4e24\u8fb9\u6c42\u5bfc\uff0c\u5f97\u5230\n\n$$\\frac{G^\\prime(x)}{G(x)}=\\sum\\limits_{i=1}^{\\infty}f_i\\frac{ix^{i-1}}{1-x^i}$$\n\n\u505a\u4e2a\u7ea7\u6570\u5c55\u5f00\n\n$$\\frac{G^\\prime(x)}{G(x)}=\\sum\\limits_{i=1}^{\\infty}f_i\\sum\\limits_{j=0}^{\\infty}ix^{(j+1)i-1}$$\n\n\u79ef\u5206\u56de\u6765\n\n$$\\ln G(x)=\\sum\\limits_{i=1}^{\\infty}f_i\\sum\\limits_{j=1}^{\\infty}\\frac{x^{ij}}{j}$$\n\n\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\uff0c\u53ef\u4ee5\u5199\u6210\u8fd9\u4e2a\u6837\u5b50\n\n$$\\ln G(x)=\\sum\\limits_{j=1}^{\\infty}\\frac{1}{j}\\sum\\limits_{i=1}^{\\infty}f_i(x^{j})^i$$\n\n\u6ce8\u610f\u5230\u53f3\u8fb9\u662f\u4e2a\u70b9\u503c\uff0c\u6240\u4ee5\n\n$$\\ln G(x)=\\sum\\limits_{j=1}\\frac{F(x^j)}{j}$$\n\n\u4e8e\u662f\u6709\n\n$$\\mathcal{E}(F(x))=\\exp\\left(\\sum\\limits_{j=1}\\frac{F(x^j)}{j}\\right)$$\n\n\u56de\u5230\u65e0\u6807\u53f7\u6709\u6839\u6570\u7684\u8ba1\u6570\u4e0a\u9762\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u7528\u751f\u6210\u51fd\u6570\u8868\u793a\u53ef\u4ee5\u5f97\u5230\u4ee5\u4e0b\u5f0f\u5b50\n\n\n$$F(x)=x\\cdot\\mathcal{E}(F(x))$$\n\n\u8fd9\u4e2a\u53ef\u4ee5\u725b\u8fed\u6c42\u51fa\uff0c\u5c3d\u7ba1\u662f $O(n\\log n)$ \u7684\uff0c\u4f46\u662f\u5e38\u6570\u975e\u5e38\u5927\uff0c\u5b9e\u9645\u4e0a\u53ef\u80fd\u6bd4\u4e0d\u8fc7 $O(n\\log^2n)$ \u7684\u5206\u6cbb $\\texttt{FFT}$\u3002\n\n\u8003\u8651\u540c\u65f6\u6c42\u5bfc\u5e76\u4e14\u4e58\u4e0a $x$\uff0c\u4e5f\u5c31\u662f\u4f7f\u7528 $\\vartheta$ \u7b97\u5b50\uff0c\u53ef\u4ee5\u5f97\u5230\uff08~~\u8ba1\u7b97\u8fc7\u7a0b\u7ed9\u8bfb\u8005\u7559\u505a\u7ec3\u4e60~~\uff09\n\n$$\\vartheta F(x)=F(x)+F(x)\\left(\\sum\\limits_{i=1}^{\\infty}x^iF^\\prime(x^i)\\right)$$\n\n\u8bbe $G(x)=\\sum\\limits_{i=1}^{\\infty}x^iF^\\prime(x^i)$\uff0c\u4ed6\u7684\u7cfb\u6570\u53ef\u4ee5\u901a\u8fc7~~\u627e\u89c4\u5f8b~~\u548c~~\u76ee\u77aa\u53e3\u5446\u6cd5~~\u53d1\u73b0\uff0c\u6709\n\n$$g_n=\\sum\\limits_{d\\mid n}df_d$$\n\n\u4e8e\u662f\u6709\n\n$$nf_n=f_n+\\sum\\limits_{i}f_{i}g_{n-i}$$\n\n\u89e3\u51fa\u6765\u5f97\u5230\n\n$$f_n=\\frac{1}{n-1}\\sum\\limits_{i}f_{i}g_{n-i}$$\n\n\u8fd9\u4e2a\u53ef\u4ee5\u5206\u6cbb $\\texttt{FFT}$ \u89e3\u51b3\uff0c\u867d\u8bf4\u662f $O(n\\log^2n)$ \u7684\uff0c\u4f46\u662f\u5e38\u6570\u5f88\u5c0f\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u628a\u6839\u7684\u5f71\u54cd\u53bb\u6389\uff0c\u8fd9\u4e2a\u7684\u8bdd\u53ef\u4ee5\u8003\u8651\u679a\u4e3e\u91cd\u5fc3\uff0c\u7528\u6709\u6839\u6811\u7684\u7b54\u6848\u51cf\u53bb\u6839\u4e0d\u662f\u91cd\u5fc3\u7684\u7b54\u6848\u3002\n\n\u7531\u4e8e\u5f53\u6811\u7684\u5927\u5c0f\u662f\u5076\u6570\u7684\u65f6\u5019\u53ef\u80fd\u5b58\u5728\u4e24\u4e2a\u91cd\u5fc3\uff0c\u6240\u4ee5\u8981\u5206\u7c7b\u8ba8\u8bba\u4e00\u4e0b\u3002\n\n\u5f53 $n$ \u4e3a\u5947\u6570\u7684\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u4e0d\u7528\u60f3\u90a3\u4e48\u591a\uff0c\u7531\u4e8e\u5df2\u7ecf\u94a6\u5b9a\u4e86\u6839\u4e0d\u662f\u91cd\u5fc3\uff0c\u90a3\u4e48\u5fc5\u7136\u6709\u4e00\u68f5\u5b50\u6811\u4f7f\u5f97\u5b83\u7684\u5927\u5c0f\u5927\u4e8e $\\lfloor\\frac{n}{2}\\rfloor$\uff0c\u8bbe\u4e3a $k$\uff0c\u679a\u4e3e\u4e00\u4e0b\u8fd9\u4e2a $k$\uff0c\u7b54\u6848\u4e3a\n\n$$f_n-\\sum\\limits_{k=\\lfloor\\frac{n}{2}\\rfloor+1}f_kf_{n-k}$$\n\n\u53f3\u8fb9\u7684\u4e1c\u897f\u53ef\u4ee5\u968f\u624b\u5377\u4e00\u4e0b\u3002\n\n\u5f53 $n$ \u4e3a\u5076\u6570\u7684\u65f6\u5019\u6709\u53ef\u80fd\u5b58\u5728\u4e24\u4e2a\u91cd\u5fc3\uff0c\u4e14\u5176\u4e2d\u4e00\u4e2a\u662f\u6839\uff0c\u679a\u4e3e\u5e76\u5224\u6389\u3002\n\n\u989d\u5916\u51cf\u6389\u7684\u65b9\u6848\u4e3a\n\n$$\\binom{f_{\\frac{n}{2}}}{2}$$\n\n\u81f3\u6b64\uff0c\u8fd9\u4e2a\u9898\u76ee\u5c31\u53ef\u4ee5\u7528 $O(n\\log n)$ \u6216\u8005 $O(n\\log^2n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u89e3\u51b3\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#pragma GCC optimize(\"Ofast,unroll-loops\")\nusing namespace std;\ntypedef int ll;\ntypedef long long int li;\ntypedef unsigned long long int ull;\nconst ll MAXN=524291,MOD=998244353,G=3,INVG=332748118;\nll n,cnt,limit; \nll f[MAXN],g[MAXN],tmp[MAXN],tmp2[MAXN],tmp3[MAXN],rev[MAXN<<1],omgs[MAXN<<1];\ninline ll read()\n{\n    register ll num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n} \ninline ll qpow(ll base,ll exponent)\n{\n    li res=1;\n    while(exponent)\n    {\n        if(exponent&1)\n        {\n            res=1ll*res*base%MOD;\n        }\n        base=1ll*base*base%MOD,exponent>>=1;\n    }\n    return res;\n}\ninline void setupOmg(ll cnt)\n{\n\tll limit=log2(cnt)-1,omg;\n\tomg=qpow(G,(MOD-1)>>(limit+1)),omgs[cnt>>1]=1;\n\tfor(register int i=(cnt>>1|1);i!=cnt;i++)\n\t{\n\t\tomgs[i]=(li)omgs[i-1]*omg%MOD;\n\t}\n\tfor(register int i=(cnt>>1)-1;i;i--)\n\t{\n\t\tomgs[i]=omgs[i<<1]; \n\t}\n}\ninline void NTT(ll *cp,ll cnt,ll inv)\n{\n\tstatic ull tcp[MAXN];\n    register ll cur=0,x,shift=log2(cnt)-__builtin_ctz(cnt);\n    if(inv==-1)\n    {\n    \treverse(cp+1,cp+cnt);\n\t}\n    for(register int i=0;i<cnt;i++)\n\t{\n\t\ttcp[rev[i]>>shift]=cp[i];\n\t}\n    for(register int i=2;i<=cnt;i<<=1)\n    {\n        cur=i>>1;\n        for(register int j=0;j<cnt;j+=i)\n        {\n            for(register int k=0;k<cur;k++)\n            {\n                x=tcp[j|k|cur]*omgs[k|cur]%MOD;\n                tcp[j|k|cur]=tcp[j|k]+MOD-x,tcp[j|k]+=x;\n            }\n        }\n    }\n    for(register int i=0;i<cnt;i++)\n    {\n    \tcp[i]=tcp[i]%MOD;\n\t}\n\tif(inv==1)\n\t{\n\t\treturn;\n\t}\n    x=MOD-(MOD-1)/cnt;\n    for(register int i=0;i<cnt;i++)\n    {\n    \tcp[i]=(li)cp[i]*x%MOD;\n\t}\n}\ninline void conv(ll cnt,ll *f,ll *g,ll *res)\n{\n    static ll tmpf[MAXN],tmpg[MAXN];\n    for(register int i=0;i<cnt;i++)\n    {\n        tmpf[i]=f[i],tmpg[i]=g[i],res[i]=0;\n    }\n    ll limit=log2(cnt)-1;\n    for(register int i=0;i<cnt;i++)\n    {\n        rev[i]=(rev[i>>1]>>1)|((i&1)<<limit);\n    }\n    NTT(tmpf,cnt,1),NTT(tmpg,cnt,1);\n    for(register int i=0;i<cnt;i++)\n    {\n        res[i]=(li)tmpf[i]*tmpg[i]%MOD;\n        tmpf[i]=tmpg[i]=0;\n    }\n    NTT(res,cnt,-1);\n}\ninline void calc(ll l,ll r)\n{\n\tll mid=(l+r)>>1;\n\tif(l==1)\n\t{\n\t\tfor(register int i=l;i<=mid;i++)\n\t\t{\n\t\t\ttmp[i-l]=f[i],tmp2[i-l]=g[i];\n\t\t}\n\t\tll cnt=1;\n\t\twhile(cnt<=((r-l)<<1))\n\t\t{\n\t\t\tcnt<<=1;\n\t\t}\n\t\tconv(cnt,tmp,tmp2,tmp3);\n\t\tfor(register int i=mid+1;i<=r;i++)\n\t\t{\n\t\t\tf[i]=(f[i]+tmp3[i-l-1])%MOD;\n\t\t}\n\t\tfor(register int i=0;i<cnt;i++)\n\t\t{\n\t\t\ttmp[i]=tmp2[i]=tmp3[i]=0;\n\t\t}\n\t\treturn;\n\t}\n\tfor(register int i=l;i<=mid;i++)\n\t{\n\t\ttmp[i-l]=f[i];\n\t}\n\tfor(register int i=1;i<=r-l;i++)\n\t{\n\t\ttmp2[i-1]=g[i];\n\t}\n\tll cnt=1;\n\twhile(cnt<=((r+mid-l-l+1)<<1))\n\t{\n\t\tcnt<<=1;\n\t}\n\tconv(cnt,tmp,tmp2,tmp3);\n\tfor(register int i=mid+1;i<=r;i++)\n\t{\n\t\tf[i]=(f[i]+tmp3[i-l-1])%MOD;\n\t}\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\ttmp[i]=tmp2[i]=tmp3[i]=0;\n\t}\n\tfor(register int i=l;i<=mid;i++)\n\t{\n\t\ttmp[i-l]=g[i];\n\t}\n\tfor(register int i=1;i<=r-l;i++)\n\t{\n\t\ttmp2[i-1]=f[i];\n\t}\n\tconv(cnt,tmp,tmp2,tmp3);\n\tfor(register int i=mid+1;i<=r;i++)\n\t{\n\t\tf[i]=(f[i]+tmp3[i-l-1])%MOD;\n\t}\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\ttmp[i]=tmp2[i]=tmp3[i]=0;\n\t}\n}\ninline void cdqFFT(ll l,ll r)\n{\n\tif(l==r)\n\t{\n\t\tf[l]=l!=1?((li)f[l]*qpow(l-1,MOD-2)%MOD):1;\n\t\tfor(register int i=l;i<=n;i+=l)\n\t\t{\n\t\t\tg[i]=(g[i]+(li)f[l]*l%MOD)%MOD;\n\t\t}\n\t\treturn;\n\t}\n\tll mid=(l+r)>>1;\n\tcdqFFT(l,mid),calc(l,r),cdqFFT(mid+1,r);\n}\nint main()\n{\n\tn=read()+1,cnt=1;\n\twhile(cnt<=n)\n\t{\n\t\tcnt<<=1;\n\t}\n\tsetupOmg(cnt<<1),cdqFFT(1,cnt),cnt=1,limit=-1;\n\twhile(cnt<=(n<<1))\n\t{\n\t\tcnt<<=1,limit++;\n\t}\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<limit);\n\t\ttmp[i]=i<=n?f[i]:0;\n\t}\n\tNTT(tmp,cnt,1);\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\ttmp[i]=(li)tmp[i]*tmp[i]%MOD;\n\t}\n\tNTT(tmp,cnt,-1);\n\tfor(register int i=1;i<=n;i+=2)\n\t{\n\t\tg[i]=(f[i]-(li)tmp[i]*499122177%MOD+MOD)%MOD; \n\t}\n\tfor(register int i=2;i<=n;i+=2)\n\t{\n\t\ttmp[i]=(tmp[i]-(li)f[i>>1]*f[i>>1]%MOD+MOD)%MOD;\n\t\tg[i]=(f[i]-(li)tmp[i]*499122177%MOD+MOD)%MOD;\n\t\tg[i]=(g[i]-(li)f[i>>1]*(f[i>>1]-1)%MOD*499122177%MOD+MOD)%MOD;\n\t}\n\tprintf(\"%d\\n\",g[n-1]);\n}\n```",
        "postTime": 1585188537,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5900 \u3010\u65e0\u6807\u53f7\u65e0\u6839\u6811\u8ba1\u6570\u3011"
    },
    {
        "content": "## \u65e0\u6807\u53f7\u65e0\u6839\u6811\u8ba1\u6570\n\u8fd9\u9053\u9898\u9898\u89e3\u533a\u6709\u5f88\u591a\u795e\u4ed9\u9898\u89e3\uff0c\u8bb2\u89e3\u5f97\u5f88\u5168\u9762\uff0c\u672c\u7bc7\u9898\u89e3\u4ec5\u505a\u4e00\u4e9b\u7ec6\u8282\u8865\u5145\u548c\u4ee3\u7801\u5b9e\u73b0\u65b9\u9762\u7684\u8bb2\u89e3\u3002\n### \u9898\u610f\n\u6c42 $n$ \u4e2a\u70b9\u7684\u65e0\u6807\u53f7\u65e0\u6839\u6811\u6570\u91cf\uff0c\u7b54\u6848\u5bf9 $998,244,353$ \u53d6\u6a21\u3002($1\\le n\\le 2\\times10^5$)\n### \u9898\u89e3\n\u6ce8\u610f\u5230\u65e0\u6839\u6811\u8fd9\u4e2a\u9650\u5236\u6bd4\u8f83\u6076\u5fc3\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u4e00\u68f5\u6811\u6211\u4eec\u603b\u8981\u627e\u4e2a\u6839\u624d\u597d\u5904\u7406\u5404\u79cd\u4e1c\u897f\u3002\u6240\u4ee5\u8003\u8651\u5148\u8ba1\u7b97\u65e0\u6807\u53f7\u6709\u6839\u6811\u7684\u6570\u91cf\uff0c\u7136\u540e\u51cf\u53bb\u6839\u4e0d\u662f\u91cd\u5fc3\u7684\u65b9\u6848\u3002\n\n\u800c\u5bf9\u4e8e\u6709\u6839\u6811\uff0c\u94a6\u5b9a\u5b8c\u4e00\u4e2a\u6839\u4e4b\u540e\u5269\u4e0b $n-1$ \u4e2a\u70b9\u4f1a\u5206\u6210\u82e5\u5e72\u4e2a\u975e\u7a7a\u96c6\u5408\uff08\u4e14\u975e\u7a7a\u96c6\u5408\u4e4b\u95f4\u987a\u5e8f\u65e0\u6240\u8c13\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48\u540e\u6587\u7528\u7684 OGF \u800c\u4e0d\u662f EGF\uff09\uff0c\u6bcf\u4e2a\u96c6\u5408\u5bf9\u5e94\u4e00\u68f5\u5b50\u6811\uff0c\u800c\u6bcf\u68f5\u5b50\u6811\u53c8\u662f\u7c7b\u4f3c\u7684\u7ed3\u6784\uff0c\u5373\u5177\u6709\u9012\u5f52\u7684\u5f62\u5f0f\u3002\u8fd9\u6837\u5982\u679c\u6211\u4eec\u8bbe\u7b54\u6848\u7684 OGF \u4e3a\uff1a\n$$F(x)=\\sum_{n\\ge 0}f_nx^n$$\n\u5219\u5b83\u5e94\u8be5\u6ee1\u8db3\u7b49\u5f0f\uff1a\n$$[x^n]F(x)=[x^{n-1}]\\prod_{k\\ge 1}\\left(\\sum_{i\\ge 0}x^{ik}\\right)^{f_k}$$\n\u5176\u5b9e\u5c31\u662f\u628a\u9009\u62e9\u96c6\u5408\u7684\u8fc7\u7a0b\u5f53\u505a\u80cc\u5305\uff0c\u6bcf\u79cd\u96c6\u5408\u7684\u5927\u5c0f\u5f53\u6210\u4e00\u79cd\u7269\u54c1\uff0c\u4f1a\u8d21\u732e $f_i$ \u7684\u65b9\u6848\u6570\uff0c\u7ed3\u5408\u4e0a\u9762\u8bf4\u7684\u65e0\u6807\u53f7\u6709\u6839\u6811\u7684\u6027\u8d28\u5f88\u5bb9\u6613\u5f97\u51fa\u8fd9\u4e2a\u7b49\u5f0f\u3002\u6839\u636e\uff1a\n$$\\left(\\dfrac{1}{1-x^k}\\right)^{f_k}=\\left(\\sum_{i\\ge 0}x^{ik}\\right)^{f_k}$$\n\u80fd\u628a\u539f\u5f0f\u7684 $\\sum$ \u5e72\u6389\uff1a\n$$[x^n]F(x)=[x^{n-1}]\\prod_{k\\ge 1}\\left(\\dfrac{1}{1-x^k}\\right)^{f_k}$$\n\u8fd9\u91cc\u518d\u7b80\u5355\u4e58\u4e0a\u4e00\u4e2a $x$ \u5c31\u80fd\u628a $[x^n],[x^{n-1}]$ \u5e72\u6389\u4e86\uff1a\n$$F(x)=x\\prod_{k\\ge 1}\\left(\\dfrac{1}{1-x^k}\\right)^{f_k}$$\n\u770b\u6765\u6211\u4eec\u95ee\u9898\u7684\u5173\u952e\u5c31\u843d\u5728\u4e86 $\\prod_{k\\ge 1}\\left(\\frac{1}{1-x^k}\\right)^{f_k}$ \u8fd9\u4e2a\u4e1c\u897f\u4e0a\u9762\u3002\u6ce8\u610f $\\prod$ \u662f\u5f88\u96be\u5904\u7406\u7684\uff0c\u6240\u4ee5\u8003\u8651\u53d6\u5bf9\u6570\u8f6c\u5316\u4e3a $\\sum$\uff1a\n$$\\begin{aligned}\\prod_{k\\ge 1}\\left(\\dfrac{1}{1-x^k}\\right)^{f_k}&=\\exp\\left(\\sum_{k\\ge 1}\\ln\\left(\\dfrac{1}{1-x^k}\\right)^{f_k}\\right)\\\\&=\\exp\\left(\\sum_{k\\ge1}-f_k\\ln(1-x^k)\\right)\\end{aligned}$$\n\u73b0\u5728\u538b\u529b\u6765\u5230\u4e86 $\\ln(1-x^k)$ \u8fd9\u8fb9\u3002\u56e0\u4e3a $\\ln$ \u5f88\u96be\u5904\u7406\uff0c\u4f46\u5b83\u7684\u5bfc\u6570\u5f88\u597d\u5904\u7406\uff0c\u6240\u4ee5\u8003\u8651\u6c42\u5bfc\uff1a\n$$\\ln(1-x^k)=\\int\\dfrac{\\mathrm{d}}{\\mathrm{d}x}\\ln(1-x^k)=\\int\\dfrac{-kx^{k-1}}{1-x^k}$$\n\u6211\u4eec\u80fd\u770b\u5230\u73b0\u5728\u79ef\u5206\u53f7\u91cc\u9762\u7684\u5c31\u662f\u4e00\u4e2a\u6211\u4eec\u77e5\u9053\u5bf9\u5e94\u5e42\u7ea7\u6570\u7684\u5c01\u95ed\u5f62\u5f0f\u4e86\uff1a\n$$\\int\\dfrac{-kx^{k-1}}{1-x^k}=-\\int\\sum_{n\\ge 0}kx^{(n+1)k-1}=-\\int\\sum_{n\\ge 1}kx^{nk-1}$$\n\u73b0\u5728\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u5f88\u597d\u770b\u4e86\uff0c\u53ea\u9700\u8981\u628a\u79ef\u5206\u53f7\u7b97\u8fdb\u53bb\uff1a\n$$-\\int\\sum_{n\\ge 1}kx^{nk-1}=-\\sum_{n\\ge 1}\\dfrac{kx^{nk-1+1}}{nk-1+1}=-\\sum_{n\\ge 1}\\dfrac{x^{nk}}{n}$$\n\u597d\uff0c\u8fd9\u4e1c\u897f\u7684\u53e6\u4e00\u79cd\u5f62\u5f0f\u663e\u7136\u66f4\u4fbf\u4e8e\u5f0f\u5b50\u7684\u5316\u7b80\uff0c\u6211\u4eec\u4ee3\u56de\u53bb\uff1a\n$$\\begin{aligned}\\exp\\left(\\sum_{k\\ge1}-f_k\\ln(1-x^k)\\right)&=\\left(\\exp\\sum_{k\\ge1}f_k\\sum_{n\\ge 1}\\dfrac{x^{nk}}{n}\\right)\\\\&=\\exp\\left(\\sum_{n\\ge 1}\\dfrac{1}{n}\\sum_{k\\ge 1}f_kx^{nk}\\right)\\\\&=\\exp\\left(\\sum_{n\\ge 1}\\dfrac{F(x^n)}{n}\\right)\\end{aligned}$$\n\u554a\u8fd9\u5c31\u597d\u591a\u4e86\uff0c\u6ce8\u610f\u5230\u6211\u4eec\u6709\u7b49\u5f0f\uff1a\n$$F(x)=x\\exp\\left(\\sum_{n\\ge 1}\\dfrac{F(x^n)}{n}\\right)$$\n\u8fd8\u662f\u7c7b\u4f3c $\\ln$\uff0c\u9047\u5230 $\\exp$ \u8003\u8651\u6c42\u5bfc\uff1a\n$$\\begin{aligned}F'(x)&=\\left(x\\exp\\left(\\sum_{n\\ge 1}\\dfrac{F(x^n)}{n}\\right)\\right)'\\\\&=x'\\exp\\left(\\sum_{n\\ge 1}\\dfrac{F(x^n)}{n}\\right)+x\\left(\\exp\\left(\\sum_{n\\ge 1}\\dfrac{F(x^n)}{n}\\right)\\right)'\\\\&=\\dfrac{F(x)}{x}+x\\exp\\left(\\sum_{n\\ge 1}\\dfrac{F(x^n)}{n}\\right)\\left(\\sum_{n\\ge 1}\\dfrac{F(x^n)}{n}\\right)'\\\\&=\\dfrac{F(x)}{x}+F(x)\\sum_{n\\ge 1}\\dfrac{F'(x^n)nx^{n-1}}{n}\\\\&=\\dfrac{F(x)}{x}+F(x)\\sum_{n\\ge 1}F'(x^n)x^{n-1}\\end{aligned}$$\n\u4e24\u8fb9\u540c\u65f6\u4e58\u4e0a $x$\uff0c\u4f1a\u8ba9\u5f0f\u5b50\u66f4\u597d\u770b\uff1a\n$$xF'(x)=F(x)+F(x)\\sum_{n\\ge 1}F'(x^n)x^n$$\n\u6ce8\u610f\u5230\u8fd9\u4e2a\u7b49\u5f0f\u54ea\u54ea\u90fd\u597d\uff0c\u5c31\u662f\u6700\u540e\u4e00\u4e2a\u6c42\u548c\u5f0f\u5f88\u6076\u5fc3\u3002\u8003\u8651\u5b9a\u4e49 $G(x)=\\sum_{n\\ge 1}F'(x^n)x^n$\uff0c\u5e76\u7814\u7a76\u4e00\u4e0b $[x^i]G(x)$ \u7684\u53d6\u503c\u3002\u8ba9\u6211\u4eec\u628a $G(x)$ \u5c55\u5f00\uff1a\n$$\\begin{aligned}G(x)&=\\sum_{n\\ge 1}x^n\\sum_{j\\ge 1}jf_jx^{n(j-1)}\\\\&=\\sum_{n\\ge 1}\\sum_{j\\ge 1}jf_jx^{nj}\\end{aligned}$$\n\u8fd9\u6837\u7684\u8bdd\uff0c\u5bf9\u4e8e $x^i$ \u505a\u8d21\u732e\u7684\u6240\u6709 $jf_j$ \u5e94\u8be5\u6ee1\u8db3 $j|i$\uff0c\u5373\uff1a\n$$[x^i]G(x)=\\sum_{j|i}f_jj$$\n\u628a $G(x)$ \u5e26\u56de\u539f\u5f0f\uff1a\n$$xF'(x)-F(x)=F(x)G(x)$$\n\u800c\u6211\u4eec\u53d1\u73b0 $xF'(x)$ \u5176\u5b9e\u5c31\u662f\uff1a\n$$\\sum_{n\\ge 1}nf_nx^n$$\n\u6240\u4ee5\uff1a\n$$[x^n]F(x)=\\dfrac{[x^n]F(x)G(x)}{n-1}$$\n\u5373\uff1a\n$$f_n=\\dfrac{\\sum_{k=1}^{n-1}(f_kg_{n-k})}{n-1},f_1=1$$\n\u534a\u5728\u7ebf\u5377\u79ef\u6c42\u89e3\u5373\u53ef\u3002\u4e0d\u8fc7\u8fd9\u91cc\u7684\u534a\u5728\u7ebf\u5377\u79ef\u4e0e\u8c37\u8c37 [\u5206\u6cbb FFT \u677f\u5b50](https://www.luogu.com.cn/problem/P4721) \u7684\u534a\u5728\u7ebf\u5377\u79ef\u5e76\u4e0d\u662f\u4e00\u79cd\u3002\u6ce8\u610f\u90a3\u9053\u9898 $g$ \u662f\u7ed9\u51fa\u7684\uff0c\u800c\u8fd9\u91cc $g$ \u662f\u4f9d\u8d56\u4e8e\u524d\u9762\u6c42\u51fa\u7684 $f$ \u7684\u3002\u5728\u90a3\u9053\u9898\u4e2d\uff0c\u6211\u4eec\u7528\u5230\u7684\u534a\u5728\u7ebf\u5377\u79ef\u4f9d\u8d56\u4e8e\u8fd9\u4e2a\u5f0f\u5b50\uff1a\n$$f_{l\\sim mid}\\times g_{0\\sim r-l}\\rightarrow f_{mid\\sim r}$$\n\u6765\u7b97\u5de6\u8fb9\u5bf9\u53f3\u8fb9\u7684\u8d21\u732e\u3002\u4f46\u8fd9\u91cc\u56e0\u4e3a\u53ea\u6c42\u51fa\u4e86 $l\\sim mid$ \u7684 $f$\uff0c$g_{mid,\\sim r-l}$ \u7684\u503c\u8fd8\u6ca1\u6709\u8ba1\u7b97\uff0c\u8fd9\u9898\u8fd9\u6837\u505a\u663e\u7136\u662f\u9519\u8bef\u7684\u3002\u800c\u6b63\u786e\u7684\u7b56\u7565\u662f\uff0c\u5f53 $l=0$ \u65f6\uff1a\n$$f_{l\\sim mid}\\times g_{0\\sim mid}\\rightarrow f_{mid\\sim r}$$\n\u8fd9\u65f6\u5019\u663e\u7136\u6709\u8d21\u732e\u6f0f\u6389\u4e86\u3002\u8003\u8651\u5f53 $l>0$ \u65f6\u8865\u56de\u6765\uff1a\n$$\\begin{cases}g_{l\\sim mid}\\times f_{0,r-l}\\\\f_{l\\sim mid}\\times g_{0,r-l}\\end{cases}\\rightarrow f_{mid\\sim r}$$\n\u8fd9\u6837\u5c31\u80fd\u8865\u56de\u6765\u6f0f\u6389\u7684\u8d21\u732e\u4e86\u3002\n\n\u73b0\u5728\u6c42\u51fa\u6765 $F(x)$ \u4e86\uff0c\u4e0d\u8981\u5fd8\u4e86\u6211\u4eec\u8981\u8ba1\u6570\u7684\u662f\u65e0\u6839\u6811\u4e0d\u662f\u6709\u6839\u6811\u3002\u6240\u4ee5\u8981\u51cf\u6389\u6839\u4e0d\u662f\u91cd\u5fc3\u7684\u65b9\u6848\u3002\u5f53 $n$ \u662f\u5947\u6570\u65f6\uff0c\u663e\u7136\u539f\u6811\u53ea\u80fd\u6709\u4e00\u4e2a\u91cd\u5fc3\u3002\u800c\u91cd\u5fc3\u7684\u5b9a\u4e49\u662f\u6240\u6709\u5b50\u6811\u5927\u5c0f\u5747\u5c0f\u4e8e\u7b49\u4e8e $\\lfloor\\frac{n}{2}\\rfloor$\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u94a6\u5b9a\u4e00\u68f5\u5b50\u6811\u5927\u5c0f\u5927\u4e8e $\\lfloor\\frac{n}{2}\\rfloor$ \u5373\u53ef\uff0c\u8981\u51cf\u53bb\u7684\u65b9\u6848\u6570\u4e3a\uff1a\n$$\\sum_{k=\\lfloor\\frac{n}{2}\\rfloor+1}^{n-1}f_kf_{n-k}$$\n\u5373\u770b\u6210\u4e24\u68f5\u6709\u6839\u6811\u5206\u522b\u5904\u7406\uff0c\u7136\u540e\u628a\u5927\u5c0f\u4e3a $k$ \u7684\u90a3\u4e2a\u63a5\u5230\u53e6\u4e00\u4e2a\u7684\u6839\u4e0a\u3002\u800c\u5f53 $n$ \u4e3a\u5076\u6570\u65f6\uff0c\u9ebb\u70e6\u4e86\uff0c\u56e0\u4e3a\u53ef\u80fd\u51fa\u73b0\u4e24\u4e2a\u91cd\u5fc3\u7684\u60c5\u51b5\uff0c\u4e14\u5176\u4e2d\u4e00\u4e2a\u8fd8\u662f\u6839\uff0c\u5373\u5b58\u5728\u4e00\u68f5\u5b50\u6811\u5927\u5c0f\u6070\u7b49\u4e8e $\\frac{n}{2}$\u3002\u800c\u73b0\u5728\u8fd8\u662f\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u7b2c\u4e00\u79cd\u662f\u8fd9\u68f5\u5b50\u6811\u548c\u53bb\u6389\u8fd9\u68f5\u5b50\u6811\u540e\u7684\u539f\u6811\uff08\u7c7b\u6bd4\u5947\u6570\u60c5\u51b5\u4e0b $f_k$ \u548c $f_{n-k}$\uff09\u6070\u597d\u540c\u6784\uff0c\u90a3\u8fd9\u4e2a\u5c31\u4e0d\u4f1a\u91cd\u590d\u8ba1\u6570\u4e86\uff0c\u56e0\u4e3a\u8fd9\u4fe9\u6839\u672c\u8d28\u4e0a\u662f\u4e00\u6837\u7684\u3002\u800c\u5176\u4ed6\u60c5\u51b5\u5c31\u4f1a\u91cd\u590d\u8ba1\u6570\u4e00\u6b21\uff0c\u51cf\u6389\u7684\u65b9\u6848\u6570\u5373\u5728\u6240\u6709\u53ef\u80fd\u7684\u5f62\u6001\u4e2d\u9009\u4fe9\u63a5\u8d77\u6765\uff1a\n$$\\dbinom{f_{\\frac{n}{2}}}{2}$$\n\u8fd9\u6837\u8fd9\u9053\u9898\u5c31\u89e3\u51b3\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log^2n)$\u3002\u5728\u521a\u521a\u7684\u63a8\u5bfc\u4e2d\u6211\u628a $f_0$ \u8fd9\u4e00\u9879\u90fd\u5ffd\u7565\u4e86\uff0c\u4f46\u5728\u5b9e\u73b0\u91cc\u9762\u6211\u662f\u7b97\u4e0a\u4e86\u7684\uff0c\u4f46\u663e\u7136\u5f71\u54cd\u4e0d\u5927\u3002\n```cpp\n#include <cstdio>\n#include <algorithm>\nconst int N = 1e6 + 10, mod = 998244353; typedef long long ll;\nint f[N], g[N], A[N], B[N], rev[N], lim, n, m;\ninline int ksm(int a, int b)\n{\n    int ret = 1;\n    while (b)\n    {\n        if (b & 1) ret = (ll)ret * a % mod;\n        a = (ll)a * a % mod; b >>= 1;\n    }\n    return ret;\n}\ninline void init(int n)\n{\n    lim = 1; m = 0; while (lim <= n) lim <<= 1, ++m;\n    for (int i = 0; i < lim; ++i) rev[i] = (rev[i >> 1] >> 1) | ((i & 1) << (m - 1));\n}\ninline void NTT(int* f, int len, int on)\n{\n    for (int i = 0; i < len; ++i) if (i < rev[i]) std::swap(f[i], f[rev[i]]);\n    for (int h = 2; h <= len; h <<= 1)\n    {\n        int gn = ksm(3, (ll)on * ((mod - 1) / h) % (mod - 1));\n        for (int j = 0; j < len; j += h)\n            for (int k = j, g = 1; k < j + h / 2; ++k, g = (ll)g * gn % mod)\n            {\n                int u = f[k], t = (ll)g * f[k + h / 2] % mod;\n                f[k] = (u + t) % mod; f[k + h / 2] = ((u - t) % mod + mod) % mod;\n            }\n    }\n    if (on == mod - 2) for (int i = 0, inv = ksm(len, on); i < len; ++i) f[i] = (ll)f[i] * inv % mod;\n}\ninline void mul(int* f, int lF, int* g, int lG)\n{   \n    for (int i = 0; i < lF; ++i) A[i] = f[i];\n    for (int i = lF; i < lim; ++i) A[i] = 0;\n    for (int i = 0; i < lG; ++i) B[i] = g[i];\n    for (int i = lG; i < lim; ++i) B[i] = 0;\n    NTT(A, lim, 1); NTT(B, lim, 1); \n    for (int i = 0; i < lim; ++i) A[i] = (ll)A[i] * B[i] % mod;\n    NTT(A, lim, mod - 2);\n}\ninline void cdq(int l, int r)\n{\n    if (r == 1) return ;\n    if (l + 1 == r) \n    {\n        if (l != 1) f[l] = (ll)f[l] * ksm(l - 1, mod - 2) % mod;\n        for (int i = l; i < n; i += l) (g[i] += (ll)f[l] * l % mod) %= mod;\n        return ;\n    }\n    int mid = (l + r) >> 1; cdq(l, mid); init(r - l);\n    if (l > 0) \n    {\n        mul(f, r - l, g + l, mid - l);\n        for (int i = mid; i < r; ++i) (f[i] += A[i - l]) %= mod;\n    }\n    mul(f + l, mid - l, g, !l ? mid : r - l);\n    for (int i = mid; i < r; ++i) (f[i] += A[i - l]) %= mod;\n    cdq(mid, r);\n}\nsigned main()\n{\n    int m; scanf(\"%d\", &m); n = 1; while (n <= m) n <<= 1;\n    f[1] = 1; cdq(0, n); int ans = f[m];\n    for (int i = m / 2 + 1; i < m; ++i) (ans += (ll)(mod - f[i]) * f[m - i] % mod) %= mod;\n    if (!(m & 1)) (ans += (mod - (ll)f[m / 2] * (f[m / 2] - 1) / 2 % mod)) %= mod;\n    printf(\"%d\\n\", ans); return 0;\n}\n```\n\u9898\u505a\u5b8c\u4e86\uff0c\u6211\u4eec\u6765\u770b\u770b\u4ece\u8fd9\u9053\u9898\u6211\u4eec\u80fd\u5f97\u5230\u4ec0\u4e48\u3002\u6ce8\u610f\u5230\u521a\u521a\u6211\u4eec\u5904\u7406\u7684\u5f0f\u5b50\uff1a\n$$\\prod_{k\\ge 1}\\left(\\frac{1}{1-x^k}\\right)^{f_k}$$\n\u7684\u7ec4\u5408\u610f\u4e49\u662f\u628a\u539f\u96c6\u5408\u5206\u6210\u82e5\u5e72\u4e2a\u975e\u7a7a\u5b50\u96c6\uff0c\u4e14\u987a\u5e8f\u65e0\u6240\u8c13\uff0c\u5927\u5c0f\u4e3a $i$ \u7684\u7ec4\u65b9\u6848\u6570\u4e3a $f_i$\uff0c\u5bf9\u5e94\u7684\u603b\u65b9\u6848\u6570\u3002\u8fd9\u4e2a\u4e1c\u897f\u8ddf EGF \u4e2d\u7684 $\\exp$ \u4f3c\u4e4e\u5f88\u76f8\u4f3c\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u7ed9\u5b83\u5355\u72ec\u8d77\u4e00\u4e2a\u540d\u5b57\uff1aEuler \u53d8\u6362\uff0c$F(x)$ \u7684 Euler \u53d8\u6362\u901a\u5e38\u8bb0\u4e3a $\\mathcal{E}F(x)$\u3002\u521a\u521a\u5df2\u7ecf\u5f97\u51fa\u4e86\u5b83\u7684\u4e24\u79cd\u5f62\u5f0f\uff1a\n$$\\mathcal{E}F(x)=\\prod_{k}\\left(\\frac{1}{1-x^k}\\right)^{f_k}=\\exp\\left(\\sum_{n}\\dfrac{F(x^n)}{n}\\right)$$\n\u4e2a\u4eba\u8ba4\u4e3a\u7b97\u662f OGF \u7248\u7684 \u201c$\\exp$\u201d\uff0c\u4e0d\u8003\u8651\u5206\u6210\u5b50\u96c6\u7684\u524d\u540e\u987a\u5e8f\u3002\n\nps. \u534a\u5728\u7ebf\u5377\u79ef\u7684\u90e8\u5206\u53c2\u8003 $\\tt command\\_ block$ \u7684 [\u535a\u5ba2](https://www.luogu.com.cn/blog/command-block/ban-zai-xian-juan-ji-xiao-ji)\u3002\n\npps. \u672c\u9898\u8fd8\u53ef\u4ee5\u7528\u725b\u987f\u8fed\u4ee3\u5728 $\\mathcal{O}(n\\log n)$ \u7684\u65f6\u95f4\u5185\u6c42\u89e3\uff0c\u4f46\u90a3\u4e2a\u65b9\u6cd5\u6d89\u53ca\u5230 $\\exp$\uff0c\u6240\u4ee5\u5e38\u6570\u4f1a\u6bd4\u8f83\u7206\u70b8\uff0c\u5177\u4f53\u53ef\u4ee5\u770b\u5176\u4ed6\u795e\u4ed9\u7684\u9898\u89e3\u3002\n\nppps. \u5173\u4e8e\u6700\u540e\u6254\u51fa\u7684 Euler \u53d8\u6362\u7b2c\u4e8c\u4e2a\u5f62\u5f0f\u7684\u8bc1\u660e\uff0c\u9898\u89e3\u533a\u8fd8\u7ed9\u51fa\u4e86\u7528\u7fa4\u8bba\u65b9\u6cd5\u8bc1\u660e\u7684\u601d\u8def\u3002\n\npppps. \u6211\u7684\u4ee3\u7801\u5e38\u6570\u5927\u5f97\u8981\u547d\uff0c\u770b\u770b\u7406\u89e3\u548b\u5b9e\u73b0\u53ef\u4ee5\uff0c\u501f\u9274\u5177\u4f53\u5b9e\u73b0\u65b9\u5f0f\u5c31\u7b97\u4e86\u3002",
        "postTime": 1645183934,
        "uid": 137603,
        "name": "zhiyangfan",
        "ccfLevel": 9,
        "title": "P5900 \u65e0\u6807\u53f7\u65e0\u6839\u6811\u8ba1\u6570 \u9898\u89e3"
    },
    {
        "content": "# \u65e0\u6807\u53f7\u6709\u6839\u6811\u8ba1\u6570\n\n\u5bf9\u4e8e\u4e00\u4e2a\u7ed9\u5b9a\u7684\u6839,\u8fd9\u68f5\u6811\u7684\u65b9\u6848\u6570\u76f8\u5f53\u4e8e\u5c06\u9664\u6839\u5916\u7684\u6240\u6709\u70b9\u5212\u5206\u8fdb\u82e5\u5e72\u68f5\u4e0d\u80fd\u4e3a\u7a7a\u7684\u5b50\u6811\u7684\u65b9\u6848\u6570,\u90a3\u4e48\u6784\u9020\u65b9\u6848\u6570\u5173\u4e8e\u70b9\u6570\u7684 $OGF$ ,\u8bbe\u4e3a $F$ ,\u90a3\u4e48\u6709\u65b9\u7a0b $F(x)=x\\times euler(F(x))$\n\n\u90a3\u4e48\u95ee\u9898\u5c31\u662f\u5982\u4f55\u6c42\u89e3\u65b9\u7a0b $F(x)-x\\times euler(F(x))=0$\n\n\u8003\u8651\u500d\u589e\n## \u76f4\u63a5\u500d\u589e\u7684\u505a\u6cd5\n\n\u73b0\u5728\u5df2\u7ecf\u6c42\u51fa $f$ \u6ee1\u8db3 $f(x)-x\\times euler(f(x))\\equiv 0\\mod x^n$\n\n\u8003\u8651\u5982\u4f55\u6c42\u51fa $F$ \u6ee1\u8db3 $F(x)-x\\times euler(F(x))\\equiv 0\\mod x^{2n}$\n\n\u5bb9\u6613\u53d1\u73b0, $\\forall k\\geq 2$,$f(x^k)\\mod x^{2n}$ \u90fd\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u6c42\u51fa,\u4e14 $f(x^k)\\equiv F(x^k)\\mod x^{2n}$\n\n\u6240\u4ee5\u5f53 $f$ \u4e3a\u5e38\u6570\u65f6,$P(x)=x\\exp\\sum_{k=2}\\frac{f(x^k)}{k}\\mod x^{2n}$ \u4e5f\u4e3a\u5e38\u6570\n\n\u518d\u5e26\u5165 $Euler$ \u53d8\u6362\u7684\u67ff\u5b50,\u663e\u7136 $F(x)-P(x)\\exp F(x)\\equiv 0\\mod x^{2n}$\n\n$$\\frac{F(x)}{\\exp F(x)}\\equiv P(x)\\mod x^{2n}$$\n\n\u518d\u505a\u725b\u987f\u8fed\u4ee3\n\n\u73b0\u5728\u5df2\u7ecf\u6c42\u51fa $g$ \u6ee1\u8db3 $\\frac{g(x)}{\\exp g(x)}\\equiv P(x)\\mod x^n$\n\n\u8003\u8651\u5982\u4f55\u6c42\u51fa $G$ \u6ee1\u8db3 $\\frac{G(x)}{\\exp G(x)}\\equiv P(x)\\mod x^{2n}$\n\n\u6c42\u7684\u662f $H(x)=\\frac{x}{\\exp x}-P$,$H(F(x))\\equiv 0\\mod x^{2n}$ \u7684 $F$\n\n\u5728 $g(x)$ \u5904\u5c06$H$\u6cf0\u52d2\u5c55\u5f00\n\n$$H(G(x))\\equiv H(g(x))+\\sum_{i=1}\\frac{H^{i'}(g(x))(G(x)-g(x))^i}{i!}\\mod x^{2n}$$\n\n$$\\equiv H(g(x))+H'(g(x))\\times (G(x)-g(x))$$\n\n$$\\equiv 0$$\n\n$$G(x)=g(x)-\\frac{H(g(x))}{H'(g(x))}$$\n\n\u8003\u8651\u5982\u4f55\u6c42 $H'(g(x))$\n\n$$H'(x)=\\frac{\\exp x-x\\exp x}{(\\exp x)^2}=\\frac{1-x}{\\exp x}$$\n\n$$H'(g(x))=\\frac{1-g(x)}{\\exp g(x)}$$\n\n(\u8fd9\u91cc\u662f\u5bf9 $g$ \u6c42\u5bfc\u800c\u4e0d\u662f $x$ )\n\n$$G(x)=g(x)-\\frac{\\frac{g(x)}{\\exp g(x)}-P(x)}{\\frac{1-g(x)}{\\exp g(x)}}$$\n\n$$=g(x)+\\frac{g(x)-P(x)\\times \\exp g(x)}{g(x)-1}$$\n\n\u8be5\u505a\u6cd5\u662f\u6b63\u786e\u7684,\u590d\u6742\u5ea6\u4e5f\u662f\u6b63\u786e\u7684,\u4f46\u662f\u5e38\u6570\u5de8\u5927,\u53ea\u80fd\u8fc7 $50\\%$ \u7684\u70b9, $O(n\\log n)$ \u7684\u590d\u6742\u5ea6 $2\\times 10^5$ \u8dd1\u4e86 $25s$\n\n[\u4ee3\u7801](https://www.luogu.com.cn/paste/2lhx82p5)\n## \u57fa\u4e8e\u76f4\u63a5\u500d\u589e\u505a\u6cd5\u7684\u5927\u4f18\u5316\n\u53c2\u8003\u9898\u89e3,\u53ef\u4ee5\u53d1\u73b0\u4ee5\u4e0a\u505a\u6cd5\u5e38\u6570\u5de8\u5927\u7684\u539f\u56e0\u5e76\u4e0d\u662f\u56e0\u4e3a\u9700\u8981\u505a $\\exp$ ,\u800c\u662f\u500d\u589e\u5957\u500d\u589e\u7684\u5c42\u6570\u592a\u591a\u4e86.\n\u4e8b\u5b9e\u4e0a,\u7b2c\u4e00\u5c42\u500d\u589e\u4e0e\u7b2c\u4e8c\u5c42\u725b\u987f\u8fed\u4ee3\u5b8c\u5168\u53ef\u4ee5\u5408\u5e76.\n\n\u56de\u5230\u4e00\u5f00\u59cb\u7684\u95ee\u9898.\u6211\u4eec\u8981\u6c42\u89e3\u7684\u662f\u65b9\u7a0b $F(x)-x\\times euler(F(x))\\equiv 0\\mod x^n$\n\n\u73b0\u5728\u5df2\u7ecf\u6c42\u5f97\u65b9\u7a0b $f(x)-x\\times euler(f(x))\\equiv 0\\mod x^{n/2}$ \u7684\u89e3\n\n\u663e\u7136, $F(x)$\u4e0e$f(x)$ \u7684\u524d $n/2$ \u9879\u662f\u76f8\u540c\u7684\n\n\u5c06\u65b9\u7a0b\u8f6c\u5316\u4e3a $F(x)-P(F(x))\\exp F(x)\\equiv 0\\mod x^n$\n\n\u5176\u4e2d $P(F(x))\\equiv x\\times \\exp\\sum_{k=2}\\frac{F(x^k)}{k}\\mod x^n$\n\n\u663e\u7136, $P(F(x))=P(f(x))$\n\n\u725b\u987f\u8fed\u4ee3\u6c42\u89e3\u65b9\u7a0b $F(x)-P(F(x))\\exp F(x)\\equiv 0\\mod x^n$\n\n\u73b0\u5728\u5df2\u7ecf\u6c42\u5f97\u65b9\u7a0b $g(x)-P(F(x))\\exp g(x)\\equiv 0\\mod x^{n/2}$\n\n\u663e\u7136, $g(x)-P(f(x))\\exp g(x)\\equiv 0\\mod x^{n/2}$ ,\u540c\u65f6$f(x)-P(f(x))\\exp f(x)\\equiv 0\\mod x^{n/2}$\n\n\u4e0d\u96be\u53d1\u73b0, $g(x)\\equiv f(x)\\mod x^{n/2}$\n\n\u76f4\u63a5\u5957\u7528\u4e4b\u524d\u725b\u987f\u8fed\u4ee3\u7684\u67ff\u5b50\n$$F(x)=f(x)+\\frac{f(x)-P(f(x))\\times \\exp f(x)}{f(x)-1}$$\n\n\u8be5\u505a\u6cd5\u662f\u6b63\u786e\u7684,\u590d\u6742\u5ea6\u4e5f\u662f\u6b63\u786e\u7684,\u4f46\u662f\u5e38\u6570\u4e5f\u5de8\u5927,\u4e5f\u53ea\u80fd\u8fc7 $50\\%$ \u7684\u70b9,\u4e0d\u8fc7 $O(n\\log n)$ \u7684\u590d\u6742\u5ea6 $2\\times 10^5$ \u8dd1\u4e86 $14s$,\u6bd4\u4e4b\u524d\u5feb\u4e86\u4e0d\u5c11\n[\u4ee3\u7801](https://www.luogu.com.cn/paste/g4yh0sh7)\n## \u57fa\u4e8e\u4e24\u8fb9\u53d6$\\ln$\u7684\u505a\u6cd5\n\n\u4ee5\u4e0a\u505a\u6cd5\u56e0\u4e3a\u505a\u4e86\u5f88\u591a\u6b21 $\\exp$ ,\u5e38\u6570\u5341\u5206\u5413\u4eba.\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u628a $\\exp$ \u6362\u6210 $\\ln$ ,\u5e38\u6570\u4f1a\u4f18\u5f88\u591a\n\n\u56de\u5230\u4e00\u5f00\u59cb\u7684\u95ee\u9898.\u6211\u4eec\u8981\u6c42\u89e3\u7684\u662f\u65b9\u7a0b $F(x)-x\\times euler(F(x))\\equiv 0\\mod x^n$\n\n\u73b0\u5728\u5df2\u7ecf\u6c42\u5f97\u65b9\u7a0b $f(x)-x\\times euler(f(x))\\equiv 0\\mod x^{n/2}$ \u7684\u89e3\n\n\u663e\u7136, $F(x)$ \u4e0e $f(x)$ \u7684\u524d $n/2$ \u9879\u662f\u76f8\u540c\u7684\n\n\u5c06\u65b9\u7a0b\u8f6c\u5316\u4e3a $F(x)\\equiv P(F(x))\\exp F(x)\\mod x^n$\n\n\u5176\u4e2d $P(F(x))\\equiv x\\times \\exp\\sum_{k=2}\\frac{F(x^k)}{k}\\mod x^n$\n\n\u5bf9\u8fd9\u4e2a\u67ff\u5b50\u4e24\u8fb9\u53d6 $\\ln$ \n,$\\ln F(x)\\equiv \\sum_{k=2}\\frac{F(x^k)}{k}+\\ln x+F(x)\\mod x^{n}$\n\n\u663e\u7136, $\\ln f(x)\\equiv \\sum_{k=2}\\frac{F(x^k)}{k}+\\ln x+f(x)\\mod x^{n/2}$\n\n\u8bbe $P(x)=\\sum_{k=2}\\frac{F(x^k)}{k}+\\ln x$\n\n\u8bbe $G(x)=\\ln x-x-P$\n\n$$G'(x)=\\frac{1}{x}-1$$\n$$G'(f(x))=\\frac{1}{f(x)}-1$$\n\n$$F(x)=f(x)-\\frac{\\ln f(x)-f(x)-P(x)}{\\frac{1}{f(x)}-1}$$\n\n\u5bb9\u6613\u53d1\u73b0,$f(x)$ \u7684\u5e38\u6570\u9879\u4e3a $0$ \u4e14\u4e00\u6b21\u65b9\u9879\u4e0d\u4e3a $0$,\u5e76\u4e0d\u80fd\u6c42 $\\ln$ ,\u540c\u65f6 $P(x)$ \u4e2d\u7684 $\\ln x$ \u4e5f\u4e0d\u80fd\u6c42\u51fa\n\n\u90a3\u4e48,\u8bbe $a(x)=\\frac{f(x)}{x},A(x)=\\frac{F(x)}{x}$\n\n$$F(x)=f(x)-\\frac{\\ln a(x)+\\ln x-f(x)-\\sum_{k=2}\\frac{f(x^k)}{k}-\\ln x}{\\frac{1}{f(x)}-1}$$\n$$=f(x)-\\frac{\\ln a(x)-\\sum_{k=1}\\frac{f(x^k)}{k}}{\\frac{1}{f(x)}-1}$$\n\n$$F(x)=f(x)+\\frac{\\ln a(x)-\\sum_{k=1}\\frac{f(x^k)}{k}}{f(x)-1}\\times f(x)$$\n\n$$A(x)=a(x)-\\frac{\\ln a(x)-\\sum_{k=1}\\frac{f(x^k)}{k}}{\\frac{1}{a(x)}-x}$$\n\n\u8fd9\u6837\u5c31\u4e0d\u7528\u6c42 $\\exp$ \u4e86\n\n[\u4ee3\u7801](https://www.luogu.com.cn/paste/73ad4agb)\n\n### \u672a\u89e3\u4e4b\u8c1c\n1. \u6309\u7167\u67ff\u5b50 $F(x)=f(x)+\\frac{\\ln \\frac{f(x)}{x}-\\sum_{k=1}\\frac{f(x^k)}{k}}{f(x)-1}\\times f(x)$ \u725b\u987f\u8fed\u4ee3\u6ca1\u6cd5\u8fc7,\u4f46\u662f\u6309\u7167\u67ff\u5b50 $A(x)=a(x)-\\frac{\\ln a(x)-\\sum_{k=1}\\frac{f(x^k)}{k}}{\\frac{1}{a(x)}-x}$ \u725b\u987f\u8fed\u4ee3\u53ef\u4ee5\u8fc7,\u975e\u5e38\u5947\u602a\n2. $n$\u6700\u5927\u4f1a\u7b49\u4e8e $2^{18}$,\u4f46\u662f\u628a\u6570\u7ec4\u5f00\u5230 $8\\times 10^5$ \u6ca1\u6cd5\u8fc7,\u5f00\u5230 $16\\times 10^5$ \u80fd\u8fc7\n# \u65e0\u6807\u53f7\u65e0\u6839\u6811\u8ba1\u6570\n\u8003\u8651\u7528\u603b\u7684\u65e0\u6807\u53f7\u6709\u6839\u6811\u65b9\u6848\u6570\u51cf\u53bb\u6839\u4e0d\u662f\u91cd\u5fc3\u7684\u65b9\u6848\u6570,\u8fd9\u6837\u6bcf\u4e2a\u65b9\u6848\u53ea\u4f1a\u5728\u6839\u4e3a\u91cd\u5fc3\u65f6\u88ab\u7edf\u8ba1\u4e00\u904d\n\n\u8bbe\u70b9\u6570\u4e3a $n$ ,\u5df2\u7ecf\u6c42\u51fa $i$ \u4e2a\u70b9\u7684\u65e0\u6807\u53f7\u6709\u6839\u6811\u65b9\u6848\u6570\u4e3a $f_i$\n\n## $n$\u4e3a\u5947\u6570\u65f6\n\n\u6839\u636e\u91cd\u5fc3\u7684\u6027\u8d28,\u6839\u8282\u70b9\u4e0d\u662f\u91cd\u5fc3,\u90a3\u4e48\u5fc5\u7136\u6709\u4e00\u4e2a\u5b50\u6811\u5927\u5c0f $\\ge \\lceil \\frac{n}{2} \\rceil$\n\n\u679a\u4e3e\u8fd9\u68f5\u5b50\u6811\u5927\u5c0f,\u7b54\u6848\u7b49\u4e8e $f_n-\\sum_{k=\\lceil \\frac{n}{2} \\rceil}^{n-1}f_k\\times f_{n-k}$\n\n## $n$\u4e3a\u5076\u6570\u65f6\n\n\u53ef\u80fd\u540c\u65f6\u5b58\u5728\u4e24\u4e2a\u91cd\u5fc3,\u5176\u4e2d\u4e00\u4e2a\u91cd\u5fc3\u4e3a\u6839\n\n\u65ad\u5f00\u4e24\u4e2a\u91cd\u5fc3\u4e4b\u95f4\u7684\u8fb9,\u4ea7\u751f\u4e24\u68f5\u4ee5\u91cd\u5fc3\u4e3a\u6839\u7684\u6811\n\n\u82e5\u8fd9\u4e24\u68f5\u6811\u5b8c\u5168\u76f8\u540c,\u90a3\u4e48\u5728 $f$ \u4e2d\u53ea\u4f1a\u88ab\u7edf\u8ba1\u4e00\u904d,\u4e0d\u7528\u51cf\u53bb\n\n\u5426\u5219,\u8fd9\u4e2a\u65b9\u6848\u5728 $f$ \u4e2d\u4f1a\u88ab\u7edf\u8ba1\u4e24\u904d,\u9700\u8981\u51cf\u53bb\u4e00\u904d,\u603b\u7684\u65b9\u6848\u6570\u662f $C_{f_{\\frac{n}{2}}}^2$ \u79cd\n\n\u4e24\u68f5\u5b50\u6811\u5927\u5c0f\u4e0d\u76f8\u7b49\u7684\u60c5\u51b5,\u6309\u7167\u539f\u6765\u7684\u65b9\u5f0f\u8ba1\u7b97\u5373\u53ef\n\n\u7b54\u6848\u7b49\u4e8e $f_n-\\sum_{k=\\frac{n}{2}+1}^{n-1}f_k\\times f_{n-k}-C_{f_{\\frac{n}{2}}}^{2}$\n\n---\n[\u53c2\u8003\u535a\u5ba2](https://blog.csdn.net/qq_35950004/article/details/106483384)\n",
        "postTime": 1597709950,
        "uid": 114409,
        "name": "9AC8E2",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5900 \u3010\u65e0\u6807\u53f7\u65e0\u6839\u6811\u8ba1\u6570\u3011"
    },
    {
        "content": "## \u6b27\u62c9\u53d8\u6362\n\n\u8003\u8651\u6c42\u89e3\u5f62\u5982\u4e0b\u5f0f\u7684 $\\rm OGF$ \uff1a\n\n$$F_i(x) = \\left(\\sum _ j x ^ {ji}\\right) ^ {f _ i} =  \\left(\\frac{1}{1 - x ^ i}\\right) ^ {f _ i}$$\n\n$$\\varepsilon\\circ F(x) = \\prod _ i F_i(x) = \\prod _ i \\left(\\frac{1}{1 - x ^ i}\\right) ^ {f _ i}$$\n\n\u8fd9\u4e2a $\\rm OGF$ \u7684\u7ec4\u5408\u610f\u4e49\u662f\u5c06 $n$ \u4e2a\u4e92\u4e0d\u533a\u5206\u7684\u5c0f\u7403\u5206\u8fdb\u82e5\u5e72\u4e2a\u975e\u7a7a\u96c6\u5408\uff0c\u5927\u5c0f\u4e3a $i$ \u7684\u96c6\u5408\u6709 $f_i$ \u79cd\u65b9\u6848\u7684\u603b\u65b9\u6848\u6570\u3002  \n\n\u6ce8\u610f\u5230\u4e0a\u5f0f\u53f3\u8fb9\u662f\u8fde\u4e58\uff0c\u4e8e\u662f\u5bf9\u5176\u53d6 $\\ln :$\n\n$$\\begin{aligned}\n    \\ln \\varepsilon \\circ F(x) &= \\sum _ i \\ln \\left(\\frac{1}{1 - x ^ i}\\right) ^ {f _ i}\\\\\n    &= \\sum _ i f_i \\times \\ln\\left(\\frac{1}{1 - x ^ i}\\right)\\\\\n    &= -\\sum _ i f_i \\times \\ln (1 - x ^ i)\\\\\n    &= \\sum _ i \\sum _ j \\frac{f_i}{j + 1} x ^ {i(j + 1)}\n\\end{aligned}$$\n\n\u7531\u4e8e\u6211\u4eec\u4e00\u822c\u53ea\u9700\u6c42\u751f\u6210\u51fd\u6570\u7684\u524d $n$ \u9879\uff0c\u89c2\u5bdf\u5230 $i$ \u548c $j$ \u7684\u679a\u4e3e\u6784\u6210\u4e86\u8c03\u548c\u7ea7\u6570\u7684\u5173\u7cfb\uff0c\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u8ba1\u7b97\u3002\n\n\u6700\u540e\u5c06\u6c42\u51fa\u7684\u5e42\u7ea7\u6570 $\\rm exp$ \u56de\u53bb\u5373\u53ef\u5f97\u5230 $\\varepsilon \\circ F(x).$\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n \\log n).$\n\n## \u65e0\u6807\u53f7\u65e0\u6839\u6811\u8ba1\u6570\n\n\u8003\u8651\u8bbe $f_n$ \u8868\u793a\u5927\u5c0f\u4e3a $n$ \u7684\u65e0\u6807\u53f7\u6709\u6839\u6811\u7684\u65b9\u6848\u6570\uff0c$F(x)$ \u4e3a\u6570\u5217 $f$ \u7684\u751f\u6210\u51fd\u6570\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u5c06\u4e00\u9897\u5927\u5c0f\u4e3a $n$ \u7684\u65e0\u6807\u53f7\u6709\u6839\u6811\u7684\u6839\u53bb\u9664\uff0c\u90a3\u4e48\u5269\u4e0b\u7684\u5b50\u6811\u662f\u4e00\u4e2a\u4e2a\u76f8\u540c\u7684\u5b50\u95ee\u9898\uff0c\u53ea\u8981\u5b50\u6811\u5927\u5c0f\u7684\u548c\u4e3a $n - 1$\uff0c\u518d\u52a0\u4e0a\u6839\u7ed3\u70b9\u5c31\u53ef\u4ee5\u552f\u4e00\u786e\u5b9a\u5730\u62fc\u51fa\u4e00\u9897\u65e0\u6807\u53f7\u6709\u6839\u6811\u3002\u4e8e\u662f\u6709\u751f\u6210\u51fd\u6570\u65b9\u7a0b \uff1a\n\n$$F(x) = x \\cdot \\varepsilon \\circ F(x)$$\n\n\u6c42\u89e3\u8fd9\u4e2a\u751f\u6210\u51fd\u6570\u65b9\u7a0b\u6709\u4e24\u79cd\u65b9\u6cd5\uff0c\u7b2c\u4e00\u79cd\u662f\u76f4\u63a5\u5316\u7b80\uff0c\u5206\u6cbb\u591a\u9879\u5f0f\u4e58\u6cd5\u6c42\u89e3 \uff1a\n\n$$F(x) = x \\prod _ i (1 - x ^ i) ^ {-f_i}$$\n\n\u8003\u8651\u5bf9\u4e24\u8fb9\u53d6 $\\ln$\uff0c\u5c06\u8fde\u4e58\u8f6c\u8fde\u52a0 \uff1a\n\n$$\\ln F(x) = \\ln x - \\sum _ i f_i \\ln (1 - x ^ i)$$\n\n\u5bf9\u6570\u4e0d\u597d\u5904\u7406\uff0c\u8003\u8651\u6c42\u5bfc \uff1a\n\n$$\\frac{F'(x)}{F(x)} = \\frac{1}{x} + \\sum _ i if_i \\times \\frac{x ^ {i - 1}}{1 - x ^ i}$$\n\n\u5c06\u4e24\u8fb9\u540c\u65f6\u4e58\u4ee5 $xF(x)$ \uff1a\n\n$$xF'(x) = F(x) + F(x) \\sum _ i if_i \\frac{x ^ i}{1 - x ^ i}$$\n\n\u8003\u8651\u5c06\u53f3\u534a\u90e8\u5206\u8fd8\u539f\u6210 $F(x)$ \u8868\u793a \uff1a\n\n$$xF'(x) = F(x) + F(x)\\left(\\sum _ {i \\geqslant 1} x ^ i F'(x ^ i)\\right)$$\n\n\u8bbe $G(x) = \\sum _ k x ^ k F'(x ^ k)$\uff0c\u7b80\u5355\u63a8\u4e00\u63a8 \uff1a\n\n$$G(x) = \\sum _ k x ^ k \\sum _ {i\\geqslant 1} if _ i \\left(x ^ {k}\\right) ^ {i - 1} = \\sum _ k \\sum _ i i f _ i x ^ {ik} = \\sum _ n x ^ n \\sum _ {d | n} d f _ d$$\n\n\u6545 $g_n = \\sum _ {d | n} df_d,g_1 = f_1 = 1.$\n\n\u56e0\u6b64 \uff1a\n\n$$f_n = \\frac{1}{n - 1} \\sum _ {k = 1} ^ {n - 1} f _ k g _ {n - k}$$\n\n$f$ \u4f7f\u7528\u5206\u6cbb\u591a\u9879\u5f0f\u4e58\u6cd5\u6c42\u89e3\uff0c$g$ \u66b4\u529b\u6c42\u89e3\u5373\u53ef\u505a\u5230 $\\Theta(n \\log ^ 2 n).$\n\n\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u4f7f\u7528\u725b\u987f\u8fed\u4ee3 \uff1a\n\n\u663e\u7136\u6211\u4eec\u8981\u6c42\u89e3\u65b9\u7a0b $G \\circ F(x) = F(x) - x \\cdot \\varepsilon \\circ F(x) = 0$.\n\n\u5047\u8bbe\u5f53\u524d\u5df2\u7ecf\u6c42\u51fa\u4e86\u65b9\u7a0b\u5728\u6a21 $x ^ n$ \u610f\u4e49\u4e0b\u7684\u89e3 $F_0(x)$\uff0c\u8bbe\u65b9\u7a0b\u5728\u6a21 $x ^ {2n}$ \u610f\u4e49\u4e0b\u7684\u89e3\u4e3a $F(x)$\uff0c\u4f17\u6240\u5468\u77e5\u6709 \uff1a\n\n$$F(x) = F_0(x) - \\frac{G \\circ F_0(x)}{G' \\circ F_0(x)}$$\n\n\u9996\u5148\u8003\u8651\u5316\u7b80 $G'(F)$ \uff1a\n\n$$\\begin{aligned}\n    G'(F) &= [F - x \\cdot \\varepsilon (F)]'\\\\\n    &= F' - \\varepsilon (F) - x \\varepsilon'(F)\\\\\n    &= F' - \\varepsilon (F) - x \\varepsilon (F) \\ln ' \\varepsilon (F)\\\\\n\\end{aligned}$$\n\n\u6211\u4eec\u77e5\u9053\uff0c$\\varepsilon \\circ F(x)$ \u548c $\\ln \\varepsilon \\circ F(x)$ \u90fd\u53ef\u4ee5\u5728 $\\Theta(n \\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u6c42\u51fa\uff0c$F'(x)$ \u53ef\u4ee5 $\\Theta(n)$ \u6c42\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728 $\\Theta(n \\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u6c42\u4e0b\u5f0f \uff1a\n\n$$F(x) = F_0(x) - \\frac{F_0(x)  - x \\cdot \\varepsilon \\circ F_0(x)}{F_0'(x) - \\varepsilon \\circ F_0(x) - x\\cdot \\varepsilon \\circ F_0(x) \\cdot \\ln' \\varepsilon \\circ F_0(x)}$$\n\n\u7528\u4e0a\u5f0f\u8fed\u4ee3\u5373\u53ef\u7b97\u51fa $F(x)$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n \\log n).$\n\n\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u6c42\u51fa\u4e86\u65e0\u6807\u53f7\u6709\u6839\u6811\u7684\u65b9\u6848\u6570\uff0c\u8003\u8651\u5c06\u65e0\u6807\u53f7\u65e0\u6839\u6811\u7684\u65b9\u6848\u6570\u5bb9\u65a5\u51fa\u6765\u3002\n\n\u8003\u8651\u94a6\u70b9\u65e0\u6807\u53f7\u65e0\u6839\u6811\u7684\u6839\u662f\u5b83\u7684\u91cd\u5fc3\uff0c\u4e8e\u662f\u53ea\u9700\u8981\u53bb\u6389\u6839\u4e0d\u662f\u91cd\u5fc3\u7684\u65e0\u6807\u53f7\u6709\u6839\u6811\u7684\u65b9\u6848\u6570\u53ef\u4ee5\u4e86\uff0c\u5206\u7c7b\u8ba8\u8bba \uff1a\n\n\u5982\u679c\u91cd\u5fc3\u552f\u4e00\uff0c\u90a3\u4e48\u4e00\u5b9a\u5b58\u5728\u4e00\u9897\u5b50\u6811\u7684\u5927\u5c0f\u5927\u4e8e $\\left\\lfloor\\frac{n}{2}\\right\\rfloor$\uff0c\u8003\u8651\u679a\u4e3e\u5b83\u7684\u5927\u5c0f $i$\uff0c\u5bb9\u6613\u53d1\u73b0\u8fd9\u9897\u5b50\u6811\u7684\u65b9\u6848\u6570\u548c\u5c06\u5b83\u5207\u9664\u540e\u6811\u7684\u65b9\u6848\u6570\u90fd\u662f\u65e0\u6807\u53f7\u6709\u6839\u6811\u8ba1\u6570\u95ee\u9898\uff0c\u5176\u7b54\u6848\u6211\u4eec\u5df2\u7ecf\u7b97\u51fa\uff0c\u4e8e\u662f\u603b\u65b9\u6848\u6570\u9700\u8981\u51cf\u53bb $\\sum _ {i = \\left\\lfloor\\frac{n}{2}\\right\\rfloor + 1} ^{n - 1} f_i \\times f_{n - i}.$\n\n\u5982\u679c\u91cd\u5fc3\u4e0d\u552f\u4e00\uff0c\u90a3\u4e48\u4e00\u68f5\u6811\u8fd8\u4f1a\u5728\u4e24\u4e2a\u91cd\u5fc3\u4e0a\u5206\u522b\u88ab\u8ba1\u7b97\uff0c\u8fd9\u79cd\u65b9\u6848\u53ea\u4f1a\u5728 $n$ \u4e3a\u5076\u6570\u7684\u60c5\u51b5\u4e0b\u51fa\u73b0\u3002\u8003\u8651\u5230\u8fd9\u4e24\u4e2a\u91cd\u5fc3\u4e00\u5b9a\u76f8\u8fde\uff0c\u4e8e\u662f\u5c06\u5b83\u4eec\u4e4b\u95f4\u7684\u8fde\u8fb9\u65ad\u5f00\u540e\u5f62\u6210\u7684\u4e24\u4e2a\u5b50\u6811\u7684\u65b9\u6848\u6570\u662f\u72ec\u7acb\u7684\u3002\u4f46\u662f\u6211\u4eec\u53d1\u73b0\uff0c\u5f53\u4e24\u9897\u5b50\u6811\u5b8c\u5168\u76f8\u540c\u65f6\uff0c\u5206\u522b\u4ee5\u5b83\u7684\u4e24\u4e2a\u91cd\u5fc3\u4e3a\u6839\u65f6\u5f62\u6210\u7684\u6709\u6839\u6811\u662f\u540c\u6784\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u662f\u53ea\u4f1a\u5c06\u5b83\u8ba1\u7b97\u4e00\u6b21\uff0c\u6545\u7b97\u91cd\u7684\u65b9\u6848\u4e2d\u4e0d\u5305\u62ec\u4e24\u9897\u5b50\u6811\u76f8\u540c\u7684\u60c5\u51b5\uff0c\u4e8e\u662f\u603b\u65b9\u6848\u6570\u8fd8\u9700\u8981\u51cf\u53bb $\\binom{f_{\\frac{n}{2}}}{2}.$\n\n\u7efc\u4e0a\uff0c\u95ee\u9898\u5f97\u5230\u89e3\u51b3\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(n \\log ^ 2 n)$ \u6216 $\\Theta(n \\log n).$",
        "postTime": 1642688260,
        "uid": 78645,
        "name": "C\u3000C\u3000A",
        "ccfLevel": 6,
        "title": "\u65e0\u6807\u53f7\u65e0\u6839\u6811\u8ba1\u6570"
    },
    {
        "content": "## \u9898\u76ee\u7b80\u8ff0\n\n\u65e0\u6807\u53f7\u65e0\u6839\u6811\u8ba1\u6570\u3002$n\\leq2\\times10^5$\u3002\n\n## \u89e3\u9898\u601d\u8def\n\n### charp1. \u7ea6\u5b9a\u4e0e\u9884\u5907\u77e5\u8bc6\n\n- \u6ca1\u6709\u7279\u6b8a\u8bf4\u660e\uff0c\u5bf9\u4e8e\u591a\u9879\u5f0f $F$\uff0c\u8bb0 $F$ \u4e2d $x^i$ \u7684\u7cfb\u6570\u4e3a $f_i$\uff0c$g,h$ \u540c\u7406\u3002\u4e0b\u6587\u4e2d\u53ef\u80fd\u5355\u72ec\u51fa\u73b0 $F^t$ \u7b49\u7c7b\u4f3c\u60c5\u51b5\uff0c\u5747\u8bd5\u505a $F^t(x)$\u3002\n\n- \u5982\u679c\u4e0b\u6587\u5f53\u4e2d\u6709\u660e\u786e\u6307\u51fa\u300c\u6307\u6570\u751f\u6210\u51fd\u6570\uff08EGF\uff09\u300d\uff0c\u90a3\u4e48 $F=\\sum \\dfrac{f_i}{i!} x^i$\uff0c$G,H$ \u540c\u7406\u3002\n\n- \u9884\u5907\u77e5\u8bc6\uff1a**\u6307\u6570\u751f\u6210\u51fd\u6570** $F$ \u7684 $\\exp$ \u5f62\u5f0f\u7684\u7ec4\u5408\u610f\u4e49\u4e3a\u300c$n$ \u5143**\u6709\u6807\u53f7**\u5143\u7d20\u5206\u7ec4\uff0c\u5927\u5c0f\u4e3a $i$ \u7684\u7ec4\u5185\u90e8\u6709 $f_i$ \u7684\u60c5\u51b5\u7684\u65b9\u6848\u6570\u300d\u3002\u611f\u6027\u8bc1\u660e\uff1a\n\n- $$\n  \\exp F=\\sum \\dfrac{F^i}{i!}\n  $$\n\n- \u5c55\u5f00\u4e0a\u9762\u7684\u5f0f\u5b50\uff0c\u89c2\u5bdf\u6bcf\u4e00\u9879\u4e0d\u96be\u8bc1\u660e\u3002\n\n### charp 2. Euler \u53d8\u6362\n\n\u4e0a\u9762\u6211\u4eec\u7684\u5f0f\u5b50\u662f**\u6709\u6807\u53f7**\u8ba1\u6570\uff0c\u5bf9\u4e8e\u65e0\u6807\u53f7\u8ba1\u6570\u53ef\u4ee5\u8003\u8651\u5148\u6b27\u62c9\u53d8\u6362\u3002\u6211\u4eec\u53ea\u5173\u6ce8\u6bcf\u4e00\u4e2a\u5927\u5c0f\u76f8\u540c\u7684\u7ec4\u5185\u90e8\u7684\u603b\u4f53\u5206\u914d\u60c5\u51b5\uff0c\u800c\u4e0d\u662f\u5355\u4e2a\u7ec4\u3002\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u679a\u4e3e\u6bcf\u79cd\u65b9\u6848\u9009\u62e9\u7684\u6b21\u6570\uff0c\u4e0d\u96be\u5f97\u5230\u8fd9\u6837\u7684\u751f\u6210\u51fd\u6570\uff1a\n$$\n\\xi(F)=\\prod_{i=1}^{+\\infty} (\\dfrac{1}{1-x^i})^{f_i}\n$$\n\u53d1\u73b0\u8fd9\u65f6\u5019\u539f\u6765\u5728\u7cfb\u6570\u7684 $f$ \u53d8\u6362\u5230\u4e86\u6307\u6570\u4e0a\u53bb\uff0c\u611f\u89c9\u4e0d\u592a\u597d\u7528\u7684\u6837\u5b50\u3002\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5316\u7b80\u4e00\u4e0b\uff0c\u5bf9 $\\xi(F)$ \u4f7f\u7528 $\\ln$ \u628a $f_i$ \u53d8\u56de\u7cfb\u6570\uff1a\n$$\n\\begin{aligned} \\ln \\xi(F)&=\\sum_{i=1}^{+\\infty}(-f_i\\times \\ln(1-x^i))\\\\&=\\sum_{i=1}^{+\\infty}-f_i\\times\u222b\\dfrac{-ix^{i-1}}{1-x^i}\\\\&=\\sum_{i=1}^{+\\infty}-f_i\\times\u222b-ix^{i-1}(1+x^i+x^{2i}+\\dots)\\\\&=\\sum_{i=1}^{+\\infty} f_i\\times \\sum_{j=1}^{+\\infty}\\dfrac1jx^{ij}\\\\&=\\sum_{j=1}^{+\\infty}\\dfrac{F(x^j)}{j} \\end{aligned}\n$$\n\u597d\u770b\u4e86\u4e0d\u5c11\u3002\n\n### charp 3. \u65e0\u6807\u53f7\u6709\u6839\u6811\u8ba1\u6570\n\n\u5047\u8bbe\u65e0\u6807\u53f7\u6709\u6839\u6811\u7684\u751f\u6210\u51fd\u6570\u4e3a $F$\u3002\u5219 $F=x\u00b7\\xi(F)$\u3002\u8fd9\u91cc\u7684\u542b\u4e49\u662f\u5f53\u6211\u4eec\u786e\u5b9a\u4e00\u4e2a\u70b9\u4f5c\u4e3a\u6839\u7684\u65f6\u5019\n\n\uff0c\u90a3\u4e48\u76f8\u5f53\u4e8e\u7ed9\u5176\u4ed6\u5143\u7d20\u5206\u7ec4\uff0c\u5927\u5c0f\u4e3a $i$ \u7684\u7ec4\u5185\u90e8\u6709 $f_i$ \u7684\u60c5\u51b5\u3002\u6211\u4eec\u8003\u8651\u89e3\u8fd9\u4e2a\u65b9\u7a0b\uff0c\u9996\u5148\u5bf9\u4e24\u8fb9\u6c42\u5bfc\uff1a\n$$\n\\begin{aligned}F'&=x\\xi'(F)+\\xi(F)\\\\&=x\u00b7\\exp'(\\sum_{j=1}^{+\\infty} \\dfrac{F(x^j)}{j})+\\dfrac{F}{x}\\\\&=x\u00b7(\\sum_{j=1}^{+\\infty}\\dfrac{F(x^j)}{j})'\u00b7\\exp(\\ln \\xi(F))+\\dfrac{F}{x}\\\\&=F\\times(\\sum_{j=1}^{+\\infty}F'(x^j)x^{j-1})+\\dfrac Fx\\end{aligned}\n$$\n\u4e24\u8fb9\u540c\u65f6\u4e58\u4e0a $x$ \u4f1a\u597d\u770b\u4e00\u4e9b\uff0c\u53d8\u6210\uff1a\n$$\n\u03d1F=F\\times(\\sum_{j=1}^{+\\infty}F'(x^j)x^j)+F\n$$\n\u5047\u8bbe $G=\\sum_{j=1}^{+\\infty}F'(x^k)\u00b7x^k$\uff0c\u4e0d\u96be\u5f97\u5230 $g_n=\\sum_{d|n} d\\times f_n$\uff0c\u7531\u4e0a\u5f0f\n$$\nn\\times f_n=\\sum_{i=1}^{n-1} f_ig_{n-i}+f_n\n$$\n\u5373\uff1a\n$$\nf_n=\\dfrac{1}{n-1}\\sum_{i=1}^{n-1} f_ig_{n-i}\n$$\n\u4f7f\u7528\u534a\u5728\u7ebf\u5377\u79ef\u6c42\u89e3\u5373\u53ef\u3002\n\n### charp 4. \u5b9e\u73b0\u7ec6\u8282\n\n\u6709\u4e9b\u540c\u5b66\u53ef\u80fd\u4e0d\u4f1a\u534a\u5728\u7ebf\u5377\u79ef\uff0c\u8fd9\u91cc\u7b80\u8981\u63d0\u4e00\u5634\u3002\u9996\u5148\u6839\u636e [P4721 \u3010\u6a21\u677f\u3011\u5206\u6cbb FFT](https://www.luogu.com.cn/problem/P4721) \u7684\u57fa\u672c\u601d\u8def\uff0c\u6211\u4eec\u53ef\u4ee5 cdq \u5206\u6cbb\uff0c\u8fd9\u91cc $g$ \u662f\u56fa\u5b9a\u7684\uff0c\u6240\u4ee5\u5bf9\u4e8e\u533a\u95f4 $f[l,mid]$ \u5230 $f[mid+1,r]$ \u7684\u8d21\u732e\u53ea\u8981\u5377\u4e0a $g[0,r-l]$ \u5373\u53ef\u3002\u4f46\u662f\u672c\u9898\u5f53\u4e2d\u6709\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u53ef\u80fd $f[mid+1,r]$ \u4f1a\u5f71\u54cd\u5230 $g[0,r-l]$\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u53ea\u8981\u8003\u8651 $mid+1\\leq r-l$ \u5f53\u4e14\u4ec5\u5f53 $l=1$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a $l=1$ \u6211\u4eec\u53ea\u80fd\u5377 $f[l,mid],g[l,mid]$ \u5176\u4ed6\u6211\u4eec\u540e\u9762\u8865\u56de\u6765\uff0c\u5373\u5f53 $l\\not=1$ \u65f6\uff0c\u5377\u4e0a $f[l,mid],g[0,r-l]$ \u548c $g[l,mid],f[0,r-l]$ \u5373\u53ef\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define MP make_pair\n#define vll vector<long long>\nconst int MAXN=4e5+5;\nconst int MOD=998244353;\nnamespace polynomial{// yjl poly plank 2.0 ver?\nint bfly[MAXN];ll inver[MAXN];\nint clogg(int x){return (int)ceil(log2(x));} \nll ksm(ll a,int b){ll res=1;while(b){if(b&1)res=res*a%MOD;a=a*a%MOD,b>>=1;}return res;}\nvoid butterfly(int l){\n\tstatic int las;\n\tif(las!=l){\n\t\tlas=l; \n\t\tfor(int i=1;i<(1<<l);i++)\n\t\t\tbfly[i]=(bfly[i>>1]>>1)|((i&1)<<l-1);\n\t} \n}\nvoid NTT(vll &f,int l,int typ){\n\tbutterfly(l);f.resize(1<<l);\n\tfor(int i=0;i<(1<<l);i++)\n\t\tif(bfly[i]<i) swap(f[i],f[bfly[i]]);\n\tfor(int i=0;i<l;i++){\n\t\tll step=ksm(3,MOD-1+(MOD-1>>i+1)*typ);\n\t\tfor(int j=0;j<(1<<l);j+=(1<<i+1)){\n\t\t\tll cur=1;\n\t\t\tfor(int k=j;k<j+(1<<i);k++){\n\t\t\t\tll u=f[k],v=f[k+(1<<i)]*cur%MOD;\n\t\t\t\tf[k]=(u+v)%MOD;f[k+(1<<i)]=(u-v+MOD)%MOD;\n\t\t\t\tcur=cur*step%MOD;\n\t\t\t}\n\t\t}\n\t}\n\tif(typ==-1){\n\t\tll val=ksm(1<<l,MOD-2);\n\t\tfor(int i=0;i<(1<<l);i++)\n\t\t\tf[i]=val*f[i]%MOD;\n\t}\n\treturn;\n}\n}using namespace polynomial;\nint n;\nvll f,g;\nvoid solve(int l,int r){\n\tif(l==r){\n\t\tif(l!=1) f[l]=f[l]*ksm(l-1,MOD-2)%MOD;\n\t\tfor(int i=l;i<=n;i+=l)\n\t\t\tg[i]+=f[l]*l%MOD,g[i]%=MOD;\n\t\treturn;\n\t}\n\tint mid=l+r>>1;\n\tsolve(l,mid);\n\tif(l==1){\n\t\tvll _f=vll(begin(f)+l,begin(f)+mid+1),_g=vll(begin(g),begin(g)+mid+1);\n        int k=clogg(_f.size()+_g.size());\n\t\tNTT(_f,k,1);NTT(_g,k,1);\n\t\tfor(int i=0;i<(1<<k);i++) _f[i]=_f[i]*_g[i]%MOD;\n\t\tNTT(_f,k,-1);\n\t\tfor(int i=mid+1;i<=r;i++)\n\t\t\tf[i]+=_f[i-l],f[i]%=MOD;\n\t\tsolve(mid+1,r);\n\t\treturn;\n\t}\n\tvll _f=vll(begin(f)+l,begin(f)+mid+1),_g=vll(begin(g),begin(g)+r-l+1);\n\tint k=clogg(_f.size()+_g.size());\n\tNTT(_f,k,1);NTT(_g,k,1);\n\tfor(int i=0;i<(1<<k);i++) _f[i]=_f[i]*_g[i]%MOD;\n\tNTT(_f,k,-1);\n\tfor(int i=mid+1;i<=r;i++)\n\t\tf[i]+=_f[i-l],f[i]%=MOD;\n\t_f=vll(begin(f),begin(f)+r-l+1),_g=vll(begin(g)+l,begin(g)+mid+1);\n\tk=clogg(_f.size()+_g.size());\n\tNTT(_f,k,1);NTT(_g,k,1);\n\tfor(int i=0;i<(1<<k);i++) _f[i]=_f[i]*_g[i]%MOD;\n\tNTT(_f,k,-1);\n\tfor(int i=mid+1;i<=r;i++)\n\t\tf[i]+=_f[i-l],f[i]%=MOD;\n\tsolve(mid+1,r);\n\treturn;\n}\nint main(){\n\tios::sync_with_stdio(false);\n\tcin>>n;f.resize(n+1),g.resize(n+1);\n\tf[1]=1;\n\tsolve(1,n);\n\tll ans=f[n];\n\tfor(int i=1;i<=(n-1)/2;i++) ans-=f[i]*f[n-i]%MOD;\n\tif(n%2==0) ans-=f[n/2]*(f[n/2]-1)/2%MOD;\n\tcout<<(ans%MOD+MOD)%MOD;\n\treturn 0;\n}\n```\n\n",
        "postTime": 1681777819,
        "uid": 248400,
        "name": "Inaba_Meguru",
        "ccfLevel": 7,
        "title": "\u591a\u9879\u5f0f\u5165\u95e8\u9898"
    }
]