[
    {
        "content": "# \u5e7f\u544a\n\n### [\u849f\u84bb\u306eblog](http://www.cnblogs.com/dedicatus545/p/8831978.html)\n\n# \u6b63\u6587\n\n\u9996\u5148\u6211\u4eec\u660e\u786e\u4e00\u4e2a\u60f3\u6cd5\uff1a\u7b54\u6848\u7b49\u4e8e\u201c\u4f4d\u7f6e\u5bf9\u79f0\u7684\u56de\u6587\u5b50\u5e8f\u5217\u6570\u201d-\u201c\u56de\u6587\u5b50\u4e32\u6570\u201d\uff0c\u800c\u540e\u9762\u7684\u56de\u6587\u5b50\u4e32\u6570\u53ef\u4ee5\u901a\u8fc7$manacher$\u505a\u51fa\u6765\n\n\u6240\u4ee5\u6211\u4eec\u7684\u95ee\u9898\u8f6c\u5316\u4e3a\uff1a\u6c42\u201c\u4f4d\u7f6e\u5bf9\u79f0\u7684\u4f1a\u6587\u5b57\u5e8f\u5217\u4e2a\u6570\u201d\n\n\u6211\u4eec\u8003\u8651\u4ee5\u5b57\u7b26\u4e32$S$\u7684\u7b2c$i$\u4e2a\u5b57\u7b26$S_i$\u4f5c\u4e3a\u4e00\u4e2a\u5b50\u5e8f\u5217\u7684\u5bf9\u79f0\u4e2d\u5fc3\n\n\u90a3\u4e48\u5f53$S_{i-j}=S_{i+j}\\left(1\\leq j\\leq i-1\\right)$\u65f6\uff0c\u6211\u4eec\u7684\u7b54\u6848\u5c31\u52a0\u4e00\u79cd\u9009\u62e9\n\n\u5982\u679c\u5bf9\u4e8e$S_i$\uff0c\u6709$x$\u4e2a\u8fd9\u6837\u7684\u76f8\u7b49\u5b57\u7b26\u5bf9\uff0c\u90a3\u4e48\u6700\u7ec8\u4ee5\u7b2c$i$\u4e2a\u4f4d\u7f6e\u4e3a\u4e2d\u5fc3\u7684\u7b54\u6848\u5c31\u662f$2^{x+1}-1$\n\n\u4e3a\u4ec0\u4e48\u5462\uff1f\n\n\u56e0\u4e3a\u7b97\u4e0a\u5bf9\u79f0\u4e2d\u5fc3\u672c\u8eab\uff0c\u4e00\u5171\u6709$x+1$\u7ec4\u53ef\u4ee5\u9009\u6216\u8005\u4e0d\u9009\u7684\u5b57\u7b26\uff0c\u9664\u53bb\u5168\u90fd\u4e0d\u9009\u7684\u4e00\u79cd\u5c31\u662f\u7b54\u6848\n\n\u7136\u800c\u8fd9\u662fi\u4e3a\u67d0\u4e2a\u7279\u5b9a\u5b57\u7b26\u7684\u60c5\u51b5\uff0c\u6216\u8005\u8bf4i\u4e3a\u6574\u6570\u7684\u60c5\u51b5\uff0c\u4f46\u662fi\u8fd8\u6709\u5728\u4e24\u4e2a\u5b57\u7b26\u4e2d\u95f4\u7684\u60c5\u51b5\uff0c\u6b64\u65f6\u7b54\u6848\u5c31\u662f$2^x-1$\uff0c\u56e0\u4e3a\u6ca1\u6709\u4e2d\u95f4\u7684\u81ea\u5df1\u90a3\u4e2a\u5b57\u7b26\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u6bcf\u4e2a\u4f4d\u7f6e\u4e0a\u8fd9\u6837\u7684\u5b57\u7b26\u7ec4\u6570\u91cf\n\n\u6211\u4eec\u6784\u5efa\u4e24\u4e2a\u591a\u9879\u5f0f$A$\u4e0e$B$\uff0c\u4ee4$A$\u7684\u6240\u6709\u539f\u4e32\u4e2d\u4e3a'a'\u7684\u4f4d\u7f6e\u7cfb\u6570\u4e3a1\uff0c'b'\u7cfb\u6570\u4e3a\u96f6\uff0c$B$\u5219\u53cd\u8fc7\u6765\n\n\u7136\u540e\u7528$A$\u81ea\u4e58\uff0c\u5f97\u5230\u7684\u65b0\u591a\u9879\u5f0f\u7684\u7b2ci\u4f4d\u7684\u503c\uff0c\u5c31\u662f\u5bf9\u79f0\u4e2d\u5fc3\u4e3a\u7b2c$\\frac i2$\u7684\uff0c\u4e24\u4e2a\u5b57\u7b26\u90fd\u662f'a'\u7684\u5b57\u7b26\u7ec4\u6570\uff0c$B$\u540c\u7406\n\n\u6700\u540e\u6211\u4eec\u628a$A$\u548c$B$\u7684\u6bcf\u4e00\u4f4d\u7cfb\u6570\u52a0\u8d77\u6765\uff0c\u51cf\u53bb((i&1)^1)\uff08\u4ee3\u8868\u5bf9\u79f0\u4e2d\u5fc3\u662f\u5426\u5728\u67d0\u4e2a\u5b57\u7b26\u4e0a\uff09\uff0c\u6c422\u7684\u6b21\u5e42\u518d\u51cf\u53bb1\uff0c\u6700\u540e\u51cf\u53bbmanacher\u6c42\u51fa\u7684\u56de\u6587\u5b50\u4e32\u6570\u76ee\u5c31\u53ef\u4ee5\u4e86\n\nCode\uff1a\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#define ll long long\nusing namespace std;\nconst ll MOD=1e9+7;\nstruct complex{\n    double x,y;\n    complex(double xx=0,double yy=0){x=xx;y=yy;}\n    complex operator +(const complex &b){return complex(x+b.x,y+b.y);}\n    complex operator -(const complex &b){return complex(x-b.x,y-b.y);}\n    complex operator *(const complex &b){return complex(x*b.x-y*b.y,x*b.y+y*b.x);}\n}A[400010],B[400010];\nconst double pi=acos(-1.0);\nll n,m,limit=1,cnt=0,r[400010];\nvoid fft(complex *a,double type){\n    ll i,j,k,mid;complex x,y,w,wn;\n    for(i=0;i<limit;i++) if(i<r[i]) swap(a[i],a[r[i]]);\n    for(mid=1;mid<limit;mid<<=1){\n        wn=complex(cos(pi/mid),type*sin(pi/mid));\n        for(j=0;j<limit;j+=(mid<<1)){\n            w=complex(1,0);\n            for(k=0;k<mid;k++,w=w*wn){\n                x=a[j+k];y=w*a[j+k+mid];\n                a[j+k]=x+y;a[j+k+mid]=x-y;\n            }\n        }\n    }\n}\nll s[100010],ans[200010],x[200010],p[200010],sum;char ss[100010];\nvoid manacher(){\n    ll maxn=-1,id,mx=0,i;\n    for(i=1;i<=(n<<1)+1;i++){\n        if(i<mx) p[i]=min(p[2*id-i],mx-i);\n        else p[i]=1;\n        while(x[i-p[i]]==x[i+p[i]]) p[i]++;\n        if(mx<i+p[i]){\n            mx=p[i]+i;id=i;\n        }\n    }\n}\nll qpow(ll x,ll y){\n    ll re=1;\n    while(y){\n        if(y&1) re=re*x%MOD;\n        x=x*x%MOD;y>>=1;\n    }\n    return re;\n}\nint main(){\n    ll i;\n    scanf(\"%s\",ss);n=strlen(ss);\n    for(i=0;i<n;i++) s[i+1]=(ss[i]=='a');\n    for(i=1;i<=(n<<1)+1;i++){\n        if(i%2) x[i]=2;\n        else x[i]=s[i>>1];\n    }x[0]=-1,x[(n+1)<<1]=-2;\n    \n    while(limit<=(n<<1)) limit<<=1,cnt++;\n    for(i=0;i<limit;i++) r[i]=((r[i>>1]>>1)|((i&1)<<(cnt-1)));\n    \n    for(i=1;i<=n;i++) A[i].x=B[i].x=s[i];\n    fft(A,1);fft(B,1);\n    for(i=0;i<=limit;i++) A[i]=A[i]*B[i];\n    fft(A,-1);\n    for(i=1;i<=(n<<1)+1;i++) ans[i]+=((ll)(A[i].x/limit+0.5)-((i&1)^1));\n    \n    memset(A,0,sizeof(A));memset(B,0,sizeof(B));\n    for(i=1;i<=n;i++) A[i].x=B[i].x=(s[i]^1);\n    fft(A,1);fft(B,1);\n    for(i=0;i<=limit;i++) A[i]=A[i]*B[i];\n    fft(A,-1);\n    for(i=1;i<=(n<<1)+1;i++) ans[i]+=((ll)(A[i].x/limit+0.5)-((i&1)^1));\n    for(i=1;i<=(n<<1)+1;i++) ans[i]=((ans[i]+((i&1)^1))>>1)+((i&1)^1);\n    \n    for(i=1;i<=(n<<1)+1;i++) ans[i]=qpow(2,ans[i])-1,ans[i]%=MOD;\n    \n    manacher();\n    \n    for(i=1;i<=(n<<1)+1;i++) ans[i]-=(p[i]>>1),ans[i]%=MOD;\n    for(i=1;i<=(n<<1)+1;i++) sum+=ans[i],sum%=MOD;\n    printf(\"%lld\",sum);\n}\n```",
        "postTime": 1523689467,
        "uid": 27753,
        "name": "Orion545",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4199 \u3010\u4e07\u5f84\u4eba\u8e2a\u706d\u3011"
    },
    {
        "content": "$\\textbf{FFT}$ + $\\textbf{Manacher}$.  \n\u770b\u9898\u76ee\u53d1\u73b0\u76f4\u63a5\u6c42\u9898\u76ee\u8981\u6c42\u7684 **\u4f4d\u7f6e\u5173\u4e8e\u67d0\u6839\u8f74\u5bf9\u79f0\u7684\u4e0d\u8fde\u7eed\u56de\u6587\u5b50\u5e8f\u5217** \u5e76\u4e0d\u597d\u6c42\uff0c\u8003\u8651\u5148\u6c42\u51fa **\u4f4d\u7f6e\u5173\u4e8e\u67d0\u6839\u8f74\u5bf9\u79f0\u7684\u56de\u6587\u5b50\u5e8f\u5217**\uff0c\u7136\u540e\u518d\u51cf\u53bb **\u56de\u6587\u4e32** \u7684\u6570\u91cf\u5373\u9898\u76ee\u8981\u6c42\u7684\u7b54\u6848\u3002**\u56de\u6587\u4e32** \u53ef\u4ee5\u7528 $\\textbf{Manacher}$ \u8f7b\u677e\u6c42\u51fa\uff0c\u95ee\u9898\u5c31\u53ef\u4ee5\u8f6c\u6362\u4e3a **\u4f4d\u7f6e\u5173\u4e8e\u67d0\u6839\u8f74\u5bf9\u79f0\u7684\u56de\u6587\u5b50\u5e8f\u5217** \u600e\u4e48\u6c42\u3002  \n\u5bf9\u6bcf\u4e2a\u4f4d\u7f6e\u8fdb\u884c\u8003\u8651\uff0c\u4ee4\n$$f_i=\\sum_{j=0}^i[s_j=s_{i\\times 2-j}]$$\n\u90a3\u4e48\u7531\u4e8c\u9879\u5f0f\u5b9a\u7406\u53ef\u4ee5\u77e5\u9053\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u7684\u7b54\u6848\u662f $2^{f_i}-1$\uff0c\u4f46 $f_i$ \u8981\u600e\u4e48\u6c42\u5462\uff1f\u8003\u8651\u4e00\u4e2a\u6027\u8d28\uff0c\u5373 $1\\times 1=1$\uff0c$1\\times 0=0\\times 1=0\\times 0=0$\uff0c\u7531\u4e8e\u5b57\u7b26\u4e32\u4e2d\u53ea\u6709 `a,b`\uff0c\u53ef\u4ee5\u4ee4 $g_i=[s_i=$ `a` $]$\uff0c$h_i=[s_i=$ `b` $]$\uff0c\u5219\u4e0a\u5f0f\u53ef\u4ee5\u8f6c\u5316\u6210\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u5373\uff1a\n$$f=g* g+h* h$$\n\u7136\u540e\u5c31\u53ef\u4ee5\u8f7b\u677e\u89e3\u51b3\u4e86\u3002\n```cpp\n#include<bits/stdc++.h>\n#define MAXN 400005\n#define reg register\n#define inl inline\n#define int long long\n#define db double\nusing namespace std;\nconst int Mod=1e9+7,Gi=3;\nconst db Pi=acos(-1.0);\nint n,lim=1,m,rev[MAXN],h[MAXN],s[MAXN],pos[MAXN],ans;\nchar ch[MAXN];\nstruct Complex\n{\n\tdb x,y;\n\tfriend Complex operator + (const Complex &a,const Complex &b)\n\t{\n\t\treturn ((Complex){a.x+b.x,a.y+b.y});\n\t}\n\tfriend Complex operator - (const Complex &a,const Complex &b)\n\t{\n\t\treturn ((Complex){a.x-b.x,a.y-b.y});\n\t}\n\tfriend Complex operator * (const Complex &a,const Complex &b)\n\t{\n\t\treturn ((Complex){a.x*b.x-a.y*b.y,a.x*b.y+a.y*b.x});\n\t}\n}f[MAXN],g[MAXN];\ninl int Pow(reg int x,reg int y)\n{\n\treg int res=1;\n\tfor(;y;y>>=1,x=x*x%Mod) if(y&1) res=res*x%Mod;\n\treturn res;\n}\ninl void FFT(reg Complex *A,reg int opt)\n{\n\tfor(reg int i=0;i<lim;i++) if(i<rev[i]) swap(A[i],A[rev[i]]);\n\tfor(reg int mid=1;mid<lim;mid<<=1)\n\t{\n\t\treg Complex Wn=((Complex){cos(Pi/(db)mid),(db)opt*sin(Pi/(db)mid)});\n\t\tfor(reg int j=0;j<lim;j+=(mid<<1))\n\t\t{\n\t\t\treg Complex W=((Complex){1,0});\n\t\t\tfor(reg int k=0;k<mid;k++,W=W*Wn)\n\t\t\t{\n\t\t\t\treg Complex x=A[j+k],y=W*A[j+k+mid];\n\t\t\t\tA[j+k]=x+y;\n\t\t\t\tA[j+k+mid]=x-y;\n\t\t\t}\n\t\t}\n\t}\n\tif(opt==1) return;\n\tfor(reg int i=0;i<lim;i++) A[i].x=(int)(A[i].x/(db)lim+0.5);\n}\ninl int Manacher()\n{\n\treg int tot=0,pre=0,maxn=0,res=0;\n\ts[tot]='#';\n\tfor(reg int i=0;i<n;i++)\n\t{\n\t\ts[++tot]=ch[i];\n\t\ts[++tot]='#';\n\t}\n\tfor(reg int i=0;i<tot;i++)\n\t{\n\t\treg int j=pre*2-i;\n\t\tif(i<maxn)\n\t\t{\n\t\t\tif(maxn-i>pos[j]) pos[i]=pos[j];\n\t\t\telse pos[i]=maxn-i;\n\t\t}\n\t\telse pos[i]=1;\n\t\twhile(s[i+pos[i]]==s[i-pos[i]] && i>=pos[i]) pos[i]++;\n\t\tif(i+pos[i]>maxn)\n\t\t{\n\t\t\tmaxn=i+pos[i];\n\t\t\tpre=i;\n\t\t}\n\t}\n\tfor(reg int i=0;i<tot;i++) res=(res+(pos[i]>>1))%Mod;\n\treturn res;\n}\nsigned main()\n{\n\tscanf(\"%s\",ch);\n\tn=strlen(ch);\n\twhile(lim<=((n+1)<<1))\n\t{\n\t\tlim<<=1;\n\t\tm++;\n\t}\n\tfor(reg int i=0;i<=lim;i++) rev[i]=((rev[i>>1]>>1)|((i&1)<<(m-1)));\n\tfor(reg int i=0;i<n;i++) if(ch[i]=='a') f[i].x=g[i].x=1.0;\n\tFFT(f,1); FFT(g,1);\n\tfor(reg int i=0;i<lim;i++) f[i]=f[i]*g[i];\n\tFFT(f,-1);\n\tfor(reg int i=0;i<lim;i++) h[i]=(h[i]+(int)f[i].x)%Mod;\n\tmemset(f,0,sizeof(f));\n\tmemset(g,0,sizeof(g));\n\tfor(reg int i=0;i<n;i++) if(ch[i]=='b') f[i].x=g[i].x=1.0;\n\tFFT(f,1); FFT(g,1);\n\tfor(reg int i=0;i<lim;i++) f[i]=f[i]*g[i];\n\tFFT(f,-1);\n\tfor(reg int i=0;i<lim;i++) h[i]=(h[i]+(int)f[i].x)%Mod;\n\tfor(reg int i=0;i<lim;i++) ans=(ans+Pow(2,(h[i]+1)>>1)-1)%Mod;\n\tans=(ans-Manacher()+Mod)%Mod;\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1575448869,
        "uid": 23243,
        "name": "VenusM1nT",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4199 \u3010\u4e07\u5f84\u4eba\u8e2a\u706d\u3011"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/xixike/p/15631268.html)\n\n## Description\n\n> [Luogu\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P4199)\n\n## Solution\n\n~~\u597d\u540d\u5b57\u3002~~\n\n~~\u50cf\u6211\u8fd9\u79cd\u61d2\u72d7\u80af\u5b9a\u662f\u76f4\u63a5\u770b\u7b80\u5316\u7248\u9898\u610f\u554a\uff01~~\n\n\u9898\u610f\u8ba9\u6211\u4eec\u6c42**\u4e0d\u8fde\u7eed**\u7684\u56de\u6587\u5b50\u5e8f\u5217\u4e2a\u6570\uff0c\u6211\u4eec\u53d1\u73b0\u5e76\u4e0d\u662f\u5f88\u597d\u6c42\uff0c\u6240\u4ee5\u8f6c\u6362\u4e00\u4e0b\u601d\u8def\uff0c\u6c42\uff1a\n$$\n\u56de\u6587\u5b50\u5e8f\u5217\u4e2a\u6570\uff08\u53ef\u8fde\u7eed\uff09- \u56de\u6587\u5b50\u4e32\u4e2a\u6570\n$$\n\u56de\u6587\u5b50\u4e32\u4e2a\u6570\u5f88\u5bb9\u6613\u6c42\u51fa\u6765\uff0c\u5c31\u662f $manacher$ \u677f\u5b50\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u8003\u8651\u5982\u4f55\u6c42\u51fa\u56de\u6587\u5b50\u5e8f\u5217\u4e2a\u6570\u3002\n\n\u8bbe\u70b9 $id$ \u4e3a\u4e00\u4e2a\u5b50\u5e8f\u5217\u7684\u5bf9\u79f0\u4e2d\u5fc3\uff0c\u82e5 $S_{i - j} = S_{i + j}$ \uff0c\u6211\u4eec\u7684\u7b54\u6848\u5c31\u4f1a\u591a\u4e00\u79cd\u9009\u62e9\uff0c\u5047\u8bbe\u5bf9\u4e8e\u5bf9\u79f0\u4e2d\u5fc3 $i$ \u6709 $f_i = x$ \u79cd\u9009\u62e9\uff0c\u90a3\u4e48\uff1a\n\n1. $i$ \u662f\u4e00\u4e2a\u5b57\u7b26\uff0c\u7b54\u6848\u5c31\u662f $2^{x + 1} - 1$\u3002\u5305\u62ec\u5bf9\u79f0\u4e2d\u5fc3 $i$ \u5728\u5185\u6709 $x + 1$ \u5bf9\u9009\u6216\u4e0d\u9009\u7684\u5b57\u7b26\uff0c\u6240\u4ee5\u4e00\u5171\u6709 $2^{x + 1}$ \u79cd\u60c5\u51b5\uff0c\u51cf\u53bb\u7a7a\u96c6\u7684 1 \u79cd\u60c5\u51b5\u5c31\u662f\u7b54\u6848\u3002\n2. $i$ \u5728\u4e24\u4e2a\u5b57\u7b26\u4e2d\u95f4\uff0c\u7b54\u6848\u5c31\u662f $2^x - 1$\uff0c\u5373\u4e0d\u80fd\u5305\u62ec\u5bf9\u79f0\u4e2d\u5fc3\u3002\n\n\u901a\u8fc7\u4e0a\u9762\u7684\u8ba8\u8bba\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u5bf9\u79f0\u4e2d\u5fc3\u5728\u4e24\u4e2a\u5b57\u7b26\u4e2d\u95f4\uff0c\u6240\u4ee5\u6211\u4eec\u6309\u7167 $manacher$ \u7684\u505a\u6cd5\u628a\u539f\u5b57\u7b26\u4e32\u7ffb\u500d\uff0c\u8fd9\u6837\u4e00\u6765\u8fd9\u4e2a\u4e2d\u5fc3\u5c31\u4e00\u5b9a\u662f\u6574\u70b9\u4e86\u3002\n\n\u90a3\u4e48\u8fd9\u4e2a $f_i$ \u5982\u4f55\u6c42\u5462\uff1f\n\n\u6784\u9020\u51fa\u751f\u6210\u51fd\u6570\uff1a\n$$\nF(x) = \\sum\\limits_{i = 0}^{|s| - 1}a_ix^i\n$$\n\u7136\u540e\u4ee4 $F(x)$ \u81ea\u5df1\u5377\u81ea\u5df1\uff0c\u5373 $F(x)^2$\uff0c \u8fd9\u4e00\u6b65\u7528 NTT \u6216 FFT \u90fd\u884c\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c$F(x)^2$ \u4e2d $x^i$ \u7684\u7cfb\u6570\u5c31\u662f\u5728\u539f\u5b57\u7b26\u4e32\u4e2d\u5173\u4e8e $\\frac{i}{2}$ \u5bf9\u79f0\u7684\u5b57\u7b26\u5bf9\u7684\u4e2a\u6570\u3002\n\n\u53c8\u89c2\u5bdf\u5230\u8f93\u5165\u7684\u5b57\u7b26\u4e32\u4e2d\u53ea\u6709  `a` \u548c `b` \uff0c\u800c\u4e14\u8fd9\u4e24\u4e2a\u5b57\u7b26\u4e4b\u95f4\u6ca1\u6709\u5173\u8054\uff0c\u6240\u4ee5\u5206\u5f00\u8003\u8651\uff1a\n\n1. \u5bf9\u4e8e `a`\uff0c\u82e5 $S_i = a$\uff0c\u90a3\u4e48 $A_i = 1$\uff0c\u53cd\u4e4b $A_i = 0$\u3002\n2. \u5bf9\u4e8e `b` \u540c\u7406\uff0c\u82e5 $S_i = b$\uff0c\u90a3\u4e48 $B_i = 1$\uff0c\u53cd\u4e4b $B_i = 0$\u3002\n\n\u5f97\u51fa $A$ \u548c $B$ \u4e4b\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba1\u7b97 $f_i$ \u5566\u3002\n\n$$\nf_i = A^2 + B^2\n$$\n\n\u6700\u540e\u7edf\u8ba1\u4e00\u4e0b\u7b54\u6848\u5c31\u5b8c\u5566\u3002\n\n## Code\n\n\u6211\u8fd9\u91cc\u7528\u7684 NTT \u505a\u7684\uff0c\u9700\u8981\u4e24\u4e2a\u6a21\u6570\uff0c\u6ce8\u610f\u5199\u7684\u65f6\u5019\u4e0d\u8981\u5f04\u6df7\u4e86 QwQ\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\n#define cl const ll\n\nusing namespace std;\n\nnamespace IO{\n    inline ll read(){\n        ll x = 0;\n        char ch = getchar();\n        while(!isdigit(ch)) ch = getchar();\n        while(isdigit(ch)) x = (x << 3) + (x << 1) + ch - '0', ch = getchar();\n        return x;\n    }\n\n    template <typename T> inline void write(T x){\n        if(x > 9) write(x / 10);\n        putchar(x % 10 + '0');\n    }\n}\nusing namespace IO;\n\nconst ll N = 3e5 + 10;\nconst ll mod = 998244353, Mod = 1e9 + 7;\nconst ll G = 3, Gi = 332748118;\nll n, m, ans1, ans2;\nll a[N], b[N], c[N], d[N], rev[N];\nint p[N];\nchar s[N], t[N];\n\nnamespace NTT{\n    ll lim, len;\n\n    inline ll qpow(ll a, ll b, ll mod){\n        ll res = 1;\n        while(b){\n            if(b & 1) res = res * a % mod;\n            a = a * a % mod, b >>= 1;\n        }\n        return res;\n    }\n\n    inline void get_rev(cl n){\n        lim = 1, len = 0;\n        while(lim < n) lim <<= 1, ++len;\n        for(int i = 0; i < lim; ++i) rev[i] = (rev[i >> 1] >> 1) | ((i & 1) << (len - 1));\n    }\n\n    inline void ntt(ll A[], cl lim, cl type){\n        for(int i = 0; i < lim; ++i)\n            if(i < rev[i]) swap(A[i], A[rev[i]]);\n        for(int mid = 1; mid < lim; mid <<= 1){\n            ll Wn = qpow(type == 1 ? G : Gi, (mod - 1) / (mid << 1), mod);\n            for(int i = 0; i < lim; i += (mid << 1)){\n                ll w = 1;\n                for(int j = 0; j < mid; ++j, w = w * Wn % mod){\n                    ll x = A[i + j], y = w * A[i + j + mid] % mod;\n                    A[i + j] = (x + y) % mod;\n                    A[i + j + mid] = (x - y + mod) % mod;\n                }\n            }\n        }\n        if(type == 1) return;\n        ll inv = qpow(lim, mod - 2, mod);\n        for(int i = 0; i < lim; ++i) A[i] = A[i] * inv % mod;\n    }\n\n    inline void Mul(cl n, cl m, ll a[], ll b[]){\n        get_rev(n + m);\n        ntt(a, lim, 1), ntt(b, lim, 1);\n        for(int i = 0; i < lim; ++i) a[i] = a[i] * b[i] % mod;\n        ntt(a, lim, -1);\n    }\n}\nusing namespace NTT;\n\ninline void manacher(){\n    n = strlen(t + 1);\n    s[0] = '#', s[(n << 1) + 1] = '*';\n    for(int i = 1; i <= n; ++i)\n        s[(i << 1) - 1] = '*', s[i << 1] = t[i];\n    m = (n << 1) + 1;\n    int mx = 0, id = 0;\n    for(int i = 1; i <= m; ++i){\n        if(i < mx) p[i] = min(mx - i, p[(id << 1) - i]);\n        else p[i] = 1;\n        while(i - p[i] >= 1 && i + p[i] <= m && s[i - p[i]] == s[i + p[i]]) ++p[i];\n        if(i + p[i] > mx) id = i, mx = i + p[i];\n    }\n    for(int i = 1; i <= (n << 1) + 1; ++i) ans1 = (ans1 + (p[i] >> 1)) % Mod;\n}\n\ninline void solve(){\n    for(int i = 1; i <= n; ++i){\n        if(t[i] == 'a') a[i - 1] = c[i - 1] = 1;\n        else b[i - 1] = d[i - 1] = 1;\n    }\n    Mul(n, n, a, c), Mul(n, n, b, d);\n    for(int i = 0; i <= (n << 1); ++i) c[i] = (a[i] + b[i]) % mod;\n    for(int i = 0; i <= (n << 1) - 2; ++i){\n        if(i & 1) ans2 = (ans2 + qpow(2, (c[i] >> 1), Mod) - 1 + Mod) % Mod;\n        else ans2 = (ans2 + qpow(2, (c[i] >> 1) + 1, Mod) - 1 + Mod) % Mod;\n    }\n    write((ans2 - ans1 + Mod) % Mod), puts(\"\");\n}\n\nint main(){\n    scanf(\"%s\", t + 1);\n    manacher();\n    solve();\n    return 0;\n}\n```\n\n$$\n\\_EOF\\_\n$$\n",
        "postTime": 1638372285,
        "uid": 158846,
        "name": "xixike",
        "ccfLevel": 0,
        "title": "P4199 \u4e07\u5f84\u4eba\u8e2a\u706d \u9898\u89e3"
    },
    {
        "content": "\u653e\u4e00\u4e2a\u53ef\u4ee5\u4f18\u5316\u5230\u53ea\u7528 $2$ \u6b21 FFT \u7684\u505a\u6cd5\u3002\n\n\u663e\u7136\u8003\u8651\u679a\u4e3e\u5bf9\u79f0\u8f74\u3002\u90a3\u4e48\u8ba1\u7b97\u5bf9\u79f0\u8f74\u4e24\u8fb9\u76f8\u540c\u5b57\u7b26\u7684\u6570\u91cf $c$\uff0c\u6bcf\u4e00\u4e2a\u5b57\u7b26\u5b58\u5728\u9009\u548c\u4e0d\u9009\u4e24\u79cd\uff0c\u4e0d\u80fd\u4e0d\u9009\uff0c\u90a3\u4e48\u65b9\u6848\u6570\u5c31\u662f $2^c-1$\u3002\u6ce8\u610f\u5230\u9009\u51fa\u6765\u7684\u5b57\u7b26\u4e32\u4e0d\u53ef\u4ee5\u662f\u5355\u4e2a\u56de\u6587\u4e32\uff0c\u6240\u4ee5\u8fd8\u8981\u7528 Manacher \u51cf\u53bb\u56de\u6587\u4e32\u6570\u91cf\u3002\n\n\u90a3\u600e\u4e48\u8ba1\u7b97\u6bcf\u4e2a\u5bf9\u79f0\u8f74\u4e24\u8fb9\u76f8\u540c\u5b57\u7b26\u7684\u6570\u91cf\u5462\uff1f\u6211\u4eec\u5c06 $a$ \u770b\u4f5c $1$\uff0c$b$ \u770b\u4f5c $-1$\uff0c\u7136\u540e\u505a\u52a0\u6cd5\u5377\u79ef\u3002\u5982\u679c\u4e24\u4e2a\u76f8\u540c\u7684\u5b57\u7b26\u5339\u914d\u4e86\uff0c\u90a3\u4e48\u8d21\u732e\u4e3a $1$\uff1b\u5426\u5219\u4e24\u6570\u76f8\u4e58\uff0c\u7ed3\u679c\u4e3a $-1$\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5c0f\u5b66\u6559\u7684\u89e3\u65b9\u7a0b\u7b97\u51fa\u5bf9\u79f0\u8f74\u4e24\u8fb9\u76f8\u540c\u5b57\u7b26\u7684\u6570\u91cf\uff0c\u8ba1\u7b97\u7b54\u6848\u5373\u53ef\u3002\n\n\u5f53\u7136\u6211\u81ea\u5df1\u5199\u7684\u6709\u70b9\u95ee\u9898\uff0c\u6240\u4ee5\u662f $4$ \u6b21 FFT\u2026\u2026\u5f53\u7136\u5982\u679c\u4e0d\u4f1a\u4e09\u6b21\u53d8\u4e24\u6b21\u53ef\u4ee5\u53bb\u770b\u677f\u5b50\u9898\u3002\n\n\u55ef\u6211\u8fd8\u662f\u8d34\u4e00\u4e2a\u4ee3\u7801\u5427\u2026\u2026\n\n```cpp\nPoly SelfMul(Poly f)\n{\n\tLL len=len(f)*2-1;\n\tLL lim=1;\n\twhile(lim<len)\tlim<<=1;\n\tPoly ret;\n\tret.resize(lim);\n\tf.resize(lim);\n\tmakeRev(lim);\n\tFFT(f,1);\n\tfor(LL i=0;i<lim;++i)\tret[i]=f[i]*f[i];\n\tFFT(ret,0);\n\tfor(LL i=0;i<lim;++i)\tret[i].x=ret[i].x/lim,ret[i].y=ret[i].y/lim;\n\tret.resize(len);\n\treturn ret;\n}\nPoly f,g;\nchar s[100005],t[200005];\nLL n,a[100005];\nLL slp[200005],pls[200005];\nLL manacher()\n{\n\tstatic LL p[200005];\n\tt[0]='#';\n\tLL st=0;\n\tfor(LL i=1;i<=n;++i)\tt[++st]='|',t[++st]=s[i-1];\n\tt[++st]='|';\n\tLL ans=0;\n\tfor(LL i=1,r=0,d=0;i<=st;++i)\n\t{\n\t\tif(i<=r)\tp[i]=min(p[2*d-i],r-i+1);\n\t\twhile(t[i-p[i]]==t[i+p[i]])\t++p[i];\n\t\tif(p[i]+i-1>r)\tr=p[i]+i-1,d=i;\n\t\tif(t[i]=='|')\tans+=(p[i]-1)/2;\n\t\telse\tans+=(p[i]+1)/2;\n\t}\n\treturn ans;\n}\nint main(){\n\tscanf(\"%s\",s);\n\tn=strlen(s);\n\tfor(LL i=0;i<n;++i)\tf.push_back(Complex(s[i]=='a'?1:-1,s[i]=='a'?1:-1)),g.push_back(Complex(s[i]=='a'?1:-1,s[i]=='a'?1:-1));\n\treverse(g.begin(),g.end());\n\tf=SelfMul(f),g=SelfMul(g);\n\tfor(LL i=0;i<2*n-1;++i)\tslp[i]=LL(round(f[i].y/2)),pls[i]=LL(round(g[i].y/2));\n\tLL ans=0;\n\tfor(LL i=0;i<n;++i)\n\t{\n\t\t{\n\t\tLL x=slp[i];\n\t\tLL st=i+1;\n\t\tLL mtc=(st-(st-x)/2)/2;\n\t\tif(i&1)\tans+=QuickPow(2,mtc)-1;\n\t\telse\tans+=QuickPow(2,mtc+1)-1;\n\t\t}\n\t\tif(i!=n-1)\n\t\t{\n\t\tLL x=pls[i];\n\t\tLL st=i+1;\n\t\tLL mtc=(st-(st-x)/2)/2;\n\t\tif(i&1)\tans+=QuickPow(2,mtc)-1;\n\t\telse\tans+=QuickPow(2,mtc+1)-1;\n\t\t}\n\t}\n\tans-=manacher();\n\tans%=MOD;\n\tans+=MOD;\n\tans%=MOD;\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1651488842,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u53d6\u6a21\u4f4d\u7f6e\u653e\u7684\u592a\u597d\u5566\uff01"
    },
    {
        "content": "[$\\text{Link}$](https://www.luogu.com.cn/problem/P4199)\n## \u9898\u610f\n\u7ed9\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\uff0c\u5b57\u7b26\u96c6\u4e3a $2$ \u7684\u5b57\u7b26\u4e32 $s$\uff0c\u6c42\u6ee1\u8db3\u4ee5\u4e0b\u4e09\u4e2a\u6761\u4ef6\u7684\u5b57\u7b26\u4e32 $t$ \u7684\u6570\u91cf\u3002\n\n- $t\\in\\text{subsequences}(s)$\uff1b\n- $t\\notin\\text{substrings}(s)$\uff1b\n- $t$ \u5728 $s$ \u4e2d\u7684\u4f4d\u7f6e\u3001\u5b57\u7b26\u6cbf\u67d0\u5bf9\u79f0\u4e2d\u5fc3\u5bf9\u79f0\u3002\n\n\u5176\u4e2d $n\\le 10^5$\u3002\n## \u601d\u8def\n\u9996\u5148\u6c42\u51fa\u6ee1\u8db3 $1,3$ \u6761\u4ef6\u7684 $t$ \u7684\u6570\u91cf\u51cf\u53bb\u4e0d\u6ee1\u8db3 $2$ \u6761\u4ef6\u7684 $t$ \u7684\u6570\u91cf\u5373\u53ef\uff0c\u540e\u8005\u53ef\u4ee5 $\\text{Manacher}$ \u6216\u8005 $\\text{PAM}$ \u89e3\u51b3\uff0c\u4e0d\u662f\u672c\u9898\u91cd\u70b9\uff0c\u6545\u53ea\u8ba8\u8bba\u524d\u8005\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u8f6c\u6362\u601d\u8def\uff0c\u679a\u4e3e\u5bf9\u79f0\u4e2d\u5fc3\u8ba1\u7b97\u7b54\u6848\u4e4b\u548c\u3002\n\n\u4ee4 $f_i$ \u8868\u793a\u4ee5 $i$ \u4e3a\u5bf9\u79f0\u4e2d\u5fc3\u65f6\u5bf9\u79f0\u7684\u5b57\u6bcd\u4e2a\u6570\uff0c\u5219\n$$f_i=\\sum_{j=1}^i[s_j=s_{2i-j}]$$\n\u5bb9\u6613\u5f97\u77e5\uff0c\u5bf9\u4e8e\u8fd9 $f_i$ \u5bf9\u6570\u4e2d\u6bcf\u5bf9\u90fd\u53ef\u9009\u6216\u4e0d\u9009\uff0c\u4f46\u4e0d\u80fd\u5168\u90e8\u4e0d\u9009\uff0c\u6240\u4ee5 $i$ \u5904\u7684\u7684\u7b54\u6848\u4e3a $2^{f_i}-1$\u3002\n\n\u5f53 $g_i=[s_i=c]$ \u65f6\uff0c$s_i=s_j=c$ \u5f53\u4e14\u4ec5\u5f53 $g_i=g_j=1$\uff0c\u5373 $g_i\\times g_j=1$\u3002\n\n\u90a3\u4e48\u679a\u4e3e $c$\uff0c\u6784\u9020\u591a\u9879\u5f0f $F$\uff0c\u5176\u4e2d $F_i=[s_i=c]$\uff0c\u90a3\u4e48\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97 $F^2$ \u8ba1\u5165\u7b54\u6848\u5373\u53ef\u3002\u5b9e\u73b0\u65f6\u9700\u8981\u6ce8\u610f\u5224\u65ad\u5bf9\u79f0\u4e2d\u5fc3\u662f\u5728\u539f\u5b57\u7b26\u4e32\u4e0a\u8fd8\u662f\u63d2\u5165\u7684\u5b57\u7b26\u4e0a\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nnamespace IO{//by cyffff\n\t//here was something\n}\nconst int N=4e5+10,mod=1e9+7;\nchar str[N],input[N];\nint p[N],ans[N],n,sum;\ninline void getc(char *a,char *b,int n){\n\tint len=0;\n\tb[len++]='~';\n\tb[len++]='|';\n\tfor(int i=1;i<=n;i++){\n\t\tb[len++]=a[i];\n\t\tb[len++]='|';\n\t}\n\tb[n*2+2]=0;\n\tlen--;\n}\ninline int qpow(int x,int y){\n\tint res=1;\n\twhile(y){\n\t\tif(y&1) res=1ll*res*x%mod;\n\t\tx=1ll*x*x%mod;\n\t\ty>>=1;\n\t}\n\treturn res;\n} \n#define ld double\nconst ld pi=acos(-1);\nstruct comp{\n\tld x,y;\n\tcomp(ld a=0,ld b=0){x=a,y=b;}\n\tcomp neg(){ return comp(x,-y); }\n\tfriend comp operator+(const comp &a,const comp &b){ return comp(a.x+b.x,a.y+b.y); }\n\tfriend comp operator-(const comp &a,const comp &b){ return comp(a.x-b.x,a.y-b.y); }\n\tfriend comp operator*(const comp &a,const comp &b){ return comp(a.x*b.x-a.y*b.y,a.y*b.x+a.x*b.y); }\n};\nint rev[N],lim;\ninline int add(int x,int y){ return x+y>=mod?x+y-mod:x+y; }\ninline int dec(int x,int y){ return x>=y?x-y:x-y+mod; }\ninline void init(int n,int mode=1){\n\tif(mode){\n\t\tint l=0;\n\t\tfor(lim=1;lim<=n;lim<<=1)l++;\n\t\tfor(int i=0;i<lim;i++){\n\t\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<l-1);\n\t\t}\n\t}else{\n\t\tfor(lim=1;lim<=n;lim<<=1);\n\t}\n}\ninline void FFT(comp *a,int lim,int tpe){\n\tfor(int i=0;i<lim;i++)\n\t\tif(i<rev[i])\n\t\t\tswap(a[i],a[rev[i]]);\n\tfor(int i=1;i<lim;i<<=1){\n\t\tcomp wn(cos(pi/i),tpe*sin(pi/i));\n\t\tfor(int j=0;j<lim;j+=(i<<1)){\n\t\t\tcomp w(1);\n\t\t\tfor(int k=0;k<i;k++,w=w*wn){\n\t\t\t\tcomp t=a[i+j+k]*w;\n\t\t\t\ta[i+j+k]=a[j+k]-t;\n\t\t\t\ta[j+k]=a[j+k]+t;\n\t\t\t}\n\t\t}\n\t}\n\t\t\n\tif(tpe==-1){\n\t\tdouble p=1./lim;\n\t\tfor(int i=0;i<lim;i++)\n\t\t\ta[i].x*=p,a[i].y*=p;\n\t}\n}\ncomp A[N];\nint main(){\n\tn=readstr(input);\n\tgetc(input,str,n);\n\tfor(int i=1,r=0,mid=0;i<=n*2+1;i++){\n\t\tif(i<r)\n\t\t\tp[i]=min(p[(mid<<1)-i],r-i);\n\t\twhile(str[i-p[i]]==str[i+p[i]])\n\t\t\tp[i]++;\n\t\tif(i+p[i]>r)\n\t\t\tr=i+p[i],mid=i;\n\t}\n\tinit(n<<1);\n\tfor(int i=1;i<=n;i++)\n\t\tA[i].x=input[i]=='a';\n\tFFT(A,lim,1);\n\tfor(int i=0;i<lim;i++)\n\t\tA[i]=A[i]*A[i];\n\tFFT(A,lim,-1);\n\tfor(int i=1;i<=n*2+1;i++)\n\t\tans[i]+=(int(A[i].x+0.5)-(i%2==0));\n\tfor(int i=0;i<lim;i++)\n\t\tA[i].x=A[i].y=0;\n\tfor(int i=1;i<=n;i++)\n\t\tA[i].x=input[i]=='b';\n\tFFT(A,lim,1);\n\tfor(int i=0;i<lim;i++)\n\t\tA[i]=A[i]*A[i];\n\tFFT(A,lim,-1);\n\tfor(int i=1;i<=n*2+1;i++)\n\t\tans[i]+=(int(A[i].x+0.5)-(i%2==0));\n\tfor(int i=1;i<=n*2+1;i++)\n\t\tans[i]=((ans[i]+(i%2==0))>>1)+(i%2==0);\n\tfor(int i=1;i<=n*2+1;i++)\n\t\tans[i]=qpow(2,ans[i])-1;\n\tfor(int i=1;i<=n*2+1;i++)\n\t\tans[i]-=p[i]>>1;\n\tfor(int i=1;i<=n*2+1;i++)\n\t\tsum=(sum+ans[i])%mod;\n\tprintf(\"%d\\n\",sum);\n\treturn 0;\n}\n```\n\u518d\u89c1 qwq~",
        "postTime": 1626174089,
        "uid": 365127,
        "name": "cyffff",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4199\u3010\u4e07\u5f84\u4eba\u8e2a\u706d\u3011"
    },
    {
        "content": "### Description\n\n\u7ed9\u5b9a\u4e00\u4e2a\u5b57\u7b26\u4e32\u7531 'a' \u6216 'b' \u7ec4\u6210\u3002\u6c42\u6709\u591a\u5c11\u4e2a\u5b50\u5e8f\u5217\u6ee1\u8db3\u5b57\u6bcd\u548c\u5750\u6807\u90fd\u5173\u4e8e\u4e00\u6761\u5bf9\u79f0\u8f74\u5bf9\u79f0\u5e76\u4e14\u4e0d\u662f\u8fde\u7eed\u7684\n\n\u5b57\u7b26\u4e32\u957f\u5ea6 $=n \\leq 10^5$\n\n### Solution\n\n\u9ed8\u8ba4\u5b57\u7b26\u4e32\u4e3a $S$ \u4ece $0$ \u5f00\u59cb\u6807\u53f7\u3002 \n\n\u7b54\u6848\u7b49\u4e8e\u6240\u6709\u7684\u6ee1\u8db3\u5b57\u6bcd\u548c\u5750\u6807\u90fd\u5173\u4e8e\u4e00\u6761\u5bf9\u79f0\u8f74\u5bf9\u79f0\u7684\u5b50\u5e8f\u5217\u6570\u91cf - \u8fde\u7eed\u7684\u6ee1\u8db3\u8fd9\u4e2a\u6027\u8d28\u7684\u5b50\u5e8f\u5217\u6570\u91cf\n\n\u540e\u9762\u8fd9\u4e2a\u53ef\u4ee5\u76f4\u63a5\u7528 **manacher\u7b97\u6cd5** \u76f4\u63a5\u6c42\u51fa\uff0c\u53ea\u9700\u8981\u8003\u8651\u524d\u9762\u600e\u4e48\u6c42\n\n\u8003\u8651\u600e\u4e48\u7b97\u51fa\u5173\u4e8e\u7b2c $i$ \u4e2a**\u4f4d\u7f6e**\u5bf9\u79f0\u7684\u5b50\u5e8f\u5217\u4e2a\u6570\u3002\u8bbe\u6709 $k$ \u7ec4 $(x, y)$ \u4f7f\u5f97 $x + y = 2 i$ \u4e14 $x, y \\not= i$ \u4e14 $S_x = S_y$ \uff0c\u90a3\u4e48\u65b9\u6848\u6570\u5c31\u662f $2^{k+1}-1$ \uff08k \u7ec4\u548c $i$ \u8fd9\u4e2a\u4f4d\u7f6e\u9009\u4e0d\u9009\u51cf\u53bb\u90fd\u4e0d\u9009\u7684\u4e00\u79cd\u60c5\u51b5\uff09\n\n\u8003\u8651\u600e\u4e48\u7b97\u51fa\u5173\u4e8e\u7b2c $i$ \u5230\u7b2c $i+1$ \u4e2a\u4f4d\u7f6e\u4e2d\u95f4\u8fd9\u4e2a\u7a7a\u9699\uff08\u53ef\u4ee5\u8ba4\u4e3a\u662f $i + \\frac{1}{2}$\uff09\u5bf9\u79f0\u7684\u5b50\u5e8f\u5217\u7684\u4e2a\u6570\u3002\u8bbe\u6709 $k$ \u7ec4 $(x,y)$ \u6ee1\u8db3 $S_x = S_y$ \u4e14 $x+y = 2(i+\\frac{1}{2}) = 2i + 1$ \uff0c\u90a3\u4e48\u65b9\u6848\u6570\u5c31\u662f $2^k - 1$\uff08\u548c\u4e0a\u9762\u4e0d\u4e00\u6837\u7684\u539f\u56e0\u662f\u81ea\u5df1\u8fd9\u4e2a\u4f4d\u7f6e\u4e0d\u662f\u6574\u6570\u4e0d\u80fd\u88ab\u9009\u6240\u4ee5\u4e0d\u7528\u8003\u8651\uff09\n\n\u4ee4 $ f_i = \\sum\\limits_{x+y=i} [S_x=S_y] $ \uff0c\u90a3\u4e48 $f_i$ \u548c\u8fd9\u4e2a $k$ \u7684\u5173\u7cfb\u662f\u4ec0\u4e48\u5462\uff1f\n\n\u8fd9\u91cc\u8981\u60f3\u6e05\u695a\u3002\u5f53 $i$ \u662f\u5076\u6570\u7684\u65f6\u5019\uff0c$[S_{\\frac{i}{2}}=S_{\\frac{i}{2}}]$ \u5176\u5b9e\u4e5f\u88ab\u7b97\u4e86\u8fdb\u53bb\uff0c\u6240\u4ee5\u5e94\u8be5\u662f $f_i = 2k + 1$\uff1b\u800c $i$ \u662f\u5947\u6570\u7684\u65f6\u5019\u5c31\u6ca1\u6709\u8fd9\u4e2a\u95ee\u9898\uff0c\u76f4\u63a5\u5c31\u662f $f_i = 2k$\uff1b\u7efc\u5408\u4e00\u4e0b\u5176\u5b9e\u5c31\u662f $k = \\lfloor \\frac{f_i}{2} \\rfloor$\n\n\u7136\u540e\u5c31\u662f\u600e\u4e48\u6c42 $f_i$ \u7684\u95ee\u9898\u4e86\u3002\u8fd9\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u53c8\u663e\u7136\u5b57\u6bcd\u4e4b\u95f4\u662f\u72ec\u7acb\u7684\u3002\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5b57\u6bcd $x$\uff0c\u4ee4 $g_i = [S_i = x]$\uff0c\u90a3\u4e48 $f$ \u5c31\u662f\u7531\u4e24\u4e2a $g$ \u5377\u79ef\u5f97\u5230\u7684\u3002\u6240\u4ee5\u6700\u540e f \u5c31\u662f\u5bf9\u4e8e\u4e24\u4e2a\u5b57\u6bcd\u5206\u522b\u505a\u4e00\u904d\u5377\u79ef\u52a0\u8d77\u6765\u5c31\u884c\u3002\n\n\u5177\u4f53\u7684\uff0c\u8fd9\u9053\u9898\u7684\u505a\u6cd5\u662f\uff1a\n1. \u62ff\u5230\u5b57\u7b26\u4e32\uff0c\u8dd1 manacher \u5f97\u5230 s1 \n2. \u4ee4 $f_i = [S_i = a]$\uff0c\u5c06 $f * f$ \u52a0\u5230\u591a\u9879\u5f0f $h$ \u4e2d\n3. \u4ee4 $g_i = [S_i = b]$\uff0c\u5c06 $g * g$ \u52a0\u5230\u591a\u9879\u5f0f $h$ \u4e2d\n4. \u7b54\u6848\u5c31\u76f8\u5f53\u4e8e $ \\sum\\limits_{i=0}^{2n -  2} (2^{\\lfloor\\frac{h_i}{2}\\rfloor + [2|i]}-1)$ \uff08\u53ef\u80fd\u6709\u70b9\u590d\u6742\u4e0d\u8fc7\u7efc\u5408\u4e0a\u9762\u6765\u770b\u662f\u663e\u7136\u7684\uff09\n\n\u5bf9\u4e8e\u5377\u79ef\uff0c\u6211\u7528\u7684\u662f NTT (FFT \u6211\u4e5f\u5199\u4e86\uff0c\u6162\u4e86 4 \u500d\u563f\u563f)\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log n)$\n\n### Code \n\n[\u770b\u4ee3\u7801\u6233\u8fd9\u91cc](https://acfunction.github.io/2019/02/28/BZOJ3160/#Code)\n",
        "postTime": 1551352310,
        "uid": 54745,
        "name": "Gypsophila",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4199 \u3010\u4e07\u5f84\u4eba\u8e2a\u706d\u3011"
    },
    {
        "content": "# \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u53ea\u5305\u62ec $a$ \u548c $b$ \u7684\u5b57\u7b26\u4e32\uff0c\u6c42\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u7684\u5b50\u5e8f\u5217\u7684\u6570\u91cf\uff1a\n\n1. \u4f4d\u7f6e\u548c\u5b57\u7b26\u90fd\u5173\u4e8e\u67d0\u6761\u8f74\u5bf9\u79f0\u3002\n2. \u4e0d\u662f\u8fde\u7eed\u7684\u4e00\u6bb5\u3002\n\n# \u9898\u89e3\n\n\u9996\u5148\uff0c\u5982\u679c\u67d0\u4e2a\u5b50\u5e8f\u5217\u662f\u8fde\u7eed\u7684\u4e00\u6bb5\uff0c\u90a3\u4e48\u5b83\u5176\u5b9e\u5c31\u662f\u539f\u5b57\u7b26\u4e32\u7684\u4e00\u4e2a\u5b50\u56de\u6587\u4e32\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 **Manacher** \u7b97\u6cd5\u9996\u5148\u8ba1\u7b97\u51fa\u6240\u6709\u7684\u56de\u6587\u4e32\u6570\u91cf\uff0c\u6700\u540e\u518d\u51cf\u53bb\u5373\u53ef\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u53bb\u9664\u4e86\u7b2c\u4e8c\u6761\u9650\u5236\u3002\n\n\u8003\u8651\u7b2c\u4e00\u6761\u9650\u5236\uff1a\u5047\u5982\u6211\u4eec\u5173\u4e8e\u67d0\u6761\u8f74\u6709 $a$ \u5bf9\u5b57\u7b26\u5bf9\u79f0\uff0c\u90a3\u4e48\u5b9e\u9645\u80fd\u7ec4\u6210\u7684\u5b50\u5e8f\u5217\u5c31\u6709 $2^a-1$ \u79cd\u3002\uff08\u6bcf\u5bf9\u5b57\u7b26\u53ef\u4ee5\u9009\u53ef\u4ee5\u4e0d\u9009\uff0c\u5e76\u4e14\u8981\u51cf\u53bb\u7a7a\u5e8f\u5217\uff09\n\n\u90a3\u4e48\u5982\u4f55\u5feb\u901f\u8ba1\u7b97\u5173\u4e8e\u67d0\u6761\u8f74\u5bf9\u79f0\u7684\u5b57\u7b26\u5bf9\u6570\u5462\uff1f\u53d1\u73b0\u5b57\u7b26\u96c6\u4e3a $2$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5bf9\u6bcf\u4e2a\u5b57\u7b26\u5355\u72ec\u8003\u8651\uff1a\n\n\u8bbe $d_i$ \u4e3a\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u662f\u5426\u4e3a $a$\uff0c\u5982\u679c\u6211\u4eec\u5047\u8bbe\u5bf9\u79f0\u8f74\u4e3a $k$\uff08$k$ \u53ef\u4ee5\u4e3a\u4e00\u4e2a\u5206\u6bcd\u4e3a $2$ \u7684\u5206\u6570\uff0c\u5373\u5bf9\u79f0\u8f74\u5728\u4e24\u4e2a\u5b57\u7b26\u4e2d\u95f4\uff09\uff0c\u90a3\u4e48\u4ee5 $k$ \u4e3a\u5bf9\u79f0\u8f74\u7684\u5b57\u7b26\u5bf9\u6570\u5c31\u662f\uff1a\n\n$$\\sum_{\\frac{i+j}{2}=k}d_id_j$$\n\n\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u6bd4\u8f83\u50cf\u5377\u79ef\u7684\u5f62\u5f0f\u3002\u8fd9\u4e2a\u5206\u6570\u770b\u8d77\u6765\u5f88\u4e0d\u723d\uff0c\u4f46\u662f\u53ef\u4ee5\u8003\u8651\u6211\u4eec\u5728\u8fdb\u884c Manacher \u7684\u65f6\u5019\uff0c\u5df2\u7ecf\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c\u4e86\u8865\u4f4d\uff0c\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u8bbe $k$ \u4e3a\u8865\u4f4d\u540e\u7684\u5b57\u7b26\u4e32\u7684\u5bf9\u79f0\u8f74\uff0c\u8fd9\u6837\u6211\u4eec\u5b9e\u9645\u8981\u6c42\u7684\u7b54\u6848\u5c31\u662f\uff1a\n\n$$\\sum_{k=1}^{2n+1}\\sum_{i+j=k}d_id_j$$\n\n\u5316\u4e3a\u5377\u79ef\u7684\u5f62\u5f0f\uff1a\n\n$$\\sum_{k=1}^{2n+1}\\sum_{i=1}^kd_id_{k-i}$$\n\n\u4f7f\u7528 FFT \u6216\u8005 NTT \u8fdb\u884c\u4f18\u5316\u5373\u53ef\u3002\n\n\u6ce8\u610f\u8fd9\u4e2a\u5f0f\u5b50\u4f1a\u5c06\u4e0d\u5728\u540c\u4e00\u4f4d\u7f6e\u7684\u4e24\u4e2a\u5b57\u6bcd\u91cd\u590d\u8ba1\u7b97\u4e00\u6b21\uff0c\u4f46\u662f\u5728\u540c\u4e00\u4f4d\u7f6e\u7684\u5b57\u6bcd\u53ea\u4f1a\u8ba1\u7b97\u4e00\u6b21\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u9664\u4ee5 $2$ \u5e76\u5411\u4e0a\u53d6\u6574\uff08\u5411\u4e0a\u53d6\u6574\u7684\u539f\u56e0\u662f\u5728\u8ba1\u7b97\u56de\u6587\u4e32\u65f6\u5df2\u7ecf\u8ba1\u7b97\u4e86\u4e00\u4e2a\u5b57\u6bcd\u7684\u6570\u91cf\u4e86\uff0c\u5982\u679c\u8fd9\u91cc\u5411\u4e0b\u53d6\u6574\u5c31\u4f1a\u5c11\u8ba1\u7b97\u4e00\u4e2a\u5b57\u6bcd\u7684\u6570\u91cf\uff0c\u7b97\u51fa\u6765\u7684\u7ed3\u679c\u5c31\u4f1a\u591a\u51cf\u4e00\u4e9b\u6570\u3002\uff09\n\n\u5b57\u7b26\u4e3a $b$ \u7684\u60c5\u51b5\u662f\u4e00\u6837\u7684\uff0c\u6700\u540e\u5c06 $a$ \u548c $b$ \u7684\u6570\u91cf\u90fd\u52a0\u8d77\u6765\u4e00\u8d77\u9664\u4ee5 $2$ \u5411\u4e0a\u53d6\u6574\u5c31\u662f\u5173\u4e8e\u8fd9\u4e2a\u5bf9\u79f0\u8f74\u5bf9\u79f0\u7684\u5b57\u7b26\u5bf9\u6570\u3002\n\n\u6700\u540e\u51cf\u53bb\u56de\u6587\u4e32\u7684\u6570\u91cf\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n# \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int MAXN = 400105;\nint n;\nchar ch[MAXN];\nchar ch2[MAXN];\nint r[MAXN];\nvoid manacher() {\n    for (int i = 1, m = 0, c; i <= 2 * n + 1; i++) {\n        r[i] = i > m ? 1 : min(m - i, r[2 * c - i]);\n        while (ch2[i + r[i]] == ch2[i - r[i]]) r[i]++;\n        if (i + r[i] > m) {\n            m = i + r[i];\n            c = i;\n        }\n    }\n}\nconst int P = 998244353, G = 3, P2 = 1000000007;\nint qpow(int a, int b, int P = ::P) {\n    int ans = 1;\n    while (b) {\n        if (b & 1) ans = 1ll * ans * a % P;\n        a = 1ll * a * a % P;\n        b >>= 1;\n    }\n    return ans;\n}\nconst int GI = qpow(G, P - 2);\nint R[MAXN];\nstruct Polynomial {\n    vector<int> a;\n    int len;\n    int& operator[](int b) { return a[b]; }\n    Polynomial(int len = 0) : len(len) { a.resize(len + 1); }\n    void set(int len) { this->len = len, a.resize(len + 1); }\n    void ntt(int limit, bool rev) {\n        set(limit);\n        for (int i = 0; i < limit; i++) if (i < R[i]) swap(a[i], a[R[i]]);\n        for (int mid = 1; mid < limit; mid <<= 1) {\n            int step = qpow(rev ? GI : G, (P - 1) / (mid << 1));\n            for (int l = 0; l < limit; l += (mid << 1)) {\n                int w = 1;\n                for (int i = 0; i < mid; i++, w = 1ll * w * step % P) {\n                    int x = a[l + i], y = 1ll * w * a[l + i + mid] % P;\n                    a[l + i] = (x + y) % P, a[l + i + mid] = (x - y + P) % P;\n                }\n            }\n        }\n        if (rev) {\n            int nrev = qpow(limit, P - 2);\n            for (int i = 0; i < limit; i++) a[i] = 1ll * a[i] * nrev % P;\n        }\n    }\n    Polynomial operator*(Polynomial b) {\n        Polynomial a = *this, c; int n = a.len + b.len;\n        int limit = 1; while (limit <= n) limit <<= 1; c.set(limit);\n        for (int i = 0; i < limit; i++) \n            R[i] = (R[i >> 1] >> 1) | ((i & 1) * limit >> 1);\n        a.ntt(limit, false), b.ntt(limit, false);\n        for (int i = 0; i < limit; i++) c[i] = 1ll * a[i] * b[i] % P;\n        c.ntt(limit, true);\n        c.set(n);\n        return c;\n    }\n    void print() {\n        for (int i : a) printf(\"%d \", i);\n        printf(\"\\n\");\n    }\n}a, b;\nlong long ans = 0;\nint main() {\n    scanf(\"%s\", ch + 1);\n    n = strlen(ch + 1);\n    ch2[0] = '?';\n    for (int i = 1; i <= 2 * n + 1; i++) ch2[i] = (i & 1) ? '#' : ch[i >> 1];\n    manacher();\n    a.set(n), b.set(n);\n    for (int i = 1; i <= n; i++) {\n        if (ch[i] == 'a') {\n            a[i]++;\n        } else {\n            b[i]++;\n        }\n    }\n    a = a * a, b = b * b;\n    for (int i = 1; i <= 2 * n + 1; i++) \n        ans = (1ll * ans + qpow(2, ((a[i] + b[i] + 1) / 2), P2) - r[i] / 2 - 1 + P2) % P2;\n    printf(\"%lld\\n\", ans);\n    return 0;\n}\n```",
        "postTime": 1646140668,
        "uid": 279652,
        "name": "APJifengc",
        "ccfLevel": 9,
        "title": "\u300c\u89e3\u9898\u62a5\u544a\u300d\u4e07\u5f84\u4eba\u8e2a\u706d"
    },
    {
        "content": "### \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u7531$a$\u548c$b$\u6784\u6210\u7684\u5b57\u7b26\u4e32,\u6c42\u4e0d\u8fde\u7eed\u56de\u6587\u5b50\u5e8f\u5217\u7684\u4e2a\u6570\n\n---\n### \u9898\u89e3\n\n\u4e0d\u8fde\u7eed\u56de\u6587\u5b50\u5e8f\u5217\u6570=\u56de\u6587\u5b50\u5e8f\u5217\u6570-\u56de\u6587\u5b50\u4e32\u6570\n\n\u540e\u9762\u7684\u53ef\u4ee5\u76f4\u63a5\u7528$PAM$\u6c42\u51fa\u6765\n\n~~(\u6211\u624d\u4e0d\u4f1a\u8bf4\u56e0\u4e3a$Manacher$\u80fd\u5e72\u7684$PAM$\u90fd\u80fd\u5e72,\u6240\u4ee5\u5f03\u6389\u4e86$Manacher$)~~\n\n\u8003\u8651\u56de\u6587\u5b50\u5e8f\u5217\u6570\u600e\u4e48\u6c42\n\n\u5982\u679c$s_i=s_j$\u90a3\u4e48\u8fd9\u4e24\u4e2a\u5b57\u7b26\u5c31\u5173\u4e8e$\\frac{i+j}2$\u5bf9\u79f0\n\n\u8003\u8651$(s_i,s_j)$\u9009\u4e0d\u9009\u5c31\u5bf9$\\frac{i+j}2$\u6709$\\times2$\u7684\u8d21\u732e\n\n\u6240\u4ee5\u53ef\u4ee5\u8bbe$f_{\\frac{i+j}2}=$\u5de6\u53f3\u4e24\u8fb9\u6709\u591a\u5c11\u5bf9$(s_i,s_j)$\u6ee1\u8db3$s_i=s_j$\n\n\u53bb\u6389\u5de6\u53f3\u7684\u9650\u5236$f_{\\frac{i+j}2}=\\sum\\frac{[s_i=s_j]}2$\n\n\u4e0b\u6807\u91cc\u9762\u6709$\\frac12$\u5f88\u8ba8\u5acc,\u800c\u4e14\u5bf9\u79f0\u4e2d\u5fc3\u8fd8\u53ef\u80fd\u662f\u5c0f\u6570\n\n\u6240\u4ee5\u76f4\u63a5\u8bbe$f_{i+j}=\\sum\\frac{[s_i=s_j]}2$\n\n\u4e0a\u9762\u770b\u8d77\u6765\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f,\u8003\u8651\u628a\u7b49\u4e8e\u53d8\u6210\u4e58\u6cd5\n\n$$\\Rightarrow f_{i+j}=\\lceil\\frac{\\sum_c\\sum[s_i=c]*[s_j=c]}2\\rceil=\\lceil\\frac{\\sum_cS_c^2(x)}2\\rceil$$\n\n\u6240\u4ee5\u5c31\u53ef\u4ee5\u679a\u4e3e\u5b57\u7b26\u96c6,\u7136\u540e\u7528\u505a$|c|+1$\u904d$FFT$\u7b97$f_i$\n\n\u56e0\u4e3a$FFT$\u91cc\u5982\u679c\u4e24\u4e2a\u5b57\u7b26\u4f4d\u7f6e\u76f8\u540c$(s_i=s_i)$\u662f\u4e0d\u4f1a\u88ab\u7b97\u4e24\u904d\u7684,\u6240\u4ee5\u8981\u5411\u4e0a\u53d6\u6574\n\n\u7136\u540e$\\lceil\\frac x2\\rceil=\\lfloor\\frac{x+1}2\\rfloor$\n\n\u7136\u540e\u5168\u96c6$Sum=\\sum_{i=1}^{2n}2^{f_i}-1$(\u975e\u7a7a\u5b50\u96c6)\n```\n#include<bits/stdc++.h>\n#define fp(i,a,b) for(register int i=a,I=b+1;i<I;++i)\n#define fd(i,a,b) for(register int i=a,I=b-1;i>I;--i)\n#define go(u) for(register int i=fi[u],v=e[i].to;i;v=e[i=e[i].nx].to)\n#define file(s) freopen(s\".in\",\"r\",stdin),freopen(s\".out\",\"w\",stdout)\ntemplate<class T>inline bool cmax(T&a,const T&b){return a<b?a=b,1:0;}\ntemplate<class T>inline bool cmin(T&a,const T&b){return a>b?a=b,1:0;}\nusing namespace std;\nconst int N=1e5+5,M=1<<18,P=1e9+7;\ninline int pls(int a,int b){return a+=b,a>=P?a-P:a;}\ninline int sub(int a,int b){return a-=b,a<0?a+P:a;}\nstruct PAM{\n    int n,T,las;char s[N];\n    struct node{int fail,len,cnt,ch[26];}a[N];\n    inline void init(){las=n=0;T=a[0].fail=1;s[0]=a[1].len=-1;}\n    inline int gf(int x){while(s[n-a[x].len-1]^s[n])x=a[x].fail;return x;}\n    inline void ins(int v){\n        s[++n]=v;las=gf(las);\n        if(!a[las].ch[v]){\n            a[++T]={a[gf(a[las].fail)].ch[v],a[las].len+2};\n            a[las].ch[v]=T;\n        }++a[las=a[las].ch[v]].cnt;\n    }\n    inline int calc(){\n        int tp=0;\n        fd(i,T,2)a[a[i].fail].cnt=pls(a[a[i].fail].cnt,a[i].cnt),tp=pls(tp,a[i].cnt);\n        return tp;\n    }\n}p;\nint n,K,ans,pw[M],R[M];char s[N];\nstruct cp{\n    double x,y;\n    inline cp operator+(const cp&b){return(cp){x+b.x,y+b.y};}\n    inline cp operator-(const cp&b){return(cp){x-b.x,y-b.y};}\n    inline cp operator*(const cp&b){return(cp){x*b.x-y*b.y,x*b.y+y*b.x};}\n}a[M],b[M],w[M];\nconst double pi=acos(-1),eps=0.1;\ninline void fft(cp*const a,const int tp){\n    fp(i,0,K-1)if(i>R[i])swap(a[i],a[R[i]]);\n    for(int i=2;i<=K;i<<=1){\n        int d=i>>1;cp e=cp{cos(pi/d),tp*sin(pi/d)},o;\n        for(int j=d;j>=0;j-=2)w[j]=w[j>>1];\n        for(int j=1;j<=d;j+=2)w[j]=w[j-1]*e;\n        for(cp*x=a;x!=a+K;x+=i)fp(k,0,d-1)\n            o=x[k+d]*w[k],x[k+d]=x[k]-o,x[k]=x[k]+o;\n    }\n}\nint main(){\n    #ifndef ONLINE_JUDGE\n        file(\"s\");\n    #endif\n    scanf(\"%s\",s);n=strlen(s);p.init();\n\tw[0]={1};K=1;while(K<n<<1)K<<=1;pw[0]=1;\n\tfp(i,1,K-1)pw[i]=pls(pw[i-1],pw[i-1]);\n\tfp(i,0,n-1)s[i]=='a'?a[i].x=1:b[i].x=1;\n\tfor(int i=0,j=0;i<K;++i){R[i]=j;for(int l=K>>1;(j^=l)<l;l>>=1);}\n    fft(a,1),fft(b,1);fp(i,0,K-1)a[i]=a[i]*a[i]+b[i]*b[i];fft(a,-1);\n    fp(i,0,K-1)ans=pls(ans,pw[(int(a[i].x/K+eps)+1)>>1]-1);\n    fp(i,0,n-1)p.ins(s[i]-'a');\n    printf(\"%d\",sub(ans,p.calc()));\nreturn 0;\n}\n```",
        "postTime": 1521446790,
        "uid": 20156,
        "name": "Kelin",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4199 \u3010\u4e07\u5f84\u4eba\u8e2a\u706d\u3011"
    },
    {
        "content": "- $\\text{P4199}$ \u4e07\u5f84\u4eba\u8e2a\u706d\n\n   - \u7b97\u6cd5\uff1a$\\text{FFT,manacher}$\n   \n### \u9898\u76ee\uff1a\n\n\u5728\u4e00\u4e2a\u53ea\u5305\u542b $a,b$ \u7684\u5b57\u7b26\u4e32\u4e2d\u9009\u62e9\u4e00\u4e2a\u5e8f\u5217\uff0c\u4f7f\u5f97\n\n1. \u4f4d\u7f6e\u548c\u5b57\u7b26\u90fd\u5173\u4e8e\u67d0\u6761\u5bf9\u79f0\u8f74\u5bf9\u79f0\u3002\n\n2. \u4e0d\u80fd\u662f\u8fde\u7eed\u7684\u4e00\u6bb5\u3002\n\n\u6c42\u6709\u591a\u5c11\u4e2a\u6ee1\u8db3\u8981\u6c42\u7684\u5e8f\u5217\uff0c\u7b54\u6848\u5bf9 $1e9+7$ \u53d6\u6a21\u3002\n\n$n\\le 10^5$\n\n### \u9898\u89e3\uff1a\n\nupd\uff1a\u4fee\u6539\u4e86\u90e8\u5206\u5185\u5bb9\u3002\n\n\u9996\u5148\u679a\u4e3e\u5bf9\u79f0\u8f74\uff0c\u5047\u8bbe\u6211\u4eec\u4ee5 $k$ \u4e3a\u5bf9\u79f0\u8f74\u3002\n\n\u8bbe $p_k$ \u4e3a\u6ee1\u8db3 $i<j,a_i=a_j$ \u5e76\u4e14 $i,j$ \u5173\u4e8e $k$ \u5bf9\u79f0\u7684 $(i,j)$ \u7684\u4e2a\u6570\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u8fd9 $p_k$ \u4e2a $(i,j)$\uff0c$a_i$ \u4e0e $a_j$ \u8981\u4e48\u540c\u65f6\u9009\uff08\u56e0\u4e3a\u5bf9\u79f0\u6240\u4ee5\u5fc5\u5b9a\u6ee1\u8db3\uff09\uff0c\u8981\u4e48\u540c\u65f6\u4e0d\u9009\uff0c\u5171 $2^{p_k}$ \u79cd\u65b9\u6848\u3002\u6263\u6389\u7a7a\u96c6\uff0c\u5171 $2^{p_k}-1$ \u79cd\u3002\n\n$$\\therefore ans=\\sum\\limits_{k=0}^{n}2^{p_k}-1$$\n\n\u6ce8\u610f\u4e00\u4e0b\u8fd9\u91cc $k$ \u53ef\u4ee5\u4e3a $\\dfrac{t}{2}(t\\in \\mathbb{N})$\uff0c\u56e0\u4e3a\u5bf9\u79f0\u8f74\u53ef\u4ee5\u4e3a\u4e24\u4e2a\u5b57\u7b26\u4e2d\u95f4\uff08\u6bd4\u5982 $1,8$ \u5c31\u5173\u4e8e $4.5$ \u5bf9\u79f0\uff0c\u4e5f\u5c31\u662f $4,5$ \u7684\u4e2d\u95f4\u5bf9\u79f0\uff09\n\n\u8fd9\u91cc\u6709\u4e2a\u5173\u4e8e\u4f4d\u7f6e\u5bf9\u79f0\u7684\u6027\u8d28\uff1a\n\n>$i,j$ \u5173\u4e8e $p$ \u5bf9\u79f0\u5f53\u4e14\u4ec5\u5f53 $i+j=2x$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u8f6c\u79fb\u3002\n\n\u73b0\u5728\u4f4d\u7f6e\u5bf9\u79f0\u4e86\uff0c\u8fd8\u8981\u6ee1\u8db3\u5b57\u7b26\u5bf9\u79f0\u3002\n\n\u8bb0\u5b57\u7b26 $a$ \u4e3a $1$\uff0c\u5b57\u7b26 $b$ \u4e3a $0$\u3002\n\n\u90a3\u4e48\u53ef\u4ee5\u53d1\u73b0\u5f53\u4e24\u5b57\u7b26\u76f8\u7b49\u65f6\u4ec5\u53ef\u80fd\u4e3a $1+1=2(aa)$ \u6216 $0+0=0(bb)$\u3002\u800c\u5bf9\u4e8e $1+0=1(ab)$ \u7684\u60c5\u51b5\u5219\u9700\u8981\u6392\u9664\u3002\n\n\u7531\u4e8e $aa$ \u548c $bb$ \u7684\u60c5\u51b5\u7684\u6570\u503c\u4e2d\u95f4\u76f8\u5dee\u4e86 $ab$\uff0c\u96be\u4ee5\u5224\u65ad\u662f\u5426\u5bf9\u79f0\u3002\n\n\u8fd9\u91cc\u6709\u4e2a\u5f88\u597d\u7528\u7684\u4e1c\u897f\uff1a\u5e73\u65b9\u3002\n\n\u5e73\u65b9\u53ef\u4ee5\u6d88\u53bb\u6570\u503c\u7684\u8d1f\u53f7\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c06 $aa,bb,ab$ \u6240\u4ee3\u8868\u7684\u6570\u503c\u5404\u6d88\u53bb $1$ \uff0c\u90a3\u4e48\u53d8\u4e3a $1,-1,0$\uff1b\u6b64\u65f6\u518d\u5c06\u5b83\u4eec\u90fd\u5e73\u65b9\uff0c\u90a3\u4e48\u5bf9\u79f0\u7684\u5373\u53d8\u4e3a $1$\uff0c\u4e0d\u5bf9\u79f0\u7684\u8fd8\u662f $0$\uff0c\u5f88\u597d\u5730\u6ee1\u8db3\u4e86\u6211\u4eec\u7684\u8981\u6c42\u3002\n\n\n$$\\therefore p_{k}=\\sum\\limits_{i+j=2k}(a_i+a_j-1)^2$$\n\n\n\u975e\u5e38\u663e\u7136\u7684\u5377\u79ef\uff0c$\\text{FFT}$ \u4e00\u5377\u5373\u53ef\u3002\n\n\u4f46\u9898\u76ee\u4e2d\u8fd8\u8bf4\u201c\u4f4d\u7f6e\u4e0d\u80fd\u8fde\u7eed\u201d\uff0c\u8bf4\u660e\u8981\u6263\u6389\u8fde\u7eed\u7684\u56de\u6587\u5b50\u4e32\u7684\u4e2a\u6570\u3002\n\n\u5bf9\u4e8e\u56de\u6587\u7684\u5bf9\u79f0\u7684\u5b50\u4e32\u663e\u7136\uff0c\u7528 manacher \u4e00\u5f04\u5c31\u597d\u4e86\u3002\n",
        "postTime": 1622963846,
        "uid": 327935,
        "name": "trsins",
        "ccfLevel": 0,
        "title": "\u3010\u505a\u9898\u8bb0\u5f55\u3011\u4e07\u5f84\u4eba\u8e2a\u706d"
    },
    {
        "content": "## \u601d\u8def\n\n\u6211\u4eec\u8bbe\u5bf9\u4e8e\u4e00\u4e2a\u4e2d\u5fc3 $mid$\uff0c\u5176\u5de6\u53f3\u6709 $x$ \u4e2a\u80fd\u591f\u5339\u914d\u7684\u5b57\u7b26\u5bf9\uff08\u5f53\u8fd9\u4e2a\u4e2d\u5fc3\u662f\u4e00\u4e2a\u5b57\u7b26\u65f6\uff0c\u4e5f\u5305\u62ec\u8fd9\u4e2a\u5b57\u7b26\uff09\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4e2d\u5fc3\u6240\u4f5c\u7684\u8d21\u732e\u5c31\u662f $2^x-1$\uff0c\u5373\u8fd9 $x$ \u4e2a\u5b57\u7b26\u5bf9\u5206\u522b\u9009\u4e0d\u9009\uff0c\u518d\u51cf\u53bb\u4e00\u4e2a\u4e0d\u9009\u7684\u60c5\u51b5\u3002\n\n---\n\n\u7136\u540e\uff0c\u8003\u8651\u600e\u4e48\u6c42\u5bf9\u4e8e\u6bcf\u4e2a\u4f4d\u7f6e\u7684 $x$\uff1f\n\n\u66b4\u529b\u5f88\u597d\u60f3\uff0c\u76f4\u63a5 $\\Theta(n)$ \u626b\u4e00\u904d\uff0c\u7edf\u8ba1\u4e00\u4e0b\u3002\n\n\u6211\u4eec\u770b\u4e00\u4e0b\u8fdb\u884c\u591a\u9879\u5f0f\u4e58\u6cd5\u65f6\u7684\u64cd\u4f5c\uff1a\n\n![](https://images.cnblogs.com/cnblogs_com/Rubyonly233/1900929/o_201215093816ll.png)\n\n$$a_0\\times b_2,a_1\\times b_1,a_2\\times b_0$$\n\n\u5982\u679c\u5c06\u8fd9\u4e24\u4e2a\u591a\u9879\u5f0f\u770b\u6210\u6211\u4eec\u539f\u6765\u7684\u5b57\u7b26\u4e32\uff0c\u6700\u540e\u6211\u4eec\u901a\u8fc7\u4e00\u4e9b\u8ba1\u7b97\u51fa\u6765\u7684 $c_2$ \u4e0d\u5c31\u662f\u4ee5\u7b2c2\u4e2a\u5b57\u7b26\u4e3a\u4e2d\u5fc3\u7684 $x$ \u5417\u3002\n\n\u4f46\u662f\uff0c\u600e\u4e48\u8fdb\u884c\u8ba1\u7b97\u5462\uff1f\n\n\u6211\u4eec\u53d1\u73b0\u9898\u76ee\u4e2d\u8fd8\u6709\u4e00\u4e2a\u5f88\u7279\u6b8a\u7684\u6027\u8d28\uff1a\n\n* \u5b57\u7b26\u4e32\u4e2d\u53ea\u5305\u542ba\u3001b\u4e24\u4e2a\u5b57\u7b26\u3002\n\n\u4e0d\u59a8\u5c06a\u3001b\u4e24\u4e2a\u5b57\u7b26\u5206\u522b\u6362\u62101\u30010\u3002\n\n\u5229\u7528 $1\\times 1= 1, 1\\times 0 = 0 \\times 1 = 0 \\times 0 = 0$ \u7684\u6027\u8d28\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u4e24\u8fb9\u90fd\u662fa\u5339\u914d\u548c\u4e24\u8fb9\u90fd\u662fb\u5339\u914d\u7684\u8d21\u732e\u5206\u5f00\u6765\u6c42\u3002\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u53ea\u9700\u5c06\u5b57\u7b26\u4e32\u8f6c\u5316\u6210 $a=1,b=0$ \u548c $a=0,b=1$ \u7684\u591a\u9879\u5f0f\uff0c\u5206\u522b\u81ea\u4e58\u5373\u53ef\u3002\n\n---\n\n\u4f46\u662f\u9898\u76ee\u4e2d\u8fd8\u6709\u4e00\u4e2a\u9650\u5236\uff0c\u4e0d\u80fd\u591f\u662f\u8fde\u7eed\u7684\u56de\u6587\u4e32\uff0c\u6240\u4ee5\u6700\u540e\u53ea\u9700\u8dd1\u4e00\u904d $manacher$\uff0c\u51cf\u53bb\u5373\u53ef\u3002\n\n## \u4ee3\u7801\n\n```c++\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\n#include <cmath>\n\ntypedef long long ll;\n\nusing namespace std;\n\nconst int maxn = 4e5 + 50, INF = 0x3f3f3f3f, mod = 1e9 + 7;\nconst double pi = acos (- 1.0);\n\ninline int read () {\n\tregister int x = 0, w = 1;\n\tregister char ch = getchar ();\n\tfor (; ch < '0' || ch > '9'; ch = getchar ()) if (ch == '-') w = -1;\n\tfor (; ch >= '0' && ch <= '9'; ch = getchar ()) x = x * 10 + ch - '0';\n\treturn x * w;\n}\n\ninline void write (register int x) {\n\tif (x / 10) write (x / 10);\n\tputchar (x % 10 + '0');\n}\n\nchar str[maxn], tmp[maxn];\nint n, ans, bit, len = 1, rev[maxn];\nint p[maxn], base[maxn];\n\nstruct Complex {\n\tdouble x, y;\n\tComplex () { x = y = 0; }\n\tComplex (register double a, register double b) { x = a, y = b; }\n\tinline Complex operator + (const Complex &a) const { return Complex (x + a.x, y + a.y); }\n\tinline Complex operator - (const Complex &a) const { return Complex (x - a.x, y - a.y); }\n\tinline Complex operator * (const Complex &a) const { return Complex (x * a.y + y * a.x, y * a.y - x * a.x); }\n} a[maxn], b[maxn];\n\ninline void FFT (register int len, register Complex * a, register int opt) {\n\tfor (register int i = 0; i < len; i ++) if (i < rev[i]) swap (a[i], a[rev[i]]);\n\tfor (register int d = 1; d < len; d <<= 1) {\n\t\tregister Complex w1 = Complex (opt * sin (pi / d), cos (pi / d));\n\t\tfor (register int i = 0; i < len; i += d << 1) {\n\t\t\tregister Complex w = Complex (0, 1);\n\t\t\tfor (register int j = 0; j < d; j ++, w = w * w1) {\n\t\t\t\tregister Complex x = a[i + j], y = w * a[i + j + d];\n\t\t\t\ta[i + j] = x + y, a[i + j + d] = x - y;\n\t\t\t}\n\t\t}\n\t}\n}\n\ninline void Init () {\n\tbase[0] = 1;\n\tfor (register int i = 1; i <= 5e4; i ++) base[i] = 2ll * base[i - 1] % mod;\n}\n\ninline void manacher () {\n\tn >>= 1, tmp[0] = '$', tmp[1] = '#';\n\tfor (register int i = 0; i <= n; i ++) tmp[i * 2 + 2] = str[i], tmp[i * 2 + 3] = '#';\n\tn = 2 * n + 3;\n\tregister int center = -1, R = -1;\n\tfor (register int i = 0; i <= n; i ++) {\n\t\tif (R > i) p[i] = min (p[2 * center - i], R - i);\n\t\telse p[i] = 1;\n\t\twhile (tmp[i - p[i]] == tmp[i + p[i]]) p[i] ++;\n\t\tif (p[i] + i > R) R = p[i] + i, center = i;\n\t}\n\tfor (register int i = 2; i <= n; i ++) ans = ((ans - (p[i] >> 1)) % mod + mod) % mod;\n}\n\nint main () {\n\tscanf (\"%s\", str), n = strlen (str) - 1, Init ();\n\tfor (register int i = 0; i <= n; i ++) a[i].y = str[i] == 'a';\n\tfor (register int i = 0; i <= n; i ++) b[i].y = str[i] == 'b';\n\twhile (len <= n << 1) len <<= 1, bit ++;\n\tfor (register int i = 1; i < len; i ++) rev[i] = (rev[i >> 1] >> 1) | ((i & 1) << bit - 1);\n\tFFT (len, a, 1), FFT (len, b, 1), n <<= 1;\n\tfor (register int i = 0; i < len; i ++) a[i] = a[i] * a[i], b[i] = b[i] * b[i];\n\tFFT (len, a, -1), FFT (len, b, -1);\n\tfor (register int i = 0; i <= n; i ++) a[i].y = (int) (0.5 + a[i].y / len), b[i].y = (int) (0.5 + b[i].y / len);\n\tfor (register int i = 0; i <= n; i ++) ans = (ans + base[(int) (a[i].y / 2 + b[i].y / 2 + (i % 2 == 0))] - 1) % mod;\n\tmanacher (), printf (\"%d\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1608026027,
        "uid": 335193,
        "name": "Rubyonly",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4199 \u3010\u4e07\u5f84\u4eba\u8e2a\u706d\u3011"
    },
    {
        "content": "\u6211\u4eec\u53ef\u4ee5\u628a\u95ee\u9898\u8f6c\u5316\u6210\u5173\u4e8e\u201c\u67d0\u4e00\u4f4d\u7f6e\u5bf9\u79f0\u7684\u5b50\u5e8f\u5217\u6570\u201d-\u201c\u56de\u6587\u5b50\u4e32\u6570\u201d\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u95ee\uff0c\u5c31\u662f\u4e00\u4e2a\u9a6c\u62c9\u8f66\uff0c\u8fd9\u91cc\u4e0d\u518d\u8fc7\u591a\u8d58\u8ff0\n\n\u8003\u8651\u5bf9\u4e8e`a`\u548c`b`\u5206\u5f00\u5904\u7406\n\n\u6211\u4eec\u6784\u9020\u4e00\u4e2a\u591a\u9879\u5f0f\n\n$$F(x)=\\sum_{i=0}^{|s|-1}a_ix^i$$\n\n\u5176\u4e2d$a_i=[s_i==$`a`$]$\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651$F^2(x)$\u7684$x^i$\u9879\u7684\u7cfb\u6570\u5176\u5b9e\u5c31\u662f\u5173\u4e8e$\\frac{i}{2}$\u4f4d\u7f6e\u5bf9\u79f0\u5b57\u7b26\u5bf9\u7684\u4e2a\u6570\n\n\u8003\u8651\u5982\u679c\u5173\u4e8e\u67d0\u4e2a\u4f4d\u7f6e\u5bf9\u79f0\u7684\u5b57\u7b26\u5bf9\u7684\u4e2a\u6570\u662f$x$\uff0c\u90a3\u4e48\u6211\u4eec\u5728\u8fd9\u4e00\u4f4d\u7684\u8d21\u732e\u663e\u7136\u662f$2^x-1$\n\n\u8003\u8651$x$\u7684\u8ba1\u7b97\uff0c\u5f53\u5bf9\u79f0\u8f74\u5728\u67d0\u4e00\u4e2a\u5b57\u7b26\u7684\u4f4d\u7f6e\u4e0a\u65f6\uff0c\u6211\u4eec\u53d1\u73b0\u5de6\u53f3\u7684\u90e8\u5206\u6bcf\u4e00\u5bf9\u4f1a\u5bf9\u7cfb\u6570\u9020\u6210$2$\u7684\u8d21\u732e\uff0c\u4f46\u662f\u5bf9\u79f0\u8f74\u4e0a\u7684\u5b57\u7b26\u53ea\u4f1a\u9020\u6210$1$\u7684\u8d21\u732e\uff0c\u56e0\u6b64\u8fd9\u91cc\u9700\u8981\u5355\u72ec\u5224\u65ad\n\n\u5bf9\u4e8e`b`\u7684\u60c5\u51b5\uff0c\u540c\u6837\u5904\u7406\u5c31\u53ef\u4ee5\u4e86\n\n\u591a\u9879\u5f0f\u4e58\u6cd5\u53ef\u4ee5\u7528$\\text{FFT/NTT}$\u6765\u4f18\u5316\n\nQ\uff1a\u53d6\u6a21\u600e\u4e48FFT\u5462\uff1f\n\nA\uff1a\u6211\u4eec\u53d1\u73b0\u6700\u540e\u7684\u7cfb\u6570\u4e00\u5b9a\u662f\u5f88\u5c0f\u7684\uff0c\u53d6\u6a21\u53ea\u662f\u5728\u6c42$2^x-1$\u7684\u65f6\u5019\u9700\u8981\u53d6\u5f97\uff0c\u6240\u4ee5\u8fd9\u9053\u9898\u4e5f\u53ef\u4ee5\u5199FFT\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n# define Rep(i,a,b) for(int i=a;i<=b;i++)\n# define _Rep(i,a,b) for(int i=a;i>=b;i--)\n# define RepG(i,u) for(int i=head[u];~i;i=e[i].next)\n\ntypedef long long ll;\n\nconst int N=5e5+5;\nconst double pi=acos(-1.0);\nconst int mod=1e9+7;\n\ntemplate<typename T> void read(T &x){\n   x=0;int f=1;\n   char c=getchar();\n   for(;!isdigit(c);c=getchar())if(c=='-')f=-1;\n   for(;isdigit(c);c=getchar())x=(x<<1)+(x<<3)+c-'0';\n    x*=f;\n}\n\nint n;\nchar s[N],t[N];\nint pos[N],sum[N];\nint hw[N];\nint ans;\n\nstruct cp{\n\tdouble real,imag;\n\tcp(double a=0.0,double b=0.0){real=a,imag=b;}\t\n}a[N],c[N];\n\ncp operator + (cp a,cp b){return cp(a.real+b.real,a.imag+b.imag);}\ncp operator - (cp a,cp b){return cp(a.real-b.real,a.imag-b.imag);}\ncp operator * (cp a,cp b){return cp(a.real*b.real-a.imag*b.imag,a.real*b.imag+a.imag*b.real);}\n\nint Qpow(int base,int ind){\n\tint res=1;\n\twhile(ind){\n\t\tif(ind&1)res=1ll*res*base%mod;\n\t\tbase=1ll*base*base%mod;\n\t\tind>>=1;\n\t}\n\treturn res;\n}\n\nvoid fft(int limit,cp *a,int opt){\n\tfor(int i=0;i<limit;i++)c[i]=a[pos[i]];\n\tfor(int i=0;i<limit;i++)a[i]=c[i];\n\tfor(int i=1;i<limit;i<<=1){\n\t\tint len=i<<1;\n\t\tcp z0(cos(pi/i),opt*sin(pi/i));\n\t\tfor(int j=0;j<limit;j+=len){\n\t\t\tcp z(1.0,0.0);\n\t\t\tfor(int k=0;k<i;k++,z=z*z0){\n\t\t\t\tcp x=a[j+k],y=z*a[j+k+i];\n\t\t\t\tc[j+k]=x+y;\n\t\t\t\tc[j+k+i]=x-y;\n\t\t\t}\n\t\t}\n\t\tfor(int j=0;j<limit;j++)a[j]=c[j];\n\t}\n}\n\nvoid manacher(){\n\tint maxright=0,mid;\n\tRep(i,1,n){\n\t\tif(i<maxright)hw[i]=min(hw[(mid<<1)-i],mid+hw[mid]-i);\n\t\telse hw[i]=1;\n\t\tfor(;t[i-hw[i]]==t[i+hw[i]];hw[i]++);\n\t\tif(hw[i]+i>maxright){\n\t\t\tmaxright=hw[i]+i;\n\t\t\tmid=i;\t\n\t\t}\n\t}\n}\n\nint main()\n{\n\tscanf(\"%s\",s);\n\tn=strlen(s);\n\tint limit=1;\n\twhile(limit<=2*n)limit<<=1;\n\tfor(int i=1;i<limit;i<<=1)for(int j=0;j<i;j++)pos[i+j]=pos[j]+limit/i/2;\n\t\n\tfor(int i=0;i<limit;i++)a[i]=cp(s[i]=='a'?1.0:0.0,0.0);\n\tfft(limit,a,1);\n\tfor(int i=0;i<limit;i++)a[i]=a[i]*a[i];\n\tfft(limit,a,-1);\n\tfor(int i=0;i<limit;i++)sum[i]+=(int)(a[i].real/limit+0.5);\n\t\n\tfor(int i=0;i<limit;i++)a[i]=cp(s[i]=='b'?1.0:0.0,0.0);\n\tfft(limit,a,1);\n\tfor(int i=0;i<limit;i++)a[i]=a[i]*a[i];\n\tfft(limit,a,-1);\n\tfor(int i=0;i<limit;i++)sum[i]+=(int)(a[i].real/limit+0.5);\n\t\n\tfor(int i=0;i<limit;i++)if(sum[i]&1)sum[i]++;\n\tfor(int i=0;i<limit;i++)sum[i]>>=1;\n\tfor(int i=0;i<2*n;i++)ans+=Qpow(2,sum[i])-1,ans%=mod;\n\t\n\tint tot=0;\n\tt[0]='#';\n\tfor(int i=0;i<n;i++){\n\t\tt[++tot]='#';\n\t\tt[++tot]=s[i];\t\n\t}\n\tt[++tot]='#';\n\tn=tot;\n\tmanacher();\n\t\n\tRep(i,1,n)if(hw[i]>1)ans=(ans-(((hw[i]-2)>>1)+1)+mod)%mod;\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1596096924,
        "uid": 97344,
        "name": "devout",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4199 \u3010\u4e07\u5f84\u4eba\u8e2a\u706d\u3011"
    },
    {
        "content": "### [\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P4199)\n\n## \u9898\u610f\u7b80\u8ff0\n\n- \u7ed9\u5b9a\u53ea\u5305\u542b $\\texttt{a b}$ \u4e24\u79cd\u5b57\u7b26\u7684\u5b57\u7b26\u4e32\u3002\n\n- \u6c42\u6709\u591a\u5c11\u4e2a**\u5b50\u5e8f\u5217**\u6ee1\u8db3\u5b57\u6bcd\u548c\u5750\u6807\u90fd\u5173\u4e8e\u67d0\u70b9\u5bf9\u79f0\uff0c\u4e14**\u4e0d\u662f\u5b50\u4e32**\u3002 \n\n## SOL\n\n$n \\le 1e5$ \u90a3\u5c31\u5dee\u4e0d\u591a\u662f $O(nlogn)$ \u4e86qwq\u3002\n\n\u53bb\u9664\u56de\u6587\u5b50\u4e32\u53ef\u4ee5\u76f4\u63a5 $\\mathcal{manacher}$ \u3002\n\n```cpp\nvoid manacher(){\n\tll maxn=-1,id,mm=0;\n\tfor(ll i=1;i<=(n<<1)+1;i++){\n\t\tif(i>=mm) p[i]=1;\n\t\telse p[i]=min(p[2*id-i],mm-i);\n\t\twhile(x[i-p[i]]==x[i+p[i]]) p[i]++;\n\t\tif(mm<i+p[i]) mm=p[i]+i,id=i;\n\t}\n}\n```\n\n\u90a3\u6211\u4eec\u5c31\u89e3\u51b3\u4e86\u90e8\u5206\u4e86qwq\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u53ea\u9700\u89e3\u51b3\u56de\u6587**\u5b50\u5e8f\u5217**\u5566qwq\u3002\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u5bf9\u4e8e**\u6bcf\u4e2a\u4f4d\u7f6e**\u5bf9\u79f0\u7684\u5b50\u5e8f\u5217\u3002\n\n\u5bf9\u4e8e $str_i$ \uff0c\u82e5\u6709 $a_i$ \u4e2a $str_{i-j}=str_{i+j}(1 \\le j < i)$ \uff0c\u5219\u5bf9\u7b54\u6848\u8d21\u732e\u6709 $2^{a_i+1}-1$\u3002\n\n\u8fd9\u4e2a\u5c31\u5f88\u597d\u89e3\u91caqwq\u3002\uff08\u53cd\u6b63\u4f60\u4eec\u90fd\u4f1a\u4e0b\u9762\u5c31\u7b80\u5355\u70b9qaq\uff09\n\n\u5305\u62ec $str_i$ \uff0c \u5171\u6709 $a_i+1$ \u4e2a\u53ef\u9009\u9879\u3002\n\n\u6bcf\u4e2a\u6709\u9009\u6216\u4e0d\u9009**\u4e24\u79cd\u72b6\u6001**\uff0c\u5219\u5171 $2^{a_i+1}$ \u79cd\u72b6\u6001\u3002\n\n**\u4e0d\u53ef\u5168\u4e0d\u9009**\uff0c\u90a3\u4e48\u5c31\u662f $2^{a_i+1}-1$ \u5566qwq\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u5feb\u901f\u5904\u7406 $str_{i-j}=str_{i+j}(1 \\le j < i)$ \u5566\u3002\n\n\u8fd9\u4e2a\u53ef\u770b\u51fa\u80fd**\u591a\u9879\u5f0f**\u641e\u5b9aqwq\u3002\n\n\u6211\u4eec\u5efa\u4e24\u4e2a\u591a\u9879\u5f0f $F$ $G$\u3002\n\n\u5bf9 $F$ \uff0c\u5bf9\u7b2c $i$ \u4f4d\u82e5 $str_i=\\texttt{a}$ \uff0c\u7cfb\u6570\u4e3a $1$ \uff0c\u5426\u5219\u4e3a $0$\u3002\n\n\u5bf9 $G$ \uff0c\u5bf9\u7b2c $i$ \u4f4d\u82e5 $str_i=\\texttt{b}$ \uff0c\u7cfb\u6570\u4e3a $1$ \uff0c\u5426\u5219\u4e3a $0$\u3002\n\n$F$ $G$ \u81ea\u4e58\uff0c\u5219\u53ef\u5f97\u5230\u65b0\u591a\u9879\u5f0f\u6bcf\u9879\u7cfb\u6570qwq\u3002\n\n\u6211\u4eec\u628a\u4e24\u9879\u52a0\u8d77\u6765\u3002\n\n\u5bf9\u65b0\u7cfb\u6570 $b_i$ \uff0c\u610f\u4e49\u4e3a\u5bf9 $str_{\\frac{i}{2}}$ \u4f4d\uff0c\u6709 $b_i$ \u7ec4\u5173\u4e8e\u5176\u5bf9\u79f0\uff08\u5f53\u7136\uff0c**\u5305\u62ec\u4e86\u81ea\u5df1**qwq\uff09\u3002\n\n\u4f46 $\\dfrac{i}{2}$ \u4e0d\u4e00\u5b9a\u4e3a\u6574\u6570\uff0c\u90a3\u6211\u4eec\u5c31\u5bf9\u5947\u5076\u5904\u7406\u4e0b\u5373\u53efqwq\u3002\n\n\u6700\u540e\u624b\u6253\u5feb\u901f\u5e42\u5373\u53efqwq\u3002\n\n```cpp\n/*\n***\n\u8fd8\u8981\u7ee7\u7eed\u52aa\u529b\n\u6210\u4e3a\u4e00\u540d\u70e4\u5495\u5b66\u5bb6\u54e6\n***\n*/\n#include<bits/stdc++.h>\n#define pi 3.141592653589793\nusing namespace std;\ntypedef long long ll;\nconst ll N=4e5+5,mod=1e9+7;\nll n,m,rev[N],t,lim=1,l=-1,s[N],ans[N],x[N],p[N],sum;\nchar str[N];\nstruct pol{\n\tdouble x,y;\n\tpol(double x=0,double y=0):x(x),y(y){}\n\tinline pol operator + (const pol b) const{return pol(x+b.x,y+b.y);}\n\tinline pol operator - (const pol b) const{return pol(x-b.x,y-b.y);}\n\tinline pol operator * (const pol b) const{\n\t\tpol res;\n\t\tres.x=x*b.x-y*b.y;\n\t\tres.y=x*b.y+y*b.x;\n\t\treturn res;\n\t}\n}F[N],G[N];\ntemplate <typename T> void rd(T &x){\n\tll fl=1;x=0;char c=getchar();\n\tfor(;!isdigit(c);c=getchar()) if(c=='-') fl=-fl;\n\tfor(;isdigit(c);c=getchar()) x=(x<<3)+(x<<1)+c-'0';\n\tx*=fl;\n}\nvoid wr(ll x){\n\tif(x<0) x=-x,putchar('-');\n\tif(x<10) putchar(x+'0');\n\tif(x>9) wr(x/10),putchar(x%10+'0');\n}\ninline void FFT(pol *a,ll op,ll lim){\n\tfor(ll i=1;i<=lim;i++){\n\t\tif(i>=rev[i]) continue;\n\t\tswap(a[i],a[rev[i]]);\n\t}\n\tpol rt,w,x,y;\n\tfor(ll mid=1;mid<lim;mid<<=1){\n\t\tll r=mid<<1;\n\t\trt=pol(cos(pi/mid),op*sin(pi/mid));\n\t\tfor(ll j=0;j<lim;j+=r){\n\t\t\tw=pol(1,0);\n\t\t\tfor(ll k=0;k<mid;k++){\n\t\t\t\tx=a[j|k];y=w*a[j|k|mid];\n\t\t\t\ta[j|k]=x+y;a[j|k|mid]=x-y;\n\t\t\t\tw=w*rt;\n\t\t\t}\n\t\t}\n\t}\n\tif(op==1) return;\n\tfor(ll i=0;i<=lim;i++) a[i].x=a[i].x/lim,a[i].y=a[i].y/lim;\n}\nvoid manacher(){\n\tll maxn=-1,id,mm=0;\n\tfor(ll i=1;i<=(n<<1)+1;i++){\n\t\tif(i>=mm) p[i]=1;\n\t\telse p[i]=min(p[2*id-i],mm-i);\n\t\twhile(x[i-p[i]]==x[i+p[i]]) p[i]++;\n\t\tif(mm<i+p[i]) mm=p[i]+i,id=i;\n\t}\n}\nll pw(ll x,ll y){\n\tll sum=1;\n\twhile(y){\n\t\tif(y&1) sum=sum*x%mod;\n\t\tx=x*x%mod;y>>=1;\n\t}\n\treturn sum%mod;\n}\nint main(){\n//\tfreopen(\".in\",\"r\",stdin);\n//\tfreopen(\".out\",\"w\",stdout);\n\tscanf(\"%s\",str);n=strlen(str);\n\tfor(ll i=0;i<n;i++) s[i+1]=(str[i]=='a');\n\tfor(ll i=1;i<=(n<<1)+1;i++)\n\t\tif(i&1) x[i]=2;\n\t\telse x[i]=s[i>>1];\n\tx[0]=-1,x[(n+1)<<1]=-2;\n\twhile(lim<=(n<<1)) lim<<=1,l++;\n\tfor(ll i=1;i<=lim;i++) rev[i]=(rev[i>>1]>>1)|((i&1)<<l);\n\tfor(ll i=1;i<=n;i++) F[i].x=F[i].y=s[i],G[i].x=G[i].y=(s[i]^1);\n\tFFT(F,1,lim);FFT(G,1,lim);\n\tfor(ll i=0;i<=lim;i++) F[i]=F[i]*F[i],G[i]=G[i]*G[i];\n\tFFT(F,-1,lim);FFT(G,-1,lim);\n\tfor(ll i=1;i<=(n<<1)+1;i++) ans[i]+=((ll)(F[i].y/2+0.5)-((i&1)^1))+((ll)(G[i].y/2+0.5)-((i&1)^1));\n\tfor(ll i=1;i<=(n<<1)+1;i++) ans[i]=((ans[i]+((i&1)^1))>>1)+((i&1)^1);\n\tfor(ll i=1;i<=(n<<1)+1;i++) ans[i]=(pw(2,ans[i])+mod-1)%mod;\n\tmanacher();\n\tfor(ll i=1;i<=(n<<1)+1;i++) ans[i]=(ans[i]-(p[i]>>1))%mod;\n\tfor(ll i=1;i<=(n<<1)+1;i++) sum=(sum+ans[i])%mod;\n\twr(sum);puts(\"\");\n\treturn 0;\n}\n```\n\n$\\mathcal{manacher}$ \u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$ \u7a7a\u95f4\u590d\u6742\u5ea6 $O(n)$ ~~\u7ebf\u6027\u597d\u8bc4~~\n\n$\\mathcal{FFT}$ \u65f6\u95f4\u590d\u6742\u5ea6 $O(nlogn)$ \u7a7a\u95f4\u590d\u6742\u5ea6 $O(n)$\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(nlogn)$ \u7a7a\u95f4\u590d\u6742\u5ea6 $O(n)$\n\n\u5b81\u5207\u4e86qwq",
        "postTime": 1593067025,
        "uid": 83999,
        "name": "Demoe",
        "ccfLevel": 7,
        "title": "\u4e07\u5f84\u4eba\u8e2a\u706d\u9898\u89e3 FFT+manacher"
    },
    {
        "content": "\u4e0d\u8fde\u7eed\u7684\u56de\u6587\u4e32\u6570\u91cf=\u6240\u6709\u7684\u56de\u6587\u5e8f\u5217\u6570\u91cf-\u8fde\u7eed\u7684\u56de\u6587\u5b50\u4e32\n\n\u8fde\u7eed\u7684\u56de\u6587\u5b50\u4e32\uff1a\n\nmanacher \u5f97\u5230\u7684\u4ee5i\u4e3a\u4e2d\u5fc3\u7684\u8fde\u7eed\u56de\u6587\u4e32\u6570\u91cf=\u4ee5i\u4e3a\u4e2d\u5fc3\u7684\u6700\u957f\u56de\u6587\u534a\u5f84\u957f\u5ea6\n\n\u6240\u6709\u7684\u56de\u6587\u5e8f\u5217\uff1a\n\n\u5c06a\u770b\u505a1\uff0cb\u770b\u505a0\uff0c\u81ea\u5df1\u8ddf\u81ea\u5df1\u505a\u4e00\u904dfft\n\n\u5f97\u5230\u7684a[i]\u5c31\u662f\u4ee5i/2\u4e3a\u4e2d\u5fc3\u7684\u7531a\u6784\u6210\u7684\u6700\u957f\u56de\u6587\u5e8f\u5217\u957f\u5ea6\n\n\u5c06a\u770b\u505a0\uff0cb\u770b\u505a1\uff0c\u81ea\u5df1\u8ddf\u81ea\u5df1\u505a\u4e00\u904dfft\n\n\u5f97\u5230\u7684b[i]\u5c31\u662f\u4ee5i/2\u4e3a\u4e2d\u5fc3\u7684\u7531b\u6784\u6210\u7684\u6700\u957f\u56de\u6587\u5e8f\u5217\u957f\u5ea6\n\n\u56e0\u4e3a\u53ef\u4ee5\u4e0d\u8fde\u7eed\uff0c\u6240\u4ee5\u6bcf\u4e00\u5bf9\u4ee5i\u4e3a\u4e2d\u5fc3\u7684\u5bf9\u79f0\u4f4d\u7f6e\u8981\u4e48\u540c\u65f6\u9009\uff0c\u8981\u4e48\u540c\u65f6\u4e0d\u9009\n\n\u6240\u4ee5\u4ee5i\u4e3a\u4e2d\u5fc3\u7684\u56de\u6587\u5e8f\u5217\u6570\u91cf=2^\uff08f[i]/2  [\u4e0a\u53d6\u6574]\uff09-1\n\n\n```\n#include<cmath>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n\nusing namespace std;\n\nconst int N=(1<<18)+2;\n\nconst double pi=acos(-1);\n\nconst int mod=1e9+7;\n\nchar s[N];\nint n;\n\nstruct Complex\n{\n    double x,y;\n    Complex(double x_=0,double y_=0):x(x_),y(y_){}\n    Complex operator + (Complex P)\n    {\n        return Complex(x+P.x,y+P.y);\n    }\n    Complex operator - (Complex P)\n    {\n        return Complex(x-P.x,y-P.y);\n    }\n    Complex operator * (Complex P)\n    {\n        return Complex(x*P.x-y*P.y,x*P.y+y*P.x);\n    }\n};\ntypedef Complex E;\n\nE a[N],b[N];\nint rev[N];\nint f[N];\n\nchar t[N];\nint p[N];\n\nint Pow(int a,int b)\n{\n    int res=1;\n    for(;b;b>>=1,a=1LL*a*a%mod)\n        if(b&1) res=1LL*res*a%mod;\n    return res;\n}\n\nvoid fft(E *a,int len,int tag)\n{\n    for(int i=0;i<len;++i)\n        if(i<rev[i]) swap(a[i],a[rev[i]]);\n    for(int i=1;i<len;i<<=1)\n    {\n        E wn(cos(pi/i),tag*sin(pi/i));\n        for(int p=i<<1,j=0;j<len;j+=p)\n        {\n            E w(1,0);\n            for(int k=0;k<i;++k,w=w*wn)\n            {\n                E x=a[j+k],y=a[j+k+i]*w;\n                a[j+k]=x+y; a[j+k+i]=x-y;\n            }\n        }\n    }\n    if(tag==-1)\n    {\n        for(int i=0;i<len;++i) a[i].x=(a[i].x+0.5)/len;\n    }\n}\n\nint solve_all()\n{\n    for(int i=0;i<n;++i) \n        if(s[i]=='a') a[i].x+=1; else b[i].x=1;\n    int num=n*2-1,len=1,bit=0;\n    while(len<num) len<<=1,bit++;\n    for(int i=0;i<len;++i) rev[i]=(rev[i>>1]>>1)|((i&1)<<bit-1);\n    fft(a,len,1); \n    for(int i=0;i<len;++i) a[i]=a[i]*a[i];\n    fft(a,len,-1);\n    fft(b,len,1);\n    for(int i=0;i<len;++i) b[i]=b[i]*b[i];\n    fft(b,len,-1);\n    for(int i=0;i<len;++i) f[i]=a[i].x+b[i].x;\n    int sum=0;\n    for(int i=0;i<len;++i) \n    {\n        sum+=Pow(2,f[i]+1>>1)-1;\n        sum-=sum>=mod ? mod : 0;\n    }\n    return sum;\n}\n\nvoid manacher(int m)\n{\n    int id=0,pos=0,x=0;\n    for(int i=1;i<=m;++i)\n    {\n        if(pos>i) x=min(p[id*2-i],pos-i);\n        else x=1;\n        while(t[i-x]==t[i+x]) x++;\n        if(i+x>pos) pos=i+x,id=i;\n        p[i]=x;\n    }\n}\n\nint solve_continuous()\n{\n    int m=0;\n    t[m]='!';\n    for(int i=0;i<n;++i)\n    {\n        t[++m]='#';\n        t[++m]=s[i];\n    }\n    t[++m]='#';\n    t[m+1]='@';\n    manacher(m);\n    int sum=0;\n    for(int i=1;i<=m;++i)\n    {\n        sum+=p[i]>>1;\n        sum-=sum>=mod ? mod : 0;\n    }\n    return sum;\n}\n\nint main()\n{\n    scanf(\"%s\",s);\n    n=strlen(s);\n    int t1=solve_all();\n    int t2=solve_continuous();\n    printf(\"%d\",(t1-t2+mod)%mod);\n}\n```\n",
        "postTime": 1561341172,
        "uid": 111289,
        "name": "Ryan_",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P4199 \u3010\u4e07\u5f84\u4eba\u8e2a\u706d\u3011"
    }
]