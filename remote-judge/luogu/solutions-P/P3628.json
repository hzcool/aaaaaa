[
    {
        "content": "\u659c\u7387\u4f18\u5316DP\n\n\u627e\u659c\u7387\u5f0f\u7684\u65b9\u6cd5\u8fd8\u53ef\u4ee5\u628adp\u65b9\u7a0b\u5316\u4e3akx+b=y\u7684\u4e00\u6b21\u51fd\u6570\u5f62\u5f0f\u3002\n\n\u53c2\u8003\u8d44\u6599:http://www.cnblogs.com/MashiroSky/p/6009685.html\n\n\u663e\u7136\u5148\u9884\u5904\u7406\u524d\u7f00\u548c$s(i)=\\sum_{k=1}^ix_i$\n\n\u8bbe$d(i)$\u4e3a\u5c06\u524d$i$\u4e2a\u58eb\u5175\u5206\u7ec4\u7684\u6700\u5927\u4fee\u6b63\u540e\u6218\u6597\u529b\u3002\n\n$d(i)=max\\{\\ d(j)+a(s(i)-s(j))^2+b(s(i)-s(j))+c\\ \\}$\n\n$d(i)=max\\{\\ d(j)+a\\times s(i)^2-2a\\times s(i)s(j)+a\\times s(j)^2+b\\times s(i)-b\\times s(j)+c\\ \\}$\n\n$d(i)=max\\{\\ d(j)-2a\\times s(i)s(j)+a\\times s(j)^2-b\\times s(j)\\ \\}+a\\times s(i)^2+b\\times s(i)+c$\n\n\u8bbe\n$K_i=2a\\times s(i)$\n\n$X_j=s(j)$\n\n$B_i=d(i)-a\\times s(i)^2-b\\times s(i)-c$\n\n$Y_j=d(j)+a\\times s(j)^2-b\\times s(j)$\n\n\u76f4\u7ebf\u89e3\u6790\u5f0f\u4e3a$K_iX_j+B_i=Y_j$\u5176\u4e2d\u659c\u7387$K_i$\u5355\u51cf,$X_j$\u5355\u589e\u3002\n\n\u8981\u6c42$d(i)$\u6700\u5927\u5373\u6c42$B_i$\u6700\u5927\uff0c\u7ed3\u5408\u56fe\u50cf\u53ef\u5f97\u6700\u4f18\u70b9$(X_j,Y_j)$\u4e00\u5b9a\u5728\u4e0a\u51f8\u5305\u4e0a\u3002\n\n\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e0a\u51f8\u5305\u5373\u53ef\u3002\n\n**\u4ee3\u7801**\n\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#define k(A) (2*a*s[A])\n#define x(A) s[A]\n#define b(A) (d[A]-a*s[A]*s[A]-b*s[A]-c)\n#define y(A) (d[A]+a*s[A]*s[A]-b*s[A])\nusing namespace std;\nconst int maxn=1000010;\nlong long d[maxn],s[maxn];\nint q[maxn],n,a,b,c;\ndouble slope(int i,int j){\n    return 1.0*(y(i)-y(j))/(x(i)-x(j));\n}\nint main(){\n    cin>>n>>a>>b>>c;\n    s[0]=q[0]=d[0]=0;\n    for(int i=1;i<=n;i++){\n        int x;\n        scanf(\"%d\",&x);\n        s[i]=s[i-1]+x;\n    }\n    int head=0,tail=0;\n    for(int i=1;i<=n;i++){\n        while(head<tail&&slope(q[head],q[head+1])>k(i)) head++;\n        d[i]=-(k(i)*x(q[head])-y(q[head])-a*s[i]*s[i]-b*s[i]-c);\n        while(head<tail&&slope(q[tail-1],q[tail])<=slope(q[tail],i)) tail--;\n        q[++tail]=i;\n    }\n    cout<<d[n]<<endl;\n}\n    \n```",
        "postTime": 1502812126,
        "uid": 26556,
        "name": "VSEJGFB",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "# \t  \t\t\u7279\u522b\u884c\u52a8\u961f\uff08\u659c\u7387\u4f18\u5316DP\uff09\n### \u9996\u5148\u6211\u4eec\u9884\u5904\u7406\u4e00\u4e2a\u524d\u7f00\u548cs[i],s[i]\u8868\u793a1~i\u7684x[i]\u7684\u548c\uff1b\n\ndp\u65b9\u7a0b$f[i]$\u8868\u793a\u5bf9\u4e8e1~i\u7684\u6240\u6709$x[i]$,\u5df2\u7ecf\u5206\u597d\u7ec4\u7684\u6700\u5927\u548c\n### \u5bf9\u4e8e50\u5206\u7684\u505a\u6cd5\u6211\u4eec\u76f4\u63a5O\uff08n^2\uff09\u7684\u679a\u4e3e\u5f53\u524d\u7684i\u662f\u4ece\u54ea\u4e00\u4e2aj\u8f6c\u79fb\u8fc7\u6765\u7684\u5373\u53ef$f[i]=max{f[j]+a*(s[i]-s[j])^2+b*(s[i]-s[j])+c}$\n\n### \u5bf9\u4e8e100\u5206\u7684\u505a\u6cd5 \u8003\u8651\u659c\u7387\u4f18\u5316\u5047\u8bbej\u6bd4k\u66f4\u4f18\u90a3\u4e48\n$f[j]+a*(s[i]-s[j])^2+b*(s[i]-s[j])+c > f[k]+a*(s[i]-s[k])^2+b*(s[i]-s[k])+c$\n\n\n\u62c6\u5f00\u5f97 $f[j]+a*s[i]^2+2*s[i]*s[j]+a*s[j]^2+b*s[i]-b*s[j] > f[k]+a*s[i]^2+2*s[i]*s[k]+a*s[k]^2+b*s[i]-b*s[k]$\n\n\u79fb\u9879\u5f97 $2*a*s[i](s[j]-s[k])> f[k]- f[j]+ b*s[j] - b*s[k] +a * s[k]^2 -a * s[j]^2$\n\n\u5c06\u5de6\u8fb9\u9664\u8fc7\u53bb\u5f97 $s[i]>(f[k]- f[j]+ b*s[j] - b*s[k] +a * s[k]^2 -a * s[j]^2)/((s[j]-s[k])*2*a)$\n\n\u4ee5\u4e0a\u662f\u53c8\u6765\u5224\u65ad\u961f\u9996\u548c\u4e0d\u5408\u6cd5\u7684 \uff1b\n\n### \u63a5\u4e0b\u6765\u5f00\u59cb\u6784\u9020\u76f4\u7ebf\u89e3\u6790\u5f0f \n\u4ee5\u4e0b\u53c2\u8003 [ VSEJGFB](https://www.luogu.org/problemnew/solution/P3628)\n\n\u5047\u8bbef[i]\u662f\u7531f[j]\u8f6c\u79fb\u8fc7\u6765\u7684 \u90a3\u4e48 $f[i]=max{f[j]+a*(s[i]-s[j])^2+b*(s[i]-s[j])+c}$\n\n$f[i]=max{ f[j]+a*s[i]^2+2*a*s[i]*s[j]+a*s[j]^2+b*s[i]-b*s[j] }$\n\n$f[i]=max{\tf[j]+2*s[i]*s[j]++a*s[j]^2-b*s[j] }+a*s[i]^2+b*s[i]+c ;$\n\n\u5f00\u59cb\u6784\u9020\u76f4\u7ebf\u89e3\u6790\u5f0f\u662f$y = k * x + b $\u7684\u5f62\u5f0f\n\nx \u662f\u81ea\u53d8\u91cf \u663e\u7136\u5e94\u8be5\u662f$ s[j]$\n\n$  y = f[j] - a * s[j]^2 -b*s[j] -c $\n \n$b$\u662f\u76f4\u7ebf\u7684\u622a\u8ddd \u53e6$ b =  f[i] - a * s[i]^2 -b*s[i]-c$\n\n\u7531\u4e8e$a<0 $\u6240\u4ee5\u76f4\u7ebf\u7684\u659c\u7387\u80af\u5b9a\u662f\u8d1f\u7684 \u90a3\u4e48\u6211\u4eec\u5c31\u7ef4\u62a4\u4e00\u4e2a\u4e0a\u51f8\u58f3\n\n![flag](https://i.loli.net/2018/10/16/5bc5928f91b0b.png)\n\n\n### \u4ee5\u4e0b\u9644\u4e0a\u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<algorithm>\n#include<cstring>\n#include<queue>\n#include<cmath>\n#define N 1000050\n#define int long long\nusing namespace std;\nint a,b,c,n,l,r;\nint d[N],s[N],f[N],q[N];\ndouble pd(int j,int k){\n    return double( (f[j]-f[k]+a*(s[j]*s[j]-s[k]*s[k])+b*(s[k]-s[j]))/double(2*a*(s[j]-s[k])) );\n}\nsigned main(){\n    scanf(\"%lld%lld%lld%lld\",&n,&a,&b,&c);\n    for(int i=1;i<=n;i++){\n        scanf(\"%lld\",&d[i]);s[i]=s[i-1]+d[i];\n    }l=1,r=1;\n    for(int i=1;i<=n;i++){\n        while(l<r&&pd(q[l],q[l+1])<=s[i]*1.0)l++;\n        int j=q[l],x=s[i]-s[j];\n        f[i]=f[j]+a*x*x+b*x+c;\n        while(l<=r&&pd(q[r-1],q[r])>=pd(q[r],i))r--;\n        q[++r]=i;\n    }\n    printf(\"%lld\",f[n]);\n}\n\n```\n\n",
        "postTime": 1539257394,
        "uid": 87938,
        "name": "yunsk",
        "ccfLevel": 0,
        "title": "\u7279\u522b\u884c\u52a8\u961f"
    },
    {
        "content": "[\u5982\u679c\u516c\u5f0f\u6302\u4e86\u5230CSDN\u4e0a\u53bb\u770b](http://blog.csdn.net/qq\\_30974369/article/details/78308761)\n\n\u53c8\u662f\u4e00\u9053\u659c\u7387\u4f18\u5316\u7684DP\u9898\u76ee\n\n\u9996\u5148\u8fd8\u662f\u5199\u51fa\u4e00\u4e2a$O(n^{2})$\u7684DP\n\n```cpp\n    for(int i=1;i<=n;++i)\n        for(int j=0;j<i;++j)\n            f[i]=max(f[i],f[j]+F(c[i]-c[j]));\n\n```\n\u5176\u4e2d$F(x)$\u662f\u9898\u76ee\u4e2d\u7684\u4e8c\u6b21\u51fd\u6570$c[i]$\u662f\u524d\u7f00\u548c\n\n\u8fd8\u662f\u548c\u4e4b\u524d\u662f\u4e00\u6837\u7684\n\n\u5047\u8bbe$j$\u7684\u8f6c\u79fb\u4f18\u4e8e$k$\n\n\u90a3\u4e48\u5c31\u6709\n\n$$f[j]+F(c[i]-c[j])>f[k]+F(c[i]-c[k])$$\n\n\u53c8\u6709\n$$F(x)=Ax^{2}+Bx+C$$\n\n\u76f4\u63a5\u5e26\u5165\u5f97\u5230\n\n$$f[j]+A(c[i]-c[j])^{2}+B(c[i]-c[j])+C$$\n\n\u53f3\u8fb9\u540c\u7406\n\n\u7136\u540e\u4e24\u8fb9\u540c\u65f6\u51cf\u6389\u4e00\u90e8\u5206\u5f97\n\n$$f[j]+Ac[j]^{2}-2Ac[i]c[j]-Bc[j]>f[k]+Ac[k]^{2}-2Ac[i]c[k]-Bc[k]$$\n\n\u79fb\u9879\u5f97\u5230\n\n$$2Ac[i](c[j]-c[k])<(f[j]+Ac[j]^{2}-Bc[j])-(f[k]+Ac[k]^{2}-Bc[k])$$\n\n\u9664\u8fc7\u53bb\u641e\u4e00\u4e0b\n\n$$c[i]<\\frac{(f[j]+Ac[j]^{2}-Bc[j])-(f[k]+Ac[k]^{2}-Bc[k])}{2A(c[j]-c[k])}$$\n\n\u7136\u540e\u5c31\u53ef\u4ee5[\u659c\u7387\u4f18\u5316](http://blog.csdn.net/qq\\_30974369/article/details/78306743)\u76f4\u63a5\u641e\u4e86\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\n#include<set>\n#include<map>\n#include<vector>\nusing namespace std;\n#define ll long long\n#define MAX 1010000\ninline int read()\n{\n    int x=0,t=1;char ch=getchar();\n    while((ch<'0'||ch>'9')&&ch!='-')ch=getchar();\n    if(ch=='-')t=-1,ch=getchar();\n    while(ch<='9'&&ch>='0')x=x*10+ch-48,ch=getchar();\n    return x*t;\n}\nll A,B,C;\nll n,c[MAX];\nll F(ll x){return 1LL*A*x*x+1LL*B*x+C;}\nll f[MAX];\nll s[MAX],h,t;\nll sqr(ll x){return x*x;}\ndouble count(ll j,ll k)\n{\n    return ((f[j]-B*c[j]+A*sqr(c[j]))-(f[k]-B*c[k]+A*sqr(c[k])))/(2.0*A*(c[j]-c[k]));\n}\nint main()\n{\n    n=read();A=read();B=read();C=read();\n    for(int i=1;i<=n;++i)c[i]=c[i-1]+read();\n    for(int i=1;i<=n;++i)f[i]=-1e18;\n    /*\n    for(int i=1;i<=n;++i)\n        for(int j=0;j<i;++j)\n            f[i]=max(f[i],f[j]+F(c[i]-c[j]));\n    */\n    for(int i=1;i<=n;++i)\n    {\n        while(h<t&&count(s[h],s[h+1])<=c[i]*1.0)h++;\n        int get=s[h];\n        f[i]=f[get]+F(c[i]-c[get]);\n        while(h<t&&count(s[t-1],s[t])>=count(s[t],i))t--;\n        s[++t]=i;\n    }\n    printf(\"%lld\\n\",f[n]);\n    return 0;\n}\n\n\n```",
        "postTime": 1508641845,
        "uid": 21283,
        "name": "yybyyb",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "\u5b89\u5229\u849f\u84bb[\u659c\u7387\u4f18\u5316\u603b\u7ed3](https://www.cnblogs.com/flashhu/p/9480669.html)\n\n\u7531\u4e8e\u4eba\u662f\u6bcf\u6b21\u90fd\u662f\u8fde\u7eed\u4e00\u6bb5\u4e00\u6bb5\u5730\u9009\uff0c\u6240\u4ee5\u8003\u8651\u76f4\u63a5\u5bf9$x$\u8bb0\u524d\u7f00\u548c\uff0c\u8bbe\u73b0\u5728\u7684$x_i=$\u539f\u6765\u7684$\\sum\\limits_{j=1}^ix_i$\u3002\n\n\u8bbe$f_i$\u4e3a\u5b89\u6392\u524d$i$\u4e2a\u4eba\u7684\u6700\u5927\u503c$(f_0=0)$\n\n$f_i=\\max\\limits_{j=0}^{i-1}\\{f_j+a(x_i-x_j)^2+b(x_i-x_j)+c\\}$\n$\\quad=\\max\\limits_{j=0}^{i-1}\\{f_j-2ax_ix_j+ax_j^2-bx_j\\}+ax_i^2+bx_i+c$\n\n\u51b3\u7b56$j$\u6bd4$k$\u4f18\u5f53\u4e14\u4ec5\u5f53\n\n$$f_j-2ax_ix_j+ax_j^2-bx_j\\ge f_k-2ax_ix_k+ax_k^2-bx_k$$\n\n$$\\frac{f_j+ax_j^2-bx_j-(f_k+ax_k^2-bx_k)}{x_j-x_k}\\ge 2ax_i$$\n\n\u4e8e\u662f\u6bcf\u4e2a\u51b3\u7b56\u53ef\u4ee5\u770b\u6210\u662f\u4e00\u4e2a\u70b9$(x_i,y_i)(y_i=f_i+ax_i^2-bx_i)$\n\n\u4e0d\u7528\u8003\u8651\u53d8\u53f7\u3002\u56e0\u4e3a$a<0$\uff0c$x_i$\u9012\u589e\uff0c\u659c\u7387$2ax_i$\u9012\u51cf\uff0c\u6240\u4ee5\u6211\u4eec\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u5305\u5c31\u884c\u4e86\u3002\u4f9d\u65e7\u662f\u7ef4\u62a4\u961f\u9996\u4e3a\u5f53\u524d\u6700\u4f18\u89e3\u3002\n\n\u5f53\u7136\u6ce8\u610f\u8fd9\u91cc\u7684\u8f6c\u79fb\u662f\u4ece$0$\u5230$i-1$\uff0c\u6240\u4ee5\u548c\u571f\u5730\u5f81\u7528\u6709\u70b9\u70b9\u4e0d\u4e00\u6837\uff0c\u8981\u5148\u6c42\u51fa$f_i$\u518d\u52a0\u5165\u51b3\u7b56\u70b9$i$\u3002\n\n\u7eaf\u5929\u7136\u4ee3\u7801\n```cpp\n#include<cstdio>\n#define RG register\n#define R RG int\n#define G c=getchar()\n#define Calc(j,k) (y[j]-y[k])/(x[j]-x[k])//\u6c42\u659c\u7387\nconst int N=1e6+9;\nint q[N];\ndouble f[N],k[N],x[N],y[N];//\u53d8\u91cf\u540d\u540c\u4e0a\ninline int in(){\n\tRG char G;RG bool f=0;\n\twhile(c<'-')G;\n\tif(c=='-')f=1,G;\n\tR x=c&15;G;\n\twhile(c>'-')x=x*10+(c&15),G;\n\treturn f?-x:x;\n}\nint main(){\n\tR n=in(),i,h,t;\n\tRG double a=in(),b=in(),c=in(),now;\n\tfor(i=h=t=1;i<=n;++i){\n\t\tx[i]=x[i-1]+in();//\u524d\u7f00\u548c\n\t\tnow=2*a*x[i];//\u5f53\u524d\u659c\u7387\n\t\twhile(h<t&&k[h]>=now)++h;\n\t\tf[i]=-now*x[q[h]]+y[q[h]]+(a*x[i]+b)*x[i]+c;//\u5148\u6c42fi,\u6839\u636e\u5b9a\u4e49\u5f0f\u6c42\n\t\ty[i]=f[i]+(a*x[i]-b)*x[i];//yi\u8ddf\u7740\u6c42\n\t\twhile(h<t&&k[t-1]<=Calc(q[t],i))--t;//\u7ef4\u62a4\u51f8\u5305\n\t\tk[t]=Calc(q[t],i);q[++t]=i;\n\t}\n\tprintf(\"%.0lf\\n\",f[n]);\n\treturn 0;\n}\n```",
        "postTime": 1534833315,
        "uid": 61325,
        "name": "FlashHu",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "[$$\\Large\\texttt{My Blog}$$](https://hydingsy.github.io/)\n\n---\n\n## Description\n\n> \u9898\u76ee\u94fe\u63a5\uff1a[Luogu 3628](https://www.luogu.org/problemnew/show/P3628)\n\n\u4f60\u6709\u4e00\u652f\u7531 $n$ \u540d\u9884\u5907\u5f79\u58eb\u5175\u7ec4\u6210\u7684\u90e8\u961f\uff0c\u58eb\u5175\u4ece $1$ \u5230 $n$ \u7f16\u53f7\uff0c\u8981\u5c06\u4ed6\u4eec\u62c6\u5206 \u6210\u82e5\u5e72\u7279\u522b\u884c\u52a8\u961f\u8c03\u5165\u6218\u573a\u3002\u51fa\u4e8e\u9ed8\u5951\u7684\u8003\u8651\uff0c\u540c\u4e00\u652f\u7279\u522b\u884c\u52a8\u961f\u4e2d\u961f\u5458\u7684\u7f16\u53f7 \u5e94\u8be5\u8fde\u7eed\uff0c\u5373\u4e3a\u5f62\u5982 $(i,i+1,\\dots,i+k)$ \u7684\u5e8f\u5217\u3002 \u7f16\u53f7\u4e3a $i$ \u7684\u58eb\u5175\u7684\u521d\u59cb\u6218\u6597\u529b\u4e3a $x_i$ \uff0c\u4e00\u652f\u7279\u522b\u884c\u52a8\u961f\u7684\u521d\u59cb\u6218\u6597\u529b $x$ \u4e3a\u961f\u5185 \u58eb\u5175\u521d\u59cb\u6218\u6597\u529b\u4e4b\u548c\uff0c\u5373 $x=x_i+x_{i+1}+\\cdots+x_{i+k}$\u3002\n\n\u901a\u8fc7\u957f\u671f\u7684\u89c2\u5bdf\uff0c\u4f60\u603b\u7ed3\u51fa\u4e00\u652f\u7279\u522b\u884c\u52a8\u961f\u7684\u521d\u59cb\u6218\u6597\u529b $x$ \u5c06\u6309\u5982\u4e0b\u7ecf\u9a8c\u516c \u5f0f\u4fee\u6b63\u4e3a $x'$\uff1a$x'= ax^2+bx+c$\uff0c\u5176\u4e2d $a,b,c$ \u662f\u5df2\u77e5\u7684\u7cfb\u6570\uff08$a<0$\uff09\u3002 \u4f5c\u4e3a\u90e8\u961f\u7edf\u5e05\uff0c\u73b0\u5728\u4f60\u8981\u4e3a\u8fd9\u652f\u90e8\u961f\u8fdb\u884c\u7f16\u961f\uff0c\u4f7f\u5f97\u6240\u6709\u7279\u522b\u884c\u52a8\u961f\u4fee\u6b63\u540e\u6218\u6597\u529b\u4e4b\u548c\u6700\u5927\u3002\u8bd5\u6c42\u51fa\u8fd9\u4e2a\u6700\u5927\u548c\u3002\n\n\u6570\u636e\u8303\u56f4\uff1a$1\\le n\\le 10^6$\uff0c$-5\\le a\\le -1$\uff0c$\\vert b\\vert,\\vert c\\vert\\le 10^7$\uff0c$1\\le x_i\\le 100$\n\n------\n\n## Solution\n\n\u6211\u4eec\u5148\u5217\u51fa\u4e00\u4e2a\u6734\u7d20\u7684 $\\texttt{DP}$ \u65b9\u7a0b\uff0c\u5b9a\u4e49 $f_i$ \u8868\u793a\u8003\u8651\u5230\u7b2c $i$ \u4e2a\u4eba\u65f6\u7684\u6218\u6597\u529b\u4e4b\u548c\u7684\u6700\u5927\u503c\uff0c\u8bb0 $sum_i=\\sum_{k=1}^i x_k$\uff0c\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a\n\n$$f_i=\\max\\{f_j+a(sum_i-sum_j)^2+b(sum_i-sum_j)+c\\}\\quad (0\\le j<i)$$\n\n\u76f4\u63a5\u8f6c\u79fb\u7684\u590d\u6742\u5ea6\u662f $O(n^2)$ \u7684\uff0c\u7531\u4e8e\u6709\u5e73\u65b9\u9879\u8003\u8651\u659c\u7387\u4f18\u5316\u3002\n\n\u6839\u636e\u5957\u8def\uff0c\u6211\u4eec\u4efb\u53d6 $j,k$ \u4e14 $0\\le k<j<i$\uff0c\u5982\u679c $j$ \u6bd4 $k$ \u66f4\u4f18\uff0c\u90a3\u4e48\u6709\uff1a\n\n$$f_j+a(sum_i-sum_j)^2+b(sum_i-sum_j)+c\\ge f_k+a(sum_i-sum_k)^2+b(sum_i-sum_k)+c$$\n\n\u6574\u7406\u5f97\u5230\uff08\u6ce8\u610f\u9898\u76ee\u4e2d\u4fdd\u8bc1 $a<0$\uff09\uff1a\n\n$$2a\\cdot sum_i\\le \\frac{(f_j+a\\cdot{sum_j}^2-b\\cdot sum_j)-(f_k+a\\cdot{sum_k}^2-b\\cdot sum_k)}{sum_j-sum_k}$$\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u4e0d\u7b49\u5f0f\u5de6\u8fb9\u662f\u5355\u8c03\u9012\u51cf\u7684\uff0c\u53f3\u8fb9\u5206\u6bcd\u4e0a\u7684\u524d\u7f00\u548c\u662f\u5355\u8c03\u9012\u589e\u7684\u3002\n\n\u90a3\u4e48\u6211\u4eec\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e00\u4e2a**\u4e0a\u51f8\u58f3**\uff0c\u659c\u7387\u9012\u51cf\u4e14\u5747\u5c0f\u4e8e\u5f53\u524d\u7684 $2a\\cdot sum_i$\uff0c\u6bcf\u6b21\u7684\u6700\u4f18\u51b3\u7b56\u5c31\u662f\u961f\u9996\u3002\n\n**\u65f6\u95f4\u590d\u6742\u5ea6**\uff1a$O(n)$\n\n------\n\n## Code\n\n```cpp\n#include <cstdio>\n\nconst int N=1e6+5;\nint n,A,B,C,a[N],q[N];\nlong long sum[N],f[N];\n\nlong long sqr(long long x) {\n    return x*x;\n}\ndouble slope(int i,int j) {\n    return 1.0*((f[i]+1LL*A*sqr(sum[i])-1LL*B*sum[i])-(f[j]+1LL*A*sqr(sum[j])-1LL*B*sum[j]))/(sum[i]-sum[j]);\n}\nint main() {\n    scanf(\"%d%d%d%d\",&n,&A,&B,&C);\n    for(int i=1;i<=n;++i) scanf(\"%d\",&a[i]),sum[i]=sum[i-1]+a[i];\n    int l=1,r=0;\n    f[0]=q[++r]=0;\n    for(int i=1;i<=n;++i) {\n        while(l<r&&slope(q[l],q[l+1])>=2.0*A*sum[i]) ++l;\n        f[i]=f[q[l]]+1LL*A*sqr(sum[i]-sum[q[l]])+1LL*B*(sum[i]-sum[q[l]])+C;\n        while(l<r&&slope(q[r-1],q[r])<=slope(q[r],i)) --r;\n        q[++r]=i;\n    }\n    printf(\"%lld\\n\",f[n]);\n    return 0;\n}\n```\n\n",
        "postTime": 1546748918,
        "uid": 49725,
        "name": "Siyuan",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P3628)\n\n\u9898\u76ee\u5927\u610f\uff1a\n\n\u4e00\u53ea\u961f\u4f0d\u4e2d\u6709$n$\u4e2a\u58eb\u5175\uff0c\u6bcf\u4e2a\u4eba\u7684\u6218\u6597\u529b$num_i$\uff0c\u73b0\u8981\u5c06\u58eb\u5175\u5212\u5206\u4e3a\u82e5\u5e72\u7ec4\uff0c\u6bcf\u7ec4\u7684\u4eba\u4e3a\u8fde\u7eed\u7684\u4e00\u4e32\uff0c\u6574\u4e2a\u7ec4\u7684\u521d\u59cb\u6218\u6597\u529b\u6240\u6709\u4eba\u4e4b\u548c $y$,\u4fee\u6b63\u540e\u7684\u6218\u6597\u529b$y^\\prime=a\\cdot x^2+b\\cdot x+c$ ($a,b,c$\u4e3a\u5df2\u77e5\u5e38\u6570,$a<0$)\u3002\u603b\u7684\u6218\u6597\u529b\n       \u4e3a\u6240\u6709\u7ec4\u7684\u4fee\u6b63\u6218\u6597\u529b\u4e4b\u548c\u3002\u8981\u6c42\u6700\u5927\u5316\u603b\u6218\u6597\u529b\u3002($n<=10^6$)\n****\n\n\u672c\u9898\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5199\u51fa\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n\n$dp[i]=max(dp[j]+a\\cdot(\\sum_{h=j}^inum_h)^2+b\\cdot\\sum_{h=j}^inum_h+c)$\n\n**\u5bf9\u4e8e30\u5206\u505a\u6cd5\uff1a\u76f4\u63a5\u679a\u4e3e\u80fd\u591f\u8f6c\u79fb\u5230\u5f53\u524d\u7684 $i$ \u7684 $j$\uff0c\u533a\u95f4\u66b4\u529b\u52a0\u548c(\u65f6\u95f4\u590d\u6742\u5ea6$O(n^3)$)**    \n**\u5bf9\u4e8e50\u5206\u505a\u6cd5\uff1a\u9884\u5904\u7406\u51fa\u524d\u7f00\u548c\uff0c\u4ecd\u7136\u662f\u679a\u4e3e\u80fd\u8f6c\u79fb\u5230\u5f53\u524d $i$ \u7684 $j$(\u65f6\u95f4\u590d\u6742\u5ea6$O(n^2)$)**\n\n$dp[i]=max(dp[j]+a\\cdot(s[i]-s[j])^2+b\\cdot(s[i]-s[j])+c)$\n\n**\u5bf9\u4e8e100\u5206\u505a\u6cd5\uff1a\u5bf9\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u8fdb\u884c\u53d8\u5f62**\n\n\u539f\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u62ec\u53f7\u5185\u5c55\u5f00\uff1a\n\n$dp[i]=max(dp[j]+a\\cdot s[i]\\cdot s[i]-2\\cdot a\\cdot s[i]\\cdot s[j]+a\\cdot s[j]\\cdot s[j]+b\\cdot s[i]-b\\cdot s[j]+c)$\n\n\u5bf9\u4e8e\u4e24\u4e2a\u51b3\u7b56$j$\uff0c$k$ $(j>k)$\uff1a\n\n\u82e5\u51b3\u7b56$j$\u6bd4\u51b3\u7b56$k$\u66f4\u4f18\uff0c\u5219\u6709\n\n$dp[j]+a\\cdot(s[i]-s[j])^2+b\\cdot(s[i]-s[j])+c>dp[k]+a\\cdot(s[i]-s[k])^2+b\\cdot(s[i]-s[k])+c$\n\n$dp[j]-2\\cdot a\\cdot s[i]\\cdot s[j]+a\\cdot s[j]^2-b\\cdot s[j]>dp[k]-2\\cdot a\\cdot s[i]\\cdot s[k]+a\\cdot s[k]^2-b\\cdot s[k]$\n\n$dp[j]-dp[k]+a\\cdot s[j]^2-a\\cdot s[k]^2-b\\cdot s[j]+b\\cdot s[k]>s[i]\\cdot (2\\cdot a\\cdot s[j]-2\\cdot a\\cdot s[k])$\n\n\u4ee4\uff1a\n\n$X(i)=2\\cdot a\\cdot s[i]$\n\n$Y(i)=dp[i]+a\\cdot s[i]^2-b\\cdot s[i]$\n\n$G(i,j)=dp[j]+a\\cdot(s[i]-s[j])^2+b\\cdot(s[i]-s[j])+c$\n\n$K(i,j)=(Y(i)-Y(j))/(X(i)-X(j))$\n\n\u7531\u4e0a\u5f0f\u53ef\u5f97\uff1a\n\n$(Y(j)-Y(k))>K(j,k)\\cdot(X(j)-X(k))$\n\n$(Y(j)-Y(k))/(X(j)-X(k))>K(j,k)$\n\n**\u7136\u540e\u5c31\u53ef\u4ee5\u659c\u7387\u4f18\u5316\u4e86**\n\n\u659c\u7387\u4f18\u5316\u7684\u7ecf\u5178\u65b9\u6cd5\uff1a\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u51b3\u7b56\u7684\u51f8\u5355\u8c03\u6027\n\n$a<0$\uff0c\u76f4\u7ebf\u659c\u7387\u4e3a\u8d1f\uff0c\u7ef4\u62a4\u4e00\u4e2a\u659c\u7387\u5355\u8c03\u9012\u51cf\u7684\u4e0a\u51f8\u5305\n\n\u8c28\u9644\u4e0a\u672c\u849f\u84bb\u5947\u4e11\u65e0\u6bd4\u7684\u4ee3\u7801\uff1a\n\n```\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<queue>\nusing namespace std;\ntypedef long long lint;\n#define N 1000010\nlint n,a,b,c,d[N],s[N],dp[N];\nlint X(int i)\n{\n\treturn 2*a*s[i];\n}\nlint Y(int i)\n{\n\treturn dp[i]+a*s[i]*s[i]-b*s[i];\n}\nlint G(int i,int j)\n{\n\treturn dp[j]+a*s[i]*s[i]-2*a*s[i]*s[j]+a*s[j]*s[j]+b*s[i]-b*s[j]+c;\n}\ndouble K(int i,int j)\n{\n\treturn (double)(Y(i)-Y(j))/(double)(X(i)-X(j));\n}\nlint q[N],head,tail;\nint main()\n{\n\tscanf(\"%lld%lld%lld%lld\",&n,&a,&b,&c);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%lld\",&d[i]);\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\ts[i]=s[i-1]+d[i];\n\t}\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(head<tail&&K(q[head],q[head+1])<=s[i]) head++;\n\t\tdp[i]=G(i,q[head]);\n\t\twhile(head<tail&&K(i,q[tail])<=K(q[tail],q[tail-1])) tail--;\n\t\tq[++tail]=i;\n\t}\n\tprintf(\"%lld\\n\",dp[n]);\n\treturn 0;\n}\n```\n\n**( \u65f6\u95f4\u590d\u6742\u5ea6$O(n)$ )**\n\n\u611f\u89c9\u672c\u9898\u6bd4\u8f83\u9002\u5408\u521d\u5b66\u659c\u7387\u4f18\u5316DP\u505a$\\cdots$",
        "postTime": 1550048625,
        "uid": 126347,
        "name": "\u5922\u5b50\u96fb",
        "ccfLevel": 0,
        "title": "[APIO2010]\u7279\u522b\u884c\u52a8\u961f ( \u659c\u7387\u4f18\u5316DP )"
    },
    {
        "content": "\u7f51\u4e0a\u5bf9\u659c\u7387\u4f18\u5316\u7684\u89e3\u91ca\u592a\u7384\u4e4e\uff0c\u6211\u770b\u4e0d\u61c2\uff0c\u6240\u4ee5\u7528\u81ea\u5df1\u7684\u65b9\u6cd5\u6765\u89e3\u91ca\u4e00\u4e0b\u659c\u7387\u4f18\u5316\uff1a\n\n\u6240\u8c13\u659c\u7387\u4f18\u5316\uff0c\u4f18\u5316\u7684\u662fDP\u3010i\u3011=max\uff08min\uff09\uff08C\uff08i\uff09+C\uff08j\uff09+K\uff08j\uff09\\*S\uff08i\uff09\uff09\u7684dp\u65b9\u7a0b\n\n\u5176\u4e2dC(i)\u662f\u53ea\u8ddfi\u6709\u5173\u7684\u5e38\u6570\uff0cc\uff08j\uff09\u662f\u548cj\u6709\u5173\u7684\u5e38\u6570\uff0cK\uff08j\uff09\u548cS(i)\u662f\u5206\u522b\u4e0eij\u6709\u5173\u7684\u51fd\u6570\u3002\n\n\u6574\u7406 \u5f97 DP\u3010i\u3011-C\uff08i\uff09=K\uff08j\uff09\\*S(i)+C(j)\uff0c\u6211\u4eec\u53ea\u8981\u6c42K\uff08j\uff09\\*S(i)+C(j)\u7684\u6700\u503c\u5373\u53ef\u3002\n\n\u6211\u4eec\u53d1\u73b0\u6bcf\u4e00\u4e2aJ\u4ee3\u8868\u4e00\u6761\u76f4\u7ebf\uff0c\u5176\u81ea\u53d8\u91cf\u4e3aS(i)\uff0c\u4e14S(i)\u5355\u8c03\u9012\u589e\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u52a8\u6001\u7684\u7ef4\u62a4\u4e00\u4e2a\u76f4\u7ebf\u7684\u96c6\u5408\uff0c\u5176K\u4f9d\u6b21\u9012\u589e\uff0cC\u4f9d\u6b21\u9012\u51cf\u3002\uff08\u5f53\u5b58\u5728\u4e00\u6761\u76f4\u7ebf\u7684K\uff0cC\u90fd\u6bd4\u53e6\u4e00\u6761\u5c0f\u65f6\uff0c\u90a3\u5b83\u5c31\u6c38\u8fdc\u4e0d\u4f1a\u6210\u4e3a\u6700\u4f18\u89e3\uff09\u3002\n\n\u53c8\u56e0\u4e3aK\u4f9d\u6b21\u9012\u589e\uff0cC\u4f9d\u6b21\u9012\u51cf\uff0c\u800c\u4e14S(i)\u5355\u8c03\u9012\u589e\uff0c\u90a3\u4e48\u4e00\u6761\u76f4\u7ebf\u88ab\u4ed6\u540e\u9762\u7684\u76f4\u7ebf\u8ffd\u4e0a\u540e\uff0c\u5c31\u4e00\u76f4\u6bd4\u88ab\u5176\u8ffd\u4e0a\u7684\u76f4\u7ebf\u5c0f\u4e86\u3002\uff08\u4e24\u7ebf\u4e00\u4ea4\u70b9\uff09\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u8fd9\u6837\u6765\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u961f\u5217\u6765\u4f18\u5316DP\u4e86\u5417\uff1f\n\n\u7b54\u6848\u662f\u5426\u5b9a\u7684\u3002\n\n\u6211\u4eec\u53d1\u73b0\u4e86\u53cd\u4f8b\u3002\n\n\u6211\u4eec\u8003\u8651\u4e09\u6761\u76f4\u7ebf\uff0cy1=10,y2=X+9,y3=100x+1.\n\n\u663e\u7136\u8fd9\u4e09\u6761\u76f4\u7ebf\u5728\u5355\u8c03\u961f\u5217\u4e2d\u662f\u5408\u6cd5\u7684\u3002\n\n\u4f46\u6211\u4eec\u53d1\u73b0 y1\u548cy2\u7684\u4ea4\u70b9\u5728X=1\u5904\uff0cy1\u4e0ey3\u7684\u4ea4\u70b9\u5374\u5728X=0.09\u5904\u3002\n\n\u6309\u7167\u6211\u4eec\u521a\u624d\u7684\u505a\u6cd5\uff0c\u5f53X=0.5\u65f6\uff0c\u6211\u4eec\u8fd8\u662f\u8bef\u4ee5\u4e3ay1\u662f\u5f53\u524d\u7684\u6700\u4f18\u76f4\u7ebf\uff0c\u4f46\u4e8b\u5b9e\u4e0a\u662fy3\u6700\u4f18\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5728\u961f\u5c3e\u52a0\u5165\u76f4\u7ebf\u65f6\uff0c\u8981\u5224\u5f53\u524d\u8981\u52a0\u7684\u76f4\u7ebf\u4e0e\u524d\u4e00\u6761\u76f4\u7ebf\u4e0e\u524d\u4e00\u6761\u76f4\u7ebf\u7684\u524d\u4e00\u6761\u76f4\u7ebf\u7684\u4ea4\u70b9\u54ea\u4e00\u4e2a\u5728\u524d\uff0c\u5982\u679c\u5f53\u524d\u76f4\u7ebf\u7684\u4ea4\u70b9\u5728\u524d\u7684\u8bdd\uff0c\u90a3\u5c31\u53ef\u4ee5\u5c06\u961f\u5c3e\u7684\u76f4\u7ebf\u5f39\u51fa\u4e86\uff0c\u56e0\u4e3a\u5b83\u5df2\u7ecf\u6ca1\u6709\u673a\u4f1a\u6210\u4e3a\u6700\u4f18\u89e3\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define B(x) (1ll*a*sum[x]*sum[x]+dp[x]-b*sum[x])//\u5c31\u662f\u9898\u89e3\u91cc\u7684C\uff08j\uff09\uff0c\u76f4\u7ebf\u7684\u622a\u8ddd\uff0cy=kx+b\u4e2d\u7684b\n#define K(x) (-2ll*a*sum[x])//\u76f4\u7ebf\u7684\u659c\u7387\n#define N 1070001\n#define LL long long\n#define sight(C) (C<='9'&&C>='0')\nusing namespace std;\nLL sum[N],q[N],n,m,x,head,tail,dp[N],a,b,c;\nLL check(int x,int y) {//\u5224\u65ad\u5f53\u524d\u76f4\u7ebf\u4e0ei\u7ec4\u5408\u7684DP\u503c\n    return dp[y]+a*(sum[x]-sum[y])*(sum[x]-sum[y])+b*(sum[x]-sum[y])+c;\n} char C;int B;\ndouble jiao(int x,int y){ //\u6c42\u76f4\u7ebf\u7684\u4ea4\u70b9\n    return 1.0*(B(x)-B(y))/(K(x)-K(y));\n} \nLL read(LL &x) {\n    C=getchar(); B=1;\n    for(;!sight(C);C=getchar()) if (C=='-') B=-1;\n    for(x=0;sight(C);C=getchar()) x=x*10+C-'0';\n    x*=B;\n}\nint main () {\n     read(n); \n     read(a); read(b); read(c);\n        for (int i=1;i<=n;i++) \n         read(x),sum[i]=sum[i-1]+x;\n        head=tail=0;\n        q[tail++]=0;\n        for (int i=1;i<=n;i++) {\n            while (head+1<tail && check(i,q[head])<=check(i,q[head+1])) head++;//\u5f53\u524d\u89e3\u88ab\u8d85\u8fc7\uff0c\u5c06\u5176\u51fa\u961f\n            dp[i]=check(i,q[head]);\n            while (head+1<tail && jiao(q[tail-2],i)<=jiao(q[tail-1],i)) tail--;//i\u4e0eq\u3010tail-1\u3011\u76f8\u6bd4\uff0ci\u7684\u4ea4\u70b9\u5728\u524d\uff0c\u6240\u4ee5\u5c06q\u3010tail-1\u3011\u5220\u9664\n            q[tail++]=i;\n        } \n    printf(\"%lld\\n\",dp[n]);\n    return 0;\n}\n```",
        "postTime": 1509796485,
        "uid": 53193,
        "name": "\u6b87\u96ea",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\n\u200b\t\u7ed9\u4f60\u4e00\u4e2a\u5e8f\u5217\uff0c \u5c06\u8fd9\u4e2a\u5e8f\u5217\u5206\u6210\u82e5\u5e72\u6bb5\uff0c \u6bcf\u4e00\u6bb5\u7684\u8d21\u732e\u4e3a $ax ^ 2 + bx + c$(x \u4e3a \u8fd9\u4e00\u6bb5\u7684\u6743\u503c\u4e4b\u548c)\n\n\n\n## \u5177\u4f53\u601d\u8def\n\n \n\n------------------------------\n\n### 50pts\n\u200b\t\u8003\u8651Dp\uff0c \u8bbe$Dp_i$\u4e3a\u524di\u4e2a\u6570\u5206\u6210\u82e5\u5e72\u6bb5\u7684\u6700\u5927\u6536\u76ca, \u5219$Dp[i] = max(Dp[j-1] + Cost_{i,j})\\quad(j <= i)$\n\n\u200b\t\u73b0\u5728\u60f3$cost$ \u51fd\u6570\u600e\u4e48\u6c42\u5f97\n\n\u200b\t\t\u8bbe$Sum[i]$ \u4e3a i \u7684\u524d\u7f00\u548c\uff0c \u5219$cost_{i, j} = a(Sum[i] - Sum[j]) ^  2 + b (Sum[i] - Sum[j-1]) + c$   \u53ef\u4ee5$O(1)$ \u6c42\u5f97\n\n\n\n### 100pts\n\n\u200b\t\u60f3\u4e00\u60f3\u5982\u4f55\u4f18\u5316\u8fd9\u4e2a\u8f6c\u79fb\uff0c \u53d1\u73b0j\u6bcf\u6b21\u90fd\u662f\u4ece1 \u81f3 n , \u8003\u8651\u8fdb\u884c\u659c\u7387\u4f18\u5316\n\n\u200b\t\u4e0d\u59a8\u8bbe\u3000x > y \u4e14\u3000\uff58\u7684\u8f6c\u79fb\u4f18\u4e8e\uff59\n\n\u200b\t\u5219$Dp[x] + a(Sum[i] - Sum[x]) ^  2 + b (Sum[i] - Sum[x]) + c  > Dp[y]+ a(Sum[i] - Sum[y]) ^  2 + b (Sum[i] - Sum[y]) + c$\n\n$\\Leftrightarrow Dp[i] + a(Sum[i] ^ 2 + Sum[x] ^ 2 - 2 * Sum[i] * Sum[x]) + b(Sum[i] - Sum[x]) + c > Dp[y] + a(Sum[i] ^ 2 + Sum[y] ^ 2 - 2 * Sum[i] * Sum[x]) + b(Sum[i] - Sum[y]) + c$\n\n$\\Leftrightarrow Dp[i] + aSum[i] ^ 2 + aSum[x] ^ 2 - 2 * a * Sum[i] * Sum[x] + b Sum[i] - bSum[x ] + c > Dp[y] + a * Sum[y] ^ 2 + a * Sum[y] ^ 2  - 2aSum[i] * Sum[x] +  bSum[i] - bSum[y] + c$\n\n\u79fb\u9879\u3001\u5408\u5e76\u540c\u7c7b\u9879\u5f97\n\n\u200b\t$Dp[x] - Dp[y] + a(Sum[x ] ^ 2 - Sum[y] ^ 2) - b(Sum[x] - Sum[y]) > 2aSum[i](Sum[x] - Sum[y])$\n\n$\\Leftrightarrow \\frac{Dp[x] - Dp[y] + a(Sun[x] ^ 2 - Sum[y] ^ 2) - b(Sum[x] - Sum[y])}{(Sum[x] - Sum[y])} > 2aSum[i]\u200b$\n\n$\\Leftrightarrow \\frac{Dp[x] + aSum[x] ^ 2 + bSum[x] - Dp[y] - aSum[y]^2 - bSum[y]}{(Sum[x] - Sum[y])} > 2aSum[i]$\n\n\u200b\t\u6ce8\u610f\uff1a\u7531\u4e8e\u9898\u9762\u8bf4$a < 0 \u200b$ \u6240\u4ee5\u5982\u679c\u8981\u5c06\uff41\u9664\u8fc7\u53bb\u8981\u5c06\u7b26\u53f7\u8f6c\u5411\n\n\u4e0d\u96be\u53d1\u73b0\u5de6\u5f0f\u4e3a\u4e00\u4e2a\u76f4\u7ebf\u7684\u70b9\u659c\u5f0f\uff0c\u6545\u4ee4\u5176\u4e3aSlope(x, y)\u3000\u8981\u6ee1\u8db3\u51b3\u7b56\u5355\u8c03\u6027\u5373Slope\u6ee1\u8db3\u5355\u8c03\u6027\uff0c\u3000\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u5373\u53ef\n\n## \u4ee3\u7801\u5b9e\u73b0\n\n\n\n```cpp\n#pragma GCC optimize(\"O2\")\n#pragma GCC optimize(\"O3\")\n\n#include <cstdio>\n\ntemplate<class T>\ninline void read(T &a){\n    T s = 0, w = 1;\n    char c = getchar();\n    while(c < '0' || c > '9') {if(c == '-') w = -1; c = getchar();}\n    while(c >= '0' && c <= '9') {s = (s << 1) + (s << 3) + (c ^ 48), c = getchar();}\n    a = s * w;\n}\n\n#define maxn  1000010\nstatic int n,s[maxn],l,r,q[maxn];\nstatic long long a,b,c,dp[maxn];\n\n#define A(x) (dp[x] + a * s[x] * s[x] - b * s[x])\n#define P(x) (s[i] - s[x])\n\ninline double slope(register int x, register int y){\n    return 1.0 * (A(x) - A(y)) / ((s[x] - s[y]));\n}\n\nsigned main(){\n    read(n), read(a), read(b), read(c);\n    for (register int i = 1; i <= n; i++){\n        int x;\n        read(x);\n        s[i] = s[i-1] + x;\n    }\n\n    for (register int i = 1; i <= n; i++){\n        while(l < r && slope(q[l + 1], q[l]) > 2*a*s[i]) l++;\n        dp[i] = dp[q[l]] + a * P(q[l]) * P(q[l]) + b * P(q[l]) + c;\n        while(l < r && slope(q[r], q[r-1]) < slope(i, q[r])) r--;\n        q[++r] = i;\n    }\n    printf(\"%lld\", dp[n]);\n    return 0;\n}\n```\n\n\n\n\n\n\n\n",
        "postTime": 1553310028,
        "uid": 33339,
        "name": "Zcus",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "#### \u5c31\u662f\u4e00\u4e2a\u659c\u7387\u4f18\u5316\u4e86\u6211\u8fd9\u91cc\u4e0d\u505a\u7d2f\u8d58\u89e3\u91ca\u5176\u4ed6\u697c\u8bb2\u7684\u5f88\u6e05\u695a\u4e86\uff0c\u6211\u8fd9\u91cc\u7ed9\u5927\u5bb6\u63d0\u51e0\u4e2a\u9192\n\n### \u5728\u63a8\u659c\u7387\u65b9\u7a0b\u65f6\u6ce8\u610f\uff1aa\u662f<0\uff0c\u5343\u4e07\u8bb0\u5f97\u53d8\u53f7\n\n### \u4e3a\u9632\u6b62\u7cbe\u5ea6\u7206\u70b8slope\uff08\u659c\u7387\u51fd\u6570\uff09\u8fd4\u56de\u65f6\u8bb0\u5f97\u662fdouble\n\n### dp\u6570\u7ec4\u6700\u597d\u5f00long long\uff08\u6211\u6ca1\u8bd5\u8fc7int)(\u4f30\u8ba1\u4f1a\u70b8)\n\n```cpp\n#include<iostream>\nusing namespace std;\nint n;\nint a,b,c;\nlong long sum[1000066];\nint q[1000006];\nlong long d[1000006];\ndouble slope(int j,int k)\n{\n    int re=(((d[k]-d[j]+a*sum[k]*sum[k]-a*sum[j]*sum[j]-b*sum[k]+b*sum[j])*1.0) / (a*2.0*(sum[k]-sum[j])));\n    return re;\n}\nint main()\n{\n    cin>>n;\n    cin>>a>>b>>c;\n    for (int i=1;i<=n;i++) {int x;cin>>x;sum[i]=sum[i-1]+x;}\n    int l=0,r=0;\n    for (int i=1;i<=n;i++)\n        {\n            while (l<r && slope(q[l],q[l+1])<sum[i]) l++;\n            int p=q[l];\n            d[i]=d[p]+a*(sum[i]-sum[p])*(sum[i]-sum[p])+b*(sum[i]-sum[p])+c;\n            while (l<r && slope(q[r-1],q[r])>slope(q[r],i)) r--;\n            q[++r]=i;\n        }\n    cout<<d[n];\n}\n```",
        "postTime": 1516464811,
        "uid": 14904,
        "name": "smzzl",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "\u4f60\u6709\u4e00\u652f\u7531$n$\u540d\u9884\u5907\u5f79\u58eb\u5175\u7ec4\u6210\u7684\u90e8\u961f\uff0c\u58eb\u5175\u4ece$1$\u5230$n$\u7f16\u53f7\uff0c\u4f60\u8981\u5c06\u4ed6\u4eec\u62c6\u5206\u6210\u82e5\u5e72\u7279\u522b\u884c\u52a8\u961f\u8c03\u5165\u6218\u573a\u3002\u51fa\u4e8e\u9ed8\u5951\u7684\u8003\u8651\uff0c\u540c\u4e00\u652f\u7279\u522b\u884c\u52a8\u961f\u4e2d\u961f\u5458\u7684\u7f16\u53f7**\u5e94\u8be5\u8fde\u7eed**\uff0c\u5373\u4e3a\u5f62\u5982$(i, i + 1, \\cdots i + k)$\u7684\u5e8f\u5217\u3002\u6240\u6709\u7684\u961f\u5458\u90fd\u5e94\u8be5\u5c5e\u4e8e\u4e14\u4ec5\u5c5e\u4e8e\u4e00\u652f\u7279\u522b\u884c\u52a8\u961f\u3002\n\n\u7f16\u53f7\u4e3a$i$\u7684\u58eb\u5175\u7684\u521d\u59cb\u6218\u6597\u529b\u4e3a$x_i$\uff0c\u4e00\u652f\u7279\u522b\u884c\u52a8\u961f\u7684\u521d\u59cb\u6218\u6597\u529b$X$\u4e3a\u961f\u5185\u58eb\u5175\u521d\u59cb\u6218\u6597\u529b\u4e4b\u548c\uff0c\u5373$X = x_i + x_{i+1} + \\cdots + x_{i+k}$\u3002\n\n\u901a\u8fc7\u957f\u671f\u7684\u89c2\u5bdf\uff0c\u4f60\u603b\u7ed3\u51fa\u5bf9\u4e8e\u4e00\u652f\u521d\u59cb\u6218\u6597\u529b\u4e3a$X$\u7684\u7279\u522b\u884c\u52a8\u961f\uff0c\u5176\u4fee\u6b63\u6218\u6597\u529b$X'= aX^2+bX+c$\uff0c\u5176\u4e2d$a,b,c$\u662f\u5df2\u77e5\u7684\u7cfb\u6570$(a < 0)$\u3002 \u4f5c\u4e3a\u90e8\u961f\u7edf\u5e05\uff0c\u73b0\u5728\u4f60\u8981\u4e3a\u8fd9\u652f\u90e8\u961f\u8fdb\u884c\u7f16\u961f\uff0c\u4f7f\u5f97\u6240\u6709\u7279\u522b\u884c\u52a8\u961f\u7684\u4fee\u6b63\u6218\u6597\u529b\u4e4b\u548c\u6700\u5927\u3002\u8bd5\u6c42\u51fa\u8fd9\u4e2a\u6700\u5927\u548c\u3002\n### \u94fe\u63a5\n\n[[APIO2010]\u7279\u522b\u884c\u52a8\u961f](https://www.luogu.com.cn/problem/P3628)\n\n### \u601d\u8def\n\n\u7531\u4e8e**\u540c\u4e00\u652f\u7279\u522b\u884c\u52a8\u961f\u4e2d\u961f\u5458\u7684\u7f16\u53f7\u5e94\u8be5\u8fde\u7eed**\uff0c\u90a3\u4e48\u5c31\u6bd4\u8f83\u597d\u60f3\u4e86\u3002\n\n\u5b9a\u4e49$dp[i]$\u8868\u793a\u524d$i$\u540d\u961f\u5458\u5df2\u7ecf\u5206\u5c5e\u4e8e\u5404\u81ea\u7684\u884c\u52a8\u961f\uff0c\u76ee\u524d\u6240\u6709\u884c\u52a8\u961f\u7684\u4fee\u6b63\u6218\u6597\u529b\u4e4b\u548c\u7684\u6700\u5927\u503c\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u4ece$[0,i)$\u961f\u5458\u4e2d\u679a\u4e3e$j$\uff0c\u4f7f\u5f97\u7b2c$j+1$\u540d\u961f\u5458\u5230\u7b2c$i$\u540d\u961f\u5458\u5c5e\u4e8e\u4e00\u4e2a\u884c\u52a8\u961f\u3002\n\n\u90a3\u4e48\n$$\ndp[i]=max\\{dp[j]+a(sum[i]-sum[j])^2+b(sum[i]-sum[j])+c\\},c\\in[0,i)\n$$\n\u5176\u4e2d$sum$\u4e3a$x$\u7684\u524d\u7f00\u548c\u3002\u521d\u59cb\u5316$dp[0]=0$\uff0c\u5176\u4f59\u5747\u4e3a\u4e00\u4e2a\u6781\u5c0f\u7684\u8d1f\u503c\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a$O(n^2)$\u7684\u7b97\u6cd5\uff0cTLE\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define N 1000010\n#define ll long long\n\nusing namespace std;\n\nint n;\nll a,b,c,x[N],sum[N],dp[N];\n\nint main() {\n\tcin>>n;\n\tcin>>a>>b>>c;\n\tfor(int i=1;i<=n;i++) {\n\t\tcin>>x[i];\n\t\tsum[i]=sum[i-1]+x[i];\n\t}\n\t\n\tmemset(dp,~0x3f,sizeof(dp));\n\tdp[0]=0;\n\tfor(int i=1;i<=n;i++) {\n\t\tfor(int j=0;j<i;j++) {\n\t\t\tll X=(sum[i]-sum[j]);\n\t\t\tdp[i]=max(dp[i],dp[j]+a*X*X+b*X+c);\n\t\t}\n\t}\n\t\n\tcout<<dp[n]<<endl;\n\t\n\treturn 0;\n}\n```\n\n\u5c06$max$\u5185\u7684\u5f0f\u5b50\u5355\u72ec\u63d0\u51fa\u6765\u770b\u770b\n\n$dp[j]+a(sum[i]-sum[j])^2+b(sum[i]-sum[j])+c$\n\n$=dp[j]+a(sum[i]^2-2sum[i]sum[j]+sum[j]^2)+b(sum[i]-sum[j])+c$\n\n$=dp[j]+a\\times sum[j]^2-b\\times sum[j]-2a\\times sum[i]sum[j]+a\\times sum[i]^2+b\\times sum[i]+c$\n\n\u5254\u9664\u6389\u6c42\u72b6\u6001$i$\u65f6\u7684\u5e38\u91cf\u9879\uff0c\u5219\u4e3a\n\n$dp[j]+a\\times sum[j]^2-b\\times sum[j]-2a\\times sum[i]sum[j]$\n\n\u5b9a\u4e49$f[i]=a\\times sum[i]^2-b\\times sum[i]$\uff0c\u5219\u539f\u5f0f\u53ef\u5316\u4e3a\n\n$dp[j]+f[j]-2a\\times sum[i]sum[j]$\n\n\u5219\n$$\ndp[i]=max\\{dp[j]+f[j]-2a\\times sum[i]sum[j]\\}+a\\times sum[i]^2+b\\times sum[i]+c\n$$\n\u5c06$max$\u5185\u63d0\u51fa\u6765\n\n$dp[j]+f[j]-2a\\times sum[i]sum[j]$\uff0c\u53d1\u73b0$sum[j]$\u8fd9\u4e00\u9879\uff0c\u5176\u7cfb\u6570\u4e3a\u5e38\u91cf\u3002\n\n\u4e8e\u662f\u8be5\u5f0f\u5b50\u53ef\u4ee5\u770b\u505a\u4e00\u659c\u7387\u4e3a$2a\\times sum[i]$\u7684\u8fc7\u70b9$(sum[j],dp[j]+f[j])$\u7684\u76f4\u7ebf\u4e0e$y$\u8f74\u7684\u622a\u8ddd\uff0c\u4e8e\u662f\u5b9a\u4e49\u51b3\u7b56\u70b9$i(sum[i],dp[i]+f[i])$\u3002\n\n\u90a3\u4e48\u95ee\u9898\u5c31\u8f6c\u5316\u4e3a\u6c42\u4e00\u4e2a\u6700\u5927\u7684\u622a\u8ddd\uff0c\u4e8e\u662f\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u4e0a\u51f8\u58f3\u3002\n\n\u660e\u663e$sum$\u5177\u6709\u5355\u8c03\u6027\u3002\n\n\u4e8e\u662f\u4ee4$k<j<i$\uff0c\u82e5\u8f6c\u79fb\u51b3\u7b56$j$\u6bd4\u8f6c\u79fb\u51b3\u7b56$k$\u66f4\u4f18\u7684\u8bdd\uff0c\u5219\n\n$dp[j]+f[j]-2a\\times sum[i]sum[j]\\ge dp[k]+f[k]-2a\\times sum[i]sum[k]$\n\n$dp[j]+f[j]-(dp[k]+f[k])\\ge 2a\\times sum[i](sum[j]-sum[k])$\n\n\u56e0\u4e3a$j>k$\u4e14$sum$\u5355\u8c03\u9012\u589e\uff0c\u5219\n\n$\\frac{dp[j]+f[j]-(dp[k]+f[k])}{sum[j]-sum[k]}\\ge 2a$ \u5f0f\u2460\n\n\u800c\u82e5\u8981\u7ef4\u62a4\u4e0a\u51f8\u58f3\uff0c\u5219\u5176\u5177\u6709\u4e0a\u51f8\u6027\uff0c\u5373\u6ee1\u8db3$j_1<j_2<j_3$\uff0c\u5219\u51b3\u7b56\u70b9$j_1$\u4e0e$j_2$\u4e4b\u95f4\u8fde\u7ebf\u6bb5\u7684\u659c\u7387\u5927\u4e8e\u51b3\u7b56\u70b9$j_2$\u4e0e$j_3$\u4e4b\u95f4\u7684\u659c\u7387\uff0c\u5373\n\n$\\frac{dp[j_2]+f[j_2]-(dp[j_1]+f[j_2])}{sum[j_2]-sum[j_1]}>\\frac{dp[j_3]+f[j_3]-(dp[j_2]+f[j_2])}{sum[j_3]-sum[j_2]}$ \u5f0f\u2461\n\n\u4e8e\u662f\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u4e0a\u51f8\u58f3\uff0c\u7528\u5f0f\u2460\u4fdd\u6301\u961f\u5934\u4e3a\u6700\u4f18\u51b3\u7b56\u70b9\uff0c\u7528\u5f0f\u2461\u7ef4\u62a4\u4e0a\u51f8\u58f3\u5373\u53ef\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define N 1000010\n#define ll long long\n\nusing namespace std;\n\nint n,q[N],head=1,tail=1;\nll a,b,c,x[N],sum[N],dp[N],f[N];\n\nint main() {\n\tcin>>n;\n\tcin>>a>>b>>c;\n\tfor(int i=1;i<=n;i++) {\n\t\tcin>>x[i];\n\t\tsum[i]=sum[i-1]+x[i];\n\t\tf[i]=a*sum[i]*sum[i]-b*sum[i];\n\t}\n\t\n\tmemset(dp,~0x3f,sizeof(dp));\n\tdp[0]=0,q[0]=0;\n\tfor(int i=1;i<=n;i++) {\n\t\twhile(head<tail&&dp[q[head+1]]+f[q[head+1]]-dp[q[head]]-f[q[head]]>=2*a*sum[i]*(sum[q[head+1]]-sum[q[head]])) head++;\n\t\tdp[i]=dp[q[head]]+f[q[head]]-2*a*sum[i]*sum[q[head]]+a*sum[i]*sum[i]+b*sum[i]+c;\n\t\twhile(head<tail&&(dp[q[tail]]+f[q[tail]]-dp[q[tail-1]]-f[q[tail-1]])*(sum[i]-sum[q[tail]])<=(dp[i]+f[i]-dp[q[tail]]-f[q[tail]])*(sum[q[tail]]-sum[q[tail-1]])) tail--;\n\t\tq[++tail]=i;\n\t}\n\t\n\tcout<<dp[n]<<endl;\n\t\n\treturn 0;\n}\n```\n",
        "postTime": 1581227540,
        "uid": 71936,
        "name": "HoshiuZ",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "\u659c\u7387\u4f18\u5316\u7684\u7ec3\u624b\u9898\n\n\u901a\u8bfb\u9898\u76ee\u53ef\u4ee5\u53d1\u73b0\n\n$$\nf_i=\\max \\{f_j+g(s[i]-s[j])\\}\n$$\n\n\u5176\u4e2d$f_i$\u8868\u793a\u5728i\u5904\u5f3a\u5236\u7ed3\u675f\u4e00\u6bb5\u7684\u6700\u5927\u4ee3\u4ef7,$s_i$\u8868\u793a$a_i$\u7684\u524d\u7f00\u548c,$g(x)$\u8868\u793a$(ax^2+bx+c)$\n\n\u5c55\u5f00\u8fd9\u4e2a\u5f0f\u5b50\u6211\u4eec\u5f97\u5230\n$$\nf_i=\\max\\{f_j+as_i^2-2as_is_j+as_j^2+bs_i-bs_j+c\\}\n$$\n\u53bb\u6389$\\max$\uff0c\u79fb\u9879\u5f97\u5230:\n$$\n(f_j+as_j^2-bs_j)=2as_is_j+(f_i-as_i^2-bs_i-c)\n$$\n\n\u7136\u540e\u5c31\u662f\u5e38\u89c4\u7684\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u51f8\u58f3\u4e86\n\n```cpp\n#include <bits/stdc++.h>\n\n#define R register\n#define ll long long\n#define sum(a, b, mod) (((a) + (b)) % mod)\n\nconst int MaxN = 1e6 + 10;\n\nll n, A, B, C;\nll a[MaxN], s[MaxN], f[MaxN], q[MaxN];\n\ninline ll read()\n{\n    ll x = 0, f = 1;\n    char ch = getchar();\n    while (ch > '9' || ch < '0')\n    {\n        if (ch == '-')\n            f = 0;\n        ch = getchar();\n    }\n    while (ch <= '9' && ch >= '0')\n        x = (x << 1) + (x << 3) + (ch ^ 48), ch = getchar();\n    return f ? x : (-x);\n}\n\nll g(int num) { return A * num * num + B * num + C; }\nll x(int num) { return s[num]; }\nll y(int num) { return (f[num] + A * s[num] * s[num] - B * s[num]); }\nll k(int num) { return 2 * A * s[num]; }\n\nint main()\n{\n    n = read(), A = read(), B = read(), C = read();\n    for (int i = 1; i <= n; i++)\n        a[i] = read(), s[i] = s[i - 1] + a[i];\n    int l = 1, r = 1;\n    for (int i = 1; i <= n; i++)\n    {\n        while (l < r && (y(q[l + 1]) - y(q[l])) >= k(i) * (x(q[l + 1]) - x(q[l])))\n            ++l;\n        f[i] = f[q[l]] + g(s[i] - s[q[l]]);\n        while (l < r && (y(q[r]) - y(q[r - 1])) * (x(i) - x(q[r])) <= (y(i) - y(q[r])) * (x(q[r]) - x(q[r - 1])))\n            --r;\n        q[++r] = i;\n    }\n    printf(\"%lld\\n\", f[n]);\n    return 0;\n}\n\n```\n\n",
        "postTime": 1575119045,
        "uid": 61966,
        "name": "little_sun",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "\u8fd9\u662f\u672c\u4eba\u7b2c\u4e00\u6b21\u53d1\u5e03\u9898\u89e3\uff0c\u5982\u679c\u6709\u9519\u8bef\u7684\u5730\u65b9\u8fd8\u8bf7\u5927\u4f6c\u6307\u51fa\u3002\n\u9996\u5148\uff0c\u659c\u7387\u4f18\u5316dp\uff0c\u8fd9\u4e2a\u7b97\u6cd5\u7814\u7a76\u4e86\u4e24\u5929\u624d\u7ec8\u4e8e\u653b\u4e0b\u6765\uff0c\u4e5f\u60f3\u501f\u7740\u9898\u89e3\u5de9\u56fa\u5de9\u56fa\u81ea\u5df1\u5b66\u8fc7\u7684\u77e5\u8bc6\u70b9\u3002\n\n------------\n\n\u5148\u63a8\u4e0b\u516c\u5f0f\uff1a\n###  \u9996\u5148\uff0c\u5bf9\u4e8e\u4e00\u4e2a$N^2$\u7b97\u6cd5\uff0c\u6211\u4eec\u6709\u63a8dp\u516c\u5f0f\uff1a\n### $dp[i]$=$max(dp[j]+a(sum[i]-sum[j])^2+b(sum[i]-sum[j])$)\n\u4f46\u662f\u5bf9\u4e8e\u672c\u9898\u7684\u5927\u6570\u636e\u6765\u8bf4\uff0cN^2\u7b97\u6cd5\u5e76\u4e0d\u80fd\u987a\u5229\u901a\u8fc7\uff08~~\u5361\u5728\u4e86\u5947\u602a\u7684\u5730\u65b9~~\uff09\n\n\u7ecf\u8fc7\u591a\u65b9\u5bfb\u6c42\u5927\u4f6c\u5e2e\u52a9\uff0c\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a\u659c\u7387\u4f18\u5316\u7684\u7b97\u6cd5\u3002\n### \u659c\u7387k\u7684\u8ba1\u7b97\u516c\u5f0f\u4e3a\uff1a\uff08y1-y2\uff09/(x1-x2)\n\u7531\u4e0a\u8ff0dp\u65b9\u7a0b\uff0c\u6211\u4eec\u53d6\u4e24\u4e2ai\u524d\u7684\u72b6\u6001j\u4e0e\u72b6\u6001k\uff0c\u82e5j\u6bd4k\u66f4\u4f18\uff0c\u5219\u6709\uff1a\n### $dp[j]+a(sum[i]-sum[j])^2+b(sum[i]-sum[j])>dp[k]+a(sum[i]-sum[k])^2+b(sum[i]-sum[k])$\n\u6b64\u65f6\uff0c\u5de6\u53f3\u62c6\u62ec\u53f7\uff0c\u79fb\u9879\uff0c\u6574\u7406\u53ef\u5f97\uff1a\n\n### (\uff08$dp[j]+asum[j]^2+bsum[j]$\uff09-($dp[k]+asum[k]^2-bsum[k]$))/($sum[j]-sum[k]$)<=$2asum[i]$\n(~~\u5fd8\u8bb0\u53d8\u53f7\u5012\u9519\u516c\u5f0f\u53ef\u601c\u7684\u672c\u849f\u84bb~~)\n\n\u4e0d\u7b49\u5f0f\u53f3\u4fa7\u5728\u679a\u4e3ei\u7684\u60c5\u51b5\u4e0b\u4e3a\u5b9a\u503c\uff0c\u4e5f\u662f\u5e38\u503c\uff0c\u800c\u6211\u4eec\u53ef\u4ee5\u8bbesum[p]\u4e3a\u81ea\u53d8\u91cf\uff0c$dp[p]+asum[p]^2+bsum[p]$\u4e3a\u56e0\u53d8\u91cf\uff09\n### \u7531\u659c\u7387\u516c\u5f0f\u53ef\u5f97\u5230\u70b9\u5750\u6807\uff08$sum[p],dp[p]+asum[p]^2+bsum[p]$\uff09\n\n\n------------\n\n## \u6ce8\uff1a\u4e0b\u9762\u8fd9\u4e00\u6bb5\u8bdd\u5f88\u91cd\u8981\uff0c\u662f\u4e00\u76f4\u627e\u4e0d\u5230\u89e3\u91ca\u7684\uff0c\u5927\u591a\u6570\u5927\u4f6c\u8bb2\u89e3\u5230\u8fd9\u91cc\u65f6\u4e0d\u4f1a\u89e3\u91ca\u5355\u8c03\u6027\uff0c\u4f1a\u76f4\u63a5\u8d34\u4ee3\u7801\uff1a\n\u90a3\u4e48\uff0c\u6211\u4eec\u4e3a\u4ec0\u4e48\u80fd\u4ee5O(N)\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u8fdb\u884c\u659c\u7387\u4f18\u5316dp\u5462\uff1f\uff1f\uff1f\n\n\uff08~~\u5343\u53cd\u7530\uff1a\u6211\u5f88\u597d\u5947\uff08\u6b64\u5904\u5e94\u6709\u914d\u97f3\uff09~~\uff09\n\n#### \u6211\u662f\u5883\u754c\u7ebf\u54d2-------------------------------------------------------------------------------------------\n\n\u5bf9\u4e8e\u4e00\u4e2aO\uff08N\uff09\u7ea7\u522b\u7684\u7b97\u6cd5\uff0c\u6211\u4eec\u679a\u4e3e\u6bcf\u4e00\u4e2ai\uff0c\u4fbf\u80fd\u5f97\u5230\u7b54\u6848\u3002\n\n\u90a3\u4e48\uff0c\u5bf9\u4e8e\u80fd\u66f4\u65b0i\u503c\u7684dp\u503c\uff0c\u6211\u4eec\u5728\u8bbf\u95ee\u8fd9\u4e2ai\u503c\u65f6\uff0c\u5df2\u7ecf\u5904\u7406\u51fa\u4e86i\u503c\u4ee5\u524d\u7684\u53ef\u4ee5\u7528\u6765\u66f4\u65b0i\u503c\u7684\u503c\uff0c\u800c\u659c\u7387\u4f18\u5316\u53ef\u4ee5\u8ba9\u6211\u4eec\u4fdd\u8bc1\uff0c\u6bcf\u6b21\u5904\u7406\u540e\u7684\u6570\u636e\u662f\u6700\u4f18\u503c\u3002\n\n\u7531\u4e8e\u9898\u76ee\u4e2d\u4fdd\u8bc1a<0,\u6211\u4eec\u6bcf\u6b21\u5f97\u5230\u7684\u659c\u7387\u503c\u662f\u4e00\u4e2a\u8d1f\u503c\uff0c\u56e0\u6b64\u659c\u7387\u8d8a\u5c0f\uff0c\u5b83\u5728y\u8f74\u4e0a\u7684\u622a\u8ddd\u5c31\u8d8a\u5927\uff0c\u800c\u6211\u4eec\u671f\u671b\u7684dp\u6700\u5927\u503c\u5219\u662f\u622a\u8ddd\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u961f\u5217\uff0c\u53bb\u62ff\u6bcf\u6b21\u5bf9\u4e8e\u5f53\u524d\u5faa\u73af\u4e0b\u7684i\u503c\u4e4b\u524d\u7684\u659c\u7387\u6700\u5c0f\u503c\u3002\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u505a\u7684\u4e8b\u60c5\u6709\u4e24\u4ef6\uff1a\n\n### 1\u3001\u5bf9\u4e8e\u961f\u5217\u4e2d\u4e24\u4e2a\u5df2\u5165\u961f\u7684\u503c\uff0c\u82e5\u4ed6\u4eec\u8fde\u7ebf\u7684\u659c\u7387\u5927\u4e8e2asum[i]\u7684\u659c\u7387\u7684\u8bdd\uff0c\u5219\u4e0d\u7b26\u5408\u4e0a\u8ff0\u65b9\u7a0b\uff0c\u6545\u6b64\u503c\u4e5f\u4e0d\u53ef\u4ee5\u7528\u6765\u66f4\u65b0dp[i]\u503c\uff0c\u5c06\u5176\u5f39\u51fa\u961f\u5217\u3002\n### 2\u3001\u5bf9\u4e8e\u961f\u5217\u540e\u7684\u5143\u7d20\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u5220\u70b9\u5904\u7406\uff0c\u82e5\u540e\u8fdb\u961f\u7684\u5143\u7d20\u4e0e\u961f\u5c3e\u5143\u7d20\u7684\u659c\u7387\u8981\u5927\u4e8e\u961f\u5c3e\u5143\u7d20\u4e0e\u5012\u6570\u7b2c\u4e8c\u4e2a\u5143\u7d20\u7684\u659c\u7387\u7684\u8bdd\uff0c\u4e5f\u8981\u5220\u9664\u961f\u5c3e\u5143\u7d20\uff0c\u7136\u540e\u653e\u5165i\u7684\u65f6\u5019\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u5012\u6570\u7b2c\u4e8c\u7684\u5143\u7d20\u4e0e\u65b0\u5143\u7d20\u7684\u659c\u7387,\u6b64\u65f6\u4fdd\u8bc1\u8be5\u659c\u7387\u4f18\u4e8e\u4e0a\u4e00\u4e2a\u70b9\u3002\n### 3\u3001\u8bb0\u5f97\u6700\u5f00\u59cb\u628a0\u6254\u8fdb\u961f\u5217\uff01\uff01\uff01\uff01\uff01\uff01\uff01\n\uff08\u4f17\u6240\u5468\u77e5\uff0c\u4e24\u4ef6\u4e8b\u5f53\u7136\u8981\u6709\u4e09\u70b9\u4e86QwQ\uff09\n\n\u6700\u540e\u7684\u6700\u540e\uff1a\u8d34\u4e0a\u672c\u849f\u84bb\u7684lj\u4ee3\u7801\uff1a\n\n\n```\n\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<cstdlib>\n#include<cmath>\nusing namespace std;\n#define ll long long\nconst int maxn=2e6+5;\nint i,j,heis[maxn],sum[maxn],que[maxn];\nint head,tail;\nll dp[maxn],n;\nll a,b,c;\nint size(){return tail-head;}\nvoid push(int x)\n{\n\tque[tail]=x;\n\ttail++;\n\treturn ;\n}\nvoid pop(){head++;return;}\nvoid slip(){tail--;return;}\nint rex(int q){return sum[q];}\nll rey(int q){return dp[q]+a*sum[q]*sum[q]-b*sum[q];}\nll calc(int p,int q)\n{\n\treturn dp[q]+a*pow(sum[p]-sum[q],2)+b*(sum[p]-sum[q])+c;\n}\ndouble k(int o,int r){return (double)(rey(r)-rey(o))/(double)(rex(r)-rex(o));}\nint main()\n{\n\tios::sync_with_stdio(false);\n\tfreopen(\"xydp.in\",\"r\",stdin);\n\tfreopen(\"xydp.out\",\"w\",stdout);\n\tcin>>n;\n\tcin>>a>>b>>c;\n\tfor(i=1;i<=n;i++)\n\t{\n\t\tcin>>heis[i];\n\t\tsum[i]=sum[i-1]+heis[i];\n\t}\n\ttail=1;\n\thead=1;\n\tpush(0);\n\tfor(i=1;i<=n;i++)\n\t{\n\t\twhile((size()>1)&&((k(que[head],que[head+1]))>=2*a*sum[i])){pop();}\n\t\tdp[i]=calc(i,que[head]);\n\t\twhile((size()>1)&&(k(i,que[tail-1])>=k(que[tail-1],que[tail-2]))){slip();}\n\t\tpush(i);\n\t}\n\tcout<<dp[n];\n\treturn EXIT_SUCCESS;\n}\n------------\n//wrote by yuki 2019.7.30",
        "postTime": 1564453125,
        "uid": 115852,
        "name": "yuki_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u6709\u4e00\u4e2a\u4e0d\u592a\u4e00\u6837\u7684\u5199\u6cd5 ~~\uff08\u867d\u7136\u8fd8\u662f\u659c\u7387DP\uff09~~\n\n\u6211AC\u4e86\u8fd9\u9053\u9898\uff0c\u7136\u540e\u968f\u4fbf\u7ffb\u4e86\u7ffb\u9898\u89e3\n\nThen\uff0c\u5927\u5bb6\u7684\u4ee3\u7801\u600e\u4e48\u548c\u6211\u4e0d\u5927\u4e00\u6837\uff1f\uff08\u96fe\uff09\n\n\u56de\u5230\u6b63\u9898\uff0c\u6211\u4eec\u5148\u9020\u4e00\u4e2a\u524d\u7f00\u6570\u7ec4$sum$\n\n\u7136\u540e\u5199\u51fa$DP$\u8f6c\u79fb\u65b9\u7a0b:\n\n### $f[i]=f[j]+a*(sum[i]-sum[j])^2+b*(sum[i]-sum[j])+c$ $(j<i)$\n\n\u63a5\u4e0b\u6765\u89e3\u6cd5\u57fa\u672c\u4e0a\u548c\u5176\u4ed6\u7684\u9898\u89e3\u76f8\u540c\uff0c\u6211\u5c31\u76f4\u63a5\u8bb2\u6211\u4ee3\u7801\u4e0d\u4e00\u6837\u7684\u5730\u65b9\u4e86\n\n\u6211\u4eec\u770b\u8f6c\u79fb\u65b9\u7a0b\u4e2d\u7684\u90a3\u4e00\u9879\uff1a$b*(sum[i]-sum[j])$\n\n\u5176\u5927\u81f4\u610f\u601d\u662f\uff1a$j$+$1$~ $i$ \u9879\u7684\u603b\u548c\u4e58\u4e0a $b$\n\n\u6240\u4ee5\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5206\u6bb5\uff0c\u6211\u4eec\u90fd\u53ef\u4ee5\u5f97\u5230\u4e00\u4efd$b*(sum[r]-sum[l])$\u7684\u6218\u6597\u529b\n\n\u7136\u540e\u6211\u4eec\u5c06\u8fd9\u4e9b\u5206\u6bb5\u7684 $b*(sum[r]-sum[l])$ \u63a5\u8d77\u6765\uff0c\u5c31\u6709\n\n$b*(sum[r1]-sum[l1])+b*(sum[r2]-sum[l2])+...+b*(sum[rk]-sum[lk])$\n\n\u5176\u4e2d\uff0c$0=l1$\uff0c$r1=l2$\uff0c$r2=l3$\uff0c$rk=n$ (\u8981\u662f\u4f60\u4eec\u8fde\u8fd9\u4e2a\u90fd\u4e0d\u61c2\uff0c\u90a3\u6ca1\u529e\u6cd5\u4e86)\n\n\u6211\u4eec\u6109\u5feb\u5730\u6d88\u6389\u540c\u7c7b\u9879\uff0c\u5f97\u5230\uff1a\n\n$b*(sum[n]-sum[0])=b*sum[n]$\n\n\u6240\u4ee5\u8fd9\u9053\u9898\u548c $b$ \u662f\u6ca1\u4ec0\u4e48\u5173\u7cfb\u7684\uff0c\u539f\u9898\u4fbf\u8f6c\u5316\u4e3a\u6c42\u5404\u4e2a $a*x^2+c$ \u7684\u6700\u5927\u548c\uff0c\u6700\u540e\u628a\u7b54\u6848\u52a0\u4e0a $b*sum[n]$ \u5373\u53ef\n\n\u5f53\u7136\uff0c\u659c\u7387\u65b9\u7a0b\u91cc\u9762\u4e5f\u53ef\u4ee5\u4e0d\u7528\u628a $b$ \u7ed9\u52a0\u8fdb\u53bb\u4e86\n\n\u5443\uff0c\u5176\u4ed6\u9898\u89e3\u7684\u601d\u8def\u4e5f\u662f\u6b63\u786e\u7684\uff0c\u6211\u53ea\u662f\u63d0\u4f9b\u4e2a\u65b0\u7684\u601d\u8def\u800c\u5df2\n\n# \u4ee3\u7801\n```cpp\n#include<cstdio>\nusing namespace std;\ntypedef long long ll;\nint list[1000005],head=1,tail=1;\nll f[1000005];\nll sum[1000005],a,b,c;\nll Y(int k,int j){return f[j]-f[k]+(sum[j]*sum[j]-sum[k]*sum[k])*a;}\nll X(int k,int j){return sum[j]-sum[k];}\ndouble slop(int j,int k){return ((double)Y(j,k))/((double)X(j,k));}\nint main()\n{\n\tint n;scanf(\"%d%lld%lld%lld\",&n,&a,&b,&c);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%lld\",&sum[i]);\n\t\tsum[i]+=sum[i-1];\n\t}\n\tlist[1]=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(head<tail&&slop(list[head],list[head+1])>(double)(2.0*a*sum[i]))head++;\n\t\tint j=list[head];\n\t\tf[i]=f[j]+(sum[i]-sum[j])*(sum[i]-sum[j])*a+c;\n\t\twhile(head<tail&&slop(list[tail-1],list[tail])<slop(list[tail],i))tail--;\n\t\tlist[++tail]=i;\n\t}\n\tprintf(\"%lld\\n\",f[n]+sum[n]*b);\n\treturn 0;\n}\n```\n",
        "postTime": 1562242916,
        "uid": 120634,
        "name": "2018heyuyang",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3628 \u3010\u7279\u522b\u884c\u52a8\u961f\u3011"
    },
    {
        "content": "\u9996\u5148\u8fd9\u79cd\u6709\u533a\u95f4\u548c\u7684\u9898\uff0c\u524d\u7f00\u548c\u662f\u9003\u4e0d\u6389\u4e86\u3002\n\n\u8bbe\n$$S_i=\\sum_{j=1}^ia_i$$\n\n\u6211\u4eec\u53ef\u4ee5\u5148\u5217\u4e00\u4e2a\u7b80\u5355\u7684dp\u65b9\u7a0b:\n$$\nf(i)=\\min_{j=1}^{i-1} \\{A(S_i-S_j)^2+B(S_i-S_j)+C\\}\n$$\n\u5148\u53bb\u6389$min$\u7b26\u53f7\uff0c\u7136\u540e\u6574\u7406\uff1a\n$$\n2AS_iS_j-AS_i^2-BS_i-C+f(i)=f(j)+AS_j^2-BS_j\n$$\n\u6211\u4eec\u628a\u6240\u6709\u4e0e$i$\u6709\u5173\u7684\u5168\u90e8\u9879\u79fb\u5230\u5de6\u8fb9\uff0c\u5176\u4f59\u79fb\u5230\u53f3\u8fb9\u3002\u5e76\u4e14\u4ee5$j$\u4e3a\u4e3b\u5143\uff0c\u628a$j$\u548c$S_j$\u7b49\u770b\u4f5c\u53d8\u91cf\uff0c\u5176\u4f59\u770b\u4f5c\u5e38\u6570\u3002\u7136\u540e\u6211\u4eec\u786e\u4fdd$2AS_i$\u4e3a\u6b63\u6570\u3002\uff08\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u628a$A$\uff0c$B$\uff0c$C$\u5747\u4e58\u4ee5$-1$\uff0c\u7136\u540e\u6c42$f(i)$\u7684\u6700\u5c0f\u503c\uff09\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u6784\u9020$i-1$\u4e2a\u70b9\uff0c\u5f62\u5982$(S_j,f(j)+AS_j^2-BSj) (1\\leq j \\leq i-1)$\uff0c\u79f0\u4e3a\u201c\u51b3\u7b56\u70b9\u201d\u3002 \u8bbe\u7b2c$k$\u4e2a\u70b9\u4e3a$P_k$\u3002(\u5176\u5b9e\u672c\u6765\u5e94\u8be5\u6709n\u4e2a\u51b3\u7b56\u70b9\u7684\uff0c\u4e0d\u8fc7\u8ba1\u7b97$f(i)$\u65f6$P_i,P_{i+1}\\cdots P_n$\u90fd\u6ca1\u6709\u7528)\n\n\u6211\u4eec\u8ba9\u4e00\u6761\u659c\u7387\u4e3a$2AS_i$\u7684\u76f4\u7ebf\u4f9d\u6b21\u7ecf\u8fc7\u8fd9$i-1$\u4e2a\u70b9\uff0c\u7136\u540e\u627e\u5230\u4f7f\u5b83\u5728$y$\u8f74\u4e0a\u7684\u622a\u8ddd\u6700\u5c0f\u7684\u70b9\u5373\u53ef\u3002\n\n\u6ce8\u610f\u5230\u5f53\u76f4\u7ebf$P_{j-1}P_j$\u7684\u659c\u7387\u5927\u4e8e$P_jP_{j+1}$\u65f6\uff0c$P_j$\u4e00\u5b9a\u4e0d\u662f\u6211\u4eec\u8981\u627e\u7684\u70b9\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u6765\u7ef4\u62a4\u6240\u6709\u7684\u51b3\u7b56\u70b9\uff0c\u6bcf\u6b21\u63d2\u5165\u4e00\u4e2a\u65b0\u51b3\u7b56\u70b9\u65f6\uff0c\u5148\u68c0\u67e5\u5b83\u4e0e\u961f\u9996\u6784\u6210\u7684\u76f4\u7ebf\u7684\u659c\u7387\uff0c\u4ee5\u53ca\u961f\u9996\u7684\u4e24\u4e2a\u70b9\u6784\u6210\u7684\u76f4\u7ebf\u7684\u659c\u7387\uff0c\u5982\u679c\u4e0d\u5bf9\u5c31\u628a\u961f\u9996\u6254\u6389\uff0c\u5e76\u7ee7\u7eed\u3002\uff08\u8be6\u89c1\u4ee3\u7801\uff09\n\n![](https://cdn.luogu.com.cn/upload/pic/60134.png)\n\n\u8fd9\u4e2a\u4e0d\u5bf9\n\n![](https://cdn.luogu.com.cn/upload/pic/60135.png)\n\n\u8fd9\u4e2a\u5bf9\n\n\n\n\u5e76\u4e14\uff0c\u5982\u679c$P_{j-1}Pj$\u7684\u659c\u7387\u5927\u4e8e$2AS_i$\uff0c\u8bf4\u660e$P_{j-1}$\u4f18\u4e8e$P_j$\u3002\u5982\u679c$P_jP_{j+1}$\u7684\u659c\u7387\u5c0f\u4e8e$2AS_i$\uff0c\u8bf4\u660e$P_{j+1}$\u4f18\u4e8e$P_j$\u3002\u56e0\u6b64\uff0c\u5982\u679c\u6709\u4e09\u4e2a\u70b9$P_{j-1}$,$P_j$,$P_{j+1}$\uff0c\u6ee1\u8db3$K_{P_{j-1}P_j}<2AS_i\\leq K_{P_jP{j+1}}$\uff0c\u90a3\u4e48$P_j$\u5c31\u662f\u6700\u4f18\u51b3\u7b56\u70b9\u3002\u5728\u672c\u9898\u4e2d\uff0c\u7531\u4e8e$2AS_i$\u5355\u8c03\u9012\u589e\uff0c\u6240\u4ee5\u82e5$P_jP_{j+1}$\u7684\u659c\u7387\u5c0f\u4e8e$2AS_i$\uff0c\u5c31\u53ef\u4ee5\u628a$P_j$\u6254\u6389\uff0c\u8fd9\u6837\u961f\u5c3e\u6c38\u8fdc\u662f\u5f53\u524d\u6700\u4f18\u7684\u51b3\u7b56\u70b9\u3002\u4f46\u662f\uff0c\u5728\u67d0\u4e9b\u95ee\u9898\u4e2d\uff0c\u659c\u7387\u5e76\u4e0d\u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u8fd9\u65f6\u4e0d\u80fd\u628a\u961f\u5c3e\u6254\u6389\uff0c\u800c\u662f\u6bcf\u6b21\u8981\u4f7f\u7528\u4e8c\u5206\u67e5\u627e\u7684\u6280\u5de7\uff0c\u627e\u5230\u7b2c\u4e00\u6761\u659c\u7387\u4e0d\u5c0f\u4e8e$2AS_i$\u7684\u76f4\u7ebf\u3002\n\n\u7136\u540e\u5c31\u770b\u4ee3\u7801\u5427\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#define debug printf(\"Running %s on line %d...\\n\",__FUNCTION__,__LINE__)\n#define in inline\n#define re register\n#define sqr(i) (ll((i))*(i))\n#define F(i) (A*sqr(s[(i)])-B*s[(i)]+f[(i)])\nusing namespace std;\ntypedef long long ll;\ntypedef double db;\nin int read()\n{\n    int ans=0,f=1;char c=getchar();\n    for (;!isdigit(c);c=getchar()) if (c=='-') f=-1;\n    for (;isdigit(c);c=getchar()) ans=(ans<<3)+(ans<<1)+(c^48);\n    return ans*f;\n}\nint a[1000005],s[1000005];\nint q[1000005],l,r;\nll f[1000005];\nll A,B,C;\n// f(i)=f(j)+A(s[i]-s[j])^2+B(s[i]-s[j])+C\n//     =f(j)+A*s[i]^2-2As[i]s[j]+As[j]^2+Bs[i]-Bs[j]+C\n// 2As[i]s[j]-As[i]^2-Bs[i]-C+f(i)=f(j)+As[j]^2-Bs[j]\nint main()\n{\n    int n=read();\n    A=-read(),B=-read(),C=-read();\n    for (int i=1;i<=n;i++) a[i]=read(),s[i]=s[i-1]+a[i];\n    l=r=1;\n    for (int i=1;i<=n;i++)\n    {\n        while (r>l && (F(q[l+1])-F(q[l]))<2*A*s[i]*(s[q[l+1]]-s[q[l]])) l++;\n        f[i]=f[q[l]]+A*sqr(s[i]-s[q[l]])+B*(s[i]-s[q[l]])+C;\n        while (r>l && (F(q[r])-F(q[r-1]))*(s[i]-s[q[r]])>(F(i)-F(q[r]))*(s[q[r]]-s[q[r-1]])) r--;\n        q[++r]=i;\n    }\n    cout<<-f[n]<<endl;\n    return 0;\n}\n\n```\n\n\n\n\n\n\n\n",
        "postTime": 1559685300,
        "uid": 107935,
        "name": "Thomasguo666",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "\u5c45\u7136\u81ea\u5df1\u63a8\u51fa\u6765\u4e86\u4e00\u6b21\u659c\u7387\u4f18\u5316\uff0c\u70ed\u6cea\u76c8\u7736\uff08\u96fe\uff09\n\n\u7136\u540e\u4e0d\u5c0f\u5fc3\u7ef4\u62a4\u51f8\u58f3\u7684\u65f6\u5019\u5927\u4e8e\u53f7\u5199\u9519\u4e86\u2026\u2026\u54ed\u4e86\n\n\u8fdb\u5165\u6b63\u9898\uff0c\u8fd9\u9053\u9898\u7684\u8f6c\u79fb\u65b9\u7a0b\u8fd8\u662f\u5f88\u660e\u663e\u7684\uff08$sum$\u8bb0\u5f55\u524d\u7f00\u548c\uff09\uff1a\n\n$$f[i]=\\sum_{j=1}^{i-1}max(f[j]+a\\times (sum[i]-sum[j])^2+b\\times (sum[i]-sum[j])+c)$$\n\n\u9996\u5148\u5f88\u660e\u663e\uff0c\u8fd9\u4e2a\u4e1c\u897f\u662f$n^2$\u7684\uff0c\u5fc5\u7136\u4f1a$T$\u6389\uff0c\u6240\u4ee5\u8003\u8651\u659c\u7387\u4f18\u5316\n\n\uff08\u4f46\u662f\u6211\u8fd9\u79cd\u83dc\u9e21\u53ea\u4f1a\u7528 \u4e0d\u5f88\u61c2\u539f\u7406\uff09\n\n\u5047\u5b9a\u51b3\u7b56$j$\u6bd4$k$\u66f4\u4f18\uff0c\u5f53\u4e14\u4ec5\u5f53\uff1a\n\n$$f[j]+a\\times(sum[i]-sum[j])^2+b\\times (sum[i]-sum[j])+c>$$\n\n$$f[k]+a\\times(sum[i]-sum[k])^2+b\\times(sum[i]-sum[k])+c\\quad\\  $$\n\n\uff08\u9884\u9632\u8d85\u51fa\u8fb9\u754c\u53ea\u80fd\u8fd9\u4e48\u5199\u4e86$QAQ$\uff09\n\n\u62c6\u5f00\u6765\u5982\u4e0b\uff1a\n\n$$f[j]+a\\times sum[i]^2+2a\\times sum[i]\\times sum[j]+a\\times sum[j]^2+b\\times sum[i]-b\\times sum[j]+c >$$\n\n$$f[k]+a\\times sum[i]^2+2a\\times sum[i]\\times sum[k]+a\\times sum[k]^2+b\\times sum[i]-b\\times sum[k]+c\\quad$$\n\n\uff08\u597d\u591a\u5f0f\u5b50\u554a(\u256f\u2035\u25a1\u2032)\u256f\ufe35\u253b\u2501\u253b\uff09\n\n\u786c\u7740\u5934\u76ae\u79fb\u9879\uff0c\u628a\u540c\u65f6\u548c$i,j$\u6709\u5173\u7684\u9879\u548c\u540c\u65f6\u4e0e$i,k$\u6709\u5173\u7684\u9879\u79fb\u5230\u4e00\u8fb9\uff0c\u5176\u4ed6\u7684\u5168\u90e8\u4e22\u5230\u53e6\u4e00\u8fb9\uff0c\u540c\u7c7b\u9879\u5408\u5e76\u4e00\u4e0b\uff0c\u7ed3\u679c\u5982\u4e0b\uff1a\n\n$$2a\\times sum[i]\\times (sum[j]-sum[k])>$$\n\n$$a\\times (sum[k]^2-sum[j]^2)+b\\times (sum[j]-sum[k])+(f[k]-f[j])$$\n\n\u4ee4\u5de6\u5f0f\uff08\u5176\u5b9e\u662f\u4e0a\u5f0f\uff09\u53ea\u4e0e$i$\u6709\u5173\uff0c\u5219\u53ef\u5f97\uff1a\n\n$$sum[i]>\\frac{a\\times (sum[k]^2-sum[j]^2)+b\\times (sum[j]-sum[k])+(f[k]-f[j])}{2a\\times (sum[j]-sum[k])}$$\n\n\u7136\u540e\u6211\u4eec\u5c31$get$\u4e86\u659c\u7387\u600e\u4e48\u7b97\uff08\u53f3\u8fb9\u90a3\u5768\uff09\n\n\u63a5\u7740\u6211\u4eec\u8003\u8651\u7ef4\u62a4\u7684\u662f\u4e0a\u51f8\u58f3\u8fd8\u662f\u4e0b\u51f8\u58f3\uff0c\u9996\u5148\u56de\u5934\u770b\u4e4b\u524d\u7684\u8f6c\u79fb\u65b9\u7a0b\uff0c\u628a\u5b83\u62c6\u5f00\u5e94\u8be5\u662f\u8fd9\u6837\u7684\uff1a\n\n$$f[i]=\\sum_{j=1}^{i-1}max(f[j]+a\\times sum[i]^2-2a\\times sum[i]\\times sum[j]+a\\times sum[j]^2+b\\times sum[i]-b\\times sum[j]+c)$$\n\n\u8bbe\u76f4\u7ebf\u4e3a\uff1a\n\n$$y=kx+b$$\n\n\u56e0\u4e3a$x$\u662f\u81ea\u53d8\u91cf\uff0c\u6240\u4ee5\u4ee4$x$\u7b49\u4e8e$sum[j]$\uff0c\u65e2\u7136$x=sum[j]$\uff0c\u4ee4$k=2a\\times sum[i]$\uff0c\u4ee4$y=f[j]+a\\times sum[j]^2$\uff0c$b=f[i]-a\\times sum[i]^2-b\\times sum[i]-c$\uff0c\u53ef\u4ee5\u53d1\u73b0\u659c\u7387$k$\u5355\u8c03\u9012\u51cf\uff08\u56e0\u4e3a$a<0$\uff09\uff0c\u56e0\u6b64\u7ef4\u62a4\u4e0a\u51f8\u58f3\u5373\u53ef\n\n\u89c1\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nint n;\nll a,b,c;\nll sum[1000005],f[1000005],q[1000005];\ndouble Slope(int x,int y)\n{\n\treturn (double)(a*(sum[x]*sum[x]-sum[y]*sum[y])+b*(sum[y]-sum[x])+f[x]-f[y])/(double)(a*2*(sum[x]-sum[y]));\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tscanf(\"%lld %lld %lld\",&a,&b,&c);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tll x;\n\t\tscanf(\"%lld\",&x);\n\t\tsum[i]=sum[i-1]+x;\n\t}\n\tint head=1,tail=1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(head<tail && Slope(q[head],q[head+1])<=sum[i]) head++;\n\t\tf[i]=f[q[head]]+a*(sum[i]-sum[q[head]])*(sum[i]-sum[q[head]])+b*(sum[i]-sum[q[head]])+c;\n\t\twhile(head<tail && Slope(q[tail-1],q[tail])>=Slope(q[tail],i)) tail--;\n\t\tq[++tail]=i;\n\t}\n\tprintf(\"%lld\\n\",f[n]);\n\treturn 0;\n}\n```",
        "postTime": 1545122813,
        "uid": 23243,
        "name": "VenusM1nT",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "## \u524d\u8a00\n\u611f\u89c9\u5404\u4f4d\u5927\u4f6c\u7684\u9898\u89e3\u5df2\u7ecf\u5f88\u8be6\u7ec6\u4e86\uff0c\u4f46\u662f\u6211\u53d1\u73b0\u6211\u63a8\u7684\u659c\u7387\u4f18\u5316\u4e0d\u592a\u4e00\u6837\uff0c\u7279\u6765\u53d1\u4e00\u53d1\u6211\u7684\u89e3\u6cd5\n\n\u4eca\u5929\u8d85\u7ea7\u5f00\u5fc3\uff0c\u4e00\u53d1\u8fc7$dp$\u7d2b\u9898\u3002\u4e3b\u8981\u601d\u8def\u4fbf\u662f\u7528\u659c\u7387\u4f18\u5316+\u5355\u8c03\u961f\u5217\n\n\u5982\u4e0d\u4f1a\u4ee5\u4e0a\u4e24\u79cd\u7b97\u6cd5\u8bf7\u81ea\u89c9\u770b\u5230:\n\n1\u3001$P3195$ $[HNOI2008]$\u73a9\u5177\u88c5\u7bb1$TOY$\uff08\u57fa\u7840\u659c\u7387\u4f18\u5316\uff09\n\n2\u3001$P1886$ \u6ed1\u52a8\u7a97\u53e3\uff08\u57fa\u7840\u5355\u8c03\u961f\u5217\uff09\n\n## \u6b63\u6587\n\n\u5148\u7ef4\u62a4\u4e00\u4e2a\u524d\u7f00\u548c$sum$\uff0c\u90a3\u4e48\u6613\u77e5$(l,r]$\u4e2d\u7684$x[i]$\u548c\u4e3a$sum[r]-sum[l]$\n\n\u90a3\u4e48$dp[i]$\u8868\u793a\u524d$i$\u4e2a\u4eba\u7684\u6700\u5927\u6218\u6597\u529b\u548c\uff0c\u90a3\u4e48\u63a8\u5f97\u65b9\u7a0b\u4e3a\n\n$$dp[i]=max(dp[i],dp[j]+a*(sum[j]-sum[i])^2+b*(sum[j]-sum[i])+c)$$\n\n\u90a3\u4e48\u5c06\u8fd9\u90e8\u5206$dp[j]+a*(sum[j]-sum[i])^2+b*(sum[j]-sum[i])+c$\u6765\u7528\u659c\u7387\u4f18\u5316\n\n\u8bbe$j<k<i$\uff0c\u4e0d\u59a8\u4ee4$$dp[j]+a*(sum[i]-sum[j])^2+b*(sum[i]-sum[j])+c\\leq dp[k]+a*(sum[i]-sum[k])^2+b*(sum[i]-sum[k])+c$$\n\n\u7ea6\u53bb$c$\u5f97\n\n$$dp[j]+b*(sum[i]-sum[j]-sum[i]+sum[k])\\leq dp[k]+a*(sum[i]-sum[k]+sum[i]-sum[j])(sum[j]-sum[k]) $$\n\n\u6574\u7406\u5f97\n\n$$dp[j]+b*(sum[k]-sum[j])\\leq dp[k]+a*(2*sum[i]-sum[k]-sum[j])(sum[j]-sum[k])$$\n\n\u53d1\u73b0\u76f8\u540c\u56e0\u5f0f$(sum[j]-sum[k])$,\u79fb\u9879\u5f97\n\n$$[a*(2*sum[i]-sum[k]-sum[j])+b]*(sum[k]-sum[j])\\leq dp[k]-dp[j]$$\n\n\u6240\u4ee5\u5f97\n\n$$a*(2*sum[i]-sum[k]-sum[j])\\leq \\frac{dp[k]-dp[j]}{sum[k]-sum[j]}-b$$\n\n\u6ce8\u610f\uff01\uff01\uff01$a$\u662f\u8d1f\u6570\uff01\uff01\uff01\u4e0a\u6b21\u63a8\u659c\u7387\u4f18\u5316\u5c31\u662f\u88ab\u8fd9\u4e2a\u5751\u4e86\n\n\u6700\u7ec8\u5f97\uff08\u8fd9\u91cc$Tex$\u516c\u5f0f\u4e24\u5c42\u5206\u5f0f\u4e0d\u597d\u770b\uff09\n\n$$2*sum[i]\\geq \\frac{(dp[k]-dp[j])/(sum[k]-sum[j])-b}{a}$$\n\n\u90a3\u4e48\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u5305\uff0c\u7ef4\u62a4\u4e00\u4e2a\u5e8f\u53f7\u5355\u8c03\u9012\u589e\u4e14\u7ecf\u6218\u6597\u529b\u516c\u5f0f\n\n$$a*(sum[i]-sum[j])*(sum[i]-sum[j])+b*(sum[i]-sum[j])+c+dp[j]$$\n\n\u8ba1\u7b97\u540e\u7684\u6218\u6597\u529b\u548c\u5355\u8c03\u9012\u51cf\u7684\u5355\u8c03\u961f\u5217\n\n\u8865\u5145\uff1a$long\\ long$\u8f6c$double$\u7c7b\u578b\u6ce8\u610f\u4e58\u4e0a$1.0$\u6216\u8005\u5f3a\u884c\u8f6c$double$\uff01\u8fd9\u662f\u4e0a\u6b21\u4ed3\u5e93\u5efa\u8bbe\u7684\u60e8\u75db\u6559\u8bad\n\n$Code\\ Below:$\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\n#define maxn 1000010\nusing namespace std;\nll n,a,b,c,sum[maxn];\nll dp[maxn],q[maxn],head=1,tail=1;\n\ndouble slope(ll j,ll k){\n\treturn (((((dp[k]-dp[j])*1.0/(sum[k]-sum[j]))-b)*1.0/a)+(sum[k]+sum[j])*1.0); \n}\nll calc(ll i,ll j){\n\treturn a*(sum[i]-sum[j])*(sum[i]-sum[j])+b*(sum[i]-sum[j])+c+dp[j];\n}\nint main()\n{\n\tscanf(\"%lld\",&n);\n\tscanf(\"%lld%lld%lld\",&a,&b,&c);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%lld\",&sum[i]);\n\t\tsum[i]+=sum[i-1];\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\twhile(head<tail&&slope(q[head],q[head+1])<=2*sum[i])\n\t\t\thead++;\n\t\tdp[i]=calc(i,q[head]);\n\t\twhile(head<tail&&slope(q[tail],i)<=slope(q[tail-1],q[tail]))\n\t\t\ttail--;\n\t\tq[++tail]=i;\n\t}\n\tprintf(\"%lld\\n\",dp[n]);\n\treturn 0;\n}\n```",
        "postTime": 1531980301,
        "uid": 35069,
        "name": "Owen_codeisking",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "### P3628 [APIO2010]\u7279\u522b\u884c\u52a8\u961f\n#### Solution\n$$f(i)=\\max f(j)+a\\left(\\sum_{k=j+1}^ix_k\\right)^2+b\\sum_{k=j+1}^ix_k+c$$\n\u56e0\u4e3a\u8fd9\u4e48\u8868\u793a\u4e0d\u662f\u5f88\u65b9\u4fbf, \u5219\u7528$x_j$\u4ee3\u66ff$\\sum\\limits{k=j+1}^ix_k$.\u5219\u5f0f\u5b50\u53d8\u4e3a\n$$f(i)=\\max f(j)+ax_j^2+bx_j+c$$\n\u82e5$f(j)$\u6bd4$f(k)$\u8f6c\u79fb\u5230$f(i)$\u66f4\u4f18, \u5219\n$$f(j)+ax_j^2+bx_j+c>f(k)+ax_k^2+bx_k+c$$\n\u5c06$x_j$\u8868\u793a\u6210\u524d\u7f00\u548c\u7684$s_i-s_j$\u7684\u5f62\u5f0f, \u5219\u5f0f\u5b50\u8fdb\u4e00\u6b65\u53d8\u4e3a\n$$s_i<\\frac{f(j)-f(k)+as_j^2-as_k^2-bs_j+bs_k}{2as_j-2as_k}$$\n\u5219\u53ef\u4ee5\u7528**\u659c\u7387\u4f18\u5316**\u4f18\u5316\u8f6c\u79fb.\u5355\u8c03\u961f\u5217\u6bcf\u4e2a\u70b9\u53ea\u4f1a\u88ab\u63d2\u5165\u5220\u9664\u4e00\u6b21, \u5747\u644a\u590d\u6742\u5ea6$O(n)$.\n#### Code\n\u9700\u8981\u7528long long, \u4e0d\u7528\u4f1a\u51fa\u795e\u5947\u9519\u8bef.\n```c++\n#include<iostream>\n#include<cstdio>\n#define N 1000005\n#define int long long\nusing namespace std;\n\nint a,b,c,d[N],s[N];\nint q[N],f[N];\nint h,t;\nint n;\n\ndouble slope(int j,int k){\n    return (double)(f[j]-f[k]+a*s[j]*s[j]-a*s[k]*s[k]-b*s[j]+b*s[k])/(double)(2*a*s[j]-2*a*s[k]);\n}\n\nmain(){\n    h=t=1;\n    scanf(\"%lld\",&n);\n    scanf(\"%lld%lld%lld\",&a,&b,&c);\n    for(int i=1;i<=n;++i)scanf(\"%lld\",&d[i]);\n    for(int i=1;i<=n;++i)s[i]=s[i-1]+d[i];//\u524d\u7f00\u548c\n    for(int i=1;i<=n;++i){\n        while(h<t&&slope(q[h],q[h+1])<=s[i]*1.0)++h;//\u4e0d\u6ee1\u8db3\u5f0f\u5b50\u7684\u53bb\u6389\n        int j=q[h],x=s[i]-s[j];\n        f[i]=f[j]+a*x*x+b*x+c;//\u7b97\u51fadp\u503c\n        while(h<t&&slope(q[t-1],q[t])>=slope(q[t],i))--t;//\u5c06f[i]\u52a0\u5165\u5355\u8c03\u961f\u5217\n        q[++t]=i;\n    }\n    printf(\"%lld\",f[n]);\n    return 0;\n}\n```",
        "postTime": 1525936363,
        "uid": 39067,
        "name": "aiyougege",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "\u9996\u5148\u8bfb\u9898\u540e\u7b2c\u4e00\u611f\u89c9\u8fd9\u662f\u4e2adp\uff1b\n\n\u7136\u540e\u6211\u4eec\u7ee7\u7eed\u770b\u5230\u65b9\u7a0b =\u300b\u4e00\u822c\u6765\u8bf4\u8fd9\u79cd\u9898\u5c31\u53ef\u4ee5\u7528\u659c\u7387\u4f18\u5316\u4e86\u3002\n\n\u7136\u540e\u6211\u4eec\u5f88\u5bb9\u6613\u63a8\u5bfc\u5f97\u5230f[i] = max(f[j]+a(s[i]-s[j])^2+b(s[i]-s[j])+c\uff1b\n\n\u8bbek < j\u4e14j\u4f18\u4e8ek\uff1b\n\n\u5373\u6709\uff1af[j]+a(s[i]-s[j])^2+b(s[i]-s[j])+c >= f[k]+a(s[i]-s[k])^2+b(s[i]-s[k])+c\uff1b\n\n\u5c55\u5f00\u5f97\u5230\uff1a(f[j]-f[k] + a\\*(pow(s[j])-pow(s[k]))+b\\*(s[k]-s[j]))/(2.0\\*a\\*(s[j]-s[k])) < s[i]\uff08\u8fd9\u91cc\u590d\u5236\u7684\u5e95\u4e0b\u4ee3\u7801\uff0c\u61d2\u5f97\u6253\u4e86QAQ\uff09\n\n\u7136\u540e\u5c31\u5957\u659c\u7387\u4f18\u5316\u5c31\u597d\u4e86\uff1b\n\nok\uff1b\n\nc++\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<iostream>\n#include<algorithm>\n#include<cstdio>\n#include<cmath>\n#include<queue>\nusing namespace std;\ntypedef long long ll;\ndeque<int>q;\nconst int N = 1e6 + 10;\nint z[N],n,a,b,c;\nll s[N],f[N];\ninline void read(int&x){\n    x = 0;int sign = 1;char c;\n    do{ c = getchar();if(c == '-') sign = -1; }while(c < '0' || c >'9');\n    do{ x = x*10 + c - '0';c = getchar(); }while(c <= '9' && c >='0');\n    x*=sign;\n}\ninline ll pow(ll x){ return x*x; }\ninline double slop(int k,int j){ return (double)(f[j]-f[k] + a*(pow(s[j])-pow(s[k]))+b*(s[k]-s[j]))/(2.0*a*(s[j]-s[k])); }\nint main()\n{\n    read(n);read(a);read(b);read(c);\n    for(int i = 1;i <= n;i++) read(z[i]),s[i] = s[i-1] + z[i];\n    q.push_back(0);\n    for(int i = 1;i <= n;i++)\n    {\n        while(q.size() > 1 && slop(q[0],q[1]) < s[i]) q.pop_front();\n        int x = q.front(),j,t=s[i]-s[x];\n        f[i] = f[x] + a*t*t + b*t+c;\n        while((j = q.size())> 1 && slop(q[j-1],i) < slop(q[j-2],q[j-1])) q.pop_back();\n        q.push_back(i);\n    }\n    cout<<f[n];\n    return 0;\n}\n\u53e6\u5916\u5b89\u5229\u4e0b\u6211\u7684blog\uff1a< http://tgotp.science >\n```",
        "postTime": 1497170590,
        "uid": 23087,
        "name": "Tgotp",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "# \u7279\u522b\u884c\u52a8\u961f\u9898\u89e3\n~~\u5237\u6c34\u9898\u4ec0\u4e48\u7684\u6700\u6109\u5feb\u4e86\u3002~~\n\n\u9898\u610f\u5341\u5206\u660e\u4e86\uff0c\u5c31\u662f\u9009\u51fa\u4e00\u79cd\u5206\u914d\u65b9\u6848\u5c06\u58eb\u5175\u5206\u4e3a\u82e5\u5e72\u7ec4\uff0c\u4f7f\u4fee\u6b63\u540e\u7684\u6218\u6597\u529b\u6700\u5927\u3002\n\n\u6211\u4eec\u5148\u53ef\u4ee5\u5199\u51fa\u66b4\u529bdp\u8f6c\u79fb\uff1a\n\n\u8bbe$f[n]$\u4e3a\u5c06\u524d$i$\u4e2a\u58eb\u5175\u5206\u7ec4\uff0c\u4e14\u7b2c$i$\u4e2a\u58eb\u5175\u4e3a\u6700\u540e\u4e00\u7ec4\u6700\u540e\u4e00\u4e2a\u7684\u6700\u5927\u6218\u6597\u529b\u3002\n\n$f[i]=max_{j=1}^{j<i}f[j]+a*\\sum_{k=j+1}^{k<=i}x[k] *\\sum_{k=j+1}^{k<=i}x[k] +b*\\sum_{k=j+1}^{k<=i}x[k] +c$\n\n\u65f6\u95f4\u590d\u6742\u5ea6:$O(n^3)$\n\n\u8bbe\u524d\u7f00\u548c$sum[i]=\\sum_{j=1}^{j<=i}x[j]$\n\n\u5219\u5316\u4e3a\uff1a$f[i]=max_{j=1}^{j<i}f[j]+a*(sum[i]-sum[j])*(sum[i]-sum[j])+b*(sum[i]-sum[j])+c$\n\n\u6700\u540e\u659c\u7387\u4f18\u5316\u4e00\u4e0b\uff1a\n\n\u62c6\u5f00\u5e73\u65b9\uff0c\u79fb\u9879\uff1a\n\n$f[i]-a*sum[i]*sum[i]-b*sum[i]-c+2*sum[i]*sum[j]=f[j]+a*sum[j]*sum[j]-b*sum[j]$\n\n\u5176\u4e2d:\n\n$\\bullet y=f[j]+a*sum[j]*sum[j]-b*sum[j]$\n\n$\\bullet k=2*sum[i]$\n\n$\\bullet x=sum[j]$\n\n$\\bullet b=f[i]-a*sum[i]*sum[i]-b*sum[i]-c$\n\n$\\therefore f[i]=y-kx+a*sum[i]*sum[i]+b*sum[i]+c$\n\n![\u89e3\u91ca](https://img2018.cnblogs.com/blog/1655789/201908/1655789-20190822154327907-790036712.png)\n\u4ee3\u7801\uff1a\n``` cpp\n#include<bits/stdc++.h>\n#define ll long long \nusing namespace std;\nconst int N=1000006;\nint n,head=1,tail=1;\nll f[N],sum[N],ans=0,a,b,c,t;\nstruct point{ll x,y;}tmp,q[N];\ninline int read(){\n   int T=0,F=1; char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-') F=-1; ch=getchar();}\n   while(ch>='0'&&ch<='9') T=(T<<3)+(T<<1)+(ch-48),ch=getchar();\n   return F*T; \n}\nbool check(point u,point v,int z){return v.y-u.y>=2*a*sum[z]*(v.x-u.x);}\nbool check2(point u,point v,point z){return (v.y-u.y)*(z.x-v.x)<=(z.y-v.y)*(v.x-u.x);}\nint main(){\n    n=read(),a=read(),b=read(),c=read();\n    q[tail].x=0,q[tail].y=0;\n    for(int i=1;i<=n;++i){\n        t=read(),sum[i]=sum[i-1]+t;\n        while(head<tail&&check(q[head],q[head+1],i)) ++head;\n        f[i]=a*sum[i]*sum[i]+b*sum[i]+q[head].y-2*a*sum[i]*q[head].x+c,ans=max(ans,f[i]),tmp.x=sum[i],tmp.y=f[i]+a*sum[i]*sum[i]-b*sum[i];\n        while(head<tail&&check2(q[tail-1],q[tail],tmp)) --tail;\n        q[++tail]=tmp;\n    } \n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n```",
        "postTime": 1566644869,
        "uid": 44180,
        "name": "ljk123",
        "ccfLevel": 0,
        "title": "\u7279\u522b\u884c\u52a8\u961f\u9898\u89e3"
    },
    {
        "content": "\u659c\u7387\u4f18\u5316\n\n\u4ee4$s_i=\\sum_{j=1}^{i}x_j$\n\n\u5199\u51fa\u66b4\u529bDP\u65b9\u7a0b\uff1a$dp_i=max(dp_j+a(s_i-s_j)^2+b(s_i-s_j)+c)$\n\n\u6309\u7167\u5957\u8def\n\n\u5982\u679c\u5b58\u5728\u4e24\u4e2a\u51b3\u7b56$x,y(x>y)$\uff0cx\u6bd4y\u66f4\u4f18\u5fc5\u987b\u6ee1\u8db3\n\n$dp_x+a(s_i-s_x)^2+b(s_i-s_x)+c>dp_y+a(s_i-s_y)^2+b(s_i-s_y)+c$\n\n\u5316\u7b80\u5f97$\\frac{(dp_x+as_x^2)-(dp_y+as_y^2)}{s_x-s_y}>b+2as_i$\n\n\u5355\u8c03\u6027\u6bd4\u8f83\u4e71\uff0c\u53d1\u73b0$a<0$\uff0c\u4e24\u8fb9\u4e58\u4e2a-1\n\n\u5f97$-\\frac{(dp_x+as_x^2)-(dp_y+as_y^2)}{s_x-s_y}<-b-2as_i$\n\n\u53f3\u8fb9\u90e8\u5206\u662f\u4e2a\u9012\u589e\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u7ef4\u62a4\u659c\u7387\u9012\u589e\u7684\u5355\u8c03\u961f\u5217\n\nCode\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#define maxn 1000010\n#define LL long long\nusing namespace std;\nLL n, A, B, C, s[maxn], q[maxn], dp[maxn];\n\ninline LL read(){\n\tLL s = 0, w = 1;\n\tchar c = getchar();\n\tfor (; !isdigit(c); c = getchar()) if (c == '-') w = -1;\n\tfor (; isdigit(c); c = getchar()) s = (s << 1) + (s << 3) + (c ^ 48);\n\treturn s * w;\n} \n\nLL sqr(LL x){ return x * x; }\nLL F(LL x){ return A * sqr(x) + B * x + C; }\ndouble slope(int x, int y){ return -1.0 * (dp[x] + A * sqr(s[x]) - dp[y] - A * sqr(s[y])) / (s[x] - s[y]); }\n\nint main(){\n\tn = read(), A = read(), B = read(), C = read();\t\n\tfor (int i = 1; i <= n; ++i) s[i] = read() + s[i - 1];\n\tint h = 0, t = 0;\n\tfor (int i = 1; i <= n; ++i){\n\t\twhile (h < t && slope(q[h + 1], q[h]) < (- B - 2LL * A * s[i])) ++h;\n\t\tdp[i] = dp[q[h]] + F(s[i] - s[q[h]]);\n\t\twhile (h < t && slope(q[t], q[t - 1]) > slope(i, q[t])) --t;\n\t\tq[++t] = i;\n\t}\n\tprintf(\"%lld\\n\", dp[n]);\n\treturn 0;\n}\n```\n",
        "postTime": 1565186479,
        "uid": 51719,
        "name": "ModestCoder_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "## \u9898\u9762\u63cf\u8ff0\n[\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P3628)\n\n## \u601d\u8def\n## \u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n\n\u5e94\u8be5\u5f88\u597d\u60f3:\n\n\u8bbe$s$\u4e3a\u6218\u6597\u529b\u524d\u7f00\u548c\uff0c\u90a3\u4e48\u6709\n\n$$F_i=\\max(F_j+a*(s_i-s_j)^2+b*(s_i-s_j)+c)$$\n\n## \u51b3\u7b56\u5355\u8c03\u6027\n\u8bbe\u6709\n$$F_k+a*(s_i-s_k)^2+b*(s_i-s_k)+c\\ge F_j+a*(s_i-s_j)^2+b*(s_i-s_j)+c$$\n\n\u5316\u7b80\u4e3a\n\n$$F_k-2*a*s_i*s_k+a*{s_k}^2-b*s_k\\ge F_j-2*a*s_i*s_j+a*{s_j}^2-b*s_j$$\n\n\u5bf9\u4e8e\u672a\u6765\u72b6\u6001$t$\uff0c\u8bc1\u660e:\n\n$$F_k+a*(s_t-s_k)^2+b*(s_t-s_k)+c\\ge F_j+a*(s_t-s_j)^2+b*(s_t-s_j)+c$$\n\n\u5316\u7b80\u4e3a\n\n$$F_k-2*a*s_t*s_k+a*{s_k}^2-b*s_k\\ge F_j-2*a*s_t*s_j+a*{s_j}^2-b*s_j$$\n\n\u7531\u4e8e$s_t=s_i+val$\uff0c\u5219\n\n$$F_k-2*a*(s_i+val)*s_k+a*{s_k}^2-b*s_k\\ge F_j-2*a*(s_i+val)*s_j+a*{s_j}^2-b*s_j$$\n\n\u6839\u636e\n\n$$F_k-2*a*s_i*s_k+a*{s_k}^2-b*s_k\\ge F_j-2*a*s_i*s_j+a*{s_j}^2-b*s_j$$\n\n\u53ea\u9700\u8981\u8bc1\u660e\n\n$$-2*a*val*s_k\\ge-2*a*val*s_j$$\n\n\u7531\u4e8e$a<0,val>0,s_k>s_j$\uff0c\u53ef\u77e5:\n\n$$val*s_k\\ge val*s_j$$\n\n\u8bc1\u6bd5\u3002\n\n## \u8e22\u961f\u5934\n\u6839\u636e\u4e0a\u6587\uff0c\n\n$$F_k-2*a*s_i*s_k+a*{s_k}^2-b*s_k\\ge F_j-2*a*s_i*s_j+a*{s_j}^2-b*s_j(k>j)$$\n\n$$F_j-F_k+a*{s_j}^2-a*{s_k}^2-b*s_j+b*s_k\\le 2*a*s_i*s_j-2*a*s_i*s_k$$\n\n$$(F_j+a*{s_j}^2-b*s_j)-(F_k+a*{s_k}^2-b*s_k)\\le 2*a*s_i*(s_j-s_k)$$\n\n\u7531\u4e8e$s_j-s_k<0,a<0$\uff0c\u6240\u4ee5\n\n$$calc(j,k)=\\frac{(F_j+a*{s_j}^2-b*s_j)-(F_k+a*{s_k}^2-b*s_k)}{a*(s_j-s_k)}\\le2*s_i$$\n\n\u5f53$calc(j,k)\\le 2*s_i$\u65f6\uff0c$k$\u4f18\u4e8e$j$.\n\n\u56e0\u6b64\u5f53$$calc(q_{head},q_{head+1})\\le 2*s_i$$\n\n$head+1$\u4f18\u4e8e$head$\u3002\n\n\u7531\u4e8e$s_i$\u968f$i$\u589e\u5927\u800c\u589e\u5927\uff0c\u90a3\u4e48$calc(q_{head},q_{head+1})$\u968f$head$\u589e\u5927\u800c\u589e\u5927\uff0c\u624d\u7b26\u5408$head$\u4e3a\u6700\u4f18\u89e3\uff0c\u56e0\u6b64\u659c\u7387\u662f\u4e0d\u65ad\u9012\u589e\u7684\u3002\n\n## \u8e22\u961f\u5c3e\n\u6839\u636e\u659c\u7387\u662f\u4e0d\u65ad\u9012\u589e\u7684\uff0c\u4ec5\u5f53\n\n$$calc(q_{tail},i)\\ge calc(q_{tail-1},q_{tail})$$\n\n\u659c\u7387\u624d\u6ee1\u8db3\u4e0d\u65ad\u9012\u589e\u3002\n\n\u6545\u5f53\n\n$$calc(q_{tail},i)\\le calc(q_{tail-1},q_{tail})$$\n\n\u5220\u53bb\u961f\u5c3e\u3002\n\n## AC code\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<cstdlib>\n#define gc getchar()\n#define ll long long\nusing namespace std;\nconst int N=1e6+10;\ninline void qr(ll &x)\n{\n\tx=0;int f=1;char c=gc;\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=gc;}\n\twhile(c>='0'&&c<='9'){x=x*10+(c^48);c=gc;}\n\tx*=f;\n}\ninline void qw(ll x)\n{\n\tif(x<0)x=-x,putchar('-');\n\tif(x/10)qw(x/10);\n\tputchar(x%10+48);\n}\nll s[N],a,b,c,f[N];\nint q[N],l,r;\ninline double calc(int j,int k)\n{\n\treturn ((f[j]+a*s[j]*s[j]-b*s[j])-(f[k]+a*s[k]*s[k]-b*s[k]))/(double)(a*(s[j]-s[k]));\n}\nint main()\n{\n\tint n;scanf(\"%d\",&n);\n\tqr(a),qr(b),qr(c);\n\tfor(int i=1;i<=n;i++)qr(s[i]),s[i]+=s[i-1];\n\tl=1;r=1;q[1]=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\twhile(l<r&&calc(q[l],q[l+1])<=2.0*s[i])++l;\n\t\tf[i]=f[q[l]]+a*(s[i]-s[q[l]])*(s[i]-s[q[l]])+b*(s[i]-s[q[l]])+c;\n\t\twhile(l<r&&calc(q[r],i)<=calc(q[r-1],q[r]))--r;\n\t\tq[++r]=i;\n\t}\n\tqw(f[n]);puts(\"\");\n\treturn 0;\n}\n```",
        "postTime": 1561984529,
        "uid": 106232,
        "name": "_Sein",
        "ccfLevel": 0,
        "title": "[APIO2010]\u7279\u522b\u884c\u52a8\u961f"
    },
    {
        "content": ">### [\u6d1b\u8c37\u9898\u76ee\u9875\u9762\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P3628)\n\n>\u9898\u610f\u89c1\u6d1b\u8c37\u3002\n\n\u8fd9\u9898\u4e00\u770b\u5c31\u662fDP\u3002\u3002\u3002\n\n\u8bbe$dp_i$\u8868\u793a\u524d$i$\u4e2a\u58eb\u5175\u7684\u6700\u5927\u6218\u6597\u529b\u3002\u663e\u7136\uff0c\u6700\u7ec8\u7b54\u6848\u4e3a$dp_n$\uff0cDP\u8fb9\u754c\u4e3a$dp_0=0$\uff0c\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u4e3a$dp_i=\\max\\limits_{j\\in[0,i)}\\left\\{dp_j+a\\left(\\sum\\limits_{k=j+1}^ix_k\\right)^2+b\\sum\\limits_{k=j+1}^ix_k+c\\right\\}$\u3002\n\u8fd9\u5176\u4e2d\u8981\u6c42\u533a\u95f4\u548c\uff0c\u53ef\u4ee5\u5148\u9884\u5904\u7406\u51fa\u524d\u7f00\u548c\u6570\u7ec4$Sum$\u3002\u90a3\u4e48\u65b9\u7a0b\u53d8\u4e3a\u4e86$dp_i=\\max\\limits_{j\\in[0,i)}\\left\\{dp_j+a(Sum_i-Sum_j)^2+b(Sum_i-Sum_j)+c\\right\\}$\u3002\n\n\u6734\u7d20\u5730\u8f6c\u79fb\u662f$\\operatorname{O}\\left(n^2\\right)$\u7684\uff0c\u80af\u5b9a\u4f1a\u8d85\u65f6\uff0c\u4e8e\u662f\u8981\u8003\u8651\u4f18\u5316\u3002\u4e4d\u4e00\u770b\uff0c\u8fd9\u65b9\u7a0b\u4e2d$\\max$\u7684\u4e0b\u754c\u4e0d\u52a8\u3001\u4e0a\u754c\u5728DP\u8fc7\u7a0b\u4e2d\u968f\u72b6\u6001\u53d8\u91cf$i$\u5355\u8c03\u9012\u589e\uff0c\u91cc\u9762\u53c8\u6709\u65e2\u548c\u72b6\u6001\u53d8\u91cf$i$\u53c8\u548c\u51b3\u7b56\u53d8\u91cf$j$\u76f8\u5173\u7684\u9879$(Sum_i-Sum_j)^2$\u2026\u2026\u8fd9\u4e0d\u5c31\u662f\u659c\u7387\u4f18\u5316\u7684\u6807\u5fd7\u5417\uff1f\n\n\u6211\u4eec\u5047\u8bbe\u6709\u4e24\u4e2a\u51b3\u7b56\u53d8\u91cf$j,k$\u6ee1\u8db3$j>k$\u4e14$j$\u6bd4$k$\u4f18\uff0c\u90a3\u4e48\n$$dp_j+a(Sum_i-Sum_j)^2+b(Sum_i-Sum_j)+c>dp_k+a(Sum_i-Sum_k)^2+b(Sum_i-Sum_k)+c$$\n\u5373\n$$dp_j+a(Sum_i-Sum_j)^2+b(Sum_i-Sum_j)>dp_k+a(Sum_i-Sum_k)^2+b(Sum_i-Sum_k)$$\n\u53bb\u62ec\u53f7\uff0c\u5f97\n$$dp_j+aSum_i^2-2aSum_iSum_j+aSum_j^2+bSum_i-bSum_j>dp_k+aSum_i^2-2aSum_iSum_k+aSum_k^2+bSum_i-bSum_k$$\n\u5373\n$$dp_j-2aSum_iSum_j+aSum_j^2-bSum_j>dp_k-2aSum_iSum_k+aSum_k^2-bSum_k$$\n\u628a\u53ea\u5173\u4e8e\u51b3\u7b56\u53d8\u91cf\u7684\u9879\u653e\u5230\u5de6\u8fb9\u6765\uff0c\u65e2\u5173\u4e8e\u72b6\u6001\u53d8\u91cf\u53c8\u5173\u4e8e\u51b3\u7b56\u53d8\u91cf\u7684\u9879\u653e\u5230\u53f3\u8fb9\u53bb\uff0c\u5f97\n$$\\left(dp_j+aSum_j^2-bSum_j\\right)-\\left(dp_k+aSum_k^2-bSum_k\\right)>2aSum_i(Sum_j-Sum_k)$$\n\u7531\u4e8e$j>k,x_i>0$\uff0c\u6240\u4ee5$Sum_j-Sum_k>0$**\uff08\u8fd9\u5c31\u662f\u8981\u8bbe${j>k}$\u7684\u539f\u56e0\uff09**\uff0c\u90a3\u4e48\u53ef\u4ee5\u628a$Sum_j-Sum_k$\u9664\u5230\u5de6\u8fb9\u53bb\u4e14\u4e0d\u7b49\u53f7\u65b9\u5411\u4e0d\u53d8\uff08\u540c\u7406\uff0c\u8bbe$j<k$\u4e5f\u53ef\u4ee5\uff0c\u53ea\u4e0d\u8fc7\u4e0d\u7b49\u53f7\u8981\u53d8\u65b9\u5411\uff09\uff0c\u5f97\n$$\\frac{\\left(dp_j+aSum_j^2-bSum_j\\right)-\\left(dp_k+aSum_k^2-bSum_k\\right)}{Sum_j-Sum_k}>2aSum_i$$\n\u8fd9\u65f6\uff0c\u5de6\u8fb9\u7684\u4e1c\u897f\u4f3c\u4e4e\u5f88\u773c\u719f\u2026\u2026\u662f\u4ec0\u4e48\u5462\u2026\u2026\u659c\u7387\uff01\u8fd9\u4e0d\u5c31\u76f8\u5f53\u4e8e**\u4ee5${dp_i+aSum_i^2-bSum_i}$\u4e3a\u70b9${i}$\u7684\u7eb5\u5750\u6807\uff0c\u4ee5${Sum_i}$\u4e3a\u70b9${i}$\u7684\u6a2a\u5750\u6807\u7684\u76f4\u89d2\u5750\u6807\u7cfb\u4e2d\uff0c\u70b9${k}$\u4e0e\u70b9${j}$\u4e4b\u95f4\u76f4\u7ebf\u7684\u659c\u7387**\u5417\uff1f\n\n\u6211\u4eec\u4ee4$f(j,k)$\u4e3a\u8fd9\u4e2a\u659c\u7387\u3002\u73b0\u5728\u8bbe$j,k,o$\u662f\u4e09\u4e2a\u51b3\u7b56\u53d8\u91cf\uff0c\u6ee1\u8db3$j>k>o$\uff0c\u90a3\u4e48\u82e5$f(j,k)\\ge f(k,o)$\uff0c\u53ef\u4ee5\u8bc1\u660e$k$\u6c38\u8fdc\u4e0d\u53ef\u80fd\u6210\u4e3a\u6700\u4f18\u51b3\u7b56\u3002\u56e0\u4e3a\u5f53$f(j,k)>2aSum_i$\u65f6\uff0c$j$\u6bd4$k$\u4f18\uff0c$k$\u4e0d\u662f\u6700\u4f18\u7684\uff1b\u5f53$f(j,k)\\le 2aSum_i$\u65f6\uff0c\u7ed3\u5408$f(j,k)\\ge f(k,o)$\u53ef\u4ee5\u5f97\u51fa$f(k,o)\\le 2aSum_i$\uff0c\u5373$k$\u4e0d\u6bd4$o$\u4f18\uff0c\u6b64\u65f6$k$\u4e5f\u4e0d\u662f\u6700\u4f18\u7684\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8981\u7ef4\u62a4\u4e00\u4e2a\u4e24\u4e2a\u5143\u7d20\u4e4b\u95f4\u7684\u76f4\u7ebf\u7684\u659c\u7387\u4e25\u683c\u5355\u8c03\u9012\u51cf\u7684\u51b3\u7b56\u5e8f\u5217$J$\uff08\u4e0b\u6807\u4ece$1$\u5f00\u59cb\uff09\uff0c\u5373\u4e00\u4e2a\u4e0a\u51f8\u58f3\uff0c\u53ea\u6709$J$\u91cc\u7684\u51b3\u7b56\u624d\u6709\u53ef\u80fd\u6700\u4f18\u3002\n\n\u4f46\u662f$J$\u91cc\u6709\u90a3\u4e48\u591a\u51b3\u7b56\uff0c\u90a3\u4e2a\u624d\u662f\u6700\u4f18\u7684\u5462\uff1f\u5982\u679c$J$\u4e2d\u6ca1\u6709\u4e00\u4e2a\u659c\u7387$\\le2aSum_i$\uff0c\u5373\u6240\u6709\u659c\u7387\u90fd$>2aSum_i$\uff0c\u663e\u7136$J_{|J|}$\u662f\u6700\u4f18\u51b3\u7b56\uff1b\u5982\u679c\u6709\uff0c\u8bbe$J_j$\u662f\u7b2c\u4e00\u4e2a$\\le2aSum_i$\u7684\u659c\u7387\u6240\u5bf9\u5e94\u7684\u76f4\u7ebf\u7684\u5de6\u7aef\u70b9\uff0c\u90a3\u4e48$J_j$\u662f\u6700\u4f18\u51b3\u7b56\u3002\n\n\u4e0d\u96be\u60f3\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u6808\u5145\u5f53$J$\uff0c\u88c5\u7740\u5bf9\u4e8e\u76ee\u524d\u7684$i$\uff0c\u6240\u6709\u53ef\u80fd\u6700\u4f18\u7684\u51b3\u7b56\uff0c\u7136\u540e\u4e8c\u5206\u627e\u5230\u6700\u4f18\u51b3\u7b56\u3002\u53ef\u662f\u5728DP\u7684\u8fc7\u7a0b\u4e2d\uff0c$2aSum_i$\u4e5f\u662f\u5355\u8c03\u9012\u51cf\u7684\uff08\u56e0\u4e3a$a<0$\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4\u4eca\u671d\u4e00\u4e2a\u659c\u7387$>2aSum_i$\uff0c\u90a3\u4e48\u5b83\u4ee5\u540e\u90fd\u8981$>2aSum_i$\uff0c\u5373\u5b83\u5bf9\u5e94\u7684\u76f4\u7ebf\u7684\u5de6\u7aef\u70b9\u4ee5\u540e\u90fd\u4e0d\u4f1a\u6210\u4e3a\u6700\u4f18\u51b3\u7b56\uff0c\u90a3\u5c31\u628a\u8fd9\u4e2a\u5e9f\u70b9\u5f39\u51fa\u5427\uff01\u7528\u4e00\u4e2a\u5355\u8c03\u961f\u5217\uff0c\u5728\u6bcf\u6b21\u627e\u6700\u4f18\u51b3\u7b56\u65f6\uff0c\u4e0d\u65ad\u5730\u5f39\u51fa\u961f\u9996~~\uff08\u81ea\u5e26\u97f3\u6548biubiubiu\uff09~~\u76f4\u5230\u7b2c$1$\u4e2a\u659c\u7387$\\le2aSum_i$\u4e3a\u6b62\u3002\u8fd9\u6837\u6700\u4f18\u51b3\u7b56\u5c31\u662f\u961f\u9996\u4e86\u3002\n\n$[1,n]$\u5185\u6bcf\u4e2a\u5143\u7d20\u6700\u591a\u5165\u961f\u51fa\u961f\u5404\u4e00\u6b21\uff0c\u6240\u4ee5\u5355\u8c03\u961f\u5217\u64cd\u4f5c\u7684\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u662f$\\operatorname{O}(n)$\uff0cDP\u4e5f\u662f$\\operatorname{O}(n)$\u7684\uff0c\u6574\u4e2a\u5c31\u662f$\\operatorname{O}(n)$\u5566\uff01\n\n\u6700\u540e\u518d\u5520\u53e8$2$\u53e5\uff1a\n1. \u8fd9\u9898\u7528`int`\u4f1a\u7206\u70b8\uff0c\u8981\u7528`long long`\u3002\n2. \u5355\u8c03\u961f\u5217\u7528STL\u91cc\u7684`deque`\u6bd4\u8f83\u6162\uff0c\u6700\u597d\u81ea\u5df1\u5199\u3002\n\n\u8bb2\u4e86\u8fd9\u4e48\u591a\uff0c\u7ec8\u4e8e\u4e0a\u4ee3\u7801\u4e86\uff08\u9003\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long//\u9632\u7206int\n#define N 1000000\ninline int sq(int x){return x*x;}//\u5e73\u65b9\nint Sum[N+1]/*\u524d\u7f00\u548c*/,q[N]/*\u5355\u8c03\u961f\u5217*/,dp[N+1]/*dp[i]\u8868\u793a\u524di\u4e2a\u58eb\u5175\u7684\u6700\u5927\u6218\u6597\u529b*/,a,b,c;\ninline double son(int j,int k)/*\u7eb5\u5750\u6807\u4e4b\u5dee\uff0c\u5373\u659c\u7387\u7684\u5206\u5b50*/{return (dp[j]+a*sq(Sum[j])-b*Sum[j])-(dp[k]+a*sq(Sum[k])-b*Sum[k]);}\ninline double ma(int j,int k)/*\u6a2a\u5750\u6807\u4e4b\u5dee\uff0c\u5373\u659c\u7387\u7684\u5206\u6bcd*/{return Sum[j]-Sum[k];}\ninline double f(int j,int k)/*\u659c\u7387*/{return son(j,k)/ma(j,k);}\nsigned main(){\n\tint n/*\u58eb\u5175\u4e2a\u6570*/,head=0,tail=0,i;scanf(\"%lld%lld%lld%lld\",&n,&a,&b,&c);\n\tfor(i=1;i<=n;i++){\n\t\tint x;scanf(\"%lld\",&x);\n\t\tSum[i]=Sum[i-1]+x;//\u9884\u5904\u7406\u524d\u7f00\u548c\n\t}\n\tq[tail++]=0;//\u521d\u59cb\u6709\u4e00\u4e2a\u51b3\u7b560\n\tfor(i=1;i<=n;i++){//\u72b6\u6001\u8f6c\u79fb\n\t\twhile(head+1<tail&&f(q[head+1],q[head])>2*a*Sum[i])head++;//\u5f39\u51fa\u5e9f\u70b9\n\t\tdp[i]=dp[q[head]]+a*sq(Sum[i]-Sum[q[head]])+b*(Sum[i]-Sum[q[head]])+c;//\u6700\u4f73\u51b3\u7b56\u662f\u961f\u9996\uff0c\u8f6c\u79fb\n\t\t//\u8f6c\u79fb\u5b8c\u4e86\u4e4b\u540e\uff0ci\u6210\u4e86i+1\u7684\u51b3\u7b56\uff0c\u538b\u5165\u961f\u5217\n\t\twhile(head+1<tail&&f(i,q[tail-1])>=f(q[tail-1],q[tail-2]))tail--;//\u7ef4\u62a4\u961f\u5c3e\u5355\u8c03\u6027\n\t\tq[tail++]=i;//\u5165\u961f\n//\t\tprintf(\"dp[%d]=%d\\n\",i,dp[i]);\n\t}\n\tprintf(\"%lld\",dp[n]);//\u7b54\u6848\u4e3adp[n]\n\treturn 0;\n}\n```",
        "postTime": 1555831616,
        "uid": 138400,
        "name": "chenxia25",
        "ccfLevel": 9,
        "title": "\u6d1b\u8c37 P3628 - \u7279\u522b\u884c\u52a8\u961f"
    },
    {
        "content": "## [APIO2010]\u7279\u522b\u884c\u52a8\u961f\n\n\u8fd9\u9053\u9898\u53ef\u4ee5\u5148\u63a8\u4e00\u4e0bDP\u7684\u5f0f\u5b50\n\n\u8bb0 sum[i] \u521d\u59cb\u7684\u524d\u7f00\u548c\n\n\u5219\u6709\n\n$$\ndp[i] = max(dp[j] + a * (sum[i] - sum[j])^2 + b * (sum[i] - sum[j]) + c)\n$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u663e\u7136\u53ef\u4ee5\u4f7f\u7528\u659c\u7387\u4f18\u5316\u3002\n\n\u9996\u5148\u6784\u9020\u659c\u7387\u5f0f\uff0c\u8bbe j < k \u82e5  j  \u6bd4  k  \u4f18\uff0c\u5219\u6709\n\n$$\ndp[j] + a * (sum[i] - sum[j]) ^ 2 + b *  (sum[i] - sum[j]) + c >  dp[k] + a * (sum[i] - sum[k]) ^ 2  +  b  *  (sum[i] - sum[k]) + c\n$$\n\n\u6d88\u6389\u76f8\u540c\u7684\u9879\uff0c\u518d\u79fb\u4e00\u4e0b\u9879\u3002\n\n$$\ndp[j] -  dp[k] + a  * sum[j] ^ 2 - a  * sum[k] ^ 2  > (2 *  a * sum[i] + b) * (sum[j] - sum[k])\n$$\n\n\u4ee4 f[i] = dp[i] + a * sum[i] ^ 2\n\n\u5219\uff1a\n\n$$\n\\frac{f[j] - f[k]}{s[j] - s[k]} < 2 * a * sum[i] + b\n$$\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u4e0a\u6a21\u677f\u7684\u4e8b\u60c5\u5566\u3002\n\n\u5b9e\u73b0\u7684\u65f6\u5019\u8981\u6ce8\u610f\u7b26\u53f7\uff0c\u8fd8\u6709\u6570\u7ec4\u4e0b\u6807\u548c\u6570\u7ec4\u7684\u503c\n\n\u4e0d\u7136\u4f1a\u51c9\u3002\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\n#define N 1000001\nusing namespace std;\nint n, l, r;\nll a, b, c, x;\nll dp[N], f[N], q[N << 1], sum[N];\ninline void insert(int i) {\n  while (l < r && (double)(f[q[r - 1]] - f[i]) / (1.0 * (sum[q[r - 1]] - sum[i])) > (double)(f[q[r - 1]] - f[q[r]]) / (sum[q[r - 1]] - sum[q[r]])) r--;\n  q[++r] = i;\n}\nint main() {\n  scanf(\"%d\", &n);\n  scanf(\"%lld%lld%lld\", &a, &b, &c);\n  for (int i = 1; i <= n; i++) {\n    scanf (\"%lld\", &x);\n    sum[i] = sum[i - 1] + x;\n  }\n  for (int i = 1; i <= n; i++) {\n    while (l < r && f[q[l + 1]] - f[q[l]] > (2ll * a * sum[i] + b) * (sum[q[l + 1]] - sum[q[l]])) l++;\n    dp[i] = dp[q[l]] + a * (sum[i] - sum[q[l]]) * (sum[i] - sum[q[l]]) + b * (sum[i] - sum[q[l]]) + c;\n    f[i] = dp[i] + a * sum[i] * sum[i];\n    insert(i);\n  }\n  printf(\"%lld\\n\", dp[n]);\n  return 0;\n}\n```\n\n",
        "postTime": 1541599090,
        "uid": 52295,
        "name": "zrz_orz",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    },
    {
        "content": "\u6253\u5e7f\u544a->[\u8fd9\u91cc](https://www.cnblogs.com/bztMinamoto/p/9545985.html)\n\n\u5148\u5199\u51fa\u8f6c\u79fb\u65b9\u7a0b$$dp[i]=max\\{dp[j]+a*(sum[i]-sum[j])^2+b*(sum[i]-sum[j])+c\\}$$\n\n\u5047\u8bbe$j$\u6bd4$k$\u66f4\u4f18\uff0c\u5219\u6709$$dp[j]+a*(sum[i]-sum[j])^2+b*(sum[i]-sum[j])+c>dp[k]+a*(sum[i]-sum[k])^2+b*(sum[i]-sum[k])+c$$\n\n\u5c55\u5f00\uff0c\u5e76\u6d88\u53bb\u540c\u7c7b\u9879\u4e4b\u540e\u5f97$$dp[j]-2*a*sum[i]*sum[j]+a*sum[j]^2-b*sum[j]>dp[k]-2*a*sum[i]*sum[k]+a*sum[k]^2-b*sum[k]$$\n\n\u79fb\u9879\uff0c\u5f97$$(dp[j]+a*sum[j]^2-b*sum[j])-(dp[k]+a*sum[k]^2-b*sum[k])>2*a*sum[i]*sum[j]-2*a*sum[i]*sum[k]$$\n\n\u8bbe$Y[i]=dp[i]+a*sum[i]^2-b*sum[i],X[i]=sum[i]$\n\n\u5219\u6709$$Y[j]-Y[k]>2*a*sum[i]*X[j]-2*a*sum[i]*X[k]$$\n\n$$\\frac{Y[j]-Y[k]}{X[j]-X[k]}>2*a*sum[i]$$\n\n\u90a3\u4e48\u5c31\u662f\u8981\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a\u4e0a\u51f8\u5305\uff0c\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u628a\u539f\u6765\u7ef4\u62a4\u4e0b\u51f8\u5305\u7684\u90a3\u4e9b\u4e1c\u897f\u7ed9\u53cd\u8fc7\u6765\u5c31\u597d\u4e86\uff08ps\uff1a\u6211\u4eca\u5929\u521a\u77e5\u9053\u539f\u6765\u51f8\u5305\u8fd8\u80fd\u662f\u4e0a\u51f8\u7684\u2026\u2026\u6211\u592a\u83dc\u4e86\u2026\u2026\uff09\n```\n//minamoto\n#include<iostream>\n#include<cstdio>\n#define ll long long\nusing namespace std;\n#define getc() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline int read(){\n    #define num ch-'0'\n    char ch;bool flag=0;int res;\n    while(!isdigit(ch=getc()))\n    (ch=='-')&&(flag=true);\n    for(res=num;isdigit(ch=getc());res=res*10+num);\n    (flag)&&(res=-res);\n    #undef num\n    return res;\n}\nconst int N=1000005;\nint sum[N],q[N],h,t,n;ll dp[N],a,b,c;\ninline ll Y(int i){return dp[i]+a*sum[i]*sum[i]-b*sum[i];}\ninline double slope(int j,int k){return 1.0*(Y(j)-Y(k))/(sum[j]-sum[k]);}\ninline ll check(int x){return a*x*x+b*x+c;}\nint main(){\n\t//freopen(\"testdata.in\",\"r\",stdin);\n\tn=read(),a=read(),b=read(),c=read();\n\tfor(int i=1;i<=n;++i) sum[i]=read()+sum[i-1];\n\tfor(int i=1;i<=n;++i){\n\t\tint k=2*a*sum[i];\n\t\twhile(h<t&&slope(q[h],q[h+1])>k) ++h;\n\t\tdp[i]=dp[q[h]]+check(sum[i]-sum[q[h]]);\n\t\twhile(h<t&&slope(q[t],q[t-1])<slope(q[t-1],i)) --t;q[++t]=i;\n\t}\n\tprintf(\"%lld\\n\",dp[n]);\n\treturn 0;\n}\n```",
        "postTime": 1535417112,
        "uid": 41781,
        "name": "bztMinamoto",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3628 \u3010[APIO2010]\u7279\u522b\u884c\u52a8\u961f \u3011"
    }
]