[
    {
        "content": "\u53d1\u73b0 $n, m$ \u90fd\u5f88\u5927\uff0c\u6b63\u5e38\u6c42\u7ec4\u5408\u6570\u6ca1\u6cd5\u505a\uff0c\u800c $k$ \u662f\u4e00\u4e2a\u8d28\u6570\uff0c\u6240\u4ee5\u8003\u8651\u4f7f\u7528 Lucas \u5b9a\u7406\uff1a\n\n$$ \\binom{n}{m} \\equiv \\binom{\\lfloor\\frac{n}{k}\\rfloor}{\\lfloor\\frac{m}{k}\\rfloor} \\times \\binom{n \\bmod k}{m \\bmod k} \\pmod{k} $$\n\n\u4e0a\u9762\u90a3\u4e2a\u5f0f\u5b50\u663e\u7136\u662f\u4e00\u4e2a $k$ \u8fdb\u5236\u62c6\u5206\u7684\u5f0f\u5b50\uff0c\u5982\u679c\u628a $n,m$ \u90fd\u5199\u4f5c $k$ \u8fdb\u5236\u7684\u5f62\u5f0f\uff0c$n$ \u7684\u7b2c $i$ \u4f4d\uff08\u6700\u4f4e\u4f4d\u4e3a\u7b2c\u4e00\u4f4d\uff09\u4e3a $bn_i$\uff0c$m$ \u7684\u7b2c $i$ \u4f4d\u4e3a $bm_i$\uff0c\u5219\u6709\uff1a\n\n$$ \\binom{n}{m} \\equiv \\prod_{i} \\binom{bn_i}{bm_i} \\pmod{k}$$\n\n\u663e\u7136\uff0c\u5982\u679c $\\binom{n}{m}$ \u662f $k$ \u7684\u500d\u6570\uff0c\u90a3\u4e48\u5b83\u5728\u6a21 $k$ \u610f\u4e49\u4e0b\u80af\u5b9a\u7b49\u4e8e $0$\u3002\u89c2\u5bdf\u4e0a\u9762\u8fd9\u4e2a\u8fde\u4e58\u7684\u5f0f\u5b50\uff0c\u663e\u7136\u5982\u679c\u6709\u4e00\u9879\u4e3a $0$\uff0c\u7ed3\u679c\u5c31\u662f $0$\u3002\u56e0\u4e3a\u5bf9\u4e8e $\\forall i, 0 \\le bn_i, bm_i < k$\uff0c\u90a3\u4e48 $\\binom{bn_i}{bm_i} = 0$ \u5f53\u4e14\u4ec5\u5f53 $bn_i < bm_i$\u3002\n\n\u6240\u4ee5\uff0c\u95ee\u9898\u5c31\u8f6c\u5316\u4e3a\u4e86\uff1a\u7ed9\u5b9a $n, m$\uff0c\u6c42\u6709\u591a\u5c11\u7ec4\u6570\u5bf9 $i, j$\uff0c\u6ee1\u8db3 $1 \\le i \\le n, 1 \\le j \\le \\min(i, m)$\uff0c\u4e14 $i, j$ \u90fd\u5199\u4f5c $k$ \u8fdb\u5236\u5f62\u5f0f\u81f3\u5c11\u6709\u4e00\u4f4d $i$ \u7684\u6570\u503c\u6bd4 $j$ \u5c0f\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u8bbe\u8ba1\u51fa\u4e00\u4e2a\u6570\u4f4d dp\uff0c\u7528 $f(cur, \\text{ok, dif, fn, fm})$ \u6765\u8868\u793a\u5f53\u524d\u5904\u7406\u5230\u7b2c $cur$ \u4f4d\uff0c\u76ee\u524d\u6709\u6ca1\u6709\u51fa\u73b0\u67d0\u4e00\u4f4d\u6570\u503c $i<j$\uff0c\u76ee\u524d $i$ \u4e0e $j$ \u662f\u4e0d\u662f\u51fa\u73b0\u4e86\u5dee\u5f02\uff08\u4e5f\u5c31\u662f\u6700\u9ad8 $cur$ \u4f4d $i, j$ \u662f\u4e0d\u662f\u5b8c\u5168\u76f8\u540c\uff09\uff0c\u76ee\u524d $i$ \u4e0e $n$ \u662f\u4e0d\u662f\u51fa\u73b0\u4e86\u5dee\u5f02\uff0c\u76ee\u524d $j$ \u4e0e $m$ \u662f\u4e0d\u662f\u51fa\u73b0\u4e86\u5dee\u5f02\u3002\u8f6c\u79fb\u663e\u7136\uff0c\u4e3a\u4e86\u65b9\u4fbf\u4f7f\u7528\u8bb0\u5fc6\u5316\u641c\u7d22\u5b9e\u73b0\u3002\n\n\u4ee3\u7801\u4ec5\u4f9b\u53c2\u8003\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nconst LL MOD = 1e9 + 7;\nconst int LOGN = 66;\nLL k, n, m, bn[LOGN], bm[LOGN];\nLL f[LOGN][2][2][2][2];\nLL Solve(int cur, bool ok, bool dif, bool fn, bool fm)\n{\n\tif(!cur) return ok;\n\tLL &res = f[cur][ok][dif][fn][fm];\n\tif(~res) return res;\n\tres = 0;\n\tint upn = fn ? k - 1 : bn[cur], upm = fm ? k - 1 : bm[cur];\n\tfor(int i = 0; i <= upn; i++)\n\t\tfor(int j = 0; (j <= i || dif) && j <= upm; j++)\n\t\t\tres = (res + Solve(cur - 1, ok | (i < j), dif | (i != j), fn | (i < upn), fm | (j < upm))) % MOD;\n\treturn res;\n}\nint main()\n{\n\tint t;\n\tscanf(\"%d %lld\", &t, &k);\n\twhile(t--)\n\t{\n\t\tscanf(\"%lld %lld\", &n, &m);\n\t\tmemset(f, -1, sizeof f);\n\t\tLL mx = max(n, m), len = 0;\n\t\twhile(mx) mx /= k, len++;\n\t\tfor(int i = 1; i <= len; i++) bn[i] = n % k, n /= k;\n\t\tfor(int i = 1; i <= len; i++) bm[i] = m % k, m /= k;\n\t\tprintf(\"%lld\\n\", Solve(len, false, false, false, false));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1595431157,
        "uid": 51971,
        "name": "syksykCCC",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6669 \u3010[\u6e05\u534e\u96c6\u8bad2016] \u7ec4\u5408\u6570\u95ee\u9898\u3011"
    },
    {
        "content": "\u5927\u5bb6\u90fd\u77e5\u9053 $\\mathrm{Lucas}$ \u5b9a\u7406\uff0c\u5148\u4e0d\u8981\u7ba1\u6574\u4e2a\u7ed3\u8bba\u53eb\u4ec0\u4e48\uff0c\u6446\u51fa\u4e00\u4e2a\u4f17\u6240\u5468\u77e5\u7684\u5f0f\u5b50\u7ed9\u5927\u5bb6\u770b\u770b\uff1a\n\n$$\n \\dbinom{m}{n} \\equiv \\dbinom{m \\bmod k}{n \\bmod k} \\cdot \\dbinom{\\lfloor \\frac{m}{k} \\rfloor}{\\lfloor \\frac{n}{k} \\rfloor} (\\bmod\\  k)\n$$\n\n\u56de\u987e\u4e00\u4e0b\u6211\u4eec\u505a $\\mathrm{Lucas}$ \u7b97\u6cd5\u6c42\u7ec4\u5408\u6570\u7684\u65f6\u5019\uff0c\u6211\u4eec\u6839\u636e\u4e0a\u9762\u90a3\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u9012\u5f52\u7b97\u3002\u4f46\u662f\u4f3c\u4e4e\u8fd8\u662f\u6ca1\u6709\u4ec0\u4e48\u5934\u7eea\u3002\n\n\u4e8e\u662f\u627e\u5230 $\\mathrm{Lucas}$ \u5b9a\u7406\uff08Lucas's theorem\uff09:\n\n> \u5bf9\u4e8e\u975e\u8d1f\u6574\u6570 $m,n$ \u548c\u8d28\u6570 $p$\uff0c\u6709 $\\dbinom{m}{n} \\equiv \\displaystyle \\prod_{i=0}^k \\dbinom{m_i}{n_i} (\\bmod  \\ p)$\uff0c\u5176\u4e2d $m = m_kp^k + m_{k-1}p^{k-1} + \\cdots + m_1p + m_0,n=n_kp^k + n_{k-1}p^{k-1} + \\cdots + n_1p + n_0$\uff0c\u5373 $m,n$ \u7684 $p$ \u6b21\u65b9\u5c55\u5f00\u3002\n\n\u518d\u56de\u770b\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u662f\u5426\u4f1a\u6e05\u6670\u5f88\u591a\uff1f\n\n\u6240\u4ee5\u8bf4\uff0c$\\dbinom{m}{n}$ \u82e5\u60f3\u88ab\u8d28\u6570 $k$ \u6574\u9664\uff0c\u4e00\u5b9a\u6709\uff1a$n,m$ \u5199\u6210 $k$ \u8fdb\u5236\u6570\uff0c\u5b58\u5728\u6709\u4e00\u4f4d\u6570\u4e0a\u7684\u6570\u4f4d\uff0c$n$ \u6bd4 $m$ \u5c0f\u3002\n\n\u53d1\u73b0\u53ef\u4ee5\u6570\u4f4d dp \u76f4\u63a5\u6765\u3002\u4e3a\u4e86\u7b80\u4fbf\uff0c\u6211\u4eec\u53ef\u4ee5\u7b97\u4e0d\u80fd\u88ab\u8d28\u6570 $k$ \u6574\u9664\u7684\u65b9\u6848\uff0c\u88ab\u603b\u65b9\u6848\u51cf\u53bb\u5c31\u662f\u7b54\u6848\u3002\u53ef\u4ee5\u76f4\u63a5\u6309\u4f4d\u53bb\u8fdb\u884c dp\u3002\n\n\u4f20\u7edf\u7684\u6570\u4f4d dp \u7b97\u8fbe\u5230\u4e0a\u9650\uff0c\u5bf9\u4e8e\u8fbe\u5230\u4e0a\u9650\u7684\u72b6\u6001\u4e0d\u8fdb\u884c\u8bb0\u5fc6\u5316\u4f1a\u8dd1\u5f97\u6bd4\u8f83\u6162\u3002\u6240\u4ee5\u5b9a\u4e49 $dp_{i,0 / 1,0 /1}$\uff0c\u8868\u793a\u9009\u5230\u7b2c $i$ \u4f4d\uff0c$n,m$ \u5206\u522b\u662f\u5426\u8fbe\u5230\u4e0a\u9650\uff0c\u4e71 dp \u5c31\u884c\u4e86\u3002\u5177\u4f53\u5b9e\u73b0\u770b\u4ee3\u7801\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef __int128 LL;\nchar buf[1<<21],*p1=buf,*p2=buf;\n#define getchar() (p1==p2 && (p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nLL read()\n{\n\tLL x=0,f=1;\n\tchar c=getchar();\n\twhile(c<'0' || c>'9')\n\t{\n\t\tif(c=='-')\tf=-1;\n\t\tc=getchar();\n\t}\n\twhile(c>='0' && c<='9')\tx=(x<<1)+(x<<3)+(c^'0'),c=getchar();\n\treturn x*f;\n}\nvoid write(LL x)\n{\n\tif(x<0)\tputchar('-'),x=-x;\n\tif(x>9)\twrite(x/10);\n\tputchar(x%10+'0');\n}\nconst LL MOD=1e9+7;\nLL dp[65][2][2],k,pnt1[65],pnt2[65],cnt1,cnt2;\nLL dfs(LL now,LL lead1,LL lead2)\n{\n\tif(!now)\treturn 1;\n\tif(~dp[now][lead1][lead2])\treturn dp[now][lead1][lead2];\n\tLL up1=lead1?pnt1[now]:k-1,up2=lead2?pnt2[now]:k-1,ans=0;\n\tfor(LL i=0;i<=up1;++i)\n\t{\n\t\tfor(LL j=0;j<=min(up2,i);++j)\n\t\t{\n\t\t\tans+=dfs(now-1,lead1 && i==up1,lead2 && j==up2);\n\t\t\tans%=MOD;\n\t\t}\n\t}\n\treturn dp[now][lead1][lead2]=ans;\n}\nLL calc(LL n,LL m)\n{\n\tcnt1=cnt2=0;\n\tLL tmp=n;\n\twhile(tmp)\tpnt1[++cnt1]=tmp%k,tmp/=k;\n\ttmp=m;\n\tmemset(pnt2,0,sizeof pnt2);\n\twhile(tmp)\tpnt2[++cnt2]=tmp%k,tmp/=k;\n\treturn dfs(cnt1,1,1);\n}\nint main(){\n\tLL T=read();\n\tk=read();\n\twhile(T-->0)\n\t{\n\t\tLL n=read(),m=read();\n\t\tm=min(m,n);\n\t\tmemset(dp,-1,sizeof dp);\n\t\twrite((((m+1)%MOD*(m+2)%MOD*500000004ll%MOD+((n-m+MOD)%MOD+MOD)%MOD*(m+1)%MOD)%MOD+MOD-calc(n,m))%MOD);\n\t\tputs(\"\");\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1605422386,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6669 \u3010[\u6e05\u534e\u96c6\u8bad2016] \u7ec4\u5408\u6570\u95ee\u9898\u3011"
    },
    {
        "content": "\u8fc7\u4e86\u8fd9\u9898\uff0c\u53d1\u73b0\u9898\u89e3\u533a\u5168\u90e8\u662f\u5362\u5361\u65af\u5b9a\u7406\uff0c\u4e8e\u662f\u6765\u5199\u4e00\u4e2a\u4e0d\u4e00\u6837\u7684\u9898\u89e3\u3002\n\n\u672c\u9898\u662f [CF582D](https://codeforces.com/contest/582/problem/D) \u7684\u8d85\u7ea7\u5f31\u5316\u7248\uff0c\u8fd9\u4e24\u9898\u90fd\u662f**\u52d2\u8ba9\u5fb7\u5b9a\u7406**\u7684\u6a21\u677f\u9898\u3002\n\n\u52d2\u8ba9\u5fb7\u5b9a\u7406\u7684\u5185\u5bb9\u662f\uff1a\u82e5 $p\\in prime$\uff0c\u5219 $n!$ \u8d28\u56e0\u6570\u5206\u89e3\u4e2d $p$ \u7684\u6b21\u6570\u662f $\\sum_{i=1}\\lfloor\\frac{n}{p^i}\\rfloor=\\frac{n-S(n)}{p-1}$\uff0c$S(n)$ \u8868\u793a $p$ \u8fdb\u5236\u4e0b $n$ \u7684\u6570\u4f4d\u548c\u3002\n\n\u8fd9\u4e2a\u5b9a\u7406\u6709\u4e00\u4e2a\u66f4\u4e3a\u5e38\u7528\u7684**\u63a8\u8bba**\uff1a$\\dbinom {n+m}m$ \u4e2d $p$ \u7684\u5e42\u6b21\u7b49\u4e8e $n+m$ \u5728 $p$ \u8fdb\u5236\u4e0b\u8fdb\u4f4d\u6b21\u6570\u3002\n\n\u6211\u4eec\u8bc1\u660e\u8fd9\u4e2a\u63a8\u8bba\uff1a$\\dbinom{n+m}m$ \u4e2d $p$ \u7684\u5e42\u6b21\u7b49\u4e8e $\\sum(\\lfloor\\frac{n+m}{p^i}\\rfloor-\\lfloor\\frac n{p^i}\\rfloor-\\lfloor\\frac m{p^i}\\rfloor)$\u3002\u5bf9\u4e8e\u6bcf\u4e2a $i$\uff0c\u53d1\u73b0\u5f53\u4e14\u4ec5\u5f53 $n+m$ \u5728 $p$ \u8fdb\u5236\u4e0b\u7b2c $i$ \u4f4d\u8fdb\u4f4d\u65f6 $\\lfloor\\frac{n+m}{p^i}\\rfloor-\\lfloor\\frac n{p^i}\\rfloor-\\lfloor\\frac m{p^i}\\rfloor=1$\uff0c\u5426\u5219 $\\lfloor\\frac{n+m}{p^i}\\rfloor-\\lfloor\\frac n{p^i}\\rfloor-\\lfloor\\frac m{p^i}\\rfloor=0$\uff0c\u4e8e\u662f\u5f97\u8bc1\u3002\n\n\u90a3\u4e48\u8fd9\u9898\u8981\u6c42\u7684\u662f $\\dbinom ij$ \u80fd\u88ab $p$ \u6574\u9664\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u9700\u8981\u7edf\u8ba1\u6709\u5e8f\u6570\u5bf9 $(i,j)$ \u7684\u6570\u91cf\u4f7f\u5f97 $i\\leq n,j\\leq\\min(i,m)$ \u4e14 $i-j$ \u4e0e $j$ \u5728 $p$ \u8fdb\u5236\u4e0b\u76f8\u52a0\u4f1a\u4ea7\u751f\u8fdb\u4f4d\u3002\n\n\u8fd9\u4e2a\u663e\u7136\u4e0d\u597d\u505a\uff0c\u8003\u8651\u7edf\u8ba1\u4e0d\u8fdb\u4f4d\u7684\u6570\u91cf\u3002\n\n\u53d1\u73b0\u8fd9\u662f\u5e73\u51e1\u7684\uff0c\u8bbe\u8ba1\u4e00\u4e2a\u6570\u4f4d dp\uff0c$dp_{k,0/1,0/1}$ \u8868\u793a\u5f53\u524d\u51b3\u5b9a\u5230\u7b2c $k$ \u4f4d\uff0c$i,j$ \u5404\u81ea\u662f\u5426\u9876\u4e0a\u754c\uff0c\u4e0d\u4ea7\u751f\u8fdb\u4f4d\u7684\u65b9\u6848\u6570\uff0c\u8f6c\u79fb\u76f4\u63a5\u679a\u4e3e $i$ \u548c $j$ \u8fd9\u4e00\u4f4d\u586b\u4ec0\u4e48\u5373\u53ef\uff0c\u6ce8\u610f\u8981\u6ee1\u8db3 $i$ \u5728 $p$ \u8fdb\u5236\u4e0b\u4efb\u610f\u4e00\u4f4d\u90fd\u8981\u5927\u4e8e $j$ \u7684\u5bf9\u5e94\u4f4d\u7f6e\uff0c\u8fd9\u6837\u624d\u4e0d\u4f1a\u4ea7\u751f\u8fdb\u4f4d\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(Tp^2\\log_pn)$\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\nusing namespace std;\n#define int long long\nconst int mod=1000000007;\nint t,p,n,m,a[101],b[101],len,dp[101][2][2],ans;\nsigned main()\n{\n    cin>>t>>p;\n    while(t--)\n    {\n        cin>>n>>m;\n        m=min(n,m);\n        len=ans=0;\n        memset(a,0,sizeof a);\n        memset(b,0,sizeof b);\n        memset(dp,0,sizeof dp);\n        int tn=n,tm=m;\n        while(tn)\n        {\n            ++len;\n            a[len]=tn%p;\n            tn/=p;\n            b[len]=tm%p;\n            tm/=p;\n        }\n        dp[len+1][1][1]=1;\n        for(int i=len;i>=1;--i)\n            for(int x=0;x<2;++x)\n                for(int y=0;y<2;++y)\n                    if(dp[i+1][x][y])\n                        for(int l=0;l<p;++l)\n                            if(!x||l<=a[i])\n                                for(int r=0;r<=l;++r)\n                                    if((!y||r<=b[i]))\n                                        dp[i][x&&l==a[i]][y&&r==b[i]]=(dp[i][x&&l==a[i]][y&&r==b[i]]+dp[i+1][x][y])%mod;\n        for(int x=0;x<2;++x)\n            for(int y=0;y<2;++y)\n                ans=(ans+dp[1][x][y])%mod;\n        cout<<((1ll*(m+2)%mod*((m+1)%mod)%mod*((mod+1)>>1)%mod+1ll*(m+1)%mod*((n-m)%mod)%mod)%mod-ans+mod)%mod<<'\\n';\n    }\n    return 0;\n}\n```",
        "postTime": 1654183187,
        "uid": 85682,
        "name": "\u7edd\u9876\u6211\u4e3a\u5cf0",
        "ccfLevel": 8,
        "title": "P6669 [\u6e05\u534e\u96c6\u8bad2016] \u7ec4\u5408\u6570\u95ee\u9898 \u9898\u89e3"
    },
    {
        "content": "## Tag\n\n\u5362\u5361\u65af\u5b9a\u7406\uff0c\u6570\u4f4d dp\u3002\n\n## Description\n\n$T$ \u7ec4\u8be2\u95ee\uff0c\u7ed9\u5b9a\u5e38\u6570 $k$\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u7ec4\u8be2\u95ee\uff0c\u7ed9\u5b9a $n,m$\uff0c\u5bf9\u4e8e $0 \\leq i \\leq n, 0 \\leq j \\leq \\min(i,m)$\uff0c\u4f60\u9700\u8981\u6c42\u51fa $k|\\dbinom ij$ \u7684\u65b9\u6848\u6570\u3002\n\n$\\texttt{data range:} n,m\\leq 10^{18}, k \\leq 100,k \\in \\mathbb P$.\n\n## Solution\n\n\u770b\u5230\u6574\u9664\uff0c\u6211\u4eec\u4e00\u822c\u4f7f\u7528\u79ef\u6027\u51fd\u6570\u6c42\u548c\u6765\u5b8c\u6210\uff0c\u4f46\u662f\u672c\u9898\u4e2d\u7ec4\u5408\u6570\u5e76\u6ca1\u6709\u79ef\u6027\uff0c\u6240\u4ee5\u4e0d\u592a\u80fd\u7528\u79ef\u6027\u51fd\u6570\u6765\u505a\u3002\n\n\u8003\u8651 lucas \u5b9a\u7406\u7684\u8fc7\u7a0b\uff08\u800c\u975e\u672c\u8d28\uff09\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u7ec4\u5408\u6570 $\\dbinom{n}{m}$\uff0c\u5982\u679c\u5bf9\u4e8e\u4e00\u4e2a\u8d28\u6570 $p$ \u53d6\u6a21\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5f0f\u5b50\u7b49\u4ef7\u4e8e\uff1a$\\dbinom{\\lfloor n/p\\rfloor}{\\lfloor m / p \\rfloor}\\dbinom{n \\bmod p}{m \\bmod p} \\pmod p$\u3002\n\n\u5bf9\u4e8e\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u9996\u5148\u5982\u679c $n\\geq m$\uff0c\u90a3\u4e48\u524d\u9762\u4e00\u9879\u6c38\u8fdc\u4e0d\u53ef\u80fd\u662f $0$\uff0c\u8003\u8651\u540e\u9762\u4e00\u9879\u4ec0\u4e48\u65f6\u5019\u662f $0$\u3002\u663e\u7136\u5f53 $n < m$ \u7684\u65f6\u5019\u6709 $\\dbinom{n}{m} = 0$\uff0c\u6240\u4ee5\u5f53\u67d0\u4e00\u4e2a $\\dbinom{n\\bmod p}{m\\bmod p}=0$ \u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u7ec4\u5408\u6570\u5728\u6a21 $p$ \u610f\u4e49\u4e0b\u7b49\u4e8e $0$\u3002\n\n\u8003\u8651\u5230\u540e\u9762\u90a3\u4e2a\u7ec4\u5408\u6570\u7684\u5f62\u5f0f\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a $k$ \u8fdb\u5236\u7684\u8f6c\u6362\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528**\u6570\u4f4d dp** \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\n\n\u5177\u4f53\u53ef\u4ee5\u4ee4 $f_{p,a,b,c,d}$ \u8868\u793a\u5f53\u524d\u679a\u4e3e\u5230\u7b2c $p$ \u4f4d\uff0c\u5f53\u524d\u4f4d\u7f6e\u662f\u5426\u4fdd\u8bc1 $n\\leq m$\uff0c\u5f53\u524d\u4f4d\u7f6e\u4e4b\u524d\u662f\u5426\u5b58\u5728\u4e00\u4e2a\u4f4d\u7f6e\u4f7f $\\dbinom{a_i}{b_i} = 0$\uff0c\u5f53\u524d\u4f4d\u7f6e\u662f\u5426\u662f $n$ \u7684\u5371\u9669\u70b9\uff0c\u5f53\u524d\u4f4d\u7f6e\u662f\u5426\u662f $m$ \u7684\u5371\u9669\u70b9\u3002\n\n\u7136\u540e\u6c42\u89e3\u4e00\u756a\u5c31\u53ef\u4ee5\u4e86\u3002\u4e0b\u9762\u662f\u6821\u5185\u6d4b\u8bd5\u8d5b\u65f6\u5019\u5199\u7684\u4ee3\u7801\uff0c\u6548\u7387\u5e76\u4e0d\u662f\u975e\u5e38\u4f18\u79c0\u2026\u2026\n\n## Code\n\n```cpp\nusing ll = long long;\n\nconst int N = 100;\nconst int mod = 1e9 + 7;\n\ninline void chk(int &x) {x -= mod; x += x >> 31 & mod;}\ninline int mll(int x, int y) {return (ll) x * y % mod;}\ninline int add(int x, int y) {chk(x += y); return x;}\ninline int del(int x, int y) {return add(x, mod - y);}\n\nint k;\nint f[N][2][2][2][2];\nint la[N], lb[N];\n\nint dfs(const int p, const int a, const int b, const int c, const int d) {\n    if(!p) return a && b;\n    if(~f[p][a][b][c][d]) return f[p][a][b][c][d];\n    int ret = 0, tem1 = c ? k - 1 : la[p], tem2 = d ? k - 1 : lb[p];\n    FOR(i, 0, tem1) FOR(j, 0, tem2) {\n        if(!a && i < j) break;\n        bool f1 = a | (i > j), f2 = b | (i < j);\n        bool f3 = c | (i != la[p]), f4 = d | (j != lb[p]);\n        chk(ret += dfs(p - 1, f1, f2, f3, f4));\n    }\n    return f[p][a][b][c][d] = ret;\n}\n\ninline int calc(const ll n, const ll m) {\n    int ret = 0, lim = 0;\n    memset(f, -1, sizeof(f));\n    ll temn = n, temm = m;\n    while(temn || temm) {\n        lim++;\n        la[lim] = temn % k, lb[lim] = temm % k;\n        temn /= k, temm /= k;\n    }\n    ret = dfs(lim, 0, 0, 0, 0);\n    return ret;\n}\n\ninline void solve() {\n    int t = rd;\n    k = rd;\n    while(t--) {\n        ll n = rd, m = rd;\n        cout << calc(n, m) << '\\n';\n    }\n    return ;\n}\n```",
        "postTime": 1639787095,
        "uid": 366935,
        "name": "KAMIYA_KINA",
        "ccfLevel": 7,
        "title": "P6669 [\u6e05\u534e\u96c6\u8bad2016] \u7ec4\u5408\u6570\u95ee\u9898 \u9898\u89e3"
    },
    {
        "content": "[\u9898\u76ee\u5e8a\u9001\u95e8](https://www.luogu.com.cn/problem/P6669)\n\n---\n\n\u524d\u7f6e\u77e5\u8bc6\uff1a$\\mathrm{Lucas}$ \u5b9a\u7406\n\n\u554a\uff0c\u597d\u50cf\u6ca1\u6709\u8fd9\u6837\u7684\u505a\u7684\u3002\n\n\u7531 $Lucas$ \u5b9a\u7406\u5f97\u3002\n\n$$\n\\dbinom nm \\equiv \\dbinom{\\lfloor\\frac{n}{k}\\rfloor}{\\lfloor\\frac{m}{k}\\rfloor}.\\dbinom{n \\bmod k}{m \\bmod k} (\\bmod k)\n$$\n\n\u5f53 $\\dbinom{n \\bmod k}{m \\bmod k}$ \u6216$\\dbinom{\\lfloor\\frac{n}{k}\\rfloor}{\\lfloor\\frac{m}{k}\\rfloor}$ \u4e3a $\\mathrm{0}$ \u662f\uff0c\u662f\u88ab $k$ \u6574\u9664\u3002\n\n\u800c $\\dbinom{\\lfloor\\frac{n}{k}\\rfloor}{\\lfloor\\frac{m}{k}\\rfloor}$ \u53ef\u4ee5\u7ee7\u7eed\u5f80\u4e0b\u5206\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u53ea\u8003\u8651 $\\dbinom{n \\bmod k}{m \\bmod k}$ \u7684\u90e8\u5206\u3002\n\n\u800c\u53ea\u6709 $n \\bmod k < m \\bmod k$ \u65f6 $\\dbinom{n \\bmod k}{m \\bmod k}$ \u4e3a $\\mathrm 0$\uff0c\u5c31\u662f\u76f8\u5f53\u4e8e\u5728 $\\mathrm k$ \u8fdb\u5236\u4e0b $\\mathrm{n}$ \u6709\u4e00\u4f4d\u6bd4 $\\mathrm m$ \u5c0f $\\dbinom n m$ \u5c31\u6574\u9664 $\\mathrm{k}$\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u7528\u6570\u4f4d\u52a8\u89c4\u505a\u4e86\u3002\n\n```cpp\n#include <queue>\n#include <cmath>\n#include <cstdio>\n#include <cctype>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\n\nchar buf[1 << 23],*p1 = buf,*p2 = buf,obuf[1 << 23],*O = obuf;\n#define getchar() (p1 == p2 && (p2 = (p1 = buf) + fread(buf,1,1 << 21,stdin),p1 == p2) ? EOF : *p1 ++)\n#define putchar(x) *O ++ = x\n\ntemplate<typename T>void read(T &x) {\n\tx = 0;T f = 1;char ch = getchar();\n\twhile (!isdigit(ch)) {if (ch == '-') f = -1;ch = getchar();}\n\twhile (isdigit(ch)) {x = (x << 3) + (x << 1) + ch - '0';ch = getchar();}\n\tx *= f;\n}\nint read() {\n\tint x = 0, f = 1;char ch = getchar();\n\twhile (!isdigit(ch)) {if (ch == '-') f = -1;ch = getchar();}\n\twhile (isdigit(ch)) {x = (x << 3) + (x << 1) + ch - '0';ch = getchar();}\n\treturn x * f;\n}\ntemplate<typename T>void print(T x) {\n\tif (x < 0) putchar('-'),x = -x;\n\tif (x > 9) print(x / 10);\n\tputchar(x % 10 + '0');\n}\n\ntemplate<typename T>T Abs(T x) {return x < 0 ? -x : x;}\ntemplate<typename T>T Min(T x,T y) {return x < y ? x : y;}\ntemplate<typename T>T Max(T x,T y) {return x > y ? x : y;}\ntemplate<typename T>void Swap(T &x,T &y) {T z = x;x = y;y = z;}\n\nconst int MOD = 1e9 + 7;\n\nlong long n,m;\nint t,k,tot1,tot2;\nint b[65],c[65];\nint f[65][2][2][2][2];\n\nint dfs(int len,int up1,int up2,int app,int can) {\n\tif (!len) return app;\n\tif (~f[len][up1][up2][app][can]) return f[len][up1][up2][app][can];\n\tint mdig1 = up1 ? b[len] : k - 1;\n\tint mdig2 = up2 ? c[len] : k - 1;\n\tint res = 0;\n\tfor (int i = 0 ; i <= mdig1 ; ++ i) {\n\t\tfor (int j = 0 ; j <= mdig2 ; ++ j) {\n\t\t\tif (j > i && !can) continue;\n\t\t\tres += dfs(len - 1,up1 && i == mdig1,up2 && j == mdig2,app || (j > i),can || (i > j));\n\t\t\tres = res > MOD ? res - MOD : res;\n\t\t}\n\t}\n\treturn f[len][up1][up2][app][can] = res;\n}\n\nint DP(long long x,long long y) {\n\tmemset(f,-1,sizeof f);\n\tif (y > x) y = x;\n\tmemset(b,0,sizeof b);\n\tmemset(c,0,sizeof c);\n\ttot1 = tot2 = 0;\n\twhile (x) b[++ tot1] = x % k,x /= k;\n\twhile (y) c[++ tot2] = y % k,y /= k;\n\treturn dfs(tot1,1,1,0,0);\n}\n\nint main () {\n\tread(t);read(k);\n\twhile (t --) {\n\t\tread(n);read(m);\n\t\tprint(DP(n,m)),putchar('\\n');\n\t}\n\tfwrite(obuf,O - obuf,1,stdout);\n\treturn 0;\n}\n```",
        "postTime": 1605594803,
        "uid": 163516,
        "name": "Strelitzia",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6669 \u3010[\u6e05\u534e\u96c6\u8bad2016] \u7ec4\u5408\u6570\u95ee\u9898\u3011"
    },
    {
        "content": "### Description.\n\u6c42  \n$$\\sum_{i=1}^{n}\\sum_{j=1}^{\\min(i,m)}[k|C_i^j]$$\n\n### P.S.\n\u524d\u7f6e\u77e5\u8bc6\uff1a Lucas \u5b9a\u7406  \n![](https://bkimg.cdn.bcebos.com/formula/a784fd83c19921085f6e12dff816ef1d.svg)  \n\uff08\u6458\u81ea\u767e\u5ea6\u767e\u79d1\u3002\u8be6\u7ec6\u8bc1\u660e\u53ca\u5b9e\u73b0\u65b9\u6cd5\u5de6\u4f20[\u6a21\u677f](https://www.luogu.com.cn/problem/P3807)  \n\n\u6b64\u7bc7\u9898\u89e3\u5047\u8bbe\u8bfb\u8005\u5df2\u7ecf\u4f1a\u4e86 Lucas \u5b9a\u7406\u4ee5\u53ca\u5b9e\u73b0\u65b9\u6cd5\u3002\n\n### Solution.\n\u6211\u4eec\u9996\u5148\u53bf\u89c2\u5bdf\u6570\u636e\u8303\u56f4\uff0c\u53d1\u73b0 $k$ \u662f\u4e00\u4e2a\u8d28\u6570\u3002  \n\u9898\u76ee\u540d\u5b57\u53c8\u53eb\u7ec4\u5408\u6570\u95ee\u9898\uff0c\u90a3\u6211\u4eec\u80fd\u7b2c\u4e00\u65f6\u95f4\u53cd\u5e94\u51fa\u6765\u8fd9\u662f\u9053 Lucas \u7684\u9898\u76ee\u3002  \n\u6211\u4eec\u5206\u6790\u4e00\u4e0b Lucas \u662f\u5982\u4f55\u6c42\u7ec4\u5408\u6570 $\\text{mod}\\ k$ \u7ed3\u679c\u7684\u3002  \n```cpp\ninline int C(int n,int m)\n{\n\tif(m>n) return 0;//\u8fd9\u4e2afac\u662f\u9636\u4e58\u6570\u7ec4\n\telse return 1ll*fac[n]*qpow(fac[m],k-2)%k*qpow(fac[n-m],k-2)%k;\n}\ninline int lucas(int n,int m)\n{\n\tif(m==0) return 1;\n\telse return 1ll*C(n%k,m%k)*lucas(n/k,m/k)%k;\n}\n```\n\u8fd9\u5c31\u662f\u7b14\u8005\u7684 Lucas \u4ee3\u7801\uff0c\uff08\u5199\u7684\u4e11\uff0c\u8bf7\u8f7b\u55b7\u3002  \n\u6211\u4eec\u53d1\u73b0\u5176\u5b9e Lucas \u5b9a\u7406\u5c31\u662f\u628a\u7ec4\u5408\u6570\u7684 $n$ \u548c $m$ \u4e00\u904d\u4e00\u904d\u5bf9 $k$ \u53d6\u6a21\uff0c\u628a\u6240\u6709\u53d6\u6a21\u540e\u7684\u4f59\u6570\u7684\u7ec4\u5408\u6570\u4e58\u8d77\u6765\u3002  \n\u611f\u89c9\u8fd9\u4e2a\u65b9\u5f0f\u6709\u70b9\u4f3c\u66fe\u76f8\u8bc6\uff0c\u6211\u4eec\u5728\u505a\u8fdb\u5236\u8f6c\u6362\u65f6\u4e5f\u65f6\u8fd9\u6837\u505a\u7684\u3002  \n\u6240\u4ee5 Lucas \u5b9a\u7406\u7684\u672c\u8d28\u5c31\u662f\u628a $n$ \u548c $m$ \u8f6c\u5316\u6210 $k$ \u8fdb\u5236\uff0c\u7136\u540e\u628a\u6bcf\u8fdb\u5236\u4f4d\u4e0a\u7684\u6570\u4f4d\u6c42\u7ec4\u5408\u6570\uff0c\u6700\u540e\u628a\u6240\u5f97\u5230\u7684\u7ec4\u5408\u6570\u4e58\u8d77\u6765\u3002  \n\u540c\u65f6\u6211\u4eec\u53c8\u53d1\u73b0\uff0c$k$ \u8fdb\u5236\u7684\u6bcf\u4e00\u4e2a\u8fdb\u5236\u4f4d\u4e0a\u7684\u6570\u90fd\u5c0f\u4e8e $k$\u3002  \n\u53c8\u6839\u636e\u7ec4\u5408\u6570\u7684\u5b9a\u4e49\uff1a  \n$$C_n^m=\\frac{n!}{m!(n-m)!}$$  \n\u6240\u4ee5\u5f53 $m\\le n<k$ \u65f6\uff0c$C_n^m$ \u80af\u5b9a\u6ca1\u6709 $k$ \u8fd9\u4e2a\u56e0\u6570\u3002  \n\u90a3\u4e48\u6211\u4eec\u662f\u600e\u4e48\u8ba9\u5b83 $\\text{mod}\\ k$ \u7b49\u4e8e $0$ \u7684\u5462\uff1f  \n\u6211\u4eec\u624b\u6a21\u4e00\u7ec4\u6837\u4f8b\u6216\u8005\u4ed4\u7ec6\u89c2\u5bdf\u4e00\u4e0b\u4e0a\u9762\u7684\u4ee3\u7801\u5c31\u53ef\u4ee5\u77e5\u9053\uff0c\u5f53 $m>n$ \u65f6\u7ec4\u5408\u6570\u5c31\u4e3a $0$ \u4e86\u3002  \n\u5f53 $m<=n$ \u65f6 $C_n^m\\ \\text{mod}\\ k \\not = 0$ \uff0c \u5f53 $m>n$ \u65f6\u7ec4\u5408\u6570\u4e00\u76f4\u4e3a $0$\u3002  \n\u6240\u4ee5$C_n^m\\ \\text{mod}\\ k=0$\u7684\u5145\u5206\u5fc5\u8981\u6761\u4ef6\u662f\uff0c\u628a $n$ \u548c $m$ \u8f6c\u5316\u6210 $k$ \u8fdb\u5236\u540e\u5b58\u5728\u4e00\u4f4d\uff0c\u4f7f\u5f97 $n$ \u5728\u8fd9\u4f4d\u4e0a\u7684\u6570\u503c\u5c0f\u4e8e $m$ \u5728\u8fd9\u4f4d\u4e0a\u7684\u6570\u503c\u3002  \n\u6240\u4ee5\u6700\u540e\u6211\u4eec\u76f4\u63a5\u5bf9 $n$ \u548c $m$ \u8fdb\u884c\u4e00\u4e2a\u6570\u4f4d dp\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u6700\u540e\u7684\u7b54\u6848\u4e86\u3002  \n\n\u5b8c\u7ed3\u6492\u82b1\u3002\n\n### Coding.\n\u6ce8\u610f\uff0c\u8fd9\u7bc7\u4ee3\u7801\u4e3a\u4e86\u4f7f\u5b9e\u73b0\u53d8\u5f97\u7b80\u5355\uff0c\u7528\u4e86\u4e00\u4e2a\u5c0f\u5c0f\u7684\u5bb9\u65a5  \n\u4e5f\u5c31\u662f\u8bf4\uff0c\u7ec4\u5408\u6570\u5bf9 $k$ \u53d6\u6a21\u6a21\u4e3a $0$ \u7684\u6570\u7b49\u4e8e\u603b\u6570\u51cf\u53bb\u5bf9 $k$ \u53d6\u6a21\u7b54\u6848\u4e0d\u4e3a $0$ \u7684\u65b9\u6848\u6570\u3002  \n```cpp\n//\u4e5f\u8bf7\u8ba9\u6211\u76f8\u4fe1\uff0c\u4f60\u4e00\u76f4\u4ee5\u6765\u6240\u76f8\u4fe1\u7684\u4e8b\u5427\u2014\u2014\u201c\u6d3b\u7740\u662f\u4e00\u4ef6\u5f88\u7f8e\u597d\u7684\u4e8b\u201d\n//\u53ea\u8981\u8bb0\u4f4f\u4f60\u7684\u540d\u5b57 \u4e0d\u7ba1\u4f60\u5728\u4e16\u754c\u7684\u54ea\u4e2a\u5730\u65b9 \u6211\u4e00\u5b9a\u4f1a\u53bb\u89c1\u4f60\n//\u6211\u73b0\u5728\u4f9d\u7136\u559c\u6b22\u7740\u4f60\uff0c\u4f46\u6211\u4eec\u5c31\u7b97\u662f\u6765\u5f80\u4e00\u5343\u5c01\u90ae\u4ef6\uff0c\u5fc3\u5374\u4e0d\u53ef\u80fd\u63a5\u8fd1\u54ea\u6015\u4e00\u5398\u7c73\n//\u55ef\uff0c\u90a3\u6837\u7684\u8bdd\uff0c\u4f60\u5c31\u518d\u52aa\u529b\u4e00\u6b21\u8bd5\u8bd5\u5427\uff01\u522b\u5728\u8fd9\u79cd\u5730\u65b9\u754f\u754f\u7f29\u7f29\u7684\uff01\u522b\u5bf9\u81ea\u5df1\u8bf4\u8c0e\uff01\u518d\u52aa\u529b\u4e00\u6b21\u5427\n//\u62dc\u6258\u4e86 \u8bf7\u628a\u529b\u91cf\u501f\u7ed9\u8f6f\u5f31\u7684\u6211 \u7ed9\u6211\u4ece\u8fd9\u91cc\u518d\u5ea6\u8d77\u8eab\u8fc8\u6b65\u7684\u529b\u91cf\n//\u867d\u7136\u706f\u5854\u5df2\u7ecf\u5931\u53bb\u4e86\u5149\u660e\u2026\u2026 \u4f46\u662f \u53ea\u8981\u6709\u4f60\u7684\u90a3\u9996\u6b4c\u5728 \u5c31\u4e00\u5b9a\u80fd\u5c06\u90a3\u4e9b\u4eba\u518d\u6b21\u5bfc\u5411\u6b64\u65b9\n//\u5c0f\u65f6\u5019\u66fe\u8ba4\u4e3a\u8fd9\u4e2a\u4e16\u754c\u4f1a\u66f4\u52a0\u7684\u5355\u7eaf\u7b80\u5355\uff0c\u6ca1\u6709\u8d62\u4e0d\u4e86\u7684\u6bd4\u8bd5\uff0c\u52aa\u529b\u5c31\u4f1a\u6709\u56de\u62a5\uff0c\u8ba4\u4e3a\u8fd9\u4e16\u4e0a\u4e00\u5207\u7686\u6709\u53ef\u80fd\u3002\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int P=1000000007;int t,k,n,m,dp[105][2][2],cnt1,a[105],cnt2,b[105];\ninline int dfs(int x,int lim1,int lim2)\n{//\u6570\u4f4ddp\uff0c\u7528\u7684\u8bb0\u641c\uff0cx\u8868\u793a\u5f53\u524d\u641c\u5230\u4e86\u7b2c\u51e0\u4f4d\uff0clim1\u8868\u793a\u5f53\u524dn\u662f\u5426\u9876\u5230\u4e86\u4e0a\u754c\uff0clim2\u8868\u793am\n\tif(!x) return 1;else if(dp[x][lim1][lim2]!=-1) return dp[x][lim1][lim2];\n\t//\u8fb9\u754c\u6761\u4ef6\uff0c\u6216\u8005\u8bb0\u5fc6\u5316\n\tint ed1=lim1?a[x]:k-1,ed2=lim2?b[x]:k-1,res=0;\n\t//ed\u8868\u793aend\uff0c\u5373\u5f53\u524d\u8fd9\u4e00\u4f4d\u80fd\u53d6\u7684\u6700\u5927\u503c\n\tfor(int i=0;i<=ed1;i++) for(int j=0;j<=i&&j<=ed2;j++) res=(res+dfs(x-1,lim1&&i==ed1,lim2&&j==ed2))%P;\n\t//\u76f4\u63a5dp\uff0c\u6570\u4f4ddp\u6a21\u677f\n\treturn dp[x][lim1][lim2]=res;//\u8bb0\u5fc6\u5316\n}\nsigned main()\n{\n\tfor(scanf(\"%lld%lld\",&t,&k);t--;)\n\t{\n\t\tscanf(\"%lld%lld\",&n,&m),m=min(n,m),cnt1=cnt2=0,memset(dp,-1,sizeof(dp)),memset(b,0,sizeof(b));//\u591a\u7ec4\u6570\u636e\u6e05\u96f6\n\t\tint r=(((m+1)%P*((m+2)%P))%P*500000004%P+(n-m)%P*((m+1)%P)%P)%P;\n\t\t//r\u8868\u793a\u603b\u6570\uff0c\u8fd9\u4e2a500000004\u662f2%(1e9+7)\u7684\u4e58\u6cd5\u9006\u5143\uff0c\u61d2\u5f97\u6253\u4e00\u4e2a\u5feb\u901f\u5e42\u4e86QAQ\n\t\t{while(n) a[++cnt1]=n%k,n/=k;}{while(m) b[++cnt2]=m%k,m/=k;}\n\t\t//\u628an\u548cm\u6309\u7167k\u8fdb\u5236\u5c55\u5f00\n\t\tprintf(\"%lld\\n\",(r-dfs(cnt1,1,1)+P)%P);//\u51cf\u53bb\u7b54\u6848\u4e0d\u4e3a0\u7684\u7b54\u6848\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1597899614,
        "uid": 44805,
        "name": "Leap_Frog",
        "ccfLevel": 7,
        "title": "P6669[\u6e05\u534e\u96c6\u8bad2016] \u7ec4\u5408\u6570\u95ee\u9898\uff08\u9898\u89e3\uff09"
    },
    {
        "content": "## [\u6e05\u534e\u96c6\u8bad$2016$] \u7ec4\u5408\u6570\u95ee\u9898\n\n[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/solution/P6669)\n\n### \u5206\u6790\n\n\u672c\u9898\u9700\u8981\u6c42\u5f97\n\n$\\sum\\limits_{i=0}^{n}\\sum\\limits_{j=0}^{\\min(i,m)}[\\gcd(C^j_i,k)==k] \\mod 10^{9}+7$\n\n\u7b49\u4ef7\u4e8e$\\sum\\limits_{i=0}^{n}\\sum\\limits_{j=0}^{\\min(i,m)}[C^j_i \\equiv 0\\mod k] \\mod 10^{9}+7$\n\n\u5176\u4e2d$k\\in prime,k\\in[1,100]$.\n\n\uff08\u867d\u7136\u7b14\u8005\u5199\u7684\u7b97\u5f0f\u8ba9\u4eba\u60f3\u5230\u53cd\u6f14\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a$\\frac{C^j_i}{k}$\u96be\u4ee5\u5904\u7406\u3002\u6211\u4eec\u5c1d\u8bd5\u522b\u7684\u601d\u8def\u3002\uff09\n\n\u5148\u8003\u8651\u5bf9\u4e8e$C_i^j$\u5982\u4f55\u5f97\u5230$[\\gcd(C^j_i,k)==k]$\u3002\n\n\u6211\u4eec\u63d0\u53d6\u51fa$i!,j!,(i-j)!$\u4e2d\u5305\u542b$k$\u56e0\u5b50\u7684\u4e2a\u6570\uff08\u6211\u4eec\u8bb0\u4e3a$c_k$\uff09\u3002\u90a3\u4e48\u5f53\n\n$i!_k-j!_k-(i-j)!_k>0$\n\n\u5c31\u6709$[\\gcd(C^j_i,k)==k]=1$\n\n\u8fd9\u79cd\u5199\u6cd5\u53ef\u9002\u7528\u4e8e\u5c0f\u8303\u56f4\u66b4\u529b\u8ba1\u7b97\u3002\n\n\u6211\u4eec\u4e5f\u53ef\u4ee5\u8fd9\u6837\u770b\uff1a\n\n\u4e0a\u5f0f\u7b49\u540c\u4e8e\u8ba1\u7b97$C_i^j \\mod k$\u7684\u503c\u662f\u5426\u7b49\u4e8e$0$.\u7531$k$\u7684\u6027\u8d28\u53ef\u4ee5\u5229\u7528\u5362\u5361\u65af\u5b9a\u7406\u3002\n\n$C^j_i\\equiv C^{j\\mod k}_{i \\mod k}C^{\\left\\lfloor\\frac{j}{k}\\right\\rfloor}_{\\left\\lfloor\\frac{i}{k}\\right\\rfloor} \\mod k$\n\n\u90a3\u4e48\u5206\u89e3\u8fc7\u7a0b\u4e2d\uff0c\u5f53\u5176\u4e2d\u81f3\u5c11\u6709\u4e00\u9879\u4e3a$0$\u65f6\u53ef\u4ee5\u5f97\u5230$[\\gcd(C^j_i,k)==k]=1$.\n\n\u540c\u6837\uff0c\u8fd9\u79cd\u5199\u6cd5\u5bf9\u4e8e\u5c0f\u8303\u56f4\u6570\u636e\u662f\u8db3\u591f\u7684\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e$n,m\\le 10^{18}$\u5462\uff1f\u8fd9\u79cd\u5199\u6cd5\u8fd8\u80fd\u4e0d\u80fd\u7ee7\u7eed\u4f18\u5316\uff1f\n\n\u6211\u4eec\u60f3\uff0c\u4e0a\u5f0f\u5176\u5b9e\u5c31\u662f\u5c06$i,j$\u8f6c\u5316\u4e3a$k$\u8fdb\u5236\u540e\u62c6\u5206\u6570\u4f4d\uff0c\u5bf9\u4e8e\u76f8\u540c\u6570\u4f4d\u6c42\u7ec4\u5408\u6570.\n\n$j={\\over a_1a_2a_3a_4\\dots}_k$\n\n$i={\\over b_1b_2b_3b_4\\dots}_k$\n\n$C^j_i \\equiv C^{a_1}_{b_1}C^{a_2}_{b_2}C^{a_3}_{b_3}C^{a_4}_{b_4}\\dots \\mod k$\n\n\u8bf4\u5230\u6570\u4f4d\u5206\u79bb\u6211\u4eec\u5c31\u4f1a\u60f3\u5230\u6570\u4f4d$DP$\u3002\n\n\u6700\u574f\u60c5\u51b5\u4e0b$i,j$\u5728$k$\u8fdb\u5236\u4e0b\u4e3a$60$\u4f4d\u6570\uff08$k=2,i=10^{18}$\uff09\u3002\u540c\u65f6\uff0c\u5bf9\u4e8e$C^j_i = 0(0\\le i,j\\le k)$\uff0c\u7531\u4e8e$i,j$\u7684\u7279\u6b8a\u6027\uff0c$C^j_i$\u5fc5\u4e0d\u643a\u5e26\u56e0\u5b50$k$.\u82e5\u8981\u4ee4$C^j_i = 0$\uff0c\u90a3\u4e48\u53ea\u80fd\u6709$j>i$\u3002\n\n\u90a3\u4e48\u5269\u4e0b\u7684\u95ee\u9898\u5c31\u662f\u5728$DP$\u8fc7\u7a0b\u4e2d\u8981\u6c42$0\\le i\\le n,0\\le j\\le\\min(i,m)$\uff0c\u5728\u8be5\u6761\u4ef6\u4e0b\u6211\u4eec\u5bf9\u6bcf\u4e00\u4f4d\u8fdb\u884c\u679a\u4e3e\u5373\u53ef\u3002\n\n\u6211\u4eec\u4ee4$f_{ok,p,ji,in,jm},(ok,ji,in,jm\\in\\{0,1\\})$\u8868\u793a\u679a\u4e3e\u5230\u7b2c$p$\u4f4d\u65f6\u4e14\u6ee1\u8db3\u5982\u4e0b\u6761\u4ef6\u65f6\u7684\u65b9\u6848\uff1a$ok$\u8bb0\u5f55\u5f53\u524d\u662f\u5426$C^j_i=0$,$ji$\u8bb0\u5f55\u5f53\u524d\u662f\u5426$j<i$,$in$\u8bb0\u5f55\u5f53\u524d\u662f\u5426$i<n$,$jm$\u8bb0\u5f55\u5f53\u524d\u662f\u5426$j<m$\u3002\u5148\u5c06$n,m$\u7684$k$\u8fdb\u5236\u8868\u793a\u6c42\u51fa\uff0c\u7136\u540e\u5bf9\u5176\u505a\u8bb0\u5fc6\u5316\u641c\u7d22\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u5728$O(16k^2len)$\u5de6\u53f3\uff0c\u5176\u4e2d$len$\u4e3a$n$\u5728$k$\u8fdb\u5236\u8868\u793a\u4e0b\u7684\u957f\u5ea6\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\nusing namespace std;\ntypedef long long ll;\nconst int maxl=61,mod=1000000007;\nll n,m;\nint f[2][maxl][2][2][2];\nint an[maxl],am[maxl],len,k;\ninline ll read(){\n\tll res=0;\n\tchar ch=getchar(),ch1=ch;\n\twhile(!isdigit(ch))ch1=ch,ch=getchar();\n\twhile(isdigit(ch))res=(res<<3)+(res<<1)+ch-'0',ch=getchar();\n\treturn ch1=='-'?-res:res;\n}\nint mmod(int x){\n\treturn x>=mod?x-mod:x;\n}\nint dfs(bool ok,int p,bool ji,bool in,bool jm){\n\tif(!p)return ok;\n\tint &res=f[ok][p][ji][in][jm];\n\tif(~res);\n\telse{\n\t\tres=0;\n\t\tint upi=in?k-1:an[p],upj=jm?k-1:am[p];\n\t\tfor(register int i=0;i<=upi;++i)\n\t\t\tfor(register int j=0;j<=upj&&(ji||j<=i);++j)\n\t\t\t\t\tres=mmod(res+dfs(ok|(j>i),p-1,ji|(j<i),in|(i<an[p]),jm|(j<am[p])));\n\t}\n\treturn res;\n}\nint main(){\n\tint T=read();k=read();\n\twhile(T--){\n\t\tn=read();m=read();\n\t\tmemset(f,-1,sizeof(f));\n\t\tif(m>n)m=n;\n\t\tlen=0;\n\t\twhile(n){\n\t\t\tan[++len]=n%k;n/=k;\n\t\t\tam[len]=m%k;m/=k;\n\t\t}\n\t\tprintf(\"%d\\n\",dfs(0,len,0,0,0));\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1595752099,
        "uid": 137422,
        "name": "JasonL",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6669 \u3010[\u6e05\u534e\u96c6\u8bad2016] \u7ec4\u5408\u6570\u95ee\u9898\u3011"
    }
]