[
    {
        "content": "## 1. $1\\le k,p \\le 50,\\ 1\\le l\\le 10^{3}$\n\n\u8003\u8651\u76f4\u63a5 dp\u3002\n\n\u8bbe $f({i,j})$ \u4e3a\u5f53\u524d\u6574\u6570\u5927\u5c0f\u4e3a $i$\uff0c\u6700\u540e\u4e00\u9879\u4e3a $j$ \u7684\u5e8f\u5217\u7684\u8ba1\u6570\u3002\n\u5bb9\u6613\u5199\u51fa\u8f6c\u79fb\uff1a\n$$f({i,j}) = \\left\\{\n    \\begin{aligned}\n    \\sum_{t=1}^{k}f({i-j,t}) \\qquad j < p \\\\\n    \\sum_{t=1}^{p-1}f({i-j,t}) \\qquad j\\ge p\n    \\end{aligned}\n\\right.$$\n\n\u76f4\u63a5\u8f6c\u79fb\u5373\u53ef\u505a\u5230 $O(kpl)$\uff0c\u7b54\u6848\u5373\u4e3a $\\sum_{i=1}^k f({l,i})$\u3002    \n[Submission](https://www.luogu.com.cn/record/93608620).\n\n\u8fdb\u884c\u72b6\u6001\u7684\u538b\u7f29\u3002\u6211\u4eec\u53d1\u73b0 $j$ \u8fd9\u4e00\u7ef4\u5b9e\u9645\u4e0a\u53ea\u8bb0\u5f55\u4e86 $j< p$ \u7684\u60c5\u51b5\u548c $j\\ge p$ \u7684\u60c5\u51b5\uff0c\u8fd9\u53ef\u4ee5\u5728\u8f6c\u79fb\u65f6\u5b8c\u6210\u3002\u7136\u540e\u5c31\u53ef\u4ee5\u628a\u8fd9\u4e24\u79cd\u72b6\u6001\u538b\u7f29\uff1a  \n\u8bbe $f({i,0/1})$ \u4e3a\u5f53\u524d\u6574\u6570\u5927\u5c0f\u4e3a $i$\uff0c\u6700\u540e\u4e00\u9879\u662f\u5426\u5c0f\u4e8e $p$ \u7684\u5e8f\u5217\u7684\u8ba1\u6570\u3002\u6709\u8f6c\u79fb\uff1a\n$$f({i,0}) = \\sum_{j=1}^{p-1} f({i-j,0}) + f({i-j,1})\\qquad f({i,1}) = \\sum_{j=p}^{k} f({i-j,0})$$\n\n\u7b54\u6848\u5373\u4e3a $f({l,0}) + f({l,1})$\u3002\u76f4\u63a5\u8f6c\u79fb\u5373\u53ef\u505a\u5230 $O(kl)$\u3002    \n[Submission](https://www.luogu.com.cn/record/102784752).\n\n## 2. $1\\le k,p \\le 50,\\ 1\\le l\\le 10^{18}$\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u4e0a $O(kl)$ \u7684\u8f6c\u79fb\u662f\u7ebf\u6027\u7684\uff0c\u53ef\u4ee5\u5199\u6210\u77e9\u9635\u4e58\u6cd5\u7684\u5f62\u5f0f\u3002\u5177\u4f53\u5730\uff0c\u6211\u4eec\u4f7f\u7528  $2k\\times 2k$ \u7684\u77e9\u9635\u8fdb\u884c\u8f6c\u79fb\uff0c\u521d\u59cb\u5411\u91cf\u8bb0\u5f55 $1\\sim k$ \u6bb5\u5185\u6240\u6709 $f({i,0})$ \u4e0e $f({i,1})$\u3002\n\n\u4f8b\u5982\uff0c\u5f53 $k=5, p=3$ \u65f6\u77e9\u9635\u5373\u4e3a\uff1a\n\n$$\\begin{bmatrix} f({i+1,1})\\\\ f({i+1,0})\\\\ f({i,1})\\\\ f({i,0})\\\\ f({i-1,1})\\\\ f({i-1,0})\\\\ f({i-2,1})\\\\ f({i-2,0})\\\\ f({i-3,1})\\\\ f({i-3,0})\\\\ \\end{bmatrix}= \\begin{bmatrix} 0 & 0 & 0 & 0 & 0 &1 & 0 & 1 & 0 & 1\\\\ 1 & 1 & 1 & 1 & 0 &0 & 0 & 0 & 0 & 0\\\\ 1 & 0 & 0 & 0 & 0 &0 & 0 & 0 & 0 & 0\\\\ 0 & 1 & 0 & 0 & 0 &0 & 0 & 0 & 0 & 0\\\\ 0 & 0 & 1 & 0 & 0 &0 & 0 & 0 & 0 & 0\\\\ 0 & 0 & 0 & 1 & 0 &0 & 0 & 0 & 0 & 0\\\\ 0 & 0 & 0 & 0 & 1 &0 & 0 & 0 & 0 & 0\\\\ 0 & 0 & 0 & 0 & 0 &1 & 0 & 0 & 0 & 0\\\\ 0 & 0 & 0 & 0 & 0 &0 & 1 & 0 & 0 & 0\\\\ 0 & 0 & 0 & 0 & 0 &0 & 0 & 1 & 0 & 0\\\\ \\end{bmatrix} \\begin{bmatrix} f({i,1})\\\\ f({i,0})\\\\ f({i-1,1})\\\\ f({i-1,0})\\\\ f({i-2,1})\\\\ f({i-2,0})\\\\ f({i-3,1})\\\\ f({i-3,0})\\\\ f({i-4,1})\\\\ f({i-4,0})\\\\ \\end{bmatrix}$$\n\n\u8f6c\u79fb\u5373\u53ef\u3002\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(8k^3\\log l)$\u3002     \n[Submission](https://www.luogu.com.cn/record/93795849).\n\n## 3. $1\\le k,p \\le 1000,\\ 1\\le l\\le 10^{18}$\n\n\u4f60\u770b\u8fd9\u4e2a\u8f6c\u79fb\u77e9\u9635\u662f\u4e0d\u662f\u548c\u7ebf\u6027\u9012\u63a8\u7684\u5f88\u50cf\uff1f\n\n\u8003\u8651\u8bbe $g({i}) = f({i,0}) + f({i,1})$\u3002\n\u6211\u4eec\u53ef\u4ee5\u5199\n$$g(i) = \\sum_{j=1}^{p-1}\\left( f({i-j,0}) + f({i-j,1})\\right) + \\sum_{j=p}^{k} f({i-j,0}) = \\sum_{j=1}^{p-1} g({i-j}) + \\sum_{j=p}^{k} f({i-j,0}) $$\n\u524d\u9762\u90a3\u90e8\u5206\u53ef\u4ee5\u76f4\u63a5\u6254\u8fdb\u7ebf\u6027\u9012\u63a8\u8f6c\u79fb\u3002   \n\u5bf9\u4e8e\u540e\u534a\u90e8\u5206\uff0c\u8003\u8651\u5728\u6700\u540e\u4e00\u6b65 $i \\ge p$ \u65f6\uff0c\u4ec5\u6709\u5012\u6570\u7b2c\u4e8c\u6b65 $j < p$ \u7684\u72b6\u6001\u80fd\u591f\u5168\u90e8\u8f6c\u79fb\u3002\u540c\u65f6\uff0c\u8003\u8651\u8fd9\u91cc\u7684\u8d21\u732e\u5728 $j < p$ \u65f6\u5df2\u7ecf\u88ab\u7b97\u4e86\uff0c\u6211\u4eec\u53ea\u9700\u8981 $\\ge p$ \u7684 $j$\u3002\u7b97\u4e00\u4e0b\u6709\u591a\u5c11\u4e2a $j$ \u6ee1\u8db3\u6761\u4ef6\uff0c\u8fd9\u5c31\u662f $f(i)$ \u5bf9\u5e94\u7684\u7cfb\u6570\u3002  \n\u8fd9\u91cc\u7531\u4e8e\u9700\u8981\u8ba9\u6240\u6709\u8d21\u732e\u90fd\u88ab\u7b97\u5b8c\uff0c\u7ebf\u6027\u9012\u63a8\u7684\u957f\u5ea6\u662f $k + p - 1$ \u7684\u3002\n\n\u8f6c\u79fb\u65f6\u76f4\u63a5\u6a21\u62df\u591a\u9879\u5f0f\u4e58\u6cd5\u5373\u53ef\uff0c\u603b\u590d\u6742\u5ea6\u4e3a $O(k^2 \\log l)$\u3002[Submission](https://www.luogu.com.cn/record/93802758).   \n\u5e94\u7528\u4efb\u610f\u6a21\u6570\u591a\u9879\u5f0f\u4e58\u6cd5\u5373\u53ef\u505a\u5230 $O(k\\log k\\log n)$\u3002\n\n\u53ef\u80fd 80% \u7684\u90e8\u5206\u5206\u662f\u7ed9\u6570\u7ec4\u5f00\u5c0f\u7684\u6b63\u89e3\u51c6\u5907\u7684\u3002[Submission](https://www.luogu.com.cn/record/93802691).\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std; using pii = pair<int,int>;\nusing ll = long long; using ull = unsigned long long; using db = double; using ld = long double; using lll = __int128_t;\ntemplate<typename T> void get(T & x) {\n\tx = 0; char ch = getchar(); bool f = false; while (ch < '0' or ch > '9') f = f or ch == '-', ch = getchar();\n\twhile ('0' <= ch and ch <= '9') x = (x << 1) + (x << 3) + ch - '0', ch = getchar(); f && (x = -x); \n} template <typename T, typename ... Args> void get(T & a, Args & ... b) { get(a); get(b...); }\n#define rep(i,s,t) for (register int i = (s), i#_ = (t) + 1; i < i#_; ++ i)\n#define pre(i,s,t) for (register int i = (s), i#_ = (t) - 1; i > i#_; -- i)\nconst int N = 4e3 + 10;\n\nconst int mod = 20201114;\ntemplate <typename T1, typename T2> T1 add(T1 a, T2 b) { return (a += b) >= mod ? a - mod : a; }template <typename T1, typename ...Args> T1 add(T1 a, Args ... b) { return add(a, add(b...)); }\nstruct FastMod { int m; ll b; void init(int _m) { m = _m; b = ((lll)1<<64) / m; } FastMod(int _m) { init(_m); } int operator() (ll a) {ll q = ((lll)a * b) >> 64; a -= q * m; if (a >= m) a -= m; return a; } } Mod(mod);\nint mul(int a, int b) { return Mod(1ll * a * b); } template <typename ...Args> int mul(int a, Args ...b) { return mul(a, mul(b...)); }\n\nint k, mx, p, sum[N][2], ans;\nint f[N], h[N];\nll l;\n\nstruct seq {\n\tint a[N];\n\tint & operator [] (const int & p) { return a[p]; }\n\tconst int operator [] (const int & p) const { return a[p]; }\n\tseq operator * (const seq & b) const {\n\t\tseq ret; rep(i,0,mx-1) ret[i] = 0;\n\t\trep(i,0,mx-1) rep(j,0,mx-1) ret[i + j] = add(ret[i + j], mul(a[i], b[j]));\n\t\tfor (int i = (mx-1) << 1; i >= mx; ret[i] = 0, -- i) rep(j,1,mx) \n\t\t\tret[i - j] = add(ret[i - j], mul(ret[i], f[j]));\n\t\treturn ret;\n\t}\n} res;\n\nseq qp(seq a, ll b) {\n\tseq ret; memset(ret.a, 0, sizeof ret.a); ret[0] = 1;\n\twhile (b) {\n\t\tif (b & 1) ret = ret * a;\n\t\ta = a * a;\n\t\tb >>= 1;\n\t} return ret;\n}\n\nint main() {\n\tget(k, p, l); mx = k + p - 1; -- l;\n\tsum[0][0] = 1;\n\trep(i,1,mx) {\n\t\trep(j,1,min(p - 1, i)) {\n\t\t\tsum[i][0] = add(sum[i][0], sum[i - j][0], sum[i - j][1]);\n\t\t}\n\t\trep(j,p,min(k, i)) {\n\t\t\tsum[i][1] = (sum[i][1] + sum[i - j][0]) % mod;\n\t\t}\n\t} \n\t\n\trep(i,1,p-1) f[i] = 1;\n\trep(i,p,k+p-1) rep(j,p,k) if (0 < i - j and i - j < p) ++ f[i];\n\trep(i,0,k+p-1) h[i] = add(sum[i + 1][0], sum[i + 1][1]);\n\n\tif (l <= mx) {\n\t\tcout << h[l] << endl;\n\t\treturn 0;\n\t}\n\n\tres[1] = 1; ans = 0;\n\tres = qp(res, l);\n\trep(i,0,mx - 1) ans = add(ans, mul(res[i], h[i]));\n\tcout << ans << endl;\n}\n```",
        "postTime": 1677137454,
        "uid": 631791,
        "name": "joke3579",
        "ccfLevel": 0,
        "title": "P8735 \u9898\u89e3"
    },
    {
        "content": "\u8bbe $f_{n}$ \u4e3a\u6700\u540e\u4e00\u6b65\u957f\u5ea6\u5c0f\u4e8e $k$ \u7684\uff0c\u603b\u957f\u5ea6\u4e3a $n$ \u7684\u65b9\u6848\u6570\uff1b\u8bbe $g_{n}$ \u4e3a\u6700\u540e\u4e00\u6b65\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e $k$ \u7684\uff0c\u603b\u957f\u5ea6\u4e3a $n$ \u7684\u65b9\u6848\u6570\u3002\u90a3\u4e48\u6709\uff1a\n$$\n\\begin{aligned}\n&f_{n}=\\sum_{i=1}^{k-1}f_{n-i}+g_{n-i}\\\\\n&g_{n}=\\sum_{i=k}^{p}f_{n-i}\n\\end{aligned}\n$$\n\u6211\u4eec\u8981\u6c42\u7684\u5c31\u662f $f_{L}+g_{L}$\u3002\n\n\u4e0b\u9762\u7684\u5f0f\u5b50\u5e26\u5165\u4e0a\u9762\u7684\u5f0f\u5b50\uff1a\n$$\n\\begin{aligned}\nf_{n}=\\sum_{i=1}^{k-1}(f_{n-i}+\\sum _{j=k}^{p}g_{n-i-j})\\\\\n\\end{aligned}\n$$\n\u663e\u7136 $f$ \u6ee1\u8db3 $k+p$ \u9636\u7ebf\u6027\u9012\u63a8\u3002\u81f3\u4e8e $g$\uff0c\u53ef\u4ee5\u7528\u9012\u63a8\u5f0f\u5206\u89e3\u6210 $O(p)$ \u4e2a $f$\uff0c\u8fd9\u6837\u5957\u7528[\u5e38\u7cfb\u6570\u7ebf\u6027\u9f50\u6b21\u9012\u63a8\u7684\u6a21\u677f](https://www.luogu.com.cn/problem/P4723),\u5c31\u6709\u4e86\u4e00\u4e2a $O(p(p+k)\\log L\\log (p+k))$ \u7684\u505a\u6cd5\u3002\n\n\u4e0a\u8ff0\u505a\u6cd5\u7684\u74f6\u9888\u5728\u4e8e $g$ \u7684\u89e3\u51b3\u662f\u4f9d\u9760\u89e3\u51b3\u5f88\u591a\u4e2a $f$ \u6765\u66b4\u529b\u7528\u5b9a\u4e49\u5f0f\u89e3\u51fa\uff0c\u518d\u89c2\u5bdf\u5230\u9012\u63a8\u5f0f\u4e2d\u7684\u548c\u5f0f\u90fd\u662f\u8fde\u7eed\u7684\u4e0b\u6807\uff0c\u4e8e\u662f\u628a $f$ \u548c $g$ \u7684\u5b9a\u4e49\u6539\u6210\u539f\u6765\u7684\u524d\u7f00\u548c\u3002\u9012\u63a8\u5f0f\u53d8\u4e3a\uff1a\n\n$$\n\\begin{aligned}\n&f_{n}-f_{n-1}=f_{n-1}-f_{n-k}+g_{n-1}-g_{n-k} \\\\\n&g_{n}-g_{n-1}=f_{n-k}-f_{n-p-1}\n\\end{aligned}\n$$\n\n\n\u76ee\u6807\u662f $f_{n}-f_{n-1}+g_{n}-g_{n-1}=f_{n}-f_{n-1}+f_{n-k}-f_{n-p-1}$\uff0c\u76f8\u5f53\u4e8e\u6c42 $4$ \u4e2a $f$ \u7684\u5355\u9879\uff0c\u5957\u7528\u4e4b\u524d\u63d0\u5230\u7684\u6a21\u677f\u5373\u53ef\u5728\u6c42\u51fa\u524d $p+k$ \u9879\u4e4b\u540e\u5728$O((p+k)\\log L\\log (p+k))$\u7684\u590d\u6742\u5ea6\u5185\u6c42\u51fa\u4efb\u610f\u5355\u9879\uff0c\u800c\u4fee\u6539\u540e\u7684\u9012\u63a8\u5f0f\u5728\u540c\u65f6\u9012\u63a8 $f$ \u548c $g$ \u65f6\u53ef\u4ee5\u505a\u5230\u5355\u9879 $O(1)$\uff08\u8fd0\u7528\u4e0a\u9762\u7684\u9012\u63a8\u5f0f\uff09\u3002\n\n\u603b\u590d\u6742\u5ea6 $O((p+k)\\log L\\log (p+k))$\n\nPS\uff1a\u6ce8\u610f\u5230\u6a21\u6570\u4e0d\u662fNTT\u6a21\u6570\uff0c\u5728\u4f7f\u7528\u7ebf\u6027\u9012\u63a8\u7684\u6a21\u677f\u65f6\u9700\u8981\u4f7f\u7528\u4efb\u610f\u6a21\u6570\u7684NTT\u3002",
        "postTime": 1674945032,
        "uid": 122846,
        "name": "\u6c38\u65e0\u5c9b",
        "ccfLevel": 6,
        "title": "8735"
    }
]