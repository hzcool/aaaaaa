[
    {
        "content": "### \u6269\u5c55BSGS\u7684\u677f\u5b50\u9898\r\n\r\n\u56de\u5fc6$BSGS$\u7b97\u6cd5\uff0c\u7ed9\u5b9a\u6574\u6570$a,b,p$\uff0c\u5176\u4e2d$a,p$\u4e92\u8d28\uff0c\u6c42\u65b9\u7a0b$a^x\\equiv b\\ (mod\\ p)$\u7684\u6700\u5c0f\u6574\u6570\u89e3$x$\r\n\r\n**\u505a\u6cd5**\uff1a\u8bbe$x=i\\times m-j,m=\\left \\lceil \\sqrt p \\right \\rceil,1\\le j\\le m,1\\le i\\le m$\r\n\r\n\u65b9\u7a0b\u53d8\u4e3a$a^{im-j}\\equiv b\\ (mod\\ p)$\r\n\r\n\u5316\u4e00\u4e0b$(a^m)^i\\equiv b\\times a^j\\ (mod\\ p)$\r\n\r\n\u8fd9\u65f6\u53ea\u8981\u628a$(a^m)^i$\u548c$b\\times a^j$\u9884\u5904\u7406\u51fa\u6765\u4e22\u5230\u54c8\u5e0c\u8868\u91cc\u5c31\u505a\u5b8c\u4e86\r\n\r\n\u800c\u73b0\u5728\u7684$a,p$\u4e0d\u4e92\u8d28\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u8003\u8651\u5176\u4ed6\u7684\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f$\\text{Ex\\_BSGS}$\r\n\r\n\u90a3\u4e48\u6211\u4eec\u8bbe$g=gcd(a,p)$\r\n\r\n\u6839\u636e\u6a21\u7684\u5206\u914d\u7387\uff0c\u65b9\u7a0b\u53d8\u4e3a$\\frac{a^x}{g}\\equiv \\frac{b}{g}\\ (mod\\ \\frac{p}{g})$\r\n\r\n\u65e0\u89e3\u60c5\u51b5\u5c31\u662f$g\\nmid b$\u5e76\u4e14$b\\ne 1$\r\n\r\n\u6211\u4eec\u6765\u8bc1\u660e\u4e00\u4e0b\r\n\r\n\u8bbe$a'=\\frac{a}{g},p'=\\frac{p}{g}$\uff0c\u90a3\u4e48$a=a'g,p=p'g$\r\n\r\n\u4ee3\u5165\u5230\u539f\u65b9\u7a0b\u4e2d\u53d8\u4e3a$(a'g)^x\\equiv b\\ (mod\\ p'g)$\r\n\r\n$$a'^xg^x+yp'g=b$$\r\n\r\n$$g(a'^xg^{x-1}+yp')=b$$\r\n\r\n\u8fd9\u6837\u5b50$g$\u5c31\u662f$b$\u7684\u56e0\u5b50\uff0c\u800c\u53ea\u6709\u5728$b=1$\u65f6\uff0c$a^0=1$\uff0c\u5176\u4f59\u60c5\u51b5\u82e5$g\\nmid b$\uff0c\u65b9\u7a0b\u65e0\u89e3\r\n\r\n\u8bc1\u6bd5\r\n\r\n\u90a3\u4e48\u6211\u4eec\u518d\u628a\u4e0a\u9762\u7684\u5f0f\u5b50\u5316\u4e00\u4e0b\u53d8\u4e3a$a^{x-1}\\times\\frac{a}{g}\\equiv \\frac{b}{g}\\ (mod\\ \\frac{p}{g})$\r\n\r\n\u800c$\\frac{p}{g}$\u4e00\u5b9a\u662f\u6bd4$p$\u5c0f\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u4e00\u76f4\u7ea6\u5230$a,\\frac{p}{g}$\u4e92\u8d28\r\n\r\n\u8bbe$na=\\prod_{i=1}^k\\frac{a}{g_i}$\r\n\r\n\u539f\u5f0f\u5c31\u53ef\u4ee5\u5199\u6210$a^{x-k}\\equiv \\frac{b}{\\prod_{i=1}^k g\\times na}(mod\\ \\frac{p}{\\prod_{i=1}^kg})$ \uff0c$k$\u662f\u505a\u4e86\u51e0\u6b21\u5316\u7b80\r\n\r\n\u8fd9\u6837\u5b50\u5c31\u53ef\u4ee5\u7528$BSGS$\u6c42\u89e3\u5566\r\n\r\n\u6709\u4e00\u70b9\u9700\u8981\u6ce8\u610f\uff0c\u56e0\u4e3a\u662f\u5728\u6a21\u610f\u4e49\u4e0b\u8fd0\u7b97\uff0c\u6240\u4ee5\u9664\u4ee5$na$\u65f6\u8981\u4e58\u5176\u9006\u5143\r\n\r\n\u56e0\u4e3a\u6700\u540e\u4e00\u76f4\u5316\u5230\u4e86$\\frac{a}{\\prod_{i=1}^kg}$\u548c$\\frac{p}{\\prod_{i=1}^kg}$\u4e92\u8d28\uff0c\u6240\u4ee5$na$\u548c$\\frac{p}{\\prod_{i=1}^kg}$\u770b\u8d77\u6765\u4e5f\u5f88\u4e92\u8d28\r\n\r\n\u5c31\u53ef\u4ee5\u7528**\u6269\u6b27**\u6c42\u9006\u5143\u4e86\r\n\r\n**Code**\r\n``` cpp\r\n#include <iostream>\r\n#include <cstdio>\r\n#include <cstring>\r\n#include <algorithm>\r\n#include <map>\r\n#include <cmath>\r\n#define int long long\r\nusing namespace std;\r\nint a,p,b;\r\nmap <int,int> f;\r\nint gcd(int a,int b)     //\u6700\u5927\u516c\u7ea6\u6570\r\n{\r\n    if (!b)return a;\r\n    return gcd(b,a%b);\r\n}\r\nvoid exgcd(int a,int b,int &x,int &y)  //\u6269\u6b27\r\n{\r\n\tif (!b)x=1,y=0;\r\n\telse\r\n\t{\r\n\t\texgcd(b,a%b,x,y);\r\n\t\tint t=x;\r\n\t\tx=y;\r\n\t\ty=t-a/b*y;\r\n\t}\r\n}\r\nint inv(int a,int b)    //\u9006\u5143\r\n{\r\n\tint x,y;\r\n\texgcd(a,b,x,y);\r\n\treturn (x%b+b)%b;\r\n}\r\nint mypow(int a,int x,int p)\r\n{\r\n    int s=1;\r\n    while (x)\r\n    {\r\n        if (x&1)s=s*a%p;\r\n        a=a*a%p;\r\n        x>>=1;\r\n    }\r\n    return s;\r\n}\r\nint bsgs(int a,int b,int p)    //BSGS\u7b97\u6cd5\r\n{\r\n    f.clear();\r\n    int m=ceil(sqrt(p));\r\n    b%=p;\r\n    for (int i=1;i<=m;i++)\r\n    {\r\n        b=b*a%p;\r\n        f[b]=i;\r\n    }\r\n    int tmp=mypow(a,m,p);\r\n    b=1;\r\n    for (int i=1;i<=m;i++)\r\n    {\r\n        b=b*tmp%p;\r\n        if (f[b])return (i*m-f[b]+p)%p;\r\n    }\r\n    return -1;\r\n}\r\nint exbsgs(int a,int b,int p)\r\n{\r\n    if (b==1||p==1)return 0;     //\u7279\u6b8a\u60c5\u51b5\uff0cx=0\u65f6\u6700\u5c0f\u89e3\r\n    int g=gcd(a,p),k=0,na=1;\r\n    while (g>1)\r\n    {\r\n        if (b%g!=0)return -1;    //\u65e0\u6cd5\u6574\u9664\u5219\u65e0\u89e3\r\n        k++;b/=g;p/=g;na=na*(a/g)%p;\r\n    \tif (na==b)return k;   //na=b\u8bf4\u660e\u524d\u9762\u7684a\u7684\u6b21\u6570\u4e3a0\uff0c\u53ea\u9700\u8981\u8fd4\u56dek\r\n    \tg=gcd(a,p); \r\n    }\r\n    int f=bsgs(a,b*inv(na,p)%p,p);\r\n    if (f==-1)return -1;\r\n    return f+k;\r\n}\r\nsigned main()\r\n{\r\n    cin>>a>>p>>b;\r\n    while(a||b||p)\r\n    {\r\n    \ta%=p;b%=p;\r\n        int t=exbsgs(a,b,p);\r\n        if (t==-1)cout<<\"No Solution\"<<endl;\r\n        else cout<<t<<endl;\r\n        cin>>a>>p>>b;\r\n    }\r\n    return 0;\r\n}\r\n```\r\n$BSGS$\u5199\u6302\u4e86\u8c03\u4e86\u534a\u5929QAQ",
        "postTime": 1561599433,
        "uid": 73231,
        "name": "eee_hoho",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4195 \u3010\u3010\u6a21\u677f\u3011exBSGS/Spoj3105 Mod\u3011"
    },
    {
        "content": "## \u524d\u8a00\r\nclockwhite \u5199\u4e86\u4e00\u7bc7\u6b64\u9898\u9898\u89e3\u3002\r\n\r\n~~\u6211\u4e5f\u8981\u5199\uff01~~\r\n\r\n## \u95ee\u9898\r\n\r\n\u6c42\u51fa\u4f7f $a^x\\equiv b\\pmod p$ \u6210\u7acb\u7684\u6700\u5c0f $x$\uff0c\u6216\u5224\u65ad\u65b9\u7a0b\u65e0\u89e3\u3002\r\n\r\n## \u89e3\u6cd5\u4e0e\u8bc1\u660e\r\n\u540c\u4e00\u822c BSGS \u505a\u6cd5\u8fdb\u884c\u6839\u53f7\u5e73\u8861\uff0c\u8bbe $t=\\lceil \\sqrt{2\\varphi(p)} \\rceil,x=pt-q(0\\le q<t)$ \uff0c\u8003\u8651\u5bf9\u539f\u5f0f\u8fdb\u884c\u53d8\u5f62\uff1a\r\n\r\n$$\r\na^{pt-q}\\equiv b\\pmod {p}\r\n$$\r\n$$\r\na^{pt} \\equiv ba^q\\pmod p\r\n$$\r\n\r\n\u6ce8\u610f\u5230\u4e24\u6b65\u95f4\u5e76\u975e\u7b49\u4ef7\u53d8\u5f62\uff0c\u540e\u8005\u662f\u524d\u8005\u7684\u5fc5\u8981\u6761\u4ef6\u3002\u9884\u5148\u5c06 $a^{pt}(0\\le p\\le t)$ \u7684\u503c\u5b58\u5165\u6563\u5217\u8868\uff0c\u4e4b\u540e\u679a\u4e3e $a^q$ \u5e76\u5728\u6563\u5217\u8868\u4e2d\u67e5\u8be2 $ba^q$ \u7684\u503c\u662f\u5426\u5b58\u5728\u3002\u82e5\u5b58\u5728\uff0c\u5219\u6240\u5bf9\u5e94\u7684 $pt-q$ \u5373\u4e3a $x$ \u7684\u4e00\u4e2a\u53ef\u80fd\u503c\uff0c\u4ee3\u5165\u539f\u5f0f\u53ef\u77e5\u662f\u5426\u786e\u5b9e\u80fd\u6210\u4e3a $x$\u3002\r\n\r\n\u4e8b\u60c5\u81f3\u6b64\u5c1a\u672a\u89e3\u51b3\uff0c\u8fd9\u662f\u7531\u4e8e$a^{pt}$ \u7684\u503c\u53ef\u80fd\u51fa\u73b0\u91cd\u590d\u3002\u5bf9\u4e8e\u91cd\u590d\u7684\u503c\uff0c\u4ec5\u524d\u4e24\u4e2a\u51fa\u73b0\u7684\u4f4d\u7f6e\u53ef\u80fd\u6210\u4e3a\u7b54\u6848\u3002\u67e5\u8be2\u65f6\u4e24\u503c\u5747\u8fdb\u884c\u68c0\u9a8c\u5373\u53ef\u3002\r\n\r\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\operatorname{O}(\\sqrt{\\varphi(p)})$\u3002\r\n\r\n\u7136\u540e\u662f\u6b63\u786e\u6027\u8bc1\u660e\u3002\r\n\r\n\u9996\u5148\u8bc1\u660e\u7b54\u6848\u4e0a\u754c\u3002\u524d\u6587\u8bbe $t=\\lceil \\sqrt{2\\varphi(p)} \\rceil$\uff0c\u610f\u5473\u7740 $2\\varphi(p)$ \u662f\u7b54\u6848\u7684\u4e0a\u754c\u3002\u4e8b\u5b9e\u4e0a\u786e\u5b9e\u5982\u6b64\u3002\u6839\u636e\u6269\u5c55\u6b27\u62c9\u5b9a\u7406 $a^{x}\\equiv a^{x\\bmod {\\varphi(p)}+\\varphi(p)}$\uff0c\u82e5 $x>2\\varphi(p)$\uff0c\u5fc5\u7136\u6709 $x\\bmod {\\varphi(p)}+\\varphi(p)$ \u662f\u66f4\u4f18\u7684\u7b54\u6848\u3002\u4e0a\u754c\u5f97\u8bc1\u3002\r\n\r\n\u4e4b\u540e\u8bc1\u660e\u4ec5\u4fdd\u7559\u524d\u4e24\u4e2a\u76f8\u7b49\u7684\u503c\u7684\u6b63\u786e\u6027\u3002\u7531\u6269\u5c55\u6b27\u62c9\u5b9a\u7406\uff0c\u5f62\u8c61\u5316\u5730\u8bf4\uff0c$a^x$ \u7684\u503c\u5f62\u6210\u4e86\u4e00\u4e2a $\\rho$ \u5f62\uff0c\u5373\u5728\u7ecf\u8fc7\u957f\u5ea6\u4e0d\u8d85\u8fc7 $\\varphi(p)$ \u7684\u975e\u5faa\u73af\u6570\u540e\u8fdb\u5165\u957f\u5ea6\u4e0d\u8d85\u8fc7 $\\varphi(p)$ \u7684\u5faa\u73af\u8282\u3002\u82e5\u4e00\u4e2a\u503c\u51fa\u73b0\u591a\u6b21\uff0c\u5219\u5b83\u7684\u6bcf\u4e00\u6b21\u51fa\u73b0\u5747\u5728\u5faa\u73af\u8282\u4e0a\u3002\u7531\u4e8e $q<t$\uff0c\u67d0\u4e00\u4e2a\u503c\u7b2c\u4e8c\u6b21\u51fa\u73b0\u65f6\u5bf9\u5e94\u7684 $a^{p't-q}$ \u5fc5\u7136\u5927\u4e8e\u7b2c\u4e00\u6b21\u51fa\u73b0\u65f6\u5bf9\u5e94\u7684 $a^{pt}$\uff0c\u8fd9\u610f\u5473\u7740\u53ea\u6709\u7b2c\u4e00\u6b21\u51fa\u73b0\u67d0\u4e00\u4e2a\u503c\u65f6 $a^{pt-q}$ \u624d\u53ef\u80fd\u5728\u975e\u5faa\u73af\u6570\u4e2d\u3002\u7531\u4e8e\u5728\u5faa\u73af\u8282\u4e2d\u5f97\u5230\u7684\u7b54\u6848\u4e0d\u4f1a\u4ea7\u751f\u5dee\u5f02\uff0c\u53d6\u524d\u4e24\u6b21\u5fc5\u5b9a\u80fd\u8003\u8651\u5230\u7b54\u6848\u7684\u6240\u6709\u60c5\u51b5\u3002\r\n\r\n## \u4ee3\u7801\r\n\u52a0\u5f3a\u6570\u636e\u540e\u5df2\u901a\u8fc7\u3002\r\n\r\n\u5148\u53d6\u6a21\u518d\u8dd1\u5373\u53ef\u3002\r\n```cpp\r\n#include<algorithm>\r\n#include<cmath>\r\n#include<cstdio>\r\n#include<cstring>\r\nusing namespace std;\r\nconst long long maxn=1e5,mod=1145141,inf=0xffffffffffffffll;\r\nlong long base,rest,prime,baby[maxn+1],giant[maxn+1],key[mod],comment[2][mod],stk[mod<<1|1];\r\nlong long Hash(long long value)\r\n{\r\n\tlong long now=value*value%mod;\r\n\twhile(key[now]&&key[now]!=value)\r\n\t\tnow=(now+1)%mod;\r\n\tif(!key[now])\r\n\t\tstk[++stk[0]]=now;\r\n\tkey[now]=value;\r\n\treturn now;\r\n}\r\nlong long phi(long long x)\r\n{\r\n\tlong long res=x;\r\n\tfor(long long i=2;i*i<=x;++i)\r\n\t\tif(x%i==0)\r\n\t\t{\r\n\t\t\tres=res/i*(i-1);\r\n\t\t\twhile(x%i==0)\r\n\t\t\t\tx/=i;\r\n\t\t}\r\n\tif(x>1)\r\n\t\tres=res/x*(x-1);\r\n\treturn res;\r\n}\r\nlong long exBSGS(void)\r\n{\r\n\tlong long res=inf,block=ceil(sqrt(2*phi(prime)));\r\n\tbaby[0]=1;\r\n\tfor(long long i=1;i<=block;++i)\r\n\t\tbaby[i]=baby[i-1]*base%prime;\r\n\tcomment[0][Hash(1)]=0;\r\n\tgiant[0]=1;\r\n\tfor(long long i=1;i<=block;++i)\r\n\t{\r\n\t\tgiant[i]=giant[i-1]*baby[block]%prime;\r\n\t\tlong long now=Hash(giant[i]);\r\n\t\tif(!comment[0][now])\r\n\t\t\tcomment[0][now]=i;\r\n\t\telse if(!comment[1][now])\r\n\t\t\tcomment[1][now]=i;\r\n\t}\r\n\tfor(long long i=0;i<=block;++i)\r\n\t{\r\n\t\tlong long now=Hash(rest*baby[i]%prime),t0=comment[0][now],t1=comment[1][now];\r\n\t\tif(t0&&giant[t0-1]*baby[block-i]%prime==rest)\r\n\t\t\tres=min(res,t0*block-i);\r\n\t\telse if(t1&&giant[t1-1]*baby[block-i]%prime==rest)\r\n\t\t\tres=min(res,t1*block-i);\r\n\t}\r\n\treturn res;\r\n}\r\nsigned main()\r\n{\r\n\twhile(scanf(\"%lld%lld%lld\",&base,&prime,&rest)!=EOF)\r\n\t{\r\n\t\twhile(stk[0])\r\n\t\t{\r\n\t\t\tkey[stk[stk[0]]]=comment[0][stk[stk[0]]]=comment[1][stk[stk[0]]]=0;\r\n\t\t\t--stk[0];\r\n\t\t}\r\n\t\tif(!prime&&!base&&!rest)\r\n\t\t\tbreak;\r\n\t\tbase%=prime;\r\n\t\trest%=prime;\r\n\t\tlong long res=exBSGS();\r\n\t\tif(res==inf)\r\n\t\t\tputs(\"No Solution\");\r\n\t\telse printf(\"%lld\\n\",res);\r\n\t}\r\n\treturn 0;\r\n}\r\n```\r\n\r\n",
        "postTime": 1613998015,
        "uid": 67952,
        "name": "\u767d\u9c9f",
        "ccfLevel": 7,
        "title": "P4195  \u9898\u89e3 & \u6269\u5c55 BSGS \u5b66\u4e60\u7b14\u8bb0"
    },
    {
        "content": "[\u63a8\u8350\u5230\u6211\u7684\u535a\u5ba2\u67e5\u770b\uff0c\u5e76\u4e0d\u4f1a\u6709\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff08\u96fe](https://www.cnblogs.com/suxxsfe/p/12666760.html)\n\n# BSGS  \n\nBSGS\uff0c\u5168\u79f0\u53eb BabyStepGiantStep\uff0c\u4e5f\u5c31\u662f\u5927\u6b65\u5c0f\u6b65  \n\u5176\u5b9e\u8fd8\u662f\u6bd4\u8f83\u66b4\u529b\u7684  \n\n\u5b83\u53ef\u4ee5$O(\\sqrt p)$\u7684\u590d\u6742\u5ea6\u5185\u89e3\u51fa\uff1a  \n\n$$a^x\\equiv n\\pmod p,\\gcd(a,p)=1$$  \n\n\u4e2d$x$\u7684\u503c  \n\u5982\u679c$\\gcd(a,p)\\neq 1$\u5c31\u8981\u7528\u5230 exBSGS \u4e86  \n\n\u6211\u4eec\u8003\u8651\u4ee4$x=im-k,0\\le k<m$  \n\u90a3\u4e48\u539f\u5f0f\u53d8\u4e3a  \n\n$$a^{im-k}\\equiv n\\pmod p$$  \n$$a^{im}\\equiv na^k\\pmod p$$  \n\n\u90a3\u4e48\uff0c\u6211\u80af\u53ef\u4ee5\u679a\u4e3e$k\\in[0,m)$\uff0c\u8ba1\u7b97\u51fa$na^k\\bmod p$\u7684\u503c\uff0c\u7136\u540e\u628a\u5bf9\u5e94\u7684$k$\u5b58\u4e0b\u6765  \n\u53ef\u4ee5\u7528`map`\u6216 hash\uff0c\u7528`map`\u4f1a\u591a\u4e00\u4e2a$\\log$  \n\n\u7136\u540e\uff0c\u518d\u679a\u4e3e$i\\in[0,\\lceil\\frac{p}{m}\\rceil]$\uff0c\u8ba1\u7b97\u51fa$a^{im}\\bmod p$  \n\u7136\u540e\u770b\u4e00\u770b\u4e4b\u524d\u6709\u6ca1\u6709\u4e00\u4e2a$k$\uff0c\u4f7f\u5f97$na^k\\equiv a^{im}\\pmod p$\uff0c\u4e14$im>=k$  \n\u5982\u679c\u6709\uff0c\u90a3\u4e48\u7b54\u6848\u80af\u5b9a\u5c31\u662f$im-k$  \n\u5982\u679c\u4e00\u76f4\u6ca1\u627e\u5230\uff0c\u90a3\u4e48\u5c31\u65e0\u89e3  \n\n\u590d\u6742\u5ea6\u662f$O(\\max(m,\\frac{p}{m} ))$\uff0c\u663e\u7136\uff0c\u8ba9$m=\\lceil \\sqrt p \\rceil$\u65f6\u6700\u4f18\uff0c\u5373\u4e3a$O(\\sqrt p)$  \n\n\u4f46\u662f\uff0c\u6211\u4eec\u8003\u8651\u7684\u53ea\u662f$x\\in[1,p]$\u7684\u60c5\u51b5\uff0c\u90a3\u4e3a\u4ec0\u4e48\u8981\u627e\u7684\u8fd9\u4e2a$x$\u4e00\u5b9a\u6ee1\u8db3\u8fd9\u6837\u7684\u6027\u8d28\u5462\uff1f  \n\u9996\u5148$\\gcd(a,p)=1$\uff0c\u6ee1\u8db3\u6b27\u62c9\u5b9a\u7406\u7684\u6761\u4ef6\uff0c\u4e5f\u5c31\u662f\u4f1a\u6709$a^{\\varphi(p)}\\equiv 1\\pmod p\\Rightarrow a^{q\\varphi(p)}\\equiv 1\\pmod p,q\\in\\mathbb{N^*}$  \n\u90a3\u4e48\uff0c$k\\bmod \\varphi(p)=k-q\\varphi(p)<\\varphi(p)<p$  \n\u5219$a^{k\\bmod \\varphi(p)}=\\dfrac{a^k}{a^{q\\varphi(p)}}$  \n\u53c8\u7531\u4e8e\u90a3\u4e2a\u5206\u6bcd\u5728$\\bmod p$\u4e2d\u540c\u4f59\u4e8e$1$  \n\u6240\u4ee5$a^{k\\bmod \\varphi(p)}\\equiv a^k\\pmod p$  \n\n\u5219\u53ef\u4ee5\u5f97\u77e5\uff0c\u8981\u6c42\u7684\u6700\u5c0f\u7684$x$\uff0c\u5982\u679c\u6709\u89e3\uff0c\u4e00\u5b9a\u6ee1\u8db3$x<\\varphi(p)<p$  \n\n\u6a21\u677f\u9898\uff1a[P3846 [TJOI2007] \u53ef\u7231\u7684\u8d28\u6570](https://www.luogu.com.cn/problem/P3846)  \n\u8fd9\u9898\u4fdd\u8bc1\u4e86$a,n<p$\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u4e00\u4e9b\u5947\u5947\u602a\u602a\u7684\u7279\u5224  \n\n```cpp  \n#include<cstdio>\n#include<algorithm>\n#include<iostream>\n#include<cmath>\n#include<iomanip>\n#include<cstring>\n#include<map>\n#define reg register\n#define EN std::puts(\"\")\n#define LL long long\ninline int read(){\n\tregister int x=0;register int y=1;\n\tregister char c=std::getchar();\n\twhile(c<'0'||c>'9'){if(c=='-') y=0;c=std::getchar();}\n\twhile(c>='0'&&c<='9'){x=x*10+(c^48);c=std::getchar();}\n\treturn y?x:-x;\n}\nstd::map<int,int>map;\ninline int power(int a,int b,int p){\n\tint ret=1;\n\twhile(b){\n\t\tif(b&1) ret=1ll*ret*a%p;\n\t\tb>>=1;a=1ll*a*a%p;\n\t}\n\treturn ret;\n}\ninline int BSGS(int a,int n,int p){\n\treg int m=std::ceil(std::sqrt(p));\n\tfor(reg int i=0,s=n;i<m;i++,s=1ll*s*a%p) map[s]=i;\n\tfor(reg int i=0,tmp=power(a,m,p),s=1;i<=m;i++,s=1ll*s*tmp%p)\n\t\tif(map.find(s)!=map.end())\n\t\t\tif(i*m>=map[s]) return i*m-map[s];\n\treturn -1;\n}\nint main(){\n\tint p=read(),a=read(),n=read();\n\tLL ans=BSGS(a,n,p);\n\tans==-1?std::puts(\"no solution\"):std::printf(\"%lld\",ans);\n\treturn 0;\n}\n```  \n\n# exBSGS  \n\n\u7528\u4e8e\u5904\u7406\u4e0a\u9762\u54ea\u4e2a\u95ee\u9898$\\gcd(a,p)\\neq 1$\u7684\u60c5\u51b5  \n~~\u6709\u4e9b\u7ec6\u8282\u7a0d\u663e\u6076\u5fc3\uff08\u5176\u5b9e\u8fd8\u597d~~  \n\n\u9996\u5148\uff0c\u539f\u6765\u90a3\u4e2a\u540c\u4f59\u65b9\u7a0b\u53ef\u4ee5\u7b49\u4ef7\u7684\u5199\u6210\uff1a  \n\n$$a^x+kp=n$$  \n\n\u8bbe$\\gcd(a,p)=d$  \n\u7531\u4e8e\u6590\u8700\u5b9a\u7406\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u6709\u89e3\u7684\u5145\u8981\u6761\u4ef6\u662f$d\\mid n$\uff0c\u5426\u5219\u76f4\u63a5\u8fd4\u56de\u65e0\u89e3  \n\u90a3\u4e48\u4e0a\u9762\u7684\u5f0f\u5b50\u5c31\u662f\uff1a  \n\n$$a^{x-1}\\cdot \\frac{a}{d}+k\\cdot\\frac{p}{d}=\\frac{n}{d}$$  \n\n\u6b64\u65f6\uff0c$a^{x-1}\\rightarrow a^x,\\frac{p}{d}\\rightarrow p,\\frac{n}{d}\\rightarrow n$  \n\u90a3\u4e48\u4e00\u76f4\u9012\u5f52\uff0c\u76f4\u5230$\\gcd(a,p)=1$  \n\n\u6240\u4ee5\u6b64\u65f6\u8bbe\u4e00\u5171\u9012\u5f52\u4e86$cnt$\u6b21\uff0c\u8fd9\u6240\u6709\u6b21\u9012\u5f52\u7684$d$\u7684\u4e58\u79ef\u662f$d$~~\uff08\u7528\u4e00\u4e2a\u5b57\u6bcd\u8bf4\u8d77\u6765\u7701\u4e8b~~  \n\u539f\u5f0f\u5c31\u662f  \n\n$$a^{x-cnt}\\cdot \\frac{a^{cnt}}{d}\\equiv \\frac{n}{d}\\pmod {\\frac{p}{d}}$$  \n\n\u90a3\u4e48\u6211\u4eec\u5c31\u7528$a'=a,n'=\\frac{n}{d},p'=\\frac{p}{d}$\u6765\u8dd1\u4e00\u6b21 BSGS \u5c31\u884c\u4e86  \n\n\u5f53\u7136\uff0c\u7b54\u6848\u8fd8\u8981\u518d\u52a0\u4e0a$cnt$   \n\u800c\u4e14\uff0c\u8fd8\u6709\u4e00\u4e2a$\\dfrac{a^{cnt}}{d}$\u7684\u7cfb\u6570\u8981\u4e58\u4e0a\uff0c\u5177\u4f53\u5bf9\u5e94\u4ee3\u7801\u4e2d\u7684\u53d8\u91cf`ad`\uff0c\u8981\u4f20\u53c2\u5230 BSGS \u7684\u51fd\u6570\u91cc  \n\n\u6a21\u677f\u9898\uff1a[SP3105 MOD - Power Modulo Inverted](https://www.luogu.com.cn/problem/SP3105)\uff0c[P4195 \u3010\u6a21\u677f\u3011exBSGS](https://www.luogu.com.cn/problem/P4195)  \n\u8fd8\u662f\u53cc\u500d\u7ecf\u9a8c\uff0c\u4f46\u662f\u8fd9\u4e2a\u4e0d\u4fdd\u8bc1$a,n<p$\uff0c\u6240\u4ee5\u8981\u5148\u6a21\u4e00\u4e0b\uff0c\u7136\u540e\u5224\u65ad\u4e00\u4e0b\u662f\u4e0d\u662f\u7b49\u4e8e$0$\uff0c\u5177\u4f53\u770b\u4ee3\u7801  \n\u800c\u4e14\u8fd9\u4e2a\u8fd8\u5361\u5e38\uff0c\u5fc5\u987b\u8981\u7528`unordered_map`\uff0c\u5b83\u7684\u5185\u90e8\u5b9e\u73b0\u662f\u54c8\u5e0c\u8868\uff0c\u800c`map`\u662f\u7ea2\u9ed1\u6811\uff0c\u524d\u8005\u6784\u5efa\u597d\u50cf\u7a0d\u6162\uff0c\u4f46\u662f\u67e5\u8be2\u5feb\uff0c\u9002\u5408\u8fd9\u4e2a\u9898  \n~~\u8bdd\u8bf4\u6211\u5199\u8fd9\u9898\u7684\u65f6\u5019\u542c\u8bf4\u5361\u5e38\uff0c\u7136\u540eT\u4e86\u4ee5\u540e\u731b\u5361\u5e38\u6570\uff0c\u7ed3\u679c\u540e\u6765\u53d1\u73b0\u662f\u5199\u6cd5\u9519\u4e86\uff0c\u4e8e\u662f\u5c31\u5bf9\u7740\u9519\u8bef\u7684\u7a0b\u5e8f\u5361\u4e86\u4e00\u665a\u4e0a\u5e38\u76f4\u81f3\u81ea\u95ed~~  \n\u4e0d\u8fc7\u662f c++11 \u7684\u4e1c\u897f\uff0cnoip\u53ef\u80fd\u4e0d\u80fd\u7528\uff0c\u7f16\u8bd1\u65f6\u8981\u52a0\u4e0a`-std=c++11`  \n\n\u5f53\u7136\u5199 hash \u4e5f\u53ef\u4ee5\uff0c\u4f46\u6211\u4e0d\u592a\u4f1a/kk  \n\n```cpp  \n#include<cstdio>\n#include<map>\n#include<algorithm>\n#include<iostream>\n#include<cmath>\n#include<iomanip>\n#include<cstring>\n#include<unordered_map>\n#define reg register\n#define EN std::puts(\"\")\n#define LL long long\ninline int read(){\n\tregister int x=0;register int y=1;\n\tregister char c=std::getchar();\n\twhile(c<'0'||c>'9'){if(c=='-') y=0;c=std::getchar();}\n\twhile(c>='0'&&c<='9'){x=x*10+(c^48);c=std::getchar();}\n\treturn y?x:-x;\n}\nstd::unordered_map<int,int>map;\nint gcd(int a,int b){return b?gcd(b,a%b):a;}\ninline int BSGS(int a,int n,int p,int ad){\n\tmap.clear();\n\treg int m=std::ceil(std::sqrt(p));\n\treg int s=1;\n\tfor(reg int i=0;i<m;i++,s=1ll*s*a%p) map[1ll*s*n%p]=i;\n\tfor(reg int i=0,tmp=s,s=ad;i<=m;i++,s=1ll*s*tmp%p)\n\t\tif(map.find(s)!=map.end())\n\t\t\tif(1ll*i*m-map[s]>=0) return 1ll*i*m-map[s];\n\treturn -1;\n}\ninline int exBSGS(int a,int n,int p){\n\ta%=p;n%=p;\n\tif(n==1||p==1) return 0;\n\treg int cnt=0;\n\treg int d,ad=1;\n\twhile((d=gcd(a,p))^1){\n\t\tif(n%d) return -1;\n\t\tcnt++;n/=d;p/=d;\n\t\tad=(1ll*ad*a/d)%p;\n\t\tif(ad==n) return cnt;\n\t}\n//\t\tstd::printf(\"a: %d n: %d p: %d ad:%d\\n\",a,n,p,ad);\n\tLL ans=BSGS(a,n,p,ad);\n\tif(ans==-1) return -1;\n\treturn ans+cnt;\n} \nsigned main(){\n\tint a=read(),p=read(),n=read();\n\twhile(a||p||n){\n\t\tint ans=exBSGS(a,n,p);\n\t\tif(~ans) std::printf(\"%d\\n\",ans);\n\t\telse std::puts(\"No Solution\");\n\t\ta=read();p=read();n=read();\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1586414419,
        "uid": 164432,
        "name": "suxxsfe",
        "ccfLevel": 9,
        "title": "BSGS \u548c\u6269\u5c55"
    },
    {
        "content": "**Update on 2021-11-01\uff1a** \u66f4\u65b0\u4e86\u4ee3\u7801\uff0c\u53ef\u80fd\u4f1a\u63d0\u5347\u9605\u8bfb\u6548\u679c\u5427\u3002\n\n**Update on 2022-07-04\uff1a** \u88ab @RainFestival Hack \u4e86\uff0c\u66f4\u65b0\u4e86\u4ee3\u7801\uff0c\u5df2\u7ecf\u53ef\u4ee5\u901a\u8fc7\u3002\n\n## 0. \u524d\u7f6e\u77e5\u8bc6 & \u5e9f\u8bdd\n\n\u9006\u5143\u3002\n\n[\u6211\u7684\u9006\u5143 Blog](https://www.luogu.com.cn/blog/mydcwfy-342891/inverse-element)\n\n## 1. \u666e\u901a\u7248 BSGS\n\n\u8981\u6c42 $\\gcd(a,p)=1$\u3002\n\n\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u5206\u5757\u7684\u601d\u60f3\u3002\n\n\u8bbe $t=\\lceil\\sqrt p\\rceil$\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6bcf\u4e00\u4e2a\u7b54\u6848 $x=i\\times t-m$\uff0c\u5176\u4e2d $i,m\\leq t$\u3002\n\n$a^{i\\cdot t-m}=b\\pmod p\\Leftrightarrow a^{i\\cdot t}=b\\times a^{m}\\pmod p$\u3002\n\n\u6211\u4eec\u679a\u4e3e\u6bcf\u4e00\u4e2a $i$\uff0c\u600e\u4e48\u627e\u5230\u53f3\u8fb9\u7684\u5462\uff1f\n\n\u5176\u5b9e\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u5c06 $b\\times a^m$ \u5168\u90e8\u7528 Hash \u5b58\u4e0b\u6765\u3002\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u76f4\u63a5\u67e5\u627e\u4e86\u3002\n\n## 2. \u6269\u5c55\u7248 BSGS\n\n\u60f3\u529e\u6cd5\u89e3\u51b3\u95ee\u9898\uff0c\u6211\u4eec\u5e94\u8be5\u5b9e\u73b0 $\\gcd(a,p)=1$\u3002\n\n\u9996\u5148\uff0c\u540c\u4f59\u5177\u6709\u4e00\u6761\u6027\u8d28\uff1a\n$$\na=b\\pmod c (\\gcd(a,c)=1)\\Leftrightarrow a\\times d=b\\times d\\pmod {c\\times d}\n$$\n\u53ef\u4ee5\u611f\u6027\u7684\u7406\u89e3\u4e00\u4e0b \uff08~~\u4e3b\u8981\u662f\u4e0d\u4f1a\u8bc1~~\uff09\u3002\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6267\u884c\u6d88\u9664\u56e0\u5b50\u3002\n\n\u6bcf\u6b21\u5728\u4e24\u8fb9\u9664\u4ee5 $d=\\gcd(a,p)$\u3002\n$$\na^x=b\\pmod p\\Rightarrow \\dfrac{a}{d}\\times a^{x-1}=\\dfrac{b}{d}\\pmod {\\dfrac{p}{d}}\n$$\n\u91cd\u590d\u6267\u884c\u8be5\u8bed\u6bb5\uff0c\u76f4\u5230 $\\gcd(a,p)=1$ \u4e3a\u6b62\u3002\n\n\u5c06\u6240\u6709\u7684 $\\dfrac{a}{d}$ \u90fd\u4e58\u8d77\u6765\uff0c\u8bb0\u4e3a $tot$\u3002\n\n\u5047\u8bbe\u6267\u884c\u4e86 $cnt$ \u6b21\uff0c\u5219\u539f\u95ee\u9898\u8f6c\u5316\u4e3a $tot\\times a^{x-cnt}=b\\pmod p\\Leftrightarrow a^{x-cnt}=b\\times tot^{-1}\\pmod p$\n\n\u6ce8\u610f\uff0c\u8fd9\u91cc\u6709\u4e00\u4e9b\u7ec6\u8282\uff1a\n\n1. \u5982\u679c $b$ \u4e0d\u88ab $d$ \u6574\u9664\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\u65e0\u89e3\u3002\n2. \u7b54\u6848\u53ef\u80fd\u5c0f\u4e8e $cnt$\uff0c\u6211\u4eec\u5fc5\u987b\u679a\u4e3e $[0,cnt-1]$ \u7684\u89e3\uff0c\u770b\u6709\u6ca1\u6709\u3002\n\n\u4e8e\u662f\u5c31\u8f6c\u5316\u4e3a\u4e86\u666e\u901a\u7684 BSGS \u4e86\u3002\n\n```cpp\nusing LL = long long;\n\nint Mod;\n\nint Gcd(int a, int b) { return b ? Gcd(b, a % b) : a; }\n\nvoid ExGcd(int a, int b, LL &x, LL &y)\n{\n\tif (!b) return x = 1, y = 0, void();\n\tExGcd(b, a % b, y, x), y -= a / b * x;\n}\n\ninline int& adj(int &x) { return x += x >> 31 & Mod; }\n\nint qpow(int a, int k)\n{\n\tint res = 1;\n\tfor (; k; k >>= 1, a = (LL) a * a % Mod)\n\t\t(k & 1) && (res = (LL) res * a % Mod);\n\treturn res;\n}\n\nint ExBSGS(int a, int b)\n{\n\ta %= Mod, b %= Mod;\n\tif (b == 1 || Mod == 1) return 0;\n\tif (!a) return b ? -1 : 1;\n\tint t, cur = 1, g = 0;\n\twhile ((t = Gcd(a, Mod)) != 1)\n\t{\n\t\tif (b % t) return -1;\n\t\t++ g, b /= t, Mod /= t, cur = (LL) cur * (a / t) % Mod;\n\t\tif (cur == b) return g;\n\t}\n\tstd::map<int, int> mp;\n\tint B = std::sqrt(Mod) + 1;\n\tLL x, y;\n\tExGcd(cur, Mod, x, y), x = (x % Mod + Mod) % Mod;\n\tcur = (LL) x * b % Mod;\n\tmp[cur] = 0;\n\tfor (int i = 1; i <= B; ++ i) mp[cur = (LL) cur * a % Mod] = i;\n\tint pw = qpow(a, B);\n\tcur = 1;\n\tfor (int i = 1; i <= B; ++ i)\n\t\tif (mp.count(cur = (LL) cur * pw % Mod))\n\t\t\treturn i * B - mp[cur] + g;\n\treturn -1;\n}\n\nint main()\n{\n    int a, b;\n    while (read(a, Mod, b), a || b || Mod)\n    {\n        int res = ExBSGS(a, b);\n        if (~res) write(res, '\\n');\n        else write(\"No Solution\\n\");\n    }\n    return 0;\n}\n```",
        "postTime": 1624713737,
        "uid": 342891,
        "name": "mydcwfy",
        "ccfLevel": 9,
        "title": "\u6570\u8bba\uff1aExtended-BSGS"
    },
    {
        "content": "[\u6211\u7684 BSGS \u7b97\u6cd5\u5b66\u4e60\u7b14\u8bb0](https://www.luogu.com.cn/blog/nizhuan/bsgs-xue-xi-bi-ji)\n\n[P4195 \u3010\u6a21\u677f\u3011\u6269\u5c55 BSGS/exBSGS](https://www.luogu.com.cn/problem/P4195)\n\n[SP3105 MOD - Power Modulo Inverted](https://www.luogu.com.cn/problem/SP3105)\n\n\u597d\u8036\uff0c\u7d2b\u8272\u7684\u53cc\u500d\u7ecf\u9a8c\uff01\n\n\u666e\u901a\u7684 BSGS \u53ea\u80fd\u89e3\u51b3 $a$ \u4e0e $p$ \u4e92\u8d28\u7684\u60c5\u51b5\uff0c\u800c exBSGS \u4e0d\u9700\u8981\u8fd9\u4e2a\u6761\u4ef6\u3002\n\n\u4e0d\u4e92\u8d28\u548b\u529e\uff1f\u53d8\u6210\u4e92\u8d28\uff01\n\n[OI Wiki \u4e0a\u7684\u8bb2\u89e3](https://oi-wiki.org/math/bsgs/#_8)\n\n\u65b9\u7a0b\u4e24\u8fb9\u540c\u65f6\u9664\u4ee5 $\\gcd(a,p)$ \uff0c\u6ce8\u610f\u6a21\u6570 $p$ \u4e5f\u8981\u9664\uff0c\u82e5 $\\gcd(a,p) \\nmid b$ \u5219\u65e0\u89e3\u3002\n\n\u82e5\u4ecd\u4e0d\u4e92\u8d28\u5219\u91cd\u590d\u8fdb\u884c\u4e0a\u8ff0\u8fc7\u7a0b\uff0c\u76f4\u81f3 $p$ \u4e0e $a$ \u4e92\u8d28\u3002\n\n\u8bb0 $d$ \u4e3a\u6bcf\u6b21\u7684 $\\gcd$ \u7684\u4e58\u79ef\uff0c\u4e00\u5171\u9664\u4e86 $cnt$ \u6b21\uff0c\u5219\u65b9\u7a0b\u8f6c\u5316\u4e3a\uff1a\n\n$$\\frac{a^{cnt}}{d}\\times a^{x-cnt} \\equiv \\frac{b}{d}\\pmod {\\frac{p}{d}}$$\n\n\u56e0\u4e3a $a\\perp \\frac{p}{d}$ \uff0c\u6240\u4ee5 $\\frac{a^{cnt}}{d}$ \u5728 $\\bmod \\frac{p}{d}$ \u610f\u4e49\u4e0b\u6709\u9006\u5143\uff0c\u79fb\u9879\u6c42\u89e3 $x-cnt$ \u7136\u540e\u52a0\u4e0a $cnt$ \u5373\u53ef\u3002\n\n\u5f53\u7136\u6709\u65f6\u5019 $x=cnt$ \uff0c\u8fd9\u79cd\u60c5\u51b5\u76f4\u63a5\u8fd4\u56de $cnt$ \u5c31\u597d\u4e86\u3002\n\n## Code\n\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <algorithm>\n#include <cmath>\n#include <map>\n\nusing namespace std;\n\nint exgcd(int a,int b,int &x,int &y)\n{\n\tif(!b) {x=1; y=0; return a;}\n\tint d=exgcd(b,a%b,y,x);\n\ty-=a/b*x;\n\treturn d;\n}\n\nmap <int,int> _hash;\ninline int exBSGS(int a,int b,int p)\n{\n\ta%=p; b%=p;\n\tif(b == 1 || p == 1) return 0;\n\tint d,ax=1,cnt=0,x,y;\n\twhile((d=exgcd(a,p,x,y))^1)\n\t{\n\t\tif(b%d) return -1;\n\t\tb/=d; p/=d; cnt++;\n\t\tax=1ll*ax*(a/d)%p;\n\t\tif(ax == b) return cnt;\n\t}\n\t\n\texgcd(ax,p,x,y);\n\tint inv=(x%p+p)%p;\n\tb=1ll*b*inv%p;\n\t\n//\tBSGS\n\t_hash.clear();\n\tint t=ceil(sqrt(p)),val=1;\n\tfor(int i=0;i<t;i++)\n\t{\n\t\t_hash[1ll*b*val%p]=i;\n\t\tval=1ll*val*a%p;\n\t}\n\ta=val; val=1;\n\t\n\tif(!a) return !b? 1+cnt:-1;\n\tfor(int i=0,j;i<=t;i++)\n\t{\n\t\tj=_hash.find(val) == _hash.end()? -1:_hash[val];\n\t\tif(~j && i*t-j >= 0) return i*t-j+cnt;\n\t\tval=1ll*val*a%p;\n\t}\n\treturn -1;\n}\n\nint main()\n{\n//\tfreopen(\"work.in\",\"r\",stdin); freopen(\"work.out\",\"w\",stdout);\n\tint a,b,p,ans;\n\twhile(scanf(\"%d%d%d\",&a,&p,&b) == 3 && a && b && p)\n\t{\n\t\tans=exBSGS(a,b,p);\n\t\tif(~ans) printf(\"%d\\n\",ans);\n\t\telse puts(\"No Solution\");\n\t}\n//\tfclose(stdin); fclose(stdout);\n\treturn 0;\n}\n```\n\n\u7531\u4e8e\u6211\u592a\u83dc\uff0c\u5728 luogu \u4e0a\u6ca1\u627e\u5230\u5176\u4ed6 exBSGS \u7684\u9898\uff0c\u5982\u679c\u60a8\u6709\u8fd9\u6837\u7684\u9898\u76ee\u63a8\u8350\uff0c\u53ef\u4ee5\u79c1\u4fe1\u6216\u8005\u4e0b\u65b9\u56de\u590d\u3002\u8c22\u8c22\u60a8\u7684\u9f13\u52b1\u548c\u652f\u6301\uff01\n\n## $\\text{Thank you for your reading !}$",
        "postTime": 1627262491,
        "uid": 240191,
        "name": "MY\uff08\u4e00\u540d\u849f\u84bb\uff09",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P4195 \u3010\u3010\u6a21\u677f\u3011\u6269\u5c55 BSGS/exBSGS\u3011"
    },
    {
        "content": "# $\\text{BSGS}$ \u7b97\u6cd5\n\n## \u6982\u5ff5\n\nBSGS \u7b97\u6cd5\u7528\u4e8e\u6c42\u89e3\u79bb\u6563\u5bf9\u6570\u540c\u4f59\u65b9\u7a0b\n$$\na^t\\equiv b\\pmod{p}\n$$\n\n## \u7b97\u6cd5\n\n\u6211\u4eec\u5148\u8ba8\u8bba $a$ \u548c $p$ \u4e92\u8d28\u7684\u60c5\u51b5\u3002\n\n\u9996\u5148\u7531\u6b27\u62c9\u5b9a\u7406\u53ef\u4ee5\u77e5\u9053\n$$\na^{t}\\equiv a^{t\\mod{\\varphi(p)}}\\pmod{p}\n$$\n\u800c\u53c8\u77e5 $\\varphi(p)<p$ \uff0c\u90a3\u4e48\u8003\u8651\u66b4\u529b\u679a\u4e3e $1\\sim p$\uff0c\u4e00\u5b9a\u53ef\u4ee5\u627e\u51fa\u6700\u5c0f\u7684\u975e\u8d1f\u6574\u6570 $t$ \n\n\u8bbe $k=\\sqrt{p}+1$ \uff0c$t=kx-y$  \uff0c\u5176\u4e2d \n$$\n\\begin{aligned}\nx\\in[1,\\ k],\\quad y\\in[0,\\ k-1]\n\\end{aligned}\n$$\n\u8fd9\u6837\u901a\u8fc7\u679a\u4e3e $x,y$ \uff0c\u4e00\u5b9a\u53ef\u4ee5\u904d\u5386\u5230 $1\\sim p$ \u3002\u5f53\u7136\u5f00\u59cb\u65f6\u8981\u5bf9 $x=0$ \u8fdb\u884c\u7279\u5224\u3002\n\n\u53d1\u73b0 $x,y\\sim \\Theta(\\sqrt{p})$ \u3002\u90a3\u4e48\u8003\u8651\u4f18\u5316\uff1a\u9996\u5148\u5c06\u95ee\u9898\u8f6c\u5316\u4e3a\u6c42\u89e3\n$$\na^{kx}\\equiv b\\cdot a^y\\pmod{p}\n$$\n\u7528\u4e00\u4e2a Hash \u8868\u5c06\u53f3\u8fb9\u6240\u6709\u7684\u53d6\u503c\u4e0e $y$ \u7684\u5bf9\u5e94\u5b58\u4e0b\u6765\uff0c\u7136\u540e\u679a\u4e3e $x$ \uff0c\u5728 Hash \u8868\u4e2d\u67e5\u627e\u662f\u5426\u6709\u4e0e $a^{kx}$ \u5bf9\u5e94\u7684 $y$ \u5373\u53ef\u3002\u9884\u5904\u7406\u548c\u679a\u4e3e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662f $\\Theta(\\sqrt{p})$ \u7ea7\u522b\uff0c\u56e0\u6b64\u603b\u590d\u6742\u5ea6\u5c31\u662f $\\Theta(\\sqrt{p})$ \u3002\n\n## Q & A\n\n>Q : \u4e3a\u4ec0\u4e48 $x$ \u4e00\u5b9a\u8981\u4ece $1$ \u5f00\u59cb\u679a\u4e3e\uff1f\n>\n>A : \u8003\u8651 $x=0$ \u7684\u60c5\u51b5\uff0c\u5982\u679c\u7ee7\u7eed\u4e0a\u9762\u7684\u679a\u4e3e\uff0c\u90a3\u4e48\u76f8\u5f53\u4e8e\u6c42 $1\\equiv ba^y\\pmod{p}$ \uff0c\u8fd9\u6837\u7684 $y$ \u4e00\u5b9a\u662f\u8d1f\u6570\uff0c\u800c BSGS \u6c42\u89e3\u7684 $t$ \u7ecf\u5e38\u8981\u6c42\u662f\u975e\u8d1f\u6574\u6570\u3002\u6240\u4ee5\u4ece $1$ \u5f00\u59cb\u679a\u4e3e\u3002\n\n## exBSGS\n\n\u6b64\u65f6\u4e0d\u8981\u6c42 $a,p$ \u4e92\u8d28\uff0c\u90a3\u4e48\u600e\u4e48\u6c42\u89e3\u5462\uff1f\n\n\u6ce8\u610f\u5230\n$$\na^t\\equiv b\\pmod{p} \\Leftrightarrow a^t+kp=b\n$$\n\u4ee4 $d=\\gcd(a,p)$ \uff0c\u7b49\u5f0f\u7684\u5de6\u8fb9\u663e\u7136\u80fd\u88ab $d$ \u6574\u9664\uff0c\u90a3\u4e48\u53ef\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\n\n1. $d\\nmid b$ \uff0c\u6b64\u65f6\u65e0\u89e3\n\n2. $d \\mid b$ \uff0c\u90a3\u4e48\u5c06\u7b49\u5f0f\u4e24\u8fb9\u540c\u65f6\u9664 $d$ \u5f97\n    $$\n    \\begin{aligned}\n    &\\dfrac{a}{d}a^{t-1}+k\\dfrac{p}{d}=\\dfrac{b}{d}\\\\\n    \\Leftrightarrow & \\dfrac{a}{d}a^{t-1}\\equiv \\dfrac{b}{d}\\pmod{\\dfrac{p}{d}}\\\\\n    \\Leftrightarrow & a^{t-1}\\equiv \\dfrac{b}{d}\\cdot\\left(\\dfrac{a}{d}\\right)^{-1}\\pmod{\\dfrac{p}{d}}\\\\\n    \\end{aligned}\n    $$\n    \n\n\u5982\u679c $a$ \u548c $\\dfrac{p}{d}$ \u5df2\u7ecf\u4e92\u8d28\u4e86\uff0c\u90a3\u4e48\u76f4\u63a5\u7528 BSGS \u6c42\u89e3\u5373\u53ef\uff0c\u5982\u679c\u4e0d\u4e92\u8d28\uff0c\u9012\u5f52\u6267\u884c\u6b65\u9aa4\u3002\u4e8b\u5b9e\u4e0a\uff0c\u7531\u4e8e\u56e0\u6570\u6709\u9650\uff0c\u9012\u5f52\u6b21\u6570\u4e00\u5b9a\u4e0d\u4f1a\u8d85\u8fc7 $\\mathcal{O}(\\log p)$\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <cmath>\n#include <algorithm>\n#include <unordered_map>\n\nusing namespace std;\n\ntypedef long long LL;\n\nconst int INF = 0x3f3f3f3f;\n\nint a, b, p;\nunordered_map<int, int> hs;\n\nint exgcd(int a, int b, int &x, int &y) {\n    if (!b) {\n        x = 1, y = 0;\n        return a;\n    }\n    int d = exgcd(b, a % b, y, x);\n    y -= a / b * x;\n    return d;\n}\n\nint BSGS(int a, int b, int p) {\n    if (1 % p == b % p) return 0;\n    int k = sqrt(p) + 1;\n    hs.clear();\n    for (int y = 0, r = b % p; y < k; y++) {\n        hs[r] = y;\n        r = (LL)r * a % p;\n    }\n    int ak = 1;\n    for (int i = 1; i <= k; i++) ak = (LL)ak * a % p;\n    for (int x = 1, l = ak; x <= k; x++) {\n        if (hs.count(l)) return k * x - hs[l];\n        l = (LL)l * ak % p;\n    }\n    return -INF;\n}\n\nint exBSGS(int a, int b, int p) {\n    b = (b % p + p) % p;\n    if (1 % p == b % p) return 0;\n    int x, y;\n    int d = exgcd(a, p, x, y);\n    if (d > 1) {\n        if (b % d) return -INF;\n        exgcd(a / d, p / d, x, y);\n        return exBSGS(a, (LL)b / d * x % (p / d), p / d) + 1;\n    }\n    return BSGS(a, b, p);\n}\n\nint main() {\n    while (~scanf(\"%d%d%d\", &a, &p, &b), a || b || p) {\n        int res = exBSGS(a, b, p);\n        if (res < 0) puts(\"No Solution\");\n        else printf(\"%d\\n\", res);\n    }\n    return 0;\n}\n```",
        "postTime": 1640101309,
        "uid": 86409,
        "name": "Night_star",
        "ccfLevel": 5,
        "title": "[Solution && Learning Record] exBSGS"
    },
    {
        "content": "### \u9898\u76ee\n\n\u6c42\u89e3\n\n$$a^x\\equiv b\\pmod p$$\n\n\u4e0e [\u53ef\u7231\u7684\u8d28\u6570](https://www.luogu.com.cn/problem/P3846)\u4e0d\u540c\u7684\u662f\uff0c\u8fd9\u91cc\u7684 $a$ \u548c $p$ \u5e76\u4e0d\u4e00\u5b9a\u4e92\u8d28\u3002\u8fd9\u610f\u5473\u7740\u6211\u4eec\u9700\u8981\u5f15\u5165\u4e00\u79cd\u65b0\u7684\u7b97\u6cd5\u2014\u2014exBSGS\u3002\n\n### exBSGS\n\n**\u524d\u7f6e\u829d\u58eb**\n- [\u539f\u6839](https://www.luogu.com.cn/problem/P6091)\n- [BSGS](https://www.luogu.com.cn/problem/P3846)\n- [exgcd](https://www.luogu.com.cn/problem/P5656)\n\n\u5f53\u7136\u5982\u679c\u60a8\u89c9\u5f97\u4e00\u4e2a\u4e00\u4e2a\u70b9\u5f00\u770b\u9ebb\u70e6\u7684\u8bdd\uff0c\u53ef\u4ee5\u5eb7\u4e00\u5eb7[\u6211\u7684\u6570\u8bba\u603b\u7ed3](https://www.luogu.com.cn/blog/181775/shu-lun)\uff0c\u4e5f\u6b22\u8fce\u5927\u4f6c\u6765\u6307\u51fa\u9519\u8bef\u3002\n\n**exBSGS**\n\n\u867d\u7136 $a,p$ \u4e0d\u4e00\u5b9a\u4e92\u8d28\u3002\u6211\u4eec\u53ef\u4ee5\u60f3\u529e\u6cd5\u8ba9\u5979\u4eec\u4e92\u8d28\u3002\n\n\u5177\u4f53\u5730\uff0c\u8bbe $d_1=\\gcd(a,p)$\u3002\u82e5 $d_1 \\nmid b$\uff0c\u65b9\u7a0b\u65e0\u89e3\u3002\u5426\u5219\u5c06\u65b9\u7a0b\u540c\u65f6\u9664\u4ee5 $d_1$\uff0c\u5f97\uff1a\n\n$$\\frac{a}{d_1}\u00b7a^{x-1}\\equiv \\frac b{d_1}\\pmod {\\frac p{d_1}}$$\n\n\u82e5 $a$ \u548c $\\frac{p}{d_1}$ \u4ecd\u4e0d\u4e92\u8d28\u5c31\u7ee7\u7eed\u91cd\u590d\u4e0a\u9762\u7684\u6b65\u9aa4\uff0c\u76f4\u5230 $\\displaystyle \\gcd\\left(a,\\frac{p}{\\prod _{i=1}^{k} d_i}\\right )$\u3002\n\n\u8bb0 $D=\\prod \\limits_{i=1}^k d_i$\uff0c\u539f\u65b9\u7a0b\u88ab\u5316\u4e3a\uff1a\n\n$$\\frac {a^k}{D}\\times a^{x-k}\\equiv \\frac{b}{D}\\pmod {\\frac{p}{D}}$$\n\n\u6b64\u65f6 $\\gcd \\left( \\dfrac{a^k}{D},p\\right)=1$\uff0c\u6545 $\\dfrac{a^k}{D}$ \u5b58\u5728\u9006\u5143\uff0c\u53ef\u4ee5\u4e22\u5230\u5f0f\u5b50\u53f3\u8fb9\u3002\n\n\u8fd9\u5c31\u662f\u4e00\u4e2a\u5e73\u51e1\u7684 BSGS \u4e86\u3002\u6c42\u89e3\u51fa $x-k$ \u518d\u52a0\u4e0a $k$ \u5c31\u662f\u539f\u65b9\u7a0b\u7684\u89e3\u3002\n\n\u5982\u679c\u6709\u53ef\u80fd\u5b58\u5728 $x\\le k$ \u7684\u60c5\u51b5\u3002\u6211\u4eec\u5728\u6d88\u53bb\u56e0\u5b50\u524d\u5148 $O(k)$ \u679a\u4e3e\u4e00\u4e0b $a^i\\equiv b\\pmod p$ \u5373\u53ef\u3002\n\n**\u4ee3\u7801**\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nint a,b,p;\ninline int read()\n{\n\tint x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')f=-f;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=x*10+c-'0';c=getchar();}\n\treturn x*f;\n}\nint gcd(int a,int b){return !b?a:gcd(b,a%b);}\nint exgcd(int a,int b,int &x,int &y)\n{\n\tif(!b)\n\t{\n\t\tx=1,y=0;\n\t\treturn a;\n\t}\n\tint gcd=exgcd(b,a%b,y,x);\n\ty-=(a/b)*x;\n\treturn gcd;\n}\ninline int exBSGS(int a,int b,int mod)\n{\n\tb%=mod;\n\tif(b==1||mod==1)\treturn 0;\n\tint g=0,val=1;\n\twhile(true)\n\t{\n\t\tint d=gcd(a,mod);\n\t\tif(d==1)\tbreak;\n\t\tif(b%d)\treturn -1;\n\t\tb/=d,mod/=d,val=val*a/d%mod;\n\t\tg++;\n\t\tif(b==val)\treturn g;\n\t}\n\tint x,y;\n\texgcd(val,mod,x,y);\n\tx=(x%mod+mod)%mod;\n\tb=b*x%mod,a%=mod;\n\tmap<int,int>mp;\n\tint t=ceil(sqrt(mod));\n\tint z=1;\n\tfor(int i=0;i<t;i++)\n\t\tmp[b*z%mod]=i,z=z*a%mod;\n\tint p=1;\n\tfor(int i=1;i<=t;i++)\n\t{\n\t\tp=p*z%mod;\n\t\tif(mp.count(p))\treturn i*t-mp[p]+g;\n\t}\n\treturn -1;\n}\nsigned main()\n{\n\ta=read(),p=read(),b=read();\n\twhile(a||b||p)\n\t{\n\t\tint ans=exBSGS(a,b,p);\n\t\tif(ans==-1)\tputs(\"No Solution\");\n\t\telse\tprintf(\"%lld\\n\",ans);\n\t\ta=read(),p=read(),b=read();\n\t}\n\treturn 0;\n}\n\n```\n",
        "postTime": 1629107074,
        "uid": 181775,
        "name": "_Fontainebleau_",
        "ccfLevel": 0,
        "title": "\u9898\u89e3\u300cP4195 \u3010\u6a21\u677f\u3011\u6269\u5c55 BSGS/exBSGS\u300d"
    },
    {
        "content": "$\\operatorname{BSGS}$\u8981\u89e3\u51b3\u7684**\u95ee\u9898**:\n\u7ed9\u5b9a\u6574\u6570$a,b,p$\uff0c\u5176\u4e2d$a,p$\u4e92\u8d28\uff0c\u6c42\u4e00\u4e2a\u975e\u8d1f\u6574\u6570$x$,\u4f7f\u5f97\n$$a^x \\equiv b(mod~p)$$\n\u9996\u5148\u6211\u4eec\u5148\u53ef\u4ee5\u4e86\u89e3\u4e00\u4e0b,[\u6b27\u62c9\u5b9a\u7406](https://blog.csdn.net/zyszlb2003/article/details/89356152)\n$$a^{\\varphi(n)}\\equiv 1(mod~n)$$\n\u8bbe$x=i*m+w$,\u5176\u4e2d$m=\\left \\lceil\\ \\sqrt{p}\\right\\rceil,0\\leq w\\leq m-1$\uff0c\u4e3a\u4ec0\u4e48\u8981\u5411\u4e0a\u53d6\u6574\u5462\uff0c\u56e0\u4e3a\u6211\u4eec\u8981\u4fdd\u8bc1\u904d\u5386\u5230$p$\uff0c\u624d\u80fd\u4fdd\u8bc1$\\varphi(p)$\u88ab\u904d\u5386\u5230\uff0c\u4fdd\u8bc1\u8986\u76d6\u5230\u6700\u5c0f\u6b63\u6574\u6570\u89e3\u3002\n\u5219\u539f\u95ee\u9898\u8f6c\u5316\u4e3a:\n$$a^{i*m+w}\\equiv b(mod~n)$$\n\u5373:\n$$a^{i*m}*a^w\\equiv b(mod~n)$$\n~~\u4f7f\u7528\u65f6\u7a7a\u626d\u66f2\u672f\uff01~~ \u8bbe$A=a^{i*m},B=n,x=a^w,k=b.$~~\u4f7f\u7528\u5927\u590d\u539f\u672f\uff01~~ \u5f97\u5230:\n$$A*x+B*y=k$$\n~~\u8fd9\u4e0d\u662f\u540c\u4f59\u65b9\u7a0b\u5417\uff01~~ \u901a\u8fc7[$\\operatorname{exgcd}$](https://blog.csdn.net/zyszlb2003/article/details/89349052)\uff0c\u6c42\u51fa$x$,\u5373$a^w$.\n\u6700\u5c0f\u6574\u6570\u89e3\u5373\u4e3a\u7b2c\u4e00\u4e2a\u7b26\u5408\u6761\u4ef6\u7684$i*m+w$.\n\u5173\u4e8e\u600e\u4e48\u5b9e\u73b0\u5feb\u901f\u67e5\u627e$w$,\u6211\u4eec\u9700\u8981\u6253\u4e00\u4e2ahash\u8868\uff0c~~\u7528map\u4e5f\u884c~~\uff0c\u67e5\u8868\u5373\u53ef\n```cpp\nstruct hash\n{\n    struct node\n    {\n        ll t,next,p;\n    }a[maxn<<2];\n    int v[maxn<<2],num,len;\n    void ins(int p,ll t)\n    {\n        ll k=t&maxn;\n        if(v[k]!=num)\n        {\n            v[k]=num;\n            a[k].next=-1;a[k].t=t;a[k].p=p;\n        }\n        else\n        {\n            for(;;k=a[k].next)\n            {\n                if(t==a[k].t)return ;\n                if(a[k].next==-1)break;\n            }\n            a[k].next=++len;a[len].t=t;a[len].p=p;a[len].next=-1;\n        }\n    }\n    ll check(ll t)\n    {\n        ll k=t&maxn;\n        if(v[k]!=num)return -1;\n        for(;k!=-1;k=a[k].next)if(a[k].t==t)return a[k].p;\n        return -1;\n    }\n}h;\n```\n\u8fd9\u662f\u600e\u4e48\u4e00\u56de\u4e8b\u5462\uff1f\u5c31\u662f\u8bf4\uff0c\u6211\u9884\u5904\u7406\u5c06$a_1,a_2,......,a_{m-1}$\u52a0\u5bc6\u5230$hash$\u8868\u4e2d,\u7531\u4e8e$0\\le w<m$\uff0c\u5c31\u53ef\u4ee5\u5feb\u901f\u67e5\u8be2\u51fa$w$\u7684\u503c\u4e86\u3002\n\u90a3\u4e48\n\u6211\u4eec\u4ee3\u7801\u7684\u6d41\u7a0b\u5c31\u662f\n1.\u5c06$a_1,a_2,......,a_m$\u9884\u5904\u7406\u8fdbhash\u8868\n2.\u540e\u679a\u4e3e$i*m,0\\leq i \\leq m$\uff0c\u5224\u65ad\u662f\u5426\u53ef\u884c\u3002\n\u4ee3\u7801\n```cpp\nll bsgs(ll A,ll B,ll p)\n{\n    //ll t=1%p;for(ll i=0;i<=100;i++){if(t==B)return i;t=t*A%p;}\n    ll D=1%p;ll t;\n    ll m=(int)sqrt(p)+1;\n    t=1%p;h.len=maxn;\n    for(int i=0;i<m;i++)\n        {h.ins(i,t);t=t*A%p;}\n    //h.ins(m,t);\n\tll am=t;\n    for(int i=0;i<=m;i++)\n    {\n        ll a=D,b=p,k=B,x,y;\n        ll d=exgcd(a,b,x,y);\n        x=((x*(k/d))%(b/d)+(b/d))%(b/d);\n        ll w=h.check(x);\n        if(w!=-1)return i*m+w;\n        D=D*am%p;\n    }\n    return -1;\n}\n```\n**$exBSGS$\u7b97\u6cd5**\n\n\u82e5$a,p$\u4e0d\u4e92\u8d28\uff0c\u600e\u4e48\u529e\u5462\uff1f\n$$a^x\\equiv b(mod~p)$$\n\u90a3\u6211\u4eec\u5c31\u60f3\u529e\u6cd5\u8ba9\u5b83\u4e92\u8d28\u5457\u3002\n\u8bbe$d_1=gcd(a,p)$,\u5219\n$$a^x+py=b$$\n$$a^{x-1}*\\frac{a}{d_1}+\\frac{p}{d_1}*y=\\frac{b}{d_1}$$\n$$a^{x-1}*\\frac{a}{d_1}\\equiv  \\frac{b}{d_1}(mod ~\\frac{p}{d_1})$$\n\u8bbe$D_1=\\frac{a}{d_1},b_1=\\frac{b}{d_1},p_1=\\frac{p}{d_1}$\n\u82e5\u4f9d\u65e7\u4e0d\u4e92\u8d28\uff0c\u5219\u8bbe$d_2=gcd(a,p_1)$,\u5219\n$$a^{x-2}*D_1*\\frac{a}{d_2}\\equiv\\frac{b_1}{d_2}(mod~\\frac{p_1}{d_2})$$\n$$.................$$\n\u7ecf\u8fc7\u591a\u6b21\u8fd0\u7b97\uff0c\u5f97\u5230\u6700\u540e\u4e00\u6761\u4e92\u8d28\u7684~~\u67ff\u5b50~~\n\n$$a^{x-n}*D_n\\equiv b_n(mod~p_n) $$  \n\n\u5176\u4e2d$$D_n=\\prod_{i=1}^n\\frac{a}{d_i},b_n=\\frac{b}{\\prod _{i=1}^{n}d_i},p_n=\\frac{p}{\\prod _{i=1}^{n}d_i}$$\n\n\u7531$\\operatorname{BSGS}$\u53ef\u77e5\uff0c\u8bbe$x-n=i*m+w$,\u5176\u4e2d$m=\\left \\lceil\\ \\sqrt{p_n}\\right\\rceil,0\\leq w\\leq m-1$\n\u5219\u539f\u95ee\u9898\u8f6c\u5316\u4e3a:\n$$a^{i*m+w}*D_n\\equiv b_n(mod~p_n)$$\n\u5373:\n$$a^{i*m}*a^w*D_n\\equiv b_n(mod~p_n)$$\n~~\u4f7f\u7528\u65f6\u7a7a\u626d\u66f2\u672f\uff01~~ \u8bbe$A=a^{i*m}*D_n,B=p_n,x=a^w,k=b_n.$~~\u4f7f\u7528\u5927\u590d\u539f\u672f\uff01~~ \u5f97\u5230:\n$$A*x+B*y=k$$\n\u6700\u540e\u7b54\u6848\u5c31\u4e3a$i*m+w+n$.\n\u56de\u5230$\\operatorname{BSGS}$\u5373\u53ef\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<cstdlib>\n#define ll long long\nusing namespace std;\nconst ll maxn=(1<<16)-1;\nstruct hash\n{\n    struct node\n    {\n        ll t,next,p;\n    }a[maxn<<2];\n    int v[maxn<<2],num,len;\n    void ins(int p,ll t)\n    {\n        ll k=t&maxn;\n        if(v[k]!=num)\n        {\n            v[k]=num;\n            a[k].next=-1;a[k].t=t;a[k].p=p;\n        }\n        else\n        {\n            for(;;k=a[k].next)\n            {\n                if(t==a[k].t)return ;\n                if(a[k].next==-1)break;\n            }\n            a[k].next=++len;a[len].t=t;a[len].p=p;a[len].next=-1;\n        }\n    }\n    ll check(ll t)\n    {\n        ll k=t&maxn;\n        if(v[k]!=num)return -1;\n        for(;k!=-1;k=a[k].next)if(a[k].t==t)return a[k].p;\n        return -1;\n    }\n}h;\nll gcd(ll a,ll b){return b?gcd(b,a%b):a;}\nll exgcd(ll a,ll b,ll &x,ll &y)\n{\n    if(!b){x=1;y=0;return a;}\n    else\n    {\n        ll tx,ty;ll d=exgcd(b,a%b,tx,ty);\n        x=ty;y=tx-(a/b)*ty;\n        return d;\n    }\n}\nll exbsgs(ll A,ll B,ll p)\n{\n    //ll t=1%p;for(ll i=0;i<=100;i++){if(t==B)return i;t=t*A%p;}\n    ll D=1%p;ll g=0,d;ll t;\n    B%=p;if(B==1||C==1)return 0;\n    while((d=gcd(A,p))!=1)\n    {\n        if(B%d)return -1;\n        B/=d;p/=d;D=D*(A/d)%p;g++;\n        if(B==D)return g;\n    }\n    ll m=(int)sqrt(p)+1;\n    t=1%p;h.len=maxn;\n    for(int i=0;i<m;i++)\n        {h.ins(i,t);t=t*A%p;}\n    //h.ins(m,t);\n\tll am=t;\n    for(int i=0;i<=m;i++)\n    {\n        ll a=D,b=p,k=B,x,y;\n        ll d=exgcd(a,b,x,y);\n        x=((x*(k/d))%(b/d)+(b/d))%(b/d);\n        ll w=h.check(x);\n        if(w!=-1)return i*m+g+w;\n        D=D*am%p;\n    }\n    return -1;\n}\nint main()\n{\n    ll A,p,B;h.num=0;\n    while(scanf(\"%lld%lld%lld\",&A,&p,&B)!=EOF)\n    {\n    \tif(!A&&!p&&!B)break;\n        h.num++;\n        ll x=exbsgs(A,B,p);\n        if(x==-1)puts(\"No Solution\");\n        else printf(\"%lld\\n\",x);\n    }\n    return 0;\n}\n```\n\n\u7ecf\u8fc7\u6211\u4eec\u673a\u623f\u65e5\u65e5\u591c\u591c\u5730\u8f9b\u82e6\u594b\u6218\uff0c\u6210\u529f\u5c06\u4e0d\u7528$exgcd$\u7684\u65b9\u6cd5\u51fa\u7089\u5566\uff01\n\u8bbe$x-n=i*m-w$,\u5176\u4e2d$m=\\left \\lceil\\ \\sqrt{p_n}\\right\\rceil,0\\leq w\\leq m-1$\n\u5219\u539f\u95ee\u9898\u8f6c\u5316\u4e3a:\n$$a^{i*m-w}*D_n\\equiv b_n(mod~p_n)$$\n\u5373:\n$$a^{i*m}*D_n\\equiv b_n*a^w(mod~p_n)$$\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<cstdlib>\n#include<cmath>\n#define ll long long\nusing namespace std;\nconst int maxn=(1<<16)-1;\nstruct hash\n{\n    int v[maxn<<2];int num;\n    struct node\n    {\n        ll t;int p,next;\n    }a[maxn<<2];int len;\n    hash(){num=0;}\n    inline void ins(int p,ll t)\n    {\n        int k=t&maxn;\n        if(v[k]!=num)\n        {\n            v[k]=num;a[k].next=-1;a[k].p=p;a[k].t=t;\n        }\n        else \n        {\n        \tfor(;;k=a[k].next)\n        \t{\n        \t\tif(t==a[k].t){a[k].p=p;return ;}\n        \t\tif(a[k].next==-1)break;\n        \t}\n            a[k].next=++len;a[len].p=p;a[len].t=t;a[len].next=-1;\n        }\n    }\n    inline int find(ll t)\n    {\n        int k=t&maxn,p=-1;\n        if(v[k]!=num)return -1;\n        for(;k!=-1;k=a[k].next)\n            if(t==a[k].t)p=a[k].p;\n        return p;\n    }\n}h;\nll gcd(ll a,ll b){return b?gcd(b,a%b):a;}\nll exbsgs(ll A,ll B,ll p)\n{\n    ll d,D=1%p;ll g=0;B=B%p;\n    if(B==1||p==1)return 0;\n    while((d=gcd(A,p))!=1)\n    {\n        if(B%d)return -1;\n        B/=d;p/=d;D=(D*A/d)%p;\n        g++;if(B==D)return g;\n    }\n    ll t=1%p;ll m=(int)sqrt(p)+1;\n    h.len=maxn;\n    for(int i=0;i<m;i++)\n        {h.ins(i,(t*B)%p);t=t*A%p;}\n    ll am=t;\n    for(int i=0;i<=m;i++)\n    {\n        ll w=h.find(D);\n        if(w!=-1&&i*m-w>=0)return i*m-w+g;\n        D=D*am%p;\n    }\n    return -1;\n}\nint main()\n{\n    ll a,b,p;\n    while(scanf(\"%lld%lld%lld\",&a,&p,&b)!=EOF)\n    {\n        if(!a&&!b&&!p)break;h.num++;\n        ll ans=exbsgs(a,b,p);\n        if(ans!=-1)printf(\"%lld\\n\",ans);\n        else puts(\"No Solution\");\n    }\n    return 0;\n}\n```\n\n\u5176\u5b9e\u6bcf\u6b21\u52a0\u5bc6\u65f6\uff0c\u6211\u4eec\u53ea\u8981\u63d2\u5165$B*A^j$\uff0c\u67e5\u8868\u5373\u53ef",
        "postTime": 1555722886,
        "uid": 106232,
        "name": "_Sein",
        "ccfLevel": 0,
        "title": "\u81ea\u5df1\u5bf9\u4e8eexbsgs\u7684\u4e00\u4e9b\u62d9\u89c1"
    },
    {
        "content": "**\u9898\u610f**\n- \u5728\u5927\u7ea6 $O(\\sqrt n)$ \u65f6\u95f4\u6c42\u89e3\u5173\u4e8e $x$ \u7684\u65b9\u7a0b $a^x\\equiv b\\pmod n$\u3002\n- \u82e5\u6709\u89e3\u8981\u6c42\u8f93\u51fa\u6700\u5c0f\u7684\u81ea\u7136\u6570 $x$\u3002\n\n**\u5927\u6b65\u5c0f\u6b65**\n- \u6211\u4eec\u5148\u6765\u89e3\u51b3\u79bb\u6563\u5bf9\u6570\u95ee\u9898\u7684\u7b80\u5355\u5f62\u5f0f\uff1a\u5df2\u77e5 a,b \u548c\u8d28\u6570 p\uff0c\u6c42 x \u6ee1\u8db3 $a^x\\equiv b\\pmod p$\n- \u6839\u636e\u8d39\u9a6c\u5c0f\u5b9a\u7406\uff0c\u5982\u679c\u6709\u89e3\u4e00\u5b9a\u5b58\u5728 $0\\leq x<p-1$ \u7684\u53ef\u884c\u89e3\uff0c\u5f53\u7136\u6211\u4eec\u8fd8\u662f\u4e0d\u80fd\u76f4\u63a5\u679a\u4e3e\u3002\n- \u8bbe $m=\\sqrt p$ \uff0cx \u53ef\u4ee5\u53d8\u4e3a $k_1m+k_2$ \u7684\u5f62\u5f0f\uff0c\u4e14\u6709\uff1a\n$$a^{k_1m}\\equiv\\frac b {a^{k_2}}\\pmod p$$\n- \u5148\u679a\u4e3e $k_2$ \u5c06 $\\frac b {a^{k_2}}$ \u653e\u5165\u67d0\u4e2a\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\uff0c\u7136\u540e\u679a\u4e3e $k_1$ \u67e5\u8be2 $a^{k_1m}$\uff0c\u65f6\u95f4\u662f $O(\\sqrt p)$ \u6216 $O(\\sqrt p\\log p)$ \u7684\u3002\n- [\u6a21\u677f\u9898](https://www.luogu.com.cn/problem/P3846)\u3002\n- [\u4ee3\u7801\u5b9e\u73b0](https://www.luogu.com.cn/paste/yu718sqa)\u3002\n\n**\u62d3\u5c55\u5927\u6b65\u5c0f\u6b65**\n- \u518d\u62d3\u5c55\u4e00\u4e0b\u66f4\u4e00\u822c\u7684\u60c5\u51b5\uff0c\u6a21\u6570\u662f\u4e00\u4e2a\u975e\u8d28\u6570 $n$\uff0c\u627e\u5230 $x$ \u4f7f\u5f97 $a^x\\equiv b\\pmod n$\u3002\n- \u5982\u679c $a\\perp n$ \u6ca1\u4ec0\u4e48\u597d\u8bf4\u7684\uff0c\u53ef\u4ee5\u7528\u62d3\u5c55\u6b27\u51e0\u91cc\u5f97\u6c42\u9006\u5143\uff0c\u65b9\u6cd5\u8ddf\u4e4b\u524d\u4e00\u6a21\u4e00\u6837~~\u6211\u90fd\u4e0d\u597d\u610f\u601d\u8bb2~~\u3002\n- \u5426\u5219\u4ee4 $d=\\gcd(a,n)$\uff0c\u82e5 $d\\nmid b$ \u663e\u7136\u65e0\u89e3~~\u9664\u975eb=1~~\uff0c\u5426\u5219\u5c31\u6709\uff1a\n$$\\frac{a^x}d\\equiv \\frac bd\\pmod {\\frac n d}$$\n$$\\frac ad a^{x-1}\\equiv \\frac bd\\pmod {\\frac n d}$$\n$$a^{x-1}\\equiv \\frac ba\\pmod {\\frac n d}$$\n- $x$ \u82e5\u6709\u89e3\u663e\u7136 $x\\ge1$\u3002\n- \u4e0d\u8fc7\u4e00\u5b9a\u8981\u6ce8\u610f\uff0c$a$ \u4e0d\u4e00\u5b9a\u4e0e $\\dfrac nd$ \u4e92\u8d28\u554a\uff08\u6bd4\u5982 $a=2,n=2^8$\uff09\uff0c\u6240\u4ee5\u53ef\u80fd\u5f97\u53cd\u590d\u6c42 gcd \u4f7f\u5f97\u5e38\u6570\u7a0d\u5927\uff0c\u4f46\u8003\u8651\u5230\u6839\u53f7\u7ea7\u522b\u7684\u7b97\u6cd5\u590d\u6742\u5ea6\u8fd9\u4e2a\u8fd8\u662f\u5b8c\u5168\u53ef\u4ee5\u63a5\u53d7\u7684\u3002\n- [\u6a21\u677f\u9898](https://www.luogu.com.cn/problem/P4195)\u3002\n- \u8fd9\u9053\u9898\u6709\u8bb8\u591a\u7279\u5224\uff0c\u5176\u4e2d\u6709\u4e00\u4e2a\u95ee\u9898\u662f\u5927\u6b65\u5c0f\u6b65\u4f1a\u5237\u5230\u91cd\u590d\u7684\uff08\u4f46\u5176\u5b9e\u8fd9\u6837\u53cd\u800c\u7b80\u5355\uff0c\u56e0\u4e3a\u53ef\u80fd\u7684 $a^x\\bmod n$ \u4e00\u5b9a\u4e0d\u8d85\u8fc7 $\\sqrt n$ \u79cd\uff09\u3002\n- [\u4ee3\u7801\u5b9e\u73b0](https://www.luogu.com.cn/paste/xzftk7u8)\u3002",
        "postTime": 1634044981,
        "uid": 260884,
        "name": "WeLikeStudying",
        "ccfLevel": 0,
        "title": "P4195\u62d3\u5c55BSGS"
    }
]