[
    {
        "content": "\u53ef\u4ee5\u5148\u8003\u8651\u8ba1\u7b97\u4ece $(A,B,C)$ \u8d70\u5230 $(0,0,0)$ \u800c\u4e0d\u649e\u5899\u7684\u6982\u7387\uff0c\u6709\u9012\u63a8\u5173\u7cfb\uff1a\n$$f_{A,B,C}=\\frac 13 (f_{A-1,B,C}+f_{A,B-1,C}+f_{A,B,C-1})$$\n\u5efa\u7acb\u751f\u6210\u51fd\u6570\uff0c\u8bbe $f_{A,B,C}=[x^Ay^Bz^C]F$\uff0c\u5219\u6709\n$$F= \\frac 13(x+y+z)F+1$$\n\u591a\u51fa\u6765\u7684\u8fd9\u4e2a +1 \u5c31\u662f\u56e0\u4e3a\u8981\u8865\u4e0a $f_{0,0,0}=1$ \u8fd9\u4e00\u9879\u3002\n$$F = \\frac{1}{1-(x+y+z)/3}=\\sum_{i=0}^\\infty \\frac{1}{3^i}(x+y+z)^i$$\n\u63d0\u53d6\u7cfb\u6570\u5373\u5f97\n$$f_{A,B,C}= \\frac{1}{3^{A+B+C}}\\binom{A+B+C}{A,B,C}$$\n\u90a3\u4e48\u8ba1\u7b97\u4ece $(A,B,C)$ \u8d70\u5230 $(i,j,k)$ \u800c\u4e0d\u649e\u5899\u6982\u7387\u5c31\u5bb9\u6613\u8ba1\u7b97\u4e86\u3002\u5176\u9012\u63a8\u5f0f\u4e0e $f$ \u5f88\u50cf\uff0c\u518d\u7a0d\u52a0\u5206\u6790\u5c31\u53ef\u4ee5\u53d1\u73b0\u6240\u6c42\u662f $f_{A-i,B-j,C-k}$\u3002\n\n\u73b0\u5728\u53ea\u9700\u8981\u679a\u4e3e\u5899\u8fb9\u7684\u4f4d\u7f6e\uff0c\u6839\u636e\u8d70\u5230\u90a3\u649e\u5230\u5899\u7684\u6982\u7387\uff0c\u5c31\u53ef\u4ee5\u5c06\u7b54\u6848\u8868\u793a\u4e3a\uff1a\n$$g(A,B,C)+g(A,C,B)+g(B,C,A)$$\n$$g(d_1,d_2,d_3)=\\frac 13\\sum_{i=0}^{d_1}\\sum_{j=0}^{d_2} \\binom{i+j+d_3}{i,j,d_3}\\frac{(d_1+d_2-i-j)^k}{3^{i+j+d_3}}$$\n\u4f60\u4f1a\u53d1\u73b0\u6709\u4e9b\u4f4d\u7f6e\u53ef\u80fd\u88ab\u91cd\u590d\u8ba1\u7b97\u4e86\uff0c\u4f46\u6ca1\u5173\u7cfb\u3002\u88ab\u8ba1\u4e86\u4e24\u6b21\u7684\u4f4d\u7f6e\uff0c\u90fd\u662f\u6709\u4e24\u4e2a\u65b9\u5411\u9762\u5bf9\u5899\u7684\u4f4d\u7f6e\u3002  \n\n\u8fd9\u91cc\u5c31\u8bf4 $g(A,B,C)$ \u7684\u8ba1\u7b97\u65b9\u6cd5\uff0c\u5269\u4e0b\u7684\u4e24\u90e8\u5206\u4e5f\u662f\u4e00\u6837\u7684\u3002\u53ef\u4ee5\u53d1\u73b0 $i+j$ \u5728\u548c\u5f0f\u4e2d\u9891\u7e41\u51fa\u73b0\uff0c\u8003\u8651\u6362\u5143\u679a\u4e3e $t=i+j$\uff1a\n\n$$3g(A,B,C)=\\frac{1}{3^C}\\sum_{t=0}^{A+B} \\frac{(A+B-t)^k}{3^t}\\sum_{j=t-A}^B \\binom{t+C}{t-j,j,C}$$  \n\u540e\u9762\u90a3\u4e2a\u548c\u5f0f\u53ef\u4ee5\u5355\u72ec\u8ba1\u7b97\uff0c\u5148\u5316\u7b80\u4e3a\n$$\\binom{t+C}{C} \\sum_{j=t-A}^B \\binom{t}{j}$$\n\n\n\u8fd9\u79cd\u8d85\u51e0\u4f55\u5f0f\u663e\u7136\u53ef\u4ee5\u6574\u5f0f\u9012\u63a8\u8ba1\u7b97\uff0c\u5229\u7528\u4e8c\u9879\u5f0f\u7cfb\u6570\u7684\u9012\u63a8\u516c\u5f0f\uff1a\n$$D_n=\\sum_{i=n-A}^B \\binom ni = \\sum_{i=n-A}^B \\binom{n-1}{i}+\\binom{n-1}{i-1}$$\n$$ D_n=2D_{n-1} -\\binom{n-1}{A}- \\binom{n-1}{B} $$\n\u53ef\u4ee5\u5728\u7ebf\u6027\u65f6\u95f4\u5185\u9012\u63a8\u8ba1\u7b97\uff0c\u6700\u540e\u7528\u7ebf\u6027\u7b5b\u6765\u6c42 $t^k$ \u5373\u53ef\u3002\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<algorithm>\n#include<cstring>\n#include<cmath>\n#define N 10000003\n#define ll long long\n#define p 998244353\nusing namespace std;\n\ninline int power(int a,int t){\n    int res = 1;\n    while(t){\n        if(t&1) res = (ll)res*a%p;\n        a = (ll)a*a%p;\n        t >>= 1;\n    }\n    return res;\n}\n\nconst int inv3 = 332748118;\nint fac[N],ifac[N],pw[N],pr[N>>3],inv[N];\nint cnt;\n\nvoid init(int n,int k){\n    inv[1] = pw[1] = fac[0] = fac[1] = ifac[0] = ifac[1] = 1;\n    for(int i=2;i<=n;++i) fac[i] = (ll)fac[i-1]*i%p;\n    ifac[n] = power(fac[n],p-2);\n    for(int i=n-1;i;--i) ifac[i] = (ll)ifac[i+1]*(i+1)%p;\n    for(int i=2;i<=n;++i){\n        inv[i] = (ll)fac[i-1]*ifac[i]%p;\n        if(!pw[i]){\n            pr[++cnt] = i;\n            pw[i] = power(i,k);\n        }\n        for(int j=1;j<=cnt&&i*pr[j]<=n;++j){\n            pw[i*pr[j]] = (ll)pw[i]*pw[pr[j]]%p;\n            if(i%pr[j]==0) break;\n        }\n    }\n}\n\nint g(int A,int B,int C,int k){\n    if(A>B) swap(A,B);\n    ll res = 0;\n    int bc = 1,f = 1,ifa = ifac[A],ifb = ifac[B],ipw3 = 1;\n    for(int i=0;i<=A+B;++i){\n        res += (ll)pw[A+B-i]*f%p*ipw3%p*bc%p;\n        ipw3 = ipw3*332748118ll%p;\n        bc = (ll)bc*(i+C+1)%p*inv[i+1]%p;\n        if(i<A) f = (f<<1)>=p?(f<<1)-p:f<<1;\n        else if(i<B) f = ((f<<1)-(ll)fac[i]*ifa%p*ifac[i-A])%p;\n        else f = ((f<<1)-((ll)ifa*ifac[i-A]+(ll)ifb*ifac[i-B])%p*fac[i])%p;\n    }\n    return res%p*power(3,p-C-1)%p;\n}\n\nint A,B,C,k;\n\nint main(){\n    scanf(\"%d%d%d%d\",&A,&B,&C,&k);\n    init(A+B+C-min(min(A,B),C),k);\n    int ans = (ll)((g(A,B,C,k)+g(A,C,B,k))%p+g(B,C,A,k))*inv3%p;\n    printf(\"%d\",(ans+p)%p);\n    return 0;  \n}\n```",
        "postTime": 1664788266,
        "uid": 115864,
        "name": "NaCly_Fish",
        "ccfLevel": 6,
        "title": "P8558 \u9ed1\u6697\uff08Darkness\uff09"
    },
    {
        "content": "\u8003\u8651 $(A,B,C)$ \u8d70\u5230 $(x,y,z)$ \u800c\u4e0d\u649e\u5899\u7684\u6982\u7387\u3002\n\n\u8d70 $A+B+C-x-y-z$ \u6b65\u5171\u6709 $3^{A+B+C-x-y-z}$ \u79cd\u65b9\u6848\uff0c\u800c\u5230\u8fbe $(x,y,z)$ \u7684\u65b9\u6848\u6570\u4e3a $\\begin{pmatrix}A+B+C-x-y-z\\\\ A-x, B-y,C-z\\end{pmatrix}$\u3002\n\n\u6240\u4ee5\u6982\u7387\u5c31\u662f $\\frac{\\begin{pmatrix}A+B+C-x-y-z\\\\ A-x,B-y,C-z\\end{pmatrix}}{3^{A+B+C-x-y-z}}$\u3002\n\n\u6839\u636e\u671f\u671b\u7684\u7ebf\u6027\u6027\u8d28\uff0c\u6211\u4eec\u53ef\u4ee5\u5206\u5f00\u8ba1\u7b97\u649e\u5230\u6bcf\u9762\u5899\u7684\u671f\u671b\u3002\n\n\u4ee5\u5899 $z=0$ \u4e3a\u4f8b\uff1a\n\n$$\n\\begin{aligned}F_z&=\\frac{1}{3}\\sum_{x=0}^A \\sum_{y=0}^B \\frac{\\begin{pmatrix}A+B+C-x-y\\\\ A-x,  B-y, C\\end{pmatrix}(x+y)^k}{3^{A+B+C-x-y}}\\\\\n&=\\frac{1}{3}\\sum_{t=0}^{A+B}\\frac{t^k}{3^{A+B+C-t}}\\sum_{x=\\max(0,t-B)}^{\\min(A,t)}\\begin{pmatrix}A+B+C-t\\\\ A-x,B-t+x,C\\end{pmatrix} \\\\\n&=\\frac{1}{3}\\sum_{t=0}^{A+B}\\frac{t^k}{3^{A+B+C-t}}\\binom{A+B+C-t}{C}\\sum_{x=\\max(0,t-B)}^{\\min(A,t)}\\binom{A+B-t}{A-x}\\end{aligned}\n$$\n\n\u8003\u8651 $f(t)=\\sum_{x=\\max(0,t-B)}^{\\min(A,t)}\\binom{A+B-t}{A-x}$ \u600e\u4e48\u7b97\u3002\u5c06\u7ec4\u5408\u6570\u5c55\u5f00\uff1a\n\n$$\n\\begin{aligned}f(t)&=\\sum_{x=\\max(0,t-B)}^{\\min(A,t)}\\binom{A+B-t-1}{A-x}+\\sum_{x=\\max(0,t-B)}^{\\min(A,t)}\\binom{A+B-t-1}{A-x-1}\n\\end{aligned}\n$$\n\n\u800c \n$$f(t+1)=\\sum_{x=\\max(0,t+1-B)}^{\\min(A,t+1)}\\binom{A+B-t-1}{A-x}$$\n\n\u4ee3\u5165\u6bd4\u8f83\u53ef\u5f97\n\n$$f(t)=2f(t+1)-\\binom{A+B-t-1}{A}-\\binom{A+B-t-1}{B}$$\n\n\u4e0d\u96be\u9012\u63a8\u8ba1\u7b97\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u53ef\u4ee5\u505a\u5230 $O(A+B+C)$\u3002",
        "postTime": 1671759392,
        "uid": 362346,
        "name": "TianyiLemon",
        "ccfLevel": 0,
        "title": "[NaCly_Fish] \u9ed1\u6697"
    }
]