[
    {
        "content": "## \u9898\u610f\n\n\u7ed9\u5b9a $ n $ \u4e2a\u70b9\uff0c\u4ece $ 1 $ \u8d70\u5230 $ n $ \uff1b\u5176\u4e2d\u6709 $ m $ \u6761\u8def\u5f84\uff0c\u7b2c $ i $ \u6761\u8def\u5f84\u4ece $ x_i $ \u5230 $ y_i $ \uff0c\u65f6\u95f4\u4ece $ p_i $ \u5230 $ q_i $ \uff0c\u6bcf\u6b21\u7b49\u8f66 $ t $ \u7684\u65f6\u95f4\u4f1a\u589e\u52a0 $ A*t^2+B*t+C $ \u7684\u82b1\u8d39\uff0c\u6700\u540e\u82b1\u8d39\u52a0\u4e0a\u4e00\u4e2a\u5230\u8fbe\u65f6\u95f4\u3002\u4f7f\u82b1\u8d39\u6700\u5c0f\u3002\n\n## Solution\n\n\u4e00\u5f00\u59cb\u6211\u60f3\u4ee5\u5f53\u524d\u6240\u5728\u5730\u70b9\u4e3a\u72b6\u6001\u6765 $ DP $\uff0c\u4f46\u662f\u8fd9\u6837\u5c31\u9700\u8981\u518d\u8bb0\u4e00\u7ef4\u65f6\u95f4\uff0c\u590d\u6742\u5ea6\u7206\u8868\u3002\u4e8e\u662f\u6211\u4eec\u628a\u8fd9\u4e9b\u8def\u5f84\u4f5c\u4e3a\u72b6\u6001\u8fdb\u884c\u8f6c\u79fb\uff0c\u5c31\u80fd\u591f\u540c\u65f6\u8bb0\u4e0b\u5730\u70b9\u548c\u65f6\u95f4\u4e86\u3002\n\n\u90a3\u4e48\u8bbe $ dp[i] $ \u4e3a\u8d70 $ i $ \u8def\u5f84\u524d\u7684\u603b\u82b1\u8d39\uff0c\u5957\u8def\u5730\u8fdb\u884c $ DP $ \u8f6c\u79fb\u65b9\u7a0b\u7684\u659c\u7387\u4f18\u5316\uff1a\n\n$ dp[i]=dp[j]+A\\times(p_i-q_j)^2+B\\times(p_i-q_j)+C $\n\n$ dp[i]=dp[j]+Ap_i^2+Aq_j^2-2Ap_iq_j+Bp_i-Bq_j+C $ \n\n$ dp[j]+Aq_j^2-Bq_j=2Ap_iq_j+dp[i]-Ap_i^2-Bp_i-C $\n\n\u81f3\u6b64\u6211\u4eec\u4ee5\n\n$ y=dp[j]+Aq_j^2-Bq_j,k=2Ap_i,x=q_j,b=dp[i]-Ap_i^2-Bp_i^2-C $ \n\n\u628a $ m $ \u6761\u8def\u5f84\u6309\u7167 $ p $ \u4ece\u5c0f\u5230\u5927\u5904\u7406\uff0c$ k $\u5355\u8c03\u4e0d\u51cf\uff0c\u5373\u53ef\u8fdb\u884c\u659c\u7387\u4f18\u5316 $ DP $ \n\n\u4f46\u662f\u6211\u4eec\u8fd8\u6709\u4e24\u4e2a\u9650\u5236\uff0c\u4e00\u4e2a\u662f $ y_j=x_i $ \uff0c\u53e6\u4e00\u4e2a\u662f $ q_j\\le p_i $\n\n\u7b2c\u4e00\u4e2a\u597d\u529e\uff0c\u6211\u4eec\u5f00 $ n $ \u4e2a \u5355\u8c03\u961f\u5217\uff0c$ i $ \u8fdb\u961f\u65f6\u5c31\u4e22\u8fdb\u7b2c $ y_i $ \u4e2a\u5355\u8c03\u961f\u5217\u91cc\uff0c\u6c42 $ dp[i] $ \u65f6\u5c31\u4ece\u7b2c $ x_i $ \u4e2a\u5355\u8c03\u961f\u5217\u91cc\u8c03\u5c31\u5b8c\u4e86\u3002\n\n\u7b2c\u4e8c\u4e2a\u5219\u9700\u8981\u6211\u4eec\u7b97\u51fa $ dp[i] $ \u540e\u4e0d\u5c06\u5b83\u9a6c\u4e0a\u63d2\u5230\u5bf9\u5e94\u7684\u5355\u8c03\u961f\u5217\u91cc\uff0c\u800c\u662f\u6309\u7167 $ q $ \u628a\u5b83\u4e22\u5230\u6876\u91cc\u3002\u5bf9\u6bcf\u4e2a $ d $ \u7b97\u6240\u6709 $ p_i=d $ \u7684 $ dp[i] $ \u4e4b\u524d\uff0c\u5c31\u628a\u6240\u6709 $ q_j=d $ \u7684 $ j $ \u63d2\u5165\u5bf9\u5e94\u5355\u8c03\u961f\u5217\u3002\n\n\u8fd9\u6837\u4e3a\u4ec0\u4e48\u53ef\u884c\u5462\uff1f\u5728\u7b97 $ dp[i] $ \u65f6\uff0c\u6876\u91cc\u6240\u6709 $ q_j\\le p_i $ \u90fd\u4f1a\u8fdb\u5165\u5355\u8c03\u961f\u5217\u4e2d\u3002\u800c\u6240\u6709 $ q_j\\le p_i $ \u7684 $ j $ \u5fc5\u7136 $ p_j<p_i $ \uff0c\u5b83\u4eec\u4e00\u5b9a\u5728\u4e4b\u524d\u5c31\u4f1a\u8fdb\u5165\u6876\u4e2d\u3002\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u8bc1\u660e\u4e86\u6211\u4eec\u4e0d\u4f1a\u6f0f\u6389\u4efb\u4f55\u53ef\u80fd\u7684\u8f6c\u79fb\u3002\n\n\u6211\u770b\u5230\u4e0a\u9762\u7684\u9898\u89e3\u5927\u591a\u90fd\u4f7f\u7528\u4e86\u5806\uff0c\u5e26\u4e0a\u4e86\u4e00\u4e2a $ log $ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002\u4f46\u5b9e\u9645\u4e0a\u6b64\u9898\u6570\u636e\u8303\u56f4\u4e0d\u5927\uff0c\u7528\u6876\u6392\u66f4\u7b80\u6d01\uff0c\u4e5f\u66f4\u5feb\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define double long double\nusing namespace std;\nconst int M=1e6+10,inf=1e18,eps=1e-9;\nint st[M],nd[M],p[M],q[M],x[M],y[M],h[M],t[M],dp[M];\nvector<int>pos[M],ins[M],Q[M];\nvoid read(int &x){\n\tint f=1;x=0;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\tx*=f;\n}\nint pf(int x){return x*x;}\ndouble slope(int i,int j){\n\tint xx=x[j]-x[i],yy=y[j]-y[i];\n\tif(!xx){\n\t\tif(yy>0)return inf;\n\t\treturn -inf;\n\t}\n\treturn yy*1./xx;\n}\nsigned main(){\n\tint n,m,A,B,C,T=0,ans=inf;\n\tread(n),read(m),read(A),read(B),read(C);\n\tfor(int i=1;i<=m;i++){\n\t\tread(st[i]),read(nd[i]),read(p[i]),read(q[i]);\n\t\tT=max(T,q[i]),pos[p[i]].push_back(i);\n\t}\n\tfor(int i=1;i<=n;i++)h[i]=0,t[i]=-1;\n\tfor(int pi=0;pi<=T;pi++){\n\t\tfor(int id=0;id<ins[pi].size();id++){\n\t\t\tint i=ins[pi][id],pp=nd[i];\n\t\t\twhile(h[pp]<t[pp]&&slope(Q[pp][t[pp]-1],Q[pp][t[pp]])>=slope(Q[pp][t[pp]-1],i))t[pp]--;\n\t\t\t++t[pp];\n\t\t\tif(t[pp]>=Q[pp].size())Q[pp].push_back(i);\n\t\t\telse Q[pp][t[pp]]=i;\n\t\t}\n\t\tfor(int id=0;id<pos[pi].size();id++){\n\t\t\tint i=pos[pi][id],pp=st[i];double k=2.*A*pi;\n\t\t\twhile(h[pp]<t[pp]&&slope(Q[pp][h[pp]],Q[pp][h[pp]+1])<k)h[pp]++;\n\t\t\tif(h[pp]>t[pp]&&st[i]!=1)continue;\n\t\t\tint j;\n\t\t\tif(st[i]==1&&h[pp]>t[pp])j=0;\n\t\t\telse j=Q[pp][h[pp]];\n\t\t\tdp[i]=dp[j]+A*pf(p[i]-q[j])+B*(p[i]-q[j])+C;\n\t\t\tx[i]=q[i],y[i]=dp[i]+A*pf(q[i])-B*q[i];\n\t\t\tins[q[i]].push_back(i);\n\t\t\tif(nd[i]==n)ans=min(ans,dp[i]+q[i]);\n\t\t}\n\t}\n\tcout<<ans<<endl;\n\treturn 0;\n}",
        "postTime": 1597324147,
        "uid": 35117,
        "name": "Mentos_Cola",
        "ccfLevel": 7,
        "title": "P6302 \u56de\u5bb6\u8def\u7ebf"
    },
    {
        "content": "[P5468 [NOI2019] \u56de\u5bb6\u8def\u7ebf](https://www.luogu.com.cn/problem/P5468)\n\n[P6302 [NOI2019] \u56de\u5bb6\u8def\u7ebf \u52a0\u5f3a\u7248](https://www.luogu.com.cn/problem/P6302)\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/EricQian/p/15132345.html)\n\n### \u9898\u610f\n\n\u7ed9\u5b9a $n$ \u4e2a\u70b9\uff0c\u4ece $1$ \u8d70\u5230 $n$\u3002\u5176\u4e2d\u6709 $m$ \u6761\u56fa\u5b9a\u65f6\u95f4\u7684\u8def\u5f84\uff0c\u7b2c $i$ \u6761\u8def\u5f84\u4ece $u_i$ \u5230 $v_i$\uff0c\u5728 $st_i$ \u65f6\u523b\u51fa\u53d1\uff0c\u5728 $ed_i$ \u65f6\u523b\u5230\u8fbe\u3002\u6bcf\u6b21\u7b49\u8f66 $t$ \u7684\u65f6\u95f4\u4f1a\u589e\u52a0 $A\\times t^2+B\\times t+C$ \u7684\u82b1\u8d39\uff0c\u6700\u540e\u82b1\u8d39\u52a0\u4e0a\u4e00\u4e2a\u5230\u8fbe\u65f6\u95f4\u3002\u4f7f\u82b1\u8d39\u6700\u5c0f\u3002\n\n$n\\le 10^5;m\\le 10^6;p_i,q_i\\le 10^3$\n\n### \u9898\u89e3\n\n\u9996\u5148\u53ef\u4ee5\u60f3\u5230\u4e00\u4e2a $O(Tm)$ \u7684\u66b4\u529b dp\uff1a\u8bbe $dp_{i,s}$ \u8868\u793a\u5728\u7b2c $s$ \u79d2\u5230\u8fbe\u7b2c $i$ \u4e2a\u70b9\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u53ef\u4ee5\u679a\u4e3e\u6bcf\u4e00\u6761\u8fb9\u8f6c\u79fb\u3002\n\n[$\\texttt{code}$](https://www.luogu.com.cn/paste/69zbjp28)\n\n\u53d1\u73b0\u5982\u679c\u540c\u65f6\u8bb0\u5f55\u5730\u70b9\u4e0e\u65f6\u95f4\u5355\u8bf4\u7a7a\u95f4\u590d\u6742\u5ea6\u5c31\u7206\u70b8\uff0c\u8003\u8651\u66f4\u6539\u72b6\u6001\u3002\n\n\u4e00\u4e2a\u9ad8\u5999\u7684\u60f3\u6cd5\u662f\uff1a\u4ee5\u4e00\u6761\u6761\u822a\u73ed\u7684\u7f16\u53f7\u4e3a\u72b6\u6001\uff0c$dp_i$ \u8868\u793a\u5728\u7ecf\u8fc7\u7b2c $i$ \u6761\u822a\u7ebf\u5e76\u5230\u8fbe $ed_i$ \u65f6\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u8fd9\u6837\u7528\u4e00\u7ef4\u53d8\u91cf\u540c\u65f6\u6982\u62ec\u4e86\u5730\u70b9\u4e0e\u65f6\u95f4\u4e24\u4e2a\u4fe1\u606f\u3002\n\n\u53ef\u4ee5\u5217\u51fa\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$dp_i=\\min_{v_j=u_i}\\{dp_j+A\\times (st_i-ed_j)^2+B\\times (st_i-ed_j)+C+(ed_i-st_i)+(st_i-ed_j)\\}(ed_j\\le st_i)$$\n\n\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a\u5173\u4e8e $i$ \u4e0e $j$ \u7684\u8f6c\u79fb\u65b9\u7a0b\uff0c\u53ef\u4ee5\u659c\u7387\u4f18\u5316\uff08\u53bb\u6389 $\\min$ \u540e\u79fb\u9879\uff09\uff1a\n\n$$[dp_j+A\\times (ed_j)^2-B\\times ed_j-ed_j]=[2A\\times st_i]\\times [ed_j]+[dp_i\u2212A\\times(st_i)^2-B\\times st_i-C-ed_i]$$\n\n$$[y]=[k]\\times [x]+[b]$$\n\n\u5173\u4e8e\u6309\u7167 $st_i$ \u5347\u5e8f\u6392\u5e8f\uff08\u8ba9 $[k]$ \u9012\u589e\uff09\u8fd8\u662f\u6309\u7167 $ed_i$ \u6392\u5e8f\uff08\u8ba9 $[x]$ \u9012\u589e\uff09\uff0c\u6211\u81ea\u5df1\u5728\u7b2c\u4e00\u6b21\u505a\u7684\u65f6\u5019\u6ca1\u6709\u60f3\u6e05\u695a\uff0c\u5bfc\u81f4\u4e86\u957f\u65f6\u95f4\u7684\u5361\u987f\uff0c\u4e0b\u9762\u89e3\u91ca\u4e00\u4e0b $ed_i$ \u6392\u5e8f\u7684\u9519\u8bef\u4e4b\u5904\uff1a\n\n\u5728\u6309\u7167 $ed_i$ \u6392\u5e8f\u4e4b\u540e\uff0c\u6211\u4e3a\u4e86\u6ee1\u8db3 $ed_j\\le st_i$ \u7684\u9650\u5236\uff0c\u5728\u5355\u8c03\u961f\u5217\u4e0a\u4e8c\u5206\u51fa\u4e86 $ed_j\\le st_i$ \u7684\u6700\u53f3\u7aef\uff08\u8bb0\u4e3a $pos$\uff09\uff0c\u5e76\u5728 $[L,pos]$ \u4e2d\u518d\u4e00\u6b21\u4e8c\u5206\u6c42\u51fa\u6700\u4f73\u51b3\u7b56\u70b9\u3002\n\n\u4f46\u6700\u5173\u952e\u7684\u662f\uff0c\u5355\u8c03\u961f\u5217\u4e2d\u7684\u6240\u6709\u51b3\u7b56\u70b9\u90fd\u662f\u7ecf\u8fc7\u7b5b\u9009\u7684\u3002\u5047\u8bbe\u5b58\u5728\u51b3\u7b56\u70b9 $j(ed_j\\le st_i)$\uff0c\u5bf9\u4e8e $st_i$ \u6765\u8bf4\u662f\u66f4\u4f18\uff0c\u5374\u5728\u52a0\u5165\u53e6\u4e00\u4e2a\u51b3\u7b56\u70b9\u65f6\u88ab\u820d\u53bb\u4e86\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/6o7yfsi4.png)\n\n\u6bd4\u5982\u4e0a\u9762\u7684\u56fe\uff0c\u4f1a\u9009\u62e9 $p$ \u4f5c\u4e3a\u51b3\u7b56\uff0c$j$ \u4f1a\u88ab\u820d\u53bb\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\u6ce8\u610f\u70b9\u5c31\u662f\uff1a\u5728\u52a0\u5165\u51b3\u7b56\u7684\u65f6\u5019\uff0c\u4e0d\u80fd\u6bcf\u6b21\u76f4\u63a5\u5c06 $i$ \u52a0\u5165\u961f\u5217\u4e2d\uff0c\u800c\u662f\u53ef\u4ee5\u5c06\u5b83\u52a0\u5165\u4e00\u4e2a\u5806\u4e2d\u3002\u6bcf\u6b21\u9700\u8981\u8ba1\u7b97\u65f6\u518d\u5c06\u5806\u4e2d\u7684\u51b3\u7b56\u70b9\u653e\u5230\u5355\u8c03\u961f\u5217\u4e2d\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(m\\log m)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n// Author:A weak man named EricQian\n#include<bits/stdc++.h>\nusing namespace std;\n#define infll 0x3f3f3f3f3f3f3f3f\n#define inf 0x3f3f3f3f\n#define Maxm 1000005\n#define pa pair<int,int>\n#define fi first\n#define se second\ntypedef long long ll;\ninline int rd()\n{\n\t int x=0;\n\t char ch,t=0;\n\t while(!isdigit(ch = getchar())) t|=ch=='-';\n\t while(isdigit(ch)) x=x*10+(ch^48),ch=getchar();\n\t return x=t?-x:x;\n}\ninline ll maxll(ll x,ll y){ return x>y?x:y; }\ninline ll minll(ll x,ll y){ return x<y?x:y; }\ninline ll absll(ll x){ return x>0ll?x:-x; }\ninline ll gcd(ll x,ll y){ return (y==0)?x:gcd(y,x%y); }\nint n,m;\nll ans=infll,A,B,C,dp[Maxm],x[Maxm],y[Maxm],k[Maxm];\nstruct Way { int u,v; ll st,ed; }r[Maxm];\nbool cmp(Way x,Way y){ return x.st<y.st; }\ninline ll calc(int x) { return x*x*A+x*B+C; }\nstruct Destination\n{\n\t int nl=0; // \u7531\u4e8e vector \u4e0d\u652f\u6301 pop_front \u64cd\u4f5c\uff0c\u6211\u7528\u4e00\u4e2a\u6307\u9488\u6765\u8868\u793a\u8d77\u59cb\u4f4d\u7f6e\n\t vector<int> q;\n\t priority_queue<pa> qpre;\n\t inline void Insert(int i,ll X,ll Y)\n\t {\n\t \t int nr;\n\t \t while((nr=q.size())-nl>=2 && (Y-y[q[nr-1]])*(x[q[nr-1]]-x[q[nr-2]])\n\t\t  \t   <=(y[q[nr-1]]-y[q[nr-2]])*(X-x[q[nr-1]])) q.pop_back(); // \u961f\u5c3e\u8e22\u51fa\u51f9\u51f8\u6027\u9519\u8bef\u7684\u5143\u7d20\n\t \t q.push_back(i);\n\t }\n\t inline void Delete(int S,ll K)\n\t {\n\t \t int tmp;\n\t \t while(!qpre.empty() && -qpre.top().fi<=S) // \u5c06\u5806\u4e2d\u5143\u7d20\u52a0\u5165\u5355\u8c03\u961f\u5217\u4e2d\n\t\t  \t tmp=(int)qpre.top().se,Insert(tmp,x[tmp],y[tmp]),qpre.pop();\n\t\t while(q.size()-nl>=2 && (y[q[nl+1]]-y[q[nl]])<=\n\t\t \t K*(x[q[nl+1]]-x[q[nl]])) nl++; // \u961f\u9996\u8e22\u51fa\u51b3\u7b56\u8f83\u52a3\u7684\u5143\u7d20\n\t }\n}pos[Maxm];\nint main()\n{\n\t n=rd(),m=rd(),A=rd(),B=rd(),C=rd();\n\t for(int i=1;i<=m;i++) r[i]=(Way){rd(),rd(),rd(),rd()};\n\t sort(r+1,r+m+1,cmp),pos[1].q.push_back(0);\n\t memset(dp,0x3f,sizeof(dp)),dp[0]=0;\n\t for(int i=1,U,V,tmp;i<=m;i++)\n\t {\n\t \t x[i]=r[i].ed,k[i]=2ll*A*r[i].st,U=r[i].u,V=r[i].v;\n\t\t pos[U].Delete(r[i].st,k[i]);\n\t\t if((int)pos[U].q.size()<=pos[U].nl) continue; // \u6ca1\u6709\u51b3\u7b56\u70b9\n\t\t tmp=pos[U].q[pos[U].nl];\n\t\t dp[i]=dp[tmp]+calc(r[i].st-r[tmp].ed)+r[i].ed-r[tmp].ed;\n\t \t y[i]=dp[i]+A*r[i].ed*r[i].ed-B*r[i].ed-r[i].ed;\n\t \t pos[V].qpre.push(pa(-r[i].ed,i));\n\t }\n\t for(int i=1;i<=m;i++) if(r[i].v==n) ans=minll(ans,dp[i]);\n\t printf(\"%lld\\n\",ans);\n\t return 0;\n}\n```",
        "postTime": 1642831366,
        "uid": 113073,
        "name": "EricQian",
        "ccfLevel": 7,
        "title": "[NOI2019] \u56de\u5bb6\u8def\u7ebf \u9898\u89e3"
    },
    {
        "content": "## P5468 [NOI2019] \u56de\u5bb6\u8def\u7ebf\n\n\u659c\u7387\u4f18\u5316\u5165\u95e8\uff08\u6307\u6211\u5199\u7684\u4e1c\u897f\u800c\u4e0d\u662f\u8fd9\u9053\u9898\uff09\n\n### \u9898\u610f\n\n$n$ \u4e2a\u8282\u70b9\uff0c\u6709 $m$ \u8d9f\u5217\u8f66\uff0c\u8f66 $i$ \u4ece $p_i$ \u65f6\u523b\u81f3 $q_i$ \u65f6\u523b\u4ece $x_i$ \u5730\u5230 $y_i$ \u5730\u3002\u732b\u732b\u9700\u8981\u53ea\u5750\u5217\u8f66\u4ece $1$ \u8282\u70b9\u5230\u8fbe $n$ \u8282\u70b9\u3002\n\n\u8bbe\u732b\u732b\u5728\u4e00\u4e2a\u5730\u65b9\u7b49\u5f85\u7684\u65f6\u95f4\u4e3a $t$\uff0c\u90a3\u4e48\u4ee3\u4ef7\u4e3a $At^2+Bt+C$\uff0c\u5176\u4e2d $A\\ B\\ C$ \u4e3a\u7ed9\u5b9a\u975e\u8d1f\u5e38\u6570\uff0c\u603b\u4ee3\u4ef7\u4e3a\u6240\u6709\u4ee3\u4ef7\u603b\u548c\u4e0e\u5230\u8fbe\u65f6\u95f4\u7684\u548c\u3002\u6c42\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n### \u601d\u8def\n\n\u8bbe $f_i$ \u4e3a\u8d70 $i$ \u8d9f\u5217\u8f66\u524d\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u6709\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$\nf_i=\\min_{y_j=x_i\\land q_j\\leq q_i}(f_j+A(p_i-q_j)^2+B(p_i-q_j)+C)\n$$\n\u6700\u7ec8\u4ee3\u4ef7\u5373\u4e3a\uff1a\n$$\n\\min f_i+q_i\n$$\n\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u65b9\u7a0b\uff0c\u4e0d\u8003\u8651\u5176\u4ed6\u9650\u5236\uff0c\u5373\u4e3a\u627e\u5230\u6700\u4f18\u7684 $j$ \u66f4\u65b0 $i$\uff0c\u6709\uff1a\n$$\n\\begin{aligned}\nf_i&=f_j+A(p_i-q_j)^2+B(p_i-q_j)+C\\\\\nf_i&=f_j+Ap_i^2+Aq_j^2-2Ap_iq_j+Bp_i-Bq_j+C\\\\\nf_j+Aq_j^2-Bq_j&=2Ap_iq_j+f_i-Ap_i^2-Bp_i-C\n\\end{aligned}\n$$\n\u5bf9\u4e8e\u5df2\u7ecf\u66f4\u65b0\u8fc7\u7684 $j$\uff0c$f_j+Aq_j^2-Bq_j$ \u662f\u5df2\u77e5\u7684\u3002\u540e\u534a\u90e8\u5206 $f_i-Ap_i^2-Bp_i-C$ \u53ea\u6709 $f_i$ \u662f\u672a\u77e5\u7684\uff0c\u4e5f\u662f\u6211\u4eec\u8981\u6700\u4f18\u5316\u7684\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5c06\u4e0a\u5f0f\u770b\u505a $y=kx+b$ \u7684\u5f62\u5f0f\uff0c\u5176\u4e2d\n$$\n\\begin{aligned}\n&y=f_j+Aq_j^2-Bq_j\\\\\n &x=q_j\\\\\n &k=2Ap_i\\\\\n &b=f_i-Ap_i^2-Bp_i-C\n \\end{aligned}\n$$\n\uff08\u5e38\u6570\u5176\u5b9e\u53ef\u4ee5\u5c5e\u4e8e\u4efb\u610f\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u4e0a\u8ff0\u53ea\u662f\u4e3e\u4f8b\uff09\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5c06\u6240\u6709\u53ef\u4ee5\u8f6c\u79fb\u5230\u7684 $j$ \u770b\u505a\u4e00\u4e2a\u4e8c\u7ef4\u5e73\u9762\u4e0a\u7684\u70b9\uff0c\u6bcf\u6b21\u66f4\u65b0 $f_i$ \u5b9e\u9645\u662f\u5bf9\u4e00\u4e2a\u659c\u7387\u627e\u51fa\u7ecf\u8fc7\u5176\u4e2d\u4e00\u4e2a\u70b9\u5f97\u5230\u7684\u6700\u4f18\u7684 $b$\u3002\u90a3\u4e48\u663e\u7136\u53ea\u4f1a\u9009\u5230\u524d\u8005\u6784\u6210\u7684\u51f8\u5305\u4e0a\u7684\u70b9\u3002\u5f88\u591a\u9898\u67e5\u8be2\u7684\u659c\u7387\u90fd\u662f\u5355\u8c03\u7684\uff0c\u800c\u4e14\u4e4b\u540e\u5728\u51f8\u5305\u540e\u65b9\u63d2\u5165\u65b0\u7684\u70b9\uff0c\u4e8e\u662f\u7ef4\u62a4\u51f8\u5305\u7684\u6570\u7ec4\u5c31\u53d8\u6210\u4e86\u5355\u8c03\u961f\u5217\u3002\u5426\u5219\u7684\u8bdd\uff0c\u5c31\u662f\u52a8\u6001\u7ef4\u62a4\u51f8\u5305\u5e76\u5728\u51f8\u5305\u4e0a\u4e8c\u5206\u3002\n\n\u5bf9\u4e8e\u8fd9\u9053\u9898\uff0c\u6700\u4f18\u6307\u6700\u5c0f\uff0c\u90a3\u4e48\u6211\u4eec\u7ef4\u62a4\u7684\u662f\u4e0b\u51f8\u5305\u3002\n\n\u659c\u7387\u4f18\u5316\u7684\u90e8\u5206\u5df2\u7ecf\u5b8c\u4e86\u3002\u8003\u8651\u52a0\u5165 $y_j=x_i \\land q_j\\leq p_i$ \u7684\u9650\u5236\u600e\u4e48\u505a\u3002\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u9650\u5236\uff0c\u53d1\u73b0\u4e0d\u540c\u70b9\u4e92\u4e0d\u5f71\u54cd\uff0c\u90a3\u4e48\u6211\u4eec\u5bf9\u6bcf\u4e2a\u70b9\u5f00\u4e00\u4e2a\u5355\u8c03\u961f\u5217\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5217\u8f66\u5728\u5b83\u7684 $x$ \u4f4d\u7f6e\u67e5\u8be2\u5c31\u597d\u4e86\u3002\u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\u9650\u5236\uff0c\u6211\u4eec\u5c06\u6240\u6709\u5217\u8f66\u6309\u7167 $p$ \u6392\u5e8f\u7136\u540e\u679a\u4e3e\u65f6\u95f4\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e0a\u9762\u66f4\u65b0\u5b8c\u7684\u5217\u8f66\u5148\u4e0d\u63d2\u5165\u961f\u5217\uff0c\u5f53\u679a\u4e3e\u65f6\u95f4\u5230 $p$ \u7684\u65f6\u5019\u518d\u5c06\u5176\u63d2\u5165\u5373\u53ef\u3002\u8fd9\u6837\u5c31\u80fd\u6ee1\u8db3\u6240\u6709\u9650\u5236\uff0c\u5e76\u4e14\u4fdd\u8bc1\u67e5\u8be2\u7684\u659c\u7387\u5355\u8c03\u9012\u589e\u3002\n\n### \u4ee3\u7801\n\n\u597d\u50cf\u4e0d\u4f1a\u70b8 `long long` \u7684\u6837\u5b50\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ninline int read(){\n\tint w=0,x=0;char c=getchar();\n\twhile(!isdigit(c))w|=c=='-',c=getchar();\n\twhile(isdigit(c))x=x*10+(c^48),c=getchar();\n\treturn w?-x:x;\n}\nnamespace star\n{\n\tconst int maxn=1e6+10;\n\tint n,T,m,A,B,C,st[maxn],ed[maxn],p[maxn],q[maxn],hd[maxn],tl[maxn];\n\tlong long f[maxn],x[maxn],y[maxn],ans=0x3f3f3f3f3f3f3f3f;\n\tvector<int> V[maxn],G[maxn],que[maxn];\n\tinline void work(){\n\t\tn=read(),m=read(),A=read(),B=read(),C=read();\n\t\tfor(int i=1;i<=m;i++) st[i]=read(),ed[i]=read(),p[i]=read(),q[i]=read(),T=max(T,q[i]),G[p[i]].push_back(i);\n\t\tfor(int i=1;i<=n;i++) hd[i]=0,tl[i]=-1;\n\t\tfor(int t=0;t<=T;t++){\n\t\t\tfor(auto i:V[t]){\n\t\t\t\tint e=ed[i];\n\t\t\t\twhile(hd[e]<tl[e] and 1ll*(y[que[e][tl[e]]]-y[que[e][tl[e]-1]])*(x[i]-x[que[e][tl[e]]])>=1ll*(y[i]-y[que[e][tl[e]]])*(x[que[e][tl[e]]]-x[que[e][tl[e]-1]])) --tl[e];\n\t\t\t\tif(++tl[e]==que[e].size()) que[e].push_back(i);\n\t\t\t\t\telse que[e][tl[e]]=i;\n\t\t\t}\n\t\t\tfor(auto i:G[t]){\n\t\t\t\tint e=st[i];\n\t\t\t\twhile(hd[e]<tl[e] and (y[que[e][hd[e]+1]]-y[que[e][hd[e]]])<2ll*A*p[i]*(x[que[e][hd[e]+1]]-x[que[e][hd[e]]])) ++hd[e];\n\t\t\t\tif(hd[e]>tl[e] and st[i]!=1) continue;\n\t\t\t\tint j=st[i]==1 and hd[e]>tl[e]?0:que[e][hd[e]];\n\t\t\t\tf[i]=f[j]+1ll*A*(p[i]-q[j])*(p[i]-q[j])+1ll*B*(p[i]-q[j])+C;\n\t\t\t\tx[i]=q[i],y[i]=f[i]+1ll*A*q[i]*q[i]-1ll*B*q[i];\n\t\t\t\tV[q[i]].push_back(i);\n\t\t\t\tif(ed[i]==n) ans=min(ans,f[i]+q[i]);\n\t\t\t}\n\t\t}\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n}\nsigned main(){\n\tstar::work();\n\treturn 0;\n}\n```\n\n",
        "postTime": 1622721815,
        "uid": 280015,
        "name": "Star_Cried",
        "ccfLevel": 9,
        "title": "P5468 [NOI2019] \u56de\u5bb6\u8def\u7ebf"
    },
    {
        "content": "### \u66b4\u529b\n\n\u9996\u5148\uff0c\u770b\u5230\u8fd9\u4e2a\u9898\u6211\u4eec\u53ef\u4ee5\u5f88\u8f7b\u677e\u7684\u60f3\u5230\u4e00\u4e2a\u66b4\u529b\u3002\n\n\u4ee4 $f_i$ \u4e3a\u5982\u679c\u8981\u7ecf\u8fc7\u7b2c $i$ \u6761\u8fb9\u5219\u5728\u6b64\u4e4b\u524d\u9700\u8981\u7684\u82b1\u8d39\u6700\u5c11\u4e3a\u591a\u5c11\u3002\n\n\u4e00\u4e2a\u663e\u7136\u7684\u65b9\u7a0b\u5f0f\u662f\uff1a\n\n$$f_i=\\min(f _j+A\\times (p_i-q_j)^2+B\\times (p_i-q_j)+C)$$\n\n\u5176\u4e2d $j$ \u662f\u6ee1\u8db3 $y_j=x_i$ \u4e14 $q_j\\le p_i$ \u7684\u8fb9\u3002\n\n\uff08\u8fd9\u8fb9\u7684 $x,y,p,q,A,B,C$ \u53d8\u91cf\u542b\u4e49\u5168\u90e8\u4e0e\u9898\u76ee\u76f8\u540c\uff09\n\n\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5c06\u4e00\u6761\u8fb9\u5206\u4e3a\u51fa\u548c\u5165\u4e24\u6b65\u6765\u66f4\u65b0\uff0c\u4ece\u800c\u6d88\u9664\u65f6\u95f4\u987a\u5e8f\u7684\u95ee\u9898\u3002\n\n\u7406\u8bba\u590d\u6742\u5ea6\u4e3a $\\operatorname{O}(m^2)$ \uff0c\u5b9e\u9645\u4e0a\u5361\u4e0d\u6ee1\u3002\n\n### \u51b3\u7b56\u5355\u8c03\u6027\n\n\u5f53\u6211\u4eec\u770b\u5230\u8fd9\u6837\u7684\u4e00\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u5f0f\u65f6\uff0c\u6211\u4eec\u4e00\u5b9a\u4f1a\u60f3\u5230\uff1a\u8fd9\u4e2a\u9898\u4e0e\u51b3\u7b56\u5355\u8c03\u6027\u6709\u5173\u3002\n\n\u4ee4 $w_{q_j,p_i}$ \u4e3a\u4ece $j$ \u8f6c\u79fb\u5230 $i$ \u7684\u8d39\u7528\uff0c\u5373 $A\\times (p_i-q_j)^2+B\\times (p_i-q_j)+C)$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8bc1\u660e\uff0c\u5bf9\u4e8e\u8fb9 $i_1,i_2$ \u5982\u679c\u6709 $x_{i1}=x_{i2}$ \u4e14 $p_{i1}\\le p_{i2}$\uff0c\n\n\u8bbe\u4e24\u6761\u8fb9\u7684\u6700\u4f18\u51b3\u7b56\u70b9\u5206\u522b\u4e3a $j_1,j_2$\uff0c\u5219 $q_{j1}\\le q_{j2}$\u3002\n\n\u51b3\u7b56\u5355\u8c03\u6027\u7684\u8bc1\u660e\u4e00\u822c\u4f7f\u7528\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\uff0c\u4f46\u5728\u8003\u573a\u4e0a\u66f4\u591a\u4f7f\u7528\u6253\u8868\u6216\u662f\u76f2\u731c\u7684\u65b9\u6cd5\u3002\n\n\u5bf9\u4e8e\u4e0d\u77e5\u9053\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\u7684\u540c\u5b66\uff0c\u5efa\u8bae\u9605\u8bfb[\u8fd9\u7bc7\u535a\u5ba2]( https://www.cnblogs.com/a1b3c7d9/p/10984353.html )\u3002\n\n\u5f53\u7136\u4e5f\u53ef\u4ee5\u9009\u62e9\u76f4\u63a5\u8bb0\u4f4f\u4e00\u4e2a\u7ed3\u8bba\uff1a\n\n\u82e5\u67d0\u4e2a\u65b9\u7a0b\u5f0f $f_i=\\min(f_j+w_{i,j})$\u7684\u8f6c\u79fb\u8d39\u7528\u6ee1\u8db3 $w_{a,b}+w_{a+1,b+1}\\le w_{a+1,b}+w_{a,b+1}$ \u65f6\uff0c\n\n\u8be5\u65b9\u7a0b\u7684\u6700\u4f18\u51b3\u7b56\u70b9\uff08\u5373\u6700\u4f73\u7684 $j$\uff09\u968f $i$ \u975e\u4e25\u683c\u5355\u8c03\u9012\u589e\uff0c\u5373\u6ee1\u8db3\u51b3\u7b56\u5355\u8c03\u6027\u3002\n\n\u90a3\u4e48\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u8bc1\u660e\u4e00\u4e0b\u8fd9\u4e2a\u9898\u7684\u51b3\u7b56\u5355\u8c03\u6027\u3002\n\n$$w_{a,b}+w_{a+1,b+1}\\le w_{a+1,b}+w_{a,b+1}$$\n\n$$\\Leftrightarrow A\\times(a-b)^2+B\\times(a-b)+C+A\\times(a+1-b-1)^2+B\\times(a+1-b-1)+C$$\n\n$$\\le A\\times (a+1-b)^2+B\\times (a+1-b)+C+a\\times (a-b-1)^2+B\\times (a-b-1)+C$$\n\n$$\\Leftrightarrow 2\\times A(a-b)^2\\le A\\times (a+1-b)^2+A\\times (a-b-1)^2$$\n\n\u4ee4 $t=a-b$ \n\n$$\\Leftrightarrow 2\\times At^2\\le A(t+1)^2+A(t-1)^2$$\n\n$$RHS=2At^2+2A\\ge 2At^2=LHS$$ \n\n\u8bc1\u6bd5\u3002\n\n\u987e\u53ef\u77e5\uff0c\u8fd9\u4e00\u65b9\u7a0b\u6ee1\u8db3\u51b3\u7b56\u5355\u8c03\u6027\uff0c\u5373\u6ee1\u8db3\u5bf9\u4e8e\u8fb9 $i_1,i_2$ \u5982\u679c\u6709 $x_{i1}=x_{i2}$ \u4e14 $p_{i1}\\le p_{i2}$\uff0c\n\n\u8bbe\u4e24\u6761\u8fb9\u7684\u6700\u4f18\u51b3\u7b56\u70b9\u5206\u522b\u4e3a $j_1,j_2$\uff0c\u5219\u6709 $q_{j1}\\le q_{j2}$\u3002\n\n### \u659c\u7387\u4f18\u5316\n\n\u659c\u7387\u4f18\u5316\u662f\u51b3\u7b56\u5355\u8c03\u6027\u7684\u4e00\u4e2a\u9ad8\u7ea7\u5e94\u7528\uff0c\u4e00\u822c\u5728 $f$ \u65b9\u7a0b\u4ec5\u6709\u4e00\u4e2a\u7ef4\u5ea6\u65f6\u6709\u6548\u3002\n\n\u4e0d\u4f1a\u659c\u7387\u4f18\u5316\u7684\u540c\u5b66\u8fd9\u91cc\u63a8\u8350\u4e00\u4e0b[\u8fb0\u661f\u51cc\u5927\u4f6c\u7684\u535a\u5ba2]( https://www.cnblogs.com/Xing-Ling/p/11210179.html )\u3002\n\n\u6211\u4eec\u6765\u8003\u8651\u5bf9\u4e8e $ f_i$ \u800c\u8a00\uff0c\u51b3\u7b56\u70b9 $j_1$ \u6bd4 $j_2$ \uff08$q_{j_1}\\ge q_{j_2}$\uff09\u66f4\u4f18\u9700\u8981\u6ee1\u8db3\u4ec0\u4e48\u6761\u4ef6\u3002\n\n\u5c06\u65b9\u7a0b\u5f0f\u5c55\u5f00\u540e\u79fb\u9879\uff0c\u5f97\u5230\n\n$$f_i-Ap_i^2-Bp_i-C=f_j+Aq_j^2-2Ap_iq_j-Bq_j$$\n\n\u8fd9\u6837\u79fb\u9879\u7684\u597d\u5904\u662f\uff0c\u6709\u5173\u4e8e $j$ \u7684\u9879\u5168\u90e8\u88ab\u79fb\u5230\u4e86\u53f3\u8fb9\u3002\n\n\u7531\u4e8e $i$ \u662f\u6211\u4eec\u5df2\u7ecf\u786e\u5b9a\u7684\uff0c\u6240\u4ee5 $p_i$ \u53ef\u4ee5\u770b\u4f5c\u5e38\u91cf\u3002\n\n\u6839\u636e\u65b9\u7a0b\u5f0f\u53ef\u77e5\uff0c\u82e5 $j_1$ \u6bd4 $j_2$ \u66f4\u4f18\uff0c\u5219\u9700\u6ee1\u8db3\n\n$$f_{j_1}+Aq_{j_1}^2-2Ap_iq_{j_1}-Bq_{j_1} \\le f_{j_2}+Aq_{j_2}^2-2Ap_iq_{j_2}-Bq_{j_2}$$\n\n$$\\Leftrightarrow 2Ap_i(q_{j_1}-q_{j_2})\\ge (f_{j_1}+Aq_{j_1}^2-Bq_{j_1})-(f_{j_2}+Aq_{j_2}^2-Bq_{j_2})$$\n\n\u4ee4\n\n$$X(a)=q_a$$\n\n$$Y(a)=f_{a}+Aq_{a}^2-Bq_{a}$$\n\n$$K(a)=2\\times A\\times p_i$$\n\n$$B(a)=f_i-Ap_i^2-Bp_i-C$$\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u659c\u7387\u4f18\u5316\u7684\u5f62\u5f0f\u3002\n\n\u5f53 $i$ \u56fa\u5b9a\u65f6\uff0c\u6211\u4eec $K(i)$ \u4e5f\u5c31\u56fa\u5b9a\u4e86\u3002\n\n\u800c\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u8ba9  $B(i)$ \u8d8a\u5c0f\u8d8a\u597d\u3002\n\n\u56e0\u6b64\uff0c\u53ea\u8981 $j_1,j_2 $ \u6ee1\u8db3\n\n$$K(i)\\ge \\frac{Y(j_1)-Y(j_2)}{X(j_1)-X(j_2)}$$\n\n\u4e5f\u5c31\u662f $K(i )$ \u5927\u4e8e $(X(j_1),Y(j_1))$ \u4e0e $(X(j_2),Y(j_2))$ \u7ec4\u6210\u7684\u76f4\u7ebf\uff0c\u5219 $j_1$ \u4f18\u4e8e $j_2 $\u3002\n\n\u8fd9\u5176\u5b9e\u975e\u5e38\u597d\u7406\u89e3\u3002\u5f53 $K(i)<\\frac{Y(j_1)-Y(j_2)}{X(j_1)-X(j_2)}$ \u65f6\uff0c\u8bbe $B$ \u70b9\u4e3a $(X(j_1),Y(j_1))$\uff0c$A$ \u70b9\u4e3a $(X(j_2),Y(j_2))$\uff0c\n\n\u5219\u6211\u4eec\u753b\u51fa\u6765\u7684\u56fe\u5982\u4e0b\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/xx5epmov.png)\n\n\u663e\u7136\u6b64\u65f6\u8ba9\u76f4\u7ebf\u7ecf\u8fc7 $A$ \u70b9\u66f4\u4f18\u3002\n\n\u800c\u5f53 $K(i)\\ge \\frac{Y(j_1)-Y(j_2)}{X(j_1)-X(j_2)}$ \u65f6\uff0c\u56fe\u5982\u4e0b\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/nok4ca8p.png)\n\n\u663e\u7136\u9009\u62e9 $B$ \u70b9\u66f4\u4f18\u3002\n\n\u53c8\u7531\u4e8e\u6211\u4eec\u8bc1\u660e\u4e86\u51b3\u7b56\u5355\u8c03\u6027\uff0c\u56e0\u6b64\u4ece\u6b64\u4ee5\u540e $A$ \u70b9\uff08\u4e5f\u5c31\u662f $j_2$\uff09 \u518d\u65e0\u7528\u5904\u3002\n\n\u5982\u679c\u6211\u4eec\u7528\u4e00\u4e2a\u53cc\u7aef\u961f\u5217\u6765\u7ef4\u62a4\u4e5f\u8bb8\u6709\u6548\u7684\u51b3\u7b56\u70b9\uff0c\u90a3\u4e48\u8fd9\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06 $j_2$ \u51fa\u961f\u3002\n\n\u63a5\u7740\uff0c\u6211\u4eec\u518d\u6765\u8003\u8651\u4ec0\u4e48\u6837\u7684\u70b9\u9700\u8981\u653e\u5165\u961f\u5217\u4e2d\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/dfhsh30p.png)\n\n\u5bf9\u4e8e\u8fd9\u6837\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u65e0\u8bba\u6240\u6c42\u76f4\u7ebf\u7684 $K(i)$ \u662f\u591a\u5c11\uff0c$B$ \u90fd\u4e0d\u4f1a\u6210\u4e3a\u6700\u4f18\u51b3\u7b56\u70b9\uff0c\n\n\u56e0\u6b64\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06 $B$ \u51fa\u961f\u3002\n\n\u51c6\u786e\u7684\u8bf4\uff0c\u5f53 $\\frac{Y(A)-Y(B)}{X(A)-X(B)}\\ge \\frac{Y(A)-Y(C)}{X(A)-X(C)}$ \u65f6\uff0c$B$ \u70b9\u5c31\u4e0d\u4f1a\u6210\u4e3a\u6700\u4f18\u51b3\u7b56\u70b9\uff0c\n\n\u56e0\u4e3a\u5f53 $K(i)<\\frac{Y(A)-Y(C)}{X(A)-X(C)}$ \u65f6 $A$ \u6bd4 $B$ \u66f4\u4f18\uff0c\u5426\u5219 $C$ \u6bd4 $B$ \u66f4\u4f18\u3002\n\n\u5176\u5b9e\u5982\u679c\u6211\u4eec\u628a\u961f\u5217\u4e2d\u7684\u6240\u6709\u70b9\u753b\u51fa\u6765\uff0c\u5e94\u8be5\u662f\u8fd9\u6837\u7684\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/fqdq93by.png)\n\n### Code\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\n#define X(T) (q[T])\n#define Y(T) (f[T]+a*q[T]*q[T]-b*q[T])\n#define K(T) (2*a*p[T])\n#define B(T) (f[T]-a*p[T]*p[T]-b*p[T]-c)\n//\u4e00\u4e2a\u597d\u4e60\u60ef\uff0c\u4e5f\u65b9\u4fbf\u76f4\u63a5\u8c03\u7528\nusing namespace std;\ninline int read(){\n\tregister int x=0;\n\tregister bool f=0;\n\tregister char c=getchar();\n\twhile(c<'0'||c>'9'){\n\t\tif(c=='-') f=1;\n\t\tc=getchar();\n\t}\n\twhile(c>='0'&&c<='9'){\n\t\tx=(x<<3)+(x<<1)+c-48;\n\t\tc=getchar();\n\t}\n\treturn f?-x:x;\n}\nchar cr[200];int tt;\ninline void print(register ll x,register char k='\\n') {\n    if(!x) putchar('0');\n    if(x < 0) putchar('-'),x=-x;\n    while(x) cr[++tt]=x%10+'0',x/=10;\n    while(tt) putchar(cr[tt--]);\n    putchar(k);\n}\nconst int maxn=200001;\nint n,m,a,b,c,mx;\nint p[maxn],q[maxn],u[maxn],v[maxn];\nll f[maxn],ans=114514191981000000ll;\nint tl,tl2,he,he2,sz;\ndeque<int> d[maxn];\n//stl \u81ea\u5e26\u53cc\u7aef\u961f\u5217\uff0c\u4e5f\u53ef\u4ee5\u7528 vector \u5b9e\u73b0\ndeque<int>::iterator it;\nvector<int> st[1001];\nvector<int> ed[1001];\n//st,ed \u5206\u522b\u4e3a\u67d0\u4e00\u65f6\u523b\u7684\u51fa\u53d1\u4e0e\u5230\u8fbe\u6570\u7ec4\ndouble slope(int qa,int qb){\n    return (1.0*(Y(qa)-Y(qb)))/(1.0*(X(qa)-X(qb)));\n    //\u6c42\u659c\u7387\n}\nsigned main(){\n//\tfreopen(\"route.in\",\"r\",stdin);\n//\tfreopen(\"route.out\",\"w\",stdout);\n\tn=read();m=read();a=read();b=read();c=read();\n\tfor(int i=1;i<=m;++i){\n\t\tu[i]=read();v[i]=read();p[i]=read();q[i]=read();\n\t\tif(u[i]==n) continue;\n\t\tmx=max(mx,q[i]);\n\t\tst[p[i]].push_back(i);\n\t\tf[i]=1233333333ll;\n        //\u521d\u59cb\u5316\n\t}\n\td[1].push_back(0);\n\tf[1]=0;\n\tfor(int i=0;i<=mx;i++){\n\t\tfor(int j:ed[i]){\n            //\u679a\u4e3e\u7b2c i \u65f6\u523b\u5230\u8fbe\u7684\u8fb9\n\t\t\tsz=d[v[j]].size();\n\t\t\tif(sz==0) {\n\t\t\t\td[v[j]].push_back(j);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tit=d[v[j]].end();\n\t\t\tit--;\n\t\t\ttl=*it;\n\t\t\twhile(sz>1){\n\t\t\t\tit--;tl2=*it;\n                //tl \u4e3a\u961f\u5c3e\uff0ctl2 \u4e3a\u961f\u5c3e\u7b2c\u4e8c\u4e2a\u6570\n\t\t\t\tif(slope(tl,tl2)<slope(j,tl2)){\n\t\t\t\t\tbreak;\n                    //tl2 \u53ef\u80fd\u66f4\u4f18\n\t\t\t\t}\n                //j \u4e00\u5b9a\u66f4\u4f18\uff0c\u5f39\u51fa tl2\n\t\t\t\ttl=tl2;sz--;\n\t\t\t\td[v[j]].pop_back();\n\t\t\t}\n\t\t\td[v[j]].push_back(j);\n\t\t}\n\t\tfor(int j:st[i]){\n            //\u679a\u4e3e\u7b2c i \u65f6\u523b\u51fa\u53d1\u7684\u8fb9\n\t\t\tsz=d[u[j]].size();\n\t\t\tif(sz==0) continue;\n            //\u8fd9\u6761\u8fb9\u51fa\u53d1\u4e4b\u524d\u65e0\u6cd5\u5230\u8fbe\u8be5\u70b9\uff0c\u6545\u8fd9\u6761\u8fb9\u65e0\u6548\n\t\t\tit=d[u[j]].begin();he=*it;\n\t\t\twhile(sz>1){\n\t\t\t\tit++;he2=*it;\n                //he \u4e3a\u961f\u9996\uff0che2 \u4e3a\u961f\u9996\u7b2c\u4e8c\u4e2a\u6570\n\t\t\t\tif(slope(he2,he)>K(j)){\n\t\t\t\t\tbreak;\n\t\t\t\t}\n                //\u6bd4\u8f83\u4e00\u4e0b\u90a3\u6761\u8fb9\u66f4\u4f18\uff0c\u5982\u679c he2 \u53ef\u4ee5\u53d6\u4ee3 he \u5219\u51fa\u961f\n                //\u6b64\u65f6\u961f\u9996\u5c31\u662f\u6700\u4f18\u51b3\u7b56\u70b9\u4e86\n\t\t\t\the=he2;sz--;\n\t\t\t\td[u[j]].pop_front();\n\t\t\t}\n\t\t\tf[j]=f[he]+a*(p[j]-q[he])*(p[j]-q[he])+b*(p[j]-q[he])+c;\n            //\u66f4\u65b0 f \u51fd\u6570\n\t\t\tif(v[j]==n) ans=min(ans,f[j]+q[j]);\n\t\t\ted[q[j]].push_back(j);\n\t\t}\n\t}\n\tprint(ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1606215625,
        "uid": 120074,
        "name": "BFqwq",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P6302 \u3010[NOI2019]\u56de\u5bb6\u8def\u7ebf \u52a0\u5f3a\u7248\u3011"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P6302)\n\n\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u79cd**\u8f83\u6613\u7406\u89e3**\uff08\u81f3\u5c11\u6211\u81ea\u5df1\u662f\u8fd9\u4e48\u8ba4\u4e3a\u7684\uff09\uff0c\u5e76\u4e14\u4e00\u70b9\u90fd**\u4e0d\u5361\u5e38**\u7684\u65b9\u6cd5\uff08\u867d\u7136\u672c\u8d28\u662f\u5dee\u4e0d\u591a\u4e00\u6837\u7684\uff09\u3002\n\n~~\uff08\u624d\u4e0d\u4f1a\u544a\u8bc9\u4f60\u6211\u662f\u56e0\u4e3a\u770b\u4e0d\u61c2\u73b0\u884c\u7684\u5927\u90e8\u5206\u9898\u89e3\u7136\u540e\u4e0d\u5f97\u4e0d\u81ea\u5df1yy\u4e00\u79cd\u505a\u6cd5\u51fa\u6765\u7684\u5462\uff09~~\n\n\n------------\n\n\u6211\u4eec\u8bbe$f[i]$\u8868\u793a\u5f53\u4f60\u6700\u540e\u4e00\u8f86\u4e58\u5750\u7684\u662f$i$\u53f7\u8f66\u65f6\uff0c\u6700\u5c0f\u7684\u70e6\u8e81\u503c\u3002\n\n\u5219\u6709\n\n$$f[i]=\\min\\limits_{y_j=x_i,q_j\\leq p_i}\\{f[j]+A(p_i-q_j)^2+B(p_i-q_j)+C\\}$$\n\n\u8fd9\u70b9\u5e94\u8be5\u975e\u5e38\u6613\u4e8e\u7406\u89e3\u3002\n\n\n------------\n\n\u7136\u540e\u5c31\u662f\u5927\u591a\u6570\u9898\u89e3\u6211\u90fd\u6ca1\u6709\u770b\u61c2\u7684\u90e8\u5206\u4e86\uff0c\u5373\u8f6c\u79fb\u987a\u5e8f\u3002\u663e\u7136\uff0c\u8fd9\u9053\u9898\u7684\u8f6c\u79fb\u987a\u5e8f\u53ea\u6709\u53ef\u80fd\u662f**\u65f6\u95f4**\u3002\u9898\u89e3\u90fd\u91c7\u7528\u4e86**\u5faa\u73af**\u7684\u5199\u6cd5\uff0c\u8fd9\u610f\u5473\u7740$x_i$\u4e0e$y_i$\uff0c$p_i$\u4e0e$q_i$\uff0c\u8fd9\u4e9b\u539f\u672c\u597d\u7aef\u7aef\u5728\u4e00\u8d77\u7684\u4e1c\u897f\u90fd\u4f1a\u88ab\u62c6\u5f00\uff0c\u4f46\u6b63\u662f\u8fd9\u4e00\u70b9\u8ba9\u6211\u8fd9\u79cd\u849f\u84bb\u975e\u5e38\u8ff7\u60d1\u3002\u56e0\u6b64\uff0c\u6211\u51b3\u5b9a\u91c7\u53d6**\u9012\u5f52**\u7684\u5199\u6cd5\uff0c\u5373**\u8bb0\u5fc6\u5316\u641c\u7d22**\u3002\n\n\u5177\u4f53\u800c\u8a00\uff1a\n\n\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a**\u8f66\u7ad9**$i$\uff0c\u5efa\u7acb\u4e24\u4e2a```vector```\uff0c\u4e00\u4e2a\u540d\u53eb$in_i$\uff0c\u50a8\u5b58\u4e86\u6240\u6709$q_j=i$\u7684$j$\uff0c\u5373\u7ec8\u70b9\u4e3a$i$\u7684\u8f66\u8f86\u7f16\u53f7\uff1b\u53e6\u4e00\u4e2a\u540d\u53eb$out_i$\uff0c\u50a8\u5b58\u6240\u6709$p_j=i$\u7684$j$\uff0c\u5373\u8d77\u70b9\u4e3a$i$\u7684\u8f66\u8f86\u7f16\u53f7\u3002\u540c\u4e00\u4e2a```vector```\u5185\u7684\u5143\u7d20\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u6392\u5e8f\u3002\n\n\u7136\u540e\uff0c\u6211\u4eec\u5efa\u7acb\u8bb0\u5fc6\u5316\u51fd\u6570```dfs(x)```\uff0c\u8868\u793a\u6c42\u51fa$f[x]$\u7684\u8fc7\u7a0b\u3002\n\n\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u679a\u4e3e$in_{x_x}$\u4e2d\u7684\u6240\u6709\u7684$i$\u4f7f\u5f97$q_i\\leq p_x$\uff0c\u4ece$dfs(i)+A(p_x-q_i)^2+B(p_x-q_i)+C$\u5904\u8f6c\u79fb\u5373\u53ef\u3002\u663e\u7136\uff0c\u8fd9\u4e2a\u9012\u5f52\u7684\u8fc7\u7a0b\u672c\u8eab\u5c31\u662f\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u8fdb\u884c\u7684\u3002\n\n\u9002\u5f53\u7684\u8fb9\u754c\u6761\u4ef6\u73c2\u4ee5\u51cf\u5c11\u7279\u5224\u3002\u4f8b\u5982\u5728$in_1$\u4e2d\u538b\u5165\u4e00\u4e2a$0$\u8868\u793a\u521d\u59cb\u72b6\u6001\u5c31\u662f\u4e00\u4e2a\u597d\u529e\u6cd5\u3002\n\n\n------------\n\n\u8be5\u65b9\u6cd5\u590d\u6742\u5ea6\u4e0a\u754c$O(m^2)$\uff0c\u56e0\u4e3a\u539f\u9898\u6570\u636e\u6c34\uff0c\u53ef\u4ee5\u901a\u8fc7\uff08\u4f46\u662f\u52a0\u5f3a\u7248\u8fc7\u4e0d\u53bb\uff09\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nint n,m,A,B,C;\nll f[1001000],ans=0x3f3f3f3f3f3f3f3f;\nvector<pair<int,int> >in[100100],out[100100];\nstruct node{\n\tint x,y,u,v;\n}r[1001000];\nll dfs(int x){\n\tif(f[x]!=-1)return f[x];\n\tll &res=f[x];res=0x3f3f3f3f3f3f3f3f;\n\tfor(auto i:in[r[x].x]){\n\t\tint tmp=out[r[x].x][r[x].u].first-i.first;\n\t\tif(tmp<0)break;\n//\t\tprintf(\"%d->%d:%d\\n\",i.second,x,dfs(i.second)+A*tmp*tmp+B*tmp+C);\n\t\tres=min(res,dfs(i.second)+A*tmp*tmp+B*tmp+C);\n\t}\n\treturn res;\n}\nint main(){\n\tscanf(\"%d%d%d%d%d\",&n,&m,&A,&B,&C),memset(f,-1,sizeof(f)),f[0]=0;\n\tfor(int i=1,u,v;i<=m;i++)scanf(\"%d%d%d%d\",&r[i].x,&r[i].y,&u,&v),in[r[i].y].push_back(make_pair(v,i)),out[r[i].x].push_back(make_pair(u,i));\n\tin[1].push_back(make_pair(0,0));\n\tfor(int i=1;i<=n;i++){\n\t\tsort(in[i].begin(),in[i].end()),sort(out[i].begin(),out[i].end());\n\t\tfor(int j=0;j<in[i].size();j++)r[in[i][j].second].v=j;\n\t\tfor(int j=0;j<out[i].size();j++)r[out[i][j].second].u=j;\n\t}\n\tfor(auto x:in[n])ans=min(ans,dfs(x.second)+x.first);\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n} \n```\n\n\n------------\n\n\u7136\u540e\u5c31\u8981\u8003\u8651\u4f18\u5316\u624d\u80fd\u901a\u8fc7\u52a0\u5f3a\u7248\u4e86\u3002\u770b\u5230$Ax^2+Bx+C$\u8fd9\u79cd\u5f0f\u5b50\uff0c\u6211\u4eec\u60f3\u5230\u4e86[[APIO2010]\u7279\u522b\u884c\u52a8\u961f](https://www.luogu.com.cn/problem/P3628)\uff0c\u7ecf\u5178**\u659c\u7387\u4f18\u5316**\u9898\u3002\n\n\u6211\u4eec\u91cd\u65b0\u5217\u51fa\u8f6c\u79fb\u5f0f\uff08\u6839\u636e\u524d\u9762\u7684\u65b0\u5b9a\u4e49\u52a0\u4ee5\u5c11\u8bb8\u4fee\u6539\uff09\uff1a\n\n$$\\large f[i]=\\min\\limits_{j\\in in_{x_i},q_j\\leq p_i}\\{dfs(j)+A(p_i-q_j)^2+B(p_i-q_j)+C\\}$$\n\n\u5047\u8bbe\u6709$j,k\\in in_{x_i}$\u4e14$q_j\\leq q_k\\leq p_i$\u3002\u8003\u8651\u4ec0\u4e48\u60c5\u51b5\u4e0b$k$\u4e00\u5b9a\u4f1a\u88ab\u8e22\u51fa\uff1a\n\n\u5219\u6709\n\n$$dfs(j)+A(p_i-q_j)^2+B(p_i-q_j)+C\\leq dfs(k)+A(p_i-q_k)^2+B(p_i-q_k)+C$$\n\n\u62c6\u62ec\u53f7\n\n$$dfs(j)+Ap_i^2-2Ap_iq_j+Aq_j^2+Bp_i-Bq_j+C\\leq dfs(k)+Ap_i^2-2Ap_iq_k+Aq_k^2+Bp_i-Bq_k+C$$\n\n\u7ea6\u6389\n\n$$dfs(j)-2Ap_iq_j+Aq_j^2-Bq_j\\leq dfs(k)-2Ap_iq_k+Aq_k^2-Bq_k$$\n\n\u540c\u7c7b\u9879\u6574\u5408\n\n$$\\Big(dfs(j)-dfs(k)\\Big)+A(q_j^2-q_k^2)-B(q_j-q_k)\\leq 2Ap_i(q_j-q_k)$$\n\n\u9664\u8fc7\u53bb\n\n$$\\dfrac{\\Big(dfs(j)-dfs(k)\\Big)+A(q_j^2-q_k^2)-B(q_j-q_k)}{q_j-q_k}\\geq2Ap_i$$\n\n\u8fd9\u5c31\u662f\u6211\u4eec\u659c\u7387\u4f18\u5316\u7684\u5f0f\u5b50\u3002\u56e0\u4e3a\u6392\u8fc7\u5e8f\uff0c\u4fdd\u8bc1$p_i$\u9012\u589e\uff0c\u56e0\u6b64\u73c2\u4ee5\u91c7\u53d6**\u5355\u8c03\u961f\u5217**\u8fdb\u884c\u659c\u7387\u4f18\u5316\u3002\n\n\n------------\n\n\u4f46\u662f\u8fd9\u9898\u7684\u5b9e\u73b0\u4e0e\u5e38\u89c4\u659c\u7387\u4f18\u5316\u6709\u6240\u5dee\u522b\u3002\u56e0\u4e3a\u8f6c\u79fb\u662f\u5bf9\u4e8e\u6bcf\u4e2a\u8f66\u7ad9$i$\uff0c\u4ece$in_i$\u4e2d\u5168\u4f53\u6570\u8f6c\u79fb\u5230$out_i$\u4e2d\u5168\u4f53\u6570\u7684\uff1b\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e\u6bcf\u4e2a$i$\uff0c\u6211\u4eec\u90fd\u5e94\u8be5**\u5355\u72ec**\u5f00\u4e00\u4e2a\u5355\u8c03\u961f\u5217\u3002\n\n\u8fd8\u6ca1\u5b8c\u3002\u56e0\u4e3a\u8fd9\u9898\u7684\u8ba1\u7b97\u987a\u5e8f\u662f**\u65f6\u95f4\u987a\u5e8f**\uff0c\u56e0\u6b64\u6211\u4eec\u4e0d\u80fd\u7b80\u5355\u5730\u5bf9\u4e8e\u6bcf\u4e2a\u8f66\u7ad9\u4ece\u5934\u5230\u5c3e\u8dd1\u4e00\u904d\u5355\u8c03\u961f\u5217\u6c42\u51fa\u6240\u6709\u7684$f_{out_i}$\u3002\u51c6\u786e\u5730\u8bf4\uff0c\u8fd9\u4e2a$f$\u5e94\u8be5\u662f**\u5206\u6bb5**\u6c42\u51fa\u7684\u3002\n\n\n------------\n\n\u8bbe$lima_i$\u8868\u793a\u4f4d\u7f6e$i$\u7684$in_i$\u4e2d\u5165\u961f\u5230\u4e86\u7b2c\u51e0\u4e2a\uff0c$limb_i$\u8868\u793a\u4f4d\u7f6e$i$\u7684$out_i$\u4e2d\u6c42\u5230\u4e86\u7b2c\u51e0\u4e2a\u7684$f_x$\u3002\u5219\u6211\u4eec\u5728\u8be2\u95ee$dfs(x)$\u65f6\uff1a\n\n\u8bbe$pos={x_x}$\uff0c\u4e14$x$\u662f$out_{pos}$\u4e2d\u7684\u7b2c$tar$\u4e2a\u3002\u5982\u679c$f_x$\u5df2\u7ecf\u88ab\u6c42\u51fa\uff0c\u5219\u5e94\u6709$limb_{pos}>tar$\uff0c\u6b64\u65f6\u73c2\u4ee5\u76f4\u63a5\u8fd4\u56de$f_x$\u3002\u5426\u5219\uff0c\u6211\u4eec\u4e00\u6b21\u6027\u6c42\u51fa$\\Big[limb_{pos},tar\\Big]$\u533a\u95f4\u91cc\u6240\u6709\u6570\u7684$f_x$\u3002\n\n\n------------\n\n\u5177\u4f53\u800c\u8a00\uff1a\n\n\u4e0d\u505c\u8ba9$limb_{pos}$\u81ea\u52a0$1$\u3002\u8bbe$i$\u4e3a\u5f53\u524d$limb_{pos}$\u6240\u5bf9\u5e94\u7684$out_{pos}$\u4e2d\u7684\u90a3\u4e2a\u6570\uff0c\u5219\u6bcf\u81ea\u52a0\u4e00\u6b21\uff0c\u5c31\u5165\u961f$in_{pos}$\u4e2d\u6240\u6709\u4f7f\u5f97$q_j\\leq p_i$\u7684$j$\uff0c\u540c\u65f6\u7ef4\u62a4\u5355\u8c03\u961f\u5217\u3002\u5f53\u5168\u90e8\u5165\u961f\u5b8c\u6210\u540e\uff0c\u518d\u4ece\u961f\u9996\u5173\u4e8e$i$\u51fa\u961f\u5373\u53ef\u3002\n\n\u8fd9\u79cd\u5199\u6cd5\u4e0e\u5e38\u89c4\u659c\u7387\u4f18\u5316\u7684\u6700\u5927\u5dee\u522b\u5728\u4e8e\uff0c\u5e38\u89c4\u7684\u659c\u7387\u4f18\u5316\u662f\u8f6c\u79fb\u7684\u8d77\u70b9\u7ec8\u70b9\u90fd**\u5728\u540c\u4e00\u4e2a\u6570\u7ec4**\u91cc\u9762\uff0c\u800c\u8fd9\u91cc\u8d77\u70b9\u7ec8\u70b9**\u4e00\u4e2a\u5728$in$\u91cc\u9762\uff0c\u4e00\u4e2a\u5728$out$\u91cc\u9762**\u3002\u56e0\u6b64\u6211\u91c7\u53d6\u7684\u662f\u5148\u4e00\u8d77\u5165\u961f\uff0c\u518d\u51fa\u961f\u7684\u5199\u6cd5\u3002\n\n\n------------\n\n\u653e\u4e00\u4e0b```dfs(x)```\u7684\u4ee3\u7801\uff1a\n\n```cpp\nll dfs(int x){\n\tif(f[x]!=-1)return f[x];\n\tint pos=r[x].x,tar=r[x].u;\n\twhile(limb[pos]<=tar){\n\t\twhile(lima[pos]<in[pos].size()&&in[pos][lima[pos]].first<=out[pos][limb[pos]].first){\n\t\t\tint i=in[pos][lima[pos]].second,si=in[pos][lima[pos]].first;\n\t\t\tif(dfs(i)!=0x3f3f3f3f3f3f3f3f){\n\t\t\t\twhile(q[pos].size()>=2){\n\t\t\t\t\tint J=q[pos][q[pos].size()-2],K=q[pos][q[pos].size()-1];\n\t\t\t\t\tint j=in[pos][J].second,sj=in[pos][J].first;\n\t\t\t\t\tint k=in[pos][K].second,sk=in[pos][K].first;\n\t\t\t\t\tif(1ll*((dfs(j)-dfs(k))+1ll*A*(1ll*sj*sj-1ll*sk*sk)-1ll*B*(sj-sk))*(sk-si)<1ll*((dfs(k)-dfs(i))+1ll*A*(1ll*sk*sk-1ll*si*si)-1ll*B*(sk-si))*(sj-sk))break;\n\t\t\t\t\tq[pos].pop_back();\n\t\t\t\t}\n\t\t\t\tq[pos].push_back(lima[pos]);\t\t\t\t\n\t\t\t}\n\t\t\tlima[pos]++;\n\t\t}\n\t\tint i=out[pos][limb[pos]].second,si=out[pos][limb[pos]].first;\n\t\twhile(q[pos].size()>=2){\n\t\t\tint J=q[pos][0],K=q[pos][1];\n\t\t\tint j=in[pos][J].second,sj=in[pos][J].first;\n\t\t\tint k=in[pos][K].second,sk=in[pos][K].first;\n\t\t\tif((dfs(j)-dfs(k))+1ll*A*(1ll*sj*sj-1ll*sk*sk)-1ll*B*(sj-sk)<2ll*A*si*(sj-sk))break;\n\t\t\tq[pos].pop_front();\n\t\t}\n\t\tif(!q[pos].empty()){\n\t\t\tint J=q[pos].front();\n\t\t\tint j=in[pos][J].second,tmp=si-in[pos][J].first;\n\t\t\tf[i]=dfs(j)+1ll*A*tmp*tmp+1ll*B*tmp+C;\n\t\t}else f[i]=0x3f3f3f3f3f3f3f3f;\n\t\tlimb[pos]++;\n\t}\n\treturn f[x];\n}\n```\n\u8fd9\u4efd\u4ee3\u7801\u53ef\u80fd\u6709\u70b9\u96be\u4ee5\u7406\u89e3\uff0c\u6211\u9a6c\u4e0a\u62c6\u5f00\u6765\u8bb2\u4e00\u4e0b\u3002\n\n\u9996\u5148\uff0c$in$\u548c$out$\u91cc\u9762\u88c5\u7684\u90fd\u662f```pair<int,int>```\uff0c\u5176\u4e2d```first```\u662f\u65f6\u95f4\uff0c```second```\u662f\u6807\u53f7\u3002\u5355\u8c03\u961f\u5217\u4e2d\u50a8\u5b58\u7684\uff0c\u662f\u5176\u5728$in_{pos}$\u4e2d\u7684\u7f16\u53f7\uff1b\u56e0\u6b64\u624d\u8981\u5148\u8bbe$J$\u548c$K$\u8868\u793a$in$\u4e2d\u7f16\u53f7\uff0c\u7136\u540e\u518d\u8bbe$j,k$\u8868\u793a\u771f\u5b9e\u7684\u8f66\u8f86\u7f16\u53f7\uff0c\u518d\u8bbe$sj,sk$\u8868\u793a$q_j,q_k$\u3002\n\n\u6ce8\u610f\u8fd9\u91cc\u91cc\u5c42\u5faa\u73af\u4e2d\u7684$i$\u4e0e\u5916\u5c42\u5faa\u73af\u7684$i$\u4e0d\u662f\u540c\u4e00\u4e2a$i$\uff1a\u91cc\u5c42\u7684$i$\u662f$in_{pos}$\u4e2d\u8981\u5165\u961f\u7684\u7f16\u53f7\uff0c\u800c\u5916\u5c42\u7684$i$\u662f$out_{pos}$\u4e2d\u8981\u88ab\u8ba1\u7b97\u7684\u7f16\u53f7\u3002\n\n\n------------\n\n\u53e6\u5916\u6709\u51e0\u4e2a\u5c0f\u7ec6\u8282\uff1a\n\n**\u5982\u679c\u4f60\u53d1\u73b0\u5c06\u8981\u88ab\u5165\u961f\u7684\u6570\u7684```dfs```\u503c\u5df2\u7ecf\u4e3a$INF$\uff0c\u5373\u65e0\u89e3\u65f6\uff0c\u73c2\u4ee5\u76f4\u63a5\u7565\u8fc7\u8fd9\u4e2a\u6570\u3002**\uff08\u56e0\u4e3a\u8fd9\u70b9\u6211debug\u4e861h\uff09\n\n**\u5165\u961f\u6216\u51fa\u961f\u65f6\uff0c\u5728\u5355\u8c03\u961f\u5217\u4e2d\u7ef4\u62a4\u51f8\u58f3\u65f6\uff0c\u80fd\u5220\u5c31\u5220\u3002**\uff08\u56e0\u4e3a\u8fd9\u70b9\u6211\u53c8debug\u4e861h\uff09\n\n\n------------\n\n\u6700\u540e\u662f\u590d\u6742\u5ea6\u5206\u6790\u3002\n\n\u663e\u7136\uff0c\u901a\u8fc7\u5355\u8c03\u961f\u5217\uff0cdp\u90e8\u5206\u7684\u590d\u6742\u5ea6\u88ab\u538b\u5230\u4e86$O(m)$\u3002\u4f46\u662f\uff0c\u6211\u4eec\u4e0d\u8981\u5fd8\u8bb0$in_x$\u548c$out_x$\u4e2d\u7684**\u6392\u5e8f**\u3002\u5982\u679c\u7528\u5e38\u89c4\u6392\u5e8f\u7684\u8bdd\uff0c\u662f$O(m\\log m)$\u7684\u3002\u4f46\u662f\u6b64\u9898\u65f6\u95f4\u8303\u56f4$T$\u8f83\u5c0f\uff0c\u53ea\u6709$4\\times10^4$\uff0c\u56e0\u6b64\u6392\u5e8f\u65f6\u73c2\u4ee5\u91c7\u53d6**\u6876\u6392**\uff0c\u590d\u6742\u5ea6\u5c31\u662f$O(m)$\u7684\u3002\uff08\u5c3d\u7ba1\u6211\u8fd9\u4efd\u7a0b\u5e8f\u5728\u6ca1\u6709\u4f7f\u7528\u6876\u6392\u7684\u60c5\u51b5\u4e0b\u5c31\u8fc7\u53bb\u4e86\uff0c\u5982\u679c\u4f60\u4eec\u89c9\u5f97\u590d\u6742\u5ea6\u4e0d\u591f\u4f18\u79c0\uff0c\u73c2\u4ee5\u6362\u6210\u6876\u6392\uff09\n\n\n------------\n\n\n\u6700\u540e\u7684\u6700\u540e\uff0c\u5b83\u4e0d\u5361\u5e38\uff01\uff01\uff01O3\uff0c```vector```\u66ff\u6362```deque```\uff0c\u6876\u6392\u5e8f\uff0c\u7b49\u7b49\u5947\u5947\u602a\u602a\u7684trick\uff0c\u4e00\u4e2a\u90fd\u6ca1\u7528\uff0c\u52a0\u4e2a\u5feb\u8bfb\u5c31\u8dd1\u8fc7\u53bb\u4e86\uff08\u73b0\u5728\u5728\u7b2c\u4e8c\u9875\uff0c\u5982\u679c\u5361\u4e86\u4f30\u8ba1\u80fd\u6324\u8fdb\u524d3\uff09\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nint n,m,A,B,C,lima[100100],limb[100100];\nll f[1001000],ans=0x3f3f3f3f3f3f3f3f;\nvector<pair<int,int> >in[100100],out[100100];\ndeque<int>q[100100];\nstruct node{\n\tint x,y,u,v;\n}r[1001000];\nll dfs(int x){\n\tif(f[x]!=-1)return f[x];\n\tint pos=r[x].x,tar=r[x].u;\n\twhile(limb[pos]<=tar){\n\t\twhile(lima[pos]<in[pos].size()&&in[pos][lima[pos]].first<=out[pos][limb[pos]].first){\n\t\t\tint i=in[pos][lima[pos]].second,si=in[pos][lima[pos]].first;\n\t\t\tif(dfs(i)!=0x3f3f3f3f3f3f3f3f){\n\t\t\t\twhile(q[pos].size()>=2){\n\t\t\t\t\tint J=q[pos][q[pos].size()-2],K=q[pos][q[pos].size()-1];\n\t\t\t\t\tint j=in[pos][J].second,sj=in[pos][J].first;\n\t\t\t\t\tint k=in[pos][K].second,sk=in[pos][K].first;\n\t\t\t\t\tif(1ll*((dfs(j)-dfs(k))+1ll*A*(1ll*sj*sj-1ll*sk*sk)-1ll*B*(sj-sk))*(sk-si)<1ll*((dfs(k)-dfs(i))+1ll*A*(1ll*sk*sk-1ll*si*si)-1ll*B*(sk-si))*(sj-sk))break;\n\t\t\t\t\tq[pos].pop_back();\n\t\t\t\t}\n\t\t\t\tq[pos].push_back(lima[pos]);\t\t\t\t\n\t\t\t}\n\t\t\tlima[pos]++;\n\t\t}\n\t\tint i=out[pos][limb[pos]].second,si=out[pos][limb[pos]].first;\n\t\twhile(q[pos].size()>=2){\n\t\t\tint J=q[pos][0],K=q[pos][1];\n\t\t\tint j=in[pos][J].second,sj=in[pos][J].first;\n\t\t\tint k=in[pos][K].second,sk=in[pos][K].first;\n\t\t\tif((dfs(j)-dfs(k))+1ll*A*(1ll*sj*sj-1ll*sk*sk)-1ll*B*(sj-sk)<2ll*A*si*(sj-sk))break;\n\t\t\tq[pos].pop_front();\n\t\t}\n\t\tif(!q[pos].empty()){\n\t\t\tint J=q[pos].front();\n\t\t\tint j=in[pos][J].second,tmp=si-in[pos][J].first;\n\t\t\tf[i]=dfs(j)+1ll*A*tmp*tmp+1ll*B*tmp+C;\n\t\t}else f[i]=0x3f3f3f3f3f3f3f3f;\n\t\tlimb[pos]++;\n\t}\n\treturn f[x];\n}\nvoid read(int &x){\n\tx=0;\n\tchar c=getchar();\n\twhile(c>'9'||c<'0')c=getchar();\n\twhile(c>='0'&&c<='9')x=(x<<3)+(x<<1)+(c^48),c=getchar();\n}\nint main(){\n\tread(n),read(m),read(A),read(B),read(C),memset(f,-1,sizeof(f)),f[0]=0;\n\tfor(int i=1,u,v;i<=m;i++)read(r[i].x),read(r[i].y),read(u),read(v),in[r[i].y].push_back(make_pair(v,i)),out[r[i].x].push_back(make_pair(u,i));\n\tin[1].push_back(make_pair(0,0));\n\tfor(int i=1;i<=n;i++){\n\t\tsort(in[i].begin(),in[i].end()),sort(out[i].begin(),out[i].end());\n\t\tfor(int j=0;j<in[i].size();j++)r[in[i][j].second].v=j;\n\t\tfor(int j=0;j<out[i].size();j++)r[out[i][j].second].u=j;\n\t}\n\tfor(auto x:in[n])ans=min(ans,dfs(x.second)+x.first);\n//\tfor(int i=1;i<=n;i++)printf(\"%d:%lld\\n\",i,f[i]);\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n} \n```\n",
        "postTime": 1590207706,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6302 \u3010[NOI2019]\u56de\u5bb6\u8def\u7ebf \u52a0\u5f3a\u7248\u3011"
    },
    {
        "content": "[\u9898\u9762(\u6d1b\u8c37\u52a0\u5f3a\u7248)](https://www.luogu.com.cn/problem/P6302)\n\n[\u9898\u9762(\u539f\u7248)](https://www.luogu.com.cn/problem/P5468)\n\n## \u66b4\u529b\n\n\u8003\u8651$\\mathcal{O(m*\\max(q))}$\u7684\u66b4\u529b\u3002$dp_{x,t}$\u8868\u793a\u8282\u70b9$x$\u521a\u521a\u5230\u8fbe$t$\u65f6\u5019\u7684\u70e6\u8e81\u503c\uff08\u4e0d\u8003\u8651\u90a3\u4e2a\u5230\u8fbe\u65f6\u95f4\uff09\u3002\u628a\u8fb9\u6309\u7167P\u6216\u8005Q\u6392\u5e8f\u3002\u5bf9\u4e8e\u6bcf\u4e00\u6761\u8fb9$(x,y,p,q)$\uff1a\n\n$$\ndp_{y,q}=\\min (dp_{y,q},dp_{x,t}+A(p-t)^2+B(p-t)+C),t\\le p$$\n\n$$\nans=\\min(dp_{n,t}+t)\n$$\n\n\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u8fc7\u539f\u7248\u4e86\u3002\n\n## \u659c\u7387\u4f18\u5316\n\n\u66b4\u529b\u7684\u7a7a\u95f4\u590d\u6742\u5ea6\u663e\u7136\u4f1aGG\uff0c\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u771f\u5b9e\u6709\u6548\u7684dp\u503c\u4e0d\u4f1a\u8d85\u8fc7m\u4e2a\uff0c\u8fd9\u5c31\u7ed9\u6211\u4eec\u4f18\u5316\u7684\u7a7a\u95f4\u3002\n\n~~\u4e0d\u7528\u8bf4\u600e\u4e48\u60f3\u5230\u659c\u7387\u4f18\u5316\u4e86\u5427~~\n\n\u659c\u7387\u4f18\u5316\uff1a\u628a**\u628a$pt$\u9879\u79fb\u5230\u7b49\u5f0f\u4e00\u4fa7\u6784\u6210$kx$\uff0c\u628a\u53ea\u548ct\u6709\u5173\u7684\u9879\u79fb\u5230\u7b49\u5f0f\u53e6\u4e00\u4fa7\u4f5c\u4e3a$y$\uff0c\u5269\u4e0b\u7684\u6784\u6210$b$**\u3002\n\n$$\ndp_{y,q}=dp_{x,t}+A(p-t)^2+B(p-t)+C\n$$\n\n$$\ndp_{y,q}+(2Ap)*t=(dp_{x,t}+At^2-Bt)+(Ap^2+Bp+C)\n$$\n\n\u51e0\u4f55\u610f\u4e49\uff1a\u8868\u793a\u659c\u7387\u4e3a$k=2Ap$\uff0c\u8fc7\u70b9$(t,dp_{x,t}+At^2-Bt)$\u7684\u659c\u7387\u7684**\u6700\u5c0f\u622a\u8ddd**\uff0c\u52a0\u4e0a\u4e00\u4e2a$(Ap^2+Bp+C)$\u5c31\u662f$dp_{y,q}$\u7684\u503c\u3002\u6211\u4eec\u7ef4\u62a4**\u4e0b\u51f8\u5305**\uff0c\u82e5\u4e00\u4e2a\u70b9\u5de6\u4fa7\u659c\u7387$\\le k$\uff0c\u53f3\u4fa7\u659c\u7387$>k$,\u8fd9\u4e2a\u70b9\u5c31\u662f\u6700\u4f18\u8f6c\u79fb\u70b9\u3002\n\n\u659c\u7387\u662f$2Ap$\uff0c\u6240\u4ee5\u6211\u4eec\u628a\u8fb9\u6309\u7167$p$\u6392\u5e8f\uff0c\u5c31\u53ef\u4ee5\u7528**\u5355\u8c03\u961f\u5217**\u7ef4\u62a4\u51f8\u5305.\u5de6\u4fa7\u5f39\u51fa\u659c\u7387$\\le2Ap$\u7684\u70b9\uff0c\u53f3\u4fa7\u5f39\u51fa\u4e0d\u7b26\u5408\u51f8\u5305\u6027\u8d28\u7684\u70b9\u3002\n\n\u4f46\u662f\u6211\u4eec\u8fd8\u6709\u4e00\u4e2a\u9650\u5236$t\\le p$\uff01\uff01\uff01\n\n\u8fd9\u91cc\u849f\u84bb\u7684\u5904\u7406\u529e\u6cd5\u4f7f\u5f97\u7a0b\u5e8f\u5e26\u4e0a\u4e86\u4e00\u4e2a$log$\u3002\n\n\u6211\u4eec\u628a\u6bcf\u4e2a\u8282\u70b9\u7684dp\u503c\u7528\u5c0f\u6839\u5806\u7ef4\u62a4\uff0c\u9700\u8981\u67e5\u8be2dp\u503c\u7684\u65f6\u5019\uff0c\u5c31\u4e0d\u505c\u7684\u53d6\u51fa\u8fd9\u4e2a\u5c0f\u6839\u5806\u7684\u5806\u9876\uff0c\u76f4\u5230\u5806\u9876\u7684$t>p$\u6216\u8005\u5806\u4e3a\u7a7a\uff0c\u7136\u540e\u628a\u53d6\u51fa\u8282\u70b9\u63d2\u5165\u5230\u5355\u8c03\u961f\u5217\u91cc\u3002\n\n$\\mathcal{O(m logm)}$\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int N = 100010 , P = 40005;\n\nstruct Edge {int x , y , p , q;};\nvector<Edge> edge[P];\n\ntypedef long long int64;\nconst long long inf = 1e18;\nint64 A , B , C , n , m , ans = inf;\n\nstruct Point {\n    int64 x , y;\n    Point() {}\n    Point(int64 t , int64 dp) {\n        x = t;\n        y = dp + A * t * t - B * t;\n    }\n    bool operator < (const Point &b) const {\n        return x > b.x;\n    }\n};\ndouble slope(Point a , Point b) {\n    if(a.x != b.x) return (double)(b.y - a.y) / (b.x - a.x);\n    return a.y < b.y ? 1e18 : -1e18;\n}\n\nstruct Node {\n    deque<Point> dp;\n    priority_queue<Point> wait;\n\n    int64 query(int p) {\n        while(wait.size() && wait.top().x <= p) {\n            Point now = wait.top() ;\n            wait.pop();\n            while(dp.size() >= 2 && slope(dp[dp.size() - 2] , dp.back()) >= slope(dp.back() , now))\n                dp.pop_back();\n            dp.push_back(now);\n        }\n        if(dp.empty()) return inf;\n        int64 k = 2 * A * p;\n        while(dp.size() >= 2 && slope(dp.front() , dp[1]) <= k)\n            dp.pop_front();\n        return A * p * p + B * p + C + (dp.front().y - k * dp.front().x);\n    }\n    void insert(int64 t , int64 dp) {wait.push(Point(t , dp));}\n} DP[N];\n\ntemplate<typename _T>\ninline void read(_T &x) {\n    x = 0 ; char c = getchar(); bool f = 0;\n    while(c < '0' || c > '9') f |= (c=='-') , c = getchar();\n    while(c >= '0' && c <= '9') x = x * 10 + (c^48) , c = getchar();\n    if(f) x = -x;\n}\ntemplate<typename _T , typename... Args>\ninline void read(_T &x , Args&... args) {\n    read(x) , read(args...);\n}\n\nint main() {\n    read(n , m , A , B , C);\n    int T = -1e9;\n    for(int i = 1 ; i <= m ; ++i) {\n        Edge e;\n        read(e.x , e.y , e.p , e.q);\n        edge[e.p].push_back(e);\n        T = max(T , e.p);\n    }\n    DP[1].insert(0 , 0);\n    for(int i = 0 ; i <= T ; ++i)\n        for(auto &e : edge[i]) {\n            int64 val = DP[e.x].query(e.p);\n            if(val >= inf) continue;\n            DP[e.y].insert(e.q , val);\n            if(e.y == n) ans = min(ans , e.q + val);\n        }\n    cout << ans << endl;\n    return 0;\n}\n```",
        "postTime": 1587635127,
        "uid": 138511,
        "name": "GreenDay",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P6302 [NOI2019]\u56de\u5bb6\u8def\u7ebf \u52a0\u5f3a\u7248"
    },
    {
        "content": "\u663e\u7136\u53ef\u4ee5 DP\u3002\u5217\u51fa\u4e00\u4e2a\u663e\u7136\u7684\u65b9\u7a0b\uff1a\n\n$$f_{i,p} = \\min_{(i,j,t,p)\\in P, q \\in [0, p]}\\{f_{j,q} + A(p-q)^2 + B(p-q) + C\\}$$\n\n\u5176\u4e2d $P$ \u4e3a\u5927\u5c0f\u4e3a $m$ \u7684\u56db\u5143\u7ec4\u7684\u96c6\u5408\uff0c\u63cf\u8ff0\u6bcf\u4e2a\u5217\u8f66\u3002\u6ce8\u610f\u5230\u603b\u5171\u7684\u72b6\u6001\u6570\u662f $O(m)$ \u7684\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u4f18\u5316\u679a\u4e3e $q$ \u4e5f\u5c31\u662f\u679a\u4e3e\u4e0a\u6b21\u5217\u8f66\u7684\u90e8\u5206\u3002\n\n\u5957\u8def\u5730\u8003\u8651\u674e\u8d85\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u5373\u5bf9\u6bcf\u4e2a $j$ \u52a8\u6001\u5f00\u70b9\u4e00\u4e2a\u674e\u8d85\u6811\u4f7f\u5f97\u5bf9\u4e8e\u6bcf\u4e2a $q$ \u63d2\u5165\u4e00\u6761\u76f4\u7ebf\u8fdb $b = f_{j,q} + Aq^2 - Bq, k = q$\uff0c\u6bcf\u6b21\u67e5\u8be2 $x = -2Ap$ \u4e0a $y = f_{i,p} - Bp - C - Ap^2$ \u7684\u6700\u5c0f\u503c\u3002\n\n\u53e6\u5916\u4e3a\u4e86\u4fdd\u8bc1 $q\\le p$\uff0c\u53ef\u4ee5\u5bf9\u6240\u6709\u5217\u8f66\u6309\u7167 $p,q$ \u5206\u522b\u6392\u5e8f\uff0c\u53cc\u6307\u9488\u626b\u63cf\u5e76\u6bcf\u6b21\u628a\u4e0d\u8d85\u8fc7\u5f53\u524d $p$ \u7684 $q$ \u5bf9\u5e94\u7684\u76f4\u7ebf\u63d2\u5165\u5230\u5bf9\u5e94\u7684\u674e\u8d85\u6811\u4e2d\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(m\\log m)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(m)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int maxn = 400005;\ntypedef long long ll;\nconst ll inf = 0x3f3f3f3f3f3f3f3f;\nint n, m;\nstruct Path {\n\tint x, y, p, q;\n\tll s;\n} p[maxn];\n// \u6c42\u6700\u5c0f\u503c\u7684 wjx \u6811\nnamespace LiCT {\n\tstruct Line {\n\t\tll k, b;\n\t} ln[maxn];\n\tint cnt, tot, t[maxn * 100], ls[maxn * 100], rs[maxn * 100];\n\tll calc(int x, int i) {\n\t\treturn ln[i].k * x + ln[i].b;\n\t}\n\tvoid update(int &p, int l, int r, int x) {\n\t\tif (!p) p = ++tot;\n\t\tif (!t[p]) return t[p] = x, void();\n\t\tint mid = (l + r) / 2;\n\t\tif (calc(mid, x) < calc(mid, t[p])) swap(t[p], x);\n\t\tif (calc(l, x) < calc(l, t[p])) update(ls[p], l, mid, x);\n\t\tif (calc(r, x) < calc(r, t[p])) update(rs[p], mid + 1, r, x);\n\t}\n\tll query (int p, int l, int r, int x) {\n\t\tif (x < l || x > r) exit(44);\n\t\tif (!p) return inf;\n\t\tll res = calc(x, t[p]);\n\t\tif (l == r) return res;\n\t\tint mid = (l + r) / 2;\n\t\tif (x <= mid) return min(res, query(ls[p], l, mid, x));\n\t\telse return min(res, query(rs[p], mid + 1, r, x));\n\t}\n\tinline void insert(int &rt, ll k, ll b) {\n\t\tln[++cnt] = {k, b}, update(rt, -maxn, 0, cnt);\n\t}\n}\nint t1[maxn], t2[maxn];\nll f[maxn], g[maxn], A, B, C;\nint rt[maxn];\nbool cmp1(int x, int y) { return p[x].p < p[y].p; }\nbool cmp2(int x, int y) { return p[x].q < p[y].q; }\nsigned main() {\n\tscanf(\"%d%d%d%d%d\", &n, &m, &A, &B, &C);\n\tfor (int i = 1; i <= m; ++i) {\n\t\tscanf(\"%d%d%d%d\", &p[i].x, &p[i].y, &p[i].p, &p[i].q);\n\t\tt1[i] = t2[i] = i;\n\t}\n\tsort(t1 + 1, t1 + 1 + m, cmp1), sort(t2 + 1, t2 + 1 + m, cmp2);\n\tmemset(f, 0x3f, sizeof(f));\n\tmemset(g, 0x3f, sizeof(g));\n\tf[1] = g[1] = 0, LiCT::insert(rt[1], 0, 0);\n\t// \u6309 p \u6392\u5e8f\uff0c\u53cc\u6307\u9488\u4e00\u76f4\u52a0\u5c0f\u4e8e p \u7684 q \u5230\u5bf9\u5e94\u96c6\u5408\n\tfor (int i = 1, j = 0; i <= m; ++i) {\n\t\twhile (j < m && p[t2[j + 1]].q <= p[t1[i]].p) {\n\t\t\t++j;\n\t\t\tPath k = p[t2[j]];\n\t\t\tLiCT::insert(rt[k.y], k.q, k.s + A * k.q * k.q - B * k.q);\n\t\t}\n\t\tPath &k = p[t1[i]];\n\t\tll tmp = LiCT::query(rt[k.x], -maxn, 0, -2 * A * k.p) + (B * k.p + C + A * k.p * k.p);\n\t\tk.s = tmp, f[k.y] = min(f[k.y], tmp), g[k.y] = min(g[k.y], tmp + k.q);\n\t}\n\tprintf(\"%lld\", g[n]);\n\treturn 0;\n}\n```",
        "postTime": 1682233759,
        "uid": 62440,
        "name": "MuelsyseU",
        "ccfLevel": 0,
        "title": "P6302 [NOI2019] \u56de\u5bb6\u8def\u7ebf \u9898\u89e3"
    },
    {
        "content": "\u7b2c\u4e00\u4e2a\u60f3\u6cd5\u662f\u4ee5\u8f66\u7ad9\u4e3a\u9636\u6bb5\u8fdb\u884c\u8f6c\u79fb\uff0c\u4f46\u662f\u4e00\u65e6\u4ee5\u8f66\u7ad9\u4e3a\u9636\u6bb5\u5c31\u5fc5\u987b\u8981\u5e26\u4e0a\u3010\u5f53\u524d\u65f6\u95f4\u3011\u8fd9\u4e2a\u72b6\u6001\uff0c\u663e\u7136\u4e0d\u884c\uff0c\u53ea\u6709 70 \u5de6\u53f3\u3002\n\n\u6709\u4e9b\u601d\u8def\u4f46\u4e0d\u660e\u6670\uff0c\u4e8e\u662f\u5148\u770b\u90e8\u5206\u5206\u3002\n\n\u53d1\u73b0 $A=B=0$ \u7684\u90e8\u5206\u5206\u8ddf\u50bb\u5b50\u4e00\u6837\uff0c\u5927\u6982\u60f3\u5230\u7684\u5c31\u662f\uff0c\u53ef\u4ee5\u8bbe $dp_i$ \u8868\u793a\u7684\u662f\u5750\u5230\u7b2c $i$ \u5ea7\u5217\u8f66\u5f00\u59cb\u65f6\u7684\u6700\u5c0f\u70e6\u8e81\u503c\uff0c\u8fd9\u6837\u5176\u5b9e\u5c31\u76f8\u5f53\u4e8e\u662f\u7528\u4e00\u7ef4\u7684\u53d8\u91cf\u6982\u62ec\u4e86\u4e24\u7ef4\u7684\u4fe1\u606f\u3002\u8f6c\u79fb\u65f6\u53ef\u4ee5\u8003\u8651\u7b2c $i$ \u8f86\u5217\u8f66\u7684\u8d77\u59cb\u8f66\u7ad9\uff0c\u5728\u7b2c $i$ \u8f86\u5217\u8f66\u9a76\u51fa\u8f66\u7ad9\u4e4b\u524d\uff0c\u6240\u6709\u4ee5\u5f53\u524d\u8f66\u7ad9\u4e3a\u76ee\u7684\u5730\u7684\u5217\u8f66\uff0c\u5c06\u8fd9\u4e9b\u5217\u8f66\u53d6\u6700\u5c0f\u503c\u5373\u53ef\u8f6c\u79fb\u3002\n\n\u4e8e\u662f\u6b63\u89e3\u5176\u5b9e\u4e5f\u5f88\u660e\u6670\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u4ee5\u5217\u8f66\u65f6\u95f4\u4e3a\u9636\u6bb5\uff0c\u5c06\u6bcf\u4e00\u4e2a\u5217\u8f66\u62c6\u6210\u4e24\u4e2a\uff0c\u5206\u522b\u8868\u793a\u9a76\u5165\u548c\u9a76\u51fa\uff0c\u6302\u5728\u4ed6\u4eec\u5bf9\u5e94\u7684\u65f6\u95f4\u70b9\u4e0a\u3002\u8bbe $dp_i$ \u8868\u793a\u7b2c $i$ \u8f86\u5217\u8f66\u9a76\u51fa\u65f6\u7684\u6700\u5c0f\u70e6\u8e81\u503c\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u65f6\u95f4\u9636\u6bb5\uff0c\u6211\u4eec\u5148\u5c06\u6240\u6709\u5728\u8fd9\u4e2a\u65f6\u95f4\u9a76\u51fa\u7684\u5217\u8f66\u4f5c\u4e3a\u5019\u9009\u51b3\u7b56\u52a0\u5165\u5b83\u4eec\u7684\u76ee\u7684\u5730\u96c6\u5408\u4e2d\uff0c\u518d\u5c06\u6240\u6709\u5728\u8fd9\u4e2a\u65f6\u95f4\u9a76\u5165\u7684\u5217\u8f66\u4f5c\u4e3a\u72b6\u6001\uff0c\u6311\u9009\u51fa\u53d1\u70b9\u7684\u96c6\u5408\u8fdb\u884c\u8f6c\u79fb\u3002\n\n\u53c8\u6ce8\u610f\u5230\u8d21\u732e\u7684\u7279\u6b8a\u8ba1\u7b97\u65b9\u5f0f\uff0c\u8003\u8651\u659c\u7387\u4f18\u5316 dp\uff0c\u7531\u4e8e\u72b6\u6001\u4e4b\u95f4\u4e0e\u51b3\u7b56\u4e4b\u95f4\u7684\u65f6\u95f4\u663e\u7136\u5355\u8c03\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u5355\u8c03\u961f\u5217\u8fdb\u884c\u4f18\u5316\u8f6c\u79fb\u3002\n\n\u6700\u540e\u7528\u6240\u6709\u9a76\u51fa\u8f66\u7ad9\u4e3a $n$ \u7684\u51b3\u7b56\u66f4\u65b0\u7b54\u6848\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(m)$\u3002\u597d\u50cf\u5e76\u4e0d\u9700\u8981\u4ec0\u4e48\u5806\u8fdb\u884c\u8f85\u52a9\u8f6c\u79fb\uff08\n\n\u4e0d\u8fc7\u6709\u4ebf\u4e9b\u7ec6\u8282\u9700\u8981\u6ce8\u610f\uff1a\n\n- \u659c\u7387\u53ef\u80fd\u76f8\u540c\uff0c\u6b64\u65f6\u4ee5 $b$ \u7684\u5927\u5c0f\u4e3a\u51c6\u3002\n- \u5bf9\u4e8e\u6bcf\u4e2a\u8f66\u7ad9\u5f00\u5355\u8c03\u961f\u5217\u663e\u7136\u7a7a\u95f4\u4e0d\u8db3\uff0c\u4f46\u6bcf\u4e2a\u8f66\u7ad9\u7684\u5355\u8c03\u961f\u5217\u957f\u5ea6\u6052\u5b9a\uff0c\u53ef\u4ee5\u8003\u8651\u7528\u4e00\u4e2a\u5355\u8c03\u961f\u5217\u5185\u5b58\u6c60\u5b58\u50a8\u6240\u6709\u5355\u8c03\u961f\u5217\u3002\n- \u5e76\u6ca1\u6709\u4fdd\u8bc1\u5217\u8f66\u4e00\u5b9a\u4ece\u5de6\u5230\u53f3\u884c\u9a76\uff0c\u521a\u5f00\u59cb\u6ca1\u770b\u89c1\u8c03\u4e86\u4e00\u4e0b\u5348\u2026\u2026\n\n```cpp\nfor (int i=1;i<=m;i++){\n\tint a=read(),b=read(),c=read(),d=read();\n\tt[d].push_back(node(b,i)),s[c].push_back(node(a,i));\n\tzz[i]=d,++tot[b];\n}\ntot[1]=1;\nfor (int i=1;i<=n;i++) tot[i]+=tot[i-1],head[i]=tot[i-1]+1,tail[i]=tot[i-1];\nt[0].push_back(node(1,0));\nfor (int i=0;i<=40000;i++){\n\tint len1=t[i].size(),len2=s[i].size();\n\tfor (int j=0;j<len1;j++){\n\t\tint now=t[i][j].q;\n\t\tif (now==n) ans=min(ans,dp[t[i][j].id]+zz[t[i][j].id]);\n\t\tif (dp[t[i][j].id]!=INF){\n\t\t\twhile (head[now]<tail[now]&&slope(q[tail[now]-1],q[tail[now]])>=slope(q[tail[now]],t[i][j].id)) --tail[now];\n\t\t\tq[++tail[now]]=t[i][j].id;\t\n\t\t}\n\t}\n\tfor (int j=0;j<len2;j++){\n\t\tint now=s[i][j].q;\n\t\twhile (head[now]<tail[now]&&slope(q[head[now]],q[head[now]+1])<=2*x*i) ++head[now];\n\t\tif (head[now]>tail[now]) dp[s[i][j].id]=INF;\n\t\telse{\n\t\t\tint w=q[head[now]];\n\t\t\tdp[s[i][j].id]=dp[w]+x*(i-zz[w])*(i-zz[w])+y*(i-zz[w])+z;\n\t\t}\n\t}\n}\n```\n\n\u597d\u50cf\u8fd8\u8fdb\u4e86\u6700\u4f18\u89e3\u7b2c\u4e00\u9875\uff0c\u770b\u6765\u8fd9\u4e2a\u89e3\u6cd5\u8fd8\u4e0d\u9519\uff08",
        "postTime": 1664888300,
        "uid": 257621,
        "name": "\u7ffc\u5fb7\u5929\u5c0a",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 [NOI2019] \u56de\u5bb6\u8def\u7ebf \u52a0\u5f3a\u7248"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P6302)\n\n\u672c\u9898\u4e3a[P5468](https://www.luogu.com.cn/problem/P5468)\u7684\u52a0\u5f3a\u7248\uff0c\u91cd\u70b9\u770b\u6570\u636e\u8303\u56f4\uff1a\n\n$$2 \\leq n \\leq 10^5,1 \\leq m\\leq 10^6,0 \\leq p_i \\le q_i \\leq 4 \\times 10^4$$\n\n\u5f53\u7136\u8fd8\u6709\u4e09\u4e2a\u53c2\u6570\uff1a\n\n$$0 \\leq A \\leq 10, 0 \\leq B,C \\leq 10^7$$\n\n\u6ce8\u610f\u5230\u6b64\u65f6 $B$ \u548c $C$ \u5df2\u7ecf\u8d85\u8fc7\u4e86 $10^7$\uff0c\u9700\u8981\u5f00 ```long long```\u3002\u540c\u65f6\u8fd8\u53d1\u73b0 $m \\leq 10^6$\uff0c\u8fd9\u610f\u5473\u7740 $\\text{P5468}$ \u6b63\u89e3\uff08\u5373 $O(m)$ \u7684\u659c\u7387\u4f18\u5316 $\\text{DP}$\uff09\u6539\u4e00\u6539\u5c31\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n\u8fd9\u91cc\u8fd8\u662f\u628a\u659c\u7387\u4f18\u5316 $\\text{DP}$ \u7684\u601d\u8def\u7b80\u5355\u8bf4\u4e00\u4e0b\uff1a\n\n\u8bbe $f_i$ \u8868\u793a\u8d70\u5b8c\u7b2c $i$ \u6761\u8fb9\u6700\u5c0f\u7684\u4ee3\u4ef7\uff0c\u5219\u6709\u66b4\u529b\u8f6c\u79fb\uff1a\n\n$$f_i=\\min \\{ f_j+A \\times (p_i-q_j)^2 + B \\times (p_i-q_j)+C \\}$$\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(mt)$\uff0c\u5176\u4e2d $t=\\max_{i=1}^{m}q_i$\uff0c\u9700\u8981\u4f18\u5316\u3002\n\n\u53d1\u73b0\u8fd9\u4e2a\u65b9\u7a0b\u6709\u5e73\u65b9\u9879\uff0c\u8003\u8651\u5c55\u5f00\uff1a\n\n$$f_j+A \\times q_j^2-B \\times q_j=2\\times A \\times p_i \\times q_j -f_i-A \\times p_i^2-B \\times p_i-C$$\n\n\u628a\u8fd9\u4e2a\u65b9\u7a0b\u770b\u6210\u4e00\u6b21\u51fd\u6570\u6807\u51c6\u5f62\u5f0f $y=kx+b(k \\neq 0)$\uff0c\u5176\u4e2d\uff1a\n\n$$y=f_j+A \\times q_j^2 - B \\times q_j$$\n\n$$k=2 \\times A \\times p_i$$\n\n$$x=q_j$$\n\n$$b=-f_i-A \\times p_i^2-B \\times p_i-C$$\n\n\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u51f8\u58f3\u5373\u53ef\uff0c\u6bcf\u6761\u8fb9\u8fdb\u51fa\u4e00\u6b21\u961f\u5217\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(m)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n\u4ee3\u7801\uff08\u4f7f\u7528\u4e86\u8f83\u591a $\\text{STL}$\uff0c\u53ef\u4ee5\u81ea\u5df1\u5361\u4e00\u5361\u5e38\u6570\uff0c\u6ce8\u610f\u5f00 ```long long```\uff09\uff1a\n\n```cpp\n#include<cstdio>\n#include<vector>\n#include<queue>\nusing namespace std;\ntypedef long long ll;\ntypedef long double ld;\ninline ll read(){\n\tll f=1,x=0;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9') {\n\t\tif(c=='-')f=-1;\n\t\tc=getchar();\n\t}\n\twhile(c>='0'&&c<='9') {\n\t\tx=x*10+c-'0';\n\t\tc=getchar();\n\t}\n\treturn f*x;\n}\ninline void write(ll x){\n\tif(x<0)x=-x,putchar('-');\n\tif(x>9)write(x/10);\n\tputchar(x%10+'0');\n}\ninline ll max(ll x,ll y){\n\treturn x>=y?x:y;\n}\ninline ll min(ll x,ll y){\n\treturn x<=y?x:y;\n} \nconst int N=1e5+10,M=1e6+10,T=4e4+10;\nconst ll oo=1e18;//\u6b63\u65e0\u9650 \nint n,m;\nll A,B,C,x[M],y[M],p[M],q[M];\nstruct point{\n\tll x,y;\n\tint id/*\u5bf9\u5e94\u8fb9\u7684\u7f16\u53f7*/;\n};\nll head[N];\nvector<point> hull[N];\nvector<int> d[T];\nqueue<int> res[T];\nll maxT/*\u5373\u524d\u9762\u5206\u6790\u4e2d\u7684t*/,f[M],ans=oo;\ninline ld get_slope(point a,point b){\n\tll xx=a.x-b.x,yy=a.y-b.y;\n\tif(xx==0){\n\t\tif(yy>0)\n\t\t\treturn 1.0*oo;\n\t\telse\n\t\t\treturn -oo*1.0;\n\t}\n\treturn (1.0*yy)/(1.0*xx);\n}\ninline void insert(int id){\n\tint pos=y[id];\n\tpoint new_one=(point){q[id],f[id]+A*q[id]*q[id]-B*q[id],id};\n\twhile(hull[pos].size()-head[pos]>=2){\n\t\tint siz=hull[pos].size();\n\t\tif(get_slope(hull[pos][siz-1],hull[pos][siz-2])<get_slope(hull[pos][siz-2],new_one))\n\t\t\tbreak;\n\t\thull[pos].pop_back();\n\t}\n\thull[pos].push_back(new_one);\n} \ninline void _delete(ld k,int pos){\n\twhile(hull[pos].size()-head[pos]>=2){\n\t\tif(k<get_slope(hull[pos][head[pos]],hull[pos][head[pos]+1]))\n\t\t\tbreak;\n\t\thead[pos]++;\n\t}\n}\nint main(){\n\tn=read(),m=read(),A=read(),B=read(),C=read();\n\tfor(int i=1;i<=m;i++){\n\t\tx[i]=read(),y[i]=read(),p[i]=read(),q[i]=read();\n\t\tif(maxT<q[i])\n\t\t\tmaxT=q[i];\n\t}\n\tfor(int i=1;i<=m;i++)\n\t\td[p[i]].push_back(i);\n\thull[1].push_back((point){0,0,0});\n\tfor(int t=0;t<=maxT;t++){\n\t\twhile(!res[t].empty()){\n\t\t\tinsert(res[t].front());\n\t\t\tres[t].pop();\t\t\t\n\t\t}\n\t\tld k;\n\t\tfor(int _=0,i,j,pos;_<d[t].size();_++){\n\t\t\ti=d[t][_],pos=x[i];\n\t\t\tif(head[pos]==hull[pos].size())//\u961f\u5217\u4e3a\u7a7a \n\t\t\t\tcontinue;\n\t\t\tk=2.0*A*p[i];\n\t\t\t_delete(k,pos);\n\t\t\tj=hull[pos][head[pos]].id;\n\t\t\tf[i]=f[j]+A*(p[i]-q[j])*(p[i]-q[j])+B*(p[i]-q[j])+C;\n\t\t\tres[q[i]].push(i);\n\t\t\tif(y[i]==1ll*n)//\u8d70\u5230\u7ec8\u70b9 \n\t\t\t\tans=min(ans,f[i]+q[i]);\n\t\t}\n\t}\n\t\n\treturn 0;\n}\n```",
        "postTime": 1655305663,
        "uid": 545529,
        "name": "Sherlock_Chen",
        "ccfLevel": 5,
        "title": "P6302 [NOI2019] \u56de\u5bb6\u8def\u7ebf \u52a0\u5f3a\u7248"
    },
    {
        "content": "# \u8f6c\u79fb\n\u9996\u5148\u8fd9\u9898\u72b6\u6001\u5c31\u4e0d\u592a\u597d\u8bbe\u3002\u540c\u65f6\u517c\u987e\u70b9\u548c\u65f6\u95f4\u7684\u8bdd\uff0c\u7a7a\u95f4\u7a33\u7a33\u70b8\u3002\n\n\u4e8e\u662f\u53c2\u8003\u4e86\u4e00\u4e0b\u5176\u4ed6\u9898\u89e3\uff0c\u53d1\u73b0\u53ef\u4ee5\u76f4\u63a5\u7528\u8fb9\u540c\u65f6\u8868\u793a\u70b9\u548c\u65f6\u95f4\uff08\u4e5f\u662f\u4ee5\u540e\u505a\u9898\u5bf9\u4e8e\u8bbe\u72b6\u6001\u7684\u4e00\u79cd\u65b0\u601d\u8def\u5427\uff09\u3002\n\n\u8bbe $dp[i]$ \u8868\u793a**\u6700\u540e\u7ecf\u8fc7\u7684\u8fb9\u4e3a\u7b2c $i$ \u6761\u8fb9**\u7684\u6700\u5c0f\u70e6\u8e81\u503c\uff08\u8bb0\u5f97\u6700\u540e\u8fd8\u8981\u52a0\u4e0a $q[i]$\uff09\u3002\n$$\n\\text{\u8fb9\u754c\uff1a}dp[0]=0\n$$\n$$\n\\text{\u7b54\u6848\uff1a}\\min_{y[i]=n}(dp[i])\n$$\n$$\ndp[i]=\\min_{x[i]=y[j]\\land q[j]\\leq p[i]}(dp[j]+A(p[i]-q[j])^2+B(p[i]-q[j])+C-q[j]+q[i])\n$$\n\n# \u659c\u7387\u4f18\u5316\n\n\u5047\u5b9a $dp[i]$ \u7531 $dp[j]$ \u8f6c\u79fb\u8fc7\u6765\uff0c\u8fd9\u5c31\u662f\u6807\u51c6\u7684\u659c\u7387\u4f18\u5316\u5f0f\u5b50\u3002\n\n\u6211\u4eec\u6309\u7167\u659c\u4f18\u7684\u4e00\u822c\u5957\u8def\u53d8\u5f62\uff0c\u8bbe $D$ \u548c $E$\uff0c\u628a\u548c $j$ \u6709\u5173\u7684\u90fd\u653e\u5230 $D$ \u4e2d\uff0c\u628a \u548c $i$ \u6709\u5173\u7684\u90fd\u653e\u5230 $E$ \u4e2d\u3002\n\n$$\ndp[i]=dp[j]+Ap[i]^2-2Ap[i]q[j]+Aq[j]^2+Bp[i]-Bq[j]+C-q[j]+q[i]\n$$\n$$\nD=dp[j]+Aq[j]^2-Bq[j]+C-q[j]\n$$\n$$\nE=Ap[i]^2+Bp[i]+q[i]\n$$\n\n\u6700\u7ec8\u53d8\u6210 $y=kx+b$ \u7684\u5f62\u5f0f\n$$\nD=(2Ap[i])q[j]+(dp[i]-E)\n$$\n\n\u8981\u4f7f\u5f97 $dp[i]$ \u6700\u5c0f\uff0c\u5c31\u662f\u7ef4\u62a4\u51f8\u5305 $(q[j],D)$\uff0c\u4f7f\u5f97\u659c\u7387\u4e3a $2Ap[i]$ \u7684\u76f4\u7ebf\u7eb5\u622a\u8ddd\u6700\u5c0f\u3002\n\n\u6309 $p[i]$ \u6392\u5e8f\u540e\uff0c\u76f4\u7ebf\u659c\u7387\u5355\u8c03\u9012\u589e\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u53cc\u7aef\u961f\u5217\u89e3\u51b3\u95ee\u9898\u3002\n\n# \u9650\u5236\n\u81f3\u6b64\u8fd8\u6ca1\u6709\u505a\u5b8c\u3002\u53ea\u6709\u6ee1\u8db3 $x[i]=y[j]\\land q[j]\\leq p[i]$ \u7684 $dp[j]$ \u624d\u80fd\u8f6c\u79fb\u5230 $dp[i]$\u3002\n\n\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a\u5730\u70b9\u5f00\u4e00\u4e2a\u53cc\u7aef\u961f\u5217\uff0c\u628a $j$ \u4ee3\u8868\u7684\u51b3\u7b56\u70b9\u63d2\u5165 $y[j]$ \u7684\u53cc\u7aef\u961f\u5217\u4e2d\uff0c\u8ba1\u7b97 $dp[i]$ \u65f6\u53ea\u4ece $x[i]$ \u7684\u53cc\u7aef\u961f\u5217\u4e2d\u9009\u62e9\u51b3\u7b56\u70b9\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u7b2c\u4e00\u4e2a\u9650\u5236\u3002\n\n\u7b2c\u4e8c\u4e2a\u9650\u5236\uff0c\u6211\u7684\u505a\u6cd5\u662f\u5f00\u4e00\u4e2a priority_queue\uff0c\u6309 $q$ \u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u3002\u5728\u8ba1\u7b97 $dp[i]$ \u4e4b\u524d\uff0c\u5148\u628a\u4f18\u5148\u961f\u5217\u4e2d\u6240\u6709 $q\\leq p[i]$ \u7684\u51b3\u7b56\u70b9\u63d2\u5165\u5bf9\u5e94\u7684\u53cc\u7aef\u961f\u5217\u3002\u8ba1\u7b97\u5b8c\u4e4b\u540e\uff0c\u518d\u628a $i$ \u4ee3\u8868\u7684\u51b3\u7b56\u70b9\u4e22\u5165\u4f18\u5148\u961f\u5217\u4e2d\u3002\n\n\u5982\u6b64\uff0c\u6240\u6709\u53ef\u7528\u7684\u51b3\u7b56\u70b9\u90fd\u5df2\u7ecf\u63d2\u5165\uff0c\u800c\u5f53\u524d\u4e0d\u53ef\u7528\u7684\u51b3\u7b56\u70b9\u5728\u4f18\u5148\u961f\u5217\u4e2d\u4fdd\u5b58\u3002\n\n# Code\n\u8fd9\u91cc\u4f7f\u7528 vector \u548c\u8fed\u4ee3\u5668\u4ee3\u66ff\u4e0a\u8ff0\u7684\u53cc\u7aef\u961f\u5217\u3002\n\n\u5c0f\u5751\uff1a\u7531\u4e8e\u4e24\u6761\u8fb9\u7684 $q$ \u53ef\u80fd\u76f8\u7b49\uff0c\u659c\u7387\u53ef\u80fd\u51fa\u73b0 $+\\infty$ \u6216 $-\\infty$ \u7684\u60c5\u51b5\uff0c\u63d0\u524d\u5224\u4e00\u4e0b\u3002**\u7ef4\u62a4\u7684\u662f\u4e0b\u51f8\u58f3\uff0c\u4e00\u5b9a\u662f\u540e\u52a0\u5165\u7684\u70b9\u6bd4\u65b0\u52a0\u5165\u7684\u70b9\u9ad8\u65f6\u8fd4\u56de $+\\infty$\uff0c\u53cd\u4e4b\u8fd4\u56de $-\\infty$\uff0c\u4e0d\u8981\u641e\u53cd\u4e86**\u3002\n\n**\u8bb0\u5f97\u6700\u5f00\u59cb\u9884\u5148\u628a\u8fb9\u754c\u51b3\u7b56\u70b9 $0$ \u63d2\u5165 $1$ \u53f7\u70b9\u7684\u53cc\u7aef\u961f\u5217\u4e2d\uff08\u56e0\u4e3a\u8d77\u70b9\u662f $1$ \u53f7\u70b9\uff09\u3002\u5982\u679c\u904d\u5386\u5230\u67d0\u6761\u8fb9\u65f6\u4e0d\u80fd\u4ece\u4efb\u4f55\u51b3\u7b56\u70b9\u8f6c\u79fb\u8fc7\u6765\uff0c\u8bf4\u660e\u65e0\u6cd5\u4e58\u5750\u8be5\u822a\u73ed\uff0c$dp$ \u503c\u8bbe\u4e3a $\\inf$**\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef pair<int,int> pii;\nconst ll inf=1e16;\nint n,m,A,B,C;\nll dp[1000005],ans=inf;\nvector<int>q[100005];\npriority_queue<pii,vector<pii>,greater<pii> >wait;\nnamespace io{\n\tint out[22];\n\ttemplate<typename T>inline void read(T &n){\n\t\tT w=1;n=0;char ch=getchar();\n\t\twhile(!isdigit(ch)&&ch!=EOF){if(ch=='-')w=-1;ch=getchar();}\n\t\twhile(isdigit(ch)&&ch!=EOF)n=(n<<3)+(n<<1)+(ch&15),ch=getchar();\n\t\tn*=w;\n\t}\n\tinline void write(ll x){\n\t\tif(!x){putchar('0');return;}\n\t\tif(x<0){putchar('-');x=-x;}\n\t\twhile(x)out[++out[0]]=x%10,x/=10;\n\t\twhile(out[0])putchar(out[out[0]]+'0'),out[0]--;\n\t}\n}using namespace io;\nstruct star{\n\tint x,y,p,q;\n}track[1000005];\ninline bool cmp(star a,star b){\n\treturn a.p==b.p?a.x<b.x:a.p<b.p;\n}\ninline ll D(int id){\n\tint ed=track[id].q;\n\treturn dp[id]+1ll*A*ed*ed-1ll*B*ed+C-ed;\n}\ninline ll E(int id){\n\tint st=track[id].p,ed=track[id].q;\n\treturn 1ll*A*st*st+1ll*B*st+ed;\n}\ninline double slope(int a,int b){//\u8ba1\u7b97\u659c\u7387 \n\tif(track[a].q==track[b].q){\n\t\tif(D(b)>D(a))return inf;\n\t\tif(D(b)==D(a))return 0;\n\t\tif(D(b)<D(a))return -inf;\n\t}\n\treturn 1.0*(D(b)-D(a))/(track[b].q-track[a].q);\n}\nint main(){\n\tread(n),read(m),read(A),read(B),read(C);\n\tfor(int i=1;i<=m;++i)read(track[i].x),read(track[i].y),read(track[i].p),read(track[i].q);\n\tsort(track+1,track+m+1,cmp);//\u6309p\u6392\u5e8f \n\ttrack[0]=(star){0,1,0,0},q[1].push_back(0);//\u63d2\u5165\u8fb9\u754c \n\tfor(int i=1;i<=m;++i){\n\t\twhile(wait.size()&&wait.top().first<=track[i].p){//\u9884\u5148\u628a\u4f18\u5148\u961f\u5217\u4e2d\u5408\u9002\u7684\u51b3\u7b56\u70b9\u63d2\u5165 \n\t\t\tint id=wait.top().second,bel=track[id].y;\n\t\t\twait.pop();\n\t\t\tauto tail=--q[bel].end(),tmp=--(--q[bel].end());\n\t\t\twhile(q[bel].size()>1&&slope(*tail,id)<=slope(*tmp,*tail))//\u961f\u5c3e\u5220\u70b9 \n\t\t\tq[bel].erase(tail),tail=--q[bel].end(),tmp=--(--q[bel].end());\n\t\t\tq[bel].push_back(id);\n\t\t}\n\t\tint bel=track[i].x;\n\t\tauto head=q[bel].begin(),tmp=++q[bel].begin();\n\t\twhile(q[bel].size()>1&&slope(*head,*tmp)<=2ll*A*track[i].p)//\u961f\u9996\u5220\u70b9 \n\t\tq[bel].erase(head),head=q[bel].begin(),tmp=++q[bel].begin();\n\t\tif(head!=q[bel].end()){\n\t\t\tdp[i]=D(*head)+E(i)-2ll*A*track[i].p*track[*head].q;//\u8f6c\u79fb \n\t\t\twait.push(make_pair(track[i].q,i));//\u4e22\u5165\u4f18\u5148\u961f\u5217 \n\t\t}else dp[i]=inf;//\u65e0\u6cd5\u8f6c\u79fb\u5230dp[i]\uff0c\u4e5f\u65e0\u9700\u4e22\u5165\u4f18\u5148\u961f\u5217 \n\t}\n\tfor(int i=1;i<=m;++i)if(track[i].y==n)ans=min(ans,dp[i]);//\u8ba1\u7b97\u7b54\u6848 \n\twrite(ans);return 0;\n}\n```\n",
        "postTime": 1655082048,
        "uid": 148226,
        "name": "Fan_sheng",
        "ccfLevel": 6,
        "title": "P6302 [NOI2019] \u56de\u5bb6\u8def\u7ebf \u52a0\u5f3a\u7248"
    },
    {
        "content": "\u5728\u6211\u7684\u535a\u5ba2\u56ed\u67e5\u770b\uff1ahttps://www.cnblogs.com/suxxsfe/p/13238077.html  \n\n[\u539f\u9898P5468](https://www.luogu.com.cn/problem/P5468)\uff0c[\u6d1b\u8c37\u52a0\u5f3a\u7248P6302](https://www.luogu.com.cn/problem/P6302)\uff0c[LOJ3156](https://loj.ac/problem/3156)  \n\u542c\u8bf4\u539f\u9898\u662f\u7528\u811a\u9020\u7684\u6570\u636e\uff0c\u6240\u4ee5\u53ef\u80fd\u65e0\u6cd5\u628a\u4ee3\u7801\u7684\u9505\u90fd\u6d4b\u51fa\u6765\uff0c\u6240\u4ee5\u8fd8\u662f\u53bb\u52a0\u5f3a\u7248\u5427  \n\u505a\u4e86\u597d\u957f\u65f6\u95f4\uff0c\u4e3b\u8981\u662f\u539f\u7248\u5f97\u5206\u7384\u5b66\uff0c\u6709\u7684\u65f6\u5019\u628a\u4ee3\u7801\u4e00\u4e2a\u5730\u65b9\u6539\u9519\u751a\u81f3\u5f97\u4e86\u66f4\u591a\u7684\u5206\uff08\u5f53\u65f6\u540c\u65f6\u8fd8\u5b58\u5728\u5176\u5b83\u7684\u9519\uff09\uff1f/jk\uff0c\u7136\u540e\u52a0\u5f3a\u7248\u53c8\u88ab\u5361\u5e38/kk  \n\n\u659c\u7387\u4f18\u5316dp+vector \u7ef4\u62a4\u51f8\u5305+\u5806\u7ef4\u62a4\u8fd8\u6ca1\u653e\u5165\u51f8\u5305\u7684\u70b9  \n\n\u9996\u5148\u60f3\u600e\u4e48\u8bbe\u8ba1\u72b6\u6001\uff0c\u4e00\u5f00\u59cb\u60f3\u7684\u662f $f_{i,j}$ \u8868\u793a\u65f6\u95f4 $i$\uff0c\u521a\u8fbe\u5230\u8f66\u7ad9 $j$\uff0c\u7684\u6700\u5c0f\u70e6\u8e81\u503c  \n\u4f46\u8fd9\u6837\u663e\u7136\u4f1a\u4ea7\u751f\u5f88\u591a\u65e0\u7528\u72b6\u6001\uff0c\u5c31\u662f\u53ef\u80fd\u5728\u67d0\u4e00\u4e2a\u65f6\u95f4 $i$\uff0c\u6ca1\u6709\u5230\u8f66\u7ad9 $j$ \u7684\u8f66\uff0c\u90a3\u8fd9\u4e00\u4e2a\u72b6\u6001\u5c31\u662f\u65e0\u7528\u7684  \n\u6240\u4ee5\u6539\u8fdb\u4e00\u4e0b\uff0c\u8bbe $f_i$ \u4e3a\u5750\u5b8c\u7f16\u53f7\u4e3a $i$ \u7684\u8f66\u65f6\uff0c\u7684\u6700\u5c0f\u70e6\u8e81\u503c\uff0c\u8fd9\u6837\u53ef\u4ee5\u7531\u8f66\u7684\u7f16\u53f7\u786e\u5b9a\u5230\u8fbe\u65f6\u95f4\u4e86  \n\u7136\u540e\u5bf9\u4e8e\u6240\u6709 $y_i=n$ \u7684\u8f66\uff0c$\\min\\{f_i+q_i\\}$ \u5373\u4e3a\u7b54\u6848  \n\n\u7136\u540e\u8003\u8651\u600e\u4e48\u8f6c\u79fb\uff0c$f_i$ \u7531 $f_j$ \u8f6c\u79fb\u800c\u6765\u7684\u6761\u4ef6\u662f\uff0c$q_j\\le p_i,y_j=x_i$\uff0c\u6240\u4ee5\u53ef\u4ee5\u5427\u9632\u5c18\u5199\u6210\u8fd9\u6837\uff1a  \n\n$$f_i=\\min_{q_j\\le p_i,y_j=x_i}\\{f_j+A(p_i-q_j)^2+B(p_i-q_j)+C\\}$$  \n\n\u90a3\u76f4\u63a5\u66b4\u529b\u8f6c\u79fb\u5c31\u662f $O(n^2)$ \u4e86\uff0c\u80fd\u5f97 $70$\uff0c\u518d\u52a0\u4e0a\u6709 $20$ \u7684\u7279\u6b8a\u9650\u5236\u7684\u90e8\u5206\u5206\uff0c~~\u90a3\u8c01\u8fd8\u4e3a\u4e86\u6700\u540e\u5341\u5206\u5199dp\u4f18\u5316\u554a~~  \n\n~~\u8fd8\u662f\u8981\u5199\u7684~~\uff0c\u770b\u7740\u6709\u4e00\u4e2a\u5e73\u65b9\u9879\uff0c\u5c55\u5f00\u7684\u8bdd\u5c31\u6709\u4e00\u9879\u662f\u548c $i,j$ \u90fd\u6709\u5173\uff0c\u90a3\u5c31\u80fd\u60f3\u5230\u659c\u7387\u4f18\u5316\u4e86  \n\u5176\u5b9e\u611f\u89c9\u597d\u591a\u659c\u7387\u4f18\u5316\u7684\u9898\u90fd\u662f\u7528\u8fd9\u4e48\u4e00\u4e2a\u5e73\u65b9\u6765\u521b\u9020\u90a3\u4e2a $kx$\uff0c\u5c31\u662f\u548c $i,j$ \u90fd\u6709\u5173\u7684\u9879\uff08\u6bd4\u5982\u7ecf\u5178\u7684\u73a9\u5177\u88c5\u7bb1\uff09  \n\u90a3\u5c31\u5148\u4e0d\u8003\u8651\u9650\u5236\u6761\u4ef6\uff0c\u5316\u7b80\u5f0f\u5b50\uff1a  \n\n$$f_i=f_j+Ap_i^2+Aq_j^2-2Ap_iq_j+Bp_i-Bq_j+C$$\n$$f_j+Aq_j^2-Bq_j=2Ap_iq_j+(f_i-Ap_i^2-Bp_i-C)$$\n\n\u4e5f\u5c31\u662f\u6839\u636e\u659c\u7387\u4f18\u5316\u5e38\u89c1\u7684\u5957\u8def\uff0c\u628a\u7b49\u53f7\u5de6\u8fb9\u548c $j$ \u6709\u5173\u7684\u8bbe\u4e3a $Y$\uff0c\u62ec\u53f7\u91cc\u548c $i$ \u6709\u5173\u7684\uff08\u5305\u62ec\u5e38\u6570\uff09\u8bbe\u4e3a $b$\uff0c\u4e14 $K=2Ap_i,X=q_j$  \n\u6240\u4ee5\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u5305\uff0c\u6700\u5c0f\u5316\u659c\u7387\u5373\u53ef  \n\n\u8fd9\u65f6\u7684\u628a\u9650\u5236\u6761\u4ef6\u8003\u8651\u56de\u6765  \n$y_j=x_i$ \u8fd9\u4e2a\uff0c\u53ea\u8981\u5bf9\u6bcf\u4e2a\u70b9\u90fd\u7ef4\u62a4\u4e00\u4e2a\u51f8\u5305\uff0c$f_i$ \u4ece\u7b2c $x_i$ \u4e2a\u51f8\u5305\u8f6c\u79fb\uff0c\u8f6c\u79fb\u7ed3\u675f\uff0c\u5c31\u52a0\u5165\u5230\u7b2c $y_i$ \u4e2a\u51f8\u5305\u91cc  \n\n\u8fd9\u4e2a $q_j\\le p_i$ \u7a0d\u5fae\u6709\u70b9\u9ebb\u70e6\uff0c\u56e0\u4e3a $p_j<q_j$\uff0c\u6240\u4ee5 $p_j<p_i$\uff0c\u90a3\u6211\u4eec\u5e94\u8be5\u628a\u6240\u6709\u8f66\u6309 $p$ \u5347\u5e8f\u6392\u5e8f\u6765\u5904\u7406  \n\u4f46\u8fd9\u4e2a $p_j<p_i$ \u53ea\u662f\u8bf4\uff0c**\u5982\u679c\u9650\u5236\u6761\u4ef6\u6ee1\u8db3\uff0c\u4e00\u5b9a\u6ee1\u8db3\u4ed6\uff0c\u4f46\u6ee1\u8db3\u4ed6\u4e0d\u4e00\u5b9a\u6ee1\u8db3\u9650\u5236\u6761\u4ef6**\uff0c~~\u4e00\u5f00\u59cb\u6ca1\u60f3\u6e05\u695a\u88ab\u8fd9\u4e2a\u5751\u4e86~~  \n\u6240\u4ee5\u6b64\u65f6\u518d\u7ef4\u62a4 $n$ \u4e2a\u5c0f\u6839\u5806\uff0c\u7528 $q$ \u6392\u5e8f\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a $i$\uff0c\u5c31\u628a\u7b2c $x_i$ \u4e2a\u5806\u4e2d\uff0c\u6240\u6709 $q_j\\le p_i$ \u7684 $j$ \u90fd\u53d6\u51fa\uff0c\u5e76\u653e\u5165\u7b2c $x_i$ \u4e2a vector \u7ef4\u62a4\u6210\u51f8\u5305  \n\u76f4\u5230\u53d1\u73b0\u4e00\u4e2a\u70b9 $q_j>p_i$ \u4e86\uff0c\u90a3\u540e\u9762\u7684 $j$ \u4e5f\u90fd\u4e0d\u7b26\u5408\u8981\u6c42\uff0c\u63d2\u5165\u7ed3\u675f  \n\u5982\u679c\u6ee1\u8db3 $q_j\\le p_i$ \u7684 $j$ \u88ab\u63d2\u5165\u51f8\u5305\u4e86\uff0c\u90a3\u7531\u4e8e $p$ \u4e0d\u51cf\uff0c\u540e\u9762\u7684 $i$ \u80af\u5b9a\u4e5f\u6ee1\u8db3\u4e86\u8fd9\u4e2a\u6761\u4ef6\u4e86  \n\u7136\u540e $f_i$ \u8f6c\u79fb\u5b8c $i$ \u5c31\u4e5f\u4e0d\u662f\u76f4\u63a5\u63d2\u5165\u51f8\u5305\u91cc\uff0c\u800c\u662f\u63d2\u5165\u5bf9\u5e94\u7684\u5806\u4e2d\uff0c\u7b49\u4ed6\u7b26\u5408\u4e86\u76f8\u5e94\u6761\u4ef6\u518d\u63d2\u5165\u51f8\u5305  \n\n\u8fd9\u4e5f\u4e0d\u59a8\u662f\u4e00\u4e2a\u66f4\u666e\u9002\u7684\u601d\u8def\uff0c\u5c31\u662f**\u5f53\u7528\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u70b9\u4e1c\u897f\uff08\u6bd4\u5982\u51f8\u5305\uff09\u6765\u4f18\u5316dp\u65f6\uff0c\u4e00\u4e2a\u72b6\u6001\u88ab\u8f6c\u79fb\u5b8c\uff0c\u5982\u679c\u8fd8\u4e0d\u7b26\u5408\u7528\u5b83\u8f6c\u79fb\u5176\u5b83\u72b6\u6001\u7684\u8981\u6c42\uff0c\u5c31\u5148\u7528\u53e6\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u5b58\u8d77\u6765**  \n\n\u8fd8\u4f1a\u53d1\u73b0\u8fd9\u6837\u7684\u8bdd $K,X$ \u90fd\u9012\u589e\u4e86\uff0c\u53ef\u4ee5\u7528\u4e4b\u95f4\u8bf4\u7684 vector \u7ef4\u62a4  \n\n\u8fd9\u6837\u8f7b\u677e\u8fc7\u4e86\u539f\u7248\u548cLOJ\uff0c\u4f46\u53d1\u73b0\u5728\u52a0\u5f3a\u7248T\u6210\u4e8640  \n\u4e8e\u662f\u6109\u5feb\u5f00\u59cb[\u5361\u5e38](https://www.luogu.com.cn/discuss/show/235381)\uff0c\u4e00\u5f00\u59cb\u662f\u7528 `set` \u5f53\u5806\u6765\u7ef4\u62a4\uff0c\u7136\u540e\u6362\u6210\u4f18\u5148\u961f\u5217\uff0c\u7a0d\u5fae\u5feb\u4e86\u70b9\uff0c\u4f46\u8fd8\u662f40  \n\u7136\u540e\u53c8\u52a0\u4e86\u884c\u7f16\u8bd1\u4f18\u5316\uff0c~~\u4f9d\u713640~~\uff0c\u597d\u50cf\u6ca1\u5565\u7528  \n\u4e5f\u8bb8\u662fstl\u7528\u7684\u592a\u591a\uff0c\u4e0d\u7136\u4e00\u79d2 $10^6$ \u7684 $O(m\\log m)$ \u5e94\u8be5\u633a\u597d\u8fc7\u5427\uff0c\u4f46\u56e0\u4e3a\u662f\u52a8\u6001\u5185\u5b58\u4e5f\u4e0d\u597d\u907f\u514dstl  \n\u4e8e\u662f\u73b0\u5b66\u73b0\u5356fread\uff0c\u7136\u540e\u8fb9\u5199\u5468\u672b\u4f5c\u4e1a\u8fb9\u7b49\u5230\u534a\u591c\uff0c\u4e00\u4ea4[\u6700\u5927\u70b9997ms\u5361\u8fc7](https://www.luogu.com.cn/record/34855039)\uff0c\u679c\u7136\u5361\u5e38\u7684\u6700\u597d\u65b9\u5f0f\u662f\u7b49\u4eba\u5c11\u7684\u65f6\u5019\u63d0\u4ea4  \nsubmit+=20  \n\n\u6b22\u8fce\u5927\u5bb6\u6765\u770b\u770b\u6211\u7684\u4ee3\u7801\u5e38\u6570\u4e3a\u5565\u8fd9\u4e48\u5927/kk  \n\n```cpp  \n#pragma GCC optimize(\"Ofast,no-stack-protector,unroll-loops,fast-math\")\n#include<cstdio>\n#include<algorithm>\n#include<iostream>\n#include<queue>\n#include<vector>\n#include<set>\n#include<cstring>\n#define reg register\n#define EN std::puts(\"\")\n#define LL long long\nnamespace Fread{\n\tchar buffer[32768],*cs,*ct;\n\t#define get_char (cs==ct&&(ct=(cs=buffer)+fread(buffer,1,32768,stdin),cs==ct)?0:*cs++)\n\tinline int read(){\n\t\tregister int x=0;\n\t\tregister char c=get_char;\n\t\twhile(c<'0'||c>'9') c=get_char;\n\t\twhile(c>='0'&&c<='9') x=x*10+(c^48),c=get_char;\n\t\treturn x;\n\t}\n\t#undef getc\n}\nusing namespace Fread;\nstruct data{\n\tint x,y;\n\tLL p,q;\n//\tint id;\n}t[1000006];\nint n,m;\nLL A,B,C;\nLL f[1000005];\nLL X[1000001],Y[1000001];\nstd::vector<int>q[1000001];\nstruct cmp{\n\tinline int operator()(const int &aa,const int &bb){\n\t\treturn t[aa].q==t[bb].q?aa>bb:t[aa].q<t[bb].q;\n\t}\n};\nstruct _insert{\n\tint i;\n\tinline int operator <(const _insert &a)const{return t[i].q>t[a.i].q;}//\u6309 q \u7684\u5347\u5e8f\n};\nstd::priority_queue<_insert>insert[1000001];\ninline int cmp(data a,data b){return a.p<b.p;}\ninline LL min(LL a,LL b){return a>b?b:a;}\n//inline LL X(int i){return t[i].q;}\n//inline LL Y(int i){return f[i]+A*t[i].q*t[i].q-B*t[i].q;}\ninline void Insert(int i){\n\treg int size,j,head;//size \u4e3a set insert \u7684\u5927\u5c0f\uff0chead \u4e3a vector q[x[i]] \u6700\u540e\u4e00\u4e2a\u6570\u7684\u4e0b\u6807\n\tsize=insert[t[i].x].size();\n\tif(!size) return;\n\tj=insert[t[i].x].top().i;\n\twhile(size&&t[j].q<=t[i].p){\n\t\thead=q[t[i].x].size()-1;\n\t\twhile(head>0){\n\t\t\tif((Y[q[t[i].x][head]]-Y[q[t[i].x][head-1]])*(X[j]-X[q[t[i].x][head]])\n\t\t\t>=(Y[j]-Y[q[t[i].x][head]])*(X[q[t[i].x][head]]-X[q[t[i].x][head-1]])) q[t[i].x].pop_back();\n\t\t\telse break;\n\t\t\thead--;\n\t\t}\n\t\tq[t[i].x].push_back(j);\n\t\tsize--;insert[t[i].x].pop();\n\t\tj=insert[t[i].x].top().i;\n\t}\n}\ninline void pop(int i){\n\treg int size=q[t[i].x].size();\n\treg LL K=2*A*t[i].p;\n\twhile(size>1&&Y[q[t[i].x][1]]-Y[q[t[i].x][0]]<=K*(X[q[t[i].x][1]]-X[q[t[i].x][0]])){\n\t\tsize--;\n\t\tq[t[i].x].erase(q[t[i].x].begin());\n\t}\n}\nint main(){\n//\t\tstd::freopen(\"P6302_2.in\",\"r\",stdin);\n//\t\tstd::freopen(\"tmp.txt\",\"w\",stdout);\n\tn=read();m=read();A=read();B=read();C=read();\n\tfor(reg int i=1;i<=m;i++)\n\t\tt[i].x=read(),t[i].y=read(),t[i].p=read(),t[i].q=read(),f[i]=1e10;\n\tstd::sort(t+1,t+1+m,cmp);\n\tf[0]=0;\n\tq[1].push_back(0);\n\tfor(reg int i=1,j;i<=m;i++){//k=2*A*p[i]\n\t\tInsert(i);pop(i);\n\t\tif(q[t[i].x].size()){\n\t\t\tj=q[t[i].x][0];\n\t\t\tf[i]=f[j]+A*(t[i].p-t[j].q)*(t[i].p-t[j].q)+B*(t[i].p-t[j].q)+C;\n\t\t\tinsert[t[i].y].push((_insert){i});\n\t\t}\n\t\tX[i]=t[i].q;Y[i]=f[i]+A*t[i].q*t[i].q-B*t[i].q;\n//\t\t\tif(f[i]<0){\n//\t\t\t\tstd::printf(\"i: %d, f[i]: %lld, from: j: %d, f[j]: %lld\\n\",i,f[i],j,f[j]);\n//\t\t\t\tstd::printf(\"%d: start : %lld, end : %lld\\n%d: start : %lld, end : %lld\\n\",i,t[i].p,t[i].q,j,t[j].p,t[j].q);\n//\t\t\t\tif(t[j].q>t[i].p) std::puts(\"!!! q[j]>p[i] !!!\");\n//\t\t\t\treturn 0;\n//\t\t\t}\n\t}\n\tLL ans=1e18;\n\tfor(reg int i=1;i<=m;i++)if(t[i].y==n) ans=min(ans,f[i]+t[i].q);\n//\t\tfor(reg int i=1;i<=m;i++) std::printf(\"%lld\\n\",f[i]);\n\tstd::printf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1593917149,
        "uid": 164432,
        "name": "suxxsfe",
        "ccfLevel": 9,
        "title": "P5468 P6302 [NOI2019]\u56de\u5bb6\u8def\u7ebf"
    },
    {
        "content": "> [\u6d1b\u8c37\u9898\u76ee\u9875\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P6302)\n\n> \u9898\u610f\u89c1\u6d1b\u8c37\u91cc\u7684\u7ffb\u8bd1\u3002\uff08\u7528$a,b,c$\u5206\u522b\u8868\u793a$A,B,C$\uff09\n\n\u76f4\u63a5\u8003\u8651DP\u3002\u8bbe$dp_i$\u8868\u793a\u6700\u540e\u4e00\u6b21\u5750\u7684\u662f\u5217\u8f66$i$\u65f6\u7684\u6700\u5c0f\u70e6\u8e81\u503c\u3002\u663e\u7136\uff0c\u8fb9\u754c\u662f$dp_0=0$\uff08\u540c\u65f6\u5047\u88c5$y_0=1$\uff09\uff0c\u76ee\u6807\u662f$\\min\\limits_{y_i=n}\\{q_i+dp_i\\}$\u3002\n\n\u8003\u8651\u8f6c\u79fb\u3002\u53ef\u8f6c\u79fb\u6027\u663e\u7136\uff0c\u56e0\u4e3a$2$\u4e2a\u72b6\u6001\u4e0d\u53ef\u80fd\u4e92\u4e3a\u51b3\u7b56\uff0c\u5373\u51b3\u7b56->\u72b6\u6001\u6784\u6210\u7684\u6709\u5411\u56fe\u4e00\u5b9a\u662fDAG\u3002\u4e8e\u662f\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u663e\u7136\u4e3a\n\n$$dp_i=\\min\\limits_{y_j=x_i,q_j\\leq p_i}\\!\\left\\{dp_j+a(p_i-q_j)^2+b(p_i-q_j)+c\\right\\}$$\n\n\u76f4\u63a5\u8f6c\u79fb\u662f$\\mathrm O\\!\\left(n^2\\right)$\u7684\uff0c\u8003\u8651\u4f18\u5316\u3002\u5bb9\u6613\u60f3\u5230\u7684\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u6309$y$\u503c\u5efa\u6876\uff0c\u8fd9\u6837\u6bcf\u4e2a\u72b6\u6001\u7684\u51b3\u7b56\u4ec5\u5728$1$\u4e2a\u6876\u5185\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u8fd9\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u662f\u4e00\u4e2a\u975e\u5e38\u7ecf\u5178\u7684\u659c\u7387\u4f18\u5316\u6a21\u578b\uff0c\u4e0a\u624b\u76f4\u63a5\u5e72\uff1a\n\n\u5bf9\u4e8e$2$\u4e2a\u51b3\u7b56$j,k$\uff0c$j$\u6bd4$k$\u4f18\u5f53\u4e14\u4ec5\u5f53\n\n$$dp_j+a(p_i-q_j)^2+b(p_i-q_j)+c<dp_k+a(p_i-q_k)^2+b(p_i-q_k)+c$$\n\n\u5316\u7b80\u5f97\n\n$$dp_j+aq_j^2-bq_j-2ap_iq_j<dp_k+aq_k^2-bq_k-2ap_iq_k$$\n\n\u5c06\u4ec5\u5173\u4e8e\u51b3\u7b56\u53d8\u91cf\u7684\u9879\u653e\u5de6\u8fb9\uff0c\u65e2\u5173\u4e8e\u72b6\u6001\u53d8\u91cf\u53c8\u5173\u4e8e\u51b3\u7b56\u53d8\u91cf\u7684\u9879\u653e\u53f3\u8fb9\uff0c\u5f97\n\n$$\\left(dp_j+aq_j^2-bq_j\\right)-\\left(dp_k+aq_k^2-bq_k\\right)<2ap_i(q_j-q_k)$$\n\n\u8981\u9664\u8fc7\u6765\u4e86\uff0c\u53ef\u662f\u6211\u4eec\u8fd8\u6ca1\u786e\u5b9a$q_j-q_k$\u7684\u7b26\u53f7\u3002\u4e8e\u662f\u6211\u4eec\u5f3a\u884c\u4ee4$q_j\\leq q_k$\u3002\u5148\u8003\u8651$q_j<q_k$\uff0c\u6b64\u65f6$q_j-q_k<0$\uff0c\u9664\u8fc7\u53bb\uff0c\u53d8\u4e0d\u7b49\u53f7\u65b9\u5411\uff0c\u5f97\n\n$$\\frac{\\left(dp_j+aq_j^2-bq_j\\right)-\\left(dp_k+aq_k^2-bq_k\\right)}{q_j-q_k}>2ap_i$$\n\n\u4e8e\u662f\u5de6\u8fb9\u53ef\u4ee5\u62bd\u8c61\u6210\u5728\u4ee5$q_i$\u4e3a\u70b9$i$\u7684\u6a2a\u5750\u6807\u3001\u4ee5$dp_i+aq_i^2-bq_i$\u4e3a\u70b9$i$\u7684\u7eb5\u5750\u6807\u7684\u76f4\u89d2\u5750\u6807\u7cfb\u4e2d\uff0c\u8fc7\u70b9$j$\u4e0e\u70b9$k$\u7684\u76f4\u7ebf\u7684\u659c\u7387\u3002\u6211\u4eec\u8bbe\u8fd9\u4e2a\u659c\u7387\u4e3a$f(j,k)$\u3002\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c$q_j=q_k$\u5373$q_j-q_k=0$\u65f6\u6ca1\u6709\u659c\u7387\u600e\u4e48\u529e\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u5b83\u4e0e$2ap_i$\u6bd4\u8f83\u4e4b\u540e\u5fc5\u987b\u5f97\u51fa\u6b63\u786e\u7684\u4f18\u52a3\u5173\u7cfb\u7684\u539f\u5219\uff0c\u89c4\u5b9a\u5f53$q_j=q_k$\u65f6$f(j,k)=\\begin{cases}\\infty&dp_j<dp_k\\\\0&dp_j=dp_k\\\\-\\infty&dp_j>dp_k\\end{cases}$\u3002\n\n\u7136\u540e\u5957\u8def\u5316\u5730\u53d1\u73b0\uff0c\u82e5$3$\u4e2a\u51b3\u7b56$i<j<k$\u6ee1\u8db3$f(i,j)\\geq f(j,k)$\uff0c\u5206$2$\u79cd\u60c5\u51b5\uff1a\n1. $f(i,j)>2ap_i$\uff1a\u6b64\u65f6$i$\u6bd4$j$\u4f18\uff1b\n1. $f(i,j)\\leq 2ap_i$\uff1a\u7ed3\u5408$f(i,j)\\geq f(j,k)$\u53ef\u5f97$f(j,k)\\leq 2ap_i$\uff0c\u6b64\u65f6$j$\u6ca1\u6709$k$\u4f18\u3002\n\n\u7efc\u4e0a\uff0c$j$\u4e00\u5b9a\u4e0d\u662f\u6700\u4f18\u51b3\u7b56\uff0c\u4e8e\u662f\u53ef\u4ee5\u628a\u5b83\u6254\u6389\uff0c\u5373\u7ef4\u62a4\u4e00\u4e2a\u659c\u7387\u4e25\u683c\u5355\u8c03\u4e0a\u5347\u7684\u4e0a\u51f8\u58f3\u3002\u7531\u4e8e\u6709$n$\u4e2a\u6876\u4f5c\u4e3a\u51b3\u7b56\u6816\u606f\u5730\uff0c\u6211\u4eec\u7ef4\u62a4\u6bcf\u4e2a\u6876\u5185\u7684\u4e0a\u51f8\u58f3\uff0c\u7136\u540e\u8ba1\u7b97DP\u503c\u65f6\u5728\u5bf9\u5e94\u7684\u6876\u5185\u7684\u4e0a\u51f8\u58f3\u5185\u627e\u5373\u53ef\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651DP\u987a\u5e8f\u3002\u663e\u800c\u6613\u89c1\u7684\u6709$2$\u79cd\uff1a\u6309$p$\u503c\u5347\u5e8f\u548c\u6309$q$\u503c\u5347\u5e8f\u3002\u4e24\u79cd\u6b63\u786e\u6027\u90fd\u5f88\u597d\u8bc1\uff0c\u4ee5$p$\u503c\u5347\u5e8f\u4e3a\u4f8b\uff0c\u5bf9\u4e8e\u4efb\u610f$i<j$\uff0c\u6709$p_i\\leq p_j$\uff0c\u53c8$p_j<q_j$\uff0c\u6240\u4ee5$q_j>p_i$\uff0c\u6240\u4ee5$i$\u4e0d\u53ef\u80fd\u8f6c\u79fb\u5230$j$\uff0c\u5f97\u8bc1\u3002\n\n\u5148\u8003\u8651$q$\u503c\u5347\u5e8f\u3002\u6b64\u65f6\u6bcf\u4e2a\u4e0a\u51f8\u58f3\u53ef\u4ee5\u5355\u8c03\u6808$stk$\u7ef4\u62a4\u3002\u6bcf\u8ba1\u7b97\u5b8c\u4e00\u4e2aDP\u503c\uff0c\u7531\u4e8e\u6a2a\u5750\u6807\u975e\u4e25\u683c\u5355\u8c03\u4e0a\u5347\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u6808\u9876\u52a0\u70b9\u5e76\u7ef4\u62a4\u5355\u8c03\u6027\uff08\u597d\u5427\u5176\u5b9e\u5e76\u4e0d\u80fd\uff0c\u8fd8\u662f\u5f97\u50cf\u4e0b\u9762\u90a3\u6837two-pointers\uff0c\u56e0\u4e3a\u8f6c\u79fb\u65b9\u7a0b$\\min$\u91cc\u6709$q_j\\leq p_i$\u7684\u9650\u5236\uff09\u3002\u8ba1\u7b97\u7684\u65f6\u5019\u561b\uff0c\u5c31\u53ea\u80fd\u4e8c\u5206\u67e5\u627e\u7b2c\u4e00\u4e2a\u6ee1\u8db3$f(stk_j,stk_{j+1})>2ap_i$\u7684$stk_j$\u4f5c\u4e3a\u6700\u4f18\u51b3\u7b56\u4e86\uff08\u6b63\u786e\u6027\u663e\u7136\uff09\u3002\u5355DP\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31$\\mathrm O(m\\log m)$\u3002\n\n\u518d\u6765\u8003\u8651$p$\u503c\u5347\u5e8f\u3002$2ap_i$\u663e\u7136\u4e5f\u975e\u4e25\u683c\u5355\u8c03\u9012\u589e\uff0c\u53ef\u4ee5\u5c06\u5355\u8c03\u6808\u6539\u8fdb\u4e3a\u5355\u8c03\u961f\u5217\u3002\u4f46\u662f\u8fd9\u6837\u521a\u8ba1\u7b97\u5b8cDP\u503c\u5e76\u4e0d\u80fd\u76f4\u63a5\u52a0\u8fdb\u5355\u8c03\u961f\u5217\u5c3e\uff0c\u56e0\u4e3a\u4e0d\u80fd\u4fdd\u8bc1\u6ca1\u6709\u5176\u4ed6\u6a2a\u5750\u6807\u66f4\u5c0f\u7684\u8fd8\u6ca1\u8ba1\u7b97\u3002\u6240\u4ee5\u5e94\u8be5\u5bf9\u4e8e\u6bcf\u4e2a\u4e0a\u51f8\u58f3\u7ef4\u62a4two-pointers\uff0c\u8ba1\u7b97\u6bcf\u4e2aDP\u503c\u65f6\uff0c\u5728\u51b3\u7b56\u6240\u5728\u4e0a\u51f8\u58f3\u7684\u5355\u8c03\u961f\u5217\u5c3e\u4e00\u8fde\u6309$q$\u503c\u5347\u5e8f\u6dfb\u52a0\u597d\u51e0\u4e2a\u70b9\u3002DP\u65f6\u95f4\u590d\u6742\u5ea6$\\mathrm O(m)$\u3002\u4f46\u662f\u6309$p$\u503c\u3001$q$\u503c\u6392\u5e8f\u4ec0\u4e48\u7684\u8fd8\u662f\u5e26$\\log$\u554a\uff0c\u8fd9\u4e48\u4e00\u6765\u8d39\u5c3d\u5fc3\u601d\u53bbDP\u7684$\\log$\u4e0d\u662f\u6ca1\u7528\u4e86\u5417\uff1f\u522b\u6025\uff0c\u53ef\u4ee5\u6876\u6392\u3002\u65f6\u95f4\u590d\u6742\u5ea6$\\mathrm O\\!\\left(n+m+\\max\\limits_{i=1}^n\\{q_i\\}\\right)$\u3002\n\n~~\u4ec0\u4e48\uff1f\u4f60\u95ee\u6211\u5230\u5e95\u7528\u54ea\u79cdDP\u987a\u5e8f\uff1f\u5f53\u7136\u7528\u4e0b\u9762\u90a3\u79cd\u590d\u6742\u5ea6\u5c0f\u7684\u5566~~\n\n\u53e6\u5916\uff0c\u8fd9\u9898\u6bd4\u8f83\u5361\u5e38\uff0c\u6211O3\u3001\u5feb\u8bfb\u3001\u6539`deque`\u4e3a`vector`\u6a21\u62df\u961f\u5217~~\u4e09\u8fde~~\u624dAC\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#pragma GCC optimize(3)\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\n#define y0 afejaogoea\n#define pb push_back\nconst int inf=0x3f3f3f3f3f3f3f3f;\nconst double dinf=1e100;\nvoid read(int &x){\n\tx=0;char c=getchar();\n\twhile(!isdigit(c))c=getchar();\n\twhile(isdigit(c))x=(x<<1)+(x<<3)+(c^48),c=getchar();\n}\nint sq(int x){return x*x;}\nconst int N=100000,M=1000000,Q_I=40000;\nint n,m,a,b,c;\nint x[M+1],y[M+1],p[M+1],q[M+1];\nvector<int> buc_y[N+1],buc_p[Q_I+1],buc_q[Q_I+1];//\u6876\u4eec \nint now[N+1];//two-pointers\u53d8\u91cf \nvector<int> que[N+1];//vector\u6a21\u62df\u961f\u5217 \nint head[N+1],tail[N+1];//vector\u6a21\u62df\u961f\u5217 \nint dp[M+1];//DP\u6570\u7ec4 \ndouble f(int j,int k){//\u659c\u7387 \n\tint y_j=dp[j]+a*sq(q[j])-b*q[j],y_k=dp[k]+a*sq(q[k])-b*q[k];\n\tif(q[j]==q[k])return y_j<y_k?dinf:y_j==y_k?0:-dinf;\n\treturn 1.*(y_j-y_k)/(q[j]-q[k]);\n}\nsigned main(){\n//\tfreopen(\"C:\\\\Users\\\\chenx\\\\OneDrive\\\\\u684c\u9762\\\\txt.txt\",\"r\",stdin);\n\tread(n);read(m);read(a);read(b);read(c);\n\tfor(int i=1;i<=m;i++)read(x[i]),read(y[i]),read(p[i]),read(q[i]),buc_p[p[i]].pb(i)/*\u6876\u6392*/,buc_q[q[i]].pb(i)/*\u6876\u6392*/;\n\tbuc_y[1].pb(0);\n\tfor(int i=0;i<=Q_I;i++)for(int j=0;j<buc_q[i].size();j++)buc_y[y[buc_q[i][j]]].pb(buc_q[i][j]);//\u88c5\u6876 \n\tfor(int i=1;i<=n;i++)que[i].resize(buc_y[i].size());\n\tmemset(now,-1,sizeof(now));\n\tfor(int i=0;i<=Q_I;i++)for(int j=0;j<buc_p[i].size();j++){//\u8f6c\u79fb \n\t\tint x0=buc_p[i][j];\n\t\twhile(now[x[x0]]+1<buc_y[x[x0]].size()&&q[buc_y[x[x0]][now[x[x0]]+1]]<=p[x0]){//\u4e00\u8fde\u5f80\u961f\u5c3e\u52a0\u597d\u51e0\u4e2a\u70b9 \n\t\t\tint y0=buc_y[x[x0]][++now[x[x0]]];\n\t\t\twhile(head[x[x0]]+1<tail[x[x0]]&&f(que[x[x0]][tail[x[x0]]-2],que[x[x0]][tail[x[x0]]-1])>=f(que[x[x0]][tail[x[x0]]-1],y0))tail[x[x0]]--;//\u7ef4\u62a4\u659c\u7387\u5355\u8c03\u6027 \n\t\t\tque[x[x0]][tail[x[x0]]++]=y0;\n\t\t}\n\t\twhile(head[x[x0]]+1<tail[x[x0]]&&f(que[x[x0]][head[x[x0]]],que[x[x0]][head[x[x0]]+1])<2*a*p[x0])head[x[x0]]++;//\u4ece\u961f\u9996\u5f39\u51fa \n\t\tif(head[x[x0]]<tail[x[x0]]){\n\t\t\tint y0=que[x[x0]][head[x[x0]]];\n\t\t\tdp[x0]=dp[y0]+a*sq(p[x0]-q[y0])+b*(p[x0]-q[y0])+c;\n\t\t}\n\t\telse dp[x0]=inf;//\u8ba1\u7b97DP\u503c \n\t}\n\tint ans=inf;\n\tfor(int i=0;i<buc_y[n].size();i++)ans=min(ans,q[buc_y[n][i]]+dp[buc_y[n][i]]);//\u76ee\u6807 \n\tcout<<ans;\n\treturn 0;\n}\n```",
        "postTime": 1590068446,
        "uid": 138400,
        "name": "chenxia25",
        "ccfLevel": 9,
        "title": "\u6d1b\u8c37 P6302 - \u56de\u5bb6\u8def\u7ebf \u52a0\u5f3a\u7248"
    }
]