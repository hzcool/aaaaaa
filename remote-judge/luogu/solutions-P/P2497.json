[
    {
        "content": "# SDOI2012 \u57fa\u7ad9\u5efa\u8bbe\n\n> stl \u662f c++ \u7684\u9988\u8d60\u3002   ----Wild_Donkey\n\n\u4e00\u5f00\u59cb\u770b\u5230\u8fd9\u4e2a\u9898\u6709\u6807\u7b7e `\u7ebf\u6bb5\u6811`\uff0c`\u5e73\u8861\u6811`\uff0c`CDQ \u5206\u6cbb`\uff0c\u505a\u5b8c\u540e\u4e5f\u6ca1\u6709\u7528\u5230\u8fd9\u4e9b (\u5982\u679c `std::set` \u4e0d\u7b97\u5e73\u8861\u6811\u7684\u8bdd)\u3002\n\n\u4e00\u770b\u9898\u89e3\u53d1\u73b0\u6240\u6709\u4eba\u4e0d\u662f CDQ\uff0c\u5c31\u662f\u674e\u8d85\u6811\uff0c\u8fd8\u6709\u624b\u5199\u5e73\u8861\u6811\u7684\u3002\u6211\u5341\u5206\u4e0d\u89e3\uff0c\u653e\u7740\u73b0\u6210\u7684 `set` \u4e3a\u4ec0\u4e48\u4e0d\u7528\u554a\u3002\n\n## \u5f0f\u5b50\n\n\u63a8\u5f0f\u5b50\u7684\u8fc7\u7a0b\u5927\u540c\u5c0f\u5f02\uff0c\u53ef\u4ee5\u7565\u8fc7\u3002\n\n\u8bbe $r_i$ \u548c $R_i$ \u4e3a\u7b2c $i$ \u4e2a\u57fa\u7ad9\u7684\u53d1\u5c04\u548c\u63a5\u6536\u534a\u5f84\u3002\n\n\u5982\u679c\u6211\u4eec\u8981\u628a\u57fa\u7ad9 $i$ \u7684\u4fe1\u53f7\u4f20\u5230\u57fa\u7ad9 $j$\uff0c\u90a3\u4e48\u6709\u5f0f\u5b50:\n\n$$\n\\begin{aligned}\n(r_i + R_j)^2 &= (r_i - R_j)^2 + (x_i - x_j)^2\\\\\n{r_i}^2 + {R_j}^2 + 2r_iR_j &= {r_i}^2 + {R_j}^2 - 2r_iR_j + (x_i - x_j)^2\\\\\n4r_iR_j &= (x_i - x_j)^2\\\\\nR_j &= \\frac{(x_i - x_j)^2}{4r_i}\\\\\n\\sqrt{R_j} &= \\frac{|x_i - x_j|}{2\\sqrt{r_i}}\\\\\n\\end{aligned}\n$$\n\n\u663e\u7136\u5982\u679c\u4e00\u4e2a\u57fa\u7ad9\u7684\u4fe1\u53f7\u662f\u4ece\u53f3\u8fb9\u7684\u57fa\u7ad9\u63a5\u6536\u6765\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u4e00\u5b9a\u53ef\u4ee5\u627e\u5230\u4e00\u4e2a\u65b9\u6848\u4f7f\u5f97\u5b83\u7684\u4fe1\u53f7\u4ece\u5de6\u8fb9\u63a5\u6536\u800c\u6765\u4e14\u4ee3\u4ef7\u66f4\u5c0f\u3002\u56e0\u4e3a\u4fe1\u53f7\u7684\u6e90\u5934\u5728\u6700\u5de6\u7aef\uff0c\u6240\u4ee5\u628a\u4e00\u4e2a\u65b9\u6848\u4e2d\uff0c\u5728 $x$ \u53f3\u8fb9\u7684\u57fa\u7ad9\u90fd\u4e0d\u9009\uff0c\u8ba9\u4fe1\u53f7\u76f4\u63a5\u4ece\u6fc0\u6d3b\u7684\u57fa\u7ad9\u4e2d\uff0c$x$ \u5de6\u8fb9\u6700\u8fd1\u7684\u57fa\u7ad9\u4f20\u5230 $x$\uff0c\u8fd9\u6837\u5b89\u6392\u4ee3\u4ef7\u4e00\u5b9a\u4f1a\u66f4\u5c0f\uff0c\u56e0\u4e3a\u51cf\u5c11\u4e86\u6fc0\u6d3b\u4e00\u4e9b\u57fa\u7ad9\u7684\u4ee3\u4ef7\uff0c\u4e2d\u9014\u989d\u5916\u4ee3\u4ef7\u4e5f\u51cf\u5c11\u4e86\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8bbe\u4fe1\u53f7\u4f20\u5230\u57fa\u7ad9 $i$ \u7684\u6700\u5c0f\u4ee3\u4ef7\u4e3a $f_i$\uff0c\u8003\u8651 DP\u3002\n\n$$\nf_i = V_i + \\min_{j = 1}^{i - 1} (f_j + \\frac{x_i - x_j}{2\\sqrt{r_j}})\n$$\n\n\u7136\u540e\u5c31\u6709\u4ee5 $f_j - \\dfrac{x_j}{2\\sqrt{r_j}}$ \u4e3a\u56e0\u53d8\u91cf\uff0c\u4ee5 $\\dfrac{-1}{2\\sqrt{r_j}}$ \u4e3a\u81ea\u53d8\u91cf\uff0c\u4ee5 $x_i$ \u4e3a\u659c\u7387\uff0c\u4ee5 $f_i - V_i$ \u4e3a\u622a\u8ddd\u7684\u51fd\u6570\u3002\n\n$$\nf_j - \\frac{x_j}{2\\sqrt{r_j}} = -\\frac{x_i}{2\\sqrt{r_j}} + f_i - V_i\n$$\n\n\u7ef4\u62a4\u4e0b\u51f8\u58f3\u8fdb\u884c\u659c\u7387\u4f18\u5316 DP \u5373\u53ef\u3002\u7b54\u6848\u5373\u4e3a $max_{x_i + r_i \\geq m} f_i$\u3002\n\n## \u5b9e\u73b0\n\n\u8fd9\u91cc\u662f\u8fd9\u7bc7\u9898\u89e3\u7684\u91cd\u70b9\uff0c\u5177\u4f53\u4ecb\u7ecd\u5982\u4f55\u907f\u514d\u624b\u5199\u4efb\u4f55\u6570\u636e\u7ed3\u6784\u5c31\u80fd\u7ef4\u62a4\u51f8\u58f3\u3002\n\n\u5173\u4e8e\u7528 set \u7ef4\u62a4\u51f8\u58f3: \u6211\u4eec\u7528 set \u4ee5\u6a2a\u5750\u6807\u4e3a\u5e8f\u4fdd\u5b58\u8fd9\u4e9b\u70b9\uff0c\u5199\u4e00\u4e2a\u51fd\u6570\u6765\u5224\u65ad\u4ece\u5f53\u524d\u70b9 $this$ \u5230\u4e24\u4e2a\u70b9 $x$\uff0c$y$ \u7684\u5c04\u7ebf\u7684\u659c\u7387\u5927\u5c0f\u5173\u7cfb\uff0c\u7528\u4e58\u6cd5\u4ee3\u66ff\u9664\u6cd5\u4ee5\u6700\u5927\u9650\u5ea6\u4fdd\u7559\u7cbe\u5ea6\u3002\n\n```cpp\nstruct Pnt {\n  double X, Y;\n  inline const char operator < (const Pnt& x) const {return X < x.X;}\n  inline char KLeq (const Pnt x, const Pnt y) const {\n    double Del1(x.X - X), Del2(y.X - X), Del3(x.Y - Y), Del4(y.Y - Y);\n    return Del3 * Del2 <= Del4 * Del1;\n  }\n};\nset<Pnt> S;\n```\n\n\u63a5\u4e0b\u6765\u4e00\u8fb9\u8f93\u5165\u4e00\u8fb9 DP\u3002\u56e0\u4e3a $x_i$ \u9012\u589e\uff0c\u6240\u4ee5\u5bf9\u4e8e\u51f8\u58f3\u659c\u7387\u5c0f\u4e8e $x_i$ \u7684\u90e8\u5206\u76f4\u63a5\u5220\u6389\u5373\u53ef\uff0c\u5224\u65ad\u70b9 `S.begin()` \u548c `++(S.begin())` \u8fde\u6210\u7684\u7ebf\u6bb5\u7684\u659c\u7387\u548c $x_i$ \u7684\u5173\u7cfb\uff0c\u5982\u679c\u5c0f\u4e8e $x_i$ \u5c31\u5220\u9664 `S.begin()`\u3002\u5220\u5230\u4e0d\u80fd\u5220\u7684\u65f6\u5019\uff0c`S.begin()` \u5373\u4e3a\u6211\u4eec\u7528\u6765\u8f6c\u79fb $f_i$ \u7684\u51b3\u7b56\u70b9\u3002\n\n\u7b97\u51fa $f_i$ \u8fd8\u8981\u8bb0\u5f97\u5c1d\u8bd5\u66f4\u65b0\u7b54\u6848\u3002\n\n```cpp\nA = RD(), B = RD(), C = RD(), Tmp = 0;\nset<Pnt>::iterator It(S.begin()), Pre, Suf, TmpI;\nwhile (((++It) != S.end()) && ((It->Y - S.begin()->Y) <= (It->X * A - S.begin()->X * A))) S.erase(S.begin());\nTmp = S.begin()->Y - S.begin()->X * A + C;\nif(A + B >= m) Ans = min(Tmp, Ans);\n```\n\n\u63a5\u4e0b\u6765\u7528 $f_i$ \u7b97\u51fa\u5b83\u5bf9\u5e94\u7684\u70b9\uff0c\u63d2\u5165\u51f8\u58f3\u4e2d\u3002\u8fd9\u91cc\u627e\u51fa\u5b83\u524d\u9762\u7684\u70b9\u548c\u540e\u9762\u7684\u70b9\uff0c\u5224\u65ad\u4e00\u4e0b\u662f\u5426\u843d\u5230\u4e86\u51f8\u58f3\u5185\u90e8\uff0c\u843d\u5230\u5185\u90e8\u5c31\u4e0d\u7528\u63d2\u5165\u4e86\uff0c\u76f4\u63a5\u5220\u9664\u3002\n\n```cpp\nXTmp = (-1) / (2 * sqrt(B));\nTmpI = Pre = Suf = It = (S.insert({XTmp, Tmp + XTmp * A})).first, ++Suf;\nif(Pre != S.begin() && Suf != S.end()) {\n  --Pre;\n  if(Pre->KLeq(*(Suf), *(It))) {S.erase(It); continue;}\n}\n```\n\n\u5982\u679c\u6ca1\u843d\u5230\u5185\u90e8\uff0c\u90a3\u4e48\u5c31\u5c1d\u8bd5\u628a\u65b0\u52a0\u5165\u7684\u70b9\u7684\u5de6\u53f3\u7684\u4e0d\u51f8\u4e86\u7684\u70b9\u5220\u9664\u3002\u5148\u641e\u5de6\u8fb9\u518d\u641e\u53f3\u8fb9\u3002\n\n```cpp\nif(It != S.begin()) {\n  Suf = It, Pre = --It;\n  while (Pre != S.begin()) {\n    --Pre;\n    if(Pre->KLeq(*Suf, *It)) S.erase(It), It = Pre; else break;\n  }\n}\nIt = Pre = TmpI, ++It;\nif(It == S.end()) continue;\nSuf = It, ++Suf;\nwhile (Suf != S.end()) {\n  if(Pre->KLeq(*Suf, *It)) S.erase(It), It = Suf, ++Suf; else break;\n}\n```\n\n\u4e0b\u9762\u662f\u5408\u8ba2\u672c:\n\n```cpp\ndouble A, B, C;\ndouble Ans(1e18), Tmp(0), XTmp(0);\nunsigned long long m; \nunsigned n;\nunsigned D, t;\nsigned main() {\n  n = RD(), m = RD();\n  A = RD(), B = RD(), C = RD();\n  XTmp = (-1) / (2 * sqrt(B));\n  S.insert({XTmp, C + XTmp * A});\n  for (unsigned i(2); i <= n; ++i) {\n    A = RD(), B = RD(), C = RD(), Tmp = 0;\n    set<Pnt>::iterator It(S.begin()), Pre, Suf, TmpI;\n    while (((++It) != S.end()) && ((It->Y - S.begin()->Y) <= (It->X * A - S.begin()->X * A))) S.erase(S.begin());\n    Tmp = S.begin()->Y - S.begin()->X * A + C;\n    if(A + B >= m) Ans = min(Tmp, Ans);\n    XTmp = (-1) / (2 * sqrt(B));\n    TmpI = Pre = Suf = It = (S.insert({XTmp, Tmp + XTmp * A})).first, ++Suf;\n    if(Pre != S.begin() && Suf != S.end()) {\n      --Pre;\n      if(Pre->KLeq(*(Suf), *(It))) {S.erase(It); continue;}\n    }\n    if(It != S.begin()) {\n      Suf = It, Pre = --It;\n      while (Pre != S.begin()) {\n        --Pre;\n        if(Pre->KLeq(*Suf, *It)) S.erase(It), It = Pre; else break;\n      }\n    }\n    It = Pre = TmpI, ++It;\n    if(It == S.end()) continue;\n    Suf = It, ++Suf;\n    while (Suf != S.end()) {\n      if(Pre->KLeq(*Suf, *It)) S.erase(It), It = Suf, ++Suf; else break;\n    }\n  }\n  printf(\"%.3lf\\n\", Ans);\n  return Wild_Donkey;\n}\n```\n\n\u4ee3\u7801\u8fc7\u7a0b\u4e2d\u6211\u72af\u4e86\u5f88\u591a\u9519\uff0c\u6700\u5f31\u667a\u7684\u83ab\u8fc7\u4e8e\u5fd8\u8bb0\u7ef4\u62a4\u51f8\u58f3\uff0c\u5199\u5b8c\u8fd8\u5632\u8bbd\u8fd9\u4e2a\u9898\u600e\u4e48\u8fd9\u4e48\u597d\u5199\u5e76\u4e14\u8fc7\u4e86\u4e24\u4e2a\u70b9\u5f97\u4e86 $11$ \u5206\u3002(\u6ca1\u9519\u5c31\u662f\u6ca1\u6709\u5220\u70b9\u53ea\u6709\u52a0\u70b9)",
        "postTime": 1646808215,
        "uid": 143771,
        "name": "\u6bd4\u5229\u2642\u6d77\u7075\u987f",
        "ccfLevel": 8,
        "title": "\u659c\u7387\u4f18\u5316: \u57fa\u7ad9\u5efa\u8bbe"
    },
    {
        "content": "[\u4f20\u9001\u95e8 qwq](https://www.luogu.com.cn/problem/P2497)\n\n\u672c\u9898\u89e3\u4f7f\u7528\u52a8\u6001\u5f00\u70b9\u674e\u8d85\u6811\u4f18\u5316 dp\u3002\n\n\u4e00\u4e0a\u6765\u5148\u60f3\u4e2a\u66b4\u529b\u3002\u8bbe $f_i$ \u8868\u793a\u4fe1\u53f7\u4ece\u8d77\u70b9\u4f20\u5230\u7b2c $i$ \u4e2a\u57fa\u7ad9\u6240\u9700\u8981\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n\u9996\u5148\uff0c\u9898\u76ee\u7684\u9690\u542b\u6761\u4ef6\u662f\u79fb\u52a8\u516c\u53f8\u5fc5\u9009\uff0c\u90a3\u4e48\uff1a\n\n$$\nf_1=v_1\n$$\n\n\u5bf9\u4e8e\u5176\u4ed6\u60c5\u51b5\uff0c\u5f97\u5230\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$\nf_i=min(f_j+w(j,i)+v_i)\n$$\n\n\u5176\u4e2d $j\\in[1,i-1]$\uff0c$w(j,i)$ \u6307\u7684\u662f\u4f7f\u5f97 $i$ \u80fd\u63a5\u6536\u5230 $j$ \u7684\u4fe1\u53f7\u7684\u4ee3\u4ef7 \u3002\n\n\n\n\u63a5\u4e0b\u6765\u8003\u8651 $w(j,i)$\uff0c\u8fd9\u662f\u4e00\u9053\u5f88\u7b80\u5355\u7684\u51e0\u4f55\u9898\u76ee\uff0c\u968f\u4fbf\u753b\u753b\u5782\u76f4\uff0c\u7528\u7528\u52fe\u80a1\u5b9a\u7406\u5c31\u80fd\u5f97\u5230\uff1a\n\n$$\nw(j,i)=\\frac{x_i-x_j}{2\\sqrt{r1_j}}\n$$\n\n\u6574\u7406\u5f97\uff1a\n\n$$\nf_i=min(f_j+\\frac{x_i}{2\\sqrt{r1_j}}-\\frac{x_j}{2\\sqrt{r1_j}})+v_i\n$$\n\n\n\u7136\u540e\u4e0d\u96be\u770b\u51fa\u8fd9\u5c31\u6210\u4e86\u5f88\u7ecf\u5178\u7684\u659c\u7387\u4f18\u5316\u7684\u8f6c\u79fb\u65b9\u7a0b\uff0c\u4f46\u662f\u53d1\u73b0\u6574\u7406\u540e\u6a2a\u5750\u6807\u5e76\u4e0d\u5355\u589e\uff0c\u8003\u8651\u4f7f\u7528\u674e\u8d85\u6811\u4f18\u5316\u4e4b\u3002\n\n\u8bbe\u51fd\u6570 $g(x)=\\frac{x}{2\\sqrt{r1_j}}-\\frac{x_j}{2\\sqrt{r1_j}}+f_j$\u3002\u659c\u7387\u4e3a $\\frac{1}{2\\sqrt{r1_j}}$\uff0c\u7eb5\u622a\u8ddd\u4e3a $f_j$\uff0c\u6a2a\u5750\u6807\u4e3a $x_i$\u3002\u7136\u540e\u7531\u4e8e\u8f6c\u79fb\u65b9\u7a0b\u5f0f\u4e2d\u7684 $v_i$ \u4e3a\u5b9a\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a $i$\uff0c\u8981\u6c42\u51fa\u51fd\u6570 $g$ \u5728 $x_i$ \u4f4d\u7f6e\u7684\u6700\u5c0f\u503c\uff0c\u8d85\u54e5\u7ebf\u6bb5\u6811\u53ef\u4ee5\u5b8c\u6210\u8fd9\u4e2a\u4efb\u52a1\uff01\n\n\u8003\u8651\u5230 $x$ \u7684\u503c\u57df\u8f83\u5927\uff0c\u53ef\u4ee5\u52a8\u6001\u5f00\u70b9\u3002\u5199\u6cd5\u65e0\u975e\u5c31\u662f\u628a\u666e\u901a\u7684\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\u548c\u674e\u8d85\u6811\u7ed3\u5408\u7f62\u4e86\u3002\u6211\u6839\u672c\u6ca1\u5b66\u8fc7\u4ec0\u4e48\u52a8\u6001\u5f00\u70b9\u7684\u674e\u8d85\u6811\uff0c\u62b1\u7740\u778e\u641e\u7684\u5fc3\u6001\u901a\u8fc7\u4e86\u6b64\u9898\uff08\n\n\u5177\u4f53\u5b9e\u73b0\u7684\u8bdd\u7531\u4e8e $1$ \u5fc5\u9009\uff0c\u4e00\u4e0a\u6765\u5148\u63d2\u5165 $1$ \u8fd9\u6761\u76f4\u7ebf\uff0c\u4e4b\u540e\u5bf9\u4e8e\u6bcf\u4e2a $i$\uff0c\u5206\u522b\u6c42\u51fa\u6700\u4f18\u503c\uff0c\u7136\u540e\u518d\u63d2\u5165\u5bf9\u5e94\u76f4\u7ebf\u5373\u53ef\u3002\u4e0d\u5361\u7cbe\u5ea6\uff0c\u51fa\u9898\u4eba\u826f\u5fc3\u3002\n\n\u5173\u4e8e\u8f93\u51fa\uff0c\u6ce8\u610f\u53ea\u6709\u90a3\u4e9b\u4fe1\u53f7\u53ef\u4ee5\u88ab\u5bb6\u91cc\u63a5\u53d7\u5230\u7684\u57fa\u7ad9\u624d\u53ef\u80fd\u6210\u4e3a\u6700\u7ec8\u7b54\u6848\u3002\n\n\u4ee3\u7801\uff1a\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\n#define db double\nconst int N=500010;\nconst db esp=1e-8;\ndb k[N],b[N];\nint n,m;\nstruct ST{\n\tint ls;\n\tint rs;\n\tint dat;\n}st[N*4];\ndb f(int p,int x){\n\treturn k[p]*x+b[p];\n}\nbool judge(int x,int y,int k){\n\tif(x==0)\n\t\treturn 1;\n\tif(y==0)\n\t\treturn 0;\n\tdb f1=f(x,k);\n\tdb f2=f(y,k);\n\tif(f1>f2)\n\t\treturn 1;\n\treturn 0;\n}\nint tot;\nvoid add(int root,int l,int r,int k){\n\tif(judge(k,st[root].dat,l)&&judge(k,st[root].dat,r))\n\t\treturn;\n\tif(judge(st[root].dat,k,l)&&judge(st[root].dat,k,r)){\n\t\tst[root].dat=k;\n\t\treturn;\n\t}\n\tint mid=(l+r)/2;\n\tif(judge(st[root].dat,k,mid))\n\t\tswap(st[root].dat,k);\n\tif(judge(st[root].dat,k,l)){\n\t\tif(!st[root].ls){\n\t\t\ttot++;\n\t\t\tst[root].ls=tot;\n\t\t}\n\t\tadd(st[root].ls,l,mid,k);\n\t}\n\telse{\n\t\tif(!st[root].rs){\n\t\t\ttot++;\n\t\t\tst[root].rs=tot;\n\t\t}\n\t\tadd(st[root].rs,mid+1,r,k);\n\t}\n\treturn;\n}\nint get(int root,int l,int r,int x){\n\tif(l==r)\n\t\treturn st[root].dat;\n\tint mid=(l+r)/2;\n\tint res;\n\tif(mid>=x)\n\t\tres=get(st[root].ls,l,mid,x);\n\telse\n\t\tres=get(st[root].rs,mid+1,r,x);\n\tif(judge(res,st[root].dat,x))\n\t\tres=st[root].dat;\n\treturn res;\n}\ndb x[N],r[N],v[N],dp[N];\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\ttot=1;\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%lf%lf%lf\",&x[i],&r[i],&v[i]);\n\tdp[1]=v[1];\n\tk[1]=1/(2*sqrt(r[1]));\n\tb[1]=dp[1]-x[1]/(2*sqrt(r[1]));\n\tadd(1,1,(int)(x[n]),1);\n\tfor(int i=2;i<=n;i++){\n\t\tint X=get(1,1,(int)(x[n]),(int)(x[i]));\n\t\tdp[i]=v[i]+f(X,x[i]);\n\t\tk[i]=1/(2*sqrt(r[i]));\n\t\tb[i]=dp[i]-x[i]/(2*sqrt(r[i]));\n\t\tadd(1,1,(int)(x[n]),i);\n\t}\n\tdb ans=1000000000;\n\tfor(int i=n;i>=1;i--)\n\t\tif(x[i]+r[i]>=m)\n\t\t\tans=min(ans,dp[i]);\n\tprintf(\"%.3lf\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1651758738,
        "uid": 140360,
        "name": "LKawaii",
        "ccfLevel": 0,
        "title": "P2497 \u9898\u89e3"
    },
    {
        "content": "\u70b9\u6b64\u4f7f\u7528\u66f4\u4f73 [$\\huge{\\texttt{My Blog}}$](https://www.lu-anlai.com/oi/solution/sdoi2012-r2d1t3/)\u3002\n\n\u4e00\u9053\u795e\u5947\u7684 \u659c\u7387\u4f18\u5316DP \u9898\u3002\n\n\u9898\u76ee\u94fe\u63a5\uff1a[Luogu P2497](https://www.luogu.com.cn/problem/P2497)/[BZOJ 3006](http://www.lydsy.com/JudgeOnline/problem.php?id=3006)/SDOI2012 R2D1T3\u3002\n\n# \u9898\u76ee\n\n## \u9898\u76ee\u63cf\u8ff0\n\nup \u4e3b\u5bb6\u7ec8\u4e8e\u4e70\u7535\u8111\u4e86\uff0c\u4f46\u662f\u63a5\u4e0b\u6765\u6709\u5404\u79cd\u95ee\u9898\u8981\u5904\u7406\u3002\u9996\u8981\u89e3\u51b3\u7684\u95ee\u9898\u5c31\u662f\u7f51\u7edc\u95ee\u9898\u3002\u4ed6\u8981\u4ece\u79fb\u52a8\u516c\u53f8\u5f00\u59cb\uff0c\u901a\u8fc7\u4e00\u4e9b\u57fa\u7ad9\u6765\u4f20\u9012\u7f51\u7edc\u5230\u4ed6\u5bb6\u3002\n\n\u4e3a\u4e86\u7b80\u5316\u95ee\u9898\uff0c\u6211\u4eec\u5047\u8bbe\u79fb\u52a8\u516c\u53f8\uff0c\u6240\u6709\u7684\u57fa\u7ad9\uff0cup \u4e3b\u5bb6\u4f4d\u4e8e\u540c\u4e00\u6761\u76f4\u7ebf\u4e0a\uff0c\u4ed6\u4eec\u90fd\u4f4d\u4e8e\u8fd9\u4e00\u6761\u76f4\u7ebf\u4e0a\u7684\u67d0\u4e00\u70b9 $x$\uff0c\u8fd9\u4e9b\u70b9\u4e0d\u4f1a\u91cd\u5408\u3002\u6bcf\u4e2a\u57fa\u7ad9\u53d1\u5c04\u548c\u63a5\u6536\u7684\u8303\u56f4\u90fd\u662f\u4e00\u4e2a\u5207\u4e8e\u5730\u9762\u7684\u5706\uff0c\u53d1\u5c04\u7684\u534a\u5f84 $r_1$ \u662f\u56fa\u5b9a\u7684\uff0c\u63a5\u6536\u534a\u5f84 $r_2$ \u662f\u53ef\u8c03\u7684\u7684\u3002\u5982\u4e0b\u56fe\uff1a\n\n![](https://www.lu-anlai.com/wp-content/uploads/2020/04/SDOI2012-R2D1T3-Z3.png)\n\n\u4e00\u4e2a\u70b9 $i$ \u5982\u679c\u80fd\u4ece\u53e6\u4e00\u4e2a\u70b9 $j$ \u63a5\u6536\u5230\u4fe1\u53f7\uff08\u5f53\u4e14\u4ec5\u5f53 $x_j < x_i$)\uff0c\u5fc5\u987b\u6ee1\u8db3 $i$ \u7684\u63a5\u6536\u8303\u56f4\u4e0e $j$ \u7684\u53d1\u5c04\u8303\u56f4\u76f8\u5207\uff0c\u5e76\u4e14\u9700\u8981\u4ed8 $\\sqrt{r_{2,i}}$ \u7684\u989d\u5916\u8d39\u7528\u3002\u540c\u65f6\u542f\u52a8\u6bcf\u4e00\u4e2a\u70b9 $i$ \u90fd\u9700\u8981\u8d39\u7528 $v_i$\u3002\n\n\u5f53\u7136\u4e00\u4e2a\u70b9\u5982\u679c\u80fd\u591f\u53d1\u5c04\u7684 up \u4e3b\u5bb6\u53ea\u9700\u8981\u8fd9\u4e2a\u70b9\u7684\u53d1\u5c04\u8303\u56f4\u4e0e up \u4e3b\u5bb6\u6240\u5728\u7684\u7ad6\u7ebf\u76f8\u5207\u6216\u76f8\u4ea4\u5373\u53ef\uff0c\u5982\u4e0b\u56fe\uff1a\n\n![](https://www.lu-anlai.com/wp-content/uploads/2020/04/SDOI2012-R2D1T3-Z4.png)\n\n\u5f53\u7136\u8d39\u7528\u8d8a\u5c11\u5c31\u8d8a\u597d\u54af\uff0c\u4e8e\u662f up \u4e3b\u60f3\u8981\u8bf7\u4f60\u5e2e\u4ed6\u7684\u5fd9\u3002\n\n## \u6570\u636e\u8303\u56f4\n\n$$1\\leq n\\leq 5 \\times 10^6$$\n$$x_i,m\\leq 10^{12}$$\n$$v_i\\leq 10^4$$\n\n## \u65f6\u7a7a\u9650\u5236\n\n|\u9898\u76ee|\u65f6\u95f4\u9650\u5236|\u7a7a\u95f4\u9650\u5236|\n|:-:|:-:|:-:|\n|[Luogu P2497](https://www.luogu.com.cn/problem/P2497)|$$13\\text{s}$$|$$500\\text{MiB}$$|\n|[BZOJ 3006](http://www.lydsy.com/JudgeOnline/problem.php?id=3006)|$$?\\text{s}$$|$$?\\text{MiB}$$|\n|SDOI2012 R2D1T3|$$13\\text{s}$$|$$512\\text{MiB}$$|\n\n# \u9898\u89e3\n\n## \u601d\u8def\n\n\u9996\u5148\uff0c\u6211\u4eec\u8981\u6c42\u51fa $i,j$ \u4e4b\u95f4\u4fe1\u53f7\u4f20\u9012\u7684\u4ee3\u4ef7\u3002\n\n![](https://www.lu-anlai.com/wp-content/uploads/2020/04/SDOI2012-R2D1T3-Z1.png)\n\n![](https://www.lu-anlai.com/wp-content/uploads/2020/04/SDOI2012-R2D1T3-Z2.png)\n\n\u6240\u4ee5\u6839\u636e\u52fe\u80a1\u5b9a\u7406\u5f97\u5230\u5f0f\u5b50\uff1a\n\n$$(r_{2,i}+r_{1,j})^2=(r_{2,i}-r_{1,j})^2+(x_i-x_j)^2$$\n\n$$4r_{2,i}\\times r_{1,j}=(x_i-x_j)^2$$\n\n\u6240\u4ee5\u8054\u901a\u4ee3\u4ef7\u4e3a $\\sqrt{r_{2,i}}=\\frac{x_i-x_j}{2\\sqrt{r_{j}}}$\u3002\n\n\u8bbe $\\text{dp}_i$ \u4fe1\u53f7\u8fbe\u5230\u57fa\u7ad9 $i$ \u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u90a3\u4e48\u9996\u5148\u53ef\u4ee5\u770b\u51fa\uff1a\n\n$$\\text{dp}_1=v_1$$\n$$\\text{dp}_i=\\min_{j\\in[1,i-1]}(\\text{dp}_j+\\frac{x_i-x_j}{2\\sqrt{r_{j}}})+v_i$$\n\n\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u52a8\u6001\u89c4\u5212\u95ee\u9898\uff0c\u4e0a\u8ff0\u5f0f\u5b50\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(n^2)$\u3002\n\n\u7136\u540e\u8003\u8651\u4f18\u5316\uff0c\u8fd0\u7528\u6392\u9664\u6cd5\uff1a~~\u5355\u8c03\u961f\u5217~~\u3001\u659c\u7387\u4f18\u5316\u3002\n\n\u4e8e\u662f\u8003\u8651\u659c\u7387\u4f18\u5316\u3002\n\n1. \u5316\u7b80\u5f0f\u5b50\n\n\t\u8fdb\u884c\u79fb\u9879\n\t$$\\text{dp}_i-v_i-\\frac{1}{2\\sqrt{r_j}}\\times x_i=\\text{dp}_j-\\frac{x_j}{2\\sqrt{r_j}}$$\n\t\u7136\u540e\u8bbe $y=\\text{dp}_j-\\frac{x_j}{2\\sqrt{r_j}}$\uff0c$k=x_i$\uff0c$x=-\\frac{1}{2\\sqrt{r_j}}$\uff0c$b=\\text{dp}_i-v_i$\u3002\n    \n2. \u5206\u6790\n\n\t\u5206\u6790\u5f97\u51fa\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u662f\u8981\u4f7f\u5f97 $b$ \u6700\u5c0f\u5316\uff0c\u4e8e\u662f\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u5305\u5373\u53ef\u3002\n    \n    \u4f46\u662f\u53d1\u73b0\u672c\u9898\u4e2d $x=-\\frac{1}{2\\sqrt{r_j}}$ \u4e0d\u5355\u8c03\uff0c\u6240\u4ee5\u7528**\u795e\u5947\u65b9\u6cd5**\uff08\u4e0b\u6587\u4ecb\u7ecd\uff09\u7ef4\u62a4\u5373\u53ef\u3002\n\n## \u4ee3\u7801\n\n\u7ef4\u62a4\u51f8\u5305\u65b9\u6cd5\u6709\u5f88\u591a\uff1a\n\n1. \u4e0d\u7ef4\u62a4\uff0c\u8003\u8651\u57fa\u4e8e\u65f6\u95f4\u7684\u5206\u6cbb\u7b97\u6cd5\uff08CDQ \u5206\u6cbb\uff09\uff0c\u5c06\u6574\u4e2a\u533a\u95f4\u5206\u4e3a $\\log_2n$ \u4e2a\u51f8\u5305\uff0c\u4e00\u4e00\u6c42\u89e3\u5373\u53ef\uff0c\u7136\u540e\u5411\u5f52\u5e76\u6392\u5e8f\u4e00\u6837\u5408\u5e76\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(n\\log_2^2n)$\u3002\n2. Splay+\u4e8c\u8fdb\u5236\u5206\u7ec4\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(n\\log_2^2n)$\u3002\n3. \u674e\u8d85\u7ebf\u6bb5\u6811\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(n\\log_2n)$\u3002\n\n\u4e0b\u9762\u5c31\u662f\u674e\u8d85\u7ebf\u6bb5\u6811\u7684\u7248\u672c\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define reg register\ntypedef long long ll;\ntypedef double db;\n#define eps 1e-12 //\u7cbe\u5ea6\n#define INF 1e32 //\u6b63\u65e0\u7a77\n#define getchar()(p1==p2&&(p2=(p1=buf)+fread(buf,1,100000,stdin),p1==p2)?EOF:*p1++)\nstatic char buf[100000],*p1=buf,*p2=buf;\ninline ll read(void){ //\u5feb\u8bfb\uff0c\u8bb0\u5f97\u5f00 long long\n\treg bool f=false;\n\treg char ch=getchar();\n\treg ll res=0;\n\twhile(ch<'0'||'9'<ch)f|=(ch=='-'),ch=getchar();\n\twhile('0'<=ch&&ch<='9')res=10*res+ch-'0',ch=getchar();\n\treturn f?-res:res;\n}\n\nconst int MAXN=5000000+5;\n\nstruct Node{ //\u4fdd\u5b58\u57fa\u7ad9\u4fe1\u606f\n\tll x,r;\n\tint v;\n\tinline void Read(void){\n\t\tx=read(),r=read(),v=read();\n\t\treturn;\n\t}\n};\n\nint n;\nll m;\ndb dp[MAXN],ans;\nNode a[MAXN];\n\nstruct SegmentTree{ //\u674e\u8d85\u7ebf\u6bb5\u6811\n\t#define mid ( ( (l) + (r) ) >> 1)\n\tstruct Node{\n\t\tint son[2];\n\t\tdb k,b;\n\t};\n\tint tot;\n\tNode unit[MAXN];\n\tinline db f(reg db x,reg db kk,reg db bb){\n\t\treturn kk*x+bb;\n\t}\n\tinline void Query(reg ll l,reg ll r,reg int x,reg int y){\n\t\tif(x==0)\n\t\t\treturn;\n\t\tdp[y]=min(dp[y],f(a[y].x,unit[x].k,unit[x].b));\n\t\tif(a[y].x<=mid)\n\t\t\tQuery(l,mid,unit[x].son[0],y);\n\t\telse\n\t\t\tQuery(mid+1,r,unit[x].son[1],y);\n\t\treturn;\n\t}\n\tinline void Add(reg ll l,reg ll r,reg int x,db& k,db& b){\n\t\tif(x==0){\n\t\t\t++tot;\n\t\t\tunit[tot].k=k;\n\t\t\tunit[tot].b=b;\n\t\t\treturn;\n\t\t}\n\t\treg bool fl=(f(l,k,b)-f(l,unit[x].k,unit[x].b)>eps);\n\t\treg bool fr=(f(r,k,b)-f(r,unit[x].k,unit[x].b)>eps);\n\t\treg bool fm=(f(mid,k,b)-f(mid,unit[x].k,unit[x].b)>eps);\n\t\tif((fl)&&(fr)&&(fm))\n\t\t\treturn;\n\t\tif((!fl)&&(!fr)&&(!fm)){\n\t\t\tunit[x].k=k;\n\t\t\tunit[x].b=b;\n\t\t\treturn;\n\t\t}\n\t\treg bool s=(fm^fr);\n\t\tif(!fm){\n\t\t\tswap(unit[x].k,k);\n\t\t\tswap(unit[x].b,b);\n\t\t}\n\t\tif(s)\n\t\t\tAdd(mid+1,r,unit[x].son[s],k,b);\n\t\telse\n\t\t\tAdd(l,mid,unit[x].son[s],k,b);\n\t\tif(!unit[x].son[s])\n\t\t\tunit[x].son[s]=tot;\n\t\treturn;\n\t}\n\t#undef mid\n};\n\nSegmentTree T;\n\nint main(void){\n\tn=read(),m=read();\n\ta[1].Read(); //\u8bfb\u5165\u516c\u53f8\u4fe1\u606f\n\tfor(reg int i=2;i<=n;++i)\n\t\ta[i].Read(); //\u8bfb\u5165\u5176\u4ed6\u4fe1\u606f\uff08\u5176\u5b9e\u5b8c\u5168\u6ca1\u6709\u5fc5\u8981\u628a\u4e24\u4e2a\u5206\u5f00\uff09\n\tT.unit[1].k=1/(sqrt((db)a[1].r)*2); //\u521d\u59cb\u8282\u70b9\n\tT.unit[1].b=(db)(-a[1].x)/(sqrt((db)a[1].r)*2)+a[1].v;\n\tdp[1]=a[1].v;\n\tT.tot=1; //\u52a8\u6001\u5f00\u70b9\n\tfor(reg int i=2;i<=n;++i){ //\u52a8\u6001\u89c4\u5212\n\t\tdp[i]=INF;\n\t\tT.Query(a[1].x,a[n].x,1,i);\n\t\tdp[i]+=a[i].v;\n\t\tdb k=1/(sqrt((db)a[i].r)*2);\n\t\tdb b=(db)(-a[i].x)/(sqrt((db)a[i].r)*2)+dp[i];\n\t\tT.Add(a[1].x,a[n].x,1,k,b);\n\t}\n\tans=INF; //\u7edf\u8ba1\u7b54\u6848\n\tfor(reg int i=1;i<=n;++i)\n\t\tif(a[i].x+a[i].r>=m) //\u9898\u76ee\u5df2\u7ecf\u4fdd\u8bc1\u57fa\u7ad9\u4e00\u5b9a\u5728\u5bb6\u7684\u5de6\u8fb9\uff0c\u6ca1\u5fc5\u8981\u5224\u65ad x-r \u4e0e m \u7684\u5173\u7cfb\n\t\t\tans=min(ans,dp[i]);\n\tprintf(\"%.3lf\\n\",ans); //\u8f93\u51fa\u7b54\u6848\n\treturn 0;\n}\n```",
        "postTime": 1585999557,
        "uid": 38502,
        "name": "agicy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2497 \u3010[SDOI2012]\u57fa\u7ad9\u5efa\u8bbe\u3011"
    },
    {
        "content": "\u770b\u5230\u9898\u89e3\u533a\u4e2d\u7684\u674e\u8d85\u7ebf\u6bb5\u6811\u5168\u662f\u52a8\u6001\u5f00\u70b9\u7248\u7684\uff0c\u90a3\u6211\u5c31\u5199\u4e00\u7bc7\u79bb\u6563\u5316\u7684\u3002\n\n\u611f\u8c22@jiangchenyangsong\u5927\u4f6c\u4e3a\u6211\u63d0\u4f9b\u7684\u601d\u8def\u3002\n## \u524d\u7f6e\u77e5\u8bc6\uff1a\n\u521d\u4e2d\u6570\u5b66\u77e5\u8bc6\uff0c\u674e\u8d85\u7ebf\u6bb5\u6811\uff08\u60f3\u5b66\u659c\u7387\u4f18\u5316\u8bf7\u79fb\u6b65\u5176\u4ed6\u9898\u89e3\uff09\n\n\u9996\u5148\u9009\u4e0a\u79fb\u52a8\u516c\u53f8\uff1a \n\n$$f_1=v_1$$\n\n\u52fe\u80a1\u5b9a\u7406\u53ef\u5f97\uff1a\n\n$$(r_{1,j}+r_{2,i})^2=(r_{1,j}-r_{2,i})^2+(x_i-x_j)^2$$\n\n$$f_i=v_i+min(f_j+\\dfrac{x_i}{2\\sqrt{r_{1,j}}}-\\dfrac{x_j}{2\\sqrt{r_{1,j}}})$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u672c\u6765\u80fd\u659c\u7387\u4f18\u5316\uff0c\u4f46\u6211\u592a\u849f\u4e86\uff0c\u4e0d\u4f1acdq\uff0c\u5e73\u8861\u6811\u7b49\u5199\u6cd5\u6240\u4ee5\u5c31\u7528\u674e\u8d85\u7ebf\u6bb5\u6811\u3002\n\n\u8bbe $x=x_i$\uff0c$k=\\dfrac{1}{2\\sqrt{r_{1,j}}}$\uff0c$b=f_j-\\dfrac{x_j}{2\\sqrt{r_{1,j}}}$\n\n\u7ef4\u62a4\u7ebf\u6bb5\u7684\u6700\u5c0f\u503c\u5373\u53ef\u3002\n\n\u7531\u4e8e $x$ \u8fc7\u5927\uff0c\u6709 $10^{12}$\uff0c\u53ef\u4ee5\u52a8\u6001\u5f00\u70b9\uff0c\u4f46\u7531\u4e8e $x$ \u4ece\u5c0f\u5230\u5927\u8f93\u5165\uff0c\u521a\u597d\u4e3a\u79bb\u6563\u5316\u7701\u4e86\u4e00\u6b65\uff0c\u76f4\u63a5\u6620\u5c04\u5373\u53ef\u3002\n\n## code\n\u672c\u4eba\u674e\u8d85\u7ebf\u6bb5\u6811\u5199\u6cd5\u8f83\u4e3a\u5947\u602a\uff0c\u8bf7\u89c1\u8c05\n```cpp\n#include<bits/stdc++.h>\n#define N 500010\nusing namespace std;\nlong long read()\n{\n\tlong long x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9') f=(ch=='-')?-1:1,ch=getchar();\n\twhile(ch>='0'&&ch<='9') x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn x*f; \n}\nint tree[N<<2];\nlong long xx[N],v[N],r[N],tot=1;\ndouble k[N],b[N],f[N];\ndouble g(int x,int y){return k[y]*xx[x]+b[y];}\nvoid up(int u,int l,int r,int x)\n{\n\tif(!tree[u])\n\t{\n\t\ttree[u]=x;  \n\t\tif(l==r) return ;\n\t\tint mid=(l+r)>>1;\n\t\tup(u<<1,l,mid,x),up(u<<1|1,mid+1,r,x);\n\t\treturn;\n\t}\n\tif(l==r)\n\t{\n\t\tif(g(l,x)<g(l,tree[u])) tree[u]=x;\n\t\treturn;\n\t}\n\tdouble a1=g(l,x),a2=g(r,x),b1=g(l,tree[u]),b2=g(r,tree[u]);\n\tif(a1<=b1&&a2<=b2){tree[u]=x;return;}\n\tif(a1>b1&&a2>b2) return ;\n\tint mid=(l+r)>>1;\n\tup(u<<1,l,mid,x),up(u<<1|1,mid+1,r,x);\n\treturn;\n}\ndouble query(int u,int l,int r,int x)\n{\n\tif(l==r) return g(x,tree[u]);\n\tdouble ans=g(x,tree[u]);\n\tint mid=(l+r)>>1;\n\tif(x<=mid) return min(ans,query(u<<1,l,mid,x));\n\telse return min(ans,query(u<<1|1,mid+1,r,x));\n}\nint main()\n{\n\tlong long n=read(),m=read();\n\tfor(int i=1;i<=n;i++) xx[i]=read(),r[i]=read(),v[i]=read(),k[i]=1/(sqrt(r[i])*2),b[i]=-xx[i]/(sqrt(r[i])*2);\n\tf[1]=v[1],b[1]+=f[1],up(1,1,n,1);\n\tfor(int i=2;i<=n;i++) f[i]=query(1,1,n,i)+v[i],b[i]+=f[i],up(1,1,n,i);\n\tdouble minn=1e18;\n\tfor(int i=1;i<=n;i++)\n\t\tif(xx[i]+r[i]>=m)\n\t\t\tminn=min(minn,f[i]);\n\tprintf(\"%.3lf\\n\",minn);\n\treturn 0;\n}\n```\n",
        "postTime": 1668674038,
        "uid": 196631,
        "name": "xuzz",
        "ccfLevel": 6,
        "title": "P2497 [SDOI2012]\u57fa\u7ad9\u5efa\u8bbe"
    },
    {
        "content": "\u659c\u7387\u4f18\u5316dp\u6a21\u677f\u9898\n\n\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\u51fa\u4e00\u4e2a $O(n^2)$ \u7684\u5f0f\u5b50\uff1a\n\n$$\ndp_i=\\min (dp_j+v_i+\\frac{x_i-x_j}{2\\sqrt{r_j}})\n$$\n\n\u7136\u540e\u5957\u8def\u5730\u659c\u7387\u4f18\u5316\uff0c\u628a\u5b83\u6574\u7406\u6210 $b=y-kx$ \u7684\u5f62\u5f0f\uff0c\u5176\u4e2d $b$ , $k$ \u4e3a\u53ea\u542bi\u7684\u9879\uff0c $x$ , $y$ \u4e3a\u53ea\u542b $j$ \u7684\u9879\u3002\n\n\u7136\u540e\u5c31\u53d8\u6210\u4e86\u8fd9\u6837\uff1a\n\n$$\ndp_i-v_i=(dp_j-\\frac{x_j}{2\\sqrt{r_j}})+\\frac{1}{2\\sqrt{r_j}}x_i\n$$\n$$\ny=dp_j-\\frac{x_j}{2\\sqrt{r_j}}\n$$\n$$\nx=-\\frac{1}{2\\sqrt{r_j}}\n$$\n$$\nk=x_i\n$$\n$$\nb=dp_i-v_i\n$$\n$$\nb=y-kx\n$$\n\n\u7136\u540e\u53d1\u73b0 $x$ \u4e0d\u5355\u8c03\uff0c\u6240\u4ee5\u6211\u9009\u62e9\u7528splay\u7ef4\u62a4\u51f8\u5305\u3002\n\n\u6bcf\u6b21\u52a8\u6001\u63d2\u5165\u70b9\uff0c\u7ef4\u62a4\u5de6\u7ebf\u659c\u7387\u548c\u53f3\u7ebf\u659c\u7387\uff0c\u7136\u540e\u628a\u4e0d\u7b26\u5408\u51f8\u5305\u8981\u6c42\u7684\u70b9\u4e00\u6b21\u6027\u6254\u51fa\u53bb\uff0c\u5982\u679c\u63d2\u5165\u70b9\u5728\u51f8\u5305\u5185\u90e8\u4e5f\u76f4\u63a5\u6254\u3002\n\n\u5269\u4e0b\u7684\u5c31\u662f\u5e73\u8861\u6811\u677f\u5b50\u4e86\u3002\n\nCode:\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define N 500010\n#define ll long long\n#define eps (1e-10)\n#define inf (1e+30)\nstruct line{\n\tdouble k,b;\n\tline(double _k=0,double _b=0){k=_k,b=_b;}\n\tdouble val(double x){return k*x+b;}\n};\nstruct node{\n\tint ch[2],f,id;\n\tdouble x,y,lk,rk;\n};\nstruct SPLAY{\n\tnode d[N];\n\tint cnt,root;\n\t#define lc d[x].ch[0]\n\t#define rc d[x].ch[1]\n\tSPLAY(){\n\t\tcnt=1;\n\t\troot=0;\n\t}\n\tinline bool get(int x){\n\t\treturn d[d[x].f].ch[1]==x;\n\t}\n\tvoid turn(int x){\n\t\tint y=d[x].f,z=d[y].f,k=get(x);\n\t\td[y].ch[k]=d[x].ch[k^1],d[d[x].ch[k^1]].f=y;\n\t\td[y].f=x,d[x].ch[k^1]=y;\n\t\td[x].f=z;if(z)d[z].ch[d[z].ch[1]==y]=x;\n\t}\n\tvoid splay(int x,int goal=0){\n\t\twhile(d[x].f!=goal){\n\t\t\tint y=d[x].f,z=d[y].f;\n\t\t\tif(z!=goal)turn(get(y)==get(x)?y:x);\n\t\t\tturn(x);\n\t\t}\n\t\tif(!goal)root=x;\n\t}\n\tint query(int x,double k){\n\t\tif(!x)return 0;\n\t\tif(d[x].lk-eps<=k&&k<=d[x].rk+eps)return x;\n\t\tif(d[x].lk+eps>k)return query(d[x].ch[0],k);\n\t\telse return query(d[x].ch[1],k);\n\t}\n\tdouble slope(int x,int y){return (d[y].y-d[x].y)/(d[y].x-d[x].x);}\n\tint pre(){\n\t\tint x=d[root].ch[0],ret=x;\n\t\twhile(x){\n\t\t\tif(d[x].lk-eps<slope(x,root))ret=x,x=rc;\n\t\t\telse x=lc;\n\t\t}\n\t\treturn ret;\n\t}\n\tint post(){\n\t\tint x=d[root].ch[1],ret=x;\n\t\twhile(x){\n\t\t\tif(d[x].rk+eps>slope(root,x))ret=x,x=lc;\n\t\t\telse x=rc;\n\t\t}\n\t\treturn ret;\n\t}\n\tint ins(double x,double y,int idx){\n\t\tint u=root,v=0;\n\t\twhile(u)v=u,u=d[u].ch[d[u].x<x];\n\t\tu=cnt++;d[u].x=x,d[u].y=y,d[u].id=idx;\n\t\tif(v){d[v].ch[d[v].x<x]=u;d[u].f=v;}\n\t\telse root=u;\n\t\treturn u;\n\t}\n\tvoid insert(double vx,double vy,int idx){\n\t\tint x=ins(vx,vy,idx);\n\t\tsplay(x);\n\t\tif(lc){\n\t\t\tint y=pre();\n\t\t\tsplay(y,x);\n\t\t\td[y].ch[1]=0;\n\t\t\td[y].rk=d[x].lk=slope(y,x);\n\t\t}else d[x].lk=-inf;\n\t\tif(rc){\n\t\t\tint y=post();\n\t\t\tsplay(y,x);\n\t\t\td[y].ch[0]=0;\n\t\t\td[y].lk=d[x].rk=slope(y,x);\n\t\t}else d[x].rk=inf;\n\t\tif(d[x].lk>d[x].rk+eps){\n\t\t\tint y=lc;\n\t\t\troot=y;d[y].f=0,d[y].ch[1]=rc,d[rc].f=y;\n\t\t\td[y].rk=d[rc].lk=slope(y,rc);\n\t\t}\n\t}\n\tvoid pnt(int x){\n\t\tif(!x)return;\n\t\tpnt(lc);\n\t\tprintf(\"(%lf,%lf) \",d[x].x,d[x].y);\n\t\tpnt(rc);\n\t}\n\tvoid print(){\n\t\tprintf(\"CONV:\");\n\t\tpnt(root);\n\t\tprintf(\"\\n\");\n\t}\n}s;\nint n,m;\ndouble dp[N],x[N],r[N],v[N];\nint main(){/*\n\twhile(1){\n\t\tdouble x,y;\n\t\tscanf(\"%lf%lf\",&x,&y);\n\t\ts.insert(x,y,0);\n\t\ts.print();\n\t}*/\n\tscanf(\"%d%d\",&n,&m);\n\tdouble ans=inf;\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%lf%lf%lf\",x+i,r+i,v+i);\n\t\tif(i==1){\n\t\t\tdp[i]=v[i];s.insert(-1/(2*sqrt(r[i])),dp[i]-x[i]/(2*sqrt(r[i])),i);continue;\n\t\t}\n\t\tint j=s.query(s.root,x[i]);\n\t\tdp[i]=dp[j]+v[i]+(x[i]-x[j])/(2*sqrt(r[j]));\n\t\t//printf(\"%d chooses %d,dp[%d]=%.3lf\\n\",i,j,i,dp[i]);\n\t\ts.insert(-1/(2*sqrt(r[i])),dp[i]-x[i]/(2*sqrt(r[i])),i);\n\t\tif(x[i]+r[i]+eps>=m){\n\t\t\tans=min(ans,dp[i]);\n\t\t}\n\t}\n\tprintf(\"%.3lf\\n\",ans);\n\treturn 0;\n}\n```\n\n\n",
        "postTime": 1630733943,
        "uid": 92840,
        "name": "Komodo",
        "ccfLevel": 9,
        "title": "P2497 [SDOI2012]\u57fa\u7ad9\u5efa\u8bbe"
    },
    {
        "content": "\u697c\u4e0b\u8bf4 CDQ \u662f\u4e24\u53ea log \u7684\uff1f\u5e76\u4e0d\u89c1\u5f97\u2026\u2026\u4ed6\u8981\u4e48\u7b14\u8bef\u4e86\u8981\u4e48\u5ffd\u7565\u4e86 $x_i$ \u662f\u5355\u8c03\u7684\u8fd9\u4e00\u4e8b\u5b9e\n\n\u9996\u5148\u7a0d\u5fae\u51e0\u4f55\u5206\u6790\u4e00\u4e0b\u5217\u51fa\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n\n$$ dp_i=\\min_{j=1}^{i-1} dp_j+\\frac{x_i-x_j}{2\\sqrt{r_j}}+V_i $$\n\n$$ dp_1=V_1 $$\n\n\u8fd9\u6837\u5e72\u63a8\u662f $O(n^2)$ \u7206\u70b8\uff0c\u60f3\u5230\u80fd\u659c\u7387\u4f18\u5316\uff0c\u7136\u540e\u6574\u7406\u6210\u5173\u4e8e $j$ \u7684\u4e00\u6b21\u51fd\u6570\u7684\u5f62\u5f0f\n\n$$ \\frac{x_j}{2\\sqrt{r_j}}-dp_j=x_i(\\frac{1}{2\\sqrt{r_j}})+V_i-dp_i $$\n\n\u8fd9\u91cc\u8981 $dp_i$ \u6700\u5c0f\u5c31\u8981\u8ba9\u622a\u8ddd\u6700\u5c0f\uff0c\u7ef4\u62a4\u4e0a\u51f8\u58f3\n\n\u53d1\u73b0\u51f8\u5305\u7684 x \u5750\u6807\u5e76\u4e0d\u5355\u8c03\uff0c\u6240\u4ee5\u51b3\u5b9a\u7528 CDQ\u5206\u6cbb \u7ef4\u62a4\u4e00\u4e0b\n\n\u53c8\u53d1\u73b0\u659c\u7387 $x_i$ \u662f\u5355\u8c03\u9012\u589e\u7684\uff0c\u6240\u4ee5\u5728\u51f8\u5305\u4e0a\u627e\u70b9\u65f6\u4e0d\u7528\u4e8c\u5206\uff0c\u4ece\u540e\u5f80\u524d\u5220\u70b9\u5c31\u884c\u4e86\n\n\u6ce8\u610f\u8bb0\u5f97\u628a\u70b9\u6309 $x=\\frac{1}{2\\sqrt{r_i}}$ \u5f52\u5e76\u6392\u5e8f\u4e00\u4e0b\n\n\u6700\u540e\n\n$$ ans=\\min_{1\\leq i \\leq n\\space,\\space x_i+r_i\\geq m } dp_i $$\n\n\u65f6\u95f4 $O(n \\log n)$ \u7a7a\u95f4 $O(n)$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\ntypedef long double ld;\ntypedef double dbl;\ntypedef long long ll;\n\nconst int MAXN=5e6;\nconst ld MAXV=1e13;\n\nint n;ld m,ans=MAXV;\nld x[MAXN+5],R1[MAXN+5],V[MAXN+5];\nld dp[MAXN+5],X[MAXN+5],Y[MAXN+5];\nint A[MAXN+5],Q[MAXN+5],Tail;\n\nld K(int a,int b) {return (Y[b]-Y[a])/(X[b]-X[a]);}\n\nvoid CDQ(int L,int R)\n{\n\tif(L==R) {Y[L]=x[L]*X[L]-dp[L];return;}\n\tint mid=(L+R)>>1;\n\tCDQ(L,mid);\n\tTail=0;\n\tfor(int i=L;i<=mid;i++)\n\t{\n\t\twhile(Tail>1)\n\t\t{\n\t\t\tif(X[Q[Tail]]==X[A[i]])\n\t\t\t{\n\t\t\t\tif(Y[Q[Tail]]<Y[A[i]]) --Tail;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse if(K(Q[Tail-1],Q[Tail])<=K(Q[Tail],A[i])) --Tail;\n\t\t\telse break;\n\t\t}\n\t\tQ[++Tail]=A[i];\n\t}\n\t//printf(\"[%d,%d] %d\\n\",L,R,Tail);\n\t//for(int i=1;i<Tail;i++) cout<<K(Q[i],Q[i+1])<<' ';cout<<endl;\n\t//for(int i=1;i<=Tail;i++) printf(\"%d \",Q[i]);printf(\"\\n\");\n\t//for(int i=1;i<=Tail;i++) cout<<Y[Q[i]]<<' ';cout<<endl;\n\t//for(int i=1;i<=Tail;i++) cout<<X[Q[i]]<<' ';cout<<endl;\n\tfor(int i=mid+1;i<=R;i++)\n\t{\n\t\twhile(Tail>1)\n\t\t\tif(K(Q[Tail-1],Q[Tail])<=x[i]) --Tail;\n\t\t\telse break;\n\t\tdp[i]=min(dp[i],dp[Q[Tail]]+(x[i]-x[Q[Tail]])*X[Q[Tail]]+V[i]);\n\t\t//for(int j=L;j<=mid;j++) dp[i]=min(dp[i],dp[j]+(x[i]-x[j])*X[j]+V[i]);\n\t}\n\tCDQ(mid+1,R);\n\tTail=L-1;\n\tfor(int i=L,j=mid+1;i<=mid || j<=R;)\n\t\tif(i<=mid && j<=R)\n\t\t{\n\t\t\tif(X[A[i]]<X[A[j]]) Q[++Tail]=A[i],++i;\n\t\t\telse Q[++Tail]=A[j],++j;\n\t\t}\n\t\telse if(i<=mid) Q[++Tail]=A[i],++i;\n\t\telse Q[++Tail]=A[j],++j;\n\tfor(int i=L;i<=R;i++) A[i]=Q[i];\n}\n\nint main()\n{\n\tscanf(\"%d\",&n),cin>>m;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tcin>>x[i]>>R1[i]>>V[i];\n\t\tif(R1[i]==0) {--i,--n;continue;}\n\t\tX[i]=sqrt(R1[i])/(2*R1[i]);\n\t\tA[i]=i;\n\t}\n\tdp[1]=V[1];\n\tfor(int i=2;i<=n;i++) dp[i]=MAXV;\n\tCDQ(1,n);\n\t//for(int i=1;i<=n;i++) cout<<dp[i]<<' ';cout<<endl;\n\t//for(int i=1;i<=n;i++) cout<<Y[i]<<' ';cout<<endl;\n\t//for(int i=1;i<=n;i++) cout<<X[i]<<' ';cout<<endl;\n\tfor(int i=1;i<=n;i++)\n\t\tif(x[i]+R1[i]>=m) ans=min(ans,dp[i]);\n\tprintf(\"%.3lf\\n\",(double)ans);\n\treturn 0;\n}\n/*\n10 33\n5 4 660\n10 2 2040\n11 6 3207\n14 5 2006\n18 3 6130\n19 9 3363\n22 1 1265\n25 8 2836\n27 10 7961\n29 7 9075\n*/\n```\n\n\u6ce8\u610f\u628a\u8981\u7b97\u7684\u6839\u53f7\u9884\u5904\u7406\u597d\u907f\u514d\u5728\u7ebf\u6c42\uff0c\u4ee5\u9632\u88ab\u5361\u5e38",
        "postTime": 1611060768,
        "uid": 54591,
        "name": "Seauy",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2497 \u3010[SDOI2012]\u57fa\u7ad9\u5efa\u8bbe\u3011"
    },
    {
        "content": "\u6bd4\u8f83\u5957\u8def\u7684 cdq \u641e\u51f8\u5305\u7684\u6e05\u65b0\u9898\u76ee\u3002\n\n\u9996\u5148\u8003\u8651\u7b97\u4e00\u4e0b\u8d39\u7528\u3002\u6211\u4eec\u53d1\u73b0\u4ece $j$ \u8fde\u63a5\u5230 $i$ \u7684\u8d39\u7528\u4e3a $\\frac{x_i-x_j}{2\\sqrt{r_j}}$\u3002\u8bbe $t_i=\\frac{1}{\\sqrt{r_i}}$\u3002\n\n\u505a\u4e00\u4e2a\u666e\u901a\u7684 DP\u3002$f_i$ \u4ee3\u8868\u5fc5\u9009 $i$ \u57fa\u7ad9\uff0c\u4ece\u79fb\u52a8\u516c\u53f8\u8fde\u5230 $i$ \u7684\u6700\u5c11\u8d39\u7528\u3002\n\n$$\nf_i=\\min f_j+(x_i-x_j)t_j+v_i\n$$\n\n\u8f6c\u5316\u4e00\u4e0b\u3002\n\n$$\nf_i=v_i+\\min (f_j-x_jt_j)+x_it_j\n$$\n\n\u8fd9\u662f\u4e00\u4e2a\u53ef\u4ee5\u659c\u7387\u4f18\u5316\u7684\u4e1c\u897f\u3002\u628a\u6bcf\u4e2a\u72b6\u6001\u8003\u8651\u6210\u70b9 $(t_j,f_j-x_jt_j)$\uff0c\u6bcf\u6b21\u8f6c\u79fb\u76f8\u5f53\u4e8e\u7528\u659c\u7387\u4e3a $-x_i$ \u7684\u7ebf\u53bb\u5207\u8fd9\u4e9b\u70b9\u5e76\u5e0c\u671b\u80fd\u5f97\u5230\u4e00\u4e2a\u6700\u5c0f\u7684\u622a\u8ddd\u3002\u5bb9\u6613\u53d1\u73b0\u8fd9\u9700\u8981\u7ef4\u62a4\u4e0b\u51f8\u58f3\u3002\n\n\u7531\u4e8e $t$ \u4e0d\u5355\u8c03\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u7528 cdq \u5206\u6cbb\u3002\u6700\u5f00\u59cb\u5df2\u7ecf\u6309\u7167 $x_i$ \u6392\u5e8f\uff0c\u6240\u4ee5\u5c31\u4e0d\u9700\u8981\u6709\u4ec0\u4e48\u64cd\u4f5c\u4e86\u3002cdq \u5206\u6cbb\u7684\u65f6\u5019\uff0c\u5148\u5206\u6cbb\u5de6\u8fb9\uff0c\u7136\u540e\u6c42\u51fa\u5de6\u8fb9\u7684\u70b9\u7ec4\u6210\u7684\u4e00\u4e2a\u4e0b\u51f8\u58f3\uff08\u7528\u4e2a\u5355\u8c03\u6808\uff09\uff0c\u7136\u540e\u66f4\u65b0\u53f3\u8fb9\uff0c\u7136\u540e\u518d\u5206\u6cbb\u53f3\u8fb9\uff08\u5957\u8def\u7684\uff09\uff0c\u6700\u540e\u6309\u7167 $t$ \u5f52\u5e76\u4e00\u4e0b\u3002\n\n\u8fd9\u9898\u5982\u679c\u4e0d\u5f52\u5e76\u7684\u8bdd\u590d\u6742\u5ea6\u4f1a $O(n\\log^2n)$\uff0c\u5c3d\u7ba1\u53ef\u4ee5\u5728\u6d1b\u8c37\u4e0a\u8fc7\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u662f\u6ca1\u6cd5\u8fc7 $5\\times 10^6$ \u7684\u3002\u7528\u4e86\u5f52\u5e76\u6392\u5e8f\u5c31\u53ef\u4ee5\u53d8\u6210 $O(n\\log n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define fi first\n#define se second\n#define rep(i,a,b) for(int i=(a);i<=(b);i++)\n#define per(i,a,b) for(int i=(a);i>=(b);i--)\nusing namespace std;\nconst int N=5e6+9;\ntypedef pair<int,int>pii;\ntypedef double ld;\n\ninline long long read() {\n\tlong long res=0, w=1; char c=getchar();\n\twhile(!isdigit(c)) {if(c=='-') w=-1; c=getchar();}\n\twhile(isdigit(c)) {res=res*10+c-48; c=getchar();}\n\treturn res*w;\n}\n\nint n,m,x[N],r[N],v[N],q[N],lc,rc;\nld t[N],f[N];\n\nstruct node {ld x,y;} p[N],la[N];\nbool cmp(const node &a,const node &b) {return a.x<=b.x;}\n\nbool cmp1(ld ax,ld ay,ld bx,ld by,ld cx,ld cy) { //slope(a,b)>slope(b,c)\n\treturn (by-ay)*(cx-bx)>(bx-ax)*(cy-by);\n}\nld calc(int j,int i) {\n\treturn v[i]+p[j].y+x[i]*p[j].x;\n}\n\nvoid cdq(int l,int r) {\n\tif(l==r) {\n\t\tp[l].x=t[l], p[l].y=f[l]-x[l]*t[l];\n\t\treturn;\n\t}\n\tint mid=(l+r)/2;\n\tcdq(l,mid);\n\tint top=0;\n\trep(i,l,mid) {\n\t\twhile(top>1&&cmp1(p[q[top-1]].x,p[q[top-1]].y,p[q[top]].x,p[q[top]].y,p[i].x,p[i].y)) top--;\n\t\tq[++top]=i;\n\t}\n\trep(i,mid+1,r) {\n\t\twhile(top>1&&calc(q[top-1],i)<calc(q[top],i)) top--;\n\t\tf[i]=min(f[i],calc(q[top],i));\n\t}\n\tcdq(mid+1,r);\n\tint i=l,j=mid+1,t=0;\n\twhile(i<=mid&&j<=r) {\n\t\tif(cmp(p[i],p[j])) la[++t]=p[i++];\n\t\telse la[++t]=p[j++];\n\t}\n\twhile(i<=mid) la[++t]=p[i++];\n\twhile(j<=r) la[++t]=p[j++];\n\tt=0;\n\trep(i,l,r) p[i]=la[++t];\n}\n\nsigned main() {\n\tn=read(), m=read();\n\trep(i,1,n) {\n\t\tx[i]=read(), r[i]=read(), v[i]=read();\n\t\tt[i]=1/(2*sqrt(r[i]));\n\t}\n\trep(i,2,n) f[i]=2e18; f[1]=v[1];\n\tcdq(1,n);\n\tld ans=2e18;\n\trep(i,1,n) if(x[i]+r[i]>=m) ans=min(ans,f[i]);\n\tprintf(\"%.3lf\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1630721812,
        "uid": 180652,
        "name": "_lgswdn",
        "ccfLevel": 0,
        "title": "P2497 [SDOI2012]\u57fa\u7ad9\u5efa\u8bbe"
    },
    {
        "content": "\u8003\u8651 $i$ \u5411 $j$ \u53d1\u5c04\u7684\u4ee3\u4ef7\uff08\u5706\u5916\u7684 $i,j$ \u5199\u53cd\u4e86 QAQ\uff09\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/gl7k7jgw.png)\n\n\u8bfb\u56fe\u53ef\u77e5\uff1a$(R_i+R_j)^2=(R_i-R_j)^2+(X_i-X_j)^2$\u3002\n\n\u89e3\u5f97 $\\sqrt {R_j}=\\dfrac{x_i-x_j}{2\\sqrt{R_i}}$\u3002\n\n\u6545\u4ee4 $dp_i$ \u8868\u793a $i(1<i\\leq n)$ \u70b9\u63a5\u6536\u5230\u4fe1\u53f7\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u5219\u6709\uff1a\n\n$$\\begin{aligned} \ndp_i & =\\min_{1\\leq j< i}\\{dp_j+\\dfrac{x_i-x_j}{2\\sqrt{R_j}}\\}+v_i\\\\\n&=\\min_{1\\leq j< i}\\{dp_j-\\dfrac{x_j}{2\\sqrt{R_j}}+\\dfrac{x_i}{2\\sqrt{R_j}}\\}+v_i\\end{aligned}$$\n\n\u663e\u7136\uff0c\u8003\u8651\u659c\u7387\u4f18\u5316\uff0c\u5219\uff1a\n\n$$\\begin{cases}\nX_j=\\dfrac{1}{2\\sqrt{R_j}}\\\\\nY_j=dp_j-\\dfrac{x_j}{2\\sqrt{R_j}}\\\\\nK_i=x_i\n\\end{cases}$$\n\n\u7531\u4e8e $K,X$ \u90fd\u65e0\u5355\u8c03\u6027\uff0c\u6545\u79bb\u6563\u5316 $K$ \u540e\u4f7f\u7528\u674e\u8d85\u7ebf\u6bb5\u6811\u7ef4\u62a4\u3002\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n#include <cmath>\n\n#define N 500010\nint n, m;\ndouble x_[N], r[N], v[N];\ndouble dp[N];\nint p[N];\n\nstruct Tree\n{\n\tdouble k, b;\n\tTree(double _ = 0, double __ = 1000000000000000)\n\t{\n\t\tk = _, b = __;\n\t}\n\tdouble calc(int x)\n\t{\n\t\treturn k * x_[x] + b;\n\t}\n}tr[N << 2];\n\n#define lson k << 1\n#define rson k << 1 | 1\n\nvoid change(int k, int l, int r, Tree z)\n{\n\tint mid = (l + r) >> 1;\n\tif(z.calc(mid) < tr[k].calc(mid))\n\t\tstd::swap(z, tr[k]);\n\tif(z.calc(l) < tr[k].calc(l))\n\t\tchange(lson, l, mid, z);\n\tif(z.calc(r) < tr[k].calc(r))\n\t\tchange(rson, mid + 1, r, z);\n}\n\ndouble query(int k, int l, int r, int q)\n{\n\tdouble res = tr[k].calc(q);\n\tif(l == r)\n\t\treturn res;\n\tint mid = (l + r) >> 1;\n\tif(q <= mid)\n\t\treturn std::min(res, query(lson, l, mid, q));\n\telse\n\t\treturn std::min(res, query(rson, mid + 1, r, q));\n}\n\ndouble K(int i){return 1.0 / (2.0 * sqrt(r[i])); }\ndouble B(int i){return dp[i] - 1.0 * x_[i] / (2.0 * sqrt(r[i])); }\n\nint main()\n{\n\tscanf(\"%d%d\", &n, &m);\n\tfor(int i = 1; i <= n; i++)\n\t\tscanf(\"%lf%lf%lf\", &x_[i], &r[i], &v[i]);\n\tdp[1] = v[1];\n\tchange(1, 1, n, (Tree){K(1), B(1)});\n\tdouble ans = 1000000000000000;\n\tfor(int i = 2; i <= n; i++)\n\t{\n\t\tdp[i] = query(1, 1, n, i) + v[i];\n\t\tchange(1, 1, n, (Tree){K(i), B(i)});\n\t\tif(x_[i] + r[i] >= m)\n\t\t\tans = std::min(ans, dp[i]);\n\t}\n\tprintf(\"%.3f\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1681894861,
        "uid": 371968,
        "name": "ningago",
        "ccfLevel": 4,
        "title": "P2497"
    },
    {
        "content": "\u6211\u6b64\u523b\u7684\u5fc3\u60c5\u65e0\u6cd5\u7528\u8bed\u8a00\u63cf\u8ff0\u3002\n\n\u672c\u6765\u662f\u4e00\u9053\u659c\u7387\u4f18\u5316\u677f\u9898\uff0c\u7136\u800c\u6211\u8c03\u4e86\u4e00\u4e2a\u767d\u5929\u624d\u8c03\u51fa\u6765\u3002\n\n\u6211\u771f\u7684\u597d\u8212\u7545\u554a\u3002\n\n\n\n------------\n~~\u5e9f\u8bdd\u5230\u6b64\u7ed3\u675f~~\n\n\u6b64\u7bc7\u9898\u89e3\u4ec5\u8bb2\u89e3\u666e\u901a\u7684\u7ef4\u62a4\u659c\u7387\u4f18\u5316DP\u7684\u65b9\u5f0f\uff08\u672c\u7bc7\u5e94\u8be5\u662f\u4e3a\u6570\u4e0d\u591a\u4f7f\u7528vector\u7684\uff09\u3002\n\n\u5982\u679c\u5bf9\u659c\u7387\u4f18\u5316DP\u5f88\u4e0d\u719f\u6089\uff0c\u53ef\u4ee5\u770b\u4e0b\u8fd9\u7bc7\u66f4\u57fa\u7840\u7684[\u535a\u5ba2](https://www.luogu.com.cn/blog/liaoji/xie-shuai-you-hua-dp)\n\n\u659c\u7387\u4f18\u5316DP\u7684\u7279\u70b9:\n\n$$F_i=min_{1\\le j<i} (F_j\\times...+...)$$\n\n\u5bf9\u4e8e\u666e\u901a\u7684\u53d6\u524d\u51e0\u4e2a\u7684min\u7684DP\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u7528\u5355\u8c03\u961f\u5217\u8fdb\u884c\u4f18\u5316\uff0c\u7136\u800c\u5f53\u8fd9\u4e2a\u5f0f\u5b50\u590d\u6742\u5316\uff0c\u5c31\u4e0d\u597d\u76f4\u63a5\u53d6\u4e86\uff0c\u4e8e\u662f\u4fbf\u6709\u4e86\u659c\u7387\u4f18\u5316\uff0c\u5176\u5b9e\u8fd9\u771f\u7684\u662f\u4e00\u79cd\u5f88\u597d\u7528\u7684\u4f18\u5316\u65b9\u5f0f\u3002\n\n\u9996\u5148\u5206\u6790\u9898\u76ee\uff0c\u53d1\u5c04\u8303\u56f4\u548c\u63a5\u6536\u8303\u56f4\u90fd\u662f\u548c\u5730\u9762\u76f8\u5207\u7684\u5706\uff0c\u6bcf\u9009\u62e9\u4e00\u4e2a\u4e2d\u8f6c\u7ad9\uff0c\u90fd\u4f1a\u591a\u82b1\u8d39$sqrt(r2_i)+v_i$\u7684\u4ee3\u4ef7\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u627e\u5230\u4e00\u4e2a\u6c42$r2_i$\u7684\u65b9\u5f0f\u3002\n\n\u5982\u56fe\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/gcdkcv6w.png)\n\n\u7531\u6b64\u6211\u4eec\u5f97\u5230$sqrt(r2_i)=(x_i-x_j)/2sqrt(r1_j)$\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u63a8DP\u5f0f\u5b50\u4e86($F_i$\u8868\u793a\u7528\u57fa\u7ad9i\u4f20\u8f93\u7684\u6700\u5c0f\u82b1\u8d39\uff09\uff1a\n\n$$F_i=min_{1\\le j<i}(F_j+(x_i-x_j)/2sqrt(r1_j)+v_i)$$\n\n\u628amin\u53bb\u6389\uff0c\u6574\u7406\u5f0f\u5b50\u5f97\u5230\uff1a\n\n$$x_j-2sqrt(r1_j)F_j-x_i=(v_i-F_i)2sqrt(r1_j)$$\n\n\u6211\u4eec\u53ef\u4ee5\u5427\u8fd9\u4e2a\u5f0f\u5b50\u770b\u6210\u4ee5$2sqrt(r1_j)$\u4e3a\u6a2a\u5750\u6807\uff0c$x_j-2sqrt(r1_j)F_j-x_i$\u4e3a\u7eb5\u5750\u6807\u7684\u76f4\u7ebf\u3002\n\n\u6ce8\u610f\uff1a\u6211\u4e00\u5f00\u59cb\u628a\u4e0e$2sqrt(r1_j)$\u6709\u5173\u7684\u5f0f\u5b50\u5168\u90e8\u5408\u5e76\u4e86\uff0c\u628a$F_j$\u4e5f\u653e\u5230\u4e86\u659c\u7387\u91cc\uff08\u8fd9\u4e2a\u9519\u8bef\u8ba9\u6211\u8c03\u4e86\u5f88\u4e45\uff09\uff0c\u8fd9\u662f\u4e07\u4e07\u4e0d\u53ef\u7684\uff0c\u4e0e$i$\u6709\u5173\u7684\u9879\u91cc\u4e00\u5b9a\u4e0d\u80fd\u51fa\u73b0$j$ !\n\n\u8fd9\u4e2a\u5f0f\u5b50\u4e0e\u6211\u6240\u505a\u8fc7\u7684\u9898\u76ee\u8fd8\u662f\u6709\u6240\u4e0d\u540c\u7684\uff0c\u4e4b\u524d\u7684$F_i$\u90fd\u5728\u622a\u8ddd\u91cc\uff0c\u800c\u8fd9\u4e2a\u5f0f\u5b50\u91cc$F_i$\u5728\u659c\u7387\u91cc\uff0c\u4e0d\u8fc7\u90fd\u4e00\u6837\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a$i$\u53ea\u6709\u5f53\u659c\u7387\u6700\u5927\u65f6\uff0c$F_i$\u624d\u6700\u5c0f\u3002\n\n\u4e8e\u662f\u6211\u4eec\u91c7\u7528\u5e38\u89c4\u601d\u8def\uff1a\u7ef4\u62a4\u51f8\u5305\u3002\n\n\u5bf9\u4e8e\u6b64\u9898\u6211\u4eec\u53d1\u73b0\uff0c\u4e0b\u51f8\u7684\u70b9\u4e00\u5b9a\u4e0d\u662f\u6700\u4f18\u7684\uff08\u753b\u4e2a\u56fe\u5c31\u660e\u767d\u4e86\uff09\u3002\u800c\u5bf9\u4e8e\u4e0a\u51f8\u5305\uff0c\u5047\u8bbe\u6700\u4f18\u89e3\u70b9\u4e3a$j$\u90a3\u4e48$j$\u5fc5\u5b9a\u662f**\u7b2c\u4e00\u4e2a\u5230\u5b83\u53f3\u4fa7\u70b9\u659c\u7387\u5c0f\u4e8e\u8fd9\u4e2a\u70b9\u5230\u539f\u70b9\u659c\u7387\u7684\u70b9**\u3002\n\n\u5982\u56fe\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/i7jzzkbr.png)\n\n\u5bf9\u4e8e\u4e0d\u540c\u7684$i$\u8fd9\u4e9b\u70b9\u4e4b\u95f4\u7684\u76f8\u5bf9\u4f4d\u7f6e\u76f8\u540c\uff0c\u800c\u4e0e\u539f\u70b9\u7684\u76f8\u5bf9\u4f4d\u7f6e\u4e0d\u540c\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u76f8\u5bf9\u4f4d\u7f6e\u4e0a\u659c\u7387\u5355\u8c03\u9012\u51cf\u7684\u4e0a\u51f8\u5305\u3002\n\n\u8fd9\u65f6\u6211\u4eec\u53d1\u73b0\u4e86\u53e6\u4e00\u4e2a\u95ee\u9898\uff0c\u9898\u76ee\u4e2d\u7ed9\u7684$r1$\u5e76\u4e0d\u662f\u5355\u8c03\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u4e0d\u80fd\u76f4\u63a5\u7528\u5355\u8c03\u6808\u6765\u7ef4\u62a4\u51f8\u5305\u3002\u56e0\u4e3a$r1$\u662f1...n\u7684\u4e00\u79cd\u6392\u5217\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5f00\u4e00\u4e2a\u6570\u7ec4\u5b58\u653e\uff0c\u7136\u540e\u7528set\u7ef4\u62a4\u53ef\u7528\u7684\u4e0b\u6807\uff0c\u53ef\u4ee5\u505a\u5230\u7a33\u5b9a$O(nlogn)$\u7684\u590d\u6742\u5ea6\u3002\n\n\u7136\u800c\u6211\u89c9\u5f97\u8fd9\u6837\u5199\u597d\u9ebb\u70e6\uff0c\u6240\u4ee5\u4fbf\u7528\u4e86vector\uff0cvector\u7684\u63d2\u5165\u548c\u5220\u9664\u53ef\u4ee5\u770b\u505a\u4ecb\u4e8e\u6839\u53f7\u81f3log\u4e4b\u95f4\u7684\u590d\u6742\u5ea6\uff08\u5f53\u7136\u53ef\u4ee5\u9020\u6570\u636e\u5361\uff09\uff0cO2\u4e0b\u8dd1\u5f97\u66f4\u5feb\uff0c\u4e8e\u662f\u6211\u4eec\u7528\u66b4\u529bA\u6389\u4e86\u6b64\u9898\u5e76\u83b7\u5f97\u4e86\u6700\u4f18\u89e3\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef double lb;//\u6211\u4e00\u5f00\u59cb\u7528\u7684long double\uff0c\u5176\u5b9e\u4e0d\u7528 \ninline ll qr() {//\u5feb\u8bfb \n\tll k=0;char ch=getchar();while(!isdigit(ch))ch=getchar();\n\twhile(isdigit(ch)){k=(k<<1)+(k<<3)+(ch^48);ch=getchar();}\n\treturn k;\n}\nconst int N=5e5+2;\nint n,v[N];\nll s,x[N],r1[N];\nstruct node{//\u5b58\u653e\u6bcf\u4e2a\u70b9 \n\tlb x,y; \n\tbool operator < (const node &nx)const{\n\t\treturn x<nx.x;\n\t}\n};\nvector<node>p;\nlb ans=(lb)LONG_LONG_MAX;\nint main() {\n\tn=qr(),s=qr();\n\tfor(int i=1;i<=n;i++) \n\t\tx[i]=qr(),r1[i]=qr(),v[i]=qr();\n\tif(r1[1]>=s-x[1]) {printf(\"%.3f\",1.0*v[1]);return 0;}//\u5982\u679c\u4ece\u57fa\u7ad9\u80fd\u76f4\u63a5\u4f20\u5230\u5bb6\u91cc\uff0c\u7279\u5224\u4e00\u4e0b \n\tp.push_back((node){2.0*(lb)sqrt(r1[1]),1.0*x[1]-2.0*(lb)sqrt(r1[1])*v[1]});\n\tlb m1,m2,f,xx,yy;int it;\n\tfor(int i=2,l,r,mid;i<=n;i++) {\n\t\tl=1,r=(int)p.size()-1;\n\t\twhile(l<=r) {//\u4e8c\u5206\u67e5\u627e\u6700\u4f18\u89e3\uff08\u9898\u89e3\u4e2d\u6709\u89e3\u6790\uff09 \n\t\t\tmid=(l+r)>>1;\n\t\t\tm1=(p[mid].y-p[mid-1].y)/(p[mid].x-p[mid-1].x);\n\t\t\tm2=(p[mid].y-x[i])/p[mid].x;//-x[i]\u5728\u8fd9\u91cc \n\t\t\tif(m1>m2) l=mid+1;\n\t\t\telse r=mid-1;\n\t\t}  \n\t\tf=(1.0*x[i]-p[r].y)/p[r].x+v[i];\n\t\txx=2.0*sqrt(r1[i]),yy=1.0*x[i]-xx*f;//\u8fd9\u91cc\u7684\u7eb5\u5750\u6807\u6ca1\u6709\u51cf\u5f0f\u5b50\u4e2d\u7684x[i],\u56e0\u4e3a\u5b58\u7684\u662f\u70b9\u4e4b\u95f4\u7684\u76f8\u5bf9\u4f4d\u7f6e \n\t\tif(r1[i]>=s-x[i]) ans=min(ans,f);//\u66f4\u65b0\u7b54\u6848 \n\t\tit=upper_bound(p.begin(),p.end(),(node){xx,0})-p.begin();\n\t\tif(it&&it<(int)p.size()) {//\u5982\u679c\u8fd9\u4e2a\u70b9\u672c\u8eab\u5c31\u662f\u4e2a\u4e0b\u51f8\u70b9\uff0c\u5c31\u4e0d\u7528\u63d2\u5165\u4e86 \n\t\t\tm1=(yy-p[it-1].y)/(xx-p[it-1].x);\n\t\t\tm2=(p[it].y-yy)/(p[it].x-xx);\n\t\t\tif(m2>m1) continue;\n\t\t}\n\t\twhile(--it>0) {//\u7ef4\u62a4\u51f8\u5305\u6027\u8d28 \n\t\t\tm1=(p[it].y-p[it-1].y)/(p[it].x-p[it-1].x);\n\t\t\tm2=(yy-p[it].y)/(xx-p[it].x);\n\t\t\tif(m2>m1) p.erase(p.begin()+it);\n\t\t\telse break;\n\t\t}\n\t\t++it;\n\t\twhile(it<(int)p.size()-1) {\n\t\t\tm1=(p[it+1].y-p[it].y)/(p[it+1].x-p[it].x);\n\t\t\tm2=(p[it].y-yy)/(p[it].x-xx);\n\t\t\tif(m1>m2) p.erase(p.begin()+it);\n\t\t\telse break;\n\t\t}\n\t\tp.insert(p.begin()+it,(node){xx,yy});\n\t}\n\tprintf(\"%.3f\",ans);\n\treturn 0;\n}\n\n```\n\u603b\u4e4b\u662f\u4e00\u9053\u5f88\u4e0d\u9519\u7684\u659c\u7387\u4f18\u5316DP\u9898\uff0c~~\u6570\u636e\u6709\u70b9\u6c34~~\u3002\n",
        "postTime": 1672743399,
        "uid": 290959,
        "name": "\u804a\u673a",
        "ccfLevel": 5,
        "title": "P2497 \u57fa\u7ad9\u5efa\u8bbe\u9898\u89e3"
    },
    {
        "content": "\u6bd4\u8f83\u5947\u602a\u7684 k \u5355\u8c03 x \u4e0d\u5355\u8c03\u7684\u659c\u7387\u4f18\u5316\u3002\n\nsb\u4e86\uff0c\u56e0\u4e3a\u659c\u7387\u5199\u6210 $x/y$ \u8c03\u4e86\u534a\u5929\u3002\u3002\u3002\n\n\u800c\u4e14\u8fd9\u9898\u522b\u60f3\u7740\u753b\u56fe\uff0c$x,y$ \u5dee\u8ddd\u592a\u5927\u4e86\u3002\u3002\u3002\n\n## solution\n\u9996\u5148\u63a8\u4e2adp\u5f0f\u3002\n\n\u663e\u7136\u6709 $dp[i]=\\min(dp[j])+\\dfrac{x_i-x_j}{2\\sqrt{r_j}}+v[i]$\n\n\u5316\u4e3a $-x_i\\times\\dfrac{1}{2\\sqrt{r_j}}+(dp[i]-v[i])=dp[j]-\\dfrac{x_j}{2\\sqrt{r_j}}$\n\n\u90a3\u4e48 $k=x_i$\uff0c$x=-\\dfrac{1}{2\\sqrt{r_j}}$\uff0c$b=dp[i]-v[i]$\uff0c$y=dp[j]-\\dfrac{x_j}{2\\sqrt{r_j}}$\n\n\u6211\u4eec\u7684\u76ee\u6807\u662f\u4f7f $b$ \u6700\u5c0f\uff0c\u90a3\u4e48\u7ef4\u62a4\u4e0b\u51f8\u58f3\u5373\u53ef\u3002\n\n\u672c\u9898\u7684 $k$ \u662f\u9012\u589e\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u5355\u8c03\u51fa\u961f\u5934\u3002\u8fd9\u91cc\u5199\u7684\u662f $k$ \u968f\u610f\u7684\u505a\u6cd5\u3002\u4f7f\u7528\u65e0\u65cb treap \u5b9e\u73b0\uff0c\u5199\u8d77\u6765\u5f88\u8212\u670d\u3002\n\n\u6839\u636e\u4e0b\u51f8\u6027\u8d28\u6709 $x$ \u548c $slope(j_1,j_2)$ \u540c\u65f6\u9012\u589e\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u51f8\u5305\u4e0a\u76f8\u90bb\u4e24\u70b9\u659c\u7387 $split$ \u6765\u627e\u5230\u6700\u4f18\u51b3\u7b56\u70b9\u3002\u6ce8\u610f\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u70b9\u4e0e\u5de6\u53f3\u7684\u659c\u7387\uff0c\u8981\u591a\u7ef4\u62a4\u4e00\u4e2a\u5e73\u8861\u6811\u4e2d\u6700\u5927\u6700\u5c0f\u4f4d\u7f6e\u5b9e\u73b0\u8fde\u63a5\u3002\uff08\u867d\u7136\u4e8c\u5206\u4e5f\u80fd\u8fc7\u5c31\u662f\u4e86\uff09\n\n\u5173\u4e8e\u5982\u4f55\u63d2\u5165\u70b9\u81ea\u5df1\u624b\u6478\u4e00\u4e0b\u5427\uff0c\u4e2a\u4eba\u611f\u89c9\u5bf9\u7406\u89e3\u5f88\u6709\u5e2e\u52a9\u3002\n\n\u540c\u6837\u7684\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u674e\u8d85\u7ebf\u6bb5\u6811\u4e0e CDQ \u5206\u6cbb\u89e3\u51b3\u3002\u4e2a\u4eba\u611f\u89c9\u674e\u8d85\u7ebf\u6bb5\u6811\u6bd4\u8f83\u597d\u5199\uff0cCDQ \u6bd4\u8f83\u5f3a\u5927\u4f46\u53d7\u5236\u4e8e\u79bb\u7ebf\u3002\n\n## code\n\u6ce8\u610f\u51f8\u5305\u7684\u5de6/\u53f3\u7aef\u70b9\u7684\u53f3/\u5de6\u659c\u7387\u8981\u8bbe\u6781\u5c0f/\u5927\u503c\u3002\n\n\u7cbe\u5ea6\u8981\u6c42\u4e0d\u9ad8\uff0c\u611f\u52a8\u3002\n```cpp\n\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst double eps=1e-7;\ndouble dp[500010];\ndouble X[500010];\ndouble Y[500010];\ndouble lk[500010];\ndouble rk[500010];\nint id[500010];\nint mn[500010];\nint mx[500010];\nint siz[500010];\nint ls[500010];\nint rs[500010];\nint w[500010];\nint R[500010];\nint b[500010];\nll a[500010];\nint n,cnt,rt;\ndouble ans=1e16;\nll m;\nint newnode(double x,double y,int i){\n\tcnt++;\n\tX[cnt]=x;\n\tY[cnt]=y;\n\tid[cnt]=i;\n\trk[cnt]=1e16;\n\tmn[cnt]=mx[cnt]=cnt;\n\tsiz[cnt]=1;\n\treturn cnt;\n}\nvoid up(int x){\n\tsiz[x]=siz[ls[x]]+siz[rs[x]]+1;\n\tmn[x]=ls[x]?mn[ls[x]]:x;\n\tmx[x]=rs[x]?mx[rs[x]]:x; \n} \nint merge(int x,int y){\n\tif(x==0||y==0) return x|y;\n\tif(w[x]<w[y]){\n\t\trs[x]=merge(rs[x],y);\n\t\tup(x); return x; \n\t}\n\telse{\n\t\tls[y]=merge(x,ls[y]);\n\t\tup(y); return y;\n\t}\n}\nvoid split(int u,int &x,int &y,double v,int tp){\n\tif(u==0){\n\t\tx=y=0;\n\t\treturn;\n\t}\n\tdouble val=tp?rk[u]:X[u];\n\tif(val<=v) x=u,split(rs[u],rs[u],y,v,tp);\n\telse y=u,split(ls[u],x,ls[u],v,tp);\n\tup(u);\n}\nint link(int x,int y){\n\tif(x==0||y==0) return x|y;\n\tint u=mx[x],v=mn[y];\n\trk[u]=lk[v]=(Y[v]-Y[u])/(X[v]-X[u]);\n\treturn merge(x,y);\n}\ndouble cx(int i){\n\treturn -0.5/sqrt(R[i]);\n}\ndouble cy(int i){\n\treturn dp[i]-a[i]/2.0/sqrt(R[i]);\n}\nint main(){\n\tint x,y,z;\n\tscanf(\"%d%lld\",&n,&m);\n\tfor(int i=1;i<=n;i++)\n\tscanf(\"%lld%d%d\",&a[i],&R[i],&b[i]);\n\tdp[1]=b[1];\n\trt=newnode(cx(1),cy(1),1);\n\tfor(int i=2;i<=n;i++){\n\t\tsplit(rt,x,y,a[i],1);\n\t\tint j=y==0?id[mx[x]]:id[mn[y]],k;\n\t\tdp[i]=dp[j]+(a[i]-a[j])/2.0/sqrt(R[j])+b[i];\n\t\trt=link(x,y);\n\t\tsplit(rt,x,y,cx(i),0); \n\t\tj=mx[x],k=mn[y];\n\t\tif(x&&y&&rk[j]<=(cy(i)-Y[j])/(cx(i)-X[j])){\n\t\t\trt=link(x,y);\n\t\t\tcontinue;\n\t\t}\n\t\twhile(siz[x]>1&&lk[j]>=(cy(i)-Y[j])/(cx(i)-X[j])){\n\t\t\tsplit(x,x,z,X[j]-eps,0);\n\t\t\tz=link(ls[z],rs[z]);\n\t\t\tx=link(x,z);\n\t\t\tj=mx[x];\n\t\t}\n\t\twhile(siz[y]>1&&rk[k]<=(Y[k]-cy(i))/(X[k]-cx(i))){\n\t\t\tsplit(y,y,z,X[k],0);\n\t\t\ty=link(ls[y],rs[y]);\n\t\t\ty=link(y,z);\n\t\t\tk=mn[y];\n\t\t}\n\t\trt=link(x,link(newnode(cx(i),cy(i),i),y)); \n\t}\n\tfor(int i=1;i<=n;i++)\n\tif(a[i]+R[i]>=m) \n\tans=min(ans,dp[i]);\n\tprintf(\"%.3lf\",ans);\n}\n```",
        "postTime": 1636641649,
        "uid": 90869,
        "name": "tylon2006",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2497 [SDOI2012]\u57fa\u7ad9\u5efa\u8bbe"
    },
    {
        "content": ">[\u63a8\u9500](https://www.cnblogs.com/Varuxn/p/15332650.html)\n\n# \u89e3\u9898\u601d\u8def\n**CDQ\u4f18\u5316DP**\n\n\u4e0b\u6587\u4e2d $pos_i$ \u8868\u793a\u7f16\u53f7\u4e3a $i$ \u7684\u4f4d\u7f6e\u6216\u8005\u8bf4\u5750\u6807\u3002\n\n\u66b4\u529b DP \u8f6c\u79fb\u65b9\u7a0b\u662f $f_i=\\min\\limits_{1\\le j<i}\\{f_j+\\dfrac{pos_i-pos_j}{2\\sqrt{r_j}}\\}+val_i$\n\n\u8fd9\u6837\u76f4\u63a5\u8f6c\u79fb\u662f $\\mathcal{O}(n^2)$ \u7684\uff0c\u65f6\u95f4\u65e0\u6cd5\u63a5\u53d7\uff0c\u5c1d\u8bd5\u4f18\u5316\u4e00\u4e0b\u67ff\u5b50\u3002\n\n\u5bf9\u4e8e $r_j>r_k$ \u5e76\u4e14 $j$ \u4f18\u4e8e $k$ \u7684\u6761\u4ef6\u5c31\u662f:\n\n$$f_j+\\dfrac{pos_i-pos_j}{2\\sqrt{r_j}}<f_k+\\dfrac{pos_i-pos_k}{2\\sqrt{r_k}}$$\n\n$$2\\times \\sqrt{r_jr_k}(f_j-f_k)<-pos_i\\sqrt{r_k}+pos_j\\sqrt{r_k}+pos_i\\sqrt{r_j}-pos_k\\sqrt{r_j}$$\n\n$$pos_i(\\sqrt{r_j}-\\sqrt{r_k})>2\\sqrt{r_jr_k}(f_j-f_k)-pos_j\\sqrt{r_k}+pos_k\\sqrt{r_j}$$\n\n$$-pos_i<\\dfrac{(2\\times f_j-\\frac{pos_j}{\\sqrt{r_j}})-(2\\times f_k-\\frac{pos_k}{\\sqrt{r_k}})}{\\frac{1}{\\sqrt{r_j}}-\\frac{1}{\\sqrt{r_k}}}$$\n\n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba9 x \u8f74\u8868\u793a $\\dfrac{1}{\\sqrt{r_i}}$ y \u8f74\u8868\u793a $2\\times f_i-\\dfrac{pos_i}{\\sqrt{r_i}}$\n\n\u7531\u4e8e $pos$ \u5177\u6709\u5355\u8c03\u6027\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981 CDQ \uff0c\u5e76\u4e14\u5bf9\u4e8e\u5de6\u533a\u95f4\u4ee5 $r$ \u4e3a\u5173\u952e\u5b57\u8fdb\u884c\u6392\u5e8f\uff0c\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u5c31\u597d\u4e86\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $\\dfrac{1}{\\sqrt{r}}$ \u53ef\u4ee5\u9884\u5904\u7406\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\uff1a $\\mathcal{O}{nlog^2n}$\uff0c\u597d\u50cf\u65e0\u6cd5\u7528\u5f52\u5e76\u6392\u5e8f\u51cf\u53bb\u4e00\u4e2a $log$\u3002\n\n\u6ce8\u610f\u53d8\u91cf\u7684\u7c7b\u578b\u4e0d\u7136\u5c31\u4f1a 100pts -> 17pts\u3002\n# code\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define ull unsigned long long\n#define f() cout<<\"Failed\"<<endl\nusing namespace std;\ninline int read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch>'9'||ch<'0'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}\n\treturn x*f;\n}\nconst int N=5e5+10,INF=2e18;\nint n,m,q[N],pos[N];\ndouble f[N],ans=INF,c[N];\nstruct Node{int pos,r,val,id;double c;}s[N];\nbool comp(Node x,Node y){return x.r<y.r;}\ndouble g(int x){return 2.0*f[x]-(1.0*pos[x])*c[x];}\nvoid CDQ(int l,int r)\n{\n\tif(l==r) return ;\n\tint mid=(l+r)>>1,head=1,tail=0; CDQ(l,mid);\n\tsort(s+l,s+mid+1,comp);//\u5bf9\u4e8e\u5de6\u533a\u95f4\u8fdb\u884c\u6392\u5e8f\n\tfor(int i=l;i<=mid;i++)//\u5355\u8c03\u961f\u5217\u5904\u7406\u5de6\u533a\u95f4\u53ef\u80fd\u7684\u7b54\u6848\n\t{\n\t\twhile(head<tail&&(g(s[i].id)-g(s[q[tail]].id))*(s[q[tail]].c-s[q[tail-1]].c)>=(g(s[q[tail]].id)-g(s[q[tail-1]].id))*(s[i].c-s[q[tail]].c)) tail--;\n\t\tq[++tail]=i;\n\t}\n\tfor(int i=mid+1;i<=r;i++)//\u5904\u7406\u53f3\u533a\u95f4\u7b54\u6848\n\t{\n\t\twhile(head<tail&&g(s[q[head+1]].id)-g(s[q[head]].id)<-s[i].pos*(s[q[head+1]].c-s[q[head]].c)) head++;\n\t\tf[s[i].id]=min(f[s[i].id],(f[s[q[head]].id]+(1.0*s[i].pos-1.0*s[q[head]].pos)*s[q[head]].c/2.0)+s[i].val);\n\t}\n\tCDQ(mid+1,r);\n}\nsigned main()\n{\n\tn=read(); m=read();\n\tfor(int i=1,r,val;i<=n;i++)\n\t{\n\t\tpos[i]=read(); r=read(); val=read(); f[i]=INF;\n\t\tif(!r){i--;n--;continue;}\n\t\ts[i]=(Node){pos[i],r,val,i,1.0/sqrt(r)}; c[i]=1.0/sqrt(r);\n\t}\n\tf[1]=s[1].val; CDQ(1,n);\n\tfor(int i=1;i<=n;i++)\n\t\tif(s[i].pos+s[i].r>=m)\n\t\t\tans=min(ans,f[s[i].id]);//\u8ba1\u7b97\u7b54\u6848\n\tprintf(\"%.3lf\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1632489033,
        "uid": 190322,
        "name": "Varuxn",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2497 [SDOI2012]\u57fa\u7ad9\u5efa\u8bbe"
    }
]