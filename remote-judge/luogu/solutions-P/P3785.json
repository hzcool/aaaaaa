[
    {
        "content": "\u663e\u7136\u9700\u8981\u8ba8\u8bba\u516d\u79cd\u60c5\u51b5\uff0c\u8bbe $T=T_1T_2T_3$\uff1a\n\n## $S=T_1T_2T_3$\n\u663e\u7136\u53ea\u8981 $S=T$\uff0c\u56e0\u4e3a\u4fdd\u8bc1\u4e86 $n\\ge 3$\u3002\n\n## $S=T_2T_3T_1/S=T_3T_1T_2$\n\u53ea\u8981\u627e\u5230\u4e00\u4e2a\u5206\u754c\u70b9 $i$ \u6ee1\u8db3 $S[:i]=T[n-i+1:],S[i+1:]=T[:n-i]$\uff0c\u968f\u4fbf\u600e\u4e48\u505a\u90fd\u884c\uff0c\u6211\u7528\u4e86 exkmp\u3002\n\n## $S=T_1T_3T_2/S=T_2T_1T_3$\n\u6b64\u5904\u4ee5 $S=T_2T_1T_3$ \u4e3a\u4f8b\uff0c$S=T_1T_3T_2$ \u540c\u7406\u3002\n\n\u6c42\u51fa $S$ \u548c $T$ \u7684 $lcs$\uff0c\u90a3\u4e48\u95ee\u9898\u8f6c\u5316\u4e3a\u9700\u8981\u627e\u5230\u4e00\u7ec4 $(i,j)$ \u6ee1\u8db3 \n$$lcp(S,T[j+1:])\\ge i,lcp(T,S[i+1:\\ge j]),i+j\\ge n-lcs$$\n\n\u8003\u8651\u4ece\u5927\u5230\u5c0f\u679a\u4e3e $i$\uff0c\u6bcf\u6b21\u52a0\u5165 $lcp(S,T[j+1:])=i$ \u7684 $j$\uff0c\u90a3\u4e48\u6ee1\u8db3\u6761\u4ef6\u7684 $j$ \u5728\u533a\u95f4 $[n-lcs-i,lcp(T,S[i+1:])]$ \u5185\uff0cexkmp \u540e\u4f7f\u7528\u6811\u72b6\u6570\u7ec4\u76f4\u63a5\u7ef4\u62a4\u6216\u5012\u5e8f\u540e\u7528\u5e76\u67e5\u96c6\u505a\u3002\n\n## $S=T_3T_2T_1$\n\u5373\u627e\u5230\u4e00\u7ec4 $(i,j)$ \u4f7f\u5f97 \n$$S[:i]=T[n-i+1:],T[:j]=S[n-j+1:],n-lcp(S[i+1:],T[j+1:])\\le i+j<n$$\n\n\u8fd9\u6b21 exkmp \u4e0d\u597d\u7528\u4e86\uff0c\u6211\u4eec\u628a $S$ \u548c $T$ \u7528\u7279\u6b8a\u5b57\u7b26\u8fde\u63a5\uff0c\u5e76\u5efa\u51fa\u540e\u7f00\u6811~~\u5e76\u5f88\u5feb\u60f3\u51fa\u4e86\u4e00\u5806 2log \u505a\u6cd5~~\u3002\n\n\u7531\u4e8e\u6709 $i+j<n$ \u8fd9\u4e2a\u8ba8\u538c\u7684\u6761\u4ef6\uff0c\u6240\u4ee5\u6211\u4eec\u5012\u5e8f\u904d\u5386\u53ef\u884c\u7684 $i$\uff0c\u9010\u4e2a\u52a0\u5165\u53ef\u884c\u7684 $j$\uff0c\u8f6c\u5316\u4e3a\u5728\u7ebf\u95ee\u9898\u3002\n\n\u6211\u4eec\u5728\u540e\u7f00\u6811\u6811\u7684\u6bcf\u4e2a\u8282\u70b9\u4e0a\u8bb0\u5f55\u4e00\u4e2a\u6807\u8bb0\u3002\u8fd9\u6837\u6211\u4eec\u7684\u64cd\u4f5c\u5c31\u53d8\u4e3a\u4e86\u63a8\u5e73\u70b9\u5230\u6839\u8def\u5f84\u4e0a\u7684\u6807\u8bb0\uff0c\u67e5\u8be2\u70b9\u5230\u6839\u8def\u5f84\u4e0a\u6807\u8bb0+\u6df1\u5ea6\u7684\u6700\u5927\u503c\u3002\n\n\u8f6c\u5316\u5230\u8fd9\u4e00\u6b65\u5c31\u975e\u5e38\u8212\u670d\u4e86\uff0c\u53ef\u4ee5\u8f7b\u677e\u4f7f\u7528 LCT \u6216\u5168\u5c40\u5e73\u8861\u4e8c\u53c9\u6811\u8fdb\u884c\u7ef4\u62a4\uff0c\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\u5982\u679c\u4f7f\u7528 LCT \u53ef\u80fd\u9700\u8981\u5361\u5e38\u6570\u3002\n\n\u653e\u4e0a\u4e0d\u4fdd\u8bc1\u4efb\u4f55\u65f6\u95f4\u80fd\u8fc7\u7684\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define reg register\n#define il inline\nusing namespace std;\nconst int N=1e6+5;\nint T,n,m,s[N],t[N],ls[N],lt[N],zs[N],zt[N],lcs,bit[N],cs[N],ct[N];vector<int> v[N];bool vst[N],tag[N<<2];\nint fa[N<<2],len[N<<2],lst,cnt,pos[N<<1],mxl[N<<2],mx[N<<2],tg[N<<2],sn[N<<2][2];map<int,int> ch[N<<2];\nil bool check(){for(reg int i=1;i<=n;i++)if(s[i]!=t[i])return 0;return 1;}\nil int read(){\n\treg int res=0;reg char c=getchar();\n\twhile(c<48)c=getchar();\n\twhile(c>=48)res=res*10+c-48,c=getchar();\n\treturn res;\n}\nil void exkmp(int *a,int *b,int *z,int *ext){\n\tz[1]=n;\n\tfor(reg int i=2,l=1,r=1;i<=n;i++){\n\t\tif(i<r)z[i]=min(z[i-l+1],r-i+1);else z[i]=0;\n\t\twhile(i+z[i]<=n&&a[z[i]+1]==a[i+z[i]])z[i]++;\n\t\tif(i+z[i]-1>r)l=i,r=i+z[i]-1;\n\t}\n\tfor(reg int i=1,l=0,r=0;i<=n;i++){\n\t\tif(i<r)ext[i]=min(z[i-l+1],r-i+1);else ext[i]=0;\n\t\twhile(i+ext[i]<=n&&a[ext[i]+1]==b[i+ext[i]])ext[i]++;\n\t\tif(i+ext[i]-1>r)l=i,r=i+ext[i]-1;\n\t}\n}\nil void add(reg int x){for(;x<=n;x+=x&-x)bit[x]++;}\nil int query(reg int x){reg int res=0;for(;x;x-=x&-x)res+=bit[x];return res;}\nil bool solve(reg bool typ){\n\tif(typ)exkmp(s,t,zs,ls),exkmp(t,s,zt,lt);\n\tfor(lcs=0;lcs<n&&s[n-lcs]==t[n-lcs];lcs++);\n\tfor(reg int i=0;i<=n;i++)v[i].clear(),bit[i]=vst[i]=0;\n\tfor(reg int i=2;i<=n;i++)v[ls[i]].push_back(i-1);\n\tfor(reg int i=n;i;i--){\n\t\tfor(reg int j=0;j<v[i].size();j++)add(v[i][j]),vst[v[i][j]]=1;\n\t\tif(query(lt[i+1])>query(max(n-lcs-i-1,0)))\n\t\t\tfor(reg int j=max(n-lcs-i,1);j<=lt[i+1];j++)if(vst[j])\n\t\t\t\tif(!typ){cout<<\"YES\\n\"<<j+1<<\" \"<<i+j<<\"\\n1 \"<<j<<\"\\n\"<<i+j+1<<\" \"<<n<<\"\\n\";return 1;}\n\t\t\t\telse{cout<<\"YES\\n1 \"<<n-i-j<<\"\\n\"<<n-j+1<<\" \"<<n<<\"\\n\"<<n-i-j+1<<\" \"<<n-j<<\"\\n\";return 1;}\n\t}\n\tfor(int i=1;i<=(n>>1);i++)swap(s[i],s[n-i+1]),swap(t[i],t[n-i+1]);\n\treturn 0;\n}\nil void extend(reg int c){\n\treg int p=lst,cur=lst=++cnt;len[cur]=len[p]+1;\n\tfor(;p&&!ch[p][c];p=fa[p])ch[p][c]=cur;\n\tif(!p){fa[cur]=1;return;}\n\treg int q=ch[p][c],nq;\n\tif(len[q]==len[p]+1){fa[cur]=q;return;}\n\tlen[nq=++cnt]=len[p]+1,fa[nq]=fa[q],fa[cur]=fa[q]=nq,ch[nq]=ch[q];\n\tfor(;p&&ch[p][c]==q;p=fa[p])ch[p][c]=nq;\t\n}\n#define ls sn[x][0]\n#define rs sn[x][1]\nconst int INF=2e9;\nil void pushup(reg int x){mx[x]=max(len[x]+tg[x],max(ls?mx[ls]:-INF,rs?mx[rs]:-INF)),mxl[x]=(rs?mxl[rs]:len[x]);}\nil void pushdown(reg int x){\n\tif(!tag[x])return;\n\ttg[ls]=tg[rs]=tg[x],mx[ls]=tg[x]+mxl[ls],mx[rs]=tg[x]+mxl[rs],tag[ls]=tag[rs]=1,tag[x]=0;\n}\nil bool whc(reg int x){return sn[fa[x]][1]==x;}\nil bool isroot(reg int x){return !fa[x]||sn[fa[x]][0]!=x&&sn[fa[x]][1]!=x;}\nil void rotate(reg int x){\n\tbool d=whc(x);reg int y=fa[x],z=sn[x][d^1];\n\tif(!isroot(y))sn[fa[y]][whc(y)]=x;\n\tfa[x]=fa[y],fa[y]=x,fa[z]=y,sn[y][d]=z,sn[x][d^1]=y;\n\tpushup(y),pushup(x);\n}\nvoid pushall(reg int x){if(!isroot(x))pushall(fa[x]);pushdown(x);}\nil void splay(reg int x){\n\tpushall(x);\n\twhile(!isroot(x)){\n\t\tif(isroot(fa[x]))rotate(x);\n\t\telse if(whc(x)==whc(fa[x]))rotate(fa[x]),rotate(x);\n\t\telse rotate(x),rotate(x);\n\t}\n}\nil int access(reg int x){reg int y=0;for(;x;y=x,x=fa[x])splay(x),rs=y,pushup(x);return y;}\n#undef ls\n#undef rs\nint main(){\n\tT=read();\n\twhile(T--){\n\t\tn=read(),m=read();\n\t\tfor(reg int i=1;i<=m;i++)cs[i]=ct[i]=0;\n\t\tfor(reg int i=1;i<=n;i++)s[i]=read(),cs[s[i]]++;\n\t\tfor(reg int i=1;i<=n;i++)t[i]=read(),ct[t[i]]++;\n\t\tint nn=(n<<1|1);bool flag=0;\n\t\tfor(reg int i=1;i<=m;i++)if(cs[i]!=ct[i]){cout<<\"NO\\n\",flag=1;break;}\n\t\tif(flag)continue;\n\t\tif(check()){cout<<\"YES\\n1 1\\n2 2\\n3 \"<<n<<\"\\n\";continue;}\n\t\texkmp(s,t,zs,ls),exkmp(t,s,zt,lt);\n\t\tfor(reg int i=1;i<n;i++)if(ls[i+1]==n-i&&lt[n-i+1]==i){\n\t\t\tif(i==1)cout<<\"YES\\n2 2\\n3 \"<<n<<\"\\n1 1\\n\";\n\t\t\telse cout<<\"YES\\n\"<<i+1<<\" \"<<n<<\"\\n1 1\\n2 \"<<i<<\"\\n\";\n\t\t\tflag=1;break;\n\t\t}\n\t\tif(flag)continue;\n\t\tif(solve(0))continue;if(solve(1))continue;\n\t\texkmp(s,t,zs,ls),exkmp(t,s,zt,lt);\n\t\tfor(reg int i=1;i<(nn<<1);i++)ch[i].clear();\n\t\tlen[lst=cnt=1]=fa[1]=0;\n\t\tfor(reg int i=n;i;i--)extend(t[i]),pos[i+n+1]=lst;extend(0);\n\t\tfor(reg int i=n;i;i--)extend(s[i]),pos[i]=lst;\n\t\tfor(reg int i=1;i<=cnt;i++)tag[i]=0,tg[i]=-2e9,sn[i][0]=sn[i][1]=0;\n\t\tfor(reg int i=n-2,j=1,x;i;i--,j++){\n\t\t\tif(lt[n-j+1]==j)x=access(pos[j+n+2]),tag[x]=1,tg[x]=j,mx[x]=mxl[x]+j;\n\t\t\tif(ls[n-i+1]==i){\n\t\t\t\tx=access(pos[i+1]);\n\t\t\t\tif(i+mx[x]>=n){\n\t\t\t\t\texkmp(s+i,t,zs,ls);\n\t\t\t\t\tfor(j=1;j<n-i;j++)if(lt[n-j+1]==j&&i+j+ls[j+1]>=n)\n\t\t\t\t\t\t{cout<<\"YES\\n\"<<n-i+1<<\" \"<<n<<\"\\n\"<<j+1<<\" \"<<n-i<<\"\\n1 \"<<j<<\"\\n\";flag=1;break;}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(!flag)cout<<\"NO\\n\";\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1629036677,
        "uid": 77174,
        "name": "FunnyCreatress",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P3785\u3010[SDOI2017]\u6587\u672c\u6821\u6b63\u3011"
    }
]