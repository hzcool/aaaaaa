[
    {
        "content": "### Analysis\n\n\u6709\u5411\u56fe\u968f\u673a\u6e38\u8d70\u95ee\u9898\uff0c\u672c\u9898**\u6982\u7387 DP** \u6ca1\u8dd1\u4e86\u3002\n\n\u4e00\u822c\u5730\uff0c\u8bbe $d_i$ \u8868\u793a $i$ \u70b9\u7684**\u51fa\u5ea6**\uff0c$e_i$ \u8868\u793a $i$ **\u4e00\u6b65\u80fd\u5230\u8fbe\u7684\u70b9\u96c6**\uff0c$|e_i|=d_i$\u3002\u6240\u6709\u5f0f\u5b50\u5747\u5728\u6a21 $998,244,353$ \u610f\u4e49\u4e0b\u8fd0\u7b97\u3002\n\n$f(s,i)$ \u8868\u793a\u4ece $i$ \u5f00\u59cb\u7528\u9ab0\u5b50\u8d70 $s$ \u6b65\uff0c\u5e9f\u8bdd\u6307\u6570\u7684\u671f\u671b\u503c\uff0c\u90a3\u6211\u4eec\u6709\n\n$$\\begin{aligned}\nf(0,i)&=0\\\\\nf(s,i)&=\\frac{1}{d_i}\\sum_{j\\in e_i}f(s-1,j)+j\\cdot p(s-1,j,i)\n\\end{aligned}$$\n\n\u5176\u4e2d $p(s,x,y)$ \u8868\u793a\u4ece\u70b9 $x$ \u8d70 $s$ \u6b65\uff0c**\u7ecf\u8fc7**\uff08$1$ \u6b21\u6216\u4ee5\u4e0a\u5747\u53ef\uff09\u70b9 $y$ \u7684\u6982\u7387\u3002\n\n\u67ff\u5b50\u89e3\u91ca\uff1a\u9996\u5148 $i$ \u5230 $e_i$ \u4e2d\u7684\u70b9\u90fd\u662f\u7b49\u6982\u7387\u7684\uff0c\u6240\u4ee5\u6bcf\u4e2a\u5206\u522b\u8ba1\u7b97\u53d6\u5e73\u5747\u503c\u5373\u53ef\uff1b\u6b63\u5e38\u6765\u8bf4 $f(s-1,j)$ \u5c31\u5bf9\u4e86\uff0c\u9664\u975e\u53c8\u7ed5\u56de\u4e86 $i$\uff0c\u8fd9\u65f6\u4ee5\u6982\u7387 $p(s-1,j,i)$ \u591a\u8d21\u732e $j$\u3002\n\n\u65f6\u95f4 $O(Tn\\sum\\!m)$\n\n### Code\n\n```cpp\n//Said no more counting dollars. We'll be counting stars.\n#include<bits/stdc++.h>\nusing namespace std;\n#define pb emplace_back\n#define For(i,j,k) for(int i=j;i<=k;i++)\n#define ll long long\nconst ll mod=998244353;\ninline ll pw(ll x,ll y){ll r=1;while(y){if(y&1)r=r*x%mod;x=x*x%mod;y>>=1;}return r;}\ninline void mad(ll &a,ll b){a=(a+b)%mod;while(a<0)a+=mod;}\ninline void mmu(ll &a,ll b){a=a*b%mod;while(a<0)a+=mod;}\n#define inv(a) pw(a,mod-2)\n#define int long long\n#define N 102\n#define gc getchar\n#define pc putchar\ninline int read(){\n\tint x=0;char c=gc();bool f=0;\n\twhile(!isdigit(c)){if(c=='-')f=1;c=gc();}\n\twhile(isdigit(c)){x=(x<<3)+(x<<1)+c-48;c=gc();}\n\tif(f)x=-x;return x;\n}\ninline void write(int x){if(x<0){pc('-');x=-x;}if(x>9)write(x/10);pc(x%10+'0');}\n\nint p[N][N][N];//i steps j -> k\nint f[N][N];//i steps start from j\nint n,S,m,co[N];\nvector<int> e[N];\nsigned main(){\n\tn=read();S=read();m=read();\n\tint x,y;\n\tFor(i,1,n){\n\t\tx=read();\n\t\tco[i]=inv(x);\n\t\twhile(x--){\n\t\t\ty=read(); \n\t\t\te[i].pb(y);\n\t\t}\n\t}\n\tFor(i,1,n) For(j,1,n) p[0][i][j]=(i==j);\n\tFor(T,1,m){\n\t\tFor(i,1,n){\n\t\t\tFor(j,1,n){\n\t\t\t\tif(i==j){\n\t\t\t\t\tp[T][i][j]=1;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tp[T][i][j]=0;\n\t\t\t\tfor(int k:e[i]) mad(p[T][i][j],p[T-1][k][j]);\n\t\t\t\tmmu(p[T][i][j],co[i]);\n\t\t\t}\n\t\t}\n\t}\n\tFor(i,1,n) f[0][i]=0;\n\tFor(T,1,m){\n\t\tFor(i,1,n){\n\t\t\tf[T][i]=0;\n\t\t\tfor(int j:e[i]){\n\t\t\t\tmad(f[T][i],f[T-1][j]+p[T-1][j][i]*j%mod);\n\t\t\t}\n\t\t\tmmu(f[T][i],co[i]);\n\t\t}\n\t}\n\twrite(f[m][S]);\nreturn 0;}\n```",
        "postTime": 1647530645,
        "uid": 101868,
        "name": "I_am_Accepted",
        "ccfLevel": 0,
        "title": "P8208 [THUPC2022 \u521d\u8d5b] \u9ab0\u5b50\u65c5\u884c"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P8208)\n\n#### \u524d\u7f6e\u77e5\u8bc6\uff1a\n\n\u671f\u671b dp\u3002\n\n#### \u9898\u610f\uff1a\n\n- $n$ \u4e2a\u70b9\uff0c\u7b2c $i$ \u4e2a\u70b9\u6709 $m_i$ \u6761\u51fa\u8fb9\uff0c\u7b2c $j$ \u6761\u8fde\u5411 $l_{i,j}$\u3002\n- \u4ece\u70b9 $s_0$ \u51fa\u53d1\uff0c\u6bcf\u6b21\u4ece\u5f53\u524d\u70b9\u7684\u6240\u6709\u51fa\u8fb9\u968f\u673a\u9009\u4e00\u6761\u8d70\uff0c\u5171\u8d70 $T$ \u6b21\u3002\u8bbe\u65f6\u523b $t$ \u8d70\u5230\u7684\u70b9\u4e3a $s_t$\uff0c\u6bcf\u6b21\u8d70\u5230 $s_t$ \u540e\u8bbe\u4e0a\u4e00\u6b21\uff08\u5982\u679c\u6709\uff09\u8d70\u5230 $s_t$ \u662f\u65f6\u523b $t'$\uff0c\u5c06 $s_{t'+1}$ \u7d2f\u52a0\u8fdb\u5e9f\u8bdd\u6307\u6570\u3002\u6c42\u5e9f\u8bdd\u6307\u6570\u671f\u671b\u3002\n- $n\\le100$\uff0c$T\\le100$\uff0c$\\sum m\\le5\\times10^3$\u3002\n\n#### \u5206\u6790\uff1a\n\n\u82e5\u6b63\u5411\u8003\u8651\uff0c\u9700\u8bb0\u5f55\u6bcf\u4e00\u4e2a\u70b9\u4e0a\u4e00\u6b21\u5f80\u54ea\u4e2a\u70b9\u8d70\uff0c\u4e0d\u5982\u53cd\u5411\u8003\u8651\uff1a\u6bcf\u6b21\u8d70\u5230 $s_t$ \u8bbe\u4e0b\u4e00\u6b21\uff08\u5982\u679c\u6709\uff09\u8d70\u5230 $s_t$ \u662f\u65f6\u523b $t'$\uff0c\u5c06 $s_{t+1}$ \u7d2f\u8ba1\u8fdb\u5e9f\u8bdd\u6307\u6570\u3002\n\n\u6b64\u65f6\u5bf9\u5e9f\u8bdd\u6307\u6570\u7684\u8d21\u732e\u4e0e\u662f\u5426**\u518d\u6b21**\u8d70\u5230 $s_t$ \u6709\u5173\uff0c\u800c\u4e0e\u5728\u54ea\u4e2a\u65f6\u523b\u8d70\u5230\u65e0\u5173\uff1b\u5e76\u4e14\u5bf9\u5e9f\u8bdd\u6307\u6570\u7684\u8d21\u732e\u4e0e $s_{t+1}$ \u6709\u5173\u3002\n\n\u8bb0 $f(t,x,z)$ \u8868\u793a\u5728 $t$ \u65f6\u523b\u4f4d\u4e8e $x$ \u70b9\uff0c\u4e4b\u540e\u8d70\u5230 $z$ \u7684\u6982\u7387\uff0c\u5219\u8d70\u5230 $s_{t+1}$ \u540e\uff0c\u6709 $f(t+1,s_{t+1},s_t)$ \u7684\u6982\u7387\u63a5\u4e0b\u6765\u4f1a\u56de\u5230 $s_t$\uff0c\u5373\u6709 $f(t+1,s_{t+1},s_t)$ \u7684\u6982\u7387 $s_{t+1}$ \u4f1a\u7d2f\u52a0\u8fdb\u5e9f\u8bdd\u6307\u6570\u3002\n\n\u518d\u8bb0 $g(t,x)$ \u8868\u793a\u5728 $t$ \u65f6\u523b\u8d70\u5230 $x$ \u70b9\u7684\u6982\u7387\uff0c\u5219\u6709 $g(t,x)\\times\\dfrac1{m_x}$ \u7684\u6982\u7387\u5728 $t$ \u65f6\u523b\u4ece $x$ \u8d70\u5230 $y$\uff08$y=l_{x,j}$\uff09\uff0c\u5373\u6709 $g(t,x)\\times\\dfrac1{m_x}\\times f(t+1,y,x)$ \u7684\u6982\u7387 $y$ \u4f1a\u7d2f\u52a0\u8fdb\u7b54\u6848\u3002\n\n\u6240\u4ee5\u7b54\u6848\u5373\u4e3a $\\sum\\limits_{t=0}^{T-1}\\sum\\limits_{x=1}^n\\sum\\limits_{\\forall(x,y)\\in E}g(t,x)\\times\\dfrac1{m_x}\\times f(t+1,y,x)\\times y$\u3002\n\n\u8003\u8651 $f,g$ \u5982\u4f55\u8f6c\u79fb\u3002\u7531\u4e8e\u8303\u56f4\u8f83\u5c0f\uff0c\u53ef\u4ee5\u4e0d\u505a\u4f18\u5316\u66b4\u529b\u679a\u4e3e\u3002\u5177\u4f53\u5730\uff0c\u8f6c\u79fb\u5f0f\u4e3a\uff1a\n\n$f(t,x,z)=\\begin{cases}1&x=z\\\\\\dfrac1{m_x}\\sum\\limits_{\\forall(x,y)\\in E}f(t+1,y,z)&x\\ne z\\end{cases}$\n\n\u8fb9\u754c\u6761\u4ef6\u4e3a $f(T,x,z)=\\begin{cases}1&x=z\\\\0&x\\ne z\\end{cases}$\n\n$g(t,x)=\\sum\\limits_{\\forall(y,x)\\in E}\\dfrac1{m_y}g(t-1,y)$\n\n\u8fb9\u754c\u6761\u4ef6\u4e3a $g(0,x)=\\begin{cases}1&x=s_0\\\\0&x\\ne s_0\\end{cases}$\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(Tn\\sum m)$\uff0c\u590d\u6742\u5ea6\u74f6\u9888\u5728\u8ba1\u7b97 $f$\u3002\n\n---\n\n\u7ed9\u51fa\u4ee3\u7801\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define rep(i, l, r) for(int i=l, _=r; i<=_; ++i)\n#pragma GCC diagnostic ignored \"-Wparentheses\"\nusing namespace std;\nbool Mbe;\ntypedef long long ll;\nconst int mN=1e2+9, mM=5e3+9, mod=998244353;\n#define pm(a) ((a)<mod? a: (a)-mod)\n#define inc(a, b) a=pm(a+(b))\ninline int qpow(int x, int y) {\n\tint res=1;\n\tfor(; y; y>>=1, x=(ll) x*x%mod) if(y&1) res=(ll) res*x%mod;\n\treturn res;\n}\nint n, s0, T, m[mN], invm[mN], l[mN][mN];\nint f[mN][mN][mN], g[mN][mN], ans;\n\nbool Men;\nint main() {\n\tcerr<<\"memory: \"<<(&Men-&Mbe>>20)<<\" MB\"<<endl;\n\n\tscanf(\"%d%d%d\", &n, &s0, &T);\n\trep(i, 1, n) {\n\t\tscanf(\"%d\", m+i), invm[i]=qpow(m[i], mod-2);\n\t\trep(j, 1, m[i]) scanf(\"%d\", l[i]+j);\n\t}\n\tg[0][s0]=1;\n\trep(t, 0, T-1) rep(x, 1, n) {\n\t\tint z=(ll) g[t][x]*invm[x]%mod;\n\t\trep(j, 1, m[x]) inc(g[t+1][l[x][j]], z);\n\t}\n\trep(x, 1, n) f[T][x][x]=1;\n\tfor(int t=T-1; t>=0; --t) {\n\t\trep(x, 1, n) rep(z, 1, n) {\n\t\t\tif(x==z) {\n\t\t\t\tf[t][x][z]=1;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\trep(j, 1, m[x]) inc(f[t][x][z], f[t+1][l[x][j]][z]);\n\t\t\tf[t][x][z]=(ll) f[t][x][z]*invm[x]%mod;\n\t\t}\n\t}\n\trep(t, 0, T-1) rep(x, 1, n) rep(j, 1, m[x])\n\t\tans=(ans+(ll) g[t][x]*invm[x]%mod*f[t+1][l[x][j]][x]%mod*l[x][j])%mod;\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n```\n\n\u6ce8\u610f\u5904\u7406\u81ea\u73af\u3002",
        "postTime": 1647676990,
        "uid": 364963,
        "name": "\u963f\u4e11",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8208 [THUPC2022 \u521d\u8d5b] \u9ab0\u5b50\u65c5\u884c"
    },
    {
        "content": "> B. [P8208 [THUPC2022 \u521d\u8d5b] \u9ab0\u5b50\u65c5\u884c](https://www.luogu.com.cn/problem/P8208)\n\n\u6839\u636e\u671f\u671b\u7684\u7ebf\u6027\u6027\uff0c\u8003\u8651\u5bf9\u6bcf\u4e2a\u4f4d\u7f6e $i$\uff0c\u6c42\u51fa\u4ece $i$ \u51fa\u53d1\u6070\u597d $k$ \u7684\u65f6\u95f4 **\u7b2c\u4e00\u6b21** \u56de\u5230 $i$ \u65f6\u7684\u5e9f\u8bdd\u6307\u6570 $g_{i, k}$\uff08\u4ec5\u8003\u8651 $i$ \u8fd9\u4e00\u70b9\u4f5c\u4e3a $s_{t'}$\uff09\uff0c\u4e5f\u5c31\u662f\u5bf9\u4e8e $i$ \u7684\u6240\u6709\u51fa\u8fb9 $(i, j)$\uff0c$j$ \u5728 $k - 1$ \u65f6\u523b **\u7b2c\u4e00\u6b21** \u56de\u5230 $i$ \u7684\u6982\u7387\uff0c\u4e58\u4ee5 $\\dfrac{j}{m_i}$\u3002\u4e00\u6b21\u9884\u5904\u7406 $T\\sum m_i$\uff0c\u5bf9\u6bcf\u4e2a\u4f4d\u7f6e\u5747\u9884\u5904\u7406\u4e00\u904d\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(nT\\sum m_i)$\u3002\n\n\u4e0d\u80fd\u76f4\u63a5\u6c42\u4ece $i$ \u51fa\u53d1\u6070\u597d $k$ \u65f6\u95f4\u56de\u5230 $i$ \u7684\u6982\u7387\u4e58\u4ee5 $i$ \u7684\u6240\u6709\u51fa\u70b9\u7f16\u53f7 $j$ \u4e4b\u548c\u9664\u4ee5 $m$ \u662f\u56e0\u4e3a\u6bcf\u4e2a $j$ \u56de\u5230 $i$ \u7684\u6982\u7387\u4e0d\u540c\u3002\n\n\u5269\u4e0b\u6765\u5c31\u7b80\u5355\u4e86\u3002\u6c42\u51fa\u5728 $t$ \u65f6\u523b\u6070\u597d\u5728 $i$ \u7684\u6982\u7387 $f_{t, i}$\uff08$T\\sum m_i$ \u65f6\u95f4\u590d\u6742\u5ea6\uff09\uff0c\u7136\u540e\u679a\u4e3e\u4e0b\u4e00\u6b21\u56de\u5230 $i$ \u7684\u65f6\u523b $k$\uff0c\u5219\u7b54\u6848\u52a0\u4e0a $f_{t, i}\\sum g_{i, k - t}$\uff0c\u540e\u8005\u5bb9\u6613\u9884\u5904\u7406\u505a\u5230 $nT$\uff0c\u4f46\u4e0d\u5fc5\u8981\uff0c\u56e0\u4e3a\u590d\u6742\u5ea6\u74f6\u9888\u5728\u4e8e\u9884\u5904\u7406 $g$\u3002\n\n\u6ce8\u610f\u81ea\u73af\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 100 + 5;\nconst int mod = 998244353;\nint n, ans, s0, T, inv[N], f[N][N], g[N][N];\nvector <int> e[N];\nint main() {\n\tcin >> n >> s0 >> T, inv[1] = 1;\n\tfor(int i = 2; i < N; i++) inv[i] = mod - 1ll * mod / i * inv[mod % i] % mod;\n\tfor(int i = 1; i <= n; i++) {\n\t\tint m, id; scanf(\"%d\", &m);\n\t\tfor(int j = 1; j <= m; j++) scanf(\"%d\", &id), e[i].push_back(id);\n\t}\n\tfor(int i = 1; i <= n; i++) {\n\t\tmemset(f, 0, sizeof(f));\n\t\tfor(int it : e[i]) f[1][it] = 1ll * it * inv[e[i].size()] % mod;\n\t\tfor(int j = 0; j < T; j++) {\n\t\t\tfor(int k = 1; k <= n; k++)\n\t\t\t\tif(f[j][k] && k != i) {\n\t\t\t\t\tint v = 1ll * f[j][k] * inv[e[k].size()] % mod;\n\t\t\t\t\tfor(int it : e[k]) f[j + 1][it] = (f[j + 1][it] + v) % mod;\n\t\t\t\t}\n\t\t\tg[i][j + 1] = f[j + 1][i];\n\t\t}\n\t}\n\tmemset(f, 0, sizeof(f)), f[0][s0] = 1;\n\tfor(int i = 0; i < T; i++) {\n\t\tfor(int j = 1; j <= n; j++)\n\t\t\tif(f[i][j]) {\n\t\t\t\tfor(int k = 1; k + i <= T; k++)\n\t\t\t\t\tans = (ans + 1ll * f[i][j] * g[j][k] % mod) % mod;\n\t\t\t\tint v = 1ll * f[i][j] * inv[e[j].size()] % mod;\n\t\t\t\tfor(int it : e[j]) f[i + 1][it] = (f[i + 1][it] + v) % mod;\n\t\t\t}\n\t}\n\tcout << ans << endl;\n\treturn 0;\n}\n```\n\n",
        "postTime": 1648545297,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "P8208 [THUPC2022 \u521d\u8d5b] \u9ab0\u5b50\u65c5\u884c"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P8208)\n\n\u9996\u5148\u770b\u5230\u9898\u5e94\u8be5\u60f3\u5230\u6839\u636e\u671f\u671b\u7684\u7ebf\u6027\u6027\u628a\u7b54\u6848\u62c6\u5f00\u7b97\uff0c\u5373\u679a\u4e3e\u4e00\u6761\u8fb9 $v\\rightarrow u$\uff0c\u7136\u540e\u518d\u679a\u4e3e\u4e00\u4e2a\u65f6\u523b $t$\uff0c\u8868\u793a\u5728\u6b64\u65f6\u523b\u901a\u6b64\u8fb9\u5230\u8fbe $u$\uff0c\u4e14\u5728\u65c5\u884c\u7ed3\u675f\u4e4b\u524d\u56de\u5230\u8fc7 $v$\uff0c\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f\u8fd9\u4e2a\u4e8b\u4ef6\u53d1\u751f\u7684\u6982\u7387\u4e58\u4e0a $u$\u3002\u8bbe\u8fd9\u4e2a\u6982\u7387\u4e3a $p_{u,v,t}$\u3002\n\n\u8003\u8651\u6c42\u89e3 $p$\uff0c\u662f\u5426\u53ef\u4ee5 $f_{u,v,t}$ \u8868\u793a\u4ece $u$ \u51fa\u53d1\uff0c\u7528\u4e86**\u6070\u597d** $t$ \u7684\u65f6\u95f4\u5230\u4e86 $v$ \u7684\u6982\u7387\u5462\uff1f$f$ \u663e\u7136\u662f\u53ef\u4ee5 $\\mathcal{O}(n^4)$ \u8f6c\u79fb\u7684\uff0c\u4f46\u8fd9\u6837\u4f1a\u7b97\u91cd\uff0c\u56e0\u4e3a\u5982\u679c $u$ \u5728\u4e4b\u540e\u56de\u5230\u4e86 $v$ \u591a\u6b21\u7684\u8bdd\uff0c\u5c31\u4f1a\u5bf9\u7b54\u6848\u4ea7\u751f\u591a\u6b21\u7684\u8d21\u732e\u3002\n\n\u6240\u4ee5\u5f3a\u5236\u53ea\u8ba9\u7b2c\u4e00\u6b21\u56de\u5230 $u$ \u4ea7\u751f\u8d21\u732e\uff0c\u4e8e\u662f\u8bb0 $g_{u,v,t}$ \u8868\u793a\u4ece $u$ \u51fa\u53d1\uff0c\u7528\u4e86**\u6070\u597d** $t$ \u7684\u65f6\u95f4\u56de\u5230\u4e86 $v$\uff0c\u4e14\u4e2d\u9014\u6ca1\u6709\u56de\u5230\u8fc7 $v$ \u7684\u6982\u7387\u3002\u6c42\u89e3 $g$ \u53ef\u4ee5\u8003\u8651\u6bcf\u6b21\u51cf\u53bb\u4e0d\u5408\u6cd5\u7684\u6982\u7387\uff1a\n$$\ng_{u,v,t}=f_{u,v,t}-\\sum_k g_{u,v,k}f_{v,v,t-k}\n$$\n\u5229\u7528 $g$ \u548c $f$\uff0c\u6211\u4eec\u4e0d\u96be\u5f97\u5230 $p$\uff0c\u518d\u7528 $p$ \u5f97\u51fa\u7b54\u6848\u3002\u6700\u540e\uff0c\u6574\u4e2a\u7b97\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}(n^4)$\u3002\n\n\u6ce8\u610f\u4e00\u4e0b\u8fd9\u9898\u662f\u6709\u81ea\u73af\u7684\uff0c\u8fd9\u4e2a\u6076\u5fc3\u4e86\u6211\u5f88\u4e45\u3002\n\n```cpp\n#include<iostream>\n#include<stdio.h>\n#include<ctype.h>\n#include<vector>\n#define N 105\n#define mo 998244353\n#define int long long\nusing namespace std;\ninline int read(){\n\tint x=0,f=0; char ch=getchar();\n\twhile(!isdigit(ch)) f|=(ch==45),ch=getchar();\n\twhile(isdigit(ch)) x=(x<<3)+(x<<1)+(ch^48),ch=getchar();\n\treturn f?-x:x;\n}\nint n,s,T,f[N][N][N],g[N][N][N],mp[N][N],m[N],ans,inv[N];\ninline void red(int &x){x>=mo?x-=mo:0;}\nsigned main(){\n\tn=read(),s=read(),T=read();\n\tinv[1]=1;for(int i=2;i<=n;++i) inv[i]=(mo-mo/i)*inv[mo%i]%mo;\n\tfor(int i=1;i<=n;++i){\n\t\tm[i]=read();\n\t\tfor(int j=1;j<=m[i];++j) mp[i][read()]=1;\n\t}\n\tfor(int i=1;i<=n;++i) f[i][i][0]=1;\n\tfor(int t=0;t<T;++t){\n\t\tfor(int u=1;u<=n;++u){\n\t\t\tfor(int v=1;v<=n;++v){\n\t\t\t\tfor(int k=1;k<=n;++k){\n\t\t\t\t\tif(!mp[v][k]) continue;\n\t\t\t\t\tred(f[u][k][t+1]+=f[u][v][t]*inv[m[v]]%mo);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfor(int t=0;t<=T;++t){\n\t\tfor(int u=1;u<=n;++u){\n\t\t\tfor(int v=1;v<=n;++v){\n\t\t\t\tg[u][v][t]=f[u][v][t];\n\t\t\t\tfor(int k=0;k<t;++k){\n\t\t\t\t\tred(g[u][v][t]+=mo-g[u][v][k]*f[v][v][t-k]%mo);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfor(int t=1;t<=T;++t){\n\t\tfor(int u=1;u<=n;++u){\n\t\t\tfor(int v=1;v<=n;++v){\n\t\t\t\tif(!mp[v][u]) continue;\n\t\t\t\tint p=0;\n\t\t\t\tfor(int k=0;k<=T-t;++k) red(p+=g[u][v][k]);\n\t\t\t\tp=p*f[s][v][t-1]%mo*inv[m[v]]%mo;\n\t\t\t\tred(ans+=p*u%mo);\n\t\t\t}\n\t\t}\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```\n\n",
        "postTime": 1647522523,
        "uid": 238861,
        "name": "xzzduang",
        "ccfLevel": 0,
        "title": "[THUPC2022 \u521d\u8d5b] \u9ab0\u5b50\u65c5\u884c"
    }
]