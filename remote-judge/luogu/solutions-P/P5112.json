[
    {
        "content": "\u663e\u7136\u53ea\u8981\u8003\u8651\u4ee5\u6bcf\u4e2a\u4f4d\u7f6e\u5f00\u5934\u7684$k$\u4e2a\u5b57\u7b26\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u73b0\u5728\u5c31\u8981\u628a\u6bcf\u4e2a\u4f4d\u7f6e$i$\u6309\u7167\u5176\u4e4b\u540e\u7684$k$\u4e2a\u5b57\u7b26\u5206\u7c7b\u3002\n\n\u4e0d\u96be\u60f3\u5230\u4e00\u4e2a\u597d\u5199\u3001\u65b9\u4fbf\u4e14\u6548\u7387\u9ad8\u7684\u7b97\u6cd5\uff1a\u54c8\u5e0c\u3002\n\n\u6211\u4eec\u5bf9\u6bcf\u4e2a\u4f4d\u7f6e$i$\u5f00\u59cb\u7684\u8fde\u7eed$k$\u4e2a\u5b57\u7b26\u7684\u54c8\u5e0c\u503c\u5904\u7406\u51fa\u6765\uff08\u53ef\u4ee5\u901a\u8fc7\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u540e\u7f00\u54c8\u5e0c\u503c\u5904\u7406\u51fa\u6765\uff0c\u5904\u7406\u540e\u7f00\u54c8\u5e0c\u503c\u663e\u7136$O(n)$\u626b\u4e00\u904d\u5373\u53ef\uff09\uff0c\u7136\u540e\u7528map\u5bf9\u5176\u8fdb\u884c\u79bb\u6563\u3002\n\n\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u5c31\u662f\uff1a\u7ed9\u5b9a\u4e00\u4e2a\u5e8f\u5217$a_i$\uff0c\u6bcf\u6b21\u8be2\u95ee\u4e00\u4e2a\u533a\u95f4\u5185\u6709\u591a\u5c11\u5bf9\u6570\u76f8\u7b49\u3002\n\n~~\u5c0fZ\u7684\u889c\u5b50~~\n\n\u83ab\u961f\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u7b49\u7b49\u590d\u6742\u5ea6\u4e0d\u5bf9\u554a\uff0c$O(n\\sqrt n)$\u7684\u554a\uff01\n\n~~\u6ca1\u9519$O(n\\sqrt n)$\u5c31\u662f\u80fd\u8dd13e6~~\n\n\u6b63\u786e\u7684\u505a\u6cd5\u662f\u628a\u5757\u957f\u8bbe\u4e3a$\\frac n {\\sqrt m}$\uff0c\u6b64\u65f6\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n\\sqrt m)$\uff0c\u7531\u4e8e\u6761\u4ef6$n^2m\\leqslant 10^{15}$\uff0c\u6240\u4ee5\u662f\u6b63\u786e\u7684\u3002\n\n~~\u7136\u9e45\u5757\u957f$\\sqrt n$\u786e\u5b9e\u8fc7\u4e86\uff0c\u5e94\u8be5\u662f\u51fa\u9898\u4eba\u6ca1\u5361~~\n\n---\n\n\u6ce8\u610f\u4e8b\u9879\uff1a\n\n\u7531\u4e8e\u5b57\u7b26\u96c6\u6bd4\u8f83\u5c0f\uff0c\u5b57\u7b26\u6bd4\u8f83\u591a\uff0c\u53d6\u6a21\u7684\u5355\u54c8\u5e0c\u5bb9\u6613\u88ab\u5361\uff08\u6211\u5c31\u88ab\u5361\u4e86\u597d\u51e0\u6b21\uff09\uff0c\u53cc\u54c8\u5e0c\u4f1aTLE\u3002\u4f46\u662f\u51fa\u9898\u4eba\u8c8c\u4f3c\u6ca1\u6709\u7279\u610f\u5361\u54c8\u5e0c\uff0c\u6240\u4ee5\u81ea\u7136\u6ea2\u51fa\u5c31\u8fc7\u4e86\u3002\n\n## Code\uff1a\n```cpp\n#include<cstdio>\n#include<cctype>\n#include<cmath>\n#include<algorithm>\n#include<unordered_map>\nconst int base=233;\ntypedef long long LL;\n#define N 3000005\nstd::unordered_map<LL,int>X;\ninline int readint(){\n    int c=getchar(),d=0;\n    for(;!isdigit(c);c=getchar());\n    for(;isdigit(c);c=getchar())\n    d=d*10+(c^'0');\n    return d;\n}\nint n,m,k,id[N],fp=0,buc[N];\nLL ans[N],hx[N],H[N],pw[N];\nint siz;\nchar s[N];\nstruct que{\n    int l,r,id;\n    inline bool operator<(const que&rhs)const{\n        return(l/siz!=rhs.l/siz)?l<rhs.l:r<rhs.r;\n    }\n}q[100005];\nint main(){\n    n=readint(),m=readint(),k=readint();\n    for(int i=*pw=1;i<=n;++i)pw[i]=1LL*pw[i-1]*base;\n    scanf(\"%s\",s+1);\n    for(int i=n;i;--i)hx[i]=(hx[i+1]*base+s[i]-'a');\n    for(int i=1;i<=n-k+1;++i){\n        H[i]=hx[i]-hx[i+k]*pw[k];\n        if(!X.count(H[i]))X[H[i]]=++fp;\n        id[i]=X[H[i]];\n    }\n    for(int i=1;i<=m;++i){\n        q[i].l=readint(),q[i].r=readint();q[i].id=i;\n        if(q[i].r>n-k+1)q[i].r=n-k+1;\n        if(q[i].l>q[i].r)q[i].l=1,q[i].r=0;\n    }\n    siz=n/sqrt(m);\n    std::sort(q+1,q+m+1);\n    LL now=0;\n    for(int l=1,r=0,i=1;i<=m;++i){\n        while(r<q[i].r)now+=buc[id[++r]]++;\n        while(l>q[i].l)now+=buc[id[--l]]++;\n        while(l<q[i].l)now-=--buc[id[l++]];\n        while(r>q[i].r)now-=--buc[id[r--]];\n        ans[q[i].id]=now;\n    }\n    for(int i=1;i<=m;++i)printf(\"%lld\\n\",ans[i]);\n    return 0;\n}\n\n```",
        "postTime": 1545528600,
        "uid": 6813,
        "name": "mrsrz",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5112 \u3010FZOUTSY\u3011"
    },
    {
        "content": "\u8fd9\u5e94\u8be5\u662f\u6bd4\u8d5b\u4e2d\u6700\u7b80\u5355\u7684\u4e00\u9898\u5427\uff0c\u6211\u60f3\uff08\u867d\u7136\u6211\u6ca1\u6253  \n\u5bf9\u6bcf\u4e2a\u957f\u5ea6\u4e3ak\u7684\u5b50\u4e32\u505a\u4e00\u4e2ahash\uff0c\u4e4b\u540e\u5c31\u7b49\u4e8e\u5c0fz\u7684\u889c\u5b50\u4e86...  \n\u7ef4\u62a4\u533a\u95f4\u6bcf\u4e2a\u989c\u8272\uff08\u59d1\u4e14\u8fd9\u4e48\u53eb\u5427\uff0c\u5373hash\u503c\uff09\u4e2a\u6570\u7684\u5e73\u65b9\u548c\uff0c\u7136\u540e\u5c31\u662f\u4e00\u4e2a\u83ab\u961f\u6a21\u677f\u9898\u4e86...  \n\u53e6\u5916\uff0c\u8fd9\u9898\u5f88dl\u7684\u5361hash\uff0c\u6211\u7528\u4e86\u597d\u51e0\u4e2a\u6a21\u6570\u90fd\u8fc7\u4e0d\u4e86\uff0c\u6700\u540e\u81ea\u7136\u6ea2\u51fa\u8fc7\u4e86...  \n\u5177\u4f53\u89c1\u4ee3\u7801\u5427\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef unsigned long long ll;\nconst int N=3e6+5,base=131;\nint n,m,k;\nint block;\nint belong[N];\nll a[N];int cnt[N];\nll f[N],mul[N],b[N];ll anss[N];\nchar s[N];\nstruct ask{\n    int l,r,id;\n}q[N];\ninline int read(){\n    int s=0;char ch=getchar();\n    while(!isdigit(ch)) ch=getchar();\n    while(isdigit(ch)) s=s*10+ch-48,ch=getchar();\n    return s;\n}\ninline bool cmp(const ask &a,const ask &b){\n    return belong[a.l]^belong[b.l]?belong[a.l]<belong[b.l]:belong[a.l]&1?a.r<b.r:a.r>b.r;\n}\nll ans=0;\ninline void add(int x){cnt[a[x]]++,ans+=cnt[a[x]]*2-1;}\ninline void del(int x){ans-=cnt[a[x]]*2-1,cnt[a[x]]--;}\nint main(){\n    n=read(),m=read(),k=read();\n    if(m<=1) block=1;\n    else block=(n-k+1)/sqrt(m*2/3);\n    if(block<1) block=1;\n    scanf(\"%s\",s+1);\n    mul[0]=1;\n    for(int i=1;i<=n;i++) f[i]=((ll)f[i-1]*base+s[i]),mul[i]=(mul[i-1]*base);\n    n=n-k+1;\n    for(int i=1;i<=n;i++) {\n        a[i]=((f[i+k-1]-(f[i-1]*mul[k])));\n        b[i]=a[i];belong[i]=(i-1)/block+1;\n    }\n    sort(b+1,b+n+1);int t=unique(b+1,b+n+1)-b-1;\n    for(int i=1;i<=n;i++) \n        a[i]=lower_bound(b+1,b+t+1,a[i])-b;\n    //\u4ee5\u4e0a\u4e3a\u524d\u7f6e\u64cd\u4f5c\uff0c\u5373\u9884\u5904\u7406\n    int l,r,num=0;\n    for(int i=1;i<=m;i++){\n        l=read(),r=read();\n        if(l<=n){\n            if(r>n) r=n;\n            num++;q[num].l=l,q[num].r=r,q[num].id=i;\n        }\n    }\n    sort(q+1,q+num+1,cmp);\n    l=1,r=0;\n    //\u4ee5\u4e0b\u4e3a\u83ab\u961f\n    for(int i=1;i<=num;i++){\n        for (;r<q[i].r;r++) add(r+1);\n        for (;r>q[i].r;r--) del(r);\n        for (;l<q[i].l;l++) del(l);\n        for (;l>q[i].l;l--) add(l-1);\n        anss[q[i].id]=(ans-(q[i].r-q[i].l+1))/2;\n    }\n    for(int i=1;i<=m;i++) printf(\"%lld\\n\",anss[i]);\n    return 0;\n}\n```",
        "postTime": 1545538413,
        "uid": 27030,
        "name": "ustze",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5112 \u3010FZOUTSY\u3011"
    },
    {
        "content": "[$My\\ blog$](https://ctz45562.github.io/2019/05/11/\u6d1b\u8c37-P5112-FZOUTSY)\n\n[\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P5112)\n\n\u4e0d\u77e5\u9053\u662f\u83ab\u961f\u5199\u5047\u4e86\u8fd8\u662f\u4eba\u4e11\u5e38\u6570\u5927\uff0c\u968f\u4fbf\u4e00\u4ea4\u5c31\u662f\u6700\u52a3\u89e3$QwQ$\u3002\n\n\u9996\u5148\u6765\u770b\u6570\u636e\u8303\u56f4\uff1a$n^2m\\le 10^{15}$\n\n\u5f00\u4e2a\u65b9\uff1a$n\\sqrt{m}\\le 3\\times 10^7$\n\n\u8fd9\u4e0d\u83ab\u961f\u5417\uff1f\u8003\u8651\u600e\u4e48$O(1)$\u6dfb\u52a0\u3001\u5220\u9664\u4e00\u4e2a\u540e\u7f00\u7684\u5f71\u54cd\u3002\n\n\u628a\u4e32\u7ffb\u8f6c\u4e00\u4e0b\u5c31\u662f\u524d\u7f00\u7684\u6700\u957f\u516c\u5171\u540e\u7f00\uff0c\u4e5f\u5c31\u662f$SAM$\u91cc$parent\\ tree$\u7684$LCA$\u7684$len$\u3002\n\n\u800c\u4e14\u67d0\u4e2a\u70b9\u5b50\u5b59\u7684$len$\u4e00\u5b9a\u5927\u4e8e\u5b83\u81ea\u5df1\u7684$len$\u3002\n\n\u8fd9\u6837\u627e\u5230\u6240\u6709\u6700\u9ad8\u7684$len\\ge k$\u7684\u8282\u70b9\uff0c\u5b83\u5b50\u6811\u4e2d\u4efb\u610f\u4e24\u4e2a\u8282\u70b9\u90fd\u80fd\u4ea7\u751f$1$\u8d21\u732e\u3002\n\n\u67d3\u4e2a\u8272\u8ba1\u6570\u8dd1\u4e00\u904d\u83ab\u961f\u5c31\u5b8c\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n\n``` cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\n#include <cstring>\n\n#define maxn 6000005\n#define inf 0x3f3f3f3f\n\nusing namespace std;\n\ninline int read(){\n\tint x=0,y=0;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')y=1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n\treturn y?-x:x;\n}\n#define son(x,y) son[x][y]\nstruct Query{\n\tint l,r,be,num;\n\tbool operator < (const Query &x)const{\n\t\tif(x.be!=be)return be<x.be;\n\t\tif(be&1)return r<x.r;\n\t\treturn r>x.r;\n\t}\n}q[100005];\nstruct edge{\n\tint pre,to;\n}e[maxn];\nint trans[150],son[maxn][7],fa[maxn],len[maxn],c[maxn],top[maxn],h[maxn],w[maxn]={1},num,cnt=1,last=1,k;\nlong long ans[100005],all;\nchar s[maxn];\ninline void add(int from,int to){\n\te[++num].pre=h[from],h[from]=num,e[num].to=to;\n}\nvoid dfs(int node=1,int tp=0){\n\tif(!tp&&len[node]>=k)tp=node;\n\ttop[node]=tp;\n\tfor(register int i=h[node];i;i=e[i].pre)dfs(e[i].to,tp);\n}\nvoid insert(int c){\n\tint p=last,ne=last=++cnt;\n\tlen[ne]=len[p]+1;\n\twhile(p&&!son(p,c))son(p,c)=ne,p=fa[p];\n\tif(!p)fa[ne]=1;\n\telse {\n\t\tint q=son(p,c);\n\t\tif(len[q]==len[p]+1)fa[ne]=q;\n\t\telse {\n\t\t\tint sp=++cnt;\n\t\t\tmemcpy(son[sp],son[q],sizeof son[q]);\n\t\t\tlen[sp]=len[p]+1,fa[sp]=fa[q],fa[q]=fa[ne]=sp;\n\t\t\twhile(p&&son(p,c)==q)son(p,c)=sp,p=fa[p];\n\t\t}\n\t}\n}\ninline void up(int x){\n\tif(!x)return;\n\tall+=(c[x]++);\n}\ninline void down(int x){\n\tif(!x)return;\n\tall-=(--c[x]);\n}\nint main(){\n\ttrans['z']=1,trans['o']=2,trans['u']=3,trans['t']=4,trans['s']=5,trans['y']=6;\n\tint n=read(),m=read(),sq=n/sqrt(m),l,r;k=read();\n\tscanf(\"%s\",s+1);\n\tfor(register int i=1;i<=n>>1;++i)swap(s[i]=trans[s[i]],s[n-i+1]=trans[s[n-i+1]]);\n\tfor(register int i=1;i<=n;++i)insert(s[i]);\n\tfor(register int i=1;i<=n;++i)w[i]=son(w[i-1],s[i]);\n\tfor(register int i=2;i<=cnt;++i)add(fa[i],i);\n\tdfs();\n\tfor(register int i=1;i<=n;++i)w[i]=top[w[i]];\n\tfor(register int i=1;i<=m;++i)l=read(),r=read(),q[i].l=n-r+1,q[i].r=n-l+1,q[i].num=i,q[i].be=l/sq+1;//\u539f\u4e32\u7ffb\u8f6c\u4e86\uff0c\u8be2\u95ee\u533a\u95f4\u4e5f\u8981\u7ffb\u8f6c\n\tsort(q+1,q+1+m);\n\tl=1,r=0;\n\tfor(register int i=1;i<=m;++i){\n\t\twhile(l<q[i].l)down(w[l++]);\n\t\twhile(l>q[i].l)up(w[--l]);\n\t\twhile(r>q[i].r)down(w[r--]);\n\t\twhile(r<q[i].r)up(w[++r]);\n\t\tans[q[i].num]=all;\n\t}\n\tfor(register int i=1;i<=m;++i)printf(\"%lld\\n\",ans[i]);\n}\n\n```\n\n$P.S$\uff1a\u6b22\u8fce$dalao$\u63d0\u51fa\u849f\u84bb\u54ea\u91cc\u5199\u5047\u4e86\uff0c~~\u867d\u7136\u5f53\u6700\u52a3\u89e3\u4e5f\u633a\u597d\u7684~~\n\n",
        "postTime": 1557578328,
        "uid": 111762,
        "name": "_ctz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5112 \u3010FZOUTSY\u3011"
    },
    {
        "content": "## ~~\u6a21\u677f\uff1a\u540e\u7f00\u6570\u7ec4\u6bd2\u7624~~\n\n\u770b\u89c1\u9898\u9762\u4e0a\u7684\u201c\u540e\u7f00\u201d\u3001\u201c$lcp$\u201d\u7b49\u5b57\u6837\uff0cdalao\u4eec\u5927\u6982\u9a6c\u4e0a\u60f3\u5230\u540e\u7f00\u6570\u7ec4\u4e86\u3002\u4f46\u662f\u8fd9\u9053\u9898\u80fd\u4e0d\u80fd\u4e0d\u7528\u540e\u7f00\u6570\u7ec4\u5462\uff1f~~\uff08\u5176\u5b9e\u662f\u6211\u4e0d\u4f1a\u540e\u7f00\u6570\u7ec4\uff09~~\n\n\u4e0d\u96be\u60f3\u5230\uff0c$lcp\\ge k$\u610f\u5473\u7740\u4e24\u4e2a\u5b57\u7b26\u4e32\u7684\u524d$k$\u4e2a\u5b57\u7b26\u662f\u76f8\u540c\u7684\uff0c\u4e8e\u662f\u5927\u529b\u5b57\u7b26\u4e32\u54c8\u5e0c\uff0c\u7528$$(a_{1}x^{k-1}+a_{2}x^{k-2}+...+a_{k})*k-a_{1}x^{k}+a_{k+1}=a_{2}x^{k-1}+a_{3}x^{k-2}+...+a_{k+1}$$\u4e0d\u96be$O(n)$\u7b97\u51fa\u5404\u4e2a\u957f\u5ea6\u4e3a$k$\u7684\u5b50\u4e32\u7684\u54c8\u5e0c\u503c\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u7edf\u8ba1\u65b9\u6848\u4e86\u3002\u53ef\u4ee5\u53c2\u8003[\u5c0fZ\u7684\u889c\u5b50](https://www.luogu.org/problemnew/show/P1494)\uff0c\u7528\u83ab\u961f\u89e3\u51b3\u95ee\u9898\u3002\n\n\u4f46\u662f\uff0c$O(n\\sqrt{n})$\u7684\u83ab\u961f\u4f1a\u88ab\u5361\uff0c\u6240\u4ee5\u8981\u7528\u5feb\u5927\u5c0f\u4e3a$\\frac{n}{\\sqrt{m}}$\u7684\u83ab\u961f\uff0c\u590d\u6742\u5ea6\u4e3a$O(n\\sqrt{m})$\uff0c\u5bf9\u4e8e$n^{2}m\\le 10^{15}$\uff0c\u5373$n\\sqrt{m}\\le 3.2*10^{7}$\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n\u53e6\u5916\uff0c\u6a21\u6570\u592a\u5c0f\u7684\u5b57\u7b26\u4e32\u54c8\u5e0c\u4e5f\u4f1a\u88ab\u5361\uff0c\u6700\u597d\u76f4\u63a5\u7528unsigned long long\uff0c\u76f8\u5f53\u4e8e\u6a21$2^{64}$\uff0c\u518d\u5bf9$n$\u4e2a\u503c\u79bb\u6563\u5316\u3002\n\n$code:$\n\n```cpp\n#include<cstdio>\n#include<cctype>\n#include<cmath>\n#include<algorithm>\n#define PC(A) putchar(A)\nusing namespace std;\ntypedef unsigned long long ll;\nconst int N=3000050;\nconst int M=100050;\nconst int P=3000017;\nconst int x=233;  //233\nchar BB[1<<21],*S,*T;\ninline char gc(){return S==T&&(T=(S=BB)+fread(BB,1,1<<20,stdin),S==T)?EOF:*S++;}\ninline short rdc(){\n    char c=gc();\n    while(!islower(c))c=gc();\n    return c-'a';\n}\ninline int rdi(){\n    char c=gc();\n    while(!isdigit(c))c=gc();\n    int x=c&15;\n    for(c=gc();isdigit(c);c=gc())x=(x<<3)+(x<<1)+(c&15);\n    return x;\n}\nshort buf[25];\ninline void wt(ll x){\n    short l=-1;\n    while(x>9){\n        buf[++l]=x%10;\n        x/=10;\n    }\n    PC(x|48);\n    while(l>=0)PC(buf[l--]|48);\n    PC('\\n');\n}\nshort a[N];\nint h[P],nxt[N],p[N],cnt[N],l[M],r[M],t[M],n,k,sz,o=1;\nll v[N],s[M];\ninline void add(ll w){\n    int t=w%P;\n    v[o]=w;\n    nxt[o]=h[t];\n    h[t]=o;\n}\ninline int find(ll w){\n    int t=w%P,i;\n    for(i=h[t];i;i=nxt[i])if(v[i]==w)return i;\n    return 0;\n}  //\u7528\u54c8\u5e0c\u8868\u5b9e\u73b0\u79bb\u6563\u5316\ninline ll fp(int p){  //\u5feb\u901f\u5e42\n    ll a=x,s=1;\n    while(p){\n        if(p&1)s=s*a;\n        a=a*a;\n        p>>=1;\n    }\n    return s;\n}\ninline void work(){\n    int i,t;\n    ll tmp=fp(k),res=0;\n    for(i=1;i<=k;i++)res=res*x+a[i];\n    add(res);\n    p[1]=1;\n    for(i=k+1;i<=n;i++){\n        res=res*x-a[i-k]*tmp+a[i];  //\u524d\u6587\u7684\u5f0f\u5b50\n        if(t=find(res))p[i-k+1]=t;\n        else{\n            p[i-k+1]=++o;\n            add(res);\n        }\n    }\n}\nint cmp(int a,int b){return (l[a]-1)/sz==(l[b]-1)/sz?r[a]<r[b]:l[a]<l[b];}\nint main(){\n    int m,i,x,y;\n    ll ans=0;\n    n=rdi();m=rdi();k=rdi();\n    sz=n/sqrt(m);\n    for(i=1;i<=n;i++)a[i]=rdc();\n    work();\n    for(i=0;i<m;i++){\n        l[i]=rdi();r[i]=rdi();\n        if(r[i]+k-1>n)r[i]=n-k+1;\n        if(l[i]>r[i])l[i]=r[i];  //\u5751\uff0c\u5c0f\u5fc3\u8fd9\u4e24\u79cd\u95ee\u9898\n        t[i]=i;\n    }\n    sort(t,t+m,cmp);\n    x=l[t[0]];y=r[t[0]];\n    for(i=x;i<=y;i++){\n        ans+=cnt[p[i]];\n        cnt[p[i]]++;\n    }\n    s[t[0]]=ans;\n    for(i=1;i<m;i++){\n        if(l[t[i]]<x)do{\n            x--;\n            ans+=cnt[p[x]];\n            cnt[p[x]]++;\n        }while(x>l[t[i]]);\n        else for(;x<l[t[i]];x++){\n            cnt[p[x]]--;\n            ans-=cnt[p[x]];\n        }\n        if(r[t[i]]>y)do{\n            y++;\n            ans+=cnt[p[y]];\n            cnt[p[y]]++;\n        }while(y<r[t[i]]);\n        else for(;y>r[t[i]];y--){\n            cnt[p[y]]--;\n            ans-=cnt[p[y]];\n        }\n        s[t[i]]=ans;\n    }  //\u83ab\u961f\n    for(i=0;i<m;i++)wt(s[i]);\n    return 0;\n}\n```",
        "postTime": 1545548660,
        "uid": 57926,
        "name": "Thinking",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5112 \u3010FZOUTSY\u3011"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P5112)\n\n\u533a\u95f4\u7684\u975e\u5f3a\u5236\u5728\u7ebf\u64cd\u4f5c\uff0c\u9996\u5148\u53ef\u4ee5\u60f3\u5230\u83ab\u961f\uff0c\u5e76\u4e14\u8c8c\u4f3c\u533a\u95f4\u4e4b\u95f4\u7684\u7b54\u6848\u4e5f\u53ef\u4ee5\u76f8\u4e92\u8f6c\u5316\uff0c\u8003\u8651\u83ab\u961f\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u5982\u4f55\u8f6c\u5316\u4e3a\u83ab\u961f\u4e86\u3002\n\n\u89c2\u5bdf\u5230 $k$ \u662f\u4e0d\u53d8\u7684\uff0c\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406**\u4ee5\u6bcf\u4e2a\u5b57\u7b26\u4e3a\u8d77\u70b9\u4e4b\u540e $k$ \u4e2a\u5b57\u7b26\u6240\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\u7684\u54c8\u5e0c\u503c**\u548c**\u4ee5\u6bcf\u4e2a\u5b57\u7b26\u4e3a\u8d77\u70b9\u7684\u540e\u7f00\u7684\u54c8\u5e0c\u503c**\u4ee5\u4fbf\u53bb\u91cd\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u8f6c\u5316\u4e3a[\u5c0fz\u7684\u889c\u5b50](https://www.luogu.com.cn/problem/P1494)\u4e86\uff0c\u6b63\u5e38\u83ab\u961f\u5373\u53ef\u3002\n",
        "postTime": 1683972780,
        "uid": 774862,
        "name": "Tsinghua_pwtking",
        "ccfLevel": 0,
        "title": "FZOUTSY\u9898\u89e3"
    },
    {
        "content": "\u5927\u5bb6\u597d\u6211\u540e\u7f00\u6570\u7ec4\u5b66\u9b54\u6014\u4e86\uff0c\u6240\u4ee5\u6211\u6765\u5199\u4e00\u53d1\u7528\u5230\u540e\u7f00\u6570\u7ec4\u7684\u9898\u89e3\u3002\n\n\u9996\u5148\u6c42\u51fa\u5b57\u7b26\u4e32 $s$ \u7684 $sa$\uff0c$rk$ \u548c $ht$ \u4e09\u4e2a\u6570\u7ec4\uff0c\u7528 $i$ \u4ee3\u8868 $s$ \u4ee5 $i$ \u5f00\u5934\u7684\u540e\u7f00\u3002\n\n\u6839\u636e $\\operatorname{lcp}(i, j) = \\min\\limits_{p=rk_i + 1}^{rk_j} ht_p$\uff0c\u95ee\u9898\u8f6c\u5316\u4e3a\u533a\u95f4\u5185\u6709\u591a\u5c11\u4e2a\u70b9\u5bf9\u6ee1\u8db3 $\\min\\limits_{p=rk_i + 1}^{rk_j} ht_p\\ge k$\uff0c\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\u5728 $(rk_i,rk_j]$ \u8fd9\u4e2a\u533a\u95f4\u91cc\u6bcf\u4e2a\u6570\u90fd $\\ge k$\u3002\n\n\u7531\u4e8e\u6bcf\u4e2a\u6570\u90fd $\\ge k$\uff0c\u6240\u4ee5 $<k$ \u7684 $ht$ \u5c31\u5c06\u539f $ht$ \u6570\u7ec4\u5206\u6210\u4e86\u82e5\u5e72\u5757\uff0c$rk$ \u503c\u5728\u540c\u4e00\u5757\u91cc\u7684\u70b9\u5bf9\u6709\u8d21\u732e\uff0c\u5426\u5219\u6ca1\u8d21\u732e\u3002\u8bbe $c_i$ \u4e3a\u7b2c $i$ \u4e2a\u5757\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\uff0c\u95ee\u9898\u8f6c\u5316\u4e3a\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\u6c42 $\\sum \\dfrac{c_i*(c_i - 1)}2$\u3002\n\n\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u83ab\u961f\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n + n\\sqrt m)$\uff0c\u53ef\u8fc7\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\nconstexpr int N = 3e6 + 5;\nint n, m, k, cnt[N], sa[N], id[N], __rk[2][N], *rk = __rk[0], *ork = __rk[1], ht[N];\nchar s[N];\nvoid get_sa() {\n    int m = 128, p = 0;\n    rep(i, 1, n) ++cnt[rk[i] = s[i]];\n    rep(i, 1, m) cnt[i] += cnt[i - 1];\n    per(i, n, 1) sa[cnt[rk[i]]--] = i;\n    for(int w = 1; ; m = p, p = 0, w <<= 1) {\n        rep(i, n - w + 1, n) id[++p] = i;\n        rep(i, 1, n) if(sa[i] > w) id[++p] = sa[i] - w;\n        memset(cnt, 0, 4 * (m + 1));\n        rep(i, 1, n) ++cnt[rk[i]];\n        rep(i, 1, m) cnt[i] += cnt[i - 1];\n        per(i, n, 1) sa[cnt[rk[id[i]]]--] = id[i];\n        swap(rk, ork);\n        p = 0;\n        rep(i, 1, n) rk[sa[i]] = ork[sa[i]] == ork[sa[i - 1]] && ork[sa[i] + w] == ork[sa[i - 1] + w] ? p : ++p;\n        if(p == n) break;\n    }\n}\nvoid get_ht() {\n    int k = 0;\n    rep(i, 1, n) {\n        if(k) --k;\n        while(s[i + k] == s[sa[rk[i] - 1] + k]) ++k;\n        ht[rk[i]] = k;\n    }\n}\nint B, b[N], tot, bel[N], cc[N];\nll ans[N], res;\nvoid get_b() {\n    rep(i, 1, n) if(ht[i] < k) b[++tot] = i;\n    b[tot + 1] = n + 1;\n    rep(i, 1, tot) rep(j, b[i], b[i + 1] - 1) bel[sa[j]] = i;\n}\nstruct query {\n    int l, r, id;\n    bool operator<(const query& b) const {\n        return l / B != b.l / B ? l / B < b.l / B : (l / B & 1) ? r < b.r : r > b.r;\n    }\n} q[N];\ninline void add(int i) { res += cc[i]++; }\ninline void del(int i) { res -= --cc[i]; }\nvoid solve() {\n    int l = 1, r = 0;\n    rep(i, 1, m) {\n        while(l > q[i].l) add(bel[--l]);\n        while(r < q[i].r) add(bel[++r]);\n        while(l < q[i].l) del(bel[l++]);\n        while(r > q[i].r) del(bel[r--]);\n        // rep(i, 1, tot) cout << cc[i] << ' '; cout << endl;\n        ans[q[i].id] = res;\n    }\n}\nsigned main() {\n    cin >> n >> m >> k;\n    cin >> (s + 1);\n    get_sa();\n    get_ht();\n    get_b();\n    // rep(i, 1, n) cout << sa[i] << ' '; cout << endl;\n    // rep(i, 1, n) cout << rk[i] << ' '; cout << endl;\n    // rep(i, 1, n) cout << ht[i] << ' '; cout << endl;\n    // rep(i, 1, tot) cout << b[i] << ' '; cout << endl;\n    // rep(i, 1, n) cout << bel[i] << ' '; cout << endl;\n    rep(i, 1, m) cin >> q[i].l >> q[i].r, q[i].id = i;\n    B = n / sqrt(m);\n    sort(q + 1, q + m + 1);\n    solve();\n    rep(i, 1, m) cout << ans[i] << endl;\n    return 0;\n}\n```",
        "postTime": 1681823102,
        "uid": 393767,
        "name": "Untitled0",
        "ccfLevel": 5,
        "title": "P5112 \u9898\u89e3"
    },
    {
        "content": "$\\operatorname{LCP}(a,b)\\ge k\\Leftrightarrow$ $\\forall i\\le k,a_i=b_i$\u3002\n\n\u7ef4\u62a4\u51fa\u6bcf\u4e2a\u540e\u7f00 $s_i$ \u957f\u5ea6\u4e3a $k$ \u7684\u524d\u7f00 $a_i$\u3002\n\n\u7136\u540e\u5c31\u662f\u6570\u533a\u95f4 $a_i$ \u76f8\u540c\u5bf9\u6570\uff0c\u83ab\u961f\u7ef4\u62a4\u3002\n\n$\\sqrt{n^2m}=n\\sqrt m\\le\\sqrt{10^{15}}$\uff0c\u53ef\u4ee5\u8fc7\u6389\u3002\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <algorithm>\nusing namespace std;\nstruct Q{int l, r, i;}q[3000050];\nint n, m, k, z, t[3000050], c[3000050];char f[3000050];\nunsigned long long g = 1, a[3000050], v[3000050], h[3000050];long long p, s[3000050];\nvoid I(int x) {p += c[a[x]]++;}void D(int x) {p -= --c[a[x]];}\nbool B(Q x, Q y) {return t[x.l] == t[y.l] ? t[x.l] & 1 ? x.r < y.r : x.r > y.r : x.l < y.l;}\nint main()\n{\n\tscanf(\"%d%d%d%s\", &n, &m, &k, f + 1);\n\tfor(int i = 1;i <= k;++i) g *= 233;\n\tfor(int i = 1, k = n / sqrt(m) + 1;i <= n;++i)\n\t\th[i] = h[i - 1] * 233 + f[i], t[i] = (i - 1) / k + 1;\n\tfor(int i = 1;i <= n - k + 1;++i) v[z++] = a[i] = h[i + k - 1] - h[i - 1] * g;\n\tsort(v, v + z);z = unique(v, v + z) - v;\n\tfor(int i = 1;i <= n - k + 1;++i) a[i] = lower_bound(v, v + z, a[i]) - v + 1;\n\tfor(int i = 0;i < m;++i)\n\t\tscanf(\"%d%d\", &q[i].l, &q[i].r), q[i].r = min(q[i].r, n - k + 1),\n\t\tq[i].l = min(q[i].l, q[i].r + 1), q[i].i = i;\n\tsort(q, q + m, B);for(int i = 0, l = 1, r = 0;i < m;++i)\n\t{\n\t\twhile(l > q[i].l) I(--l);while(r < q[i].r) I(++r);\n\t\twhile(l < q[i].l) D(l++);while(r > q[i].r) D(r--);\n\t\ts[q[i].i] = p;\n\t}\n\tfor(int i = 0;i < m;++i) printf(\"%lld\\n\", s[i]);return 0;\n}\n```\n",
        "postTime": 1679272491,
        "uid": 388651,
        "name": "5k_sync_closer",
        "ccfLevel": 7,
        "title": "P5112 FZOUTSY \u9898\u89e3"
    },
    {
        "content": "\u597d\u50cf\u633a\u7b80\u5355\u7684\u3002\n\n\u56e0\u4e3a\u6211\u4e0d\u4f1a\u4ec0\u4e48\u540e\u7f00\u6570\u7ec4\u548c\u540e\u7f00\u81ea\u52a8\u673a\uff0c\u8003\u8651\u5b57\u7b26\u4e32\u54c8\u5e0c\uff0c$\\mathcal{O}(n)$ \u7b97\u51fa\u6bcf\u4e2a\u957f\u5ea6\u4e3a $k$ \u7684\u5b50\u4e32\u7684\u54c8\u5e0c\u503c\uff0c\u4e0d\u96be\u53d1\u73b0\u5c31\u662f\u8981\u6c42 $[l,r]$ \u4e4b\u95f4\u6709\u591a\u5c11\u5bf9\u54c8\u5e0c\u503c\u76f8\u7b49\u3002\u83ab\u961f\u641e\u4e00\u4e0b\uff0c\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u8fd9\u9898\u6570\u636e\u6bd4\u8f83\u6c34\uff0c\u5f00\u59cb\u5757\u957f\u8bbe\u7684 $\\sqrt n$\uff0c$\\mathcal{O}(n \\sqrt n)$ \u51b2\u8fc7\u4e86 $3 \\times 10^6$\u3002\u4e8b\u5b9e\u4e0a\u5e94\u8be5\u628a\u5757\u957f\u8bbe\u4e3a $\\dfrac{n}{\\sqrt m}$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O}(n \\sqrt{m})$ \u7684\u3002\u53c8\u56e0\u4e3a\u4fdd\u8bc1\u4e86 $n^2m \\le 10^{15}$\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u662f\u6b63\u786e\u7684\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N = 3e6+5;\nint n,m,k;\nchar s[N];\nint bel[N],blk;\nstruct Query{\n\tint id,l,r;\n\tbool operator<(const Query& rhs) const\n\t{\n\t\tif(bel[l]==bel[rhs.l]) return bel[l]&1?r<rhs.r:r>rhs.r;\n\t\treturn bel[l]<bel[rhs.l];\n\t}\n} q[N];\n#define ull unsigned long long\null Hash[N],pw[N],t[N],val[N],tot;\nconst ull base = 131;\nvoid Hash_init()\n{\n\tpw[0]=1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tpw[i]=pw[i-1]*base;\n\t\tHash[i]=Hash[i-1]*base+s[i];\n\t}\n\tfor(int i=0;i<=n-k;i++) val[i+1]=Hash[i+k]-Hash[i]*pw[k],t[++tot]=val[i+1];\n\tsort(t+1,t+tot+1);\n\ttot=unique(t+1,t+n+1)-t-1;\n\tfor(int i=1;i<=n;i++) val[i]=lower_bound(t+1,t+tot+1,val[i])-t;\n}\nlong long cnt[N],ans[N],now;\nvoid add(int x){now+=cnt[val[x]]; cnt[val[x]]++;}\nvoid del(int x){cnt[val[x]]--; now-=cnt[val[x]];}\nint main()\n{\n\tscanf(\"%d%d%d\",&n,&m,&k);\n\tscanf(\"%s\",s+1); Hash_init();\n\tint blk=pow(n,0.5);\n\tfor(int i=1;i<=n;i++) bel[i]=(i-1)/blk+1;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tscanf(\"%d%d\",&q[i].l,&q[i].r); q[i].id=i;\n\t\tif(q[i].r>n-k+1) q[i].r=n-k+1;\n\t\tif(q[i].l>q[i].r) q[i].l=1,q[i].r=0;\n\t}\n\tsort(q+1,q+m+1);\n\tint l=1,r=0;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\twhile(r<q[i].r) add(++r);\n\t\twhile(r>q[i].r) del(r--);\n\t\twhile(l<q[i].l) del(l++);\n\t\twhile(l>q[i].l) add(--l);\n\t\tans[q[i].id]=now;\n\t}\n\tfor(int i=1;i<=m;i++) cout<<ans[i]<<\"\\n\";\n\treturn 0;\n}\n```",
        "postTime": 1665378621,
        "uid": 280473,
        "name": "404Not_Found",
        "ccfLevel": 5,
        "title": "P5112 FZOUTSY"
    },
    {
        "content": "\u8fd9\u9053\u9898\u5c45\u7136\u8fd9\u4e48\u6c34...\u4e2a\u5c41\u554a...\n\n\n# noteskey\n\n\u5176\u5b9e\u8fd9\u91cc\u6211\u4eec\u7528\u4e2a HASH \u81ea\u7136\u6ea2\u51fa\u6c42\u51fa\u6bcf\u4e2a\u540e\u7f00\u7684 HASH \u503c\u5c31\u884c\u4e86\n\n\u4f46\u7531\u4e8e\u8fd9\u91cc\u8981\u6c42\u7684\u53ea\u662f K \u7ea7\u590d\u8bfb\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u8bb0\u5f55\u6bcf\u4e2a\u540e\u7f00\u524d K \u4e2a\u5b57\u7b26\u7684 HASH \u503c\u5c31\u597d\u4e86\uff0c\u81f3\u4e8e\u8be2\u95ee\u533a\u95f4\u5c31\u662f\u79bb\u7ebf\u4e0b\u6765\u7528\u83ab\u961f\u5904\u7406\u4e86...\n\n# faster\n\n\u7136\u540e\u5173\u952e\u7684\u5c31\u662f\u5361\u5e38\u6280\u5de7\u4e86 Q.Q\n\n\u9996\u5148\u662f\u4e0a\u9762\u8bf4\u8fc7\u7684\u81ea\u7136\u6ea2\u51fa\n\n\u5176\u6b21\u5c31\u662f unordered_map \u4e86\uff0c\u56e0\u4e3a map \u6bd4\u8f83\u6162\u554a...\u600e\u4e48\u8bf4\uff0c\u4e00\u4e2a\u8dd1\u4e0d\u8fc7\u53bb\u7528\u53e6\u4e00\u4e2a\u5c31\u5bf9\u4e86 ~(\uffe3\u25bd\uffe3)~\n\n\u8fd8\u6709\u83ab\u961f\u7684\u65f6\u5019 compare \u51fd\u6570\u7684\u4f18\u5316\uff0c\u5177\u4f53\u770b\u4ee3\u7801\n\n# code\n\n\u77ed\u5012\u662f\u633a\u77ed\u7684...\n\n```cpp\n//by Judge\n#pragma GCC optimize(\"Ofast\")\n#include<bits/stdc++.h>\n#include<unordered_map>\n#define Rg register\n#define fp(i,a,b) for(Rg int i=(a),I=(b)+1;i<I;++i)\n#define fd(i,a,b) for(Rg int i=(a),I=(b)-1;i>I;--i)\n#define ll unsigned long long\nusing namespace std;\nconst int base=131;\nconst int M=3e6+3;\ntypedef int arr[M];\ntypedef ll ARR[M];\n#ifndef Judge\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\n#endif\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline int read(){ int x=0,f=1; char c=getchar();\n\tfor(;!isdigit(c);c=getchar()) if(c=='-') f=-1;\n\tfor(;isdigit(c);c=getchar()) x=x*10+c-'0'; return x*f;\n} inline void reads(string& s){ char c=getchar();\n\tfor(;!isalpha(c);c=getchar()); s=\" \";\n\tfor(;isalpha(c);c=getchar()) s+=c;\n} char sr[1<<21],z[20];int CCF=-1,Z;\ninline void Ot(){fwrite(sr,1,CCF+1,stdout),CCF=-1;}\ninline void print(ll x,char chr='\\n'){\n    if(CCF>1<<20)Ot(); while(z[++Z]=x%10+48,x/=10);\n    while(sr[++CCF]=z[Z],--Z);sr[++CCF]=chr;\n} int n,m,k,bl,tim; string s;\nunordered_map<ll,int> X;\narr id,num;  ARR ans,hx,H,pw;\nstruct que{ int l,r,id; }q[100005];\ninline bool cmp(const que& a,const que& b){\n\treturn (a.l/bl!=b.l/bl)?a.l<b.l:(a.l/bl&1)?a.r<b.r:a.r>b.r;\n}\nint main(){ n=read(),m=read(),k=read(),*pw=1;\n\tfp(i,1,n) pw[i]=pw[i-1]*base; reads(s);\n\tfd(i,n,1) hx[i]=hx[i+1]*base+s[i]-'a';\n\tfp(i,1,n-k+1){ H[i]=hx[i]-hx[i+k]*pw[k];\n\t\tif(!X.count(H[i])) X[H[i]]=++tim; id[i]=X[H[i]];\n\t}\n\tfp(i,1,m){\n\t\tq[i].l=read(),q[i].r=read(),q[i].id=i;\n\t\tif(q[i].r>n-k+1) q[i].r=n-k+1;\n\t\tif(q[i].l>q[i].r) q[i].l=1,q[i].r=0;\n\t}\n\tbl=n/sqrt(m)+1,sort(q+1,q+1+m,cmp);\n\tll now=0; int l=1,r=0;\n\tfor(int i=1;i<=m;ans[q[i].id]=now,++i){\n\t\twhile(r<q[i].r) now+=num[id[++r]]++;\n\t\twhile(l>q[i].l) now+=num[id[--l]]++;\n\t\twhile(l<q[i].l) now-=--num[id[l++]];\n\t\twhile(r>q[i].r) now-=--num[id[r--]];\n\t} fp(i,1,m) print(ans[i]); return Ot(),0;\n}\n```\n\n# UPD\uff1a\n\n\u4ee3\u7801\u597d\u50cf\u88ab HACK \u4e86\uff1f\n\n\u4f46\u5176\u5b9e\u601d\u8def\u6ca1\u6bdb\u75c5...\u53ea\u4e0d\u8fc7\u83ab\u961f\u5206\u5757\u7684\u65f6\u5019\u5757\u7684\u5927\u5c0f\u8c03\u4e00\u4e0b\uff08+1\uff09\u5c31\u597d\u4e86\n\n```cpp\n\tbl=n/sqrt(m); // before update\n\tbl=n/sqrt(m)+1;  // after update\n```\n\n",
        "postTime": 1554858176,
        "uid": 38576,
        "name": "J\u03bcdge",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5112 \u3010FZOUTSY\u3011"
    },
    {
        "content": "\u53d1\u5e03\u4e00\u7bc7\u641e\u7b11\u7684\u9898\u89e3\u2026\u2026\u2026\n\n\u6211\u524d\u6bb5\u65f6\u95f4\u81ea\u5df1yy\u51fa\u4e86\u8fd9\u9053\u9898\u7ed3\u679c\u7ffb\u4e00\u7ffb\u4ee5\u524d\u516c\u5f00\u8d5b\u6709\u8fd9\u9898\u800c\u4e14\u6bd4\u6211\u9020\u7684\u6570\u636e\u8981\u5f3a\u2026\u2026\n\n\u770b\u4e00\u770b\u81ea\u5df1\u7684\u7a0b\u5e8f\u7b80\u76f4sb\u2026\u2026\n\n\u9519\u89e3\uff1a\n\n\u4e0b\u9762\u662f\u4f5c\u6b7b\u8fc7\u7a0b\u2026\u2026\n\n\u9996\u5148\u6211\u4eec\u505a\u4e00\u904d\u540e\u7f00\u6570\u7ec4\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u6570\u5728 $rnk$ \u4e0a\u4e8c\u5206/\u500d\u589e\u5230\u533a\u95f4 $[L,R]$\u3002\u60f3\u5230\u83ab\u961f\uff0c\u5bf9\u4e8e\u4e00\u4e2a $[l,r]$ \u8f6c\u6362\u4e3a $[l,r+1]$ \u7684\u65f6\u5019\u770b\u770b $[L_{r+1},R_{r+1}]$ \u4e2d\u95f4\u591a\u5c11 $l\\leq sa\\leq r$\n\n\u7136\u540e\u6211\u4eec\u7528\u540e\u7f00\u6570\u7ec4+\u83ab\u961f+\u6811\u72b6\u6570\u7ec4\u6253\u51fa\u4e86 $O(n\\sqrt{n}\\log n)$ \u7684\u7248\u672c\u2026\u2026\n\n\u73b0\u5728\u6211\u4eec\u60f3\u53bb\u6389\u8fd9\u4e2a $\\log$\u2026\u2026\n\n\u6211\u60f3\u5230\u4e8c\u6b21\u79bb\u7ebf\u83ab\u961f\uff01\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt{n})$\n\n\u4f46\u662f\u6ca1\u7528\u2026\u2026\u8fd9\u9053\u9898 $n\\leq 3\\times 10^6$\u2026\u2026\n\n\u6b63\u89e3\uff1a\u54c8\u5e0c\n\n\u5bf9\u4e8e\u533a\u95f4 $[i,i+k-1](1\\leq i\\leq n-k+1)$ \u505a\u4e00\u904d\u54c8\u5e0c\uff0c\u628a\u95ee\u9898\u8f6c\u6362\u4e3a\u5c0f $Z$ \u7684\u889c\u5b50\u3002\n\n\u4f46\u662f\u6211\u4eec\u9700\u8981\u7384\u5b66\u8c03\u4e00\u8c03\u5757\u957f\u2026\u2026 $siz=\\frac {n}{\\sqrt{m}}$ \u5c31\u884c\u4e86\u3002\n\n\u6211\u4e5f\u4e0d\u77e5\u9053 $shadowice1984$ \u4e3a\u4ec0\u4e48\u6ca1\u5361\u6389\u81ea\u7136\u6ea2\u51fa\u2026\u2026\n\n$Code\\ Below:$\n\n```cpp\n#include <bits/stdc++.h>\n#define ull unsigned long long\nusing namespace std;\nconst int maxn=3000000+10;\nconst int base=233;\nint n,m,k,blo,cnt[maxn],tot;ull f[maxn],pw[maxn],val[maxn],mp[maxn],ans[maxn],now;\nchar s[maxn];\n\nstruct Query{\n    int l,r,id;\n}q[maxn];\n\ninline bool cmp(const Query &a,const Query &b){\n    if((a.l-1)/blo!=(b.l-1)/blo) return (a.l-1)/blo<(b.l-1)/blo;\n    return a.r<b.r;\n}\n\ninline int read(){\n    register int x=0,f=1;char ch=getchar();\n    while(!isdigit(ch)){if(ch=='-')f=-1;ch=getchar();};\n    while(isdigit(ch)){x=(x<<3)+(x<<1)+ch-'0';ch=getchar();}\n    return (f==1)?x:-x;\n}\n\ninline void add(int x){now+=cnt[val[x]]++;}\ninline void del(int x){now-=--cnt[val[x]];}\n\nint main()\n{\n    n=read(),m=read(),k=read();blo=n/(int)sqrt(m)+1;\n    scanf(\"%s\",s+1);\n    pw[0]=1;\n    for(int i=1;i<=n;i++){\n        f[i]=f[i-1]*base+s[i];\n        pw[i]=pw[i-1]*base;\n    }\n    for(int i=0;i<=n-k;i++) val[i+1]=mp[++tot]=f[i+k]-f[i]*pw[k];\n    sort(mp+1,mp+tot+1);\n    tot=unique(mp+1,mp+tot+1)-mp-1;\n    for(int i=1;i<=n;i++) val[i]=lower_bound(mp+1,mp+tot+1,val[i])-mp;\n    for(int i=1;i<=m;i++){\n        q[i].l=read(),q[i].r=read(),q[i].id=i;\n        if(q[i].r>n-k+1) q[i].r=n-k+1;\n        if(q[i].l>q[i].r) q[i].l=1,q[i].r=0;\n    }\n    sort(q+1,q+m+1,cmp);\n    int L=1,R=0;\n    for(int i=1;i<=m;i++){\n        while(R<q[i].r) add(++R);\n        while(R>q[i].r) del(R--);\n        while(L<q[i].l) del(L++);\n        while(L>q[i].l) add(--L);\n        ans[q[i].id]=now;\n    }\n    for(int i=1;i<=m;i++) printf(\"%lld\\n\",ans[i]);\n    return 0;\n}\n```",
        "postTime": 1550736029,
        "uid": 35069,
        "name": "Owen_codeisking",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5112 \u3010FZOUTSY\u3011"
    }
]