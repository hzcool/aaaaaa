[
    {
        "content": "\u5165 OI \u4ee5\u6765\u505a\u7684\u7b2c\u4e8c\u9053\u4ea4\u4e92\u9898\u3002\n\n[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P7971)\n\n### \u9898\u610f\u7b80\u8ff0\n\n\u6709 $n$ \u4e2a\u989c\u8272\u672a\u77e5\u7684\u7403\uff0c\u4f60\u73b0\u5728\u53ef\u4ee5\u901a\u8fc7 $Q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u4e00\u4e2a\u533a\u95f4 $[l,r]$ \u4e2d\u7403\u7684\u989c\u8272\u6570\uff0c\u9700\u8981\u4f60\u786e\u5b9a\u6700\u540e\u7684\u6240\u6709\u7403\u7684\u989c\u8272\u5f02\u540c\u3002\n\n\u6570\u636e\u8303\u56f4 $n \\leq 1000$\uff0c$2000 \\leq Q \\leq 10000$\uff0c$Q$ \u7684\u8303\u56f4\u4e0e\u5b50\u4efb\u52a1\u7279\u6027\u6709\u5173\u3002\n\n--------------------------------------------\n\n### \u4e00\u822c\u6027\u89e3\u6cd5\n\n\u5148\u53ef\u4ee5\u4e0d\u8003\u8651\u5b50\u4efb\u52a1\uff0c\u8003\u8651 $n=1000,Q=10000$ \u65f6\u600e\u4e48\u505a\u3002\n\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u4ece $n$ \u53f7\u7403\u63a8\u5230 $1$ \u53f7\u7403\uff0c\u5047\u8bbe\u5f53\u524d\u7684\u989c\u8272\u5df2\u7ecf\u51fa\u73b0\u4e86 $k$ \u4e2a\u4e0d\u540c\u7684\uff0c\u5206\u522b\u4e3a $c_1,c_2,c_3\\dots c_k$\uff0c\u5b83\u4eec\u51fa\u73b0\u7684 **\u6700\u9760\u524d\u7684\u4f4d\u7f6e** \u5206\u522b\u4e3a $p_1,p_2,p_3\\dots p_k$\uff0c\u6ee1\u8db3 $p$ \u5e8f\u5217\u5347\u5e8f\u3002\n\n\u90a3\u4e48\u5047\u8bbe\u5f53\u524d\u9700\u8981\u6c42\u89e3 $i$ \u53f7\u7403\uff0c\u90a3\u4e48\u5728 $[1,k]$ \u4e2d\u4e8c\u5206\u4e00\u4e2a $p_{mid}$\uff0c\u53ef\u4ee5\u81ea\u884c\u60f3\u8c61\u4e00\u4e0b\uff0c\u5982\u679c\u8be2\u95ee\u533a\u95f4 $[i,p_{mid}]$\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u662f $res$\uff0c\u5982\u679c\n\n- $res = mid$\uff0c\u90a3\u4e48\u8bf4\u660e\u8fd9\u4e00\u4e2a\u7403\u5728\u989c\u8272 $c_1,c_2,c_3\\dots c_{mid}$ \u4e4b\u95f4\uff0c\u5c06\u4e8c\u5206\u7684\u53f3\u7aef\u70b9\u53d8\u4e3a $mid-1$\u3002\n- $res=mid+1$\uff0c\u90a3\u4e48\u8bf4\u660e\u8fd9\u4e00\u4e2a\u7403\u5728\u989c\u8272 $c_{mid+1},c_{mid+2},c_{mid+3}\\dots c_k$ \u4e2d **\u6216\u8005\u662f\u4e00\u4e2a\u65b0\u989c\u8272**\uff0c\u5c06\u4e8c\u5206\u7684\u5de6\u7aef\u70b9\u53d8\u4e3a $mid+1$\u3002\n- \u597d\u5427\uff0c\u5176\u5b9e\u6ca1\u6709\u7b2c\u4e09\u79cd\u60c5\u51b5\u4e86\u3002\n\n\u6700\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7\u4e8c\u5206\u5f97\u5230\u7b54\u6848\u3002\u8fd9\u91cc\u4e3e\u4e00\u4e2a $col=[1,3,2,2,2,1]$ \u7684\u4f8b\u5b50\u6c42\u89e3 $col_1$ \u4ee5\u4fbf\u5927\u5bb6\u7406\u89e3\u3002\n\n- \u5f53\u524d $c=[3,2,1]$\uff0c$p=[2,3,6]$\uff0c\u4e8c\u5206\u5de6\u53f3\u7aef\u70b9\u4e3a $[1,3]$\u3002\n\t- $mid=2$\uff0c$p_{mid}=3$\uff0c\u8be2\u95ee $[1,3]$\uff0c$res=3$\uff0c\u8bf4\u660e\u8fd9\u4e00\u4e2a\u989c\u8272\u662f $1$ \u6216\u8005\u662f\u4e00\u4e2a\u65b0\u989c\u8272 $4$\u3002\u4e8c\u5206\u5de6\u53f3\u7aef\u70b9\u4e3a $[3,3]$\u3002\n   - $mid=3$\uff0c$p_{mid}=6$\uff0c\u8be2\u95ee $[1,6]$\uff0c$res=3$\uff0c\u8bf4\u660e\u8fd9\u4e00\u4e2a\u7403\u5c31\u662f\u989c\u8272 $1$\u3002\n- \u6700\u540e\u66f4\u65b0 $c=[1,3,2]$\uff0c$p=[1,2,3]$\u3002\n\n\u8fd9\u6837\u9700\u8981\u8be2\u95ee $n \\log_2 n$\uff0c\u5b9e\u6d4b\u53ef\u4ee5\u901a\u8fc7 $Q=10000$ \u7684\u5b50\u4efb\u52a1\u3002\n\n---------------------------------------\n\n### \u6570\u636e\u5206\u6cbb\n\n~~\u4e0d\u77e5\u9053\u6b63\u89e3\u662f\u5426\u9700\u8981\uff0c\u4f46\u662f\u6211\u7684\u9700\u8981\u3002~~\n\n- $T=2$\n\n\u989c\u8272\u6bb5\u8fde\u7eed\uff0c\u6240\u4ee5\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u7403 $i$\uff0c\u53ea\u9700\u8981\u8be2\u95ee $[i,i+1]$ \u5373\u53ef\u77e5\u9053\u5f02\u540c\u5173\u7cfb\u3002\u8be2\u95ee\u6b21\u6570\u4e3a $n-1$\u3002\n\n- $T=3$\n\n\u7167\u5e38\u505a\uff0c\u7528\u4e00\u822c\u6027\u89e3\u6cd5\uff0c\u8be2\u95ee\u6b21\u6570\u5927\u7ea6\u4e3a $2n-2$\u3002\n\n- $T=5$\n\n\u6bcf\u6b21\u8be2\u95ee\u533a\u95f4 $[i,n]$\uff0c\u5982\u679c $res_{i,n}=res_{i+1,n}$\uff0c\u90a3\u4e48\u5c31\u4e8c\u5206\uff0c\u5426\u5219\u5c31\u662f\u65b0\u989c\u8272\uff0c\u8be2\u95ee\u6b21\u6570\u5927\u7ea6\u4e3a $n+\\log_2 n$\u3002\n\n- $T=4$\n\n\u6709\u70b9\u610f\u601d\u3002\n\n\u5f53\u989c\u8272\u6570\u4e3a $4$ \u65f6\uff0c\u90a3\u4e48\u5c31\u4e0d\u53ef\u80fd\u51fa\u73b0\u65b0\u989c\u8272\u3002\u4e00\u4e2a\u53ef\u80fd\u4e8c\u5206\u7684\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\u3002\n\n- $[1,4]$\uff0c$mid=2$\u3002\n- $[3,4]$\uff0c$mid=3$\u3002\n- $[4,4]$\uff0c$mid=4$\u3002\n\n\u4f60\u4f1a\u53d1\u73b0\u8fd9\u6837\u5b50\u6bcf\u4e00\u4e2a\u7403\u4f1a\u8be2\u95ee $3$ \u6b21\uff0c\u603b\u8be2\u95ee\u6b21\u6570\u7ea6\u4e3a $3n$ \u65e0\u6cd5\u901a\u8fc7\u3002\n\n\u600e\u4e48\u4f18\u5316\u5462\uff1f\n\n\u7a81\u7834\u53e3\u5c31\u5728\u4e8e **\u4e0d\u53ef\u80fd\u51fa\u73b0\u65b0\u989c\u8272**\uff0c\u6240\u4ee5\u5f53\u4e8c\u5206\u533a\u95f4 $[l,r]$ \u6ee1\u8db3 $l=r$ \u4e14\u989c\u8272\u6570\u4e3a $4$ \u65f6\uff0c\u90a3\u4e48 $col_i=c_l$\uff0c\u56e0\u4e3a **\u53ea\u6709\u8fd9\u4e00\u79cd\u989c\u8272\u53ef\u9009\uff0c\u53c8\u4e0d\u53ef\u80fd\u51fa\u73b0\u65b0\u989c\u8272**\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u5c06\u8be2\u95ee\u6b21\u6570\u964d\u5230 $2n$ \u7ea7\u522b\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n---------------------------------------------\n\n### \u653e\u5728\u6700\u540e\n\n\u5f88\u597d\u7684\u4e00\u9053\u9898\u3002~~\u6211\u624d\u4e0d\u4f1a\u544a\u8bc9\u4f60\u6211\u505a\u4e86\u5f88\u4e45\u3002~~\n\u4ee3\u7801\u5c31\u4e0d\u653e\u4e86\uff08\u592a\u4e11\u4e86\uff09\u3002\n\n\u5b8c\u7ed3\u6492\u82b1\u3002",
        "postTime": 1638069594,
        "uid": 261914,
        "name": "Emy_Ycc",
        "ccfLevel": 6,
        "title": "P7971 [KSN2021] Colouring Balls"
    },
    {
        "content": "\u4ece\u524d\u5f80\u540e\u679a\u4e3e\uff0c\u6bcf\u6b21\u65b0\u786e\u5b9a\u4e00\u4e2a\u70b9 $i$ \u7684\u989c\u8272\uff0c\u6839\u636e Subtask \u4e0d\u540c\u505a\u6cd5\u4e0d\u540c\uff1a\n\nSubtask 2\uff1a\n\n\u6bcf\u79cd\u7403\u989c\u8272\u8fde\u7eed\uff0c\u53ef\u4ee5\u7c7b\u4f3c\u53cc\u6307\u9488\uff0c\u7ef4\u62a4\u4e00\u4e2a\u6307\u9488 $pos$\uff0c\u5982\u679c $[pos,i]$ \u7684\u989c\u8272\u4e0d\u4e3a $1$ \u5c31 $pos$ \u5411\u53f3\u79fb\uff0c\u53ef\u4ee5\u505a\u5230 $2N$ \u6b21\u3002\n\nSubtask 3&4\uff1a\n\n\u5bf9\u4e8e $3$ \u79cd\u989c\u8272\uff0c\u7ef4\u62a4\u6bcf\u79cd\u989c\u8272\u6700\u540e\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u5c06\u989c\u8272\u6309\u7167\u4f4d\u7f6e\u6392\u5e8f\uff0c\u4e00\u4e00\u8be2\u95ee\u5224\u65ad\uff0c\u53ef\u4ee5\u505a\u5230 $2N$ \u6b21\u3002\n\n$4$ \u79cd\u989c\u8272\u65f6\u8fd9\u6837\u505a\u662f $3N$ \u6b21\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u624b\u52a8\u5728 $4$ \u79cd\u989c\u8272\u4e0a\u4e8c\u5206\u505a\u5230 $2N$ \u6b21\u3002\n\nSubtask 5\uff1a\n\n\u8fd9\u4e2a Subtask \u91c7\u53d6\u4e00\u4e2a\u4e0d\u4e00\u6837\u7684\u505a\u6cd5\u3002\n\n\u5148\u7279\u5224\u6240\u6709\u989c\u8272\u4e92\u4e0d\u76f8\u540c\u3002\n\n\u7ef4\u62a4\u4e24\u4e2a\u6307\u9488 $L,R$\uff0c\u4e00\u76f4\u5c06 $L$ \u5411\u53f3\u79fb\uff0c\u4fdd\u8bc1 $[L,R]$ \u7684\u989c\u8272\u4e3a $R-L$\uff0c\u4e4b\u540e\u518d\u628a $R$ \u5411\u5de6\u79fb\uff0c$L,R$ \u5c31\u662f\u989c\u8272\u76f8\u540c\u7684\u4e24\u4e2a\u70b9\u3002\n\nSubtask 7\uff1a\n\n$N=1000,Q=10000$\uff0c\u662f\u4e00\u4e2a $N\\log N$ \u7ea7\u522b\u7684\u7b97\u6cd5\u3002\n\n\u4e0d\u96be\u60f3\u5230\u4e8c\u5206\uff0c\u4e8c\u5206\u4e00\u4e2a\u4f4d\u7f6e $mid$\uff0c\u5224\u65ad $[mid,i-1]$ \u4e0e $[mid,i]$ \u4e4b\u95f4\u7684\u989c\u8272\u6570\u662f\u5426\u76f8\u540c\uff0c\u5982\u679c\u76f8\u540c\u8bf4\u660e $[mid,i-1]$ \u4e2d\u6709\u4e0e $i$ \u989c\u8272\u76f8\u540c\u7684\u70b9\uff0c\u6570 $[mid,i-1]$ \u7684\u989c\u8272\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u6570\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define re register\nusing namespace std;\ninline int read(){\n\tre int t=0;re char v=getchar();\n\twhile(v<'0')v=getchar();\n\twhile(v>='0')t=(t<<3)+(t<<1)+v-48,v=getchar();\n\treturn t;\n}\nconst int M=998244353;\ninline void add(re int &x,re int y){(x+=y)>=M?x-=M:x;}\ninline int Mod(re int x){return x>=M?x-M:x;}\ninline int ksm(re int x,re int y){\n\tre int s=1;\n\twhile(y){\n\t\tif(y&1)s=1ll*s*x%M;\n\t\tx=1ll*x*x%M,y>>=1;\n\t}\n\treturn s;\n}\nint t,n,m,a[1000002],ans,c[10002],tot,v[10002],tim,lst[8],p[8];\ninline bool cmp(re int x,re int y){return lst[x]>lst[y];}\ninline int Count(re int l,re int r){\n\t++tim;\n\tre int s=0;\n\tfor(re int i=l;i<=r;++i)if(v[c[i]]!=tim)v[c[i]]=tim,++s;\n\treturn s;\n}\ninline int ask(re int l,re int r){\n\tprintf(\"? %d %d\\n\",l,r);\n\tfflush(stdout);\n\treturn read();\n}\nint main(){\n\tt=read(),n=read(),m=read();\n\tif(t==2){\n\t\tc[1]=tot=1;re int pos=1;\n\t\tfor(re int i=2;i<=n;++i){\n\t\t\twhile(ask(pos,i)!=1)++pos;\n\t\t\tif(pos==i)c[i]=++tot;\n\t\t\telse c[i]=c[pos];\n\t\t}\n\t\tprintf(\"! \");\n\t\tfor(re int i=1;i<=n;++i)printf(\"%d \",c[i]);\n\t\tfflush(stdout);\n\t\treturn 0;\n\t}\n\tif(t==3){\n\t\tc[1]=tot=1,lst[1]=1,p[1]=1,p[2]=2,p[3]=3;\n\t\tfor(re int i=2;i<=n;++i){\n\t\t\tsort(p+1,p+4,cmp);\n\t\t\tfor(re int j=1;j<=3;++j){\n\t\t\t\tif(j==3||lst[p[j]]==0){c[i]=p[j];break;}\n\t\t\t\tif(ask(lst[p[j]],i)==j){c[i]=p[j];break;}\n\t\t\t}\n\t\t\tlst[c[i]]=i;\n\t\t}\n\t\tprintf(\"! \");\n\t\tfor(re int i=1;i<=n;++i)printf(\"%d \",c[i]);\n\t\tfflush(stdout);\n\t\treturn 0;\n\t}\n\tif(t==4){\n\t\tc[1]=tot=1,lst[1]=1,p[1]=1,p[2]=2,p[3]=3,p[4]=4;\n\t\tfor(re int i=2;i<=n;++i){\n\t\t\tsort(p+1,p+5,cmp);\n\t\t\tif(lst[p[2]]==0||ask(lst[p[2]],i)<=2){\n\t\t\t\tif(ask(lst[p[1]],i)==1)c[i]=p[1];\n\t\t\t\telse c[i]=p[2];\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(!lst[p[3]]||ask(lst[p[3]],i)==3)c[i]=p[3];\n\t\t\t\telse c[i]=p[4];\n\t\t\t}\n\t\t\tlst[c[i]]=i;\n\t\t}\n\t\tprintf(\"! \");\n\t\tfor(re int i=1;i<=n;++i)printf(\"%d \",c[i]);\n\t\tfflush(stdout);\n\t\treturn 0;\n\t}\n\tif(t==5){\n\t\tre int L=1,R=n;\n\t\tif(ask(L,R)==n){\n\t\tprintf(\"! \");\n\t\tfor(re int i=1;i<=n;++i)printf(\"%d \",i);\n\t\tfflush(stdout);\n\t\treturn 0;\n\t}\n\t\twhile(ask(L,R)==R-L)--R;\n\t\t++R;\n\t\twhile(ask(L,R)==R-L)++L;\n\t\t--L;\n\t\tfor(re int i=1;i<=n;++i)if(i!=R)c[i]=++tot;else c[i]=c[L];\n\t\tprintf(\"! \");\n\t\tfor(re int i=1;i<=n;++i)printf(\"%d \",c[i]);\n\t\tfflush(stdout);\n\t\treturn 0;\n\t}\n\tc[1]=1,tot=1;\n\tfor(re int i=2;i<=n;++i){\n\t\tre int l=1,r=i-1,pos=i;\n\t\twhile(l<=r){\n\t\t\tre int mid=l+r>>1;\n\t\t\tif(ask(mid,i)!=Count(mid,i-1))pos=mid,r=mid-1;\n\t\t\telse l=mid+1;\n\t\t}\n\t\tif(pos==1)c[i]=++tot;\n\t\telse c[i]=c[pos-1];\n\t}\n\tprintf(\"! \");\n\tfor(re int i=1;i<=n;++i)printf(\"%d \",c[i]);\n\tfflush(stdout);\n}\n```\n",
        "postTime": 1637737308,
        "uid": 41476,
        "name": "gyh20",
        "ccfLevel": 10,
        "title": "P7971"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2a\u4e0d\u4e00\u6837\u7684\u6570\u636e\u5206\u6cbb\u505a\u6cd5\u3002\n\n---\n\n\u9898\u610f\u5df2\u7ecf\u5f88\u6e05\u695a\u4e86\u3002\n\n\u4e0d\u8003\u8651 Subtask\uff0c\u5148\u601d\u8003\u4e00\u4e0b\u6b63\u5e38\u505a\u6cd5\u3002\n\n\u9996\u5148\u7b2c $1$ \u4e2a\u7403\u989c\u8272\u76f4\u63a5\u5c31\u662f $1$\u3002\u7b2c $2$ \u4e2a\u7403\u8be2\u95ee $[1,2]$ \u7684\u989c\u8272\u6570 $t$\uff0c\u989c\u8272\u5176\u5b9e\u5c31\u662f $t$\u3002\u5230\u7b2c\u4e09\u4e2a\u7403\u65f6\u4e8b\u60c5\u53d8\u5f97\u590d\u6742\u8d77\u6765\uff0c\u5982\u679c\u76f4\u63a5\u8be2\u95ee $[2,3]$ \u989c\u8272\u6570\uff0c\u56de\u7b54\u5982\u679c\u662f $2$\uff0c\u5c31\u8fd8\u8981\u95ee\u4e00\u904d $[1,3]$\u3002\u4ee5\u6b64\u7c7b\u63a8\u3002\n\n\u7ed3\u5408\u6570\u636e\u8303\u56f4 $N=10^3,Q=10^4$\uff0c\u4e00\u4e2a\u5927\u6982\u7684\u4e8c\u5206\u60f3\u6cd5\u6d6e\u51fa\u6c34\u9762\u3002\u8bbe\u5f53\u524d\u7403\u662f $i$\uff0c\u5728 $[1,i-1]$ \u4e0a\u4e8c\u5206\uff0c\u5982\u679c\u5f53\u524d\u4e2d\u70b9 $m$ \u5230 $i-1$ \u7684\u5df2\u77e5\u989c\u8272\u6570\uff08\u8fd9\u91cc\u76f4\u63a5\u66b4\u529b\u904d\u5386\uff09\u7b49\u4e8e\u8be2\u95ee $[m,i]$ \u7684\u56de\u7b54\uff0c\u90a3\u5c31\u8bf4\u660e $\\exists \\ j \\in [m,i-1],col_j=col_i$\uff0c\u7f29\u5c0f\u4e8c\u5206\u5de6\u8fb9\u754c\uff1b\u5426\u5219\u7f29\u5c0f\u4e8c\u5206\u53f3\u8fb9\u754c\u3002\u5982\u679c\u6700\u540e\u6ca1\u6709\u5f97\u5230\u7b54\u6848\uff0c\u8bf4\u660e $i$ \u662f\u6ca1\u6709\u51fa\u73b0\u8fc7\u7684\u989c\u8272\uff0c\u5426\u5219 $i$ \u7684\u989c\u8272\u5c31\u662f\u4e8c\u5206\u7b54\u6848\u4f4d\u7f6e\u7684\u989c\u8272\u3002\u8fd9\u6837\u7684\u5199\u6cd5\u8db3\u591f\u901a\u8fc7\u4efb\u4f55 $Q=10^4$ \u7684\u70b9\u3002\n\n$Q=2 \\times 10^3$ \u7684\u70b9\u600e\u4e48\u505a\uff1f\u770b\u8d77\u6765\u53ea\u80fd\u6570\u636e\u5206\u6cbb\u4e86\u3002\n\n\u5148\u8003\u8651\u6700\u7b80\u5355\u7684 Subtask 2&5\u3002\u5bf9\u4e8e\u7f16\u53f7\u8fde\u7eed\uff0c\u4e00\u4e2a\u7403\u7684\u989c\u8272\u76f4\u63a5\u8be2\u95ee\u5176\u4e0e\u524d\u4e00\u4e2a\u7403\u7684\u989c\u8272\u603b\u6570\uff0c\u82e5\u4e3a $1$ \u5219\u4e8c\u8005\u989c\u8272\u76f8\u540c\uff0c\u5426\u5219\u662f\u4e00\u4e2a\u65b0\u989c\u8272\u3002\u5bf9\u4e8e\u81f3\u591a\u53ea\u6709 $2$ \u4e2a\u7403\u7684\u989c\u8272\u76f8\u540c\uff0c\u8bbe\u4e24\u4e2a\u6307\u9488 $L=R=1$\uff0c\u6301\u7eed\u5c06 $R$ \u53f3\u79fb\u76f4\u5230 $[L,R]$ \u7684\u989c\u8272\u4e0d\u7b49\u4e8e\u533a\u95f4\u957f\u5ea6\uff0c\u7136\u540e\u6301\u7eed\u5c06 $L$ \u53f3\u79fb\u76f4\u5230 $[L+1,R]$ \u7684\u989c\u8272\u6570\u7b49\u4e8e $R-L$\uff0c\u6b64\u65f6\u7684 $L,R$ \u5c31\u662f\u989c\u8272\u76f8\u540c\u7684\u4e24\u4e2a\u7403\u3002\n\n\u5bf9\u4e8e Subtask 3&4\uff0c\u6781\u5c0f\u7684\u989c\u8272\u6570\u91cf\u7ed9\u4e86\u6211\u5206\u7c7b\u8ba8\u8bba\u7684\u52c7\u6c14\u3002\u8bbe\u5f53\u524d\u51fa\u73b0\u8fc7\u7684\u989c\u8272\u6570\u91cf\u4e3a $k$\uff0c\u6309\u6700\u8fd1\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u540e\u5206\u522b\u662f $\\texttt{std::pair<int,int>fir,sec,thi,fou}$\uff0c\u5176\u4e2d\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u4f4d\u7f6e\uff08\u4ee5\u4e0b\u7528 $pos1,pos2,pos3,pos4$ \u8868\u793a\uff09\uff0c\u7b2c\u4e8c\u4e2a\u5143\u7d20\u662f\u989c\u8272\u7f16\u53f7\uff08\u4ee5\u4e0b\u7528 $id1,id2,id3,id4$ \u8868\u793a\uff09\u3002\n\n- \u82e5\u4e0d\u5b58\u5728 $thi$\uff0c\u76f4\u63a5\u8be2\u95ee $[pos4,i]$\uff0c\u6839\u636e\u56de\u7b54\u5224\u65ad\u662f\u5426\u662f\u65b0\u989c\u8272\u3002\n- \u82e5\u4e0d\u5b58\u5728 $sec$\uff0c\u8be2\u95ee $[pos4,i]$\uff0c\u82e5\u56de\u7b54\u4e3a $1$ \u5219 $col_i=id4$\uff0c\u5426\u5219\u8be2\u95ee $[pos3,i]$\uff0c\u82e5\u56de\u7b54\u4e3a $2$ \u5219 $col_i=id3$\uff0c\u5426\u5219\u662f\u65b0\u989c\u8272\u3002\n- \u82e5\u4e0d\u5b58\u5728 $fir$\uff0c\u8be2\u95ee $[pos3,i]$\uff0c\u82e5\u56de\u7b54\u4e3a $2$ \u5219\u6839\u636e $[pos4,i]$ \u7684\u7b54\u6848\u5224\u65ad\u662f $id4$ \u8fd8\u662f\u65b0\u989c\u8272\uff1b\u82e5\u56de\u7b54\u662f $3$ \u5219\u6839\u636e $[pos2,i]$ \u7684\u56de\u7b54\u5224\u65ad\u662f $id2$ \u8fd8\u662f\u65b0\u989c\u8272\u3002\n- \u82e5\u90fd\u5b58\u5728\uff0c\u8be2\u95ee $[pos3,i]$\uff0c\u82e5\u56de\u7b54\u662f $2$ \u5219\u6839\u636e $[pos4,i]$ \u7684\u56de\u7b54\u5224\u65ad\u662f $id3$ \u8fd8\u662f $id4$\uff1b\u82e5\u56de\u7b54\u662f $3$ \u5219\u6839\u636e $[pos2,i]$ \u7684\u56de\u7b54\u5224\u65ad\u662f $id1$ \u8fd8\u662f $id2$\uff0c\u56e0\u4e3a\u6b64\u65f6\u5df2\u7ecf\u4e0d\u5b58\u5728\u65b0\u989c\u8272\u4e86\u3002\n\n\u5b9e\u9645\u4e0a\u4ee3\u7801\u8fdc\u6bd4\u60f3\u8c61\u4e2d\u597d\u5199\uff0c\u522b\u88ab\u5413\u5230\u4e86\u3002\n\n\u4ee5\u4e0a\u7684\u6240\u6709\u6570\u636e\u5206\u6cbb\uff0c\u90fd\u53ef\u4ee5\u76f4\u63a5\u770b\u51fa\u8be2\u95ee\u6b21\u6570\u4e0d\u8d85\u8fc7 $2n$\uff0c\u80fd\u901a\u8fc7\u672c\u9898\u3002\n\n\u6b63\u5e38\u505a\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(n^2 \\log n)$\uff0c\u6570\u636e\u5206\u6cbb\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\Theta(n)$\u3002\n\n\u7ed9\u4e2a\u5206\u7c7b\u8ba8\u8bba\u7684\u90e8\u5206\u3002\n\n```cpp\npii mem[10];\nint last[10];\nvoid tturn(pii &a,pii &b,pii &c){\n\tmem[1]=a,mem[2]=b,mem[3]=c;\n\tstd::sort(mem+1,mem+4);\n\ta=mem[1],b=mem[2],c=mem[3];\n\treturn;\n}\nvoid fturn(pii &a,pii &b,pii &c,pii &d){\n\tmem[1]=a,mem[2]=b,mem[3]=c,mem[4]=d;\n\tstd::sort(mem+1,mem+5);\n\ta=mem[1],b=mem[2],c=mem[3],d=mem[4];\n\treturn;\n}\nvoid refer(int i,int ncol){\n\tcol[i]=ncol;\n\tlast[ncol]=i;\n\treturn;\n}\n#define id second\nvoid count(int gave){\n\tcol[1]=ccnt=last[1]=1;\n\tif(gave==3){\n\t\tfor(int i=2;i<=n;i++){\n\t\t\tpii fir={last[1],1},sec={last[2],2},thi={last[3],3};\n\t\t\ttturn(fir,sec,thi);\n\t\t\tif(!sec.first){\n\t\t\t\tif(qcol(thi.first,i)==2)refer(i,++ccnt);\n\t\t\t\telse refer(i,1);\n\t\t\t}\n\t\t\telse if(!fir.first){\n\t\t\t\tif(qcol(sec.first,i)==3)refer(i,++ccnt);\n\t\t\t\telse{\n\t\t\t\t\tif(qcol(thi.first,i)==1)refer(i,thi.id);\n\t\t\t\t\telse refer(i,sec.id);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(qcol(sec.first,i)==3)refer(i,fir.id);\n\t\t\t\telse{\n\t\t\t\t\tif(qcol(thi.first,i)==1)refer(i,thi.id);\n\t\t\t\t\telse refer(i,sec.id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\telse{\n\t\tfor(int i=2;i<=n;i++){\n\t\t\tpii fir={last[1],1},sec={last[2],2},thi={last[3],3},fou={last[4],4};\n\t\t\tfturn(fir,sec,thi,fou);\n\t\t\tif(!sec.first){\n\t\t\t\tif(!thi.first){\n\t\t\t\t\tif(qcol(fou.first,i)==2)refer(i,++ccnt);\n\t\t\t\t\telse refer(i,1);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tif(qcol(thi.first,i)==3)refer(i,++ccnt);\n\t\t\t\t\telse{\n\t\t\t\t\t\tif(qcol(fou.first,i)==1)refer(i,fou.id);\n\t\t\t\t\t\telse refer(i,thi.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if(!fir.first){\n\t\t\t\tif(qcol(thi.first,i)==3){\n\t\t\t\t\tif(qcol(sec.first,i)==4)refer(i,++ccnt);\n\t\t\t\t\telse refer(i,sec.id);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tif(qcol(fou.first,i)==1)refer(i,fou.id);\n\t\t\t\t\telse refer(i,thi.id);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(qcol(thi.first,i)==3){\n\t\t\t\t\tif(qcol(sec.first,i)==4)refer(i,fir.id);\n\t\t\t\t\telse refer(i,sec.id);\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tif(qcol(fou.first,i)==1)refer(i,fou.id);\n\t\t\t\t\telse refer(i,thi.id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treport();\n\treturn;\n}\n#undef id\n```\n\n\u611f\u8c22\u4f60\u7684\u9605\u8bfb\u3002",
        "postTime": 1640346385,
        "uid": 293810,
        "name": "serene_analysis",
        "ccfLevel": 7,
        "title": "P7971 [KSN2021] Colouring Balls"
    },
    {
        "content": "\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff0c\u4ee5\u53ca\u4ee3\u7801\uff0c\u8bf7\u89c1 <https://www.cnblogs.com/2020gyk080/p/16878561.html>\u3002\n\n\u7eaa\u5ff5\u4e00\u4e0b\u4eba\u751f\u4e2d\u7b2c\u4e00\u9053\u6570\u636e\u5206\u6cbb\u9898\u3002\n\n## Subtask 1&2\n\n\u8fd9\u4e00\u90e8\u5206\u5177\u6709\u7684\u7279\u6b8a\u6027\u8d28\u662f\u989c\u8272\u6bb5\u8fde\u7eed\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u5224\u65ad\u5f53\u524d\u4e0e\u524d\u4e00\u4e2a\u7684\u989c\u8272\u6570\u662f\u5426\u4e3a 1\uff0c\u82e5\u662f\u5219\u989c\u8272\u76f8\u540c\uff0c\u5426\u5219\u8ba9\u989c\u8272 +1\u3002\n\n\n## Subtask 3&4\n\n\u8fd9\u4e00\u90e8\u5206\u7531\u4e8e\u989c\u8272\u6570\u4e0d\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u8bb0\u5f55\u5f53\u524d\u4f4d\u7f6e\u5df2\u7ecf\u51fa\u73b0\u7684\u989c\u8272\u6570\u91cf\u4ee5\u53ca\u6bcf\u79cd\u989c\u8272\u6700\u540e\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u6839\u636e\u8fd9\u4e2a\u76f4\u63a5\u5206\u7c7b\u8ba8\u8bba\u5f53\u524d\u4f4d\u7f6e\u7684\u989c\u8272\u3002\n\n## Subtask 5\n\n\u9996\u5148\u7279\u5224\u6389\u6bcf\u4e2a\u4f4d\u7f6e\u989c\u8272\u90fd\u4e0d\u540c\u7684\u60c5\u51b5\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u53cc\u6307\u9488\uff0c\u7ef4\u62a4\u4e24\u4e2a\u6307\u9488 $i,j$\uff0c\u8ba9\u5b83\u4eec\u4e0d\u65ad\u5411\u4e2d\u95f4\u79fb\u52a8\u7684\u540c\u65f6\u4fdd\u8bc1 $[i,j]$ \u7684\u989c\u8272\u6570\u7b49\u4e8e $j-i$\uff0c\u6700\u540e\u627e\u5230\u7684\u4e24\u4e2a\u6307\u9488\u7684\u4f4d\u7f6e\u5c31\u662f\u989c\u8272\u76f8\u540c\u7684\u5730\u65b9\u3002\n\n## Subtask 6&7\n\n\u8003\u8651\u4e8c\u5206\uff0c\u5224\u65ad $[mid,i-1]$ \u7684\u989c\u8272\u6570\u662f\u5426\u7b49\u4e8e $[mid,i]$ \u7684\u989c\u8272\u6570\uff0c\u5982\u679c\u76f8\u540c\u5219\u8bf4\u660e $[mid,i-1]$ \u4e2d\u6709\u4e0e $i$ \u989c\u8272\u76f8\u540c\u7684\u70b9\uff0c\u66b4\u529b\u6570\u51fa\u6765\u5373\u53ef\u3002",
        "postTime": 1668080648,
        "uid": 470638,
        "name": "Steven_lzx",
        "ccfLevel": 5,
        "title": "\u6d1b\u8c37 P7971 [KSN2021] Colouring Balls \u9898\u89e3"
    },
    {
        "content": "\u5f88\u6709\u610f\u601d\u7684\u4e00\u9053\u4ea4\u4e92\u9898\u3002\n\n# \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u989c\u8272\u5e8f\u5217 $a$\uff0c\u6bcf\u6b21\u53ef\u4ee5\u8be2\u95ee $l$ ~ $r$ \u4e2d\u4e0d\u540c\u7684\u989c\u8272\u4e2a\u6570\uff0c\u8981\u6c42\u590d\u539f\u51fa\u6574\u4e2a\u5e8f\u5217\u3002\n\n# Subtask 1 & 2\n\n\u9001\u5206\u7684\uff0c\u6bcf\u6b21\u8be2\u95ee $p$ \u548c $p + 1$ \u4f4d\u7f6e\uff0c\u5982\u679c\u8fd4\u56de $2$ \u5c31\u8bf4\u660e\u4ed6\u4fe9\u989c\u8272\u4e0d\u540c\uff0c$p + 1$ \u4f4d\u7f6e\u662f\u4e00\u4e2a\u65b0\u7684\u989c\u8272\uff0c\u5426\u5219\u5b83\u4fe9\u989c\u8272\u76f8\u540c\u3002\n\n# Subtask 3 ~ 4 & 6 ~ 7\n\n\u89c2\u5bdf\u8fd9\u51e0\u7ec4 Subtask \u7684\u8be2\u95ee\u6b21\u6570\u9650\u5236\uff0c\u53d1\u73b0\u90fd\u662f $n \\log n$ \u7ea7\u522b\u7684\uff0c\u6211\u4eec\u8003\u8651\u4e8c\u5206\u3002\n\n\u9996\u5148\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u8981\u6c42 $a_i$ \u5e76\u4e14\u6211\u4eec\u5df2\u7ecf\u6c42\u51fa\u4e86 $a_1$ ~ $a_{i-1}$\u3002\n\n\u8003\u8651\u8fd9\u6837\u4e00\u79cd\u60c5\u51b5\uff1a\n\n```\n1 2 3 3 2 4\n```\n\n\u5176\u4e2d\u524d\u516d\u9879\u662f\u6211\u4eec\u5728\u4e4b\u524d\u8fc7\u7a0b\u4e2d\u6c42\u5f97\u7684\uff0c\u6211\u4eec\u8981\u6c42\u51fa\u989c\u8272\u5e8f\u5217\u7684\u7b2c\u4e03\u9879\u3002\n\n\u90a3\u4e48\u6211\u4eec\u4ece\u53f3\u5f80\u5de6\u904d\u5386\u6574\u4e2a\u5e8f\u5217\uff0c\u6bcf\u6b21\u51fa\u73b0\u4e00\u79cd\u65b0\u989c\u8272\u5c31\u8bb0\u4e0b\u5b83\u7684\u4f4d\u7f6e\uff0c\u5b58\u5165 $p$ \u6570\u7ec4\u4e2d\u3002\n\n\u4f8b\u4e2d\u8fd9\u4e2a\u5e8f\u5217\u4e2d\u6211\u4eec\u8bb0\u4e0b\u7684\u4f4d\u7f6e\u4e3a 6(\u989c\u8272 4)\u30015(\u989c\u8272 2)\u30014(\u989c\u8272 3)\u30011(\u989c\u8272 1)\uff0c\u5219 $p = [6, 5, 4, 1]$\u3002\n\n\u5bb9\u6613\u53d1\u73b0 $p_j$ \u5230 $i$ \u4f4d\u7f6e\u4e2d \u5171\u6709 $j$ \u79cd\u4e0d\u540c\u7684\u989c\u8272\u3002\n\n\u8003\u8651\u5bf9\u4e8e $p_j$ ~ $i$ \u8fdb\u884c\u4e00\u6b21\u67e5\u8be2\uff0c\u5982\u679c\u7ed3\u679c\u521a\u597d\u7b49\u4e8e $j$ \u5219\u8bf4\u660e $a_i$ \u5728 $a_{p_j}$ ~ $a_{i - 1}$ \u4e2d\u51fa\u73b0\u8fc7\uff0c\u5982\u679c\u7ed3\u679c\u7b49\u4e8e $j + 1$ \u5219\u8bf4\u660e $a_i$ \u672a\u5728 $a_{p_j}$ ~ $a_{i - 1}$ \u4e2d\u51fa\u73b0\u8fc7\u3002\n\n\u6bd4\u5982\u4f8b\u4e2d\u82e5 $a_7 = 3$\uff0c\u6211\u4eec\u67e5\u8be2 $5$ ~ $7$ \u7ed3\u679c\u4e3a $2$\uff0c\u8bf4\u660e $a_7$ \u672a\u5728 $a_5$ ~ $a_6$ \u51fa\u73b0\u8fc7\uff0c\u6211\u4eec\u67e5\u8be2 $4$ ~ $7$ \u7ed3\u679c\u4e3a $2$\uff0c\u8bf4\u660e $a_7$ \u5728 $a_4$ ~ $a_6$ \u4e2d\u51fa\u73b0\u8fc7\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u4e8c\u5206\u4e86\u3002\u6bcf\u6b21\u5bf9\u4e8e $mid$ \u7528\u4e0a\u8ff0\u65b9\u5f0f\u8fdb\u884c\u67e5\u8be2\uff0c\u82e5 $a_i$ \u5728 $a_{p_j}$ ~ $a_{i - 1}$ \u4e2d\u51fa\u73b0\u8fc7\u5219\u5de6\u79fb\u53f3\u6307\u9488\uff0c\u5426\u5219\u53f3\u79fb\u5de6\u6307\u9488\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u4e8c\u5206\u6700\u540e\u65e0\u89e3\uff0c\u5c31\u8bf4\u660e $a_i$ \u672a\u5728 $a_1$ ~ $a_{i-1}$ \u4e2d\u51fa\u73b0\u8fc7\uff0c\u90a3\u4e48 $a_i$ \u5c31\u662f\u4e00\u79cd\u65b0\u989c\u8272\u3002\n\n\u53e6\u5916\uff0c\u6211\u4eec\u53d1\u73b0 Subtask 4 \u4e2d\u6211\u4eec\u7684\u67e5\u8be2\u6b21\u6570\u4f1a\u88ab\u5361\uff0c\u8fd9\u662f\u56e0\u4e3a\u5982\u679c\u76f4\u63a5\u5728 $1$ ~ $4$ \u7684\u503c\u57df\u5185\u4e8c\u5206\uff0c\u5219\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u7684\u67e5\u8be2\u6b21\u6570\u4e0a\u754c\u4e3a $3$\uff0c\u603b\u67e5\u8be2\u6b21\u6570\u4e0a\u754c\u4e3a $3n$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u9700\u8981\u8003\u8651\u4f18\u5316\u3002\n\n\u9996\u5148\u67e5\u8be2\u4e00\u6b21 $1$ ~ $n$ \u6765\u67e5\u8be2\u5e8f\u5217\u7684\u603b\u989c\u8272\u6570 $tot$\uff0c\u5982\u679c\u5f53\u524d\u51fa\u73b0\u8fc7\u7684\u989c\u8272\u6570\u91cf\u7b49\u4e8e $tot$\uff0c\u6211\u4eec\u5c31\u628a\u4e8c\u5206\u4e2d $r$ \u7684\u521d\u59cb\u503c\u6539\u4e3a $tot - 1$\u3002\u5982\u679c\u6700\u540e\u4e8c\u5206\u65e0\u89e3\u90a3\u4e48\u5c31\u8bf4\u660e\u5f53\u524d\u989c\u8272\u4e3a $a_{p_{tot}}$ \u4e86\u3002\n\n\u8fd9\u6837\u4e8c\u5206\u7684\u503c\u57df\u53d8\u4e3a $1$ ~ $3$\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u67e5\u8be2\u6b21\u6570\u4e0a\u754c\u53d8\u4e3a $2$\uff0c\u53ef\u4ee5\u901a\u8fc7 Subtask 4 \u4e86\u3002\n\n# Subtask 5\n\n\u4e8c\u5206\u505a\u6cd5 $10^4$ \u7684\u6b21\u6570\u4e0a\u754c\u4e0d\u8db3\u4ee5\u76f4\u63a5\u901a\u8fc7 Subtask 5\u3002\n\n\u9996\u5148\u67e5\u8be2\u4e00\u6b21 $1$ ~ $n$ \u6c42\u51fa\u5e8f\u5217\u7684\u603b\u989c\u8272\u6570 $tot$\u3002\n\n\u5982\u679c $tot = n$\uff0c\u76f4\u63a5\u8f93\u51fa $1$ ~ $n$ \u5373\u53ef\u3002\n\n\u5982\u679c $tot = n - 1$\uff0c\u90a3\u4e48\u4e00\u5b9a\u6709\u4e24\u4e2a\u4f4d\u7f6e\u7684\u989c\u8272\u76f8\u540c\u3002\n\n\u6211\u4eec\u7ef4\u62a4\u4e24\u4e2a\u6307\u9488 $l$\uff0c$r$\uff0c\u521d\u503c\u4e3a $1$ \u4e0e $n$\u3002\n\n\u5f53 $Query(1, r) = r - 1$ \u65f6\u4e0d\u65ad\u5de6\u79fb $r$\uff0c\n\n\u5f53 $Query(l, n) = n - l$ \u65f6\u4e0d\u65ad\u53f3\u79fb $l$\uff0c\n\n\u90a3\u4e48 $l - 1$ \u4e0e $r + 1$ \u663e\u7136\u5c31\u662f\u4e24\u4e2a\u91cd\u590d\u989c\u8272\u7684\u4f4d\u7f6e\u3002\n\n# \u53c2\u8003\u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n#define ff fflush(stdout)\n#define fop(i, l, r) for (int i = l; i <= r; ++i)\n#define pof(i, r, l) for (int i = r; i >= l; --i)\n#define edg(i, u) for (int i = head[u], v = to[i]; i; i = nxt[i], v = to[i])\ntypedef long long ll;\ntypedef unsigned long long ull;\n#define int ll\nconst int inf = 0x3f3f3f3f;\nusing namespace std;\n\nint read() {\n    int x = 0; bool f = 0; char c;\n    while (!isdigit(c = getchar())) if (c == '-') f = 1;\n    do x = (x << 1) + (x << 3) + (c ^ 48); while (isdigit(c = getchar()));\n    return f ? -x : x;\n}\n\nconst int maxn = 1e3 + 4;\n\nint col[maxn]; bool vis[maxn];\n\nint query(int l, int r) { printf(\"? %lld %lld\\n\", l, r); ff; return read(); }\n\nint TOT; int p[maxn], tot;\n\nint get(int x) {\n\ttot = 0;\n\tpof(i, x - 1, 1) if (!vis[col[i]]) vis[col[i]] = 1, p[++tot] = i;\n\tpof(i, x - 1, 1) vis[col[i]] = 0;\n\tint l = 1, r = tot, res = -1;\n\tif (tot == TOT) r = tot - 1;\n\twhile (l <= r) {\n\t\tint mid = (l + r) >> 1;\n\t\tif (query(p[mid], x) == mid + 1) l = mid + 1;\n\t\telse r = mid - 1, res = mid;\n\t}\n\tif (res == -1 && tot == TOT) return col[p[tot]];\n\tif (res == -1) return ++tot;\n\treturn col[p[res]];\n}\n\nsigned main() {\n\tint T = read(), N = read(), Q = read();\n\tif (T <= 2) {\n\t\tfop(i, 2, N) if (query(i - 1, i) == 2) vis[i] = 1;\n\t\tint tot = 1;\n\t\tfop(i, 1, N) { if (vis[i]) ++tot; col[i] = tot; }\n\t}\n\telse {\n\t\tTOT = query(1, N);\n\t\tif (TOT == N) fop(i, 1, N) col[i] = i;\n\t\telse if (TOT == N - 1) {\n\t\t\tint l = 1, r = N;\n\t\t\twhile (query(1, r) == r - 1) --r;\n\t\t\twhile (query(l, N) == N - l) ++l;\n\t\t\t++r, --l;\n\t\t\tfop(i, 1, N) if (i == r) col[i] = l; else col[i] = i;\n\t\t}\n\t\telse {\n\t\t\tcol[1] = 1;\n\t\t\tfop(i, 2, N) col[i] = get(i);\n\t\t}\n\t}\n\tprintf(\"! \"); fop(i, 1, N) printf(\"%lld \", col[i]); ff;\n}\n```\n",
        "postTime": 1668067391,
        "uid": 279857,
        "name": "Eafoo",
        "ccfLevel": 4,
        "title": "P7971 \u9898\u89e3"
    },
    {
        "content": "\u6570\u636e\u5206\u6cbb\u3002\n\n\u4e0d\u5c11\u4e8e $N-1$ \u79cd\u989c\u8272 / \u540c\u79cd\u989c\u8272\u7f16\u53f7\u8fde\u7eed\uff1a\u601d\u535a\u9898\u3002\n\n\u65e0\u7279\u6b8a\u9650\u5236\uff1a\u4ece\u524d\u5f80\u540e\u626b\uff0c\u5047\u8bbe\u8fdb\u884c\u5230\u7b2c $i$ \u4e2a\u7403\u65f6\uff0c\u5df2\u7ecf\u6c42\u51fa\u524d $i-1$ \u4e2a\u7403\u7684\u60c5\u51b5\u3002\u8bb0 $f(l,r)$ \u4e3a $[l,r]$ \u5185\u989c\u8272\u6570\uff0c$g(x)=[f(x,i-1)=f(x,i)]$\u3002\u6ce8\u610f\u5230 $g$ \u53d6\u503c\u5177\u6709\u5355\u8c03\u6027\uff0c$f(x,i-1)$ \u53ef\u4ee5\u81ea\u5df1\u7b97\uff0c$f(x,i)$ \u53ef\u4ee5\u8be2\u95ee\u4ea4\u4e92\u5e93\u5f97\u5230\uff0c\u4e8c\u5206\u5373\u53ef\u5728\u4e0d\u8d85\u8fc7 $\\log N!\\le \\frac{1}{2}N\\log N$ \u6b21\u8be2\u95ee\u89e3\u51b3\u3002\n\n\u4e0d\u8d85\u8fc7 $4$ \u79cd\u989c\u8272\uff1a\u7ef4\u62a4\u6bcf\u79cd\u989c\u8272\u5f53\u524d\u6700\u9760\u53f3\u7684\u4f4d\u7f6e\uff0c\u5c06\u5176\u6392\u5e8f\u540e\u5e76\u5bf9\u6b64\u4e8c\u5206\u3002\u7cbe\u7ec6\u5b9e\u73b0\u53ef\u4ee5\u4f7f\u8be2\u95ee\u6570\u4e0d\u8d85\u8fc7 $2N$\u3002\n\n\u4e0d\u61c2\u53ef\u4ee5\u770b\u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int N = 1005;\n\nint Query(int l, int r) {\n\tint x;\n\tcout << \"? \" << l << ' ' << r << endl;\n\tcin >> x;\n\treturn x;\n}\n\nint T;\nint n, Q;\nint col[N], totc = 0; \n\nbool vis[N];\n\nint myque(int l, int r) { // l,r < i \u65f6\u4e0d\u5fc5\u6d6a\u8d39\u4e00\u6b21\u8be2\u95ee\uff0c\u81ea\u5df1\u8ba1\u7b97\u5373\u53ef\n\tmemset(vis, false, sizeof vis);\n\tint cnt = 0;\n\tfor (int i = l; i <= r; ++i) if (!vis[col[i]]) vis[col[i]] = 1, ++cnt;\n\treturn cnt;\n}\n\nint pos[5], tmp[5];\n\nint main() {\n\tcin >> T;\n\tcin >> n >> Q;\n\tif (T == 2) {\n\t\tcol[1] = ++totc;\n\t\tfor (int i = 2; i <= n; ++i) col[i] = Query(i - 1, i) > 1 ? ++totc : col[i - 1];\n\t}\n\telse if (T == 3 || T == 4) {\n\t\tpos[col[1] = ++totc] = 1;\n\t\tfor (int i = 2; i <= n; ++i) {\n\t\t\tfor (int j = 1; j <= totc; ++j) tmp[j] = pos[j];\n\t\t\tsort(tmp + 1, tmp + totc + 1);\n\t\t\tif (totc == 1) col[i] = (Query(1, i) == 1 ? col[1] : ++totc);\n\t\t\telse if (totc == 2) col[i] = (Query(tmp[2], i) == 1 ? col[tmp[2]] : Query(tmp[1], i) == 2 ? col[tmp[1]] : ++totc);\n\t\t\telse if (totc == 3) col[i] = (Query(tmp[2], i) == 2 ? (Query(tmp[3], i) == 1 ? col[tmp[3]] : col[tmp[2]]) : (Query(tmp[1], i) == 3 ? col[tmp[1]] : ++totc));\n\t\t\telse col[i] = (Query(tmp[3], i) == 2 ? Query(tmp[4], i) == 1 ? col[tmp[4]] : col[tmp[3]] : Query(tmp[2], i) == 3 ? col[tmp[2]] : col[tmp[1]]); // \u8fd9\u91cc\u662f\u624b\u52a8\u4e8c\u5206\u4ee5\u4fdd\u8bc1\u8be2\u95ee\u6b21\u6570\uff0c\u957f\u4f46\u5f88\u597d\u60f3\u6e05\u695a\n\t\t\tpos[col[i]] = i;\n\t\t}\n\t}\n\telse if (T == 5) {\n\t\tbool flag = false;\n\t\tfor (int i = 1; i <= n; ++i) {\n\t\t\tif (!flag && Query(1, i) < i) {\n\t\t\t\tflag = true;\n\t\t\t\tcol[i] = col[1];\n\t\t\t\tfor (int j = i - 1; j > 1; --j) {\n\t\t\t\t\tif (Query(j, i) < i - j + 1) {\n\t\t\t\t\t\tcol[i] = col[j];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else col[i] = ++totc;\n\t\t}\n\t} else {\n\t\tfor (int i = 1; i <= n; ++i) {\n\t\t\tint l = 1, r = i - 1, p = 0;\n\t\t\twhile (l <= r) {\n\t\t\t\tint mid = (l + r) / 2;\n\t\t\t\tif (Query(mid, i) == myque(mid, i - 1)) l = mid + 1, p = mid;\n\t\t\t\telse r = mid - 1;\n\t\t\t}\n\t\t\tif (!p) col[i] = ++totc;\n\t\t\telse col[i] = col[p];\n\t\t}\n\t}\n\tcout << \"! \";\n\tfor (int i = 1; i <= n; ++i)\n\t\tif (i < n) cout << col[i] << ' ';\n\t\telse cout << col[i];\n\tcout << endl;\n\treturn 0;\n}\n```\n```",
        "postTime": 1672398536,
        "uid": 314991,
        "name": "zhouyuhang",
        "ccfLevel": 7,
        "title": "\u5e94\u8be5\u662f\u7b80\u5355\u9898"
    },
    {
        "content": "\u4ece\u524d\u5f80\u540e\u679a\u4e3e $i$\uff0c\u7ef4\u62a4\u4e00\u4e0b\u5f53\u524d\u6bcf\u4e2a\u989c\u8272\u6700\u540e\u51fa\u73b0\u7684\u4f4d\u7f6e\u3002\u6309\u6700\u540e\u51fa\u73b0\u7684\u4f4d\u7f6e\u6392\u5e8f\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u77e5\u9053\u67d0\u4e2a\u4f4d\u7f6e\u548c $i-1$ \u4e4b\u95f4\u7684\u989c\u8272\u6570\u3002\n\n\u8003\u8651\u4e8c\u5206\u54ea\u4e2a\u4f4d\u7f6e\u548c\u4ed6\u989c\u8272\u76f8\u540c\uff0c\u5f53\u4e8c\u5206\u5230 $j$ \u8fd9\u4e2a\u989c\u8272\u65f6\u5982\u679c\u4ed6\u6700\u540e\u7684\u51fa\u73b0\u4f4d\u7f6e\u5230 $i-1$ \u7684\u989c\u8272\u6570\u548c\u5230 $i$ \u7684\u989c\u8272\u6570\u76f8\u540c\u5c31\u53ef\u4ee5\u8bf4\u660e $i$ \u7684\u989c\u8272\u6309\u51fa\u73b0\u4f4d\u7f6e\u6392\u5e8f\u540e\u5728 $j$ \u4e4b\u540e\u3002\u5982\u679c\u662f\u65b0\u989c\u8272\u5c31\u662f\u5728\u6240\u6709\u989c\u8272\u4e4b\u524d\uff0c\u5224\u4e00\u4e0b\u5c31\u884c\u3002\n\n\u590d\u6742\u5ea6 $O(n^2\\log n)$\uff0c\u8be2\u95ee\u6b21\u6570 $O(n\\log n)$\u3002\n```cpp\n#include<bits/stdc++.h>\n#define N 2005\nusing namespace std;\ntypedef int ll;\ntypedef double db;\nll pre[N];\npair<ll,ll>c[N];\ninline ll query(ll l,ll r)\n{\n\tcout<<\"? \"<<l<<\" \"<<r<<endl;\n\tll res;\n\tcin>>res;\n\treturn res;\n}\nvector<int> getColor(int t,int n,int q)\n{\n\tll val=query(1,n);\n\tvector<int>res;\n\tif(val>=n-1)\n\t{\n\t\tif(val==n)\n\t\t{\n\t\t\tfor(int i=1;i<=n;i++)\n\t\t\t\tres.push_back(i);\n\t\t\treturn res;\n\t\t}\n\t\tres.resize(n);\n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tif(query(1,i)<i)\n\t\t\t{\n\t\t\t\tfor(int j=i;j;j--)\n\t\t\t\t{\n\t\t\t\t\tif(query(j,i)<i-j+1)\n\t\t\t\t\t{\n\t\t\t\t\t\tll tot=0;\n\t\t\t\t\t\tfor(int k=1;k<=n;k++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(k==i||k==j)\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\tres[k-1]=++tot;\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttot++;\n\t\t\t\t\t\tres[i-1]=res[j-1]=tot;\n\t\t\t\t\t\treturn res;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\telse if(q==2000&&val>4)\n\t{\n\t\tll las=0;\n\t\tll tot=0;\n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tll tmp=query(1,i);\n\t\t\tif(tmp==las)\n\t\t\t\tres.push_back(res.back());\n\t\t\telse\n\t\t\t\tres.push_back(++tot);\n\t\t\tlas=tmp;\n\t\t}\n\t\treturn res;\n\t}\n\tfor(int i=1;i<=val;i++)\n\t\tpre[i]=0;\n\tll tot=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tfor(int j=1;j<=tot;j++)\n\t\t\tc[j]=make_pair(pre[j],j);\n\t\tsort(c+1,c+tot+1);\n\t\tll l=1,r=tot,mid;\n\t\twhile(l<r)\n\t\t{\n\t\t\tmid=l+r>>1;\n\t\t\tif((l+r)&1)\n\t\t\t\tmid++;\n\t\t\tif(query(c[mid].first,i)==tot-mid+1)\n\t\t\t\tl=mid;\n\t\t\telse\n\t\t\t\tr=mid-1;\n\t\t}\n\t\tif(l==1)\n\t\t{\n\t\t\tif(tot<val)\n\t\t\t{\n\t\t\t\tif(query(1,i)>tot)\n\t\t\t\t{\n\t\t\t\t\ttot++;\n\t\t\t\t\tpre[tot]=i;\n\t\t\t\t\tres.push_back(tot);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tres.push_back(c[l].second);\n\t\tpre[c[l].second]=i;\n\t}\n\treturn res;\n}\nint main()\n{\n\tll t,n,q;\n\tcin>>t>>n>>q;\n\tvector<int>ans=getColor(t,n,q);\n\tcout<<\"! \";\n\tfor(auto x:ans)\n\t\tcout<<x<<\" \";\n\tcout<<endl;\n\texit(0);\n}\n```",
        "postTime": 1668557518,
        "uid": 176990,
        "name": "Celtic",
        "ccfLevel": 9,
        "title": "P7971"
    },
    {
        "content": "## problem\n\u4ea4\u4e92\u5e93\u6709\u4e00\u4e2a\u957f\u4e3a $n$ \u7684\u989c\u8272\u5e8f\u5217\uff0c\u4f60\u53ef\u4ee5\u8be2\u95ee\u533a\u95f4 $[l,r]$ \u4e2d\u6709\u591a\u5c11\u79cd\u989c\u8272\uff0c\u6700\u540e\u8fd8\u539f\u4ea4\u4e92\u5e93\u624b\u4e2d\u7684\u5e8f\u5217\uff0c\u53ea\u9700\u8981\u4fdd\u6301\u76f8\u5bf9\u987a\u5e8f\u4e0d\u53d8\u3002$n\\leq 10^3$\uff0c\u6700\u591a\u8be2\u95ee\u6b21\u6570 $Q=2000$ \u6216 $Q=10^4$\u3002\n\n## solution\n\u4ee4 $C$ \u4e3a $[1,n]$ \u7684\u989c\u8272\u79cd\u7c7b\u6570\uff0c\u4e00\u5f00\u59cb\u5c31 $query(1,n)$ \u4e00\u6b21\u3002\n\n### $C=1,C=n$\uff1a$Q=O(1)$\n\uff1f\n\n### \u76f8\u540c\u989c\u8272\u8fde\u7eed\uff1a$Q=O(n)$\n\u505a\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u53bb\u91cd\u7684\u5de5\u4f5c\uff0c\u628a\u76f8\u90bb\u4e24\u4e2a\u989c\u8272\u76f8\u540c\u7684\uff08$query(i-1,i)=1$\uff09\u5408\u5e76\u6210\u540c\u4e00\u79cd\u989c\u8272\u3002\u56e0\u4e3a\u76f8\u540c\u989c\u8272\u8fde\u7eed\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u8003\u8651\u5176\u5b83\uff0c\u8fd9\u6837\u5c31\u80fd\u901a\u8fc7 $T\\leq 2$ \u7684\u6d4b\u8bd5\u70b9\u3002\n\n### $C=3$\uff1a$Q=O(n)$\n\u8003\u8651\u5148\u53bb\u91cd\uff0c\u53bb\u6389\u76f8\u90bb\u7684\u76f8\u540c\u989c\u8272\u3002\u5bf9\u4e8e\u8fde\u7eed\u7684 $a,b,c$ \u7684\u989c\u8272\u5757\uff0c\u5982\u679c\n- $query(a,c)=1$\uff0c\u8fd9\u53ef\u80fd\u5417\uff1f\n- $query(a,c)=2$\uff0c\u53ef\u4ee5\u63a8\u51fa $a$ \u7684\u989c\u8272\u548c $c$ \u7684\u989c\u8272\u76f8\u540c\u3002\n- $query(a,c)=3$\uff0c\u8fd9\u4e09\u4e2a\u989c\u8272\u4e92\u4e0d\u76f8\u540c\uff0c\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u77e5\u9053 $a,b$ \u7684\u989c\u8272\uff0c\u90a3\u4e48 $c$ \u5c31\u662f\u5f02\u4e8e\u5b83\u4eec\u7684\u7b2c\u4e09\u79cd\u989c\u8272\u3002\u5b9e\u73b0\u65f6\u66b4\u529b\u627e\u51fa $[1,b]$ \u4e2d\u6709\u4ec0\u4e48\u989c\u8272\uff0c\u6700\u540e\u53bb\u6389 $a,b$\uff0c\u5269\u4e0b\u7684\u5c31\u662f $c$ \u7684\u989c\u8272\uff08\u5982\u679c\u6ca1\u6709\u8bf4\u660e $c$ \u662f\u65b0\u989c\u8272\uff09\u3002\n\n\u8fd9\u6837\u5c31\u80fd\u901a\u8fc7 $T=3$ \u7684\u6d4b\u8bd5\u70b9\u3002\n\n### $C=n-1$\uff1a$Q=O(n)$\n\u56e0\u4e3a $C=n-1$\uff0c\u6240\u4ee5\u4e00\u5b9a\u5b58\u5728\u4e00\u5bf9 $i,j$ \u4f7f\u5f97\u8fd9\u4e24\u4e2a\u4e0b\u6807\u7684\u989c\u8272\u76f8\u540c\u3002\n\n\u8003\u8651\u4e00\u4e2a\u5305\u542b\u4e86 $[i,j]$ \u7684\u533a\u95f4\uff0c\u8fd9\u4e00\u6bb5\u533a\u95f4\u91cc\u4e00\u5b9a\u6709 $len-1$ \u79cd\u989c\u8272\u3002\u90a3\u4e48\u4ee4 $l=1,r=n$\uff0c\u8ba9 $l$ \u4e00\u76f4\u5f80\u53f3\u626b\uff0c$r$ \u4e00\u76f4\u5f80\u5de6\u626b\uff0c\u4ec0\u4e48\u65f6\u5019 $query(l,r)=r-l+1$\uff0c\u90a3\u4e48\u5c31\u627e\u5230\u4e86 $i,j$\u3002\u8fd9\u6837\u5c31\u901a\u8fc7\u4e86 $T=5$ \u7684\u6d4b\u8bd5\u70b9\n\n### \u901a\u89e3\uff1a$Q=O(n\\log n)$\n\u8003\u8651\u4e00\u904d\u626b\u8fc7\u53bb\uff0c\u7528 $[1,i-1]$ \u7684\u989c\u8272\u6c42\u51fa $i$ \u7684\u989c\u8272\u3002\n\n\u5bf9\u4e8e $i$\uff0c\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u7f16\u53f7 $k$\uff1a\n- \u82e5 $query(k,i)=query(k,i-1)$\uff0c\u8bf4\u660e $i$ \u7684\u989c\u8272**\u4e00\u5b9a**\u662f $[k,i-1]$ \u4e2d\u7684\u5176\u4e2d\u4e00\u79cd\uff1b\n- \u82e5 $query(k,i)=query(k,i-1)+1$\uff0c\u8bf4\u660e $i$ \u7684\u989c\u8272**\u4e0d**\u662f $[k,i-1]$ \u4e2d\u7684\u5176\u4e2d\u4e00\u79cd\uff0c\u5b83\u53ef\u80fd\u662f $[1,k-1]$ \u7684\u5176\u4e2d\u4e00\u79cd\uff0c\u6216\u8005\u662f\u4e00\u79cd\u4e0d\u540c\u4e8e $[1,i-1]$ \u7684\u5168\u65b0\u7684\u989c\u8272\u3002\n\n\u53d1\u73b0 $query(k,i)$ \u6709\u5355\u8c03\u6027\uff0c\u8bd5\u56fe\u4e8c\u5206 $k\\in[1,i-1]$\uff0c\u4e8e\u662f\u4f60\u89e3\u51b3\u4e86 $T=6$ \u548c $T=7$ \u7684\u6d4b\u8bd5\u70b9\u3002\n\n### $Q=O(n\\log C)$ \u53ca\u5c0f\u4f18\u5316\n\u52a8\u6001\u7ef4\u62a4\u4e00\u4e2a $pre_c$ \u8868\u793a\u989c\u8272\u4e3a $c$ \u7684\u6700\u5927\u7684\u7f16\u53f7\uff0c\u8fd9\u6837\uff0c$query(k,i-1)$ \u5c31\u7b49\u540c\u4e8e\u6709\u591a\u5c11\u4e2a $pre_c$ \u843d\u5728 $[k,i-1]$ \u4e2d\u3002\u628a\u6240\u6709\u6709\u610f\u4e49\u7684 $pre_c$ \u7684\u503c\u62c9\u51fa\u6765\u6392\u5e8f\uff08\u5bb9\u6613\u53d1\u73b0\u53ea\u6709 $O(C)$ \u4e2a\uff09\uff0c\u5bf9\u7740\u6392\u5e8f\u7684 $pre$ \u4e8c\u5206\uff0c\u90a3\u4e48\u5c31\u80fd\u901a\u8fc7 $T=3$ \u7684\u6d4b\u8bd5\u70b9\u3002\u6ce8\u610f\u5230\u56e0\u4e3a $n\\leq 10^3$\uff0c\u6240\u4ee5\u6392\u5e8f\u90e8\u5206\u76f4\u63a5\u5199 $O(n^2+n\\cdot C \\log C))$ \u7684**\u65f6\u95f4\u590d\u6742\u5ea6**\u4e5f\u80fd\u8fc7\u3002\n\n\u8fd8\u4e0d\u80fd\u901a\u8fc7 $T=4$ \u7684\u6d4b\u8bd5\u70b9\uff0c\u56e0\u4e3a\u8fd9\u6837\u6bcf\u4e2a\u989c\u8272\u9700\u8981\u8be2\u95ee $3$ \u6b21\uff0c\u9700\u8981\u4f18\u5316\u3002\u8fd9\u4e2a\u4f18\u5316\u5f88\u7b80\u5355\uff1a\u5982\u679c $\\color{red}{C}=4$\uff08\u800c\u4e0d\u662f $T=4$\uff09\uff0c\u5f53\u524d\u6709\u610f\u4e49\u7684 $pre$ **\u6070**\u6709 $C$ \u4e2a\uff0c\u90a3\u4e48\u4e0d\u9700\u8981\u7279\u5224 $i$ \u662f\u65b0\u989c\u8272\u7684\u60c5\u51b5\uff0c\u8fd9\u662f\u4e0d\u53ef\u80fd\u7684\uff0c\u8be2\u95ee\u6b21\u6570\u964d\u4e3a $2$ \u6b21\uff08\u82e5 $pre$ \u6709 $3$ \u4e2a\u90a3\u4e48\u53ea\u9700\u8981\u8be2\u95ee $2$ \u6b21\uff09\u3002\u4e8e\u662f\u53ef\u4ee5\u901a\u8fc7 $T=4$ \u7684\u6d4b\u8bd5\u70b9\u3002\n\n## code\n\u5b9e\u73b0\u65f6\u53ef\u4ee5\u7528\u5e76\u67e5\u96c6\u3002\n```cpp\n#include <set>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\ntemplate<int N> struct dsu{\n\tint fa[N+10],siz[N+10],cnt;\n\tdsu(int n=N):cnt(n){for(int i=1;i<=n;i++) fa[i]=i,siz[i]=1;}\n\tint find(int x){return fa[x]==x?x:fa[x]=find(fa[x]);}\n\tvoid merge(int x,int y){\n\t\tif(x=find(x),y=find(y),x!=y){\n\t\t\tif(siz[x]<siz[y]) swap(x,y);\n\t\t\tcnt--,siz[x]+=siz[y],fa[y]=x;\n\t\t}\n\t}\n};\nint n,T,f[1010][1010],last[1010],p[1010];\ndsu<1010> s;\nint query(int l,int r){\n\tif(l>r) swap(l,r);\n\tif(f[l][r]==-1){\n\t\tprintf(\"? %d %d\\n\",l,r);\n\t\tfflush(stdout);\n\t\tscanf(\"%d\",&f[l][r]);\n\t}\n\treturn f[l][r];\n}\nint flower(){\n\tint cnt=0;\n\tp[++cnt]=1;\n\tfor(int i=2;i<=n;i++){\n\t\tif(query(p[cnt],i)==1) s.merge(p[cnt],i);\n\t\telse p[++cnt]=i;\n\t}\n\treturn cnt;\n}\nint main(){\n\tmemset(f,-1,sizeof f);\n\tscanf(\"%d%d%*d\",&T,&n);\n\tif(T==1||T==2) flower();\n\telse if(query(1,n)==n-1){\n\t\tint L=1,R=n;\n\t\twhile(query(n,L)==n-L) L++;\n\t\twhile(query(R,1)==R-1) R--;\n\t\ts.merge(L-1,R+1);\n\t}else if(query(1,n)==3){\n\t    int cnt=flower();\n\t    if(query(p[1],p[3])==2) s.merge(p[1],p[3]);\n\t\tfor(int i=4;i<=cnt;i++){\n\t\t\tif(query(p[i-2],p[i])==2) s.merge(p[i-2],p[i]);\n\t\t\telse{\n\t\t\t\tset<int> fs;\n\t\t\t\tfor(int j=1;j<i;j++) fs.insert(s.find(p[j]));\n\t\t\t\tfs.erase(s.find(p[i-1]));\n\t\t\t\tfs.erase(s.find(p[i-2]));\n\t\t\t\tif(!fs.empty()) s.merge(*fs.begin(),p[i]);\n\t\t\t}\n\t\t}\n\t}else if(query(1,n)!=n){\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tint cnt=0;\n\t\t\tfor(int j=1;j<=1000;j++) if(last[j]) p[++cnt]=last[j];\n\t\t\tsort(p+1,p+cnt+1);\n\t\t\tint L=1,R=cnt;\n\t\t\twhile(L<R){\n\t\t\t\tint mid=(L+R+1)>>1;\n\t\t\t\tif(query(p[mid],i)==cnt-mid+1) L=mid;\n\t\t\t\telse R=mid-1;\n\t\t\t}\n\t\t\tif(query(1,n)==cnt||!cnt||query(p[L],i)==cnt-L+1) s.merge(p[L],i);\n\t\t\tlast[s.find(i)]=i;\n\t\t}\n\t}\n\tprintf(\"! \");\n\tfor(int i=1;i<=n;i++) printf(\"%d%c\",s.find(i),\" \\n\"[i==n]);\n\tfflush(stdout);\n\treturn 0;\n}\n/*\n1213\n*/\n```\n",
        "postTime": 1665227248,
        "uid": 509229,
        "name": "yukimianyan",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7971 \u3010[KSN2021] Colouring Balls\u3011"
    }
]