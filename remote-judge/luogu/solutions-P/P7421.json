[
    {
        "content": "## \u5b98\u65b9\u9898\u89e3\u3002\n### upd 2021.3.7\uff1a\u5c06 $p$ \u7684\u4e0b\u6807\u6539\u6210\u62ec\u53f7\u5f62\u5f0f\uff0c\u907f\u514d\u4e86\u4e0b\u6807\u4e0d\u6e05\u3002\n\u8fd9\u9898\u8d5b\u65f6 AC \u4eba\u6570\u751a\u81f3\u6ca1\u6709\u538b\u8f74\u9c7c\u795e\u7684\u591a\u9879\u5f0f\u9898\u4eba\u591a\uff1f\n\n\u628a\u5f0f\u5b50\u7684\u524d\u51e0\u9879\u548c\u540e\u51e0\u9879\u5199\u51fa\u6765\uff1a\n$$(a_{p(1)}-a_{p(0)})(p(l+1)-p(l))+(a_{p(2)}-a_{p(1)})(p(l)-p(l-1))+\\cdots+(a_{p(l)}-a_{p(l-1)})(p(2)-p(1))+(a_{p(l+1)}-a_{p(l)})(p(1)-p(0))$$\n\u5f88\u96be\u8d2a\u5fc3\uff0c\u8003\u8651 dp\u3002\u53d1\u73b0\u72b6\u6001\u4e2d\u53ea\u8bb0\u5355\u72ec\u4e00\u4e2a\u4f4d\u7f6e\u4e0d\u597d dp\uff0c\u5f0f\u5b50\u4e2d $i$ \u4e0e $l-i$ \u76f8\u5173\uff0c\u518d\u89c2\u5bdf\u53d1\u73b0\u5b83\u4eec\u662f\u4e24\u4e24\u5bf9\u5e94\u7684\uff0c\u4e8e\u662f\u5c06\u5b83\u4eec\u6346\u8d77\u6765 dp\uff0c\u4e5f\u5c31\u662f\u9009\u62e9 $p$ \u7684\u5143\u7d20\u65f6\uff0c\u5de6\u8fb9\u9009\u4e00\u4e2a\u53f3\u8fb9\u540c\u65f6\u9009\u4e00\u4e2a\u3002\n\n\u8bbe\u8ba1\u72b6\u6001 $f_{i,j}$ \u8868\u793a\u5de6\u8fb9\u9009\u5230 $i$\uff0c\u53f3\u8fb9\u9009\u5230 $j$\u3002\u8f6c\u79fb\u65b9\u7a0b\u662f\uff1a\n$$f_{i,j}=\\max_{x<i,y>j}\\{f_{x,y}+(a_i-a_x)(y-j)+(a_y-a_j)(i-x)\\}$$\n\u5f53\u7136\u53ef\u4ee5\u4e0d\u8f6c\u79fb\uff0c\u5c06 $\\{i,j\\}$ \u76f4\u63a5\u4f5c\u4e3a $p$ \u7684\u5f00\u5934\u548c\u7ed3\u5c3e\uff0c\u5373 $a_i(n-j+1)-a_j\\cdot i$\u3002\n\n\u5c06 $f$ \u6c42\u51fa\u6765\u540e\uff0c\u6c42\u51fa\u7b54\u6848\u8981\u5206\u4e09\u79cd\u60c5\u51b5\uff1a\n1. $l=1$\uff0c\u6b64\u65f6\u76f4\u63a5\u679a\u4e3e $p_1$ \u5373\u53ef\uff1b\n2. $l$ \u4e3a\u5076\u6570\uff0c\u6b64\u65f6\u76f4\u63a5\u7528 $f_{i,j}$ \u7684\u503c\u52a0\u4e0a $i$ \u4e0e $j$ \u4e4b\u95f4\u4ea7\u751f\u7684\u8d21\u732e $(a_j-a_i)(j-i)$\uff1b\n3. $l$ \u4e3a\u5947\u6570\uff0c\u6b64\u65f6\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $f_{i,j}$\uff0c\u679a\u4e3e $i<k<j$ \u8ba1\u7b97\u7b54\u6848\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6\u74f6\u9888\u5728\u6c42 $f$\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u5c06\u8f6c\u79fb\u65b9\u7a0b\u4e2d\u7684\u62ec\u53f7\u62c6\u5f00\uff1a\n$$f_{i,j}=\\max_{x<i,y>j}\\{f_{x,y}+a_i\\cdot y-a_i\\cdot j-a_x\\cdot y+a_x\\cdot j+a_y\\cdot i-a_y\\cdot x-a_j\\cdot i+a_j\\cdot x\\}$$\n\u5c06\u53ea\u4e0e $i,j$ \u6709\u5173\u7684\u4e1c\u897f\u63d0\u51fa\u6765\uff1a\n$$f_{i,j}=\\max_{x<i,y>j}\\{f_{x,y}+a_i\\cdot y-a_x\\cdot y+a_x\\cdot j+a_y\\cdot i-a_y\\cdot x+a_j\\cdot x\\}-a_i\\cdot j-a_j\\cdot i$$\n\u679a\u4e3e $x$\uff0c\u5c06 $x$ \u4e5f\u770b\u4f5c\u4e00\u4e2a\u5b9a\u503c\uff1a\n$$f_{i,j}=\\max_{x<i,y>j}\\{a_x\\cdot j+a_j\\cdot x+f_{x,y}+a_i\\cdot y-a_x\\cdot y+a_y\\cdot i-a_y\\cdot x\\}-a_i\\cdot j-a_j\\cdot i$$\n\u7136\u540e\u53d1\u73b0\uff0c\u4e0e $y$ \u6709\u5173\u7684\u90e8\u5206\u4e2d\u53ea\u6709 $i$ \u548c $x$ \u6ca1\u6709 $j$\u3002\u4e8e\u662f\u7528 $g_{i,x}$ \u8868\u793a\u5bf9\u4e8e\u8fd9\u5bf9 $(i,x)$ \u6700\u597d\u7684 $y$ \u4ea7\u751f\u7684\u6700\u5927\u503c\uff0c\u5373\uff1a\n$$g_{i,x}=\\max_y\\{f_{x,y}+a_i\\cdot y-a_x\\cdot y+a_y\\cdot i-a_y\\cdot x\\}$$\n\u8fd9\u4e2a\u4e1c\u897f\u4e2d\u5305\u542b\u4e00\u4e2a $f_{x,y}$ \u6bd4\u8f83\u70e6\uff0c\u8003\u8651\u4e00\u8fb9\u6c42 $f$ \u4e00\u8fb9\u66f4\u65b0 $g$\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u679a\u4e3e $i,j$\uff0c\u5728\u5faa\u73af\u91cc\u8981\u505a\u8fd9\u4e9b\u4e8b\uff1a\n1. \u679a\u4e3e $x$\uff0c\u901a\u8fc7 $g$ \u5feb\u901f\u8ba1\u7b97 $f_{i,j}$ \u7684\u503c\uff1b\n2. \u5c06 $(i,j)$ \u5f53\u505a $g$ \u4e2d\u7684 $(x,y)$\uff0c\u679a\u4e3e $g$ \u4e2d\u7684 $i$\uff0c\u66f4\u65b0 $g$\u3002\n\n\u8fd9\u6bb5\u8fd8\u662f\u770b\u7a0b\u5e8f\u6bd4\u8f83\u597d\u61c2\u5427\uff0c\u53ef\u4ee5\u5148\u8df3\u5230\u4e0b\u9762\u7a0b\u5e8f\u90e8\u5206\u641e\u61c2\u518d\u5f80\u4e0b\u3002\n\n\u7136\u540e\uff0c\u8fd8\u6709\u4e00\u70b9\u7ec6\u8282\u8981\u6ce8\u610f\uff1a$g$ \u7684\u5f0f\u5b50\u91cc\u9762 $y$ \u5176\u5b9e\u662f\u8981\u5927\u4e8e\u201c$j$\u201d\uff0c\u4f46\u662f\u4e0d\u80fd\u628a $j$ \u8bb0\u4e0b\u6765\uff08\u4e0d\u7136\u5c31\u7206\u70b8\u4e86\uff09\uff0c\u8981\u901a\u8fc7\u4e00\u4e9b\u624b\u6bb5\u4f7f\u5f97\u5f53\u524d $g$ \u4e2d\u5b58\u7684\u90fd\u662f\u5927\u4e8e $j$ \u7684\u7b54\u6848\u3002\u4e8e\u662f\u5916\u5c42\u679a\u4e3e $j$ \u5e76\u5012\u5e8f\u679a\u4e3e\u3002\n\n\u8fd8\u6709\u4e00\u4e2a\u5c0f\u95ee\u9898\uff1a$(i-1,j)$ \u662f\u4e0d\u80fd\u8f6c\u79fb\u5230 $(i,j)$ \u7684\uff0c\u4f46\u662f\u5982\u679c\u5185\u5c42\u5faa\u73af $i$ \u6b63\u5e8f\u679a\u4e3e\uff0c\u90a3\u4e48\u5728 $f_{i-1,j}$ \u65f6\u66f4\u65b0\u4e86 $g_{i,i-1},g_{i+1,i-1}\\cdots$\uff1b\u5728 $f_{i,j}$ \u65f6\u9700\u8981\u7684\u6709 $g_{i,i-1},g_{i,i-2}$\uff0c\u5176\u4e2d $g_{i,i-1}$ \u91cd\u590d\u4e86\uff0c\u4e8e\u662f\u5185\u5c42\u7684 $i$ \u4e5f\u8981\u5012\u5e8f\u5faa\u73af\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n^3)$\uff0c\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nlong long a[305],f[305][305],g[305][305];\ninline int read()\n{\n\tchar c=getchar();\n\tint x=0,y=1;\n\twhile(c<'0'||c>'9')\n\t{\n\t\tif(c=='-')\n\t\t\ty=-1;\n\t\tc=getchar();\n\t}\n\twhile(c>='0'&&c<='9')\n\t{\n\t\tx=(x<<3)+(x<<1)+c-'0';\n\t\tc=getchar();\n\t}\n\treturn x*y;\n}\nint main()\n{\n\tint n=read(),i,j,k;\n\tlong long ans=-1000000000000000000ll;\n\tfor(i=1;i<=n;i++)\n\t\ta[i]=read();\n\tfor(i=1;i<=n;i++)\n\t\tfor(j=1;j<=n;j++)\n\t\t\tg[i][j]=-1000000000000000000ll;\n\tfor(j=n;j;j--)//\u5916\u5c42\u679a\u4e3ej\u5e76\u5012\u5e8f\u679a\u4e3e\uff0c\u4e0a\u9762\u6709\u89e3\u91ca\n\t\tfor(i=j-1;i;i--)//\u5185\u5c42\u679a\u4e3ei\u5e76\u5012\u5e8f\u679a\u4e3e\uff0c\u4e0a\u9762\u6709\u89e3\u91ca\n\t\t{\n\t\t\tf[i][j]=a[i]*(n-j+1)-a[j]*i;//\u4e0d\u8f6c\u79fb\u7684\u60c5\u51b5\n\t\t\tfor(k=1;k<i;k++)//\u8fd9\u91cc\u7684k\u5c31\u662f\u8f6c\u79fb\u65b9\u7a0b\u4e2d\u7684x\n\t\t\t\tf[i][j]=max(f[i][j],g[i][k]-a[i]*j+a[k]*j-a[j]*i+a[j]*k);\n\t\t\tans=max(ans,f[i][j]+(a[j]-a[i])*(j-i));\n\t\t\tfor(k=i+1;k<j;k++)//\u8fd9\u91cc\u7684k\u5c31\u662fg[i][x]\u4e2d\u7684i\n\t\t\t\tg[k][i]=max(g[k][i],f[i][j]+a[k]*j-a[i]*j+a[j]*k-a[j]*i);\n\t\t}\n\tfor(i=1;i<=n;i++)\n\t\tans=max(ans,a[i]*(n-i+1)-a[i]*i);\n\tfor(i=1;i<n;i++)\n\t\tfor(j=i+1;j<=n;j++)\n\t\t\tfor(k=i+1;k<j;k++)\n\t\t\t\tans=max(ans,f[i][j]+(a[k]-a[i])*(j-k)+(a[j]-a[k])*(k-i));\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1611842976,
        "uid": 150522,
        "name": "b6e0_",
        "ccfLevel": 9,
        "title": "P7421 \u5b50\u5e8f\u5217 \u9898\u89e3"
    }
]