[
    {
        "content": "```\n/*\u9996\u5148\u8003\u8651\u5bf9\u4e8e\u65f6\u95f4t\u6765dp\uff1a\nf[t][i][j]\u8868\u793a\u5728\u7b2ct\u65f6\u523b\u5728\u7b2ci\u884c\u7b2cj\u5217\u6240\u80fd\u83b7\u5f97\u7684\u6700\u957f\u8ddd\u79bb\u3002 \n\u8f6c\u79fb\u65b9\u7a0b\uff1af[t][i][j]=max(f[t-1][i][j],f[t][i*][j*]+1)(i*,j*\u4e3a\u4e0a\u4e00\u4e2a\u5408\u7406\u7684\u4f4d\u7f6e) \n\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u4e3aO(TNM)\uff0c\u53ef\u4ee5\u8fc750%,\u4f46\u5bf9\u4e8e100%TLE\u4e14MLE\u3002\n\u6240\u4ee5\u5fc5\u987b\u4f18\u5316\uff0c\u9996\u5148\u628a\u65f6\u95f4t\u6362\u6210\u533a\u95f4k\uff0c\n\u4ee4f[k][i][j]\u8868\u793a\u5728\u7b2ck\u6bb5\u6ed1\u884c\u533a\u95f4\u4e2d\u5728\u4f4d\u7f6ei\uff0cj\u6240\u80fd\u83b7\u5f97\u6700\u957f\u8ddd\u79bb\n\u6ce8\u610f\u5230\u5728\u7b2ck\u6bb5\u65f6\u95f4\u5185\u53ea\u80fd\u5411\u67d0\u4e2a\u65b9\u5411\u6700\u591a\u8d70x\u6b65\uff08x\u4e3a\u533a\u95f4\u957f\u5ea6\uff09\uff0c\u5f97\u5230\u8f6c\u79fb\u65b9\u7a0b\nf[k][i][j]=max(f[k-1][i][j],f[k][i*][j*]+dis(i,j,i*,j*))(i*,j*\u4e3a\u4e0a\u4e00\u4e2a\u5408\u7406\u7684\u4f4d\u7f6e)\n\u8fd9\u4e2a\u505a\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662fO(kn^3)\uff0c\u4f1a\u8d85\u65f6\uff0c\u9700\u8981\u8fdb\u4e00\u6b65\u4f18\u5316\n\u7528\u5355\u8c03\u961f\u5217\u4f18\u5316\u6389\u5185\u5c42\u7684\u4e00\u4e2an\uff0c\u5c31\u53ef\u4ee5\u505a\u5230O(kn^2)\uff0c\u53ef\u4ee5AC\uff0c\u672c\u4ee3\u7801\u4e2d\u8fd8\u4f7f\u7528\u4e86\u6eda\u52a8\u6570\u7ec4\u4f18\u5316 \n\u7528\u5355\u8c03\u9012\u51cf\u961f\u5217\u6c42\u6700\u5927\u503c\u65f6\uff0c\u9047\u5230\u969c\u788d\u6e05\u7a7a\u6574\u4e2a\u961f\u5217\u5373\u53ef\uff0c\u53e6\u5916\u961f\u5217\u6bd4\u8f83\u65f6\u9700\u8981\u52a0\u4e0a\u504f\u79fb\u91cfdis*/\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#define MAXN 205\nusing namespace std;\nint n, m, sx, sy, K, ans, dp[MAXN][MAXN];\nint dx[5] = {0, -1, 1, 0, 0}, dy[5] = {0, 0, 0, -1, 1}; \nstruct node{int dp, pos;}q[MAXN]; //q\u4e3a\u5355\u8c03\u9012\u51cf\u961f\u5217\uff0c\u8981\u5b58\u4f4d\u7f6e\u4fe1\u606f\u7528\u6765\u8ba1\u7b97\u5171\u8d70\u4e86\u51e0\u6b65 \nchar map[MAXN][MAXN];\nvoid work(int x, int y, int len, int d) //\u7b2ck\u4e2a\u533a\u95f4\u7684\u65f6\u957f\u4e3alen\uff0c\u65b9\u5411\u4e3ad\uff0c\u8d77\u70b9\u5750\u6807x,y \n{\n\tint head = 1, tail = 0;\n\tfor(int i = 1; x >= 1 && x <= n && y >= 1 && y <= m; i++, x += dx[d], y += dy[d])\n\t\tif(map[x][y] == 'x') head = 1, tail = 0; //\u9047\u5230\u969c\u788d\uff0c\u6e05\u7a7a\u961f\u5217 \n\t\telse\n\t\t{\n\t\t\twhile(head <= tail && q[tail].dp + i - q[tail].pos < dp[x][y]) tail--;\n\t\t\tq[++tail] = node{dp[x][y], i}; //\u5f53\u524d\u503c\u5165\u961f\u5217 \n\t\t\tif(q[tail].pos - q[head].pos > len) head++; //\u961f\u5217\u957f\u5ea6\u8d85\u8fc7len\u65f6\u961f\u9996\u5f39\u51fa \n\t\t\tdp[x][y] = q[head].dp + i - q[head].pos; //\u6700\u4f18\u89e3\u662f\u961f\u9996\u5143\u7d20+\u79fb\u52a8\u8ddd\u79bb \n\t\t\tans = max(ans, dp[x][y]); //\u8bb0\u5f55\u7ed3\u679c \n\t\t}\n}\nint main()\n{\n\tscanf(\"%d%d%d%d%d\", &n, &m, &sx, &sy, &K);\n\tfor(int i = 1; i <= n; i++) scanf(\"%s\", map[i] + 1);\n\tmemset(dp, 0xf3, sizeof(dp));\n\tdp[sx][sy] = 0; //\u521d\u59cb\u5316\uff0c\u53ea\u6709\u521d\u59cb\u4f4d\u7f6e\u662f0\uff0c\u5176\u4ed6\u90fd\u662f\u8d1f\u65e0\u7a77 \n\tfor(int k = 1, s, t, d, len; k <= K; k++)\n\t{\n\t\tscanf(\"%d%d%d\", &s, &t, &d);\n\t\tlen = t - s + 1;\n\t\tif(d == 1) for(int i = 1; i <= m; i++) work(n, i, len, d);\n\t\tif(d == 2) for(int i = 1; i <= m; i++) work(1, i, len, d);\n\t\tif(d == 3) for(int i = 1; i <= n; i++) work(i, m, len, d);\n\t\tif(d == 4) for(int i = 1; i <= n; i++) work(i, 1, len, d);\n\t}\n\tprintf(\"%d\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1529574359,
        "uid": 65531,
        "name": "18811162081lyh",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2254 \u3010[NOI2005]\u7470\u4e3d\u534e\u5c14\u5179\u3011"
    },
    {
        "content": "# \u9898\u89e3-[NOI2005]\u7470\u4e3d\u534e\u5c14\u5179\n\n[$\\Huge\\color{orange}{\\texttt{In Cnblogs}}$](https://www.cnblogs.com/Wendigo/p/12584836.html)\n\n---\n\n> [\\[NOI2005\\]\u7470\u4e3d\u534e\u5c14\u5179](https://www.luogu.com.cn/problem/P2254)\n\n> $n\\times m$ \u7684\u77e9\u9635\u3002\u4ee5 $(x,y)$ \u4e3a\u8d77\u70b9\u3002\u4e00\u5171 $k$ \u6bb5\u65f6\u95f4\uff0c\u6bcf\u6bb5\u65f6\u95f4\u4e3a $[s_i,t_i](t_i+1=s_{i+1})$\uff0c\u6bcf\u79d2\u53ef\u4ee5\u5411 $d_i$ \u65b9\u5411\u8fd0\u52a8\u4e00\u4e2a\u5355\u4f4d\uff08**\u4e0d\u80fd\u8d85\u51fa\u77e9\u9635\uff0c\u4e0d\u80fd\u8d70\u5230\u7ed9\u51fa\u77e9\u9635\u7684\u969c\u788d\u7269\u5904**\uff0c$d=\\{1,2,3,4\\}$ \u5206\u522b\u8868\u793a\u4e0a\u4e0b\u5de6\u53f3\uff09\u6216\u4e0d\u52a8\uff0c\u6c42\u6700\u540e\u8fd0\u52a8\u6700\u957f\u603b\u8ddd\u79bb\u3002\n\n> \u6570\u636e\u8303\u56f4\uff1a$1\\le n,m\\le 200$\uff0c$1\\le k\\le 200$\uff0c$1\\le s_i\\le t_i\\le 4\\times 10^4$\u3002\n\n---\n**\u975e\u5e38\u5f15\u4eba\u5165\u80dc\u7684\u4e00\u9053\u9898\uff0c\u8868\u660e\u4e0a\u5f88\u6bd2\u7624\uff0c\u5176\u5b9e\u6545\u4e8b\u60c5\u8282\u751f\u52a8\uff0c\u9898\u76ee\u505a\u6cd5\u5de7\u5999\uff0c\u4ee3\u7801\u957f\u800c\u4e0d\u70e6\u3002\u5b8c\u7f8e\u554a\uff01**\u8fde\u6211\u8fd9\u4e2a\u5c0f\u849f\u84bb\u90fd\u4e00\u6b21\u8fc7\u4e86\uff0c\u9664\u4e86\u5728 $\\texttt{vector}$ \u5f00\u961f\u5217\u5927\u5c0f\u4e0a\u51fa\u4e86\u70b9\u5c0f\u95ee\u9898\u3002\n\n---\n\u5f88\u660e\u663e\u53ef\u4ee5 $\\texttt{dp}$\uff1a\n\n**$f_{w,i,j}$ \u8868\u793a\u7b2c $w$ \u6bb5\u65f6\u95f4\uff0c\u8d70\u5230 $(i,j)$ \u8fd9\u4e2a\u683c\u5b50\u65f6\u7684\u6700\u957f\u8def\u957f\u5ea6**\u3002\n\n$f_{w,i,j}$ \u53ef\u4ee5\u7531 $f_{w-1,i',j'}$ \u63a8\u5f97\u3002\n\n\u5982\u679c\u76f4\u63a5**\u91ce\u86ee\u9012\u63a8**\uff08\u66b4\u529b\u627e\u540c\u884c\uff08\u5217\uff09\u7684 $i'$ \u6216 $j'$\uff09\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(knm(n+m))$ \u7a33\u70b8\u3002\n\n\u8003\u8651\u5230\u9012\u63a8\u65f6\u7684**\u5355\u5411\u6027\u548c\u5355\u8c03\u6027**\uff0c\u60f3\u5230\u53ef\u4ee5\u7528**\u5355\u8c03\u961f\u5217**\u3002\n\n---\n\n\u5bf9\u4e8e\u6bcf\u4e2a $w$\uff0c$d_w$ \u4e0d\u540c\uff0c\u6240\u4ee5\u53ef\u4ee5**\u5206\u7c7b\u8ba8\u8bba**\u4e0d\u540c\u65b9\u5411\u65f6\u7684 $\\texttt{dp}$ \u9012\u63a8\u65b9\u6cd5\u3002\n\n**\u4e3e\u4f8b\uff1a\u5047\u8bbe $d_w=4$\uff0c\u5373\u65b9\u5411\u4e3a\u53f3\u3002**\n\n\u56e0\u4e3a\u662f\u6a2a\u5411\u9012\u63a8\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u5355\u72ec\u8003\u8651\u6bcf\u4e00\u884c\u3002\n\n**\u600e\u4e48\u7528\u5355\u8c03\u961f\u5217\u5462\uff1f**\n\n1. \u961f\u5217\u4e2d\u5b58\u7684\u662f**\u5f53\u524d\u683c\u5de6\u7aef \u4ece\u5934\u5230\u5c3e ``\u671f\u671b\u8d21\u732e``\u5355\u8c03\u9012\u51cf\u7684 \u5217\u4e0b\u6807**\u3002\n2. \u6e05\u7a7a **$w$ \u65f6\u95f4\u6bb5\u957f\u5ea6\u5185\u4e0d\u53ef\u8fbe\u5230\u7684**\u6216**\u4e0e\u5f53\u524d\u683c\u88ab\u969c\u788d\u7269\u9694\u7edd\u7684**\u5217\u4e0b\u6807\u3002\n3. \u904d\u5386\u5217\u7684\u540c\u65f6**\u7ef4\u62a4\u5355\u8c03\u961f\u5217\u5e76\u6c42\u5f97 $f_{w,i,j}$ \u9012\u63a8\u503c\u3002**\n\n**\u8fd9\u4e1c\u897f\u597d\u60f3\u5374\u96be\u8bb2\uff0c\u4e8e\u662f\u849f\u84bb\u753b\u4e86\u4e2a\u56fe\uff1a**\n\n![klhez.jpg](https://i.loli.net/2020/03/27/v6icFgW5PwO7y1m.jpg)\n\n> \u5176\u5b9e\u7eff\u8272\u683c\u5b50\u4e0a\u4e5f\u5e94\u8be5\u6709\u6570\u5b57\uff0c\u4e5f\u5e94\u8be5\u8003\u8651\u662f\u5426\u653e\u8fdb\u5355\u8c03\u961f\u5217\uff0c\u4f46\u662f\u90a3\u6837\u95ee\u9898\u4f1a\u7a0d\u5fae\u590d\u6742\u4e00\u4e9b\u3002\n\n\u8bbe\u5355\u8c03\u961f\u5217\u7684\u5934\u4e3a $qtop$\uff0c\u5982\u4e0a\u56fe\u4e2d $queue=\\{3,5\\}$\uff0c$qtop=3$\u3002\n\n**\u6240\u4ee5\u9012\u63a8\u8f6c\u79fb\u65b9\u7a0b\u4e3a\uff1a**\n\n$$f_{w,i,j}=f_{w,qtop}+j-qtop$$\n\n\u6240\u4ee5\u4e0a\u56fe\u4e2d\uff1a\n\n$$f_{w,4,6}=f_{w-1,4,3}+6-3=21$$\n\n**\u6240\u4ee5\u5f53 $d_w=4$ \u65f6\u7684\u4ee3\u7801\uff1a**\n\n```cpp\nfor(re int i=1;i<=n;i++){\n\tl=1,r=0;\n\tfor(re int j=1;j<=m;j++){\n\t\tif(G[i][j]){l=r+1;continue;} //\u5982\u679c\u9047\u5230\u969c\u788d\u7269\uff0c\u6e05\u7a7a\u6570\u7ec4\n\t\twhile(l<=r&&q[l]<j-mv.se) l++; //\u628a\u8be5\u65f6\u95f4\u6bb5\u8d70\u4e0d\u5230\u7684\u6392\u9664\uff08\u65f6\u95f4\u592a\u5c11\u4e86\uff09\n\t\twhile(l<=r&&f[p^1][i][q[r]]-q[r]<=f[p^1][i][j]-j) r--; //\u7ef4\u62a4\u961f\u5217\u671f\u671b\u8d21\u732e\u5355\u8c03\u9012\u51cf\n\t\tq[++r]=j,f[p][i][j]=max(f[p][i][j],f[p^1][i][q[l]]+j-q[l]); //\u961f\u5217\u52a0\u5165j\uff0c\u4e00\u8def\u9012\u63a8dp\n\t}\n}\n```\n\n\u81f3\u4e8e\u53e6\u5916 $3$ \u4e2a\u65b9\u5411\uff0c\u81ea\u5df1\u62ff\u7eb8\u7b14\u6a21\u62df\u6a21\u62df\u5373\u53ef\u77e5\u3002\n\n---\n\n\u4ee3\u7801\u5b9e\u73b0\u7684\u65f6\u5019\uff0c\u5176\u5b9e $w$ \u8fd9\u4e00\u7ef4\u53ef\u4ee5\u7528**\u6eda\u52a8\u6570\u7ec4**\u4f18\u5316\u5230 $\\Theta(1)$\u3002\n\n**\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(knm)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(nm)$\u3002**\n\n---\n\n## Code\n  \n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n//Start\n#define re register\n#define il inline\n#define mk make_pair\n#define mt make_tuple\n#define pb push_back\n#define db double\n#define lng long long\n#define fi first\n#define se second\nconst int inf=0x3f3f3f3f;\n\n//Data\nconst int N=200;\nint n,m,x,y,k,G[N+7][N+7];\nvector<pair<int,int>> Mv;\nint f[2][N+7][N+7];\nchar s[N+7];\n\n//Main\nint main(){\n\tscanf(\"%d%d%d%d%d\",&n,&m,&x,&y,&k);\n\tfor(re int i=1;i<=n;i++){\n\t\tscanf(\"%s\",s+1);\n\t\tfor(re int j=1;j<=m;j++) G[i][j]=(s[j]=='x');\n\t}\n\tfor(re int i=1,s,t,d;i<=k;i++){\n\t\tscanf(\"%d%d%d\",&s,&t,&d);\n\t\tMv.pb(mk(d,t-s+1)); // \u91cd\u8981\u7684\u662f\u65f6\u95f4\u6bb5\u957f\u5ea6\n\t}\n\tre int p=0,l,r;\n\tre vector<int> q(max(n,m)+7);\n\t//\u6211\u539f\u6765\u8fd9\u91cc\u7adf\u7136\u5199\u6210\u4e86 re vector<int> q(n+7);\uff0c\u5982\u679c n<m \u5c31 RE \u4e86\n\tfor(re int i=1;i<=n;i++)\n\t\tfor(re int j=1;j<=m;j++) f[p][i][j]=-inf;\n\tf[p][x][y]=0;\n\tfor(re auto mv:Mv){\n\t\tp^=1; //\u6eda\u52a8\n\t\tfor(re int i=1;i<=n;i++)\n\t\t\tfor(re int j=1;j<=m;j++) f[p][i][j]=-inf;\n\t\tif(mv.fi==1){ // \u4e0a\n\t\t\tfor(re int j=1;j<=m;j++){\n\t\t\t\tl=1,r=0;\n\t\t\t\tfor(re int i=n;i>=1;i--){\n\t\t\t\t\tif(G[i][j]){l=r+1;continue;}\n\t\t\t\t\twhile(l<=r&&q[l]>i+mv.se) l++;\n\t\t\t\t\twhile(l<=r&&f[p^1][q[r]][j]+q[r]<=f[p^1][i][j]+i) r--;\n\t\t\t\t\tq[++r]=i,f[p][i][j]=max(f[p][i][j],f[p^1][q[l]][j]+q[l]-i);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if(mv.fi==2){ // \u4e0b\n\t\t\tfor(re int j=1;j<=m;j++){\n\t\t\t\tl=1,r=0;\n\t\t\t\tfor(re int i=1;i<=n;i++){\n\t\t\t\t\tif(G[i][j]){l=r+1;continue;}\n\t\t\t\t\twhile(l<=r&&q[l]<i-mv.se) l++;\n\t\t\t\t\twhile(l<=r&&f[p^1][q[r]][j]-q[r]<=f[p^1][i][j]-i) r--;\n\t\t\t\t\tq[++r]=i,f[p][i][j]=max(f[p][i][j],f[p^1][q[l]][j]+i-q[l]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if(mv.fi==3){ // \u5de6\n\t\t\tfor(re int i=1;i<=n;i++){\n\t\t\t\tl=1,r=0;\n\t\t\t\tfor(re int j=m;j>=1;j--){\n\t\t\t\t\tif(G[i][j]){l=r+1;continue;}\n\t\t\t\t\twhile(l<=r&&q[l]>j+mv.se) l++;\n\t\t\t\t\twhile(l<=r&&f[p^1][i][q[r]]+q[r]<=f[p^1][i][j]+j) r--;\n\t\t\t\t\tq[++r]=j,f[p][i][j]=max(f[p][i][j],f[p^1][i][q[l]]+q[l]-j);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if(mv.fi==4){ // \u53f3-\u4e3e\u7684\u4f8b\u5b50\n\t\t\tfor(re int i=1;i<=n;i++){\n\t\t\t\tl=1,r=0;\n\t\t\t\tfor(re int j=1;j<=m;j++){\n\t\t\t\t\tif(G[i][j]){l=r+1;continue;}\n\t\t\t\t\twhile(l<=r&&q[l]<j-mv.se) l++;\n\t\t\t\t\twhile(l<=r&&f[p^1][i][q[r]]-q[r]<=f[p^1][i][j]-j) r--;\n\t\t\t\t\tq[++r]=j,f[p][i][j]=max(f[p][i][j],f[p^1][i][q[l]]+j-q[l]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tre int ans=-inf;\n\tfor(re int i=1;i<=n;i++)\n\t\tfor(re int j=1;j<=m;j++) ans=max(ans,f[p][i][j]);\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n---\n\n**\u795d\u5927\u5bb6\u5b66\u4e60\u6109\u5feb\uff01**",
        "postTime": 1585324938,
        "uid": 118365,
        "name": "George1123",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2254 \u3010[NOI2005]\u7470\u4e3d\u534e\u5c14\u5179\u3011"
    },
    {
        "content": "## \u5355\u8c03\u961f\u5217\u4f18\u5316dp \n**[MyBlog](https://www.luogu.org/blog/LCA/)**\n\n\u5e38\u89c4\u7684\u52a8\u6001\u89c4\u5212\uff1a\n$f(time, x, y) = max\\{f(time-1, x, y),f(time-1,x-dx[d],y-dy[d])+1 \\}$\n\n\u5176\u4e2d$d$\u4e3a \u65b9\u5411\uff0c$dx[]$ \u662f\u79fb\u52a8\u65f6\u6a2a\u5750\u6807\u7684\u53d8\u5316\u91cf\uff0c$dy[]$\u7c7b\u4f3c\n\n\u590d\u6742\u5ea6\u4e3a $O(T * M * N)$ \uff0c\u663e\u7136\u8d85\u65f6\n\n**\u6ce8\u610f\uff1a\u6b64\u5904 $x$ \u4e3a\u4e8c\u7ef4\u5750\u6807\u7cfb\u4e2d\u7684\u6a2a\u5750\u6807\u76f8\u5f53\u4e8e\u4e8c\u7ef4\u6570\u7ec4\u4e2d\u7684\u5217\u53f7\u3002~~(\u6211\u56e0\u4e3a\u8fd9\u4e2a\u8c03\u4e86\u5f88\u4e45)~~**\n\n\u53ef\u4ee5\u60f3\u5230\u4e00\u79cd\u4f18\u5316\u662f\u6309\u7167\u65f6\u95f4\u6bb5\u8fdb\u884c\u52a8\u6001\u89c4\u5212\uff0c\u4f46\u590d\u6742\u5ea6\u4ecd\u7136\u5f88\u5927\u3002\n\n\u4f46\u6ce8\u610f\u5230\u4e00\u4e2a\u65f6\u95f4\u6bb5\u5185\u53ea\u80fd\u5f80\u4e00\u4e2a\u65b9\u5411\u79fb\u52a8\uff0c\u4e8e\u662f\uff0c\u53ef\u4ee5\u91c7\u7528\u76f8\u5bf9\u7684\u4f4d\u7f6e\uff0c\u628a x\u3001y\u7b80\u5316\u8868\u793a\u6210\u76f8\u5bf9\u4e8e\u8d77\u59cb\u4f4d\u7f6e\u7684\u8ddd\u79bb\uff0c\u4e8e\u662f\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$f[j] = max\\{ f[i]+j-i \\}$\uff0c$i<j$\uff0c\u4e14 $i$ \u4e0e $j$ \u540c\u5c5e\u4e00\u4e2a\u65b9\u5411\n\n\u5373\uff1a\n$f[j]-j = max\\{f[i]-i\\}$\n\n\u8bbe $g[x] = f[x]-x$\uff0c\u5219\uff1a\n\n$g[j] = max\\{g[i]\\}$\uff0c\u4e14 $i$\u3001$j$ \u8981\u6ee1\u8db3 $i<j$\uff0c\u4e14 $j-i <=$ \u65f6\u95f4\u6bb5\u957f\u5ea6\n\n\u4e0d\u96be\u53d1\u73b0g[]\u7684\u503c\u53ef\u4ee5\u7528**\u5355\u8c03\u961f\u5217**\u7ef4\u62a4\uff0c\u5b9e\u73b0\u65f6\u53ef\u4ee5\u91c7\u7528**\u5355\u8c03\u9012\u51cf\u961f\u5217**\uff0c\u6bcf\u4e2a\u961f\u5217\u5143\u7d20\u8bb0\u5f55\u4e24\u4e2a\u503c\uff1a\u4e0e\uff08\u672c\u65f6\u95f4\u6bb5\u7684\uff09\u8d77\u59cb\u4f4d\u7f6e\u7684\u76f8\u5bf9\u4f4d\u7f6e\u7684\u8ddd\u79bb\u503c$pos$ $(j - i)$\u4ee5\u53ca$g[i]$\uff0c\u961f\u5217\u4e2d\u5143\u7d20 $i$ \u7684 $pos$ \u9012\u589e\uff0c$g[i]$ \u9012\u51cf\u3002\n\n\u5982\u679c\u65b0\u52a0\u5165\u7684\u5143\u7d20 $k$\uff08\u6ee1\u8db3 $k-j <=$ \u5f53\u524d\u65f6\u95f4\u6bb5\u957f\u5ea6\uff09\u7684 $g$ \u503c\u5927\u4e8e\u961f\u5c3e\u5143\u7d20\u7684 $g$ \u503c\uff0c\u90a3\u4e48\u961f\u5c3e\u5143\u7d20\u5c31\u53ef\u4ee5\u5220\u9664\u3002\n#### [\u53c2\u8003\u7a0b\u5e8f]\n\n```cpp\n/*\nProblem : P2254\nAlgorithm : \u5355\u8c03\u961f\u5217\u4f18\u5316dp \nStatus : AC\n*/\n#include <bits/stdc++.h>\n#include <cstring>\n#include <vector>\n#include <algorithm>\n#include <cstdio>\n#include <iostream>\nusing namespace std;\ntypedef long long ll;\n\nconst int INF = 0x3f3f3f3f;\nconst int MAXN = 205;\nconst int dx[] = {0,0,0,-1,1};\nconst int dy[] = {0,-1,1,0,0};\n\nint n,m,ans,sx,sy,k;\nchar mp[MAXN][MAXN];\nint f[MAXN][MAXN];\n\nstruct Period{\n\tint bgn,end,dir;//\u6bcf\u4e2a\u65f6\u6bb5\u7684\u5f00\u59cb\u3001\u7ed3\u675f\u65f6\u95f4\u53ca\u8239\u7684\u65b9\u5411 \n} p[MAXN];\t\t// \u8bb0\u5f55\u5404\u65f6\u95f4\u533a\u95f4\u53ca\u65b9\u5411\u7684\u4fe1\u606f\n\nstruct Node{\n\tint pos,val;\n};\n\ndeque<Node> q;\n\nvoid caculate(int x,int y,int dir,int len){//\u8d77\u70b9\u3001\u65b9\u5411\u3001\u65f6\u957f\u7a97\u53e3\u533a\u95f4\n\tq.clear();\n\tint idx = 0;\n        // idx : \u76f8\u5bf9\u4e8e\u672c\u533a\u95f4\u5f00\u59cb\u4f4d\u7f6e\u7684\u3001\u672c\u65b9\u5411\u4e0a\u7684\u4f4d\u79fb\u91cf\n\twhile(x >= 1 && x <= m && y >= 1 && y <= n){\n\t\tif(mp[y][x] == 'x'){ //\u6ce8\u610f\u6b64\u5904\u548c\u4e0b\u9762\u7684\u884c\u53f7\u5217\u53f7\n\t\t    q.clear();\n\t\t}else{\n\t\t\twhile(!q.empty() && q.back().val <= f[y][x] - idx)\n\t\t\t    q.pop_back(); // \u9012\u51cf\u7684\u5355\u8c03\u961f\u5217\n\t\t\tq.push_back((Node){idx,f[y][x] - idx});\n            \t\t// j\u3001pos \u90fd\u662f\u76f8\u5bf9\u4e8e\u8d77\u59cb\u4f4d\u7f6e\u7684\u76f8\u5bf9\u4f4d\u7f6e\uff0c\u4e00\u51cf\u5373\u5f97\u5230\u533a\u95f4\u957f\u5ea6\n\t\t\tif(idx - q.front().pos > len) \n\t\t\t    q.pop_front();// \u628a\u961f\u9996\u5f80\u540e\u8c03\u6574\u81f3\u843d\u5165\u5f53\u524d\u65f6\u957f\u7684\u201c\u7a97\u53e3\u533a\u95f4\u201d\u5185\n\t\t\tf[y][x] = q.front().val + idx;\n\t\t\tans = max(ans,f[y][x]);\n\t\t}\n\t\tx += dx[dir];\n\t\ty += dy[dir];\n\t\tidx++;\n        \t//\u6539\u53d8\u5f53\u524d\u7684\u4f4d\u7f6e\u548c\u8ddd\u79bb\n\t}\n}\n\nint main(){\n\t//freopen(\".in\",\"r\",stdin);\n\t//freopen(\".out\",\"w\",stdout);\n\tscanf(\"%d%d%d%d%d\",&n,&m,&sx,&sy,&k);\n\tfor(int i = 1;i <= n;i++){\n\t\tfor(int j = 1;j <= m;j++){\n\t\t    cin >> mp[i][j];\n\t\t    f[i][j] = -10000;\n\t\t}\n\t}\n\tfor(int i = 1;i <= k;i++)\n\t    scanf(\"%d%d%d\",&p[i].bgn,&p[i].end,&p[i].dir);\n\tf[sx][sy] = 0;\n\tfor(int i = 1;i <= k;i++){// \u6309\u65f6\u6bb5\u6765\u63a8\n\t\tint len = p[i].end - p[i].bgn + 1;// \u5f53\u524d\u65f6\u95f4\u533a\u95f4\u7684\u65f6\u957f\n\t\tswitch(p[i].dir){\t\t  // 4 \u4e2a\u65b9\u5411\n\t\t\tcase 1:\n\t\t\t\tfor(int j = 1;j <= m;j++)\n\t\t\t\t    caculate(j,n,1,len); //\u4e0a\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tfor(int j = 1;j <= m;j++)\n\t\t\t\t    caculate(j,1,2,len); //\u4e0b\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tfor(int j = 1;j <= n;j++)\n\t\t\t\t    caculate(m,j,3,len); //\u5de6\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tfor(int j = 1;j <= n;j++)\n\t\t\t\t    caculate(1,j,4,len); //\u53f3\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n\n```\n",
        "postTime": 1554123961,
        "uid": 108894,
        "name": "\u5173\u6000\u4ed6\u4eba",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2254 \u3010[NOI2005]\u7470\u4e3d\u534e\u5c14\u5179\u3011"
    },
    {
        "content": "# P2254 [NOI2005] \u7470\u4e3d\u534e\u5c14\u5179 \u9898\u89e3\r\n[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P2254)\r\n## \u9898\u76ee\u80cc\u666f\r\n$$\\text{-\u9ebb\u70e6\u628a\u7434\u5239\u5173\u4e86\u3002}$$\r\n$$\\footnotesize\\text{-Take the brakes off,please.}$$\r\n$$\\text{-\u4ec0\u4e48\uff1f\u4f60\u75af\u4e86\uff1f}$$\r\n$$\\footnotesize\\text{-What? That's crazy!}$$\r\n$$\\text{-\u76f8\u4fe1\u6211\uff0c\u628a\u7434\u5239\u5173\u4e86\u3002}$$\r\n$$\\footnotesize\\text{-Trust me,Just take the brakes off.}$$\r\n$$......$$\r\n## \u9898\u76ee\u5206\u6790\r\n\u9996\u5148\u8bbe\u8ba1\u72b6\u6001\uff0c\u5148\u8003\u8651\u8bbe $f(t,i,j)$ \u8868\u793a $t$ \u65f6\u523b\uff0c\u5728\u7b2c $i$ \u884c\u7b2c $j$ \u5217\u7684\u4f4d\u7f6e\u8d70\u8fc7\u7684\u6700\u957f\u8def\u5f84\u957f\u3002\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u4e3a $f(t,i,j)=\\max(f(t-1,i,j),f(t-1,i^\\prime,j^\\prime))$\u3002\r\n\r\n\u5176\u4e2d $i^\\prime$ \u548c $j^\\prime$\u4e3a\u4e0a\u4e00\u4e2a\u5408\u6cd5\u7684\u8f6c\u79fb\u4f4d\u7f6e\uff0c\u5373\u4e0e\u5f53\u524d\u4f4d\u7f6e\u540c\u884c\u6216\u540c\u5217\uff08\u53d6\u51b3\u4e8e\u65b9\u5411\uff09\u7684\u975e\u5bb6\u5177\u4f4d\u7f6e\u3002\r\n\r\n\u663e\u7136\u8fd9\u6837\u505a\u590d\u6742\u5ea6\u4e3a $O(TNM)$\uff0c\u5fc5\u7136\u8d85\u65f6\u3002\r\n\r\n\u8003\u8651\u4f18\u5316\u8fd9\u4e2a\u72b6\u6001\uff0c\u8bbe $f(k,i,j)$ \u8868\u793a\u5728\u7b2c $k$ \u65f6\u95f4\u6bb5\u4e4b\u4e2d\uff0c\u5728\u4f4d\u7f6e $(i,j)$ \u7684\u6700\u957f\u8def\u5f84\u957f\u3002\r\n\r\n\u8868\u9762\u4e0a\u770b\uff0c\u8fd9\u4e2a\u72b6\u6001\u7684\u590d\u6742\u5ea6\u5e76\u6ca1\u6709\u4ec0\u4e48\u4f18\u5316\u3002\r\n\r\n\u56e0\u4e3a\u54ea\u6015\u5728\u7b2c\u4e00\u7ef4\u4e4b\u4e2d\u7528\u65f6\u95f4\u6bb5\u4ee3\u66ff\u65f6\u523b\uff0c\u6211\u4eec\u5e76\u4e0d\u4f1a\u56e0\u6b64\u800c\u5c11\u7ef4\u62a4\u72b6\u6001\uff0c\u56e0\u4e3a\u5728\u6bcf\u4e2a\u65f6\u95f4\u6bb5\u7ec6\u5206\u51fa\u7684**\u6bcf\u4e2a\u65f6\u523b**\u4ecd\u7136\u9700\u8981\u7ef4\u62a4\u3002\r\n\r\n\u8fd9\u6837\u770b\u6765\u590d\u6742\u5ea6\u4e3a $O(KN^2M)$\u3002\u4e0e\u6211\u4eec\u5148\u524d\u7684\u505a\u6cd5\u522b\u65e0\u4e8c\u81f4\u3002\r\n\r\n\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u628a\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u5199\u51fa\u6765\uff1a\r\n\r\n$f(k,i,j)=\\max\\{f(k-1,i^\\prime,j^\\prime)+distance\\}$\r\n\r\n\u4e0b\u6587\u5c06\u4f1a\u8bf4\u660e\uff0c\u6b63\u56e0\u4e3a\u8fd9\u6837\u8bbe\u8ba1\u72b6\u6001\uff0c\u6211\u4eec\u624d\u5f97\u4ee5\u4f18\u5316\u3002\r\n\r\n\u8fd9\u662f\u5f88\u7c97\u7565\u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd8\u6ca1\u6709\u89e3\u51b3\u4e24\u4e2a\u95ee\u9898\uff1a\u4e0a\u4e00\u4e2a\u5408\u6cd5\u4f4d\u7f6e\u7684\u786e\u5b9a\u548c\u5f53\u524d\u4f4d\u7f6e\u4e0e\u5176\u4e4b\u95f4\u7684\u8ddd\u79bb\uff08\u5373 $distance$\uff09\u3002\r\n\r\n\u90a3\u4e48\uff0c\u6211\u4eec\u6539\u5982\u4f55\u4f18\u5316\u8fd9\u4e00\u8f6c\u79fb\u5462\uff1f\r\n\r\n## \u8f6c\u79fb\u4f18\u5316\r\n\u9996\u5148\uff0c\u4e0a\u6587\u5df2\u7ecf\u63d0\u5230\u4e86\uff0c\u4e0a\u4e00\u4e2a\u5408\u6cd5\u4f4d\u7f6e\u4e0e\u5f53\u524d\u7684\u4f4d\u7f6e\u540c\u884c\u6216\u540c\u5217\uff0c\u5e76\u5177\u4f53\u53d6\u51b3\u4e8e\u65b9\u5411\u3002\r\n\r\n\u90a3\u4e48\u4ee5\u5f53\u524d\u65f6\u95f4\u6bb5\u65b9\u5411\u5411\u5357\u4e3a\u4f8b\uff0c\u8bbe\u5f53\u524d\u65f6\u95f4\u6bb5\u957f\u5ea6\u4e3a $len$\uff0c\u6211\u4eec\u6709\uff1a\r\n\r\n$f(k,i,j)=\\max\\limits_{i-len\\leqslant pos\\leqslant i}\\{f(k-1,pos,j)+i-pos\\}$\r\n\r\n\u5148\u8981\u5f3a\u8c03\u4e00\u70b9\uff0c$(i,j)$ \u4f4d\u7f6e\u7684\u542b\u4e49\u662f**\u7b2c $i$ \u884c\u7b2c $j$ \u5217**\uff0c\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c\u6211\u4eec\u8981\u5728\u7c7b\u4f3c\u6837\u4f8b\u56fe\u793a\u7684\u90a3\u79cd\u8868\u683c\u4e0a\u5efa\u7acb\u4e00\u4e2a\u5750\u6807\u7cfb\uff0c\u90a3\u4e48\u539f\u70b9\u5728**\u5de6\u4e0a\u89d2**\uff0cy\u8f74\u4ee5**\u5411\u4e0b**\u4e3a**\u6b63\u65b9\u5411**\u3002\r\n\r\n\u6240\u4ee5\u4ed4\u7ec6\u770b\u65b9\u7a0b\u4e2d $pos$ \u7684\u8303\u56f4\uff0c\u5982\u679c\u5411\u5357\uff08\u4e5f\u5c31\u662f\u5411\u4e0b\uff09\u79fb\u52a8\uff0c\u5f53\u524d\u72b6\u6001\u80af\u5b9a\u662f\u4ece\u4e0a\u65b9\u72b6\u6001\u8f6c\u79fb\u8fc7\u6765\uff0c\u4f46\u662f\uff0c\u7531\u4e8e\u6b63\u65b9\u5411\u5411\u4e0b\uff0c\u4e0a\u65b9\u70b9\u7684 $i$ \u5750\u6807\u662f**\u66f4\u5c0f**\u7684\u503c\uff0c\u800c\u4e0d\u662f\u66f4\u5927\u7684\u503c\uff08\u8fd9\u6837\u5c31\u662f\u4ee5\u53f3\u4e0b\u89d2\u4e3a\u539f\u70b9\uff09\u3002\r\n\r\n\u6211\u4eec\u4e4b\u6240\u4ee5\u8fd9\u6837\u8bbe\u8ba1\u5750\u6807\u662f\u56e0\u4e3a\u8fd9\u6837\u4e0e**\u6570\u7ec4\u7684\u4e0b\u6807\u8868\u793a**\u5c31\u543b\u5408\u4e86\uff0c\u4ee5\u4fbf\u4e8e\u6211\u4eec\u4f7f\u7528\u6570\u7ec4\u548c\u5faa\u73af\u53d8\u91cf\u3002\r\n\r\n\u63a5\u4e0b\u6765\u5bf9\u65b9\u7a0b\u8fdb\u884c\u5206\u6790\uff0c\r\n\r\n\u9996\u5148\uff0c\u4ece\u65b9\u7a0b\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0c\u4e0a\u6587\u4e2d\u7684 $distance$ \u5c31\u53ea\u662f\u533a\u95f4\u4e2d**\u8fde\u7eed**\u7684\u4f4d\u79fb\u589e\u91cf\uff0c\u5f88\u597d\u6c42\u89e3\u3002\r\n\r\n\u5176\u6b21\uff0c\u7531\u4e8e\u65b9\u7a0b\u4e4b\u4e2d\u5f53\u524d\u4f4d\u7f6e\u786e\u5b9a\uff0c$i$ \u4e3a\u5b9a\u503c\uff0c\u53ef\u4ee5\u5199\u6210\uff1a\r\n\r\n$f(k,i,j)=\\max\\limits_{i-len\\leqslant pos\\leqslant i}\\{f(k-1,pos,j)-pos\\}+i$\r\n\r\n\u90a3\u4e48\uff0c\u5173\u952e\u7684\u4f18\u5316\u5c31\u5728\u4e8e\u6c42\u6700\u5927\u503c\u7684\u4f18\u5316\uff1a\r\n\r\n\u6211\u4eec\u53d1\u73b0\uff0c\u65b9\u7a0b\u4e2d\u53ea\u6709\u4e00\u4e2a\u53d8\u91cf $pos$\uff0c\u89c2\u5bdf\u5176\u53d6\u503c\u8303\u56f4\uff0c\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u5f53\u524d\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u7531\u4e4b\u8f6c\u79fb\u7684\u4f4d\u7f6e\u5904\u5728\u4e00\u6bb5\u957f\u5ea6**\u56fa\u5b9a**\u4e3a $len$ \u7684**\u8fde\u7eed**\u533a\u95f4\u4e4b\u4e2d\u3002\r\n\r\n\u8fd9\u4e0d\u5c31\u53d8\u6210\u7ef4\u62a4**\u5b9a\u957f\u533a\u95f4\u6700\u503c**\u7684\u95ee\u9898\uff0c\u4e5f\u5c31\u662f**\u6ed1\u52a8\u7a97\u53e3**\u7684\u95ee\u9898\u5417\uff1f\r\n\r\n\u663e\u7136\u53ef\u4ee5\u4f7f\u7528**\u5355\u8c03\u961f\u5217**\u4f18\u5316\uff0c\u90a3\u4e48\u539f\u5148\u7ef4\u62a4\u533a\u95f4\u6700\u503c\u7684\u6700\u574f $O(N)$ \u590d\u6742\u5ea6\u5747\u644a\u4e3a $O(1)$\uff0c\u6574\u4f53\u590d\u6742\u5ea6\u4f18\u5316\u81f3 $O(KNM)$\uff0c\u53ef\u4ee5\u63a5\u53d7\u4e86\u3002\r\n\r\n\u81f3\u4e8e\u7a7a\u95f4\u590d\u6742\u5ea6\uff0c\u5c31\u53ef\u4ee5\u7528**\u6eda\u52a8\u6570\u7ec4**\u4f18\u5316\u3002\r\n## \u9644\u4e0a\u4ee3\u7801\r\n```cpp\r\n#include<bits/stdc++.h>\r\n#define int long long\r\n#define maxn 210\r\n#define INF INT_MAX //\u7528LLONG_MAX\u4f1a\u5bfc\u81f4\u51cf\u6cd5\u6ea2\u51fa \r\n#define upd ans=max(ans,f[p][i][j])\r\n#define chk if(a[i][j]=='x'){l=1;r=0;continue;}//\u9047\u5230\u975e\u6cd5\u4f4d\u7f6e\uff0c\u76f4\u63a5\u6e05\u7a7a\u961f\u5217\r\nusing namespace std;\r\nint q[maxn],l=1,r;\r\nchar a[maxn][maxn];\r\nint f[2][maxn][maxn];\r\nint ans,p;\r\nint n,m,x,y,k;\r\nsigned main()\r\n{\r\n\tcin>>n>>m>>x>>y>>k;\r\n\tfor(int i=1;i<=n;++i)\r\n\t\tfor(int j=1;j<=m;++j)cin>>a[i][j];\r\n\tfor(int i=1;i<=n;++i)\r\n\t\tfor(int j=1;j<=m;++j)\r\n\t\t\tf[p][i][j]=-INF;\r\n\tf[p][x][y]=0;\r\n\twhile(k--)\r\n\t{\r\n\t\tp^=1;//\u6eda\u52a8\u6570\u7ec4\r\n\t\tint s,t,d;\r\n\t\tcin>>s>>t>>d;\r\n\t\tint len=t-s+1;\r\n\t\tif(d==1)\r\n\t\t\tfor(int j=1;j<=m;++j)\r\n\t\t\t{\r\n\t\t\t\tl=1; r=0;//\u6bcf\u6b21\u961f\u5217\u6e05\u7a7a\r\n\t\t\t\tfor(int i=n;i>=1;--i)\r\n\t\t\t\t{\r\n\t\t\t\t\tchk;\r\n\t\t\t\t\twhile(l<=r&&f[p^1][q[r]][j]+q[r]<=f[p^1][i][j]+i)r--;\r\n\t\t\t\t\twhile(l<=r&&q[l]-i>len)l++;\r\n\t\t\t\t\tq[++r]=i;\r\n\t\t\t\t\tf[p][i][j]=f[p^1][q[l]][j]+q[l]-i;\r\n\t\t\t\t\tupd;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\telse if(d==2)\r\n\t\t\tfor(int j=1;j<=m;++j)\r\n\t\t\t{\r\n\t\t\t\tl=1; r=0;\r\n\t\t\t\tfor(int i=1;i<=n;++i)\r\n\t\t\t\t{\r\n\t\t\t\t\tchk;\r\n\t\t\t\t\twhile(l<=r&&f[p^1][q[r]][j]-q[r]<=f[p^1][i][j]-i)r--;\r\n\t\t\t\t\twhile(l<=r&&i-q[l]>len)l++;\r\n\t\t\t\t\tq[++r]=i;\r\n\t\t\t\t\tf[p][i][j]=f[p^1][q[l]][j]+i-q[l];\r\n\t\t\t\t\tupd;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\telse if(d==3)\r\n\t\t\tfor(int i=1;i<=n;++i)\r\n\t\t\t\t{\r\n\t\t\t\t\tl=1; r=0;\r\n\t\t\t\t\tfor(int j=m;j>=1;--j)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tchk;\r\n\t\t\t\t\t\twhile(l<=r&&f[p^1][i][q[r]]+q[r]<=f[p^1][i][j]+j)r--;\r\n\t\t\t\t\t\twhile(l<=r&&q[l]-j>len)l++;\r\n\t\t\t\t\t\tq[++r]=j;\r\n\t\t\t\t\t\tf[p][i][j]=f[p^1][i][q[l]]+q[l]-j;\r\n\t\t\t\t\t\tupd;\r\n\t\t\t\t}\r\n\t\t\t}\t\r\n\t\telse\r\n\t\t\tfor(int i=1;i<=n;++i)\r\n\t\t\t{\r\n\t\t\t\tl=1; r=0;\r\n\t\t\t\tfor(int j=1;j<=m;++j)\r\n\t\t\t\t{\r\n\t\t\t\t\tchk;\r\n\t\t\t\t\twhile(l<=r&&f[p^1][i][q[r]]-q[r]<=f[p^1][i][j]-j)r--;\r\n\t\t\t\t\twhile(l<=r&&j-q[l]>len)l++;\r\n\t\t\t\t\tq[++r]=j;\r\n\t\t\t\t\tf[p][i][j]=f[p^1][i][q[l]]+j-q[l];\r\n\t\t\t\t\tupd;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t}\r\n\tcout<<ans<<endl;\r\n\treturn 0;\r\n}\r\n```\r\n## \u4e00\u4e9b\u7ec6\u8282\r\n\u5728\u4ee3\u7801\u5b9e\u73b0\u65f6\uff0c\u5728\u5404\u4e2a\u65b9\u5411\u4e0a\u7684\u5904\u7406\u90fd\u6709\u4e9b\u8bb8\u4e0d\u540c\uff0c\u5f88\u5bb9\u6613\u72af\u9519\u3002\r\n\r\n- \u5728\u5185\u5916\u5c42\u5faa\u73af\u53d8\u91cf\u7684\u786e\u5b9a\u4e0a\uff1a\r\n\r\n\t\u5bf9\u4e8e\u67d0\u4e00\u4e2a\u65b9\u5411\uff0c\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u5f53\u524d\u4f4d\u7f6e\uff0c$pos$ \u7684\u53d6\u503c\u4e0e\u8be5\u65b9\u5411\u7684**\u53d8\u5316\u7ef4\u5ea6**\u5728**\u540c\u4e00**\u7ef4\u5ea6\u4e0a\u3002\r\n\r\n\t\u6bd4\u5982\uff0c\u5982\u679c\u662f\u7ad6\u76f4\u65b9\u5411\uff0c\u8fd0\u52a8\u65f6\u53d8\u5316\u7684\u7ef4\u5ea6\u5c31\u662f $i$\uff0c\u6240\u4ee5 $pos$ \u4e0e $i$ \u5728\u540c\u4e00\u7ef4\u5ea6\uff0c\u90a3\u4e48 $i$ \u5c31\u5728\u5185\u5c42\u5faa\u73af\u3002\r\n\r\n- \u5728\u679a\u4e3e\u987a\u5e8f\u7684\u786e\u5b9a\u4e0a\uff1a\r\n\r\n\t\u4ee5\u5411\u5317\uff08\u5411\u4e0a\uff09\u4e3a\u4f8b\uff0c\u5185\u5c42\u5faa\u73af\u679a\u4e3e\u65f6\u662f\u4ece $n$ \u5230 $1$ \u679a\u4e3e\uff0c\u56e0\u4e3a**\u5411\u4e0a**\u6070\u6070\u662fy\u8f74\u7684**\u8d1f\u65b9\u5411**\uff0c\u6240\u4ee5\u5728\u8fd0\u52a8\u65f6 $i$ \u5750\u6807\u4f1a**\u4ece\u5927\u5230\u5c0f**\u5730\u53d8\u5316\u3002\r\n\r\n\t\u6240\u4ee5\u679a\u4e3e\u987a\u5e8f\u8981\u6839\u636e\u5750\u6807\u8f74\u65b9\u5411\u6765\u786e\u5b9a\u3002\r\n\r\n- \u5728\u5f39\u6808\u6761\u4ef6\u7684\u786e\u5b9a\u4e0a\uff1a\r\n\t\r\n   \u662f\u5426\u5f39\u6808\uff0c\u5176\u5b9e\u5c31\u53d6\u51b3\u4e8e $distance$ \u662f\u5426\u5927\u4e8e $len$\u3002\r\n   \r\n   \u4f46\u662f\u8981\u6ce8\u610f $distance$ \u7684\u8868\u8fbe\u5f0f\uff0c\u60f3\u6e05\u695a\u8c01\u5927\u8c01\u5c0f\uff0c\u8fd8\u662f\u4ee5\u5411\u5317\uff08\u5411\u4e0a\uff09\u4e3a\u4f8b\uff1a\r\n\t\r\n   \u7531\u4e8e\u5f53\u524d\u72b6\u6001\u7531\u4e0b\u65b9\u72b6\u6001\u66f4\u65b0\u800c\u6765\uff0c\u800c\u4e0b\u65b9\u70b9\u7684 $i$ \u5750\u6807\u66f4\u5927\uff0c\u6240\u4ee5\u5f39\u6808\u6761\u4ef6\u4e3a`q[l]-i>len`\u3002\r\n   \r\n   ~~\u8fd9\u4e48\u770b\u6765\u5168\u7528\u7edd\u5bf9\u503c\u51fd\u6570\u4e5f\u4e0d\u662f\u4e0d\u884c\u5462\u3002~~\r\n   \r\n\u6700\u540e\u63d0\u4e00\u70b9\uff0c\u521d\u59cb\u5316\u6240\u6709\u72b6\u6001\u4e3a\u8d1f\u65e0\u7a77\uff0c\u8d77\u70b9\u9664\u5916\u3002\r\n\r\n\u56e0\u4e3a\u672c\u6765\u53ea\u80fd\u4ece\u5355\u70b9\u51fa\u53d1\u8fd0\u52a8\uff0c\u7531\u5355\u70b9\u9012\u63a8\u66f4\u65b0\u72b6\u6001\uff0c\u5982\u679c\u5176\u4f59\u72b6\u6001\u4e0d\u8bbe\u7f6e\u4e3a\u8d1f\u65e0\u7a77\uff0c\u5c31\u76f8\u5f53\u4e8e\u53ef\u4ee5\u4ece\u591a\u4e2a\u70b9\u51fa\u53d1\uff0c\u663e\u7136\u4e0d\u5408\u903b\u8f91\u3002\r\n## \u7ed3\u8bed\r\n$\\text{\u9646\u5730\u4e0a\u7684\u4eba\u4eec\u6d6a\u8d39\u4e86\u592a\u591a\u65f6\u95f4\u53bb\u95ee\u4e3a\u4ec0\u4e48\u3002}$\r\n\r\n$\\footnotesize\\text{I think you land people waste a lot of time wondering why.}$\r\n\r\n$\\text{\u51ac\u5929\u6765\u4e34\u65f6\uff0c\u5df4\u671b\u7740\u590f\u5929\uff0c}$\r\n\r\n$\\footnotesize\\text{Winter comes and you can't wait for summer.}$\r\n\r\n$\\text{\u590f\u5929\u5230\u6765\u65f6\uff0c\u5c31\u5df2\u7ecf\u5f00\u59cb\u5bb3\u6015\u51ac\u5929\u3002}$\r\n\r\n$\\footnotesize\\text{Summer comes and you live in dread of winter.}$\r\n   \r\n$\\text{\u6240\u4ee5\u4eba\u4eec\u6c38\u4e0d\u538c\u5026\u65c5\u884c\uff0c}$\r\n\r\n$\\footnotesize\\text{That's why you never tire of traveling.}$\r\n\r\n$\\text{\u603b\u662f\u5728\u8ffd\u5bfb\uff0c\u56db\u5b63\u5982\u6625\u7684\u8fdc\u65b9\u3002}$\r\n\r\n$\\footnotesize\\text{Always chasing someplace far away where it's always summer.}$\r\n   \r\n$\\text{\u2014\u2014\u300a\u6d77\u4e0a\u94a2\u7434\u5e08\u300b}$\r\n\r\n\r\n\r\n\r\n",
        "postTime": 1660118330,
        "uid": 625380,
        "name": "FriedrichC",
        "ccfLevel": 0,
        "title": "Magic Waltz"
    },
    {
        "content": "\u8fd9\u9053\u9898\u5176\u5b9e\u633a\u7b80\u5355\u7684\u3002\n\n\u9996\u5148\u6700\u663e\u7136\u7684DP\uff1a\nf[i][x][y] = max(f[i - 1][x'][y']) + 1;\n\ni\u8868\u793a\u7684\u662f\u65f6\u95f4\u70b9\uff0cx\u548cy\u8868\u793a\u4f4d\u7f6e\uff0c\u800cx'\u548cy'\u8868\u793a\u4e0a\u4e00\u4e2a\u5408\u6cd5\u4f4d\u7f6e\uff1b\n\n\u5f53\u7136\u8d85\u65f6\uff08noi\u7684\u9898\u600e\u4e48\u53ef\u80fd\u8fd9\u4e48\u6c34\uff09\n\n### \u518d\u770b\u9898\u76ee\u3002\u6ce8\u610f\u662f\u65f6\u95f4\u6bb5\uff01\n\n\u90a3\u6211\u4eec\u6362\u79cd\u8868\u793a\u8bd5\u8bd5\u3002\n\nf[i][x][y] = max(f[i - 1][x\u2019][y']) + dist(x,y,x',y');\n\ni\u8868\u793a\u7684\u662f\u7b2ci\u4e2a\u65f6\u95f4\u6bb5\u7ed3\u675f\u540e\uff0c(x,y)\u8fd9\u4e2a\u4f4d\u7f6e\u6700\u957f\u7684\u6ed1\u884c\u8ddd\u79bb\u3002\n\n\u6ce8\u610f(x,y)\u4e0e(x',y')\u5fc5\u5b9a\u662f\u5728\u540c\u4e00\u5217\u6216\u540c\u4e00\u884c\u4e0a\u7684\uff0c\u4f46\u4e0d\u4e00\u5b9a\u76f8\u90bb\u3002\n\n\u8fd8\u662f\u8d85\u65f6\u3002\n\n\u90a3\u4e48\u56de\u5934\u518d\u770b\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff0c\u53d1\u73b0\u6709\u8981\u6c42max\uff0c\u800c\u4e14\u6c42\u53ef\u80fd\u62d3\u5c55\u7684\u72b6\u6001\u6709\u7ebf\u6027\u5173\u7cfb\uff08\u5728\u540c\u4e00\u5217\u6216\u540c\u4e00\u884c\u4e0a\uff09\n\n## \u5355\u8c03\u961f\u5217\uff01\n\n\u9996\u5148\u6309\u7167\u8bfb\u5165\u7684\u6bcf\u4e2a\u65f6\u95f4\u6bb5\u7684\u65b9\u5411\uff0c\u7a77\u4e3e\u6bcf\u4e2a\u65b9\u5411\u7684\u521d\u59cb\u70b9\u3002\u5728\u5355\u8c03\u961f\u5217\u91cc\u8bb0\u5f55\u6240\u5728\u5217\u6216\u884c\u67d0\u4e00\u4e2a\u8282\u70b9\u51cf\u53bb\u5b83\u5230\u8fd9\u4e00\u5217\u6216\u884c\u521d\u59cb\u4f4d\u7f6e\u7684\u8ddd\u79bb\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u7528\u6b65\u6570\uff08\u5c31\u662f\u521d\u59cb\u70b9\u5230\u5f53\u524d\u70b9\u7684\u8ddd\u79bb\uff09\u52a0\u4e0a\u961f\u9996\u3002\n\n\u6253\u4e2a\u6bd4\u65b9\uff1a\u76ee\u524d\u662f\u7b2c2\u77ed\u65f6\u95f4\uff0c\u5411\u4e0b\uff0c\u4e5f\u5c31\u662f\u5411\u5357\u3002\n\nf[1][2][2]\u5df2\u7ecf\u6c42\u51fa\u6765\u4e86\uff0c\u662f3,\u5e76\u4e14\u5728\u961f\u9996\u3002\n\u90a3\u4e48\u961f\u9996\u8bb0\u5f55\u7684\u5c31\u662f3 - 2 = 1\uff1b\n\n\u90a3\u4e48f[2][3][2] = 1 + 3 = 4\uff1b\n\n\u5047\u8bbef[1][2][2]\u8fd8\u662f\u961f\u9996\uff1b\n\n\u90a3\u4e48f[2][4][2] = 1 + 4 = 5;\n\n\u4e8e\u662f\u4ee3\u7801\u5c31\u5f88\u6109\u5feb\u7684\u6572\u51fa\u6765\u4e86\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\nint n, m, x, y, k, s1, t1, d1, f[210][210][210], ans, dx[] = {0, -1, 1, 0, 0}, dy[] = {0, 0, 0, -1, 1}, q[100010], pos[100010], head, tail; \nchar a[310][310];\n\nvoid push(int now, int val, int x, int y){\n\tif (val == -0x7f7f7f7f) return ;//\u5982\u679c\u8d70\u4e0d\u5230\u8fd9\u4e2a\u4f4d\u7f6e \n\t\n\twhile (head <= tail && val - now >= q[tail])\n    \n\t /*\u4e4b\u6240\u4ee5\u8981\u51cf\u53bbnow\u662f\u56e0\u4e3a\uff08x,y\uff09\u8fd9\u4e2a\u4f4d\u7f6e\u4e0d\u4e00\u5b9a\u662f\u5728\u5f53\u524d\u65b9\u5411\u7684\u8d77\u70b9\u4e0a \uff0c\u6240\u4ee5\u51cf\u53bbnow\u4e4b\u540e\u8fd0\u7b97\u5c31\u53ef\u4ee5\u65b9\u4fbf\uff0c\u56e0\u4e3a\u4e4b\u540e\u67d0\u4e00\u6b65\u7684\u6b65\u6570\u51cf\u53bb\u5f53\u524d\u7684\u6b65\u6570\u5f97\u5230\u7684\u503c\u5c31\u662f(x,y)\u5230\u4e4b\u540e\u90a3\u4e00\u6b65\u5728\u7684\u70b9\u7684\u8ddd\u79bb\uff0c\u8fd9\u91cc\u7b49\u4e8e\u5316\u7b80\u4e86\u4e00\u4e0b */\n     \n\t\ttail--;//\u5f39\u51fa\u961f\u5c3e \n\t\t\n\tq[++tail] = val - now;\n\tpos[tail] = now;//\u8fd9\u91cc\u8bb0\u5f55\u4f4d\u7f6e\uff0c\u5224\u65ad\u662f\u4e0d\u662f\u80fd\u6ed1 \n}\n\nvoid dp(int p, int x, int y, int d, int t){\n\t\n\tif (t < 1) return ;//\u4e00\u4e2a\u7279\u5224 \n\t\n\thead = 1; tail = 0; \n\tint now = 1;\n\t\n\twhile(x <= n && x > 0 && y <= m && y > 0){\n\t\t\n\t\tif (a[x][y] == 'x') head = 1, tail = 0;//\u5982\u679c\u78b0\u5230\u4e86\u969c\u788d\uff0c\u4e4b\u524d\u505a\u7684\u5168\u90e8\u5931\u6548\uff0c\u961f\u5217\u6e05\u7a7a \n\t\telse push(now, f[p - 1][x][y], x, y);\n\t\t\n\t\twhile(head <= tail && now - pos[head] > t)//\u5982\u679c\u8d85\u51fa\u4e86\u80fd\u6ed1\u7684\u533a\u95f4\uff0c\u5c31\u53ef\u4ee5\u628a\u961f\u9996\u5f39\u51fa\u53bb\u4e86 \n\t\t\thead++;\n\t\t\n\t\tif (head <= tail) f[p][x][y] = q[head] + now;//\u52a0\u4e0a\u6b65\u6570 \n\t\telse f[p][x][y] = -0x7f7f7f7f;\n\t\t\n\t\tans = max(ans, f[p][x][y]);//\u8bb0\u5f55\u7b54\u6848 \n\t\t\n\t\tx += dx[d];//\u66f4\u65b0\u4f4d\u7f6e \n\t\ty += dy[d];\n\t\t\n\t\tnow++;//\u6b65\u6570\u52a01 \n\t}\n}\n\nint main(){\n\tios :: sync_with_stdio(false);\n\t\n\tcin >> n >> m >> x >> y >> k;\n\t\n\tmemset(f, 128, sizeof(f));\n\t\n\tfor (int i = 1; i <= n; i++)\n\t\tfor (int j = 1; j <= m; j++)\n\t\t\tf[0][i][j] = -0x7f7f7f7f;\n\t\n\tf[0][x][y] = 0;//\u8d77\u59cb\u4f4d\u7f6e\u4e3a\u6ed1\u52a8\u8ddd\u79bb\u4e3a0 \n\t\n\tfor (int i = 1; i <= n; i++)\n\t\tfor (int j = 1; j <= m; j++)\n\t\t\tcin >> a[i][j];\n\t\t\t\n\tfor (int i = 1; i <= k; i++){\n\t\tcin >> s1 >> t1 >> d1;\n\t\tif (d1 == 1) {\n\t\t\tfor (int j = 1; j <= m; j++)\n\t\t\t\tdp(i, n, j, d1, t1 - s1 + 1);//\u8fd9\u91cc\u662f\u7a77\u4e3e\u6bcf\u4e2a\u65b9\u5411\u7684\u521d\u59cb\u4f4d\u7f6e \n\t\t}\n\t\t\n\t\tif (d1 == 2) {\n\t\t\tfor (int j = 1; j <= m; j++)\n\t\t\t\tdp(i, 1, j, d1, t1 - s1 + 1);\n\t\t}\n\t\t\n\t\tif (d1 == 3) {\n\t\t\tfor (int j = 1; j <= n; j++)\n\t\t\t\tdp(i, j, m, d1, t1 - s1 + 1);\n\t\t}\n\t\t\n\t\tif (d1 == 4) {\n\t\t\tfor (int j = 1; j <= n; j++)\n\t\t\t\tdp(i, j, 1, d1, t1 - s1 + 1);\n\t\t}\n\t}\n\t\n\tcout << ans << endl;//\u8f93\u51fa\u7b54\u6848 \n\t\n\treturn 0;\n}\n//2018.2.22\n\n```\n\n\n",
        "postTime": 1519278008,
        "uid": 43476,
        "name": "_Toz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2254 \u3010[NOI2005]\u7470\u4e3d\u534e\u5c14\u5179\u3011"
    },
    {
        "content": "\u53d1\u73b0\u5728\u540c\u4e00\u65f6\u95f4\u6bb5\u4e2d\uff0c\u6ed1\u52a8\u7684\u65b9\u5411\u5177\u6709\u552f\u4e00\u6027\uff0c\u6240\u4ee5\u4e0d\u96be\u5f97\u51fa$DP$\u65b9\u7a0b\u3002\n\n$f_{i,j}=max(f_{i,j},f_{i-dx_,j-dy}+dis_{i,j,i-dx_,j-dy})$\n\n$(i,j)$\u4e3a\u5750\u6807\uff0c$(i-dx_,j-dy)$\u4e3a\u53ef\u4ee5\u8f6c\u79fb\u5230$(i,j)$\u7684\u5408\u6cd5\u5750\u6807\uff0c$dis$\u4e3a\u8ba1\u7b97\u4e24\u4e2a\u5750\u6807\u4e4b\u95f4\u79fb\u52a8\u7684\u8ddd\u79bb\u3002\n\n\u7ee7\u7eed\u8003\u8651\u6ed1\u52a8\u7684\u65b9\u5411\u5177\u6709\u552f\u4e00\u6027\u8fd9\u4e00\u7279\u70b9\uff0c\u4e5f\u5c31\u662f\u94a2\u7434\u53ea\u80fd\u5728\u884c\u4e0a\u6216\u5217\u4e0a\u6ed1\u52a8\u4e00\u4e2a\u56fa\u5b9a\u7684\u533a\u95f4\u8303\u56f4\uff0c\u4e0d\u96be\u60f3\u5230\u6ed1\u52a8\u7a97\u53e3\u8fd9\u4e00\u6a21\u578b\u3002\u4e8e\u662f\u91c7\u7528\u5355\u8c03\u961f\u5217\u4f18\u5316$DP$\uff0c\u6bcf\u6b21\u53ea\u4ece\u961f\u5934\u8f6c\u79fb\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u90fd\u662f\u4ece\u5408\u6cd5\u533a\u95f4\u4e2d\u9009\u53d6\u4e86\u6700\u4f18\u7684\u72b6\u6001\u8f6c\u79fb\u8fc7\u6765\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(knm)$\u3002\n\n\u5176\u4ed6\u7ec6\u8282\u5904\u7406\u5c31\u770b\u4ee3\u7801\u5427\u3002\n\n$code:$\n```cpp\n#include<bits/stdc++.h>\n#define maxn 310\n#define inf 200000000\nusing namespace std;\ntemplate<typename T> inline void read(T &x)\n{\n\tx=0;char c=getchar();bool flag=false;\n\twhile(!isdigit(c)){if(c=='-')flag=true;c=getchar();}\n\twhile(isdigit(c)){x=(x<<1)+(x<<3)+(c^48);c=getchar();}\n\tif(flag)x=-x;\n}\nint n,m,x,y,k,f,r,ans;\nchar w[maxn][maxn];\nint dp[maxn][maxn],dx[4]={-1,1,0,0},dy[4]={0,0,-1,1};\nstruct que\n{\n    int val,x,y;\n}q[maxn];\nint dis(int ax,int ay,int bx,int by)\n{\n    return abs(ax-bx)+abs(ay-by);\n}\nvoid work(int x,int y,int len,int d)\n{\n    f=1,r=0,d--;\n    while(1)\n    {\n        if(x<1||y<1||x>n||y>m) break;\n        if(w[x][y]=='x') f=1,r=0;\n        else\n        {\n            while(f<=r&&dp[x][y]>q[r].val+dis(x,y,q[r].x,q[r].y)) r--;\n            q[++r]=(que){dp[x][y],x,y};\n            while(f<=r&&(abs(x-q[f].x)>len||abs(y-q[f].y)>len)) f++;\n            dp[x][y]=max(dp[x][y],q[f].val+dis(x,y,q[f].x,q[f].y));\n            ans=max(ans,dp[x][y]);\n        }\n        x+=dx[d],y+=dy[d];\n    }\n}\nint main()\n{\n\tread(n),read(m),read(x),read(y),read(k);\n    for(int i=1;i<=n;++i) scanf(\"%s\",w[i]+1);\n    for(int i=1;i<=n;++i)\n        for(int j=1;j<=m;++j)\n            dp[i][j]=-inf;\n    dp[x][y]=0;\n    for(int i=1;i<=k;++i)\n    {\n        int s,t,l,d;\n        read(s),read(t),read(d),l=t-s+1;\n        if(d==1) for(int j=1;j<=m;++j) work(n,j,l,d);\n        if(d==2) for(int j=1;j<=m;++j) work(1,j,l,d);\n        if(d==3) for(int j=1;j<=n;++j) work(j,m,l,d);\n        if(d==4) for(int j=1;j<=n;++j) work(j,1,l,d);\n    }\n    printf(\"%d\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1576672236,
        "uid": 172489,
        "name": "lhm_",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P2254 \u3010[NOI2005]\u7470\u4e3d\u534e\u5c14\u5179\u3011"
    },
    {
        "content": "\u9996\u5148\u53ef\u4ee5\u60f3\u51fa\u4e00\u4e2a $O(NMT)$ \u7684\u505a\u6cd5\uff0c~~\u636e\u8bf4\u5361\u4e0b\u5e38\u80fd\u8fc7~~\uff0c\u5177\u4f53\u600e\u4e48\u505a\u53ef\u4ee5\u53c2\u8003\u5176\u4ed6\u9898\u89e3\u3002\u8003\u8651\u4f18\u5316\u8fd9\u4e2a\u505a\u6cd5\uff0c\u5927\u591a\u6570\u9898\u89e3\u90fd\u7528\u7684\u662f\u5355\u8c03\u961f\u5217\uff0c\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u79cd\u53e6\u5916\u7684\u65b9\u6cd5\u3002\n___\n\u6211\u4eec\u53d1\u73b0\u6bcf\u4e2a\u533a\u95f4\u7684\u64cd\u4f5c\u662f\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528\u500d\u589e\u7684\u65b9\u6cd5\uff0c\u628a\u6bcf\u4e2a\u533a\u95f4\u62c6\u6210 $1,2,4,...$ \u7684\u6bb5\uff0c\u8fd9\u6837\u4e0e\u4e00\u4e2a\u4e00\u4e2a\u7b97\u662f\u7b49\u6548\u7684\uff0c\u4f46\u662f\u6bcf\u4e2a\u533a\u95f4\u53ea\u9700\u8981\u8ba1\u7b97 $\\log$ \u6b21\uff0c\u4e0e\u591a\u91cd\u80cc\u5305\u4e0d\u540c\u7684\u662f\u8fd9\u4e2a\u9898\u76ee\u4e2d\u5982\u679c\u66f4\u65b0\u7684\u4f4d\u7f6e\u548c\u88ab\u66f4\u65b0\u7684\u4f4d\u7f6e\u4e4b\u95f4\u6709\u969c\u788d\u65f6\u4e0d\u80fd\u66f4\u65b0\u3002~~\u8c8c\u4f3c\u6bd4\u67d0\u4e9b\u5927\u5e38\u6570\u7684\u5355\u8c03\u961f\u5217\u8fd8\u5feb\u3002~~\n___\n\u4ee3\u7801\uff08\u65f6\u95f4\uff1a$O(NMK\\log(\\max(N,M)),463ms$\uff1b\u7a7a\u95f4\uff1a$O(NM),1.15MB$\uff09\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m,T,x,y,dp[201][201],s,t,d,ans;\nunsigned char nxt1[201][201],nxt2[201][201],nxt3[201][201],nxt4[201][201],a[201][201];\nvoid abc(int b)//\u8f6c\u79fb\n{\n\tif(d==1)for(int j=1;j<=m;j++)for(int i=1+b;i<=n;i++)if(nxt1[i][j]<i-b)dp[i-b][j]=max(dp[i-b][j],dp[i][j]+b);\n\tif(d==2)for(int j=1;j<=m;j++)for(int i=n-b;i;i--)if(nxt2[i][j]>i+b)dp[i+b][j]=max(dp[i+b][j],dp[i][j]+b);\n\tif(d==3)for(int i=1;i<=n;i++)for(int j=1+b;j<=m;j++)if(nxt3[i][j]<j-b)dp[i][j-b]=max(dp[i][j-b],dp[i][j]+b);\n\tif(d==4)for(int i=1;i<=n;i++)for(int j=m-b;j;j--)if(nxt4[i][j]>j+b)dp[i][j+b]=max(dp[i][j+b],dp[i][j]+b);\n}\nint main()\n{\n\tscanf(\"%d%d%d%d%d\",&n,&m,&x,&y,&T);\n\tmemset(nxt2,n+1,sizeof(nxt2));\n\tmemset(nxt4,m+1,sizeof(nxt4));\n\tmemset(dp,-0x3f,sizeof(dp)),dp[x][y]=0;\n\tfor(int i=1;i<=n;i++)scanf(\"%s\",a[i]+1);\n\tfor(int i=1;i<=n;i++)for(int j=1;j<=m;j++)if(a[i][j]=='x')//\u5904\u7406\u6709\u969c\u788d\u7684\u60c5\u51b5\n\t{\n\t\tfor(int k=i+1;a[k][j]=='.';k++)nxt1[k][j]=i;nxt1[i][j]=i;\n\t\tfor(int k=i-1;a[k][j]=='.';k--)nxt2[k][j]=i;nxt2[i][j]=i;\n\t\tfor(int k=j+1;a[i][k]=='.';k++)nxt3[i][k]=j;nxt3[i][j]=j;\n\t\tfor(int k=j-1;a[i][k]=='.';k--)nxt4[i][k]=j;nxt4[i][j]=j;\n\t}\n\twhile(T--)\n\t{\n\t\tscanf(\"%d%d%d\",&s,&t,&d),t-=s-1;\n\t\tint t1=1;while(t>t1)abc(t1),t-=t1,t1<<=1;//\u4f18\u5316\n\t\tabc(t);\n\t}\n\tfor(int i=1;i<=n;i++)for(int j=1;j<=m;j++)ans=max(ans,dp[i][j]);\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1594007363,
        "uid": 44840,
        "name": "123456zmy",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2254 \u3010[NOI2005]\u7470\u4e3d\u534e\u5c14\u5179\u3011"
    },
    {
        "content": "~~\u4ee5\u94a2\u7434\u533a\u840c\u65b0Up\u4e3b\u7684\u8eab\u4efd\u6765\u53d1\u4e00\u7bc7\u9898\u89e3~~\n\n\u6a21\u62df\u8d5b\u8003\u4e86\u8fd9\u9053\u9898\uff0c\u4e00\u5f00\u59cb\u60f3\u7684\u66b4\u641c\uff0c\u4f20\u7684\u53c2\u6570\u662f\u5f53\u524d\u70b9\u5750\u6807\u548c\u7b2c\u51e0\u6bb5\u533a\u95f4\u3002\u540e\u6765\u52a0\u4e86\u4e2a\u8bb0\u5fc6\u5316\uff0c\u5bfb\u601d\u80fd\u5feb\u4e00\u70b9\uff0c\u7ed3\u679cA\u4e86\u3002\u3002\u3002\n\n\u5177\u4f53\u7684\u8bdd\uff0c\u770b\u4ee3\u7801\u5427\u3002\n\n```cpp\n// luogu-judger-enable-o2\n// luogu-judger-enable-o2\n#include <iostream>\n#include <utility>\n#include <cstring>\n\nusing namespace std;\n\nconst int MAXN = 205;\nconst int MAXK = 205;\nconst int MAXT = 4e4 + 5;\nconst int X[] = {0, -1, 1, 0, 0};\nconst int Y[] = {0, 0, 0, -1, 1};\n\nint n, m, k, xx, yy;\nint l[MAXN], r[MAXN], dir[MAXN];\nchar ch[MAXN][MAXN];\nint dp[MAXK][MAXN][MAXN];\n\nint Dfs(int pos, int x, int y) {//\u641c\u7d22\n    if (pos > k) return 0;//\u9012\u5f52\u8fb9\u754c\n    if (dp[pos][x][y] != -1) return dp[pos][x][y];//\u8bb0\u5fc6\u5316\n    int len = r[pos] - l[pos] + 1;//\u65f6\u95f4\u6bb5\u957f\u5ea6\n    int nowx = x, nowy = y;\n    int ret = Dfs(pos + 1, x, y);//\u521d\u59cb\u5316\u7b54\u6848\uff0c\u5373\u5728\u8be5\u65f6\u95f4\u6bb5\u4e0d\u52a8\n    for (int i = 1; i <= len; i++) {//\u5728\u65f6\u95f4\u6bb5\u5185\u4e00\u76f4\u5f80\u524d\u63a8\n        nowx += X[dir[pos]];\n        nowy += Y[dir[pos]];\n        if (ch[nowx][nowy] == 'x') break;\n        if (nowx > n || nowy > m || nowx < 1 || nowy < 1) break;//\u5224\u505c\n        ret = max(ret, i + Dfs(pos + 1, nowx, nowy));\n    }\n    return dp[pos][x][y] = ret;//\u66f4\u65b0\u8bb0\u5fc6\u5316\n}\n\nint main() {\n    memset(dp, -1, sizeof(dp));\n    cin >> n >> m >> xx >> yy >> k;\n    for (int i = 1; i <= n; i++) {\n        cin >> ch[i] + 1;\n    }\n    for (int i = 1; i <= k; i++) {\n        cin >> l[i] >> r[i] >> dir[i];\n    }\n    cout << Dfs(1, xx, yy) << endl;\n    return 0;\n}\n```",
        "postTime": 1559361941,
        "uid": 126376,
        "name": "Irelia\u10e6",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2254 \u3010[NOI2005]\u7470\u4e3d\u534e\u5c14\u5179\u3011"
    },
    {
        "content": "\u4e00\u9053DP\u597d\u9898\u3002\n\n\u7531\u4e8e\u849f\u84bb\u5bf9\u4f18\u5148\u961f\u5217\u7684\u5e94\u7528\u7565\u6709\u4e0d\u89e3\uff0c\u6545\u6b64\u7528\u4e00\u4e2a\u62ff$break$\u5361\u65f6\u9650\u7684\u65b9\u6cd5\u66b4\u529b$DP$\u89e3\u51b3\u95ee\u9898\u771f\u662f\uff08~~\u8212\u670d~~\uff09\u60ed\u6127\u3002\n\n\u54b3\u54b3\u3002\n\n\u6211\u4eec\u4e0d\u59a8\u8bbe$dp$\u65b9\u7a0b\u4e3a$f[t][i][j]$\u8868\u793a\u5728\u7b2c$t$\u65f6\u95f4\u6bb5\u5728\u7b2c$i$\u884c\u7b2c$j$\u5217\u6240\u80fd\u83b7\u5f97\u7684\u6700\u957f\u8ddd\u79bb\u3002\n\n\u7136\u540e\u66b4\u529b\u679a\u4e3e\u5f53\u524d\u662f\u54ea\u4e2a$[i,j]$\uff0c\u66b4\u529b\u679a\u4e3e\u5f53\u524d\u8fd9\u6bb5\u6ed1\u52a8\u7684\u6b21\u6570t\uff0c\u7b97\u51fa\u4ece\u54ea\u4e2a$[i,j]$\u6765\u7684\uff0c\u7136\u540e\u8f6c\u79fb\u5c31\u597d\u4e86\uff0c\u6743\u503c\u52a0\u4e0a$t$.\n\n\u7531\u4e8e\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e00\u65e6\u88ab\u6321\u4f4f\uff08\u969c\u788d\u6216\u8005\u8fb9\u754c\uff09\uff0c\u90a3\u4e48\u4e4b\u540e\u7684\u683c\u5b50\u90fd\u4e0d\u53ef\u80fd\u6765\u5230\u5f53\u524d\u683c\u5b50\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5$break$\uff0c\u518d\u52a0\u4e0a\u6bcf\u6b21\u679a\u4e3e\u7684\u6ed1\u52a8\u6b21\u6570\u672c\u6765\u5c31\u4e0d\u6ee1$maxn$\uff0c\u6240\u4ee5\u867d\u7136\u6700\u574f\u65f6\u95f4\u662f$O(n^4)$\u4f46\u662f\u4f9d\u7136\u53ef\u4ee5\u8fc7\u3002\n### $code:$\n```\n#include<bits/stdc++.h>\nusing namespace std;\nint f[210][210][210];//\u7b2ci\u65f6\u95f4\u6bb5\u5728j\uff0ck\u683c\u5b50\u4e0a\u7684\u5f97\u5206\uff0c \nint n,m,x,y,K;\nint ok[300][300];\nint main(){\n\tcin>>n>>m>>x>>y>>K;\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tchar c;\n\t\t\tcin>>c;\n\t\t\tif(c=='.') ok[i][j]=1;\n\t\t}\t\n\t} \n\tmemset(f,-0x3f,sizeof(f));\n\tf[0][x][y]=0;\n\tfor(int k=1;k<=K;k++){\n\t\tint step,tmp,op;\n\t\tcin>>step;step=-step;\n\t\tcin>>tmp;step+=tmp+1;\n\t\tcin>>op;\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tfor(int j=1;j<=m;j++){\n\t\t\t\tif(op==1){\n\t\t\t\t\tfor(int t=0;t<=step;t++){\n                    \tif(!ok[i+t][j]) break;\n                    \tf[k][i][j]=max(f[k][i][j],f[k-1][i+t][j]+t);\n\t\t\t\t\t}\n\t\t\t\t}\n                else if(op==2){\n                \tfor(int t=0;t<=step;t++){\n\t\t\t\t\t\tif(!ok[i-t][j]) break;\n                    \tf[k][i][j]=max(f[k][i][j],f[k-1][i-t][j]+t);\n                \t}\n\t\t\t\t}\n                else if(op==3){\n                \tfor(int t=0;t<=step;t++){\n\t                    if(!ok[i][j+t]) break;\n\t                    f[k][i][j]=max(f[k][i][j],f[k-1][i][j+t]+t);\n\t                }\n\t\t\t\t}\n                else if(op==4){\n                \tfor(int t=0;t<=step;t++){\n\t                    if(!ok[i][j-t]) break;\n\t                    f[k][i][j]=max(f[k][i][j],f[k-1][i][j-t]+t);\n\t                }\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tint ans=-2147483647;\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tans=max(ans,f[K][i][j]);\n\t\t}\n\t}\n    printf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n\u4f18\u5148\u961f\u5217\u6211\u4f1a\u8865\u4e0a\u7684\u3002\u3002\u3002\n\n\n",
        "postTime": 1549175602,
        "uid": 64611,
        "name": "\u4eba\u6b87\u7269\u5df2\u975e",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P2254 \u3010[NOI2005]\u7470\u4e3d\u534e\u5c14\u5179\u3011"
    },
    {
        "content": "C++\u9898\u89e3\u4e00\u53d1\uff1a\n\n\u72b6\u6001f[k][i][j]\u8868\u793a**\u65f6\u95f4\u6bb5k\u7ed3\u675f\u65f6**\uff08\u6ce8\u610f\u7528\u65f6\u95f4\u6bb5\u800c\u4e0d\u662f\u65f6\u95f4\uff0c\u5426\u5219TLE\u663e\u7136\uff0c\u800c\u4e14\u672c\u4eba\u4f7f\u7528\u72b6\u6001\u662f\u7ed3\u675f\u65f6\u72b6\u6001\uff09\uff0c\u505c\u5728[i,j]\u683c\u5b50\u5f97\u5230\u7684\u6700\u957f\u6ed1\u884c\u957f\u5ea6\u3002\u66b4\u529b\u4f1aTLE\uff0c\u6240\u4ee5\u5355\u8c03\u961f\u5217\u4f18\u5316\uff0c\u6bd5\u7adf\u8f6c\u79fb\u662f\u6709\u5e8f\u7684\u3002\u5355\u8c03\u961f\u5217\u4f18\u5316DP\u4e0d\u592a\u660e\u767d\u7684\u5ea6\u5a18\u5c31\u597d\u3002\n\n\u521d\u59cb\u5316-INF\u3002\n\n\u56db\u79cd\u72b6\u6001\u8f6c\u79fb\u975e\u5e38\u9ebb\u70e6\uff0c\u53ef\u4ee5\u7528\u4e00\u4e2a\u7edf\u4e00\u7684\u51fd\u6570\u548c\u8f6c\u79fb\u6570\u7ec4\u6765\u4f18\u5316\uff0c\u6ce8\u610f\u5904\u7406\u969c\u788d\u7269\u7684\u60c5\u51b5\u3002\n\n\n\u8865\u5145\u4e00\u53e5\uff1a**\u6837\u4f8b\u6709\u8bef\uff1a\u6700\u540e\u4e00\u884c\u662f6 7 3\uff0c3\u624d\u662f\u5411\u897f\uff0c2\u662f\u5411\u5357\uff0c\u867d\u7136\u7b54\u6848\u4e00\u6837\uff0c\u4f46\u662f\u5b8c\u5168\u4e0d\u5bf9\u554a**\uff01\n\n\n\n\n\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstdlib>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\n#define MAXN 200\n#define MAXM 200\n#define MAXK 200\n#define INF 0x3f3f3f3f\n#define V(x,y) (f[k-1][x][y]+abs(x-i)+abs(y-j))\n#define gc() getchar()\ninline int read(int ans = 0, int sgn = ' ', int ch = gc())\n{\n    for(;ch < '0' || ch > '9'; sgn=ch,ch=gc());\n    for(;ch >='0' && ch <='9'; (ans*=10)+=ch-'0',ch=gc());\n    return sgn-'-' ? ans : -ans;\n}\nint f[MAXK+5][MAXN+5][MAXM+5], qx[MAXM+5], qy[MAXM+5], t[MAXK+5], d[MAXK+5], N, M, T, K, a, b;\nint x[5] = {0,-1,1,0,0}, y[5] = {0,0,0,-1,1};\nbool g[MAXN+5][MAXM+5];\nchar op[MAXM+5];\nvoid Mono(int i, int j, int k)\n{\n    for(register int head = 0, tail = 0; i >= 1 && j >= 1 && i <= N && j <= M; i += x[d[k]], j += y[d[k]])\n    {\n        for(; head<tail && abs(i-qx[head])+abs(j-qy[head])>t[k]; head++);\n        for(; head<tail && g[i][j]; tail--);\n        for(; head<tail && V(qx[tail-1],qy[tail-1])<V(i,j); tail--);\n        if(!g[i][j])\n            qx[tail] = i, qy[tail++] = j, f[k][i][j] = V(qx[head],qy[head]); \n    }\n    return;\n}\nint Calc(int ans = -INF)\n{\n    for(register int k = 1, i, j; k <= K; k++)\n        switch(d[k])\n        {\n            //f[i][j] = f[i+x][j]+x;\n            case 1 :for(j = 1; j <= M; j++)    Mono(N,j,k);    break;\n            //f[i][j] = f[i-x][j]+x;\n            case 2 :for(j = 1; j <= M; j++)    Mono(1,j,k);    break;\n            //f[i][j] = f[i][j-x]+x;\n            case 3 :for(i = 1; i <= N; i++) Mono(i,M,k);    break;\n            //f[i][j] = f[i][j+x]+x;\n            case 4 :for(i = 1; i <= N; i++) Mono(i,1,k);    break; \n        }\n    for(register int i = 1, j; i <= N; i++)\n        for(j = 1; j <= M; j++)\n            ans = max(ans,f[K][i][j]);\n    return ans;\n}\nint main()\n{\n    N = read(), M = read(), a = read(), b = read(), K = read();\n    for(register int k = 0, i, j; k <= K; k++)\n        for(i = 0; i <= N; i++)\n            for(j = 0; j <= M; j++)\n                f[k][i][j] = -INF;\n    f[0][a][b] = 0, t[0] = 0;\n    for(register int i = 1, j; i <= N; i++)\n    {\n        scanf(\"%s\",op+1);\n        for(j = 1; j <= M; j++)\n            g[i][j] = (op[j]=='x');\n    }\n    for(register int k = 1; k <= K; k++)\n        a = read(), b = read(), t[k] = b-a+1, d[k] = read();\n    printf(\"%d\\n\",Calc());\n     return 0;\n}\n```",
        "postTime": 1486264729,
        "uid": 16528,
        "name": "magolor",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2254 \u3010\u7470\u4e3d\u534e\u5c14\u5179\u3011"
    },
    {
        "content": "## \u770b\u5230\u8fd9\u9053\u9898\uff0c\u7684\u6807\u7b7e\n\n[\u6211csdn\u7684\u535a\u5ba2]\n(https://blog.csdn.net/qq_42421714/article/details/84963779)\n\n[\u6211\u6d1b\u8c37\u7684\u535a\u5ba2](https://www.luogu.org/blog/cqj/gui-li-hua-er-zi-dan-diao-dui-lie)\n\u8bf4\u660e\u554a\uff0c\u5b83\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\n\n\u6613\u63a8\u51fa\n```cpp \ndp[x][y][t] = max(dp[x`][y`][t - 1] + 1,dp[x][y][t]);\n```\n\n\u7136\u540e\u770b\u4e00\u4e0b\u6570\u636e\u8303\u56f4\uff1f\uff1f\uff1f\nn,m\u2264200\uff0cK\u2264200\uff0cT\u226440000\n`o(n^3)`\n\u663e\u7136\uff0cTLE\n\u7136\u540e\u8001\u5e08\u8bb2\u4e86\u4f18\u5316\u65b9\u6848\nT\u53ef\u4ee5\u6362\u6210K\n\u56e0\u4e3a\u4efb\u4e00\u533a\u95f4\u65f6\u95f4\u5185\uff0c\u90fd\u53ea\u5411\u4e00\u4e2a\u65b9\u5411\u8d70\n\u3002\u3002\u3002\n\u7136\u540e\u5c31\u53ef\u4ee5\u5f97\u5230\u8f6c\u79fb\u65b9\u7a0b\n```cpp\ndp[x][y][k] = max(dp[x][y][k],dp[x1][ y1][k-1] + Abs(x - x1) + Abs(y - y2));`\nx1 y2 \u8868\u793a\u5728x,y\u7684\u524d\u63d0\u4e0b\uff0cdp[x1][y1][k - 1] +  Abs(x - x1) + Abs(y - y2))\u7684\u503c\u6700\u5927\uff08\u5728\u8303\u56f4\u5185\uff09\n'o(n^3)'\n\u7b49\u7b49\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u8c8c\u4f3c\u6ca1\u51cf\n```\n\u5c31\u662f\u6211\u4eec\u7684\u5355\u8c03\u961f\u5217\u795e\u5947\u767b\u573a\u7684\u65f6\u5019\u4e86\n` \u4f18\u5316\u6700\u5185\u5c42\u5faa\u73af`\n\n## \u601d\u8def\n#### \u6eda\u52a8\u4f18\u5316\n```cpp\ndp[x][y][k] \u7a7a\u95f4\u590d\u6742\u5ea6\u4e0d\u5c0f\n\u53ef\u4ee5\u53d1\u73b0\ndp[x][y][k] \u53ea\u8ddf\u4e0a\u4e00\u6b21\uff08dp[x][y][k - 1]\uff09\u6709\u5173\u4e14\u6ee1\u8db3x,y\u662f\u5355\u8c03\u9012\u589e\u6216\u9012\u51cf\u7684\n\u6eda\u52a8\u4f18\u5316\u4e00\u4e0b\n```\n#### \u51fd\u6570\u4f18\u5316\n```cpp\n4\u4e2a\u65b9\u5411\n\n\u76f8\u4fe1\u6ca1\u6709\u4eba\u4f1a\u5b9e\u8bdade\u75284\u4e2aif\u4e00\u4e00\u5904\u7406\n```\n\u6240\u4ee5\u6211\u4eec\u7528\u4e00\u4e2a\u51fd\u6570\n\u4f20\u8fdb\u53bb\u7684 \u5fc5\u987b\u8981\u6709 \u9650\u5236\u00b7\u5bf9\u5e94\u7684\u54ea\u79cd\u65b9\u5411\uff08\u7528\u6570\u7ec4\u5b58\u4e00\u4e0b\u5411\u8ff7\u5bab\u4e2d\u7684\u56db\u4e2a\u65b9\u5411\uff09\u00b7\u5f53\u524d\u8d77\u70b9\n#### \u5355\u8c03\u961f\u5217\n\n\u5355\u8c03\u961f\u5217\u4e2d\u7684\u5143\u7d20\u4e0d\u4ec5\u8981\u770b\u5b83\u81ea\u8eab\u7684\u503c\uff0c\u8fd8\u8981\u770b\u3002val + \u5b83\u5230\u5f53\u524d\u70b9\u7684\u8ddd\u79bb\uff08\u5728\u79fb\u52a8\u8303\u56f4\u5185\uff09\n\u54ea\u5982\u4f55\u5b9e\u73b0\u4e86\n\u5b83\u5230\u5f53\u524d\u70b9\u7684\u8ddd\u79bb\u53ef\u4ee5\n```cpp\nAbs(x - q[Index].x) + Abs(y - q[Index].y)\n```\n\u653e\u5165\u961f\u5217\u65f6\u6211\u662f\u8fd9\u6837\u641e\u7684\n```cpp\nwhile(tail >= head&&dp[x][y] > q[tail].val + M(tail))\n\t\t\t\ttail--;\n```\n\u4f46\u6211\u4eec\u5982\u4f55\u4fdd\u8bc1\u5faa\u73af\u7ed3\u675f\u540e\u53d6\u51fa\u6765\u7684\u5c31\u662f\u6700\u5927\u503c\uff1f\uff08M()\u5b8f\u5b9a\u4e49\uff0c\u8be6\u89c1code\uff09\n\u6bcf\u4e2a\u5143\u7d20\u90fd\u662f\u8fd9\u6837\u653e\u8fdb\u53bb\u7684\n\u90a3\u4e48\u5047\u8bbe\u961f\u5217q={1,2,3}(\u90fd\u662fval\u503c)\n\u5728\u679a\u4e3e\u70b9\u65f6\uff0c\u6bcf\u6b21\u8ddd\u79bb\u90fd\u8981\u52a0\u4e00\n1 + 1 = 2\n2 + 1 = 3\n3 + 1 = 4\nq = {1,2,3}\n\u987a\u5e8f\u6ca1\u6709**\u53d1\u751f\u6539\u53d8**\n#### \u6ce8\u610f\n\u7531\u4e8e\u6eda\u52a8\u4f18\u5316\u540e\u4e86\uff0c\u5904\u7406\u4e00\u4e2a\u70b9\u65f6\u53ea\u80fd\u5148\u653e\u5165\u5355\u8c03\u961f\u5217\n\n\u518d\u53d6\u51fa\u5f53\u524d\u6700\u5927\u503c\n\n\u8fd8\u6709`X`\uff0c\u662f\u4e0d\u80fd\u8d70\u7684\uff0c\u9047\u5230\u5c31\u91cd\u65b0\u6e05\u4e00\u4e0b\u961f\u5217\uff08\u628aHead = 1,tail = 0\uff09\n## code\n```cpp\n#include <cstdio>\n#include <cstring>\n#define M(Index) Abs(x - q[Index].x) + Abs(y - q[Index].y)\nusing namespace std;\nconst int MAXN = 202;\nbool Map[MAXN][MAXN];\nint n,m,dp[MAXN][MAXN],ans;\nint dir[4][2] = {{-1,0},{1,0},{0,-1},{0,1}};\nclass T\n{\n\tpublic:\n\t\tint val;\n\t\tint x,y;\n};\ntemplate<typename TT>\ninline TT Max(TT a,TT b) {if(a > b) return a;return b;}\ntemplate<typename TT>\ninline TT Abs(TT a) {if(a < 0) return -a;return a;}\ninline void Dp(int x,int y,int con,int s)\n{\n\ts--;\n\tT q[MAXN];\n\tint head = 1,tail = 0;\n\tfor(;x <= n&&x > 0&&y <= m&&y > 0;x += dir[s][0],y += dir[s][1])\n\t\tif(Map[x][y] == 0)\n\t\t\thead = 1,tail = 0;\n\t\telse {\n\t\t    while(tail >= head&&dp[x][y] > q[tail].val + M(tail))\n\t\t\t\ttail--;\n\t\t\ttail++;\n\t\t\tq[tail].val = dp[x][y];\n\t\t\tq[tail].x = x;\n\t\t\tq[tail].y = y;\n\t\t\twhile(head <= tail&&(Abs(x - q[head].x) > con||Abs(y - q[head].y) > con))\n\t\t\t\thead++;\n            dp[x][y] = Max(dp[x][y],q[head].val + M(head));\n            ans = Max(ans,dp[x][y]);\n\t\t}\n}\nint main()\n{\n    int x,y,k,i,j;\n    scanf(\"%d%d%d%d%d\",&n,&m,&x,&y,&k);\n    char a;\n    for(i = 1;i <= n;i++)\n    {\n        getchar();\n        for(j = 1;j <= m;j++)\n        {\n            scanf(\"%c\",&a);\n            if(a == '.')\n                Map[i][j] = 1;\n        }\n    }\n    memset(dp,-0x7f7f7f,sizeof(dp));\n    dp[x][y] = 0;\n    for(i = 1;i <= k;i++)\n    {\n        int s,t,d,con;\n        scanf(\"%d%d%d\",&s,&t,&d);\n        con = t - s + 1;\n        if(d == 1) for(j = 1;j <= m;j++) Dp(n,j,con,1);\n        if(d == 2) for(j = 1;j <= m;j++) Dp(1,j,con,2);\n        if(d == 3) for(j = 1;j <= n;j++) Dp(j,m,con,3);\n        if(d == 4) for(j = 1;j <= n;j++) Dp(j,1,con,4);\n    }\n    printf(\"%d\",ans);\n    return 0;\n}\n\n```",
        "postTime": 1544592273,
        "uid": 73992,
        "name": "resftlmuttmotw",
        "ccfLevel": 0,
        "title": "\u7470\u4e3d\u534e\u5c14\u5179--\u5355\u8c03\u961f\u5217"
    },
    {
        "content": "\u5b89\u5229\u4e0b\u849f\u84bb\u7684blog qwq(http://www.elijahqi.win/2017/10/29/luogu2254-%e7%91%b0%e4%b8%bd%e5%8d%8e%e5%b0%94%e5%85%b9/)\n\n\u6837\u4f8b\u5e94\u8be5\u6709\u8bef \u51d1\u5408\u770b\u5c31\u597d\u00a0 \u5c31\u662f\u65b9\u5411\u4e0d\u592a\u5bf9\n\n\u5176\u5b9e\u4e0d\u9700\u8981\u659c\u7387\u4f18\u5316 \u7684\u66b4\u529b\u4e5f\u53ef\u4ee5\u8fc7\u5c31\u6734\u7d20dp\n\nf[i][j][k]\u8868\u793ak\u8fd9\u4e2a\u65f6\u95f4\u6bb5\u6211\u73b0\u5728\u5728i\u548cj\u8fd9\u4e2a\u4f4d\u7f6e\n\n\u7136\u540e\u6bcf\u6b21\u65f6\u95f4\u6bb5\u5faa\u73af\u4e3a0\u7684\u65f6\u5019\u53ef\u4ee5\u770b\u4f5c\u6211\u4ece\u4e0a\u4e00\u4e2a\u65f6\u95f4\u6bb5\u5230\u8fd9\u4e2a\u65f6\u95f4\u6bb5\u4e00\u76f4\u505c\u5728\u8fd9\n\n\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2ai\uff0cj\u6211\u90fd\u53bb\u66f4\u65b0\u4ed6\u4eec\u80fd\u8d70\u7684\u65b9\u5411 \u6700\u540e\u627e\u4e2a\u6700\u5927\u503c\u5373\u53ef \u5176\u4ed6\u7684\u4e00\u4e9b\u7ec6\u8282\u5efa\u8bae\u81ea\u5df1\u60f3\u4e00\u60f3 \u6216\u8005\u770b\u4ee3\u7801\u7684\n\n\u8fd9\u7248\u7a0b\u5e8f\u5e38\u6570\u6709\u70b9\u5927 \u53ea\u6709\u5927\u725b\u624d\u80fd\u4ea4\u8fc7 bzoj\u5361\u65f6\u9650\u4ea4\u8fc7\n\n\u66b4\u529bdp+\u5927\u5e38\u6570\n\n```cpp\n#include<cmath>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define N 220\nusing namespace std;\ninline char gc(){\n    static char now[1<<16],*S,*T;\n    if (T==S){T=(S=now)+fread(now,1,1<<16,stdin);if (T==S) return EOF;}\n    return *S++;\n}\ninline int read(){\n    int x=0,f=1;char ch=gc();\n    while (ch<'0'||ch>'9') {if (ch=='-') f=-1;ch=gc();}\n    while (ch<='9'&&ch>='0'){x=x*10+ch-'0';ch=gc();}\n    return x*f;\n}\nint dx[5]={0,-1,1,0,0},dy[5]={0,0,0,-1,1};\nstruct node{\n    int d,t;\n}data[N];\nchar map[N][N];bool flag[N][N][2];\nint n,m,x,y,kk,f[N][N][2];\nint main(){\n//    freopen(\"2254.in\",\"r\",stdin);\n    scanf(\"%d%d%d%d%d\",&n,&m,&x,&y,&kk);\n    for (int i=1;i<=n;++i) scanf(\"%s\",map[i]+1);\n    memset(f,0xff,sizeof(f));f[x][y][0]=0;int pre=0,cur=1;flag[x][y][0]=1;\n    for (int i=1;i<=kk;++i) {\n        int st=read(),ed=read(),d=read();\n        data[i].t=ed-st+1;data[i].d=d;\n    }\n    for (int k=0;k<kk;++k){\n        for (int i=1;i<=n;++i){\n            for (int j=1;j<=m;++j){\n                if (!flag[i][j][pre]) continue;\n                if (map[i][j]=='x') continue;\n                for (int s=0;s<=data[k+1].t;++s){\n                    int nowx=i+s*dx[data[k+1].d],nowy=j+s*dy[data[k+1].d];\n                    if (nowx<1||nowx>n||nowy<1||nowy>m) break;if (map[nowx][nowy]=='x')break;\n                    flag[nowx][nowy][cur]=1;\n                    f[nowx][nowy][cur]=max(f[nowx][nowy][cur],f[i][j][pre]+s);\n                }\n            }\n        }\n        for (int i=1;i<=n;++i)\n            for (int j=1;j<=m;++j) f[i][j][pre]=-1,flag[i][j][pre]=0;\n        pre^=1;cur^=1;\n    }int ans=0;\n    for (int i=1;i<=n;++i)\n        for(int j=1;j<=m;++j)\n            ans=max(ans,f[i][j][pre]);\n    printf(\"%d\",ans);\n    return 0;\n}\n```\n\u66b4\u529bdp+\u5c0f\u5e38\u6570 \u4e3b\u7ad9\u4e5f\u53ef\u4ee5\u4ea4\u8fc7\n\n```cpp\n//\u7470\u4e3d\u534e\u5c14\u5179\n#include <cstdio>\n#include <cstring>\nint const N=210;\nint n,m,x0,y0,K;\nchar map[N][N];\nint fr[N],to[N],d[N];\nint f[2][N][N];\nint max(int x,int y) {return x>y?x:y;}\nint main()\n{\n    scanf(\"%d%d%d%d%d\\n\",&n,&m,&x0,&y0,&K);\n    for(int i=1;i<=n;i++)\n    {\n        for(int j=1;j<=m;j++) scanf(\"%c\",&map[i][j]);\n        scanf(\"\\n\");\n    }\n    for(int i=1;i<=K;i++) scanf(\"%d%d%d\",&fr[i],&to[i],&d[i]);\n    int c=0;\n    memset(f[c],-1,sizeof f[c]);\n    f[c][x0][y0]=0;\n    for(int t=1;t<=K;t++)\n    {\n        c^=1;\n        memset(f[c],-1,sizeof f[c]);\n        int dx,dy;\n        if(d[t]==1) dx=-1,dy=0;\n        if(d[t]==2) dx=1,dy=0;\n        if(d[t]==3) dx=0,dy=-1;\n        if(d[t]==4) dx=0,dy=1; \n        for(int x=1;x<=n;x++)\n            for(int y=1;y<=m;y++)\n            {\n                if(f[c^1][x][y]==-1) continue;\n                for(int k=0;k<=to[t]-fr[t]+1;k++)\n                {\n                    int i=x+k*dx,j=y+k*dy;\n                    if(i<1 || n<i || j<1 || m<j || map[i][j]=='x') break;\n                    f[c][i][j]=max(f[c][i][j],f[c^1][x][y]+k);\n                }\n            }\n    }\n    int ans=0;\n    for(int i=1;i<=n;i++)\n        for(int j=1;j<=m;j++)\n            ans=max(ans,f[c][i][j]);\n    printf(\"%d\",ans);\n    return 0;\n}\n```\n\u4e0b\u9762\u6765\u8bf4\u8bf4\u6b63\u89e3 \u5f53\u7136\u662f \u5355\u8c03\u961f\u5217\u4f18\u5316\u7684dp\u4e86\n\n\u5bf9\u4e8e\u6bcf\u4e00\u884c\u6bcf\u4e00\u5217\u6211\u90fd\u505a\u5355\u8c03\u961f\u5217 \u7ef4\u62a4\u533a\u95f4\u6700\u5927\u503c \u5f53\u961f\u9996\u5143\u7d20\u5927\u4e8e\u6211\u80fd\u591f\u63a5\u53d7\u7684\u957f\u5ea6\u65f6\u9000\u51fa\n\n\u5faa\u73af \u5bf9\u4e8e\u6bcf\u4e2a\u72b6\u6001 \u5faa\u73af\u6574\u5f20\u56fe \u7136\u540e\u4ece\u8981\u6c42\u7684\u90a3\u4e2a\u65b9\u5411\u5f00\u59cb\u8f6c\u79fb f[i][j]=max f[i][1~j]+\u8ddd\u79bb\uff08\u5355\u8c03\u961f\u5217\u7ef4\u62a4\uff09\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define N 220\nusing namespace std;\ninline char gc(){\n    static char now[1<<16],*S,*T;\n    if (T==S){T=(S=now)+fread(now,1,1<<16,stdin);if (T==S) return EOF;}\n    return *S++;\n}\ninline int read(){\n    int x=0,f=1;char ch=gc();\n    while (ch<'0'||ch>'9') {if (ch=='-') f=-1;ch=gc();}\n    while (ch<='9'&&ch>='0'){x=x*10+ch-'0';ch=gc();}\n    return x*f;\n}\nstruct node{\n    int d,t;\n}data[N];\nstruct node1{\n    int pos,x;\n};\nchar map[N][N];int n,m,x,y,kk,f[N][N];\nnode1 q[N];\nint main(){\n    freopen(\"bzoj1499.in\",\"r\",stdin);\n    scanf(\"%d%d%d%d%d\",&n,&m,&x,&y,&kk);\n    for (int i=1;i<=n;++i) scanf(\"%s\",map[i]+1);\n    for (int i=1;i<=kk;++i) {\n        int st=read(),ed=read(),d=read();\n        data[i].t=ed-st+1;data[i].d=d;\n    }memset(f,0xff,sizeof(f));f[x][y]=0;\n    for (int k=1;k<=kk;++k){\n        int op=0,cl=0;\n        if (data[k].d==1){\n            for (int j=1;j<=m;++j){\n                q[0].x=f[n][j];q[0].pos=n; op=0,cl=0;\n                for (int i=n-1;i>=1;--i){\n                    if (map[i][j]=='x') {op=1;cl=0;continue;}\n                    while (q[op].pos-i>data[k].t&&op<=cl) ++op;\n                    while ((q[cl].x==-1||q[cl].x+q[cl].pos-i<f[i][j])&&op<=cl) cl--;\n                    q[++cl].x=f[i][j],q[cl].pos=i; \n                    if (q[op].x!=-1) f[i][j]=q[op].x+q[op].pos-i;\n                }\n            }\n        }\n        if (data[k].d==2){\n            for (int j=1;j<=m;++j){\n                q[0].x=f[1][j];q[0].pos=1; op=0,cl=0;\n                for (int i=2;i<=n;++i){\n                    if (map[i][j]=='x') {op=1;cl=0;continue;}\n                    while (i-q[op].pos>data[k].t&&op<cl) ++op;\n                    while ((q[cl].x==-1||q[cl].x+i-q[cl].pos<f[i][j])&&op<=cl) cl--;\n                    q[++cl].x=f[i][j],q[cl].pos=i; \n                    if (q[op].x!=-1) f[i][j]=q[op].x+i-q[op].pos;\n                }\n            }\n        }\n        if (data[k].d==3){\n            for (int i=1;i<=n;++i){\n                q[0].x=f[i][m];q[0].pos=m; op=0,cl=0;\n                for (int j=m-1;j>=1;--j){\n                    if (map[i][j]=='x') {op=1;cl=0;continue;}\n                    while (q[op].pos-j>data[k].t&&op<cl) ++op;\n                    while ((q[cl].x==-1||q[cl].x+q[cl].pos-j<f[i][j])&&op<=cl) cl--;\n                    q[++cl].x=f[i][j],q[cl].pos=j; \n                    if (q[op].x!=-1) f[i][j]=q[op].x+q[op].pos-j;\n                }\n            }\n        }\n        if (data[k].d==4){\n            for (int i=1;i<=n;++i){\n                q[0].x=f[i][1];q[0].pos=1; op=0,cl=1;\n                for (int j=2;j<=m;++j){\n                    if (map[i][j]=='x') {op=1;cl=0;continue;}\n                    while (j-q[op].pos>data[k].t&&op<cl) ++op;\n                    while ((q[cl].x==-1||q[cl].x+j-q[cl].pos<f[i][j])&&op<=cl) cl--;\n                    q[++cl].x=f[i][j],q[cl].pos=j; \n                    if (q[op].x!=-1) f[i][j]=q[op].x+j-q[op].pos;\n                }\n            }\n        }\n        /*for (int i=1;i<=n;++i){\n            for (int j=1;j<=m;++j) printf(\"%d \",f[i][j]);printf(\"\\n\");\n        }\n        printf(\"%d\\nasdfadsf\\n\",k);*/\n    }int ans=0;\n   /* for (int i=1;i<=n;++i){\n        for (int j=1;j<=m;++j) printf(\"%d \",f[i][j]);printf(\"\\n\");\n    }*/\n    for (int i=1;i<=n;++i)\n        for (int j=1;j<=m;++j) ans=max(ans,f[i][j]);\n    printf(\"%d\",ans);\n    return 0;\n}\n```",
        "postTime": 1509240470,
        "uid": 5037,
        "name": "elijahqi",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P2254 \u3010\u7470\u4e3d\u534e\u5c14\u5179\u3011"
    },
    {
        "content": "[\u6211\u7684\u535a\u5ba2](https://www.cnblogs.com/suxxsfe/p/13113500.html)  \n\nhttps://www.luogu.com.cn/problem/P2254  \nhttps://darkbzoj.tk/problem/1499  \n\n\u5355\u8c03\u961f\u5217\u4f18\u5316dp  \n\u601d\u8def\u611f\u89c9\u6bd4\u8f83\u7b80\u5355\uff0c\u4f46\u4e5f\u8bb8\u662f\u6700\u8fd1\u964d\u667a\u4e25\u91cd\uff0c\u4ee3\u7801\u5b9e\u73b0\u7684\u65f6\u5019\u8fd8\u81ea\u95ed\u4e86\u4e00\u4f1a/kk  \n\n![](https://pic.downk.cc/item/5ee44e23c2a9a83be58dac1f.png)  \n$N,M\\le 200,k\\le 200,T\\le 40000$  \n\n-------------------  \n\n\u53d1\u73b0\u533a\u95f4\u4e2a\u6570\u6bd4\u8f83\u5c0f\uff0c\u53ef\u4ee5\u8003\u8651\u4ece $k$ \u5f00\u59cb\u5165\u624b\uff0c\u4e5f\u5c31\u662f\u6328\u4e2a\u8003\u8651\u6bcf\u4e2a\u65f6\u95f4\u533a\u95f4\u7684\u60c5\u51b5\u6765\u8f6c\u79fb  \n\u56e0\u4e3a\u6bcf\u4e2a\u533a\u95f4\u5185\u503e\u659c\u65b9\u5411\u76f8\u540c\uff0c\u4e5f\u5c31\u662f\u8fd9\u6bb5\u65f6\u95f4\u5185\u53ea\u80fd\u5f80\u4e00\u4e2a\u65b9\u5411\u8d70\u6216\u4e0d\u8d70  \n\u90a3\u4e48\uff0c$[s,t]$ \u533a\u95f4\uff0c\u5b83\u80fd\u671d\u7740\u5bf9\u5e94\u7684\u503e\u659c\u65b9\u5411\u8d70 $0\\sim t-s+1$ \u6b65  \n\n\u6240\u4ee5\u8bbe $f(now,i,j)$ \u8868\u793a\u5728\u7b2c $now$ \u4e2a\u65f6\u95f4\u533a\u95f4\u7ed3\u675f\u540e\uff0c\u4ee5\u5750\u6807 $(i,j)$ \u4e3a\u7ec8\u70b9\uff0c\u6700\u591a\u79fb\u52a8\u591a\u5c11\u4e2a\u683c\u5b50  \n\u8f6c\u79fb\u7684\u5f0f\u5b50\u4ee5\u5411\u4e0a\u4e3a\u4f8b\uff0c\u90a3\u4e48 $f(now,i,j)$ \u7531 $f(now-1,[i-t+s-1,i],j)$ \u8f6c\u79fb\u6765\uff0c\u5176\u5b83\u65b9\u5411\u5f53\u7136\u4e5f\u90fd\u76f8\u4f3c  \n\n$$f(now,i,j)=\\max_{k=i-t+s-1}^{i} f(now-1,k,j)+(i-k)$$  \n\n\u540e\u9762\u7684 $i-k$ \u5c31\u662f\u5728\u672c\u6b21\u533a\u95f4\u5185\u79fb\u52a8\u7684\u8ddd\u79bb  \n\u4e00\u5f00\u59cb\u8111\u5b50\u50bb\u6389\u5c45\u7136\u76f4\u63a5\u5728\u4ee3\u7801\u91cc\u5199\u6210\u7531 $f(now,[i-t+s-1],j)$ \u8f6c\u79fb\u5230 $f(now,i,j)$ \u3002\u3002\u3002\u3002\u679c\u7136\u8fd8\u662f\u8981\u628a\u8f6c\u79fb\u65b9\u7a0b\u5728\u7eb8\u4e0a\u597d\u597d\u5199\u4e00\u904d\u5728\u5f00\u59cb\u5199\u4ee3\u7801  \n\u7136\u540e\u8fd9\u6837\u505a\u590d\u6742\u5ea6\u662f $O(kn^3)$\uff0c\u8d85\u65f6\uff0c\u8981\u7528\u5355\u8c03\u961f\u5217\u4f18\u5316\u4e00\u4e0b  \n\n\u53d1\u73b0\u5355\u8c03\u961f\u5217\u91cc\u7684\u6570\u662f\u4e00\u76f4\u5728\u53d8\u5316\u7684\uff08\u4e0a\u9762\u8bf4\u7684 $i-k$ \u9020\u6210\u7684\uff09\uff0c\u4e0d\u65b9\u4fbf\u6bd4\u8f83\uff0c\u4f46\u662f\u53ef\u4ee5\u6bd4\u8f83\u5b83\u4eec\u7684\u201c\u76f8\u5bf9\u5927\u5c0f\u201d  \n\u4ec0\u4e48\u610f\u601d\u5462\uff0c\u5c31\u662f\u6bcf\u6b21\u5f80\u5355\u8c03\u961f\u5217\u91cc\u653e\u5165\u7684\u6570\u662f $f(now-1,i,j)+wei$\uff0c\u5e76\u6bcf\u6b21\u8ba9 $wei$ \u51cf\u4e00  \n\u539f\u56e0\uff1a\u8bbe $f(now-1,i,j)=f(now-1,i+1,j)+x$\uff0c\u5982\u679c\u90fd\u8981\u5bf9\u4e00\u4e2a $(p,j)$ \u6765\u8fdb\u884c\u8f6c\u79fb\uff0c\u90a3\u4e48 $f(now-1,i,j)$ \u4f1a\u6bd4 $f(now-1,i+1,j)$ \u8f6c\u79fb\u540e\u7684\u7ed3\u679c\u591a $x+1$  \n\u5f53\u7136\u662f\u56e0\u4e3a $p-i$ \u6bd4 $p-(i+1)$ \u591a\u4e00  \n\n\u6240\u4ee5\u524d\u9762\u7684\u4e00\u4e2a\u6570\u5165\u961f\u7684\u65f6\u5019\uff0c\u8981\u6bd4\u540e\u9762\u7684\u6570\u5165\u961f\u7684\u65f6\u5019\u591a\u52a0\u4e00\u4e2a $1$  \n\u90a3\u4e48\u53d6\u961f\u5217\u4e2d\u6700\u5927\u503c\u7684\u65f6\u5019\uff0c\u4e5f\u4e0d\u80fd\u76f4\u63a5\u7528\u961f\u5217\u7684\u503c\uff08\u90a3\u53ea\u4f53\u73b0\u4e86\u76f8\u5bf9\u7684\u5927\u5c0f\uff09\uff0c\u800c\u662f\u7528\u6700\u5927\u503c\u5bf9\u5e94\u7684\u4e0b\u6807\uff08\u8bbe\u5176\u4e3a $ind$\uff09  \n\u5219 $f(now,i,j)=f(now-1,ind,j)+(i-ind)$  \n\n\u6240\u4ee5\u590d\u6742\u5ea6\u5c31\u662f $O(kn^2)$ \u4e86  \n\n\u4ee3\u7801\uff0c~~\u540c\u4e00\u51fd\u6570\u590d\u5236\u56db\u904d~~\uff0c\u4e0d\u8fc7\u611f\u89c9\u8fd9\u6837\u770b\u8d77\u6765\u4f3c\u4e4e\u6bd4\u901a\u8fc7\u4e0d\u540c\u53c2\u6570\u8c03\u7528\u540c\u4e00\u51fd\u6570\u6765\u5b9e\u73b0\u8212\u670d\uff0c\u4e5f\u66f4\u597d\u5199  \n\n```cpp  \n#include<cstdio>\n#include<algorithm>\n#include<iostream>\n#include<cmath>\n#include<map>\n#include<iomanip>\n#include<cstring>\n#define reg register\n#define EN std::puts(\"\")\n#define LL long long\ninline int read(){\n\tregister int x=0;register int y=1;\n\tregister char c=std::getchar();\n\twhile(c<'0'||c>'9'){if(c=='-') y=0;c=std::getchar();}\n\twhile(c>='0'&&c<='9'){x=x*10+(c^48);c=std::getchar();}\n\treturn y?x:-x;\n}\ninline int abs(int x){return x>0?x:-x;}\nint head,tail;\nint num[205],ind[205];\ninline void push(int x,int index,int len){\n\twhile(tail<=head&&num[head]<=x) head--;\n\tnum[++head]=x;ind[head]=index;\n\twhile(tail<=head&&abs(index-ind[tail])>len) tail++;\n}\nint n,m;\nint map[205][205];\nint f[205][205][205];\nchar ss[205];\n//up,down \u90fd\u662f\u628a i \u653e\u5165\u961f\u5217\u7684 ind\ninline void work1(int now,int len){//up\n\tfor(reg int j=1;j<=m;j++){\n\t\ttail=0;head=-1;\n\t\tf[now][n][j]=std::max(f[now][n][j],f[now-1][n][j]);\n\t\tint wei=12345;\n\t\tpush(f[now-1][n][j]+wei,n,len);wei--;\n\t\tfor(reg int i=n-1;i;i--){\n\t\t\tif(!map[i][j]){\n\t\t\t\ttail=0;head=-1;wei--;\n\t\t\t\tpush(-1e9,i,len);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tpush(f[now-1][i][j]+wei,i,len);wei--;\n\t\t\t\tf[now][i][j]=std::max(f[now][i][j],f[now-1][ind[tail]][j]+abs(i-ind[tail]));\n\t\t\t}\n\t\t}\n\t}\n}\ninline void work2(int now,int len){//down\n\tfor(reg int j=1;j<=m;j++){\n\t\ttail=0;head=-1;\n\t\tf[now][1][j]=std::max(f[now][1][j],f[now-1][1][j]);\n\t\tint wei=12345;\n\t\tpush(f[now-1][1][j]+wei,1,len);wei--;\n\t\tfor(reg int i=2;i<=n;i++){\n\t\t\tif(!map[i][j]){\n\t\t\t\ttail=0;head=-1;wei--;\n\t\t\t\tpush(-1e9,i,len);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tpush(f[now-1][i][j]+wei,i,len);wei--;\n\t\t\t\tf[now][i][j]=std::max(f[now][i][j],f[now-1][ind[tail]][j]+abs(i-ind[tail]));\n\t\t\t}\n\t\t}\n\t}\n}\n//left,right \u90fd\u662f\u628a j \u653e\u5165\u961f\u5217\u7684 ind\ninline void work3(int now,int len){//left\n\tfor(reg int i=1;i<=n;i++){\n\t\ttail=0;head=-1;\n\t\tf[now][i][m]=std::max(f[now][i][m],f[now-1][i][m]);\n\t\tint wei=12345;\n\t\tpush(f[now-1][i][m]+wei,m,len);wei--;\n\t\tfor(reg int j=m-1;j;j--){\n\t\t\tif(!map[i][j]){\n\t\t\t\ttail=0;head=-1;wei--;\n\t\t\t\tpush(-1e9,j,len);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tpush(f[now-1][i][j]+wei,j,len);wei--;\n\t\t\t\tf[now][i][j]=std::max(f[now][i][j],f[now-1][i][ind[tail]]+abs(j-ind[tail]));\n\t\t\t}\n\t\t}\n\t}\n}\ninline void work4(int now,int len){//right\n\tfor(reg int i=1;i<=n;i++){\n\t\ttail=0;head=-1;\n\t\tf[now][i][1]=std::max(f[now][i][1],f[now-1][i][1]);\n\t\tint wei=12345;\n\t\tpush(f[now-1][i][1]+wei,1,len);wei--;\n\t\tfor(reg int j=2;j<=m;j++){\n\t\t\tif(!map[i][j]){\n\t\t\t\ttail=0;head=-1;wei--;\n\t\t\t\tpush(-1e9,j,len);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tpush(f[now-1][i][j]+wei,j,len);wei--;\n\t\t\t\tf[now][i][j]=std::max(f[now][i][j],f[now-1][i][ind[tail]]+abs(j-ind[tail]));\n\t\t\t}\n\t\t}\n\t}\n}\nint main(){\n\tn=read();m=read();int sx=read(),sy=read();\n\treg int k=read(),s,t,d;\n\tfor(reg int i=1;i<=n;i++){\n\t\tstd::scanf(\"%s\",ss+1);\n\t\tfor(reg int j=1;j<=m;j++) map[i][j]=(ss[j]=='.');\n\t}\n\tfor(reg int aa=0;aa<=k;aa++)\n\t\tfor(reg int i=0;i<=n;i++)for(reg int j=0;j<=m;j++) f[aa][i][j]=-1e9;\n\tf[0][sx][sy]=0;\n\tfor(reg int i=1;i<=k;i++){\n\t\ts=read();t=read();d=read();\n\t\tif(d==1) work1(i,t-s+1);//up\n\t\telse if(d==2) work2(i,t-s+1);//down\n\t\telse if(d==3) work3(i,t-s+1);//left\n\t\telse work4(i,t-s+1);//right\n\t}\n\tint ans=0;\n\tfor(reg int i=1;i<=n;i++)for(reg int j=1;j<=m;j++) ans=std::max(ans,f[k][i][j]);\n\tstd::printf(\"%d\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1592022763,
        "uid": 164432,
        "name": "suxxsfe",
        "ccfLevel": 9,
        "title": "P2254 [NOI2005]\u7470\u4e3d\u534e\u5c14\u5179"
    },
    {
        "content": "## \u6b64\u9898\u5355\u8c03\u961f\u5217\u4f18\u5316dp\n\n\u7531\u9898\u610f\u539f\u6765\u7684\u8f6c\u79fb\u65b9\u7a0b\u662f\n\n```cpp\ndp[t][x][y]=max(dp[t][x][y],dp[t-k][x-k][y]+k);//k\u662f\u79fb\u52a8\u65f6\u95f4,\u8fd9\u662fx\u65b9\u5411\u4e0a\u8d70(\u4e0a,\u4e0b)\n```\n\n\u540c\u7406\u6709\n\n```cpp\ndp[t][x][y]=max(dp[t][x][y],dp[t-k][x][y-k]+k);//\u5de6,\u53f3\n\n```\n\u4f46\u663e\u7136\u8d85\u65f6,\u6ce8\u610f\u5230\u4e00\u4e2a\u65f6\u95f4\u6bb5\u5185\u53ea\u80fd\u5f80\u4e00\u4e2a\u65b9\u5411\u79fb\u52a8\uff0c\u4e8e\u662f\uff0c\u53ef\u4ee5\u91c7\u7528\u76f8\u5bf9\u7684\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u628a t\u4e0et-k\u7b80\u5316\u8868\u793a\u6210\u4e00\u6bb5\u65f6\u95f4.\u6709\n\n```cpp\ndp[t][x][y]=for  max(dp[t-1][x1][y1]+x-x1);//x1,y1\u662f\u5408\u6cd5\u7684,t-1\u662f\u4e0a\u4e00\u4e2a\u65f6\u95f4\u6bb5\n```\n\u4e0b\u9762\u53c2\u6570\u5206\u79bb\n\n```cpp\ndp[t][x][y]=for  max(dp[t-1][x1][y1]-x1)+x;//x1,y1\u662f\u5408\u6cd5\u7684,t-1\u662f\u4e0a\u4e00\u4e2a\u65f6\u95f4\u6bb5\n```\n\u8fd8\u662f\u8d85\u65f6,\u4e0a\u9762dp[t-1][x1][y1]-x1\u53ea\u6709x1\u4e00\u4e2a\u672a\u77e5\u91cf,\u4e14\u53ea\u53d6\u6700\u5927,\u8fd8\u6709\u8303\u56f4,\u7c7b\u4f3cslide window,\u6545\u7528\u4e0a\u5355\u8c03\u961f\u5217\n\n\n**AC\u4ee3\u7801\u5982\u4e0b**\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int M=205;\nint n,m,x,y,k;\nint dx[]={0,-1,1,0,0};\nint dy[]={0,0,0,-1,1};\nint dp[2][M][M],cur;\nint q[M],v[M];\nchar mp[M][M];\nvoid dfs(int x,int y,int n,int len,int dir){\n\tint l=1,r=0;\n\tfor(int i=1;i<=n;i++){//\u679a\u4e3e\u5217 \n\t\tif(mp[x][y]!='x') {\n\t\t\tint tem=dp[!cur][x][y]+n-i;\n\t\t\twhile(r>=l&&tem>v[r]) r--;//\u8f6e\u884c\u5355\u8c03\u5bf9\u5217,\u5355\u8c03\u6027 \n\t\t\tv[++r]=tem;\n\t\t\tq[r]=i;/\u5728\u66f4\u65b0\u524d\u628a\u539f\u6765\u7684\u503c\u653e\u8fdb\u5355\u8c03\u961f\u5217\u91cc\n\t\t\twhile(i-q[l]>len) l++; //\u5982\u679c\u5728\u7ed9\u5b9a\u65f6\u95f4\u5185\u6ed1\u4e0d\u5230\uff0c\u4f5c\u5e9f,\u51fa\u6765\n\t\t\tdp[cur][x][y]=v[l]+i-n;\n\t\t} else l=r+1;\n\t\tx+=dx[dir];\n\t\ty+=dy[dir];\n\t}\n}\nint main() {\n\tmemset(dp,-0x7f,sizeof(dp));\n\tscanf(\"%d%d%d%d%d\",&n,&m,&x,&y,&k);\n\tfor(int i=1;i<=n;i++) scanf(\"%s\",mp[i]+1);\n\tdp[cur][x][y]=0;\n\tfor(int i=1,l,r,dir;i<=k;i++) {\n\t\tscanf(\"%d%d%d\",&l,&r,&dir);cur^=1;\n\t\tif(dir==1) for(int j=1;j<=m;j++) dfs(n,j,n,r-l+1,dir);\n\t\tif(dir==2) for(int j=1;j<=m;j++) dfs(1,j,n,r-l+1,dir);\n\t\tif(dir==3) for(int j=1;j<=n;j++) dfs(j,m,m,r-l+1,dir);\n\t\tif(dir==4) for(int j=1;j<=n;j++) dfs(j,1,m,r-l+1,dir);\n\t}\n\tint ans=-1;\n    for(int i=1;i<=n;i++)\n        for(int j=1;j<=m;j++)\n\t\t\tans=max(ans,dp[cur][i][j]);\n    printf(\"%d\\n\",ans);\n\treturn 0;\n}\n\n\n```\n\n",
        "postTime": 1583335060,
        "uid": 251809,
        "name": "wick",
        "ccfLevel": 5,
        "title": "\u7470\u4e3d\u534e\u5c14\u5179"
    },
    {
        "content": "# $NOI[2005]$\u7470\u4e3d\u7684\u534e\u5c14\u5179 \u89e3\u9898\u62a5\u544a\n\n\u6807\u7b7e\uff1a\u5355\u8c03\u961f\u5217\u4f18\u5316DP\n\n---\n\n\u200b\t\u8bbe$f[k][i][j]$\u8868\u793a\u5728\u7b2c $k$\u6bb5,\u4f4d\u7f6e\u5728$[i,j]$\u65f6\u6240\u80fd\u8fbe\u5230\u6bb5\u6700\u957f\u8ddd\u79bb\uff0c\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u5c31\u5f88\u660e\u663e\u4e86\uff1a\n$f[k][i][j]=max\\{f[k-1][i][j],f[k][i'][j']+dis(i,i',j,j')\\}$(i',j'\u4e3a\u4e0a\u4e00\u4e2a\u5408\u6cd5\u7684\u4f4d\u7f6e)\n\u200b\t\u53ef\u662f\uff0c\u770b\u770b\u6570\u636e\u8303\u56f4\uff1a\n\n\u200b\t$50$%\u7684\u6570\u636e\u4e2d\uff0c$1\u2264N,M\u2264200,T\u2264200$\uff1b\n\n\u200b\t$100$%\u7684\u6570\u636e\u4e2d\uff0c$1\u2264N,M\u2264200,K\u2264200,T\u226440000$\n\n\u200b    \u5f88\u660e\u663e$TLE\\&\\&MLE$\u90a3\u4e48\uff0c\u5f00\u59cb\u4f18\u5316\uff0c\u6eda\u52a8\u6570\u7ec4$\\&\\&$\u5355\u8c03\u961f\u5217\u5206\u522b\u89e3\u51b3$MLE$\u548c$TLE$\u3002\n\n\u200b    \u5355\u8c03\u961f\u5217\u4f18\u5316\u7684\u65f6\u5019\uff0c\u9047\u5230\u969c\u788d\u76f4\u63a5\u6e05\u7a7a\u5373\u53ef.\n\n----------\n\n```cpp\n    #include<bits/stdc++.h>\n    using namespace std;\n    typedef long long ll;\n    #define re register int\n    #define il inline\n    #define RE register\n    #define f(a,b,c) for(register int a=b;a<=c;a++)\n    const int N=205,inf=1e9;\n    il int read()\n    {\n        re a=0,b=1;char c=getchar();\n        while(c<'0'||c>'9'){if(c=='-')b=-1;c=getchar();}\n        while(c>='0'&&c<='9'){a=(a<<3)+(a<<1)+(c^48);c=getchar();}\n        return a*b;\n    }\n    using namespace std;\n    int n,m,sx,sy,k,ans=-inf,dp[N][N];\n    int xx[5]={0,-1,1,0,0},yy[5]={0,0,0,-1,1}; \n    struct node{int dp,pos;}q[N]; \n    int mp[N][N];\n    il void fyy(int x,int y,int len,int d)//\u7b2ck\u4e2a\u533a\u95f4\u7684\u65f6\u957f\u4e3alen,\u65b9\u5411\u4e3ad,\u8d77\u70b9\u5750\u6807[x,y]\n    {\n       re head=1,tail=0;\n       for(re i=1;x>=1&&x<=n&&y>=1&&y<=m;i++,x+=xx[d],y+=yy[d])\n           if(!mp[x][y])head=1,tail=0;\n           else\n           {\n               while(head<=tail&&q[tail].dp+i-q[tail].pos<dp[x][y])tail--;//\u5355\u8c03\u9012\u51cf\n               q[++tail]=node{dp[x][y],i};//\u5408\u6cd5\uff0c\u5165\u961f\n               if(q[tail].pos-q[head].pos>len)head++;//\u8d85\u51fa\u957f\u5ea6\uff0c\u51fa\u961f\n               dp[x][y]=q[head].dp+i-q[head].pos;//\u8f6c\u79fb\n               ans=max(ans,dp[x][y]);//\u66f4\u65b0\u7b54\u6848\n           }\n    }\n    int main()\n    {\n\t\tfreopen(\"1.in\",\"r\",stdin);\n\t\tn=read(),m=read(),sx=read(),sy=read(),k=read();\n        f(i,1,n)\n\t    {\n\t\t   string S;cin>>S;\n\t\t   f(j,0,m-1)\n\t\t\t   if(S[j]=='.') mp[i][j+1]=1;\n\t\t\t   else mp[i][j+1]=0;\n\t    }\n        memset(dp,0xf3,sizeof(dp));\n        dp[sx][sy]=0;\n\t    f(j,1,k)\n        {\n            re l=read(),r=read(),d=read();\n            if(d==1) f(i,1,m) fyy(n,i,r-l+1,d);\n            if(d==2) f(i,1,m) fyy(1,i,r-l+1,d);\n            if(d==3) f(i,1,n) fyy(i,m,r-l+1,d);\n            if(d==4) f(i,1,n) fyy(i,1,r-l+1,d);\n        }\n\t\tcout<<ans<<endl;\n        return 0;\n    }\n\n}\n```",
        "postTime": 1573005642,
        "uid": 135597,
        "name": "\uff0d\uff5c\uff0d",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2254 \u3010[NOI2005]\u7470\u4e3d\u534e\u5c14\u5179\u3011"
    },
    {
        "content": "\u8003\u8651$DP$\uff0c\u5148\u8003\u8651\u4e00\u4e2a\u4f4d\u7f6e\u505c\u6216\u4e0d\u505c\uff0c\u505c\u8bb0\u4e3a$0$\uff0c\u4e0d\u505c\u8bb0\u4e3a$1$\uff0c\u663e\u7136\u53ef\u4ee5\u5f97\u5230\n\n$f[t][i][j][0] = max(f[t][i - op[t][0]][j - op[t][1]][0], f[t][i - op[t][0]][j - op[t][1]][1]) + 1;$\n\n$f[t][i][j][1] = max(f[t][i][j][0], f[t][i][j][1]);$\n\n\u5176\u4e2d$op[][0]$\u4e3a$x$\u65b9\u5411\u4e0a\u79fb\u52a8\u7684\u65b9\u5411\uff0c$op[][1]$\u4e3a$y$\u65b9\u5411\u4e0a\u79fb\u52a8\u7684\u65b9\u5411\n\n\u7b80\u5316\u4e00\u4e0b\u5373 $f[t][i][j] = max(f[t][i - op[t][0]][j - op[t][1]] + 1, f[t][i][j]);$\n\n\u6b64\u65f6\u590d\u6742\u5ea6\u4e3a$\\Theta(Tn^2)$\uff0c\u53ef\u4ee5\u53d6\u5f9750\u5206\n\n\u8003\u8651\u5229\u7528\u8fde\u7eed\u7684$k$\u4f18\u5316,\u679a\u4e3e\u8d70\u7684\u6b65\u6570$A$\n\n$f[k][i][j] = max(f[k - 1][i - A * op[k][0]][j - A * op[k][1]]) + A * op[k][0] + A * op[k][1];$\n\u6b64\u65f6\u590d\u6742\u5ea6\u4e3a$\\Theta(kN ^ 3)$\n\n\u6ce8\u610f\u5230\u6b64\u65f6\u7684\u65b9\u7a0b\u5df2\u7ecf\u662f\u4e00\u4e2a$f[i]=max(f[j])+w$\u7684\u5f62\u5f0f\uff0c\u5177\u6709\u5355\u8c03\u6027\uff0c\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u4f18\u5316\u3002\u6d88\u6389$A$\u90a3\u4e00\u7ef4\uff0c\u590d\u6742\u5ea6$\\Theta(kN^2)$\uff0c\u5df2\u7ecf\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\n$\\large Code :$\n\n```cpp\nconst int dx[] = { 0,-1,1,0,0 }, dy[] = { 0,0,0,-1,1 };\nint s[201], t[201], dir[201], f[201][201], ans, n, m, px, py, K;\nbool g[201][201];\ndeque<pair<int, int>>q;\ninl void calc(int x, int y, int len, int op) {\n\tq.clear();\n\tfor (re A = 1; x >= 1 && x <= n && y >= 1 && y <= m; A++, x += dx[op], y += dy[op]) {\n\t\tif (g[x][y]) { q.clear(); continue; }\n\t\twhile (q.size() && f[x][y] >= q.back().second + A - q.back().first)q.pop_back();\n\t\tq.push_back(make_pair(A, f[x][y]));\n\t\twhile (q.back().first - q.front().first > len)q.pop_front();\n\t\tf[x][y] = q.front().second + A - q.front().first;\n\t\tans = max(ans, f[x][y]);\n\t}\n\treturn;\n}\nsigned main() {\n\tn = read<int>(), m = read<int>(), px = read<int>(), py = read<int>(), K = read<int>();\n\tmemset(f, ~0x3f, sizeof(f));\n\tf[px][py] = 0;\n\tfor (re i = 1; i <= n; i++) {\n\t\tfor (re j = 1; j <= m; j++) {\n\t\t\tchar c = getchar();\n\t\t\twhile (c != '.'&&c != 'x')c = getchar();\n\t\t\tg[i][j] = (c == 'x');\n\t\t}\n\t}\n\tfor (re i = 1; i <= K; i++) s[i] = read<int>(), t[i] = read<int>(), dir[i] = read<int>();\n\tfor (re k = 1; k <= K; k++) {\n\t\tswitch (dir[k]) {\n\t\tcase 1: {\n\t\t\tfor (re i = 1; i <= m; i++) calc(n, i, t[k] - s[k] + 1, 1);\n\t\t\tbreak;\n\t\t}\n\t\tcase 2: {\n\t\t\tfor (re i = 1; i <= m; i++) calc(1, i, t[k] - s[k] + 1, 2);\n\t\t\tbreak;\n\t\t}\n\t\tcase 3: {\n\t\t\tfor (re i = 1; i <= n; i++) calc(i, m, t[k] - s[k] + 1, 3);\n\t\t\tbreak;\n\t\t}\n\t\tcase 4: {\n\t\t\tfor (re i = 1; i <= n; i++) calc(i, 1, t[k] - s[k] + 1, 4);\n\t\t\tbreak;\n\t\t}\n\t\t}\n\t}\n\twriteln(ans);\n}\n/*f[k][i][j] = max(f[k - 1][i - A * op[k][0]][j - A * op[k][1]]) + A * op[k][0] + A * op[k][1];*/\n```\n\n",
        "postTime": 1570711777,
        "uid": 110271,
        "name": "Genius_Z",
        "ccfLevel": 0,
        "title": "P2254 \u7470\u4e3d\u534e\u5c14\u5179"
    },
    {
        "content": "\u6211\u4eec\u770b\u5230\u8fd9\u9898\uff0c\u663e\u7136\u7206\u641c\u8fc7\u4e0d\u6389\uff0c\u5c31\u53ef\u4ee5\u53bb\u8003\u8651DP\u4e86\u3002\n\n\u628a\u6240\u6709\u72b6\u6001\u585e\u8fdb\u53bb\u5f97\u5230\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$dp_{i,x,y}$\u8868\u793a\u5728\u7b2c$i$\u4e2a\u65f6\u95f4\u6bb5\uff0c\u94a2\u7434\u505c\u5728$(x,y)$\u4f4d\u7f6e\u65f6\uff0c\u6ed1\u884c\u7684\u6700\u957f\u8ddd\u79bb\u3002\n\n\u5bf9\u4e8e$d=1$\uff0c$dp_{i,x,y}=\\max\\limits_{0 \\leq k \\leq t_i-s_i+1}dp_{i-1,x+k,y}+k$\uff1b\u5176\u4f59\u60c5\u51b5\u7c7b\u4f3c\u3002\n\n\u663e\u7136\uff0c\u8fd9\u662f\u4e00\u4e2a3D/1D\u7684\u8f6c\u79fb\u65b9\u7a0b\uff0c\u6700\u574f\u590d\u6742\u5ea6\u4e3a$\\Theta(200^4)\u2248\\Theta(1.6 \\times 10^9)$\uff0c\u663e\u7136TLE\u3002\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u5e94\u8be5\u628a\u8f6c\u79fb\u65b9\u7a0b\u53d8\u5f62\u4e3a\u5982\u4e0b\u5f62\u5f0f\uff1a\n\n$dp_{i,x,y}=\\max \\limits_{x \\leq k \\leq x+t_i-s_i+1}dp_{i-1,k,y}+k-x$\n\n\u663e\u7136\uff0c\u968f\u7740$x$\u7684\u53d8\u5316\uff0c\u51b3\u7b56\u533a\u95f4\u662f\u5355\u8c03\u7684\uff0c\u4e8e\u662f\u53ef\u4ee5\u7528\u5355\u8c03\u961f\u5217\u4f18\u5316\u3002\n\n\u51c6\u786e\u5730\u8bf4\uff0c\u5bf9\u4e8e$d=1$\uff0c\u6211\u4eec\u5728\u8f6c\u79fb$dp_{i,x,y}$\u65f6\uff0c\u5c06\u6240\u6709$>x+t_i-s_i+1$\u7684\u51b3\u7b56\u51fa\u961f\uff0c\u7528\u961f\u9996\u51b3\u7b56\u8f6c\u79fb$dp_{i,x,y}$\uff0c\u6700\u540e\u5c06$x$\u5165\u961f\uff0c\u6ce8\u610f\u5165\u961f\u7684\u65f6\u5019\u8981\u7ef4\u62a4\u4e00\u4e0b\u5355\u8c03\u961f\u5217\u3002\u53e6\u5916\u8981\u52a0\u4e0a\u7279\u5224\uff1a\u5982\u679c$(x,y)$\u4e3a\u969c\u788d\uff0c\u5219\u76f4\u63a5\u6e05\u7a7a\u961f\u5217\uff0c\u7136\u540e\u53bb\u8003\u8651\u4e0b\u4e00\u4e2a\u3002 \n\n\u6ce8\u610f\u5904\u74061\u548c3\u65f6\u8981\u5012\u7740\u5faa\u73af\uff0c\u5904\u74062\u548c4\u65f6\u5019\u8981\u6b63\u7740\u5faa\u73af\uff0c\u5426\u5219\u969c\u788d\u7269\u5c06\u5f88\u96be\u5904\u7406\u3002~~\uff08\u8fd9\u4e00\u70b9\u6211\u4eb2\u8eab\u7ecf\u5386\u8fc7~~\n\n\u6700\u540e\u653e\u4e0a\u5b8c\u6574\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n\u5bf9\u4e8e$d=1$\uff0c$dp_{i,x,y}=\\max \\limits_{x \\leq k \\leq x+t_i-s_i+1}dp_{i-1,k,y}+k-x$\uff1b\n\n\u5bf9\u4e8e$d=2$\uff0c$dp_{i,x,y}=\\max \\limits_{x-t_i+s_i-1 \\leq k \\leq x}dp_{i-1,k,y}+x-k$\uff1b\n\n\u5bf9\u4e8e$d=3$\uff0c$dp_{i,x,y}=\\max\\limits_{y \\leq k \\leq y+t_i-s_i+1}dp_{i-1,x,k}+k-y$\uff1b\n\n\u5bf9\u4e8e$d=4$\uff0c$dp_{i,x,y}=\\max\\limits_{y-t_i+s_i-1 \\leq k \\leq y}dp_{i-1,x,k}+y-k$\u3002\n\n\u5b8c\u6574\u4ee3\u7801\uff1a\n\n```cpp\n#include <iostream>\n#include <cmath>\n#include <cstring>\n#include <cstdio>\n#include <queue>\nusing namespace std;\n\nconst int N = 205;\nint n, m, x, y, k, obst[N][N], s[N], t[N], d[N], dp[N][N][N];\ndeque <int> que;\n\n//\u8bfb\u5165\u6570\u636e\nvoid Read() {\n    scanf(\"%d%d%d%d%d\", &n, &m, &x, &y, &k);\n    for (int i = 1;i <= n;i++) {\n        for (int j = 1;j <= m;j++) {\n            char c;\n            cin >> c;\n            if (c == 'x') {\n                obst[i][j] = 1;\n            }\n        }\n    }\n    for (int i = 1;i <= k;i++) {\n        scanf(\"%d%d%d\", &s[i], &t[i], &d[i]);\n    }\n}\n\n//\u6838\u5fc3\u4ee3\u7801\uff0c\u5bf9\u6bcf\u4e00\u4e2a\u65f6\u95f4\u6bb5\u6267\u884cDP\nvoid Dp(int idx) {\n    switch (d[idx]) {//\u65b9\u5411\u5206\u5f00\u5904\u7406\uff0c\u5bf9\u4e8e1\u548c2\uff0ci\u4e3a\u72b6\u6001\uff1b\u5bf9\u4e8e3\u548c4\uff0cj\u4e3a\u72b6\u6001\n        case 1:\n            for (int j = 1;j <= m;j++) {\n                while (!que.empty()) {\n                    que.pop_back();\n                }\n                for (int i = n;i >= 1;i--) {\n                    if (obst[i][j] == 1) {//\u9047\u5230\u969c\u788d\n                        while (!que.empty()) {\n                            que.pop_back();\n                        }//\u6e05\u7a7a\u961f\u5217\n                        dp[idx][i][j] = 0xcfcfcfcf;\n                        continue;//\u4e0b\u4e00\u4e2a\u72b6\u6001\n                    }\n                    //\u8d85\u51fa\u65f6\u95f4\u6bb5\u7684\u72b6\u6001\u51fa\u961f\n                    while (!que.empty() && que.front() > i + t[idx] - s[idx] + 1) {\n                        que.pop_front();\n                    }\n                    //x\u5165\u961f\uff0c\u7ef4\u62a4\u5355\u8c03\u961f\u5217\n                    while (!que.empty() && dp[idx - 1][i][j]\n                         > dp[idx - 1][que.back()][j] + que.back() - i) {\n                        que.pop_back();\n                    }\n                    que.push_back(i);\n                    //\u8f6c\u79fb\n                    dp[idx][i][j] = \n                    max(dp[idx][i][j], dp[idx - 1][que.front()][j] + que.front() - i);\n                }\n            }\n            break;\n        case 2://\u8fd9\u4e9b\u540c\u7406\n            for (int j = 1;j <= m;j++) {\n                while (!que.empty()) {\n                    que.pop_back();\n                }\n                for (int i = 1;i <= n;i++) {\n                    if (obst[i][j] == 1) {\n                        while (!que.empty()) {\n                            que.pop_back();\n                        }\n                        dp[idx][i][j] = 0xcfcfcfcf;\n                        continue;\n                    }\n                    while (!que.empty() && que.front() < i - t[idx] + s[idx] - 1) {\n                        que.pop_front();\n                    }\n                    while (!que.empty() && dp[idx - 1][i][j] > \n                        dp[idx - 1][que.back()][j] + i - que.back()) {\n                        que.pop_back();\n                    }\n                    que.push_back(i);\n                    dp[idx][i][j] = \n                    max(dp[idx][i][j], dp[idx - 1][que.front()][j] + i - que.front());\n                }\n            }\n            break;\n        case 3:\n            for (int i = 1;i <= n;i++) {\n                while (!que.empty()) {\n                    que.pop_back();\n                }\n                for (int j = m;j >= 1;j--) {\n                    if (obst[i][j] == 1) {\n                        while (!que.empty()) {\n                            que.pop_back();\n                        }\n                        dp[idx][i][j] = 0xcfcfcfcf;\n                        continue;\n                    }\n                    while (!que.empty() && que.front() > j + t[idx] - s[idx] + 1) {\n                        que.pop_front();\n                    }\n                    while (!que.empty() && dp[idx - 1][i][j]\n                         > dp[idx - 1][i][que.back()] + que.back() - j) {\n                        que.pop_back();\t\n                    }\n                    que.push_back(j);\n                    dp[idx][i][j] = \n                    max(dp[idx][i][j], dp[idx - 1][i][que.front()] + que.front() - j);\n                }\n            }\n            break;\n        case 4:\n            for (int i = 1;i <= n;i++) {\n                while (!que.empty()) {\n                    que.pop_back();\n                }\n                for (int j = 1;j <= m;j++) {\n                    if (obst[i][j] == 1) {\n                        while (!que.empty()) {\n                            que.pop_back();\n                        }\n                        dp[idx][i][j] = 0xcfcfcfcf;\n                        continue;\n                    }\n                    while (!que.empty() && que.front() < j - t[idx] + s[idx] - 1) {\n                        que.pop_front();\n                    }\n                    while (!que.empty() && dp[idx - 1][i][j]\n                         > dp[idx - 1][i][que.back()] + j - que.back()) {\n                        que.pop_back(); \t\n                    }\n                    que.push_back(j);\n                    dp[idx][i][j] = \n                    max(dp[idx][i][j], dp[idx - 1][i][que.front()] + j - que.front());\n                }\n            }\n            break;\n    }\n}\n\nvoid Solve() {\n    memset(dp, 0xcf, sizeof(dp));\n    dp[0][x][y] = 0;//\u521d\u59cb\u5316dp\u6570\u7ec4\uff0c\u5f88\u597d\u7406\u89e3\n    for (int i = 1;i <= k;i++) {\n        Dp(i);\n    }\n    //\u627e\u5230\u7b54\u6848\n    int ans = 0xcfcfcfcf;\n    for (int i = 1;i <= n;i++) {\n        for (int j = 1;j <= m;j++) {\n            ans = max(ans, dp[k][i][j]);\n        }\n    }\n    printf(\"%d\", ans);\n}\n\nint main() {\n    Read();\n    Solve();\n    return 0;\n}\n```\n\u4e0a\u8ff0\u4ee3\u7801\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$\\Theta(KNM)\u2248\\Theta(10^7)$\uff0c\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\u3002\n\n\u5982\u679c\u6709\u4ec0\u4e48\u95ee\u9898\u8bf7\u79c1\u4fe1\uff0c\u4e0d\u770b\u8bc4\u8bbaqwq",
        "postTime": 1560229099,
        "uid": 61088,
        "name": "Solystic",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2254 \u3010[NOI2005]\u7470\u4e3d\u534e\u5c14\u5179\u3011"
    }
]