[
    {
        "content": "\u6570\u636e\u7ed3\u6784\u597d\u9898\u5462\u3002\n\n\u533a\u95f4 $x\\leftarrow f(x)$ \u5f88\u4e0d\u597d\u505a\uff0c\u7136\u800c\u8fd9\u9053\u9898\u7684\u7a81\u7834\u53e3\u5728\u4e8e $f(x)=\\text{popcount}(x)$ \u5b83\u503c\u57df\u4ec5\u6709 $O(\\log V)$\u3002\n\n\u5f53\u53ea\u6709 `P` \u64cd\u4f5c\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u7ef4\u62a4\u4e00\u7cfb\u5217\u7684\u503c\u57df\u5f88\u5c0f\u7684\u8fde\u7eed\u6bb5\uff0c\u7c7b\u4f3c ODT \u4e00\u6837\u5408\u5e76\u8fde\u7eed\u6bb5\uff0c\u628a\u8fde\u7eed\u6bb5\u4e2a\u6570\u5f53\u6210\u52bf\u80fd\uff0c\u6bcf\u6b21\u64cd\u4f5c\u6700\u591a\u589e\u52a0\u4e24\u4e2a\u8fde\u7eed\u6bb5\uff0c\u6bcf\u6b21\u82b1\u8d39 $O(\\log V)$ \u7684\u4ee3\u4ef7\u52bf\u80fd\u5c31\u4f1a $-1$\uff0c\u603b\u590d\u6742\u5ea6 $O((n+q)\\log V\\alpha(n))$\u3002\n\n\u5177\u4f53\u600e\u4e48\u5408\u5e76\u8fde\u7eed\u6bb5\u5462\uff1f\u53d1\u73b0\u5728\u505a\u8fc7\u4e00\u6b21 $\\text{popcount}$ \u540e\u518d\u505a $\\text{popcount}$ \u76f8\u5f53\u4e8e\u503c\u57df\u590d\u5408\u4e0a\u4e00\u4e2a\u957f\u5ea6\u4e3a $O(\\log V)$ \u7684\u7f6e\u6362\uff0c\u5e76\u67e5\u96c6\u7ef4\u62a4\u3002\n\n\u5f53\u62e5\u6709 `A` \u64cd\u4f5c\u65f6\u4e8b\u60c5\u53d8\u5f97\u590d\u6742\u8d77\u6765\uff0c\u56e0\u4e3a\u4f60\u6bcf\u6b21\u8981\u5bf9\u4e00\u4e2a\u8fde\u7eed\u6bb5\u7684\u533a\u95f4\u6253 tag\uff0c\u4e0d\u77e5\u9053\u53ef\u4e0d\u53ef\u4ee5\u7528\u4e00\u9897\u5e73\u8861\u6811\u53bb\u7ef4\u62a4\u8fde\u7eed\u6bb5\uff0c\u611f\u89c9\u8fd9\u6837\u592a\u590d\u6742\u5c31\u6ca1\u987a\u7740\u8fd9\u4e2a\u601d\u8def\u60f3\u4e0b\u53bb\u3002\n\n\u65e2\u7136\u5e38\u89c4\u505a\u6cd5\u505a\u4e0d\u4e86\u5c31\u53bb\u60f3\u5757\u5757\uff0c\u4f9d\u7136\u8003\u8651\u7ed9\u503c\u57df\u5f88\u5c0f\u7684\u5757\u5757\u6253\u4e0a\u6807\u8bb0\u7ef4\u62a4\u7f6e\u6362\uff0c\u8fd9\u6b21\u6211\u4eec\u53d1\u73b0\u5982\u679c\u7ed9\u5757\u5757\u6253\u52a0\u6cd5\u6807\u8bb0\u53d8\u5f97\u5f88\u5feb\u4e86\uff0c\u4ee3\u4ef7\u662f\u7ef4\u62a4\u7f6e\u6362\u7684\u90e8\u5206\u591a\u4e86\u4e00\u4e2a\u6839\u53f7\uff0c\u5e73\u8861\u4e0b\u590d\u6742\u5ea6\u5927\u6982\u53ef\u4ee5\u505a\u5230 $O(q\\sqrt{n\\log V})$\uff0c\u663e\u7136\u8dd1\u4e0d\u8fc7\u6240\u4ee5\u6ca1\u53bb\u5b9e\u73b0\u3002\n\n\u53d1\u73b0\u6211\u4eec\u4e0a\u8ff0\u505a\u6cd5\u5e76\u6ca1\u6709\u600e\u4e48\u4f9d\u8d56\u5206\u5757\u7684\u6027\u8d28\uff0c\u800c\u4e3b\u8981\u662f\u5728\u201c\u6253\u52a0\u6cd5\u6807\u8bb0\u201d\u548c\u201c\u7ef4\u62a4\u503c\u57df\u5c0f\u7684\u8fde\u7eed\u6bb5\u201d\u4e4b\u95f4\u8fdb\u884c\u5e73\u8861\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u53ef\u4ee5\u6362\u7528\u7ebf\u6bb5\u6811\u3002\u672c\u8d28\u662f\u6211\u4eec\u539f\u6765\u7ef4\u62a4\u6781\u5927\u7684\u201c\u503c\u57df\u5f88\u5c0f\u7684\u6bb5\u201d\uff0c\u73b0\u5728\u5f3a\u884c\u628a\u5b83\u5288\u6210\u7ebf\u6bb5\u6811/\u5206\u5757\u7684\u5f62\u6001\u65b9\u4fbf\u6211\u4eec\u6253\u52a0\u6cd5\u6807\u8bb0\u3002\n\n\u5177\u4f53\u5730\u6765\u8bf4\uff0c\u6211\u4eec\u8fd9\u6b21\u7ed9\u7ebf\u6bb5\u6811\u7684\u4e00\u4e9b\u8282\u70b9\u6253\u4e0a\u201c\u7ec8\u6b62\u6807\u8bb0\u201d\uff0c\u4ee3\u8868\u8fd9\u4e2a\u8282\u70b9\u662f\u4e00\u4e2a\u201c\u503c\u57df\u5f88\u5c0f\u7684\u8fde\u7eed\u6bb5\u201d\u3002\u6bcf\u6b21\u627e\u51fa\u82e5\u5e72\u4e2a\u9700\u8981\u88ab\u5408\u5e76\u7684\u8fde\u7eed\u6bb5\uff0c\u66b4\u529b\u5bf9\u91cc\u9762\u7684\u6bcf\u4e00\u4e2a\u503c\u8ba1\u7b97 $\\text{popcount}$\uff0c\u8fd0\u7528\u6807\u8bb0\u6c38\u4e45\u5316\u7684\u601d\u60f3\u628a\u8ba1\u7b97\u51fa\u6765\u7684\u957f\u4e3a $O(\\log V)$ \u7684\u7f6e\u6362\u8bb0\u5728\u8fd9\u4e2a\u70b9\uff0c\u7136\u540e\u628a\u6240\u6709\u9700\u8981\u5408\u5e76\u7684\u8fde\u7eed\u6bb5\u7ebf\u6bb5\u6811\u4e0a\u7684 LCA \u6807\u8bb0\u4e3a\u65b0\u7684\u7ec8\u6b62\u8282\u70b9\u3002\n\n\u8bb0\u7ec8\u6b62\u8282\u70b9\u7684\u4e2a\u6570\u662f\u52bf\u80fd\u3002\u533a\u95f4\u4fee\u6539\u65f6\uff0c\u7ec8\u6b62\u8282\u70b9\u88ab `pushdown` \u4f1a\u6807\u8bb0\u4e24\u4e2a\u65b0\u7684\u7ec8\u6b62\u8282\u70b9\uff0c\u6240\u4ee5\u52bf\u80fd\u603b\u91cf\u662f $O(q\\log n)$ \u7ea7\u522b\u7684\u3002\u6bcf\u6b21\u82b1\u8d39 $O(\\log V)$ \u7684\u4ee3\u4ef7\u5408\u5e76\u4e00\u4e2a\u7ec8\u6b62\u8282\u70b9\uff0c\u6240\u4ee5\u4e24\u79cd\u4fee\u6539\u5747\u644a\u90fd\u662f $O(\\log n\\log V)$ \u7684\u3002\u5355\u70b9\u67e5\u8be2\u6807\u8bb0\u6c38\u4e45\u5316\u4e86\u6240\u4ee5\u662f $O(\\log n)$ \u7684\u3002\n\n```cpp\n#include <cstdio>\n#define lc (p<<1)\n#define rc (p<<1|1)\nusing namespace std;\n//read()\ntypedef long long ll;\nconst int N=300003,Lg=50;\nint n,q;\nint a[N];\nint per[N<<2][Lg];\nll tg[N<<2];\nbool ex[N<<2];\nvoid build(int p=1,int l=1,int r=n){\n\tfor(int i=0;i<Lg;++i) per[p][i]=i;\n\tif(l==r){ex[p]=1;tg[p]=a[l];return;}\n\tex[p]=0;tg[p]=0;\n\tint mid=(l+r)>>1;\n\tbuild(lc,l,mid);\n\tbuild(rc,mid+1,r);\n}\nvoid proc(int p){\n\tfor(int i=0;i<Lg;++i)\n\t\tper[p][i]=__builtin_popcountll(per[p][i]+tg[p]);\n\ttg[p]=0;\n}\nvoid pushdown(int p){\n\tif(ex[p]){\n\t\tfor(int i=0;i<Lg;++i){\n\t\t\tper[lc][i]=per[p][per[lc][i]];\n\t\t\tper[rc][i]=per[p][per[rc][i]];\n\t\t}\n\t\tfor(int i=0;i<Lg;++i) per[p][i]=i;\n\t\tex[lc]=ex[rc]=1;ex[p]=0;\n\t}\n\tif(tg[p]){tg[lc]+=tg[p];tg[rc]+=tg[p];tg[p]=0;}\n}\nvoid upd(int p,int l,int r){\n\tif(ex[p]) return proc(p);\n\tpushdown(p);\n\tint mid=(l+r)>>1;\n\tupd(lc,l,mid);upd(rc,mid+1,r);\n}\nvoid update(int ll,int rr,int p=1,int l=1,int r=n){\n\tif(ll<=l&&r<=rr){upd(p,l,r);ex[p]=1;return;}\n\tpushdown(p);\n\tint mid=(l+r)>>1;\n\tif(ll<=mid) update(ll,rr,lc,l,mid);\n\tif(rr>mid) update(ll,rr,rc,mid+1,r);\n}\nvoid modify(int ll,int rr,int v,int p=1,int l=1,int r=n){\n\tif(ll<=l&&r<=rr){tg[p]+=v;return;}\n\tpushdown(p);\n\tint mid=(l+r)>>1;\n\tif(ll<=mid) modify(ll,rr,v,lc,l,mid);\n\tif(rr>mid) modify(ll,rr,v,rc,mid+1,r);\n}\nll query(int x,int p=1,int l=1,int r=n){\n\tif(l==r) return per[p][0]+tg[p];\n\tint mid=(l+r)>>1;\n\tif(ex[p]){\n\t\tif(x<=mid) return per[p][query(x,lc,l,mid)]+tg[p];\n\t\telse return per[p][query(x,rc,mid+1,r)]+tg[p];\n\t}\n\telse{\n\t\tif(x<=mid) return query(x,lc,l,mid)+tg[p];\n\t\telse return query(x,rc,mid+1,r)+tg[p];\n\t}\n}\nint main(){\n\tn=read();q=read();\n\tfor(int i=1;i<=n;++i) a[i]=read();\n\tbuild();\n\tfor(int i=1;i<=q;++i){\n\t\tchar cc;\n\t\tdo cc=getchar();while(cc<'A'||cc>'Z');\n\t\tif(cc=='A'){\n\t\t\tint l=read(),r=read(),v=read();\n\t\t\tmodify(l,r,v);\n\t\t}\n\t\tif(cc=='P'){\n\t\t\tint l=read(),r=read();\n\t\t\tupdate(l,r);\n\t\t}\n\t\tif(cc=='J') printf(\"%lld\\n\",query(read()));\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1674959529,
        "uid": 163729,
        "name": "yyyyxh",
        "ccfLevel": 7,
        "title": "\u5e7b\u68a6 Sol"
    },
    {
        "content": "\u7531\u4e8e\u53ea\u7528\u652f\u6301\u5355\u70b9\u67e5\u8be2\uff0c\u6211\u4eec\u7ef4\u62a4\u7684\u4fe1\u606f\u53ea\u7528\u652f\u6301\u4fe1\u606f\u5bf9\u4fe1\u606f\u53ef\u7ed3\u5408\uff0c\u4fe1\u606f\u5bf9\u64cd\u4f5c\u5c01\u95ed\u3002\n\n\u8003\u8651\u5982\u4e0b\u4fe1\u606f\uff1a$x\\to f(\\text{popcount}(x+a))+b$ \u6216\u8005 $x\\to x+b$\uff0c\u5176\u4e2d $f$ \u4e3a\u5b9a\u4e49\u57df\u548c\u503c\u57df\u90fd\u662f\u4e0d\u8d85\u8fc7 $64$ \u7684\u6b63\u6574\u6570\u7684\u51fd\u6570\u3002\u663e\u7136\u4e24\u79cd\u64cd\u4f5c\u5747\u4e3a\u5982\u4e0b\u5f62\u5f0f\uff0c\u56e0\u6b64\u53ea\u7528\u518d\u8bc1\u660e\u4fe1\u606f\u5bf9\u4fe1\u606f\u53ef\u7ed3\u5408\u3002\n\n$x+b$ \u5f62\u5f0f\u7684\u4fe1\u606f\u7ed3\u5408\u5230\u6b63\u5e38\u4fe1\u606f\u4e0a\uff0c\u53ea\u7528\u5c06 $b$ \u503c\u52a0\u4e0a\u76f8\u5e94\u7684 $b$ \u503c\uff1b\u4e00\u822c\u7684\u4fe1\u606f\u7ed3\u5408\u5230\u6b63\u5e38\u4fe1\u606f\u4e0a\uff0c\u53ea\u7528\u5c06 $f$ \u53d8\u4e3a $g(\\text{popcount}(f(x)+b))$ \u5373\u53ef\uff0c\u5176\u4e2d $g$ \u662f\u7ed3\u5408\u4e0a\u53bb\u7684\u90a3\u4e2a\u4fe1\u606f\u5bf9\u5e94\u7684 $f$\u3002\n\n```cpp\nstruct data{\n\tbool flg;//x->p(popcount(x+A))+B x->x+B\n\tll a,b;\n\tshort p[64]; \n\tll eval(ll x){\n\t\tif(flg)return p[bpc(x+a)]+b;\n\t\telse return x+b;\n\t}\n}tag[N<<2];\nvoid merge(data &x,data y){\n\tif(!y.flg)x.b+=y.b;\n\telse if(x.flg){\n\t\tvector<int>q(64);\n\t\trep(i,0,63)q[i]=y.p[__builtin_popcountll(x.p[i]+x.b+y.a)];\n\t\trep(i,0,63)x.p[i]=q[i];\n\t\tx.b=y.b;\n\t}\n\telse{\n\t\ty.a+=x.b;\n\t\tx=y;\n\t}\n}\nvoid clear(data &x){\n\tx.flg=0;x.a=x.b=0;\n\trep(i,0,63)x.p[i]=0;\n}\n\n```\n\n[\u5b8c\u6574\u4ee3\u7801](https://www.luogu.com.cn/paste/0ns9pnvq)\u3002",
        "postTime": 1674613512,
        "uid": 254752,
        "name": "JohnVictor",
        "ccfLevel": 6,
        "title": "P8969 \u9898\u89e3"
    },
    {
        "content": "\u521a\u624d\u88ab\u4eba\u55b7   \n![](https://cdn.luogu.com.cn/upload/image_hosting/j6dxakbn.png)   \n\u6240\u4ee5\u5199\u8be6\u7ec6\u4e00\u4e9b\u3002\n\n\u4ee4\u503c\u57df\u4e3a $V$\uff0c\u8003\u8651\u4e00\u4e2a\u6570\u7ecf\u8fc7\u4e00\u6b21 popcount \u64cd\u4f5c\u540e\u503c\u57df\u53ea\u5269 $\\log V$\uff0c\u4e8e\u662f\u53ef\u4ee5\u8003\u8651\u628a\u76f8\u90bb\u4e24\u6b21 popcount \u4e4b\u95f4\u7684\u64cd\u4f5c\u7f29\u8d77\u6765 .\n\n\n\u4e5f\u5c31\u662f\u7ebf\u6bb5\u6811\u6807\u8bb0\u4e0a\u7ef4\u62a4\u4e00\u4e2a $\\log V$ \u957f\u7684\u7f6e\u6362 $f$\uff0c\u4ee5\u53ca\u53c2\u6570 $A,B,p$\uff0c\u8868\u793a\u539f\u6765\u7684 $x$ \u53d8\u6210\u4e86\n$$x'=\\begin{cases}x+B&p=0\\\\f(\\operatorname{popcount}(x+A))+B&p=1\\end{cases}$$\n\u8003\u8651\u8be2\u95ee\u7684\u5f62\u5f0f\u662f\u5355\u70b9\u67e5\u8be2\u4e8e\u662f\u5c31\u53ea\u9700\u8981\u6807\u8bb0\u53ef\u4ee5\u590d\u5408\u8fd0\u7b97\uff08\u4e5f\u5c31\u662f\u53ea\u9700\u8981\u4e0b\u4f20\uff09 .\n\n\u533a\u95f4\u52a0\u76f4\u63a5\u6539 $B$\uff0c\u533a\u95f4 popcount \u53ea\u9700\u904d\u5386\u7f6e\u6362 $f$ \u6c42\u51fa\u503c\u5e76\u66f4\u65b0\u5373\u53ef\uff0c\u9700\u8981\u628a   $B$ \u7684\u8d21\u732e\u7ed9 $A$ .\n\n\u4e8e\u662f\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta((n+q)\\log n\\log nV)$ .\n\nBonus\uff1a\u533a\u95f4\u6c42\u548c\u540c\u65f6\u95f4\u590d\u6742\u5ea6\u505a\u6cd5\uff1f",
        "postTime": 1674565429,
        "uid": 227514,
        "name": "jijidawang",
        "ccfLevel": 0,
        "title": "P8969"
    },
    {
        "content": "\u770b\u5230\u8fd9\u4e2a\u9898\u7684\u9898\u89e3\u90fd\u5f88\u7b80\u7565\uff0c\u6240\u4ee5\u6211\u5199\u8be6\u7ec6\u70b9\u3002\n\n\u9996\u5148\u8fd9\u4e2a $\\operatorname{popcount}$ \u51fd\u6570\u7684\u52bf\u80fd\u6027\u8d28\u662f\u4e0d\u597d\u5206\u6790\u7684\uff0c\u56e0\u4e3a $a\\geq p$ \u65f6  $\\operatorname{popcount}(a)$ \u4e0d\u4e00\u5b9a\u5927\u4e8e $\\operatorname{popcount}(b)$\uff0c \u6240\u4ee5\u53ea\u80fd\u8003\u8651 $\\operatorname{popcount}$ \u7684\u503c\u57df\u4e3a $O(\\log V)$ \u7684\u6027\u8d28\uff0c\n\n\u7ebf\u6bb5\u6811\u7ef4\u62a4\uff0c\u5c06\u64cd\u4f5c\u5206\u4e3a\u82e5\u5e72\u7ebf\u6bb5\uff0c\u63a5\u4e0b\u6765\u5982\u679c\u67d0\u4e2a\u6bb5\u5728\u67d0\u4e2a\u65f6\u523b\u88ab\u6c42\u8fc7\u4e00\u6b21 $\\operatorname{popcount}$\uff0c\u540e\u9762\u65e0\u8bba\u518d\u600e\u4e48\u6574\u6bb5\u5730\u52a0\uff0c\u5b83\u7684\u503c\u90fd\u53ef\u4ee5\u8868\u793a\u6210 $\\operatorname{popcount}( \\dots) + b$ \u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5728\u7ebf\u6bb5\u6811\u4e0a\u7ef4\u62a4\u6807\u8bb0\uff1a\n\n$f(\\operatorname{popcount}(x+a))+b$\uff0c\u5176\u4e2d $f(x)$ \u662f\u4e00\u4e2a \u503c\u57df\u548c\u5b9a\u4e49\u57df\u5747\u4e3a $O(\\log V)$ \u7684\u51fd\u6570\uff0c\u8fd9\u6837\u505a\u7684\u539f\u56e0\u5982\u4e0b\uff1a\n\n\u6211\u4eec\u628a\u64cd\u4f5c\u5e8f\u5217\u5f62\u8c61\u5730\u63cf\u8ff0\u51fa\u6765\uff0c\u52a0\u6cd5\u662f $\\texttt a$\uff0c\u533a\u95f4\u505a $\\operatorname{popcount}$ \u662f $\\texttt p$\uff0c\u90a3\u4e48\u64cd\u4f5c\u5e8f\u5217\u4f8b\u5982\n$$\\texttt{apapppaaapaaa}$$\n\n\u6211\u4eec\u628a\u52a0\u6cd5\u5408\u5e76\u6210\u4e00\u6b21\u518d\u6309\u7167 $p$ \u5206\u6bb5\uff1a\n\n$$\\texttt{ ap| ap | ap | ap | ap | a}$$  \n\n\u5c31\u53d8\u6210\u4e86\u82e5\u5e72\u6b21 $\\operatorname{popcount}(x+b)$ \u7684\u590d\u5408\uff0c\u8fd9\u5c31\u662f\u4e00\u4e2a\u503c\u57df $O(\\log V)$ \u7684\u51fd\u6570\uff0c\u4ece\u7b2c\u4e8c\u6b21\u5f00\u59cb\u5b9a\u4e49\u57df\u4e5f\u53d8\u6210\u4e86 $O(\\log V)$\uff0c\u4e8e\u662f\u6211\u4eec\u76f4\u63a5\u7ef4\u62a4\u7b2c\u4e00\u6b65\u51fd\u6570\u7684\u6837\u5b50\uff0c\u66b4\u529b\u7ef4\u62a4\u7b2c\u4e8c\u6b65\u5f00\u59cb\u4ee5\u53ca\u540e\u9762\u51fd\u6570\u7684\u590d\u5408\uff0c\u5355\u72ec\u8ba1\u7b97\u6700\u540e\u7684\u52a0\u6cd5\u5c31\u53ef\u4ee5\u505a\u5230\u4e86\u3002\n\n\u7eaf\u52a0\u6cd5\u9700\u8981\u5355\u72ec\u8bb0\u5f55\uff0c\u5b83\u7684\u503c\u57df\u4e0d\u540c\u3002\u590d\u5408\u65f6\u4e5f\u9700\u8981\u7279\u5224\u3002\n\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(q\\log n\\log V)$ \uff0c\u53ef\u4ee5\u8dd1\u8fdb 4s\uff0c\u505a\u4e00\u4e9b\u5361\u5e38\u6027\u8d28\u7684\u5904\u7406\uff08\u5982\u5bf9\u4e8e\u533a\u95f4\u957f\u5ea6\u5c0f\u4e8e $3\\log V$ \u7684\u533a\u95f4\uff0c\u518d\u6b21\u4e0b\u4f20\u6807\u8bb0\u662f\u4e0d\u4f18\u79c0\u7684\uff0c\u4e0d\u5982\u66b4\u529b\uff09\u5373\u53ef\u8dd1\u8fdb 2s\uff0c\u76ee\u524d\u6700\u4f18\u89e3\u7b2c\u4e8c\u3002\n",
        "postTime": 1675040916,
        "uid": 161697,
        "name": "\u10e6\ua9bf\u0fd0",
        "ccfLevel": 7,
        "title": "\u3010\u9898\u89e3\u3011P8969 Dream with Dynamic | \u7ebf\u6bb5\u6811 \u601d\u7ef4"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u79cd\u9700\u8981\u5361\u5e38\u7684\u5206\u5757\u5199\u6cd5\u3002\n\n\u9996\u5148\u770b\u5230 $\\operatorname{popcount}$ \u64cd\u4f5c\uff0c\u4fbf\u53ef\u4ee5\u81ea\u7136\u800c\u7136\u7684\u60f3\u5230\u5728\u503c\u57df\u4e0a\u505a\u6587\u7ae0\u3002\n\n\u9996\u5148\u56e0\u4e3a $\\operatorname{popcount} \\leq \\log x$\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u60f3\u5230\u5bf9\u4e8e\u4e00\u4e2a\u5e8f\u5217\u6765\u8bf4\uff0c\u8fdb\u884c\u4e00\u6b21 $\\operatorname{popcount}$ \u64cd\u4f5c\u540e**\u81f3\u591a\u6709** $\\log V$ \u4e2a\u4e0d\u540c\u7684\u6570\u5b57\u3002\n\n\u5e76\u4e14\u5728\u5bf9\u8fd9\u4e2a\u533a\u95f4\u8fdb\u884c**\u5168\u5c40**\u64cd\u4f5c\u65f6\u4e0d\u540c\u6570\u7684\u6570\u91cf**\u4e0d\u589e**\u3002\n\n\u56e0\u6b64\u8003\u8651\u5206\u5757\u3002\n\n\u5757\u5185\u6700\u5f00\u59cb\u7528 $tag$ \u8bb0\u5f55\u52a0\u6cd5\u64cd\u4f5c\u3002\n\n\u5bf9\u4e8e\u5757\u5185\u5982\u679c\u6709\u6574\u5757 $\\operatorname{popcount}$ \u64cd\u4f5c\u5219\u8f6c\u6362\u6210\u8bb0\u5f55\u6bcf\u4e2a\u503c\u90fd\u53d8\u6210\u4e86\u4ec0\u4e48\u3002\n\n\u7531\u4e8e\u6240\u6709\u503c\u4e0d\u5927\u4e8e $\\log V$\uff0c\u6240\u4ee5\u91cf\u7ea7\u662f $\\log V$ \u7684\u3002\n\n\u7c7b\u4f3c\u4e8e\u9608\u503c\u5206\u6cbb\u7684\u601d\u60f3\uff0c\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u4e0d\u540c\u5904\u7406\u3002\n\n\u8fd9\u6837\u505a\u590d\u6742\u5ea6\u662f $O(q \\sqrt n \\log V)$\u3002\n\n\u4f1a\u8d85\u65f6\u3002\n\n\u4e0d\u8fc7\u8fd8\u80fd\u6539\u8fdb\u3002\n\n\u8fd9\u6837\u505a\u5728\u4fdd\u6301\u5206\u5757\u7684\u60c5\u51b5\u4e0b~~\u4e0d\u4f1a\u5199\u7ebf\u6bb5\u6811\u7684\u6807\u8bb0~~\u53ea\u80fd\u6539\u8fdb $\\operatorname{popcount}$\u3002\n\n\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u7528\u81ea\u5e26\u7684\u51fd\u6570\u3002\n\n\u8fd9\u6837\u5199\uff1a\n\n```cpp\ninline int popcount(int n){\n    return __builtin_popcountll(n);\n}\n```\n\n\u7136\u540e\u8003\u8651\u4e00\u4e9b\u4f18\u5316\uff1a\n\n1. \u8bb0\u5f55\u5757\u5185\u6700\u5927\u503c\uff0c\u82e5\u4e3a $1$ \u5219\u8df3\u8fc7 $\\operatorname{popcount}$ \u64cd\u4f5c\u3002\n\n2. \u6bcf\u6b21 $\\operatorname{popcount}$ \u64cd\u4f5c\u540e\u53bb\u91cd\u964d\u4f4e\u540e\u7eed\u64cd\u4f5c\u590d\u6742\u5ea6\u3002\n\n3. \u52a0\u6cd5\u64cd\u4f5c\u5168\u90e8\u5806\u5230 $tag$ \u91cc\uff0c\u4f7f\u5f97\u52a0\u6cd5\u64cd\u4f5c\u590d\u6742\u5ea6\u7a33\u5b9a\u5728 $O(\\sqrt n)$\u3002 \n\n\u5982\u6b64\u518d\u52a0\u4e0a\u4e00\u5b9a\u5361\u5e38\u5c31\u53ef\u4ee5\u8fc7\u4e86\u3002\n\n\u4e0d\u8fc7\u8fd9\u6837\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u8fc7\u5462\uff1f\n\n\u56e0\u4e3a\u8fd9\u4e2a\u51fd\u6570\u5185\u90e8\u7528\u81ea\u5e26\u7684\u8868\u4ee5\u53ca\u4e8c\u5206\u5b9e\u73b0\uff0c\u867d\u7136\u90fd\u662f $\\log$ \u91cf\u7ea7\uff0c\u4f46\u662f\u4e8c\u5206\u7406\u8bba\u4e0a\u5f88\u96be\u8dd1\u6ee1\u3002\n\n\u6240\u4ee5\u590d\u6742\u5ea6\u8fd8\u662f $O(q \\sqrt n \\log V)$\uff0c\u4f46\u662f\u5e38\u6570\u6781\u5c0f\u3002\n\n\u4ee5\u4e0b\u662f\u6bd4\u8f83\u4e11\u7684\u4ee3\u7801\uff0c\u5404\u4f4d\u5927\u4f6c\u8f7b\u55b7\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define max(x,y) (x>y?x:y)\nusing namespace std;\nconst int maxn = 3e5+1000;\nconst int maxw = 1000;\nint B;\nint a[maxn];\nint sum;//\u5757\u7684\u6570\u91cf\ninline int popcount(int n){\n    return __builtin_popcountll(n);\n}\nclass block{\n    public:\n    int l,r;//\u5757\u7684\u8d77\u6b62\u4f4d\u7f6e\n    int flag;//\u662f\u5426\u5df2\u7ecf\u88ab popcount \u8fc7\n    pair<int,int> chifan[maxw];\n    int tot;\n    //popcount \u540e\u5757\u5185\u4e0d\u540c\u5143\u7d20\u6570\u91cf\u81f3\u591a 50 \u4e2a\uff0c\u6240\u4ee5\u66b4\u529b\u8bb0\u5f55\u67e5\u8be2\n    int tag;//\u52a0\u6cd5\u6807\u8bb0\n    void init();//\u521d\u59cb\u5316\n    void maintain();//\u6563\u5757\u91cd\u6784\n    void change();//popcount \u540e\u8f6c\u6362\u8bb0\u5f55\u65b9\u5f0f\n    void add(int x);\n    void Pop();\n}b[maxw];\ninline void block::init(){\n    flag=0;\n    tot=0;\n    tag=0;\n}\nvoid block::maintain(){\n    if(flag==0){\n        for(int i=l;i<=r;++i) a[i]=a[i]+tag;\n        tag=0;\n    }\n    else{\n        map<int,int> lwx;\n        for(int i=1;i<=tot;i++) lwx[chifan[i].first]=chifan[i].second+tag;\n        for(int i=l;i<=r;++i)\n        {\n            a[i]=lwx[a[i]];\n        }\n    }\n    for(int i=1;i<=tot;++i) chifan[i].first=chifan[i].second=0;\n    flag=tot=tag=0;\n}\nvoid block::change(){\n    for(int i=l;i<=r;++i) a[i]=popcount(a[i]+tag);\n    tag=0;\n    flag=1;\n    map<int,int> use;\n    for(int i=l;i<=r;++i){\n        int op=0;\n        if(use[a[i]]==0)\n            chifan[++tot]=make_pair(a[i],a[i]),use[a[i]]=1;\n    }\n}\ninline void block::add(int x){\n    tag+=x;\n}\nvoid block::Pop(){\n    if(flag==0) change();\n    else{\n        int Maxval=0;\n        for(int i=1;i<=tot;i++) Maxval=max(Maxval,chifan[i].second+tag);\n        if(Maxval==1) return ;\n        for(int i=1;i<=tot;++i)\n            chifan[i].second=popcount(chifan[i].second+tag);\n        int f=0;\n        for(int i=2;i<=tot;i++)\n            if(chifan[i].first!=chifan[i-1].first) f=1;\n        if(f==0)\n        {\n            for(int i=2;i<=tot;i++) chifan[i].first=chifan[i].second=0;\n            tot=1;\n        }\n    }\n    tag=0;\n}\nvoid changeA(int l,int r,int x){\n    int bl=l/B+1;\n    if(l-l/B*B==0) bl--;\n    int br=r/B+1;\n    if(r-r/B*B==0) br--;\n    for(int i=bl+1;i<br;++i)\n        b[i].add(x);\n\n    if(bl!=br){\n        b[bl].maintain();\n        b[br].maintain();\n        for(int i=l;i<=b[bl].r;++i) a[i]+=x;\n        for(int i=b[br].l;i<=r;++i) a[i]+=x;\n    }\n    else{\n        b[bl].maintain();\n        for(int i=l;i<=r;i++) a[i]+=x;\n    }\n}\nvoid changeB(int l,int r){\n    int bl=l/B+1;\n    if(l-l/B*B==0) bl--;\n    int br=r/B+1;\n    if(r-r/B*B==0) br--;\n    for(int i=bl+1;i<br;++i)\n        b[i].Pop();\n    \n    if(bl!=br){\n        b[bl].maintain();\n        b[br].maintain();\n        for(int i=l;i<=b[bl].r;++i) a[i]=popcount(a[i]);\n        for(int i=b[br].l;i<=r;++i) a[i]=popcount(a[i]);\n    }\n    else{\n        b[bl].maintain();\n        for(int i=l;i<=r;++i) a[i]=popcount(a[i]);\n    }\n}\nint question(int x){\n    int pos=x/B+1;\n    if(x-x/B*B==0) pos--;\n    if(b[pos].flag==0) return a[x]+b[pos].tag;\n    else{\n        for(int j=1;j<=b[pos].tot;++j)\n            if(a[x]==b[pos].chifan[j].first) return b[pos].chifan[j].second+b[pos].tag;\n    }\n}\ninline int read(){\n\tint x=0,f=1;char ch=getchar();\n\twhile (ch<'0'||ch>'9'){if (ch=='-') f=-1;ch=getchar();}\n\twhile (ch>='0'&&ch<='9'){x=x*10+ch-48;ch=getchar();}\n\treturn x*f;\n}\nvoid write(int x)\n{\n    if(x<0)\n        putchar('-'),x=-x;\n    if(x>9)\n        write(x/10);\n    putchar(x%10+'0');\n    return;\n}\n\nint n,q;\nsigned main(){\n    n=read();\n    q=read();\n    B=sqrt(n);\n    for(int i=1;i<=n;i++){\n        a[i]=read();\n    }\n    for(int i=1;i<=n;i=i+B){\n        b[++sum].l=i;\n        b[sum].r=min(n,i+B-1);\n        b[sum].init();\n    }\n    for(int i=1;i<=q;i++){\n        char op;\n        op=getchar();\n        while(op<'A'||op>'Z')\n        op=getchar();\n        if(op=='A'){\n            int l,r,x;\n           l=read();\n           r=read();\n           x=read();\n            changeA(l,r,x);\n        }\n        else if(op=='P'){\n            int l,r;\n            l=read();\n            r=read();\n            changeB(l,r);\n        }\n        else{\n            int x;\n            x=read();\n            write(question(x));\n            putchar('\\n');\n        }\n    }\n    return 0;\n}\n```",
        "postTime": 1674572222,
        "uid": 520748,
        "name": "_ChiFAN_",
        "ccfLevel": 4,
        "title": "P8969 \u9898\u89e3"
    },
    {
        "content": "\u4ee5\u4e0b\u7528 $\\mathrm{popc}$ \u4ee3\u66ff $\\mathrm{popcount}$\u3002\n\n\u5148\u8003\u8651\u5168\u5c40\u52a0\u5168\u5c40 $\\mathrm{popc}$ \u600e\u4e48\u505a\u3002\n\n\u7ef4\u62a4\u4e00\u4e2a `tag` \u8868\u793a\u76ee\u524d\u5168\u5c40\u52a0\u4e86\u591a\u5c11\uff0c\u4e8e\u662f\u52a0\u6cd5\u53d8\u6210\u4e86 $O(1)$ \u7684\u3002\n\n$\\mathrm{popc}$ \u76f4\u63a5\u66b4\u529b\u505a\u5c31\u597d\u4e86\uff0c\u53ea\u6709\u7b2c\u4e00\u6b21\u662f $O(n)$ \u7684\uff0c\u505a\u5b8c\u7b2c\u4e00\u6b21 $\\mathrm{popc}$ \u4ee5\u540e\u81f3\u591a\u6709 $\\log V$ \u4e2a\u4e0d\u540c\u7684\u6570\uff0c\u7ef4\u62a4\u4e00\u4e2a $\\log V$ \u957f\u7684\u6620\u5c04\uff0c\u540e\u9762\u7684 $\\mathrm{popc}$ \u76f4\u63a5\u5728\u8fd9\u4e2a\u6620\u5c04\u4e0a\u4fee\u6539\u5c31\u597d\u4e86\u3002\n\n\u67e5\u8be2\u53d6\u51b3\u4e8e\u4f60\u7528\u4ec0\u4e48\u4e1c\u897f\u53bb\u7ef4\u62a4\u8fd9\u4e2a\u6620\u5c04\uff0c\u53ef\u4ee5\u505a\u5230 $O(1),O(\\log\\log V), O(\\log V)$ \uff0c\u8fd9\u4e0d\u91cd\u8981\uff0c\u4e0d\u4f5c\u5c55\u5f00\u3002\n\n\u7136\u540e\u4f60\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u5c31\u53ef\u4ee5\u642c\u5230\u4e00\u4e9b\u6570\u636e\u7ed3\u6784\u4e0a\u7ef4\u62a4\u4e86\uff0c\u5f53\u7136\u7ebf\u6bb5\u6811\u4e0a\u600e\u4e48\u7ef4\u62a4\u6211\u4e5f\u4e0d\u4f1a\uff0c\u6240\u4ee5\u6211\u8981\u5199\u5206\u5757\u3002\n\n\u6574\u5757\u7684\u7ef4\u62a4\u6211\u4eec\u6309\u4e0a\u9762\u7684\u505a\u6cd5\u7ef4\u62a4\u5c31\u597d\u4e86\uff0c\u5173\u952e\u662f\u6563\u5757\uff0c\u5bf9\u6563\u5757\u7684\u52a0\u64cd\u4f5c\u4f1a\u7834\u574f\u6389\u6574\u4e2a\u6620\u5c04\uff08\u53ef\u80fd\u6709 $a_i=a_j$\uff0c\u4f46\u662f\u4f60\u9700\u8981\u5bf9 $a_j$ \u52a0\u4e0a\u4e00\u4e2a\u6570\uff09\uff0c\u7ef4\u62a4\u6620\u5c04\u7684 $\\mathrm{popc}$ \u64cd\u4f5c\u4f1a\u7834\u574f\u6389\u52a0\u6cd5\u7684 `tag`\u3002\n\n\u4e8e\u662f\u4f60\u8981\u5bf9\u8fd9\u4e2a\u6563\u5757\u628a\u8be5\u4f20\u7684\u6807\u8bb0\u90fd\u4f20\u4e0b\u53bb\uff0c\u7136\u540e\u7ef4\u62a4\u4e00\u4e2a\u65b0\u7684\u6620\u5c04\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f $O(B+\\log V)$ \u7684\uff0c$B$ \u662f\u5757\u957f\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u5206\u6790\u590d\u6742\u5ea6\u4e86\u3002\n\n\u52a0\u6cd5\u662f $O(q(B+\\log V+\\frac{n}{B}))$\u3002\n\n\u5bf9\u4e8e $\\mathrm{popc}$ \u8003\u8651\u5206\u6790\u52bf\u80fd\uff0c\u53d8\u989c\u8272\u7684\u590d\u6742\u5ea6\u662f $O(B+\\log V)$\uff08\u7b2c\u4e00\u6b21 $\\mathrm{popc}$ \u6216\u8005\u6563\u5757\u91cd\u6784\uff09\uff0c\u7136\u540e\u6700\u591a\u53d8 $O(q)$ \u6b21\uff0c\u6240\u4ee5\u662f $O(q(B+\\log V))$\uff0c\u76f4\u63a5 $\\mathrm{popc}$ \u7684\u590d\u6742\u5ea6\u662f $O(q\\frac{n}{B}\\log V)$\u3002\n\n\u67e5\u8be2\u4e0d\u662f\u74f6\u9888\uff0c\u53cd\u6b63\u4e0d\u9ad8\u4e8e $O(q\\log V)$\u3002\n\n\u540c\u65f6\u8fd8\u89e3\u51b3\u4e86\u533a\u95f4\u6c42\u548c\u3002\n\n\u7406\u8bba\u4e0a $B=\\sqrt{n\\log V}$ \u662f\u6700\u4f18\u7684\uff0c\u6b64\u65f6\u590d\u6742\u5ea6 $O(q\\sqrt{n\\log V})$\uff0c\u5f53\u7136\u6027\u80fd\u74f6\u9888\u5728\u4e8e\u91cd\u6784\uff0c\u6240\u4ee5\u5c0f\u4e00\u70b9\u603b\u662f\u597d\u7684\u3002\n\n\n```cpp\n#include <bits/stdc++.h>\n#define fi first\n#define se second\nusing namespace std;\nusing ll = long long;\nusing pll = pair<ll, ll>;\nconst int N = 3e5 + 5, S = 389, B = 777, LG = 51;\nint n, m, bel[N], st[B], ed[B], siz[B], tmp[LG];\nbool pope[B];\nll a[N], tag[B], buk[LG];\npll ys[B][LG];\ninline void rebuild(int bid) {\n\tif (!pope[bid]) {\n\t\tfor (int i = st[bid]; i <= ed[bid]; i++)\n\t\t\ta[i] += tag[bid];\n\t} else {\n\t\tfor (int i = 1; i <= siz[bid]; i++)\n\t\t\tbuk[ys[bid][i].fi] = ys[bid][i].se + tag[bid];\n\t\tfor (int i = st[bid]; i <= ed[bid]; i++)\n\t\t\ta[i] = buk[a[i]];\n\t}\n\tpope[bid] = false;\n\ttag[bid] = 0;\n}\ninline void mod_add(int l, int r, ll k) {\n\tint p = bel[l], q = bel[r];\n\tif (p == q) {\n\t\trebuild(p);\n\t\tfor (int i = l; i <= r; i++)\n\t\t\ta[i] += k;\n\t} else {\n\t\trebuild(p);\n\t\tfor (int i = l; i <= ed[p]; i++)\n\t\t\ta[i] += k;\n\t\tfor (int i = p + 1; i < q; i++)\n\t\t\ttag[i] += k;\n\t\trebuild(q);\n\t\tfor (int i = st[q]; i <= r; i++)\n\t\t\ta[i] += k;\n\t}\n}\ninline void mod_pop(int l, int r) {\n\tint p = bel[l], q = bel[r];\n\tif (p == q) {\n\t\trebuild(p);\n\t\tfor (int i = l; i <= r; i++)\n\t\t\ta[i] = __builtin_popcountll(a[i]);\n\t} else {\n\t\trebuild(p);\n\t\tfor (int i = l; i <= ed[p]; i++)\n\t\t\ta[i] = __builtin_popcountll(a[i]);\n\t\tfor (int i = p + 1; i < q; i++) {\n\t\t\tif (!pope[i]) {\n\t\t\t\tmemset(tmp, -1, sizeof tmp), siz[i] = 0;\n\t\t\t\tfor (int j = st[i]; j <= ed[i]; j++) {\n\t\t\t\t\ta[j] = __builtin_popcountll(a[j] + tag[i]);\n\t\t\t\t\ttmp[a[j]] = a[j];\n\t\t\t\t}\n\t\t\t\tfor (int j = 0; j < LG; j++)\n\t\t\t\t\tif (~tmp[j])\n\t\t\t\t\t\tys[i][++siz[i]] = pll(tmp[j], tmp[j]);\n\t\t\t} else {\n\t\t\t\tfor (int j = 1; j <= siz[i]; j++)\n\t\t\t\t\tys[i][j].se = __builtin_popcountll(ys[i][j].se + tag[i]);\n\t\t\t}\n\t\t\tpope[i] = true;\n\t\t\ttag[i] = 0;\n\t\t}\n\t\trebuild(q);\n\t\tfor (int i = st[q]; i <= r; i++)\n\t\t\ta[i] = __builtin_popcountll(a[i]);\n\t}\n}\ninline ll query(int x) {\n\tint p = bel[x];\n\tif (!pope[p])\n\t\treturn a[x] + tag[p];\n\treturn lower_bound(ys[p] + 1, ys[p] + siz[p] + 1, pll(a[x], 0))->se + tag[p];\n}\nsigned main() {\n\tcin.tie(nullptr)->sync_with_stdio(false);\n//\tfreopen(\"test.in\", \"r\", stdin);\n//\tfreopen(\"dsjaikjf.out\", \"w\", stdout);\n\tcin >> n >> m;\n//\tif (n > 2000) {\n//\t\treturn 0;\n//\t}\n//\tofstream fout(\"fdsa.out\");\n\tfor (int i = 1; i <= n; i++)\n\t\tcin >> a[i];\n\tconst int sq = sqrt(n / 2);\n\tfor (int i = 1; i <= n; i++)\n\t\tbel[i] = (i - 1) / sq + 1;\n\tfor (int i = 1; i <= bel[n]; i++)\n\t\tst[i] = ed[i - 1] + 1, ed[i] = st[i] + sq - 1;\n\ted[bel[n]] = n;\n\twhile (m--) {\n\t\tchar op;\n\t\tint l, r;\n\t\tll k;\n\t\tcin >> op;\n\t\tif (op == 'A') {\n\t\t\tcin >> l >> r >> k;\n\t\t\tmod_add(l, r, k);\n\t\t} else if (op == 'P') {\n\t\t\tcin >> l >> r;\n\t\t\tmod_pop(l, r);\n\t\t} else {\n\t\t\tcin >> l;\n\t\t\tcout << query(l) << '\\n';\n\t\t}\n//\t\tfout << op << \": \";\n//\t\tfor (int i = 1; i <= n; i++)\n//\t\t\tfout << query(i) << ' ';\n//\t\tfout << endl;\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1675237402,
        "uid": 434929,
        "name": "Usada_Pekora",
        "ccfLevel": 7,
        "title": "P8969 \u5206\u5757"
    },
    {
        "content": "\u9996\u5148\u8fd9\u9898\u867d\u7136\u9898\u9762\u4e0a\u8ddf [\u57fa\u7840\u6570\u636e\u7ed3\u6784\u7ec3\u4e60\u9898](https://uoj.ac/problem/228) \u7c7b\u4f3c\uff0c\u4f46\u505a\u6cd5\u5374\u8ddf\u5b83\u6ca1\u6709\u534a\u6bdb\u94b1\u5173\u7cfb\u3002\n\n\u770b\u5230\u65f6\u9650 $10\\text s$\uff0c\u53ef\u4ee5\u63a8\u65ad\u590d\u6742\u5ea6\u5e94\u8be5\u4f1a\u5f88\u5927\u3002\n\n\u8003\u8651\u5206\u5757\uff08**\u8fd9\u4e0d\u662f\u6b63\u89e3\uff0c\u6b63\u89e3\u5728\u6700\u4e0b\u9762**\uff09\uff0c\u5c06\u6bcf\u4e2a\u5757\u5206\u4e3a**\u666e\u901a\u5757**\u548c**\u7279\u6b8a\u5757**\u3002\n\n\u8bbe $lazy$ \u4e3a\u666e\u901a\u5757\u6574\u4f53\u52a0\u4e86\u591a\u5c11\uff0c$to_i$ \u4e3a\u7279\u6b8a\u5757\u4e2d\u521d\u59cb\u503c\u4e3a $i$ \u7684\u503c\u73b0\u5728\u662f\u5565\u3002\n\n\u90a3\u4e48\u666e\u901a\u5757\u7684\u6bcf\u4e2a\u6570\u5c06\u88ab\u8868\u793a\u6210 $a_i+lazy$\uff0c\u7279\u6b8a\u5757\u7684\u6bcf\u4e2a\u6570\u5c06\u88ab\u8868\u793a\u6210 $to_{a_i}$\uff0c\u8fd9\u671f\u95f4\u666e\u901a\u5757\u7684 $a_i$ \u53ef\u80fd\u4f1a\u88ab\u4fee\u6539\uff0c\u4f46\u7279\u6b8a\u5757\u4e0d\u4f1a\u3002\n\n\u4e00\u5f00\u59cb\u6bcf\u4e2a\u5757\u90fd\u662f\u666e\u901a\u5757\uff0c\u8bbe\u5757\u957f\u4e3a $B$\u3002\n\n\u8003\u8651\u666e\u901a\u5757\uff0c\u6563\u5757\u52a0\u66b4\u529b\uff0c\u6574\u5757\u52a0\u76f4\u63a5\u52a0\u5230 lazy \u4e0a\uff0c\u6563\u5757 popcount \u91cd\u6784\u7136\u540e\u66b4\u529b\uff0c\u6574\u5757 popcount \u91cd\u6784\u5e76\u5c06\u5176\u53d8\u4e3a\u7279\u6b8a\u5757\uff0c\u7531\u4e8e popcount \u540e\u6bcf\u4e2a\u6570\u7684\u503c\u4e0d\u8d85\u8fc7 $\\log(nV)$\uff0c\u6240\u4ee5 $to$ \u5e8f\u5217\u7684\u5927\u5c0f\u80fd\u63a5\u53d7\u3002\n\n\u6563\u5757\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(B)$\n\n\u6574\u5757\u52a0\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(1)$\n\n\u6574\u5757 popcount \u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(B+\\log(nV))$\n\n\u8003\u8651\u7279\u6b8a\u5757\uff0c\u6574\u5757\u66b4\u529b\uff0c\u6563\u5757\u64cd\u4f5c\u91cd\u6784\u540e\u53d8\u4e3a\u666e\u901a\u5757\uff0c\u7136\u540e\u66b4\u529b\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O\\left(B+\\dfrac {n\\log(nV)}B\\right)$\n\n\u867d\u7136\u666e\u901a\u5757\u6574\u5757 popcount \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5f88\u52a3\uff0c\u4f46\u662f\u64cd\u4f5c\u5b8c\u4e4b\u540e\u5c31\u4f1a\u53d8\u6210\u7279\u6b8a\u5757\uff0c\u7279\u6b8a\u5757\u7684\u590d\u6742\u5ea6\u4e0d\u52a3\uff0c\u4e14\u64cd\u4f5c\u5b8c\u540e\u4f1a\u4f7f\u81f3\u591a\u4e24\u4e2a\u6563\u5757\u53d8\u4e3a\u666e\u901a\u5757\uff0c\u6240\u4ee5\u666e\u901a\u5757\u7684\u51fa\u73b0\u6b21\u6570\u662f $O\\left(\\dfrac nB+q\\right)$ \u7ea7\u522b\u7684\u3002\n\n\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f\uff1a$O\\left(\\left(\\dfrac nB+q\\right)\\left(B+\\log(nV)+\\dfrac nB\\right)+q\\left(B+\\dfrac{n\\log(nV)}B\\right)\\right)$\n\n$B$ \u53d6 $\\sqrt{n\\log(nV)}$ \u5373\u53ef\u505a\u5230 $O\\left(n+q\\sqrt{n\\log(nV)}+q\\log(nV)\\right)$\uff0c\u7b97\u91cf\u5f88\u5927\uff0c\u4f46\u5b9e\u9645\u53ea\u8dd1\u4e86 $4\\text s$ \u5de6\u53f3\uff08\u5757\u957f $2000$\uff0c\u8dd1\u8fd9\u4e48\u5feb\u5927\u6982\u662f\u5e38\u6570\u5c0f+\u6570\u636e\u5f88\u96be\u5361\u6ee1\uff09\u3002\n\n\u7b97\u91cf\u90a3\u4e48\u5927\uff0c\u4e00\u770b\u5c31\u4e0d\u662f\u6b63\u89e3\uff0c\u6709\u6ca1\u6709\u66f4\u5feb\u7684\u505a\u6cd5\u5462\uff1f\n\n\u6709\uff0c\u53ef\u4ee5\u628a\u5206\u5757\u6539\u6210\u7ebf\u6bb5\u6811\uff0c\u8fd9\u6837\u5c31\u662f $\\text{polylog}$ \u7684\u4e86\u3002\n\n\u8fd8\u662f\u5bf9\u4e8e\u7ebf\u6bb5\u6811\u4e0a\u6bcf\u4e2a\u8282\u70b9\u8bbe $lazy$ \u548c $to_i$\uff0c\u4e5f\u5206\u4e3a\u666e\u901a\u8282\u70b9\u548c\u7279\u6b8a\u8282\u70b9\u4e24\u7c7b\u3002\n\n\u7531\u4e8e\u662f\u5355\u70b9\u67e5\u8be2\uff0c\u6240\u4ee5\u4ece\u53f6\u5b50\u8282\u70b9\u4e0d\u65ad\u8df3\u7236\u4eb2\u8df3\u5230\u6839\u8282\u70b9\u65f6\uff0c\u5982\u679c\u7ecf\u8fc7\u4e86\u7279\u6b8a\u8282\u70b9\uff0c\u8bbe\u5f53\u524d\u503c\u4e3a $v$\uff0c\u6211\u4eec\u5c31\u628a $v$ \u66f4\u65b0\u6210 $to_{\\text{popcount(v)}}$\uff0c\u5728\u8df3\u7236\u4eb2\u4e4b\u524d\u6211\u4eec\u628a $v$ \u8bbe\u4e3a $a_i+lazy$\uff0c\u56e0\u4e3a\u90a3\u65f6\u61d2\u6807\u8bb0\u5df2\u4e0b\u4f20\u5b8c\u6bd5\u3002\n\n\u5bf9\u4e8e\u666e\u901a\u8282\u70b9\uff0c\u5168\u5c40\u52a0\u6cd5\u64cd\u4f5c\u76f4\u63a5\u66f4\u65b0 $lazy$\uff0c\u5168\u5c40 popcount \u64cd\u4f5c\u76f4\u63a5\u628a $to_i$ \u8bbe\u4e3a $i$\uff0c\u5e76\u5c06\u6b64\u8282\u70b9\u8bbe\u4e3a\u7279\u6b8a\u8282\u70b9\uff0c\u975e\u5168\u5c40\u64cd\u4f5c\u76f4\u63a5\u9012\u5f52\u3002\n\n\u5bf9\u4e8e\u7279\u6b8a\u8282\u70b9\uff0c\u5168\u5c40\u64cd\u4f5c\u76f4\u63a5\u66f4\u65b0 $to_i$\uff0c\u975e\u5168\u5c40\u64cd\u4f5c\u7684\u8bdd\u5728\u9012\u5f52\u4e4b\u524d\u9700\u8981\u628a\u5b83\u53d8\u6210\u666e\u901a\u8282\u70b9\uff0c\u540c\u65f6\u4e4b\u524d\u7ef4\u62a4\u7684 $to_i$ \u4e5f\u8981\u4e0b\u4f20\u5408\u5e76\uff0c\u5177\u4f53\u7684\u5c31\u662f\u5c06 $to'_i$ \u66f4\u65b0\u6210 $to'_{\\text{popcount}(to_i)}$\u3002\n\n\u590d\u6742\u5ea6\u662f\u4e25\u683c\u7684\uff0c\u4e0d\u9700\u8981\u5206\u6790\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n+q\\log n\\log(nV))$\uff0c\u867d\u7136\u7b97\u91cf\u8fdc\u5c0f\u4e8e\u5206\u5757\uff0c\u4f46\u5b83\u5f88\u5bb9\u6613\u5361\u6ee1\uff0c\u6240\u4ee5\u8dd1\u4e0d\u8fc7\u5206\u5757\u3002\n\n# AC Code\uff08\u7ebf\u6bb5\u6811\u505a\u6cd5\uff09\n```\nll lazy[1200005],to[1200005][50],a[300005];\nbool yes[1200005];\nvoid build(int x,int l,int r){\n\tif(l==r){\n\t\treturn ;\n\t}\n\tint mid=l+r>>1;\n\tbuild(x<<1,l,mid),build(x<<1|1,mid+1,r);\n}\ninline void pushdown(int x){\n\tif(yes[x<<1]) for(int i=1;i<50;i++) to[x<<1][i]+=lazy[x];else lazy[x<<1]+=lazy[x];\n\tif(yes[x<<1|1]) for(int i=1;i<50;i++) to[x<<1|1][i]+=lazy[x];else lazy[x<<1|1]+=lazy[x];\n\tlazy[x]=0;\n}\nvoid add(int x,int l,int r,int l1,int r1,int v){\n\tif(l<=l1&&r1<=r){\n\t\tif(yes[x]) for(int i=1;i<50;i++) to[x][i]+=v;else lazy[x]+=v;\n\t\treturn ;\n\t}\n\tpushdown(x);\n\tif(yes[x]){\n\t\tif(yes[x<<1]) for(int i=1;i<50;i++) to[x<<1][i]=to[x][ppcl(to[x<<1][i])];\n\t\telse{\n\t\t\tyes[x<<1]=1;\n\t\t\tfor(int i=1;i<50;i++) to[x<<1][i]=to[x][i];\n\t\t}\n\t\tif(yes[x<<1|1]) for(int i=1;i<50;i++) to[x<<1|1][i]=to[x][ppcl(to[x<<1|1][i])];\n\t\telse{\n\t\t\tyes[x<<1|1]=1;\n\t\t\tfor(int i=1;i<50;i++) to[x<<1|1][i]=to[x][i];\n\t\t}\n\t\tyes[x]=0;\n\t}\n\tint mid=l1+r1>>1;\n\tif(l<=mid) add(x<<1,l,r,l1,mid,v);if(mid<r) add(x<<1|1,l,r,mid+1,r1,v);\n\t\n}\nvoid change(int x,int l,int r,int l1,int r1){\n\tif(l<=l1&&r1<=r){\n\t\tif(yes[x]) for(int i=1;i<50;i++) to[x][i]=ppcl(to[x][i]);\n\t\telse{\n\t\t\tyes[x]=1;\n\t\t\tfor(int i=1;i<50;i++) to[x][i]=i;\n\t\t}\n\t\treturn ;\n\t}\n\tpushdown(x);\n\tif(yes[x]){\n\t\tif(yes[x<<1]) for(int i=1;i<50;i++) to[x<<1][i]=to[x][ppcl(to[x<<1][i])];\n\t\telse{\n\t\t\tyes[x<<1]=1;\n\t\t\tfor(int i=1;i<50;i++) to[x<<1][i]=to[x][i];\n\t\t}\n\t\tif(yes[x<<1|1]) for(int i=1;i<50;i++) to[x<<1|1][i]=to[x][ppcl(to[x<<1|1][i])];\n\t\telse{\n\t\t\tyes[x<<1|1]=1;\n\t\t\tfor(int i=1;i<50;i++) to[x<<1|1][i]=to[x][i];\n\t\t}\n\t\tyes[x]=0;\n\t}\n\tint mid=l1+r1>>1;\n\tif(l<=mid) change(x<<1,l,r,l1,mid);if(mid<r) change(x<<1|1,l,r,mid+1,r1);\n}\nll query(int x,int l,int r,int p){\n\tif(l==r){\n\t\ta[l]+=lazy[x],lazy[x]=0;\n\t\tif(yes[x]) return to[x][ppcl(a[l])];return a[l];\n\t}\n\tpushdown(x);int mid=l+r>>1;ll res;\n\tif(mid<p) res=query(x<<1|1,mid+1,r,p);else res=query(x<<1,l,mid,p);\n\tif(yes[x]) return to[x][ppcl(res)];return res;\n}\nint main(){\n\tios::sync_with_stdio(0),cin.tie(0);\n\tint n,q;cin>>n>>q;\n\tfor(int i=1;i<=n;i++) cin>>a[i];\n\tbuild(1,1,n);\n\twhile(q--){\n\t\tchar c;cin>>c;\n\t\tif(c=='A'){\n\t\t\tint l,r,x;cin>>l>>r>>x;\n\t\t\tadd(1,l,r,1,n,x);\n\t\t}\n\t\tif(c=='P'){\n\t\t\tint l,r;cin>>l>>r;\n\t\t\tchange(1,l,r,1,n);\n\t\t}\n\t\tif(c=='J'){\n\t\t\tint x;cin>>x;\n\t\t\tcout<<query(1,1,n,x)<<endl;\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1674561226,
        "uid": 80614,
        "name": "ZCPB",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8969"
    },
    {
        "content": "\u5927\u5bb6\u597d\uff0c\u6211\u662f\u6839\u53f7\u6570\u636e\u7ed3\u6784\u7231\u597d\u8005\u3002\u6240\u4ee5\u6211\u7528\u5206\u5757 A \u4e86\u6b64\u9898\u3002\n\n\u89c2\u5bdf\u672c\u9898\u64cd\u4f5c\uff0c\u53d1\u73b0\u533a\u95f4\u52a0\u548c\u5355\u70b9\u67e5\u8be2\u90fd\u662f\u53ef\u4ee5\u7b80\u5355\u5730\u7528\u5206\u5757\u6765\u7ef4\u62a4\u7684\u3002\u4f46\u662f\u533a\u95f4 popcnt \u662f\u4e2a\u5f88\u65b0\u9896\u7684\u4e1c\u897f\u3002\uff08\u4e5f\u8bb8\u662f\u6211\u9898\u505a\u5f97\u592a\u5c11\u4e86\u5427\u3002\uff09\u8d5b\u65f6\u6211\u4ee5\u4e3a\u662f\u4e2a\u4ec0\u4e48\u795e\u79d8\u7684 Trie \u6811\u7136\u540e\u4e00\u76f4\u60f3\u4e0d\u51fa\u6765\u3002\u8d5b\u540e\u542c\u8bf4 LHQing \u7528\u5206\u5757\u8fc7\u4e86\u672c\u9898\u7136\u540e\u5c31\u6eda\u53bb\u95ee\u4ed6\u4e86\u3002\u611f\u8c22 LHQing \u5927\u5e1d\u7684\u8010\u5fc3\u6307\u5bfc\u3002\n\n\u5bb9\u6613\u53d1\u73b0 $\\text{popcnt}(x)<64$\u3002\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u79cd\u505a\u6cd5\u2014\u2014\u5f53\u67d0\u4e2a\u5757\u88ab\u6574\u5757 popcnt \u540e\uff0c\u5c06\u5176\u53bb\u91cd\u53ea\u4f1a\u5269\u4e0b $64$ \u79cd\u4ee5\u4e0b\u7684\u5143\u7d20\u3002\u628a\u8fd9\u4e9b\u53bb\u91cd\u540e\u7684\u5143\u7d20\u5b58\u8d77\u6765\uff0c\u4e4b\u540e\u518d\u5bf9\u8be5\u5757\u8fdb\u884c\u6574\u5757\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u5bf9\u8fd9\u51e0\u4e2a\u5143\u7d20\u8fdb\u884c\u4fee\u6539\u5373\u53ef\u3002\u66f4\u8be6\u7ec6\u5730\u8bf4\uff0c\u5c06\u7b2c\u4e00\u6b21\u88ab\u6574\u5757 popcnt \u540e\u8be5\u5757\u4e2d\u6bcf\u4e00\u4e2a\u5143\u7d20\u7684\u503c\uff08\u4e0b\u6587\u79f0\u4e3a\u4ee3\u8868\u503c\uff09\u4e0e\u7ee7\u7eed\u6267\u884c\u5176\u5b83\u6574\u5757\u64cd\u4f5c\u540e\u7684\u503c\uff08\u4e0b\u6587\u79f0\u4e3a\u5b9e\u9645\u503c\uff09\u7ec4\u6210\u4e00\u7ec4\u6620\u5c04\u3002\u4fee\u6539\u65f6\u76f4\u63a5\u66b4\u529b\u679a\u4e3e\uff0c\u67e5\u8be2\u65f6\u76f4\u63a5\u67e5\u8be2\u6620\u5c04\u5373\u53ef\u3002\n\n\u6765\u5206\u6790\u4e00\u4e0b\u590d\u6742\u5ea6\u3002\u4e0d\u8003\u8651\u6563\u5757\u4fee\u6539\u3002\u5f53\u4e00\u4e2a\u5757\u88ab\u7b2c\u4e00\u6b21\u6574\u5757 popcnt \u524d\uff0c\u6574\u5757\u52a0\u662f\u5355\u5757 $O(1)$ \u7684\u3002\u7b2c\u4e00\u6b21\u88ab popcnt \u65f6\u5355\u5757\u590d\u6742\u5ea6\u662f $O\\left(\\sqrt n\\right)$ \u7684\uff0c\u4f46\u8fd9\u79cd\u60c5\u51b5\u53ea\u4f1a\u53d1\u751f $O\\left(\\sqrt n\\right)$ \u6b21\u3002\u4e4b\u540e\u6267\u884c\u7684\u6240\u6709\u6574\u5757\u64cd\u4f5c\u90fd\u662f\u5355\u5757 $O\\left(\\log V\\right)$ \u7684\u3002\u56e0\u6b64\u603b\u590d\u6742\u5ea6\u662f $O\\left(m\\sqrt n\\log V\\right)$ \u3002\n\n\u7136\u800c\u6563\u5757\u4fee\u6539\u4f1a\u7834\u574f\u6620\u5c04\u7684\u4e00\u4e00\u5bf9\u5e94\u5173\u7cfb\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u6563\u5757\u4fee\u6539\u4f1a\u4f7f\u4e24\u4e2a\u76f8\u540c\u7684\u4ee3\u8868\u503c\u6240\u5bf9\u5e94\u7684\u5b9e\u9645\u503c\u4e0d\u540c\u3002\u6240\u4ee5\u6211\u4eec\u4e0d\u5f97\u4e0d\u7528\u6b64\u5757\u7684\u6620\u5c04\u66f4\u65b0\u81ea\u8eab\u6240\u6709\u5143\u7d20\uff0c\u7136\u540e\u5c06\u6620\u5c04\u6e05\u7a7a\u518d\u6267\u884c\u4fee\u6539\u3002\u4e4b\u540e\u5982\u679c\u8981\u5c06\u8fd9\u4e2a\u5757\u518d\u6574\u5757 popcnt \u7684\u8bdd\u5c31\u4e0d\u5f97\u4e0d $O\\left(\\sqrt n\\right)$ \u5730\u91cd\u6784\u6620\u5c04\u3002\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u4e0d\u5c31\u4e0d\u5bf9\u4e86\u5417\uff1f\n\n\u5b9e\u9645\u4e0a\u6211\u4eec\u53ef\u4ee5\u7528\u7c7b\u4f3c\u52bf\u80fd\u5206\u6790\u7684\u65b9\u6cd5\u6765\u8bc1\u660e\u6563\u5757\u4fee\u6539\u4e0d\u4f1a\u8fc7\u5927\u5f71\u54cd\u603b\u590d\u6742\u5ea6\u3002\u8bbe\u6bcf\u5757\u521d\u59cb\u65f6\u52bf\u80fd\u4e3a $1$\uff0c\u6563\u5757\u4fee\u6539\u4f1a\u4f7f\u8be5\u5757\u7684\u52bf\u80fd $+1$\uff0c\u6574\u5757 popcnt\uff08\u91cd\u6784\u6620\u5c04\uff09\u4f1a\u4f7f\u8be5\u5757\u7684\u52bf\u80fd $-1$\u3002\u5bb9\u6613\u53d1\u73b0\uff0c\u6bcf\u6b21\u4fee\u6539\u4f1a\u4f7f\u4e2d\u95f4\u7684\u6240\u6709\u6574\u5757\u52bf\u80fd $-1$\uff0c\u53ea\u6709\u4e24\u65c1 $O(1)$ \u4e2a\u6563\u5757\u7684\u52bf\u80fd\u4f1a $+1$\u3002\u56e0\u6b64\u6700\u5927\u603b\u52bf\u80fd\u5c31\u63a7\u5236\u5728 $O(m)$ \u7684\u7ea7\u522b\u3002\u6240\u4ee5\u91cd\u6784\u6620\u5c04\u7684\u603b\u590d\u6742\u5ea6\u662f $O\\left(m\\sqrt n\\right)$\u3002\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O\\left(m\\sqrt n\\log V\\right)$\uff08\u5ffd\u7565\u4f4e\u6b21\u9879\uff09\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u662f $O\\left(n+\\sqrt n\\log V\\right)$\u3002\n\nPS\uff1a\u53ef\u4ee5\u901a\u8fc7\u9010\u5757\u5904\u7406\u6765\u5361 cache\u3002\u8fd9\u6837\u80fd\u4f7f\u5b58\u6620\u5c04\u7684\u4e24\u4e2a\u6570\u7ec4\u5927\u5c0f\u5747\u4e3a 64\uff0c\u53ef\u4ee5\u5361\u8fdb cache\u3002\u5e94\u8be5\u4f1a\u4f7f\u901f\u5ea6\u663e\u8457\u63d0\u5347\u3002\uff08\u4f46\u662f\u6211\u6ca1\u5199\u4e0d\u9010\u5757\u5904\u7406\u7684\u4ee3\u7801\u4e0d\u77e5\u9053\u5177\u4f53\u63d0\u5347\u4e86\u591a\u5c11\u3002\uff09\n",
        "postTime": 1674578315,
        "uid": 111789,
        "name": "DRPLANT",
        "ccfLevel": 5,
        "title": "P8969 \u5e7b\u68a6 \u9898\u89e3"
    },
    {
        "content": "## \u9898\u610f\u7b80\u8ff0\n\u4f60\u9700\u8981\u5bf9 $n$ \u4e2a\u6570\u7684\u6570\u5217\u8fdb\u884c $q$ \u6b21\u64cd\u4f5c\uff0c\u5176\u4e2d\u64cd\u4f5c\u5206\u4e3a\u4ee5\u4e0b\u4e09\u79cd\u3002  \n1. \u533a\u95f4\u52a0 $k$\u3002\n2. \u533a\u95f4\u53d8\u4e3a $\\text{popcount}$\uff0c\u5373\u4e8c\u8fdb\u5236\u8868\u793a\u4e2d $1$ \u7684\u4e2a\u6570\u3002\n3. \u5355\u70b9\u6c42\u503c\u3002\n\n## \u9898\u76ee\u5206\u6790\n\n\u770b\u8d77\u6765\u4e0d\u592a\u80fd\u4e00\u53ea $\\log$, \u6240\u4ee5\u8003\u8651\u5206\u5757\u3002\u533a\u95f4\u52a0\u662f\u7b80\u5355\u7684\uff0c\u4e0d\u505a\u8ba8\u8bba\uff0c\u533a\u95f4 $\\text{popcount}$ \u867d\u7136\u4e0d\u592a\u597d\u76f4\u63a5\u505a\uff0c\u4f46\u5b83\u6709\u4e2a\u5f88\u597d\u7684\u6027\u8d28\u662f\u4e00\u6b21 $\\text{popcount}$ \u64cd\u4f5c\u4f1a\u4f7f\u5f97\u503c\u57df $V$ \u53d8\u4e3a $\\log V$\u3002\u4e8e\u662f\u6211\u4eec\u8003\u8651\u5728\u6574\u5757\u7684\u7b2c\u4e00\u6b21 $\\text{popcount}$ \u65f6\u66b4\u529b\u64cd\u4f5c\uff0c\u4e4b\u540e\u5c31\u53ea\u9700\u5bf9\u5757\u5185\u7684\u81f3\u591a $\\log$ \u79cd\u6570\u7ef4\u62a4\u5176\u53d8\u4e3a\u7684\u503c\uff0c\u8fd9\u662f\u5bb9\u6613\u7684\u3002\n\n\u5206\u6790\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u8bbe $n,q$ \u540c\u7ea7\uff0c\u5757\u957f\u4e3a $m$, \u5355\u6b21 $\\text{popcount}$ \u4e3a $\\log\\log V$\u3002\u5219\u6563\u5757\u52a0\u4e3a $nm$, \u6563\u5757 $\\text{popcount}$ \u4e3a $nm\\log\\log V$, \u6574\u5757\u533a\u95f4\u52a0\u4e3a ${n^2}\\over m$, \u6574\u5757 $\\text{popcount}$ \u4e3a ${n^2\\log V\\log\\log V}\\over m$\u3002\u6545\u7406\u8bba\u5757\u957f $m=\\sqrt {n\\log V}$ \u65f6\u53d6\u5f97\u6700\u4f18\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt{n\\log V}\\log\\log V)$, \u4f46\u662f\u533a\u95f4\u5185\u6570\u7684\u6570\u91cf\u5f88\u96be\u8dd1\u6ee1\uff08\u4e14\u524d\u51e0\u4e2a\u5b50\u4efb\u52a1\u5404\u6709\u4e0d\u540c\u9650\u5236\uff09\uff0c\u6240\u4ee5\u5757\u957f\u76f4\u63a5\u53d6 $\\sqrt n$ \u66f4\u4f18\uff0c\u53ef\u4ee5\u8f83\u5feb\u5730\u901a\u8fc7\u672c\u9898\uff08\u8fd9\u80fd\u8dd1\u5230\u6700\u4f18\u89e3\u7b2c\u4e8c\u662f\u6211\u6ca1\u60f3\u5230\u7684\uff09\u3002\n\n## \u4ee3\u7801\n\n\u8bb0\u5f97\u52a0\u5feb\u8bfb\uff0c\u6709\u4e00\u4e9b\u5c0f\u4f18\u5316\u53ef\u770b\u4ee3\u7801\u3002\n\n```cpp\n#include <iostream>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\n#define popcount(x) __builtin_popcountll(x)\nconst int B=555;\n\nint n,q,cntk,u,v,w,zt[51],K[300001]; unsigned long long a[300001];\nchar s;\n\nstruct kuai\n{\n    int l,r,fgt,to[51],num[51],cntt; unsigned long long addt;\n    void maintain()\n    {\n        if(!fgt) for(int i=l;i<=r;i++) a[i]+=addt;\n        else for(int i=l;i<=r;i++) a[i]=to[num[a[i]]]+addt;\n        addt=fgt=cntt=0;\n    }\n    void cz_add(unsigned long long k) {addt+=k;}\n    void cz_popc()\n    {\n        if(!fgt)\n        {\n            memset(zt,0,sizeof(zt));\n            for(int i=l;i<=r;i++) {a[i]=popcount(a[i]+addt); zt[a[i]]=1;}\n            for(int i=1;i<=50;i++) if(zt[i]) {to[++cntt]=i; num[i]=cntt;}\n        }\n        else for(int i=1;i<=cntt;i++) to[i]=popcount(to[i]+addt);\n        addt=0; fgt=1;\n    }\n}b[555];\n\nvoid change_add(int x,int y,int k)\n{\n    int kl=K[x],kr=K[y];\n    if(kl==kr) {b[kl].maintain(); for(int i=x;i<=y;i++) a[i]+=k;}\n    else\n    {\n        for(int i=kl+1;i<=kr-1;i++) b[i].cz_add(k);\n        b[kl].maintain(); b[kr].maintain();\n        for(int i=x;i<=b[kl].r;i++) a[i]+=k;\n        for(int i=b[kr].l;i<=y;i++) a[i]+=k;\n    }\n}\nvoid change_popc(int x,int y)\n{\n    int kl=K[x],kr=K[y];\n    if(kl==kr) {b[kl].maintain(); for(int i=x;i<=y;i++) a[i]=popcount(a[i]);}\n    else\n    {\n        for(int i=kl+1;i<=kr-1;i++) b[i].cz_popc();\n        b[kl].maintain(); b[kr].maintain();\n        for(int i=x;i<=b[kl].r;i++) a[i]=popcount(a[i]);\n        for(int i=b[kr].l;i<=y;i++) a[i]=popcount(a[i]);\n    }\n}\nunsigned long long ask(int x)\n{\n    int kx=K[x];\n    if(!b[kx].fgt) return a[x]+b[kx].addt;\n    else return b[kx].to[b[kx].num[a[x]]]+b[kx].addt;\n}\n\nsigned main()\n{\n    cin>>n>>q; for(int i=1;i<=n;i++) cin>>a[i];\n    for(int i=1;i<=n;i++) K[i]=(i-1)/B+1;\n    for(int i=1;(i-1)*B+1<=n;i++) {b[i].l=(i-1)*B+1; b[i].r=min(n,i*B);}\n    for(int i=1;i<=q;i++)\n    {\n        cin>>s;\n        if(s=='A') {cin>>u>>v>>w; change_add(u,v,w);}\n        else if(s=='P') {cin>>u>>v; change_popc(u,v);}\n        else {cin>>u; cout<<ask(u)<<endl;}\n    }\n}\n```\n",
        "postTime": 1674704549,
        "uid": 529697,
        "name": "PEKKA_l",
        "ccfLevel": 6,
        "title": "P8969\u9898\u89e3"
    }
]