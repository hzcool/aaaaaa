[
    {
        "content": "$$\\href{http://blog.chhokmah.cn/index.php/archives/45/}{\\Large\\texttt{My blog}}$$\n\n---\n## \u9898\u76ee\u6982\u62ec\n\u7ed9\u5b9a$R\\times C$\u7684\u68cb\u76d8\uff0c$n$\u79cd\u989c\u8272\u7684\u68cb\u5b50\uff0c\u6bcf\u79cd\u68cb\u5b50\u53ea\u6709\u4e24\u9897\u5e76\u4e14\u90fd\u5728\u68cb\u76d8\u4e0a\u3002  \n\u68cb\u76d8\u7684\u6bcf\u4e2a\u683c\u5b50\u6700\u591a\u6709\u4e00\u9897\u68cb\u5b50\u3002  \n\u6bcf\u6b21\u64cd\u4f5c\u786e\u5b9a$(x,y)$\u548c\u4e24\u4e2a\u65b9\u5411\uff08\u4fdd\u8bc1$(x,y)$\u4e3a\u7a7a\u683c\u5b50\uff09\uff0c\u5411\u4e24\u4e2a\u65b9\u5411\u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u989c\u8272\u5982\u679c\u76f8\u540c\u5c31\u5220\u53bb\u3002  \n\u8bf7\u4f60\u89e3\u51b3\u4ee5\u4e0b\u4e24\u4e2a\u95ee\u9898\uff1a  \n* \u7ed9\u5b9a\u4f60$k$\u4e2a\u64cd\u4f5c\uff0c\u8ba9\u4f60\u6c42\u51fa\u80fd\u591f\u5220\u53bb\u989c\u8272\u7684\u4e2a\u6570\u3002  \n* \u6700\u591a\u80fd\u5220\u53bb\u591a\u5c11\u989c\u8272\uff0c\u5e76\u7ed9\u51fa\u65b9\u6848\u3002  \n\n**\u7ed9\u5b9a\u6570\u636e\u4fdd\u8bc1\u64cd\u4f5c\u5408\u6cd5\uff0c\u9009\u624b\u8bf7\u4fdd\u8bc1\u7ed9\u51fa\u65b9\u6848\u4ea6\u5408\u6cd5**  \n\n\n## \u601d\u8def\u8981\u70b9\n\u5927\u81f4\u601d\u8def\u4e3a\u7528$set$\u7ef4\u62a4\u884c\u548c\u5217  \n\u7b2c\u4e00\u95ee\u76f4\u63a5\u6a21\u62df\u5373\u53ef  \n\u7b2c\u4e8c\u95ee\uff0c\u6211\u4eec\u8003\u8651\u4e00\u4e2a\u8d2a\u5fc3\uff0c\u56e0\u4e3a\u5220\u53bb\u989c\u8272\u540e\u53ea\u80fd\u4f7f\u4ee5\u540e\u7684\u7b54\u6848\u66f4\u4f18\uff0c\u6240\u4ee5\u8d2a\u5fc3\u7b56\u7565\u5c31\u662f\u80fd\u5220\u5c31\u5220  \n\u7528\u961f\u5217\u7ef4\u62a4\u5f53\u524d\u5220\u53bb\u989c\u8272\uff0c\u8003\u8651\u4ece\u5220\u53bb\u6269\u5c55\u5230\u5176\u4ed6\u989c\u8272\u3002  \n\u901a\u8fc7\u89c2\u5bdf\u6837\u4f8b\u4f1a\u53d1\u73b0\uff0c\u5728\u4e24\u4e2a\u683c\u5b50\u6240\u5728\u7684$2$\u884c\u548c$2$\u5217\u6240\u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u989c\u8272\u6211\u4eec\u80fd\u591f\u66f4\u65b0\uff0c\u6240\u4ee5$check$\u540e\u5408\u6cd5\u7684\u5f39\u5165\u961f\u5217\u3002  \n\u81f3\u4e8e\u8f93\u51fa\u65b9\u6848\uff0c**\u6d1b\u8c37\u4e2d\u4e0d\u9700\u8981\u8f93\u51fa\u65b9\u6848**\uff0c\u5c31\u5728\u66f4\u65b0\u7684\u65f6\u5019\u4e00\u5e76\u8bb0\u5f55\u5373\u53ef\u3002  \n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9\u5220\u9664\u540e\u66f4\u65b0\u7684\u6b21\u6570\u4e3a$8$\u6b21\uff0c\u6240\u4ee5\u603b\u7684\u590d\u6742\u5ea6\u4e3a$\\mathcal O(nlog_2n+klog_2n)$  \n\n## \u4ee3\u7801\n```cpp\n// \u6d1b\u8c37\u4e2d\u4e0d\u9700\u8981\u8f93\u51fa\u65b9\u6848\u7684\u6807\u7a0b\n// \u65b9\u6848\u8bb0\u5f55\u5728ans\u4e2d\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntemplate <class T>\nvoid read(T& x) {\n  x = 0; char ch = 0; int f = 1;\n  for (; !isdigit(ch); ch = getchar()) if (ch == '-') f = -1;\n  for (; isdigit(ch); ch = getchar()) x = x * 10 + (ch ^ 48);\n  x *= f;\n}\n\ntemplate <class T>\nvoid write(T x) {\n  if (x < 0) putchar('-'), x = -x;\n  if (x > 9) write(x / 10);\n  putchar(x % 10 + 48);\n}\n\ntemplate <class T>\nvoid writeln(T x) {\n  write(x), puts(\"\");\n}\n\nconst int N = 1e5 + 5;\nconst char dir[] = \"UDLR\";\n\nset< pair<int, int> > A[N], B[N];\nint R, C, n;\nint a[N], b[N], c[N], d[N];\nbool vis[N];\nset< pair<int, int> >::iterator it;\nvector< pair< pair<int, int>, pair<char, char> > > ans;\n\nbool move(int x, int y, char d) {\n  if (d == 'D') {\n    it = B[y].lower_bound(make_pair(x + 1, 0));\n    return it != B[y].end(); \n  } else if (d == 'U') {\n    it = B[y].lower_bound(make_pair(x, 0));\n    if (it == B[y].begin()) return 0;\n    else return it--, 1;\n  } else if (d == 'L') {\n    it = A[x].lower_bound(make_pair(y, 0));\n    if (it == A[x].begin()) return 0;\n    else return it--, 1;\n  } else {\n    it = A[x].lower_bound(make_pair(y + 1, 0));\n    return it != A[x].end();\n  }\n  return 0;\n}\n\nbool check(int x, int y) {\n  set< pair<int, int> >::iterator it = A[x].lower_bound(make_pair(y, 0));\n  return (*it).first == y;\n}\n\nvoid del(int j) {\n  A[a[j]].erase(make_pair(b[j], j)), B[b[j]].erase(make_pair(a[j], j));\n  A[c[j]].erase(make_pair(d[j], j)), B[d[j]].erase(make_pair(c[j], j));\n}\n\nvoid solve1() {\n  int m; read(m);\n  int ans = 0;\n  for (int i = 1; i <= m; i++) {\n    int x, y; read(x), read(y);\n    if (check(x, y)) continue;\n    char dir1[5], dir2[5]; scanf(\"%s %s\", dir1, dir2);\n    if (!move(x, y, dir1[0])) continue; \n    set< pair<int, int> >::iterator it1 = it; \n    if (!move(x, y, dir2[0])) continue;\n    set< pair<int, int> >::iterator it2 = it;\n    if ((*it1).second == (*it2).second) {\n      ans++;\n      vis[(*it1).second] = 1;\n      del((*it1).second);\n    }\n  }\n  write(ans), putchar(' ');\n  for (int i = 1; i <= n; i++) \n    if (vis[i]) {\n      A[a[i]].insert(make_pair(b[i], i)), A[c[i]].insert(make_pair(d[i], i));\n      B[b[i]].insert(make_pair(a[i], i)), B[d[i]].insert(make_pair(c[i], i));\n      vis[i] = 0;\n    }\n}\n\nbool update(int i) { // i is color\n  int X1 = a[i], Y1 = b[i], X2 = c[i], Y2 = d[i], cnt = 0;\n  if (X1 == X2) {\n    if (Y1 > Y2) swap(Y1, Y2);\n    if (Y1 + 1 == Y2) return 0;\n    move(4, 1, 'R');\n    if (move(X1, Y1, 'R')) {\n      if ((*it).second == i) {\n        del(i);\n        ans.push_back(make_pair(make_pair(X1, Y1 + 1), make_pair('L', 'R')));\n        return 1;\n      }\n    }\n    return 0;\n  }\n  if (Y1 == Y2) {\n    if (X1 > X2) swap(X1, X2);\n    if (X1 + 1 == X2) return 0;\n    if (move(X1, Y1, 'D')) \n      if ((*it).second == i) {\n        del(i);\n        ans.push_back(make_pair(make_pair(X1 + 1, Y1), make_pair('U', 'D')));\n        return 1;\n      }\n    return 0;\n  }\n  char opt[6];\n  if (!check(X2, Y1)) {\n    for (int j = 0; j < 4; j++) \n      if (move(X2, Y1, dir[j])) \n        if ((*it).second == i) opt[++cnt] = dir[j];\n    if (cnt >= 2) {\n      ans.push_back(make_pair(make_pair(X2, Y1), make_pair(opt[1], opt[2])));\n      del(i);\n      return 1;\n    }\n  }\n  cnt = 0; \n  if (!check(X1, Y2)) {\n    for (int j = 0; j < 4; j++) \n      if (move(X1, Y2, dir[j])) \n        if ((*it).second == i) opt[++cnt] = dir[j];\n    if (cnt >= 2) {\n      ans.push_back(make_pair(make_pair(X1, Y2), make_pair(opt[1], opt[2])));\n      del(i);\n      return 1;\n    }\n  }\n  return 0;\n}\n\nvoid solve2() {\n  ans.clear();\n  queue<int> q; \n  for (int i = 1; i <= n; i++) \n    if (update(i)) q.push(i), vis[i] = 1;\n  while (!q.empty()) {\n    int k = q.front();\n    q.pop();\n    int color[10];\n    int t = 0;\n    for (int i = 0; i < 4; i++) {\n      if (move(a[k], b[k], dir[i])) \n        color[++t] = (*it).second;\n      if (move(c[k], d[k], dir[i])) \n        color[++t] = (*it).second;\n    }\n    for (int i = 1; i <= t; i++) {\n      if (!vis[color[i]] && update(color[i])) {\n        q.push(color[i]);\n        vis[color[i]] = 1;\n        del(color[i]);\n      }\n    }\n  }\n  writeln(ans.size());\n}\n\nint main() {\n#ifdef chhokmah\n  freopen(\"eliminate1.in\", \"r\", stdin);\n#endif\n  read(R), read(C), read(n);\n  for (int i = 1; i <= n; i++) {\n    read(a[i]), read(b[i]), read(c[i]), read(d[i]);\n    A[a[i]].insert(make_pair(b[i], i)), A[c[i]].insert(make_pair(d[i], i));\n    B[b[i]].insert(make_pair(a[i], i)), B[d[i]].insert(make_pair(c[i], i));\n    vis[i] = 0;\n  }\n  solve1();\n  solve2();\n  return 0; \n}\n```",
        "postTime": 1582967479,
        "uid": 35567,
        "name": "Ayers",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3341 \u3010[ZJOI2014]\u6d88\u68cb\u5b50\u3011"
    }
]