[
    {
        "content": "## \u9898\u76ee\u94fe\u63a5\uff1a[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P6554)\n\n## \u601d\u8def\uff1a\n\n**\u4e8c\u6b21\u626b\u63cf+\u6362\u6839 dp**\n\n\u9996\u5148\u5c06\u95ee\u9898\u8f6c\u6362\uff0c\u7531\u4e8e\u7535\u6d41\u662f**\u7b49\u6982\u7387\u5730**\u6d41\u5411\u4efb\u610f\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\uff0c\u6240\u4ee5\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\uff0c\u53ea\u9700\u8981\u6c42\u51fa\u8be5\u8282\u70b9\u5230\u53f6\u5b50\u8282\u70b9\u7684\u6240\u6709\u7684\u8def\u5f84\u4e0a\u7684\u70b9\u6743\u7684\u603b\u548c\uff0c\u518d\u9664\u4ee5\u8be5\u8282\u70b9\u80fd\u5230\u8fbe\u7684\u53f6\u5b50\u8282\u70b9\u7684\u6570\u91cf\uff0c\u5373\u53ef\u6c42\u5f97\u6700\u7ec8\u7b54\u6848\u3002\n\n\u8003\u8651\u4e00\u4e2a\u66b4\u529b\u70b9\u7684\u505a\u6cd5\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u975e\u53f6\u5b50\u8282\u70b9\uff0c\u5982\u4f55\u8ba1\u7b97\u8be5\u8282\u70b9\u5230\u53f6\u5b50\u8282\u70b9\u7684\u6240\u6709\u7684\u8def\u5f84\u4e0a\u7684\u70b9\u6743\u7684\u603b\u548c\u3002\n\n\u8003\u8651\u4f7f\u7528**\u6811\u5f62 dp**\n\n\u5bf9\u4e8e\u8282\u70b9 $x$ \uff0c\u8bbe\u8be5\u70b9\u7684\u70b9\u6743\u4e3a $w(x)$ \u3002\n\n $F(x)$ \u8868\u793a $x$ \u8282\u70b9\u5230\u53f6\u5b50\u8282\u70b9\u7684\u6240\u6709\u7684\u8def\u5f84\u4e0a\u7684\u70b9\u6743\u7684\u603b\u548c\uff0c $leaf(x)$ \u8868\u793a $x$ \u8282\u70b9\u80fd\u5230\u8fbe\u7684\u53f6\u5b50\u8282\u70b9\u7684\u6570\u91cf\u3002\n\n\u8003\u8651\u5982\u4e0b\u8f6c\u79fb\uff1a\n\n$$F(x) = \\sum_{y\\in Son(x)} w(x) \\ast leaf(y) + F(y)$$\n\n$$leaf(x) = \\sum_{y\\in Son(x)} leaf(y)$$\n\n\u8003\u8651\u8fb9\u754c\u6761\u4ef6\uff0c\u5f53\u4e14\u4ec5\u5f53 $x$ \u8282\u70b9\u4e3a\u53f6\u5b50\u8282\u70b9\uff1a\n\n$$F(x) = w(x),leaf(x)=1$$\n\n\u5982\u4f55\u89e3\u91ca\u8fd9\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u5462\uff0c$F(y)$ \u8868\u793a\u4ee5 $y$ \u8282\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u7684\u7b54\u6848\uff0c\u663e\u7136\u7ecf\u7531\u8282\u70b9 $y$ \u5230\u8282\u70b9 $x$ \u7684\u8def\u5f84\u6570\u4e3a\u4ee5 $y$ \u4e3a\u6839\u7684\u5b50\u6811\u7684\u53f6\u5b50\u8282\u70b9\u6570\u3002\n\n\u663e\u7136\u8be5\u5b50\u6811\u5bf9 $F(x)$ \u7684**\u8d21\u732e**\u5373\u4e3a $w(x) \\ast leaf(y)$ \u3002\n\n\u8ba1\u7b97\u5b8c $F(x)$ \u7684\u7ed3\u679c\u540e\uff0c\u8003\u8651\u5982\u4f55\u901a\u8fc7 $F(x)$ \u53bb\u8ba1\u7b97\u5176\u4ed6\u8282\u70b9\u7684\u7b54\u6848\u3002\n\n\u4ee5\u9898\u76ee\u4e2d\u7684\u6837\u4f8b\u4e3a\u4f8b\uff1a\n\n![0](https://cdn.luogu.com.cn/upload/image_hosting/anzdwftl.png)\n\n\u6b64\u65f6\uff1a\n\n+ $F(x)$ \u8868\u793a $x$ \u8282\u70b9\u5230\u53f6\u5b50\u8282\u70b9\u7684\u6240\u6709\u7684\u8def\u5f84\u4e0a\u7684\u70b9\u6743\u7684\u603b\u548c\u3002\n\n+ $F(y)$ \u8868\u793a $y$ \u8282\u70b9\u5230\u4ee5 $y$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u7684\u53f6\u5b50\u8282\u70b9\u7684\u6240\u6709\u7684\u8def\u5f84\u4e0a\u7684\u70b9\u6743\u7684\u603b\u548c\u3002\n\n\u8bbe\uff1a\n\n+ $w(x)$ \u8868\u793a $x$ \u8282\u70b9\u7684\u70b9\u6743\u3002\n\n+ $leaf(x)$ \u8868\u793a $x$ \u8282\u70b9\u80fd\u5230\u8fbe\u7684\u53f6\u5b50\u8282\u70b9\u7684\u6570\u91cf\u3002\n\n+ $root$ \u8868\u793a\u4efb\u610f\u6307\u5b9a\u7684\u6839\u8282\u70b9\uff0c\u6839\u636e\u9898\u76ee\u8981\u6c42\uff0c\u4e3a\u7b80\u4fbf\u8ba1\u7b97\uff0c $root$ \u6307\u5b9a\u4e3a\u4efb\u610f\u4e00\u4e2a**\u975e\u53f6\u5b50\u8282\u70b9**\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u4ee5 $y$ \u4e3a\u6839\u65f6 $y$ \u8282\u70b9\u5230\u6240\u6709\u53f6\u5b50\u8282\u70b9\u7684\u6240\u6709\u7684\u8def\u5f84\u4e0a\u7684\u70b9\u6743\u7684\u603b\u548c\u3002\n\n\u5f53\u4ee5 $y$ \u4e3a\u6839\u4e14 $y$ \u4e0d\u4e3a\u53f6\u5b50\u8282\u70b9\u65f6\uff0c\u53ea\u9700\u8981\u5c06 $F(y)$ \u4e0e**\u5f53\u4ee5 $y$ \u4e3a\u6839\u65f6\uff0c $x$ \u8282\u70b9\u5230\u4ee5 $x$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u7684\u53f6\u5b50\u8282\u70b9\u7684\u6240\u6709\u7684\u8def\u5f84\u4e0a\u7684\u70b9\u6743\u7684\u603b\u548c**\uff08\u5373\u4e0b\u56fe\u4e2d\u7684\u7ea2\u5708\u90e8\u5206\uff09\u8fdb\u884c\u5408\u5e76\uff1a\n\n![2](https://cdn.luogu.com.cn/upload/image_hosting/f1ux08i6.png)\n\n\u7ea2\u5708\u4e2d\u7684\u90e8\u5206\u53ef\u4ee5\u8868\u793a\u4e3a\uff1a\n\n$$F(x)-F(y)-leaf(y) \\ast w(x)$$\n\n\u8be5\u65b9\u7a0b\u53ef\u4ee5\u8fd9\u6837\u89e3\u91ca\uff1a\u4ece $x$ \u8282\u70b9\u51fa\u53d1\u5230\u4ee5 $y$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u7684\u53f6\u5b50\u8282\u70b9\u7684\u8def\u5f84\u603b\u548c\u4e3a $F(y)+leaf(y) \\ast w(x)$ \uff0c\u5bb9\u65a5\u4e00\u4e0b\u5373\u53ef\u6b63\u786e\u8868\u793a\u7ea2\u5708\u90e8\u5206\u3002\n\n\u90a3\u5982\u4f55\u8003\u8651 $x$ \u5bf9 $y$ \u7684\u8d21\u732e\u5462\uff1f\u663e\u7136 $x$ \u5bf9 $y$ \u7684\u8d21\u732e\u4e3a**\u4ee5 $x$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u53f6\u5b50\u8282\u70b9\u7684\u6570\u91cf**\u4e58\u4e0a $w(y)$ \u3002\n\n\u4e0a\u9762\u52a0\u7c97\u7684\u5185\u5bb9\u663e\u7136\u53ef\u4ee5\u7528 $leaf(root)-leaf(y)$ \u6765\u8868\u793a\u3002\n\n\u8d21\u732e\u5373\u4e3a\uff1a\n\n$$(leaf(root)-leaf(y)) \\ast w(y)$$\n\n\u5c06\u4e0a\u8ff0\u65b9\u7a0b\u4e0e $F(y)$ \u5408\u5e76\uff0c\u53ef\u5f97\uff1a\n\n$$F(y)=F(x)-F(y)-leaf(y)\\ast w(x)+(leaf(root)-leaf(y))\\ast w(y)+F(y)$$\n\n\u5f53 $y$ \u4e3a\u53f6\u5b50\u8282\u70b9\u65f6\uff0c\u7531\u4e8e\u4e0d\u80fd\u4ece\u53f6\u5b50\u8282\u70b9\u8d70\u5230\u53f6\u5b50\u8282\u70b9\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u51cf\u53bb\u81ea\u5df1\u76f8\u5e94\u7684\u8d21\u732e\u5373\u53ef\uff1a\n\n$$F(y)=F(x)-F(y)-leaf(y)\\ast w(x)+(leaf(root)-leaf(y))\\ast w(y)$$\n\n\u51fa\u4e8e\u65b9\u4fbf\u53d9\u8ff0\uff0c\u4e0a\u8ff0\u7b49\u5f0f\u4e2d**\u5de6\u8fb9\u7684 $F(y)$ \u8868\u793a\u4ee5 $y$ \u4e3a\u6839\u65f6 $y$ \u8282\u70b9\u5230\u6240\u6709\u53f6\u5b50\u8282\u70b9\u7684\u6240\u6709\u7684\u8def\u5f84\u4e0a\u7684\u70b9\u6743\u7684\u603b\u548c**\uff0c\u53f3\u8fb9\u7684 $F(y)$ **\u8868\u793a $y$ \u8282\u70b9\u5230\u4ee5 $y$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u7684\u53f6\u5b50\u8282\u70b9\u7684\u6240\u6709\u7684\u8def\u5f84\u4e0a\u7684\u70b9\u6743\u7684\u603b\u548c**\u3002\n\n\u7531\u4e8e\u6bcf\u4e2a\u8282\u70b9\u5230\u5176\u80fd\u5230\u7684\u53f6\u5b50\u8282\u70b9\u7684\u6982\u7387\u662f\u76f8\u7b49\u7684\uff0c\u6240\u4ee5\u6700\u7ec8\u7684\u7b54\u6848\u5c31\u662f\uff1a\n\n$$\\max\\{\\dfrac{F(x)}{leaf(root)}\\},deg_x>1$$\n\n$$\\max\\{\\dfrac{F(x)}{leaf(root)-1}\\},deg_x=1$$\n\n\n\u5230\u8fd9\u91cc\u8fd9\u9053\u9898\u57fa\u672c\u4e0a\u5c31\u7ed3\u675f\u4e86\uff0c\u4f46\u662f\u6bd2\u7624\u51fa\u9898\u4eba\u5361\u4e86\u94fe\u7684\u90e8\u5206\u5206\uff08\u4f1a\u7206 long long \uff09\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5bf9\u94fe\u7684\u90e8\u5206\u5206\u8fdb\u884c\u7279\u5224\u3002\n\n\u5bf9\u4e8e\u4e00\u6761\u94fe\uff0c\u5f53\u8d77\u70b9\u5728\u53f6\u5b50\u8282\u70b9\u65f6\uff0c\u94fe\u4e2d\u6240\u6709\u7684\u8282\u70b9\u4e00\u5b9a\u90fd\u4f1a\u88ab\u7ecf\u8fc7\u4e00\u6b21\uff0c\u800c\u5f53\u8d77\u70b9\u4e3a\u975e\u53f6\u5b50\u8282\u70b9\uff0c\u8d77\u70b9\u4f1a\u88ab\u7ecf\u8fc7\u4e24\u6b21\u3002\u5bf9\u4e8e\u975e\u53f6\u5b50\u8282\u70b9\uff0c\u8d2a\u5fc3\u53d6\u6743\u503c\u6700\u5927\u7684\u4f5c\u4e3a\u8d77\u70b9\u5373\u53ef\uff08\u663e\u7136\u5176\u4ed6\u8282\u70b9\u4f5c\u4e3a\u8d77\u70b9\u4e0d\u53ef\u80fd\u66f4\u4f18\uff09\u3002\u6700\u7ec8\u7b54\u6848\u4e24\u8005\u53d6\u6700\u5927\u5373\u53ef\uff1a\n\n$$\\max(\\sum_{i=1}^n w_i,\\dfrac{\\sum_{i=1}^n w_i+\\max_{i=1}^n\\{w_i\\}}{2})$$\n\n## \u4ee3 \u7801 \u653e \u9001\uff1a\n\n\u65e2\u7136\u4f60\u80fd\u627e\u5230\u8fd9\u9898\uff0c\u6211\u76f8\u4fe1\u4f60\u80fd\u77ac\u95f4\u505a\u51fa\u6765\u7684\u3002\n\n$Code:$\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst long long N=500010,M=5000010,INF=0x3f3f3f3f;\nlong long head[N],ver[M],Next[M],tot;\nlong long n,root,d[N],v[N],deg[N];\nlong double ans=-INF,num,sum,F[N],w[N],leaf[N];\ninline long double Max(long double x,long double y){return x>y?x:y;}\ninline long double Min(long double x,long double y){return x<y?x:y;}\nvoid add(long long x,long long y){\n\tver[++tot]=y,Next[tot]=head[x],head[x]=tot;\n}\nvoid dfs1(long long x,long long fa){\n\tbool flag=0;\n\tfor(long long i=head[x];i;i=Next[i]){\n\t\tlong long y=ver[i];\n\t\tif(y==fa)continue;\n\t\tdfs1(y,x);flag=1;\n\t\tleaf[x]+=leaf[y];\n\t\tF[x]+=(w[x]*leaf[y])+F[y];\n\t}\n\tif(!flag){\n\t\tleaf[x]=v[x]=1;\n\t\tF[x]=w[x];++num;\n\t}\n}\nvoid dfs2(long long x,long long fa){\n\tfor(long long i=head[x];i;i=Next[i]){\n\t\tlong long y=ver[i];\n\t\tif(y==fa)continue;\n\t\tif(!v[y])F[y]=(F[x]-leaf[y]*w[x]+(num-leaf[y])*w[y]);\n\t\telse F[y]=(F[x]-F[y]-leaf[y]*w[x]+(num-leaf[y])*w[y]);\n\t\tdfs2(y,x);\n\t}\n\tF[x]/=(v[x])?num-1.0:num;\n\tans=Max(ans,F[x]); \n}\nvoid solve(){\n\tfor(long long i=1;i<=n;i++)\n\t\tans=Max(ans,w[i]);\n\tprintf(\"%.4lf\",(double)Max(sum,(sum+ans)/2.0));\n}\nint main(){\n\tscanf(\"%lld\",&n);\n\tfor(long long i=1;i<n;i++){\n\t\tlong long x,y;\n\t\tscanf(\"%lld%lld\",&x,&y);\n\t\tadd(x,y),add(y,x);\n\t\t++deg[x],++deg[y];\n\t\tif(deg[x]>1)root=x;\n\t\tif(deg[y]>1)root=y;\n\t}\n\tfor(long long i=1;i<=n;i++)\n\t\tscanf(\"%Lf\",&w[i]),sum+=w[i];\n\tdfs1(root,0);\n\tif(leaf[root]==2){solve();return 0;}\n\tdfs2(root,0);\n\tprintf(\"%.4lf\",(double)ans);\n\treturn 0;\n}\n```",
        "postTime": 1605183346,
        "uid": 137242,
        "name": "Dia\u043esi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6554 \u3010Promises I Can't Keep\u3011"
    },
    {
        "content": "~~\u672c\u6765T2\u662f\u4e2aDS\u9898\u7684\uff0c\u4f46\u662f\u53d1\u73b0\u649e\u9898\u4e4b\u540e\u5c31\u6362\u4e0a\u4e86\u8fd9\u4e00\u9053~~\n\n\u5148\u6765\u770b\u90e8\u5206\u5206\u5427\n\n#### subtask 0\n\u7b80\u5355\u66b4\u529b\uff0c\u4ee5\u6bcf\u4e2a\u70b9\u4e3a\u6839\u505a\u4e00\u904ddp\n\n#### subtask 1\n\u94fe\u7684\u60c5\u51b5\u5927\u6982\u53ef\u4ee5\u524d\u7f00\u548c\u4e71\u641e\uff0c\u4e0d\u591a\u8bf4\u4e86\n\n#### \u6b63\u89e3\n\u6362\u6839dp\uff08\u4e2a\u4eba\u611f\u89c9\u4e0d\u96be\u60f3\u5427\uff09\n\n\u4ee4 $cnt_u$ \u4e3a\u4ee5 $u$ \u4e3a\u6839\u8282\u70b9\u7684\u5b50\u6811\u4e2d\u53f6\u5b50\u8282\u70b9\u7684\u4e2a\u6570\n\n\u8bbe $g_u$ \u4e3a\u4ee5 $u$ \u4e3a\u6839\u8282\u70b9\u7684\u671f\u671b\u503c $\\times cnt_u$\uff0c\u8fd9\u91cc\u4e58\u662f\u4e3a\u4e86\u7cbe\u5ea6\u4e0d\u8981\u6709\u8bef\u5dee\n\n\u8bbe $f_u$ \u4e3a\u4ee5 $u$ \u4e3a\u6839\u8282\u70b9\u7684\u6574\u4e2a\u6811\u7684\u671f\u671b\u503c\u4e58\u4ee5 $u$ \u4e3a\u6839\u8282\u70b9\u7684\u6574\u68f5\u6811\u4e2d\u7684\u53f6\u5b50\u8282\u70b9\u4e2a\u6570\n\n\u7b2c\u4e00\u6b21dfs\u9884\u5904\u7406\u51fa $g$ \u548c $cnt$\n\n\u663e\u7136\u6709\uff1a  \n\u5f53 $u$ \u4e3a\u53f6\u5b50\u8282\u70b9\u65f6 $cnt_u=1$\uff0c$g_u=val_u$  \n\u5f53 $u$ \u4e3a\u975e\u53f6\u5b50\u8282\u70b9\u65f6 $cnt_u=\\sum_{v\\in son_u}cnt_v$\uff0c$g_u=val_u\\times cnt_u+\\sum_{v\\in son_u}g_v$\n\n\u7b2c\u4e8c\u6b21dfs\u8ba1\u7b97 $f$\n\n\u663e\u7136\u6709\uff1a  \n\u5f53 $u$ \u4e3a\u6839\u8282\u70b9\u65f6 $f_{u}=g_{u}$  \n\u5f53 $u$ \u4e3a\u53f6\u5b50\u8282\u70b9\u65f6 $f_u=f_{fa}-val_u-val_{fa}+(cnt_{root}-1)\\times val_u$  \n\u6574\u7406\u5f97\uff1a$f_u=f_{fa}-val_{fa}+(cnt_{root}-2)\\times val_u$  \n\u5f53 $u$ \u4e3a\u975e\u53f6\u5b50\u8282\u70b9\u65f6 $f_u=f_{fa}-g_u-cnt_u\\times val_{fa}+g_u+(cnt_{root}-cnt_u)\\times val_u$  \n\u6574\u7406\u5f97\uff1a$f_u=f_{fa}-cnt_u\\times val_{fa}+(cnt_{root}-cnt_u)\\times val_u$\n\ncode:\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define MAXN 500010\nusing namespace std;\nint n,rt;\ndouble val[MAXN];\ndouble f[MAXN],g[MAXN];\nint cnt[MAXN],lef[MAXN];\nstruct Node{int to,next;}Edge[MAXN<<1];\nint Head[MAXN],cnt_Edge;\nvoid Add_Edge(int u,int v){Edge[++cnt_Edge]=(Node){v,Head[u]};Head[u]=cnt_Edge;}\nvoid dp1(int u,int fa)\n{//\u7b2c\u4e00\u6b21dfs\n\tfor(int i=Head[u];i;i=Edge[i].next)\n\t{\n\t\tint v=Edge[i].to;\n\t\tif(v==fa)continue;\n\t\tdp1(v,u);cnt[u]+=cnt[v];\n\t\tg[u]+=g[v];\n\t}\n\tg[u]+=val[u]*cnt[u];\n\tif(!cnt[u])g[u]=val[u],cnt[u]=1,lef[u]=1;\n}\nvoid dp2(int u,int fa)\n{//\u7b2c\u4e8c\u6b21dfs\n\tfor(int i=Head[u];i;i=Edge[i].next)\n\t{\n\t\tint v=Edge[i].to;\n\t\tif(v==fa)continue;\n\t\tif(lef[v])f[v]=f[u]-val[u]+val[v]*(cnt[rt]-2);\n\t\telse f[v]=f[u]-val[u]*cnt[v]+val[v]*(cnt[rt]-cnt[v]);\n\t\tdp2(v,u);\n\t}\n}\nsigned main()\n{\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint u,v;scanf(\"%lld%lld\",&u,&v);\n\t\tAdd_Edge(u,v);Add_Edge(v,u);\n\t}\n\tfor(int i=1;i<=n;i++)scanf(\"%lf\",&val[i]);\n\tfor(int i=1;i<=n;i++)\n\t\tif(Edge[Head[i]].next!=0){rt=i;break;}//\u627e\u975e\u53f6\u5b50\u8282\u70b9\u4e3a\u6839\n\tdp1(rt,0);f[rt]=g[rt];dp2(rt,0);\n\tdouble ans=-99999999999;\n\tfor(int i=1;i<=n;i++)ans=max(ans,f[i]/(cnt[rt]-lef[i]));//\u8ba1\u7b97\u671f\u671b\n\tprintf(\"%.4lf\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1587649699,
        "uid": 65681,
        "name": "UltiMadow",
        "ccfLevel": 7,
        "title": "[\u9898\u89e3] Promises I Can't Keep"
    },
    {
        "content": "UM \u7684\u795e\u9898\uff01 /qq\n\n\u6bd4\u8d5b\u6ca1\u591a\u5c11\u65f6\u95f4\u53ea\u6253\u4e86 20 \u591a\u5206\u949f\uff0c\u4e00\u53d1 WA \u6389\u4e86\uff08\n\n\u56e0\u4e3a\u4e0d\u4f1a T6 \u6240\u4ee5\u6765\u770b\u8fd9\u9053\u4e86\u3002\u3002\u3002\n\n---\n\n\u601d\u8def\u662f\u627e\u5230\u4e00\u4e2a **\u4e0d\u662f\u53f6\u5b50\u8282\u70b9** \u7684\u8282\u70b9\u5f53\u505a\u6574\u68f5\u6811\u7684\u6839\uff0c\u5c06\u6574\u68f5\u6811\u8f6c\u6362\u6210\u6709\u6839\u6811\u8fdb\u884c dp\u3002\n\n\u76ee\u6807\u662f\u6c42\u51fa\u8fd9\u4e2a\u8282\u70b9\u5b50\u6811\u6709\u591a\u5c11\u4e2a\u53f6\u5b50\u8282\u70b9\u4ee5\u53ca\u6839\u8282\u70b9\u7684\u7b54\u6848\u3002\n\n\u8bbe\u5f53\u524d\u8282\u70b9 $i$ \u7684\u7b54\u6848\u4e58\u4e0a $leaf_i$ \u4e3a $val_i$\uff0c\u6709 $leaf_i$ \u4e2a\u53f6\u5b50\u8282\u70b9\u3002\n\n- \u5982\u679c\u5f53\u524d\u8282\u70b9 $i$ \u4e3a\u53f6\u5b50\u8282\u70b9\uff0c$val_i$ \u663e\u7136\u4e3a $a_i$\uff1b   \n- \u5426\u5219\uff0c\u8ba1\u7b97\u6240\u6709\u513f\u5b50\u7684\u7b54\u6848\u5e76\u52a0\u4e0a\u6240\u6709\u7684\u8d21\u732e\uff0c$val_i = a_i \\times leaf_i +\\sum_{j \\in \\texttt{\u4ee5i\u4e3a\u7236\u4eb2\u7684\u8282\u70b9}} val_j$\u3002\n\n\u5f97\u5230\u4e86\u6839\u8282\u70b9\u7684\u7b54\u6848\u3002\u518d\u6b21\u8ba1\u7b97 $dp$\uff0c$dp_i$ \u610f\u4e3a\u4ee5 $i$ \u4e3a\u6839\u8282\u70b9\u7684\u6574\u68f5\u6811\u7684\u7b54\u6848\u4e58\u4e0a\u4ee5 $i$ \u4e3a\u6839\u8282\u70b9\u540e\u6574\u68f5\u6811\u7684\u53f6\u5b50\u6570\uff0c\u8bbe\u8282\u70b9 $i$ \u7684\u7236\u4eb2\u4e3a $fa_i$\uff0c\u6574\u68f5\u6811\u6709 $lev$ \u4e2a\u53f6\u5b50\u8282\u70b9\u3002\n\n\u73b0\u5728\u53ef\u4ee5\u770b\u6210\u65e0\u6839\u6811\uff0c\u901a\u8fc7\u4ee5\u524d\u8ba1\u7b97\u51fa\u7684\u7b54\u6848\u8fdb\u884c\u8ba1\u7b97\u3002\u4e5f\u5c31\u662f \u6362\u6839 dp\u3002\n\n- \u6839\u8282\u70b9\u8df3\u8fc7\uff0c$dp_i=val_i$\uff1b   \n- \u53f6\u5b50\u8282\u70b9\uff0c\u8981\u901a\u8fc7\u7236\u4eb2\u8282\u70b9\u53ca\u539f\u8bbe\u6839\u8282\u70b9\u8ba1\u7b97\uff0c\u5219 $dp_i=dp_{fa_i}-a_{fa_i}+(lev-2) \\times a_i$\uff1b   \n- \u975e\u53f6\u5b50\u8282\u70b9\uff0c\u5219 $dp_i=dp_{fa_i}-a_{fa_i} \\times leaf_i + a_i \\times (lev-leaf_i)$\u3002\n\n\u4ee3\u7801\u4e2d\u4e0e\u8bb2\u89e3\u548c\u65b9\u7a0b\u4e2d\u7684\u5b57\u6bcd\u542b\u4e49\u53ef\u80fd\u4e0d\u540c\u3002\n\n\u5e38\u6570\u8f83\u5927\uff0c\u8bf7\u6253\u5f00 `O2` \u5f00\u5173\uff0c\u5426\u5219\u4f1a\u8d85\u65f6\u3002\n\n\u53e6\u5916\uff0c\u53bb\u6389 `SpecialSolve` \u4e4b\u540e\u4f1a\u6302\u6389\u94fe\u7684\u70b9\uff08\u56e0\u4e3a UM \u6570\u636e\u51fa\u7684\u6bd2\u7624\uff09\uff0c\u6240\u4ee5\u8bf4\u8981\u52a0\u7279\u5224\uff0c\u4e5f\u5c31\u662f\u5982\u679c\u6811\u662f\u94fe\uff0c\u7b54\u6848\u4e3a $\\max(sum,\\dfrac{sum+\\max\\{a_i\\}}{2})$\u3002\u5176\u4e2d $sum = \\sum_{i=1}^n a_i$\u3002\n\n\u6b22\u8fce hack\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nvector<long long> G[500005];\nlong double maxsss=-9999999999;\nlong long root=0;\nlong long n,depth[500005],apart[500005],leaf[500005];\nlong double val[500005],dp[500005],a[500005],sum;\nnamespace SpecialSolve\n{\n\tvoid Main(int root){\n\t\tprintf(\"%.4Lf\",(sum+maxsss)/2);\n\t}\n}\nvoid Check()\n{\n\tint one=0,two=0,roots=0;\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\tif(G[i].size()==1)\t++one,roots=i;\n\t\tif(G[i].size()==2)\t++two;\n\t}\n\tif(one==2 && two==n-2)\n\t{\n\t\tSpecialSolve::Main(roots);\n\t\texit(0);\n\t}\n}\nvoid dfs1(long long now,long long pre)\n{\n\tfor(unsigned long long i=0;i<G[now].size();++i)\n\t{\n\t\tlong long to=G[now][i];\n\t\tif(to==pre)\tcontinue;\n\t\tdfs1(to,now);\n\t\tleaf[now]+=leaf[to];\n\t\tval[now]+=val[to];\n\t}\n\tval[now]+=a[now]*leaf[now];\n\tif(leaf[now]==0)\tval[now]=a[now],leaf[now]=1;\n}\nvoid dfs2(long long now,long long pre)\n{\n//\tif(now!=1)\tval[now]+=(val[pre]-val[now]*leaf[now])*(leaf[pre]-leaf[now]);\n\tfor(unsigned long long i=0;i<G[now].size();++i)\n\t{\n\t\tlong long to=G[now][i];\n\t\tif(to==pre)\tcontinue;\n\t\tif(G[to].size()==1u)\tdp[to]=dp[now]-a[now]+a[to]*(leaf[root]-2);\n\t\telse\tdp[to]=dp[now]-a[now]*leaf[to]+a[to]*(leaf[root]-leaf[to]);\n\t\tdfs2(to,now);\n\t}\n}\nint main(){\n\tscanf(\"%lld\",&n);\n\tfor(long long i=2;i<=n;++i)\n\t{\n\t\tlong long u,v;\n\t\tscanf(\"%lld %lld\",&u,&v);\n\t\tG[u].push_back(v);\n\t\tG[v].push_back(u);\n\t}\n\tbool flag=true;\n\tfor(long long i=1;i<=n;++i)\tscanf(\"%Lf\",&a[i]),sum+=a[i],flag&=(a[i]>0),maxsss=max(maxsss,a[i]);\n\tCheck();\n\tlong long leaves=0;\n\tfor(long long i=1;i<=n;++i)\tif(G[i].size()==1u)\t++leaves;\n\tfor(long long i=1;i<=n;++i)\n\t{\n\t\tif(G[i].size()==1u)\tapart[i]=leaves-1;\n\t\telse\tapart[i]=leaves,root=i;\n\t}\n\tdfs1(root,0);\n\tdp[root]=val[root];\n//\tfor(long long i=1;i<=n;++i)\tprintf(\"%lld\\n\",val[i]);\n\tdfs2(root,0);\n\tlong double ans=-998244353000;\n\tfor(long long i=1;i<=n;++i)\tans=max(ans,dp[i]/(long double)(leaf[root]-(leaf[i]==1?1:0)));\n\tprintf(\"%.4Lf\",ans);\n\treturn 0;\n}\n```\n\n\u771f\u7684\u5f88\u6162\uff0c\u6211\u4e5f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u771f\u7684\u5f88\u6162\u3002",
        "postTime": 1589244513,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6554 \u3010Promises I Can't Keep\u3011"
    },
    {
        "content": "\u521a\u5f00\u59cb\u7406\u89e3\u9519\u9898\u610f\u4e86\uff0c\u4ee5\u4e3a\u662f\u7535\u6d41\u4f1a\u7b49\u6982\u7387\u7684\u6d41\u5411\u5b83\u7684\u513f\u5b50\u8282\u70b9\uff0c\u6070\u597d\u6837\u4f8b\u53c8\u53ef\u4ee5\u8fc7\uff0c\u7ed3\u679c\u5c31\u4e00\u76f4WA\uff0c\u6240\u4ee5\u8bf4\u8bed\u6587\u8fd8\u662f\u5f88\u91cd\u8981\u7684.\n\n------------\n\u603b\u7ed3\u4e00\u4e0b\u9898\u610f\uff0c\u6c42\u7684\u662f\u6240\u6709\u4ee5$u$\u4e3a\u6839\u7684\u53f6\u5b50\u8282\u70b9\u5230$u$\u7684\u8def\u5f84\u548c\u9664\u4ee5$u$\u4e3a\u6839\u7684\u53f6\u5b50\u8282\u70b9\u6570\u91cf\u7684\u6700\u5927\u503c,\u5f88\u660e\u663e\u53ef\u4ee5\u7528\u6362\u6839DP\u6765\u505a.\n\n\u5047\u8bbe\u7b2c\u4e00\u904ddfs\u65f6\u7684\u6839\u4e3a$root,f_u$\u8868\u793a\u8def\u5f84\u548c,$w_u$\u8868\u793a\u8be5\u70b9\u7684\u6743\u503c,$cnt_u$\u8868\u793a\u4ee5$u$\u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u53f6\u5b50\u8282\u70b9\u7684\u6570\u91cf.\n\n\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u4f5c\u4e3a\u6839\n\u82e5\u5f53\u524d\u8282\u70b9$v$\u4e3a\u4e4b\u524d\u7684\u53f6\u5b50\u8282\u70b9\n\n$f_v=f_u-w_u-w_v-(cnt_{root}-1)*w_v$\n\n\u82e5\u4e0d\u662f\n\n$f_v=f_u-w_u*cnt_v+(cnt_{root}-cnt_v)*w_v$\n\n\u663e\u7136,\u53ea\u9700\u8981\u7b2c\u4e00\u904ddfs\u662f\u6c42\u51fa$f_{root},cnt$\u5c31\u53ef\u4ee5\u4e86.\n\n\u4ee3\u7801\n```\n#include<iostream>\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nconst int N = 1e6 + 5;\n\nint head[N], ver[N], net[N], idx;\nint cnt[N], dg[N], root;\nbool is[N];\ndouble sum[N], f[N], w[N];\n\nvoid add(int a, int b)\n{\n    net[idx] = head[a];\n    ver[idx] = b;\n    head[a] = idx++;\n}\n\nvoid dfs1(int u, int fa)\n{\n    for (int i = head[u]; ~i; i = net[i])\n    {\n        int v = ver[i];\n        if (v == fa)\n            continue;\n        dfs1(v, u);\n        cnt[u] += cnt[v];\n        sum[u] += sum[v] + w[u] * cnt[v];\n    }    \n    if (!cnt[u])\n        sum[u] = w[u], cnt[u] = 1, is[u] = true;\n}\n\nvoid dfs2(int u, int fa)\n{\n    for (int i = head[u]; ~i; i = net[i])\n    {\n        int v = ver[i];\n        if (v == fa)\n            continue;\n        if (is[v])\n            f[v] = f[u] - w[u] + (cnt[root] - 2) * w[v];\n        else\n            f[v] = f[u] - w[u] * cnt[v] + (cnt[root] - cnt[v]) * w[v];\n        dfs2(v, u);\n    }\n}\n\nint main()\n{\n    memset(head, -1, sizeof(head));\n    int n;\n    scanf(\"%d\", &n);\n    for (int i = 1; i < n; i++)\n    {\n        int u, v;\n        scanf(\"%d%d\", &u, &v);\n        add(u, v), add(v, u);\n        dg[u]++, dg[v]++;\n    }\n    for (int i = 1; i <= n; i++)\n    {\n        scanf(\"%lf\", &w[i]);      \n        if (dg[i] > 1)\n            root = i;//\u627e\u51fa\u6839\u8282\u70b9\n    }\n    dfs1(root, 0);\n    f[root] = sum[root];\n    dfs2(root, 0);\n    double ans = -1e13;\n    for (int i = 1; i <= n; i++)\n        ans = max(ans, (double)f[i] / (cnt[root] - is[i]));//\u8ba1\u7b97\u671f\u671b\n    printf(\"%.4lf\", ans);\n    return 0;\n}\n```\n\n",
        "postTime": 1613953264,
        "uid": 277863,
        "name": "BzhH",
        "ccfLevel": 6,
        "title": "\u9898\u89e3P6554 Promises I Can't Keep"
    },
    {
        "content": "# Promises I Can't Keep\n\n\u9a8c\u9898\u4eba\u8fc7\u6765\u5199\u4e00\u53d1\u9898\u89e3\u3002\n\n\u7b80\u5316\u4e00\u4e0b\uff1a\u4e00\u68f5\u6811\uff0c\u9009\u62e9\u4e00\u4e2a\u8282\u70b9\u4e3a\u6839\uff0c\u7b49\u6982\u7387\u9009\u62e9\u4e00\u4e2a\u513f\u5b50\uff0c\u7136\u540e\u8fd9\u6837\u4e0b\u53bb\u5f97\u5230\u4e00\u6761\u94fe\u3002\u6c42\u51fa\u5e94\u8be5\u9009\u62e9\u54ea\u4e2a\u6839\uff0c\u624d\u80fd\u8ba9\u94fe\u7684\u671f\u671b\u6743\u503c\u548c\u6700\u5927\u3002\n\n## $\\texttt{Subtask 0}$\n\n\u4e00\u5f00\u59cb\u60f3\u5230\u7684\u6811\u5f62 $dp$\uff0c\u66b4\u529b\u679a\u4e3e\u6839\uff0c\u7136\u540e $f_{u}$ \u8868\u793a\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\uff0c\u5f97\u5230\u7684\u671f\u671b\u6743\u503c\u548c\u3002$cnt_u$ \u6307\u5b57\u6570\u5185\u53f6\u8282\u70b9\u6570\u91cf\u3002\n\n$f_u=\\frac{\\sum f_v\\times cnt_v}{cnt_u}+a_u$\n\n\u6700\u540e\u904d\u5386\u6240\u6709\u6839\u5373\u53ef\u3002\n\n```cpp\nint a[N],cnt[N]; double f[N];\nvoid dfs(int u,int fa){\n\tf[u]=0; cnt[u]=0;\n\tfor(int i=hd[u],v;i;i=e[i].nxt)\n\t\tif((v=e[i].to)!=fa){\n\t\t\tdfs(v,u);\n\t\t\tf[u]+=f[v]*cnt[v],cnt[u]+=cnt[v];\n\t\t}\n\tif(!cnt[u]) f[u]=a[u],cnt[u]=1;\n\telse f[u]=f[u]*1./cnt[u]+a[u];\n}\nsigned main(){\n\tint n; scanf(\"%lld\",&n); double ans=-1e18;\n\tfor(int i=1,u,v;i<n;i++) scanf(\"%lld%lld\",&u,&v),add(u,v),add(v,u);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&a[i]);\n\tfor(int i=1;i<=n;i++){dfs(i,0); ans=max(ans,f[i]);}\n\tprintf(\"%.4lf\",ans);\n\treturn 0;\n}\n```\n\n\n## $\\texttt{Subtask 1}$\n\n\u5bf9\u4e8e\u4e00\u6761\u94fe\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u4f18\u5316\u8ba1\u7b97 $f$\uff0c\u5373\u5728 $O(1)$ \u7684\u65f6\u95f4\u7b97\u51fa\u4ee5 $i$ \u4e3a\u6839\u7684\u671f\u671b\u6743\u503c\u548c\u3002\n\n\u5373\u679a\u4e3e $x$\uff0c\u6c42$\\max {(sum_{(1,x-1)}+sum_{(x+1,n)})/2+ax}$\n\n```cpp\nfor(int x=2;x<n;x++) ans=max(ans,(s[n]-a[x])/2.+a[x]);\nans=max(ans,s[n]*1.);\n```\n\n## $\\texttt{Subtask 2}$\n\n\u6211\u4eec\u8fd8\u662f\u770b $\\texttt{Subtask 1}$\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u6362\u6839 $dp$ \u7684\u601d\u60f3\uff08\u88ab\u51fa\u70c2\u7684qwq\uff09\uff0c\u603b\u4f53\u8fdb\u884c\u4e24\u6b21 $dfs$\uff0c\u7136\u540e\u4fbf\u53ef\u6c42\u5f97\u6bcf\u4e00\u4e2a\u70b9\u4e3a\u6839\u7684\u65f6\u5019\u7684\u671f\u671b\u503c\u3002\n\n```cpp\nint n,root,cnt[N]; double a[N],f[N],g[N],ans=-2e18; bool isLeaf[N];\nvoid dfs(int u,int fa){\n\tfor(int i=hd[u],v;i;i=e[i].nxt)\n\t\tif((v=e[i].to)!=fa){\n\t\t\tdfs(v,u);\n\t\t\tcnt[u]+=cnt[v], f[u]+=f[v]; //cnt\u4e3a\u5b50\u6811\u5185\u53f6\u5b50\u8282\u70b9\uff0cf\u4e3a\u5b50\u6811\u4e2d\u7684\u603b\u7b54\u6848 \n\t\t}\n\tif(isLeaf[u]) cnt[u]=1;\n\tf[u]+=a[u]*cnt[u];\n}\nvoid dfs2(int u,int fa){\n\tif(u==root) g[u]=f[u];\n\tfor(int i=hd[u],v;i;i=e[i].nxt)\n\t\tif((v=e[i].to)!=fa){\n\t\t\tif(isLeaf[v]) g[v]=g[u]-a[u]+a[v]*(cnt[root]-2);\n\t\t\telse g[v]=g[u]-a[u]*cnt[v]+a[v]*(cnt[root]-cnt[v]);\n\t\t\tdfs2(v,u);\n\t\t}\n}\nsigned main(){\n\tscanf(\"%lld\",&n);\n\tfor(int i=1,u,v;i<n;i++)\n\t\tscanf(\"%lld%lld\",&u,&v), add(u,v), add(v,u);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%lf\",&a[i]);\n\t\tif(ecnt[i]>1) root=i;\n\t\telse isLeaf[i]=1;\n\t}\n\tdfs(root,0), dfs2(root,0);\n\tfor(int i=1;i<=n;i++) ans=max(ans,g[i]/(cnt[root]-isLeaf[i]));\n\tprintf(\"%.4lf\",ans);\n\treturn 0;\n}\n```\n\n\u8865\u5145\u4e00\u4e0b\uff1a\u5bf9\u4e8e\u9519\u4e86 $\\texttt{Subtask 1}$ \u7684\u4eba\uff0c\u4f60\u4eec\u7684\u9519\u8bef\u539f\u56e0\u5e94\u8be5\u662f $ans$ \u521d\u59cb\u5316\u592a\u5927\uff08\u9700\u8981\u662f\u4e00\u4e2a\u5f88\u5c0f\u7684\u8d1f\u6570\uff09\u6216\u8005\u6ca1\u6709\u8003\u8651\u5230\u8d1f\u6570\u7684\u60c5\u51b5\u3002\u56e0\u4e3a\u9a8c\u9898\u7684\u65f6\u5019\u6211\u5f3a\u70c8\u8981\u6c42\u52a0\u5f3a\u8fd9\u4e2a Subtask \u9632\u6b62\u6709\u4eba\u76f4\u63a5\u8f93\u51fa $\\sum a$ \u6c34\u8fc7\u53bb\u3002",
        "postTime": 1589267012,
        "uid": 180652,
        "name": "_lgswdn",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P6554 \u3010Promises I Can't Keep\u3011"
    },
    {
        "content": "## \u3010\u9898\u610f\u3011\n\u8def\u5f84\u957f\u5ea6\u5b9a\u4e49\u4e3a\u8fde\u63a5\u6811\u4e0a\u4e24\u70b9\u7684\u94fe\u4e0a\u7684\u8282\u70b9\u7684\u6743\u503c\u548c\n\n\u67d0\u4e2a\u70b9\u7684\u671f\u671b\u5f97\u5206\u662f\u8fde\u63a5\u8fd9\u4e2a\u70b9\u5230\u53f6\u5b50\u8282\u70b9\u7684\u94fe\u7684\u671f\u671b\u957f\u5ea6\n\n\u6c42\u6700\u5927\u7684\u671f\u671b\u5f97\u5206\n## \u3010\u5206\u6790\u3011\n\u628a$x$\u7684\u671f\u671b\u5f97\u5206\u5c55\u5f00\n\n\u4ece$x$\u51fa\u53d1\u5230\u6240\u6709\u53f6\u5b50\u8282\u70b9\u7684\u8def\u5f84\u957f\u5ea6\u4e4b\u548c/\u4ee5$x$\u4e3a\u7aef\u70b9\u7684\u8def\u5f84\u6570\n\n\u8def\u5f84\u957f\u5ea6\u548c\u901a\u8fc7**\u6362\u6839DP**\u6c42\uff0c\u8def\u5f84\u6570\u76f4\u63a5\u7edf\u8ba1\n\n\u9996\u5148\u9700\u8981\u8ba1\u7b97\u6839\u8282\u70b9\u7684\u8def\u5f84\u957f\u5ea6\u548c\n\n\u6839\u8282\u70b9\u4e0d\u80fd\u9009\u62e9\u53f6\u8282\u70b9\n\n$g[x]$\u8868\u793a\u4ee5$x$\u4e3a\u6839\u7684\u5b50\u6811\u4e2d\uff0c$x$\u5230\u6240\u6709\u53f6\u8282\u70b9\u7684\u8def\u5f84\u957f\u5ea6\u548c\n\n$siz[x]$\u8868\u793a\u4ee5$x$\u4e3a\u6839\u7684\u5b50\u6811\u4e2d\uff0c\u53f6\u8282\u70b9\u7684\u6570\u91cf\n\n$a[x]$\u8868\u793a\n\n* $x$\u662f\u53f6\u5b50\n\n\t$g[x]=a[x]$\n   \n   \u4fbf\u4e8e\u4e4b\u540e\u8f6c\u79fb\n* $x$\u4e0d\u662f\u53f6\u5b50\n\t\n   $g[x]=siz[x]*a[x]+\\sum_{y|son[x]}{g[y]}$\n   \n   \u8868\u793a\u6240\u6709\u5b50\u6811\u7684\u8def\u5f84\u957f\u5ea6\u548c\u90fd\u589e\u52a0\u4e86$a[x]$\n   \n\u4e8e\u662f\u5f97\u5230\u4e86$g[rt]$\uff0c\u5373\u6839\u8282\u70b9\u7684\u8def\u5f84\u957f\u5ea6\u548c\n\n\u63a5\u4e0b\u6765\u5f80\u4e0b\u8f6c\u79fb\n\n$f[x]$\u8868\u793a\u5728\u6574\u68f5\u6811\u4e2d\uff0c$x$\u5230\u5230\u6240\u6709\u53f6\u5b50\u8282\u70b9\u7684\u8def\u5f84\u957f\u5ea6\u548c\n\n* $x$\u662f\u6839\n\n\t$f[x]=g[x]$\n* $x$\u662f\u53f6\u5b50\n\n   \u4ece$fa$\u8f6c\u79fb\u5230$x$\uff0c\u6709$siz[rt]-1$\u6761\u8def\u5f84\u957f\u5ea6\u4f1a\u589e\u52a0$a[x]$\uff0c\u5e76\u4e14\u4f1a\u5931\u53bb\u4e00\u6761\u4ece$fa$\u5230$x$\u7684\u8def\u5f84\uff0c\u957f\u5ea6\u662f$a[x]+a[fa]$\n\n\t$f[x]=f[fa]+(siz[rt]-1)* a[x]-a[fa]-a[x]=f[x]+(siz[rt]-2)* a[x]-a[fa]$\n\n* $x$\u4e0d\u662f\u6839\u4e5f\u4e0d\u662f\u53f6\u5b50\n\n\t\u4ece$fa$\u8f6c\u79fb\u5230$x$\uff0c\u6709$siz[rt]-siz[x]$\u6761\u8def\u5f84\u957f\u5ea6\u4f1a\u589e\u52a0$a[x]$\uff0c\u6709$siz[x]$\u6761\u8def\u5f84\u957f\u5ea6\u4f1a\u51cf\u5c11$a[fa]$\n    \n   $f[x]=f[fa]+(siz[rt]-siz[x])* a[x]-siz[x]* a[fa]$\n\n\u81f3\u6b64\uff0c\u6b64\u9898\u4fbf\u89e3\u5b8c\u4e86\n## \u3010\u7b97\u6cd5\u3011\n\u6362\u6839DP\n## \u3010\u5751\u70b9\u3011\n* \u6743\u503c\u6709\u8d1f\u6570\uff0c\u7b54\u6848\u521d\u59cb\u5e94\u8bbe\u7f6e\u4e3a\u6781\u5c0f\u503c\n\n* $5* 10^5* 10^4=5*10^9$\uff0c\u4e0d\u80fd\u5b8c\u5168\u7528int\n\n* \u53ea\u6709\u4e00\u4e2a\u70b9\u4e0d\u80fd\u6210\u4e3a\u8def\u5f84\uff0c\u7edf\u8ba1\u7b54\u6848\u65f6\u5e94\u907f\u5f00\n\n## \u3010\u4ee3\u7801\u3011\n```cpp\n#include<bits/stdc++.h>\n#define DB double\nusing namespace std;\nconst int maxn=5e5+5,maxe=maxn<<1;\nconst DB INF=1e15;\nint n;\nint read(){\n\tint ret=0,f=1;char ch=getchar();\n\twhile(ch>'9'||ch<'0'){if(ch=='-')f=-f;ch=getchar();}\n\twhile(ch>='0'&&ch<='9') ret=ret*10+ch-'0',ch=getchar();\n\treturn ret*f;\n}\nint tot,lnk[maxn],du[maxn];\nstruct edge{\n\tint to,nxt;\n}e[maxe];\nDB g[maxn],f[maxn],a[maxn],siz[maxn];\nbool lef[maxn];\nvoid add_e(int x,int y){\n\te[++tot]=(edge){y,lnk[x]};\n\tlnk[x]=tot;\n\tdu[x]++;\n}\nint rt;\nvoid DFS1(int x,int fa){\n\tint son=0;\n\tfor(int j=lnk[x];j;j=e[j].nxt){\n\t\tint y=e[j].to;\n\t\tif(y==fa) continue;\n\t\tDFS1(y,x);\n\t\tg[x]+=g[y];\n\t\tsiz[x]+=siz[y];\n\t\tson++;\n\t}\n\tif(!son) siz[x]=1,lef[x]=1,g[x]=a[x];\n\telse g[x]+=siz[x]*a[x];\n}\nvoid DFS2(int x,int fa){\n\tfor(int j=lnk[x];j;j=e[j].nxt){\n\t\tint y=e[j].to;\n\t\tif(y==fa) continue;\n\t\tif(!lef[y]) f[y]=f[x]+(siz[rt]-siz[y])*a[y]-siz[y]*a[x];\n\t\telse f[y]=f[x]+(siz[rt]-2)*a[y]-a[x];\n\t\tDFS2(y,x);\n\t}\n}\nDB ans=-INF;\nint main(){\n\tfreopen(\"P6554.in\",\"r\",stdin);\n\tfreopen(\"P6554.out\",\"w\",stdout);\n\tn=read();\n\tfor(int i=1;i<n;i++){\n\t\tint x=read(),y=read();\n\t\tadd_e(x,y),add_e(y,x);\n\t}\n\tfor(int i=1;i<=n;i++) a[i]=read();\n\tfor(int i=1;i<=n;i++) if(du[i]>=2){rt=i;break;}\n\tDFS1(rt,0);\n\tf[rt]=g[rt];\n\tDFS2(rt,0);\n\tfor(int i=1;i<=n;i++) ans=max(ans,f[i]/(siz[rt]-lef[i]));\n\tprintf(\"%.4lf\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1597903391,
        "uid": 116251,
        "name": "\u7834\u5fc6",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6554 \u3010Promises I Can't Keep\u3011"
    },
    {
        "content": "**\u5341\u5e74 OI \u4e00\u573a\u7a7a\uff0c\u778e\u8bfb\u9898\u610f\u89c1\u7956\u5b97\u3002**\n\n\u5982\u679c\u662f\u7b49\u6982\u7387\u6d41\u5411\u513f\u5b50\u7684\uff0c\u8bf7\u56de\u53bb\u91cd\u65b0\u505a\uff01\uff01\uff01\n\n\u5269\u4f59\u7684\u7535\u6d41\u4f1a**\u7b49\u6982\u7387**\u4e14\u4e0d\u91cd\u590d\u7ecf\u8fc7\u4e00\u4e2a\u70b9\u5730**\u6d41\u5411\u53f6\u5b50\u8282\u70b9**\u3002\n\n~~\u6211\u5c31\u662f\u8fd9\u6837\uff0c\u6837\u4f8b\u8fc7\u4e86\uff0c\u6b7b\u6d3b WA\u3002~~\n\n\u6811\u5f62 dp \u52a0\u4e0a\u6362\u6839\uff0c\u5e94\u8be5\u5f88\u597d\u60f3\u5230\u3002\n\n\u6811\u5f62 dp \u5730\u7b2c\u4e00\u904d dfs \u663e\u7136\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u7edf\u8ba1\u51fa\u4ee5 $1$ \u4e3a\u6839\uff0c\u4e00\u4e2a\u8282\u70b9\u5730\u5b50\u6811\u6709\u591a\u5c11\u4e2a\u53f6\u5b50\u8282\u70b9\uff0c\u8fd9\u4e9b\u53f6\u5b50\u8282\u6d41\u6d41\u8fc7\u6765\u65f6\u591a\u5c11\uff1f\n\n```cpp\n//f[x]:\u53f6\u5b50\u8282\u70b9\u6d41\u5411\u8be5\u8282\u70b9\u7684\u503c\n//sz[x]:\u6709\u591a\u5c11\u53f6\u5b50\u8282\u70b9\ninline void dfs(int x, int ff){\n\tfor(int i = fir[x]; i ; i = nxt[i]){\n\t\tif(son[i] == ff) continue ;\n\t\tdfs(son[i], x);\n\t\tdeg[x]++;\n\t\tf[x] += f[son[i]];\n\t\tsz[x] += sz[son[i]];\n\t}\n\tif(deg[x] == 0) sz[x] = 1;\n\tf[x] += val[x] * sz[x];\n}\n```\n\n\u597d\uff0c\u7136\u540e\u6211\u4eec\u5f00\u59cb\u6362\u6839\u3002\n\n\u6ce8\uff1a\u5728\u4e0b\u6587\u4e2d\uff0c\u90fd\u662f\u4ece $x$ \u6362\u5230 $y$\u3002\n\n\u8bb0 $ans$ \u4e3a\u7b54\u6848\uff0c$tot$ \u4e3a\u53f6\u5b50\u8282\u70b9\u5230\u8be5\u70b9\u7684\u8ddd\u79bb\uff0c$sz_{leaves}$ \u8868\u793a\u53f6\u5b50\u8282\u70b9\u7684\u6570\u91cf\u3002\n\n\u6362\u6839\u4e4b\u540e $ans=\\dfrac{tot}{sz_{leaves}}$\u3002\n\n\u4ec0\u4e48\u8282\u70b9\u662f\u53f6\u5b50\u8282\u70b9\uff1f\n\n\u53ea\u548c $fa$ \u6709\u4e00\u6761\u8fb9\u3002\n\n\u90a3\u6211\u4eec\u53d1\u73b0\uff0c\u4e4b\u548c $fa$ \u6709\u4e00\u6761\u8fb9\u7684\u5c31\u662f\u6211\u4eec\u5904\u7406\u51fa\u6765\u7684 $sz_1$\uff0c\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u4e00\u70b9\uff08\u7279\u522b\u662f\u94fe\u7684\u60c5\u51b5\uff09\uff0c**$1$ \u4e5f\u53ef\u80fd\u662f\u53f6\u5b50\u8282\u70b9**\uff08\u5176\u4ed6\u70b9\u4f5c\u4e3a\u6839\u7684\u65f6\u5019\uff09\uff0c\u6211\u4eec\u4e0b\u6587\u518d\u8bf4\u3002\n\n\u5176\u4ed6\u60c5\u51b5\u4e0b\uff0c\u53f6\u5b50\u8282\u70b9\u7684\u4e2a\u6570\u5c31\u662f $sz_1$\uff0c\u4e0d\u8fc7\u6ce8\u610f\uff0c\u5f53\u6b64\u65f6\u7684\u8282\u70b9 $x$ \u662f\u6839\u8282\u70b9\u7684\u65f6\u5019\u5b83\u540c\u65f6\u662f $1$ \u4e3a\u6839\u65f6\u7684\u53f6\u5b50\u8282\u70b9\uff0c**\u90a3\u4e00\u5b9a\u8981\u7279\u5224**\u3002\n\n\u5bf9\u4e8e\u6709\u81f3\u5c11\u4e24\u6761\u8fb9\u8fde\u63a5\u7684\u70b9\uff0c\u6700\u591a\u4e00\u8fdb\uff08\u6216\u8005\u81ea\u5df1\u4e3a\u6839\uff09\uff0c\u5fc5\u7136\u53ef\u4ee5\u51fa\u53bb\uff0c**\u6240\u4ee5\u4e0d\u53ef\u80fd\u662f\u53f6\u5b50\u8282\u70b9**\u3002\n\n\u6362\u6839\u7684\u65f6\u5019\u6211\u7edf\u8ba1\u51fa\u53f6\u5b50\u8282\u70b9\u603b\u5171\u8ddd\u79bb\u8be5\u8282\u70b9\u591a\u5c11\uff08\u8bb0\u4e3a $tot$\uff09\u3002\n\n- $y$ \u4e0d\u662f\u53f6\u5b50\u8282\u70b9\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/37hsbcf0.png)\n\n\u6211\u4eec\u53d1\u73b0\uff0c$x$ \u7684\u975e $y$ \u8282\u70b9\u9700\u8981\u591a\u8d70\u5230 $y$\uff0c$y$ \u7684\u8282\u70b9\u4e0d\u9700\u8981\u8d70\u5230 $x$\u3002\u5c31\u662f\u8bf4\uff0c$tot$ \u7684\u603b\u503c\u4f1a\u51cf\u5c11\u4e00\u4e2a $val_x \\times sz_y$\uff0c\u800c\u4f1a\u52a0\u4e0a\u4e00\u4e2a $val_y \\times (sz_x-sz_y)$\u3002\u5199\u6210\u4ee3\u7801\u5c31\u662f\uff1a\n\n```cpp\ntot - sz[son[i]] * val[x] + (sz[1] - sz[son[i]]) * val[son[i]]\n```\n- $y$ \u662f\u53f6\u5b50\u8282\u70b9\n\n\u6b64\u65f6\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u56e0\u4e3a $y$ \u5230\u81ea\u5df1\u8fd8\u7b97\u4e86\u4e00\u4e2a $val_y$\uff0c\u4f46\u662f\u6211\u4eec\u8ba1\u7b97\u7684\u65f6\u5019\u663e\u7136\u6839\u8282\u70b9\u4e0d\u4f1a\u88ab\u5f53\u6210\u53f6\u5b50\u8282\u70b9\uff0c\u6240\u4ee5\u5728\u4e0a\u9762\u7684\u57fa\u7840\u4e0a\u51cf\u6389 $val_y$ \u5373\u53ef\u3002\n\n```cpp\ntot - sz[son[i]] * val[x] + (sz[1] - sz[son[i]]) * val[son[i]] - val[son[i]]\n```\n\u8fd9\u540c\u65f6\u4e5f\u544a\u8bc9\u6211\u4eec\uff0c\u5728\u5f00\u59cb\u66f4\u65b0 $ans$ \u7684\u65f6\u5019\uff0c\u4e0d\u8981\u5fd8\u8bb0\u603b\u5171\u7684\u53f6\u5b50\u8282\u70b9\u7684\u4e2a\u6570\u4e0d\u518d\u662f $sz_1$\uff0c\u800c\u662f $sz_1-1$\u3002\n\n- \u4e00\u4e2a\u8282\u70b9\u662f\u51fa\u5ea6\u4e3a $1$ \u7684 $1$ \u53f7\u70b9\u3002\n\n\u8fd9\u4e2a\u5206\u7c7b\u4e0d\u8981\u5fd8\u8bb0\u3002\u800c\u4e14\u5224\u65ad\u7684\u65f6\u5019\u6ce8\u610f\u5199\u4e0a\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u8fd9\u4e00\u79cd\u60c5\u51b5\uff0c\u518d\u5176\u4ed6\u7684\u8282\u70b9\u65f6\uff0c**\u53f6\u5b50\u8282\u70b9\u8fd8\u4f1a\u6709\u4e00\u4e2a $1$\u3002**\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/4mq5q1hf.png)\n\n\u539f\u6765\u662f\u65b9\u6846\u91cc\u7684\u4e1c\u897f\u5230 $y$ \u518d\u5230 $1$\uff0c\u73b0\u5728\u662f\u65b9\u6846\u91cc\u7684\u4e1c\u897f\u5230 $y$\uff0c$1$ \u5230 $y$\u3002\u76f8\u6bd4\u8f83\u539f\u6765\u800c\u8a00\uff0c\u52a0\u4e86\u4e24\u6b21\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u5199\u51fa\u4ee3\u7801\uff1a\n\n```cpp\n//deg[x]\u662f\u513f\u5b50\u7684\u6570\u91cf\nif(x == 1 && deg[x] == 1) dfs2(son[i], x, tot + val[son[i]]);\n```\n\n\u6700\u540e\u63d0\u9192\u5927\u5bb6\u4e00\u70b9\uff0c\u5c31\u662f\u5f53 $deg_1$ \u7b49\u4e8e $1$ \u7684\u65f6\u5019\uff0c\u6211\u4eec\u628a $sz_1$ \u52a0\u4e0a $1$\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u8ba1\u7b97\u65f6\u7684\u7279\u5224\u3002\n\n\u5b8c\u6574\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N = 5e5 + 5;\ndouble inf = 10000000000000000000.00;\nint n, fir[N << 1], nxt[N << 1], son[N << 1], tot, val[N], u, v, deg[N], sz[N];\nint f[N], g[N];\ndouble ans = -inf;\ndouble dmax(double x, double y){return x > y ? x : y;}\ninline void add(int x, int y){\n\tnxt[++tot] = fir[x];\n\tfir[x] = tot;\n\tson[tot] = y; \n} \ninline void dfs(int x, int ff){\n\tfor(int i = fir[x]; i ; i = nxt[i]){\n\t\tif(son[i] == ff) continue ;\n\t\tdfs(son[i], x);\n\t\tdeg[x]++;\n\t\tf[x] += f[son[i]];\n\t\tsz[x] += sz[son[i]];\n\t}\n\tif(deg[x] == 0) sz[x] = 1;\n\tf[x] += val[x] * sz[x];\n}\ninline void dfs2(int x, int ff, int tot){\n\tif(deg[x] && (x != 1 || deg[1] != 1)) ans = dmax(ans, tot * 1.0 / sz[1]);//\u5982\u679c\u8fd9\u4e2a\u70b9\u4e0d\u662f\u53f6\u5b50\u8282\u70b9\uff0c\u90a3\u5c31\u6709sz[1]\u4e2a\u53f6\u5b50\n\telse ans = dmax(ans, tot * 1.0 / (sz[1] - 1));//\u5982\u679c\u662f\u53f6\u5b50\u8282\u70b9\uff0c\u5c31\u6709sz[1]-1\u4e2a\u53f6\u5b50\n\tfor(int i = fir[x]; i ; i = nxt[i]){\n\t\tif(son[i] == ff) continue;\n\t\tif(x == 1 && deg[x] == 1) dfs2(son[i], x, tot + val[son[i]]);\n\t\telse if(deg[son[i]]) dfs2(son[i], x, tot - sz[son[i]] * val[x] + (sz[1] - sz[son[i]]) * val[son[i]]);\n\t\telse dfs2(son[i], x, tot - sz[son[i]] * val[x] + (sz[1] - sz[son[i]]) * val[son[i]] - val[son[i]]);\n\t}\n}\nsigned main(){\n\tscanf(\"%lld\", &n);\n\tfor(int i = 1; i < n; i++){\n\t\tscanf(\"%lld%lld\", &u, &v);\n\t\tadd(u, v), add(v, u);\n\t}\n\tfor(int i = 1; i <= n; i++) scanf(\"%lld\", &val[i]);\n\tdfs(1, 0);\n\tif(deg[1] == 1) sz[1]++;//\u5bf91\u4f5c\u4e3a\u53f6\u5b50\u7684\u7279\u5224\n\tdfs2(1, 0, f[1]);\n\tprintf(\"%.6lf\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1683526082,
        "uid": 461359,
        "name": "huangrenheluogu",
        "ccfLevel": 5,
        "title": "P6554\u6811\u5f62dp+\u6362\u6839"
    },
    {
        "content": "**\u4e3a\u4e86\u8fd9\u4e00\u9898\uff0c\u6211\u4e13\u95e8\u53bb\u5b66\u4e86\u671f\u671b DP\uff08~~\u7ed3\u679c\u53d1\u73b0\u8fd9\u9898\u7684\u671f\u671b\u6839\u672c\u5c31\u662f\u62ff\u6765\u552c\u4eba\u7684~~\uff09\u3002**\n\n\u9898\u76ee\u63cf\u8ff0\u8bf4\uff0c\u6c42\u51fa\u6240\u6709\u8def\u5f84\u7684\u671f\u671b\uff0c\u5176\u5b9e\u5c31\u662f\u6c42\u51fa\u5f53\u4ee5\u67d0\u4e00\u4e2a\u70b9\u4e3a\u6839\u8282\u70b9\u7684\u65f6\u5019\uff0c\u5b83\u5230\u6bcf\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\u7684\u8ddd\u79bb\u9664\u4ee5\u5176\u53f6\u5b50\u8282\u70b9\u7684\u6570\u91cf\u3002\n\n\u90a3\u4e48\u6211\u4eec\u4e0d\u96be\u8003\u8651\u5230\u6362\u6839 DP\uff0c\u7b2c\u4e00\u6b21 DFS\uff0c\u6211\u4eec\u5148\u4ece\u7f16\u53f7\u4e3a $1$ \u7684\u8282\u70b9\u5f00\u59cb\u626b\u63cf\uff0c\u5e76\u4e14\u8bb0\u5f55\u6bcf\u4e00\u4e2a\u8282\u70b9\u5230 **\u5176\u5b50\u6811\u4e0a** \u7684\u6bcf\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\u7684\u8ddd\u79bb\u4e4b\u548c\u53ca\u5176\u5b50\u6811\u4e2d\u53f6\u5b50\u8282\u70b9\u7684\u6570\u91cf\u3002\n\n```cpp\nvoid init(int u,int fa){\n  for(int i = 0;i<g[u].size();i++){\n    int v = g[u][i];\n    if(v==fa)continue;\n\n    init(v,u);\n    len[u] += val[u]*cnt[v] + len[v];//\u8bb0\u5f55\u8be5\u8282\u70b9\u51fa\u53d1\u6240\u6709\u8def\u5f84\u8ddd\u79bb\u4e4b\u548c\n    cnt[u] += cnt[v];//\u8bb0\u5f55\u8be5\u8282\u70b9\u51fa\u53d1\u7684\u8def\u5f84\u6570\u91cf\n  }\n\n  //\u5982\u679c\u8be5\u70b9\u662f\u5b50\u8282\u70b9\uff0c\u5c31\u5c06\u5176\u6807\u8bb0\uff0c\u8bbe\u7f6e\u521d\u59cb\u6570\u91cf\u4e3a1\uff0c\u8def\u5f84\u957f\u5ea6\u4e3aval[u]\n  if(g[u].size()==1&&u!=1)cnt[u] = ed[u] = 1,len[u] = val[u];\n}\n```\n\n\u7136\u540e\uff0c\u5728\u6211\u4eec\u7b2c\u4e8c\u6b21 DFS \u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u8bb0\u5f55\u5f53\u4ee5\u6bcf\u4e00\u4e2a\u5b50\u8282\u70b9\u4e3a\u6839\u7684\u65f6\u5019\uff0c\u5176\u8def\u5f84\u6570\u548c\u8def\u5f84\u957f\u5ea6\u603b\u548c\u5206\u522b\u662f\u591a\u5c11\u4e86\u3002\n\n\u8fd9\u91cc\u8981\u6ce8\u610f\u4e00\u4ef6\u4e8b\u60c5\uff1a\u5982\u679c\u6211\u4eec\u6709\u4e24\u4e2a\u70b9 $i$ \u548c $j$\uff0c\u800c\u5176\u4e2d $i$ \u662f\u4e00\u4e2a\u5ea6\u6570\u4e3a $1$ \u7684\u70b9\uff0c\u90a3\u4e48\uff0c\u5f53\u6839\u8282\u70b9\u7531 $i$ \u8f6c\u79fb\u5230 $j$ \u7684\u65f6\u5019\uff0c$i$ \u8282\u70b9\u5c06\u4f1a\u6210\u4e3a\u4e00\u4e2a\u65b0\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u53cd\u4e4b\uff0c\u5982\u679c $j$ \u672c\u8eab\u662f\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\uff0c\u8f6c\u79fb\u4e4b\u540e\u5b83\u5c06\u4e0d\u518d\u4f5c\u4e3a\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\u5b58\u5728\u3002\n\n\u7531\u8f6c\u79fb\u8fc7\u540e\uff0c\u6211\u4eec\u7684\u65b0\u6839\u8282\u7684\u53f6\u5b50\u8282\u70b9\u6570\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u539f\u672c\u6839\u8282\u70b9\u7684\u53f6\u5b50\u8282\u70b9\u6570\u52a0\u4e0a **\u4e0a\u8ff0\u7279\u5224** \uff0c\u4e8e\u662f\u6211\u4eec\u6709\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$cnt_v=cnt_u+ed_u-ed_v$\n\n*\uff08ed \u8868\u793a\u8be5\u70b9\u7684\u5ea6\u6570\u662f\u5426\u4e3a $1$\uff0c\u5373\u662f\u5426\u6709\u53ef\u80fd\u6210\u4e3a\u53f6\u5b50\u8282\u70b9\uff09\u3002*\n\n\u7c7b\u4f3c\u7684\uff0c\u957f\u5ea6\u7684\u8f6c\u79fb\u65b9\u7a0b\u4e5f\u662f\u7c7b\u4f3c\u7684\u601d\u8def\u3002\u539f\u672c\u518d\u8be5\u8282\u70b9\u5b50\u6811\u4ee5\u5916\u7684\u53f6\u5b50\u8def\u5f84\u90fd\u4f1a\u5206\u522b\u591a\u7ecf\u8fc7\u8fd9\u4e2a\u8282\u70b9\u4e00\u6b21\uff0c\u4e8e\u662f\u4e4e\u5c31\u6709\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$len_v=val_v*(cnt_u-cnt_v+ed_u-ed_v)+len_u$\n\n\u7279\u522b\u7684\uff0c\u5f53\u4e24\u4e2a\u8282\u70b9\u7684\u53f6\u5b50\u8282\u70b9\u6570\u91cf\u76f8\u540c\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u7ee7\u627f\uff1a\n\n$len_v=val_v*(cnt_u-cnt_v+ed_u-ed_v)+len_u-cnt_v*val_u (cnt_u=cnt_v)$\n\n\u4e8e\u662f\u4e4e\u5c31\u6709\u4e86\u7b2c\u4e8c\u6b21 DFS \u7684\u51fd\u6570\uff1a\n\n```cpp\nvoid dfs(int u,int fa){\n  for(int i = 0;i<g[u].size();i++){\n    int v = g[u][i];\n    if(v==fa)continue;\n    if(cnt[u]==cnt[v])len[v] = val[v]*(cnt[u]-cnt[v] + ed[u] - ed[v]) + len[u];\n    else len[v] = val[v]*(cnt[u]-cnt[v] + ed[u] - ed[v]) + len[u] - cnt[v]*val[u];\n    dfs(v,u);\n  }\n}\n```\n\n\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nconst int maxn = 5e5 + 9;\n#define int long long\nusing namespace std;\n\nint read(){\n  int x=0,f=1;\n  char ch = getchar();\n  while(ch<'0'||ch>'9'){if(ch=='-')f = -f;ch = getchar();}\n  while(ch>='0'&&ch<='9'){x = (x<<3)+(x<<1)+(ch^48);ch = getchar();}\n  return x*f;\n}\n\nvector<int> g[maxn];\nint val[maxn],n,len[maxn],cnt[maxn],ed[maxn];\n\nlong double ans;\n\nvoid init(int u,int fa){\n  for(int i = 0;i<g[u].size();i++){\n    int v = g[u][i];\n    if(v==fa)continue;\n\n    init(v,u);\n    len[u] += val[u]*cnt[v] + len[v];\n    cnt[u] += cnt[v];\n  }\n\n  if(g[u].size()==1&&u!=1)cnt[u] = ed[u] = 1,len[u] = val[u];\n}\n\nvoid dfs(int u,int fa){\n  for(int i = 0;i<g[u].size();i++){\n    int v = g[u][i];\n    if(v==fa)continue;\n\n    if(cnt[u]==cnt[v])len[v] = val[v]*(cnt[u]-cnt[v] + ed[u] - ed[v]) + len[u];\n    else len[v] = val[v]*(cnt[u]-cnt[v] + ed[u] - ed[v]) + len[u] - cnt[v]*val[u];\n\n    cnt[v] = cnt[u] + ed[u] - ed[v];\n    dfs(v,u);\n  }\n}\n\nsigned main(){\n  n = read();\n  for(int i = 1,u,v;i<n;i++){\n    u = read(),v = read();\n    g[u].push_back(v),g[v].push_back(u);\n  }\n\n  for(int i = 1;i<=n;i++)val[i] = read();\n  init(1,1);\n  if(g[1].size()==1)ed[1] = 1;\n  dfs(1,1);\n\n  ans = -1e32;\n  for(int i = 1;i<=n;i++)\n    ans = max(ans,(long double)1.0*len[i]/(1.0*cnt[i]));\n  printf(\"%.4Lf\",ans);\n}\n\n```",
        "postTime": 1681908907,
        "uid": 540287,
        "name": "stupid_collie",
        "ccfLevel": 0,
        "title": "P6554 Promises I Can't Keep \u9898\u89e3"
    },
    {
        "content": "\u63d0\u4ea4\u7406\u7531\uff1a\u81ea\u4fe1\u4e0d\u4f1a\u6709\u7b2c\u4e8c\u4e2a\u81ea\u5e95\u5411\u4e0a\u641c\u7684\u3002\n\n\u601d\u8def\uff1a   \n1. \u7528\u5806\u627e\u5230\u5ea6\u4e3a 1 \u7684\u70b9\uff0c\u5e76\u5c06\u5176\u7684\u6743\u503c\u4e0a\u4f20\uff08\u6cbf\u7740\u552f\u4e00\u90bb\u8fb9\uff09\uff1b\u5220\u9664\u8be5\u70b9\uff0c\u5e76\u4fee\u6539\u5176\u7236\u8282\u70b9\u7684\u5ea6\u6570\u3002\u7236\u8282\u70b9\u5b58\u8d2e\u671f\u671b\u548c\u5b50\u6811\u300c\u53f6\u5b50\u8282\u70b9\u300d\u6570\u7684\u79ef\u3002\n2. \u5806\u4e3a\u7a7a\u65f6\uff0c\u8df3\u51fa\u5faa\u73af\u3002\u6cbf\u5220\u9664\u5e8f\u7684\u5012\u5e8f\uff08\u53d1\u73b0\u987a\u5e8f\uff09\u91cd\u65b0\u4e0b\u8f7d\u503c\u81f3\u5b50\u8282\u70b9\uff0c\u5e76\u4f20\u9012\u503c\u81f3\u5b50\u8282\u70b9\u3002\u901a\u8fc7\u8ba1\u7b97\uff0c\u5b50\u8282\u70b9\u83b7\u5f97\u671f\u671b\u548c\u53e6\u4e00\u65b9\u9762\u5b50\u6811\u7684\u300c\u53f6\u5b50\u8282\u70b9\u300d\u7684\u79ef\u3002\n3. \u901a\u8fc7\u5c06\u4e8c\u5b50\u6811\u7684\u300c\u53f6\u5b50\u8282\u70b9\u300d\u548c\u671f\u671b\u7684\u79ef\u9664\u4ee5\u603b\u300c\u53f6\u5b50\u8282\u70b9\u300d\u6570\uff0c\u8ba1\u7b97\u6bcf\u4e2a\u8282\u70b9\u7684\u671f\u671b\u3002\u66f4\u52a0\u4e4b\u4ee5\u8be5\u8282\u70b9\u7684\u6743\u503c\uff0c\u53d6\u6700\u5927\u503c\u5373\u53ef\u3002\n\n\n```cpp\n#include <bits/extc++.h>\nusing namespace std;\nconstexpr int32_t MAXN = 500032;\nbasic_string<int32_t> E[MAXN];\n__gnu_pbds::priority_queue<pair<int32_t, int32_t>, greater<pair<int32_t, int32_t>>> V;\ndecltype(V)::point_const_iterator H[MAXN];\nbitset<MAXN> instk;\nbasic_string<int32_t> ef;\nlong double b[MAXN], c[MAXN], d[MAXN], g[MAXN], w[MAXN];\nint main()\n{\n\t// ios::sync_with_stdio(false); cin.tie(0); cout.tie(0);\n\tint32_t a, o, p, q;\n\tcin >> q;\n\tfor (int32_t i = 1; i < q; ++i) {\n\t\tcin >> o >> p;\n\t\tE[o].push_back(p);\n\t\tE[p].push_back(o);\n\t}\n\tfor (int32_t i = 1; i <= q; ++i) {\n\t\tcin >> w[i];\n\t\tH[i] = V.push({ E[i].size(), i });\n\t\tif (E[i].size() == 1)\n\t\t\t++a, b[i] = 1;\n\t}\n\tint32_t r, u;\n\tlong double t;\n\twhile (!V.empty()) {\n\t\tr = V.top().second;\n\t\tV.pop();\n\t\tu = t = 0;\n\t\tinstk.set(r);\n\t\tfor (const auto& s : E[r]) {\n\t\t\tif (instk[s])\n\t\t\t\tt += d[s], b[r] += b[s];\n\t\t\telse {\n\t\t\t\tu = s;\n\t\t\t\tV.modify(H[s], { H[s]->first - 1, H[s]->second });\n\t\t\t}\n\t\t}\n\t\tif (u) {\n\t\t\td[r] = w[r] * b[r] + t;\n\t\t\tg[r] = u;\n\t\t} else\n\t\t\tg[r] = r;\n\t\tef.push_back(r);\n\t}\n\tfor (decltype(ef)::const_iterator i = ef.end(); t = 0, i != ef.begin();) {\n\t\tfor (const auto& s : E[*--i])\n\t\t\tif (s != g[*i])\n\t\t\t\tc[*i] += d[s];\n\t\tfor (const auto& s : E[*i])\n\t\t\tif (s != g[*i])\n\t\t\t\tc[s] = w[*i] * (a - b[s]) + c[*i] - d[s];\n\t}\n\tfor (int32_t i = 1; i <= q; ++i)\n\t\tc[i] = w[i] + c[i] / (a - (E[i].size() == 1));\n\tprintf(\"%.4Lf\", *max_element(c + 1, c + q + 1));\n\treturn 0;\n}\n```\n",
        "postTime": 1675847324,
        "uid": 259253,
        "name": "\u738b\u6c5f\u777f",
        "ccfLevel": 5,
        "title": "\u81ea\u5e95\u5411\u4e0a\u7684\u8bb0\u5fc6\u5316\u641c\u7d22"
    },
    {
        "content": "## Solution\n\n\u6700\u8fd1\u6c34\u5e73\u4e0b\u964d , \u53d1\u9898\u89e3 .\n\n\u9996\u5148 , \u9898\u9762\u53ef\u80fd\u6709\u4e00\u70b9\u6b67\u4e49 : \u5b83\u5b9e\u9645\u4e0a\u5c31\u662f\u60f3\u8ba9\u4f60\u6c42\u51fa\u6bcf\u4e2a\u70b9\u4e3a\u6839\u65f6\u5230\u6240\u6709\u53f6\u5b50\u8282\u70b9\u8def\u5f84\u548c\u7684\u548c .\n\n\u9996\u5148\u5982\u679c\u8ba9\u4f60\u6c42\u6bcf\u4e2a\u70b9\u5230\u5b83\u539f\u6811\u4e0a\u7684\u5b50\u6811\u4e2d\u7684\u53f6\u5b50\u7ed3\u70b9 , \u76f4\u63a5\u6811\u5f62 dp .\n\n$$dp_u=val_u \\times sum_u + \\sum dp_v$$\n\n\u5176\u4e2d $sum_u$ \u662f $u$ \u7684\u5b50\u6811\u5185\u53f6\u5b50\u7ed3\u70b9\u7684\u4e2a\u6570 .\n\n\u4f46\u662f\u53ef\u80fd\u8003\u8651\u5b50\u6811\u5916\u7684 , \u8fd9\u65f6\u5019\u5c31\u8003\u8651\u6362\u6839 .\n\n\u753b\u4e2a\u56fe\u5c31\u77e5\u9053 , \u5f53\u6839\u4ece $u$ \u6362\u6210 $v$ \u7684\u65f6\u5019 , \u6709 $sum_v$ \u4e2a\u70b9\u7684\u8def\u5f84\u548c $-val_u$ , \u6709 $tot-sum_v$ ( $tot$ \u662f\u5ea6\u6570\u4e3a $1$ \u7684\u8282\u70b9\u603b\u6570 ) \u4e2a\u70b9\u7684\u8def\u5f84\u548c $+val_v$ . \u5c31\u53ef\u4ee5\u5199\u51fa\u6362\u6839\u7684 dp \u65b9\u7a0b .\n\n\u6bcf\u6b21\u6bd4\u8f83 $\\frac{ans_u}{tot}$ \u7684\u503c\u5c31\u53ef\u4ee5\u4e86 .\n\n\u5982\u679c $u$ \u7684\u5ea6\u6570\u662f $1$ , \u90a3\u4e48 $u$ \u81ea\u5df1\u4e0d\u80fd\u88ab\u7b97\u8fdb\u53bb , \u8fd8\u8981\u5355\u72ec\u5904\u7406 .\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define ffor(i,a,b) for(int i=(a);i<=(b);i++)\n#define roff(i,a,b) for(int i=(a);i>=(b);i--)\nusing namespace std;\nconst int MAXN=5e5+10;\nint n,tot,val[MAXN],sum[MAXN],ans[MAXN]; vector<int> G[MAXN];\nint dfs(int u,int f) {\n\tif(G[u].size()==1) sum[u]++;\n\tint ans=(G[u].size()==1)*val[u],cnt=0;\n\tfor(auto v:G[u]) {\n\t\tif(v==f) continue;\n\t\tans+=dfs(v,u);\n\t\tans+=sum[v]*val[u];\n\t\tsum[u]+=sum[v];\n\t}\n\treturn ans;\n}\nvoid calc(int u,int f) {\n\tif(f) {\n\t\tans[u]=ans[f]-val[f]*sum[u]+(tot-sum[u])*val[u];\n\t}\n\tfor(auto v:G[u]) {\n\t\tif(v==f) continue;\n\t\tcalc(v,u);\t\n\t}\n}\nsigned main() {\n\tios::sync_with_stdio(false),cin.tie(0),cout.tie(0);\n\tcin>>n;\n\tffor(i,1,n-1) {\n\t\tint u,v; cin>>u>>v;\n\t\tG[u].push_back(v),G[v].push_back(u);\n\t}\n\tffor(i,1,n) cin>>val[i];\n\tffor(i,1,n) if(G[i].size()==1) tot++;\n\tans[1]=dfs(1,0);\n\tcalc(1,0);\n\tdouble Ans=-99824435311451419;\n\tffor(i,1,n) {\n\t\tint sum=tot;\n\t\tif(G[i].size()==1) ans[i]-=val[i],sum--;\n\t\tAns=max(Ans,ans[i]*1.0/sum);\t\n\t}\n\tcout<<fixed<<setprecision(6)<<Ans;\n\treturn 0;\n}\n```",
        "postTime": 1668610963,
        "uid": 120947,
        "name": "Purslane",
        "ccfLevel": 7,
        "title": "P6554"
    }
]