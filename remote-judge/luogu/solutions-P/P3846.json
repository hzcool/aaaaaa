[
    {
        "content": "\u8fd9\u9053\u9898\u7684\u6570\u636e\u8303\u56f4\u5f88\u53cb\u597d\uff08$p<2^{31}$\uff09\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 `Baby Step Giant Step` ~~\u6c34~~\u8fc7\u3002\u7136\u800c\uff0c\u5982\u679c\u6570\u636e\u52a0\u5f3a\u5230 $p\\leq 10^{18}$ \uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5b83\u3002\n\n\u8fd9\u7bc7\u9898\u89e3\u8bb2\u8ff0\u7684\u662f\u5982\u4f55\u4f7f\u7528\u4f18\u5316\u540e\u7684 `Pohlig-Hellman` \u901a\u8fc7\u672c\u9898\u3002\n\n\u4e3a\u4e86\u8fbe\u6210\u8fd9\u4e00\u70b9\uff0c\u4e0b\u9762\u7684\u4f18\u5316\u7b97\u6cd5\u542b\u6709\u4ee5\u4e0b\u524d\u7f6e\u77e5\u8bc6\uff08\u5982\u679c\u4f60\u6709\u54ea\u4e00\u4e2a\u524d\u7f6e\u77e5\u8bc6\u4e0d\u7406\u89e3\uff0c\u90a3\u4e48\u8bf7\u4e8b\u5148\u67e5\u770b\u6709\u5173\u77e5\u8bc6\uff09\n\n+ `Miller-Rabin`\n\n+ `Pollard-Rho`\n\n+ `Excrt`\n\n+ `Baby Step Giant Step`\n\n+ `Exgcd`\n\n+ \u4e00\u822c\u7684 `DLP` \u7b97\u6cd5\n\n\u6211\u4eec\u5148\u4ece\u9636\u8bb2\u8d77\uff1a\n\n\u8bbe $a,p\\in z,\\gcd(a,p)=1$\uff0c\u4f7f $a^n\\equiv 1\\pmod p$ \u6210\u7acb\u7684\u6700\u5c0f\u6b63\u6574\u6570 $n$ \u79f0\u4e3a $a$ \u6a21 $p$ \u7684\u9636\uff0c\u8bb0\u4f5c $ord_p(a)=n$\n\n\u8bbe $ord(a)=n=\\prod^m_{i=1}q^{k_i}_i$\u3002\n\n\u4ee4 $r_i=\\dfrac{n}{q_i^{k^i}}$\uff0c\u7531 $a^x\\equiv b\\pmod p,(a^x)^{r_i}\\equiv b^{r_i}\\pmod p$\u3002\n\n\u663e\u7136\uff0c$ord(a^{r_i})^x=q_i^{k_i}$\uff0c$(a^{r_i})^x\\equiv b^{r_i}\\pmod p$\u3002\n\n\u8bbe $(a^{r_i})^x\\equiv b^{r_i}\\pmod p$ \u7684\u89e3\u4e3a $x_i$\uff0c\u5219\u539f\u95ee\u9898\u7684\u89e3 $x$ \u6ee1\u8db3 $x\\equiv x_i\\pmod{q_i^{k_i}}$\n\n\u82e5\u80fd\u6c42\u51fa\u8fd9 $m$ \u4e2a $q^k$ \u9636\u7684 `DLP`\uff0c\u5219\u53ef\u4ee5\u8fdb\u4e00\u6b65\u901a\u8fc7 `CRT` \u8fdb\u884c\u5408\u5e76\u6c42\u89e3\u3002\n\n\u8bbe $ord(a)=q^k$\uff0c\u5176\u4e2d $q$ \u4e3a\u4e00\u4e2a\u8d28\u6570\u3002\n\n\u663e\u7136\u6709 $0\\leq x<q^k$\uff0c\u8bbe\uff1a\n\n$x=x_0+x_1q+x_2q^2+\\cdots+x_{k-1}q^{k-1},0\\leq x_i<q$\n                                                    \n\u5219\u6709\uff1a\n\n$(a^x)^{q^{k-1}}=(a^{x_0+x_1q+x_2q^2+\\cdots+x_{k-1}q^{k-1}})^{q^{k-1}}\\equiv a^{x_0q^{k-1}}\\equiv (a^{q^{k-1}})^{x_0}\\equiv b^{q^{k-1}}\\pmod p$\n\n\n\u6240\u4ee5 $ord(a^{q^{k-1}})=q$\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u901a\u8fc7\u6c42\u89e3\u4e00\u4e2a $q$ \u9636\u7684 `DLP` \u5f97\u5230 $x_0$ \u7684\u503c\u3002\n\n\u5f97\u51fa $x_0$ \u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\u89e3\u51fa\uff1a\n\n$(a^x)^{q^{k-2}}=(a^{x_0+x_1q+x_2q^2+\\cdots+x_{k-1}q^{k-1}})^{q^{k-2}}\\equiv a^{x_0q^{k-2}+x_1q^{k-1}}\\equiv b^{q^{k-2}}\\pmod p$\n\n\u7531\u4e8e\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u4e86 $x_0$ \u7684\u503c\uff0c\u4e8e\u662f\u6709\uff1a\n\n$(a^{q^{k-1}})^{x_1}\\equiv b^{q^{k-2}}\\cdot a^{-x_0q^{k-2}}\\pmod p$\n\n\u53ef\u4ee5\u53d1\u73b0\u5982\u679c\u6211\u4eec\u4e00\u76f4\u8fd9\u6837\u9012\u5f52\u4e0b\u53bb\uff0c\u5de6\u8fb9\u4e00\u76f4\u90fd\u662f $(a^{q^{k-1}})^{x_i}$\u3002\n\n\u53f3\u8fb9\u663e\u7136\u53ef\u4ee5\u7b80\u4fbf\u8ba1\u7b97\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $q$\uff0c\u53ea\u9700\u8981\u8fdb\u884c\u4e00\u6b21 `BSGS` \u7684\u9884\u5904\u7406\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u7279\u522b\u7384\u5b66\uff0c\u4f46\u662f $p\\leq 10^{18}$ \u4e14 $p$ \u4e0d\u600e\u4e48\u6bd2\u7624\u80fd\u591f\u901a\u8fc7\u3002\u5177\u4f53\u5730\uff0c\u590d\u6742\u5ea6\u53d6\u51b3\u4e8e\u5206\u89e3 $p$ \u7684\u8d28\u56e0\u5b50\u7684\u901f\u5ea6\uff0c\u8fd9\u90e8\u5206\u53ef\u4ee5\u7528\u67d0\u4e2a\u795e\u5947\u7684 `Pollard-Rho` \u4f18\u5316\u3002\n\n\uff08\u4f46\u662f\u4f3c\u4e4e\u4e0d\u89c1\u5f97\u8fd9\u9053\u9898\u8dd1\u5f97\u6bd4\u76f4\u63a5\u7684 `BSGS` \u5feb\uff09\n\n\u603b\u4e4b\u8fd9\u9053\u9898\u5c31\u76f8\u5f53\u4e8e\u628a\u65e0\u6570\u4e2a\u6a21\u677f\u65e0\u7f1d\u8854\u63a5\u5c31\u662f\u4e86\uff01\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define LL long long\n#define IL __int128\nLL read(){\n\tLL x=0,f=1;\n\tchar ch=getchar();\n\twhile(ch<'0' || ch>'9'){\n\t\tif(ch=='-') f=-1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0' && ch<='9'){\n\t\tx=x*10+ch-'0';ch=getchar();\n\t}\n\treturn x*f;\n}\nnamespace PhoRho{ //Phollard-Rho\u4e0d\u89e3\u91ca\uff08\u89c1Luogu P4718\uff09\n\tLL gcd(LL a,LL b){\n\t\tif (b==0) return a;\n\t\treturn gcd(b,a%b);\n\t}\n\tLL fastpow(LL x,LL p,LL mod){\n\t\tLL ans=1;\n\t\twhile (p){\n\t\t\tif (p&1) ans=(IL)ans*x%mod;\n\t\t\tx=(IL)x*x%mod;\n\t\t\tp>>=1;\n\t\t}\n\t\treturn ans;\n\t}\n\tLL max_factor;\n\tbool MillerRabin(LL x,LL b){\n\t\tLL k=x-1;\n\t\twhile (k){\n\t\t\tLL cur=fastpow(b,k,x);\n\t\t\tif (cur!=1 && cur!=x-1) return false;\n\t\t\tif ((k&1)==1 || cur==x-1) return true;\n\t\t\tk>>=1;\n\t\t}\n\t\treturn true;\n\t}\n\tbool prime(LL x){\n\t\tif (x==46856248255981LL || x<2) return false;\n\t\tif (x==2 || x==3 || x==7 || x==61 || x==24251) return true;\n\t\treturn MillerRabin(x,2) && MillerRabin(x,3) && MillerRabin(x,7) && MillerRabin(x,61);\n\t}\n\tLL f(LL x,LL c,LL n){\n\t\treturn ((IL)x*x+c)%n;\n\t}\n\tLL PRho(LL x){\n\t\tLL s=0,t=0,c=1LL*rand()*(x-1)+1;\n\t\tint stp=0,goal=1;\n\t\tLL val=1;\n\t\tfor (goal=1;;goal<<=1,s=t,val=1){\n\t\t\tfor (stp=1;stp<=goal;++stp){\n\t\t\t\tt=f(t,c,x);\n\t\t\t\tval=(IL)val*abs(t-s)%x;\n\t\t\t\tif (stp%127==0){\n\t\t\t\t\tLL d=gcd(val,x);\n\t\t\t\t\tif (d>1) return d;\n\t\t\t\t}\n\t\t\t}\n\t\t\tLL d=gcd(val,x);\n\t\t\tif (d>1) return d;\n\t\t}\n\t}\n\tvoid fac(LL x){\n\t\tif (x<=max_factor || x<2){\n\t\t\treturn;\n\t\t}\n\t\tif (prime(x)){\n\t\t\tmax_factor=max_factor>x?max_factor:x;\n\t\t\treturn;\n\t\t}\n\t\tLL p=x;\n\t\twhile (p>=x) p=PRho(x);\n\t\twhile ((x%p==0)) x/=p;\n\t\tfac(x);fac(p);\n\t}\n\tLL divide(LL n){\n\t\tsrand((unsigned)time(NULL));\n\t\tmax_factor=0;\n\t\tfac(n);\n\t\treturn max_factor;\n\t}\n} \nnamespace DLP{\n\tconst int N=1111111;\n\tLL fastpow(LL a,LL n){ //\u5feb\u901f\u5e42\u4e0d\u89e3\u91ca\n\t\tLL res=1;\n\t\twhile (n>0){\n\t\t\tif (n&1) res=res*a;\n\t\t\ta=a*a;\n\t\t\tn>>=1;\n\t\t}\n\t\treturn res;\n\t}\n\tLL fastpow(LL a,LL n,LL p){ //\u5feb\u901f\u5e42*2\u4e0d\u89e3\u91ca\n\t\tLL res=1;\n\t\ta%=p;\n\t\twhile (n>0){\n\t\t\tif (n&1) res=(IL)res*a%p;\n\t\t\ta=(IL)a*a%p;\n\t\t\tn>>=1;\n\t\t}\n\t\treturn res;\n\t}\n\tint prime[N],ptot;\n\tbool ispr[N];\n\tstruct pt{\n\t\tLL p;\n\t\tint c;\n\t};\n\tvoid getprime(){ //\u83b7\u53d610^6\u4ee5\u5185\u7684\u8d28\u6570\n\t\tmemset(ispr,1,sizeof(ispr));\n\t\tfor (int i=2;i<N;++i){\n\t\t\tif (ispr[i]) prime[++ptot]=i;\n\t\t\tfor (int j=1;j<=ptot && prime[j]<=(N-1)/i;++j){\n\t\t\t\tispr[i*prime[j]]=0;\n\t\t\t\tif (!i%prime[j]) break;\n\t\t\t}\n\t\t}\n\t}\n\tbool cmp(pt x,pt y){\n\t\treturn x.p<y.p;\n\t}\n\tvoid findorg(vector <pt> &v,LL num){ //num\u5206\u89e3\u8d28\u56e0\u6570\n\t\twhile (num>=N){ //\u5927\u4e8e10^6\u7684\u90e8\u5206\uff0c\u6bcf\u6b21\u7528Pho-Rho\u7b97\u6cd5\u627e\u51fa\u6700\u5927\u7684\u4e00\u4e2a\u8d28\u56e0\u5b50\uff0c\u7136\u540e\u9664\u6389\u5373\u53ef\n\t\t\tLL maxf=PhoRho::divide(num);\n\t\t\tint cnt=0;\n\t\t\twhile (num%maxf==0){\n\t\t\t\tcnt++;\n\t\t\t\tnum=num/maxf;\n\t\t\t}\n\t\t\tv.push_back((pt){maxf,cnt});\n\t\t}\n\t\tif (ptot==0) getprime();\n\t\tfor (int i=1;i<=ptot && prime[i]<=num;++i){ //\u5269\u4e0b\u7684\u5c31\u662f\u4e0d\u5927\u4e8e10^6\u7684\u8d28\u56e0\u5b50\u4e86\uff0c\u76f4\u63a5\u66b4\u529b\u679a\u4e3e\n\t\t\tif (num%prime[i]==0){\n\t\t\t\tint cnt=0;\n\t\t\t\twhile (num%prime[i]==0){\n\t\t\t\t\tcnt++;\n\t\t\t\t\tnum/=prime[i];\n\t\t\t\t}\n\t\t\t\tv.push_back((pt){prime[i],cnt});\n\t\t\t}\n\t\t}\n\t\tif (num>1) v.push_back((pt){num,1});\n\t\tsort(v.begin(),v.end(),cmp); //\u8fd9\u53e5\u8bdd\u8bf4\u5b9e\u5728\u6ca1\u6709\u610f\u4e49\n\t}\n\tint getorg(LL p,LL phi,vector <pt> &v){ //\u83b7\u53d6ord\n\t\tfor (int k=2;;k++){\n\t\t\tint flag=1;\n\t\t\tfor (int i=0;i<(int)v.size();++i){\n\t\t\t\tif (fastpow(k,phi/v[i].p,p)==1){\n\t\t\t\t\tflag=0;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (flag) return k;\n\t\t}\n\t}\n\tLL BSGS(LL a,LL b,LL p,LL mod){ //BSGS\u6a21\u677f\uff0c\u5177\u4f53\u53ef\u4ee5\u89c1\u5176\u5b83\u9898\u89e3\u7684\u4e00\u822c\u505a\u6cd5\n\t\ta%=mod;b%=mod;\n\t\tif (b==1) return 0;\n\t\tif (a==0){\n\t\t\tif (b==0) return 1;\n\t\t\telse return -1;\n\t\t}\n\t\tLL t=1;\n\t\tint m=int(sqrt(1.0*p)+1);\n\t\tLL base=b;\n\t\tunordered_map <LL,LL> vis;\n\t\tfor (int i=0;i<m;++i){\n\t\t\tvis[base]=i;\n\t\t\tbase=(IL)base*a%mod;\n\t\t}\n\t\tbase=fastpow(a,m,mod);\n\t\tLL now=t;\n\t\tfor (int i=1;i<=m+1;++i){\n\t\t\tnow=(IL)now*base%mod;\n\t\t\tif (vis.count(now)) return i*m-vis[now];\n\t\t}\n\t\treturn -1;\n\t}\n\tLL getksi(LL g,LL h,LL p,LL c,LL n,LL mod){ //\u5f97\u5230\u5408\u5e76\u540e\u7684\u89e3\u96c6\uff0c\u7136\u540e\u4e0aBSGS\n\t\tvector <LL> pi;\n\t\tLL tp=1;\n\t\tfor (int i=0;i<=c;++i){\n\t\t\tpi.push_back(tp);\n\t\t\ttp*=p;\n\t\t}\n\t\tLL gq=fastpow(g,pi[c-1],mod);\n\t\tLL inv=0;\n\t\ttp=1;\n\t\tfor (int i=c-1;i>=0;--i){\n\t\t\tLL tx=tp*BSGS(gq,fastpow((IL)h*fastpow(g,pi[c]-inv,mod)%mod,pi[i],mod),p,mod);\n\t\t\tinv+=tx;tp*=p;\n\t\t}\n\t\treturn inv;\n\t}\n\tLL exgcd(LL a,LL b,LL &x,LL &y){ //exgcd\u6a21\u677f\u4e0d\u89e3\u91ca\n\t\tif (b==0){\n\t\t\tx=1;y=0;\n\t\t\treturn a;\n\t\t}\n\t\tLL d=exgcd(b,a%b,y,x);\n\t\ty-=a/b*x;\n\t\treturn d;\n\t}\n\tLL getinv(LL a,LL p){ //\u9006\u5143\u4e0d\u89e3\u91ca\n\t\tif (a==0) return 1;\n\t\tLL x,y;\n\t\texgcd(a,p,x,y);\n\t\treturn (x%p+p)%p;\n\t}\n\tLL gcd(LL x,LL y){ //gcd\u4e0d\u89e3\u91ca\n\t\tif (x%y==0) return y;\n\t\treturn gcd(y,x%y);\n\t}\n\tLL ExgcdSolve(LL a,LL b,LL c,LL &x,LL &y){ //\u6c42\u89e3exgcd\n\t\tLL d;\n\t\tif (c%(d=gcd(a,b))) return -1;\n\t\ta/=d;b/=d;c/=d;\n\t\texgcd(a,b,x,y);\n\t\tx=(IL)x*c%b;\n\t\twhile (x<=0) x+=b;\n\t\treturn x; \n\t}\n\tLL crt(vector <LL> ksi,vector <pt> v){ //crt\u4e0d\u89e3\u91ca\n\t\tint sz=v.size();\n\t\tLL M=1,ans=0;\n\t\tvector <LL> m;\n\t\tfor (int i=0;i<sz;++i){\n\t\t\tm.push_back(fastpow(v[i].p,v[i].c));\n\t\t\tM*=m[i];\n\t\t}\n\t\tfor (int i=0;i<sz;++i){\n\t\t\tLL Mi=M/m[i];\n\t\t\tans=((IL)ans+(IL)Mi*getinv(Mi,m[i])*ksi[i])%M;\n\t\t}\n\t\tif (ans<0) ans+=M;\n\t\treturn ans;\n\t}\n\tLL getx(LL h,LL g,LL N,LL mod,vector <pt> &v){ //\u83b7\u53d6\u89e3\u96c6\uff0c\u7136\u540e\u7528crt\u5408\u5e76\n\t\tvector <LL> ksi;\n\t\tfor (pt tp:v){\n\t\t\tLL tg=fastpow(g,N/fastpow(tp.p,tp.c),mod);\n\t\t\tLL th=fastpow(h,N/fastpow(tp.p,tp.c),mod);\n\t\t\tksi.push_back(getksi(tg,th,tp.p,tp.c,N,mod));\n\t\t}\n\t\treturn crt(ksi,v);\n\t}\n\tLL solve(LL g,LL h,LL p){ //\u6c42\u89e3\n\t\tif (h==1) return 0;\n\t\tLL phiP=p-1;\n\t\tvector <pt> v;\n\t\tfindorg(v,phiP);\n\t\tint rt=getorg(p,phiP,v);\n\t\tLL x=getx(g,rt,phiP,p,v);\n\t\tLL y=getx(h,rt,phiP,p,v);\n\t\tLL a=0,b=0;\n\t\tif (x==0){\n\t\t\tif (y==0) return 1;\n\t\t\telse if (y==1) return 0;\n\t\t\telse return -1;\n\t\t}else return ExgcdSolve(x,phiP,y,a,b);\n\t}\n};\nsigned main(){\n\tLL p=read(),g=read(),h=read(); \n    LL ans=DLP::solve(g,h,p);\n    if (ans==-1) puts(\"no solution\");\n    else cout<<ans<<endl;\n\tfclose(stdin);\n\tfclose(stdout);\n\treturn 0;\n}\n```\n",
        "postTime": 1579181647,
        "uid": 107231,
        "name": "zombie462",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3846 \u3010 [TJOI2007]\u53ef\u7231\u7684\u8d28\u6570\u3011"
    },
    {
        "content": "BSGS\u677f\u5b50\u9898\u3002\n\n\u5927\u6b65\u5c0f\u6b65\u7b97\u6cd5(Baby Step,Giant Step,BSGS)\u7528\u6765\u6c42\u89e3\u5f62\u5982$a^x\\equiv b(mod\\;p)$\u6216$x^a\\equiv b(mod\\;p)$\u7684\u9ad8\u6b21\u540c\u4f59\u65b9\u7a0b\uff0c\u5176\u4e2da,b,p\u5df2\u7ecf\u88ab\u7ed9\u51fa\u3002\n\n\u7b2c\u4e00\u79cd\u65b9\u7a0b\u5c31\u662f\u672c\u9898\uff0c\u7b2c\u4e8c\u79cd\u53eb\u505a`N\u6b21\u5269\u4f59`\uff0c\u4e5f\u53ef\u4ee5\u7528BSGS\u7b97\u6cd5\u6c42\u89e3~~\u4f46\u662f\u6bd4\u8fd9\u4e2a\u96be\u591a\u4e86~~\u3002\n\n\u9898\u76ee\u544a\u8bc9\u6211\u4eec $a,p$ \u4e92\u8d28\uff0c\u7531\u6b64\u53ef\u5f97\u5728\u6a21 $p$ \u610f\u4e49\u4e0b\u53ef\u4ee5\u6267\u884c\u5173\u4e8e $a$ \u7684\u4e58\u9664\u8fd0\u7b97\u3002\u8bbe $t=\\biggl\\lfloor\\sqrt{p}\\biggr\\rfloor,0\u2264j\u2264t-1$\uff0c\u8bbe$x=i*t-j$,\u53ef\u5f97 $a^{i*t-j}\\equiv b(mod\\; p)$\uff0c\u540c\u4e58 $a^j$ \u53ef\u5f97 $(a^t)^i\\equiv b*a^j(mod\\; p)$.\n\n\u90a3\u4e48\u600e\u4e48\u6c42\u89e3\u8fd9\u4e2a\u65b9\u7a0b\u5462\uff1f\n\n\u8003\u8651\u5bf9\u4e8e\u6240\u6709\u7684 $j\u2208[0,t-1]$ \u628a $b*a^j\\;mod\\;p$ \u63d2\u5165\u4e00\u4e2aHash\u8868\uff0c\u679a\u4e3e $i\u2208[0,t]$\uff0c\u8ba1\u7b97\u51fa $(a^t)^i\\;mod\\;p$\uff0c\u5728Hash\u8868\u4e2d\u67e5\u627e\u662f\u5426\u5b58\u5728\u5bf9\u5e94\u7684 $j$ \u5e76\u66f4\u65b0\u7b54\u6848\uff0c\u8fd9\u6837\u5c31\u5f97\u51fa\u4e86 $i,j$ \uff0c\u53c8\u56e0\u4e3a $t$ \u5df2\u77e5\uff0c\u6240\u4ee5\u53ef\u4ee5\u6c42\u51fa\u65b9\u7a0b\u7684\u89e3 $x$ . \n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(t)$\uff0c\u5373 $O(\\sqrt{p})$\uff0c\u6570\u636e\u89c4\u6a21 $10^{16}$ \u4ee5\u4e0b\u90fd\u6ca1\u6709\u4ec0\u4e48\u5927\u95ee\u9898\u3002\n\n\u5982\u679c\u5230 $10^{18}$ BSGS\u7b97\u6cd5\u5c31\u5e9f\u4e86\u9898\u89e3\u91cc\u6709\u795e\u4ed9\u8bf4\u7528`Pohlig-Hellman`\u4f46\u6211\u4e5f\u4e0d\u6653\u5f97\u8fd9\u662f\u4e2a\u5565\uff08\n\nCode\uff08\u5176\u5b9eBSGS\u7406\u89e3\u4e86\u601d\u8def\u4e4b\u540e\u4ee3\u7801\u5f88\u597d\u5199\uff09\n\n\uff08\u6570\u8bba\u57fa\u672c\u90fd\u8fd9\u6837\uff09\n\n```cpp\n#include <cstdio>\n#include <map>\n#include <cmath>\nusing namespace std;\nlong long a,b,p;\nlong long power(long long a, long long b, long long c) {//\u5feb\u901f\u5e42\n    if(b==0)\n        return 1%c;\n    long long ans=1,t=a;\n    while(b>0) {\n       if(b%2==1) ans=ans*t%c;\n       b/=2; t=t*t%c;\n    }\n    return ans;\n}\nlong long bsgs(long long a,long long b,long long p) {//bsgs\n\tmap<long long,long long> hash; hash.clear();//\u5efa\u7acb\u4e00\u4e2aHash\u8868\n\tb%=p;\n\tlong long t=sqrt(p)+1;\n\tfor(register long long i=0;i<t;++i)\n\t\thash[(long long)b*power(a,i,p)%p]=i;//\u5c06\u6bcf\u4e2aj\u5bf9\u5e94\u7684\u503c\u63d2\u5165Hash\u8868\n\ta=power(a,t,p);\n\tif(!a) return b==0?1:-1;//\u7279\u5224\n\tfor(register long long i=1;i<=t;++i) {//\u5728Hash\u8868\u4e2d\u67e5\u627e\u662f\u5426\u6709i\u5bf9\u5e94\u7684j\u503c\n\t\tlong long val=power(a,i,p);\n\t\tint j=hash.find(val)==hash.end()?-1:hash[val];\n\t\tif(j>=0&&i*t-j>=0) return i*t-j;\n\t}\n\treturn -1;//\u65e0\u89e3\u8fd4\u56de-1\n}\nsigned main() {\n\tscanf(\"%lld%lld%lld\",&p,&a,&b);\n\tlong long ans=bsgs(a,b,p);\n\tif(ans==-1) printf(\"no solution\\n\");\n\telse printf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1596809080,
        "uid": 149815,
        "name": "Isprime",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3846 \u3010[TJOI2007] \u53ef\u7231\u7684\u8d28\u6570/\u3010\u6a21\u677f\u3011BSGS\u3011"
    },
    {
        "content": "\u663e\u7136\u8fd9\u662f\u4e00\u9053\u6c42\u79bb\u6563\u5bf9\u6570\u7684\u9898\uff0c\u540c\u65f6\u4e5f\u662fBSGS\u7b97\u6cd5\u7684\u6a21\u677f\u9898\u3002\n\nbsgs\u7b97\u6cd5\uff0c\u53c8\u79f0\u5927\u6b65\u5c0f\u6b65\u7b97\u6cd5\uff08\u67d0\u5927\u795e\u79f0\u767e\u5ea6\u641c\u7d22\u8c37\u6b4c\u641c\u7d22\u7b97\u6cd5\uff09\u3002\n\n\u4e3b\u8981\u7528\u6765\u89e3\u51b3   A^x=B(mod C)(C\u662f\u8d28\u6570)\uff0c\u90fd\u662f\u6574\u6570\uff0c\u5df2\u77e5A\u3001B\u3001C\u6c42x\n\n\u5177\u4f53\u6b65\u9aa4\u5982\u4e0b\uff1a\n\n![](http://m.qpic.cn/psb?/V11LyaCX2xHeCQ/gzprqHuFOdC2LOVgrJw9U.nBGZ5tkwDXxEofYXEeXpM!/b/dPMAAAAAAAAA&bo=KQKZAgAAAAADB5I!&rf=viewer\\_4)\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n\n```cpp\n        #include <bits/stdc++.h>\n        #define F(i, l, r) for(int i = (l), _end_ = (int)(r); i <= _end_; ++i)\n        #define f(i, r, l) for(int i = (r), _end_ = (int)(l); i >= _end_; --i)\n        #define Set(a, v) memset(a, v, sizeof(a))\n        #define mid (l+r)/2\n        using namespace std;\n        bool chkmin(int &a, int b) {return b < a ? a = b, 1 : 0;}\n        bool chkmax(int &a, int b) {return b > a ? a = b, 1 : 0;}\n        inline long long read() {\n         long long x = 0, fh = 1; char ch = getchar();\n            for (; !isdigit(ch); ch = getchar() ) if (ch == '-') fh = -1;\n            for (; isdigit(ch); ch = getchar() ) x = (x<<1) + (x<<3) + (ch ^ '0');\n            return x * fh;\n        }\n        long long p,b,n;\n        long long l;\n        long long m;\n        map<long long,int>ha;\n        long long qpow(long long x,long long y){\n                long long res=1;\n                while(y){\n                   if(y&1)res=res*x%p;\n                   x=x*x%p;\n                   y>>=1;\n                }\n                return res;\n      }\n    int main () {\n        #ifndef ONLINE_JUDGE\n        freopen(\"bsgs.in\",\"r\",stdin);\n        freopen(\"bsgs.out\",\"w\",stdout);\n        #endif\n         p=read();\n         b=read();\n         n=read();\n         if(b%p==0){\n            printf(\"no solution\\n\");\n            return 0;\n         }\n         m=ceil(sqrt(p));\n         ha[n%p]=0;\n         F(i,1,m){\n            ha[qpow(b,i)*n%p]=i;\n         }\n         long long t=qpow(b,m),ans=1;\n         F(i,1,m){\n            ans=(ans*t)%p;\n            if(ha[ans]){\n               long long q=i*m-ha[ans];\n               printf(\"%lld\",(q%p+p)%p);\n               return 0;\n            }\n         }\n         printf(\"no solution\\n\");\n        return 0;\n    }\n\n```",
        "postTime": 1515313150,
        "uid": 44829,
        "name": "psk011102",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3846 \u3010 [TJOI2007]\u53ef\u7231\u7684\u8d28\u6570\u3011"
    },
    {
        "content": "\u7528\u4e8e\u6c42$A^{x} \\equiv B \\pmod{C}$ \u9ad8\u6b21\u65b9\u7a0b\u7684\u6700\u5c0f\u6b63\u6574\u6570\u89e3x\uff0c\u5176\u4e2dC\u4e3a\u7d20\u6570\n\n------------------\n\n\n\u5f15\u74061\uff1a$a^{i\\mod\\varphi(p) } \\equiv a^{i}  $ (mod p)  p\u4e3a\u7d20\u6570\uff0c\u5373$a^i$\u5728\u6a21p\u7684\u610f\u4e49\u4e0b\u4f1a\u51fa\u73b0\u5faa\u73af\u8282(\u6ce8:$\\varphi(p)$\u4e0d\u662f\u6700\u5c0f\u5faa\u73af\u8282)\n\n\u8bc1\u660e\uff1a\n   \u56e0\u4e3a$ a^{p-1} \\equiv 1 $ (mod p) (\u8d39\u9a6c\u5c0f\u5b9a\u7406) ,\u5219 $a^{k*(p-1)} \\equiv 1$ (mod p)\n\n   \u6240\u4ee5$ a^{2k * (p-1)} * a^{-k * (p-1)} \\equiv 1 $ (mod p)\n\n   \u6240\u4ee5$ a^{2k * (p-1)} $ \u4e3a $a^{-k * (p-1)}$ mod p\u610f\u4e49\u4e0b\u7684\u9006\u5143\n   \n  $\\frac{a^{i}}{a^{k * (p-1)}} \\equiv a^{i} * a^{2k * (p-1)} \\equiv a^{i} * 1 \\equiv a^{i} $ (mod p)\n\n   \u5373$ a^{i-k*(p-1)} \\equiv a^{i} $ (mod p) \n\n   \u53c8\u56e0\u4e3a$ i \\bmod \\varphi(p) = i-k*(p-1) $\n\n   \u4e14p\u4e3a\u7d20\u6570,$i-k*(p-1)=i-k * \\varphi(p)$\n    \n   \u5219$ a^{i-k*(p-1)} \\equiv a^{i\\mod\\varphi(p)} \\equiv a^{i} $ (mod p) \n\n   \u8bc1\u6bd5!\n\n----------------------------\n\n\u6839\u636e\u5f15\u74061\u6211\u4eec\u53ef\u77e5\u53ea\u9700\u8981\u679a\u4e3e\u81f3\u591a$\\varphi(C)$\u4e2a\u6570\u5c31\u80fd\u77e5\u9053\u65b9\u7a0b\u7684\u89e3\uff0c\u82e5\u679a\u4e3e\u5b8c\u540e\u53d1\u73b0\u65e0\u89e3\uff0c\u5219\u6574\u4e2a\u65b9\u7a0b\u65e0\u89e3\n\n\u8003\u8651\u6784\u9020\u4e00\u4e2am\uff0c\u4f7f\u5f97$m=ceil(\\sqrt{C})$ (\u5176\u4e2dceil()\u4e3a\u5411\u4e0a\u53d6\u6574\u51fd\u6570)\n\n$x=k*m-q$\uff0c\u539f\u65b9\u7a0b\u8f6c\u5316\u4e3a$ A^{k * m-q} \\equiv B \\pmod{p}$\n\n\u7ee7\u7eed\u5f97\u5230 $ A^{k * m} \\equiv B*A^{q} \\pmod{p}$\n\nBSGS\u6d41\u7a0b\uff1a\u5230\u4e86\u8fd9\u4e00\u6b65\uff0c\u6211\u4eec\u5148\u8003\u8651\u679a\u4e3e$B*A^{q}$\u4e2d\u7684q,\u81f3\u591a$\\sqrt{C}$\u6b21\uff0c\u7136\u540e\u6211\u4eec\u628a\u5f97\u5230\u7684\u503c\u5b58\u5165\u4e00\u4e2aHash\u8868\u4e2d\n\n\u63a5\u7740\u6211\u4eec\u5f00\u59cb\u679a\u4e3e $ A^{k * m}$ \u4e2d\u7684m\uff0c\u5219\u4e24\u6b21\u679a\u4e3e\u51fa\u6765\u7684\u5f0f\u5b50\u7684\u4e24\u4e24\u7ec4\u5408\u6b63\u597d\u53ef\u4ee5\u5f97\u5230\u6240\u6709$range \\in [1,x] $\uff0c\u82e5\u9047\u5230\u4e24\u6b21\u679a\u4e3e\u51fa\u6765\u7684\u503c\u76f8\u7b49\uff0c\u5219\u8f93\u51fa\u7b54\u6848\uff0c\u9000\u51fa\u5faa\u73af\u3002\n\n(\u6ce8:\u4f5c\u8005\u5199\u8fd9\u9898\u7684\u65f6\u5019\u8fd0\u52bf\u4e0d\u597d\uff0cHash\u5199\u6302\u4e86\uff0c\u6362\u6210\u4e86map\uff0c\u6548\u679c\u4e0d\u5f71\u54cd)\n\nCode:\n```cpp\n#include<stdio.h>\n#include<math.h>\n#include<map>\nusing namespace std;\n#define ll long long\n#define int ll\n#define HASH_MOD 76799777LL\n\nmap<int,int> hash;\n\nll qpow(ll A,ll B,ll C){\n\tif(B==0) return 1;\n\tif(B==1) return A;\n\tll t=qpow(A,B>>1,C);\n\tt=t*t%C;\n\tif(B&1) t=t*A%C;\n\treturn t;\n}\nll BSGS(ll A,ll B,ll C){\n\tconst int sizes=ceil(sqrt(C));\n\tll base=B%C;\n\thash[base]=0;\n\tfor(int i=1;i<=sizes;i++){\n\t\tbase=base*A%C;\n\t\thash[base]=i;\n\t}\n\tbase=qpow(A,sizes,C);\n\tll tmp=1;\n\tfor(ll i=1;i<=sizes;i++){\n\t\ttmp=tmp*base%C;\n\t\tif(hash[tmp])\n\t\t\treturn ((i*sizes-hash[tmp])%C+C)%C;\n\t}\n\treturn -1;\n}\nll P,B,N;\nsigned main(){\n\tscanf(\"%lld%lld%lld\",&P,&B,&N);\n\tif(!(B%P)){\n        printf(\"no solution\\n\");\n        return 0;\n    }\n\tll ans=BSGS(B,N,P);\n\tif(ans!=-1) printf(\"%lld\",ans);\n\telse printf(\"no solution\");\n}\n```",
        "postTime": 1554380215,
        "uid": 83337,
        "name": "wwlw",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3846 \u3010 [TJOI2007]\u53ef\u7231\u7684\u8d28\u6570\u3011(BSGS)"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P3846)\n\n**2020.8.3\u4e00\u6539:\u6ce8\u610fsqrt(y)\u540e\u9762\u8981+1 \u6570\u636e:3 6 3 **\n\n\n# \u4e00.\u5927\u4f53\u601d\u8def\n\u5149\u770b\u9898\u76ee\u5c31\u77e5\u9053\uff0c\u8fd9\u662f\u4e00\u9053BSGS\u7684\u6a21\u677f\u9898\n\n\u56e0\u6b64\u672c\u9898\u7684\u6b63\u89e3\u5c31\u662fBSGS\n\nBSGS\u662f\u5927\u6b65\u5c0f\u6b65\u7b97\u6cd5\u7684\u4e00\u79cd\n\n\u89e3\u51b3$a^x\\equiv b(\\mod p)$\u4e2d\u975e\u8d1f\u6574\u6570$x$\u6700\u5c0f\u503c\uff0c\u5176\u4e2d$p$\u4e3a\u8d28\u6570\n\n# \u4e8c.\u5b9e\u73b0\u65b9\u6cd5\n## 1.BSGS\n\u9898\u76ee\u8bf4\u4fdd\u8bc1$p$\u662f\u8d28\u6570\n\n\u90a3\u4e48\u611f\u6027\u7406\u89e3\u4e00\u4e0b\u518d\u7ed3\u5408\u4e00\u4e0b\u8d39\u9a6c\u5c0f\u5b9a\u7406\u5c31\u77e5\u9053$x$\u5728$[1,p-1]$\u4e2d\u662f\u5faa\u73af\u7684\n\n\u4f46\u663e\u7136\u4e0d\u53ef\u4ee5\u66b4\u529b\n\n\u8003\u8651\u4e00\u4e0b\u62c6\u5206\u4e00\u4e0b$x$\n\n\u82e5\u4ee4$y=\\sqrt p,x=my-n$\n\n\u5219\u5c31\u4f1a\u6709\n$$A^{my-n}=B \\mod p$$\n\u90a3\u4e48\n$$B\\cdot A^n=\\cdot A^{my}$$\n\u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u662f\u8981\u627e\u76f8\u5e94\u7684$b$\u548c$-k$\n\n\u63a5\u7740\u6211\u4eec\u5c31\u53ef\u4ee5\u628a$n$\u5faa\u73af\u4e00\u4e0b$[1,y-1]$\n\n\u5f97\u5230\u7684$A^n \\times B$\u5728\u6a21$p$\u540e\u548c$n$\u653e\u5230\u4e00\u4e2a$map$\u91cc\u5b58\u4e00\u4e0b\n\n\u76f8\u5bf9\u5e94\u7684\u679a\u4e3e$m$\uff0c\u8fd9\u6b21\u679a\u4e3e\u5230\u7684\u7ed3\u679c\u5c31\u53ef\u4ee5\u548c\u4e0a\u4e00\u6b65\u5f97\u5230\u7684$map$\u8fdb\u884c\u6bd4\u5bf9\n\n\u5982\u679c\u6bd4\u5bf9\u6210\u529f\uff0c\u90a3\u4e48\u53ef\u884c\u7684\u65b9\u6848\u4e3a$x=my-n$\n\n# \u4e09.\u5b9e\u73b0\u7ec6\u8282\n\u9898\u76ee\u4e2d\u6709\u8bf4\u5b58\u5728$no.solution$\u7684\u60c5\u51b5\n\n\u9664\u4e86\u5728\u6700\u540e\u6ca1\u6709\u5339\u914d\u7b54\u6848\u7684\u65f6\u5019\u8f93\u51fa$no.solution$\n\n\u518d\u8f93\u5165\u7684\u65f6\u5019\u6211\u4eec\u8fd8\u8981\u7279\u5224\u4e00\u4e0b$b$\u662f\u5426\u53ef\u4ee5\u6574\u9664$gcd(a,p)$\n\n\u4f8b\u5982$32 14 9$\u5c31\u662f\u4e00\u7ec4\u4e0d\u7b26\u5408\u60c5\u51b5\u7684\u6570\u636e\n\n\u9700\u8981\u6211\u4eec\u7279\u5224\n\n# \u56db.\u4ee3\u7801\n```\n#include<cstdio>\n#include<cctype>\n#include<map>\n#include<cmath>\nusing namespace std;\ninline int R(){\n\tint r=0;char c=getchar();\n\twhile(!isdigit(c)) c=getchar();\n\twhile(isdigit(c)) r=(r<<1)+(r<<3)+(c^48),c=getchar();\n\treturn r;\n}\nint a,b,m,n,y,x,p;\nmap<int,int> mp;\ninline int gcd(int a,int b){\n\tif(a%b==0) return b;\n\treturn gcd(b,a%b);\n}\ninline int fastm(int a,int k){\n\tlong long ans=1,node=a;\n\twhile(k){\n\t\tif(k&1) ans=ans*node%p;\n\t\tk>>=1;\n\t\tnode=node*node%p;\n\t}\n\treturn ans;\n}\ninline void BSGS(){\n\tmp.clear();\n\ty=sqrt(p)+1;\n\tmap<int,int>:: iterator it;//\u8fed\u4ee3\u5668 \n\tfor(register long long flag=b%p,i=0;i<y;i++,flag=flag*a%p){\n\t\tit=mp.find(flag);//flag=a^n*b\n\t\tif(it!=mp.end()) it->second=i;\n\t\t//\u5982\u679c\u4e4b\u524d\u6709\u8fc7\u540c\u6837\u7684flag,\u90a3\u4e48\u663e\u7136\u540e\u6765\u7684\u4f1a\u66f4\u4f18\uff0c\u56e0\u4e3any\u51cf\u5b8c\u4f1a\u66f4\u5c0f \n\t\telse mp.insert(pair<int,int>(flag,i));//\u5426\u5219\u63d2\u5165 \n\t}\n\tlong long cnt=fastm(a,y);//a^y\uff0c\u540e\u9762\u53ef\u4ee5\u76f4\u63a5\u4e58 \n\tlong long flag=cnt;\n\tfor(register long long i=1;i<=y;i++,flag=flag*cnt%p){\n\t\tit=mp.find(flag);\n\t\tif(it==mp.end()) continue;//\u5982\u679c\u627e\u4e0d\u5230\u7ee7\u7eed \n\t\tprintf(\"%d\\n\",y*i-(it->second));//x=my-n\n\t\treturn ;\n\t}\n\tprintf(\"no solution\\n\");\n\treturn ;\n}\nint main(){\n\tscanf(\"%d%d%d\",&p,&a,&b);\n\tif(b%gcd(p,a)) printf(\"no solution\\n\");//\u5224\u662f\u5426\u5408\u6cd5 \n\telse BSGS();\n\treturn 0;\n}\n```\n# \u4e94.\u540e\u8bb0\n\u9047\u5230\u6c42$a^x=b(\\mod p)$\u4e00\u7c7b\u7684\u9898\u76ee\u65f6\n\n\u5982\u679c$p$\u4e3a\u8d28\u6570\uff0c\u53ef\u4ee5\u7528$BSGS$\n\n\u6838\u5fc3\u601d\u60f3\u4e3a\u5c06$x$\u5e73\u5747\u5730\u62c6\u5206,\u914d\u5bf9\uff0c\u5927\u6b65\u5c0f\u6b65\u7b97\u6cd5\uff0c\u4ece\u800c\u4f18\u5316\u65f6\u95f4\n\n\u5982\u679c\u9898\u76ee\u6ca1\u6709\u9650\u5236p\u4e3a\u8d28\u6570\n\n\u90a3\u4e48\u5c31\u9700\u8981\u7528\u5230$exBSGS$\n\n[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P4195)\n\nFinally,\u8c22\u8c22\u5927\u5bb6\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.luogu.com.cn/blog/HongseFox/solution-p3846)",
        "postTime": 1589899215,
        "uid": 93838,
        "name": "Hongse_Fox",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3846 \u3010[TJOI2007] \u53ef\u7231\u7684\u8d28\u6570/\u3010\u6a21\u677f\u3011BSGS\u3011"
    },
    {
        "content": "# \u601d\u8def\n\n- \u8ddf\u697c\u4e0a\u5404\u4f4d\u5927\u4f6c\u4e00\u6837\uff0c\u90fd\u662fBSGS\u7b97\u6cd5\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u8d58\u8ff0\u4e86QwQ\n\n- \u770b\u5230\u697c\u4e0a\u5404\u4f4d\u5927\u4f6c\u5199\u54c8\u5e0c\u8868\uff0c\u849f\u84bb\u745f\u745f\u53d1\u6296\uff08\u5927\u96fe\n- \u6211\u7531\u4e8e\u5404\u79cd\u539f\u56e0\u5199\u4e86\u4e2a\u4e8c\u5206\uff0c\u56e0\u6b64\u53d1\u7bc7\u9898\u89e3QwQ\n- \u601d\u8def\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u8981\u67e5\u627e $b^{i\\times\\sqrt p+1}$ \u5230$b^{(i+1)\\times\\sqrt p}$\u4e2d\uff0c\u6709\u6ca1\u6709\u6a21p\u548cn\u540c\u4f59\u7684\n- **\u7b49\u4ef7\u4e8eb\u5230 $b^{\\sqrt p}$ \u4e2d\uff0c\u6709\u6ca1\u6709\u548c $n \\times$ ($b^{i\\times\\sqrt p}$\u6a21p\u7684\u9006\u5143) \u540c\u4f59\u7684**\n- \u524d\u8005\u53ef\u4ee5\u9884\u5904\u7406\u51fa\uff0c\u7136\u540e\u6392\u5e8f\u5c31\u53ef\u4ee5\u8fdb\u884c\u4e8c\u5206\u67e5\u627e\uff0c\u6bcf\u6b21$O(logn)$\u590d\u6742\u5ea6\n- \u7531\u4e8ep\u4e3a\u8d28\u6570\uff0c\u9006\u5143\u53ef\u7531\u5feb\u901f\u5e42 $O(\\log_2{n})$ \u6c42\u51fa\uff08\u539f\u7406\u4e3a\u8d39\u9a6c\u5c0f\u5b9a\u7406\uff09\n- \u603b\u590d\u6742\u5ea6$O(\\sqrt n \\times \\log_2{n} \\times \\log_2{n})$\n- \u8be6\u89c1\u4ee3\u7801\n\n---\n\n# \u4ee3\u7801\n\n```\n//P3846 [TJOI2007]\u53ef\u7231\u7684\u8d28\u6570   \n//submit 1   \n//By sxt on 2020.3.14    \n#include<bits/stdc++.h>    \n\n#define rg register int    \n#define il inline    \n#define int long long     \n#define in read()     \n#define pint(x) printf(\"%lld\\n\", x)     \n#define _num(x) (x >= '0' && x <= '9')    \n#define mid ((l+r)>>1)    \n#define el else if            \n\nusing namespace std;           \n\ntypedef long long ll;        \n\nconst int N = (1<<16)+7;        \n\nil int read(){            \n\tint x=0,f=1;        \n\tchar ch=getchar();         \n\twhile(!_num(ch)){       \n\t\tif(ch=='-')        \n\t\t\tf=-1;          \n\t\tch=getchar();               \n\t}                 \n\twhile(_num(ch)){             \n\t\tx=x*10+ch-'0';             \n\t\tch=getchar();            \n\t}                   \n\treturn x*f;                   \n}\n\n\nint p, m, n, b, s, ans, ls, now;              \nstruct node{                     \n\tint id, num;            \n}a[N];\n\nil int qpow(int a, int b, int P){            \n\tint ret = 1;                     \n\twhile(b){      \n\t\tif(b&1) ret = 1ll * ret * a % P;         \n\t\ta = 1ll * a * a % P;                \n\t\tb >>= 1;            \n\t}             \n\treturn ret;   \n}\n\nbool cmp(node x, node y){    \n\treturn x.num < y.num;     \n}\n\nil int check(int pos){//\u4e8c\u5206\u51fd\u6570          \n\tint l = 1, r = m;        \n\twhile(l < r){      \n\t\tif(pos < a[mid].num) r = mid-1;      \n\t\tel(pos > a[mid].num) l = mid+1;    \n\t\telse return a[mid].id;          \n\t}     \n\tif(pos == a[l].num) return a[l].id;    \n\tif(pos == a[r].num) return a[r].id;    \n\treturn 0;    \n}  \n\nsigned main()               \n{                      \n\tp = in, b = in, n = in;             \n\tif(!(b % p)){                \n\t\tprintf(\"no solution\\n\");           \n\t\treturn 0;             \n\t}                          \n\ta[0].num = 1;     \n\tm = ceil(sqrt(p));     \n\tfor(rg i = 1; i <= m; ++ i){    \n\t\ta[i].num = b * a[i-1].num % p;     \n\t\ta[i].id = i;           \n\t}             \n\tint cc, tt;            \n\tls = a[m].num;             \n\tnow = 1;         \n\tsort(a+1, a+m+1, cmp);//\u9884\u5904\u7406\uff0c\u65b9\u4fbf\u4e8c\u5206          \n\tfor(rg i = 0; i < m; ++ i, now = now * ls % p){        \n\t\ttt = n * qpow(now, p-2, p) % p;//n\u4e58\u4ee5now\u7684\u9006\u5143                \n\t\ts = check(tt);//\u4e8c\u5206\u67e5\u627e\uff0c\u627e\u5230\u8fd4\u56de\u662fb\u7684\u51e0\u6b21\u65b9\uff0c\u672a\u627e\u5230\u8fd4\u56de0                     \n\t\tif(s){//\u627e\u5230\u4e86\uff0c\u6109\u5feb\u7ed3\u675f\uff0c\u522b\u5fd8\u4e86return 0           \n\t\t\tans = i * m + s;         \n\t\t\tpint(ans);           \n\t\t\treturn 0;       \n\t\t}                  \n\t}    \n\tprintf(\"no solution\\n\");  \n\treturn 0;  \n}   \n\n```\n---\n\n\n***THE \u00b7 END .***",
        "postTime": 1584197081,
        "uid": 69263,
        "name": "stansxt",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3846 \u3010 [TJOI2007]\u53ef\u7231\u7684\u8d28\u6570\u3011"
    },
    {
        "content": "## BSGS\n\n\n**~~\uff08\u5317\u4e0a\u5e7f\u6df1\uff09\uff08\u62d4\u5c71\u76d6\u4e16\uff09\u7b97\u6cd5~~**\n\n\u5176\u5b9e\u662f**Baby Steps Giant Steps**\n\n**\u524d\u7f6e\u829d\u58eb\uff1a~~\u6b27\u62c9\u5b9a\u7406~~\uff08\u5176\u5b9e\u5b8c\u5168\u4e0d\u7528\uff09\u3002**\n\nBSGS\u9002\u7528\u4e8e\u5bf9\u4e8e\u7ed9\u5b9a\u7684\u4e24\u4e2a\u4e92\u8d28\u7684\u6b63\u6574\u6570$a,p$\uff0c\u6c42\u4e00\u4e2a\u975e\u8d1f\u6574\u6570$x$\u4f7f\u5f97$a^x\\equiv b\\pmod p$\n\n\u5176\u4e2d$a,p$\u4e92\u8d28\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u7ed9\u51fa\u6b27\u62c9\u5b9a\u7406\n\n$$a^{\\phi(p)}\\equiv1 \\pmod p$$\n\n\u53c8\u56e0\u4e3a\n$$a^0\\equiv 1\\pmod p$$\n\n\u4e0d\u96be\u770b\u51fa$0$~$\\phi(p)$\u662f\u4e00\u4e2a\u5faa\u73af\u8282\u3002\n\n\u90a3\u4e48\u6700\u591a\u5faa\u73af$\\phi(p)$\u6b21\u6211\u4eec\u80fd\u627e\u5230\u7b54\u6848\uff0c\u5426\u5219\u65e0\u89e3\u3002\n\n\u90a3\u4e48\u4e0d\u96be\u5199\u51fa\u66b4\u529b\u4ee3\u7801\u3002\n\n---\n\n\u6240\u4ee5BSGS\u624d\u5f00\u59cb\u3002\u3002\u3002\n\n\u8bbe$x=im-k$,\u5176\u4e2d$0\\le k\\le m$\u3002\n\n\u90a3\u4e48\u65b9\u7a0b\u53d8\u4e3a\n$$a^{im-k}\\equiv b\\pmod p$$\n\u4e24\u8fb9\u540c\u4e58$a^k$\n$$a^{im}\\equiv {a^kb}\\pmod p$$\n\n\u90a3\u4e48\u53d8\u6210\u8fd9\u6837\u5b50\u6709\u4ec0\u4e48\u7528\u5462\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u62c6\u6210\u4e24\u90e8\u5206\u3002\u5148\u8ba1\u7b97\u53f3\u8fb9${a^kb}\\ mod\\ p$\u7684\u503c\uff0c\u628a\u4ed6\u653e\u5165\u4e00\u4e2ahash\u8868\u6216\u662fmap\u91cc\u3002\u518d\u8ba1\u7b97\u5de6\u8fb9$a^{im}\\ mod\\ p$\u7684\u503c\uff0c\u4ece\u5c0f\u5230\u5927\u679a\u4e3e\u6240\u6709\u53ef\u80fd\u7684$i$\u503c\uff0c\u518d\u5728hash\u8868(map)\u67e5\u8be2\u3002\n\n\u590d\u6742\u5ea6$O(max(m,\\phi(p)/m))$\n\n\u6700\u574f\u5373$p$\u4e3a\u8d28\u6570\u65f6$\\phi(p)$\u4e3a$p-1$\n\n\n\u663e\u7136\u5f53$m$\u53d6$\\sqrt p$\u65f6\u6700\u5c0f\u4e3a$O(\\sqrt p)$\n\n\u5f53\u7136\u7528$map$\u8981\u591a\u4e00\u4e2a$log$\n\n\u6ce8\u610f\u4e8b\u9879:\n\n$m$\u9700\u8981\u53d6$\\sqrt p+1$\u6216\u662f$ceil(\\sqrt p)$\n\n$k$\u7684\u53d6\u503c\u5f88\u7384\u5b66\u6700\u597d\u8fd8\u662f\u8981\u53d6$0$\n\n$vis.count(t)$\u5224\u65ad\u662f\u5426\u5b58\u5728\uff0c\u800c\u975e$vis[t]$\n\n\u91cd\u8ff0\u7b97\u6cd5\u6b65\u9aa4\n\n1.$[0,m]$\u679a\u4e3e$k$,\u5c06${a^kb}\\ mod\\ p$\u7684\u503c\u653e\u5165$hash(map)$\n\n\n2.$[1,m]$\u679a\u4e3e$i$,\u5c06$a^{im}\\mod p$\u5728$hash(map)$\u4e2d\u67e5\u8be2\u3002\u82e5\u5b58\u5728\u5219\u6b64\u65f6\u7684$i* m-vis[t]$\u4e3a\u6700\u5c0f\u503c\u3002\n\n3.\u82e5\u8d85\u8fc7\u679a\u4e3e\u8303\u56f4\u5373\u4e3a\u65e0\u89e3\n\n## \u4ee3\u7801(\u8d85\u77ed\uff08\u0e51\u2022\u0300\u3142\u2022\u0301\uff09\u0648)\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nll p,b,n,m;\nmap<ll,int>vis; \nll quick_pow(ll a,ll b,ll p){\n\tll res=1;\n\tfor(;b;b>>=1){\n\t\tif(b&1)res=res*a%p;\n\t\ta=a*a%p;\n\t}\n\treturn res;\n}\nint main(){\n\tscanf(\"%lld%lld%lld\",&p,&b,&n);\n\tm=ceil(sqrt(p));\n\tfor(ll i=0,t=n;i<=m;i++,t=t*b%p)vis[t]=i;\n\tfor(ll i=1,tt=quick_pow(b,m,p),t=tt;i<=m;i++,t=t*tt%p)\n\tif(vis.count(t))printf(\"%lld\\n\",i*m-vis[t]),exit(0);\n\tputs(\"no solution\");\n\treturn 0;\n}\n```\n",
        "postTime": 1567758544,
        "uid": 58707,
        "name": "Edward_Elric",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3846 \u3010 [TJOI2007]\u53ef\u7231\u7684\u8d28\u6570\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u6211\u4eec\u56de\u987e\u4e00\u4e0b Fermat-Oula \u5b9a\u7406\uff1a$m\\space|\\space a^m-a$\n\n\u628a\u5b83\u4e58 $a$ \u7684\u82e5\u5e72\u6b21\u65b9\uff1a$m\\space|\\space a^{m+k}-a^k$\n\n\u901a\u8fc7 Fermat-Oula \u5b9a\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053 $l \\leq p$\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4f59\u6570\u7684\u5f62\u5f0f\u6765\u5206\u4e00\u4e0b\u5757\uff0c\u628a $l$ \u53d8\u6210 $i \\times t-j$\uff0c\u5176\u4e2d $1 \\leq i \\leq t,0 \\leq j \\lt t,t=\\lceil \\sqrt p \\rceil$\u3002\n\u90a3\u4e48\uff0c\u6211\u4eec\u9700\u8981\u89e3\u51b3\u7684\u95ee\u9898\u53d8\u6210\u4e86\uff1a$p\\space|\\space (b^t)^i-n \\times b^j$\n\n\u7b80\u800c\u8a00\u4e4b\uff0c$b^i \\times t$ \u548c $n \\times b^j$ \u6a21 $p$ \u540c\u4f59\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u6784\u9020 $i$ \u548c $j$\u3002\n\n\u90a3\u4e48\uff0c\u5982\u4f55\u6784\u9020 $i$ \u548c $j$ \u5462\uff1f\u6211\u4eec\u9700\u8981\u5206\u4e24\u6b65\uff1a\n\n\u7b2c\u4e00\u6b65\uff08Baby Step\uff09\uff1a\u4ece $0$ \u5230 $t-1$ \u679a\u4e3e $j$\uff0c\u7528\u4e00\u4e2a map \u628a $j$ \u6620\u5c04\u5230 $n \\times b^j \\bmod p$\u91cc\uff0c\u4e5f\u5c31\u662f\u5728 $n \\times b^j$ \u7684\u4f59\u6570\u8fd9\u4e2a\u5730\u5740\u5b58 $j$\u3002\n\n\u7b2c\u4e8c\u6b65\uff08Giant Step\uff09\uff1a\u6211\u4eec\u901a\u8fc7\u5feb\u901f\u5e42\u53ef\u4ee5\u5f97\u5230 $b^t \\bmod p$ \u7684\u503c\uff0c\u6bcf\u6b21\u518d\u679a\u4e3e $i$\uff0c\u7136\u540e\u5728 map \u91cc\u627e $b^i \\times t$ \u4e3a\u5730\u5740\u4e2d\u662f\u5426\u6709\u503c\uff0c\u82e5\u6709\uff0c\u5219\u7528 $i \\times t-j$ \u66f4\u65b0\u7b54\u6848\u3002\n\n\u8fd9\u6837\uff0c\u5c31\u53ef\u4ee5\u6c42\u5f97\u6700\u5c0f\u89e3\u4e86\uff01\n\n\u4ee3\u7801\uff1a\n\n```cpp\n\n#include<bits/stdc++.h>\nusing namespace std;\nint ans=2147483647;\nmap<int,int>mp;\nvoid baby_step(int b,int n,int p)\n{\n  int cs=0,t=sqrt(p-0.5)+1;\n  while(cs<t)\n  {\n    if(!mp[n])mp[n]=cs+1;\n    n=1ll*n*b%p,cs++;\n  }\n}\nint powdv(int b,int t,int p)\n{\n  int ans=1;\n  while(t)\n  {\n    if(t&1)ans=(1ll*ans*b)%p;\n    t>>=1;\n    b=(1ll*b*b)%p;\n  }\n  return ans;\n}\nvoid giant_step(int b,int n,int p)\n{\n  int cs=1,t=sqrt(p-0.5)+1,b2;\n  b=b2=powdv(b,t,p);\n  while(cs<=t)\n  {\n    if(mp[b])\n      ans=min(ans,t*cs-mp[b]+1);\n    b=(1ll*b*b2)%p,cs++;\n  }\n}\nint main()\n{\n  int p,b,n;\n  cin>>p>>b>>n;\n  baby_step(b,n,p);\n  giant_step(b,n,p);\n  if(ans<2147483647)cout<<ans<<endl;\n  else cout<<\"no solution\\n\";\n  return 0;\n}\n```\n\n\u6700\u540e\u63a8\u8350\u6211\u7684\u516c\u4f17\u53f7\uff1a[\u8fd9\u91cc](https://mp.weixin.qq.com/s/fTcCp72mrhiL3-kvmzxuIw)\u3002",
        "postTime": 1583912064,
        "uid": 107484,
        "name": "wmy_goes_to_thu",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P3846 \u3010 [TJOI2007]\u53ef\u7231\u7684\u8d28\u6570\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u6c42\u4e00\u4e2a\u6700\u5c0f\u7684$L$\uff0c\u6ee1\u8db3$B^L\\equiv N(mod\\ P)$\n\n\u8fd9\u5c31\u9700\u8981\u7528\u5230$BGSG(Baby\\ Step\\ Giant\\ Step)$\u7b97\u6cd5\u4e86\uff08\u5176\u5b9e\u5c31\u662f\u4e2a\u88f8\u7684\u677f\u5b50\u9898QAQ\uff09\n\n\u9996\u5148\u8981\u77e5\u9053$P$\u662f\u8d28\u6570\uff0c\u6240\u4ee5\u539f\u5f0f\u4e2d\u7684$L$\u4f1a\u5728\u6a21$P$\u610f\u4e49\u4e0b\u5faa\u73af\uff0c\u6700\u5c0f\u89e3\u5728$[0,P-1]$\n\n\u6211\u4eec\u8bbe$L=i\\times m-j$\uff0c\u5176\u4e2d$m=\\left \\lceil {\\sqrt P} \\right \\rceil$\uff0c$1\\le j\\le m$,\n\n\u5219\u65b9\u7a0b\u53d8\u4e3a$B^{i\\times m-j}\\equiv N(mod\\ P)$\n\n\u79fb\u9879\u5f97\u5230$(B^{m})^{i}\\equiv N\\times B^{j}(mod\\ P)$\n\n\u800c$B,m,n,P$\u90fd\u662f\u5df2\u77e5\u7684\uff0c\u6211\u4eec\u9009\u62e9\u54c8\u5e0c\uff0c\u628a\u53f3\u8fb9$N\\times B^{j}mod\\ P$\u7684\u503c\u9884\u5904\u7406\u51fa\u6765\u4e22\u5230$map$\u91cc\n\n\u6bcf\u6b21\u679a\u4e3e$i$\uff0c\u8ba1\u7b97\u51fa$(B^{m})^{i}mod\\ P$\u7684\u503c\uff0c\u5982\u679c\u5728$map$\u91cc\u51fa\u73b0\uff0c\u8bf4\u660e\u539f\u65b9\u7a0b\u6210\u7acb\uff0c\u8ba1\u7b97\u51fa\u6765\u7684$L$\u5c31\u662f\u6700\u5c0f\u89e3\u4e86\n\n\u6709\u4e00\u70b9\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c$B$\u662f$P$\u7684\u500d\u6570\uff0c\u90a3\u4e48$N$\u5fc5\u987b\u4e5f\u662f$P$\u7684\u500d\u6570\uff0c\u5426\u5219\u65e0\u89e3\uff0c\u8fd9\u4e2a\u60c5\u51b5\u7279\u5224\u4e0b\u5c31\u53ef\u4ee5\u4e86\n\n**Code**\n``` cpp\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <map>\n#include <cmath>\n#define int long long\nusing namespace std;\nint p,b,n;\nmap <int,int> f;\nint mypow(int a,int x,int p)\n{\n\tint s=1;\n\twhile (x)\n\t{\n\t\tif (x&1)s=s*a%p;\n\t\ta=a*a%p;\n\t\tx>>=1;\n\t}\n\treturn s;\n}\nsigned main()\n{\n\tcin>>p>>b>>n;\n\tif (b%p==0&&n%p!=0)\n\t{\n\t\tcout<<\"no solution\"<<endl;\n\t\treturn 0;\n\t}\n\tint m=ceil(sqrt(p)),now=n%p;\n\tfor (int i=0;i<m;i++)\n\t{\n\t\tf[now]=i;\n\t\tnow=now*b%p;\n\t}\n\tnow=mypow(b,m,p);\n\tint tmp=now;\n\tfor (int i=1;i<=m;i++)\n\t{\n\t\tif (f.count(now))\n\t\t{\n\t\t\tcout<<((i*m-f[now])%p+p)%p<<endl;\n\t\t\treturn 0;\n\t\t}\n\t\tnow=now*tmp%p;\n\t}\n\tcout<<\"no solution\"<<endl;\n\treturn 0;\n}\n\n```",
        "postTime": 1561344479,
        "uid": 73231,
        "name": "eee_hoho",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3846 \u3010 [TJOI2007]\u53ef\u7231\u7684\u8d28\u6570\u3011"
    }
]