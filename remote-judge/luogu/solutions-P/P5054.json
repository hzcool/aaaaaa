[
    {
        "content": "## \u9898\u610f\n\u7ed9\u4f60\u4e00\u68f5\u8282\u70b9\u4e2a\u6570\u4e3a $n$ \u7684\u6709\u6839\u6811\uff0c\u6c42\u51fa\u5728\u6240\u7ed9\u65f6\u95f4\u5185\u7684 $ans$ \u6700\u5927\u503c\u3002[QWQ](https://www.luogu.com.cn/blog/xzc/solution-p5054)\n## \u5206\u6790\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8282\u70b9\u6765\u770b\n\n\n- \u505c\u5728\u8fd9\u4e2a\u8282\u70b9\u4e86\u3002\n\n- \u53bb\u904d\u5386\u5b50\u6811\u4e86\u3002\n\n- \u4e00\u7cfb\u5217\u64cd\u4f5c\u4e4b\u540e\uff0c\u8fd4\u56de\u7236\u4eb2\u4e86\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u72b6\u6001\u3002 $dp[x][i][0/1]$ \u5bf9\u4e8e\u8282\u70b9 $x$ \u8003\u8651\uff0c\u4f7f\u7528\u4e86 \u5927\u5c0f\u4e3a $i$ \u7684\u65f6\u95f4\u3002\u5176\u4e2d $0$ \u8868\u793a\u53bb\u904d\u5386\u5b50\u6811\u4e86\uff0c $1$ \u8868\u793a\u505c\u5728\u8fd9\u4e2a\u8282\u70b9\u4e86\u3002 \u800c\u8fd4\u56de\u7236\u4eb2\u5219\u53ef\u4ee5\u7528 $dp[x][i+1][1]$ \u8868\u793a\uff0c\u56e0\u4e3a\u518d\u8d70\u4e00\u6b65\u5c31\u53ef\u4ee5\u8fd4\u56de\u7236\u4eb2\u3002\u6709\u5982\u4e0b\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$\ndp[x][i+j+2][1] = \\max(dp[x][i][1] +dp[y][j][1])\n$$\n$$\ndp[x][i+j+1][0] = \\max(dp[x][i][1]+dp[y][j][0])\n$$\n$$\ndp[x][i+j+2][0] = \\max(dp[x][i][0]+dp[y][j][1])\n$$\n\u5206\u522b\u8868\u793a\uff1a\n\n- \u513f\u5b50\u8fd4\u56de\u7236\u4eb2\uff0c\u7236\u4eb2\u505c\u4e0b\u3002\n\n- \u7236\u4eb2\u505c\u4e0b\uff0c\u53bb\u513f\u5b50\u5b50\u6811\u3002 \n\n- \u513f\u5b50\u8fd4\u56de\uff0c\u53bb\u7236\u4eb2\u5b50\u6811\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(nm^2)$ \u3002\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint read()\n{\n\tint x=0,f=0;char ch=getchar();\n\twhile(!isdigit(ch)){if(ch=='-')f=1;ch=getchar();}\n\twhile(isdigit(ch)){x=x*10+ch-'0';ch=getchar();}\n\treturn f?-x:x;\n}\nconst int N = 1100;\nint dp[N][N][2],n,m,val[N];\nvector<int> G[N];\nvoid dfs(int x,int fa)\n{\n\tfor(int i = 0;i < G[x].size();i++)\n\t{\n\t\tint y = G[x].at(i);\n\t\tif(y == fa) continue;\n\t\tdfs(y,x);\n\t\tfor(int j = m;j >= 0;j--)\n\t\t{\n\t\t\tfor(int k = m;k >= 0;k--)\n\t\t\t{\n\t\t\t\tif(k + j + 2 <= m) \n\t\t\t\tdp[x][j+k+2][0] = max(dp[x][j+k+2][0],dp[x][j][0]+dp[y][k][1]);\n\t\t\t\tdp[x][j+k+2][1] = max(dp[x][j+k+2][1],dp[x][j][1]+dp[y][k][1]);\t\n\t\t\t\tif(k + j + 1 <= m)\n\t\t\t\tdp[x][j+k+1][0] = max(dp[x][j+k+1][0],dp[x][j][1]+dp[y][k][0]);\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i = m;i >= 1;i--)\n\tdp[x][i][1] = max(dp[x][i][1],dp[x][i-1][1]+val[x]),\n\tdp[x][i][0] = max(dp[x][i][0],dp[x][i-1][0]+val[x]);\n//\tfor(int i = 1;i <= m;i++)\n//\t{\n//\t\tcout<<\"x:: \" <<x<<\"   i:: \"<<i<<\"  dp::\"<<dp[x][i][0]<<endl;\n//\t}\n}\nint main()\n{\n\tn = read();m = read();\n\tfor(int i = 1;i <= n;i++) val[i] = read();\n\tfor(int i = 1;i < n;i++)\n\t{\n\t\tint a = read(),b = read();\n\t\tG[a].push_back(b);\n\t\tG[b].push_back(a);\n\t}\n\tdfs(1,0);\n\tcout<<dp[1][m][0]<<endl;\n\treturn 0;\n}\n```\n\n\n",
        "postTime": 1595253054,
        "uid": 227824,
        "name": "JK_LOVER",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5054 \u3010[COCI2017-2018#7] Dostavlja\u010d\u3011"
    },
    {
        "content": "## \u601d\u8def\n\u5f88\u660e\u663e\u8fd9\u662f\u4e00\u9053\u6811\u5f62 $DP$ \u7684\u9898\u3002\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u548c\u697c\u4e0a\u5927\u4f6c\u7684\u4e00\u6837\uff1a\n\n$dp[x][i+j+2][1] = \\max(dp[x][i][1] +dp[y][j][1])$\n\n$dp[x][i+j+1][0] = \\max(dp[x][i][1]+dp[y][j][0])$\n\n$dp[x][i+j+2][0] = \\max(dp[x][i][0]+dp[y][j][1])$\n\n\u6211\u7528\u4e86\u94fe\u5f0f\u524d\u5411\u661f\u6765\u5b58\u56fe\uff0c\u56e0\u4e3a\u9898\u76ee\u7ed9\u4e86\u8fb9\u7684\u6700\u5927\u6570\u91cf\u4e3a $2 \\times n-1$ \u3002\n\n## AC CODE\n```cpp\n#include<stdio.h>\nint n,m,cnt;\nint v[501],dp[501][501][2],head[501];\nstruct edge{\n\tint v,next;\n}e[999];\ninline int read(){//\u5feb\u8bfb\u3002\n    register int x=0;\n    char c=getchar();\n    while(c<'0'||c>'9')c=getchar();\n    while(c>='0'&&c<='9')x=x*10+c-'0',c=getchar();\n    return x;\n}\ninline void write(int x)//\u5feb\u5199\u3002\n{\n    if(x<0)putchar('-'),x=-x;\n    if(x>9)write(x/10);\n    putchar(x%10+48);\n}\ninline void add(int u,int v){//\u94fe\u5f0f\u524d\u5411\u661f\u5b58\u56fe\u3002\n\te[++cnt].v=v;\n\te[cnt].next=head[u];\n\thead[u]=cnt;\n}\ninline int Max(int a,int b){//\u6700\u5927\u503c\u51fd\u6570\uff0c\u6bd4STL\u5e93\u91cc\u7684max\u51fd\u6570\u8981\u5feb\u4e00\u70b9\u3002\n\treturn a>b?a:b;\n}\ninline void dfs(int u,int fa){//\u540e\u5e8f\u6392\u5217+\u6811\u5f62DP\u3002\n\tfor(register int i=head[u];i;i=e[i].next){\n\t\tint v=e[i].v;\n\t\tif(v==fa) goto bck;//\u76f8\u5f53\u4e8econtinue\uff0c\u4f46\u6bd4\u5b83\u5feb\u3002\n\t\tdfs(v,u);\n\t\tfor(register int j=m;j>=0;--j){\n\t\t\tfor(register int k=m;k>=0;--k){\n\t\t\t\tif(k+j<m-1){\n\t\t\t\t\tdp[u][j+k+2][0]=Max(dp[u][j+k+2][0],dp[u][j][0]+dp[v][k][1]);\n\t\t\t\t\tdp[u][j+k+2][1]=Max(dp[u][j+k+2][1],dp[u][j][1]+dp[v][k][1]);\n\t\t\t\t}\n\t\t\t\tif(k+j<m)dp[u][j+k+1][0]=Max(dp[u][j+k+1][0],dp[u][j][1]+dp[v][k][0]);\n\t\t\t}\n\t\t}\n\t\tbck:;\n\t}\n\tfor(register int i=m;i>=1;--i){\n\t\tdp[u][i][0]=Max(dp[u][i][0],dp[u][i-1][0]+v[u]);\n\t\tdp[u][i][1]=Max(dp[u][i][1],dp[u][i-1][1]+v[u]);\n\t}\n}\nint main(){\n\tn=read();\n\tm=read();\n\tfor(register int i=1;i<=n;++i) v[i]=read();\n\tfor(register int i=1;i<n;++i){\n    \tint x,y;\n\t\tx=read();\n\t\ty=read();\n\t\tadd(x,y);\n\t\tadd(y,x);\n\t}\n\tdfs(1,0);\n\twrite(dp[1][m][0]);\n}\n```\n",
        "postTime": 1644551010,
        "uid": 660641,
        "name": "0zhouyq",
        "ccfLevel": 5,
        "title": "P5054 [COCI2017-2018#7] Dostavlja\u010d \u9898\u89e3"
    },
    {
        "content": "## \u7b80\u6d01\u9898\u610f\n\n\u5728 $m$ \u7684\u65f6\u95f4\u5185\u7684\u80fd\u8d70\u5230\u7684\u8282\u70b9\u7684\u6700\u5927\u4ef7\u503c\u3002\n\n## \u601d\u8def\n\n\u5f88\u660e\u663e\u662f\u4e00\u9053\u6811\u5f62 $dp$\u3002\n\n\u9996\u5148\u770b\u72b6\u6001\u5b9a\u4e49\u3002\u9700\u8981\u5347\u7ef4\u3002\n\n\u8bbe $dp_{1,i,j}$ \u8868\u793a\u4ece\u7b2c $i$ \u4e2a\u8282\u70b9\u6765\uff0c\u73b0\u5728\u5728\u7b2c $j$ \u4e2a\u8282\u70b9\uff0c\u5e76\u552e\u5356\uff1b$dp_{0,i,j}$ \u5c31\u662f\u4e0d\u552e\u5356\u3002\n\n\u7136\u540e\u63a8\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\u3002\n\n\u5f88\u660e\u663e\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u5206\u522b\u662f\u53bb\u5230\u4e86 $j$ \u8282\u70b9\u5e76\u4e0d\u56de\u6765\uff0c\u6216\u5230\u4e86 $j$ \u8282\u70b9\u5e76\u4e0d\u56de\u6765\n\n\u5219\u72b6\u6001\u8f6c\u79fb\u5f0f\u4e3a\uff1a\n\n$$dp_{0,u,x} = \\max(dp_{0,u,x},dp_{1,u,x - k} + dp_{0,v,k - 1})$$\n\n$$dp_{1,u,x} = \\max(dp_{1,u,x},dp_{1,u,x - k} + dp_{1,v,k - 2})$$\n\n$$dp_{0,u,x} = \\max(dp_{0,u,x},dp_{0,u,x - k} + dp_{1,v,k - 2})$$\n\n\u5176\u4e2d $u$ \u4e3a\u5f53\u524d\u8282\u70b9\uff0c$v$ \u4e3a\u4e0b\u4e00\u4e2a\u8282\u70b9\uff0c$k$ \u4e3a\u53bb\u7684\u65f6\u95f4\uff0c $x$ \u4e3a\u603b\u65f6\u95f4\n\n\u6700\u540e\u662f\u521d\u59cb\u503c\uff1a\u82e5\u6ca1\u5356\u6216\u5356\u90fd\u662f $a_u$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,m;\nint a[505];\nstruct node\n{\n\tint to,nxt;\n}e[1010];\nint tot = 0;\nint head[1010];\nint dp[3][1010][1010];\nvoid add_edge(int u,int v)\n{\n\te[++tot] = (node){v,head[u]};\n\thead[u] = tot;\n}\nvoid dfs(int u,int fa)\n{\n\tdp[0][u][1] = a[u];\n\tdp[1][u][1] = a[u];\n\tfor(int x = 2;x <= m;x++)\n\t{\n\t\tdp[1][u][x] = max(dp[1][u][x - 1],dp[1][u][x]);\n\t\tdp[0][u][x] = max(dp[0][u][x - 1],dp[0][u][x]);\n\t}\n\tfor(int i = head[u];i;i = e[i].nxt)\n\t{\n\t\tint v = e[i].to;\n\t\tif(v == fa)\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tdfs(v,u);\n\t\tfor(int x = m;x >= 1;x--)\n\t\t{\n\t\t\tfor(int k = 1;k <= x;k++)\n\t\t\t{\n\t\t\t\tdp[0][u][x] = max(dp[0][u][x],dp[1][u][x - k] + dp[0][v][k - 1]);\n\t\t\t\tif(k >= 2)\n\t\t\t\t{\n\t\t\t\t\tdp[1][u][x] = max(dp[1][u][x],dp[1][u][x - k] + dp[1][v][k - 2]);\n\t\t\t\t\tdp[0][u][x] = max(dp[0][u][x],dp[0][u][x - k] + dp[1][v][k - 2]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\nint main()\n{\n\tcin >> n >> m;\n\tfor(int i = 1;i <= n;i++)\n\t{\n\t\tcin >> a[i];\n\t}\n\tfor(int i = 1;i < n;i++)\n\t{\n\t\tint u,v;\n\t\tcin >> u >> v;\n\t\tadd_edge(u,v);\n\t\tadd_edge(v,u);\n\t}\n\tdfs(1,1);\n\tcout << max(dp[0][1][m],dp[1][1][m]) << '\\n';\n\treturn 0;\n}\n```\n",
        "postTime": 1676696063,
        "uid": 507374,
        "name": "feather_life",
        "ccfLevel": 0,
        "title": "P5054\u9898\u89e3"
    },
    {
        "content": "## \u9898\u610f\r\n\r\n\u7ed9\u4f60\u4e00\u68f5 $n$ \u4e2a\u70b9\u7684\u65e0\u5411\u6811\uff0c\u548c\u6bcf\u4e2a\u70b9\u7684\u6743\u503c $a_i$\uff0c\u521d\u59cb\u4f60\u5728 $1$ \u53f7\u8282\u70b9\uff0c\u6bcf\u6b21\u64cd\u4f5c\u53ef\u4ee5\u5728\u8fd9\u4e24\u79cd\u64cd\u4f5c\u4e2d\u9009\u4e00\u4e2a\uff1a\r\n\r\n- \u79fb\u52a8\u5230\u4e00\u4e2a\u76f8\u90bb\u8282\u70b9\uff1b\r\n\r\n- \u7559\u5728\u8fd9\u4e2a\u70b9\uff08\u8bb0\u4f5c $i$\uff09\uff0c\u5e76\u5bf9\u7b54\u6848\u505a\u51fa $a_i$ \u7684\u8d21\u732e\u3002\r\n\r\n\u6c42 $m$ \u6b21\u64cd\u4f5c\u540e\u6700\u591a\u505a\u51fa\u591a\u5c11\u8d21\u732e\u3002\r\n\r\n\u51b7\u77e5\u8bc6\uff1a\u9898\u9762\u7ffb\u8bd1\u6765\u81ea Google \u7ffb\u8bd1\u3002\r\n\r\n## \u9898\u89e3\r\n\r\n\u6570\u636e\u8303\u56f4\u63d0\u793a\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u7c7b\u80cc\u5305\u7684\u7b97\u6cd5\uff1a\u628a\u5df2\u64cd\u4f5c\u6b21\u6570\u8bb0\u4f5c DP \u72b6\u6001\u3002\r\n\r\n\u53c8\u8003\u8651\u5230\uff1a\u5047\u5982 $u$ \u6709\u4e24\u4e2a\u5b50\u6811 $B,C$\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u5728 $B$ \u91cc\u778e\u8dd1\u540e\u518d\u53bb $C$ \u778e\u8dd1\uff0c\u90a3\u4e48\u5fc5\u987b\u5728\u8dd1\u5b8c $B$ \u540e\u56de\u5230 $u$\uff0c\u7136\u540e\u4ece $u$ \u8dd1\u5230 $C$\u3002\r\n\r\n\u800c\u7279\u6b8a\u7684\u662f\u4f60\u53ef\u4ee5\u5728\u4efb\u610f\u8282\u70b9\u7ed3\u675f\uff0c\u5e76\u975e\u8d77\u70b9\u3002\r\n\r\n\u4e8e\u662f\u53ef\u4ee5\u8bbe\u8ba1 DP \u72b6\u6001\uff1a$f[i][j][k] (i\\in[1,n],j\\in[0,m],k\\in[0,1])$\u3002\r\n\r\n$f[i][j][1]$ \u8868\u793a\u5728 $j$ \u7684\u65f6\u95f4\u5185\uff0c\u5728 $i$ \u7684\u5b50\u6811\u5185\u778e\u8dd1\u540e\u56de\u5230\u4e86 $i$ \u8282\u70b9\u7684\u6700\u5927\u8d21\u732e\u3002\r\n\r\n$f[i][j][0]$ \u8868\u793a\u5728 $j$ \u7684\u65f6\u95f4\u5185\uff0c\u5728 $i$ \u7684\u5b50\u6811\u5185\u778e\u8dd1\u540e\u505c\u5728 $i$ \u5b50\u6811\u5185\u7684\u4efb\u610f\u8282\u70b9\u7684\u6700\u5927\u8d21\u732e\u3002\r\n\r\n\u679a\u4e3e $i$ \u7684\u5b50\u6811 $nx$\u3002\r\n\r\n$f[i][j][1]$ \u7684\u6700\u5927\u503c\u5c31\u662f\u5148\u4ece $i$ \u8dd1\u5230 $nx$\uff0c\u5728 $nx$ \u5b50\u6811\u5185\u778e\u8dd1\uff0c\u56de\u5230 $nx$\uff0c\u56de\u5230 $i$ \uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u6700\u5927\u8d21\u732e\u3002\r\n\r\n$$f[i][j + k + 2][1] = \\max\\{f[i][j][1] + f[nx][k][1]\\}$$\r\n\r\n$f[i][j][0]$ \u7684\u6700\u5927\u503c\u5c31\u662f\u5148\u4ece $i$ \u8dd1\u5230 $nx$\uff0c\u5728 $nx$ \u5b50\u6811\u5185\u778e\u8dd1\uff0c\u505c\u5728\u4efb\u610f\u8282\u70b9\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u6700\u5927\u8d21\u732e\u3002\r\n\r\n$$f[i][j + k + 1][0] = \\max\\{f[i][j][1] + f[nx][k][0]\\}$$\r\n\r\n\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\uff0c$f[i][j][0]$ \u5148\u4ece $i$ \u4efb\u610f\u5b50\u6811\u5185\u778e\u8dd1\uff0c\u56de\u5230 $i$\uff0c\u518d\u9009\u4efb\u610f\u5b50\u6811\u778e\u8dd1\u5e76\u505c\u5728\u4efb\u610f\u8282\u70b9\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u6700\u5927\u8d21\u732e\u3002\r\n\r\n$$f[i][j + k + 2][0] = \\max\\{f[nx][k][1] + f[i][j][0]\\}$$\r\n\r\n\u5176\u4e2d $k$ \u4e3a\u679a\u4e3e\u5b50\u6811\u91cc\u778e\u8dd1\u7684\u65f6\u95f4\u3002\r\n\r\n\u7b54\u6848\u663e\u7136\u4e3a $dp[1][m][0]$\u3002\r\n\r\n## Code\r\n\r\n```cpp\r\n#include <cstdio>\r\n#include <cstring>\r\n#include <iostream>\r\n\r\n#define N 510\r\n\r\nint dp[N][N][2];\r\nint a[N],n,m;\r\nint h[N],e[N << 1],ne[N << 1],idx;\r\n\r\nvoid add_edge(int x,int y)\r\n{\r\n\tne[++idx] = h[x];\r\n\th[x] = idx;\r\n\te[idx] = y;\r\n}\r\n\r\nvoid add(int x,int y)\r\n{\r\n\tadd_edge(x,y);\r\n\tadd_edge(y,x);\r\n}\r\n\r\nvoid dfs(int u,int fa)\r\n{\r\n\tfor(int p = h[u];~p;p = ne[p])\r\n\t{\r\n\t\tint nx = e[p];\r\n\t\tif(nx == fa)\r\n\t\t\tcontinue;\r\n\t\tdfs(nx,u);\r\n\t\tfor(int i = m;i >= 0;i--)\r\n\t\t{\r\n\t\t\tfor(int j = m;j >= 0;j--)\r\n\t\t\t{\r\n\t\t\t\tif(i + j + 2 <= m)\r\n\t\t\t\tdp[u][i + j + 2][1] = std::max(dp[u][i + j + 2][1],dp[u][i][1] + dp[nx][j][1]);\r\n\t\t\t\tif(i + j + 1 <= m)\r\n\t\t\t\tdp[u][i + j + 1][0] = std::max(dp[u][i + j + 1][0],dp[u][i][1] + dp[nx][j][0]);\r\n\t\t\t\tif(i + j + 2 <= m)\r\n\t\t\t\tdp[u][i + j + 2][0] = std::max(dp[u][i + j + 2][0],dp[nx][j][1] + dp[u][i][0]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfor(int i = m;i >= 1;i--)\r\n\t{\r\n\t\tdp[u][i][0] = std::max(dp[u][i][0],dp[u][i - 1][0] + a[u]);\r\n\t\tdp[u][i][1] = std::max(dp[u][i][1],dp[u][i - 1][1] + a[u]);\r\n\t}\r\n}\r\n\r\nint main()\r\n{\r\n\tmemset(h,-1,sizeof(h));\r\n\tscanf(\"%d%d\",&n,&m);\r\n\tfor(int i = 1;i <= n;i++)\r\n\t\tscanf(\"%d\",&a[i]);\r\n\tfor(int i = 1,x,y;i < n;i++)\r\n\t{\r\n\t\tscanf(\"%d%d\",&x,&y);\r\n\t\tadd(x,y);\r\n\t}\r\n\tdfs(1,0);\r\n\tprintf(\"%d\\n\",dp[1][m][0]);\r\n\treturn 0;\r\n}\r\n```",
        "postTime": 1663933228,
        "uid": 371968,
        "name": "ningago",
        "ccfLevel": 4,
        "title": "P5054 [COCI2017-2018#7] Dostavlja\u010d"
    }
]