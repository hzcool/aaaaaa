[
    {
        "content": "## \u80cc\u666f\n\nUpdate2022.2.22: \u7eaa\u5ff5\u6211\u7684\u9996\u7bc7\u9898\u89e3\uff0c\u867d\u7136\u6211\u5df2\u7ecf\u662f\u4e2a\u5931\u8d25\u8005\u4e86\uff0c\u4f46\u662f zcysky \u6210\u6211\u73ed\u52a9\u4e86\uff01\u6709\u7a7a\u66f4\u5f20 zcysky \u7167\u7247\uff08\u9003\n\n## \u601d\u8def\n\n### PART I\n\n\u9898\u610f\uff1a\u7ed9\u5b9a\u5e26\u6743\u7684\u6811\u6216\u57fa\u73af\u6811\uff0c\u4ece\u968f\u673a\u4e00\u70b9\u51fa\u53d1\u8d70**\u6bcf\u4e2a\u70b9\u81f3\u591a\u7ecf\u8fc7\u4e00\u6b21**\u7684\u8def\u5f84\uff0c\u95ee\u671f\u671b\u8def\u5f84\u957f\u5ea6\u3002\n\n$son_u$ \u8868\u793a $u$ \u7684\u5b50\u7ed3\u70b9\u6570\u91cf\uff1b$fa_u$ \u8868\u793a $u$ \u7684\u7236\u7ed3\u70b9\u6570\u91cf\uff0c\u53d6\u503c\u4e3a $1$ \u6216 $2$\uff08\u56e0\u4e3a\u6709\u73af\uff09\u3002\n\n$down_u$ \u8868\u793a\u4ece $u$ \u51fa\u53d1\uff0c\u7b2c\u4e00\u6b65\u5411\u4e0b\u8d70\u7684\u671f\u671b\u8def\u5f84\u957f\u5ea6\uff0c\u300c\u4e0b\u300d\u6307\u5b50\u7ed3\u70b9\u65b9\u5411\u5373\u53f6\u5b50\u65b9\u5411\uff1b\n\n$up_u$ \u8868\u793a\u4ece $u$ \u51fa\u53d1\uff0c\u7b2c\u4e00\u6b65\u5411\u4e0a\u8d70\u7684\u671f\u671b\u8def\u5f84\u957f\u5ea6\uff0c\u300c\u4e0a\u300d\u6307\u7236\u7ed3\u70b9\u65b9\u5411\u3002\n\n> \u6ce8\u610f\uff1a\u53ea\u89c4\u5b9a\u4e86\u7b2c\u4e00\u6b65\u5411\u4e0a\u8d70\uff0c\u7b2c\u4e8c\u6b65\u5141\u8bb8\u53bb $u$ \u7684\u7236\u4eb2 $k$ \u7684\u5176\u4ed6\u5b50\u7ed3\u70b9\u3002\n\n\u90a3\u4e48\u4ece $u$ \u51fa\u53d1\u7684\u671f\u671b\u8def\u5f84\u957f\u5ea6\u4e3a\uff1a\n\n$$\\large ans_u=\\dfrac{down_u\\cdot son_u+up_u\\cdot fa_u}{son_u+fa_u}$$\n\n### PART II\n\n\u5148\u8003\u8651 50pts \u7684\u666e\u901a\u6811\u505a\u6cd5\u3002\n\n$down_u$ \u663e\u7136\u53ea\u4e0d\u4f9d\u8d56\u4efb\u4f55\u7684 $up$ \u503c\uff1a\n\n$$\\large down_u=\\dfrac{1}{son_u}\\sum_{v\\text{ is son of }u}(down_v+w_{u,v})$$\n\n$v$ \u662f $u$ \u7684\u5b50\u7ed3\u70b9\uff0c$w_{u,v}$ \u8868\u793a\u8fb9\u6743\u3002\u7279\u522b\u7684\uff0c\u53f6\u5b50\u7ed3\u70b9 $down$ \u503c\u4e3a $0$\u3002\n\n\u5bf9\u4e8e\u666e\u901a\u6811\uff0c$u$ \u81f3\u591a\u6709\u4e00\u4e2a\u7236\u7ed3\u70b9 $k$\uff0c\u800c $up_u$ \u662f\u8981\u4f9d\u8d56 $up_k,down_k$ \u7684\uff1a\n\n$$\\large up_u=w_{u,k}+\\dfrac{up_k\\cdot fa_k+down_k\\cdot son_k-down_u-w_{u,k}}{fa_k+son_k-1}$$\n\n\u89e3\u91ca\u5982\u4e0b\uff1a\n\n\u4e0d\u8bba\u5982\u4f55\uff0c\u7b2c\u4e00\u6b65\u8d21\u732e $w_{u,k}$\u3002\n\n\u7c97\u7565\u5730\u770b\uff0c\u7ee7\u7eed\u5411\u4e0a\u8d70\u8d21\u732e $up_k\\cdot fa_k$\uff0c\u8f6c\u800c\u5411\u4e0b\u8d70\u8d21\u732e $down_k\\cdot son_k$\uff0c\u8003\u8651\u5230\u4e0d\u80fd\u8d70\u56de\u6765\uff0c\u6545\u5e94\u51cf\u53bb $down_u+w_{u,k}$\u3002\n\n\u7b2c\u4e8c\u6b65\u5411\u4e0a\u6709 $fa_k$ \u79cd\u9009\u62e9\uff0c\u5411\u4e0b\u6709 $son_k-1$ \u79cd\u9009\u62e9\uff08\u4e0d\u5141\u8bb8\u56de\u6765\uff09\uff0c\u6545\u5206\u6bcd\u4e3a $fa_k+son_k-1$\u3002\n\n\u7279\u522b\u7684\uff0c\u82e5 $k$ \u4ec5\u4e0e $u$ \u76f8\u8fde\u5373 $fa_k+son_k-1=0$\uff0c\u5219 $up_u=w_{u,k}$\uff0c\u6ca1\u6709\u540e\u4e00\u9879\u3002\n\n\u5b9e\u73b0\u65f6\uff0c\u8ba1\u7b97 $up,down$ \u503c\uff0c\u7531\u4e8e\u524d\u8005\u4f9d\u8d56\u540e\u8005\uff0c\u800c\u540e\u8005\u4e0d\u4f9d\u8d56\u524d\u8005\uff0c\u6545\u6d41\u7a0b\u5982\u4e0b\uff1a\n\n1. \u4ece\u6839\u8282\u70b9\u5f00\u59cb\uff0c\u9012\u5f52\u6bcf\u4e2a\u5b50\u7ed3\u70b9\u8ba1\u7b97 $down$ \u503c\uff1b\n2. \u9012\u5f52\u81f3 $u$ \u65f6\uff0c\u5148\u9012\u5f52\u5b50\u7ed3\u70b9\uff0c\u5f97\u5230\u6bcf\u4e2a $down_v$\uff0c\u7136\u540e\u8ba1\u7b97 $down_u$\uff0c\u8fd4\u56de\uff1b\n3. \u5f97\u5230\u8be5\u666e\u901a\u6811\u7684 $down$ \u503c\u540e\uff0c\u4ece\u6839\u8282\u70b9\u7684\u6bcf\u4e2a\u5b50\u7ed3\u70b9\u5f00\u59cb\uff0c\u9012\u5f52\u8ba1\u7b97 $up$ \u503c\uff1b\n4. \u9012\u5f52\u81f3 $u$ \u65f6\uff0c\u6839\u636e\u7236\u7ed3\u70b9 $k$ \u7684\u4fe1\u606f\u8ba1\u7b97 $up_u$\uff0c\u7136\u540e\u9012\u5f52\u5b50\u7ed3\u70b9\u8ba1\u7b97\uff0c\u8fd4\u56de\uff1b\n5. \u6839\u636e $up_i,down_i$ \u8ba1\u7b97 $ans_i$\uff0c\u6700\u7ec8\u7ed3\u679c\u4e3a $\\displaystyle\\dfrac{1}{n}\\sum_{i=1}^nans_i$\u3002\n\n### PART III\n\n\u518d\u6765\u8003\u8651\u57fa\u73af\u6811\u7684\u60c5\u51b5\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/1vtxcxat.png)\n\n> \u5982\u56fe\u6240\u793a\u662f\u4e00\u68f5\u5e76\u4e0d\u4f18\u7f8e\u7684\u57fa\u73af\u6811\uff0c\u7bad\u5934\u6307\u5411\u7236\u7ed3\u70b9\uff08$1$ \u6216 $2$ \u4e2a\uff09\uff0c\u52a0\u7c97\u7ed3\u70b9\u662f\u73af\u4e0a\u7ed3\u70b9\uff0c\u4ee5\u4e0b\u7b80\u79f0\u300c\u9ed1\u70b9\u300d\uff0c\u5176\u4f59\u7ed3\u70b9\u7b80\u79f0\u300c\u767d\u70b9\u300d\u3002\n\n\u6211\u4eec\u5c06\u57fa\u73af\u6811\u770b\u505a**\u82e5\u5e72\u666e\u901a\u6811\u6839\u8282\u70b9\u76f8\u8fde\u6210\u73af**\u7684\u7ed3\u679c\u3002\n\n\u6ce8\u610f\u5230\u65e0\u8bba\u4ece\u54ea\u4e00\u70b9\u51fa\u53d1\uff0c\u7b2c\u4e00\u6b65\u5411\u4e0b\uff0c\u6d3b\u52a8\u8303\u56f4\u59cb\u7ec8\u5728\u666e\u901a\u6811\u5185\u90e8\uff0c\u5373\uff1a\u65e0\u8bba\u9ed1\u767d\uff0c$down$ \u503c\u4e0d\u53d8\u3002\n\n\u82e5 $u$ \u662f\u767d\u70b9\uff0c\u53ea\u6709\u552f\u4e00\u7236\u4eb2 $k$\uff0c\u5c3d\u7ba1\u6b64\u65f6 $fa_k$ \u4e0d\u4e00\u5b9a\u4e3a $1$\uff08\u767d\u70b9 $u$ \u7684\u7236\u4eb2 $k$ \u662f\u9ed1\u70b9\u65f6 $fa_k=2$\uff09\uff0c\u4f46\u663e\u7136\u8003\u8651\u63a8\u5bfc\u8fc7\u7a0b\uff0c$up_u$ \u4ecd\u7b26\u5408\u4e0a\u6587\u7684\u516c\u5f0f\u3002\n\n\u82e5 $u$ \u662f\u9ed1\u70b9\uff0c\u5219 $up_u$ \u7684\u8ba1\u7b97\u663e\u5f97\u548c\u7e41\u7410\u3002\n\n> $u$ \u7b2c\u4e00\u6b65\u53bb\u4e86\u53e6\u4e00\u4e2a\u9ed1\u70b9\uff0c\u7b2c\u4e8c\u6b65\u53ef\u4ee5\u9009\u62e9\u7ee7\u7eed\u5728\u73af\u4e0a\u8d70\uff0c\u8fd8\u53ef\u4ee5\u9009\u62e9\u94bb\u5165\u8be5\u9ed1\u70b9\u7684\u5b50\u6811\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u5904\u7406\uff0c\u6211\u4eec\u5148\u901a\u8fc7\u6df1\u641c\u5f97\u5230\uff1a\n\n- \u9ed1\u70b9\u603b\u6570 $t$\uff1b\n- $\\text{dfn[u]}$\uff0c\u7ef4\u62a4 $u$ \u662f\u641c\u5230\u7684\u7b2c\u51e0\u4e2a\u9ed1\u70b9\uff1b\n- $\\text{path[i]}$\uff0c\u7ef4\u62a4\u7b2c $i(1\\leqslant i\\leqslant t)$ \u4e2a\u9ed1\u70b9\u7684\u5b9e\u9645\u7f16\u53f7 $u(1\\leqslant u\\leqslant n)$\uff1b\n- $\\text{disl[i],disr[i]}$\uff0c\u7c7b\u4f3c\u4e8e\u94fe\u8868\u7684\u610f\u5473\uff0c\u7ef4\u62a4\u7b2c $i$ \u4e2a\u9ed1\u70b9\u4e0e\u5de6\u53f3\u76f8\u90bb\u9ed1\u70b9\u7684\u8ddd\u79bb\u3002\n\n\u5bf9\u4e8e\u9ed1\u70b9 $u$\uff0c\u5148\u89c4\u5b9a\u7b2c\u4e00\u6b65\u5fc5\u987b\u9006\u65f6\u9488\u8d70\uff0c\u5219\u6709\uff1a\n\n$$\\large up_u=\\sum_{i}P_i\\times \\left(\\dfrac{down_{\\text{path[i]}}\\cdot son_{\\text{path[i]}}}{son_{\\text{path[i]}}+1}+w\\right)$$\n\n\u5176\u4e2d\uff0c$i$ \u4f9d\u6b21\u53d6 $\\text{dfn[u]}+1,\\text{dfn[u]}+2,\\text{dfn[u]}+3,\\ldots,t,1,2,3,\\ldots\\text{dfn[u]}-1$\u3002\n\n> \u55ef\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u6709\u5931\u6570\u5b66\u7f8e\u611f\uff0c\u4f46\u4e25\u8c28\u7684\u8bb2\uff0c\u7684\u786e\u662f\u8fd9\u4e2a\u6837\u5b50\u3002\u4e0d\u8981\u7d27\uff0c\u6211\u4eec\u6765\u770b\u770b\u8fd9\u662f\u4ec0\u4e48\u610f\u601d\u3002\n\n\u6839\u636e\u671f\u671b\u7684\u5b9a\u4e49\uff0c\u671f\u671b\u7b49\u4e8e**\u6267\u884c\u7b2c $k$ \u6b65\u7684\u6982\u7387\u4e0e\u7b2c $k$ \u6b65\u5e26\u6765\u7684\u8d21\u732e\u7684\u4e58\u79ef**\u7684\u7d2f\u52a0\u548c\u3002\n\n\u5148\u6765\u770b\u6982\u7387\uff0c$P_i$ \u8868\u793a\u8d70\u5230\u8be5\u70b9\u7684\u6982\u7387\uff0c\u89c4\u5b9a\u4e86\u7b2c\u4e00\u6b65\u9006\u65f6\u9488\uff0c\u5373 $P_{\\text{dfn[u]}+1}=1$\u3002\n\n\u7b2c $i$ \u4e2a\u9ed1\u70b9\u7684\u4e0b\u4e00\u4e2a\u9ed1\u70b9\u662f $i\\bmod t+1$\uff0c\u9700\u8981\u5728\u7b2c $i$ \u4e2a\u9ed1\u70b9\u7684 $son_{\\text{path[i]}}$ \u4e2a\u5b50\u7ed3\u70b9\u548c\u4e0b\u4e00\u4e2a\u9ed1\u70b9\u4e4b\u4e2d\u9009\u62e9\u4e0b\u4e00\u6b65\u53bb\u54ea\u91cc\uff0c\u90a3\u4e48 $P_{i\\bmod t+1}=\\dfrac{1}{son_{\\text{path[i]}}+1}P_i$\u3002\n\n\u518d\u6765\u770b\u4ece\u987a\u65f6\u9488\u65b9\u5411\u7684\u4e0a\u4e00\u4e2a\u9ed1\u70b9\u8d70\u5230\u7b2c $i$ \u4e2a\u9ed1\u70b9\u7684\u8d21\u732e\uff0c\u9996\u5148\u6709\u8fb9\u6743 $w$\uff0c\u5373 $\\text{disl[i]}$\u3002\n\n\u5176\u6b21\uff0c\u6211\u4eec\u9700\u8981\u8003\u8651\u5982\u679c\u4ece\u6b64\u94bb\u5165\u7b2c $i$ \u4e2a\u9ed1\u70b9\u7684\u5b50\u6811\u4ea7\u751f\u7684\u8d21\u732e\uff0c\u5373 $\\dfrac{down_{\\text{path[i]}}\\cdot son_{\\text{path[i]}}}{son_{\\text{path[i]}}+1}$\u3002\n\n\u7279\u522b\u7684\uff0c\u5982\u679c\u7b2c $i$ \u4e2a\u9ed1\u70b9\u9006\u65f6\u9488\u65b9\u5411\u7684\u4e0b\u4e00\u4e2a\u9ed1\u70b9\u5c31\u662f  $u$ \u7684\u8bdd\uff0c\u53ea\u80fd\u9009\u62e9\u94bb\u5165\u5b50\u6811\u800c\u4e0d\u80fd\u7ee7\u7eed\u8d70\u91cd\u590d\u7684\uff0c\u90a3\u4e48\u5206\u6bcd\u5c31\u5e94\u8be5\u4e3a $son_{\\text{path[i]}}$ \u5373\u94bb\u5165\u8be5\u5b50\u6811\u7684\u8d21\u732e\u76f4\u63a5\u5c31\u662f  $down_{\\text{path[i]}}$\u3002\n\n\u521a\u521a\u89c4\u5b9a\u4e86\u7b2c\u4e00\u6b65\u5fc5\u987b\u9006\u65f6\u9488\u8d70\uff0c\u73b0\u5728\u518d\u89c4\u5b9a\u7b2c\u4e00\u6b65\u5fc5\u987b\u987a\u65f6\u9488\u6c42\u4e00\u904d\uff0c\u6700\u7ec8\u7ed9 $up$ \u503c\u9664\u4ee5 $2$ \u5373\u53ef\u3002\n\n> \u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u5728\u4e00\u5f00\u59cb\u5c31\u4ee4 $P=\\dfrac{1}{2}$\uff0c\u4ee3\u7801\u4e2d\u4e5f\u662f\u8fd9\u6837\u5b9e\u73b0\u7684\u3002\n\n\u8fd9\u5f88\u597d\u7406\u89e3\uff0c\u7531\u4e8e\u8def\u5f84\u4e0d\u91cd\u590d\uff0c\u6240\u4ee5\u4e0d\u53ef\u80fd\u987a\u9006\u65f6\u9488\u4ea4\u66ff\uff0c\u987a\u9006\u5404\u6c42\u4e00\u904d\u4e00\u5b9a\u5305\u542b\u4e86\u6240\u6709\u60c5\u51b5\uff0c\u53ea\u4e0d\u8fc7\u6bcf\u4e2a\u6982\u7387\u90fd\u653e\u5927\u4e86 $2$ \u500d\uff0c\u73b0\u5728\u9664\u4ee5 $2$ \u5373\u53ef\u3002\n\n\u7406\u6e05\u903b\u8f91\u5173\u7cfb\uff0c\u6240\u6709 $down$ \u503c\u53ea\u4f9d\u8d56\u5176\u5b50\u7ed3\u70b9\u7684 $down$ \u503c\uff0c\u9ed1\u70b9\u7684 $up$ \u503c\u4f9d\u8d56 $down$ \u503c\uff0c\u767d\u70b9\u7684 $up$ \u503c\u4f9d\u8d56\u9ed1\u70b9\u7684 $up$ \u503c\u548c $down$ \u503c\uff0c\u6545\u6d41\u7a0b\u5982\u4e0b\uff1a\n\n1. \u4ece\u6bcf\u4e2a\u9ed1\u70b9\u5373\u6bcf\u4e2a\u666e\u901a\u6811\u7684\u6839\u8282\u70b9\u5f00\u59cb\uff0c\u9012\u5f52\u6bcf\u4e2a\u5b50\u7ed3\u70b9\u8ba1\u7b97 $down$ \u503c\uff0c\u65b9\u6cd5\u540c\u666e\u901a\u6811\uff1b\n2. \u8ba1\u7b97\u6bcf\u4e2a\u9ed1\u70b9\u7684 $up$ \u503c\uff0c\u987a\u9006\u65f6\u9488\u5404\u6c42\u4e00\u904d\uff0c\u7136\u540e\u9664\u4ee5 $2$\uff0c\u5982\u4e0a\u6587\u6240\u793a\uff1b\n3. \u4ece\u6bcf\u4e2a\u9ed1\u70b9\u7684\u6bcf\u4e2a\u5b50\u7ed3\u70b9\u5f00\u59cb\uff0c\u9012\u5f52\u8ba1\u7b97\u767d\u70b9\u7684 $up$ \u503c\uff0c\u65b9\u6cd5\u540c\u666e\u901a\u6811\uff1b\n4. \u6839\u636e $up_i,down_i$ \u8ba1\u7b97 $ans_i$\uff0c\u6700\u7ec8\u7ed3\u679c\u4e3a $\\displaystyle\\dfrac{1}{n}\\sum_{i=1}^nans_i$\u3002\n\n## \u4ee3\u7801\n\n> \u5e26\u7a7a\u683c\u6709\u6ce8\u91ca\uff0c\u795e\u7287\u8bf7\u81ea\u884c\u8df3\u8fc7\u3002\n\n\u5b9e\u9645\u4e0a\uff0c $\\varnothing$ \u662f\u4e00\u4e2a\u84bb\u4e0d\u7981\u98ce\u7684\u88ab\u5168\u673a\u623f\u540a\u7740\u6253\u7684\u840c\u65b0\uff0c\u5979\u7684\u4ee3\u7801\u7cdf\u7cd5\u900f\u4e86\uff0c\u7279\u522b\u662f\u5145\u5b9e\u611f\u7d27\u51d1\u7f8e\u7ed9\u4eba\u5e26\u6765\u7684\u89c6\u89c9\u9707\u64bc\u7a0b\u5ea6\u90fd\u6bd4  CK6100LGEV2 \u4e0d\u77e5\u9053\u5dee\u5230\u54ea\u91cc\u53bb\u4e86\uff0c\u5979\u7528\u4e86\u6574\u6574 100 \u884c\uff0c\u800c CK6100LGEV2 \u53ea\u7528\u4e86 60 \u884c\uff08\u9003\uff09\u3002\n\n```cpp\n#include <cstdio>\nconst int maxn = 100005;\nint n, m, fa[maxn], son[maxn];\ndouble up[maxn], down[maxn], ans;\nstruct Edge {\n\tint to, next, w;\n\tEdge() {}\n\tEdge(int to, int next, int w): to(to), next(next), w(w) {}\n} e[maxn<<1];\nint head[maxn], cnt;\nvoid add(int u, int v, int w) {\n\te[++cnt] = Edge(v, head[u], w);\n\thead[u] = cnt;\n}\n#define v e[i].to\nint pos;\nbool vis[maxn], flag;//\u662f\u5426\u5728\u73af\u4e0a\nvoid dfs1(int u, int k) {\n\tvis[u] = true;\n\tfor(int i = head[u]; i; i = e[i].next)\n\t\tif(v != k) {\n\t\t\tif(vis[v]) { pos = v; return; }\n\t\t\tdfs1(v, u);\n\t\t\tif(!flag and pos) { if(pos == u) flag = true; return; }\n\t\t\tif(flag) break;\n\t\t}\n\tvis[u] = false;\n}//\u5c06\u6240\u6709\u73af\u4e0a\u7ed3\u70b9\u7684 vis \u6807\u8bb0\u4e3a true\nint t, disl[22], disr[22], dfn[maxn], path[22];\nvoid dfs2(int u, int k) {\n\tdfn[u] = ++t, path[t] = u;\n\tfa[u] = 2;\n\tfor(int i = head[u]; i; i = e[i].next)\n\t\tif(v != k and vis[v]) {\n\t\t\tif(!dfn[v]) dfs2(v, u);\n\t\t\tdisr[dfn[u]] = disl[dfn[v]] = e[i].w;\n\t\t\tbreak;\n\t\t}\n}//\u5904\u7406\u73af\u4e0a\u4fe1\u606f\nvoid dp_down(int u, int k) {\n\tfor(int i = head[u]; i; i = e[i].next)\n\t\tif(v != k and !vis[v]) {\n\t\t\tfa[v] = 1;\n\t\t\tdp_down(v, u);\n\t\t\tson[u]++;\n\t\t\tdown[u] += down[v] + e[i].w;\n\t\t}\n\tif(son[u]) down[u] /= son[u];\n}\nvoid dp_up(int u, int k, int w) {\n\tup[u] = w;\n\tif(fa[k] + son[k] - 1)\n\t\tup[u] += (up[k]*fa[k]+down[k]*son[k]-down[u]-w) / (fa[k]+son[k]-1);\n\tfor(int i = head[u]; i; i = e[i].next)\n\t\tif(v != k) dp_up(v, u, e[i].w);\n}\nvoid work1() {\n\tdp_down(1, 0);\n\tfor(int i = head[1]; i; i = e[i].next)\n\t\tdp_up(v, 1, e[i].w);\n}\ndouble P;\n#define nxt(x) (x==t?1:x+1)\n#define pre(x) (x==1?t:x-1)\nvoid work2() {\n\tdfs1(1, 0);\n\tdfs2(pos, 0);\n\tfor(int i = 1; i <= t; ++i)\n\t\tdp_down(path[i], 0);\n\tfor(int i = 1, x; i <= t; ++i) {\n\t\tx = path[i];\n\t\tP = 0.5;\n\t\tfor(int j = nxt(i), y; j != i; j = nxt(j)) {\n\t\t\ty = path[j];\n\t\t\tif(nxt(j) == i) up[x] += P * (disl[j]+down[y]);\n\t\t\telse up[x] += P * (down[y]*son[y]/(son[y]+1)+disl[j]);\n\t\t\tP /= (son[y]+1);\n\t\t}\n\t\tP = 0.5;\n\t\tfor(int j = pre(i), y; j != i; j = pre(j)) {\n\t\t\ty = path[j];\n\t\t\tif(pre(j) == i) up[x] += P * (disr[j]+down[y]);\n\t\t\telse up[x] += P * (down[y]*son[y]/(son[y]+1)+disr[j]);\n\t\t\tP /= (son[y]+1);\n\t\t}\n\t\tfor(int j = head[x]; j; j = e[j].next)\n\t\t\tif(!vis[e[j].to]) dp_up(e[j].to, x, e[j].w);\n\t}\n}\n#undef v\nint main() {\n\tscanf(\"%d %d\", &n, &m);\n\tfor(int i = 1, u, v, w; i <= m; ++i)\n\t\tscanf(\"%d %d %d\", &u, &v, &w), add(u, v, w), add(v, u, w);\n\tif(n != m) work1();//\u666e\u901a\u6811\n\telse work2();//\u57fa\u73af\u6811\n\tfor(int i = 1; i <= n; ++i)\n\t\tans += (down[i]*son[i]+up[i]*fa[i]) / (son[i]+fa[i]);\n\tprintf(\"%.5lf\\n\", ans / n);\n}\n```",
        "postTime": 1549103094,
        "uid": 135658,
        "name": "emptysetvvvv",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2081 \u3010[NOI2012]\u8ff7\u5931\u6e38\u4e50\u56ed\u3011"
    },
    {
        "content": "\u9898\u89e3\uff1a\u8003\u8651\u53ea\u6709\u4e00\u68f5\u6811\uff0c\u90a3\u4e48down[x]\u548cup[x]\u5206\u522b\u8868\u793a\u5411\u4e0a\u8d70\u548c\u5411\u4e0b\u8d70\u7684\u671f\u671b\uff0c\u7136\u540e\u5148dfs\u4e00\u904d\u6c42down\uff0cdown[i]=sigma(down[j]+len[i][j])/du[i](j\u662fi\u7684\u513f\u5b50)\uff0c\u4e5f\u5c31\u662f\u671f\u671b\u52a0\u8d77\u6765\u518d\u52a0\u4e0a\u8fb9\u7684\u957f\u5ea6\u518d\u9664\u4ee5\u603b\u60c5\u51b5\u6570\u3002\n\n\u7136\u540e\u518d\u6c42up[x]\u3002up[x]=len[fa[x]][x]+(up[fa[x]]+down[fa[x]]*du[fa[x]]-down[x]-len[fa[x]][x])/du[fa[x]]\u3002\u9996\u5148\u6211\u4eec\u8981\u8d70x\u5230\u7236\u4eb2\u7684\u4e00\u6bb5\uff0c\u7136\u540e\u518d\u52a0\u4e0a\u7236\u4eb2\u7684up+\u7236\u4eb2\u7684down*\u7236\u4eb2\u7684\u5ea6\u6570\uff0c\u4f46\u662f\u8fd9\u6837\u4f1a\u628ax\u5b50\u6811\u7b97\u4e0a\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u51cf\u53bbdown[x]\u548clen[fa[x]][x]\uff0c\u6700\u540e\u8fd9\u4e2a\u6574\u4f53\u518d\u9664\u4ee5\u603b\u6570\uff08\u4e5f\u5c31\u662f\u4e58\u6982\u7387\uff09\uff0c\u5c31\u662fup[x]\u3002\n\n\u90a3\u4e48\u6700\u540e\u6240\u6709\u8282\u70b9\u7684ans\u9664\u4ee5\u81ea\u5df1\u7684\u5ea6\u6570\uff08\u4e5f\u5c31\u662f\u4e58\u6982\u7387\uff09\uff0c\u518d\u5168\u90e8\u52a0\u8d77\u6765\u9664\u4ee5n\uff0c\u5c31\u662f\u6700\u540e\u7684\u7b54\u6848\u4e86\u3002\n\n\u4f46\u662f\u6211\u4eec\u6709\u4e00\u4e2a\u73af\u8be5\u600e\u4e48\u529e\u5462\u3002\n\n\u9996\u5148\u8fd9\u4e2a\u73af\u5bfc\u81f4\u6811\u53d8\u6210\u4e86len(\u73af)\u4e2a\u5c0f\u6811+\u4e00\u4e2a\u5927\u73af\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5bf9\u6240\u6709\u5c0f\u6811\u6c42down\uff0cup\u5c31\u6bd4\u8f83\u9ebb\u70e6\u4e86\uff0c\u6211\u4eec\u5148\u5bf9\u73af\u6c42\u51fa\u6765g\u6570\u7ec4\uff0c\u8868\u793a\u4ece\u8fd9\u4e2a\u70b9\u5f00\u59cb\u8d70\u7684\u671f\u671b\uff0c\u56e0\u4e3a\u73af\u7684\u5927\u5c0f\u5f88\u5c0f\uff0c\u6240\u4ee5\u6211\u4eec\u679a\u4e3ert\uff0c\u7136\u540e\u76f4\u63a5dp\u4e00\u904d\uff0cg[i]=(g[to[x]]+len[to[x]][x])/(du[x]+1)\uff0c\u7b97\u5b8c\u4e4b\u540e\uff0c\u6211\u4eec\u518d\u628adown\u8ba1\u5165\u5230\u8d21\u732e\u4e2d\uff0c\u76f4\u63a5\u52a0\u6743\u5373\u53ef\uff0c\u4f46\u662f\u8981\u6ce8\u610f\u5ea6\u6570\u4e3a0\u7684\u60c5\u51b5\uff0c\u8981\u5f3a\u5236\u7f6e1\u3002\u5982\u679c\u4e0b\u4e00\u6b65\u5c31\u8d70\u5230\u4e86rt\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u4e0d\u8981\u628ag\u8ba1\u7b97\u5230\u8d21\u732e\u4e2d\uff0c\u56e0\u4e3a\u6211\u4eec\u94a6\u5b9a\u4e86rt\uff0c\u4e0d\u80fd\u51fa\u73b0\u8d70\u56de\u53bb\u7684\u60c5\u51b5\uff1b\u5982\u679c\u5f53\u524d\u70b9\u5c31\u662frt\uff0c\u90a3\u4e48\u4e0d\u8981\u8ba1\u7b97down\u7684\u8d21\u732e\u76f4\u63a5return\uff0c\u56e0\u4e3a\u73b0\u5728\u6211\u4eec\u76f4\u63a5\u5c31\u94a6\u5b9a\u4e86up\u662f\u5f80rt\u8d70\u7684\u3002\n\n\u7b97\u5b8cg\u548cdown\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e4b\u540e\uff0c\u6211\u4eec\u628a\u73af\u4e0a\u6240\u6709\u7684du\u90fd+=2\uff0c\u56e0\u4e3a\u73af\u4e0a\u6709\u4e24\u4e2a\u51fa\u8fb9\uff08\u524d\u9762\u4e0d\u52a0\u662f\u56e0\u4e3a\u8ba1\u7b97\u7684\u662fdown\u7684\u8d21\u732e\uff0c\u800cg\u4e0d\u9700\u8981\u5ea6\u6570\u6765\u8ba1\u7b97\uff09\uff0c\u7136\u540e\u6211\u4eec\u679a\u4e3e\u73af\u4e0a\u6bcf\u4e2a\u70b9\uff0c\u8fdb\u884cup\u7684\u8ba1\u7b97\u3002\n\n\u5177\u4f53\u770b\u4ee3\u7801\u5427\u3002\n\n\u81ea\u5e26\u5927\u5e38\u6570\uff08\u9003\n```cpp\n#include <bits/stdc++.h>  \nusing namespace std;  \nstruct nod{int to;double len;};  \nvector<nod>e[100005];  \nint x,y,z,n,m,xi,yi,wi,cir[100005],vis[100005],fa[100005],du[100005],rt,tim;  \ndouble f[100005],d[100005],tp[100005],g[100005],ans;  \nvoid dfs1(int x)  \n{  \n    vis[x]=1;  \n    for(int i=0;i<e[x].size();i++)  \n        if(!vis[e[x][i].to]&&!cir[e[x][i].to])  \n            dfs1(e[x][i].to),du[x]++,d[x]+=f[e[x][i].to]+e[x][i].len;  \n    if(du[x]) f[x]=d[x]/(double)du[x];  \n    if(x!=rt) du[x]++;  \n}  \nvoid dfs2(int x)  \n{  \n    vis[x]=1;  \n    for(int i=0;i<e[x].size();i++)  \n        if(!vis[e[x][i].to]&&!cir[e[x][i].to])  \n            d[e[x][i].to]+=(d[x]-f[e[x][i].to]-e[x][i].len)/max(1,du[x]-1)+e[x][i].len,dfs2(e[x][i].to);  \n}  \nvoid dfs3(int x)  \n{  \n    vis[x]=++tim;  \n    for(int i=0,j;i<e[x].size();i++)  \n        if(e[x][i].to!=fa[x])  \n        {  \n            if(!vis[e[x][i].to]) fa[e[x][i].to]=x,dfs3(e[x][i].to);  \n            else if(vis[e[x][i].to]<vis[x]) for(cir[e[x][i].to]=1,j=x;j!=e[x][i].to;j=fa[j]) cir[j]=1;  \n        }  \n}  \nvoid dfs4(int x,int fa)  \n{  \n    bool flag=0;g[x]=0;  \n    for(int i=0;i<e[x].size();i++)  \n        if(e[x][i].to!=rt&&e[x][i].to!=fa&&cir[e[x][i].to])  \n            flag=1,dfs4(e[x][i].to,x),g[x]+=g[e[x][i].to]+e[x][i].len;  \n    if(x==rt) return;  \n    int k=du[x];k?k:k++;  \n    if(!flag) g[x]=d[x]/(double)k;  \n    else k=du[x]+1,g[x]=(g[x]+d[x])/(double)k;  \n}  \nint main()  \n{  \n    scanf(\"%d%d\",&n,&m);  \n    for(int i=1;i<=m;i++) scanf(\"%d%d%d\",&x,&y,&z),e[x].push_back((nod){y,z}),e[y].push_back((nod){x,z});  \n    if(m==n-1) rt=1,dfs1(1),memset(vis,0,sizeof vis),dfs2(1);  \n    else  \n    {  \n        dfs3(1);memset(vis,0,sizeof vis);  \n        for(int i=1;i<=n;i++) if(cir[i]) rt=i,dfs1(i);  \n        for(int i=1;i<=n;i++) if(cir[i]) rt=i,dfs4(i,0),tp[i]=g[i];  \n        memset(vis,0,sizeof(vis));  \n        for(int i=1;i<=n;i++) if(cir[i]) du[i]+=2,d[i]+=tp[i];  \n        for(int i=1;i<=n;i++) if(cir[i]) rt=i,dfs2(i);  \n    }  \n    for(int i=1;i<=n;i++) ans+=d[i]/(double)du[i];  \n    printf(\"%.5lf\\n\",ans/(double)n);  \n}\n```",
        "postTime": 1527238700,
        "uid": 70545,
        "name": "Awar3ness",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2081 \u3010[NOI2012]\u8ff7\u5931\u6e38\u4e50\u56ed\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u7ed9\u4e00\u68f5\u6811\u6216\u8005\u57fa\u73af\u6811\uff0c\u968f\u673a\u9009\u4e00\u6761\u8def\u5f84\uff0c\u6c42\u8def\u5f84\u671f\u671b\u957f\u5ea6\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a\u70b9$i$\u6c42\u51fa\u4ece$i$\u51fa\u53d1\u7684\u8def\u5f84\u671f\u671b\u957f\u5ea6$ans_i$\uff0c\u90a3\u4e48\u6700\u7ec8\u7b54\u6848\u662f$\\frac{1}{n}\\sum\\limits_{i=1}^n ans_i$\u3002\n\n\u9996\u5148\u8003\u8651\u6811\u7684\u60c5\u51b5\u3002\u5728\u6811\u4e0a\uff0c\u4ece\u4e00\u4e2a\u70b9\u51fa\u53d1\u7684\u8def\u5f84\u53ef\u4ee5\u5927\u81f4\u5206\u4e3a\u4e24\u79cd\uff1a\u5411\u4e0a\u8d70\u548c\u5411\u4e0b\u8d70\u3002\u8bbe$f[x]$\u8868\u793a\u4ece$x$\u51fa\u53d1\u5f80\u4e0b\u8d70\u7684\u8def\u5f84\u671f\u671b\u957f\u5ea6\uff0c$g[x]$\u8868\u793a\u5f80\u4e0a\u8d70\u7684\u671f\u671b\u957f\u5ea6\uff0c\u540c\u65f6\u8bb0$son[x]$\u8868\u793a$x$\u7684\u513f\u5b50\u6570\u91cf\uff0c\u663e\u7136\u6709\u8f6c\u79fb\n\n$f[x]=\\frac{1}{son[x]}\\sum(f[v]+w(x,v))$\uff0c\u5176\u4e2d$v$\u662f$x$\u7684\u5b69\u5b50\n\n$g[v]=w(x,v)+(g[x]+f[x]\\times son[x]-f[v]-w(x,v))/(son[x]-[x==root])$\uff0c\u5176\u4e2d$x$\u662f$v$\u7684\u7236\u4eb2\n\n\u7b80\u5355\u89e3\u91ca\u4e00\u4e0b$g$\u7684\u8f6c\u79fb\uff1a\u5982\u679c\u8981\u4ece$v$\u5f80\u4e0a\u8d70\uff0c\u80af\u5b9a\u8981\u7ecf\u8fc7$(x,v)$\u8fd9\u6761\u8fb9\uff1b\u7136\u540e\u4ece$x$\u53ef\u80fd\u5f80\u4e0a\u8d70\u4e5f\u53ef\u80fd\u5f80\u4e0b\u8d70\uff0c\u5f80\u4e0a\u8d70\u5c31\u662f$g[x]$\uff0c\u5f80\u4e0b\u8d70\u5c31\u662f$f[x]\\times son[x]$\u4f46\u662f\u4e0d\u80fd\u8d70\u5230$v$\uff0c\u6240\u4ee5\u8981\u5c06$v$\u5bf9$f[x]\\times son[x]$\u4ea7\u751f\u7684\u8d21\u732e\u51cf\u53bb\uff0c\u56e0\u6b64\u51cf\u53bb$f[v]+w(x,v)$\uff1b\u5982\u679c$x$\u4e0d\u662f\u6839\u8282\u70b9\uff0c\u90a3\u4e48\u603b\u5171\u5c31\u6709$son[x]-1+1$\u79cd\u60c5\u51b5\uff0c\u4f46\u5982\u679c$x$\u662f\u6839\u8282\u70b9\u5c31\u53ea\u6709$son[x]-1$\u79cd\u60c5\u51b5\u3002\u53e6\u5916\u8fd8\u8981\u7279\u5224\uff1a\u5982\u679c$x$\u662f\u6839\u5e76\u4e14$son[x]==1$\uff0c\u5206\u6bcd\u4f1a\u4e3a$0$\uff0c\u8fd9\u65f6$g[v]=w(x,v)$\u3002\n\n\u4e8e\u662f$ans_i=(f[i]\\times son[i]+g[i])/(son[i]+[i\\neq root])$\u3002\n\n```cpp\nnamespace tree {\n    void dfs1(int x, int fa) {\n        for (int i = head[x]; i; i = next[i])\n            if (v[i] != fa) {\n                ++son[x];\n                dfs1(v[i], x);\n                f[x] += f[v[i]] + w[i];\n            }\n        if (son[x]) f[x] /= son[x];\n    }\n    void dfs2(int x, int fa) {\n        double tmp = g[x] + f[x] * son[x];\n        for (int i = head[x]; i; i = next[i])\n            if (v[i] != fa) {\n                if (x == 1) {\n                    if (son[x] == 1) g[v[i]] = w[i];\n                    else g[v[i]] = w[i] + (tmp - f[v[i]] - w[i]) / (son[x] - 1);\n                } else g[v[i]] = w[i] + (tmp - f[v[i]] - w[i]) / son[x];\n                dfs2(v[i], x);\n            }\n    }\n    inline void work() {\n        dfs1(1, 0);\n        dfs2(1, 0);\n        double ans = f[1];\n        for (int i = 2; i <= n; ++i)\n            ans += (f[i] * son[i] + g[i]) / (son[i] + 1);\n        ans /= n;\n        printf(\"%.5lf\\n\", ans);\n    }\n}\n```\n\n\u7136\u540e\u8003\u8651\u57fa\u73af\u6811\u7684\u505a\u6cd5\uff1a\u9996\u5148\u53ef\u4ee5\u628a\u73af\u627e\u51fa\u6765\uff0c\u7136\u540e\u628a\u56fe\u753b\u6210\u8fd9\u6837\uff1a\n\n![\u57fa\u73af\u6811](https://cdn.luogu.com.cn/upload/pic/50526.png)\n\n\u4f1a\u53d1\u73b0\u5176\u5b9e\u662f\u4e00\u4e2a\u73af\u52a0\u5468\u56f4\u5f88\u591a\u68f5\u5c0f\u6811\u3002\u6211\u4eec\u4f9d\u7136\u50cf\u521a\u624d\u6811\u7684\u505a\u6cd5\u4e2d\u90a3\u6837\u5b9a\u4e49$f[x]$\u548c$g[x]$\uff0c\u90a3\u4e48\u4e0d\u96be\u53d1\u73b0\u5176\u5b9e$f[x]$\u662f\u4e0d\u53d7\u5f71\u54cd\u7684\uff0c\u53ef\u4ee5\u5bf9\u6bcf\u68f5\u5c0f\u6811\u8dd1`dfs`\u5904\u7406\u51fa\u6765\u3002\u5173\u952e\u5728\u4e8e$g[x]$\uff1a\u5bf9\u4e8e\u4e0d\u5728\u73af\u4e0a\u7684\u7ed3\u70b9\uff0c$g[x]$\u5176\u5b9e\u4e5f\u4e0d\u53d7\u5f71\u54cd\uff0c\u4f46\u662f\u73af\u4e0a\u7684\u7ed3\u70b9\u7684$g[x]$\u9700\u8981\u7279\u522b\u5904\u7406\u3002\n\n\u8003\u8651\u5230\u73af\u4e0a\u7684\u7ed3\u70b9\u4e0d\u8d85\u8fc720\u4e2a\uff0c\u53ef\u4ee5\u5bf9\u6bcf\u4e2a\u8282\u70b9\u90fd\u8fd9\u6837\u505a\u4e00\u904d\uff1a\u4ece\u5b83\uff08\u8bb0\u4e3a$st$\uff0c\u8d77\u59cb\u70b9\uff09\u5f00\u59cb\u6cbf\u7740\u73af\u987a\u65f6\u9488\u8d70\u4e00\u5708\uff0c\u518d\u9006\u65f6\u9488\u8d70\u4e00\u5708\u3002\u8d70\u7684\u8fc7\u7a0b\u4e2d\u65e2\u53ef\u4ee5\u5f80\u73af\u4e0a\u8d70\uff0c\u4e5f\u53ef\u4ee5\u5f80\u6811\u4e0a\u8d70\uff0c\u4f46\u662f\u4e0d\u80fd\u8d70\u5df2\u7ecf\u8d70\u8fc7\u7684\u7ed3\u70b9\u3002\u8fd9\u91cc\u76f4\u63a5\u770b\u4e0b\u9762\u7684\u4ee3\u7801\u4f1a\u6bd4\u8f83\u6e05\u695a\u3002\n\n\u5904\u7406\u5b8c\u73af\u4e0a\u7ed3\u70b9\u7684$g$\u4e4b\u540e\u8dd1\u6811\u4e0a\u7684$g$\uff0c\u8fd9\u65f6\u8981\u6ce8\u610f\u73af\u4e0a\u7684\u7ed3\u70b9\u5411\u4e0a\u6709\u4e24\u6761\u8def\uff0c\u800c\u975e\u73af\u4e0a\u7684\u7ed3\u70b9\u5411\u4e0a\u53ea\u6709\u4e00\u6761\u8def\uff0c\u6240\u4ee5\u8f6c\u79fb\u65b9\u7a0b\u4e5f\u8981\u5fae\u8c03\u3002\n\n\u7136\u540e\u7edf\u8ba1\u7b54\u6848\u5c31\u884c\u4e86\u3002\n\n```cpp\nnamespace circle {\n    bool onc[maxn];\n    int pre[maxn], dfn[maxn], tim;\n    void find(int x) {\n        dfn[x] = ++tim;\n        for (int i = head[x]; i; i = next[i])\n            if (v[i] != pre[x]) {\n                if (!dfn[v[i]]) {\n                    pre[v[i]] = x;\n                    find(v[i]);\n                } else if (dfn[v[i]] < dfn[x]) {\n                    for (int j = x; j != v[i]; j = pre[j])\n                        onc[j] = 1;\n                    onc[v[i]] = 1;\n                    return;\n                }\n            }\n    }\n    void getf(int x, int fa) {\n        for (int i = head[x]; i; i = next[i])\n            if (v[i] != fa && !onc[v[i]]) {\n                ++son[x];\n                getf(v[i], x);\n                f[x] += w[i] + f[v[i]];\n            }\n        if (son[x]) f[x] /= son[x];\n    }\n    double walk(int x, int fa, int st) {\n        for (int i = head[x]; i; i = next[i])\n            if (onc[v[i]] && v[i] != fa) {\n                if (v[i] == st) return f[x];\n                else return (walk(v[i], x, st) + w[i] + f[x] * son[x]) / (son[x] + 1);\n            }\n        return 0;\n    }\n    inline void solve(int x) {\n        for (int i = head[x]; i; i = next[i])\n            if (onc[v[i]])\n                g[x] += walk(v[i], x, x) + w[i];\n        g[x] /= 2;\n    }\n    void getg(int x, int fa) {\n        for (int i = head[x]; i; i = next[i])\n            if (v[i] != fa && !onc[v[i]]) {\n                if (onc[x])\n                    g[v[i]] = w[i] + (g[x] * 2 + f[x] * son[x] - f[v[i]] - w[i]) / (son[x] + 1);\n                else\n                    g[v[i]] = w[i] + (g[x] + f[x] * son[x] - f[v[i]] - w[i]) / son[x];\n                getg(v[i], x);\n            }\n    }\n    inline void work() {\n        find(1);\n        for (int i = 1; i <= n; ++i)\n            if (onc[i]) getf(i, 0);\n        for (int i = 1; i <= n; ++i)\n            if (onc[i]) solve(i);\n        for (int i = 1; i <= n; ++i)\n            if (onc[i]) getg(i, 0);\n        double ans = 0;\n        for (int i = 1; i <= n; ++i)\n            if (onc[i]) ans += (f[i] * son[i] + g[i] * 2) / (son[i] + 2);\n            else ans += (f[i] * son[i] + g[i]) / (son[i] + 1);\n        ans /= n;\n        printf(\"%.5lf\\n\", ans);\n    }\n}\n```\n\n\u5176\u5b9e\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u57fa\u73af\u6811dp\uff0c\u4e0d\u77e5\u9053\u4e3a\u5565\u8bc4\u6210\u9ed1\u9898\n\n\u795d\u5404\u4f4d\u65b0\u5e74\u5feb\u4e50\uff01",
        "postTime": 1548902011,
        "uid": 72071,
        "name": "GKxx",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P2081 \u3010[NOI2012]\u8ff7\u5931\u6e38\u4e50\u56ed\u3011"
    },
    {
        "content": "\u5bf9\u4e8e\u6811\u7684\u60c5\u51b5\uff1a\n\n\u4ece\u6811\u4e0a\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u51fa\u53d1\uff0c\u663e\u7136\u53ea\u80fd\u5f80\u4e0a\u6216\u8005\u5f80\u4e0b\u4e00\u76f4\u8d70\uff0c\u56e0\u6b64\u8003\u8651\u6811\u5f62dp\u3002\u8bbeup[i]\u8868\u793a\u5f80\u4e0a\u8d70\u7684\u671f\u671b\u957f\u5ea6\uff0cdown[i]\u8868\u793a\u5f80\u4e0b\u8d70\u7684\u671f\u671b\u957f\u5ea6\uff0cson[i]\u8868\u793a\u4ee5i\u7684\u5b69\u5b50\u6570\u3002\n\ndown[u]=sigma(down[v]+len[u][v])/son[u];\uff08u\u662fv\u7684\u7236\u8282\u70b9\uff09\n\nup[v]=len[u][v]+(up[u]+down[u]\\*son[u]-down[u]-len[u][v])/son[u];\uff08v\u5411\u4e0a\u8d70\u5230\u8fbeu\u540e\uff0c\u53ef\u4ee5\u5411u\u7684\u5b69\u5b50\u5176\u4ed6\u5b69\u5b50\u8d70\uff0c\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u5411\u4e0a\u8d70\uff0c\u6709son[u]-1+1\u79cd\u9009\u62e9\uff09\n\n\u7efc\u4e0a\u6211\u4eec\u53ef\u4ee5\u7b97\u51fa\u4ece\u4e00\u4e2a\u70b9i\u51fa\u53d1\u7684\u671f\u671b\u957f\u5ea6\uff1a(down[i]\\*son[i]+up[i])/(son[i]+1);\n\nans\u5c31\u662f\u6240\u6709n\u4e2a\u70b9\u7684\u671f\u671b\u957f\u5ea6\u52a0\u8d77\u6765\u9664\u4ee5n\n\n\u5f53\u7136\u5bf9\u4e8e\u6839\u65e0\u6cd5\u5411\u4e0a\u8d70\u7684\u60c5\u51b5\u8981\u7279\u5224\uff0c\u540c\u65f6\u4e5f\u8981\u6ce8\u610f\u9664\u4ee50\u7684\u60c5\u51b5\u3002\n\n\n\u5bf9\u4e8e\u73af\u7684\u60c5\u51b5\uff1a\n\n\u7531\u4e8e\u6700\u591a\u4e00\u4e2a\u73af\uff0c\u628a\u6240\u6709\u7684\u73af\u4e0a\u70b9\u5904\u7406\u51fa\u6765\uff0c\u6211\u4eec\u5c06\u73af\u4e0a\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u4f5c\u4e3a\u4e00\u68f5\u6811\uff08\u6811\u4e0a\u4e0d\u5305\u542b\u73af\u4e0a\u70b9\uff09\u7684\u6839\uff0c\u7b97\u51fa\u6574\u68f5\u6811\u7684down\uff1b\n\n\u7136\u540e\uff0c\u4ece\u6bcf\u4e00\u4e2a\u73af\u4e0a\u70b9i\u51fa\u53d1\uff0c\u5355\u72ec\u8ba1\u7b97\u5b83\u7684up\uff08\u73af\u4e0a\u6700\u591a20\u4e2a\u8282\u70b9\uff09\uff0c\u8fc7\u7a0b\u5982\u4e0b\uff1a\n\n\u521a\u51fa\u53d1\u65f6\uff0c\u56e0\u4e3a\u662f\u4e00\u4e2a\u73af\uff0c\u53ef\u4ee5\u987a\u65f6\u9488\u4e5f\u53ef\u4ee5\u9006\u65f6\u9488\u8d70\uff0c\u4e24\u8005\u6982\u7387\u4e3a0.5\uff0c\u800c\u8d70\u5230\u4e0b\u4e00\u4e2a\u70b9j\u540e\u53ef\u4ee5\u9009\u62e9\u5f80\u4ee5j\u4e3a\u6839\u7684\u6811\u8d70\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u7ed5\u73af\u8d70\uff0c\u56e0\u6b64\u671f\u671b\u957f\u5ea6\u4e3a0.5\\*(len[i][j]+down[j]\\*son[j]/(son[j]+1));\u800c\u8d70\u5230\u4e86j\u7684\u4e0b\u4e00\u4e2a\u70b9k\u7684\u6982\u7387\u4e3a0.5/(son[j]+1)\uff0c\u56e0\u6b64\u540c\u7406\u671f\u671b\u957f\u5ea60.5/(son[j]+1)\\*(len[j][k]+down[k]\\*son[k]/(son[k]+1))\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u8d70\u5230\u67d0\u70b9j\u65f6\u53d1\u73b0j\u5728\u73af\u4e0a\u7684\u4e0b\u4e00\u4e2a\u70b9\u4e3a\u51fa\u53d1\u70b9\u65f6\uff0c\u663e\u7136\u4e0d\u80fd\u7ed5\u73af\u8d70\u800c\u53ea\u80fd\u5f80\u6811\u4e0a\u8d70\u4e86\uff0c\u56e0\u6b64\u671f\u671b\u957f\u5ea6\u4e3ap\\*(len[lastj][j]+down[j])\u3002\n\n\u7b97\u51fa\u73af\u4e0aup\u540e\u518d\u7b97\u6811\u4e0a\u7684up\uff0c\u6ce8\u610f\u6b64\u65f6\u6bcf\u68f5\u6811\u7684\u6839\u662f\u6709\u4e24\u6761\u5411\u4e0a\u7684\u8def\u7684\u3002\n\n\u6700\u540e\u7b97\u51fa\u7b54\u6848\u3002\n\n\u73af\u7684\u7279\u5224\u8f83\u591a\uff0c\u601d\u7ef4\u4e00\u5b9a\u8981\u7406\u987a\u3002\n\n\n\u4ee3\u7801\u56e0\u4e3a\u6211\u5199\u7684\u5f88\u4e71\u5c31\u4e0d\u8d34\u4e86\u2026\u2026\n",
        "postTime": 1508384798,
        "uid": 13183,
        "name": "\u58a8\u5c14",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2081 \u3010\u8ff7\u5931\u6e38\u4e50\u56ed\u3011"
    },
    {
        "content": "\u6a21\u62df\u5b8c\u6837\u4f8b\u5927\u6982\u53ef\u4ee5\u77e5\u9053\u662f\u9053\u6811\u5f62DP\u4e86\u3002\n\n\u89c2\u5bdf\u6570\u636e\u8303\u56f4\uff0c\u53d1\u73b0\u662f\u57fa\u73af\u6811\uff0c\u81f3\u5c11\u4f1a\u6709\u4e00\u4e2a\u73af\u3002\n\n\u5148\u4ece\u6811\u7684\u90e8\u5206\u5f00\u59cb\u8003\u8651\uff0c\u5982\u679c\u6ca1\u6709\u73af\uff0c\u600e\u4e48DP\u5462?\n\n\u5148\u9009\u53d6\u4e00\u4e2a\u70b9\u4e3a\u6839\uff0cf[i]\u8868\u793a\u4ecei\u8282\u70b9\u51fa\u53d1\u8d70\u5230\u5176\u5b50\u6811\u7684\u8def\u5f84\u671f\u671b\u957f\u5ea6\u3002\n\n\u90a3\u4e48\nf[x]= sum(f[son]+w[i])/\uff08rd[x]-1\uff09\uff0cw[i]\u4e3ason\u5230x\u7684\u8fb9\u957f\uff0crd[x]\u4e3ax\u7684\u5ea6\u6570\uff0c\u5f53\u7136\u5982\u679c\u5230\u4e86\u6839\u8282\u70b9\uff0c\u5c31\u4e0d\u5fc5\u8981\u51cf1\u3002\n\n\u7136\u540e\u518d\u6362\u6839\u4e00\u6ce2\uff0c\u7edf\u8ba1\u7b54\u6848\u5c31\u53ef\u4ee5\u4e86\u3002\u6362\u6839\u65f6\u6ce8\u610f\u8282\u70b9\u5ea6\u6570\u7684\u5904\u7406\u5c31\u884c\u3002\n\n\u8fd9\u6837\u5c31\u80fd\u8f7b\u677e\u62ff\u523050\u5206\u7684\u826f\u5fc3\u90e8\u5206\u5206\u3002\n\n\u5982\u679c\u662f\u57fa\u73af\u6811\u5462\uff1f\n\n\u4e60\u60ef\u628a\u57fa\u73af\u6811\u770b\u6210\u4e00\u4e2a\u201c\u7ec6\u83cc\u201d\uff0c\u628a\u73af\u653e\u6b63\u4e2d\u95f4\u8003\u8651\u3002\n\n\n![](https://cdn.luogu.com.cn/upload/pic/51231.png)\n\n\n\n\u6bcf\u4e00\u4e2a\u5728\u73af\u4e0a\u7684\u70b9\u90fd\u8fde\u63a5\u7740\u4e00\u4e2a\u5b50\u6811\uff0c\u5148\u7528\u524d\u9762\u6811\u5f62DP\u7684\u65b9\u6cd5\u5bf9\u6bcf\u90e8\u5206\u5b50\u6811\u8fdb\u884c\u6c42\u89e3\uff0c\u5148\u4e0d\u6362\u6839\u3002\n\n\u5bf9\u4e8e\u73af\u4e0a\u6bcf\u4e2a\u70b9\uff0c\u53ef\u4ee5\u9006\u65f6\u9488\u8d70\uff0c\u4e5f\u53ef\u4ee5\u987a\u65f6\u9488\u8d70\uff0c\u6240\u4ee5\u679a\u4e3e\u5b83\u5de6\u53f3\u4e24\u6761\u8fb9\u65ad\u6389\uff0c\u62c6\u6210\u94fe\u3002\n\n\u5728\u94fe\u4e0a\u63a8\u4e00\u904d\u5c31\u53ef\u4ee5\u5f97\u5230\u4ece\u8fd9\u4e2a\u70b9\u5f80\u53f3\u6216\u5f80\u5de6\u8d70\u7684\u8def\u5f84\u671f\u671b\u957f\u3002\uff08\u73af\u4e0a\u70b9\u6570\u91cf\u5f88\u5c11\uff0c\u590d\u6742\u5ea6\u5728\u5141\u8bb8\u7684\u8303\u56f4\u5185\uff09\n\n\u7528\u8fd9\u4e24\u79cd\u671f\u671b\u957f\u5ea6\u518d\u53bb\u66f4\u65b0\u8fd9\u4e2a\u70b9\uff0c\u7136\u540e\u8dd1\u5230\u8fd9\u4e2a\u70b9\u5bf9\u5e94\u7684\u5b50\u6811\u53bb\u6362\u6839\u3001\u7edf\u8ba1\u7b54\u6848\u3002\n\n\u7b97\u671f\u671b\u9664\u4ee5\u70b9\u5ea6\u6570\u65f6\u6bd4\u8f83\u7e41\u7410\uff0c\u5199\u7684\u65f6\u5019\u8981\u5c0f\u5fc3\u3002\n\n\u5b89\u5229\u4e00\u6ce2\u535a\u5ba2~ [\u3010NOI2012\u3011\u8ff7\u5931\u6e38\u4e50\u56ed](https://www.cnblogs.com/HLAUV/p/10358058.html)\n\n\u4ee3\u7801~\n\n```\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<algorithm>\n\n#define For(i,a,b) for(register int i=a;i<=b;++i)\n#define Dwn(i,a,b) for(register int i=a;i>=b;--i)\n#define Re register\n#define Db double\n\nusing namespace std;\n\nconst int N=1e5+5;\n\nint head[N],nxt[N*2],v[N*2],cnt=1;\nDb f[N],w[N*2],rd[N],z,ans=0,Dn;\nint n,x,y,m;\nbool Fcr[N],vis[N],Ffd=0;\n\ninline void read(int &v){\n\tv=0;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9')c=getchar();\n\twhile(c>='0'&&c<='9')v=v*10+c-'0',c=getchar();\n}\ninline void read(Db &v){\n\tv=0;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9')c=getchar();\n\twhile(c>='0'&&c<='9')v=v*10+c-'0',c=getchar();\n}\nvoid add(int ux,int vx,Db wx){\n\tcnt++; rd[ux]+=1;\n\tnxt[cnt]=head[ux]; head[ux]=cnt; v[cnt]=vx; w[cnt]=wx;\n\tcnt++; rd[vx]+=1;\n\tnxt[cnt]=head[vx]; head[vx]=cnt; v[cnt]=ux; w[cnt]=wx;\n}\nvoid dfsDP(int x,int fa){\n\tfor(Re int i=head[x];i;i=nxt[i]){\n\t\tint vv=v[i]; if(vv==fa)continue;\n\t\tif(Fcr[vv])continue;\n\t\tdfsDP(vv,x);\n\t\tf[x]+=f[vv]+w[i];\n\t}\n\tif(rd[x]>1&&fa)f[x]/=(rd[x]-1.0);\n\tif(fa==0&&rd[x])f[x]/=rd[x]; \n}\nvoid dfsFA(int x,int fa){\n\tans+=f[x]/Dn; \n\tfor(Re int i=head[x];i;i=nxt[i]){\n\t\tint vv=v[i]; if(vv==fa)continue;\n\t\tif(Fcr[vv])continue;\n\t\tDb Bfx=f[x]; Db Bfv=f[vv];\n\t\t\n\t\tBfx=f[x]*rd[x]-f[vv]-w[i];\n\t\tif(rd[x]>1)Bfx/=(rd[x]-1);\n\t\t\n\t\tf[vv]=f[vv]*(rd[vv]-1)+Bfx+w[i]; \n\t\tf[vv]/=rd[vv];\n\t\tdfsFA(vv,x);\n\t\tf[vv]=Bfv;\n\t}\n}\nint st[N],top=0,tot=-1,cr[N][2];\nDb dsf[N],dcr[N][2],fx[N][2];\nvoid dfsCIR(int x,int fa){\n\tvis[x]=1; st[++top]=x; \n\tfor(Re int i=head[x];i;i=nxt[i]){\n\t\tint vv=v[i]; if(vv==fa)continue;\n\t\tif(vis[vv]){\n\t\t    Ffd=1;\n\t\t    while(st[top]!=vv){\n\t\t    \tint stx=st[top--];\n\t\t    \tcr[++tot][0]=stx; dcr[tot][0]=dsf[stx]; Fcr[stx]=1;\n\t\t\t}\n\t\t\tcr[++tot][0]=vv; dcr[tot][0]=w[i]; Fcr[vv]=1;\n\t\t    return;\n\t\t}\n\t\tdsf[vv]=w[i];\n\t\tdfsCIR(vv,x);\n\t\tif(Ffd)return;\n\t}\n\ttop--;\n}\nvoid getF12(int pos,int now){\n\tint p=pos+1;\n\tDb Fx=0;\n\tif(p>tot)p=0; \n\tFx=f[cr[p][now]];\n\tdo{\n\t\tFx+=dcr[p][now];\n\t\tp++; if(p>tot)p=0;\n\t\tif(p==pos)break;\n\t\tint cx=cr[p][now];\n\t\tDb Fcx=f[cx]*(rd[cx]-2);\n\t\tFx=(Fx+Fcx)/(rd[cx]-1);\n\t}while(p!=pos);\n    fx[ cr[pos][now] ][now]=Fx;\n}\n\nint main(){\n\tread(n); read(m); Dn=n;\n\tmemset(Fcr,0,sizeof(Fcr));\n\tmemset(vis,0,sizeof(vis));\n\tFor(i,1,m){\n\t\tread(x); read(y); read(z);\n\t\tadd(x,y,z);\n\t}\n\tif(m<n){\n\t\tdfsDP(1,0); dfsFA(1,0);\n\t\tprintf(\"%.05lf\",ans);\n\t\treturn 0;\n\t}\n\tdfsCIR(1,0); \n\tFor(i,0,tot){\n\t\trd[cr[i][0]]-=2;\n\t\tdfsDP(cr[i][0],0);\n\t\trd[cr[i][0]]+=2;\n\t}\n    For(i,0,tot){\n    \tcr[i][1]=cr[tot-i][0];\n    \tif(i!=tot)dcr[i][1]=dcr[tot-i-1][0];\n    \telse dcr[i][1]=dcr[tot][0];\n\t}\n \n\tFor(i,0,tot){\n\t\tgetF12(i,0); getF12(i,1);\n\t}\n\tFor(i,0,tot){\n\t\tint cx=cr[i][0];\n\t\tf[cx]*=(rd[cx]-2);\n\t\tf[cx]+=fx[cx][0]+fx[cx][1];\n\t\tf[cx]/=rd[cx];\n\t\tdfsFA(cx,0);\n\t}\n\tprintf(\"%.05lf\",ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1549719236,
        "uid": 86041,
        "name": "_LAUV_",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2081 \u3010[NOI2012]\u8ff7\u5931\u6e38\u4e50\u56ed\u3011"
    },
    {
        "content": "[P2081 [NOI2012] \u8ff7\u5931\u6e38\u4e50\u56ed](https://www.luogu.com.cn/problem/P2081) \n\n\u611f\u8c22 panyf \u5de8\u4f6c\u7ed9\u6211\u8bb2\u8fd9\u9898\uff0c\u5728\u8fd9\u91cc\u5148 orz \u4e3a\u656c\uff01\n\n\u5148\u8003\u8651\u6811\u4e0a\u600e\u4e48\u505a\u3002\u8bbe $f_i$ \u8868\u793a\u4ee5 $i$ \u4e3a\u51fa\u53d1\u70b9\u65f6\u7684\u7b54\u6848\uff0c$g_i$ \u8868\u793a\u4ee5 $i$ \u4e3a\u51fa\u53d1\u70b9\u4e14\u4ec5\u5411\u5b50\u6811\u5185\u8d70\u7684\u7b54\u6848\u3002\u5219\u6709\n$$\ng_u=\\frac{\\sum (g_v+w(u,v))}{|son_u|}\\\\f_v=\\frac{g_v\\times|son_v|+w(u,v)+\\frac{f_u\\times deg_u-g_v-w(u,v)}{|son_u|}}{deg_v}\\\\ans=\\sum f_i\n$$\n\u5bf9\u4e8e\u57fa\u73af\u6811\uff0c\u5148\u4e0d\u8003\u8651\u73af\uff0c\u7b97\u51fa\u6765\u6bcf\u4e2a\u5b50\u6811\u7684 $g$\uff0c\u518d\u8003\u8651\u73af\u4e0a\u6bcf\u4e2a\u70b9\u7684 $f$ \u600e\u4e48\u7b97\u3002\u7531\u4e8e\u73af\u4e0a\u4e0d\u65b9\u4fbf\u6362\u6839 dp \uff0c\u4e14\u73af\u4e0a\u8282\u70b9\u4e2a\u6570\u5f88\u5c11\uff0c\u53ef\u4ee5\u679a\u4e3e\u73af\u4e0a\u7684\u6bcf\u4e2a\u70b9\u4e3a\u8d77\u70b9\uff0c\u987a\u65f6\u9488\u9006\u65f6\u9488\u5404 dp \u4e00\u904d\uff0c\u8f6c\u79fb\u65b9\u7a0b\u7c7b\u4f3c\u6c42 $g$ \u7684\u65b9\u7a0b\u3002\u518d\u6362\u6839\u6c42\u51fa\u5b50\u6811\u5185\u7684 $f$ \u3002\u8bbe $k$ \u4e3a\u73af\u4e0a\u8282\u70b9\u4e2a\u6570\uff0c\u590d\u6742\u5ea6 $O(n+k^2)$\n```cpp\n#include<bits/stdc++.h>\n#define inl inline\nusing namespace std;\ntypedef long long ll;\nnamespace FGF\n{\n\tint n,m;\n\tconst int N=1e5+5;\n\tstruct edg{\n\t\tint to,nxt,w;\n\t}e[N<<1];\n\tint cnt=1,head[N],du[N],cir[N],nw[N],nxt[N],pre[N],pw[N],tot;\n\tbool vis[N],is[N];\n\tdouble f[N],g[N],ans;\n\tinl void add(int u,int v,int w)\n\t{\n\t\tcnt++;\n\t\te[cnt].to=v;\n\t\te[cnt].nxt=head[u];\n\t\thead[u]=cnt;\n\t\te[cnt].w=w,du[v]++;\n\t} \n\tvoid dfs1(int u,int fa)\n\t{\n\t\tfor(int i=head[u];i;i=e[i].nxt)\t\n\t\t{\n\t\t\tint v=e[i].to;\n\t\t\tif(v==fa||is[v])continue;\n\t\t\tdfs1(v,u);\n\t\t\tf[u]+=f[v]+e[i].w;\n\t\t}\n\t\tf[u]/=max(1,fa?du[u]-1:(n==m? du[u]-2:du[u]));\n\t}\n\tvoid dfs2(int u,int fa)\n\t{\n\t\tfor(int i=head[u];i;i=e[i].nxt)\n\t\t{\n\t\t\tint v=e[i].to;\n\t\t\tif(v==fa||is[v])continue;\n\t\t\tf[v]=(f[v]*(du[v]-1)+e[i].w+(f[u]*du[u]-e[i].w-f[v])/(max(1,du[u]-1)))/du[v];\n\t\t\tdfs2(v,u);\n\t\t}\n\t}\t\n\tbool dfscir(int u,int f)\n\t{\n\t\tif(vis[u]){is[u]=1,cir[++tot]=u;return 1;}\n\t\tvis[u]=1;\n\t\tfor(int i=head[u];i;i=e[i].nxt)\n\t\t{\n\t\t\tint v=e[i].to;\n\t\t\tif(v==f)continue;\n\t\t\tif(dfscir(v,u))\n\t\t\t{\t\n\t\t\t\tnxt[u]=i,pre[v]=i^1;\n\t\t\t\tif(cir[1]==u)return 0;\n\t\t\t\tis[u]=1,cir[++tot]=u;\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t}\n\t\treturn 0;\n\t}\n\tdouble dfs3(int u,int fa)\n\t{\n\t\treturn e[pre[u]].to==fa? f[u]:(f[u]*(du[u]-2)+dfs3(e[pre[u]].to,fa)+e[pre[u]].w)/(du[u]-1);\n\t}\n\tdouble dfs4(int u,int fa)\n\t{\n\t\treturn e[nxt[u]].to==fa? f[u]:(f[u]*(du[u]-2)+dfs4(e[nxt[u]].to,fa)+e[nxt[u]].w)/(du[u]-1);\n\t}\n\tvoid work()\n\t{\n\t\tscanf(\"%d%d\",&n,&m);\n\t\tfor(int i=1,u,v,w;i<=m;i++)\n\t\t\tscanf(\"%d%d%d\",&u,&v,&w),add(u,v,w),add(v,u,w);\n\t\tif(n>m)dfs1(1,0),dfs2(1,0);\n\t\telse\n\t\t{\n\t\t\tdfscir(1,0);\n\t\t\tfor(int i=1;i<=tot;i++)\n\t\t\t\tdfs1(cir[i],0);\n\t\t\tfor(int i=1,u;i<=tot;i++)\n\t\t\t\tu=cir[i],g[i]=(f[u]*(du[u]-2)+dfs3(e[pre[u]].to,u)+dfs4(e[nxt[u]].to,u)+e[pre[u]].w+e[nxt[u]].w)/du[u];\n\t\t\tfor(int i=1;i<=tot;i++)\t\n\t\t\t\tf[cir[i]]=g[i],dfs2(cir[i],0);\n\t\t}\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tans+=f[i];\n\t\tprintf(\"%.5f\",ans/n);\n\t}\n}\nint main()\n{\n\tFGF::work();\n\treturn 0;\n}\n```\n",
        "postTime": 1613788938,
        "uid": 224403,
        "name": "\u6728xx\u6728\u5927",
        "ccfLevel": 9,
        "title": "P2081 [NOI2012] \u8ff7\u5931\u6e38\u4e50\u56ed\uff08\u57fa\u73af\u6811+\u671f\u671bdp\uff09\uff09"
    },
    {
        "content": "\u53d1\u73b0\u8fd9\u5f20\u56fe\u8981\u4e48\u662f\u4e00\u68f5\u6811\uff0c\u8981\u4e48\u662f\u4e00\u68f5\u57fa\u73af\u6811\u3002\n\n\u6211\u4eec\u5148\u8003\u8651\u6811\u7684\u505a\u6cd5\u3002\u8bbe\u4e00\u4e2a\u70b9 $i$ \u7684\u5ea6\u6570\u662f $deg_i$\u3002\n\n\u8003\u8651\u4e8c\u6b21\u626b\u63cf\u4e0e\u6362\u6839\u6cd5\u3002\u6211\u4eec\u8bbe$f_i$\u8868\u793a\u4ee5 $1$ \u4e3a\u6839\u65f6\uff0c\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u4e00\u6761\u4ece $i$ \u51fa\u53d1\u7684\u4f9d\u7167\u9898\u9762\u63cf\u8ff0\u7684\u8def\u5f84\u7684\u671f\u671b\u957f\u5ea6\u3002\n\n\u8fd9\u79cd\u5b9a\u4e49\u81ea\u7136\u4e5f\u80fd\u505a\u3002\u4f46\u662f\uff0c\u4e3a\u4e86\u65b9\u4fbf\uff08\u4e5f\u662f\u4e3a\u4e86\u4e0e\u63a5\u4e0b\u6765\u57fa\u73af\u6811\u90e8\u5206\u7684\u8bb2\u89e3\u4e00\u81f4\uff09\uff0c\u6211\u4eec\u7edf\u4e00\u5c06 $f_i$ \u4e58\u4ee5\uff08\u4ee5 $1$ \u4e3a\u6839\u65f6 $i$ \u8282\u70b9\u7684\u513f\u5b50\u6570\uff09\uff0c\u5373 $deg_i-[i\\neq1]$\u3002\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u73b0\u5728\u6709\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f_x=\\sum\\limits_{y\\in son_x}\\dfrac{f_y}{\\max(1,deg_y-1)}+e(x,y)$$\n\n\u5176\u4e2d\uff0c$e(x,y)$ \u662f\u8fde\u63a5 $x,y$ \u7684\u8fb9\u7684\u957f\u5ea6\u3002\u800c\u90a3\u4e2a\u9664\u6570\u4e0e $1$ \u53d6 $\\max$\uff0c\u662f\u56e0\u4e3a\u5982\u679c\u4e0d\u8fd9\u4e48\u5e72\u5728 $y$ \u662f\u53f6\u5b50\u65f6\u5c31\u4f1a\u51fa\u73b0\u9664\u6570\u4e3a\u96f6\uff0c\u5c3d\u7ba1\u6b64\u65f6 $f_y$ \u4e5f\u7b49\u4e8e $0$\u3002\n\n\u5219\u6211\u4eec\u7ecf\u5386\u8fc7\u4e00\u904dDP\u540e\uff0c$f_1$ \u7684\u503c\u5df2\u7ecf\u662f\u671f\u671b\u957f\u5ea6\u4e86\uff08\u53ea\u4e0d\u8fc7\u8981\u9664\u4ee5\u4e00\u4e2a $deg_1$\uff09\u3002\u6211\u4eec\u73b0\u5728\u8003\u8651\u4e8c\u6b21\u626b\u63cf\u66f4\u65b0\u6240\u6709\u7684 $f_y$\u3002\n\n\u6211\u4eec\u6709\n\n$$f_y'=f_y+\\dfrac{f_x-\\Big(\\dfrac{f_y}{\\max(1,deg_y-1)}+e(x,y)\\Big)}{\\max(1,deg_x-1)}+e(x,y)$$\n\n\u5176\u4e2d\uff0c\u6700\u5916\u9762\u7684\u90a3\u4e2a\u5927\u5206\u6570\u7684\u5206\u5b50\uff0c\u662f\u5220\u53bb $y$ \u5f71\u54cd\u540e\u7684 $f_x$\uff1b\u800c\u6b64\u65f6\u4ee5 $y$ \u4e3a\u6839\u65f6\uff0c$x$\u6709 $deg_x-1$ \u4e2a\u513f\u5b50\uff0c\u6545\u4e5f\u8981\u9664\u6389\u624d\u80fd\u5f97\u5230\u771f\u5b9e\u7684\u671f\u671b\u957f\u5ea6\u3002\u6700\u7ec8\u5f97\u5230\u7684 $f_y'$\uff0c\u5373\u4e3a\u771f\u5b9e\u7684 $f_y$\u3002\n\n\u6700\u7ec8\u7b54\u6848\u4e3a\n\n$$\\dfrac{\\sum\\limits_{i=1}^n\\dfrac{f_i}{deg_i}}{n}$$\n\n\u5176\u4e2d $\\sum$ \u5185\u7684\u662f\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u671f\u671b\u957f\u5ea6\uff1b\u56e0\u4e3a\u4e0d\u786e\u5b9a\u8d77\u59cb\u4f4d\u7f6e\uff0c\u6545\u6700\u7ec8\u8981\u9664\u4ee5 $n$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$\u3002\n\n\u6b64\u90e8\u5206\u4ee3\u7801\uff1a\n\n```cpp\nnamespace SUB1{\n\tdouble f[100100],res;\n\tvoid dfs1(int x,int fa){\n\t\tfor(int i=head[x];i!=-1;i=edge[i].next)if(edge[i].to!=fa)dfs1(edge[i].to,x),f[x]+=f[edge[i].to]/max(1,deg[edge[i].to]-1)+edge[i].val;\n\t}\n\tvoid dfs2(int x,int fa){\n\t\tfor(int i=head[x],y;i!=-1;i=edge[i].next)if((y=edge[i].to)!=fa)f[y]+=(f[x]-f[y]/max(1,deg[y]-1)-edge[i].val)/max(1,deg[x]-1)+edge[i].val,dfs2(y,x);\n\t}\n\tvoid solve(){\n\t\tdfs1(1,0);\n\t\tdfs2(1,0);\n\t\tfor(int i=1;i<=n;i++)res+=f[i]/deg[i];\n\t\tprintf(\"%lf\\n\",res/n);\n\t\texit(0);\n\t}\n}\n```\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u518d\u8003\u8651\u57fa\u73af\u6811\u7684\u60c5\u5f62\u3002\n\n\u6211\u4eec\u8003\u8651\u627e\u51fa\u5728\u73af\u4e0a\u7684\u8282\u70b9\u3002\u7136\u540e\uff0c\u4ee5\u73af\u4e0a\u6bcf\u4e2a\u8282\u70b9\u4e3a\u6839\uff0c\u5728\u5b83\u6240\u5bf9\u5e94\u7684\u5b50\u6811\u5185\uff0c\u4ecd\u7136\u4e00\u6b21\u641c\u7d22DP\u51fa $f_i$\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u5bf9\u4e8e\u73af\u4e0a\u7684\u8282\u70b9\uff0c\u6c42\u51fa\u5b83\u771f\u5b9e\u7684\u7b54\u6848\u3002\n\n\u6211\u4eec\u8bbe\u5f53\u524d\u8003\u8651\u7684\u662f\u8282\u70b9 $i$\u3002\u6b64\u65f6\uff0c\u6211\u4eec\u53d1\u73b0\u4ee5\u5b83\u4e3a\u8d77\u70b9\u7684\u8def\u5f84\uff0c\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\n\n1. \u5411 $i$ \u8282\u70b9\u65b9\u5411\u7684\u5b50\u6811\u4e2d\u5ef6\u4f38\u3002\u6b64\u65f6\u5373\u4e3a $f_i$\u3002\n\n2. \u5411 $i$ \u8282\u70b9\u7684\u5b50\u6811\u5916\u5ef6\u4f38\u3002\u6b64\u65f6\uff0c\u5b83\u53ef\u4ee5\u7ecf\u8fc7\u73af\u4e0a\u4e0e $i$ \u8282\u70b9\u76f8\u90bb\u7684\u4e24\u6761\u8fb9\u4e2d\u4efb\u610f\u4e00\u6761\u8fb9\uff0c\u4e14\u6700\u591a\u53ea\u80fd\u7ecf\u8fc7\u4e00\u6761\u8fb9\u3002\u6545\u6211\u4eec\u53ef\u4ee5\u5206\u522b\u65ad\u5f00\u4e24\u6761\u8fb9\u4e2d\u7684\u67d0\u4e00\u6761\uff0c\u5e76\u6c42\u51fa\u6b64\u65f6\u7684\u7ed3\u679c\uff0c\u6700\u7ec8\u52a0\u5728\u4e00\u8d77\u5373\u53ef\u3002\n\n\u6211\u4eec\u8bbe $h_j$ \u8868\u793a\u65ad\u5f00\u5176\u4e2d\u4e00\u6761\u8fb9\u540e\uff0c\u4ee5 $i$ \u4e3a\u6839\u65f6\uff0c\u4ee5 $j$ \u4e3a\u6839\u7684\u5b50\u6811\u4e2d\u4e00\u6761\u4ece $j$ \u51fa\u53d1\u7684\u4f9d\u7167\u9898\u9762\u63cf\u8ff0\u7684\u8def\u5f84\u7684\u671f\u671b\u957f\u5ea6\u3002\u663e\u7136\uff0c\u5bf9\u4e8e\u975e\u73af\u4e0a\u7684\u70b9\uff0c\u6211\u4eec\u6709 $h_j=f_j$\uff1b\u6545\u6211\u4eec\u53ea\u9700\u8003\u8651\u73af\u4e0a\u8282\u70b9\u5373\u53ef\u3002\n\n\u5219\u6211\u4eec\u5bf9\u4e8e\u73af\u4e0a\u8282\u70b9 $x$\uff0c\u6709\n\n$$h_x=f_x+\\dfrac{h_y}{\\max(1,deg_y-1)}+e(x,y)$$\n\n\u5176\u4e2d\uff0c$y$ \u662f $x$ \u8282\u70b9\u5728\u73af\u4e0a\u4e0e\u5176\u76f8\u90bb\u7684\u70b9\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5f53\u8fd9\u4e2a DP \u5728\u73af\u4e0a\u7ed5\u4e86\u4e00\u5708\u540e\uff0c\u662f\u4e0d\u80fd\u91cd\u65b0\u56de\u5230 $i$ \u70b9\u7684\u2014\u2014\u6bd5\u7adf\u8fd9\u6761\u8fb9\u5df2\u7ecf\u65ad\u6389\u4e86\u561b\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u6709\u4e24\u4e2a\u7279\u4f8b\uff1a\n\n1. \u5f53 $x$ \u7684\u4e0b\u4e00\u4e2a\u8282\u70b9\u662f $i$ \u65f6\uff0c\u6211\u4eec\u76f4\u63a5\u6709 $h_x=f_x$\uff1b\n\n2. \u5f53 $x$ \u7684\u4e0b\u4e00\u4e2a\u8282\u70b9\u5c31\u662f\uff081\uff09\u4e2d\u6240\u8ff0\u8282\u70b9\u65f6\uff0c\u56e0\u4e3a\u5b83\u4e0d\u80fd\u8d70\u5411 $i$\uff0c\u6240\u4ee5\u6211\u4eec\u6709\n\n$$h_x=f_x+\\dfrac{h_y}{\\max(1,deg_y-2)}+e(x,y)$$\n\n\u5176\u5b83\u60c5\u5f62\u7684 $h_x$ \u5373\u4e3a\u524d\u6587\u6240\u8ff0\u9012\u63a8\u5f0f\u6c42\u5f97\u3002\n\n\u6211\u4eec\u4ee4 $g_x$ \u8868\u793a\u4e00\u4e2a\u8282\u70b9\u7684\u6700\u7ec8\u7b54\u6848\uff0c\u5219\u5f53\u4e00\u6574\u5708\u5168\u90e8DP\u5b8c\u540e\uff0c\u6211\u4eec\u5c31\u6709 $g_i=h_i$\u3002\uff08\u6ce8\u610f\u8fd9\u91cc\u7684 $h_i$ \u5e94\u8be5\u5305\u62ec\u5206\u522b\u65ad\u5f00\u4e24\u6761\u8fb9\u65f6\u7684\u7ed3\u679c\uff09\n\n\u6211\u4eec\u5206\u522b\u4ee5\u73af\u4e0a\u6bcf\u4e2a\u8282\u70b9\u4e3a $i$\uff0c\u90fd\u80fd\u5f97\u51fa\u5b83\u7684 $g_i$\uff1b\u63a5\u7740\uff0c\u6211\u4eec\u5c31\u6309\u7167\u6811\u7684\u60c5\u5f62\u65f6\u7684\u505a\u6cd5\uff0c\u4e8c\u6b21\u626b\u63cf\u4e00\u4e0b\u5373\u53ef\u5f97\u51fa\u5168\u90e8\u7684 $g_x$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nk)$\uff0c\u5176\u4e2d $k$ \u662f\u73af\u7684\u5927\u5c0f\u3002\n\n\u6b64\u90e8\u5206\u4ee3\u7801\uff1a\n\n```cpp\nnamespace SUB2{\n\tdouble f[100100],g[100100],h[100100],res;\n\tint fa[100100],sz;\n\tbool on[100100];\n\tvoid dfscir(int x){\n\t\tfor(int i=head[x];i!=-1;i=edge[i].next){\n\t\t\tif(edge[i].to==fa[x])continue;\n\t\t\tif(!fa[edge[i].to])fa[edge[i].to]=x,dfscir(edge[i].to);\n\t\t\telse{\n\t\t\t\tint y=x;\n\t\t\t\twhile(y!=edge[i].to)on[y]=true,y=fa[y],sz++;\n\t\t\t\ton[y]=true,sz++;\n\t\t\t}\n\t\t\tif(sz)break;\n\t\t}\n\t}\n\tvoid dfsord(int x){\n\t\tfor(int i=head[x];i!=-1;i=edge[i].next)if(!on[edge[i].to]&&edge[i].to!=fa[x])fa[edge[i].to]=x,dfsord(edge[i].to);\n\t}\n\tvoid dfs1(int x){\n\t\tfor(int i=head[x];i!=-1;i=edge[i].next)if(!on[edge[i].to]&&edge[i].to!=fa[x])dfs1(edge[i].to),f[x]+=f[edge[i].to]/max(1,deg[edge[i].to]-1)+edge[i].val;\n\t}\n\tvoid dfsg(int x,int fr,int rem){\n\t\th[x]=f[x];\n\t\tif(rem==1)return;\n\t\tfor(int i=head[x];i!=-1;i=edge[i].next)if(on[edge[i].to]&&edge[i].to!=fr){\n\t\t\tdfsg(edge[i].to,x,rem-1);\n\t\t\th[x]+=h[edge[i].to]/max(1,deg[edge[i].to]-1-(rem==2))+edge[i].val;\n\t\t}\n\t}\n\tvoid dfss(int x){\n\t\tfor(int i=head[x];i!=-1;i=edge[i].next)if(!on[edge[i].to]&&edge[i].to!=fa[x]){\n\t\t\tg[edge[i].to]=(g[x]-f[edge[i].to]/max(1,deg[edge[i].to]-1)-edge[i].val)/max(1,deg[x]-1)+edge[i].val;\n\t\t\tg[edge[i].to]+=f[edge[i].to];\n\t\t\tdfss(edge[i].to);\n\t\t}\n\t}\n\tvoid solve(){\n\t\tfa[1]=-1,dfscir(1);\n\t\tfor(int i=1;i<=n;i++)if(on[i])fa[i]=0,dfsord(i);\n//\t\tfor(int i=1;i<=n;i++)printf(\"%d \",fa[i]);puts(\"\");\n\t\tfor(int i=1;i<=n;i++)if(on[i])dfs1(i);\n//\t\tfor(int i=1;i<=n;i++)printf(\"%lf\\n\",f[i]);puts(\"\");\n\t\tfor(int i=1;i<=n;i++)if(on[i])dfsg(i,0,sz),g[i]=h[i];\n\t\tfor(int i=1;i<=n;i++)if(on[i])dfss(i);\n\t\tfor(int i=1;i<=n;i++)res+=g[i]/deg[i];\n\t\tprintf(\"%lf\\n\",res/n);\n\t}\n}\n```\n",
        "postTime": 1600783382,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2081 \u3010[NOI2012]\u8ff7\u5931\u6e38\u4e50\u56ed\u3011"
    },
    {
        "content": "#### \u9898\u5916\u8bdd\n\n\u8fd9\u9053\u9898\u5f88\u4e45\u4e4b\u524d\u542c\u6559\u7ec3\u8bb2\u8fc7\uff0c\u5f53\u65f6\u89c9\u5f97\u592a\u9ebb\u70e6\u5c31\u6ca1\u5199\uff0c\u540e\u6765\u62fe\u8d77\u6765\u7684\u65f6\u5019\u5c31\u53d1\u73b0\u81ea\u5df1\u4e0d\u4f1a\u4e86 QwQ  **~~\uff08\u53ef\u80fd\u662f\u56e0\u4e3a\u6211\u592a\u83dc\u4e86\u5427\uff09~~** \uff0c\u4e8e\u662f\u6012\u809d\u4e86\u4e24\u4e2a\u4e0b\u5348\u628a\u5b83\u5f04\u4e86\u51fa\u6765\uff0c\u4e2d\u95f4\u8fd8\u51fa\u4e86\u4e00\u6b21\u5927\u9505\uff0c\u6240\u4ee5\u7559\u4e2a\u535a\u5ba2\u4ee5\u4f5c\u7eaa\u5ff5\u5427\n\n---\n\n### \u9898\u9762\n\n\u9898\u9762\u5f02\u5e38\u7b80\u5355\uff0c\u5c31\u662f\u6c42\u4e00\u9897\u57fa\u73af\u6811\u4e0a\u7684\u4efb\u610f\u4e00\u70b9\u5f80\u67d0\u4e2a\u65b9\u5411\u8d70\u5230\u5934\u7684\u8def\u5f84\u671f\u671b\u957f\u5ea6\u3002\u8fd9\u4e2a\u4e00\u770b\u5c31\u662f\u8981\u7528\u67d0\u79cd\u7c7b\u4f3c$treeDP$ \u7684\u65b9\u6cd5\u5904\u7406\u7684\uff08\u4f46\u662f\u6211\u4e00\u5f00\u59cb\u6ca1\u770b\u51fa\u6765\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5148\u4ece\u7b80\u5355\u95ee\u9898\u5165\u624b\n\n---\n\n### 50\u5206\u2014\u2014\u6811\u4e0adp\n\n\u6211\u4eec\u5148\u8003\u8651\u6ca1\u6709\u73af\u7684\u60c5\u51b5\uff0c\u90a3\u663e\u7136\u8981\u7528\u6811\u4e0aDP\u6765\u89e3\u51b3\u2014\u2014\u6211\u4eec\u5b9a\u4e49\u4e24\u4e2a\u6570\u7ec4 $up[i]$\u3001$down[i]$ \u5206\u522b\u4ee3\u8868\u4ece $i$ \u8282\u70b9\u5411\u4e0a\u548c\u5411\u4e0b\u8d70\u5230\u5934\u7684\u671f\u671b\u8ddd\u79bb\n\n\u90a3\u4e48 $down[i]$ \u5e94\u8be5\u662f\u76f8\u5f53\u597d\u8f6c\u79fb\u7684\uff0c\u56e0\u4e3a\u5b83\u4e0d\u7275\u626f\u62d0\u5f2f\u3002\u505a\u4e00\u904d $dfs$ \u7136\u540e\u7edf\u8ba1\u6bcf\u4e00\u4e2a\u513f\u5b50\u7684 $down$ \u5373\u53ef\u6c42\u51fa $down[i]$ \u4e86\uff0c\u8f6c\u79fb\u65b9\u7a0b\u7528\u624b\u63a8\u4e00\u4e0b\u5e94\u8be5\u5c31\u80fd\u51fa\u6765\uff1a\n$$down[i]=\\frac{\\sum_{i->j}(down[j]+len(i,j))}{son[i]}$$\n\u8fd9\u91cc $j$ \u662f $i$ \u7684\u6bcf\u4e00\u4e2a\u513f\u5b50\uff0c$len(i,j)$ \u8868\u793a $i$ \u5230 $j$ \u8fd9\u6761\u8fb9\u7684\u957f\u5ea6\uff0c$son[i]$ \u8868\u793a $i$ \u7684\u513f\u5b50\u6570\u91cf\n\n\u4f46\u662f $up[i]$ \u5c31\u6709\u70b9\u96be\u641e\uff0c\u56e0\u4e3a\u8fd9\u6761\u8def\u6709\u53ef\u80fd\u5f80\u4e0a\u8d70\u4e86\u51e0\u6b65\u53c8\u62d0\u5230\u5411\u4e0b\uff0c\u800c\u4e14\u4f60\u8fd8\u5f97\u5904\u7406\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u62d0\u5f2f\u7684\u60c5\u51b5\u3002\u8fd9\u5c31\u975e\u5e38\u9ebb\u70e6\u4e86     \n\n\u6211\u4eec\u8003\u8651\uff0c\u5982\u679c\u6211\u4eec\u5904\u7406\u51fa\u4e86\u6bcf\u4e00\u4e2a\u70b9\u7684 $down$\uff0c\u7136\u540e\u4ece\u4e0a\u5f80\u4e0b $dp$\uff0c\u90a3\u4e48\u6211\u4eec\u8fd9\u6761\u8def\u7684\u671f\u671b\u4f1a\u662f\u4ec0\u4e48\u6837\u5b50\u7684\u5462\uff1f\n\n![](https://cdn.luogu.com.cn/upload/pic/51169.png  )\n\n\u6211\u4eec\u4ece\u8fd9\u5e45\u56fe\u4e0a\u53ef\u4ee5\u5f88\u6e05\u695a\u7684\u770b\u5230\uff1a\u8fd9\u4e2a\u671f\u671b\u4e00\u5171\u6d89\u53ca\u4e24\u79cd\u65b9\u5411\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u7684 $2$ \u548c $3 $\u3002\n\n\u8fd9\u4e2a $2$ \u5c31\u76f8\u5f53\u4e8e\u662f\u4ece$i$ \u7684\u7236\u4eb2 f \u51fa\u53d1\u5411\u4e0b\u4e0d\u7ecf\u8fc7 $i$ \u7684\u6240\u6709\u8def\u5f84\u7684\u671f\u671b\uff0c\u53ef\u4ee5\u8868\u793a\u4e3a $down[f]\\times son[f]-down[i]-len(f,i)$\n\n\u90a3\u5982\u679c\u7ee7\u7eed\u5411\u4e0a\uff0c\u5c31\u76f8\u5f53\u4e8e\u662f\u4ece $f$ \u5411\u4e0a\u968f\u4fbf\u8d70\uff0c\u5176\u5b9e\u5c31\u662f $up[f]$\u4e86\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u603b\u7ed3\u51fa\u4e00\u4e2a\u8ba1\u7b97 $up[i]$ \u7684\u516c\u5f0f\u4e86\uff1a\n$$up[i]=len(f,i)+\\frac{down[f]\\times son[f]-down[i]-len(f,i)+up[f]}{deg[f]-1}$$\n\u8fd9\u91cc $deg[f]$ \u8868\u793a $f$ \u7684\u5ea6\u6570\uff0c\u4e5f\u5c31\u662f\u8fd9\u4e2a\u70b9\u8fde\u51fa\u7684\u8fb9\u6570\u3002\u5bb9\u6613\u770b\u51fa\uff0c $deg[f]-1=(son[f] +1)-1=son[f]$\u3002\u6240\u4ee5\u76f4\u63a5\u628a\u5206\u6bcd\u6539\u5199\u6210 $son[f]$ \u5373\u53ef\u3002\n\n\u6700\u540e\u600e\u4e48\u7edf\u8ba1\u7b54\u6848\u5462\uff1f\u53c2\u8003\u4e00\u4e0b\u4e0a\u9762\u90a3\u5e45\u56fe\u5c31\u53ef\u4ee5\u63a8\u51fa\uff1a\n$$ans=\\sum \\frac{up[i]+down[i]*son[i]}{son[i]+1}$$\n\u90a3\u4e48\u6811\u4e0a\u7684\u95ee\u9898\u5c31\u89e3\u51b3\u4e86\n\n**~~\uff08\u5bf9\u4e86\u6211\u8fd9\u91cc\u5c11\u8bf4\u4e86\u4e00\u53e5\uff0c\u5176\u5b9e\u8fd9\u6837\u5199\u5728\u6d1b\u8c37\u4e0a\u662f\u53ef\u4ee5\u6df7\u8fc7\u4e24\u4e2a\u57fa\u73af\u70b9\u7684\u54c8\u54c8\u54c8\u54c8\uff09~~**\n\n![](https://cdn.luogu.com.cn/upload/pic/51171.png )\n\n---\n\n### 100\u5206\u2014\u2014\u57fa\u73af\u6811\u7279\u6b8a\u5904\u7406\n\n\u65e2\u7136\u73af\u4e0a\u7684\u70b9\u4e0d\u591a\uff0c\u53ea\u670920\u4e2a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8f7b\u677e $dfs$ \u627e\u51fa\u8fd9\u4e9b\u70b9\u5e76\u628a\u5b83\u4eec\u7528\u4e00\u4e2a\u7c7b\u4f3c\u94fe\u8868\u7684\u65b9\u5f0f\u4fdd\u5b58\u8d77\u6765\uff08\u5c31\u662f\u4fdd\u5b58\u6bcf\u4e00\u4e2a\u70b9\u7684\u4e0b\u4e00\u4f4d\u548c\u4e0a\u4e00\u4f4d\uff09\n\n\u7136\u540e\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u8fd9\u4e2a\u73af\u8c8c\u4f3c\u5bf9\u73af\u5916\u7684 $up$ \u548c $down$ \u6ca1\u6709\u4efb\u4f55\u5f71\u54cd\uff0c\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e00\u68f5\u5c0f\u6811 $dfs$ \u6c42\u51fa $down$ \n\n\u90a3\u4e48\u6839\u636e\u521a\u624d\u7684\u7ecf\u9a8c\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a $down$ \u6765\u63a8\u7b97\u6bcf\u4e2a\u70b9\u7684 $up$\u4e86\n\n\u6211\u4eec\u5148\u6765\u8bf4\u73af\u4e0a\u7684 $up$ \u503c\u600e\u4e48\u6c42\uff1a\n\n\u6211\u4eec\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c\u73af\u4e0a\u7684\u70b9\u662f $1,2,3,4,5$\uff0c\u6211\u4eec\u94a6\u5b9a\u65b9\u5411\u4e3a\u987a\u65f6\u9488\uff0c\u90a3\u4e48\u5bf9\u4e8e $1$ \u6765\u8bf4\u8d70\u5230 $2$ \u7684\u53ef\u80fd\u6027\u5c31\u662f $1$\u3002\u4ece $2$ \u8d70\u5230 $3$ \u7684\u53ef\u80fd\u6027\u5c31\u662f $\\frac{1}{son[2]+1}$\uff0c\u4ece $3$ \u8d70\u5230 $4$ \u7684\u53ef\u80fd\u6027\u5c31\u662f $\\frac{1}{son[3]+1}$ \u3002\u3002\u3002\u4ee5\u6b64\u7c7b\u63a8\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u987a\u65f6\u9488\u9006\u65f6\u9488\u90fd\u8dd1\u4e00\u904d\uff0c\u7136\u540e\u7edf\u8ba1\u7b54\u6848\u65f6\u9664\u4ee5 2 \u5373\u53ef\u3002\n\n\u8868\u8fbe\u5f0f\u4e0d\u592a\u597d\u770b\uff0c\u6240\u4ee5\u8fd9\u91cc\u5c31\u7ed9\u51fa\u4e00\u4e2a\u987a\u65f6\u9488\u7684\uff1a\n\n$$up[i]=\\sum_{j!=i}^{j=nex[i]} (\\prod_{k!=j}^{k=nex[i]} \\frac{1}{son[k]+1}\\times\\frac{len(last[j],j)+down[j]*son[j]}{son[j]+1})$$\n\n\u9006\u65f6\u9488\u540c\u7406\u5373\u53ef\u3002\n\n\u5982\u679c\u89c9\u5f97\u6ca1\u770b\u61c2\u8868\u8fbe\u5f0f\u7684\u8bdd\uff0c\u8fd9\u91cc\u4e0a\u4e00\u6bb5\u4ee3\u7801\u548c\u4e00\u5f20\u56fe\u5e2e\u52a9\u5404\u4f4d\u7406\u89e3\uff1a\n\n```cpp\ndouble now=1;\nfor(int j=nx[x];j!=x;j=nx[j])\n{\n    if(/**/) //\u8fd9\u91cc\u5176\u5b9e\u8fd8\u6709\u4e00\u4e2a\u7279\u5224\uff0c\u8bf7\u81ea\u884c\u63a8\u7b97\n        up[x]+=now*(h[j]+down[j]*son[j]/(son[j]+1));\n\telse /**/;\n\tnow=now/(son[j]+1);\n}\n```\n\n![](https://cdn.luogu.com.cn/upload/pic/51190.png )\n\n\u8fd9\u91cc $now$ \u5c31\u662f\u4e0a\u9762\u7684  $\\prod \\frac{1}{son[k]+1}$\uff0c\u800c $h[i]$ \u5c31\u662f\u4e00\u4e2a\u9884\u5904\u7406\u7684 $len(last[j],j)$\u3002\u4e0a\u9762\u6240\u8bf4\u7684\u7279\u5224\u5176\u5b9e\u5c31\u662f\u4ece\u73af\u9996\u8d70\u4e86\u4e00\u5708\u53c8\u56de\u6765\u7684\u72b6\u51b5\uff0c\u8bf7\u5404\u4f4d\u81ea\u884c\u63a8\u7b97\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u8d58\u8ff0\u4e86\n\n\u8fd8\u6709\u4e00\u4e2a\u5c0f\u95ee\u9898\u5c31\u662f\u5982\u4f55\u5904\u7406\u73af\u4e0a\u5404\u70b9\u7684\u513f\u5b50\u7684 $up$ \u3002\u56e0\u4e3a\u8fd9\u4e9b\u70b9\u7684\u7236\u8282\u70b9\u5de6\u53f3\u6709\u4e24\u6761\u8fde\u8fb9\uff0c\u6240\u4ee5\u8fd9\u4e9b\u5e97\u9700\u8981\u5355\u72ec\u62ff\u51fa\u6765\u8ba1\u7b97 $up[i]$ \uff1a\n$$up[i]=len(f,i)+\\frac{down[f]\\times son[f]-down[i]-len(f,i)+up[f]\\times2}{deg[f]-1}$$\n\u6ce8\u610f\u4e00\u4e0b\u8fd9\u91cc\u7684 $deg[f]-1\\ne son[f]$ \n\n\u7edf\u8ba1\u7b54\u6848\u7684\u65f6\u5019\u4e0e\u4e4b\u524d\u7684\u5f0f\u5b50\u76f8\u4f3c\uff0c\u6811\u4e0a\u7684\u6309\u7167\u6811\u4e0a\u7684\u7edf\u8ba1\uff0c\u73af\u4e0a\u7684\u5c31\u662f\u4e0a\u9762\u52a0\u4e00\u4e2a $up[i]$ \uff0c\u4e0b\u9762\u52a0 $1$ \u5c31\u884c\u4e86\uff0c\u4e5f\u5c31\u662f\u4e0b\u9762\u7684\u8fd9\u4e2a\u5f0f\u5b50\uff1a\n$$ans=\\sum \\frac{up[i]\\times 2+down[i]*son[i]}{son[i]+2}$$\n\n---\n\n\u8fd8\u6709\u5c31\u662f\u8fd9\u51e0\u4e2a\u671f\u671b\u8ba1\u7b97\u7684\u65f6\u5019\u5206\u6bcd\u90fd\u4e0d\u80fd\u662f $0$ \uff0c\u6240\u4ee5\u9700\u8981\u624b\u52a8\u52a0\u51e0\u4e2a\u7279\u5224\u624d\u884c\u3002\n\n\u597d\u4e86\u591a\u7684\u4e0d\u8bf4\u4e86,\u5177\u4f53\u7ec6\u8282\u8bf7\u770b\u4ee3\u7801\u5427\uff1a\n\n---\n\n### code\n\n```cpp\n#include<vector>\n#include<string.h>\n#include<iostream>\n#define N 100005\nusing namespace std;\nint n,m,flag,nexflag,vis[N],son[N],fa[N],nx[N],h[N],nh[N],tag[N];\ndouble ans,down[N],up[N];\nstruct nod{\n\tint to,val;\n};\nvector<nod> edge[N];\nvector<int> lay[N],loop;\nvoid addedge(int u,int v,int w)\n{\n\tedge[u].push_back((nod){v,w});\n\tedge[v].push_back((nod){u,w});\n}\nvoid dfs1(int x)\n{\n\tdown[x]=0;\n\tfor(int i=0;i<edge[x].size();i++)\n\t{\n\t\tnod nex=edge[x][i];\n\t\tif(!vis[nex.to])\n\t\t{\n\t\t\tvis[nex.to]=1;\n\t\t\tfa[nex.to]=x;\n\t\t\th[nex.to]=nex.val;\n\t\t\tdfs1(nex.to);\n\t\t\tdown[x]+=down[nex.to]+nex.val;\n\t\t\tson[x]++;\n\t\t}\n\t}\n\tif(son[x]>0)\n\t\tdown[x]/=son[x];\n}\nvoid dfs2(int x)\n{\n\tint f=fa[x];\n\tif(son[f]>1)\n\t{\n\t\tif(!tag[x])\n\t\t\tup[x]=(double)(down[f]*son[f]-down[x]-h[x]+up[f])/(edge[f].size()-1)+h[x];\n\t\telse\tup[x]=(double)(down[f]*son[f]-down[x]-h[x]+up[f]*2)/(edge[f].size()-1)+h[x];\n\t}\n\telse\tup[x]=up[f]+h[x];\n\tfor(int i=0;i<edge[x].size();i++)\n\t{\n\t\tnod nex=edge[x][i];\n\t\tif(!vis[nex.to])\n\t\t{\n\t\t\tvis[nex.to]=1;\n\t\t\tdfs2(nex.to);\n\t\t}\n\t}\n}\nvoid dfs3(int x,int pre)\n{\n\tvis[x]=1;\n\tif(flag!=0)\n\t\treturn;\n\tfor(int i=0;i<edge[x].size();i++)\n\t{\n\t\tnod nex=edge[x][i];\n\t\tif(nex.to!=pre)\n\t\t{\n\t\t\tif(vis[nex.to])\n\t\t\t{\n\t\t\t\tif(flag!=0)\treturn;\n\t\t\t\tflag=x;\n\n\t\t\t\tnexflag=nex.to;\n\t\t\t\tfa[nex.to]=x;\n\t\t\t\tnx[x]=nex.to;\n\t\t\t\th[nex.to]=nh[x]=nex.val;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif(flag!=0)\treturn;\n\t\t\tfa[nex.to]=x;\n\t\t\tnx[x]=nex.to;\n\t\t\th[nex.to]=nh[x]=nex.val;\n\t\t\tdfs3(nex.to,x);\n\t\t\tif(flag!=0)\treturn;\n\t\t}\n\t}\n}\nvoid cl_vis()\n{\n\tmemset(vis,0,sizeof(vis));\n\tfor(int i=0;i<loop.size();i++)\n\t\tvis[loop[i]]=1;\n}\nint main()\n{\n\tint u,v,w;\n\tcin>>n>>m;\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tcin>>u>>v>>w;\n\t\taddedge(u,v,w);\n\t}\n\tif(m==n-1)\n\t{\n\t\tvis[1]=1;\n\t\tdfs1(1);\n\t\tmemset(vis,0,sizeof(vis));\n\t\tvis[1]=1;\n\t\tdfs2(1);\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tans+=(double)(down[i]*son[i]+up[i])/(son[i]+(fa[i]!=0?1:0));\n\t\tprintf(\"%.5f\",ans/n);\n\t}\n\telse\n\t{\n\t\tdfs3(1,0);\n\t\tfor(int i=flag;i!=nexflag;i=fa[i])\n\t\t\tloop.push_back(i),vis[i]=1;\n\t\tloop.push_back(nexflag);vis[nexflag]=1;\n\t\tcl_vis();\n\t\tint sz=loop.size();\n\t\tfor(int i=0;i<sz;i++)\n\t\t\tdfs1(loop[i]);\n\t\tfor(int i=sz-1;i>=0;i--)\n\t\t{\n\t\t\tint x=loop[i];\n\t\t\tdouble now=1;\n\t\t\tup[x]=0;\n\t\t\tfor(int j=nx[x];j!=x;j=nx[j])\n\t\t\t{\n\t\t\t\tif(nx[j]!=x)\n\t\t\t\t\tup[x]+=now*(h[j]+down[j]*son[j]/(son[j]+1));\n\t\t\t\telse\tup[x]+=now*(h[j]+down[j]);\n\t\t\t\tnow=now/(son[j]+1);\n\t\t\t}\n\t\t\tnow=1;\n\t\t\tfor(int j=fa[x];j!=x;j=fa[j])\n\t\t\t{\n\t\t\t\tif(fa[j]!=x)\n\t\t\t\t\tup[x]+=now*(nh[j]+down[j]*son[j]/(son[j]+1));\n\t\t\t\telse\tup[x]+=now*(nh[j]+down[j]);\n\t\t\t\tnow=now/(son[j]+1);\n\t\t\t}\n\t\t\tup[x]/=2;\n\t\t}\n\t\tcl_vis();\n\t\tfor(int i=0;i<sz;i++)\n\t\t\tfor(int j=0;j<edge[loop[i]].size();j++)\n\t\t\t{\n\t\t\t\tnod nex=edge[loop[i]][j];\n\t\t\t\tif(!vis[nex.to])\n\t\t\t\t\tvis[nex.to]=tag[nex.to]=1,dfs2(nex.to);\n\t\t\t}\t\n\t\tcl_vis();\n\t\tfor(int i=1;i<=n;i++)\n\t\t{\n\t\t\tif(!vis[i])\n\t\t\t\tans+=(double)(down[i]*son[i]+up[i])/(son[i]+1);\n\t\t\telse\tans+=(double)(down[i]*son[i]+up[i]*2)/(son[i]+2);\n\t\t}\n\t\tprintf(\"%.5f\",ans/n);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1549692270,
        "uid": 41262,
        "name": "SSHhh",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P2081 \u3010[NOI2012]\u8ff7\u5931\u6e38\u4e50\u56ed\u3011"
    },
    {
        "content": "\u7adf\u7136\u5728 loj \u4e00\u6b21\u5c31\u8dd1\u5230\u4e86 [rk1](https://loj.ac/problem/2673/statistics/fastest) qwq\n\n## \u89e3\u6790\n\n\u5148\u8003\u8651\u8fd9\u4e2a\u95ee\u9898\u5728\u6811\u4e0a\u600e\u4e48\u505a\n\n### \u6811\u7684\u505a\u6cd5\n\n\u6211\u4eec\u5148\u5047\u8bbe\u4e00\u4e2a\u70b9\u4e3a\u6839\uff08\u5927\u95e8\uff09\uff0c\u4e8e\u662f\u53ef\u4ee5\u8bbe\u51fa\u72b6\u6001\uff0c$dp(u)$ \u8868\u793a\u4ece $u$ \u51fa\u53d1\uff0c\u4ec5\u5411\u5b50\u6811\u8d70\u7684\u671f\u671b\u8def\u5f84\u957f\n\n\u7531\u671f\u671b\u7684\u7ebf\u6027\u53ef\u5f97\u51fa\u8f6c\u79fb\u65b9\u7a0b\uff1a$dp(u)=\\frac {\\sum\\limits_{v\\in S_u}(dp(v)+w(u, v))} {|S_u|}$ \u6216 $dp(u)=0$ \u4ec5\u5f53 $u$ \u4e3a\u53f6\u5b50\u65f6\uff0c\u5176\u4e2d $S_u$ \u662f $u$ \u7684\u513f\u5b50\u7ed3\u70b9\u96c6\u5408\uff0c$w(u, v)$ \u662f\u4e00\u6761\u8fb9\u7684\u8fb9\u6743\n\n\u8fd9\u4e2a dp \u5f0f\u5b50\u6bd4\u8f83\u7b80\u5355\uff0c\u4e8e\u662f\u7528\u76f4\u63a5\u6362\u6839 dp\uff08up down\uff09\u5c31\u53ef\u4ee5\u5f97\u51fa\u4ee5\u6240\u6709\u7ed3\u70b9\u4e3a\u6839\u7684\u671f\u671b\u8def\u5f84\u957f\u3002\u6211\u4eec\u518d $O(n)$ \u7edf\u8ba1\u6240\u6709\u7ed3\u70b9\u4ee5\u5b83\u4e3a\u6839\u7684 dp \u503c\uff0c\u5c31\u5f97\u5230\u4e86\u9898\u76ee\u8981\u6c42\u7684\u7b54\u6848\n\n&nbsp;\n\n\u63a5\u7740\u518d\u8003\u8651\u5728\u57fa\u73af\u6811\u4e0a\u600e\u4e48\u505a\n\n### \u57fa\u73af\u6811\u7684\u505a\u6cd5\n\n\u6211\u4eec\u5148\u5c06\u73af\u4e0a\u7684\u6811\u90fd\u62ce\u51fa\u6765\u505a\u4e00\u6b21\u7b2c\u4e00\u6b21 dp\uff08\u6682\u65f6\u4e0d\u505a\u7b2c\u4e8c\u6b21\u7684\u6362\u6839\uff09\u3002\u5982\u56fe\uff0c\u7ea2\u8272\u7ed3\u70b9\u5c31\u662f\u6bcf\u6b21 dp \u7684\u6811\u7684\u6839\n\n![circle](https://cdn.luogu.com.cn/upload/image_hosting/qj6bnra5.png)\n\n\u76ee\u524d\u6211\u4eec\u6c42\u51fa\u7684\u6839\u7684\u7b54\u6848\u90fd\u662f \u201c\u4e0d\u5b8c\u5168\u201d \u7684\uff0c\u56e0\u4e3a\u8fd8\u6ca1\u8003\u8651\u8d70\u73af\u7684\u8def\u5f84\u3002\u800c\u4e14\u5982\u679c\u60f3\u5bf9\u8fd9\u4e9b\u6811\u505a\u7b2c\u4e8c\u6b21 dp\uff0c\u6211\u4eec\u5176\u5b9e\u53ea\u9700\u8981\u5f97\u5230\u6839\uff08\u7ea2\u8272\u7ed3\u70b9\uff09\u7684\u7b54\u6848\u3002\u56e0\u6b64\u6211\u4eec\u5148\u8003\u8651\u6c42\u51fa\u73af\u4e0a\u7ed3\u70b9\u7684\u7b54\u6848\n\n\u7531\u4e8e\u73af\u4e0a\u7684\u7ed3\u70b9\u8f83\u5c11\uff0c\u4e14\u5728\u73af\u4e0a\u6362\u6839\u4e0d\u592a\u53ef\u505a\uff08\u6bcf\u6b21\u6362\u6839\u90fd\u8981\u4fee\u6539\u6240\u6709\u70b9\u7684\u6743\u503c\uff0c\u5373\u4f7f\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u4e5f\u4e0d\u592a\u53ef\u505a\uff08\u53ef\u80fd\u8981\u7ef4\u62a4\u4e00\u4e2a \u201c\u9ad8\u5ea6\u201d \u4e3a\u73af\u4e0a\u7ed3\u70b9\u4e2a\u6570\u7684\u7e41\u5206\u6570\uff09\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u66b4\u529b\u679a\u4e3e\u73af\u4e0a\u7684\u7ed3\u70b9\u4f5c\u4e3a\u8d77\u70b9\u5e76 dp\n\n\u5b9e\u9645\u505a\u6cd5\u548c\u505a\u6811\u7684\u65b9\u6cd5\u662f\u5dee\u4e0d\u591a\u7684\u3002\u4f46\u6ce8\u610f\u8fd9\u65f6\u6709\u53ef\u80fd\u904d\u5386\u5230\u5df2\u7ecf\u8d70\u8fc7\u7684\u7ed3\u70b9\uff08\u6bd5\u7adf\u662f\u4e2a\u73af\uff09\uff0c\u8fd9\u65f6\u4e0d\u80fd\u63a5\u7740\u5f80\u8fd9\u4e2a\u7ed3\u70b9\u8d70\n\n\u5982\u679c\u5728 dp \u65f6\u6df1\u5165\u4e0a\u8ff0\u7684\u4e00\u68f5\u6811\uff0c\u6211\u4eec\u5df2\u7ecf\u7b97\u51fa\u7684 dp \u503c\u662f\u53ef\u4ee5\u76f4\u63a5\u62ff\u6765\u7528\u7684\uff1b\u4f46\u73af\u4e0a\u7ed3\u70b9\u4e0d\u884c\uff0c\u56e0\u4e3a\u4ee5\u4e0d\u540c\u7684\u7ed3\u70b9\u4e3a\u6839\uff0c\u5f62\u6210\u7684\u641c\u7d22\u6811\u4e2d\u73af\u4e0a\u7ed3\u70b9\u7684**\u5173\u7cfb**\u4e5f\u662f\u4e0d\u540c\u7684\u3002\u6bcf\u6b21\u505a\u73af dp \u9700\u8981\u6211\u4eec\u91cd\u65b0\u8ba1\u7b97\u7684\u7ed3\u70b9\u5b9e\u9645\u4e0a**\u53ea\u6709\u73af\u4e0a\u7684\u70b9**\n\n\u7531\u4e8e\u6211\u4eec\u53ef\u4ee5\u9006\u65f6\u9488\u8d70\u73af\uff0c\u4e5f\u53ef\u4ee5\u987a\u65f6\u9488\u8d70\u73af\uff0c\u56e0\u6b64\u505a\u4e00\u6b21\u73af\u4e0a dp \u7684\u8ba1\u7b97\u6b21\u6570\u5c31\u7ea6\u4e3a $2m$\uff0c\u73af\u4e0a dp \u603b\u7684\u590d\u6742\u5ea6\u5c31\u4e3a $O(m^2)$\uff0c\u5176\u4e2d $m$ \u4e3a\u73af\u4e0a\u7ed3\u70b9\u6570\n\n\u5f97\u51fa\u73af\u4e0a\u7ed3\u70b9\u7684\u7b54\u6848\u540e\uff0c\u6211\u4eec\u518d\u5bf9\u6bcf\u68f5\u6811\u505a\u4e00\u6b21\u6362\u6839 dp\uff0c\u5c31\u5f97\u51fa\u4ece\u6bcf\u4e2a\u70b9\u51fa\u53d1\u7684\u671f\u671b\u8def\u5f84\u957f\u4e86\n\n## CODE\n\n\u7ec6\u8282\u5b9e\u73b0\u7565\u4e11\uff0c\u6709\u5f88\u591a\u5730\u65b9\u53ef\u4ee5\u7b80\u5316\uff0c\u522b\u5728\u610fqaq\n\n\u6ce8\u610f\u505a\u73af dp \u65f6\u8981\u628a\u7b54\u6848\u4e34\u65f6\u5b58\u5230\u53e6\u4e00\u4e2a\u5730\u65b9\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u8986\u76d6\u539f dp \u503c\uff0c\u5426\u5219\u505a\u4e0b\u4e00\u6b21\u73af dp \u65f6\u4f1a\u51fa\u9519\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#pragma GCC optimize(\"O3\")\n#pragma GCC optimize(\"Ofast\", \"-funroll-loops\", \"-fdelete-null-pointer-checks\")\n#pragma GCC target(\"ssse3\", \"sse3\", \"sse2\", \"sse\", \"avx2\", \"avx\")\n#define ll long long\n\nconst int MAXN =1e5+50;\n\n/*------------------------------Map------------------------------*/\n\nint first[MAXN], tote;\nstruct edge{\n\tint net, to;\n\tint w;\n}e[MAXN<<1];\n\ninline void addedge(int u, int v, int w){\n\t++tote;\n\te[tote].to =v, e[tote].w =w, e[tote].net =first[u];\n\tfirst[u] =tote;\n\t++tote;\n\te[tote].to =u, e[tote].w =w, e[tote].net =first[v];\n\tfirst[v] =tote;\n}\n\ndouble dp[MAXN];/*--Dfs--*/\n\n/*------------------------------Circle------------------------------*/\n\nint d[MAXN];\nint pre[MAXN], net[MAXN], evalpre[MAXN], evalnet[MAXN], id[MAXN], circle;\nbool vis[MAXN], color[MAXN], visc[25];\nint stk[MAXN], top;\n\nint predfs(int u, int fa){\n\tvis[u] =1;\n\tstk[top++] =u;\n\tfor(int l =first[u]; l; l =e[l].net)\n\t\tif(e[l].to != fa){\n\t\t\tevalnet[u] =e[l].w;\n\t\t\tif(vis[e[l].to])\n\t\t\t\treturn e[l].to;\n\t\t\telse{\n\t\t\t\tint ret =predfs(e[l].to, u);\n\t\t\t\tif(ret != 0)\n\t\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t--top;\n\treturn 0;\n}\n\nvoid getCircle(){\n\tcircle =predfs(1, 0);\n\t/*\u63a5\u73af\u5e76\u7ed9\u73af\u67d3\u8272*/\n\tint ID =0;\n\tnet[stk[top-1]] =circle;\n\tpre[circle] =stk[top-1];\n\tevalpre[circle] =evalnet[stk[top-1]];\n\tid[circle] =ID++;/*\u6807\u53f7\uff0c\u80fd\u51cf\u5c11\u4e9b\u65f6\u95f4 )*/\n\tcolor[circle] =1;\n\twhile(stk[top-1] != circle){\n\t\tnet[stk[top-2]] =stk[top-1];\n\t\tpre[stk[top-1]] =stk[top-2];\n\t\tevalpre[stk[top-1]] =evalnet[stk[top-2]];\n\t\tid[stk[top-1]] =ID++;\n\t\tcolor[stk[top-1]] =1;\n\t\t--top;\n\t}\n}\n\ndouble dp2[MAXN];\n\n/*\u671d net \u8d70*/\nvoid dfs3(int u, const int &cur/*\u5f53\u524d\u8ba1\u7b97\u7684\u7ed3\u70b9*/){\n\tif(net[u] != cur){\n\t\tdfs3(net[u], cur);\n\t\tif(d[u] > 2)\n\t\t\tdp2[u] =(dp[u]*(d[u]-2)+dp2[net[u]]+evalnet[u])/(d[u]-1);\n\t\telse\n\t\t\tdp2[u] =dp2[net[u]]+evalnet[u];\n\t}\n\telse{\n\t\tif(d[u] > 2)\n\t\t\tdp2[u] =dp[u];\n\t\telse\n\t\t\tdp2[u] =0;\n\t}\n}\n\n/*\u671d pre \u8d70*/\nvoid dfs4(int u, const int &cur){\n\tif(pre[u] != cur){\n\t\tdfs4(pre[u], cur);\n\t\tif(d[u] > 2)\n\t\t\tdp2[u] =(dp[u]*(d[u]-2)+dp2[pre[u]]+evalpre[u])/(d[u]-1);\n\t\telse\n\t\t\tdp2[u] =dp2[pre[u]]+evalpre[u];\n\t}\n\telse{\n\t\tif(d[u] > 2)\n\t\t\tdp2[u] =dp[u];\n\t\telse\n\t\t\tdp2[u] =0;\n\t}\n}\n\n/*------------------------------Dfs------------------------------*/\n\nint m, n;\n\n/*\u5bf9\u4e8e\u6709\u6839\u6811\u7684\u7b2c\u4e00\u6b21 dfs*/\nvoid dfs1(int u, int fa){\n\tfor(int l =first[u]; l; l =e[l].net)\n\t\tif(e[l].to != fa && !color[e[l].to]/*\u907f\u514d\u8d70\u5230\u73af\u4e0a*/){\n\t\t\tdfs1(e[l].to, u);\n\t\t\tdp[u] +=dp[e[l].to]+e[l].w;\n\t\t}\n\tif(m == n){\n\t\tif(color[u])/*\u7531\u4e8e\u6811\u6839\u5728\u73af\u4e0a\uff0c\u8981\u5206\u7c7b\u8ba8\u8bba*/\n\t\t\tdp[u] /=d[u]-2;\n\t\telse if(d[u] != 1/*\u6ce8\u610f\u53f6\u5b50*/)\n\t\t\tdp[u] /=d[u]-1;\n\t}\n\telse{\n\t\tif(fa == 0)\n\t\t\tdp[u] /=d[u];\n\t\telse if(d[u] != 1)\n\t\t\tdp[u] /=d[u]-1;\n\t}\n}\n\n/*\u5bf9\u4e8e\u6709\u6839\u6811\u7684\u7b2c\u4e8c\u6b21 dfs ( \u6362\u6839 )*/\nvoid dfs2(int u, int fa){\n\tfor(int l =first[u]; l; l =e[l].net)\n\t\tif(e[l].to != fa && !color[e[l].to]){\n\t\t\tdouble res;\n\t\t\tif(m == n){\n\t\t\t\t/*\u5982\u679c\u5b58\u5728\u73af\uff0c\u6b64\u65f6\u73af\u4e0a\u7ed3\u70b9\u7684\u8d21\u732e\u90fd\u662f \" \u5b8c\u6574 \" \u7684\u4e86\uff0c\u56e0\u6b64\u4e0d\u7528\u5206\u7c7b*/\n\t\t\t\tres =(dp[u]*d[u]-(dp[e[l].to]+e[l].w))/(d[u]-1);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(d[u] == 1)/*\u6ce8\u610f\u94fe\u6570\u636e*/\n\t\t\t\t\tres =0;\n\t\t\t\telse\n\t\t\t\t\tres =(dp[u]*d[u]-(dp[e[l].to]+e[l].w))/(d[u]-1);\n\t\t\t}\n\t\t\tdp[e[l].to] =(dp[e[l].to]*(d[e[l].to]-1)+res+e[l].w)/d[e[l].to];\n\t\t\tdfs2(e[l].to, u);\n\t\t}\n}\n\n/*------------------------------Main------------------------------*/\n\ninline int read(){\n\tint x =0; char c =getchar();\n\twhile(c < '0' || c > '9') c =getchar();\n\twhile(c >= '0' && c <= '9') x = (x<<3) + (x<<1) + (48^c), c =getchar();\n\treturn x;\n}\n\ndouble tmpdp[25];\n\nint main(){\n\tn =read(), m =read();\n\tfor(int i =0; i < m; ++i){\n\t\tint u =read(), v =read(), w =read();\n\t\taddedge(u, v, w);\n\t\t++d[u], ++d[v];\n\t}\n\tif(m == n-1){\n\t\tdfs1(1, 0);\n\t\tdfs2(1, 0);\n\t}\n\telse{\n\t\tgetCircle();\n\t\tfor(int u =circle; !visc[id[u]]; u =net[u]){\n\t\t\tif(d[u] > 2)/*\u53ea\u5bf9\u6709\u5b50\u6811\u7684\u73af\u4e0a\u7ed3\u70b9 dfs ( \u8fd9\u4e2a\u7ec6\u8282\u8bf4\u5b9e\u8bdd\u6709\u70b9\u4e11 )*/\n\t\t\t\tdfs1(u, 0);\n\t\t\tvisc[id[u]] =1;\n\t\t}\n\t\tmemset(visc, 0, sizeof(visc));\n\t\tfor(int u =circle; !visc[id[u]]; u =net[u]){\n\t\t\tdouble res =0;\n\t\t\t/*\u6a21\u62df\u8d70\u73af*/\n\t\t\tdfs3(net[u], u);\n\t\t\tres +=dp2[net[u]]+evalnet[u];\n\t\t\tdfs4(pre[u], u);\n\t\t\tres +=dp2[pre[u]]+evalpre[u];\n\t\t\tif(d[u] > 2)\n\t\t\t\ttmpdp[id[u]] =(dp[u]*(d[u]-2)+res)/d[u];\n\t\t\telse\n\t\t\t\ttmpdp[id[u]] =res/d[u];\n\t\t\tvisc[id[u]] =1;\n\t\t}\n\t\tmemset(visc, 0, sizeof(visc));\n\t\tfor(int u =circle; !visc[id[u]]; u =net[u]){\n\t\t\tdp[u] =tmpdp[id[u]];\n\t\t\tif(d[u] > 2)\n\t\t\t\tdfs2(u, 0);\n\t\t\tvisc[id[u]] =1;\n\t\t}\n\t}\n\tdouble ans =0;\n\tfor(int i =1; i <= n; ++i)\n\t\tans +=dp[i];\n\tprintf(\"%.5lf\", ans/n);\n}\n```",
        "postTime": 1599540834,
        "uid": 105254,
        "name": "Piwry",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2081 \u3010[NOI2012]\u8ff7\u5931\u6e38\u4e50\u56ed\u3011"
    },
    {
        "content": "\u5047\u5982\u4ece\u6811\u6839\u51fa\u53d1\uff0c\u90a3\u4e00\u5b9a\u53ea\u80fd\u5f80\u5b50\u6811\u8d70\uff0c\u56e0\u4e3a\u662f\u6811\uff0c\u6240\u4ee5\u6ca1\u6709\u56de\u5934\u8def\n\n\u4ee4f[i]:\u4ee5i\u4e3a\u6839\u7684\u5b50\u6811\u91cc\uff0c\u4ecei\u51fa\u53d1\uff0c\u671f\u671b\u8def\u7a0b\n\ng[i]:\u6574\u68f5\u6811\u4ee5i\u4e3a\u6839\uff0c\u4ecei\u51fa\u53d1\uff0c\u671f\u671b\u8def\u7a0b\n\nf[i]\u5f88\u597d\u7edf\u8ba1\uff0c\u7136\u540e\u5229\u7528f[i]\u7edf\u8ba1g[i]\uff0c\u65b9\u6cd5\u4e0d\u96be\uff0c\u6362\u6839\u800c\u5df2\n\n\n\n\u5982\u679c\u6709\u73af\u53c8\u600e\u4e48\u505a\uff1f\u9898\u4e2d\u6307\u660e\uff0c\u73af\u6700\u591a\u4e00\u4e2a\uff0c\u5927\u5c0f\u4e0d\u8d85\u8fc720\uff0c\u8fd9\u4e2a\u73af\u5f88\u5c0f\n\n\u53ef\u4ee5\u6ce8\u610f\u5230\uff0c\u73af\u5220\u6389\u4efb\u610f\u4e00\u6761\u8fb9\uff0c\u90fd\u5269\u4e0b\u4e00\u68f5\u6811\uff0c\u90a3\u5c31\u5f80\u8fd9\u91cc\u8f6c\u5316\n\n\u73b0\u5047\u8bbe\u8ba9\u73af\u4e0a\u4e00\u70b9\u4f5c\u4e3a\u6811\u6839\uff0c\u4f5c\u56fe\n![](https://img-blog.csdn.net/20161222190057473?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvQ1JaYnVsYWJ1bGE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)\n\u4ecex\u51fa\u53d1\uff0c\u5982\u679c\u8d70\u5411\u522b\u7684\u5b50\u6811(\u4e09\u89d2\u5f62\u4ee3\u66ff)\uff0c\u90a3\u4e48\u73af\u4e0a\u51b3\u7b56\u65e0\u5f71\u54cd\n\n\u5982\u679c\u8d70\u4e86\u7ea2\u8fb9\uff0c\u84dd\u8fb9\u4e00\u5b9a\u4e0d\u80fd\u8d70\uff0c\u5982\u679c\u8d70\u4e86\u84dd\u8fb9\uff0c\u7ea2\u8fb9\u4e00\u5b9a\u4e0d\u80fd\u8d70\n\n\u679a\u4e3e\u8d70\u7ea2\u8fb9\u6216\u8005\u84dd\u8fb9\uff0c\u5c31\u80fd\u8f6c\u6362\u6210\u6811\u4e0a\u7684\u60c5\u51b5\u4e86\uff0c\u5f71\u54cd\u7684f\u503c\u663e\u7136\u53ea\u6709\u4e0e\u8be5\u73af\u6709\u5173\u7684\u90a3\u4e2a\u5b50\u6811\n\n\u800c\u9664\u4e86\u90a3\u4e2a\u5b50\u6811\uff0c\u5176\u4ed6\u5b50\u6811(\u4e09\u89d2\u5f62)\u7684g\u663e\u7136\u5c31\u90fd\u53ef\u4ee5\u7edf\u8ba1\u4e86\n\n\u90a3\u8fd9\u6837O(n*\u73af\u7684\u5927\u5c0f)\u5c31\u80fd\u89e3\u51b3\u672c\u9898\n\n## **AC\u9898\u89e3**\n```cpp\n#include<iostream>\n#include<cstring>\n#include<vector>\n#include<queue>\n#include<algorithm>\n#include<cmath>\n#include<cstdio>\n#include<bitset>\nusing namespace std;\n\nconst int maxn = 1E5 + 10;\ntypedef double DB;\n\nstruct E{\n\tint to,w; E(){}\n\tE(int to,int w): to(to),w(w){}\n};\n\nint n,m,cnt,tp,tot,vis[maxn],s[maxn],stk[maxn];\nbool bo[maxn];\nDB Ans,f[maxn],g[maxn];\n\nvector <E> v[maxn];\n\nvoid Calc_f(int x)\n{\n\tint son = 0; f[x] = 0.000;\n\tfor (int i = 0; i < v[x].size(); i++)\n\t{\n\t\tE e = v[x][i];\n\t\tif (vis[e.to] == cnt) continue;\n\t\tvis[e.to] = cnt; Calc_f(e.to); ++son;\n\t\tf[x] += (DB)(e.w) + f[e.to];\n\t}\n\tif (son) f[x] /= (DB)(son);\n}\n\nvoid Calc_g(int x,DB t)\n{\n\tint son = v[x].size(); DB sum = 0.000;\n\tfor (int i = 0; i < v[x].size(); i++)\n\t{\n\t\tE e = v[x][i];\n\t\tif (vis[e.to] == cnt) continue;\n\t\tsum += f[e.to] + (DB)(e.w);\n\t}\n\tg[x] = (sum + t) / (DB)(son);\n\tfor (int i = 0; i < v[x].size(); i++)\n\t{\n\t\tE e = v[x][i];\n\t\tif (vis[e.to] == cnt) continue;\n\t\tvis[e.to] = cnt;\n\t\tDB res = sum - f[e.to] - (DB)(e.w);\n\t\tDB Nex = (son > 1)?(t + res) / (DB)(son - 1) + (DB)(e.w):(DB)(e.w);\n\t\tCalc_g(e.to,Nex);\n\t}\n}\n\nbool Dfs(int x,int fa)\n{\n\tstk[++tp] = x;\n\tfor (int i = 0; i < v[x].size(); i++)\n\t{\n\t\tE e = v[x][i];\n\t\tif (e.to == fa) continue;\n\t\tif (vis[e.to] == cnt)\n\t\t{\n\t\t\tfor (;;)\n\t\t\t{\n\t\t\t\ts[++tot] = stk[tp]; bo[s[tot]] = 1;\n\t\t\t\tif (stk[tp--] == e.to) return 1;\n\t\t\t}\n\t\t}\n\t\tvis[e.to] = cnt; \n\t\tif (Dfs(e.to,x)) return 1;\n\t}\n\t--tp; return 0;\n}\n\nvoid Solve(int x)\n{\n\tint son = v[x].size(); DB sum = 0.000; vis[x] = ++cnt;\n\tfor (int i = 0; i < v[x].size(); i++)\n\t{\n\t\tE e = v[x][i];\n\t\tif (bo[e.to]) vis[x] = ++cnt; vis[e.to] = cnt;\n\t\tCalc_f(e.to); sum += ((DB)(e.w) + f[e.to]);\n\t}\n\tvis[x] = ++cnt; g[x] = sum / (DB)(son);\n\tfor (int i = 0; i < v[x].size(); i++)\n\t{\n\t\tE e = v[x][i];\n\t\tif (bo[e.to]) continue;\n\t\tvis[e.to] = cnt;\n\t\tDB res = sum - f[e.to] - (DB)(e.w);\n\t\tDB Nex = res / (DB)(son - 1) + (DB)(e.w);\n\t\tCalc_g(e.to,Nex);\n\t}\n}\n\nint getint()\n{\n\tchar ch = getchar(); int ret = 0;\n\twhile (ch < '0' || '9' < ch) ch = getchar();\n\twhile ('0' <= ch && ch <= '9')\n\t\tret = ret*10 + ch - '0',ch = getchar();\n\treturn ret;\n}\n\nint main()\n{\n\t#ifdef DMC\n\t\tfreopen(\"DMC.txt\",\"r\",stdin);\n\t#endif\n\t\n\tn = getint(); m = getint();\n\tfor (int i = 1; i <= m; i++)\n\t{\n\t\tint x = getint(),y,w;\n\t\ty = getint(); w = getint();\n\t\tv[x].push_back(E(y,w));\n\t\tv[y].push_back(E(x,w));\n\t}\n\tif (n == m)\n\t{\n\t\tvis[1] = ++cnt; Dfs(1,0);\n\t\tfor (int i = 1; i <= tot; i++) \n\t\t\tSolve(s[i]);\n\t}\n\telse\n\t{\n\t\tvis[1] = ++cnt; Calc_f(1); \n\t\tvis[1] = ++cnt; Calc_g(1,0);\n\t}\n\tfor (int i = 1; i <= n; i++) Ans += g[i];\n\tprintf(\"%.5f\",Ans / (DB)(n));\n\treturn 0;\n}\n```\n\n",
        "postTime": 1585532307,
        "uid": 271114,
        "name": "panjoel",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2081 \u3010[NOI2012]\u8ff7\u5931\u6e38\u4e50\u56ed\u3011"
    },
    {
        "content": "\u6811dp+\u57fa\u73af\u6811\u3002\n\n\u5982\u679c\u8f93\u5165\u662f\u4e00\u68f5\u6811\u7684\u8bdd(m=n-1)\uff0c\u7528O(n)\u5c31\u53ef\u4ee5\u89e3\u51b3\uff1a\n\n1.\u9996\u5148\u968f\u4fbf\u9009\u62e9\u4e00\u4e2a\u70b9\u505a\u6839\u3002\n\n2.Dfs\n\nsi\u8868\u793ai\u7684\u513f\u5b50\u7ed3\u70b9\uff1b\n\nf[i]\u8868\u793ai\u7ed3\u70b9\u5411\u513f\u5b50\u8d70\u7684\u671f\u671b\u957f\u5ea6\uff1b\n\nd[i]=sigma(f[si]+edge(si,i))\uff1b\n\ndu[i]\u8868\u793ai\u7ed3\u70b9\u7684\u5ea6\u6570\uff0c\u5373\u513f\u5b50\u7684\u4e2a\u6570+1\uff08\u7236\u4eb2\uff09\uff1b\n\n\u663e\u7136\uff0cf[i]=d[i]/(du[i]-1)\u3002\n\n\u6211\u4eec\u505a\u6811\u5f62dp\u5c31\u53ef\u4ee5\u628af[],d[],du[]\u6570\u7ec4\u90fd\u6c42\u51fa\u6765\u3002\n\n3.Dfs2\n\n\u90a3\u4e48\u63a5\u4e0b\u6765\u8981\u6c42\u7684\u662fi\u7ed3\u70b9\u8d70\u5411\u4efb\u610f\u4e00\u4e2a\u53f6\u5b50\u7ed3\u70b9\u7684\u671f\u671b\u957f\u5ea6\uff0c\u5df2\u7ecf\u6c42\u4e86\u8d70\u5411\u513f\u5b50\u7684\u671f\u671b\u957f\u5ea6\uff0c\u8fd8\u9700\u6c42\u7684\u662f\u8d70\u5411\u7236\u4eb2\u7684\u671f\u671b\u957f\u5ea6p[i]\u3002\n\np[root]=f[root]\u3002\n\n\u63a5\u4e0b\u6765dfs\uff0cdfs(i)\u7684\u65f6\u5019\u4ed6\u7684\u7236\u4eb2x\u7684p[x]\u5df2\u7ecf\u6c42\u51fa\uff0c\u90a3\u4e48\uff1a\n\nd[i]+=(d[x]-y[i]-edge(x,i))/(du[x]-1)+edge(x,i)\n\np[i]=d[i]/du[i]\u3002\n\n\u4e00\u6b21dfs\u4e4b\u540e\u6240\u6709\u70b9\u7684p[]\u5c31\u6c42\u51fa\u6765\u4e86\u3002\n\n\u5982\u679c\u662fm=n\u5462\uff1f\n\n\u90a3\u4e48\u4ed6\u662f\u4e00\u68f5\u57fa\u73af\u6811\u5373\u8fd9\u68f5\u6811\u4e2d\u6709\u4e14\u4ec5\u6709\u4e00\u4e2a\u73af\u3002\n\n------------\n\n1.Findcir\n\n\u5148\u627e\u5230\u8fd9\u4e2a\u73af\u3002\n\n2.Dfs\n\n\u4ee5\u73af\u4e0a\u7684\u6bcf\u4e00\u4e2a\u70b9\u4e3a\u6839\uff0c\u505am=n-1\u65f6\u7684\u7b2c\u4e8c\u6b65\u6c42\u51fa\u6bcf\u4e2a\u70b9\u7684d[],f[]\u3002\n\n3.Calc\n\n\u56e0\u4e3a\u6709\u73af\uff0c\u6240\u4ee5\u73af\u4e0a\u6bcf\u4e2a\u7ed3\u70b9\u7684f[i]\u5e76\u4e0d\u7b49\u4e8ep[i]\u3002\n\n\u90a3\u4e48\u6211\u4eec\u9700\u8981\u679a\u4e3e\u73af\u4e0a\u7684\u6bcf\u4e2a\u70b9\uff0c\u8ba1\u7b97\u4ece\u8fd9\u4e2a\u70b9\u51fa\u53d1\u6cbf\u7740\u73af\u8d70\u7684\u671f\u671b\u957f\u5ea6\u3002\n\n\u6ce8\u610f\u73af\u4e0a\u7684\u70b9\u5ea6\u6570\u8981\u52a02\u3002\n\n4.Dfs2\n\n\u6b64\u65f6\u73af\u4e0a\u6bcf\u4e2a\u70b9\u7684d[i]/du[i]=p[i]\uff0c\u7136\u540e\u6309\u7167m=n-1\u65f6\u7684\u7b2c\u4e8c\u6b65\u8ba1\u7b97\u975e\u73af\u4e0a\u7684\u70b9\u7684p[i]\u5373\u53ef\u3002\n```cpp\n#include <iostream>\n#include <cstring>\n#include <algorithm>\n#include <cstdio>\n#include <cstdlib>\n#define M 100005\n#define ld long double\nusing namespace std;\nint fa[M],c[M],v[M],tot=0,n,m,du[M],now=0,h[M],root;\nld g[M],f[M],d[M],gg[M];\nstruct edge\n{\n\tint y,ne,l;\n}e[M*5];\nvoid Addedge(int x,int y,int l)\n{\n\ttot++;\n\te[tot].y=y;\n\te[tot].ne=h[x];\n\te[tot].l=l;\n\th[x]=tot;\n}\nvoid Dfs(int x)\n{\n\td[x]=f[x]=0.000;\n\tv[x]=1;\n\tdu[x]=0;\n\tfor (int i=h[x];i;i=e[i].ne)\n\t{\n\t\tint y=e[i].y;\n\t\tif (v[y]||c[y]) continue;\n\t\tDfs(y);\n\t\tdu[x]++;\n\t\td[x]=d[x]+f[y]+(ld)e[i].l;\n\t}\n\tif (du[x]) f[x]=d[x]/(ld)du[x];\n\tif (x!=root) du[x]++;\n}\nvoid Dfs2(int x)\n{\n\tv[x]=1;\n\tfor (int i=h[x];i;i=e[i].ne)\n\t{\n\t\tint y=e[i].y;\n\t\tif (v[y]||c[y]) continue;\n\t\tint k=du[x]-1;\n\t\tif (!k) k++;\n\t\td[y]=d[y]+(d[x]-f[y]-(ld)e[i].l)/(ld)(k)+(ld)e[i].l;\n\t\tDfs2(y);\n\t}\n}\nvoid Findcir(int x)\n{\n\tv[x]=++now;\n\tfor (int i=h[x];i;i=e[i].ne)\n\t{\n\t\tint y=e[i].y;\n\t\tif (!v[y])\n\t\t{\n\t\t\tfa[y]=x;\n\t\t\tFindcir(y);\n\t\t}\n\t\telse if (y!=fa[x]&&v[y]<v[x])\n\t\t{\n\t\t\tc[y]=1;\n\t\t\twhile (x!=y)\n\t\t\t{\n\t\t\t\tc[x]=1;\n\t\t\t\tx=fa[x];\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t}\n}\nvoid Calc(int x,int fa)\n{\n\tbool last=true;\n\tg[x]=0.000;\n\tfor (int i=h[x];i;i=e[i].ne)\n\t{\n\t\tint y=e[i].y;\n\t\tif (y!=root&&y!=fa&&c[y])\n\t\t{\n\t\t\tlast=false;\n\t\t\tCalc(y,x);\n\t\t\tg[x]=g[x]+g[y]+(ld)e[i].l;\n\t\t}\n\t}\n\tint k=du[x];\n\tif (!k) k++;\n\tif (last) g[x]=d[x]/(ld)k;\n\telse \n\t{\n\t\tk=du[x]+1;\n\t\tif (x!=root)\n\t\t\tg[x]=(g[x]+d[x])/(ld)k;\n\t\telse \n\t\t{\n\t\t\treturn;\n\t\t}\n\t}\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&m);\n\tfor (int i=1;i<=m;i++)\n\t{\n\t\tint x,y,l;\n\t\tscanf(\"%d%d%d\",&x,&y,&l);\n\t\tAddedge(x,y,l);\n\t\tAddedge(y,x,l);\n\t}\n\tif (n==m+1)\n\t{\n\t\troot=1;\n\t\tDfs(1);\n\t\tfor (int i=1;i<=n;i++)\n\t\t\tv[i]=0;\n\t\tDfs2(1);\n\t}\n\telse\n\t{\n\t\tFindcir(1);\n\t\tfor (int i=1;i<=n;i++)\n\t\t\tv[i]=0;\n\t\tfor (int i=1;i<=n;i++)\n\t\t\tif (c[i]) root=i,Dfs(i);\n\t\tfor (int i=1;i<=n;i++)\n\t\t\tif (c[i]) root=i,Calc(i,0),gg[i]=g[i];\n\t\tfor (int i=1;i<=n;i++)\n\t\t\tif (c[i]) du[i]+=2,d[i]+=gg[i];\n\t\tfor (int i=1;i<=n;i++)\n\t\t\tv[i]=0;\n\t\tfor (int i=1;i<=n;i++)\n\t\t\tif (c[i]) Dfs2(i);\n\t}\n\tdouble ans=0.000;\n\tfor (int i=1;i<=n;i++)\n\t\tans=ans+d[i]/(ld)du[i];\n\tprintf(\"%.5lf\\n\",ans/(double)n);\n\treturn 0;\n}\n```",
        "postTime": 1560599804,
        "uid": 98954,
        "name": "\u4e0d\u5b58\u5728\u4e4b\u4eba",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2081 \u3010[NOI2012]\u8ff7\u5931\u6e38\u4e50\u56ed\u3011"
    },
    {
        "content": "\n------\nSOL\n=\n\n\u9898\u610f\uff1a\u7ed9\u4e00\u4e2a\u53ef\u80fd\u6709\u4e00\u4e2a\u73af\u7684\u6811\uff0c\u5b9a\u4e49\u4e00\u6761\u5408\u6cd5\u7684\u8def\u5f84\u4e3a\u4ece\u67d0\u4e00\u8d77\u70b9\u51fa\u53d1\uff0c\u968f\u673a\u5728\u672a\u8d70\u8fc7\u7684\u70b9\u4e2d\u9009\u62e9\uff0c\u76f4\u5230\u8d70\u4e0d\u52a8\u3002\u6c42\u4ece\u4efb\u4e00\u70b9\u51fa\u53d1\u7684\u8def\u5f84\u957f\u5ea6\u7684\u671f\u671b\u503c\u3002\n\n//\u57fa\u73af\u6811\u7684\u786e\u4e0d\u9700\u8981\u5b66\u554a\u3002\u3002\u3002\u81ea\u5df1yy\u5c31\u51fa\u6765\u4e86\u3002\n\n----\n\u4e00\u3001\u5148\u5904\u7406\u6811\u4e0a\u7684\u60c5\u51b5\u3002\n\u8fd9\u662f\u4e00\u4e2a\u5f88\u663e\u7136\u7684\u6811\u4e0a\u671f\u671bdp\uff0c\u4f46\u662f\u4e3a\u4e86\u4fdd\u8bc1\u7edf\u8ba1\u7684\u65b9\u6848\u662f\u5408\u6cd5\u7684\uff0c\u6211\u4eec\u8981\u628a\u5411\u4e0a\u8d70\u548c\u5411\u4e0b\u8d70\u4e24\u79cd\u60c5\u51b5\u5206\u5f00\u8ba8\u8bba\u3002\n\n$$dp[u][down]=(\\sum dp[son[u][down])/s[u]$$\n\n\n\n $$dp[u][up]=(dp[fa[u][down]*s[fa[u]]-len[fa[u]][u]-dp[u][down]+dp[fa[u][up])/(s[fa[u]]+1)$$\n$s[u]$:$u$\u7684\u513f\u5b50\u6570\u91cf  \uff0c$dp[u][down]$\u4ece$u$\u5411\u4e0b\u8d70\u7684\u671f\u671b\u503c\u3002\n\n----\n\u4e8c\u3001\u518d\u5904\u7406\u73af\u4e0a\u7684\u60c5\u51b5\u3002\n\u7531\u4e8e\u4ece$i$\u70b9\u51fa\u53d1\u4e0d\u80fd\u56de\u5230\u81ea\u5df1\uff0c\u9996\u5148\u8981\u5206\u6210\u987a\u65f6\u9488\u548c\u9006\u65f6\u9488\uff0c\u5e76\u4e14\u8981\u4ee5\u73af\u4e0a\u6bcf\u4e00\u70b9\u4e3a\u8d77\u70b9\u51fa\u53d1\u8ba8\u8bba\u60c5\u51b5\u3002\u7531\u4e8e\u73af\u4e0a\u70b9\u6570$\\le20$\uff0c\u6781\u7aef\u60c5\u51b5\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$1e5/20*20*20=2e6$ \uff0c\u53ef\u4ee5\u627f\u53d7.\n$$f[u][0]=len[u][v]+f[v][0]$$\n$$tmp[u][0]=(dp[u][0]*s[u]+tmp[v][0]+len[u][v])/(s[u]+1)$$\n\n$f[u]$\u4e3a\u5f53\u524d\u8d77\u70b9\uff0c$tmp[u]$\u4e3a\u4e2d\u95f4\u70b9\u3002\n\n-----\n\u4e09\u3001\u5408\u5e76\u60c5\u51b5\u3002\n\n$$if(!fa[u])\\ now=(f[u][1]+f[u][0]+dp[u][0]*s[u])/(1.0*(s[u]+2));$$\n\t\t\t$$else \\ now=(dp[u][1]+dp[u][0]*s[u])/(1.0*(s[u]+1))$$\n\n----\n\n//DP\u5f0f\u5b50\u5199\u8d77\u6765\u771f\u7d2f\u3002\u3002\n\n----\nCODE\n=\n\n```cpp\n#include<bits/stdc++.h>\n#define pf printf\n#define sf scanf\n#define cs const\n#define ll long long\n#define db double\nusing namespace std;\ncs int N=1e5+10;\ndb f[N][2],dp[N][2],tmp[N][2];\nint n,m,s[N],fa[N],CN,nxt[N<<1],head[N],w[N<<1],to[N<<1],cnt=1,lasw[N],len[N][2],nxtp[N][2];\nbool vis[N],rod[N<<1];\nvector <int> g[N];\ninline void _add(int u,int v,int ww){\n\tnxt[++cnt]=head[u];head[u]=cnt;to[cnt]=v;w[cnt]=ww;\n}\nvoid dfs1(int u){\n\tvis[u]=1;\n\tfor(int i=head[u];i;i=nxt[i]){\n\t\tif(rod[i])continue;\n\t\trod[i]=rod[i^1]=1;\n\t\tif(vis[to[i]]){\n\t\t\tnxtp[to[i]][0]=u;nxtp[u][1]=to[i];\n\t\t\tlen[to[i]][0]=len[u][1]=w[i];\n\t\t\t++CN;\n\t\t\tfor(int v=u;;v=fa[v]){\n\t\t\t\tg[CN].push_back(v);\n\t\t\t\tif(v==to[i])break;\n\t\t\t\tnxtp[v][0]=fa[v];nxtp[fa[v]][1]=v;\n\t\t\t\tlen[v][0]=len[fa[v]][1]=lasw[v];\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tlasw[to[i]]=w[i];\n\t\t\tfa[to[i]]=u;\n\t\t\tdfs1(to[i]);\n\t\t}\n\t}\n}\nvoid dfs(int u,bool kd){\n\tif(kd==1){\n\t\tif(fa[u]){\n\t\t\tif(fa[fa[u]])\n\t\t\t\tdp[u][1]=(dp[fa[u]][0]*s[fa[u]]-dp[u][0]-lasw[u]+dp[fa[u]][1])/(1.0*(s[fa[u]]))+lasw[u];\n\t\t\telse\n\t\t\t\tdp[u][1]=(dp[fa[u]][0]*s[fa[u]]-dp[u][0]-lasw[u]+f[fa[u]][0]+f[fa[u]][1])/(1.0*(s[fa[u]]+1))+lasw[u];\n\t\t}\n\t}\n\tfor(int i=head[u];i;i=nxt[i]){\n\t\tint v=to[i];\n\t\tif(v==fa[u]||vis[v])continue;\n\t\tfa[v]=u;lasw[v]=w[i];\n\t\tdfs(v,kd);\n\t\tif(kd==0){\n\t\t\t++s[u];\n\t\t\tdp[u][0]+=dp[v][0]+w[i];\t\n\t\t}\n\t}\n\tif(kd==0&&s[u])dp[u][0]/=(1.0*(s[u]));\n}\nnamespace work1{\n\tinline void dfs(int u,bool kd){\n\t\tif(kd==1){\n\t\t\tif(fa[u]){\n\t\t\t\tdp[u][1]=lasw[u];\n\t\t\t\tif(fa[fa[u]])\n\t\t\t\t\tdp[u][1]+=(dp[fa[u]][0]*s[fa[u]]-dp[u][0]-lasw[u]+dp[fa[u]][1])/(1.0*(s[fa[u]]));\n\t\t\t\telse\n\t\t\t\t\tif(s[fa[u]]>1)dp[u][1]+=(dp[fa[u]][0]*s[fa[u]]-dp[u][0]-lasw[u])/(1.0*(s[fa[u]]-1));\t\t\t\t\t\t\t\n\t\t\t}\n\t\t}\n\t\tfor(int i=head[u];i;i=nxt[i]){\n\t\t\tint v=to[i];\n\t\t\tif(v==fa[u]||vis[v])continue;\n\t\t\tfa[v]=u;lasw[v]=w[i];\n\t\t\tdfs(v,kd);\n\t\t\tif(kd==0){\n\t\t\t\t++s[u];\n\t\t\t\tdp[u][0]+=dp[v][0]+w[i];\t\n\t\t\t}\n\t\t}\n\t\tif(kd==0&&s[u])dp[u][0]/=(1.0*(s[u]));\n\t}\n\tinline void gather(){\n\t\tdb now=0,ans=0;\n\t\tfor(int u=1;u<=n;++u){\n\t\t\tif(!fa[u])\n\t\t\t\tnow=dp[u][0];\n\t\t\telse\n\t\t\t\tnow=(dp[u][1]+dp[u][0]*s[u])/(1.0*(s[u]+1));\n\t\t\tans+=now/(1.0*n);\n\t\t}\n\t\tpf(\"%.5lf\",ans);\n\t}\t\n}\ninline void calc(int u,cs int &bord,cs int &kd){\n\tif(nxtp[u][kd]==bord){\n\t\ttmp[u][kd]=dp[u][0];\n\t\treturn;\n\t}\n\tcalc(nxtp[u][kd],bord,kd);\n\tif(u^bord)tmp[u][kd]=(dp[u][0]*s[u]+len[u][kd]+tmp[nxtp[u][kd]][kd])/(1.0*(s[u]+1));\n\telse f[u][kd]=len[u][kd]+tmp[nxtp[u][kd]][kd];\n}\ninline void gather(){\n\tdb now=0,ans=0;\n\tfor(int u=1;u<=n;++u){\n\t\tif(!fa[u])\n\t\t\tnow=(f[u][1]+f[u][0]+dp[u][0]*s[u])/(1.0*(s[u]+2));\n\t\telse\n\t\t\tnow=(dp[u][1]+dp[u][0]*s[u])/(1.0*(s[u]+1));\n\t\t//cout<<u<<' '<<now<<'\\n';\n\t\tans+=now/(1.0*n);\n\t}\n\tpf(\"%.5lf\",ans);\n}\nsigned main (){\n//\tfreopen(\"data.in\",\"r\",stdin);\n\tsf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=m;++i){\n\t\tint u,v,w;sf(\"%d%d%d\",&u,&v,&w);\n\t\t_add(u,v,w);_add(v,u,w);\n\t}\n\tif(m^n){\n\t\twork1::dfs(1,0);\n\t\twork1::dfs(1,1);\n\t\twork1::gather();\n\t\treturn 0;\n\t}\t\n\tfor(int u=1;u<=n;++u)if(!vis[u])dfs1(u);\n\tmemset(vis,0,sizeof vis);\n\tfor(int i=1;i<=CN;++i){\n\t\tint up=g[i].size();\n\t\tfor(int j=0;j<up;++j){\n\t\t\tfa[g[i][j]]=0;vis[g[i][j]]=1;\n\t\t}\n\t\tfor(int j=0;j<up;++j){\n\t\t\tdfs(g[i][j],0);\n\t\t}\n\t\tfor(int j=0;j<up;++j){\n\t\t\tcalc(g[i][j],g[i][j],0);\n\t\t\tcalc(g[i][j],g[i][j],1);\n\t\t\tdfs(g[i][j],1);\n\t\t}\n\t}\n\tgather();\n\treturn 0;\n}\n```\n\n\n\n\n\n\n\n\n",
        "postTime": 1564932164,
        "uid": 117357,
        "name": "rhjoi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2081 \u3010[NOI2012]\u8ff7\u5931\u6e38\u4e50\u56ed\u3011"
    }
]