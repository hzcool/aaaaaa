[
    {
        "content": "\u9898\u76ee\u5927\u610f\uff1a\u7ed9\u5b9a\u4e00\u4e2an\u00d7m\u7684\u77e9\u9635\uff0c\u77e9\u9635\u4e2d\u4e0d\u91cd\u4e0d\u6f0f\u5730\u5206\u5e03\u77400~n\u00d7m-1\u7684\u5143\u7d20\u3002\u79f0\u4e00\u4e2a\u5927\u5c0f\u4e3as\u7684\u8fde\u7eed\u5b50\u77e9\u9635\u662f\u597d\u7684\u5f53\u4e14\u4ec5\u5f53\u5176\u4e2d\u4e0d\u91cd\u4e0d\u6f0f\u5730\u51fa\u73b0\u4e860~s-1\u7684\u5143\u7d20\u3002\u6bcf\u6b21\u4ea4\u6362\u77e9\u9635\u4e2d\u7684\u4e24\u4e2a\u5143\u7d20\uff0c\u67e5\u8be2\u5f53\u524d\u6709\u591a\u5c11\u4e2a\u597d\u7684\u5b50\u77e9\u9635\u3002\u5f3a\u5236\u5728\u7ebf\u3002\n\n\u8fd9\u9898\u5bb9\u6613\u7ed9\u4eba\u4e00\u79cd\u5947\u6280\u6deb\u5de7\u7684\u6570\u636e\u7ed3\u6784\u7684\u611f\u89c9\u3002\u90a3\u4e48\u5230\u5e95\u8be5\u7528\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\uff0c\u7ef4\u62a4\u4ec0\u4e48\u4fe1\u606f\uff1f\n\n\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u7ef4\u62a4\u524di\u4e2a\u5143\u7d20\u5728\u77e9\u9635\u4e2d\u4f4d\u7f6e\u5206\u5e03\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u6765\u68c0\u9a8c\u524di\u4e2a\u5143\u7d20\u662f\u5426\u80fd\u7ec4\u6210\u5408\u6cd5\u5b50\u77e9\u9635\u3002\n\n\u5f00\u4e00\u68f5\u7ebf\u6bb5\u6811\uff0c\u5176\u4e0b\u6807\u4e3ai\u7684\u4f4d\u7f6e\u7ef4\u62a4\u7684\u662f\u524di\u4e2a\u5143\u7d20\u7684\u4fe1\u606f\u3002\n\n\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u4ec0\u4e48\u4fe1\u606f\uff0c\u80fd\u591f\u652f\u6301\u4fee\u6539\u548c\u5feb\u901f\u8ba1\u7b97\u7b54\u6848\uff1f\n\n\u8fd9\u786e\u5b9e\u662f\u4e00\u4e2a\u68d8\u624b\u7684\u95ee\u9898\u3002\u4f30\u8ba1ioi\u73b0\u573a\u5e94\u8be5\u5f88\u591a\u4eba\u90fd\u8dea\u5728\u8fd9\u4e00\u6b65\u4e86\u3002\n\n\u6211\u4e00\u5f00\u59cb\u7684\u60f3\u6cd5\u662f\uff0c\u7ef4\u62a4\u524di\u4e2a\u5143\u7d20\u6240\u7ec4\u6210\u7684\u56fe\u5f62\u7684\u5468\u957f\u3002\u540e\u6765\u53d1\u73b0\u636e\u6b64\u5e76\u4e0d\u80fd\u76f4\u63a5\u8ba1\u7b97\u7b54\u6848\uff08\u4e00\u4e2a\u5927\u5c0f\u4e00\u5b9a\u7684\u77e9\u5f62\u5176\u5468\u957f\u4e5f\u53ef\u80fd\u6709\u591a\u79cd\u53ef\u80fd\uff09\uff0c\u9042\u653e\u5f03\u3002\n\n\u540e\u6765\u6211\u60f3\u5230\u4e00\u79cd\u201c\u770b\u4f3c\u53ef\u884c\u201d\u7684\u601d\u8def\uff1a\u7ef4\u62a4\u524di\u4e2a\u5143\u7d20\u7684x\u3001y\u5750\u6807\u7684\u6700\u5c0f\u503c\u548c\u6700\u5927\u503c\uff0c\u8fd9\u6837\u524di\u4e2a\u5143\u7d20\u7ec4\u6210\u5408\u6cd5\u5b50\u77e9\u5f62\u5f53\u4e14\u4ec5\u5f53(xmax - xmin + 1) \u00d7 (ymax - ymin + 1) = s\u3002\n\n\u8fd9\u6837\u6211\u4eec\u5c06\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u503c\u8bbe\u4e3a(xmax - xmin + 1) \u00d7 (ymax - ymin + 1) - i\uff0c\u8fd9\u4e2a\u6570\u4e00\u5b9a\u975e\u8d1f\uff0c\u5f53\u4e14\u4ec5\u5f53\u5b83\u4e3a0\u65f6\u7b54\u6848\u5408\u6cd5\u3002\n\n\u7136\u800c\u8fd9\u4e2a\u60f3\u6cd5\u5728\u4fee\u6539\u65f6\u9047\u5230\u4e86\u9ebb\u70e6\uff1a\u4ea4\u6362\u4e24\u4e2a\u5143\u7d20\uff0c\u53ef\u80fd\u5bfc\u81f4\u4e00\u4e2a\u533a\u95f4\u7684max\u548cmin\u503c\u53d1\u751f\u5927\u89c4\u6a21\u53d8\u5316\uff0c\u5c24\u5176\u662f\u5f53\u628a\u539f\u6765\u7684\u6700\u503c\u79fb\u52a8\u5230\u540e\u9762\u65f6\uff0c\u53ef\u80fd\u9020\u6210\u533a\u95f4\u5185\u6700\u503c\u7684\u591a\u6b21\u6539\u53d8\uff0c\u6211\u4eec\u53ef\u80fd\u9762\u4e34\u6bcf\u6b21\u64cd\u4f5cO(n)\u6b21\u4fee\u6539\u3002\n\n\u76ee\u524d\u6211\u8fd8\u6ca1\u6709\u60f3\u5230\u5408\u9002\u7684\u65b9\u6cd5\u6765\u7ef4\u62a4\u8fd9\u4e2a\u4e1c\u897f\uff0c\u5982\u679c\u6709\u5927\u795e\u4f1a\u7ef4\u62a4\u7684\u8bdd\u9ebb\u70e6\u5728\u8bc4\u8bba\u4e2d\u7559\u8a00\u8c22\u8c22\u3002\n\n\u90a3\u600e\u4e48\u529e\uff1f\u6211\u4eec\u6709\u4e00\u4e2a\u7edd\u5999\u7684\u601d\u8def\uff1a\u901a\u8fc7\u7ef4\u62a4\u201c\u7279\u6b8a\u70b9\u201d\u7684\u4fe1\u606f\u6765\u5b9e\u73b0\u5feb\u901f\u4fee\u6539\u548c\u5224\u65ad\u5408\u6cd5\u6027\u7684\u76ee\u7684\uff01\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u73b0\u5728\u5bf9\u4e8e\u4e00\u4e2a\u4f4d\u7f6ei\uff0c\u5c06\u524di\u4e2a\u70b9\u67d3\u6210\u9ed1\u8272\uff0c\u540e\u9762\u7684\u70b9\u4e3a\u767d\u8272\u3002\n\n\u6211\u4eec\u7ef4\u62a4\u8fd9\u4e48\u4e24\u4e2a\u4e1c\u897f\uff1a\n\n1\u3001\u6240\u6709\u7684\u9ed1\u70b9\u4e2d\uff0c\u6709\u591a\u5c11\u4e2a\u70b9\u7684\u5de6\u4fa7\u548c\u4e0a\u4fa7\u90fd\u4e0d\u6328\u7740\u9ed1\u70b9\uff08\u53ef\u80fd\u662f\u767d\u70b9\u6216\u8fb9\u7f18\uff09\u3002\n\n2\u3001\u6240\u6709\u7684\u767d\u70b9\u4e2d\uff0c\u6709\u591a\u5c11\u4e2a\u70b9\u7684\u5468\u56f4\u56db\u8fde\u901a\u5730\u6328\u7740\u8d85\u8fc72\u4e2a\u9ed1\u70b9\u3002\n\n\u8fd9\u4e24\u4e2a\u4fe1\u606f\u80fd\u8bf4\u660e\u4ec0\u4e48\uff1f\n\n\u9996\u5148\uff0c\u5bb9\u6613\u8bc1\u660e\u6240\u6709\u7684\u5408\u6cd5\u5b50\u77e9\u9635\u90fd\u6ee1\u8db3\uff1a\u7b2c\u4e00\u4e2a\u4fe1\u606f\u4e3a1\uff0c\u7b2c\u4e8c\u4e2a\u4fe1\u606f\u4e3a0\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u8bc1\u660e\uff1a\u4e00\u4e2a\u975e\u6cd5\u7684\u56fe\u5f62\u4e0d\u53ef\u80fd\u540c\u65f6\u6ee1\u8db3\u4ee5\u4e0a\u4e24\u4e2a\u6761\u4ef6\u3002\n\n\u5bb9\u6613\u770b\u51fa\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u9ed1\u70b9\u7ec4\u6210\u7684\u56db\u8fde\u901a\u5757\uff0c\u6211\u4eec\u603b\u80fd\u9009\u51fa\u5176\u6700\u5de6\u4e0a\u7684\u70b9\uff08\u81f3\u5c11\u4e00\u4e2a\uff0c\u4e5f\u53ef\u80fd\u4e00\u4e2a\u8fde\u901a\u5757\u4e2d\u6709\u591a\u4e2a\u5408\u6cd5\u70b9\uff09\uff0c\u4f7f\u5f97\u5b83\u7684\u5de6\u8fb9\u548c\u4e0a\u8fb9\u90fd\u4e0d\u662f\u9ed1\u70b9\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u9ed1\u8272\u8fde\u901a\u5757\u6570\u91cf<=\u4fe1\u606f1\u3002\n\n\u56e0\u6b64\uff0c\u4e00\u4e2a\u6709>=2\u4e2a\u8fde\u901a\u5757\u7684\u56fe\u5f62\u4e0d\u53ef\u80fd\u6ee1\u8db3\u4fe1\u606f1\u6570\u91cf\u4e3a1\u3002\n\n\u518d\u6765\u8003\u8651\u4e00\u4e2a\u8fde\u901a\u5757\u4f46\u4e0d\u662f\u77e9\u5f62\u7684\u56fe\u5f62\u3002\u5bb9\u6613\u53d1\u73b0\u8fd9\u4e2a\u56fe\u5f62\u4e00\u5b9a\u5b58\u5728\u5982\u4e0b\u7684\u201c\u62d0\u89d2\u201d\uff1a\n\nxxoo\n\nxxoo\n\nxxxx\n\nxxxx\n\nx\u8868\u793a\u9ed1\u70b9\uff0co\u8868\u793a\u767d\u70b9\uff0c2\u884c3\u5217\u90a3\u4e2a\u767d\u70b9\u5c31\u662f\u201c\u62d0\u89d2\u201d\u3002\u800c\u5728\u62d0\u89d2\u5904\u7684\u767d\u70b9\u6ee1\u8db3\u4fe1\u606f2\u3002\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b58\u5728\u62d0\u89d2\u7684\u56fe\u5f62\u4e0d\u53ef\u80fd\u6ee1\u8db3\u4fe1\u606f2\u6570\u91cf\u4e3a0\u3002\n\n\u90a3\u4e48\u540c\u65f6\u6ee1\u8db31\u548c2\u7684\u56fe\u5f62\uff0c\u5c31\u53ea\u6709\u201c\u4e00\u4e2a\u8fde\u901a\u5757\u4e14\u4e0d\u5b58\u5728\u62d0\u89d2\u201d\u7684\u56fe\u5f62\u4e86\u2014\u2014\u4e5f\u5c31\u662f\u77e9\u5f62\uff01\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u8bc1\u660e\u4e86\u6761\u4ef6\u7684\u5145\u8981\u6027\u3002\u90a3\u4e48\u600e\u4e48\u7ef4\u62a4\u5462\uff1f\n\n\u6211\u4eec\u76f4\u63a5\u7ef4\u62a4\u4e24\u4e2a\u4fe1\u606f\u7684\u548c\uff08\u8fd9\u4e2a\u548c\u663e\u7136\u662f\u6b63\u6574\u6570\uff09\uff0c\u7136\u540e\u7edf\u8ba1\u6709\u591a\u5c11\u4e2a\u4f4d\u7f6e\u7b54\u6848\u4e3a1\u3002\n\n\u4ea4\u6362\u4e24\u4e2a\u4f4d\u7f6e\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u9884\u5236\u76f8\u90bb\u7684\u6240\u6709\u4f4d\u7f6e\u90fd\u62ff\u51fa\u6765\uff08\u6700\u591a\u4e0d\u8d85\u8fc710\u4e2a\uff0c\u6ce8\u610f\u53bb\u91cd\uff09\uff0c\u7136\u540e\u66b4\u529b\u5730\u5bf9\u6bcf\u4e2a\u4f4d\u7f6e\uff0c\u5148\u6263\u53bb\u539f\u6765\u5bf9\u4fe1\u606f\u7684\u8d21\u732e\uff0c\u518d\u52a0\u4e0a\u64cd\u4f5c\u540e\u5bf9\u4fe1\u606f\u7684\u8d21\u732e\u3002\u5bf9\u5e94\u5728\u7ebf\u6bb5\u6811\u4e0a\u5c31\u662fO(1)\u6b21\u533a\u95f4\u4fee\u6539\u3002\n\n\u81f3\u4e8e\u67e5\u8be2\u533a\u95f4\u6709\u591a\u5c11\u4e2a1\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u7c7b\u4f3c\u7ef4\u62a4\u77e9\u5f62\u9762\u79ef\u5e76\u7684\u65b9\u5f0f\uff0c\u8bb0\u5f55\u533a\u95f4\u6700\u5c0f\u503c\u548c\u6700\u5c0f\u503c\u7684\u4e2a\u6570\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u6210\u529f\u5730\u7528\u4e5d\u7701\u7701\u9009\u96be\u5ea6\u7684\u6570\u636e\u7ed3\u6784\u89e3\u51b3\u4e86\u8fd9\u9053\u96be\u9898\uff01\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define gc getchar()\n#define pc putchar\n#define li long long\nli read(){\n\tli x = 0,y = 0,c = gc;\n\twhile(!isdigit(c)) y = c,c = gc;\n\twhile(isdigit(c)) x = (x << 1) + (x << 3) + (c ^ '0'),c = gc;\n\treturn y == '-' ? -x : x;\n}\nvoid print(li q){\n\tif(q < 0) pc('-'),q = -q;\n\tif(q >= 10) print(q / 10);\n\tpc(q % 10 + '0');\n}\nint n,m,p,k,jz[1000010],vl[1000010];\nstruct wz{\n\tint x,y;\n}a[1000010];\nint t[4000010],s[4000010],c[4000010];\n#define ls q << 1\n#define rs q << 1 | 1\n#define ln ls,l,mid\n#define rn rs,mid + 1,r\n#define md int mid = l + r >> 1\nvoid build(int q,int l,int r){\n\tif(l == r){\n\t\tt[q] = vl[l];s[q] = 1;return;\n\t}\n\tmd;\n\tbuild(ln);build(rn);\n\tt[q] = min(t[ls],t[rs]);\n\ts[q] = 0;if(t[q] == t[ls]) s[q] += s[ls];if(t[q] == t[rs]) s[q] += s[rs];\n}\ninline void ps(int q){\n\tt[ls] += c[q];c[ls] += c[q];\n\tt[rs] += c[q];c[rs] += c[q];\n\tc[q] = 0;\n}\nvoid ins(int q,int l,int r,int al,int ar,int x){\n\tif(al > ar) return;\n\tif(l >= al && r <= ar){\n\t\tt[q] += x;c[q] += x;return;\n\t}\n\tps(q);md;\n\tif(mid >= al) ins(ln,al,ar,x);\n\tif(mid < ar) ins(rn,al,ar,x);\n\tt[q] = min(t[ls],t[rs]);\n\ts[q] = 0;if(t[q] == t[ls]) s[q] += s[ls];if(t[q] == t[rs]) s[q] += s[rs];\n}\nint dx[4] = {0,-1,0,1},dy[4] = {-1,0,1,0};\n#define mt(x,y) jz[(x - 1) * m + (y)]\n#define lx(x) (x + dx[0])\n#define ux(x) (x + dx[1])\n#define fx(x,i) (x + dx[i])\n#define fy(x,i) (x + dy[i])\n#define ly(x) (x + dy[0])\n#define uy(x) (x + dy[1])\n#define chk(x,y) (x >= 1 && x <= n && y >= 1 && y <= m)\n#define ax(q) a[q].x\n#define ay(q) a[q].y\n#define qwq(x,y) mt(fx(ax(x),y),fy(ay(x),y))\ninline int ed(int q){//\u201c\u9ed1\u683c\u5de6\u4e0a\u201d\u6027\u8d28\u7ed3\u675f\u7684\u65f6\u95f4 \n\tint mn = p + 1;\n\tif(chk(lx(ax(q)),ly(ay(q)))) mn = min(mn,qwq(q,0));\n\tif(chk(ux(ax(q)),uy(ay(q)))) mn = min(mn,qwq(q,1));\n\treturn mn;\n}\ninline int bg(int q){//\u201c\u767d\u683c\u76f8\u90bb\u201d\u6027\u8d28\u5f00\u59cb\u7684\u65f6\u95f4 \n\tint mn1 = p + 1,mn2 = p + 1;\n\tfor(int i = 0;i < 4;++i) if(chk(fx(ax(q),i),fy(ay(q),i))){\n\t\tif(qwq(q,i) < mn1) mn2 = mn1,mn1 = qwq(q,i);\n\t\telse if(qwq(q,i) < mn2) mn2 = qwq(q,i);\n\t} \n\treturn mn2;\n}\nint st[15],ft;\nint main(){\n\tint i,j,u,v;\n\tn = read();m = read();k = read();p = n * m;\n\tfor(i = 1;i <= p;++i){\n\t\ta[i].x = read() + 1;a[i].y = read() + 1;mt(ax(i),ay(i)) = i;\n\t}\n\tfor(i = 1;i <= p;++i){\n\t\tvl[i] = vl[i - 1];\n\t\tif(bg(i) < i) --vl[i];\n\t\tif(ed(i) > i) ++vl[i];\n\t\tfor(j = 0;j < 4;++j) if(chk(fx(ax(i),j),fy(ay(i),j))){\n\t\t\tif(qwq(i,j) < i && ed(qwq(i,j)) == i) --vl[i];\n\t\t\telse if(qwq(i,j) > i && bg(qwq(i,j)) == i) ++vl[i];\n\t\t}\n\t}\n\tbuild(1,1,p);\n\tfor(i = 1;i <= k;++i){\n\t\tu = read() + 1;v = read() + 1;if(u > v) swap(u,v);\n\t\tif(u == v){\n\t\t\tprint(s[1]);pc('\\n');continue;\n\t\t}\n\t\tft = 0;\n\t\tst[++ft] = u;st[++ft] = v;\n\t\tfor(j = 0;j < 4;++j) if(chk(fx(ax(u),j),fy(ay(u),j))) st[++ft] = qwq(u,j);\n\t\tfor(j = 0;j < 4;++j) if(chk(fx(ax(v),j),fy(ay(v),j))) st[++ft] = qwq(v,j);\n\t\tsort(st + 1,st + ft + 1);\n\t\tfor(j = 1;j <= ft;++j) if(st[j] != st[j - 1]){\n\t\t\tif(bg(st[j]) < st[j]) ins(1,1,p,max(bg(st[j]),u),min(st[j],v) - 1,-1);\n\t\t\tif(ed(st[j]) > st[j]) ins(1,1,p,max(st[j],u),min(ed(st[j]),v) - 1,-1);\n\t\t}\n\t\tswap(mt(ax(u),ay(u)),mt(ax(v),ay(v)));swap(a[u],a[v]);\n\t\tfor(j = 1;j <= ft;++j) if(st[j] != st[j - 1]){\n\t\t\tif(bg(st[j]) < st[j]) ins(1,1,p,max(bg(st[j]),u),min(st[j],v) - 1,1);\n\t\t\tif(ed(st[j]) > st[j]) ins(1,1,p,max(st[j],u),min(ed(st[j]),v) - 1,1);\n\t\t}\n\t\tprint(s[1]);pc('\\n');\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1539165958,
        "uid": 45775,
        "name": "liuzhangfeiabc",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4898 \u3010[IOI2018] seats \u6392\u5ea7\u4f4d\u3011"
    },
    {
        "content": "[$\\text{Link}$](https://www.luogu.com.cn/problem/P4898)\n#### \u524d\u8a00\n\u8fd9\u9053\u9898\u5e76\u4e0d\u662f\u6211\u81ea\u5df1\u601d\u8003\u51fa\u6765\u7684\uff0c\u800c\u662f\u501f\u52a9\u4e86\u5176\u4f59\u9898\u89e3\u7684\u5e2e\u52a9\u3002\n\n\u5199\u8fd9\u4e2a\u9898\u89e3\u4e3b\u8981\u4e3a\u4e86\u52a0\u6df1\u7406\u89e3\uff0c\u60f3\u4e0d\u770b\u9898\u89e3\u81ea\u5df1\u5199\u4e00\u904d\u51fa\u6765\uff0c\u786e\u8ba4\u81ea\u5df1\u5df2\u7ecf\u61c2\u4e86\u8fd9\u9053\u9898\u3002\u60a8\u53ef\u4ee5\u5c06\u8fd9\u7bc7\u9898\u89e3\u770b\u6210\u6211\u7684\u505a\u9898\u8bb0\u5f55\u3002\n\n\u5c3d\u53ef\u80fd\u5730\u5199\u5f97\u6e05\u6670\u4e00\u4e9b\uff0c\u54ea\u90e8\u5206\u770b\u4e0d\u61c2\u53ef\u4ee5\u7559\u8a00\u63d0\u9192\u3002\n\n$\\text{Update 2022.6.29}$\uff1a\u4fee\u6b63\u4e00\u5904\u7b14\u8bef\u3002\n## \u9898\u610f\n\u6709\u4e00\u4e2a $n\\times m$ \u7684\u70b9\u6784\u6210\u7684 $n\\times m$ \u7684\u77e9\u9635\uff0c\u8bbe $S(i)$ \u8868\u793a\u7f16\u53f7\u4e3a $1$ \u81f3 $i$ \u7684\u70b9\u662f\u5426\u6784\u6210\u77e9\u5f62\uff0c$q$ \u6b21\u64cd\u4f5c\uff0c\u6bcf\u6b21\u4ea4\u6362\u4e24\u4e2a\u7f16\u53f7\u7684\u70b9\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u6c42\u51fa $|\\{i|S(i)\\}|$\u3002\n\n$1\\le n\\times m\\le 10^6,1\\leq q\\le5\\times 10^4$.\n## \u601d\u8def\n#### $\\text{Section 1}$ \u8f6c\u5316\n\u9996\u5148\u6211\u4eec\u601d\u8003\u600e\u4e48\u5bf9\u4e8e\u4e00\u4e2a $i$ \u6c42\u51fa $S(i)$\u3002\n\n\u4e0e\u5176\u4ed6\u9898\u89e3\u4e00\u6837\uff0c\u6211\u4eec\u5c06\u524d $i$ \u4e2a\u70b9\u67d3\u4e3a\u9ed1\u8272\uff0c\u5176\u4f59\u67d3\u6210\u767d\u8272\u3002\n\n\u6211\u4eec\u8003\u8651\u4f7f\u7528\u67d3\u51fa\u6765\u7684\u989c\u8272\u8bbe\u8ba1\u51fa $S(i)$ \u4e3a\u771f\u7684\u5145\u8981\u6761\u4ef6\u3002\n\n\u6210\u4e3a\u77e9\u5f62\u7684\u5145\u8981\u6761\u4ef6\u6709\uff1a\n\n- \u70b9\u5904\u4e8e\u4e00\u4e2a\u8fde\u901a\u5757\u5185\n- \u56fe\u5f62\u4e0d\u5b58\u5728\u201c$\\text{L}$ \u578b\u201d\u3002\n\n\u5bf9\u4e8e\u6761\u4ef6 $1$\uff0c\u6211\u4eec\u6709\uff1a\n\n- \u5bf9\u4e8e\u6240\u6709\u9ed1\u70b9\uff0c\u5176\u5de6\u4e0a\u65b9\u4e24\u70b9\u4e2d\u5747\u4e0d\u4e3a\u9ed1\u8272\u7684\u70b9\u6570\u4e3a $1$\u3002\n\n\u5bf9\u4e8e\u6761\u4ef6 $2$\uff0c\u6211\u4eec\u6709\uff1a\n\n- \u5bf9\u4e8e\u6240\u6709\u767d\u70b9\uff0c\u4e0e\u5176\u56db\u8fde\u901a\u7684\u70b9\u5185\u6709\u4e0d\u5c11\u4e8e\u4e24\u4e2a\u9ed1\u70b9\u7684\u4e2a\u6570\u4e3a $0$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u4f9d\u6b21\u8ba1\u7b97\u3002\n#### $\\text{Section 2}$ \u4f18\u5316\n\u6211\u4eec\u8bbe\u70b9 $(i,j)$ \u7684\u7f16\u53f7\u4e3a $num_{(i,j)}$\uff0c\u7f16\u53f7\u4e3a $i$ \u7684\u70b9\u4e3a $(x_i,y_i)$\u3002\n\n\u8003\u8651\u5bf9\u4e8e $\\text{Section 1}$ \u7684\u7b97\u6cd5\u5c06 $i$ \u7531 $1$ \u679a\u4e3e\u5230 $n\\times m$\uff0c\u5219 $(i,j)$ \u88ab\u67d3\u4e3a\u9ed1\u8272\u7684\u65f6\u95f4\u70b9\u4e3a $num_{(i,j)}$\u3002\n\n\u6211\u4eec\u8003\u8651\u5bf9\u4e8e\u70b9 $(a,b)$\uff0c\u5176\u6ee1\u8db3\u6761\u4ef6 $1$\u3001$2$ \u7684\u65f6\u95f4\u6bb5\u3002\n\n\u8bbe $i$ \u4e3a\u5f53\u524d\u65f6\u95f4\u70b9\u3002\n\n\u6b64\u5904\u6211\u4eec\u4e0d\u8003\u8651\u8fb9\u7f18\u60c5\u51b5\u3002\n\n\u82e5\u6ee1\u8db3\u6761\u4ef6 $1$\uff0c\u5219\uff1a\n\n- $(a,b)$ \u662f\u9ed1\u70b9\uff0c\u5373 $num_{(a,b)}\\le i$\uff1b\n- $(a,b)$ \u5de6\u65b9\u662f\u767d\u70b9\uff0c\u5373 $num_{(a-1,b)}>i$ ;\n- $(a,b)$ \u4e0a\u65b9\u662f\u767d\u70b9\uff0c\u5373 $num_{(a,b-1)}>i$\u3002\n\n\u5bf9\u8fd9\u4e9b\u6761\u4ef6\u53d6\u5e76\u96c6\uff0c\u5373 $i\\in[num_{(a,b)},\\min(num_{(a-1,b)},num_{(a,b-1)}))$\u3002\n\n\u82e5\u6ee1\u8db3\u6761\u4ef6 $2$\uff0c\u5219\uff1a\n\n- $(a,b)$ \u662f\u767d\u70b9\uff0c\u5373 $num_{(a,b)}>i$\uff1b\n- $(a,b)$ \u56db\u5468 $num$ \u6b21\u5c0f\u7684\u503c\u6240\u5728\u7684\u70b9\u4e3a\u9ed1\u70b9\uff0c\u5373 $\\text{secmin}(num_{(a-1,b)},num_{(a,b-1)},num_{(a+1,b)},num_{(a,b+1)})\\le i$\u3002\n\n\u5bf9\u8fd9\u4e9b\u6761\u4ef6\u53d6\u5e76\u96c6\uff0c\u5373 $i\\in[\\text{secmin}(num_{(a-1,b)},num_{(a,b-1)},num_{(a+1,b)},num_{(a,b+1)}),num_{(a,b)})$\u3002\n\n\u6b64\u5904\u9700\u8981\u641e\u6e05\u695a\u70b9\u88ab\u67d3\u9ed1\u70b9\u7684\u6761\u4ef6\u3001\u70b9\u88ab\u67d3\u6210\u9ed1\u8272\u7684\u65f6\u95f4\u6bb5\u7b49\u6982\u5ff5\uff0c\u4e0d\u80fd\u6df7\u6dc6\u3002\n#### $\\text{Section 3}$ \u6570\u636e\u7ed3\u6784\n\u6211\u4eec\u9700\u8981\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u652f\u6301\u4e0a\u9762\u7684\u64cd\u4f5c\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u6211\u4eec\u7ef4\u62a4 $[$ \u6ee1\u8db3\u6761\u4ef6 $1\\,]+[$ \u6ee1\u8db3\u6761\u4ef6 $2\\,]$\uff0c\u90a3\u4e48\u6211\u4eec\u5bf9\u4e8e\u6bcf\u4e2a\u5408\u6cd5\u533a\u95f4\u8fdb\u884c $+1$\uff0c\u67e5\u8be2\u5168\u5c40\u6709\u51e0\u4e2a $1$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5c06\u6ee1\u8db3\u6761\u4ef6\u4e00\u7684\u70b9\u6570\u8bbe\u4e3a $x$\uff0c\u6ee1\u8db3\u6761\u4ef6\u4e8c\u7684\u70b9\u6570\u8bbe\u4e3a $y$\u3002\n\n\u663e\u7136 $x\\ge 1,y\\ge0$\uff0c\u5373 $x+y\\ge 1$\u3002\n\n\u6240\u4ee5\u7ef4\u62a4\u533a\u95f4\u6700\u5c0f\u503c\u53ca\u51fa\u73b0\u6b21\u6570\u5373\u7b54\u6848.\n#### $\\text{Section 4}$ \u5b9e\u73b0\u7ec6\u8282\n\n- 1.\u7ebf\u6bb5\u6811\u521d\u59cb\u6700\u5c0f\u503c\u4e3a $0$ \u60c5\u51b5\u7684\u5904\u7406\uff1a\n\n\t\u6211\u8fd9\u91cc\u4e5f\u91c7\u7528\u4e86\u7ef4\u62a4\u4e25\u683c\u6b21\u5c0f\u503c\u53ca\u5176\u51fa\u73b0\u6b21\u6570\u7684\u65b9\u6cd5\uff0c\u67e5\u8be2\u5224\u65ad\u6700\u5c0f\u503c\u662f\u5426\u4e3a $1$\uff0c\u4e25\u683c\u6b21\u5c0f\u503c\u662f\u5426\u4e3a $1$ \u5373\u53ef\u3002\n\n- 2.\u4fee\u6539\u70b9\u96c6\u51fa\u73b0\u91cd\u53e0\u60c5\u51b5\u65f6\u9700\u8981\u53bb\u91cd\u3002\n\n- 3.\u6211\u4eec\u5c06\u4e8c\u7ef4\u7684 $num$ \u6570\u7ec4\u91cd\u7f16\u53f7\u4e3a $1$ \u81f3 $n\\times m$ \u7ef4\u62a4\u8f83\u4e3a\u65b9\u4fbf\u3002\n\n- 4.\u8003\u8651\u8fb9\u754c\u95ee\u9898\uff0c\u8bbe\u8ba1\u7684\u91cd\u7f16\u53f7\u51fd\u6570\u68c0\u6d4b\u5230\u8d8a\u754c\u65f6\u53ef\u4ee5\u8fd4\u56de $n\\times m+1$\uff0c\u6b64\u65f6 $num_{n\\times m+1}=n\\times m+1$\uff0c\u7ebf\u6bb5\u6811\u533a\u95f4\u4fee\u6539\u65f6\u5224\u65ad\u5f53\u4fee\u6539\u533a\u95f4\u5de6\u7aef\u70b9\u5927\u4e8e\u53f3\u7aef\u70b9\u662f\u8fd4\u56de\u5373\u53ef\u3002\n\n****\n\n\u6700\u7ec8\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O((nm+q)\\log nm)$\uff0c\u5e38\u6570\u5de8\u5927\u5c31\u5bf9\u4e86\uff0c\u5e26\u4e2a\u7ebf\u6bb5\u6811\u7684 $4$ \u548c\u4e00\u6b21\u4fee\u6539\u7684 $2$\u3001\u4fee\u6539\u70b9\u6570\u7684 $10$\u3002\n\n\u4ee3\u7801\uff08\u633a\u5bb9\u6613\u5199\uff09\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define pii pair<int,int>\n#define mpr make_pair\nnamespace IO{//by cyffff\n\n}\nconst int N=1e6+10,INF=1e7;\nint num[N];\npii pos[N];\nint n,m,su;\nint mx[]={0,1,0,-1,0};\nint my[]={1,0,-1,0,0};\ninline int number(int x,int y){\n\tif(min(x,y)<1||x>n||y>m) return su;\n\treturn (x-1)*m+y;\n}\nstruct Segument_Tree{\n\tstruct node{\n\t\tint l,r,minn,tag,cnt,secm=INF,sec;\n\t\tinline node operator+=(const int &x){\n\t\t\tminn+=x;\n\t\t\tsecm+=x;\n\t\t\ttag+=x;\n\t\t\treturn *this;\n\t\t}\n\t}a[N<<2];\n\t#define ls (rt<<1)\n\t#define rs (rt<<1|1)\n\tinline void getsec(int &x,int &y,int &sx,int &sy,int a,int b){\n\t\tif(x>a){\n\t\t\tsx=x,sy=y,x=a,y=b;\n\t\t}else if(x==a){\n\t\t\ty+=b;\n\t\t}else if(sx>a){\n\t\t\tsx=a,sy=b;\n\t\t}else if(sx==a){\n\t\t\tsy+=b;\n\t\t}\n\t}\n\tinline void pushup(int rt){\n\t\ta[rt].cnt=a[rt].sec=0;\n\t\ta[rt].minn=a[rt].secm=INF;\n\t\tgetsec(a[rt].minn,a[rt].cnt,a[rt].secm,a[rt].sec,a[ls].minn,a[ls].cnt);\n\t\tgetsec(a[rt].minn,a[rt].cnt,a[rt].secm,a[rt].sec,a[ls].secm,a[ls].sec);\n\t\tgetsec(a[rt].minn,a[rt].cnt,a[rt].secm,a[rt].sec,a[rs].minn,a[rs].cnt);\n\t\tgetsec(a[rt].minn,a[rt].cnt,a[rt].secm,a[rt].sec,a[rs].secm,a[rs].sec);\n\t}\n\tinline void pushdown(int rt){\n\t\tif(!a[rt].tag) return ;\n\t\ta[ls]+=a[rt].tag;\n\t\ta[rs]+=a[rt].tag;\n\t\ta[rt].tag=0;\n\t}\n\tinline void build(int rt,int l,int r){\n\t\ta[rt].l=l,a[rt].r=r;\n\t\ta[rt].cnt=r-l+1;\n\t\tif(l==r) return ;\n\t\tint mid=l+r>>1;\n\t\tbuild(ls,l,mid);\n\t\tbuild(rs,mid+1,r);\n\t}\n\tinline void update(int rt,int l,int r,int v){\n\t\tif(l>r) return ;\n\t\tif(a[rt].l>=l&&r>=a[rt].r){\n\t\t\ta[rt]+=v;\n\t\t\treturn ;\n\t\t}\n\t\tpushdown(rt);\n\t\tif(a[ls].r>=l) update(ls,l,r,v);\n\t\tif(a[rs].l<=r) update(rs,l,r,v);\n\t\tpushup(rt);\n\t}\n\tinline int query(){\n\t\treturn (a[1].minn==1)*a[1].cnt+(a[1].secm==1)*a[1].sec;\n\t}\n}t;\nint tind[10];\ninline void update(int x,int y,int v){\n\tint posi=number(x,y);\n\tif(posi==su) return ;\n\tt.update(1,num[posi],min(num[number(x-1,y)],num[number(x,y-1)])-1,v);\n\tfor(int i=0;i<4;i++){\n\t\ttind[i]=num[number(x+mx[i],y+my[i])];\n\t}\n\tsort(tind,tind+4);\n\tt.update(1,tind[1],num[posi]-1,v);\n}\npii tmp[15],tmp1,tmp2;\nint q,top;\nint main(){\n\tn=read(),m=read(),q=read();\n\tnum[su=n*m+1]=n*m+1;\n\tfor(int i=1;i<su;i++){\n\t\tint x=read()+1,y=read()+1;\n\t\tnum[number(x,y)]=i;\n\t\tpos[i]=mpr(x,y);\n\t}\n\tt.build(1,1,su-1);\n\tfor(int i=1;i<su;i++){\n\t\tupdate(pos[i].first,pos[i].second,1);\n\t}\n\twhile(q--){\n\t\tint x=read()+1,y=read()+1;\n\t\ttmp1=pos[x],tmp2=pos[y];\n\t\ttop=0;\n\t\tfor(int i=0;i<5;i++){\n\t\t\ttmp[++top]=mpr(tmp1.first+mx[i],tmp1.second+my[i]);\n\t\t\ttmp[++top]=mpr(tmp2.first+mx[i],tmp2.second+my[i]);\n\t\t}\n\t\tsort(tmp+1,tmp+top+1);\n\t\ttop=unique(tmp+1,tmp+top+1)-tmp;\n\t\tfor(int i=1;i<top;i++){\n\t\t\tupdate(tmp[i].first,tmp[i].second,-1);\n\t\t}\n\t\tswap(num[number(tmp1.first,tmp1.second)],num[number(tmp2.first,tmp2.second)]);\n\t\tswap(pos[x],pos[y]);\n\t\tfor(int i=1;i<top;i++){\n\t\t\tupdate(tmp[i].first,tmp[i].second,1);\n\t\t}\n\t\twrite(t.query());\n\t\tputc('\\n');\n\t}\n\tflush();\n    return 0;\n}\n```\n\u518d\u89c1 qwq~",
        "postTime": 1623250987,
        "uid": 365127,
        "name": "cyffff",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4898\u3010[IOI2018] seats \u6392\u5ea7\u4f4d\u3011"
    },
    {
        "content": "\u76f8\u4fe1\u5927\u5bb6\u770b\u5b8c\u9898\u89e3\u4ecd\u7136\u6709\u4e9b\u8ff7\u60d1\u5427\uff01\n\n\u6211\u8bb2\u4e00\u4e0b\u6211\u7684\u7406\u89e3\u3002\n\n\u5927\u5bb6\u5e94\u8be5\u662f\u5361\u5728\u4e86\u4e0d\u4f1a\u7ef4\u62a4\u8fd9\u4e2a\uff1a\n\n>\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u73b0\u5728\u5bf9\u4e8e\u4e00\u4e2a\u4f4d\u7f6ei\uff0c\u5c06\u524di\u4e2a\u70b9\u67d3\u6210\u9ed1\u8272\uff0c\u540e\u9762\u7684\u70b9\u4e3a\u767d\u8272\u3002\n\n>\u6211\u4eec\u7ef4\u62a4\u8fd9\u4e48\u4e24\u4e2a\u4e1c\u897f\uff1a\n\n>1\u3001\u6240\u6709\u7684\u9ed1\u70b9\u4e2d\uff0c\u6709\u591a\u5c11\u4e2a\u70b9\u7684\u5de6\u4fa7\u548c\u4e0a\u4fa7\u90fd\u4e0d\u6328\u7740\u9ed1\u70b9\uff08\u53ef\u80fd\u662f\u767d\u70b9\u6216\u8fb9\u7f18\uff09\u3002\n\n>2\u3001\u6240\u6709\u7684\u767d\u70b9\u4e2d\uff0c\u6709\u591a\u5c11\u4e2a\u70b9\u7684\u5468\u56f4\u56db\u8fde\u901a\u5730\u6328\u7740\u5927\u4e8e\u7b49\u4e8e2\u4e2a\u9ed1\u70b9\u3002\n\n\u2014\u2014liuzhangfeiabc\n\n\u9996\u5148\u6211\u4eec\u8981\u641e\u660e\u767d\uff0c\u4e00\u4e2a\u70b9\u4f55\u65f6\u4f1a\u6210\u4e3a\u9ed1\u70b9\u3002\n\n\u70b9 $(x,y)$ \u4f1a\u6210\u4e3a\u9ed1\u70b9\u7684\u65f6\u523b\uff08\u6211\u4eec\u8bbe\u7b2c $i$ \u4e2a\u65f6\u523b\u5c06\u524d $i$ \u4e2a\u70b9\u67d3\u9ed1\uff0c$t_{x,y}$ \u4e3a\u4e0b\u6807\u4e3a $(x,y)$ \u7684\u70b9\u7684\u7f16\u53f7\uff09$i$\uff0c\u5f53\u4e14\u4ec5\u5f53 $i\\ge t_{x,y}$\u3002\u56e0\u4e3a\u5728\u7b2c $t_{x,y}$ \u4e2a\u65f6\u523b\u8fd9\u4e2a\u70b9\u5c31\u88ab\u67d3\u9ed1\u4e86\u3002\u53cd\u4e4b\uff0c\u5f53 $i<t_{x,y}$ \u65f6\uff0c\u8fd9\u4e2a\u70b9\u662f\u767d\u70b9\u3002\n\n\u6240\u4ee5\uff0c\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u4fe1\u606f\uff0c\u5bf9\u4e8e\u70b9 $(x,y)$ \u7684\u65f6\u523b $i$\uff0c\u6211\u4eec\u9700\u8981\u6ee1\u8db3\u4e09\u4e2a\u6761\u4ef6\uff1a\n\n1. $i\\ge t_{x,y}$\uff08\u5373\u8fd9\u4e2a\u70b9\u662f\u9ed1\u70b9\uff09\u3002\n\n2. $i<t_{x-1,y}$\uff08\u5373\u4e0a\u65b9\u662f\u767d\u70b9\uff09\n\n3. $i<t_{x,y-1}$\uff08\u5373\u5de6\u4fa7\u662f\u767d\u70b9\uff09\n\n\u8fd9\u4e09\u4e2a\u4fe1\u606f\u7684\u5e76\u96c6\u5c31\u662f $[t_{x,y},\\min(t_{x-1,y},t_{x,y-1}))$ \u5566\uff01\n\n\u540c\u7406\u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\u6211\u4eec\u4e5f\u53ef\u4ee5\u5f97\u5230\uff1a\n\n1. $i<t_{x,y}$\n\n2. $i\\ge secondmin(t_{x-1,y},t_{x,y-1},t_{x+1,y},t_{x,y+1})$\uff08$secondmin$ \u6307\u6b21\u5c0f\u503c\uff0c\u610f\u601d\u662f\uff0c\u5f53\u7b2c\u4e8c\u4e2a\u9ed1\u70b9\u51fa\u73b0\u7684\u65f6\u5019\u8fd9\u4e2a\u65f6\u523b\u5c31\u6ee1\u8db3\u6761\u4ef6\u4e86\uff09\n\n\u5e76\u96c6\u662f $[secondmin(t_{x-1,y},t_{x,y-1},t_{x+1,y},t_{x,y+1}),t_{x,y})$\u3002\n\n\u6240\u4ee5\u628a\u65f6\u523b\u653e\u5728\u5e8f\u5217\u4e0a\u7ef4\u62a4\uff0c\u652f\u6301\u533a\u95f4\u52a0\uff08\u52a0\u5165\u8d21\u732e\u7684\u65f6\u5019 $+1$\uff0c\u64a4\u9500\u7684\u65f6\u5019 $-1$\uff09\uff0c\u5168\u5c40\u6c42 $1$ \u7684\u4e2a\u6570\uff0c\u7ebf\u6bb5\u6811\u7ef4\u62a4\u6bd4\u8f83\u65b9\u4fbf\u3002\n\nP.S. \u9898\u89e3\u90fd\u662f\u7ef4\u62a4\u6700\u5c0f\u503c\u3002\u3002\u4f46\u662f\u6211\u592a\u7b28\u4e86\u4ee5\u81f3\u4e8e\u4e0d\u4f1a\u5f88\u597d\u7684\u89e3\u51b3\u521d\u59cb\u5e8f\u5217\u51fa\u73b0 $0$ \u7684\u95ee\u9898\uff08\u5176\u5b9e\u4e5f\u662f\u53ef\u4ee5\u7684\u3002\u3002\u4f46\u662f\u4e5f\u9ebb\u70e6\u3002\u3002\u4ee3\u7801\u4f1a\u4e0d\u7f8e\u89c2\uff09\uff0c\u4e8e\u662f\u5c31\u7ef4\u62a4\u4e86\u6700\u5c0f\u503c\uff0c\u6700\u5c0f\u503c\u51fa\u73b0\u6b21\u6570\uff0c\u4e25\u683c\u6b21\u5c0f\u503c\u548c\u4e25\u683c\u6b21\u5c0f\u503c\u51fa\u73b0\u6b21\u6570\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define x first\n#define y second\nusing namespace std;\nint t[1000005];\npair<int,int> a[1000005];\nint n,m;\nconst int fx[]={0,-1,1,0,0};\nconst int fy[]={-1,0,0,1,0};\nint f(int x,int y)\n{\n\tif(x<1||y<1||x>n||y>m) return 0;\n\treturn (x-1)*m+y;\n}\nstruct segment_tree\n{\n\t#define ls w<<1\n\t#define rs ls|1\n\tstruct seg\n\t{\n\t\tint l,r,mn,mn2,s,s2,tag;\n\t}t[4000005];\n\tint f[1000005];\n\tvoid build(int w,int l,int r)\n\t{\n\t\tt[w].l=l,t[w].r=r;\n\t\tt[w].mn2=2e9,t[w].s=r-l+1;\n\t\tif(l<r)\n\t\t{\n\t\t\tint mid=l+r>>1;\n\t\t\tbuild(ls,l,mid);\n\t\t\tbuild(rs,mid+1,r);\n\t\t}\n\t}\n\tvoid pushup(int w)\n\t{\n\t\tpair<int,int> s[4]={{t[ls].mn,t[ls].s},{t[ls].mn2,t[ls].s2},{t[rs].mn,t[rs].s},{t[rs].mn2,t[rs].s2}};\n\t\tt[w].mn=t[w].mn2=2e9;\n\t\tt[w].s=t[w].s2=0;\n\t\tfor(int i=0;i<4;i++)\n\t\t\tif(s[i].first==t[w].mn)\n\t\t\t\tt[w].s+=s[i].second;\n\t\t\telse if(s[i].first<t[w].mn)\n\t\t\t\tt[w].mn2=t[w].mn,t[w].s2=t[w].s,t[w].mn=s[i].first,t[w].s=s[i].second;\n\t\t\telse if(s[i].first==t[w].mn2)\n\t\t\t\tt[w].s2+=s[i].second;\n\t\t\telse if(s[i].first<t[w].mn2)\n\t\t\t\tt[w].mn2=s[i].first,t[w].s2=s[i].second;\n\t}\n\tvoid pushdown(int w)\n\t{\n\t\tt[ls].tag+=t[w].tag;\n\t\tt[rs].tag+=t[w].tag;\n\t\tt[ls].mn+=t[w].tag;\n\t\tt[rs].mn+=t[w].tag;\n\t\tt[ls].mn2+=t[w].tag;\n\t\tt[rs].mn2+=t[w].tag;\n\t\tt[w].tag=0;\n\t}\n\tvoid add(int w,int l,int r,int v)\n\t{\n\t\tif(l>r) return;\n\t\tif(t[w].l>=l&&t[w].r<=r)\n\t\t{\n\t\t\tt[w].mn+=v,t[w].mn2+=v,t[w].tag+=v;\n\t\t\treturn;\n\t\t}\n\t\tpushdown(w);\n\t\tif(t[ls].r>=l) add(ls,l,r,v);\n\t\tif(t[rs].l<=r) add(rs,l,r,v);\n\t\tpushup(w);\n\t}\n\tint ask()\n\t{\n\t\treturn (t[1].mn==1)*t[1].s+(t[1].mn2==1)*t[1].s2;\n\t}\n}tr;\nvoid add(int x,int y,int v)\n{\n\tif(!f(x,y)) return;\n\ttr.add(1,t[f(x,y)],min(f(x-1,y)?t[f(x-1,y)]:(n*m+1),f(x,y-1)?t[f(x,y-1)]:(n*m+1))-1,v);\n\tint s[4],i;\n\tfor(i=0;i<4;i++)\n\t\ts[i]=f(x+fx[i],y+fy[i])?t[f(x+fx[i],y+fy[i])]:1e9;\n\tsort(s,s+4);\n\ttr.add(1,s[1],t[f(x,y)]-1,v);\n}\nint main()\n{\n\tint q,i,x,y,cnt;\n\tpair<int,int> re[15],u,v;\n\tscanf(\"%d%d%d\",&n,&m,&q);\n\tfor(i=1;i<=n*m;i++)\n\t\tscanf(\"%d%d\",&x,&y),t[f(x+1,y+1)]=i,a[i]=make_pair(x+1,y+1);\n\ttr.build(1,1,n*m);\n\tfor(i=1;i<=n*m;i++)\n\t\tadd(a[i].x,a[i].y,1);\n\twhile(q--)\n\t{\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tx++,y++;\n\t\tu=a[x],v=a[y];\n\t\tcnt=0;\n\t\tfor(i=0;i<5;i++)\n\t\t{\n\t\t\tre[cnt++]=make_pair(u.x+fx[i],u.y+fy[i]);\n\t\t\tre[cnt++]=make_pair(v.x+fx[i],v.y+fy[i]);\n\t\t}\n\t\tsort(re,re+cnt);\n\t\tcnt=unique(re,re+cnt)-re;\n\t\tfor(i=0;i<cnt;i++)\n\t\t\tadd(re[i].x,re[i].y,-1);\n\t\tswap(t[f(u.x,u.y)],t[f(v.x,v.y)]);\n\t\tswap(a[x],a[y]);\n\t\tfor(i=0;i<cnt;i++)\n\t\t\tadd(re[i].x,re[i].y,1);\n\t\tprintf(\"%d\\n\",tr.ask());\n\t}\n}\n```\n",
        "postTime": 1623143690,
        "uid": 203623,
        "name": "Ntokisq",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4898 [IOI2018] seats \u6392\u5ea7\u4f4d"
    },
    {
        "content": "[\u67d0\u5927\u4f6c](https://www.luogu.com.cn/user/154520)\uff1a\u601d\u8def\u7406\u89e3\u5b8c\u5c31\u5f88\u597d\u505a\u4e86\u3002   \n\n\u7136\u540e\u6211\u5c31\u770b\u4e86\u4e0b\u9898\u89e3\u7684\u601d\u8def\uff0c\u7ed3\u679c\u53d1\u73b0\u5b9e\u73b0\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\uff08\u8bf4\u660echen_03\u5946\u987a\u5e26Orz\uff09\u3002  \n\n\u601d\u8def\uff1a\n\n1. \u663e\u7136\u540c\u6837\u5927\u5c0f\u7684\u5b50\u77e9\u9635\u4e2d\uff0c\u7b26\u5408\u6761\u4ef6\u7684\u6700\u591a\u4e00\u4e2a\u3002  \n\n1. \u8003\u8651\u5224\u65ad $[0 \\dots i-1]$ \u7684\u6570\u662f\u5426\u6784\u6210\u4e00\u4e2a\u77e9\u5f62\uff0c\u5c06\u8fd9\u4e9b\u6570\u67d3\u6210\u9ed1\u7684\uff0c\u5e76\u4e14\u628a\u5269\u4e0b\u7684\u548c\u8fb9\u754c\u5916\u7684\u67d3\u6210\u767d\u8272\u3002  \n\n1. \u5047\u8bbe $[0 \\dots i-1]$ \u7684\u6570\u6784\u6210\u77e9\u5f62\uff0c\u90a3\u4e48\u8fd9 $i$ \u4e2a\u70b9\u4e2d\uff1a\n\n\t- \u5de6\u4e0a\u90fd\u662f\u767d\u70b9\u3002  \n   - \u4e0a\u4e0b\u5de6\u53f34\u4e2a\u70b9\u4e2d\uff0c\u662f\u9ed1\u70b9\u7684\u5927\u4e8e\u7b49\u4e8e2\u4e2a\u3002  \n   \n1. \u90a3\u4e48\u628a\u6ee1\u8db3\u7b2c\u4e00\u4e2a\u7684\u9ed1\u70b9\u6570\u8bb0\u4e3a $x$ \uff0c $x=1$ \u5e76\u4e14\u4e5f\u6ee1\u8db3\u4e86\u8fd9 $i$ \u4e2a\u70b9\u5904\u4e8e\u540c\u4e00\u8fde\u901a\u5757\u3002  \n\n1. \u540c\u7406\u6ee1\u8db3\u7b2c\u4e8c\u4e2a\u7684\u767d\u70b9\u8bb0\u4e3a $y$ \uff0c$y=0$ \u5e76\u4e14\u4e5f\u6ee1\u8db3\u4e86\u8fd9i\u4e2a\u70b9\u6784\u6210\u4e00\u4e2a\u77e9\u5f62\uff0c\u4e0d\u6ee1\u8db3\u5219\u8bf4\u660e\u5b58\u5728\u201c\u62d0\u89d2\u201d\u3002  \n\n1. \u5982\u679c\u53ea\u6ee1\u8db3\u7b2c\u4e8c\u4e2a\uff0c\u4e0d\u6ee1\u8db3\u7b2c\u4e00\u4e2a\uff0c\u8bf4\u660e\u53ef\u80fd\u6784\u6210\u591a\u4e2a\u77e9\u5f62\u3002  \n\n1. \u53ef\u4ee5\u4ece\u9898\u76ee\u4e2d\u5f97\u5230\u5982\u679c $x+y=1$ \uff0c\u90a3\u4e48\u8fd9\u4e2a\u5c31\u662f\u5408\u6cd5\u7684\u3002  \n\n1. \u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u6765\u7ef4\u62a4\u6bcf\u4e2a $i$ \u548c $x+y$ \u7684\u503c\uff0c\u5e76\u4e14\u7ef4\u62a4\u533a\u95f4\u6700\u5c0f\u503c\u53ca\u6700\u5c0f\u503c\u4e2a\u6570\uff08\u6700\u5c0f\u503c\u4e0d\u53ef\u80fd\u4e3a $0$ \uff09\u3002  \n\n1. \u5bf9\u4e8e\u6bcf\u4e2a\u70b9u\uff0c\u4e00\u5b9a\u662f\u5148\u767d\u540e\u9ed1\u3002\u90a3\u4e48\u5c31\u53ef\u4ee5\u8bbe $u$ \u4e3a\u767d\u70b9\u7684\u6700\u665a\u65f6\u523b\u4e3a$l_u$\uff0c\u4e3a\u9ed1\u70b9\u7684\u6700\u65e9\u65f6\u523b\u4e3a $r_u$\u3002  \n\n1. \u8bb0 $u$ \u5468\u56f4 $4$ \u4e2a\u70b9\u7684 $r$ \u7684**\u6b21**\u5c0f\u503c\u4e3a $z$ \uff08\u8d8a\u754c\u4e3a$\\inf$\uff09\uff0c\u8bb0 $v$ \u5de6\u4e0a\u7684 $l$ \u7684\u6700\u5c0f\u503c\u4e3a $t$ \uff08\u8d8a\u754c\u4e3a $H \\times W-1$ \uff09\u3002  \n\n1. $u$ \u4f5c\u4e3a\u6ee1\u8db3\u7b2c\u4e8c\u4e2a\u7684\u70b9\u7684\u65f6\u6bb5\u4e3a $[z,l_u]$\uff08\u6ce8\u610f\u6709 $z>l_u$ \u7684\u60c5\u51b5\uff09\uff0c$v$ \u4f5c\u4e3a\u6ee1\u8db3\u7b2c\u4e00\u4e2a\u7684\u70b9\u7684\u65f6\u6bb5\u5373 $[r_u,t]$ \uff08\u4e00\u6837\u7684\u6ce8\u610f\u6709 $r_u>t$ \u7684\u60c5\u51b5\uff09\u3002  \n\n1. \u90a3\u4e48\u5728\u7ebf\u6bb5\u6811\u4e0a\u7ed9 $[z,l_u]$ \u548c $[r_u,t]$ \u90fd $+1$\u3002  \n\n1. \u6bcf\u6b21\u4ea4\u6362\u65f6\uff0c\u51cf\u6389\u4e24\u4e2a\u70b9 $a,b$ \u53ca\u4ed6\u4eec\u5468\u56f44\u4e2a\u70b9\uff08\u5171 $O(10)$ \u4e2a\u70b9\uff09\u5728\u4e24\u70b9\u4ea4\u6362\u524d\u7684\u8d21\u732e\uff0c\u4ea4\u6362 $a,b$ \uff0c\u52a0\u4e0a\u8fd9\u4e9b\u70b9\u5728\u4e24\u70b9\u4ea4\u6362\u540e\u7684\u8d21\u732e\u3002  \n\n1. \u6ce8\u610f\u5982\u679c $10$ \u4e2a\u70b9\u4e2d\u6709\u91cd\u590d\u7684\uff0c\u4e0d\u53ef\u4ee5\u91cd\u590d\u52a0\u51cf\u8d21\u732e\n\n1. \u8981\u8bb0\u5f55\u77e9\u9635\u4e2d\u6bcf\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u6570\u662f\u4ec0\u4e48\uff0c\u4ee5\u53ca\u6bcf\u4e2a\u6570\u6240\u5728\u4f4d\u7f6e\u662f\u4ec0\u4e48\u3002 \n\n\u505a\u5b8c\u4e86\u3002\u3002  \n _Code for luogu_\n ```cpp\n#include<bits/stdc++.h>\n#define reg register int\n#define il inline\n#define mid ((l+r)>>1)\n#define MAXN 1000010\n#define ll long long\n#define inf 0x3f3f3f3f\nusing namespace std;\nil int read(){\n    char c=getchar();\n    int x=0;\n    while(c<'0'||c>'9') c=getchar();\n    while(c>='0'&&c<='9')\n    \tx=(x<<3)+(x<<1)+c-48,c=getchar();\n    return x;\n}\nint id[MAXN],vis[MAXN],sta[MAXN],top,pos[MAXN][2],n,m,q;\nint num(int x,int y){\n    return (x-1)*m+y;\n}\nstruct tr{\n    int mi,cnt,mx,ad;\n}t[4*MAXN];\nvoid pushup(int x){\n    t[x].mi=min(t[x<<1].mi,t[x<<1|1].mi);\n    t[x].mx=max(t[x<<1].mx,t[x<<1|1].mx);\n    t[x].cnt=t[x<<1].cnt*(t[x<<1].mi==t[x].mi)+t[x<<1|1].cnt*(t[x<<1|1].mi==t[x].mi);\n}\nvoid pushdown(int x){\n    if(!t[x].ad) return;\n    t[x<<1].ad+=t[x].ad;\n    t[x<<1].mi+=t[x].ad;\n    t[x<<1].mx+=t[x].ad;\n    t[x<<1|1].ad+=t[x].ad;\n    t[x<<1|1].mi+=t[x].ad;\n    t[x<<1|1].mx+=t[x].ad;\n    t[x].ad=0;\n}\nvoid build(int x,int l,int r){\n    if(l==r){\n        t[x].cnt=1;return;\n    }\n    build(x<<1,l,mid);\n    build(x<<1|1,mid+1,r);\n    pushup(x);\n}\nvoid add(int x,int l,int r,int L,int R,int c){\n    if(L<=l&&r<=R){\n        t[x].ad+=c;\n        t[x].mi+=c;\n        t[x].mx+=c;\n        if(t[x].mi==t[x].mx) t[x].cnt=r-l+1;\n        return;\n    }    \n    pushdown(x);\n    if(L<=mid) add(x<<1,l,mid,L,R,c);\n    if(mid<R) add(x<<1|1,mid+1,r,L,R,c);\n    pushup(x);\n}\nint mv[4][2]={{1,0},{-1,0},{0,1},{0,-1}};\nvoid f(int x,int y,int c){\n    int mi=inf,cmi=inf;\n    for(reg i=0;i<4;++i){\n        int dx=x+mv[i][0],dy=y+mv[i][1];\n        if(dx>=1&&dx<=n&&dy>=1&&dy<=m){\n            if(id[num(dx,dy)]<mi){\n                cmi=mi;mi=id[num(dx,dy)];\n            }else cmi=min(cmi,id[num(dx,dy)]);\n        }\n    }\n    if(cmi<=id[num(x,y)]-1) {\n        add(1,1,n*m,cmi,id[num(x,y)]-1,c);\n    }\n}\nvoid s(int x,int y,int c){\n    int mi=n*m+1;\n    int dx=x-1,dy=y;\n    if(dx>=1&&dx<=n&&dy>=1&&dy<=m){\n        mi=min(mi,id[num(dx,dy)]);\n    }\n    dx=x,dy=y-1;\n    if(dx>=1&&dx<=n&&dy>=1&&dy<=m){\n        mi=min(mi,id[num(dx,dy)]);\n    }\n    if(id[num(x,y)]<=mi-1) add(1,1,n*m,id[num(x,y)],mi-1,c);\n}\nvoid sol(int x,int y,int c){\n    if(!vis[num(x,y)]) {\n        sta[++top]=num(x,y);\n        vis[num(x,y)]=1;\n        f(x,y,c);\n\t\ts(x,y,c);\n    }\n    for(reg i=0;i<4;++i){\n        int dx=x+mv[i][0],dy=y+mv[i][1];\n        if(dx>=1&&dx<=n&&dy>=1&&dy<=m&&!vis[num(dx,dy)]){\n            vis[num(dx,dy)]=1;\n            sta[++top]=num(dx,dy);\n            f(dx,dy,c);\n\t\t\ts(dx,dy,c);\n        }\n    }\n}\nint main(){\n    n=read();m=read();q=read();\n    build(1,1,n*m);\n    int x,y;\n    for(reg i=1;i<=n*m;++i){\n        x=read();y=read();\n        ++x;++y;\n        pos[i][0]=x;pos[i][1]=y;\n        id[num(x,y)]=i;\n    }\n    for(reg i=1;i<=n;++i){\n        for(reg j=1;j<=m;++j){\n            f(i,j,1);\n            s(i,j,1);\n        }\n    }\n    int u,v;\n    while(q--){\n        u=read();v=read();        \n        ++u;++v;\n        top=0;\n        x=pos[u][0],y=pos[u][1];\n        sol(x,y,-1);\n        x=pos[v][0],y=pos[v][1];\n        sol(x,y,-1);\n        while(top) vis[sta[top--]]=0;\n        swap(id[num(pos[u][0],pos[u][1])],id[num(pos[v][0],pos[v][1])]);\n        swap(pos[u][0],pos[v][0]);\n        swap(pos[u][1],pos[v][1]);\n        x=pos[u][0],y=pos[u][1];\n        sol(x,y,1);\n        x=pos[v][0],y=pos[v][1];\n        sol(x,y,1);\n        while(top) vis[sta[top--]]=0;\n        int ans=0;\n        if(t[1].mi==1) ans=t[1].cnt;\n        printf(\"%d\\n\",ans);\n    }\n    return 0;\n}\n ```\n_Code for loj_  \n```cpp\n#include \"seats.h\"\n#include<bits/stdc++.h>\n#define reg register int\n#define il inline\n#define mid ((l+r)>>1)\n#define MAXN 1000010\n#define ll long long\n#define inf 0x3f3f3f3f\nusing namespace std;\nil int read(){\n    char c=getchar();\n    int x=0;\n    while(c<'0'||c>'9') c=getchar();\n    while(c>='0'&&c<='9')\n    \tx=(x<<3)+(x<<1)+c-48,c=getchar();\n    return x;\n}\nint id[MAXN],vis[MAXN],sta[MAXN],top,pos[MAXN][2],n,m,q;\nint num(int x,int y){\n    return (x-1)*m+y;\n}\nstruct tr{\n    int mi,cnt,mx,ad;\n}t[4*MAXN];\nvoid pushup(int x){\n    t[x].mi=min(t[x<<1].mi,t[x<<1|1].mi);\n    t[x].mx=max(t[x<<1].mx,t[x<<1|1].mx);\n    t[x].cnt=t[x<<1].cnt*(t[x<<1].mi==t[x].mi)+t[x<<1|1].cnt*(t[x<<1|1].mi==t[x].mi);\n}\nvoid pushdown(int x){\n    if(!t[x].ad) return;\n    t[x<<1].ad+=t[x].ad;\n    t[x<<1].mi+=t[x].ad;\n    t[x<<1].mx+=t[x].ad;\n    t[x<<1|1].ad+=t[x].ad;\n    t[x<<1|1].mi+=t[x].ad;\n    t[x<<1|1].mx+=t[x].ad;\n    t[x].ad=0;\n}\nvoid build(int x,int l,int r){\n    if(l==r){\n        t[x].cnt=1;return;\n    }\n    build(x<<1,l,mid);\n    build(x<<1|1,mid+1,r);\n    pushup(x);\n}\nvoid add(int x,int l,int r,int L,int R,int c){\n    if(L<=l&&r<=R){\n        t[x].ad+=c;\n        t[x].mi+=c;\n        t[x].mx+=c;\n        if(t[x].mi==t[x].mx) t[x].cnt=r-l+1;\n        return;\n    }    \n    pushdown(x);\n    if(L<=mid) add(x<<1,l,mid,L,R,c);\n    if(mid<R) add(x<<1|1,mid+1,r,L,R,c);\n    pushup(x);\n}\nint mv[4][2]={{1,0},{-1,0},{0,1},{0,-1}};\nvoid f(int x,int y,int c){\n    int mi=inf,cmi=inf;\n    for(reg i=0;i<4;++i){\n        int dx=x+mv[i][0],dy=y+mv[i][1];\n        if(dx>=1&&dx<=n&&dy>=1&&dy<=m){\n            if(id[num(dx,dy)]<mi){\n                cmi=mi;mi=id[num(dx,dy)];\n            }else cmi=min(cmi,id[num(dx,dy)]);\n        }\n    }\n    if(cmi<=id[num(x,y)]-1) {\n        add(1,1,n*m,cmi,id[num(x,y)]-1,c);\n    }\n}\nvoid s(int x,int y,int c){\n    int mi=n*m+1;\n    int dx=x-1,dy=y;\n    if(dx>=1&&dx<=n&&dy>=1&&dy<=m){\n        mi=min(mi,id[num(dx,dy)]);\n    }\n    dx=x,dy=y-1;\n    if(dx>=1&&dx<=n&&dy>=1&&dy<=m){\n        mi=min(mi,id[num(dx,dy)]);\n    }\n    if(id[num(x,y)]<=mi-1) add(1,1,n*m,id[num(x,y)],mi-1,c);\n}\nvoid sol(int x,int y,int c){\n    if(!vis[num(x,y)]) {\n        sta[++top]=num(x,y);\n        vis[num(x,y)]=1;\n        f(x,y,c);\n\t\ts(x,y,c);\n    }\n    for(reg i=0;i<4;++i){\n        int dx=x+mv[i][0],dy=y+mv[i][1];\n        if(dx>=1&&dx<=n&&dy>=1&&dy<=m&&!vis[num(dx,dy)]){\n            vis[num(dx,dy)]=1;\n            sta[++top]=num(dx,dy);\n            f(dx,dy,c);\n\t\t\ts(dx,dy,c);\n        }\n    }\n}\nvoid give_initial_chart(int H,int W,vector<int> R,vector<int> C){\n\tint x,y;n=H,m=W;\n    build(1,1,n*m);\n\tfor(reg i=1;i<=n*m;++i){\n\t\tx=R[i-1]+1;\n\t\ty=C[i-1]+1;\n\t\tid[num(x,y)]=i;\n\t\tpos[i][0]=x;\n\t\tpos[i][1]=y;\n\t}\n\tfor(reg i=1;i<=n;++i){\n        for(reg j=1;j<=m;++j){\n            f(i,j,1);\n            s(i,j,1);\n        }\n    }\n}\nint swap_seats(int a,int b){\n\tint u=a,v=b,x,y;        \n    ++u;++v;\n    top=0;\n    x=pos[u][0],y=pos[u][1];\n    sol(x,y,-1);\n    x=pos[v][0],y=pos[v][1];\n    sol(x,y,-1);\n    while(top) vis[sta[top--]]=0;\n    swap(id[num(pos[u][0],pos[u][1])],id[num(pos[v][0],pos[v][1])]);\n    swap(pos[u][0],pos[v][0]);\n    swap(pos[u][1],pos[v][1]);\n    x=pos[u][0],y=pos[u][1];\n    sol(x,y,1);\n    x=pos[v][0],y=pos[v][1];\n    sol(x,y,1);\n    while(top) vis[sta[top--]]=0;\n    int ans=0;\n    if(t[1].mi==1) ans=t[1].cnt;\n    return ans;\n}\n```",
        "postTime": 1593243725,
        "uid": 181506,
        "name": "Jay142753869",
        "ccfLevel": 5,
        "title": "IOI2018\u6392\u5ea7\u4f4d\u9898\u89e3"
    },
    {
        "content": "- [P4898 [IOI2018] seats \u6392\u5ea7\u4f4d](https://www.luogu.com.cn/problem/P4898)\n\n\u867d\u7136\u201c\u5f53\u4f60\u89c9\u5f97\u6b64\u9898\u65b9\u6cd5\u5f88\u5999\u65f6\uff0c\u8bf4\u660e\u4f60\u7684\u80fd\u529b\u4e0d\u8db3\u4ee5\u9a7e\u9a6d\u8fd9\u9053\u9898\u201d\uff0c\u4f46\u662f\u8fd9\u65e2\u7136\u662f\u7ebf\u6bb5\u6811\u7684\u4e00\u4e2a\u5e94\u7528\u800c\u4e14\u7834\u9898\u65b9\u6cd5\u7edd\u5999\uff0c\u6240\u4ee5\u6211\u8fd8\u662f\u505a\u4e86\u3002\n\n\u672c\u9898\u89e3\u8bb2\u8ff0\u601d\u8def + \u89e3\u8bf4 @[liuzhangfeiabc](https://www.luogu.com.cn/user/45775) \u5927\u4f6c\u7684\u4ee3\u7801\u601d\u8def\uff08\u5b9e\u73b0\u65b9\u6cd5\uff09\u3002\n    \n# Solution\n\n## 1\n    \n\u5982\u4f55\u5224\u65ad\u8282\u70b9\u96c6\u5408 $P$ \u4e2d\u7684\u6240\u6709\u8282\u70b9\u6240\u7ec4\u6210\u7684\u56fe\u5f62\u662f\u5426\u662f\u4e00\u77e9\u5f62\uff1f\u6b64\u5904\u91c7\u7528\u4e86\u4e00\u4e2a**\u67d3\u8272**\u7684\u529e\u6cd5\u3002\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u5c06 $P$ \u4e2d\u7684\u8282\u70b9\u5168\u90e8\u67d3\u6210\u9ed1\u8272\uff0c\u5c06\u5176\u4f59\u7684\u8282\u70b9\u5168\u90e8\u67d3\u6210\u767d\u8272\u3002\u7136\u540e\u7edf\u8ba1\u7b26\u5408\u4e00\u4e0b\u4e24\u4e2a\u6761\u4ef6\u4e4b\u4e00\u7684\u70b9\u7684\u603b\u6570\uff1a\n\n- \u4e00\u4e2a\u9ed1\u70b9\uff0c\u4e14\u5b83\u7684\u5de6\u65b9\u548c\u4e0a\u65b9\u76f8\u90bb\u7684\u8282\u70b9\u90fd\u662f\u767d\u8272\uff08\u6216\u8005\u4e3a\u7a7a\uff09\u3010\u6761\u4ef6\u4e00\u3011\uff1b\n- \u4e00\u4e2a\u767d\u70b9\uff0c\u4e14\u5b83\u7684\u4e0a\u4e0b\u5de6\u53f3\u76f8\u90bb\u7684\u8282\u70b9\u4e2d\u6709 $\\geq2$ \u4e2a\u9ed1\u8272\u7684\u8282\u70b9\u3010\u6761\u4ef6\u4e8c\u3011\u3002\n   \n\u56de\u8fc7\u5934\u6765\uff0c\u770b\u4e00\u4e2a\u77e9\u5f62\u4e2d\u6309\u4e0a\u8ff0\u65b9\u5f0f\u80fd\u7edf\u8ba1\u591a\u5c11\u4e2a\u70b9\u51fa\u6765\uff08\u987a\u4fbf\u53e3\u80e1\u8bc1\u660e\uff09\uff1a\n\n- \u82e5\u4e00\u4e2a\u9ed1\u70b9\u7684\u5de6\u65b9\u548c\u4e0a\u65b9\u76f8\u90bb\u7684\u8282\u70b9\u90fd\u662f\u767d\u8272\uff08\u6216\u4e3a\u7a7a\uff09\uff0c\u5219\u4ee3\u8868\u6709\u4e00\u4e2a\u8fde\u901a\u5757\u3002\u663e\u7136\uff0c\u4e00\u4e2a\u77e9\u5f62\u4e2d\u53ea\u6709\u4e00\u4e2a\u5927\u8fde\u901a\u5757\uff0c\u82e5\u51fa\u73b0\u4e24\u4e2a\u8fd9\u6837\u7684\u9ed1\u8272\u8282\u70b9\uff0c\u90a3\u5b83\u80af\u5b9a\u4e0d\u662f\u4e00\u4e2a\u77e9\u5f62\u3002\n- \u82e5\u6709\u4e00\u4e2a\u767d\u70b9\u7b26\u5408\u7b2c\u4e8c\u4e2a\u6761\u4ef6\uff0c\u901a\u8fc7\u7b80\u5355\u6784\u9020\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e0d\u8bba\u9ed1\u8272\u8282\u70b9\u4ee5\u4ec0\u4e48\u65b9\u5f0f\u51fa\u73b0\u5728\u767d\u70b9\u5468\u56f4\u90fd\u65e0\u6cd5\u5728\u6b64\u57fa\u7840\u4e0a\u6784\u9020\u4e00\u4e2a\u77e9\u5f62\u3002\u53cd\u8fc7\u6765\u8bf4\uff0c\u5f53\u51fa\u73b0\u4e00\u4e2a\u201cL\u201d\u5f62\u62d0\u89d2\u65f6\uff0c\u62d0\u89d2\u5904\u7684\u767d\u70b9\u5c31\u7b26\u5408\u7b2c\u4e8c\u4e2a\u6761\u4ef6\u3002\u7efc\u8ff0\uff0c\u4e00\u4e2a\u77e9\u5f62\u4e0d\u5b58\u5728\u6ee1\u8db3\u6761\u4ef6\u4e8c\u7684\u8282\u70b9\u3002\n\n\u6240\u4ee5\uff0c\u4e00\u4e2a\u77e9\u5f62\u7684\u4e24\u8005\u4e4b\u548c\u5fc5\u5b9a\u4e3a $1$\u3002\n\n## 2\n\n\u6709\u4e86\u4e0a\u8ff0\u7684\u7ed3\u8bba\u4e0e\u5224\u5b9a\u65b9\u6cd5\uff0c\u6211\u4eec\u518d\u770b\u770b\u548c\u8fd9\u9053\u9898\u6709\u4ec0\u4e48\u5173\u8054\u3002\n\n\u53d1\u73b0\u6211\u4eec\u53ef\u4ee5\u5c06\u9898\u76ee\u6240\u6c42\u8f6c\u5316\u4e3a\uff1a\u53d8\u91cf $i$ \u4ece $1$ \u904d\u5386\u5230 $h \\times w$\uff0c\u800c $i$ \u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u65f6\u95f4\u70b9\uff0c\u5373\u7b2c $i$ \u4e2a\u65f6\u523b\u3002\u5728\u6bcf\u4e2a\u65f6\u523b $i$\uff0c\u6211\u4eec\u4f1a\u5728\u4e4b\u524d\u7684\u57fa\u7840\u4e0a\u5c06\u7b2c $i$ \u4e3a\u53c2\u8d5b\u8005\u7684\u5ea7\u4f4d\u67d3\u6210\u9ed1\u8272\u3002\u5373\u5728\u65f6\u523b $i$\uff0c\u7b2c $1$ \u5230 $i$ \u4f4d\u53c2\u8d5b\u8005\u7684\u5ea7\u4f4d\u90fd\u4f1a\u88ab\u67d3\u4e0a\u9ed1\u8272\u3002\u540c\u65f6\uff0c\u8bb0 $val_i$ \u8868\u793a\u65f6\u523b $i$ \u65f6\u6ee1\u8db3 $1$ \u4e2d\u6240\u8ff0\u4e24\u4e2a\u6761\u4ef6\u7684\u603b\u70b9\u6570\u3002\n\n\u7531\u6b64\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u91cd\u8981\u6027\u8d28\uff1a\u767d\u70b9\u67d3\u8272\u65f6\u95f4\u5fc5\u5b9a\u5927\u4e8e\u9ed1\u70b9\u67d3\u8272\u65f6\u95f4\u3002\n\n\u6b64\u65f6\u5c31\u53ef\u4ee5\u7edf\u8ba1\u6bcf\u4e2a $val_i$ \u7684\u503c\uff1a\uff08$r(i)$ \u8868\u793a\u7b2c $i$ \u4f4d\u53c2\u8d5b\u8005\u7684\u5ea7\u4f4d\u6240\u5728\u7684\u884c\u6570\uff1b$c(i)$ \u8868\u793a\u6240\u5728\u5217\u6570\uff1b$i$ \u65e2\u4ee3\u8868\u65f6\u523b\uff0c\u4e5f\u4ee3\u8868\u8fd9\u4e2a\u65f6\u523b\u8981\u67d3\u8272\u7684\u8282\u70b9\uff1b$num_{x,y}$ \u8868\u793a\u5ea7\u4f4d $(x,y)$ \u7684\u53c2\u8d5b\u8005\u7684\u7f16\u53f7\u3002\uff09\n\n````cpp\n\t#define rep(i, a, b) for(register int i = a; i <= b; ++i)\n\trep(i, 1, s){ val[i] = val[i - 1];\n\t\tif(black(r(i), c(i)) > i) val[i] += 1;\n\t\tif(white(r(i), c(i)) < i) val[i] -= 1;\n\t\trep(j, 0, 3) if(legal((xx = r(i) + fx[j][0]), (yy = c(i) + fx[j][1]))){\n\t\t\tif(black(xx, yy) == i and num(xx, yy) < i) val[i] -= 1;\n\t\t\tif(white(xx, yy) == i and num(xx, yy) > i) val[i] += 1;\n\t\t}\n\t}\n````\n\n\u4e00\u70b9\u70b9\u6765\u8bf4\uff0c\u9996\u5148 `black()` \u51fd\u6570\u662f\u8fd4\u56de $i$ \u8282\u70b9\u5de6\u65b9\u548c\u4e0a\u65b9\u76f8\u90bb\u8282\u70b9\u5b83\u4eec\u67d3\u8272\u65f6\u95f4\u7684\u6700\u5c0f\u503c\u3002\u82e5\u8fd9\u4e2a\u6700\u5c0f\u503c\u90fd\u5927\u4e8e $i$\uff0c\u90a3\u4e48\u4ee3\u8868\uff0c$i$ \u8fd9\u4e2a\u8282\u70b9\u662f\u7b26\u5408\u6761\u4ef6\u4e00\u7684\u8282\u70b9\uff0c\u6240\u4ee5 $val_i$ \u52a0\u4e00\u3002\n\n\u53cd\u4e4b\uff0c `white()` \u51fd\u6570\u662f\u8fd4\u56de $i$ \u8282\u70b9\u56db\u65b9\u76f8\u90bb\u8282\u70b9\u5b83\u4eec\u67d3\u8272\u65f6\u95f4\u7684\u6b21\uff08\u7b2c\u4e8c\uff09\u5c0f\u503c\u3002\u82e5\u8fd9\u4e2a\u6b21\u5c0f\u503c\u5c0f\u4e8e $i$\uff0c\u90a3\u4e48\u4ee3\u8868\uff0c$i$ \u8fd9\u4e2a\u8282\u70b9\u6b64\u524d\u662f\u4e00\u4e2a\u7b26\u5408\u6761\u4ef6\u4e8c\u7684\u767d\u70b9\uff0c\u4f46\u662f\u73b0\u5728\u5b83\u67d3\u6210\u9ed1\u8272\uff0c\u4e5f\u5c31\u4e0d\u6ee1\u8db3\u6761\u4ef6\u4e8c\u4e86\uff0c\u6240\u4ee5 $val_i$ \u51cf\u4e00\u3002\n\n\u540e\u9762\u5faa\u73af\u5b83\u7684\u56db\u65b9\u8282\u70b9\u76ee\u7684\u5c31\u662f\u5904\u7406\u5b83\u662f\u767d\u70b9\u65f6\u5bf9\u5468\u56f4\u8282\u70b9\u7684\u5f71\u54cd\u3002\u6bd4\u5982\u8bf4\uff0c\u5b83\u66fe\u7ecf\u662f\u5176\u4e0b\u65b9\u8282\u70b9\u7684 `black()` \u503c\uff0c\u5f53\u65f6\u523b\u5c0f\u4e8e $i$ \u4e14\u5927\u4e8e\u7b49\u4e8e $num(r(i) + 1,c(i))$\uff0c\u4e0b\u65b9\u8282\u70b9\u5c31\u662f\u6ee1\u8db3\u6761\u4ef6\u4e00\u7684\u9ed1\u70b9\u3002\u4f46\u662f\u5f53\u8282\u70b9 $i$ \u67d3\u6210\u9ed1\u8272\u4e4b\u540e\uff0c\u5b83\uff08$i$ \u8282\u70b9\u7684\u4e0b\u65b9\u8282\u70b9\uff09\u5c31\u4e0d\u518d\u662f\u6ee1\u8db3\u6761\u4ef6\u4e00\u7684\u8282\u70b9\u4e86\uff0c\u6240\u4ee5 $val_i$ \u8981\u51cf\u4e00\u3002\u5468\u56f4\u5176\u4ed6\u65b9\u5411\u7684\u8282\u70b9\u540c\u7406\u3002\n\n## 3\n\n\u7136\u540e\u518d\u6765\u8c08\u8c08\u4ea4\u6362\u5ea7\u4f4d\u3002\n\n\u8fd9\u5176\u4e2d\u4e5f\u6d89\u53ca\u5230\u4e00\u5f00\u59cb\u4e3a\u4ec0\u4e48\u8981\u4ee5\u90a3\u6837\u7684\u6761\u4ef6\u53bb\u68c0\u6d4b\u6240\u56f4\u56fe\u5f62\u662f\u5426\u4e3a\u77e9\u5f62\u2014\u2014\u56e0\u4e3a\u8fd9\u6837\u7684\u5224\u5b9a\u65b9\u5f0f\u4e0d\u4ec5\u5feb\u548c\u65b9\u4fbf\uff0c\u800c\u4e14\u4ea4\u6362\u65f6\u4e5f\u7b80\u4fbf\u5bb9\u6613\u3002\n\n\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981\u628a\u5c06\u8981\u4ea4\u6362\u7684\u4e24\u4e2a\u8282\u70b9\u53ca\u5b83\u4eec\u5468\u56f4\u56db\u8054\u901a\u7684\u8282\u70b9\uff08\u5373\u5b83\u4eec\u4f1a\u5f71\u54cd\u5230\u7684\u8282\u70b9\uff09\u90fd\u5b58\u8d77\u6765\uff0c\u5e76\u53d6\u6d88\u5b83\u4eec\u5bf9 $val$ \u7684\u5f71\u54cd\uff0c\u7136\u540e\u518d\u4ea4\u6362\u90a3\u4e24\u4e2a\u8282\u70b9\uff0c\u518d\u7edf\u8ba1\u5b58\u8d77\u6765\u7684\u6240\u6709\u8282\u70b9\u5bf9 $val$ \u7684\u5f71\u54cd\u5373\u53ef\u3002\n\n## 4\n\n\u7efc\u4e0a\uff0c\u8003\u8651\u6211\u4eec\u8981\u8fdb\u884c\u7684\u64cd\u4f5c\u3002\u663e\u7136\uff0c\u6211\u4eec\u8981\u5b9e\u65f6\u7edf\u8ba1 $val$ \u4e2d\u6709\u591a\u5c11\u4e2a $val_i$ \u7684\u503c\u4e3a $1$\uff0c\u5e76\u4e14\u5728\u8fdb\u884c\u4ea4\u6362\u5ea7\u4f4d\u64cd\u4f5c\u65f6\uff0c\u8fd8\u8981\u5bf9 $val$ \u4e2d\u67d0\u4e00\u533a\u95f4\u7684\u503c\u8fdb\u884c\u4fee\u6539\u3002\n\n\u4e00\u8a00\u4ee5\u853d\u4e4b\uff0c\u5373\u5168\u5c40\u6700\u5c0f\u503c\u4e2a\u6570 + \u533a\u95f4\u4fee\u6539\u3002\n\n\u90a3\u4e0d\u5c31\u662f\u7ebf\u6bb5\u6811\u561b\u3002\n\n\u518d\u63d0\u4e00\u4e0b\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u5c06\u201c\u7edf\u8ba1 $val$ \u4e2d\u6709\u591a\u5c11\u4e2a $val_i$ \u7684\u503c\u4e3a $1$\u201d\u8f6c\u6362\u4e3a\u201c\u5168\u5c40\u6700\u5c0f\u503c\u4e2a\u6570\u201d\u3002\u56e0\u4e3a\u5f53\u53ea\u6709\u7b2c\u4e00\u4e2a\u8282\u70b9\u88ab\u67d3\u6210\u9ed1\u8272\u65f6\uff0c\u5b83\u5fc5\u5b9a\u662f\u4e00\u4e2a\u77e9\u5f62\uff0c\u5373 $val_1 = 1$\u3002\u6240\u4ee5\u76f4\u63a5\u7edf\u8ba1\u5168\u5c40\u6700\u5c0f\u503c\u4e2a\u6570\u5373\u53ef\u3002\n\n\u6ce8\u610f\u5c06\u4e0b\u6807\u5168\u90e8\u52a0\u4e00\u4e4b\u540e\u518d\u7edf\u8ba1\u64cd\u4f5c\u3002\n\n# Code\n\n$99$ \u884c\u7684\u6392\u5ea7\u4f4d\uff0c\u4f60\u503c\u5f97\u62e5\u6709\u3002\n\n````cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define rep(i, a, b) for(register int i = a; i <= b; ++i)\ninline int rd(){\n    int x = 1, s = 0; char ch = getchar();\n    while(ch < '0' or ch > '9'){if(ch == '-') x = -1; ch = getchar();}\n    while(ch >= '0' and ch <= '9') s = s * 10 + ch - '0', ch = getchar();\n    return x * s;\n}\nconst int inf = 2147483647;\nconst int maxn = 1e6 + 5;\n#define num(x, y) ky[(x - 1) * w + y]\n#define r(i) a[i].r\n#define c(i) a[i].c\nint h, w, q, s;\nstruct seat{\n\tint r, c;\n}a[maxn];\nint ky[maxn], val[maxn];\nint fx[4][2] = {{0, -1}, {-1, 0}, {1, 0}, {0, 1}}, st[maxn], tot;\nstruct segment_tree{\n\t#define ls(x) (x << 1)\n\t#define rs(x) (x << 1 | 1)\n\tstruct tree{\n\t\tint mn, sum, lz;\n\t}t[maxn << 2];\n\tinline void up(int i){\n\t\tint x, y; t[i].sum = 0;\n\t\tt[i].mn = min((x = t[ls(i)].mn), (y = t[rs(i)].mn));\n\t\tif(t[i].mn == x) t[i].sum += t[ls(i)].sum; \n\t\tif(t[i].mn == y) t[i].sum += t[rs(i)].sum;\n\t}\n\tinline void build(int i, int l, int r){\n\t\tif(l == r){\n\t\t\tt[i].mn = val[l], t[i].sum = 1;\n\t\t\treturn;\n\t\t}\n\t\tint mid = l + r >> 1;\n\t\tbuild(i << 1, l, mid), build(i << 1 | 1, mid + 1, r), up(i);\n\t}\n\tinline void push_down(int i){\n\t\tt[ls(i)].mn += t[i].lz, t[rs(i)].mn += t[i].lz;\n\t\tt[ls(i)].lz += t[i].lz, t[rs(i)].lz += t[i].lz;\n\t\tt[i].lz = 0;\n\t}\n\tinline void update(int i, int l, int r, int L, int R, int k){\n\t\tif(L > R) return; \n\t\tif(l >= L and r <= R){\n\t\t\tt[i].mn += k, t[i].lz += k;\n\t\t\treturn;\n\t\t} push_down(i);int mid = l + r >> 1;\n\t\tif(L <= mid) update(i << 1, l, mid, L, R, k); if(R > mid) update(i << 1 | 1, mid + 1, r, L, R, k);\n\t\tup(i);\n\t}\n}T; \ninline bool legal(int x, int y){ if(x >= 1 and x <= h and y >= 1 and y <= w) return 1; return 0;} \ninline int black(int x, int y){\n\tint mnn = inf, xx, yy;\n\trep(i, 0, 1) if(legal((xx = x + fx[i][0]), (yy = y + fx[i][1])))\n\t\tmnn = min(mnn, num(xx, yy)); \n\treturn mnn;\n}\ninline int white(int x, int y){\n\tint mnn = inf, mxn = inf, xx, yy;\n\trep(i, 0, 3) if(legal((xx = x + fx[i][0]), (yy = y + fx[i][1])))\n\t\tif(num(xx, yy) < mxn) mnn = mxn, mxn = num(xx, yy);\n\t\telse if(num(xx, yy) < mnn) mnn = num(xx, yy);\n\treturn mnn;\n}\nint main(){\n\tint xx, yy, u, v; h = rd(), w = rd(), q = rd(), s = h * w;\n\trep(i, 1, s) num((a[i].r = rd() + 1), (a[i].c = rd() + 1)) = i;\n\trep(i, 1, s){ val[i] = val[i - 1];\n\t\tif(black(r(i), c(i)) > i) val[i] += 1;\n\t\tif(white(r(i), c(i)) < i) val[i] -= 1;\n\t\trep(j, 0, 3) if(legal((xx = r(i) + fx[j][0]), (yy = c(i) + fx[j][1]))){\n\t\t\tif(black(xx, yy) == i and num(xx, yy) < i) val[i] -= 1;\n\t\t\tif(white(xx, yy) == i and num(xx, yy) > i) val[i] += 1;\n\t\t}\n\t} T.build(1, 1, s);\n\trep(i, 1, q){\n\t\tu = rd() + 1, v = rd() + 1; if(u > v) swap(u, v);\n\t\tif(u == v){ printf(\"%d\\n\", T.t[1].sum); continue;}\n\t\ttot = 0, st[++tot] = u, st[++tot] = v;\n\t\trep(j, 0, 3) if(legal((xx = r(u) + fx[j][0]), (yy = c(u) + fx[j][1]))) st[++tot] = num(xx, yy);\n\t\trep(j, 0, 3) if(legal((xx = r(v) + fx[j][0]), (yy = c(v) + fx[j][1]))) st[++tot] = num(xx, yy);\n\t\tsort(st + 1, st + tot + 1);\n\t\trep(j, 1, tot) if(st[j] != st[j - 1]){\n\t\t\tif((xx = white(r(st[j]), c(st[j]))) < st[j]) T.update(1, 1, s, max(u, xx), min(v, st[j]) - 1, -1);\n\t\t\tif((xx = black(r(st[j]), c(st[j]))) > st[j]) T.update(1, 1, s, max(u, st[j]), min(v, xx) - 1, -1);\n\t\t}\n\t\tswap(num(r(u), c(u)), num(r(v), c(v))), swap(a[u], a[v]);\n\t\trep(j, 1, tot) if(st[j] != st[j - 1]){\n\t\t\tif((xx = white(r(st[j]), c(st[j]))) < st[j]) T.update(1, 1, s, max(u, xx), min(v, st[j]) - 1, 1);\n\t\t\tif((xx = black(r(st[j]), c(st[j]))) > st[j]) T.update(1, 1, s, max(u, st[j]), min(v, xx) - 1, 1);\n\t\t}\n\t\tprintf(\"%d\\n\", T.t[1].sum);\n\t}\n}\n````\n\n\n------------\n\u611f\u8c22\u9605\u8bfb\u3002\n\n\u8f9b\u82e6\u7ba1\u7406\u5458\u5ba1\u6838\uff0c\u5982\u6709\u95ee\u9898\u70e6\u8bf7\u6307\u51fa\u3002",
        "postTime": 1657250562,
        "uid": 469672,
        "name": "\u4f0d\u53c1\u58f9",
        "ccfLevel": 7,
        "title": "\u3010LG-P4898 [IOI2018]\u3011seats \u6392\u5ea7\u4f4d"
    },
    {
        "content": "\u6b63\u89e3\u8fa3\u9ebd\u795e\u50cf\u6211\u8fd9\u79cd\u6c34\u5e73\u4e0d\u600e\u4e48\u884c\u7684OI\u9009\u624b\u600e\u4e48\u53ef\u80fd\u60f3\u5f97\u5230\u3002\u3002\u3002\u3002\u3002\u3002\n\n\u8fd9\u91cc\u7ed9\u51fa\u4e00\u79cd\u6bd4\u8f83\u81ea\u7136\u7684\u60f3\u6cd5\n\n\u6211\u4eec\u89c2\u5bdf\u4e00\u4e0b\u77e9\u5f62\u6709\u4ec0\u4e48\u7279\u70b9\uff0c\u6700\u660e\u663e\u7684\u663e\u7136\u662f\uff1a\u5b83\u6709\u56db\u4e2a\u89d2\n\n\u6240\u4ee5\u6211\u4eec\u6bcf\u52a0\u5165\u4e00\u4e2a\u70b9\uff0c\u5c31\u7ef4\u62a4\u5f53\u524d\u56fe\u5f62\u5de6\u4e0a\uff0c\u5de6\u4e0b\uff0c\u53f3\u4e0a\uff0c\u53f3\u4e0b\u89d2\u5206\u522b\u6709\u591a\u5c11\u4e2a\n\n\u5bf9\u4e8e\u4e00\u4e2a\u77e9\u5f62\u663e\u7136\u7b54\u6848\u90fd\u662f1\uff0c\u800c\u4e14\u6700\u5c0f\u4e5f\u53ea\u80fd\u662f1\u3002\u3002\u3002\u3002\u3002\u3002\n\n\u8fd9\u6837\u5c31\u80fd\u5206\u5f00\u8003\u8651\u6bcf\u4e00\u4e2a\u70b9\u5728\u4ec0\u4e48\u65f6\u5019\u4f5c\u4e3a\u5176\u4e2d\u4e00\u4e2a\u89d2\n\n\u8003\u8651\u5b83\u4f5c\u4e3a\u5de6\u4e0a\u89d2\uff0c\u5219\u5b83\u662f1\u4e14\u4e0a\u65b9\u548c\u5de6\u65b9\u7684\u663e\u7136\u662f0\n\n\u8fd9\u6837\u5c31\u5f88\u5bb9\u6613\u6c42\u51fa\u5b83\u4f5c\u4e3a\u5de6\u4e0a\u89d2\u7684\u65f6\u95f4\u6bb5\n\n\u53e6\u5916\u4e09\u79cd\u89d2\u4e5f\u662f\u8fd9\u6837\n\n\u56e0\u4e3a\u89d2\u7684\u4e2a\u6570\u6700\u5c0f\u53ea\u80fd\u662f1\uff0c\u6240\u4ee5\u7ef4\u62a4\u6700\u5c0f\u503c\u7684\u4e2a\u6570\u5c31\u884c\u4e86\n\n\u5f53\u6211\u7ec8\u4e8e\u8c03\u597d\uff0c\u6ee1\u5fc3\u6b22\u559c\u5730\u4ea4\u4e0a\u53bb\u65f6\uff0c\u53d1\u73b0WA33\u3002\u3002\u3002\u3002\u3002\u3002\n\nWhy\uff1f\uff1f\uff1f\u4e3a\u4ec0\u4e48\uff1f\uff1f\uff1f\n\n\u4ed4\u7ec6\u89c2\u5bdf\u53d1\u73b0\uff0c\u5f53\u5b83\u662f\u4e00\u4e2a\u6846\u6846\u65f6\uff0c\u6211\u5c31\u6302\u4e86\u3002\u3002\u3002\u3002\u3002\u3002\n\n\u518d\u6765\u89c2\u5bdf\u5b83\u548c\u6846\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u77e9\u5f62\u4e2d\u95f4\u662f\u6ca1\u67090\u7684\uff0c\u6240\u4ee5\u4e0d\u5b58\u5728\u4e00\u4e2a0\u4f7f\u5f97\u5de6\u8fb9\u548c\u4e0a\u8fb9\u662f1\uff0c\u800c\u6846\u4e00\u5b9a\u5b58\u5728\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u628a\u6846\u548c\u77e9\u5f62\u533a\u522b\u5f00\u6765\u8fa3\n\n\u4fee\u6539\u7684\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u5148\u51cf\u6389\u539f\u6570\u7684\u8d21\u732e\uff0c\u518d\u5bf9\u8c03\u52a0\u8fdb\u53bb\uff0c\u7136\u800c\u5728\u8fd9\u4e24\u4e2a\u6570\u76f8\u90bb\u7684\u65f6\u5019\u53c8\u9505\u4e86~~~\n\n\u5220\u6389\u4e00\u4e2a\u6570\u7684\u65f6\u5019\uff0c\u539f\u6765\u4f4d\u7f6e\u5c31\u6210\u4e86\u7a7a\u4f4d\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u585e\u4e00\u4e2ah\\*w+1\u8fdb\u53bb\uff0c\u7136\u540e\u518d\u628a\u5b83\u79fb\u5230\u76ee\u6807\u4f4d\u7f6e\uff0c\u518d\u5220\u6389\u8fd9\u4e2ah\\*w+1\uff0c\u518d\u628a\u53e6\u4e00\u4e2a\u6570\u585e\u56de\u6765\n\n\u590d\u6742\u5ea6O(nlogn)\uff0c\u5e38\u6570\u5de8\u5927\uff08\u8fd9\u6837\u53ea\u662f\u60f3\u6cd5\u6bd4\u8f83\u5bb9\u6613\uff0c~~\u7ebf\u6bb5\u6811\u7ef4\u62a45\u4e2a\u503c\u8fd8\u4e0d\u88ab\u6b63\u89e3\u6253\u7206~~\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef long long LL;\nconst long long M=1000000007;\n#define ri register int \n#define rl register long long\nint h,w,q,a[1000005],x[1000005],y[1000005],mnn[4000005],u,v,n;\ninline char nc(){\n    static char buf[100000],*p1=buf,*p2=buf;\n    return p1==p2&&(p2=(p1=buf)+fread(buf,1,100000,stdin),p1==p2)?EOF:*p1++;\n}\ninline int read(){\n    char ch=nc();int sum=0;\n    while(!(ch>='0'&&ch<='9'))ch=nc();\n    while(ch>='0'&&ch<='9')sum=sum*10+ch-48,ch=nc();\n    return sum;\n}\ninline int d(int x,int y)\n{\n\tif(x==0||y==0||x>h||y>w)\n\t\treturn 0;\n\treturn (x-1)*w+y;\n}\nstruct str{\n\tint a[5];\n}tree[4000005],lazy[4000005];\ninline bool cmp(str a,str b)\n{\n\tif(a.a[0]!=b.a[0])\n\t\treturn a.a[0]<b.a[0];\n\tif(a.a[1]!=b.a[1])\n\t\treturn a.a[1]<b.a[1];\n\tif(a.a[2]!=b.a[2])\n\t\treturn a.a[2]<b.a[2];\n\tif(a.a[3]!=b.a[3])\n\t\treturn a.a[3]<b.a[3];\n\treturn a.a[4]<b.a[4];\n}\nbool operator ==(str a,str b)\n{\n\treturn (a.a[0]==b.a[0])&&(a.a[1]==b.a[1])&&(a.a[2]==b.a[2])&&(a.a[3]==b.a[3])&&(a.a[4]==b.a[4]);\n}\nvoid pushup(int i)\n{\n\tif(cmp(tree[i<<1],tree[i<<1|1]))\n\t\ttree[i]=tree[i<<1];\n\telse\n\t\ttree[i]=tree[i<<1|1];\n\tmnn[i]=0;\n\tif(tree[i]==tree[i<<1])\n\t\tmnn[i]=mnn[i<<1];\n\tif(tree[i]==tree[i<<1|1])\n\t\tmnn[i]+=mnn[i<<1|1];\n\ttree[i].a[0]+=lazy[i].a[0];\n\ttree[i].a[1]+=lazy[i].a[1];\n\ttree[i].a[2]+=lazy[i].a[2];\n\ttree[i].a[3]+=lazy[i].a[3];\n\ttree[i].a[4]+=lazy[i].a[4];\n}\nvoid modify(int i,int l,int r,int ll,int rr,int x,int y)\n{\n\tif(l>=ll&&r<=rr)\n\t{\n\t\tlazy[i].a[x]+=y;\n\t\ttree[i].a[x]+=y;\n\t\treturn;\n\t}\n\tint mid=l+r>>1;\n\tif(mid>=ll)\n\t\tmodify(i<<1,l,mid,ll,rr,x,y);\n\tif(mid<rr)\n\t\tmodify(i<<1|1,mid+1,r,ll,rr,x,y);\n\tpushup(i);\n}\nvoid Cirno(int i,int j,int t)\n{\n\tif(min(a[d(i-1,j)],a[d(i,j-1)])>a[d(i,j)])\n\t\tmodify(1,1,n,a[d(i,j)],min(a[d(i-1,j)],a[d(i,j-1)])-1,0,t);\n\tif(min(a[d(i+1,j)],a[d(i,j-1)])>a[d(i,j)])\n\t\tmodify(1,1,n,a[d(i,j)],min(a[d(i+1,j)],a[d(i,j-1)])-1,1,t);\n\tif(min(a[d(i-1,j)],a[d(i,j+1)])>a[d(i,j)])\n\t\tmodify(1,1,n,a[d(i,j)],min(a[d(i-1,j)],a[d(i,j+1)])-1,2,t);\n\tif(min(a[d(i+1,j)],a[d(i,j+1)])>a[d(i,j)])\n\t\tmodify(1,1,n,a[d(i,j)],min(a[d(i+1,j)],a[d(i,j+1)])-1,3,t);\n\tif(max(a[d(i-1,j)],a[d(i,j-1)])<a[d(i,j)])\n\t\tmodify(1,1,n,max(a[d(i-1,j)],a[d(i,j-1)]),a[d(i,j)]-1,4,t);\n\tif(i!=h)\n\t{\n\t\tif(min(a[d(i,j)],a[d(i+1,j+1)])>a[d(i+1,j)])\n\t\t\tmodify(1,1,n,a[d(i+1,j)],min(a[d(i,j)],a[d(i+1,j+1)])-1,2,t);\n\t\tif(min(a[d(i,j)],a[d(i+1,j-1)])>a[d(i+1,j)])\n\t\t\tmodify(1,1,n,a[d(i+1,j)],min(a[d(i,j)],a[d(i+1,j-1)])-1,0,t);\n\t\tif(max(a[d(i,j)],a[d(i+1,j-1)])>a[d(i+1,j)])\n\t\t\tmodify(1,1,n,max(a[d(i,j)],a[d(i+1,j-1)]),a[d(i+1,j)]-1,4,t);\n\t}\n\tif(j!=w)\n\t{\n\t\tif(min(a[d(i,j)],a[d(i+1,j+1)])>a[d(i,j+1)])\n\t\t\tmodify(1,1,n,a[d(i,j+1)],min(a[d(i,j)],a[d(i+1,j+1)])-1,1,t);\n\t\tif(min(a[d(i,j)],a[d(i-1,j+1)])>a[d(i,j+1)])\n\t\t\tmodify(1,1,n,a[d(i,j+1)],min(a[d(i,j)],a[d(i-1,j+1)])-1,0,t);\n\t\tif(max(a[d(i-1,j+1)],a[d(i,j)])>a[d(i,j+1)])\n\t\t\tmodify(1,1,n,max(a[d(i-1,j+1)],a[d(i,j)]),a[d(i,j+1)]-1,4,t);\n\t}\n\tif(i!=1)\n\t{\n\t\tif(min(a[d(i,j)],a[d(i-1,j+1)])>a[d(i-1,j)])\n\t\t\tmodify(1,1,n,a[d(i-1,j)],min(a[d(i,j)],a[d(i-1,j+1)])-1,3,t);\n\t\tif(min(a[d(i,j)],a[d(i-1,j-1)])>a[d(i-1,j)])\n\t\t\tmodify(1,1,n,a[d(i-1,j)],min(a[d(i,j)],a[d(i-1,j-1)])-1,1,t);\n\t}\n\tif(j!=1)\n\t{\n\t\tif(min(a[d(i,j)],a[d(i+1,j-1)])>a[d(i,j-1)])\n\t\t\tmodify(1,1,n,a[d(i,j-1)],min(a[d(i,j)],a[d(i+1,j-1)])-1,3,t);\n\t\tif(min(a[d(i,j)],a[d(i-1,j-1)])>a[d(i,j-1)])\n\t\t\tmodify(1,1,n,a[d(i,j-1)],min(a[d(i,j)],a[d(i-1,j-1)])-1,2,t);\n\t}\n}\nvoid Build(int i,int l,int r)\n{\n\tif(l==r)\n\t{\n\t\tmnn[i]=1;\n\t\treturn;\n\t}\n\tint mid=l+r>>1;\n\tBuild(i<<1,l,mid);\n\tBuild(i<<1|1,mid+1,r);\n\tmnn[i]=mnn[i<<1]+mnn[i<<1|1];\n}\nint main()\n{\n\th=read(),w=read(),q=read();\n\tn=h*w;\n\tfor(ri i=1;i<=n;++i)\n\t{\n\t\tx[i]=read(),y[i]=read();\n\t\t++x[i],++y[i];\n\t\ta[d(x[i],y[i])]=i;\n\t}\n\tBuild(1,1,n);\n\ta[0]=n+1;\n\tfor(ri i=1;i<=h;++i)\n\t\tfor(ri j=1;j<=w;++j)\n\t\t{\n\t\t\tif(min(a[d(i-1,j)],a[d(i,j-1)])>a[d(i,j)])\n\t\t\t\tmodify(1,1,n,a[d(i,j)],min(a[d(i-1,j)],a[d(i,j-1)])-1,0,1);\n\t\t\tif(min(a[d(i+1,j)],a[d(i,j-1)])>a[d(i,j)])\n\t\t\t\tmodify(1,1,n,a[d(i,j)],min(a[d(i+1,j)],a[d(i,j-1)])-1,1,1);\n\t\t\tif(min(a[d(i-1,j)],a[d(i,j+1)])>a[d(i,j)])\n\t\t\t\tmodify(1,1,n,a[d(i,j)],min(a[d(i-1,j)],a[d(i,j+1)])-1,2,1);\n\t\t\tif(min(a[d(i+1,j)],a[d(i,j+1)])>a[d(i,j)])\n\t\t\t\tmodify(1,1,n,a[d(i,j)],min(a[d(i+1,j)],a[d(i,j+1)])-1,3,1);\n\t\t\tif(max(a[d(i-1,j)],a[d(i,j-1)])<a[d(i,j)])\n\t\t\t\tmodify(1,1,n,max(a[d(i-1,j)],a[d(i,j-1)]),a[d(i,j)]-1,4,1);\n\t\t}\n\twhile(q--)\n\t{\n\t\tu=read(),v=read();\n\t\t++u,++v;\n\t\tCirno(x[u],y[u],-1);\n\t\tint tmp=a[d(x[u],y[u])];\n\t\ta[d(x[u],y[u])]=n+1;\n\t\tCirno(x[u],y[u],1);\n\t\tCirno(x[v],y[v],-1);\n\t\tint t=a[d(x[v],y[v])];\n\t\ta[d(x[v],y[v])]=tmp;\n\t\tCirno(x[v],y[v],1);\n\t\tCirno(x[u],y[u],-1);\n\t\ta[d(x[u],y[u])]=t;\n\t\tCirno(x[u],y[u],1);\n\t\tswap(x[u],x[v]);\n\t\tswap(y[u],y[v]);\n\t\tprintf(\"%d\\n\",mnn[1]);\n\t}\n}\n```\n\n\n",
        "postTime": 1568720376,
        "uid": 17974,
        "name": "\u2468_Cirno_",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4898 \u3010[IOI2018] seats \u6392\u5ea7\u4f4d\u3011"
    }
]