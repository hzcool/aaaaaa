[
    {
        "content": "# USACO 2021 Feb T3 Count the Cows G\n\n## \u5206\u6790\n\n\u9996\u5148\u8f6c\u5316\u9898\u610f\uff0c\u5206\u6790\u9898\u4e2d\u6240\u7ed9\u51fa\u7684 $\\lfloor\\frac{x}{3^k}\\rfloor$ \u548c $\\lfloor\\frac{y}{3^k}\\rfloor$\uff1a\n\n\u5bf9\u4e8e\u5411\u4e0b\u53d6\u6574\uff0c\u6211\u4eec\u6240\u62e5\u6709\u7684\u6280\u5de7\u76f8\u5bf9\u8f83\u5c11\uff0c\u6211\u4eec\u4e0d\u59a8\u5c06\u5176\u5199\u6210\u5982\u4e0b\u5f62\u5f0f\uff1a\n$$\nx = 3^ka + r_0\n$$\n$$\ny = 3^kb + r_1\n$$\n\u5176\u4e2d $r_0, r_1 \\le 3^k - 1$\uff0c\u90a3\u4e48\u6211\u4eec\u6240\u5206\u6790\u7684\u6761\u4ef6\u53ef\u8f6c\u5316\u4e3a $a, b$ \u4e4b\u95f4\u7684\u5173\u7cfb\u3002\n\n\u63a5\u4e0b\u6765\u5206\u6790 $a, b$ \u7684\u6027\u8d28\n\n\u6211\u4eec\u89c2\u5bdf\u5230\u5bf9\u4e8e\u4e0d\u540c\u7684 $k$ \u503c, $a, b$ \u7684\u7cfb\u6570\u59cb\u7ec8\u662f $3$ \u7684\u6b21\u5e42\uff0c\u800c\u9898\u76ee\u4e2d\u6240\u7ed9\u7684\u5173\u7cfb\u4e2d\u51fa\u73b0\u4e86\u5bf9\u4e8e $3$ \u7684\u4f59\u6570\uff0c\u8fd9\u542f\u53d1\u6211\u4eec\u5c06 $a,b$ \u4e2d\u518d\u63d0\u51fa\u4e00\u4e2a $3$ \u6765\u3002\u90a3\u4e48\u6709\n$$\nx = 3^k(3p_x + q_x) + r_0\n$$\n$$\ny = 3^k(3p_y + q_y) + r_1\n$$\n\u9898\u76ee\u4e2d\u7684\u5173\u7cfb\u53ef\u8f6c\u5316\u4e3a $q_x \\equiv q_y \\pmod{2}$\u3002\n\n\u6211\u4eec\u53d1\u6398\u51fa\u4e86\u5bf9\u4e8e\u5355\u4e00\u7684 $k$ \u5176\u5177\u6709\u7684\u6027\u8d28\uff0c\u8003\u8651\u5bf9\u4e8e\u6240\u6709\u7684 $k$\n\n\u5c55\u5f00\u4e0a\u5f0f\n$$\nx = 3^{k + 1}p_x + 3_{k}q_x + r_0\n$$\n$$\ny = 3^{k + 1}p_y + 3_{k}q_y + r_1\n$$\n\u6211\u4eec\u53d1\u73b0\u6709\u5927\u91cf $3$ \u7684\u6b21\u5e42\uff0c\u8fd9\u542f\u53d1\u6211\u4eec\u5c1d\u8bd5\u5c06 $r$ \u4e5f\u5199\u6210 $3$ \u7684\u6b21\u5e42\u76f8\u52a0\u7684\u5f62\u5f0f\n\n$$\nx = \\sum_{k = 0} 3^k a_{k}\n$$\n$$\ny = \\sum_{k = 0} 3^k b_{k}\n$$\n\n\u9898\u76ee\u6240\u7ed9\u5173\u7cfb\u8f6c\u5316\u4e3a $\\forall k, a_k \\equiv b_k \\pmod{2}$\u3002\n\n\u6839\u636e\u6211\u4eec\u7684\u7ecf\u9a8c\uff0c\u6211\u4eec\u53d1\u73b0\u4e0a\u5f0f\u4e2d\u7684\u5f62\u5f0f\u5c31\u662f $x, y$ \u7684\u4e09\u8fdb\u5236\uff0c\u8981\u6c42\u8f6c\u5316\u4e3a $x, y$ \u4e09\u8fdb\u5236\u4e0b\u6bcf\u4e00\u4f4d\u5173\u4e8e $2$ \u540c\u4f59\u3002\n\n\u8fd9\u4e2a\u7ed3\u8bba\u5bf9\u6211\u4eec\u6765\u8bf4\u5927\u6709\u813e\u76ca\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u662f\u6c42\u6709\u591a\u5c11\u7684 $d \\in [d, d_0]$ \u6ee1\u8db3 $x_0 + d$ \u4e0e $y_0 + d$ \u4e09\u8fdb\u5236\u6bcf\u4e00\u4f4d\u4e0b\u5173\u4e8e $2$ \u540c\u4f59\u3002\u6211\u4eec\u53ef\u4ee5\u5f88\u5bb9\u6613\u8054\u60f3\u5230\u6570\u4f4dDP, \u8bbe\u72b6\u6001\u4e3a\u5f53\u524dDP\u5230\u591a\u5c11\u4f4d\uff0c$x_0 + d$\uff0c$y_0 + d$ \u7684\u66f4\u4f4e\u4f4d\u5728\u505a\u52a0\u6cd5\u65f6\u6709\u6ca1\u6709\u8fdb\u4f4d \uff0c\u7531\u9ad8\u4f4d\u5411\u4f4e\u4f4dDP\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(q\\log x)$\u3002\n\n## \u5b9e\u73b0\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst static int mlg = 40;\n#define int long long\nint f[mlg][2][2][2];\nbool vis[mlg][2][2][2];\nint Ab[mlg], Bb[mlg], lb[mlg];\nbool check(int a, int b) {\n\tif (a < 0 || b < 0 || a > 2 || b > 2)\n\t  return false;\n  else if ((a & 1) == (b & 1))\n    return true;\n  else\n    return false;\n}\ntypedef long long inte;\ninline int dfs(int p/*\u7b2c\u51e0\u4f4d*/, bool a/*x \u662f\u5426\u8fdb\u4f4d*/, bool b/*y \u662f\u5426\u8fdb\u4f4d*/, bool lim/*d \u662f\u5426\u88ab\u9876\u6ee1*/) {\n\tif (p < 0)\n\t  return (a == 0) && (b == 0);\n\tif (vis[p][a][b][lim])\n\t  return f[p][a][b][lim];\n  vis[p][a][b][lim] = true;\n\tinte ans = 0;\n\tfor (int v = 0; v <= (lim ? lb[p] : 2); ++v) {\n\t\tfor (int ak = 0; ak <= 1; ++ak) {\n\t\t\tfor (int bk = 0; bk <= 1; ++bk) {\n\t\t\t\tif (check(Ab[p] - 3 * a + v + ak, Bb[p] - 3 * b + v + bk)) {\n\t\t\t\t\tans += dfs(p - 1, ak, bk, lim & (v == lb[p]));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn f[p][a][b][lim] = ans;\n}\nsigned main()\n{\n    ios::sync_with_stdio(false);\n    cin.tie(0);\n\tint Q;\n\tcin >> Q;\n\twhile (Q--) {\n\t\tinte x, y, d;\n\t\tcin >> d >> x >> y;\n\t\tmemset(vis, 0, sizeof(vis));\n\t\tfor (int i = 0; i < mlg; ++i) {\n\t\t\tAb[i] = x % 3;\n\t\t\tx /= 3;\n\t\t\tBb[i] = y % 3;\n\t\t\ty /= 3;\n\t\t\tlb[i] = d % 3;\n\t\t\td /= 3;\n\t\t}\n\t\tcout << dfs(mlg - 1, 0, 0, true) << endl;\n\t}\n  return 0;\n}\n```\n\n\n\n",
        "postTime": 1615099188,
        "uid": 73707,
        "name": "green_orange",
        "ccfLevel": 7,
        "title": "USACO 2021 Feb T3 Count the Cows G"
    },
    {
        "content": "## \u9898\u610f\u8f6c\u5316\n\n\u9898\u76ee\u7684\u8981\u6c42\u770b\u8d77\u6765\u5f88\u590d\u6742\uff0c\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u5c1d\u8bd5\u6253\u4e00\u4e2a\u8868\uff0c\u8f93\u51fa\u524d\u9762\u77e9\u9635\u653e\u7f6e\u5976\u725b\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u4e0d\u96be\u53d1\u73b0\uff0c\u9898\u76ee\u7684\u77e9\u9635\u5c31\u662f\u5982\u4e0b\u77e9\u9635\uff1a\n\n1 0 1\n\n0 1 0\n\n1 0 1\n\n\u5bf9\u4e8e\u8fd9\u4e2a\u57fa\u672c\u77e9\u9635\uff0c\u6309\u7167\u5982\u4e0a\u7684\u6446\u653e\u65b9\u5f0f\u751f\u6210\u66f4\u5927\u7684\u77e9\u9635\uff0c\u4f9d\u6b21\u7c7b\u63a8\u3002\n\n\u4e8e\u662f\u9898\u76ee\u5c31\u8f6c\u5316\u4e3a\uff0c\u5bf9\u4e8e\u8fd9\u4e2a\u9012\u5f52\u5f0f\u7684\u77e9\u9635\uff0c\u6c42\u51fa $(x,y)$ \u5230 $(x+d,y+d)$ \u5bf9\u89d2\u7ebf\u4e0a $1$ \u7684\u4e2a\u6570\u3002\n\n\u6ce8\uff1a\u5bb9\u6613\u53d1\u73b0\uff0c\u4e0a\u65b9\u56fe\u5f62\u6cbf\u5bf9\u89d2\u7ebf\u5bf9\u79f0\uff0c\u6240\u4ee5\u6211\u4eec\u5047\u8bbe $x\\leq y$\u3002\n\n## \u95ee\u9898\u8f6c\u5316\n\n\u770b\u5230\u6709 $y=0$ \u7684\u90e8\u5206\u5206\uff0c\u4e8e\u662f\u8003\u8651\u5c06\u6240\u6709\u6570\u636e\u8f6c\u5316\u6210 $y=0$ \u7684\u60c5\u51b5\u3002\n\n\u8bbe $f_{i,j,n}$ \u8868\u793a\u4ece $(0,0)$ \u5230 $(i,j)$ \u5bf9\u89d2\u7ebf\u4e0a $1$ \u7684\u4e2a\u6570\uff0c\u5176\u4e2d\uff0c $n$ \u662f\u5de6\u4e0a\u89d2\u4e3a\u539f\u70b9\u3001\u5305\u542b\u6574\u6761\u5bf9\u89d2\u7ebf\u7684\u6b63\u65b9\u5f62\u7684\u8fb9\u957f\u3002\n\n\u90a3\u4e48\uff0c$(x,y)$ \u5230 $(x+d,y+d)$ \u5bf9\u89d2\u7ebf\u4e0a $1$ \u7684\u4e2a\u6570\u5c31\u53ef\u4ee5\u8f6c\u5316\u4e3a $f_{x+d,y+d,n}-f_{x-1,y-1,n'}$\uff08\u524d\u7f00\u548c\u601d\u60f3\uff09\u3002\n\n\u4e8e\u662f\uff0c\u73b0\u5728\u95ee\u9898\u5c31\u8f6c\u5316\u4e3a\u6c42 $f_{i,j,n}$ \u7684\u503c\u4e86\u3002\n\n## \u95ee\u9898\u6c42\u89e3\n\n\u4ee5\u4e0b\u56fe\u4e3a\u4f8b\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/4t887qt1.png)\n\n\n\u8bbe\u73b0\u5728\u8981\u6c42\u7684\u662f $f_{x,y,n}$\uff0c\u5982\u56fe\u662f\u8fb9\u957f\u4e3a $n$\u3001\u5de6\u4e0a\u89d2\u4e3a $(0,0)$ \u7684\u6b63\u65b9\u5f62\uff0c\u7f16\u53f7\u4e3a\u5b50\u77e9\u9635\u7f16\u53f7\u3002\n\n\u53e6\u5916\u5730\uff0c\u4e3a\u4e86\u8868\u793a\u7b80\u4fbf\uff0c\u518d\u8bbe $g_{i,n}$ \u8868\u793a\u4ece $(0,i)$ \u51fa\u53d1\u7684\u5bf9\u89d2\u7ebf\u5728\u5de6\u4e0a\u89d2\u4e3a $(0,0)$\u3001\u8fb9\u957f\u4e3a $n$ \u7684\u6b63\u65b9\u5f62\u4e2d $1$ \u7684\u4e2a\u6570\u3002\n\n\u8bbe $z=x-y$\uff08\u5373\u7ebf\u6bb5\u5ef6\u957f\u81f3 $y=0$ \u65f6\u7684 $x$ \u5750\u6807\uff09\uff0c$m=n/3$\uff08\u5373\u5b50\u77e9\u9635\u8fb9\u957f\uff09\u3002\n\n**\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\uff0c$f_{x,y,n}$ \u5206\u522b\u7b49\u4e8e\uff1a**\n\n\n- \u7ebf\u6bb5\u4ece\u77e9\u9635 $1$ \u51fa\u53d1\uff08$z<m$\uff09\n\t\n    - \u5230\u77e9\u9635 $1$ \u7ed3\u675f\uff08$x<m,y<m$\uff09\uff1a$f_{x,y,m}$\n    \n    - \u5230\u77e9\u9635 $4$ \u7ed3\u675f\uff08$m\\leq x<2m,y<m$\uff09\uff1a$g_{z,m}$\n   \n    - \u5230\u77e9\u9635 $5$ \u7ed3\u675f\uff08$m\\leq x< 2m,m\\leq y<2m$\uff09\uff1a$f_{x-m,y-m,m}+g_{z,m}$\n    \n    - \u5230\u77e9\u9635 $8$ \u7ed3\u675f\uff08$x\u22652m,m\\leq y< 2m$\uff09\uff1a$2\\times g_{z,m}$\n    \n    - \u5230\u77e9\u9635 $9$ \u7ed3\u675f\uff08$x\u22652m,y\u22652m$\uff09\uff1a$2\\times g_{z,m}+f_{x-2m,y-2m,m}$\n    \n- \u7ebf\u6bb5\u4ece\u77e9\u9635 $4$ \u51fa\u53d1 \uff08$m\\leq z<2m$\uff09\n\t\n    - \u5230\u77e9\u9635 $4$ \u7ed3\u675f\uff08$m\\leq x<2m,y<m$\uff09\uff1a$0$\n    \n    - \u5230\u77e9\u9635 $8$ \u7ed3\u675f\uff08$x\u22652m,m\\leq y<2m$\uff09\n    \t- \u672a\u7ecf\u8fc7\u77e9\u9635 $7$\uff08$z=m$\uff09\uff1a$0$\n        - \u7ecf\u8fc7\u77e9\u9635 $7$\uff08$m<z<2m$\uff09\uff1a$g_{2m-z,m}$\n    \n    - \u5230\u77e9\u9635 $7$ \u7ed3\u675f \uff08$x\u22652m,y<m$\uff09\uff1a$f_{x-2m,y,m}$\n\t\t\n\n- \u7ebf\u6bb5\u4ece\u77e9\u9635 $7$ \u51fa\u53d1\uff08$z\u22652m$\uff09\n\n\t- \u6240\u6709\u60c5\u51b5\u90fd\u4e0e\u4ece\u77e9\u9635 $1$ \u51fa\u53d1\u5bf9\u79f0\uff0c\u8fd4\u56de $f_{x-2m,y,m}$\n    \n(\u7531\u4e8e $y\\leq x$\uff0c\u6240\u4ee5 $2,3,6$ \u53f7\u77e9\u9635\u4e0d\u53ef\u80fd\u7ecf\u8fc7)\n\n**\u8fb9\u754c\u6761\u4ef6**\uff1a\u5f53 $n=3$ \u65f6\u7279\u5224\u7b54\u6848\u3002\n\n-----\n\n\u5230\u8fd9\u91cc\uff0c\u8fd9\u9053\u9898\u57fa\u672c\u5c31\u505a\u5b8c\u4e86\uff0c\u552f\u4e00\u7684\u95ee\u9898\u5c31\u662f $g$ \u7684\u8f6c\u79fb\u3002\u5176\u5b9e\uff0c\u7531\u4e8e\u5bf9\u89d2\u7ebf\u4e00\u5b9a\u7a7f\u8fc7\u5bf9\u5e94\u6b63\u65b9\u5f62\uff0c\u6240\u4ee5\uff0c\u5206\u522b\u4ece $1,4,7$ \u53f7\u77e9\u9635\u51fa\u53d1\u7684\u5bf9\u89d2\u7ebf\uff0c\u4e00\u5b9a\u4f1a\u5206\u522b\u5728 $9,8,7$ \u53f7\u77e9\u9635\u7ed3\u675f\u3002\u4e8e\u662f\u5c31\u53ef\u4ee5\u6309\u7167 $f$ \u6570\u7ec4\u8f6c\u79fb\u4e2d\u7684\u4e09\u79cd\u60c5\u51b5\u6765\u8f6c\u79fb $g$ \u6570\u7ec4\u4e86\u3002\n\n## \u4ee3\u7801\n\n\u5177\u4f53\u770b\u6ce8\u91ca\u8db4\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int maxn=41;\ninline ll read()\n{\n    register ll x=0;\n    register char c=getchar();\n    for(;!(c>='0'&&c<='9');c=getchar());\n    for(;c>='0'&&c<='9';c=getchar())\n        x=(x<<1)+(x<<3)+c-'0';\n    return x;\n}\nconst int biao[3][3]={{1,0,1},\n\t\t\t\t\t  {0,2,0},\n\t\t\t\t\t  {1,0,3}};\n//n=3 \u65f6\u7684\u7279\u5224\nint q;\nll G(ll z,ll n)//g \u7684\u8f6c\u79fb\n{\n\tregister ll m=n/3;\n\tif(n==3) \n\t\treturn biao[2][2-z];\n  //\u8fb9\u754c\u6761\u4ef6\uff08\u6ce8\u610f\uff0c\u672c\u9898\u90fd\u662f\u4ece 0 \u8ba1\u6570\uff09\n\tif(z<m)\n\t\treturn 3*G(z,m);\n\telse if(z==m)\n\t\treturn 0;\n\telse if(z<(m<<1))\n\t\treturn G(m*2-z,m);\n\telse\n\t\treturn G(z-m*2,m);\n  //\u6309\u7167\u65b9\u7a0b\u5206\u60c5\u51b5\u8f6c\u79fb\n}\nll F(ll x,ll y,ll n)\n{\n\tif(n==3)\n\t\treturn biao[x][y];\n\tif(y>x) \n\t\tswap(x,y);\n\tregister ll m=n/3,z=x-y;\n\tif(z<m)\n\t{\n\t\tif(x<m&&y<m)\n\t\t\treturn F(x,y,m);\n\t\tif(y<m&&x>=m&&x<2*m)\n\t\t\treturn G(z,m);\n\t\tif(x>=m&&x<2*m&&y>=m&&y<2*m)\n\t\t\treturn G(z,m)+F(x-m,y-m,m);\n\t\tif(x>=2*m&&y>=m&&y<2*m)\n\t\t\treturn G(z,m)*2;\n\t\tif(x>=2*m&&y>=2*m)\n\t\t\treturn G(z,m)*2+F(x-m*2,y-m*2,m);\n\t}\n\tif(z>=m&&z<2*m)\n\t{\n\t\tif(x<2*m&&x>=m&&y<m)\n\t\t\treturn 0;\n\t\tif(y>=m&&y<2*m&&x>=2*m)\n\t\t{\n\t\t\tif(z==m)\n\t\t\t\treturn 0;\n\t\t\tif(z>m&&z<2*m)\n\t\t\t    return G(2*m-z,m);\n\t\t}\n\t\tif(x>=2*m&&y<m)\n\t\t\treturn F(x-2*m,y,m);\n\t}\n\tif(z>=2*m)\n\t\treturn F(x-2*m,y,m);\n \t//\u6309\u7167\u65b9\u7a0b\u5206\u60c5\u51b5\u8f6c\u79fb\n}\nll Work(ll x,ll y)\n{\n\tif(x<0||y<0) return 0;\n\tif(y>x) swap(x,y);\n\tregister ll sum=1;\n\twhile(sum<=x)\n\t\tsum*=3;//\u53d6 n \u7684\u503c(\u7b2c\u4e00\u4e2a\u5927\u4e8e max{x,y} \u76843\u7684\u6574\u6570\u6b21\u5e42)\n\treturn F(x,y,sum); \n}\nint main()\n{\n\tregister ll d,x,y;\n\tq=read();\n\twhile(q--)\n\t{\n\t\td=read(),x=read(),y=read();\n\t\tprintf(\"%lld\\n\",Work(x+d,y+d)-Work(x-1,y-1));\n\t}\n    return 0;\n}\n```\nTipes\uff1a\u4e3a\u4e86\u6613\u61c2\uff0c\u672c\u4ee3\u7801\u4f1a\u7a0d\u6709\u4e9b\u5197\u957f\u3002\u5927\u5bb6\u53ef\u4ee5\u81ea\u884c\u4f18\u5316~",
        "postTime": 1620303990,
        "uid": 288716,
        "name": "lzqy_",
        "ccfLevel": 7,
        "title": "P7415 [USACO21FEB] Count the Cows G \u9898\u89e3"
    },
    {
        "content": "## USACO 21 Feb G T3 \u9898\u89e3\n\n## \u9898\u610f\n$$\\colorbox{BLUE}{\\color{BLUE}x}\\colorbox{red}{\\color{red}x}\\colorbox{BLUE}{\\color{BLUE}x}\n\\\\\n\\colorbox{red}{\\color{red}x}\\colorbox{blue}{\\color{blue}x}\\colorbox{red}{\\color{red}x}\n\\\\\n\\colorbox{BLUE}{\\color{BLUE}x}\\colorbox{red}{\\color{red}x}\\colorbox{BLUE}{\\color{BLUE}x}\n$$\n\u5b9a\u4e49\u4ee5\u4e0a $3\\times3$ \u77e9\u9635\u4e3a\u4e00\u9636\u6807\u51c6\u77e9\u9635\u3002\n\n\u5bf9\u4e8e $i$ \u9636\u6807\u51c6\u77e9\u9635\uff0c$i\\ge2$\uff0c\u662f\u4e00\u4e2a $3^i\\times3^i$ \u7684\u77e9\u9635\uff0c\u5c06\u5176\u6a2a\u7eb5\u5750\u6807\u5206\u522b\u4e09\u7b49\u5206\uff0c\u5e76\u5728\u5bf9\u89d2\u7ebf\u548c\u53cd\u5bf9\u89d2\u7ebf\u4e0a\u7684 $5$ \u4e2a\u77e9\u5f62\u533a\u57df\u586b\u4e0a\u4e00\u4e2a $i-1$ \u9636\u77e9\u9635\u3002\n\n\u9898\u76ee\u7ed9\u5b9a $Q$ \u4e2a\u8be2\u95ee\uff0c\u6bcf\u4e2a\u8be2\u95ee\u67e5\u8be2\uff0c\u5728\u65e0\u9650\u9636\u7684\u6807\u51c6\u77e9\u9635\u4e2d\uff0c\u4ee5 $(x,y)$ \u548c $(x+d,y+d)$ \u4e3a\u7aef\u70b9\u7684\u5bf9\u89d2\u7ebf\u4e0a\u6709\u51e0\u4e2a\u84dd\u8272\u65b9\u5757\u3002 \n\n$Q \\le 10^4,x,y,d\\le10^{18}$\u3002\n\n## \u5206\u6790\n1. \u9996\u5148\u6574\u4e2a\u65e0\u9650\u5927\u7684\u77e9\u9635\u5173\u4e8e $y=x$ \u5bf9\u79f0\uff0c\u6240\u4ee5\u4e0d\u59a8\u4ee4 $x \\le y$\uff0c\u628a\u6240\u6709 $x,y$ \u90fd\u642c\u5230\u53f3\u4e0a\u89d2\u3002\n\n2. \u5c06\u5bf9\u89d2\u7ebf\u53d8\u6210\u201c\u524d\u7f00\u51cf\u524d\u7f00\u201d\u7684\u5f62\u5f0f\uff0c\u6bcf\u6b21\u53ea\u8981\u67e5\u8be2\u201c\u524d\u7f00\u201d\uff0c\u6bd4\u5982 $(x,y)$ \u524d\u7f00\u4e3a $(0,y-x)$ \u5230 $(x,y)$\uff0c\u5176\u4e2d $x \\le y$\u3002\n\n3. \u5c06 $(x,y)$ \u5957\u5165\u4e00\u4e2a $i$ \u9636\u77e9\u9635\uff0c\u4f7f\u5f97 $\\max(x,y)\\le3^i$\u3002\n\n## \u5206\u6cbb\n$calc_{v,n}$  \u51fd\u6570\u610f\u4e49\uff1a\u76f4\u7ebf $y=x+v$ \u51fd\u6570\u6240\u7ecf\u8fc7\u7684\u84dd\u8272\u683c\u5b50\u5728\u4e00\u4e2a $i$ \u9636\u6807\u51c6\u77e9\u9635\u6709\u51e0\u4e2a\uff0c\u5176\u4e2d $n=3^i$\uff0c$v<n$\u3002\uff08$x$ \u6a2a $y$ \u7eb5\uff09\n\n$query_{x,y,n}$ \u51fd\u6570\u610f\u4e49\uff1a\u6c42 $(x,y)$ \u201c\u524d\u7f00\u201d\u6709\u51e0\u4e2a\u84dd\u8272\u3002\n\n### $query$ \u6b65\u9aa4\n\n- \u82e5 $n=3$\uff0c\u8bbf\u95ee\u6570\u7ec4\u8fd4\u56de\u7b54\u6848\u3002\n\n- \u82e5 $x>y$\uff0c\u4ea4\u6362 $x,y$\u3002\n\n- \u4ee4 $v=y-x$\uff0c$m=\\dfrac{n}{3}$\u3002\n\n- \u82e5 $v<m$\uff08\u7a7f\u8fc7\u4e86\u6b63\u5bf9\u89d2\u7684\u4e09\u4e2a\u533a\u57df\uff09\n\n\t1. $y<m$\uff08\u5b8c\u5168\u5728\u6700\u5de6\u4e0a\u89d2\u7684\u533a\u57df\u5185\uff09\uff0c\u8fd4\u56de $query_{x,y,m}$\n   2. $x<m$ ( \u7a7f\u8fc7\u6700\u5de6\u4e0a\u89d2\u7684\u533a\u57df\uff0c\u6ca1\u6709\u7ecf\u8fc7\u7b2c\u4e8c\u4e2a )\uff0c\u8fd4\u56de $calc_{v,m}$\uff08\u5176\u4ed6\u5730\u65b9\u90fd\u662f\u7a7a\u7684\uff09\u3002\n   3. $y<2m$ ( \u7a7f\u8fc7\u7b2c\u4e00\u4e2a\uff0c\u7ecf\u8fc7\u7b2c\u4e8c\u4e2a\uff0c\u6ca1\u6709\u7a7f\uff09\uff0c\u8fd4\u56de $calc_{v,m}+query_{x-m,y-m,m}$\u3002\n   4. $x<2m$\uff08\u7a7f\u8fc7\u524d\u4e24\u4e2a\uff0c\u6ca1\u6709\u7ecf\u8fc7\u7b2c\u4e09\u4e2a\uff09\uff0c\u8fd4\u56de $2\\times calc_{v,m}$\u3002\n   5. $else$\uff08\u7a7f\u8fc7\u524d\u4e24\u4e2a\uff0c\u7ecf\u8fc7\u7b2c\u4e09\u4e2a\uff09\uff0c\u8fd4\u56de $2\\times calc_{v,m}+query_{x-2m,y-2m,m}$\u3002\n   \n| 0 | 1 | 2| 3 |4  | 5 | 6 | 7 | 8 |\n| -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: |\n| 1 | **0** | 1 | 0 | 0 |  0|1  | 0 |1  |\n| 0 | 1 | **0** | 0 | 0 | 0 | 0 | 1 | 0 |\n| 1 | 0 | 1 | **0** | 0 | 0 | 1 |0  | 1|\n| 0|  0|0 | 1 |  **0**| 1| 0|0 | 0|\n| 0|0 |  0 |  0| 1 | **0** | 0|0 | 0|\n| 0| 0|  0 | 1 | 0 | 1 | **0**| 0| 0 |\n|1| 0|1| 0| 0|  0|1| **0**| 1|\n| 0|  1|0| 0|0 | 0| 0|1 |**0** |\n|1|0|1|0|0|0|1|0|1|\n\n   \n- \u82e5 $v=m$\uff08\u521a\u597d\u6ca1\u78b0\u5230\uff09\uff0c\u8fd4\u56de $0$\u3002\n\n| 0 | 1 | 2| 3 |4  | 5 | 6 | 7 | 8 |\n| -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: |\n| 1 | 0 | 1 | **0** | 0 | 0 | 1 | 0 | 1 |\n| 0 | 1 | 0 | 0 | **0** | 0 | 0 | 1 | 0 |\n| 1 | 0 | 1 | 0 | 0 | **0** | 1 | 0 | 1 |\n| 0 | 0 | 0 | 1 | 0 | 1 | **0** | 0 | 0 |\n| 0 | 0 | 0 | 0 | 1 | 0 | 0 | **0** | 0 |\n| 0 | 0 | 0 | 1 | 0 | 1 | 0 | 0 | **0** |\n| 1 | 0 | 1 | 0 | 0 | 0 | 1 | 0 | 1 |\n| 0 | 1 | 0 | 0 | 0 | 0 | 0 | 1 | 0 |\n| 1 | 0 | 1 | 0 | 0 | 0 | 1 | 0 | 1 |\n\n- \u82e5 $v<2m$\uff08\u78b0\u5230\u53f3\u4e0a\u89d2\u533a\u57df\uff0c\u6ca1\u6709\u8fc7\u5bf9\u89d2\u7ebf\uff09\n\t1. $y<2m$ \uff08\u6ca1\u6709\u78b0\u5230\u53f3\u4e0a\u89d2\u533a\u57df\uff09\uff0c\u8fd4\u56de $0$\u3002\n   2. $x\\ge m$ \uff08\u7a7f\u8fc7\uff09\uff0c\u8fd4\u56de $calc_{2m-v,m}\u3002\uff08\u770b\u56fe\u63a8\u5bfc\u4e00\u4e0b\uff09$\n   3. $else$\uff0c\uff08\u7ecf\u8fc7\u6ca1\u7a7f\uff09\uff0c\u8fd4\u56de $query_{x,y-2m,m}$\u3002\n\n\n| 0 | 1 | 2| 3 |4  | 5 | 6 | 7 | 8 |\n| -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: |\n| 1 | 0 | 1 | 0 | 0 | **0** | 1 | 0 | 1 |\n| 0 | 1 | 0 | 0 | 0 | 0 | **0** | 1 | 0 |\n| 1 | 0 | 1 | 0 | 0 | 0 | 1 | **0** | 1 |\n| 0 | 0 | 0 | 1 | 0 | 1 | 0 | 0 | **0** |\n| 0 | 0 | 0 | 0 | 1 | 0 | 0 | 0 | 0 |\n| 0 | 0 | 0 | 1 | 0 | 1 | 0 | 0 | 0 |\n| 1 | 0 | 1 | 0 | 0 | 0 | 1 | 0 | 1 |\n| 0 | 1 | 0 | 0 | 0 | 0 | 0 | 1 | 0 |\n| 1 | 0 | 1 | 0 | 0 | 0 | 1 | 0 | 1 |\n   \n\n   \n\n   \n- \u82e5 $v \\ge 2m$\uff08\u8fc7\u4e86\u5bf9\u89d2\u7ebf\uff09\uff0c\u8fd4\u56de $query_{x,y-2m,m}$\u3002\n\n| 0 | 1 | 2| 3 |4  | 5 | 6 | 7 | 8 |\n| -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: |\n| 1 | 0 | 1 | 0 | 0 | 0 | 1 | **0** | 1 |\n| 0 | 1 | 0 | 0 | 0 | 0 | 0 | 1 | **0** |\n| 1 | 0 | 1 | 0 | 0 | 0 | 1 | 0 | 1 |\n| 0 | 0 | 0 | 1 | 0 | 1 | 0 | 0 | 0 |\n| 0 | 0 | 0 | 0 | 1 | 0 | 0 | 0 | 0 |\n| 0 | 0 | 0 | 1 | 0 | 1 | 0 | 0 | 0 |\n| 1 | 0 | 1 | 0 | 0 | 0 | 1 | 0 | 1 |\n| 0 | 1 | 0 | 0 | 0 | 0 | 0 | 1 | 0 |\n| 1 | 0 | 1 | 0 | 0 | 0 | 1 | 0 | 1 |\n   \n\n### $calc$ \u6b65\u9aa4\n\u548c\u524d\u8005\u6b65\u9aa4\u76f8\u4f3c\uff0c\u4f46\u662f\u6bd4\u524d\u8005\u7b80\u5355\u3002\n\n- \u82e5 $n=1$ \u6216 $n=3$\uff0c\u7279\u5224\u3002\n- \u4ee4 $m=\\dfrac{n}{3}$\u3002\n- \u82e5 $v< m$\uff0c\u8fd4\u56de $3\\times calc_{v,m}$\u3002\uff08\u56e0\u4e3a\u4e09\u4e2a\u65b9\u5757\u4e2d\u7684\u60c5\u51b5\u4e00\u6837\uff09\n- \u82e5 $v=m$\uff0c\u8fd4\u56de $0$\u3002\n- \u82e5 $v<2m$\uff0c\u8fd4\u56de $calc_{2m-v,m}$\u3002\uff08\u548c\u4e0a\u9762\u4e00\u6837\uff0c\u5176\u5b9e\u5c31\u662f\u5e73\u79fb + \u7ffb\u8f6c\uff09\n- \u82e5 $v\\ge 2m$\uff0c\u8fd4\u56de $calc_{v-2m,m}$\u3002\n\n### \u590d\u6742\u5ea6\u5206\u6790\n$calc$ \u590d\u6742\u5ea6\u5f88\u660e\u663e\u4e3a $\\log_3\\operatorname{V}$\uff0c\uff08$\\operatorname{V}$ \u5c31\u662f\u6700\u5927\u503c\u57df\uff09\u3002\n \n$query$ \u4f1a\u9012\u5f52 $\\log_3\\operatorname{V}$ \u5c42\uff0c\u6bcf\u5c42\u6700\u591a\u8c03\u7528\u4e00\u6b21 $calc$ \u51fd\u6570\uff0c\u6240\u4ee5\u5355\u6b21\u590d\u6742\u5ea6\u4e3a $O(\\log_3^2\\operatorname{V})$\u3002\n\n\u603b\u590d\u6742\u5ea6\u4e3a $O(Q\\times\\log_3^2\\operatorname{V})$\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define rint register int\nusing namespace std;\ntypedef long long ll;\nconst int a[3][3]={{1,0,1},{0,2,0},{1,0,3}};\nint q; ll d,x,y,ans;\nll calc(ll x,ll n){\n\tif(n==1) return 1;\n\tif(n==3){\n\t\tif(x==0) return 3;\n\t\telse if(x==1) return 0;\n\t\telse return 1;\n\t}\n\tn/=3;\n\tif(x<n) return 3ll*calc(x,n);\n\telse if(x==n) return 0;\n\telse if(x<2ll*n) return calc(2ll*n-x,n);\n\telse return calc(x-2ll*n,n);\n}\nll query(ll x,ll y,ll n){\n\tif(n==3) return a[x][y];\n\tif(x>y) swap(x,y);\n\tll val=y-x; n/=3ll;\n\tif(val<n){\n\t\tll tmp=calc(val,n);\n\t\tif(y<n) return query(x,y,n);\n\t\tif(x<n) return tmp;\n\t\tif(y<2ll*n) return tmp+query(x-n,y-n,n);\n\t\tif(x<2ll*n) return tmp*2ll;\n\t\telse return tmp*2ll+query(x-2ll*n,y-2ll*n,n);\n\t}\n\telse if(val==n) return 0;\n\telse if(val<2ll*n){\n\t\tif(y<2ll*n) return 0;\n\t\tif(x>=n) return calc(2ll*n-val,n);\n\t\treturn query(x,y-2ll*n,n);\n\t}\n\telse return query(x,y-2ll*n,n);\n}\nll Query(ll x,ll y){\n\tif(x<0||y<0) return 0;\n\tif(x>y) swap(x,y);\n\tll dif=y-x,val=3ll;\n\twhile(val<=y) val*=3ll;\n\treturn query(x,y,val);\n}\nint main(){\n\tscanf(\"%d\",&q);\n\twhile(q--){\n\t\tscanf(\"%lld%lld%lld\",&d,&x,&y);\n\t\tcout<<Query(x+d,y+d)-Query(x-1,y-1)<<endl;\n\t}\n\treturn 0;\n}\n```\n\n## \u9898\u5916\u8bdd\n\u5982\u679c\u8981\u6c42\u77e9\u5f62\u5185\u7684\u84dd\u683c\u5b50\u6570\u91cf\u600e\u4e48\u529e\uff1f\uff08\u5047\u8bbe\u53d6\u6a21\u4e0d\u4f1a\u7206 `long long`\uff09\n\n1. \u53d8\u6210\u4e8c\u7ef4\u524d\u7f00\u3002\n2. \u8bbe\u8ba1 $calc$ \u51fd\u6570\uff1a\u4e00\u4e2a\u6807\u51c6\u77e9\u9635\u5728 $v$ \u5904\u6a2a\u5207 / \u7eb5\u5207\u540e\u4e0a\u4e00\u534a / \u5de6\u4e00\u534a\u7684\u84dd\u683c\u5b50\u6570\u91cf\u3002\uff08\u5f88\u660e\u663e\uff0c\u6a2a\u5411\u548c\u7eb5\u5411\u662f\u4e00\u6837\u7684\uff09\u3002\n3. \u5982\u4f55\u8ba1\u7b97 $calc$\uff1a\u5c06 $v$ \u6309 $v<m,m\\le v<2m,v\\ge2m$ \u5206\u7c7b\uff0c\u6700\u540e\u9012\u5f52\u52a0\u4e0a\u4e0b\u9762\u7684\u96f6\u5934\uff08$3\\times calc_{v/v-m/v-2m,m}$\uff09\u3002\n4. \u8bbe\u8ba1 $query$ \u51fd\u6570\uff1a\u4e00\u4e2a\u6807\u51c6\u77e9\u9635\u5728 $x$ \u5904\u6a2a\u5207\uff0c $y$ \u5904\u7eb5\u5207\uff0c\u5de6\u4e0a\u89d2\u7684\u84dd\u683c\u5b50\u6570\u91cf\u3002\n5. \u53d1\u73b0 $i$ \u9636\u77e9\u9635\u7684\u84dd\u683c\u5b50\u6570\u91cf\u4e3a $5^i$ \u4e2a\u3002\n6. \u5982\u4f55\u5b9e\u73b0 $query$ \u51fd\u6570\uff1a\n```cpp\nll ret=0;\nint xnum=x/m,ynum=y/m;\nret+=1ll*xnum*ynum*pw[m]%mod; // pw[m]=5^m%mod\nret+=1ll*ynum*calc(x%m,m),ret+=xnum*calc(y%m,m),ret%=mod;\nreturn (ret+calc(x%m,y%m,m))%mod;\n```\n7. \u5199\u597d\u5957\u8def\u7684\u4e3b\u7a0b\u5e8f\u548c\u7b80\u5355\u7684\u7279\u5224\u3002\n\n\u540c\u7406\uff0c\u5176\u5b9e\u9012\u5f52\u578b\u7684\u56fe\u5f62\u90fd\u53ef\u4ee5\u8fd9\u4e48\u505a\u3002",
        "postTime": 1614770336,
        "uid": 133060,
        "name": "henryhu2006",
        "ccfLevel": 0,
        "title": "USACO 21 Feb G T3 \u9898\u89e3"
    },
    {
        "content": "# \t[USACO21FEB] Count the Cows G \u9898\u89e3\n\n\u8003\u8651 $x,y$ \u6ee1\u8db3\u60c5\u51b5\uff0c\u5f53\u4e14\u4ec5\u5f53 $x$ \u548c $y$ \u7684\u4e09\u8fdb\u5236\u8868\u793a\u4f4d\u4e0b\u6bcf\u4e00\u4f4d\u5947\u5076\u6027\u76f8\u540c\u3002\n\n\u6240\u4ee5\u9898\u76ee\u8f6c\u5316\u4e3a\u6709\u591a\u5c11\u4e2a $z$ \u6ee1\u8db3 $(x+z,y+z)$ \u6ee1\u8db3\u6761\u4ef6\uff0c\u6ce8\u610f $0\\leq z\\leq d$\u3002\n\n\u8003\u8651\u6570\u4f4d dp\uff0c\u8bbe $f_{i,0/1,0/1,0/1}$ \u5206\u522b\u8868\u793a\u6784\u9020\u5230\u7b2c $i$ \u4f4d\u7684 $z$\uff0c \u5f53\u524d $x+z,y+z$ \u5206\u522b\u662f\u5426\u8fdb\u4f4d\uff0c\u5f53\u524d\u662f\u5426\u786e\u5b9a $z<d$ \u7684\u65b9\u6848\u6570\u3002\n\n\u8003\u8651\u8f6c\u79fb\uff0c\u5728 dfs \u4e0a\u679a\u4e3e\u5f53\u524d\u4f4d\u9009\u62e9\u7684\u6570\u8f6c\u79fb\u3002\u8bbe\u4e0a\u4e00\u6b21\u5b58\u7684\u8fdb\u4f4d\u5206\u522b\u4e3a $ck1,ck2$\uff0c\u5f53\u524d\u679a\u4e3e\u8fdb\u4f4d $j,k$\uff0c\u90a3\u4e48\u6211\u4eec\u8981\u5224\u65ad $x+z-3ck1+j$ \u548c $y+z-3ck2+k$ \u662f\u5426\u5408\u6cd5\u3002\n\n ```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint q;\ntypedef long long ll;\nll a[50],b[50],c[50],f[50][2][2][2],g[50][2][2][2];\nll dfs(ll len,ll ck1,ll ck2,ll ck3){\n\tif (len==0){\n\t\tif (ck1==0&&ck2==0)return 1;\n\t\telse return 0;\n\t}\n\tif (f[len][ck1][ck2][ck3]!=-1)return f[len][ck1][ck2][ck3];\n\tll lim=2,ans=0;\n\tif (ck3==1){\n\t\tlim=c[len];\n\t}\n\tfor (ll i=0;i<=lim;i++){\n\t\tfor (ll j=0;j<=1;j++){\n\t\t\tfor (ll k=0;k<=1;k++){\n\t\t\t\tll x=a[len]+i-ck1*3+j;\n\t\t\t\tll y=b[len]+i-ck2*3+k;\n\t\t\t\tif (x>=0&&y>=0&&x<=2&&y<=2&&x%2==y%2){\n\t\t\t\t\tif (ck3==1&&i==c[len])ans+=dfs(len-1,j,k,1);\n\t\t\t\t\telse ans+=dfs(len-1,j,k,0);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tf[len][ck1][ck2][ck3]=ans;\n\treturn ans;\n}\nint main(){\n\tfreopen(\"count.in\",\"r\",stdin);\n\tfreopen(\"count.out\",\"w\",stdout);\n\tscanf(\"%d\",&q);\n\twhile (q--){\n\t\tmemset(f,-1,sizeof(f));\n\t\tmemset(g,0,sizeof(g));\n\t\tll x,y,d;\n\t\tscanf(\"%lld%lld%lld\",&d,&x,&y);\n\t\tll len1=0,len2=0,len3=0;\n\t\tmemset(a,0,sizeof(a));\n\t\tmemset(b,0,sizeof(b));\n\t\tmemset(c,0,sizeof(c));\n\t\twhile (d){\n\t\t\tc[++len3]=d%3;\n\t\t\td/=3;\n\t\t}\n\t\twhile (x){\n\t\t\ta[++len1]=x%3;\n\t\t\tx/=3;\n\t\t}\n\t\twhile (y){\n\t\t\tb[++len2]=y%3;\n\t\t\ty/=3;\n\t\t}\n\t\tlen1=40;\n\t\tlen2=40;\n\t\tlen3=40;\n\t\tprintf(\"%lld\\n\",dfs(len3,0,0,1));\n\t}\n}\n ```\n\n",
        "postTime": 1629122553,
        "uid": 214893,
        "name": "OptimisticForever",
        "ccfLevel": 6,
        "title": "[USACO21FEB] Count the Cows G \u9898\u89e3"
    },
    {
        "content": "\u8fd9\u6b21\u7ec8\u4e8e AK \u4e86\u91d1\u7ec4\uff0c\u6c34\u7bc7\u9898\u89e3\u7eaa\u5ff5\u4e00\u4e0b\n\n\u8bbe $f(x,y)=[\\text{\u6709\u4e00\u5934\u5976\u725b\u4f4d\u4e8e} (x,y)]$\uff0c\u5219\u6b64\u503c\u53ef\u4ee5\u901a\u8fc7\u4e0d\u65ad\u6bd4\u8f83\u6a21 $3$ \u7684\u4f59\u6570\u5e76\u4e0d\u65ad\u540c\u9664 $3$ \u6765\u5224\u65ad\u3002\n\n\u6b64\u65f6\u5f97\u5230\u4e86\u4e00\u4e2a $\\Theta(d)$ \u7684\u505a\u6cd5\uff0c\u4f46\u662f\u53ea\u80fd\u62ff\u5230 2 \u4e2a\u70b9\u3002\n\n~~\u6218\u672f\u5632\u8bbd~~\n\n\u6839\u636e\u5b9a\u4e49\u53ef\u5f97 $f(x,y)=f(y,x)$\u3002\n\n\u4e0d\u59a8\u8bbe\u6bcf\u6b21\u8be2\u95ee $x\\leq y$\uff0c\u8bbe\u6700\u7ec8\u6240\u6c42\u4e3a $g(d, x, y)$\uff0c\u7ecf\u8fc7\u89c2\u5bdf\u53ef\u5f97\u6240\u6c42\u5e8f\u5217\u7684\u89c4\u5f8b\u4e0e $y-x$ \u6709\u5f88\u5927\u5173\u7cfb\u3002\u4e8e\u662f\u8bbe $g(d, x, y)=h(x, x+d, y-x)$\u3002\n\n\u8003\u8651\u6c42 $h(l, r, d)$\uff1a\n\n\u5148\u6446\u51fa\u4e00\u4e9b $f(x, y)$ \u7684\u6027\u8d28\uff1a\n\n\u5b9a\u4e49$count(x)$ \u4e3a $x$ \u4e09\u8fdb\u5236\u7684 $1$ \u7684\u4e2a\u6570\u3002\n\n1. $f(x, x)=1$\uff0c\u8bc1\u660e\u7565\u3002\n2. $f(x, y)=1$\uff0c\u5f53\u4e14\u4ec5\u5f53\u4e24\u4e2a\u6570\u7684\u4e09\u8fdb\u5236\u62c6\u5206\u7684 $1$ \u7684\u4f4d\u7f6e\u5b8c\u5168\u76f8\u540c\u3002\u6c42 $f(x, y)$ \u672c\u8d28\u5c31\u662f\u5bf9\u4e24\u6570\u8fdb\u884c\u4e09\u8fdb\u5236\u62c6\u5206\u3002\n3. $f(x, x+d)=1$\uff0c\u5f53\u4e14\u4ec5\u5f53 $x+d$ \u4e0d\u6539\u53d8 $x$ \u4e09\u8fdb\u5236\u7684 $1$ \u7684\u4f4d\u7f6e\u3002\u540c 2\u3002\n3. $count(x+y)\\equiv count(x)+count(y)(\\mod 2)$\u3002\u76f4\u89c2\u7406\u89e3\u5982\u679c\u67d0\u4f4d\u52a0\u4e00\uff0c\u6709\u4e09\u79cd\u60c5\u51b5\uff1a\u539f\u4f4d\u4e3a $0$\uff0c\u539f\u4f4d\u4e3a $1$\uff0c\u539f\u4f4d\u4e3a $2$\u3002\u524d\u4e24\u79cd\u60c5\u51b5\u90fd\u4f1a\u6539\u53d8 $1$ \u7684\u5947\u5076\u6027\uff0c\u800c\u7b2c\u4e09\u79cd\u60c5\u51b5\u7b49\u4ef7\u4e8e\u5728\u4e0b\u4e00\u4f4d\u52a0\u4e00\u3002\u52a0 $y$ \u53ef\u4ee5\u7406\u89e3\u4e3a\u5728 $x$ \u7684\u5404\u4f4d\u4e0d\u65ad\u52a0\u4e00\uff0c\u800c\u52a0\u7684\u6b21\u6570\u5947\u5076\u6027\u4e0e $count(y)$ \u4e00\u81f4\u3002\n5. $f(x,x+3d)=f(\\lfloor x/3\\rfloor,\\lfloor x/3\\rfloor+d)$\uff0c\u53ef\u4ee5\u5ffd\u7565 $d$ \u7684\u6700\u4f4e\u4f4d\u5bf9\u7b54\u6848\u7684\u5f71\u54cd\n\n6. \u5f53$x\\equiv2(\\mod3)$ \u65f6 $f(x,x+3d+1)=f(\\lfloor x/3\\rfloor,\\lfloor x/3\\rfloor+d+1)$\uff0c\u5426\u5219\u4e3a $0$\u3002\n\n6. \u5f53$x\\equiv0(\\mod3) $ \u65f6 $f(x,x+3d+2)=f(\\lfloor x/3\\rfloor,\\lfloor x/3\\rfloor+d)$\uff0c\u5426\u5219\u4e3a $0$\u3002\u8fd9\u4e24\u6761\u53ef\u4ee5\u901a\u8fc7\u627e\u89c4\u5f8b\u5f97\u51fa\uff0c\u4e0d\u7b26\u5408\u5148\u51b3\u6761\u4ef6\u65f6\u503c\u4e3a $0$ \u770b\u4e2a\u4f4d\u663e\u7136\uff0c\u7b26\u5408\u65f6\u53ef\u4ee5\u7c7b\u4f3c\u7b2c\u4e94\u6761\u8fdb\u884c\u9012\u5f52\u6c42\u89e3\n\n~~\u6211\u81ea\u5df1\u90fd\u6709\u4ebf\u70b9\u61f5~~\n\n\u800c $h(l,r,d) = \\sum\\limits_{i=l}^r{f(i,i+d)}$\n\n\u4e8e\u662f\u53ef\u4ee5\u9012\u5f52\u6c42\u89e3\n\n\u5177\u4f53\u7684\uff0c\u4e0d\u59a8\u8bbe $l\\equiv0,r\\equiv2(\\mod3)$\n\n\u5219\n$h(l,r,d) = \\left\\{\\begin{matrix}3h(l/3,(r-2)/3,d/3)(d\\equiv 0(\\mod 3))\n\\\\ h(l/3,(r-2)/3,(d+2)/3)(d\\equiv 1(\\mod 3))\n\\\\ h(l/3,(r-2)/3,(d-2)/3)(d\\equiv 2(\\mod 3))\n\n\\end{matrix}\\right.$\uff08\u6839\u636e 5, 6, \n7 \u6027\u8d28\u63a8\u51fa\uff0c\u5bf9\u6bcf\u4e00\u4e2a\u9664\u4e2a\u4f4d\u5916\u76f8\u540c\u7684\u4e09\u4e2a\u6570\u8fdb\u884c\u8ba8\u8bba\uff0c\u7136\u540e\u9012\u5f52\u6c42\u89e3\uff09\n\n\u6700\u7ec8\u4ee3\u7801\uff1a\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <vector>\n#define ull unsigned long long\n\nusing namespace std;\n\nint Q;\n\nbool In(ull x, ull y) {\n\twhile (x || y) {\n\t\tif ((x%3==1)^(y%3==1)) {\n\t\t\treturn false;\n\t\t}\n\t\tx/=3;\n\t\ty/=3;\n\t}\n\treturn true;\n}\n\nint Count1(ull a) {\n\tint res = 0;\n\twhile (a) {\n\t\tif (a%3==1) res++;\n\t\ta/=3;\n\t}\n\treturn res;\n}\n\null Res(ull l, ull r, ull diff) {\n\tif (diff==0) {\n\t\treturn r-l+1;\n\t}\n\tif (l>r) return 0;\n\tif (l==r) return In(l, l+diff);\n\tif (r==l+1) return In(l, l+diff)+In(r, r+diff);\n\tull res = 0;\n\t\twhile (l%3) {\n\t\t\tres+=In(l, l+diff);\n\t\t\tl++;\n\t\t}\n\t\twhile (r%3!=2) {\n\t\t\tres+=In(r, r+diff);\n\t\t\tr--;\n\t\t}\n\tswitch(diff%3) {\n\t\tcase 0:\n\t\t\t\n\t\treturn res+Res(l/3, r/3, diff/3)*3;\n\t\tcase 1:\n\t\t\treturn res+Res(l/3, r/3, (diff+2)/3);\n\t\tcase 2:\n\t\t\treturn res+Res(l/3, r/3, (diff-2)/3);\n\t}\n}\n\nvoid Solve(ull d, ull x, ull y) {\n\tif (x==y) {\n\t\tprintf(\"%llu\\n\", d+1);\n\t\treturn;\n\t}\n\tif (Count1(x-y)&1) {\n\t\tprintf(\"0\\n\");\n\t\treturn;\n\t}\n\tprintf(\"%llu\\n\", Res(y, y+d, x-y));\n}\n\nint main() {\n\tscanf(\"%d\", &Q);\n\twhile (Q--) {\n\t\tull d, x, y;\n\t\tscanf(\"%llu%llu%llu\", &d, &x, &y);\n\t\tif (x < y) swap(x, y);\n\t\tSolve(d, x, y);\n\t}\n\treturn 0;\n}\n\n```\n\n\u8003\u573a\u4ee3\u7801\uff1a\uff08\u6302\u4e86\u5f88\u591a\u6b21\uff09\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <vector>\n#define ull unsigned long long\n\nusing namespace std;\n\nint Q;\n\nbool In(ull x, ull y) {\n\twhile (x || y) {\n\t\tif ((x%3==1)^(y%3==1)) {\n\t\t\treturn false;\n\t\t}\n\t\tx/=3;\n\t\ty/=3;\n\t}\n\treturn true;\n}\n\nint Count1(ull a) {\n\tint res = 0;\n\twhile (a) {\n\t\tif (a%3==1) res++;\n\t\ta/=3;\n\t}\n\treturn res;\n}\n\null Hubu(ull x) {\n\tull base = 1;\n\tull res = 0;\n\tvector<int> list;\n\twhile (x) {\n\t\tlist.push_back(x%3);\n\t\tx/=3;\n\t}\n\tfor (int i = 0; i < list.size(); i++) {\n\t\tif (list[i] > 2) {\n\t\t\tlist[i+1]+=list[i]/3;\n\t\t\tlist[i]%=3;\n\t\t}\n\t\tif (list[i]==1) {\n\t\t\tres+=base<<1;\n\t\t\tlist[i] = 0;\n\t\t\tlist[i+1]++;\n\t\t}\n\t\tbase*=3ull;\n\t}\n\treturn res;\n}\n\null Da(ull a) {\n\tull res = 1ull;\n\twhile (res <= a) res*=3ull;\n\treturn res;\n}\n\null Count(ull l, ull r, ull dn, ull mod) {\n//\tcout << \"Count \" << l << ',' << r << ',' << dn << ',' << mod << endl;\n\tl-=dn;\n\tr-=dn;\n\treturn (r+mod)/mod-(l-1+mod)/mod;\n}\n\null Res(ull l, ull r, ull diff) {\n//\tcout << \"Res(\" << l << ',' << r << ',' << diff << endl;\n\tif (diff==0) {\n\t\treturn r-l+1;\n\t}\n\tif (l>r) return 0;\n\tif (l==r) return In(l, l+diff);\n\tif (r==l+1) return In(l, l+diff)+In(r, r+diff);\n\tull res = 0;\n\t\twhile (l%3) {\n\t\t\tres+=In(l, l+diff);\n\t\t\tl++;\n\t\t}\n\t\twhile (r%3!=2) {\n\t\t\tres+=In(r, r+diff);\n\t\t\tr--;\n\t\t}\n\tswitch(diff%3) {\n\t\tcase 0:\n\t\t\t\n\t\treturn res+Res(l/3, r/3, diff/3)*3;\n\t\tcase 1:\n\t\t\treturn res+Res(l/3, r/3, (diff+2)/3);\n\t\tcase 2:\n\t\t\treturn res+Res(l/3, r/3, (diff-2)/3);\n\t}\n}\n\n//ull Res(ull d, ull x, ull y) {\n//\tif (d==-1) return 0;\n//\tif (d<2) {\n//\tull res = 0;\n//\tfor (ull i = 0; i <= d; i++) {\n//\t\tres+=In(x+i, y+i);\n//\t}\n//\treturn res;\n//\t}\n//\tull res = 0;\n//\tull diff = x-y;\n//\tif (diff%3==0) {\n//\t\twhile (x%3) {\n//\t\t\tres+=In(x, y);\n//\t\t\tx++;\n//\t\t\ty++;\n//\t\t\td--;\n//\t\t}\n//\t\twhile ((d+1)%3) {\n//\t\t\tres+=In(x+d, y+d);\n//\t\t\td--;\n//\t\t}\n//\t\treturn res+Res((d+1)/3-1, x/3, y/3)*3;\n//\t}\n//\tif (diff%3==2) {\n//\t\tint newdiff = diff/3;\n//\t\tint l = (y/3+diff)\n//\t\treturn res+Res(, y/3+diff, y/3);\n//\t}\n////\treturn Count(y, y+d, Hubu(diff), Da(diff));\n//}\n\nvoid SolveOld(ull d, ull x, ull y) {\n\tull res = 0;\n\tfor (ull i = 0; i <= d; i++) {\n\t\tres+=In(x+i, y+i);\n\t}\n\tprintf(\"%llu\\n\", res);\n\treturn;\n}\n\nvoid Solve(ull d, ull x, ull y) {\n//\tif (d == 1000000000000000000ull && x == 1000000000000000000ull && y == 1000000000000000000ull) {\n//\t\tprintf(\"1000000000000000001\\n\");\n//\t\treturn;\n//\t}\n//\tif (d <= 100) {\n//\tull res = 0;\n//\tfor (ull i = 0; i <= d; i++) {\n//\t\tres+=In(x+i, y+i);\n//\t}\n//\tprintf(\"%llu\\n\", res);\n//\treturn;\n//\t}\n\tif (x==y) {\n\t\tprintf(\"%llu\\n\", d+1);\n\t\treturn;\n\t}\n\tif (Count1(x-y)&1) {\n\t\tprintf(\"0\\n\");\n\t\treturn;\n\t}\n\tprintf(\"%llu\\n\", Res(y, y+d, x-y));\n}\n\nvoid DisplayThree(ull a) {\n\tif (a) {\n\t\tDisplayThree(a/3);\n\t\tcout << a%3;\n\t}\n}\n\nint main() {\n\tscanf(\"%d\", &Q);\n//\tfor (int i = 0; i < 1000; i++) {\n//\t\tint d = 1000;\n//\t\tint x = i;\n//\t\tint y = 0;\n//\t\tSolve(d, x, y);\n//\t\tSolveOld(d, x, y);\n//\t}\n//\tprintf(\"%llu\\n\", res);\n////\treturn;\n////\t}\n//\t\tDisplayThree(x);\n//\t\tcout << ',' << x << ',';\n//\t\tSolve(d, x, y);\n//\t}\n\twhile (Q--) {\n\t\tull d, x, y;\n\t\tscanf(\"%llu%llu%llu\", &d, &x, &y);\n\t\tif (x < y) swap(x, y);\n\t\tSolve(d, x, y);\n\t}\n\treturn 0;\n}\n\n```\n",
        "postTime": 1615172240,
        "uid": 124314,
        "name": "lcyxds",
        "ccfLevel": 0,
        "title": "P7415\u9898\u89e3"
    }
]