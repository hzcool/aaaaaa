[
    {
        "content": "\u9996\u5148\u505a\u8fd9\u9053\u9898\u8981\u638c\u63e1\u4e00\u4e2a\u7b97\u6cd5\u2014\u2014[Manacher\u7b97\u6cd5](https://www.cnblogs.com/lykkk/p/10460087.html)\n\n\u7b80\u8981\u8bf4\u4ed6\u5c31\u662f\u7528\u6765\u89e3\u51b3\u56de\u6587\u4e32\u76f8\u5173\u95ee\u9898\u7684\u7b97\u6cd5\uff0c\u5e76\u4e0d\u9ad8\u6df1\n\n\u7531\u9898\u610f\u53ef\u77e5\uff0c\u663e\u7136**\u6bcf\u4e00\u4e2a\u548c\u8c10\u7fa4\u4f53\u5c31\u662f\u4e00\u4e2a\u957f\u5ea6\u4e3a\u5947\u6570\u7684\u56de\u6587\u4e32**\n\n\u7528Manacher\u53ef\u4ee5\u6c42\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u56de\u6587\u534a\u5f84\n\n\u56e0\u4e3a\u6211\u4eec\u53ea\u8981\u6c42\u5947\u6570\u4e2a\u7684\u56de\u6587\u4e32\uff0c\u90a3\u4e48\u663e\u7136\u6211\u4eec\u4e0d\u9700\u8981\u5728\u5b57\u7b26\u4e32\u91cc\u6dfb\u52a0\u4e00\u4e9b\u65e0\u5173\u5b57\u7b26\n\n\u90a3\u4e48\u6211\u4eec\u7528Manacher\u6c42\u51fa\u4ee5\u5f53\u524d\u4f4d\u7f6e\u4e3a\u4e2d\u5fc3\u7684\u6700\u957f\u56de\u6587\u5b50\u4e32\u957f\u5ea6\n\n\u6240\u4ee5\u6211\u4eec\u5c31\u4f1a\u5728\u6c42\u7684\u540c\u65f6\u641e\u51fa\u6700\u957f\u7684len\n\n\u7136\u540e\u6839\u636e\u5bf9\u79f0\u6027\u53ef\u77e5\u4e5f\u6709\u957f\u4e3a**len*2-1**\u7684\u56de\u6587\u5b50\u4e32\uff0c\u63a5\u7740\u6211\u4eec\u53ea\u9700\u8981\u7edf\u8ba1\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\n\n\n\u6ce8\u610f\u6211\u4eec**\u53ea\u8981\u5947\u6570\u4e2a\uff0c\u53bb\u6389\u5076\u6570\u4e2a**\n\n\u56e0\u4e3a\u6570\u636e\u8303\u56f4\u8fc7\u5927\uff0c\u6240\u4ee5\u6211\u4eec\u8981**Fast_Pow**\u4f7f\u5f97\u4e0d\u4f1a\u7206\u6389\n\n\u90a3\u4e48\u3002\u3002\u3002\u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u6211~~\u4f18\u79c0\u7684\u4ee3\u7801~~\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nconst int mod = 19930726;\nconst int N = 1100000;\nchar s[N],str[N*2];\nint p[N*2],cnt[N];\nint len,n;\nll ans=1,k;\nll ksm(int x,int y) {//\u56e0\u4e3a\u6570\u636e\u8303\u56f4\u5f88\u5927\u5bb9\u6613\u7206\u6389\uff0c\u6240\u4ee5\u5c31\u8981Fast_Pow\n    if(x==1) return 1;\n    ll res=1,base=x;\n    while(y) {\n        if(y&1) res=(res*base)%mod;\n        base=(base*base)%mod;\n        y>>=1;\n    }\n    return res;\n}\nvoid manacher() {//Manacher\u6a21\u677f\uff0c\u8be6\u89c1\u6d1b\u8c37P3805\n    for(int i=1; i<=len; i++) str[i*2-1]='%',str[i*2]=s[i];\n    str[len=len*2+1]='%';\n    int id=0,mx=0;\n    for(int i=1; i<=len; i++) {\n        if(i<mx) p[i]=min(p[id*2-i],mx-i);\n        else p[i]=1;\n        while(p[i]+i<=len && i-p[i]>=1 && str[i+p[i]]==str[i-p[i]]) p[i]++;\n        if(p[i]+i>mx) id=i,mx=i+p[i];\n        if((p[i]-1)%2) cnt[p[i]-1]++;\n    }\n}\nint main() {\n    int sum=0;\n    cin>>n>>k>>s+1;\n    len=n;\n    manacher();\n    for(int i=n; i>=1; --i) {//\u6839\u636e\u9898\u610f\u5e38\u89c4\u64cd\u4f5c\n        if(i%2==0) continue;\n        sum+=cnt[i];\n        if(k>=sum) {\n            ans=(ans*ksm(i,sum))%mod;\n            k-=sum;\n        } else {\n            ans=(ans*ksm(i,k))%mod;\n            k-=sum;\n            break;\n        }\n    }\n    if(k>0) ans=-1;\n    cout<<ans;\n    return 0;\n}\n```\n",
        "postTime": 1553933147,
        "uid": 48821,
        "name": "\u4e09\u597d\u4ee3\u8868",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "**\u9898\u76ee\u63cf\u8ff0**\n \n n\u4e2a\u5973\u751f\u4e3e\u724c\u5b50(\u53ea\u542b\u670926\u4e2a\u5c0f\u5199\u5b57\u6bcd,\u957f\u5ea6\u4e3an\u7684\u5b57\u7b26\u4e32),  \u5982\u679c\u8fde\u7eed\u7684\u4e00\u6bb5\u5973\u751f\uff0c\u6709\u5947\u6570\u4e2a\uff0c\u5e76\u4e14\u5979\u4eec\u624b\u4e2d\u7684\u724c\u5b50\u6240\u5199\u7684\u5b57\u6bcd\uff0c\u4ece\u5de6\u5230\u53f3\u548c\u4ece\u53f3\u5230\u5de6\u8bfb\u8d77\u6765\u4e00\u6837\uff0c\u90a3\u4e48\u8fd9\u4e00\u6bb5\u5973\u751f\u5c31\u88ab\u79f0\u4f5c\u548c\u8c10\u5c0f\u7fa4\u4f53\u3002\n\u73b0\u5728\u60f3\u627e\u51fa\u6240\u6709\u548c\u8c10\u5c0f\u7fa4\u4f53\uff0c\u5e76\u4e14\u6309\u7167\u5973\u751f\u7684\u4e2a\u6570\u964d\u5e8f\u6392\u5e8f\u4e4b\u540e\uff0c\u524dK\u4e2a\u548c\u8c10\u5c0f\u7fa4\u4f53\u7684\u5973\u751f\u4e2a\u6570\u7684\u4e58\u79ef\u662f\u591a\u5c11\u3002\u7531\u4e8e\u7b54\u6848\u53ef\u80fd\u5f88\u5927\uff0c\u8f93\u51fa\u9664\u4ee519930726\u7684\u4f59\u6570\u3002\n\n**\u5206\u6790**\n   \n   \u663e\u7136,\u4e00\u4e2a\u548c\u8c10\u5c0f\u7fa4\u4f53\u662f\u4e00\u4e2a\u957f\u5ea6\u4e3a\u5947\u6570\u7684\u56de\u6587\u4e32\u3002\n   \n   ~~\u7406\u6240\u5f53\u7136\u5730~~\u6211\u4eec\u60f3\u5230\u4e86manacher\u7b97\u6cd5\n   \n   **manacher**\u7b97\u6cd5\u53ef\u4ee5\u6c42\u51fa\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u56de\u6587\u534a\u5f84.\n   \n   \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528manacher\u6765\u89e3\u51b3\u6b64\u9898\n   \n   \u7136\u540e\u56e0\u4e3a\u8fd9\u4e2a\u9898\u53ea\u9700\u8981\u6c42\u51fa\u5947\u6570\u957f\u5ea6\u7684\u56de\u6587\u4e32\n   \n   \u6240\u4ee5\u4e0d\u9700\u8981\u8003\u8651\u63d2\u5165\u5b57\u7b26(\u5176\u5b9e\u4e5f\u53ef\u4ee5\u63d2\u5165\n   \n   \u7531\u4e8e\u6700\u540e\u4e00\u4e2a\u70b9\u5341\u5206\u5927 k<10^12(\u8fa3\u4e48\u957f\n   \n   \u6240\u4ee5\u9700\u8981**\u5feb\u901f\u5e42**\u52a0\u901f\u4e00\u4e0b\n   \n**\u6389\u5751\u73b0\u573a**\n\n   \u91cd\u70b9 ~~\u4e2a\u4eba\u8ba4\u4e3a~~\n   \u6c42\u51fa\u4e86\u67d0\u4e00\u4f4d\u7f6e\u7684\u56de\u6587\u534a\u5f84\n   \n   \u5c31\u50cf\u6837\u4f8b\u89e3\u91ca\u4e2d\u4e00\u6837\n         \n      eg\uff1aa b a b a\n      \u56de\u6587\u534a\u5f84\u4e3a5\n      \u4f46\u5b83\u4e5f\u5305\u542b\u4e86 a bab ababa\uff01\n    \u5373\u5982\u679c\u4e00\u4e2a\u503c\u4e3ax(x>1)\u90a3x-1,x-2.....\u4e5f\u5b58\u5728\n \u6240\u4ee5\u6211\u4eec\u9700\u8981**\u524d\u7f00\u548c**\u6765\u505a\n (\u611f\u89c9\u4e0d\u5e94\u8be5\u53eb\u524d\u7f00\u548c\u554aemm \u4f46\u53c8\u611f\u89c9\u5dee\u4e0d\u591a)\n \n\u6211\u4eec\u53ef\u4ee5\u7528**\u6876**\u5b58\u50a8\u4e00\u4e0b\u56de\u6587\u534a\u5f84,\u5012\u7740\u641c\u4e00\u904d\u5373\u53ef\n\n\n_(:\u0437\u300d\u2220)_      ~~(\u80f3\u818a\u6ca1\u4e86~~\n\n----------------\u4ee3\u7801------------------\n#### \u2014\u2014\u4ee3\u7801\u90e8\u5206\u53c2\u8003[bolg @five20](https://www.cnblogs.com/five20/p/8616294.html)\n\n```cpp\n#include<bits/stdc++.h>\n#define IL inline\n#define RI register long long\n#define N 1000008\n#define mod 19930726\nchar s[N<<1],ch[N];\nlong long n,k,len,RL[N<<1],mxxnum,sum,ans=1;\nlong long MaxRight,center,tong[N<<1];\nIL long long ksm(long long x,long long y)\n{\n\tlong long res=1;\n\tfor(;y;y>>=1,x=x*x%mod)\n\t\tif(y&1)res=res*x%mod;\n\treturn res;\n}\nint main()\n{\n\tscanf(\"%lld%lld\",&n,&k);\n\tscanf(\"%s\",s+1);\n\tfor(RI i=1;i<=n;i++)\n\t{\n\t\tif(i<=MaxRight)RL[i]=std::min(MaxRight-i,RL[2*center-i]);\n\t\telse RL[i]=1;\n\t\twhile(i+RL[i]<=n&&i-RL[i]>=0&&s[i+RL[i]]==s[i-RL[i]])++RL[i];\n\t\tif(i+RL[i]-1>MaxRight)MaxRight=i+RL[i]-1,center=i;\n\t\ttong[2*RL[i]-1]++;\n\t}\n\t//for(RI i=1;i<=n;i++)printf(\"%lld \",tong[i]);\n\tif(n%2!=1)n--;\n\tfor(RI i=n;i>=1;i-=2)\n\t{\t\n\t\tsum+=tong[i];\n\t\tif(sum>k)\n\t\t{\n\t\t\tans=ans*ksm(i,k)%mod;\n\t\t\tbreak;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tans=ans*ksm(i,sum)%mod;\n\t\t\tk-=sum;\n\t\t}\n\t}\n\tif(sum<k)printf(\"-1\");\n\telse printf(\"%lld\\n\",ans);\n}\n```\n\n~~\u597d\u4e86\u597d\u4e86 \u6211\u77e5\u9053\u4e11\u4e86emmmm~~",
        "postTime": 1533346324,
        "uid": 87960,
        "name": "\u987ez",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "## \u6211\u7684\u89e3\u6cd5\uff1a\u56de\u6587\u81ea\u52a8\u673a\n\n\u770b\u89c1\u5927\u5bb6\u7684\u9898\u89e3\u5927\u591a\u90fd\u662f\u7528\u7684\u9a6c\u62c9\u8f66\u7b97\u6cd5\uff0c\u5176\u5b9e\u8fd9\u9053\u9898\u4e5f\u53ef\u4ee5\u7528\u53e6\u4e00\u79cd\u89e3\u6cd5\u4e00\u4e00\u56de\u6587\u81ea\u52a8\u673a\uff0c\u5e76\u4e14\u8fd9\u9053\u9898\u7528\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u53ef\u4ee5\u65e0\u8111\u89e3\u51b3$qwq$\n\n#### 1.\u4ecb\u7ecd\uff1a\u56de\u6587\u81ea\u52a8\u673a\u4e00\u4e00\u5904\u7406\u56de\u6587\u4e32\u95ee\u9898\u7684\u6709\u529b\u6b66\u5668\n \n$\\quad$a.\u5927\u6982\uff1a \u540c\u5176\u4ed6\u81ea\u52a8\u673a\u4e00\u6837\uff0c\u56de\u6587\u81ea\u52a8\u673a\u662f\u4e2aDAG\uff0c\u5b83\u7528\u76f8\u5f53\u5c11\uff08$O(n)$\uff09\u7684\u7a7a\u95f4\u590d\u6742\u5ea6\u5c31\u5b58\u50a8\u4e86\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7684\u6240\u6709\u56de\u6587\u4e32\u4fe1\u606f\u3002\u4e00\u4e2a\u56de\u6587\u81ea\u52a8\u673a\u5305\u542b\u4e0d\u8d85\u8fc7$|S|$\u4e2a\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u8868\u793a\u4e86\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7684\u4e00\u4e2a\u4e0d\u91cd\u590d\u7684\u56de\u6587\u5b50\u4e32\uff0c\u540c\u65f6\u4e00\u4e2a\u8282\u70b9\u4f1a\u6709\u4e0d\u8d85\u8fc7\u5b57\u7b26\u96c6\u5927\u5c0f\u7684\u8fb9\u8fde\u5411\u5176\u4ed6\u8282\u70b9\uff0c\u4ee5\u53ca\u4e00\u6761fail\u8fb9\u8fde\u5411\u8fd9\u4e2a\u70b9\u7684fail...\u8fd9\u4e9b\u90fd\u4f1a\u5728\u4e0b\u9762\u4ecb\u7ecd\n\n$\\quad$b.\u68ee\u6797\uff1a \u548c\u522b\u7684\u81ea\u52a8\u673a\u4e0d\u592a\u4e00\u6837\uff0c\u56de\u6587\u81ea\u52a8\u673a\u662f\u6709\u4e24\u68f5\u6811\u7684\u68ee\u6797\uff1a\u5176\u4e2d\u4e00\u68f5\u662f\u957f\u5ea6\u4e3a\u5076\u6570\u7684\u56de\u6587\u4e32\u96c6\u5408\uff0c\u53e6\u4e00\u68f5\u662f\u957f\u5ea6\u4e3a\u5947\u6570\u7684\u56de\u6587\u4e32\u96c6\u5408\uff0c\u8fd9\u4e24\u68f5\u6811\u7684\u6839\u8282\u70b9\u5206\u522b\u8868\u793a\u957f\u5ea6\u4e3a0\uff08\u7a7a\u4e32\uff09\u548c-1\uff08\u65e0\u5b9e\u9645\u542b\u4e49\uff0c\u4fbf\u4e8e\u8fd0\u7b97\uff09\u7684\u56de\u6587\u4e32;\n\n$\\quad$c.\u8fb9\uff1a\u81ea\u52a8\u673a\u4e2d\u6bcf\u6761\u6709\u5411\u8fb9\u90fd\u6709\u4e00\u4e2a\u5b57\u7b26\u7c7b\u578b\u7684\u6743\u503c\uff0c\u8d77\u70b9\u7684\u4e32\u5de6\u53f3\u5206\u522b\u52a0\u4e0a\u8fd9\u4e2a\u5b57\u7b26\u5f97\u5230\u7684\u5c31\u662f\u7ec8\u70b9\u7684\u4e32\u3002\u4e3e\u4e2a\u6817\u5b50\uff1a\u8bbe\u4e00\u6761\u8fb9\u6743\u4e3a$c$\u7684\u8fb9\u8fde\u63a5\u7684\u4e24\u4e2a\u70b9\u5206\u522b\u662f$A,B$\uff0c$A$\u8868\u793a\u56de\u6587\u4e32$aba$\uff0c\u5219$B$\u8868\u793a\u7684\u56de\u6587\u4e32\u5c31\u662f$cabac$ \u3002\u7279\u522b\u7684\uff0c\u5982\u679c$A$\u662f\u54ea\u4e2a\u957f\u5ea6\u4e3a$-1$\u7684\u6839\uff0c$B$\u4e32\u5c31\u662f\u8fd9\u6761\u8fb9\u7684\u6743\u503c\u3002\u3002\u3002\n\n$\\quad$d.\u70b9\uff1a\u4ece\u6839\u8282\u70b9\u5f80\u4e0b\u987a\u7740\u8fb9\u8d70\uff0c\u8bb0\u7740\u4e00\u4e2astr\u4e00\u5f00\u59cb\u4e3a\u7a7a\uff0c\u4e00\u8fb9\u8d70\u4e00\u8fb9\u4e0d\u505c\u5730\u5f80str\u5de6\u53f3\u4e24\u8fb9\u6dfb\u52a0\u65b0\u7684\u5b57\u7b26\uff0c\u8d70\u5230\u4e00\u4e2a\u70b9\uff0c\u8fd9\u4e2a\u70b9\u4ee3\u8868\u7684\u56de\u6587\u4e32\u5c31\u662fstr\n\n$\\quad$e.$fail$\u8fb9\uff1a\u6bcf\u4e2a\u70b9\u90fd\u6709\u4e2afail\u8fb9\uff0c\u8fd9\u6761\u8fb9\u6307\u5411\u8fd9\u4e2a\u70b9\u6240\u4ee3\u8868\u7684\u56de\u6587\u4e32\u7684 \u6700\u957f\u56de\u6587\u540e\u7f00 \u6240\u5728\u7684\u90a3\u4e2a\u70b9\uff08\u6700\u957f\u56de\u6587\u540e\u7f00\uff1a\u4e32\u4e2d\u6ee1\u8db3\u56de\u6587\u7684\u6700\u957f\u7684\u540e\u7f00\uff0c\u8fd9\u4e2a\u4e32\u81ea\u5df1\u4e0d\u7b97\uff09\u5982\u679c\u6ca1\u6709\uff0c\u5219\u6307\u54110\uff08\u5c31\u662f\u90a3\u4e2a\u6839\u8282\u70b9\uff09\u3002\u7279\u522b\u7684\uff0c0\u7684fail\u8282\u70b9\u5c31\u662f\u90a3\u4e2a\u957f\u5ea6\u4e3a-1\u7684\u70b9\u3002\n\n#### 2.\u6784\u9020\uff1a\n$\\quad$\u6211\u662f\u7528\u7684\u4e00\u4e2a\u7ed3\u6784\u4f53\u5b58\u7684\uff0c$len,fail,son[26],siz$  \u5206\u522b\u4ee3\u8868\u8fd9\u4e2a\u4e32\u7684\u957f\uff0cfail\u8282\u70b9\uff0c\u8fde\u51fa\u6765\u7684\u6bcf\u4e00\u6761\u8fb9\u4ee5\u53ca\u8fd9\u4e2a\u56de\u6587\u4e32\u7684\u6570\u91cf\uff0c\u5982\u4e0b\n\n~~~cpp\nstruct node{\n\tint len,fail,son[26],siz;\n\tnode(){\n\t\tlen=fail=0;\n\t\tfor(int i=0;i<=25;i++)\n\t\t\tson[i]=0;\n\t}\n};\nnode prt[maxn]; \n~~~\n\n\u6211\u4eec\u628a\u4e24\u4e2a\u6839\u4e0b\u6807\u8bbe\u4e3a0\u548c1\uff0c\u5e76\u6839\u636e\u4e0a\u9762\u4ecb\u7ecd\u7684\u7ed9\u4ed6\u4eec\u8d4b\u503c\n\n~~~cpp\n\tprt[1].len=-1;\n\tprt[0].fail=prt[1].fail=1;\n~~~\n\n\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u70b9\u4e00\u4e2a\u4e00\u4e2a\u52a0\u5165\u5230\u56de\u6587\u81ea\u52a8\u673a\u4e2d\uff0c\u8fd9\u53ef\u4ee5\u7528\u4e00\u4e2a\u51fd\u6570$extend$\u6765\u5b9e\u73b0\uff0c\u5177\u4f53\u5b9e\u73b0\u65b9\u6cd5\u5982\u4e0b\uff1a\n\n\u8bbe\u6211\u4eec\u4ee5\u524d\u63d2\u5165\u7684\u6700\u540e\u4e00\u4e2a\u70b9\u4e3a$last$\uff0c\u8fd9\u6b21\u8981\u63d2\u5165\u4e00\u4e2a\u70b9x\uff0c\u9996\u5148\u8981\u627e\u5230\u4e00\u4e2a\u70b9$cur$\u4e3a\u6ee1\u8db3\u524d\u9762\u7684\u5b57\u7b26\u7b49\u4e8e\u65b0\u52a0\u5165\u5b57\u7b26\u7684\uff0c$last$\u7684\u6700\u957f\u7684\u56de\u6587\u540e\u7f00\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u4e0d\u505c\u5730\u5728$last$\u7684$fail$\u94fe\u4e0a\u8dd1\uff0c\u56e0\u4e3a$fail$\u6240\u5bf9\u5e94\u7684\u6b63\u662f\u4e32\u7684\u6700\u957f\u56de\u6587\u540e\u7f00\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u7528\u4e0b\u9762\u51fd\u6570\u5b9e\u73b0\uff1a\n~~~cpp\nint getfail(int x){\n\twhile(s[n-prt[x].len-1]!=s[n]) x=prt[x].fail;\n\treturn x;\n}\n~~~\n\u82e5$cur$\u5df2\u7ecf\u5305\u542b\u6743\u503c\u4e3ax\u7684\u51fa\u8fb9\u4e86\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7b80\u5355\u5730\u5c06\u51fa\u8fb9\u7ec8\u70b9\u7684\u6743\u503c++\uff0c\u7ee7\u7eed\u53bb\u52a0\u4e0b\u4e00\u4e2a\u70b9\u4e86\u3002\u5982\u679c\u4e0d\u5305\u542b\u6743\u503cx\u7684\u8fb9\uff0c\u6211\u4eec\u5c31\u9700\u8981\u65b0\u5efa\u4e00\u4e2a\u70b9$now$\u5e76\u8ba9$cur$\u628a\u8fb9\u8fde\u5411\u4ed6\uff0c$now$\u4ee3\u8868\u7684\u957f\u5ea6\u81ea\u7136\u662f$cur$\u7684\u957f\u5ea6+2\uff0c\u7136\u540e\u6211\u4eec\u53ea\u8981\u6c42\u51fa$cur$\u7684$fail$\u5c31\u5b8c\u4e8b\u4e86\u3002\n\n\u6c42$fail$\u7684\u8bdd\u53ef\u4ee5\u7528cur\u7684$fail$\u6765\u6c42\uff0c\u5c31\u7528\u4e0a\u9762\u6c42$cur$\u7684\u65b9\u6cd5\uff0c\u4f46\u662f\u4e0d\u80fd\u7528$cur$\u672c\u8eab\uff08\u60f3\u4e00\u60f3\uff0c\u4e3a\u4ec0\u4e48\uff09\n\n\u5f53\u7136\u6700\u540e\u5343\u4e07\u4e0d\u8981\u5fd8\u8bb0\u628a$last$\u7684\u503c\u66f4\u65b0\u554a$qwq$\n\n~~~cpp\nvoid extend(int x){\n\tint cur=getfail(last);\n\tif(!prt[cur].son[x]){\n\t\tint now=++num;\n\t\tprt[now].len=prt[cur].len+2;\n\t\tprt[now].fail=prt[getfail(prt[cur].fail)].son[x];\n\t\tprt[cur].son[x]=now;\n\t}\n\tprt[prt[cur].son[x]].siz++;\n\tlast=prt[cur].son[x];\n}\n~~~\n\n\u7d2f\u8ba1\u7b54\u6848\u53ef\u4ee5\u4ece\u4e0b\u5f80\u4e0a\u628a\u56de\u6587\u4e32\u6570\u76ee\u52a0\u8d77\u6765\uff0c\u663e\u7136\u4e0a\u9762\u7684\u4e32\u4e00\u5b9a\u662f\u4e0b\u9762\u4e32\u7684\u5b50\u4e32\u561b$qwq$\n\n~~~cpp\nvoid count(){\n\tfor(int i=num;i>=2;i--)\n\t\tprt[prt[i].fail].siz+=prt[i].siz;\n}\n~~~\n\n#### 4.\u8fd8\u662f\u4e0d\u592a\u61c2\uff1f\u7167\u7740\u56fe\u7247\u6a21\u62df\u4e00\u8fb9\u5c31\u597d\u4e86\u5566\uff1a\n#### $\\quad$\u6b64\u5904\u611f\u8c22 @\u5355\u66e6\u589e \u795e\u7287\u4e3a\u6211\u4eec\u63d0\u4f9b\u795e\u56fe (\u6837\u4f8b) \u8bb0\u5f97\u819c\u62dc\u54e6$orz$\n\n![](https://cdn.luogu.com.cn/upload/pic/32635.png)\n\n\u5982\u56fe\uff0c\u6211\u4eec\u5df2\u7ecf\u628a\u4e32$abab$\u7684\u56de\u6587\u81ea\u52a8\u673a\u5efa\u597d\u4e86\uff0c\u4e0b\u9762\u8981\u6dfb\u52a0\u4e00\u4e2a\u70b9$a$\uff0c\u6b64\u65f6$last=5$\n\n\u9996\u5148\u6c42\u51fa$cur$\uff0c$last$\u6240\u4ee3\u8868\u7684\u56de\u6587\u4e32$bab$\u524d\u8fb9\u7684\u5b57\u7b26\u6b63\u597d\u4e0e\u8981\u52a0\u5165\u7684\u5b57\u7b26$a$\u76f8\u7b49\uff0c\u6240\u4ee5$cur$\u5c31\u662f$last$\uff0c\u6211\u4eec\u53d1\u73b0$cur$\u4e0d\u5b58\u5728\u8fb9\u6743\u4e3a$a$\u7684\u51fa\u8fb9\uff0c\u4e8e\u662f\u65b0\u5efa\u4e2a\u70b9 6\uff0c\u4ece$cur$\u8fde\u4e00\u6761\u8fb9$a$\u5230 6\uff1b\n\n![](https://cdn.luogu.com.cn/upload/pic/32638.png)\n\n6 \u7684\u957f\u5ea6\u81ea\u7136\u662f5\u7684\u957f\u5ea6+2$(a'bab'a)$\n\n\u7136\u540e\u6c426\u7684$last$\uff1a5\u7684$fail$\u6307\u54113$(b)$\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c3\u524d\u9762\u7684\u90a3\u4e2a\u5b57\u7b26$a$\u5c31\u662f\u65b0\u52a0\u7684\u5b57\u7b26\uff08\u600e\u4e48\u90a3\u4e48\u5de7...\uff09\uff0c\u4e8e\u662f\u6211\u4eec\u628a6\u7684fail\u6307\u5411\u70b93\u7684$a$\u8fb9\u6240\u6307\u5411\u7684\u70b94;\n\n\u55ef\uff0c$last$\u66f4\u65b0\u4e3a6\uff0c6\u7684\u6570\u91cf++\uff0c\u7ed3\u675f\uff1b\n\n![](https://cdn.luogu.com.cn/upload/pic/32634.png)\n\n\u6700\u540e\u7d2f\u52a0\u7b54\u6848\uff0c\n\n$siz(6)=1$\uff0c$siz(4)=1$\n\n$(siz(5)+=siz(6))=2$\n\n$(siz(4)+=siz(6))=2$\n\n$(siz(3)+=siz(5))=2$\n\n$(siz(2)+=siz(4))=3$\n#### \u9644\uff1a\u95f2\u5f97\u81ea\u5df1\u4e5f\u5199\u4e86\u4e2a\u9020\u56fe\u7684\u4ee3\u7801\u3002\u3002\u3002\n\n~~~cpp\nvoid print(int x){\n\tif(cz[x]) return;\n\tcz[x]=1;\n\tprintf(\"\t%d->%d[style=\\\"dashed\\\"];\\n\",x,sam[x].link);\n\tfor(int i=0;i<=25;i++)\n\t\tif(sam[x].ch.count(i))\n\t\t\tprintf(\"\t%d->%d[label=%d];\\n\",x,sam[x].ch[i],i),\n\t\t\tprint(sam[x].ch[i]);\n}\nvoid Vz(){\n\tprintf(\"digraph zhy{\\n\trankdir = LR;\\n\");\n\tprint(0);\n\tprintf(\"}\\n\");\n}\n~~~\n\n#### 5.\u8fd9\u9898\uff1a\n$\\quad$\u8fd9\u9053\u9898\u7684\u8bdd\u5c31\u662f\u628a\u8fd9\u4e9b\u70b9\u6309\u7167\u957f\u5ea6\u4ece\u5927\u5230\u5c0f\u6392\u4e00\u904d\u5e8f\uff0c\u7136\u540e\u524d$k$\u4e2a\u5947\u6570\u957f\u7684\u4e58\u8d77\u6765\u5c31\u662f\u7b54\u6848\u5566\uff0c\u6ce8\u610f\u8fd9\u9898k\u8f83\u5927\uff0c\u8fd8\u8981\u7528\u5feb\u901f\u5e42\u54e6\uff0c\u4ee3\u7801\uff1a \n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\ntypedef long long ll;\nconst int maxn=1e6+100,P=19930726;\nstruct node{\n\tint len,fail,son[26],siz;\n\tnode(){\n\t\tlen=fail=0;\n\t\tfor(int i=0;i<=25;i++)\n\t\t\tson[i]=0;\n\t}\n};\nnode prt[maxn]; \nint n,last,len,num;\nll ans=1,k;\nchar s[maxn];\nll poww(ll x,int y){\n\tll base=1;\n\twhile(y){\n\t\tif(y&1) base*=x,base%=P;\n\t\tx*=x,x%=P;\n\t\ty>>=1;\n\t}\n\treturn base;\n}\nbool cmp(node x,node y){\n\treturn x.len>y.len;\n}\nint getfail(int x){\n\twhile(s[n-prt[x].len-1]!=s[n]) x=prt[x].fail;\n\treturn x;\n}\nvoid extend(int x){\n\tint cur=getfail(last);\n\tif(!prt[cur].son[x]){\n\t\tint now=++num;\n\t\tprt[now].len=prt[cur].len+2;\n\t\tprt[now].fail=prt[getfail(prt[cur].fail)].son[x];\n\t\tprt[cur].son[x]=now;\n\t}\n\tprt[prt[cur].son[x]].siz++;\n\tlast=prt[cur].son[x];\n}\nint main(){\n\tscanf(\"%d%d\",&len,&k);\n\tscanf(\"%s\",s);\n\tlast=num=1,prt[1].len=-1;\n\tprt[0].fail=prt[1].fail=1;\n\tfor(n=0;n<len;n++) extend(s[n]-'a');\n\tfor(int i=num;i>=2;i--)\n\t\tprt[prt[i].fail].siz+=prt[i].siz,prt[prt[i].fail].siz%=P;\n\tsort(prt+1,prt+num+1,cmp);\n\tint now=1;\n\twhile(k){\n\t\tif(now>num){\n\t\t\tprintf(\"-1\\n\");\n\t\t\treturn 0;\n\t\t}\n\t\tif(prt[now].len%2==0){\n\t\t\tnow++;\n\t\t\tcontinue;\n\t\t}\n\t\tif(prt[now].siz<k){\n\t\t\tk-=prt[now].siz;\n\t\t\tans*=poww(prt[now].len,prt[now].siz)%P;\n\t\t\tans%=P;\n\t\t\tnow++;\n\t\t}\n\t\telse{\n\t\t\tans*=poww(prt[now].len,k)%P;\n\t\t\tans%=P;\n\t\t\tk=0;\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",ans);\n}\n\n\n\n\n```\n\n",
        "postTime": 1536673418,
        "uid": 53421,
        "name": "nianheng",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "\u5148\u8dd1\u4e00\u6b21\u7c7b\u4f3cmanacher\u7684\u4e1c\u897f\u3002\u56e0\u4e3a\u53ea\u9700\u8981\u6c42\u5947\u6570\u4e2a\u7684\u56de\u6587\u4e32\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u518d\u5b57\u7b26\u4e32\u4e2d\u63d2\u5165\u5176\u4ed6\u5b57\u7b26\u3002\n\n\u6c42\u5b8cp\u6570\u7ec4\u4ee5\u540e\u7528\u4e00\u4e2a\u6876\u5b58\u4e0b\u6765\uff0c\u4ece\u5c0f\u4e8en\u7684\u6700\u5927\u5947\u6570\u5f00\u59cb\u5f80\u4e0b\u7edf\u8ba1\uff0c\u7edf\u8ba1\u5b8c\u5c31\u597d\u4e86\u3002\n\n\u6ce8\u610f\uff1a\u7edf\u8ba1\u7b54\u6848\u65f6\u4e0d\u80fd\u4e00\u4e2a\u4e00\u4e2a\u4e58\uff0c\u4f1atle\uff0c\u56e0\u4e3a\u6700\u540e\u4e00\u4e2a\u70b9k=1000,000,000,000,\u6240\u4ee5\u8981\u7528\u5feb\u901f\u5e42\u6765\u4f18\u5316\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<cstdio>\nlong long quick_pow(long long x,long long n,int mod){\n    long long ans=1;\n    while(n){\n        if(n&1)\n            ans=(ans*x)%mod;\n        x=(x*x)%mod;\n        n>>=1;\n    }\n    return ans;\n}\nlong long min(long long a,int b){\n    return a<b?a:b;\n}\nconst int mod=19930726;\nchar s[1000010];\nint n,pos=-1,R=-1,p[1000010],vis[1000010],t[1000010];\nlong long k,ans=1;\nint main(){\n    freopen(\"test.in\",\"r\",stdin);\n    freopen(\"test2.out\",\"w\",stdout);\n    scanf(\"%d%lld%s\",&n,&k,s+1);\n    s[0]='$';\n    for(int i=1;i<=n;i++){\n        p[i]=i<R?min(p[(pos<<1)-i],R-i):1;\n        while(s[i+p[i]]==s[i-p[i]])\n            p[i]++;\n        if(i+p[i]-1>R){\n            pos=i;\n            R=i+p[i]-1;\n        }\n        t[(p[i]-1)<<1|1]++;\n    }\n    int cnt=0;\n    for(int i=n&1?n:n-1;i>=1;i-=2){\n        cnt+=t[i];\n        if(cnt>k){\n            ans=ans*quick_pow(i,k,mod)%mod;\n            break;\n        }\n        else{\n            ans=ans*quick_pow(i,cnt,mod)%mod;\n            k-=cnt;\n        }\n    }\n    k>cnt?puts(\"-1\"):printf(\"%lld\",ans);\n    return 0;\n}\n```",
        "postTime": 1516794072,
        "uid": 49097,
        "name": "ezoiHQM",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "## \u86e4\uff1f\u7adf\u7136\u662f\u9996\u6740\uff0c\u90a3\u4e48\u518d\u6765\u4e2a\u9898\u89e3\u5427\n\n\n---\n\n\u66f4\u597d\u7684\u4f53\u9a8c\u8bf7\u79fb\u6b65 \uff1a [\u4ffa\u7684\u535a\u5ba2](http://www.cnblogs.com/noblex/p/8313535.html \"\u4ffa\u7684\u535a\u5ba2\")\n\n\n\n---\n\u8fd9\u9898\u53ef\u771f\u662f\u4e00\u9053\u7ec3\u4e60Manacher\u7684\u597d\u9898\u554a\u3002\n\n\n**\u770b\u5230\u56de\u6587\u5f53\u7136\u662f\u8981\u7528\u9a6c\u62c9\u8f66\u778e\u641e\u5566\u3002\n\n\u4f46\u662f\u9a6c\u62c9\u8f66\u53ea\u80fd\u641e\u51fa\u4ee5\u5f53\u524d\u70b9\u4e3a\u4e2d\u5fc3\u7684\u6700\u5927\u56de\u6587\u5b50\u4e32\u957f\u5ea6\u3002\n\n\u4e8e\u662f\u5148\u641e\u51fa\u6700\u5927\u7684length\u4e4b\u540e\u3002\u90a3\u4e48\u6839\u636e\u5bf9\u79f0\u6027\u6613\u8bc1\u4e5f\u6709\u957f\u4e3a![](https://images2017.cnblogs.com/blog/1231076/201801/1231076-20180118232543068-101970944.png)\u7684\u56de\u6587\u5b50\u4e32\uff0c\u7136\u540e\u7edf\u8ba1\u4e00\u4e0b\u5c31\u884c\u4e86\u3002\n\n\u9898\u76ee\u8981\u6c42\u5947\u6570\u4e2a\uff0c\u628a\u5076\u6570\u4e2a\u7684\u5168\u8e22\u6389\u5c31\u884c\u4e86\u3002**\n\n\n---\n\n\u4e11\u964b\u7684\u4ee3\u7801\uff08\u6342\u773c\uff09\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int MOD=19930726,MAXN=1000003;\nchar s[MAXN],now[MAXN*2];\nint p[MAXN*2],cnt[MAXN],len,n;\nll ans=1,k;\n\nll poww(int x,int y)\n{\n    if(x==1) return 1;\n    ll base=x,res=1;\n    while(y)\n    {\n        if(y&1) res=(res*base)%MOD;\n        base=(base*base)%MOD;\n        y>>=1;\n    }\n    return res;\n}\n\nvoid Manacher()\n{\n    for(int i=1;i<=len;i++)\n    {\n        now[2*i-1]='%'; now[2*i]=s[i];\n    }\n    now[len=2*len+1]='%';\n    \n    int pos=0,R=0;\n    for(int i=1;i<=len;i++)\n    {\n        if(i<R) p[i]=min(p[2*pos-i],R-i);\n        else p[i]=1;\n        while(p[i]+i<=len && i-p[i]>=1 && now[i+p[i]]==now[i-p[i]]) p[i]++;\n        if(p[i]+i>R)\n        {\n            pos=i;\n            R=i+p[i];\n        }\n        if((p[i]-1)%2) cnt[p[i]-1]++;\n    }\n}\n\nvoid solve()\n{\n    int sum=0;\n    for(int i=n;i>=1;i--)\n    {\n        if(i%2==0) continue;\n        sum+=cnt[i];\n        if(k>=sum)\n        {\n            ans=(ans*poww(i,sum))%MOD;\n            k-=sum;\n        }\n        else\n        {\n            ans=(ans*poww(i,k))%MOD;\n            k-=sum; break;\n        }\n    }\n    if(k>0) ans=-1; \n}\n\nint main()\n{\n    scanf(\"%d%lld%s\",&n,&k,s+1); len=n;\n    Manacher(); solve();\n    printf(\"%lld\",ans); \n}\n```",
        "postTime": 1516367166,
        "uid": 36281,
        "name": "noble_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "### \u5206\u6790\n\u8fd9\u4e00\u9053\u9898\u7684\u5927\u81f4\u610f\u601d\u5c31\u662f\u8ba9\u4f60\u6c42\u51fa\u4e00\u4e2a\u5b57\u7b26\u4e32\u4e2d\u6240\u6709\u7684\u5947\u56de\u6587\u4e32\uff0c\u5e76\u628a\u5b83\u4eec\u7684\u957f\u5ea6\u8fde\u4e58\n\n\u8003\u8651\u5230\u6c42\u56de\u6587\u4e32\uff0c\u6211\u4eec\u8981\u4f7f\u7528$manacher$\u7b97\u6cd5\n\n\u56e0\u4e3a\u9898\u76ee\u4e2d\u53ea\u8ba9\u4f60\u6c42\u51fa\u5947\u56de\u6587\u4e32\u7684\u4e2a\u6570\uff0c\u56e0\u6b64\u6211\u4eec\u4e0d\u7528\u5728\u539f\u6765\u7684\u5b57\u7b26\u4e4b\u95f4\u518d\u63d2\u5165\u7279\u6b8a\u5b57\u7b26\n\n\u5728\u8fdb\u884c\u6c42\u89e3\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8981\u4f7f\u7528\u4e00\u4e2a$p[i]$\u6570\u7ec4\u8bb0\u5f55\u4ee5$i$\u4e3a\u4e2d\u5fc3\u7684\u6700\u5927\u56de\u6587\u534a\u5f84\u7684\u957f\u5ea6\n\n\u800c\u5bf9\u4e8e\u4e00\u4e2a\u4f4d\u7f6e$i$\uff0c\u5982\u679c\u5411\u4e24\u8fb9\u6269\u5c55$p[i]$\u662f\u4e00\u4e2a\u56de\u6587\u4e32\uff0c\u90a3\u4e48\u5411\u4e24\u8fb9\u6269\u5c55$p[i]-k(p[i]-k\\geq 1)$\u4e5f\u662f\u4e00\u4e2a\u56de\u6587\u4e32\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6c42\u51fa\u4ee5$i$\u4e3a\u4e2d\u5fc3\u7684\u6240\u6709\u56de\u6587\u534a\u5f84\u7684\u957f\u5ea6\n\n\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u4f7f\u7528$for$\u5faa\u73af\u76f4\u63a5\u904d\u5386\uff0c\u5fc5\u5b9a\u4f1a\u8d85\u65f6\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5dee\u5206\u6570\u7ec4\u89e3\u51b3\u8fd9\u4e00\u4e2a\u95ee\u9898\uff0c\u5373\u5728$1$\u7684\u4f4d\u7f6e\u52a0\u4e00\uff0c\u5728$2 \\times p[i] -1$\u7684\u4f4d\u7f6e\u51cf\u4e00\n\n\u6700\u540e$O(n)$\u626b\u4e00\u904d\u5373\u53ef\n\n\u8fd8\u6709\u8981\u6ce8\u610f\u7684\u4e00\u70b9\u662f\uff0c\u5728\u8fdb\u884c\u4e58\u6cd5\u7684\u65f6\u5019\uff0c\u56e0\u4e3a$k$\u7684\u8303\u56f4\u5f88\u5927\uff0c\u6240\u4ee5\u8981\u4f7f\u7528\u5feb\u901f\u5e42\n\n### \u4ee3\u7801\n``` cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nconst int maxn=1e6+5;\nchar s[maxn];\nint p[maxn],k,len,cf[maxn];\nconst int mod=19930726;\nint ksm(int ds,int zs){\n    int ans=1;\n    while(zs){\n        if(zs&1) ans=ans*ds%mod;\n        ds=ds*ds%mod;\n        zs>>=1;\n    }\n    return ans;\n}\nsigned main(){\n    scanf(\"%lld%lld\",&len,&k);\n    scanf(\"%s\",s+1);\n    s[0]='$';\n    for(int i=1,r=0,mids=0;i<=len;i++){\n        if(i<=r) p[i]=min(p[2*mids-i],r-i+1);\n        while(s[i-p[i]]==s[i+p[i]]) p[i]++;\n        if(p[i]+i>r) r=p[i]+i-1,mids=i;\n        cf[1]++,cf[p[i]*2]--;\n    }\n    for(int i=1;i<=len;i++){\n        cf[i]=cf[i-1]+cf[i];\n    }\n    int mans=1,tot=len;\n    if(tot%2==0) tot--;\n    while(k>0 && tot>0){\n        mans=mans*ksm(tot,min(cf[tot],k))%mod;\n        k-=cf[tot];\n        tot-=2;\n    }\n    if(k>0) printf(\"-1\\n\");\n    else printf(\"%lld\\n\",mans);\n    return 0;\n}\n```",
        "postTime": 1595629487,
        "uid": 316322,
        "name": "hzoi_liuchang",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u6c42\u56de\u6587\u4e32\uff0c\u5f88\u660e\u663e\u5c31\u662fmanacher\u5427\u3002\n\n### \u4f46\u662f\n\n\u8fd9\u9053\u9898\u5197\u957f\u7684**\u9898\u76ee\u63cf\u8ff0**\u4e2d\u9690\u85cf\u4e86\u4e00\u4e2a**\u5173\u952e\u8981\u7d20**\uff1a\n\n _\u5982\u679c\u8fde\u7eed\u7684\u4e00\u6bb5\u5973\u751f\uff0c\u6709**\u5947\u6570**\u4e2a\u3002_ \n\n\u4e8e\u662f\uff1a$AC->WA$ \u3002\n\n---\n\n\u65e2\u7136\u56de\u6587\u4e32\u7684\u957f\u5ea6\u5fc5\u5b9a\u662f**\u5947\u6570**\u4e2a\uff0c\u90a3\u4e48Manacher\u7b97\u6cd5\u4e2d\uff0c\u5c31\u4e0d\u7528\u5728\u6bcf\u4e2a\u5b57\u7b26\u4e4b\u95f4\u63d2\u5165\u65e0\u5173\u5b57\u7b26\u4e86\u3002\n\n\u6240\u4ee5\u5728\u539f\u4e32\u4e0a\u8dd1\u4e00\u904dManacher\uff0c\u5c31\u5b8c\u4e86\u567b\u3002\n\n\u8fd8\u6709\u4e00\u70b9\u8981\u6ce8\u610f\uff1a**\u6570\u636e\u8303\u56f4**\u4e2d$k \\leq 10^{12}$\uff0c\u663e\u7136\u4e00\u4e2a\u4e00\u4e2a\u7d2f\u4e58\u4f1a\u8d85\u65f6\uff0c\u6240\u4ee5\u8981\u7528\u5230\u5feb\u901f\u5e42\u3002\n\n${\\sf Code:}$\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#define maxn 1000100\n#define mod 19930726\n#define lxl long long\nusing namespace std;\n\nint n;\nchar s[maxn];\nint lens;\nlxl stack[maxn],k;\nint RL[maxn];\n\ninline lxl pw(int x,lxl a)\n{\n\tif(x==0) return 0;\n\tif(x==1||a==0) return 1;\n\tif(a==1) return x%mod;\n\tif(a==2) return x*x%mod;\n\tlxl pww=pw(x,a/2);      //\u8fd9\u91cc\u8981\u9884\u5148\u5f97\u5230\u6570\u503c\uff0c\u5426\u5219\u591a\u6b21\u8c03\u7528\u4f1a\u8d85\u65f6\n\tif(a%2) return pww%mod*pww%mod*x%mod;\n\telse return pww%mod*pww%mod;\n}\n\ninline void Manacher()\n{\n\tint pos=0,MaxRight=0;\n\tfor(int i=0;i<lens;i++)\n\t{\n\t\tRL[i]=MaxRight>i?min(RL[2*pos-i],MaxRight-i):1;\n\t\twhile(i+RL[i]<lens&&i-RL[i]>=0&&s[i+RL[i]]==s[i-RL[i]])//\u8fd9\u91cc\u56e0\u4e3a\u6ca1\u6709\u63d2\u5165\u65e0\u5173\u5b57\u7b26\u9632\u6b62\u51fa\u754c\uff0c\u6240\u4ee5\u8981\u52a0\u5224\u65ad\n\t\t\tRL[i]++;\n\t\tif(MaxRight<i+RL[i])\n\t\t{\n\t\t\tMaxRight=i+RL[i];\n\t\t\tpos=i;\n\t\t}\n\t\tstack[RL[i]]++;//stack\u8ba1\u6570\u4ee5\u6bcf\u4e00\u4e2a\u5b57\u7b26\u4e3a\u5bf9\u79f0\u8f74\uff0c\u51fa\u73b0\u76f8\u540c\u7684\u6700\u957f\u56de\u6587\u5b50\u4e32\u7684\u534a\u5f84\u7684\u6b21\u6570\n\t}\n}\n\nint main()\n{\n//\tfreopen(\"P1659.in\",\"r\",stdin);\n\tscanf(\"%d%lld\\n\",&n,&k);\n\tscanf(\"%s\",s);\n\tlens=strlen(s);\n\tManacher();\n\tlxl ans=1,sum=0;\n\tfor(int i=(lens+1)/2;i>=1;i--)//(lens+1)/2\u4e3a\u53ef\u80fd\u7684\u6700\u957f\u56de\u6587\u5b50\u4e32\u7684\u534a\u5f84\u957f\u5ea6\t\t\t\t\n    \t\tif(k>0)\n\t\t{\n\t\t\tsum+=stack[i];//sum\u7d2f\u52a0\uff0c\u56e0\u4e3a\u5728\u4e00\u4e2a\u6700\u957f\u56de\u6587\u5b50\u4e32\u4e2d\uff0c\u5bf9\u79f0\u8f74\u76f8\u540c\u7684\u957f\u5ea6\u66f4\u5c0f\u7684\u5b50\u4e32\u90fd\u662f\u56de\u6587\u5b50\u4e32\n                                //\u6240\u4ee5\u957f\u5ea6\u4e3a(i-1)<<1|1\u7684\u56de\u6587\u5b50\u4e32\u7684\u4e2a\u6570\u4e3astack[i]+...+stack[(lens+1)/2]\n\t\t\tans=ans*pw((i-1)<<1|1,min(k,sum))%mod;\n\t\t\tk-=min(k,sum);\n\t\t}\n\tif(k>0) printf(\"-1\");\n\telse printf(\"%lld\",ans);\n\treturn 0;\n}\n\n```\n",
        "postTime": 1579077716,
        "uid": 224236,
        "name": "GoPoux4",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "## \u9898\u610f\u7b80\u8ff0\n\n\u8be2\u95ee\u4e00\u4e2a\u4e32\u4e2d\u6240\u6709\u5947\u56de\u6587\u6309\u7167\u957f\u5ea6\u964d\u5e8f\u6392\u5217\uff0c\u524dk\u4e2a\u5947\u56de\u6587\u7684\u957f\u5ea6\u4e58\u79ef\u3002\n\n## \u505a\u6cd5\n\n\u56de\u6587\u81ea\u52a8\u673a (PAM) \u6a21\u677f\u9898\u3002\n\n\u7ef4\u62a4\u6bcf\u4e2a\u56de\u6587\u81ea\u52a8\u673a\u7684\u7ed3\u70b9\u56de\u6587\u4e32\u51fa\u73b0\u6b21\u6570\uff0c\u8df3 fail \u5f97\u5230\u6bcf\u4e2a\u957f\u5ea6\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u53cc\u5173\u952e\u5b57\u6392\u5e8f\u540e\u7528\u5feb\u901f\u5e42\u7edf\u8ba1\u7b54\u6848\u3002\n\n## Code\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define re register int\n#define db double\n#define in inline\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define re register int\n#define db double\n#define in inline\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define re register int\n#define db double\n#define in inline\nnamespace fast_io\n{\n    char buf[1<<12],*p1=buf,*p2=buf,sr[1<<23],z[23],nc;int C=-1,Z=0,Bi=0;\n    in char gc() {return p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<12,stdin),p1==p2)?EOF:*p1++;}\n    in ll read()\n    {\n        ll x=0,y=1;while(nc=gc(),(nc<48||nc>57)&&nc!=-1)if(nc==45)y=-1;Bi=1;\n        x=nc-48;while(nc=gc(),47<nc&&nc<58)x=(x<<3)+(x<<1)+(nc^48),Bi++;return x*y;\n    }\n    in db gf() {re a=read(),b=(nc!='.')?0:read();return (b?a+(db)b/pow(10,Bi):a);}\n    in int gs(char *s) {char c,*t=s;while(c=gc(),c<32);*s++=c;while(c=gc(),c>32)*s++=c;return s-t;}\n    in void ot() {fwrite(sr,1,C+1,stdout);C=-1;}\n    in void flush() {if(C>1<<22) ot();}\n    template <typename T>\n    in void write(T x,char t)\n    {\n        re y=0;if(x<0)y=1,x=-x;while(z[++Z]=x%10+48,x/=10);\n        if(y)z[++Z]='-';while(sr[++C]=z[Z],--Z);sr[++C]=t;flush();\n    }\n    in void write(char *s) {re l=strlen(s);for(re i=0;i<l;i++)sr[++C]=*s++;sr[++C]='\\n';flush();}\n};\nusing namespace fast_io;\nconst int N=2e5+5;\n#define ls(x) ch[x][0]\n#define rs(x) ch[x][1]\nint n,m,ch[N][2];\nchar s[]\nint main()\n{\n\tn=read(),m=read();\n}\nconst int N=1e6+5,mod=19930726;\nint n,m,tot,ch[N][26],len[N],sum[N],fail[N],f[N],lst,q[N],h,t;\nll k,ans=1;\nchar s[N];\nin int new_node(re x) \n{\n\tlen[++tot]=x,fail[tot]=sum[tot]=0;\n\tch[tot][0]=ch[tot][1]=ch[tot][2]=ch[tot][3]=0;\n\treturn tot;\n}\nin void init() {tot=-1;new_node(0),new_node(-1);fail[0]=fail[1]=1;lst=0;}\nin void ins(re c,re pos)\n{\n\tre p=lst;\n\twhile(s[pos-len[p]-1]!=s[pos]) p=fail[p];\n\tif(!ch[p][c])\n\t{\n\t\tre np=new_node(len[p]+2),q=fail[p];\n\t\twhile(s[pos-len[q]-1]!=s[pos]) q=fail[q];\n\t\tfail[np]=ch[q][c];ch[p][c]=np;\n\t}\n\tsum[lst=ch[p][c]]++;\n}\nin ll qpow(ll x,re y) {ll z=1;for(;y;y>>=1,x=x*x%mod) if(y&1) z=z*x%mod;return z;}\nint main()\n{\n\tn=read(),k=read();gs(s+1);init();\n\tfor(re i=1;i<=n;i++) ins(s[i]-'a',i);\n\tfor(re i=tot;i;i--) sum[fail[i]]+=sum[i];\n\tvector<pair<int,int> >v;\n\tfor(re i=2;i<=tot;i++) v.emplace_back(len[i],sum[i]);\n\tsort(v.begin(),v.end());reverse(v.begin(),v.end());\n\tfor(auto x:v) if(x.first&1)\n\t{\n\t\tll mi=min(k,(ll)x.second);k-=mi;\n\t\tans=(ll)ans*qpow(x.first,mi)%mod;\n\t\tif(!k) break;\n\t}\n\tif(k) write(\"-1\");else write(ans,'\\n');\n\treturn ot(),0;\n}\n//Author: disangan233\n```",
        "postTime": 1564847629,
        "uid": 72679,
        "name": "disangan233",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "### \u3010\u9898\u76ee\u3011\n![\u9898\u76ee](https://cdn.luogu.com.cn/upload/pic/29049.png)\n\n### \u3010\u89e3\u9898\u601d\u8def\u3011\n- \u8003\u8651\u4f7f\u7528manacher\u3002\n- \u5148\u7528manacher\u6c42\u51fa\u6bcf\u4e00\u79cd\u957f\u5ea6\u7684\u56de\u6587\u4e32\u7684\u4e2a\u6570\uff0c\u8981\u6ce8\u610f\u56de\u6587\u4e32\u7684\u957f\u5ea6\u5fc5\u987b\u662f\u5947\u6570\u3002\n- \u7531\u4e8e\u4e00\u4e2a\u957f\u5ea6\u4e3an\u7684\u56de\u6587\u4e32\u5185\u5fc5\u7136\u5b58\u5728\u957f\u5ea6\u4e3an-2\u3001n-4\u2026\u2026\u7684\u56de\u6587\u4e32\uff0c\u56e0\u6b64\u56de\u6587\u4e32\u957f\u5ea6\u5927\u7684\u6570\u91cf\u9700\u8981\u7edf\u8ba1\u5230\u957f\u5ea6\u5c0f\u7684\u91cc\uff0c\u6240\u4ee5\u8003\u8651\u4f7f\u7528\u524d\u7f00\u548c\u3002\n- \u679a\u4e3e\u56de\u6587\u4e32\u7684\u957f\u5ea6\u4e3an~1\u7684\u5947\u6570\uff0c\u5e76\u7edf\u8ba1\u524d\u7f00\u548c\u3002\u7531\u4e8eK\u5f88\u5927\uff0c\u56e0\u6b64\u9700\u8981\u5feb\u901f\u5e42\u4f18\u5316\u3002\u5e76\u4e14\u7edf\u8ba1\u626b\u63cf\u5230\u4e86\u591a\u5c11\u4e2a\u56de\u6587\u4e32\u3002\n- \u6700\u540e\u5224\u65ad\u5982\u679c\u56de\u6587\u4e32\u4e2a\u6570\u5c0f\u4e8eK\u5c31\u8f93\u51fa-1\u3002\n\n### \u3010\u53c2\u8003\u7a0b\u5e8f\u3011\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\nusing namespace std;\ntypedef long long LL;\n#define int LL\nchar st[2000005],s[2000005];\nint p[2000005],cnt[2000005];\nint n,k;\n#define Mod 19930726\nint change()\n{\n    int len=strlen(st);\n    int j=2;\n    s[0]='^';\n    s[1]='$';\n    for (int i=0;i<len;i++)\n    {\n        s[j++]=st[i];\n        s[j++]='$';\n    }\n    s[j]='&';\n    return j;\n}\nint Manacher()\n{\n    int len=change(),mid=1,mx=1,ans=-1;\n    for (int i=1;i<len;i++)\n    {\n        if (i<mx)\n            p[i]=min(mx-i,p[mid*2-i]);\n        else\n            p[i]=1;\n        while (s[i-p[i]]==s[i+p[i]])\n            p[i]++;\n        if (mx<i+p[i])\n        {\n            mid=i;\n            mx=i+p[i];\n        }\n        if ((p[i]-1)%2)\n        \tcnt[p[i]-1]++;\n    }\n    return ans;\n}\nint q_pow(int a,int b)//\u975e\u9012\u5f52\u5199\u6cd5\u7684\u5feb\u901f\u5e42\n{\n\tint sum;\n\tfor (sum=1;b;b>>=1,a=a*a%Mod)\n\t\tif (b&1)\n\t\t\tsum=(sum*a)%Mod;\n\treturn sum;\n}\nsigned main()\n{\n\tcin>>n>>k;\n\tscanf(\"%s\",st);\n\tManacher();\n\tint ans=1,sum=0;\n\tfor (int i=n;i>=1;i--)\n\t{\n\t\tif (!(i%2)) continue;\n\t\tsum+=cnt[i];\n\t\tif (k>=sum)\n\t\t{\n\t\t\tans=(ans*q_pow(i,sum))%Mod;\n\t\t\tk-=sum;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tans=(ans*q_pow(i,k))%Mod;\n\t\t\tk-=sum;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (k>0) printf(\"-1\");else\n\tcout<<ans;\n\treturn 0;\n}\n```",
        "postTime": 1534469915,
        "uid": 12349,
        "name": "FREEH",
        "ccfLevel": 6,
        "title": "Manacher/\u975e\u9012\u5f52\u5199\u6cd5\u5feb\u901f\u5e42\u2014\u2014\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u662fManacher\u9a6c\u62c9\u8f66\u7b97\u6cd5\u7684\u4e00\u9053\u9898\u76ee\u3002\u6211\u4eec\u53ef\u4ee5\u7528\u9a6c\u62c9\u8f66\u7b97\u6cd5\u6c42\u51fa\u6700\u957f\u7684\u56de\u6587\u5b50\u4e32\u3002\u9a6c\u62c9\u8f66\u7b97\u6cd5\u662f\u4e00\u79cd\u4f18\u79c0\u7684\u7b97\u6cd5\uff0c\u5b83\u53ef\u4ee5\u7ebf\u6027\u590d\u6742\u5ea6\u6c42\u51fa\u56de\u6587\u5b50\u4e32\u3002\u6211\u4eec\u5229\u7528p[i]\u8868\u793a\u4ee5i\u4e3a\u56de\u6587\u5b50\u4e32\u4e2d\u5fc3\u7684\u6700\u5927\u5b50\u4e32\u957f\u5ea6\u3002\u6211\u4eec\u53ef\u4ee5\u4ee5\np[i]=mx>i?min(mx-i,p[id*2-i]):1;\u6c42\u51fap\u6570\u7ec4\u3002\n\u5176\u4e2dmx\u8868\u793a\u80fd\u5339\u914d\u5230\u7684\u6700\u53f3\u8fb9\u7684\u5750\u6807\uff0cid\u8868\u793a\u5f53\u524d\u5339\u914d\u4e2d\u5fc3\u3002\n\u7531\u4e8e\u672c\u9898\u7684\u6570\u636e\u8303\u56f4\uff0c\u6211\u4eec\u9700\u8981\u7528\u5230\u524d\u7f00\u548c\u548c\u5feb\u901f\u5e42\u4f18\u5316\uff0c\u6211\u4f1a\u5728\u7a0b\u5e8f\u91cc\u8bb2\u89e3\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define md 19930726\nusing namespace std;\nll n,m,k,p[5000005],mx,id,tot[1000005],ans=1;\nstring s,t;\nll read(){\n    char c;ll x;while(c=getchar(),c<'0'||c>'9');x=c-'0';\n    while(c=getchar(),c>='0'&&c<='9') x=x*10+c-'0';return x;\n}\nvoid manacher(){\n    t=\"@#\";   //\u8fd9\u9898\u4e5f\u53ef\u4ee5\u4e0d\u63d2\u5165'#'\n    for(ll i=0;i<n;i++){\n        t.push_back(s[i]);\n        t.push_back('#');\n    }\n    for(ll i=1;i<t.size();i++){\n        p[i]=mx>i?min(p[id*2-i],mx-i):1;\n        while(t[i+p[i]]==t[i-p[i]]) p[i]++;\n        if(mx<i+p[i]){\n            mx=i+p[i];id=i;\n        }\n    }\n}\nll pows(ll a,ll b){\n    ll base=1;\n    while(b){\n        if(b&1) base=base*a%md;\n        a=a*a%md;\n        b/=2;\n    }\n    return base;\n}\nint main()\n{\n    n=read();k=read();\n    cin>>s;\n    manacher();\n    for(ll i=1;i<t.size();i++){\n        if(t[i]=='#') continue;\n        /*for(ll j=1;j<=p[i];j++) if(j%2==1) tot[j]++;*/  //\u5982\u679c\u7528for\u4f1a\u8d85\u65f6\n        tot[p[i]-1]++;\n    }\n    for(int i=n;i>=1;i--)\n       if(i%2==1) tot[i]+=tot[i+2];  //\u524d\u7f00\u548c\u4f18\u5316\uff0c\u56e0\u4e3a\u82e5\u5176\u957f\u5ea6\u4e3al\uff0c\u90a3\u4e48\u957f\u5ea6\u4e3al-2,l-4\u2026\u2026\u90fd\u884c\n    for(ll i=n;i>=1;i--){\n        if(!tot[i]) continue;\n        if(k-tot[i]>=0){\n            k-=tot[i];ans=(ans*pows(i,tot[i]))%md;  //\u5feb\u901f\u5e42\u6c42\u89e3\u7b54\u6848\uff0c\u4e0d\u7528\u4e00\u4e2a\u4e00\u4e2a\u4e58\n        }\n        else{\n            ans=(ans*pows(i,k))%md;break;\n        }\n    }\n    printf(\"%lld\",ans%md);\n    return 0;\n}\n```",
        "postTime": 1522301158,
        "uid": 26880,
        "name": "XUCHENGHUI",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "## \u57fa\u672c\u601d\u8def\r\n\r\n\u65e2\u7136\u662f\u6c42\u89e3\u56de\u6587\u4e32\u7684\u95ee\u9898\uff0c\u9996\u5148\u53ef\u4ee5\u8003\u8651\u4e00\u4e0b manacher \u7b97\u6cd5\u3002\r\n\r\n\u6211\u53d1\u73b0\u9898\u89e3\u4e2d\u6709\u7684\u662f\u76f4\u63a5\u5728\u539f\u4e32\u4e0a\u8dd1 manacher\uff0c\u8fd9\u6837\u53ef\u4ee5\u76f4\u63a5\u8fc7\u6ee4\u6389\u957f\u5ea6\u4e3a\u5076\u6570\u7684\u56de\u6587\u4e32\uff0c\u5982\u679c\u662f\u8981\u5728\u4fee\u6539\u540e\u7684\u4e32\u4e0a\u8dd1 manacher \u7684\u8bdd\uff0c\u6211\u4eec\u5728\u7edf\u8ba1\u7b54\u6848\u7684\u65f6\u5019\u53ef\u4ee5\u76f4\u63a5\u7279\u5224\u4e00\u4e0b\uff0c\u628a\u662f\u4ee5\u539f\u4e32\u91cc\u7684\u5b57\u7b26\u4e3a\u4e2d\u5fc3\u7684\u56de\u6587\u4e32\u6700\u5927\u957f\u5ea6\u7ed9\u7b97\u4e0a\uff0c\u8fd9\u6837\u5728\u539f\u4e32\u91cc\u4e5f\u662f\u957f\u5ea6\u4e3a\u5947\u6570\u7684\u56de\u6587\u4e32\u4e86\u3002\r\n\r\n\u5bf9\u4e8e\u6392\u5e8f\u7684\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u5f00\u4e00\u4e2a\u6876 $t$ \u6570\u7ec4\u6765\u8bb0\u5f55\u4e00\u4e0b\u5f53\u524d\u957f\u5ea6\u7684\u56de\u6587\u4e32\u7684\u6570\u91cf\uff0c\u5f88\u5bb9\u6613\u53d1\u73b0\uff0c\u6211\u4eec\u7684 $p[i]$ \u91cc\u9762\u5b58\u653e\u7684\u662f\u4ee5 $i$ \u4e3a\u4e2d\u5fc3\u6700\u5927\u7684\u56de\u6587\u534a\u5f84\uff0c\u6240\u4ee5\u6211\u4eec\u77e5\u9053\uff0c\u50cf `abcdedcba` \u8fd9\u79cd\u56de\u6587\u4e32\uff0c\u4e0d\u4ec5\u53ea\u6709\u8fd9\u4e00\u4e2a\u6700\u957f\u7684\uff0c\u5f53\u53bb\u6389\u4e24\u5934\u5404\u4e00\u4e2a\u5b57\u7b26\u65f6\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e86\u53e6\u4e00\u4e2a\u56de\u6587\u4e32 `bcdedcb`\u3002\r\n\r\n\u73b0\u5728\u8003\u8651\u5982\u679c\u5904\u7406\u4ee5\u4e0a\u7684\u60c5\u51b5\u3002\u5982\u679c\u662f\u5728\u5f80\u6876\u91cc\u9762\u5b58\u653e\u7684\u65f6\u5019\u7528\u4e00\u4e2a\u5faa\u73af\u6765\u4e00\u76f4\u51cf\u4e8c\u4fee\u6539\u7684\u8bdd\uff0c\u50cf\u4e00\u4e9b\u4ee5\u5f53\u524d\u70b9\u4e3a\u56de\u6587\u4e2d\u5fc3\u7684\u5b57\u7b26\u4e32\u5f88\u957f\u7684\u60c5\u51b5\u5c31\u4f1a T \u6389\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u7528\u5230\u7c7b\u4f3c\u4e8e\u7ebf\u6bb5\u6811\u7684\u61d2\u6807\u8bb0\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u5728\u5c06\u5f53\u524d\u7684\u56de\u6587\u4e32\u957f\u5ea6\u4e5f\u5c31\u662f $p[i]-1$ \u653e\u5165\u6876\u4e2d\u7684\u65f6\u5019\uff0c\u5148\u4e0d\u8981\u6025\u7740\u7ed9\u540e\u9762\u7684\u4e5f\u653e\u5165\uff0c\u7b49\u5230\u4e86\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5f53\u524d\u7684 $t[p[i]-1]$ \u8ba1\u7b97\u5b8c\u4e86\u4ee5\u540e\uff0c\u6211\u4eec\u518d\u7ed9 $t[p[i]-1-2]$ \u52a0\u4e0a $t[p[i]-1]$ \u7684\u503c\uff0c\u5c31\u76f8\u5f53\u4e8e\u957f\u5ea6\u4e3a $p[i]-1$ \u7684\u56de\u6587\u4e32\u5168\u90fd\u53bb\u6389\u4e86\u4e24\u5934\u5404\u4e00\u4e2a\u5b57\u7b26\uff0c\u53d8\u4e3a\u4e86 \u957f\u5ea6\u4e3a $p[i]-1-2$ \u7684\u56de\u6587\u4e32\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u6211\u4eec\u7684\u590d\u6742\u5ea6\u5927\u5927\u964d\u4f4e\uff0c\u8dd1\u7684\u4e5f\u5f88\u5feb\u3002\r\n\r\n$k$ \u7684\u8303\u56f4\u8f83\u5927\uff0c\u8981\u7528\u5feb\u901f\u5e42\uff0c\u540c\u65f6\u6ce8\u610f\u53d6\u6a21\u548c\u5224\u65e0\u89e3\u3002\r\n\r\n### code\uff1a\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\n#define int long long\r\n#define P 19930726\r\n#define N 1000010\r\nusing namespace std;\r\nint n,k,p[N<<1],t[N<<1],cnt,maxn;\r\nchar s[N<<1];\r\ninline int ksm(int x,int y)\r\n{\r\n\tint sum=1;\r\n\twhile(y)\r\n\t{\r\n\t\tif(y%2==1)\r\n\t\t  sum=(sum*x)%P;\r\n\t\tx=(x*x)%P;\r\n\t\ty=y>>1;\r\n\t}\r\n\treturn sum%P;\r\n}\r\nsigned main()\r\n{\r\n\tcin>>n>>k;\r\n\tchar c=getchar();\r\n\ts[cnt]='!';s[++cnt]='%';\r\n\twhile(c<'a'||c>'z')c=getchar();\r\n\twhile(c>='a'&&c<='z')s[++cnt]=c,s[++cnt]='%',c=getchar();\r\n\ts[cnt+1]='~';\r\n\tint j=0,mid=0;\r\n\tfor(int i=1;i<=cnt;i++)\r\n\t{\r\n\t\tif(i<=j)p[i]=min(p[2*mid-i],j-i+1);\r\n\t\twhile(s[i+p[i]]==s[i-p[i]])p[i]++;\r\n\t\tif(p[i]+i>j)j=p[i]+i-1,mid=i;\r\n\t\tif(s[i]!='%')\r\n\t\t{\r\n\t\t\tint xx=p[i]-1;\r\n\t\t\tt[xx]++;\r\n\t\t\tmaxn=max(maxn,p[i]-1);\r\n\t\t}\r\n\t}\r\n//\tfor(int i=1;i<=maxn;i++)\r\n//\t  cout<<t[i]<<\" \";\r\n//\tcout<<endl;\r\n\tint ans=1,sum=0;\r\n\tfor(int i=maxn;i>=1;i--)\r\n\t{\r\n\t\tif(sum+t[i]>k)\r\n\t\t{\r\n\t\t\tans=(ans*ksm(i,k-sum)%P);\r\n\t\t\tsum+=t[i];\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tsum+=t[i];\r\n\t\tt[i-2]+=t[i];\r\n\t\tans=(ans*ksm(i,t[i])%P);\r\n\t}\r\n\tif(sum<k)\r\n\t{\r\n\t\tcout<<\"-1\"<<endl;\r\n\t\treturn 0;\r\n\t}\r\n\tcout<<ans<<endl;\r\n\treturn 0;\r\n}\r\n```\r\n",
        "postTime": 1674888029,
        "uid": 526519,
        "name": "Aisaka_Taiga",
        "ccfLevel": 0,
        "title": "P1659 \u9898\u89e3"
    },
    {
        "content": "[$myblog$](https://www.cnblogs.com/Isaunoya/p/11646020.html)\n\n\u8fd9\u9898\u7684\u9898\u610f\u662f \u6c42\u51fa\u82e5\u5e72\u4e2a \u56de\u6587\u5b50\u4e32 \u6309\u957f\u5ea6\u6392\u5e8f\u4e4b\u540e\n\n\u7b97\u51fa $\\prod_{i=1}^{k} len_i$\n\n\u5f88\u663e\u7136\u6211\u4eec\u53ef\u4ee5\u7528manacher\u7b97\u6cd5 $O(n)$ \u6c42\u51fa\u6bcf\u4e2a\u56de\u6587\u5b50\u4e32\u7684\u6570\u91cf\u3002\u4f46\u662f\u53ea\u80fd\u6c42\u51fa\u6700\u957f\u7684\u2026\u90a3\u4e2a\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u56de\u6587\u7684\u5b57\u7b26\u4e32(len > 2) \u4efb\u610f\u5220\u6389\u4e24\u4e2a\u76f8\u540c\u7684\u5b57\u7b26 \u8fd8\u662f\u4e00\u4e2a\u56de\u6587\u4e32\n\n\u8bbe $cnt_i$ \u4e3a \u957f\u5ea6 \u4e3a i \u7684 \u56de\u6587\u5b50\u4e32\u7684\u4e2a\u6570\n\n\u90a3\u4e48 $cnt_i$ = $\\sum_{j=i}^{n}$ $cnt_j$[( $j$ - $i$ )%2==0]\n\n\u7136\u540e\u8003\u8651\u600e\u4e48\u4e58\u8d77\u6765\u3002\u4e00\u4e2a\u4e2a\u4e58\u663e\u7136\u5f88\u6162\uff0c\u6211\u4eec\u8ba1\u7b97\u51fa\u4e2a\u6570 \u5c31\u53ef\u4ee5\u7528 \u5feb\u901f\u5e42 \u76f4\u63a5\u8ba1\u7b97\u8fd9\u4e2a\u4e86\n\n\u7b54\u6848\u5c31\u662f \u5012\u5e8f\u679a\u4e3e \u7136\u540e\u5feb\u901f\u5e42\u5c31\u53ef\u4ee5\u4e86\u3002\n\ncode\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std ;\n#define int long long\n#define fi first\n#define se second\n#define pb emplace_back\ninline int read() {\n\tregister int x = 0 , f = 1 ;\n\tregister char c = getchar() ;\n\tfor( ; ! isdigit(c) ; c = getchar()) if(c == '-') f = -1 ;\n\tfor( ; isdigit(c) ; c = getchar()) x = (x << 1) + (x << 3) + (c & 15) ;\n\treturn x * f ;\n}\nconst int Mod = 19930726 ;\ntemplate < typename T > inline bool cmax(T & x , T y) {\n\treturn x < y ? (x = y) , 1 : 0 ;\n}\ntemplate < typename T > inline bool cmin(T & x , T y) {\n\treturn x > y ? (x = y) , 1 : 0 ;\n}\ntemplate < typename T > inline bool cabs(T & x) {\n\treturn x > 0 ? 1 : (x = - x) , 0 ;\n}\ninline int QP(int x , int y , int Mod) {\n\tint ans = 1 ;\n\tfor( ; y ; y >>= 1 , x = (x * x) % Mod)\n\t\tif(y & 1) ans = (ans * x) % Mod ;\n\treturn ans ;\n}\nint n , m ;\nconst int N = 11000000 + 5 ;\nchar s[N] ;\nchar fix[N << 2] ;\nint p[N] , ccnt[N] ;\ninline void Manacher() {\n  scanf(\"%s\" , s + 1) ;\n  int cnt = 0 ;\n  fix[++ cnt] = '~' ;\n  fix[++ cnt] = '%' ;\n  for(register int i = 1 ; i <= n ; i ++)\n  fix[++ cnt] = s[i] , fix[++ cnt] = '%' ;\n  int l = 0 , r = 0 , mid = 0 ;\n  for(register signed i = 1 ; i <= cnt ; i ++) {\n    if(i <= r) p[i] = min(p[(mid << 1) - i] , r - i + 1) ;\n    while(fix[i - p[i]] == fix[i + p[i]]) ++ p[i] ;\n    if(p[i] + i > r) r = p[i] + i - 1 , mid = i ;\n    ccnt[p[i] - 1] ++ ;\n  }\n  return ;\n}\nsigned main() {\n  n = read() ; m = read() ;\n  Manacher() ;\n  for(register int i = n ; i >= 1 ; i --)\n    ccnt[i] += ccnt[i + 2] ;\n  int ans = 1 ;\n  for(register int i = n ; i >= 1 ; i --) {\n    if(! ( i & 1 )) continue ;\n    if(ccnt[i] <= m) { m -= ccnt[i] ; ans = (ans * QP(i , ccnt[i] , Mod)) % Mod ; }\n    else { ans = (ans * QP(i , m , Mod)) % Mod , m = 0 ; break ; }\n  } printf(\"%lld\\n\" , ans ) ;\n\treturn 0 ;\n}\n```",
        "postTime": 1570672855,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "\u6ca1\u60f3\u5230\u56fd\u5bb6\u96c6\u8bad\u961f\u4e5f\u6709\u6c34\u9898\u5417\uff0c\u521d\u770b\u4ee5\u4e3a\u633a\u96be\u7684\uff0c\u7136\u540e\u53d1\u73b0\u4e00\u904d\u9a6c\u62c9\u8f66\u52a0\u4e00\u4e2a\u540e\u7f00\u548c\u5c31\u6ca1\u4e86\uff0c\u540e\u7f00\u548c\u5c31\u662f\u4f60\u628a\u540e\u9762\u51fa\u73b0\u7684\u957f\u5ea6\u7d2f\u52a0\u5230\u524d\u9762\u53bb\uff0c\u5c31\u76f8\u5f53\u4e8e\u7ed9\u524d\u9762\u7684\u5947\u6570\u4e32\u505a\u4e86\u8d21\u732e\uff0c\u7136\u540e\u8dd1\u5feb\u901f\u5e42\u5c31\u6ca1\u4e86\uff0c\u7136\u540e\u4e3a\u4ec0\u4e48\u5f00\u52301e6\u4f1aRE\u6700\u540e3\u4e2a\u70b9\u554a\uff0c\u8bb2\u9053\u7406\u56de\u6587\u4e32\u7684\u957f\u5ea6\u4e0d\u4e5f\u5e94\u8be5\u57281e6\u5417\uff0c\u9677\u5165\u6df1\u601d\uff0c\u5f00\u52302e6\u624d\u8fc7\u7684\u3002\n\n```cpp\n//author Eterna\n#define Hello the_cruel_world!\n#pragma GCC optimize(2)\n#include<iostream>\n#include<algorithm>\n#include<cstdio>\n#include<string>\n#include<cstring>\n#include<vector>\n#include<map>\n#include<set>\n#include<queue>\n#include<stack>\n#include<utility>\n#include<cmath>\n#include<climits>\n#include<deque>\n#include<functional>\n#include<numeric>\n#define ABS(x) ((x) >= 0 ? (x) : (-(x)))\n#define pb(x) push_back(x)\n#define lowbit(x) ((x) & (-(x)))\n#define FRIN freopen(\"C:\\\\Users\\\\Administrator.MACHENI-KA32LTP\\\\Desktop\\\\in.txt\", \"r\", stdin)\n#define FROUT freopen(\"C:\\\\Users\\\\Administrator.MACHENI-KA32LTP\\\\Desktop\\\\out.txt\", \"w\", stdout)\n#define FAST ios::sync_with_stdio(false); cin.tie(0); cout.tie(0);\n#define outd(x) printf(\"%d\\n\", x)\n#define outld(x) printf(\"%lld\\n\", x)\n#define memset0(arr) memset(arr, 0, sizeof(arr))\n#define il inline\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int, int> pii;\nconst int maxn = 2e6;\nconst int INF = 0x7fffffff;\nconst int mod = 19930726;\nconst double eps = 1e-7;\nconst double Pi = acos(-1.0);\ninline int read_int() {\n\tchar c;\n\tint ret = 0, sgn = 1;\n\tdo { c = getchar(); } while ((c < '0' || c > '9') && c != '-');\n\tif (c == '-') sgn = -1; else ret = c - '0';\n\twhile ((c = getchar()) >= '0' && c <= '9') ret = ret * 10 + (c - '0');\n\treturn sgn * ret;\n}\ninline ll read_ll() {\n\tchar c;\n\tll ret = 0, sgn = 1;\n\tdo { c = getchar(); } while ((c < '0' || c > '9') && c != '-');\n\tif (c == '-') sgn = -1; else ret = c - '0';\n\twhile ((c = getchar()) >= '0' && c <= '9') ret = ret * 10 + (c - '0');\n\treturn sgn * ret;\n}\nchar p[maxn + 5], s[2 * maxn + 5];\nint len[2 * maxn + 5];\nvector<int> v;\nint n, m;\nll res = 1, k, sum[maxn + 5];\nvoid manacher() {\n\ts[0] = '@';\n\tfor (int i = 1; i <= 2 * m; i += 2)s[i] = '#', s[i + 1] = p[i / 2];\n\ts[2 * m + 1] = '#';\n\tn = 2 * m + 1;\n\tint max_len = 0, id = 0;\n\tfor (int i = 1; i <= n; ++i) {\n\t\tif (max_len > i)len[i] = min(max_len - i, len[2 * id - i]);\n\t\telse len[i] = 1;\n\t\twhile (s[i + len[i]] == s[i - len[i]])++len[i];\n\t\tif (i + len[i] > max_len)max_len = i + len[i], id = i;\n\t}\n}\nil ll quick_pow(ll base, ll index) {\n\tll res = 1;\n\twhile (index) {\n\t\tif (index & 1)res = base * res % mod;\n\t\tbase = base * base % mod;\n\t\tindex >>= 1;\n\t}\n\treturn res;\n}\nint main()\n{\n\tm = read_int(), k = read_ll();\n\tscanf(\"%s\", p);\n\tmanacher();\n\tfor (int i = 1; i <= n; ++i)if (s[i] != '#')v.push_back(len[i] - 1);\n\tsort(v.begin(), v.end());\n\tfor (int i = 0; i < v.size(); ++i)sum[v[i]]++;\n\tfor (int i = n - 1; i > 0; --i)sum[i] += sum[i + 1];\n\tfor (int i = n; i > 0; --i) {\n\t\tif (i & 1) {\n\t\t\tll p = min(sum[i], k);\n\t\t\tres = res * quick_pow(i, p) % mod;\n\t\t\tk -= p;\n\t\t}\n\t\tif (k == 0)break;\n\t}\n\tif (k == 0)outld(res);\n\telse outd(-1);\n\t//system(\"pause\");\n\treturn 0;\n}\n```\n",
        "postTime": 1555552689,
        "uid": 106178,
        "name": "Forsaken2020",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "$Manacher+\\text{\u9012\u63a8}+\\text{\u5feb\u901f\u5e42}$  \n\n\n\u7b2c\u4e00\u6b65\uff0c\u5229\u7528$Manacher$\u7b97\u6cd5\u6c42\u51fa$p_i$\uff0c\u5373\u4ee5$i$\u4e3a\u4e2d\u5fc3\u7684\u6700\u957f\u56de\u6587\u5b50\u4e32\u7684\u534a\u5f84\u957f\u5ea6  \n\n\u7b2c\u4e8c\u6b65\uff0c\u5c06\u534a\u5f84\u957f\u5ea6\u8f6c\u5316\u4e3a\u5b9e\u9645\u957f\u5ea6\uff0c\u5373$p_i=2*p_i-1$\n\n\u7b2c\u4e09\u6b65\uff0c\u626b\u63cf\u4e00\u904d$p$\u6570\u7ec4\uff0c\u5f97\u51fa$f$\u6570\u7ec4\uff0c$f_i$\u8868\u793a\u5728$p$\u6570\u7ec4\u4e2d$i$\u51fa\u73b0\u7684\u6b21\u6570  \n\n\u7b2c\u56db\u6b65\uff0c\u9012\u63a8\uff0c\u4ece$n$\u5230$1$\u8fdb\u884c\u5012\u63a8\uff0c\u5f97\u51fa$t$\u6570\u7ec4\uff0c$t_i$\u8868\u793a\u5728\u6574\u4e2a\u4e32\u4e2d\u957f\u5ea6\u4e3a$i$\u7684\u56de\u6587\u5b50\u4e32\u7684\u6570\u91cf\uff0c$t_i=f_i+f_{i+2}+...+f_{n\\ or\\ n-1}$\uff0c**\u518d\u6b21\u5f3a\u8c03\u8981\u5012\u7740\u63a8\uff0c\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u5c06\u5f0f\u5b50\u4f18\u5316\u4e3a$t_i=f_i+t_{i+2}$**  \n\n\u7b2c\u4e94\u6b65\uff0c\u5728$t$\u6570\u7ec4\u4e2d\u4ece\u5927\u5230\u5c0f\u6309\u7167\u9898\u610f\u7edf\u8ba1\u7b54\u6848\uff0c\u4e0d\u80fd\u4e00\u4e2a\u4e2a\u4e58\uff0c\u8981\u4f7f\u7528\u5feb\u901f\u5e42\u4f18\u5316  \n\n\u7b2c\u516d\u6b65\uff0c\u4e0a\u4ee3\u7801  \n\n```cpp\n#include<bits/stdc++.h>\n#define mod 19930726\ntypedef long long ll;\nusing namespace std;\nint n;ll k;char a[1000005];\nint mx=0,mid=0,ml[1000005];\nll f[1000005],ans=1;\nint Pow(int x,ll y){\n\tll sum=1,t=x;\n\twhile(y){\n\t\tif(y&1)sum*=t,sum%=mod;\n\t\tt=t*t%mod;y>>=1;\n\t}\n\treturn sum;\n}\nint main()\n{\n\tscanf(\"%d%lld\",&n,&k);\n\tscanf(\"%s\",a+1);a[0]='#';\n\tfor(int i=1;i<=n;i++){\n\t\tif(i>mx){\n\t\t\tmid=i;int p=1;\n\t\t\twhile(a[i+p]==a[i-p])p++;\n\t\t\tmx=i+p-1;ml[i]=p;\n\t\t\tcontinue;\n\t\t}\n\t\tint l=mid-(i-mid),s=mid-(mx-mid);\n\t\tint to=l-ml[l]+1;\n\t\tif(to<s)ml[i]=mx-i+1;\n\t\telse if(to>s)ml[i]=ml[l];\n\t\telse{\n\t\t\tmid=i;\n\t\t\tint p=ml[l];\n\t\t\twhile(a[i+p]==a[i-p])p++;\n\t\t\tmx=i+p-1;ml[i]=p;\n\t\t}\n\t}\n\tmemset(f,0,sizeof(f));\n\tfor(int i=1;i<=n;i++)\n\t\tf[ml[i]*2-1]++;\n\tfor(int i=n;i>=1;i--)\n\t    f[i]+=f[i+2];\n\tint st=(n&1?n:n-1);\n\twhile(k&&st>0){\n\t\tif(f[st]>=k){\n\t\t\tans*=Pow(st,k);\n\t\t\tk=0;ans%=mod;\n\t\t}\n\t\telse{\n\t\t\tans*=Pow(st,f[st]);\n\t\t\tans%=mod;k-=f[st];\n\t\t}\n\t\tst-=2;\n\t}\n\tprintf(\"%d\\n\",k?-1:ans);\n\treturn 0;\n}\n```",
        "postTime": 1554020750,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u5f88\u663e\u7136\u662f\u4e00\u9053 manacher .\n\n\u505a\u6cd5\u5176\u4ed6\u5927\u4f6c\u90fd\u5df2\u7ecf\u89e3\u91ca\u7684\u5f88\u6e05\u695a\u4e86\u3002\u5927\u6982\u5c31\u662f\u5148\u8dd1\u6b63\u5e38\u4e00\u904d manacher ,\u7136\u540e\u5f00\u4e00\u4e2a\u6876 $cnt_i$ \u8bb0\u5f55 \u957f\u5ea6\u4e3a $i$ \uff08 $i$ \u4e3a\u5947\u6570\uff09\u7684\u6700\u957f\u56de\u6587\u4e32\u7684\u4e2d\u5fc3\u70b9\u7684\u6570\u91cf\u3002\u6700\u540e\u5012\u5e8f\u904d\u5386\u6876\uff0c\u7528\u5feb\u901f\u5e42\u7b97\u3002\n\n\u5148\u653e\u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define mod 19930726\nusing namespace std;\nlong long n,k,len,ans=1;\nint p[3000005],cnt[1000005];\nchar s[3000005],S[3000005];\ninline long long read()\n{\n\tlong long x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=x*10+c-'0';c=getchar();}\n\treturn x*f;\n}\ninline long long f(long long x,long long y)\n{\n\tif(!y)\treturn 1;\n\tif(x==1)\treturn 1;\n\tlong long base=1,p=x;\n\twhile(y)\n\t{\n\t\tif(y&1)\tbase=(base*p)%mod;\n\t\tp=(p*p)%mod;\n\t\ty>>=1;\n\t}\n\treturn base;\n}\ninline void change()\n{\n\tS[0]='#',S[1]='#';\n\tfor(int i=0;i<len;i++)\n\t\tS[(i<<1)+2]=s[i],S[(i<<1)+3]='#';\n\tlen=(len<<1)+2;\n\tS[len]=0;\n}\ninline void manacher()\n{\n\tint mx=0,mid;\n\tfor(int i=1;i<len;i++)\n\t{\n\t\tif(i>mx)\tp[i]=1;\n\t\telse\tp[i]=min(mx-i,p[(mid<<1)-i]);\n\t\twhile(S[i-p[i]]==S[i+p[i]])\tp[i]++;\n\t\tif(i+p[i]>mx)\tmx=i+p[i],mid=i;\n\t\tif((p[i]-1)&1)\tcnt[p[i]-1]++;\n\t}\n}\nint main()\n{\n\tn=read(),k=read();\n\tlen=n;\n\tcin>>s;\n\tchange();\n\tmanacher();\n\tint sum=0;\n\tfor(int i=n;i>=1;i--)\n\t{\n\t\tif(!(i&1))\tcontinue;\n\t\tsum+=cnt[i];\n\t\tif(sum>k)\n\t\t{\n\t\t\tans=(ans*f(i,k))%mod;\n\t\t\tk-=sum;\n\t\t\tbreak;\n\t\t}\n\t\tif(k>=sum)\n\t\t{\n\t\t\tans=(ans*f(i,sum))%mod;\n\t\t\tk-=sum;\n\t\t}\n\t}\n\tif(k>0)\tputs(\"-1\");\n\telse\n\t\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n\n```\n\n\n\u5bf9\u6211\u6765\u8bf4\uff0c\u53ef\u80fd\u5c31\u6709\u4e00\u70b9\u7a0d\u5fae\u96be\u4ee5\u7406\u89e3\u3002\u5c31\u662f\u4e3a\u4ec0\u4e48\u7b2c 67 \u884c\u662f `ans=(ans*f(i,sum))%mod;` \u56e0\u4e3a $sum$ \u8868\u793a\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e $i$ \u7684\u6700\u957f\u56de\u6587\u4e32\u7684\u4e2a\u6570\u3002\u800c\u6bcf\u4e2a\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e $i$ \u7684\u56de\u6587\u4e32\uff0c\u90fd\u4e00\u5b9a\u4f1a\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a $i$ \u7684\u56de\u6587\u4e32\u3002\n\nThat's all,thanks.\n\n\u5e0c\u671b\u4f60\u53ef\u4ee5\u65e9\u65e5\u638c\u63e1 manacher !",
        "postTime": 1607612224,
        "uid": 181775,
        "name": "_Fontainebleau_",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "\u4e00\u773c\u53ef\u5f97PAM\n\n\u5982\u679c\u6ca1\u5b66\u8fc7**PAM**\u7684\u53ef\u4ee5\u770b\u8fd9\u91cc\uff1a[PAM\u5b66\u4e60\u5c0f\u7ed3](https://www.cnblogs.com/hyfhaha/p/13654308.html) \n\n\u6211\u4eec\u4ee4**PAM**\u4e0a\u591a\u8bb0\u5f55\u4e00\u4e2a\u4fe1\u606f$sum$\uff0c\u8868\u793a\u8be5\u8282\u70b9\u8868\u793a\u4e32\u5728\u539f\u4e32\u4e0a\u51fa\u73b0\u4e86\u591a\u5c11\u6b21\u3002\n\n\u5f53\u6211\u4eec\u5904\u7406\u5b8c\u4e86$sum$\uff0c\u5bf9\u4e8e\u957f\u5ea6$len$\u4e3a\u5947\u6570\u7684\u8282\u70b9\u7684\u4fe1\u606f$sum$\u8ba1\u5165\u6570\u7ec4$a[i]$.\n\n$a[i]$\u4e3a\u957f\u5ea6\u4e3a$i$\u7684\u56de\u6587\u5b50\u4e32\u51fa\u73b0\u6b21\u6570\u3002\n\n$a[i]$\u964d\u5e8f\u6392\u5e8f\u540e\u7d2f\u52a0\u7b54\u6848\u5feb\u901f\u5e42\u5904\u7406\u4e00\u4e0b\u5373\u53ef\uff0c\u4e0d\u9700\u592a\u591a\u70b9\u62e8\n\n\u91cd\u70b9\u6765\u4e86\n\n\u8bb2\u4e00\u4e0b\u600e\u4e48\u5904\u7406$sum$ \n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u5f53\u4e00\u4e2a\u8282\u70b9$u$\u7684$sum+1$\uff0c\u90a3\u4e48$fail[u]$\u7684$sum$\u4e5f\u8981$+1$ \n\n\u719f\u6089**AC\u81ea\u52a8\u673a**\u7684OIer\u53ef\u4ee5\u654f\u9510\u7684\u5bdf\u89c9\u5230\u53ef\u4ee5\u7528\u62d3\u6251\u6392\u5e8f\u4e86\uff08\u4f8b\u5982\u6211\n\n\u5efa**PAM**\u7684\u65f6\u5019\u6253\u4e2a\u6807\u8bb0\uff0c\u6700\u540e\u7edf\u4e00\u4e00\u4e2a\u62d3\u6251\u6392\u5e8f\u5411$fail$\u53bb\u66f4\u65b0$sum$\u5373\u53ef\n\n```cpp\nqueue<int >q;\t\t//in\u6570\u7ec4\u4e3afail\u5165\u8fb9\u6570\u91cf\nvoid tuopu(){\n\tfor(int i=0;i<=tot;i++)if(in[i]==0)q.push(i);\n\twhile(!q.empty()){\n\t\tint u=q.front();q.pop();\n\t\tsum[fail[u]]+=sum[u];in[fail[u]]--;\n\t\tif(in[fail[u]]==0)q.push(fail[u]);\n\t}\n}\n```\n\n\u597d\u50cf\u6ca1\u4ec0\u4e48\u95ee\u9898\uff0c\u591a\u4e00\u4e2a\u62d3\u6251\u6392\u5e8f\u5c31\u884c\u4e86\n\n\u4f46\u771f\u7684\u5982\u6b64\u5417\uff1f\n\n\u6211\u4eec\u89c2\u5bdf**PAM**\u548c**AC\u81ea\u52a8\u673a**\u7684\u533a\u522b\n\n**AC\u81ea\u52a8\u673a**\u662f\u5efa\u597d$Trie$\u540e\u518d\u8fdb\u884c$getFail$\u7684\uff0c$fail$\u7684\u8282\u70b9\u7f16\u53f7\u662f\u4f1a\u5927\u4e8e\u81ea\u8eab\u8282\u70b9\u7f16\u53f7\n\n\u800c**PAM**\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u79cd\u60c5\u51b5\uff0c**PAM**$fail$\u5b9a\u4e49\u4e0d\u540c\u4e8e**AC\u81ea\u52a8\u673a**\uff0c\u6784\u5efa\u4f7f\u7528\u589e\u91cf\u6cd5\uff0c\u4fdd\u8bc1\u4e86$fail$\u7684\u8282\u70b9\u7f16\u53f7\u4e00\u5b9a\u5c0f\u4e8e\u81ea\u8eab\u8282\u70b9\u7f16\u53f7\u3002\n\n\u6240\u4ee5\u5c31\u53ef\u4ee5\u4e0d\u7528\u62d3\u6251\u6392\u5e8f\u4e86\uff0c\u76f4\u63a5\u4e00\u4e2a$for$\u4ece\u540e\u5230\u524d\u66f4\u65b0\u5373\u53ef\n\n```cpp\nfor(int i=tot;i>=0;i--)sum[fail[i]]+=sum[i];\n```\n\n\u603b\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define maxn 1010001\n#define ll long long\n#define mod 19930726\nusing namespace std;\nchar s[maxn];\nint fail[maxn],len[maxn],trie[maxn][26],trans[maxn];\nlong long sum[maxn];\nint per,slen,tot;\nlong long a[maxn],K,ans=1;\nint getfail(int x,int i){\n\twhile(i-len[x]-1<0||s[i-len[x]-1]!=s[i])x=fail[x];\n\treturn x;\n}\nint gettrans(int x,int i){\n\twhile(((len[x]+2)<<1)>len[tot]||s[i-len[x]-1]!=s[i])x=fail[x];\n\treturn x;\n}\nvoid insert(int u,int i){\n\tint Fail=getfail(per,i);\n\tif(!trie[Fail][u]){\n\t\tlen[++tot]=len[Fail]+2;\n\t\tfail[tot]=trie[getfail(fail[Fail],i)][u];\n\t\ttrie[Fail][u]=tot;\n\t\tif(len[tot]<=2)trans[tot]=fail[tot];\n\t\telse{\n\t\t\tint Trans=gettrans(trans[Fail],i);\n\t\t\ttrans[tot]=trie[Trans][u];\n\t\t}\n\t}\n\tper=trie[Fail][u];\n\tsum[per]++;\t\t//\u8bb0\u5f55sum\n}\nll qpow(ll n,ll m){\n\tll ans=1ll;\n\twhile(m){\n\t\tif(m&1){ans=ans*n;ans%=mod;}\n\t\tn=n*n;n%=mod;m>>=1;\n\t}return ans%mod;\n}\nint main(){\n\tscanf(\"%d%lld\",&slen,&K);\n\tscanf(\"%s\",s);\n\tfail[0]=1;len[1]=-1;tot=1;\n\tfor(int i=0;i<slen;i++)insert(s[i]-'a',i);\n\tfor(int i=tot;i>=1;i--)sum[fail[i]]+=sum[i];\t\t//\u66f4\u65b0sum\n\tfor(int i=2;i<=tot;i++)a[len[i]]+=sum[i],a[len[i]]%=mod;\t//\u957f\u5ea6\u5904\u7406\n\tfor(int i=slen;i>=1;i--){\t\t\t//\u7b54\u6848\u5904\u7406\n\t\tif(i%2==1){\n\t\t\tif(K>=a[i]){\n\t\t\t\tans*=qpow(i,a[i]);ans%=mod;\n\t\t\t\tK-=a[i];\n\t\t\t}else{\n\t\t\t\tans*=qpow(i,K);ans%=mod;\n\t\t\t\tK-=K;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tif(K==0)\t\t\t//\u5224-1\n\tprintf(\"%lld\\n\",ans%mod);\n\telse\n\tprintf(\"-1\\n\");\n\treturn 0;\n}\n```\n\n",
        "postTime": 1600428504,
        "uid": 58711,
        "name": "hyfhaha",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P1659 \u3010[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3\u3011"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/P1659)\u770b\u9898\u76ee\u3002  \n# \u5206\u6790\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u867d\u7136\u6807\u7b7e\u91cc\u9762\u5199\u7684\u662f$Manacher$\u3002\u6211\u504f\u8981\u7528\u56de\u6587\u81ea\u52a8\u673a\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5148\u628a\u56de\u6587\u81ea\u52a8\u673a\u5efa\u8d77\u6765\u3002\u5bf9\u4e8e\u4e00\u4e2a\u8282\u70b9$u$\uff0c\u7b97\u51fa\u5b83\u5728\u539f\u4e32\u4e2d\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u8bb0\u4e3a$ed(u)$\u3002\u7136\u540e\u8003\u8651\u7528\u4e00\u4e2a$cnt(i)$\u8868\u793a\u957f\u5ea6\u4e3a$i$\u7684\u56de\u6587\u4e32\u7684\u51fa\u73b0**\u4e2a\u6570**\u3002\u4e0d\u96be\u53d1\u73b0\u5982\u4e0b\u7684\u4e1c\u897f\uff1a  \n$$cnt(i)=\\sum_{u}ed(u)[len(u)=i]$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u7136\u540e\u4ece\u5927\u5230\u5c0f\u679a\u4e3e\u957f\u5ea6\uff0c\u50cf\u5e73\u8861\u6811\u4e00\u6837\uff0c\u6784\u9020\u51fa\u524d$K$\u4e2a\u4e32\u7684\u957f\u5ea6\u7684\u79ef\u3002\u65f6\u95f4$O(n\\log_2n)$\uff08$\\log_2n$\u662f\u4ece\u5feb\u901f\u5e42\u91cc\u9762\u6765\u7684\uff09\u3002  \n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <cstring>\n\ntypedef long long LL;\n\nconst int mod = 19930726;\nconst int MAXN = 1000005;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0; char s = getchar();int f = 1;\n\twhile( s < '0' || '9' < s ) { f = 1; if( s == '-' ) f = -1; s = getchar(); }\n\twhile( '0' <= s && s <= '9' ) { x = ( x << 3 ) + ( x << 1 ) + s - '0', s = getchar(); }\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ) { putchar( '-' ), x = -x; }\n\tif( 9 < x ) { write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\nLL cnt[MAXN];\nint dep[MAXN], appcnt[MAXN];\nint ch[MAXN][26], fa[MAXN], len[MAXN];\nchar S[MAXN];\nLL K;\nint N, lst, siz;\n\nvoid build()\n{\n\tint p, x, cur;\n\tN = strlen( S + 1 );\n\tfa[0] = ++ siz, len[1] = -1;\n\tfor( int i = 1 ; i <= N ; i ++ )\n\t{\n\t\tx = S[i] - 'a';\n\t\twhile( S[i] ^ S[i - len[lst] - 1] ) lst = fa[lst];\n\t\tif( ! ch[lst][x] )\n\t\t{\n\t\t\tcur = ++ siz, p = fa[lst]; len[cur] = len[lst] + 2, dep[cur] = dep[lst] + 1;\n\t\t\twhile( S[i] ^ S[i - len[p] - 1] ) p = fa[p];\n\t\t\tfa[cur] = ch[p][x], ch[lst][x] = cur;\n\t\t}\n\t\tlst = ch[lst][x], appcnt[lst] ++;\n\t}\n}\n\nint qkpow( int base, int indx )\n{\n\tint res = 1;\n\twhile( indx )\n\t{\n\t\tif( indx & 1 ) res = 1ll * res * base % mod;\n\t\tbase = 1ll * base * base % mod, indx >>= 1;\n\t}\n\treturn res;\n}\n\nint main()\n{\n\tread( N ), read( K );\n\tscanf( \"%s\", S + 1 ); \n\tbuild();\n\tfor( int i = siz ; i > 1 ; i -- ) \n\t\tif( fa[i] > 1 ) appcnt[fa[i]] += appcnt[i];\n\tfor( int i = 2 ; i <= siz ; i ++ ) \n\t\tif( len[i] & 1 ) cnt[len[i]] += appcnt[i];\n\tint res = 1;\n\tfor( int i = N ; i ; i -- )\n\t\tif( i & 1 )\n\t\t{\n\t\t\tif( K > cnt[i] ) K -= cnt[i], res = 1ll * res * qkpow( i, cnt[i] ) % mod;\n\t\t\telse { res = 1ll * res * qkpow( i, K ) % mod, K = 0; break; }\n\t\t}\n\tif( K > 0 ) res = -1;\n\twrite( res ), putchar( '\\n' );\n\treturn 0;\n}\n```",
        "postTime": 1575439243,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[\u56fd\u5bb6\u96c6\u8bad\u961f]\u62c9\u62c9\u961f\u6392\u7ec3"
    }
]