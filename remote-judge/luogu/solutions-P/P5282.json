[
    {
        "content": "> \u8fd9\u7bc7\u9898\u89e3\u7b97\u662fzzq\u7684blog\u7684\u8be6\u7ec6\u89e3\u91ca\u7248\u5427\n\n>\u5982\u679c\u770b\u5230\u8fd9\u7bc7\u9898\u89e3\uff0c\u8bf7\u5927\u558a\u4e09\u58f0\"Min_25 \u725b\u903c!\"\n\n___________________________\n\n## \u524d\u7f6e\u829d\u58eb:\u4efb\u610f\u6a21\u6570fft\n\n\u786e\u4fdd\u4f60\u5199\u7684\u4e0d\u662f\u4e09\u6a21ntt\u548c\u672a\u7ecf\u8fc7\u4f18\u5316\u7684\u62c6\u7cfb\u6570fft\u8fd9\u79cd\u505a\u4e00\u6b21\u591a\u9879\u5f0f\u4e58\u6cd5\u9700\u89819\u6b21\u6216\u80057\u6b21fft\u7684\u4e22\u4eba\u4e1c\u897f\n\n~~9120\u5e74\u4e86\uff0c\u4e09\u6b21\u53d8\u4e24\u6b21\u4f18\u5316\u65e9\u5e94\u8be5\u666e\u53ca\u4e86~~\n\n## \u524d\u7f6e\u829d\u58eb:\u62c9\u683c\u6717\u65e5\u63d2\u503c\u516c\u5f0f\n\n\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u4e0d\u8d85\u8fc7$n$\u6b21\u7684\u591a\u9879\u5f0f$f$\u5e76\u4e14\u6211\u4eec\u77e5\u9053\u4e86\u8fd9\u4e2a\u591a\u9879\u5f0f\u7684m\u4e2a\u70b9\u503c\u5bf9$(x_{i},f(x_{i}))$\uff0c\u5e76\u4e14$m \\geq n+1$\u90a3\u4e48\u6211\u4eec\u6709\u5982\u4e0b\u516c\u5f0f\n\n$$f(x)=\\sum_{i=1}^{m}f(x_{i})\\prod_{j \\neq i} \\frac{x-x_{j}}{x_{i}-x_{j}}$$\n\n______________\n\n# \u672c\u9898\u9898\u89e3\n\n## $O(\\sqrt{n}log^2n)$\u7684\u89e3\u6cd5\n\n\u8ba9\u6211\u4eec\u6765\u770b\u770b\u8fd9\u9053\u9898\u8981\u6c42\u6211\u4eec\u505a\u4ec0\u4e48:\u8ba1\u7b97$n! \\mod P$\n\n\u90a3\u4e48\u4e00\u4e2a\u7b80\u5355\u7c97\u66b4\u7684\u601d\u8def\u662f\u5206\u5757,\u6211\u4eec\u5e0c\u671b\u8ba1\u7b97$1 \\dots n$\u7684\u4e58\u79ef\uff0c\u6211\u4eec\u5c06\u5e8f\u5217\u5206\u6210\u957f\u5ea6\u4e3a$B$\u7684\u82e5\u5e72\u4e2a\u5757\uff0c\u5982\u679c\u6211\u4eec\u80fd\u5feb\u901f\u6c42\u51fa\u6bcf\u4e2a\u5757\u7684\u79ef\uff0c\u6211\u4eec\u5c31\u80fd\u51d1\u51fan\u9636\u4e58\u6765\n\n\u90a3\u5177\u4f53\u6765\u8bb2\u6211\u6784\u9020\u8fd9\u6837\u7684\u4e00\u4e2a\u591a\u9879\u5f0f$f(x)$\n\n$$f(x)=\\prod_{i=1}^{B}(x+i)$$\n\n\u5982\u679c\u6211\u4eec\u80fd\u6c42\u51fa$f(0),f(B),f(2B) \\dots f(\\lfloor \\frac{n}{B} \\rfloor B)$\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u80fd\u5728$O(\\lfloor \\frac{n}{B}\\rfloor+B)$\u7684\u65f6\u95f4\u5185\u8ba1\u7b97\u51fa\u7b54\u6848\u4e86\n\n\u4f7f\u7528\u591a\u9879\u5f0f\u591a\u70b9\u6c42\u503c\u5c31\u53ef\u4ee5\u5728$O(\\sqrt{N}log^2n)$\u7684\u65f6\u95f4\u5185\u8ba1\u7b97\u51fa\u7b54\u6848\u6765\n\n## $O(\\sqrt{n}logn)$\u7684\u505a\u6cd5\n\n\u4e0a\u9762\u7684\u505a\u6cd5\u53ef\u4ee5\u901a\u8fc7\u7384\u5b66\u8c03\u6574\u5757\u957f\u6765\u4f18\u5316\u5e38\u6570\uff0c\u4f46\u662f\u4e00\u4e2alog\u505a\u6cd5\u53ea\u80fd\u6c42\u51fa$f(0),f(B) \\dots f(B^2)$\u7684\u503c\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u628a\u5757\u957f\u8bbe\u4e3a$\\sqrt{n}$\n\n\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51faf\u8fd9\u4e2a\u591a\u9879\u5f0f\u7684\u4e00\u4e9b\u70b9\u503c\u5c31\u53ef\u4ee5\u751f\u6210\u7b54\u6848\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u4e0d\u6c42\u51fa$f$\u7684\u7cfb\u6570\u8868\u8fbe\uff0c\u800c\u662f\u76f4\u63a5\u4f7f\u7528f\u7684\u70b9\u503c\u8fdb\u884c\u8fed\u4ee3\n\n\u4e3a\u4e86\u8ba9\u6211\u4eec\u80fd\u591f\u8f6c\u79fb\uff0c\u6211\u4eec\u5c06f\u7684\u5b9a\u4e49\u4ece\u4e00\u7ef4\u7684\u60c5\u51b5\u62d3\u5c55\u5230\u4e8c\u7ef4,\u6211\u4eec\u5b9a\u4e49\u8fd9\u6837\u4e00\u4e2a\u591a\u9879\u5f0f\u51fa\u6765\n\n$$f(d,x)=\\prod_{i=1}^{d}(x+i)$$\n\n\u90a3\u4e48\u6211\u4eec\u6700\u540e\u8981\u6c42\u7684\u662f$f(B,0),f(B,B) \\dots f(B,B^2)$\u8fd9\u4e9b\u70b9\u503c\n\n\u4e00\u4e2a\u663e\u800c\u6613\u89c1\u7684\u6027\u8d28\u662f,\u5df2\u77e5\u591a\u9879\u5f0ff\u7684$n+1$\u5bf9\u70b9\u503c$(x,f(x))$\u5c31\u53ef\u4ee5\u552f\u4e00\u786e\u5b9a\u8fd9\u4e2a\u591a\u9879\u5f0f\uff0c\u56e0\u6b64\u5982\u679c\u6211\u4eec\u6c42\u51fa\u4e86$f(d,0),f(d,B) \\dots f(d,dB)$\u6211\u4eec\u5c31\u53ef\u4ee5\u552f\u4e00\u7684\u786e\u5b9a\u591a\u9879\u5f0f$f(d,x)$\u4e86\n\n\u73b0\u5728\u6211\u4eec\u5c1d\u8bd5\u5728d\u8fd9\u4e00\u4f4d\u4e0a\u505a\u500d\u589e\n\n\u5177\u4f53\u6765\u8bb2\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u8fd9\u4e24\u4ef6\u4e8b\u60c5\n\n\u5df2\u77e5\n\n$$f(d,0),f(d,B) \\dots f(d,dB)$$\n\n\u6c42\u51fa\n\n$$f(2d,0),f(2d,B) \\dots f(2d,2dB)$$\n\n\u901a\u8fc7\u8fd9\u4e2a\u64cd\u4f5c\u6211\u4eec\u53ef\u4ee5\u628ad\u4e582\n\n\u5df2\u77e5\n\n$$f(d,0),f(d,B) \\dots f(d,dB)$$\n\n\u6c42\u51fa\n\n$$f(d+1,0),f(d+1,B) \\dots f(d+1,(d+1)B)$$\n\n\u901a\u8fc7\u8fd9\u4e2a\u64cd\u4f5c\u6211\u4eec\u53ef\u4ee5\u628a$d$\u52a0$1$\n\n\u7136\u540e\u6709\u4e86\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u4e4b\u540e\u4f7f\u7528\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u5feb\u901f\u5e42\u7684\u505a\u6cd5,\u6211\u4eec\u8fed\u4ee3log\u8f6e\u5c31\u53ef\u4ee5\u628a\u6c42\u51fa$f(B,0),f(B,B) \\dots f(B,B^2)$\u4e86\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u5982\u4f55\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u8fc7\u7a0b\n\n## \u5c06d\u4e582\n\n\u6211\u4eec\u77e5\u9053$f(2d,x)=f(d,x)f(d,dx)$\n\n\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u6765\n\n$$f(d,0),f(d,B) \\dots f(d,2dB)$$\n\n\u548c\n\n$$f(d,d),f(d,d+B) \\dots f(d,2dB+d)$$\n\n\u5c31\u80fd\u8ba1\u7b97\u51fa\u6211\u4eec\u60f3\u8981\u7684\u70b9\u503c\u5e8f\u5217\u7684\n\n\u90a3\u4e48\u6211\u4eec\u4e0d\u59a8\u6784\u9020\u4e00\u4e2a\u65b0\u7684\u591a\u9879\u5f0f$h(x)=f(d,Bx)$\n\n\u90a3\u4e48\u6211\u4eec\u9700\u8981\u89e3\u51b3\u8fd9\u6837\u4e00\u4e2a\u95ee\u9898\n\n\u5df2\u77e5\n\n$$h(0),h(1),h(2) \\dots h(d)$$\n\n\u5e0c\u671b\u6c42\u51fa\n\n$$h(d+1+0),h(d+1+1),h(d+1+1) \\dots h(d+d+1)$$\n\n\u6c42\u51fa\u4e0a\u9762\u7684\u4e1c\u897f\u4e4b\u540e\u6211\u4eec\u5c31\u5df2\u77e5\u4e86\n\n$$h(0),h(1),h(2)\\dots h(2d)$$\n\n\u53ea\u8981\u6c42\u51fa\n\n$$h(d/B+0),h(d/B+1),h(d/B+2) \\dots h(d/B+2d)$$\n\n\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u500d\u589e\u9700\u8981\u7684\u4e24\u4e2a\u5e8f\u5217\u6c42\u51fa\u6765\u4e86\n\n\u6240\u4ee5\u603b\u7ed3\u4e00\u4e0b\u5c31\u662f\u5df2\u77e5\n\n$$h(0),h(1) \\dots h(k)$$\n\n\u5e0c\u671b\u6c42\u89e3\n\n$$h(\\Delta+0),h(\\Delta+1) \\dots h(\\Delta+k)$$\n\n\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u5e0c\u671b\u4ece\u70b9\u503c\u8f6c\u79fb\u5230\u70b9\u503c\uff0c\u90a3\u4e48\u6211\u4eec\u5b66\u8fc7\u7684\u7b97\u6cd5\u91cc\u9762\u53ea\u6709\u62c9\u683c\u6717\u65e5\u63d2\u503c\u662f\u4e00\u4e2a\u5b8c\u5168\u4e0d\u6d89\u53ca\u591a\u9879\u5f0f\u7684\u7cfb\u6570\u8fd8\u80fd\u7b97\u591a\u9879\u5f0f\u7684\u70b9\u503c\u7684\u7b97\u6cd5\n\n\u56e0\u6b64\u6211\u4eec\u5c1d\u8bd5\u4f7f\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u7b97\u6cd5\n\n$$h(\\Delta+n)=\\sum_{i=0}^{k}h(i)\\prod_{j \\neq i}\\frac{\\Delta+n-j}{i-j}$$\n\n\u6211\u4eec\u5c06$\\prod$\u91cc\u7684\u5206\u5b50\u63d0\u51fa\u6765\u5c31\u662f\n\n$$h(\\Delta+n)=\\prod_{j=0}^{k}(\\Delta+n-j)(\\sum_{i=0}^{k}\\frac{h(i)}{\\Delta+n-i}\\prod_{j \\neq i}\\frac{1}{i-j})$$\n\n\u8fd9\u91cc\u8bf4\u660e\u4e00\u4e0b\u4e3a\u4ec0\u4e48$\\Delta+n-i$\u4e0d\u53ef\u80fd\u662f0\uff0c\u56e0\u4e3a$h(x)$\u672c\u8d28\u4e0a\u4ee3\u8868\u4e86\u4e00\u6bb5\u8fde\u7eed\u6570\u5b57\u7684\u4e58\u79ef\uff0c\u800c\u6839\u636e\u6211\u4eec\u7b97\u6cd5\u7684\u539f\u7406\uff0c$h(\\Delta+n)$\u548c$h(i)$\u4e00\u5b9a\u4ee3\u8868\u4e86\u4e24\u6bb5\u4e0d\u540c\u7684\u6570\u5b57\uff0c\u6240\u4ee5\u5206\u6bcd\u4e0d\u53ef\u80fd\u4e3a0\n\n\u7136\u540e\u8003\u8651$\\prod_{j \\neq }\\frac{1}{i-j}$\u624b\u73a9\u4e00\u4e0b\u4f1a\u53d1\u73b0\u4ed6\u662f\u4e24\u6bb5\u9636\u4e58\u4e58\u8d77\u6765\u7684,\u6240\u4ee5\u5f0f\u5b50\u53ef\u4ee5\u5316\u6210\u8fd9\u6837\n\n$$h(\\Delta+n)=\\prod_{j=0}^{k}(\\Delta+n-j)(\\sum_{i=0}^{k}\\frac{1}{\\Delta+n-i}\u00d7\\frac{h(i)}{i!(k-i)!(-1)^{k-i}})$$\n\n\u5982\u679c\u6211\u4eec\u8bbe\u4e00\u4e9b\u8fd9\u6837\u7684\u51fd\u6570\u51fa\u6765\n\n$$h'(n)=\\frac{h(\\Delta-k+n)}{\\prod_{j=0}^{k}(\\Delta+n-j)}$$\n\n$$f(n)=\\frac{h(n)}{n!(k-n)!(-1)^{k-n}}$$\n\n$$g(n)=\\frac{1}{\\Delta-k+n}$$\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u7684\u5f0f\u5b50\n\n$$h'(n)=\\sum_{i+j=k,i\\geq 0,j\\geq 0}f(i)g(j)$$\n\n\u8fd9\u4e1c\u897f\u5f53\u7136\u662f\u4e2a\u6807\u51c6\u5377\u79ef\u5f0f\u5b50,\u628a$f$\u548c$g$\u6c42\u51fa\u6765\u5377\u4e00\u5377\u5c31\u884c\u4e86\n\n\u77e5\u9053\u4e86$h'(n+k)$\u4e4b\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u63a8\u51fa$h(n)$\u6765\u4e86,\u53d1\u73b0$h'(n+k)$\u548c$h(n)$\u7684\u6bd4\u503c\u662f\u4e00\u6bb5\u533a\u95f4\u5f53\u4e2d\u6570\u5b57\u7684\u4e58\u79ef\uff0c\u8fd9\u4e2a\u7cfb\u6570\u5728\u53ef\u4ee5$two-pointer$\u626b\u4e00\u904d\u5728$O(k+logP)$\u7684\u65f6\u95f4\u5185\u6c42\u51fa\n\n(\u8fd9\u91cc\u76f4\u63a5\u6c42\u9006\u5143\u662f$O(klogP)$\u7684\uff0c\u4f46\u662f\u7684\u786e\u5b58\u5728$O(k+logP)$\u7684\u7b97\u6cd5)\n\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u6210\u529f\u7684\u6c42\u51fa\u500d\u589e\u9700\u8981\u7684\u4e24\u4e2a\u6570\u7ec4\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u5b9e\u73b0\u628a$d$\u4e582\u7684\u64cd\u4f5c\u4e86\n\n\u8fed\u4ee3\u4e00\u6b21\u662f$O(nlogn)$\u7684\n\n## \u5c06d\u52a01\n\n\u73b0\u5728\u5df2\u77e5\n\n$$f(d,0),f(d,B) \\dots f(d,dB)$$\n\n\u5e0c\u671b\u6c42\u51fa\n\n$$f(d+1,0),f(d+1,B) \\dots f(d+1,(d+1)B)$$\n\n\u663e\u7136$f(d+1,(d+1)B)$\u66b4\u529b\u8ba1\u7b97\u5c31\u884c\u4e86\n\n\u5bf9\u4e8e\u5269\u4e0b\u7684\u9879\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u8fd9\u4e2a\u5f0f\u5b50\u8ba1\u7b97\n\n$$f(d+1,x)=f(d,x)(x+d+1)$$\n\n\u663e\u7136\u8fed\u4ee3\u4e00\u6b21\u662f$O(n)$\u7684\n\n\u5b8c\u6210\u4e86\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u4e4b\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5728$log$\u8f6e\u8fed\u4ee3\u4e2d\u628ad\u4ece0\u8fed\u4ee3\u5230B\u4e86\n\n\u7136\u540e\u6211\u4eec\u4e58\u4e00\u4e58\u5c31\u80fd\u628a\u9636\u4e58\u7b97\u51fa\u6765\u5566~\n\n\u65f6\u95f4\u590d\u6742\u5ea6\n\n$$T(n)=T(n/2)+O(nlogn)=O(nlogn)$$\n\n\u4e0a\u4ee3\u7801~\n\n```C\n// luogu-judger-enable-o2\n#include<cstdio>\n#include<algorithm>\n#include<cmath>\nusing namespace std;const int N=262144+10;typedef unsigned long long ll;\nconst int P=65536;const int SF=16;const int msk=65535;ll mod;ll PP;\ntypedef long double ld;const ld pi=acos(-1.0);\ninline ll po(ll a,ll p){ll r=1;for(;p;p>>=1,a=a*a%mod)if(p&1)r=r*a%mod;return r;}\nstruct cmp\n{\n    ld r;ld v;\n    friend cmp operator +(cmp a,cmp b){return (cmp){a.r+b.r,a.v+b.v};}\n    friend cmp operator -(cmp a,cmp b){return (cmp){a.r-b.r,a.v-b.v};}\n    friend cmp operator *(cmp a,cmp b){return (cmp){a.r*b.r-a.v*b.v,a.r*b.v+a.v*b.r};}\n    void operator /=(const int& len){r/=len;v/=len;}\n}rt[2][22][N],tr[N],tr1[N],tr2[N],tr3[N],tr4[N],tr5[N],tr6[N];\nint rv[22][N];ll m13[N],m14[N],m23[N],m24[N];\ninline void pre()\n{\n    for(int d=1;d<=18;d++)\n        for(int i=1;i<(1<<d);i++)rv[d][i]=(rv[d][i>>1]>>1)|((i&1)<<(d-1));\n    for(int d=1,t=1;d<=18;d++,t<<=1)\n        for(int i=0;i<(1<<d);i++)rt[0][d][i]=(cmp){cos(pi*i/t),sin(pi*i/t)};\n    for(int d=1,t=1;d<=18;d++,t<<=1)\n        for(int i=0;i<(1<<d);i++)rt[1][d][i]=(cmp){cos(pi*i/t),-sin(pi*i/t)};\n}inline void fft(cmp* a,int len,int d,int o)\n{\n    for(int i=1;i<len;i++)if(i<rv[d][i])swap(a[i],a[rv[d][i]]);cmp* w;int i;\n    for(int k=1,j=1;k<len;k<<=1,j++)\n        for(int s=0;s<len;s+=(k<<1))\n            for(i=s,w=rt[o][j];i<s+k;i++,++w)\n                {cmp a1=a[i+k]*(*w);a[i+k]=a[i]-a1;a[i]=a[i]+a1;}\n    if(o)for(int i=0;i<len;i++)a[i]/=len;\n}inline void dbdft(ll* a,int len,int d,cmp* op1,cmp* op2)\n{\n    for(int i=0;i<len;i++)tr[i]=(cmp){(ld)(a[i]>>SF),(ld)(a[i]&msk)};\n    fft(tr,len,d,0);tr[len]=tr[0];\n    for(cmp* p1=tr,*p2=tr+len,*p3=op1;p1!=tr+len;++p1,--p2,++p3)\n        (*p3)=(cmp){p1->r+p2->r,p1->v-p2->v}*(cmp){0.5,0};\n    for(cmp* p1=tr,*p2=tr+len,*p3=op2;p1!=tr+len;++p1,--p2,++p3)\n        (*p3)=(cmp){p1->r-p2->r,p1->v+p2->v}*(cmp){0,-0.5};\n}inline void dbidft(cmp* tr,int len,int d,ll* a,ll* b)\n{\n    fft(tr,len,d,1);\n    for(int i=0;i<len;i++)a[i]=(ll)(tr[i].r+0.5)%mod;\n    for(int i=0;i<len;i++)b[i]=(ll)(tr[i].v+0.5)%mod;\n}inline void poly_mul(ll* a,ll* b,ll* c,int len,int d)//\u4ee5\u4e0a\u90fd\u662f\u4efb\u610f\u6a21\u6570fft\u7684\u677f\u5b50 \n{\n    dbdft(a,len,d,tr1,tr2);dbdft(b,len,d,tr3,tr4);\n    for(int i=0;i<len;i++)tr5[i]=tr1[i]*tr3[i]+(cmp){0,1}*tr2[i]*tr4[i];\n    for(int i=0;i<len;i++)tr6[i]=tr2[i]*tr3[i]+(cmp){0,1}*tr1[i]*tr4[i];\n    dbidft(tr5,len,d,m13,m24);dbidft(tr6,len,d,m23,m14);\n    for(int i=0;i<len;i++)c[i]=m13[i]*PP%mod;\n    for(int i=0;i<len;i++)(c[i]+=(m23[i]+m14[i])*P+m24[i])%=mod;\n}namespace iter\n{\n    ll f[N];ll g[N];ll h[N];ll ifac[N];\n    inline void ih()\n    {\n        ifac[0]=ifac[1]=1;\n        for(int i=2;i<min((ll)N,mod);i++)ifac[i]=(mod-mod/i)*ifac[mod%i]%mod;\n        for(int i=1;i<min((ll)N,mod);i++)(ifac[i]*=ifac[i-1])%=mod;\n    }inline void calch(ll del,int cur,ll* ip,ll* op)\n    {\n        int d=0;int len=1;while(len<=cur+cur+cur)len<<=1,d++;\n        for(int i=0;i<=cur;i++)f[i]=ip[i]*ifac[i]%mod*ifac[cur-i]%mod;\n        for(int i=cur-1;i>=0;i-=2)f[i]=(mod-f[i])%mod;\n        for(int i=0;i<=cur+cur;i++)g[i]=po((del+mod-cur+i)%mod,mod-2); \n        for(int i=cur+1;i<len;i++)f[i]=0;for(int i=cur+cur+1;i<len;i++)g[i]=0;\n        poly_mul(f,g,h,len,d);//\u5377\u79ef\u6c42\u51fah' \n        ll xs=1;ll p1=del-cur;ll p2=del;\n        for(int i=p1;i<=p2;i++)(xs*=i)%=mod;\n        for(int i=0;i<=cur;i++,p1++,p2++)//\u53cc\u6307\u9488\u6c42\u51fa\u7cfb\u6570 \n        {\n            op[i]=h[i+cur]*xs%mod;\n            (xs*=po(p1,mod-2))%=mod,(xs*=(p2+1))%=mod;\n        }  \n    }\n}ll val[N];ll fv1[N];ll fv2[N];\ninline void solve(int n)//\u500d\u589e \n{\n    int hb=0;for(int p=n;p;p>>=1)hb++;val[0]=1;\n    for(int z=hb,cur=0;z>=0;z--)\n    {\n        if(cur!=0)//\u628ad\u4e582 \n        {\n            iter::calch(cur+1,cur,val,fv1);\n            for(int i=0;i<=cur;i++)val[cur+i+1]=fv1[i];val[cur<<1|1]=0;\n            iter::calch(cur*po(n,mod-2)%mod,cur<<1,val,fv2);\n            cur<<=1;for(int i=0;i<=cur;i++)(val[i]*=fv2[i])%=mod;\n        }if((n>>z)&1)//\u628ad\u52a01 \n        {\n            for(int i=0;i<=cur;i++)(val[i]*=(ll)(n*i)+cur+1)%=mod;cur|=1;val[cur]=1;\n            for(int i=1;i<=cur;i++)(val[cur]*=(ll)cur*n+i)%=mod;\n        }\n    }\n}\nint main()\n{\n    pre();int n;scanf(\"%d%lld\",&n,&mod);iter::ih();\n    int bl=sqrt(n);PP=(ll)P*P%mod;solve(bl);ll res=1;\n    for(int i=0,id=0;;i+=bl,id++)//\u5206\u5757 \n    {\n        if((ll)i+bl>n){for(int j=i+1;j<=n;j++)(res*=j)%=mod;break;}\n        (res*=val[id])%=mod;\n    }printf(\"%lld\",res);return 0;//\u62dc\u62dc\u7a0b\u5e8f~ \n}\n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        "postTime": 1554335677,
        "uid": 56384,
        "name": "shadowice1984",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5282 \u3010\u3010\u6a21\u677f\u3011\u5feb\u901f\u9636\u4e58\u7b97\u6cd5\u3011"
    },
    {
        "content": "\u8fd9\u662f\u4e00\u7bc7\u975e\u6b63\u89e3\u7684\u9898\u89e3\uff0c\u5982\u60f3\u8981\u5b66\u4e60 $O(\\sqrt n\\log n)$ \u7684\u89e3\u6cd5\u8bf7\u81ea\u884c\u7565\u8fc7\u3002\n\n```\u4e0d\u9700\u8981\u4ec0\u4e48\u591a\u9879\u5f0f\uff0c\u66b4\u529b\u662f\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u7684\u3002```\n\n\u9898\u610f\uff1a\u7ed9\u5b9a $n,p$,\u6c42 $n! \\mod p$ \u7684\u503c\u3002\n\n\u663e\u7136\u76f4\u63a5\u505a\u662f $O(n)$ \u7684\u3002\n\n\u6570\u636e\u8303\u56f4~~\u53ea~~\u6709 $2^{31}$,\u9898\u76ee\u5374\u63d0\u793a\u590d\u6742\u5ea6\u5c0f\u4e8e $O(\\sqrt n\\log n)$\u3002\u4f46\u662f\u4eba\u5bb6 $O(n^2)$ \u90fd\u80fd\u8fc7\u767e\u4e07\u51ed\u5565\u6211 $O(n)$ \u4e0d\u80fd\u8fc7 $2^{31}$\u3002\n\n\u4e8e\u662f\u8003\u8651\u4f18\u5316 $O(n)$\u3002\u663e\u7136\u6211\u4eec\u4e0d\u80fd\u901a\u8fc7\u51cf\u5c11\u4e58\u7684\u6b21\u6570\u6765\u5361\u5e38\uff0c\u6216\u8005\u8bf4\u901a\u8fc7\u67d0\u4e9b\u65b9\u6cd5\u51cf\u5c11\u4e58\u7684\u6b21\u6570\u53cd\u800c\u4f1a\u5bfc\u81f4\u53d8\u6162~~\u6216\u8005\u5bfc\u81f4\u7b97\u6cd5\u53d8\u9ad8\u7ea7~~\u3002\n\n\u9636\u4e58\u662f\u4e00\u4e2a\u975e\u5e38\u9002\u5408\u5faa\u73af\u5c55\u5f00\u7684\u4e1c\u897f\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u9636\u4e58\u6bcf $8$ \u4e2a\u4e00\u7ec4\u5206\u522b\u8ba1\u7b97\u3002\u5373\u5206\u522b\u8ba1\u7b97 $1\\times 9\\times 17\\times \\dots \\times 8k+1$\uff0c$2\\times 10\\times 18\\times \\dots \\times 8k+2 \\dots$ \u540e\u5168\u90e8\u4e58\u8d77\u6765\u3002\n\n\u53ef\u60dc\u5faa\u73af\u5c55\u5f00\u8fd8\u662f\u4e0d\u591f\u5feb\uff0c\u4f46\u662f\u6709\u4e00\u4e2a\u6bd4\u5faa\u73af\u5c55\u5f00\u66f4\u5feb\u4e14\u66f4\u76f4\u63a5\u7684\u6279\u91cf\u64cd\u4f5c\u7684\u4e1c\u897f\uff1a**\u6307\u4ee4\u96c6**\u3002\n\n\u8fd9\u91cc\u6211\u91c7\u7528\u4e86 AVX2 \u6307\u4ee4\u96c6\u8fdb\u884c\u4f18\u5316\u3002AVX2 \u53ef\u4ee5\u652f\u6301\u9ad8\u6548\u7684 256 \u4f4d\u5411\u91cf\u8fd0\u7b97\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u540c\u65f6\u8fd0\u7b97 8 \u4e2a\u6574\u578b\u3002\n\n\u7531\u4e8e\u6307\u4ee4\u96c6\u6307\u4ee4\u8fc7\u4e8e~~\u4e30\u5bcc~~\u590d\u6742\uff0c\u4e0b\u9762\u53ea\u6709\u4ee3\u7801\u4e2d\u5e26\u6709\u4e00\u4e9b\u5bf9\u6307\u4ee4\u7684\u8bb2\u89e3\u3002[\u8fd9\u662f\u5fae\u8f6f\u63d0\u4f9b\u7684SSE2\u6307\u4ee4\u96c6\u7684\u8bf4\u660e\uff0c\u4e0eAVX2\u6307\u4ee4\u7c7b\u4f3c\u3002](https://docs.microsoft.com/en-us/previous-versions/visualstudio/visual-studio-2008/84t4h8ys(v=vs.90))\n\nAXV2 \u7684\u4e00\u4e2a\u53d8\u91cf\u5360\u7528 256 \u4f4d\u7a7a\u95f4\uff0c\u6839\u636e\u4e0d\u540c\u60c5\u51b5\u53ef\u4ee5\u5f53\u4f5c\u4e0d\u540c\u7cbe\u5ea6\u7684\u6d6e\u70b9\u6216\u6574\u578b\u4f7f\u7528\uff0c\u4e0b\u9762\u4e3b\u8981\u5f53\u4f5c 8 \u4e2a int \u4f7f\u7528\u3002\n\n\u5b83\u7684\u6574\u578b\u652f\u6301\u5927\u90e8\u5206\u7684\u4f4d\u8fd0\u7b97\u4ee5\u53ca\u52a0\u51cf\u4e58\u8fd0\u7b97\uff0c\u4f46\u662f\u4e0d\u652f\u6301\u9664\u6cd5\u53ca\u53d6\u6a21\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u81ea\u5df1\u60f3\u529e\u6cd5\u5b9e\u73b0\u53d6\u6a21\u3002\n\n\u4e0b\u9762\u6709\u51e0\u79cd\u89e3\u51b3\u65b9\u6848\uff1a\n\n1\uff1a\u901a\u8fc7\u8f6c\u6362\u7c7b\u578b\u5b9e\u73b0\u9664\u6cd5\u518d\u8fdb\u884c\u53d6\u6a21\u3002\u4f46\u662f\u53d7\u5230\u786c\u4ef6\u9650\u5236 cpu \u7684\u9664\u6cd5\u8fd0\u7b97\u6781\u5176\u6162\uff0c\u65e0\u6cd5\u91c7\u7528\u3002\n\n2\uff1a\u901a\u8fc7 barrett \u7ea6\u51cf\u5b9e\u73b0\u53d6\u6a21\u3002\u4f46\u662f\u5728\u672c\u9898\u6570\u636e\u8303\u56f4\u5185\u4f7f\u7528 barrett \u7ea6\u51cf\u5c06\u4f1a\u6d89\u53ca AVX2 \u4e0d\u652f\u6301\u7684 128 \u4f4d\u6574\u6570\u7684\u8fd0\u7b97\uff0c\u65e0\u6cd5\u91c7\u7528\u3002\n\n3\uff1a\u901a\u8fc7\u8499\u54e5\u9a6c\u5229\u7ea6\u51cf\u5b9e\u73b0\u53d6\u6a21\u3002\u8499\u54e5\u9a6c\u5229\u7ea6\u51cf\u53ef\u4ee5\u4ec5\u5728 64 \u4f4d\u6574\u6570\u8303\u56f4\u5185\u5b8c\u6210\u53d6\u6a21\u4e14\u901f\u5ea6\u8f83\u5feb\uff0c\u56e0\u6b64\u6211\u91c7\u7528\u4e86\u8499\u54e5\u9a6c\u5229\u7ea6\u51cf\u5b9e\u73b0\u672c\u9898\u3002\n\n\u6ce8\uff1a\n\nbarrett \u7ea6\u51cf\uff1a\n\n\u5bf9\u4e8e $r=z\\mod p$ \u57fa\u4e8e\u4f4e\u6210\u672c\u7684\u9664\u6cd5\u8fd0\u7b97\u83b7\u5f97 $q=[2^k/p]$\uff0c\u6bcf\u6b21\u53d6\u6a21\u65f6\u5148\u8ba1\u7b97 $x=q\\times z/2^k\\approx z/p$\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u901a\u8fc7\u4e00\u6b21\u4e58\u6cd5\u8fd0\u7b97\u53ca\u4e00\u6b21\u4f4d\u79fb\u8fd0\u7b97\u9ad8\u6548\u7684\u5b8c\u6210\u4e86\u4e00\u6b21\u4e0d\u662f\u5f88\u7cbe\u786e\u7684\u9664\u6cd5\u3002\n\n\u63a5\u4e0b\u6765\u8ba1\u7b97 $r'=r-x\\times p$\uff0c\u5728\u9664\u6cd5\u7cbe\u786e\u7684\u60c5\u51b5\u4e0b $r'$ \u5373\u4e3a\u7b54\u6848\uff0c\u4f46\u662f\u7531\u4e8e\u6211\u4eec\u5b8c\u6210\u7684\u9664\u6cd5\u4e0d\u7cbe\u786e\uff0c\u6211\u4eec\u9700\u8981\u518d\u8fdb\u884c\u4e00\u6b21\u6821\u9a8c\uff0c\u82e5 $r'$ \u5927\u4e8e $p$ \u5219 $r'=r'-p$\uff0c\u5728 $k$ \u8db3\u591f\u5927\u65f6 $r'$ \u5373\u4e3a\u6240\u6c42\u3002\u4e8e\u662f\u6211\u4eec\u5c31\u901a\u8fc7\u4e24\u6b21\u4e58\u6cd5\u66ff\u6362\u6389\u4e86\u4e00\u6b21\u53d6\u6a21\uff0c\u5b9e\u9645\u4e0a\u7f16\u8bd1\u5668\u5bf9\u4e8e\u5e38\u91cf\u7684\u53d6\u6a21\u4f18\u5316\u5c31\u662f\u57fa\u4e8e\u6b64\u7684\u3002\n\n\u4f46\u662f\u7531\u4e8e 32 \u4f4d\u6574\u6570\u4f5c\u4e3a\u6a21\u6570\u65f6 $k$ \u901a\u5e38\u9700\u8981\u53d6 60 \u4ee5\u4e0a\uff0c\u8ba1\u7b97 $x=q\\times z/2^k\\approx z/p$ \u65f6\u9700\u8981\u7528\u5230 128 \u4f4d\u6574\u6570\uff0c\u56e0\u6b64\u65e0\u6cd5\u4f7f\u7528 barrett \u7ea6\u51cf\u4f18\u5316\u6b64\u9898\u3002\n\n\u8499\u54e5\u9a6c\u5229\u7ea6\u51cf\uff1a\n\n\u7531\u4e8e\u8499\u54e5\u9a6c\u5229\u7ea6\u51cf\u8bc1\u660e\u53ca\u6d41\u7a0b\u8fc7\u4e8e\u590d\u6742\uff0c\u8fd9\u91cc\u4ec5\u653e\u4e00\u4e2a[\u767e\u5ea6\u6587\u5e93\u94fe\u63a5](https://wenku.baidu.com/view/a340c44e7d21af45b307e87101f69e314332fa7f.html)\u3002\uff08\u540e\u7eed\u53ef\u80fd\u4f1a\u586b\u5751\uff1f\uff09\n\n\u7b80\u5355\u6765\u8bf4\uff0c\u8499\u54e5\u9a6c\u5229\u7ea6\u51cf\u5c31\u662f\u901a\u8fc7\u5c06\u6574\u6570\u8f6c\u6362\u5230\u8499\u54e5\u9a6c\u5229\u6570\u57df\u4f7f\u5f97\u53d6\u6a21\u53ef\u4ee5\u4f7f\u7528\u4e24\u6b21\u4e58\u6cd5\u53ca\u4e00\u6b21\u4f4d\u79fb\u5b9e\u73b0\uff0c\u4e14\u5bf9\u4e8e 32 \u4f4d\u7684\u6a21\u6570\u53ef\u4ee5\u5728 64 \u4f4d\u5185\u5b8c\u6210\u8fd0\u7b97\u3002\n\n\u9884\u5904\u7406\u8fdb\u5165\u4e86\u8499\u54e5\u9a6c\u5229\u6570\u57df\u7684 1-8 \u5e76\u653e\u5165 AVX2 \u53d8\u91cf\u5185\uff0c\u5047\u8bbe\u53eb ml \uff0c\u540c\u65f6\u9884\u5904\u7406\u4e00\u4e2a\u585e\u4e86 8 \u4e2a 8 \u7684 AVX2 \u53d8\u91cf\uff0c\u5047\u8bbe\u53eb ad \uff0c\u7b54\u6848\u9884\u8bbe\u4e3a\u585e\u4e86 8 \u8499\u54e5\u9a6c\u5229\u6570\u57df\u7684 1 \u7684 AVX2 \u53d8\u91cf\u3002\n\n\u8fd9\u6837\u6211\u4eec\u53ea\u9700\u8981\u6bcf\u6b21\u5c06\u7b54\u6848\u4e0e ml \u76f8\u4e58\uff0c\u518d\u5c06 ml \u52a0\u4e0a ad \u5373\u53ef\u3002\u6240\u6709\u8fd0\u7b97\u5747\u5728\u6570\u57df\u5185\u5b8c\u6210\uff0c\u6ca1\u6709\u8fdb\u51fa\u6570\u57df\u7684\u65f6\u95f4\u6d6a\u8d39\u3002\n\n\u4e8e\u662f\u6211\u4eec\u6240\u9700\u8981\u7684\u6240\u6709\u8fd0\u7b97\u90fd\u53ef\u4ee5\u5b9e\u73b0\u4e86\uff0c\u7ec8\u4e8e\u53ef\u4ee5\u4e0a\u4ee3\u7801\u4e86\u3002\n\n```cpp\n#include<stdio.h>\n#include<immintrin.h>\n#pragma GCC target(\"avx2\")\n//__m256i\u4e3aAVX2\u6307\u4ee4\u96c6\u7684\u6574\u578b\u53d8\u91cf \nstatic unsigned mod,r,n2_;\nstatic __m256i a0,mod1,R,hi32,ans,ml,ad;\nlong long exgcd(long long a,long long b,long long &x,long long &y)\n{\n\tlong long d=a;\n\tif(b==0) x=1,y=0;\n\telse d=exgcd(b,a%b,y,x),y-=a/b*x;\n\treturn d;\n}\ninline unsigned mul(unsigned x,unsigned y)//\u8499\u54e5\u9a6c\u5229\u6570\u57df\u5185\u7684\u4e58\u6cd5\u53ca\u53d6\u6a21 \n{\n\tunsigned long long z=(unsigned long long)x*y;//\u8ba1\u7b97\u4e58\u79ef \n\treturn (z+(unsigned long long)(unsigned(z)*r)*mod)>>32;//\u5bf9p\u53d6\u6a21 \n}\ninline __m256i add(__m256i _num1,__m256i _num2)//\u5c068\u4e2a32\u4f4d\u6574\u6570\u76f8\u52a0\u5e76\u53d6\u6a21 \n{\n\t__m256i apb=_mm256_add_epi32(_num1,_num2),//\u5c06num1,num2\u5185\u76848\u4e2a\u6574\u6570\u5bf9\u5e94\u76f8\u52a0 \n\tret=_mm256_sub_epi32(apb,mod1);//\u5c06\u7b54\u6848\u51cf\u53bbmod \n\t__m256i cmp=_mm256_cmpgt_epi32(a0,ret),//\u5f97\u5230\u7b54\u6848\u5185\u5c0f\u4e8e0\u7684\u6570 \n\tadd=_mm256_and_si256(cmp,mod1);\n\treturn _mm256_add_epi32(add,ret);//\u5c06\u5c0f\u4e8e0\u7684\u6570\u52a0mod \n}\ninline __m256i mul(__m256i _num1,__m256i _num2)//\u5c068\u4e2a32\u4f4d\u6574\u6570\u76f8\u4e58\u5e76\u53d6\u6a21 \n{\n\t__m256i _num3=_num1,_num4,_num5=_num2;\n\t_num2=_mm256_mul_epu32(_num1,_num2);//\u5c06\u5076\u6570\u4f4d\u7684\u6574\u6570\u76f8\u4e58\uff08\u5f97\u52304\u4e2a64\u4f4d\u6574\u6570\u5e76\u653e\u56de\uff09 \n\t_num1=_mm256_mul_epu32(_mm256_mul_epu32(_num2,R),mod1);\n    _num4=_mm256_srli_epi64(_mm256_add_epi64(_num1,_num2),32);//\u6bcf\u4e2a64\u4f4d\u6574\u6570\u5747\u5de6\u79fb32\u4f4d\uff0c\u7a7a\u51fa\u9ad832\u4f4d\uff08\u5947\u6570\u4f4d\uff09 \n\t_num1=_mm256_srli_si256(_num3,4);_num2=_mm256_srli_si256(_num5,4);//\u8fdb\u884c4\u5b57\u8282\u4f4d\u79fb\uff0c\u5373\u5c06\u5947\u6570\u4f4d\u7684\u6574\u6570\u79fb\u52a8\u5230\u5076\u6570\u4f4d \n\t_num2=_mm256_mul_epu32(_num1,_num2);//\u5c06\u539f\u5947\u6570\u4f4d\u7684\u6574\u6570\u76f8\u4e58 \n\t_num1=_mm256_mul_epu32(_mm256_mul_epu32(_num2,R),mod1);\n    _num1=_mm256_and_si256(_mm256_add_epi64(_num1,_num2),hi32);//\u901a\u8fc7\u8ddfhi32\u505a\u4e0e\u53d6\u51fa\u4f4e32\u4f4d\uff08\u5076\u6570\u4f4d\uff09 \n    return _mm256_or_si256(_num1,_num4);//\u5c06\u5076\u6570\u4f4d\u4e58\u79ef\u548c\u5947\u6570\u4f4d\u4e58\u79ef\u5408\u5e76\u4f4d\u4e00\u4e2aAVX2\u53d8\u91cf\u8fd4\u56de \n}\ninline unsigned mon_in(unsigned x){return mul(x,n2_);}//\u8fdb\u5165\u8499\u54e5\u9a6c\u5229\u6570\u57df \ninline unsigned mon_out(unsigned x)//\u79bb\u5f00\u8499\u54e5\u9a6c\u5229\u6570\u57df \n{unsigned ret=((x+(unsigned long long)(unsigned(x)*r)*mod)>>32);return ret<mod?ret:ret-mod;}\nvoid solve(int n,int p)\n{\n\tunsigned i=1;\n\tlong long x,y;\n\tmod=p;\n\tn2_=-(unsigned long long)mod%mod;exgcd(mod,1ll<<32,x,y);r=-unsigned(x);//\u521d\u59cb\u5316\u4e00\u4e9b\u8499\u54e5\u9a6c\u5229\u7ea6\u51cf\u9700\u8981\u4f7f\u7528\u7684\u53d8\u91cf\n\ta0=_mm256_setzero_si256(),//\u9884\u5904\u7406\u51680\u7684AVX2\u53d8\u91cf\uff08\u505a\u52a0\u6cd5\u6709\u7528\uff09 \n\tmod1=_mm256_set1_epi32(mod),R=_mm256_set1_epi32(r);//\u9884\u5904\u7406\u5168mod1,\u5168r\u7684AVX2\u53d8\u91cf \n\thi32=_mm256_set_epi32(-1,0,-1,0,-1,0,-1,0);//\u9884\u5904\u7406\u5947\u6570\u4f4d\u51681\u7684AVX2\u53d8\u91cf\uff08\u505a\u4e58\u6cd5\u6709\u7528\uff09 \n\tans=_mm256_set1_epi32(mon_in(1));//\u521d\u59cb\u5316ans \n\tad=_mm256_set1_epi32(mon_in(8));//\u521d\u59cb\u5316\u51688\u7684AVX2\u53d8\u91cf \n\tml=_mm256_set_epi32(mon_in(8),mon_in(7),mon_in(6),mon_in(5),mon_in(4),mon_in(3),mon_in(2),mon_in(1));//\u521d\u59cb\u5316\u56e0\u6570 \n\tfor(;i+8<=n;i+=8)\n\t{\n\t\tans=mul(ans,ml);//\u5c06ans\u76848\u4f4d\u4e0e\u56e0\u6570\u76848\u4f4d\u4f9d\u6b21\u76f8\u4e58 \n\t\tml=add(ml,ad);//\u5c06\u56e0\u65708\u4f4d\u5168\u90e8\u52a08 \n\t}\n\tunsigned *fl=(unsigned*)&ans;\n\tunsigned as=mul(mul(mul(fl[0],fl[1]),mul(fl[2],fl[3])),mul(mul(fl[4],fl[5]),mul(fl[6],fl[7])));//\u53d6\u51faans\u76848\u4f4d\u5e76\u76f8\u4e58 \n\tas=mon_out(as);//\u79bb\u5f00\u8499\u54e5\u9a6c\u5229\u6570\u57df \n\tfor(;i<=n;i++)//\u5904\u7406\u6574\u6bb5\u672a\u505a\u6389\u7684\u672b\u51e0\u4f4d \n\t\tas=1ull*as*i%mod;\n\tprintf(\"%u\\n\",as);\n}\nint main()\n{\n\tint T;\n\tscanf(\"%d\",&T);\n\twhile(T--)\n\t{\n\t\tint n,p;\n\t\tscanf(\"%d%d\",&n,&p);\n\t\tsolve(n,p);\n\t}\n\treturn 0;\n}\n```\n\n\u7136\u540e\u5c31\u6109\u5feb\u7684\u5207\u6389\u4e86\u4e00\u9053\u9ed1\u9898[\u63d0\u4ea4\u8bb0\u5f55](https://www.luogu.com.cn/record/76437967)\u3002~~\u5176\u5b9e\u65f6\u95f4\u5361\u7684\u8fd8\u662f\u633a\u6b7b\u7684~~",
        "postTime": 1653577317,
        "uid": 48978,
        "name": "bh1234666",
        "ccfLevel": 0,
        "title": "p5282 \u9898\u89e3"
    },
    {
        "content": "Min_25\u725b\u903c\uff01Min_25\u725b\u903c\uff01Min_25\u725b\u903c\uff01\n\n\u8bbe\u6709 $f_d(x)=\\prod_{i=1}^{d}(x+i)=f_{d-1}(x)(x+d)$\uff0c\u8bbe $B=\\lfloor\\sqrt{n}\\rfloor$\uff0c\u90a3\u4e48\u8ba1\u7b97\u9636\u4e58\u5c31\u76f8\u5f53\u4e8e\u9700\u8981\u8ba1\u7b97 $f_B(iB)$\uff08$i\\in[0,B]$\uff09\n\n\u8003\u8651\u500d\u589e\u3002\u5982\u679c\u6211\u4eec\u77e5\u9053\u4e86 $f_d(iB)$\uff08$i\\in[0,d]$\uff09\uff0c\u8003\u8651\u5e94\u8be5\u5982\u4f55\u8ba1\u7b97 $f_{d+1}(iB))$\uff08$i\\in[0,d+1]$\uff09 \u548c $f_{2d}(iB)$\uff08$i\\in[0,2d]$\uff09\n\n\u7b2c\u4e00\u4e2a\u662f\u8f83\u4e3a\u663e\u7136\u7684\uff0c\u53ea\u9700\u8981\u5bf9 $x+d+1$ \u6c42\u51fa $x\\in[0,dB],B\\mid x$ \u65f6\u7684\u70b9\u503c\u5373\u53ef\uff0c\u5bf9\u4e8e $f_{d+1}(dB)$ \u76f4\u63a5\u66b4\u529b\u8ba1\u7b97\u5373\u53ef\u3002\n\n\u7b2c\u4e8c\u4e2a\u6bd4\u8f83\u9ebb\u70e6\u3002\n\n\u6839\u636e\u5b9a\u4e49\u663e\u7136\u6709 $f_{2d}(x)=f_d(x)f_d(x+d)$\u3002\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u53ea\u8981\u77e5\u9053\u4e86 $f_d(iB),f_d(iB+d)$\uff08$i\\in[0,2d]$\uff09 \u7684\u70b9\u503c\u5373\u53ef\u3002\n\n\u4ee4 $g_d(x)=f_d(xB)$\uff0c\u4e0a\u8ff0\u95ee\u9898\u53d8\u4e3a\u7ed9\u5b9a $g_d(x)$\uff08$x\\in[0,2d]$\uff09\uff0c\u6c42 $g(x+\\frac{d}{B})$\uff08$x\\in[0,2d]$\uff09\u3002\n\n\u5f88\u663e\u7136\u5728\u6a21\u610f\u4e49\u4e0b\u6709 $\\frac{d}{B}>B$\u3002\n\n\u8bc1\u660e\uff1a\u56e0\u4e3a $n<p$\uff0c\u6240\u4ee5\u5bf9\u4e8e $k\\in[0,B]$ \u90fd\u6709 $kB<n<p$\uff0c\u6240\u4ee5 $kB\\ne d$\uff0c\u90a3\u4e48 $[0,B]$ \u4e2d\u4e00\u5b9a\u4e0d\u5b58\u5728 $\\frac{d}{B}$\u3002\n\n\u4f60\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u548c [\u62c9\u683c\u6717\u65e5\u63d2\u503c2](http://loj.ac/p/166) \u5f88\u50cf\uff0c\u4f46\u662f\u6211\u4eec\u5e76\u4e0d\u77e5\u9053 $g_d(i)$\uff08$i\\in[d,2d]$\uff09\u3002\n\n\u53ef\u4ee5\u8003\u8651\u901a\u8fc7 $g_d(i)$\uff08$i\\in[0,d]$\uff09\u6c42\u51fa $g_d(i)$\uff08$i\\in[d,2d]$\uff09\uff0c\u518d\u6c42\u4e0a\u9762\u7684\u90a3\u4e2a\u4e1c\u897f\u3002\n\n\u8fd9\u91cc\u53ef\u4ee5\u76f4\u63a5\u5957\u7528 LOJ166 \u7684\u505a\u6cd5\u4e86\u3002\u590d\u6742\u5ea6 $T(n)=T(\\frac{n}{2})+O(\\log n)=T(n\\log n)$\uff0c\u8fd9\u91cc $n=\\sqrt N$ \u6240\u4ee5\u590d\u6742\u5ea6\u662f $O(\\sqrt{n}\\log n)$\u3002\n\n\u7b2c\u4e8c\u90e8\u5206\u7684\u6d41\u7a0b\uff1a$f_d(iB)$\uff08$i\\in[0,d]$\uff09->$f_d(iB)$\uff08$i\\in[0,2d]$\uff09->$f_d(iB+d)$\uff08$i\\in[2d]$\uff09->$f_{2d}(iB)$\uff08$i\\in[0,2d]$\uff09\n```cpp\n#include<cstdio>\n#include<cmath>\n#define IMP(lim,act) for(int qwq=(lim),i=0;i^qwq;++i)act\ntypedef double db;\nconst int M=3e5+5;\nconst db Pi=acos(-1);\nint n,P,F[M],ifac[M];\nstruct Barrett{\n\ttypedef unsigned long long ull;\n\ttypedef __uint128_t LL;\n\tull m,B;\n\tBarrett(const ull&m=2):m(m),B((LL(1)<<64)/m){}\n\tfriend inline ull operator%(const ull&a,const Barrett&mod){\n\t\tull r=a-mod.m*(LL(mod.B)*a>>64);return r>=mod.m?r-mod.m:r;\n\t}\n}mod;\nstruct complex{\n\tdb x,y;\n\tcomplex(const db&x=0,const db&y=0):x(x),y(y){}\n\tinline complex operator+(const complex&it)const{\n\t\treturn complex(x+it.x,y+it.y);\n\t}\n\tinline complex operator-(const complex&it)const{\n\t\treturn complex(x-it.x,y-it.y);\n\t}\n\tinline complex operator*(const complex&it)const{\n\t\treturn complex(x*it.x-y*it.y,x*it.y+y*it.x);\n\t}\n}buf[M],*w[20];\ninline int Getlen(const int&n){\n\tint len(0);while((1<<len)<n)++len;return len;\n}\ninline void swap(complex&a,complex&b){\n\tcomplex c=a;a=b;b=c;\n}\ninline int Get(const db&x){\n\treturn((long long)(x+.5))%mod;\n}\ninline int qpow(int a,int b=P-2){\n\tint ans(1);for(;b;b>>=1,a=1ll*a*a%mod)if(b&1)ans=1ll*ans*a%mod;return ans;\n}\ninline void NTT_init(const int&n){\n\tconst int&m=Getlen(n)-1;complex*now=buf;w[m]=now;now+=1<<m;\n\tIMP(1<<m,w[m][i]=complex(std::cos(i*Pi/(1<<m)),std::sin(i*Pi/(1<<m))));\n\tfor(int k=m-1;k>=0&&(w[k]=now,now+=1<<k);--k)IMP(1<<k,w[k][i]=w[k+1][i<<1]);\n}\ninline void DFT(complex*f,const int&M){\n\tconst int&n=1<<M;\n\tfor(int len=n>>1,d=M-1;d>=0;--d,len>>=1)for(int k=0;k^n;k+=len<<1){\n\t\tcomplex*W=w[d],*L=f+(k),*R=f+(k|len),x,y;IMP(len,(x=*L,y=*R)),*L++=(x+y),*R++=*W++*(x-y);\n\t}\n}\ninline void IDFT(complex*f,const int&M){\n\tconst int&n=1<<M;\n\tfor(int len=1,d=0;d^M;++d,len<<=1)for(int k=0;k^n;k+=len<<1){\n\t\tcomplex*W=w[d],*L=f+(k),*R=f+(k|len),x,y;IMP(len,(x=*L,y=*W++**R)),*L++=(x+y),*R++=(x-y);\n\t}\n\tIMP(n,(f[i].x/=n,f[i].y/=n));for(int i=1;(i<<1)<n;++i)swap(f[i],f[n-i]);\n}\ninline void MTT(int*f,int*g,int*h,const int&n,const int&m,const int&t,const int&Len=-1){\n\tstatic complex Q[M],P[M],T[M];const int&len=Getlen(!~Len?n+m-1:Len);\n\tIMP(n,(Q[i].x=f[i]&32767,P[i].x=f[i]>>15));IMP(m,T[i]=complex(g[i]&32767,g[i]>>15));\n\tDFT(Q,len);DFT(P,len);DFT(T,len);IMP(1<<len,(Q[i]=Q[i]*T[i],P[i]=P[i]*T[i]));IDFT(Q,len);IDFT(P,len);\n\tIMP(t,h[i]=(Get(Q[i].x)+(1ll*Get(Q[i].y+P[i].x)<<15)+(1ll*Get(P[i].y)<<30))%mod);IMP(1<<len,Q[i]=P[i]=T[i]=0);\n}\ninline void Getinv(int*f,const int&n){\n\tstatic int pre[M];pre[0]=f[0];for(int i=1;i<n;++i)pre[i]=1ll*pre[i-1]*f[i]%mod;\n\tint t,c=qpow(pre[n-1]);for(int i=n-1;i>=1;--i)t=f[i],f[i]=1ll*pre[i-1]*c%mod,c=1ll*c*t%mod;f[0]=c;\n}\ninline void PT(int*f,int*g,const int&n,const int&m){\n\tstatic int F[M],G[M],H[M];H[0]=1;IMP(n,H[0]=1ll*H[0]*(m-i)%mod);IMP(n+n,G[i]=m+i-n);G[0]=1;Getinv(G,n+n);\n\tIMP(n,F[i]=1ll*ifac[i]*(n-i-1&1?P-ifac[n-i-1]:ifac[n-i-1])%mod*f[i]%mod);\n\tconst int&len=Getlen(n+n);for(int i=1;i<n;++i)H[i]=1ll*(m+i)*G[i]%mod*H[i-1]%mod;MTT(F,G,F,n,n+n,n+n,n+n);\n\tIMP(n,g[i]=1ll*F[n+i]*H[i]%mod);IMP(1<<len,F[i]=G[i]=H[i]=0);\n}\ninline int Getfac(const int&n,const int&p){\n\tstatic int F[M],G[M];const int&B=sqrt(n),m=Getlen(B)-1;\n\tmod=Barrett(P=p);ifac[0]=ifac[1]=1;for(int i=2;i<=B;++i)ifac[i]=1ll*(P-P/i)*ifac[P%i]%mod;\n\tfor(int i=1;i<=B;++i)ifac[i]=1ll*ifac[i-1]*ifac[i]%mod;F[0]=1;F[1]=B+1;\n\tfor(int i=m;i>=0;--i){\n\t\tconst int&q=B>>i+1,p=B>>i;if(!q)continue;\n\t\tPT(F,G,q+1,q+1);IMP(q,F[i+q+1]=G[i]),G[i]=0;G[q]=0;\n\t\tPT(F,G,q*2+1,1ll*q*qpow(B)%mod);IMP(q*2+1,F[i]=1ll*F[i]*G[i]%mod),G[i]=0;\n\t\tif(q*2+1==p){\n\t\t\tIMP(q*2+1,F[i]=1ll*F[i]*(i*B+p)%mod);F[p]=1;IMP(p,F[p]=1ll*F[p]*(p*B+i+1)%mod);\n\t\t}\n\t}\n\tint ans(1);IMP(B,ans=1ll*ans*F[i]%mod),F[i]=0;F[B]=0;for(int i=B*B+1;i<=n;++i)ans=1ll*ans*i%mod;return ans;\n}\nsigned main(){\n\tint T,N,P;NTT_init(1<<17);scanf(\"%d\",&T);while(T--)scanf(\"%d%d\",&N,&P),printf(\"%d\\n\",Getfac(N,P));\n}\n```",
        "postTime": 1656577250,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u6570\u5b66 \u591a\u9879\u5f0f P5282\u9898\u89e3"
    },
    {
        "content": "\u8fd9\u4f4d\u662f\u795e\u4ed9\uff1a[bztminamoto](https://www.cnblogs.com/bztMinamoto/p/10661226.html)\uff0c\u5927\u5bb6\u8d76\u7d27\u819c\n\n\n\u524d\u7f6e\u829d\u58eb: \n\n>1. [\u4efb\u610f\u6a21\u6570 NTT (MTT)](https://www.luogu.org/problemnew/show/P4245)\n\n>2. [\u591a\u9879\u5f0f\u591a\u70b9\u6c42\u503c](https://www.luogu.org/problemnew/show/P5050)\n\n>3. [\u62c9\u683c\u6717\u65e5\u63d2\u503c\u6cd5](https://www.luogu.org/problemnew/show/P4781)\n\n>4. ~~min25\u7b5b\u3010\u96fe~~ \n\n\u6211\u4eec\u8003\u8651\u8fd9\u9053\u9898\u5982\u679c\u6a21\u6570\u56fa\u5b9a\uff081e9+7 \u6216\u8005\u662f 998244353\uff09\uff0c\u5982\u679c\u662f\u53ef\u4ee5 NTT \u7684\u6a21\u6570\u5f53\u7136\u662f\u5999\u54c9\uff0c\u4f46\u662f\u6a21\u6570\u662f\u4ec0\u4e48\u5176\u5b9e\u5df2\u7ecf\u6ca1\u6709\u610f\u4e49\u4e86\uff0c\u56e0\u4e3a\u5b83\u662f\u56fa\u5b9a\u7684...\n\n\u65e2\u7136\u6a21\u6570\u56fa\u5b9a\u7684\u8bdd\u5206\u6bb5\u6253\u8868\u8fd8\u4e0d\u80fd\u8fc7\uff1f\u6bcf\u4e2a\u5757\u7684\u5927\u5c0f\u4e0d\u8d85\u8fc7 1e7 \u90fd\u662f ojbk \u7684\u5427\uff1f\n\n\u6240\u4ee5\u5982\u679c**\u6a21\u6570\u56fa\u5b9a**\uff0c\u80fd\u5206\u6bb5\u6253\u8868\uff08\u8303\u56f4\u624d\u6574\u5f62\uff09\u4e3a\u4ec0\u4e48\u8981\u6765\u4e2a FFT \u5462\u3010\u96fe\n\n\u4f46\u662f\u5f88\u9057\u61be\uff0c\u8fd9\u9053\u9898\u6a21\u6570\u4e0d\u56fa\u5b9a...\u6240\u4ee5\u6211\u4eec\u53ea\u80fd\u8003\u8651\u7528\u522b\u7684\u7b97\u6cd5(~~\u4e71\u641e~~)\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u4e2a\u9898...\u975e\u5e38\u8be1\u5f02\uff0c\u56e0\u4e3a\u5b83\u7684\u505a\u6cd5\u6709\u4e24\u79cd\uff0c\u6211\u4eec\u5148\u6765\u8003\u8651\u8dd1\u5f97\u6bd4\u8f83\u6162\u7684\u4e00\u79cd...\u3010\u96fe\n\n# solve1\n\n\u867d\u8bf4\u6211\u4eec\u4e0d\u80fd\u5206\u6bb5\u6253\u8868\u4e86\uff0c\u4f46\u662f\u5206\u6bb5\uff08\u5757\uff09\u8fd9\u4e2a\u601d\u8def\u662f\u5426\u80fd\u7ed9\u6211\u4eec\u4e00\u70b9\u542f\u53d1\u5462\uff1f\n\n\u9996\u5148\u6211\u4eec\u8003\u8651\u6784\u9020\u4e00\u4e2a bl-1 \u6b21\u591a\u9879\u5f0f\uff1a \n$$F(x)=\\prod_{i=0}^{bl-1} (x+i)$$\n\n\u8fd9\u4e2a\u591a\u9879\u5f0f\u6709\u4ec0\u4e48\u7528\u5462\uff1f\n\n\u6211\u4eec\u8003\u8651\u8fd9\u91cc\u5e26\u5165 x \u4e4b\u540e\u8fd9\u4e2a\u591a\u9879\u5f0f\u7684\u503c\u5176\u5b9e\u5c31\u662f\uff1a\n\n$$(x+bl-1)!\\over (x-1)!$$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u662f\u4e24\u4e2a\u9636\u4e58\u76f8\u9664\u7684\u5f62\u5f0f...\n\n\u90a3\u4e48\u6211\u4eec\u662f\u4e0d\u662f\u53ef\u4ee5\u8003\u8651\u4ee4 bl \u548c\u5206\u5757\u7b97\u6cd5\u91cc\u4e00\u6837\uff0c\u4e3a $sqrt(n)$ \u5462\uff1f\n\n\u8fd9\u6837\u7684\u8bdd\uff0c\u6211\u4eec\u628a $1,s+1,2s+1,...,s* s-s+1 $ \u5e26\u5165\u6c42\u503c\u540e\u518d\u76f8\u4e58\uff0c\u7b54\u6848\u662f\u5426\u5c31\u6bd4\u8f83\u663e\u7136\u4e86\u5462\uff1f\n\n\u8fd9\u65f6\u5019\u6211\u4eec\u628a\u5927\u4e8e s* s \u7684\u90a3\u4e2a\u90e8\u5206\u4e58\u4e0a\u53bb\u5c31\u662f\u7b54\u6848\u4e86\u554a\n\n\n# watch out, gift!\n\n\u4e8e\u662f\u4e4e\u6211\u4eec\u5c1d\u8bd5\u628a\u9694\u58c1\u591a\u9879\u5f0f\u591a\u70b9\u6c42\u503c\u7684\u4ee3\u7801 copy \u8fc7\u6765\uff0c\u7136\u540e NTT \u6539\u6210 FFT \u51c6\u5907\u4ea4\u4e0a\u53bb...\n\n\u4f46\u662f\u8fd9\u91cc\u51fa\u73b0\u4e86\u4e00\u4e2a\u5173\u952e\u6027\u7684\u95ee\u9898...\u8fd9\u91cc\u7684\u6570\u8981\u53d6\u6a21...\u90a3\u4e48\u4e5f\u5c31\u662f\u4efb\u610f\u6a21\u6570 NTT \uff0c\u90a3\u4e48\u6211\u4eec\u4e0d\u80fd\u5355\u7eaf\u7528 FFT \u554a\uff0c\u7cbe\u5ea6\u70b8\u4e86\u5427...\u4e8e\u662f\u6211\u4eec\u7528 ~~\u4e09\u6a21 NTT~~ MTT\n\n\n\u54b3\u54b3\uff0c\u5173\u4e8e MTT \u7684\u8bdd\uff0c\u8fd9\u91cc\u6709\u4e2a\u4f18\u5316\uff1a[\u53d1\u660e\u8005\u5e94\u8be5\u662f\u6bdb\u7237\u7237\uff1f](https://www.cnblogs.com/bztMinamoto/p/10653220.html)\n\n\u7136\u540e\u6211\u662f\u770b\u61f5\u4e86\uff08\u4e3b\u8981\u662f\u4ee3\u7801\u91cc\u9762\u5199\u7684\u662f\u5565\u6211\u6839\u672c\u5bf9\u5e94\u4e0d\u4e0a\u554a...QWQ \u6211\u592a\u83dc\u4e86\uff09\n\n\n\n\u7136\u540e\u7684\u8bdd\u591a\u70b9\u6c42\u503c\u5e94\u8be5\u90fd\u4f1a\u5427\uff08\u6211\u4eec\u4e0a\u9762\u8bf4\u4e86\u628a \u6839\u53f7\u4e2a\u6570\u5e26\u5165\u591a\u9879\u5f0f\u6c42\u503c\u7684\u4e2b\uff09...\u4e0d\u7136\u5de6\u8f6c\u6a21\u677f\u533a\uff08\u597d\u50cf\u8fd9\u9053\u9898\u5c31\u662f \u677f\u5b50\uff1f\u3010\u96fe \uff09\n\n\u8fd9\u91cc\u6ce8\u610f\u4e00\u4e0b\uff0c\u5982\u679c\u7528\u4e86\u79e6\u4e5d\u97f6\u7b97\u6cd5\u4f18\u5316\u591a\u70b9\u6c42\u503c\u4f1a\u5feb\u4e00\u4e22\u4e22\uff08\u5927\u6982\u4f1a\u5c11\u4e2a\u5341\u5206\u4e4b\u4e00\u7684\u65f6\u95f4\uff09\uff0c\u4f46\u662f\u5faa\u73af\u5c55\u5f00\u5199\u7684\u6211\u60f3\u5410\uff0c\u786c\u751f\u751f\u591a\u4e86\u8fd9\u4e48\u591a\u7801\u91cf...\u4e8e\u662f\u61d2\u764c\u665a\u671f\u7684\u6211\u5c31\u7528\u4e86\u6700\u6734\u7d20\u7684\u505a\u6cd5...\n\n\u4e8e\u662f\u6211\u4eec\u6109\u5feb\uff08mmp\uff09 \u5730\u6284\u4e86\u4e00\u5806\u677f\u5b50\uff0c\u4ea4\u4e0a\u53bb\u53d1\u73b0 T \u5f97\u5c31\u5269\u4e00\u4e2a\u70b9\u4e86\u8036 \uff08\u4eba\u50bb\u5e38\u6570\u5927.jpg\uff09\n\n# code\n\n\u6240\u4ee5\u4e0b\u9762\u7684\u4ee3\u7801\u4ec5\u4f9b\u5a31\u4e50\uff1a\n```\n// luogu-judger-enable-o2\n//by Judge\n#pragma GCC optimize(\"Ofast\")\n#include<bits/stdc++.h>\n#define Rg register\n#define fp(i,a,b) for(Rg int i=(a),I=(b)+1;i<I;++i)\n#define fd(i,a,b) for(Rg int i=(a),I=(b)-1;i>I;--i)\n#define ll long long\n#define db double\nusing namespace std;\nconst db PI=acos(-1);\nconst int M=(1<<17)+3;\ntypedef int arr[M];\nint n,s,res,mod,d,limit,r[19][M],lg[M]; db inv[19];\ninline int Max(int x,int y){return x>y?x:y;}\ninline int mul(int x,int y){return 1ll*x*y%mod;}\ninline int dec(int x,int y){return x-y<0?x-y+mod:x-y;}\ninline int inc(int x,int y){return x+y>=mod?x+y-mod:x+y;}\ninline int qpow(int x,int p=mod-2,int s=1){\n    for(;p;p>>=1,x=mul(x,x)) if(p&1) s=mul(s,x); return s;\n}\nstruct cp{ db x,y; cp(){} cp(db xx,db yy){x=xx,y=yy;}\n    cp operator +(const cp& b)const{return cp(x+b.x,y+b.y);}\n    cp operator -(const cp& b)const{return cp(x-b.x,y-b.y);}\n    cp operator *(const cp& b)const{return cp(x*b.x-y*b.y,x*b.y+y*b.x);}\n    cp operator *(const db& b)const{return cp(x*b,y*b);}\n}w[2][M],x,y;\ninline void prep(){\n    fp(d,0,17){\n        fp(i,1,(1<<d)-1) r[d][i]=(r[d][i>>1]>>1)|((i&1)<<(d-1));\n        lg[1<<d]=d,inv[d]=(db)1.0/(1<<d);\n    }\n    for(int i=1,d=0;i<131072;i<<=1,++d) fp(k,0,i-1){\n        w[1][i+k]=cp(cos(PI*k*inv[d]),sin(PI*k*inv[d]));\n        w[0][i+k]=cp(cos(PI*k*inv[d]),-sin(PI*k*inv[d]));\n    }\n}\ninline void FFT(cp* a,int tp){\n    fp(i,0,limit-1) if(i<r[d][i]) swap(a[i],a[r[d][i]]);\n    for(int mid=1;mid<limit;mid<<=1){\n        for(int j=0;j<limit;j+=mid<<1)\n            for(int k=0;k<mid;++k)\n                x=a[j+k],y=w[tp][mid+k]*a[j+k+mid],\n                a[j+k]=x+y,a[j+k+mid]=x-y;\n    } if(tp) return ;\n    fp(i,0,limit-1) a[i]=a[i]*inv[d];\n}\ninline void MTT(int* a,int* b,int len,int* c){\n    limit=len<<1,d=lg[limit];\n    static cp A[M],B[M],C[M],D[M],F[M],G[M],H[M];\n    fp(i,0,len-1){\n        A[i].x=a[i]>>16,B[i].x=a[i]&65535,\n        C[i].x=b[i]>>16,D[i].x=b[i]&65535,\n        A[i].y=B[i].y=C[i].y=D[i].y=0;\n    } fp(i,len,limit-1) A[i]=B[i]=C[i]=D[i]=cp(0,0);\n    FFT(A,1),FFT(B,1),FFT(C,1),FFT(D,1);\n    fp(i,0,limit-1) F[i]=A[i]*C[i],G[i]=A[i]*D[i]+B[i]*C[i],H[i]=B[i]*D[i];\n    FFT(F,0),FFT(G,0),FFT(H,0);\n    fp(i,0,limit-1) c[i]=((((ll)(F[i].x+0.5)%mod<<16)%mod<<16)+((ll)(G[i].x+0.5)<<16)+((ll)(H[i].x+0.5)))%mod;\n}\nvoid get_inv(int* a,int* b,int n){\n    if(n==1) return b[0]=qpow(a[0]),void();\n    get_inv(a,b,n>>1); static int A[M],B[M];\n    MTT(a,b,n,A),MTT(A,b,n,B);\n    fp(i,0,n-1) b[i]=dec(inc(b[i],b[i]),B[i]);\n}\nstruct node{ node *lc,*rc; vector<int> vec; int deg;\n    inline void MOD(const int* a,int* r,int n){\n        static int A[M],B[M],D[M]; int m=deg;\n        for(limit=1;limit<n-m;limit<<=1);\n        fp(i,0,n) A[i]=a[n-i]; fp(i,0,m) B[i]=vec[m-i];\n        fp(i,n-deg+1,limit-1) B[i]=0; get_inv(B,D,limit);\n        fp(i,n-m+1,limit-1) A[i]=D[i]=0;\n        MTT(A,D,limit,A),reverse(A,A+n-m+1);\n        for(limit=1;limit<=Max(n-m,m);limit<<=1);\n        fp(i,0,m) B[i]=vec[i]; fp(i,m+1,limit-1) B[i]=0;\n        fp(i,n-m+1,limit-1) A[i]=0; MTT(A,B,limit,A);\n        fp(i,0,deg-1) r[i]=dec(a[i],A[i]);\n    }\n    inline void Mul(){ static int A[M],B[M];\n        deg=lc->deg+rc->deg,vec.resize(deg+1); for(limit=1;limit<=deg;limit<<=1);\n        fp(i,0,lc->deg) A[i]=lc->vec[i]; fp(i,lc->deg+1,limit-1) A[i]=0;\n        fp(i,0,rc->deg) B[i]=rc->vec[i]; fp(i,rc->deg+1,limit-1) B[i]=0;\n        MTT(A,B,limit,A);\n        fp(i,0,deg) vec[i]=A[i];\n    }\n}pool[M],*rt,*RT;\nint A[M],a[M],tot;\ninline node* newnode(){return &pool[tot++];}\ninline void solv(node* &p,int l,int r){ p=newnode();\n    if(l==r) return p->deg=1,p->vec.resize(2),p->vec[0]=a[l],p->vec[1]=1,void();\n    int mid=(l+r)>>1; solv(p->lc,l,mid),solv(p->rc,mid+1,r),p->Mul(); fp(i,0,p->deg) if(p->vec[i]<0) puts(\"!!!\");\n}\ninline void calc(node* p,int l,int r,const int *A){\n    if(r-l<=400){  //\u66b4\u529b\u79e6\u4e5d\u97f6\u4f18\u5316 \n        fp(i,l,r){ int x=a[i],now=A[r-l];\n            fd(j,r-l-1,0) now=inc(mul(now,x),A[j]);\n            res=mul(res,now);\n        } return ;\n    } int mid=(l+r)>>1,b[p->deg+1]; // \u4e00\u8fb9\u53d6\u6a21\u4e00\u8fb9\u9012\u5f52  \n    p->lc->MOD(A,b,p->deg-1),calc(p->lc,l,mid,b);\n    p->rc->MOD(A,b,p->deg-1),calc(p->rc,mid+1,r,b);\n}\nint main(){ cin>>n>>mod,res=1,s=sqrt(n),prep();\n    fp(i,1,s) a[i]=i-1; solv(RT,1,s);\n    fp(i,1,s) a[i]=mod-((i-1)*s+1); solv(rt,1,s);\n    fp(i,0,s) A[i]=RT->vec[i];\n    rt->MOD(A,A,s);\n    fp(i,1,s) a[i]=(i-1)*s+1;\n    calc(rt,1,s,A);\n    fp(i,s*s+1,n) res=mul(res,i);\n    return !printf(\"%d\\n\",res);\n}\n```\n\n\u53c8 $T$ \u53c8 $RE$ $.jpg$\n\n\n\u4f46\u662f\u80fd\u8fc7\u7684\u4ee3\u7801\u4e5f\u662f\u6709\u7684\uff1a\n\n\uff08\u65e0\u803b\u7684\u5077\u4e86\u5927\u4f6c\u7684\u4ee3\u7801\uff09\n\n```\n//minamoto\n#include<bits/stdc++.h>\n#define R register\n#define ll long long\n#define III __int128\n#define fp(i,a,b) for(R int i=(a),I=(b)+1;i<I;++i)\n#define fd(i,a,b) for(R int i=(a),I=(b)-1;i>I;--i)\n#define go(u) for(int i=head[u],v=e[i].v;i;i=e[i].nx,v=e[i].v)\nusing namespace std;\nconst int N=(1<<17)+5;const double Pi=acos(-1.0);\nint P;III zero;\ninline int add(R int x,R int y){return 1ll*x+y>=P?1ll*x+y-P:x+y;}\ninline int dec(R int x,R int y){return 1ll*x-y<0?1ll*x-y+P:x-y;}\ninline int mul(R int x,R int y){return 1ll*x*y-1ll*x*y/P*P;}\nint ksm(R int x,R int y){\n    R int res=1;\n    for(;y;y>>=1,x=mul(x,x))(y&1)?res=mul(res,x):0;\n    return res;\n}\nstruct cp{\n    double x,y;\n    cp(){}\n    cp(R double xx,R double yy):x(xx),y(yy){}\n    inline cp operator +(const cp &b)const{return cp(x+b.x,y+b.y);}\n    inline cp operator -(const cp &b)const{return cp(x-b.x,y-b.y);}\n    inline cp operator *(const cp &b)const{return cp(x*b.x-y*b.y,x*b.y+y*b.x);}\n    inline cp operator *(const double &b)const{return cp(x*b,y*b);}\n    inline cp operator ~()const{return cp(x,-y);}\n}w[2][N];\nint r[21][N],lg[N];double inv[21];\nvoid Pre(){\n    fp(d,0,17){\n        fp(i,1,(1<<d)-1)r[d][i]=(r[d][i>>1]>>1)|((i&1)<<(d-1));\n        lg[1<<d]=d,inv[d]=1.0/(1<<d);\n    }\n    for(R int i=1,d=0;i<131072;i<<=1,++d)fp(k,0,i-1){\n        w[1][i+k]=cp(cos(Pi*k*inv[d]),sin(Pi*k*inv[d])),\n        w[0][i+k]=cp(cos(Pi*k*inv[d]),-sin(Pi*k*inv[d]));\n    }\n}\nint lim,d;\nvoid FFT(cp *A,int ty){\n    fp(i,0,lim-1)if(i<r[d][i])swap(A[i],A[r[d][i]]);\n    cp t;\n    for(R int mid=1;mid<lim;mid<<=1)\n        for(R int j=0;j<lim;j+=(mid<<1))\n            fp(k,0,mid-1)\n                A[j+k+mid]=A[j+k]-(t=A[j+k+mid]*w[ty][mid+k]),\n                A[j+k]=A[j+k]+t;\n    if(!ty)fp(i,0,lim-1)A[i]=A[i]*inv[d];\n}\nvoid MTT(int *a,int *b,int len,int *c){\n    static cp f[N],g[N],p[N],q[N];\n    lim=(len<<1),d=lg[lim];\n    fp(i,0,len-1)f[i]=cp(a[i]>>15,a[i]&32767),g[i]=cp(b[i]>>15,b[i]&32767);\n    fp(i,len,lim-1)f[i]=g[i]=cp(0,0);\n    FFT(f,1),FFT(g,1);\n    fp(i,0,lim-1){\n        cp t,f0,f1,g0,g1;\n        t=~f[i?lim-i:0],f0=(f[i]-t)*cp(0,-0.5),f1=(f[i]+t)*0.5;\n        t=~g[i?lim-i:0],g0=(g[i]-t)*cp(0,-0.5),g1=(g[i]+t)*0.5;\n        p[i]=f1*g1,q[i]=f1*g0+f0*g1+f0*g0*cp(0,1);\n    }\n    FFT(p,0),FFT(q,0);\n    fp(i,0,lim-1)c[i]=(((ll)(p[i].x+0.5)%P<<30)+((ll)(q[i].x+0.5)<<15)+((ll)(q[i].y+0.5)))%P;\n}\nvoid Inv(int *a,int *b,int len){\n    if(len==1)return b[0]=ksm(a[0],P-2),void();\n    Inv(a,b,len>>1);\n    static int c[N],d[N];\n    MTT(a,b,len,c),MTT(c,b,len,d);\n    fp(i,0,len-1)b[i]=dec(add(b[i],b[i]),d[i]);\n}\nstruct node{\n    node *lc,*rc;vector<int>vec;int deg;\n    void Mod(const int *a,int *r,int n){\n        static int A[N],B[N],D[N];\n        int len=1;while(len<=n-deg)len<<=1;\n        fp(i,0,n)A[i]=a[n-i];fp(i,0,deg)B[i]=vec[deg-i];\n        fp(i,n-deg+1,len-1)B[i]=0;\n        Inv(B,D,len);\n        fp(i,n-deg+1,len-1)A[i]=D[i]=0;\n        MTT(A,D,len,A);\n        reverse(A,A+n-deg+1);\n        len=1;while(len<=max(n-deg,deg))len<<=1;\n        fp(i,0,deg)B[i]=vec[i];fp(i,deg+1,len-1)B[i]=0;\n        fp(i,n-deg+1,len-1)A[i]=0;\n        MTT(A,B,len,A);\n        fp(i,0,deg-1)r[i]=dec(a[i],A[i]);\n    }\n    void Mul(){\n        static int A[N],B[N];deg=lc->deg+rc->deg,vec.resize(deg+1);\n        int len=1;while(len<=max(lc->deg,rc->deg))len<<=1;\n        fp(i,0,lc->deg)A[i]=lc->vec[i];fp(i,lc->deg+1,len-1)A[i]=0;\n        fp(i,0,rc->deg)B[i]=rc->vec[i];fp(i,rc->deg+1,len-1)B[i]=0;\n        MTT(A,B,len,A);\n        fp(i,0,deg)vec[i]=A[i];\n    }\n}pool[N<<1],*rt,*qwq,*pp=pool;\nint A[N],a[N];\nvoid solve(node* &p,int l,int r){\n    p=pp++;\n    if(l==r)return p->deg=1,p->vec.resize(2),p->vec[0]=a[l],p->vec[1]=1,void();\n    int mid=(l+r)>>1;\n    solve(p->lc,l,mid),solve(p->rc,mid+1,r);\n    p->Mul();\n}\nint b[25],res;\nvoid calc(node *p,int l,int r,const int *A){\n    if(r-l<=512){\n        fp(i,l,r){\n            int x=a[i],c1,c2,c3,c4,now=A[r-l];\n            b[0]=1;fp(j,1,16)b[j]=mul(b[j-1],x);\n            for(R int j=r-l-1;j-15>=0;j-=16){\n                c1=(zero+1ll*now*b[16]+1ll*A[j]*b[15]+1ll*A[j-1]*b[14]+1ll*A[j-2]*b[13])%P,\n                c2=(zero+1ll*A[j-3]*b[12]+1ll*A[j-4]*b[11]+1ll*A[j-5]*b[10]+1ll*A[j-6]*b[9])%P,\n                c3=(zero+1ll*A[j-7]*b[8]+1ll*A[j-8]*b[7]+1ll*A[j-9]*b[6]+1ll*A[j-10]*b[5])%P,\n                c4=(zero+1ll*A[j-11]*b[4]+1ll*A[j-12]*b[3]+1ll*A[j-13]*b[2]+1ll*A[j-14]*b[1])%P,\n                now=(0ll+c1+c2+c3+c4+A[j-15])%P;\n            }\n            fd(j,(r-l)%16-1,0)now=(1ll*now*x+A[j])%P;\n            res=mul(res,now);\n        }\n        return;\n    }\n    int mid=(l+r)>>1,b[p->deg+1];\n    p->lc->Mod(A,b,p->deg-1),calc(p->lc,l,mid,b);\n    p->rc->Mod(A,b,p->deg-1),calc(p->rc,mid+1,r,b);\n}\nint n,s;\nint main(){\n    scanf(\"%d%d\",&n,&P),res=1,s=sqrt(n),Pre(),zero=0;\n    fp(i,1,s)a[i]=i-1;solve(qwq,1,s);\n    fp(i,1,s)a[i]=P-((i-1)*s+1);solve(rt,1,s);\n    fp(i,0,s)A[i]=qwq->vec[i];\n    rt->Mod(A,A,s);\n    fp(i,1,s)a[i]=(i-1)*s+1;\n    calc(rt,1,s,A);\n    fp(i,s*s+1,n)res=mul(res,i);\n    printf(\"%d\\n\",res);\n    return 0;\n}\n```\n\n\u8bdd\u8bf4\u8fd9\u4e2a MTT \u53f3\u79fb 15 \u4f4d\u771f\u7684\u53ef\u4ee5\u7684\u4e48\uff1f\u6216\u8005\u662f\u6ca1\u6709\u70b8\u7cbe\u5ea6\u5427...\uff0c\u4f46\u4f60\u53ef\u4ee5\u770b\u5230\u5c31\u7b97\u662f\u5361\u5e38\u5de8\u4f6c\u4e5f\u53ea\u662f\u8270\u96be\u5361\u8fc7...\u6240\u4ee5\u8fd9\u4e2a\u505a\u6cd5\u5c31...\u4e0b\u4e00\u4e2a\uff01\n\n\n\n\n# solve2\n\n\u4e0a\u4e00\u79cd\u505a\u6cd5...\u53cd\u6b63\u6211\u662f\u8fc7\u4e0d\u4e86\u7684\uff0c\u60f9\u4e0d\u8d77\u60f9\u4e0d\u8d77...\n\n\u4e8e\u662f\u6211\u4eec\u8003\u8651\u7528\u53e6\u5916\u4e00\u79cd\u795e\u4ed9\u7684\u500d\u589e\u505a\u6cd5\uff08\u867d\u8bf4\u6211\u5e76\u770b\u4e0d\u61c2...\uff09\n\n\u6240\u4ee5\u53ef\u4ee5\u770b\u8fd9\u4f4d\u5927\u4ed9\u7684\uff1f[\u867d\u8bf4\u91cc\u9762\u6709\u4e9b\u6253\u9519\u7684 $\\LaTeX$\u516c\u5f0f\u5c31\u662f\u4e86](https://www.cnblogs.com/bztMinamoto/p/10661226.html)\n\n\u505a\u6cd5\u8fd8\u662f\u4ee4 $F_s(x)=\\prod_{i=1}^{s}(x+i)$\n\n\u7136\u540e\u6c42\u51fa $F_s(0,s,2s,...,s* s-s)$ \uff0c\u7136\u540e\u91cd\u70b9\u5c31\u662f\u8981\u7528\u500d\u589e\u4ece $F_d$ \u5f97\u5230 $F_{2d}$ \uff0c\u7136\u540e\u505a\u6cd5\u6211\u5c31\u662f\u771f\u7684\u770b\u4e0d\u61c2\u4e86QWQ \n\n\u8c8c\u4f3c\u662f\u8fd9\u6837\u7684\uff0c\u6211\u4eec\u8981\u8003\u8651\u4e24\u4e2a\u4e1c\u897f\uff1a\n\n1. \u5df2\u77e5 $F_d(0,...,ds)$ \u6c42 $F_{d+1}(0,...,(d+1)s)$\n\n2. \u5df2\u77e5 $F_d(0,...,ds)$ \u6c42 $F_{2d}(0,...,2ds)$\n\n**\u7136\u540e\u4e3a\u4e86\u5f0f\u5b50\u63a8\u5bfc\u65b9\u4fbf\uff0c\u6211\u4eec\u5728\u8fd9\u91cc\u8bbe $G(x)=F_{d}(xs)$**\n\n\u6ce8\u610f\uff0c\u4e0a\u9762\u7684\u5c0f\u62ec\u53f7\u5185\u662f\u4e2a\u7b49\u5dee\u6570\u5217\uff0c\u516c\u5dee\u4e3a s \uff0c\u81f3\u4e8e\u4e0b\u9762\u7684 F \u4e2d\u7684\u6570\u5217\u516c\u5dee\u90fd\u662f s \uff0c G \u4e2d\u7684\u516c\u5dee\u4e3a 1\n\n---\n\n\u7b2c\u4e00\u4e2a\u5f88\u597d\u6c42\uff0c\u76f4\u63a5  $F_{d+1}(x)=F_d(x)(x+d+1)$ \u5c31\u597d\u4e86\uff0c\u591a\u51fa\u6765\u7684 $F_{d+1}((d+1)s)$ \u66b4\u529b\u6c42\n\n---\n\n\u81f3\u4e8e\u7b2c\u4e8c\u4e2a\u5c31\u7070\u5e38\u9ebb\u70e6\u4e86...\n\n\n\u9996\u5148\u6211\u4eec\u8003\u8651 $F_d(0,...,ds)$ \u5230 $F_d(0,...,2ds)$ \u7684\u8f6c\u79fb\uff1a\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u524d\u9762 d \u9879\u6211\u4eec\u5df2\u77e5\u4e86\uff0c\u6240\u4ee5\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u8981\u6c42\u51fa\uff1a$F_d((d+1)s,...,2ds)$\n\n\u90a3\u4e48\u6211\u4eec\u7684\u4eba\u7269\u4e5f\u5c31\u662f\uff1a\n\n>\u5df2\u77e5 $F_d(0,...,ds)$ \uff0c\u5373 $G(1,...,d)$\n\n>\u6c42 $F_d((d+1)s,...,2ds)$ \uff0c\u5373 $G(d+1,...,2d)$ \n\n\n---\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u4ece $F_d(0,...,2ds)$ \u5230 $F_{2d}(0,...,2ds)$\u7684\u8f6c\u79fb\uff1a\n\n\n\n\u53ef\u4ee5\u53d1\u73b0\uff1a $F_{2d}(xs)=F_d(xs)F_d(xs+d)$\uff0c\u4e5f\u5c31\u662f\uff1a\n\n$$F_{2d}(xs)=G(x)G(x+{d\\over s})$$\n\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u73b0\u5728\u7684\u4efb\u52a1\u662f\uff1a\n\n>\u5df2\u77e5 $F_d(0,...,2ds)$ \uff0c\u5373 $G(1,...,2d)$\n\n>\u6c42 $F_d(d,...,2ds+d)$ \uff0c\u5373 $G(1+{d\\over s} ,...,2d+{d\\over s})$\n\n\u6211\u4eec\u53d1\u73b0\u4e0a\u9762\u4e24\u4e2a  **\u5df2\u77e5...\u6c42...** \u672c\u8d28\u662f\u4e00\u6837\u7684\uff0c\u90fd\u662f G \u4e2d\u52a0\u4e0a\u4e86\u4e00\u4e2a\u5e38\u6570\uff0c\u4e5f\u5c31\u662f\u5df2\u77e5 $G(x)$ \u6c42 $G(x+m)$ \uff0c\u5176\u4e2d m \u662f\u7ed9\u5b9a\u7684\u5e38\u91cf\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u600e\u4e48\u6c42\u51fa\u8fd9\u4e2a\u4e1c\u897f\uff08\u5f53\u7136\u662f\u7528\u591a\u9879\u5f0f\u54af~\uff09\n\n\u7528\u5230\u4e4b\u524d\u8bf4\u8981\u7528\u7684\u62c9\u683c\u6717\u65e5\u63d2\u503c\u6cd5\uff1a\n\n$$h(m+k)=\\sum_{i=1}^nh(i)\\prod_{j\u2260i} {m+k-j\\over i-j}$$\n\n$$=\\Big(\\prod_{j=0}^n (m+k-j)\\Big)      \\sum_{i=0}^d h{h(i)\\over i!(d-i)! (-1)^{d-i}}{1\\over m+k-i}$$\n\n\u6211\u4eec\u53d1\u73b0\u540e\u9762\u7684\u8868\u8fbe\u5f0f\u662f\u5377\u79ef\u7684\u5f62\u5f0f\u554a...\n\n\u81f3\u4e8e\u540e\u9762\u7684\u90a3\u4e2a n \u662f\u54ea\u91cc\u6765\u7684\uff0c\u4ee5\u53ca i \u4e3a\u4ec0\u4e48\u4ece 1 \u5230 d \u800c\u4e0d\u662f n \u4ec0\u4e48\u7684\u5c31\u4e0d\u7ba1\u5566\uff0c\u627e bzt \u5927\u4ed9\u95ee\u53bb\u5427~\uff08\u75af\u72c2\u7529\u9505\uff09\n\n\n\u7136\u540e\u6309 bzt \u5927\u4ed9\u8bf4\u7684\uff1a\n\n\u9996\u5148\u8fd9\u91cc\u7684\u9006\u5143\u662f O(n) \u6c42\u7684\uff08\u6765\u505a\u8fd9\u9053\u9898\u7684\u4eba\u90fd\u77e5\u9053\uff09\n\n\u5176\u6b21\u5c31\u662f\u5377\u79ef\u65f6\u8981\u591a\u9879\u5f0f\u5e73\u79fb...\uff08\u8fd9\u4e2a\u8be1\u5f02\u7684\u79d1\u6280...\uff09\n\n# Upd (4.23)\n\n\u5173\u4e8e\u4ee3\u7801\u4e2d main \u51fd\u6570\u90e8\u5206\u6709\u4e00\u4e2a\u5224\u65ad...\n\n\u8fd9\u4e2a\u5224\u65ad\u662f\u7528\u4e86\u5a01\u5c14\u900a\u5b9a\u7406\u4f18\u5316\u7684...\n\n\u53ef\u4ee5\u5eb7\u5eb7[\u6211\u7684blog](https://www.cnblogs.com/Judge/p/10755703.html)\uff1f\n\n\u5177\u4f53\u4ee3\u7801\u5b9e\u73b0\u8fd9\u91cc\u4e5f\u6709...\n\n# code\n\n\u660e\u660e\u4e0d\u77e5\u9053\u4ee3\u7801\u5728\u5199\u4e9b\u5565\u8fd8\u662f\u65e0\u803b\u5730\u8d34\u4e86\u4e0a\u6765.jpg\n\n```\n//by Judge\n#pragma GCC optimize(\"Ofast\")\n#include<bits/stdc++.h>\n#define Rg register\n#define fp(i,a,b) for(Rg int i=(a),I=(b)+1;i<I;++i)\n#define fd(i,a,b) for(Rg int i=(a),I=(b)-1;i>I;--i)\n#define ll long long\n#define db double\nusing namespace std;\nconst db PI=acos(-1);\nconst int M=(1<<17)+3;\ntypedef int arr[M];\nint n,s,res,mod,d,limit; db iv[19];\narr r[19],lg,inv,ifac;\ninline int mul(int x,int y){return 1ll*x*y%mod;}\ninline int dec(int x,int y){return x-y<0?x-y+mod:x-y;}\ninline int inc(int x,int y){return 0ll+x+y>=mod?0ll+x+y-mod:x+y;}\ninline int qpow(int x,int p=mod-2,int s=1){\n\tfor(;p;p>>=1,x=mul(x,x)) if(p&1) s=mul(s,x); return s;\n}\nstruct cp{ db x,y; cp(){} cp(db xx,db yy){x=xx,y=yy;}\n\tcp operator +(const cp& b)const{return cp(x+b.x,y+b.y);}\n\tcp operator -(const cp& b)const{return cp(x-b.x,y-b.y);}\n\tcp operator *(const cp& b)const{return cp(x*b.x-y*b.y,x*b.y+y*b.x);}\n\tcp operator *(const db& b)const{return cp(x*b,y*b);}\n\tcp operator ~()const{return cp(x,-y);}\n}w[2][M],x,y;\ninline void prep(){\n\tfp(d,0,17){\n\t\tfp(i,1,(1<<d)-1) r[d][i]=(r[d][i>>1]>>1)|((i&1)<<(d-1));\n\t\tlg[1<<d]=d,iv[d]=(db)1.0/(1<<d);\n\t} inv[0]=inv[1]=ifac[0]=ifac[1]=1;\n\tfp(i,2,131072) inv[i]=mul(mod-mod/i,inv[mod%i]),ifac[i]=mul(ifac[i-1],inv[i]);\n\tfor(int i=1,d=0;i<131072;i<<=1,++d) fp(k,0,i-1){\n\t\tw[1][i+k]=cp(cos(PI*k*iv[d]),sin(PI*k*iv[d]));\n\t\tw[0][i+k]=cp(cos(PI*k*iv[d]),-sin(PI*k*iv[d]));\n\t}\n}\ninline void prep(){ inv[0]=inv[1]=ifac[0]=ifac[1]=1;\n\tfp(d,0,17){ lg[1<<d]=d,iv[d]=(db)1.0/(1<<d);\n\t\tfp(i,1,(1<<d)-1) r[d][i]=(r[d][i>>1]>>1)|((i&1)<<(d-1));\n\t}\n\tfp(i,2,131072) inv[i]=mul(mod-mod/inv[mod%i]),ifac[i]=mul(ifac[i-1],inv[i]);\n\tfor()\n}\ninline void FFT(cp* a,int tp){\n\tfp(i,0,limit-1) if(i<r[d][i]) swap(a[i],a[r[d][i]]);\n\tfor(int mid=1;mid<limit;mid<<=1)\n\t\tfor(int j=0;j<limit;j+=mid<<1) for(int k=0;k<mid;++k)\n\t\t\tx=a[j+k],y=w[tp][mid+k]*a[j+k+mid],a[j+k]=x+y,a[j+k+mid]=x-y;\n\tif(!tp) fp(i,0,limit-1) a[i]=a[i]*iv[d];\n}\ninline void MTT(int* a,int* b,int len,int* c){\n\tstatic cp f[M],g[M],p[M],q[M]; limit=len,d=lg[limit];\n\tfp(i,0,len-1) f[i]=cp(a[i]>>16,a[i]&65535),g[i]=cp(b[i]>>16,b[i]&65535);\n\tfp(i,len,limit-1) f[i]=g[i]=cp(0,0); FFT(f,1),FFT(g,1);\n\tfp(i,0,limit-1){ cp t,f0,f1,g0,g1;\n\t\tt=~f[i?limit-i:0],f0=(f[i]-t)*cp(0,-0.5),f1=(f[i]+t)*0.5;\n\t\tt=~g[i?limit-i:0],g0=(g[i]-t)*cp(0,-0.5),g1=(g[i]+t)*0.5;\n\t\tp[i]=f1*g1,q[i]=f1*g0+f0*g1+f0*g0*cp(0,1);\n\t} FFT(p,0),FFT(q,0);\n\tfp(i,0,limit-1) c[i]=((((ll)(p[i].x+0.5)%mod<<16)%mod<<16)+((ll)(q[i].x+0.5)<<16)+((ll)(q[i].y+0.5)))%mod;\n}\ninline void calc(int* a,int* b,int n,int k){\n\tstatic int f[M],g[M],h[M],sum[M],isum[M],len;\n\tfor(len=1;len<=n<<1;len<<=1);\n\tfp(i,0,n) f[i]=mul(a[i],mul(ifac[i],ifac[n-i]));\n\tfor(int i=n-1;i>=0;i-=2) f[i]=mod-f[i];\n\tint t=dec(k,n); fp(i,0,n<<1) g[i]=inc(i,t);\n\tsum[0]=g[0]; fp(i,1,n<<1) sum[i]=mul(sum[i-1],g[i]);\n\tisum[n+n]=qpow(sum[n+n]);\n\tfd(i,n<<1,1) isum[i-1]=mul(isum[i],g[i]);\n\tfp(i,1,n<<1) g[i]=mul(isum[i],sum[i-1]); g[0]=isum[0];\n\tfp(i,n+1,len-1) f[i]=0; fp(i,n<<1|1,len-1) g[i]=0;\n\t\n\tMTT(f,g,len,h);\n\tint  res=1,p1=k-n,p2=k;\n\tfp(i,p1,p2) res=mul(res,i);\n\t\n\tfp(i,0,n) g[i]=inc(mod,inc(p1,i));\n\tsum[0]=g[0]; fp(i,1,n) sum[i]=mul(sum[i-1],g[i]);\n\tisum[n]=qpow(sum[n]);\n\tfd(i,n,1) isum[i-1]=mul(isum[i],g[i]);\n\tfp(i,1,n) g[i]=mul(isum[i],sum[i-1]); g[0]=isum[0];\n\t\n\tfor(int i=0;i<=n;++i,p2=inc(p2,1))\n\t\tb[i]=mul(h[i+n],res),res=mul(res,mul(g[i],p2+1));\n}\ninline int solv(int bl){ static int a[M],b[M];\n\tint s=0; for(int p=bl;p;p>>=1) ++s; a[0]=1,--s;\n\tint x=qpow(bl);\n\tfor(int p=0;s>=0;--s){\n\t\tif(p){\n\t\t\tcalc(a,b,p,p+1);\n\t\t\tfp(i,0,p) a[p+1+i]=b[i]; a[p<<1|1]=0;\n\t\t\tcalc(a,b,p<<1,mul(p,x));\n\t\t\tp<<=1; fp(i,0,p) a[i]=mul(a[i],b[i]);\n\t\t}\n\t\tif(bl>>s&1){\n\t\t\tfp(i,0,p) a[i]=mul(a[i],inc(mul(bl,i),p+1));\n\t\t\tp|=1,a[p]=1;\n\t\t\tfp(i,1,p) a[p]=mul(a[p],inc(mul(bl,p),i));\n\t\t}\n\t} int res=1;\n\tfp(i,0,bl-1) res=mul(res,a[i]);\n\treturn res;\n}\ninline int GetFac(int n){\n\tint s=sqrt(n),res=solv(s);\n\tfp(i,s*s+1,n) res=mul(res,i);\n\treturn res;\n}\nint main(){ cin>>n>>mod,prep();\n\tif(n>mod-1-n){ int res=qpow(GetFac(mod-1-n));\n\t\treturn !printf(\"%d\\n\",n&1?res:mod-res);\n\t} return !printf(\"%d\\n\",GetFac(n));\n}\n```\n\n\n\u6211\u592a\u83dc\u4e86.jpg\n\n\n",
        "postTime": 1554554375,
        "uid": 38576,
        "name": "J\u03bcdge",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5282 \u3010\u3010\u6a21\u677f\u3011\u5feb\u901f\u9636\u4e58\u7b97\u6cd5\u3011"
    },
    {
        "content": "~~\u76f8\u4fe1\u5f88\u591a\u4eba\u90fd\u60f3\u5230\u4e86 $O(n)$ \u7684\u89e3\u6cd5\uff1a\u8fde\u7740\u4e58\u3002\u6b64\u505a\u6cd5\u53ef\u4ee5\u67e5\u770b @bh1234666 \u7684\u535a\u5ba2\u83b7\u5f97\u66f4\u591a\u4fe1\u606f\u3002~~\n\n\u89c2\u5bdf\u9898\u76ee\u6570\u636e\u53ef\u4ee5\u53d1\u73b0\uff1a\u672c\u9898\u9700\u8981\u4e00\u4e2a\u4f4e\u4e8e $O(n)$ \u7684\u89e3\u6cd5\u3002\n\n\u6211\u4eec\u5148\u8bbe $s=\\lfloor\\sqrt n\\lfloor$ \u4e14 $f(x)=\\prod_{i=1}^s{x+i}$\uff0c\u90a3\u4e48\n$$\nn!\\equiv (\\prod_{i=0}^{s-1}f(is))\\times\\prod_{i=s^2+1}^{n}i\\pmod p\n$$\n\u5176\u4e2d $\\prod_{i=s^2+1}^{n}i$ \u53ef\u5728 $O(\\sqrt n)$ \u5185\u5b8c\u6210\u3002\u6211\u4eec\u5e0c\u671b\u5feb\u901f\u8ba1\u7b97 $\\prod_{i=0}^{s-1}f(is)$\u3002\n\n## $O(\\sqrt n\\log^2 n)$ \u7684\u505a\u6cd5\n\n\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u591a\u9879\u5f0f\u8fde\u7eed\u70b9\u503c\u5e73\u79fb\u5728 $O(s\\log s)$ \u5f97\u5230 $f(x)$ \u7684\u5404\u9879\u7cfb\u6570\uff0c\u4f46\u662f\u901a\u8fc7\u591a\u9879\u5f0f\u591a\u70b9\u6c42\u503c\u5f97\u5230 $f(0),f(s),f(2s),\\cdots,f(s^2-s)$ \u9700\u8981 $O(s\\log^2 s)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002\u4e8e\u662f\u6574\u4f53\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\sqrt n\\log^2 n)$\u3002\n\n## $O(\\sqrt n\\log n)$ \u7684\u505a\u6cd5\n\n\u4ee4 $f_j(x)=\\prod_{i=1}^j(x+i)$\u3002\u901a\u8fc7\u500d\u589e\u5373\u53ef\u6c42\u51fa $\\prod_{i=0}^{s-1}f(is)$\u3002\n\n- \u500d\u589e\u65b9\u7a0b1\uff08\u4e58\u4ee5 $2$\uff09\n\n$$\n\\begin{aligned}\nf_{2j}(x)&=\\prod_{i=1}^{2j}(x+i)\\\\\n&=\\prod_{i=1}^j(x+i)\\times\\prod_{i=j+1}^{2j}(x+i)\\\\\n&=\\prod_{i=1}^j(x+i)\\times\\prod_{i=1}^j(x+j+i)\\\\\n&=f_j(x)\\times f_j(j+x)\n\\end{aligned}\n$$\n\n\u73b0\u5728\u770b\u600e\u4e48\u8ba1\u7b97\u3002\u8bbe $g(x)=f_j(sx)$\uff0c\u5219\uff1a\n\n1. \u73b0\u6709\u7684\u70b9\u503c\u662f $g(0),g(1),\\cdots,g(j)$\uff08\u5373 $f_j(0),f_j(s),\\cdots,f_j(js)$\uff09\u3002\n2. \u901a\u8fc7\u591a\u9879\u5f0f\u8fde\u7eed\u70b9\u503c\u5e73\u79fb\u5f97\u5230 $g(j+1),g(j+2),\\cdots,g(2j+1)$\uff08\u8fd9\u91cc\u7531\u4e8e\u8981\u6c42\u533a\u95f4\u4e0d\u91cd\u53e0\uff0c\u4f1a\u591a\u5e73\u79fb\u51fa\u4e00\u4e2a $g(2j+1)$\uff0c\u5426\u5219\u4f1a\u56e0\u4e3a\u9664\u4ee5\u96f6\u5bc4\u6389\uff09\u3002\n3. \u5c06\u5176\u62fc\u63a5\u540e\u5f97\u5230 $g(0),g(1),\\cdots,g(2j)$\uff08\u5373 $f_j(0),f_j(0+s),\\cdots,f_j(0+2js)$\uff09\u3002\n4. \u518d\u6b21\u7ecf\u8fc7\u5e73\u79fb\u540e\u5f97\u5230 $g(0+\\dfrac{j}{s}),g(1+\\dfrac{j}{s}),\\cdots,g(2j+\\dfrac{j}{s})$\uff08\u5373 $f_j(j),f_j(j+s),\\cdots,f_j(j+2js)$\uff09\u3002\n5. \u4e58\u8d77\u6765\u5373\u5f97 $f_{2j}(0),f_{2j}(s),\\cdots,f_{2j}(2js)$\u3002\n\n- \u500d\u589e\u65b9\u7a0b2\uff08\u52a0\u4e0a $1$\uff09\n\n\u76f4\u63a5\u66b4\u529b\u70b9\u4e58\u5c31\u53ef\u4ee5\u4e86\u3002\n$$\n\\begin{aligned}\nf_{j+1}(x)&=\\prod_{i=1}^{j+1}(x+i)\\\\\n&=\\prod_{i=1}^j(x+i)\\times(x+j+1)\\\\\n&=f_j(x)\\times(x+j+1)\n\\end{aligned}\n$$\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u500d\u589e\u4e86\u3002\n\n\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97 $s$ \u4e2a\u70b9\u503c\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(s\\log s)=O(\\sqrt n\\log n)$\u3002\n\n\u4e0a\u4ee3\u7801\uff1a\n\n```cpp\n// dill\ninline int solve(int n, int p) {\n\tstatic vector<int> f, fd, st;\n\tst.resize(log2(n) + 5);\n\tf.resize(2);\n\tint top = 0;\n\tint s = n;\n\twhile (n) {\n\t\tst[++top] = n;\n\t\tn >>= 1;\n\t}\n\tn = st[top--];\n\tf[0] = 1;\n\tf[1] = s + 1;\n\twhile (top--) {\n\t\tf.resize(f.size() << 1);\n\t\tLagrangeInterpolation_ex(n, n + 1, p, f, fd);\n\t\tstd::copy(fd.begin(), fd.end(), f.begin() + n + 1);\n\t\tf[n << 1 | 1] = 0;\n\t\tint tmp = 1ll * n * fpow(s, p - 2, p) % p;\n\t\tn <<= 1;\n\t\tLagrangeInterpolation_ex(n, tmp, p, f, fd);\n\t\tfor (int i = 0; i <= n; i++) {\n\t\t\tf[i] = 1ll * f[i] * fd[i] % p;\n\t\t}\n\t\tif (!(st[top + 1] & 1)) continue;\n\t\tfor (int i = 0; i <= n; i++) {\n\t\t\tf[i] = 1ll * f[i] * (1ll * s * i % p + n + 1) % p;\n\t\t}\n\t\tf[++n] = 1;\n\t\tfor (int i = 1; i <= n; i++) {\n\t\t\tf[n] = 1ll * f[n] * (1ll * s * n % p + i) % p;\n\t\t}\n\t}\n\tint res = f[0];\n\tfor (int i = 1; i < s; i++) {\n\t\tres = 1ll * res * f[i] % p;\n\t}\n\treturn res;\n}\ninline int factorial(int n, int p) {\n\tint tn = p - 1 - n;\n\tint res = 0;\n\tif (tn <= n) {\n\t\tres = fpow(factorial(tn, p), p - 2, p);\n\t\treturn (tn & 1) ? res : p - res;\n\t}\n\tint k = sqrt(n);\n\tres = solve(k, p);\n\tfor (int i = k * k + 1; i <= n; i++) {\n\t\tres = 1ll * res * i % p;\n\t}\n\treturn res % p;\n}\nsigned main() {\n\tint T, n, p;\n\tcin >> T;\n\twhile (T--) {\n\t\tcin >> n >> p;\n\t\tcout << factorial(n, p) << endl;\n\t}\n}\n```\n\n\u4e60\u9898\uff1a\n\n1. [\u9636\u4e58\u6a21\u5927\u8d28\u6570](https://loj.ac/p/170)\n2. [\u79fb\u6570\u5b57](http://www.51nod.com/Challenge/Problem.html#problemId=1387)",
        "postTime": 1666763163,
        "uid": 589895,
        "name": "Ruiqun2009",
        "ccfLevel": 0,
        "title": "Min_25\u7cfb\u5217\u7b2c1\u7bc7/\u9898\u89e3P5282 \u3010\u6a21\u677f\u3011\u5feb\u901f\u9636\u4e58\u7b97\u6cd5"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P5282)\n\n\u603b\u7b97\u662f\u5b66\u4f1a\u4e86\u8fd9\u4e2a\u7b97\u6cd5......\n\n---\n\n**\u3010\u524d\u7f6e\u829d\u58eb\u3011**\n--\n\n1. [\u591a\u9879\u5f0f\u4e58\u6cd5](https://www.luogu.com.cn/problem/P3803)\n2. [\u4efb\u610f\u6a21\u6570\u591a\u9879\u5f0f\u4e58\u6cd5](https://www.luogu.com.cn/problem/P4245)\n3. [\u591a\u9879\u5f0f\u8fde\u7eed\u70b9\u503c\u5e73\u79fb](https://www.luogu.com.cn/problem/P5667)\n\n\u524d\u4e24\u4e2a\u7528\u4e8e\u5904\u7406\u4efb\u610f\u6a21\u6570\u610f\u4e49\u4e0b\u7684\u591a\u9879\u5f0f\u4e58\u6cd5\uff1b\n\n\u7b2c\u4e09\u4e2a\u7528\u4e8e\u5728\u672a\u77e5\u4e00\u4e2a\u4e0d\u8d85\u8fc7 $(r-l)$ \u6b21\u7684\u591a\u9879\u5f0f\u5177\u4f53\u5f62\u5f0f\uff0c\u4f46\u5df2\u77e5\u5176\u5728\u67d0\u8fde\u7eed\u533a\u95f4 $[l,r]$ \u7684 $(r-l+1)$ \u4e2a\u70b9\u503c\u65f6\uff0c\u6c42\u51fa\u4efb\u4e00\u4e0e\u4e4b\u4e0d\u4ea4\u7684\u3001\u957f\u5ea6\u76f8\u540c\u7684\u533a\u95f4\u7684 $(r-l+1)$ \u4e2a\u70b9\u7684\u503c\u3002\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$\u3002\n\n---\n\n**\u3010\u5206\u6790\u3011**\n--\n\n\u8003\u8651\u4ee4 $s=\\lfloor\\sqrt n\\rfloor$ \uff0c\u5219 $\\displaystyle n!=\\prod_{i=1}^n i=\\prod_{i=0}^{s-1}\\prod_{t=1}^s(is+t)\\cdot \\prod_{i=s^2+1}^n i$ \u3002\n\n\u82e5\u5df2\u6c42\u51fa $\\displaystyle \\prod_{i=0}^{s-1}\\prod_{t=1}^s(is+t)$\uff0c\u5219\u540e\u9762\u7684\u90a3\u4e2a\u5f0f\u5b50\u76f4\u63a5\u66b4\u529b\u70b9\u4e58\uff0c\u590d\u6742\u5ea6\u4e3a $o(\\sqrt n)$ \u7684\u3002\n\n\u6709\u4e2a\u6bd4\u8f83\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u7531\u5206\u6cbb FFT \u6216\u591a\u9879\u5f0f\u542f\u53d1\u5f0f\u5408\u5e76\u6c42\u51fa $s$ \u6b21\u591a\u9879\u5f0f $\\displaystyle g_s(x)=\\prod_{t=1}^s (x+t)$ \uff1b\u518d\u7531\u591a\u9879\u5f0f\u591a\u70b9\u6c42\u503c\u6c42\u51fa $g_s(0\\cdot s),g_s(1\\cdot s),g_s(2\\cdot s),\\cdots, g_s((s-1)\\cdot s)$ \u3002\u8fd9\u4e9b\u4e58\u8d77\u6765\u5373\u4e3a\u5f85\u6c42\u9879\u3002\n\n\u8fd9\u6837\u4e00\u6765\uff0c\u590d\u6742\u5ea6\u4e3a $O(s\\log^2 s)+O(s\\log^2 s)=O(\\sqrt n\\log^2 n)$ \u3002\n\n---\n\n\u4f46\u8003\u8651\u5230\u6700\u540e\u5b9e\u9645\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4ec5\u5728\u82e5\u5e72\u4e2a\u70b9\u5904\u53d6\u5230\u3002\u82e5\u8fd9\u4e9b\u70b9\u6240\u5904\u7684\u533a\u95f4\u8fde\u7eed\uff0c\u5219\u53ef\u80fd\u53ef\u7528\u591a\u9879\u5f0f\u8fde\u7eed\u70b9\u503c\u5e73\u79fb\u6c42\u51fa\u7b54\u6848\u3002\n\n\u5f88\u5e78\u8fd0\u7684\u662f\uff0c\u6211\u4eec\u4ee4 $h_s(x)=g_s(sx)$\uff0c\u5219\u5f85\u6c42\u7684\u70b9\u503c\u53d8\u6362\u4e3a\u4e86 $h_s(0),h_s(1),h_s(2),\\cdots, h_s(s-1)$ \uff0c\u662f\u957f\u5ea6\u4e3a $s$ \u7684\u8fde\u7eed\u533a\u95f4\u3002\u8fd9\u5c31\u53ef\u4ee5\u7528\u5230\u591a\u9879\u5f0f\u8fde\u7eed\u70b9\u503c\u5e73\u79fb\u4e86\u3002\n\n\u73b0\u5728\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5982\u4f55\u4f7f\u7528\u591a\u9879\u5f0f\u8fde\u7eed\u70b9\u503c\u5e73\u79fb\u51d1\u51fa\u8fd9\u4e9b\u4e1c\u897f\u4e86\u3002\n\n\u800c\u521d\u59cb\u6211\u4eec\u4e5f\u5e76\u4e0d\u77e5\u9053 $h_s(x)$ \u7684\u4efb\u4f55\u4e00\u4e2a\u70b9\u503c\uff0c\u4f46\u662f\u6211\u4eec\u77e5\u9053 $h_1(x)=x+1$ \u7684\u6240\u6709\u70b9\u503c\u3002\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u8003\u8651\u5982\u4f55\u500d\u589e\u5f97\u5230 $h_s(x)$ \u7684\u90a3\u4e9b\u70b9\u503c\u3002\n\n\u5f53\u6211\u4eec\u5df2\u77e5 $h_d(0),h_d(1),\\cdots,h_d(d)$ \u65f6\uff0c\u82e5\u6211\u4eec\u60f3\u8981\u5f97\u5230 $h_{2d}(0),h_{2d}(1),\\cdots,h_{2d}(2d)$\u3002\n\n\u5bf9\u4e8e $\\displaystyle \\forall i\\leq d\\to h_{2d}(i)=g_{2d}(is)=\\prod_{t=1}^{2d}(is+t)=g_d(is)\\cdot g_d(is+d)$ \u3002\n\n\u7531\u4e8e $g_d(is+d)$ \u5728\u6a21 $P$ \u610f\u4e49\u4e0b\uff0c\u4e0e $h_d(d\\cdot s^{-1}+i)$ \u7b49\u4ef7\uff0c\u56e0\u6b64 $h_{2d}(i)=h_d(i)\\cdot h_d(i+d\\cdot s^{-1})$ \u3002\n\n\u6c42\u89e3\u8fd9\u4e9b\u70b9\u503c\u65f6\uff0c\u6211\u4eec\u53ea\u8981\u5c06 $h_d(0),h_d(1),\\cdots,h_d(d)$ \u8fd9\u4e9b\u8fde\u7eed\u70b9\u503c\u5e73\u79fb\u51fa $h_{2d}(0+d\\cdot s^{-1}),h_d(1+d\\cdot s^{-1}),\\cdots, h_d(d+d\\cdot s^{-1})$ \uff0c\u76f4\u63a5\u4e24\u4e24\u70b9\u4e58\u5373\u53ef\u500d\u589e\u3002\n\n\u800c\u5bf9\u4e8e\u540e\u9762\u7684\u90a3\u51e0\u4e2a\u70b9\uff0c\u5982\u679c\u6211\u4eec\u5df2\u77e5 $h_d(d+1),h_d(d+2),\\cdots, h_d(2d)$ \uff0c\u5c31\u4e5f\u80fd\u901a\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u6c42\u89e3\u3002\n\n\u90a3\u600e\u4e48\u77e5\u9053\u5462\uff1f\u95ee\u5c31\u662f\u591a\u9879\u5f0f\u8fde\u7eed\u70b9\u503c\u5e73\u79fb\uff0c\u7528 $h_d(0),h_d(1),\\cdots,h_d(d)$ \u76f4\u63a5\u5e73\u79fb\u51fa $h_d(d+1),h_d(d+2),\\cdots,h_d(2d+1)$ \u5c31\u53ef\u4ee5\u4e86\uff08\u8fd9\u91cc\u56e0\u4e3a\u8981\u6c42\u533a\u95f4\u4e0d\u4ea4\uff0c\u4f1a\u989d\u5916\u5e73\u79fb\u51fa $h_d(2d+1)$\uff09\u3002\n\n\u65e2\u7136\u8fd9\u6837\uff0c~~\u90a3\u4e5f\u522b\u5ba2\u6c14\u4e86\uff0c\u5206\u90a3\u4e48\u6e05\u695a\uff0c~~ \u7b2c\u4e00\u6b21\u5148\u5e73\u79fb\u51fa $h_d(d+1),h_d(d+2),\\cdots, h_d(2d+1)$ \uff1b\u62fc\u63a5\u5230\u539f\u70b9\u503c\u540e\u9762\u4e4b\u540e\uff0c\u7b2c\u4e8c\u6b21\u518d\u76f4\u63a5\u7528 $h_d(0),h_d(1),\\cdots,h_d(2d+1)$ \u76f4\u63a5\u5e73\u79fb\u51fa $h_d(0+d\\cdot s^{-1}),h_d(1+d\\cdot s^{-1}),\\cdots,h_d(2d+1+d\\cdot s^{-1})$ \u3002\u70b9\u4e58\u5219\u53ef\u4ee5\u5f97\u5230\u6211\u4eec\u8981\u6c42\u7684 $h_{2d}(0),h_{2d}(1),\\cdots,h_{2d}(2d)$ \u3002\u590d\u6742\u5ea6\u4e3a $O(d\\log d)+O(2d\\log 2d)+O(2d)=O(d\\log d)$ \u3002\n\n---\n\n\u7531\u4e8e\u6211\u4eec\u53ef\u4ee5\u4ece $h_d$ \u7684\u72b6\u6001\u63a8\u51fa $h_{2d}$ \u7684\u72b6\u6001\uff0c\u6211\u4eec\u53c8\u5df2\u77e5 $h_1$ \u7684\u72b6\u6001\uff0c\u5f85\u6c42 $h_s$ \u7684\u72b6\u6001\uff1b\u4e8e\u662f\u6211\u4eec\u53bb\u8003\u8651\u7528\u7c7b\u4f3c\u9012\u5f52\u5feb\u901f\u5e42\u7684\u8fed\u4ee3\u65b9\u6cd5\u6c42\u51fa\u7ed3\u679c\u3002\n\n\u90a3\u8fd8\u5dee\u7684\u6b65\u9aa4\u5c31\u662f\u7531 $h_d$ \u7684\u72b6\u6001\u63a8\u51fa $h_{d+1}$ \u7684\u72b6\u6001\u3002\n\n~~\u8fd9\u4e2a\u7b80\u5355\uff0c~~ \u7531\u4e8e $\\displaystyle h_{d+1}(i)=g_{d+1}(is)=\\prod_{t=1}^{d+1}(is+t)=g_d(is)\\cdot (is+d+1)=h_d(i)\\cdot (is+d+1)$ \uff0c\u6211\u4eec\u76f4\u63a5 $O(d)$ \u66b4\u529b\u8dd1\u8fc7\u53bb\u5c31\u884c\u4e86\u3002\n\n\u4f46\u662f\u7531 $h_d$ \u63a8 $h_{d+1}$ \u65f6\uff0c\u9700\u8981\u989d\u5916\u77e5\u9053 $h_{d+1}(d+1)$ \u7684\u4fe1\u606f\uff0c\u5b83\u9700\u8981\u7528\u5230 $h_d(d+1)$ \u7684\u4fe1\u606f\u3002\n\n\u4f46\u8fd9\u4e2a\u65e0\u4f24\u5927\u96c5\uff0c\u56e0\u4e3a $h_d$ \u63a8\u51fa $h_{d+1}$ \u7684\u72b6\u6001\u4e00\u5b9a\u53d1\u751f\u5728 $h_{d\\over 2}$ \u63a8\u51fa $h_d$ \u4e4b\u540e\u3002\u800c\u50cf\u4e0a\u9762\u8bf4\u7684\uff0c\u6b63\u597d\u7531\u4e8e\u533a\u95f4\u4e0d\u4ea4\uff0c\u6070\u597d\u5728 $h_d$ \u63a8\u51fa $h_{2d}$ \u65f6\uff0c\u628a $h_{2d}(2d+1)$ \u7684\u7ed9\u987a\u4fbf\u7b97\u4e86\u3002\n\n\u90a3\u5c31\u597d\u529e\u4e86\uff0c\u5982\u679c\u63a5\u7740\u8981 $h_{2d}$ \u63a8 $h_{2d+1}$ \uff0c\u5c31\u628a\u8fd9\u4e2a\u6b63\u597d\u7b97\u4e86\uff1b\u5982\u679c\u4e0d\u8981\uff0c\u5c31\u987a\u624b\u4e22\u4e86\u3002\u4e8e\u662f\u8fd9\u4e00\u6b65\u7684\u590d\u6742\u5ea6\u662f\u4e25\u683c $O(d)$ \u7684\u3002\n\n---\n\n\u7efc\u4e0a\uff0c\u6211\u4eec\u7531\u5df2\u77e5\u7684 $h_1$ \u72b6\u6001\uff0c\u500d\u589e\u5730\u63a8\u51fa $h_s$ \u7684\u72b6\u6001\u3002\u6700\u540e\u7d2f\u4e58 $h_s(0),\\cdots, h_s(s-1)$ \uff0c\u518d\u4e58\u4e0a\u90a3\u4e9b\u5c3e\u5df4\uff0c\u5c31\u53ef\u4ee5\u7b97\u51fa\u603b\u7b54\u6848\u4e86\u3002\n\n\u590d\u6742\u5ea6 $\\displaystyle T(s)=T({s\\over 2})+O(s\\log s)+O(s)$ \u5f97\u5230 $T(s)=O(s\\log s)=O(\\sqrt n\\log n)$ \u3002\uff08\u539f\u672c\u8fd8\u8981\u52a0\u4e0a\u4e00\u4e2a $o(\\sqrt n)$ \uff0c\u4f46\u662f\u4f5c\u4e3a\u4f4e\u9636\u9879\u820d\u53bb\u4e86\u3002\uff09\n\n---\n\n**\u3010\u6838\u5fc3\u4ee3\u7801\u3011**\n--\n\n```cpp\npoly c, d;\ninline int get_fac(int n) {\n\tint pos=curStk, s=sqrt(n)+1e-6;\n\tvir invs=Inv[s];\n\tfor(int i=s;i>1;i>>=1) Stk[++curStk]=i;//\u624b\u52a8\u538b\u6808\n\n\tc.resize(2); c[0]=1; c[1]=s+1;//\u521d\u59cb\u5316 h_1 \u7684\u72b6\u6001\n\tfor(int l=Stk[curStk]; curStk>pos; l=Stk[--curStk]) {\n\t\tValueTrans(c, d, l>>1, (l>>1)+1);//\u70b9\u503c\u5e73\u79fb\u51fa\u989d\u5916\u72b6\u6001\n\t\tc.resize(2*sz(c));\n\t\tfor(int i=0; i<sz(d); ++i) c[sz(d)+i]=d[i];\n\t\tValueTrans(c, d, sz(c)-1, invs*vir(l>>1));//\u70b9\u503c\u5e73\u79fb\u51fa\u70b9\u4e58\u72b6\u6001\n\t\tfor(int i=0; i<sz(c); ++i) c[i]=c[i]*d[i];\n\t\tif(l&1) {\n\t\t\tfor(int i=0; i<=l; ++i) c[i]=c[i]*vir(i*s+l);//h_l \u8f6c\u4e3a h_{l+1}\n\t\t}\n\t\telse c.resize(l+1);\n\t}\n\n\tvir res=1;\n\tfor(int i=0; i<s; ++i) res=res*c[i];//\u7d2f\u4e58\n\tfor(int i=s*s+1; i<=n; ++i) res=res*vir(i);//\u5904\u7406\u5c3e\u5df4\n\treturn res;\n}\n```\n\n---\n\n**\u3010\u62d3\u5c55\u3011**\n--\n\n\u4f60\u4ee5\u4e3a\u8fd9\u5c31\u5b8c\u4e86\uff1f\n\n\u6211\u53d1\u73b0\u6211\u7684 [\u4ee3\u7801](https://www.luogu.com.cn/record/67992221) \u8dd1\u5f97\u98de\u5feb\uff0c\u770b\u5230\u8fde\u65f6\u9650 4s \u7684\u5341\u5206\u4e4b\u4e00\u90fd\u6ca1\u8dd1\u5230\uff0c\u6211\u4e0d\u7981\u201c\u6076\u5411\u80c6\u8fb9\u751f\u201d\u3002\u7528\u8fd9\u4e2a\u677f\u5b50\u6539\u4e86\u6539\uff0c\u6d4b\u8bd5\u4e86\u4e00\u4e0b\u9636\u4e58\u6c42\u548c\u7684\u7ed3\u679c\u3002\n\n\u505a\u6cd5\u662f\u6c42\u51fa $\\displaystyle \\sum_{i=1}^n i!$ \u548c $\\displaystyle \\sum_{i=1}^{n-1} i!$\uff0c\u505a\u5dee\u7b97\u51fa\u7b54\u6848\u3002\n\n\u90a3\u8fd9\u4e2a\u95ee\u9898\u600e\u4e48\u7528\u70b9\u503c\u5e73\u79fb\u5904\u7406\u5462\uff1f\n\n\u6211\u4eec\u8bb0 $\\displaystyle S_n=\\sum_{i=1}^n i!$ \uff0c\u8003\u8651\u5b83\u7684\u8f6c\u79fb\u77e9\u9635\uff1a\n\n$\\begin{aligned}\n\\begin{pmatrix}\n(n+1)!\n\\\\S_n\n\\end{pmatrix}&=\n\\begin{pmatrix}\nn+1&0\n\\\\1&1\n\\end{pmatrix}\\cdot \n\\begin{pmatrix}\nn!\n\\\\S_{n-1}\n\\end{pmatrix}\n\\\\&=\\prod_{i=1}^n\n\\begin{pmatrix}\ni+1&0\n\\\\1&1\n\\end{pmatrix}\\cdot \n\\begin{pmatrix}\n1\n\\\\0\n\\end{pmatrix}\n\\end{aligned}$\n\n\u540c\u7406\uff0c\u6211\u4eec\u8003\u8651 $\\displaystyle g_d(x)=\\prod_{i=1}^d\\begin{pmatrix}\nx+i+1&0\n\\\\1&1\n\\end{pmatrix},h_d(i)=g_d(is)$ \u3002\n\n\u624b\u73a9\u4e00\u4e0b\u4f1a\u53d1\u73b0\uff0c\u8fd9\u4e2a\u77e9\u9635\u8fd9\u4e2a\u77e9\u9635\u7684\u4e58\u6cd5\u4e5f\u6709\u7279\u70b9\uff1a\n\n$\\begin{pmatrix}\na_1&\\ \n\\\\b_1&c_1\n\\end{pmatrix}\\cdot\\begin{pmatrix}\na_2&\\ \n\\\\b_2&c_2\n\\end{pmatrix}=\\begin{pmatrix}\na_1a_2&\\ \n\\\\b_1a_2+c_1b_2&c_1c_2\n\\end{pmatrix}$\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u77e9\u9635\u7684\u4e58\u79ef\u6c38\u8fdc\u53ea\u6709\u4e09\u4e2a\u5730\u65b9\u6709\u503c\uff0c\u5e76\u4e14\u53f3\u4e0b\u89d2\u6052\u4e3a $1$ \u3002\u4e8e\u662f\u6211\u4eec\u7ef4\u62a4 $h_d(x)=\\begin{pmatrix}mc_{d,0}(x)&\\ \\\\mc_{d,1}(x)&1\\end{pmatrix}$ \u3002\n\n\u7531\u539f\u6765\u7ef4\u62a4\u4e00\u4e2a\u70b9\u503c\u53d8\u6210\u4e86\u7ef4\u62a4\u4e24\u4e2a\u70b9\u503c ~~\u800c\u5df2~~ \u3002\n\n\u7531\u4e8e\u6b64\u65f6\u4e3a\u77e9\u9635\u4e58\u6cd5 $h_{2d}(i)=h_d(i+d\\cdot s^{-1})\\cdot h_d(i)$ \u5f62\u5f0f\u4e0d\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u4f46\u4e00\u5b9a\u8981\u6ce8\u610f\u77e9\u9635\u7684\u5de6\u53f3\u4e58\u4e0d\u7b49\u4ef7\u3002\n\n\u53d1\u751f\u53d8\u5316\u7684\u662f $h_d$ \u8f6c\u79fb\u5230 $h_{d+1}$ \u65f6\uff0c\u6b64\u65f6\u6709\uff1a\n\n$\\begin{aligned}\n&h_{d+1}(i)\n\\\\=&\\begin{pmatrix}mc_{d+1,0}(i)&\\ \\\\mc_{d+1,1}(i)&1\\end{pmatrix}\n\\\\=&\\begin{pmatrix}i+d+2&0\\\\1&1\\end{pmatrix}h_d(i)\n\\\\=&\\begin{pmatrix}i+d+2&0\\\\1&1\\end{pmatrix}\\begin{pmatrix}mc_{d,0}(x)&\\ \\\\mc_{d,1}(x)&1\\end{pmatrix}\n\\\\=&\\begin{pmatrix}(i+d+2)mc_{d,0}(x)&\\ \\\\mc_{d,0}+mc_{d,1}(x)&1\\end{pmatrix}\n\\end{aligned}$\n\n\u4fee\u6539\u6b64\u5904\u5373\u53ef\u3002\n\n```cpp\npoly mc[2], md[2];\ninline int get_sumfac(int n) {\n\tint pos=curStk, s=sqrt(n)+1e-6;\n\tvir invs=Inv[s];\n\tfor(int i=s;i>1;i>>=1) Stk[++curStk]=i;\n\n\tmc[0].resize(2); mc[0][0]=2; mc[0][1]=s+2;\n\tmc[1].resize(2); mc[1][0]=mc[1][1]=1;\n\tfor(int l=Stk[curStk]; curStk>pos; l=Stk[--curStk]) {\n\t\tfor(int t=0; t<2; ++t){\n\t\t\tpoly &c = mc[t], &d = md[t];\n\t\t\tValueTrans(c, d, l>>1, (l>>1)+1);\n\t\t\tc.resize(2*sz(c));\n\t\t\tfor(int i=0; i<sz(d); ++i) c[sz(d)+i]=d[i];\n\t\t\tValueTrans(c, d, sz(c)-1, invs*vir(l>>1));\n\t\t}\n\t\tfor(int i=0; i<sz(mc[0]); ++i) {\n\t\t\tmc[1][i]=mc[0][i]*md[1][i]+mc[1][i];\n\t\t\tmc[0][i]=mc[0][i]*md[0][i];\n\t\t}\n\t\tif(l&1) {\n\t\t\tfor(int i=0; i<=l; ++i) {\n\t\t\t\tmc[1][i]=mc[0][i]+mc[1][i];\n\t\t\t\tmc[0][i]=mc[0][i]*vir(i*s+l+1);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tmc[0].resize(l+1);\n\t\t\tmc[1].resize(l+1);\n\t\t}\n\t}\n\n\tvir res0=1, res1=0;\n\tfor(int i=0; i<s; ++i){\n\t\tres1=res0*mc[1][i]+res1;\n\t\tres0=res0*mc[0][i];\n\t}\n\tfor(int i=s*s+1; i<=n; ++i){\n\t\tres1=res1+res0;\n\t\tres0=res0*vir(i+1);\n\t}\n\treturn res1;\n}\n```\n\n[\u7ed3\u679c](https://www.luogu.com.cn/record/67992035) \u8fd8\u662f\u6ca1\u8dd1\u5230\u4e00\u534a\u7684\u65f6\u95f4\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/w1xs33od.png)",
        "postTime": 1643177999,
        "uid": 36031,
        "name": "JustinRochester",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P5282 \u3010\u6a21\u677f\u3011\u5feb\u901f\u9636\u4e58\u7b97\u6cd5"
    },
    {
        "content": "\u8fd9\u9053\u9898\u7684\u6570\u636e\u8303\u56f4\u592a\u5c0f\u4e86\uff0c\u5361\u4e0d\u6389 $O(\\sqrt n \\log^2 n)$ \u7684\u7b97\u6cd5\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\u8bbe $v=\\lfloor\\sqrt n\\rfloor$ \u3002\n\n\u6211\u4eec\u8003\u8651\u5c06 $n!$ \u62c6\u5f00\uff0c\u8bbe $g_v(x)=\\prod_{i=1}^v (x+i)$ \uff0c\u5219\n\n$$n!=\\prod_{i=v^2+1}^n i*\\prod_{i=0}^{v-1}g_v(iv)$$\n\n\u6211\u4eec\u8003\u8651\u5c06 $g_v$ \u901a\u8fc7\u5206\u6cbb\u4e58\u6cd5\u6c42\u51fa\uff0c\u7136\u540e\u518d\u7528\u591a\u70b9\u63d2\u503c\u5c06\u6bcf\u4e2a\u70b9\u503c\u63d2\u51fa\u6765\u5373\u53ef\u5f97\u5230 $O(\\sqrt n \\log^2n)$ \u7684\u4f18\u79c0\u7b97\u6cd5\u3002\u6a21\u6570\u4e0d\u5bf9\u53ef\u4ee5\u7528 $MTT$ \u5b9e\u73b0\u3002\n\n\u4e00\u4e2a $\\log$ \u7684\u7b97\u6cd5\u5c31\u662f\u7528\u500d\u589e\u7ef4\u62a4 $g$ \u7684\u70b9\u503c\u3002\u5177\u4f53\u505a\u6cd5\u53ef\u4ee5\u53c2\u89c1 [$zzq$\u7684\u535a\u5ba2](https://www.cnblogs.com/zzqsblog/p/8408691.html) \u3002\n\n\u4ee3\u7801:\n```cpp\n#include<cstdio>\n#include<cstdlib>\n#include<cctype>\n#include<cstring>\n#include<algorithm>\n#include<cmath>\n#include<cassert>\n#include<iostream>\n#define Rep(i,a,b) for(register int i=(a);i<=(b);++i)\n#define Repe(i,a,b) for(register int i=(a);i>=(b);--i)\n#define rep(i,a,b) for(register int i=(a);i<(b);++i)\n#define pb push_back\n#define mx(a,b) (a>b?a:b)\n#define mn(a,b) (a<b?a:b)\ntypedef unsigned long long uint64;\ntypedef unsigned int uint32;\ntypedef long long ll;\nusing namespace std;\n\nnamespace IO\n{\n\tconst uint32 Buffsize=1<<15,Output=1<<24;\n\tstatic char Ch[Buffsize],*S=Ch,*T=Ch;\n\tinline char getc()\n\t{\n\t\treturn((S==T)&&(T=(S=Ch)+fread(Ch,1,Buffsize,stdin),S==T)?0:*S++);\n\t}\n\tstatic char Out[Output],*nowps=Out;\n\t\n\tinline void flush(){fwrite(Out,1,nowps-Out,stdout);nowps=Out;}\n\n\ttemplate<typename T>inline void read(T&x)\n\t{\n\t\tx=0;static char ch;T f=1;\n\t\tfor(ch=getc();!isdigit(ch);ch=getc())if(ch=='-')f=-1;\n\t\tfor(;isdigit(ch);ch=getc())x=x*10+(ch^48);\n\t\tx*=f;\n\t}\n\n\ttemplate<typename T>inline void write(T x,char ch='\\n')\n\t{\n\t\tif(!x)*nowps++='0';\n\t\tif(x<0)*nowps++='-',x=-x;\n\t\tstatic uint32 sta[111],tp;\n\t\tfor(tp=0;x;x/=10)sta[++tp]=x%10;\n\t\tfor(;tp;*nowps++=sta[tp--]^48);\n\t\t*nowps++=ch;\n\t}\n}\nusing namespace IO;\n\nvoid file()\n{\n#ifndef ONLINE_JUDGE\n\tFILE*DSD=freopen(\"water.in\",\"r\",stdin);\n\tFILE*CSC=freopen(\"water.out\",\"w\",stdout);\n#endif\n}\n\nconst int MAXN=1<<17;\n\nstatic int mod;\n\nnamespace poly\n{\n\tinline int power(int u,int v)\n\t{\n\t\tregister int sm=1;\n\t\tfor(;v;v>>=1,u=(uint64)u*u%mod)if(v&1)\n\t\t\tsm=(uint64)sm*u%mod;\n\t\treturn sm;\n\t}\n\n\tstatic int Len,rev[MAXN];\n\n\tstatic struct comp\n\t{\n\t\tdouble re,im;\n\n\t\tcomp(){}\n\n\t\tcomp(double _r,double _i):re(_r),im(_i){}\n\n\t\tcomp operator+(const comp&a){return comp(re+a.re,im+a.im);}\n\n\t\tcomp operator-(const comp&a){return comp(re-a.re,im-a.im);}\n\n\t\tcomp operator*(const comp&a)\n\t\t{return comp(re*a.re-im*a.im,re*a.im+im*a.re);}\n\n\t\tcomp operator/(const int&a){return comp(re/a,im/a);}\n\t}g[19][MAXN];\n\n\tnamespace MTT\n\t{\n\t\tconst double pi=acos(-1);\n\n\t\tinline void predone()\n\t\t{\n\t\t\tRep(i,1,17)rep(j,0,1<<i)\n\t\t\t\tg[i][j]=comp(cos(2*pi*j/pow(2,i)),sin(2*pi*j/pow(2,i)));\n\t\t}\n\n\t\tinline void FFT(comp*F,int tl)\n\t\t{\n\t\t\trep(i,0,Len)if(i<rev[i])swap(F[rev[i]],F[i]);\n\t\t\tfor(register int i=2,ii=1,t=1;i<=Len;i<<=1,ii<<=1,++t)\n\t\t\t\tfor(register int j=0;j<Len;j+=i)rep(k,0,ii)\n\t\t\t\t{\n\t\t\t\t\tcomp x=F[j+k+ii]*g[t][k];\n\t\t\t\t\tF[j+k+ii]=F[j+k]-x;\n\t\t\t\t\tF[j+k]=F[j+k]+x;\n\t\t\t\t}\n\t\t\tif(tl==-1)\n\t\t\t{\n\t\t\t\treverse(F+1,F+Len);\n\t\t\t\trep(i,0,Len)F[i]=F[i]/Len;\n\t\t\t}\n\t\t}\n\n\t\tstatic comp Z[MAXN];\n\n\t\tinline void DBLFFT(comp*F,comp*G,int tl)\n\t\t{\n\t\t\tif(tl==1)\n\t\t\t{\n\t\t\t\tmemcpy(Z,F,sizeof(comp)*Len);\n\t\t\t\tFFT(Z,1);\n\t\t\t\tmemcpy(F,Z,sizeof(comp)*Len);\n\t\t\t\treverse(F+1,F+Len);\n\t\t\t\trep(i,0,Len)F[i].im=-F[i].im;\n\t\t\t\trep(i,0,Len)G[i]=(Z[i]-F[i])/2,F[i]=(Z[i]+F[i])/2\n\t\t\t\t\t,swap(G[i].re,G[i].im),G[i].im=-G[i].im;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\trep(i,0,Len)F[i]=comp(F[i].re-G[i].im,F[i].im+G[i].re);\n\t\t\t\tFFT(F,-1);\n\t\t\t\trep(i,0,Len)G[i]=comp(F[i].im,0),F[i]=comp(F[i].re,0);\n\t\t\t}\n\t\t}\n\t}\n\tusing MTT::predone;\n\tusing MTT::DBLFFT;\n\tusing MTT::FFT;\n\n\tinline void calrev()\n\t{\n\t\tint II=log(Len)/log(2)-1;\n\t\tRep(i,1,Len-1)rev[i]=rev[i>>1]>>1|(i&1)<<II;\n\t}\n\n\tinline int ad(int u,int v)\n\t{return ((unsigned)u+v>=mod?(unsigned)u+v-mod:u+v);}\n\n\tstatic int X[MAXN],Y[MAXN],Iv[MAXN],mlx[MAXN];\n\n\tstatic comp A[MAXN],B[MAXN],C[MAXN],D[MAXN];\n\n\tinline void mul(int*F,int*G,int*H,int lenl,int lenr)\n\t{\n\t\tif((ll)lenl*lenr<=300)\n\t\t{\n\t\t\tRep(i,0,lenl+lenr)mlx[i]=0;\n\t\t\tRep(i,0,lenl)Rep(j,0,lenr)\n\t\t\t\tmlx[i+j]=(mlx[i+j]+(ll)F[i]*G[j])%mod;\n\t\t\tRep(i,0,lenl+lenr)H[i]=mlx[i];\n\t\t\treturn;\n\t\t}\n\t\tfor(Len=2;Len<=lenl+lenr;Len<<=1);\n\t\tcalrev();\n\t\trep(i,0,Len)A[i]=i<=lenl?comp(F[i]>>15,F[i]&32767):comp(0,0),\n\t\t\tC[i]=i<=lenr?comp(G[i]>>15,G[i]&32767):comp(0,0);\n\t\tDBLFFT(A,B,1),DBLFFT(C,D,1);\n\t\trep(i,0,Len)\n\t\t{\n\t\t\tregister comp t=A[i];\n\t\t\tA[i]=B[i]*C[i]+A[i]*D[i];\n\t\t\tB[i]=B[i]*D[i];\n\t\t\tC[i]=C[i]*t;\n\t\t}\n\t\tDBLFFT(A,B,-1),FFT(C,-1);\n\t\trep(i,0,Len)\n\t\t{\n\t\t\tregister int lz=((((ll)floor(C[i].re+0.5))%mod<<30)%mod\n\t\t\t\t +((ll)floor(A[i].re+0.5))%mod*32768+(ll)floor(B[i].re+0.5))%mod;\n\t\t\tH[i]=i<=lenl+lenr?lz:0;\n\t\t}\n\t}\n\n\tinline void Inv(int*F,int*G,int ln)\n\t{\n\t\tIv[0]=power(F[0],mod-2);\n\t\tfor(register int Ln=2;Ln>>1<=ln;Ln<<=1)\n\t\t{\n\t\t\trep(i,ln+1,Ln)F[i]=0;\n\t\t\trep(i,0,Ln)X[i]=F[i],Y[i]=0;\n\t\t\trep(i,0,(Ln>>1))Y[i]=Iv[i];\n\t\t\tmul(Y,X,X,(Ln>>1)-1,Ln-1),--X[0];\n\t\t\tmul(X,Y,X,Ln-1,(Ln>>1)-1);\n\t\t\trep(i,(Ln>>1),Ln)Iv[i]=mod-X[i];\n\t\t}\n\t\tRep(i,0,ln)G[i]=Iv[i];\n\t}\n\n\tstatic int ExX[MAXN],ExY[MAXN];\n\n\tinline void Div(int*F,int*G,int*Q,int*R,int lenf,int leng)\n\t{\n\t\tRep(i,0,lenf)ExX[i]=F[lenf-i];\n\t\tRep(i,0,leng)ExY[i]=G[leng-i];\n\t\tRep(i,leng+1,lenf-leng)ExY[i]=0;\n\t\tInv(ExY,ExY,lenf-leng);\n\t\tRep(i,lenf-leng+1,lenf)ExX[i]=0;\n\t\tRep(i,lenf-leng+1,leng)ExY[i]=0;\n\t\tmul(ExX,ExY,ExY,lenf-leng,lenf-leng);\n\t\tRep(i,lenf-leng+1,(lenf-leng)<<1)ExY[i]=0;\n\t\tRep(i,0,(lenf-leng)>>1)swap(ExY[i],ExY[lenf-leng-i]);\n\t\tmul(ExY,G,ExX,lenf-leng,leng);\n\t\tassert(F[leng]==ExX[leng]);\n\t\tRep(i,0,leng-1)R[i]=ad(F[i],mod-ExX[i]);\n\t\tRep(i,0,lenf-leng)Q[i]=ExY[i];\n\t}\n\n\tnamespace Extend\n\t{\n\t\tstatic int solv[18][2][MAXN];\n\n\t\tvoid calc(int*a,int l,int r,int lev,int dir)\n\t\t{\n\t\t\tif(l==r)\n\t\t\t{\n\t\t\t\tsolv[lev][dir][0]=mod-a[l];\n\t\t\t\tsolv[lev][dir][1]=1;return;\n\t\t\t}\n\t\t\tint md=(l+r)>>1;\n\t\t\tcalc(a,l,md,lev+1,0),calc(a,md+1,r,lev+1,1);\n\t\t\tmul(solv[lev+1][0],solv[lev+1][1],solv[lev][dir],md-l+1,r-md);\n\t\t}\n\n\t\tstatic int pol[18][MAXN],Q[MAXN];\n\t\t\n\t\tvoid getnum(int*a,int*ans,int l,int r,int lev,int n)\n\t\t{\n\t\t\tif(n>r-l)\n\t\t\t{\n\t\t\t\tcalc(a,l,r,0,0);\n\t\t\t\tDiv(pol[lev-(lev>0)],solv[0][0],Q,pol[lev],n,r-l+1);\n\t\t\t\tn=r-l;\n\t\t\t}\n\t\t\telse if(lev){Rep(i,0,n)pol[lev][i]=pol[lev-1][i];}\n\t\t\tif(l==r)\n\t\t\t{\n\t\t\t\tans[l]=pol[lev][0];\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tint md=(l+r)>>1;\n\t\t\tgetnum(a,ans,l,md,lev+1,n);\n\t\t\tgetnum(a,ans,md+1,r,lev+1,n);\n\t\t}\n\t}\n}\nusing poly::power;\nusing poly::predone;\nusing poly::ad;\nusing poly::Extend::pol;\nusing poly::Extend::getnum;\nusing poly::Extend::calc;\nusing poly::Extend::solv;\n\nstatic int n,Z[MAXN],as[MAXN];\n\nint main()\n{\n\tfile();\n\tpredone();\n\tread(n),read(mod);\n\tint v=sqrt(n);\n\tRep(i,1,v)Z[i]=mod-i;\n\tcalc(Z,1,v,0,0);\n\tmemcpy(pol[0],solv[0][0],sizeof(int)*(v+1));\n\tRep(i,1,v)Z[i]=(i-1)*v;\n\tgetnum(Z,as,1,v,0,v);\n\tstatic int ans=1;\n\tRep(i,1,v)ans=(ll)ans*as[i]%mod;\n\tRep(i,v*v+1,n)ans=(ll)ans*i%mod;\n\tcout<<ans<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1554252385,
        "uid": 7035,
        "name": "Great_Influence",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5282 \u3010\u3010\u6a21\u677f\u3011\u5feb\u901f\u9636\u4e58\u7b97\u6cd5\u3011"
    }
]