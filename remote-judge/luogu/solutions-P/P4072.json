[
    {
        "content": ">\u539f\u5148\u4fee\u6539\u7684\u516c\u5f0f\u8fd8\u662f\u6709\u8bef\uff0c\u5df2\u4fee\u6539\n\n\u6c42\u65b9\u5dee\u2026\u2026\u5148\u641e\u5f0f\u5b50\n\n\u5df2\u77e5\uff1a\n$s^{2}=\\frac {(\\overline v-v_1)^{2}+(\\overline v-v_2)^{2}+...+(\\overline v-v_m)^{2}}{m}$\n\n\u7136\u540e\uff1a$s^{2}=\\frac {(\\frac {\\sum_{i=1}^{m}v_i}{m} -v_1)^{2}+(\\frac {\\sum_{i=1}^{m}v_i}{m} -v_2)^{2}+...+(\\frac {\\sum_{i=1}^{m}v_i}{m} -v_m)^{2}}{m}$\n\n\u5c55\u5f00\uff1a$s^{2}=\\frac {m\\times \\frac {(\\sum_{i=1}^{m}v_i)^{2}}{m^{2}}-2\\times\\frac {(\\sum_{i=1}^{m}v_i)}{m}\\times (v_1+v_2+...+v_m)+(v_1^{2}+v_2^{2}+...+v_m^{2})}{m}$\n\n\u7136\u540e\u53ef\u5316\u4e3a\uff1a\n$s^{2}=\\frac {\\frac {(\\sum_{i=1}^{m}v_i)^{2}}{m}-2\\times \\frac {(\\sum_{i=1}^{m}v_i)^{2}}{m}+(v_1^{2}+v_2^{2}+...+v_m^{2})}{m}$\n\n\u7136\u540e\uff1a\n$s^{2}=-\\frac {(\\sum_{i=1}^{m}v_i)^{2}}{m^{2}}+\\frac {(v_1^{2}+v_2^{2}+...+v_m^{2})}{m}$\n\n\u8fd8\u8981$\\times m^2$\n\n$s^{2}\\times m^{2}=-(\\sum_{i=1}^{m}v_i)^{2}+m\\times (v_1^{2}+v_2^{2}+...+v_m^{2})$\n\n\u8fd9\u6837\u5c31\u597d\u4e86\uff0c\u4f60\u4f1a\u53d1\u73b0\u5f0f\u5b50\u53f3\u8fb9\u7b2c\u4e00\u9879\u662f\u4e2a\u5b9a\u503c\uff0c\u800c\u7b2c\u4e8c\u9879\u6211\u4eec\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u641e\u641e\n\n\u7528$f_{i,l}$\u8868\u793a\u524d$i$\u6bb5\u5206\u4e3a$l$\u5929\u8d70\u7684\u6700\u5c0f\u5e73\u65b9\u548c\uff08\u8fd9\u91cc\u4e5f\u662f\u5e73\u65b9\u4e86\u56e0\u4e3a\u6700\u540e\u5904\u7406\u6210\u65b9\u5dee\u4e86QAQ\uff09\n\n\u5373\u6709\uff1a$f_{i,l}=min(f_{i,l},f_{j,l-1}+(sum_i-sum_j)^{2})(0\\le j<i)$\uff08$m$\u53ef\u4ee5\u6700\u540e\u4e58\u4e0a\uff09\n\n\u7136\u540e$80$\u5206\u5230\u624b\n\n\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u7528\u659c\u7387\u4f18\u5316\u641e\uff0c\u5373\u53ef\u4ee5\u8fd9\u4e48\u5316\uff1a\n\n$f_{i,l}+2\\times sum_i\\times sum_j=f_{j,l-1}+sum_i^{2}+sum_j^{2}$\n\n\u7136\u540e\u5c31\u662f\u659c\u7387\u4f18\u5316\u5957\u8def\u4e86\n\n\u4ee3\u7801\uff1a\n```\n# include<iostream>\n# include<cstring>\n# include<cstdio>\n# define LL long long\nusing namespace std;\nconst int MAX=3e3+1;\nint n,m;\nint qu[MAX];\nLL sum[MAX],f[MAX],g[MAX];\nint read()\n{\n    int x=0;\n    char ch=getchar();\n    for(;!isdigit(ch);ch=getchar());\n    for(;isdigit(ch);x=x*10+ch-48,ch=getchar());\n    return x;\n}\ndouble X(int i)\n{\n    return sum[i];\n}\ndouble Y(int i)\n{\n    return g[i]+sum[i]*sum[i];\n}\ndouble look(int x,int y)\n{\n    return (Y(x)-Y(y))/(X(x)-X(y));\n}\nint main()\n{\n    n=read(),m=read();\n    for(int i=1;i<=n;++i)\n      sum[i]=sum[i-1]+read(),g[i]=sum[i]*sum[i];\n    for(int l=1;l<m;++l)\n      {\n      \tint he=1,ta=1;\n      \tqu[1]=l;\n      \tfor(int i=l+1;i<=n;++i)\n          {\n          \twhile(he<ta&&look(qu[he],qu[he+1])<2*sum[i]) ++he;\n          \tint tt=qu[he];\n          \tf[i]=g[tt]+(sum[i]-sum[tt])*(sum[i]-sum[tt]);\n          \twhile(he<ta&&look(qu[ta],qu[ta-1])>look(qu[ta],i)) --ta;\n          \tqu[++ta]=i;\n          }\n        for(int i=1;i<=n;i++)\n          g[i]=f[i];\n      }\n    printf(\"%lld\",-sum[n]*sum[n]+m*f[n]);\n    return 0;\n}\n```\n",
        "postTime": 1521720357,
        "uid": 49206,
        "name": "Dispwnl",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    },
    {
        "content": "\u9996\u5148\u5c06\u7b54\u6848\u5316\u6210$\\min \\{m*\\sum x^2 -(\\sum x)^2 \\}$\n\n\u53d1\u73b0\u5982\u679c$n$\u4e2a\u8def\u6bb5\u7684\u957f\u5ea6\u4e0d\u53d8\u7684\u8bdd\uff0c$m$\u8d8a\u5927\u90a3\u4e48\u7b54\u6848\u8d8a\u5c0f\uff0c\u56e0\u4e3a\u6211\u53ef\u4ee5\u5c06\u4efb\u610f\u4e00\u5929\u62c6\u6210\u4e24\u5929\uff0c\u7136\u540e$(a+b)^2 > a^2+b^2$\n\n\u7136\u540e\u518d\u7406\u6027\u5730\u731c\u5b83\u662f\u4e0b\u51f8\u7684~~\u5e76\u4e0d\u4f1a\u8bc1\u660e~~\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4e0aWQS\u4e8c\u5206\u4e86\n\n\u5728\u8fd9\u91cc\u5207\u7ebf\u659c\u7387\u7684\u610f\u4e49\u5927\u6982\u662f\uff0c\u6211\u6bcf\u591a\u8d70\u4e00\u5929\u5c31\u8981\u591a\u4ed8\u51fa$slope$\u7684\u4ee3\u4ef7\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u659c\u7387\u4f18\u5316dp\u4e86\u3002\u590d\u6742\u5ea6$O(Nlog(\\sum x))$\uff0c0ms\u5feb\u7684\u98de\u8d77\u3002\n\n``` cpp\n#include<bits/stdc++.h>\n#define maxn 3010\n#define ll long long\nusing namespace std;\n\nint g[maxn],q[maxn],L,R,n,m;\nll sum[maxn],f[maxn];\nconst ll Inf=1LL<<40,eps=1e-9;\ninline ll sqr(ll x){\n\treturn x*x;\n}\ninline double slp(int x,int y){\n\treturn (double)(f[y]-f[x]+sqr(sum[y])-sqr(sum[x]))/(double)(sum[y]-sum[x]);\n}\nvoid solve(ll s){\n\tq[L=R=0]=0;\n\tfor(int i=1;i<=n;i++){\n\t\twhile(R-L>0&&slp(q[L],q[L+1])<2.0*sum[i]+eps)\n\t\t\tL++;\n\t\tf[i]=f[q[L]]+s+sqr(sum[i]-sum[q[L]]);\n\t\tg[i]=g[q[L]]+1;\n\t\twhile(R-L>0&&slp(q[R-1],q[R])>slp(q[R],i)-eps)\n\t\t\tR--;\n\t\tq[++R]=i;\n\t}\n} \nint main(){\n\tint x;\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%d\",&x),sum[i]=sum[i-1]+x;\n\tll l=0,r=sqr(sum[n]),ans;\n\twhile(l<r){\n\t\tll mid=l+r>>1;\n\t\tsolve(mid);\n\t\tif(g[n]>m)\n\t\t\tl=mid+1;\n\t\telse\n\t\t\tans=m*(f[n]-mid*m)-sqr(sum[n]),r=mid;\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1523943326,
        "uid": 31564,
        "name": "zhoutb2333",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    },
    {
        "content": "### \u5f81\u9014\n#### Solution\n\u3000\u3000\u7528$v_i$\u8868\u793a\u5c06\u6240\u6709\u9053\u8def\u5212\u5206\u51fa\u7684\u7b2c$\\text{i}$\u6bb5.\u9996\u5148\u9700\u8981\u5316\u7b80**\u65b9\u5dee$s^2$**\u8fd9\u4e2a\u5f0f\u5b50\n\u90a3\u4e48\u5bf9\u4e8e$v$\u524d$\\text{k}$\u9879\u7684\u65b9\u5dee\n$$s^2=\\frac{1}{k}\\sum_{i=1}^k(\\bar{v}-v_i)^2$$\n$$=-\\frac{1}{k^2}(\\sum\\limits_{i=1}^kv_i)^2+\\frac{1}{k}\\sum_{i=1}^kv_i^2$$\n\n\u5bf9\u4e8e\u6574\u4e2a\u6570\u5217$v$\u7684\u65b9\u5dee\n$$s^2=\\frac{1}{m^2}\\sum_{i=1}^mv_i^2-\\frac{1}{m}(\\sum\\limits_{i=1}^mv_i)^2$$\n\u56e0\u6b64\u7b54\u6848\u5c31\u662f\u6700\u5c0f\u5316\n$$s^2m^2=m\\sum_{i=1}^mv_i^2-(\\sum\\limits_{i=1}^mv_i)^2$$\n\u3000\u3000\u6211\u4eec\u9700\u8981\u505a\u7684\u5c31\u662f\u5212\u5206\u51fa$v_1,v_2,\\cdots ,v_m$.\u4ece\u800c\u4ea7\u751f\u6700\u5c0f\u7684$s^2m^2$.\u800c\u4e14\u53ef\u4ee5\u53d1\u73b0\u6700\u540e\u4e00\u9879, $(\\sum\\limits_{i=1}^kv_i)^2$\u4e3a\u5e38\u6570, \u5bf9\u7ed3\u679c\u6ca1\u6709\u5f71\u54cd, \u5bf9\u7ed3\u679c\u6709\u5f71\u54cd\u7684\u53ea\u6709$\\sum\\limits_{i=1}^kv_i^2$\u8fd9\u4e00\u9879, \u56e0\u6b64\u53ea\u8981\u4fdd\u8bc1\u5b83\u6700\u5c0f\u5c31\u80fd\u4fdd\u8bc1\u7b54\u6848\u6700\u5c0f.\n\u3000\u3000\u7528$f(k,j)$\u8868\u793a\u5212\u5206\u51fa$v_1,v_2,\\cdots ,v_k$\u7528\u4e86\u7ecf\u8fc7\u4e86\u524d$\\text{j}$\u6761\u9053\u8def, \u6700\u5c0f\u7684$\\sum\\limits_{i=1}^kv_i^2$, \u7528$d_i$\u8868\u793a\u9053\u8def\u957f\u5ea6, \u8f6c\u79fb\u65b9\u7a0b\u4e3a:\n\u3000\u3000$$f(k,j)=\\min{f(k-1,l)+(\\sum_{i=l+1}^j}d_i)^2$$\n\u3000\u3000\u90a3\u4e48\u53ea\u9700\u8981\u9012\u63a8\u51fa$f(m,n)$, \u518d\u52a0\u4e0a$(\\sum\\limits_{i=1}^mv_i)^2$\u4e3a\u7b54\u6848.\u8fd9\u6837\u4e3a$\\Theta(n^3)$, \u80fd\u5f97\u5230$\\text{80\\%}$\u7684\u5206\u6570.\n#### \u659c\u7387\u4f18\u5316\n\u5982\u679c\u7528$s_j$\u8868\u793a$\\sum\\limits_{i=1}^jd_i$, \u82e5\u4ecej\u8f6c\u79fb\u6bd4k\u66f4\u597d, \u5219:\n$$f(u,j)+(\\sum_{i=j+1}^pd_i)^2\\le f(u,k)+(\\sum_{i=k+1}^pd_i)^2 \\Leftrightarrow \\frac{f(u,j)-f(u,k)+s_j^2-s_k^2}{s_j-s_k}\\le 2s_i$$\n\u8fd9\u5c31\u662f\u90a3\u4e2a\u659c\u7387\u4f18\u5316\u7684\u5e38\u89c1\u5f0f\u5b50.\n#### \u6eda\u52a8\u6570\u7ec4\n\u3000\u3000\u5b8c\u5168\u53ef\u4ee5\u518d\u5c06\u4e8c\u7ef4\u538b\u6210\u4e00\u7ef4, \u867d\u7136\u6ca1\u6709\u5fc5\u8981.\n[attack](http://www.cnblogs.com/zwfymqz/p/8711337.html)\u8fd9\u4e2adl\u5199\u4e86\u53ef\u4ee5\u501f\u9274\u4e00\u4e0b.\n#### Code\n80\u5206\u672a\u52a0\u659c\u7387\u4f18\u5316\n```cpp\n#include<cstring>\n#include<cstdio>\n#define N 3005\n\nint f[N][N];\nint sl[N];\nint l[N];\nint n,m;\n\nint min(int a,int b){\n    return a<b?a:b;\n}\n\nint S(int l,int r){\n    return (sl[r]-sl[l-1])*(sl[r]-sl[l-1]);\n}\n\nint main(){\n    scanf(\"%d%d\",&n,&m);\n    memset(f,0x3f,sizeof(f));\n    for(int i=1;i<=n;++i)scanf(\"%d\",&l[i]);\n    for(int i=1;i<=n;++i)sl[i]=sl[i-1]+l[i];\n    f[0][0]=0;\n    for(int i=1;i<=m;++i)\n        for(int j=1;j<=n;++j)\n            for(int k=0;k<j;++k)\n                f[i][j]=min(f[i-1][k]+S(k+1,j),f[i][j]);\n    printf(\"%d\",m*f[m][n]-sl[n]*sl[n]);\n    return 0;\n}\n```\n\u52a0\u659c\u7387\u4f18\u5316, \u53ea\u662f\u56e0\u4e3a\u6ca1\u6709\u52a0double\u548c\u62ec\u53f7\u88ab\u5361\u4e86\u8001\u534a\u5929.\n```cpp\n#include<cstring>\n#include<cstdio>\n#include<queue>\n#define N 3005\n#define int long long\n\nint f[N][N];\nint que[N];\nint sl[N];\nint l[N];\nint n,m;\n\nint min(int a,int b){return a<b?a:b;}\ndouble slope(int u,int j,int k){return double(f[u][j]-f[u][k]+sl[j]*sl[j]-sl[k]*sl[k])/(double)(sl[j]-sl[k]);}\n\nmain(){\n\tscanf(\"%lld%lld\",&n,&m);\n\tmemset(f,0x3f,sizeof(f));\n\tfor(int i=1;i<=n;++i)scanf(\"%lld\",&l[i]);\n\tfor(int i=1;i<=n;++i)sl[i]=sl[i-1]+l[i];\n\tint h,t;\n\tf[0][0]=0;\n\tfor(int i=1;i<=n;i++)f[1][i]=sl[i]*sl[i];\n    for(int p=2;p<=m;p++){\n        h=1,t=0;\n        for(int i=1;i<=n;i++) { \n            while(h<t&&slope(p-1,que[h],que[h+1])<2*sl[i])h++;\n            int j=que[h];\n            f[p][i]=f[p-1][j]+(sl[j]-sl[i])*(sl[j]-sl[i]); \n            while(h<t&&slope(p-1,que[t-1],que[t])>slope(p-1,que[t],i))t--;\n            que[++t]=i;\n        }\n    }\n    int ans=m*f[m][n]-sl[n]*sl[n];\n    printf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1523070694,
        "uid": 39067,
        "name": "aiyougege",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    },
    {
        "content": "\u4e00\u5f00\u59cb\u80af\u5b9a\u8981\u628a\u9898\u76ee\u8981\u6c42\u7684\u5f0f\u5b50\u7ed9\u5199\u51fa\u6765\n\n\u6211\u4eec\u77e5\u9053\u65b9\u5dee\u7684\u516c\u5f0f$s^2=\\frac{\\sum\\limits_{i=1}^{m}(x_i-\\overline x)^2}{m}$\n\n\u9898\u76ee\u8981\u4e58$m^2$\u518d\u8f93\u51fa\uff0c\u4e8e\u662f\n\n$m^2s^2=m\\sum\\limits_{i=1}^{m}(x_i-\\overline x)^2$\n\n$=m(\\sum\\limits_{i=1}^{m}x_i^2-2\\overline{x}\\sum\\limits_{i=1}^{m}x_i+m\\overline{x}^2)$\n\n$=m\\sum\\limits_{i=1}^{m}x_i^2-(\\sum\\limits_{i=1}^{m}x_i)^2$\n\n\u4e8e\u662f\u53ea\u8981\u6700\u5c0f\u5316$\\sum\\limits_{i=1}^{m}x_i^2$\u5373\u53ef\u3002\n\n\u7136\u800c\u9009$m$\u6bb5\u975e\u5e38\u4e0d\u597d\u529e\u3002\u8fd9\u65f6\u5019\u53ef\u4ee5\u8054\u60f3\u5230\u51f8\u4f18\u5316\u3002\u8bbe$G_m$\u8868\u793a\u9009$m$\u6bb5$\\sum\\limits_{i=1}^{m}x_i^2$\u7684\u6700\u5c0f\u503c\uff0c\u5f53$m$\u589e\u5927\u7684\u65f6\u5019$G_m$\u663e\u7136\u4f1a\u51cf\u5c0f\uff0c~~\u51ed\u849f\u84bb\u7684\u611f\u6027\u7406\u89e3~~\uff0c\u591a\u5206\u51fa\u4e00\u6bb5\u5bf9\u7b54\u6848\u7684\u5f71\u54cd\u5e45\u5ea6\u4e5f\u8d8a\u6765\u8d8a\u5c0f\uff0c\u4e5f\u5c31\u662f\u8bf4$G_x$\u5173\u4e8e$x$\u7684\u51fd\u6570\u56fe\u50cf\u5927\u6982\u662f\u4e0b\u51f8\u7684\u3002\n\n\u6211\u4eec\u7528\u4e00\u4e2a\u659c\u7387\u4e3a$mid$\u7684\u76f4\u7ebf\u53bb\u5207\u8fd9\u4e2a\u51f8\u5305\u3002\u663e\u7136$mid$\u7684\u4e0b\u754c\u53d6$[0,1]$\u4e4b\u95f4\u7684\u659c\u7387\uff0c\u662f\u603b\u8def\u7a0b\u5e73\u65b9\u7ea7\u522b\u7684\uff0c\u4e0a\u754c\u662f$0$\u3002\u56e0\u4e3a\u5207\u7ebf\u5728\u51f8\u5305\u7684\u4e0b\u65b9\uff0c\u6240\u4ee5\u591a\u9009\u4e00\u6bb5\u7684\u4ee3\u4ef7\u4e0d\u662f$+mid$\u800c\u662f$-mid$\u3002\n\nupdate:\u849f\u84bb\u5f03\u7528\u4e86\u7528\u76f4\u7ebf\u5207\u51f8\u5305\u7684\u7406\u89e3\u65b9\u6cd5\uff0c\u849f\u84bb\u7528\u5bfc\u6570\u601d\u60f3\u7406\u89e3DP\u51f8\u4f18\u5316\u7684\u601d\u8def\u53ef\u4ee5\u770b[\u8fd9\u91cc](https://www.cnblogs.com/flashhu/p/9480669.html)\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u659c\u7387\u4f18\u5316\u7684\u8fc7\u7a0b\u3002\u8bbe$f_i$\u4e3a\u524d$i$\u6761\u8def\u7684\u6700\u4f18\u7b54\u6848\uff0c$x_i$\u4e3a\u8def\u7a0b\u957f\u5ea6\u7684\u524d\u7f00\u548c\uff0c\u5199\u51fa\u8f6c\u79fb\u65b9\u7a0b\n\n$f_i=\\min\\limits_{j=0}^{i}\\{f_j-2x_ix_j+x_j^2\\}+x_i^2$\n\n\u51b3\u7b56$j$\u4f18\u4e8e$k$\u5f53\u4e14\u4ec5\u5f53\n\n$f_j-2x_ix_j+x_j^2<f_k-2x_ix_k+x_k^2$\n\n$\\frac{f_j+x_j^2-f_k-x_k^2}{x_j-x_k}<2x_i$\n\n\u4e8e\u662f\u8bbe$y_i=f_i+x_i^2$\uff0c\u628a\u51b3\u7b56\u770b\u6210\u70b9$(x_i,y_i)$\uff0c\u4f7f\u7528\u5355\u8c03\u961f\u5217\u5c31OK\u4e86\u3002\u6ce8\u610f\u8fd9\u91cc\u8981\u8bb0$c_i$\u8868\u793a\u6700\u4f18\u51b3\u7b56\u4e0b\u5c06\u524d$i$\u6761\u8def\u5206\u51fa\u7684\u6bb5\u6570\u3002\u6700\u540e\u5224\u65ad$c_n$\u4e0e$m$\u7684\u5173\u7cfb\u6765\u8c03\u6574\u659c\u7387\u3002\n\n\u7531\u4e8e\u8fd9\u4e00\u9898\u7684\u659c\u7387\u80af\u5b9a\u4e0d\u4f1a\u6709\u5c0f\u6570\uff0c\u6545\u4e5f\u4e0d\u5fc5\u62c5\u5fc3\u4e8c\u5206\u4e2d\u7684\u4e00\u4e9b\u8fb9\u754c\u95ee\u9898\u3002\n\n```cpp\n#include<cstdio>\n#define RG register\n#define R RG int\n#define G c=getchar()\n#define Calc(j,k) (y[j]-y[k])/(x[j]-x[k])\ntypedef long long LL;\nconst int N=3009;\nint n,q[N],c[N];\ndouble f[N],k[N],x[N],y[N];\ninline int in(){\n\tRG char G;\n\twhile(c<'-')G;\n\tR x=c&15;G;\n\twhile(c>'-')x=x*10+(c&15),G;\n\treturn x;\n}\ninline double sqr(RG double x){\n\treturn x*x;\n}\ninline void work(R mid){//\u659c\u7387\u4f18\u5316\n\tR h,t,i;\n\tfor(h=t=i=1;i<=n;++i){\n\t\twhile(h<t&&k[h]<2*x[i])++h;\n\t\tf[i]=f[q[h]]+sqr(x[i]-x[q[h]])-mid;//\u6bcf\u8f6c\u79fb\u4e00\u6b21\u8981\u51cf\u4e00\u4e0bmid\n\t\ty[i]=f[i]+sqr(x[i]);\n\t\tc[i]=c[q[h]]+1;//\u8bb0\u5f55\u6bb5\u6570\n\t\twhile(h<t&&k[t-1]>Calc(q[t],i))--t;\n\t\tk[t]=Calc(q[t],i);q[++t]=i;\n\t}\n}\nint main(){\n\tn=in();R m=in(),l,r,mid,i;\n\tfor(i=1;i<=n;++i)x[i]=x[i-1]+in();\n\tl=-sqr(x[n]);r=0;//\u5927\u81f4\u786e\u5b9a\u4e0b\u754c\n\twhile(l<r){\n\t\twork(mid=(l+r+1)/2);//\u6ce8\u610f\u8d1f\u6570\u7684\u4e0b\u53d6\u6574\u95ee\u9898\n\t\tc[n]<=m?l=mid:r=mid-1;\n\t}\n\twork(l);\n\tprintf(\"%.0lf\\n\",m*(f[n]+m*l)-sqr(x[n]));//\u5148\u52a0\u56dem*l\n\treturn 0;\n}\n```",
        "postTime": 1535381741,
        "uid": 61325,
        "name": "FlashHu",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    },
    {
        "content": "\u56e0\u4e3a\u5feb\u8bfbWA\u4e86\u4e00\u7248\u6709\u70b9\u65e0\u8bed\uff08\u81f3\u4eca\u672a\u67e5\u51fa\u6bdb\u75c5\uff09\u3002\n\n\n\u5148\u4e0d\u7ba1\u8fd9\u4e9b\u3002\u62ff\u5230\u9898\u76ee\uff0c\u9996\u5148\u63a8\u4e00\u6ce2\u5f0f\u5b50\uff1a\n\n\n\n\n$m^2s^2=m\\sum^m_{i=1}(x_i-\\overline{x})^2$\n\n\n$=m\\sum^m_{i=1}x_i^2-2s_n\\sum_{i=1}^mx_i+s_n^2$\n\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u5f00\u59cb\u8bb0dp\u8ba1\u7b97\u3002\n\n\n$dp[i][l]=\\min\\{dp[j][l-1]+m(s_i-s_j)^2-2s_n(s_i-s_j)\\}$\n\n\n\u90a3\u4e48\u7b54\u6848\u5c31\u662f$dp[n][m]+s_n^2$\u3002\n\n\n\u53d1\u73b0\u8f6c\u79fb\u5177\u6709\u5355\u8c03\u6027\uff0c\u4f7f\u7528\u659c\u7387\u4f18\u5316\u3002\n\n\n\u8bbe\n\n$y_i=dp[i]+2s_ns_j+ms_j^2$\n\n\n$x_i=s_i-s_j$\n\n\n\u90a3\u4e48\u82e5j\u6bd4k\u66f4\u4f18\uff0c\u5219$\\frac{y_j-y_k}{x_j-x_k}< 2ms_i$\n\n\u5229\u7528\u5355\u8c03\u961f\u5217\u8f6c\u79fb\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(nm)$\u3002\n\n\n\u4ee3\u7801\uff1a\n\n    \n```cpp\n    // luogu-judger-enable-o2\n    #include<bits/stdc++.h>\n    #include<cctype>\n    #define For(i,a,b) for(i=(a),i##end=(b);i<=i##end;++i)\n    #define Forward(i,a,b) for(i=(a),i##end=(b);i>=i##end;--i)\n    #define Rep(i,a,b) for(register int i=(a),i##end=(b);i<=i##end;++i)\n    #define Repe(i,a,b) for(register int i=(a),i##end=(b);i>=i##end;--i)\n    #define Chkmax(a,b) a=a>b?a:b\n    #define Chkmin(a,b) a=a<b?a:b\n    using namespace std;\n    template<typename T>inline void read(T &x){\n        T s=0,f=1;char k=getchar();\n        while(!isdigit(k)&&k^'-')k=getchar();\n        if(!isdigit(k)){f=-1;k=getchar();}\n        while(isdigit(k)){s=s*10+(k^48);k=getchar();}\n        x=s*f;\n    }\n    inline void get(char &x){for(x=0;!isupper(x);x=getchar());}\n    void file(void){\n        #ifndef ONLINE_JUDGE\n        freopen(\"water.in\",\"r\",stdin);\n        freopen(\"water.out\",\"w\",stdout);\n        #endif\n    }\n    const int MAXN=4017;\n    static int s[MAXN],n,m;\n    void init()\n    {\n        read(n);read(m);\n        Rep(i,1,n)scanf(\"%d\",&s[i]),s[i]+=s[i-1];//\u8ff7\u4e4b\u539f\u56e0\u8fd9\u91cc\u7528\u5feb\u8bfb(read)\u8bfb\u53d6s\u4f1are\u4e24\u4e2a\u70b9\n    }\n    static long long dp[MAXN][MAXN];\n    #define calcy(x,pos) (1ll*dp[x][pos]+2ll*s[n]*s[x]+1ll*m*s[x]*s[x])\n    #define calup(x,y,pos) (calcy(x,pos)-calcy(y,pos))\n    #define caldown(x,y) (1ll*s[x]-1ll*s[y])\n    static int que[MAXN],t,h;\n    inline void makeans(int i,int j)\n    {\n        static int hed;\n        for(hed=que[h];t-h&&calup(que[h+1],hed,j-1)\n            <2ll*m*s[i]*caldown(que[h+1],hed);hed=que[++h]);\n        dp[i][j]=dp[hed][j-1]+1ll*m*caldown(i,hed)*caldown(i,hed)\n            -2ll*s[n]*caldown(i,hed);\n    }\n    inline void insert(int i,int j)\n    {\n       static int tal;\n       for(tal=que[t];t-h&&calup(i,tal,j)*caldown(tal,que[t-1])\n            <calup(tal,que[t-1],j)*caldown(i,tal);tal=que[--t]);\n       que[++t]=i;\n    }\n    void solve()\n    {\n        Rep(i,1,n)dp[i][1]=1ll*m*s[i]*s[i]-2ll*s[n]*s[i];\n        Rep(j,2,m)\n        {\n            que[t=h=1]=0;\n            Rep(i,1,n)\n            {\n                makeans(i,j);\n                insert(i,j-1);\n            }\n        }\n        printf(\"%lld\\n\",dp[n][m]+s[n]*s[n]);\n    }\n    int main(void){\n        file();\n        init();\n        solve();\n        //cerr<<1.0*clock()/CLOCKS_PER_SEC<<endl;\n        return 0;\n    }\n\u987a\u4fbf\u4e00\u8bf4\uff0c\u5982\u679c\u77e5\u9053\u4e3a\u4ec0\u4e48\u4e0a\u9762\u7528\u5feb\u8bfb\u4f1are\uff0c\u8bf7\u8054\u7cfb\u6211\u3002\n```",
        "postTime": 1515834934,
        "uid": 7035,
        "name": "Great_Influence",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u6211\u4eec\u5148\u628a\u7ed3\u679c\u7684\u8868\u8fbe\u5f0f\u5316\u7b80\u4e00\u4e0b\n\n\u5047\u8bbe\u7b2c$i$\u5929\u8d70\u4e86$x_i$\uff0c\u603b\u8def\u7a0b\u4e3a$S$\n\n\u90a3\u4e48$ans=m^2\\times \\frac{\\sum \\limits_{i=1}^m(x_i-\\frac{S}{m})^2}{m}=\\frac{\\sum\\limits_{i=1}^m(mx_i-S)^2}{m}=\\frac{m^2\\sum \\limits_{i=1}^mx_i^2+S^2m-2Sm\\sum \\limits_{i=1}^mx_i}{m}=m\\sum \\limits_{i=1}^{m}x_i^2+S^2-2S^2=m\\sum \\limits_{i=1}^{m}x_i^2-S^2$\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u6700\u5c0f\u7684$\\sum \\limits_{i=1}^mx_i^2$\n\n\u5047\u8bbe$f_{i,j}$\u8868\u793a\u7528$j$\u5929\u8d70\u5b8c\u524d$i$\u6bb5\u65f6\uff0c\u6700\u5c0f\u7684$\\sum \\limits_{k=1}^jx_k^2$\u7684\u503c\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u5148\u9884\u5904\u7406\u51fa$sum_i$\u8868\u793a\u524d$i$\u6bb5\u7684\u957f\u5ea6\u4e4b\u548c\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5199\u51fa\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\uff1a$f_{i,j}=\\min \\limits_{1\\leqslant k<i}\\{f_{k,j-1}+(sum_i-sum_k)^2\\}$\n\n\u663e\u7136\uff0c\u8fd9\u4e48\u505a\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u592a\u9ad8\u4e86\uff0c\u6211\u4eec\u9700\u8981\u8fdb\u884c\u4f18\u5316\n\n\u600e\u4e48\u4f18\u5316\u5462\uff1f\u6211\u4eec\u8003\u8651$k$\u6bd4$l$\u4f18\uff0c\u90a3\u4e48\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\uff1a\n\n$f_{k,j-1}+sum_k^2+sum_i^2-2sum_ksum_i<f_{l,j-1}+sum_l^2+sum_i^2-2sum_isum_l$\n\n$f_{k,j-1}-f_{l,j-1}+sum_k^2-sum_k^2<2sum_i(sum_k-sum_l)$\n\n$\\frac{f_{k,j-1}-f_{l,j-1}+sum_k^2-sum_k^2}{sum_k-sum_l}<2sum_i$\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u884c\u659c\u7387\u4f18\u5316\u4e86\uff01\n\n\u9644\u4e0a\u4ee3\u7801\uff1a\n```cpp\n#include<cstdio>\nint n,m,l,r;\nlong long a[3010],sum[3010],f[3010],fl[3010],q[3010];\nlong long K(int x,int y)\n{\n\treturn (fl[y]-fl[x]+sum[y]*sum[y]-sum[x]*sum[x])/(sum[y]-sum[x]);\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&m),sum[0]=0;\n    for(int i=1;i<=n;i++) scanf(\"%lld\",&a[i]),sum[i]=sum[i-1]+a[i];\n    for(int i=1;i<=n;i++) fl[i]=sum[i]*sum[i];\n    for(int i=2;i<=m;i++){\n        l=r=1,q[l]=i-1;\n        for(int j=i;j<=n;j++){\n            while(l<r&&K(q[l],q[l+1])<2*sum[j]) l++;\n            f[j]=fl[q[l]]+(sum[j]-sum[q[l]])*(sum[j]-sum[q[l]]);\n            while(l<r&&K(q[r-1],q[r])>K(q[r],j)) r--;\n            q[++r]=j;\n        }\n        for(int j=1;j<=n;j++) fl[j]=f[j];\n    }\n    printf(\"%lld\",m*f[n]-sum[n]*sum[n]);\n}\n```",
        "postTime": 1585197842,
        "uid": 43373,
        "name": "jacky567",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    },
    {
        "content": "\u8fd9\u9053\u9898\u539f\u6765\u6211\u5df2\u7ecf\u505a\u8fc7\u4e00\u904d\u4e86\u3002\u3002\u3002\n\n\u672c\u6765\u662f\u659c\u7387\u4f18\u5316\u6765\u7740\uff0c\u88ab\u6211\u6de6\u6210\u4e86\u56db\u8fb9\u5f62\u4f18\u5316\u3002\n\n\u8c8c\u4f3c\u9898\u89e3\u533a\u5927\u591a\u6570\u90fd\u662f\u659c\u7387\u4f18\u5316\uff0c\u6de6\u3002\n\n\u91cd\u65b0\u5199\u4e00\u4e0b\u659c\u7387\u4f18\u5316\u5427\u3002\n\n## \u65b9\u6cd5\u4e00 \u659c\u7387\u4f18\u5316\n\n\u8bb0\u524d\u7f00\u548c$s_i$\n\n\u7b54\u6848\u4e2d${s_n}^2$\u7684\u8d21\u732e\u5148\u4e0d\u7b97\u3002\n\n\u90a3\u4e48\u65b9\u7a0b\u4e3a\n\n$f_{i,k}=f_{j,k-1}+(s_i-s_j)^2=f_{j,k-1}+{s_i}^2-2s_is_j+{s_j}^2$\n\n$f_{j,k-1}+{s_j}^2=(2*s_i)*s_j+{s_i}^2-f_{i,k}$\n\n\u53d1\u73b0\u662f\u4e00\u6761\u659c\u7387\u4e3a$2*s_i$\u7684\u76f4\u7ebf\uff0c\u4e14$s_i$\u5173\u4e8e$i$\u9012\u589e\u800c\u9012\u589e\u3002\n\n\u90a3\u4e48\u7ef4\u62a4\u4e00\u4e0b\u51f8\u58f3\u5373\u53ef\u3002\n\n## \u65b9\u6cd5\u4e8c \u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\u4f18\u5316\n\n\u663e\u7136\u5730\uff0c$s_{i,j+1}+s_{i+1,j}\\ge s_{i,j}+s_{i+1,j+1}$\uff0c\u6ee1\u8db3\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\n\n\u8fd9\u91cc\u7684$s_{i,j}$\u8868\u793a$i$\u5230$j$\u7684\u533a\u95f4\u548c\u3002\n\n\u73b0\u5728\u53ea\u9700\u8981\u641e\u5b9a$f_{i,j+1}+f_{i+1,j}\\ge f_{i,j}+f_{i+1,j+1}$\u5c31\u597d\u4e86\u3002\n\n\u8bc1\u660e$j=1$\u7684\u60c5\u51b5\u3002\n\n$f_{i,2}+f_{i+1,1}\\ge f_{i,1}+f_{i+1,2}$\n\n$f_{i,2}+s_{1,i+1}\\ge f_{i+1,2}+s_{1,i}$\n\n\u8bbe$f_{i,2}$\u7684\u6700\u4f18\u51b3\u7b56\u4e3a$p(0<p<i)$,\u5373$f_{i,2}=s_{1,p}+s_{p+1,i}$\n\n\u8fd8\u6709$f_{i+1,2}$\u7684\u6700\u4f18\u51b3\u7b56\u53ef\u80fd\u4e0d\u4e3a$p$\uff0c\u5373$f_{i+1,2}\\le s_{1,p}+s_{p+1,i+1}$\n\n\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f,\n$s_{1,i+1}+s_{p+1,i}\\ge s_{1,i}+s_{p+1,i+1}$\n\n\u6709$s_{1,i+1}+s_{1,p}+s_{p+1,i}\\ge s_{1,i}+s_{1,p}+s_{p+1,i+1}$\n\n\u56e0\u6b64\n$f_{i,2}+f_{i+1,1}=s_{1,i+1}+s_{1,p}+s_{p+1,i}\\ge s_{1,i}+s_{1,p}+s_{p+1,i+1}\\ge f_{i,1}+f_{i+1,2}$\n\n\u4e4b\u540e\u5957\u8bc1\u660e\u6a21\u677f\u5c31\u597d\u4e86\u3002\n\n\u8fd9\u9053\u9898\u5947\u5947\u602a\u602a\u2642\n\n```cpp\n#include<cstdio>\n#include<cstdlib>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\n#define gc getchar()\n#define ll long long\nusing namespace std;\nconst int N=3005,mod=1e9+7,M=1e6;\ntemplate<class o>\ninline void qr(o &x)\n{\n\tx=0;char c=gc;int f=1;\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=gc;}\n\twhile(c>='0'&&c<='9'){x=x*10+(c^48);c=gc;}\n\tx*=f;\n}\ntemplate<class o>\nvoid qw(o x)\n{\n\tif(x<0)putchar('-'),x=-x;\n\tif(x/10)qw(x/10);\n\tputchar(x%10+48);\n}\nint a[N],p[N][N];ll sum[N],f[N][N];\nint main()\n{\n\tint n,m;qr(n);qr(m);ll s=0;\n\tfor(int i=1;i<=n;i++)qr(a[i]),sum[i]=a[i]+sum[i-1];\n\tmemset(f,0x3f,sizeof(f));\n\tfor(int i=1;i<=n;i++)f[1][i]=sum[i]*sum[i],p[1][i]=1;\n\tfor(int t=2;t<=m;t++)\n\t{\n\t\tp[t][n+1]=n;\n\t\tfor(int i=n;i;i--)\n\t\t\tfor(int k=p[t-1][i];k<=p[t][i+1];k++)\n\t\t\t\tif(f[t-1][k]+(sum[i]-sum[k])*(sum[i]-sum[k])<f[t][i])\n\t\t\t\t{\n\t\t\t\t\tf[t][i]=f[t-1][k]+(sum[i]-sum[k])*(sum[i]-sum[k]);\n\t\t\t\t\tp[t][i]=k;\n\t\t\t\t}\n\t}\n\tint t=m,k=n;s=-sum[n]*sum[n];\n\twhile(k)\n\t{\n\t\tint z=p[t][k];if(z==1&&t==1)z=0;\n\t\ts+=m*(sum[k]-sum[z])*(sum[k]-sum[z]);\n\t\tt--;k=z;\n\t}\n\tqw(s);puts(\"\");\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1562202814,
        "uid": 106232,
        "name": "_Sein",
        "ccfLevel": 0,
        "title": "[SDOI2016]\u5f81\u9014"
    },
    {
        "content": "\u9996\u5148\u53ef\u4ee5\u53d1\u73b0\u6c42\u5f97\u7b54\u6848\u662f (\u2211(w - sum[n]/m)^2)/m \\*m^2\n\n\n\u5316\u7b80\u53ef\u5f97 (\u2211(w\\*m-w)^2)/m\n\n\n\u5bb9\u6613\u5217\u51fa\u65b9\u7a0bf[i][j]\u8868\u793a\u5728\u7b2ci\u4e2a\u4eba\u5df2\u7ecf\u5206\u4e86j\u5757\u7684\u6700\u5c0f\u65b9\u5dee\u3002\n\n\n\u5373f[i][j] = min(f[j - 1][i - 1] + sum[i] - sum[j-1]);\n\n\n\u90a3\u4e48\u65f6\u95f4\u590d\u6742\u5ea6O(n\\*n\\*m)\n\n\n\u8003\u8651\u4f18\u5316\uff0c\u82e5j > k \u540c\u65f6\u6ee1\u8db3j\u4f18\u4e8ek\n\n\nf[j - 1] + sum[i] - sum[j-1]) < f[k - 1] + sum[i] - sum[k-1]);\n\n\n\u5316\u7b80\u53ef\u5f97\uff1a\n\n\n((f[j-1]-f[k-1])/(sumj-sumk)) + 2 \\* m\\*m\\*(sumj + sumk) < 2\\*m\\*(sumi - sum[n])\n\n\n\u5f88\u660e\u663e\u659c\u7387\u4f18\u5316\u3002\n\n\n\u65f6\u95f4\u590d\u6742\u5ea6O(nm)\n\n\u641e\u5b9a\u3002\n\n\n[\u535a\u5ba2~](http://tgotp.science/4518-sdoi2016%E5%BE%81%E9%80%94/)\n\nc++\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,x,y) for(register int i = x ; i <= y; ++ i)\n#define repd(i,x,y) for(register int i = x ; i >= y; -- i)\nusing namespace std;\ntypedef long long ll;\ntemplate<typename T>inline bool chkmin(T&x,T y) { return x > y ? x = y,1:0; }\ntemplate<typename T>inline void read(T&x)\n{\n    x = 0;char c;int sign = 1;\n    do { c = getchar(); if(c == '-') sign = -1; }while(!isdigit(c));\n    do { x = x * 10 + c - '0'; c = getchar(); }while(isdigit(c));\n    x *= sign;\n}\n \nconst int N = 3e3 + 50,inf = 0x3f3f3f3f;\nint n,m,q[N][N],st[N],en[N];ll f[N][N],a[N],sum[N];\n \ndouble slop(int x,int y,int p) { return ((f[p][x] - f[p][y]) / (double)(sum[x] - sum[y])) + (sum[x] + sum[y]) * m*m ; }\n \nint main()\n{\n    read(n); read(m);\n    rep(i,1,n) read(a[i]),sum[i] = sum[i - 1] + a[i];\n     \n    rep(i,1,m) f[i][0] = inf;\n    rep(i,1,n) f[1][i] = (sum[i]*m - sum[n]) * (sum[i]*m - sum[n]);\n    rep(i,1,n)\n    {\n        rep(j,2,m)\n        {\n            #define x q[j][st[j] + 1] - 1\n            #define y q[j][st[j]] - 1\n            #define a q[j][en[j] - 2] - 1\n            #define b q[j][en[j] - 1] - 1\n             \n            while(en[j] - st[j] > 1 && slop(i - 1,b,j - 1) < slop(b,a,j - 1)) --en[j];\n            q[j][en[j]++] = i;\n                 \n            while(en[j] - st[j] > 1 && slop(x,y,j - 1) < 2 * (sum[i]*m - sum[n]) * m ) ++st[j];\n            f[j][i] =  f[j - 1][y] + ((sum[i] - sum[y])*m - sum[n]) * ((sum[i] - sum[y]) * m - sum[n]);\n             \n//          printf(\"%d %d %lld %d\\n\",j-1,i,f[j - 1][i],y);\n//          printf(\"%d %d %lld %d\\n\",j,i,f[j][i],y);\n        } \n    }\n     \n    cout << f[m][n] / m<< endl;\n     \n    return 0;\n}\n```",
        "postTime": 1516800662,
        "uid": 23087,
        "name": "Tgotp",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    },
    {
        "content": "# [\u9898\u9762](https://www.luogu.org/problemnew/show/P4072)\n[\u60f3\u4f53\u9a8c\u66f4\u52a0\u8212\u9002\u7684\u4f53\u9a8c\u53ef\u4ee5\u8fdb\u535a\u5ba2\u770b\u4e00\u4e0b](https://www.cnblogs.com/ztlztl/p/10623347.html)\n(~~\u535a\u5ba2\u8fdb\u53bb\u6709\u70b9\u6162, \u5927\u5bb6\u4f53\u8c05\u4e00\u4e0b~~)\n\n\u9898\u610f\u4f53\u9762\u4e2d\u5199\u5f97\u5f88\u660e\u786e, \u5e94\u8be5\u4e0d\u7528\u6211\u8bf4\u4e86, \u65b9\u5dee\u7684\u6982\u5ff5\u5728\u521d\u4e2d\u4eba\u6559\u7248\u4e5d\u5e74\u7ea7\u6570\u5b66\u4e2d\u6709\u6240\u63d0\u5230, \u6ca1\u6709\u4e0a\u8fc7\u521d\u4e2d\u7684\u540c\u5b66\u4eec\u53ef\u4ee5[\u5de6\u8f6c](https://baike.baidu.com/item/%E6%96%B9%E5%B7%AE/3108412?fr=aladdin)[\u767e\u5ea6](https://www.baidu.com/).\n\n\u5c06\u5e8f\u5217\u62c6\u4e3a\u51e0\u6bb5\u6c42\u6700\u503c, \u6211\u4eec\u8003\u8651\u7528dp\u6765\u5b9e\u73b0. \n\n\u5148\u63a8\u4e00\u4e0b\u5f0f\u5b50, \u4ee4\u65b9\u5dee\u4e3a$v$, $r$\u4e3a\u67d0\u4e00\u6bb5\u8def\u5f84\u7684\u957f\u5ea6, $\\overline r$\u4e3a\u8fd9$m$\u6761\u8def\u5f84\u957f\u5ea6\u7684\u5e73\u5747\u6570.\n\n\u5219\u6709:\n$$\n\\begin{aligned}\nv &= \\frac{\\sum_{i=1}^{m}(\\overline r - r_i)^2}{m}\\\\\n  &= \\frac{\\sum_{i=1}^{m}r_i^2 + m * (\\overline r)^2 - 2 * (\\overline r) * \\sum_{i=1}^{m}r_i}{m}\\\\\n  &= \\frac{\\sum_{i=1}^{m}r_i^2 + m * (\\frac{\\sum_{i=1}^{m}r_i}{m})^2 - 2 * \\frac{(\\sum_{i=1}^{m}r_i)^2}{m}}{m}\\\\\n  &=- \\frac{(\\sum_{i=1}^{m}r_i)^2}{m ^ 2} + \\frac{\\sum_{i=1}^{m}r_i^2}{m}\n\\end{aligned}\n$$\n\u7b54\u6848\u6240\u6c42\u4e3a$v * m ^ 2$, \u6240\u4ee5:\n$$\n\\begin{aligned}\nv * m ^ 2 &= m * \\sum_{i=1}^{m}r_i^2 - (\\sum_{i=1}^{m}r_i) ^ 2\\\\\n\\end{aligned}\n$$\n\u6211\u4eec\u53d1\u73b0$(\\sum_{i=1}^{m}r_i) ^ 2$\u662f\u4e00\u4e2a\u5b9a\u503c, \u4e5f\u5c31\u662f\u603b\u8def\u5f84\u957f\u5ea6\u7684\u5e73\u65b9, \u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u6c42\u524d\u9762\u90a3\u4e2a\u6570\u5c31\u53ef\u4ee5\u4e86, \u7528\u524d\u7f00\u548c\u5148\u5904\u7406\u4e00\u4e0b, \u5373$S_i$\u8868\u793a1 ~ i\u7684\u8def\u5f84\u7684\u957f\u5ea6.\n\n\u6211\u4eec\u8bbe$f[i][k]$\u8868\u793a\u524d$i$\u6bb5\u8def\u82b1$k$\u5929\u8d70\u7684\u6700\u5c0f\u82b1\u8d39, \u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b: \n$$\nf[i][k] = min(f[i][k], f[j][k - 1] + (sum[j] - sum[i])^2)\n$$\n\u8fd8\u662f\u8001\u5957\u8def, \u8bbe\u5bf9$i$\u70b9\u9009$t$($t$ > $j$)\u8f6c\u79fb\u6bd4\u9009$j$\u8f6c\u79fb\u66f4\u4f18, \u5219\u6709:\n$$\n\\begin{aligned}\nf[t][k - 1] + (sum[t] - sum[i])^2 &< f[j][k - 1] + (sum[j] - sum[i]) ^ 2\\\\\n(f[t][k - 1] + sum[t] ^ 2) - (f[j][k - 1] + sum[j] ^ 2) &< 2 * sum[i] * (sum[t] - sum[j])\\\\\n\\frac{(f[t][k - 1] + sum[t] ^ 2) - (f[j][k - 1] + sum[j] ^ 2)}{2 * (sum[t] - sum[j])} &< sum[i]\n\\end{aligned}\n$$\n\n\n\u7531\u6b64\u53ef\u77e5\u9053\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u4e0a\u51f8\u5305, \u4e0d\u4fe1\u7684\u8bdd\u9009\u4e09\u4e2a\u70b9\u8bd5\u4e00\u4e0b\u5c31\u53ef\u4ee5\u53d1\u73b0\u4e86, \u7136\u540e\u6109\u5feb\u7684\u63a8\u5f0f\u5b50\u65f6\u95f4\u53c8\u7ed3\u675f\u4e86, \u4e0b\u9762\u662f\u5927\u5bb6\u559c(shen)\u95fb(wu)\u4e50(tong)\u89c1(jue)\u7684$Coding Time$... \n\n**\u4ee3\u7801**\n\n```cpp\n#include <iostream>\n#include <cstring>\n#include <cstdio>\n#define N 3005\nusing namespace std;\n\nint n, m, sum[N], q[N], l, r;\nlong long f[N], g[N]; \n\ninline int read()\n{\n\tint x = 0, w = 1;\n\tchar c = getchar();\n\twhile(c < '0' || c > '9') { if (c == '-') w = -1; c = getchar(); }\n\twhile(c >= '0' && c <= '9') { x = x * 10 + c - '0'; c = getchar(); }\n\treturn x * w;\n}\n\nbool F_check(int x, int y, int z) { return 1ll * (g[y] - g[x] + sum[y] * sum[y] - sum[x] * sum[x]) < 1ll * 2 * z * (sum[y] - sum[x]); } \n\nbool S_check(int x, int y, int z) { return (g[y] - g[x] + sum[y] * sum[y] - sum[x] * sum[x]) * (sum[z] - sum[y]) > (g[z] - g[y] + sum[z] * sum[z] - sum[y] * sum[y]) * (sum[y] - sum[x]); }\n\nint main()\n{\n\tn = read(); m = read();\n\tfor(int i = 1; i <= n; i++) { sum[i] = read(); sum[i] += sum[i - 1]; g[i] = 1ll * sum[i] * sum[i]; }\n\tfor(int k = 1; k < m; k++)\n\t{\n\t\tl = 1; r = 0; q[++r] = k; \n\t\tfor(int i = k + 1; i <= n; i++)\n\t\t{\n\t\t\twhile(l < r && F_check(q[l], q[l + 1], sum[i])) l++;\n\t\t\tf[i] = g[q[l]] + 1ll * (sum[i] - sum[q[l]]) * (sum[i] - sum[q[l]]);\n\t\t\twhile(l < r && S_check(q[r - 1], q[r], i)) r--;\n\t\t\tq[++r] = i; \n\t\t}\n\t\tfor(int i = 1; i <= n; i++) g[i] = f[i]; \n\t}\n\tprintf(\"%lld\\n\", m * f[n] - sum[n] * sum[n]); \n\treturn 0;\n}\n```\n\n~~\u4e0d\u77e5\u9053\u4ea4\u4e86\u591a\u5c11\u904d\u624d**AC**\u7684\u83dc\u9e21\u6211~~",
        "postTime": 1553857999,
        "uid": 160323,
        "name": "mgzc",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    },
    {
        "content": "\u6253\u5e7f\u544a->[\u8fd9\u91cc](https://i.cnblogs.com/EditPosts.aspx?postid=9547048)\n\n\u63a8\u5f0f\u5b50\uff08\u5feb\u54ed\u4e86\u2026\u2026\uff09$$s^2*m^2=\\sum _{i=1}^m (x_i-\\bar{x})^2$$\n\n$$s^2*m^2=m*\\sum _{i=1}^m x_i^2-2*sum_n\\sum _{i=1}^m x_i+sum_n^2$$\n\n$$s^2*m^2=m*\\sum _{i=1}^m x_i^2+(sum_n-\\sum _{i=1}^m x_i)^2-(\\sum _{i=1}^m x_i)^2$$\n\n\u7136\u540e\u56e0\u4e3a$sum_n$\u548c$\\sum _{i=1}^m x_i$\u4e24\u9879\u662f\u5b9a\u503c\uff0c\u4e14\u503c\u76f8\u7b49\uff0c\u6240\u4ee5$$s^2*m^2=m*\\sum _{i=1}^m x_i^2-(\\sum _{i=1}^m x_i)^2$$\n\n\u6211\u4eec\u53d1\u73b0$(\\sum _{i=1}^m x_i)^2$\u662f\u4e00\u4e2a\u5b9a\u503c\uff0c\u90a3\u4e48\u6211\u4eec\u7684\u76ee\u7684\u5c31\u662f\u8ba9$\\sum _{i=1}^m x_i^2$\u6700\u5c0f\n\n\u603b\u7b97\u626f\u5230dp\u4e0a\u4e86\u4e0d\u5bb9\u6613\u554a\u2026\u2026\n\n\u6211\u4eec\u8bbe$dp[i][l]$\u8868\u793a\u524d$i$\u6761\u8def$l$\u5929\u8d70\uff0c\u6700\u5c0f\u7684\\sum _{a=1}^i x_a^2\u662f\u591a\u5c11\uff0c\u90a3\u4e48\u6709\u5982\u4e0b\u7684\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b$$dp[i][l]=min\\{dp[j][l-1]+(sum[i]-sum[j])^2\\}$$\n\n\u7136\u540e\u8003\u8651\u659c\u7387\u4f18\u5316\uff08\u4ee5\u4e0b\u7701\u7565$l$\u8fd9\u4e00\u7ef4\uff09\n\n\u5047\u8bbe$j$\u6bd4$k$\u66f4\u4f18\uff0c\u5219\u6709$$dp[j]+(sum[i]-sum[j])^2<dp[k]+(sum[i]-sum[k])^2$$\n\n\u5c55\u5f00\uff0c\u79fb\u9879$$dp[j]+sum[j]^2-dp[k]-sum[k]^2<2*sum[i]*sum[j]-2*sum[i]*sum[k]$$\n\n$$\\frac{dp[j]+sum[j]^2-dp[k]-sum[k]^2}{sum[j]-sum[k]}<2*sum[i]$$\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u4e0a\u659c\u7387\u4f18\u5316\u4e86\n\nps:\u6ce8\u610f\u5f53$l$\u4e3a$0$\u7684\u65f6\u5019dp\u8981\u90fd\u521d\u59cb\u5316\u4e3a$sum[i]^2$\n```\n//minamoto\n#include<iostream>\n#include<cstdio>\n#define ll long long\nusing namespace std;\n#define getc() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline int read(){\n    #define num ch-'0'\n    char ch;bool flag=0;int res;\n    while(!isdigit(ch=getc()))\n    (ch=='-')&&(flag=true);\n    for(res=num;isdigit(ch=getc());res=res*10+num);\n    (flag)&&(res=-res);\n    #undef num\n    return res;\n}\nconst int N=3005;\nll sum[N],sp[N],dp[N];int n,m,h,t,q[N],r;\ninline ll Y(int i){return sp[i]+sum[i]*sum[i];}\ninline double slope(int j,int k){\n    return (Y(j)-Y(k))*1.0/(sum[j]-sum[k]);\n}\nint main(){\n    //freopen(\"testdata.in\",\"r\",stdin);\n    n=read(),m=read();\n    for(int i=1;i<=n;++i)\n    sum[i]=read()+sum[i-1],sp[i]=sum[i]*sum[i];\n    for(int a=1;a<m;++a){\n        h=t=0;q[0]=a;\n        for(int i=a+1;i<=n;++i){\n            while(h<t&&slope(q[h],q[h+1])<2*sum[i]) ++h;\n            dp[i]=sp[q[h]]+(sum[i]-sum[q[h]])*(sum[i]-sum[q[h]]);\n            while(h<t&&slope(q[t],q[t-1])>slope(q[t-1],i)) --t;q[++t]=i;\n        }\n        for(int i=1;i<=n;++i) sp[i]=dp[i];\n    }\n    printf(\"%lld\\n\",-sum[n]*sum[n]+m*dp[n]);\n    return 0;\n}\n```",
        "postTime": 1535429660,
        "uid": 41781,
        "name": "bztMinamoto",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    },
    {
        "content": "[$myblog$](https://www.cnblogs.com/Isaunoya/p/11656178.html)\n\n\u659c\u7387\u4f18\u5316\u88f8\u9898\n\n\u9898\u610f\u5927\u6982\u662f\uff1a\u6c42 \u6700\u5c0f\u7684 $m^2s^2$ =$m^2(\\frac{1}{m}\\sum_{i=1}^{m}(sum_i - {\\frac{\\sum_{i=1}^{m}sum_i}{m})^2})$\n\n= $m^2 (\\frac{1}{m} \\sum_{i=1}^{m}sum_i^2 - \\frac{1}{m^2}(\\sum_{i=1}^{m}sum_i)^2)$\n\n= $m\\sum_{i=1}^{m}sum_i ^2 - (\\sum_{i=1}^{m}sum_i)^2$\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0$(\\sum_{i=1}^{m}sum_i)^2$\u662f\u4e00\u4e2a\u5b9a\u503c\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u6700\u5c0f\u5316$m\\sum_{i=1}^{m}sum_i ^2$\n\n\u53d1\u73b0 $m$ \u8fd9\u4e2a\u5e38\u6570\u4e5f\u53ef\u4ee5\u6700\u540e\u518d\u4e58\u4e0a\n\n\u6240\u4ee5 \u8003\u8651 \u6700\u5c0f\u5316 $\\sum_{i=1}^{m}sum_i ^2$\n\n\u8f6c\u79fb\u65b9\u7a0b\u662f $f_{i,j}$ = $min${$f_{i-1,k}+(sum_j-sum_k)^2$}\n\n\u8fd9\u6837\u5c31\u53ef\u4ee5 $n^2m$\u6c42\u89e3\u4e86\n\n\u8003\u8651\u659c\u7387\u4f18\u5316\n\n\u6bd4\u8f83 $x$ \u548c $y$\n\n\u8bbe $x$ \u7684\u8f6c\u79fb\u4f18\u4e8e $y$\n\n\u5373 $f_{i-1,x} +(sum_j-sum_x)^2>f_{i-1,y}+(sum_j-sum_y)^2$\n\n$f_{i-1,x}+(sum_j^2+sum_x^2-2sum_{j}*sum_{x})>f_{i-1,y}+(sum_j^2+sum_y^2-2sum_j*sum_y)$\n\n$\\large \\frac{f_{i-1,x}-f_{i-1,y}+sum_x^2-sum_y^2}{sum_x-sum_y}>2*sum_{j}$\n\n\u5f88\u663e\u7136\u8fd9\u6837\u5c31\u53ef\u4ee5\u659c\u7387\u4f18\u5316\u4e86\n\n```c++\n// Isaunoya\n#include<bits/stdc++.h>\nusing namespace std ;\n#define int long long\n#define fi first\n#define se second\n#define pb push_back\ninline int read() {\n  register int x = 0 , f = 1 ;\n  register char c = getchar() ;\n  for( ; ! isdigit(c) ; c = getchar()) if(c == '-') f = -1 ;\n  for( ; isdigit(c) ; c = getchar()) x = (x << 1) + (x << 3) + (c & 15) ;\n  return x * f ;\n}\ntemplate < typename T > inline bool cmax(T & x , T y) {\n\treturn x < y ? (x = y) , 1 : 0 ;\n}\ntemplate < typename T > inline bool cmin(T & x , T y) {\n\treturn x > y ? (x = y) , 1 : 0 ;\n}\ninline int QP(int x , int y , int Mod){ int ans = 1 ;\n  for( ; y ; y >>= 1 , x = (x * x) % Mod)\n    if(y & 1) ans = (ans * x) % Mod ;\n  return ans ;\n}\nint n , m ;\nconst int N = 3000 + 5 ;\nint a[N] , sum[N] ;\nint f[2][N] , q[N] ;\ninline int sqr(int x) { return x * x ; }\ninline double slope(int i , int j , int k) {\n  return 1.00 * (f[i & 1][j] - f[i & 1][k] + sqr(sum[j]) - sqr(sum[k])) / (double)(sum[j] - sum[k]) ;\n}\nsigned main() {\n  n = read() ; m = read() ;\n  for(register int i = 1 ; i <= n ; i ++) a[i] = read() ;\n  for(register int i = 1 ; i <= n ; i ++) sum[i] = sum[i - 1] + a[i] ;\n  memset(f , 0x3f , sizeof(f)) ;\n  f[0][0] = 0 ;\n  for(register int i = 1 ; i <= n ; i ++) f[1][i] = sum[i] * sum[i] ;\n  for(register int i = 2 ; i <= m ; i ++) {\n    int h = 1 , t = 0 ;\n    for(register int j = 1 ; j <= n ; j ++) {\n      while(h < t && slope(i - 1 , q[h] , q[h + 1]) < 2 * sum[j]) h ++ ;\n      int k = q[h] ; f[i & 1][j] = f[(i & 1) ^ 1][k] + sqr(sum[j] - sum[k]) ;\n      while(h < t && slope(i - 1 , q[t] , q[t - 1]) > slope(i - 1 , q[t] , j)) t -- ;\n      q[++ t] = j ;\n    }\n  } printf(\"%lld\\n\" , m * f[m & 1][n] - sqr(sum[n])) ;\n\treturn 0 ;\n}\n\n```",
        "postTime": 1570795784,
        "uid": 96580,
        "name": "SXNhdW5veWE",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    },
    {
        "content": "\u9996\u5148\u5f97\u63a8\u4e00\u63a8\u5f0f\u5b50\n\n\u4ee4$sum_i=\\sum_{j=1}^{i}a_j$\n\n$ans=\\frac{(v_1-\\frac{sum_n}{m})^2+(v_2-\\frac{sum_n}{m})^2+...+(v_m-\\frac{sum_n}{m})^2}{m}$\n\n$=\\frac{v_1^2+v_2^2+...+v_m^2}{m}+\\frac{sum_n^2}{m^2}-2\\frac{sum_n^2}{m^2}$\n\n$=\\frac{v_1^2+v_2^2+...+v_m^2}{m}-\\frac{sum_n^2}{m^2}$\n\n$m^2ans=m(v_1^2+v_2^2+...+v_m^2)-sum_n^2$\n\n\u73b0\u5728\u4efb\u52a1\u662f\u6c42$min(v_1^2+v_2^2+...+v_m^2)$\n\n\u4e0adp\n\n$dp_{i,j}$\u8868\u793a\u524d$i$\u4e2a\u5206\u6210$j$\u6bb5\u7684\u6700\u5c0f\u5e73\u65b9\u548c\n\n$dp_{i,j}=min(dp_{k,j-1}+(sum_i-sum_k)^2)$\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u8f83\u5927\uff0c\u7528\u659c\u7387\u4f18\u5316\n\n\u5047\u8bbe\u4e24\u4e2a\u51b3\u7b56$x,y(x<y)$\uff0c\u5982\u679c$y$\u66f4\u4f18\u5fc5\u987b\u6ee1\u8db3\n\n$dp_{x,j-1}+sum_x^2-2sum_isum_x>dp_{y,j-1}+sum_y^2-2sum_isum_y$\n\n\u5316\u7b80\u5f97$\\frac{dp_{x,j-1}-dp_{y,j-1}+sum_x^2-sum_y^2}{2(sum_x-sum_y)}<sum_i$\n\n\u7ef4\u62a4\u4e00\u4e2a\u659c\u7387\u7684\u4e0b\u51f8\u5305\u5c31\u597d\u4e86\n\n\u5176\u5b9e\u8fd8\u53ef\u4ee5\u6eda\u52a8\u6389\u4e00\u7ef4\uff0c\u4f46\u662f\u53cd\u6b63\u80fd\u8fc7\uff0c\u5c31\u61d2\u5f97\u6eda\u52a8\u4e86\nCode\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#define maxn 3010\n#define LL long long\nusing namespace std;\nLL sum[maxn], dp[maxn][maxn], n, m, q[maxn];\n\ninline int read(){\n\tint s = 0, w = 1;\n\tchar c = getchar();\n\tfor (; !isdigit(c); c = getchar()) if (c == '-') w = -1;\n\tfor (; isdigit(c); c = getchar()) s = (s << 1) + (s << 3) + (c ^ 48);\n\treturn s * w;\n}\n\ndouble slope(int opt, int x, int y){\n\treturn 1.0 * (dp[x][opt] - dp[y][opt] + sum[x] * sum[x] - sum[y] * sum[y]) / 2 / (sum[x] - sum[y]); \n}\n\nint main(){\n\tn = read(), m = read();\n\tfor (int i = 1; i <= n; ++i) sum[i] = sum[i - 1] + read(), dp[i][1] = sum[i] * sum[i];\n\tfor (int j = 2; j <= m; ++j){\n\t\tint h = 0, t = 0; q[0] = j - 1;\n\t\tfor (int i = j; i <= n; ++i){\n\t\t\twhile (h < t && slope(j - 1, q[h], q[h + 1]) < sum[i]) ++h;\n\t\t\tdp[i][j] = dp[q[h]][j - 1] + (sum[i] - sum[q[h]]) * (sum[i] - sum[q[h]]);\n\t\t\twhile (h < t && slope(j - 1, q[t], i) < slope(j - 1, q[t - 1], q[t])) --t;\n\t\t\tq[++t] = i;\n\t\t}\n\t}\n\tprintf(\"%lld\\n\", m * dp[n][m] - sum[n] * sum[n]);\n\treturn 0;\n}\n```\n",
        "postTime": 1567947463,
        "uid": 51719,
        "name": "ModestCoder_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    },
    {
        "content": "\u5e7f\u544a \uff1a[\u535a\u5ba2\u98df\u7528\u66f4\u4f73](https://www.cnblogs.com/resftlmuttmotw/p/11334847.html)\n\n[\u9898\u76ee\u94fe\u63a5](https://www.luogu.org/problem/P4072)\n\n# Solution\n\n\u65b9\u5dee\n\n=$\\frac{\\displaystyle\\sum^{m}_{i=1}{{(x_i-\\bar{x})^2}}}{m}$\n\n=$\\displaystyle\\sum^{m}_{i=1}{({x_i^2} + \\bar{x}^2 - 2*x_i*\\bar{x})}$\n\n=$\\displaystyle\\sum^{m}_{i=1}{(x_i^2+\\frac{\\displaystyle\\sum^{m}_{i=1}x_i}{m}- 2*x_i*\\frac{\\displaystyle\\sum^{m}_{i=1}x_i}{m})}$\n\n=$\\displaystyle\\sum^{m}_{i=1}{x_i^2}+\\displaystyle\\sum^{m}_{i=1}x_i-\\frac{\\displaystyle\\sum^{m}_{i=1}(2*x_i*\\displaystyle\\sum^{m}_{i=1}x_i)}{m}$\n\n=$\\displaystyle\\sum^{m}_{i=1}{x_i^2}+\\displaystyle\\sum^{m}_{i=1}x_i-\\frac{\\displaystyle\\sum^{m}_{i=1}x_i*\\displaystyle\\sum^{m}_{i=1}(2*x_i)}{m}$\n\n=$\\displaystyle\\sum^{m}_{i=1}{x_i^2}+\\displaystyle\\sum^{m}_{i=1}x_i-\\frac{2*(\\displaystyle\\sum^{m}_{i=1}x_i)^2}{m}$\n\n\u6613\u5f97$\\displaystyle\\sum^{m}_{i=1}x_i$\u548c$\\displaystyle\\sum^{m}_{i=1}x_i$\u662f\u5b9a\u503c\n\n\u6240\u4ee5\u53ea\u9700\u8981\u6c42$\\displaystyle\\sum^{m}_{i=1}{x_i^2}$\u7684\u6700\u5c0f\u503c\u5c31\u884c\u4e86\n\n\u7136\u540e\u518d\u5957\u4e0a\u516c\u5f0f **\u6ce8\u610f**\u5f97*\u4e0a$m^2$ \n\n\u7136\u540e\u975e\u5e38\u5bb9\u6613\u60f3\u5230DP\n\n\u5b9a\u4e49\n\n```cpp\ndp[i][j]\u8868\u793a\u524di\u4e2a\u5206\u6210j\u4efd\u7684\u5e73\u65b9\u548c\u7684\u6700\u5c0f\u503c\n```\n\n\u6613\u5f97\u72b6\u6001\u8f6c\u79fb\u65b9\u7a0b\n\n\n$\\color{pink}{dp[i][j] = min(dp[k][j-1]+(sum[i]-sum[k])^2);}$\n\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <vector>\n#include <climits>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\n#define isdigit(x) ('0' <= (x)&&(x) <= '9')\ntemplate<typename T>\ninline T Read(T Type)\n{\n    T x = 0;\n    char a;\n    while(!isdigit(a)) a = getchar();\n    while(isdigit(a)) x = (x << 3) + (x << 1) + a - '0',a = getchar();\n    return x;\n}\nconst int MAXN = 3005;\nconst int inf = INT_MAX;\nint x[MAXN],sum[MAXN],f[MAXN][MAXN];\ninline int dmult(int x) {return x * x;}\nint main()\n{\n\tint i,j,l,n = Read(1),m = Read(1);\n\tmemset(f,0x3f,sizeof(f));\n\tfor(i = 1;i <= n;i++)\n\t{\n\t\tx[i] = Read(1);\n\t\tsum[i] += sum[i - 1] + x[i];\n\t}\n\tf[0][0] = 0;\n\tfor(i = 1;i <= n;i++)\n\t{\n\t\tfor(l = 1;l <= min(i,m);l++)\n\t\t{\n\t\t\tfor(j = 0;j < i;j++)\n\t\t\t\tf[i][l] = min(f[i][l],f[j][l - 1] + dmult(sum[i] - sum[j]));\n\t\t}\n\t}\n\tprintf(\"%d\",m * f[n][m] - dmult(sum[n]));\n\treturn 0;\n}\n```\n\n\u7b97\u4e00\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6\n\n$3000^3 >10^9$\n\n\u663e\u7136\u4e0d\u884c\n\n$\\color{pink}{TLE}$\n\n\u660e\u663e\u5f97\u4f18\u5316\u4e0b\n\n\u770b\u4e0b\u6807\u7b7e \u55ef \u659c\u7387\u4f18\u5316\n\n\u8bbe$j>k$\n\n\u5f53\u4e14\u4ec5\u5f53\n\n$\\color{pink}{f[j][l - 1] + dmult(sum[i] - sum[j]) < f[k][l - 1] + dmult(sum[i] - sum[k])}$\n\n\u6211\u4eec\u8ba4\u4e3aj\u6bd4k\u4f18\n\n\u5426\u5219 k\u66f4\u4f18\n\n\u5316\u7b80\u4e00\u4e0b\u5f97\u5230\n\n$\\color{pink}{f[j][l-1]+sum[i]^2+sum[j]^2-2*sum[i]*sum[j]<f[k][l - 1] + sum[i]^2 + sum[k]^2-2*sum[i]*sum[k])}$\n\n$\\color{pink}{f[j][l-1]-f[k][l-1]+sum[j]^2-sum[k]^2<2*sum[i]*(sum[j]-sum[k])}$\n\n\u56e0\u4e3a\u6211\u4eec\u8bbe\u4e86 $j>k$\n\n\n\u6240\u4ee5$sum[j]-sum[k]>0$\n\n\u6240\u4ee5\n\n$\\color{pink}{\\frac{f[j][l-1]-f[k][l-1]+sum[j]^2-sum[k]^2}{(sum[j]-sum[k])}<2*sum[i]}$\n\n$\\color{pink}{\\frac{f[j][l-1]+sum[j]^2-f[k][l-1]-sum[k]^2}{(sum[j]-sum[k])}<2*sum[i]}$\n\n\u975e\u5e38\u660e\u663e\u7684\u659c\u7387\u4f18\u5316\n\nP.S\u6700\u540e\u8f93\u51fa\u7684\u65f6\u5019\u6309\u7167\u6211\u63a8\u51fa\u6765\u7684\u4e5f\u884c\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <vector>\n#include <climits>\n#include <cstring>\n#include <algorithm>\nusing namespace std;\n#define isdigit(x) ('0' <= (x)&&(x) <= '9')\ntemplate<typename T>\ninline T Read(T Type)\n{\n    T x = 0;\n    char a;\n    while(!isdigit(a)) a = getchar();\n    while(isdigit(a)) x = (x << 3) + (x << 1) + a - '0',a = getchar();\n    return x;\n}\nconst int MAXN = 3005;\nconst int inf = INT_MAX;\nint x[MAXN],sum[MAXN],f[MAXN][MAXN],q[MAXN],g[MAXN];\ninline int dmult(int x) {return x * x;}\ninline double count_k(int u,int l,int r)\n{\n\treturn (f[l][u] - f[r][u] + g[l] - g[r]) / (double)(sum[l] - sum[r]);\n}\nint main()\n{\n\tint i,j,l,n = Read(1),m = Read(1);\n\tfor(i = 1;i <= n;i++)\n\t{\n\t\tx[i] = Read(1);\n\t\tsum[i] += sum[i - 1] + x[i];\n\t\tg[i] = dmult(sum[i]);\n\t}\n\tint left,r;\n\tfor(i = 1;i <= n;i++) f[i][1] = dmult(sum[i]);\n\tfor(l = 2;l <= m;l++)\n\t{\n\t\tleft = 1,r = 0;\n\t\tfor(i = 1;i <= n;i++)\n\t\t{\n\t\t\twhile(left < r&&count_k(l - 1,q[left],q[left + 1]) < 2 * sum[i]) left++;\n\t\t\tf[i][l] = f[q[left]][l - 1] + dmult(sum[i] - sum[q[left]]);\n\t\t\twhile(left < r&&count_k(l - 1,q[r - 1],q[r]) > count_k(l - 1,q[r],i)) r--;\n\t\t\tq[++r] = i;\n\t\t}\n\t}\n\tprintf(\"%d\",m * f[n][m] - dmult(sum[n]));\n   //\u6309\u6211\u63a8\u51fa\u7684\u5f0f\u5b50\u4e5f\u884c\n\treturn 0;\n}\n```",
        "postTime": 1565503203,
        "uid": 73992,
        "name": "resftlmuttmotw",
        "ccfLevel": 0,
        "title": "[SDOI2016]\u5f81\u9014"
    },
    {
        "content": "### \u9898\u76ee\u94fe\u63a5\n[[SDOI2016]\u5f81\u9014](https://www.luogu.org/problemnew/show/P4072)\n### \u9898\u76ee\u5927\u610f\n\u5206\u6790\u540e\u7684\u95ee\u9898\uff1a\u5c06\u4e00\u4e2a\u957f\u5ea6\u4e3a$n$\u7684\u6b63\u6574\u6570\u5e8f\u5217\u5212\u5206\u6210$m$\u6bb5\uff0c\u4f7f\u5f97$m$\u6bb5\u7684\u548c\u7684\u65b9\u5dee\u6700\u5c0f\u3002\n### \u9884\u5907\u77e5\u8bc6\uff1a\u65b9\u5dee\n\u8bbe$x[i]$\u4e3a\u7b2c$i$\u5929\u8d70\u7684\u8def\u7a0b\u3002  \n\u65b9\u5dee\u516c\u5f0f\u662f$v=\\frac{1}{n}\\sum_{i=1}^n(x[i]-\\overline x)^2$\n$$\\begin{aligned}\nv*m^2&=m\\sum_{i=1}^{m}(x[i]-\\overline x)^2\\\\\n&=m\\sum_{i=1}^{m}(x[i]^2-\\frac{2x[i]\\sum_{j=1}^{m}x[j]}{m}+(\\sum_{j=1}^{m}\\frac{x[j]}{m})^2)\\\\\n&=m\\sum_{i=1}^mx[i]^2-2\\sum_{i=1}^mx[i]\\sum_{j=1}^mx[j]+\\sum_{i=1}^mx[i]^2\\\\\n&=m\\sum_{i=1}^mx[i]^2-(\\sum_{i=1}^mx[i])^2\\\\\n\\end{aligned}$$\n### \u9898\u76ee\u601d\u8def\n\u53ef\u4ee5\u770b\u51fa$(\\sum_{i=1}^mx[i])^2$\u7b49\u4e8e$S$\u5230$T$\u8def\u5f84\u4e0a\u6240\u6709\u8fb9\u6743\u548c\u7684\u5e73\u65b9\uff0c\u4e00\u5b9a\u662f\u4e2a\u5b9a\u503c\uff0c\u6240\u4ee5\u53ea\u8981\u6c42$\\sum_{i=1}^mx[i]^2$\u5c31\u53ef\u4ee5\u4e86\u3002  \n\u7531\u4e8e\u8d70\u5230\u6bcf\u4e00\u4e2a\u4f11\u606f\u7ad9\u540e\u5bf9\u4e4b\u540e\u7684\u4f11\u606f\u7ad9\u6ca1\u6709\u5f71\u54cd\uff0c\u6240\u4ee5\u60f3\u5230$dp$\u3002  \n\u8bbe$s[i]$\u4e3a\u7b2c$i$\u4e2a\u70b9\u8ddd\u79bb\u539f\u70b9$S$\u7684\u8ddd\u79bb\uff0c$dp[i][j]$\u8868\u793a\u524d$i$\u4e2a\u6570\u5206\u6210$j$\u4efd\u7684\u6700\u5c0f\u7684\u5e73\u65b9\u7684\u548c\u3002\n$$dp[i][j]=min(dp[k][j-1]+(s[i]-s[k])^2),k\\in[0,i)$$\n\u8fd9\u4e2a\u5f0f\u5b50\u662f$O(n^3)$\uff0c\u76f4\u63a5\u4e0a\u53ef\u4ee5\u83b7\u5f97$60$\u5206\u7684\u597d\u6210\u7ee9\u3002  \n\u770b\u5230\u5e73\u65b9\u9879\uff0c\u81ea\u7136\u60f3\u5230\u659c\u7387\u4f18\u5316\uff0c\u90a3\u5c31\u63a8\u4e00\u4e0b\u5f0f\u5b50\u3002  \n\u5f53\u51b3\u7b56$p$\u4f18\u4e8e\u51b3\u7b56$q(p<q)$\u65f6\uff0c\u6709\n$$dp[p][j-1]+(s[i]-s[p])^2<dp[p][j-1]+(s[i]-s[p])^2$$\n$$dp[p][j-1]-2s[i]s[p]+s[p]^2<dp[q][j-1]-2s[i]s[q]+s[q]^2$$\n$$\\frac{(dp[p][j-1]+s[p]^2)-(dp[q][j-1]+s[q]^2)}{s[p]-s[q]}<2s[i]$$\n\u63a5\u4e0b\u6765\u6709\u4e00\u70b9\u8bc1\u660e~~\u81ea\u5df1\u778e\u8bc1\u7684~~\u3002  \n\u9996\u5148\uff0c\u56e0\u4e3a$s[i]$\u662f\u524d\u7f00\u548c\uff0c\u4e14\u6bcf\u6bb5\u8def\u7684\u957f\u5ea6\u5747\u4e3a\u6b63\uff0c\u6240\u4ee5$s[i]$\u662f\u5355\u8c03\u589e\u7684\uff0c\u5373\u659c\u7387\u662f\u5355\u8c03\u589e\u7684\u3002  \n\u53c8\u56e0\u4e3a\u56db\u8fb9\u5f62\u4e0d\u7b49\u5f0f\n$$(s[c]-s[a])^2+(s[d]-s[b])^2\\leq(s[d]-s[a])^2+(s[c]-s[b])^2$$\n\u4e24\u8fb9\u7ea6\u53bb\u76f8\u540c\u9879\u5f97\n$$s[a]s[c]+s[b]s[d]\\leq s[a]s[d]+s[b]s[c]$$\n\u79fb\u9879\u5f97\n$$(s[d]-s[c])(s[b]-s[a])\\geq0$$\n\u5f97\u8bc1\uff0c\u53ef\u5f97\u51b3\u7b56\u662f\u5355\u8c03\u7684\u3002  \n\u6240\u4ee5\u76f4\u63a5\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u5c31\u884c\u4e86\uff01  \n\u4ee4$Y(i,j)=dp[i][j]+s[i]^2,X(i)=s[i],$ $Slope(i,j,k)=1.0*(Y(i,k)-Y(j,k))/(X(i)-X(j))$  \n\u7136\u540e\u7ef4\u62a4\u961f\u5934\u961f\u5c3e\u5355\u8c03\u3002\u3002\u3002\u5c31\u6ca1\u7136\u540e\u4e86\u3002  \n## \u4e0a\u4ee3\u7801  \n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=3010;\n\nint n,m;\nll dp[N][N],x[N],s[N];\nint q[N],head=1,tail=0;\n\n#define sqr(x) ((x)*(x))\n#define Y(i,j) (dp[i][(j)]+sqr(s[i]))\n#define X(i) (s[i])\n#define Slope(i,j,k) 1.0*(Y(i,k)-Y(j,k))/(X(i)-X(j))\n#define calc(i,j,k) (dp[k][(j)-1]+sqr(s[i]-s[k]))\n\ninline ll read()\n{\n\tll s=0;\n\tbool flag=false;\n\tchar ch=getchar();\n\tfor(;ch<'0'||ch>'9';ch=getchar()) if(ch=='-') flag=true;\n\tfor(;'0'<=ch&&ch<='9';ch=getchar()) s=(s<<3)+(s<<1)+(ch^48);\n\tif(flag) return -s;\n\treturn s;\n}\ninline void write(ll x)\n{\n\tif(!x)\n\t{\n\t\tputchar('0'),putchar(' ');\n\t\treturn ;\n\t}\n\tif(x<0) putchar('-'),x=-x;\n\tchar ch[20];\n\tint tot=0;\n\twhile(x) ch[++tot]=x%10,x/=10;\n\tfor(int i=tot;i;i--) putchar(ch[i]^48);\n\tputchar(' ');\n}\ninline void writeln(ll x)\n{\n\twrite(x);\n\tputchar('\\n');\n}\n\nint main()\n{\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;i++) x[i]=read();\n\tfor(int i=1;i<=n;i++) s[i]=s[i-1]+x[i];\n\tmemset(dp,0x3f,sizeof(dp));\n\tdp[0][0]=0;\n\tfor(int j=1;j<=m;j++)\n\t{\n\t\thead=1,tail=0;\n\t\tq[++tail]=j-1;\n\t\tfor(int i=j;i<=n;i++)\n\t\t{\n\t\t\tfor(;head<tail&&Slope(q[head],q[head+1],j-1)<2*s[i];head++);\n\t\t\tdp[i][j]=calc(i,j,q[head]);\n\t\t\tfor(;head<tail&&Slope(q[tail-1],q[tail],j-1)>Slope(q[tail],i,j-1);tail--);\n\t\t\tq[++tail]=i;\n\t\t}\n\t}\n\tll ans=-sqr(s[n])+m*dp[n][m];\n\twriteln(ans);\n\treturn 0;\n}\n```",
        "postTime": 1551192227,
        "uid": 54728,
        "name": "wangxuye",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    },
    {
        "content": "## \u9898\u76ee\u63cf\u8ff0\uff1a\nPine\u5f00\u59cb\u4e86\u4eceS\u5730\u5230T\u5730\u7684\u5f81\u9014\u3002\n\n\u4eceS\u5730\u5230T\u5730\u7684\u8def\u53ef\u4ee5\u5212\u5206\u6210$n$\u6bb5\uff0c\u76f8\u90bb\u4e24\u6bb5\u8def\u7684\u5206\u754c\u70b9\u8bbe\u6709\u4f11\u606f\u7ad9\u3002\n\nPine\u8ba1\u5212\u7528$m$\u5929\u5230\u8fbeT\u5730\u3002\u9664\u7b2c$m$\u5929\u5916\uff0c\u6bcf\u4e00\u5929\u665a\u4e0aPine\u90fd\u5fc5\u987b\u5728\u4f11\u606f\u7ad9\u8fc7\u591c\u3002\u6240\u4ee5\uff0c\u4e00\u6bb5\u8def\u5fc5\u987b\u5728\u540c\u4e00\u5929\u4e2d\u8d70\u5b8c\u3002\n\nPine\u5e0c\u671b\u6bcf\u4e00\u5929\u8d70\u7684\u8def\u957f\u5ea6\u5c3d\u53ef\u80fd\u76f8\u8fd1\uff0c\u6240\u4ee5\u4ed6\u5e0c\u671b\u6bcf\u4e00\u5929\u8d70\u7684\u8def\u7684\u957f\u5ea6\u7684\u65b9\u5dee\u5c3d\u53ef\u80fd\u5c0f\u3002\n\n\u5e2e\u52a9Pine\u6c42\u51fa\u6700\u5c0f\u65b9\u5dee\u662f\u591a\u5c11\u3002\n\n\u8bbe\u65b9\u5dee\u662f$v$\uff0c\u53ef\u4ee5\u8bc1\u660e\uff0c $v\\times m^2$\u662f\u4e00\u4e2a\u6574\u6570\u3002\u4e3a\u4e86\u907f\u514d\u7cbe\u5ea6\u8bef\u5dee\uff0c\u8f93\u51fa\u7ed3\u679c\u65f6\u8f93\u51fa $v\\times m^2$\u3002\n\n## \u8f93\u5165\u8f93\u51fa\u683c\u5f0f\n\n### \u8f93\u5165\u683c\u5f0f\uff1a\n\u7b2c\u4e00\u884c\u4e24\u4e2a\u6570 $n$\u3001$m$\u3002\n\n\u7b2c\u4e8c\u884c $n$ \u4e2a\u6570\uff0c\u8868\u793a $n$ \u6bb5\u8def\u7684\u957f\u5ea6\n\n### \u8f93\u51fa\u683c\u5f0f\uff1a### \n\u4e00\u4e2a\u6570\uff0c$v\\times m^2$\n\n## \u9898\u89e3\n\n\u62ff\u5230\u9898\u4e4b\u540e\u6ca1\u6709\u601d\u8def\uff0c\u4e8e\u662f\u5148\u6765\u63a8\u4e00\u6ce2\u5f0f\u5b50\u3002\n\n\u6700\u539f\u59cb\u7684\u65b9\u5dee\u8868\u8fbe\u5f62\u5f0f\u4e3a\uff1a\n\n$s^2 = \\frac{(\\bar{v} - v_1)^2 + (\\bar{v} - v_2)^2 + ... + (\\bar{v} - v_m)^2}{m}$\n\n\u6574\u7406\u5f97\u5230\uff1a\n\n$s^2 = \\frac{(\\sum_{i = 1} ^ m v_i - v_1)^2 + (\\sum_{i = 1} ^ m v_i - v_2)^2 + ... + (\\sum_{i = 1} ^ m v_i - v_m)^2}{m}$\n\n\u4e8c\u9879\u5f0f\u5c55\u5f00\u4e4b\u540e\u53ef\u5f97\uff1a\n\n$s^2 = \\frac{m\\times\\frac{(\\sum_{i = 1} ^ m v_i)^2}{m ^  2} - 2\\times\\frac{\\sum_{i = 1} ^ m v_i}{m}\\times\\sum_{i= 1}^m v_i^2 + \\sum_{i = 1} ^m v_i ^ 2}{m}$\n\n\u6700\u540e\u6574\u7406\u5f97\u5230\u6700\u7ec8\u5f62\u5f0f\uff1a\n\n$s ^ 2 = \\frac{-\\frac{\\sum_{i = 1} ^ m v_i ^2}{m} +\\sum_{i = 1} ^ m v_i ^ 2}{m}$\n\n\u6700\u540e\u5c06$m ^ 2$\u4ee3\u5165\u53ef\u5f97\uff1a\n\n$s ^ 2 \\times m ^ 2 = -(\\sum_{i = 1} ^ m v_i) ^ 2 + m \\times \\sum_{i = 1} ^ m v_i ^ 2$\n\n\u6b64\u65f6\u53ef\u4ee5\u53d1\u73b0\u524d\u4e00\u9879\u662f\u4e00\u4e2a\u5e38\u6570\uff0c\u6254\u6389\u4e0d\u7406\u4ed6\u2192_\u2192\n\n\u90a3\u4e48\u95ee\u9898\u8f6c\u5316\u4e3a\u5982\u4f55\u6c42$\\sum_{i = 1} ^ m v_i ^ 2$\u3002\n\n\u5f88\u660e\u663e\u53ef\u4ee5\u6709\u5f88\u6734\u7d20\u7684\u72b6\u6001$f[i][j]$\u8868\u793a\u8003\u8651\u5230\u7b2c$i$\u6bb5\uff0c\u8d70\u4e86$j$\u5929\u65f6\u7684\u603b\u91cf\u3002\n\n\u7136\u9e45\u8fd9\u6837\u7684DP\u662f$O(n ^ 3)$\u7684\uff0c\u6240\u4ee5\u8003\u8651\u659c\u7387\u4f18\u5316\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u8bbe\u8ba1$f[i]$\u548c$g[i]$\u4e3a\u5f53\u524d\u8003\u8651\u7684\u65f6\u95f4\u6bb5\u548c\u4e4b\u524d\u7684\u65f6\u95f4\u6bb5\u7684\u72b6\u6001\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u6109\u5feb\u5730\u518d\u5927\u529b\u63a8\u4e00\u6ce2\u5f0f\u5b50\u4e86\u2192_\u2192\uff1a\n\n$f[i] = g[i] + (sum[i] - sum[j]) ^ 2$\n\n\u4e00\u987f\u64cd\u4f5c\u540e\u53ef\u4ee5\u5f97\u5230\u659c\u7387\u5f0f\u7684\u5f62\u5f0f\uff1a\n\n$2 \\times sum[i] \\times sum[j] + f[i] - sum[i] ^  2 = g[j] + sum[j] ^  2$\n\n\u7136\u540e\u5957\u659c\u7387\u4f18\u5316\u7684\u5957\u8def\u5c31\u53ef\u4ee5\u60f9\u3002\n\n\u53e6\u5916\u9700\u8981\u6ce8\u610f\u521d\u59cb\u5316$g[i]$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n\n#define MAXN 3005\n\ntypedef long long ll;\n\nusing namespace std;\n\nint N, M;\nint head, tail;\nint q[MAXN];\nll sum[MAXN];\nll f[MAXN], g[MAXN];\n\ninline ll read_int()\n{\n\tll ret = 0, f = 1; char c = getchar();\n\twhile(c < '0' || c > '9') {if(c == '-') f = -1; c = getchar();}\n\twhile(c >= '0' && c <= '9') {ret = (ret << 1) + (ret << 3) + int(c - 48); c = getchar();}\n\treturn ret * f;\n}\n\ninline ll pow(ll x) {return x * x;}\n\ninline double X(int i) {return sum[i];}\n\ninline double Y(int j) {return g[j] + pow(sum[j]);}\n\ninline double slope(int i, int j) {return (Y(i) - Y(j)) / (X(i) - X(j));}\n\nvoid init()\n{\n\tN = read_int(), M = read_int();\n\tfor(int i = 1; i <= N; i++)\n\t{\n\t\tsum[i] = read_int();\n\t\tsum[i] += sum[i - 1];\n\t\tg[i] = pow(sum[i]);\n\t}\n}\n\nvoid dp()\n{\n\tfor(int l = 1; l < M; l++)\n\t{\n\t\thead = 1, tail = 1;\n\t\tq[1] = l;\n\t\tfor(int i = l + 1; i <= N; i++)\n\t\t{\n\t\t\twhile(head < tail && slope(q[head], q[head + 1]) < 2 * sum[i])\n\t\t\t\thead++;\n\t\t\tf[i] = g[q[head]] + (pow(sum[i] - sum[q[head]]));\n\t\t\twhile(head < tail && slope(q[tail], q[tail - 1]) > slope(q[tail], i))\n\t\t\t\ttail--;\n\t\t\tq[++tail] = i;\n\t\t}\n\t\tmemcpy(g, f, sizeof(f));\n\t}\n\tprintf(\"%lld\\n\", f[N] * M - pow(sum[N]));\n}\n\nint main()\n{\n\tinit();\n\tdp();\n\treturn 0;\n}\n```\n",
        "postTime": 1532770390,
        "uid": 55374,
        "name": "shuidi",
        "ccfLevel": 0,
        "title": "SDOI 2016 \u5f81\u9014 \uff08\u659c\u7387\u4f18\u5316\uff09"
    },
    {
        "content": "### \u5f81\u9014\u8fd9\u662f\u4e00\u9053\u5341\u5206\u7ecf\u5178\u7684\u659c\u7387\u4f18\u5316\n\u6211\u4eec\u53ef\u4ee5\u4ece\u9898\u76ee\u4e2d\u7684\u65b9\u5dee\u6765\u60f3,\u4e5f\u5c31\u5f88\u5bb9\u6613\u7684\u5230\u8fd9\u4e2a\u5f0f\u5b50\n$$ans=m^2*\\frac{\\sum_{i=1}^{m}{(x_i-{\\overline{x}})^2}}{m}$$\n\n\u5316\u7b80\u5c31\u4f1a\u5f97\u5230\n$$ans=m*\\sum_{i=1}^{m}{(x_i-{\\overline{x}})^2}$$\n\n\u5728\u5316\u7b80\u5f97\n$$ans={m*\\sum_{i=1}^{m}{x_i}^2}+{\\sum_{i=1}^{m}{x_i}}$$\n\n\u7ecf\u8fc7\u89c2\u5bdf\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u5bb9\u6613\u53d1\u73b0$\\sum_{i=1}^{m}{x_i}$\u662f\u5b9a\u503c\uff0c\u540c\u65f6$m*\\sum_{i=1}^{m}{x_i}^2$\u4e2d\u7684$m$\u4e5f\u662f\u5b9a\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u8ba9$\\sum_{i=1}^{m}{{x_i}^2}$\u6700\u5c0f\n\u6211\u4eec\u4ee4$dp[i][j]=\\min\\{dp[i-1][j-k]+(sum[j]-sum[j-k])^2\\}$\n\n\u5176\u4e2d\u6211\u4eec\u4ee4$sum[i]=\\sum_{k=1}^{i}{val_k}$\n\n\u5176\u4e2d$val_k$\u662f\u7b2ck\u6bb5\u8def\u7684\u957f\u5ea6\n\n\u7531\u6b64\u6211\u4eec\u5c31\u53ef\u5f97\u5230\u4e00\u4e2a\u5f00o2\u53ef\u4ee5\u5361\u621080\u7684\u4ee3\u7801\n```\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<cctype>\n\nusing namespace std;\n\nlong long n,m,dp[3001][3001],sum[3001];\n\n    const int BufferSize=100*1000;\n    char buffer[BufferSize],*head,*tail;\n    bool not_EOF=true;\n    inline char Getchar(){\n        if(not_EOF and head==tail){\n            int len=fread(buffer,1,BufferSize,stdin);\n            not_EOF=len!=0;\n            head=buffer,tail=head+len;\n        }\n        return not_EOF?*head++:-1;\n    }\n    inline long long rd(){\n        long long x=0,s=1;\n        char c=Getchar();\n        for(;!isdigit(c) and not_EOF;c=Getchar()) if(c=='-') s=-1;\n        for(; isdigit(c) and not_EOF;c=Getchar()) x=(x<<1)+(x<<3)+(c^48);\n        return s*x;\n    }\n    inline void scan(char *str){\n        char c=Getchar();\n        for(; isspace(c) and not_EOF;c=Getchar());\n        for(;!isspace(c) and not_EOF;c=Getchar()) *(str++)=c;\n        *str=0;\n}\n\nint main(){\n\tmemset(dp,0x7f,sizeof(dp));\n\tn=rd(),m=rd();\n\tfor(int i=1;i<=n;i++){\n\t\tlong long x=rd();\n\t\tsum[i]=sum[i-1]+x;\n\t}\n\tdp[0][0]=-sum[n]*sum[n];\n\tfor(int i=0;i<m;i++){\n\t\tfor(int j=0;j<=n;j++){\n\t\t\tfor(int k=0;k<=n-j;k++){\n\t\t\t\tdp[i+1][j+k]=min(dp[i+1][j+k],dp[i][j]+(sum[j+k]-sum[j])*(sum[j+k]-sum[j])*m);\n\t\t\t}\n\t\t}\n\t}\n    printf(\"%lld\",dp[m][n]);\n    return 0;\n}\n```\n\n\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u4ee3\u7801\u662f$O(nm)$\u7684\uff0c\u663e\u7136\u6211\u662f\u4e0d\u53ef\u4ee5\u63a5\u53d7\u7684\u3002\u5176\u5b9e\u6211\u4eec\u53ef\u4ee5\u5f88\u5bb9\u6613\u8bc1\u660e\u8fd9\u4e2a\u7684\u51b3\u7b56\u5355\u8c03\u6027\uff0c\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u659c\u7387\u4f18\u5316\n\n\u6211\u4eec\u4ee4$y<x<i$\n\u56e0\u4e3a\u51b3\u7b56\u5355\u8c03\u6027\uff0c\u6240\u4ee5\u5bf9\u4e8e\u51b3\u7b56$i$\u65f6\uff0ck\u8f6c\u79fb\u5fc5\u5b9a\u6bd4j\u8f6c\u79fb\u8981\u4f18\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f97\u5230\u8fd9\u4e48\u4e00\u4e2a\u5f0f\u5b50\n$$dp[i-1][x]+(sum[j]-sum[x])^2<dp[i-1][y]+(sum[j]-sum[y])^2$$\n\u5316\u7b80\u5f97\n$$\\frac{(dp[i-1][x]+sum[x]^2)-(dp[i-1][y]+sum[y]^2)}{sum[x]-sum[y]}<2*sum[j]$$\n\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u7528\u659c\u7387\u53c8\u82b1\u4e86\n\n\u6211\u4eec\u628a$p_1(dp[i-1][x]+sum[x]^2,sum[x])$\u548c$p_2(dp[i-1][y]+sum[y]^2,sum[y])$\u770b\u505a$p_1,p_2$\u4e24\u4e2a\u70b9\uff0c\u521a\u521a\u90a3\u4e2a\u5f0f\u5b50\u4e5f\u5c31\u662f\u5b83\u4eec\u6240\u8fde\u7ebf\u7684\u659c\u7387\u8868\u8fbe\u5f0f\n\n\u6211\u4eec\u4e5f\u5c31\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u7684\u4ee3\u7801\n```\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n\nusing namespace std;\n\nlong long n,m,dp[3001][3001],sum[3001];\nint q[3001];\n\ndouble getpoint(int i,int p){return (double)dp[i][p]+sum[i]*sum[i];}\ndouble slope(int j,int k,int p){return (double)(getpoint(j,p)-getpoint(k,p))/(double)(sum[j]-sum[k]);}\n\nint main(){\n\tscanf(\"%lld%lld\",&n,&m);\n\tfor(int i=1;i<=n;i++){\n\t\tlong long x;\n\t\tscanf(\"%lld\",&x);\n\t\tsum[i]=sum[i-1]+x;\n\t\tdp[i][1]=sum[i]*sum[i];\n\t}\n\tfor(int k=2;k<=m;k++){\n\t\tint head=1,tail=0;\n\t\tfor(int i=1;i<=n;i++){ \n            while(head<tail and slope(q[head],q[head+1],k-1)<2*sum[i])head++;\n            int j=q[head];\n            dp[i][k]=dp[j][k-1]+(sum[j]-sum[i])*(sum[j]-sum[i]); \n            while(head<tail and slope(q[tail],q[tail-1],k-1)>slope(q[tail],i,k-1))tail--;\n            q[++tail]=i;\n        }\n\t}\n    printf(\"%lld\",m*dp[n][m]-sum[n]*sum[n]);\n    return 0;\n}\n```",
        "postTime": 1531810594,
        "uid": 48146,
        "name": "ezoiHY",
        "ccfLevel": 0,
        "title": "\u5f81\u9014"
    },
    {
        "content": "## \u4e00\u3001\u9898\u76ee\n\n[\u70b9\u6b64\u770b\u9898](https://www.luogu.org/problem/P4072)\n\n## \u4e8c\u3001\u89e3\u6cd5\n\n\u770b\u9898\u76ee\u4e2d\u7684\u8fd9\u4e2a\u65b9\u5dee\u5f88\u6e05\u5947\uff0c\u6211\u4eec\u5c1d\u8bd5\u5bf9\u7b54\u6848\u53d8\u5f62\uff1a\n\n$\\Rightarrow s^2 \\cdot m^2=(\\sum_{i=1}^{m} (v_i-\\mu )^2)\\cdot m$\n\n$\\Rightarrow s^2\\cdot m^2=(\\sum_{i=1}^{m}(vi^2+\\mu^2-2v_i\\mu))\\cdot m$\n\n$\\Rightarrow s^2 \\cdot m^2=m\\cdot \\sum_{i=1}^{m} v_i^2-sum\\cdot sum$\n\n\u5176\u4e2d$v_i$\u662f\u7b2c$i$\u7684\u503c\u4e4b\u548c\uff0c$sum$\u662f\u5168\u90e8\u503c\u7684\u548c\uff0c\u6211\u4eec\u53d1\u73b0\u7b54\u6848\u53ea\u8ddf\u524d\u9762\u90a3\u4e00\u5757\u6709\u5173\u7cfb\uff0c\u6545\u95ee\u9898\u8f6c\u5316\u6210\u4e86\u6c42 $\\sum_{i=1}^{m}v_i^2$ \u6700\u5c0f\u3002\n\n\u8bbe$dp[i][j]$\u8868\u793a\u5230\u7b2c$i$\u4e2a\u5143\u7d20\u9009\u4e86$j$\u5757\uff0c\u6240\u5f97\u5230\u7684\u6700\u5c0f\u503c\uff0c\u5219\u6709\u8f6c\u79fb\uff1a\n\n$dp[i][j]=\\min\\{dp[k][j-1]+(sum[i]-sum[k])^2\\}$\n\n\u8f6c\u79fb\u662f$O(n^2m)$\u7684\uff0c\u6211\u4eec\u8003\u8651\u4f18\u5316\u3002\n\n1\u3001\u53d1\u73b0$j$\u5c42\u53ea\u548c$j-1$\u6709\u5173\uff0c\u4e0a\u6eda\u52a8\u6570\u7ec4\u3002\n\n2\u3001\u624b\u63a8\u4f18\u5316\u5f0f\u5b50\uff0c\u53d1\u73b0\u53ef\u4ee5\u7528\u659c\u7387\u4f18\u5316\uff0c\u7ecf\u5178\u641e\u6cd5\u4e0d\u591a\u8bf4\u3002\n\n\u4e0a\u4ee3\u7801\u5427$qwq$\u3002\n\n```cpp\n#include <cstdio>\n#define int long long\nconst int MAXN = 3005;\nint read()\n{\n    int x=0,flag=1;\n    char c;\n    while((c=getchar())<'0' || c>'9') if(c=='-') flag=-1;\n    while(c>='0' && c<='9') x=(x<<3)+(x<<1)+(c^48),c=getchar();\n    return x*flag;\n}\nint n,m,cur,sum[MAXN],dp[2][MAXN];\nint up(int j,int k)\n{\n    return dp[cur^1][j]-dp[cur^1][k]+sum[j]*sum[j]-sum[k]*sum[k];\n}\nint down(int j,int k)\n{\n    return sum[j]-sum[k];\n}\nsigned main()\n{\n    n=read();\n    m=read();\n    for(int i=1; i<=n; i++)\n        sum[i]=sum[i-1]+read();\n    for(int i=1; i<=n; i++)\n        dp[0][i]=sum[i]*sum[i];\n    for(int k=2; k<=m; k++)\n    {\n        cur^=1;\n        int head=1,tail=0,q[MAXN]= {};\n        for(int i=1; i<=n; i++)\n        {\n            while(head<tail && up(q[head+1],q[head])<2*sum[i]*down(q[head+1],q[head])) head++;\n            dp[cur][i]=dp[cur^1][q[head]]+(sum[i]-sum[q[head]])*(sum[i]-sum[q[head]]);\n            while(head<tail && up(i,q[tail])*down(q[tail],q[tail-1])<up(q[tail],q[tail-1])*down(i,q[tail])) tail--;\n            q[++tail]=i;\n        }\n    }\n    printf(\"%lld\\n\",m*dp[cur][n]-sum[n]*sum[n]);\n}\n\n\n```\n\n",
        "postTime": 1570110078,
        "uid": 128239,
        "name": "C20203030",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    },
    {
        "content": "# \u9898\u76ee\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\u70b9\u8fd9\u91cc](https://www.luogu.org/problem/P4072)\u770b\u9898\u76ee\u3002\n# \u5206\u6790\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5c31\u5148\u5f97\u5316\u5f0f\u5b50\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8981\u5316\u5f0f\u5b50\uff0c\u6211\u4eec\u5c31\u8981\u77e5\u9053\uff0c\u65b9\u5dee\u662f\u4ec0\u4e48\u3002   \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5728\u8fd9\u9053\u9898\u4e2d\uff0c\u8bbe$\\{d_m\\}$\u4e3a\u4e00\u4e2a\u957f\u5ea6\u4e3a$m$\u7684\u6570\u5217\uff0c\u7b2c$i$\u9879\u8868\u793a\u7b2c$i$\u5929\u8d70\u7684\u8def\u7a0b\uff1b$a=\\frac {\\sum_{i=1}^md_i} m$\u3002\u5219$v=\\frac {\\sum_{i=1}^m(d_i-a)^2}{m}$\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4ee5\u4e0b\u662f\u5316\u5f0f\u5b50\u7684\u90e8\u5206\uff1a  \n&nbsp;&nbsp;$\\displaystyle \\Rightarrow vm^2=m\\left(\\sum_{i=1}^m(d_i-a)^2\\right)$  \n&nbsp;&nbsp;$\\displaystyle \\Rightarrow vm^2=m\\left(\\sum_{i=1}^m(d_i^2-2ad_i+a^2)\\right)$  \n&nbsp;&nbsp;$\\displaystyle \\Rightarrow vm^2=m\\left(\\sum_{i=1}^md_i^2-2a\\sum_{i=1}^md_i+ma^2\\right)$  \n&nbsp;&nbsp;$\\displaystyle \\Rightarrow vm^2=m\\sum_{i=1}^md_i^2-2ma\\sum_{i=1}^md_i+m^2a^2$  \n&nbsp;&nbsp;$\\displaystyle \\Rightarrow vm^2=m\\sum_{i=1}^md_i^2-\\left(\\sum_{i=1}^md_i\\right)^2$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8bbe\u7b2c$i$\u6bb5\u8def\u957f\u5ea6\u4e3a$b_i$\uff0c\u5219\u53ef\u77e5$\\sum_{i=1}^nb_i=\\sum_{i=1}^md_i$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5373\uff1a  \n&nbsp;&nbsp;$\\displaystyle \\Rightarrow vm^2=m\\sum_{i=1}^md_i^2-\\left(\\sum_{i=1}^nb_i\\right)$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u6b64\u65f6\u53d1\u73b0\uff0c\u53ea\u6709$\\sum_{i=1}^md_i^2$\u662f\u4e0d\u786e\u5b9a\u7684\uff0c\u4e8e\u662f\u8003\u8651$DP$\u6c42\u51fa\u5176\u6700\u5c0f\u503c\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$DP(j,i)$\uff1a\u524d$i$\u6bb5\u8def\u5206\u4e3a$j$\u5929\u7684\u884c\u7a0b\u7684\u6700\u5c0f$\\sum_{k=1}^jd_k^2$\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8bbe$s_i=\\sum_{j=1}^ib_j$\u8f6c\u79fb\u5982\u4e0b\uff1a  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$\\displaystyle DP(j,i)=\\min_{0\\le k<i}\\{DP(j-1,k)+(s_i-s_k)^2\\}$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u66b4\u529b$DP$\u5c31\u6709$70$\u5206\u3002\u89c2\u5bdf\u5f0f\u5b50\uff0c\u76ee\u6d4b\u53ef\u4ee5\u659c\u7387\u4f18\u5316\uff1a  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u82e5$k_1<k_2$\uff0c\u4e14$k_1$\u8f6c\u79fb\u6bd4$k_2$\u66f4\u4f18\uff1a  \n&nbsp;&nbsp;$\\displaystyle \\Rightarrow DP(j-1,k_1)+(s_i-s_{k_1})^2<DP(j-1,k_2)+(s_i-s_{k_2})^2$   \n&nbsp;&nbsp;$\\displaystyle \\Rightarrow DP(j-1,k_1)+s_i^2-2s_is_{k_1}+s_{k_1}^2<DP(j-1,k_2)+s_i^2-2s_is_{k_2}+s{k_2}^2$  \n&nbsp;&nbsp;$\\displaystyle \\Rightarrow (DP(j-1,k_1)+s_{k_1}^2)-(DP(j-1,k_2+s_{k_2}^2))<2s_i(s_{k_1}-s_{k_2})$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8bbe$Y(j,i)=DP(j-1,i)+s_i^2,X(i)=s_i$\uff0c\u5219\uff1a  \n&nbsp;&nbsp;$\\displaystyle \\Rightarrow \\frac{Y(j,k_1)-Y(j,k_2)}{X(k_1)-X(k_2)}>2s_i$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u4e24\u70b9\u659c\u7387$>2s_i$\uff0c\u5219\u524d\u9762\u7684\u51b3\u7b56\u70b9\u66f4\u4f18\uff0c\u5426\u5219\u5c31\u662f\u540e\u9762\u7684\u66f4\u4f18\u3002\u901a\u8fc7\u8fd9\u4e2a\u6027\u8d28\u53ef\u4ee5\u77e5\u9053\u5e94\u8be5\u7ef4\u62a4\u4e00\u4e2a\u4e0b\u51f8\u5305\u3002\u7528\u5355\u8c03\u961f\u5217\u7ef4\u62a4\u5373\u53ef\u3002  \n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <cstring>\n\ntypedef long long LL;\n\nconst int MAXN = 3005, MAXM = 3005;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n\tx = 0;char s = getchar();int f = 1;\n\twhile( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n\twhile( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n\tx *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n\tif( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n\tif( 9 < x ){ write( x / 10 ); }\n\tputchar( x % 10 + '0' );\n}\n\ntemplate<typename _T>\n_T MIN( const _T a, const _T b )\n{\n\treturn a < b ? a : b;\n}\n\nstruct deque\n{\n\tint q[MAXN];\n\tint h, t;\n\tint& operator [] ( const int indx ) { return q[indx]; }\n\tdeque(){ h = 1, t = 0; }\n\tvoid clear(){ h = 1, t = 0; }\n\tint front() const { return q[h]; }\n\tint back() const { return q[t]; }\n\tvoid push_front( const int val ){ q[--h] = val; }\n\tvoid push_back( const int val ){ q[++t] = val; }\n\tvoid pop_front(){ h ++; }\n\tvoid pop_back(){ t --; }\n\tbool empty() const { return h > t; }\n\tint siz() const { return t - h + 1; }\n}deq;\n\nstruct vector\n{\n\tLL x, y;\n\tvector(){}\n\tvector( const LL X, const LL Y ){ x = X, y = Y; }\n\tLL mul( const vector & other ) const { return x * other.y - other.x * y; }\n\tbool operator > ( const vector & other ) const { return mul( other ) < 0; }\n\tbool operator < ( const vector & other ) const { return mul( other ) > 0; }\n\tbool operator >= ( const vector & other ) const { return mul( other ) <= 0; }\n};\n\nint DP[MAXM][MAXN];\nint a[MAXN], s[MAXN];\nint N, M;\n\nLL Y( const int stage, const int k )\n{\n\treturn DP[stage - 1][k] + s[k] * s[k];\n}\n\nLL X( const int k )\n{\n\treturn s[k];\n}\n\nLL get( const int stage, const int i, const int k )\n{\n\treturn DP[stage - 1][k] + ( s[i] - s[k] ) * ( s[i] - s[k] );\n}\n\nint main()\n{\n\tread( N ), read( M );\n\tfor( int i = 1 ; i <= N ; i ++ ) read( a[i] ), s[i] = s[i - 1] + a[i];\n\tmemset( DP, 0x3f, sizeof( DP ) );\n\tDP[0][0] = 0;\n\tfor( int j = 1 ; j <= M ; j ++ )\n\t{\n\t\tdeq.clear();\n\t\tdeq.push_back( 0 );\n\t\tfor( int i = 1 ; i <= N ; i ++ )\n\t\t{\n\t\t\twhile( deq.siz() > 1 && Y( j, deq.front() ) - Y( j, deq[deq.h + 1] ) >= 2 * s[i] * ( X( deq.front() ) - X( deq[deq.h + 1] ) ) ) deq.pop_front();\n\t\t\tDP[j][i] = get( j, i, deq.front() );\n\t\t\twhile( deq.siz() > 1 && vector( X( deq.back() ) - X( deq[deq.t - 1] ), Y( j, deq.back() ) - Y( j, deq[deq.t - 1] ) ) >= vector( X( i ) - X( deq.back() ), Y( j, i ) - Y( j, deq.back() ) ) ) deq.pop_back();\n\t\t\tdeq.push_back( i );\n\t\t}\n\t}\n\twrite( 1ll * M * DP[M][N] - s[N] * s[N] ), putchar( '\\n' );\n\treturn 0;\n}\n```",
        "postTime": 1569998885,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[\u6821\u5185OJ]\u5f81\u9014"
    },
    {
        "content": "# \u5f81\u9014\u9898\u89e3\n\u6076\u5fc3\u9898\u3002~~\u6211\u592a\u5f31\u4e86~~\n\n\u56de\u5230\u6b63\u9898\uff0c\n\n$v^2=\\frac{\\sum_{i=1}^m(v_{i}-\\bar{v})^2}{m}$\n\n$v^2*m^2=m*\\sum_{i=1}^m(v_{i}-\\bar{v})^2$\n\n\u5c06\u6bcf\u4e2a\u5f0f\u5b50\u62c6\u5f00\uff1a\n\n$m*(v_{i}-\\bar{v})^2$\n\n$m*({v_{i}}^2+{\\bar{v}}^2-2*\\frac{v_{i}*\\sum_{k=1}^{m}v_{i}}{m})$\n\n$m*({v_{i}}^2+({\\frac{\\sum_{k=1}^{m}v[k]}{m}})^2-2*\\frac{v_{i}*\\sum_{k=1}^{m}v_{i}}{m})$\n\n$m*{v_{i}}^2+(\\frac{\\sum_{k=1}^{m}v[k]}{m})^2-2*v_{i}*\\sum_{k=1}^{m}v_{i}$\n\n\u5408\u8d77\u6765\uff0c\u8fd0\u7528\u4e58\u6cd5\u5206\u914d\u5f8b\uff0c\u5373\u4e3a\uff1a\n\n$v^2*m^2=m*\\sum_{i=1}^{m}{v_{i}}^2+(\\sum_{i=1}^{m}v_{i})^2-2*\\sum_{i=1}^{m}v_{i}*\\sum_{i=1}^{m}v_{i}$\n\n$v^2*m^2=m*\\sum_{i=1}^{m}{v_{i}}^2-(\\sum_{i=1}^{m}v_{i})^2$\n\n\u540e\u9762\u4e00\u9879\u4e3a\u5e38\u6570,\u4e3a\u8def\u7a0b\u603b\u548c,\n\n\u4fbf\u8bbe$f[k][i]$\u4e3a\u8d70\u4e86\u524d$i$\u6bb5\u8def\u5206\u914d\u5b8c\u524d$k$\u5929\u7684\u6700\u5c0f\u5e73\u65b9\u548c\uff0c\u8bbe\u8def\u7a0b\u524d\u7f00\u548c\u4e3a$sum$\uff0c\u5219\uff1a\n\n\u66b4\u529bDP\u65b9\u7a0b\u4e3a:\n\n$f[k][i]=max f[k-1][j]+(sum[i]-sum[j])^2$\n\n\u62c6\u5e73\u65b9\u9879\uff0c\u79fb\u9879\uff1a\n\n$f[k-1][j]+sum[j]^2=2*sum[i]*sum[j]+f[k][i]-sum[i]^2$\n\n$\\bullet y=f[k-1][j]+sum[j]^2$\n\n$\\bullet k=2*sum[i]$\n\n$\\bullet x=sum[j]$\n\n$\\bullet b=f[k][i]-sum[i]^2$\n\n\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u7684\u4e0b\u51f8\u58f3\u5373\u53ef,\u53ef\u4ee5\u7528\u5faa\u73af\u961f\u5217\u8282\u7701\u7a7a\u95f4\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=3006;\nint n,m,t,head,tail,o=0,sum[N],f[2][N];\nstruct point{int x,y;}tmp,q[N];\ninline int read(){\n   int T=0,F=1; char ch=getchar();\n   while(ch<'0'||ch>'9'){if(ch=='-') F=-1; ch=getchar();}\n   while(ch>='0'&&ch<='9') T=(T<<3)+(T<<1)+(ch-48),ch=getchar();\n   return F*T;\n}\nbool check(point u,point v,int z){return v.y-u.y<=2*sum[z]*(v.x-u.x);}\nbool check2(point u,point v,point z){return (v.y-u.y)*(z.x-v.x)>=(z.y-v.y)*(v.x-u.x);}\nint main(){\n    n=read(),m=read(),f[0][0]=0;\n    for(int i=1;i<=n;++i) t=read(),sum[i]=sum[i-1]+t,f[o][i]=sum[i]*sum[i];\n    for(int j=2;j<=m;++j){\n        o^=1,q[1].x=0,q[1].y=0,head=tail=1;\n        for(int i=1;i<=n;++i){\n            while(head<tail&&check(q[head],q[head+1],i)) ++head;\n            f[o][i]=q[head].y-2*sum[i]*q[head].x+sum[i]*sum[i],tmp.x=sum[i],tmp.y=f[o^1][i]+sum[i]*sum[i];\n            while(head<tail&&check2(q[tail-1],q[tail],tmp)) --tail;\n            q[++tail]=tmp;\n        }\n    }\n    t=f[o][n]*m-sum[n]*sum[n];\n    printf(\"%d\\n\",t);\n    return 0;\n}\n```",
        "postTime": 1566645149,
        "uid": 44180,
        "name": "ljk123",
        "ccfLevel": 0,
        "title": "\u5f81\u9014\u9898\u89e3"
    },
    {
        "content": " [\u5b89\u5229\u4e00\u6ce2\u535a\u5ba2](https://www.cnblogs.com/cold-cold/p/10131510.html)\n\n\u8fd9\u9053\u9898\u7279\u522b\u5751\n\n\u72b6\u6001\u8f6c\u79fb\u662f f[i][k+1]=f[j][k]+(sum[i]-sum[j])*(sum[i]-sum[j]);\n\n\u8f6c\u6362\u540e\u53d8\u4e3a f[j][k]+sum[j]\\*sum[j]=f[i][k+1]+2\\*sum[i]*sum[j];\n\n\u4f46\u662f\u6211\u5728\u8fd9\u91cc\u8981\u8bf4\u7684\u662f\u4e00\u4e2a\u521d\u503c\u7684\u95ee\u9898\n\n\u901a\u5e38\u60c5\u51b5\u4e0b\u659c\u7387\u4f18\u5316\u7684\u9898\u76ee\u90fd\u662f\u4e0d\u9700\u8981\u8d4b\u521d\u503c\u7684\n\n\u4f46\u56e0\u4e3af[i][1]\u5168\u90fd\u4e3a0\uff0c\u6240\u4ee5\u5bfc\u81f4\u540e\u7eeddp\u503c\u5168\u90e8\u51fa\u9519\n\n\u6240\u4ee5\u6211\u4eec\u5e94\u5c06f[i][2]\u8d4b\u4e0a\u521d\u503c\u4e3asum[i]*sum[i]\n\n \u603b\u4f53\u5b9e\u73b0\u5982\u4e0b\uff1a\n \n ```cpp\n#include <algorithm>\n#include <iostream>\n#include <cmath>\n#include <cstring>\n#include <map>\n#include <string>\n#include <vector>\n#include <queue>\n#include <stack>\n#include <cstdio>\n#include <cstdlib>\nusing namespace std;\ntypedef long long ll;\ninline ll read()\n{\n    register ll p(1),a(0);register char ch=getchar();\n    while((ch<'0'||ch>'9')&&ch!='-') ch=getchar();\n    if(ch=='-') p=-1,ch=getchar();\n    while(ch>='0'&&ch<='9') a=a*10+ch-48,ch=getchar();\n    return a*p;\n}\n//f[i][k+1]=f[j][k]+(sum[i]-sum[j])*(sum[i]-sum[j]);\n//f[j][k]+sum[j]*sum[j]=f[i][k+1]+2*sum[i]*sum[j];\nconst ll N=3010;\nll n,kk,f[N][N],sum[N],Q[N],head=0,tail=0;\ninline double getx(int x){return sum[x];}\ninline double gety(int x,int now){return f[x][now]+sum[x]*sum[x];}\ninline double che(int x,int y,int now){return (gety(y,now)-gety(x,now))/(getx(y)-getx(x));}\nint main()\n{\n//    freopen(\"input\",\"r\",stdin);\n//    freopen(\"output\",\"w\",stdout);\n    n=read(),kk=read();\n    for(register int i=1;i<=n;i++) sum[i]=sum[i-1]+read(),f[i][2]=sum[i]*sum[i];\n    \n    for(register int k=2;k<=kk;k++,head=tail=0)\n        for(register int i=1,j;i<=n;i++)\n            {\n                while(head<tail&&che(Q[head],Q[head+1],k)<2*sum[i]) ++head;\n                j=Q[head];f[i][k+1]=f[j][k]+(sum[i]-sum[j])*(sum[i]-sum[j]);\n                while(head<tail&&che(Q[tail-1],Q[tail],k)>che(Q[tail],i,k)) --tail;\n                Q[++tail]=i;\n            }\n    printf(\"%lld\\n\",f[n][kk+1]*kk-sum[n]*sum[n]);\n    return 0;\n}\n/*\n \n*/\n```",
        "postTime": 1545060698,
        "uid": 48934,
        "name": "cold_cold",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4072 \u3010[SDOI2016]\u5f81\u9014\u3011"
    }
]