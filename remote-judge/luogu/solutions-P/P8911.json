[
    {
        "content": "## \u601d\u8def\n\n\u9884\u5904\u7406 $b[i][j]$ \u8868\u793a\u533a\u95f4\u91cc\u6240\u6709\u503c\u90fd\u5728 $i,j$ \u4e4b\u95f4\u7684\u533a\u95f4\u6709\u591a\u5c11\u4e2a\u3002\n\n\u56de\u7b54\u95ee\u9898\u65f6\u6309\u4e0b\u56fe\u5bb9\u65a5\uff1a\u5927\u6b63\u65b9\u5f62\u51cf\u53bb\u9ec4\u6b63\u65b9\u5f62\u51cf\u53bb\u7eff\u6b63\u65b9\u5f62\u518d\u52a0\u4e0a\u9ec4\u7eff\u91cd\u53e0\u5c31\u662f\u7ea2\u8272\u8981\u6c42\u7684\uff0c\u767d\u8272\u4e3a $0$ \u6240\u4ee5\u4e0d\u8003\u8651\u3002$\\mathcal O(1)$ \u56de\u7b54\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/xwgsnrff.png)![](https://cdn.luogu.com.cn/upload/image_hosting/1smqn7iq.png)\n\n\u9884\u5904\u7406 $b$ \u5f88\u7b80\u5355\u3002$\\mathcal O(nV)$ \u9884\u5904\u7406\u3002\n\n## code\n\n```cpp\n#include<stdio.h>\n#include<vector>\n#define ull unsigned long long\n#define N 100005\n#define M 4002\nusing namespace std;\ninline char nc()\n{\n\tstatic char buf[99999],*l,*r;\n\treturn l==r&&(r=(l=buf)+fread(buf,1,99999,stdin),l==r)?EOF:*l++;\n}\ninline void read(int&x)\n{\n\tchar c=nc();for(;c<'0'||'9'<c;c=nc());\n\tfor(x=0;'0'<=c&&c<='9';x=(x<<3)+(x<<1)+(c^48),c=nc());\n}\ninline void read(ull&x)\n{\n\tchar c=nc();for(;c<'0'||'9'<c;c=nc());\n\tfor(x=0;'0'<=c&&c<='9';x=(x<<3)+(x<<1)+(c^48),c=nc());\n}\nint p,q,l[N],r[N];ull xorsum,s,b[M][M];\nstruct mod\n{\n\tull b;__int128 m;\n\tinline mod(const ull&b):b(b),m(((__int128)(1)<<64)/b){}\n\tinline ull reduce(const ull&a)\n\t{\n\t\tull q=m*a>>64;\n\t\tull r=a-q*b;\n\t\treturn r>=b?r-b:r;\n\t}\n}f(2);\ninline ull rd(){return s^=s<<13,s^=s>>7,s^=s<<17,s;}\ninline void getlr(int&l1,int&r1,int&l2,int&r2)\n{\n\tl1=f.reduce(rd())+p;\n\tr1=f.reduce(rd())+p;\n\tl2=f.reduce(rd())+p;\n\tr2=f.reduce(rd())+p;\n\tif(l1>r1)l1^=r1^=l1^=r1;\n\tif(l2>r2)l2^=r2^=l2^=r2;\n}\nint n,m,a[N];vector<int>c[M];\nmain()\n{\n\tread(n);read(m);\n\tfor(int i=0;i<n;read(a[i]),c[a[i]].emplace_back(i),++i);\n\tread(p);read(q);read(s);\n\tf=mod(q-p+1);\n\tfor(int i=p;i<=q;++i)\n\t{\n\t\tfor(int i=0;i<n;l[i]=r[i]=-1,++i);\n\t\tfor(int j=i;j<=q;++j)\n\t\t{\n\t\t\tb[i][j]=b[i][j-1];\n\t\t\tfor(int k=0,o;k<c[j].size();++k)\n\t\t\t{\n\t\t\t\to=c[j][k];l[o]=r[o]=o;++b[i][j];\n\t\t\t\tif(o&&~l[o-1])b[i][j]+=o-l[o-1],r[l[o-1]]=o,l[o]=l[o-1];\n\t\t\t\tif(o<n-1&&~l[o+1])\n\t\t\t\t\tb[i][j]+=(o-l[o]+1ll)*(r[o+1]-o),\n\t\t\t\t\tl[r[o+1]]=l[o],r[l[o]]=r[o+1];\n\t\t\t}\n\t\t}\n\t}//\u9884\u5904\u7406\n\tfor(int i=1,l1,r1,l2,r2;i<=m;++i)\n\t{\n\t\tgetlr(l1,r1,l2,r2);\n\t\tif(l2>r1)continue;\n\t\txorsum^=(b[l2][r1]-b[l2][l1-1]-b[r2+1][r1]+b[r2+1][l1-1])*i;\n\t}\n\tprintf(\"%llu\",xorsum);\n}\n```\n",
        "postTime": 1671896799,
        "uid": 90693,
        "name": "_\u2022\u0301\u3078\u2022\u0301\u256c_",
        "ccfLevel": 7,
        "title": "P8911 [RC-06] Minimum and Maximum"
    },
    {
        "content": "\u6a21\u62df\u8d5b\u7684\u6700\u540e\u4e00\u9898\uff0c\u8003\u573a $25$ \u5206\u3002\n\n\u90e8\u5206\u5206\u601d\u8def\u662f RMQ+ \u4e8c\u7ef4\u524d\u7f00\u548c\uff0c\u5c31\u4e0d\u7ec6\u8bb2\u4e86\u3002\n\n\u653e\u4e00\u70b9\u6838\u5fc3\u4ee3\u7801\uff1a\n\n```cpp\nmnn[i][j]=min(mnn[i][j-1],mnn[i+(1<<j-1)][j-1]),mxx[i][j]=max(mxx[i][j-1],mxx[i+(1<<j-1)][j-1]);\n```\n\n```cpp\nmx=max(mxx[l][lg[r-l+1]],mxx[r-(1<<lg[r-l+1])+1][lg[r-l+1]]);\nmn=min(mnn[l][lg[r-l+1]],mnn[r-(1<<lg[r-l+1])+1][lg[r-l+1]]);\newqzh[mx][mn]++;\n```\n\n```cpp\newqzh[i][j]+=ewqzh[i][j-1]+ewqzh[i-1][j]-ewqzh[i-1][j-1];\n```\n\n------------\n\n\u4e2a\u4eba\u8ba4\u4e3a\u6b64\u9898\u4e3b\u8981\u96be\u5ea6\u5c31\u5728\u9884\u5904\u7406\u4e0a\uff0c\u4e8e\u662f\u81ea\u5df1\u7422\u78e8\u4e86\u5f88\u4e45\uff0c\u5199\u4e00\u7bc7\u9898\u89e3\u5427\u3002\n\n------------\n\n\u8003\u8651\u4e00\u4e2a\u533a\u95f4\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u4f4d\u7f6e\u90fd\u5f71\u54cd\u7b54\u6848\uff0c\u53ef\u4ee5\u6ca1\u7528\u7684\u4f4d\u7f6e\u8df3\u8fc7\u3002\n\n\u6ca1\u7528\u7684\u4f4d\u7f6e\u5373\u65e2\u4e0d\u5f71\u54cd\u6700\u5927\u503c\uff0c\u53c8\u4e0d\u5f71\u54cd\u6700\u5c0f\u503c\u7684\u4f4d\u7f6e\u3002\n\n\u8003\u8651\u7ef4\u62a4\u4ece $i$ \u4e2a\u4f4d\u7f6e\u51fa\u53d1\uff0c\u53f3\u4fa7\u7b2c\u4e00\u4e2a\u6bd4\u533a\u95f4\u6700\u5c0f\u503c\u5c0f\u7684\u4f4d\u7f6e $L_i$ \u548c\u7b2c\u4e00\u4e2a\u6bd4\u533a\u95f4\u6700\u5927\u503c\u5927\u7684\u4f4d\u7f6e $R_i$\u3002 \n\n\u4e3a\u4e86\u5728\u8282\u7701\u7a7a\u95f4\u7684\u60c5\u51b5\u4e0b\u53ea\u7edf\u8ba1\u53f3\u4fa7\u7684\u70b9\uff0c\u5148\u5012\u5e8f\u679a\u4e3e $L_i$ \u548c $R_i$\uff0c\u7136\u540e\u679a\u4e3e $i$\u3002\n\n\u8fd9\u6837\u4e5f\u5229\u4e8e\u7b54\u6848\u7684\u8ba1\u7b97\uff0c\u6211\u4eec\u53ea\u7528\u6bcf\u6b21\u8df3\u5230 $L_i$ \u548c $R_i$ \u4e2d\u4f4d\u7f6e\u8f83\u5c0f\u7684\u4e00\u70b9\uff0c\u7136\u540e\u66f4\u65b0\u4e8c\u7ef4\u524d\u7f00\u548c\u5373\u53ef\u3002\n\n\u603b\u4f53\u590d\u6742\u5ea6 $\\operatorname{O}(n\\times q)$\uff0c\u5373\u5ffd\u7565\u5e38\u6570\u6700\u591a $4\\times10^8$\uff0c\u8fd9\u9898 $5$ \u79d2\u8dd1\u8fc7\u5f88\u7a33\u597d\u5427\uff01\n\n------------\n\n\u4ee3\u7801\u5c31\u53ea\u653e\u9884\u5904\u7406\u4e86\uff0c\u522b\u7684\u90fd\u76f4\u63a5\u590d\u5236\u7684\u9898\u76ee\u4e2d\u7684\u6a21\u677f\u3002\n```cpp\nfor(ll i=0;i<=4001;i++)\n    L[i]=R[i]=n+1;\nll xorsum=0,l,r;\nfor(ll i=n;i>=1;i--){\n\tfor(ll j=1;j<=4000;j++){\n\t\tif(j==a[i])\n\t\t\tL[j]=R[j]=i;\n\t\telse if(j<a[i])\n\t\t\tR[j]=i;\n\t\telse\n\t\t\tL[j]=i;\n\t}\n\tl=r=a[i];\n\tfor(ll j=i;j<=n;j=min(L[l-1],R[r+1])){\n\t\tl=min(l,a[j]);\n\t\tr=max(r,a[j]);\n\t\tewqzh[l][r]+=min(L[l-1],R[r+1])-j;\n    }\n}\n//haiwang_tjn\n```\n",
        "postTime": 1680009784,
        "uid": 526094,
        "name": "Wf_yjqd",
        "ccfLevel": 0,
        "title": "P8911 [RC-06] Minimum and Maximum"
    }
]