[
    {
        "content": "\u9898\u76ee\u4e22\u7ed9\u4e86\u6211\u4eec\u4e00\u4e2a\u5f88\u590d\u6742\u7684\u8be2\u95ee\uff0c\u80af\u5b9a\u4e0d\u80fd\u76f4\u63a5\u505a\u3002  \n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5dee\u5206\u4e00\u4e0b\uff0c\u95ee\u9898\u5c31\u4f1a\u53d8\u5f97\u5f88\u7b80\u5355\u4e86\u3002 \n\n\n\u9898\u76ee\u4e2d\u539f\u5f0f\u662f\u8fd9\u6837\u7684  \n$$\\sum\\limits_{x=1}^\\infty \\text{get}(l_1,r_1,x)*\\text{get}(l_2,r_2,x)$$  \n\u6839\u636e\u5dee\u5206\uff0c\u5bb9\u6613\u53d1\u73b0   \n$$\\text{get}(l,r,x)=\\text{get}(1,r,x)-\\text{get}(1,l-1,x)$$  \n\u4e3a\u4e86\u65b9\u4fbf\u4e0b\u9762\u8868\u8ff0\uff0c\u6211\u4eec\u8bbe  \n$$g(i,x)=\\text{get}(1,i,x)$$\n\u4e8e\u662f\u539f\u5f0f\u5316\u4e3a\n$$\\sum\\limits_{x=1}^\\infty g(r_1,x)g(r_2,x)-g(r_1,x)g(l_2-1,x)-g(l_1-1,x)g(r_2,x)+g(l_1-1,x)g(l_2-1,x)$$  \n\u7136\u540e\u5c31\u5c06\u5176\u5f3a\u62c6\u6210 $4$ \u4e2a\u8be2\u95ee  \n$$q_1=\\sum\\limits_{x=1}^\\infty g(r_1,x)g(r_2,x)$$  \n$$q_2=\\sum\\limits_{x=1}^\\infty g(r_1,x)g(l_2-1,x)$$\n$$ q_3=\\sum\\limits_{x=1}^\\infty g(l_1-1,x)g(r_2,x)$$\n$$q_4=\\sum\\limits_{x=1}^\\infty g(l_1-1,x)g(l_2-1,x)$$  \n\u7136\u540e\u8be2\u95ee\u7684\u5b9e\u9645\u7b54\u6848\u5c31\u662f$ q_1-q_2-q_3+q_4$  \n\n\u7136\u540e\u5c31\u80fd\u76f4\u63a5\u7528\u83ab\u961f\u641e\u4e86\uff0c\u5177\u4f53\u5b9e\u73b0\u89c1\u4ee3\u7801\u3002  \n\u65f6\u95f4\u590d\u6742\u5ea6 $\\text{O}(n^\\frac32)$\uff0c\u53ef\u4ee5\u65e0\u538b\u529b\u901a\u8fc7\u3002  \n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#include<cmath>\n#include<algorithm>\n#include<vector>\n#include<queue>\n#include<cstdlib>\n#include<ctime>\n#define int long long\n#define reg register\n#define N 50003\nusing namespace std;\n\nstruct query{\n\tint l,r,id,type;\n\tquery(int l=0,int r=0,int id=0,int type=0):l(l),r(r),id(id),type(type){}\n\t//\u8fd9\u91cc\u7684l,r\u8868\u793a\u7684\u5e76\u4e0d\u662f\u533a\u95f4,\u53ea\u662f\u4e3a\u4e86\u65b9\u4fbf\u624d\u8fd9\u4e48\u5199\u7684 \n\t//id\u8868\u793a\u5c5e\u4e8e\u54ea\u4e2a\u8be2\u95ee,type\u8868\u793a\u5176\u6b63\u8d1f \n};\n\nint a[N],be[N],ans[N];\nint cntl[N],cntr[N];\nquery q[N<<2];\nint n,m,unit,res,qc,l,r;\n\ninline void read(int &x);\nvoid print(int x);\ninline bool cmp(query x,query y);\ninline void movel(int t);\ninline void mover(int t);\n\nsigned main(){\n\tint l1,r1,l2,r2,t = 0;\n\tread(n);\n\tunit = sqrt(n);\n\tfor(reg int i=1;i<=n;++i){\n\t\tread(a[i]);\n\t\tbe[i] = i/unit+1;\n\t}\n\tread(m);\n\tfor(reg int i=1;i<=m;++i){\n\t\tread(l1),read(r1),read(l2),read(r2);\n\t\tq[++qc] = query(r1,r2,i,1); //\u5f3a\u62c6\u62104\u4e2a\u8be2\u95ee \n\t\tq[++qc] = query(r1,l2-1,i,-1);\n\t\tq[++qc] = query(l1-1,r2,i,-1);\n\t\tq[++qc] = query(l1-1,l2-1,i,1);\n\t}\n\tfor(reg int i=1;i<=qc;++i){\n\t\tif(q[i].l<=q[i].r) continue;\n\t\tswap(q[i].l,q[i].r);\n\t}\n\tsort(q+1,q+1+qc,cmp);\n\tl = 0,r = 0;\n\tfor(reg int i=1;i<=qc;++i){\n\t\twhile(l<q[i].l) movel(1);\n\t\twhile(l>q[i].l) movel(-1);\n\t\twhile(r<q[i].r) mover(1);\n\t\twhile(r>q[i].r) mover(-1);\n\t\tif(q[i].type==1) ans[q[i].id] += res;\n\t\telse ans[q[i].id] -= res;\n\t}\n\tfor(reg int i=1;i<=m;++i){\n\t\tprint(ans[i]);\n\t\tputchar('\\n');\n\t}\n\treturn 0;\n}\n\ninline void movel(int t){\n\tif(t==1){\n\t\t++cntl[a[l+1]];\n\t\tres += cntr[a[l+1]];  //\u8ba1\u7b97\u79fb\u52a8\u7aef\u70b9\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u3002\u8fd9\u91cc\u53ef\u4ee5\u81ea\u5df1\u601d\u8003\u4e00\u4e0b \n\t\t++l;\n\t}else{\n\t\t--cntl[a[l]];\n\t\tres -= cntr[a[l]];\n\t\t--l;\t\n\t}\n}\n\ninline void mover(int t){\n\tif(t==1){\n\t\t++cntr[a[r+1]];\n\t\tres += cntl[a[r+1]];\n\t\t++r;\n\t}else{\n\t\t--cntr[a[r]];\n\t\tres -= cntl[a[r]];\n\t\t--r;\n\t}\n}\n\ninline bool cmp(query x,query y){\n\tif(be[x.l]==be[y.l]) return x.r < y.r;\n\treturn x.l < y.l;\n}\n\ninline void read(int &x){\n\tx = 0;\n\tchar c = getchar();\n\twhile(c<'0'||c>'9') c = getchar();\n\twhile(c>='0'&&c<='9'){\n\t\tx = (x<<3)+(x<<1)+(c^48);\n\t\tc = getchar();\n\t}\n}\n\nvoid print(int x){\n\tif(x>9) print(x/10);\n\tputchar(x%10+'0');\n}\n```",
        "postTime": 1553344846,
        "uid": 115864,
        "name": "NaCly_Fish",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5268 \u3010[SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\u3011"
    },
    {
        "content": "\u52a0\u5f3a\u7248\uff1a[[Ynoi2016]\u8fd9\u662f\u6211\u81ea\u5df1\u7684\u53d1\u660e](https://www.luogu.com.cn/problem/P4689)\n\n### [[Snoi2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee](http://www.lydsy.com/JudgeOnline/problem.php?id=5016)\n\n\u6211\u4eec\u8bbe$f(l_1,r_1,l_2,r_2)$\u4e3a\u533a\u95f4$[l_1,r_1]$\u548c$[l_2,r_2]$\u4e2d\u5404\u53d6\u4e00\u4e2a\u7684\u6743\u503c\u76f8\u540c\u60c5\u51b5\u603b\u6570\n\n\u4f464\u5143\u6211\u4eec\u4e0d\u597d\u5904\u7406\n\n\u5bb9\u65a5\n\n$f(l_1,r_1,l_2,r_2)=f(1,r_1,1,r_2)-f(1,l_2-1,1,r_1)-f(1,l_1-1,1,r_2)+f(1,l_1-1,1,l_2-1)$\n\n\u8fd9\u6837\u7684\u8bdd\u6bcf\u4e00\u4e2af\u5c31\u53ea\u6709\u4e24\u5143\u4e86\n\n\u6211\u4eec\u7528\u56fe\u6765\u5f62\u8c61\u7684\u770b\u4e00\u770b\u8fd9\u4e2a\u5bb9\u65a5\n\n![](https://s1.ax1x.com/2020/04/02/GtVQRH.png)\n\n\u6211\u4eec\u9996\u5148\u8ba1\u7b97\u4e86\u4e24\u4e2a\u7d2b\u8272\u533a\u95f4\u7684f\n\n\u90a3\u4e48\uff0c\u68d5\u8272\u533a\u95f4([1,l2-1])\u548c\u7eff\u8272\u533a\u95f4([1,r1])\u7684f\u662f\u6211\u4eec\u4e0d\u5e94\u8be5\u8ba1\u7b97\u7684\n\n\u540c\u7406[1,l1-1]\u548c[1,r2]\u662f\u6211\u4eec\u4e0d\u8be5\u8ba1\u7b97\u7684\n\n\u4e24\u4e2a\u5747\u51cf\u53bb\u7684\u8bdd\uff0c\u628a[1,l1-1]\u548c[1,l2-1]\u7684f\u51cf\u4e86\u4e24\u904d\uff0c\u52a0\u56de\u6765\u5373\u53ef\n\n\u7136\u540e\u5bf9\u4e8e\u533a\u95f41\u7edf\u8ba1\u67d0\u6570\u5b57\u4e2a\u6570\u7684\u95ee\u9898\u6211\u4eec\u7528\u666e\u901a\u83ab\u961f\u89e3\u51b3\n\n\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u9700\u8981\u8ba1\u7b97\u7684\u90fd\u662ff(1,x,1,y)\u8fd9\u4e2a\u5f62\u5f0f\n\n\u4e0d\u59a8\u8bbex\u5c0f\u4e8ey\n\n\u5bf9\u4e8e\u4e00\u4e2a\u6570\u5b57k\uff0c\u5b83\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5373[1,x]\u5185k\u6570\u91cf\u4e58\u4ee5[1,y]\u5185k\u6570\u91cf\n\n\u8bbes1=[1,x]\u5185k\u6570\u91cf,s2=[1,y]\u5185k\u6570\u91cf\n\n\u5728\u83ab\u961fl\u6307\u9488\u5411\u5de6\u65f6\uff0c\u67d0\u4e2ak\u7684s1\u5e94\u8be5\u51cf\u5c111\uff0c\u6240\u6709s2\u4e0d\u53d8\uff0c\u5bf9\u7b54\u6848\u8d21\u732e-s2\n\nl\u6307\u9488\u5411\u53f3\uff0c\u67d0\u4e2ak\u7684s1\u5e94\u8be5\u589e\u52a01\uff0c\u6240\u6709s2\u4e0d\u53d8\uff0c\u5bf9\u7b54\u6848\u8d21\u732es2\n\n\u5728\u83ab\u961fr\u6307\u9488\u5411\u5de6\u65f6\uff0c\u67d0\u4e2ak\u7684s2\u5e94\u8be5\u51cf\u5c111\uff0c\u6240\u6709s1\u4e0d\u53d8\uff0c\u5bf9\u7b54\u6848\u8d21\u732e-s1\n\nr\u6307\u9488\u5411\u53f3\uff0c\u67d0\u4e2ak\u7684s2\u5e94\u8be5\u589e\u52a01\uff0c\u6240\u6709s1\u4e0d\u53d8\uff0c\u5bf9\u7b54\u6848\u8d21\u732es1\n\n\u6211\u4eec\u62ff\u4e24\u4e2a\u6570\u7ec4\u8bb0\u5f55\u6570\u91cf\u5c31\u597d\u4e86\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=50005,maxm=50005;\nint block;\nstruct Query{\n\tint id,x,y;\n\tbool operator <(Query i)const{\n\t\treturn ((x-1)/block==(i.x-1)/block)?y<i.y:x<i.x;\n\t}\n}q[4*maxm];\nint a[maxn];\nlong long ans=0;\nint cnt1[maxn],cnt2[maxn];\nlong long ANS[maxm];\nint read(){\n\tint x=0,y=1;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')y=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9')x=(x<<3)+(x<<1)+(ch^48),ch=getchar();\n\treturn x*y;\n}\nvoid ins1(int x){\n\tans+=cnt2[a[x]];\n\tcnt1[a[x]]++;\n\treturn ;\n}\nvoid ins2(int x){\n\tans+=cnt1[a[x]];\n\tcnt2[a[x]]++;\n\treturn ;\n}\nvoid del1(int x){\n\tans-=cnt2[a[x]];\n\tcnt1[a[x]]--;\n\treturn ;\n}\nvoid del2(int x){\n\tans-=cnt1[a[x]];\n\tcnt2[a[x]]--;\n\treturn ;\n}\nint main(){\n\tint n,m,Q=0;\n\tn=read();\n\tblock=sqrt(n);\n\tfor(int i=1;i<=n;i++)a[i]=read();\n\tm=read();\n\tfor(int i=1;i<=m;i++){\n\t\tint l1,r1,l2,r2;\n\t\tl1=read();r1=read();l2=read();r2=read();\n\t\tQ++;q[Q].id=i;q[Q].x=r1;q[Q].y=r2;\n\t\tif(q[Q].x>q[Q].y)swap(q[Q].x,q[Q].y);\n\t\tQ++;q[Q].id=-i;q[Q].x=l2-1;q[Q].y=r1;\n\t\tif(q[Q].x>q[Q].y)swap(q[Q].x,q[Q].y);\n\t\tQ++;q[Q].id=-i;q[Q].x=l1-1;q[Q].y=r2;\n\t\tif(q[Q].x>q[Q].y)swap(q[Q].x,q[Q].y);\n\t\tQ++;q[Q].id=i;q[Q].x=l1-1;q[Q].y=l2-1;\n\t\tif(q[Q].x>q[Q].y)swap(q[Q].x,q[Q].y);\n\t}\n\tsort(q+1,q+Q+1);\n\tint l=0,r=0;\n\tfor(int i=1;i<=Q;i++){\n\t\tint id=q[i].id,x=q[i].x,y=q[i].y;\n\t\twhile(l<x)ins2(++l);\n\t\twhile(l>x)del2(l--);\n\t\twhile(r<y)ins1(++r);\n\t\twhile(r>y)del1(r--);\n\t\tANS[abs(id)]+=(id<0?-ans:ans);\n\t}\n\tfor(int i=1;i<=m;i++)printf(\"%lld\\n\",ANS[i]);\n\treturn 0;\n}\n\n```",
        "postTime": 1589681938,
        "uid": 98527,
        "name": "juju527",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5268 \u3010[SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\u3011"
    },
    {
        "content": "# T \u300cSNOI2017\u300d\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\n## \u9898\u76ee\n[\u70b9\u8fd9\u91cc](https://loj.ac/problem/2254)\n## \u8003\u573a\u601d\u8003\n$50pts$\uff1a\u66b4\u641c\u524d $2$ \u7ec4\uff0c\u518d\u62ff $3$ \u7ec4\u7279\u6b8a\u6570\u636e\u5206\u3002\n\n$80pts$\uff1a\u7eaf\u83ab\u961f\uff0c\u65e0\u4f18\u5316\u3002\n\n$code-80pts$\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<cmath>\nusing namespace std;\n#define LL long long\ntemplate<class T>inline void qread(T& x){\n    char c;bool f=false;x=0;\n    while((c=getchar())<'0'||'9'<c)if(c=='-')f=true;\n    for(x=(c^48);'0'<=(c=getchar())&&c<='9';x=(x<<1)+(x<<3)+(c^48));\n    if(f)x=-x;\n}\ntemplate<class T,class... Args>inline void qread(T& x,Args&... args){qread(x),qread(args...);}\ninline int rqread(){\n    char c;bool f=false;int x=0;\n    while((c=getchar())<'0'||'9'<c)if(c=='-')f=true;\n    for(x=(c^48);'0'<=(c=getchar())&&c<='9';x=(x<<1)+(x<<3)+(c^48));\n    return f?-x:x;\n}\ntemplate<class T>inline T Max(const T x,const T y){return x>y?x:y;}\ntemplate<class T>inline T Min(const T x,const T y){return x<y?x:y;}\ntemplate<class T>inline T fab(const T x){return x>0?x:-x;}\n\nconst int MAXN=5e4;\n\nint N,M,Q,a[MAXN+5];\nstruct query{\n    int l,r,l2,r2,id;\n    query(){}\n    query(const int L,const int R,const int L2,const int R2,const int I):l(L),r(R),l2(L2),r2(R2),id(I){}\n    bool operator<(const query a){return l/M==a.l/M?r/M<a.r/M:l/M<a.l/M;}\n}q[MAXN+5];\n\nint l1,r1,l2,r2;\nint t1[MAXN+5],t2[MAXN+5],maxx;\nLL res[MAXN+5];\n\nsigned main(){\n\tqread(N);\n    M=sqrt(N);\n    for(int i=1;i<=N;++i)qread(a[i]),maxx=Max(maxx,a[i]);\n    qread(Q);\n    for(int i=1,l,r,l2,r2;i<=Q;++i){\n        qread(l,r,l2,r2);\n        q[i]=query(l,r,l2,r2,i);\n    }\n    sort(q+1,q+Q+1);\n    for(int i=1;i<=Q;++i){\n        while(r1<q[i].r)++r1,++t1[a[r1]];\n        while(r1>q[i].r)--t1[a[r1]],--r1;\n        while(l1<q[i].l)--t1[a[l1]],++l1;\n        while(l1>q[i].l)--l1,++t1[a[l1]];\n\n        while(r2<q[i].r2)++r2,++t2[a[r2]];\n        while(r2>q[i].r2)--t2[a[r2]],--r2;\n        while(l2<q[i].l2)--t2[a[l2]],++l2;\n        while(l2>q[i].l2)--l2,++t2[a[l2]];\n\n        LL ans=0;\n        for(int j=1;j<=maxx;++j)ans+=1ll*t1[j]*t2[j];\n        res[q[i].id]=ans;\n    }\n    for(int i=1;i<=Q;++i)printf(\"%lld\\n\",res[i]);\n}\n```\n\n\n## \u9898\u89e3\n\u9996\u5148\uff0c\u6211\u4eec\u4e8c\u6b21\u5dee\u5206\u5316\u7b80\u8fd9\u4e2a\u516c\u5f0f\uff08\u6211\u628a $x$ \u7701\u7565\u4e86\uff09\n$$\\begin{aligned}\n\\sum _{x=0}^{\\infty}get(l_1,r_1)\\times get(l_2,r_2)\n=&\\sum _{x=0}^{\\infty}(get(1,r_1)-get(1,l_1-1))\\times (get(1,r_2)-get(1,l_2-1)) \\\\\n=&\\sum _{x=0}^{\\infty}get(1,r_1)\\times get(1,r_2)-get(1,r_1)\\times get(1,l_2-1)-get(1,l_1-1)\\times get(1,r_2)+get(1,l_1-1)\\times get(1,l_2-1)\n\\end{aligned}\n$$\n\u7136\u540e\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u4e00\u4e2a\u8be2\u95ee\u7531\u672c\u6765\u7684\u4e24\u4e2a\u51fd\u6570\u53d8\u6210\u56db\u4e2a\u4e86\u3002\n\n\u4f46\u662f\u8fd9\u6837\u6709\u4e2a\u597d\u5904\uff0c\u6240\u6709\u7684\u51fd\u6570\u90fd\u6210\u4e3a $get(1,t)$ \u7684\u5f62\u5f0f\uff0c\u800c\u4e14\uff0c\u4e00\u4e2a\u5b50\u95ee\u9898\u88ab\u6211\u4eec\u8f6c\u5316\u6210\u4e86\u56db\u4e2a\u90e8\u5206\uff0c\u5206\u522b\u662f\uff1a\n$$\\begin{aligned}\n&Q_1=\\sum _{x=0}^{\\infty}get(1,r_1)\\times get(1,r_2) \\\\\n&Q_2=\\sum _{x=0}^{\\infty}get(1,r_1)\\times get(1,l_2-1) \\\\\n&Q_3=\\sum _{x=0}^{\\infty}get(1,l_1-1)\\times get(1,r_2) \\\\\n&Q_4=\\sum _{x=0}^{\\infty}get(1,l_1-1)\\times get(1,l_2-1)\n\\end{aligned}\n$$\n\u6700\u7ec8\uff0c\u8fd9\u4e2a\u5b50\u95ee\u9898\u7684\u7b54\u6848\u5c31\u662f $$ans=Q_1-Q_2-Q_3+Q_4$$\n\n\u90a3\u4e48\u53c8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u600e\u4e48\u6c42 $Q_i$ \uff1f\n\n\u77e5\u9053\u7684\u90fd\u4f1a\u8bf4\uff1a[\u83ab\u961f\u7b97\u6cd5](https://www.cnblogs.com/MisakaAzusa/p/8684319.html)\n\n\u53ea\u4e0d\u8fc7\u8fd9\u4e2a\u83ab\u961f\u7b97\u6cd5\u4ec5\u4ec5\u662f\u4e00\u4e2a\u601d\u8def\uff0c\u6216\u8005\u8bf4\u501f\u9274\u4e86\u83ab\u961f\u7684\u601d\u60f3\u3002\n\n\u8003\u8651\u5bf9\u4e00\u4e2a\u533a\u95f4 $[l,r]$ \u8fdb\u884c\u7ef4\u62a4\uff0c\u641e\u6e05\u695a\u7ef4\u62a4\u5bf9\u8c61\uff1a$Q_i$ \u7684\u503c\u3002\n\n\u90a3\u8fd9\u4e2a $Q_i$ \u7684\u503c\u600e\u4e48\u7ef4\u62a4\u5462\uff1f\u8fd9\u597d\u50cf\u548c\u83ab\u961f\u6ca1\u5565\u5173\u7cfb\u5427\uff1f\n\n\u662f\u7684\uff0c\u8fd9\u662f\u53d8\u5f62\u7684\u5730\u65b9\u3002\n\n\u6211\u4eec\u5148\u770b\uff0c\u5047\u5982\u8fd9\u662f\u4e00\u9053\u83ab\u961f\u7684\u9898\uff0c\u90a3\u4e48\u6211\u4eec\u52a0\u51cf\u70b9\u5c31\u662f `++(--)cnt[point]` \u5373\u53ef\u3002\n\n\u4f46\u662f\u8fd9\u9053\u9898\u6211\u4eec\u5982\u679c\u60f3\u8981 `++(--)cnt[point]` \u7684\u8bdd\uff0c\u6709\u4ec0\u4e48\u5f71\u54cd\u5462\uff1f\n\n\u5047\u5982\u8bf4\u6211\u4eec\u7ef4\u62a4 $r$ \uff0c\u90a3\u4e48\u5f53 `++(--)tr[point]` \u7684\u65f6\u5019\uff0c\u6211\u4eec\u7ef4\u62a4\u7684 $ret=Q_i$ \u7684\u503c\u7684\u53d8\u5316\uff0c\u5c31\u662f**\u53e6\u4e00\u4e2a\u62ec\u53f7\u4e00\u6574\u4e2a\u7684\u503c**\u4e86\u3002\n\n\u6240\u4ee5\u6211\u4eec\u7684 $ret$ \u5e94\u8be5\u5bf9\u5e94\u7684 `+(-)tl[point]`\u3002\n\n\u5982\u679c\u8fd8\u4e0d\u77e5\u9053\u600e\u4e48\u529e\uff0c\u770b\u770b\u4ee3\u7801\u603b\u6709\u597d\u5904...\n\n```cpp\n#include<cstdio>\n#include<cmath>\n#include<algorithm>\nusing namespace std;\n#define rep(q,a,b) for(int q=a,q##_end_=b;q<=q##_end_;++q)\n#define dep(q,a,b) for(int q=a,q##_end_=b;q>=q##_end_;--q)\ntemplate<class T>inline void qread(T& x){\n    char c;bool f=false;x=0;\n    while((c=getchar())<'0'||'9'<c)if(c=='-')f=true;\n    for(x=(c^48);'0'<=(c=getchar())&&c<='9';x=(x<<1)+(x<<3)+(c^48));\n    if(f)x=-x;\n}\ntemplate<class T,class... Args>inline void qread(T& x,Args&... args){qread(x),qread(args...);}\ninline int rqread(){\n    char c;bool f=false;int x=0;\n    while((c=getchar())<'0'||'9'<c)if(c=='-')f=true;\n    for(x=(c^48);'0'<=(c=getchar())&&c<='9';x=(x<<1)+(x<<3)+(c^48));\n    return f?-x:x;\n}\ntemplate<class T>inline T Max(const T x,const T y){return x>y?x:y;}\ntemplate<class T>inline T Min(const T x,const T y){return x<y?x:y;}\ntemplate<class T>inline T fab(const T x){return x>0?x:-x;}\n\nconst int MAXN=5e4;\n\nint N,a[MAXN+5],M,Q,tl[MAXN+5],tr[MAXN+5],ans[MAXN+5],l,r,ret;\n\nstruct query{\n\tint l,r,type,id;\n\tquery(){}\n\tquery(const int L,const int R,const int T,const int I):l(L),r(R),type(T),id(I){}\n\tbool operator<(const query a){return l/M==a.l/M?r/M<a.r/M:l/M<a.l/M;}\n}q[(MAXN<<2)+5];\n\nsigned main(){\n\tM=sqrt(N=rqread());\n\trep(i,1,N)qread(a[i]);\n\tqread(Q);\n\tfor(int i=1,l1,r1,l2,r2;i<=Q;++i){\n\t\tqread(l1,r1,l2,r2);//\u62c6\u8be2\u95ee\n\t\tq[i-1<<2]=query(r1,r2,1,i);\n\t\tq[i-1<<2|1]=query(l2-1,r1,-1,i);\n\t\tq[i-1<<2|2]=query(l1-1,r2,-1,i);\n\t\tq[i-1<<2|3]=query(l1-1,l2-1,1,i);\n\t}\n\tsort(q,q+(Q<<2));\n\tfor(int i=0;i<(Q<<2);++i){\n\t\tif(q[i].l<1||q[i].r<1)continue;\n\t/*\n\t\t\u6211\u4eec\u628a\u4e00\u4e2a\u95ee\u9898\u62c6\u6210\u4e86\u56db\u4e2a\u5b50\u95ee\u9898\n\t\t\u8003\u8651\u5176\u4e2d\u4e00\u4e2a\u5b50\u95ee\u9898 get(1,l)*get(1,r)\n\t\t\u8bbe tl \u4e3a l \u7ef4\u62a4\u7684\u6876\uff0ctr \u540c\u7406\n\t\t\u5f53\u53f3\u8fb9\u7684 get \u51cf\u53bb 1 \u540e\uff0c\n\t\t\u539f\u5f0f=get(1,l)*(get(1,r)-1)=get(1,l)*get(1,r)-get(1,l)\n\t\t\u53ef\u4ee5\u770b\u51fa\uff0c\u5f53 tr \u51cf\u53bb\u4e00\u4e2a\u4e00\u4e4b\u540e\uff0c\u53e6\u4e00\u4e2a\u62ec\u53f7\u88ab\u6574\u4f53\u51cf\u53bb\u4e00\u6b21\n\t\t\u6240\u4ee5\u6211\u4eec\u5728\u7ef4\u62a4\u5f53\u524d\u6876 tr \u548c ret \u65f6\uff0c\u6876 tr - 1 \uff0c\u4f46\u662f ret \u8981\u51cf\u53bb\u4e00\u4e2a tl \u6574\u4f53\n\t*/\n\t\twhile(l<q[i].l)ret+=tr[a[++l]],++tl[a[l]];\n\t\twhile(l>q[i].l)ret-=tr[a[l]],--tl[a[l--]];\n\t\twhile(r<q[i].r)ret+=tl[a[++r]],++tr[a[r]];\n\t\twhile(r>q[i].r)ret-=tl[a[r]],--tr[a[r--]];\n\t\tans[q[i].id]+=ret*q[i].type;\n\t}\n\tfor(int i=1;i<=Q;++i)printf(\"%d\\n\",ans[i]);\n    return 0;\n}\n```",
        "postTime": 1572435970,
        "uid": 125355,
        "name": "Vladilena",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5268 \u3010[SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\u3011"
    },
    {
        "content": "\u51e0\u4e4e\u548cthuwc2019\u7684d1t1\u4e00\u6837\uff0c~~\u7136\u800c\u5e76\u6ca1\u6709\u505a\u51fa\u6765~~\n\n\u4f20\u7edf\u83ab\u961f\u662f\u5904\u7406\u591a\u7ec4\u533a\u95f4\u8be2\u95ee\u7684\u5229\u5668\uff0c\u7136\u800c\u83ab\u961f\u7684\u6838\u5fc3\u662f\u5bf9\u4e8e\u5e73\u9762\u4e8c\u7ef4\u6570\u70b9\u54c8\u5bc6\u987f\u8def\uff08\u8ddd\u79bb\u6309\u66fc\u54c8\u987f\u8ddd\u79bb\uff09\u957f\u5ea6\u7684\u4e00\u79cd\u8f83\u4f18\u89e3\uff08$O(n\\sqrt n)$\uff09\uff0c\u5e76\u4e0d\u8981\u6c42\u6240\u6709\u70b9\u90fd\u6ee1\u8db3$x\\leq y$\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u83ab\u961f\u662f\u7528\u6765\u5904\u7406\u4e00\u7c7b\u53cc\u7aef\u70b9\u8be2\u95ee\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u533a\u95f4\u3002\n\n\u501f\u52a9\u8fd9\u4e2a\u601d\u60f3\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5dee\u5206\uff0c\u628a\u4e00\u4e2a\u8be2\u95ee$(l_1,r_1,l_2,r_2)$\u62c6\u6210\u56db\u4e2a\u53cc\u7aef\u70b9\u8be2\u95ee($(r_1,r_2)+(l_1-1,l_2-1)-(l_1-1,r_2)-(r_1,l_2-1)$)\uff0c\u5176\u4e2d\u6bcf\u4e2a\u8be2\u95ee\u662f\u5bf9\u5176\u524d\u7f00\u548c\u7684\uff08\u76f8\u5f53\u4e8e\u6240\u6709\u65b0\u8be2\u95ee\u7684l\u90fd\u4e3a1\uff09\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u628a\u4e00\u4e2a\u56db\u7aef\u70b9\u8be2\u95ee\u62c6\u6210\u56db\u4e2a\u53cc\u7aef\u70b9\u8be2\u95ee\uff0c\u4e5f\u5c31\u53ef\u4ee5\u4f7f\u7528\u83ab\u961f\u6765\u89e3\u51b3\u4e86\u3002\n\n```cpp\n#include <stdio.h>\n#include <string.h>\n#include <math.h>\n#include <algorithm>\nusing namespace std;\ntypedef long long ll;\nconst int N=5e4+2,M=2e5+2;\nll ans[N],cur;\nint bel[N],z[M],y[M],wz[M],a[N],ap1[N],ap2[N];\nint n,m,q,i,j,l,r,c,x,ksiz;\ninline void read(int &x)\n{\n\tc=getchar();\n\twhile ((c<48)||(c>57)) c=getchar();\n\tx=c^48;c=getchar();\n\twhile ((c>=48)&&(c<=57))\n\t{\n\t\tx=x*10+(c^48);\n\t\tc=getchar();\n\t}\n}\nvoid qs(int l,int r)\n{\n\tint i=l,j=r,m=bel[z[l+r>>1]],mm=y[l+r>>1];\n\twhile (i<=j)\n\t{\n\t\twhile ((bel[z[i]]<m)||(bel[z[i]]==m)&&((m&1)&&(y[i]<mm)||(1^m&1)&&(y[i]>mm))) ++i;\n\t\twhile ((bel[z[j]]>m)||(bel[z[j]]==m)&&((m&1)&&(y[j]>mm)||(1^m&1)&&(y[j]<mm))) --j;\n\t\tif (i<=j)\n\t\t{\n\t\t\tswap(z[i],z[j]);\n\t\t\tswap(y[i],y[j]);\n\t\t\tswap(wz[i++],wz[j--]);\n\t\t}\n\t}\n\tif (i<r) qs(i,r);\n\tif (l<j) qs(l,j);\n}\nint main()\n{\n\tread(n);ksiz=sqrt(n<<2);\n\tif (ksiz>n) ksiz=n;\n\tfor (i=1;i<=n;i++)\n\t{\n\t\tread(a[i]);bel[i]=(i-1)/ksiz+1;\n\t}\n\tread(q);\n\tfor (i=1;i<=q;i++)\n\t{\n\t\tread(j);read(l);read(r);read(x);\n\t\tz[++m]=l;y[m]=x;wz[m]=i;\n\t\tz[++m]=j-1;y[m]=r-1;wz[m]=i;\n\t\tz[++m]=l;y[m]=r-1;wz[m]=-i;\n\t\tz[++m]=j-1;y[m]=x;wz[m]=-i;\n\t}\n\tqs(1,m);l=0;r=0;\n\tfor (i=1;i<=m;i++)\n\t{\n\t\twhile (l<z[i])\n\t\t{\n\t\t\t++ap1[a[++l]];\n\t\t\tcur+=ap2[a[l]];\n\t\t}\n\t\twhile (r<y[i])\n\t\t{\n\t\t\t++ap2[a[++r]];\n\t\t\tcur+=ap1[a[r]];\n\t\t}\n\t\twhile (l>z[i])\n\t\t{\n\t\t\t--ap1[a[l]];\n\t\t\tcur-=ap2[a[l--]];\n\t\t}\n\t\twhile (r>y[i])\n\t\t{\n\t\t\t--ap2[a[r]];\n\t\t\tcur-=ap1[a[r--]];\n\t\t}\n\t\tif (wz[i]>0) ans[wz[i]]+=cur; else ans[-wz[i]]-=cur;\n\t}\n\tfor (i=1;i<=q;i++) printf(\"%d\\n\",ans[i]);\n}\n```\n",
        "postTime": 1554905904,
        "uid": 29826,
        "name": "SSerxhs",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5268 \u3010[SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\u3011"
    },
    {
        "content": "\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4e2a\u65e0\u8111\u5206\u5757\u505a\u6cd5\u3002\r\n\r\n\u770b\u5230\u6570\u636e\u8303\u56f4 $5\\times 10^4$\uff0c\u8003\u8651\u5206\u5757\uff0c\u8bbe\u5757\u957f\u4e3a $\\sqrt n$\u3002\u4ee4 $sum_{i,j}$ \u8868\u793a\u524d $j$ \u4e2a\u6570\u5bf9\u7b2c $i$ \u4e2a\u5757\u4ea7\u751f\u7684\u8d21\u732e\u3002\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5 $O(n\\sqrt n)$ \u9884\u5904\u7406\u51fa\u6765\u3002\r\n\r\n\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\uff0c\u628a\u5b83\u62c6\u6210\u4e09\u4e2a\u90e8\u5206\uff1a\r\n\r\n- \u533a\u95f4\u4e8c\u7684\u6240\u6709\u6574\u5757 \u5bf9 \u6574\u4e2a\u533a\u95f4\u4e00 \u4ea7\u751f\u7684\u8d21\u732e\r\n- \u533a\u95f4\u4e00\u7684\u6240\u6709\u6574\u5757 \u5bf9 \u533a\u95f4\u4e8c\u7684\u6563\u5757 \u4ea7\u751f\u7684\u8d21\u732e\r\n- \u533a\u95f4\u4e00\u7684\u6563\u5757 \u5bf9 \u533a\u95f4\u4e8c\u7684\u6563\u5757 \u4ea7\u751f\u7684\u8d21\u732e\r\n\r\n\u5efa\u8bae\u81ea\u5df1\u753b\u4e2a\u56fe\u7406\u89e3\u4e00\u4e0b\u3002\r\n\r\n\u524d\u4e24\u4e2a\u90e8\u5206\u663e\u7136\u53ef\u4ee5\u76f4\u63a5\u5229\u7528 $sum$ \u6765\u641e\uff0c\u5bf9\u4e8e\u7b2c\u4e09\u4e2a\u90e8\u5206\uff0c\u66b4\u529b\u5f00\u6876\uff0c\u626b\u4e00\u904d\u5c31\u6ca1\u4e86\u3002\r\n\r\n\u65f6\u7a7a\u590d\u6742\u5ea6\u5747\u4e3a $O(n\\sqrt n)$\u3002\u5e38\u6570\u8f83\u83ab\u961f\u7565\u5927\uff0c\u4f46\u4e0d\u5361\u5e38\u4e5f\u80fd\u505a\u5230\u7a33\u5b9a\u8dd1\u8fc7\u3002\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\nusing namespace std;\r\nconst int maxn = 50005, maxb = 255;\r\nint n, m, block, t;\r\nint a[maxn], ind[maxn];\r\nint sum[maxb][maxn];\r\nint st[maxb], ed[maxb], pos[maxn];\r\nint cnt[maxn];\r\nvoid discrete() {\r\n    memcpy(ind, a, sizeof(a)); sort(ind + 1, ind + 1 + n);\r\n    int len = unique(ind + 1, ind + 1 + n) - ind - 1;\r\n    for (int i = 1; i <= n; i++)\r\n        a[i] = lower_bound(ind + 1, ind + 1 + n, a[i]) - ind;\r\n}\r\nvoid getsum(int k) {\r\n    for (int i = st[k]; i <= ed[k]; i++) cnt[a[i]]++;\r\n    for (int i = 1; i <= n; i++) sum[k][i] = sum[k][i - 1] + cnt[a[i]];\r\n    for (int i = st[k]; i <= ed[k]; i++) cnt[a[i]]--;\r\n}\r\nvoid init() {\r\n    block = sqrt(n); t = ceil(n * 1. / block);\r\n    for (int i = 1; i <= t; i++) {\r\n        st[i] = (i - 1) * block + 1; ed[i] = min(i * block, n);\r\n        for (int j = st[i]; j <= ed[i]; j++) pos[j] = i;\r\n    }\r\n    for (int i = 1; i <= t; i++) getsum(i);\r\n}\r\nint query(int l1, int r1, int l2, int r2) {\r\n    int p1 = pos[l1], q1 = pos[r1], p2 = pos[l2], q2 = pos[r2], ans = 0;\r\n    for (int i = p2 + 1; i <= q2 - 1; i++) ans += sum[i][r1] - sum[i][l1 - 1];\r\n    for (int i = p1 + 1; i <= q1 - 1; i++)\r\n        if (p2 != q2) ans += sum[i][ed[p2]] - sum[i][l2 - 1] + sum[i][r2] - sum[i][st[q2] - 1];\r\n        else ans += sum[i][r2] - sum[i][l2 - 1];\r\n    if (p2 == q2)\r\n        for (int i = l2; i <= r2; i++) cnt[a[i]]++;\r\n    else {\r\n        for (int i = l2; i <= ed[p2]; i++) cnt[a[i]]++;\r\n        for (int i = st[q2]; i <= r2; i++) cnt[a[i]]++;\r\n    }\r\n    if (p1 == q1)\r\n        for (int i = l1; i <= r1; i++) ans += cnt[a[i]];\r\n    else {\r\n        for (int i = l1; i <= ed[p1]; i++) ans += cnt[a[i]];\r\n        for (int i = st[q1]; i <= r1; i++) ans += cnt[a[i]];\r\n    }\r\n    if (p2 == q2)\r\n        for (int i = l2; i <= r2; i++) cnt[a[i]]--;\r\n    else {\r\n        for (int i = l2; i <= ed[p2]; i++) cnt[a[i]]--;\r\n        for (int i = st[q2]; i <= r2; i++) cnt[a[i]]--;\r\n    }\r\n    return ans;\r\n}\r\nint main() {\r\n    cin >> n;\r\n    for (int i = 1; i <= n; i++) cin >> a[i];\r\n    discrete();\r\n    init();\r\n    cin >> m;\r\n    for (int i = 1; i <= m; i++) {\r\n        int l1, r1, l2, r2; cin >> l1 >> r1 >> l2 >> r2;\r\n        cout << query(l1, r1, l2, r2) << endl;\r\n    }\r\n    return 0;\r\n}\r\n```",
        "postTime": 1649816779,
        "uid": 305027,
        "name": "Tarantula",
        "ccfLevel": 6,
        "title": "P5268 [SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee \u9898\u89e3"
    },
    {
        "content": "## \u9898\u610f\u7b80\u8ff0\n\n\u6c42\u5f0f\u5b50\n\n## \u9898\u89e3\n\n\u7eaf\u7b97\u5f0f\u5b50nt\u884c\u4e3a\uff0c\u7531\u4e8e\u662f\u51fa\u73b0\u6b21\u6570\uff0c\u6ee1\u8db3\u533a\u95f4\u52a0\u51cf\u6027\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u8868\u8fbe $\\mathrm{get}(l,r,x)$\uff08\u7701\u7565 $x$\uff09:\n\n$$\n\\mathrm{get}(l,r)=\\mathrm{get}(1,r)-\\mathrm{get}(1,l-1)\n$$\n\n\u90a3\u4e48\u6211\u4eec\u4ee3\u8fdb\u539f\u5f0f\uff0c\u5316\u4e00\u6ce2\u5f0f\u5b50\uff1a\n\n$$\n\\sum_{i=1}^{\\infty}\\mathrm{get}(l_{1},r_{1},x)\\times\\mathrm{get}(l_{2},r_{2},x)\n$$\n$$\n\\sum_{i=1}^{\\infty}(\\mathrm{get}(1,r_{1})-\\mathrm{get}(1,l_{1}-1))\\times(\\mathrm{get}(1,r_{2})-\\mathrm{get}(1,l_{2}-1))\n$$\n\n$$\n\\sum_{i=1}^{\\infty}\\mathrm{get}(r_{1})\\times\\mathrm{get}(r_{2})-\\mathrm{get}(r_{1})\\times\\mathrm{get}(l_{2}-1)-\\mathrm{get}(l_{1}-1)\\times\\mathrm{get}(r_{2})+\\mathrm{get}(l_{1}-1))\\times\\mathrm{get}(l_{2}-1)\n$$\n\n$$\n\\mathrm{let}\\ F(x,y)=\\sum_{d}\\mathrm{get}(1,l,d)\\times\\mathrm{get}(1,r,d)\n$$\n\n\u5219\u7b54\u6848\u4e3a:\n\n$$\nF(r_{1},r_{2})-F(r_{1},l_{2}-1)-F(l_{1}-1,r_{2})+F(l_{1}-1,l_{2}-1)\n$$\n\n\u8003\u8651\u600e\u4e48\u66f4\u65b0\uff0c\u6bd4\u5982\u4ece $l$ \u66f4\u65b0\u5230 $l+1$\uff0c\u5219\uff1a\n\n$$\n\\mathrm{get(1,l)}\\times\\mathrm{get}(1,r)\n$$\n\n$$\n\\mathrm{get(1,l+1)}\\times\\mathrm{get}(1,r)\n$$\n\n$$\n\\mathrm{get(1,l)}\\times\\mathrm{get}(1,r)+\\mathrm{cont}(a_{l})\n$$\n\n\u5176\u4e2d $\\mathrm{cont}(a_{l})$ \u8868\u793a $a_{l}$ \u7684\u51fa\u73b0\u6b21\u6570\u3002\n\n\u5219\u6211\u4eec\u5c31\u77e5\u9053\u600e\u4e48\u66f4\u65b0\u4e86\uff0c\u7531\u4e8e\u6211\u4eec\u7ef4\u62a4\u548c\u7684\u662f\u524d\u7f00\u4fe1\u606f\uff0c\u6240\u4ee5\u59ff\u52bf\u548c\u666e\u901a\u83ab\u961f\u6709\u70b9\u4e0d\u4e00\u6837\u3002\n\n\u7ef4\u62a4\u4e24\u4e2a\u6570\u7ec4 `cntl[x]` \u548c `cntr[y]` \u8868\u793a\u7b54\u6848\u5f0f\u5b50\n\n$$\nF(r_{1},r_{2})-F(r_{1},l_{2}-1)-F(l_{1}-1,r_{2})+F(l_{1}-1,l_{2}-1)\n$$\n\n\u4e2d $F(x,y)$ \u7684\u503c\u3002\n\n\u5f0f\u5b50\u548c\u8868\u8fbe\u53ef\u80fd\u6709\u4e9b\u7384\u5b66\uff0c\u81ea\u5df1\u610f\u4f1a\u4e00\u4e0b\u5427\u3002\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n\nusing namespace std;\n\nconst int Maxn = 50000 + 5;\nint n, m, q, each, cube, isa[Maxn], bel[Maxn], cntl[Maxn], cntr[Maxn];\nlong long now, ans[Maxn];\nstruct Query_Node\n{\n\tint l, r, id, typ;\n\tQuery_Node(int tl = 0, int tr = 0, int tid = 0, int tpyt = 0)\n\t{\n\t\tl = tl;\n\t\tr = tr;\n\t\tid = tid;\n\t\ttyp = tpyt;\n\t}\n} Q[Maxn << 2];\n\nbool cmp(Query_Node rhs, Query_Node shr)\n{\n\tif (bel[rhs.l] == bel[shr.l])\treturn rhs.r < shr.r;\n\telse \treturn rhs.l < shr.l;\n}\n\nvoid Contribute()\n{\n\tint l = 0, r = 0;\n\tfor (int i = 1; i <= m; ++i)\n\t{\n\t\twhile (l < Q[i].l)\n\t\t{\n\t\t\t++cntl[isa[++l]];\n\t\t\tnow += cntr[isa[l]];\n\t\t}\n\t\twhile (l > Q[i].l)\n\t\t{\n\t\t\t--cntl[isa[l]];\n\t\t\tnow -= cntr[isa[l--]];\n\t\t}\n\t\twhile (r < Q[i].r)\n\t\t{\n\t\t\t++cntr[isa[++r]];\n\t\t\tnow += cntl[isa[r]];\n\t\t}\n\t\twhile (r > Q[i].r)\n\t\t{\n\t\t\t--cntr[isa[r]];\n\t\t\tnow -= cntl[isa[r--]];\n\t\t}\n\t\tans[Q[i].id] += Q[i].typ * now;\n\t}\n}\n\nsigned main()\n{\n\tscanf(\"%d\", &n);\n\teach = 230;\n\tfor (int i = 1; i <= n; ++i)\n\t{\n\t\tscanf(\"%d\", &isa[i]);\n\t\tbel[i] = (i - 1) / each + 1;\n\t}\n\tscanf(\"%d\", &q);\n\tfor (int i = 1; i <= q; ++i)\n\t{\n\t\tint l1, r1, l2, r2;\n\t\tscanf(\"%d %d %d %d\", &l1, &r1, &l2, &r2);\n\t\tQ[++m] = Query_Node(r1, r2, i, 1);\n\t\tQ[++m] = Query_Node(r1, l2 - 1, i, -1);\n\t\tQ[++m] = Query_Node(l1 - 1, r2, i, -1);\n\t\tQ[++m] = Query_Node(l1 - 1, l2 - 1, i, 1);\n\t}\n\tfor (int i = 1; i <= m; ++i)\n\t{\n\t\tif (Q[i].l < Q[i].r)\tswap(Q[i].l, Q[i].r);\n\t}\n\tsort(Q + 1, Q + 1 + m, cmp);\n\tContribute();\n\tfor (int i = 1; i <= q; ++i)\tprintf(\"%lld\\n\", ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1595507226,
        "uid": 161849,
        "name": "cirnovsky",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5268 \u3010[SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\u3011"
    },
    {
        "content": "\u849f\u84bb\u4e5f\u53ef\u4ee5\u505a\u7684\u5427\uff1f\n\n\u770b\u5230\u4e0d\u5e26\u4fee\u6539\u76845e4\u5c31\u5bb9\u6613\u60f3\u5230\u6839\u53f7\u7b97\u6cd5\u3002\u83ab\u961f\uff1f\u4e0d\u4f1a\u641e\u3002\u90a3\u53ef\u4e0d\u53ef\u4ee5\u7528\u5206\u5757\u5b9e\u73b0\u5462\uff1f\n\n\u9996\u5148\u89c2\u5bdf\u9898\u9762\uff0c\u8981\u6c42\u7684\u662f\u8fd9\u4e2a\u4e1c\u897f\uff1a\n\n$\\sum\\limits_{i=0}^{\u221e}sum(l_1,r_1,i) * sum(l_2,r_2,i)$\n\n\u5373\u5982\u679c$[l_1,r_1]$\u4e2d\u6709$x_1$\u4e2a$i$,$[l_2,r_2]$\u4e2d\u6709$x_2$\u4e2a$i$\uff0c\u5c31\u4f1a\u5bf9\u7b54\u6848\u4ea7\u751f$x_1 * x_2$\u7684\u8d21\u732e\n\n\u90a3\u4e48\u628a\u8fd9\u4e2a\u5f0f\u5b50\u62c6\u4e00\u4e0b\u5c31\u80fd\u53d8\u6210\uff1a\uff08~~\u4eca\u5929\u6a21\u62df\u8d5b\u51fa\u539f\u9898\u8bf6~~\uff09$\\sum\\limits_{i=l_1}^{r_1}\\sum\\limits_{j=l_2}^{r_2}[a[i]=a[j]]$\n\n\u8f6c\u5316\u540e\u600e\u4e48\u5206\u5757\u5462\uff1f\n\n\u9996\u5148\u8981\u79bb\u6563\u5316\u4e00\u4e0b\u3002\u3002\u3002\n\n\u6211\u4eec\u8bbe$Q[i][j]$\u8868\u793a\u7b2c$i$\u4e2a\u6570\u4e2d\u4e0e\u524d$j$\u4e2a\u5757\u4e2d\u7684\u6570\u76f8\u7b49\u7684\u7ec4\u6570\u3002$K[i][j]$\u8868\u793a\u7b2c$i$\u4e2a\u5757\u4e2d\u4e0e\u524d$j$\u4e2a\u5757\u4e2d\u76f8\u7b49\u7684\u6570\u7684\u7ec4\u6570\n\n\u600e\u4e48\u6c42\u8fd9\u4e24\u4e2a\u6570\u7ec4\u5462\uff1f\n\n\u6211\u4eec\u5148\u628a$a$\u6570\u7ec4\u79bb\u6563\u5316\u4e00\u4e0b\n\n\u8bbe$pre[i][j]$\u8868\u793a\u524di\u4e2a\u5757\u4e2d\u542b\u6709\u7684$j$\u7684\u4e2a\u6570\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u901a\u8fc7\u9012\u63a8pre\u6570\u7ec4\u76f4\u63a5\u6c42\u4e86\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u8be2\u95ee$:l_1$,$r_1$,$l_2$,$r_2$\uff0c\u90a3\u4e48\u5148\u628a\u7b2c\u4e00\u4e2a\u7684\u5757\u5206\u51fa\u6765\uff0c\u518d\u5206\u7b2c\u4e8c\u4e2a\u7684\u5757\u3002\u8bbe\u5206\u51fa\u6765\u7684\u5757\u96c6\u5408\u5206\u522b\u4e3a$U_1$\uff08\u5de6\u53f3\u7aef\u70b9\u4e3a$L_1$\u4e0e$R_1$\uff09\uff0c$U_2$\uff08\u5de6\u53f3\u7aef\u70b9\u4e3a$L_2$\u4e0e$R_2$\uff09\uff0c\u5269\u4e0b\u7684\u96f6\u6563\u70b9\u7684\u96c6\u5408\u4e3a$A_1$,$A_2$\n\n\u7b54\u6848\u5c31\u4e3a$Q[x][R_1]_ {x\\in U_2}-Q[x][L_1-1]_ {x\\in U_2}+Q[x][R_2]_ {x\\in U_1}-Q[x][L_2-1]_ {x\\in U_1}+{\\sum\\limits_{i=L_1}^{R_1}}K[i][R_2]-K[i][L_2-1]+[x=y] _ {x\\in A_1,y\\in A_2}$\n\n\u524d\u9762\u7684\u90fd\u5df2\u7ecf\u9884\u5904\u7406\u597d\u4e86\uff0c\u800c\u4e14\u90fd\u63a7\u5236\u5728$O(sqrt(n))$\uff0c\u6700\u540e\u7684$[x=y]$\u9879\u5462\uff1f\n\n\u5bb9\u6613\u53d1\u73b0$|A_1|,|A_2|<=sqrt(n)$\u3002\u90a3\u4e48\u53ef\u4ee5\u5bf9\u4e8e\u5176\u4e2d\u4e00\u4e2a\uff0c\u628a\u5143\u7d20\u90fd\u653e\u5165\u6876\u4e2d\uff0c\u53e6\u4e00\u4e2a\u4f9d\u6b21\u6765\u7edf\u8ba1\uff0c\u63d2\u5165$O(sqrt(n))$\uff0c\u67e5\u8be2$O(sqrt(n))$\uff0c\u5220\u9664\u53ef\u4ee5\u6253\u6807\u8bb0\uff0c$O(sqrt(n))$\n\n\u7136\u540e\u5c31\u505a\u5b8c\u5566\uff01\n\n\u7ec6\u8282\u633a\u591a\u7684\uff0c\u8be6\u89c1\u4ee3\u7801\u5427\uff5e\n\n```cpp\n#include <bits/stdc++.h>\n\n#define N 50100\n\n#define Nk 210\n\n#define ll long long\n\n#pragma GCC optimize(2)\n\nusing namespace std;\n\nint l[N],r[N];\n\n//\u96f6\u6563\u7684\u6570\u5c31\u76f4\u63a5\u641c\uff0c\u8fd9\u6837\u6ee1\u8db3\u4e00\u5b9a\u662fO(sqrt(n))\u7684\n\nint Q[N][Nk];//\u6bcf\u4e2a\u6570\u7684\u5bf9\u5e94\n\nint K[Nk][Nk];//\u6bcf\u4e2a\u5757\u7684\u5bf9\u5e94\n\nint pre[Nk][N];//pre\u6570\u7ec4\uff0c\u6bcf\u4e2a\u5757\u524d\u7f00\u548c\u7684\u6240\u542b\u6570\n\nint cnt;\n\nint dy[N],tot;\n\nint x1,x2,x3,x4;\n\nint n,m;\n\nint v[N];\n\nint val[N];\n\n\nstruct data{\n\tint x,y,z;\n}a[N];\n\ninline int read(){\n\tint x=0;char c=getchar();bool y=1;\n\tfor(;c<'0' || c>'9';c=getchar()) if(c=='-') y=0;\n\tfor(;c>='0' && c<='9';c=getchar()) x=(x<<1)+(x<<3)+c-48;\n\tif(y) return x;\n\treturn -x;\n}\n\nbool cmp(data x,data y){\n\treturn x.x<y.x;\n}\n\nbool dmp(data x,data y){\n\treturn x.y<y.y;\n}\n\nint main(){\n\tn=read();\n\tfor(int i=1;i<=n;i++)\n\ta[i].x=read(),a[i].y=i;\n\tsort(a+1,a+n+1,cmp);\n\n\tm=read();\n\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tif(a[i].x!=a[i-1].x)\n\t\ttot++;\n\t\ta[i].z=tot;\n\t}\n\n\tsort(a+1,a+n+1,dmp);//\u79bb\u6563\u5316\n\t\n\tfor(int i=1;i<=n;i+=300)//\u5206\u51fa\u5757\n\t{\n\t\tcnt++;\n\t\tl[cnt]=r[cnt-1]+1,r[cnt]=min(n,l[cnt]+299);\n\t}\n\n\tfor(int i=1;i<=cnt;i++)//\u6c42\u51fapre\u6570\u7ec4\n\t{\n\t\tfor(int j=1;j<=tot;j++)\n\t\t{\n\t\t\tpre[i][j]=pre[i-1][j];\n\t\t}\n\t\tfor(int j=l[i];j<=r[i];j++)\n\t\tpre[i][a[j].z]++;\n\t}\n\n\tfor(int i=1;i<=cnt;i++)\n\t{\n\t\tfor(int j=1;j<=cnt;j++)\n\t\t{\n\t\t\tfor(int k=l[i];k<=r[i];k++)//\u4f9d\u6b21\u9012\u63a8Q\uff0cK\u6570\u7ec4\n\t\t\t{\n\t\t\t\tQ[k][j]=pre[j][a[k].z];\n\t\t\t\tK[i][j]+=Q[k][j];\n\t\t\t}\n\t\t}\n\t}\n\t\n\twhile(m--){//\u5f00\u59cb\u8be2\u95ee\u4e86\n\t\tx1=read(),x2=read(),x3=read(),x4=read();\n\t\tint L1=1,R1=cnt,L2=1,R2=cnt;\n\t\twhile(x1>l[L1]) L1++;\n\t\twhile(x3>l[L2]) L2++;\n\t\twhile(x2<r[R1]) R1--;\n\t\twhile(x4<r[R2]) R2--;\n\t\t\n\t\tll ans=0;\n\n\t\tif(L2<=R2)\n\t\t{\n\n\t\t\tif(L1<=R1)\n\t\t\t{\n\t\t\t\tfor(int i=x1;i<l[L1];i++)\n\t\t\t\tans+=Q[i][R2]-Q[i][L2-1];\n\t\t\t\t\n\t\t\t\tfor(int i=r[R1]+1;i<=x2;i++)\n\t\t\t\tans+=Q[i][R2]-Q[i][L2-1];\n\t\t\t}//\u7edf\u8ba1Q\u7684\u8d21\u732e\uff0c\u6ce8\u610f\u5206\u60c5\u51b5\u8ba8\u8bba\n\t\t\telse\n\t\t\tfor(int i=x1;i<=x2;i++)\n\t\t\tans+=Q[i][R2]-Q[i][L2-1];\n\t\t\t\n\t\t\tfor(int i=L1;i<=R1;i++)//\u7edf\u8ba1K\u7684\u8d21\u732e\n\t\t\tans+=K[i][R2]-K[i][L2-1];\n\n\t\t\tfor(int i=x3;i<l[L2];i++)\n\t\t\t{\n\t\t\t\tif(!val[a[i].z]) v[++v[0]]=a[i].z;\n\t\t\t\tval[a[i].z]++;\n\t\t\t}\n\t\t\tfor(int i=r[R2]+1;i<=x4;i++)\n\t\t\t{\n\t\t\t\tif(!val[a[i].z]) v[++v[0]]=a[i].z;\n\t\t\t\tval[a[i].z]++;\n\t\t\t}\n\t\t}\n\t\telse\n\t\tfor(int i=x3;i<=x4;i++)\n\t\t{\n\t\t\tif(!val[a[i].z]) v[++v[0]]=a[i].z;\n\t\t\tval[a[i].z]++;\n\t\t}\n\n\t\tif(L1<=R1)\n\t\t{\n\t\t\tfor(int i=x1;i<l[L1];i++)//\u7edf\u8ba1\u6563\u5757\u8d21\u732e\n\t\t\tans+=val[a[i].z];\n\t\t\t\n\t\t\tfor(int i=r[R1]+1;i<=x2;i++)\n\t\t\tans+=val[a[i].z];\n\t\t\t\n\t\t\tif(L2<=R2){//Q\u7684\u662f\u5206\u5f00\u7684\uff0c\u6bcf\u4e2a\u8981\u518d\u7edf\u8ba1\u4e00\u6b21\n\t\t\t\tfor(int i=x3;i<l[L2];i++)\n\t\t\t\tans+=Q[i][R1]-Q[i][L1-1];\n\t\t\t\tfor(int i=r[R2]+1;i<=x4;i++)\n\t\t\t\tans+=Q[i][R1]-Q[i][L1-1];\n\t\t\t}\n\t\t\telse\n\t\t\tfor(int i=x3;i<=x4;i++)\n\t\t\tans+=Q[i][R1]-Q[i][L1-1];\n\t\t}\n\t\telse\n\t\tfor(int i=x1;i<=x2;i++)\n\t\tans+=val[a[i].z];\n\t\t\n\t\tfor(int i=1;i<=v[0];i++)\n\t\t{\n\t\t\tval[v[i]]=0;\n\t\t\tv[i]=0;\n\t\t}\n\t\tv[0]=0;\n\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\n\treturn 0;\n}\n```\n\u54e6\uff0c\u5fd8\u8bb0\u8bf4\u4e86\uff0c\u8981\u5f00$O2$\u624d\u8dd1\u5f97\u8fc7\u53bb\u3002\u3002\u3002\uff08\u53ef\u80fd\u662f\u5e38\u6570\u5de8\u5927\u5427\uff09",
        "postTime": 1570110306,
        "uid": 55357,
        "name": "Thaumaturge",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5268 \u3010[SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\u3011"
    },
    {
        "content": "\u57fa\u7840\u83ab\u961f\u3002\n\n\u9898\u610f\uff1a\u591a\u7ec4\u8be2\u95ee\uff0c\u7ed9\u5b9a\u4e0d\u53d8\u7684\u5e8f\u5217 $a$\uff0c\u6bcf\u6b21\u7ed9\u51fa $l_1,r_1,l_2,r_2$\uff0c\u5b9a\u4e49 $\\operatorname{get}(l,r,p)$ \u4e3a\u533a\u95f4 $[l,r]$ \u4e2d\uff0c\u6709\u591a\u5c11\u4e2a $a_i=p$\u3002\u6c42\uff1a\n\n$$\\sum_{x=0}^\u221e \\operatorname{get}(l_1,r_1,x)\\times \\operatorname{get}(l_2,r_2,x)$$\n\n\u663e\u7136\u8fd9\u4e2a\u8be2\u95ee\u662f\u5341\u5206\u590d\u6742\u7684\u3002\u8003\u8651\u5bb9\u65a5\uff0c\u5c06 $l_1,r_1,l_2,r_2$ \u62bd\u8c61\u4e3a\u4e00\u4e2a\u70b9\u5bf9 $((l_1,r_1),(l_2,r_2))$\u3002\u8bbe $\\operatorname{g}(u\uff0cx)=\\operatorname{get}(1,u,x)$\uff0c\u7b54\u6848\u5373\u4e3a\uff1a\n\n$$\n\\sum_{x=0}^\u221e \\operatorname{g}(r_1,x)\\times \\operatorname{g}(r_2,x)-\\operatorname{g}(r_1,x)\\times \\operatorname{g}(l_2-1,x)-\\operatorname{g}(r_2,x)\\times\\operatorname{g}(l_1-1,x)+\\operatorname{g}(l_1-1,x)\\times  \\operatorname{g}(l_2-1,x)\n$$\n\n\u4f7f\u7528\u83ab\u961f\uff0c\u5c06\u6bcf\u7ec4\u8be2\u95ee\u62c6\u6210\u56db\u7ec4\u8ba1\u7b97\u5373\u53ef\u3002\n\n\u53e6\u5916\uff0c\u56e0\u4e3a $a$ \u4e2d\u7684\u5143\u7d20\u6700\u5927\u4e3a $5\\times 10^4$\uff0c\u539f\u5f0f\u7684 $\u221e$ \u5373\u4e3a $5 \\times 10^4$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nLL cntl[50005],p,pos[50005],a[50005],n,m,gr,ans[50005],cntr[50005];\nstruct queries{\n\tLL l,r,id,gx;\n\tqueries(){l=r=id=gx=0;}\n\tqueries(LL L,LL R,LL ID,LL GX){l=L,r=R,id=ID,gx=GX;if(l>r)\tl^=r^=l^=r;}\n\tbool operator < (queries x) {\n\t\tif(pos[l]==pos[x.l])\treturn r<x.r;\n\t\treturn l<x.l;\n\t}\n}que[400005];\nvoid add1(LL s)\n{\n\tgr+=cntr[a[s]];\n\t++cntl[a[s]];\n}\nvoid add2(LL s)\n{\n\tgr+=cntl[a[s]];\n\t++cntr[a[s]];\n}\nvoid sub1(LL s)\n{\n\tgr-=cntr[a[s]];\n\t--cntl[a[s]];\n}\nvoid sub2(LL s)\n{\n\tgr-=cntl[a[s]];\n\t--cntr[a[s]];\n}\nint main(){\n\tscanf(\"%lld\",&n);\n\tp=sqrt(n);\n\tfor(LL i=1;i<=n;++i)\tscanf(\"%lld\",&a[i]),pos[i]=(i-1)/p+1;\n\tscanf(\"%lld\",&m);\n\tfor(LL i=1;i<=m;++i)\n\t{\n\t\tLL l1,l2,r1,r2;\n\t\tscanf(\"%lld %lld %lld %lld\",&l1,&r1,&l2,&r2);\n\t\tque[i*4-3]=queries(r1,r2,i,1);\n\t\tque[i*4-2]=queries(r1,l2-1,i,-1);\n\t\tque[i*4-1]=queries(l1-1,r2,i,-1);\n\t\tque[i*4]=queries(l1-1,l2-1,i,1);\n\t}\n\tm*=4;\n\tsort(que+1,que+1+m);\n\tfor(LL i=1,l=1,r=1;i<=m;++i)\n\t{\n\t\twhile(l>que[i].l)\tsub2(l--);\n\t\twhile(r<que[i].r)\tadd1(++r);\n\t\twhile(l<que[i].l)\tadd2(++l);\n\t\twhile(r>que[i].r)\tsub1(r--);\n\t\tans[que[i].id]+=que[i].gx*gr;\n\t}\n\tfor(LL i=1;i<=m/4;++i)\tprintf(\"%lld\\n\",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1595493960,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5268 \u3010[SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\u3011"
    },
    {
        "content": "\u6253\u5b8c\u52a0\u5f3a\u7248 [P4689 [Ynoi2016]\u8fd9\u662f\u6211\u81ea\u5df1\u7684\u53d1\u660e](https://www.luogu.com.cn/problem/P4689) \u6765\u628a\u8fd9\u9053\u9898\u5207\u4e86\uff08\n\n----\n\n### \u9898\u89e3\n\n\u4ee4\n\n$$\n{\\rm{F}}(l_1,r_1,l_2,r_2)=\\sum_{x=1}^{\\infty} {\\rm{get}}(l_1,r_1,x) \\times {\\rm{get}}(l_2,r_2,x)\n$$\n\n\u5bf9\u4e8e\u539f\u5f0f\u53ef\u4ee5\u505a\u4e00\u4e2a\u5dee\u5206\uff1a\n\n$$\n{\\rm{get}}(l_1,r_1,x)={\\rm{get}}(1,r_1,x)-{\\rm{get}}(1,l_1-1,x)\n$$\n\n\u4ee3\u5165\u539f\u5f0f\u4e2d\u5e76\u5316\u7b80\u5f97\u5230\uff1a\n\n$$\n{\\rm{F}}(l_1,r_1,l_2,r_2)={\\rm{F}}(1,r_1,1,r_2)-{\\rm{F}}(1,r_1,1,l_2-1)-{\\rm{F}}(1,l_1-1,1,r_2)+{\\rm{F}}(1,l_1-1,1,l_2-1)\n$$\n\n\u4ee4 ${\\rm{f}}(l,r)={\\rm{F}}(1,l,1,r)$\uff0c\u5219\u5c06\u7ed9\u51fa\u7684\u6bcf\u4e2a\u8be2\u95ee\u62c6\u6210\u56db\u4e2a\u5f62\u5982 ${\\rm{f}}(l,r)$ \u7684\u8be2\u95ee\u5373\u53ef\u3002\n\n\u6ce8\u610f\uff1a\u7531\u4e8e ${\\rm{f}}(l,r)$ \u7684\u4e24\u4e2a\u4e0b\u6807\u5e76\u4e0d\u4ee3\u8868\u533a\u95f4\uff0c\u6240\u4ee5\u83ab\u961f\u4e2d $\\text{add,del}$ \u64cd\u4f5c\u4e0e\u533a\u95f4\u67e5\u8be2\u7565\u6709\u4e0d\u540c\u3002\n\n---\n\nCode\uff1a\n\n```cpp\n#include <iostream>\n#include <cstring>\n#include <cstdio>\n#include <algorithm>\n#define maxn 50005\n#define R register\n#define INF 0x3f3f3f3f\n#define lxl long long\n#define BN 400\nusing namespace std;\n\ninline lxl read()\n{\n\tlxl x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9') {if(ch=='-') f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9') {x=(x<<1)+(x<<3)+ch-'0';ch=getchar();}\n\treturn x*f;\n}\n\nstruct ques\n{\n\tint l,r,id;\n\tbool operator < (const ques &x) const\n\t{\n\t\tif(l/BN!=x.l/BN) return l<x.l;\n\t\tif((l/BN)&1) return r<x.r;\n\t\treturn r>x.r;\n\t}\n}query[maxn<<2];\n\nint qcnt;\nint N,Q,a[maxn];\n\ninline void Get_Query(int l1,int r1,int l2,int r2,int id)\n{\n\tquery[++qcnt]=(ques){r1,r2,id};\n\tquery[++qcnt]=(ques){r1,l2-1,-id};\n\tquery[++qcnt]=(ques){l1-1,r2,-id};\n\tquery[++qcnt]=(ques){l1-1,l2-1,id};\n}\n\nlxl cnt1[maxn],cnt2[maxn],ans[maxn],sum;\n\ninline void add1(int i)\n{\n\t++cnt1[i];\n\tsum+=cnt2[i];\n}\n\ninline void del1(int i)\n{\n\t--cnt1[i];\n\tsum-=cnt2[i];\n}\n\ninline void add2(int i)\n{\n\t++cnt2[i];\n\tsum+=cnt1[i];\n}\n\ninline void del2(int i)\n{\n\t--cnt2[i];\n\tsum-=cnt1[i];\n}\n\nint main()\n{\n\t//freopen(\"P5268.in\",\"r\",stdin);\n\tN=read();\n\tfor(R int i=1;i<=N;++i)\n\t\ta[i]=read();\n\tQ=read();\n\tfor(R int i=1;i<=Q;++i)\n\t{\n\t\tint l1=read(),r1=read(),l2=read(),r2=read();\n\t\tGet_Query(l1,r1,l2,r2,i);\n\t}\n\tfor(R int i=1;i<=qcnt;++i)\n\t\tif(query[i].l>query[i].r)\n\t\t\tswap(query[i].l,query[i].r);\n\tsort(query+1,query+qcnt+1);\n\tfor(R int i=1,l=1,r=1;i<=qcnt;++i)\n\t{\n\t\tques &q=query[i];\n\t\twhile(l<q.l) add1(a[++l]);\n\t\twhile(l>q.l) del1(a[l--]);\n\t\twhile(r>q.r) del2(a[r--]);\n\t\twhile(r<q.r) add2(a[++r]);\n\t\tans[abs(q.id)]+=sum*1ll*(q.id/abs(q.id));\n\t}\n\tfor(R int i=1;i<=Q;++i)\n\t\tprintf(\"%lld\\n\",ans[i]);\n\treturn 0;\n}\n```\n",
        "postTime": 1593081846,
        "uid": 224236,
        "name": "GoPoux4",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5268 \u3010[SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\u3011"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P5268)\n# \u5206\u6790\n\u5bf9\u4e8e\u53ea\u67e5\u8be2\u4e0d\u4fee\u6539\uff0c\u800c\u4e14\u67e5\u8be2\u6709\u5173\u5143\u7d20\u51fa\u73b0\u6b21\u6570\u7684\u8981\u6c42\uff0c\u6211\u4eec\u663e\u7136\u8981\u7528\u83ab\u961f\u505a\u3002\u4f46\u662f\u6211\u4eec\u6ca1\u6cd5\u4e00\u6b21\u5904\u7406\u56db\u4e2a\u7aef\u70b9\uff0c\u4e5f\u6ca1\u6cd5\u5c06\u4e58\u6cd5\u5206\u5f00(\u6539\u6210\u7eaf\u52a0\u51cf\u8fd0\u7b97\u5f88\u9ebb\u70e6\u4e14\u65f6\u95f4\u5f88\u9ad8)\u3002\u6211\u4eec\u8003\u8651\u5c06\u9898\u76ee\u4e22\u7ed9\u6211\u4eec\u7684\u5f0f\u5b50\u6539\u5199\u4e00\u4e0b\uff1a\n\n$$\\sum^{\\infty}_{x=0}get(l_1,r_1,x)*get(l_2,r_2,x)$$\n$=$\n$$\\sum^{\\infty}_{x=1}\\{[get(1,r_1,x)-get(1,l_1-1,x)]*[get(1,r_2,x)-get(1,l_2-1,x)]\\}$$\n\u4f46\u662f\u8fd9\u4e2a\u5f0f\u5b50\u592a\u957f\u4e86\uff0c\u6211\u4eec\u8bbe\n$$f(a,x)=get(1,a,x)$$\n\u90a3\u4e48\u539f\u5f0f\u8f6c\u5316\u4e3a\uff1a\n$$\\sum^{\\infty}_{x=1}f(r_1,x)f(r_2,x)-f(r1,x)f(l_2-1,x)-f(l_1-1,x)f(r_2,x)+f(l_1-1,x)f(l_2-1,x)$$\n\u770b\u5230\u8fd9\u91cc\u6211\u4eec\u8fd8\u662f\u5f97\u5230\u4e00\u4e9b\u672c\u8d28\u4e0a\u662f\u4e58\u6cd5\u7684\u5f0f\u5b50(~~\u96be\u9053\u849f\u84bb\u771f\u7684\u505a\u4e0d\u51fa\u6765\u4e86\u5417\uff1f~~)\uff0c\u4f46\u662f\u7ec6\u770b\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u4e0a\u9762\u7684\u6240\u6709\u4e58\u6cd5\u5f0f\u90fd\u6709\u4e00\u4e2a\u5171\u540c\u70b9\uff1a\u4e58\u53f7\u4e24\u8fb9\u7684\u5f0f\u5b50\u6709\u91cd\u53e0\u90e8\u5206!\u6211\u4eec\u5047\u8bbe\u73b0\u5728\u5de6\u6307\u9488\u5411\u5de6\u79fb\u4e86\u4e00\u4f4d(\u4ece$l$\u5230$l-1$)\uff0c\u5219\u65b0\u7b54\u6848\u4e3a$ans'=f(l-1,a_l)f(r,a_l)$ \uff0c\u5bf9\u7b54\u6848\u7684\u5f71\u54cd\u4e3a:\n$$ans-ans'=f(l,a_l)f(r,a_l)-f(l-1,a_l)f(r,a_l)=f(r,a_l)$$\n\u5bf9\u4e8e\u5de6\u6307\u9488\u53f3\u79fb\u4ee5\u53ca\u53f3\u6307\u9488\u53ef\u7528\u540c\u6837\u65b9\u6cd5\u5f97\u51fa\u7b54\u6848\u7684\u8f6c\u79fb\uff0c\u6240\u4ee5\u6211\u4eec\u6210\u529f\u5c06\u4e0a\u9762\u7684\u5f0f\u5b50\u8f6c\u6362\u6210\u4e86\u52a0\u6cd5\u5f0f\u3002\u6211\u4eec\u53ea\u9700\u5c06$cnt$\u6570\u7ec4\u5f00\u6210\u4e24\u7ef4\uff0c\u5206\u522b\u50a8\u5b58$f(l,x)$\u4e0e$f(r,x)$\u5373\u53ef(\u8fd9\u4e5f\u662f\u672c\u849f\u84bb\u65e0\u6cd5\u7406\u89e3\u9c7c\u5927\u4f6c~~\u7384\u5b66\u66f4\u65b0\u7b54\u6848~~\u4e4b\u5904\uff0c\u671b\u5404\u4f4d\u5927\u4f6c\u6307\u6559\uff0c\u8c22\u8c22)\u3002\n\n$Code:$\n```cpp\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\nusing namespace std;\n#define N 50000\n#define LL long long\n\nint n , m , M , num;\nint a[N + 2];\nint cnt[2][N + 2];\nLL ans , Ans[N + 2];\nstruct Node{\n\tint left , right , id;\n\tbool type;\n\tNode(){}\n\tNode(int A , int B , int C , bool D) {\n\t\tleft = A;\n\t\tright = B;\n\t\tid = C;\n\t\ttype = D;\n\t}\n\tbool operator < (const Node &x) const {\n\t\treturn (left / num) == (x.left / num) ? right < x.right : left < x.left;\n\t}\n}ask[4 * N + 2];\n\nvoid in(int &x) {\n\tx = 0;\n\tchar c = getchar();\n\tbool f = 1;\n\twhile(c < '0' or c > '9') {\n\t\tif(c == '-') f = 0;\n\t\tc = getchar();\n\t}\n\twhile(c >= '0' and c <= '9') {\n\t\tx = (x << 1) + (x << 3) + c - '0';\n\t\tc = getchar();\n\t}\n\tif(!f) x = (~x) + 1;\n} \n\nvoid out(int x) {\n\tif(x < 0) {\n\t\tx = (~x) + 1;\n\t\tputchar('-');\n\t}\n\tif(x >= 10) out(x / 10);\n\tputchar(x % 10 + '0');\n}\n\nvoid add(int direction , int x) {\n\tans += cnt[direction][a[x]];\n\t++ cnt[!direction][a[x]];\n}\n\nvoid del(int direction , int x) {\n\tans -= cnt[direction][a[x]];\n\t-- cnt[!direction][a[x]];\n}\n\nint main() {\n\tin(n);\n\tfor(int i = 1; i <= n; i ++) in(a[i]);\n\tin(m);\n\tnum = n / sqrt(m); \n\tint l1 , r1 , l2 , r2;\n\tfor(int i = 1; i <= m; i ++) {\n\t\tin(l1) , in(r1) , in(l2) , in(r2);\n\t\task[++ M] = Node(r1 , r2 , i , 1);\n\t\task[++ M] = Node(r1 , l2 - 1 , i , 0);\n\t\task[++ M] = Node(l1 - 1 , r2  , i , 0);\n\t\task[++ M] = Node(l1 - 1 , l2 - 1 , i , 1);\n\t}\n\tfor(int i = 1; i <= M; i ++) if(ask[i].left > ask[i].right) swap(ask[i].left , ask[i].right);\n\tsort(ask + 1 , ask + M + 1);\n\tint l = 0 , r = 0;\n\tfor(int i = 1; i <= M; i ++) {\n\t\twhile(l < ask[i].left) add(1 , ++ l);\n\t\twhile(l > ask[i].left) del(1 , l --);\n\t\twhile(r < ask[i].right) add(0 , ++ r);\n\t\twhile(r > ask[i].right) del(0 , r --);\n\t\tif(ask[i].type) Ans[ask[i].id] += ans;\n\t\telse Ans[ask[i].id] -= ans;\n\t}\n\tfor(int i = 1; i <= m; i ++) out(Ans[i]) , putchar('\\n');\n\treturn 0;\n}\n```",
        "postTime": 1563781568,
        "uid": 124142,
        "name": "C2021PBW",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5268 \u3010[SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\u3011"
    },
    {
        "content": "\u6c27\u6c14\u4f18\u5316\u5feb\u6392 Orz \n\n\n# noteskey\n\n\u603b\u4e4b\u8fd9\u9898\u76ee\u5149\u770b\u5f0f\u5b50\u975e\u5e38\u4e0d\u53ef\u505a\uff0c\u4f46\u662f\u770b\u8d77\u6765\u5c31\u5f88\u5957\u8def\uff08\u6240\u4ee5\u600e\u4e48\u9ed1\u7684\uff09\n\n\n\u6211\u4eec\u4e00\u773c\u770b\u53bb\u8fd9\u4e2a\u533a\u95f4\u4fe1\u606f\u5c31\u662f\u6ee1\u8db3\u53ef\u52a0\u53ef\u51cf\u6027\u7684\uff0c\u6240\u4ee5\u5dee\u5206\u4e00\u4e0b\uff0c\u8be2\u95ee\u5206\u6210 4 \u4efd\uff0c\u7136\u540e\u83ab\u961f\u5904\u7406\u5c31\u597d\u4e86\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u539f\u672c\u662f $(r1-l1) * (r2-l2)$\n\n\u73b0\u5728\u53d8\u6210\u4e86 $(r1-0) * (r2-0)-(r1-0)* (l2-1 -0)-(r2-0)* (l1-1 -0) + (l1-1-0)* (l2-1-0)$\n\n\n\u4f46\u8fd9\u4e2a\u83ab\u961f\u6709\u70b9\u6e05\u5947\u5c31\u5bf9\u4e86\uff0c\u56e0\u4e3a\u7b54\u6848\u7edf\u8ba1\u7684\u662f 1~l \u548c 1~r \u4e24\u4e2a\u533a\u95f4\u7684\u4fe1\u606f\u4e58\u79ef...\n\n\n\n# code\n\n\n\n```cpp\n//by Judge\n#include<bits/stdc++.h>\n#define Rg register\n#define fp(i,a,b) for(Rg int i=(a),I=(b)+1;i<I;++i)\n#define ll long long\nusing namespace std;\nconst int M=5e4+3;\ntypedef ll arr[M];\n#ifndef Judge\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\n#endif\nchar buf[1<<21],*p1=buf,*p2=buf;\ninline int read(){ ll x=0,f=1; char c=getchar();\n\tfor(;!isdigit(c);c=getchar()) if(c=='-') f=-1;\n\tfor(;isdigit(c);c=getchar()) x=x*10+c-'0'; return x*f;\n} char sr[1<<21],z[20];int CCF=-1,Z;\ninline void Ot(){fwrite(sr,1,CCF+1,stdout),CCF=-1;}\ninline void print(ll x,char chr='\\n'){\n    if(CCF>1<<20)Ot();if(x<0)sr[++CCF]=45,x=-x;\n    while(z[++Z]=x%10+48,x/=10);\n    while(sr[++CCF]=z[Z],--Z);sr[++CCF]=chr;\n} ll n,m,bl,cnt,L,R,res; arr a,pos,ans,cntl,cntr;\nstruct que{ int l,r,id,tp; }q[M<<2];\ninline bool cmp(que a,que b){return pos[a.l]^pos[b.l]?a.l<b.l:pos[a.l]&1?a.r<b.r:a.r>b.r;}\nint main(){ int l1,r1,l2,r2; n=read(),bl=sqrt(n);\n\tfp(i,1,n) a[i]=read(),pos[i]=(i-1)/bl+1; m=read();\n\tfp(i,1,m){ l1=read(),r1=read(),l2=read(),r2=read();\n\t\tq[++cnt]={r1,r2,i,1},q[++cnt]={l1-1,l2-1,i,1};\n\t\tq[++cnt]={l1-1,r2,i,-1},q[++cnt]={r1,l2-1,i,-1};\n\t}\n\tfp(i,1,cnt) if(q[i].l>q[i].r) swap(q[i].l,q[i].r);\n\tsort(q+1,q+1+cnt,cmp); fp(i,1,cnt){\n\t\twhile(L<q[i].l) ++L,++cntl[a[L]],res+=cntr[a[L]];\n\t\twhile(R<q[i].r) ++R,++cntr[a[R]],res+=cntl[a[R]];\n\t\twhile(L>q[i].l) res-=cntr[a[L]],--cntl[a[L]],--L;\n\t\twhile(R>q[i].r) res-=cntl[a[R]],--cntr[a[R]],--R;\n\t\tif(q[i].tp>0) ans[q[i].id]+=res; else ans[q[i].id]-=res;\n\t} fp(i,1,m) print(ans[i]); return Ot(),0;\n}\n```\n",
        "postTime": 1555243739,
        "uid": 38576,
        "name": "J\u03bcdge",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5268 \u3010[SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\u3011"
    },
    {
        "content": "\n[\u672c\u849f\u84bb\u7684Blog](https://www.chnxuzhiyuan.cn/2019/03/04/%E3%80%8CSNOI2017%E3%80%8D%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%AF%A2%E9%97%AE-Solution/)\n\n### \u9898\u89e3\n\n\u9996\u5148\u62d0\u4e00\u9053\u5f2f\uff0c\u4ee4$F(L1,R1,L2,R2)=\\sum_{x=0}^{\\infty}{get(L1,R1,x)\\cdot get(L2,R2,x)}$\u3002\n\n\u90a3\u4e48\u6839\u636e\u5bb9\u65a5\u7684\u539f\u7406\uff0c\u53ef\u4ee5\u5f97\u5230$F(L1,R1,L2,R2)=F(1,R1,1,R2)-F(1,L1,1,R2)-F(1,R1,1,L2)+F(1,L1,1,L2)$\u3002\n\n\u90a3\u4e48\u5c31\u628a\u4e00\u4e2a\u8be2\u95ee\u5148\u62c6\u6210\u56db\u4e2a\u8be2\u95ee\u3002\n\n\u7136\u540e\u53ea\u8981\u60f3\u529e\u6cd5\u6c42\u51fa$F(1,x,1,y)$\u3002\n\n\u76f4\u63a5\u5957\u4e0a\u83ab\u961f\u7b97\u6cd5\u5373\u53ef\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<cmath>\n#include<cstdio>\n#include<algorithm>\nusing namespace std;\ntypedef long long LL;\nconst int maxn=50005;\nint n,q,A[maxn],S,Area[maxn],tot,cnt1[maxn],cnt2[maxn],p1,p2;LL ans[maxn],now;\ninline int read()\n{\n\tint ret=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-f;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){ret=ret*10+ch-'0';ch=getchar();}\n\treturn ret*f;\n}\nstruct Interval\n{\n\tint R1,R2,f,id;\n\tvoid Init(){if(R1>R2)swap(R1,R2);}\n\tbool operator < (const Interval& b)const{return Area[R1]<Area[b.R1]||(Area[R1]==Area[b.R1]&&((Area[R1]&1)?R2<b.R2:R2>b.R2));}\n}Q[maxn*4];\nint main()\n{\n\tn=read();S=sqrt(n)+1e-10;\n\tfor(int i=1;i<=n;i++) A[i]=read();\n\tfor(int i=1;i<=n;i++) Area[i]=(i-1)/S+1;\n\tq=read();\n\tfor(int i=1;i<=q;i++)\n\t{\n\t\tint L1=read(),R1=read(),L2=read(),R2=read();\n\t\ttot++;Q[tot].R1=R1;Q[tot].R2=R2;Q[tot].f=1;Q[tot].Init();Q[tot].id=i;\n\t\ttot++;Q[tot].R1=L1-1;Q[tot].R2=R2;Q[tot].f=-1;Q[tot].Init();Q[tot].id=i;\n\t\ttot++;Q[tot].R1=R1;Q[tot].R2=L2-1;Q[tot].f=-1;Q[tot].Init();Q[tot].id=i;\n\t\ttot++;Q[tot].R1=L1-1;Q[tot].R2=L2-1;Q[tot].f=1;Q[tot].Init();Q[tot].id=i;\n\t}\n\tsort(Q+1,Q+1+tot);\n\tfor(int i=1;i<=tot;i++)\n\t{\n\t\twhile(p2<Q[i].R2){p2++;cnt2[A[p2]]++;now+=cnt1[A[p2]];}\n\t\twhile(p1>Q[i].R1){cnt1[A[p1]]--;now-=cnt2[A[p1]];p1--;}\n\t\twhile(p2>Q[i].R2){cnt2[A[p2]]--;now-=cnt1[A[p2]];p2--;}\n\t\twhile(p1<Q[i].R1){p1++;cnt1[A[p1]]++;now+=cnt2[A[p1]];}\n\t\tans[Q[i].id]+=now*Q[i].f;\n\t}\n\tfor(int i=1;i<=q;i++)\n\t\tprintf(\"%lld\\n\",ans[i]);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1553949326,
        "uid": 42392,
        "name": "\u5f90\u81f4\u8fdc",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5268 \u3010[SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\u3011"
    },
    {
        "content": "\u5148\u6765\u63a8\u5f0f\u5b50\uff1a\n\n$\\begin{aligned} \\sum_{i=0}^{\\infty} get(l_1, r_1, x) \\times get(l_2, r_2, x) = &\\sum_{i=0}^{\\infty} get(0, r_1, x) \\times get(0, r_2, x)\\\\ - &\\sum_{i=0}^{\\infty} get(0, l_1-1, x) \\times get(0, r_2, x)\\\\ - &\\sum_{i=0}^{\\infty} get(0, r_1, x) \\times get(0, l_2-1, x) \\\\ + &\\sum_{i=0}^{\\infty} get(0, l_1-1, x) \\times get(0, l_2-1, x) \\end{aligned}$\n\n\u8fd9\u6837\u5b50\u5c31\u53ef\u4ee5\u628a\u6bcf\u4e2a\u8be2\u95ee\u62c6\u6210\u56db\u4e2a\uff0c\u7136\u540e\u83ab\u961f\u5373\u53ef\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u548c\u7ec6\u8282\u89c1[\u4ee3\u7801](http://m-sea-blog.com/archives/2414/)\u3002",
        "postTime": 1553844591,
        "uid": 38370,
        "name": "M_sea",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5268 \u3010[SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\u3011"
    },
    {
        "content": "\u9898\u89e3\uff1a\u56e0\u4e3a\u9898\u610f\u5f88\u5bb9\u6613\u61c2\uff0c\u6240\u4ee5\u76f4\u63a5\u8bf4\u9898\uff1b\n\n\u6211\u4eec\u53ef\u4ee5\u5c06\u5173\u7cfb\u5f0f\u53d8\u6362\u4e00\u4e0bget(l1,r1,x)*get(l2,r2,x)=get(0,r1,x)*get(0,r2,x)+get(0,l1-1,x)*get(0,l2-1,x)+get(l2-1,r2,x)*get(0,l1-1,x)-get(l1-1,r1,x)*get(0,l1-1,x);\u7136\u540e\u5229\u7528\u83ab\u961f\u7b97\u6cd5\u5373\u53ef\u3002\n\nAC\u4ee3\u7801\u4e3a\uff1a\n\n\n\n```\n// luogu-judger-enable-o2\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=5e4+10;\nconst int INF=0x3f3f3f3f;\n\n\nstruct node{\nint L;\nint R;\nint Id;\nint sign;\n} p[4*maxn];\n\n\nint a[maxn],block,pos[maxn];\nlong long cnt[maxn],cntc[maxn],num[maxn];\n\n\nbool cmp(const node &a,const node &b)\n{\nreturn pos[a.L]==pos[b.L]? a.R<b.R : pos[a.L]<pos[b.L];\n}\n\n\nint main()\n{\nint N,M,l1,l2,r1,r2;\n\nwhile(scanf(\"%d\",&N)!=EOF)\n{\nlong long flag=0;\n\nmemset(cnt,0,sizeof(cnt));\nmemset(cntc,0,sizeof(cntc));\n\nblock=sqrt(N);\n\nfor(int i=1;i<=N;i++)\n{\ncin>>a[i];\npos[i]=(i-1)/block+1;\n}\t\n\ncin>>M;\nfor(int i=1;i<=M;i++)\n{\ncin>>l1>>r1>>l2>>r2;\n\np[++flag]=node{r1,r2,i,1};\np[++flag]=node{r2,l1-1,i,-1};\np[++flag]=node{l2-1,r1,i,-1};\np[++flag]=node{l1-1,l2-1,i,1};\n}\n\nsort(p+1,p+flag+1,cmp);\n\nint l=0,r=0,ans=0;\n\nfor(int i=1;i<=flag;i++)\n{\nwhile(l<p[i].L)\n{\nl++;\nans+=cntc[a[l]];\ncnt[a[l]]++;\n}\nwhile(l>p[i].L)\n{\nans-=cntc[a[l]];\ncnt[a[l]]--;\nl--;\n}\nwhile(r<p[i].R)\n{\nr++;\nans+=cnt[a[r]];\ncntc[a[r]]++;\t\n} \nwhile(r>p[i].R)\n{\nans-=cnt[a[r]];\ncntc[a[r]]--;\nr--;\n}\n\nnum[p[i].Id]+=ans*p[i].sign;\n}\nfor(int i=1;i<=M;i++)\ncout<<num[i]<<endl;\n}\n\nreturn 0;\n}\n```\n",
        "postTime": 1553311185,
        "uid": 175262,
        "name": "zzhhtt",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5268 \u3010[SNOI2017]\u4e00\u4e2a\u7b80\u5355\u7684\u8be2\u95ee\u3011"
    }
]