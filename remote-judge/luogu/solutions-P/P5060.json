[
    {
        "content": "\u5206\u5c42\u56fe\u677f\u5b50\u9898\uff0c\u4e0d\u77e5\u9053\u5206\u5c42\u56fe\u7684\u53f3\u8f6c\u65e5\u62a5\u533a85\u671f\n\n\u628a\u4e00\u4e2a\u70b9\u62c6\u6210p\u4e2a\uff0c\u70b9(i,j)\u8868\u793a\u4ecea\u5230i\u8def\u5f84\u4e0a\u4fbf\u7b7e\u6d88\u8017\u91cf%p==j\uff0c\u5219(a,0)\u5230(i,j)\u8ddd\u79bb\u542b\u4e49\u4e3aa\u5230i\u8def\u5f84\u6d88\u8017\u4fbf\u7b7e\u91cf%p==j\u65f6\u6700\u5c11\u4fbf\u7b7e\u82b1\u8d39\u3002\u5bf9\u4e8e\u539f\u56fe(u,v,num)\uff0c\u8fde\u8fb9(u,k)->(v,(k+num)%p)\uff0c\u957f\u5ea6\u4e3anum\uff0ck\u4e3a\u679a\u4e3e\u7684u\u7684p\u4e2a\u70b9\u3002\u8fb9\u7684\u542b\u4e49\u4e3au->v\u65f6\uff0c\u6d88\u8017\u91cf%p\u53d1\u751f\u53d8\u5316\uff0c\u4ecek\u53d8\u6210(k+num)%p\uff0c\u82b1\u8d39\u4ee3\u4ef7\u4e3anum\u3002\n\n\u5efa\u56fe\u5b8c\u6210\u540e\uff0c\u8dd1\u4e00\u8fb9\u5806\u4f18\u5316dijkstra\u5373\u53ef\uff0c\u6700\u7ec8\u7b54\u6848\u4e3a(a,0)\u5230(b,0)\u7684\u6700\u77ed\u8def\u3002\u53ef\u4f7f\u7528pre\u6570\u7ec4\u8bb0\u5f55\u524d\u9a71\u8282\u70b9\u4ee5\u4fdd\u5b58\u6700\u77ed\u8def\u8def\u5f84\u4fe1\u606f\u3002\n\n\u672c\u9898\u5361priority_queue\uff0c\u4e3a\u4e86\u4fdd\u62a4dalao\u7684\u773c\u775b\uff0c\u6211\u53bb\u6389\u4e86\u6240\u6709\u7684\u5361\u5e38\u5934\u6587\u4ef6\u3002\u5b9e\u6d4b\u672c\u4ee3\u7801\u52a0O2\u540e12000ms+\uff0cOfast\u540e11000ms+\uff0c\u5927\u91cf\u5934\u6587\u4ef6\u540e6000ms-\n\n```\n#include <stdio.h>\n#include <string.h>\n#include <queue>\nusing namespace std;\ntypedef long long ll;\npriority_queue<pair<ll,int> > heap;\npair<ll,int> tq,cr;\nconst int N=2.5e6+2,M=1e7+2;\nll jl[N];\nint lj[M],nxt[M],fir[N],len[M],pre[N],st[N];\nint n,m,i,j,x,y,z,c,s,t,bs,p,tp;\nbool ed[N];\ninline void read(int &x)\n{\n    c=getchar();\n    while ((c<48)||(c>57)) c=getchar();\n    x=c^48;c=getchar();\n    while ((c>=48)&&(c<=57))\n    {\n        x=x*10+(c^48);\n        c=getchar();\n    }\n}\ninline void add(int x,int y,int z)\n{\n    lj[++bs]=y;\n    len[bs]=z;\n    nxt[bs]=fir[x];\n    fir[x]=bs;\n}\ninline int ys(int x,int y)\n{\n    return y*n+x;\n}\nint main()\n{\n    read(n);read(m);read(p);read(s);read(t);\n    while (m--)\n    {\n        read(x);read(y);read(z);\n        for (j=0;j<p;++j) add(ys(x,j),ys(y,(j+z)%p),z);\n    }\n    memset(jl,0x3f,sizeof(jl));\n    jl[s]=0;\n    cr.first=0;cr.second=s;\n    heap.push(cr);\n    while (1)\n    {\n        while ((!heap.empty())&&(ed[heap.top().second])) heap.pop();\n        if (heap.empty()) break;\n        tq=heap.top();\n        if (tq.second==t) break;\n        heap.pop();\n        ed[tq.second]=1;\n        for (i=fir[tq.second];i;i=nxt[i]) if (jl[lj[i]]>jl[tq.second]+len[i])\n        {\n            cr.first=-(jl[cr.second=lj[i]]=jl[tq.second]+len[i]);\n            pre[lj[i]]=tq.second;\n            heap.push(cr);\n        }\n    }\n    if (jl[t]==jl[0])\n    {\n        puts(\"jjc fails in travelling\");\n        return 0;\n    }\n    printf(\"%lld\\n\",jl[t]);\n    st[++tp]=t;\n    while (pre[t]) st[++tp]=t=pre[t];\n    while (tp>1) printf(\"%d->\",(st[tp--]-1)%n+1);\n    printf(\"%d\\n\",(st[tp]-1)%n+1);\n}\n```\n",
        "postTime": 1543722669,
        "uid": 29826,
        "name": "SSerxhs",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5060 \u3010\u65c5\u884c\u3011"
    },
    {
        "content": "[$$\\large{\\texttt{My Blog}}$$](https://yzxoi.xyz/archives/1187)\n## Describe\n> [\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P5060)\n\n\u7ed9\u5b9a\u4e00\u4e2a $N$ \u4e2a\u70b9\uff0c $M$ \u6761\u8fb9\u7684\u6709\u5411\u56fe\uff0c\u6c42\u4ece $A$ \u5230 $B$ \u7684\u8def\u5f84\u4e0a\u8fb9\u6743\u548c\u662f $P$ \u7684\u500d\u6570\u7684\u6700\u77ed\u8def\u5f84\u7684\u957f\u5ea6\u53ca\u8def\u5f84\u3002\n\n\u5bf9\u4e8e\u6240\u6709\u6570\u636e\uff0c$2\\leq N \\leq 5\\times {10}^{4},M\\leq 2 \\times {10}^5 , 1\\leq P \\leq 50$\u3002\n## Solution\n\u8bbe$dis[i][j]$\u8868\u793a\u4ece\u8d77\u70b9\u51fa\u53d1\u8d70\u5230$i$\u7684\u8def\u5f84\u8fb9\u6743\u548c$\\% P=j$\u7684\u6700\u5c0f\u503c\u3002\n\n\u90a3\u4e48\u8dd1\u4e00\u6b21$Dijikstra$\u5373\u53ef\u3002\n\n\u6ce8\u610f\u8f6c\u79fb$dis[to][v+w[i]]=dis[u][v]+w[i]$\u3002\n\n\u4fdd\u5b58\u8def\u5f84\u53ef\u4ee5\u8bb0\u5f55\u6839\u8282\u70b9\u6700\u540e\u9012\u5f52\u8f93\u51fa\u3002\n\n\u7531\u4e8e\u6b64\u9898\u51fa\u9898\u4eba~~\u4e0d\u662f\u7279\u522b\u53cb\u597d~~\uff0c\u6240\u4ee5\u6b64\u9898\u5361$spfa$\uff0c\u672c\u4eba\u4eb2\u6d4b$spfa$\u53ea\u6709$80pts$\u3002\n\n> \u5173\u4e8espfa\uff0c\u5979\u6b7b\u4e86\n\n## Code\n```cpp\n#include<bits/stdc++.h>\n#define int long long //\u6ce8\u610f\u6b64\u9898\u6570\u636e\u8303\u56f4\u8981\u5f00long long\nusing namespace std;\nchar buf[1<<23],*p1=buf,*p2=buf,obuf[1<<23],*O=obuf;\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)//fread\u5feb\u8bfb\ninline int read(){int res=0,f=1;char ch=getchar();while(ch<'0'||ch>'9'){if(ch=='-') f=-1;ch=getchar();}while(ch>='0'&&ch<='9') res=res*10+ch-'0',ch=getchar();return res*f;}\ninline void write(int x){if(x<0) putchar('-'),x=-x;if(x<10) putchar(x+'0');else write(x/10),putchar(x%10+'0');}\nint n,m,p,s,t,fir[50010],nxt[200010],son[200010],w[200010],tot,dis[50010][60],vis[50010][60],pre[50010][60][3],inf;\ninline void add(int x,int y,int z){++tot;nxt[tot]=fir[x];fir[x]=tot;son[tot]=y;w[tot]=z;}\nstruct node{int id,val,note;bool operator < (const node &x) const{return val>x.val;}};\ninline node make(int x,int y,int z){node pp;pp.id=x,pp.val=y,pp.note=z;return pp;}\npriority_queue<node> q;\ninline void dij(){\n\twhile(!q.empty()) q.pop();//\u6e05\u7a7a\u961f\u5217\u662f\u4e2a\u597d\u4e60\u60ef\n\tdis[s][0]=0;\n\tq.push(make(s,0,0));\n\twhile(!q.empty()){\n\t\tnode u=q.top();q.pop();\n\t\tif(vis[u.id][u.note]) continue ;\n\t\tvis[u.id][u.note]=1;\n\t\tfor(int to,i=fir[u.id];i;i=nxt[i]){\n\t\t\tto=son[i];\n\t\t\tif(!vis[to][(u.note+w[i])%p]&&dis[to][(u.note+w[i])%p]>dis[u.id][u.note]+w[i]){\n\t\t\t\tdis[to][(u.note+w[i])%p]=dis[u.id][u.note]+w[i];\n\t\t\t\tpre[to][(u.note+w[i])%p][0]=u.id;//\u8bb0\u5f55\u8def\u5f84\n\t\t\t\tpre[to][(u.note+w[i])%p][1]=u.note;\n\t\t\t\tq.push(make(to,dis[to][(u.note+w[i])%p],(u.note+w[i])%p));\n\t\t\t}\n\t\t}\n\t}\n}\ninline void print(int x,int note,int fir){//\u9012\u5f52\u8f93\u51fa\u8def\u5f84\n\tif(!x) return ;\n\tprint(pre[x][note][0],pre[x][note][1],1);\n\twrite(x);\n\tif(!fir) return ;//\u5224\u65ad\u4e0d\u8f93\u51fa\u7b2c\u4e00\u4e2a->\n\tputchar('-');putchar('>');\n}\nsigned main(){\n\tn=read(),m=read(),p=read(),s=read(),t=read();\n\tfor(int x,y,z,i=1;i<=m;i++) x=read(),y=read(),z=read(),add(x,y,z);//\u6709\u5411\u56fe\n\tmemset(dis,63,sizeof(dis));inf=dis[0][0];//\u6e05\u96f6\n\tdij();\n\tif(dis[t][0]==inf) puts(\"jjc fails in travelling\");\n\telse write(dis[t][0]),putchar('\\n'),print(t,0,0),putchar('\\n');\n}\n```",
        "postTime": 1584361778,
        "uid": 37103,
        "name": "yzxoi",
        "ccfLevel": 7,
        "title": "Luogu P5060 \u65c5\u884c \u9898\u89e3"
    },
    {
        "content": "\u53ef\u4ee5\u770b\u51fa\u9898\u610f\u662f\u6c42\u4e24\u70b9\u95f4\u6700\u77ed\u7684\u8def\u5f84\u4e14\u662f $P$ \u7684\u500d\u6570\uff0c\u5e94\u8be5\u6709\u4e00\u70b9\u96be\u5ea6\u3002\n\n\u770b\u5230\u6570\u636e\u8303\u56f4\u53ef\u4ee5\u53d1\u73b0\u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\u5b50\u4efb\u52a1\u76f4\u63a5\u8dd1\u6700\u77ed\u8def\u5c31\u53ef\u4ee5\u4e86\n\n\u5bf9\u4e8e\u6574\u9053\u9898\u80fd\u4e0d\u80fd\u7528\u6700\u77ed\u8def\u7b97\u6cd5\u901a\u8fc7\u5462\uff1f\n\n\u7b54\u6848\u662f\u80af\u5b9a\u7684\uff0c\u5bf9\u6700\u77ed\u8def\u7b97\u6cd5\u672c\u8eab\u8fdb\u884c\u4e00\u5b9a\u8c03\u6574\u5373\u53ef\u89e3\u51b3\u672c\u9898\n\n\u6ca1\u6709\u8d1f\u6743\uff0c\u56e0\u6b64\u6211\u4eec\u4f7f\u7528\u5806\u4f18\u5316 $dijkstra$ \u7b97\u6cd5\uff0c\u51fa\u9898\u4eba#$10$\u5361\u4e86 $spfa$ ~~(\u4e0d\u77e5\u9053\u6210\u529f\u6ca1\u6709)~~\n\n\u4f7f\u6bcf\u4e00\u4e2a\u70b9\u5177\u6709 $P$ \u4e2a\u610f\u4e49\uff0c$dis[u][k]$\u8868\u793a\u5230\u8fbe $u$ \u70b9\u6700\u77ed\u7684\u8def\u5f84\u6ee1\u8db3\u6a21 $P$ \u7684\u4f59\u6570\u4e3a $k$ \uff0c\u5219\u6700\u7ec8\u7b54\u6848\u5728 $dis[B][0]$ \uff0c\u800c\u5728\u5c06\u70b9\u538b\u5806\u65f6\u4e5f\u8981\u8bb2\u6bcf\u4e00\u4e2a\u610f\u4e49\u72ec\u7acb\u5f00\u6765\uff0c\u677e\u5f1b\u65f6\u4e5f\u8981\u6ce8\u610f\u677e\u5f1b\u5bf9\u8c61\u53ea\u662f\u4e00\u4e2a\u70b9\u7684\u4e00\u4e2a\u610f\u4e49\u800c\u975e\u6574\u4e2a\u70b9\uff0c\u60f3\u5230\u8fd9\u91cc\uff0c\u57fa\u672c\u4e0a\u5c31\u6ca1\u4ec0\u4e48\u95ee\u9898\u4e86\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(N*P*log_2N)$\n\n\u63a5\u4e0b\u6765\u53ea\u9700\u8981\u8bb0\u5f55\u8def\u5f84\uff0c\u6211\u91c7\u7528\u7684\u662f\u8bb0\u5f55\u524d\u7ee7\u7684\u65b9\u6cd5\uff0c\u6ce8\u610f $dis$ \u6570\u7ec4\u7684\u521d\u503c\n\n\u6e29\u99a8\u63d0\u793a\uff1a\u6700\u597d\u4f7f\u7528\u5feb\u8bfb\uff0c\u6700\u597d\u4e0d\u8981\u4f7f\u7528\u4f18\u5148\u961f\u5217\u4ee3\u66ff\u624b\u5199\u5806\u3002\n\n$Code:$\n\n```\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<cctype>\nusing namespace std;\n\nstruct edge\n{\n    int to,next;\n    long long w;\n}a[400010];\n\nint head[50010],num,n,m,p,A,B,tempu,tempv,tot,pre[50010][50];\nlong long tempw,dis[50010][50],disp[50010][50];//disp \u5373dis_pre \nbool exist[50][50010]; \npair<long long,int> heap[50010*50];\n\ninline void add(int,int,long long);\ninline int read();\ninline void dijkstra();\nvoid print(int,int);\n\nint main()\n{\n    n=read(),m=read(),p=read(),A=read(),B=read();\n    for(register int i=1;i<=m;i++)\n    {\n        tempu=read(),tempv=read(),tempw=read();\n        add(tempu,tempv,tempw);\n    }\n    dijkstra();\n    if(dis[B][0]==dis[0][0])\n    {\n        printf(\"jjc fails in travelling\");\n        return 0;\n    }\n    printf(\"%lld\\n\",dis[B][0]);\n    print(B,0);\n    printf(\"%d\",B);\n    return 0;\n}\n\ninline void add(int u,int v,long long w)\n{\n    a[++num].to=v;\n    a[num].w=w;\n    a[num].next=head[u];\n    head[u]=num;\n}\ninline int read()\n{\n   register int s=0;\n   register char c=getchar();\n   while(c<'0'||c>'9')\n   c=getchar();\n   while(c>='0'&&c<='9') \n   s=s*10+c-'0',c=getchar();\n   return s;\n}\ninline void Pop()\n{\n    heap[1]=heap[tot--];\n    register int p=1,s;\n    while(p*2<=tot)\n    {\n        s=p*2;\n        if(s<tot&&heap[s+1]<heap[s])\n            s++;\n        if(heap[s]<heap[p])\n            swap(heap[s],heap[p]),p=s;\n        else\n            break;\n    }\n}\ninline void Push(pair<long long,int> d)\n{\n    heap[++tot]=d;\t\n    register int p=tot;\n    while(p>1)\n    {\n        if(heap[p/2]>heap[p])\n            swap(heap[p/2],heap[p]),p/=2;\n        else \n            break;\n    }\n}\ninline void dijkstra()\n{\n    int k;\n    long long fd,td;\n    memset(dis,127,sizeof(dis));\n        dis[A][0]=0;\n    heap[++tot]=make_pair(0ll,A);\n    while(tot)\n    {\n    \tfd=heap[1].first,k=heap[1].second;\n        Pop();\n        if(fd%p==0&&k==B)\n            return;\n        exist[fd%p][k]=true;\n        for(register int i=head[k];i;i=a[i].next)\n        {\n            td=dis[k][fd%p]+a[i].w;\n            if(td<dis[a[i].to][td%p])\n            {\n                pre[a[i].to][td%p]=k;\n                disp[a[i].to][td%p]=fd%p;\n                dis[a[i].to][td%p]=td;\n                if(!exist[td%p][a[i].to])\n                \tPush(make_pair(td,a[i].to));\n            }\n        } \n    }\n}\nvoid print(int x,int y)\n{\n    if(!pre[x][y])\n    \treturn;\n    print(pre[x][y],disp[x][y]);\n    printf(\"%d->\",pre[x][y]);\n}\n```\n\n",
        "postTime": 1543676417,
        "uid": 68975,
        "name": "\u5b66\u65e0\u6b62\u5883",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5060 \u3010\u65c5\u884c\u3011"
    },
    {
        "content": "### \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a $n$ \u4e2a\u70b9 $m$ \u6761\u8fb9\u7684\u6709\u5411\u56fe\uff0c\u6c42\u4ece $A$ \u5230 $B$ \u6ee1\u8db3\u8def\u5f84\u8fb9\u6743\u548c\u4e3a $P$ \u7684\u500d\u6570\u7684\u6700\u77ed\u8def\u5f84\u5373\u65b9\u6848\u3002\n\n### \u5206\u6790\n\n\u666e\u901a\u6700\u77ed\u8def\u8c8c\u4f3c\u4e0d\u592a\u597d\u505a\uff0c\u8003\u8651\u5206\u5c42\u56fe\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u70b9 $u$\uff0c\u6211\u4eec\u53ef\u4ee5\u62c6\u6210 $p$ \u4e2a\u70b9\uff0c\u5176\u4e2d\u7684\u7b2c $i$ \u4e2a\u70b9 $u_i$ \u8868\u793a\u4ece\u8d77\u70b9\u5230\u70b9 $u$ \u7684\u6700\u77ed\u8def\u5f84\u548c $\\bmod \\,p$ \u7684\u7ed3\u679c\u4e3a $i$\u3002 \n\n\u5bf9\u4e8e\u539f\u56fe\u4e2d\u7684\u8fb9 $(u,v,w)$\uff0c\u8fde\u8fb9 $(u_i,v_{(i+w) \\bmod p}) (0 \\le i < p)$\uff0c\u8868\u793a\u4ece\u70b9 $u$ \u5230\u70b9 $v$ \u65f6\uff0c\u9700\u8981 $w$ \u7684\u4ee3\u4ef7\u4f7f\u7684\u5f53\u524d\u8def\u5f84\u548c $\\bmod \\,p$ \u7684\u7ed3\u679c\u53d8\u4e3a $(i+w)\\bmod p$\u3002\n\n\u5efa\u5b8c\u56fe\u540e\u4e4b\u540e\u76f4\u63a5\u8dd1\u6700\u77ed\u8def\u5373\u53ef\uff0c\u7b54\u6848\u4e3a $A_0$ \u5230 $B_0$ \u7684\u6700\u77ed\u8def\uff0c\u8f93\u51fa\u8def\u5f84\u53ef\u4ee5\u8bb0\u5f55\u524d\u9a71\u3002\n\n\u5410\u69fd\u4e00\u4e0b\uff0c\u4e3a\u4ec0\u4e48\u540c\u6837\u662f STL \u7684\u5806\uff0c\u5927\u5bb6\u90fd\u7528 `prioirty_queue` \u800c\u4e0d\u662f `push_heap` \u548c `pop_heap` \u554a\uff0c\u4e24\u8005\u5728\u5438\u6c27\u7684\u60c5\u51b5\u4e0b\u6548\u7387\u5dee\u4e0d\u591a\uff0c\u4f46\u4e0d\u5438\u6c27\u540e\u8005\u6bd4\u524d\u8005\u4e0d\u77e5\u9053\u5feb\u5230\u54ea\u91cc\u53bb\u4e86\u3002\u8fd9\u9053\u9898\u4e0d\u5438\u6c27\u7684\u60c5\u51b5\u51e0\u4e4e\u4e0d\u5361\u5e38\u4e5f\u80fd\u8f7b\u677e\u8fc7\u53bb\uff0c\u6548\u7387\u5e76\u4e0d\u6bd4\u624b\u5199\u5806\u4f4e\u3002\n\ncode:\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define LL long long\nconst int MAXN = 5e6+5;\nconst int MAXM = 2e7+5;\nstruct edge{\n\tint to,nxt;LL dis;\n} e[MAXM];\nint head[MAXN],cnt;\ninline int read()\n{\n\tint x=0; char c=getchar();\n\tfor(;!isdigit(c);c=getchar());\n\tfor(;isdigit(c);c=getchar()) x=(x<<1)+(x<<3)+c-48;\n\treturn x; \n}\ninline void add(int u,int v,LL w)\n{\n\te[++cnt].to=v;\n\te[cnt].nxt=head[u];\n\te[cnt].dis=w;\n\thead[u]=cnt; \n}\nstruct node{\n\tint pos;LL dis;\n\tbool operator<(node& rhs){return rhs.dis<dis;}\n} q[MAXM];\nLL dis[MAXN];\nint vis[MAXN],pre[MAXN],top,n,m,p,s,t;\nvoid Dijkstra(int s)\n{\n\tmemset(dis,0x7f,sizeof(dis));\n\tdis[s]=0; q[++top]={s,0}; push_heap(q+1,q+top+1);\n\twhile(top)\n\t{\n\t\tint u=q[1].pos; pop_heap(q+1,q+top+1); top--;\n\t\tif(vis[u]) continue;\n\t\tvis[u]=1;\n\t\tfor(int i=head[u];i;i=e[i].nxt)\n\t\t{\n\t\t\tint v=e[i].to;\n\t\t\tif(dis[v]>dis[u]+e[i].dis)\n\t\t\t{\n\t\t\t\tdis[v]=dis[u]+e[i].dis;\n\t\t\t\tq[++top]={v,dis[v]},pre[v]=u,push_heap(q+1,q+top+1);\n\t\t\t}\n\t\t}\n\t}\n}\nint ans[MAXN],tot;\nvoid getans(int t)\n{\n\tif(!t) return;\n\tans[++tot]=(t-1)%n+1;\n\tgetans(pre[t]);\n}\nsigned main()\n{\n\tn=read(); m=read(); p=read(); s=read(); t=read();\n\tfor(int i=1,u,v,w;i<=m;i++)\n\t{\n\t\tu=read(),v=read(),w=read();\n\t\tfor(int j=0;j<p;j++) add(j*n+u,(j+w)%p*n+v,1ll*w);\n\t}\n\tDijkstra(s);\n\tif(dis[t]==9187201950435737471) puts(\"jjc fails in travelling\");\n\telse\n\t{\n\t\tprintf(\"%lld\\n\",dis[t]);\n\t\tgetans(t);\n\t\tfor(int i=tot;i>1;i--) printf(\"%d->\",ans[i]);\n\t\tprintf(\"%d\\n\",ans[1]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1660206238,
        "uid": 280473,
        "name": "404Not_Found",
        "ccfLevel": 5,
        "title": "P5060 \u9898\u89e3"
    },
    {
        "content": "[\u9898\u76ee](https://www.luogu.org/problem/P5060)\n\n\u8fd9\u9898\u662f\u4e00\u9053\u5206\u5c42\u56fe\u677f\u5b50\u9898\uff0c\u8fd9\u91cc\u7ed9\u51fa\u5206\u5c42\u56fe\u7684\u4e24\u79cd\u505a\u6cd5\u3002\n\n\u5728\u6b64\u4e4b\u524d\uff0c\u5148\u63d0\u4e00\u4e0b\u3002\u8fd9\u9898\u597d\u50cf\u5361$STL$\u91cc\u7684\u5806???\u7136\u540e\u6211\u5f00\u4e86$O_2$ ~~(\u4e0d\u4f1a\u624b\u5199\u5806)~~ \u3002\u8fd8\u6709\u5c31\u662f\u8bb0\u5f55\u8def\u5f84\u3002\u53ef\u4ee5\u5728\u8dd1\u6700\u77ed\u8def\u65f6\u8bb0\u5f55\u662f\u54ea\u4e00\u4e2a\u70b9\u5230\u8fbe\u4e86\u8fd9\u4e2a\u70b9\uff0c\u7136\u540e\u5728\u53cd\u8fc7\u6765\u627e\u4e00\u904d\u5c31\u597d\u4e86\u3002(\u5177\u4f53\u89c1\u4ee3\u7801\u4e2d\u7684$fa$\u6570\u7ec4)\n\n\u7b2c\u4e00\u79cd\uff1a\n\n\u53ef\u4ee5\u901a\u8fc7\u5efa\u8fb9\uff0c\u5c06\u539f\u6765\u7684$x$\u5230$y$\u8def\u4e0a\u78b0\u5230$z$\u4e2a\u5de8\u4f6c\uff0c\u5373$(x,y,z)$,\u53d8\u4e3a$(i\\%p*n+x,(i+z)\\%p*n+y,z) \\ \\ ,i=1\\sim p$ \u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ef\u4ee5\u4ece**\u78b0\u89c1\u5de8\u4f6c\u6570\u4e3a$i\\%p$\u8fd9\u5c42**\u901a\u5411**\u78b0\u89c1\u5de8\u4f6c\u6570\u4e3a$(i+z)\\%p$\u8fd9\u5c42**\u3002\u7136\u540e\u6211\u4eec\u5728\u5efa\u8d77\u7684\u5206\u5c42\u56fe\u4e0a\u8dd1\u4e00\u904d\u6700\u77ed\u8def\u5373\u53ef\u3002\n\n**\u6ce8\u610f\u7a7a\u95f4**\n\n\u8d34\u4ee3\u7801\n```cpp\n// luogu-judger-enable-o2\n#include <bits/stdc++.h>\nusing namespace std;\nint n,m,p,tot,aa,bb,ll;\nint head[5010000],ans[5001000],fa[5000010];\nlong long val[5000100];\nbool vis[5000100];\nstruct node{\n\tint to,nex;\n\tlong long val;\n};\nnode edge[10001000];\nstruct data{ \n\tint id;\n\tlong long val;  //id\u8bb0\u5f55\u4f4d\u7f6e\uff0cval\u8bb0\u5f55\u5de8\u4f6c\u6570 \n\tdata () {}\n\tdata (int id1,long long val1) : id(id1) , val(val1) {}\n\tbool operator < (const data &qw) const{\n\t\treturn val>qw.val;\n\t}\n};\npriority_queue <data> q;\nvoid add(int x,int y,long long z){ //\u5efa\u8fb9 \n\tedge[++tot].nex=head[x];\n\tedge[tot].to=y;\n\tedge[tot].val=z;\n\thead[x]=tot;\n}\nvoid dij(){   //\u8dd1\u6700\u77ed\u8def \n\tval[aa]=0;\n\tq.push(data(aa,0));\n\twhile(!q.empty()){\n\t\tdata kk;\n\t\tkk=q.top();\n\t\tq.pop();\n\t\tif(kk.id==bb) return ;\n\t\tif(vis[kk.id]) continue ;\n\t\tvis[kk.id]=1;\n\t\tfor(int i=head[kk.id];i;i=edge[i].nex){\n\t\t\tint y;\n\t\t\ty=edge[i].to;\n\t\t\tif(!vis[y] && val[y]>val[kk.id]+edge[i].val){\n\t\t\t\tfa[y]=kk.id;    //\u8bb0\u5f55\u8c01\u8dd1\u5230\u4e86\u8fd9\u4e2a\u70b9 \n\t\t\t\tval[y]=val[kk.id]+edge[i].val;\n\t\t\t\tq.push(data(y,val[y]));\n\t\t\t}\n\t\t}\n\t}\n}\nvoid print(int rt){   //\u901a\u8fc7fa\u6570\u7ec4\u5f80\u56de\u627e\u8def\u5f84 \n\tif(rt==0) return ;\n\tif(rt%n!=0) ans[++ll]=rt%n;\n\telse ans[++ll]=n;\n\tprint(fa[rt]);\n}\nint main(){\n\tscanf(\"%d %d %d %d %d\",&n,&m,&p,&aa,&bb);\n\ttot=1;\n\tint b,c;\n\tlong long d;\n\tfor(int i=1;i<=m;i++){\n\t\tscanf(\"%d %d %lld\",&b,&c,&d);\n\t\tfor(int j=0;j<=p;j++){\n\t\t\tadd(j*n+b,(j+d)%p*n+c,d); //\u5efa\u56fe \n\t\t}\n\t}\n\tmemset(val,0x7f7f7f7f,sizeof(val));\n\tdij();  \n\tif(val[bb]!=9187201950435737471){\n\t\tprintf(\"%lld\\n\",val[bb]);\n\t\tprint(bb);\n\t\tfor(int i=ll;i>1;i--)\n\t\t\tprintf(\"%d->\",ans[i]); //\u8f93\u51fa \n\t\tprintf(\"%d\\n\",ans[1]);\n\t}\n\telse printf(\"jjc fails in travelling\\n\");\n\treturn 0;\n}\n```\n------------\n\n\u7b2c\u4e8c\u79cd\n\n\u53ef\u4ee5\u4e0d\u7528\u5efa\u51fa\u5206\u5c42\u56fe\u3002\u53ef\u4ee5\u5f00\u4e8c\u7ef4\u6570\u7ec4$val[i][j]$\uff0c\u7b2c\u4e00\u7ef4$i$\u8bb0\u5f55\u5f53\u524d\u7684\u4f4d\u7f6e\uff0c\u7b2c\u4e8c\u7ef4$j$\u8bb0\u5f55\u5230\u8fbe\u8fd9\u4e2a\u4f4d\u7f6e\u65f6**\u78b0\u5230\u5de8\u4f6c\u6570$\\%p$** \u3002\u4e5f\u5c31\u662f\u8bf4$val[i][j]$\u8868\u793a\u5728$i$\u4f4d\u7f6e\u65f6**\u591a\u51fa\u6765\u7684\u4fbf\u7b7e\u6570\u4e3a$j$** \u65f6\u78b0\u5230\u7684\u5de8\u4f6c\u6570\u3002\n\n\u7136\u540e\u53ef\u4ee5\u8dd1\u4e00\u904d\u6700\u77ed\u8def\uff0c\u5904\u7406\u51fa$val$\u6570\u7ec4\u5373\u53ef\u3002\n\n\u8d34\u4ee3\u7801\n```cpp\n// luogu-judger-enable-o2\n#include <bits/stdc++.h>\nusing namespace std;\nlong long n,m,p,aa,bb,tot,ll;\nlong long head[1000010];\nstruct node{\n\tlong long to,nex,val;\n};\nnode edge[1001000];\nlong long val[100010][55],ans[5000010];\nstruct node2{\n\tlong long id,num;\n};\nnode2 fa[100010][55];\nbool vis[100010][55];\nstruct data{\n\tlong long id,val,num;  //id\u8bb0\u5f55\u4f4d\u7f6e\uff0cval\u8bb0\u5f55\u5de8\u4f6c\u6570\uff0cnum\u8bb0\u5f55\u591a\u51fa\u7684\u4fbf\u7b7e\u6570 \n\tdata () {}\n\tdata (long long id1,long long val1,long long num1) : id(id1) , val(val1) , num(num1) {} \n\tbool operator < (const data &qw) const{\n\t\treturn val>qw.val;\n\t}\t\n};\npriority_queue <data> q; \nvoid add(long long x,long long y,long long z){ //\u5efa\u8fb9 \n\tedge[++tot].to=y;\n\tedge[tot].nex=head[x];\n\tedge[tot].val=z;\n\thead[x]=tot;\n}\nvoid dij(){\n\tval[aa][0]=0;\n\tq.push(data(aa,0,0));\n\twhile(!q.empty()){\n\t\tdata kk;\n\t\tkk=q.top();\n\t\tq.pop();\n\t\tif(vis[kk.id][kk.num]) continue ;\n\t\tvis[kk.id][kk.num]=1;\n\t\tfor(long long i=head[kk.id];i;i=edge[i].nex){\n\t\t\tlong long y;\n\t\t\ty=edge[i].to;\n\t\t\tif(!vis[y][(kk.num+edge[i].val)%p] && val[y][(kk.num+edge[i].val)%p]>val[kk.id][kk.num]+edge[i].val){ \n\t\t\t\tfa[y][(kk.num+edge[i].val)%p].id=kk.id;  \n\t\t\t\tfa[y][(kk.num+edge[i].val)%p].num=kk.num; //fa\u6570\u7ec4\u8bb0\u5f55\u54ea\u4e2a\u70b9\u5230\u4e86\u8fd9\u4e2a\u70b9 \n\t\t\t\tval[y][(kk.num+edge[i].val)%p]=val[kk.id][kk.num]+edge[i].val; //\u66f4\u65b0val \n\t\t\t\tq.push(data(y,val[y][(kk.num+edge[i].val)%p],(kk.num+edge[i].val)%p));\n\t\t\t}\n\t\t}\n\t}\n}\nvoid dfs(long long idd,long long numm){ //\u901a\u8fc7fa\u6570\u7ec4\u627e\u5230\u8def\u5f84 \n\tif(idd==0) return ;\n\tans[++ll]=idd;\n\tdfs(fa[idd][numm].id,fa[idd][numm].num);\n}\nint main(){\n\tscanf(\"%lld %lld %lld %lld %lld\",&n,&m,&p,&aa,&bb);\n\ttot=1;\n\tfor(long long i=1;i<=m;i++){\n\t\tlong long b,c,d;\n\t\tscanf(\"%lld %lld %lld\",&b,&c,&d);\n\t\tadd(b,c,d);   //\u5efa\u56fe \n\t}\n\tmemset(val,0x7f7f7f7f,sizeof(val));\n\tdij();\n\tif(val[bb][0]!=9187201950435737471){\n\t\tprintf(\"%lld\\n\",val[bb][0]);\n\t\tdfs(bb,0);\n\t\tfor(long long i=ll;i>1;i--)\n\t\t\tprintf(\"%lld->\",ans[i]);\n\t\tprintf(\"%lld\\n\",ans[1]);\n\t}\n\telse printf(\"jjc fails in travelling\\n\");\n\treturn 0;\n}\n```\n",
        "postTime": 1566719834,
        "uid": 55843,
        "name": "ueettttuj",
        "ccfLevel": 0,
        "title": "P5060 \u65c5\u884c"
    },
    {
        "content": "~~\u542c\u8bf4\u51fa\u9898\u4eba\u5361\u4e86SPFA\uff1f\u542c\u8bf4SPFA\u968f\u673a\u6570\u636e\u8dd1\u7684\u6bd4Dijkstra\u5feb\uff1f~~\n\n\u5206\u5c42\u56fe\u6700\u77ed\u8def\u3002\n\n\u7531\u4e8e\u6709\u4f59\u6570\u7684\u9650\u5236\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6bcf\u4e2a\u70b9\u62c6\u6210$P$\u4e2a\u70b9\uff0c\u5206\u522b\u8868\u793a\u4ece$S$\u5230\u8fd9\u4e2a\u70b9\u6a21$P$\u4f59$0,1,2,\\dots,P-1$\u65f6\u7684\u6700\u77ed\u8def\u3002\n\n\u7136\u540e\u5728\u65b0\u56fe\u4e0a\u8dd1Dijkstra\u5373\u53ef\u3002\n\n\u5efa\u56fe\u7684\u65f6\u5019\u53ef\u4ee5\u53ea\u5efa\u539f\u56fe\uff0c\u8fd9\u6837\u7528\u7684\u8fb9\u5c11\u3002\n\n\u7136\u540e\u8dd1Dijkstra\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(nP\\log n)$\u3002\n\n~~\u542c\u8bf4pbds\u8fc7\u4e0d\u53bbQAQ~~\n\n\u624b\u5199\u4e2a\u5806\u5c31\u597d\u4e86\uff0c\u53cd\u6b63\u53c8\u4e0d\u96be~~\u5199\u4e86\u4e2a\u7ebf\u6bb5\u6811\u4f18\u5316T\u98de\uff0c\u662f\u4e0d\u662f\u59ff\u52bf\u4e0d\u5bf9\u554aQAQ~~\u3002\n\n## Code\uff1a\n```cpp\n// luogu-judger-enable-o2\n#include<cstdio>\n#include<cstring>\n#include<cctype>\n#include<algorithm>\n#include<unistd.h>\n#include<sys/mman.h>\n#define N 65537\nconst int U=(1<<16)-1;\ntypedef long long LL;\nclass istream{\n\tchar*in;\n\tpublic:\n\t\tinline istream(){in=static_cast<char*>(mmap(0,1<<24,PROT_READ,MAP_PRIVATE,STDIN_FILENO,0));}\n\t\tinline istream&operator>>(int&RHS){\n\t\t\tfor(RHS=0;!isdigit(*in);++in);\n\t\t\twhile(isdigit(*in))RHS=10*RHS+(*in++&15);\n\t\t\tin+=(*in=='\\n');\n\t\t\treturn*this;\n\t\t}\n}cin;\nstruct ostream{\n\tchar buf[10000005],*s;\n\tinline ostream(){s=buf;}\n\ttemplate<typename T>\n\tinline ostream&operator<<(T d){\n\t\tif(!d){\n\t\t\t*s++='0';\n\t\t}else{\n\t\t\tstatic T w;\n\t\t\tfor(w=1;w<=d;w*=10);\n\t\t\tfor(;w/=10;d%=w)*s++=d/w^'0';\n\t\t}\n\t\treturn*this;\n\t}\n\tinline ostream&operator<<(const char&c){*s++=c;return*this;}\n\tinline void flush(){\n\t\tfwrite(buf,1,s-buf,stdout);\n\t\ts=buf;\n\t}\n\tinline~ostream(){flush();}\n}cout;\nint n,m,p,S,T,head[N],cnt=0,nxt[N<<2],to[N<<2],dis[N<<2],out[N*200];\nLL dd[N*51];\nint pre[N*51];\nstruct hpn{\n\tint u;LL d;\n}h[N*51];\nint sz=0;\ninline void insert(const hpn&b){\n\th[++sz]=b;\n\tfor(int i=sz;i!=1;i>>=1)\n\tif(h[i].d<h[i>>1].d)std::swap(h[i],h[i>>1]);else break;\n}\ninline hpn top_pop(){\n\tconst hpn ret=h[1];\n\th[1]=h[sz--];\n\tfor(int i=1;i<<1<=sz;){\n\t\tconst int nxt=(h[i<<1].d<h[i<<1|1].d||i<<1==sz)?(i<<1):(i<<1|1);\n\t\tif(h[nxt].d<h[i].d)std::swap(h[i],h[nxt]),i=nxt;else break;\n\t}\n\treturn ret;\n}\nvoid spfa(){\n\tmemset(dd,0x3f,sizeof dd);\n\tdd[S]=0;\n\tinsert((hpn){S,0});\n\twhile(sz){\n\t\thpn u=top_pop();\n\t\tif(dd[u.u]!=u.d)continue;\n\t\tfor(int i=head[u.u&U];i;i=nxt[i]){\n\t\t\tconst int v=to[i]+(((u.u>>16)+dis[i])%p<<16);\n\t\t\tif(dd[v]>u.d+dis[i]){\n\t\t\t\tdd[v]=u.d+dis[i];\n\t\t\t\tpre[v]=u.u;\n\t\t\t\tinsert((hpn){v,dd[v]});\n\t\t\t}\n\t\t}\n\t}\n}\nvoid work(){\n\tint tot=0;\n\tfor(int i=T;i!=S;i=pre[i])out[++tot]=(i&U)+1;\n\tfor(int i=tot;i;--i)cout<<'-'<<'>'<<out[i];\n}\nint main(){\n\tcin>>n>>m>>p>>S>>T;--S,--T;\n\tfor(int u,v,t;m--;){\n\t\tcin>>u>>v>>t;\n\t\tto[++cnt]=v-1,nxt[cnt]=head[--u],head[u]=cnt,dis[cnt]=t;\n\t}\n\tspfa();\n\tLL ans=dd[T];\n\tif(ans>1e18)puts(\"jjc fails in travelling\");else cout<<ans<<'\\n'<<S+1,work();\n\treturn 0;\n}\n```",
        "postTime": 1544086318,
        "uid": 6813,
        "name": "mrsrz",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5060 \u3010\u65c5\u884c\u3011"
    }
]