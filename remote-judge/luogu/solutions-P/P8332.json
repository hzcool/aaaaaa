[
    {
        "content": "ZJOI2022 Day2 \u7684\u9898\u90fd\u662f\u975e\u4eba\u529b\u53ef\u53ca\u725b\u903c\u9898\u76ee\u5417\uff1f\u597d\u5413\u4eba\u554a\uff01\uff01\uff01\n\n\u5148\u968f\u4fbf\u8bb2\u70b9\u66b4\u529b\uff0c\u56e0\u4e3a\u8fd9\u663e\u7136\u662f\u7ebf\u6027\u53d8\u6362\uff0c\u52a0\u4e0a\u4e00\u4e9b\u804a\u80dc\u4e8e\u65e0\u7684\u7279\u5224\u5c31\u53ef\u4ee5\u62ff 50\u3002\n\n\u6ce8\u610f\u5230\u6709\u4e2a\u5947\u602a\u7684\u7279\u6b8a\u9650\u5236\uff0c\u4e00\u4e2a\u662f $n=2^k$\uff0c\u4e00\u4e2a\u662f $n=98304 = 2^{15} \\cdot 3$\u3002\u6211\u4eec\u5bf9\u8fd9\u4fe9\u4e1c\u897f\u7814\u7a76\u4e00\u4e0b\u3002\n\n\u9996\u5148\u662f $n=2^k$\u3002\u62c9\u4e00\u6b21\u62c9\u9762\uff0c\u4f1a\u53d1\u73b0 $a_1=a_2,a_3=a_4 ,\\cdots ,a_{n-1}=a_n$\uff1b\u518d\u62c9\u4e00\u6b21\uff0c\u4f1a\u53d1\u73b0 $a_1=a_2=a_3=a_4 ,\\cdots ,a_{n-3}=a_{n-2}=a_{n-1}=a_n$\u2026\u2026\u6700\u7ec8\u6240\u6709\u6570\u4f1a\u53d8\u6210\u4e00\u6837\u7684\uff0c\u5e76\u4e0d\u518d\u6539\u53d8\u3002\n\n\u518d\u8003\u8651 $n=2^{15} \\cdot 3$\u3002\u7c7b\u4f3c\u7684\uff0c\u5728\u7b2c\u5341\u4e94\u6b21\u64cd\u4f5c\u65f6\uff0c\u4f1a\u5206\u6210\u4e09\u4e2a\u6781\u957f\u6bb5\uff0c\u6bcf\u6bb5\u5185\u6570\u76f8\u540c\uff0c\u957f\u5ea6\u5747\u4e3a $2^{15}$\u3002\u518d\u64cd\u4f5c\u4e00\u6b21\u5c31\u53d8\u6210\u4e86\u524d\u9762\u4e00\u4e2a $2^{16}$ \u7684\u6781\u957f\u6bb5\u540e\u9762\u4e00\u4e2a $2^{15}$ \u7684\u6781\u957f\u6bb5\u3002\u7ee7\u7eed\u64cd\u4f5c\uff0c\u6743\u503c\u4ecd\u7136\u4f1a\u6539\u53d8\uff0c\u4f46\u662f\u8fd9\u6837\u7684\u6781\u957f\u6bb5\u7684\u6837\u5f0f\u4e0d\u4f1a\u6539\u53d8\u3002\n\n\u7ecf\u8fc7\u591a\u6b21\u624b\u73a9\uff0c\u8bb0\u6700\u5927\u7684 $x$ \u6ee1\u8db3 $n \\equiv 0 \\pmod{2^x}$ \u4e3a $t$\uff0c\u5728 $t+1$ \u6b21\u64cd\u4f5c\u540e\u4f1a\u5f62\u6210\u5982\u4e0b\u7684\u5f62\u72b6\uff1a\n\n$$\na_1^{2^{t+1}}a_2^{2^{t+1}}a_3^{2^{t+1}} \\cdots a_{m-1}^{2^{t+1}} a_m^{2^t} \n$$\n\n\u6700\u540e\u4e00\u6bb5\u957f\u5ea6\u53ea\u6709\u524d\u9762\u7684\u4e00\u534a\u3002\u6ce8\u610f\u5230\u5f62\u6210\u8fd9\u4e2a\u5f62\u72b6\u7684\u6700\u5927\u64cd\u4f5c\u6b21\u6570\u662f $O(\\log n)$ \u7ea7\u522b\u7684\uff0c\u6211\u4eec\u5148\u9884\u5904\u7406\u6389\u524d $O(\\log n)$ \u6b21\u64cd\u4f5c\uff0c\u7136\u540e\u8003\u8651\u628a\u73b0\u5728\u7684\u8fd9\u4e2a $a$ \u5e8f\u5217\u62bd\u51fa\u6765\uff0c\u7814\u7a76\u5176\u53d8\u5316\u3002\n\n\u90a3\u4e48\u64cd\u4f5c\u91cc\u9762\u6709\u4e2a\u975e\u5e38\u591a\u4f59\u7684\u4e1c\u897f\u5c31\u662f\u9664\u4ee5\u4e8c\uff0c\u8fd9\u4e2a\u9664\u4ee5\u4e8c\u4ec0\u4e48\u65f6\u5019\u505a\u90fd\u53ef\u4ee5\uff0c\u53ef\u4ee5\u4ece\u7ebf\u6027\u53d8\u6362\u7684\u89d2\u5ea6\u8003\u8651\u3002\u90a3\u6211\u4eec\u5728\u6700\u540e\u9664\u4ee5 $2^k$ \u5373\u53ef\uff08\u8981\u7279\u5224 $n=2^p$\uff09\u3002\n\n\u5047\u8bbe\u73b0\u5728\u7684 $a$ \u5e8f\u5217\u662f $a_1,a_2,\\cdots a_m$ \u5e76\u8bb0 $mid = \\lceil \\frac{m}{2} \\rceil$\uff0c\u90a3\u4e48\u64cd\u4f5c\u4e00\u6b21\u4e4b\u540e\u662f $a_1+a_m,a_1+a_{m-1},a_2+a_{m-1},a_2+a_{m-2},\\cdots ,a_{mid-1}+a_{mid},2a_{mid}$\u3002\n\n\u8fd9\u4e2a\u5f62\u5f0f\u663e\u5f97\u6709\u89c4\u5f8b\u53ef\u5faa\uff0c\u8003\u8651\u5dee\u5206\u3002\u8bb0\u4e4b\u524d\u7684\u5dee\u5206\u6570\u7ec4\u4e3a $b_1,b_2,\\cdots ,b_{m-1}$\uff0c\u90a3\u4e48\u73b0\u5728\u7684\u5dee\u5206\u6570\u7ec4\u662f $-b_{m-1},b_1,-b_{m-2},b_2 \\cdots ,b_{mid-1}$\u3002\u8fd9\u662f\u8fd9\u4e2a\u9898\u79bb\u8c31\u7684\u7b2c\u4e00\u70b9\u3002\n\n\u73b0\u5728\u53ef\u4ee5\u505a\u5230 $O(n^2+q)$ \u4e86\uff0c\u8fd8\u53ef\u4ee5\u66f4\u4f18\u79c0\u5417\uff1f\n\n\u8fd9\u4e2a\u6570\u7ec4\u7684\u53d8\u6362\u662f\u975e\u5e38\u6709\u89c4\u5f8b\u7684\uff0c\u4f46\u662f\u51fa\u73b0\u4e86 $-1$ \u8fd9\u4e2a\u7cfb\u6570\u663e\u5f97\u4e0d\u4f18\u7f8e\uff0c\u6211\u4eec\u8003\u8651\u5f80\u5dee\u5206\u6570\u7ec4\u540e\u9762\u8865\u4e00\u4e2a $-b_{m-1},-b_{m-2},\\cdots ,-b_{1}$\uff0c\u7136\u540e\u8fd9\u662f\u4e00\u4e2a\u7f6e\u6362\u7684\u5f62\u5f0f\u3002\u73b0\u5728\u6bcf\u6b21\u8be2\u95ee\u8fd8\u539f\u5e8f\u5217\u5c31\u597d\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(nq)$\u3002\n\n\u7136\u540e\u8865\u5145\u4e00\u4e2a\u79bb\u8c31\u7684\u89c2\u5bdf\u3002\u8fd9\u4e2a\u7f6e\u6362\u62c6\u6210\u82e5\u5e72\u4e2a\u7f6e\u6362\u73af\uff0c\u6ee1\u8db3\u5927\u5c0f\u6700\u5927\u7684\u7f6e\u6362\u73af\u662f\u5176\u4ed6\u7f6e\u6362\u73af\u5927\u5c0f\u7684\u500d\u6570\u2026\u2026\u56e0\u6b64\u53ef\u4ee5\u4fdd\u8bc1\u5176\u5faa\u73af\u8282\u5728 $O(n)$ \u8303\u56f4\u5185\u3002\u8fdb\u4e00\u6b65\u7684\uff0c\u6700\u5927\u7684\u7f6e\u6362\u73af\u5927\u5c0f\u7b49\u4e8e $2$ \u5728 $\\bmod (n+1)$ \u4e0b\u4e58\u6cd5\u7684\u9636\uff08\u610f\u5373\u6700\u5927\u7684\u7f6e\u6362\u73af\u5927\u5c0f $x$ \u6ee1\u8db3 $2^x \\equiv 2 \\pmod{(n+1)}$ \u4e14 $x$ \u6700\u5c0f\uff09\u3002\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u725b\u903c\u7684\u89c2\u5bdf\u2026\u2026\u79bb\u8c31\u7684\u7b2c\u4e8c\u6b65\u3002\u5b9e\u5219\u6709\u8ff9\u53ef\u5faa\uff0c\u4f60\u53ef\u4ee5\u53d1\u73b0\u5728\u4e0a\u9762\u90a3\u4e2a\u5dee\u5206\u6570\u7ec4 $d$ \u4e2d\uff0c\u6ee1\u8db3 $d_{2i \\bmod (m+1)}' = d_i$\u3002\u8fd9\u4e2a\u89c2\u5bdf\u6bd4\u8f83\u91cd\u8981\u3002\n\n\u8fd8\u80fd\u591f\u4f18\u79c0\uff01\u8003\u8651\u901a\u8fc7\u5dee\u5206\u6570\u7ec4\u5feb\u901f\u8ba1\u7b97 $x$ \u4f4d\u7f6e\u4e0a\u7684\u503c\u3002\u8981\u505a\u7684\u4e24\u6b65\u662f\uff0c\u4e00\u4e2a\u5dee\u5206\u503c\u5728\u7b97 $a_x$ \u7684\u65f6\u5019\u9020\u6210\u4e86\u591a\u5c11\u6b21\u8d21\u732e\uff0c\u4ee5\u53ca $a_1$ \u7684\u503c\u662f\u591a\u5c11\u3002\n\n\u9996\u5148\u7b2c\u4e00\u4e2a\u89c2\u5bdf\u662f\uff0c\u56e0\u4e3a\u6211\u4eec\u5c06\u9664\u4ee5\u4e8c\u8fd9\u4e2a\u4e1c\u897f\u63d0\u5230\u4e86\u6700\u540e\uff0c\u6bcf\u6b21\u64cd\u4f5c\u6570\u5217\u7684\u6743\u503c\u548c\u662f\u4e0d\u53d8\u7684\u3002\u90a3\u4e48\u6c42 $a_1$ \u5e76\u4e0d\u662f\u4e00\u4ef6\u56f0\u96be\u7684\u4e8b\u60c5\uff0c\u5176\u8868\u793a\u6210\u603b\u548c\u51cf\u53bb\u5dee\u5206\u6570\u7ec4\u5e26\u4e0a\u4e00\u4e9b\u7cfb\u6570\uff0c\u6700\u540e\u9664\u4ee5 $n$\u3002\u7136\u540e\u7b97 $x$ \u7684\u8bdd\uff0c\u4e5f\u662f\u8fd1\u4f3c\u4e8e\u5dee\u5206\u6570\u7ec4\u5e26\u7cfb\u6570\u3002\u4e0d\u59a8\u8bb0\u8fd9\u4e2a\u7cfb\u6570\u4e3a $p_i$ \u4e0e $q_i$\uff0c\u5176\u4e58\u4e0a\u65b0\u7684\u5dee\u5206\u6570\u7ec4 $d_i^{(k)}$ \u624d\u6709\u610f\u4e49\u3002\u540c\u65f6\u8fd9\u4e2a $k$ \u4f18\u5316\u540e\u662f $O(n)$ \u7ea7\u522b\u7684\u3002\n\n\u8bb0 $S$ \u4e3a\u53d8\u6362\u524d $a$ \u7684\u548c\uff0c\u90a3\u4e48\u6709\uff1a\n\n$$\na_1 \\times n + \\sum_{i=1}^{m-1}d_i^{(k)}p_i = S\n$$\n\n$$\na_x = a_1 + \\sum_{i=1}^{m-1}d_i^{(k)}q_i\n$$\n\n\uff08\u5bb9\u6613\u53d1\u73b0 $q$ \u540e\u9762\u4e00\u6bb5\u53ef\u4ee5\u662f $0$\uff0c\u540c\u65f6 $p,q$ \u662f\u5bb9\u6613\u5f97\u51fa\u7684\u3002\uff09\n\n\u6211\u4eec\u8981\u5bf9\u6240\u6709\u7684 $k$ \u5168\u90e8\u6c42\u51fa\u4e00\u4e2a\u7b54\u6848\uff08\u540c\u65f6 $k$ \u6700\u5927\u662f $O(n)$ \u7ea7\u522b\u7684\uff09\u3002\u76f8\u5f53\u4e8e\u6c42 $\\displaystyle \\sum_{i=1}^{m-1}d_ip_i, \\sum_{i=1}^{m-1} d_i^{(1)}p_i,\\sum_{i=1}^{m-1} d_i^{(2)}p_i,\\cdots$\uff08\u5176\u4e2d\u7684 $p$ \u663e\u7136\u6362\u6210 $q$ \u4e5f\u8981\u7b97\u4e00\u6b21\uff09\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c06 $d$ \u8868\u793a\u6210\u7f6e\u6362\u7684\u5f62\u5f0f\u3002\u4f46\u662f\u53d8\u6362\u7684\u5f62\u5f0f\u5c31\u662f $d_{2i \\bmod (m+1)}' = d_i$ \u5c31\u663e\u5f97\u6bd4\u8f83\u9ebb\u70e6\u554a\u3002\u90a3\u5c31\u628a\u7f6e\u6362\u73af\u5168\u90e8\u62c6\u51fa\u6765\uff0c\u8fd9\u6837\u7684\u8bdd\u8fd9\u4e2a\u9ebb\u70e6\u7684\u53d8\u6362\u5f62\u5f0f\u5c31\u663e\u5f97\u7b80\u5355\u4e00\u4e9b\uff0c\u7c7b\u4f3c\u4e8e\u5faa\u73af\u5377\u79ef\u3002\n\n\u81f3\u4e8e\u5faa\u73af\u5377\u79ef\uff0c\u5728\u8fd9\u4e2a\u9898\u4e2d\u4e3e\u4e00\u4e2a\u4f8b\u5b50\u51fa\u6765\u3002\u6bd4\u5982\u4e00\u4e2a\u957f\u4e3a $P$ \u7684\u7f6e\u6362\u73af $d$\uff0c\u7f6e\u6362 $k$ \u6b21\u540e\u5bf9\u4e0a\u4e00\u4e2a\u7cfb\u6570\u6570\u7ec4 $p$\uff0c\u6709\uff1a\n\n$$\n\\sum_{i=0}^{P-1} d_i p_{i+k \\bmod P}\n$$\n\n\u540c\u65f6\u5bf9\u6bcf\u4e2a $k$ \u90fd\u8981\u6c42\u4e00\u4e2a\u8fd9\u4e2a\u3002\u8fd9\u91cc\u5c31\u663e\u5f97\u975e\u5e38\u7684\u7b80\u5355\uff0c\u628a $p$ \u7ffb\u8f6c\u505a\u5faa\u73af\u5377\u79ef\u5c31\u597d\u4e86\u3002\u53ef\u4ee5\u7528 NTT \u5b9e\u73b0\u3002\n\n\u6ce8\u610f\u5230\u4e0d\u540c\u7684\u7f6e\u6362\u73af\uff0c\u5982\u679c\u5927\u5c0f\u76f8\u540c\u9020\u6210\u8d21\u732e\u7684\u4f4d\u7f6e\u4e5f\u76f8\u540c\uff0c\u53ef\u4ee5\u63d0\u5230\u4e00\u8d77\u505a\u3002\u8fd9\u6837\u7684\u8bdd\u5927\u5c0f\u4e0d\u540c\u7684\u7f6e\u6362\u73af\u4e2a\u6570\u53ea\u6709 $O(\\sqrt n)$ \u7ea7\u522b\uff0c\u53ef\u4ee5\u505a\u5230 $O(n\\log n+q \\sqrt n)$\u3002\n\n\u8fd8\u6709\u4e00\u70b9\u5c31\u662f\u6211\u4eec\u4e00\u76f4\u5728\u8ba8\u8bba\u4e0a\u9762\u90a3\u4e2a\u6700\u540e\u4e00\u6bb5\u957f\u5ea6\u662f\u524d\u9762\u7684\u6bb5\u7684\u4e00\u534a\u7684 case\uff0c\u56e0\u6b64\u5982\u679c $n=2^k$ \u9700\u8981\u7279\u5224\u3002\n\n\u5f53\u7136\u6839\u636e\u6211\u4eec\u4e0a\u9762\u90a3\u4e2a\u6bd4\u8f83\u79bb\u8c31\u7684\u89c2\u5bdf\uff0c\u56e0\u4e3a\u6700\u5927\u7684\u7f6e\u6362\u73af\u5927\u5c0f\u7b49\u4e8e $2$ \u5728 $\\bmod (n+1)$ \u4e0b\u4e58\u6cd5\u7684\u9636\uff0c\u4e14\u5176\u4ed6\u7f6e\u6362\u73af\u5927\u5c0f\u662f\u6700\u5927\u7684\u7f6e\u6362\u73af\u7684\u56e0\u6570\uff0c\u56e0\u6b64\u6574\u4e2a $a$ \u4f1a\u4ea7\u751f\u5faa\u73af\u8282\uff0c\u4e14\u957f\u5ea6\u975e\u5e38\u6709\u9650\u3002\u8fd9\u6837\u7684\u8bdd\u8bb0\u6700\u5927\u7684\u7f6e\u6362\u73af\u957f\u5ea6\u4e3a $P$\uff0c\u76f4\u63a5\u9884\u5904\u7406\u6240\u6709 $k\\bmod P=0,1,\\cdots P-1$ \u7684\u7b54\u6848\u5c31\u597d\u4e86\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u505a\u5230 $O(n \\log n + n d(n) + q)$ \u4e86\u2026\u2026\u5417\uff1f\n\n\u6ce8\u610f\u5230 $k$ \u4e0a\u9762\u7684\u6027\u8d28\u90fd\u662f\u6211\u4eec\u5728 $a$ \u5f00\u59cb\u5f62\u6210\u4e0a\u9762\u90a3\u79cd\u7279\u6b8a\u5f62\u72b6\u540e\u53bb\u6389\u9664\u4ee5\u4e8c\u7684\u64cd\u4f5c\u5f97\u5230\u7684\uff0c\u6211\u4eec\u8fd8\u8981\u6c42\u4e00\u4e2a $\\dfrac{1}{2^k}$\uff0c\u8fd9\u4e2a $k$ \u662f\u6ca1\u6709\u7ecf\u8fc7\u5faa\u73af\u8282\u53d6\u6a21\u4f18\u5316\u7684\u771f\u5b9e\u7684 $k$\uff0c\u8303\u56f4\u4ecd\u7136\u662f $10^{18}$\u2026\u2026\u6240\u4ee5\u5148\u6b27\u62c9\u5b9a\u7406\u964d\u6b21\uff0c\u7136\u540e\u5149\u901f\u5e42\u5c31\u597d\u4e86\u3002\n\n\u7ec6\u8282\u6bd4\u8f83\u591a\u3002\u5b8c\u6574\u4ee3\u7801\u6233[\u8fd9\u91cc](https://www.luogu.com.cn/paste/euzle20e)\u3002\n\n```cpp\nint a[2000005],test;\nint hst[25][2000005],b[2000005],d[2000005],m;\nint cir[2000005];\nbool vis[2000005];\nint cbid[2000005];\nint fcir[2000005];\nvoid Solve()\n{\n\tint n, q, x;\n\tlong long k_max;\n\tscanf(\"%d%d%d%lld\", &n, &q, &x, &k_max);\n\tint Sum=0;\n\tfor (int i = 1; i <= n; i ++)\tscanf(\"%d\",&a[i]),Sum=Add(Sum,a[i]);\n\tfor(int i=1;i<=n;++i)\thst[0][i]=a[i];\n\tfor(int i=1;i<=24;++i)\n\t{\n\t\tfor(int j=1;j<=n;++j)\tb[j]=Add(hst[i-1][j],hst[i-1][n-j+1]);\n\t\tfor(int j=1;j<=n;++j)\thst[i][j]=Mul(b[(j+1)/2],inv2);\n\t}\n\tif((n&(-n))==n)\n\t{\n\t\tLL ans=0;\n\t\tfor(int C=1;C<=q;++C)\n\t\t{\n\t\t\tLL k=rd(seed)%k_max;\n\t\t\tk=min(k,24ll);\n\t\t\tans^=(LL(C)*hst[k][x]);\n\t\t}\n\t\tprintf(\"%lld\\n\",ans);\n\t\treturn ;\n\t}\n\tint t=0;\n\t{\n\tint tmp=n;\n\twhile(tmp%2==0)\n\t{\n\t\ttmp>>=1;\n\t\t++t;\n\t}\n\t++t;\n\t}\n\tint tp=t;\n\t{\n\tint pm=0;\n\tfor(int i=1;i<=n;i+=(1<<t))\tb[++pm]=hst[t][i];\n\tt=1<<t;\n\tm=0;\n\tfor(int i=2;i<=pm;++i)\td[++m]=Sub(b[i],b[i-1]);\n\tfor(int i=m;i;--i)\td[++m]=MOD-d[i];\n\t}\n\tfor(int i=1;i<=m;++i)\tcir[2*i%(m+1)]=i;\n\tfor(int i=1;i<=m;++i)\tvis[i]=false;\n\tvector<Poly> Cir;\n\tfor(int i=1;i<=m;++i)\n\t{\n\t\tif(vis[i])\tcontinue;\n\t\tint u=i;\n\t\tCir.push_back({});\n\t\twhile(!vis[u])\n\t\t{\n\t\t\tvis[u]=true;\n\t\t\tCir.back().push_back(u);\n\t\t\tu=cir[u];\n\t\t}\n\t}\n\tint K=1;\n\tfor(auto st:Cir)\tK=max(len(st),K);\n\tfor(int i=0;i<=K;++i)\tcbid[i]=fcir[i]=0;\n\tint inv=QuickPow(n);\n\tvector<Poly> CirBuc;\n\tfor(auto st:Cir)\n\t{\n\t\tPoly A,B;\n\t\tint len=len(st);\n\t\tA.resize(len),B.resize(len);\n\t\tfor(int i=0;i<len;++i)\tA[i]=d[st[i]];\n\t\tfor(int i=0;i<len;++i)\tB[i]=MOD-Mul(inv,st[i]<=m/2?Sub(n,Mul(st[i],t)):0);\n\t\tfor(int i=0;i<len;++i)\tB[i]=Add(B[i],int(st[i]*t+1<=x));\n\t\treverse(B.begin(),B.end());\n\t\tPoly C=A*B;\n\t\tfor(int i=0;i<len-1;++i)\tC[i]=Add(C[i],C[i+len]);\n\t\tif(!cbid[len])\n\t\t{\n\t\t\tCirBuc.push_back({});\n\t\t\tCirBuc.back().resize(len);\n\t\t\tcbid[len]=len(CirBuc);\n\t\t}\n\t\tint id=cbid[len]-1;\n\t\tfor(int i=0;i<len;++i)\tCirBuc[id][i]=Add(CirBuc[id][i],C[i]);\n\t}\n\tfor(int len=1;len<=K;++len)\n\t{\n\t\tif(cbid[len])\n\t\t{\n\t\t\tint id=cbid[len]-1;\n\t\t\tfor(int i=0,j=len-1;i<K;++i,j=(j+1)%len)\tfcir[i]=Add(fcir[i],CirBuc[id][j]);\n\t\t}\n\t}\n\tLL ans=0;\n\tfor(int C=1;C<=q;++C)\n\t{\n\t\tLL k=rd(seed)%k_max;\n\t\tint ret=0;\n\t\tif(k<=tp)\tret=hst[k][x];\n\t\telse\n\t\t{\n\t\t\tk-=tp;\n\t\t\tint coe=cp.Inv(k);\n\t\t\tk%=K;\n\t\t\tint s=Mul(fcir[k],coe);\n\t\t\tret=Add(s,Mul(inv,Sum));\n\t\t}\n\t\tans^=LL(C)*LL(ret);\n\t}\n\tprintf(\"%lld\\n\",ans);\n}\n```",
        "postTime": 1652799321,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u4e3a\u4ec0\u4e48\u4f60\u73b0\u5728\u53eb CyanSineSin \u4e86\uff1f\uff1f"
    },
    {
        "content": "\u5e0c\u671b\u80fd\u4f7f\u7528\u5c3d\u91cf\u5c11\u7684 intuition \u6765\u89e3\u91ca\u4e00\u4e0b\u8fd9\u9053\u9898\u3002\n\n\u4e3a\u65b9\u4fbf\u8d77\u89c1\uff0c\u4e0b\u9762\u5e8f\u5217\u5750\u6807\u5747\u4ece $0$ \u5230 $n-1$\u3002\n\n\u6211\u4eec\u5148\u5ffd\u7565\u6bcf\u6b21\u64cd\u4f5c\u4e2d\u7684\u9664\u4ee5 $2$\uff0c\u6700\u540e\u5728\u6c42\u51fa\u7b54\u6848\u4e4b\u540e\u522b\u5fd8\u4e86\u4e58\u4e0a $2^{-k}$ \u5c31\u884c\u3002 \n\n\u9996\u5148\u9898\u76ee\u4e2d\u63cf\u8ff0\u7684\u5bf9 $a$ \u7684\u53d8\u6362 $f(a)$ \u53ef\u4ee5\u5199\u6210\u77e9\u9635 $M$ \u4e58\u4e0a $a$ \u7684\u5f62\u5f0f\uff0c\u4f8b\u5982\u5f53 $n=10$ \u65f6\u77e9\u9635\u662f\u8fd9\u6837\u7684\uff1a\n\n```\n1 0 0 0 0 0 0 0 0 1\n1 0 0 0 0 0 0 0 0 1\n0 1 0 0 0 0 0 0 1 0\n0 1 0 0 0 0 0 0 1 0\n0 0 1 0 0 0 0 1 0 0\n0 0 1 0 0 0 0 1 0 0\n0 0 0 1 0 0 1 0 0 0\n0 0 0 1 0 0 1 0 0 0\n0 0 0 0 1 1 0 0 0 0\n0 0 0 0 1 1 0 0 0 0\n```\n\n\u7531\u4e8e\u6bcf\u6b21\u8be2\u95ee\u7684 $x$ \u662f\u56fa\u5b9a\u7684\uff0c\u6211\u4eec\u7684\u76ee\u6807\u5c31\u662f\u5feb\u901f\u6c42\u51fa $M^k$ \u7684\u7b2c $x$ \u884c $m_k[0,\\cdots ,n-1]$\uff0c\u7136\u540e\u53ef\u5f97 $ans(k)=\\sum_{i=0}^{n-1}a[i]\\cdot m_k[i]$\u3002\n\n\u8003\u8651\u600e\u4e48\u6c42 $m_k[0,\\cdots ,n-1]$\uff0c\u663e\u7136\u5b83\u4e00\u5b9a\u662f\u56de\u6587\u7684\uff0c\u7136\u540e\u642c\u51fa\u77e9\u4e58\u7684\u5b9a\u4e49\u5f0f\uff1a\n$$\nM^{k+1}[x][i]=\\sum_{j=0}^{n-1}M^k[x][j]\\cdot M[j][i]\n$$\n\u4ed4\u7ec6\u89c2\u5bdf\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u53ef\u5f97\uff1a\n$$\n\\begin{aligned}\nm_{k+1}[0]&=m_k[0]+m_k[1]\\\\\nm_{k+1}[1]&=m_k[2]+m_k[3]\\\\\n&\\vdots\\\\\nm_{k+1}[n/2-1]&=m_k[n-2]+m_k[n-1]\\\\\nm_{k+1}[n/2]&=m_k[n-2]+m_k[n-1]=m_k[0]+m_k[1]\\\\\nm_{k+1}[n/2+1]&=m_k[n-4]+m_k[n-3]=m_k[2]+m_k[3]\\\\\n&\\vdots\\\\\nm_{k+1}[n-1]&=m_k[0]+m_k[1]=m_k[n-2]+m_k[n-1]\n\\end{aligned}\n$$\n\u52fe\u753b\u51fa\u4e00\u79cd\u6a21\u5f0f\uff1a\n$$\nm_{k+1}[i]=m_k[(2i)\\%n]+m_k[(2i+1)\\%n]\n$$\n\u4e0d\u65ad\u56de\u4ee3\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a\n$$\n\\begin{aligned}\nm_k[i]\n&=\\sum_{j=i\\cdot 2^k}^{(i+1)\\cdot 2^k-1}m_0[j\\%n]\\\\\n&=\\sum_{j=i\\cdot 2^k}^{(i+1)\\cdot 2^k-1}[j\\%n=x]\n\\end{aligned}\n$$\n\u62c6\u6210\u4e24\u4e2a\u524d\u7f00\u548c\u4e4b\u5dee\u7684\u5f62\u5f0f\uff0c\u4e5f\u5c31\u662f\uff1a\n$$\np_k[i]=\\sum_{j=0}^{i\\cdot 2^k-1}[j\\%n=x]=\\left\\lfloor\\dfrac{i\\cdot 2^k-1}{n}\\right\\rfloor+[(i\\cdot 2^k-1)\\%n\\ge x]\n$$\n\u628a\u8fd9\u4e2a $p$ \u5199\u56de $ans(k)$ \u7684\u8868\u8fbe\u5f0f\u4e2d\uff0c\u7136\u540e\u8fdb\u884c\u5316\u7b80\uff1a\n$$\n\\begin{aligned}\nans(k)\n&=\\sum_{i=0}^{n-1}a[i]\\cdot m_k[i]\\\\\n&=\\sum_{i=0}^{n-1}a[i]\\cdot (p_k[i+1]-p_k[i])\\\\\n&=\\sum_{i=0}^{n}p_k[i]\\cdot (a[i-1]-a[i])\n\\end{aligned}\n$$\n\u4ee4 $a[-1]=a[n]=0$\uff0c\u7136\u540e\u8bb0 $b[i]=a[i-1]-a[i]$ $(0\\le i\\le n)$\uff0c\u7ee7\u7eed\u5316\u7b80\uff1a\n$$\n\\begin{aligned}\nans(k)\n&=\\sum_{i=0}^{n}\\left(\\left\\lfloor\\dfrac{i\\cdot 2^k-1}{n}\\right\\rfloor+[(i\\cdot 2^k-1)\\%n\\ge x]\\right)\\cdot b[i]\\\\\n&=\\sum_{i=0}^{n}\\left(\\dfrac{i\\cdot 2^k-1}{n}-\\dfrac{(i\\cdot 2^k-1)\\%n}{n}+[(i\\cdot 2^k-1)\\%n\\ge x]\\right)\\cdot b[i]\\\\\n&=\\dfrac{1}{n}\\left(2^k\\sum_{i=0}^{n}i\\cdot b[i]-\\sum_{i=0}^{n}b[i]\\right)+\\sum_{i=0}^{n}\\left([(i\\cdot 2^k-1)\\%n\\ge x]-\\dfrac{(i\\cdot 2^k-1)\\%n}{n}\\right)\\cdot b[i]\n\\end{aligned}\n$$\n\n\u524d\u9762\u8fd9\u4e00\u90e8\u5206\u597d\u505a\uff0c\u5148\u5ffd\u7565\uff0c\u6700\u540e\u522b\u5fd8\u4e86\u52a0\u4e0a\uff0c\u6ce8\u610f\u524d\u9762\u90e8\u5206\u7684 $b$ \u662f\u6ca1\u6539\u8fc7\u5b9a\u4e49\u7684 $b$\uff08\u4e0b\u9762\u4f1a\u4fee\u6539 $b$ \u7684\u5b9a\u4e49\uff09\u3002\n\n\u8bb0 $c[i]=[(i-1)\\%n\\ge x]-\\dfrac{(i-1)\\%n}{n}$\uff0c\u90a3\u4e48\u4e0a\u5f0f\u53d8\u4e3a $ans(k)=\\sum_{i=0}^nc[(i\\cdot 2^k)\\%n]\\cdot b[i]$\uff0c\u6ce8\u610f\u5230 $i=0$ \u4e0e $i=n$ \u5bf9\u5e94\u7684 $c$ \u662f\u76f8\u540c\u7684\uff0c\u56e0\u6b64\u628a $b[0]$ \u4e0e $b[n]$ \u5408\u5e76\u8d77\u6765\uff0c\u5f97\u5230\u6700\u7ec8 $b$ \u7684\u5b9a\u4e49\u4e0e $ans$ \u7684\u8868\u8fbe\u5f0f\uff1a\n$$\n\\begin{aligned}\nb[i]&=a[(i-1)\\%n]-a[i]\\ \\ (0\\le i<n)\\\\\nc[i]&=[(i-1)\\%n\\ge x]-\\dfrac{(i-1)\\%n}{n}\\ \\ (0\\le i<n)\\\\\nans(k)&=\\sum_{i=0}^{n-1}b[i]\\cdot c[(i\\cdot 2^k)\\%n]\n\\end{aligned}\n$$\n\u81f3\u6b64\uff0c\u524d\u9762\u5316\u7b80\u7684\u90e8\u5206\u7ed3\u675f\uff0c\u5f97\u5230\u4e86\u4e00\u4e2a\u5947\u602a\u7684 \u201c\u79ef\u5377\u79ef\u201d \u7684\u5f0f\u5b50\uff0c\u653e\u5f03\u601d\u8003\u76f4\u63a5\u5957\u8fd9\u4e2a\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a $O(n\\cdot \\min(n,q))$ \u7684\u505a\u6cd5\uff0c\u6709 $50\\sim 65$ \u5206\uff0c\u5373\u4f7f\u653e\u5728\u5f53\u65f6\u7684 ZJOI \u8003\u573a\u4e0a\uff0c\u8fd9\u4e2a\u5206\u6570\u4e5f\u662f\u76f8\u5f53\u53ef\u89c2\u7684\u4e86\uff08~~\u522b\u95ee\uff0c\u95ee\u6211\u5f53\u65f6\u5c31\u5f97\u4e86 20~~\uff09\u3002\n\n---\n\n\u73b0\u5728\u6765\u89c2\u5bdf\u4e00\u4e0b\u8fd9\u4e2a\u5947\u602a\u7684 \u201c\u79ef\u5377\u79ef\u201d $ans(k)=\\sum_{i=0}^{n-1}b[i]\\cdot c[(i\\cdot 2^k)\\%n]$\u3002\n\n\u7a0d\u5fae\u624b\u73a9\u4e00\u4e9b\u4f8b\u5b50\u53ef\u4ee5\u53d1\u73b0 $i\\rightarrow (2i)\\%n$ \u4f1a\u5f62\u6210\u4e00\u4e2a $\\rho$ \u5f62\u7684\u7ed3\u6784\uff0c\u5e76\u4e14\u524d\u9762\u73af\u5916\u7684\u957f\u5ea6\u4e0e $n$ \u4e2d\u56e0\u5b50 $2$ \u7684\u4e2a\u6570\u6709\u5173\uff0c\u4e8e\u662f\u8bb0 $t$ \u6ee1\u8db3 $2^t\\parallel n$\u3002\n\n\u5bf9 $k<t$  \u7684\uff0c\u53ef\u4ee5\u66b4\u529b\u9884\u5904\u7406\uff0c\u56e0\u4e3a $t$ \u7684\u5927\u5c0f\u662f $O(\\log n)$ \u7ea7\u522b\u7684\u3002\n\n\u5bf9 $k\\ge t$ \u7684\uff0c$i\\cdot 2^k$ \u4e00\u5b9a\u8fdb\u5165\u4e86\u73af\u4e2d\uff0c\u5e76\u4e14\u6b64\u65f6 $2^t$ \u6574\u9664 $(i\\cdot 2^k)\\%n$\uff0c\u4e0d\u59a8\u5168\u90e8\u9664\u53bb $2^t$\uff0c\u7136\u540e\u628a $k$ \u51cf\u53bb $t$ \u5f53\u505a\u8d77\u70b9\u5c31\u5728\u73af\u4e0a\u3002\u8fd9\u6837\u5c31\u53d8\u6210 $\\% \\dfrac{n}{2^t}$ \uff08\u8fd9\u662f\u4e00\u4e2a\u5947\u6570\uff09\u610f\u4e49\u4e0b\u7684\u95ee\u9898\uff0c\u6ce8\u610f\u5230\u8fd9\u65f6 $b,c$ \u7684\u5b9a\u4e49\u4e5f\u8981\u76f8\u5e94\u505a\u51fa\u6539\u53d8\uff1a\n$$\n\\begin{aligned}\nB[i]&=\\sum_{j=0}^{n-1}[j\\equiv i\\ (\\bmod \\dfrac{n}{2^t})]\\cdot b[j]\\\\\nC[i]&=c[i\\times 2^t]\\\\\n&0\\le i<\\dfrac{n}{2^t}\n\\end{aligned}\n$$\n\u5728\u8fd9\u4e2a\u5269\u4f59\u7cfb\u91cc\u89c2\u5bdf $\\times 2$ \u5f62\u6210\u7684\u73af\uff0c\u8bb0 $1$ \u6240\u5728\u73af\u7684\u5927\u5c0f\u4e3a $L$\uff0c\u6709\u5982\u4e0b\u4e24\u4e2a\u6027\u8d28\uff1a\n\n- \u6bcf\u4e2a\u73af\u7684\u5927\u5c0f\u5747\u4e3a $L$ \u7684\u56e0\u5b50\u3002\n- \u4e0d\u540c\u73af\u957f\u79cd\u6570\u975e\u5e38\u5c0f\uff08\u6211\u8bb0\u5f97\u662f $\\le 5$ \u7684\uff09\u3002\n\n$k$ \u53ef\u80fd\u5f88\u5927\uff0c\u56e0\u6b64\u8981\u628a\u5b83\u6a21\u4e0a $L$\u3002\n\n\u628a\u6bcf\u4e2a\u73af\u62ff\u51fa\u6765\u5355\u72ec\u8003\u8651\uff0c\u56e0\u4e3a\u5b83\u4eec\u5728 $\\times 2$ \u4e0b\u662f\u4e92\u4e0d\u5f71\u54cd\u7684\u3002\u4ece\u67d0\u4e2a\u70b9\u51fa\u53d1\uff0c\u628a\u73af\u4e0a\u7684\u70b9\u6807\u51fa\u6765\u8bb0\u4e3a $l[0,\\cdots,d-1]$\uff0c\u540c\u65f6\u5bf9\u73af\u4e2d\u7684\u70b9 $i$\uff0c\u8bb0\u5b83\u5728 $l$ \u4e2d\u7684\u4e0b\u6807\u4e3a $pos[i]$\uff0c\u4e8e\u662f\u503c\u4e0e\u4e0b\u6807\u7684\u5bf9\u5e94\u5173\u7cfb\uff1a\n$$\n\\begin{aligned}\ni&\\rightarrow pos[i]\\\\\n(i\\cdot 2^k)\\%\\dfrac{n}{2^t}&\\rightarrow (pos[i]+k)\n\\%d\\end{aligned}\n$$\n\u5f88\u63a5\u8fd1\u4e86\uff0c\u56e0\u4e3a\u4e58\u6cd5\u5df2\u7ecf\u53d8\u6210\u52a0\u6cd5\u4e86\uff0c\u7ee7\u7eed\u505a\u4ee3\u6362\uff1a\n$$\nB'[i]=B[l[i]]\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ C'[i]=C[l[i]]\\ \\ \\ \\ \\ \\ \\ \\ (0\\le i<d)\n$$\n\u8fd9\u6837\uff1a\n$$\n\\begin{aligned}\nB[i]\\cdot C[(i\\cdot 2^k)\\%\\dfrac{n}{2^t}]\n&\\Rightarrow B[l[pos[i]]]\\cdot B[l[pos[(i\\cdot 2^k)\\%\\dfrac{n}{2^t}]]]\\\\\n&\\Rightarrow B'[pos[i]]\\cdot C'[(pos[i]+k)\\%d]\n\\end{aligned}\n$$\n\u4e8e\u662f\uff0c$0\\le k<L$ \uff0c\u8fd9\u4e2a\u73af\u5bf9 $ans(k)$ \u7684\u8d21\u732e\u4e3a $\\sum_{i=0}^{d-1}B'[i]\\cdot C'[(i+k)\\%d]$\u3002\n\n\u6682\u4e14\u5bf9 $0\\le k<d$ \u7684 $k$ \u6c42\u51fa $ans'(k)$\uff0c\u6700\u7ec8 $ans(k)$ \u8981\u52a0\u4e0a $ans'(k\\%d)$\uff0c\u4e0d\u8fc7\u8fd9\u662f\u5bb9\u6613\u7684\u3002\n$$\nans'(k)=\\sum_{i=0}^{d-1}B'[i]\\cdot C'[(i+k)\\%d]\n$$\n\u8fd9\u662f\u4e00\u4e2a\u5faa\u73af\u5dee\u5377\u79ef\uff0c\u628a $B',C'$ \u5176\u4e00\u53cd\u8f6c\uff0c\u7136\u540e\u6b63\u5e38\u5377\u4e00\u4e0b\uff0c\u4e5f\u4e0d\u96be\u89e3\u51b3\u3002\n\n\u6700\u540e\uff0c\u7531\u4e8e\u73af\u7684\u4e2a\u6570\u53ef\u80fd\u4f1a\u5f88\u5927\uff0c\u4e0d\u80fd\u6bcf\u4e2a\u73af\u5bf9 $ans(k)$ \u66b4\u529b\u8d21\u732e\uff0c\u4f46\u662f\u53ef\u4ee5\u628a $d$ \u76f8\u540c\u7684\u73af\u7684 $ans'$ \u5408\u8d77\u6765\uff0c\u518d\u500d\u957f\u5230 $L$ \u52a0\u5230 $ans$ \u4e0a\u3002\u6839\u636e\u4e4b\u524d\u7684\u7ed3\u8bba\uff0c\u4e0d\u540c\u7684 $d$ \u975e\u5e38\u5c11\uff0c\u66b4\u529b\u626b\u63cf\u5c31\u53ef\u4ee5\u627f\u53d7\u4e86\u3002\n\n\u8fd8\u6709\uff0c$q$ \u5230\u4e86 $5\\times 10^7$\uff0c\u4e0d\u5f97\u4e0d\u4f7f\u7528\u5149\u901f\u5e42\uff08\u5149\u901f\u5e42\u601d\u60f3\u53c2\u8003 BSGS\uff09\u3002\n\n\u4ee3\u7801\u5df2\u7ecf\u5199\u6210\u5c4e\u5c71\u4e86\uff0c\u611f\u5174\u8da3\u7684\u81ea\u5df1\u770b\u770b\u5427\uff0c\u90a3\u65f6\u5f0f\u5b50\u7684\u63a8\u6cd5\u548c\u73b0\u5728\u7684\u4e0d\u592a\u4e00\u6837\u3002[Link](https://www.luogu.com.cn/paste/beyrxylq)",
        "postTime": 1676945133,
        "uid": 44599,
        "name": "wishapig",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P8332 [ZJOI2022] \u9762\u6761"
    },
    {
        "content": "#### \u9898\u89e3\n\n\u9996\u5148\u4e0d\u96be\u53d1\u73b0\uff0c\u7ecf\u8fc7\u8db3\u591f\u591a\u6b21\u53d8\u6362\u540e\uff0c\u5e8f\u5217\u4e00\u5b9a\u5f62\u6210\u82e5\u5e72\u6bb5\u76f8\u540c\u7684\uff0c\u4e14\u4e0d\u4f1a\u518d\u6b21\u8fdb\u884c\u5408\u5e76\u3002\u5f53 $n=2^k$ \u65f6\uff0c$k$ \u8f6e\u540e\u5168\u90e8\u76f8\u540c\uff1b\u5426\u5219\u8bbe $n=u\\times 2^v$\uff08$2\\nmid u$\uff09\uff0c\u5219\u6700\u7ec8\u5e8f\u5217\u4e00\u5b9a\u4e3a\u82e5\u5e72\u6bb5\u957f\u5ea6\u4e3a $2^{v+1}$ \u7684\u76f8\u540c\u6bb5\u4e0e\u4e00\u6bb5\u957f\u5ea6\u4e3a $2^v$ \u7684\u76f8\u540c\u6bb5\u3002\n\n\u5148\u4e0d\u8003\u8651\u6bcf\u6b21 $\\times \\frac{1}{2}$\uff0c\u5728\u6700\u540e\u518d\u4e58 $\\frac{1}{2^k}$\uff0c$O(1)$ \u8ba1\u7b97\u8fd9\u4e00\u90e8\u5206\u9700\u8981\u5148\u7528\u8d39\u9a6c\u5c0f\u5b9a\u7406\u5c06 $k$ \u5bf9 $p - 1$ \u53d6\u6a21\u540e\u7528\u5149\u901f\u4e58\uff08\u5206\u5757\u4e58\u6cd5\uff09\u8ba1\u7b97\uff0c\u8fd9\u4e00\u90e8\u5206\u662f $O(\\sqrt{p})$ \u7684\u3002\n\n\u5bf9\u4e8e\u76f8\u540c\u6bb5\u7684\u5904\u7406\uff0c\u53ef\u4ee5\u5148\u8fdb\u884c $O(\\log n)$ \u6b21\u64cd\u4f5c\u5230\u8fbe\u76f8\u540c\u6bb5\u7684\u9636\u6bb5\uff0c\u6bcf\u6b21\u64cd\u4f5c\u6548\u7387 $O(n)$\uff0c\u8fd9\u4e00\u90e8\u5206\u662f $O(n \\log n)$ \u7684\u3002\n\n\u5f53 $n=2^k$ \u65f6\uff0c\u6700\u7ec8\u5e8f\u5217\u4e00\u5b9a\u5168\u90e8\u76f8\u540c\uff0c\u7279\u5224\u6389\u5373\u53ef\u3002\u5426\u5219\u8bbe\u6700\u7ec8\u5e8f\u5217\u76f8\u540c\u6bb5\u5408\u5e76\u540e\u4e3a $\\{a,b,\\dots,c\\}$\uff0c\u5373\u539f\u5e8f\u5217\u7531 $2^{v+1}$ \u4e2a $a,b,\\dots$ \u4e0e $2^v$ \u4e2a $c$ \u6784\u6210\u3002\u8bb0 $m$ \u4e3a\u5f53\u524d\u5e8f\u5217\u7684\u957f\u5ea6\u3002\u8003\u8651\u4e00\u6b21\u64cd\u4f5c\u7684\u7ed3\u679c\uff1a$\\{a,b,c\\} \\to \\{a+c,a+b,2b\\}$\uff0c\u5b9e\u9645\u4e0a\u53ef\u4ee5\u63cf\u8ff0\u4e3a\uff1a$a'_i = a_{\\lceil \\frac{i}{2} \\rceil} + a_{m-\\lfloor \\frac{i}{2} \\rfloor}$\u3002\u7531\u6b64\u53ef\u4ee5\u8003\u8651\u5dee\u5206\uff0c\u8bbe\u4e0a\u4e00\u6b21\u7684\u5dee\u5206\u4e3a $\\{d_1,d_2,\\dots,d_{m-1}\\}$\uff0c\u5219\u4e0b\u4e00\u6b21\u7684\u5dee\u5206\u5373\u4e3a $-d_{m-1},d_1,-d_{m-2},d_2,\\dots$\u3002\u8003\u8651\u5e8f\u5217 $\\{d_1,d_2,\\dots,d_{m-1},-d_{m-1},\\dots,-d_2,-d_1\\}$\uff0c\u5219\u6bcf\u6b21\u64cd\u4f5c\u5b9e\u9645\u4e0a\u662f\u5bf9\u8be5\u5e8f\u5217\u8fdb\u884c\u4e00\u6b21\u6d17\u724c\u7f6e\u6362\uff0c\u5373\u5bf9\u4e8e\u957f\u5ea6\u4e3a $n$\uff08$2\\mid n$\uff09\u7684\u5e8f\u5217\u8fdb\u884c\u7f6e\u6362\uff1a$p_i=2i \\bmod {(n + 1)}$\u3002\u56e0\u6b64\u8be5\u7f6e\u6362\u7684\u5faa\u73af\u8282\u5373\u4e3a $2$ \u5728\u6a21 $n+1$ \u610f\u4e49\u4e0b\u7684\u9636\uff0c\u672c\u9898\u4e2d\u5373\u4e3a $r=\\delta_{2m-1}(2)$\u3002\n\n\u8003\u8651\u5229\u7528\u8fd9\u4e2a\u5faa\u73af\u8282\uff0c\u53ea\u9700\u6c42\u51fa $0 \\sim r - 1$ \u65f6\u523b\u7684 $a_1$ \u4e0e $\\sum_{i=1}^{x-1} d_i$\u3002\u7531\u4e8e $a'_1=2a_1+\\sum_{i=1}^{m-1} d_i$\uff0c\u5b9e\u9645\u4e0a\u53ea\u9700\u8981\u6c42\u51fa\u6bcf\u4e2a\u65f6\u523b\u7684 $\\sum_{i=1}^{x-1} d_i,\\sum_{i=1}^{n-1} d_i$ \u5373\u53ef\uff0c$a_1$ \u53ef\u4ee5\u7531\u8fd9\u4e9b\u503c\u4e0e\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\u5feb\u901f\u63a8\u51fa\u3002\u5bf9\u4e8e\u8ba1\u7b97\u6bcf\u4e00\u65f6\u523b\u7684\u5dee\u5206\uff0c\u53ef\u4ee5\u8003\u8651\u5728\u6bcf\u4e2a\u73af\u4e0a\u8ba1\u7b97\u8d21\u732e\uff0c\u5199\u51fa\u5f0f\u5b50\u540e\u53d1\u73b0\u662f\u5dee\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5 NTT \u4f18\u5316\u3002\u7531\u4e8e\u6bcf\u4e2a\u73af\u90fd\u9700\u8981\u5bf9 $0\\sim r - 1$ \u8ba1\u7b97\u4e00\u904d\u8d21\u732e\uff0c\u56e0\u6b64\u9700\u8981\u5bf9\u73af\u957f\u8fdb\u884c\u5206\u7c7b\uff0c\u5c06\u73af\u957f\u4e3a $d$ \u7684\u4e00\u8d77\u5904\u7406\u51fa\u5bf9 $0\\sim d-1$ \u7684\u8d21\u732e\u518d\u5904\u7406 $0\\sim r -1$\u3002\u7531\u4e8e $d \\mid r$\uff0c\u56e0\u6b64\u4e0d\u540c\u7684 $d$ \u53ea\u6709 $d(r)$ \u79cd\uff0c\u800c $\\sum {d}= 2m-2$\uff0c\u56e0\u6b64\u8fd9\u4e00\u90e8\u5206\u662f $O(n \\log n + nd(n))$ \u7684\u3002\n\n\u7efc\u4e0a\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\sqrt{p}+\\sum (n\\log n + nd(n)+q))$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\sqrt{p}+n)$\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nconst int mod = 998244353;\nconst int maxn = 4000000 + 10;\ninline int plus (int x, int y) {return x + y < mod ? x + y : x + y - mod;}\nconst int B = 1 << 15; int BS[B + 10], GS[B + 10]; bool vis[maxn]; std::vector<int> g[maxn];\nint n, m, q, t, p, r, a[maxn], b[maxn], c[maxn], d[maxn], e[maxn], sum[maxn], add[maxn], tag[maxn], ans[40];\ninline unsigned long long Rand (unsigned long long &x) {x ^= x << 13; x ^= x >> 7; x ^= x << 17; return x;}\ninline int Inv2 (long long k) {int r = k % (mod - 1); return 1LL * GS[r >> 15] * BS[r & (B - 1)] % mod;}\ninline int power (int x, int y)\n{\n\tint z = 1;\n\tfor (; y; y >>= 1, x = 1LL * x * x % mod) if (y & 1) z = 1LL * z * x % mod;\n\treturn z;\n}\nstruct Poly\n{\n\tint t, invt, u[1 << 23], v[1 << 23], w[1 << 23], rev[1 << 23];\n\tinline void init (int n)\n\t{\n\t\tfor (t = 1; t <= n; t <<= 1) ;\n\t\tinvt = power(t, mod - 2);\n\t\tfor (int i = 0; i < t; i++) rev[i] = (rev[i >> 1] >> 1) | ((i & 1) ? (t >> 1) : 0);\n\t\tfor (int i = 0; i < t; i++) u[i] = v[i] = w[i] = 0;\n\t}\n\tinline void NTT (int *a, int f)\n\t{\n\t\tfor (int i = 0; i < t; i++) if (i < rev[i]) std::swap(a[i], a[rev[i]]);\n\t\tfor (int i = 2; i <= t; i <<= 1)\n\t\t{\n\t\t\tint wn = power(~f ? 3 : 332748118, (mod - 1) / i);\n\t\t\tfor (int j = 0; j < t; j += i)\n\t\t\t\tfor (int k = 0, w = 1; k < i / 2; k++, w = 1LL * w * wn % mod)\n\t\t\t\t{\n\t\t\t\t\tint x = a[j + k], y = 1LL * w * a[j + k + i / 2] % mod;\n\t\t\t\t\ta[j + k] = plus(x, y); a[j + k + i / 2] = plus(x, mod - y);\n\t\t\t\t}\n\t\t}\n\t\tif (f == -1) for (int i = 0; i < t; i++) a[i] = 1LL * a[i] * invt % mod;\n\t}\n\tinline void solve (void)\n\t{\n\t\tNTT(u, 1); NTT(v, 1); NTT(w, 1);\n\t\tfor (int i = 0; i < t; i++) u[i] = 1LL * u[i] * w[i] % mod, v[i] = 1LL * v[i] * w[i] % mod;\n\t\tNTT(u, -1); NTT(v, -1);\n\t}\n} P;\nsigned main ()\n{\n\tBS[0] = 1; BS[1] = (mod + 1) / 2;\n\tfor (int i = 2; i <= B; i++) BS[i] = 1LL * BS[i - 1] * BS[1] % mod;\n\tGS[0] = 1; GS[1] = BS[B];\n\tfor (int i = 2; i <= B; i++) GS[i] = 1LL * GS[i - 1] * GS[1] % mod;\n\tint T; unsigned long long seed; scanf(\"%*d%d%llu\", &T, &seed);\n\twhile (T--)\n\t{\n\t\tlong long w, Ans = 0; scanf(\"%d%d%d%lld\", &n, &q, &p, &w);\n\t\tfor (int i = 1; i <= n; i++) scanf(\"%d\", &a[i]);\n\t\tfor (ans[t = 0] = a[p]; !(n & 1); n >>= 1)\n\t\t{\n\t\t\tfor (int i = 1; i <= n / 2; i++) a[i] = 1LL * BS[1] * (a[i] + a[n - i + 1]) % mod;\n\t\t\tans[++t] = a[p = (p + 1) / 2];\n\t\t}\n\t\tif (n == 1)\n\t\t{\n\t\t\tfor (int i = 1; i <= q; i++) Ans ^= 1LL * i * ans[std::min(Rand(seed) % w, (unsigned long long)t)];\n\t\t\tprintf(\"%lld\\n\", Ans); continue;\n\t\t}\n\t\tfor (int i = 1; i <= (n + 1) / 2; i++) a[i] = 1LL * BS[1] * (a[i] + a[n - i + 1]) % mod;\n\t\tans[++t] = a[p = (p + 1) / 2]; n = (n + 1) / 2;\n\t\tfor (int i = 1, j = 2; ; i++, j = 2LL * j % (2 * n - 1)) if (j == 1) {r = i; break;}\n\t\tfor (int i = 1; i < n; i++) b[i] = plus(a[i + 1], mod - a[i]), b[2 * n - i - 1] = plus(a[i], mod - a[i + 1]);\n\t\tfor (int i = 0; i < r; i++) tag[i] = sum[i] = add[i] = 0;\n\t\tfor (int i = 1; i <= 2 * n - 2; i++) vis[i] = false, std::vector<int>().swap(g[i]);\n\t\tfor (int i = 1; i <= 2 * n - 2; i++) if (!vis[i])\n\t\t{\n\t\t\tint m = 0;\n\t\t\tfor (int j = i; !vis[j]; j = 2LL * j % (2 * n - 1)) vis[j] = true, m++;\n\t\t\tg[m].push_back(i);\n\t\t}\n\t\tfor (int i = 1; i <= 2 * n - 2; i++) vis[i] = false;\n\t\tfor (int m = 1; m <= 2 * n - 2; m++) if (!g[m].empty())\n\t\t{\n\t\t\tfor (int i = 0; i < m; i++) d[i] = e[i] = 0;\n\t\t\tfor (int i: g[m])\n\t\t\t{\n\t\t\t\tP.init(3 * m);\n\t\t\t\tfor (int j = i, k = 0; !vis[j]; j = 2LL * j % (2 * n - 1), k++) vis[c[k] = c[k + m] = j] = true;\n\t\t\t\tfor (int j = 0; j < 2 * m; j++) P.u[j] = c[j] < p, P.v[j] = c[j] < n;\n\t\t\t\tfor (int j = 0; j < m; j++) P.w[j] = b[c[m - 1 - j]];\n\t\t\t\tP.solve();\n\t\t\t\tfor (int j = 0; j < m; j++) d[j] = plus(d[j], P.u[j + m - 1]), e[j] = plus(e[j], P.v[j + m - 1]);\n\t\t\t}\n\t\t\tfor (int i = 0; i < r; i += m) for (int j = 0; j < m; j++) sum[i + j] = plus(sum[i + j], d[j]), add[i + j] = plus(add[i + j], e[j]);\n\t\t}\n\t\tfor (int i = 1; i <= r; i++) tag[i] = (2LL * tag[i - 1] + add[i - 1]) % mod;\n\t\tfor (int i = 0; i < r; i++) tag[i] = plus(tag[i], sum[i]);\n\t\ttag[r] = 1LL * power(power(2, r) - 1, mod - 2) * tag[r] % mod;\n\t\tfor (int i = 1; i <= q; i++)\n\t\t{\n\t\t\tlong long k = Rand(seed) % w;\n\t\t\tif (k <= t) {Ans ^= 1LL * i * ans[k]; continue;}\n\t\t\tk -= t; Ans ^= 1LL * i * ((a[1] + 1LL * (1 - Inv2(k / r * r) + mod) * tag[r] + 1LL * Inv2(k) * tag[k % r]) % mod);\n\t\t}\n\t\tprintf(\"%lld\\n\", Ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1661749171,
        "uid": 46197,
        "name": "_RSY_",
        "ccfLevel": 10,
        "title": "\u3010\u9898\u89e3\u3011P8332"
    },
    {
        "content": "## \u524d\u8a00\n\n~~shj \u5927\u4f6c\u8bf4\u8fd9\u6b21 ZJOI \u6ca1\u6709\u9632 AK \u9898\uff0c\u82b1\u56db\u4e2a\u534a\u5c0f\u65f6\u90fd\u80fd\u5199\u51fa\u6765\u3002~~\n\n~~\u4ed6\u8fd8\u8bf4\u9664\u4e86\u8fd9\u9898\u7684\u7b2c\u4e00\u6b65\u6ca1\u60f3\u5230\uff0c\u5176\u4ed6\u90fd\u662f\u8f7b\u8f7b\u677e\u677e\u3002~~\n\n\u672c\u6587\u53c2\u8003\u4e86\u51fa\u9898\u4eba\u7684[\u9898\u89e3](https://www.zhihu.com/question/531164650/answer/2468389537)\u3002\n\n\u9898\u89e3\u4e2d\u6709\u4e00\u4e9b\u6253\u8868\u53d1\u73b0\u7684\uff0c\u518d\u4e0b\u9762\u57fa\u672c\u4e0a\u6709\u8bc1\u660e\u3002\n\n\u5982\u679c\u56fe\u7247\u770b\u4e0d\u6e05\u695a\u7684\u8bdd\uff0c\u53ef\u4ee5\u76f4\u63a5\u53bb\u8def\u8fc7\u56fe\u5e8a\u7684\u94fe\u63a5\u4e0a\u67e5\u770b\uff08\u76f4\u63a5\u70b9\u51fb\u56fe\u7247\u5373\u53ef\uff09\u3002\n\n## \u9898\u89e3\n\n\uff08\u4e3a\u4e86\u65b9\u4fbf\u7406\u89e3\uff0c\u57fa\u672c\u4ee5\u51e0\u4f55\u76f4\u89c2\uff08\u753b\u56fe\uff09\u4e3a\u4e3b\uff09\n\n### 5 pt\n\n\u66b4\u529b\u6a21\u62df\u5373\u53ef\u3002\u590d\u6742\u5ea6 $O(Tqkn)$\n\n### 10 pt\n\n\u6ce8\u610f\u5230\u7b2c\u4e8c\u4e2a\u6d4b\u8bd5\u70b9 $k_{max}\\le 10$\uff0c\u53ef\u4ee5\u9884\u5904\u7406\u51fa $k\\le 10$ \u7684\u7b54\u6848\u3002\n\n### 15 pt\n\n\u6253\u8868\u53ef\u4ee5\u53d1\u73b0,\u6ce8\u610f\u5230 $n=2^k$ \u65f6\uff0c\u7ecf\u8fc7 $\\log_2^{n}$ \u6b21\u53d8\u6362\u540e\u6240\u6709\u6570\u90fd\u4f1a\u53d8\u6210\u76f8\u7b49\u3002\u518d\u8fdb\u884c\u64cd\u4f5c\u65f6\u7b54\u6848\u4e0d\u53d8\u3002\u5206\u7c7b\u8ba8\u8bba\u5373\u53ef\u3002\n\n### 40 pt\n\n\u89c2\u5bdf\u5230\u6b64\u53d8\u6362\u662f\u7ebf\u6027\u53d8\u6362\uff0c\u56e0\u6b64\u80fd\u7528\u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316\u3002\u5e76\u4e14\u4e00\u6b21\u53d8\u6362\u540e\u7684 $\\frac{1}{2}$ \u7684\u7cfb\u6570\u5bf9\u77e9\u9635\u6784\u9020\u6ca1\u6709\u5f71\u54cd\uff0c\u90a3\u4e48\u628a\u8fd9\u4e2a $\\frac{1}{2}$ \u63d0\u5230\u6700\u7ec8\u7b54\u6848\u4e0a\uff0c\u90a3\u4e48\u5927\u6982\u957f\u8fd9\u6837\uff1a\n\n[![OdwMh8.png](https://s1.ax1x.com/2022/05/11/OdwMh8.png)](https://imgtu.com/i/OdwMh8)\n\n\u76f4\u63a5\u66b4\u529b\u7684\u590d\u6742\u5ea6\u4e3a $O(T(n^2+q\\log_2^k+qn^3k))$\uff0c\u80fd\u8fc7\u7b2c $4$ \u5230 $6$ \u4e2a\u70b9\u3002\n\n\u636e\u5e38\u7528\u7684\u5957\u8def\u2014\u2014\u5411\u91cf\u4e0e\u77e9\u9635\u76f8\u4e58\u7684\u590d\u6742\u5ea6\u4e3a $O(n^2)$\uff0c\u90a3\u4e48\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u53d8\u6362 $2^k$ \u6b21\u540e\u7684\u77e9\u9635\uff0c\u8be2\u95ee\u65f6\u518d\u4e0e\u5411\u91cf\u9010\u4e2a\u76f8\u4e58\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u91c7\u7528 $p$ \u8fdb\u5236\u7684\u5feb\u901f\u5e42\uff0c\u590d\u6742\u5ea6\u5927\u7ea6\u4e3a $ O(T(n^3\\times p\\times \\log_{p}^{n}+q\\log_2^k+qn^2\\log_p^{n})) $ \uff0c\u80fd\u901a\u8fc7\u7b2c $8$ \u5230\u7b2c $9$ \u4e2a\u70b9\u3002\n\n### 45 pt\n\n\u89c2\u5bdf\u7b2c\u4e03\u4e2a\u6d4b\u8bd5\u70b9\uff0c\u53d1\u73b0 $98304=2^{15} \\times 3$\u3002\u901a\u8fc7\u6253\u8868\u53d1\u73b0\uff0c\u5f53 $n=2^{k}\\times 3$ \u65f6\uff0c\u5728\u8fdb\u884c\u5927\u7ea6 $log_2^{n}$ \u6b21\u53d8\u6362\u540e\u7684\u6bcf\u4e00\u53d8\u6362\uff0c\u533a\u95f4\u7684\u6570\u7684\u503c\u90fd\u5f62\u5982 $aa...aa\\ bb...bb\\ cc..cc$\uff0c\u5e76\u4e14 $a$ \u548c $b$ \u7684\u957f\u5ea6\u90fd\u4e3a $2^{k+1}$\uff0c $c$ \u7684\u957f\u5ea6\u4e3a $2^k$\u3002\u90a3\u4e48\u6b64\u65f6\u77e9\u9635\u5feb\u901f\u5e42\u7684\u590d\u6742\u5ea6\u964d\u4e3a $O(T(n\\log_2^n +q\\log_2^k+ q \\times 3^3 \\log_2^{k}))$\uff08\u56e0\u4e3a\u53ea\u9700\u8981\u7ef4\u62a4 $3$ \u4e2a\u6570\uff09\u3002\n\n### 65 pt\n\n\u6839\u636e\u6d4b\u8bd5\u70b9\u7ed9\u51fa\u7684\u7279\u6b8a\u6027\u8d28\uff08$2^k$ \u548c $2^{15}\\times 3 $ \uff09\u3002\u6211\u4eec\u80fd\u5927\u6982\u731c\u6d4b\u5728\u505a $\\log_2^{n}$ \u6b21\u53d8\u6362\u540e\u6570\u5217\u4f1a\u51fa\u73b0\u4e00\u4e9b\u6027\u8d28\u3002\u6ce8\u610f\u5230 $n$ \u4e00\u5b9a\u662f\u5076\u6570\uff0c\u901a\u8fc7\u6253\u8868\u53ef\u4ee5\u53d1\u73b0\uff1a\n\n- \u5728 $n=2^t$ \u7684\u65f6\u5019\uff0c\u7ecf\u8fc7 $t+1$ \u6b21\u53d8\u6362\u540e\u6240\u6709\u6570\u5217\u4e2d\u7684\u6570\u90fd\u76f8\u7b49\u3002\n- \u5728 $n=2^{t}\\times m\\ (\\ 2\\nmid m ,m>1\\ )$ \u7684\u65f6\u5019\uff0c\u89c2\u5bdf\u5230\u53d8\u6362\u6b21\u6570 $k$ \u5c0f\u4e8e $t+1$ \u65f6\uff0c\u53d8\u6362\u540e\u4f1a\u6709\u82e5\u5e72\u4e2a\u957f\u5ea6\u4e3a $2^k$ \u7684\u533a\u95f4\uff0c\u5176\u4e2d\u6bcf\u4e2a\u533a\u95f4\u5185\u7684\u6570\u90fd\u76f8\u7b49\uff08\u82e5\u65e0\u7279\u6b8a\u8bf4\u660e\uff0c\u4e0b\u6587\u8bf4\u7684\u533a\u95f4\u90fd\u6ee1\u8db3\u533a\u95f4\u5185\u7684\u6570\u90fd\u76f8\u7b49\u7684\u6761\u4ef6\uff09\uff1b\u5f53\u53d8\u6362\u6b21\u6570 $k$ \u5927\u4e8e\u7b49\u4e8e $t+1$ \u65f6\uff0c\u53d8\u6362\u540e\u4f1a\u6709 $\\frac{m-1}{2}$ \u4e2a\u957f\u5ea6\u4e3a $2^{t+1}$ \u7684\u533a\u95f4\u548c\u4e00\u4e2a\u957f\u5ea6\u4e3a $2^t$ \u7684\u533a\u95f4\u3002\n\n\u56e0\u4e3a\u53d8\u6362\u7684\u76f8\u7b49\u6027\u5e76\u4e0d\u88ab\u53d8\u6362\u540e\u6240\u5e26\u7684 $\\frac{1}{2}$ \u7684\u7cfb\u6570\u5f71\u54cd\uff0c\u56e0\u6b64\u8003\u8651\u5148\u62ff\u6389\u8fd9\u4e2a\u7cfb\u6570\u76f4\u63a5\u653e\u5230\u7b54\u6848\u4e2d\u53bb\u3002\n\n\u76f4\u89c2\u7684\u51e0\u4f55\u8bc1\u660e\u5982\u4e0b\uff1a\n\n\uff08\u4e3e\u5f97\u90fd\u662f\u5c0f\u4f8b\u5b50\uff0c\u5bf9\u4e8e\u66f4\u591a\u5757\u7684\u60c5\u51b5\uff0c\u81ea\u884c\u7528\u7701\u7565\u53f7\u548c $mid$ \u4ee3\u66ff\u3002\uff09\n\n\uff08\u60f3\u8981\u4ee3\u6570\u8bc1\u660e\u53ef\u4ee5\u5bf9\u7740\u56fe\u81ea\u5df1\u6252\u62c9\u6252\u62c9\u3002\uff09\n\n\u9996\u5148\u8003\u8651\u53d8\u6362\u7684\u51e0\u4f55\u610f\u4e49\uff0c\u5bb9\u6613\u89c2\u5bdf\u5230\u8fd9\u662f\u4e00\u4e2a\u7ebf\u6027\u53d8\u6362\uff08\u56e0\u4e3a\u80fd\u7528\u77e9\u9635\u8868\u793a\uff09\n\n[![OwKp4I.png](https://s1.ax1x.com/2022/05/12/OwKp4I.png)](https://imgtu.com/i/OwKp4I)\n\n\n\n- \u8bbe\u53d8\u6362\u6b21\u6570\u4e3a $k$\uff0c\u5f53 $k$ \u5c0f\u4e8e $t+1$ \u65f6\uff0c\u4f1a\u7531\u82e5\u5e72\u4e2a\u957f\u5ea6\u4e3a $ 2^k $ \u7684\u533a\u95f4\u53d8\u6210\u82e5\u5e72\u4e2a\u957f\u5ea6\u4e3a $2^{k+1}$ \u7684\u533a\u95f4\uff0c\u5e76\u4e14\u957f\u5ea6\u4e3a\u5076\u6570\uff08\u56e0\u4e3a $n=2^{k}\\times m'\\ (k<t+1,2 | m')$\uff09\u3002\n\n[![OwKta9.png](https://s1.ax1x.com/2022/05/12/OwKta9.png)](https://imgtu.com/i/OwKta9)\n\n- \u5f53\u53d8\u6362\u6b21\u6570 $t+1=k$ \u65f6\uff0c\u4f1a\u6709 $\\frac{m-1}{2}$ \u4e2a\u957f\u5ea6\u4e3a $2^{t+1}$ \u7684\u533a\u95f4\uff0c$1$ \u4e2a\u957f\u5ea6\u4e3a $2^t$ \u7684\u533a\u95f4\u3002\uff08\u56e0\u4e3a $\\frac{m-1}{2}\\times 2^{t+1} +2^t =m\\times 2^t-2^t+2^t=n$\uff09\n\n[![OwKzsU.png](https://s1.ax1x.com/2022/05/12/OwKzsU.png)](https://imgtu.com/i/OwKzsU)\n\n- \u5f53\u53d8\u6362\u6b21\u6570 $t+1<k$ \u65f6\uff0c\u4f1a\u6709 $\\frac{m-1}{2}$ \u4e2a\u957f\u5ea6\u4e3a $2^{t+1}$ \u7684\u533a\u95f4\uff0c$1$ \u4e2a\u957f\u5ea6\u4e3a $2^t$ \u7684\u533a\u95f4\u3002\n\n[![OwMmLD.png](https://s1.ax1x.com/2022/05/12/OwMmLD.png)](https://imgtu.com/i/OwMmLD)\n\n**\u6ce8\u610f**\uff1a\u6211\u4eec\u4e0b\u9762\u8ba8\u8bba\u7684 $n$ \u5747\u4e0d\u4e3a $2$ \u7684\u5e42\u6b21\uff0c\u5426\u5219\u53ef\u4ee5\u7279\u5224\u6389\u3002\n\n\u6211\u4eec\u901a\u8fc7\u753b\u56fe\u53d1\u73b0\uff0c\u5728\u7ecf\u8fc7 $t+1$ \u6b21\u53d8\u6362\u540e\uff0c\u6570\u5217\u7684\u5f62\u5f0f\u4e0d\u53d8\u3002\u56e0\u6b64\u6211\u4eec\u5355\u72ec\u8003\u8651 $t+1$ \u6b21\u53d8\u6362\u540e\u7684\u60c5\u51b5\u3002\u6ce8\u610f\u5230 $t \\le log_2^{n}$\uff0c\u6240\u4ee5\u9884\u5904\u7406\u662f $O(n\\log_2^{n}) $ \u7ea7\u522b\u7684\u3002\n\n\u6211\u4eec\u5148\u628a\u539f\u5148\u7684\u5e8f\u5217\u7684\u6700\u957f\u7684\u533a\u95f4\u6d53\u7f29\u6210\u4e00\u4e2a\u6570\uff0c\u90a3\u4e48\u53d8\u6362\u540e\u7684\u6240\u6709\u7684\u533a\u95f4\u6570\u91cf\u4e3a $M = \\frac{m-1}{2} +1$\u3002\n\n\uff08\u6ce8\u610f\u6b64\u65f6\u518d\u7528\u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316\u4f1a\u51cf\u5c0f\u4e00\u4e9b\u4e0d\u786e\u5b9a\u7684\u5e38\u6570\u3002\uff09\n\n\u5148\u8003\u8651\u4e00\u6b21\u53d8\u6362\u540e\u7684\u60c5\u51b5\uff1a\uff08\u7b2c\u4e00\u884c\u7684\u957f\u5ea6\u4e3a $2^t$\uff0c\u7b2c\u4e8c\u884c\u7684\u957f\u5ea6\u4e3a $2^{t+1} $ \u548c $2^t$ \uff08\u6700\u540e\u4e00\u4e2a\uff09\uff09\n\n\uff08\u4efb\u7136\u8003\u8651\u5148\u628a $\\frac{1}{2}$ \u62ff\u6389\u8003\u8651\uff0c\u9700\u8981\u7684\u65f6\u5019\u518d\u8003\u8651\u52a0\u4e0a\uff09\n\n```\na1 a1 a2 a2 a3 a3 a4 a4 a5  ->   a1+a5 a1+a5 a1+a4 a1+a4 a2+a4 a2+a4 a2+a3 a2+a3 a3+a3 \n  |     |     |     |   |             |           |           |           |        |\n  a1    a2    a3    a4  a5          a1+a5       a1+a4       a2+a4        a2+a3    a3+a3\n```\n\n\u7531\u4e8e\u53d8\u6362\u540e\u7684\u6700\u5927\u7684\u533a\u95f4\u957f\u5ea6\u4e3a $2^{t+1}$\uff0c\u56e0\u6b64\u6211\u4eec\u8003\u8651\u5bf9\u4e24\u6b21\u53d8\u6362\u540e\u7684\u76f8\u5e94\u7684\u533a\u95f4\u505a\u5bf9\u6bd4\uff1a\n\n```\n      a1    a2    a3    a4    a5 \n->  a1+a5 a1+a4 a2+a4 a2+a3 a3+a3\n```\n\n\u8003\u8651\u64cd\u4f5c\u540e\u7684\u5e8f\u5217\u7684\u76f8\u90bb\u533a\u95f4\u7684\u503c\u53ea\u6709\u4e00\u4e2a\u6570\u4e0d\u76f8\u7b49\uff0c\u90a3\u4e48\u8003\u8651\u5bf9\u5e8f\u5217\u505a\u5dee\u5206\uff08$d_i=a_{i+1}-a_i$\uff09\uff1a\n\n```\n      a1     a2     a3     a4     a5    \nd:      a2-a1  a3-a2  a4-a3  a5-a4   \n         d1     d2     d3     d4\n->  a1+a5  a1+a4  a2+a4  a2+a3  a3+a3    \nd':     a4-a5  a2-a1  a3-a4  a3-a2\n        -d4     d1    -d3     d2\n```\n\n\uff08\u5176\u4e2d $d$ \u548c $d'$ \u7684\u6570\u7ec4\u7684\u957f\u5ea6\u4e3a $M-1$\uff09\n\n\u8003\u8651 $d$ \u6570\u7ec4\u548c $d'$ \u6570\u7ec4\u4e2d\u7684\u7edd\u5bf9\u503c\u7684\u503c\u7ec4\u6210\u96c6\u5408\u76f8\u7b49\u3002\u5e76\u4e14\u901a\u8fc7\u6253\u8868\u53d1\u73b0\uff0c\u53d8\u6362\u5faa\u73af\u8282\u957f\u5ea6\u4e0d\u8d85\u8fc7 $2(M-1)$\uff0c\u6b64\u65f6\u9884\u5904\u7406\u5faa\u73af\u8282\u91cc\u7684\u6bcf\u4e2a\u5dee\u5206\u53ef\u4ee5\u505a\u5230 $O(T(n^2+q\\log_2^k))$ \u7684\u590d\u6742\u5ea6\u3002\n\n\uff08\u7531\u4e8e\u52a0\u4e0a $\\frac{1}{2}$ \u540e\u4f1a\u7834\u574f $d$ \u4e0e $d'$ \u7684\u76f8\u7b49\u6027\uff0c\u56e0\u6b64\u628a $\\frac{1}{2}$ \u653e\u5230\u7b54\u6848\u4e2d\u53bb\uff09\n\n> \u663e\u7136\u73b0\u5728\u8fd8\u9700\u8981\u77e5\u9053 $a_1$ \u7684\u503c\u3002\u8fd9\u4e2a\u653e\u5728\u540e\u9762\u8ba8\u8bba\n\n\u4e0d\u8fc7\u8fd9\u4e2a\u7edd\u5bf9\u503c\u975e\u5e38\u788d\u773c\u3002\u90a3\u4e48\u6211\u4eec\u901a\u8fc7\u8865\u5168 $d_i$ \u548c $-d_i$ \u7684\u65b9\u6cd5\u6765\u907f\u514d\u3002\u7531\u4e8e\u5728\u4e0a\u9762\u7684\u53d8\u6362\u4e2d $d'_{2\\times i}=d_i$ \u5bf9 $i\\le  \\frac{M-1}{2}$ \u6210\u7acb\uff0c\u90a3\u4e48\u8865\u5168\u8fd9\u4e2a\u795e\u5947\u7684\u53d8\u6362\uff1a\n\n```sqlite\nd  :  d1  d2  d3  d4 | -d4 -d3 -d2 -d1\nd' : -d4  d1 -d3  d2 | -d2  d3 -d1  d4\n```\n\n\uff08\u5176\u4e2d d \u548c d' \u7684\u6570\u7ec4\u957f\u5ea6\u4e3a $2(M-1)$\uff09\n\n\u6211\u4eec\u4f1a\u53d1\u73b0\u4e00\u4e2a\u795e\u5947\u7684\u7f6e\u6362\u2014\u2014$d'_i=d_{i\\times 2 \\ mod\\ 2(M-1)+1}$\u3002\u56e0\u4e3a\u662f\u7f6e\u6362\uff0c\u8003\u8651[\u7f6e\u6362\u7fa4 - OI Wiki (oi-wiki.org)](https://oi-wiki.org/math/permutation-group/)\u4e2d\u7684\u76f8\u5173\u77e5\u8bc6\u2014\u2014\u4e00\u4e2a\u7f6e\u6362\u53ef\u4ee5\u5206\u89e3\u4e3a\u82e5\u5e72\u4e2a\u4e0d\u76f8\u4ea4\u7684\u5faa\u73af\u7f6e\u6362\u3002\u7531\u4e8e\u5faa\u73af\u7f6e\u6362\u663e\u7136\u6709\u5faa\u73af\u8282\uff0c\u90a3\u4e48\u7f6e\u6362\u4e5f\u663e\u7136\u6709\u5faa\u73af\u8282\u3002\u7531\u4e8e\u8fd9\u4e2a\u7f6e\u6362\u7684\u6027\u8d28\uff0c\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\u66b4\u529b\u7528\u5feb\u901f\u5e42\u8df3\u7f6e\u6362\u540e\u8ba1\u7b97\uff0c\u590d\u6742\u5ea6\u4e3a $O(T(nq\\log_2^{k}+q\\log_2^{k}))$\n\n\uff08\u53ef\u80fd\u6709\u66f4\u4f18\u7684\u529e\u6cd5\uff0c\u4f46\u7531\u4e8e\u7f51\u4e0d\u597d\uff0c\u4ee3\u7801\u4e0b\u4e0d\u4e0b\u6765\uff0c\u6240\u4ee5\u6ca1\u6709\u5199qaq\uff0c\u6bd5\u7adf\u539f\u9898\u89e3\u6ca1\u6709\u8fd9\u4e2a $log$\uff09\n\n\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u8ba1\u7b97 $a_1$ \u7684\u503c\u3002\u5bb9\u6613\u77e5\u9053\uff0c\u9898\u76ee\u4e2d\u6240\u7ed9\u7684\u53d8\u6362\u5e76\u6ca1\u6709\u6539\u53d8\u5e8f\u5217\u7684\u603b\u548c\u3002\n\n> \u56e0\u4e3a $a_i$ \u4e0e $a_{n-i+1}$ \u8d21\u732e\u4e86\u4e24\u4e2a\u6570\uff08\u56e0\u4e3a\u5e8f\u5217\u957f\u5ea6\u4e3a\u5076\u6570\uff09\uff0c\u6bcf\u4e2a\u90fd\u662f $\\frac{a_i+a_{n-i+1}}{2}$\uff0c\u56e0\u6b64\u603b\u548c\u4e0d\u53d8\u3002\n\n\u90a3\u4e48\u5f53\u628a $\\frac{1}{2}$ \u7684\u7cfb\u6570\u62bd\u6389\u65f6\uff0c\u6bcf\u53d8\u6362\u4e00\u6b21\u5e8f\u5217\u603b\u548c  $\\times 2$\u3002\u90a3\u4e48\u663e\u7136\u6211\u4eec\u53ef\u4ee5\u7b97\u51fa\u53d8\u6362\u540e\u7684\u5e8f\u5217\u603b\u548c\uff0c\u90a3\u4e48\u56e0\u4e3a\u6211\u4eec\u53c8\u77e5\u9053\u5dee\u5206\u6570\u7ec4\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u628a $a_1$ ~ $a_n$ \u90fd\u7528 $a_1$ \u8868\u793a\uff0c\u90a3\u4e48\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u65b9\u7a0b\uff1a\n\n\u8bbe $w_{1}(i) $ \u8868\u793a\u5728\u53d8\u6362 $k$ \u6b21\u540e\uff0c**\u65b0**\u5dee\u5206\u6570\u7ec4\u7684\u7b2c $i$ \u4f4d\u5bf9\u603b\u548c\u8ba1\u7b97\u7684\u8d21\u732e\uff0c\u8bbe $w_2(i)$ \u8868\u793a\u53d8\u6362 $k$ \u6b21\u540e\uff0c\u65b0\u5dee\u5206\u6570\u7ec4\u5bf9\u8ba1\u7b97\u7b2c $x$ \u4f4d\u7684\u8d21\u732e\uff0c\u8bbe $d_i$ \u8868\u793a\u53d8\u6362\u540e\u7684**\u65b0**\u5dee\u5206\u6570\u7ec4\u3002\n\n\uff08\u6ce8\u610f\uff0c\u8ba1\u7b97\u7684\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217\u7684\u603b\u548c\u3002\u4e0d\u80fd\u8ba1\u7b97\u6d53\u7f29\u8fc7\u7684\u6570\u7ec4\uff0c\u56e0\u4e3a\u957f\u5ea6\u4e0d\u76f8\u7b49\uff09\n$$\n\\sum_{i=1}^{M-1}d_iw_1(i) +a_1\\times n = sum\\\\\na_1=\\frac{sum-\\sum_{i=1}^{M-1}d_iw_1(i)}{n},a_x=a_1 +\\sum_{i=1}^{M-1}d_iw_2(i)\n$$\n\u90a3\u4e48\u7ed3\u5408\u4e0a\u9762\u4e24\u79cd\u7b97\u6cd5\uff0c\u590d\u6742\u5ea6\u964d\u5230 $O(T(n\\times \\min(n,q\\log_2^{k})+q\\log_2^k))$ \u3002\n\n\u5bf9\u4e8e\u5b9e\u73b0\uff0c\u53ef\u4ee5\u53c2\u8003 ZJ-001\uff0czhr \u5927\u4f6c\u7684\u4ee3\u7801\uff0c\u4e0d\u8fc7\u4ee3\u7801\u4e2d\u7684 map \u53ef\u4ee5\u6539\u6210\u6570\u7ec4\u4f18\u5316\u3002\n\n### 80pt\n\n\u90a3\u4e48\u590d\u6742\u5ea6\u74f6\u9888\u4e3b\u8981\u5728\u4e8e\u6bcf\u6b21\u8be2\u95ee\u90fd\u9700\u8981\u6c42\u4e00\u904d\u5dee\u5206\u6570\u7ec4 $d$\u3002\u4f46\u7531\u4e8e\u7cfb\u6570\u6570\u7ec4 $w_1(i)$ \u548c $w_2(i)$ \u7684\u5b58\u5728\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u53ea\u9700\u8981\u77e5\u9053 $w_1(i)\\times d_i$ \u548c $w_2(i) \\times d_i$ \u503c\u5373\u53ef\uff0c\u6211\u4eec\u8003\u8651\u539f\u5dee\u5206\u6570\u7ec4\u4e2d\u7684 $d_i$ \u53d8\u6362\u5230\u4e86\u65b0\u5dee\u5206\u6570\u7ec4\u7684\u54ea\u4e2a\u4f4d\u7f6e\u3002\n\n\u6211\u4eec\u8bbe\u7f6e\u6362\u4e3a $f$\uff0c\u5373 $f(i)=i\\times 2\\ (mod\\ 2(M-1)+1)$\u3002\u56e0\u4e3a\u8fd9\u4e2a $\\times 2$ \u8fd8\u662f\u8fc7\u4e8e\u788d\u773c\uff0c\u8003\u8651\u53bb\u6389\u4ed6\u3002\u90a3\u4e48\u5206\u6790\u7f6e\u6362\u7684\u6027\u8d28\u2014\u2014\u4ed6\u53ef\u4ee5\u62c6\u6210\u82e5\u5e72\u4e2a\u957f\u5ea6\u4e0d\u76f8\u4ea4\u7684\u7f6e\u6362\u73af\u3002\u90a3\u4e48\u5bb9\u6613\u53d1\u73b0\u4e00\u6b21\u7f6e\u6362\u540e\u6240\u6709\u6570\u90fd\u5728\u7f6e\u6362\u73af\u4e0a\u524d\u8fdb\u4e86\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u5373 $\\times 2$ \u53d8\u6210\u4e86 $+1$\uff0c\u90a3\u4e48\u8fd9\u5c31\u6709\u64cd\u4f5c\u7a7a\u95f4\u4e86\u3002\n\n\u6211\u4eec\u628a\u6240\u6709\u7684\u7f6e\u6362\u73af\u62ce\u51fa\u6765\u3002\u8bbe\u957f\u5ea6\u4e3a $C$\uff0c\u5e76\u628a\u73af\u5185\u7684\u6570\u91cd\u65b0\u6807\u53f7\u4e3a $0$ ~ $C-1$\uff08\u4e3a\u4e86\u65b9\u4fbf\u53d6\u6a21\uff09\uff0c\u5f53\u73af\u4e0a\u7684 $i$ \u53f7\u70b9\u5728\u539f\u5dee\u5206\u6570\u7ec4\u4e2d\u7684\u7f16\u53f7\u4e3a $x$ \u65f6\uff0c$w_1'(i)=w_1(x)$\uff0c$w_2'(i)=w_2(x)$\uff0c$  d'(i)=d(x)$\u3002\u90a3\u4e48\u5728\u8fd9\u4e2a\u73af\u5185\u7684\u65b0\u7f6e\u6362\u5c31\u662f $f'(i) = i+1\\ mod\\ C$\u3002\u663e\u7136\uff0c\u53d8\u6362 $k$ \u6b21\u540e $i$ \u7684\u4f4d\u7f6e\u5c31\u662f $f'^k(i)=f(f(...f(i)))=i+k\\ mod C$\u3002\u90a3\u4e48\u6211\u4eec\u6240\u9700\u8981\u6c42\u7684\u7b54\u6848\uff1a\u53d8\u6362\u4e00\u6b21\u3001\u4e24\u6b21\u3001$k$ \u6b21\u540e\u7684 $\\sum_{i=0}^{C} w_1'(f\u2019^k(i)) \\times d'_i$\uff0c$\\sum_{i=0}^{C} w_2'(f\u2019^k(i))\\times  d'_i$\u3002\u7531\u4e8e\u5faa\u73af\u7f6e\u6362\u73af\u7684\u5468\u671f\u4e3a $C$\uff0c\u8003\u8651\u5230\u5316\u7b80\u540e\u6709:\n$$\n\\sum_{k=0}^{C}\\sum_{i=0}^{C} w_1'(i+k\\ mod\\  C)\\times  d'_i,\\sum_{i=0}^{n} w_2'(i+k\\ mod\\  C)\\times d'_i\n$$\n\u5982\u679c\u66b4\u529b\u6c42\u7684\u8bdd\u590d\u6742\u5ea6\u8fd8\u662f\u6ca1\u6709\u964d\u4f4e\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u6709\u4e00\u4e2a\u5e38\u7528\uff08\u6211\u4e0d\u4f1a\uff09\u7684 $fft$ \u5316\u7b80\u6280\u5de7\u3002\u628a\u4e0a\u9762\u7684\u95ee\u9898\u62bd\u8c61\u4e00\u4e0b\uff0c\u6709\uff1a\n$$\nans_i=\\sum_{j=0}^{n-1}f(j)\\times g(i+j\\ mod\\ n)\n$$\n\u5148\u8003\u8651\u7ffb\u8f6c $g$\uff0c\u7ffb\u8f6c\u540e\u4e3a $ g' $\uff0c\u5373 $g'(i)=g(n-i-1)$,\u6709\uff1a\n$$\nans_i=\\sum_{j=0}^{n-1}f'(j)\\times g(n-i-1-j\\ mod\\ n)\\\\\n=\\sum_{j=0}^{n-i-1}f'(j)\\times g(n-i-1-j)+\\sum_{j=n-i}^{n-1}f'(j)\\times g(2n-i-1-j)\\\\\n=\\sum_{j=0}^{n-i-1}f'(j)\\times g(n-i-1-j)+\\sum_{j=n-i}^{2n-i-1}f'(j)\\times g(2n-i-1-j)\n$$\n\u5bf9\u4e8e\u6700\u540e\u4e00\u4e2a\u5f0f\u5b50\uff0c\u6ce8\u610f\u5230\u5f53 $j>n$ \u65f6\uff0c$f'(j)=0$\u3002\u6240\u4ee5\u662f\u6b63\u786e\u7684\u3002\u800c\u6700\u7ec8\u5f0f\u5b50\u6b63\u662f\u5bf9 $t=f\\times g$ \u7684\u7b2c $t_i$ \u548c\u7b2c $t_{2n-i-1}$ \u9879\u76f8\u52a0\uff0c\u5373\u5faa\u73af\u5377\u79ef\u3002\n\n~~\u5f53\u7136\u4e5f\u53ef\u4ee5\u7528\u4efb\u610f\u957f\u5ea6\u5faa\u73af\u5377\u79ef\u6765\u641e~~\u3002\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u7528 $O(ClogC)$ \u7684\u65f6\u95f4\u6765\u786e\u5b9a $ k\\ mod\\ C $ \u65f6\u6bcf\u4e00\u9879\u7684\u8d21\u732e\uff08\u5373 $ans_{k\\ mod\\ C}$\uff09\u3002\u6211\u4eec\u53d1\u73b0\u5bf9\u4e8e\u957f\u5ea6\u76f8\u540c\u7684\u5faa\u73af\u7f6e\u6362\u73af\uff0c\u4ed6\u4eec\u7684\u5faa\u73af\u8282\u957f\u5ea6\u76f8\u540c\u3002\u5e76\u4e14\u5bf9\u4e8e\u6bcf\u4e2a\u7f6e\u6362\u73af\uff0c\u4ed6\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u662f\u72ec\u7acb\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u628a\u76f8\u540c\u7684\u5faa\u73af\u8282\u7684\u7f6e\u6362\u73af\u5e76\u5728\u4e00\u8d77\u8ba1\u7b97\u3002\u90a3\u4e48\u6570\u91cf\u7ea7\u662f $\\sqrt{2(M-1)}$ \u7ea7\u522b\u7684\u3002\uff08$1+2.....+\\sqrt M \\approx M$ \uff09\u7531\u4e8e\u603b\u957f\u5ea6\u4e0d\u8d85\u8fc7 $2(M-1)$\uff0c\u56e0\u6b64\u590d\u6742\u5ea6\u4e3a:$O(T(n\\log_2^n + q\\sqrt n+q\\log_2^k)$\u3002\u53ef\u4ee5\u901a\u8fc7\u7b2c $14$ ~ \u7b2c $16$ \u4e2a\u6d4b\u8bd5\u70b9\u3002\n\n### 80 pt\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5bf9\u4e8e\u7f6e\u6362\u73af\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u5143\u7d20\uff0c\u6ee1\u8db3 $f^k(i)=i\\ (mod\\ 2(M-1)+1)$ \u7684\u6700\u5c0f\u7684\u6b63\u6574\u6570 $k$ \u5c31\u662f\u7f6e\u6362\u73af\u7684\u957f\u5ea6\uff08\u5373\u9636\uff09\u3002\u5e26\u5165 $f$\uff0c\u53ef\u5f97 $i\\times 2^k = i\\ (mod\\ 2(M-1)+1)$\u3002\u800c\u5bf9\u4e8e\u6574\u4e2a\u7f6e\u6362\u7684\u9636 $r$\uff0c\u6ee1\u8db3 $\\forall i\\in [1,2(M-1)],2^r\\times i=i\\ (mod\\ 2(M-1))$, \u56e0\u4e3a\u6709 $k\\le r$\uff08\u5426\u5219 $k=r$\uff09\uff0c\u90a3\u4e48\u663e\u7136\u6709 $k|r$\u3002~~\u53cd\u8bc1\u6cd5\u8bfb\u8005\u81ea\u8bc1\u4e0d\u96be~~\u3002\n\n>  \u753b\u56fe\u4e5f\u5f88\u5bb9\u6613\u7406\u89e3\u3002\u5bf9\u4e8e\u4e00\u4e2a\u7f6e\u6362\u73af\uff0c\u6ee1\u8db3\u73af\u4e0a\u7684\u5143\u7d20\u5404\u4e0d\u76f8\u540c\uff0c\u4e5f\u5c31\u662f\u8bf4\u82e5\u6ee1\u8db3\u6761\u4ef6\u5219\u5fc5\u987b\u6070\u597d\u7ed5\u5b8c\u6574\u4e2a\u73af\uff0c\u90a3\u4e48\u5c31\u663e\u7136\u6709\u6574\u9664\u4e86\u3002\n\n\u7531\u4e8e\u628a $1$ \u5e26\u5165\u4e0e\u6c42\u89e3 $r$ \u7684\u5f0f\u5b50\u76f8\u540c\uff0c\u6240\u4ee5 $1$ \u6240\u5728\u7684\u7f6e\u6362\u73af\u7684\u957f\u5ea6\u6700\u5927\u3002\u6240\u4ee5\u8be2\u95ee\u7684\u7b54\u6848\u53ef\u4ee5\u76f4\u63a5\u5148\u6a21 $r$\u3002\uff08\u56e0\u4e3a\u4ed6\u6ee1\u8db3\u662f\u6240\u6709\u5faa\u73af\u957f\u5ea6\u7684 $lcm$\uff09\n\n\u7531\u4e8e\u6a21 $2(M-1)$ \u7684\u5269\u4f59\u7cfb\u4e0b\u7684\u6570\u6700\u591a\u4e3a $2(M-1)$ \u4e2a\uff0c\u6240\u4ee5\u5faa\u73af\u957f\u5ea6\u662f\u4e0d\u8d85\u8fc7 $O(M)$ \u7ea7\u522b\u7684\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u6bcf\u7c7b\u957f\u5ea6\u76f8\u540c\u7684\u7f6e\u6362\u73af\uff0c\u6211\u4eec\u66b4\u529b\u8ba1\u7b97\u5728\u8d70 $k<r$ \u6b65\u4e4b\u540e\u7684\u8d21\u732e\u3002\n\n\u5219\u590d\u6742\u5ea6\u4e3a $O(T(n\\log_2^{n}+nd(n)+q\\log_2^k))$\uff0c\u5176\u4e2d $d(n)$ \u662f $n$ \u7684\u7ea6\u6570\u4e2a\u6570\u3002\n\n\u6839\u636e\u7ecf\u5178\u56fe\u7247\uff0c $d(n)$ \u7684\u590d\u6742\u5ea6\u5927\u7ea6\u53ef\u4ee5\u4f30\u8ba1\u6210\u4e09\u6b21\u6839\u53f7\u7ea7\u522b\uff1a\n\n[![Owrx41.jpg](https://s1.ax1x.com/2022/05/12/Owrx41.jpg)](https://imgtu.com/i/Owrx41)\n\n### 100 pt\n\n~~\u6211\u4ece\u6ca1\u6709\u89c1\u8fc7\u5361\u6c42\u9006\u5feb\u901f\u5e42\u7684\u51fa\u9898\u4eba\uff0c\u5dee\u8bc4\uff01~~\n\n~~\u76f4\u63a5\u5c11\u4e86 $20$ pt\uff0c\u597d\u8bc4\u3002~~\n\n\u7531\u4e8e\u6bcf\u6b21\u5faa\u73af\u90fd\u9700\u8981\u6c42 $\\frac{1}{2^k}$\uff0c\u9700\u8981 $\\log_2^k$  \u7684\u590d\u6742\u5ea6\u3002\u8003\u8651 $2$ \u5728\u6a21 $998244353$ \u4e0b\u7684\u9636\u4e3a $499122176$\u3002\u53ef\u4ee5\u7528\u5206\u5757\u9884\u5904\u7406 $2$ \u7684\u5e42\u6b21\u3002\u7ec6\u8282\u89c1\u4ee3\u7801\u3002\n\n\u590d\u6742\u5ea6\u4e3a $O(T(n\\log_2^{n}+nd(n)+q))$\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n## \u4ee3\u7801\u5b9e\u73b0\n\n\u7f15\u4e00\u904d\u8fc7\u7a0b\n\n- \u9884\u5904\u7406 $2$ \u7684\u5e42\u6b21\u548c\u9006\u5143\u7684\u5e42\u6b21\u3002\n- \u9884\u5904\u7406\u524d $t$ \u6b21\u53d8\u6362\u3002\n- \u6d53\u7f29\u6570\u7ec4\uff0c\u5904\u7406\u5dee\u5206\u6570\u7ec4\uff0c\u5904\u7406\u51fa $w_1$ \u548c $w_2\u3002$\n- \u627e\u51fa\u6bcf\u4e2a\u7f6e\u6362\u73af\u5e76\u7528 $NTT$ \u8ba1\u7b97\uff0c\u6876\u7edf\u8ba1\u3002\n- \u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\u8ba1\u7b97\u7b54\u6848\u3002\n\n\u7531\u4e8e\u6211\u7684\u4ee3\u7801\u662f\u8dd1\u7684\u6700\u6162\u7684\u4e00\u4e2a\uff0c\u8bf7\u614e\u91cd\u53c2\u8003\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define pb push_back\n#define int long long \nusing namespace std;\n//--------------------------------------------------------------------------------\nconst int N=2e6+1e3,mod=998244353;\nconst int G=3;\nint power(int x,int y,int t=1){for(;y;y>>=1,x=x*x%mod)if(y&1)t=t*x%mod;return t;}\nint Inv(int x){return power(x,mod-2);}\nconst int invG=power(G,mod-2);\nvoid ntt(int n,int *f,int *tr,bool pd)\n{\n    for(int i=0;i<n;i++)\n       if(i<tr[i])swap(f[i],f[tr[i]]);\n    for(int p=2;p<=n;p<<=1)\n    {\n        int len=p>>1,tg=power(pd?G:invG,(mod-1)/p);\n        static int buf[N];\n        buf[0]=1;\n        for(int i=1;i<=len;i++)buf[i]=buf[i-1]*tg%mod;\n        for(int k=0;k<=n;k+=p)\n        {\n            for(int l=k,y=0;l<k+len;l++,y++)\n            {\n                int tt=buf[y]*f[len+l]%mod;\n                f[len+l]=(f[l]-tt+mod)%mod;\n                f[l]=(f[l]+tt)%mod;\n            }\n        }\n    }\n    if(pd)return;\n    int tmp=Inv(n);\n    for(int i=0;i<n;i++)f[i]=f[i]*tmp%mod;\n}\nvoid times(int *f,int n,int *g,int m,int *ans)\n{\n    static int tr[N];tr[0]=0;\n    for(m+=n,n=1;n<=m;n<<=1);\n    for(int i=0;i<n;i++)tr[i]=(tr[i>>1]>>1|((i&1)?n>>1:0));\n    ntt(n,f,tr,1);ntt(n,g,tr,1);\n    for(int i=0;i<n;i++)ans[i]=f[i]*g[i]%mod;\n    ntt(n,ans,tr,0);\n}\n//--------------------------------------------------------------------------------\n//NTT \u677f\u5b50\n//--------------------------------------------------------------------------------\nconst int R=499122176;\nconst int B=sqrt(R)+100;\nint inv2;\nint pw1[N],pw2[N];\nint ipw1[N],ipw2[N];\nvoid Pre2()\n{\n    inv2=Inv(2);\n    pw1[0]=pw2[0]=ipw1[0]=ipw2[0]=1;\n    for(int i=1;i<=B;i++)pw1[i]=pw1[i-1]*2%mod,ipw1[i]=ipw1[i-1]*inv2%mod;\n    for(int i=1;i<=B;i++)pw2[i]=pw2[i-1]*pw1[B]%mod,ipw2[i]=ipw2[i-1]*ipw1[B]%mod;\n}\n//--------------------------------------------------------------------------------\n//\u9884\u5904\u7406 2 \u5373 2 \u7684\u9006\u5143\u7684 \u5e42\u6b21\n//--------------------------------------------------------------------------------\nint n,q,x,pd;\nint t,m,sum,r,invn;\n//n= 2^t \nint a[N],b[N];\nint pans[N];\n//k<= t \u65f6\u7684\u7b54\u6848\nint vis[N];\nint w1[N],w2[N],f1[N],f2[N],g1[N],g2[N],ans[N];\nint ans1[N],ans2[N];\nvector<int>len1[N],len2[N];\n\nint F(int x){return x*2%(m+1);}\nvoid Prepare()\n{\n    invn=Inv(n);\n    for(m=n;(m&1)==0;m>>=1)t++;\n    pans[0]=a[x]; \n    for(int i=1;i<=t+1;i++)\n    {\n        for(int j=1;j<=n;j++)b[j]=(a[(j+1)/2]+a[n-(j+1)/2+1])%mod;\n        for(int j=1;j<=n;j++)a[j]=b[j];\n        pans[i]=a[x];\n    }\n    if(m==1)return pd=1,void();\n    //\u6ce8\u610f\u7279\u5224 2 \u7684\u5e42\u6b21\n    m=0;x=(x+(1<<t+1)-1)/(1<<t+1);\n    //x \u5728\u6d53\u7f29\u540e\u7684\u4f4d\u7f6e\n    for(int i=1;i<=n;i++)sum=(sum+a[i])%mod;\n    for(int i=1;i<=n;i+=(1<<t+1))a[++m]=a[i];\n    for(int i=1;i<m;i++)b[i]=a[i+1]-a[i];\n    m--;\n    for(int i=m+1;i<=2*m;i++)b[i]=-b[2*m-i+1];    \n    //\u5dee\u5206\u6570\u7ec4\n    for(int i=1;i<x;i++)w2[i]=1;\n    for(int i=m,res=(1<<t);i>=1;i--,res+=(1<<t+1))w1[i]=res;\n    m*=2;\n    int tmp=2;r=1;while(tmp!=1){r++;tmp=F(tmp);}\n    for(int i=1;i<=m;i++)\n    {\n        if(vis[i])continue;\n        int tot=0,j=i;\n        while(!vis[j])\n        {\n            f1[tot]=f2[tot]=b[j];g1[tot]=w1[j];g2[tot++]=w2[j];\n            vis[j]=1;j=F(j);\n        }\n        //NTT\n        if(len1[tot].size()==0)len1[tot].resize(tot);len2[tot].resize(tot);\n        for(int i=tot;i<tot*6;i++)g1[i]=g2[i]=f1[i]=f2[i]=0;\n        reverse(g1,g1+tot);reverse(g2,g2+tot);\n\n        for(int j=0;j<tot*5;j++)ans[j]=0;\n        times(f1,tot,g1,tot,ans);\n        reverse(ans,ans+2*tot);\n        for(int j=0;j<tot;j++)len1[tot][j]=(len1[tot][j]+ans[j]+ans[j+tot])%mod;\n        for(int j=0;j<tot*5;j++)ans[j]=0;\n        times(f2,tot,g2,tot,ans);\n        reverse(ans,ans+2*tot);\n        for(int j=0;j<tot;j++)len2[tot][j]=(len2[tot][j]+ans[j]+ans[j+tot])%mod;\n        //NTT\n    }\n    for(int i=1;i<=r;i++)\n    {\n        if(len1[i].size()==0)continue;\n        for(int j=0;j<r;j++)ans1[j]=(ans1[j]+len1[i][j%i])%mod;\n        for(int j=0;j<r;j++)ans2[j]=(ans2[j]+len2[i][j%i])%mod;\n    }\n}\nint ask(int x,int opt)\n{\n    x%=R;\n    if(opt==0)return pw2[x/B]*pw1[x%B]%mod;\n    return ipw2[x/B]*ipw1[x%B]%mod;\n}\nint solve(int k)\n{\n    if(k<=t+1)return pans[k]*ask(k,1)%mod;\n    int pw=ask(k-t-1,0),inv=ask(k,1);\n    k=k-t-1;\n    if(pd)return inv*pw%mod*a[1]%mod;\n    k%=r;\n    int a1=invn*(sum*pw%mod-ans1[k])%mod;\n    int ax=(a1+ans2[k])%mod;\n    return ax*inv%mod;\n}\nvoid Clear()\n{\n    t=sum=r=pd=0;\n    for(int i=0;i<=n;i++)pans[i]=0;\n    for(int i=0;i<=n;i++)ans1[i]=ans2[i]=0;\n    for(int i=0;i<=n;i++)len1[i].clear(),len2[i].clear();\n    for(int i=0;i<=n;i++)vis[i]=0;\n    for(int i=0;i<=n;i++)w1[i]=w2[i]=0;\n}\nunsigned int rd(unsigned int &x){x^=(x<<13);x^=(x>>7);x^=(x<<17);return x;}\nsigned main()\n{\n    Pre2();\n    int test,T;\n    unsigned int seed;\n    scanf(\"%lld%lld%llu\",&test,&T,&seed);\n    for(int _=1;_<=T;_++)\n    {\n        int mxk,ans=0;\n        scanf(\"%lld%lld%lld%lld\",&n,&q,&x,&mxk);\n        for(int i=1;i<=n;i++)scanf(\"%lld\",&a[i]);\n        Clear();Prepare();\n        for(int i=1;i<=q;i++)\n        {\n            // int k;scanf(\"%lld\",&k);\n            int k=rd(seed)%mxk;\n            // printf(\"%lld\\n\",solve(k));\n            ans^=(((solve(k)%mod+mod)%mod)*i);\n        }\n        printf(\"%lld\\n\",ans);\n    }\n}\n```\n\n## \u540e\u8bb0\n\n\u90e8\u5206\u5206\u5206\u7684\u597d\u591a\n\n~~hzy \u5c0f\u59d0\u59d0\uff0c\u6211\u7231\u4f60\uff0c\u6211\u60f3\u505a\u4f60\u7684\u72d7\u3002~~\n\n[![OwoOtf.png](https://s1.ax1x.com/2022/05/12/OwoOtf.png)](https://imgtu.com/i/OwoOtf)",
        "postTime": 1652277201,
        "uid": 223891,
        "name": "max67",
        "ccfLevel": 0,
        "title": "P8332 [ZJOI2022] \u9762\u6761 \u9898\u89e3"
    },
    {
        "content": "\u548c\u5b98\u65b9\u9898\u89e3\u4e0d\u592a\u4e00\u6837\u7684\u63a8\u6cd5\uff08\u81ea\u5df1\u8ba4\u4e3a\u6bd4\u8f83\u81ea\u7136\n\n\u9996\u5148\u60f3\u8c61\u4e00\u6839\u4e0d\u62c9\u7684\u62c9\u9762\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u7ebf\u6bb5\u88ab\u7b49\u5206\u6210 $n$ \u4efd\uff0c\u6bcf\u4e00\u4efd\u4f9d\u6b21\u67d3\u4e0a $1,2,\\cdots,n$ \u8272\uff0c\u6bcf\u4e00\u6b21\u5c06\u8fd9\u4e2a\u7ebf\u6bb5\u5bf9\u6298\uff0c\u5bf9\u6298 $k$ \u6b21\u3002\u95ee\u9898\u53d8\u4e3a\u5bf9\u6298\u5b8c\u540e\u957f\u4e3a $\\frac{1}{2^k}$ \u7684\u7ebf\u6bb5\u7684 $\\frac{x}{n}$ \u5904\u6240\u542b\u7684 $2^k$ \u5c42\u4e2d\uff0c\u6bcf\u4e00\u79cd\u989c\u8272\u51fa\u73b0\u6b21\u6570\u7684\u52a0\u6743\u548c\u3002\n\n\u8fd9\u91cc\u53ef\u4ee5\u5148\u628a $n$ \u4e2d $2$ \u7684\u5e42\u6b21\u53bb\u6389\u53d8\u6210\u5947\u6570\uff0c$O(n \\log n)$ \u66b4\u529b\u6a21\u62df\u524d\u9762 $\\log n$ \u6b21\u6298\u53e0\uff0c\u4ee5\u4e0b\u63a8\u5bfc\u4e2d\u9ed8\u8ba4 $n$ \u662f\u5947\u6570\u3002\n\n\u6b64\u65f6\u4e0d\u53ef\u80fd\u518d\u7ea6\u5206\u4e86\uff0c\u6ce8\u610f\u5230\u6bcf\u4e00\u4e2a\u8d21\u732e\u5dee\u4e0d\u591a\u5c31\u662f $\\frac{2^k}{n}$\uff0c\u504f\u5dee\u7684 $1$ \u5177\u4f53\u662f\uff1a\n\n\u5148\u5dee\u5206\uff0c\u5dee\u5206\u5b8c\u540e\u5e94\u8be5\u8d21\u732e $[\\frac{i2^k+x}{n}](a_i-a_{i+1})$\uff0c\u4e0d\u7528\u53d6\u6574\u7684\u5f0f\u5b50\u662f\u5bb9\u6613\u8ba1\u7b97\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u6539\u4e3a\u8ba1\u7b97 $(i 2^k +x)\\bmod n \\times b_i$\uff0c\u5176\u4e2d $b$ \u662f $a$ \u7684\u5dee\u5206\u5e8f\u5217\u3002\u518d\u6ce8\u610f\u5230 $i2^k+x \\to i2^{k+1}+x$ \u8fd9\u4e2a\u6709\u5411\u56fe\u662f\u82e5\u5e72\u4e2a\u5708\u7684\u5e76\uff0c\u6bcf\u4e00\u4e2a\u5708\u957f\u5ea6\u90fd\u76f8\u540c\u4e3a $2$ \u6a21 $n$ \u7684\u9636\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u4e00\u4e2a\u5708\u90fd\u5206\u522b\u7b97\u4e00\u6b21\u5faa\u73af\u5377\u79ef\u6c42\u51fa\u6240\u6709\u672c\u8d28\u4e0d\u540c\u7684 $k$ \u7684\u7b54\u6848\uff0c\u518d\u628a\u6240\u6709\u5bf9\u5e94\u4f4d\u7f6e\u7684\u7b54\u6848\u52a0\u8d77\u6765\u5373\u53ef\u3002 \n\n\u5177\u4f53\u56de\u7b54\u8be2\u95ee\u7684\u65f6\u5019\u5229\u7528\u5149\u901f\u5e42\u5f88\u5bb9\u6613\u505a\u5230 $O(1)$\uff0c\u603b\u590d\u6742\u5ea6 $O(n\\log n +q)$\u3002",
        "postTime": 1652020156,
        "uid": 254752,
        "name": "JohnVictor",
        "ccfLevel": 6,
        "title": "ZJOI 2022 D2T1"
    },
    {
        "content": "\u597d\u725b\u903c\u554a\uff0c\u867d\u7136\u505a\u8fc7\u5154\u5b50\u8df3\u90a3\u9898\u4f46\u662f\u8fd8\u662f\u4e0d\u4f1a\u3002\u4e3a\u5565\u4f1a\u53bb\u5dee\u5206\u5462\uff1f\u4e3a\u5565\u8981\u53d1\u73b0\u662f\u4e58 2 \u5462\uff1f\n\n\u8003\u8651\u6267\u884c $t$ \u6b21\u64cd\u4f5c\u540e\uff08$2^t|n,2^{t+1}\\not| n$\uff09\uff0c\u6574\u4e2a\u5e8f\u5217\u4f1a\u53d8\u6210\u4e00\u4e9b\u957f\u5ea6\u4e3a $2^{t+1}$ \u7684\u6bb5\u548c\u4e00\u4e2a\u957f\u5ea6\u4e3a $2^t$ \u7684\u6bb5\u3002\u53ef\u4ee5\u53d1\u73b0\u4e4b\u540e\u4e00\u76f4\u4f1a\u4fdd\u6301\u6b64\u7ed3\u6784\uff0c\u6545\u6700\u7ec8\u7ed3\u679c\u662f $[a,a,b,b,c,c,d,d,e]$ \u8fd9\u6837\u5b50\u7684\u3002\u8003\u8651\u6267\u884c\u4e00\u6b21\u64cd\u4f5c\u540e\u53d8\u6210 $[a+e,a+e,a+d,a+d,b+d,b+d,b+c,b+c,2c,2c]$\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u7279\u522b\u725b\u903c\u7684\u4e00\u6b65\uff0c\u8003\u8651\u5bf9 $[a,b,c,d,e]$ \u8fd9\u4e2a\u6570\u7ec4\u6267\u884c\u5dee\u5206\uff0c\u770b\u5dee\u5206\u7684\u53d8\u5316\uff1a$[b-a,c-b,d-c,e-d]\\to [d-e,b-a,c-d,c-b]$\n\n\uff08\u8fd9\u4e00\u6b65\u7684 intuition \u662f\u5565\u5462\uff1f\u5176\u5b9e\u5f88\u5bb9\u6613\u53d1\u73b0\u7ecf\u8fc7\u51e0\u6b21\u64cd\u4f5c\u4e4b\u540e\u6574\u4e2a\u4f1a\u5f88\u5e73\u5747\uff0c\u7136\u540e\u5c31\u4f1a\u60f3\u53bb\u6bcf\u4e2a\u4f4d\u7f6e\u90fd\u51cf\u6389\u6700\u5c0f\u503c\u4e4b\u7c7b\u7684\u627e\u89c4\u5f8b\uff0c\u7136\u800c\u201c\u5dee\u5206\u201d\u5176\u5b9e\u4e5f\u662f\u5176\u4e2d\u4e00\u79cd\u5904\u7406\u65b9\u5f0f\uff09\n\n\u4e5f\u5373 $[b_1,b_2,b_3,b_4]\\to [-b_4,b_1,-b_3,b_2]$ \u8fd9\u6837\u3002\u8fd9\u5c31\u662f\u7f6e\u6362\u5f62\u5f0f\uff0c\u76f4\u63a5\u6c42\u5e42\u53ef\u4ee5\u505a\u5230 $O(qn)$\u3002\n\n\u63a5\u4e0b\u6765\u53c8\u662f\u5f88\u79bb\u8c31\u7684\u4e00\u6b65\uff0c\u8003\u8651\u628a\u6392\u5217\u8865\u5168\u6210\u8fd9\u6837\u5b50\uff1a$[b_1,b_2,b_3,b_4,-b_4,-b_3,-b_2,-b_1]$\uff08\u53ef\u80fd\u5e76\u4e0d\u9700\u8981\uff0c\u4f46\u8fd9\u6837\u66f4\u76f4\u89c2\uff09\uff0c\u7136\u540e\u53d8\u6210 $[-b_4,b_1,-b_3,b_2,-b_2,b_3,-b_1,b_4]$\u3002\n\n\u6ce8\u610f\u5230\u8fd9\u4e2a\u6392\u5217\u5176\u5b9e\u662f $[1,2,3,4,5,6,7,8]\\to [5,1,6,2,7,3,8,4]$\u3002\u6765\u8003\u8651 $1$ \u7684\u4f4d\u7f6e\u53d8\u5316\uff0c\u53d1\u73b0\u662f $1\\to 2\\to 4\\to 8\\to 7\\to 5\\to 1$ \u8fd9\u6837\uff0c*\u89c2\u5bdf\u5230* \u5c31\u662f $x\\to (2x\\bmod (2\\times 4+1))$\uff01\u6240\u4ee5\u8fd9\u4e2a\u201c\u7f6e\u6362\u201d\u5176\u5b9e\u5c31\u662f\u628a\u6bcf\u4e2a\u4f4d\u7f6e\u5728\u6a21 $2\\times n-1$ \u610f\u4e49\u4e0b\u4e58\u4e8c\uff0c\u4e5f\u5373\u6bcf\u4e2a\u7f6e\u6362\u73af\u7684\u5927\u5c0f\u90fd\u662f $\\varphi(2n-1)$ \u7684\u7ea6\u6570\uff08$2^{\\dots}=1$\uff09\u3002\n\n\uff08\u8349\uff0c\u8fd9\u4e00\u6b65\u6211\u771f\u7684\u4e0d\u61c2 intuition \u662f\u5565\uff0c\u6709\u6ca1\u6709\u4eba\u544a\u8bc9\u6211\uff01\uff09\n\n\u56e0\u4e3a\u7ed9\u51fa\u5dee\u5206\u6570\u7ec4 $b_1,b_2,\\dots,b_{n-1}$ \u4ee5\u53ca\u548c\uff08\u663e\u7136\u548c\u6bcf\u6b21\u7ffb\u500d\uff09\uff0c\u53ef\u4ee5\u6c42\u51fa $a_1=(S+\\sum b_i(n-i))/n$\uff0c$a_x=a_1+b_1+\\dots+b_{x-1}=S/n+\\sum_{i<x}b_i(2n-i)/n+\\sum_{i\\ge x}b_i(n-i)/n$\uff0c\u8bbe $w_i$ \u662f $i$ \u4f4d\u7f6e\u7684\u5dee\u5206\u5bf9 $x$ \u7684\u8d21\u732e\uff0c\u5219\u6bcf\u4e2a\u7f6e\u6362\u73af\u5185\u90e8\u7684\u8d21\u732e\u65b9\u5f0f\u5c31\u662f\u5faa\u73af\u5377\u79ef\u72b6\u7269\uff0c\u7528 FFT \u505a\u5230 $O(n\\log n)$\uff08\u603b\u5171\uff09\u3002\u7136\u540e\u5bf9\u4e8e\u6bcf\u79cd\u7f6e\u6362\u73af\u957f\u5ea6\uff0c\u7528 $O(n)$ \u7684\u65f6\u95f4\u5904\u7406\u51fa\u8fd9\u65f6\u5bf9\u6574\u4e2a\u957f\u4e3a $\\varphi(2n-1)$ \u7684\u5e8f\u5217\u7684\u603b\u8d21\u732e\uff0c\u8fd9\u90e8\u5206\u662f $O(nd(n))$\u3002$2^k$ \u7528\u5149\u901f\u5e42\u5904\u7406\uff0c\u8be2\u95ee\u5355\u6b21 $O(1)$\u3002\u603b\u590d\u6742\u5ea6 $O(n\\log n+nd(n)+q)$\u3002\n\nhttps://uoj.ac/submission/565383",
        "postTime": 1658474974,
        "uid": 42156,
        "name": "feecle6418",
        "ccfLevel": 0,
        "title": "ZJOI2022 \u9762\u6761"
    },
    {
        "content": "## \u601d\u8def\n\n\u9996\u5148\u8003\u8651\u5c06 $n$ \u53d8\u6210\u5947\u6570\u7684 $2$ \u500d\uff0c\u8fd9\u662f\u5e73\u51e1\u7684\uff0c\u53ea\u9700\u8981\u6267\u884c $\\log n$ \u6b21\u64cd\u4f5c\u5373\u53ef\u3002\n\n\u8fd9\u4e4b\u540e\u7684\u64cd\u4f5c\u4e2d\u5c31\u53ea\u4f1a\u6709 $\\lceil\\frac{n}{4}\\rceil$ \u4e2a\u4e0d\u540c\u7684\u8fde\u7eed\u6bb5\u3002\n\n\u7136\u540e\u8003\u8651\u5dee\u5206\u6570\u7ec4\u7684\u53d8\u5316\uff0c\u4f1a\u4ece $C,a_1,a_2,\\cdots,a_m$ \u53d8\u6210 $C',-a_m,a_1,-a_{m-1},a_2,\\cdots,-a_{\\frac{m+1}{2}}$\u3002\n\n\u7136\u540e\u6211\u4eec\u8003\u8651\u8fd9\u6837\u4e00\u4e2a\u6392\u5217 $a_1,a_2,\\cdots,a_m,-a_m,\\cdots,-a_2,-a_1$\u3002\n\n\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651\u8fd9\u4e2a\u6392\u5217\u7684\u82e5\u5e72\u6b21\u65b9\u4e4b\u540e\u7684\u524d $x$ \u9879\u548c $C'$ \uff0c\u8003\u8651\u600e\u4e48\u6c42\u51fa\u6765\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u6bcf\u4e00\u9879\u53d8\u6362\u5b8c\u4e86\u4e4b\u540e\u7684\u4e0b\u6807\u5c31\u53ea\u662f\u4e58 $2$ \u6a21 $n+1$ \u800c\u5df2\u2026\u2026\n\n\u4e8e\u662f\u7f6e\u6362\u73af\u957f\u5ea6\u80af\u5b9a\u662f $\\varphi(n+1)$ \u7684\u56e0\u6570\uff0c\u76f4\u63a5\u6bcf\u4e2a\u7f6e\u6362\u5355\u72ec\u505a\u5c31\u884c\u4e86\u3002\n\n\u5177\u4f53\u5730\uff0c\u8fd9\u5c31\u76f8\u5f53\u4e8e\u6bcf\u4e2a\u6570\u4f1a\u8fdb\u884c\u5faa\u73af\uff0c\u53ea\u6709\u5faa\u73af\u5230\u7279\u5b9a\u4f4d\u7f6e\u624d\u8ba1\u5165\u7b54\u6848\uff0c\u6c42\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u603b\u548c\u3002\n\n\u8fd9\u663e\u7136\u662f\u53ef\u4ee5\u76f4\u63a5 FFT \u7684\uff0c\u6c42 $C'$ \u4e5f\u53ef\u4ee5\u7c7b\u4f3c\u5730\u505a\uff0c\u53ea\u9700\u8981\u5c06\u5dee\u5206\u6570\u7ec4\u4e58\u4e0a\u53e6\u4e00\u4e9b\u7cfb\u6570\u5373\u53ef\u3002\n\n\u7136\u540e\u8fd9\u91cc\u65f6\u95f4\u590d\u6742\u5ea6 FFT \u7684\u90e8\u5206\u4e0d\u96be\u8bc1\u660e\u662f $O(n\\log n)$\uff0c\u6bd5\u7adf\u4e00\u5171 $O(n)$ \u4e2a\u4f4d\u7f6e\u8fd8\u8981\u62c6\u6210\u5f88\u591a\u7f6e\u6362\u3002\n\n\u6211\u7684\u4ee3\u7801\u76f4\u63a5\u5bf9\u4e8e\u6bcf\u4e2a\u7f6e\u6362\u90fd $O(\\varphi(n+1))$ \u5237\u4e86\u4e00\u904d\u8868\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u53ef\u80fd\u4e0d\u5bf9\uff1f\u4f46\u662f\u8fc7\u4e86\u3002\n\n\u6b63\u786e\u5b9e\u73b0\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log n+nd(n)+q)$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n//ZJOI is 2 hd 4 me\n#include<bits/stdc++.h>\n#define ll long long\n#define ull unsigned long long\nusing namespace std;\ninline int read()\n{\n    int r=0;\n    char c=getchar();\n    while(c<'0'||c>'9') c=getchar();\n    while(c>='0'&&c<='9') r=r*10+c-48,c=getchar();\n    return r;\n}\ninline ull calc(const ull&x){return x-(__uint128_t(x)*9920937979283557439ull>>93)*998244353;}\nconst int p=998244353,h=(p+1)>>1;\ninline ll qp(ll x,int y)\n{\n    ll res=1;\n    for(ll t=x; y; t=calc(t*t),y>>=1) \n    \tif(y&1) res=calc(res*t);\n    return res;\n}\nint rev[1<<23],N=1;\ninline void init()\n{\n    rev[0]=0,rev[1]=N>>1;\n    for(int i=2,d=N>>2; i<N; i<<=1,d>>=1)\n        for(int j=0; j<i; ++j) rev[i+j]=rev[j]+d;\n    return ;\n}\ninline void NTT(ll* F,int op)\n{\n    for(int i=0; i<N; ++i) if(rev[i]>i) F[i]^=F[rev[i]]^=F[i]^=F[rev[i]];\n    for(int len=2,M=1; len<=N; len<<=1,M<<=1)\n    {\n        ll w=qp(op?3:332748118,998244352/len);\n        for(int l=0; l<N; l+=len)\n        {\n            ll w0=1;\n            for(int i=l; i<l+M; ++i)\n            {\n                ll x=F[i],y=calc(w0*F[i+M]);\n                ((F[i]=x+y)>=p)&&(F[i]-=p),((F[i+M]=x-y)<0)&&(F[i+M]+=p),w0=calc(w0*w);\n            }\n        }\n    }\n}\ninline ull rd(ull &x) \n{\n\tx^=(x<<13),x^=(x>>7),x^=(x<<17);\n\treturn x;\n}\nint a[22][2000003],val[2000003],cur[2000003];\nll A1[2000003],A2[2000003],B[2000003];\nint f[2000003],g[2000003],w0[65536],w1[65536],W0[65536],W1[65536];\nbool vis[2000003];\ninline int q1(ull t){t%=998244352;return 1ll*w1[t>>16]*w0[t&65535]%p;}\ninline int q2(ull t){t%=998244352;return 1ll*W1[t>>16]*W0[t&65535]%p;}\nsigned main()\n{\n    ull seed,lim,v,ans;\n    int id=read(),T=read(),tmp=2,Tmp=1;\n    w0[0]=W0[0]=w1[0]=W1[0]=1;\n    for(int i=1; i<65536; ++i,(tmp<<=1)%=p) w0[i]=tmp;\n    Tmp=tmp;\n    for(int i=1; i<65536; ++i,tmp=1ll*tmp*Tmp%p) w1[i]=tmp;\n    tmp=h;\n    for(int i=1; i<65536; ++i,tmp=1ll*tmp*h%p) W0[i]=tmp;\n    Tmp=tmp;\n    for(int i=1; i<65536; ++i,tmp=1ll*tmp*Tmp%p) W1[i]=tmp;\n    scanf(\"%llu\",&seed);\n    while(T--)\n    {\n        int n=read(),q=read(),x=read(),N_=n,X=x,Bl=1,sz,L;\n        scanf(\"%llu\",&lim),ans=0;\n        while(!(N_&1)) N_>>=1,(++X)>>=1,Bl<<=1;\n        sz=N_>>1,L=N_-1,(++X)>>=1;\n        for(int i=1; i<=n; ++i) a[0][i]=read();\n        for(int s=1; s<=21; ++s)\n            for(int i=1; i<=(n>>1); ++i)\n                a[s][(i<<1)-1]=a[s][i<<1]=1ll*(a[s-1][i]+a[s-1][n+1-i])*h%p;\n        if(N_==1)\n        {\n        \tfor(int i=1; i<=q; ++i)\n\t        {\n\t            v=rd(seed)%lim;\n\t            if(v<=21) ans^=1ull*i*a[v][x];\n\t            else ans^=1ull*i*a[21][x];\n\t        }\n\t        printf(\"%llu\\n\",ans);\n\t        continue;\n        }\n        for(int i=1; i<=sz; ++i) \n        \tval[i]=(a[21][i*(Bl<<1)+1]+p-a[21][(i-1)*(Bl<<1)+1])%p,\n        \tval[(sz+1-i)+sz]=(p-val[i])%p;\n        for(int i=1; i<=L; ++i) vis[i]=0;\n        int len=1,num=2;\n        while(num!=1) ++len,((num<<=1)>N_)&&(num-=N_);\n        for(int i=0; i<len; ++i) f[i]=g[i]=0;\n        for(int i=1; i<=L; ++i) if(!vis[i])\n        {\n        \tint x=i,c=-1;\n        \twhile(!vis[x]) vis[x]=1,cur[++c]=x,((x<<=1)>N_)&&(x-=N_);\n        \tfor(int i=0; i<=c; ++i) B[c-i]=val[cur[i]];\n        \tfor(int i=0; i<=c; ++i) A1[i]=(cur[i]<X); \n        \tfor(int i=0; i<=c; ++i) A2[i]=cur[i]<=sz?(N_-(cur[i]<<1)):0;\n        \t++c;\n        \tfor(N=1;N<=(c<<1);N<<=1);\n        \tfor(int i=c; i<N; ++i) B[i]=A1[i]=A2[i]=0;\n        \tinit(),NTT(A1,1),NTT(A2,1),NTT(B,1);\n        \tfor(int i=0; i<N; ++i) A1[i]=1ll*A1[i]*B[i]%p;\n        \tfor(int i=0; i<N; ++i) A2[i]=1ll*A2[i]*B[i]%p;\n        \tNTT(A1,0),NTT(A2,0);\n        \tint o=qp(N,p-2);\n        \tfor(int i=0; i<N; ++i) A1[i]=1ll*A1[i]*o%p;\n        \tfor(int i=0; i<N; ++i) A2[i]=1ll*A2[i]*o%p;\n        \tassert(len%c==0);\n        \tfor(int i=0; i<c; ++i) A1[i]=(A1[i]+A1[c+i])%p;\n        \tfor(int i=0; i<c; ++i) A2[i]=(A2[i]+A2[c+i])%p;\n        \tfor(int i=0; i<len; ++i) f[i]=(f[i]+A1[(i+c-1)%c])%p;\n        \tfor(int i=0; i<len; ++i) g[i]=(g[i]+A2[(i+c-1)%c])%p;\n        \t\n        }\n        int Wandering=qp(N_,p-2),Singer=0;\n        assert(N_*Bl<=n);\n        for(int i=0; i<N_; ++i) Singer=(Singer+a[21][i*Bl+1])%p;\n        for(int i=1; i<=q; ++i)\n        {\n            v=rd(seed)%lim;\n            if(v<=21) ans^=1ull*i*a[v][x];\n            else ans^=1ull*i*\n            (\n            \t(\n            \t\t(\n            \t\t\t1ll*Singer*q1(v-21)%p+p-g[(v-21)%len]\n            \t\t)\n            \t\t*Wandering%p\n            \t\t+f[(v-21)%len]\n            \t)\n            \t*q2(v-21)\n            \t%p\n            ); \n        }\n        printf(\"%llu\\n\",ans);\n    }\n    return 0;\n}\n```",
        "postTime": 1653635966,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P8332"
    },
    {
        "content": "[P8332 [ZJOI2022] \u9762\u6761](https://www.luogu.com.cn/problem/P8332) \u89e3\u9898\u62a5\u544a\uff1a\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/xiaoziyao/p/16229785.html)\n\n## \u9898\u610f\n\n\u5b9a\u4e49\u5e8f\u5217 $a$ \u4e0a\u7684\u4e00\u6b21\u64cd\u4f5c\u4e3a\uff1a\n\n$$\\forall_{1\\leqslant i\\leqslant n} b_i\\leftarrow a_i+a_{n-i+1}$$\n$$\\forall_{1\\leqslant i\\leqslant n}a_i\\leftarrow \\frac{b_{\\lceil\\frac{i}{2}\\rceil}}{2}$$\n\n\u7ed9\u5b9a\u5e8f\u5217 $a$ \u4ee5\u53ca\u4e00\u4e2a\u4f4d\u7f6e $x$\uff0c$q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u6c42 $a$ \u5e94\u7528 $k_i$ \u6b21\u64cd\u4f5c\u540e\uff0c$a_x$ \u7684\u503c\u662f\u591a\u5c11\u3002\n\n## \u5206\u6790\n\n\u5de8\u5927\u5389\u5bb3\u9898\uff0c\u642c\u8fd0\u4e00\u4e0b\u5b98\u65b9\u9898\u89e3\uff01\n\n\u53ef\u80fd\u5199\u7684\u6709\u70b9\u53e3\u80e1\uff0c\u8865\u5b8c\u4ee3\u7801\u4e4b\u540e\u6765\u8865\u5145\u4e00\u4e0b\u3002\n\n\u5c06\u6700\u540e\u7b54\u6848\u9664\u4ee5 $2^k$\uff0c\u90a3\u4e48\u6211\u4eec\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\u5c31\u4e0d\u9700\u8981\u8981\u9664\u4e8c\u4e86\u3002\n\n\u6211\u4eec\u624b\u73a9\u4e00\u4e0b\u64cd\u4f5c\u8fc7\u7a0b\uff1a\n\n$$abcdefgh\\cdots z\\rightarrow aabbccdd\\cdots zz\\rightarrow\\cdots (a\\times 2^w)(b\\times 2^w)\\cdots(z\\times 2^w)\\rightarrow (a\\times 2^{t+1})(b\\times 2^{t+1})\\cdots(z\\times 2^t)$$\n\n\uff08\u5176\u4e2d\u4e00\u4e2a\u5b57\u6bcd\u5728\u4e0d\u540c\u9636\u6bb5\u4e0d\u4ee3\u8868\u76f8\u540c\u6570\u5b57\uff09\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ee4 $t$ \u4e3a $n$ \u6700\u4f4e\u975e\u96f6\u4f4d\uff0c\u90a3\u4e48\u6211\u4eec\u5e94\u7528 $t+1$ \u6b21\u64cd\u4f5c\u540e\uff0c\u4f1a\u53d8\u6210\u5f88\u591a\u4e2a\u957f\u5ea6\u4e3a $2^{t+1}$ \u7684\u76f8\u540c\u6bb5\uff0c\u6700\u540e\u63a5\u4e00\u4e2a\u957f\u5ea6\u4e3a $2^t$ \u7684\u76f8\u540c\u6bb5\u3002\n\n\u663e\u7136\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u64cd\u4f5c\u4e0e\u8be2\u95ee\u90fd\u53ef\u4ee5\u5728 $O(n\\log n)$ \u5185\u66b4\u529b\u6a21\u62df\u3002\n\n\u5c06\u957f\u5ea6\u4e3a $2^t$ \u7684\u76f8\u540c\u6bb5\u7f29\u6210\u4e00\u4e2a\u5b57\u6bcd\uff0c\u4ee4\u65b0\u7684\u5e8f\u5217\u4e3a $c_1,c_2\\cdots,c_m$\u3002\u8003\u5bdf\u63a5\u4e0b\u6765\u7684\u64cd\u4f5c\u9020\u6210\u7684\u5f71\u54cd\uff1a\n\n$$c_1,c_2,\\cdots,c_m\\rightarrow c_1+c_m,c_1+c_{m-1},c_2+c_{m-1},c_2+c_{m-2},\\cdots$$\n\n\u4ee4\u5dee\u5206\u6570\u7ec4\u4e3a $d$\uff0c\u90a3\u4e48\u64cd\u4f5c\u5c31\u4e3a\uff1a\n\n$$d_1,d_2,\\cdots,d_{m-1}\\rightarrow -d_{m-1},d_1,-d_{m-2},\\cdots$$\n\n\u90a3\u4e48\uff0c\u4e00\u6b21\u64cd\u4f5c\u5c31\u662f $d_1,d_2,\\cdots d_{m-1},-d_1,-d_2,\\cdots,-d_{m-1}$ \u7684\u4e00\u6b21\u7f6e\u6362\uff0c\u4ee4\u8fd9\u4e2a\u7f6e\u6362\u4e3a $g$\uff0c\u6211\u4eec\u8be2\u95ee\u7684\u7b54\u6848\u5c31\u662f\uff1a\n\n$$C+\\sum_{i=1}^{m-1}[g^k(i)<x]d_i=C+\\sum_{i=1}^{x-1}d_{g^{-k}(i)}$$\n\n$C$ \u53ef\u4ee5\u7b80\u5355\u8ba1\u7b97\u51fa\uff0c\u540e\u9762\u8fd9\u4e2a\u5f0f\u5b50\u8003\u8651\u62c6\u51fa\u6240\u6709\u7f6e\u6362\u73af\uff0c\u6bcf\u4e2a\u7f6e\u6362\u73af\uff08\u8bbe\u5927\u5c0f\u4e3a $c$\uff09\u901a\u8fc7\u4e00\u6b21\u5377\u79ef\u6c42\u51fa\u6240\u6709 $k\\in[0,c)$ \u7684\u7b54\u6848\u3002\n\n\u5c06\u5927\u5c0f\u76f8\u540c\u7684\u7f6e\u6362\u73af\u7684\u7b54\u6848\u52a0\u5230\u4e00\u8d77\uff0c\u6bcf\u6b21\u8be2\u95ee\u53ea\u9700\u8981\u679a\u4e3e $O(\\sqrt n)$ \u4e2a\u7f6e\u6362\u73af\u5c06\u7b54\u6848\u52a0\u8d77\u6765\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $O(n\\log n+q\\sqrt n)$\uff0c\u4e0d\u80fd\u901a\u8fc7\u3002\n\n\u7ee7\u7eed\u6316\u6398\u8fd9\u4e2a\u7f6e\u6362 $g$ \u7684\u6027\u8d28\uff08$g^{-1}$ \u4e0e $g$ \u6027\u8d28\u76f8\u540c\uff09\uff0c\u624b\u73a9\u53ef\u4ee5\u53d1\u73b0\u6240\u6709\u7f6e\u6362\u73af\u5927\u5c0f\u90fd\u662f $2$ \u5728 $2(m-1)$ \u4e0b\u7684\u9636 $r$ \u7684\u56e0\u6570\u3002\n\n\u4e5f\u5c31\u662f\u7b54\u6848\u5173\u4e8e $r$ \u662f\u5faa\u73af\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u5c06\u5927\u5c0f\u76f8\u540c\u7684\u7f6e\u6362\u73af\u52a0\u548c\u4e4b\u540e\uff0c\u76f4\u63a5\u7ef4\u62a4 $k\\in[0,r)$ \u7684\u7b54\u6848\u5c31\u597d\u4e86\u3002\n\n\u590d\u6742\u5ea6 $O(nd(n)+q)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002",
        "postTime": 1651832183,
        "uid": 35754,
        "name": "Verdandi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8332\u3010[ZJOI2022] \u9762\u6761\u3011"
    }
]