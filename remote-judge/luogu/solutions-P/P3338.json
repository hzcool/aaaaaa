[
    {
        "content": "[\u535a\u5ba2\u56ed\u98df\u7528\u901a\u9053](https://www.cnblogs.com/BaseAI/p/12042061.html)\n\n# \u9898\u76ee\u5730\u5740\n\n[\u6d1b\u8c37P3338](https://www.luogu.com.cn/problem/P3338)\n\n# Solution\n\n\u7b2c\u4e00\u9053FFT\u7684\u5e94\u7528AC\u796d\uff01\n\n\u6211\u4eec\u8981\u6c42:\n\n$$E_j=\\frac{F_j}{q_j}=\\sum_{i<j}\\frac{q_i}{(i-j)^2}-\\sum_{i>j}\\frac{q_i}{(i-j)^2}$$\n\n\uff08$q_j$ \u76f4\u63a5\u5728\u9664\u6cd5\u7684\u65f6\u5019\u6d88\u6389\u4e86qwq\uff09\n\n- ## Step 0 \u5377\u79ef\u662f\u4ec0\u4e48\uff1f\n\n\u9996\u5148\u6211\u4eec\u8981\u6709\u660e\u786e\u7684\u76ee\u6807\uff0c\u6211\u4eec\u8981\u628a\u4e0a\u9762\u7684\u5f0f\u5b50\u63a8\u6210\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u5c31\u8981\u6765\u56de\u987e\u4e00\u4e0b\u5377\u79ef\u662f\u4ec0\u4e48\u3002\u5377\u79ef\u7684\u5f62\u5f0f\u5982\u4e0b\uff1a\n\n$$C_k=\\sum_{i=0}^{k}A_i*B_{k-i}$$\n\n- ## Step 1 \u76f4\u63a5\u63a8\u5f0f\u5b50\n\n\u6709\u4e86\u76ee\u6807\uff0c\u6211\u4eec\u5c31\u597d\u6765\u63a8\u5f0f\u5b50\u4e86\uff08~~\u63a8\u5f0f\u5b50\u771f\u597d\u73a9~~\uff09\uff0c\u4e0b\u9762\u7ed9\u51fa\u63a8\u7406\u7684\u91cd\u8981\u6b65\u9aa4\uff0c\u5c3d\u91cf\u6ca1\u6709\u7e41\u7410\u7684\u6b65\u9aa4\uff0c\u8bfb\u8005\u53ef\u4ee5\u81ea\u5df1\u601d\u8003\u4e00\u4e0b\u3002\n\n$$E_j=\\sum_{i<j}\\frac{q_i}{(i-j)^2}-\\sum_{i>j}\\frac{q_i}{(i-j)^2}$$\n\n\u6539\u53d8\u4e00\u4e0b $\\sum$ \u7684\u4e0a\u4e0b\u6807\u8868\u793a\u5f62\u5f0f\uff0c\u539f\u5f0f\u53d8\u6210\n\n$$\\sum_{i=1}^{j-1}\\frac{q_i}{(i-j)^2}-\\sum_{i=j+1}^{n}\\frac{q_i}{(i-j)^2}$$\n\n\u5982\u679c $i=j$ \u4e5f\u7d2f\u52a0\u8fdb\u53bb\uff0c\u5bf9\u7b54\u6848\u4e0d\u5f71\u54cd\uff0c\u6240\u4ee5\u5f0f\u5b50\u53d8\u6210\n\n$$\\sum_{i=1}^{j}\\frac{q_i}{(i-j)^2}-\\sum_{i=j}^{n}\\frac{q_i}{(i-j)^2}$$\n\n\n- ## Step 2 \u8f6c\u5316\n\n\u8bbe $f[i]=q_i,g[i]=\\frac{1}{i^2}$ \uff0c\u6240\u4ee5\u539f\u5f0f\u53d8\u6210\n\n$$\\sum_{i=1}^{j}f[i]*g[j-i]-\\sum_{i=j}^{n}f[i]*g[i-j]$$\n\n\u4ee4 $f[0]=0,g[0]=0$\uff0c\u5219\u539f\u5f0f\u53d8\u6210\n\n$$\\sum_{i=0}^{j}f[i]*g[j-i]-\\sum_{i=j}^{n}f[i]*g[i-j]$$\n\n**\u8fd9\u65f6\u6211\u4eec\u53d1\u73b0\uff0c\u5de6\u8fb9\u5df2\u7ecf\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u6765\u63a8\u53f3\u8fb9**\n\n\u5c06 $\\sum_{i=j}^{n}f[i]*g[i-j]$ \u5c55\u5f00\uff0c\u53d1\u73b0\uff1a\n\n$$f[j]*g[0]+f[j+1]*g[1]+...+f[j+(n-j)]*g[n-j]$$\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c06\u539f\u5f0f\u5199\u6210\n\n$$\\sum_{i=0}^{n-j}f[j+i]*g[i]$$\n\n- ## Step 3 \u7ee7\u7eed\u8f6c\u5316\n\n\u5f15\u5165 $f'[i]=f[n-i]$ \uff0c\u5b9e\u9645\u4e0a\u8fd9\u662f\u4e00\u79cd\u7ffb\u8f6c\u7684\u5957\u8def\u3002\u5219\u539f\u5f0f\u53ef\u5199\u4e3a\n\n$$\\sum_{i=0}^{n-j}f'[n-(j+i)]*g[i]$$\n\n\u5373\n\n$$\\sum_{i=0}^{n-j}f'[n-j-i]*g[i]$$\n\n\u4ee4 $t = n-j$\uff0c\u5219\u539f\u5f0f\u7b49\u4e8e\n\n$$\\sum_{i=0}^{t}f'[t-i]*g[i]$$\n\n**\u81f3\u6b64\uff0c\u6211\u4eec\u6210\u529f\u7684\u628a\u4e24\u4e2a\u5f0f\u5b50\u5316\u6210\u4e86\u5377\u79ef\uff01\uff01\uff01**\n\n\u603b\u7ed3\u4e00\u4e0b\uff1a\n\n$$E_j=\\sum_{i=0}^{j}f[i]*g[j-i]-\\sum_{i=0}^{t}f'[t-i)]*g[i]$$\n\n- ## Step 4 $FFT$\u52a0\u901f\u5377\u79ef\n\n\u8bbe\u6709\u591a\u9879\u5f0f $A(x)=\\sum_{i=0}^{n}f[i]$ , $B(x)=\\sum_{i=0}^{n}g[i]$ , $C(x)=\\sum_{i=0}^{n}f'[i]$,\n\n\u6211\u4eec\u4ee4 $L(x)=A(x)*B(x)$ , $R(x)=C(x)*B(x)$\n\n\u6240\u4ee5 $Ans[i]=l_i - r_{n-i}$ \uff08$l_i,r_i$ \u5206\u522b\u662f\u591a\u9879\u5f0f $L(x)$ \u548c $R(x)$ $x^i$ \u7684\u7cfb\u6570\uff09\n\n- ## Step 5 \u8bfb\u5230\u8fd9\u91cc\uff0c\u4f60\u548c\u66b4\u529b\u9009\u624b\u8fd8\u6ca1\u6709\u5dee\u522b (\u9003\n\n> \u4e16\u754c\u4e0a\u5361\u4f60\u7cbe\u5ea6\u7684\u529e\u6cd5\u6709\u5343\u5343\u4e07\u4e07\u79cd\u3002                ----By me\n\n\u6ce8\u610f $g[i]=\\frac{1}{i^2}$\n\n\u697c\u4e3b\u5728\u5904\u7406\u8fd9\u91cc\u7684\u65f6\u5019\u5199\u7684\u662f ``1.0/(i*i*1.0)``\uff0c\u4ea4\u4e0a\u53bb\u53ea\u6709 $30pts$\u3002\n\n\u5728\u9898\u89e3\u4e2d\u770b\u5230\u5927\u4f6c\u4eec\u5904\u7406\u8fd9\u91cc\u65f6\u7528\u7684 ``(double)(1.0 / i / i)``\uff0c\u6539\u4e00\u4e0b\u540e\uff0c$100pts$\u3002\n\n**\u5982\u679c\u5927\u5bb6\u5bf9\u5904\u7406\u7cbe\u5ea6\u95ee\u9898\u6709\u4ec0\u4e48\u72ec\u7279\u7684\u89c1\u89e3\uff0c\u8bb0\u5f97\u548c\u6211\u5206\u4eab\u5206\u4eabQwQ**\n\n# Code\n\nTalk is cheap.Show me the code.\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ninline int read() {\n\tint x=0,f=1; char ch=getchar();\n\twhile(ch<'0' || ch>'9') { if(ch=='-') f=-1; ch=getchar(); }\n\twhile(ch>='0'&&ch<='9') { x=(x<<3)+(x<<1)+(ch^48); ch=getchar(); }\n\treturn x * f;\n}\nconst int N = 400007;\nconst double pi = acos(-1.0);\nint n;\nint rev[N];\nstruct CP {\n\tdouble x,y;\n\tCP operator + (CP el) { return (CP)<%x+el.x , y+el.y%>; }\n\tCP operator - (CP el) { return (CP)<%x-el.x , y-el.y%>; }\n\tCP operator * (CP el) { return (CP)<%x*el.x-y*el.y , x*el.y+y*el.x%>; }\n}a[N],b[N],c[N];\nvoid FFT(CP *A,int n,int flag) {\n\tfor(int i=0;i<n;++i) if(i < rev[i]) swap(A[i],A[rev[i]]);\n\tfor(int mid=1;mid<n;mid<<=1) {\n\t\tCP Wn = (CP)<%cos(2*pi/(mid<<1)) , flag*sin(2*pi/(mid<<1))%>;\n\t\tfor(int i=0;i<n;i+=(mid<<1)) {\n\t\t\tCP W = (CP)<%1 , 0%>;\n\t\t\tfor(int j=0;j<mid;++j,W=(W*Wn)) {\n\t\t\t\tCP tmp0 = A[i+j], tmp1 = W*A[i+mid+j];\n\t\t\t\tA[i+j] = tmp0 + tmp1;\n\t\t\t\tA[i+mid+j] = tmp0 - tmp1;\n\t\t\t}\n\t\t}\n\t}\n\tif(flag == -1) {\n\t\tfor(int i=0;i<n;++i) A[i].x /= n;\n\t}\n}\nint main()\n{\n\t//freopen(\"Li.txt\",\"r\",stdin);\n\t//freopen(\"My.out\",\"w\",stdout);\n\tn = read();\n\tfor(int i=1;i<=n;++i) {\n\t\tscanf(\"%lf\",&a[i].x);\n\t\tc[n-i].x = a[i].x;\n\t\tb[i].x = (double)(1.0 / i / i);\n\t}\n\tint lim = 1, L = 0; while(lim <= (n<<1)) lim <<= 1, ++L;\n\tfor(int i=0;i<lim;++i) rev[i] = (rev[i>>1]>>1) | ((i&1)<<(L-1));\n\tFFT(a,lim,1), FFT(b,lim,1), FFT(c,lim,1);\n\tfor(int i=0;i<lim;++i) a[i] = a[i]*b[i], c[i] = c[i]*b[i];\n\tFFT(a,lim,-1), FFT(c,lim,-1);\n\tfor(int i=1;i<=n;++i)\n\t\tprintf(\"%.3lf\\n\",a[i].x-c[n-i].x);\n\treturn 0;\t\n}\n/*\n5\n4006373.885184\n15375036.435759\n1717456.469144\n8514941.004912\n1410681.345880\n\n-16838672.693\n3439.793\n7509018.566\n4595686.886\n10903040.872\n*/\n```\n\n# Summary\n\n\u63a8\u7406\u8fc7\u7a0b\u5927\u90e8\u5206\u662f\u6211\u81ea\u5df1\u7684\u624b\u63a8\uff0c\u548c\u5176\u4ed6\u5927\u4f6c\u4e0d\u540c\u8bf7\u89c1\u8c05\uff0c~~\u6bd5\u7adf\u6761\u6761\u5927\u8def\u901a\u7f57\u9a6c\u5457~~\u3002\n\n\u8fc7\u7a0b\u4e2d\u7684\u8f6c\u6298\u70b9\u5c31\u662f\u6211\u63a8\u4e0d\u52a8\u7684\u65f6\u5019\uff0c\u6240\u8fd9\u4e2a\u9898\u76ee\u8ba9\u6211\u5b66\u4f1a\u4e86\uff1a\n\n- \u5377\u79ef (\u96fe \uff0c~~\u8981\u628a\u5f0f\u5b50\u63a8\u6210\u5377\u79ef\u5f62\u5f0f~~\n\n- \u5de7\u8bbe\u6570\u7ec4\u4ee3\u66ff\u62bd\u8c61\u7684\u6570\u5b66\u5f0f\u5b50\n\n- \u7ffb\u8f6c\u5e8f\u5217\u7684\u6280\u5de7\n\n\u6211\u591a\u9879\u5f0f\u8fd8\u662f\u592a\u83dc\u4e86\u5462\uff0c\u8d76\u7d27\u53bb\u505a\u9898\u5427\uff01QAQ\n\n**\u5404\u4f4d\u770b\u5b98\u770b\u5230\u6211\u8fd9\u4e2a\u591a\u9879\u5f0f\u5c0f\u767d\u5199\u4e86\u8fd9\u4e48\u591a\uff0c\u4e0d\u59a8\u70b9\u4e2a\u8d5e\u5427qwq\uff01**",
        "postTime": 1576375577,
        "uid": 147511,
        "name": "\u57fa\u5730A_I",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3338 \u3010[ZJOI2014]\u529b\u3011"
    },
    {
        "content": "$$ E_j = \\frac{F_j}{q_j} = \\sum_{i < j} \\frac{q_i}{(i - j) ^ 2} -\\sum_{i > j}\\frac{q_i}{(i - j) ^ 2}$$\n\u8bbe\n$$ f[i] = q_i,g[i] = \\frac{1}{i^2} $$\n\u5219\u539f\u5f0f\u53d8\u6210\n$$ \\sum_{i < j} f[i]g[j - i] -\\sum_{i > j} f[i]g[j - i]$$\n\u5373\n$$ \\sum_{i = 0}^{j - 1}f[i]g[j-i] - \\sum_{i = j + 1}^{n}f[i]g[j-i]$$\n\u8bbe$f'$ \u8868\u793a$f$ \u53cd\u5411\u540e\u7684\u503c\uff0c\u5219\u539f\u5f0f\u53ef\u5199\u6210\n$$ \\sum_{i = 0}^{j - 1}f[i]g[j - i] - \\sum_{i = 0}^{j - 1}f'[i]g[j-i]$$\n\u5bb9\u6613\u770b\u51fa\u6765\u8fd9\u5c31\u662f\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u76f4\u63a5FFT\u6c42\u5373\u53ef\n```cpp\n#include<cstdio>\n#include<cmath>\n#include<algorithm>\n\nusing namespace std;\n\nconst int N = 3e5 + 5;\nconst double PI = acos(-1);\n\nclass _comp {\n\tpublic:\n\t\tdouble r, i;\n    \n\t\t_comp(double r = 0.0, double i = 0.0) :\n\t\t\tr(r), i(i) {}\n\n\t\tfriend _comp operator + (_comp a, _comp b) {\n\t\t\treturn _comp(a.r + b.r, a.i + b.i);\n\t\t}\n\n\t\tfriend _comp operator - (_comp a, _comp b) {\n\t\t\treturn _comp(a.r - b.r, a.i - b.i);\n\t\t}\n\n\t\tfriend _comp operator * (_comp a, _comp b) {\n\t\t\treturn _comp(a.r * b.r - a.i * b.i, a.r * b.i + a.i * b.r);\n\t\t}\n} f[N], g[N];\n\nint r[N], n, fn;\ndouble p[N], q[N], t[N], a[N], b[N];\n\ninline int init() {\n\tint log_n = 0, fn;\n\tfor(fn = 1; fn < (n << 1); fn <<= 1) ++log_n;\n\tfor(int i = 0; i < fn; ++i)\n\t  r[i] = (r[i >> 1] >> 1) | ( (i & 1) << (log_n - 1) );\n\treturn fn;\n}\n\ninline void fft(_comp *a, int n, int op) {\n\tfor(int i = 0; i < n; ++i)\n\t  if(i < r[i]) swap(a[i], a[ r[i] ]);\n\n\tfor(int i = 1; i < n; i <<= 1) {\n\t\t_comp wn = _comp( cos(PI / i), op * sin(PI / i) );\n\t\tfor(int p = i << 1, j = 0; j < n; j += p) {\n\t\t\t_comp w = _comp(1, 0);\n\t\t\tfor(int k = 0; k < i; ++k, w = w * wn) {\n\t\t\t\t_comp x = a[j + k], y = w * a[i + j + k];\n\t\t\t\ta[j + k] = x + y, a[i + j + k] = x - y;\n\t\t\t}\n\t\t}\n\t}\n}\n\ninline void work(double *a, double *b, double *res) {\n\tfor(int i = 0; i < fn; ++i)\n\t  f[i].r = a[i], g[i].r = b[i],\n\t  f[i].i = 0, g[i].i = 0;\n\n\tfft(f, fn, 1), fft(g, fn, 1);\n\tfor(int i = 0; i < fn; ++i)\n\t  f[i] = f[i] * g[i];\n\n\tfft(f, fn, -1);\n\tfor(int i = 1; i <= n; ++i)\n\t\tres[i] = f[i].r / fn;\n}\n\nint main() {\n\tif(fopen(\"test.in\", \"r\")) {\n\t\tfreopen(\"test.in\", \"r\", stdin);\n\t\tfreopen(\"test.out\", \"w\", stdout);\n\t}\n\t\n\tscanf(\"%d\", &n);\n\tfn = init();\n\tfor(int i = 1; i <= n; ++i) {\n\t  scanf(\"%lf\", &p[i]);\n\t  t[i] = (double)(1.0 / i / i);\n\t  q[i] = p[i];\n\t}\n\t\n\treverse(p + 1, p + n + 1);\n\n\twork(q, t, a);\n\twork(p, t, b);\n\n\tfor(int i = 1; i <= n; ++i)\n\t  printf(\"%.3lf\\n\", a[i] - b[n - i + 1]);\n}\n\n```",
        "postTime": 1523606338,
        "uid": 31511,
        "name": "dormantbs",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3338 \u3010[ZJOI2014]\u529b\u3011"
    },
    {
        "content": "\u6211\u53d1\u73b0\u6211\u7684\u6784\u9020\u65b9\u6cd5\u597d\u50cf\u4e0d\u592a\u4e00\u6837\u800c\u4e14\u6bd4\u8f83\u663e\u7136\uff1f\u2026\u2026\u5148\u8bfb\u5165 $q$ \u6570\u7ec4\uff08\u4e0b\u8868\u4ece\u96f6\u5f00\u59cb\uff09\u3002\n\n\u8bb0 $i < j$ \u65f6\uff0c$a_{i-j}=-1/i^2$\uff1b$i > j$ \u65f6\uff0c$a_{i-j}=1/i^2$\uff1b$i = j$ \u65f6\uff0c$a_{i-j}=0$\u3002\n\n\u7b54\u6848 $E_i=\\sum_{j=0}^{n-1}a_{i-j}q_j$\uff0c\u53ef\u4ee5\u7528 FFT \u4f18\u5316\uff0c\u4e8e\u662f\u5c31\u505a\u5b8c\u4e86\u2026\u2026\u5417\uff1f\n\n\u53d1\u73b0 $a$ \u7684\u4e0b\u6807\u53ef\u80fd\u4f1a\u4e3a\u8d1f\uff0c\u90a3\u6211\u4eec\u5c31\u6574\u4f53\u5e73\u79fb\u4e00\u4e0b\uff0c\u4f7f\u5f97 $E_i=\\sum_{j=0}^{n-1}a_{i-j+n-1}q_j$\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u662f $E$ \u6570\u7ec4\u7684 $0+n-1 \\ldots n-1+n-1$ \u9879\u4e86\u3002\uff08\u539f\u5148\u662f $0 \\ldots n-1$ \u9879\uff09\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cmath>\nusing namespace std;\nint n, lim=1, limcnt, rev[524305];\ndouble q[100005];\nconst double PI=acos(-1.0);\nstruct Complex{\n\tdouble x, y;\n\tComplex(double u=0.0, double v=0.0){\n\t\tx = u; y = v;\n\t}\n\tComplex operator+(const Complex &u)const{\n\t\treturn Complex(x+u.x, y+u.y);\n\t}\n\tComplex operator-(const Complex &u)const{\n\t\treturn Complex(x-u.x, y-u.y);\n\t}\n\tComplex operator*(const Complex &u)const{\n\t\treturn Complex(x*u.x-y*u.y, x*u.y+y*u.x);\n\t}\n}a[524305], b[524305];\nvoid fft(Complex a[], int opt){\n\tfor(int i=0; i<lim; i++)\n\t\tif(i<rev[i])\n\t\t\tswap(a[i], a[rev[i]]);\n\tfor(int i=2; i<=lim; i<<=1){\n\t\tint tmp=i>>1;\n\t\tComplex wn=Complex(cos(2*PI/i), opt*sin(2*PI/i));\n\t\tfor(int j=0; j<lim; j+=i){\n\t\t\tComplex w=Complex(1.0, 0.0);\n\t\t\tfor(int k=0; k<tmp; k++){\n\t\t\t\tComplex tmp1=a[j+k], tmp2=w*a[j+k+tmp];\n\t\t\t\ta[j+k] = tmp1 + tmp2;\n\t\t\t\ta[j+k+tmp] = tmp1 - tmp2;\n\t\t\t\tw = w * wn;\n\t\t\t}\n\t\t}\n\t}\n\tif(opt==-1)\n\t\tfor(int i=0; i<lim; i++)\n\t\t\ta[i].x /= lim;\n}\nint main(){\n\tcin>>n;\n\tfor(int i=0; i<n; i++)\n\t\tscanf(\"%lf\", &b[i].x);\n\tfor(int i=-n+1; i<=n-1; i++){\n\t\tif(i<0)\n\t\t\ta[i+n-1].x = -1.0 / i / i;\n\t\telse if(i==0)\n\t\t\ta[i+n-1].x = 0;\n\t\telse\n\t\t\ta[i+n-1].x = 1.0 / i / i;\n\t}\n\twhile(lim<=3*(n-1))\tlim <<= 1, limcnt++;\n\tfor(int i=0; i<lim; i++)\n\t\trev[i] = (rev[i>>1]>>1) | ((i&1)<<(limcnt-1));\n\tfft(a, 1);\n\tfft(b, 1);\n\tfor(int i=0; i<lim; i++)\n\t\ta[i] = a[i] * b[i];\n\tfft(a, -1);\n\tfor(int i=0; i<n; i++)\n\t\tprintf(\"%.12f\\n\", a[i+n-1].x);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1527084347,
        "uid": 44733,
        "name": "poorpool",
        "ccfLevel": 0,
        "title": "luogu3338 [ZJOI2014]\u529b"
    },
    {
        "content": "$F_j=\\sum_{i<j}\\dfrac{q_i q_j}{(i-j)^2}-\\sum_{i>j}\\dfrac{q_i q_j}{(i-j)^2}=q_j \\times (\\sum_{i<j}\\dfrac{q_i}{(i-j)^2}-\\sum_{i>j}\\dfrac{q_i}{(i-j)^2})$\n\n$E_j=\\dfrac{F_j}{q_j}=\\dfrac{q_j \\times (\\sum_{i<j}\\dfrac{q_i}{(i-j)^2}-\\sum_{i>j}\\dfrac{q_i}{(i-j)^2})}{q_j}$\n\n$=q_i \\times \\sum_{i=1}^{j-1}\\dfrac{1}{(i-j)^2}-\\sum_{i=j-1}^{n}\\dfrac{1}{(i-j)^2}$\n\n\u8bbe$q_i=f(i)$\uff0c$\\dfrac{1}{i^2}=g(i)$\n\n\u539f\u5f0f\u53d8\u4e3a$\\sum_{i=1}^{j-1}*f(i)*g(j-i) - \\sum_{i=j-1}^{n}f(i)*g(i-j)$\n\n\u8bb0$\\sum_{i=1}^{j-1}*f(i)*g(j-i)$\u4e3a\u2460\u5f0f\uff0c$\\sum_{i=j-1}^{n}f(i)*g(i-j)$\u4e3a\u2461\u5f0f\u3002\n\n\u2460\u5f0f\u4e3a\u5377\u79ef\u5f62\u5f0f\uff0c\u800c\u2461\u5f0f\u53ef\u4ee5\u7ffb\u8f6c$f(i)$\uff0c\u53d8\u4e3a$\\sum_{i=1}^{j-1}f'(i)*g(j-i)$\uff0c\u663e\u7136\u4e5f\u662f\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u6545\u7528$FFT$\u4e00\u6ce2\u5e26\u8d70\u5373\u53ef\u3002\n\n\u53e6\u5916\u90a3\u4e2a$6e5$\u7684\u8303\u56f4\u6211\u731c\u662f\u7528\u4e00\u4e9b\u5947\u602a\u7684\u79d1\u6280\u6bd4\u5982bitset\u4f18\u5316\u4e4b\u7c7b\u7684\u505a\u5230$O(\\dfrac{n^2}{64})$\u7684\u590d\u6742\u5ea6\u2026\u2026\u8bf4\u4e0d\u5b9a\u677e\u4e00\u4e0b\u53ef\u4ee5\u8fc7\uff1f\uff08\u2190\u4e0d\u786e\u5b9a\u4e0d\u6562\u5984\u4e0b\u7ed3\u8bba\uff09\n\n\n```\n#include <iostream>\n#include <cstdio>\n#include <algorithm>\n#include <cmath>\n#include <cstring>\n#include <cctype>\n\nusing namespace std;\n\ninline int read()\n{\n\tint x=0,f=1;char ch=getchar();\n\twhile (!isdigit(ch)){if (ch=='-') f=-1;ch=getchar();}\n\twhile (isdigit(ch)){x=x*10+ch-48;ch=getchar();}\n\treturn x*f;\n}\n\nconst long double PI=acos(-1.0);\n\nstruct Complex\n{\n\tlong double x,y;\n}A[500050],B[500050],C[500050];\n\nComplex operator + (Complex a,Complex b)\n{\n    return {a.x+b.x,a.y+b.y};\n}\n\nComplex operator - (Complex a,Complex b)\n{\n    return {a.x-b.x,a.y-b.y};\n}\n\nComplex operator * (Complex a,Complex b)\n{\n    return {a.x*b.x-a.y*b.y,a.x*b.y+a.y*b.x};\n}\n\nint lim=1,l,r[4200000];\n\ninline void FFT(Complex *A,int type)\n{\n    for (int i=0;i<lim;i++)\n        if (i<r[i])\n            swap(A[i],A[r[i]]);\n    for (int mid=1;mid<lim;mid<<=1)\n    {\n        Complex Wn={cos(PI/mid),type*sin(PI/mid)};\n        for (int j=0;j<lim;j+=(mid<<1))\n        {\n            Complex W={1,0};\n            for (int k=0;k<mid;k++)\n            {\n                Complex x=A[j+k],y=W*A[j+mid+k];\n                A[j+k]=x+y;\n                A[j+mid+k]=x-y;\n                W=W*Wn;\t\n            } \n        }\n    }\n}\n\nint main()\n{\n\tint n=read();\n\tfor (int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%Lf\",&A[i].x);\n\t\tB[n+1-i].x=A[i].x;\n\t}\n\tfor (int i=1;i<=n;i++)\n\t\tC[i].x=(1.0/(long double)i)/(long double)i;\n\twhile (lim<=2*n)\n\t{\n\t\tlim<<=1;\n\t\tl++;\n\t}\n\tfor (int i=0;i<lim;i++)\n\t\tr[i]=(r[i>>1]>>1)|((i&1)<<(l-1));\n\tFFT(A,1);\n\tFFT(B,1);\n\tFFT(C,1);\n\tfor (int i=0;i<=lim;i++)\n\t{\n\t\tA[i]=A[i]*C[i];\n\t\tB[i]=B[i]*C[i];\n\t}\n\tFFT(A,-1);\n\tFFT(B,-1);\n\tfor (int i=0;i<=lim;i++)\n\t{\n\t\tA[i].x/=lim;\n\t\tB[i].x/=lim;\n\t}\n\tfor (int i=1;i<=n;i++)\n\t\tprintf(\"%.5Lf\\n\",A[i].x-B[n+1-i].x);\n\treturn 0;\n}\n```",
        "postTime": 1550481835,
        "uid": 8457,
        "name": "chen_zhe",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3338 \u3010[ZJOI2014]\u529b\u3011"
    },
    {
        "content": "# \u5e7f\u544a\n\n### [\u849f\u84bb\u306eblog](http://www.cnblogs.com/dedicatus545/p/8830852.html)\n\n# \u6b63\u6587\n\n\u628a\u8981\u6c42\u7684\u516c\u5f0f\u5217\u51fa\u6765\uff1a\n\n### $E_i=\\frac{F_i}{q_i}=\\sum_{j=1}^i\\frac{q_j}{\\left(i-j\\right)^2}-\\sum_{j=i+1}^n\\frac{q_j}{\\left(i-j\\right)^2}$\n\n\u4ee4$x_i=\\frac1{i^2}$\uff0c\u90a3\u4e48\n\n### $E_i=\\sum_{j=1}^iq_jx_{i-j}-\\sum_{j=i+1}^nq_jx_{j-i}$\n\n\u90a3\u6211\u4eec\u518d\u4ee4$p_i=q_{n-i+1}$\uff0c\u90a3\u4e48\n\n### $E_i=\\sum_{j=1}^iq_jx_{i-j}-\\sum_{j=i+1}^np_{n-j}x_{j-i}$\n\n\u6b64\u65f6\u6211\u4eec\u53d1\u73b0\u5f0f\u5b50\u7684\u5de6\u4fa7\u548c\u53f3\u4fa7\u90fd\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528FFT\u6765\u7ef4\u62a4\u8fd9\u4e2a\u8fc7\u7a0b\u4e86\n\n\u5c06\u6570\u5217$q_i$,$p_i$,$x_i$\u4f5c\u4e3a\u591a\u9879\u5f0f$A$,$B$,$C$\u7684\u7cfb\u6570\n\n\u5c06\u4ed6\u4eec\u7528fft\u4e58\u8d77\u6765\uff0c\u5f97\u5230\u7684$A\\ast C$,$B\\ast C$\u7684\u7cfb\u6570\u505a\u5dee\uff0c\u5c31\u662f$E_i$\u7684\u503c\n\n# Code:\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<cmath>\nstruct complex{\n    double x,y;\n    complex(double xx=0,double yy=0){x=xx;y=yy;}\n    complex operator +(const complex &b){return complex(b.x+x,b.y+y);}\n    complex operator -(const complex &b){return complex(-b.x+x,-b.y+y);}\n    complex operator *(const complex &b){return complex(x*b.x-y*b.y,x*b.y+y*b.x);}\n}A[410010],B[410010],C[410010];\nconst double pi=acos(-1.0);\nint n,limit=1,cnt=0,r[410010];\nvoid fft(complex *a,double type){\n    int i,mid,j,k,R;complex w,wn,x,y;\n    for(i=0;i<limit;i++) if(i<r[i]) std::swap(a[i],a[r[i]]);\n    for(mid=1;mid<limit;mid<<=1){\n        wn=complex(cos(pi/mid),type*sin(pi/mid));\n        for(R=mid<<1,j=0;j<limit;j+=R){\n            w=complex(1,0);\n            for(k=0;k<mid;k++,w=w*wn){\n                x=a[j+k];y=w*a[j+k+mid];\n                a[j+k]=x+y;\n                a[j+k+mid]=x-y;\n            }\n        }\n    }\n}\nint main(){\n    scanf(\"%d\",&n);int i;\n    for(i=1;i<=n;i++) scanf(\"%lf\",&A[i].x),B[n+1-i].x=A[i].x;\n    for(i=1;i<=n;i++) C[i].x=(1.0/double(i))/double(i);\n    \n    while(limit<=(n<<1)) limit<<=1,cnt++;\n    for(i=0;i<limit;i++) r[i]=((r[i>>1]>>1)|((i&1)<<(cnt-1)));\n    \n    fft(A,1);fft(B,1);fft(C,1);\n    for(i=0;i<=limit;i++) A[i]=A[i]*C[i],B[i]=B[i]*C[i];\n    fft(A,-1);fft(B,-1);\n    for(i=0;i<=limit;i++) A[i].x/=limit,B[i].x/=limit;\n    \n    for(i=1;i<=n;i++) printf(\"%.4lf\\n\",-B[n+1-i].x+A[i].x);\n}\n```",
        "postTime": 1523674725,
        "uid": 27753,
        "name": "Orion545",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3338 \u3010[ZJOI2014]\u529b\u3011"
    },
    {
        "content": "\u849f\u84bb\u535a\u5ba2\uff1a[QwQ](https://www.cnblogs.com/GoldenPotato/p/10288217.html)\n\n---\n# Solution\n\n~~\u5199\u5230\u8111\u58f3\u75bc\uff0c\u6211\u597d\u83dc\u554a~~\n\n\n\u6211\u4eec\u6765\u9893\u67ff\u5b50\u5427\n\n$F_j=\\sum_{i<j}\\frac{q_i*q_j}{(i-j)^2}-\\sum_{i>j}\\frac{q_i*q_j}{(i-j)^2}$\n\n$q_j$\u4e0e$i$\u6ca1\u6709\u534a\u6bdb\u94b1\u5173\u7cfb\uff0c\u63d0\u5230\u5916\u9762\u53bb\n\n$F_j=q_j*\\sum_{i<j}\\frac{q_i}{(i-j)^2}-q_j*\\sum_{i>j}\\frac{q_i}{(i-j)^2}$\n\n\u5de6\u53f3\u540c\u65f6\u9664\u4ee5$q_j$\n\n$E_j=\\sum_{i=1}^{j-1}\\frac{q_i}{(i-j)^2}-\\sum_{i=j+1}^{n}\\frac{q_i}{(i-j)^2}$\n\n\u6211\u4eec\u8bbe$f(i)=q(i),g(i)=\\frac{1}{i^2}$\uff0c\u6709\n\n$E_j=\\sum_{i=1}^{j-1}f(i)*g(i-j)-\\sum_{i=j+1}^{n}f(i)*g(i-j)$\n\n\u56e0\u4e3a$g(i)$\u662f\u4e2a\u5076\u51fd\u6570\uff0c\u56e0\u6b64\u6709\uff1a\n\n$E_j=\\sum_{i=1}^{j-1}f(i)*g(j-i)-\\sum_{i=j+1}^{n}f(i)*g(i-j)$\n\n\u8fd9\u65f6\u5019\uff0c\u6211\u4eec\u663e\u7136\u53ef\u4ee5\u53d1\u73b0\u5de6\u8fb9\u90a3\u4e2a\u5f0f\u5b50\u662f\u4e2a\u5377\u79ef\uff0c\u53f3\u8fb9\u7684\u8fd9\u6837\u4e00\u6ce2\u5316\u7b80\u5c31\u4e5f\u53d8\u6210\u4e86\u5377\u79ef\u5f62\u5f0f\uff1a\n![](https://cdn.luogu.com.cn/upload/pic/48846.png)\n\n\u5377\u79ef\u7528FFT\u5feb\u901f\u8ba1\u7b97\u5373\u53ef\n\n**\u65f6\u95f4\u590d\u6742\u5ea6$O(nlogn)$**\n\n---\n# Code\n```cpp\n//Luogu P3338 [ZJOI2014]\u529b\n//Jan,18th,2019\n//FFT\u52a0\u901f\u5377\u79ef\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<algorithm>\n#include<complex>\nusing namespace std;\ntypedef complex <double> cp;\nconst double PI=acos(-1);\nconst int M=100000+100;\nconst int N=8*M;\ninline cp omega(int K,int n)\n{\n\treturn cp(cos(2*PI*K/n),sin(2*PI*K/n));\n}\nvoid FFT(cp a[],int n,bool type)\n{\n\tstatic int len=0,num=n-1,t[N];\n\twhile(num!=0) len++,num/=2;\n\tfor(int i=0,j;i<=n;i++)\n\t{\n\t\tfor(j=0,num=i;j<len;j++)\n\t\t\tt[j]=num%2,num/=2;\n\t\treverse(t,t+len);\n\t\tfor(j=0,num=0;j<len;j++)\n\t\t\tnum+=t[j]*(1<<j);\n\t\tif(i<num) swap(a[i],a[num]);\n\t}\n\tfor(int l=2;l<=n;l*=2)\n\t{\n\t\tint m=l/2;\n\t\tcp x0=omega(1,l);\n\t\tif(type==true) x0=conj(x0);\n\t\tfor(int j=0;j<n;j+=l)\n\t\t{\n\t\t\tcp x=cp(1,0);\n\t\t\tfor(int k=0;k<m;k++,x*=x0)\n\t\t\t{\n\t\t\t\tcp temp=x*a[j+k+m];\n\t\t\t\ta[j+k+m]=a[j+k]-temp;\n\t\t\t\ta[j+k]=a[j+k]+temp;\n\t\t\t}\n\t\t}\n\t}\n}\nint n,m;\ndouble q[N];\ncp f[N],g[N],f2[N];\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%lf\",&q[i]);\n\t\t\n\tfor(int i=1;i<=n;i++)\n\t\tg[i]=(1.0/i/i);\n\tm=1;\n\twhile(m<2*n) m*=2;\n\tfor(int i=1;i<m;i++)\n\t\tf[i]=q[i],f2[i]=q[i];\n\t\n\tFFT(g,m,false);\n\tFFT(f,m,false);\n\treverse(f2+1,f2+n+1);\n\tFFT(f2,m,false);\n\tfor(int i=0;i<m;i++)\n\t\tf[i]*=g[i],f2[i]*=g[i];\n\tFFT(f,m,true);\n\tFFT(f2,m,true);\n\t\n\tfor(int i=1;i<=n;i++)\n\t\tprintf(\"%lf\\n\",(f[i].real()-f2[n-i+1].real())/m);\n\treturn 0;\n}\n\n```\n\n[1]:https://www.luogu.org/problemnew/show/P3338\n[2]:https://www.lydsy.com/JudgeOnline/problem.php?id=3527\n\n\n\n\n",
        "postTime": 1547799449,
        "uid": 52563,
        "name": "GoldenPotato137",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3338 \u3010[ZJOI2014]\u529b\u3011"
    },
    {
        "content": "\u5b66\u4e86$FFT$\u4e5f\u5feb\u6709\u4e24\u4e2a\u6708\u4e86\uff0c\u4e00\u76f4\u6ca1\u6709\u78b0\u5230\u53ef\u4ee5\u7528$FFT$\u4f18\u5316\u7684\u9898\u76ee\uff0c\u4eca\u5929\u7ec8\u4e8e\u78b0\u5230\u4e86\uff0c\u5199\u7bc7\u9898\u89e3\u6765\u7eaa\u5ff5\u4e0b\u3002\n\n\u9996\u5148\u6211\u4eec\u89c2\u5bdf\u5f0f\u5b50:\n\n$E_j= \\sum_{i=1}^{j-1} \\frac{q_i}{(i-j)^2}-\\sum_{i=j+1}^n \\frac{q_i}{(i-j)^2}$\n\n\u6211\u4eec\u5b9a\u4e49$f[i]=q[i]$\uff08~~\u4e3a\u4e86\u597d\u770b~~\uff09\uff0c$g[i]=\\frac{1}{i^2}$\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5c06\u539f\u5f0f\u5199\u6210\uff1a\n\n$E_j= \\sum_{i=1}^{j-1} f[i] \\times g[j-i]-\\sum_{i=j+1}^n f[i] \\times g[i-j]$\n\n\u8003\u8651\u5230$f[0]=0,g[0]=0$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5f0f\u5b50\u4e0e\u539f\u5f0f\u7b49\u4ef7:\n\n$E_j= \\sum_{i=0}^{j} f[i] \\times g[j-i]-\\sum_{i=j}^n f[i] \\times g[i-j]$\n\n\u8003\u8651\u5c06\u53f3\u8fb9\u7684\u5f0f\u5b50\u53d8\u5f62\uff1a\n\n$E_j= \\sum_{i=0}^{j} f[i] \\times g[j-i]-\\sum_{i=0}^{n-j} f[i+j] \\times g[i]$\n\n\u8003\u8651\u5230\u5de6\u8fb9\u7684\u5f0f\u5b50\u5df2\u7ecf\u662f\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u90a3\u4e48\u53f3\u8fb9\u53ea\u662f\u4e0e\u4e4b\u53cd\u5411\uff0c\u8003\u8651\u5c06$f$\u6570\u7ec4$reverse$\u3002\n\n$E_j= \\sum_{i=0}^{j} f[i] \\times g[j-i]-\\sum_{i=0}^{n-j} rev[n-(i+j)] \\times g[i]$\n\n\u6211\u4eec\u6362\u5143\uff1a$t=n-j$\u3002\n\n\n$E_j= \\sum_{i=0}^{j} f[i] \\times g[j-i]-\\sum_{i=0}^{t} rev[t-i] \\times g[i]$\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u5c31\u5c06\u5de6\u53f3\u4e24\u8fb9\u5316\u6210\u4e86\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u5206\u522b$fft$\u5373\u53ef\u3002\n",
        "postTime": 1580284407,
        "uid": 208081,
        "name": "MikukuOvO",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3338 \u3010[ZJOI2014]\u529b\u3011"
    },
    {
        "content": "\u8fd9\u7bc7\u9898\u89e3\u662f\u5199\u7ed9~~\u50cf\u6211\u8fd9\u6837~~\u521a\u5b66$FFT$\u5c31\u6765\u5199\u8fd9\u9898\u7684\u4eba\u3002\n\n\u5982\u679c\u4f60~~\u50cf\u6211\u4e00\u6837~~\u770b\u4e0d\u61c2\u9898\u89e3\uff0c\u8fd9\u7bc7\u53ef\u80fd\u4f1a\u7ed9\u4f60\u5e2e\u52a9\u3002\n\n\u9996\u5148\u4e00\u4e2a\u6570\u5217\u4f5c\u4e3a\u591a\u9879\u5f0f\u90fd\u8868\u793a\u7684\u662f\u7cfb\u6570\uff0c\u6bd4\u5982$a$\u6570\u7ec4\u8868\u793a\u7684\u662f\n$$a_0+a_1x+a_2x^2+\\cdots+a_nx^n$$\n\u8fd9\u6837\u7684\u591a\u9879\u5f0f\u3002\n\n\u7136\u540e\uff0c\u4e3a\u4ec0\u4e48\n$$\\sum_{j=1}^{i-1}\\frac{q_j}{(i-j)^2}$$\n\u80fd\u7528\u5377\u79ef\u8868\u793a\u5462\uff1f\n\n\u56e0\u4e3a\u5377\u79ef\u7684\u7b2c$i$\u9879\u8868\u793a$x^i$\u9879\u7684\u7cfb\u6570\uff0c\u8bbe$A\\times B=C$\uff0c\u5219\u6709\n\n$$c_i=\\sum\\limits_{j+k=i}a_j\\times b_k$$\n\n\u662f\u4e0d\u662f\u548c\u4e0a\u9762\u7684\u5f0f\u5b50\u5f88\u50cf\u5462\uff1f\n\n\u6240\u4ee5\u4ee4$A[i]=q[i],B[i]=\\frac{1}{i^2}$\uff0c$A\\times B$\u5f97\u5230\u7684$C[i]$\u5c31\u662f$\\sum_{j=1}^{i-1}\\frac{q_j}{(i-j)^2}$\n\n\u540e\u9762\u7684\u5c31\u540c\u7406\u4e86\u3002",
        "postTime": 1550040761,
        "uid": 61834,
        "name": "Huami360",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3338 \u3010[ZJOI2014]\u529b\u3011"
    },
    {
        "content": "$$F_j=\\sum_{i=1}^{j-1}\\frac{q_i\\times q_j}{(i-j)^2}-\\sum_{i=j+1}^{n}\\frac{q_i\\times q_j}{(i-j)^2}$$\n\n$$E_i=\\frac{F_i}{q_i}$$\n\n\u5c55\u5f00\u53ef\u5f97\n\n$$E_i=\\sum_{i=1}^{j-1}\\frac{q_i}{(i-j)^2}-\\sum_{i=j+1}^{n}\\frac{q_i}{(i-j)^2}$$\n\n\u4e0d\u59a8\u8bbe\n\n$$A(i)=\\sum_{j=1}^{i}\\frac{q_j}{(j-i)^2}$$\n\n$$B(i)=\\sum_{j=i+1}^{n}\\frac{q_j}{(j-i)^2}$$\n\n\u539f\u5f0f\u53d8\u4e3a\n\n$$E_i=A(i)-B(i)$$\n\n\u82e5\u6709\n\n$$q'_i=q_{n-i+1}$$\n\n(\u5373\u53cd\u8f6c\u5e8f\u5217)\n\n\u5219\u6613\u77e5\n\n$$B(i)=\\sum_{j=1}^{n-i}\\frac{q'_{j}}{(j-i)^2}$$\n\n\u8bbe\n\n$$g(i)=\\frac{1}{i^2}$$\n\n\u5219\u6709\n\n$$A(i)=\\sum_{j=1}^{i}g(j-i)\\times q_i$$\n\n$$B(i)=\\sum_{j=1}^{n-i}g(j-i)\\times q'_i$$\n\n\u6545\u53ef\u4ee5\u901a\u8fc7$\\text{FFT}$\u6765\u52a0\u901f\u6c42\u51fa$A(x)$\u4e0e$B(x)$\u7684\u65f6\u95f4\n\n$O(n)$\u9884\u5904\u7406$g(x),q'$,$O(n\\log n)$\u6c42\u51fa$A(x),B(x)$\uff0c$O(n)$\u5f97\u51fa$E_i(1\\leq i\\leq n)$\uff0c\u6545\u6e10\u8fdb\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a$O(n\\log n)$,\u5bf9\u4e8e$100000$\u7684\u6570\u636e\u5e94\u8be5\u80fd\u8fc7\u4e86\n\n\u4ee3\u7801(\u4ee3\u7801\u5df2\u7ecf\u7ecf\u8fc7clang-format\u683c\u5f0f\u5316\uff0c\u82e5\u6709\u9605\u8bfb\u4e0d\u9002\u8bf7\u89c1\u8c05)\n```cpp\n#include <bits/stdc++.h>\n//#include<bits/extc++.h>\nusing std::cerr;\nusing std::cin;\nusing std::cout;\nusing std::endl;\nusing std::swap;\nconst double Pi = acos(-1.0);\nstruct complex\n{\n    double x, y;\n    complex(double a = 0, double b = 0)\n    {\n        x = a, y = b;\n        return;\n    }\n} a[1000010], b[1000010];\ncomplex operator+(complex a, complex b)\n{\n    return complex(a.x + b.x, a.y + b.y);\n}\ncomplex operator-(complex a, complex b)\n{\n    return complex(a.x - b.x, a.y - b.y);\n}\ncomplex operator*(complex a, complex b)\n{\n    return complex(a.x * b.x - a.y * b.y, a.x * b.y + a.y * b.x);\n}\nint n;\nint l, r[10000010];\nint Limit = 1;\nvoid FFT(complex *A, int flag)\n{\n    for (int i = 0; i < Limit; i++)\n        if (i < r[i])\n            swap(A[i], A[r[i]]);\n    for (int j = 1; j < Limit; j <<= 1)\n    {\n        complex Wn(cos(Pi / j), flag * sin(Pi / j));\n        for (int k = 0; k < Limit; k += (j << 1))\n        {\n            complex W(1, 0);\n            for (int q = 0; q < j; q++, W = W * Wn)\n            {\n                complex x = A[k + q], y = W * A[j + k + q];\n                A[k + q] = x + y;\n                A[j + k + q] = x - y;\n            }\n        }\n    }\n}\ninline void init_fft()\n{\n    while (Limit <= (n << 1))\n        Limit <<= 1, l++;\n    for (int i = 0; i < Limit; i++)\n        r[i] = (r[i >> 1] >> 1) | ((i & 1) << (l - 1));\n}\ninline void mul(double *a, double *b, double *result)\n{\n    static bool inited = false;\n    if (!inited)\n        init_fft(), inited = true;\n    for (int i = 0; i < Limit; i++)\n        ::a[i].x = a[i], ::b[i].x = b[i], ::a[i].y = ::b[i].y = 0;\n    FFT(::a, 1);\n    FFT(::b, 1);\n    for (int i = 0; i < Limit; i++)\n        ::a[i] = ::a[i] * ::b[i];\n    FFT(::a, -1);\n    for (int i = 0; i < Limit; i++)\n        result[i] = ::a[i].x / Limit;\n}\ndouble q[100010 << 2], rev_q[100010 << 2], g[100010 << 2], A[100010 << 2], B[100010 << 2];\nint main()\n{\n    scanf(\"%d\", &n);\n    for (int i = 1; i <= n; i++)\n        scanf(\"%lf\", q + i),\n            g[i] = 1.0 / (double)i / (double)i;\n    memcpy(rev_q, q, sizeof rev_q);\n    std::reverse(rev_q + 1, rev_q + 1 + n);\n    mul(g, q, A);\n    mul(g, rev_q, B);\n    for (int i = 1; i <= n; i++)\n        printf(\"%.4lf\\n\", A[i] - B[n - i + 1]);\n}\n```",
        "postTime": 1579490046,
        "uid": 73552,
        "name": "Quank123Wip",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P3338 \u3010[ZJOI2014]\u529b\u3011"
    },
    {
        "content": "# \u9898\u76ee  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[\u70b9\u8fd9\u91cc](https://www.luogu.com.cn/problem/P3338)\u770b\u9898\u76ee\u3002  \n# \u5206\u6790\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$F$\u7684\u5f62\u5f0f\u770b\u7740\u6709\u4e9b\u590d\u6742\uff1b\u65e2\u7136\u9898\u76ee\u8981\u6c42\u6211\u4eec\u6c42\u51fa$E$\uff0c\u6211\u4eec\u5c31\u76f4\u63a5\u770b\u4e00\u770b$E$\u957f\u4ec0\u4e48\u4e9a\u5b50\uff1a  \n$$E_i=\\sum_{j<i}\\frac{q_j}{(i-j)^2}-\\sum_{j>i}\\frac{q_j}{(i-j)^2}$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u8003\u8651\u524d\u534a\u90e8\u5206\uff1a  \n$$E_i'=\\sum_{j<i}q_j\\frac1{(i-j)^2}$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u60f3\u529e\u6cd5\u914d\u51fa\u4e24\u4e2a\u51fd\u6570\u6765\u3002\u4ee4$f(i)=q_i$\uff0c$g(i)=\\frac1{i^2}$\uff0c\u5219\u6709\uff1a  \n$$E_i'=\\sum_{j=1}^{i-1}f(j)g(i-j)$$  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u5c31\u53ef\u4ee5\u53d1\u73b0$E'$\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u7528$FFT$\u3002\u5bf9\u4e8e\u540e\u9762\u90a3\u4e00\u534a\uff0c\u5c06$q$\u5012\u8fc7\u6765\u4e4b\u540e\u518d\u505a\u4e00\u904d\uff0c\u51cf\u6389\u5c31\u53ef\u4ee5\u4e86\u3002  \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u603b\u65f6\u95f4\u5c31\u662f$O(n\\log_2n)$\u3002  \n# \u4ee3\u7801\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <cstring>\n\n#define double long double\n\nconst double eps = 1e-6, PI = acos( -1 );\nconst int MAXN = 2e5 + 5;\n\ntemplate<typename _T>\nvoid read( _T &x )\n{\n    x = 0;char s = getchar();int f = 1;\n    while( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}\n    while( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}\n    x *= f;\n}\n\ntemplate<typename _T>\nvoid write( _T x )\n{\n    if( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }\n    if( 9 < x ){ write( x / 10 ); }\n    putchar( x % 10 + '0' );\n}\n\ntemplate<typename _T>\nvoid swapp( _T &x, _T &y )\n{\n\t_T t( x ); x = y, y = t;\n}\n\ntemplate<typename _T>\n_T sqr( _T x )\n{\n\treturn x * x;\n}\n\ntypedef struct complex\n{\n\tdouble r, i;\n\tcomplex(){} complex( const double R, const double I = 0 ) { r = R, i = I; }\n\tcomplex operator + ( const complex & b ) const { return complex( r + b.r, i + b.i ); }\n\tcomplex operator - ( const complex & b ) const { return complex( r - b.r, i - b.i ); }\n\tcomplex operator * ( const complex & b ) const { return complex( r * b.r - i * b.i, r * b.i + i * b.r ); }\n\tcomplex operator / ( const double & b ) const { return complex( r / b, i / b ); }\n\tvoid operator += ( const complex & b ) { *this = *this + b; }\n\tvoid operator -= ( const complex & b ) { *this = *this - b; }\n\tvoid operator *= ( const complex & b ) { *this = *this * b; }\n\tvoid operator /= ( const double & b ) { *this = *this / b; }\n}comp;\n\ncomp A[MAXN << 2], B[MAXN << 2], C[MAXN << 2];\ndouble q[MAXN], res[MAXN];\nint N, len;\n\nvoid init( const bool type ) \n{ \n\tfor( int i = 0 ; i <= len ; i ++ ) A[i] = B[i] = 0;\n\tfor( int i = 1 ; i <= N ; i ++ ) B[i] = 1.0 / i / i, A[i] = q[type ? i : N - i + 1];\n}\n\nvoid FFT( comp *coe, const int len, const int type )\n{\n\tint lg2 = log2( len );\n\tfor( int i = 0, rev ; i < len ; i ++ )\n\t{\n\t\trev = 0;\n\t\tfor( int j = 0 ; j < lg2 ; j ++ ) rev |= ( ( i >> j ) & 1 ) << ( lg2 - j - 1 );\n\t\tif( rev < i ) swapp( coe[rev], coe[i] );\n\t}\n\tcomp wp, w, we, wo;\n\tfor( int s = 2, p ; s <= len ; s <<= 1 )\n\t{\n\t\tp = s >> 1, wp = comp( cos( type * PI / p ), sin( type * PI / p ) );\n\t\tfor( int i = 0 ; i < len ; i += s )\n\t\t{\n\t\t\tw = comp( 1, 0 );\n\t\t\tfor( int j = 0 ; j < p ; j ++, w *= wp )\n\t\t\t{\n\t\t\t\twe = coe[i + j], wo = coe[i + j + p];\n\t\t\t\tcoe[i + j] = we + wo * w, coe[i + j + p] = we - wo * w;\n\t\t\t}\n\t\t}\n\t}\n\tif( ~ type ) return ;\n\tfor( int i = 0 ; i <= len ; i ++ ) coe[i] /= len;\n}\n\nvoid times( comp *ret, const int la, const int lb )\n{\n\tfor( int i = 0 ; i <= len ; i ++ ) ret[i] = 0;\n\tFFT( A, len, 1 ), FFT( B, len, 1 );\n\tfor( int i = 0 ; i <= len ; i ++ ) ret[i] = A[i] * B[i];\n\tFFT( ret, len, -1 );\n}\n\nint main()\n{\n\tread( N );\t\n\tlen = 1 << int( ceil( log2( N << 1 ) ) );\n\tif( len == N << 1 ) len <<= 1;\n\tfor( int i = 1 ; i <= N ; i ++ ) scanf( \"%Lf\", &q[i] );\n\tinit( true );\n\ttimes( C, N, N );\n\tfor( int i = 1 ; i <= N ; i ++ ) res[i] += C[i].r;\n\tinit( false ); \n\ttimes( C, N, N );\n\tfor( int i = 1 ; i <= N ; i ++ ) printf( \"%.3Lf\", ( res[i] - C[N - i + 1].r + eps ) ), putchar( '\\n' );\n\treturn 0;\n}\n```",
        "postTime": 1576730950,
        "uid": 123809,
        "name": "crashed",
        "ccfLevel": 0,
        "title": "[ZJOI2014]\u529b"
    },
    {
        "content": "# \u9898\u76ee\u94fe\u63a5\n[\u3010BZOJ\u3011](https://www.lydsy.com/JudgeOnline/problem.php?id=3527)  \n[\u3010\u6d1b\u8c37\u3011](https://luogu.org/problemnew/show/P3338)  \n[\u3010\u6211\u7684\u535a\u5ba2\u3011](https://www.cnblogs.com/chhokmah/p/10785747.html)\n# \u9898\u89e3\n\u9996\u5148\u6211\u4eec\u9700\u8981\u5bf9\u8fd9\u4e2a\u5f0f\u5b50\u8fdb\u884c\u5316\u7b80\uff0c\u5426\u5219\u5bf9\u7740\u8fd9\u4e48\u5927\u4e00\u5768\u4e1c\u897f\u53ea\u80fd\u66b4\u529b\u3002\u3002\u3002  \n\n-----\n$$F_i=\\sum_{j<i} \\frac{q_iq_j}{(i-j)^2}-\\sum_{j>i} \\frac{q_iq_j}{(i-j)^2}$$  \n\u6839\u636e\u9898\u76ee\u7ed9\u51fa\u7684\u5b9a\u4e49\uff0c\u5e26\u5165$E$\u4e2d  \n$$E_i=\\sum_{j=1}^{i-1}\\frac{q_j}{(i-j)^2}-\\sum_{j=i+1}^{n}\\frac{q_j}{(j-i)^2}$$ \n\u5f62\u5f0f\u7a0d\u5fae\u6539\u53d8\u4e86\u4e00\u4e0b\uff0c\u672c\u8d28\u4e00\u6837  \n\u9700\u8981\u5904\u7406\u8fd9\u4e2a\u5206\u6bcd\u4e0a\u7684\u4e24\u4e2a\u4e0d\u597d\u770b\u7684\u5c0f\u4e1c\u897f  \n\u8bbe$f_i=\\frac{1}{i^2}$  \n\u90a3\u4e48\u53ef\u4ee5\u5f97\u5230\u539f\u5f0f\u53d8\u6210\n$$E_i=\\sum^{i-1}_{j=1}q_jf_{i-j}-\\sum^n_{j=i+1}q_jf_{j-i}$$    \n\u5c06\u8fd9\u4e2a\u5f0f\u5b50\u62c6\u6210\u4e24\u90e8\u5206    \n\u5148\u8ba8\u8bba$-$\u53f7\u524d\u9762\u4e00\u90e8\u5206   \n\u53ef\u4ee5\u53d1\u73b0\uff0c\u51cf\u53f7\u524d\u4e00\u90e8\u5206\u5c31\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u90a3\u4e48\u76f4\u63a5`FFT`\u5957\u4e0a\u53bb\u5c31\u53ef\u4ee5\u4e86\u3002[\u3010FFT\u5b66\u4e60\u7b14\u8bb0\uff08\u4e07\u5b57\u5927\u7bc7\uff09\u3011](https://www.cnblogs.com/chhokmah/p/10658101.html)    \n\u5bf9\u4e8e\u540e\u4e00\u90e8\u5206\uff0c\u8ba4\u771f\u89c2\u5bdf\u53ef\u4ee5\u53d1\u73b0  \n\u5f62\u5f0f\u548c\u524d\u4e00\u90e8\u5206\u975e\u5e38\u76f8\u4f3c\uff0c\u5176\u5b9e\u5c31\u662f\u76f8\u53cd\u4e86\u4e00\u4e0b\u3002  \n\u6211\u4eec\u5c06\u539f\u6765\u7684\u6570\u7ec4\u5012\u5e8f\u5b58\u50a8\u4e00\u4e0b\uff0c\u548c\u524d\u4e00\u90e8\u5206\u505a\u4e00\u6837\u7684`FFT`\u5c31\u53ef\u4ee5\u4e86\u3002\n\n# \u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\n#define ms(a, b) memset(a, b, sizeof(a))\n#define ll long long\n#define ull unsigned long long\n#define ms(a, b) memset(a, b, sizeof(a))\n#define inf 0x3f3f3f3f\n#define db double\n#define Pi acos(-1)\n#define eps 1e-8\n#define N 400005\nusing namespace std;\ntemplate <typename T> T sqr(T x) { return x * x; }\ntemplate <typename T> void read(T &x) {\n    x = 0; T fl = 1; char ch = 0;\n    for (; ch < '0' || ch > '9'; ch = getchar()) if (ch == '-') fl = -1;\n    for (; ch >= '0' && ch <= '9'; ch = getchar()) x = (x << 1) + (x << 3) + (ch ^ 48);\n    x *= fl;\n}\ntemplate <typename T> T power(T x, T y, T mod) { T res = 1;  for (; y; y >>= 1) { if (y & 1) res = (res * x) % mod; x = (x * x) % mod; } return res; }\ntemplate <typename T> void write(T x) { if (x < 0) x = -x, putchar('-'); if (x > 9) write(x / 10); putchar(x % 10 + '0'); }\ntemplate <typename T> void writeln(T x) { write(x); puts(\"\"); }\nstruct Complex {\n    db x, y;\n    Complex (db xx = 0, db yy = 0) { x = xx; y = yy; }\n    Complex operator + (Complex B) { return Complex(x + B.x, y + B.y); }\n    Complex operator - (Complex B) { return Complex(x - B.x, y - B.y); }\n    Complex operator * (Complex B) { return Complex(x * B.x - y * B.y, x * B.y + y * B.x); }\n}a[N], b[N], c[N], d[N];\nint r[N];\nint n, m, limit, l;\nvoid FFT(Complex *a, int type) {\n    for (int i = 0; i < limit; i ++) if (i < r[i]) swap(a[i], a[r[i]]);\n    for (int mid = 1; mid < limit; mid <<= 1) {\n        Complex wn(cos(Pi / mid), type * sin(Pi / mid));\n        for (int R = mid << 1, j = 0; j < limit; j += R) {\n            Complex w(1, 0);\n            for (int k = 0; k < mid; k ++, w = w * wn) {\n                Complex x = a[j + k], y = w * a[j + mid + k];\n                a[j + k] = x + y; a[j + mid + k] = x - y;\n            }\n        } \n    }\n    if (type == -1) for (int i = 0; i < limit; i ++) a[i].x /= 1.0 * limit;\n}\nint main() {\n    read(n);\n    for (int i = 1; i <= n; i ++) {\n        db x; scanf(\"%lf\", &x);\n        a[i].x = c[n - i + 1].x = x; b[i].x = d[i].x = 1.0 / sqr(i * 1.0);\n    }\n    limit = 1; while (limit <= (n << 1)) limit <<= 1, l ++;\n    for (int i = 0; i < limit; i ++) r[i] = (r[i >> 1] >> 1) | ((i & 1) << (l - 1));\n    FFT(a, 1); FFT(b, 1);\n    for (int i = 0; i < limit; i ++) a[i] = a[i] * b[i];\n    FFT(a, -1);\n    FFT(c, 1); FFT(d, 1);\n    for (int i = 0; i < limit; i ++) c[i] = c[i] * d[i];\n    FFT(c, -1);\n    for (int i = 1; i <= n; i ++) printf(\"%.3lf\\n\", a[i].x - c[n - i + 1].x);\n    return 0;\n}\n\n```",
        "postTime": 1556448066,
        "uid": 35567,
        "name": "Ayers",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3338 \u3010[ZJOI2014]\u529b\u3011"
    },
    {
        "content": " [$$ \\Large \\texttt{My Blog} $$](http://blog.flyinthesky.win/bzoj3675/)\n\n------------\n\n\u8bbe$f(i)=q_i, g(i)=\\frac 1{i^2}$\n\n\u5219\n$$E_j=\\sum\\limits_{i=1}^{j-1} f(i)g(i-j) - \\sum\\limits_{i=j+1}^{n} f(i)g(i-j)$$\n\n\u56e0\u4e3a$g(i)$\u4e3a\u5076\u51fd\u6570\uff0c\u5219\n$$E_j=\\sum\\limits_{i=1}^{j-1} f(i)g(j-i) - \\sum\\limits_{i=j+1}^{n} f(i)g(i-j)$$\n\n\u90a3\u4e48\u524d\u9762\u662f\u4e00\u4e2a\u5377\u79ef\u5f62\u5f0f\uff0c\u540e\u9762\u53ef\u4ee5\u7ffb\u8f6c$f(i)$\u540e\u53d8\u4e3a\u53e6\u4e00\u4e2a\u5377\u79ef\u5f62\u5f0f\uff0cFFT \u8ba1\u7b97\u5373\u53ef\u3002\n\n```c++\n#include<cstdio> \n#include<cstring>\n#include<algorithm>\n#include<iostream>\n#include<cmath>\n#include<map>\n#include<vector>\n#define ms(i, j) memset(i, j, sizeof i)\n#define LL long long\n#define db double\n#define fir first\n#define sec second\n#define mp make_pair\nusing namespace std;\n\nnamespace flyinthesky {\n\n\tconst int MAXN = 300000 + 5;\n\tconst db PI = acos(-1);\n\n\tstruct C {\n\t\tdb r, i;\n\t\tC() {r = i = 0;}\n\t\tC(db x, db y) {r = x, i = y;}\n\t\tC operator + (C &x) {return C(r + x.r, i + x.i);}\n\t\tC operator - (C &x) {return C(r - x.r, i - x.i);}\n\t\tC operator * (C &x) {return C(r * x.r - i * x.i, x.i * r + x.r * i);}\n\t\tvoid operator += (C &x) {r += x.r, i += x.i;}\n\t\tvoid operator *= (C &x) {\n\t\t\tdb tr = r, ti = i;\n\t\t\tr = tr * x.r - ti * x.i;\n\t\t\ti = x.i * tr + x.r * ti;\n\t\t}\n\t} f[MAXN], g[MAXN];\n\t\n\tint m, n, r[MAXN];\n\tdb p[MAXN], q[MAXN], a[MAXN], b[MAXN], gg[MAXN];\n\n\tvoid FFT(C *a, int op) {\n\t\tfor (int i = 0; i < n; ++i)\n\t\t\tif (i < r[i]) swap(a[i], a[r[i]]);\n\t\tfor (int i = 1; i < n; i <<= 1) {\n\t\t\tC Wn = C(cos(PI / i), sin(PI / i) * op);\n\t\t\tfor (int j = 0; j < n; j += (i << 1)) {\n\t\t\t\tC w = C(1, 0), *a0 = a + j, *a1 = a0 + i;\n\t\t\t\tfor (int k = 0; k < i; ++k) {\n\t\t\t\t\tC t = *a1 * w;\n\t\t\t\t\t*a1 = *a0 - t, *a0 += t;\n\t\t\t\t\t++a0, ++a1, w *= Wn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tvoid pro(db *tf, db *tg, db *ret) {\n\t\tfor (int i = 0; i < n; ++i) \n\t\t\tf[i].r = tf[i], g[i].r = tg[i], f[i].i = 0, g[i].i = 0;\n\t\tFFT(f, 1), FFT(g, 1);\n\t\tfor (int i = 0; i < n; ++i) f[i] *= g[i];\n\t\tFFT(f, -1);\n\t\tfor (int i = 0; i <= m; ++i) ret[i] = (fabs(f[i].r) / n);\n\t}\n\n    void clean() {\n    \tms(r, 0);\n\t}\n    int solve() {\n\n    \tclean();\n    \tscanf(\"%d\", &n);\n    \tfor (int i = 1; i <= n; ++i) {\n    \t\tscanf(\"%lf\", &p[i]);\n    \t\tq[i] = p[i], gg[i] = 1.0 / i / i;\n\t\t}\n\t\t\n\t\treverse(q + 1, q + 1 + n);\n\t\t\n\t\tint l = 0;\n\t\tfor (m = n, n = 1; n <= m + m; n <<= 1, ++l);\n\t\t\n\t\tfor (int i = 0; i < n; ++i) r[i] = (r[i >> 1] >> 1) | ((i & 1) << (l - 1));\n\t\t\n\t\tpro(p, gg, a);\n\t\tpro(q, gg, b);\n\t\t\n\t\tfor (int i = 1; i <= m; ++i) printf(\"%.5f\\n\", a[i] - b[m - i + 1]);\n\n        return 0;\n    }\n}\nint main() {\n    flyinthesky::solve();\n    return 0;\n}\n```",
        "postTime": 1550212958,
        "uid": 12943,
        "name": "FlyInTheSky",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3338 \u3010[ZJOI2014]\u529b\u3011"
    },
    {
        "content": "f1=0\\*q1+(-1/1^2)\\*q2+(-1/2^2)\\*q3..(-1/(n-1)^2)\\*qn\n\nf2=(1/1^2)\\*q1+0\\*q2+(-1/1^2)\\*q3..\n\n\u5bf9\u4e8e\u7cfb\u65701/(n-1)^2..1/2^2,1/1^2,0,-1/1^2,-1/2^2..-1/(n-1)^2\n\n\u53d1\u73b0fi\u5c31\u662ffi-1\u5f80\u5de6\u79fb\u4e86\u4e00\u4f4d\n\n\u518d\u7ffb\u8f6c\u4e00\u4e0b\uff0c\u5c31\u53ef\u4ee5\u7528fft\u4e86\n\n```cpp\n#include<bits/stdc++.h>\n\nconst int N=1<<19;\nint n,i;\nstruct fushu\n{\n    double x,y;\n    friend fushu operator +(const fushu &p1,const fushu &p2)\n    {\n        return (fushu){p1.x+p2.x,p1.y+p2.y};\n    }\n    friend fushu operator -(const fushu &p1,const fushu &p2)\n    {\n        return (fushu){p1.x-p2.x,p1.y-p2.y};\n    }\n    friend fushu operator *(const fushu &p1,const fushu &p2)\n    {\n        return (fushu){p1.x*p2.x-p1.y*p2.y,p1.x*p2.y+p1.y*p2.x};\n    }\n}a[N],b[N],*ans=a,wn[N],temp[N];\n\ndouble sqr(const double &x)\n{\n    return x*x;\n}\n\nconst double pi=acos(-1),WN=2*pi/N;\nvoid init_wn()\n{\n    for(i=0;i<N;++i) wn[i]=(fushu){cos(WN*i),sin(WN*i)};\n}\nvoid rev_wn()\n{\n    for (i=0;i<N;++i) wn[i].y=-wn[i].y;\n}\n\nvoid fft(int n=N,int s=0,int len=1)\n{\n    if(n==1)return ;\n    int m=n>>1;\n    fft(m,s,len<<1);fft(m,s+len,len<<1);\n    \n    int p=s;\n    for(i=0;i<m;++i,p+=len<<1)\n    {\n        fushu del=ans[p+len]*wn[i*len];\n        temp[i]=ans[p]+del;\n        temp[i+m]=ans[p]-del;\n    }\n    \n    for(i=0;i<n;++i) ans[s+i*len]=temp[i];\n}\n\nint main()\n{\n    freopen(\"1.in\",\"r\",stdin);\n    scanf(\"%d\",&n);--n;\n    for(i=0;i<=n;++i) scanf(\"%lf\",&a[i].x);\n    for(i=0;i<n;++i) b[i].x=-1/sqr(n-i);\n    for(i=n+1;i<=n<<1;++i) b[i].x=1/sqr(i-n);\n    \n    init_wn();\n    ans=a;fft();\n    ans=b;fft();\n    for(i=0;i<N;++i) a[i]=a[i]*b[i];\n    rev_wn();\n    ans=a;fft();\n    for(i=n;i<=n<<1;++i) printf(\"%.3lf\\n\",ans[i].x/N);\n}\n```",
        "postTime": 1489919606,
        "uid": 9168,
        "name": "kczno1",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3338 \u3010[ZJOI2014]\u529b\u3011"
    },
    {
        "content": "\u5f3a\u70c8\u5410\u69fd\u65f6\u95f4\uff1a\u65f6\u9650\u662f3s!3s!3s! @kkksc03\n\nFFT,\u8fd9\u91cc\u6709\u7b80\u5316\u7248\u7684vector\u548ccomplex\u5e93\uff0c\u5982\u679c\u5bf9\u65f6\u95f4\u8981\u6c42\u4e0d\u9ad8\u53ef\u4ee5\u4f7f\u7528\u3002\n\n\n\n\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstdlib>\n#include <cstring>\n#include <algorithm>\n#include <complex>\n#include <cmath>\n#include <vector> \nusing namespace std;\nconst int MAXN = (1<<19);\nconst double PI = acos(-1.);\ntypedef std::complex<double> Complex;\ntypedef vector<double> Polynomial;\ninline void FFT(Complex P[], int n, int tag)\n{\n    Complex root,per,t;\n    for(register int i = 1, j = 0, s; i < n-1; (i<j ? swap(P[i],P[j]) : void(0)), i++)\n        for(s = n; j^=s>>=1, ~j&s; );\n    for(register int d = 0, m, i, j; (1<<d) < n; d++)\n        for(m = (1<<d), per = Complex(cos(PI/m*tag),sin(PI/m*tag)), i = 0; i < n; i += (m<<1))\n            for(root = Complex(1,0), j = 0; j < m; j++)\n                t = root*P[i+j+m], P[i+j+m] = P[i+j]-t, P[i+j] += t, root *= per;\n    return;\n}\nComplex A[MAXN+5], B[MAXN+5];\nPolynomial operator *(const Polynomial &Ax, const Polynomial &Bx)\n{\n    int n, p = Ax.size(), q = Bx.size();\n    for(n = 1; n <= p+q-2; n <<= 1);\n    for(register int i = 0; i < n; i++)\n        A[i] = (i<p ? Ax[i] : 0), B[i] = (i<q ? Bx[i] : 0);\n    FFT(A,n,1), FFT(B,n,1);\n    for(register int i = 0; i < n; A[i] *= B[i], i++);\n    FFT(A,n,-1);\n    Polynomial Cx(p+q-1);\n    for(register int i = 0, m = Cx.size(); i < m; i++)\n        Cx[i] = A[i].real()/n; \n    return Cx;\n}\nint n, m;\ndouble x[MAXN+5];\nPolynomial Ax,Bx,Cx;\nint main()\n{\n    scanf(\"%d\",&n), m = (n<<1)-1;\n    Ax.resize(n), Bx.resize(m);\n    for(register int i = 0; i < n; i++)\n        scanf(\"%lf\",x+i);\n    for(register int i = 0; i < n; i++)\n        Ax[i] = x[i];\n    for(register int i = 0; i < n-1; i++)\n        Bx[i] = -1./(n-1-i)/(n-1-i);\n    for(register int i = n; i < m; i++)\n        Bx[i] =  1./(i-n+1)/(i-n+1);\n    Cx = Ax*Bx;\n    for(register int i = n-1; i < m; i++)\n        printf(\"%0.7lf\\n\",Cx[i]); \n     return 0;\n}\n\n```",
        "postTime": 1486124934,
        "uid": 16528,
        "name": "magolor",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3338 \u3010[ZJOI2014]\u529b\u3011"
    },
    {
        "content": "\u5b9a\u4e49\u5f0f\uff1a\n\n$$E_j=\\frac{F_j}{q_j}$$\n\n$$E_j=\\frac{\\sum_{i<j} \\frac{q_iq_j}{(i-j)^2} -\\sum_{i>j} \\frac{q_iq_j}{(i-j)^2}}{q_j}$$\n\n\u6bcf\u9879\u90fd\u6709$q_j$\uff0c\u76f4\u63a5\u9664\u6389\n\n$$E_j=\\sum_{i<j} \\frac{q_i}{(i-j)^2} -\\sum_{i>j} \\frac{q_i}{(i-j)^2}$$\n\n\u4ee4$f(i)=q_i$\uff0c$g(i)=\\frac{1}{i^2}$\n\n$$E_j=\\sum_{i<j} f(i)g(j-i) -\\sum_{i>j} f(i)g(i-j)$$\n\n\u628a$f$\u53cd\u5411\u5f97\u5230$f'$\uff0c\u5219\uff1a\n\n$$E_j=\\sum_{i<j} f(i)g(j-i) -\\sum_{i<j} f'(i)g(j-i)$$\n\n\u8fd9\u662f\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u7528$FFT$\uff0c\u4e22\u4e0a\u677f\u5b50.\n\n```cpp\n#include <algorithm>\n#include <complex>\n#include <cstdio>\nusing namespace std;\n\ntypedef complex<double> comp_t;\n\nconst int N = (1 << 19) + 10;\nconst double PI = acos(-1);\n\nint n, lim, l, r[N];\ndouble f[N], g[N], a[N], b[N];\n\nvoid fft(comp_t * a, int type) {\n\tfor(int i = 0; i < lim; i ++)\n\t\tif(i < r[i]) swap(a[i], a[r[i]]);\n\tfor(int i = 1; i < lim; i <<= 1) {\n\t\tcomp_t x(cos(PI / i), type * sin(PI / i));\n\t\tfor(int j = 0; j < lim; j += (i << 1)) {\n\t\t\tcomp_t y(1, 0);\n\t\t\tfor(int k = 0; k < i; k ++, y *= x) {\n\t\t\t\tcomp_t p = a[j + k], q = y * a[j + k + i];\n\t\t\t\ta[j + k] = p + q, a[j + k + i] = p - q;\n\t\t\t}\n\t\t}\n\t}\n}\n\ncomp_t tmpa[N], tmpb[N];\n\nvoid transform(double * a, double * b, double * ans) {\n\tfor(int i = 0; i < lim; i ++)\t\n\t\ttmpa[i] = a[i], tmpb[i] = b[i];\n\tfft(tmpa, 1), fft(tmpb, 1);\n\tfor(int i = 0; i < lim; i ++) tmpa[i] *= tmpb[i];\n\tfft(tmpa, -1);\n\tfor(int i = 1; i <= n; i ++) \n\t\tans[i] = tmpa[i].real() / lim;\n}\n\nint main() {\n\tscanf(\"%d\", &n);\n\tfor(int i = 1; i <= n; i ++) {\n\t\tscanf(\"%lf\", &f[i]);\n\t\tg[i] = 1.0 / i / i;\n\t}\n\tfor(lim = 1; lim <= (n << 1); lim <<= 1) ++ l;\n\t\n\tfor(int i = 0; i < lim; i ++)\n\t\tr[i] = (r[i >> 1] >> 1) | ((i & 1) << (l - 1));\n\t\n\ttransform(f, g, a);\n\treverse(f + 1, f + n + 1); //\u7ffb\u8f6c \n\ttransform(f, g, b);\n\t\n\tfor(int i = 1; i <= n; i ++)\n\t\tprintf(\"%.3f\\n\", a[i] - b[n - i + 1]);\n\treturn 0;\n}\n```",
        "postTime": 1542626192,
        "uid": 20375,
        "name": "hongzy",
        "ccfLevel": 9,
        "title": "P3338 \u300cZJOI2014\u300d\u529b\u300cFFT\u300d"
    },
    {
        "content": "\u6765\u81ea\u6211\u7684\u535a\u5ba2\uff1ahttp://blog.csdn.net/YihAN\\_Z/article/details/54342753\n\n\u7ed9\u51fan\u4e2a\u6570qi\uff0c\u6c42![\u8fd9\u91cc\u5199\u56fe\u7247\u63cf\u8ff0](http://img.blog.csdn.net/20170111133834655?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWWloQU5fWg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n\nn<=100000\n\n\u66b4\u529b\u9700\u8981O(n2)\u7684\u65f6\u95f4\uff0c\u60f3\u5230\u7528FFT\u52a0\u901f\uff08\u6709\u89c4\u5f8b\u7684\uff09\u4e58\u6cd5[^1]\u3002\n\n\u6784\u9020\u4e24\u4e2a\u591a\u9879\u5f0f\n\n![\u8fd9\u91cc\u5199\u56fe\u7247\u63cf\u8ff0](http://img.blog.csdn.net/20170111135239893?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWWloQU5fWg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n![\u8fd9\u91cc\u5199\u56fe\u7247\u63cf\u8ff0](http://img.blog.csdn.net/20170111135642006?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWWloQU5fWg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n\u5c06\u4e24\u4e2a\u591a\u9879\u5f0f\u76f8\u4e58\uff0c\u5176\u4e2d\u7b2cn\u9879\u5230\u7b2c2n-1\u9879\u5373\u4e3a\u7b54\u6848\n\n\n```cpp\n#include <cstdio>\n#include <cmath>\n#include <algorithm>\n#define N 600000\nusing namespace std;\nconst double pi=acos(-1),DFT=2.0,IDFT=-2.0;\nstruct Complex {\n    double x,y;\n    Complex(const double& a=0.0,const double& b=0.0) : x(a),y(b) {}\n    Complex operator + (const Complex& rhs) const {return Complex(x+rhs.x,y+rhs.y); }\n    Complex operator - (const Complex& rhs) const {return Complex(x-rhs.x,y-rhs.y); }\n    Complex operator * (const Complex& rhs) const {return Complex(x*rhs.x-y*rhs.y,x*rhs.y+y*rhs.x); }\n}a[N],b[N],c[N];\nint n,len,pos[N];\nvoid init() {\n    len=1;\n    while(len<n*2) len*=2;\n    for(int i=1;i<len;i++) {\n        pos[i]=pos[i/2]/2;\n        if(i&1) pos[i]|=len/2;\n    }\n    return ;\n}\nvoid FFT(Complex x[],double mode) {\n    for(int i=0;i<len;i++)\n        if(i<pos[i])\n            swap(x[i],x[pos[i]]);\n    for(int i=2;i<=len;i*=2) {\n        int step=i/2;\n        Complex wm(cos(2*pi/i),sin(mode*pi/i));\n        for(int j=0;j<len;j+=i) {\n            int limit=j+step;\n            Complex w(1,0);\n            for(int k=j;k<limit;k++) {\n                Complex l=x[k],r=w*x[k+step];\n                x[k]=l+r; x[k+step]=l-r;\n                w=w*wm;\n            }\n        }\n    }\n    if(mode==IDFT)\n        for(int i=0;i<len;i++)\n            x[i].x/=len;\n    return ;\n}\nint main() {\n    scanf(\"%d\",&n);\n    init();\n    for(int i=0;i<n;i++) scanf(\"%lf\",&a[i].x);\n    for(int i=0;i<n-1;i++) b[i].x=-1.0/(n-i-1)/(n-i-1);\n    for(int i=n;i<n*2-1;i++) b[i].x=1.0/(i-n+1)/(i-n+1);\n    FFT(a,DFT); FFT(b,DFT);\n    for(int i=0;i<len;i++) c[i]=a[i]*b[i];\n    FFT(c,IDFT);\n    for(int i=n-1;i<n*2-1;i++) printf(\"%f\\n\",c[i].x);\n    return 0;\n}\n```\n\n[^1]:\u9664\u6cd5\u4e0e\u4e58\u6cd5\u672c\u8d28\u4e0a\u76f8\u540c\u3002\n",
        "postTime": 1484114358,
        "uid": 20558,
        "name": "zyh2015",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3338 \u3010[ZJOI2014]\u529b\u3011"
    }
]