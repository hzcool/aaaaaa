[
    {
        "content": "\n\u9898\u76ee\u610f\u601d\u6709\u4e9b\u4e71\n\n\u4f46\u5176\u5b9e\u5b9e\u9645\u4e0a\u6211\u4eec\u53ef\u4ee5\u8f6c\u5316\u6210\u6c42$\\sum_{i=1}^{n}{i^k}$\n\n\u90a3\u4e48\u8fd9\u5c31\u662f\u4e2a\u7ecf\u5178\u7684\u6c42\u81ea\u7136\u6570\u5e42\u548c\u7684\u95ee\u9898\u4e86\uff0c\u6709\u5f88\u591a\u79cd\u65b9\u6cd5\u89e3\u51b3\uff0c\u4ee5\u4e0b\u7ed9\u51fa\u51e0\u79cd\u5e38\u89c1\u65b9\u6cd5\n\n\uff11\uff0e\u9012\u63a8\u6cd5\n\n\u4ee4\u5176\u4e3aS(n,k),\u53ef\u5f97\n$$(i + 1)^{k + 1} - i^{k + 1} = \\binom{k + 1}{1}i^k + \\binom{k + 1}{2} i^{k - 1} + ... +  \\binom{k + 1}{k}i + 1$$\n\u76f8\u52a0\u53ef\u5f97\n$$(n + 1)^{k + 1} - 1 = \\binom{k + 1}{1}\\sum\\limits_{i = 0}^{n}i^k + \\binom{k + 1}{2}\\sum\\limits_{i = 0}^{n}i^{k-1} + ... + \\binom{k + 1}{k}\\sum\\limits_{i = 0}^{n}i + n$$\n\n$$S(n,k)=\\frac{1}{k+1}((n+1)^{k+1}-\\sum_{i=2}^{k+1}\\binom{k+1}{i}S(n,k+1-i)-1)$$\n\n\u4e8e\u662f\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u5728$O(k^2)$\u7684\u65f6\u95f4\u641e\u5b9a\n\n\uff12\uff0e$Bernoulli$\u6570\n\n\u4f46\u662f\u6211\u4eec\u4e5f\u53ef\u4ee5\u7528$Bernoulli$\u6570\u6765\u89e3\u51b3\n\n\u53ef\u5f97\u5230\n$$S(n,k)=\\frac{1}{k+1}\\sum_{i=1}^{k+1}\\binom{k+1}{i}B_{k+1-i}(n+1)^i$$\n\n\u5176\u4e2d$B_0=1$,\u5bf9\u4e8e$n>0$\u6709\n$$\\sum_{i=0}^{n}\\binom{n+1}{i}B_i=0$$\n\n\uff13\uff0e$Stirling$\u6570\n   \n   (1)\u4e0b\u964d\u5e42\uff1a$$x^{\\underline{n}} = \\frac{x!}{(x-n)!}$$\n   \n   (2)\u7b2c\u4e00\u7c7b\u65af\u7279\u6797\u6570:$$\\left[\\begin{matrix} n \\\\ k \\end{matrix}\\right] = (n - 1)\\left[\\begin{matrix} n - 1 \\\\ k \\end{matrix}\\right] + \\left[\\begin{matrix} n - 1 \\\\ k - 1 \\end{matrix}\\right]$$\n \n   \u90a3\u4e48\u6211\u4eec\u53ef\u5f97\n$$k! \\binom{n}{k} = \\sum_{i = 0}^{k} \\left[\\begin{matrix} k \\\\ i \\end{matrix}\\right] (-1)^{k - i} n^i$$\n\n$$n^k = k! \\binom{n}{k} - \\sum_{i = 0}^{{k - 1}} \\left[\\begin{matrix} k \\\\ i \\end{matrix}\\right] (-1)^{k - i} n^i$$\n  \n  \u6240\u4ee5\u6709$$\\sum_{i = 0}^{n} i^k = \\sum_{i = 0}^{n} \\left( k! \\binom{i}{k} - \\sum_{j = 0}^{k - 1} \\left[\\begin{matrix} k \\\\ j \\end{matrix}\\right] (-1)^{k - j} i^j \\right)$$\n$$= k! \\sum_{i = 0}^{n} \\binom{i}{k} - \\sum_{i = 0}^{n} \\sum_{j = 0}^{k - 1} \\left[\\begin{matrix} k \\\\ j \\end{matrix}\\right] (-1)^{k - j} i^j$$\n                     $$= k! \\binom{n + 1}{k + 1} - \\sum_{j = 0}^{k - 1} \\left[\\begin{matrix} k \\\\ j \\end{matrix}\\right] (-1)^{k - j}{\\sum_{i = 0}^{n} i^j}$$\n                     $$= \\frac{(n + 1)^{\\underline{k + 1}}}{k + 1} - \\sum_{j = 0}^{k - 1} \\left[\\begin{matrix} k \\\\ j \\end{matrix}\\right] (-1)^{k - j}{\\sum_{i = 0}^{n}i^j}$$\n                     \n4.\u591a\u9879\u5f0f\u5dee\u5206\n\n\u8003\u8651$f(n)=n^k$\u8fd9\u4e00\u51fd\u6570\u7684\u5dee\u5206\u8868\u7684\u7b2c$0$\u6761\u5bf9\u89d2\u7ebf $c_0...c_k$.\n\n\u6211\u4eec\u6709\n$$\\sum_{i = 0}^{n} f(i) = \\sum_{i = 0}^{n} \\sum_{j = 0}^{k} c_j \\binom{i}{j} $$\n                      $$= \\sum_{j = 0}^{k} \\sum_{i = 0}^{n} c_j \\binom{i}{j}$$\n                      $$= \\sum_{j = 0}^{k} c_j \\binom{n + 1}{j + 1}$$\n\u5982\u679c\u6a21\u6570\u4e3a\u8d28\u6570,\u5c31\u53ef\u4ee5$O(k^2)$\u8ba1\u7b97\u4e86.\n   \n5.\u62c9\u683c\u6717\u65e5\u63d2\u503c\n\n\u4ece\u4e0a\u9762\u65b9\u6cd5\u53ef\u770b\u51fa$\\sum_{i=0}^{n}{i^k}$\u662f\u4e00\u4e2a\u5173\u4e8e$n$\u7684$k+1$\u6b21\u591a\u9879\u5f0f\uff0c\u63d2\u4e00\u4e0b\u503c\u5c31\u597d\u4e86\n\n\u6211\u4eec\u628a$n=0\u2026k+1$\u7684\u51fd\u6570\u503c\u7b97\u51fa\u6765\n\n\u4e8e\u662f\u53ef\u4ee5\u505a\u5230$O(k)$\u6216$O(klogk)$\u6c42$n_0$\u65f6\u7684\u51fd\u6570\u503c\n  \n\u6211\u7528\u7684\u662f$Bernoulli$\u6570\u7684\u65b9\u6cd5\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n```\n// luogu-judger-enable-o2\n#include <bits/stdc++.h>\n#define F(i, l, r) for(int i = (l), _end_ = (int)(r); i <= _end_; ++i)\n#define f(i, r, l) for(int i = (r), _end_ = (int)(l); i >= _end_; --i)\n#define Set(a, v) memset(a, v, sizeof(a))\n#define file(a) freopen(a\".in\",\"r\",stdin),freopen(a\".out\",\"w\",stdout)\nusing namespace std;\n\nbool chkmin(int &a, int b) {return b < a ? a = b, 1 : 0;}\nbool chkmax(int &a, int b) {return b > a ? a = b, 1 : 0;}\n\ninline long long read() {\n long long x = 0, fh = 1; char ch = getchar();\n    for (; !isdigit(ch); ch = getchar() ) if (ch == '-') fh = -1;\n    for (; isdigit(ch); ch = getchar() ) x = (x<<1) + (x<<3) + (ch ^ '0');\n    return x * fh;\n}\nconst int mod=1e9+7;\nlong long n,a[65];\nint m;\nint b[65],c[65][65],inv[65];\nlong long qpow(long long x,long long y){\n       long long res=1;\n       while(y){\n          if(y&1)res=res*x%mod;\n          x=x*x%mod;\n          y>>=1;\n       }\n       return res;\n}\nint fx(long long x){\n     int res=0;\n     F(i,1,m+1){\n        res=(res+1ll*c[m+1][i]*b[m+1-i]%mod*qpow(x+1,i)%mod)%mod;\n     }\n     res=1ll*res*qpow(m+1,mod-2)%mod;\n     return res;\n}\nint main () {\n#ifndef ONLINE_JUDGE\nfile(\"4593\");\n#endif\n    int t=read();\n    F(i,1,60)inv[i]=qpow(i,mod-2);\n    F(i,0,60){\n        c[i][0]=1;\n      F(j,1,i){\n         c[i][j]=(c[i-1][j-1]+c[i-1][j])%mod;\n      }\n    }\n    b[0]=1;\n    F(i,1,60){\n       b[i]=0;\n       F(j,0,i-1)b[i]=(b[i]+1ll*c[i+1][j]*b[j])%mod;\n       b[i]=(1ll*(mod-b[i])*inv[i+1])%mod;\n    }\n    while(t--){\n      n=read();\n      m=read();\n      F(i,1,m)a[i]=read();\n      a[++m]=++n;\n      sort(a+1,a+m+1);\n      long long ans=0;\n      F(i,1,m){\n          F(j,i,m){\n             ans=(ans+fx(a[j]-1)-fx(a[j-1])+mod)%mod;\n          }\n          F(j,i+1,m)a[j]-=a[i];\n          a[i]=0;\n      }\n      printf(\"%lld\\n\",ans);\n    }\n    return 0;\n}\n```\n",
        "postTime": 1526304580,
        "uid": 44829,
        "name": "psk011102",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4593 \u3010[TJOI2018]\u6559\u79d1\u4e66\u822c\u7684\u4eb5\u6e0e\u3011"
    },
    {
        "content": "\u5148\u7b97\u51fa\u6240\u9700\u4eb5\u6e0e\u4e2a\u6570$k$\uff0c\u89c2\u5bdf\u5c31\u53ef\u4ee5\u53d1\u73b0$k=m+1$\uff0c\u6709\u4e00\u4e2a\u5c0f\u7ec6\u8282\uff0c\u5982\u679c\u4ece$n$\u5f00\u59cb\u6709\u4e00\u6bb5\u8fde\u7eed\u7684\u7a7a\u4f4d\uff0c\u5e94\u8be5\u628a\u5b83\u53bb\u6389\uff0c\u56e0\u4e3a\u4e0d\u4f1a\u9700\u8981\u591a\u4f59\u7684\u4eb5\u6e0e\u3002\n\n\u6211\u4eec\u8ba1\u7b97\u6bcf\u4e00\u6b21\u4eb5\u6e0e\u7684\u8d21\u732e\uff0c\u7b2c\u4e00\u6b21\u4eb5\u6e0e\u6211\u4eec\u8ba4\u4e3a\u662f\u5728$0$\u4f4d\u7f6e\u3002\u663e\u7136\u7b2c\u4e00\u6b21\u7684\u8d21\u732e\u662f$\\sum\\limits_{i=1}^{n}i^k$ $-$ \u7a7a\u4f4d\u7684\u8d21\u732e\u3002\n\n\u4e4b\u540e\u6211\u4eec\u8003\u8651\u5728\u4e00\u4e2a\u7a7a\u4f4d\u4e0a\u4f7f\u7528\u4eb5\u6e0e\uff0c\u8bbe\u7a7a\u4f4d\u4e3a$p$\uff0c\u90a3\u4e48\u6709\u8d21\u732e\u7684\u533a\u95f4\u4e3a$p+1 \\sim n$\u3002\u8d21\u732e\u4e3a$\\sum\\limits_{i=1}^{n-p}i^k$\u3002\n\n\u6700\u540e\u6211\u4eec\u51cf\u53bb\u7a7a\u4f4d\u591a\u7b97\u7684\u8d21\u732e\u5373\u53ef\u3002\n\n\u8003\u8651\u8ba1\u7b97$\\sum\\limits_{i=1}^{n}i^k$\uff0c\u53ef\u5229\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\uff0c\u53c2\u8003[\u8fd9\u91cc](https://www.luogu.org/problem/CF622F)\n\n$Code\\ Below:$\n```cpp\n#include<bits/stdc++.h>\n#define ts cout<<\"ok\"<<endl\n#define int long long\n#define hh puts(\"\")\n#define mo 1000000007\nusing namespace std;\nint n,m,a[55],k,f[55],pre[55],suf[55],fac[55],ans;\nmap<int,int> ma;\ninline int read(){\n    int ret=0,ff=1;char ch=getchar();\n    while(!isdigit(ch)){if(ch=='-') ff=-ff;ch=getchar();}\n    while(isdigit(ch)){ret=(ret<<3)+(ret<<1)+ch-'0';ch=getchar();}\n    return ret*ff;\n}\nvoid write(int x){\n    if(x>9) write(x/10);\n    putchar(x%10+48);\n}\ninline int ksm(int x,int y){\n    int res=1;\n    while(y){\n        if(y&1) res=res*x%mo;\n        y>>=1;\n        x=x*x%mo;\n    }\n    return res;\n}\ninline int calc(int p){\n    if(p<=k+2) return f[p];\n    int res=0;\n    pre[0]=1;\n    for(int i=1;i<=k+2;i++) pre[i]=pre[i-1]*(p-i)%mo;\n    suf[k+3]=1;\n    for(int i=k+2;i>=1;i--) suf[i]=suf[i+1]*(p-i)%mo;\n    for(int i=1;i<=k+2;i++){\n        int x=pre[i-1]*suf[i+1]%mo;\n        int fu=((k+2-i)&1)?-1:1;\n        int y=fac[i-1]*fac[k+2-i]*fu%mo;\n        res=(res+f[i]*x%mo*ksm(y,mo-2)%mo)%mo;\n    }\n    return (res+mo)%mo;\n}\nsigned main(){\n    fac[0]=1;\n    for(int i=1;i<=52;i++) fac[i]=fac[i-1]*i%mo;\n    int T=read();\n    while(T--){\n        n=read(),m=read();\n        k=m+1;\n        ma.clear();\n        for(int i=1;i<=m;i++) a[i]=read(),ma[a[i]]=1;\n        sort(a+1,a+m+1);\n        while(ma[n]) n--,k--,m--;\n        for(int i=1;i<=k+2;i++) f[i]=(f[i-1]+ksm(i,k))%mo;\n        ans=calc(n);\n        for(int i=1;i<=m;i++) ans=(ans-ksm(a[i],k))%mo;\n        for(int i=1;i<=m;i++) ans=(ans+calc(n-a[i]))%mo;\n        for(int i=1;i<=m;i++)\n            for(int j=i-1;j>=1;j--)\n                ans=(ans-ksm(a[i]-a[j],k))%mo;\n        write((ans+mo)%mo),hh;\n    }\n    return 0;\n}\n```\n",
        "postTime": 1564023316,
        "uid": 27858,
        "name": "ycyaw",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4593 \u3010[TJOI2018]\u6559\u79d1\u4e66\u822c\u7684\u4eb5\u6e0e\u3011"
    },
    {
        "content": "\u603b\u7684\u6765\u8bf4\uff0c\u8fd9\u662f\u4e00\u9053\u7ed3\u8bba\u9898\u3002\n\n\u63a5\u4e0b\u6765\u6211\u5c06\u4f1a\u91c7\u53d6\u5b50\u4efb\u52a1\u8bb2\u89e3\u7684\u5f62\u5f0f\u6765\u5206\u6790\u8fd9\u9053\u9898\u76ee\u3002\n\n$Subtask$ $1$ $m = 0$\n\n\u6b64\u65f6\u53ea\u9700\u8981\u4e00\u5f20\u4eb5\u6e0e\uff0c\u6240\u6709\u968f\u4ece\u90fd\u4f1a\u6b7b\u4ea1\u3002\n\n\u6240\u4ee5\u7b54\u6848\u662f $\\sum_{i=1}^ni$ \uff0c\u8fd9\u4e2a\u5f0f\u5b50\u7528\u7b49\u5dee\u6570\u5217\u6c42\u548c\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\uff0c\u5927\u5bb6\u5e94\u8be5\u90fd\u4f1a\u7684\u3002\n\n$Subtask$ $2$ $m = 1$\n\n\u6b64\u65f6\u9700\u8981\u4e24\u5f20\u4eb5\u6e0e\u624d\u80fd\u6d88\u706d\u6240\u6709\u968f\u4ece\uff0c\u8003\u8651\u7b2c\u4e00\u6b21\u4eb5\u6e0e\u6240\u8d21\u732e\u7684\u5206\u6570\u3002\n\n\u5373\u4e3a $\\sum_{i=1}^ni^2-a_1^2$\n\n\u540c\u6837\u5730\uff0c\u518d\u6b21\u8003\u8651\u7b2c\u4e8c\u6b21\u4eb5\u6e0e\u6240\u8d21\u732e\u7684\u5206\u6570\u3002\n\n\u6b64\u65f6\u6240\u6709\u7684\u6570\u5df2\u7ecf\u88ab\u51cf\u6389\u4e86 $a_1$ \uff0c\u4e14\u4f53\u529b\u503c\u5c0f\u4e8e $a_1$ \u7684\u968f\u4ece\u5df2\u5168\u90e8\u88ab\u6d88\u706d\u3002\n\n\u6545\u6b64\u65f6\u7b54\u6848\u4e3a $\\sum_{i=1}^{n-a_1} i^2$ \n\n$Subtask$ $3$ $n=10^{13}$ , $m = 50$\n\n\u8fd9\u662f\u672c\u6b21\u7684\u91cd\u5934\u620f\uff0c\u4f46\u5176\u5b9e\u6709\u4e86\u4e4b\u524d\u7684\u60f3\u6cd5\u4f5c\u94fa\u57ab\uff0c\u8fd8\u662f\u6bd4\u8f83\u597d\u7406\u89e3\u7684\u3002\n\n\u6211\u4eec\u5148\u601d\u8003\uff0c\u6bcf\u6b21\u7b97\u5f97\u5206\u65f6\u90fd\u8981\u8ba1\u7b97\u4f24\u5bb3\u7684 $K$ \u6b21\u65b9\uff0c\u800c\u8fd9\u4e2a\u503c\u662f\u672a\u77e5\u7684\u3002\n\n\u4f46\u662f\u663e\u7136 $K$ \u662f\u9700\u8981\u6211\u4eec\u5148\u7b97\u51fa\u6765\u7684\u3002\n\n\u5f53\u4e00\u4e2a\u968f\u4ece\u90fd\u6ca1\u6709\u88ab\u5220\u9664\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5f88\u8f7b\u677e\u5730\u4f7f\u7528\u4e86\u4e00\u5f20\u4eb5\u6e0e\u5c31\u7ed3\u675f\u4e86\uff0c\u4f46\u662f\u5220\u9664\u4e86\u4e00\u4e2a\u968f\u4ece\uff0c\u6211\u4eec\u5c31\u7528\u4e86\u4e24\u5f20\uff0c\u987a\u7740\u8fd9\u4e2a\u601d\u8def\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u4e00\u4e9b\u7ed3\u8bba\u3002\n\n\u5220\u9664\u4e00\u4e2a\u968f\u4ece\u5c31\u4f1a\u628a\u539f\u672c\u8fde\u7eed\u7684\u6570\u5217\u5206\u9694\u6210\u4e24\u6bb5\uff0c\u800c\u5220\u9664\u968f\u4ece\u540e\u9020\u6210\u9700\u8981\u518d\u6b21\u4f7f\u7528\u7684\u6839\u672c\u539f\u56e0\u5c31\u662f\u5206\u9694\u4e4b\u540e\uff0c\u672c\u5e94\u8be5\u6740\u6b7b\u7684\u968f\u4ece\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u5c31\u4e0d\u80fd\u518d\u6b21\u4f7f\u7528\u6cd5\u672f\u4e86\uff0c\u6240\u4ee5\u4e00\u6b21\u4e0d\u884c\uff0c\u5c31\u518d\u6765\u4e00\u6b21\u3002\n\n\u6240\u4ee5\uff0c\u6709 $m$ \u4e2a\u968f\u4ece\u88ab\u5220\u9664\uff0c\u9700\u8981\u7684\u5361\u724c\u6570\u91cf\u5c31\u662f $m+1$ \u4e86\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u601d\u8003\u600e\u4e48\u8ba1\u7b97\u5361\u724c\u7684\u8d21\u732e\u3002\n\n\u6309\u7167\u4e4b\u524d\u7684\u601d\u8def\uff0c\u6211\u4eec\u5361\u724c\u7684\u8d21\u732e\u53ef\u4ee5\u7528\u603b\u4f53\u8d21\u732e\uff08\u4e5f\u5c31\u662f\u5bf9\u4e0d\u5220\u9664\u4efb\u4f55\u968f\u4ece\u7684\u8d21\u732e\uff09\u51cf\u53bb\u591a\u7b97\u7684\u8d21\u732e\uff08\u88ab\u5220\u9664\u968f\u4ece\u7684\u8d21\u732e\uff09\u3002\n\n\u4ee5\u6bcf\u5f20\u5361\u724c\u4e3a\u5e8f\uff0c\u4e8e\u662f\u5c31\u6709\u4ee5\u4e0b\u5f0f\u5b50\u3002\n\n$ans=\\sum_{i=0}^m(\\sum_{j=1}^{n-a[i]}j^{m+1}- \\sum_{j=i+1}^m{(a[j]-a[i]})^{m+1})$\n\n\u7279\u522b\u5730\uff0c $a[0]=0$ \u3002\n\n\u5982\u679c\u4f60\u7406\u89e3\u4e86\u4e4b\u524d\u7684\u4e24\u79cd\u601d\u8def\uff0c\u90a3\u8fd9\u4e2a\u5f0f\u5b50\u7406\u89e3\u8d77\u6765\u5176\u5b9e\u662f\u4e0d\u96be\u7684\u3002\n\n\u66b4\u529b\u8ba1\u7b97\u8fd9\u4e2a\u5f0f\u5b50\u7684\u503c\u662f $O(nmlogn)$ \u3002\n\n\u8fc7\u4e0d\u4e86\uff0c\u5b8c\u5168\u8fc7\u4e0d\u4e86\u3002\n\n\u5206\u6790\u53d1\u73b0\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u74f6\u9888\u5728\u4e8e\u6c42 $j^{m+1}$ \u7684\u6c42\u548c\u90e8\u5206\uff0c\u800c\u73b0\u5728\u7684\u95ee\u9898\u5c31\u8f6c\u5316\u4e3a\uff0c\u5982\u4f55\u5feb\u901f\u5730\u6c42\u51fa $\\sum_{i=1}^ni^k$ \u3002\n\n\u8fd9\u4e2a\u95ee\u9898\u4e5f\u5c31\u662f\u7ecf\u5178\u7684\u81ea\u7136\u6570\u5e42\u548c\u95ee\u9898\uff0c\u6709\u591a\u79cd\u7ecf\u5178\u65b9\u5f0f\u53ef\u4ee5\u6c42\u51fa\uff0c\u4f8b\u5982\u4f2f\u52aa\u5229\u6570\uff0c\u65af\u7279\u6797\u6570\uff0c\u62c9\u683c\u6717\u65e5\u63d2\u503c\u7b49\u3002\n\n\u4e0d\u8fc7\u8fd9\u4e9b\u6211\u90fd\u4e0d\u4f1a\uff0c\u6211\u9009\u62e9\u6700\u7b80\u5355\u6613\u61c2\u7684\u7b97\u6cd5\uff0c\u9012\u63a8\u6cd5\u3002\n\n\u8fd9\u4e2a\u7684\u9012\u63a8\u5f0f\u57fa\u4e8e\u4e00\u79cd\u201c\u7b97\u4e24\u6b21\u201d\u7684\u601d\u60f3\uff0c\u8003\u8651\u8ba1\u7b97\u8fd9\u6837\u4e00\u4e2a\u5f0f\u5b50\u3002\n\n$(i+1)^{k+1}-i^{k+1}=C_{k+1}^{1}i^k+C_{k+1}^{2}i^{k-1}+...+C_{k+1}^{k}i+1$ \n\n\u8fd9\u4e2a\u5f0f\u5b50\u600e\u4e48\u6765\u7684\u5462\uff0c\u5176\u5b9e\u5c31\u662f\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u628a\u5de6\u8fb9\u7684 $(i+1)^{k+1}$ \u9879\u5c55\u5f00\uff0c\u628a $i^k$ \u5408\u5e76\u5373\u53ef\u3002\n\n\u5bf9\u5de6\u8fb9 $1-n$ \u6c42\u548c\uff0c\u5bf9\u53f3\u8fb9 $1-n$ \u6c42\u548c\u3002\n\n\u5c31\u53ef\u4ee5\u5f97\u51fa\u9012\u63a8\u5f0f\u5b50\u4e86\uff0c\u7528\u8fd9\u79cd\u9012\u63a8\u7684\u65b9\u5f0f\u7b97\uff0c\u590d\u6742\u5ea6\u662f $O(K^2)$ \u7684\uff0c\u4f46\u62c9\u683c\u6717\u65e5\u63d2\u503c\u53ef\u4ee5\u505a\u5230 $O(K)$ \u8ba1\u7b97\uff0c\u53cd\u6b63\u6211\u4e0d\u4f1a\u3002\n\n\u8fd9\u91cc\u7684\u9012\u63a8\u8fc7\u7a0b\u6211\u7528\u7684\u662f\u9012\u5f52\u8ba1\u7b97\uff0c\u8fd9\u5c31\u5bfc\u81f4\u6bcf\u6b21\u8ba1\u7b97\u65f6\u4f1a\u9047\u5230\u5f88\u591a\u91cd\u590d\u7684\u72b6\u6001\uff0c\u5728\u987a\u5e8f\u7ed3\u6784\u7684\u5faa\u73af\u8ba1\u7b97\u4e2d\uff0c\u6211\u4eec\u662f\u7528\u6570\u7ec4\u4fdd\u5b58\u4e0b\u4e86\u90a3\u4e9b\u503c\u7684\uff0c\u8ba1\u7b97\u65f6\u53ef\u4ee5\u76f4\u63a5\u7528\uff0c\u4f46\u6211\u4e4b\u524d\u9012\u5f52\u65f6\u5fd8\u4e86\u4fdd\u5b58\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e86\u590d\u6742\u5ea6\u7684\u9000\u5316\uff0c\u9000\u5316\u6210\u4ec0\u4e48\u7a0b\u5ea6\u6211\u4e5f\u4e0d\u662f\u5f88\u6e05\u695a\uff0c\u7528\u4e00\u4e2a\u6570\u7ec4dp[k]\u4fdd\u5b58\u72b6\u6001\uff0c\u8bb0\u5fc6\u5316\u641c\u7d22\uff0c\u5feb\u4e86\u4e0d\u5c11\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(m^3+m^2logm)$ \u7684\uff0c\u8dd1\u5f97\u98de\u5feb\uff0c\u6bd4\u67d0\u4e9b\u62c9\u683c\u6717\u65e5\u63d2\u503c\u505a\u6cd5\u8fd8\u8981\u5feb\u3002\n\n\n\n\n\n\n",
        "postTime": 1611915129,
        "uid": 213256,
        "name": "Constant",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4593 \u3010[TJOI2018]\u6559\u79d1\u4e66\u822c\u7684\u4eb5\u6e0e\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u8ba4\u771f\u8bfb\u9898\u4e0d\u96be\u53d1\u73b0\u82e5\u8840\u91cf\u7684\u533a\u95f4 $[1,m_i]$ \u8fde\u7eed,\u5219\u53ea\u9700\u8981\u4e00\u5f20\u4eb5\u6e0e\u5c31\u53ef\u4ee5\u6740\u6b7b\u533a\u95f4 $[1,m_i]$ \u5185\u6240\u6709\u602a\u7269\uff0c\u6240\u4ee5 $k = m+1$\u3002\n\n\u8003\u8651\u5230\u8fd9\u70b9\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8f7b\u677e\u7684\u5199\u51fa\u5f0f\u5b50(\u4fdd\u8bc1 $a_i$ \u5347\u5e8f)\uff1a\n\n\u5b9a\u4e49 $a_0 = 0$,\u6709\n\n$$\\Large Ans = \\sum\\limits_{i=1}^{m+1}\\left(\\sum\\limits_{j=1}^{n-a_{i-1}}j^{m+1}-\\sum\\limits_{j=i}^m(a_j-a_{i-1})^{m+1}\\right)$$\n\n\u5199\u51fa\u4e86\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u5982\u679c\u4f60\u77e5\u8bc6\u9762\u4e0d\u8db3\u7684\u8bdd\uff0c\u5c31\u6ca1\u6709\u7136\u540e\u4e86(~~\u81f3\u5c11\u50cf\u6211\u8fd9\u79cd\u849f\u84bb\u662f\u8fd9\u6837\u7684~~)\u3002\n\n\u53ea\u9700\u77e5\u9053 $\\sum\\limits_{j=1}^{n-a_{i-1}}j^{m+1}$ \u662f\u4e00\u4e2a $m+2$ \u6b21\u7684\u591a\u9879\u5f0f\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u5c31\u53ef\u4ee5\u7b97\u4e86\u3002\n\n$\\sum\\limits_{i=1}^{x}i^n$ \u662f $n+1$ \u6b21\u591a\u9879\u5f0f\u597d\u50cf\u662f\u4e00\u4e2a\u6bd4\u8f83\u5e38\u7528\u7684\u7ed3\u8bba\uff0c\u4f46\u6211\u672c\u4eba\u5e76\u6ca1\u6709\u627e\u5230\u7f51\u7edc\u4e0a\u7684\u8bc1\u660e\uff0c\u6240\u4ee5\u5c1d\u8bd5\u7740\u81ea\u5df1\u8bc1\u4e86\u4e00\u4e0b\u3002\n\n**\u5927\u91cf\u516c\u5f0f\u8b66\u544a**\u3002\n\n### \u8bc1\u660e\uff1a $\\sum\\limits_{i=1}^{x}i^n$ \u662f\u4e00\u4e2a $n+1$ \u6b21\u591a\u9879\u5f0f.\n\n\u5b9a\u4e49:\n\n$$f(x) = \\sum\\limits_{i=1}^{x}i^n$$\n\n\u4e0d\u5931\u4e00\u822c\u6027\uff0c\u76f4\u63a5\u8003\u8651 $n$ \u7684\u60c5\u51b5\u3002\n\n\u8bbe $g(x) = x^{n+1}$\u3002\n\n\u5bf9\u6bcf\u4e00\u9879 $g(x)$ \u4f7f\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00\uff1a\n\n$$\\begin{aligned}\n&g(x)=(x-1)^{n+1}+\\tbinom{n+1}{1}(x-1)^n\\cdots+\\tbinom{n+1}{n}(x-1)+\\tbinom{n+1}{n+1}\\\\\n&g(x-1)=(x-2)^{n+1}+\\tbinom{n+1}{1}(x-2)^n\\cdots+\\tbinom{n+1}{n}(x-2)+\\tbinom{n+1}{n+1}\\\\\n&\\cdots\\cdots\\\\\n&g(1) = 1^{n+1}\n\\end{aligned}$$\n\n\u5c06\u4e0a\u8ff0\u5f0f\u5b50\u5168\u90e8\u5408\u5e76\u8d77\u6765\u6709:\n\n$$\\sum\\limits_{i=1}^x{(x-i+1)^{n+1}}=\\sum\\limits_{i=1}^{x}\\sum\\limits_{j=0}^{n+1}\\tbinom{n+1}{j}(x-i)^{n-j+1}$$\n\n\u5316\u7b80\u6709:\n\n$$x^{n+1} = \\sum\\limits_{i=1}^{x}\\sum\\limits_{j=1}^{n+1}\\tbinom{n+1}{j}(x-i)^{n-j+1}$$\n\n\u79fb\u9879\u6709:\n\n$$\nx^{n+1} = \\sum\\limits_{i=1}^{x}\\sum\\limits_{j=2}^{n+1}\\tbinom{n+1}{j}(x-i)^{n-j+1}+\\sum\\limits_{i=1}^{x}\\tbinom{n+1}{1}(x-i)^{n}\n$$\n\n$$\n\\sum\\limits_{i=1}^{x}(x-i)^n = \\frac{x^{n+1}-\\sum\\limits_{i=1}^{x}\\sum\\limits_{j=2}^{n+1}\\tbinom{n+1}{j}(x-i)^{n-j+1}}{n+1}\n$$\n\n\u5373\u4e3a:\n\n$$f(x-1)=\\sum\\limits_{i=1}^{x-1}i^n = \\frac{x^{n+1}-\\sum\\limits_{i=1}^{x}\\sum\\limits_{j=2}^{n+1}\\tbinom{n+1}{j}(x-i)^{n-j+1}}{n+1}-1$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u662f\u4e00\u4e2a\u6700\u9ad8\u9879\u4e3a $x^{n+1}$ \u6b21\u591a\u9879\u5f0f\uff0c\u5373\u731c\u6d4b\u6210\u7acb\u3002\n\n\u7efc\u4e0a\uff0c$f(x) = \\sum\\limits_{i=1}^{x}i^n$ \u662f\u4e00\u4e2a $n+1$ \u6b21\u591a\u9879\u5f0f\u3002\n\n### \u56de\u5230\u539f\u5f0f:\n\n$$\\Large Ans = \\sum\\limits_{i=1}^{m+1}\\left(\\sum\\limits_{j=1}^{n-a_{i-1}}j^{m+1}-\\sum\\limits_{j=i}^m(a_j-a_{i-1})^{m+1}\\right)$$\n\n$\\sum\\limits_{j=1}^{n-a_{i-1}}j^{m+1}$ \u662f\u4e00\u4e2a $m+2$ \u6b21\u7684\u591a\u9879\u5f0f\u6240\u4ee5\u53ef\u4ee5\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u6cd5\u7b97\u51fa\u6765\u3002\n\n\u62c9\u683c\u6717\u65e5\u63d2\u503c\u7684\u5f0f\u5b50\uff1a\n\n$$\\ell_i(k)=\\prod\\limits_{i\\neq j,i=0}^{n}\\frac{k-x_j}{x_i-x_j}$$\n$$f(k) = L(k)= \\sum\\limits_{i=0}^{n}y_i\\ell_i(k)$$\n\n\u8fd9\u6837\u505a\u662f $\\mathcal{O}(m^2)$,\u56e0\u4e3a\u672c\u9898\u53d6\u503c\u662f\u8fde\u7eed\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f18\u5316\u5230 $\\mathcal{O}(m)$\u3002\n\n\u4f18\u5316\u540e\u7684\u5f0f\u5b50\u957f\u8fd9\u6837:\n\n$$f(k) = \\sum\\limits_{i=0}^{n-i}(-1)^{i+1}y_i\\frac{Pre_{i-1}\\cdot Suf_{i+1}}{fac_{i-1}\\cdot fac_{n-i}}$$\n\n$Pre_i$,$Suf_i$,$fac_i$ \u5206\u522b\u662f\u9884\u5904\u7406\u51fa\u6765\u7684\u524d\u7f00\u79ef,\u540e\u7f00\u79ef,\u9636\u4e58\u3002\n\n\u5bf9\u4e8e\u539f\u5f0f\u7684 $\\sum\\limits_{j=i}^m(a_j-a_{i-1})^{m+1}$ \u76f4\u63a5\u66b4\u529b\u7b97\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u6700\u7ec8\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O}(m^2)$ \u7684\u3002\n\n## Code:\n~~~c\n# include <map>\n# include <ctime>\n# include <cmath>\n# include <cstdio>\n# include <cstdlib>\n# include <cstring>\n# include <algorithm>\n# define LL long long\n# define reg register\nconst LL mod = 1e9+7;\n\nint T;\nLL a[55],n,m,k,Fac[55],Pre[55],Suf[55],f[55],ans;\n\ninline int Mod(const int x){return x < mod ? x : x-mod;}\n\ninline int qpow(LL x,int p=1e9+5)\n{\n    reg LL res = 1;\n    for(; p ; p>>=1,x = (x*x)%mod) if(p&1) res = res*x%mod;\n    return res; \n}\n\ninline int Lagrange(const int x)\n{\n    if(x <= k) return f[x];\n    reg LL res = 0;Suf[k+1] = 1;\n    for(reg int i = 1; i <= k ; ++i) Pre[i] = Pre[i-1]*(x-i)%mod;\n    for(reg int i = k; i >= 1 ; --i) Suf[i] = Suf[i+1]*(x-i)%mod;\n    for(reg int i = 1; i <= k ; ++i) \n    res = (res + ((((k-i)&1) ? -1LL : 1LL) * (Pre[i-1]*Suf[i+1]%mod * qpow(Fac[i-1]*Fac[k-i]%mod))%mod * f[i])%mod)%mod;\n\treturn Mod(res+mod);\n}\n\nint main()\n{\n    Fac[0] = Pre[0] = f[1] = 1;\n    for(reg int i = 1; i <= 54 ; ++i) Fac[i] = Fac[i-1]*i%mod;\n    scanf(\"%d\",&T);\n    while(T--)\n    {\n        scanf(\"%d%d\",&n,&m);k = m+3;\n        for(reg int i = 1; i <= m ; ++i) scanf(\"%d\",a+i);\n        std::sort(a+1,a+m+1);\n        while(a[m] == n){m--;n--;k--;}\n        for(reg int i = 2; i <= k ; ++i) f[i] = (f[i-1]+qpow(i,m+1))%mod;\n        for(reg int i = 1; i <= m+1 ; ++i)\n        {\n            ans = Mod(ans+Lagrange(n-a[i-1]));\n            int aiaj = 0;\n            for(reg int j = i; j <= m; ++j) aiaj = Mod(aiaj+qpow(a[j]-a[i-1],m+1));\n            ans = Mod(Mod(ans+mod-aiaj)+mod);\n        }\n        printf(\"%d\\n\",ans);ans = 0;\n    }\n    return 0;\n}\n~~~\n[$\\mathcal{O}(m^2)$](https://www.luogu.com.cn/record/37899086)",
        "postTime": 1599221876,
        "uid": 222127,
        "name": "\u4e91\u5c81\u6708\u4e66",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4593 \u3010[TJOI2018]\u6559\u79d1\u4e66\u822c\u7684\u4eb5\u6e0e\u3011"
    },
    {
        "content": "\u4e2a\u4eba\u535a\u5ba2\uff1a[\u70b9\u8fd9\u91cc](https://www.cnblogs.com/NLDQY/p/10837444.html)\n\n## Solution:\n\n\u6211\u4eec\u63a8\u5bfc\u4e00\u4e0b\uff0c\u4e0d\u96be\u5f97\u51fa\u5b83\u8ba9\u6211\u4eec\u6c42\u7684\u4e1c\u897f\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u6740\u6b7b\u6240\u6709\u7684\u968f\u4ece\u9700\u8981$m+1$\u5f20\u4eb5\u6e0e\n\n\u8bbe$S(x)=\\sum_{i=1}^x i^{m+1}$\uff0c\u5219\u9898\u76ee\u8981\u6c42\u7684\u7b54\u6848\u8ba1\u7b97\u5f0f\u4e3a\uff1a\n\n$$F(x)=\\sum_{j=0}^m \\sum_{i=j+1}^{m+1}S(a_i-a_j-1)-S(a_{i-1}-a_j)$$\n\n\u7279\u522b\u7684\uff0c\u6211\u4eec\u4ee4$a_{m+1}=n+1$\n\n\u6211\u4eec\u53d1\u73b0\u7b2c\u4e8c\u4e2asigma\u53ef\u4ee5\u8fdb\u884c\u8f6c\u6362\uff1a\n\n$$F(x)=\\sum_{j=0}^m (S(n-a_{j})-\\sum_{i=j+1}^m(a_i-a_j)^{m+1})$$\n\n\u65e0\u6570\u795e\u7287\u544a\u8bc9\u6211\u4eec$S(x)$\u662f\u4e00\u4e2a\u4ee5x\u4e3a\u81ea\u53d8\u91cf\u7684m+2\u6b21\u591a\u9879\u5f0f([dalao\u7684\u8bc1\u660e](<https://www.cnblogs.com/hbyer/p/10821363.html>))\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u6765\u76f4\u63a5\u6c42\n\n## Code:\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int K=55;\nconst int mod=1e9+7;\nint ans,num,pro,a[K],f[K],fac[K]={1};\nint read(){\n    int x=0,f=1;char ch=getchar();\n    while(!isdigit(ch)){if(ch=='-')f=-f;ch=getchar();}\n    while(isdigit(ch)){x=x*10+ch-48;ch=getchar();}\n    return x*f;\n}\nint quickpow(int x,int y){\n\tint re=1;\n\twhile(y){\n\t\tif(y&1) re=re*x%mod;\n\t\tx=x*x%mod;y>>=1;\n\t}return re%mod;\n}\nint Lagrange(int n,int k){\n\tpro=1,num=0;\n\tif(n<=k) return f[n];\n\tfor(int i=1;i<=k;i++)\n\t\tpro=pro*(n-i)%mod;\n\tfor(int i=1;i<=k;i++){\n\t\tint inv1=quickpow(n-i,mod-2);\n\t\tint inv2=quickpow((fac[i-1]%mod*fac[k-i])%mod,mod-2);\n\t\tint sign=(k-i)&1?-1:1;\n\t\tnum=(num+sign*inv1*inv2%mod*f[i]%mod*pro%mod)%mod;\n\t}return (num+mod)%mod;\n}\nvoid solve(){\n\tint n=read(),m=read();\n\tfor(int i=1;i<=m+3;i++)\n\t\tf[i]=(f[i-1]+quickpow(i,m+1))%mod;\n\tfor(int i=1;i<=m;i++) a[i]=read();\n\tsort(a+1,a+m+1);ans=0;\n\tfor(int i=0;i<=m;i++){\n\t\tans=(ans+Lagrange(n-a[i],m+3))%mod;\n\t\tfor(int j=i+1;j<=m;j++) ans=(ans+mod-quickpow(a[j]-a[i],m+1))%mod;\n\t}printf(\"%lld\\n\",(ans+mod)%mod);\n}\nsigned main(){\n\tfor(int i=1;i<=K;i++)\n\t\tfac[i]=fac[i-1]*i%mod;\n\tint T=read();while(T--) solve();\n\treturn 0;\n}\n```",
        "postTime": 1557372304,
        "uid": 73702,
        "name": "DQYdqy",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4593 \u3010[TJOI2018]\u6559\u79d1\u4e66\u822c\u7684\u4eb5\u6e0e\u3011"
    },
    {
        "content": "\u524d\u7f6e\u829d\u58eb\uff1a[\u62c9\u683c\u6717\u65e5\u63d2\u503c](https://oi-wiki.org/math/poly/lagrange/)\n\n\u8003\u8651 $a_i$ \u5c06\u8840\u91cf\u5b58\u5728\u7684\u602a\u7269\u5206\u6210\u4e86\u81f3\u591a $m + 1$ \u4e2a\u8fde\u7eed\u6bb5\uff0c\u6211\u4eec\u73b0\u5728\u4e0d\u8003\u8651\u7a7a\u533a\u95f4\u5e26\u6765\u7684\u5f71\u54cd\uff0c\u5c06\u8fd9 $m + 1$ \u4e2a\u533a\u95f4\u8bb0\u4e3a $[l_1, r_1], [l_2, r_2], \\cdots, [l_{m + 1}, r_{m + 1}]$\uff0c\u5176\u4e2d $l_i = a_{i - 1} + 1$\uff0c$r_i = a_i - 1$\u3002\u6211\u4eec\u94a6\u5b9a $a_{m + 1} = n + 1$\u3002\n\n\u7531\u9898\u76ee\u4e2d\u7ed9\u5b9a\u7684\u89c4\u5219\u53ef\u77e5\uff1a\u65bd\u7528\u4eb5\u6e0e\u4e00\u5b9a\u662f\u4f9d\u6b21\u6d88\u9664\u6bcf\u4e2a\u8fde\u7eed\u6bb5\uff0c\u5e76\u5bf9\u540e\u9762\u7684\u8fde\u7eed\u6bb5\u9020\u6210\u5f71\u54cd\u3002\u5373\uff1a\u5f53\u6211\u4eec\u5c06\u8981\u6d88\u9664\u539f\u6765\u7684 $[l_i, r_i]$ \u65f6\uff0c\u5bf9\u4e8e\u4efb\u610f $j \\geq i$\uff0c\u539f\u6765\u7684 $[l_j, r_j]$ \u4f1a\u53d8\u6210 $[l_j - l_i + 1, r_j - l_i + 1]$\u3002\u8bbe $S_k(n) = \\displaystyle\\sum_{i = 1}^n i^k$\uff0c\u5219\u5bf9\u4e8e\u4efb\u610f $1 \\leq i \\leq j \\leq m$\uff0c\u5176\u8d21\u732e\u4e3a $S_k(r_j - l_i + 1) - S_k(l_j - l_i)$\u3002\n\n\u6700\u540e\u6765\u8003\u8651 $k$ \u7684\u503c\u3002\u7531\u4e8e\u8fde\u7eed\u6bb5\u4e00\u5b9a\u662f\u76f4\u63a5\u6d88\u9664\uff0c\u6211\u4eec\u6240\u8981\u65bd\u7528\u4eb5\u6e0e\u7684\u65f6\u5019\u4e00\u5b9a\u662f\u6d88\u9664\u5b8c\u4e00\u4e2a\u8fde\u901a\u5757\u540e\u60f3\u8981\u8de8\u8d8a\u4e24\u4e2a\u8fde\u901a\u5757\u95f4\u7684\u7a7a\u9699\uff0c\u5219\u65bd\u7528\u4eb5\u6e0e\u7684\u6b21\u6570\u4e3a $k = \\displaystyle\\sum_{i = 1}^{m + 1} (l_i - r_{i - 1} - 1) = m + 1$\u3002\u8fd9\u91cc\u6211\u4eec\u94a6\u5b9a $r_0 = -1$\u3002\n\n\u76f4\u63a5\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u8ba1\u7b97\u81ea\u7136\u6570\u5e42\u548c\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(Tm^3)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <iostream>\n#include <algorithm>\n\nusing namespace std;\n\ntypedef long long ll;\n\nconst int mod = 1e9 + 7;\nll fac[57], inv_fac[57], b[57], y[57], a[57], l[57], r[57], pre[57], suf[57];\n\ninline ll quick_pow(ll x, ll p, ll mod){\n\tll ans = 1;\n\twhile (p){\n\t\tif (p & 1) ans = ans * x % mod;\n\t\tx = x * x % mod;\n\t\tp >>= 1;\n\t}\n\treturn ans;\n}\n\ninline void init(int n){\n\tfac[0] = 1;\n\tfor (register int i = 1; i <= n; i++){\n\t\tfac[i] = fac[i - 1] * i % mod;\n\t}\n\tinv_fac[n] = quick_pow(fac[n], mod - 2, mod);\n\tfor (register int i = n - 1; i >= 0; i--){\n\t\tinv_fac[i] = inv_fac[i + 1] * (i + 1) % mod;\n\t}\n\tfor (register int i = 0; i <= n; i++){\n\t\tb[i] = inv_fac[i] * inv_fac[n - i] % mod;\n\t\tif ((n - i) % 2 != 0) b[i] = (mod - b[i]) % mod;\n\t}\n}\n\ninline ll lagrange(int n, ll y[], ll k){\n\tll ans = 0;\n\tk %= mod;\n\tfor (register int i = 0; i <= n; i++){\n\t\tpre[i] = suf[i] = ((k - i) % mod + mod) % mod;\n\t\tif (i > 0) pre[i] = pre[i] * pre[i - 1] % mod;\n\t}\n\tfor (register int i = n - 1; i >= 0; i--){\n\t\tsuf[i] = suf[i] * suf[i + 1] % mod;\n\t}\n\tfor (register int i = 0; i <= n; i++){\n\t\tll a = 1;\n\t\tif (i > 0) a = pre[i - 1];\n\t\tif (i < n) a = a * suf[i + 1] % mod;\n\t\tans = (ans + y[i] * a % mod * b[i] % mod) % mod;\n\t}\n\treturn ans;\n}\n\nint main(){\n\tint t;\n\tcin >> t;\n\tfor (register int i = 1; i <= t; i++){\n\t\tint m, k, ki, cnt = 0;\n\t\tll n, ans = 0;\n\t\tcin >> n >> m;\n\t\tk = m + 1;\n\t\tki = k + 1;\n\t\tinit(ki);\n\t\tfor (register int j = 1; j <= m; j++){\n\t\t\tcin >> a[j];\n\t\t}\n\t\tsort(a + 1, a + m + 1);\n\t\tfor (register int j = 1; j <= m; j++){\n\t\t\tcnt++;\n\t\t\tl[cnt] = a[j - 1] + 1;\n\t\t\tr[cnt] = a[j] - 1;\n\t\t}\n\t\tcnt++;\n\t\tl[cnt] = a[m] + 1;\n\t\tr[cnt] = n;\n\t\tfor (register int i = 0; i <= ki; i++){\n\t\t\ty[i] = quick_pow(i, k, mod);\n\t\t\tif (i > 0) y[i] = (y[i] + y[i - 1]) % mod;\n\t\t}\n\t\tfor (register int j = 1; j <= cnt; j++){\n\t\t\tfor (register int x = j; x <= cnt; x++){\n\t\t\t\tans = ((ans + lagrange(ki, y, r[x] - l[j] + 1) - lagrange(ki, y, l[x] - l[j])) % mod + mod) % mod;\n\t\t\t}\n\t\t}\n\t\tcout << ans << endl;\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1655538480,
        "uid": 201007,
        "name": "Leasier",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P4593 \u3010[TJOI2018] \u6559\u79d1\u4e66\u822c\u7684\u4eb5\u6e0e\u3011"
    },
    {
        "content": "~~\u8fd9\u9898\u600e\u4e48\u6ca1\u4eba\u7528\u77e9\u4e58\u554a~~\n\n\u9996\u5148\u53ef\u4ee5\u53d1\u73b0,\u8fd9\u9898\u7684 $k$ ,\u4e5f\u5c31\u662f\u4eb5\u6e0e\u4f7f\u7528\u6b21\u6570\u4e3a $m+1$ \uff0c\u7136\u540e\u7ed9\u51fa\u7684 $a_i$ \u53c8\u4f1a\u628a $[1,n]$ \u5212\u5206\u6210\u81f3\u591a $m+1$ \u4e2a\u8fde\u7eed\u6bb5\u3002\u6240\u4ee5\u5bf9\u6bcf\u6b21\u4eb5\u6e0e\uff0c\u4e00\u4e2a\u6bb5 $[l,r]$ \u7ed9\u7b54\u6848\u52a0\u4e0a $\\sum_{i=l}^r i^k$ \uff0c\u5e76\u4e14\u6240\u6709\u8fde\u7eed\u6bb5\u6574\u4f53 $-1$ \uff1b\u6b64\u5916\u5982\u679c\u67d0\u6b21\u4eb5\u6e0e\u540e\u5de6\u7aef\u70b9\u6700\u5c0f\u7684\u6bb5\u7684\u5de6\u7aef\u70b9\u4e3a $0$ \uff0c\u8bb0\u5b83\u7684\u53f3\u7aef\u70b9\u4e3a $r_1$ \uff0c\u90a3\u4e48\u4f1a\u5220\u6389\u8fd9\u4e2a\u6bb5\uff0c\u5e76\u4e14\u5176\u4ed6\u6bb5\u6574\u4f53 $-r_1$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u6a21\u62df\u4e0a\u8ff0\u8fc7\u7a0b\uff0c\u7136\u540e\u6bcf\u6b21\u5bf9\u6bb5\u64cd\u4f5c\u524d\u7edf\u8ba1 $\\sum_{i=l}^r i^k$ \u5373\u53ef\u3002\u8003\u8651\u77e9\u4e58\u6c42\u8fd9\u4e2a\u4e1c\u897f\uff0c\u5148\u628a\u4ed6\u62c6\u6210 $\\sum_{i=1}^r i^k-\\sum_{i=1}^{l-1} i^k$ \uff0c\u7136\u540e\u6211\u4eec\u6784\u9020\u884c\u5411\u91cf $\\vec{a}=\\{x^0,x^1,x^2...x^{m+1},s\\}$ \uff0c\u5373\u7ef4\u62a4\u5f53\u524d $i$ \u7684 $0$ \u5230 $m+1$ \u6b21\u5e42\u548c\u7b54\u6848\uff0c\u6784\u9020\u8f6c\u79fb\u77e9\u9635 $M$ \u5c31\u8003\u8651 $(i+1)^k=\\sum_{j=0}^{k}\\binom{k}{j}i^j$ \uff0c\u6240\u4ee5\u53ef\u4ee5\u5f97\u5230\n\n- $\\forall 0\\le i,j\\le m+1,M_{i,j}=\\binom{j}{i}$\n- $M_{m+2,m+2}=1$\n- $\\forall 0\\le i\\le m+1,M_{i,m+2}=\\binom{m+1}{i}$\n\n$\\vec{a}M^{n}$ \u7684\u7b2c $m+2$ \u9879\u5c31\u662f $\\sum i^k$ \u3002\u4e0d\u8fc7\u6ce8\u610f\u5230\u8981\u505a $m^2$ \u6b21\u8fd9\u6837\u7684\u6c42\u503c\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u4e3a $O(Tm^5logn)$\u3002\n\n\u73b0\u5728\u8003\u8651\u5012\u7740\u6a21\u62df\u4eb5\u6e0e\u7684\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u53d1\u73b0\u76f8\u5f53\u4e8e\u662f\u8981\u7ef4\u62a4\u4e00\u4e2a\u884c\u5411\u91cf\u96c6\u5408\uff0c\u6bcf\u6b21\u64cd\u4f5c\u5148\u7ed9\u6240\u6709\u884c\u5411\u91cf\u4e58\u4e0a $M$ \uff0c\u7136\u540e\u52a0\u5165\u4e00\u4e2a\u521d\u59cb\u884c\u5411\u91cf $\\{1,0,0...\\}$ \uff0c\u518d\u7ed9\u6240\u6709\u884c\u5411\u91cf\u4e58 $M^b$ (\u5176\u4e2d $b$ \u8fd9\u6b21\u4eb5\u6e0e\u5220\u6389\u7684\u6bb5\u7684\u53f3\u7aef\u70b9\u503c)\u63a5\u7740\u52a0\u5165\u4e00\u4e2a\u884c\u5411\u91cf $\\{-1,0,0...\\}$\uff0c\u6700\u540e\u628a\u6240\u6709\u884c\u5411\u91cf\u7684\u7b2c $m+2$ \u9879\u52a0\u5165\u7b54\u6848\u3002\u7531\u4e8e\u77e9\u9635\u4e58\u6cd5\u5177\u6709\u5206\u914d\u5f8b\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u7ef4\u62a4\u6240\u6709\u884c\u5411\u91cf\u7684\u548c\uff0c\u7136\u540e\u8fdb\u884c\u4e00\u4e9b\u77e9\u9635\u52a0\u6cd5\u548c\u4e58\u6cd5\u5373\u53ef\u505a\u5230 $O(Tm^4logn)$ \u3002\u6ce8\u610f\u5230\u6211\u4eec\u77e9\u4e58\u505a\u7684\u662f\u884c\u5411\u91cf\u4e58\u77e9\u9635\uff0c\u6240\u4ee5\u5355\u6b21\u77e9\u4e58\u53ef\u4ee5 $O(m^2)$ \uff0c\u7136\u540e\u6211\u4eec\u518d\u628a\u8f6c\u79fb\u77e9\u9635\u7684 $2^k$ \u6b21\u5e42\u9884\u5904\u7406\u51fa\u6765\uff0c\u5c31\u53ef\u4ee5\u505a\u5230 $O(Tm^3logn)$\u3002\n\n\u5927 \u529b \u51fa \u5947 \u8ff9\n\n```cpp\n#include<bits/stdc++.h>\n#define LL long long\n\nusing namespace std;\nconst int N=53,mod=1e9+7;\nconst LL inf=8e18;\nLL rd()\n{\n    LL x=0,w=1;char ch=0;\n    while(ch<'0'||ch>'9'){if(ch=='-') w=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9'){x=x*10+(ch^48);ch=getchar();}\n    return x*w;\t\n}\nLL n,b[N],hp[N][2];\nint m=51,t,p;\nstruct matrix\n{\n    int a[N][N];\n    matrix(){memset(a,0,sizeof(a));}\n    void clr(){memset(a,0,sizeof(a));}\n    matrix operator + (const matrix &bb) const\n    {\n    \tmatrix an;\n    \tfor(int i=0;i<=m+1;++i)\n    \t    for(int j=0;j<=m+1;++j)\n    \t\tan.a[i][j]=(a[i][j]+bb.a[i][j])%mod;\n    \treturn an;\n    }\n    matrix operator * (const matrix &bb) const\n    {\n    \tmatrix an;\n    \tfor(int i=0;i<=m+1;++i)\n    \t    for(int j=0;j<=m+1;++j)\n    \t    {\n        \t\tLL nw=0;\n        \t\tfor(int k=0;k<=m+1;++k)\n        \t\t{\n        \t\t    nw+=1ll*a[i][k]*bb.a[k][j];\n        \t\t    if(nw>inf) nw%=mod;\n        \t\t}\n        \t\tan.a[i][j]=nw%mod;\n    \t    }\n    \treturn an;\n    }\n    matrix operator & (const matrix &bb) const\n    {\n    \tmatrix an;\n    \tfor(int j=0;j<=m+1;++j)\n    \t{\n    \t    LL nw=0;\n    \t    for(int k=0;k<=m+1;++k)\n    \t    {\n        \t\tnw+=1ll*a[0][k]*bb.a[k][j];\n        \t\tif(nw>inf) nw%=mod;\n    \t    }\n    \t    an.a[0][j]=nw%mod;\n    \t}\n    \treturn an;\n    }\n}aa,m1,bb[N][N];\nint c[N][N];\nvoid inii(int h)\n{\n    for(int i=0;i<=h;++i)\n\tfor(int j=0;j<=h;++j)\n\t    bb[h][0].a[j][i]=c[i][j];\n    bb[h][0].a[h+1][h+1]=1;\n    for(int j=0;j<=h;++j)\n\tbb[h][0].a[j][h+1]=c[h][j];\n    for(int i=1;i<N;++i) bb[h][i]=bb[h][i-1]*bb[h][i-1];\n}\n\nint main()\n{\n    for(int i=0;i<N;++i)\n    {\n    \tc[i][0]=1;\n    \tfor(int j=1;j<=i;++j) c[i][j]=(c[i-1][j]+c[i-1][j-1])%mod;\n    }\n    aa.a[0][0]=1;\n    int T=rd();\n    while(T--)\n    {\n    \tn=rd(),m=rd();\n    \tb[0]=0;\n    \tfor(int i=1;i<=m;++i) b[i]=rd();\n    \tsort(b+1,b+m+1),m=unique(b+1,b+m+1)-b;\n    \twhile(m>1&&b[m-1]==n) --m,--n;\n    \tif(!bb[m][0].a[0][0]) inii(m);\n    \tb[m]=n+1,t=0;\n    \tfor(int i=1;i<=m;++i)\n    \t{\n    \t    if(b[i]==b[i-1]+1) continue;\n    \t    hp[++t][0]=b[i-1]+1,hp[t][1]=b[i]-b[i-1]-1;\n    \t}\n    \tp=0;\n    \twhile(t)\n    \t{\n    \t    b[++p]=0;\n    \t    for(int i=1;i<=t;++i) --hp[i][0];\n    \t    if(!hp[1][0])\n    \t    {\n        \t\tb[p]=hp[1][1];\n        \t\tfor(int i=2;i<=t;++i) hp[i][0]-=hp[1][1];\n        \t\tfor(int i=2;i<=t;++i) hp[i-1][0]=hp[i][0],hp[i-1][1]=hp[i][1];\n        \t\t--t;\n    \t    }\n    \t}\n    \tm1.clr();\n    \tint ans=0;\n    \twhile(p)\n    \t{\n    \t    m1=m1*bb[m][0];\n    \t    if(b[p])\n    \t    {\n        \t\tm1.a[0][0]=(m1.a[0][0]+1)%mod;\n        \t\tfor(int i=0;b[p];++i,b[p]>>=1)\n        \t\t    if(b[p]&1) m1=m1&bb[m][i];\n        \t\tm1.a[0][0]=(m1.a[0][0]-1+mod)%mod;\n    \t    }\n    \t    ans=(ans+m1.a[0][m+1])%mod;\n    \t    --p;\n    \t}\n    \tprintf(\"%d\\n\",ans);\n    }\n    return 0;\n}\n```",
        "postTime": 1580030007,
        "uid": 38372,
        "name": "star_magic_young",
        "ccfLevel": 9,
        "title": "luogu P4593 [TJOI2018]\u6559\u79d1\u4e66\u822c\u7684\u4eb5\u6e0e"
    },
    {
        "content": "~~\u4eb5\u6e0e\u7ec8\u4e8e\u79bb\u5f00\u6807\u51c6\u4e86\uff0c\u7136\u800c\u94fa\u573a\u5feb\u653b\u4e5f\u53d8\u5c11\u4e86~~\n\n\u7ed9\u4e00\u4e2a\u5927\u529b\u679a\u4e3e\uff08\u65e0\u4efb\u4f55\u6027\u8d28\uff09+\u8279\u51fa**\u81ea\u7136\u6570\u5e42\u548c**\u7684\u65b9\u6cd5\uff0c\u4f46\u662f\u590d\u6742\u5ea6\u6781\u9650\u662f$O(k^4)$\u7684\uff0c\u4e0d\u8fc7\u8dd1\u7684\u597d\u5feb233\n\n\u9996\u5148\u7b80\u5355\u6570\u5b66\u5206\u6790\u53ef\u4ee5\u5f97\u51fa$k=m+1$\uff0c\u56e0\u4e3a\u6bcf\u591a\u4e00\u4e2a\u7a7a\u7f3a\u5c31\u4f1a\u6253\u65ad\u4e00\u5f20\u4eb5\u6e0e\u7684\u8fde\u51fb\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a\u7a7a\u7f3a\u6c42\u51fa\u7b54\u6848\uff0c\u53d1\u73b0\u6b64\u65f6\u6240\u6c42\u7b54\u6848\u5fc5\u5b9a\u4e3a\u4e00\u6bb5\u81ea\u7136\u6570\u5e42\u548c\u5e76\u4e14\u51cf\u53bb\u7a7a\u7f3a\u7684\u6570\u5b57\u5e42\n\n\u53d1\u73b0\u6570\u636e\u8303\u56f4$m\\le 50$\uff0c\u90a3\u4e48\u6211\u4eec\u76f4\u63a5\u66b4\u529b\u6c42\u51fa\u6240\u6709\u8fde\u7eed\u7684\u6bb5\uff0c\u7136\u540e\u5927\u529b\u679a\u4e3e\u8fd9\u4e00\u6bb5\u5f00\u59cb\u6700\u4f4e\u7684\u602a\u7684\u8840\u91cf\n\n\u7a7a\u7f3a\u4e0d\u59a8\u66b4\u529b\u679a\u4e3e\uff0c\u533a\u95f4\u5185\u7684\u81ea\u7136\u6570\u5e42\u548c\u76f4\u63a5**\u5dee\u5206**\u4e00\u4e0b\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u80fd\u5feb\u901f\u6c42\u51fa$S(n)=\\sum_{i=1}^n i^k$\u5373\u53ef\n\n\u8fd9\u91cc\u7528\u4e86**\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570**\u7684\u63a8\u6cd5\uff0c$S(n)=\\sum_{i=1}^n i^k=\\sum_{i=0}^n i^k$\n\n$$=\\sum_{i=0}^n\\sum_{j=0}^k\\{ _j^k\\}i^{\\underline j}$$\n\n$$=\\sum_{j=0}^k\\{ _j^k\\}\\sum_{i=0}^ni^{\\underline j}$$\n\n$$=\\sum_{j=0}^k\\{ _j^k\\}j!\\sum_{i=0}^n C_i^j$$\n\n\u7528\u5f52\u7eb3\u6cd5\uff0c\u5f97$\\sum_{i=0}^n C_i^j=C_{n+1}^{j+1}$\uff0c\u6240\u4ee5\u4e0a\u5f0f\n\n$$=\\sum_{j=0}^k\\{ _j^k\\}j!C_{n+1}^{j+1}$$\n\n$$=\\sum_{j=0}^k\\{ _j^k\\}\\frac{(n+1)^{\\underline{j+1}}}{j+1}$$\n\n\u6240\u4ee5\u6211\u4eec\u9884\u5904\u7406\u51fa\u7ec4\u5408\u6570\u548c\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\uff0c\u8fd9\u90e8\u5206\u5c31\u662f$O(k^2)$\u8ba1\u7b97\u7684\n\n\u56e0\u6b64\u603b\u590d\u6742\u5ea6\u4e0a\u754c\u4e3a$O(k^4)$\uff0c\u5b9e\u9645\u5728$O(k^3)$\u5de6\u53f3\uff08\u7a7a\u7f3a\u4e0d\u8fde\u7eed\uff09\n\nCODE\n\n```cpp\n#include<cstdio>\n#include<map>\n#include<algorithm>\n#define RI register int\n#define CI const int&\nusing namespace std;\ntypedef long long LL;\nconst int N=55,mod=1e9+7;\nint t,n,m,ans,cnt,pfx[N],s[N][N]; LL a[N],pos[N]; map <LL,int> ts;\ninline void inc(int& x,CI y)\n{\n\tif ((x+=y)>=mod) x-=mod;\n}\ninline void dec(int& x,CI y)\n{\n\tif ((x-=y)<0) x+=mod;\n}\ninline void Stirling_init(CI n)\n{\n\ts[0][0]=1; for (RI i=1;i<=n;++i) for (RI j=1;j<=i;++j)\n\ts[i][j]=s[i-1][j-1],inc(s[i][j],1LL*j*s[i-1][j]%mod);\n}\ninline int quick_pow(int x,int p=mod-2,int mul=1)\n{\n\tfor (;p;p>>=1,x=1LL*x*x%mod) if (p&1) mul=1LL*mul*x%mod; return mul;\n}\ninline int low_fact(const LL& x,CI t,int ret=1)\n{\n\tfor (RI i=1;i<=t;++i) ret=1LL*ret*(x-i+1)%mod; return ret;\n}\ninline int pow_sum(const LL& x,CI k,int ret=0)\n{\n\tfor (RI i=1;i<=k;++i) inc(ret,1LL*s[k][i]*low_fact(x+1,i+1)%mod*quick_pow(i+1)%mod); return ret;\n}\ninline int calc(CI x,const LL& y,CI k)\n{\n\tint ret=pow_sum(y,k); dec(ret,pow_sum(x-1,k)); return ret;\n}\ninline int none_sum(CI st,const LL& lim,CI k,int ret=0)\n{\n\tfor (RI i=1;i<=m;++i) if (a[i]>=lim) inc(ret,quick_pow(st+a[i]-lim,k)); return ret;\n}\nint main()\n{\n\tfor (scanf(\"%d\",&t);t;--t)\n\t{\n\t\tRI i,j; for (ts.clear(),scanf(\"%d%d\",&n,&m),i=1;i<=m;++i) scanf(\"%lld\",&a[i]),ts[a[i]]=1;\n\t\tfor (sort(a+1,a+m+1),pos[cnt=i=1]=pfx[1]=1;i<=m;++i) if (a[i]!=n)\n\t\tif (ts.count(a[i]+1)) ts[a[i]+1]+=ts[a[i]]; else pos[++cnt]=a[i]+1,pfx[cnt]=ts[a[i]];\n\t\tfor (ans=0,Stirling_init(m+1),i=1;i<=cnt;++i) for (j=1;j<=pfx[i];++j)\n\t\tinc(ans,calc(j,j+n-pos[i],m+1)),dec(ans,none_sum(j,pos[i],m+1)); printf(\"%d\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1559122392,
        "uid": 41698,
        "name": "hl666",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P4593 \u3010[TJOI2018]\u6559\u79d1\u4e66\u822c\u7684\u4eb5\u6e0e\u3011"
    },
    {
        "content": "\u4e00\u6b21\u4eb5\u6e0e\u53ef\u4ee5\u6740\u6b7b\u7684\u968f\u4ece\u8840\u91cf\u533a\u95f4\u4e3a $[1,r]$ \u7684\u4e00\u4e2a\u8fde\u7eed\u6bb5\uff0c\u5176\u4e2d $r$ \u8840\u91cf\u7684\u968f\u4ece\u4e0d\u5b58\u5728\uff08\u6ce8\u610f\u8fd9\u5f20\u4eb5\u6e0e\u9020\u6210\u7684\u4f24\u5bb3\u4e3a $r+1$\uff0c\u5373\u6740\u6b7b\u8840\u91cf\u4e3a $r$ \u7684\u968f\u4ece\u540e\u8fd8\u4f1a\u91ca\u653e\u4e00\u6b21\u6548\u679c\uff09\uff0c\u800c\u9664\u4e86\u6700\u540e\u4e00\u6b21\u4eb5\u6e0e\u4ee5\u5916\uff0c\u6bcf\u6b21\u4eb5\u6e0e\u90fd\u53ef\u4ee5\u5e26\u8d70\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u8840\u91cf\uff0c\u4e8e\u662f $k=m+1$\u3002\n\n\u4e0a\u9762\u5df2\u7ecf\u63d0\u5230\uff0c\u4e00\u6b21\u4eb5\u6e0e\u9020\u6210\u7684\u4f24\u5bb3\u76f8\u5f53\u4e8e\u4e3a $O(k)$ \u4e2a\u8fde\u7eed\u6bb5\uff0c\u53ef\u4ee5\u5148\u9884\u5904\u7406\u5904\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u3002\n\n\u679a\u4e3e\u4f7f\u7528\u6bcf\u5f20\u4eb5\u6e0e\u524d\u5df2\u7136\u9020\u6210\u7684\u4f24\u5bb3\u4ee5\u53ca\u6bcf\u4e2a\u8fde\u7eed\u6bb5\uff0c\u8fd9\u90e8\u5206\u662f $O(k^2)$ \u7684\u3002\n\n\u5355\u72ec\u8003\u8651\u4e00\u4e2a\u8fde\u7eed\u6bb5 $[L,R]$\uff0c\u4f7f\u7528\u8fd9\u5f20\u4eb5\u6e0e\u4e4b\u524d\u5df2\u7ecf\u9020\u6210\u4e86 $d$ \u7684\u4f24\u5bb3\uff0c\u4e5f\u5c31\u662f\u6c42\uff1a\n\n$$\\sum_{i=L-d}^{R-d} i^k$$\n\n\u4f7f\u7528\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u8f6c\u6210\u4e0b\u964d\u5e42\uff08\u6216\u8005\u662f\u7ec4\u5408\u6570\uff09\uff1a\n\n$$\\sum_{i=L-d}^{R-d}\\sum_{j=0}^k S_2(k,j)\\times j!\\times \\dbinom{i}{j}$$\n\n\u4ea4\u6362\u6c42\u548c\u53f7\u5e76\u5199\u6210\u5dee\u5206\u5f62\u5f0f\uff1a\n\n$$\\sum_{j=0}^k S_2(k,j)\\times j!\\times \\left(\\sum_{i=0}^{R-d} \\dbinom{i}{j}-\\sum_{i=0}^{L-d-1}\\dbinom{i}{j}\\right)$$\n\n\u53f3\u9762\u4e00\u5768\u5b9e\u9645\u4e0a\u662f\uff1a\n\n$$\\dbinom{R-d+1}{j+1}-\\dbinom{L-d}{j+1}$$\n\n$j$ \u5f88\u5c0f\uff0c\u6240\u4ee5\u53ef\u4ee5\u628a\u7ec4\u5408\u6570\u62c6\u6210\u4e00\u4e2a $j+1$ \u6b21\u4e0b\u964d\u5e42\u9664\u4ee5 $(j+1)!$\uff0c\u53ef\u4ee5\u66b4\u529b\u6c42\u3002\n\n\u603b\u590d\u6742\u5ea6\u662f $O(k^4)$\u3002\n\n\uff08\u8f93\u5165\u4e0d\u4fdd\u8bc1 $a_i$ \u9012\u589e\uff09\n\n```cpp\nint t;\nint n,m;\nll a[55];\nint S[55][55];\nint fact[55],fact_inv[55];\nint q_pow(int x,int p){\n    int res=1;\n    while(p){\n        if(p&1) res=1ll*res*x%mod;\n        x=1ll*x*x%mod;\n        p>>=1;\n    }\n    return res;\n}\nvector<ll> D;\nvector<pll> Seg; \n\n#define L first\n#define R second\n\ninline int C(ll N,int M){\n    if(N<M) return 0;\n    // printf(\"%lld %d\\n\",N,M);\n    int res=1;\n    for(int i=0;i<M;++i) res=1ll*res*(N-i)%mod;\n    res=1ll*res*fact_inv[M]%mod;\n    return res;\n}\n\nint ans;\n\nint main(){\n    // freopen(\"test.in\",\"r\",stdin);\n    // freopen(\"test.out\",\"w\",stdout);\n    S[0][0]=1;\n    for(int i=1;i<=B;++i){\n        S[i][0]=0;\n        for(int j=1;j<=i;++j){\n            S[i][j]=(S[i-1][j-1]+1ll*j*S[i-1][j]%mod)%mod;\n        }\n    }\n    fact[0]=fact_inv[0]=1;\n    for(int i=1;i<=B;++i) fact[i]=1ll*fact[i-1]*i%mod;\n    fact_inv[B]=q_pow(fact[B],mod-2);\n    for(int i=B-1;i>=1;--i) fact_inv[i]=1ll*fact_inv[i+1]*(i+1)%mod;\n    t=read();\n    while(t--){\n        D.clear();\n        Seg.clear();\n        n=read(),m=read();\n        D.push_back(0);\n        for(int i=1;i<=m;++i) a[i]=read();\n        sort(a+1,a+m+1);\n        ll last=0;\n        for(int i=1;i<=m;++i){\n            ll x=a[i];\n            if(x==last+1) D.push_back(x);\n            else{\n                D.push_back(x);\n                Seg.push_back(make_pair(last+1,x-1));\n            }\n            last=x;\n        }\n        Seg.push_back(make_pair(last+1,n));\n        // for(ll i:D) printf(\"%lld \",i);\n        // printf(\"\\n\");\n        // for(pll i:Seg) printf(\"[%lld,%lld] \",i.L,i.R);\n        // printf(\"\\n\");\n        int k=m+1;\n        ans=0;\n        for(ll i:D){\n            for(pll p:Seg){\n                if(i>=p.R) continue;\n                for(int j=0;j<=k;++j){\n                    int sum=(C(p.R-i+1,j+1)-C(p.L-i,j+1)+mod)%mod;\n                    ans=(ans+1ll*S[k][j]*fact[j]%mod*sum%mod)%mod;\n                } \n            }\n        }\n        printf(\"%d\\n\",ans);\n    }\n    return 0;\n}\n```\n",
        "postTime": 1674780286,
        "uid": 321177,
        "name": "SoyTony",
        "ccfLevel": 6,
        "title": "P4593 \u9898\u89e3"
    },
    {
        "content": "[\u9898\u76ee](https://www.luogu.org/problemnew/show/P4593)\n\n\u600e\u4e48\u6ca1\u4eba\u7528$O(klogn)$\u7684\u63d2\u503c\u554a\n\n\u9996\u5148\n\n$$\\sum_{i=1}^ni^{m+1}$$\n\n\u662f\u4e00\u4e2a\u4ee5$n$\u4e3a\u81ea\u53d8\u91cf\u7684$m+2$\u6b21\u591a\u9879\u5f0f\uff0c\u6211\u4eec\u9700\u8981$m+3$\u4e2a\u70b9\u624d\u80fd\u786e\u5b9a\u8fd9\u4e2a\u591a\u9879\u5f0f\n\n\u62ff\u51fa\u62c9\u683c\u6717\u65e5\u63d2\u503c\u7684\u67ff\u5b50\n\n$$f(x)=\\sum_{i=1}^{m+3}y_i\\prod_{i\\ne j}\\frac{x-x_j}{x_i-x_j}$$\n\n\u6211\u4eec\u53d1\u73b0\u5982\u679c\u6211\u4eec\u4e0b\u9762\u5e26\u7684\u70b9\u662f\u8fde\u7eed\u7684\u81ea\u7136\u6570\u7684\u8bdd\uff0c\u5206\u6bcd\u4e0a\u5c31\u662f\u4e24\u7ec4\u9636\u4e58\u76f8\u4e58\uff0c\u4e0d\u8fc7\u5957\u8bba\u4e00\u4e0b\u5947\u5076\u6027\u6765\u786e\u5b9a\u7b26\u53f7\n\n\u5206\u5b50\u4e0a\u6211\u4eec\u76f4\u63a5\u5904\u7406\u597d$\\prod x-x_j$\uff0c\u6211\u4eec\u6bcf\u6b21\u4e58\u4e0a$x-x_i$\u7684\u9006\u5143\u5c31\u597d\u4e86\n\n\u4e4b\u540e\u5982\u679c$n<=m+3$\u6211\u4eec\u76f4\u63a5\u66b4\u529b\n\n\u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#define max(a,b) ((a)>(b)?(a):(b))\n#define min(a,b) ((a)<(b)?(a):(b))\n#define LL long long\n#define re register\n#define maxn\nconst LL mod=1e9+7;\ninline LL read() {\n\tLL x=0;char c=getchar();while(c<'0'||c>'9') c=getchar();\n\twhile(c>='0'&&c<='9') x=(x<<3)+(x<<1)+c-48,c=getchar();return x;\n}\nint T;\nLL n,m,fac[55],a[55];\ninline LL quick(LL a,LL b) {LL S=1;while(b) {if(b&1ll) S=S*a%mod;b>>=1ll;a=a*a%mod;}return S;}\ninline LL calc(LL n,int m) {\n\tif(n<=m+2) {\n\t\tLL ans=0;\n\t\tfor(re int i=1;i<=n;i++) ans=(ans+quick(i,m)%mod)%mod;\n\t\treturn ans;\n\t}\n\tLL ans=1,now=0,tot=0;\n\tfor(re int i=1;i<=m+2;i++) \n\t\tans=(ans*(n-i+mod)%mod)%mod;\n\tfor(re int i=1;i<=m+2;i++) {\n\t\tnow=now+quick(i,m);now%=mod;\n\t\tLL t=ans*quick((n-i+mod)%mod,mod-2)%mod,q=quick(fac[m+2-i]*fac[i-1]%mod,mod-2);\n\t\tif((m+2-i)&1) tot-=now*t%mod*q%mod;\n\t\t\telse tot+=now*t%mod*q%mod;\n\t\ttot+=mod;tot%=mod;\n\t}\n\treturn tot;\n}\nint main() {\n\tT=read();fac[0]=1;\n\tfor(re int i=1;i<=54;i++) fac[i]=(fac[i-1]*(LL)i)%mod;\n\twhile(T--) {\n\t\tn=read(),m=read();\n\t\tfor(re int i=1;i<=m;i++) a[i]=read();\n\t\tstd::sort(a+1,a+m+1);\n\t\tLL ans=0;\n\t\tfor(re int i=0;i<=m;i++) {\n\t\t\tans+=calc(n-a[i],m+1);ans%=mod;\n\t\t\tfor(re int j=i+1;j<=m;j++)\n\t\t\t\tans=(ans-quick(a[j]-a[i],m+1)%mod+mod)%mod;\n\t\t}\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1551776598,
        "uid": 35178,
        "name": "asuldb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4593 \u3010[TJOI2018]\u6559\u79d1\u4e66\u822c\u7684\u4eb5\u6e0e\u3011"
    },
    {
        "content": "## \u601d\u8def\n\u5206\u6790\u9898\u610f\uff0c\u53ef\u4ee5\u53d1\u73b0\u9898\u76ee\u5c31\u662f\u6c42$\\sum(\\sum_{i=1}^{n}i^{m+1}-x_i^{m+1})$\uff0c\u8fd9\u91cc\u7684$x_i$\u4e3a\u7a7a\u7f3a\u7684\u4f4d\u7f6e\u3002\n\u56e0\u4e3a$m$\u5f88\u5c0f\uff0c\u6240\u4ee5\u6211\u4eec\u4e3b\u8981\u6c42$\\sum_{i=1}^{n}i^{m+1}$\u3002\n\n\u8fd9\u91cc\u53ef\u4ee5\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u6765\u505a\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u77e5\u9053:$\\sum_{i=1}^{n}i^{m+1}$\u4e3a\u4e00\u4e2a\u4e0e$n$\u6709\u5173\u7684$m+2$\u6b21\u591a\u9879\u5f0f\uff0c\u8fd9\u65f6\u6211\u4eec\u9700\u8981$m+3$\u4e2a\u70b9\u4fbf\u80fd\u786e\u5b9a\u8fd9\u4e2a\u591a\u9879\u5f0f\u4e86\u3002\u5177\u4f53\u8bc1\u660e\u7684\u8bdd\u8981\u5229\u7528\u5dee\u5206\u7684\u6709\u5173\u77e5\u8bc6~~(\u6211\u4e5f\u4e0d\u600e\u4e48\u4f1a)~~\u3002\u4e3e\u4e2a\u4f8b\u5b50\u53ef\u4ee5\u5e2e\u52a9\u7406\u89e3\uff1a\u4ee4$f(i)=i$\uff0c\u90a3\u4e48$\\sum_{i=1}^{n}f(i)=n*(n+1)/2$\uff0c\u8fd9\u5c31\u662f\u4e00\u4e2a\u4e0e$n$\u6709\u5173\u7684$2$\u6b21\u591a\u9879\u5f0f\u3002\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u76f4\u63a5\u62c9\u683c\u6717\u65e5\u63d2\u503c\u6765\u641e\u4e86\uff0c\u5148\u628a\u76f8\u5173\u5f0f\u5b50\u5217\u51fa\u6765\uff1a\n$$f(k)=\\sum{y_i}\\prod_{i!=j}\\frac{k-x_j}{x_i-x_j}$$\n\u4ee4$g=\\prod{k-x_i}$\uff0c\u5219\u8868\u8fbe\u5f0f\u53ef\u5199\u4e3a\uff1a\n$$f(k)=g\\sum{\\frac{y_i}{k-x_i}}\\prod_{i!=j}\\frac{1}{x_i-x_j}$$\n\u4e4b\u540e\u4ee4$t_i=\\prod_{i!=j}\\frac{1}{x_i-x_j}$\uff0c\u5f0f\u5b50\u5c31\u53ef\u4ee5\u5199\u4e3a\uff1a\n$$f(k)=g\\sum{\\frac{y_i*t_i}{k-x_i}}$$\n\n\u5982\u679c\u6211\u4eec\u53d6$x_i=i$\u7684\u8bdd\uff0c$t_i$\u7684\u8868\u8fbe\u5f0f\u5219\u53ef\u5199\u4e3a\u9636\u4e58\u7684\u5f62\u5f0f:\n$$t_i=\\frac{1}{fac(i-1)*fac(n-i)}$$\n\u6b63\u8d1f\u53f7\u81ea\u5df1\u63a8\u4e00\u63a8\u5c31\u597d\u4e86\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u5229\u7528\u63d2\u503c\u6c42\u51fa$f(k)$\uff0c\u53ea\u8981\u786e\u5b9a$m+3$\u4e2a\u70b9\u5c31\u884c\u4e86\uff0c\u4e00\u822c\u65b9\u4fbf\u8d77\u89c1\u5c31\u662f$1$~$m+3$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5c06$t_i$\u8868\u8fbe\u4e3a\u9636\u4e58\u7684\u5f62\u5f0f\u3002\n\n\u5982\u679c$n<=m+3$\uff0c\u76f4\u63a5\u66b4\u529b\u6c42\u89e3\u5c31\u884c\u4e86\u3002\n\n\u5177\u4f53\u7ec6\u8282\u89c1\u4ee3\u7801\u5427\uff1a\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N = 55, MOD = 1e9 + 7;\nint T;\nll a[N], fac[N];\nll qp(ll A, ll B) {\n    ll ans = 1;\n    while(B) {\n        if(B & 1) ans = ans * A % MOD;\n        A = A * A % MOD;\n        B >>= 1;\n    }\n    return ans ;\n}\nvoid add(ll &x, ll y, ll z) {\n    x += z * y % MOD;\n    x %= MOD;\n    if(x < 0) x += MOD;\n}\nvoid mul(ll &x, ll y) {\n    x *= y;\n    x %= MOD;\n    if(x < 0) x += MOD;\n}\nll calc(ll n, ll m) {\n    ll ans = 0;\n    if(n <= m + 2) {\n        for(int i = 1; i <= n; i++) add(ans, qp(i, m), 1) ;\n        return ans ;\n    }\n    ll g = 1, y = 0;\n    for(int i = 1; i <= m + 2; i++) mul(g, n - i);\n    for(int i = 1; i <= m + 2; i++) {\n        ll t = qp(fac[i - 1] * fac[m + 2 - i] % MOD, MOD - 2) ;\n        if((m + 2 - i) & 1) t = -t;\n        add(y, qp(i, m), 1);\n        ll tmp = qp(n - i, MOD - 2);\n        mul(tmp, t * y % MOD * g % MOD) ;\n        add(ans, tmp, 1);\n    }\n    return ans;\n}\nint main() {\n    ios::sync_with_stdio(false); cin.tie(0);\n    fac[0] = 1;\n    for(int i = 1; i < N; i++) fac[i] = fac[i - 1] * i % MOD ;\n    cin >> T;\n    while(T--) {\n        int n, m;\n        cin >> n >> m;\n        for(int i = 1; i <= m; i++) cin >> a[i];\n        sort(a + 1, a + m + 1) ;\n        ll ans = 0;\n        for(int i = 0; i <= m; i++) {\n            add(ans, calc(n - a[i], m + 1), 1);\n            for(int j = i + 1; j <= m; j++)\n                add(ans, qp(a[j] - a[i], m + 1), -1) ;\n        }\n        cout << ans << '\\n';\n    }\n    return 0;\n}\n\n```",
        "postTime": 1559733335,
        "uid": 29563,
        "name": "heyuhhh",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P4593 \u3010[TJOI2018]\u6559\u79d1\u4e66\u822c\u7684\u4eb5\u6e0e\u3011"
    },
    {
        "content": "\u9898\u89e3\u540c\u6b65\u53d1\u5728[\u535a\u5ba2](https://foreverlasting1202.github.io/)\n\n\u62c9\u683c\u6717\u65e5\u63d2\u503c\u3002\n\n\u6211\u89c9\u5f97\u662f\u4e0d\u662f\u9898\u9762\u63cf\u8ff0\u975e\u5e38\u4e0d\u6e05\u554a\uff0c\u4e8b\u5b9e\u4e0a\u7b54\u6848\u4e00\u5b9a\u662f$\\sum \\sum_{i} i^{m+1}$\uff0c\u6240\u4ee5\u66b4\u529b\u63d2\u503c\u5c31\u597d\u4e86\u3002\n\ncode:\n```\n//2018.12.15 by ljz\n#include<bits/stdc++.h>\nusing namespace std;\n#define res register LL\n#define LL long long\n#define inf 0x3f3f3f3f\n#define eps 1e-15\ninline LL read(){\n    res s=0;\n    bool w=0;\n    char ch=getchar();\n    while(ch<'0'||ch>'9'){if(ch=='-')w=1;ch=getchar();}\n    while(ch>='0'&&ch<='9')s=s*10+ch-'0',ch=getchar();\n    return w?-s:s;\n}\ninline void _swap(res &x,res &y){\n    x^=y^=x^=y;\n}\ninline LL _abs(const res &x){\n    return x>0?x:-x;\n}\ninline LL _max(const res &x,const res &y){\n    return x>y?x:y;\n}\ninline LL _min(const res &x,const res &y){\n    return x<y?x:y;\n}\nconst LL kcz=1e9+7,K=50+10;\nnamespace MAIN{\n    LL T,n,m;\n    LL f[K];\n    inline LL qpow(res x,res y){\n        res ret=1;\n        while(y){\n            if(y&1)ret=1LL*ret*x%kcz;\n            y>>=1,x=1LL*x*x%kcz;\n        }\n        return ret%kcz;\n    }\n    inline void add(res &x,const res &y){\n        x+=y;\n        x>=kcz?x-=kcz:1;\n        x<0?x+=kcz:1;\n    }\n    inline LL calc(const res &x,const res &n){\n        if(x<=n)return f[x];\n        res tmp=1,ret=0,p=(n&1)?kcz-1:1;\n        for(res i=1;i<=n;i++)tmp=1LL*tmp*(x-i)%kcz*qpow(i,kcz-2)%kcz;\n        for(res i=0;i<=n;i++,p=kcz-p)\n            add(ret,1LL*p*f[i]%kcz*tmp%kcz),tmp=1LL*tmp*(x-i)%kcz*qpow(x-i-1,kcz-2)%kcz*(n-i)%kcz*qpow(i+1,kcz-2)%kcz;\n        return ret;\n    }\n    LL a[K];\n    inline void MAIN(){\n        T=read();\n        while(T--){\n            res ans=0;\n            n=read(),m=read();\n            for(res i=1;i<=m;i++)a[i]=read();\n            sort(a+1,a+m+1);\n            for(res i=1;i<=m+2;i++)f[i]=0,add(f[i],f[i-1]+qpow(i,m+1));\n            for(res i=1;i<=m+1;i++){\n                res now=n-a[i-1];\n                add(ans,calc(now,m+2));\n                for(res j=i;j<=m;j++)add(ans,kcz-qpow(a[j]-a[i-1],m+1));\n            }\n            printf(\"%lld\\n\",ans);\n        }\n    }\n}\nint main(){\n    MAIN::MAIN();\n    return 0;\n}\n```",
        "postTime": 1544844661,
        "uid": 32878,
        "name": "foreverlasting",
        "ccfLevel": 7,
        "title": "\u3010TJOI2018\u3011\u6559\u79d1\u4e66\u822c\u7684\u4eb5\u6e0e"
    }
]