[
    {
        "content": "#### \u9996\u5148\uff0c\u6839\u636e\u9898\u76ee\u610f\u601d\uff0c\u663e\u7136\u6700\u77ed\u8def\u5f84\u6709\u4e00\u4e2a\u6027\u8d28\uff1a\u53ea\u5728\u8282\u70b9\u5904\u8f6c\u5f2f\n\n\u4e8e\u662f\u6211\u4eec\u8003\u8651\u679a\u4e3e\u6bcf\u4e00\u5bf9\u70b9\uff0c\u7b97\u51fa\u5b83\u4eec\u4e4b\u95f4\u8d70\u76f4\u7ebf\u7684\u8ddd\u79bb\uff0c\u7136\u540e\u8dd1\u6700\u77ed\u8def\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u90a3\u4e48\uff0c\u8be5\u600e\u4e48\u6c42\u6700\u77ed\u8def\u5462\uff1f\n\n\u6700\u77ed\u8def\u53ef\u4ee5\u7528 \u7a7a\u5730\u8d70\u8fc7\u7684\u603b\u957f\u5ea6*u0+\u56db\u8fb9\u5f62\u5185\u82b1\u8d39\u7684\u603b\u4ef7\u503c\u8ba1\u7b97\n\n\u5bf9\u4e8e\u51f8\u56db\u8fb9\u5f62\uff0c\u4e00\u6761\u7ebf\u6bb5\uff08\u6ce8\u610f\u7ebf\u6bb5\uff01\uff01\uff09\u548c\u5b83\u81f3\u591a\u6709\u4e24\u4e2a\u4ea4\u70b9\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u627e\u51fa\u7ebf\u6bb5\u548c\u51f8\u56db\u8fb9\u5f62\u7684\u6240\u6709\u4ea4\u70b9\u5e76\u53bb\u91cd\uff0c\u5982\u679c\u521a\u597d\u5269\u4e0b\u4e24\u4e2a\u4ea4\u70b9\u76f4\u63a5\u7b97\u8ddd\u79bb\u548c\u4ee3\u4ef7\u4e86\uff0c\u5426\u5219\u7ebf\u6bb5\u548c\u591a\u8fb9\u5f62\u6ca1\u6709\u4ea4\u70b9\u3002\n\n\uff08\u6ce8\u610f\uff1a\u7ebf\u6bb5\u548c\u56db\u8fb9\u5f62\u7684\u4ea4\u70b9\u5982\u679c\u662f\u56db\u8fb9\u5f62\u4e24\u4e2a\u76f8\u90bb\u7684\u9876\u70b9\uff0c\u4e5f\u5f53\u505a\u65e0\u4ea4\u70b9\u5904\u7406\uff09\n\n\u5bf9\u4e8e\u51f9\u56db\u8fb9\u5f62\uff0c\u53ef\u4ee5\u627e\u51fa\u5b83\u5927\u4e8e180\u5ea6\u7684\u89d2\uff0c\u5e76\u6cbf\u8fd9\u4e2a\u89d2\u7684\u9876\u70b9\u6240\u5728\u7684\u5bf9\u89d2\u7ebf\u5c06\u5b83\u5206\u4e3a\u4e24\u4e2a\u4e09\u89d2\u5f62\uff0c\u63a5\u7740\u5c31\u662f\u548c\u51f8\u56db\u8fb9\u5f62\u4e00\u6837\u7684\u505a\u6cd5\u4e86\u3002\n\n\uff08\u6ce8\u610f\uff1a\u88ab\u5206\u5f00\u7684\u4e09\u89d2\u5f62\u539f\u672c\u6709\u4e00\u6761\u8fb9\u662f\u5728\u56db\u8fb9\u5f62\u5185\u7684\uff0c\u5982\u679c\u7ebf\u6bb5\u548c\u4e09\u89d2\u5f62\u5171\u8fd9\u6761\u8fb9\uff0c\u4e0d\u80fd\u5f53\u505a\u65e0\u4ea4\u70b9\u5904\u7406\uff0c\u5171\u5176\u5b83\u8fb9\u5219\u53ef\u4ee5\u5f53\u505a\u65e0\u4ea4\u70b9\u5904\u7406\uff09\n\n\u5904\u7406\u5b8c\u6bcf\u4e00\u5bf9\u8ddd\u79bb\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u8dd1\u6700\u77ed\u8def\u4e86\uff0c\u590d\u6742\u5ea6\u662f (4n)^3 \u7684\uff0c\u6211\u7684\u4ee3\u7801\u7531\u4e8estl\u7528\u7684\u592a\u591a\uff0c\u52a0\u4e0a\u5199\u7684\u592a\u4e11\uff0c\u6240\u4ee5\u5f00O2\u624d\u8fc7\u7684\u53bb\u3002\n\n\u8003\u573a\u4ee3\u7801\u6539\u4e86\u6539\uff1a\n```cpp\n#include<bits/stdc++.h>\n#pragma GCC optimize(2)\n#define d(i,j) ((i-1)*4+j+3)\n#define P pair<ld,int>\nusing namespace std;\ntypedef long double ld;\nconst ld eps=1e-4,inf=1e12;\nconst int N=415,M=200010;\nint ppp=0;\nld dt[N],w[M],f[M],dis[N],g[N];\nint n,s=1,t=2,siz[N],vis[N],fst[N],nxt[M],u[M],v[M],tot;//siz:\u5355\u4e2a\u56fe\u5f62\u4e2d\u70b9\u7684\u6570\u91cf \nbool del[N],fl[N];//del:\u56db\u8fb9\u5f62\u88ab\u5272\u5f00\u540e\u88ab\u5220\u6389\uff08\u79fb\u8d70\uff09\u7684\u70b9\uff0cfl\uff1a\u88ab\u5272\u5f00\u7684\u90a3\u6761\u8fb9\u7ecf\u8fc7\u7684\u70b9\uff08\u5bf9\u5e94\u6ce8\u610f2\uff09 \npriority_queue<P > q;\nstruct aa\n{\n\tld x,y;\n\tbool operator <(const aa &b)const{return fabs(x-b.x)<eps? y<b.y:x<b.x;}\n\tbool operator ==(const aa &b)const{return fabs(x-b.x)+fabs(y-b.y)<eps;}\n\taa operator +(const aa &b)const{return aa{x+b.x,y+b.y};}\n\taa operator -(const aa &b)const{return aa{x-b.x,y-b.y};}\n\taa operator *(const ld &b)const{return aa{x*b,y*b};}\n\tld operator *(const aa &b)const{return x*b.x+y*b.y;}\n\tld operator ^(const aa &b)const{return x*b.y-y*b.x;}\n\tld len() {return sqrt(x*x+y*y);}\n\tvoid read() {scanf(\"%Lf%Lf\",&x,&y);}\n}pt[N];\nstruct bb {aa s,t;};\nvoid add(int lu,int lv,ld lw,ld lf)\n{\n\tu[++tot]=lu,v[tot]=lv,w[tot]=lw,f[tot]=lf,nxt[tot]=fst[lu],fst[lu]=tot;\n\tu[++tot]=lv,v[tot]=lu,w[tot]=lw,f[tot]=lf,nxt[tot]=fst[lv],fst[lv]=tot;\n}\nbool px(bb a,bb b) {return fabs((b.t-b.s)^(a.t-a.s))<eps;} //\u5224\u65ad\u5e73\u884c \naa crs(bb a,bb b) {return b.s+(b.t-b.s)*(((b.s-a.s)^(a.t-a.s))/((a.t-a.s)^(b.t-b.s)));} //\u6c42\u4ea4\u70b9 \nbool inn(bb a,aa b) {return fabs((b-a.s).len()+(b-a.t).len()-(a.t-a.s).len())<eps;} //\u5224\u65ad\u662f\u5426\u5728\u76f4\u7ebf\u4e0a \nld work2(bb a,int b)\n{\n\tint i,j,fll=0,lf=-1;\n\taa lg;\n\tvector<aa> pp;\n\tfor(i=0;i<siz[b];i++)\n\t{\n\t\tbb lx=bb{pt[d(b,i)],pt[d(b,(i+1)%siz[b])]};\n\t\tif(px(lx,a)) continue;\n\t\taa lp=crs(lx,a);\n\t\tif(inn(lx,lp)&&inn(a,lp)) pp.push_back(lp);\n\t}\n\tsort(pp.begin(),pp.end());\n\tfor(i=0;i<pp.size();i++)\n\t{\n\t\tif(i&&pp[i]==pp[i-1]) continue;\n\t\tfor(j=0;j<siz[b];j++)\n\t\t\tif(pt[d(b,j)]==pp[i])\n\t\t\t\tif(lf==-1) lf=j;\n\t\t\t\telse if(abs(j-lf)!=2||siz[b]==3&&(!fl[d(b,j)]||!fl[d(b,lf)])) return 0;\n\t\tif(!fll) fll=1,lg=pp[i];\n\t\telse return (lg-pp[i]).len();\n\t}\n\treturn 0;\n}//\u6c42\u4e00\u6761\u7ebf\u6bb5\u548c\u56db\u8fb9\u5f62\uff08\u4e09\u89d2\u5f62\uff09\u7684\u516c\u5171\u90e8\u5206 \nvoid work(int a,int b)\n{\n\tint i,j;\n\tld len=(pt[b]-pt[a]).len(),res=0;\n\tbb lp=bb{pt[a],pt[b]};\n\tfor(i=1;i<=n;i++)\n\t{\n\t\tld lx=work2(lp,i);\n\t\tres+=dt[i]*lx,len-=lx;\n\t}\n\tres+=dt[0]*len,add(a,b,res,(pt[b]-pt[a]).len());\n}//\u52a0\u8fb9 \nvoid dj()\n{\n\tint i,j;\n\tfor(i=1;i<N;i++) dis[i]=inf,vis[i]=0;\n\tdis[s]=0,g[s]=0,q.push(P(0,s));\n\twhile(!q.empty())\n\t{\n\t\tint lx=q.top().second;\n\t\tq.pop();\n\t\tif(vis[lx]) continue;\n\t\tvis[lx]=1;\n\t\tfor(i=fst[lx];i;i=nxt[i])\n\t\t\tif(dis[v[i]]>dis[lx]+w[i]+eps) dis[v[i]]=dis[lx]+w[i],g[v[i]]=g[lx]+f[i],q.push(P(-dis[v[i]],v[i]));\n\t}\n}//\u6700\u77ed\u8def \nint main()\n{\n\tint i,j;\n\tld res=0;\n\tpt[s].read(),pt[t].read(),scanf(\"%Lf%d\",&dt[0],&n);\n\tfor(i=n;i;i--)\n\t{\n\t\tsiz[i]=4;\n\t\tscanf(\"%Lf\",&dt[i]);\n\t\tfor(j=0;j<4;j++) pt[d(i,j)].read();\n\t\tres+=((pt[d(i,2)]-pt[d(i,1)])^(pt[d(i,0)]-pt[d(i,1)]))/2+((pt[d(i,0)]-pt[d(i,3)])^(pt[d(i,2)]-pt[d(i,3)]))/2;\n\t\tfor(j=0;j<4;j++)\n\t\t{\n\t\t\tbb lp=bb{pt[d(i,(j+3)%4)],pt[d(i,j)]},lq=bb{pt[d(i,j)],pt[d(i,(j+1)%4)]};\n\t\t\tif(((lp.t-lp.s)^(lq.t-lq.s))<0)//\u51f9\u56db\u8fb9\u5f62 \n\t\t\t{\n\t\t\t\tn++,del[d(i,3)]=del[d(n,3)]=1,siz[n]=siz[i]=3,dt[n]=dt[i];\n\t\t\t\tfl[d(n,0)]=fl[d(n,2)]=1;\n\t\t\t\tpt[d(n,0)]=pt[d(i,j)],pt[d(n,1)]=pt[d(i,(j+1)%4)],pt[d(n,2)]=pt[d(i,(j+2)%4)];\n\t\t\t\tif(j==3) pt[d(i,0)]=pt[d(i,1)],pt[d(i,1)]=pt[d(i,2)],pt[d(i,2)]=pt[d(i,3)],fl[d(i,0)]=fl[d(i,2)]=1;\n\t\t\t\tif(j==0) pt[d(i,1)]=pt[d(i,2)],pt[d(i,2)]=pt[d(i,3)],fl[d(i,0)]=fl[d(i,1)]=1;\n\t\t\t\tif(j==1) pt[d(i,2)]=pt[d(i,3)],fl[d(i,1)]=fl[d(i,2)]=1;\n\t\t\t\tif(j==2) fl[d(i,2)]=fl[d(i,0)]=1;\n\t\t\t\tbreak; //\u51f9\u56db\u8fb9\u5f62\u65b0\u5efa\u4e00\u4e2a\u4e09\u89d2\u5f62\uff0c\u5e76\u5c06\u539f\u6765\u7684\u56fe\u5f62\u4e5f\u53d8\u6210\u4e09\u89d2\u5f62 \n\t\t\t}\n\t\t}\n\t}\n\tfor(i=1;i<=d(n,3);i++)\n\t\tfor(j=i+1;j<=d(n,3);j++)\n\t\t\tif(!del[i]&&!del[j]) work(i,j);\n\tdj();\n\tprintf(\"%.2Lf\\n%.2Lf\\n%.2Lf\",res,g[t],dis[t]);\n\treturn 0;\n}\n```\n",
        "postTime": 1590163494,
        "uid": 223768,
        "name": "Yukikaze_",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2443 \u3010[SDOI2005]\u9ad8\u901f\u516c\u8def\u3011"
    }
]