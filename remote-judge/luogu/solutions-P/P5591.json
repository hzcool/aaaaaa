[
    {
        "content": "### \u9898\u610f\n\n\u7ed9\u5b9a $n,\\,p,\\,k$ \uff0c\u6c42\uff1a\n\n$$\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i\\left\\lfloor\\frac{i}{k}\\right\\rfloor$$\n\n------\n\n### \u89e3\u9898\u601d\u8def\n\n\u770b\u5230\u9898\u76ee\u7ed9\u51fa\u7684\u5f0f\u5b50\u7b2c\u4e00\u53cd\u5e94\u662f\u4ec0\u4e48\uff1f**\u4e8c\u9879\u5f0f\u5b9a\u7406**\uff01\n\n$$\\sum_{i=0}^{n} \\binom{n}{i}\\,p^i$$\n\n\u79fb\u6389\u70e6\u4eba\u7684 $\\left\\lfloor \\frac{i}{k} \\right\\rfloor$ \uff0c\u4e8c\u9879\u5f0f\u5b9a\u7406\u544a\u8bc9\u6211\u4eec\uff0c\u4e0a\u9762\u7684\u5f0f\u5b50\u7b49\u4e8e $(p + 1)^n$ \u3002\n\n\u7136\u800c\u6211\u4eec\u65e0\u6cd5\u8f7b\u6613\u5730\u5c06 $\\left\\lfloor \\frac{i}{k} \\right\\rfloor$ \u8868\u793a\u6210\u67d0\u4e2a\u6570\u7684 $i$ \u6b21\u5e42\uff0c\u4e0d\u59a8\u5148\u6765\u89e3\u51b3\u5b50\u95ee\u9898\u3002\u4ee4 $k = 1$ \uff1a\n\n$$\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i\\left\\lfloor\\frac{i}{k}\\right\\rfloor = \\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i\\,i$$\n\n\u56e0\u4e3a $n$ \u5f88\u5927\uff0c\u5982\u679c\u4e0d\u5c06\u548c\u5f0f\u8f6c\u6362\u6210\u5c01\u95ed\u5f62\u5f0f\uff0c\u7edd\u5bf9\u4f1a\u8d85\u65f6\u3002\u800c\u4e8c\u9879\u5f0f\u5b9a\u7406\uff0c\u5c31\u662f\u4e00\u79cd\u5173\u952e\u7684\u9014\u5f84\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5e0c\u671b\u80fd\u628a\u5b64\u96f6\u96f6\u7684 $i$ \u53bb\u6389\uff0c\u6216\u8005\u653e\u5728\u67d0\u4e2a $i$ \u6b21\u5e42\u91cc\u3002$\\binom{n}{i}i$ \u7ed9\u4e88\u4e86\u5f88\u5927\u7684\u673a\u4f1a\u3002\n\n\u8fd9\u91cc\u6709\u4e00\u4e2a\u5f15\u7406\uff1a\n\n$$\\binom{n}{m}m = \\binom{n-1}{m-1}n$$\n\n\u521a\u521a\u597d $\\binom{n}{i}i = \\binom{n-1}{i-1}n$\n\uff0c\u6d88\u9664\u4e86 $i$ \u3002\u63a5\u4e0b\u6765\u5c31\u597d\u529e\u5f88\u591a\u4e86\uff1a\n\n$$\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i\\,i = np\\sum\\limits_{i=0}^{n}\\binom{n-1}{i-1}\\,p^{i-1}\\ = np(p+1)^{n-1}$$\n\n\u7136\u540e\u6211\u4eec\u518d\u628a\u76ee\u5149\u79fb\u5230\u4e00\u822c\u60c5\u51b5\u4e0a\u3002\u4f46\u8fd8\u662f\u8001\u95ee\u9898\uff0c$\\left\\lfloor \\frac{i}{k} \\right\\rfloor$ \u5982\u4f55\u8868\u793a\u6210\u67d0\u4e2a\u6570\u7684 $i$ \u6b21\u5e42\u5462\uff1f\u5b83\u65e0\u6cd5\u50cf\u4e0a\u9762\u4e00\u6837\u4e0e $\\binom{n}{i}$ \u6709\u5173\u7cfb\u3002\u6ce8\u610f\u5230\uff0c$k$ \u662f\u5f88\u5c0f\u7684 $2$ \u6b21\u5e42\uff0c\u6a21\u6570 $9982444353 = 199\\times2^{23}+1$ \uff0c\u8fd9\u63d0\u793a\u7740\uff0c\u6211\u4eec\u9700\u8981**\u5355\u4f4d\u6839\u53cd\u6f14**\u3002\u4e0d\u96be\u53d1\u73b0\uff1a\n\n$$\\left\\lfloor \\frac{i}{k} \\right\\rfloor = (\\sum_{j=0}^{i}\\,[k\\,|\\,j]) - 1$$\n\n\u800c\u5355\u4f4d\u6839\u53cd\u6f14\u7684\u7ed3\u8bba\u6070\u597d\u662f\uff1a\n\n$$[k\\,|\\,n] = \\frac{1}{k}\\sum_{d=0}^{k-1}\\omega_{k}^{dn}$$\n\n\u4ee3\u5165\u5f97\uff1a\n\n$$\\left\\lfloor \\frac{i}{k} \\right\\rfloor = (\\sum_{j=0}^{i}\\,[k\\,|\\,j]) - 1 = (\\sum_{j=0}^{i}\\frac{1}{k}\\sum_{d=0}^{k-1}\\omega_{k}^{dj}) - 1$$\n\n\u632a\u5230\u539f\u5f0f\u4e2d\u5e76\u5316\u7b80\uff1a\n\n$$\\begin{aligned}\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i\\left\\lfloor\\frac{i}{k}\\right\\rfloor &= (\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i\\sum_{j=0}^{i}\\frac{1}{k}\\sum_{d=0}^{k-1}\\omega_{k}^{dj}) - (\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i) \\\\ &= (\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i\\sum_{j=0}^{i}\\frac{1}{k}\\sum_{d=0}^{k-1}\\omega_{k}^{dj}) - (p+1)^n && (\\text{\u540e\u9762\u6709\u4e8c\u9879\u5f0f\u5b9a\u7406}) \\\\ &= (\\frac{1}{k}\\sum_{d=0}^{k-1}\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i\\sum_{j=0}^{i}\\omega_{k}^{dj}) - (p+1)^n && (\\text{\u8fd9\u4e00\u6b65\u5f88\u5173\u952e}) \\\\ &= (\\frac{1}{k}\\sum_{d=0}^{k-1}\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i\\frac{\\omega_{k}^{d(i+1)}-1}{\\omega_{k}^{d}-1}) - (p+1)^n && (\\text{\u7b49\u6bd4\u6570\u5217\u6c42\u548c}) \\\\ &= (\\frac{1}{k}\\sum_{d=0}^{k-1}\\frac{\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i(\\omega_{k}^{d(i+1)}-1)}{\\omega_{k}^{d}-1}) - (p+1)^n && (\\text{\u4e0e i \u65e0\u5173\u7684\u5206\u6bcd\uff0c\u63d0\u53d6\u51fa}) \\\\ &= (\\frac{1}{k}\\sum_{d=0}^{k-1}\\frac{\\omega_{k}^{d}(\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i(\\omega_{k}^d)^i)-(\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i)}{\\omega_{k}^{d}-1}) - (p+1)^n && (\\text{\u62c6\u5f00}) \\\\ &= (\\frac{1}{k}\\sum_{d=0}^{k-1}\\frac{\\omega_{k}^{d}(p\\omega_k^{d}+1)^n-(p+1)^{n}}{\\omega_{k}^{d}-1}) - (p+1)^n && (\\text{\u8212\u670d\uff01\u4e24\u8fb9\u90fd\u53ef\u4ee5\u4e8c\u9879\u5f0f\u5b9a\u7406})\\end{aligned}$$\n\n\u4e8e\u662f $O(k \\log)$ \u7684\u65f6\u95f4\u5185\u5c31\u80fd\u7b97\u51fa\u7b54\u6848\u5566\u3002\u6839\u636e\u5355\u4f4d\u6839\u5b9a\u4e49\uff0c$\\omega_{k}^{d} = (\\omega_{k}^{1})^d = (g^{(mod-1)/k})^d$ \uff0c\u5176\u5b9e $g$ \u662f\u6a21\u6570 $998244353$ \u7684\u539f\u6839\uff0c\u53d6 $3$ \u5373\u53ef\u3002\n\n\u7136\u540e\u5b9e\u73b0\u4ee3\u7801\uff0c\u53d1\u73b0\u6837\u4f8b\u90fd\u8fc7\u4e0d\u53bb\u3002~~\u540d\u573a\u9762\uff1f~~\n\n\u95ee\u9898\u51fa\u5728\u54ea\u513f\u5462\uff1f\u91cd\u65b0\u770b\u770b\u7b49\u6bd4\u6570\u5217\u6c42\u548c\uff1f\u5f53 $d = 0,\\,\\omega_{k}^{d} = 1$ \uff0c\u5206\u6bcd\u4e0d\u5c31\u4e3a $0$ \u4e86\uff1f\n\n\u6211\u4eec\u9700\u8981\u7279\u5224 $d = 0$ \u3002\n\n$$\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i\\sum_{j=0}^{i}\\omega_{k}^{dj} = \\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i(i+1) = (\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^ii) + (\\sum\\limits_{i=0}^{n}\\binom{n}{i}\\,p^i)$$\n\n\u8fd0\u6c14\u771f\u597d\uff0c\u63a8\u7740\u63a8\u7740\u53c8\u56de\u5230\u4e86\u70ed\u8eab\u95ee\u9898\u3002\u6839\u636e\u5f00\u59cb\u7684\u7ed3\u8bba\uff0c\u5b83\u7b49\u4e8e $np(p+1)^{n-1} + (p+1)^n$\u00a0\u3002\n\n\u81f3\u6b64\uff0c\u672c\u9898\u5df2\u88ab\u5b8c\u7f8e\u5730\u89e3\u51b3\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(k \\log)$\u00a0\u3002\n\n------\n\n### \u4ee3\u7801\u5b9e\u73b0\n\n```cpp\n#include <bits/stdc++.h>\n\nconst int mod = 998244353, gen = 3;\n\ninline int add(int x, int y) { return x + y >= mod ? x + y - mod : x + y; }\ninline int sub(int x, int y) { return x - y >= 0 ? x - y : x - y + mod; }\ninline int power(int x, int y, int res = 1) {\n    for (; y; y >>= 1, x = 1ll * x * x % mod) {\n        if (y & 1) { res = 1ll * res * x % mod; }\n    } return res;\n}\n\nconst int N = 2e6 + 5;\n\nint n, p, k, ans, w[N];\n\nint main() {\n    scanf(\"%d%d%d\", &n, &p, &k);\n    w[0] = 1; w[1] = power(gen, (mod - 1) / k);\n    for (int i = 2; i < k; i++) { w[i] = 1ll * w[i - 1] * w[1] % mod; }\n    ans = add(1ll * n * p % mod * power(add(p, 1), n - 1) % mod, power(add(p, 1), n));\n    for (int i = 1; i < k; i++) {\n        int now = 1ll * w[i] * power(add(1ll * w[i] * p % mod, 1), n) % mod;\n        now = sub(now, power(add(p, 1), n));\n        ans = add(ans, 1ll * now * power(sub(w[i], 1), mod - 2) % mod);\n    }\n    ans = sub(1ll * ans * power(k, mod - 2) % mod, power(add(p, 1), n));\n    printf(\"%d\\n\", ans);\n    return 0;\n}\n```",
        "postTime": 1570953070,
        "uid": 26673,
        "name": "Sooke",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5591 \u3010\u5c0f\u732a\u4f69\u5947\u5b66\u6570\u5b66\u3011"
    },
    {
        "content": "## \u9898\u610f\n\n$$\\sum_{i=0}^n\\tbinom{n}{i}p^i\\lfloor\\frac ik\\rfloor \\pmod {998244353}$$\n\n$1 \\leq n,p <998244353,k \\in \\{2^{w}|0 \\leq w \\leq 20\\}$\n\n## \u9898\u89e3\n\n\u9996\u5148\u77e5\u9053\u4e00\u4e2a\u7ed3\u8bba$[n|k]=\\sum_{i=0}^{n-1}\\omega_n^{ik}$\uff0c\u4e0b\u9762\u5c06\u7528\u8fd9\u4e2a\u67ff\u5b50\u4e71\u641e\u3002\n\n$$\\sum_{i=0}^n\\tbinom{n}{i}p^i\\lfloor\\frac ik\\rfloor$$\n\n$$=\\sum_{i=0}^n\\tbinom{n}{i}p^i\\frac{i-i\\bmod k}{k}$$\n\n$$=\\frac{1}{k}\\sum_{i=0}^n\\tbinom{n}{i}p^i(i-i\\bmod k)$$\n\n$$=\\frac{1}{k}(\\sum_{i=0}^n\\tbinom{n}{i}p^ii-\\sum_{i=0}^n\\tbinom{n}{i}p^i(i\\bmod k))$$\n\n\u76ee\u6807\u6c42\u51fa\u91cc\u9762\u90a3\u5768\u3002\u628a\u5f0f\u5b50\u62c6\u6210\u4e24\u90e8\u5206\u3002\n\n### $\\sum_{i=0}^n\\tbinom{n}{i}p^ii$\n\n\u9996\u5148\u4e0d\u96be\u53d1\u73b0\n\n$$\\tbinom{n}{i}i=\\frac{n!}{i!(n-i)!}i=\\frac{n(n-1)!}{(i-1)!(n-i)!}=\\tbinom{n-1}{i-1}n$$\n\n\u4e8e\u662f\u6211\u4eec\u5c06\u5176\u5e26\u8fdb\u53bb\u3002\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f$i=0$\u53ef\u80fd\u4f1a\u51fa\u73b0\u8d1f\u6570\uff0c\u62ce\u51fa\u6765\u7279\u5224\u53d1\u73b0\u662f$0$\n\n$$\\sum_{i=1}^n\\tbinom{n-1}{i-1}np^i$$\n\n\u7528$i+1$\u66ff\u6362$i$\n\n$$np\\sum_{i=0}^{n-1}\\tbinom{n-1}{i}p^{i}$$\n\n\u7136\u540e\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c31\u5341\u5206\u663e\u7136\u4e86\u3002\n\n$$np(p+1)^{n-1}$$\n\n### $\\sum_{i=0}^n\\tbinom{n}{i}p^i(i\\bmod k)$\n\n\u8fd9\u90e8\u5206\u5c31\u662f\u590d\u4e60\u767d\u5154\u4e4b\u821e\u4e86\u3002\n\n$$\\sum_{i=0}^n\\sum_{t=0}^{k-1}[i\\bmod k=t]\\tbinom{n}{i}p^it$$\n\n$$\\sum_{i=0}^n\\sum_{t=0}^{k-1}[k|(i-t)]\\tbinom{n}{i}p^it$$\n\n\u628a\u4e00\u5f00\u59cb\u7684\u516c\u5f0f\u5957\u8fdb\u53bb\n\n$$\\sum_{i=0}^n\\sum_{t=0}^{k-1}\\frac{1}{k}\\sum_{j=0}^{k-1}\\omega_k^{j(i-t)}\\tbinom{n}{i}p^it$$\n\n$$\\frac{1}{k}\\sum_{i=0}^n\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_k^{ij}\\omega_k^{-tj}\\tbinom{n}{i}p^it$$\n\n$$\\frac{1}{k}\\sum_{j=0}^{k-1}\\sum_{t=0}^{k-1}t\\omega_k^{-tj}\\sum_{i=0}^n\\tbinom{n}{i}\\omega_k^{ij}p^i$$\n\n\u540e\u9762\u90a3\u4e00\u4e32\u6709\u70b9\u610f\u601d\u3002\n\n$$\\frac{1}{k}\\sum_{j=0}^{k-1}\\sum_{t=0}^{k-1}t\\omega_k^{-tj}\\sum_{i=0}^n\\tbinom{n}{i}(\\omega_k^jp)^i$$\n\n\u7136\u540e\u5c31\u628a\u8ba8\u538c\u7684\u5faa\u73af$n$\u6b21\u5f04\u6ca1\u4e86\n\n$$\\frac{1}{k}\\sum_{j=0}^{k-1}\\sum_{t=0}^{k-1}t\\omega_k^{-tj}(\\omega_k^jp+1)^n$$\n\n\u6240\u4ee5\u53ea\u9700\u8981\u5bf9\u4e8e$j\\in[0,k])$\u6c42\u51fa\u540e\u9762\u4e00\u4e32\u7684\u503c\u5c31\u884c\u4e86\u3002\u8fd9\u91cc\u7528`Bluestein's Algorithm`,$ij=\\tbinom{i+j}{2}-\\tbinom{i}{2}-\\tbinom{j}{2}$\n\n$$\\frac{1}{k}\\sum_{j=0}^{k-1}\\sum_{t=0}^{k-1}t\\omega_k^{-\\tbinom{t+j}{2}+\\tbinom{t}{2}+\\tbinom{j}{2}}(\\omega_k^jp+1)^n$$\n\n\u6574\u7406\u4e00\u4e0b\u7cfb\u6570\u3002\n\n$$\\frac{1}{k}\\sum_{j=0}^{k-1}\\omega_k^\\tbinom{j}{2}(\\omega_k^jp+1)^n\\sum_{t=0}^{k-1}t\\omega_k^{\\tbinom{t}{2}}\\times \\omega_k^{-\\tbinom{t+j}{2}}$$\n\n\u91cc\u9762\u968f\u4fbf\u5377\u5377\u5c31\u597d\u4e86\u3002\u8bb0$c_{k+j}=\\text{\u540e\u9762\u4e00\u4e32}$,$a_{k-i}=i\\omega_k^{\\tbinom{i}{2}},b_{i}=\\omega_k^{-\\tbinom{i}{2}}$\uff0c\u6709\uff1a\n\n$$c_{k+j}=\\sum_{t=0}^{k-1}a_{k-t}b_{t+j}$$\n\n\u5377\u79ef\u663e\u800c\u6613\u89c1\u3002\n\n\u518d\u5e26\u56de\u53bb\u3002\n\n$$\\frac{1}{k}\\sum_{j=0}^{k-1}\\omega_k^\\tbinom{j}{2}(\\omega_k^jp+1)^nc_{k+j}$$\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nnamespace in{\n\tchar buf[1<<21],*p1=buf,*p2=buf;\n\tinline int getc(){return p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++;}\n\ttemplate <typename T>inline void read(T& t){\n\t\tt=0;int f=0;char ch=getc();while (!isdigit(ch)){if(ch=='-')f = 1;ch=getc();}\n\t    while(isdigit(ch)){t=t*10+ch-48;ch = getc();}if(f)t=-t;\n\t}\n\ttemplate <typename T,typename... Args> inline void read(T& t, Args&... args){read(t);read(args...);}\n}\nnamespace out{\n\tchar buffer[1<<21];int p1=-1;const int p2 = (1<<21)-1;\n\tinline void flush(){fwrite(buffer,1,p1+1,stdout),p1=-1;}\n\tinline void putc(const char &x) {if(p1==p2)flush();buffer[++p1]=x;}\n\ttemplate <typename T>void write(T x) {\n\t\tstatic char buf[15];static int len=-1;if(x>=0){do{buf[++len]=x%10+48,x/=10;}while (x);}else{putc('-');do {buf[++len]=-(x%10)+48,x/=10;}while(x);}\n\t\twhile (len>=0)putc(buf[len]),--len;\n\t}\n}\nusing namespace std;\ntemplate<const int mod>\nstruct modint{\n    int x;\n    modint<mod>(int o=0){x=o;}\n    modint<mod> &operator = (int o){return x=o,*this;}\n    modint<mod> &operator +=(modint<mod> o){return x=x+o.x>=mod?x+o.x-mod:x+o.x,*this;}\n    modint<mod> &operator -=(modint<mod> o){return x=x-o.x<0?x-o.x+mod:x-o.x,*this;}\n    modint<mod> &operator *=(modint<mod> o){return x=1ll*x*o.x%mod,*this;}\n    modint<mod> &operator ^=(int b){\n        modint<mod> a=*this,c=1;\n        for(;b;b>>=1,a*=a)if(b&1)c*=a;\n        return x=c.x,*this;\n    }\n    modint<mod> &operator /=(modint<mod> o){return *this *=o^=mod-2;}\n    modint<mod> &operator +=(int o){return x=x+o>=mod?x+o-mod:x+o,*this;}\n    modint<mod> &operator -=(int o){return x=x-o<0?x-o+mod:x-o,*this;}\n    modint<mod> &operator *=(int o){return x=1ll*x*o%mod,*this;}\n    modint<mod> &operator /=(int o){return *this *= ((modint<mod>(o))^=mod-2);}\n\ttemplate<class I>friend modint<mod> operator +(modint<mod> a,I b){return a+=b;}\n    template<class I>friend modint<mod> operator -(modint<mod> a,I b){return a-=b;}\n    template<class I>friend modint<mod> operator *(modint<mod> a,I b){return a*=b;}\n    template<class I>friend modint<mod> operator /(modint<mod> a,I b){return a/=b;}\n    friend modint<mod> operator ^(modint<mod> a,int b){return a^=b;}\n    friend bool operator ==(modint<mod> a,int b){return a.x==b;}\n    friend bool operator !=(modint<mod> a,int b){return a.x!=b;}\n    bool operator ! () {return !x;}\n    modint<mod> operator - () {return x?mod-x:0;}\n\tmodint<mod> &operator++(int){return *this+=1;}\n};\nconst int N=4e6+5;\n\nconst int mod=998244353;\nconst modint<mod> GG=3,Ginv=modint<mod>(1)/3,I=86583718;\nstruct poly{\n\tvector<modint<mod>>a;\n\tmodint<mod>&operator[](int i){return a[i];}\n\tint size(){return a.size();}\n\tvoid resize(int n){a.resize(n);}\n\tvoid reverse(){std::reverse(a.begin(),a.end());}\n};\nint rev[N];\ninline poly one(){poly a;a.a.push_back(1);return a;}\ninline int ext(int n){int k=0;while((1<<k)<n)k++;return k;}\ninline void init(int k){int n=1<<k;for(int i=0;i<n;i++)rev[i]=(rev[i>>1]>>1)|((i&1)<<(k-1));}\ninline void ntt(poly&a,int k,int typ){\n\tint n=1<<k;\n\tfor(int i=0;i<n;i++)if(i<rev[i])swap(a[i],a[rev[i]]);\n\tfor(int mid=1;mid<n;mid<<=1){\n\t\tmodint<mod> wn=(typ>0?GG:Ginv)^((mod-1)/(mid<<1));\n\t\tfor(int r=mid<<1,j=0;j<n;j+=r){\n\t\t\tmodint<mod> w=1;\n\t\t\tfor(int k=0;k<mid;k++,w=w*wn){\n\t\t\t\tmodint<mod> x=a[j+k],y=w*a[j+k+mid];\n\t\t\t\ta[j+k]=x+y,a[j+k+mid]=x-y;\n\t\t\t}\n\t\t}\n\t}\n\tif(typ<0){\n\t\tmodint<mod> inv=modint<mod>(1)/n;\n\t\tfor(int i=0;i<n;i++)a[i]*=inv;\n\t}\n}\ninline poly operator*(poly a,poly b){\n\tint n=a.size()+b.size()-1,k=ext(n);\n\ta.resize(1<<k),b.resize(1<<k),init(k);\n\tntt(a,k,1);ntt(b,k,1);for(int i=0;i<(1<<k);i++)a[i]*=b[i];\n\tntt(a,k,-1),a.resize(n);return a;\n}\ntypedef modint<mod>mint;\nint n=3,p=3,k=2;\nstatic mint fac[20];\nnamespace solve{\n\tmint w[N];\n\t#define C2(i) (1ll*(i)*((i)-1)/2)\n\tvoid run(){\n\t\tw[0]=1;w[1]=mint(3)^((mod-1)/k);for(int i=2;i<k;i++)w[i]=w[i-1]*w[1];\n\t\tmint ans=0;poly a,b,c;\n\t\ta.resize(k);b.resize(2*k);\n\t\tfor(int i=0;i<k;i++)a[k-i]=w[C2(i)%k]*i;\n\t\tfor(int i=0;i<2*k;i++)b[i]=w[((-C2(i))%k+k)%k];\n\t\tc=a*b;\n\t\tfor(int j=0;j<k;j++)\n\t\t\tans+=w[C2(j)%k]*((w[j%k]*p+1)^n)*c[k+j];\n\t\tans=ans/k;\n\t\tout::write((((mint(p+1)^(n-1))*n*p-ans)/k).x);out::putc('\\n');\n\t}\n}\nsigned main(){\n\tin::read(n,p,k);\n\tsolve::run();\n\tout::flush();\n\treturn 0;\n}\n```\nvector\u6bd4\u8f83\u6162\u8981O2\u624d\u80fd\u8fc7",
        "postTime": 1610030583,
        "uid": 174304,
        "name": "jun\u5934\u5409\u5409",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5591 \u3010\u5c0f\u732a\u4f69\u5947\u5b66\u6570\u5b66\u3011"
    },
    {
        "content": "\u7531\u4e8e\u5b58\u5728\u4e00\u9053\u9898\u53eb\u505a\u767d\u5154\u4e4b\u821e\u5c31\u5bfc\u81f4\u8fd9\u9053\u9898\u770b\u4e0a\u53bb\u975e\u5e38\u7684\u677f$......($\u5982\u679c\u6309\u7167\u8fd9\u4e2a\u65b9\u6cd5\u63a8\u4e0b\u6765\n\n\u7ea6\u5b9a\uff0c$[x]$\u8868\u793a$x$\u5411\u4e0b\u53d6\u6574\n\n$$\\sum_{i=0}^n\\dbinom{n}{i}\\times p^i\\times [\\dfrac{i}{k}]$$\n\n\u7136\u540e\u4f1a\u60f3\u5230\u53ef\u4ee5\u5c06$[\\dfrac{i}{k}]$\u62c6\u5f00\u53d8\u6210\uff1a\n\n$$\\dfrac{i-i\\%k}{k}$$\n\n\u4e8e\u662f\u539f\u95ee\u9898\u53d8\u6210\uff1a\n\n\n$$\\sum_{i=0}^n\\dbinom{n}{i}\\times p^i\\times\\dfrac{i-i\\%k}{k}$$\n\n\u770b\u5230\u4e86$i\\%k$\uff0c\u7136\u540e\u8fd8\u6709\u7ec4\u5408\u6570\uff0c\u7136\u540e$k$\u8fd8\u662f$2$\u7684\u6574\u6570\u6b21\u5e42\uff0c\u8fd9\u4e2a\u65f6\u5019\u5f53\u7136\u662f\u5355\u4f4d\u6839\u53cd\u6f14\u4e0a\u573a\u4e86...\n\n$$\\sum_{t=0}^{k-1}\\sum_{i=0}^n[i\\%k==t]\\dbinom{n}{i}\\times \\dfrac{i-t}{k}\\times p^i$$\n\n\u7136\u540e\u5c31\u662f\u559c\u95fb\u4e50\u89c1\u7684\u5316\u5f0f\u5b50\u4e86\n\n$$\\sum_{t=0}^{k-1}\\sum_{i=0}^n[(i-t)\\%k==0]\\dbinom{n}{i}\\times \\dfrac{i-t}{k}p^i$$\n\n$$\\sum_{t=0}^{k-1}\\sum_{i=0}^n\\dfrac{1}{k}\\sum_{j=0}^{k-1}\\omega_{k}^{(i-t)j} \\times\\dbinom{n}{i} \\times\\dfrac{i-t}{k}p^i$$\n\n$$\\dfrac{1}{k^2}\\sum_{t=0}^{k-1}\\sum_{i=0}^n\\sum_{j=0}^{k-1}\\omega_{k}^{(i-t)j} \\times\\dbinom{n}{i}\\times(i-t)p^i$$\n\n$$\\dfrac{1}{k^2}\\sum_{t=0}^{k-1}\\sum_{i=0}^n\\sum_{j=0}^{k-1}\\omega_{k}^{ij}\\times\\omega_{k}^{-tj} \\times\\dbinom{n}{i}\\times(i-t)p^i$$\n\n\u7136\u540e\u80af\u5b9a\u8981\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\u53d8\u6210\uff1a\n\n$$\\dfrac{1}{k^2}\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\sum_{i=0}^{n}\\omega_{k}^{ij} \\times \\dbinom{n}{i}\\times (i-t)p^i$$\n\n\u7136\u540e\u8fd9\u91cc\u662f\u53ef\u4ee5\u5c06\u5176\u62c6\u5f00\u7684...\n\n$$\\dfrac{1}{k^2}\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\sum_{i=0}^{n}\\omega_{k}^{ij} \\times \\dbinom{n}{i}\\times i\\times p^i-\\dfrac{1}{k^2}\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\sum_{i=0}^{n}\\omega_{k}^{ij} \\times \\dbinom{n}{i}*tp^i$$\n\n\u6211\u4eec\u5148\u5ffd\u7565$\\dfrac{1}{k^2}$\n\n$$\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\sum_{i=0}^{n}\\omega_{k}^{ij} \\times \\dbinom{n}{i}\\times i\\times p^i-\\sum_{t=0}^{k-1}t\\times \\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\sum_{i=0}^{n}\\omega_{k}^{ij} \\times \\dbinom{n}{i}p^i$$\n\n$$\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\sum_{i=0}^{n}(\\omega_{k}^{j}p)^i \\times \\dbinom{n}{i}\\times i-\\sum_{t=0}^{k-1}t\\times \\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\sum_{i=0}^{n}(\\omega_{k}^{j}p)^i \\times \\dbinom{n}{i}$$\n\n\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\u5f88\u597d\u5904\u7406\uff0c\u6211\u4eec\u76f4\u63a5\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u5373\u53ef\u5316\u5f00\u53d8\u6210\uff1a\n\n$$\\sum_{t=0}^{k-1}t\\times \\sum_{j=0}^{k-1}\\omega_{k}^{-tj}(\\omega_{k}^{j}p+1)^n$$\n\n\u7136\u540e\u5bf9\u4e8e\u67d0\u4e00\u4e2a$j$\uff0c$(\\omega_{k}^{j}p+1)^n$\u4e3a\u5b9a\u503c\uff0c\u8bbe\u5176\u4e3a$a_j$\n\n\u7b2c\u4e00\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u5c06\u7ec4\u5408\u6570\u62c6\u5f00\n\n$$\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\sum_{i=0}^{n}(\\omega_{k}^{j}p)^i \\times \\dbinom{n}{i}\\times i$$\n\n$$\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\sum_{i=0}^{n}(\\omega_{k}^{j}p)^i \\times \\dfrac{n!}{i!*(n-i)!}\\times i$$\n\n\u7136\u540e\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u5c06$i=0$\u7684\u90a3\u4e00\u9879\u7ed9\u5ffd\u7565\u6389\n\n$$\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\sum_{i=1}^{n}(\\omega_{k}^{j}p)^i \\times \\dfrac{n!}{(i-1)!(n-i)!}$$\n\n$$\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\sum_{i=1}^{n}(\\omega_{k}^{j}p)^i \\times \\dfrac{n*(n-1)!}{(i-1)!((n-1)-(i-1))!}$$\n\n$$n*\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\sum_{i=1}^{n}(\\omega_{k}^{j}p)^{i-1+1}\\times \\dfrac{(n-1)!}{(i-1)!((n-1)-(i-1))!}$$\n\n$$n*\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\sum_{i=1}^{n}(\\omega_{k}^{j}p)^{i-1}*\\omega_{k}^jp\\times \\dfrac{(n-1)!}{(i-1)!((n-1)-(i-1))!}$$\n\n\n$$n*\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\times \\omega_{k}^jp\\sum_{i-1=0}^{n-1}(\\omega_{k}^{j}p)^{i-1}\\times \\dfrac{(n-1)!}{(i-1)!((n-1)-(i-1))!}$$\n\n$$n*\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\times \\omega_{k}^jp\\sum_{i-1=0}^{n-1}(\\omega_{k}^{j}p)^{i-1}\\times  \\dbinom{n-1}{i-1}$$\n\n$$n*\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\times \\omega_{k}^jp\\sum_{i=0}^{n-1}(\\omega_{k}^{j}p)^{i}\\times  \\dbinom{n-1}{i}$$\n\n$$n*\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\times \\omega_{k}^jp*(\\omega_{k}^{j}p+1)^{n-1}$$\n\n\u540e\u9762\u90a3\u4e00\u5768\u5bf9\u4e8e\u67d0\u4e00\u4e2a$j$\u4e5f\u662f\u56fa\u5b9a\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe$b_j=\\omega_{k}^jp*(\\omega_{k}^jp+1)^{n-1}$\n\n\u90a3\u4e48\u5c31\u6709\u539f\u5f0f\u5373\uff1a\n\n$$n*\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}\\times b_j-\\sum_{t=0}^{k-1}t*\\sum_{j=0}^{k-1}\\omega_{k}^{-tj}a_j$$\n\n\u7136\u540e\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a$O(k^2)$\u7684\u505a\u6cd5\u4e86...\n\n\u7136\u540e\u6211\u4eec\u7528\u4e00\u4e0b\u767d\u5154\u4e4b\u821e\u7684\u795e\u4ed9\u64cd\u4f5c$tj=\\dfrac{(t+j)(t+j-1)}{2}-\\dfrac{j(j-1)}{2}-\\dfrac{t(t-1)}{2}$\n\n\u8bc1\u660e\u4e5f\u5f88\u7b80\u5355\uff0c\u5206\u5b50\u662f\uff1a\n\n$$(t+j)^2-t-j-j^2+j-t^2+t$$\n\n$$2tj$$\n\n\u6240\u4ee5\u539f\u5f0f\u5c31\u53ef\u4ee5\u5316\u6210\uff1a\n\n~~\u4e0b\u9762\u7684\u7ec4\u5408\u6570\u90fd\u53cd\u4e86\uff0c\u4f46\u6211\u61d2\u5f97\u6539\u4e86QAQ~~\n\n$$n*\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-(\\binom{2}{t+k}-\\binom{2}{t}-\\binom{2}{j})}\\times b_j-\\sum_{t=0}^{k-1}t*\\sum_{j=0}^{k-1}\\omega_{k}^{-(\\binom{2}{t+k}-\\binom{2}{t}-\\binom{2}{j})}a_j$$\n\n$$n*\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-\\binom{2}{t+k}+\\binom{2}{t}+\\binom{2}{j}}\\times b_j-\\sum_{t=0}^{k-1}t\\times \\sum_{j=0}^{k-1}\\omega_{k}^{-\\binom{2}{t+k}+\\binom{2}{t}+\\binom{2}{j}}a_j$$\n\n$$n*\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-\\binom{2}{t+k}} \\omega_{k}^{\\binom{2}{t}}\\omega_k^{\\binom{2}{j}}*b_j-\\sum_{t=0}^{k-1}\\sum_{j=0}^{k-1}\\omega_{k}^{-\\binom{2}{t+k}} t\\times \\omega_{k}^{\\binom{2}{t}}\\omega_k^{\\binom{2}{j}}a_j$$\n\n\u7136\u540e\u5982\u679c\u6211\u4eec\u5c06$t+k$\u770b\u4f5c\u4e00\u4e2a\u6574\u4f53\u90a3\u4e48\u5c31\u4f1a\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a\u5377\u79ef\u7684\u5f62\u5f0f\n\n\u7136\u540e\u5c31\u53ea\u9700\u8981\u5c06$\\omega_{k}^{\\binom{2}{t}}$\u548c$\\omega_k^{\\binom{2}{j}}\\times b_j$\u4ee5\u53ca$t\\times \\omega_{k}^{\\binom{2}{t}}$\u548c$\\omega_k^{\\binom{2}{j}}\\times a_j$\u5206\u522b\u5377\u8d77\u6765\u5373\u53ef\uff0c\u66b4\u529b\u5377\u662f\u9700\u8981$\\rm 6NTT$\u7684...\n\n\u8fd8\u62c5\u5fc3\u4f1a$\\rm T$\u6765\u7740...\u7136\u800c\u4e8b\u5b9e\u4e0a\u4e5f\u4e0d\u6162\uff0c\u5f00$\\rm O2$\u6700\u6162\u7684\u70b9\u624d$1.3s$..\u4e0d\u8fc7\u5176\u5b9e\u53ef\u4ee5\u505a$\\rm 3FFT$\u7684...\u56e0\u4e3a\u5377\u8d77\u6765\u53ef\u4ee5\u5c06\u7ed3\u679c\u4e58\u8d77\u6765\u518d\u52a0\u8d77\u6765...\u540c\u65f6\u628a\u4e24\u4e2a\u591a\u9879\u5f0f\u7684$\\rm DFT$\u7b97\u51fa\u6765\u9700\u8981$3$\u6b21\u53d8$2$\u6b21\u7684\u6280\u5de7...\u6240\u4ee5\u901f\u5ea6\u5e94\u8be5\u4f1a\u8fd8\u53ef\u4ee5\n\n\u590d\u6742\u5ea6$O(k\\log k)$\n\n$Code:$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std ;\n#define rep( i, s, t ) for( register int i = s; i <= t; ++ i )\n#define re register\n#define LL long long\n#define int long long\nint gi() {\n\tchar cc = getchar() ; int cn = 0, flus = 1 ;\n\twhile( cc < '0' || cc > '9' ) {  if( cc == '-' ) flus = - flus ; cc = getchar() ; }\n\twhile( cc >= '0' && cc <= '9' )  cn = cn * 10 + cc - '0', cc = getchar() ;\n\treturn cn * flus ;\n}\nconst int Gi = 332748118 ;\nconst int P = 998244353 ; \nconst int N = 4e6 + 5 ;  \nconst int G = 3 ;\nint n, p, m, limit, L, R[N] ;\nLL A[N], B[N], F[N], F2[N], Dg[N], Inv ;\nLL fpow( LL x, int k ) {\n\tLL ans = 1, base = x % P ; k = k % ( P - 1 ) ; \n\twhile( k ) {\n\t\tif( k & 1 ) ans = ( ans * base ) % P ; \n\t\tbase = ( base * base ) % P, k >>= 1 ; \n\t}\n\treturn ans % P ;\n}\nvoid NTT( LL *a, int type ) {\n\tfor( re int i = 0; i < limit; ++ i ) if( i < R[i] ) swap( a[i], a[R[i]] ) ;\n\tfor( re int k = 1; k < limit; k <<= 1 ) {\n\t\tLL dg = fpow( ( type == 1 ) ? G : Gi, ( P - 1 ) / ( k << 1 ) ); \n\t\tfor( re int i = 0; i < limit; i += ( k << 1 ) )\n\t\tfor( re LL j = i, g = 1; j < i + k; ++ j, g = ( g * dg ) % P ) {\n\t\t\tLL Nx = a[j], Ny = ( a[j + k] * g ) % P;\n\t\t\ta[j] = ( Nx + Ny ) % P, a[j + k] = ( Nx - Ny + P ) % P ; \n\t\t}\n\t}\n\tif( type != 1 ) rep( i, 0, limit - 1 ) a[i] = ( a[i] * Inv ) % P ; \n}\nvoid Init() {\n\tlimit = 1, L = 0 ;\n\twhile( limit < m + m ) limit <<= 1, ++ L ; \n\tfor( int i = 0; i < limit; ++ i ) R[i] = ( R[i >> 1] >> 1 ) | ( ( i & 1 ) << ( L - 1 ) ) ;\n\tInv = fpow( limit, P - 2 ) ;\n}\nLL C( int x ) {\n\treturn 1ll * x * ( x - 1 ) / 2 ; \n}\nsigned main()\n{\n\tn = gi(), p = gi(), m = gi() ;  \n\tDg[0] = 1, Dg[1] = fpow( G, ( P - 1 ) / m ) ;\n\trep( i, 2, m ) Dg[i] = ( Dg[i - 1] * Dg[1] ) % P ; \n\trep( i, 0, m - 1 ) A[i] = fpow( Dg[i] * p + 1, n ), B[i] = Dg[i] * p % P * fpow( Dg[i] * p + 1, n - 1 ) % P ;\n\t\n\tLL Ans1 = 0, Ans2 = 0, Ans = 0 ;\n\trep( i, 0, m - 1 ) A[i] = Dg[C(i) % m] * A[i] % P, B[i] = Dg[C(i) % m] * B[i] % P, \n\tF[i] = Dg[C(i) % m] % P, F2[i] = 1ll * i * Dg[C(i) % m] % P ;\n\tInit(), NTT( A, 1 ), NTT( B, 1 ), NTT( F, 1 ), NTT( F2, 1 ) ; \n\trep( i, 0, limit - 1 ) A[i] = ( F2[i] * A[i] ) % P, B[i] = ( F[i] * B[i] ) % P ;\n\tNTT( A, -1 ), NTT( B, -1 ) ;\n\t\n\trep( i, 0, limit ) A[i] = A[i] * Dg[m - C(i) % m] % P, B[i] = B[i] * Dg[m - C(i) % m] % P, \n\t\tAns2 = ( Ans2 + A[i] ) % P, Ans1 = ( Ans1 + B[i] ) % P ; \n\t\n\tAns1 = ( 1ll * Ans1 * ( n % P ) ) % P ;  \n\tAns = ( Ans1 - Ans2 + P ) % P ;\n\tAns = ( Ans * fpow( m * m % P, P - 2 ) ) % P ;\n\tprintf(\"%lld\\n\", Ans ) ;\n\treturn 0 ;\n}\n```\n\n~~\u56e0\u4e3a\u591a\u9879\u5f0f\u5b9e\u5728\u662f\u505a\u5c11\u4e86\u6240\u4ee5\u8c03\u5f97\u975e\u5e38\u81ea\u95ed...\uff0c\u4e0b\u6b21\u518d\u5199\u6211\u5f00\u6570\u7ec4\u7edd\u5bf9\u4e0d\u8fd9\u4e48\u541d\u556cQAQ\u6211\u9519\u4e86~~",
        "postTime": 1570976861,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5591 \u3010\u5c0f\u732a\u4f69\u5947\u5b66\u6570\u5b66\u3011"
    },
    {
        "content": "[\u5e76\u6ca1\u6709\u540c\u6b65\u53d1\u5728\u8fd9\u91cc\uff0c\u53ea\u662f\u5355\u7eaf\u7684\u63a8\u9500\u4e00\u4e0b](https://foreverlasting1202.github.io/)\n\n\u5355\u4f4d\u6839\u53cd\u6f14\u3002\n\n\u597d\u50cf\u6211\u7684\u505a\u6cd5\u6781\u5176\u5783\u573e\uff0c\u53cd\u6b63\u80fd\u8fc7\u5c31\u597d\u4e86\u3002\n\n$\\sum_{i=0}^n \\binom{n}{i}p^i\\lfloor{\\frac{i}{k}}\\rfloor$\n    \n$=\\sum_{i=0}^n \\binom{n}{i}p^i\\frac{i-i\\ mod\\ k}{k}$\n    \n$=\\frac{1}{k}\\sum_{i=0}^n \\binom{n}{i}p^i(i-i\\ mod\\ k)$\n    \n$=\\frac{1}{k}(\\sum_{i=0}^n i\\binom{n}{i}p^i-\\sum_{i=0}^n (i\\ mod\\ k)\\binom{n}{i}p^i)$\n\n$\\sum_{i=0}^n (i\\ mod\\ k)\\binom{n}{i}p^i$\n\n$=\\sum_{d=0}^{k-1}d\\sum_{i=0}^n [i\\ mod\\ k==d]\\binom{n}{i}p^i$\n\n$\\sum_{i=0}^n [i\\ mod\\ k==0]\\binom{n}{i}p^i$\n\n$=\\sum_{i=0}^n\\frac{1}{k}\\sum_{j=0}^{k-1}\\omega^{ij}_k\\binom{n}{i}p^i$\n\n$=\\sum_{i=0}^n\\frac{1}{k}\\sum_{j=0}^{k-1}\\binom{n}{i}(p\\omega^{j}_k)^i$\n\n$=\\frac{1}{k}\\sum_{j=0}^{k-1}\\sum_{i=0}^n\\binom{n}{i}(p\\omega^{j}_k)^i$\n\n$=\\frac{1}{k}\\sum_{j=0}^{k-1}(1+p\\omega^{j}_k)^n$\n\n$\\sum_{d=0}^{k-1}d\\sum_{i=0}^n [i\\ mod\\ k==d]\\binom{n}{i}p^i$\n\n$=\\frac{1}{k}\\sum_{d=0}^{k-1}d\\sum_{j=0}^{k-1}(1+p\\omega^{j}_k)^n\\frac{1}{(\\omega^j_k)^d}$\n\n$=\\frac{1}{k}\\sum_{j=0}^{k-1}(1+p\\omega^{j}_k)^n\\sum_{d=0}^{k-1}d\\frac{1}{(\\omega^j_k)^d}$\n\n\u7136\u540e\u540e\u9762\u90a3\u4e2a\u4e1c\u897f\u662f\u4e2a\u7b80\u5355\u7684\u7b49\u5dee\u7b49\u6bd4\u6570\u5217\u6c42\u548c\uff0c\u4e8e\u662f\u968f\u4fbf\u505a\u505a\u5c31\u80fd\u8fc7\u4e86\u3002$O(klogn)$\u3002",
        "postTime": 1570949533,
        "uid": 32878,
        "name": "foreverlasting",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5591 \u3010\u5c0f\u732a\u4f69\u5947\u5b66\u6570\u5b66\u3011"
    },
    {
        "content": "\u6211\u4eec\u6709\u5355\u4f4d\u6839\u53cd\u6f14\uff1a\n$$\n[k\\mid j]=\\frac{1}{k}\\sum\\limits_{d=0}^{k-1}\\omega_{k}^{dj}\n$$\n\u8bc1\u660e\uff1a\n\n\u5f53 $k\\mid j$ \u65f6\uff0c$\\omega_k^j=1$\uff0c\u53f3\u5f0f $=1$\u3002\n\n\u5f53 $k\\nmid j$ \u65f6\uff0c$\\omega_k^j\\neq 1$\uff0c\u53f3\u5f0f $=\\frac{\\omega_k^{kj}-\\omega_k^{0j}}{\\omega_k^j-1}=0$\u3002\n\n\u6839\u636e\u5355\u4f4d\u6839\u53cd\u6f14\uff1a\n$$\n\\begin{aligned}\n&\\sum\\limits_{i=0}^n{n\\choose i}p^i\\left\\lfloor\\frac{i}{k}\\right\\rfloor\\\\\n=&\\sum\\limits_{i=0}^n{n\\choose i}p^i(\\sum\\limits_{j=0}^i[k\\mid j]-1)\\\\\n=&\\sum\\limits_{i=0}^n{n\\choose i}p^i\\sum\\limits_{j=0}^i[k\\mid j]-\\sum\\limits_{i=0}^n{n\\choose i}p^i\\\\\n=&\\sum\\limits_{i=0}^n{n\\choose i}p^i\\sum\\limits_{j=0}^i\\frac{1}{k}\\sum\\limits_{d=0}^{k-1}\\omega_{k}^{dj}-(p+1)^n\\\\\n=&\\frac{1}{k}\\sum\\limits_{d=0}^{k-1}\\sum\\limits_{i=0}^n{n\\choose i}p^i\\sum\\limits_{j=0}^i\\omega_{k}^{dj}-(p+1)^n\\\\\n=&\\frac{1}{k}\\sum\\limits_{i=0}^n{n\\choose i}p^i(i+1)+\\frac{1}{k}\\sum\\limits_{d=1}^{k-1}\\sum\\limits_{i=0}^n{n\\choose i}p^i\\sum\\limits_{j=0}^i\\omega_{k}^{dj}-(p+1)^n\\\\\n\\end{aligned}\n$$\n\u5148\u7b97\u5de6\u8fb9\u7684\u4e1c\u897f\uff1a\n$$\n\\begin{aligned}\n&\\sum\\limits_{i=0}^n{n\\choose i}p^i(i+1)\\\\\n=&\\sum\\limits_{i=0}^n{n\\choose i}p^ii+\\sum\\limits_{i=0}^n{n\\choose i}p^i\\\\\n=&\\sum\\limits_{i=0}^n{n-1\\choose i-1}p^in+(p+1)^n\\\\\n=&np\\sum\\limits_{i=0}^{n-1}{n-1\\choose i}p^i+(p+1)^n\\\\\n=&np(p+1)^{n-1}+(p+1)^n\n\\end{aligned}\n$$\n\u7136\u540e\u662f\u4e2d\u95f4\u7684\u4e1c\u897f\uff1a\n$$\n\\begin{aligned}\n&\\sum\\limits_{d=1}^{k-1}\\sum\\limits_{i=0}^n{n\\choose i}p^i\\sum\\limits_{j=0}^i\\omega_{k}^{dj}\\\\\n=&\\sum\\limits_{d=1}^{k-1}\\sum\\limits_{i=0}^n{n\\choose i}p^i\\frac{\\omega_{k}^{d(i+1)}-1}{\\omega_{k}^{d}-1}\\\\\n=&\\sum\\limits_{d=1}^{k-1}\\frac{\\sum\\limits_{i=0}^n{n\\choose i}p^i\\omega_{k}^{d(i+1)}-\\sum\\limits_{i=0}^n{n\\choose i}p^i}{\\omega_{k}^{d}-1}\\\\\n=&\\sum\\limits_{d=1}^{k-1}\\frac{\\omega_{k}^{d}\\sum\\limits_{i=0}^n{n\\choose i}(p\\omega_{k}^{d})^i-(p+1)^n}{\\omega_{k}^{d}-1}\\\\\n=&\\sum\\limits_{d=1}^{k-1}\\frac{\\omega_{k}^{d}(p\\omega_{k}^{d}+1)^n-(p+1)^n}{\\omega_{k}^{d}-1}\\\\\n\\end{aligned}\n$$\n\u6240\u4ee5\u539f\u5f0f\u7b49\u4e8e\uff1a\n$$\n\\frac{1}{k}\\left(np(p+1)^{n-1}+(p+1)^n+\\sum\\limits_{d=1}^{k-1}\\frac{\\omega_{k}^{d}(p\\omega_{k}^{d}+1)^n-(p+1)^n}{\\omega_{k}^{d}-1}\\right)-(p+1)^n\n$$\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathrm O(k\\log n)$\uff0c\u590d\u6742\u5ea6\u74f6\u9888\u662f\u5feb\u901f\u5e42\u3002\n\n",
        "postTime": 1613383520,
        "uid": 55707,
        "name": "gxy001",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5591 \u3010\u5c0f\u732a\u4f69\u5947\u5b66\u6570\u5b66\u3011"
    },
    {
        "content": "qwaszx\u8bb2\u7684\u592a\u597d\u8fa3 \u5c31\u662f\u8f66\u901f\u6709\u70b9\u5feb \u6211\u5f00\u6162\u70b9\u5199\u4e00\u7bc7qwq  \n\u5f0f\u5b50\u53ef\u80fd\u4f1a\u63a8\u7684\u6bd4\u8f83\u6162\uff0c\u6bd4\u8f83\u7e41\u7410w\n\n### \u9898\u9762\n\u6c42$\\sum_{i=0}^n \\binom n i \\times p^{i} \\times \\left\\lfloor \\frac{i}{k} \\right\\rfloor \\bmod 998244353$\u3002\n\n$1 \\leq n,p <998244353,k \\in \\{2^{w}|0 \\leq w \\leq 20\\}$\n\n### \u524d\u7f6e\u77e5\u8bc6\n[\u4e8c\u9879\u5f0f\u5b9a\u7406](https://baike.baidu.com/item/%E4%BA%8C%E9%A1%B9%E5%BC%8F%E5%AE%9A%E7%90%86)  \n\n[\u5355\u4f4d\u6839\u53cd\u6f14](https://www.luogu.org/blog/KingSann/post-ye-hu-shi-leng-men-suan-fa-dan-wei-gen-fan-yan)\n### \u9898\u89e3\n\u8fd9\u79cd\u9898\u80af\u5b9a\u662f\u8981\u63a8\u5f0f\u5b50\u7684\u3002\u3002\u3002  \n\n\u8fd9\u4e2a\u5f0f\u5b50\u91cc$\\left\\lfloor\\frac ik\\right\\rfloor$\u770b\u8d77\u6765\u5e76\u4e0d\u597d\u5904\u7406\uff0c\u4e8e\u662f\u6211\u4eec\u5c06\u5176\u62c6\u5f00\uff0c\u8003\u8651\u5230$\\left\\lfloor\\frac ik\\right\\rfloor\\times k=i-i\\mod k$\uff0c\u4e8e\u662f\u6709$\\left\\lfloor\\frac ik\\right\\rfloor=\\frac{i-i\\mod k}k$\u3002\n\n\u5e26\u56de\u53bb\u4e4b\u540e\u62c6\u5f00\uff0c\u53ef\u4ee5\u5f97\u5230\n$$ \\frac1k\\sum_{i=0}^n\\binom ni\\times p^i\\times(i-i\\mod k) = \\frac1k\\sum_{i=0}^n\\binom ni\\times p^i\\times i -\\frac1k\\sum_{i=0}^n\\binom ni\\times p^i\\times(i\\mod k) $$\n\n\u540e\u8005\u5e26\u4e86\u4e00\u4e2a\u6a21\u8fd0\u7b97\uff0c\u4e8e\u662f\u6211\u4eec\u8003\u8651\u524d\u8005\u3002  \n\n\u5bf9\u4e8e$\\sum_{i=0}^n\\binom ni\\times i$\uff0c\u6211\u4eec\u505a\u51fa\u4ee5\u4e0b\u63a8\u5bfc\n\n$$\\sum_{i=0}^n\\binom ni\\times i=\\sum_{i=0}^n\\frac{n!}{(n-i)!i!}\\times i=\\sum_{i=1}^n\\frac{n!}{(n-i)!(i-1)!}=\\sum_{i=1}^n\\binom{n-1}{i-1}n$$\n\n\u4e8e\u662f\u6211\u4eec\u77e5\u9053\n\n$$\\frac1k\\sum_{i=0}^n\\binom ni\\times p^i\\times i=\\frac 1k\\sum_{i=1}^nn\\binom{n-1}{i-1}p^i=\\frac {np}k\\sum_{i=1}^n\\binom{n-1}{i-1}p^{i-1}$$\n\n\u540e\u9762\u8fd9\u4e2a\u4e1c\u897f\u663e\u7136\u5c31\u662f\u4e8c\u9879\u5f0f\u5b9a\u7406\uff0c\u4e8e\u662f\u6709  \n\n$$\\frac1k\\sum_{i=0}^n\\binom ni\\times p^i\\times i=\\frac{np}k(p+1)^{n-1}$$\n\n\u5bf9\u4e8e\u8003\u8651\u4e4b\u524d\u90a3\u4e2a\u5f0f\u5b50\u7684\u540e\u534a\u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u5e26\u6a21\u7684\u90a3\u4e00\u90e8\u5206\uff0c\u6211\u4eec\u5f88\u96be\u505a\u6a21\u76f8\u5173\u7684\u8fd0\u7b97\uff0c\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u679a\u4e3e\u6bcf\u4e00\u79cd$i\\mod k$\u7684\u60c5\u51b5\u3002\n$$\\frac1k\\sum_{i=0}^n\\binom ni\\times p^i\\times(i\\mod k)=\\frac1k\\sum_{d=0}^{k-1}d\\sum_{i=0}^n\\binom ni\\times p^i\\times[i\\mod k = d]$$  \n\n\u628a\u540e\u9762\u8fd9\u4e2a\u4e1c\u897f\u5355\u4f4d\u6839\u53cd\u6f14\u6389\uff0c\u53ef\u4ee5\u5f97\u5230$\\frac1k\\sum_{j=0}^{k-1}(\\omega_k^{i-d})^j$\u3002  \n\n\u4e5f\u5c31\u662f\u8bf4\n$$ \\frac1k\\sum_{d=0}^{k-1}d\\sum_{i=0}^n\\binom ni\\times p^i\\times[i\\mod k = d] = \\frac1k\\sum_{d=0}^{k-1}d\\sum_{i=0}^n\\binom ni\\times p^i\\times\\frac1k\\sum_{j=0}^{k-1}(\\omega_k^{i-d})^j$$\n\n\u7b80\u5355\u63a8\u4e00\u4e0b\u5f0f\u5b50\n$$\\begin{aligned}Ans&=\\frac1k\\sum_{d=0}^{k-1}d\\sum_{i=0}^n\\binom ni\\times p^i\\times\\frac1k\\sum_{j=0}^{k-1}(\\omega_k^{i-d})^j \\\\ &= \\frac1{k^2}\\sum_{d=0}^{k-1}\\sum_{j=0}^{k-1}d\\sum_{i=0}^n\\binom ni\\times p^i\\times\\frac{\\omega_{k}^{ij}}{\\omega_k^{dj}}\\\\ &=\\frac1{k^2}\\sum_{d=0}^{k-1}\\sum_{j=0}^{k-1}\\frac d{\\omega_k^{dj}}\\sum_{i=0}^n\\binom ni\\times(p\\times\\omega_k^j)^i\\\\&=\\frac1{k^2}\\sum_{d=0}^{k-1}\\sum_{j=0}^{k-1}\\frac d{\\omega_k^{dj}}(p\\omega_{k}^j+1)^n\\end{aligned}$$\n\n\u7136\u540e\u53ef\u4ee5NTT\u505a\uff0c\u4f46\u662fNTT\u8fd8\u8981\u5199\u90a3\u4e00\u5957\u677f\u5b50\uff0c\u6240\u4ee5\u5c31\u53ea\u8bf4\u63a8\u5f0f\u5b50\u7684\u505a\u6cd5\u597d\u4e86\u3002  \n\n\u6574\u7406\u4e00\u4e0b\u5f0f\u5b50  \n$$ \\frac1{k^2}\\sum_{j=0}^{k-1}(p\\omega_k^j+1)^n\\sum_{d=0}^{k-1}d\\omega_k^{-dj} $$  \n\u540e\u9762\u8fd9\u4e00\u9879\u662f\u4e00\u4e2a\u5f62\u5982$\\sum_{i=0}^{n-1}ir^i$\u7684\u5f0f\u5b50\uff0c\u6211\u4eec\u60f3\u8981\u5feb\u901f\u7b97\u51fa\u5b83\u7684\u503c\u3002  \n\n\u6211\u4eec\u8003\u8651$\\sum_{i=0}^{n-1}(i+1)r^{i+1}$\u3002\n\n\u7a0d\u5fae\u5316\u7b80\u4e00\u4e0b\n$$ \\sum_{i=0}^{n-1}(i+1)r^{i+1}=\\sum_{i=0}^{n-1}ir^{i+1}+\\sum_{i=0}^{n-1}r^{i+1}=r\\sum_{i=0}^{n-1}ir^i+r\\frac{r^n-1}{r-1} $$\n\u6700\u540e\u90a3\u4e00\u6b65\u662f\u4e00\u4e2a\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u3002\n\n\u7136\u540e\u6211\u4eec\u53c8\u77e5\u9053$\\sum_{i=0}^{n-1}ir^i=\\sum_{i=0}^{n-1}(i+1)r^{i+1}+0r^0-nr^n$ \n\n\u90a3\u4e48\u5c31\u6709\n$$ \\sum_{i=0}^{n-1}ir^i=r\\sum_{i=0}^{n-1}ir^i+r\\frac{r^n-1}{r-1}-nr^n$$ \n\u4e24\u8fb9\u968f\u4fbf\u600e\u4e48\u641e\u4e00\u4e0b\u5c31\u4f1a\u6709\n$$ \\sum_{i=0}^{n-1}ir^i=\\frac{nr^n-r\\frac{r^n-1}{r-1}}{r-1}=\\frac{nr^n(r-1)-r(r^n-1)}{(r-1)^2}=\\frac{nr^n}{r-1}-\\frac{r(r^n-1)}{(r-1)^2}$$  \n\u7279\u4f8b\u662f$r=1$\u65f6$\\sum_{i=0}^{n-1}ir^i=\\frac{n(n-1)}2$\u3002\n\n\u56de\u5fc6\u4e00\u4e0b\u8981\u7b97\u7684\u5f0f\u5b50,\n$$  \\frac1{k^2}\\sum_{j=0}^{k-1}(p\\omega_k^j+1)^n\\sum_{d=0}^{k-1}d(\\omega_k^{-j})^d $$ \n\u4e4b\u524d\u63a8\u51fa\u7684\u5f0f\u5b50\u5f80\u91cc\u9762\u5e26\u4e00\u4e0b\uff0c\u90a3\u91cc\u7684$r=1$\u6210\u7acb\u5f53\u4e14\u4ec5\u5f53\u6b64\u65f6\u7684$j=0$\u3002  \n$$ \\sum_{d=0}^{k-1}d(\\omega_k^{-j})^d=\\frac{k\\omega_k^{-jk}}{\\omega_k^{-j}-1} - \\frac{\\omega_{k}^{-j}(\\omega_{k}^{-jk}-1)}{(\\omega_{k}^{-j}-1)^2}=\\frac{k}{\\omega_{k}^{-j}-1}-0=\\frac{k}{\\omega_{k}^{-j}-1}$$\n\u7136\u540e\u5c31\u6709\n$$ \\frac1{k^2}(p+1)^n\\frac{k(k-1)}2+\\frac1{k^2}\\sum_{j=1}^{k-1}(p\\omega_k^j+1)^n\\frac{k}{\\omega_{k}^{-j}-1}$$  \n\u518d\u6574\u7406\u4e00\u4e0b\u5c31\u6709\n$$ \\frac{(p+1)^n(k-1)}{2k} + \\sum_{j=1}^{k-1}\\frac{(p\\omega_k^j+1)^n}{k(\\omega_k^{-j}-1)}$$\n\n\u8003\u8651\u5230$998244352=119\\times2^{23}$\uff0c\u800c$k$\u4e0d\u4f1a\u8d85\u8fc7$2^{20}$\uff0c\u4e8e\u662f\u53ef\u4ee5\u76f4\u63a5\u8ba9$998244353$\u7684\u539f\u6839$3$\u7684$\\frac{998244352}k$\u6b21\u5e42\u6765\u4ee3\u66ff\u8fd9\u91cc\u7684$\\omega_k$\uff0c\u7136\u540e\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u4ee3\u7801\u8fd8\u86ee\u77ed\u7684x\n\n```cpp\n#include<bits/stdc++.h>\n\nusing namespace std;\ntypedef long long int_t;\n\nint_t mod = 998244353;\n\nint_t fpow(int_t a,int_t b,int_t p){\n    int_t res = 1;\n    for(;b;b >>= 1,a = a * a % p) if(b & 1) res = res * a % p;\n    return res;\n}\n\nint main(){\n    int_t n,p,k; cin>>n>>p>>k;\n    int_t ans = - n * p % mod * fpow(p+1,n-1,mod) % mod * fpow(k,mod-2,mod) % mod;\n    int_t omega = fpow(3,(mod - 1) / k,mod),omegainv = fpow(omega,mod-2,mod);;\n    ans += fpow(p+1,n,mod) * (k - 1) % mod * fpow(2 * k,mod-2,mod) % mod;\n    for(int_t j=1,tmp = omega,tmp2 = omegainv;j<k;j++,tmp = tmp * omega % mod,tmp2 = tmp2 * omegainv % mod) {\n        //tmp -> \\omega_k^{j}  tmp2 -> \\omega_k^{-j}\n        ans += fpow(p * tmp % mod + 1,n,mod) * fpow(k * (tmp2 - 1) % mod,mod-2,mod) % mod;\n        ans %= mod;\n    }\n    ans = - ans;\n    ans = (ans % mod + mod) % mod;\n    cout<<ans;\n}\n```",
        "postTime": 1571024821,
        "uid": 74020,
        "name": "Rainy_chen",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5591 \u3010\u5c0f\u732a\u4f69\u5947\u5b66\u6570\u5b66\u3011"
    },
    {
        "content": "\u6240\u6709\u7684\u4e1c\u897f\u6211\u90fd\u80fd\u63a8\u51fa\u6765\u4f46\u5c31\u662f\u88ab\u4e24\u9898\u9898\u9762\u6740\u6253\u6ca1\u4e86....\n\n\u9898\u610f:\u6c42\n\n$$\\sum_{i=0}^n\\binom{n}{i}p^i\\left\\lfloor\\frac{i}{k}\\right\\rfloor\\mod 998244353$$\n\n\u524d\u7f6e\u77e5\u8bc6:\u57fa\u672c\u6570\u8bba\u77e5\u8bc6\uff0c\u4e8c\u9879\u5f0f\u7cfb\u6570\u7684\u7b80\u5355\u6027\u8d28\uff0c\u5355\u4f4d\u6839\u548c\u539f\u6839.\u4e0b\u9762\u8f66\u901f\u53ef\u80fd\u6bd4\u8f83\u5feb.\n\n\u5904\u7406\u4e0b\u53d6\u6574\u7684\u4e00\u4e2a\u5e38\u7528\u529e\u6cd5\u662f\u5206\u79bb\u51fa\u6574\u7684\u4e00\u90e8\u5206.\u5728\u8fd9\u91cc\u6211\u4eec\u53d1\u73b0\u6709\n\n$$\\left\\lfloor\\frac{i}{k}\\right\\rfloor=\\left\\lfloor\\frac{i-i\\!\\!\\mod k}{k}\\right\\rfloor=\\frac{i-i\\!\\!\\mod k}{k}$$\n\n\u540e\u9762\u8fd9\u4e00\u6b65\u662f\u56e0\u4e3a$k\\mid (i-i\\!\\!\\mod k)$\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u53bb\u6389\u4e0b\u53d6\u6574.\n\n\u7136\u540e\u5316\u6210:\n\n$$=\\frac{1}{k}\\left(\\sum_{i=0}^n\\binom{n}{i}p^i i-\\sum_{i=0}^n\\binom{n}{i}p^i(i\\!\\!\\!\\!\\mod k)\\right)$$\n\n\u7136\u540e\u5bf9\u62ec\u53f7\u91cc\u7684\u4e24\u9879\u5206\u5f00\u7b97.\u524d\u9762\u7684\u4e00\u9879\u5c31\u7b49\u4e8e\n\n$$\\sum_{i=1}^nn\\binom{n-1}{i-1}p^i=pn(p+1)^{n-1}$$\n\n\u540e\u9762\u7684\u4e00\u9879\u6bd4\u8f83\u9ebb\u70e6\uff0c\u8003\u8651\u679a\u4e3e$i\\!\\!\\mod k$:\n\n$$\\sum_{d=0}^{k-1}d\\sum_{i=0}^n\\binom{n}{i}p^i[(i-d)\\!\\!\\!\\!\\mod k=0]$$\n\n\u5173\u4e8e\u8fd9\u79cd\u5e26\u7740$[i\\!\\!\\mod k=0]$\u7684\u5f0f\u5b50\u6c42\u548c\u6709\u4e00\u4e2a\u5e38\u89c1\u5957\u8def\u53eb\u505a\u5355\u4f4d\u6839\u53cd\u6f14.\u5c31\u662f\u5229\u7528\u5355\u4f4d\u6839\u7684\u6027\u8d28:\n\n$$\\frac{1}{k}\\sum_{i=0}^{k-1}(\\omega_k^n)^i=[n\\!\\!\\!\\!\\mod k=0]$$\n\n\u8fd9\u4e2a\u5f88\u597d\u8bc1\u660e\uff0c\u5f53$n\\!\\!\\mod k=0$\u65f6$\\omega_k^n=1$\uff0c\u5de6\u8fb9\u7b49\u4e8e$1$\uff1b\u5176\u4ed6\u60c5\u51b5\u4e0b\u5229\u7528\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\u5373\u53ef\u5f97\u5230\u5de6\u8fb9\u7b49\u4e8e$\\frac{\\omega_k^{nk}-1}{k(\\omega_k^n-1)}=0$\n\n\u7136\u540e\u4ee3\u56de\u53bb\u5c31\u5f97\u5230\n\n$$\\begin{aligned}&=\\sum_{d=0}^{k-1}d\\sum_{i=0}^n\\binom{n}{i}p^i\\frac{1}{k}\\sum_{j=0}^{k-1}\\omega_k^{(i-d)j}\\\\&=\\frac{1}{k}\\sum_{j=0}^{k-1}\\sum_{d=0}^{k-1}\\frac{d}{\\omega_k^{dj}}\\sum_{i=0}^n\\binom{n}{i}p^i\\omega_k^{ji}\\\\&=\\frac{1}{k}\\sum_{j=0}^{k-1}(p\\omega_k^j+1)^n\\sum_{d=0}^{k-1}d(\\omega_k^{k-j})^d\\end{aligned}$$\n\n\u89c2\u5bdf\u679a\u4e3e$d$\u7684\u90a3\u4e2a\u4e1c\u897f\uff0c\u8fd9\u663e\u7136\u662f\u4e00\u4e2a\u7b49\u5dee\u6bd4\u6570\u5217.\u8fd9\u4e1c\u897f\u7684\u6c42\u548c\u65b9\u6cd5\u5f88\u591a\uff0c\u8fd9\u91cc\u7ed9\u51fa\u4e00\u79cd\u6270\u52a8\u6cd5\u7684\u505a\u6cd5.\n\n\u4e0b\u9762\u662f\u4e00\u4e2a\u4e00\u822c\u5f62\u5f0f\u7684\u6c42\u548c\n\n$$\\begin{aligned}S&=\\sum_{i=0}^{n-1}ir^i\\\\&=\\sum_{i=0}^{n-1}(i+1)r^{i+1}+0r^0-nr^n\\\\&=r\\sum_{i=0}^{n-1}ir^i+r\\sum_{i=0}^{n-1}r^i-nr^n\\\\&=rS+\\frac{r(r^n-1)}{r-1}-nr^n\\end{aligned}$$\n\n\u628a\u8fd9\u4e2a\u5173\u4e8e$S$\u7684\u65b9\u7a0b\u89e3\u51fa\u6765\u5c31\u5f97\u5230\n\n$$S=\\frac{nr^n}{r-1}-\\frac{r(r^n-1)}{(r-1)^2}$$\n\n\u6ce8\u610f\u521a\u624d\u7684\u63a8\u5bfc\u9ed8\u8ba4\u4e86$r\\neq 1$.\u5f53$r=1$\u65f6\u663e\u7136\u6709\n\n$$S=\\sum_{i=0}^{n-1}i=\\frac{n(n-1)}{2}$$\n\n\u56de\u4ee3\u4e00\u4e0b\u5e76\u5229\u7528$\\omega_k^{kt}=1$\u8fd9\u4e2a\u6027\u8d28\u5c31\u5f97\u5230\n\n$$\\sum_{d=0}^{k-1}d(\\omega_k^{k-j})^d=\\begin{cases}\\frac{k}{\\omega_k^{k-j}-1}&j\\neq 0\\\\\\\\\\frac{k(k-1)}{2}&j=0\\end{cases}$$\n\n\u4ee3\u56de\u53bb\u5f97\u5230\n\n$$\\frac{(p+1)^n(k-1)}{2}+\\sum_{j=1}^{k-1}\\frac{(p\\omega_k^j+1)^n}{\\omega_k^{k-j}-1}$$\n\n\u6700\u540e\u4e00\u4e2a\u7ec6\u8282 $\\omega_k$\u600e\u4e48\u7b97?\n\n\u5982\u679c\u5b66\u4e86$NTT$\u90a3\u8fd9\u4e2a\u4e1c\u897f\u80af\u5b9a\u4f1a.\n\n$998244352=119\\times 2^{23}$\uff0c\u800c\u9898\u76ee\u4fdd\u8bc1\u4e86$k$\u662f$2$\u7684\u4e0d\u8d85\u8fc7$20$\u6b21\u5e42.\u5e76\u4e14\u6211\u4eec\u77e5\u9053$998244353$\u7684\u539f\u6839\u662f$g=3$\uff0c\u6309\u7167$\\omega_k^k=1$\u8fd9\u4e2a\u6027\u8d28\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\n\n$$\\omega_k\\equiv g^{\\frac{998244352}{k}}\\pmod {998244353}$$\n\n\u8fd9\u4e1c\u897f\u597d\u50cf\u4e5f\u53ea\u80fd$O(k\\log n)$\u7b97\u4e86?\u53cd\u6b63\u53ef\u4ee5\u963f\u6389\u5c31\u662f\u4e86.\n\n\u7ffb\u4e86\u7ffb\u6700\u4f18\u89e3\u770b\u89c1\u4e00\u4e2a$IDFT$\u7136\u540e\u6211\u624d\u60f3\u8d77\u6765\u4e0a\u9762\u90a3\u4e2a\u5f0f\u5b50\u957f\u5f97\u548c$FFT$\u7684$IDFT$\u975e\u5e38\u50cf...\u6211\u4e5f\u61d2\u5f97\u63a8\u4e86\u5c31\u7b49\u7740\u5176\u4ed6\u795e\u4ed9\u6765\u5199\u5427(\n\norz EI\u4e00\u773c\u79d2\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nconst int mod=998244353;\nint n,p,k,g,gi;\nint qpower(int a,int b)\n{\n    int ans=1;\n    for(;b;b>>=1,a=1ll*a*a%mod)if(b&1)ans=1ll*ans*a%mod;\n    return ans;\n}\nint main()\n{\n    scanf(\"%d%d%d\",&n,&p,&k);\n    g=qpower(3,(mod-1)/k),gi=qpower(g,mod-2);\n    int ans=1ll*qpower((p+1)%mod,n)*(1ll*(k-1)*(mod+1)/2%mod)%mod;\n\tint wi=1,wii=1;\n    for(int i=1;i<k;i++)\n    {\n        wi=1ll*wi*g%mod,wii=1ll*wii*gi%mod;\n        ans=(ans+1ll*qpower((1ll*p*wi+1)%mod,n)*qpower(wii-1,mod-2))%mod;\n    }\n    ans=(1ll*n*p%mod*qpower((p+1)%mod,n-1)-ans)%mod*qpower(k,mod-2)%mod;\n    printf(\"%d\\n\",(ans+mod)%mod);\n}\n```",
        "postTime": 1570974520,
        "uid": 22136,
        "name": "qwaszx",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5591 \u3010\u5c0f\u732a\u4f69\u5947\u5b66\u6570\u5b66\u3011"
    },
    {
        "content": "\u9898\u610f\u5f88\u660e\u786e\uff0c\u4e0d\u8bf4\u4e86\u3002\n\n## \u524d\u7f6e\u829d\u58eb\uff1a\u5355\u4f4d\u6839\u53cd\u6f14\n\u4e5f\u5c31\u662f\uff1a\n$$ [n|a]=\\frac 1 n \\sum_{i=0}^{n-1}w_n^{ai} $$\n\u770b\u5230\u9898\u76ee\u7ed9\u7684\u67ff\u5b50\uff1a\n$$ \\sum_{i=0}^n\\binom n i \\times p^i \\times \\lfloor \\frac i k \\rfloor $$\n\u5148\u628a\u90a3\u4e2a\u5411\u4e0b\u53d6\u6574\u62c6\u5f00\uff1a\n$$ \\sum_{i=0}^n\\binom n i \\times p^i \\times \\frac {i- i \\bmod k} k $$\n$$ \\frac 1 k \\times (\\sum_{i=0}^n\\binom n i \\times p^i \\times i - \\sum_{i=0}^n\\binom n i \\times p^i \\times i \\bmod k) $$\n\u5148\u770b\u5de6\u8fb9\u7684\uff1a\n$$ \\sum_{i=0}^n \\binom n i\\times p^i \\times i $$\n\u7531\u4e8e $ i $ \u8fd9\u91cc\u5f88\u96be\u4f7f\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\uff0c\u53c8\u4e0d\u80fd\u7206\u7b97\uff0c\u6240\u4ee5\u8003\u8651\u901a\u8fc7\u67d0\u79cd\u65b9\u5f0f\u628a $ i $ \u641e\u6389\uff0c\u7ed9\u51fa\u5f15\u7406\uff1a\n$$ \\binom n m m = \\binom {n-1} {m-1} n $$\n\u8bc1\u660e\u662f\uff1a\n$$ \\binom n m = \\frac {n!} {(n-m)!m!}m = \\frac {(n-1)!} {(n-m)!(m-1)!}n = \\binom {n-1} {m-1}n $$\n\u4e8e\u662f\uff1a\n$$ np\\sum_{i=0}^n\\binom {n-1} {i-1} p^i $$\n\u7136\u540e\u4f7f\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\uff1a\n$$ np(p+1)^{n+1} $$\n\u73b0\u5728\u770b\u5411\u53f3\u8fb9\uff1a\n$$ \\sum_{i=0}^n\\binom n i \\times p^i \\times i \\bmod k $$\n\u6309\u7167\u505a\u83ab\u53cd\u9898\u7684\u7ecf\u9a8c\uff0c\u679a\u4e3e\u4f59\u6570\uff1a\n$$ \\sum_{i=0}^n\\binom n i p^i\\sum_{t=0}^{k-1}t[i-t \\bmod k =0] $$\n\u5355\u4f4d\u6839\u53cd\u6f14\u4e00\u4e0b\uff1a\n$$ \\frac 1 k\\sum_{i=0}^n\\binom n i p^i\\sum_{t=0}^{k-1}t\\sum_{j=0}^{k-1}w_k^{(i-t)j} $$\n$$ \\frac 1 k\\sum_{i=0}^n\\binom n i p^i\\sum_{t=0}^{k-1}t\\sum_{j=0}^{k-1}w_k^{ij}w_k^{-tj} $$\n$$ \\frac 1 k\\sum_{j=0}^{k-1}\\sum_{t=0}^{k-1}tw_k^{-tj}\\sum_{i=0}^n\\binom n i p^iw_k^{ij} $$\n$$ \\frac 1 k\\sum_{j=0}^{k-1}(pw_k^j+1)^n\\sum_{t=0}^{k-1}tw_k^{-tj} $$\n\u4e8e\u662f\u6211\u4eec\u8003\u8651\u600e\u4e48\u5feb\u901f\u8ba1\u7b97 $ \\sum_{i=0}^{n-1}ik^i $\n\n\u8fd9\u770b\u4e0a\u53bb\u5f88\u50cf\u7b49\u6bd4\u6570\u5217\uff0c\u6309\u7167\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\u7684\u63a8\u5bfc\u5bf9\u8fd9\u73a9\u610f\u513f\u505a\u4e00\u904d\uff1a\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u5148\u8bbe\u8fd9\u73a9\u610f\u513f\u4e3a $ f(n,k) $\n$$ kf(n,k)-f(n,k)=\\sum_{i=0}^{n-1}ik^{i+1}-\\sum_{i=0}^{n-1}ik^i $$\n$$ \\sum_{i=1}^n(i-1)k^i-\\sum_{i=0}^{n-1}ik^i $$\n$$ (n-1)k^n-\\sum_{i=1}^{n-1}k^i $$\n$$ (n-1)k^n-\\frac {k^n-k} {k-1} $$\n\u53c8\u56e0\u4e3a\u5e26\u5165\u7684\u90fd\u662f $ k $ \u6b21\u5355\u4f4d\u6839\uff0c\u6240\u4ee5\u4e0a\u5f0f\u7684 $ k^n=1 $\u3002\u4e8e\u662f\uff1a\n$$ n-1+\\frac {1-k}{k-1} =n $$\n\u6240\u4ee5 $ f(n,k) =\\frac n {k-1} $\uff0c\u6ce8\u610f\u8981\u7279\u5224 $ f(n,1) = \\frac {n(n-1)} 2 $\n\u6574\u7406\u4e00\u4e0b\uff1a\n$$ \\frac 1 k \\times ( np(p+1)^{n+1} - \\frac 1 k\\sum_{j=0}^{k-1}(pw_k^j+1)^nf(k,w_k^{-j}) ) $$\n\u8d34\u4ee3\u7801\uff1a\n```cpp\n#include<cstdio>\nconst int M=1<<23|5,mod=998244353;\nint n,p,k,ans,w[M];\ninline int pow(int a,int b=mod-2){\n\tint ans=1;\n\tfor(;b;b>>=1,a=1ll*a*a%mod)if(b&1)ans=1ll*ans*a%mod;\n\treturn ans;\n}\ninline int Add(const int&a,const int&b){\n\treturn a+b>=mod?a+b-mod:a+b;\n}\ninline int f(const int&n,const int&k){\n\tif(k==1)return (1ll*n*(n-1)>>1)%mod;\n\treturn 1ll*n*pow(k-1)%mod;\n}\nsigned main(){\n\tint i;\n\tscanf(\"%d%d%d\",&n,&p,&k);\n\tw[0]=1;w[1]=pow(3,(mod-1)/k);\n\tfor(i=2;i<=k;++i)w[i]=1ll*w[i-1]*w[1]%mod;\n\tfor(i=0;i<k;++i)ans=Add(ans,1ll*pow((1ll*p*w[i]+1)%mod,n)*f(k,w[k-i])%mod);\n\tans=(1ll*n*p%mod*pow(p+1,n-1)%mod-1ll*ans*pow(k)%mod+mod)%mod;\n\tprintf(\"%d\",1ll*ans*pow(k)%mod);\n}\n```",
        "postTime": 1603084483,
        "uid": 160839,
        "name": "Prean",
        "ccfLevel": 7,
        "title": "\u6570\u8bba \u5355\u4f4d\u6839\u53cd\u6f14 P5591\u9898\u89e3"
    },
    {
        "content": "\u4e00\u53d1 rk4 \uff08\u5982\u679c\u628a\u524d\u9762\u7684\u4e24\u6761\u9c7c\u53bb\u91cd\u7684\u8bdd\u5e94\u8be5\u7b97\u662f rk3\uff09\uff0c\u611f\u89c9\u6ca1\u4ec0\u4e48\u597d\u4f18\u5316\u7684\u4e86\u554a...\u524d\u9762\u7684\u9c7c\u4e3a\u5565\u8fd9\u4e48\u5f3a\uff0c\u65e5\u5e38 ~~\u6478~~ \u819c\u9c7c  \u3010\u96fe\n\n\u5148\u6765\u8bb2\u8bb2\u54b1\u4e00\u5f00\u59cb\u7684\u601d\u8def\uff1a\n\n$$\\begin{aligned}   Res= {1\\over k} \\Big(\\sum_{i=0}^n \\binom{n}{i} \\times p^i \\times i -\\sum_{i=0}^n \\binom{n}{i} \\times p^i \\times (i \\% k) \\Big)  \\end{aligned}$$\n\n\n\n\u524d\u534a\u90e8\u5206\u5f88 sb \uff0c\u7b49\u4e8e $np(p+1)^{n-1}$\uff0c\u540e\u534a\u90e8\u5206\u5c1d\u8bd5\u5355\u4f4d\u6839\u641e\n\n$$\\begin{aligned}  &\\sum_{i=0}^n \\binom{n}{i} \\times p^i \\times (i \\% k)  \\\\=& \\sum_d d \\sum_{i=0}^n \\binom{n}{i} \\times p^i [k|(i-d)] \\\\ =&  \\sum_{d=0}^{k-1} d \\sum_{i=0}^n \\binom{n}{i} \\times p^i \\sum_{j=0}^{k-1} \\omega_k^{(i-d)j}  \\\\   =&  \\sum_{d=0}^{k-1} d \\sum_{j=0}^{k-1}  \\omega_k^{-dj}  \\sum_{i=0}^n \\binom{n}{i} \\times p^i \\omega_k^{ij}  \\\\   =&  \\sum_{d=0}^{k-1} d \\sum_{j=0}^{k-1}  \\omega_k^{-dj}  ( \\omega_k^j p +1)^n   \\\\   \\end{aligned}$$\n\n\u7136\u540e\u54b1\u6b7b\u4e86\uff0c\u597d\u50cf\u4e0d\u5927\u4f1a\u641e\uff08\u867d\u8bf4\u5927\u6982\u6653\u5f97\u8fd9\u73a9\u610f\u513f\u53ef\u4ee5\u7528\u767d\u5154\u4e4b\u821e\u91cc\u9762\u7684\u8d28\u6570\u79ef\u62c6\u5206\u641e\u6210 \u6cd5\u6cd5\u5854\u7684\u5f62\u5f0f\u7136\u540e\u540c\u6837 k log k \u73a9...\u7136\u9e45\u54b1\u6839\u672c\u5c31\u4e0d\u60f3\u6253 \u6cd5\u6cd5\u5854 \u5624\u5624\u5624\uff09\n\n\u4e8e\u662f\u5728 \u82cf\u6307\u5bfc \u7684\u6307\u5bfc\u4e0b\u901a\u8fc7\u4e86\u6b64\u9898...\n\n\u9996\u5148\u54b1\u53d1\u73b0\u539f\u6765\u7684\u9898\u76ee\u4e2d\u6700\u4e3a\u68d8\u624b\u7684\u662f\u90a3\u4e2a\u6574\u9664\u64cd\u4f5c\uff1a\n\n\u54b1\u628a\u90a3\u73a9\u610f\u513f\u8f6c\u5316\u4e00\u4e0b\uff0c\u5373  $\\lfloor {i\\over k} \\rfloor = \\sum_{j=0}^i [k|j] -1$ \uff0c\u53d1\u73b0\u5176\u5b9e\u8fd9\u73a9\u610f\u513f\u53ef\u4ee5\u4ece 1 \u5f00\u59cb\u641e \uff1a $\\lfloor {i\\over k} \\rfloor = \\sum_{j=1}^i [k|j] $ \n\n\u7136\u540e\u5957\u5355\u4f4d\u6839\u53cd\u6f14\uff1a\n\n $$\\lfloor {i\\over k} \\rfloor = \\sum_{j=1}^i [k|j] = \\sum_{j=1}^i \\sum_{d=0}^{k-1}  \\omega_k^{dj} =  \\sum_{d=0}^{k-1} \\omega_k^d {\\omega_k^{id}-1\\over \\omega_k^d -1}  $$\n \n\u540e\u9762\u90a3\u73a9\u610f\u513f\u5c31\u662f\u7b49\u6bd4\u6570\u5217\u6c42\u548c\uff0c\u7136\u540e\u54b1\u5e26\u5165\u539f\u5f0f\uff1a\n\n$$\\begin{aligned}Res&=\\sum_{i=0}^{n}  \\binom{n}{i} p^i  \\sum_{d=0}^{k-1} \\omega_k^d {\\omega_k^{id}-1\\over \\omega_k^d -1}  \\\\ &=  \\sum_{d=0}^{k-1} {\\omega_k^d\\over \\omega_k^d -1}    \\sum_{i=0}^{n} \\binom{n}{i} p^i ( \\omega_k^{id}-1) \\\\&= \\sum_{d=0}^{k-1} {\\omega_k^d\\over \\omega_k^d -1}   \\Big( \\sum_{i=0}^{n} \\binom{n}{i} p^i  \\omega_k^{id} -\\sum_{i=0}^{n} \\binom{n}{i} p^i \\Big)  \\\\&= \\sum_{d=0}^{k-1} {\\omega_k^d\\over \\omega_k^d -1}   \\Big( (\\omega_k^dp+1)^n -  (p+1)^n\\Big)  \\end{aligned}$$\n\n\u7136\u540e\u5c31\u597d $k log n$ \u8ba1\u7b97\u4e86 \u3010\u96fe \uff0c\u5047\u7684\n\n\u6ce8\u610f\u5230 \u5bf9\u4e8e d \u4e0d\u4e3a 0 \u7684\u5176\u60c5\u51b5\uff0c\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u65f6\u7684 \u516c\u6bd4 $\\omega_k^d$ \u662f\u4e0d\u4e3a 1 \u7684\uff0c\u4f46\u662f $d=0$ \u65f6\u5c31\u4f1a\u51fa\u4e8b\uff0c\u6240\u4ee5 d=0 \u7684\u60c5\u51b5\u5355\u72ec\u8ba8\u8bba\uff1a\n\n\n$$\\begin{aligned}Res_0&=\\sum_{i=0}^{n}  \\binom{n}{i} p^i  i \\\\&=\\sum_{i=1}^{n}  \\binom{n}{i} p^i  i  \\\\ &= \\sum_{i=1}^{n}  \\binom{n-1}{i-1} p^i n  \\\\&=np\\sum_{i=1}^{n}  \\binom{n-1}{i-1} p^{i-1}  \\\\&=np  (p+1)^{n-1}       \\end{aligned}$$\n\n\u539f\u6765\u662f\u53ef\u4ee5 log n \u8ba1\u7b97\u7684\u4e1c\u897f \u5462\n\n\n\u90a3\u4e48\uff0c\u7b54\u6848\u5c31\u662f\uff1a\n\n$$Res=np  (p+1)^{n-1}  + \\sum_{d=0}^{k-1} {\\omega_k^d\\over \\omega_k^d -1}   \\Big( (\\omega_k^dp+1)^n -  (p+1)^n\\Big)    $$\n\n\n\n# Code\n\n```\n//by Judge (zlw ak ioi)\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#define Rg register\n#define fp(i,a,b) for(Rg int i=(a),I=(b)+1;i<I;++i)\nusing namespace std;\nconst int mod=998244353;\nint n,p,k,w,wj,pn,res;\ninline int mul(int x,int y){return 1ll*x*y%mod;}\ninline void Pls(int& x,int y){if((x+=y)>=mod)x-=mod;}\ninline int inc(int x,int y){return (x+=y)>=mod?x-mod:x;}\ninline int qpow(int x,int p=mod-2){ Rg int s=1;\n\tfor(;p;p>>=1,x=mul(x,x)) if(p&1) s=mul(s,x); return s;\n}\nint main(){ scanf(\"%d%d%d\",&n,&p,&k),w=qpow(3,(mod-1)/k);\n\tPls(res,mul(mul(n,p),pn=qpow(p+1,n-1))),pn=mul(pn,p+1),wj=w;\n\tfp(i,1,k-1) Pls(res,mul(mul(wj,qpow(wj-1)),inc(qpow(mul(p,wj)+1,n),mod-pn))),wj=mul(wj,w);\n\treturn !printf(\"%d\\n\",mul(res,qpow(k)));\n}\n```",
        "postTime": 1572048285,
        "uid": 38576,
        "name": "J\u03bcdge",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5591 \u3010\u5c0f\u732a\u4f69\u5947\u5b66\u6570\u5b66\u3011"
    },
    {
        "content": "\u6765\u5427\u8ba9\u6211\u4eec\u6765\u63a8\u5f0f\u5b50QAQ\uff0c\u9996\u5148\u7b2c\u4e00\u6b65\u8003\u8651\u628a\u4e0b\u53d6\u6574\u62c6\u4e86\uff1a\n\n$$Ans=\\sum_{i=0}^n C_n^i\\times p^i\\times \\lfloor \\frac{i}{k} \\rfloor$$\n\n$$=\\sum_{i=0}^n C_n^i\\times p^i\\times \\frac{i-i\\mod k}{k}$$\n\n$$=\\frac{1}{k}\\times(\\sum_{i=0}^n C_n^i\\times p^i\\times i-\\sum_{i=0}^n C_n^i\\times p^i\\times(i\\mod k))$$\n\n\u8003\u8651\u5bf9\u4e8e\u62ec\u53f7\u5185\u7684\u5f0f\u5b50\u524d\u540e\u5206\u522b\u8ba1\u7b97\uff0c\u9996\u5148\u662f\n\n$$\\sum_{i=0}^n C_n^i\\times p^i\\times i$$\n\n\u6709\u7ec4\u5408\u6570\u6709\u5e42\u6b21\u8003\u8651\u600e\u4e48\u5316\u6210**\u4e8c\u9879\u5f0f\u5b9a\u7406**\u7684\u5f62\u5f0f\uff0c\u6211\u4eec\u8003\u8651\u7528\u7ec4\u5408\u6570\u5438\u6536\u6389$i$\uff1a\n\n$$\\sum_{i=0}^n C_n^i\\times p^i\\times i=\\sum_{i=1}^n n\\times C_{n-1}^{i-1}\\times p^{i}$$\n\n$$=np\\times\\sum_{i=0}^{n-1} C_{n-1}^i\\times p^i=np\\times(p+1)^{n-1}$$\n\n\u597d\u4e86\u4e0a\u9762\u662f\u70ed\u8eab\uff0c\u7136\u540e\u8003\u8651\u600e\u4e48\u641e\u540e\u9762\u90a3\u90e8\u5206\uff1a\n\n$$\\sum_{i=0}^n C_n^i\\times p^i\\times(i\\mod k)$$\n\n$i\\mod k$\u663e\u7136\u5f88\u9ebb\u70e6\uff0c\u6211\u4eec\u8003\u8651\u679a\u4e3e$d=i\\mod k$\uff0c\u90a3\u4e48\u6709$(i-d)\\mod k=0$\uff0c\u4ee3\u8fdb\u53bb\u6709\uff1a\n\n$$\\sum_{i=0}^n C_n^i\\times p^i\\times(i\\mod k)$$\n\n$$=\\sum_{d=0}^{k-1} d\\times\\sum_{i=0}^n C_n^i\\times p^i[(i-d)\\mod k=0]$$\n\n\u7136\u540e\u4e0b\u4e00\u6b65\u5c31\u8981\u7528\u5230**\u5355\u4f4d\u6839\u53cd\u6f14**\u4e86\uff0c\u4e0d\u4f1a\u7684\u53ef\u4ee5\u770b[\u6d45\u8c08\u5355\u4f4d\u6839\u53cd\u6f14](https://www.cnblogs.com/cjjsb/p/11728892.html)\uff0c\u4ee3\u8fdb\u53bb\u6709\uff1a\n\n$$\\sum_{d=0}^{k-1} d\\times(\\sum_{i=0}^n C_n^i\\times p^i\\times \\frac{1}{k}\\sum_{j=0}^{k-1}\\frac{\\omega_k^{ij}}{\\omega_k^{dj}})$$\n\n$$=\\frac{1}{k}\\sum_{j=0}^{k-1}\\sum_{d=0}^{k-1} \\frac{d}{w_k^{dj}}\\sum_{i=0}^n C_n^i\\times(\\omega_k^j\\cdot p)^i$$\n\n$$=\\frac{1}{k}\\sum_{j=0}^{k-1} (\\omega_k^j\\cdot p+1)^n\\times\\sum_{d=0}^{k-1} d\\times(w_k^{k-j})^d$$\n\n\u53d1\u73b0\u540e\u9762\u90a3\u4e2a$\\sum_{d=0}^{k-1} d\\times(w_k^{k-j})^d$\u662f\u505a\u8fd9\u9898\u7684\u5173\u952e\uff0c\u8003\u8651\u600e\u4e48\u5feb\u901f\u8ba1\u7b97\u4e00\u4e2a\u4e00\u822c\u5f62\u5f0f\u7684\u95ee\u9898\uff1a\n\n$$S=\\sum_{i=0}^{n-1} i\\times r^i$$\n\n\u65b9\u6cd5\u5176\u5b9e\u633a\u591a\u7684\uff0c\u8fd9\u91cc\u6211\u7528\u7684\u662f**\u6270\u52a8\u6cd5**\uff08\u4e0d\u77e5\u9053\u7684\u53ef\u4ee5\u5230 **\u300a\u5177\u4f53\u6570\u5b66\u300b** \u4e0a\u770b\u4e0b\uff09\uff1a\n\n$$S=\\sum_{i=0}^{n-1} i\\times r^i$$\n\n$$=\\sum_{i=0}^{n-1} (i+1)\\times r^{i+1} -n\\times r^n$$\n\n$$r\\times\\sum_{i=0}^{n-1} i\\times r^i+r\\times\\sum_{i=0}^{n-1} r^i -n\\times r^n$$\n\n\u524d\u9762\u90a3\u4e00\u9879\u6211\u4eec\u53d1\u73b0$S$\u53c8\u88ab\u6211\u4eec\u51d1\u51fa\u6765\u4e86\uff0c\u800c\u540e\u9762\u90a3\u4e00\u9879\u53ef\u4ee5\u7528**\u7b49\u6bd4\u6570\u5217\u6c42\u548c**\u5f97\u5230\u901a\u5f0f\uff0c\u5219\uff1a\n\n$$S=r\\times S+r\\times \\frac{r^n-1}{1-r}-n\\times r^n$$\n\n\u79fb\u9879\u5c31\u5f97\u5230$S=\\frac{n\\times r^n}{r-1}-\\frac{r^{n+1}-r}{(r-1)^2} (r\\not=1)$\n\n\u7136\u540e\u60f3\u5fc5\u5927\u5bb6\u4e5f\u53d1\u73b0\u4e86\u8fd9\u91cc\u6ca1\u6709\u8003\u8651$r=1$\u7684\u60c5\u51b5\uff0c\u800c\u663e\u7136\u6709\uff1a\n\n$$S=\\frac{n\\times(n-1)}{2} (r=1)$$\n\n\u7efc\u4e0a\u6240\u8ff0\u8fd9\u9898\u5c31\u88ab\u89e3\u51b3\u4e86\uff0c\u800c\u4e14\u7531\u4e8e$998244352=2^{23}\\times 119$\uff0c\u56e0\u6b64\u5728$k\\in\\{2^{\\omega}|0\\le\\omega\\le 20\\}$\u65f6\u662f\u5b58\u5728\u5355\u4f4d\u6839\u7684\n\n```cpp\n#include<cstdio>\n#define RI register int\n#define CI const int&\nusing namespace std;\nconst int N=1<<20|5,mod=998244353;\nint n,p,k,g,w[N],ans,ret;\ninline int quick_pow(int x,int p=mod-2,int mul=1)\n{\n\tfor (;p;p>>=1,x=1LL*x*x%mod) if (p&1) mul=1LL*mul*x%mod; return mul;\n}\ninline void inc(int& x,CI y)\n{\n\tif ((x+=y)>=mod) x-=mod;\n}\ninline void dec(int& x,CI y)\n{\n\tif ((x-=y)<0) x+=mod;\n}\ninline int sub(CI x,CI y)\n{\n\tint t=x-y; return t<0?t+mod:t;\n}\ninline int S(CI r,CI n)\n{\n\tif (r==1) return 1LL*n*(n-1)%mod*quick_pow(2)%mod;\n\treturn sub(1LL*n*quick_pow(r,n)%mod*quick_pow(r-1)%mod,1LL*sub(quick_pow(r,n+1),r)*quick_pow(r-1,mod-3)%mod);\n}\nint main()\n{\n\tscanf(\"%d%d%d\",&n,&p,&k); g=quick_pow(3,(mod-1)/k);\n\tRI i; for (w[0]=i=1;i<=k;++i) w[i]=1LL*w[i-1]*g%mod;\n\tfor (ans=1LL*n*p%mod*quick_pow(p+1,n-1)%mod,i=0;i<k;++i)\n\tinc(ret,1LL*quick_pow((1LL*w[i]*p%mod+1)%mod,n)*S(w[k-i],k)%mod);\n\tdec(ans,1LL*quick_pow(k)*ret%mod);\n\treturn printf(\"%d\",1LL*quick_pow(k)*ans%mod),0;\n}\n```\n\n",
        "postTime": 1571967422,
        "uid": 41698,
        "name": "hl666",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5591 \u3010\u5c0f\u732a\u4f69\u5947\u5b66\u6570\u5b66\u3011"
    },
    {
        "content": "~~\u8003\u8bd5\u65f6\u591a\u9879\u5f0f\u63a8\u9519\u60e8\u906d\u7206\u96f6~~\n\n\u9996\u5148\uff0c\u8fd9\u9053\u9898\u5f88\u660e\u663e\u5f0f\u5b50\u662f\u4e00\u4e2a\u4e8c\u9879\u5377\u79ef\uff0c\u8003\u8651 `EGF`\n\n\u4e0d\u59a8\u8bbe \n\n$$\nf=\\sum_np^n\\lfloor\\frac{n}{k}\\rfloor\\frac{x^n}{n!}\n$$\n\n\u5219\u7b54\u6848\u4e3a\n\n$$\n[x^n]e^x\\times f\n$$\n\n\u73b0\u5728\u8003\u8651 $f$ \u5982\u4f55\u6c42\u51fa\n\n\u7531\u4e8e `EGF` \u7684\u79fb\u4f4d\u548c\u6307\u6807\u4e0b\u653e\u5f88\u597d\u5b9e\u73b0\uff0c\u6240\u4ee5\u8003\u8651\u591a\u9879\u5f0f\n\n$$\n\\hat{f_n}=\\sum_i[n|i]\\frac{x^i}{i!}\n$$\n\n\u663e\u7136 $\\hat{f}_2$ \u5f88\u597d\u6c42\u51fa\uff0c\u5373\u4e3a\n\n$$\n\\hat{f}_2=\\frac{e^x+e^{-x}}{2}\n$$\n\n\u8fd9\u4e5f\u542f\u53d1\u6211\u4eec $\\hat{f}_n$ \u53ef\u4ee5\u7528\u82e5\u5e72\u4e2a\u5f62\u5982 $e^{kx}$ \u7ec4\u5408\u51fa\n\n\u4e8e\u662f\u6211\u4eec\u60f3\u5230\u4e86\u5355\u4f4d\u6839\uff0c\u5373\n\n$$\nw_n^{in}=1\n$$\n\n\u5bf9\u4e8e $w_n^i$ \u800c\u8a00\uff0c\u6709\n\n$$\n\\frac{1}{n}\\sum_{k=0}^{n-1}w_n^{ik}=[i=0]\n$$\n\n\u90a3\u4e48\u53ef\u4ee5\u5f97\u51fa\n\n$$\\hat{f_n}=\\frac{1}{n}\\sum_{i=0}^{n-1}e^{w_n^ix}$$\n\n\u540c\u65f6\u6839\u636e `EGF` \u7684\u6027\u8d28\n\n$$\\frac{\\partial\\hat{f}_n}{\\partial x^k}=\\sum_i[n|(i+k)]\\frac{x^i}{i!}$$\n\n\u4e58\u4e0a $\\frac{x}{n}$ \u5c31\u6709\n\n$$\\frac{x}{n}\\times\\frac{\\partial\\hat{f}_n}{\\partial x^k}=\\sum_i[n|(i+k-1)]\\frac{i}{n}\\frac{x^i}{i!}$$\n\n\u7ed3\u5408\u4e4b\u524d\u5c31\u6709\n\n$$\\frac{x}{n}\\times\\frac{\\partial\\hat{f}_n}{\\partial x^k}+\\frac{k-1}{n}\\times\\frac{\\partial\\hat{f}_n}{\\partial x^{k-1}}=\\sum_i[n|(i+k-1)]\\lceil\\frac{i}{n}\\rceil\\frac{x^i}{i!}$$\n\n\u6240\u4ee5\u5f53 $k\\ge2$ \u65f6\n\n$$\\frac{x}{n}\\times\\frac{\\partial\\hat{f_n}}{\\partial x^k}+\\frac{k-1}{n}\\times\\frac{\\partial\\hat{f_n}}{\\partial x^{k-1}}-\\frac{\\partial\\hat{f_n}}{\\partial x^{k-1}}=\\sum_i[n|(i+k-1)]\\lfloor\\frac{i}{n}\\rfloor\\frac{x^i}{i!}$$\n\n\u7efc\u4e0a\u8ba8\u8bba\n\n$$f=\\sum_{k=1}^n\\frac{x}{n}\\times\\frac{\\partial\\hat{f_n}}{\\partial{x^k}}+\\sum_{k=1}^n\\frac{k-1}{n}$$\n\n\u800c\u5bf9\u4e8e $\\frac{\\partial\\hat{f_n}}{\\partial x^k}$ \u6709\n\n$$\\frac{\\partial\\hat{f_n}}{\\partial x^k}=\\frac{1}{n}\\sum_{i=0}^{n-1}w_n^{ik}e^{w_n^ix}$$\n\n\u6839\u636e\u4ea4\u6362\u6c42\u548c\u5f0f\u7684\u6280\u5de7\u6211\u4eec\u53ef\u4ee5\u628a\u5f0f\u5b50\u7b80\u5316\u4e3a\u53ea\u6709\u4e00\u4e2a\u548c\u5f0f\u800c\u65e0\u5d4c\u5957\u60c5\u51b5\uff0c\u4ee5\u4e2d\u95f4\u7684\u548c\u5f0f\u4e3a\u4f8b\n\n$$\\sum_{k=1}^n\\frac{k-1}{n}\\times\\frac{\\partial\\hat{f_n}}{\\partial x^{k-1}}=\\frac{1}{n^2}\\sum_{i=0}^{n-1}\\sum_{k=1}^n(k-1)\\times w_n^{i(k-1)}e^{w_n^ix}$$\n\n\u6839\u636e\n\n$$\n\\sum_{i=1}^nix^{i-1}=\\frac{nx^{n+1}-nx^n-x^n+1}{(x-1)^2}\n$$\n\n\u4e0a\u9762\u7684\u5f0f\u5b50\u53ef\u4ee5\u5316\u7b80\u4e3a\n\n$$\\sum_{i=1}^{n-1}\\frac{1}{n\\times(w_n^i-1)}e^{w_n^ix}+\\frac{n-1}{2\\times n}e^x$$\n\n\u5176\u4ed6\u540c\u7406\n\n\u6700\u540e\u7684\u95ee\u9898\u53ea\u6709\u5355\u4f4d\u6839\u600e\u4e48\u6c42\u4e86\uff0c\u7531\u4e8e $998244353$ \u4e3a `NTT` \u8d28\u6570\uff0c\u6240\u4ee5 $2^k$ \u7684\u5355\u4f4d\u6839\u5c31\u53ef\u4ee5\u8868\u793a\u4e3a $3^{\\frac{P-1}{2^k}}$\n\n```cpp\n#include <algorithm>\n#include <cstring>\n#include <queue>\n#include <cctype>\n#include <cstdio>\n#include <bitset>\nusing namespace std;\ntypedef long long int64;\ninline int read(int f = 1, int x = 0, char ch = ' ')\n{\n    while(!isdigit(ch = getchar())) if(ch == '-') f = -1;\n    while(isdigit(ch)) x = x*10+ch-'0', ch = getchar();\n    return f*x;\n}\nconst int P = 998244353;\nint64 qpow(int64 a, int b)\n{\n    int64 ret = 1;\n    for( ; b; b >>= 1, a = a*a%P) if(b&1) ret = a*ret%P;\n    return ret;\n}\nint64 n, inv, inv2, p;\nint ans, k;\nint main()SS\n{\n    n = read(), p = read(), k = read();\n    inv = qpow(k, P-2);\n    ans = n*p%P*qpow(p+1, n-1)%P*inv%P;\n    ans = (ans+(k-1)*qpow(2*k, P-2)%P*qpow(p+1, n)%P)%P;\n    ans = (ans+P-qpow(p+1, n))%P;\n    for(int i = 1, wn = qpow(3, (P-1)/k), w = wn; i < k; ++i, w = 1ll*w*wn%P)\n        ans = (ans+qpow(w-1, P-2)*inv%P*qpow(w*p%P+1, n)%P)%P;\n    for(int i = 0, w = 1, wn = qpow(3, (P-1)/k); i < k; ++i, w = 1ll*w*wn%P)  \n        ans = (ans+inv*qpow(w*p%P+1, n)%P)%P;\n    printf(\"%d\\n\", ans);\n    return 0;\n}\n```",
        "postTime": 1570972842,
        "uid": 123514,
        "name": "CTime_Pup_314",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 [P5591] \u5c0f\u732a\u4f69\u5947\u5b66\u6570\u5b66"
    }
]