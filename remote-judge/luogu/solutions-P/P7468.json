[
    {
        "content": "\u9996\u5148\u5206\u6790\u9898\u76ee\u4e2d\u5173\u4e8e\u5956\u52b1\u5173\u5361\u7684\u53d9\u8ff0\uff0c\u5bb9\u6613\u53d1\u73b0\uff1a\n\n**\u6027\u8d28 0** \u7b2c $i$ \u5173\u662f\u5956\u52b1\u5173\u5361\u5f53\u4e14\u4ec5\u5f53 $i$ \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u5305\u542b\u5947\u6570\u4e2a $1$\u3002\n\n\u53ef\u4ee5\u901a\u8fc7\u5bf9 $i$ \u5728\u4e8c\u8fdb\u5236\u4e0b\u7684\u4f4d\u6570\u8fdb\u884c\u5f52\u7eb3\u8bc1\u660e\uff0c\u6b64\u5904\u7565\u53bb\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u8981\u8ba1\u7b97\u7684\u503c\u4e3a\n\n$$\n\\sum_{0\\leq i < n,i\\in C_1}f(i)\n$$\n\n\u5176\u4e2d $C_1$ \u662f\u5168\u4f53\u4e8c\u8fdb\u5236\u8868\u793a\u4e2d\u6709\u5947\u6570\u4e2a $1$ \u7684\u81ea\u7136\u6570\u7684\u96c6\u5408\u3002\u7531\u4e8e\u6709\u9650\u5236 $i < n$\uff0c\u4e3a\u4e86\u53bb\u6389\u8fd9\u4e2a\u9650\u5236\uff0c\u8003\u8651\u679a\u4e3e $i$ \u548c $n$ \u5728\u4e8c\u8fdb\u5236\u4f4d\u4e0a\u9996\u6b21\u4e0d\u4e00\u6837\u7684\u5730\u65b9\u2014\u2014\u8fd9\u6837\uff0c\u66f4\u4f4e\u4f4d\u7684\u9009\u62e9\u4fbf\u662f\u81ea\u7531\u7684\u3002\u4e0d\u59a8\u8bbe $n$ \u5728\u4e8c\u8fdb\u5236\u4e0b\u6709 $s$ \u4f4d\uff0c\u4e14 $n=(n_sn_{s-1}\\cdots n_1)_2$\uff08\u5176\u4e2d $n_s$ \u662f\u6700\u9ad8\u4f4d\uff09\u3002\u4ee4 $T_i$ \u8868\u793a\u5c06 $n$ \u7684\u540e $i$ \u4f4d\u53d8\u6210 $0$ \u6240\u5f97\u7684\u6570\uff08\u5373 $T_i=(n_s\\cdots n_{i+1}00\\cdots 0)_2$\u3002\u90a3\u4e48\u7b54\u6848\u4fbf\u662f\n\n$$\n\\sum_{1\\leq i\\leq s,n_i=1}\\sum_{0\\leq j<2^{i-1},T_i+j\\in C_1}f(T_i+j)\n$$\n\n\u663e\u89c1\u8fd9\u91cc\u7684 $T_i$ \u5bf9\u6bcf\u4e2a $i$ \u662f\u56fa\u5b9a\u4e14\u5bb9\u6613\u8ba1\u7b97\u7684\uff0c\u4e14 $T_i+j$ \u6709\u5947\u6570\u4e2a $1$ \u5f53\u4e14\u4ec5\u5f53 $T_i$ \u548c $j$ \u5728\u5728\u4e8c\u8fdb\u5236\u4e2d\u6709\u76f8\u540c\u5947\u5076\u6027\u4e2a\u6570\u7684 $1$\u3002\u95ee\u9898\u7684\u5173\u952e\u5728\u4e8e\u5bf9\u591a\u9879\u5f0f\u7684\u6c42\u548c\u3002\u6309\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00\uff1a\n\n$$\nf(T+j)=\\sum_{p=0}^{k-1}a_p\\binom{k-1}{p}T^pj^{k-1-p}\n$$\n\n$T=T_i$ \u662f\u786e\u5b9a\u7684\uff0c\u6211\u4eec\u8981\u505a\u7684\u662f\u5feb\u901f\u7684\u6c42\u51fa\u7b26\u5408\u6761\u4ef6\u7684 $j$ \u7684 $0\\sim (k-1)$ \u6b21\u5e42\u548c\u3002\u89c2\u5bdf\u5230\u8fd9\u91cc\u662f\u5bf9\u6240\u6709 $i-1$ \u4f4d\u4e8c\u8fdb\u5236\u6570\u4e2d\u7684\u6070\u597d\u4e00\u534a\u6c42\u6b21\u5e42\u548c\uff0c\u8054\u60f3\u5230\u4e00\u4e2a\u5e7f\u4e3a\u4eba\u77e5\u7684\u7ed3\u8bba\uff1a\n\n**\u5b9a\u7406 1** \u8bbe $k$ \u662f\u6b63\u6574\u6570\uff0c\u90a3\u4e48\n\n$$\n\\sum_{0\\leq i < 2^k,i\\in C_1}i^p=\\sum_{0\\leq i < 2^k,i\\in C_0}i^p\n$$\n\n\u5bf9\u6240\u6709\u7684\u975e\u8d1f\u6574\u6570 $0\\leq p < k$ \u6210\u7acb\uff0c\u5176\u4e2d $C_0,C_1$ \u5206\u522b\u662f\u4e8c\u8fdb\u5236\u4e0b $1$ \u4e2a\u6570\u4e3a\u5076\u6570\u3001\u5947\u6570\u7684\u81ea\u7136\u6570\u96c6\u5408\u3002\n\n\uff08\u77e5\u9053\u8fd9\u4e2a\u5b9a\u7406\u7684\u8bfb\u8005\u53ef\u4ee5\u8df3\u8fc7\u8bc1\u660e\uff09\n\n\u4e3a\u4e86\u8bc1\u660e\u8fd9\u4e2a\u5b9a\u7406\uff0c\u6211\u4eec\u5148\u8bc1\u660e\u5982\u4e0b\u7ed3\u8bba\uff1a\n\n**\u5f15\u7406 2** \u8bbe $x_1,...,x_k;y_1,...,y_k$ \u662f\u5b9e\u6570\uff0c$p$ \u662f\u81ea\u7136\u6570\uff0c\u82e5\u5bf9\u4efb\u610f\u81ea\u7136\u6570 $f\\leq p$ \u90fd\u6709\n\n$$\n\\sum_{i=1}^kx_i^f=\\sum_{i=1}^ky_i^f\n$$\n\n\u90a3\u4e48\u5bf9\u4efb\u610f\u7684\u5b9e\u6570 $z$\uff0c\u6709\n\n$$\n\\sum_{i=1}^k(z+x_i)^f=\\sum_{i=1}^k(z+y_i)^f\n$$\n\n**\u8bc1\u660e** \u5de6\u53f3\u5bf9\u51cf\uff0c\u89c2\u5bdf\u5230 $z^i$ \u9879\u7684\u7cfb\u6570\u4e3a $\\binom{p}{p-i}(\\sum_{j=1}^kx_j^{p-i}-y_j^{p-i})$\uff0c\u7531\u5df2\u77e5\u6761\u4ef6\u663e\u7136\u8be5\u5f0f\u4e3a $0$\u3002\u6545\u5de6\u5f0f\u7b49\u4e8e\u53f3\u5f0f\u3002\n\n**\u5b9a\u7406 1 \u7684\u8bc1\u660e** \u8003\u8651\u5f52\u7eb3\u6cd5\u3002$k=1$ \u65f6\u663e\u7136\u3002$k>1$ \u65f6\uff0c\u5bf9\u4e8e\u4efb\u610f $p < k-1$\uff0c\u7531\u5f52\u7eb3\u5047\u8bbe\u77e5\n\n$$\n\\sum_{0\\leq i < 2^{k-1},i\\in C_1}i^p=\\sum_{0\\leq i < 2^{k-1},i\\in C_0}i^p\n$$\n\n\u90a3\u4e48\u7531\u5f15\u7406\u53ef\u5f97\n\n$$\n\\sum_{0\\leq i < 2^{k-1},i\\in C_1}(2^k+i)^p=\\sum_{0\\leq i < 2^{k-1},i\\in C_0}(2^k+i)^p\n$$\n\n\u5bf9\u4efb\u610f $x\\in [2^{k-1},2^k)$\uff0c$x$ \u7684\u4e8c\u8fdb\u5236\u4e2d $1$ \u7684\u4e2a\u6570\u5947\u5076\u6027\u6070\u548c $x-2^{k-1}$ \u7684\u5947\u5076\u6027\u76f8\u53cd\u3002\u56e0\u800c\u6211\u4eec\u5f97\u77e5\n\n$$\n\\sum_{0\\leq i < 2^k,i\\in C_1}i^p=\\sum_{0\\leq i < 2^{k-1},i\\in C_1}i^p+\\sum_{0\\leq i < 2^{k-1},i\\in C_0}(2^k+i)^p\n$$\n\n\u5bf9\u53e6\u4e00\u4fa7\u4e5f\u6709\u76f8\u540c\u7684\u7ed3\u8bba\u3002\u518d\u7531\u4e0a\u9762\u7684\u5f0f\u5b50\u5c31\u5f97\u77e5\uff1a\u5bf9\u4e8e $p < k-1$\uff0c\u4e0a\u5f0f\u662f\u6210\u7acb\u7684\u3002\u6211\u4eec\u5173\u952e\u6765\u8ba8\u8bba $p=k-1$ \u7684\u60c5\u51b5\u3002\u8fd9\u91cc\u6211\u4eec\u7279\u522b\u7559\u5fc3 $i^{k-1}$ \u6b21\u9879\u7684\u7cfb\u6570\uff08\u56e0\u4e3a\u9664\u4e86\u8fd9\u4e00\u9879\u5916\u524d\u9762\u7684\u6b21\u5e42\u548c\u90fd\u662f\u76f8\u7b49\u7684\uff09\u3002\u5c55\u5f00\u5f97\n\n$$\n\\sum_{0\\leq i < 2^k,i\\in C_1}i^{k-1}=\\sum_{0\\leq i < 2^{k-1},i\\in C_1}i^{k-1}+\\sum_{0\\leq i < 2^{k-1},i\\in C_0}(2^k+i)^{k-1}\n$$\n\n$$\n=\\sum_{0\\leq i < 2^{k-1},i\\in C_1}i^{k-1}+\\sum_{0\\leq i < 2^{k-1},i\\in C_0}(i^{k-1}+\\sum_{j=0}^{k-2}\\binom{k-1}{j}i^j2^{k(k-1-j)}\n$$\n\n$$\n=\\sum_{i=0}^{2^{k-1}}i^{k-1}+\\sum_{0\\leq i < 2^{k-1},i\\in C_0}\\sum_{j=0}^{k-2}\\binom{k-1}{j}i^j2^{k(k-1-j)}\n$$\n\n\u540e\u9762\u90a3\u4e00\u5806\u4e1c\u897f\u662f\u4ec0\u4e48\u5e76\u4e0d\u91cd\u8981\u2014\u2014\u7531\u4e8e $i$ \u7684\u6b21\u5e42\u4e0d\u8d85\u8fc7 $k-2$ \u6b21\uff0c\u56e0\u6b64\u5f52\u7eb3\u5047\u8bbe\u5df2\u7ecf\u4fdd\u8bc1\u4e86\u5de6\u53f3\u662f\u76f8\u7b49\u7684\u3002\u800c\u524d\u9762\u7684 $k-1$ \u6b21\u9879\u795e\u5947\u5730\u5408\u5e76\u4e86\uff01\u5b9a\u7406\u8bc1\u6bd5\u3002\n\n-------------------------\n\n\u56de\u5230\u539f\u9898\u3002\u7531\u4e0a\u9762\u7684\u5b9a\u7406\u8fdb\u4e00\u6b65\u53ef\u4ee5\u77e5\u9053\uff1a\u5f53 $k > p$ \u65f6\uff0c\n\n$$\n\\sum_{0\\leq i < 2^{k},i\\in C_1}i^p=\\sum_{0\\leq i < 2^{k},i\\in C_0}i^p=\\dfrac{1}{2}\\sum_{i=0}^{2^k-1}i^p\n$$\n\n$$\n\\sum_{0\\leq i < 2^{k},i\\in C_1}(T+i)^p=\\sum_{0\\leq i < 2^{k},i\\in C_0}(T+i)^p=\\dfrac{1}{2}\\sum_{i=0}^{2^k-1}(T+i)^p\n$$\n\n\u90a3\u4e48\u5f53 $k-1 < i-1$ \u65f6\uff0c\u8981\u6c42\u7684\n\n$$\n\\sum_{0\\leq j<2^{i-1},T_i+j\\in C_1}f(T_i+j)=\\dfrac{1}{2}\\sum_{0\\leq j<2^{i-1}}f(T_i+j)\n$$\n\n\u4ee4 $S(x)=\\sum_{i=0}^{x}f(i)$\u3002\u663e\u89c1\u8fd9\u662f\u5173\u4e8e $x$ \u7684\u4e0d\u8d85\u8fc7 $k$ \u6b21\u7684\u591a\u9879\u5f0f\u4e14\u5f53 $k$ \u5c0f\u4e8e\u6a21\u6570\u65f6\u5728\u6a21\u610f\u4e49\u4e0b\u6709\u7b49\u4ef7\u6027\u3002\u6211\u4eec\u53ef\u4ee5\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u7684\u65b9\u6cd5\uff0c\u5728\u6c42\u51fa $S(0),...,S(k)$ \u540e\u63a8\u51fa\u5404\u9879\u7cfb\u6570\u3002\u8fd9\u6837\u5728\u9884\u5904\u7406\u7cfb\u6570\u540e\u4fbf\u53ef\u4ee5 $O(k)$ \u4ee3\u5165\u4e0a\u5f0f\u8fdb\u884c\u8ba1\u7b97\u4e86\uff01\u7b97\u4e0a\u679a\u4e3e $i$ \u7684\u590d\u6742\u5ea6\uff0c\u8fd9\u4e00\u90e8\u5206\u7684\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(sk)$\u3002\n\n\u6211\u4eec\u8fd8\u5269\u4e0b $k\\geq i$ \u7684\u60c5\u51b5\u6ca1\u6709\u5904\u7406\u3002\u7531\u4e8e\u8fd9\u6837\u7684 $i$ \u53ea\u6709 $k$ \u4e2a\uff0c\u6211\u4eec\u8003\u8651\u66b4\u529b\u5904\u7406\u51fa $G_z(i,p)=\\sum_{0\\leq j < 2^i,j\\in C_z}j^p$\u3002\u8fd0\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u53ef\u4ee5\u5728 $O(k^3)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u5b8c\u6210\u8f6c\u79fb\u3002\u4e4b\u540e\u66b4\u529b\u4ee3\u5165\u8ba1\u7b97\u5373\u53ef\u3002\u8fd9\u4e00\u90e8\u5206\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(k^3)$\u3002\u7efc\u4e0a\uff0c\u6211\u4eec\u5728 $O(sk+k^3)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u89e3\u51b3\u4e86\u672c\u9898\u3002",
        "postTime": 1616833025,
        "uid": 112794,
        "name": "\u5468\u5b50\u8861",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P7468 \u3010[NOI Online 2021 \u63d0\u9ad8\u7ec4] \u6124\u6012\u7684\u5c0fN\u3011"
    },
    {
        "content": "\u672c\u6587\u540c\u6b65\u4e8e\u6211\u7684 [cnblog](https://www.cnblogs.com/ZigZagKmp/p/14586444.html)\u3002\n\n## \u9898\u610f\u7b80\u8ff0\n\u6570\u5217 $\\{b_n\\}$ \u6784\u9020\u5982\u4e0b\uff1a\uff08\u5373 `Thue-Morse` \u6570\u5217\uff0c[OEIS A010060](http://oeis.org/A010060)\uff09\n- $b_0=0$\n- $\\forall i\\in [2^n,2^{n+1}),b_i=1-b_{i-2^n}$\n\n\u8f93\u5165 $n$ \u548c\u4e00\u4e2a\u6b21\u6570\u4e3a $m-1$ \u6b21\u7684\u591a\u9879\u5f0f $f(x)=\\sum\\limits_{i=0}^{m-1}a_ix^i$ \uff0c\u6c42 $\\sum\\limits_{i=0}^{n-1}b_if(i)$ \uff0c\u7b54\u6848\u5bf9 $10^9+7$ \u53d6\u6a21\u3002\n\n$0\\le \\log_2 n\\le 5\\cdot 10^5\\ ,\\ 1\\le m\\le 500\\ ,\\ 0\\le a_i< 10^9+7\\ ,\\ a_{m-1}\\neq 0$ \u3002\n\n## \u7b97\u6cd5\u5206\u6790\n\n\u6211\u4eec\u9996\u5148\u5c1d\u8bd5\u627e\u5230 $\\{b_n\\}$ \u7684\u901a\u9879\uff0c\u65b9\u4fbf\u6211\u4eec\u4e0b\u9762\u7684\u6c42\u89e3\u3002\n\n\u7531\u6784\u9020\u8fc7\u7a0b\uff0c\u4e0d\u96be\u53d1\u73b0\uff0c\u6211\u4eec\u5728 $x$ \u7684\u6700\u9ad8\u4f4d\u524d\u6dfb\u4e0a\u4e00\u4e2a $1$ \uff08\u8bbe\u4e3a $y$ \uff09\uff0c\u5219 $b_{y}=b_{x}\\mathrm{xor}1$ \uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6700\u660e\u663e\u7684\u53d8\u5316\u5c31\u662f\u4e8c\u8fdb\u5236\u4e2d $1$ \u7684\u4e2a\u6570 $+1$ \uff0c\u56e0\u6b64\u6211\u4eec\u6709\u5982\u4e0b\u7ed3\u8bba\uff1a\n\n$$b_{n}=\\mathrm{popcount}(n) \\pmod 2$$\n\n$\\mathrm{popcount}(n)$ \u5373\u4e3a $n$ \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4e0b\u6709\u591a\u5c11\u4e2a $1$ \u3002\n\n\u4f46\u8fd9\u4e2a$\\pmod 2$  \u5e76\u4e0d\u597d\u5904\u7406\uff0c\u6211\u4eec\u8f6c\u5316\u6210\u4e58\u79ef\uff0c\u5373\uff1a\n\n$$b_{n}=\\frac{1}{2}\\left(1-(-1)^{\\mathrm{popcount}(n)}\\right)$$\n\n\u56e0\u6b64\u7b54\u6848\u5982\u4e0b\uff1a\n\n$$ans=\\frac{1}{2}\\sum_{i=0}^{n-1}\\left(1-(-1)^{\\mathrm{popcount}(i)}\\right)f(i)$$\n\n\u7a0d\u4f5c\u5316\u7b80\uff1a\n\n$$ans=\\frac{1}{2}\\sum_{i=0}^{n-1}f(i)-\\frac{1}{2}\\sum_{i=0}^{n-1}(-1)^{\\mathrm{popcount}(i)}f(i)$$\n\n\u7531\u4e8e $f(x)$ \u662f\u4e00\u4e2a $m-1$ \u6b21\u591a\u9879\u5f0f\uff0c\u56e0\u6b64\u53ef\u4ee5\u5f52\u7eb3\u8bc1\u660e $f(x)$ \u7684\u524d\u7f00\u548c\u662f\u4e00\u4e2a $m$ \u6b21\u591a\u9879\u5f0f\uff0c\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u5373\u53ef\u6c42\u51fa\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(m^2)$ \u3002\n\n\u73b0\u5728\u6211\u4eec\u53ea\u770b\u540e\u9762\u4e00\u90e8\u5206\uff0c\u5373\uff1a\n\n$$\\sum_{i=0}^{n-1}(-1)^{\\mathrm{popcount}(i)}f(i)$$\n\n\u628a $f(i)$ \u5c55\u5f00\uff0c\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\uff1a\n\n$$\\sum_{k=0}^{m-1}a_k\\sum_{i=0}^{n-1}(-1)^{\\mathrm{popcount}(i)}i^k$$\n\n\u6211\u4eec\u53ea\u8981\u80fd\u6c42\u51fa $\\sum\\limits_{i=0}^{n-1}(-1)^{\\mathrm{popcount}(i)}i^k$\uff0c\u5373\u53ef $\\mathcal{O}(m)$ \u8ba1\u7b97\u3002\n\n\u8003\u8651\u7c7b\u4f3c\u4e8e `\u6570\u4f4ddp` \u7684\u505a\u6cd5\uff0c**\u628a $[0,n)$ \u8fd9\u4e2a\u533a\u95f4\u62c6\u89e3\u4e3a\u82e5\u5e72\u4e2a\u5f62\u5982 $[x,x+2^t)(x>2^t)$ \u7684\u533a\u95f4**\uff0c\u8fd9\u6837\u6211\u4eec**\u6240\u6709\u7684\u533a\u95f4\u957f\u5ea6\u90fd\u662f $2$ \u7684\u6574\u6b21\u5e42**\uff0c\u65b9\u4fbf\u6211\u4eec\u8ba1\u7b97\u3002\n\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c$n=\\left(10101101\\right)_2$\uff0c\u6211\u4eec\u62c6\u89e3\u4e3a\u5982\u4e0b\u51e0\u4e2a\u533a\u95f4\uff1a\n- $\\left[\\left(00000000\\right)_2,\\left(10000000\\right)_2\\right)$\n- $\\left[\\left(10000000\\right)_2,\\left(10100000\\right)_2\\right)$\n- $\\left[\\left(10100000\\right)_2,\\left(10101000\\right)_2\\right)$\n- $\\left[\\left(10101000\\right)_2,\\left(10101100\\right)_2\\right)$\n- $\\left[\\left(10101100\\right)_2,\\left(10101101\\right)_2\\right)$\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u7684\u5de5\u4f5c\u5c31\u662f\u8981\u8ba1\u7b97 $\\sum\\limits_{i=x}^{x+2^t-1}(-1)^{\\mathrm{popcount}(i)}i^k$\uff0c\u4e0d\u59a8\u8bb0\u6b64\u4e3a $f(x,t,k)$\uff0c\u5219\uff1a\n\n$$f(x,t,k)=\\sum_{i=0}^{2^t-1}(-1)^{\\mathrm{popcount}(i+x)}(i+x)^k$$\n\n\u6211\u4eec\u5212\u5206\u533a\u95f4\u7684\u4f18\u52bf\u73b0\u5728\u5c31\u4f53\u73b0\u51fa\u6765\u4e86\uff0c\u56e0\u4e3a $x>2^t$ \uff0c\u6240\u4ee5 $\\mathrm{lowbit}(x)>\\mathrm{highbit}(2^t)$ \uff0c\u56e0\u6b64 $\\mathrm{popcount}$ \u6211\u4eec\u53ef\u4ee5\u72ec\u7acb\u8ba1\u7b97\uff0c\u5373\uff1a\n\n$$f(x,t,k)=(-1)^{\\mathrm{popcount}(x)}\\sum_{i=0}^{2^t-1}(-1)^{\\mathrm{popcount}(i)}(i+x)^k$$\n\n\u540e\u9762\u7684 $(i+x)^k$ \u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00\uff0c\u5373\uff1a\n\n$$f(x,t,k)=(-1)^{\\mathrm{popcount}(x)}\\sum_{i=0}^{2^t-1}(-1)^{\\mathrm{popcount}(i)}\\sum_{j=0}^k\\dbinom{k}{j}i^jx^{k-j}$$\n\n\u7ee7\u7eed\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\uff0c\u5e76\u72ec\u7acb\u51fa $x$ \uff0c\u5373\uff1a\n\n$$f(x,t,k)=(-1)^{\\mathrm{popcount}(x)}\\sum_{j=0}^k\\dbinom{k}{j}x^{k-j}\\sum_{i=0}^{2^t-1}(-1)^{\\mathrm{popcount}(i)}i^j$$\n\n**\u5b50\u95ee\u9898\u51fa\u73b0\u4e86**\uff0c\u5373\uff1a\n\n$$f(x,t,k)=(-1)^{\\mathrm{popcount}(x)}\\sum_{j=0}^k\\dbinom{k}{j}x^{k-j}f(0,t,j)$$\n\n\u4f46 $f(0,t,j)$ \u5e76\u4e0d\u80fd\u7531\u6211\u4eec\u4e0a\u9762\u7684\u5f0f\u5b50\u8ba1\u7b97\u51fa\uff0c\u8003\u8651 $[0,2^t)=[0,2^{t-1})\\cup[2^{t-1},2^t)$\uff0c\u800c\u8fd9\u79cd\u533a\u95f4\u7684\u5212\u5206\u4ecd\u7136\u6ee1\u8db3\u4e0a\u9762\u7684\u6761\u4ef6\uff08$x>2^t$\uff09\uff0c\u56e0\u6b64\uff1a\n\n$$f(0,t,k)=f(0,t-1,k)+f(2^{t-1},t-1,k)$$\n\n\u7efc\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 $\\mathcal{O}(m)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5b9e\u73b0 $f(x,t,k)$ \u7684\u8f6c\u79fb\uff0c\u540e\u9762\u4e24\u7ef4\u72b6\u6001\u6570\u662f $\\mathcal{O}(m^2)$ \u7684\uff0c\u603b\u5171\u6709 $\\mathcal{O}(\\log_2 n+m)$\u4e2a\u53ef\u80fd\u7684$x$\uff0c\u56e0\u6b64\u56e0\u6b64\u603b\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}((\\log_2n+m)m^2)$ \u7684\uff0c\u53ef\u4ee5\u901a\u8fc7 $60\\%$ \u7684\u6570\u636e\u3002\n\n~~\u901a\u8fc7\u6253\u8868~~\uff0c\u53d1\u73b0 $f(x,t,k)$ \u5728 $x>2^k$ \u6216\u8005 $t>k$ \u65f6\u90fd\u662f $0$ \u3002\u8fd9\u4e2a\u4e5f\u662f\u53ef\u4ee5\u5f52\u7eb3\u8bc1\u660e\u7684\uff0c\uff08\u4f46\u6211\u4e0d\u4f1a\u8bc1\uff09\uff0c\u6b64\u5904\u7565\u53bb\u3002\n\n\u56e0\u6b64\u6240\u6709 $>m$ \u7684 $x$ \u90fd\u6ca1\u6709\u7528\uff0c\u56e0\u6b64\u5b9e\u9645\u4e0a\u53ea\u6709 $\\mathcal{O}(m)$ \u4e2a\u53ef\u80fd\u7684\u4e0d\u540c\u7684 $x$ \uff0c\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}(\\log_2n+m^3)$ \uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n## \u4ee3\u7801\u5b9e\u73b0\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define maxn 1000005\n#define maxm 2000005\n#define inf 0x3f3f3f3f\n#define LL long long\n#define ull unsigned long long\n#define db double\n#define ldb long double\n#define mod 1000000007\n#define eps 1e-9\n#define local\nvoid file(string s){freopen((s+\".in\").c_str(),\"r\",stdin);freopen((s+\".out\").c_str(),\"w\",stdout);}\ntemplate <typename Tp> void read(Tp &x){\n\tint fh=1;char c=getchar();x=0;\n\twhile(c>'9'||c<'0'){if(c=='-'){fh=-1;}c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<1)+(x<<3)+(c&15);c=getchar();}x*=fh;\n}\nint ksm(int b,int p=mod-2,int Mod=mod){int ret=1;while(p){if(p&1)ret=1ll*ret*b%Mod;b=1ll*b*b%Mod;p>>=1;}return ret;}\n\nint iv2=((mod+1)/2);\nint n,m;\nchar ss[maxn];\nint a[maxn];\nstruct Larg{//\u62c9\u683c\u6717\u65e5\u63d2\u503c\u6c42\u524d\u7f00\u548c\n\tint calc_f(int x){\n\t\tint ret=0;\n\t\tfor(int i=m-1;i>=0;--i){\n\t\t\tret=(1ll*ret*x+a[i])%mod;\n\t\t}\n\t\treturn ret;\n\t}\n\tint frac[505],frinv[505],xi[505],yi[505],syi[505],N;\n\tint pv[505],sf[505];\n\tvoid prepr(){\n\t\tN=m+1;\n\t\tfrac[0]=1;for(int i=1;i<=N;++i)frac[i]=1ll*frac[i-1]*i%mod;\n\t\tfrinv[N]=ksm(frac[N]);for(int i=N;i;--i)frinv[i-1]=1ll*frinv[i]*i%mod;\n\t\tyi[0]=calc_f(0);\n\t\tfor(int i=1;i<=N;++i){\n\t\t\txi[i]=i;yi[i]=(yi[i-1]+calc_f(i))%mod;\n\t\t\tint prv=frinv[i-1],suf=frinv[N-i];\n\t\t\tif((i^N)&1)suf=(mod-suf);\n\t\t\tsyi[i]=1ll*yi[i]*prv%mod*suf%mod;\n\t\t}\n\t}\n\tint calc_sf(int x){\n\t\tx%=mod;\n\t\tpv[0]=sf[N+1]=1;\n\t\tfor(int i=1;i<=N;++i)pv[i]=1ll*pv[i-1]*(x-xi[i])%mod;\n\t\tfor(int i=N;i;--i)sf[i]=1ll*sf[i+1]*(x-xi[i])%mod;\n\t\tint ret=0;\n\t\tfor(int i=1;i<=N;++i){\n\t\t\tret=(ret+1ll*syi[i]*pv[i-1]%mod*sf[i+1]%mod)%mod;\n\t\t}\n\t\treturn (ret+mod)%mod;\n\t}\n}La;\n\nint ans1,ans2;\nint C[505][505];\nint p2[maxn];\nvoid prep(){\n\tfor(int i=0;i<=m;++i){\n\t\tC[i][0]=C[i][i]=1;\n\t\tfor(int j=1;j<i;++j){\n\t\t\tC[i][j]=(C[i-1][j]+C[i-1][j-1])%mod;\n\t\t}\n\t}\n\tp2[0]=1;\n\tfor(int i=1;i<=n;++i)p2[i]=2ll*p2[i-1]%mod;\n}\nint ff[505][505];\n\nint calc(int tn,int k){//\u8ba1\u7b97 f(0,tn,k)\n\tif(tn>k)return 0;\n\tif(tn==0)return k==0;\n\tif(ff[tn][k]!=-1)return ff[tn][k];\n\tint ret=calc(tn-1,k);\n\tint X=p2[tn-1];\n\tint px=1;\n\tfor(int j=k;j>=0;--j,px=1ll*px*X%mod){\n\t\tret=(ret+mod-1ll*C[k][j]*px%mod*calc(tn-1,j)%mod)%mod;\n\t}\n\treturn ff[tn][k]=ret;\n}\n\nvoid solve(){\n\tint tnm=0,tppc=0;\n\tfor(int i=0;i<n;++i){\n\t\tint cnm=(2ll*tnm+ss[i]-'0')%mod,cppc=(tppc^(ss[i]-'0'));\n\t\tif(n-i-1<=m){//\u65e0\u7528\u7684x\u76f4\u63a5\u526a\u679d\u51cf\u6389\n\t\t\tif(ss[i]=='1'){//\u5212\u5206\u533a\u95f4\n\t\t\t\tint X=1ll*tnm*p2[n-i]%mod;\n\t\t\t\tfor(int k=0;k<m;++k){\n\t\t\t\t\tint sm=0;\n\t\t\t\t\tint px=1;\n\t\t\t\t\tfor(int j=k;j>=0;--j,px=1ll*px*X%mod){\n\t\t\t\t\t\tsm=(sm+1ll*C[k][j]*px%mod*calc(n-i-1,j)%mod)%mod;\n\t\t\t\t\t}\n\t\t\t\t\tif(tppc)sm=(mod-sm);\n\t\t\t\t\tans2=(ans2+1ll*a[k]*sm%mod)%mod;\n\t\t\t\t}\n\t\t\t}\t\n\t\t}\n\t\t\n\t\ttnm=cnm,tppc=cppc;\n\t}\n}\n\nsigned main(){\n\t#ifndef local\n\t\tfile(\"angry\");\n\t#endif\n\tmemset(ff,-1,sizeof(ff));\n\tscanf(\"%s\",ss);n=strlen(ss);\n\tread(m);\n\tfor(int i=0;i<m;++i)read(a[i]);\n\tLa.prepr();prep();\n\tint nm=0;\n\tfor(int i=0;i<n;++i)nm=(2ll*nm+ss[i]-'0')%mod;\n\tnm=(nm+mod-1)%mod;\n\tans1=La.calc_sf(nm);\n\tsolve();\n\tint ans=(ans1+mod-ans2)%mod;\n\tans=1ll*ans*iv2%mod;\n\tprintf(\"%d\\n\",ans);\n\tfclose(stdin);\n\tfclose(stdout);\n\treturn 0;\n}\n```",
        "postTime": 1616851479,
        "uid": 35871,
        "name": "ZigZagKmp",
        "ccfLevel": 7,
        "title": "\u3010\u9898\u89e3 P7468\u3011 [NOI Online 2021 \u63d0\u9ad8\u7ec4] \u6124\u6012\u7684\u5c0fN"
    },
    {
        "content": "\u8003\u573a\u4e0a\u8fd9\u9898\u505a\u4e86 2h\uff0c\u76f4\u63a5\u6ca1\u65f6\u95f4\u5199 T3 \u4e86\uff0c\uff0c\uff0c\uff0c\uff0c\uff0c\uff0c\uff0c\n\n\u5148\u8003\u8651\u4e00\u4e2a $O(nk^2)$ \u7684\u65e0\u8111 dp\uff1a\u8bbe $f_{i,j,0/1}$ \u8868\u793a $0\\sim 2^i-1$ \u7f16\u53f7\u7684\u4f4d\u7f6e\u4e2d\uff0c\u6240\u6709 a/b \u4f4d\u7f6e\u7684\u7f16\u53f7\u7684 $j$ \u6b21\u65b9\u548c\u3002\n\n\u5219\u6709\n\n$$f_{i,j,k}=f_{i-1,j,k}+\\sum_{l\\le j} \\binom jl f_{i-1,l,1-k}2^{(i-1)(j-l)}$$\n\n\u76f4\u63a5\u8f6c\u79fb\uff0c\u590d\u6742\u5ea6 $O(nk^2)$\u3002\n\n\u7b97\u7b54\u6848\u65f6\u5206\u6210 $O(n)$ \u4e2a\u5c0f\u6bb5\uff0c\u6bcf\u6bb5\u5f62\u5982\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/risfjbq4.png)\n\n\u4e5f\u5c31\u662f\u628a $n$ \u7684\u4e8c\u8fdb\u5236\u91cc\u9762\u7684\u6bcf\u4e00\u4e2a `1` \u6309\u7167\u6b21\u6570\u4ece\u5927\u5230\u5c0f\u6392\u5217\uff0c\u5bf9\u6bcf\u4e2a `1` \u7ba1\u8f96\u7684\u4e00\u6bb5\u7b97\u7b54\u6848\u3002\u8fd9\u4e00\u90e8\u5206\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4e8c\u9879\u5f0f\u5b9a\u7406\u62c6\u5f00\uff0c\u5229\u7528\u4e4b\u524d\u7b97\u7684 $f$ \u505a\u5230 $O(nk^2)$\u3002\n\n> **\u5b9a\u7406** \u82e5 $i>j$ \u5219 $f_{i,j,0}=f_{i,j,1}=\\dfrac{\\sum_{k=0}^{2^i-1}k^j}{2}$\u3002\n\n\u5bf9 $i$ \u5f52\u7eb3\u53ef\u8bc1\uff0c\u8fd9\u91cc\u7565\u53bb\uff0c\u8003\u573a\u4e0a\u53ef\u4ee5\u7528\u627e\u89c4\u5f8b\u7b49\u5404\u79cd\u65b9\u5f0f\u5f97\u5230\u3002\n\n\u7531\u6b64\uff0c\u5bf9\u4e8e\u4e4b\u524d\u7b97\u7b54\u6848\u65f6\u62c6\u5206\u51fa\u6765\u7684\uff0c\u957f\u5ea6\u5927\u4e8e $2^k$ \u7684\u6bb5\uff0c\u90fd\u53ef\u4ee5\u63d2\u503c\u7b97\u3002\uff08\u6ce8\u610f\u5230\u6574\u4e2a\u591a\u9879\u5f0f\u7684\u524d\u7f00\u548c\u4e5f\u662f\u591a\u9879\u5f0f\uff0c\u53ef\u4ee5\u4e00\u8d77\u63d2\u503c\uff0c\u7136\u540e\u6bcf\u6bb5\u4e0d\u7528\u5206\u522b\u63d2\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u63d2\u6574\u4e2a\u524d\u7f00\uff09\u63d2\u503c\u53ea\u6709 $O(k)\\sim O(k^2)$ \u7684\u590d\u6742\u5ea6\u3002\n\n\u7136\u540e\u5bf9\u5c0f\u4e8e\u7b49\u4e8e $2^k$ \u7684\u6bb5\u66b4\u529b dp \u7136\u540e\u7b97\uff0c\u8fd9\u90e8\u5206\u590d\u6742\u5ea6 $O(k^3)$\u3002\n\n\u603b\u590d\u6742\u5ea6 $O(n+k^3)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int mod=1e9+7;\nint n,K,a[505],f[505][505][2],C[505][505]={1},pw[505]={1},ans=0;\nchar s[500005];\nint Power(int x,int y){\n\tint r=1;\n\twhile(y){\n\t\tif(y&1)r=1ll*r*x%mod;\n\t\ty>>=1,x=1ll*x*x%mod;\n\t}\n\treturn r;\n}\nint Interpolation(int n,int K,vector<int> x,vector<int> y){\n\tint ans=0;\n\tfor(int i=0;i<n;i++){\n\t\tint fz=y[i],fm=1;\n\t\tfor(int j=0;j<n;j++){\n\t\t\tif(i==j)continue;\n\t\t\tfz=1ll*fz*((K-x[j]+mod)%mod)%mod,fm=1ll*fm*((x[i]-x[j]+mod)%mod)%mod;\n\t\t}\n\t\tans=(ans+1ll*fz*Power(fm,mod-2)%mod)%mod;\n\t}\n\treturn ans;\n}\nint main(){\n\tscanf(\"%s%d\",s,&K),n=strlen(s);\n\tfor(int i=0;i<K;i++)scanf(\"%d\",&a[i]);\n\tvector<int> x,y;\n\tfor(int i=0,ts=0;i<=505;i++){\n\t\tx.push_back(i),y.push_back(ts);\n\t\tint sum=0;\n\t\tfor(int j=K-1;j>=0;j--)sum=(1ll*sum*i+a[j])%mod;\n\t\tts=(ts+sum)%mod;\n\t}\n\tfor(int i=1;i<=K;i++){\n\t\tC[i][0]=1;\n\t\tfor(int j=1;j<=i;j++)C[i][j]=(C[i-1][j]+C[i-1][j-1])%mod;\n\t}\n\tf[0][0][0]=1;\n\tfor(int i=1,t=1;i<=K;i++,t=2*t%mod){\n\t\tfor(int j=1;j<K;j++)pw[j]=1ll*pw[j-1]*t%mod;\n\t\tfor(int j=0;j<K;j++){\n\t\t\tunsigned long long w0=0,w1=0;\n\t\t\tfor(int k=0;k<=j;k++){\n\t\t\t\tint t=1ll*pw[j-k]*C[j][k]%mod;\n\t\t\t\tw1+=1ll*f[i-1][k][0]*t;\n\t\t\t\tw0+=1ll*f[i-1][k][1]*t;\n\t\t\t\tif((k&15)==0)w0%=mod,w1%=mod;\n\t\t\t}\n\t\t\tf[i][j][0]=(f[i-1][j][0]+w0)%mod,f[i][j][1]=(f[i-1][j][1]+w1)%mod;\n\t\t}\n\t}\n\tfor(int i=n-1,ss=0,cur=0;i>=0;i--){\n\t\tif(s[n-i-1]!='1')continue;\n\t\tif(i>K){\n\t\t\tss=(ss+Power(2,i))%mod,cur^=1;\n\t\t\tcontinue;\n\t\t}\n\t\tfor(int j=1;j<K;j++)pw[j]=1ll*pw[j-1]*ss%mod;\n\t\tfor(int j=0;j<K;j++){\n\t\t\tunsigned long long sum=0;\n\t\t\tfor(int k=0;k<=j;k++){\n\t\t\t\tsum+=1ll*f[i][k][cur^1]*C[j][k]%mod*pw[j-k];\n\t\t\t\tif((k&15)==0)sum%=mod;\n\t\t\t}\n\t\t\tans=(ans+1ll*sum%mod*a[j])%mod;\n\t\t}\n\t\tss=(ss+Power(2,i))%mod,cur^=1;\n\t}\n\t//\u8fd8\u5269\u4e0bK+1~n-1\u7684\u8d21\u732e\uff0c\u8fd9\u90e8\u5206\u76f4\u63a5\u63d2\u503c\u6c42f(k)\u524d\u7f00\u548c \n\tint ss=0;\n\tfor(int i=n-1;i>K;i--)if(s[n-i-1]=='1')ss=(ss+Power(2,i))%mod;\n\tcout<<(ans+1ll*(mod+1)/2*Interpolation(x.size(),ss,x,y))%mod;\n}\n```",
        "postTime": 1616836842,
        "uid": 42156,
        "name": "feecle6418",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7468\u3010[NOI Online 2021 \u63d0\u9ad8\u7ec4] \u6124\u6012\u7684\u5c0fN\uff08\u6c11\u95f4\u6570\u636e\uff09\u3011"
    },
    {
        "content": "\u5b98\u65b9\u9898\u89e3\u5bf9\u7ed3\u8bba\u7684\u8bc1\u660e\u4e0d\u76f4\u89c2\uff0c\u6765\u770b\u770b\u600e\u4e48\u62ff\u751f\u6210\u51fd\u6570\u76f4\u89c2\u8bc1\u660e\uff01\n\n\u9996\u5148\u8003\u8651\u5982\u4f55\u8868\u793a\u4e00\u4e2a\u96c6\u5408 $S$ \u91cc\u9762\u6240\u6709\u6570\u7684 $0\\sim k$ \u6b21\u65b9\u548c\u3002\n\n\u8003\u8651 $F_S(x)=\\sum\\limits_{u\\in S}\\mathrm{e}^{ux}$\uff0c\u6211\u4eec\u53d1\u73b0 $k![x^k]F_S(x)$ \u5373\u4e3a $k$ \u6b21\u65b9\u548c\u3002\n\n\u539f\u56e0\u5c31\u662f $k![x^k]F_S(x)=k![x^k]\\sum\\limits_{n\\geq 0}\\sum\\limits_{u\\in S}\\frac{(ux)^n}{n!}=\\sum\\limits_{u\\in S} u^k$\n\n\uff08\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u662f EGF \u800c\u4e0d\u662f OGF\uff0c\u4f60\u4f1a\u53d1\u73b0\u5199\u6210 OGF \u7684\u8bdd\uff0c\u4e0b\u9762\u7684\u8f6c\u79fb\u65e0\u6cd5\u8868\u793a\uff09\n\n\u8003\u8651\u4ee4 $P_n(x)$ \u4ee3\u8868\u957f\u5ea6\u4e3a $2^n$ \u7684\u4e32\u4e2d a \u6784\u6210\u7684\u96c6\u5408\u7684 $F_S(x)$\uff0c$Q_n(x)$ \u4e3a\u957f\u5ea6\u4e3a $n$ \u7684\u4e32\u4e2d b \u6784\u6210\u7684\u96c6\u5408\u7684 $F_S(x)$\n\n\u8bd5\u56fe\u627e\u5230 $P_n(x),Q_n(x)$ \u5230 $P_{n+1}(x),Q_{n+1}(x)$ \u7684\u9012\u63a8\u65b9\u5f0f\u3002\u8003\u8651\u679a\u4e3e\u957f\u5ea6 $2^{n+1}$ \u7684\u4e32\u7684\u6bcf\u4e2a\u5143\u7d20\u7684\u6700\u4f4e\u4f4d\uff1a\n\n\u7531\u4e8e\u4e8c\u8fdb\u5236\u4e2d\u6709\u5076\u6570\u4e2a 1 \u7684\u662f a\uff0c\u5947\u6570\u4e2a 1 \u7684\u662fb\uff0c\u6240\u4ee5\uff1a\n\n- \u82e5\u7b2c $i$ \u4e2a\u6570\u662f\u5076\u6570\uff0c\u800c $i/2$ \u662f a\uff0c\u90a3\u4e48 $i$ \u662f a\uff0c\u5426\u5219 $i$ \u662f b\u3002  \n- \u82e5\u7b2c $i$ \u4e2a\u6570\u662f\u5947\u6570\uff0c\u800c $(i-1)/2$ \u662f a\uff0c\u90a3\u4e48 $i$ \u662f b\uff0c\u5426\u5219 $i$ \u662f a\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5904\u7406\u4e00\u4e2a\u96c6\u5408\u540c\u65f6 $\\times 2$ \u548c $+c$ \u4e4b\u540e $F_S(x)$ \u7684\u53d8\u5316\uff0c\u6613\u5f97\n\n$$F_{2S}(x)=\\sum\\limits_{u\\in S}\\mathrm{e}^{2ux}=F_S(2x)$$\n$$F_{S+c}(x)=\\sum\\limits_{u\\in S}\\mathrm{e}^{(u+c)x}=F_S(x)\\mathrm{e}^{cx}$$\n\n\u6240\u4ee5\u9012\u63a8\u65b9\u7a0b\u53ef\u4ee5\u5199\u6210\uff1a\n\n$$P_{n+1}(x)=P_n(2x)+Q_n(2x)\\mathrm{e}^x$$\n$$Q_{n+1}(x)=Q_n(2x)+P_n(2x)\\mathrm{e}^x$$\n\n\u6211\u4eec\u53d1\u73b0 $P_n(x)+Q_n(x)$ \u662f\u597d\u6c42\u7684\uff0c\u5c31\u662f\u81ea\u7136\u6570\u5e42\u548c\u7684\u751f\u6210\u51fd\u6570\u3002\u90a3\u4e48\u6211\u4eec\u8bd5\u56fe\u6c42 $P_n(x)-Q_n(x)$\u3002\n\n\u5c06\u9012\u63a8\u5f0f\u76f8\u51cf\uff0c\u5f97\n\n$$P_{n+1}(x)-Q_{n+1}(x)=(P_n(2x)-Q_n(2x))(1-\\mathrm{e}^x)$$\n\n\u53d1\u73b0\u6211\u4eec\u53ea\u5173\u5fc3 $P,Q$ \u7684\u524d $k$ \u9879\uff0c$x\\mid (1-\\mathrm{e}^x)$\uff0c\u800c\u751f\u6210\u51fd\u6570\u88ab $2x$ \u590d\u5408\u5e76\u4e0d\u6539\u53d8\u5176\u4e2d $x^i$ \u56e0\u5b50\uff0c\u6240\u4ee5\u6bcf\u6b21\u5c31\u4f1a\u591a\u51fa\u4e00\u4e2a $x$ \u56e0\u5b50\uff0c\u6240\u4ee5\u6211\u4eec\u77e5\u9053 $P_{k+1}(x)-Q_{k+1}(x)\\equiv 0 \\pmod{x^{k+1}}$\n\n\u8fd9\u8bf4\u660e\uff08$\\bmod\\ x^{k+1}$ \u610f\u4e49\u4e0b\uff0c\u4e0b\u540c\uff09\uff0c\u5bf9\u4e8e $n>k,P_{n}(x)=Q_{n}(x)$\uff0c\u6240\u4ee5\u6211\u4eec\u5176\u5b9e\u53ea\u9700\u8981\u6c42\u524d $k$ \u4e2a $P,Q$ \u5c31\u591f\u4e86\u3002\n\n\u800c\u82e5\u6c42\u957f\u5ea6\u4e0d\u662f $2^n$ \u7684\u7b54\u6848\uff0c\u8003\u8651\u5f62\u5982\u6570\u4f4d dp \u7684\u4e1c\u897f\u3002\u6bcf\u6b21\u786e\u5b9a\u4e86\u9ad8\u4f4d\uff0c\u6c42\u4f4e $w$ \u4f4d\u4efb\u610f\u53d6\u7684\u548c\u3002\u4e0d\u59a8\u8bbe\u9ad8\u4f4d\u91cc\u6709\u5076\u6570\u4e2a1\uff0c\u90a3\u4e48\u6574\u4e2a\u6570\u7684\u5947\u5076\u6027\u548c\u53bb\u6389\u9ad8\u4f4d\u7684\u6570\u7684\u5947\u5076\u6027\u76f8\u540c\uff0c\u6240\u4ee5\u8bbe\u786e\u5b9a\u7684\u9ad8\u4f4d\u90e8\u5206\u662f $c$\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u662f $Q_{w}(x)\\mathrm{e}^{cx}$\uff0c\u6211\u4eec\u603b\u7684\u7b54\u6848\u5c31\u662f\u6240\u6709\u533a\u95f4\u7684 $Q_{w}(x)\\mathrm{e}^{cx}$ \u4e4b\u548c\u3002\n\n\n\u90a3\u4e48\u5bf9\u4e8e\u8ba1\u7b97\u8fc7\u7a0b\uff0c\u5bf9\u4e8e $w\\leq k$\uff0c\u4f7f\u7528\u66b4\u529b\u8ba1\u7b97\u5f97\u7684 $P,Q$ \u66b4\u529b\u5377\u79ef\uff0c\u590d\u6742\u5ea6 $O(k^3)$ \uff0c\u5982\u679c\u4f7f\u7528 \u4efb\u610f\u6a21\u6570ntt \u53ef\u4ee5\u505a\u5230 $O(k^2\\log k)$\u3002\n\n\u56de\u987e\u81ea\u7136\u6570\u5e42\u548c\u751f\u6210\u51fd\u6570\uff0c\n$$P_n(x)+Q_n(x)=\\sum_{i=0}^{2^n-1}\\sum_{j\\geq 0}\\frac{(xi)^j}{j!}=\\sum_{i=0}^{2^n-1}\\mathrm{e}^{xi}=\\frac{\\mathrm{e}^{2^nx}-1}{\\mathrm{e}^{x}-1}$$\n\n\u5bf9\u4e8e $w>k$\uff0c $P_w(x)=Q_w(x)=\\frac{\\mathrm{e}^{2^nx}-1}{2(\\mathrm{e}^{x}-1)}$\uff0c\u90a3\u4e48\u8003\u8651\u5176\u4e0e $\\mathrm{e}^{cx}$ \u5377\u79ef\u540e\uff0c\u5c55\u5f00\u5f97\n\n$$\\frac12\\sum_{i=c}^{2^w+c-1}\\mathrm{e}^{ix}$$\n\n\u6240\u6709 $w>k$ \u8003\u8651\u5230\u7684\u533a\u95f4\u5176\u5b9e\u662f\u4e00\u4e2a\u524d\u7f00\uff0c\u90a3\u4e48\u5b83\u4eec\u7b54\u6848\u7684\u603b\u548c\u5c31\u662f\n\n\n$$\\frac12\\sum_{i=0}^{R-1}\\mathrm{e}^{ix}=\\frac{\\mathrm{e}^{Rx}-1}{2(\\mathrm{e}^{x}-1)}$$\n\n\u5176\u4e2d $R$ \u4e3a\u6700\u53f3\u8fb9\u7684\u4e00\u4e2a $w>k$ \u7684\u9879\u7684\u53f3\u7aef\u70b9\u3002\n\n\u53ef\u4ee5\u4f7f\u7528 $O(k^2)$ \u7684\u591a\u9879\u5f0f\u6c42\u9006\u4e00\u53d1\u5f97\u5230\u3002\n\n\u6240\u4ee5\u603b\u590d\u6742\u5ea6 $O(\\log n+k^3)$ \uff08\u6216 $O(\\log n+k^2\\log k)$ \uff09\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n//dengyaotriangle!\n\nconst int maxn=500005;\nconst int maxk=505;\nconst int mdn=1000000007;\nconst int inv2=(mdn+1)/2;\n\ninline int qpw(int bse,int ex){int ans=1;while(ex){if(ex&1)ans=ans*(long long)bse%mdn;ex>>=1;bse=bse*(long long)bse%mdn;}return ans;}\n\nchar s[maxn];\nint a[maxk];\nint n;\nint p[maxk][2][maxk];\nint ifac[maxk],fac[maxk];\nint pw2[maxk];\nint cp[maxk];\nint i0[maxk],iv[maxk];\nint main(){\n    fac[0]=1;for(int i=1;i<maxk;i++)fac[i]=fac[i-1]*(long long)i%mdn;\n    ifac[maxk-1]=qpw(fac[maxk-1],mdn-2);\n    for(int i=maxk-1;i>0;i--)ifac[i-1]=ifac[i]*(long long)i%mdn;\n    pw2[0]=1;for(int i=1;i<maxk;i++)pw2[i]=pw2[i-1]*2%mdn;\n    cin>>s>>n;\n    for(int i=0;i<=n;i++)cin>>a[i];\n    p[0][0][0]=1;\n    for(int i=1;i<=n;i++){\n        for(int t=0;t<2;t++){\n            for(int j=0;j<=n;j++){\n                p[i][t][j]=p[i-1][t][j]*(long long)pw2[j]%mdn;\n                for(int k=0;k<=j;k++){\n                    p[i][t][j]=(p[i][t][j]+p[i-1][!t][k]*(long long)pw2[k]%mdn*ifac[j-k])%mdn;\n                }\n            }\n        }\n    }\n    int sz=strlen(s);\n    int r=0,cur=0;bool ct=1;\n    int ans=0;\n    for(int i=0;i<sz;i++){\n        cur=cur*2%mdn;\n        r=r*2%mdn;\n        if(s[i]=='1'){\n            int rc=(cur+1)%mdn;\n            int w=sz-i-1;\n            if(w<=n){\n                int l=cur*(long long)pw2[w]%mdn;\n                cp[0]=1;for(int i=1;i<=n;i++)cp[i]=cp[i-1]*(long long)l%mdn;\n                for(int j=0;j<=n;j++){\n                    int cur=0;\n                    for(int k=0;k<=j;k++){\n                        cur=(cur+p[w][ct][k]*(long long)ifac[j-k]%mdn*cp[j-k])%mdn;\n                    }\n                    ans=(ans+a[j]*(long long)fac[j]%mdn*cur)%mdn;\n                }\n            }else{\n                r=rc;\n            }\n            cur=rc;\n            ct^=1;\n        }\n    }\n    for(int i=0;i<=n;i++)i0[i]=ifac[i+1];\n    iv[0]=i0[0];\n    for(int i=1;i<=n;i++){\n        for(int j=0;j<i;j++)iv[i]=(iv[i]+iv[j]*(long long)i0[i-j])%mdn;\n        iv[i]=(mdn-iv[i])%mdn;\n    }\n    cp[0]=1;for(int i=1;i<=n;i++)cp[i]=cp[i-1]*(long long)r%mdn;\n    for(int i=0;i<=n;i++){\n        int cur=0;\n        for(int j=0;j<=i;j++){\n            cur=(cur+iv[j]*(long long)ifac[i-j+1]%mdn*cp[i-j+1])%mdn;\n        }\n        ans=(ans+a[i]*(long long)fac[i]%mdn*cur%mdn*inv2)%mdn;\n    }\n    cout<<ans;\n    return 0;\n}\n```",
        "postTime": 1617169902,
        "uid": 62598,
        "name": "dengyaotriangle",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P7468 \u3010[NOI Online 2021 \u63d0\u9ad8\u7ec4] \u6124\u6012\u7684\u5c0fN\u3011"
    },
    {
        "content": "~~\u8003\u573a\u88ab\u81ea\u5df1\u6f14\u4e86\u3002~~\n\n\u63d0\u4f9b\u4e00\u4e2a\u504f\u591a\u9879\u5f0f\u4e00\u70b9\u7684\u505a\u6cd5\u3002\n\n# \u9996\u5148\u8003\u8651\u4e00\u4e2a\u66b4\u529b\n\n\u5bf9\u4e8e\u4e00\u4e2a\u957f\u5ea6\u4e3a $2^i$ \u7684\u4e32\uff0c\u6211\u4eec\u8bb0 $A_i(x),B_i(x)$ \u5206\u522b\u8868\u793a\u8fd9\u4e2a\u4e32\u4e0b\u6807\u4ece $x$ \u5f00\u59cb\uff08\u6574\u4e2a\u4e32\u5de6\u8fb9\u5df2\u7ecf\u6709 $x$ \u4e2a\u5b57\u7b26\uff09\uff0c\u8fd9\u4e2a\u4e32\u4e2d $a$ \u548c $b$ \u7684\u4f4d\u7f6e\u7684 $f(i)$ \u4e4b\u548c\u3002\u663e\u7136\u6709 $A_0(x)=f(x),B_0(x)=0$ \u3002\n\n\u90a3\u4e48\u6709\u8f6c\u79fb\uff1a\n$$\n\\begin{aligned}\nA_i(x)&=A_{i-1}(x)+B_{i-1}(x+2^{i-1})\\\\\nB_i(x)&=B_{i-1}(x)+A_{i-1}(x+2^{i-1})\n\\end{aligned}\n$$\n\u66b4\u529b\u8ba1\u7b97\u51fa\u6240\u6709 $A,B$ \u7684\u590d\u6742\u5ea6\u4e3a\uff1a$O(nk^2)$ \u3002\n\n\u4ece\u9ad8\u4f4d\u5230\u4f4e\u4f4d\u6a21\u62df\u201c\u586b\u5199\u201d\u51fa\u539f\u4e32\u6765\u8ba1\u7b97\u7b54\u6848\u7684\u590d\u6742\u5ea6\u4e3a\uff1a $O(nk)$ \u3002\n\n# \u4f18\u5316\n\n\u89c2\u5bdf\u5230\u8f6c\u79fb\u5f0f\u7684\u5f62\u5f0f\u5f88\u50cf\uff0c\u8003\u8651\u4e0a\u4e0b\u76f8\u51cf\uff1a\n$$\n\\begin{aligned}\nD_i(x)&=A_i(x)-B_i(x)\\\\\n&=\\left(A_{i-1}(x)+B_{i-1}(x+2^{i-1})\\right)-\\left(B_{i-1}(x)+A_{i-1}(x+2^{i-1})\\right)\\\\\n&=(A_{i-1}-B_{i-1})(x)-(A_{i-1}-B_{i-1})(x+2^{i-1})\\\\\n&=D_{i-1}(x)-D_{i-1}(x+2^{i-1})\n\\end{aligned}\n$$\n\u6ce8\u610f\u5230\u8fd9\u6837\u6bcf\u6b21\u6700\u9ad8\u6b21\u9879\u90fd\u4f1a\u88ab\u6d88\u6210 $0$ \uff0c\u6240\u4ee5\u5f53 $i$ \u5145\u5206\u5927\u7684\u65f6\u5019 $D_i(x)$ \u5c31\u4f1a\u88ab\u6d88\u6210 $0$ \u3002\n\n\u90a3\u4e48\u66b4\u529b\u8ba1\u7b97\u51fa\u6240\u6709\u975e $0$ \u7684 $D_i(x)$ \u7684\u590d\u6742\u5ea6\u4e3a $O(k^3)$ \u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u66b4\u529b\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u662f\u8981\u5bf9\u6240\u6709\u7684`1`\u4f4d $j$ \u6c42 $A_i(j)$ \u6216\u8005 $B_i(j)$ \u5e76\u6c42\u548c\u3002\n\n\u53c8\u6709\uff1a\n$$\n\\begin{aligned}\nA_i(x)+B_i(x)&=\\sum_{j=0}^{2^i-1}f(x+j)\\\\\nA_i(x)&=\\frac{A_i(x)+B_i(x)+D_i(x)}2\\\\\nB_i(x)&=\\frac{A_i(x)+B_i(x)-D_i(x)}2\n\\end{aligned}\n$$\n$D_i(j)$ \u7684\u90e8\u5206\u53ef\u4ee5\u66b4\u529b\u8ba1\u7b97\uff0c\u6240\u4ee5\u5176\u5b9e\u662f\u8981\u7b97 $f(x)$ \u7684\u82e5\u5e72\u6bb5\u8fde\u7eed\u7684\u70b9\u503c\u3002\n\n\u800c\u8fd9\u82e5\u5e72\u6bb5\u8fde\u7eed\u7684\u70b9\u503c\u672c\u8eab\u4e5f\u662f\u8fde\u7eed\u7684\u3002\u6240\u4ee5\u6700\u540e\u8981\u7b97\u5c31\u662f $\\sum_{i=0}^{N-1}f(x+i)$ \u3002\n\n\u628a $\\sum_i f(x+i)$ \u5c55\u5f00\uff0c\u4f1a\u53d8\u6210\u4e00\u4e2a\u81ea\u7136\u6570\u5e42\u548c\u7684\u5f62\u5f0f\uff0c\u62c9\u683c\u6717\u65e5\u63d2\u503c\u5373\u53ef\u3002\n\n\u603b\u590d\u6742\u5ea6\u4e3a $O(k^3+n)$ \u3002\n\n\u987a\u4fbf\u653e\u4e0a\uff08\u4fee\u6539\u540e\u7684\uff09\u8003\u573a\u4ee3\u7801\uff1a\n\n```cpp\n#define REP(i, s, e) for (register int i(s), end_##i(e); i <= end_##i; i++)\n#define DEP(i, s, e) for (register int i(s), end_##i(e); i >= end_##i; i--)\n\n#include <cassert>\n#include <algorithm>\n#include <cstring>\n#include <vector>\n#include <iostream>\n#include <cstdio>\n#define DEBUG fprintf(stderr, \"Passing [%s] in Line %d\\n\", __FUNCTION__, __LINE__)\n#define i64 long long\n\nusing namespace std;\nconst int maxn = 5e5 + 10, maxk = 500 + 15, MOD = 1e9 + 7, inv2 = MOD + 1 >> 1;\n\ni64 power_pow(i64 base, i64 b)\n{\n\ti64 ans = 1;\n\twhile (b)\n\t{\n\t\tif (b & 1) (ans *= base) %= MOD;\n\t\t(base *= base) %= MOD;\n\t\tb >>= 1;\n\t}\n\treturn ans;\n}\n#define inv(x) power_pow(x, MOD - 2)\n\nint n;\nchar N[maxn];\nint k;\n\n#define poly vector <int>\ninline int deg(const poly &f) {return (int)f.size() - 1;}\npoly operator + (poly f, poly g)\n{\n\tif (f.size() < g.size()) f.resize(g.size());\n\tREP(i, 0, deg(g)) f[i] = (f[i] + g[i]) % MOD;\n\treturn f;\n}\ninline void output(const poly &f)\n{\n\tREP(i, 0, deg(f)) printf(\"%d%c\", f[i], i == end_i ? '\\n' : ' ' );\n}\nint fac[maxk], invs[maxk], Invs[maxk];\nvoid init(int n)\n{\n\tfac[0] = invs[0] = Invs[0] = 1;\n\tfac[1] = invs[1] = Invs[1] = 1;\n\tREP(i, 2, n)\n\t{\n\t\tfac[i] = 1ll * i * fac[i - 1] % MOD;\n\t\tinvs[i] = 1ll * (MOD - MOD / i) * invs[MOD % i] % MOD;\n\t\tInvs[i] = 1ll * invs[i] * Invs[i - 1] % MOD;\n\t}\n}\ninline i64 C(int n, int m) {return n < m || m < 0 ? 0 : 1ll * fac[n] * Invs[m] % MOD * Invs[n - m] % MOD;}\npoly shift(poly f, int a) // return f(x + a)\n{\n\tint n = deg(f);\n\tstatic int bin[maxk];\n\tbin[0] = 1;REP(i, 1, n) bin[i] = 1ll * bin[i - 1] * a % MOD * invs[i] % MOD;\n\n\tREP(i, 0, n) f[i] = 1ll * f[i] * fac[i] % MOD;\n\tpoly g(n + 1, 0);\n\tREP(j, 0, n)\n\t{\n\t\ti64 res = 0;\n\t\tREP(i, j, n)\n\t\t\t(res += 1ll * f[i] * bin[i - j]) %= MOD;\n\t\tg[j] = res * Invs[j] % MOD;\n\t}\n\treturn g;\n}\npoly operator - (poly f, poly g)\n{\n\tif (f.size() < g.size()) f.resize(g.size());\n\tREP(i, 0, deg(g)) f[i] = (f[i] + MOD - g[i]) % MOD;\n\twhile (f.size() && !f.back()) f.pop_back();\n\treturn f;\n}\n\ninline i64 calc(poly f, i64 x) // return f(x)\n{\n\ti64 res = 0;\n\tDEP(i, deg(f), 0) res = (res * x + f[i]) % MOD;\n\treturn res;\n}\n\npoly fk;\npoly d[maxn];\nint bin2[maxn];\n\nnamespace ziranshumi\n{\n\tint k;\n\tint y0[maxk], st[maxk];\n\tvoid init(int K)\n\t{\n\t\tk = K;\n\t\tREP(i, 0, k + 1)\n\t\t{\n\t\t\ti64 res = 0, ij = 1;\n\t\t\tREP(j, 0, k)\n\t\t\t{\n\t\t\t\t(res += ij * fk[j]) %= MOD;\n\t\t\t\t(ij *= i) %= MOD;\n\t\t\t}\n\t\t\ty0[i] = (res + (i ? y0[i - 1] : 0)) % MOD;\n\t\t}\n\t\tREP(i, 0, k + 1) st[i] = 1ll * Invs[i] * Invs[k + 1 - i] % MOD * y0[i] % MOD;\n\t}\n\tint bs[maxk], iv[maxk];\n\tinline i64 query(i64 n)\n\t{\n\t\tif (n <= k + 1) return y0[n];\n\t\t//return Sum[ i ^ k , {i, 0, n} ]\n\t\t//0 ^ 0 = 1\n\t\ti64 ans = 0;\n\n\t\tbs[0] = n;REP(i, 1, k + 1) bs[i] = bs[i - 1] * (n - i) % MOD;\n\t\ti64 W = bs[k + 1];\n\t\tiv[k + 1] = inv(bs[k + 1]);\n\t\tDEP(i, k, 0) iv[i] = (n - (i + 1)) * iv[i + 1] % MOD;\n\n\t\tDEP(i, k + 1, 0) iv[i] = 1ll * iv[i] * (i ? bs[i - 1] : 1ll) % MOD;\n\n\t\tREP(i, 0, k + 1)\n\t\t{\n\t\t\ti64 res = 1ll * iv[i] * st[i];\n\t\t\t//\tREP(j, 1, i) res = res * invs[j] % MOD;\n\t\t\t//\tREP(j, 1, k + 1 - i) res = res * invs[j] % MOD;\n\n\t\t\tif ((k - i + 1) & 1) res = -res;\n\t\t\tans += res;ans %= MOD;\n\t\t}\n\n\t\t//\t\tans = 0;\n\t\t//\t\tREP(i, 0, n) ans += power_pow(i, k);\n\t\treturn ans % MOD * W % MOD;\n\t}\n}\n\nint main()\n{\n#ifdef CraZYali\n\tfreopen(\"angry.in\", \"r\", stdin);\n\tfreopen(\"angry.out\", \"w\", stdout);\n#endif\n\tscanf(\"%s\\n\", N); n = strlen(N);\n\tscanf(\"%d\", &k);init(k + 5);k--;\n\tfk.resize(k + 1);\n\tREP(i, 0, k) scanf(\"%d\", &fk[i]);\n\n\tbin2[0] = 1;REP(i, 1, n) bin2[i] = bin2[i - 1] * 2 % MOD;\n\treverse(N, N + n);\n\n\td[0] = fk;\n\tREP(i, 1, n - 1)\n\t\td[i] = d[i - 1] - shift(d[i - 1], bin2[i - 1]);\n\t//d[i] = fa[i] - fb[i]\n\n\tint flg = 0, ard = 0;i64 ans = 0;\n\tard = 0;int lstr = -1;\n\tDEP(i, n - 1, 0) if (N[i] == '1')\n\t{\n\t\tlstr = ard + bin2[i] - 1;\n\n\t\t//\t\tREP(j, 0, (1 << i) - 1) tot += calc(fk, j + ard);\n\t\t//\t\ttot %= MOD;\n\t\tans += ((flg & 1) ? 1 : -1) * calc(d[i], ard) ;\n\n\t\t(ard += bin2[i]) %= MOD;\n\t\tflg ^= 1;\n\t}\n\n\tif (lstr != -1)\n\t{\n\t\tziranshumi :: init(k);\n\t\tans += ziranshumi :: query(lstr);\n\t}\n\n\tcout << (ans % MOD + MOD) % MOD * inv2 % MOD << endl;\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1616834191,
        "uid": 18215,
        "name": "CraZYali",
        "ccfLevel": 9,
        "title": "233"
    },
    {
        "content": "orz\n\n\u573a\u4e0a\u63a8\u4e86\u4e00\u534a\u4e0d\u4f1a\u4e86qwq\uff0c\u8fd8\u662f\u592a\u83dc\u5566/dk\n\n\u7531\u4e8e\u4e91\u6d45\u592a\u83dc\u4e86\uff0c\u6240\u4ee5\u5199\u7684\u53ef\u80fd\u4f1a\u901a\u4fd7\u4e00\u70b9qwq\uff08\n\n------------\n\n### Description\n\n\u6709\u4e00\u4e2a\u53ef\u7231\u7684\u6570\u5217 $\\{A_n\\}$\uff0c\u6ee1\u8db3\uff1a   \n\n> $A_0=0$               \n> $A_{n}=1-A_{n-2^{m}}$\uff0c\u5176\u4e2d $m$ \u662f\u4f7f\u5f97 $2^{m}\\le n$ \u7684\u6700\u5927\u7684\u6b63\u6574\u6570\u3002\n\n\u518d\u7ed9\u4f60\u4e00\u4e2a\u53ef\u7231\u7684 $k-1$ \u6b21\u591a\u9879\u5f0f $f(x)=\\sum_{i=0}^{k-1}a_ix^{i}$\u3002\n\n\u7ed9\u5b9a $n$\uff0c\u6c42 $\\sum_{i=0}^{n-1}A_i\\cdot f(i)$\u3002\n\n------------\n\n### Solution\n\n\u7b2c\u4e00\u6b65\u80af\u5b9a\u8981\u5904\u7406 $\\{A_n\\}$ \uff0c\u6bd5\u7adf\u8fd9\u4e2a\u6570\u5217\u592a\u795e\u5947\u4e86\uff0c\u4e0d\u641e\u4e00\u4e0b\u90fd\u6ca1\u6cd5\u505a>\\_<\n\n\u9996\u5148\u770b\u4e00\u4e0b\u6570\u5217 $\\{A_n\\}$ \u5230\u5e95\u662f\u4ec0\u4e48\u4e1c\u897f\u3002\n\n\u4ed4\u7ec6\u89c2\u5bdf\u8fd9\u4e2a\u9012\u63a8\u5f0f\uff1a$A_{n}=1-A_{n-2^{m}}$\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c\u628a $n$ \u7684\u4e8c\u8fdb\u5236\u8868\u8fbe\u5199\u51fa\u6765\uff0c\u90a3\u4e48\u51cf\u53bb\u8fd9\u4e2a $2^m$ \uff0c\u5c31\u76f8\u5f53\u4e8e**\u628a $n$ \u6700\u9ad8\u4f4d\u4e0a\u7684\u90a3\u4e2a $1$ \u53bb\u6389\uff01**\n\n\u6bd5\u7adf\uff0c$2^{m}$ \u5728\u4e8c\u8fdb\u5236\u4e0b\u603b\u662f\u4e00\u4e2a $1$ \u540e\u9762\u8ddf\u4e00\u957f\u4e32 $0$\uff0c\u800c\u4e14\u8fd9\u8fd8\u662f\u4f7f\u5f97 $2^{m}\\le n$ \u7684\u6700\u5927\u7684\u6b63\u6574\u6570\u561b\uff0c\u90a3\u5c31\u53ea\u80fd\u662f\u6700\u9ad8\u4f4d\u548c $n$ \u4e00\u6837\u90fd\u662f $1$\uff0c\u7136\u540e\u540e\u9762\u5168\u662f $0$ qwq\u3002\n\n\u4e8e\u662f $A_{n-2^{m}}$ \u5230 $A_n$ \u5c31\u76f8\u5f53\u4e8e\u5728\u524d\u5934\u52a0\u4e86\u4e2a $1$\uff0c\u90a3\u5c31\u76f8\u5f53\u4e8e\u628a $A_n$ \u7684\u4e8c\u8fdb\u5236\u8868\u8fbe\u4e2d\u5947\u5076\u6027\u7ffb\u8f6c\u3002\n\n\u518d\u7ed3\u5408 $A_0=0$\uff0c\u5c31\u6709\uff1a\n\n$$\nA_n=\\text{Popcount}(n)\\bmod2\n$$\n\n\u5176\u4e2d $\\text{Popcount}(n)$ \u8868\u793a $n$ \u7684\u4e8c\u8fdb\u5236\u8868\u8fbe\u4e2d\u7684 $1$ \u4e2a\u6570\u3002\u65b9\u4fbf\u8d77\u89c1\uff0c\u4e0b\u9762\u7edf\u4e00\u7b80\u8bb0\u4e3a $\\text{P}(n)$\u3002\n\n\u4f46\u662f\u8fd9\u4e2a $\\bmod 2$ \u8ba9\u6211\u4eec\u5f88\u96be\u53d7\u554a>\\_<\n\n\u7528\u4e00\u4e2a\u5e38\u89c1\u7684\u6280\u5de7\uff0c\u628a $\\bmod 2$ \u641e\u6389\uff1a\n\n$$\n\nA_n=\\text{P}(n)\\bmod2=\\dfrac{1-(-1)^{\\text{P}(n)}}{2}\n$$\n\n\u4e8e\u662f\u90a3\u6211\u4eec\u5c31\u6210\u529f\u641e\u6389\u4e86 $A_n$\uff0c\u628a\u5b83\u53d8\u5f97\u66f4\u53ef\u7231\u5566\uff08\u0e51 \\`\u25bd\u00b4\u0e51)\n\n------------\n\n\u56de\u5230\u8981\u6c42\u51fa\u6765\u7684\u8fd9\u4e2a\u5f0f\u5b50\u3002\n\n\u628a\u6211\u4eec\u4e4b\u524d\u63a8\u51fa\u6765\u7684 $A_n$ \u5e26\u8fdb\u53bb\u5316\u7b80\u4e00\u901a\uff1a\n\n$$\n\\begin{aligned}\n\\sum_{i=0}^{n-1}A_i\\cdot f(i)&=\\sum_{i=0}^{n-1}\\left(\\dfrac{1-(-1)^{\\text{P}(i)}}{2}\\cdot f(i)\\right)\\\\\n&=\\dfrac{1}{2}\\left(\\sum_{i=0}^{n-1}\\left(f(i)-(-1)^{\\text{P}(i)}\\cdot f(i)\\right)\\right)\\\\\n&=\\dfrac{1}{2}\\left(\\sum_{i=0}^{n-1}f(i)-\\sum_{i=0}^{n-1}(-1)^{\\text{P}(i)}\\cdot f(i)\\right)\n\\end{aligned}\n$$\n\n\u8bf6\uff0c\u524d\u9762\u5c31\u662f\u4e00\u4e2a $f(x)$ \u7684\u524d\u7f00\u548c\u561b\uff01\n\n\u90a3\u5c31\u53ef\u4ee5\u76f4\u63a5\u62c9\u683c\u6717\u65e5\u63d2\u503c\uff0c$O(k^2)$ \u6c42\u51fa\u524d\u7f00\u548c\u7684\u8868\u8fbe\u5f0f\uff0c\u7136\u540e\u5e26\u8fdb\u53bb\u7b97\u51fa\u8fd9\u90e8\u5206qwq\u3002\n\n\u73b0\u5728\u4e3b\u8981\u770b\u540e\u9762\u8fd9\u90e8\u5206\uff1a\n\n$$\n\\sum_{i=0}^{n-1}(-1)^{\\text{P}(i)}\\cdot f(i)\n$$\n\n\u8c8c\u4f3c\u8fd9\u79cd\u5f62\u5f0f\u6ca1\u6cd5\u7ee7\u7eed\u63a8\u3002\u628a $f(i)$ \u5c55\u5f00\u8bd5\u8bd5\uff1a\n\n$$\n\\sum_{i=0}^{n-1}(-1)^{\\text{P}(i)} \\sum_{r=0}^{k-1}a_{r}i^{r}\n$$\n\n\u4ea4\u6362\u4e00\u4e0b\u6c42\u548c\u987a\u5e8f\uff08\u5176\u5b9e\u5c31\u662f\u63d0\u53d6\u516c\u56e0\u5f0f\uff09\uff1a\n\n$$\n\\sum_{r=0}^{k-1}a_r\\sum_{i=0}^{n-1}(-1)^{\\text{P}(i)}i^{r}\n$$\n\n\u8bf6\uff0c\u524d\u9762\u7684\u8fd9\u4e2a\u7cfb\u6570 $a_r$ \u662f\u5f88\u597d\u7b97\u7684\u561bqwq\uff01\n\n\u90a3\u6211\u4eec\u73b0\u5728\u8981\u6c42\u7684\u5c31\u662f\uff1a\n\n$$\n\\sum_{i=0}^{n-1}(-1)^{\\text{P}(i)}i^{r}\n$$\n\n\u7136\u540e\uff0c\u6211\u5f53\u65f6\u5c31\u63a8\u5230\u8fd9\u91cc\uff0c\u63a8\u4e0d\u4e0b\u53bb\u5566>\\_<\n\n------------\n\n\u73b0\u5728\u6211\u4eec\u5199\u51fa $n$ \u7684\u4e8c\u8fdb\u5236\u8868\u793a\uff0c\u662f\u4e00\u957f\u4e32 $1$ \u548c $0$\u3002\n\n\u7136\u540e\u6211\u4eec\u4ece\u540e\u5f80\u524d\uff0c\u4e00\u4e2a\u4e00\u4e2a\u5730\u628a $n$ \u4e8c\u8fdb\u5236\u8868\u793a\u4e2d\u7684 $1$ \u53bb\u6389\uff0c\u53bb\u6389\u4e4b\u540e\u7684\u6570\u548c\u53bb\u6389\u4e4b\u524d\u7684\u6570\u6784\u6210\u4e86\u4e00\u4e2a\u533a\u95f4\u3002\n\n\u8fd9\u6837\u5c31\u628a $[0,n)$ \u5212\u5206\u6210\u4e86\u5f88\u591a\u4e2a\u533a\u95f4\uff0c\u5e76\u4e14\u6bcf\u4e2a\u533a\u95f4\u7684\u957f\u5ea6\u90fd\u662f $2$ \u7684\u6b63\u6574\u6570\u6b21\u5e42\u3002\n\n\u6bd4\u5982\u968f\u4fbf\u5199\u4e00\u4e2a $n=114=(1110010)_2$\uff0c\u90a3\u4e48\u5c31\u628a $[0,n)$ \u5212\u5206\u6210\u4e86\uff1a\n\n- $[(1110000)_2,(1110010)_2)$\uff0c\u5373 $[112,114)$\n- $[(1100000)_2,(1110000)_2)$\uff0c\u5373 $[96,112)$\n- $[(1000000)_2,(1100000)_2)$\uff0c\u5373 $[64,96)$\n- $[0,(1000000)_2)$\uff0c\u5373 $[0,64)$\n\n\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u62ff $514=(1000000010)_2$ \u9a8c\u8bc1\u4e00\u4e0bqwq\u3002\n\n\uff08\u5176\u5b9e\u5c31\u662f $114=2^6+2^5+2^4+2$\uff0c$514=2^9+2$ \u561bqwq\uff09\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u4e00\u6bb5\u957f\u5ea6\u4e3a $2^t$ \u7684\u533a\u95f4 $[u,u+2^t)$ \u4e2d\u7684\u548c\uff1a\n\n$$\n\\sum_{i=u}^{u+2^t-1}(-1)^{\\text{P}(i)}i^{r}\n$$\n\n\u628a\u6c42\u548c\u6362\u6210\u4ece $0$ \u5f00\u59cb\uff1a\n\n$$\n\\sum_{i=0}^{2^t-1}(-1)^{\\text{P}(i+u)}(i+u)^{r}\n$$\n\n\u663e\u800c\u6613\u89c1\u7684\u4e00\u70b9\u662f\uff0c\u8981\u4e48 $u=0$\uff0c\u8981\u4e48 $u$ \u7684\u6700\u4f4e\u4f4d\u4e0a\u7684 $1$ \u8981\u6bd4 $2^t$ \u7684\u6700\u9ad8\u4f4d\u4e0a\u7684 $1$ \u9760\u524d\uff0c\u5373 $\\text{lowbit}(u)>\\text{highbit}(2^t)$\u3002\n\n\u6bd5\u7adf\uff0c\u6211\u4eec\u6bcf\u4e00\u6b21\u533a\u95f4\u7684\u8f6c\u6362\u5176\u5b9e\u5c31\u76f8\u5f53\u4e8e\u5728 $u$ \u7684\u540e\u9762\u7684\u4e00\u5806 $0$ \u4e0a\u9009\u4e00\u4f4d\u53d8\u6210 $1$ \u561bqwq\u3002\n\n\u6bd4\u5982\u524d\u9762\u7684\u4f8b\u5b50 $n=114=(1110010)_2$\uff0c\u8fd9\u91cc\u7684 $u$ \u548c $t$ \u5c31\u4f9d\u6b21\u662f\uff1a\n\n$$\\begin{aligned}u&&0000000 &&1000000&&1100000&&1110000&&1110010\\\\2^t&&1000000&&100000&&10000&&10&&/\\end{aligned}$$\n\n\u65e2\u7136 $u$ \u7684\u6700\u4f4e\u4f4d\u4e0a\u7684 $1$ \u90fd\u6bd4 $2^t$ \u7684\u6700\u9ad8\u4f4d\u4e0a\u7684 $1$ \u9760\u524d\uff0c\u90a3\u5b83\u80af\u5b9a\u6bd4 $i$ \u7684\u6700\u9ad8\u4f4d\u4e0a\u7684 $1$ \u9760\u524d\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c$u+i$ \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4e2d\uff0c*\u4e0d\u4f1a\u53d1\u751f\u8fdb\u4f4d\uff01*\n\n\u90a3\u4e48 $u+i$ \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4e2d\u7684 $1$ \u7684\u4e2a\u6570\u5c31\u662f $u$ \u548c $i$ \u5404\u81ea\u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4e2d $1$ \u7684\u4e2a\u6570\u4e4b\u548c\uff0c\u5373\uff1a$\\text{P}(u+i)=\\text{P}(u)+\\text{P}(i)$\u3002\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u63d0\u51fa\u6765\u4e00\u4e2a $(-1)^{\\text{P}(u)}$\uff0c\u628a\u5f0f\u5b50\u53d8\u6210\uff1a\n\n$$\n(-1)^{\\text{P}(u)}\\cdot\\sum_{i=0}^{2^t-1}(-1)^{\\text{P}(i)}(i+u)^{r}\n$$\n\n\u518d\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00 $(i+u)^r$\uff0c\u5f97\u5230\uff1a\n\n$$\n(-1)^{\\text{P}(u)}\\cdot\\sum_{i=0}^{2^t-1}(-1)^{\\text{P}(i)}\\sum_{j=0}^{r}C_{r}^ju^{r-j}i^{j}\n$$\n\n\u518d\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\uff1a\n\n$$\n(-1)^{\\text{P}(u)}\\cdot\\sum_{j=0}^{r}C_r^ju^{r-j}\\sum_{i=0}^{2^t-1}(-1)^{\\text{P}(i)}i^j\n$$\n\n\u4ed4\u7ec6\u89c2\u5bdf\u8fd9\u4e2a\u5f0f\u5b50\u7684\u540e\u534a\u90e8\u5206qwq\uff01\n\n$$\n\\sum_{i=0}^{2^t-1}(-1)^{\\text{P}(i)}i^j\n$$\n\n\u561b......\u8fd9\u4e2a\u4e1c\u897f\uff0c\u597d\u50cf\u5728\u524d\u9762\u89c1\u8fc7\uff1f\n\n------------\n\n\u5982\u679c\u6211\u4eec\u8bb0\n\n$$\n\\text{Sum}(u,t,r)=\\sum_{i=u}^{u+2^t-1}(-1)^{\\text{P}(i)}i^{r}=\\sum_{i=0}^{2^t-1}(-1)^{\\text{P}(i+u)}(i+u)^{r}\n$$\n\n\u8bf6\uff0c\u521a\u624d\u90a3\u4e2a\u5f0f\u5b50\u7684\u540e\u534a\u90e8\u5206\n\n$$\n\\sum_{i=0}^{2^t-1}(-1)^{\\text{P}(i)}i^j\n$$\n\n\u4e0d\u5c31\u662f $\\text{Sum}(0,t,j)$ \u561bqwq\uff01\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u77e5\u9053\u4e86\u5bf9\u4e8e\u6240\u6709 $0\\le j\\le r$ \u7684 $\\text{Sum}(0,t,j)$ \u7684\u503c\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5728 $O(r)$ \u7684\u65f6\u95f4\u5185\u7b97\u51fa $\\text{Sum}(u,t,r)$\u3002\n\n\u81f3\u4e8e $\\text{Sum}(0,t,j)$ \u7684\u503c\uff0c\u90a3\u76f4\u63a5\u53d8\u5f62\u4e00\u4e0b\uff1a\n\n$$\n\\begin{aligned}\n\\text{Sum}(0,t,j)&=\\sum_{i=0}^{2^t-1}(-1)^{\\text{P}(i)}i^j\\\\\n&=\\sum_{i=0}^{2^{t-1}-1}(-1)^{\\text{P}(i)}i^j+\\sum_{i=2^{t-1}}^{2^t-1}(-1)^{\\text{P}(i)}i^j\\\\\n&=\\sum_{i=0}^{2^{t-1}-1}(-1)^{\\text{P}(i)}i^j+\\sum_{i=0}^{2^{t-1}-1}(-1)^{\\text{P}(i+2^{t-1})}(i+2^{t-1})^j\\\\\n&=\\text{Sum}(0,t-1,j)+\\text{Sum}(2^{t-1},t-1,j)\\\\\n\\end{aligned}\n$$\n\n\u90a3\u4e48\u6211\u4eec\u53d1\u73b0\uff0c\u7c7b\u4f3c\u4e8e\u52a8\u6001\u89c4\u5212\uff0c\u53ef\u4ee5\u7528 $\\text{Sum}(0,t-1,j)$ \u548c $\\text{Sum}(2^{t-1},t-1,j)$ \u6765\u63a8\u51fa $\\text{Sum}(0,t,j)$\u3002\n\n\u76f4\u63a5\u786c\u7b97\u7684\u8bdd\uff0c\u7531\u4e8e\u603b\u5171\u6709 $O(k+\\log_2n)$ \u4e2a\u4e0d\u540c\u7684 $x$\uff0c\u800c\u4e24\u91cd\u7684\u9012\u63a8\u53c8\u662f $O(k^2)$ \u7684\uff0c\u6240\u4ee5\u603b\u590d\u6742\u5ea6\u4e3a $O(k^3+k^2\\log_2n)$\uff0c\u53ef\u4ee5\u83b7\u5f97 $60pts$\u3002\n\n------------\n\n\u56de\u5230\u521a\u624d\u7684\u90a3\u4e2a\u5f0f\u5b50\uff0c\u53e6\u4e00\u65b9\u9762\uff0c\u5b83\u4e5f\u53ef\u4ee5\u53d8\u6210\uff1a\n\n$$\n\\begin{aligned}\n&\\sum_{i=0}^{2^{t-1}-1}(-1)^{\\text{P}(i)}i^j+\\sum_{i=0}^{2^{t-1}-1}(-1)^{\\text{P}(i+2^{t-1})}(i+2^{t-1})^j\\\\\n=&\\text{Sum}(0,t-1,j)+(-1)^{\\text{P}(2^{t-1})}\\cdot \\sum_{i=0}^{2^{t-1}-1}(-1)^{\\text{P}(i)}(i+2^{t-1})^j\\\\\n=&\\text{Sum}(0,t-1,j)-\\sum_{i=0}^{2^{t-1}-1}(-1)^{\\text{P}(i)}(i+2^{t-1})^j\\\\\n\\end{aligned}\n$$\n\n\u63a8\u5230\u8fd9\u91cc\u4e4b\u540e\u53d1\u73b0\u6709\u4e00\u4e2a\u548c\u4e4b\u524d\u5f62\u5f0f\u51e0\u4e4e\u4e00\u6a21\u4e00\u6837\u7684\uff1a\n\n$$\n\\sum_{i=0}^{2^{t-1}-1}(-1)^{\\text{P}(i)}(i+2^{t-1})^j\n$$\n\n\u7c7b\u4f3c\u4e4b\u524d\u7684\u64cd\u4f5c\uff0c\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00\u5e76\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\uff0c\u5c31\u5f97\u5230\uff1a\n\n$$\n\\begin{aligned}\n\\sum_{i=0}^{2^{t-1}-1}(-1)^{\\text{P}(i)}(i+2^{t-1})^j&=\\sum_{i=0}^{2^{t-1}-1}(-1)^{\\text{P}(i)}\\sum_{s=0}^{j}C_{j}^s\\left(2^{t-1}\\right)^{j-s}i^{s}\\\\\n&=\\sum_{s=0}^{j}C_j^s\\left(2^{t-1}\\right)^{j-s}\\sum_{i=0}^{2^{t-1}-1}(-1)^{\\text{P}(i)}i^s\\\\\n&=\\sum_{s=0}^jC_j^s\\left(2^{t-1}\\right)^{j-s}\\text{Sum}(0,t-1,s)\n\\end{aligned}\n$$\n\n\u4e8e\u662f\u5c31\u5f97\u5230\u53e6\u4e00\u4e2a\u9012\u63a8\u5f0f\uff1a\n\n$$\n\\text{Sum}(0,t,j)=\\text{Sum}(0,t-1,j)-\\sum_{s=0}^jC_j^s\\left(2^{t-1}\\right)^{j-s}\\text{Sum}(0,t-1,s)\n$$\n\n\u5229\u7528\u8fd9\u4e2a\u9012\u63a8\u5f0f\uff0c\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u7ed3\u8bba\uff1a\u82e5 $2^{t}>2^j$ \u5373 $t>j$ \u65f6\uff0c\u603b\u6709\uff1a\n\n$$\n\\text{Sum}(0,t,j)=0\n$$\n\n$t=0$ \u65f6\u663e\u7136\u6210\u7acb\u3002\n\n\u82e5 $t=x$ \u65f6\uff0c\u5bf9\u4e8e $j<t$\uff0c\u5747\u6709 $\n\\text{Sum}(0,x,j)=0$\u3002\n\n\u5219\u5f53 $t=x+1$ \u65f6\uff0c\u5bf9\u4e8e\u4efb\u610f\u7684 $j<x+1$ \u5373 $j\\le x$\uff1a\n\n\u82e5 $j<x$\uff0c\u5219\u7531\u5f52\u7eb3\uff1a\n\n$$\n\\text{Sum}(0,x,j)=0\n$$\n$$\n\\sum_{s=0}^jC_j^s\\left(2^{x}\\right)^{j-s}\\text{Sum}(0,x,s)=0\n$$\n\n\u90a3\u4e48\n\n$$\n\\text{Sum}(0,x+1,j)=\\text{Sum}(0,x,j)-\\sum_{s=0}^jC_j^s\\left(2^{x}\\right)^{j-s}\\text{Sum}(0,x,s)=0\n$$\n\n\u82e5 $j=x$\uff0c\u5219\uff1a\n\n$$\n\\begin{aligned}\n\\text{Sum}(0,x+1,j)&=\\text{Sum}(0,x,j)-\\sum_{s=0}^jC_j^s\\left(2^{x}\\right)^{j-s}\\text{Sum}(0,x,s)\\\\\n&=\\text{Sum}(0,x,j)-\\text{Sum}(0,x,j)=0\n\\end{aligned}\n$$\n\n\u4e8e\u662f\u547d\u9898\u5bf9 $t=x+1$ \u4ecd\u7136\u6210\u7acb\u3002\n\n\u56e0\u6b64\uff0c\u82e5 $t>j$\uff0c\u5219 $\\text{Sum}(0,t,j)=0$\u3002\n\n\u7c7b\u4f3c\u5730\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u8bc1\u660e\uff1a\u5bf9\u4e8e $\\text{Sum}(x,t,j)$\uff0c\u82e5 $x>2^j$\uff0c\u5219\u540c\u6837\u4e5f\u6709 $\\text{Sum}(x,t,j)=0$\u3002\n\n------------\n\n\u7531\u4e0a\u9762\u4e24\u4e2a\u7ed3\u8bba\uff0c\u53ef\u4ee5\u53d1\u73b0\uff1a\u5b9e\u9645\u4e0a\u771f\u6b63\u300c\u6709\u7528\u300d\u7684 $x$ \u53ea\u6709 $O(k)$ \u4e2a\u3002\u6bd5\u7adf\uff0c\u5982\u679c $x$ \u592a\u5927\u4e86\uff0c\u90a3\u8fd9\u4e2a\u5c0f\u53ef\u7231\u5c31\u662f $0$ \u561bQAQ\u3002\n\n\u90a3\u6211\u4eec\u5c31\u53ef\u4ee5\u5728 $O(k^3)$ \u7684\u65f6\u95f4\u5185\u8ba1\u7b97\u540e\u9762\u7684\u4e1c\u897f\uff0c\u518d\u52a0\u4e0a\u524d\u9762\u7684\u4e1c\u897f\uff0c\u603b\u590d\u6742\u5ea6 $O(\\log_2n+k^3)$\u3002\u8db3\u4ee5\u901a\u8fc7\u672c\u9898\u3002",
        "postTime": 1617351403,
        "uid": 307453,
        "name": "\u4e91\u6d45\u77e5\u5904",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 \u3010P7468 [NOI Online 2021 \u63d0\u9ad8\u7ec4] \u6124\u6012\u7684\u5c0f N\u3011"
    },
    {
        "content": "\u53e6\u4e00\u79cd\u63a8\u5f0f\u5b50\u65b9\u6cd5\u3002\n\n### \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a $n$ \u548c $k-1$ \u6b21\u591a\u9879\u5f0f $F(x)=\\sum_{i=0}^{k-1}a_ix^i$ \uff0c\u6c42 $\\sum_{i=0}^{n-1} F(i)[popcnt(i)~mod~2=1]$ \u7684\u503c\uff0c\u7b54\u6848\u53d6\u6a21 $10^9+7$\u3002\n\n$n\\le 2^{500000},1\\le k\\le 500,0\\le a_i<10^9+7$\n\n### \u89e3\u9898\u601d\u8def\n\n\u4ee4 $m=n-1$ \u3002\n\n\u4ee4 $p_i=(-1)^{popcnt(i)}$ \uff0c\u5219 $Ans=\\dfrac 1 2(\\sum_{i=0}^m F(i)+\\sum_{i=0}^m p_iF(i))$ \u3002\n\n\u5de6\u4fa7\u5f0f\u5b50\u53ef\u4ee5\u62c9\u683c\u6717\u65e5\u63d2\u503c\u6216\u65af\u7279\u6797\u6570 $O(k^2)$ \u89e3\u51b3\u3002\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u53f3\u4fa7\u5f0f\u5b50\u3002\n\n\u8003\u8651\u5c06 $2i$ \u548c $2i+1$ \u8fdb\u884c\u914d\u5bf9\u3002\u8fd9\u4e24\u4e2a\u6570\u4e8c\u8fdb\u5236\u4e2d $1$ \u7684\u4e2a\u6570\u7684\u5947\u5076\u6027\u76f8\u53cd\uff0c\u5373 $p_{2i}=-p_{2i+1}$ \uff0c\u4e14 $p_{i}=p_{2i}$ \u3002\u90a3\u4e48\u6709\n\n$\\sum_{i=0}^m p_iF(i)=\\sum_{i=0}^{\\frac m 2} p_i(F(2i)-F(2i+1))-p_{m+1}F(m+1)[m\\text{\u4e3a\u5076\u6570}]$\n\n\u53d1\u73b0\u4e00\u4e2a\u5947\u5999\u7684\u6027\u8d28\uff0c $F_1(x)=F(2x)-F(2x+1)$ \u7684\u6b21\u6570\u6b63\u597d\u662f $k-2$ \uff01\u5c06 $F_1(x)$ \u4f5c\u4e3a\u65b0\u7684 $F(x)$ \uff0c\u5c31\u53ef\u4ee5\u5e26\u5165\u5f0f\u5b50\u7ee7\u7eed\u9012\u5f52\u4e0b\u53bb\uff0c\u800c\u4e0d\u8d85\u8fc7 $k$ \u6b21\uff0c\u8fd9\u4e2a\u591a\u9879\u5f0f\u5c31\u4f1a\u53d8\u6210 $0$ \u3002\n\n\u6839\u636e\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00\uff0c\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406 $2$ \u7684\u6b21\u5e42\uff0c\u9636\u4e58\u548c\u9636\u4e58\u9006\u5143\uff0c\u5728 $O(k^3)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u7b97\u51fa\u6240\u6709\u8fd9\u4e9b\u591a\u9879\u5f0f\u3002\u800c\u6bcf\u6b21 $m$ \u4e5f\u5c31\u662f $n-1$ \u820d\u5f03\u6700\u672b\u82e5\u5e72\u4f4d\u7684\u503c\uff0c\u5728 $m$ \u4e3a\u5076\u6570\u65f6\uff0c\u5c06\u4e00\u4e2a\u503c\u4ee3\u5165\u591a\u9879\u5f0f\u8ba1\u7b97\u5e76\u7d2f\u52a0\u8fdb\u7b54\u6848\u5373\u53ef\u3002\n\n\u9700\u8981\u7279\u522b\u6ce8\u610f\uff0c $\\log_2 n\\le k$ \u65f6\uff0c\u9700\u8981\u5728\u524d\u9762\u8865 $0$ \u81f3 $k$ \u4f4d\uff0c\u4e0d\u7136\u4f1a\u51fa\u73b0\u95ee\u9898\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n+k^3)$ \u3002\u53ef\u4ee5\u7528\u591a\u9879\u5f0f\u79d1\u6280\u4f18\u5316\u65b0\u7684\u591a\u9879\u5f0f\u7684\u8ba1\u7b97\uff0c\u4f7f\u65f6\u95f4\u590d\u6742\u5ea6\u8fbe\u5230 $O(n+k^2\\log n)$ \u3002\n\n### \u53c2\u8003\u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\nconst int maxn=500010;\nconst int mod=1000000007;\n#define int long long\nchar n[maxn];\nint ksm(int a,int k)\n{\n\tint x=a,ret=1;\n\twhile(k)\n\t{\n\t\tif(k&1)ret=ret*x%mod;\n\t\tx=x*x%mod;k>>=1;\n\t}\n\treturn ret;\n}\nint l,k,a[maxn],b[maxn],pww[maxn],frac[maxn],invf[maxn],val[maxn],pre[maxn],x[maxn],y[maxn],ans;\nint F(int x){int ret=0,nww=1;for(int i=0;i<k;i++)ret=(ret+a[i]*nww)%mod,nww=nww*x%mod;return ret;}\nint C(int n,int m){return frac[n]*invf[m]%mod*invf[n-m]%mod;}\nsigned main()\n{\n\tscanf(\"%s%lld\",n+1,&k);l=strlen(n+1);\n\tif(l<=k+1){for(int i=l;i>=1;i--)n[k+1-l+i]=n[i];for(int i=k+1-l;i>=0;i--)n[i]='0';l=k+1;}\n\t//printf(\"%s\\n\",n+1);\n\tfor(int i=l;i>=1;i--)if(n[i]=='0')n[i]='1';else{n[i]='0';break;}\n\tfor(int i=0;i<k;i++)scanf(\"%lld\",a+i);\n\tfor(int i=1;i<=l;i++)val[i]=(val[i-1]*2+n[i]-'0')%mod,pre[i]=pre[i-1]+n[i]-'0';\n\tpww[0]=frac[0]=invf[0]=1;\n\tfor(int i=1;i<=k;i++)pww[i]=pww[i-1]*2%mod,frac[i]=frac[i-1]*i%mod,invf[i]=ksm(frac[i],mod-2);\n\tfor(int i=0;i<=k+1;i++)\n\t{\n\t\tx[i]=i;\n\t\tif(i)y[i]=(y[i-1]+F(i))%mod;\n\t\telse y[i]=F(i);\n\t}\n\tif(val[l]<=k+1)ans=y[val[l]];\n\telse\n\t{\n\t\tfor(int i=0;i<=k+1;i++)\n\t\t{\n\t\t\tint prod=y[i],divi=1;\n\t\t\tfor(int j=0;j<=k+1;j++)if(i!=j)prod=prod*(val[l]-x[j]+mod)%mod,divi=divi*(x[i]-x[j]+mod)%mod;\n\t\t\tans=(ans+prod*ksm(divi,mod-2)%mod)%mod;\n\t\t}\n\t}\n\t//printf(\"%lld\\n\",ans);\n\tfor(int i=k-1,j=l;i>=0&&j>=1;i--,j--)\n\t{\n\t\tif(n[j]=='0')\n\t\t{\n\t\t\tif(pre[j]&1)ans=(ans+F(val[j]+1))%mod;\n\t\t\telse ans=(ans+mod-F(val[j]+1))%mod;\n\t\t}\n\t\tfor(int t=0;t<=k;t++)b[t]=0;\n\t\tfor(int k=0;k<=i;k++)for(int t=0;t<k;t++)\n\t\t{\n\t\t\tb[t]=(b[t]+mod-a[k]*pww[t]%mod*C(k,t)%mod)%mod;\n\t\t}\n\t\tfor(int t=0;t<=k;t++)a[t]=b[t];\n\t\t//for(int t=0;t<=k;t++)printf(\"%d \",a[t]);printf(\"\\n\");\n\t}\n\tprintf(\"%lld\\n\",ans*ksm(2,mod-2)%mod);\n\treturn 0;\n}\n```",
        "postTime": 1616905304,
        "uid": 43486,
        "name": "hsfzLZH1",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7468 \u3010[NOI Online 2021 \u63d0\u9ad8\u7ec4] \u6124\u6012\u7684\u5c0fN\u3011"
    },
    {
        "content": "> \u521d\u59cb\u6709 $S_1=\\mathrm{a}$\n> \n> \u5b9a\u4e49 $S^R$ \u4e3a $S$ \u4e2d\u7684\u5b57\u7b26\u7ffb\u8f6c\u7684\u7ed3\u679c( $a,b$ \u4e92\u6362)\n>\n> $S_{i}=S_{i-1}+S^R_{i-1}$\n>\n> \u518d\u5b9a\u4e49\u4e00\u4e2a $K$ \u6b21\u591a\u9879\u5f0f $f(x)$\n> \n> \u6c42 $\\displaystyle \\sum_{i=0}^{n-1}[S_{\\infty,i}=\\mathrm{b}]f(i)$\n\n~~\u73b0\u5728\u683c\u5f0f\u5e94\u8be5\u6ca1\u95ee\u9898\u4e86\u5427~~\n\n\u8003\u5bdf $n$ \u7684\u7279\u6b8a\u7ed9\u51fa\u65b9\u5f0f\u6211\u4eec\u53ef\u4ee5\u611f\u53d7\u5230\u6309\u7167\u4e8c\u8fdb\u5236\u62c6\u5206\u6210\u82e5\u5e72\u4e2a $2^k$ \u7684\u533a\u95f4\uff0c\u6bcf\u4e2a\u533a\u95f4\u5176\u5b9e\u662f\u524d\u7f00/\u524d\u7f00\u7684$R$,\u4e0b\u9762\u4e3a\u4e86\u65b9\u4fbf\u8868\u8ff0\u8bbe       $g(x,i,j)=x^i\\cdot\\left([S_{\\infty,x}=b]\\bigoplus j\\right)$\n\n\u5177\u4f53\u7684\uff0c\u6211\u4eec\u8bbe $\\displaystyle f_{i,j,c}=\\sum_{k=0}^{2^i-1}g(k,j,c)$\n\n\u610f\u601d\u662f $S_{\\infty}$ \u4e2d $[0,2^i)$ \u524d\u7f00/\u524d\u7f00\u53cd\u4e32( $c$ \u8868\u793a)\u4e2d $x^j$ \u6b21\u9879\u7684\u548c\n\n\u8003\u8651\u9884\u5904\u7406\u6240\u6709\u7684 $f$\n\n\u6ce8\u610f\u5230 $[0,2^i)$ \u5230 $[0,2^{i+1})$ \u589e\u91cf\u7684\u90e8\u5206\u5176\u5b9e\u662f\u628a\u524d\u4e00\u534a\u53d6\u53cd\uff0c\u518d\u5e73\u79fb\uff0c\u6ce8\u610f\u5230\u5e73\u79fb\u662f\u5728\u5e95\u6570\u7684\uff0c\u81ea\u7136\u5730\u60f3\u5230\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00\n\n$$\n\\begin{aligned}\n&\\sum_{P(i)}(p_i+\\Delta)^k\\\\=&\\sum_{P(i)}\\sum_{j=0}^kp_i^j\\Delta^{k-j}\\binom{k}{j}\n\\\\=&\\sum_{j=0}^k\\Delta^{k-j}\\binom{k}{j}\\sum_{P(i)}p_i^j\n\\end{aligned}\n$$\n\n\n\u653e\u5230\u672c\u9898\u4e2d\u5373 $f_{i,j,c}=f_{i-1,j,c}+\\sum\\limits_{k=0}^j \\binom{j}{k}\\left(2^i\\right)^{j-k}f_{i-1,j,c\\bigoplus1}$ \uff0c\u521d\u503c\u6709 $f_{0,0,1}=1 $\n\n\u518d\u63d0\u53ca\u4e00\u4e0b\u63a8\u7b54\u6848\n\n\u8bbe $n$ \u4e2d\u7b2c $k$ \u9ad8\u4f4d\u7684 `1` \u662f $2^i$ \uff0c $(k,\\log_2 n]$ \u9ad8\u4f4d\u7684\u503c\u662f $\\Delta$ ,\u6b64\u4f4d\u7684\u8d21\u732e\u662f $\\sum\\limits_{j=0}^K\\sum\\limits_{k=0}^j\\binom{j}{k}\\left(\\Delta\\right)^{j-k}f_{i,j,[k~\\mathrm{is~odd}]\\bigoplus1}$\n\n\u89e3\u91ca\u4e00\u4e0b\u5176\u5b9e\u6211\u4eec\u63d0\u53d6\u51fa\u8fd9\u4e00\u4f4d\u4e3a $1$ \u8868\u793a\u7684\u957f\u5ea6\u4e3a $2^i$ \u7684\u6bb5,\u5176\u672c\u8d28\u662f $[0,2^i)$ \u7684\u524d\u7f00(\u6709\u6b63\u53cd\u4e4b\u5206\u7531 $[k~\\mathrm{is~odd}]\\bigoplus1$ \u786e\u5b9a)\u518d\u5e73\u79fb$\\Delta$\n\n\u597d\u7684\u7136\u540e\u73b0\u5728\u4f60\u5df2\u7ecf\u53ef\u4ee5\u5728 $\\mathcal{O(nk^2)}$ \u7684\u65f6\u95f4\u5185\u9884\u5904\u7406+\u7b97\u7b54\u6848\u4e86\n\n\u8fd9\u91cc\u662f$60$\u5206\u7684\u5199\u6cd5\n\n```cpp\ninline void Solve1(void){\n\tint i,j,k,sum,v,now=0,dlt=0;\n\tf[0][0]=1;\n\tfor(i=1;i<=n;++i){\n\t\tfor(v=pw[i-1],*Pw=j=1;j<K;++j)Pw[j]=1ll*v*Pw[j-1]%mod;\n\t\tfor(j=0;j<K;++j){\n\t\t\tf[i][j]=f[i-1][j],g[i][j]=g[i-1][j];\n\t\t\tfor(k=0;k<=j;++k)f[i][j]=(f[i][j]+1ll*g[i-1][k]*C[j][k]%mod*Pw[j-k])%mod,\n\t\t\tg[i][j]=(g[i][j]+1ll*f[i-1][k]*C[j][k]%mod*Pw[j-k])%mod;\n\t\t}\n\t}\n\tfor(i=n-1;~i;--i)if(str[n-i-1]=='1'){\n\t\tnow^=1;\n\t\tfor(*Pw=j=1;j<K;++j)Pw[j]=1ll*dlt*Pw[j-1]%mod;\n\t\tfor(j=0;j<K;++j){\n\t\t\tfor(sum=0,k=0;k<=j;++k)sum=(sum+1ll*(now&1?g[i][k]:f[i][k])*C[j][k]%mod*Pw[j-k])%mod;\n\t\t\tans=(ans+1ll*sum*a[j])%mod;\n\t\t}Add(dlt,pw[i]); \n\t}\n\tprintf(\"%d\\n\",ans);\n}\n```\n\n\u7d27\u63a5\u7740\u5206\u6790(~~\u6253\u8868~~)\u4e00\u4e0b\u53ef\u4ee5\u5f97\u51fa\n\n> Lemma\n> \n> $\\forall i>j,f_{i,j,0}-f_{i,j,1}=0$\n\n\u8bc1\u660e\u5728NOI OL\u5b98\u65b9\u9898\u89e3\u5df2\u7ecf\u6709\u8be6\u7ec6\u8bc1\u660e\uff0c\u57fa\u4e8e $i=j$ \u5411 $i=j+1$ \u7684\u8f6c\u79fb\u4f5c\u4e3a\u5f52\u7eb3\u6cd5\u57fa\u5e95\u5373\u53ef\u7b80\u5355\u8bc1\u660e\n\n\u8003\u8651\u8fd9\u4e2a\u5f15\u7406\u7684\u610f\u601d\u662f\u5bf9\u4e8e $i>K$ \u7684\u90e8\u5206\uff0c\u6709\u5176\u4efb\u610f\u6b21\u9879\u7684\u8d21\u732e\u65e0\u8bba\u6b63\u4e32\u53cd\u4e32\u7b54\u6848\u5747\u4e3a $\\frac{\\sum\\limits_{j=0}^{2^i}f(j)}{2}$ \u6613\u53d1\u73b0\u8fd9\u4e1c\u897f\u662f\u81ea\u7136\u6570\u5e42\u548c\u7684\u524d\u7f00\u548c\uff0c\u662f\u4e00\u4e2a $K+1$ \u6b21\u591a\u9879\u5f0f\u76f4\u63a5\u63d2\u5373\u53ef\n\n\u66f4\u5177\u4f53\u7684\u5f53 $K>n$ \u65f6\u8bbe $n$ \u6709 $C$ \u4f4d\n\n\u5bf9 $[0,K-1]$ \u4f4d\u66b4\u529b\u7b97\u9884\u5904\u7406\u548c\u7b97\u7b54\u6848\u5747\u4e3a $\\mathcal{O(k^3)}$ ,  $[K,C]$ \u4f4d\u53d6\u51fa\u5176\u4e8c\u8fdb\u5236\u6743\u548c$v$,\u603b\u8d21\u732e\u4e3a $\\frac{\\sum\\limits_{j=0}^{v}f(j)}{2}$ \uff0c\u8fd9\u4e2a\u4e1c\u897f $O(K^2)$ \u66b4\u529b\u7b97\u524d\u51e0\u9879\u518d\u63d2\u503c\u5373\u53ef\n\n\u4e0b\u9762\u7684\u4ee3\u7801\u6c11\u95f4\u6570\u636e\u8fc7\u4e86\uff0c\u5e94\u8be5\u662f\u5bf9\u7684\u5427\n\n```cpp\n#include<bits/stdc++.h>\n#define N 1000001\n#define M 506\n#define mod 1000000007\nusing namespace std;\nchar str[N];\nint n,K,a[M],C[M][M],pw[N],Pw[M],f[M][M],g[M][M],ans,suf[M],pre[M],F[M],inv[M];\ninline void Add(int&x,int y){x=(x+y>=mod)?x+y-mod:x+y;}\ninline int Mod(int x){return x>=mod?x-mod:x;}\ninline int Lag(int *f,int m,int n){\n\tint i,pre,ans=0;suf[m+1]=1;\n\tfor(inv[1]=*inv=1,i=2;i<=m;++i)inv[i]=1ll*inv[mod%i]*(mod-mod/i)%mod;\n\tfor(i=1;i<=m;++i)inv[i]=1ll*inv[i-1]*inv[i]%mod;\n\tfor(i=m;~i;--i)suf[i]=1ll*suf[i+1]*Mod(n-i+mod)%mod;\n\tfor(pre=i=1;i<=m;pre=1ll*pre*Mod(n-i+mod)%mod,++i)ans=(ans+(((m-i)&1)?mod-1ll:1ll)*pre%mod*suf[i+1]%mod*inv[i-1]%mod*inv[m-i]%mod*f[i]%mod+mod)%mod;\n\treturn ans;\n}\ninline void Solve1(void){\n\tint i,j,k,sum,v,now=0,dlt=0;\n\tf[0][0]=1;\n\tfor(i=1;i<=n;++i){\n\t\tfor(v=pw[i-1],*Pw=j=1;j<K;++j)Pw[j]=1ll*v*Pw[j-1]%mod;\n\t\tfor(j=0;j<K;++j){\n\t\t\tf[i][j]=f[i-1][j],g[i][j]=g[i-1][j];\n\t\t\tfor(k=0;k<=j;++k)f[i][j]=(f[i][j]+1ll*g[i-1][k]*C[j][k]%mod*Pw[j-k])%mod,\n\t\t\tg[i][j]=(g[i][j]+1ll*f[i-1][k]*C[j][k]%mod*Pw[j-k])%mod;\n\t\t}\n\t}\n\tfor(i=n-1;~i;--i)if(str[n-i-1]=='1'){\n\t\tnow^=1;\n\t\tfor(*Pw=j=1;j<K;++j)Pw[j]=1ll*dlt*Pw[j-1]%mod;\n\t\tfor(j=0;j<K;++j){\n\t\t\tfor(sum=0,k=0;k<=j;++k)sum=(sum+1ll*(now&1?g[i][k]:f[i][k])*C[j][k]%mod*Pw[j-k])%mod;\n\t\t\tans=(ans+1ll*sum*a[j])%mod;\n\t\t}Add(dlt,pw[i]); \n\t}\n\tprintf(\"%d\\n\",ans);\n}\ninline void Solve2(void){\n\tint i,j,k,sum,res,v,now=0,dlt=0; \n\tf[0][0]=1;\n\tfor(i=1;i<=K;++i){\n\t\tfor(v=pw[i-1],*Pw=j=1;j<K;++j)Pw[j]=1ll*v*Pw[j-1]%mod;\n\t\tfor(j=0;j<K;++j){\n\t\t\tf[i][j]=f[i-1][j],g[i][j]=g[i-1][j];\n\t\t\tfor(k=0;k<=j;++k)f[i][j]=(f[i][j]+1ll*g[i-1][k]*C[j][k]%mod*Pw[j-k])%mod,\n\t\t\tg[i][j]=(g[i][j]+1ll*f[i-1][k]*C[j][k]%mod*Pw[j-k])%mod;\n\t\t}\n\t}\n\tfor(i=n-1;~i;--i)if(str[n-i-1]=='1'){\n\t\tnow^=1;if(i>K){dlt=(dlt+pw[i])%mod;continue;}\n\t\tfor(*Pw=j=1;j<K;++j)Pw[j]=1ll*dlt*Pw[j-1]%mod;\n\t\tfor(j=0;j<K;++j){\n\t\t\tfor(sum=0,k=0;k<=j;++k)sum=(sum+1ll*(now&1?g[i][k]:f[i][k])*C[j][k]%mod*Pw[j-k])%mod;\n\t\t\tans=(ans+1ll*sum*a[j])%mod;\n\t\t}Add(dlt,pw[i]); \n\t}\n\tfor(res=0,i=1;i<=K+5;++i){\n\t\tfor(sum=0,j=K-1;~j;--j)sum=(1ll*sum*(i-1)+a[j])%mod;\n\t\tAdd(res,sum);F[i]=res;\n\t}\n\tfor(dlt=0,i=n-1;i>K;--i)if(str[n-i-1]=='1')Add(dlt,pw[i]); \n\tprintf(\"%lld\\n\",(ans+500000004ll*Lag(F,K+5,dlt))%mod);\n}\nint main(void){\n\tfreopen(\"angry.in\",\"r\",stdin);\n\tfreopen(\"angry.out\",\"w\",stdout);\n\tint i,j;scanf(\"%s%d\",str,&K),n=strlen(str);\n\tfor(i=0;i<K;++i)scanf(\"%d\",a+i);\n\tfor(C[0][0]=i=1;i<=K;++i)\n\t\tfor(C[i][0]=j=1;j<=i;++j)C[i][j]=(C[i-1][j-1]+C[i-1][j])%mod;\n\tfor(*pw=i=1;i<=n;++i)Add(pw[i]=pw[i-1],pw[i-1]);\n\tif(n<=500)return Solve1(),0;\n\tSolve2();\n\treturn 0;\n}\n```",
        "postTime": 1616833396,
        "uid": 40629,
        "name": "zzw4257",
        "ccfLevel": 0,
        "title": "[NOI Online 2021 \u63d0\u9ad8\u7ec4] \u6124\u6012\u7684\u5c0fN\u9898\u89e3"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://www.luogu.com.cn/problem/P7468)\n\n## \u9898\u610f\n\u5b9a\u4e49\u4e32 $A_0=\\texttt{a}$\uff0c$A_i=A_{i-1}+\\overline{A_{i-1}}$\uff08\u5176\u4e2d\u4e0a\u5212\u7ebf\u4ee3\u8868 a b \u4e92\u6362\uff09\uff0c\u8003\u8651\u4e32 $A_\\infty[0..n-1]$\u3002\u7ed9\u5b9a $k-1$ \u6b21\u591a\u9879\u5f0f $f$\uff0c\u6c42 $\\sum_{i=0}^{n-1}[A_\\infty[i]=\\texttt{b}]f(i)$\u3002$n\\leq 2^{500000}$\uff0c$k\\leq 500$\u3002\n\n## \u9898\u89e3\n\u6211\u4eec\u9996\u5148\u8003\u8651 $O(k^2\\log n)$ \u7684\u505a\u6cd5\uff1a\u6211\u4eec\u7ef4\u62a4\u591a\u9879\u5f0f $F_{i,\\texttt{a}/\\texttt{b}}(x)$ \u4ee3\u8868\u628a\u5b57\u7b26\u4e32 $A_i$ \u5e73\u79fb\u5230 $x$ \u5904\u540e\uff0c$\\texttt{a}/\\texttt{b}$ \u7684\u8d21\u732e\u3002$F_{0,\\texttt{a}}=f,F_{0,\\texttt{b}}=0$\u3002\n\n\u6211\u4eec\u6709 $F_{i,\\texttt{a}}(x)=F_{i-1,\\texttt{a}}(x)+F_{i-1,\\texttt{b}}(x+2^{i-1})$\uff08$F_{i,\\texttt{b}}$ \u540c\u7406\uff09\uff0c\u5904\u7406\u7cfb\u6570\u5e73\u79fb\u9700\u8981 $O(k^2)$\uff08\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00\uff09\uff0c\u4e00\u5171\u8981\u9012\u63a8\u5230 $F_{\\log n,\\texttt{a}/\\texttt{b}}$\u3002\n\n\u5982\u679c\u4f60\u5728\u8c03\u8bd5\u65f6\u8f93\u51fa\u4e86\u591a\u9879\u5f0f\uff0c\u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\u5728 $i\\geq k$ \u65f6\uff0c$F_{i,\\texttt{a}}=F_{i,\\texttt{b}}$\u3002\u8bc1\u660e\u53ef\u4ee5\u53c2\u89c1[\u5b98\u65b9\u9898\u89e3](http://www.noi.cn/xw/2021-03-27/724334.shtml)\u3002\uff08\u8003\u8bd5\u65f6\u6211\u8f93\u51fa\u4e86\u8c03\u8bd5\u4fe1\u606f\uff0c\u4f46\u662f\u6ca1\u53d1\u73b0\u7ed3\u8bba\uff0c\u4e00\u4e2a\u60b2\u4f24\u7684\u6545\u4e8b\uff09\n\n\u77e5\u9053\u8fd9\u4e2a\u7ed3\u8bba\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u53ea\u5904\u7406\u5230 $F_{k-1,\\texttt{a}/\\texttt{b}}$\uff0c\u5269\u4e0b\u7684\u90e8\u5206\u501f\u52a9\u81ea\u7136\u6570\u5e42\u548c\u8ba1\u7b97\u3002\u590d\u6742\u5ea6 $O(k^3+\\log n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint getint(){\n    int ans=0;\n    char c=getchar();\n    while(!isdigit(c))c=getchar();\n    while(isdigit(c)){\n        ans=ans*10+c-'0';\n        c=getchar();\n    }\n    return ans;\n}\nconst int K=503,N=500010,mod=1e9+7;\nint f[2][K],g[2][K];\nint c[K][K];\nchar s[N];int n;\n\nint p2[N];\nint p[N],q[N];\n\nint sp[N];\nint qpow(int x,int y){\n    int ans=1;\n    while(y){\n        if(y&1)ans=ans*1ll*x%mod;\n        x=x*1ll*x%mod;\n        y>>=1;\n    }\n    return ans;\n}\nint main(){\n    freopen(\"angry.in\",\"r\",stdin);\n    freopen(\"angry.out\",\"w\",stdout);\n    scanf(\"%s\",s+1);\n    n=strlen(s+1);\n    int k=getint();\n    if(n<k){\n        for(int i=n;i;i--)s[k-n+i]=s[i];\n        for(int i=1;i<=k-n;i++)s[i]='0';\n        n=k;\n    }\n    for(int i=0;i<k;i++)f[0][i]=getint();\n    for(int i=c[0][0]=1;i<=k;i++)\n        for(int j=c[i][0]=1;j<=k;j++)\n            c[i][j]=(c[i-1][j]+c[i-1][j-1])%mod;\n    p2[0]=1;for(int i=1;i<=n;i++)p2[i]=p2[i-1]<<1,p2[i]>=mod&&(p2[i]-=mod);\n    for(int i=1;i<=n;i++){\n        q[n-i]=q[n-i+1]^(s[i]-'0');\n        p[n-i]=(p[n-i+1]+(s[i]-'0')*p2[n-i])%mod;\n    }\n\n    int ans=0;\n\n    int m=p[0];\n    // cerr<<\"> \"<<m<<endl;\n    sp[0]=m;\n    for(int i=1;i<k;i++){\n        sp[i]=qpow(m,i+1);\n        for(int j=0;j<i;j++)\n            sp[i]=(sp[i]-c[i+1][j]*1ll*sp[j]%mod+mod)%mod;\n        sp[i]=sp[i]*1ll*qpow(i+1,mod-2)%mod;\n        // cerr<<\"> \"<<sp[i]<<endl;\n    }\n    for(int i=0;i<k;i++)ans=(ans+f[0][i]*1ll*sp[i])%mod;\n\n    for(int i=0;i<k;i++){\n        // for(int i=0;i<k;i++)cerr<<\">\"<<f[0][i];cerr<<endl;\n        // for(int i=0;i<k;i++)cerr<<\">\"<<f[1][i];cerr<<endl;cerr<<endl;\n        int q=::q[i],p=::p[i+1];\n        if(s[n-i]-'0'){\n            int v=0;\n            for(int j=0;j<k;j++)\n                v=(v*1ll*p+f[q][k-j-1])%mod;\n            ans=(ans+v)%mod;\n            v=0;\n            for(int j=0;j<k;j++)\n                v=(v*1ll*p+f[q^1][k-j-1])%mod;\n            ans=(ans+mod-v)%mod;\n        }\n\n        memcpy(g,f,sizeof(g));\n        int e=p2[i];\n        for(int j=0;j<k;j++){\n            int pe=1;\n            for(int l=j;l>=0;l--,pe=pe*1ll*e%mod){\n                int t=pe*1ll*c[j][l]%mod;\n                g[1][l]=(g[1][l]+f[0][j]*1ll*t)%mod;\n                g[0][l]=(g[0][l]+f[1][j]*1ll*t)%mod;\n            }\n        }\n        memcpy(f,g,sizeof(f));\n    }\n\n    ans=(mod+1ll)/2*ans%mod;\n\n    cout<<ans;\n}\n\n```\n",
        "postTime": 1616835875,
        "uid": 37676,
        "name": "\u7834\u58c1\u4eba\u4e94\u53f7",
        "ccfLevel": 9,
        "title": "\u3010\u9898\u89e3\u3011\u6d1b\u8c37 P7468 [NOI Online 2021 \u63d0\u9ad8\u7ec4] \u6124\u6012\u7684\u5c0fN\u3010\u81ea\u7136\u6570\u5e42\u548c \u7ed3\u8bba\u9898\u3011"
    },
    {
        "content": "\u5176\u5b9e\u8fd9\u9898\u7684\u5956\u52b1\u5173\u6784\u9020\u65b9\u5f0f\u4e0e\u6b63\u89e3\u662f\u6709\u4e00\u5b9a\u8054\u7cfb\u7684.\n\n\u5f00\u59cb\u65f6 $s_0=0$ ,\u968f\u540e\u590d\u5236\u5e76\u7ffb\u8f6c,\u6070\u597d\u4f7f\u5b57\u7b26\u4e32\u4e0a\u7684 $popcount$ \u7684\u5947\u5076\u6027\u53cd\u8f6c.\n\n\u6216\u8005\u66f4\u8be6\u7ec6\u5730,\u5bf9\u4e8e $s_i$ \u6709\u4e0b\u5217\u8f6c\u79fb:\n$$\ns_i=\n\\begin{cases}\n1-s_{i-highbit(i)} & i>0\\\\\n0                  & i=0\\\\\n\\end{cases}\n$$\n\u56e0\u6b64 $s_i=popcount(i)\\bmod 2$ .\n\n\u663e\u7136\u6709\u4e00\u79cd\u66b4\u529b\u7684\u65b9\u5f0f\u5c31\u662f\u679a\u4e3e\u6bcf\u4e2a $s_i=1$ \u7684 $f(i)$ \u6c42\u548c.\n\n**\u4e0b\u9762\u6211\u4eec\u4ee4 $N$ \u4e3a\u4e8c\u8fdb\u5236\u6570 $n$ \u8f6c\u5341\u8fdb\u5236\u540e\u7684\u503c, $n_i$ \u8868\u793a\u4e8c\u8fdb\u5236\u6570 $n$ \u4ece\u4f4e\u5230\u9ad8\u7684\u7b2c $i$ \u4f4d\u7684\u503c( $0$ \u6216 $1$ ), $n$ \u8868\u793a\u4e8c\u8fdb\u5236\u6570 $n$ \u7684\u957f\u5ea6(\u5373\u770b\u4f5c\u5b57\u7b26\u4e32\u65f6\u7684\u957f\u5ea6), $C_i=\\{x\\in \\text{N}|popcount(x)\\bmod2=i\\}$ .**\n$$\nans=\\sum_{i=0,i\\in C_1}^{N-1}f(i)\n$$\n\u8fd9\u4e2a\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f$O(Nk)$\u7684.\n\n\u63a8\u63a8\u5f0f\u5b50,\u8ba9\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u4e0d\u8981\u5305\u542b$i\\in C_1$\u8fd9\u79cd\u4e0d\u597d\u4e00\u8d77\u8ba1\u7b97\u7684\u4e1c\u897f.\n\n\u8003\u8651\u62c6\u6210\u4e24\u4e2a\u5f0f\u5b50:\n$$\n\\begin{aligned}\nans&=\\sum_{i=0,i\\in C_1}^{N-1}f(i)\\\\\n&=\\frac{1}{2}\\sum_{i=0}^{N-1}f(i)-\\frac{1}{2}\\sum_{i=0}^{N-1}(-1)^{popcount(i)}f(i)\n\\end{aligned}\n$$\n\u5de6\u8fb9\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u5229\u7528\u5f85\u5b9a\u7cfb\u6570\u6cd5,\u4f7f\u7528\u62c9\u683c\u6717\u65e5\u63d2\u503c\u6216\u9ad8\u65af\u6d88\u5143\u6cd5\u6c42\u51fa $f(i)$ \u7684\u524d\u7f00\u548c\u7684\u591a\u9879\u5f0f,\u5728\u4ee3\u5165\u6c42\u503c.\u53ef\u4ee5\u8bc1\u660e\u5176\u524d\u7f00\u548c\u7684\u591a\u9879\u5f0f\u662f\u4e0d\u8d85\u8fc7 $k+1$ \u6b21\u7684.\n\n\u73b0\u5728\u5c31\u53ea\u9700\u8981\u6c42\u51fa\u53f3\u8fb9\u8fd9\u5757:\n$$\n\\begin{aligned}\n\\sum_{i=0}^{N-1}(-1)^{popcount(i)}f(i)\n&=\\sum_{i=0}^{k-1}a_i\\sum_{j=0}^{N-1}(-1)^{popcount(j)}j^i &(\\text{\u5c55\u5f00\u591a\u9879\u5f0f\u5e76\u63d0\u53d6\u516c\u56e0\u5f0f})\\\\\n&=\\sum_{i=0}^{k-1}a_i\\sum_{j=0,n_j=1}^{n-1}(-1)^{popcount(T)}\\sum_{l=0}^{2^j-1}(-1)^{popcount(l)}(T+l)^i &(T=\\sum_{l=j+1,n_l=1}^{n-1}2^l)\\\\\n&=\\sum_{i=0}^{k-1}a_i\\sum_{j=0,n_j=1}^{n-1}(-1)^{popcount(T)}\\sum_{l=0}^i{i\\choose l}T^l\\sum_{p=0}^{2^j-1}(-1)^{popcount(p)}p^{i-l} &(\\text{\u5229\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00}(T+p)^i)\\\\\n\\end{aligned}\n$$\n\u53d1\u73b0 $\\sum_{p=0}^{2^j-1}(-1)^{popcount(p)}p^{i-l}$ \u7684\u503c\u4ec5\u4e0e $i-l$ \u548c $j$ \u6709\u5173,\u8003\u8651\u9884\u5904\u7406\u51fa\u5b83\u4eec\u7684\u503c.\n\n\u4ee4 $sum(i,j)=\\sum_{l=0}^{2^i-1}(-1)^{popcount(l)}l^j$ ,\u5219\u6709:\n$$\n\\begin{aligned}\nsum(i,j)\n&=\\sum_{l=0}^{2^i-1}(-1)^{popcount(l)}l^j\\\\\n&=\\sum_{l=0}^{2^{i-1}-1}(-1)^{popcount(l)}l^j-\\sum_{l=0}^{2^{i-1}-1}(-1)^{popcount(l)}(2^{i-1}+l)^j &(\\text{\u62c6\u6210\u4e24\u534a\u8ba1\u7b97})\\\\\n&=sum(i-1,j)-\\sum_{l=0}^{2^{i-1}-1}(-1)^{popcount(l)}(2^{i-1}+l)^j &(\\text{\u5de6\u8fb9\u7684\u53ef\u4ee5\u76f4\u63a5\u66ff\u6362})\\\\\n&=sum(i-1,j)-\\sum_{l=0}^{j}{j\\choose l}2^{(i-1)l}\\sum_{p=0}^{2^{i-1}-1}(-1)^{popcount(p)}p^{j-l} &(\\text{\u5229\u7528\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00})\\\\\n&=sum(i-1,j)-\\sum_{l=0}^{j}{j\\choose l}2^{(i-1)l}sum(i-1,j-l) &(\\text{\u53f3\u8fb9\u7684\u4e5f\u53ef\u4ee5\u66ff\u6362\u4e86})\\\\\n\\end{aligned}\n$$\n\u7136\u540e\u5c31\u53ef\u4ee5\u505a\u5230 $O(nk^2)$ \u6c42\u51fa\u6b63\u786e\u7b54\u6848.\n\n\u8003\u8651\u5220\u53bb\u5197\u4f59\u7684\u8ba1\u7b97.\n\n\u5176\u5b9e $sum(i,j)$ \u5728 $i>j$ \u65f6\u662f\u4e3a $0$ \u7684,\u53ef\u4ee5\u4f7f\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u8bc1\u660e:\n\n~~\u7136\u800c\u6211\u5e76\u4e0d\u662f\u5f88\u61c2\u6570\u5b66\u5f52\u7eb3\u6cd5\u2026~~\n\n- \u5f53 $i=0$ \u65f6,\u4e0d\u5b58\u5728\u81ea\u7136\u6570 $j<i$ ,\u7ed3\u8bba\u663e\u7136\u6210\u7acb.\n\n- \u5f53 $i>0$ \u65f6,\u6211\u4eec\u5206\u7c7b\u8ba8\u8bba $j<i-1$ \u4e0e $j=i-1$ \u7684\u60c5\u51b5.\n\n  - \u5f53 $j<i-1$ \u65f6, $sum(i-1,j)$ \u4e0e $sum(i-1,j-l)$ \u90fd\u4e3a $0$ ,\u56e0\u6b64 $sum(i-1,j)$ \u4ea6\u4e3a $0$ .\n\n  - \u5f53 $j=i-1$ \u65f6,\n    $$\n    \\begin{aligned}\n    sum(i,j)&=sum(i-1,j)-\\sum_{l=0}^j{j\\choose l}2^{(i-1)l}sum(i-1,j-l)\\\\\n    &=sum(i-1,j)-sum(i-1,j)-\\sum_{l=1}^j{j\\choose l}2^{(i-1)l}sum(i-1,j-l)\\\\\n    &=-\\sum_{l=1}^j{j\\choose l}2^{(i-1)l}sum(i-1,j-l)\\\\\n    &=0\n    \\end{aligned}\n    $$\n    \n\n\u56e0\u6b64\u547d\u9898\u5f97\u8bc1.\n$$\n\\begin{aligned}\n\\sum_{i=0}^{N-1}(-1)^{popcount(i)}f(i)\n&=\\sum_{i=0}^{k-1}a_i\\sum_{j=0,n_j=1}^{n-1}(-1)^{popcount(T)}\\sum_{l=0}^i{i\\choose l}T^l\\sum_{p=0}^{2^j-1}(-1)^{popcount(p)}p^{i-l}\\\\\n&=\\sum_{i=0}^{k-1}a_i\\sum_{j=0,n_j=1}^{n-1}(-1)^{popcount(T)}\\sum_{l=0}^i{i\\choose l}T^lsum(j,i-l)\\\\\n&=\\sum_{i=0}^{k-1}a_i\\sum_{j=0,n_j=1}^{\\min(k,n)-1}(-1)^{popcount(T)}\\sum_{l=0}^i{i\\choose l}T^lsum(j,i-l)\\\\\n\\end{aligned}\n$$\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728 $O(k^3)$ \u7684\u65f6\u95f4\u5904\u7406\u51fa\u540e\u9762\u90e8\u5206,\u518d\u5408\u5e76\u524d\u9762\u7684\u7b97\u6cd5\u5373\u53ef\u901a\u8fc7\u6b64\u9898.",
        "postTime": 1617233316,
        "uid": 118239,
        "name": "Chinese_zjc_",
        "ccfLevel": 0,
        "title": "P7468 \u9898\u89e3"
    }
]