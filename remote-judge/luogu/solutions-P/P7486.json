[
    {
        "content": "### [P7486 \u300cStoi2031\u300d\u5f69\u8679](https://www.luogu.com.cn/problem/P7486)\n\n\u4ee4 $S(a,b)=\\prod\\limits_{i=1}^{a}\\prod\\limits_{j=1}^{b}\\operatorname{lcm}(a,b)^{\\operatorname{lcm}(a,b)}$\u3002\n\n\u6c42\uff1a\n$$\n\\frac{S(r,r)\\times S(l-1,l-1)}{S(r,l-1)\\times S(l-1,r)}\n$$\n\u4e0d\u59a8\u8bbe $a \\leq b$\u3002\n\n\u4ee4 $dp=t$\uff0c\u5219\u6709\uff1a\n$$\n\\begin{aligned}\nS(a,b)&=\\prod\\limits_{i=1}^{a}\\prod\\limits_{j=1}^{b}\\operatorname{lcm}(a,b)^{\\operatorname{lcm}(a,b)}\\\\\n&=\\prod_{i=1}^{a}\\prod_{j=1}^{b}\\frac{ij}{\\gcd(a,b)}^{(\\frac{ij}{\\gcd(a,b)})}\\\\\n&=\\prod_{d=1}^{a}\\prod_{i=1}^{a}\\prod_{j=1}^{b}\\frac{ij}{d}^{(\\frac{ij}{d})[\\gcd(i,j)=d]}\\\\\n&=\\prod_{d=1}^{a}\\prod_{i=1}^{\\lfloor\\frac{a}{d}\\rfloor}\\prod_{j=1}^{\\lfloor\\frac{b}{d}\\rfloor}(ijd)^{ijd[\\gcd(i,j)=1]}\\\\\n&=\\prod_{d=1}^{a}\\prod_{i=1}^{\\lfloor\\frac{a}{d}\\rfloor}\\prod_{j=1}^{\\lfloor\\frac{b}{d}\\rfloor}(ijd)^{ijd\\sum\\limits_{p=1}^{\\lfloor\\frac{a}{d}\\rfloor}\\mu(p)[p|i][p|j]}\\\\\n&=\\prod_{d=1}^{a}\\prod_{p=1}^{\\lfloor\\frac{a}{d}\\rfloor}\\prod_{i=1}^{\\lfloor\\frac{a}{d}\\rfloor}[p|i]\\prod_{j=1}^{\\lfloor\\frac{b}{d}\\rfloor}[p|j](ijd)^{ijd\\mu(p)}\\\\\n&=\\prod_{d=1}^{a}\\prod_{p=1}^{\\lfloor\\frac{a}{d}\\rfloor}\\prod_{i=1}^{\\lfloor\\frac{a}{dp}\\rfloor}\\prod_{j=1}^{\\lfloor\\frac{b}{dp}\\rfloor}(ijdp^2)^{ijdp^2\\mu(p)}\\\\\n&=\\prod_{t=1}^{a}\\prod_{p|t}\\prod_{i=1}^{\\lfloor\\frac{a}{t}\\rfloor}\\prod_{j=1}^{\\lfloor\\frac{b}{t}\\rfloor}(ijtp)^{ijtp\\mu(p)}\\\\\n\\end{aligned}\n$$\n\u4ee4 $s(x)=\\sum\\limits_{i=1}^{x}i=\\frac{x(x+1)}{2}$\uff0c$f(x)=\\prod\\limits_{i=1}^{x}i^i$\uff0c\u5219\u6709\uff1a\n$$\n\\prod_{i=1}^{n}\\prod_{j=1}^{m}(ij)^{ij}=f(n)^{s(m)}\\times f(m)^{s(n)}\n$$\n\u4ee4\u5176\u4e3a $G(n,m)$\u3002\n\n\u53e6\u6709\uff1a\n$$\n\\prod_{i=1}^{n}\\prod_{j=1}^{m}(tp)^{ij}=(tp)^{s(n)\\times S(m)}\n$$\n\u5e26\u56de\u539f\u5f0f\u6709\uff1a\n$$\n\\prod_{t=1}^{a}\\left( \\prod_{p|t}\\left( G(\\lfloor\\frac{a}{t}\\rfloor,\\lfloor\\frac{b}{t}\\rfloor) \\times (tp)^{s(\\lfloor\\frac{a}{t}\\rfloor)\\times s(\\lfloor\\frac{b}{t}\\rfloor)} \\right)^{p\\mu(p)} \\right)^{t}\n$$\n\n\n\u53e6 $h(x)=\\sum\\limits_{d|x}d\\mu(d),y(x)=\\prod\\limits_{d|x}d^{d\\mu(d)}$\uff0c\u5219\u6709\uff1a\n$$\n\\prod_{t=1}^{a}G(\\lfloor\\frac{a}{t}\\rfloor,\\lfloor\\frac{b}{t}\\rfloor)^{t \\cdot h(t)}\\times (t^{h(t)}\\times y(t))^{t\\times s(\\lfloor\\frac{a}{t}\\rfloor)\\times s(\\lfloor\\frac{b}{t}\\rfloor)}\n$$\n\u518d\u4ee4 $hh(x)=x\\times h(x),yy(x)=(x^{h(x)}\\times y(x))^{x}$\uff0c\u53ef\u5f97\uff1a\n$$\n\\prod_{t=1}^{a}G(\\lfloor\\frac{a}{t}\\rfloor,\\lfloor\\frac{b}{t}\\rfloor)^{hh(t)}\\times yy(t)^{s(\\lfloor\\frac{a}{t}\\rfloor)\\times s(\\lfloor\\frac{b}{t}\\rfloor)}\n$$\n\u6700\u540e\u524d\u7f00\u548c $\\text{+}$ \u524d\u7f00\u79ef $\\text{+}$ \u6570\u8bba\u5206\u5757\u5373\u53ef\u3002\n\n\u518d\u52a0\u4e00\u4e2a\u5c0f\u4f18\u5316\uff0c\u8bbe\u4e00\u4e2a\u9608\u503c $S$\uff0c\u5bf9\u4e8e $1 \\leq t < S$ \u7684\u76f4\u63a5\u66b4\u529b\u7b97\uff0c\u56e0\u4e3a\u8fd9\u90e8\u5206 $l,r$ \u76f8\u5dee\u8f83\u5c0f\u3002\n\n\u5bf9\u4e8e $S \\leq t \\leq n$ \u7684\uff0c\u518d\u6570\u8bba\u5206\u5757\u7b97\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ninline int read()\n{\n\tint x = 0, f = 1;\n\tchar c = getchar();\n\twhile(c < '0' || c > '9')\n\t{\n\t\tif(c == '-') f = -1;\n\t\tc = getchar();\n\t}\n\twhile(c >= '0' && c <= '9')\n\t{\n\t\tx = x * 10 + c - '0';\n\t\tc = getchar();\n\t}\n\treturn x * f;\n}\n\ninline void write(int x)\n{\n\tif(x < 0)\n\t{\n\t\tputchar('-');\n\t\tx = -x;\n\t}\n\tif(x > 9)\n\t\twrite(x / 10);\n\tputchar(x % 10 + '0');\n}\n\nconst int _ = 1e6 + 7, mod = 32465177;\n\nbool vis[_];\n\nint cnt, pr[_], mu[_], f[_], h[_], y[_];\n\nint ksm(int x, int y)\n{\n\tint res = 1;\n\twhile(y)\n\t{\n\t\tif(y & 1) res = 1ll * res * x % mod;\n\t\tx = 1ll * x * x % mod;\n\t\ty >>= 1;\n\t}\n\treturn res;\n}\n\nvoid init()\n{\n\tmu[1] = 1;\n\tf[1] = 1;\n\ty[1] = 1;\n\tfor(int i = 2; i <= _ - 7; ++i)\n\t{\n\t\tf[i] = 1ll * f[i - 1] * ksm(i, i) % mod;\n\t\ty[i] = 1;\n\t\tif(!vis[i])\n\t\t{\n\t\t\tpr[++cnt] = i;\n\t\t\tmu[i] = -1;\n\t\t}\n\t\tfor(int j = 1; j <= cnt && i * pr[j] <= _ - 7; ++j)\n\t\t{\n\t\t\tint p = i * pr[j];\n\t\t\tvis[p] = 1;\n\t\t\tif(i % pr[j] == 0)\n\t\t\t{\n\t\t\t\tmu[p] = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmu[p] = -mu[i];\n\t\t}\n\t}\n\tfor(int i = 1; i <= _ - 7; ++i)\n\t\tfor(int j = 1; i * j <= _ - 7; ++j)\n\t\t{\n\t\t\th[i * j] = ((h[i * j] + mu[i] * i) % (mod - 1) + (mod - 1)) % (mod - 1);\n\t\t\ty[i * j] = 1ll * y[i * j] * ksm(i, i * mu[i] + mod - 1) % mod;\n\t\t}\n\tfor(int i = 1; i <= _ - 7; ++i)\n\t{\n\t\ty[i] = ksm(1ll * ksm(i, h[i]) * y[i] % mod, i);\n\t\th[i] = 1ll * h[i] * i % (mod - 1);\n\t}\n\ty[0] = 1;\n\tfor(int i = 2; i <= _ - 7; ++i)\n\t{\n\t\ty[i] = 1ll * y[i - 1] * y[i] % mod;\n\t\th[i] = (h[i] + h[i - 1]) % (mod - 1);\n\t}\n}\n\nint s(int x)\n{\n\treturn 1ll * x * (x + 1) / 2 % (mod - 1);\n}\n\nint g(int x, int y)\n{\n\treturn 1ll * ksm(f[x], s(y)) * ksm(f[y], s(x)) % mod;\n}\n\nint hh(int l, int r)\n{\n\treturn ((h[r] - h[l - 1]) % (mod - 1) + (mod - 1)) % (mod - 1);\n}\n\nint yy(int l, int r)\n{\n\treturn 1ll * y[r] * ksm(y[l - 1], mod - 2) % mod;\n}\n\nint S(int a, int b)\n{\n\tif(a > b) swap(a, b);\n\tint res = 1;\n\tfor(int i = 1, j; i <= a; i = j + 1)\n\t{\n\t\tj = min(a / (a / i), b / (b / i));\n\t\tres = 1ll * res * ksm(g(a / i, b / i), hh(i, j)) % mod * ksm(yy(i, j), 1ll * s(a / i) * s(b / i) % (mod - 1)) % mod; \n\t}\n\treturn res;\n}\n\nint solve(int l, int r)\n{\n\tswap(l, r);\n\tint ans1 = 1ll * S(r, r) * S(l - 1, l - 1) % mod, ans2 = 1ll * S(r, l - 1) * S(l - 1, r) % mod;\n\treturn 1ll * ans1 * ksm(ans2, mod - 2) % mod;\n}\n\nsigned main()\n{\n\tinit();\n\tint t = read(), n = read();\n\twhile(t--)\n\t{\n\t\twrite(solve(read(), read()));\n\t\tputchar('\\n');\n\t}\n}\n```\n\n",
        "postTime": 1642467424,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "P7486 \u300cStoi2031\u300d\u5f69\u8679"
    },
    {
        "content": "\u8003\u8651\u7b80\u5316\u95ee\u9898\uff0c\u6709\uff1a\n\n $$\n \\begin{aligned}\n &\\Rightarrow\\prod\\limits_{i=l}^r\\prod\\limits_{j=l}^rf(i,j)\n  \\\\&=\\prod\\limits_{i=l}^r\\frac{\\prod\\limits_{j=1}^rf(i,j)}{\\prod\\limits_{j'=1}^{l-1}f(i,j')}\n   \\\\&=\\prod\\limits_{i=1}^r\\frac{\\prod\\limits_{j=1}^rf(i,j)}{\\prod\\limits_{j'=1}^{l-1}f(i,j')}\\prod\\limits_{i'=1}^{l-1}\\frac{\\prod\\limits_{k=1}^{l-1}f(i',k)}{\\prod\\limits_{k=1}^{r}f(i',k')}\n   \\\\&=\\frac{solve(r,r)*solve(l-1,l-1)}{solve(r,l-1)*solve(l-1,r)}\n \\end{aligned}\n $$\n\n\u8fd9\u91cc\u7684 $solve(n,m)=\\prod\\limits_{i=1}^n\\prod\\limits_{j=1}^mlcm(i,j)^{lcm(i,j)}$ \u3002\u90a3\u4e48\u6211\u4eec\u8003\u8651\u6c42\u51fa $solve(n,m)$ \u7684\u503c\u5373\u53ef\u3002\u4e0b\u4f5c $solve(n,m)$ \u7684\u5316\u7b80\u3002\n\n $$\n \\begin{aligned}\n &\\Rightarrow\\prod\\limits_{i=1}^n\\prod\\limits_{j=1}^m\\frac{ij}{\\gcd(i,j)}^{\\frac{ij}{\\gcd(i,j)}}\n \\\\&=\\prod\\limits_{i=1}^n\\prod\\limits_{j=1}^m\\prod\\limits_{d=1}^n\\frac{ij}{d}^{\\frac{ij}{d}[d=\\gcd(i,j)]}\n  \\\\&=\\prod\\limits_{d=1}^n\\prod\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\prod\\limits_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}(ijd)^{ijd[1=\\gcd(i,j)]}\n  \\\\&=\\prod\\limits_{d=1}^n\\prod\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\prod\\limits_{j=1}^{\\lfloor\\frac{m}{d}\\rfloor}\\prod\\limits_{t\\mid i,t\\mid j}(ijd)^{ijd\\mu(t)}\n  \\\\&=\\prod\\limits_{d=1}^n\\prod\\limits_{t=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\prod\\limits_{i=1}^{\\lfloor\\frac{n}{dt}\\rfloor}\\prod\\limits_{j=1}^{\\lfloor\\frac{m}{dt}\\rfloor}(ijdt^2)^{ijdt^2\\mu(t)}\n   \\\\&=\\prod\\limits_{T=1}^n\\prod\\limits_{d\\mid T}(\\prod\\limits_{i=1}^{\\lfloor\\frac{n}{T}\\rfloor}\\prod\\limits_{j=1}^{\\lfloor\\frac{m}{T}\\rfloor}(ijdT)^{ij})^{dT\\mu(d)}\n \\end{aligned}\n $$\n\n\u8003\u8651 $\\prod\\limits_{i=1}^{x}\\prod\\limits_{j=1}^{y}(ij)^{ij}$ \uff0c\u6709\uff1a\n \n $$\n \\begin{aligned}\n &\\Rightarrow\\prod\\limits_{i=1}^{x}(\\prod\\limits_{j=1}^{y}(ij)^j)^i\n \\\\&=\\prod\\limits_{i=1}^{x}i^{s(y)i}(\\prod\\limits_{j=1}^{y}j^j)^i\n  \\\\&=\\prod\\limits_{i=1}^{x}i^{s(y)i}g(y)^i\n  \\\\&=g(y)^{s(x)}(\\prod\\limits_{i=1}^{x}i^{i})^{s(y)}\n \\\\&=g(y)^{s(x)}g(x)^{s(y)} \n \\end{aligned}\n $$\n \n \u5176\u4e2d $s(x)=\\frac{x(x+1)}{2},g(x)=\\prod\\limits_{i=1}^xi^i$ \u3002\n \u518d\u8003\u8651 $\\prod\\limits_{i=1}^{x}\\prod\\limits_{j=1}^{y}(dT)^{ij}$ \uff0c\u6709\uff1a\n  \n  $$\n \\begin{aligned}\n \\prod\\limits_{i=1}^{x}\\prod\\limits_{j=1}^{y}(dT)^{ij}=(dT)^{s(x)s(y)}\n \\end{aligned}\n $$\n\n\u4ee4 $u(x,y)=g(y)^{s(x)}g(x)^{s(y)}$ \uff0c\u539f\u5f0f\u5316\u4e3a\uff1a\n\n$$\n \\begin{aligned}\n &\\Rightarrow\\prod\\limits_{T=1}^n(\\prod\\limits_{d\\mid T}(u(\\lfloor\\frac{n}{T}\\rfloor,\\lfloor\\frac{m}{T}\\rfloor)(dT)^{s(\\lfloor\\frac{n}{T}\\rfloor)s(\\lfloor\\frac{m}{T}\\rfloor)})^{d\\mu(d)})^T\n \\\\&=\\prod\\limits_{T=1}^n(u(\\lfloor\\frac{n}{T}\\rfloor,\\lfloor\\frac{m}{T}\\rfloor)^{\\sum\\limits_{d\\mid T}d\\mu(d)}(T^{\\sum\\limits_{d'\\mid T}d'\\mu(d')}\\prod\\limits_{t\\mid T}t^{t\\mu(t)})^{s(\\lfloor\\frac{n}{T}\\rfloor)s(\\lfloor\\frac{m}{T}\\rfloor)})^T\n \\end{aligned}\n $$\n\n\u4ee4 $h(x)=\\sum\\limits_{d\\mid x}d\\mu(d),v(x)=\\prod\\limits_{d\\mid x}d^{d\\mu(d)}$ \uff0c\u539f\u5f0f\u5316\u4e3a\uff1a\n\n$$\n \\begin{aligned}\n &\\Rightarrow\\prod\\limits_{T=1}^n(u(\\lfloor\\frac{n}{T}\\rfloor,\\lfloor\\frac{m}{T}\\rfloor)^{h(T)}(T^{h(T)}v(T))^{s(\\lfloor\\frac{n}{T}\\rfloor)s(\\lfloor\\frac{m}{T}\\rfloor)})^T\n \\\\&=\\prod\\limits_{T=1}^nu(\\lfloor\\frac{n}{T}\\rfloor,\\lfloor\\frac{m}{T}\\rfloor)^{Th(T)}((T^{h(T)}v(T))^T)^{s(\\lfloor\\frac{n}{T}\\rfloor)s(\\lfloor\\frac{m}{T}\\rfloor)}\n \\end{aligned}\n $$\n\n\u518d\u4ee4 $H(x)=xh(x),V(x)=(x^{h(x)}v(x))^x$ \uff0c\u539f\u5f0f\u6700\u540e\u53d8\u4e3a: \n\n$$\n \\begin{aligned}\n\\prod\\limits_{T=1}^nu(\\lfloor\\frac{n}{T}\\rfloor,\\lfloor\\frac{m}{T}\\rfloor)^{H(T)}V(T)^{s(\\lfloor\\frac{n}{T}\\rfloor)s(\\lfloor\\frac{m}{T}\\rfloor)}\n \\end{aligned}\n $$\n\n\u6b64\u65f6\u4fbf\u53ef\u4ee5\u4f5c\u524d\u7f00\u548c\u4e0e\u524d\u7f00\u79ef\u5904\u7406\uff0c\u7136\u540e\u5c31\u80fd\u6109\u5feb\u5730\u8fdb\u884c\u6570\u8bba\u5206\u5757\u4e86\uff5e \n\u4ee3\u7801\u603b\u7684\u590d\u6742\u5ea6\u5e94\u8be5\u4e3a $O(n\\log n+T\\sqrt{n}(\\log n+\\log M))$ \uff1f\n\n```cpp\n#include<iostream>\n#include<bitset>\n#include<cmath>\nusing namespace std;\ntypedef long long ll;\n#define debug(x) cerr<<#x<<\":\"<<x<<endl\n#define debug2(x,y) cerr<<#x<<\":\"<<x<<\"  \"<<#y<<\":\"<<y<<endl\n#define debug3(x,y,z) cerr<<#x<<\":\"<<x<<\"  \"<<#y<<\":\"<<y<<\"  \"<<#z<<\":\"<<z<<endl\nconst ll N=1e7+5,M=32465177,_N=666666;\nll cnt=0;\nint prime[_N],g[N],h[N],v[N];\nbitset<N> vis;\ninline ll mabs(ll x){\n    if(abs(x)>=M) x%=M;\n    if(x<0) x+=M;\n    return x;\n}\nll qpow(ll a,ll b){\n    ll res=1;\n    a%=M;\n    b%=M-1;\n    if(b<0) b+=M-1;\n    while(b){\n        if(b&1) res=mabs(a*res);\n        b>>=1;\n        a=mabs(a*a);\n    }\n    return res;\n}\ninline ll inv(ll x){return qpow(x,M-2);}\nvoid pre(ll n){\n    g[0]=v[0]=g[1]=h[1]=v[1]=1;\n    h[0]=0;\n    for(int i=2;i<=n;++i){\n        g[i]=mabs((ll)g[i-1]*qpow(i,i));\n        if(!vis[i]){\n            prime[cnt++]=i;\n            h[i]=-i;\n            v[i]=qpow(i,h[i]);\n        }\n        for(int j=0;i*prime[j]<=n;++j){\n            int t=i*prime[j];\n            vis[t]=1;\n            if(i%prime[j]){\n                if(!h[i]) h[t]=0;\n                else if(h[i]>0) h[t]=-t;\n                else h[t]=t;\n                v[t]=qpow(t,h[t]);\n            }\n            else{\n                h[t]=0;\n                v[t]=1;\n                break;\n            }\n        }\n    }\n    for(int i=0;i<cnt;++i){\n        for(int j=1;j*prime[i]<=n;++j){\n            h[j*prime[i]]=(((ll)h[j*prime[i]]+(ll)h[j])%(M-1)+(M-1))%(M-1);\n            v[j*prime[i]]=mabs((ll)v[j*prime[i]]*(ll)v[j]);\n        }\n    }\n    for(ll i=2;i<=n;++i){\n        ll t=mabs((ll)v[i]*qpow(i,h[i]));\n        v[i]=qpow(t,i);\n        v[i]=mabs((ll)v[i]*(ll)v[i-1]);\n        h[i]=(((ll)h[i-1]+(ll)i*(ll)h[i])%(M-1)+(M-1))%(M-1);\n    }\n}\ninline ll s(ll x){return ((x*(x+1))>>1)%(M-1);}\ninline ll u(ll x,ll y){return mabs(qpow(g[x],s(y))*qpow(g[y],s(x)));}\nll solve(ll n,ll m){\n    ll res=1;\n    for(ll l=1,r;l<=min(n,m);l=r+1){\n        r=min(n/(n/l),m/(m/l));\n        ll t1=mabs((ll)v[r]*inv(v[l-1])),t2=qpow(u(n/l,m/l),h[r]-h[l-1]);\n        t1=qpow(t1,s(n/l)*s(m/l));\n        res=mabs(mabs(t1*t2)*res);\n    }\n    return res;\n}\nint main(){\n    ll t,n,l,r;\n    cin>>t>>n;\n    pre(n);\n    while(t--){\n        cin>>l>>r;\n        ll t1=mabs(solve(r,r)*solve(l-1,l-1)),t2=mabs(inv(solve(r,l-1))*inv(solve(l-1,r)));\n        ll res=mabs(t1*t2);\n        cout<<res<<endl;\n    }\n}\n```",
        "postTime": 1621514106,
        "uid": 417142,
        "name": "Benzaiten",
        "ccfLevel": 0,
        "title": "\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u597d\u9898"
    },
    {
        "content": "[\u6d1b\u8c37\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P7486)\u3002\n\n\u9898\u610f\uff1a\n\n* $T$ \u6b21\u8be2\u95ee $\\prod\\limits_{i=l}^r\\prod\\limits_{j=l}^r \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i,j)} \\bmod 32465177$\u3002\n\n* $1 \\le l \\le r \\le n \\le 10^6$\uff0c$T \\le 10$\u3002\n\n\u6765\u9053\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u9898\u7ec3\u7ec3\u63a8\u5f0f\u5b50\u624b\u611f\u3002\n\n---\n\nSolution\uff1a\n\n\u53ef\u4ee5\u5bb9\u65a5\u8f6c\u5316\u4e3a\u7b97 \n\n$$\\begin{aligned}\n\\prod\\limits_{i=1}^n\\prod\\limits_{j=1}^m \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i,j)}\n\\end{aligned}$$\n\n\u4e0d\u59a8\u8bbe $n \\le m$\u3002\n\n$$\\begin{aligned}\n&=\\prod_{d=1}^n\\prod_{i=1}^n\\prod_{j=1}^m\\left(\\dfrac{ij}{d}\\right)^{\\frac{ij}{d}[\\gcd(i, j)=d]}\n\\\\&=\\prod_{d=1}^n\\prod_{i=1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor}\\prod_{j=1}^{\\left\\lfloor\\frac{m}{d}\\right\\rfloor}(ijd)^{ijd[\\gcd(i, j)=1]}\n\\\\&=\\prod_{d=1}^n\\prod_{i=1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor}\\prod_{j=1}^{\\left\\lfloor\\frac{m}{d}\\right\\rfloor}(ijd)^{ijd\\sum\\limits_{k\\mid \\gcd(i, j)}\\mu(k)}\n\\\\&=\\prod_{d=1}^n\\prod_{k=1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor}\\prod_{i=1}^{\\left\\lfloor\\frac{n}{kd}\\right\\rfloor}\\prod_{j=1}^{\\left\\lfloor\\frac{m}{kd}\\right\\rfloor}(ijk^2d)^{ijk^2d\\mu(k)}\n\\\\&=\\prod_{T=1}^n\\prod_{k\\mid T}\\prod_{i=1}^{\\left\\lfloor\\frac{n}{T}\\right\\rfloor}\\prod_{j=1}^{\\left\\lfloor\\frac{m}{T}\\right\\rfloor}(ijkT)^{ijkT\\mu(k)}\n\\end{aligned}$$\n\n\u5230\u8fd9\u91cc\u6211\u4eec\u5df2\u7ecf\u53d1\u73b0\u6709\u5f88\u591a\u91cf\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u4e86\u3002\n\n\u5177\u4f53\u5730\uff0c\u8bbe\uff1a\n\n$$S(n) = \\sum_{i=1}^ni= \\dfrac{n(n+1)}{2}$$\n\n$$f(n) = \\prod_{i=1}^n i^i$$\n\n$$F(n, m)=\\prod_{i=1}^n\\prod_{j=1}^m (ij)^{ij} = f(n)^{S(m)}\\cdot f(m)^{S(n)}$$\n\n$$g(n) = \\sum_{k\\mid n} k\\mu(k)$$\n\n$$h(n) = n^{g(n)}\\cdot\\prod_{k\\mid n}k^{k\\mu(k)}$$\n\n\u4e8e\u662f\u4e0a\u5f0f\u5c31\u88ab\u6211\u4eec\u5316\u7b80\u4e3a\uff1a\n\n$$\\prod_{T=1}^n \\left(F(\\left\\lfloor\\frac{n}{T}\\right\\rfloor, \\left\\lfloor\\frac{m}{T}\\right\\rfloor)^{Tg(T)}\\cdot h(T)^{T\\cdot S(\\left\\lfloor\\frac{n}{T}\\right\\rfloor)S(\\left\\lfloor\\frac{m}{T}\\right\\rfloor)}\\right)$$\n\n\u8fd9\u4e9b\u51fd\u6570\u53ca\u5176\u524d\u7f00\u548c/\u79ef\u90fd\u53ef\u4ee5\u9884\u5904\u7406\uff0c\u7136\u540e\u76f4\u63a5\u4e0a\u6570\u8bba\u5206\u5757\u3002\n\nover\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}(n(\\log n + \\log p) + t\\sqrt n (\\log n + \\log p))$\u3002\n\n---\n\nCode\uff1a\n\n```cpp\n#include <cstdio>\n#include <algorithm>\nusing namespace std;\n#define rep(i, x, y) for(int i = x; i <= y; ++i)\ninline int read(){\n    int x = 0, f = 1; char ch = getchar();\n    while(ch < '0' || ch > '9'){ if(ch == '-') f = -1; ch = getchar(); }\n    while(ch >= '0' && ch <= '9'){ x = x * 10 + (ch ^ 48); ch = getchar(); }\n    return x * f;\n}\nconst int N = 1000010, mod = 32465177;\nint T, n, L, R, pri[N], len, mu[N], f[N], g[N], h[N], G[N], H[N]; bool vis[N];\ninline int fpow (int x, int p){\n\tint ans = 1;\n\tfor(; p; p >>= 1, x = 1ll * x * x % mod) if(p & 1) ans = 1ll * ans * x % mod;\n\treturn ans;\n}\ninline void sieve(int n){\n\tmu[1] = f[1] = g[1] = h[1] = H[0] = 1; G[0] = 0;\n\trep(i, 2, n){\n\t\tif(!vis[i]) pri[++len] = i, mu[i] = -1, g[i] = mod - i;\n\t\tfor(int j = 1; j <= len && i * pri[j] <= n; ++j){\n\t\t\tvis[i * pri[j]] = 1;\n\t\t\tif(i % pri[j] == 0){\n\t\t\t\tmu[i * pri[j]] = 0;\n\t\t\t\tg[i * pri[j]] = g[i];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmu[i * pri[j]] = -mu[i];\n\t\t\tg[i * pri[j]] = 1ll * g[i] * g[pri[j]] % (mod - 1);\n\t\t}\n\t}\n\tf[0] = 1; h[0] = 1; rep(i, 1, n) f[i] = 1ll * f[i - 1] * fpow(i, i) % mod, h[i] = 1;\n\trep(i, 1, n) rep(j, 1, n / i) h[i * j] = 1ll * h[i * j] * fpow(i, i * mu[i] + mod - 1) % mod;\n\trep(i, 1, n) G[i] = 1ll * i * g[i] % (mod - 1), H[i] = fpow(1ll * fpow(i, g[i]) * h[i] % mod, i);\n\trep(i, 2, n) G[i] = (G[i] + G[i - 1]) % (mod - 1), H[i] = 1ll * H[i] * H[i - 1] % mod;\n}\ninline int S(int n){ return 1ll * n * (n + 1) / 2 % (mod - 1); }\ninline int F(int n, int m){ return 1ll * fpow(f[n], S(m)) * fpow(f[m], S(n)) % mod; }\ninline int calc(int n, int m){\n\tint ans = 1;\n\tfor(int i = 1, j; i <= n; i = j + 1){\n\t\tj = min(n / (n / i), m / (m / i));\n\t\tint A = fpow(F(n / i, m / i), (G[j] - G[i - 1] + mod - 1) % (mod - 1));\n\t\tint B = fpow(1ll * H[j] * fpow(H[i - 1], mod - 2) % mod, 1ll * S(n / i) * S(m / i) % (mod - 1));\n\t\tans = 1ll * ans * A % mod * B % mod;\n\t}\n\treturn ans;\n}\ninline int solve(int n, int m){\n\tint A = calc(n - 1, n - 1), B = calc(m, m), C = calc(n - 1, m);\n\treturn 1ll * A * B % mod * fpow(1ll * C * C % mod, mod - 2) % mod;\n}\ninline void mian(){\n\tT = read(); n = read(); sieve(n);\n\trep(i, 1, T){\n\t\tL = read(); R = read();\n\t\tprintf(\"%d\\n\", solve(L, R));\n\t}\n\treturn;\n}\nint main(){ int qwq = 1; while(qwq--) mian(); return 0; }\n```\n",
        "postTime": 1684380731,
        "uid": 147999,
        "name": "Warriors_Cat",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7486\u3010\u300cStoi2031\u300d\u5f69\u8679\u3011"
    },
    {
        "content": "~~\u6211\u662f\u770b\u9898\u76ee\u540d\u624d\u505a\u7684~~\n\n### \u9898\u610f\n\n- \u7ed9\u5b9a\u6b63\u6574\u6570 $n$\uff0c$T$ \u6b21\u8be2\u95ee\u3002\u6bcf\u6b21\u8be2\u95ee\u7ed9\u5b9a $l,r$\uff0c\u6c42\n- $$\\prod_{i=l}^r\\prod_{j=l}^r\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}$$\n- $1\\le{n}\\le{10^6},1\\le T\\le10,1\\le{l_i}\\le{r_i}\\le{n}$\u3002\u7b54\u6848\u5bf9 $32465177$ \u53d6\u6a21\u3002\n\n### \u505a\u6cd5\n\n\u6211\u4eec\u8003\u8651\u7528 **\u5bb9\u65a5** \u6765\u505a\u3002\u4ee4 $S(x,y)$ \u8868\u793a $\\displaystyle\\prod_{i=1}^x\\prod_{j=1}^y\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}$\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/g6l4sz58.png)\n\n\u753b\u7c7b\u4f3c\u4e0a\u9762\u7684\u56fe\uff08\u7d2b\u8272\u8868\u793a\u8981\u7684\uff0c\u5176\u4ed6\u4e24\u79cd\u989c\u8272\u8868\u793a\u591a\u7b97\u7684\uff0c\u8981\u9664\u6389\uff09\uff0c\u7a0d\u5fae\u63a8\u4e00\u4e0b\u5f0f\u5b50\uff0c\u5c31\u6709\uff1a\n\n$$\\begin{aligned}\\prod_{i=l}^r\\prod_{j=l}^r\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}&=\\frac{S(r,r)}{\\displaystyle\\prod_{i=1}^r\\prod_{j=1}^{l-1}\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}\\prod_{i=1}^{l-1}\\prod_{j=l}^r\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}}\\\\&=\\frac{\\displaystyle S(r,r)\\times{\\prod_{i=1}^{l-1}\\prod_{j=1}^{l-1}\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}}}{\\displaystyle S(r,l-1)\\prod_{i=1}^{l-1}\\prod_{j=1}^r\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}}\\\\&=\\frac{S(r,r)S(l-1,l-1)}{S\\left(r,l-1\\right){S(l-1,r)}}\\end{aligned}$$\n\n\u663e\u7136 $S(x,y)=S(y,x)$\uff0c\u6240\u4ee5\u4e0d\u59a8\u4ee4 $x\\le{y}$\u3002\u7136\u540e\u5c31\u662f\u5f88~~\u6ca1~~\u6709\u7075\u9b42\u7684\u63a8\u5f0f\u5b50\uff1a\n\n$$\\begin{aligned}S(x,y)&=\\prod_{i=1}^x\\prod_{j=1}^y\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}\\\\&=\\prod_{i=1}^x\\prod_{j=1}^y\\left(\\frac{ij}{\\gcd(i,j)}\\right)^{\\frac{ij}{\\gcd{i,j}}}\\\\&=\\prod_{d}\\prod_{i=1}^x\\prod_{j=1}^y\\left(\\frac{ij}d\\right)^{\\frac{ij\\left[\\gcd(i,j)=d\\right]}{d}}&\\color{pink}\\text{\u679a\u4e3e }\\gcd\\\\&=\\prod_{d}\\prod_{i=1}^{\\left\\lfloor\\frac{x}d\\right\\rfloor}\\prod_{j=1}^{\\left\\lfloor\\frac{y}{d}\\right\\rfloor}\\left(ijd\\right)^{ijd\\left[\\gcd(i,j)=1\\right]}&\\color{pink}\\text{\u679a\u4e3e }\\frac{i}d,\\frac{j}d\\\\&=\\prod_{d}\\prod_{i=1}^{\\left\\lfloor\\frac{x}d\\right\\rfloor}\\prod_{j=1}^{\\left\\lfloor\\frac{y}d\\right\\rfloor}(ijd)^{ijd\\sum_{k\\mid{\\gcd(i,j)}}\\mu(k)}&\\color{pink}\\text{\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14}\\\\&=\\prod_{d}\\prod_{i=1}^{\\left\\lfloor\\frac{x}d\\right\\rfloor}\\prod_{j=1}^{\\left\\lfloor\\frac{y}d\\right\\rfloor}\\prod_{k\\mid{\\gcd(i,j)}}(ijd)^{ijd\\mu(k)}\\\\&=\\prod_{d}\\prod_{k=1}^{\\left\\lfloor\\frac{x}d\\right\\rfloor}\\prod_{i=1}^{\\left\\lfloor\\frac{x}{dk}\\right\\rfloor}\\prod_{j=1}^{\\left\\lfloor\\frac{y}{dk}\\right\\rfloor}{ijdk^2}^{ijdk^2\\mu(k)}\\\\&=\\prod_{t}\\prod_{k\\mid{t}}\\prod_{i=1}^{\\left\\lfloor\\frac{x}t\\right\\rfloor}\\prod_{j=1}^{\\left\\lfloor\\frac{y}t\\right\\rfloor}(ijkt)^{ijkt\\mu(k)}\\\\&=\\prod_{t}\\prod_{k\\mid{t}}\\left[{\\left(\\prod_{i=1}^{\\left\\lfloor\\frac{x}t\\right\\rfloor}\\prod_{j=1}^{\\left\\lfloor\\frac{y}t\\right\\rfloor}(ijkt)^{ij}\\right)^{k\\mu(k)}}\\right]^t\\end{aligned}$$\n\n\u5316\u7b80\u540e\u9762 $\\left[\\quad\\right]$ \u4e2d\u7684\u3002\u4ee4 $f(n)=\\sum_{i=1}^n i,g(n)=\\prod_{i=1}^n i^i,h(n,m)=\\prod_{i=1}^n\\prod_{j=1}^m(ij)^{ij}$\uff0c$f(n)$ \u76f4\u63a5 $O(1)$ \u8ba1\u7b97\uff1b$g(n)$ \u53ef\u4ee5 $O(n\\log{n})$ \u9884\u5904\u7406\uff1b$h(n)$ \u53ef\u4ee5 $O(\\log{p})$ \u5feb\u901f\u5e42\u8ba1\u7b97\u3002\u5219\uff1a\n\n$$\\begin{aligned}h(n,m)&=\\prod_{i=1}^n\\prod_{j=1}^m(ij)^{ij}\\\\&=\\prod_{i=1}^n\\prod_{j=1}^mi^{ij}\\cdot\\prod_{i=1}^n\\prod_{j=1}^mj^{ij}\\\\&=\\prod_{i=1}^ni^{i\\sum_{k=1}^mk}\\cdot\\prod_{i=1}^mi^{i\\sum_{k=1}^nk}\\\\&=\\left(\\prod_{i=1}^ni^i\\right)^{\\sum_{k=1}^mk}\\left(\\prod_{i=1}^mi^i\\right)^{\\sum_{k=1}^nk}\\\\&=g(n)^{f(m)}\\cdot g(m)^{f(n)} \\end{aligned}$$\n\n\u518d\u770b $\\prod_{i=1}^n\\prod_{j=1}^m(kt)^{ij}=kt^{f(n)f(m)}$\u3002\u4ee3\u56de\u539f\u5f0f\uff1a\n\n$$\\begin{aligned}&=\\prod_{t}\\prod_{k\\mid{t}}\\left[\\left(h\\left(\\left\\lfloor\\frac{x}t\\right\\rfloor,\\left\\lfloor\\frac{y}t\\right\\rfloor\\right)(kt)^{f\\left(\\left\\lfloor\\frac{x}t\\right\\rfloor\\right)f\\left(\\left\\lfloor\\frac{y}t\\right\\rfloor\\right)}\\right)^{k\\mu(k)}\\right]^t\\\\&=\\prod_{t}\\prod_{k\\mid{t}}\\left[h\\left(\\left\\lfloor\\frac{x}t\\right\\rfloor,\\left\\lfloor\\frac{y}t\\right\\rfloor\\right)^{k\\mu(k)}k^{f\\left(\\left\\lfloor\\frac{x}t\\right\\rfloor\\right)f\\left(\\left\\lfloor\\frac{y}t\\right\\rfloor\\right)k{\\mu(k)}}t^{f\\left(\\left\\lfloor\\frac{x}t\\right\\rfloor\\right)f\\left(\\left\\lfloor\\frac{y}t\\right\\rfloor\\right)k{\\mu(k)}}\\right]^t\\end{aligned}$$\n\n\u4ee4 $\\lambda(n)=\\sum_{d\\mid{n}}d\\mu(d),\\eta(n)=\\prod_{d\\mid{n}}d^{d\\mu(d)},\\beta(n)=\\left(\\eta(n)\\cdot{n^{\\lambda(n)}}\\right)^n$\uff0c\u5176\u4e2d $d\\mu(d),d^{d\\mu(d)}$ \u5728\u7ebf\u6027\u7b5b\u4e2d\u6c42\u51fa\uff0c\u4e0d\u8fc7\u8fd9\u6837\u7ebf\u6027\u7b5b\u4f1a\u53d8\u6210 $O(n\\log{p})$ \u7684\uff0c\u7136\u540e $O(n\\log{n})$ \u679a\u4e3e\u56e0\u5b50\uff0c\u6c42\u51fa $\\lambda,\\eta$\uff0c\u4e4b\u540e $O(n\\log{p})$ \u6c42\u51fa $\\beta$\u3002\u5219\uff1a\n\n$$=\\prod_{t}h\\left(\\left\\lfloor\\frac{x}t\\right\\rfloor,\\left\\lfloor\\frac{y}t\\right\\rfloor\\right)^{\\lambda(t)t}\\cdot\\beta(t)^{f\\left(\\left\\lfloor\\frac{x}t\\right\\rfloor\\right)f\\left(\\left\\lfloor\\frac{y}t\\right\\rfloor\\right)}$$\n\n\u7136\u540e\u6570\u8bba\u5206\u5757\u5c31\u53ef\u4ee5\u4e86\u3002\u6ce8\u610f\u524d\u9762\u4e00\u90e8\u5206\u5728\u4e00\u5757\u4e2d\u7684\u5e95\u6570\u662f\u76f8\u540c\u7684\uff0c\u6211\u4eec\u9884\u5904\u7406 $\\lambda(t)t$ \u7684\u524d\u7f00\u548c\u5c31\u597d\u4e86\uff1b\u540e\u9762\u4e00\u90e8\u5206\u5728\u4e00\u5757\u4e2d\u8d28\u6570\u662f\u76f8\u540c\u7684\uff0c\u6211\u4eec\u9884\u5904\u7406 $\\beta(t)$ \u7684\u524d\u7f00\u79ef\u5c31\u597d\u4e86\u3002\n\n\u6211\u4eec\u7684\u6570\u8bba\u5206\u5757\u662f $O(\\sqrt{n}\\log{p})$ \u7684\u3002\u6700\u540e\u7684\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O\\left(n\\log{p}+n\\log{n}+t\\sqrt{n}\\log{p}+t\\log{p}\\right)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define FOR(i,j,k)  for(int i=(j);i<=(k);i++)\nusing namespace std;\n#define mod 32465177\nint n,tc;\nint g[1000006],k1[1000006],k2[1000006],lamb[1000006],eta[1000006],beta[1000006],mu[1000006],slmb[1000006],sbta[1000006];\nint prime[1000006],cnt,invs[1000006];\nbitset<1000006>used;\ninline int read()\n{\n\tint x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')f=-f;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=x*10+c-'0';c=getchar();}\n\treturn x*f;\n}\ninline int qp(int x,int y)\n{\n\tint res=1,p=x;\n\twhile(y)\n\t{\n\t\tif(y&1)\tres=1ll*res*p%mod;\n\t\tp=1ll*p*p%mod;y>>=1;\n\t}\n\treturn res;\n}\ninline int inv(int x){return qp(x,mod-2);}\ninline void sieve(int n)\n{\n\tg[1]=mu[1]=k1[1]=k2[1]=eta[1]=beta[1]=1;\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\teta[i]=1,g[i]=1ll*g[i-1]*qp(i,i%(mod-1))%mod;\n\t\tif(!used[i])\tprime[++cnt]=i,mu[i]=-1;\n\t\tk1[i]=(i*mu[i]%(mod-1)+mod-1)%(mod-1);k2[i]=qp(i,k1[i]);\n\t\tfor(int j=1;j<=cnt&&1ll*i*prime[j]<=n;j++)\n\t\t{\n\t\t\tused[i*prime[j]]=true;\n\t\t\tif(i%prime[j])\tmu[i*prime[j]]=-mu[i];\n\t\t\telse\tbreak;\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=i;j<=n;j+=i)\n\t\t\tlamb[j]=(lamb[j]+k1[i])%(mod-1),eta[j]=1ll*eta[j]*k2[i]%mod;\n\tinvs[0]=sbta[0]=1;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tslmb[i]=(slmb[i-1]+1ll*lamb[i]*i%(mod-1))%(mod-1);\n\t\tbeta[i]=qp(1ll*eta[i]*qp(i,lamb[i])%mod,i%(mod-1));\n\t\tsbta[i]=1ll*beta[i]*sbta[i-1]%mod;\n\t\tinvs[i]=inv(sbta[i]);\n\t}\n}\n\ninline int gets(int x){return 1ll*x*(x+1)/2%(mod-1);}\ninline int getb(int l,int r){return 1ll*sbta[r]*invs[l-1]%mod;}\ninline int getl(int l,int r){return (slmb[r]-slmb[l-1]+mod-1)%(mod-1);}\ninline int geth(int l,int r){return 1ll*qp(g[l],gets(r))*qp(g[r],gets(l))%mod;}\ninline int S(int n,int m)\n{\n\tif(n>m)\tswap(n,m);\n\tint res=1;\n\tfor(int l=1,r;l<=n;l=r+1)\n\t{\n\t\tr=min(n/(n/l),m/(m/l));\n\t\tres=1ll*res*qp(geth(n/l,m/l),getl(l,r))%mod*qp(getb(l,r),1ll*gets(n/l)*gets(m/l)%(mod-1))%mod;\n\t}\n\treturn res;\n}\nint main()\n{\n\ttc=read(),n=read();\n\tsieve(n);\n\twhile(tc--)\n\t{\n\t\tint l=read(),r=read();\n\t\tint a=1ll*S(r,r)*S(l-1,l-1)%mod,b=S(l-1,r);b=1ll*b*b%mod;\n\t\tprintf(\"%d\\n\",1ll*a*inv(b)%mod);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1643780313,
        "uid": 181775,
        "name": "_Fontainebleau_",
        "ccfLevel": 0,
        "title": "\u300c \u5f69\u8679 \u300d"
    },
    {
        "content": "\u57fa\u7840\u83ab\u53cd\u63a8\u5f0f\u5b50\u9898\u3002\n\n\u663e\u7136\u9898\u76ee\u8981\u6c42\u7684\u5f0f\u5b50\n\n$$\\begin{aligned}\n\\prod_{i=1}^n \\prod_{j=1}^m \\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}&=\\prod_d \\prod_{i=1}^n \\prod_{j=1}^m \\left( \\dfrac{ij}{d} \\right)^{\\frac{ij\\left[ \\gcd(i,j)=d \\right]}{d}}\\\\\n&=\\prod_d \\prod_{i=1}^{\\left\\lfloor \\frac{n}{d} \\right\\rfloor} \\prod_{j=1}^{\\left\\lfloor \\frac{m}{d} \\right\\rfloor} \\left( ijd \\right)^{ijd\\left[ \\gcd(i,j)=1 \\right]}\\\\\n&=\\prod_d \\left( d^d \\right)^{\\sum_{i=1}^{\\left\\lfloor \\frac{n}{d} \\right\\rfloor} \\sum_{j=1}^{\\left\\lfloor \\frac{m}{d} \\right\\rfloor}ij\\left[ \\gcd(i,j)=1 \\right]} \\left( \\prod_{i=1}^{\\left\\lfloor \\frac{n}{d} \\right\\rfloor} \\prod_{j=1}^{\\left\\lfloor \\frac{m}{d} \\right\\rfloor} (ij)^{ij\\left[ \\gcd(i,j)=1 \\right]} \\right)^{d},\n\\end{aligned}$$\n\n\u8bbe\u4e3a\n\n$$\\prod_d \\left( d^d \\right)^{Sum \\left( \\left\\lfloor \\frac{n}{d} \\right\\rfloor,\\left\\lfloor \\frac{m}{d} \\right\\rfloor \\right)} \\left( Pro \\left( \\left\\lfloor \\frac{n}{d} \\right\\rfloor,\\left\\lfloor \\frac{m}{d} \\right\\rfloor \\right) \\right)^{d}$$\n\n\u5176\u4e2d\n\n$$\\begin{aligned}\nSum \\left( n,m \\right)&=\\sum_{i=1}^n \\sum_{j=1}^m ij\\left[ \\gcd(i,j)=1 \\right]\\\\\n&=\\sum_d d^2 \\mu \\left( d \\right) \\sum_{i=1}^{\\left\\lfloor \\frac{n}{d} \\right\\rfloor} \\sum_{j=1}^{\\left\\lfloor \\frac{m}{d} \\right\\rfloor}ij\n\\end{aligned}$$\n\n\u53ef\u4ee5\u901a\u8fc7 P1829 \u91cc\u4e00\u6837\u7684\u65b9\u5f0f\u89e3\u51b3\uff0c$O \\left( \\sqrt{n} \\right)$\u3002\n\n$$\\begin{aligned}\nPro \\left( n,m \\right)&=\\prod_{i=1}^n \\prod_{j=1}^m (ij)^{ij\\left[ \\gcd(i,j)=1 \\right]}\\\\\n&=\\prod_{i=1}^n \\prod_{j=1}^m (ij)^{ij\\sum_{d\\mid\\gcd(i,j)}\\mu(d)}\\\\\n&=\\prod_d \\left( \\prod_{i=1}^n \\prod_{j=1}^m (ij)^{ij[d\\mid\\gcd(i,j)]} \\right)^{\\mu(d)}\\\\\n&=\\prod_d \\left( \\prod_{i=1}^{\\left\\lfloor \\frac{n}{d} \\right\\rfloor} \\prod_{j=1}^{\\left\\lfloor \\frac{m}{d} \\right\\rfloor} (d^2ij)^{d^2ij} \\right)^{\\mu(d)}\\\\\n&=\\prod_d \\left[ \\left( d^2 \\right)^{\\sum_{i=1}^{\\left\\lfloor \\frac{n}{d} \\right\\rfloor} \\sum_{j=1}^{\\left\\lfloor \\frac{m}{d} \\right\\rfloor}ij} \\right]^{d^2\\mu(d)} \\left[ \\prod_{i=1}^{\\left\\lfloor \\frac{n}{d} \\right\\rfloor} \\prod_{j=1}^{\\left\\lfloor \\frac{m}{d} \\right\\rfloor} (ij)^{ij} \\right]^{d^2\\mu(d)}.\n\\end{aligned}$$\n\n\u5b9a\u4e49\n\n$$f(x)=\\prod_{i=1}^xi^i$$\n\n\u5219\u663e\u7136\u53ef\u4ee5 $O \\left( n\\log{n} \\right)$ \u9884\u5904\u7406\u3002\n\n\u6b64\u65f6\n\n$$Pro(n,m)=\\prod_d \\left[ \\left( d^2 \\right)^{\\sum_{i=1}^{\\left\\lfloor \\frac{n}{d} \\right\\rfloor} \\sum_{j=1}^{\\left\\lfloor \\frac{m}{d} \\right\\rfloor}ij} \\right]^{d^2\\mu(d)} \\left[ f\\left( \\left\\lfloor \\frac{n}{d} \\right\\rfloor \\right)^{\\frac{\\left\\lfloor \\frac{m}{d} \\right\\rfloor \\times \\left( \\left\\lfloor \\frac{m}{d} \\right\\rfloor +1 \\right)}{2}} f\\left( \\left\\lfloor \\frac{m}{d} \\right\\rfloor \\right)^{\\frac{\\left\\lfloor \\frac{n}{d} \\right\\rfloor \\times \\left( \\left\\lfloor \\frac{n}{d} \\right\\rfloor +1 \\right)}{2}} \\right]^{d^2\\mu(d)}$$\n\n\u53ef\u4ee5\u5728 $O \\left( \\sqrt{n}\\log n \\right)$ \u65f6\u95f4\u5185\u8ba1\u7b97\u3002\n\n\u518d\u5957\u56de\u53bb\n\n$$\\prod_d \\left( d^d \\right)^{Sum \\left( \\left\\lfloor \\frac{n}{d} \\right\\rfloor,\\left\\lfloor \\frac{m}{d} \\right\\rfloor \\right)} \\left( Pro \\left( \\left\\lfloor \\frac{n}{d} \\right\\rfloor,\\left\\lfloor \\frac{m}{d} \\right\\rfloor \\right) \\right)^{d}$$\n\n\u5c31\u53ef\u4ee5\u5728\u7b97\u51fa $Sum$ \u548c $Pro$ \u540e\u8ba1\u7b97\u7b54\u6848\u4e86\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O \\left(n\\log n+tn^{\\frac{3}{4}} \\log n \\right)$\u3002\u8fd8\u53ef\u4ee5\u4f7f\u7528 `map` \u5b58\u50a8\u5df2\u7ecf\u8ba1\u7b97\u7684\u7b54\u6848\u4ee5\u907f\u514d\u91cd\u590d\u8ba1\u7b97 $l,r$ \u5f88\u5927\u7684\u8be2\u95ee\uff0c\u6216\u66b4\u529b\u5904\u7406 $r-l$ \u8f83\u5c0f\u4f46 $l,r$ \u5f88\u5927\u7684\u8be2\u95ee\uff0c\u4f46\u6ca1\u6709\u5fc5\u8981\uff0c\u56e0\u4e3a std \u61d2\u5f97\u8fd9\u4e48\u5e72\uff08\n\nCode:\n```cpp\n#include<cstdio>\n#define rg register\n#define ll long long\n#define min(a,b) ((a<b)?a:b)\nconst int ntf=32465177;\nconst int NtF=32465176;\nll pd[1000003];\nll pm[1000003];\nll mu[1000003];\nint mp[1000003];\nint pr[1000003],cnt;\ninline ll qpw(ll x,int v)\n{\n\tll r=1;\n\twhile(v)\n\t{\n\t\t(v&1)&&(r=r*x%ntf);\n\t\tx=x*x%ntf,v>>=1;\n\t}\n\treturn r;\n}\ninline void prework(int n)\n{\n\tmu[1]=1;pd[0]=pd[1]=1,pm[0]=pm[1]=1;\n\tfor(rg int i=2;i<=n;++i)\n\t{\n\t\tif(!mp[i])\n\t\t{\n\t\t\tmp[i]=i,mu[i]=-1,pr[++cnt]=i;\n\t\t}\n\t\tfor(rg int j=1;j<=cnt&&(i*pr[j])<=n;++j)\n\t\t{\n\t\t\tmp[i*pr[j]]=pr[j];\n\t\t\tif(mp[i]==pr[j])\n\t\t\t{\n\t\t\t\tmu[i*pr[j]]=0;break;\n\t\t\t}\n\t\t\tmu[i*pr[j]]=-mu[i];\n\t\t}\n\t\tmu[i]=(mu[i]*i*i%NtF+NtF)%NtF;\n\t}\n\tfor(rg int i=2;i<=n;++i)\n\t{\n\t\tpd[i]=pd[i-1]*qpw(i,i)%ntf;\n\t\tpm[i]=pm[i-1]*qpw((ll)i*i%ntf,mu[i])%ntf;\n\t\tmu[i]=(mu[i-1]+mu[i])%NtF;\n\t}\n}\ninline ll pt(ll n)\n{\n\treturn (n*(n+1)>>1)%NtF;\n}\ninline ll ps(ll n,ll m)\n{\n\treturn pt(n)*pt(m)%NtF;\n}\ninline ll sum(int n,int m)\n{\n\tll res=0;\n\tfor(rg int i=1,j;i<=n;i=j+1)\n\t{\n\t\tj=min(n/(n/i),m/(m/i));\n\t\tres=(res+(mu[j]-mu[i-1])*ps(n/i,m/i)%NtF+NtF)%NtF;\n\t}\n\treturn res;\n}\ninline ll pro(int n,int m)\n{\n\tll res=1;\n\tfor(rg int i=1,j;i<=n;i=j+1)\n\t{\n\t\tj=min(n/(n/i),m/(m/i));\n\t\tres=res*qpw(pm[j]*qpw(pm[i-1],ntf-2)%ntf,ps(n/i,m/i))%ntf;\n\t\tres=res*qpw(qpw(pd[n/i],pt(m/i))*qpw(pd[m/i],pt(n/i))%ntf,(mu[j]-mu[i-1])%NtF+NtF)%ntf;\n\t}\n\treturn res;\n}\ninline ll solve(int n,int m)\n{\n\tll res=1;\n\tfor(rg int i=1,j;i<=n;i=j+1)\n\t{\n\t\tj=min(n/(n/i),m/(m/i));\n\t\tres=res*qpw(pd[j]*qpw(pd[i-1],ntf-2)%ntf,sum(n/i,m/i))%ntf;\n\t\tres=res*qpw(pro(n/i,m/i),(pt(j)-pt(i-1))%NtF+NtF)%ntf;\n\t}\n\treturn res;\n}\nint t,n,l,r;\nint main()\n{\n\tscanf(\" %d %d\",&t,&n);\n\tprework(n);\n\twhile(t--)\n\t{\n\t\tscanf(\" %d %d\",&l,&r);\n\t\tprintf(\"%lld\\n\",solve(r,r)*solve(l-1,l-1)%ntf*qpw(solve(l-1,r),ntf-3)%ntf);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1616144744,
        "uid": 59388,
        "name": "VinstaG173",
        "ccfLevel": 7,
        "title": "B \u5f69\u8679 \u9898\u89e3"
    },
    {
        "content": "## \u9898\u610f\n$t$ \u7ec4\u8be2\u95ee\uff0c\u6bcf\u7ec4\u7ed9\u5b9a $l,r$\uff0c\u6c42 $\\prod\\limits_{i=l}^r\\prod\\limits_{j=l}^r\\text{lcm}(i,j)^{\\text{lcm}(i,j)}\\bmod {32465177}$\u3002\n## Solution\n\u663e\u7136\u5bb9\u65a5\u62c6\u8be2\u95ee\uff1a\n\n\u8bb0 $s(n,m)=\\prod\\limits_{i=1}^n\\prod\\limits_{j=1}^m\\text{lcm}(i,j)^{\\text{lcm}(i,j)}$\uff0c\u5219\u539f\u5f0f\u8f6c\u5316\u4e3a $\\dfrac{s(r,r)\\times s(l-1,l-1)}{s(r,l-1)\\times s(l-1,r)}$\u3002\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u5927\u529b\u63a8\u5f0f\u5b50\u4e86\u3002\n\n$$\n\\begin{aligned}\ns(n,m)=&\\prod_{i=1}^n\\prod_{j=1}^m\\text{lcm}(i,j)^{\\text{lcm}(i,j)}\\\\\n=&\\prod_{i=1}^n\\prod_{j=1}^m\\Big(\\frac{i\\times j}{\\gcd(i,j)}\\Big)^{\\frac{i\\times j}{\\gcd(i,j)}}\\\\\n=&\\prod_{d\\ge1}\\prod_{i=1}^{\\lfloor\\frac nd\\rfloor}\\prod_{j=1}^{\\lfloor\\frac md\\rfloor}(ijd)^{ijd[\\gcd(i,j)=1]}\\\\\n=&\\prod_{d\\ge1}\\prod_{i=1}^{\\lfloor\\frac nd\\rfloor}\\prod_{j=1}^{\\lfloor\\frac md\\rfloor}(ijd)^{ijd\\sum_{t|\\gcd(i,j)}\\mu(t)}\\\\\n=&\\prod_{d\\ge1}\\prod_{t\\ge1}\\prod_{i=1}^{\\lfloor\\frac n{dt}\\rfloor}\\prod_{j=1}^{\\lfloor\\frac m{dt}\\rfloor}(ijdt^2)^{ijdt^2\\mu(t)}\\\\\n=&\\prod_{T\\ge1}\\prod_{t|T}\\prod_{i=1}^{\\lfloor\\frac nT\\rfloor}\\prod_{j=1}^{\\lfloor\\frac mT\\rfloor}(ijTt)^{ijTt\\mu(t)}\\\\\n=&\\prod_{T\\ge1}\\prod_{t|T}\\Big(\\big(\\prod_{i=1}^{\\lfloor\\frac nT\\rfloor}\\prod_{j=1}^{\\lfloor\\frac mT\\rfloor}(ij)^{ij}\\big)\\times \\big(\\prod_{i=1}^{\\lfloor\\frac nT\\rfloor}\\prod_{j=1}^{\\lfloor\\frac mT\\rfloor}(Tt)^{ij}\\big)\\Big)^{Tt\\mu(t)}\\\\\n\\end{aligned}\n$$\n\n\u7ea6\u5b9a\u51e0\u4e2a\u51fd\u6570\uff1a\n\n- $f(n)=\\dfrac12n(n+1)$\u3002\n- $g(n)=\\prod_{i=1}^ni^i$\u3002\n- $h(n,m)=g(n)^{f(m)}g(m)^{f(n)}$\u3002\n- $r(n)=n\\mu(n)$\u3002\n- $u(n)=n\\sum_{d|n}r(d)$\u3002\n- $v(n)=n^{u(n)}$\u3002\n- $w(n)=(\\prod_{d|n}d^{r(d)})^n$\u3002\n\n\u6211\u4eec\u7ee7\u7eed\u3002\n$$\n\\begin{aligned}\n&\\prod_{T\\ge1}\\prod_{t|T}\\Big(\\big(\\prod_{i=1}^{\\lfloor\\frac nT\\rfloor}\\prod_{j=1}^{\\lfloor\\frac mT\\rfloor}(ij)^{ij}\\big)\\times \\big(\\prod_{i=1}^{\\lfloor\\frac nT\\rfloor}\\prod_{j=1}^{\\lfloor\\frac mT\\rfloor}(Tt)^{ij}\\big)\\Big)^{Tt\\mu(t)}\\\\\n=&\\prod_{T\\ge1}\\prod_{t|T}\\Big(h(\\lfloor\\frac nT\\rfloor,\\lfloor\\frac mT\\rfloor)\\times(Tt)^{f(\\lfloor\\frac nT\\rfloor)f(\\lfloor\\frac mT\\rfloor)}\\Big)^{Tr(t)}\\\\\n\\end{aligned}\n$$\n\n\u628a\u62ec\u53f7\u91cc\u9762\u62c6\u5f00\uff0c\u7a0d\u5fae\u5316\u4e00\u4e0b\u4e24\u90e8\u5206\u7684\u67ff\u5b50\uff1a\n\n$$\n\\begin{aligned}\n&\\prod_{T\\ge1}\\prod_{t|T}h(\\lfloor\\frac nT\\rfloor,\\lfloor\\frac mT\\rfloor)^{Tr(t)}\\\\\n=&\\prod_{T\\ge1}h(\\lfloor\\frac nT\\rfloor,\\lfloor\\frac mT\\rfloor)^{u(T)}\\\\\n\\\\\n&\\prod_{T\\ge1}\\prod_{t|T}\\Big((Tt)^{f(\\lfloor\\frac nT\\rfloor)f(\\lfloor\\frac mT\\rfloor)}\\Big)^{Tr(t)}\\\\\n=&\\prod_{T\\ge1}\\Big(\\prod_{t|T}(Tt)^{Tr(t)}\\Big)^{f(\\lfloor\\frac nT\\rfloor)f(\\lfloor\\frac mT\\rfloor)}\\\\\n=&\\prod_{T\\ge1}\\Big(T^{T\\sum_{t|T}r(t)}(\\prod_{t|T}t^{r(t)})^T\\Big)^{f(\\lfloor\\frac nT\\rfloor)f(\\lfloor\\frac mT\\rfloor)}\\\\\n=&\\prod_{T\\ge1}\\Big(T^{u(T)}w(T)\\Big)^{f(\\lfloor\\frac nT\\rfloor)f(\\lfloor\\frac mT\\rfloor)}\\\\\n=&\\prod_{T\\ge1}\\Big(v(T)w(T)\\Big)^{f(\\lfloor\\frac nT\\rfloor)f(\\lfloor\\frac mT\\rfloor)}\n\\end{aligned}\n$$\n\n\u4ee3\u56de\u539f\u5f0f\u5f97\uff1a\n\n$$\n\\begin{aligned}\ns(n,m)=\\prod_{t\\ge1}h(\\lfloor\\frac nT\\rfloor,\\lfloor\\frac mT\\rfloor)^{u(T)}\\Big(v(T)w(T)\\Big)^{f(\\lfloor\\frac nT\\rfloor)f(\\lfloor\\frac mT\\rfloor)}\n\\end{aligned}\n$$\n\n\u9884\u5904\u7406 $g(n),u(n),v(n),w(n)$\uff0c\u642d\u914d\u6570\u8bba\u5206\u5757\uff0c\u5373\u53ef\u5728 $O(n\\log n+t\\sqrt n\\log n)$ \u65f6\u95f4\u5185\u89e3\u51b3\u672c\u9898\u3002\n\n~~\u6bd4\u5e7d\u4ec0\u4e48\u56e2\u77ed\u3002~~\n\n## Code\n\n\u5c01\u88c5\u6bd4\u8f83\u591a\uff0c\u4ee3\u7801\u7565\u663e\u62bd\u8c61\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nusing ll=long long;\n#define Tp template<typename T>\n#define Ts template<typename T,typename... _T>\nchar buf[1<<20],*p1=buf,*p2=buf;\n#define getchar() (p1==p2&&(p2=buf+fread(p1=buf,1,1<<20,stdin),p1==p2)?EOF:*p1++)\nTp inline void read(T& x){\n    x=0;char c=getchar();bool f=0;\n    for(;!isdigit(c);c=getchar())if(c=='-')f=1;\n    for(;isdigit(c);c=getchar())x=(x<<1)+(x<<3)+(c^48);\n    f&&(x=-x);\n}\nTs inline void read(T& x,_T&... y){read(x),read(y...);}\nTp inline void copy(T* a,T* b,int len){for(int i=0;i<len;i++)b[i]=a[i];}\nTp inline void assign(T* a,int len,T b=0){for(int i=0;i<len;i++)a[i]=b;}\nTp inline void plus(T* a,int len,T b=0){for(int i=0;i<len;i++)a[i]+=b;}\nTp inline void ckmin(T& x,T y){x=min(x,y);}\nTp inline void ckmax(T& x,T y){x=max(x,y);}\nconst int N=1e6+5,M=1e6+5,INF=1e9,mod=32465177,mmod=mod-1,imod=mod-2;\ninline ll qpow(const ll& _a,const ll& _b){\n\tll a=_a,b=_b,res=1;\n\tfor(;b;b>>=1,a=a*a%mod)\n\t\tif(b&1)res=res*a%mod;\n\treturn res;\n}\nstruct mint{\n\tll v;\n\tinline mint(const ll& _v=0){v=_v;}\n\tinline mint operator +(const mint& _){return (v+_.v)%mod;}\n\tinline mint operator +=(const mint& _){return v=(v+_.v)%mod;}\n\tinline mint operator -(const mint& _){return (v-_.v+mod)%mod;}\n\tinline mint operator -=(const mint& _){return v=(v-_.v+mod)%mod;}\n\tinline mint operator *(const mint& _){return v*_.v%mod;}\n\tinline mint operator *=(const mint& _){return v=v*_.v%mod;}\n\tinline mint operator /(const mint& _){return v*qpow(_.v,imod)%mod;}\n\tinline mint operator /=(const mint& _){return v=v*qpow(_.v,imod)%mod;}\n\tinline mint operator ^(const ll& _){return qpow(v,_);}\n\tinline mint operator ^=(const ll& _){return v=qpow(v,_);}\n};\ninline void ps(int N,ll* f,ll* sf){//prework_summary\n\tfor(int i=1;i<=N;i++)sf[i]=(sf[i-1]+f[i])%mmod;\n}\ninline ll gs(ll* sf,int l,int r){return (sf[r]-sf[l-1]+mmod)%mmod;}//get_summary\ninline void pp(int N,mint* f,mint* pf,mint* ipf){//prework_product\n\tpf[0]=1;for(int i=1;i<=N;i++)pf[i]=pf[i-1]*f[i];\n\tipf[N]=(mint)1/pf[N];for(int i=N;i>=1;i--)ipf[i-1]=ipf[i]*f[i];\n}\ninline mint gp(mint* pf,mint* ipf,int l,int r){return pf[r]*ipf[l-1];}//get_product\n//=================================================================================\nint plen,p[N],mu[N];\nbool vis[N];\ninline void sieve(int N=1e6){\n\tmu[1]=1;\n\tfor(int i=2;i<=N;i++){\n\t\tif(!vis[i])p[++plen]=i,mu[i]=mmod-1;\n\t\tfor(int j=1;i*p[j]<=N;j++){\n\t\t\tvis[i*p[j]]=1;\n\t\t\tif(i%p[j]==0){\n\t\t\t\tmu[i*p[j]]=0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmu[i*p[j]]=mmod-mu[i];\n\t\t}\n\t}\n}\nmint g[N],pg[N],ipg[N];\nll u[N],su[N];\nmint v[N],pv[N],ipv[N];\nmint w[N],pw[N],ipw[N];\ninline ll f(ll n){return n*(n+1)/2%mmod;}\ninline mint h(ll n,ll m){return (gp(pg,ipg,1,n)^f(m))*(gp(pg,ipg,1,m)^f(n));}\ninline ll r(ll n){return n*mu[n]%mmod;}\ninline void init(int N=1e6){\n\tsieve(N);\n\tfor(int i=1;i<=N;i++)g[i]=(mint)i^i;\n\tpp(N,g,pg,ipg);\n\tfor(int i=1;i<=N;i++){\n\t\tll now=r(i);\n\t\tfor(int j=1;i*j<=N;j++)\n\t\t\tu[i*j]=(u[i*j]+now)%mmod;\n\t\tu[i]=u[i]%mmod*i%mmod;\n\t}\n\tps(N,u,su);\n\tfor(int i=1;i<=N;i++)v[i]=(mint)i^u[i];\n\tpp(N,v,pv,ipv);\n\tassign(w+1,N,(mint)1);\n\tfor(int i=1;i<=N;i++){\n\t\tmint now=(mint)i^r(i);\n\t\tfor(int j=1;i*j<=N;j++)\n\t\t\tw[i*j]*=now;\n\t\tw[i]^=i;\n\t}\n\tpp(N,w,pw,ipw);\n}\ninline mint s(ll n,ll m){\n\tmint res=1;\n\tfor(ll l=1,r;l<=n&&l<=m;l=r+1){\n\t\tr=min(n/(n/l),m/(m/l));\n\t\tres*=(h(n/l,m/l)^gs(su,l,r))*((gp(pv,ipv,l,r)*gp(pw,ipw,l,r))^(f(n/l)*f(m/l)%mmod));\n\t}\n\treturn res;\n}\ninline mint ask(ll l,ll r){return (s(r,r)*s(l-1,l-1))/(s(r,l-1)*s(l-1,r));}\nint t,n;\nint main(){\n\tread(t,n);\n\tinit(n);\n\twhile(t--){\n\t\tint l,r;\n\t\tread(l,r);\n\t\tprintf(\"%lld\\n\",ask(l,r).v);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1682828448,
        "uid": 654546,
        "name": "ScatteredHope",
        "ccfLevel": 5,
        "title": "P7486 \u9898\u89e3"
    },
    {
        "content": "## \u9898\u610f\n\n\u6c42\n\n$$\n\\prod_{i=l}^r\\prod_{j=l}^r\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}\n$$\n\n\u5bf9 $32465177$ \u53d6\u6a21\u7684\u503c\u3002\n\n## \u601d\u8def\n\n\u8bbe $\\displaystyle f(n,m)=\\prod_{i=1}^n\\prod_{j=1}^m\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}$\uff0c\u7b54\u6848\u663e\u7136\u4e3a $\\dfrac{f(r,r)f(l-1,l-1)}{f(r,l-1)f(l-1,r)}$\uff0c\u7531\u4e8e $f(n,m)=f(m,n)$\uff0c\u4ee5\u4e0b\u4e0d\u59a8\u8bbe $n\\le m$\u3002\n\n$$\n\\begin{aligned}\n  f(n,m)\n  &=\\prod_{i=1}^n\\prod_{j=1}^m\\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}\\\\\n  &=\\prod_{i=1}^n\\prod_{j=1}^m\\frac{ij}{\\gcd(i,j)}^{\\frac{ij}{\\gcd(i,j)}}\\\\\n  &=\\prod_{d=1}^n\\prod_{i=1}^n\\prod_{j=1}^m\\frac{ij}{d}^{\\frac{ij}{d}[\\gcd(i,j)=d]}\\\\\n  &=\\prod_{d=1}^n\\prod_{i=1}^{\\lfloor n/d\\rfloor}\\prod_{j=1}^{\\lfloor m/d\\rfloor}ijd^{ijd[\\gcd(i,j)=1]}\\\\\n  &=\\prod_{d=1}^n\\prod_{i=1}^{\\lfloor n/d\\rfloor}\\prod_{j=1}^{\\lfloor m/d\\rfloor}ijd^{ijd\\sum_{p\\mid i,p\\mid j}\\mu(p)}\\\\\n  &=\\prod_{d=1}^n\\prod_{i=1}^{\\lfloor n/d\\rfloor}\\prod_{j=1}^{\\lfloor m/d\\rfloor}\\prod_{p\\mid i,p\\mid j}ijd^{ijd\\mu(p)}\\\\\n  &=\\prod_{d=1}^n\\prod_{p=1}^{\\lfloor n/d\\rfloor}\\prod_{i=1}^{\\lfloor n/dp\\rfloor}\\prod_{j=1}^{\\lfloor m/dp\\rfloor}(ijdp^2)^{ijdp^2\\mu(p)}\\\\\n\\end{aligned}\n$$\n\n\u8bbe $t=dp$\uff0c\u6709\n\n$$\n\\begin{aligned}\n  &\\prod_{d=1}^n\\prod_{p=1}^{\\lfloor n/d\\rfloor}\\prod_{i=1}^{\\lfloor n/dp\\rfloor}\\prod_{j=1}^{\\lfloor m/dp\\rfloor}(ijdp^2)^{ijdp^2\\mu(p)}\\\\\n  =&\\prod_{d=1}^n\\prod_{p=1}^{\\lfloor n/d\\rfloor}\\prod_{i=1}^{\\lfloor n/t\\rfloor}\\prod_{j=1}^{\\lfloor m/t\\rfloor}(ijtp)^{ijtp\\mu(p)}\\\\\n  =&\\prod_{t=1}^n\\prod_{p\\mid t}\\prod_{i=1}^{\\lfloor n/t\\rfloor}\\prod_{j=1}^{\\lfloor m/t\\rfloor}(ijtp)^{ijtp\\mu(p)}\\\\\n  =&\\prod_{t=1}^n\\left(\\prod_{p\\mid t}\\left(\\prod_{i=1}^{\\lfloor n/t\\rfloor}\\prod_{j=1}^{\\lfloor m/t\\rfloor}(ijtp)^{ij}\\right)^{p\\mu(p)}\\right)^t\\\\\n  =&\\prod_{t=1}^n\\left(\\prod_{p\\mid t}\\left(\\prod_{i=1}^{\\lfloor n/t\\rfloor}\\prod_{j=1}^{\\lfloor m/t\\rfloor}(ij)^{ij}\\cdot\\prod_{i=1}^{\\lfloor n/t\\rfloor}\\prod_{j=1}^{\\lfloor m/t\\rfloor}(tp)^{ij}\\right)^{p\\mu(p)}\\right)^t\\\\\n\\end{aligned}\n$$\n\n\u8bbe $S(n,m)=\\displaystyle\\prod_{i=1}^n\\prod_{j=1}^m(ij)^{ij}$\uff0c$s(n)=\\displaystyle\\sum_{i=1}^ni=\\dfrac{n(n+1)}{2}$\uff0c$g(n)=\\displaystyle\\prod_{i=1}^ni^i$\uff0c\u6709\n\n$$\n\\begin{aligned}\n  S(n,m)\n  &=\\prod_{i=1}^n\\prod_{j=1}^m(ij)^{ij}\\\\\n  &=\\prod_{i=1}^n\\prod_{j=1}^mi^{ij}\\cdot j^{ij}\\\\\n  &=\\prod_{i=1}^n\\prod_{j=1}^m(i^i)^j\\cdot \\prod_{i=1}^n\\prod_{j=1}^m(j^j)^i\\\\\n  &=\\prod_{i=1}^n(i^i)^{s(m)}\\cdot \\prod_{i=1}^ng(m)^i\\\\\n  &=g(n)^{s(m)}\\cdot g(m)^{s(n)}\\\\\n\\end{aligned}\n$$\n\n\u53e6\u4e00\u8fb9\uff0c\u6211\u4eec\u6709\uff1a\n\n$$\n\\begin{aligned}\n  \\prod_{i=1}^{n}\\prod_{j=1}^{m}x^{ij}\n  &=x^{\\sum_{i=1}^n\\sum_{j=1}^mij}\\\\\n  &=x^{s(n)s(m)}\n\\end{aligned}\n$$\n\n\u4ee3\u5165\u539f\u5f0f\uff0c\u5f97\uff1a\n\n$$\n\\begin{aligned}\n  &\\prod_{t=1}^n\\left(\\prod_{p\\mid t}\\left(\\prod_{i=1}^{\\lfloor n/t\\rfloor}\\prod_{j=1}^{\\lfloor m/t\\rfloor}(ij)^{ij}\\cdot\\prod_{i=1}^{\\lfloor n/t\\rfloor}\\prod_{j=1}^{\\lfloor m/t\\rfloor}(tp)^{ij}\\right)^{p\\mu(p)}\\right)^t\\\\\n  =&\\prod_{t=1}^n\\left(\\prod_{p\\mid t}\\left(S(\\lfloor n/t\\rfloor,\\lfloor m/t\\rfloor)\\cdot(tp)^{s(\\lfloor n/t\\rfloor)s(\\lfloor m/t\\rfloor)}\\right)^{p\\mu(p)}\\right)^t\\\\\n  =&\\prod_{t=1}^n\\left(\\prod_{p\\mid t}S(\\lfloor n/t\\rfloor,\\lfloor m/t\\rfloor)^{p\\mu(p)}\\cdot p^{s(\\lfloor n/t\\rfloor)s(\\lfloor m/t\\rfloor)p\\mu(p)}\\cdot t^{s(\\lfloor n/t\\rfloor)s(\\lfloor m/t\\rfloor)p\\mu(p)}\\right)^t\\\\\n\\end{aligned}\n$$\n\n\u8bbe $h(n)=\\displaystyle\\sum_{p\\mid n}p\\mu(p)$\uff0c$w(n)=\\displaystyle\\prod_{d\\mid n}d^{d\\mu(d)}$\uff0c\u6709\uff1a\n\n$$\n\\begin{aligned}\n  &\\prod_{t=1}^n\\left(\\prod_{p\\mid t}S(\\lfloor n/t\\rfloor,\\lfloor m/t\\rfloor)^{p\\mu(p)}\\cdot p^{s(\\lfloor n/t\\rfloor)s(\\lfloor m/t\\rfloor)p\\mu(p)}\\cdot t^{s(\\lfloor n/t\\rfloor)s(\\lfloor m/t\\rfloor)p\\mu(p)}\\right)^t\\\\\n  =&\\prod_{t=1}^n\\left(S(\\lfloor n/t\\rfloor,\\lfloor m/t\\rfloor)^{h(t)}\\cdot w(t)^{s(\\lfloor n/t\\rfloor)s(\\lfloor m/t\\rfloor)}\\cdot t^{s(\\lfloor n/t\\rfloor)s(\\lfloor m/t\\rfloor)h(t)}\\right)^t\\\\\n\\end{aligned}\n$$\n\n\u518d\u8bbe $r(n)=\\displaystyle(w(n)\\cdot n^{h(n)})^n$\uff0c\u6709\n\n$$\n\\begin{aligned}\n  &\\prod_{t=1}^n\\left(S(\\lfloor n/t\\rfloor,\\lfloor m/t\\rfloor)^{h(t)}\\cdot w(t)^{s(\\lfloor n/t\\rfloor)s(\\lfloor m/t\\rfloor)}\\cdot t^{s(\\lfloor n/t\\rfloor)s(\\lfloor m/t\\rfloor)h(t)}\\right)^t\\\\\n  =&\\prod_{t=1}^nS(\\lfloor n/t\\rfloor,\\lfloor m/t\\rfloor)^{h(t)t}\\cdot r(t)^{s(\\lfloor n/t\\rfloor)s(\\lfloor m/t\\rfloor)}\\\\\n\\end{aligned}\n$$\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6570\u8bba\u5206\u5757\u89e3\u51b3\u95ee\u9898\u3002\n\n\u6574\u7406\u4e00\u4e0b\u8981\u7528\u7684\u51fd\u6570\uff1a\n\n- $s(n)=\\displaystyle\\sum_{i=1}^ni=\\dfrac{n(n+1)}{2}$\uff1a\u4f4d\u4e8e\u6307\u6570\u4e0a\uff0c\u53ef $O(1)$ \u8ba1\u7b97\uff0c\u6a21 $p-1$\u3002\n- $g(n)=\\displaystyle\\prod_{i=1}^ni^i$\uff1a\u4f4d\u4e8e\u5e95\u6570\u4e0a\uff0c\u53ef $O(n\\log n)$ \u9884\u5904\u7406\uff0c\u6a21 $p$\u3002\n- $S(n,m)=g(n)^{s(m)}\\cdot g(m)^{s(n)}$\uff1a\u4f4d\u4e8e\u5e95\u6570\u4e0a\uff0c\u53ef $O(\\log p)$ \u8ba1\u7b97\uff0c\u6a21 $p$\u3002\n- $h(n)=\\displaystyle\\sum_{p\\mid n}p\\mu(p)$\uff1a\u79ef\u6027\u51fd\u6570\uff0c\u4f4d\u4e8e\u6307\u6570\u4e0a\uff0c\u53ef $O(n)$ \u9884\u5904\u7406\uff08\u7ebf\u6027\u7b5b\uff09\uff0c\u6a21 $p-1$\u3002\n- $w(n)=\\displaystyle\\prod_{d\\mid n}d^{d\\mu(d)}$\uff1a\u4f4d\u4e8e\u5e95\u6570\u4e0a\uff0c\u53ef\u4ee5 $O(n\\log n)$ \u9884\u5904\u7406\uff0c\u6a21 $p$\u3002\n- $r(n)=\\displaystyle(w(n)\\cdot n^{h(n)})^n$\uff1a\u4f4d\u4e8e\u5e95\u6570\u4e0a\uff0c\u53ef\u4ee5 $O(\\log p)$ \u76f4\u63a5\u8ba1\u7b97\uff0c\u6a21 $p$\u3002\n\n\u518d\u6574\u7406\u4e00\u4e0b\u8981\u9884\u5904\u7406\u7684\u4e1c\u897f\uff1a\n\n- $g(n)=\\displaystyle\\prod_{i=1}^ni^i$\uff1a\u76f4\u63a5\u9884\u5904\u7406 $i^i$ \u540e\u524d\u7f00\u79ef\u3002\n- $h(n)=\\displaystyle\\sum_{p\\mid n}p\\mu(p)$\uff1a\u4f7f\u7528\u7ebf\u6027\u7b5b\u9884\u5904\u7406\uff0c$h(p^k)=1-p$\u3002\n- $w(n)=\\displaystyle\\prod_{d\\mid n}d^{d\\mu(d)}$\uff1a\u679a\u4e3e $d$ \u5bf9\u500d\u6570\u8d21\u732e\u5373\u53ef\u3002\n- $h(t)t$ \u7684\u524d\u7f00\u548c\uff0c\u5bf9 $p-1$ \u53d6\u6a21\u3002\n- $r(t)$ \u7684\u524d\u7f00\u79ef\u548c\u9006\u5143\uff0c\u5bf9 $p$ \u53d6\u6a21\u3002\n\n```cpp\n#include <iostream>\n#include <vector>\n\nusing namespace std;\nusing LL = long long;\n\nconst int kN = 1e6 + 1;\nconst LL kM = 32465177;\n\nint t, n, ql, qr, bp[kN], kp[kN], sp[kN], mu[kN];\nLL g[kN], h[kN], w[kN], ht[kN], _r[kN], r[kN], ir[kN];\nbool v[kN];\nvector<int> p;\n\nLL P(LL b, LL e) {\n  LL s = 1;\n  for (; e; e >>= 1, b = b * b % kM) {\n    (e & 1) && (s = s * b % kM);\n  }\n  return s;\n}\nLL S(int n) { return 1LL * n * (n + 1) / 2 % (kM - 1); }\nLL S(int n, int m) { return P(g[n], S(m)) * P(g[m], S(n)) % kM; }\nLL F(int n, int m) {\n  LL s = 1;\n  for (int l = 1, r; l <= n; l = r + 1) {\n    r = min(n / (n / l), m / (m / l));\n    s = s\n      * P(S(n / l, m / l), (ht[r] - ht[l - 1] + kM - 1) % (kM - 1)) % kM\n      * P(::r[r] * ir[l - 1] % kM, S(n / l) * S(m / l) % (kM - 1)) % kM;\n  }\n  return s;\n}\n\nint main() {\n  ios_base::sync_with_stdio(0), cin.tie(0);\n  cin >> t >> n;\n  g[0] = 1;\n  for (int i = 1; i <= n; ++i) {\n    g[i] = g[i - 1] * P(i, i) % kM;\n  }\n  h[1] = mu[1] = 1;\n  for (int i = 2; i <= n; ++i) {\n    if (!v[i]) {\n      p.push_back(i), h[i] = (kM - i) % (kM - 1), mu[i] = -1;\n      bp[i] = sp[i] = i, kp[i] = 1;\n    }\n    for (int j : p) {\n      int k = i * j;\n      if (k > n) {\n        break;\n      }\n      v[k] = 1;\n      if (i % j) {\n        h[k] = h[i] * h[j] % (kM - 1);\n        mu[k] = -mu[i];\n        bp[k] = sp[k] = j, kp[k] = 1;\n      } else {\n        mu[k] = 0;\n        if (i == sp[i]) {\n          h[k] = h[bp[i]];\n        } else {\n          h[k] = h[i / sp[i]] * h[j * sp[i]] % (kM - 1);\n        }\n        bp[k] = bp[i], sp[k] = sp[i] * j, kp[k] = kp[i] + 1;\n        break;\n      }\n    }\n  }\n  for (int i = 1; i <= n; ++i) {\n    ht[i] = (ht[i - 1] + h[i] * i % (kM - 1)) % (kM - 1);\n  }\n  for (int i = 1; i <= n; ++i) {\n    w[i] = 1;\n  }\n  for (int d = 1; d <= n; ++d) {\n    LL v = P(d, (kM - 1 + d * mu[d]) % (kM - 1));\n    for (int i = d; i <= n; i += d) {\n      w[i] = w[i] * v % kM;\n    }\n  }\n  for (int i = 1; i <= n; ++i) {\n    _r[i] = P(w[i] * P(i, h[i]) % kM, i);\n  }\n  r[0] = 1;\n  for (int i = 1; i <= n; ++i) {\n    r[i] = r[i - 1] * _r[i] % kM;\n  }\n  ir[n] = P(r[n], kM - 2);\n  for (int i = n; i >= 1; --i) {\n    ir[i - 1] = ir[i] * _r[i] % kM;\n  }\n  for (; t--; ) {\n    cin >> ql >> qr;\n    LL f = F(ql - 1, qr);\n    cout << F(qr, qr) * F(ql - 1, ql - 1) % kM * P(f * f % kM, kM - 2) % kM << '\\n';\n  }\n  return 0;\n}\n```\n",
        "postTime": 1675311745,
        "uid": 376161,
        "name": "wsfxk",
        "ccfLevel": 6,
        "title": "P7486 \u300cStoi2031\u300d\u5f69\u8679 \u9898\u89e3"
    },
    {
        "content": "[P7486 \u300cStoi2031\u300d\u5f69\u8679](https://www.luogu.com.cn/problem/P7486)\n\n\u8bf7\u786e\u4fdd\u5b81\u5df2\u7ecf\u719f\u7ec3\u638c\u63e1\uff1a\n\n- \u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\n- \u5f62\u5982 $\\sum_{d\\mid n} f(d)$\uff0c\u5176\u4e2d $f$ \u4e3a\u79ef\u6027\u51fd\u6570\u7684 $\\Theta(n\\ln n)$ \u7684\u7b5b\u6cd5\u3002\n\n## Description\n\n- \u591a\u6d4b\uff0c\u6570\u636e\u7ec4\u6570\u4e3a $t$\u3002\n\n- \u7ed9\u5b9a\u4e00\u4e2a\u6b63\u6574\u6570 $n$\uff0c\u7136\u540e $t$ \u7ec4\u8be2\u95ee\uff0c\u6bcf\u7ec4\u7ed9\u51fa\u4e24\u4e2a\u6ee1\u8db3 $1\\le l\\le r\\le n$ \u7684\u6b63\u6574\u6570 $l, r$\uff0c\u8bf7\u6c42\u51fa\n  $$\n  \\left[\\prod_{i = l}^r \\prod_{j = l}^r \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)} \\right] \\bmod 32465177\n  $$\n  \n- \u5bf9\u4e8e $100\\%$ \u7684\u6570\u636e\uff0c$1 \\le n \\le 10^6, 1 \\le t \\le 10, 1 \\le l_i \\le r_i \\le n$\u3002\n\n## Solution\n\n\u8003\u8651\u7528\u524d\u7f00\u79ef + \u5bb9\u65a5\u3002\n\n\u4e3a\u65b9\u4fbf\u8868\u793a\uff0c\u8bbe $f(n, m) = \\prod_{i = 1}^n \\prod_{i = 1}^m \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)}$\u3002\n\n\u5219\n$$\n\\begin{aligned}\n\\prod_{i = l}^r \\prod_{j = l}^r \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)}\n& = \\prod_{i = l}^r \\dfrac{\\prod\\limits_{j = 1}^r \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)}}{\\prod\\limits_{j = 1}^{l - 1} \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)}} \\\\\n& = \\dfrac{\\prod\\limits_{i = 1}^r \\dfrac{\\prod\\limits_{j = 1}^r \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)}}{\\prod\\limits_{j = 1}^{l - 1} \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)}}}{\\prod\\limits_{i = 1}^{l - 1} \\dfrac{\\prod\\limits_{j = 1}^r \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)}}{\\prod\\limits_{j = 1}^{l - 1} \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)}}} \\\\\n& = \\dfrac{\\dfrac{\\prod\\limits_{i = 1}^r \\prod\\limits_{j = 1}^r \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)}}{\\prod\\limits_{i = 1}^r \\prod\\limits_{j = 1}^{l - 1} \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)}}}{\\dfrac{\\prod\\limits_{i = 1}^{l - 1} \\prod\\limits_{j = 1}^r \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)}}{\\prod\\limits_{i = 1}^{l - 1} \\prod\\limits_{j = 1}^{l - 1} \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)}}} \\\\\n& = \\dfrac{f(r, r) f(l - 1, l - 1)}{f(r, l - 1) f(l - 1, r)}\n\\end{aligned}\n$$\n\u89c2\u5bdf\u5230 $f(n, m) = f(m, n)$\uff0c\u4e0d\u59a8\u8bbe $n\\le m$\u3002\n$$\n\\begin{aligned}\nf(n, m)\n& = \\prod_{i = 1}^n \\prod_{j = 1}^m \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)} \\\\\n& = \\prod_{i = 1}^n \\prod_{j = 1}^m \\left[\\dfrac{ij}{\\gcd(i, j)} \\right]^{\\frac{ij}{\\gcd(i, j)}} \\\\\n\\end{aligned}\n$$\n\u53d1\u73b0\u82e5 $\\gcd(i, j)\\ne d$\uff0c\u5219 $\\dfrac{ij}{\\gcd(i, j)} [\\gcd(i, j) = d] = 0$\uff0c\u90a3\u4e48\u5982\u679c\u5b83\u4f5c\u4e3a\u6307\u6570\uff0c\u6709 $\\left[\\dfrac{ij}{\\gcd(i, j)} \\right]^{\\frac{ij}{\\gcd(i, j)} [\\gcd(i, j) = d]} = 1$\uff0c\u521a\u597d\u6ee1\u8db3\u8fd9\u4e00\u9879\u4e0d\u7b26\u5408\u8981\u6c42\u3002\n\n\u6240\u4ee5\u53d8\u6210\n$$\n\\begin{aligned}\n& = \\prod_{d = 1}^n \\prod_{i = 1}^n \\prod_{j = 1}^m \\left(\\dfrac{ij}{d}\\right)^{\\frac{ij}{d} [\\gcd(i, j) = d]} \\\\\n& = \\prod_{d = 1}^n \\prod_{i = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\prod_{j = 1}^{\\left\\lfloor\\frac{m}{d}\\right\\rfloor} (ijd)^{ijd [\\gcd(i, j) = 1]} \\\\\n& = \\prod_{d = 1}^n \\prod_{i = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\prod_{j = 1}^{\\left\\lfloor\\frac{m}{d}\\right\\rfloor} (ijd)^{ijd \\sum_{k\\mid \\gcd(i, j)} \\mu(k)}\n\\end{aligned}\n$$\n\n\u5c06\u6307\u6570\u7684\u52a0\u6539\u4e3a\u5e95\u6570\u7684\u4e58\n$$\n\\begin{aligned}\n& = \\prod_{d = 1}^n \\prod_{i = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\prod_{j = 1}^{\\left\\lfloor\\frac{m}{d}\\right\\rfloor} \\prod_{k\\mid \\gcd(i, j)} (ijd)^{ijd\\, \\mu(k)} \\\\\n& = \\prod_{d = 1}^n \\prod_{k = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\prod_{i = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} [k\\mid i] \\prod_{j = 1}^{\\left\\lfloor\\frac{m}{d}\\right\\rfloor} [k\\mid j] (ijd)^{ijd\\, \\mu(k)} \\\\\n& = \\prod_{d = 1}^n \\prod_{k = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\prod_{i = 1}^{\\left\\lfloor\\frac{n}{dk}\\right\\rfloor} \\prod_{j = 1}^{\\left\\lfloor\\frac{m}{dk}\\right\\rfloor} (ijdk^2)^{ijdk^2\\mu(k)} \\\\\n& = \\prod_{d = 1}^n \\prod_{k = 1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor} \\prod_{i = 1}^{\\left\\lfloor\\frac{n}{T}\\right\\rfloor} \\prod_{j = 1}^{\\left\\lfloor\\frac{m}{T}\\right\\rfloor} (ijkT)^{ijkT\\, \\mu(k)} \\\\\n& = \\prod_{T = 1}^n \\prod_{k\\mid T} \\prod_{i = 1}^{\\left\\lfloor\\frac{n}{T}\\right\\rfloor} \\prod_{j = 1}^{\\left\\lfloor\\frac{m}{T}\\right\\rfloor} (ijkT)^{ijkT\\, \\mu(k)} \\\\\n& = \\prod_{T = 1}^n \\prod_{k\\mid T} \\left[\\prod_{i = 1}^{\\left\\lfloor\\frac{n}{T}\\right\\rfloor} \\prod_{j = 1}^{\\left\\lfloor\\frac{m}{T}\\right\\rfloor} (ijkT)^{ij} \\right]^{kT\\, \\mu(k)} \\\\\n& = \\prod_{T = 1}^n \\prod_{k\\mid T} \\left\\{ \\left[\\prod_{i = 1}^{\\left\\lfloor\\frac{n}{T}\\right\\rfloor} \\prod_{j = 1}^{\\left\\lfloor\\frac{m}{T}\\right\\rfloor} (ij)^{ij} \\cdot \\prod_{i = 1}^{\\left\\lfloor\\frac{n}{T}\\right\\rfloor} \\prod_{j = 1}^{\\left\\lfloor\\frac{m}{T}\\right\\rfloor} (kT)^{ij} \\right]^{k\\, \\mu(k)} \\right\\}^T\n\\end{aligned}\n$$\n\u5316\u7b80\u540e\u9762\u4e24\u9879\u3002\u8bbe\u4e00\u4e2a\u51fd\u6570 $S(n) = \\sum_{i = 1}^n i$\uff0c\u518d\u8bbe $g(n) = \\prod_{i = 1}^n i^i$\u3002\n\n\u5219\n$$\n\\begin{aligned}\n\\prod_{i = 1}^n \\prod_{j = 1}^m (ij)^{ij}\n& = \\prod_{i = 1}^n \\prod_{j = 1}^m i^{ij} \\cdot j^{ij} \\\\\n& = \\prod_{i = 1}^n \\prod_{j = 1}^m i^{ij} \\cdot \\prod_{j = 1}^m \\prod_{i = 1}^n j^{ji} \\\\\n& = \\prod_{i = 1}^n i^{i\\sum_{x = 1}^m x} \\cdot \\prod_{j = 1}^m j^{j\\sum_{y = 1}^n y} \\\\\n& = \\left(\\prod_{i = 1}^n i^i\\right)^{\\sum_{x = 1}^m x} \\cdot \\left(\\prod_{j = 1}^m j^j\\right)^{\\sum_{y = 1}^n y} \\\\\n& = g(n)^{S(m)} \\cdot g(m)^{S(n)}\n\\end{aligned}\n$$\n\u8bbe\u5b83\u4e3a $h(n, m)$ \u5427\u3002\n\n\u7136\u540e\n$$\n\\begin{aligned}\n\\prod_{i = 1}^n \\prod_{j = 1}^m (kT)^{ij}\n& = (kT)^{\\sum_{i = 1}^n \\sum_{j = 1}^m ij} \\\\\n& = (kT)^{\\sum_{i = 1}^n i \\sum_{j = 1}^m j} \\\\\n& = (kT)^{S(n) S(m)}\n\\end{aligned}\n$$\n\u56de\u4ee3\n$$\n\\begin{aligned}\n& = \\prod_{T = 1}^n \\prod_{k\\mid T} \\left\\{ \\left[h\\left(\\left\\lfloor\\dfrac{n}{T}\\right\\rfloor, \\left\\lfloor\\dfrac{m}{T}\\right\\rfloor \\right) (kT)^{S\\left(\\left\\lfloor\\frac{n}{T}\\right\\rfloor \\right) S\\left(\\left\\lfloor\\frac{m}{T}\\right\\rfloor \\right)} \\right]^{k\\, \\mu(k)} \\right\\}^T \\\\\n& = \\prod_{T = 1}^n \\prod_{k\\mid T} \\left[h\\left(\\left\\lfloor\\dfrac{n}{T}\\right\\rfloor, \\left\\lfloor\\dfrac{m}{T}\\right\\rfloor \\right)^{k\\, \\mu(k)}\\cdot k^{S\\left(\\left\\lfloor\\frac{n}{T}\\right\\rfloor \\right) S\\left(\\left\\lfloor\\frac{m}{T}\\right\\rfloor \\right) k\\, \\mu(k)} \\cdot T^{S\\left(\\left\\lfloor\\frac{n}{T}\\right\\rfloor \\right) S\\left(\\left\\lfloor\\frac{m}{T}\\right\\rfloor \\right) k\\, \\mu(k)} \\right]^T\n\\end{aligned}\n$$\n\u8bbe $\\alpha(n) = \\sum_{d\\mid n} d\\, \\mu(d)$\uff0c\u53e6\u8bbe $\\beta(n) = \\prod_{d\\mid n} d^{d\\, \\mu(d)}$\u3002\n\n\u5219\n$$\n= \\prod_{T = 1}^n \\left[h\\left(\\left\\lfloor\\dfrac{n}{T}\\right\\rfloor, \\left\\lfloor\\dfrac{m}{T}\\right\\rfloor \\right)^{\\alpha(T)} \\cdot \\beta(T)^{S\\left(\\left\\lfloor\\frac{n}{T}\\right\\rfloor \\right) S\\left(\\left\\lfloor\\frac{m}{T}\\right\\rfloor \\right)} \\cdot T^{S\\left(\\left\\lfloor\\frac{n}{T}\\right\\rfloor \\right) S\\left(\\left\\lfloor\\frac{m}{T}\\right\\rfloor \\right) \\alpha(T)} \\right]^T\n$$\n~~\u4e3a\u7b80\u6d01\u8868\u793a~~\uff0c\u518d\u8bbe $\\delta(n) = \\left[\\beta(n) \\cdot n^{\\alpha(n)} \\right]^n$\u3002\n$$\n= \\prod_{T = 1}^n h\\left(\\left\\lfloor\\dfrac{n}{T}\\right\\rfloor, \\left\\lfloor\\dfrac{m}{T}\\right\\rfloor \\right)^{\\alpha(T) T} \\cdot \\delta(T)^{S\\left(\\left\\lfloor\\frac{n}{T}\\right\\rfloor \\right) S\\left(\\left\\lfloor\\frac{m}{T}\\right\\rfloor \\right)}\n$$\n\u6570\u8bba\u5206\u5757\uff1a\n\n- \u7b2c\u4e00\u9879\u5e95\u6570\u76f8\u540c\uff0c\u9884\u5904\u7406\u6307\u6570\u7684\u524d\u7f00\u548c\u5373\u53ef\uff1b\n- \u7b2c\u4e8c\u9879\u6307\u6570\u76f8\u540c\uff0c\u9884\u5904\u7406\u5e95\u6570\u7684\u524d\u7f00\u79ef\u5373\u53ef\u3002\n\n\u6a21\u6570 $p = 32465177$ \u662f\u8d28\u6570\uff0c\u6839\u636e\u6b27\u62c9\u5b9a\u7406\u53ef\u4ee5\u5c06\u6307\u6570 $\\bmod (p - 1)$ \u964d\u5230 $\\Omicron(p)$ \u7ea7\u522b\u3002\n\n\u4ee5\u4e0a\u6240\u6709\u9700\u8981\u7528\u5230\u7684\u4e1c\u897f\uff1a\n\n- $S(n) = \\sum_{i = 1}^n i$\uff1a$\\Theta(1)$ \u8ba1\u7b97\uff0c$S(n)$ \u90fd\u4f5c\u4e3a\u6307\u6570\u51fa\u73b0\uff0c\u6240\u4ee5 $\\bmod (p - 1)$\u3002\n- $g(n) = \\prod_{i = 1}^n i^i$\uff1a\u9884\u5904\u7406 $\\Omicron(n\\log n)$\uff0c\u67e5\u8be2 $\\Theta(1)$\u3002\n- $h(n, m) = g(n)^{S(m)} \\cdot g(m)^{S(n)}$\uff1a\u5728\u53ef\u4ee5 $\\Theta(1)$ \u5f97\u5230 $S,g$ \u7684\u503c\u7684\u60c5\u51b5\u4e0b\u662f $\\Omicron(\\log p)$ \u8ba1\u7b97\u7684\u3002\n- $d\\, \\mu(d)$\uff1a\u4ee4\u5176\u4e3a $\\gamma(d)$\u3002\u628a\u8fd9\u4e2a\u5728\u7ebf\u6027\u7b5b\u65f6\u987a\u4fbf\u7b97\u51fa\u6765\uff0c$\\Theta(n)$\u3002\u89c2\u5bdf\u5230 $\\gamma(d)$ \u90fd\u4f5c\u4e3a\u6307\u6570\u51fa\u73b0\uff0c\u6240\u4ee5\u53ef\u4ee5\u5c06\u5176 $\\bmod (p - 1)$ \u5e76\u8f6c\u6210\u6b63\u6570\u3002\n- $\\alpha(n) = \\sum_{d\\mid n} \\gamma(d)$\uff1a\u9884\u5904\u7406 $\\Theta(n\\ln n)$\uff0c\u67e5\u8be2 $\\Theta(1)$\u3002\u4f5c\u4e3a\u6307\u6570\u51fa\u73b0\uff0c$\\bmod (p - 1)$\u3002\n- $\\alpha(n) n$\uff1a\u4ee4\u5176\u4e3a $\\zeta(n)$\u3002\u9884\u5904\u7406 $\\Theta(n)$\uff0c\u67e5\u8be2 $\\Theta(1)$\u3002\u4f5c\u4e3a\u6307\u6570\u51fa\u73b0\uff0c$\\bmod (p - 1)$\u3002\n- $d^{d\\, \\mu(d)}$\uff1a\u4ee4\u5176\u4e3a $\\lambda(d)$\u3002\u4e5f\u662f\u5728\u7ebf\u6027\u7b5b\u4e2d\u505a\uff0c\u4f46\u5b83\u4f7f\u7ebf\u6027\u7b5b\u591a\u4e86\u4e2a $\\log p$\u3002\n- $\\beta(n) = \\prod_{d\\mid n} \\lambda(d)$\uff1a\u9884\u5904\u7406 $\\Theta(n\\ln n)$\uff0c\u67e5\u8be2 $\\Theta(1)$\u3002\n- $\\delta(n) = \\left[\\beta(n) \\cdot n^{\\alpha(n)} \\right]^n$\uff1a\u9884\u5904\u7406 $\\Omicron(n\\log p)$\uff0c\u67e5\u8be2 $\\Theta(1)$\u3002\n\n\u6570\u8bba\u5206\u5757\u662f $\\Omicron\\left(\\sqrt{n}\\log p\\right)$ \u7684\uff0c\u5373\u8ba1\u7b97 $f(n, m) = \\prod_{i = 1}^n \\prod_{i = 1}^m \\operatorname{lcm}(i, j)^{\\operatorname{lcm}(i, j)}$ \u662f $\\Omicron\\left(\\sqrt{n}\\log p\\right)$ \u7684\u3002\n\n$t$ \u6b21\u8be2\u95ee\uff0c\u65f6\u95f4\u662f $\\Omicron(t\\sqrt{n}\\log p)$ \u7684\u3002\n\n\u52a0\u4e0a\u9884\u5904\u7406\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Omicron(n\\log p + n\\ln n + t\\sqrt{n}\\log p)$ \u7684\uff0c\u7531\u4e8e $t\\le 10$ \u8fc7\u5c0f\uff0c\u6240\u4ee5\u771f\u6b63\u5728 $\\Omicron(n\\log p)$ \u7ea7\u522b\u5185\u3002\n\n## Code\n\n```cpp\n// 18 = 9 + 9 = 18.\n#include <iostream>\n#include <cstdio>\n#define Debug(x) cout << #x << \"=\" << x << endl\ntypedef long long ll;\nusing namespace std;\n\nconst int MAXN = 1e6 + 5;\nconst int MOD = 32465177;\n\nint qpow(int a, int b)\n{\n\tint base = a, ans = 1;\n\twhile (b)\n\t{\n\t\tif (b & 1)\n\t\t{\n\t\t\tans = (ll)ans * base % MOD;\n\t\t}\n\t\tbase = (ll)base * base % MOD;\n\t\tb >>= 1;\n\t}\n\treturn ans;\n}\n\nint inv(int a)\n{\n\treturn qpow(a, MOD - 2);\n}\n\nint p[MAXN], g[MAXN], mu[MAXN], gamma[MAXN], alpha[MAXN], zeta[MAXN], zeta_sum[MAXN], lambda[MAXN], beta[MAXN], delta[MAXN], delta_pro[MAXN], delta_pro_inv[MAXN], delta_pro_pro[MAXN], delta_pro_pro_inv[MAXN];\nbool vis[MAXN];\n\nvoid pre(int n)\n{\n\tg[1] = mu[1] = gamma[1] = lambda[1] = beta[1] = delta[1] = 1;\n\tfor (int i = 2; i <= n; i++)\n\t{\n\t\tbeta[i] = 1;\n\t\tg[i] = (ll)g[i - 1] * qpow(i, i % (MOD - 1)) % MOD;\n\t\tif (!vis[i])\n\t\t{\n\t\t\tp[++p[0]] = i;\n\t\t\tmu[i] = -1;\n\t\t}\n\t\tgamma[i] = (i * mu[i] % (MOD - 1) + MOD - 1) % (MOD - 1);\n\t\tlambda[i] = qpow(i, gamma[i]);\n\t\tfor (int j = 1; j <= p[0] && i * p[j] <= n; j++)\n\t\t{\n\t\t\tvis[i * p[j]] = true;\n\t\t\tif (i % p[j] == 0)\n\t\t\t{\n\t\t\t\tmu[i * p[j]] = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmu[i * p[j]] = mu[i] * mu[p[j]];\n\t\t}\n\t}\n\t\n\tfor (int i = 1; i <= n; i++)\n\t{\n\t\tfor (int j = 1; i * j <= n; j++)\n\t\t{\n\t\t\talpha[i * j] = (alpha[i * j] + gamma[i]) % (MOD - 1);\n\t\t\tbeta[i * j] = (ll)beta[i * j] * lambda[i] % MOD;\n\t\t}\n\t}\n\t\n\tdelta_pro[0] = delta_pro_pro[0] = delta_pro_inv[0] = delta_pro_inv[1] = 1;\n\tfor (int i = 1; i <= n; i++)\n\t{\n\t\tzeta[i] = (ll)alpha[i] * i % (MOD - 1);\n\t\tzeta_sum[i] = (zeta_sum[i - 1] + zeta[i]) % (MOD - 1);\n\t\tdelta[i] = qpow((ll)beta[i] * qpow(i, alpha[i]) % MOD, i % (MOD - 1));\n\t\tdelta_pro[i] = (ll)delta_pro[i - 1] * delta[i] % MOD;\n\t\tdelta_pro_pro[i] = (ll)delta_pro_pro[i - 1] * delta_pro[i] % MOD;\n\t}\n\t\n\tdelta_pro_pro_inv[n] = inv(delta_pro_pro[n]);\n\tfor (int i = n - 1; i >= 1; i--)\n\t{\n\t\tdelta_pro_pro_inv[i] = (ll)delta_pro_pro_inv[i + 1] * delta_pro[i + 1] % MOD;\n\t\tdelta_pro_inv[i + 1] = (ll)delta_pro_pro_inv[i + 1] * delta_pro_pro[i] % MOD;\n\t}\n}\n\nint S(int n)\n{\n\treturn (ll)n * (n + 1) / 2 % (MOD - 1);\n}\n\nint h(int n, int m)\n{\n\treturn (ll)qpow(g[n], S(m)) * qpow(g[m], S(n)) % MOD;\n}\n\nint GetZetaSum(int l, int r)\n{\n\treturn (zeta_sum[r] - zeta_sum[l - 1] + MOD - 1) % (MOD - 1);\n}\n\nint GetDeltaPro(int l, int r)\n{\n\treturn (ll)delta_pro[r] * delta_pro_inv[l - 1] % MOD;\n}\n\nint f(int n, int m)\n{\n\tif (n > m)\n\t{\n\t\tswap(n, m);\n\t}\n\tint res = 1;\n\tfor (int l = 1, r; l <= n; l = r + 1)\n\t{\n\t\tint k1 = n / l, k2 = m / l;\n\t\tr = min(n / k1, m / k2);\n\t\tres = (ll)res * qpow(h(k1, k2), GetZetaSum(l, r)) % MOD * qpow(GetDeltaPro(l, r), (ll)S(k1) * S(k2) % (MOD - 1)) % MOD;\n\t}\n\treturn res;\n}\n\nint main()\n{\n\tint t, n;\n\tscanf(\"%d%d\", &t, &n);\n\tpre(n);\n\twhile (t--)\n\t{\n\t\tint l, r;\n\t\tscanf(\"%d%d\", &l, &r);\n\t\tint a = (ll)f(r, r) * f(l - 1, l - 1) % MOD, b = (ll)f(r, l - 1) * f(l - 1, r) % MOD;\n\t\tprintf(\"%d\\n\", (ll)a * inv(b) % MOD);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1642649900,
        "uid": 305532,
        "name": "mango09",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011Luogu-P7486 \u300cStoi2031\u300d\u5f69\u8679"
    },
    {
        "content": "~~\u554a\u8fd9\uff0c\u8fd9\u9053\u9898\u54ea\u91cc\u57fa\u7840\u4e86~~\n\n\u9996\u5148\u6211\u4eec\u4ee4 $ Solve(a,b)=\\prod\\limits_{i=1}^a\\prod\\limits_{j=1}^b \\operatorname{lcm}(a,b)^{\\operatorname{lcm}(a,b)} $\n\n\u90a3\u4e48\u6613\u5f97\u7b54\u6848\u4e3a\n$$ \\dfrac{Solve(r,r)\\times Solve(l-1,l-1)}{Solve(r,l-1)\\times Solve(l-1,r)} $$\n\u6240\u4ee5\u53ea\u9700\u8981\u6c42\u51fa $ Solve(a,b) $ \u5373\u53ef\n\n\u4ee4 $td=T$\uff0c\u4e0d\u59a8\u8bbe $a\\leq b$\n\n$$\n\\begin{aligned}\n&\\prod_{i=1}^a\\prod_{j=1}^b \\operatorname{lcm}(i,j)^{\\operatorname{lcm}(i,j)}\\\\\n=&\\prod_{d=1}^a\\prod_{i=1}^{\\lfloor \\frac{a}{d}\\rfloor}\\prod_{j=1}^{\\lfloor \\frac{b}{d}\\rfloor}(dij)^{dij[\\gcd(i,j)=1]}\\\\\n=&\\prod_{d=1}^a\\prod_{i=1}^{\\lfloor \\frac{a}{d}\\rfloor}\\prod_{j=1}^{\\lfloor \\frac{b}{d}\\rfloor}(dij)^{dij\\sum_{t|\\gcd(i,j)}\\mu(t)}\\\\\n=&\\prod_{d=1}^a\\prod_{t=1}^{\\lfloor \\frac{a}{d}\\rfloor}\\prod_{i=1}^{\\lfloor \\frac{a}{td}\\rfloor}\\prod_{j=1}^{\\lfloor \\frac{b}{td}\\rfloor}(dij\\times t^2)^{dij\\times t^2\\times\\mu(t)}\\\\\n=&\\prod_{T=1}^a\\prod_{t|T}\\prod_{i=1}^{\\lfloor \\frac{a}{T}\\rfloor}\\prod_{j=1}^{\\lfloor \\frac{b}{T}\\rfloor}(ijTt)^{ijTt\\times\\mu(t)}\n\\end{aligned}\n$$\n\u4ee4 $ S(x)=1+2+......+x=\\dfrac{x(x+1)}{2},F(x)=\\prod\\limits_{i=1}^x i^i $\n\n\u5219\u6709\n$$\n\\prod_{i=1}^n\\prod_{j=1}^m (ij)^{ij}=F(n)^{S(m)}\\times F(m)^{S(n)}\n$$\n\uff08\u4ee4\u5176\u4e3a $G(n,m)$\uff09\n$$\n\\prod_{i=1}^n\\prod_{j=1}^m {Tt}^{ij}=Tt^{S(n)\\times S(m)}\n$$\n\n\u5e26\u56de\u539f\u5f0f\u53ef\u4ee5\u5f97\u5230\n$$\n\\begin{aligned}\n&\\prod_{T=1}^a(\\prod_{t|T}(G({\\lfloor \\frac{a}{T}\\rfloor},{\\lfloor \\frac{b}{T}\\rfloor})\\times Tt^{S(\\lfloor \\frac{a}{T}\\rfloor)\\times S(\\lfloor \\frac{b}{T}\\rfloor)})^{t\\mu(t)})^T\\\\\n\\end{aligned}\n$$\n\u4ee4 $ h(x)=\\sum\\limits_{d|x}d\\mu(d),v(x)=\\prod\\limits_{d|x}d^{d\\mu(d)} $\uff0c\u5219\u53ef\u5f97\n$$\n\\prod_{T=1}^aG({\\lfloor \\frac{a}{T}\\rfloor},{\\lfloor \\frac{b}{T}\\rfloor})^{Th(T)}\\times(T^{h(T)}\\times v(T))^{T\\times S(\\lfloor \\frac{a}{T}\\rfloor)\\times S(\\lfloor \\frac{b}{T}\\rfloor)}\n$$\n\n\u6700\u540e\u518d\u4ee4 $ hh(x)=x\\times h(x),vv(x)=(x^{h(x)}\\times v(x))^x $  \u53ef\u4ee5\u5f97\u5230\n$$\n\\prod_{T=1}^aG({\\lfloor \\frac{a}{T}\\rfloor},{\\lfloor \\frac{b}{T}\\rfloor})^{hh(T)}\\times vv(T)^{S(\\lfloor \\frac{a}{T}\\rfloor)\\times S(\\lfloor \\frac{b}{T}\\rfloor)}\n$$\n\n\u524d\u7f00\u548c+\u524d\u7f00\u79ef+\u6574\u9664\u5206\u5757\u5373\u53ef ~~\uff08\u5565\u524d\u7f00\u548c\u524d\u7f00\u79ef\u7684\uff09~~\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ninline int mn(int x,int y){\n\treturn x<y?x:y;\n}\ninline int read(){\n\tint x=0;\n\tbool f=0;\n\tchar ch=getchar();\n\twhile(ch<'0'||ch>'9'){\n\t\tif(ch=='-') f^=1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0'&&ch<='9'){\n\t\tx=(x<<3)+(x<<1)+ch-'0';\n\t\tch=getchar();\n\t}\n\tif(f) return -x;\n\treturn x;\n}\nvoid write(int x){\n\tif(x<0){\n\t\tputchar('-');\n\t\twrite(-x);\n\t\treturn;\n\t}\n\tif(x/10) write(x/10);\n\tputchar(x%10+'0');\n}\nvoid we(int x){\n\twrite(x);\n\tputchar('\\n');\n}\nconst int mod=32465177;\nint l,r,t,n,f[1000010],mu[1000010],h[1000010],prime[1000010],tot,v[1000010];\nbool check[1000010];\ninline int ksm(int x,int y){\n\tint ret=1;\n\twhile(y){\n\t\tif(y&1) ret=1ll*ret*x%mod;\n\t\ty>>=1;\n\t\tx=1ll*x*x%mod;\n\t}\n\treturn ret;\n}\ninline int qumo(int x,int mo){\n\treturn (x%mo+mo)%mo;\n}\nvoid init(){\n\tmu[1]=1;\n\tf[1]=1;\n\tv[1]=1;\n\tfor(int i=2;i<=n;i++){\n\t\tf[i]=1ll*f[i-1]*ksm(i,i)%mod;\n\t\tv[i]=1;\n\t\tif(!check[i]){\n\t\t\tprime[tot++]=i;\n\t\t\tmu[i]=-1;\n\t\t}\n\t\tfor(int j=0;j<tot&&i*prime[j]<=n;j++){\n\t\t\tint tmp=i*prime[j];\n\t\t\tcheck[tmp]=1;\n\t\t\tif(i%prime[j]==0){\n\t\t\t\tmu[tmp]=0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmu[tmp]=mu[i]*mu[prime[j]];\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;i*j<=n;j++){\n\t\t\th[i*j]=qumo(h[i*j]+mu[i]*i,mod-1);\n\t\t\tv[i*j]=1ll*v[i*j]*ksm(i,i*mu[i]+mod-1)%mod;\n\t\t}\n\t}\n\tv[0]=1;\n\tfor(int i=1;i<=n;i++){\n\t\tv[i]=ksm(1ll*ksm(i,h[i])*v[i]%mod,i);\n\t\th[i]=1ll*h[i]*i%(mod-1);\n\t}\n\tfor(int i=2;i<=n;i++){\n\t\tv[i]=1ll*v[i-1]*v[i]%mod;\n\t\th[i]=(h[i]+h[i-1])%(mod-1);\n\t}\n}\n\ninline int s(int x){\n\treturn 1ll*x*(x+1)/2%(mod-1);\n}\ninline int g(int x,int y){\n\treturn 1ll*ksm(f[x],s(y))*ksm(f[y],s(x))%mod;\n}\ninline int qzh(int l,int r){\n\treturn qumo(h[r]-h[l-1],mod-1);\n}\ninline int qzj(int l,int r){\n\treturn 1ll*v[r]*ksm(v[l-1],mod-2)%mod;\n}\nint work(int a,int b){\n\tif(a>b) swap(a,b);\n\tint ret=1;\n\tfor(int i=1,j;i<=a;i=j+1){\n\t\tj=mn(a/(a/i),b/(b/i));\n\t\tret=1ll*ret*ksm(g(a/i,b/i),qzh(i,j))%mod*ksm(qzj(i,j),1ll*s(a/i)*s(b/i)%(mod-1))%mod;\n\t}\n\treturn ret;\n}\nint wor(int l,int r){\n\tswap(l,r);\n\tint ans1=1ll*work(r,r)*work(l-1,l-1)%mod,ans2=1ll*work(r,l-1)*work(l-1,r)%mod;\n\treturn 1ll*ans1*ksm(ans2,mod-2)%mod;\n}\nint main(){\n\tt=read();\n\tn=read();\n\tinit();\n\twhile(t--){\n\t\twe(wor(read(),read()));\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1624543013,
        "uid": 289230,
        "name": "ricky0916",
        "ccfLevel": 7,
        "title": "\u6807\u9898"
    }
]