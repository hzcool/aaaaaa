[
    {
        "content": "\u5386\u65f6\u4e09\u5929\uff0c\u5199\u4ee3\u7801\u65f6\u95f4\u56db\u4e2a\u534a\u5c0f\u65f6\u3002\u91cd\u6784\u4e00\u6b21\uff0c\u4ee3\u7801\u603b\u957f\u5ea6\u7ea6 30k\uff0cAC \u4ee3\u7801 8.53kb\u3002\n\n\u53e6\u5916\u5410\u69fd\u4e00\u4e0b\u8fd9\u9053\u9898\u7684\u51fa\u9898\u4eba\u662f\u4e0d\u662f\u4e0d\u592a\u4f1a\u6253\u9ebb\u5c06\uff08 \u660e\u660e\u6709\u66f4\u597d\u7406\u89e3\u7684\u5411\u542c\u5b9a\u4e49\u7136\u800c\u641e\u4e86\u4e2a\u548c\u724c\u8ddd\u79bb\u5f04\u4e86\u6211\u534a\u5929\u3002\n\n---\n\n\u9996\u5148\u5f00\u4e00\u4e2a `class` \u7c7b\u662f\u4f20\u7edf\u827a\u80fd\u3002\u56e0\u4e3a\u6784\u9020\u51fd\u6570\u4e0d\u77e5\u9053\u5e72\u4ec0\u4e48\u5c31\u5360\u4e86\u4e2a\u4f4d\uff0c\u6790\u6784\u51fd\u6570\u6bd4\u8f83\u597d\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u5b58\u4e0b\u51e0\u4e2a\u4fe1\u606f\uff0c\u5373 `isWon` \u662f\u5426\u6709\u4eba\u548c\u724c\uff0c`wonWay` \u8868\u793a\u548c\u724c\u65b9\u5f0f\u3002\u53e6\u5916\u5b58\u4e0b\u4e00\u4e2a\u503c `ope`\uff0c\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u591a\u7528\uff0c\u65e2\u53ef\u4ee5\u8868\u793a\u5f53\u524d\u662f\u8c01**\u51fa\u724c**\uff08\u4e0d\u662f\u6478\u724c\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u9e23\u724c\u4f1a\u8df3\u8fc7\u6478\u724c\uff09\uff0c\u4e5f\u53ef\u4ee5\u8868\u793a\u5728\u7ed3\u675f\u4e4b\u65f6\u8c01\u8d62\u4e86\u3002\n\n\u6839\u636e\u8fd9\u4e2a\u5199\u4e00\u4e0b\u51fd\u6570\u3002\u7528\u6790\u6784\u51fd\u6570\u7684\u539f\u56e0\u662f\u5f53\u8fc7\u7a0b\u7ed3\u675f\u8fd9\u4e2a\u51fd\u6570\u4f1a\u81ea\u52a8\u6267\u884c\u3002\n\n```cpp\n\tbool isWon=false;\n\tint wonWay=0;\n\tchar gameEnding[3][10]={\"\",\"RON\",\"SELFDRAWN\"};\n\tMahjongGame(){}\n\t~MahjongGame()\n\t{\n\t\tif(!isWon)\tputs(\"DRAW\");\n\t\telse\tprintf(\"%s %s\\n%s WIN\\n\",playerName[ope],gameEnding[wonWay],playerName[ope]);\n\t}\n```\n\n\u634b\u4e00\u904d\u8fc7\u7a0b\u3002\u9996\u5148\u6211\u4eec\u9700\u8981\u5c06\u724c\u5c71\u8bfb\u4e0b\u6765\u3002\u6211\u4eec\u9700\u8981\u5199\u4e00\u4e2a\u51fd\u6570\u5b8c\u6210\u724c\u7684\u540d\u79f0\u4e0e\u7f16\u53f7\u7684\u8f6c\u5316\u3002\u81f3\u4e8e\u4e0d\u9700\u8981\u5199\u7f16\u53f7\u8f6c\u5316\u6210\u724c\u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u4ee5\u5f88\u7b80\u5355\u7684\u7528\u5b57\u7b26\u4e32\u6570\u7ec4\u5b8c\u6210\u8fd9\u4e2a\u8fc7\u7a0b\u3002\n\n```cpp\n\tchar brickName[40][10]=\n\t{\n\t\t\"\",\n\t\t\"1M\",\"2M\",\"3M\",\"4M\",\"5M\",\"6M\",\"7M\",\"8M\",\"9M\",\n\t\t\"1P\",\"2P\",\"3P\",\"4P\",\"5P\",\"6P\",\"7P\",\"8P\",\"9P\",\n\t\t\"1S\",\"2S\",\"3S\",\"4S\",\"5S\",\"6S\",\"7S\",\"8S\",\"9S\",\n\t\t\"E\",\"S\",\"W\",\"N\",\"B\",\"F\",\"Z\",\n\t\t\"DOUBLE\",\"REVERSE\",\"PASS\"\n\t};\n\tint nameTrans(char *s)\n\t{\n\t\tint len=int(strlen(s));\n\t\tif(len==1)\n\t\t{\n\t\t\tswitch (s[0])\n\t\t\t{\n\t\t\t\tcase 'E':\treturn 28;\n\t\t\t\tcase 'S':\treturn 29;\n\t\t\t\tcase 'W':\treturn 30;\n\t\t\t\tcase 'N':\treturn 31;\n\t\t\t\tcase 'B':\treturn 32;\n\t\t\t\tcase 'F':\treturn 33;\n\t\t\t\tcase 'Z':\treturn 34;\n\t\t\t}\n\t\t}\n\t\telse if(len==2)\n\t\t{\n\t\t\tint p=s[0]-'0';\n\t\t\tswitch (s[1])\n\t\t\t{\n\t\t\t\tcase 'M':\treturn p;\n\t\t\t\tcase 'P':\treturn p+9;\n\t\t\t\tcase 'S':\treturn p+18;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tswitch(s[0])\n\t\t\t{\n\t\t\t\tcase 'D':\treturn 35;\n\t\t\t\tcase 'R':\treturn 36;\n\t\t\t\tcase 'P':\treturn 37;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n```\n\n\u8003\u8651\u4e0e\u724c\u6709\u5173\u7684\uff0c\u9700\u8981\u4fdd\u5b58\u4e0b\u6765\u7684\u4fe1\u606f\u3002\u65e0\u7591\u6211\u4eec\u9700\u8981\u4fdd\u5b58\u6bcf\u4e2a\u73a9\u5bb6\u7684\u724c\u662f\u4ec0\u4e48\uff0c\u6709\u591a\u5c11\u5f20\u724c\uff0c\u6bcf\u4e2a\u73a9\u5bb6\u6240\u62e5\u6709\u7684\u6bcf\u79cd\u724c\u7684\u6570\u91cf\u4ee5\u53ca\u724c\u5c71\u3002\u5199\u4e00\u4e2a\u8bfb\u724c\u5c71\u7684\u51fd\u6570\uff1a\n\n```cpp\n\tvoid Initialization()\n\t{\n\t\tfor(int i=1;i<=148;++i)\n\t\t{\n\t\t\tchar s[10];\n\t\t\tscanf(\"%s\",s);\n\t\t\tbrickHill[i]=nameTrans(s);\n\t\t}\n\t}\n```\n\n\u7136\u540e\u6211\u4eec\u9700\u8981\u53d1\u724c\u3002\u5728\u8fd9\u91cc\u6bd4\u8f83\u597d\u5904\u7406\u7684\u65b9\u6cd5\u662f\u4e00\u5f00\u59cb\u5c31\u53ea\u7ed9\u6bcf\u4e2a\u4eba\u53d1 $13$ \u5f20\u724c\u3002\u5bf9\u4e8e\u73a9\u5bb6 `A` \u53d1 $14$ \u5f20\u53ef\u4ee5\u770b\u6210\u53d1\u4e86 $13$ \u5f20\u724c\u5e76\u4e14\u6478\u724c\u8fdb\u884c\u51fa\u724c\u64cd\u4f5c\u3002\n\n\u540c\u65f6\u6211\u4eec\u9700\u8981\u5199\u51e0\u4e2a\u57fa\u672c\u51fd\u6570\u53bb\u8f85\u52a9\u3002\u6bd4\u5982\u8c03\u6574\u5f53\u524d\u67d0\u4e2a\u73a9\u5bb6\u7684\u724c\uff08\u6309\u987a\u5e8f\uff0c\u5b9e\u73b0\u5c31\u662f\u4e00\u4e2a `sort`\uff09\uff1b\u5f97\u5230\u724c\u4ee5\u53ca\u6254\u6389\u724c\uff0c\u8f93\u51fa\u5f97\u5230\u724c\u4ee5\u53ca\u6254\u6389\u724c\u7684\u4fe1\u606f\uff08\u6ce8\u610f\u8981\u5305\u542b `PASS` \u7684\u7279\u6b8a\u7528\u6cd5\uff09\uff1b\u4e0b\u4e00\u4e2a\u73a9\u5bb6\u662f\u8c01\uff0c\u4e0a\u4e00\u4e2a\u73a9\u5bb6\u662f\u8c01\uff1b\u8c03\u6574\u53ef\u80fd\u51fa\u73b0\u9519\u8bef\u7684\u5f53\u524d\u64cd\u4f5c\u7528\u6237\u4fe1\u606f\uff08\u6bd4\u5982 $5 \\to 1,0 \\to 4$\uff09\u3002\u5b9a\u4e49\u4e24\u4e2a\u53d8\u91cf `ope` \u4e0e `rev`\uff08`ope` \u610f\u4e49\u5982\u4e0a\uff0c`rev` \u8868\u793a\u5f53\u524d\u7684\u987a\u5e8f\u662f\u4ec0\u4e48\uff1a$1$ \u4ee3\u8868\u6b63\u5e8f\uff0c$-1$ \u4ee3\u8868\u53cd\u5e8f\u3002\u4e24\u4e2a\u53d8\u91cf\u521d\u59cb\u503c\u7686\u4e3a $1$\uff09\n\n```cpp\n\tvoid adjustBricks(int who){sort(brick[who]+1,brick[who]+1+brickCnt[who]);}\n\tvoid getBrick(int who,int wch)\n\t{\n\t\t++brickApp[who][wch];\n\t\t++brickCnt[who];\n\t\tbrick[who][brickCnt[who]]=wch;\n\t\tadjustBricks(who);\n\t}\n\tvoid outBrick(int who,int wch)\n\t{\n\t\t--brickApp[who][wch];\n\t\tfor(int i=1;i<=brickCnt[who];++i)\n\t\t{\n\t\t\tif(brick[who][i]==wch)\n\t\t\t{\n\t\t\t\tfor(int j=i+1;j<=brickCnt[who];++j)\tbrick[who][j-1]=brick[who][j];\n\t\t\t\tbrick[who][brickCnt[who]]=0;\n\t\t\t\t--brickCnt[who];\n\t\t\t\treturn ;\n\t\t\t}\n\t\t}\n\t}\n\tint fixOpe(int wch)\n\t{\n\t\tif(wch==5)\twch=1;\n\t\tif(wch==0)\twch=4;\n\t\treturn wch;\n\t} \n\tvoid outputGetBrick(int who,int wch){printf(\"%s IN %s\\n\",playerName[who],brickName[wch]);}\n\tvoid outputOutBrick(int who,int wch)\n\t{\n\t\tprintf(\"%s OUT %s\",playerName[who],brickName[wch]);\n\t\tif(wch==37)\tprintf(\" %s\",playerName[fixOpe(who+rev)]);\n\t\tputs(\"\");\n\t}\n\tvoid dealBrick()\n\t{\n\t\tfor(int i=1;i<=52;++i)\n\t\t{\n\t\t\tint who=i%4;\n\t\t\tif(!who)\twho=4;\n\t\t\tgetBrick(who,brickHill[i]);\n\t\t\toutputGetBrick(who,brickHill[i]);\n\t\t}\n\t}\n\tint nxtPlayer(int who){return fixOpe(who+rev);}\n\tint lasPlayer(int who){return fixOpe(who-rev);}\n```\n\n\u5176\u4ed6\u7684\u4e1c\u897f\u6bd4\u8f83\u590d\u6742\u3002\u6211\u4eec\u5148\u8003\u8651\u600e\u4e48\u5199\u6211\u4eec\u7684\u4e3b\u8981\u6267\u884c\u51fd\u6570 `void execute()`\u3002\n\n\u9996\u5148\u80af\u5b9a\u9700\u8981\u6267\u884c\u4e00\u6b21 `Initialization()` \u4e0e `dealBrick()` \u51fd\u6570\u3002\u7136\u540e\u679a\u4e3e\u5f53\u524d\u7684\u724c\u7528\u5230\u54ea\u91cc\u4e86\u3002\u7528\u4e00\u4e2a `cnt` \u5b58\u4e0b\u6765\u3002\u521d\u59cb\u503c\u8bbe\u6210 $53$\uff0c\u56e0\u4e3a\u524d\u9762\u7684 $52$ \u5f20\u724c\u5df2\u7ecf\u53d1\u51fa\u53bb\u4e86\u3002\n\n\u7136\u540e\u6267\u884c\u4e00\u6b21 `getBrick(ope,brickHill[cnt])` \u4e0e `outputGetBrick(ope,brickHill[cnt])`\uff0c\u8868\u793a\u53d1\u724c\u7684\u8fc7\u7a0b\u3002\u7136\u540e\u5199\u4e00\u4e2a\u51fd\u6570 `bool isTsumo(int who)` \u8868\u793a\u5f53\u524d\u8fd9\u4e2a\u4eba\u624b\u4e2d\u7684\u724c\u662f\u5426\u81ea\u6478\u4e86\uff08\u56e0\u4e3a\u6d89\u53ca\u5230\u542c\u724c\u8ddd\u79bb\u4e00\u6982\u5ff5\u6682\u4e14\u4e0d\u8c08\uff0c\u5b9e\u9645\u4e0a\u5224\u65ad\u662f\u5426\u81ea\u6478\u8fd8\u6709\u4e00\u4e2a\u8d2a\u5fc3\u505a\u6cd5\uff09\uff0c\u90a3\u4e48\u6e38\u620f\u7ed3\u675f\uff0c`isWon` \u7f6e\u4e3a `true` \u5e76\u4e14 `wonWay` \u7f6e\u4e3a $2$\uff0c\u9000\u51fa\u7a0b\u5e8f\u3002\u5426\u5219\u9700\u8981\u5199\u4e00\u4e2a\u51fd\u6570 `void outBricker(int who)`\uff0c\u8868\u793a\u5bf9\u8be5\u73a9\u5bb6\u8fdb\u884c\u4e00\u6b21\u51fa\u724c\u64cd\u4f5c\u3002\u7136\u540e\u5c06\u73a9\u5bb6\u7f6e\u4e3a\u4e0b\u4e00\u4e2a\u73a9\u5bb6\uff0c\u5e76\u4e14\u5c06 `cnt` \u81ea\u589e $1$\u3002\u6839\u636e\u601d\u8def\u5199\u51fa\u4ee3\u7801\u3002\n\n```cpp\n\tvoid execute()\n\t{\n\t\tInitialization();\n\t\tdealBrick();\n\t\tint cnt=53;\n\t\twhile(cnt<=148)\n\t\t{\n\t\t\tgetBrick(ope,brickHill[cnt]);\n\t\t\toutputGetBrick(ope,brickHill[cnt]);\n\t\t\tif(isTsumo(ope))\n\t\t\t{\n\t\t\t\tisWon=true;\n\t\t\t\twonWay=2;\n\t\t\t\texit(0);\n\t\t\t}\n\t\t\toutBricker(ope);\n\t\t\tope=nxtPlayer(ope);\n\t\t\t++cnt;\n\t\t}\n\t}\n```\n\n\u8fd9\u91cc\u4e0d\u628a\u53d1\u724c\u653e\u5165 `void outBricker(int)` \u51fd\u6570\u4e2d\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u53ef\u80fd\u4f1a\u51fa\u73b0\u9e23\u724c\u9700\u8981\u9012\u5f52\u7684\u60c5\u51b5\uff0c\u4e3a\u4e86\u65b9\u4fbf\u5c06\u6478\u724c\u64cd\u4f5c\u62ff\u51fa\u6765\uff0c\u4f20\u53c2\u7684\u539f\u56e0\u4e5f\u662f\u56e0\u4e3a\u80fd\u591f\u65b9\u4fbf\u9012\u5f52\u3002\n\n\u7136\u540e\u8003\u8651 `void outBricker(int)` \u51fd\u6570\u7684\u5b9e\u73b0\u3002\n\n\u6839\u636e\u9898\u76ee\u6240\u8ff0\uff0c\u6211\u4eec\u9700\u8981\u6309 `PASS`\u3001`REVERSE`\u3001`DOUBLE` \u7684\u987a\u5e8f\u53bb\u5b9e\u73b0\u3002\u6839\u636e `int nameTrans(char*)` \u5185\u7f6e\u7684\u7f16\u53f7\uff0c\u5206\u522b\u4e3a $37,36,35$\uff0c\u4ee5\u6b64\u5224\u65ad\u5373\u53ef\u3002\n\n- \u5bf9\u4e8e `PASS`\uff0c\u6211\u4eec\u5c06\u5f53\u524d\u6267\u884c\u7684\u73a9\u5bb6\u7f6e\u4e3a\u4e0b\u4e00\u4e2a\u73a9\u5bb6\uff0c\u5728\u8fd4\u56de\u5230 `execute()` \u51fd\u6570\u4e2d\u5c31\u4f1a\u8df3\u8fc7\u5e94\u8be5\u88ab\u8df3\u8fc7\u7684\u73a9\u5bb6\uff1b   \n- \u5bf9\u4e8e `REVERSE`\uff0c\u6211\u4eec\u5c06 `rev` \u53d6\u53cd\u5373\u53ef\uff1b    \n- \u5bf9\u4e8e `DOUBLE`\uff0c\u6211\u4eec\u5c06\u5f53\u524d\u6267\u884c\u7684\u73a9\u5bb6\u7f6e\u4e3a\u4e0a\u4e00\u4e2a\u73a9\u5bb6\uff0c\u5728\u8fd4\u56de\u5230 `execute()` \u51fd\u6570\u4e2d\u5c31\u4f1a\u53d8\u6210\u8be5\u73a9\u5bb6\u3002\n\n\u5199\u4e00\u4e2a\u51fd\u6570 `int decideThrowBrick(int*)` \u8868\u793a\u5bf9\u4e8e\u5f53\u524d\u724c\uff0c\u5728\u9898\u76ee\u7684\u8bf4\u660e\u4e0b\u8fdb\u884c\u9009\u62e9\u4e22\u5f03\u54ea\u4e00\u5f20\u724c\u3002\u56e0\u4e3a\u8fd9\u4e2a\u4e1c\u897f\u6d89\u53ca\u5230\u7684\u4e1c\u897f\u66f4\u590d\u6742\u5728\u540e\u9762\u518d\u8bf4\u3002\n\n\u7136\u540e\u5c31\u5bf9\u5f53\u524d\u6267\u884c\u7684\u73a9\u5bb6\u5c06\u51b3\u5b9a\u6254\u51fa\u7684\u724c\u6254\u6389\u3002\u8003\u8651\u8363\u548c\u7684\u8fc7\u7a0b\uff0c\u76f8\u5f53\u4e8e\u5f97\u5230\u4e00\u5f20\u724c\u5e76\u4e14\u5224\u65ad\u662f\u5426\u81ea\u6478\u5373\u53ef\u3002\u6ce8\u610f\u987a\u5e8f\u5224\u65ad\u3002\n\n\u5982\u679c\u6709\u4eba\u8363\u548c\uff0c\u6e38\u620f\u7acb\u523b\u7ed3\u675f\uff0c\u5c06 `ope` \u7f6e\u4e3a\u8363\u548c\u7684\u4eba\u7684\u7f16\u53f7\uff0c`isWon` \u7f6e\u4e3a `true` \u5e76\u4e14 `wonWay` \u7f6e\u4e3a $1$\uff0c\u9000\u51fa\u7a0b\u5e8f\u81ea\u52a8\u6267\u884c\u6790\u6784\u51fd\u6570\u3002\n\n\u5426\u5219\u6211\u4eec\u9700\u8981\u5224\u65ad\u6709\u6ca1\u6709\u4eba\u80fd\u591f\u78b0\u3002\u5982\u679c\u80fd\u591f\u78b0\uff0c\u90a3\u6211\u4eec\u5c31\u5c06\u5f53\u524d\u7684\u9700\u8981\u51fa\u724c\u7684\u4eba\u7f6e\u4e3a\u8fd9\u4e2a\u4eba\uff0c\u7136\u540e\u518d\u9012\u5f52\u6267\u884c `outBricker` \u51fd\u6570\u5373\u53ef\u3002\n\n\u5403\u540c\u7406\u3002\u4e0d\u518d\u8d58\u8ff0\u3002\u6839\u636e\u601d\u8def\u5199\u4e0b\u4ee3\u7801\u3002\n\n```cpp\n\tvoid outBricker(int who)\n\t{\n\t\tif(brickApp[who][37])\n\t\t{\n\t\t\toutBrick(who,37);\n\t\t\toutputOutBrick(who,37);\n\t\t\tope=nxtPlayer(ope);\n\t\t\treturn ;\n\t\t}\n\t\tif(brickApp[who][36])\n\t\t{\n\t\t\toutBrick(who,36);\n\t\t\toutputOutBrick(who,36);\n\t\t\trev=-rev;\n\t\t\treturn ;\n\t\t}\n\t\tif(brickApp[who][35])\n\t\t{\n\t\t\toutBrick(who,35);\n\t\t\toutputOutBrick(who,35);\n\t\t\tope=lasPlayer(ope);\n\t\t\treturn ;\n\t\t}\n\t\tint outBrk=decideThrowBrick(brick[who]);\n\t\toutBrick(who,outBrk);\n\t\toutputOutBrick(who,outBrk);\n\t\tfor(int i=nxtPlayer(ope);i!=ope;i=nxtPlayer(i))\n\t\t{\n\t\t\tgetBrick(i,outBrk);\n\t\t\tif(isTsumo(i))\n\t\t\t{\n\t\t\t\tope=i;\n\t\t\t\tisWon=true;\n\t\t\t\twonWay=1;\n\t\t\t\texit(0);\n\t\t\t}\n\t\t\toutBrick(i,outBrk);\n\t\t}\n\t\tfor(int i=nxtPlayer(ope);i!=ope;i=nxtPlayer(i))\n\t\t{\n\t\t\tif(allowPong(i,outBrk))\n\t\t\t{\n\t\t\t\tope=i;\n\t\t\t\tPong(i,outBrk);\n\t\t\t\toutBricker(i);\n\t\t\t\treturn ;\n\t\t\t}\n\t\t}\n\t\tint i=nxtPlayer(ope),type=allowChow(i,outBrk);\n\t\tif(allowChow(i,outBrk))\n\t\t{\n\t\t\tope=i;\n\t\t\tChow(i,outBrk,type);\n\t\t\toutBricker(i);\n\t\t}\n\t}\n```\n\n\u4e8e\u662f\u6211\u4eec\u6210\u529f\u7684\u7ed9\u81ea\u5df1\u6316\u4e86\u5f88\u591a\u5751\u3002\u6309\u5403\u548c\u78b0\u53c8\u5206\u522b\u8bb2\u89e3\u3002\n\n\u9996\u5148\u6211\u4eec\u8981\u5199\u4e00\u4e2a\u8ba1\u7b97\u548c\u724c\u8ddd\u79bb\u7684\u51fd\u6570\u4ee5\u53ca\u9700\u8981\u6254\u6389\u54ea\u5f20\u724c\u7684\u51fd\u6570\uff0c\u5206\u522b\u5b9a\u4e49\u4e3a `int calcXt(int*)` \u4e0e `int decideThrowBrick(int*)`\u3002\u56e0\u4e3a\u8fd9\u4e2a\u4e1c\u897f\u662f\u6700\u6700\u590d\u6742\u7684\u6240\u4ee5\u53c8\u5ef6\u540e\u8bf4\u3002\n\n**\u6ce8\u610f\uff0c\u8fd9\u91cc\u7684\u548c\u724c\u8ddd\u79bb\u4e0d\u7b49\u540c\u4e8e\u5411\u542c**\u3002\u5982\u679c\u5f53\u524d\u5e76\u4e0d\u662f\u4f60\u51fa\u724c\u7684\u56de\u5408\uff0c\u548c\u724c\u8ddd\u79bb\u662f\u5411\u542c\u52a0\u4e00\uff1b\u5426\u5219\u5c31\u662f\u5411\u542c\u6570\u3002\u542c\u724c\u5373\u4e3a $0$ \u5411\u542c\u3002\u5bb3\u6b7b\u6211\u8fd9\u4e2a\u65e5\u9ebb\u73a9\u5bb6\u4e86\uff08\n\n\u5047\u8bbe\u8fd9\u4e24\u4e2a\u51fd\u6570\u80fd\u591f\u8fd4\u56de\u6b63\u786e\u7684\u503c\u3002\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u5224\u65ad\u662f\u5426\u80fd\u5403/\u78b0\u7684\u51fd\u6570\u3002\n\n\u5148\u8bf4\u78b0 `bool allowPong(int who,int brk)`\u3002\u9996\u5148\u5982\u679c\u8fd9\u4e2a\u4eba\u6ca1\u6709\u4e24\u5f20\u724c `brk`\uff0c\u90a3\u4e48\u80af\u5b9a\u662f\u4e0d\u53ef\u4ee5\u7684\u3002\u8ba1\u7b97\u4e00\u4e0b\u5f53\u524d\u7684\u548c\u724c\u8ddd\u79bb\uff08\u5373\u8c03\u7528 `calcXt(brick[who])`\uff09\uff0c\u7136\u540e\u6254\u51fa\u53bb\u4e24\u5f20\u518d\u7b97\u4e00\u4e0b\u548c\u724c\u8ddd\u79bb\u3002\u5982\u679c\u6254\u51fa\u53bb\u4e4b\u540e\u7684\u542c\u724c\u8ddd\u79bb\u4e25\u683c\u5c0f\u4e8e\uff08\u5373\uff0c\u5411\u542c\u6570\u5c0f\u4e8e\u7b49\u4e8e\uff09\u4e4b\u524d\u7684\u548c\u724c\u8ddd\u79bb\uff0c\u8fd9\u4e2a\u78b0\u7684\u52a8\u4f5c\u5c31\u662f\u5141\u8bb8\u7684\uff1b\u5426\u5219\u7981\u6b62\u3002\u6ce8\u610f\u5c06\u724c\u653e\u56de\u6765\u3002\n\n\u8f93\u51fa\u78b0\u8fd9\u4e2a\u52a8\u4f5c\uff08`void Pong(int who,int wch)`\uff09\u5c31\u6bd4\u8f83 naive\u3002\u76f4\u63a5\u6765\u5c31\u884c\u4e86\u3002\u6ce8\u610f\u5728\u8fd9\u4e2a\u51fd\u6570\u4e2d\u8981\u6267\u884c\u526f\u9732\u7684\u8fc7\u7a0b\u3002\n\n```cpp\n\tbool allowPong(int who,int brk)\n\t{\n\t\tif(brickApp[who][brk]<2)\treturn false;\n\t\tint nowXt=calcXt(brick[who]);\n\t\toutBrick(who,brk);\n\t\toutBrick(who,brk);\n\t\tint presentXt=calcXt(brick[who]);\n\t\tgetBrick(who,brk);\n\t\tgetBrick(who,brk);\n\t\tif(presentXt<nowXt)\treturn true;\n\t\treturn false;\n\t}\n\tvoid Pong(int who,int wch)\n\t{\n\t\tprintf(\"%s PONG %s %s %s\\n\",playerName[who],brickName[wch],brickName[wch],brickName[wch]);\n\t\toutBrick(who,wch);\n\t\toutBrick(who,wch);\n\t}\n```\n\n\u7136\u540e\u662f\u5403\u3002\u56e0\u4e3a\u5403\u6709\u4e09\u79cd\u53ef\u80fd\u5206\u522b\u5224\u65ad\u4e00\u4e0b\u548c\u724c\u8ddd\u79bb\u5373\u53ef\u3002\u6ce8\u610f\u4e0d\u8981\u5b57\u724c\u5403\u5b57\u724c\uff0c\u4e07\u5403\u7d22\u8fd9\u6837\u7684\u60c5\u51b5\u51fa\u73b0\uff08\u9884\u9632\u5c31\u53ef\u4ee5\u76f4\u63a5\u770b\u6709\u6ca1\u6709\uff0c\u4f1a\u4e0d\u4f1a\u51fa\u53bb\u7b49\u7684\u5224\u65ad\u5373\u53ef\uff09\u3002\u7136\u540e\u53d6\u6700\u5c0f\u503c\u5224\u65ad\u662f\u5426\u6bd4\u4e4b\u524d\u7684\u548c\u724c\u8ddd\u79bb\u5c0f\u5373\u53ef\u3002\u505a\u6cd5\u4e00\u6837\u3002\n\n\u6ce8\u610f\u7684\u662f\u65b9\u6848\u5177\u6709\u4f18\u5148\u7ea7\u3002\u8fd9\u4e2a\u65f6\u5019\u8fd4\u56de\u4e00\u4e2a\u65b9\u6848\u5373\u53ef\u3002\u4e0e\u6267\u884c\u5403\u8fd9\u4e2a\u64cd\u4f5c\u7684\u51fd\u6570\u4e00\u8d77\u7528\u5c31\u884c\u4e86\u3002\n\n```cpp\n\tint allowChow(int who,int wch)\n\t{\n\t\tif(wch>27)\treturn false;\n\t\tint nowXt=calcXt(brick[who]);\n\t\tint Xts[4];\n\t\tmemset(Xts,63,sizeof Xts);\n\t\tif(wch!=8 && wch!=9 && wch!=17 && wch!=18 && wch!=26 && wch!=27 && brickApp[who][wch+1] && brickApp[who][wch+2])\n\t\t{\n\t\t\toutBrick(who,wch+1);\n\t\t\toutBrick(who,wch+2);\n\t\t\tXts[3]=calcXt(brick[who]);\n\t\t\tgetBrick(who,wch+1);\n\t\t\tgetBrick(who,wch+2);\n\t\t}\n\t\tif(wch!=9 && wch!=1 && wch!=18 && wch!=10 && wch!=27 && wch!=19 && brickApp[who][wch+1] && brickApp[who][wch-1])\n\t\t{\n\t\t\toutBrick(who,wch-1);\n\t\t\toutBrick(who,wch+1);\n\t\t\tXts[2]=calcXt(brick[who]);\n\t\t\tgetBrick(who,wch-1);\n\t\t\tgetBrick(who,wch+1);\n\t\t}\n\t\tif(wch!=1 && wch!=2 && wch!=10 && wch!=11 && wch!=19 && wch!=20 && brickApp[who][wch-1] && brickApp[who][wch-2])\n\t\t{\n\t\t\toutBrick(who,wch-2);\n\t\t\toutBrick(who,wch-1);\n\t\t\tXts[1]=calcXt(brick[who]);\n\t\t\tgetBrick(who,wch-2);\n\t\t\tgetBrick(who,wch-1);\n\t\t}\n\t\tint minn=min({Xts[1],Xts[2],Xts[3]});\n\t\tif(minn>=nowXt)\treturn 0;\n\t\tif(minn==Xts[1] && minn==Xts[2] && minn==Xts[3])\treturn 3;\n\t\tif(minn==Xts[1] && minn==Xts[2] && minn!=Xts[3])\treturn 2;\n\t\tif(minn==Xts[1] && minn!=Xts[2] && minn==Xts[3])\treturn 3;\n\t\tif(minn!=Xts[1] && minn==Xts[2] && minn==Xts[3])\treturn 3;\n\t\tif(minn!=Xts[1] && minn!=Xts[2] && minn==Xts[3])\treturn 3;\n\t\tif(minn!=Xts[1] && minn==Xts[2] && minn!=Xts[3])\treturn 2;\n\t\tif(minn==Xts[1] && minn!=Xts[2] && minn!=Xts[3])\treturn 1;\n\t\treturn -1;\n\t}\n\tvoid Chow(int who,int brk,int type)\n\t{\n\t\tif(type==3)\n\t\t{\n\t\t\tprintf(\"%s CHOW %s %s %s\\n\",playerName[who],brickName[brk],brickName[brk+1],brickName[brk+2]);\n\t\t\toutBrick(who,brk+1);\n\t\t\toutBrick(who,brk+2);\n\t\t\treturn ;\n\t\t}\n\t\tif(type==2)\n\t\t{\n\t\t\tprintf(\"%s CHOW %s %s %s\\n\",playerName[who],brickName[brk-1],brickName[brk],brickName[brk+1]);\n\t\t\toutBrick(who,brk-1);\n\t\t\toutBrick(who,brk+1);\n\t\t\treturn ;\n\t\t}\n\t\tif(type==1)\n\t\t{\n\t\t\tprintf(\"%s CHOW %s %s %s\\n\",playerName[who],brickName[brk-2],brickName[brk-1],brickName[brk]);\n\t\t\toutBrick(who,brk-2);\n\t\t\toutBrick(who,brk-1);\n\t\t\treturn ;\n\t\t}\n\t}\n```\n\n\u6700\u540e\u6211\u4eec\u8fd8\u6709\u4e24\u4e2a\u51fd\u6570\u6ca1\u6709\u5b9e\u73b0\uff0c\u5373 `int calcXt(int*)` \u4e0e `int decideThrowBrick(int*)`\u3002\u66b4\u529b\u5224\u65ad\uff08\u4e00\u822c\u578b\u6700\u5927\u5411\u542c\u6570\u4e3a $7$\uff0c\u5bf9\u5e94\u548c\u724c\u8ddd\u79bb\u5e94\u8be5\u662f $8$\uff0c\u5373\u9700\u8981\u7528 $34^8$ \u6b21\u53bb\u5224\u65ad\u5411\u542c\u4e0e\u6254\u8d70\u54ea\u5f20\u724c\uff09\u80af\u5b9a\u662f\u4e0d\u884c\u7684\u3002\n\n\u4e8e\u662f\u5b9a\u4e49 $dp_{i,j,k=0 \\operatorname{or} 1,l,o}$ \u8868\u793a\u5f53\u524d\u7528\u5230\u4e86\u7b2c $i$ \u5f20\u724c\uff0c\u5df2\u7ecf\u7ec4\u4e86 $j$ \u4e2a\u9762\u5b50\uff0c\u7ec4\u4e86 $k$ \u4e2a\u5bf9\u5b50\uff08\u4e00\u5b9a\u8981\u6709\u5bf9\u5b50\uff09\uff0c\u73b0\u5728\u8fd8\u5b58\u5728 $l$ \u4e2a\u5355\u5f20\u4ee5\u53ca\u6709 $o$ \u4e2a\u642d\u5b50\u5feb\u6210\u4e3a\u987a\u5b50\uff0c\u7684\u548c\u724c\u8ddd\u79bb\u3002\n\n\u8f6c\u79fb\u7684\u8fc7\u7a0b\u548c\u5927\u591a\u6570\u9ebb\u5c06\u9898\u76ee\u4e00\u6837\u679a\u4e3e\u4e0b\u4e00\u5f20\u724c\u4f7f\u7528\u4ec0\u4e48\u3002\u81f3\u4e8e\u5b9e\u73b0\u51fa\u724c\u53ef\u4ee5\u7528\u53e6\u5916\u4e00\u4e2a\u6570\u7ec4\u4fdd\u5b58\u3002\n\n\u663e\u7136\u6211\u4eec\u5fc5\u987b\u5c06 $l$ \u4e2a\u642d\u5b50\u8865\u5168\u5e76\u65b0\u52a0\u4e0a\u4e00\u4e9b\u5355\u5f20\u3002\u5206\u60c5\u51b5\u8ba8\u8bba\uff1a\n\n- \u8865\u5168\u5b8c $l$ \u4e2a\u642d\u5b50\u4e4b\u540e\u5269\u4e0b\u4e09\u5f20\u80fd\u591f\u7ec4\u6210\u4e00\u4e2a\u65b0\u523b\u5b50\u5e76\u4e14\u7ec4\u5b8c\u4e4b\u540e\u9762\u5b50\u6570\u8fd8\u4e0d\u8d85\u8fc7\u9700\u8981\u7684\u9762\u5b50\u6570\uff1b   \n- \u8865\u5168\u5b8c $l$ \u4e2a\u642d\u5b50\u4e4b\u540e\u5269\u4e0b\u4e24\u5f20\u80fd\u591f\u7ec4\u6210\u4e00\u4e2a\u65b0\u96c0\u5934\uff08\u5bf9\u5b50\uff09\uff1b   \n- \u52a0\u5355\u5f20\u3002\n\n\u6ce8\u610f\u5b57\u724c\u7684\u7279\u6b8a\u60c5\u51b5\u3002\u6b64\u65f6\u4e0d\u5b58\u5728\u8865\u5168\u987a\u5b50\u4e00\u8bf4\u3002\n\n\u7136\u540e\u66b4\u529b\u679a\u4e3e\u5c31\u884c\u4e86\u3002\u56e0\u4e3a\u8fd9\u6837\u72b6\u6001\u6570\u8fd8\u662f\u6bd4\u8f83\u591a\uff0c\u56e0\u4e3a\u6700\u5927\u548c\u724c\u8ddd\u79bb\u5c0f\u4e8e\u7b49\u4e8e $8$\uff0c\u6240\u4ee5\u679a\u4e3e\u5230 $8$ \u5373\u53ef\u3002\n\n\u4e8e\u662f\u66b4\u529b\u8f6c\u79fb\u5373\u53ef\u3002\u4fdd\u5b58\u8be5\u6254\u6389\u54ea\u5f20\u724c\u76f4\u63a5\u653e\u5230\u72b6\u6001\u8f6c\u79fb\u5373\u53ef\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u518d\u5f00\u4e00\u4e2a\u51fd\u6570\uff0c`int calcXt(int*)` \u4e0e `int decideThrowBrick(int*)` \u5c31\u53ea\u5269\u4e0b\u4f20\u53c2\u533a\u522b\u4e86\u3002\n\n```cpp\n\t#define mp make_pair\n\tint dpExecuter(int *brk,int type)\n\t{\n\t\tint len=0,mz;\n\t\twhile(brk[len+1])\t++len;\n\t\tmz=len/3;\n\t\tsort(brk+1,brk+1+len);\n\t\tint dp[40][5][2][3][3],brkApp[40],usf[40][5][2][3][3];\n\t\tmemset(brkApp,0,sizeof brkApp);\n\t\tfor(int i=1;i<=len;++i)\t++brkApp[brk[i]];\n\t\tmemset(dp,63,sizeof dp);\n\t\tmemset(usf,-1,sizeof usf);\n\t\tdp[0][0][0][0][0]=0;\n\t\tfor(int i=0;i<=33;++i)\n\t\t{\n\t\t\tfor(int j=0;j<=mz;++j)\n\t\t\t{\n\t\t\t\tfor(int k=0;k<=1;++k)\n\t\t\t\t{\n\t\t\t\t\tfor(int l=0;l<=2 && l+j<=mz;++l)\n\t\t\t\t\t{\n\t\t\t\t\t\tfor(int o=0;o<=2 && o+l+j<=mz;++o)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif(dp[i][j][k][l][o]<=8)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfor(int nxtUse=l+o;nxtUse<=4;++nxtUse)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tint dx=dp[i][j][k][l][o]+max(0,nxtUse-brkApp[i+1]),dy=(brkApp[i+1]>nxtUse?i+1:usf[i][j][k][l][o]);\n\t\t\t\t\t\t\t\t\tpair<int,int> mvdStatement=mp(dx,dy);\n\t\t\t\t\t\t\t\t\tint rest=nxtUse-l-o;\n\t\t\t\t\t\t\t\t\tif(rest>=3 && j+l+1<=mz)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tpair<int,int> Statement=lesserPair(mp(dp[i+1][j+l+1][k][o][rest-3],usf[i+1][j+l+1][k][o][rest-3]),mvdStatement);\n\t\t\t\t\t\t\t\t\t\tdp[i+1][j+l+1][k][o][rest-3]=Statement.first,usf[i+1][j+l+1][k][o][rest-3]=Statement.second;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif(rest>=2 && !k)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tpair<int,int> Statement=lesserPair(mp(dp[i+1][j+l][k+1][o][rest-2],usf[i+1][j+l][k+1][o][rest-2]),mvdStatement);\n\t\t\t\t\t\t\t\t\t\tdp[i+1][j+l][k+1][o][rest-2]=Statement.first,usf[i+1][j+l][k+1][o][rest-2]=Statement.second;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif(rest<=2)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tpair<int,int> Statement=lesserPair(mp(dp[i+1][j+l][k][o][rest],usf[i+1][j+l][k][o][rest]),mvdStatement);\n\t\t\t\t\t\t\t\t\t\tdp[i+1][j+l][k][o][rest]=Statement.first,usf[i+1][j+l][k][o][rest]=Statement.second;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(i%9==0 || i>=27)\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(i%9==0 || i>=27)\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(type==1)\treturn dp[34][mz][1][0][0];\n\t\treturn usf[34][mz][1][0][0];\n\t}\n\t#undef mp\n\tint calcXt(int *brk){return dpExecuter(brk,1);}\n\tint decideThrowBrick(int *brk){return dpExecuter(brk,2);}\n```\n\n\u5c06\u8fd9\u4e2a\u7c7b\u53d6\u540d `MahjongGame`\uff0c\u5b9a\u4e49\u4e00\u4e2a `MahjongGame` \u7c7b\u7684\u53d8\u91cf `MainGame`\u3002\u4e3b\u51fd\u6570\u53ea\u9700\u8981\u6267\u884c `MainGame.execute()` \u5373\u53ef\u3002\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u4e0d\u7b97\u592a\u8fc7\u6761\u7406\u6e05\u6670\u5730\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\n\n\u56e0\u4e3a\u6240\u6709\u7684\u6a21\u5757\u90fd\u653e\u8fc7\u4e00\u904d\u4e86\uff0c\u6240\u4ee5[\u5b8c\u6574\u4ee3\u7801](https://www.luogu.com.cn/paste/hhijcyk3)\u6254 Luogu \u4e91\u526a\u8d34\u677f\u5427\u3002",
        "postTime": 1608798546,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P7147 \u3010[THUPC2021 \u521d\u8d5b]\u9ebb\u5c06\u6a21\u62df\u5668\u3011"
    },
    {
        "content": "#### \u5199\u5728\u524d\u9762\n\n\u5927\u5bb6\u597d\u6211\u662f\u6ce5\u840c\u53ef\u7231\u7684\u51fa\u9898\u4ebaliuzhangfeiabc~\n\n(\u522b\u9a82\u4e86\u6211\u77e5\u9053\u9519\u4e86\u5624\u5624\u5624)\n\n\u8bf4\u8d77\u6765\u4e3a\u4ec0\u4e48\u4f1a\u8ba9\u6211\u8fd9\u4e2a\u5927\u4e00\u840c\u65b0\u6765\u51fa\u8fd9\u79cd\u9898\u5462\u2026\u2026~~\u5582\u8fd9\u4e48\u6bd2\u7624\u7684\u9898\u9664\u4e86\u4f60\u8fd8\u6709\u8c01\u4f1a\u611f\u5174\u8da3~~\n\n\u5927\u5bb6\u542c\u6211\u63a9\u9970\uff0c\u54e6\u4e0d\uff0c\u89e3\u91ca\uff0c\u4e8b\u60c5\u662f\u8fd9\u6837\u7684\u2026\u2026\u6700\u521d\u4ed6\u4eec\u7ec4\u597d\u9898\u4e4b\u540e\u53d1\u73b0\u6309\u5f80\u5e74\u60ef\u4f8b\u7f3a\u4e00\u9053\u6a21\u62df\uff0c\u7136\u540e\u5c31\u627e\u5230\u4e86\u6211\n\n\uff08\u4e3a\u4ec0\u4e48\u8981\u627e\u6211\u554a\uff1f\u6211\u4e5f\u4e0d\u60f3\u554aqwq\uff09\n\n~~\u4e3a\u4ec0\u4e48\u627e\u4f60\u4f60\u81ea\u5df1\u5fc3\u91cc\u8fd8\u4e0d\u6e05\u695a~~\n\n\u603b\u4e4b\u63a5\u4e86\u8fd9\u4e2a\u6d3b\u4e4b\u540e\uff0c\u6309\u5f80\u5e74\u60ef\u4f8b\u4e00\u822c\u5927\u6a21\u62df\u4f1a\u4ee5\u4e00\u4e2a\u6e38\u620f\u4e3a\u80cc\u666f\uff08\u6bd4\u5982[P5380 [THUPC2019]\u9e2d\u68cb](https://www.luogu.com.cn/problem/P5380)\uff09\uff0c\u7136\u540e\u6211\u5c31\u81ea\u7136\u800c\u7136\u5730\u60f3\u5230\u53bb\u5e74\u6574\u4e2a\u673a\u623f\u88ab\u9ebb\u5c06\u652f\u914d\u7684\u6050\u60e7\u2026\u2026\n\n\u4f46\u662f\u5427\u9274\u4e8e\u6211\u7684\u9ebb\u5c06\u6c34\u5e73\u4e5f\u5c31\u90a3\u6837\uff0c\u96c0\u9b42\u53ea\u6709\u4e00\u4e2a\u521a\u6253\u4e0a\u96c0\u58eb1\u5c31\u5f03\u4e86\u7684\u53f7\uff0c\u4e5f\u5c31\u52c9\u5f3a\u80fd\u5206\u6e05\u65e5\u9ebb\u89c4\u5219\u548c\u56fd\u6807\u89c4\u5219\u7684\u7a0b\u5ea6\uff0c\u4e8e\u662f\u9020\u9898\u7684\u65f6\u5019\u5c31\u5f88\u968f\u5fc3\u6240\u6b32\uff08\u6bd4\u5982\u6211\u9898\u9762\u91cc\u7528\u7684\u672f\u8bed\u7b80\u76f4\u662f\u4e71\u4e03\u516b\u7cdf\u5927\u6742\u70e9\uff09\uff0c\u5230\u6700\u540e\u63a7\u5236\u4e0d\u4f4f\u8111\u6d1e\u4e86\u53c8\u52a0\u4e86\u70b9\u7279\u6b8a\u724c\u3002\u5f53\u7136\u6700\u540e\u51fa\u51fa\u6765\u7684\u7ed3\u679c\u662f\u53d7\u5230\u4e86\u51fa\u9898\u7ec4\u7684\u4e00\u81f4\u597d\uff08tu\uff09\u8bc4\uff08cao\uff09(\u9003\n\n\u884c\u5427\u6211\u4eec\u6765\u770b\u9898\u89e3\uff0c\u5f53\u7136\u4f5c\u4e3a\u5927\u6a21\u62df\u6211\u662f\u4e0d\u662f\u53ea\u8981\u5199\u4e00\u4e2a\u201c\u672c\u9898\u6309\u7167\u9898\u610f\u6a21\u62df\u5373\u53ef\u201d\u5c31\u53ef\u4ee5\u6e9c\u4e86\u2026\u2026\u5582\u5582\u5582\u5927\u5bb6\u522b\u8d70\u554a\uff0c\u5582\uff01\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u4e00\u4e2a\u6a21\u5757\u4e00\u4e2a\u6a21\u5757\u5730\u770b\u5427\uff1a\n\n\n\n#### \u5404\u79cd\u5b9a\u4e49\n\n```cpp\n#define gc getchar()\n#define pc putchar\n#define pii pair<int,int>\n#define fi first\n#define se second\n#define mp make_pair\nint pai[200],head = 1,fx = 1;\nstruct player{\n\tint a[20],sum;\n\tbool pass;\n}p[4]; \n```\n\n\u7ed3\u6784\u4f53`player`\u5b9a\u4e49\u4e00\u540d\u73a9\u5bb6\uff0c\u5176\u4e2d`a`\u6570\u7ec4\u8868\u793a\u4ed6\u73b0\u6709\u7684\u724c\uff0c`sum`\u4e3a\u624b\u724c\u6570\uff0c`pass`\u8bb0\u5f55\u4ed6\u6709\u6ca1\u6709\u88abpass\u3002\n\n`pai`\u8868\u793a\u724c\u5806\uff0c`head`\u8868\u793a\u724c\u5806\u9876\uff0c`fx`\u8868\u793a\u6e38\u620f\u8fdb\u884c\u7684\u987a\u5e8f\u3002\n\n\n\n#### \u8f93\u5165\u8f93\u51fa\u5904\u7406\n\n\u6211\u7684\u5904\u7406\u65b9\u6cd5\u662f\u628a\u8f93\u5165\u8fdb\u6765\u7684\u6bcf\u4e00\u5f20\u724c\u53d8\u62101~37\u7684\u6570\u5b57\u8fdb\u884c\u5b58\u50a8\uff0c\u8f93\u51fa\u7684\u65f6\u5019\u518d\u8fd8\u539f\u6210\u724c\u7684\u540d\u79f0\u3002\n\n\u8f93\u5165\u5904\u7406\u5c31\u662f\u4e00\u5806case:\n\n```cpp\nint i,j,l;\nstring st;\nfor(i = 1;i <= 148;++i){\n    cin>>st;\n    if(st[0] >= '1' && st[0] <= '9'){\n        l = st[0] - '0';\n        switch(st[1]){\n            case 'M' : pai[i] = l;break;\n            case 'P' : pai[i] = l + 9;break;\n            case 'S' : pai[i] = l + 18;break;\n        }\n    }\n    else{\n        switch(st[0]){\n            case 'E' : pai[i] = 28;break;\n            case 'S' : pai[i] = 29;break;\n            case 'W' : pai[i] = 30;break;\n            case 'N' : pai[i] = 31;break;\n            case 'B' : pai[i] = 32;break;\n            case 'F' : pai[i] = 33;break;\n            case 'Z' : pai[i] = 34;break;\n            case 'D' : pai[i] = 35;break;\n            case 'R' : pai[i] = 36;break;\n            case 'P' : pai[i] = 37;break;\n        }\n    }\n}\n```\n\n\u8f93\u51fa\u7684\u65f6\u5019\uff0c\u5148\u5199\u4e86\u4e00\u4e2a\u8f93\u51fa\u67d0\u7279\u5b9a\u7f16\u53f7\u724c\u7684\u51fd\u6570\uff0c\u4e5f\u6ca1\u6709\u4ec0\u4e48\u96be\u5ea6\uff1a\n\n```cpp\ninline void outpai(int paii){//\u8f93\u51fapaii\u8fd9\u4e00\u5f20\u724c\n\tif(paii <= 27) cout<<(paii - 1) % 9 + 1<<(\"MPS\"[(paii - 1) / 9]);\n\telse if(paii <= 34) cout<<(\"ESWNBFZ\"[paii - 28]);\n\telse if(paii == 35) cout<<\"DOUBLE\";\n\telse if(paii == 36) cout<<\"REVERSE\";\n\telse cout<<\"PASS\";\n}\n```\n\n\u6709\u4e86\u8fd9\u4e2a\u4e4b\u540e\u6765\u5b9e\u73b0\u9898\u76ee\u8981\u6c42\u7684\u51e0\u79cd\u8f93\u51fa\u5c31\u6bd4\u8f83\u81ea\u7136\u4e86\uff1a\n\n```cpp\ninline void draw(){//\u8f93\u51fa\u5e73\u5c40 \n\tcout<<\"DRAW\"<<endl;\n\texit(0);\n}\ninline void win(int x){//\u8f93\u51fax\u83b7\u80dc \n\tpc(x + 'A');pc(' ');cout<<\"WIN\"<<endl;\n\texit(0);\n} \ninline void hupai(int x){//\u8f93\u51fax\u8363\u548c \n\tpc(x + 'A');cout<<\" RON\"<<endl;\n\twin(x);\n}\ninline void zimo(int x){//\u8f93\u51fax\u81ea\u6478 \n\tpc(x + 'A');cout<<\" SELFDRAWN\"<<endl;\n\twin(x);\n}\ninline void in(int x,int paii){//\u8f93\u51fax\u6478\u724cpaii \n\tpc(x + 'A');cout<<\" IN \";\n\toutpai(paii);pc('\\n');\n}\ninline void out(int x,int paii,int fg = -1){//\u8f93\u51fax\u51fa\u724cpaii\uff0c\u7279\u5224pass \n\tpc(x + 'A');cout<<\" OUT \";\n\toutpai(paii);\n\tif(fg >= 0) pc(' '),pc(fg + 'A');\n\tpc('\\n');\n}\ninline void outchi(int x,int paii){//\u8f93\u51fax\u5403\uff0c\u5403\u7684\u7b2c\u4e00\u5f20\u724c\u662fpaii \n\tpc(x + 'A');cout<<\" CHOW \";\n\toutpai(paii);pc(' ');outpai(paii + 1);pc(' ');outpai(paii + 2);pc('\\n');\n}\ninline void outpeng(int x,int paii){//\u8f93\u51fax\u78b0paii \n\tpc(x + 'A');cout<<\" PONG \";\n\toutpai(paii);pc(' ');outpai(paii);pc(' ');outpai(paii);pc('\\n');\n}\n```\n\n\n\n#### \u8fdb\u884c\u56de\u5408\u3001\u6478\u724c\n\n```cpp\nint play(int x){//\u73a9\u5bb6x\u8fdb\u884c\u56de\u5408\n\tif(p[x].pass){\n\t\tp[x].pass = 0;\n\t\treturn nxt(x);\n\t}\n\tmopai(x);\n\treturn chupai(x);\n}\n```\n\n\u8fd9\u4e2a\u6846\u67b6\u5f88\u7b80\u5355\u3002\u4e00\u4e0a\u6765\u662f\u5224`pass`\uff0c\u8fd9\u4e2a`nxt`\u8868\u793a\u4e0b\u5bb6\uff1a\n\n```cpp\n#define nxt(x) (((x) + fx + 4) % 4)\n```\n\n\u6478\u724c\u4e5f\u76f8\u5bf9\u7b80\u5355\uff1a\n\n```cpp\ninline void mopai(int x){//\u73a9\u5bb6x\u6478\u724c \n\tif(head > 148) draw();\n\tp[x].a[++p[x].sum] = pai[head++];\n\tin(x,p[x].a[p[x].sum]);\n\tsort(p[x].a + 1,p[x].a + p[x].sum + 1);\n}\n```\n\n\u6478\u5b8c\u724c\u6700\u597d\u6574\u7406\u4e00\u4e0b\u624b\u724c\u3002\n\n\u6ce8\u610f\u522b\u5fd8\u4e86\u5f00\u5c40\u8981\u6478\u724c\uff1a\n\n```cpp\nfor(i = 1;i <= 13;++i){\n    for(j = 0;j < 4;++j) mopai(j);//\u5f00\u5c40\u6478\u724c \n}\n```\n\n\n\n#### \u51fa\u724c\n\n```cpp\nint chupai(int x){//\u51fa\u724c \n\tif(p[x].a[p[x].sum] == 37){//pass \n\t\t--p[x].sum;p[nxt(x)].pass = 1;\n\t\tout(x,37,nxt(x));\n\t\treturn nxt(x);\n\t}\n\tif(p[x].a[p[x].sum] == 36){//reverse\n\t\t--p[x].sum;\n\t\tfx *= -1;\n\t\tout(x,36);\n\t\treturn nxt(x);\n\t}\n\tif(p[x].a[p[x].sum] == 35){//double\n\t\t--p[x].sum;\n\t\tout(x,35);\n\t\tmopai(x);\n\t\treturn chupai(x);\n\t}\n\tint chu = check(x);\n\tif(chu == -1) zimo(x);\n\tchup(x,chu);\n\tcheckhu(x,chu);\n\tint px = checkpeng(chu);\n\tif(px >= 0) return chupai(px);\n\tif(checkchi(nxt(x),chu)) return chupai(nxt(x));\n\treturn nxt(x);\n}\n```\n\n\u5148\u5224\u65ad\u6709\u6ca1\u6709\u7279\u6b8a\u724c\u53ef\u51fa\uff0c\u6709\u7684\u8bdd\u5c31\u51fa\uff0c\u6ca1\u6709\u5c31\u901a\u8fc7`check`\u51fd\u6570\u786e\u5b9a\u4e0b\u4e00\u5f20\u51fa\u4ec0\u4e48/\u6709\u6ca1\u6709\u81ea\u6478\u3002\n\n\u786e\u5b9a\u4e86\u51fa\u7684\u724c\u662f`chu`\u4e4b\u540e\uff0c\u7528`chup`\u51fd\u6570\u8fdb\u884c\u51fa\u724c\u3002\n\n\u518d\u7528`checkhu`\u3001`checkpeng`\u3001`checkchi`\u5224\u65ad\u6709\u65e0\u548c\u724c\u3001\u78b0\u3001\u5403\u3002\n\n\u6ce8\u610f\u5403\u78b0\u4e4b\u540e\u4e0d\u4f1a\u6478\u724c\uff0c\u56e0\u6b64\u76f4\u63a5\u8fdb\u5165\u5bf9\u5e94\u73a9\u5bb6\u7684`chupai`\u51fd\u6570\u800c\u4e0d\u662f`play`\u51fd\u6570\u3002\n\n`chup`\u51fd\u6570\u4e0d\u96be\u5b9e\u73b0\uff1a\n\n```cpp\ninline void chup(int x,int chu){//\u73a9\u5bb6x\u51fa\u724cchu \n\tint chid;\n\tfor(chid = 1;chid <= p[x].sum;++chid) if(chu == p[x].a[chid]) break;\n\tswap(p[x].a[chid],p[x].a[p[x].sum]);\n\t--p[x].sum;\n\tsort(p[x].a + 1,p[x].a + p[x].sum + 1);\n\tout(x,chu);\n}\n```\n\n\u51fa\u5b8c\u724c\u4e5f\u6700\u597d\u6574\u7406\u4e00\u4e0b\u624b\u724c\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u628a\u91cd\u70b9\u653e\u5728\u5176\u4ed6\u51e0\u4e2a\u51fd\u6570\u4e0a\uff1a\n\n\n\n#### \u8ba1\u7b97\u548c\u724c\u8ddd\u79bb\u548c\u4e0b\u4e00\u5f20\u51fa\u7684\u724c\n\n\u8fd9\u53ef\u80fd\u662f\u6574\u9053\u9898\u91cc\u6700\u96be\u7684\u90e8\u5206\uff0c\u56e0\u4e3a\u5176\u4f59\u5730\u65b9\u53ea\u9700\u8981\u65e0\u8111\u6a21\u62df\u5c31\u5b8c\u4e8b\u4e86\uff0c\u6700\u591a\u662f\u5199\u8d77\u6765\u590d\u6742\u4e00\u70b9\u3002\n\n\u4f46\u662f\u8fd9\u4e00\u5757\u5c31\u9700\u8981\u6709\u4e00\u4e9b\u6280\u5de7\u3002\n\n\u5982\u679c\u4f60\u505a\u8fc7[P5279 [ZJOI2019]\u9ebb\u5c06](https://www.luogu.com.cn/problem/P5279)\u6216\u8005[P5301 [GXOI/GZOI2019]\u5b9d\u724c\u4e00\u5927\u5806](https://www.luogu.com.cn/problem/P5301)\u7684\u8bdd\uff0c\u4f60\u5e94\u8be5\u80fd\u53cd\u5e94\u4e0a\u6765\u8fd9\u9700\u8981\u4e00\u4e2adp\uff1a\n$dp[i][j][k][l][g]$\u8868\u793a\uff1a\u76ee\u524d\u8003\u8651\u4e86\u524d$i$\u79cd\u724c\uff0c\u5df2\u7ecf\u51d1\u9f50\u4e86$j$\u4e2a\u987a\u5b50\u548c\u523b\u5b50\u3001$k$\u4e2a\u5bf9\u5b50\uff0c\u8ba1\u5212\u51d1\u6210\u4ece\u7b2c$i-1$\u79cd\u724c\u5f00\u59cb\u7684\u987a\u5b50$l$\u4e2a\uff0c\u4ece\u7b2c$i$\u79cd\u724c\u5f00\u59cb\u7684\u987a\u5b50$g$\u4e2a\uff0c\u81f3\u5c11\u8981\u5f80\u73b0\u5728\u7684\u624b\u724c\u91cc\u6dfb\u52a0\u591a\u5c11\u5f20\u724c\u3002\n\n\u540c\u65f6\u8bb0\u5f55\u4e00\u4e2a$zy[i][j][k][l][g]$\u8868\u793a\u5728\u4e0a\u8ff0\u60c5\u51b5\u4e0b\uff0c\u624b\u91cc\u6700\u540e\u4e00\u5f20\u6ca1\u6709\u7528\u4e0a\u7684\u624b\u724c\u662f\u4ec0\u4e48\u3002\n\n\u8f6c\u79fb\uff1a\u679a\u4e3e$i+1$\u8fd9\u79cd\u724c\u8981\u7528\u591a\u5c11\u5f20\uff08\u81f3\u5c11$l+g$\u5f20\uff0c\u81f3\u591a$4$\u5f20\uff09\u3002\u5047\u8bbe\u8981\u7528$x$\u5f20\uff0c\u800c\u624b\u724c\u91cc\u6709$y$\u5f20\uff0c\u9700\u8981\u8ba8\u8bba\uff1a\n\n1\u3001$x<y$\uff1a\u8fd9\u8bf4\u660e\u624b\u724c\u6ca1\u7528\u5b8c\uff0c$dp$\u6570\u7ec4\u7684\u503c\u4e0d\u4f1a\u589e\u52a0\uff0c$zy$\u6570\u7ec4\u7684\u503c\u53d8\u4e3a$i+1$\u3002\n\n2\u3001$x=y$\uff1a\u8fd9\u8bf4\u660e\u624b\u724c\u6070\u597d\u7528\u5b8c\uff0c$dp$\u6570\u7ec4\u7684\u503c\u4e0d\u4f1a\u589e\u52a0\uff0c$zy$\u6570\u7ec4\u7684\u503c\u4e0d\u53d8\u3002\n\n3\u3001$x>y$\uff1a\u8fd9\u8bf4\u660e\u624b\u724c\u4e0d\u591f\uff0c\u8fd8\u5dee\u4e86$x-y$\u5f20\u662f\u9700\u8981\u989d\u5916\u6dfb\u52a0\u7684\uff0c$dp$\u6570\u7ec4\u7684\u503c\u589e\u52a0$x-y$\uff0c$zy$\u6570\u7ec4\u7684\u503c\u4e0d\u53d8\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a$x$\uff0c\u9700\u8981\u62ff\u51fa$l+g$\u5f20\u7528\u4e8e\u4e4b\u524d\u672a\u5b8c\u6210\u7684\u987a\u5b50\uff0c\u5269\u4f59\u7684\u90e8\u5206\u53ef\u4ee5\u7528\u4e8e\u5f00\u542f\u65b0\u7684\u987a\u5b50/\u51d1\u4e00\u4e2a\u5bf9\u5b50/\u51d1\u4e00\u4e2a\u523b\u5b50\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u8ba8\u8bba\u8ba1\u7b97\u51fa\u4e0b\u4e00\u6b65\u8f6c\u79fb\u5230\u7684\u72b6\u6001\u662f\u4ec0\u4e48\u3002\n\n\u8fd9\u4e00\u90e8\u5206\u7684\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\nint sl[40],dp[40][5][2][3][3],zy[40][5][2][3][3];\n#define zhuanyi(a,b,x,y) if((x) < (a) || ((x) == (a) && (y) > (b))) (a) = (x),(b) = (y)\npii work(int x){//\u8ba1\u7b97\u548c\u724c\u8ddd\u79bb\u548c\u4e0b\u4e00\u5f20\u51fa\u7684\u724c\uff08\u6700\u540e\u4e00\u5f20\u6ca1\u7528\u7684\u724c\uff09\uff0cx\u8868\u793a\u8981\u51d1\u51fa\u7684\u987a\u5b50\u548c\u523b\u5b50\u6570\u76ee \n\tmemset(dp,0x3f,sizeof(dp));memset(zy,-1,sizeof(zy));\n\tdp[0][0][0][0][0] = 0;\n\tregister int i,j,k,l,g,q,nx,ny,r;\n\tfor(i = 0;i < 34;++i){\n\t\tfor(j = 0;j <= x;++j){\n\t\t\tfor(k = 0;k <= 1;++k){\n\t\t\t\tfor(l = 0;l <= 2 && l + j <= x;++l){\n\t\t\t\t\tfor(g = 0;g <= 2 && g + l + j <= x;++g) if(dp[i][j][k][l][g] < 15){\n\t\t\t\t\t\tfor(q = l + g;q <= 4;++q){\n\t\t\t\t\t\t\tnx = dp[i][j][k][l][g] + max(0,q - sl[i + 1]);\n\t\t\t\t\t\t\tny = (sl[i + 1] > q ? i + 1 : zy[i][j][k][l][g]);\n\t\t\t\t\t\t\tr = q - l - g;\n\t\t\t\t\t\t\tif(r >= 3 && j + l + 1 <= x) zhuanyi(dp[i + 1][j + l + 1][k][g][r - 3],zy[i + 1][j + l + 1][k][g][r - 3],nx,ny);\n\t\t\t\t\t\t\tif(r >= 2 && !k) zhuanyi(dp[i + 1][j + l][k + 1][g][r - 2],zy[i + 1][j + l][k + 1][g][r - 2],nx,ny);\n\t\t\t\t\t\t\tif(r <= 2) zhuanyi(dp[i + 1][j + l][k][g][r],zy[i + 1][j + l][k][g][r],nx,ny);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(i % 9 == 0 || i >= 27) break; \n\t\t\t\t\t}\n\t\t\t\t\tif(i % 9 == 0 || i >= 27) break; \n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn mp(dp[34][x][1][0][0],zy[34][x][1][0][0]);\n}\nint check(int x){//\u8fd4\u56de\u5e94\u8be5\u51fa\u54ea\u4e00\u5f20\u724c\uff0c\u5982\u679c\u5df2\u7ecf\u548c\u4e86\u8fd4\u56de-1\uff08\u56e0\u6b64\u4e5f\u53ef\u4ee5\u7528\u4e8e\u68c0\u9a8c\u662f\u5426\u5df2\u7ecf\u548c\u724c\uff09 \n\tmemset(sl,0,sizeof(sl));\n\tfor(int i = 1;i <= p[x].sum;++i) if(p[x].a[i] <= 34) ++sl[p[x].a[i]];\n\tpii as = work(4 - (14 - p[x].sum) / 3);\n\treturn as.se;\n}\n```\n\n\u5176\u4e2d`check`\u51fd\u6570\u4f1a\u5bf9\u73a9\u5bb6`x`\u7684\u624b\u724c\u8fdb\u884c\u5206\u7c7b\u6574\u7406\u540e\u6254\u7ed9`work`\u51fd\u6570\u3002\n\n\n\n#### \u548c\u724c\n\n```cpp\ninline bool ts(int x){//\u80fd\u548c\u724c\u7684\u524d\u63d0\u662f\u6ca1\u6709\u7279\u6b8a\u724c \n\tfor(int i = 1;i <= p[x].sum;++i) if(p[x].a[i] > 34) return 1;\n\treturn 0;\n}\nvoid checkhu(int x,int chu){//\u5224\u65ad\u80fd\u5426\u548c\u724c \n\tfor(int i = nxt(x);i != x;i = nxt(i)) if(!ts(i)){\n\t\tp[i].a[++p[i].sum] = chu;\n\t\tif(check(i) == -1) hupai(i);\n\t\t--p[i].sum;\n\t}\n}\n```\n\n\u8fd9\u91cc\u5728\u4e00\u5f00\u59cb\u5199\u7684\u65f6\u5019\u9047\u5230\u4e86\u4e00\u4e2abug\uff1a\u5982\u679c\u624b\u724c\u91cc\u6709\u7279\u6b8a\u724c\uff0c`work`\u51fd\u6570\u6709\u53ef\u80fd\u5728\u548c\u724c\u8ddd\u79bb\u4e0d\u4e3a$0$\u7684\u65f6\u5019\u8fd4\u56de$-1$\uff0c\u56e0\u6b64\u63d0\u524d\u5224\u4e86\u4e00\u4e0b\u3002\n\n\n\n#### \u78b0\n\n```cpp\nbool chkpeng(int x,int chu){//\u78b0 \n\tmemset(sl,0,sizeof(sl));\n\tfor(int i = 1;i <= p[x].sum;++i) ++sl[p[x].a[i]];\n\tint lst = work(4 - (14 - p[x].sum) / 3).fi;\n\tif(sl[chu] >= 2){\n\t\tsl[chu] -= 2;\n\t\tif(lst > work(3 - (14 - p[x].sum) / 3).fi){\n\t\t\toutpeng(x,chu);\n\t\t\tp[x].sum = 0;\n\t\t\tfor(int i = 1;i <= 37;++i){\n\t\t\t\twhile(sl[i]) p[x].a[++p[x].sum] = i,--sl[i];\n\t\t\t}\n\t\t\treturn 1;\n\t\t}\n\t}\n\treturn 0;\n} \nint checkpeng(int chu){//\u5bf9\u6bcf\u4e00\u5bb6\u5224\u65ad\u80fd\u4e0d\u80fd\u78b0 \n\tfor(int x = 0;x < 4;++x) if(chkpeng(x,chu)) return x;\n\treturn -1;\n}\n```\n\n\u6240\u6709\u73a9\u5bb6\u90fd\u80fd\u78b0\uff0c\u6240\u4ee5\u8981\u679a\u4e3e\u4e0d\u540c\u7684\u73a9\u5bb6\uff0c\u8fd9\u91cc\u53ef\u4ee5\u8fd9\u4e48\u5199\u662f\u56e0\u4e3a\u81ea\u5df1\u80af\u5b9a\u4e0d\u4f1a\u78b0\u81ea\u5df1\u521a\u51fa\u7684\u724c\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u5c31\u662f\u5148\u8ba1\u7b97\u4e00\u4e0b\u548c\u724c\u8ddd\u79bb\uff0c\u7136\u540e\u628a\u624b\u91cc\u76f8\u5e94\u7684\u724c\u53bb\u6389\u518d\u8ba1\u7b97\u548c\u724c\u8ddd\u79bb\uff0c\u5982\u679c\u51cf\u5c0f\u4e86\u5c31\u78b0\uff0c\u78b0\u5b8c\u4e5f\u6700\u597d\u6574\u7406\u4e00\u4e0b\u624b\u724c\u3002\n\n\n\n#### \u5403\n\n```cpp\nbool checkchi(int x,int chu){//\u5403 \n\tif(chu > 27) return 0;\n\tmemset(sl,0,sizeof(sl));\n\tfor(int i = 1;i <= p[x].sum;++i) ++sl[p[x].a[i]];\n\tint lst = work(4 - (14 - p[x].sum) / 3).fi;\n\tif(chu % 9 != 8 && chu % 9 != 0 && sl[chu + 1] && sl[chu + 2]){//x x+1 x+2 \n\t\t--sl[chu + 1];--sl[chu + 2];\n\t\tif(lst > work(3 - (14 - p[x].sum) / 3).fi){\n\t\t\toutchi(x,chu);\n\t\t\tp[x].sum = 0;\n\t\t\tfor(int i = 1;i <= 37;++i){\n\t\t\t\twhile(sl[i]) p[x].a[++p[x].sum] = i,--sl[i];\n\t\t\t}\n\t\t\treturn 1;\n\t\t}\n\t\t++sl[chu + 1];++sl[chu + 2];\n\t}\n\tif(chu % 9 != 1 && chu % 9 != 0 && sl[chu - 1] && sl[chu + 1]){//x-1 x x+1\n\t\t--sl[chu - 1];--sl[chu + 1];\n\t\tif(lst > work(3 - (14 - p[x].sum) / 3).fi){\n\t\t\toutchi(x,chu - 1);\n\t\t\tp[x].sum = 0;\n\t\t\tfor(int i = 1;i <= 37;++i){\n\t\t\t\twhile(sl[i]) p[x].a[++p[x].sum] = i,--sl[i];\n\t\t\t}\n\t\t\treturn 1;\n\t\t}\n\t\t++sl[chu - 1];++sl[chu + 1];\n\t}\n\tif(chu % 9 != 1 && chu % 9 != 2 && sl[chu - 2] && sl[chu - 1]){//x-2 x-1 x\n\t\t--sl[chu - 2];--sl[chu - 1];\n\t\tif(lst > work(3 - (14 - p[x].sum) / 3).fi){\n\t\t\toutchi(x,chu - 2);\n\t\t\tp[x].sum = 0;\n\t\t\tfor(int i = 1;i <= 37;++i){\n\t\t\t\twhile(sl[i]) p[x].a[++p[x].sum] = i,--sl[i];\n\t\t\t}\n\t\t\treturn 1;\n\t\t}\n\t\t++sl[chu - 2];++sl[chu - 1];\n\t}\n\treturn 0;\n}\n```\n\n\u5403\u4e0e\u78b0\u7684\u533a\u522b\u5728\u4e8e\u53ea\u6709\u4e0b\u5bb6\u80fd\u5403\uff0c\u4f46\u662f\u67093\u79cd\u53ef\u80fd\u7684\u5403\u6cd5\uff0c\u90fd\u5224\u65ad\u4e00\u4e0b\u5c31\u597d\u3002\u5176\u4ed6\u7ec6\u8282\u8ddf\u78b0\u7c7b\u4f3c\u3002\n\n\n\n#### \u5927\u529f\u544a\u6210\uff01\u6765\u770b\u4e00\u4e0b\u5b8c\u6574\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define gc getchar()\n#define pc putchar\n#define pii pair<int,int>\n#define fi first\n#define se second\n#define mp make_pair\nusing namespace std;\nint pai[200],head = 1,fx = 1;\nstruct player{\n\tint a[20],sum;\n\tbool pass;\n}p[4]; \ninline void outpai(int paii){//\u8f93\u51fapaii\u8fd9\u4e00\u5f20\u724c \n\tif(paii <= 27) cout<<(paii - 1) % 9 + 1<<(\"MPS\"[(paii - 1) / 9]);\n\telse if(paii <= 34) cout<<(\"ESWNBFZ\"[paii - 28]);\n\telse if(paii == 35) cout<<\"DOUBLE\";\n\telse if(paii == 36) cout<<\"REVERSE\";\n\telse cout<<\"PASS\";\n}\ninline void draw(){//\u8f93\u51fa\u5e73\u5c40 \n\tcout<<\"DRAW\"<<endl;\n\texit(0);\n}\ninline void win(int x){//\u8f93\u51fax\u83b7\u80dc \n\tpc(x + 'A');pc(' ');cout<<\"WIN\"<<endl;\n\texit(0);\n} \ninline void hupai(int x){//\u8f93\u51fax\u8363\u548c \n\tpc(x + 'A');cout<<\" RON\"<<endl;\n\twin(x);\n}\ninline void zimo(int x){//\u8f93\u51fax\u81ea\u6478 \n\tpc(x + 'A');cout<<\" SELFDRAWN\"<<endl;\n\twin(x);\n}\ninline void in(int x,int paii){//\u8f93\u51fax\u6478\u724cpaii \n\tpc(x + 'A');cout<<\" IN \";\n\toutpai(paii);pc('\\n');\n}\ninline void out(int x,int paii,int fg = -1){//\u8f93\u51fax\u51fa\u724cpaii\uff0c\u7279\u5224pass \n\tpc(x + 'A');cout<<\" OUT \";\n\toutpai(paii);\n\tif(fg >= 0) pc(' '),pc(fg + 'A');\n\tpc('\\n');\n}\ninline void outchi(int x,int paii){//\u8f93\u51fax\u5403\uff0c\u5403\u7684\u7b2c\u4e00\u5f20\u724c\u662fpaii \n\tpc(x + 'A');cout<<\" CHOW \";\n\toutpai(paii);pc(' ');outpai(paii + 1);pc(' ');outpai(paii + 2);pc('\\n');\n}\ninline void outpeng(int x,int paii){//\u8f93\u51fax\u78b0paii \n\tpc(x + 'A');cout<<\" PONG \";\n\toutpai(paii);pc(' ');outpai(paii);pc(' ');outpai(paii);pc('\\n');\n}\ninline void mopai(int x){//\u73a9\u5bb6x\u6478\u724c \n\tif(head > 148) draw();\n\tp[x].a[++p[x].sum] = pai[head++];\n\tin(x,p[x].a[p[x].sum]);\n\tsort(p[x].a + 1,p[x].a + p[x].sum + 1);\n}\ninline void chup(int x,int chu){//\u73a9\u5bb6x\u51fa\u724cchu \n\tint chid;\n\tfor(chid = 1;chid <= p[x].sum;++chid) if(chu == p[x].a[chid]) break;\n\tswap(p[x].a[chid],p[x].a[p[x].sum]);\n\t--p[x].sum;\n\tsort(p[x].a + 1,p[x].a + p[x].sum + 1);\n\tout(x,chu);\n}\nint sl[40],dp[40][5][2][3][3],zy[40][5][2][3][3];\n#define zhuanyi(a,b,x,y) if((x) < (a) || ((x) == (a) && (y) > (b))) (a) = (x),(b) = (y)\npii work(int x){//\u8ba1\u7b97\u548c\u724c\u8ddd\u79bb\u548c\u4e0b\u4e00\u5f20\u51fa\u7684\u724c\uff08\u6700\u540e\u4e00\u5f20\u6ca1\u7528\u7684\u724c\uff09\uff0cx\u8868\u793a\u8981\u51d1\u51fa\u7684\u987a\u5b50\u548c\u523b\u5b50\u6570\u76ee \n\tmemset(dp,0x3f,sizeof(dp));memset(zy,-1,sizeof(zy));\n\tdp[0][0][0][0][0] = 0;\n\tregister int i,j,k,l,g,q,nx,ny,r;\n\tfor(i = 0;i < 34;++i){\n\t\tfor(j = 0;j <= x;++j){\n\t\t\tfor(k = 0;k <= 1;++k){\n\t\t\t\tfor(l = 0;l <= 2 && l + j <= x;++l){\n\t\t\t\t\tfor(g = 0;g <= 2 && g + l + j <= x;++g) if(dp[i][j][k][l][g] < 15){\n\t\t\t\t\t\tfor(q = l + g;q <= 4;++q){\n\t\t\t\t\t\t\tnx = dp[i][j][k][l][g] + max(0,q - sl[i + 1]);\n\t\t\t\t\t\t\tny = (sl[i + 1] > q ? i + 1 : zy[i][j][k][l][g]);\n\t\t\t\t\t\t\tr = q - l - g;\n\t\t\t\t\t\t\tif(r >= 3 && j + l + 1 <= x) zhuanyi(dp[i + 1][j + l + 1][k][g][r - 3],zy[i + 1][j + l + 1][k][g][r - 3],nx,ny);\n\t\t\t\t\t\t\tif(r >= 2 && !k) zhuanyi(dp[i + 1][j + l][k + 1][g][r - 2],zy[i + 1][j + l][k + 1][g][r - 2],nx,ny);\n\t\t\t\t\t\t\tif(r <= 2) zhuanyi(dp[i + 1][j + l][k][g][r],zy[i + 1][j + l][k][g][r],nx,ny);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(i % 9 == 0 || i >= 27) break; \n\t\t\t\t\t}\n\t\t\t\t\tif(i % 9 == 0 || i >= 27) break; \n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn mp(dp[34][x][1][0][0],zy[34][x][1][0][0]);\n}\nint check(int x){//\u8fd4\u56de\u5e94\u8be5\u51fa\u54ea\u4e00\u5f20\u724c\uff0c\u5982\u679c\u5df2\u7ecf\u548c\u4e86\u8fd4\u56de-1\uff08\u56e0\u6b64\u4e5f\u53ef\u4ee5\u7528\u4e8e\u68c0\u9a8c\u662f\u5426\u5df2\u7ecf\u548c\u724c\uff09 \n\tmemset(sl,0,sizeof(sl));\n\tfor(int i = 1;i <= p[x].sum;++i) if(p[x].a[i] <= 34) ++sl[p[x].a[i]];\n\tpii as = work(4 - (14 - p[x].sum) / 3);\n\treturn as.se;\n}\ninline bool ts(int x){//\u80fd\u548c\u724c\u7684\u524d\u63d0\u662f\u6ca1\u6709\u7279\u6b8a\u724c \n\tfor(int i = 1;i <= p[x].sum;++i) if(p[x].a[i] > 34) return 1;\n\treturn 0;\n}\n#define nxt(x) (((x) + fx + 4) % 4)\nvoid checkhu(int x,int chu){//\u5224\u65ad\u80fd\u5426\u548c\u724c \n\tfor(int i = nxt(x);i != x;i = nxt(i)) if(!ts(i)){\n\t\tp[i].a[++p[i].sum] = chu;\n\t\tif(check(i) == -1) hupai(i);\n\t\t--p[i].sum;\n\t}\n}\nbool chkpeng(int x,int chu){//\u78b0 \n\tmemset(sl,0,sizeof(sl));\n\tfor(int i = 1;i <= p[x].sum;++i) ++sl[p[x].a[i]];\n\tint lst = work(4 - (14 - p[x].sum) / 3).fi;\n\tif(sl[chu] >= 2){\n\t\tsl[chu] -= 2;\n\t\tif(lst > work(3 - (14 - p[x].sum) / 3).fi){\n\t\t\toutpeng(x,chu);\n\t\t\tp[x].sum = 0;\n\t\t\tfor(int i = 1;i <= 37;++i){\n\t\t\t\twhile(sl[i]) p[x].a[++p[x].sum] = i,--sl[i];\n\t\t\t}\n\t\t\treturn 1;\n\t\t}\n\t}\n\treturn 0;\n} \nint checkpeng(int chu){//\u5bf9\u6bcf\u4e00\u5bb6\u5224\u65ad\u80fd\u4e0d\u80fd\u78b0 \n\tfor(int x = 0;x < 4;++x) if(chkpeng(x,chu)) return x;\n\treturn -1;\n}\nbool checkchi(int x,int chu){//\u5403 \n\tif(chu > 27) return 0;\n\tmemset(sl,0,sizeof(sl));\n\tfor(int i = 1;i <= p[x].sum;++i) ++sl[p[x].a[i]];\n\tint lst = work(4 - (14 - p[x].sum) / 3).fi;\n\tif(chu % 9 != 8 && chu % 9 != 0 && sl[chu + 1] && sl[chu + 2]){//x x+1 x+2 \n\t\t--sl[chu + 1];--sl[chu + 2];\n\t\tif(lst > work(3 - (14 - p[x].sum) / 3).fi){\n\t\t\toutchi(x,chu);\n\t\t\tp[x].sum = 0;\n\t\t\tfor(int i = 1;i <= 37;++i){\n\t\t\t\twhile(sl[i]) p[x].a[++p[x].sum] = i,--sl[i];\n\t\t\t}\n\t\t\treturn 1;\n\t\t}\n\t\t++sl[chu + 1];++sl[chu + 2];\n\t}\n\tif(chu % 9 != 1 && chu % 9 != 0 && sl[chu - 1] && sl[chu + 1]){//x-1 x x+1\n\t\t--sl[chu - 1];--sl[chu + 1];\n\t\tif(lst > work(3 - (14 - p[x].sum) / 3).fi){\n\t\t\toutchi(x,chu - 1);\n\t\t\tp[x].sum = 0;\n\t\t\tfor(int i = 1;i <= 37;++i){\n\t\t\t\twhile(sl[i]) p[x].a[++p[x].sum] = i,--sl[i];\n\t\t\t}\n\t\t\treturn 1;\n\t\t}\n\t\t++sl[chu - 1];++sl[chu + 1];\n\t}\n\tif(chu % 9 != 1 && chu % 9 != 2 && sl[chu - 2] && sl[chu - 1]){//x-2 x-1 x\n\t\t--sl[chu - 2];--sl[chu - 1];\n\t\tif(lst > work(3 - (14 - p[x].sum) / 3).fi){\n\t\t\toutchi(x,chu - 2);\n\t\t\tp[x].sum = 0;\n\t\t\tfor(int i = 1;i <= 37;++i){\n\t\t\t\twhile(sl[i]) p[x].a[++p[x].sum] = i,--sl[i];\n\t\t\t}\n\t\t\treturn 1;\n\t\t}\n\t\t++sl[chu - 2];++sl[chu - 1];\n\t}\n\treturn 0;\n}\nint chupai(int x){//\u51fa\u724c \n\tif(p[x].a[p[x].sum] == 37){//pass \n\t\t--p[x].sum;p[nxt(x)].pass = 1;\n\t\tout(x,37,nxt(x));\n\t\treturn nxt(x);\n\t}\n\tif(p[x].a[p[x].sum] == 36){//reverse\n\t\t--p[x].sum;\n\t\tfx *= -1;\n\t\tout(x,36);\n\t\treturn nxt(x);\n\t}\n\tif(p[x].a[p[x].sum] == 35){//double\n\t\t--p[x].sum;\n\t\tout(x,35);\n\t\tmopai(x);\n\t\treturn chupai(x);\n\t}\n\tint chu = check(x);\n\tif(chu == -1) zimo(x);\n\tchup(x,chu);\n\tcheckhu(x,chu);\n\tint px = checkpeng(chu);\n\tif(px >= 0) return chupai(px);\n\tif(checkchi(nxt(x),chu)) return chupai(nxt(x));\n\treturn nxt(x);\n}\nint play(int x){//\u73a9\u5bb6x\u8fdb\u884c\u56de\u5408\n\tif(p[x].pass){\n\t\tp[x].pass = 0;\n\t\treturn nxt(x);\n\t}\n\tmopai(x);\n\treturn chupai(x);\n}\nint main(){\n\tint i,j,l;\n\tstring st;\n\tfor(i = 1;i <= 148;++i){\n\t\tcin>>st;\n\t\tif(st[0] >= '1' && st[0] <= '9'){\n\t\t\tl = st[0] - '0';\n\t\t\tswitch(st[1]){\n\t\t\t\tcase 'M' : pai[i] = l;break;\n\t\t\t\tcase 'P' : pai[i] = l + 9;break;\n\t\t\t\tcase 'S' : pai[i] = l + 18;break;\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tswitch(st[0]){\n\t\t\t\tcase 'E' : pai[i] = 28;break;\n\t\t\t\tcase 'S' : pai[i] = 29;break;\n\t\t\t\tcase 'W' : pai[i] = 30;break;\n\t\t\t\tcase 'N' : pai[i] = 31;break;\n\t\t\t\tcase 'B' : pai[i] = 32;break;\n\t\t\t\tcase 'F' : pai[i] = 33;break;\n\t\t\t\tcase 'Z' : pai[i] = 34;break;\n\t\t\t\tcase 'D' : pai[i] = 35;break;\n\t\t\t\tcase 'R' : pai[i] = 36;break;\n\t\t\t\tcase 'P' : pai[i] = 37;break;\n\t\t\t}\n\t\t}\n\t}\n\tfor(i = 1;i <= 13;++i){\n\t\tfor(j = 0;j < 4;++j) mopai(j);//\u5f00\u5c40\u6478\u724c \n\t}\n\tint nw = 0;\n\twhile(1) nw = play(nw);\n\treturn 0;\n}\n```\n\n\n\n#### \u540e\u8bb0\n\n~~\u6ce5\u840c\u600e\u4e48\u80fd\u8bf4\u6211\u8fd9\u9898\u6bd4\u732a\u56fd\u6740\u8fd8\u6bd2\u7624\u5462qwq~~\n\n~~\u8fd9\u9898std\u660e\u660e\u53ea\u5199\u4e863\u4e2a\u5c0f\u65f6\uff0c\u4ee3\u7801\u53ea\u67096\u4e2ak\uff0c\u9a8c\u9898\u4eba\u751a\u81f3\u53ea\u5199\u4e864\u4e2ak~~\n\n~~\u518d\u8bf4\u4e86\u573a\u4e0a\u53ef\u662f\u6709\u8db3\u8db3\u4e24\u8f66\u4eba\u8fc7\u4e86\u8fd9\u9898\u554aqaq~~\n\n",
        "postTime": 1609227371,
        "uid": 45775,
        "name": "liuzhangfeiabc",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P7147 \u3010[THUPC2021 \u521d\u8d5b]\u9ebb\u5c06\u6a21\u62df\u5668\u3011"
    },
    {
        "content": "[\u9898\u9762](https://www.luogu.com.cn/problem/P7147)\n\n\u505a\u5b8c pkusc2022 day2t3 \u96c0\u5723\u4e4b\u540e\u8dd1\u6765\u505a\u8fd9\u9898\u3002\n\n\u9996\u5148\u6211\u4eec\u8003\u8651\u96c0\u5723\u90a3\u9898\u3002\u90a3\u4e2a\u9898\u662f\u8bf4\u7ed9\u4f60\u4e00\u526f $13$ \u5f20\u7684\u624b\u724c\uff0c\u8ba9\u4f60\u7b97\u5411\u542c\u6570\u3002\u8bbe $dp[i][j][0/1][p1][p2][up][dn]=0/1$ \u8868\u793a\u8003\u8651\u5230 $i$ \u82b1\u8272\u7b2c $j$ \u5f20\u724c\uff0c\u662f\u5426\u5df2\u7ecf\u6709\u96c0\u5934\uff0c\u4e0a\u5f20\u724c\u5269\u4e0b $p1$ \u5f20\uff0c\u8fd9\u5f20\u724c\u5269\u4e0b $p2$ \u5f20\uff0c\u5df2\u7ecf\u52a0\u4e86 $up$ \u5f20\uff0c\u5df2\u7ecf\u6254\u4e86 $dn$ \u5f20\u7684\u72b6\u6001\u662f\u5426\u53ef\u4ee5\u8fbe\u5230\u3002\u679a\u4e3e\u5f53\u524d\u8fd9\u5f20\u724c\u52a0\u51e0\u5f20\u3001\u5220\u51e0\u5f20\uff0c\u662f\u5426\u4f5c\u4e3a\u96c0\u5934\uff0c\u80fd\u4f5c\u4e3a\u523b\u5b50\u5c31\u4e00\u5b9a\u4f5c\u4e3a\u523b\u5b50\uff0c\u548c\u524d\u4e24\u5f20\u724c\u7ec4\u6210\u987a\u5b50\uff0c\u7136\u540e\u8f6c\u79fb\u4e00\u4e0b\u3002\u6bcf\u4e00\u79cd\u82b1\u8272\u8f6c\u79fb\u5b8c\u4e4b\u540e\u6e05\u6389\u9664 $p1=p2=0$ \u4e4b\u5916\u7684\u6240\u6709\u72b6\u6001\u5373\u53ef\u3002\n\n\u6709\u4e86\u8fd9\u4e2a dp \u8fd9\u9898\u5269\u4e0b\u7684\u5c31\u4e0d\u96be\u4e86\u3002\u7279\u6b8a\u724c\u7684\u8bdd\u5c31\u5148\u5904\u7406\u4e00\u4e0b\uff0c`PASS` \u5c31\u591a\u8df3\u4e00\u4e2a\uff0c`DOUBLE` \u548c `REVERSE` \u5c31\u5b9a\u4e49\u4e00\u4e2a $delta=1/-1$\uff0c\u6bcf\u6b21\u52a0 $delta$ \u8868\u793a\u987a/\u9006\u65f6\u9488\u5373\u53ef\u3002\u8fdb\u5165\u6253\u724c\u9636\u6bb5\u4e4b\u540e\uff0c\u5bf9\u6bcf\u4e2a\u73a9\u5bb6\u8bb0\u4e00\u4e2a\u5f53\u524d\u548c\u724c\u8ddd\u79bb\u3002\u6253\u724c\u5c31\u662f\u6bcf\u6b21\u679a\u4e3e\u6253\u54ea\u4e00\u5f20\uff0cdp\u7b97\u4e00\u4e0b\u53d6\u4e00\u4e2a\u548c\u724c\u8ddd\u79bb\u6700\u77ed\u4e14\u6700\u5927\u7684\uff0c\u6253\u51fa\u53bb\u4e4b\u540e\u518d\u5bf9\u53e6\u5916\u7684\u73a9\u5bb6\u5224\u4e00\u4e0b\u78b0\u548c\u5403\u5373\u53ef\u3002\u867d\u7136\u590d\u6742\u5ea6\u6bd4\u8f83\u9ad8\uff0c\u4f46\u662f\u770b\u8d77\u6765\u53ef\u4ee5\u8fc7\u3002\n\ncode(8.3k)\uff1a\n\n```cpp\n#include<cstdio>\n#include<iostream>\n#include<cstring>\n#include<map>\n#define memset __builtin_memset\n#define mp std::make_pair\n#define fi first\n#define se second\ntypedef std::pair<int,int> pii;\nstd::map<char,int> ms;\ninline void chkmin(int &a,const int &b){if(b<a)a=b;}\ninline char cc(int x){return (char)(x+'A');}\ninline char cn(int x){return (char)(x+'0');}\nchar nam[8]={'0','E','S','W','N','B','F','Z'},nam1[3]={'M','P','S'};\nint limt[5]={9,9,9,7,3};\nstd::string nam2[4]={\"\",\"PASS\",\"REVERSE\",\"DOUBLE\"};\ninline void init(){\n\tms['E']=1,ms['S']=2,ms['W']=3,ms['N']=4,ms['B']=5,ms['F']=6,ms['Z']=7;\n}\ninline std::string f(pii x){\n\tstd::string res=\"\";\n\tif(x.fi<=2) res+=cn(x.se),res+=nam1[x.fi];\n\telse if(x.fi==3) res+=nam[x.se];\n\telse res=nam2[x.se];\n\treturn res;\n}\nint a[4][5][10],to[4];\ninline void print_in(int o,const char *in){printf(\"%c IN %s\\n\",cc(o),in);}\ninline void print_out(int o,const char *out,int oo){\n\tif(out[0]=='P') printf(\"%c OUT %s %c\\n\",cc(o),out,cc(oo));\n\telse printf(\"%c OUT %s\\n\",cc(o),out);\n}\ninline void print_pong(int o,const char *pong){printf(\"%c PONG %s %s %s\\n\",cc(o),pong,pong,pong);}\ninline void print_chow(int o,const char *chow1,const char *chow2,const char *chow3){printf(\"%c CHOW %s %s %s\\n\",cc(o),chow1,chow2,chow3);}\ninline void print_selfdrawn(int o){printf(\"%c SELFDRAWN\\n\",cc(o));}\ninline void print_ron(int o){printf(\"%c RON\\n\",cc(o));}\ninline void print_win(int o){printf(\"%c WIN\\n\",cc(o));}\ninline void rd(int o,const char *in){\n\tif(in[0]=='P') a[o][4][1]++;\n\telse if(in[0]=='R') a[o][4][2]++;\n\telse if(in[0]=='D') a[o][4][3]++;\n\telse if(in[0]>='1'&&in[0]<='9'){\n\t\tint tmp;\n\t\tif(in[1]=='M') tmp=0;else if(in[1]=='P') tmp=1;else tmp=2;\n\t\ta[o][tmp][in[0]-'0']++;\n\t}\n\telse a[o][3][ms[in[0]]]++;\n}\ninline int findans(int a[5][10],bool flag=0){\n\tstatic bool dp[6][10][2][3][3][14][13];\n\tmemset(dp,0,sizeof dp);\n\tdp[0][0][0][0][0][0][0]=1;\n\tfor(int o=0;o<=4;++o){\n\t\tfor(int i=1;i<=limt[o];++i){\n\t\t\tfor(int qt=0;qt<=1;++qt)\n\t\t\tfor(int p1=0;p1<=2;++p1)\n\t\t\tfor(int p2=p1;p2<=2;++p2)\n\t\t\tfor(int up=0;up<=13;++up)\n\t\t\tfor(int dn=0;dn<=12;++dn){\n\t\t\t\tif(!dp[o][i-1][qt][p1][p2][up][dn]) continue;\n\t\t\t\t//\u4e0d\u52a0\u4e0d\u51cf\n\t\t\t\tint now=a[o][i];\n\t\t\t\t//\u96c0\u5934 \n\t\t\t\tif(o<=3&&!qt&&now>=2){\n\t\t\t\t\tnow-=2;\n\t\t\t\t\tif(!p1) dp[o][i][1][p2][now][up][dn]=1;\n\t\t\t\t\tif(o<=2&&p1==1&&p2>=1&&now>=1) dp[o][i][1][p2-1][now-1][up][dn]=1;\n\t\t\t\t\tif(o<=2&&p1==2&&p2>=2&&now>=2) dp[o][i][1][p2-2][now-2][up][dn]=1;\n\t\t\t\t\tnow+=2;\n\t\t\t\t}\n\t\t\t\t//\u662f\u5426\u6709\u523b\u5b50 \n\t\t\t\tif(o<=3&&now>=3){\n\t\t\t\t\tnow-=3;\n\t\t\t\t\tif(!p1) dp[o][i][qt][p2][now][up][dn]=1;\n\t\t\t\t\tif(o<=2&&p1==1&&p2>=1&&now>=1) dp[o][i][qt][p2-1][now-1][up][dn]=1;\t\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tif(!p1) dp[o][i][qt][p2][now][up][dn]=1;\n\t\t\t\t\tif(o<=2&&p1==1&&p2>=1&&now>=1) dp[o][i][qt][p2-1][now-1][up][dn]=1;\n\t\t\t\t\tif(o<=2&&p1==2&&p2>=2&&now>=2) dp[o][i][qt][p2-2][now-2][up][dn]=1;\n\t\t\t\t}\n\t\t\t\tfor(int j=1;j<=4-a[o][i]&&up+j<=13;++j){//\u52a0 \n\t\t\t\t\tnow=a[o][i]+j;\n\t\t\t\t\tif(o<=3&&!qt&&now>=2){\n\t\t\t\t\t\tnow-=2;\n\t\t\t\t\t\tif(!p1) dp[o][i][1][p2][now][up+j][dn]=1;\n\t\t\t\t\t\tif(o<=2&&p1==1&&p2>=1&&now>=1) dp[o][i][1][p2-1][now-1][up+j][dn]=1;\n\t\t\t\t\t\tif(o<=2&&p1==2&&p2>=2&&now>=2) dp[o][i][1][p2-2][now-2][up+j][dn]=1;\n\t\t\t\t\t\tnow+=2;\n\t\t\t\t\t}\n\t\t\t\t\tif(o<=3&&now>=3){\n\t\t\t\t\t\tnow-=3;\n\t\t\t\t\t\tif(!p1) dp[o][i][qt][p2][now][up+j][dn]=1;\n\t\t\t\t\t\tif(o<=2&&p1==1&&p2>=1&&now>=1) dp[o][i][qt][p2-1][now-1][up+j][dn]=1;\t\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tif(!p1) dp[o][i][qt][p2][now][up+j][dn]=1;\n\t\t\t\t\t\tif(o<=2&&p1==1&&p2>=1&&now>=1) dp[o][i][qt][p2-1][now-1][up+j][dn]=1;\n\t\t\t\t\t\tif(o<=2&&p1==2&&p2>=2&&now>=2) dp[o][i][qt][p2-2][now-2][up+j][dn]=1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor(int j=1;j<=a[o][i]&&dn+j<=12;++j){//\u51cf \n\t\t\t\t\tnow=a[o][i]-j;\n\t\t\t\t\tif(o<=3&&!qt&&now>=2){\n\t\t\t\t\t\tnow-=2;\n\t\t\t\t\t\tif(!p1) dp[o][i][1][p2][now][up][dn+j]=1;\n\t\t\t\t\t\tif(o<=2&&p1==1&&p2>=1&&now>=1) dp[o][i][1][p2-1][now-1][up][dn+j]=1;\n\t\t\t\t\t\tif(o<=2&&p1==2&&p2>=2&&now>=2) dp[o][i][1][p2-2][now-2][up][dn+j]=1;\n\t\t\t\t\t\tnow+=2;\n\t\t\t\t\t}\n\t\t\t\t\tif(o<=3&&now>=3){\n\t\t\t\t\t\tnow-=3;\n\t\t\t\t\t\tif(!p1) dp[o][i][qt][p2][now][up][dn+j]=1;\n\t\t\t\t\t\tif(o<=2&&p1==1&&p2>=1&&now>=1) dp[o][i][qt][p2-1][now-1][up][dn+j]=1;\t\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tif(!p1) dp[o][i][qt][p2][now][up][dn+j]=1;\n\t\t\t\t\t\tif(o<=2&&p1==1&&p2>=1&&now>=1) dp[o][i][qt][p2-1][now-1][up][dn+j]=1;\n\t\t\t\t\t\tif(o<=2&&p1==2&&p2>=2&&now>=2) dp[o][i][qt][p2-2][now-2][up][dn+j]=1;\n\t\t\t\t\t}\n\t\t\t\t} \n\t\t\t}\n\t\t}\n\t\tfor(int qt=0;qt<=1;++qt)\n\t\tfor(int up=0;up<=13;++up)\n\t\tfor(int dn=0;dn<=12;++dn)\n\t\t\tdp[o+1][0][qt][0][0][up][dn]=dp[o][limt[o]][qt][0][0][up][dn];\n\t}\n\tfor(int ans=0;ans<=12;++ans)\n\t\tif(dp[5][0][1][0][0][ans+flag][ans]) return ans+flag;\n}\ninline pii findout(int o){\n\tfor(int i=1;i<=3;++i)\n\t\tif(a[o][4][i]) return --a[o][4][i],mp(4,i);\n\tint res=13;pii ans;\n\tfor(int oo=3;oo>=0;--oo)\n\t\tfor(int i=limt[oo];i;--i){\n\t\t\tif(!a[o][oo][i]) continue;\n\t\t\ta[o][oo][i]--;int tmp;\n\t\t\tif((tmp=findans(a[o],1))<res) res=tmp,ans=mp(oo,i);\n\t\t\ta[o][oo][i]++;\n\t\t}\n\treturn --a[o][ans.fi][ans.se],to[o]=res,ans;\n}\ninline bool drawn(int a[5][10]){\n\tif(a[4][1]||a[4][2]||a[4][3]) return 0;\n\tint b[5][10];\n\tfor(int oo=0;oo<=3;++oo)\n\tfor(int ii=1;ii<=limt[oo];++ii){\n\t\tfor(int ooo=0;ooo<=3;++ooo)for(int iii=1;iii<=limt[ooo];++iii)b[ooo][iii]=a[ooo][iii];\n\t\tif(b[oo][ii]<2) continue;\n\t\tb[oo][ii]-=2;bool ok=1;\n\t\tfor(int o=0;o<=3;++o){\n\t\t\tfor(int i=1;i<=limt[o];++i){\n\t\t\t\tif(b[o][i]>=3) b[o][i]-=3;\n\t\t\t\tif(o==3&&b[o][i]){ok=0;break;}\n\t\t\t\twhile(b[o][i]){\n\t\t\t\t\tif(i>7||!b[o][i+1]||!b[o][i+2]){ok=0;break;}\n\t\t\t\t\t--b[o][i],--b[o][i+1],--b[o][i+2];\n\t\t\t\t}\n\t\t\t\tif(!ok) break;\n\t\t\t}\n\t\t\tif(!ok) break;\n\t\t}\n\t\tif(ok) return 1;\n\t}\n\treturn 0;\n} \ninline bool ron(int o,pii x){\n\ta[o][x.fi][x.se]++;\n\tbool ans=drawn(a[o]);\n\ta[o][x.fi][x.se]--;\n\treturn ans;\n}\ninline bool pong(int o,pii x){\n\tif(a[o][x.fi][x.se]<2) return 0;\n\ta[o][x.fi][x.se]-=2;\n\tint now=findans(a[o]);\n\tif(now<to[o]) return to[o]=now,1;\n\treturn a[o][x.fi][x.se]+=2,0;\n}\ninline int chow(int o,pii x){\n\tif(x.se<=7&&a[o][x.fi][x.se+1]&&a[o][x.fi][x.se+2]){\n\t\ta[o][x.fi][x.se+1]--,a[o][x.fi][x.se+2]--;\n\t\tint now=findans(a[o]);\n\t\tif(now<to[o]) return to[o]=now,1;\n\t\ta[o][x.fi][x.se+1]++,a[o][x.fi][x.se+2]++;\n\t}\n\tif(x.se<=8&&x.se>=2&&a[o][x.fi][x.se-1]&&a[o][x.fi][x.se+1]){\n\t\ta[o][x.fi][x.se-1]--,a[o][x.fi][x.se+1]--;\n\t\tint now=findans(a[o]);\n\t\tif(now<to[o]) return to[o]=now,2;\n\t\ta[o][x.fi][x.se-1]++,a[o][x.fi][x.se+1]++;\n\t}\n\tif(x.se>=3&&a[o][x.fi][x.se-2]&&a[o][x.fi][x.se-1]){\n\t\ta[o][x.fi][x.se-2]--,a[o][x.fi][x.se-1]--;\n\t\tint now=findans(a[o]);\n\t\tif(now<to[o]) return to[o]=now,3;\n\t\ta[o][x.fi][x.se-2]++,a[o][x.fi][x.se-1]++;\n\t}\n\treturn 0;\n}\nint main(){\n//\tfreopen(\"a.in\",\"r\",stdin);freopen(\"a.out\",\"w\",stdout);\n//\treturn system(\"fc P7147_2.out data.out\"),0;\n#ifdef LOCAL\n\tfreopen(\"29.in\",\"r\",stdin);\n//\tfreopen(\"a.out\",\"w\",stdout);\n#endif\n\tinit();\n\tint o=0,delta=1,Cnt=52;\n\twhile(Cnt--){\n\t\tchar in[10];scanf(\"%s\",in);\n\t\tprint_in(o,in);rd(o,in);\n\t\to=(o+delta+4)%4;\n\t}\n\tfor(int pp=0;pp<=3;++pp){\n\t\tint res=13;\n\t\tfor(int oo=0;oo<=3;++oo)\n\t\t\tfor(int i=1;i<=limt[oo];++i)\n\t\t\t\t++a[pp][oo][i],chkmin(res,findans(a[pp])+1),--a[pp][oo][i];\n\t\tto[pp]=res;\n\t}\n\tCnt=96;bool flag=0;int win=-1;\n\twhile(Cnt--){\n\t\tint ff=1;char in[10];\n\t\tif(!flag){\n\t\t\tscanf(\"%s\",in);\n\t\t\tprint_in(o,in);rd(o,in);\t\n\t\t}\n\t\telse ++Cnt,flag=0;\n\t\tif(drawn(a[o])){print_selfdrawn(o),win=o;break;}\n\t\tpii res=findout(o);\n\t\tprint_out(o,f(res).c_str(),(o+delta*ff+4)%4);\n\t\tif(res.fi==4){\n\t\t\tif(res.se==2) delta*=-1;\n\t\t\telse if(res.se==3) ff=0;\n\t\t\telse o=(o+delta*ff+4)%4;\n\t\t\to=(o+delta*ff+4)%4;\n\t\t\tcontinue;\n\t\t}\n\t\tif(res.fi<=3){\n\t\t\tfor(int nn=(o+delta+4)%4;nn!=o;nn=(nn+delta+4)%4)\n\t\t\t\tif(ron(nn,res)){print_ron(nn),win=nn;break;}\n\t\t\tif(win!=-1) break;\n\t\t\tbool jump=0;\n\t\t\tfor(int nn=0;nn<=3;++nn)\n\t\t\t\tif(nn!=o&&pong(nn,res)){print_pong(nn,f(res).c_str()),o=nn,flag=1,jump=1;break;}\n\t\t\tif(jump) continue;\n\t\t}\n\t\tif(res.fi<=2){\n\t\t\tint tmp;\n\t\t\tif(tmp=chow((o+delta+4)%4,res)){\n\t\t\t\to=(o+delta+4)%4,flag=1;\n\t\t\t\tif(tmp==1) print_chow(o,f(mp(res.fi,res.se)).c_str(),f(mp(res.fi,res.se+1)).c_str(),f(mp(res.fi,res.se+2)).c_str());\n\t\t\t\telse if(tmp==2) print_chow(o,f(mp(res.fi,res.se-1)).c_str(),f(mp(res.fi,res.se)).c_str(),f(mp(res.fi,res.se+1)).c_str());\n\t\t\t\telse print_chow(o,f(mp(res.fi,res.se-2)).c_str(),f(mp(res.fi,res.se-1)).c_str(),f(mp(res.fi,res.se)).c_str());\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\t\to=(o+delta*ff+4)%4;\n\t}\n\tif(win==-1) puts(\"DRAW\");\n\telse print_win(win);\n\treturn 0;\n}\n```",
        "postTime": 1653705882,
        "uid": 160484,
        "name": "cunzai_zsy0531",
        "ccfLevel": 7,
        "title": "P7147\u9898\u89e3"
    },
    {
        "content": "\u4f20\u8bf4\u4e2d\u6bd4\u732a\u56fd\u6740\u66f4\u725b\u903c\u7684\u6a21\u62df\uff1f  \n\u8bdd\u8bf4\u8fd9\u573a\u521d\u8d5b\u8fd8\u6253\u8fc7\uff0c\u5f53\u65f6\u8fd9\u4e2a\u9898\u90fd\u6ca1\u600e\u4e48\u770b\uff08  \n\n\u4e3b\u8981\u662f\u524d\u51e0\u5929\u6253 PKUSC \u7684\u65f6\u5019\u6709\u4e2a\u5224\u65ad\u5411\u542c\u6570\u7684\u9898\uff0c\u4e8e\u662f\u5c31\u60f3\u5230\u6765\u5199\u8fd9\u4e2a\u4e86  \n\u5224\u65ad\u5411\u542c\u7684\u65f6\u5019\u7528\u4e00\u4e2a dp\uff0c\u8bbe $f(i,a,b,p,q,h)$ \u8868\u793a\u8003\u8651\u5230\u7b2c $i$ \u4e2d\u724c\uff0c\u4e4b\u524d\u6709 $a$ \u5bf9 $(i-1,i)$ \u7684\u724c\uff08\u9700\u8981\u8865\u4e00\u4e2a $i+1$ \u7ec4\u6210\u987a\u5b50\uff09\uff0c\u6709 $b$ \u4e2a $i$ \u724c\uff08\u9700\u8981\u8865\u4e00\u4e2a $i+1,i+2$ \u7ec4\u6210\u987a\u5b50\uff09\uff0c\u4e00\u5171\u6254\u4e86 $p$ \u5f20\u724c\uff0c\u4e00\u5171\u62ff\u8fdb\u6765\u4e86 $q$ \u5f20\u724c\uff0c\u76ee\u524d\u6709/\u6ca1\u6709\u96c0\u5934 \u7684\u60c5\u51b5\uff0c\u662f\u5426\u53ef\u4ee5\u8fbe\u6210  \n\n\u8f6c\u79fb\u5c31\u662f\u679a\u4e3e\u52a0\u5165\uff08\u6216\u6254\u6389\uff09\u4e86\u51e0\u5f20 $i+1$\uff0c\u7b2c $i+1$ \u79cd\u724c\u662f\u5426\u8981\u7ec4\u6210\u523b\u5b50\uff0c\u662f\u5426\u8981\u7ec4\u6210\u53bb\u5077\uff0c\u7136\u540e\u6240\u6709\u7684 $b$ \u53d8\u6210 $a$\uff0c\u9664\u53bb\u96c0\u5934\u3001\u523b\u5b50\u5269\u4e0b\u7684\u724c\u53d8\u6210 $b$  \n\u4e00\u4e07\u3001\u4e00\u7d22\u3001\u4e00\u7b52\u3001\u5b57\u724c\u7684\u8f6c\u79fb\u548c\u522b\u7684\u724c\u4e0d\u592a\u76f8\u540c\uff0c\u53ea\u6709 $f(i,0,0,p,q,h)$ \u7684\u72b6\u6001\u53ef\u4ee5\u8f6c\u79fb\u5230\u4ed6\u4eec  \n\u6280\u80fd\u724c\u5219\u662f\u5fc5\u987b\u6254\u6389\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u7528\u9650\u5236\u6280\u80fd\u724c\u4e00\u5171\u6709 $0$ \u5f20\uff0c\u5176\u4ed6\u7684\u4e00\u5171\u6709 $4$ \u5f20\u6765\u5b9e\u73b0\uff0c\u4e0d\u7528\u5355\u72ec\u8ba8\u8bba  \n\n\u7136\u540e\u663e\u7136\u6700\u540e\u5408\u7406\u7684\u72b6\u6001\u662f\u8981\u6ee1\u8db3 $p=q$ \u7684\uff0c\u800c\u8fd9\u4e2a $p$\uff08\u6216 $q$\uff09 \u5c31\u662f\u80e1\u724c\u8ddd\u79bb\uff08\u6ce8\u610f\u9898\u9762\u91cc\u8bf4\u7684\u80e1\u724c\u8ddd\u79bb\u662f\u5411\u542c\u6570\u52a0\u4e00\uff09  \n\u7531\u4e8e\u6280\u80fd\u724c\u7684\u5b58\u5728\uff0c\u4e14\u4e0d\u8003\u8651\u4e03\u5bf9\u5b50\uff0c\u6240\u4ee5\u6700\u5927\u80e1\u724c\u8ddd\u79bb\u662f $12$\uff08\u7ed9\u4f60\u53d1 $12$ \u5f20\u6280\u80fd\u724c\uff09  \n\u56e0\u4e3a\u4e00\u5171\u6709 $37$ \u79cd\u724c\uff0c\u6240\u4ee5\u6700\u540e\u627e\u6700\u5c0f\u7684 $dis$ \u6ee1\u8db3 $f(37,0,0,dis,dis,1)=1$  \n\u56e0\u4e3a\u8fd8\u8981\u627e\u5230\u6700\u5927\u7684\u80fd\u6253\u7684\u724c\uff0c\u6240\u4ee5\u8981\u518d\u8bb0\u5f55\u4e00\u4e2a\u6570\u7ec4\u8868\u793a\u80fd\u8fbe\u6210\u6b64\u72b6\u6001\u7684\u524d\u63d0\u4e0b\uff0c\u6254\u6389\u7684\u724c\u4e2d\u6700\u5927\u662f\u591a\u5c11  \n\n\u8fd9\u4e2a dp \u7684\u72b6\u6001\u6570\u662f $38\\times 5\\times 5\\times 13\\times 13\\times 2$\uff0c\u6bcf\u4e2a\u72b6\u6001\u7684\u8f6c\u79fb\u6700\u591a\u6709 $12$\uff08\u76f8\u540c\u7684\u724c\u4e00\u5171\u6709 $4$ \u5f20\uff0c\u6240\u4ee5\u6254\u6389\u3001\u6dfb\u52a0\u4e00\u5171\u6709 $4$ \u79cd\u60c5\u51b5\uff0c\u518d\u52a0\u4e0a\u6709\u96c0\u5934\u3001\u6709\u523b\u5b50\u3001\u6ca1\u6709\u96c0\u5934\u6216\u523b\u5b50\u4e09\u79cd\u60c5\u51b5\uff09  \n\u770b\u8d77\u6765\u590d\u6742\u5ea6\u4e0d\u4f4e\uff0c\u4f46\u662f\u663e\u7136\u5b8c\u5168\u8dd1\u4e0d\u6ee1\uff1b\u8003\u8651\u4e00\u5171\u8981\u505a\u591a\u5c11\u6b21\u8fd9\u6837\u7684 dp\uff0c\u914d\u724c\u540e\u8fd8\u5269 $96$ \u5f20\u724c\uff0c\u8fd9\u4e9b\u8981\u5224\u65ad\u5207\u4ec0\u4e48\u724c\u4e00\u6b21\u3001\u5207\u5b8c\u5224\u65ad\u522b\u4eba\u80e1\u4e0d\u80e1\u8fd9\u4e2a\u56db\u6b21\uff0c\u6240\u4ee5\u56fa\u5b9a\u6709 $480$ \u6b21\uff0c\u800c\u4e00\u5c40\u79cd\u80fd\u526f\u9732\u7684\u60c5\u51b5\u5b9e\u9645\u975e\u5e38\u5c11\uff0c\u57fa\u672c\u4e0d\u7528\u8003\u8651  \n\u6240\u4ee5\u6bcf\u6b21\u5403\u78b0\u3001\u5224\u65ad\u662f\u5426\u8363\u548c\u90fd\u53ea\u8981\u66b4\u529b\u8dd1\u8fd9\u4e2a dp \u5c31\u884c\uff0c\u5e76\u4e0d\u9700\u8981\u4ec0\u4e48\u5176\u4ed6\u7684\u9a9a\u64cd\u4f5c\uff08  \n\n\u5224\u65ad\u5403\u78b0\u7684\u65f6\u5019\u8981\u628a\u62ff\u51fa\u6765\u526f\u9732\u7684\u4e24\u5f20\u724c\u4ece\u624b\u724c\u91cc\u5220\u6389\u8dd1 dp\uff0c\u800c\u4e0d\u662f\u628a\u8981\u88ab\u5403\u78b0\u7684\u90a3\u5f20\u724c\u52a0\u8fdb\u53bb\uff0c\u5426\u5219\u53ef\u80fd\u4f1a\u5bfc\u81f4\u90a3\u5f20\u52a0\u8fdb\u53bb\u7684\u724c\u548c\u522b\u7684\u724c\uff08\u4e0d\u662f\u8981\u526f\u9732\u7684\u90a3\u4e24\u5f20\uff09\u7ec4\u6210\u9762\u5b50\u6216\u96c0\u5934  \n\u53e6\u5916\u526f\u9732\u4e86\u7684\u724c\u5c31\u6ca1\u7528\u4e86\uff0c\u76f4\u63a5\u5220\u4e86\u5c31\u884c\u4e0d\u7528\u8bb0\u5f55  \n\n\u7136\u540e\u4ed6\u751a\u81f3\u4e0d\u9700\u8981\u5b58\u724c\u5c71\uff08  \n\u5177\u4f53\u7ec6\u8282\u4e0a\u7528\u4e00\u4e2a `cardNum` \u5b9a\u4e49\u8fd9\u79cd\u724c\u6700\u591a\u591a\u5c11\u5f20\uff0c\u7528 `isBeginCard` \u5b9a\u4e49\u8fd9\u79cd\u724c\u662f\u5426\u662f\u4e00\u4e07\u3001\u4e00\u7d22\u3001\u4e00\u7b52\u3001\u5b57\u724c\u3001\u6280\u80fd\u724c  \n\u7136\u540e\u5403\u7684\u65f6\u5019\uff0c\u5982\u679c\u4f60\u5b58\u6240\u6709\u724c\u7684\u7f16\u53f7\u662f\u8fde\u7740\u7684\uff0c\u4e0d\u8981\u4e0d\u8981\u51fa\u73b0\u62ff 89M \u53bb\u5403 1P\uff0c\u6216\u8005\u5403\u4e86\u5b57\u724c\u8fd9\u79cd\u4e8b\uff08  \n\u6240\u4ee5\u4e0b\u4e00\u6b65\u662f\u4e0d\u662f\u8981\u51fa\u4e2a\u5728\u5411\u542c\u6570\u6700\u5c0f\u7684\u60c5\u51b5\u4e0b\u8981\u6c42\u7528\u8fdb\u5f20\u6570\u6700\u5e7f\u7684\u6253\u6cd5\u7684\u9898\uff0c\u518d\u4e0b\u4e00\u6b65\u662f\u4e0d\u662f\u8981\u51fa\u4e2a\u8003\u8651\u5f79\u79cd\u7684\u9898\uff0c\u518d\u4e0b\u4e00\u6b65\u662f\u4e0d\u662f\u8981\u548c\u4e09\u4e2a\u4ea4\u4e92\u5e93\u4e00\u5757\u6253\u9ebb\u5c06\uff08  \n\n\u4ee3\u7801\u53ea\u6709 5K \u591a\u70b9\uff0c\u751a\u81f3\u6bd4\u67d0\u4e9b\u6570\u636e\u7ed3\u6784\u9898\u8fd8\u77ed\uff0c\u611f\u89c9\u9664\u4e86\u6ca1\u600e\u4e48\u5c01\u88c5\u5916\u8fd8\u633a\u597d\u770b\uff08  \n\n```cpp  \n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<assert.h>\nconst int _nex[2][4]={{1,2,3,0},{3,0,1,2}};\nconst int *nex=_nex[0];\nint order=0;\nconst char playerName[]={'A','B','C','D'};\nconst char *cardName[]={\n\t\"\",\n\t\"1M\",\"2M\",\"3M\",\"4M\",\"5M\",\"6M\",\"7M\",\"8M\",\"9M\",\n\t\"1P\",\"2P\",\"3P\",\"4P\",\"5P\",\"6P\",\"7P\",\"8P\",\"9P\",\n\t\"1S\",\"2S\",\"3S\",\"4S\",\"5S\",\"6S\",\"7S\",\"8S\",\"9S\",\n\t\"E\",\"S\",\"W\",\"N\",\"B\",\"F\",\"Z\",\n\t\"DOUBLE\",\"REVERSE\",\"PASS\"\n};\nconst int isBeginCard[]={1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1};\nconst int cardNum[]={0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0};\n#define CARD_TYPE_NUM 37\n#define CARD_TYPE_NUM2 34\n#define PLAYER_NUM 4\n#define MAX_DIS 12\nchar input[12];\ninline int strMatch(const char *s,const char *t){\n\tfor(int i=0,j=0;s[i]||t[j];i++,j++)if(s[i]!=t[j]) return 0;\n\treturn 1;\n}\nstruct Player{\n\tint dis,id;//max dis: 12\n\tint t[38];\n\tinline int getCard(){\n\t\tif(scanf(\"%s\",input)==EOF) return 0;\n\t\tfor(int i=1;i<=CARD_TYPE_NUM;i++)if(strMatch(input,cardName[i])){\n\t\t\tt[i]++;printf(\"%c IN %s\\n\",playerName[id],cardName[i]);\n\t\t\tbreak;\n\t\t}\n\t\treturn 1;\n\t}\n\tinline void init(int _id){id=_id;dis=MAX_DIS;}\n};\nint f[38][5][5][14][14][2][2];\ninline void trans(int *t,int i,int a,int b,int p,int q,int h,int dis){\n\tif(!f[i][a][b][p][q][h][0]) return;\n\tint *u=f[i][a][b][p][q][h],*_u;\n\tfor(int n,x=std::max(p-dis,-t[i+1]);x+q<=dis&&x+t[i+1]<=cardNum[i+1];x++){//x= num of cards that will be added\n\t\tn=t[i+1]+x;\n\t\tfor(int _h=0;_h+h<2&&2*_h+a+b<=n;_h++)for(int o=0;2*_h+3*o+a+b<=n;o++){\n\t\t\tif(x<0){\n\t\t\t\t_u=f[i+1][b][n-2*_h-3*o-a-b][p-x][q][h|_h];\n\t\t\t\t_u[1]=i+1;_u[0]=1;\n\t\t\t}\n\t\t\telse{\n\t\t\t\t_u=f[i+1][b][n-2*_h-3*o-a-b][p][q+x][h|_h];\n\t\t\t\t_u[1]=std::max(_u[1],u[1]);_u[0]=1;\n\t\t\t}\n\t\t}\n\t}\n}\ninline int findCardDp(int *t,int &dis){\n\t//f...[0]: can reach? f...[1]: the biggest card that be thrown\n\t//f[i][a][b][p][q][h]: p= num of cards that be thrown q= num of cards that be added h= if thers is a head\n\t//a= num of (i-1,i) b= num of (i)\n\tstd::memset(f,0,sizeof f);\n\tf[0][0][0][0][0][0][0]=1;\n\tfor(int i=0;i<CARD_TYPE_NUM;i++)for(int p=0;p<=dis;p++)for(int q=0;q<=dis;q++)for(int h=0;h<2;h++){\n\t\tif(isBeginCard[i+1]) trans(t,i,0,0,p,q,h,dis);\n\t\telse for(int a=0;a<=4;a++)for(int b=0;a+b<=4;b++) trans(t,i,a,b,p,q,h,dis);\n\t}\n\tfor(dis=0;dis<=MAX_DIS&&!f[CARD_TYPE_NUM][0][0][dis][dis][1][0];dis++);\n\tif(dis>12) return 0;\n\treturn f[CARD_TYPE_NUM][0][0][dis][dis][1][1];\n}\ninline int findCard(Player &p,int &nextPlayer){\n\tif(p.t[37]) return nextPlayer=nex[nex[p.id]],37;\n    else if(p.t[36]) return nex=_nex[order^=1],nextPlayer=nex[p.id],36;\n    else if(p.t[35]) return nextPlayer=p.id,35;\n    nextPlayer=nex[p.id];\n    return findCardDp(p.t,p.dis);\n}\ninline int ron(Player &p,int card){\n\tif(p.dis!=1) return 0;\n\tp.t[card]++;\n\tint disBackup=p.dis;\n\tfindCardDp(p.t,p.dis);\n\tif(!p.dis){\n\t\tprintf(\"%c RON\\n\",playerName[p.id]);\n\t\treturn 1;\n\t}\n\tp.t[card]--;p.dis=disBackup;\n\treturn 0;\n}\ninline int pon(Player &p,int card){\n\tif(p.t[card]<2) return 0;\n\tp.t[card]-=2;\n\tint disBackup=p.dis;\n\tfindCardDp(p.t,p.dis);\n\tif(p.dis>=disBackup){\n\t\tp.dis=disBackup;p.t[card]+=2;\n\t\treturn 0;\n\t}\n\tprintf(\"%c PONG %s %s %s\\n\",playerName[p.id],cardName[card],cardName[card],cardName[card]);\n\treturn 1;\n}\ninline int chi(Player &p,int a,int b,int c){\n\tif(!p.t[a]||!p.t[b]) return 0;\n\tp.t[a]--;p.t[b]--;\n\tint disBackup=p.dis;\n\tfindCardDp(p.t,p.dis);\n\tif(p.dis>=disBackup){\n\t\tp.t[a]++;p.t[b]++;p.dis=disBackup;\n\t\treturn 0;\n\t}\n\tif(b>c) std::swap(b,c);\n\tif(a>b) std::swap(a,b);\n\tif(b>c) std::swap(b,c);\n\tif(a>b) std::swap(a,b);\n\tprintf(\"%c CHOW %s %s %s\\n\",playerName[p.id],cardName[a],cardName[b],cardName[c]);\n\treturn 1;\n}\ninline int chi(Player &p,int card){\n\tint a,b;\n\ta=card+1;b=card+2;\n\tif(!isBeginCard[a]&&!isBeginCard[b]&&chi(p,a,b,card)) return 1;\n\ta=card-1;b=card+1;\n\tif(!isBeginCard[card]&&!isBeginCard[b]&&chi(p,a,b,card)) return 1;\n\ta=card-2;b=card-1;\n\tif(!isBeginCard[card]&&!isBeginCard[b]&&chi(p,a,b,card)) return 1;\n\treturn 0;\n}\nPlayer p[4];\ninline int ron(int gunner,int c){\n\tfor(int j=nex[gunner];j!=gunner;j=nex[j])\n\t\tif(ron(p[j],c)) return 1;\n\treturn 0;\n}\ninline int pon(int &nextPlayer,int c){\n\tfor(int j=nextPlayer;nex[j]!=nextPlayer;j=nex[j])\n\t\tif(pon(p[j],c)) return nextPlayer=j,1;\n\treturn 0;\n}\ninline int chi(int &nextPlayer,int c){\n\tif(chi(p[nextPlayer],c)) return 1;\n\treturn 0;\n}\nint main(){\n\tfor(int i=0;i<PLAYER_NUM;i++) p[i].init(i);\n\tfor(int i=1;i<=13;i++)for(int j=0;j<PLAYER_NUM;j++) p[j].getCard();\n\tint willGetCard=1;\n\tfor(int i=0,nextPlayer;;i=nextPlayer){\n\t\tif(willGetCard&&!p[i].getCard()) break;\n\t\tint c=findCard(p[i],nextPlayer);willGetCard=1;\n\t\tif(!p[i].dis){\n\t\t\tprintf(\"%c SELFDRAWN\\n\",playerName[i]);\n\t\t\tbreak;\n\t\t}\n\t\tprintf(\"%c OUT %s\",playerName[i],cardName[c]);\n\t\tp[i].t[c]--;\n\t\tif(c==37) printf(\" %c\\n\",playerName[nex[i]]);\n\t\telse puts(\"\");\n\t\tif(c>CARD_TYPE_NUM2) continue;\n\t\tif(ron(i,c)) break;\n\t\tif(pon(nextPlayer,c)||chi(nextPlayer,c)) willGetCard=0;\n\t}\n\tfor(int i=0;i<PLAYER_NUM;i++)if(!p[i].dis) return printf(\"%c WIN\\n\",playerName[i]),0;\n\tputs(\"DRAW\");\n\treturn 0;\n}\n```  \n",
        "postTime": 1653650709,
        "uid": 164432,
        "name": "suxxsfe",
        "ccfLevel": 9,
        "title": "P7147 [THUPC2021 \u521d\u8d5b] \u9ebb\u5c06\u6a21\u62df\u5668"
    }
]