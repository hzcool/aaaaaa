[
    {
        "content": "\u8fd9\u91cc\u662f\u9a8c\u9898\u4eba\u9898\u89e3\u3002\n\n\u6743\u503c\u548c\u7684 $k$ \u6b21\u65b9\u4e58\u6cd5\u5206\u914d\u5f8b\u5c55\u5f00\uff0c\u53ef\u4ee5\u770b\u505a\u662f\u9009 $k$ \u4e2a\u4f4d\u7f6e\uff08\u53ef\u91cd\uff09\uff0c\u8d21\u732e\u662f\u8fd9\u4e9b\u4f4d\u7f6e\u7684\u6743\u503c\u4e58\u79ef\u518d\u4e58\u4e0a\u8fd9\u4e9b\u4f4d\u7f6e\u90fd\u88ab\u8986\u76d6\u7684\u6982\u7387\u3002\n\n\u4ee4\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u88ab\u9009\u4e2d\u6b21\u6570\u4e3a $c_i$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u4e9b\u9009\u4e2d\u4f4d\u7f6e\u7684\u6392\u5217\u65b9\u6848\u6570\u662f $\\frac{k!}{\\prod c_i!}$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a $O(n^4)$ \u7684 DP\uff0c\u4ee4 $f_{i,j,k}$ \u8868\u793a\u524d $i$ \u4e2a\u4f4d\u7f6e\u5df2\u7ecf\u9009\u4e86 $j$ \u4e2a\uff0c\u9009\u62e9\u7684\u533a\u95f4\u6700\u8fdc\u8fd8\u80fd\u8986\u76d6\u5230 $k$ \u7684\u7b54\u6848\u3002\n\n\u8f6c\u79fb\u9700\u8981\u5bf9\u533a\u95f4\u548c\u7403\u5206\u522b\u8003\u8651\u3002\n\n\u8003\u8651\u5bb9\u65a5\u53bb\u6389\u7b2c\u4e09\u7ef4\uff0c\u9009\u4e2d\u4f4d\u7f6e\u90fd\u88ab\u8986\u76d6\u7684\u6982\u7387\u76f8\u5f53\u4e8e $\\sum_{T} (-1)^{T} p_T$\uff0c\u5176\u4e2d $p_T$ \u8868\u793a $T$ \u96c6\u5408\u4e2d\u7684\u70b9\u4e00\u5b9a\u6ca1\u88ab\u8986\u76d6\u7684\u6982\u7387\u3002\n\n\u9996\u5148\u6211\u4eec\u80fd\u53d1\u73b0\u5bb9\u65a5\u94a6\u5b9a\u7684\u4e0d\u80fd\u88ab\u8986\u76d6\u7684\u4f4d\u7f6e\u548c\u5176\u4ed6\u4f4d\u7f6e\u4e24\u90e8\u5206\u662f\u72ec\u7acb\u7684\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5206\u522b DP \u7136\u540e\u5408\u5e76\u3002\n\n\u540e\u8005\u76f4\u63a5 $O(n^3)$ DP \u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u524d\u8005\uff0c\u8bbe\u81f3\u5c11\u88ab\u9009\u4e2d\u4e00\u6b21\u7684\u4f4d\u7f6e\u4ece\u5c0f\u5230\u5927\u4f9d\u6b21\u662f $x_0=0,x_1,x_2,\\dots,x_{k'}$\uff0c\u8fd9\u4e9b\u4f4d\u7f6e\u4e00\u5b9a\u4e0d\u80fd\u88ab\u8986\u76d6\u76f8\u5f53\u4e8e\u5bf9\u4e8e $i\\in[0,k')$\uff0c\u5de6\u7aef\u70b9\u5728 $(x_i,x_{i+1}]$\uff0c\u53f3\u7aef\u70b9\u5927\u4e8e\u7b49\u4e8e $x_{i+1}$ \u7684\u533a\u95f4\u4e0d\u80fd\u9009\uff0c\u5269\u4e0b\u4efb\u610f\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fd9\u53ea\u548c\u76f8\u90bb\u4e24\u4e2a\u70b9\u7684\u4f4d\u7f6e\u6709\u5173\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5 DP \u4e86\u3002\n\n\u4ee4 $f_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u4f4d\u7f6e\u94a6\u5b9a\u4e86 $j$ \u4e2a\u4f4d\u7f6e\u4e0d\u80fd\u9009\uff0c\u5e76\u4e14 $i$ \u4e00\u5b9a\u81f3\u5c11\u88ab\u9009\u4e2d\u4e86\u4e00\u6b21\u3002\n\n\u8f6c\u79fb\u8003\u8651\u679a\u4e3e\u4e0a\u4e00\u4e2a\u9009\u7684\u4f4d\u7f6e\u4ee5\u53ca\u5f53\u524d\u4f4d\u7f6e\u9009\u4e86\u51e0\u4e2a\uff1a\n$$\nf_{i,j}=\\sum_{l\\le j}\\sum_{k<i} f_{k,j-l}\\times \\frac{a_i^l}{l!}\\times\\frac {S_{i,i}}{S_{k,i}}\n$$\n\u5176\u4e2d $S_{i,j}$ \u8868\u793a\u53f3\u7aef\u70b9\u5927\u4e8e\u7b49\u4e8e $i$\uff0c\u5de6\u7aef\u70b9\u5c0f\u4e8e\u7b49\u4e8e $j$ \u7684\u533a\u95f4\u90fd\u4e0d\u9009\u7684\u6982\u7387\u3002\n\n\u8fd9\u4e2a\u8f6c\u79fb\u53ef\u4ee5\u524d\u7f00\u548c\u4f18\u5316\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^3)$\u3002",
        "postTime": 1618442576,
        "uid": 43123,
        "name": "\u52a0\u85e4\u60e0",
        "ccfLevel": 0,
        "title": "P7483 50\u5e74\u540e\u7684\u6211\u4eec"
    },
    {
        "content": "\u53ea\u4f1a\u8ba1\u6570\u9898\u4e86.jpg\n\n\u770b\u5230\u201c\u6709\u9009\u624b\u901a\u8fc7\u7684\u9898\u7684\u4ef7\u503c\u4e4b\u548c\u7684 $k$ \u6b21\u5e42\u201d\uff0c\u5148\u60f3 $k$ \u6b21\u5e42\u6709\u4ec0\u4e48\u5957\u8def\u3002\u597d\u50cf\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u4e0d\u592a\u884c\uff0c\u8003\u8651 $k$ \u6b21\u5e42\u7684\u7ec4\u5408\u610f\u4e49\u3002\n\n$$(\\sum x_i)^k=\\sum {k\\choose t_1,t_2,...,t_n}x_1^{t_1}x_2^{t_2}...x_n^{t_n},\\sum t_i=k$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u7528 $e^{x_i}$ \u7684\u751f\u6210\u51fd\u6570\u7406\u89e3\u3002\n\n\u7279\u6b8a\u6027\u8d28 A\uff1a\u56e0\u4e3a\u6bcf\u4e2a\u533a\u95f4\u4e92\u4e0d\u5f71\u54cd\uff0c\u5c06\u6bcf\u4e2a\u9009\u624b\u771f\u6b63\u7684\u505a\u9898\u8303\u56f4\u4e8c\u5206\u51fa\u6765\uff0c\u8fd9\u6837 $m$ \u6700\u591a\u6709 $n$ \u4e2a\u3002\u8ba1\u6570\u5c31\u76f8\u5f53\u4e8e\u505a\u4e00\u4e2a\u5377\u79ef\uff0c$k$ \u5f88\u5c0f\uff0c\u53ef\u4ee5\u66b4\u529b $\\mathcal{O}(k^2)$ \u5377\u79ef\uff0c\u65f6\u95f4 $\\mathcal{O}(nk^2)$\u3002\n\n\u6ca1\u6709\u7279\u6b8a\u6027\u8d28\uff0c\u6211\u4eec\u8003\u8651\u8fd9\u6837\u7684\u5377\u79ef\u53ea\u80fd\u505a $n$ \u6b21\uff0c\u90a3\u4e48\u80af\u5b9a\u9700\u8981\u5bfb\u627e\u4e00\u4e9b\u5176\u4ed6\u65b9\u6cd5\u3002\n\n\u5e73\u9762\u7ebf\u6bb5\u5e76\u96c6\uff0c\u6709\u4e00\u4e2a\u5957\u8def\uff0c\u5c31\u662f\u628a\u7ebf\u6bb5\u6309 $l$ \u6392\u5e8f\uff0c\u7136\u540e\u5bf9\u4e8e\u5ef6\u4f38\u6700\u8fdc\u7684 $r$ \u8bb0\u5f55\u8fd9\u4e2a\u591a\u9879\u5f0f\u3002\u5982\u679c\u6211\u4eec\u5173\u5fc3\u6bcf\u4e2a\u6570\u4ec0\u4e48\u65f6\u5019\u52a0\u5165\u4e4b\u548c\u7684 $k$ \u6b21\u5e42\uff0c\u6bcf\u6b21\u8f6c\u79fb\u7684\u72b6\u6001\u6709 $n$ \u4e2a\uff0c\u4e0d\u53ef\u63a5\u53d7\u3002\n\n\u90a3\u4e48\u6211\u4eec\u6362\u4e00\u4e2a\u89d2\u5ea6\u601d\u8003\uff1a\u82e5\u8003\u8651\u6ca1\u88ab\u7b97\u8fdb\u53bb\u662f\u54ea\u4e9b\uff0c$r$ \u6700\u8fdc\u5ef6\u4f38\u5230\u54ea\u513f\u5c31\u4e0d\u91cd\u8981\u4e86\u3002$r$ \u53ea\u9700\u6ee1\u8db3 $<i$\uff0c\u800c\u4e14\u6bcf\u6b21\u7684\u72b6\u6001\u53ea\u6709\u4e00\u4e2a\u3002\n\n\u63a5\u7740\u5206\u7c7b\u8f6c\u79fb\uff1a\n\n\u76ee\u524d\u5728\u4f4d\u7f6e $i$\uff0c\u52a0\u8fdb\u7ebf\u6bb5 $[i,r]$\uff1a\n\n- $j<r$\uff0c$f'_j=f_j\\times (1-p)$\n- $j=r$\uff0c$f'_j=f_j+p\\times \\sum_{t<j} f_t$\n- $j>r$\uff0c$f'_j=f_j$\n\n\u987a\u4fbf\uff0c\u6211\u4eec\u5728\u6392\u5e8f\u7684\u65f6\u5019\u4fdd\u8bc1 $l$ \u76f8\u540c $r$ \u9012\u589e\uff0c\u8fd9\u6837\u7ef4\u62a4 $\\sum_{t<r} f_t$ \u7684\u65f6\u5019\u6bcf\u4e2a\u4f4d\u7f6e\u88ab\u52a0\u8fdb\u5165 $\\mathcal{O}(n^2)$ \u6b21\uff0c\u6bcf\u6b21\u65f6\u95f4 $\\mathcal{O}(k)$\uff0c\u65f6\u95f4\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\u3002\u5bf9\u4e8e $j<r$ \u7684\u90e8\u5206\uff0c\u6211\u4eec\u66b4\u529b\u5728\u591a\u9879\u5f0f\u4e0a\u6253\u5168\u5c40\u4e58\u6807\u8bb0\uff0c\u6bcf\u6b21\u8981\u64cd\u4f5c\u7684\u65f6\u5019\u66b4\u529b\u4e0b\u4f20\u4e00\u4e0b\u3002\n\n\u65f6\u95f4 $\\mathcal{O}(nk^2+n^2k)$\u3002\n\n\u7b97\u4e86\uff0c\u7b97\u4e86\uff0c\u770b\u4ee3\u7801\u5427\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef pair<int,int> pii;\n#define d first\n#define c second\nconst int maxn=100005;\nconst int maxk=405;\nconst int mod=998244353;\nint n,m,k; pii a[maxn]; ll f[maxk][maxk],sum[maxk],mul[maxk],pw[maxk],tmp[maxk],fac[maxk],inv_fac[maxk];\nstruct seg { int l,r,p; } t[maxn];\ninline bool operator < (const seg &a,const seg &b)\n{\n\tif(a.l==b.l) return a.r<b.r;\n\treturn a.l<b.l;\n}\ninline void pushtag(int p)\n{\n\tfor(int i=0;i<=k;i++) f[p][i]=f[p][i]*mul[p]%mod;\n\tmul[p]=1;\n}\nint main()\n{\n\tfac[0]=fac[1]=inv_fac[0]=inv_fac[1]=1;\n\tfor(int i=2;i<maxk;i++) fac[i]=fac[i-1]*i%mod;\n\tfor(int i=2;i<maxk;i++) inv_fac[i]=(mod-mod/i)*inv_fac[mod%i]%mod;\n\tfor(int i=2;i<maxk;i++) (inv_fac[i]*=inv_fac[i-1])%=mod;\n\tscanf(\"%d%d%d\",&n,&m,&k);\n\tll S=0;\n\tfor(int i=1;i<=n;i++) scanf(\"%d%d\",&a[i].d,&a[i].c),(S+=a[i].c)%=mod;\n\tsort(a+1,a+n+1);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tscanf(\"%d%d%d\",&t[i].l,&t[i].r,&t[i].p);\n\t\tt[i].l=lower_bound(a+1,a+n+1,pii(t[i].l,0))-a;\n\t\tt[i].r=lower_bound(a+1,a+n+1,pii(t[i].r+1,0))-a-1;\n\t\tif(t[i].l>t[i].r) i--,m--;\n\t}\n\tif(m==0) return puts(\"0\"),0;\n\tsort(t+1,t+m+1);\n\tfor(int i=0;i<=n;i++) mul[i]=1;\n\tf[0][0]=1;\n\tfor(int i=1;i<=k;i++) f[0][i]=f[0][i-1]*S%mod;\n\tfor(int i=0;i<=k;i++) f[0][i]=f[0][i]*inv_fac[i]%mod;\n\tfor(int i=1,j=1;i<=n;i++)\n\t{\n\t\tpushtag(0);\n\t\tfor(int s=0;s<=k;s++) sum[s]=f[0][s];\n\t\tint lstr=i-1;\n\t\tfor(;j<=m && t[j].l==i;j++)\n\t\t{\n\t\t\twhile(lstr<t[j].r-1)\n\t\t\t{\n\t\t\t\tlstr++,pushtag(lstr);\n\t\t\t\tfor(int s=0;s<=k;s++) (sum[s]+=f[lstr][s])%=mod;\n\t\t\t}\n\t\t\tpushtag(t[j].r);\n\t\t\tfor(int s=0;s<=k;s++)\n\t\t\t\t(f[t[j].r][s]+=sum[s]*t[j].p)%=mod,sum[s]=sum[s]*(mod+1-t[j].p)%mod;\n\t\t\tfor(int s=i;s<t[j].r;s++) mul[s]=mul[s]*(mod+1-t[j].p)%mod;\n\t\t\tmul[0]=mul[0]*(mod+1-t[j].p)%mod;\n\t\t}\n\t\tpushtag(0),pushtag(i);\n\t\tpw[0]=1;\n\t\tfor(int s=1;s<=k;s++) pw[s]=pw[s-1]*(mod-a[i].c)%mod;\n\t\tfor(int s=0;s<=k;s++) pw[s]=pw[s]*inv_fac[s]%mod,tmp[s]=0;\n\t\tfor(int x=0;x<=k;x++)\n\t\t\tfor(int y=0;y<=k-x;y++)\n\t\t\t\t(tmp[x+y]+=f[0][x]*pw[y])%=mod;\n\t\tfor(int s=0;s<=k;s++) f[0][s]=(tmp[s]+f[i][s])%mod,f[i][s]=0;\n\t}\n\tll ans=0;\n\tfor(int i=0;i<=n;i++) (ans+=f[i][k])%=mod;\n\tprintf(\"%lld\\n\",(ans*fac[k]%mod+mod)%mod);\n\treturn 0;\n}\n```",
        "postTime": 1617862182,
        "uid": 35069,
        "name": "Owen_codeisking",
        "ccfLevel": 9,
        "title": "\u3010\u9898\u89e3\u3011P7483 \u3010E\u301150\u5e74\u540e\u7684\u6211\u4eec"
    },
    {
        "content": "\u7ed9\u4e2a\u4e0d\u4e00\u6837\u7684\u505a\u6cd5\u3002\n\n\u8003\u8651\u5230\u201c\u88ab\u8fc7\u7684\u9898\u201d\u7684\u9650\u5236\u662f\u8986\u76d6\u5b83\u7684\u533a\u95f4\u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u88ab\u9009\uff0c\u8fd9\u4e2a\u5f88\u96be\u53d7\u3002\u81ea\u7136\u7684\u60f3\u6cd5\u662f\u8f6c\u6362\u6210\u7b97\u201c\u6ca1\u88ab\u8fc7\u7684\u9898\u201d\uff0c\u9650\u5236\u662f\u8986\u76d6\u5b83\u7684\u533a\u95f4\u4e2d\u4e00\u4e2a\u90fd\u4e0d\u80fd\u9009\uff0c\u8fd9\u4e2a\u5c31\u8212\u670d\u591a\u4e86\u3002\n\n\u4f46\u662f\u6c42\u8fd9\u4e2a\u6709\u5565\u7528\u5462\uff1f\n\n\u8003\u8651\u62c6\u4e00\u4e0b\u5f0f\u5b50\uff0c\u8bbe\u6240\u6709\u9898\u7684\u4ef7\u503c\u548c\u4e3a $S$\uff1a\n\n$$\\begin{aligned}&\\mathbb E(w({\\rm covered})^k)\\\\=\\ &\\mathbb E((S-w({\\rm uncovered}))^k)\\\\=\\ &\\mathbb E\\left(\\sum_{i=0}^k(-1)^{k-i}S^iw({\\rm uncovered})^{k-i}\\dbinom{k}{i}\\right)\\\\=\\ &\\sum_{i=0}^k\\dbinom{k}{i}(-1)^{k-i}S^i\\mathbb E\\left(w({\\rm uncovered})^{k-i}\\right)\\end{aligned}$$\n\n\u6240\u4ee5\u53ea\u8981\u80fd\u5bf9\u4e8e\u6240\u6709 $1\\leq k\\leq K$\uff0c\u6c42\u51fa\u6ca1\u4eba\u8fc7\u7684\u9898\u7684\u4ef7\u503c\u548c\u7684 $k$ \u6b21\u65b9\u7684\u671f\u671b\uff0c\u5c31\u53ef\u4ee5\u5728\u7ebf\u6027\u65f6\u95f4\u5185\u8fd8\u539f\u6709\u4eba\u8fc7\u7684\u9898\u7684\u4ef7\u503c\u548c\u7684 $K$ \u6b21\u65b9\u7684\u671f\u671b\u3002\n\n\u4e0b\u9762\u8003\u8651\u524d\u7f00 DP\uff0c\u8bbe $f_{i,j}$ \u4e3a\u8003\u8651\u5230\u524d $i$ \u4e2a\u9898\uff0c\u7b2c $i$ \u4e2a\u9898\u6ca1\u4eba\u8fc7\uff08\u5f3a\u5236\u7ed3\u5c3e\uff09\uff0c\u6ca1\u4eba\u8fc7\u7684\u9898\u7684\u4ef7\u503c\u548c\u7684 $j$ \u6b21\u65b9\u7684\u671f\u671b\u3002\n\n\u8f6c\u79fb\u76f4\u63a5\u679a\u4e3e\u4e0a\u4e00\u4e2a\u6ca1\u4eba\u8fc7\u7684\u9898 $k<i$\uff0c\u5904\u7406 $j$ \u6b21\u5e42\u8fd8\u53ef\u4ee5\u8003\u8651\u4e8c\u9879\u5f0f\u5b9a\u7406\u5c55\u5f00\uff1a\n\n$$\\begin{aligned}&\\mathbb E((a+b)^k)\\\\=\\ &\\mathbb E\\left(\\sum_{i=0}^ka^ib^{k-i}\\dbinom{k}{i}\\right)\\\\=\\ &\\sum_{i=0}^k\\dbinom{k}{i}\\mathbb E(a^ib^{k-i})\\end{aligned}$$\n\n\u5728\u8f6c\u79fb\u4e2d\uff0c$b$ \u662f\u5e38\u91cf $c_i$\u3002\u6240\u4ee5\u8f6c\u79fb\u5f0f\u5982\u4e0b\uff1a\n\n$$f_{i,j}=\\sum_{k<i}\\sum_{x\\leq j}f_{k,x}\\dbinom{j}{x}c_i^{j-x}P(k+1,i)$$\n\n\u5176\u4e2d $P(l,r)$ \u7684\u542b\u4e49\u662f $[l,r-1]$ \u4e2d\u6240\u6709\u5143\u7d20\u88ab\u5305\u542b\u4e8e $[l,r-1]$ \u4e2d\u7684\u533a\u95f4\u8986\u76d6\uff0c\u4e14 $r$ \u6ca1\u6709\u88ab\u4efb\u4f55\u5de6\u7aef\u70b9\u5728 $[l,r]$ \u4e4b\u95f4\uff0c\u53f3\u7aef\u70b9\u5728 $[r,n]$ \u4e4b\u95f4\u7684\u533a\u95f4\u8986\u76d6\u7684\u6982\u7387\u3002\n\n\u9996\u5148\u8003\u5bdf\u5982\u4f55\u5feb\u901f\u8ba1\u7b97 $P(l,r)$\u3002\n\n\u5bb9\u6613\u89c2\u5bdf\u5230 $P(l,r)$ \u7684\u5b9a\u4e49\u5272\u88c2\u4e3a\u4e24\u90e8\u5206\uff0c\u7ed3\u679c\u662f\u4e24\u90e8\u5206\u7684\u7ed3\u679c\u76f8\u4e58\uff0c\u56e0\u6b64\u5206\u522b\u8003\u8651\u4e24\u90e8\u5206\u3002\u524d\u4e00\u90e8\u5206 $P_1(l,r)$ \u53ef\u4ee5\u5bb9\u65a5\uff1a\u5982\u679c\u6ca1\u6709\u88ab\u5b8c\u5168\u8986\u76d6\uff0c\u679a\u4e3e\u7b2c\u4e00\u4e2a\u6ca1\u88ab\u8986\u76d6\u7684\u4f4d\u7f6e $k$\u3002\u90a3\u4e48\u524d\u9762\u88ab\u5b8c\u5168\u8986\u76d6\u7684\u6982\u7387\u662f $P_1(l,k-1)$\u3002$k$ \u6ca1\u6709\u88ab\u8986\u76d6\u7684\u6982\u7387\u662f\u6240\u6709\u8de8\u8fc7\u5b83\u7684\u533a\u95f4\u7684\u4e0d\u51fa\u73b0\u7684\u6982\u7387\u4e58\u8d77\u6765\uff08\u8bb0\u8fd9\u4e2a\u503c\u662f $v_k$\uff09\u3002\u540e\u9762\u957f\u5565\u6837\u90fd\u6ca1\u6709\u5173\u7cfb\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u5982\u4e0b\u9012\u63a8\uff1a\n\n$$P_1(l,r)=1-\\sum_{k=l}^{r} P_1(l,k-1)v_k$$\n\n\u8fb9\u754c\u662f $P_1(l,l-1)=1$\u3002\n\n$l$ \u56fa\u5b9a\u65f6\uff0c$v$ \u7684\u53d8\u5316\u76f8\u5f53\u4e8e\u533a\u95f4\u4e58\uff0c\u53ef\u4ee5\u641e\u4e2a\u5546\u5206\u5e8f\u5217\u3002\u4f46\u662f\u6ce8\u610f\u5230\u8fd8\u4f1a\u4e58 $0$\uff0c\u6240\u4ee5\u8fd8\u8981\u518d\u641e\u4e2a\u5dee\u5206\u5e8f\u5217\u7ef4\u62a4\u88ab\u63a8\u6210 $0$ \u7684\u4f4d\u7f6e\u3002\n\n\u8fd9\u6837\u53ef\u4ee5\u5728 $l$ \u56fa\u5b9a\u65f6 $O(n^2+m)$ \u8ba1\u7b97\u6240\u6709 $r$ \u7684 $P_1(l,r)$ \u503c\u3002\n\n\u56e0\u6b64\u8ba1\u7b97 $P_1(l,r)$ \u53ef\u4ee5\u505a\u5230 $O(n^3+nm)$\u3002\n\n\u53e6\u4e00\u90e8\u5206\u662f\u4e2a\u663e\u7136\u7684\u4e8c\u7ef4\u540e\u7f00\u79ef\uff0c\u4e5f\u53ef\u4ee5\u5feb\u901f\u8ba1\u7b97\u3002\n\n\u56e0\u6b64\u73b0\u5728\u53ef\u4ee5\u5feb\u901f\u8ba1\u7b97 $P(l,r)$\u3002\n\n\u7136\u540e\u662f DP \u7684\u8f6c\u79fb\uff0c\u505a\u4e00\u4e2a\u6362\u5e8f\u6c42\u548c\uff1a\n\n$$f_{i,j}=\\sum_{x\\leq j}\\dbinom{j}{x}c_i^{j-x}\\sum_{k<i}f_{k,x}P(k+1,i)$$\n\n\u5f53 $i$ \u56fa\u5b9a\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u9884\u5148\u8ba1\u7b97\n\n$$s_x=\\sum_{k<i}f_{k,x}P(k+1,i)$$\n\n\u8fd9\u4e00\u90e8\u5206\u7684\u590d\u6742\u5ea6\u662f $O(nk)$\u3002\n\n\u7136\u540e\u4ee3\u56de\u5230\u4e0a\u9762\u7684\u5f0f\u5b50\u91cc\u9762\u5c31\u662f\n\n$$f_{i,j}=\\sum_{x\\leq j}\\dbinom{j}{x}c_i^{j-x}s_x$$\n\n\u8fd9\u6837\u8f6c\u79fb\u7684\u590d\u6742\u5ea6\u5c31\u4e0b\u964d\u5230\u4e86 $O(nk+k^2)$\u3002\n\n\u603b\u590d\u6742\u5ea6 $O(n^3+n^2k+nk^2)$\uff0c\u8db3\u4ee5\u901a\u8fc7\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1 << 21], *p1 = buf, *p2 = buf;\n\ninline int qread() {\n\tregister char c = getchar();\n\tregister int x = 0, f = 1;\n\twhile (c < '0' || c > '9') {\n\t\tif (c == '-') f = -1;\n\t\tc = getchar();\n\t}\n\twhile (c >= '0' && c <= '9') {\n\t\tx = (x << 3) + (x << 1) + c - 48;\n\t\tc = getchar();\n\t}\n\treturn x * f;\n}\n\nconst long long mod = 998244353;\npair <int, int> q[405];\nint n, m, K, l[100005], r[100005], c0[405];\nlong long p[100005], s[405][405], c[405][405], sum, f[405][405], cov[405][405], tmp[405], tmpd[405], sf[405], pwr[405][405], inv[100005];\nvector <int> adj[405];\n\ninline long long Power(long long x, long long y) {\n\tlong long ans = 1;\n\twhile (y) {\n\t\tif (y & 1) ans = ans * x % mod;\n\t\tx = x * x % mod;\n\t\ty >>= 1;\n\t}\n\treturn ans;\n}\n\ninline void Read() {\n\tn = qread(); m = qread(); K = qread();\n\tfor (int i = 1;i <= n;i++) {\n\t\tq[i].first = qread(); q[i].second = qread();\n\t\tsum = (sum + q[i].second) % mod;\n\t}\n\tq[n + 1] = make_pair(1000000001, 0);\n\tsort(q + 1, q + n + 1);\n\tfor (int i = 1;i <= m;i++) {\n\t\tl[i] = qread();\n\t\tr[i] = qread();\n\t\tp[i] = qread();\n\t\tl[i] = lower_bound(q + 1, q + n + 1, make_pair(l[i], 0)) - q;\n\t\tr[i] = lower_bound(q + 1, q + n + 1, make_pair(r[i] + 1, 0)) - q - 1;\n\t\tinv[i] = Power((mod + 1 - p[i]) % mod, mod - 2);\n\t}\n}\n\ninline void Prefix() {\n\tfor (int l = 1;l <= n + 2;l++) {\n\t\tfor (int r = 1;r <= n + 2;r++) s[l][r] = 1;\n\t}\n\tfor (int i = 1;i <= m;i++) {\n\t\tif (l[i] <= r[i]) s[l[i]][r[i]] = s[l[i]][r[i]] * (mod + 1 - p[i]) % mod;\n\t}\n\tfor (int r = n;r >= 1;r--) {\n\t\tfor (int l = 1;l <= r;l++) s[l][r] = s[l][r] * s[l][r + 1] % mod;\n\t}\n\tfor (int r = n;r >= 1;r--) {\n\t\tfor (int l = r;l >= 1;l--) s[l][r] = s[l][r] * s[l + 1][r] % mod;\n\t}\n\tc[0][0] = 1;\n\tfor (int i = 1;i <= K;i++) {\n\t\tc[i][0] = 1;\n\t\tfor (int j = 1;j <= i;j++) c[i][j] = (c[i - 1][j] + c[i - 1][j - 1]) % mod;\n\t}\n\tfor (int i = 1;i <= n;i++) {\n\t\tfor (int j = 1;j <= n;j++) adj[j].clear();\n\t\tfor (int j = 1;j <= m;j++) {\n\t\t\tif (l[j] >= i) adj[r[j]].push_back(j);\n\t\t}\n\t\tfor (int k = 0;k <= n;k++) tmp[k] = 1;\n\t\tcov[i][i - 1] = 1;\n\t\tfor (int j = i;j <= n;j++) {\n\t\t\tint siz = adj[j].size();\n\t\t\tfor (int k = 0;k <= n;k++) {\n\t\t\t\tc0[k] = 0;\n\t\t\t\ttmpd[k] = 1;\n\t\t\t}\n\t\t\tfor (int k = 0;k < siz;k++) {\n\t\t\t\tif (p[adj[j][k]] == 1) {\n\t\t\t\t\tc0[l[adj[j][k]]]++;\n\t\t\t\t\tc0[r[adj[j][k]] + 1]--;\n\t\t\t\t} else {\n\t\t\t\t\ttmpd[l[adj[j][k]]] = tmpd[l[adj[j][k]]] * (mod + 1 - p[adj[j][k]]) % mod;\n\t\t\t\t\ttmpd[r[adj[j][k]] + 1] = tmpd[r[adj[j][k]] + 1] * inv[adj[j][k]] % mod;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (int k = 1;k <= n;k++) {\n\t\t\t\tc0[k] += c0[k - 1];\n\t\t\t\ttmpd[k] = tmpd[k] * tmpd[k - 1] % mod;\n\t\t\t}\n\t\t\tfor (int k = 1;k <= n;k++) {\n\t\t\t\tif (c0[k]) tmp[k] = 0;\n\t\t\t\telse tmp[k] = tmp[k] * tmpd[k] % mod;\n\t\t\t}\n\t\t\tcov[i][j] = 1;\n\t\t\tfor (int k = i - 1;k < j;k++) cov[i][j] = (cov[i][j] - cov[i][k] * tmp[k + 1] % mod + mod) % mod;\n\t\t}\n\t}\n\tcov[n + 1][n] = 1;\n\tfor (int i = 1;i <= n + 1;i++) {\n\t\tpwr[i][0] = 1;\n\t\tfor (int j = 1;j <= K;j++) pwr[i][j] = pwr[i][j - 1] * q[i].second % mod;\n\t}\n}\n\ninline void Solve() {\n\tf[0][0] = 1;\n\tfor (int i = 1;i <= n + 1;i++) {\n\t\tfor (int k = 0;k <= K;k++) {\n\t\t\tsf[k] = 0;\n\t\t\tfor (int ii = 0;ii < i;ii++) sf[k] = (sf[k] + f[ii][k] * s[ii + 1][i] % mod * cov[ii + 1][i - 1]) % mod;\n\t\t}\n\t\tfor (int j = 0;j <= K;j++) {\n\t\t\tfor (int k = 0;k <= j;k++) {\n\t\t\t\tf[i][j] = (f[i][j] + pwr[i][j - k] % mod * c[j][k] % mod * sf[k]) % mod;\n\t\t\t}\n\t\t}\n\t}\n\tlong long ans = 0;\n\tfor (int j = 0;j <= K;j++) {\n\t\tans = (ans + Power(sum, K - j) * c[K][j] % mod * Power(mod - 1, j) % mod * f[n + 1][j]) % mod;\n\t}\n\tcout << ans << endl;\n}\n\nint main() {\n\tRead();\n\tPrefix();\n\tSolve();\n\treturn 0;\n}\n```\n\n\n\n\n\n\n",
        "postTime": 1645107217,
        "uid": 61088,
        "name": "Solystic",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P7483 \u301050\u5e74\u540e\u7684\u6211\u4eec\u3011"
    }
]