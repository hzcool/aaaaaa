[
    {
        "content": "\u5148\u8bf4\u51e0\u53e5:\n\n\u5982\u679c\u8fd9\u9053\u9898\u6709\u54ea\u4e2a\u795e\u4ed9\u7528\u5355\u6b21 $O(n\\log n)$ \u7684\u590d\u6742\u5ea6\u8fc7\u4e86~~\u6211\u8bf7\u60a8\u62bd\u70df~~\u3002\n\n\u6b22\u8fce\u5927\u4f6c\u540a\u6253\u5783\u573e\u6807\u7b97\u3002\n\n\u672c\u7247\u9898\u89e3\u4e2d\u6709\u90e8\u5206\u5730\u65b9\u7531\u4e8e\u4eba\u61d2\u6240\u4ee5\u590d\u5236\u7c98\u8d34\u7684\u65f6\u5019 $td$ \u6ca1\u6709\u6362\u6210 $T$, \u8bf7\u5404\u4f4d\u5927\u4f6c\u81ea\u884c\u66ff\u6362\u4e00\u4e0b\u5427\uff08\u6709\u65f6\u95f4\u518d\u8865\u9505\uff09\u3002\n\n----\n\n\u9996\u5148\u5bf9\u4e8e $10$ \u5206\u7684\u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u6c42\u3002\n\n\u7136\u540e\u5982\u679c\u6253\u51fa\u4e00\u5f20 $\\gcd$ \u7684\u8868\uff0c\u7136\u540e $n^3$ \u6a21\u62df\u9884\u5904\u7406\u5c31\u53ef\u4ee5\u83b7\u5f97 $30$ \u5206\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u6ce8\u610f\u5230\u539f\u5f0f\u53ef\u4ee5\u5316\u4e3a\u4e0b\u9762\u8fd9\u6837\uff1a\n\n$$ \\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} \\left(\\frac{{\\rm lcm}(i,j)}{\\gcd(i,k)}\\right)^{f(type)}$$\n\n$$ \\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} \\left(\\frac{i\\times j}{\\gcd(i,j)\\times \\gcd(i,k)}\\right)^{f(type)}$$\n\n\u7136\u540e\uff0c\u663e\u7136\u53ef\u4ee5\u5206\u4e3a\u4e24\u4e2a\u5b50\u95ee\u9898\uff1a\n\n$$ \\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i^{f(type)}$$\n\n$$ \\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} gcd(i,j)^{f(type)}$$\n\n\u7136\u540e\u6211\u4eec\u5c31\u6839\u636e `type` \u5206\u522b\u63a8\u4e00\u63a8\u5f0f\u5b50\u5427\u3002\n\n## ${\\rm type=0}$\n\n\u6211\u4eec\u5148\u6765\u770b\u770b\u7b2c\u4e00\u4e2a\u5f0f\u5b50\u5427\uff1a\n\n$$ \\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i$$\n\n$$ \\prod_{i=1}^{A}\\prod_{j=1}^{B} i^{C}$$\n\n$$ \\left(\\prod_{i=1}^{A}i\\right)^{B \\times C}$$\n\n\u9884\u5904\u7406\u4e00\u4e2a\u9636\u4e58\uff0c\u5199\u4e2a\u5feb\u901f\u5e42\u5c31\u5b8c\u4e8b\u4e86\u3002\n\n\u7136\u540e\u5c31\u662f\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\u4e86\u3002\n\n$$ \\left(\\prod_{i=1}^{A}\\prod_{j=1}^{B} gcd(i,j)\\right)^{C}$$\n\n\u7136\u540e\u8fd9\u5c31\u53ef\u4ee5\u8fc7$10^3$\u4e86\u3002\u7136\u540e\u5c31\u53ef\u4ee5\u5f97\u523012\u5206\u4e86\u3002\n\n\u7136\u540e\u5c31\u53ef\u4ee5\u53cd\u6f14\u4e86\u3002\n\n\u5982\u679c\u4e0d\u4f1a\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\uff0c\u90a3\u4e48\u5c31\u8bf7\u5148\u79d1\u666e\u5b8c\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u5e76\u4e14\u63a8\u4e86\u51e0\u9053\u9898\u540e\u518d\u6765\u770b\u8fd9\u7bc7\u9898\u89e3\u3002\n\n\u7136\u540e\u7ee7\u7eed\u5427\u3002\n\n$$ \\left(\\prod_{i=1}^{A}\\prod_{j=1}^{B} \\gcd(i,j)\\right)^{C}$$\n\n$$ \\left(\\prod_{d=1}d^{\\sum_{i=1}^{A/d}\\sum_{j=1}^{B/d} [\\gcd(i,j)=1]}\\right)^{C}$$\n\n$$ \\left(\\prod_{d=1}d^{\\sum_{t=1}\\mu(t)\\left\\lfloor\\frac{A}{td}\\right\\rfloor\\left\\lfloor\\frac{B}{td}\\right\\rfloor}\\right)^{C}$$\n\n$$ \\left(\\prod_{T=1}\\left(\\prod_{d|T}d^{\\mu(\\frac{T}{d})}\\right)^{\\left\\lfloor\\frac{A}{td}\\right\\rfloor\\left\\lfloor\\frac{B}{td}\\right\\rfloor}\\right)^{C}$$\n\n\u663e\u7136\u4e2d\u95f4\u7684\u5f0f\u5b50\u53ef\u4ee5\u50cf\u72c4\u5229\u514b\u96f7\u5377\u79ef\u4e00\u6837 $O(n\\log n)$ \u9884\u5904\u7406\u51fa\u6765\uff0c\u7136\u540e\u6574\u9664\u5206\u5757\u53ef\u4ee5 $O(\\sqrt{n}\\log n)$ \u505a\u6389\u3002\n\n\u8fd9\u4e24\u4e2a\u5f0f\u5b50\u7ed3\u5408\u4e00\u4e0b\u5c31\u6709 $20$ \u5206\u4e86\u3002\n\n## ${\\rm type=1}$\n\n\u4e00\u6837,\u6211\u4eec\u5148\u6765\u8003\u8651\u7b2c\u4e00\u4e2a\u5f0f\u5b50\u3002\n\n$$ \\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i^{i \\times j \\times k}$$\n\n$$ \\prod_{i=1}^{A}\\prod_{j=1}^{B} i^{i \\times j \\times \\sum_{k=1}^{C}k}$$\n\n$$ \\prod_{i=1}^{A} i^{i \\times (\\sum_{j=1}^{B}j) \\times (\\sum_{k=1}^{C}k)}$$\n\n$$ \\left(\\prod_{i=1}^{A} i^i\\right)^{F(B) \\times F(C)}$$\n\n\u5176\u4e2d: $F(x)=\\frac{x \\times (x + 1)}{2}$\u3002\n\n\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5 $O(n\\log n)$ \u9884\u5904\u7406\u4e00\u4e0b, \u518d\u52a0\u4e0a\u5feb\u901f\u5e42\u5c31\u884c\u4e86\u3002\n\n\u8bb0\u5f97\u6307\u6570\u4e0a\u8981\u5bf9 $mod-1$ \u53d6\u6a21\u3002\n\n\u7136\u540e\u8003\u8651\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\u3002\n\n$$ \\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} gcd(i,j)^{i \\times j \\times k}$$\n\n$$ \\left(\\prod_{i=1}^{A}\\prod_{j=1}^{B} gcd(i,j)^{i \\times j}\\right)^{F(C)}$$\n\n\u8fd9\u91cc\u5c31\u80fd\u505a $n \\leq 10^3$ \u7684\u6570\u636e\u4e86\u3002\n\n\u5927\u6982\u7528 $O(n^2\\log n)$ \u7684\u65f6\u95f4\u6253\u4e00\u4e2a $n^2$ \u7684\u8868\uff0c\u7136\u540e\u9884\u5904\u7406\u77e9\u9635\u7684\u524d\u7f00\u79ef\uff0c\u8be2\u95ee\u76f4\u63a5 $O(1)$ \u67e5\u8868\u540e\u52a0\u4e0a\u4e00\u4e2a $F(C)$ \u7684\u5feb\u901f\u5e42\u5c31\u884c\u4e86\u3002\n\n\u7136\u540e\u7ee7\u7eed\u63a8:\n\n$$ \\left(\\prod_{d=1}d^{d^2\\sum_{i=1}^{A/d}\\sum_{j=1}^{B/d} i \\times j \\times [gcd(i, j)=1]}\\right)^{F(C)}$$\n\n$$ \\left(\\prod_{d=1}d^{\\sum_{t=1}d^2\\mu(t)t^2F(\\left\\lfloor\\frac{A}{td}\\right\\rfloor)F(\\left\\lfloor\\frac{B}{td}\\right\\rfloor)}\\right)^{F(C)}$$\n\n$$ \\left(\\prod_{T=1}\\left( \\left(\\prod_{d|T} d^{\\mu(\\frac{T}{d})}\\right)^{T^2} \\right)^{F(\\left\\lfloor\\frac{A}{td}\\right\\rfloor)F(\\left\\lfloor\\frac{B}{td}\\right\\rfloor)}\\right)^{F(C)}$$\n\n\u867d\u7136\u5f0f\u5b50\u770b\u4e0a\u53bb\u9ebb\u70e6\u4e86\u4e00\u70b9\uff0c\u4f46\u662f\u8fd8\u662f\u80fd\u9884\u5904\u7406\u7684\u3002\n\n\u4e2d\u95f4\u90a3\u4e00\u5768 $\\left(\\prod_{d|T} d^{\\mu(\\frac{T}{d})}\\right)^{T^2}$ \u53ef\u4ee5\u7528\u7c7b\u4f3c\u72c4\u5229\u514b\u96f7\u5377\u79ef\u7684\u529e\u6cd5\u9884\u5904\u7406\uff0c\u590d\u6742\u5ea6\u8fd8\u662f $O(n \\log n)$\u3002\n\n\u7136\u540e\u9884\u5904\u7406\u4e00\u4e2a\u524d\u7f00\u79ef\u4ee5\u53ca\u9006\u5143\u5565\u7684\u5c31\u80fd\u5355\u6b21\u8be2\u95ee $O(\\sqrt{n} \\log n)$ \u4e86\u3002\n\n\u7ed3\u5408\u4ee5\u4e0a\u7684\u6240\u6709\u7b97\u6cd5\uff0c\u53ef\u4ee5\u5f97\u5230 $60$ \u5206\u3002\n\n## ${\\rm type=2}$\n\n\u8fd8\u662f\u5148\u5eb7\u5eb7\u7b2c\u4e00\u4e2a\u5f0f\u5b50:\n\n$$ \\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i^{\\gcd(i,j,k)}$$\n\n\u8003\u8651\u53cd\u6f14:\n\n$$ \\prod_{d=1}\\prod_{i=1}^{A/d}(id)^{d\\sum_{j=1}^{B/d}\\sum_{k=1}^{C/d}[\\gcd(i,j,k)=1]}$$\n\n$$ \\prod_{d=1}\\prod_{t=1}\\prod_{i=1}^{A/td}(itd)^{\\mu(t)d \\left\\lfloor\\frac{B}{td}\\right\\rfloor\\left\\lfloor\\frac{C}{td}\\right\\rfloor}$$\n\n$$ \\prod_{T=1}\\left(\\prod_{d|T}\\left(fac\\left(\\left\\lfloor\\frac{A}{T}\\right\\rfloor\\right) \\times T^{\\left\\lfloor\\frac{A}{T}\\right\\rfloor}\\right)^{\\mu(\\frac{T}{d})d }\\right)^{\\left\\lfloor\\frac{B}{T}\\right\\rfloor\\left\\lfloor\\frac{C}{T}\\right\\rfloor}$$\n\n$$ \\prod_{T=1}\\left(\\left(fac\\left(\\left\\lfloor\\frac{A}{T}\\right\\rfloor\\right) \\times T^{\\left\\lfloor\\frac{A}{T}\\right\\rfloor}\\right)^{\\sum_{d|T}\\mu(\\frac{T}{d})d }\\right)^{\\left\\lfloor\\frac{B}{T}\\right\\rfloor\\left\\lfloor\\frac{C}{T}\\right\\rfloor}$$\n\n$$ \\prod_{T=1}\\left(\\left(fac\\left(\\left\\lfloor\\frac{A}{T}\\right\\rfloor\\right) \\times T^{\\left\\lfloor\\frac{A}{T}\\right\\rfloor}\\right)^{\\varphi(T)}\\right)^{\\left\\lfloor\\frac{B}{T}\\right\\rfloor\\left\\lfloor\\frac{C}{T}\\right\\rfloor}$$\n\n\u7136\u540e\u5bf9\u4e8e $T^{\\varphi(T)}$ \u505a\u4e2a\u524d\u7f00\u79ef\u4ee5\u53ca\u9006\u5143\u7684\u9884\u5904\u7406\u5c31\u884c\u4e86...\u518d\u9884\u5904\u7406\u4e00\u4e2a\u6a21$mod-1$ \u610f\u4e49\u4e0b\u7684 $\\varphi(T)$ \u7684\u524d\u7f00\u548c, \u505a\u6574\u9664\u5206\u5757\u7684\u65f6\u5019 $\\frac{A}{T}$ \u7684\u6307\u6570.\n\n\u7136\u540e\u8003\u8651\u7b2c\u4e8c\u4e2a\u5f0f\u5b50.\n\n\u6211\u4eec\u8003\u8651\u679a\u4e3e $\\gcd(i,j)$\n\n$$ \\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} \\gcd(i,j)^{\\gcd(i,j,k)}$$\n\n$$ \\prod_{d=1}d^{\\sum_{i=1}^{A/d}\\sum_{j=1}^{B/d}[gcd(i,j)=1] \\times \\sum_{k=1}^{C} \\gcd(d,k)}$$\n\n$$ \\prod_{d=1}d^{\\left(\\sum_{t=1}\\mu(t)\\left\\lfloor\\frac{A}{td}\\right\\rfloor\\left\\lfloor\\frac{B}{td}\\right\\rfloor\\right) \\times \\left(\\sum_{k=1}^{C} \\gcd(d,k)\\right)}$$\n\n$$ \\prod_{T=1}\\left(\\prod_{d|T}d^{\\mu(\\frac{T}{d}) \\times \\left(\\sum_{k=1}^{C} \\gcd(d,k)\\right)}\\right)^{\\left\\lfloor\\frac{A}{T}\\right\\rfloor\\left\\lfloor\\frac{B}{T}\\right\\rfloor}$$\n\n\u628a\u91cc\u9762\u90a3\u4e2a $\\gcd$ \u7684\u5f0f\u5b50\u62ff\u51fa\u6765:\n\n$$\\sum_{k=1}^{C} gcd(d,k)$$\n\n$$\\sum_{d'|d}d'\\sum_{k=1}^{C/d'} [gcd(\\frac{d}{d'},k) = 1]$$\n\n$$\\sum_{d'|d}d'\\sum_{t'|\\frac{d}{d'}}\\mu(t')\\left\\lfloor\\frac{C}{t'd'}\\right\\rfloor$$\n\n$$\\sum_{T'\n|d}\\left\\lfloor\\frac{C}{T'}\\right\\rfloor\\varphi(T')$$\n\n\u7136\u540e\u5957\u56de\u53bb\u3002\n\n\u8fd9\u6837\u5927\u6982\u80fd\u62ff\u4e2a$n \\leq 1000$\u7684\u5206\u6570\u3002\n\n\u5176\u5b9e..\u6211\u4eec\u5982\u679c\u628a\u5b83\u5957\u56de\u5230\u524d\u4e00\u4e2a\u5f0f\u5b50\u91cc\u5934:\n\n$$ \\prod_{d=1}d^{\\left(\\sum_{t=1}\\mu(t)\\left\\lfloor\\frac{A}{td}\\right\\rfloor\\left\\lfloor\\frac{B}{td}\\right\\rfloor\\right) \\times \\left(\\sum_{T'|d}\\left\\lfloor\\frac{C}{T'}\\right\\rfloor\\varphi(T')\\right)}$$\n\n\u4f60\u4f1a\u53d1\u73b0,\u5b83\u53ef\u4ee5\u7528 $O(n \\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5b8c\u6210\u3002\n\n~~\u5982\u679c\u4f60\u5e38\u6570\u4f18\u5316\u5f88\u725b\u903c\uff0c\u8fc7\u4e86\u6211\u8bf7\u4f60\u62bd\u70df~~\n\n\u5f53\u7136\u8fd8\u6709\u53e6\u5916\u4e00\u79cd\u505a\u6cd5: \u679a\u4e3e $\\gcd(i,j,k)$\u3002\n\n$$ \\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} \\gcd(i,j)^{\\gcd(i,j,k)}$$\n\n$$ \\prod_{d=1}\\prod_{i=1}^{A/d}\\prod_{j=1}^{B/d} (d \\times \\gcd(i,j))^{d\\sum_{k=1}^{C/d}[\\gcd(i,j,k)=1]}$$\n\n$$ \\prod_{d=1}\\prod_{t=1}\\prod_{i=1}^{A/td}\\prod_{j=1}^{B/td} (td \\times \\gcd(i,j))^{\\mu(t)d\\left\\lfloor\\frac{C}{td}\\right\\rfloor}$$\n\n\u7136\u540e\u6211\u4eec\u628a\u5e95\u6570\u7684td\u5206\u79bb\u51fa\u6765:\n\n$$ \\left(\\prod_{d=1}\\prod_{t=1}(td)^{\\mu(t)d\\left\\lfloor\\frac{A}{td}\\right\\rfloor\\left\\lfloor\\frac{B}{td}\\right\\rfloor\\left\\lfloor\\frac{C}{td}\\right\\rfloor}\\right)  \\times  \\left(\\prod_{d=1}\\prod_{t=1}\\prod_{i=1}^{A/td}\\prod_{j=1}^{B/td} \\gcd(i,j)^{\\mu(t)d\\left\\lfloor\\frac{C}{td}\\right\\rfloor}\\right)$$\n\n\u7136\u540e\u628a\u524d\u9762\u4e00\u5768\u5f0f\u5b50\u62ff\u51fa\u6765:\n\n$$ \\prod_{d=1}\\prod_{t=1}(td)^{\\mu(t)d\\left\\lfloor\\frac{A}{td}\\right\\rfloor\\left\\lfloor\\frac{B}{td}\\right\\rfloor\\left\\lfloor\\frac{C}{td}\\right\\rfloor}$$\n\n$$ \\prod_{T=1}T^{\\left\\lfloor\\frac{A}{td}\\right\\rfloor\\left\\lfloor\\frac{B}{td}\\right\\rfloor\\left\\lfloor\\frac{C}{td}\\right\\rfloor\\sum_{d|T}\\mu(\\frac{T}{d})d}$$\n\n$$ \\prod_{T=1}(T^{\\varphi(T)})^{\\left\\lfloor\\frac{A}{td}\\right\\rfloor\\left\\lfloor\\frac{B}{td}\\right\\rfloor\\left\\lfloor\\frac{C}{td}\\right\\rfloor}$$\n\n\u7136\u540e\u6211\u4eec\u62ff\u51fa\u524d\u9762 $i^{gcd(i,j,k)}$ \u7684\u90e8\u5206:\n\n$$ \\prod_{T=1}\\left(\\left(fac\\left(\\left\\lfloor\\frac{A}{T}\\right\\rfloor\\right) \\times T^{\\left\\lfloor\\frac{A}{T}\\right\\rfloor}\\right)^{\\varphi(T)}\\right)^{\\left\\lfloor\\frac{B}{T}\\right\\rfloor\\left\\lfloor\\frac{C}{T}\\right\\rfloor}$$\n\n\u4e5f\u628a\u5e95\u6570\u62ff\u51fa\u6765:\n\n$$ \\left(\\prod_{T=1}\\left(fac\\left(\\left\\lfloor\\frac{A}{T}\\right\\rfloor\\right)\\right)^{\\varphi(T)\\left\\lfloor\\frac{B}{T}\\right\\rfloor\\left\\lfloor\\frac{C}{T}\\right\\rfloor}\\right) \\times \\left(\\prod_{T=1}\\left(T^{\\varphi(T)}\\right)^{\\left\\lfloor\\frac{A}{T}\\right\\rfloor\\left\\lfloor\\frac{B}{T}\\right\\rfloor\\left\\lfloor\\frac{C}{T}\\right\\rfloor}\\right)$$\n\n\u7136\u540e\u53d1\u73b0\u540e\u9762\u4e00\u5768\u4e1c\u897f\u662f\u53ef\u4ee5\u7ea6\u6389\u7684\u3002\u7136\u540e\u6211\u4eec\u5c31\u53d8\u6210\u4e86\u5206\u522b\u8ba1\u7b97\u4e0b\u9762\u4e24\u4e2a\u90e8\u5206:\n\n$$ \\prod_{T=1}\\left(fac\\left(\\left\\lfloor\\frac{A}{T}\\right\\rfloor\\right)\\right)^{\\varphi(T)\\left\\lfloor\\frac{B}{T}\\right\\rfloor\\left\\lfloor\\frac{C}{T}\\right\\rfloor} $$\n\n$$ \\prod_{d=1}\\prod_{t=1}\\prod_{i=1}^{A/td}\\prod_{j=1}^{B/td} \\gcd(i,j)^{\\mu(t)d\\left\\lfloor\\frac{C}{td}\\right\\rfloor}$$\n\n\u663e\u7136\u7b2c\u4e00\u4e2a\u5f0f\u5b50\u5df2\u7ecf\u53ef\u4ee5\u6574\u9664\u5206\u5757\u505a\u4e86\u3002\n\n\u4f46\u662f\u7b2c\u4e8c\u4e2a\u8fd8\u9700\u8981\u518d\u641e\u641e\u3002\n\n$$ \\prod_{d=1}\\prod_{t=1}\\prod_{d'=1}\\prod_{t'=1} d'^{\\mu(t')\\mu(t)d\\left\\lfloor\\frac{C}{td}\\right\\rfloor\\left\\lfloor\\frac{A}{tt'dd'}\\right\\rfloor\\left\\lfloor\\frac{B}{tt'dd'}\\right\\rfloor}$$\n\n$$ \\prod_{T=1}\\left(\\prod_{T'=1} \\left(\\prod_{d|T'}d^{\\mu(\\frac{T'}{d})}\\right)^{\\left\\lfloor\\frac{A}{TT'}\\right\\rfloor\\left\\lfloor\\frac{B}{TT'}\\right\\rfloor}\\right)^{\\varphi(T)\\left\\lfloor\\frac{C}{T}\\right\\rfloor}$$\n\n\u9884\u5904\u7406\u51fa\u4e2d\u95f4\u90a3\u4e00\u5768 $\\prod_{d|T'}d^{\\mu(\\frac{T'}{d})}$ \u4e4b\u540e, \u53ef\u4ee5\u4e24\u6b21\u6574\u9664\u5206\u5757 $O(n^{0.75} \\log n)$ \u505a\u6389\u4e86.",
        "postTime": 1565876469,
        "uid": 20782,
        "name": "CYJian",
        "ccfLevel": 10,
        "title": "\u5e7d\u7075\u4e50\u56e2 Sol"
    },
    {
        "content": "\u5e94\u540c\u5b66\u9080\uff0c\u5199\u4e00\u4e0b\u8fd9\u9053\u9898 $\\text{type=2}$ \u7684\u795e\u79d8\u8fc7\u7a0b\u3002\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C(\\frac{\\text{lcm}(i,j)}{\\gcd(j,k)})^{\\gcd(i,j,k)}$$\n\n\u53d1\u626c\u4eba\u7c7b\u667a\u6167\uff0c\u53d1\u73b0\u4e58\u6cd5\u5341\u5206\u590d\u6742\uff0c\u4e8e\u662f\u4f60\u81ea\u7136\u800c\u7136\u5730\u60f3\u5230\u4e86 $\\exp\\&\\ln$ \u3002\n\n\u5bf9\u5b83\u6c42 $\\ln$ \uff1a\n\n$$\\sum_{i=1}^A\\sum_{j=1}^B\\sum_{k=1}^C\\gcd(i,j,k)\\ln(\\frac{\\text{lcm}(i,j)}{\\gcd(j,k)})$$\n\n$$\\sum_{d=1}^{\\min(A,B,C)}\\varphi(d)\\sum_{i=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{B}{d}\\rfloor}\\sum_{k=1}^{\\lfloor\\frac{C}{d}\\rfloor}\\ln(\\frac{\\text{lcm}(id,jd)}{\\gcd(jd,kd)})$$\n\n\u7ea6\u53bb $d$ \uff1a\n\n$$\\sum_{d=1}^{\\min(A,B,C)}\\varphi(d)\\sum_{i=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{B}{d}\\rfloor}\\sum_{k=1}^{\\lfloor\\frac{C}{d}\\rfloor}\\ln(\\frac{\\text{lcm}(i,j)}{\\gcd(j,k)})$$\n\n$\\exp$ \u4e00\u4e0b\u5c31\u662f\uff01\n\n$$\\prod_{d=1}^{\\min(A,B,C)}F_{type=0}(\\lfloor\\frac{A}{d}\\rfloor,\\lfloor\\frac{B}{d}\\rfloor,\\lfloor\\frac{C}{d}\\rfloor)^{\\varphi(d)}$$\n\n\u9644\u4e0a $type=0,1$ \u7684\u4e66\u9762\u9898\u89e3\uff0c\u624b\u52a8 $\\text{latex}$ \u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/gsc12yqb.png)\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/foexad2s.png)\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#define int __int128\n#define maxn 100010\nint T;\nint _(){\n\tint p;\n\trd(T),rd(p);\n\treturn p;\n}\nconst int p=_();\nint q[70][3],mx,MX;\nint min(int a,int b,int c){\n\treturn min(a,min(b,c));\n}\nint max(int a,int b,int c){\n\treturn max(max(a,b),c);\n}\nint ksm(int a,int b){\n\tint ans=1;\n\tfor(;b;b>>=1,a=a*a%p)\n\tif(b&1)ans=ans*a%p;\n\treturn ans;\n}\nint pri[maxn],tot,mu[maxn],phi[maxn];\nbool v[maxn];\nint f1[maxn],f2[maxn];\nint invf1[maxn],invf2[maxn];\nvoid shai(int n){\n\tmu[1]=phi[1]=1;\n\tfor(int i=2;i<=n;i++){\n\t\tif(v[i]==0)pri[++tot]=i,mu[i]=-1,phi[i]=i-1;\n\t\tfor(int j=1;j<=tot&&i*pri[j]<=n;j++){\n\t\t\tv[i*pri[j]]=1;\n\t\t\tif(i%pri[j]==0){\n\t\t\t\tmu[i*pri[j]]=0;\n\t\t\t\tphi[i*pri[j]]=phi[i]*pri[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmu[i*pri[j]]=-mu[i];\n\t\t\tphi[i*pri[j]]=phi[i]*phi[pri[j]];\n\t\t}\n\t}\n\tfor(int i=0;i<=n;i++)f1[i]=1;\n\tfor(int i=1;i<=n;i++)phi[i]+=phi[i-1];\n\tfor(int i=1;i<=n;i++)\n\tfor(int j=i;j<=n;j+=i)\n\tf1[j]=f1[j]*ksm(i,(p-1+mu[j/i])%(p-1))%p;\n\tfor(int i=0;i<=n;i++)f2[i]=ksm(f1[i],i*i%(p-1));\n\tinvf1[0]=invf2[0]=1;\n\tfor(int i=1;i<=n;i++){\n\t\tf1[i]=f1[i]*f1[i-1]%p;\n\t\tinvf1[i]=ksm(f1[i],p-2);\n\t\tf2[i]=f2[i]*f2[i-1]%p;\n\t\tinvf2[i]=ksm(f2[i],p-2);\n\t}\n}\nint fac[maxn];\nint ii[maxn];\nvoid SHAI(int n){\n\tfac[0]=ii[0]=1;\n\tfor(int i=1;i<=n;i++)fac[i]=fac[i-1]*i%p;\n\tfor(int i=1;i<=n;i++)ii[i]=ii[i-1]*ksm(i,i)%p;\n}\nint F(int A,int B){\n\tint ans=1;\n\tint fuck=min(A,B);\n\tfor(int L=1,R;L<=fuck;L=R+1){\n\t\tint Aa=A/L,Bb=B/L;\n\t\tR=min(A/Aa,B/Bb);\n\t\tans=ans*ksm(f1[R]*invf1[L-1]%p,Aa*Bb%(p-1))%p;\n\t}\n\treturn ans;\n}\nint S(int x){\n\treturn x*(x+1)/2%(p-1);\n}\nint G(int A,int B){\n\tint ans=1;\n\tint fuck=min(A,B);\n\tfor(int L=1,R;L<=fuck;L=R+1){\n\t\tR=min(A/(A/L),B/(B/L));\n\t\tans=ans*ksm(f2[R]*invf2[L-1]%p,S(A/L)*S(B/L)%(p-1))%p;\n\t}\n\treturn ans;\n}\nint s1(int A,int B,int C){\n\tint tmp;\n\tint ans1=ksm(fac[A],B*C%(p-1))*ksm(fac[B],A*C%(p-1))%p;\n\ttmp=ksm(F(A,B),C)*ksm(F(A,C),B)%p;\n\tans1=ans1*ksm(tmp,p-2)%p;\n\treturn ans1;\n}\nint s2(int A,int B,int C){\n\tint tmp;\n\tint ans2=ksm(ksm(ii[A],S(B))*ksm(ii[B],S(A))%p,S(C));\n\ttmp=ksm(G(A,B),S(C))*ksm(G(A,C),S(B))%p;\n\tans2=ans2*ksm(tmp,p-2)%p;\n\treturn ans2;\n}\nint s3(int A,int B,int C){\n\tint ans3=1;\n\tint fuck=min(A,B,C);\n\tfor(int L=1,R;L<=fuck;L=R+1){\n\t\tR=min(A/(A/L),B/(B/L),C/(C/L));\n\t\tans3=ans3*ksm(s1(A/L,B/L,C/L),(phi[R]-phi[L-1])%(p-1))%p;\n\t}\n\treturn ans3;\n}\nint A,B,C;\nsigned main(){\n\tfor(int i=0;i<T;i++){\n\t\trd(q[i][0]),rd(q[i][1]),rd(q[i][2]);\n\t\tmx=max(mx,min(q[i][0],q[i][1],q[i][2]));\n\t\tMX=max(MX,max(q[i][0],q[i][1],q[i][2]));\n\t}\n\tshai(MX),SHAI(MX);\n//\tcout<<F(39,124)<<endl;return 0;\n\tfor(int i=0;i<T;i++){\n\t\tA=q[i][0],B=q[i][1],C=q[i][2];\n\t\twr(s1(A,B,C)),putchar(' ');\n\t\twr(s2(A,B,C)),putchar(' ');\n\t\twr(s3(A,B,C)),putchar('\\n');\n\t}\n}\n\n```",
        "postTime": 1630484187,
        "uid": 100325,
        "name": "peterwuyihong",
        "ccfLevel": 7,
        "title": "P5518 [MtOI2019]\u5e7d\u7075\u4e50\u56e2 \u3010\u9898\u89e3\u3011"
    },
    {
        "content": "[\u9898\u76ee](https://www.luogu.org/problem/P5518)\n\n\u4e00\u4e2a\u5f88\u66b4\u529b\u7684\u8fa3\u9e21\u505a\u6cd5\n\n\u8003\u8651\u5230\u4e24\u4e2a\u6570\u7684$\\gcd$\u662f\u6240\u6709\u8d28\u6570\u6b21\u5e42\u53d6$\\min$\uff0c\u4e24\u4e2a\u6570\u7684$\\rm lcm$\u662f\u6240\u6709\u8d28\u6570\u6b21\u5e42\u53d6$\\max$\uff0c\u4e8e\u662f\u6700\u540e\u7684\u7b54\u6848\u4e00\u5b9a\u662f$\\prod p_i^{c_i}$\uff0c\u800c\u4e14\u8fd9\u91cc\u6700\u5927\u7684\u8d28\u6570\u4e0d\u4f1a\u8d85\u8fc7$n$\uff0c\u4e8e\u662f\u6211\u4eec\u8003\u8651\u7b97\u51fa\u6bcf\u4e00\u4e2a\u8d28\u6570\u7684\u6b21\u5e42\u662f\u591a\u5c11\n\n\u4e8e\u662f\u6211\u4eec\u6210\u529f\u7684\u5c06$\\prod$\u8f6c\u6362\u6210\u4e86$\\sum$\uff0c\u6307\u6570\u4e0a\u5f97\u5bf9$\\rm mod-1$\u53d6\u6a21\n\n\u5bf9\u4e8e$\\rm type=0$\uff0c\u6211\u4eec\u679a\u4e3e\u4e00\u4e2a\u8d28\u6570$p$\uff0c\u8ba1\u7b97\u5b83\u7684\u6b21\u5e42\n\n\u5373\u4e3a\n\n$$\\sum_{i=0}\\sum_{j=0}\\sum_{k=0}\\sum_{t_1=1}^{\\left \\lfloor \\frac{A}{p^i} \\right \\rfloor}\\sum_{t_2=1}^{\\left \\lfloor \\frac{B}{p^j} \\right \\rfloor}\\sum_{t_3=1}^{\\left \\lfloor \\frac{C}{p^k} \\right \\rfloor}\\max(i,j)-\\min(i,k)[t_1\\perp p][t_2\\perp p][t_3\\perp p]$$\n\n\u8fd9\u4e2a\u5f88\u663e\u7136\u554a\uff0c\u5c31\u662f\u6211\u4eec\u679a\u4e3e\u5f53\u524d\u8fd9\u4e2a\u8d28\u6570\u7684\u6700\u5927\u6b21\u5e42\uff0c\u4e4b\u540e\u679a\u4e3e\u8fd9\u4e2a\u62e5\u6709\u8fd9\u4e2a\u6700\u5927\u6b21\u5e42\u7684\u6570\uff0c\u5373\u4e3a$p^i\\times t_1$\uff0c\u4f46\u662f\u5982\u679c$t_1$\u548c$p$\u4e0d\u4e92\u8d28\uff0c\u90a3\u4e48$i$\u5c31\u4e0d\u662f$p^i\\times t$\u7684\u6700\u5927\u6b21\u5e42\uff0c\u4e8e\u662f\u8fd8\u5fc5\u987b\u5f97\u4fdd\u8bc1$t_1\\perp p$\n\n\u6211\u4eec\u6539\u53d8\u4e00\u4e0b\u6c42\u548c\u987a\u5e8f\u5373\u4e3a\n\n$$\\sum_{i=0}\\sum_{j=0}\\sum_{k=0}\\max(i,j)-\\min(i,k)\\sum_{t_1=1}^{\\left \\lfloor \\frac{A}{p^i} \\right \\rfloor}[t_1\\perp p]\\sum_{t_2=1}^{\\left \\lfloor \\frac{B}{p^j} \\right \\rfloor}[t_2\\perp p]\\sum_{t_3=1}^{\\left \\lfloor \\frac{C}{p^k} \\right \\rfloor}[t_3\\perp p]$$\n\n\u53c8\u53d1\u73b0\u6c42$\\max(i,j)$\u548c$\\min(i,k)$\u662f\u76f8\u5f53\u72ec\u7acb\u7684\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5f3a\u884c\u62c6\u6210\n\n$$C\\times \\sum_{i=0}\\sum_{j=0}\\max(i,j)\\sum_{t_1=1}^{\\left \\lfloor \\frac{A}{p^i} \\right \\rfloor}[t_1\\perp p]\\sum_{t_2=1}^{\\left \\lfloor \\frac{B}{p^j} \\right \\rfloor}[t_2\\perp p]$$\n\n\u51cf\u53bb\n\n$$B\\times \\sum_{i=0}\\sum_{k=0}\\min(i,k)\\sum_{t_1=1}^{\\left \\lfloor \\frac{A}{p^i} \\right \\rfloor}[t_1\\perp p]\\sum_{t_3=1}^{\\left \\lfloor \\frac{C}{p^k} \\right \\rfloor}[t_3\\perp p]$$\n\n\u73b0\u5728\u601d\u8003\u4e00\u4e0b\u8fd9\u4e2a$\\sum_{t_1=1}^{\\left \\lfloor \\frac{A}{p^i} \\right \\rfloor}[t_1\\perp p]$\u5230\u5e95\u600e\u4e48\u6c42\uff0c\u548c\u4e00\u4e2a\u8d28\u6570\u4e92\u8d28\u53ea\u8981\u4e0d\u662f\u8fd9\u4e2a\u8d28\u6570\u7684\u500d\u6570\u5c31\u884c\u4e86\uff0c\u4e8e\u662f\u6211\u4eec\u7b80\u5355\u7684\u51cf\u53bb$1$\u5230$\\left \\lfloor \\frac{A}{p^i} \\right \\rfloor$\u91cc$p$\u7684\u500d\u6570\u5373\u53ef\uff0c\u4e5f\u5c31\u662f$\\left \\lfloor \\frac{A}{p^i} \\right \\rfloor-\\left \\lfloor \\frac{A}{p^{i+1}} \\right \\rfloor$\n\n\n\u4e5f\u5c31\u662f\u6211\u4eec\u73b0\u5728\u53ea\u9700\u8981\u6c42\n\n$$B\\times \\sum_{i=0}\\sum_{j=0}\\max(i,j)(\\left \\lfloor \\frac{A}{p^i} \\right \\rfloor-\\left \\lfloor \\frac{A}{p^{i+1}} \\right \\rfloor)(\\left \\lfloor \\frac{B}{p^j} \\right \\rfloor-\\left \\lfloor \\frac{B}{p^{j+1}} \\right \\rfloor)$$\n\n\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5$O(\\log_p^2 A)$\u6765\u8ba1\u7b97\u8fd9\u4e2a\u67ff\u5b50\uff0c\u4f46\u662f\u6211\u4eec\u5904\u7406\u4e00\u4e0b$\\left \\lfloor \\frac{A}{p^i} \\right \\rfloor-\\left \\lfloor \\frac{A}{p^{i+1}} \\right \\rfloor$\u7684\u524d\u7f00\u548c\u5f3a\u884c\u8ba8\u8bba\u4e00\u4e0b\u4e5f\u53ef\u4ee5\u505a\u5230$O(\\log_p A)$\n\n\u4e00\u5230$n$\u5185\u7684\u8d28\u6570\u5927\u6982\u6709$\\frac{n}{\\ln n}$\u4e2a\uff0c\u6bcf\u4e00\u4e2a\u8d28\u6570\u7684\u8ba1\u7b97\u9700\u8981$O(\\log_p n)$\u7684\u590d\u6742\u5ea6\uff0c\u4e8e\u662f\u505a\u4e00\u904d\u590d\u6742\u5ea6\u5927\u6982\u5c31\u662f$O(n)$\u7684\n\n\u5bf9\u4e8e$\\rm type=1$\uff0c\u67ff\u5b50\u53d8\u6210\u4e86\n\n$$\\sum_{i=0}\\sum_{j=0}\\sum_{k=0}\\sum_{t_1=1}^{\\left \\lfloor \\frac{A}{p^i} \\right \\rfloor}\\sum_{t_2=1}^{\\left \\lfloor \\frac{B}{p^j} \\right \\rfloor}\\sum_{t_3=1}^{\\left \\lfloor \\frac{C}{p^k} \\right \\rfloor}(\\max(i,j)-\\min(i,k))\\times t_1\\times t_2\\times t_3\\times p^{i+j+k}[t_1\\perp p][t_2\\perp p][t_3\\perp p]$$\n\n\u5f3a\u884c\u4e00\u641e\u4e5f\u80fd\u53d8\u6210\u4e0a\u9762\u7684\u5f62\u5f0f\uff0c\u540c\u6837\u53ef\u4ee5\u5728$O(n)$\u65f6\u95f4\u6c42\u51fa\u6765\n\n\u5bf9\u4e8e$\\rm type=2$\uff0c\u6211\u4eec\u8003\u8651\u679a\u4e3e\u4e0a\u9762\u7684$\\gcd$\n\n\u8bbe$f(A,B,C)$\u4e3a\u7b2c\u4e00\u95ee\u7684\u7b54\u6848\uff0c\u4e5f\u5c31\u662f\u4e09\u4e2a\u4e0a\u6807\u5206\u522b\u53d6\u5230$A,B,C$\u65f6\u7684\u8d21\u732e\n\n\u5957\u8def\u679a\u4e3e$\\gcd$\u4e3a$d$\u5373$d$\u7684\u500d\u6570\u65f6\u7684\u8d21\u732e\n\n$$\\sum_{d=1}^{min(A,B,C)}d\\sum_{d|i}\\mu(\\frac{i}{d})f(\\left \\lfloor \\frac{A}{d} \\right \\rfloor,\\left \\lfloor  \\frac{B}{d}\\right \\rfloor,\\left \\lfloor \\frac{C}{d} \\right \\rfloor)$$\n\n\u5c31\u662f$\\left \\lfloor \\frac{A}{d} \\right \\rfloor,\\left \\lfloor  \\frac{B}{d}\\right \\rfloor,\\left \\lfloor \\frac{C}{d} \\right \\rfloor$\u5185\u7684\u6570\u4e58\u4e0a$d$\u5206\u522b\u4e0d\u4f1a\u8d85\u8fc7$A,B,C$\uff0c\u4e14\u8fd9\u4e9b\u6570\u7684$\\gcd$\u90fd\u662f$d$\u6216$d$\u7684\u500d\u6570\n\n\u518d\u5957\u8def\u4ea4\u6362\u4e00\u4e0b\u6c42\u548c\u987a\u5e8f\n\n$$\\sum_{i=1}^{\\min(A,B,C)}f(\\left \\lfloor \\frac{A}{i} \\right \\rfloor,\\left \\lfloor  \\frac{B}{i}\\right \\rfloor,\\left \\lfloor \\frac{C}{i} \\right \\rfloor)\\sum_{d|i}\\mu(\\frac{i}{d})d=\\sum_{i=1}^{\\min(A,B,C)}f(\\left \\lfloor \\frac{A}{i} \\right \\rfloor,\\left \\lfloor  \\frac{B}{i}\\right \\rfloor,\\left \\lfloor \\frac{C}{i} \\right \\rfloor)\\varphi(i)$$\n\n\u4e8e\u662f\u76f4\u63a5\u5927\u529b\u6574\u9664\u5206\u5757\uff0c\u590d\u6742\u5ea6\u5e94\u8be5\u4e0d\u4f1a\u8d85\u8fc7$O(n\\ln n)$\n\n\u5427\u3002\n\n\u8bf7\u5927\u529b\u5361\u5e38\n\n\u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define re register\n#define LL long long\n#define max(a,b) (a>b?a:b)\n#define min(a,b) (a<b?a:b)\n#pragma GCC optimize(3)\n#pragma GCC optimize(\"-fcse-skip-blocks\")\nconst int maxn=1e5+5;\nint mod,P,T,R;\nint is[maxn],p[maxn>>1],pre[maxn],phi[maxn],pw[maxn>>1];\nint r[2],tax[2][20],pr[2][20];\ninline int ksm(int a,int b) {\n\tint S=1;\n\tfor(;b;b>>=1,a=1ll*a*a%mod) if(b&1) S=1ll*S*a%mod;\n\treturn S;\n}\ninline int qm(int x) {return x>=P?x-P:x;}\ninline int dqm(int x) {return x+=x>>31&P;}\ninline int calc(int n,int p) {\n\treturn dqm(pre[n]-1ll*pre[n/p]*p%P);\n}\ninline int out(int A) {\n\tint ans=1;\n\tfor(re int i=1;i<=p[0]&&p[i]<=A;i++) \n\t\tans=1ll*ans*ksm(p[i],pw[i])%mod;\n\treturn ans;\n}\ninline void clear(int A) {\n\tfor(re int i=1;i<=p[0]&&p[i]<=A;i++) pw[i]=0;\n}\ninline void Solve(int A,int B,int C,int v) {\n\tint ans1=1;\n\tfor(re int t=1;t<=p[0];t++) {\n\t\tif(p[t]>A&&p[t]>B&&p[t]>C) break;\n\t\tint now=0,tot=0;\n\t\tfor(re int i=0,aa=A;aa;i++,aa/=p[t]) pr[0][i]=tax[0][i]=aa-aa/p[t],r[0]=i;\n\t\tfor(re int j=0,bb=B;bb;j++,bb/=p[t]) pr[1][j]=tax[1][j]=bb-bb/p[t],r[1]=j;\n\t\tR=max(r[0],r[1]);\n\t\tfor(re int i=1;i<=R;i++) pr[0][i]=qm(pr[0][i]+pr[0][i-1]);\n\t\tfor(re int j=1;j<=R;j++) pr[1][j]=qm(pr[1][j]+pr[1][j-1]);\n\t\tfor(re int i=0;i<=r[0];i++) \n\t\t\tnow=qm(now+1ll*tax[0][i]*pr[1][i]*i%P);\n\t\tfor(re int j=1;j<=r[1];j++) \n\t\t\tnow=qm(now+1ll*tax[1][j]*pr[0][j-1]*j%P);\n\t\tfor(re int i=1;i<=R;i++) pr[1][i]=0;\n\t\tfor(re int i=r[0]+1;i<=R;i++) pr[0][i]=0;\t\n\t\tnow=1ll*now*C%P;\n\t\tfor(re int k=0,cc=C;cc;k++,cc/=p[t]) pr[1][k]=tax[1][k]=cc-cc/p[t],r[1]=k;\n\t\tR=max(r[0],r[1]);\n\t\tfor(re int i=r[0]+1;i<=R;i++) pr[0][i]=qm(pr[0][i-1]+pr[0][i]);\n\t\tfor(re int k=1;k<=R;k++) pr[1][k]=qm(pr[1][k]+pr[1][k-1]);\n\t\tfor(re int i=1;i<=r[0];i++) \n\t\t\ttot=qm(tot+1ll*i*tax[0][i]*dqm(pr[1][r[1]]-pr[1][i-1])%P);\n\t\tfor(re int k=1;k<=r[1];k++)\n\t\t\ttot=qm(tot+1ll*k*tax[1][k]*dqm(pr[0][r[0]]-pr[0][k])%P);\n\t\tfor(re int i=0;i<=R;i++) pr[1][i]=pr[0][i]=0;\n\t\tnow=dqm(now-1ll*B*tot%P);\n\t\tpw[t]=qm(pw[t]+1ll*now*v%P);\n\t}\n}\ninline int Calc(int n,int m,int h) {\n\tint U=min(min(n,m),h);\n\tfor(re int l=2,r;l<=U;l=r+1) {\n\t\tr=min(n/(n/l),m/(m/l));\n\t\tr=min(r,h/(h/l));\n\t\tSolve(n/l,m/l,h/l,dqm(phi[r]-phi[l-1]));\n\t}\n\treturn out(max(max(n,m),h));\n}\nint A,B,C;\nint main() {\n\tscanf(\"%d%d\",&T,&mod);P=mod-1;phi[1]=1;\n\tfor(re int i=2;i<maxn;i++) {\n\t\tif(!is[i]) p[++p[0]]=i,phi[i]=i-1;\n\t\tfor(re int j=1;j<=p[0]&&p[j]*i<maxn;j++) {\n\t\t\tis[p[j]*i]=1;if(i%p[j]==0) {\n\t\t\t\tphi[p[j]*i]=phi[i]*p[j];break;\n\t\t\t}\n\t\t\tphi[p[j]*i]=phi[i]*phi[p[j]];\n\t\t}\n\t}\n\tfor(re int i=1;i<maxn;i++) \n\t\tpre[i]=qm(pre[i-1]+i),phi[i]=qm(phi[i-1]+phi[i]);\n\twhile(T--) {\n\t\tscanf(\"%d%d%d\",&A,&B,&C);\n\t\tint ans2=1;\n\t\tfor(re int t=1;t<=p[0];t++) {\n\t\t\tif(p[t]>A&&p[t]>B&&p[t]>C) break;\n\t\t\tint now=0,tot=0;\n\t\t\tfor(re LL i=0,a=1;a<=A;i++,a*=p[t])\n\t\t\t\tfor(re LL j=0,b=1;b<=B;j++,b*=p[t]) {\n\t\t\t\t\tint v=1ll*max(i,j)*a*b%P;\n\t\t\t\t\ttot=qm(tot+1ll*v*calc(A/a,p[t])*calc(B/b,p[t])%P*pre[C]%P);\n\t\t\t}\n\t\t\tfor(re LL i=1,a=p[t];a<=A;i++,a*=p[t])\n\t\t\t\tfor(re LL k=1,c=p[t];c<=C;k++,c*=p[t]) {\n\t\t\t\t\tint v=1ll*min(i,k)*a*c%P;\n\t\t\t\t    now=qm(now+1ll*v*calc(A/a,p[t])*calc(C/c,p[t])%P*pre[B]%P);\n\t\t\t}\n\t\t\tans2=1ll*ans2*ksm(p[t],dqm(tot-now))%mod;\n\t\t}\n\t\tSolve(A,B,C,1);printf(\"%d \",out(max(max(A,B),C)));\n\t\tprintf(\"%d %d\\n\",ans2,Calc(A,B,C));clear(max(max(A,B),C));\n\t}\n}\n```\n",
        "postTime": 1567416926,
        "uid": 35178,
        "name": "asuldb",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5518 \u3010[MtOI2019]\u5e7d\u7075\u4e50\u56e2\u3011"
    },
    {
        "content": "\u8fd9\u9898....\u7cbe\u795e\u6c61\u67d3....\n\n\u4e00\u4e2a\u4e00\u4e2a\u6765~~\u6211\u4f1a\u8bf4\u6211\u5199\u7684\u65f6\u5019\u4e00\u53e3\u6c14\u63a8\u5b8c\u6240\u6709\u5f0f\u5b50\u4e4b\u540e\u627e\u4e0d\u7740\u5f0f\u5b50\u5728\u54ea\u5417~~\n\nwarning:\u9700\u8981\u53cd\u6f14\u57fa\u7840\uff0c\u6700\u597d\u505a\u8fc7\u6570\u5b57\u8868\u683c\n\n\u9996\u5148\u53ef\u4ee5\u62c6\u6210\n\n$$\\begin{aligned}{}\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\left(\\frac{ij}{\\gcd(i,j)\\gcd(i,k)}\\right)^{f(type)}\\end{aligned}$$\n\n\u56e0\u4e3a\u662f\u8fde\u4e58\u6240\u4ee5\u76f4\u63a5\u5206\u5b50\u5206\u6bcd\u5206\u5f00\u7b97\uff0c\u8981\u6c42\u7684\u5c31\u662f\u5f62\u5982\n\n$$\\begin{aligned}\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^Ci^{f(type)}\\end{aligned}$$\n\n\u4ee5\u53ca\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{f(type)}$$\n\n\u8fd9\u6837\u7684\u95ee\u9898.\n\n\u4ee5\u4e0b\u9ed8\u8ba4$A\\leq B$\uff0c\u9664\u6cd5\u4e3a\u6574\u9664\n\n## type=0\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^Ci=\\prod_{i=1}^Ai^{BC}=(A!)^{BC}$$\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)=\\left(\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)\\right)^C$$\n\n\u73b0\u5728\u8bf7\u7559\u610f\u62ec\u53f7\u91cc\u9762\u7684\u5f0f\u5b50\uff0c\u6211\u4eec\u4e00\u4f1a\u8fd8\u8981\u7528.\u5f53\u7136\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u7ecf\u5178\u7684\u5f0f\u5b50\uff0c\u6211\u4eec\u5c31\u5199\u5f97\u7b80\u5355\u4e00\u70b9\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)=\\prod_{d=1}^A\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^Bd^{[\\gcd(i,j)=d]}=\\prod_{d=1}^A\\prod_{k=1}^{A/d}d^{\\mu(k)\\lfloor\\frac{A}{kd}\\rfloor\\lfloor\\frac{B}{kd}\\rfloor}=\\prod_{T=1}^A\\left(\\prod_{d\\mid T}d^{\\mu(T/d)}\\right)^{\\lfloor\\frac{A}{T}\\rfloor\\lfloor\\frac{B}{T}\\rfloor}$$\n\n\u9884\u5904\u7406\u91cc\u9762\u8fd9\u4e2a\u4e1c\u897f\u5c31\u53ef\u4ee5\u5355\u6b21$O(\\sqrt{n}\\log n)$\u505a\u4e86.\u5173\u4e8e\u9884\u5904\u7406\u6709$O(n\\log n)$\u548c$O(n\\log\\log n)$\u4e24\u79cd\u505a\u6cd5\uff0c\u53ef\u4ee5\u53bb\u770brqy\u7684\u65e5\u62a5\u6216\u8005\u6211\u7684\u6570\u5b57\u8868\u683c\u9898\u89e3\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u8d58\u8ff0.\n\n## type=1\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^Ci^{ijk}=\\left(\\prod_{i=1}^Ai^i\\right)^{S(B)S(C)}$$\n\n$$S(n)=\\sum\\limits_{i=1}^n=\\frac{n(n+1)}{2}$$\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{ijk}=\\left(\\prod_{i=1}^{A}\\prod_{j=1}^B\\gcd(i,j)^{ij}\\right)^{S(C)}$$\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^B\\gcd(i,j)^{ij}=\\prod_{d=1}^A\\prod_{i=1}^{A/d}\\prod_{j=1}^{B/d}d^{ijd^2[\\gcd(i,j)=1]}=\\prod_{d=1}^{A}\\prod_{k=1}^{A/d}d^{\\mu(k)d^2k^2S(A/kd)S(B/kd)}=\\prod_{T=1}^A\\left(\\prod_{d\\mid T}d^{\\mu(T/d)}\\right)^{T^2S(A/T)S(B/T)}$$\n\n\u9884\u5904\u7406$\\left(\\prod\\limits_{d\\mid T}d^{\\mu(T/d)}\\right)^{T^2}$\u5c31\u53ef\u4ee5$O(\\sqrt{n}\\log n)$\u8ba1\u7b97\u4e86.\u9884\u5904\u7406\u7684\u65b9\u6cd5\u662f\u5728\u524d\u9762\u9884\u5904\u7406\u7684\u90a3\u4e2a\u4e1c\u897f\u4e0a\u53d6$T^2$\u6b21\u5e42\n\n## type2\n\n\u4e3a\u4ec0\u4e48\u8981\u52a0\u524d\u4e24\u4e2a\u7c7b\u578b...\u53ea\u7559\u8fd9\u4e00\u4e2a\u4e0d\u662f\u66f4\u597d\u5417...\u65e0\u7aef\u589e\u52a0\u4ee3\u7801\u91cf...\n\n\u4e0b\u9762\u7684\u4e1c\u897f\u8981\u9ebb\u70e6\u4e00\u4e9b\n\n$$\\begin{aligned}\\prod_{i=1}^{A}\\prod_{j=1}^B\\prod_{k=1}^Ci^{\\gcd(i,j,k)}&=\\prod_{i=1}^Ai^{\\sum_{j=1}^B\\sum_{k=1}^C\\gcd(i,j,k)}\\\\&=\\prod_{i=1}^Ai^{\\sum_{d\\mid A}\\varphi(d)\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor}\\\\&=\\prod_{d=1}^A\\left(\\prod_{i=1}^{A/d}id\\right)^{\\varphi(d)\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor}\\\\&=\\prod_{d=1}^A\\left(d^{\\lfloor\\frac{A}{D}\\rfloor}\\left\\lfloor\\frac{A}{d}\\right\\rfloor!\\right)^{\\varphi(d)\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor}\\end{aligned}$$\n\n\u9884\u5904\u7406$d^{\\varphi(d)}$\u7684\u524d\u7f00\u79ef\u4ee5\u53ca$\\varphi$\u7684\u524d\u7f00\u548c\u5373\u53ef$O(\\sqrt{n})\\log n$\u56de\u7b54\u8be2\u95ee\n\n\u8fd8\u5269\u4e00\u4e2a\u6700\u7cbe\u795e\u6c61\u67d3\u7684\u5f0f\u5b50...\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{\\gcd(i,j,k)}=\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)^{\\sum_{k=1}^C\\gcd(\\gcd(i,j),k)}$$\n\u8bb0\n$$G(n,x)=\\sum\\limits_{i=1}^n\\gcd(i,x)=\\sum_{i=1}^x\\sum_{d\\mid i,d\\mid x}\\varphi(d)=\\sum_{d\\mid x}\\varphi(d)\\left\\lfloor\\frac{n}{d}\\right\\rfloor$$\n\n\u56de\u5230\u539f\u5f0f\u5f97\u5230\n\n$$\\begin{aligned}\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)^{G(C,\\gcd(i,j))}&=\\prod\\limits_{d=1}^Ad^{G(C,d)\\sum_{i=1}^{A/d}\\sum_{j=1}^{B/d}[\\gcd(i,j)=1]}\\\\&=\\prod_{d=1}^Ad^{G(C,d)\\sum_{k=1}^{A/d}\\mu(k)\\lfloor\\frac{A}{kd}\\rfloor\\lfloor\\frac{B}{kd}\\rfloor}\\\\&=\\prod_{T=1}^A\\left(\\prod_{d\\mid T}d^{G(C,d)\\mu(T/d)}\\right)^{\\lfloor\\frac{A}{T}\\rfloor\\lfloor\\frac{B}{T}\\rfloor}\\end{aligned}$$\n\n\u5982\u679c\u80fd\u9884\u5904\u7406\u4e2d\u95f4\u90a3\u4e00\u5768\u7684\u8bdd\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\uff0c\u4f46\u662f\u5f88\u9057\u61be\u4e0d\u80fd\u9884\u5904\u7406...\n\n\u6211\u4eec\u5c1d\u8bd5\u9000\u4e00\u6b65\u5e76\u4e14\u628a$G$\u91cc\u9762\u90a3\u4e2a\u679a\u4e3e\u56e0\u5b50\u62fd\u5230\u5916\u9762\n\n$$\\begin{aligned}\\prod_{d=1}^Ad^{\\sum_{e\\mid d}\\varphi(e)\\lfloor\\frac{C}{e}\\rfloor\\sum_{k=1}^{A/d}\\mu(k)\\lfloor\\frac{A}{kd}\\rfloor\\lfloor\\frac{B}{kd}\\rfloor}&=\\prod_{e=1}^A\\prod_{d=1}^{A/e}(de)^{\\varphi(e)\\lfloor\\frac{C}{e}\\rfloor\\sum_{k=1}^{A/de}\\mu(k)\\lfloor\\frac{A}{kde}\\rfloor\\lfloor\\frac{B}{kde}\\rfloor}\\end{aligned}$$\n\n\u5206\u79bb$d,e$\u5e76\u5206\u522b\u5904\u7406\n\n\u5bf9$d$\u6709\n$$\\prod_{e=1}^A\\prod_{d=1}^{A/e}d^{\\varphi(e)\\lfloor\\frac{C}{e}\\rfloor\\sum_{k=1}^{A/de}\\mu(k)\\lfloor\\frac{A}{kde}\\rfloor\\lfloor\\frac{B}{kde}\\rfloor}=\\prod_{e=1}^A\\left(\\prod_{T=1}^{A/e}\\left(\\prod_{d\\mid T}d^{\\mu(T/d)}\\right)^{\\lfloor\\frac{A}{Te}\\rfloor\\lfloor\\frac{B}{Te}\\rfloor}\\right)^{\\varphi(e)\\lfloor\\frac{C}{e}\\rfloor}$$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u7684\u5185\u90e8\u5c31\u662ftype=0\u7684\u65f6\u5019\u7684\u4e1c\u897f.\u5982\u679c\u6211\u4eec\u76f4\u63a5\u6574\u9664\u5206\u5757\u7b97\u7684\u8bdd\u590d\u6742\u5ea6\u662f\n\n$$\\sum_{i=1}^{\\sqrt{n}}\\sqrt{i}\\log i+\\sum_{i=1}^{\\sqrt{n}}\\sqrt{\\frac{n}{i}}\\log\\frac{n}{i}=O(n^{\\frac{3}{4}}\\log n)$$\n\n\u5f53\u7136\u8fd9\u6837\u592a\u6d6a\u8d39\u4e86\uff0c\u6839\u636etype=0\u7684\u60c5\u51b5\u6211\u4eec\u77e5\u9053\u8fd9\u5c31\u662f$F(n,m)=\\prod_{i=1}^n\\prod_{j=1}^m\\gcd(i,j)$\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u51fa$n,m\\leq N^{\\frac{2}{3}}$\u7684\u6240\u6709$F(n,m)$\uff0c\u8fd9\u6837\u590d\u6742\u5ea6\u5c31\u53ea\u5269\u4e0b\n\n$$\\sum\\limits_{i=1}^{n^\\frac{1}{3}}\\sqrt{\\frac{n}{i}}\\log\\frac{n}{i}=O(n^{\\frac{2}{3}}\\log n)$$\n\n\u5b9e\u9645\u4e0a\u53ef\u4ee5\u76f4\u63a5\u5904\u7406\u5230\u4e00\u4e2a\u5b9a\u503c\uff0c\u6bd4\u5982\u6211\u9009\u7684\u662f3000.\u5904\u7406\u7684\u65f6\u5019\u8bb0\u5f97\u4e0d\u8981\u5e26$log$.\n\n\u5269\u4e0b\u7684$e$\u5c31\u597d\u529e\u4e86\n\n$$\\prod_{e=1}^A\\prod_{d=1}^{A/e}e^{\\varphi(e)\\lfloor\\frac{C}{e}\\rfloor\\sum_{k=1}^{A/de}\\mu(k)\\lfloor\\frac{A}{kde}\\rfloor\\lfloor\\frac{B}{kde}\\rfloor}=\\prod_{e=1}^Ae^{\\varphi(e)\\lfloor\\frac{C}{e}\\rfloor\\sum_{T=1}^{A/e}\\lfloor\\frac{A}{Te}\\rfloor\\lfloor\\frac{B}{Te}\\rfloor\\sum_{k\\mid T}\\mu(k)}=\\prod_{e=1}^Ae^{\\varphi(e)\\lfloor\\frac{A}{e}\\rfloor\\lfloor\\frac{B}{e}\\rfloor\\lfloor\\frac{C}{e}\\rfloor}$$\n\n\u76f4\u63a5$O(\\sqrt{n}\\log n)$\u7b97\u5c31\u597d\u4e86\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u5728$O(n^{\\frac{4}{3}}+Tn^{\\frac{2}{3}}\\log n)$\u7684\u65f6\u95f4\u5185\u89e3\u51b3\u4e86\u8fd9\u9053\u9898\n\n\u4e0b\u9762\u662f\u5361\u4e86\u4e00\u90e8\u5206\u5e38\u7684\u4ee3\u7801(\u5b9e\u5728\u4e0d\u60f3\u5361\u4e86)\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nconst int N=1e6;\nstruct Q{int a,b,c;}q[N];\nint A,B,C,pf[N],pg[N],dphi[N],fac[N],fi[N],g[N],gi[N],f[N],mu[N],phi[N],pphi[N],iphi[N],sphi[N],smu[N],inv[N],T,mod,p[N],prime[N],cnt,s1,s2,s3,ffac[N],gd[3005][3005],sgd[3005][3005],sgi[3005][3005];\nint qpower(int a,int b)\n{\n    if(a==1)return 1;int ans=1;if(b<0)b+=mod-1;\n    for(;b;b>>=1,a=1ll*a*a%mod)if(b&1)ans=1ll*ans*a%mod;\n    return ans;\n}\nvoid make(int n)\n{\n    inv[1]=fac[1]=g[1]=gi[1]=gi[0]=fi[0]=pphi[0]=iphi[0]=mu[1]=phi[1]=ffac[1]=pf[1]=pg[1]=1;\n    for(int i=2;i<=n;i++)\n    {\n        inv[i]=1ll*(mod-mod/i)*inv[mod%i]%mod;\n        fac[i]=1ll*fac[i-1]*i%mod,ffac[i]=1ll*ffac[i-1]*qpower(i,i)%mod;\n        if(!p[i])prime[++cnt]=i,mu[i]=-1,phi[i]=i-1;\n        for(int j=1;j<=cnt&&i*prime[j]<=n;j++)\n        {\n            int x=i*prime[j];p[x]=1;\n            if(i%prime[j])mu[x]=-mu[i],phi[x]=phi[i]*(prime[j]-1);\n            else{mu[x]=0,phi[x]=phi[i]*prime[j];break;}\n        }\n    }\n    for(int i=1;i<=n;i++)\n        f[i]=i,fi[i]=inv[i],sphi[i]=(sphi[i-1]+phi[i])%(mod-1),smu[i]=(smu[i-1]+mu[i]),\n        dphi[i]=qpower(i,phi[i]),pphi[i]=1ll*pphi[i-1]*dphi[i]%mod,iphi[i]=1ll*iphi[i-1]*qpower(inv[i],phi[i])%mod;\n    for(int i=1;i<=cnt;i++)\n        for(int t=n/prime[i],j=t*prime[i];t;j-=prime[i],t--)\n            f[j]=1ll*f[j]*fi[t]%mod,\n            fi[j]=1ll*fi[j]*f[t]%mod;\n    for(int i=2;i<=n;i++)\n        pg[i]=qpower(f[i],1ll*i*i%(mod-1)),g[i]=1ll*g[i-1]*pg[i]%mod,gi[i]=1ll*gi[i-1]*qpower(pg[i],mod-2)%mod,\n        pf[i]=f[i],f[i]=1ll*f[i]*f[i-1]%mod,fi[i]=1ll*fi[i]*fi[i-1]%mod;\n    int lim=min(n,3000);\n    for(int i=0;i<=lim;i++)gd[0][i]=gd[i][0]=i,sgd[i][0]=sgd[0][i]=sgi[0][i]=sgi[i][0]=1;\n    for(int i=1;i<=lim;i++)\n    {\n        for(int j=1;j<i;j++)\n        {\n            gd[i][j]=j<i-j?gd[i-j][j]:gd[j][i-j];\n            sgd[i][j]=1ll*sgd[i-1][j]*sgd[i][j-1]%mod*sgi[i-1][j-1]%mod*gd[i][j]%mod;\n            sgi[i][j]=1ll*sgi[i-1][j]*sgi[i][j-1]%mod*sgd[i-1][j-1]%mod*inv[gd[i][j]]%mod;\n        }\n        gd[i][i]=i;\n        sgd[i][i]=1ll*sgd[i][i-1]*sgd[i][i-1]%mod*sgi[i-1][i-1]%mod*i%mod;\n        sgi[i][i]=1ll*sgi[i][i-1]*sgi[i][i-1]%mod*sgd[i-1][i-1]%mod*inv[i]%mod;\n    }\n}\nint S(int n){return 1ll*n*(n+1)/2%(mod-1);}\nvoid calc1(int A,int B,int C)\n{\n    s1=1ll*s1*qpower(fac[A],1ll*B*C%(mod-1))%mod;\n    s2=1ll*s2*qpower(ffac[A],1ll*S(B)*S(C)%(mod-1))%mod;\n    int n=min(A,min(B,C));\n    for(int i=1,lt;i<=n;i=lt+1)\n    {\n        lt=min(A/(A/i),min(B/(B/i),C/(C/i)));int t=1ll*(B/i)*(C/i)%(mod-1);\n        s3=1ll*s3*qpower(1ll*pphi[lt]*iphi[i-1]%mod,1ll*(A/i)*t%(mod-1))%mod*qpower(fac[A/i],(1ll*t*(sphi[lt]-sphi[i-1])%(mod-1)+mod-1)%(mod-1))%mod;\n    }\n}\nint S(int n,int m)\n{\n    if(n>m)swap(n,m);if(n<=3000&&m<=3000)return sgd[m][n];int s=1,i;\n    for(i=1;i*i<=n;i++)\n        s=1ll*s*qpower(pf[i],1ll*(n/i)*(m/i)%(mod-1))%mod;\n    for(int lt;i<=n;i=lt+1)\n    {\n        lt=min(n/(n/i),m/(m/i));\n        s=1ll*s*qpower(1ll*f[lt]*fi[i-1]%mod,1ll*(n/i)*(m/i)%(mod-1))%mod;\n    }\n    return s;\n}\nint Inv(int x){return qpower(x,mod-2);}\nvoid calc2(int A,int B,int C)\n{\n    int n=min(A,B);int t1=1,t2=1,t3=1,lstans=1,lta=0,ltb=0,i,ta,tb,tc;\n    for(i=1;i*i<=n;i++)\n    {\n        ta=A/i,tb=B/i;\n        t1=1ll*t1*qpower(pf[i],1ll*ta*tb%(mod-1))%mod;\n        t2=1ll*t2*qpower(pg[i],1ll*S(ta)*S(tb)%(mod-1))%mod;\n    }\n    for(int lt;i<=n;i=lt+1)\n    {\n        ta=A/i,tb=B/i;lt=min(A/ta,B/tb);\n        t1=1ll*t1*qpower(1ll*f[lt]*fi[i-1]%mod,1ll*ta*tb%(mod-1))%mod;\n        t2=1ll*t2*qpower(1ll*g[lt]*gi[i-1]%mod,1ll*S(ta)*S(tb)%(mod-1))%mod;\n    }\n    s1=1ll*s1*qpower(t1,mod-1-C)%mod;\n    s2=1ll*s2*qpower(t2,mod-1-S(C))%mod;\n    n=min(min(A,B),C);\n    for(i=1;i*i<=n;i++)\n    {\n        t3=1ll*t3*qpower(lstans=S(A/i,B/i),1ll*(C/i)*phi[i]%(mod-1))%mod;\n        t3=1ll*t3*qpower(dphi[i],1ll*(A/i)*(B/i)%(mod-1)*(C/i)%(mod-1))%mod;\n    }\n    for(int lt;i<=n;i=lt+1)\n    {\n        ta=A/i,tb=B/i,tc=C/i;lt=min(A/ta,min(B/tb,C/tc));\n        if(lta==ta&&ltb==tb)t3=1ll*t3*qpower(lstans,1ll*tc*(sphi[lt]-sphi[i-1])%(mod-1))%mod;\n        else\n        {\n            int t=S(ta,tb);lta=ta,ltb=tb;\n            t3=1ll*t3*qpower(t,1ll*tc*(sphi[lt]-sphi[i-1])%(mod-1))%mod;\n            lstans=t;\n        }\n//        t3=1ll*t3*qpower(S(ta,tb),(1ll*tc*(sphi[lt]-sphi[i-1])%(mod-1)+mod-1)%(mod-1))%mod;\n        t3=1ll*t3*qpower(1ll*pphi[lt]*iphi[i-1]%mod,1ll*ta*tb%(mod-1)*tc%(mod-1))%mod;\n    }\n    s3=1ll*s3*qpower(t3,mod-2)%mod;\n}\nint main()\n{\n    scanf(\"%d%d\",&T,&mod);int mx=0;\n    for(int i=1;i<=T;i++)scanf(\"%d%d%d\",&q[i].a,&q[i].b,&q[i].c),mx=max(mx,max(max(q[i].a,q[i].b),q[i].c));\n    make(mx);\n    for(int i=1;i<=T;i++)\n    {\n        A=q[i].a,B=q[i].b,C=q[i].c;s1=s2=s3=1;\n        calc1(A,B,C);calc1(B,A,C);\n        calc2(A,B,C),calc2(A,C,B);\n        printf(\"%d %d %d\\n\",s1,s2,s3);\n    }\n}\n```",
        "postTime": 1566720672,
        "uid": 22136,
        "name": "qwaszx",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5518 \u3010[MtOI2019]\u5e7d\u7075\u4e50\u56e2\u3011"
    },
    {
        "content": "\u7ebf\u6027\u7b5b\u5199\u6302\u8eab\u8d25\u540d\u88c2 ... \u9b54\u9b3c\u4e50\u56e2\u540d\u526f\u5176\u5b9e \n\n\u4ee5\u4e0b\u662f\u539f\u9898\u89e3: \n\n---\n\n.......\u4e00\u770b $type2$ \u5c31\u4e0d\u60f3\u505a\u7cfb\u5217  \n\n\u597d\u5427\u6309\u60ef\u4f8b\u5316\u7b80\u4e00\u4e0b\u539f\u5f0f  \n\n$$\\prod^A_i\\prod^B_j\\prod^C_k(\\frac {\\text{lcm}(i, j)}{\\text{gcd}(i, k)})^{f(type)}$$  \n\n$$\\prod^A_i\\prod^B_j\\prod^C_k(\\frac {i\\times j}{\\text{gcd}(i, j)\\times\\text{gcd}(i, k)})^{f(type)}$$  \n\n$$\\frac {\\prod^A_i\\prod^B_j\\prod^C_ki^{f(type)}\\prod^A_i\\prod^B_j\\prod^C_kj^{f(type)}}{\\prod^A_i\\prod^B_j\\prod^C_k\\gcd(i, j)^{f(type)}\\prod^A_i\\prod^B_j\\prod^C_k\\gcd(i, k)^{f(type)}}$$  \n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u53c8\u81ed\u53c8\u957f\u7684\u5f0f\u5b50\u62c6\u6210\u56db\u4e2a\u5f0f\u5b50\u6765\u7b97. ~~\u4e5f\u5c31\u662f\u5206\u5f00\u4e86\u54e6\u7b97~~  \n\n(\u7136\u800c\u611f\u89c9\u8fd8\u662f\u5f88\u6bd2\u7624  \n\n\u5206\u6210\u5b50\u95ee\u9898\u6765\u770b\u5427  \n\n---\n\n## type 0  \n\n\u597d\u7684\u6211\u4eec\u770b\u5230 $type=0$ \u7684\u60c5\u51b5.  \n\n$$\\prod^A_i\\prod^B_j\\prod^C_ki=(\\prod^A_ii)^{B\\times C}$$  \n\n~~\u663e\u7136 \u2191~~  \n\n$$\\prod^A_i\\prod^B_j\\prod^C_k\\gcd(i, j)$$  \n\n\u6570\u5b57\u8868\u683c\u5f31\u5316\u7248?  \u7b80\u5355\u4e86\u8bb8\u591a (  \n\n$$= (\\prod ^ {A} _ {T = 1} (\\prod _ {d \\mid T} d^{\\mu(\\frac Td)}) ^ {\\lfloor \\frac AT \\rfloor \\lfloor \\frac BT \\rfloor}) ^ {C}$$  \n\n\u53ef\u4ee5\u76f4\u63a5\u53c2\u7167\u6570\u5b57\u8868\u683c\u6765\u505a, \u6211 ~~\u4e3a\u4e86\u4f18\u5316\u590d\u6742\u5ea6~~ \u4f7f\u7528\u7684\u662f $\\Theta(n\\log\\log n)$ \u7684\u9884\u5904\u7406\u65b9\u6cd5, \u4e0d\u8fc7 $\\Theta(n\\log n)$ \u7684\u9884\u5904\u7406\u4e5f\u53ef\u4ee5\u8fc7.  \n\n\u90a3\u4e48 $type=0$ \u7684\u90e8\u5206\u5c31\u63a8\u5b8c\u4e86.\n\n----\n\n## type 1  \n\n\u770b\u5230 $type=1$ \u7684\u60c5\u51b5.  \n\n$$\\prod^A_i\\prod^B_j\\prod^C_ki^{i\\times j\\times k}=(\\prod^A_ii^i)^{(\\sum^B_jj)\\times (\\sum^C_kk)}$$  \n\n~~\u4f9d\u65e7\u663e\u7136 \u2191~~  \n\n$$\\prod^A_i\\prod^B_j\\prod^C_k\\gcd(i, j)^{i\\times j\\times k}$$  \n\n\u5514 ... \u5f00\u59cb\u6709\u70b9\u96be\u5ea6\u4e86, \u4e0d\u8fc7\u548c $type1$ \u7684\u683c\u5f0f\u633a\u50cf\u7684  \n\u4e3a\u4e86\u65b9\u4fbf, \u6b64\u5904\u8bbe $sum(n) = \\sum^n_ii$\n$$= (\\prod ^ {A} _ {i = 1} \\prod ^ {B} _ {j = 1} \\prod ^ {A} _ {d = 1} d^{i\\times j[gcd(i, j) = d]}) ^ {sum(C)}$$  \n$$= (\\prod ^ {A} _ {d = 1} d^{\\sum ^ A _ {i = 1} \\sum ^ B _ {j = 1} i\\times j[gcd(i, j) = d]}) ^ {sum(C)}$$  \n$$= (\\prod ^ {A} _ {d = 1} d^{d^2\\sum ^ {\\lfloor \\frac Ad \\rfloor} _ {i = 1} \\sum ^ {\\lfloor \\frac Bd \\rfloor} _ {j = 1} i\\times j[gcd(i, j) = 1]}) ^ {sum(C)}$$  \n$$= (\\prod ^ {A} _ {d = 1} d^{d^2\\sum ^ {\\lfloor \\frac Ad \\rfloor} _ {d' = 1} \\mu(d')d'^2 sum(\\lfloor \\frac A{dd'} \\rfloor) sum(\\lfloor \\frac B{dd'} \\rfloor)}) ^ {sum(C)}$$  \n$$= (\\prod ^ {A} _ {d = 1} d^{d^2\\sum ^ {A} _ {d \\mid T} \\mu(\\frac Td)(\\frac Td)^2 sum(\\lfloor \\frac AT \\rfloor) sum(\\lfloor \\frac BT \\rfloor)}) ^ {sum(C)}$$  \n$$= (\\prod ^ {A} _ {d = 1} \\prod ^ {A} _ {d \\mid T} d^{\\mu(\\frac Td)T^2 sum(\\lfloor \\frac AT \\rfloor) sum(\\lfloor \\frac BT \\rfloor)}) ^ {sum(C)}$$  \n$$= (\\prod ^ {A} _ {T = 1} (\\prod _ {d \\mid T} d^{\\mu(\\frac Td)}) ^ {T^2sum(\\lfloor \\frac AT \\rfloor) sum(\\lfloor \\frac BT \\rfloor)}) ^ {sum(C)}$$  \n\n\u9884\u5904\u7406\u6389\u62ec\u53f7\u91cc\u9762\u7684\u4e1c\u897f\u7684 $T^2$ \u6b21\u5e42\u5c31\u53ef\u4ee5\u4e86.  \n\n---\n\n## type 2  \n\n\u524d\u4e24\u4e2a $type$ \u90fd\u6709\u4e00\u70b9\u5957\u8def, \u7136\u800c\u8fd9\u4e2a $type$ ....   \n\n\u597d\u5427\u5fc3\u5e73\u6c14\u548c\u770b\u5230\u8fd9\u4e2a $type$.  \n\n$$\\prod^A_i\\prod^B_j\\prod^C_ki^{\\gcd(i, j, k)}$$  \n\n\u6b63\u5e38\u7684\u5957\u8def\u6162\u6162\u6765  \n\n$$=\\prod^A_ii^{\\sum^B_j\\sum^C_k\\gcd(i, j, k)}$$  \n\n\u770b\u5230\u6307\u6570\u90e8\u5206  \n\n$$\\sum^B_i\\sum^C_j\\gcd(i, j, n)$$  \n$$=\\sum^B_dd\\sum^B_i\\sum^C_j[\\gcd(i, j, n)=d]$$  \n$$=\\sum^B_dd\\sum^{\\lfloor \\frac Bd \\rfloor}_i\\sum^{\\lfloor \\frac Cd \\rfloor}_j[\\gcd(i, j, \\frac nd)=1][d|n]$$  \n$$=\\sum_{d|n}d\\sum^B_{dd'| n}\\mu(d')\\lfloor \\frac B{dd'} \\rfloor\\lfloor \\frac C{dd'} \\rfloor$$  \n$$=\\sum_{T|n}\\lfloor \\frac B{T} \\rfloor\\lfloor \\frac C{T} \\rfloor\\sum_{d|T}d\\mu(\\frac Td)$$  \n$$=\\sum_{T|n}\\lfloor \\frac B{T} \\rfloor\\lfloor \\frac C{T} \\rfloor\\varphi(T)$$  \n\n\u4e8e\u662f \n\n$$\\prod^A_ii^{\\sum^B_j\\sum^C_k\\gcd(i, j, k)}$$  \n$$= \\prod^A_i\\prod_{T|i}i^{\\varphi(T)\\lfloor \\frac B{T} \\rfloor\\lfloor \\frac C{T} \\rfloor}$$  \n$$= \\prod^A_T(T^{\\lfloor \\frac AT \\rfloor}\\prod^{\\lfloor \\frac AT \\rfloor}_{i}i)^{\\varphi(T)\\lfloor \\frac B{T} \\rfloor\\lfloor \\frac C{T} \\rfloor}$$  \n$$= \\prod^A_T(T^{\\varphi(T)})^{\\lfloor \\frac AT \\rfloor\\lfloor \\frac B{T} \\rfloor\\lfloor \\frac C{T} \\rfloor}(\\lfloor \\frac A{T} \\rfloor)!^{\\varphi(T)\\lfloor \\frac B{T} \\rfloor\\lfloor \\frac C{T} \\rfloor})$$  \n\n\u9884\u5904\u7406\u4e00\u4e0b\u6307\u6570\u4e3a $\\varphi$ \u7684\u9636\u4e58\u4ee5\u53ca $\\varphi$ \u7684\u524d\u7f00\u548c\u5c31\u53ef\u4ee5\u5757\u4e50\u7684\u7b97\u4e86  \n\n\u7136\u540e\u662f\u6700\u6bd2\u7624\u7684\u5f0f\u5b50  \n\n$$\\prod^A_i\\prod^B_j\\prod^C_k\\gcd(i, j)^{\\gcd(i, j, k)}$$  \n\n\u5957\u8def\u7684\u679a\u4e3e  \n\n$$= \\prod^A_dd^{\\sum^A_i\\sum^B_j\\sum^C_k\\gcd(d, k)[\\gcd(i, j)=d]}$$  \n\n$$= \\prod^A_dd^{\\sum^A_{d|T}\\mu(\\frac Td)\\lfloor \\frac AT \\rfloor \\lfloor \\frac BT \\rfloor \\sum^C_k\\gcd(d, k)}$$  \n\n$$= \\prod^A_T(\\prod_{d|T}d^{\\mu(\\frac Td) \\sum^C_k\\gcd(d, k)})^{\\lfloor \\frac AT \\rfloor \\lfloor \\frac BT \\rfloor}$$  \n\n$$= \\prod^A_T(\\prod_{d|T}d^{\\mu(\\frac Td) \\sum_{d'|d}\\varphi(d')\\lfloor \\frac C{d'}\\rfloor})^{\\lfloor \\frac AT \\rfloor \\lfloor \\frac BT \\rfloor}$$    \n\n$$= \\prod^A_T(\\prod_{d|T}\\prod_{d'|d}d^{\\mu(\\frac T{d}) \\varphi(d')\\lfloor \\frac C{d'}\\rfloor})^{\\lfloor \\frac AT \\rfloor \\lfloor \\frac BT \\rfloor}$$   \n\n\u7136\u540e\u8fd9\u91cc\u5361\u4e86\u6211\u5f88\u4e45 ... \n\n\u53d1\u73b0\u600e\u4e48\u63a8\u5e95\u6570\u90fd\u6709\u4e00\u4e2a $d$, \u4e8e\u662f\u628a $d$ \u62c6\u6210 $d'$ \u548c $\\frac d{d'}$ ~~\u5206\u5f00\u4e86\u54e6\u7b97~~\u5c31\u53ef\u4ee5\u4e86.     \n\n$$\\prod^A_T\\prod_{d|T}\\prod_{d'|d}(\\frac d{d'})^{\\mu(\\frac T{d}) \\varphi(d')\\lfloor \\frac C{d'}\\rfloor\\lfloor \\frac AT \\rfloor \\lfloor \\frac BT \\rfloor}$$   \n\n$$= \\prod^A_{d'}\\prod^A_{d'|T}\\prod^A_{d|T\\wedge d'|d}(\\frac d{d'})^{\\mu(\\frac T{d}) \\varphi(d')\\lfloor \\frac C{d'}\\rfloor\\lfloor \\frac AT \\rfloor \\lfloor \\frac BT \\rfloor}$$  \n\n$$= \\prod^A_{d'}\\prod^{\\lfloor \\frac A{d'} \\rfloor}_{T}\\prod^A_{d|d'T\\wedge d'|d}(\\frac d{d'})^{\\mu(\\frac {d'T}{d}) \\varphi(d')\\lfloor \\frac C{d'}\\rfloor\\lfloor \\frac A{d'T} \\rfloor \\lfloor \\frac B{d'T} \\rfloor}$$  \n\n$$= \\prod^A_{d'}\\prod^{\\lfloor \\frac A{d'} \\rfloor}_{T}\\prod^A_{d|T}d^{\\mu(\\frac {T}{d}) \\varphi(d')\\lfloor \\frac C{d'}\\rfloor\\lfloor \\frac A{d'T} \\rfloor \\lfloor \\frac B{d'T} \\rfloor}$$  \n\n$$= \\prod^A_{T}(\\prod^{\\lfloor \\frac A{T} \\rfloor}_{T'}(\\prod^A_{d|T'}d^{\\mu(\\frac {T}{d})}) ^{\\lfloor \\frac A{TT'} \\rfloor \\lfloor \\frac B{TT'} \\rfloor})^{\\varphi(T)\\lfloor \\frac C{T}\\rfloor}$$   \n\n\u8fd9\u73a9\u610f\u76f4\u63a5\u4e24\u6b21\u6574\u9664\u5206\u5757\u5c31\u5b8c\u4e8b\u4e86.  \n\n$$\\prod^A_T\\prod_{d|T}\\prod_{d'|d}(d')^{\\mu(\\frac T{d}) \\varphi(d')\\lfloor \\frac C{d'}\\rfloor\\lfloor \\frac AT \\rfloor \\lfloor \\frac BT \\rfloor}$$  \n\n$$= \\prod^A_{d'}\\prod^{\\lfloor \\frac A{d'} \\rfloor}_{T}\\prod^A_{d|T}(d')^{\\mu(\\frac {T}{d}) \\varphi(d')\\lfloor \\frac C{d'}\\rfloor\\lfloor \\frac A{d'T} \\rfloor \\lfloor \\frac B{d'T} \\rfloor}$$  \n\n\u4f46\u662f\u8fd9\u4e2a\u5462? \u53d1\u73b0\u7ed3\u679c\u7684 $d'$ \u6307\u6570\u90e8\u5206\u5305\u542b\u4e86\u4e00\u4e2a $\\lfloor \\frac C{d'} \\rfloor$, \u6ca1\u6cd5\u9884\u5904\u7406\u4e86 ...  \n\u5176\u5b9e\u628a\u679a\u4e3e\u7684 $d$ \u548c $T$ \u6254\u56de\u6307\u6570~~\u56de\u7089\u91cd\u9020~~\u5c31\u597d\u4e86  \n\n$$= \\prod^A_{d'}(d')^{\\sum^{\\lfloor \\frac A{d'} \\rfloor}_{T}\\sum^A_{d|T}\\mu(\\frac {T}{d}) \\varphi(d')\\lfloor \\frac C{d'}\\rfloor\\lfloor \\frac A{d'T} \\rfloor \\lfloor \\frac B{d'T} \\rfloor}$$  \n\n$$= \\prod^A_{d'}(d')^{ \\varphi(d')\\lfloor \\frac C{d'}\\rfloor\\sum^{\\lfloor \\frac A{d'} \\rfloor}_{T}\\lfloor \\frac A{d'T} \\rfloor \\lfloor \\frac B{d'T} \\rfloor\\sum^A_{d|T}\\mu(d)}$$  \n\n$$= \\prod^A_{d'}(d')^{ \\varphi(d')\\lfloor \\frac C{d'}\\rfloor\\sum^{\\lfloor \\frac A{d'} \\rfloor}_{T}\\lfloor \\frac A{d'T} \\rfloor \\lfloor \\frac B{d'T} \\rfloor[T=1]}$$  \n\n$$= \\prod^A_{d'}(d')^{ \\varphi(d')\\lfloor \\frac C{d'}\\rfloor\\sum^{\\lfloor \\frac A{d'} \\rfloor}_{T}\\lfloor \\frac A{d'T} \\rfloor \\lfloor \\frac B{d'T} \\rfloor[T=1]}$$  \n\n$$= \\prod^A_{d'}(d')^{ \\varphi(d')\\lfloor \\frac C{d'}\\rfloor\\lfloor \\frac A{d'} \\rfloor \\lfloor \\frac B{d'} \\rfloor}$$  \n\n\u5c31\u662f\u8fd9\u4e48\u7b80\u5355 ... \u8fd9\u4e2a\u4e00\u6b21\u5206\u5757\u5c31\u80fd\u641e\u5b9a\u4e86  \n\n\u4ee3\u7801\u592a\u4e11\u4e86~~\u800c\u4e14\u8fd8\u6709 15kb~~ \u5c31\u4e0d\u653e\u4e86\n\n\u597d\u4e86\u53ef\u4ee5\u6492\u82b1\u4e86 .... \u8fd9\u9898\u89e3\u6211\u5199\u4e86\u8db3\u8db3\u4e00\u5929 ... (2020/02/29 03:00 ~ 2020/03/01 07:00)",
        "postTime": 1583030217,
        "uid": 244079,
        "name": "Hydrate",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5518 \u3010\u9b54\u9b3c\u4e50\u56e2\u3011"
    },
    {
        "content": "\u524d\u7f6e\u829d\u58eb\uff1a[\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14](https://oi-wiki.org/math/mobius/)\n\n**Warning\uff1a\u672c\u9898\u9700\u8981\u4e00\u5b9a\u7684\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u57fa\u7840\u3002\u5efa\u8bae\u5b8c\u6210 [P3704](https://www.luogu.com.cn/problem/P3704) \u540e\u518d\u6765\u67e5\u770b\u672c\u7bc7\u9898\u89e3\u3002**\n\n**\u6ce8\u610f\uff1a\u7531\u4e8e\u672c\u849f\u84bb\u6bd4\u8f83\u61d2\uff0c\u90e8\u5206\u8fc7\u4e8e\u57fa\u7840\u7684\u8f6c\u5316\u7701\u7565\u3002**\n\n\u539f\u5f0f $= \\displaystyle\\prod_{i = 1}^A \\prod_{j = 1}^B \\prod_{k = 1}^C (\\frac{ij}{\\gcd(i, j) \\gcd(i, k)})^{f(\\operatorname{type})}$\n\n1. $\\operatorname{type} = 0$\n\n\u8bbe $f_1(A, B) = \\displaystyle\\prod_{i = 1}^A \\prod_{j = 1}^B \\gcd(i, j)$\u3002\n\n\u2234\u539f\u5f0f $= \\displaystyle\\frac{(A!)^{BC} (C!)^{AB}}{f_1(A, B)^C f_1(A, C)^B}$\n\n\u7531 P3704 \u7684\u5957\u8def\u53ef\u5f97\uff1a$f_1(A, B) = \\displaystyle\\prod_{T = 1}^{\\min(A, B)} (\\prod_{d\\ |\\ T} d^{\\mu(\\frac{T}{d})})^{\\lfloor \\frac{A}{T} \\rfloor \\lfloor \\frac{B}{T} \\rfloor}$\u3002\n\n\u8bbe $f(n) = \\displaystyle\\prod_{d\\ |\\ n} d^{\\mu(\\frac{n}{d})}$\u3002\n\n\u2234$f_1(A, B) = \\displaystyle\\prod_{T = 1}^{\\min(A, B)} f(T)^{\\lfloor \\frac{A}{T} \\rfloor \\lfloor \\frac{B}{T} \\rfloor}$\u3002\n\n\u9884\u5904\u7406 $f$ \u7684\u524d\u7f00\u79ef\u53ca\u5176\u9006\u5143\u5373\u53ef\u3002\n\n2. $\\operatorname{type} = 1$\n\n\u8bbe $g(n) = \\displaystyle\\prod_{i = 1}^n i^i$\uff0c$f_2(A, B) = \\displaystyle\\prod_{i = 1}^A \\prod_{j = 1}^B \\gcd(i, j)^{ij}$\uff0c$S_1(n) = \\frac{1}{2} n (n + 1)$\u3002\n\n\u2234\u539f\u5f0f $= \\displaystyle\\frac{g(A)^{S_1(B) S_1(C)} g(B)^{S_1(A) S_1(C)}}{f_2(A, B)^{S_1(C)} f_2(A, C)^{S_1(B)}}$\n\n$f_2(A, B) = \\displaystyle\\prod_{i = 1}^A \\prod_{j = 1}^B \\gcd(i, j)^{ij}$\n\n$ = \\displaystyle\\prod_{d = 1}^{\\min(A, B)} d^{\\prod_{i = 1}^A \\prod_{j = 1}^B [\\gcd(i, j) = d] ij}$\n\n$ = \\displaystyle\\prod_{d = 1}^{\\min(A, B)} d^{\\sum_{p = 1}^{\\lfloor \\frac{\\min(A, B)}{d} \\rfloor} \\mu(p) \\lfloor \\frac{A}{dp} \\rfloor \\lfloor \\frac{B}{dp} \\rfloor}$\n\n$ = \\displaystyle\\prod_{T = 1}^{\\min(A, B)} (\\prod_{d\\ |\\ T} d^{\\mu(\\frac{T}{d})})^{S_1(\\lfloor \\frac{A}{T} \\rfloor) S_1(\\lfloor \\frac{B}{T} \\rfloor)}$\n\n$ = \\displaystyle\\prod_{T = 1}^{\\min(A, B)} f(T)^{S_1(\\lfloor \\frac{A}{T} \\rfloor) S_1(\\lfloor \\frac{B}{T} \\rfloor)}$\n\n3. $\\operatorname{type} = 2$\n\n\u8bbe $f_3(A, B, C) = \\displaystyle\\prod_{i = 1}^A \\prod_{j = 1}^B \\prod_{k = 1}^C i^{\\gcd(i, j, k)}$\uff0c$f_4(A, B, C) = \\displaystyle\\prod_{i = 1}^A \\prod_{j = 1}^B \\prod_{k = 1}^C \\gcd(i, j)^{\\gcd(i, j, k)}$\u3002\n\n\u2234\u539f\u5f0f $= \\displaystyle\\frac{f_3(A, B, C) f_3(B, A, C)}{f_4(A, B, C) f_4(A, C, B)}$\n\n$f_3(A, B, C) = \\displaystyle\\prod_{d = 1}^{\\min(A, B, C)} (\\prod_{d\\ |\\ i}^A i^d)^{\\varphi(d) \\lfloor \\frac{B}{d} \\rfloor \\lfloor \\frac{C}{d} \\rfloor}$\n\n$ = \\displaystyle\\prod_{d = 1}^{\\min(A, B, C)} (d^{\\lfloor \\frac{A}{d} \\rfloor} \\lfloor \\frac{A}{d} \\rfloor !)^{\\varphi(d) \\lfloor \\frac{B}{d} \\rfloor \\lfloor \\frac{C}{d} \\rfloor}$\n\n$ = \\displaystyle\\prod_{d = 1}^{\\min(A, B, C)} (d^{\\varphi(d)})^{\\lfloor \\frac{A}{d} \\rfloor \\lfloor \\frac{B}{d} \\rfloor \\lfloor \\frac{C}{d} \\rfloor} (\\lfloor \\frac{A}{d} \\rfloor !)^{\\varphi(d) \\lfloor \\frac{B}{d} \\rfloor \\lfloor \\frac{C}{d} \\rfloor}$\n\n**\u52a0\u6cb9\uff0c\u8fd9\u662f\u6700\u540e\u4e00\u4e2a~~\u7cbe\u795e\u6c61\u67d3~~\u7684\u5f0f\u5b50\u4e86\uff01**\n\n$f_4(A, B, C) = \\displaystyle\\prod_{d = 1}^{\\min(A, B)} d^{\\sum_{i = 1}^A \\sum_{j = 1}^B [\\gcd(i, j) = d] \\sum_{k = 1}^C \\gcd(d, k)}$\n\n$ = \\displaystyle\\prod_{d = 1}^{\\min(A, B)} d^{\\sum_{p = 1}^{\\lfloor \\frac{\\min(A, B)}{d} \\rfloor} \\mu(p) \\lfloor \\frac{A}{dp} \\rfloor \\lfloor \\frac{B}{dp} \\rfloor \\sum_{q\\ |\\ d} \\varphi(q) \\lfloor \\frac{C}{q} \\rfloor}$\n\n$ = \\displaystyle\\prod_{T = 1}^{\\min(A, B)} (\\prod_{d\\ |\\ T} d^{\\mu(\\frac{T}{d}) \\sum_{q\\ |\\ d} \\varphi(q) \\lfloor \\frac{C}{q} \\rfloor})^{\\lfloor \\frac{A}{T} \\rfloor \\lfloor \\frac{B}{T} \\rfloor}$\n\n\u8c8c\u4f3c\u6ca1\u6709\u4ec0\u4e48\u5316\u7b80\u7684\u65b9\u6cd5\u4e86\uff0c\u4f46\u4e2d\u95f4~~\u8fd9\u4e00\u5768~~\u53c8\u4e0d\u80fd\u9884\u5904\u7406\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u8003\u8651\u7384\u5b66\u65b9\u6cd5\u3002\n\n**\u9047\u5230\u8fd9\u79cd\u6bd2\u7624\u4e1c\u897f\uff0c\u53ef\u4ee5\u8003\u8651\u5c06 $d$ \u62c6\u5206\u6210 $q$ \u548c $\\frac{d}{q}$\uff0c\u5206\u522b\u8ba1\u7b97\u8d21\u732e\uff0c\u6700\u540e\u76f8\u4e58\u3002**\n\n$f_4(A, B, C) = \\displaystyle\\prod_{T = 1}^{\\min(A, B)} ((\\prod_{q\\ |\\ T} q^{\\varphi(q) \\lfloor \\frac{C}{q} \\rfloor \\sum_{d\\ |\\ \\frac{T}{q}} \\mu(\\frac{T}{dq})})(\\prod_{q\\ |\\ T} (\\prod_{q\\ |\\ d, d\\ |\\ T} (\\frac{d}{q})^{\\mu(\\frac{T}{d})})^{\\varphi(q) \\lfloor \\frac{C}{q} \\rfloor}))^{\\lfloor \\frac{A}{T} \\rfloor \\lfloor \\frac{B}{T} \\rfloor}$\n\n$ = \\displaystyle\\prod_{T = 1}^{\\min(A, B)} ((\\prod_{q\\ |\\ T} q^{\\varphi(q) \\lfloor \\frac{C}{q} \\rfloor  \\varepsilon(\\frac{T}{q})})(\\prod_{q\\ |\\ T} (\\prod_{q\\ |\\ d, d\\ |\\ T} (\\frac{d}{q})^{\\mu(\\frac{T}{d})})^{\\varphi(q) \\lfloor \\frac{C}{q} \\rfloor}))^{\\lfloor \\frac{A}{T} \\rfloor \\lfloor \\frac{B}{T} \\rfloor}$\n\n$ = \\displaystyle\\prod_{T = 1}^{\\min(A, B)} ((T^{\\varphi(T) \\lfloor \\frac{C}{T} \\rfloor})(\\prod_{q\\ |\\ T} (\\prod_{q\\ |\\ d, d\\ |\\ T} (\\frac{d}{q})^{\\mu(\\frac{T}{d})})^{\\varphi(q) \\lfloor \\frac{C}{q} \\rfloor}))^{\\lfloor \\frac{A}{T} \\rfloor \\lfloor \\frac{B}{T} \\rfloor}$\n\n\u7136\u540e\u5c31\u53d1\u73b0\u5de6\u8fb9\u90a3\u4e2a\u62ec\u53f7\u91cc\u7684\u4e1c\u897f\u53ef\u4ee5\u8ddf $f_3$ \u91cc\u7684\u4e00\u4e9b\u4e1c\u897f\u7ea6\u6389\uff01\n\n\u8bbe $f_3^{'}(A, B, C) = \\displaystyle\\prod_{d = 1}^{\\min(A, B, C)} (\\lfloor \\frac{A}{d} \\rfloor !)^{\\varphi(d) \\lfloor \\frac{B}{d} \\rfloor \\lfloor \\frac{C}{d} \\rfloor}$\uff0c$f_4^{'}(A, B, C) = \\displaystyle\\prod_{T = 1}^{\\min(A, B)} (\\prod_{q\\ |\\ T} (\\prod_{q\\ |\\ d, d\\ |\\ T} (\\frac{d}{q})^{\\mu(\\frac{T}{d})})^{\\varphi(q) \\lfloor \\frac{C}{q} \\rfloor})^{\\lfloor \\frac{A}{T} \\rfloor \\lfloor \\frac{B}{T} \\rfloor}$\u3002\n\n\u9884\u5904\u7406 $\\varphi$ \u524d\u7f00\u548c\u5373\u53ef\u3002\n\n\u2234\u539f\u5f0f $= \\displaystyle\\frac{f_3^{'}(A, B, C) f_3^{'}(B, A, C)}{f_4^{'}(A, B, C) f_4^{'}(A, C, B)}$\n\n$f_4^{'}(A, B, C) = \\displaystyle\\prod_{T = 1}^{\\min(A, B)} (\\prod_{q\\ |\\ T} (\\prod_{q\\ |\\ d, d\\ |\\ T} (\\frac{d}{q})^{\\mu(\\frac{T}{d})})^{\\varphi(q) \\lfloor \\frac{C}{q} \\rfloor})^{\\lfloor \\frac{A}{T} \\rfloor \\lfloor \\frac{B}{T} \\rfloor}$\n\n$ = \\displaystyle\\prod_{q = 1}^{\\min(A, B, C)} (\\prod_{q\\ |\\ d}^{\\min(A, B, C)} (\\frac{d}{q})^{\\sum_{d\\ |\\ T}^{\\min(A, B, C)} \\mu(\\frac{T}{d}) \\lfloor \\frac{A}{T} \\rfloor \\lfloor \\frac{B}{T} \\rfloor})^{\\varphi(q) \\lfloor \\frac{C}{q} \\rfloor}$\n\n$ = \\displaystyle\\prod_{q = 1}^{\\min(A, B, C)} (\\prod_{q\\ |\\ d}^{\\min(A, B, C)} (\\frac{d}{q})^{\\sum_{T = 1}^{\\lfloor \\frac{\\min(A, B, C)}{d} \\rfloor} \\mu(T) \\lfloor \\frac{A}{dT} \\rfloor \\lfloor \\frac{B}{dT} \\rfloor})^{\\varphi(q) \\lfloor \\frac{C}{q} \\rfloor}$\n\n$ = \\displaystyle\\prod_{q = 1}^{\\min(A, B, C)} (\\prod_{d = 1}^{\\lfloor \\frac{\\min(A, B, C)}{q} \\rfloor} d^{\\sum_{T = 1}^{\\lfloor \\frac{\\min(A, B, C)}{dq} \\rfloor} \\mu(T) \\lfloor \\frac{A}{dqT} \\rfloor \\lfloor \\frac{B}{dqT} \\rfloor})^{\\varphi(q) \\lfloor \\frac{C}{q} \\rfloor}$\n\n$ = \\displaystyle\\prod_{q = 1}^{\\min(A, B, C)} (\\prod_{d = 1}^{\\lfloor \\frac{\\min(A, B, C)}{q} \\rfloor} d^{\\sum_{T = 1}^{\\lfloor \\frac{\\min(A, B, C)}{dq} \\rfloor} \\mu(T) \\lfloor \\frac{A}{dqT} \\rfloor \\lfloor \\frac{B}{dqT} \\rfloor})^{\\varphi(q) \\lfloor \\frac{C}{q} \\rfloor}$\n\n$ = \\displaystyle\\prod_{q = 1}^{\\min(A, B, C)} (\\prod_{U = 1}^{\\lfloor \\frac{\\min(A, B, C)}{q} \\rfloor} (\\prod_{d\\ |\\ U} d^{\\mu(\\frac{U}{d})})^{\\lfloor \\frac{A}{U} \\rfloor \\lfloor \\frac{B}{U} \\rfloor})^{\\varphi(q) \\lfloor \\frac{C}{q} \\rfloor}$\n\n$ = \\displaystyle\\prod_{q = 1}^{\\min(A, B, C)} f_1(\\lfloor \\frac{A}{q} \\rfloor, \\lfloor \\frac{B}{q} \\rfloor) ^{\\varphi(q) \\lfloor \\frac{C}{q} \\rfloor}$\n\n\u7efc\u4e0a\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(Tn^{\\frac{3}{4}} \\log p + N \\ln N + N \\log p)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <stdio.h>\n\ntypedef long long ll;\n\nconst int N = 1e5 + 7;\nint mod;\nint prime[N], phi[N], mu[N];\nll sum[N], fac[N], f[N], g[N], product1[N], inv_product1[N], product2[N], inv_product2[N];\nbool p[N];\n\ninline ll quick_pow(ll x, ll p, ll mod){\n\tll ans = 1;\n\twhile (p){\n\t\tif (p & 1) ans = ans * x % mod;\n\t\tx = x * x % mod;\n\t\tp >>= 1;\n\t}\n\treturn ans;\n}\n\ninline void init(int mod){\n\tint cnt = 0;\n\tp[0] = p[1] = true;\n\tphi[1] = 1;\n\tmu[1] = 1;\n\tfor (register int i = 2; i < N; i++){\n\t\tif (!p[i]){\n\t\t\tprime[++cnt] = i;\n\t\t\tphi[i] = i - 1;\n\t\t\tmu[i] = -1;\n\t\t}\n\t\tfor (register int j = 1; j <= cnt && i * prime[j] < N; j++){\n\t\t\tint t = i * prime[j];\n\t\t\tp[t] = true;\n\t\t\tif (i % prime[j] == 0){\n\t\t\t\tphi[t] = phi[i] * prime[j];\n\t\t\t\tmu[t] = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[t] = phi[i] * (prime[j] - 1);\n\t\t\tmu[t] = -mu[i];\n\t\t}\n\t}\n\tfor (register int i = 1; i < N; i++){\n\t\tsum[i] = sum[i - 1] + phi[i];\n\t}\n\tfac[0] = 1;\n\tfor (register int i = 1; i < N; i++){\n\t\tfac[i] = fac[i - 1] * i % mod;\n\t}\n\tfor (register int i = 1; i < N; i++){\n\t\tf[i] = 1;\n\t}\n\tfor (register int i = 1; i < N; i++){\n\t\tif (mu[i] == 0) continue;\n\t\tfor (register int j = i; j < N; j += i){\n\t\t\tf[j] = f[j] * (mu[i] == 1 ? j / i : quick_pow(j / i, mod - 2, mod)) % mod;\n\t\t}\n\t}\n\tg[0] = 1;\n\tfor (register int i = 1; i < N; i++){\n\t\tg[i] = g[i - 1] * quick_pow(i, i, mod) % mod;\n\t}\n\tproduct1[0] = product2[0] = 1;\n\tinv_product1[0] = inv_product2[0] = 1;\n\tfor (register int i = 1; i < N; i++){\n\t\tproduct1[i] = product1[i - 1] * f[i] % mod;\n\t\tinv_product1[i] = quick_pow(product1[i], mod - 2, mod);\n\t\tproduct2[i] = product2[i - 1] * quick_pow(f[i], (ll)i * i % (mod - 1), mod) % mod;\n\t\tinv_product2[i] = quick_pow(product2[i], mod - 2, mod);\n\t}\n}\n\ninline int min(int a, int b){\n\treturn a < b ? a : b;\n}\n\ninline ll func1(int a, int b, int mod){\n\tint ab = min(a, b);\n\tll ans = 1;\n\tfor (register int i = 1, j; i <= ab; i = j + 1){\n\t\tint ta = a / i, tb = b / i;\n\t\tj = min(a / ta, b / tb);\n\t\tans = ans * quick_pow(inv_product1[i - 1] * product1[j] % mod, (ll)ta * tb % (mod - 1), mod) % mod;\n\t}\n\treturn ans;\n}\n\ninline ll solve1(int a, int b, int c, int mod){\n\treturn quick_pow(fac[a], (ll)b * c % (mod - 1), mod) * quick_pow(fac[b], (ll)a * c % (mod - 1), mod) % mod * quick_pow(quick_pow(func1(a, b, mod), c, mod) % mod * quick_pow(func1(a, c, mod), b, mod) % mod, mod - 2, mod) % mod;\n}\n\ninline ll sum1(int n){\n\treturn (ll)n * (n + 1) / 2;\n}\n\ninline ll func2(int a, int b, int mod){\n\tint ab = min(a, b);\n\tll ans = 1;\n\tfor (register int i = 1, j; i <= ab; i = j + 1){\n\t\tint ta = a / i, tb = b / i;\n\t\tj = min(a / ta, b / tb);\n\t\tans = ans * quick_pow(inv_product2[i - 1] * product2[j] % mod, sum1(ta) % (mod - 1) * sum1(tb) % (mod - 1), mod) % mod;\n\t}\n\treturn ans;\n}\n\ninline ll solve2(int a, int b, int c, int mod){\n\treturn quick_pow(g[a], sum1(b) % (mod - 1) * sum1(c) % (mod - 1), mod) * quick_pow(g[b], sum1(a) % (mod - 1) * sum1(c) % (mod - 1), mod) % mod * quick_pow(quick_pow(func2(a, b, mod), sum1(c), mod) % mod * quick_pow(func2(a, c, mod), sum1(b), mod) % mod, mod - 2, mod) % mod;\n}\n\ninline ll func3(int a, int b, int c, int mod){\n\tint abc = min(a, min(b, c));\n\tll ans = 1;\n\tfor (register int i = 1, j; i <= abc; i = j + 1){\n\t\tint ta = a / i, tb = b / i, tc = c / i;\n\t\tj = min(a / ta, min(b / tb, c / tc));\n\t\tans = ans * quick_pow(fac[ta], (ll)tb * tc % (mod - 1) * (sum[j] - sum[i - 1]) % (mod - 1), mod) % mod;\n\t}\n\treturn ans;\n}\n\ninline ll func4(int a, int b, int c, int mod){\n\tint abc = min(a, min(b, c));\n\tll ans = 1;\n\tfor (register int i = 1, j; i <= abc; i = j + 1){\n\t\tint ta = a / i, tb = b / i, tc = c / i;\n\t\tj = min(a / ta, min(b / tb, c / tc));\n\t\tans = ans * quick_pow(func1(ta, tb, mod), tc * (sum[j] - sum[i - 1]) % (mod - 1), mod) % mod;\n\t}\n\treturn ans;\n}\n\ninline ll solve3(int a, int b, int c, int mod){\n\treturn func3(a, b, c, mod) * func3(b, a, c, mod) % mod * quick_pow(func4(a, b, c, mod) * func4(a, c, b, mod) % mod, mod - 2, mod) % mod;\n}\n\nint main(){\n\tint t, p;\n\tscanf(\"%d %d\", &t, &p);\n\tinit(p);\n\tfor (register int i = 1; i <= t; i++){\n\t\tint a, b, c;\n\t\tscanf(\"%d %d %d\", &a, &b, &c);\n\t\tprintf(\"%lld %lld %lld\\n\", solve1(a, b, c, p), solve2(a, b, c, p), solve3(a, b, c, p));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1616129184,
        "uid": 201007,
        "name": "Leasier",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5518 \u3010[MtOI2019] \u5e7d\u7075\u4e50\u56e2 / \u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u57fa\u7840\u7ec3\u4e60\u9898\u3011"
    },
    {
        "content": "\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff1a[\u6211\u7684 Blog](https://www.cnblogs.com/luckyblock/p/13975070.html)\u3002  \n\u626f\u4e00\u53e5\uff0c\u9898\u9762\u91cc\u5c06\u9732\u5a1c\u8428\uff08Lunasa\uff09\u8bef\u5199\u6210\u4e86 Lusana\uff0c\u4e0d\u4eba\u6c14\u59d0\u59b9\u8fde\u540d\u5b57\u90fd\u4e0d\u914d\u62e5\u6709\uff08  \n\n## \u7b80\u8ff0\n\n\u539f\u9898\u9762\uff1a[Luogu](https://www.luogu.com.cn/problem/P5518)\n\n>\u7ed9\u5b9a\u53c2\u6570 $p$\uff0c\u6709 $T$ \u7ec4\u6570\u636e\uff0c\u6bcf\u6b21\u7ed9\u5b9a\u53c2\u6570 $A,B,C$\uff0c\u6c42\uff1a  \n>$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C}\\left(\\dfrac{\\operatorname{lcm}(i,j)}{\\gcd(i,k)}\\right)^{f(type)}\\pmod p$$  \n>\u5176\u4e2d $f(type)$ \u7684\u53d6\u503c\u5982\u4e0b\uff1a  \n>$$f(type) = \\begin{cases}\n   1 &type = 0\\\\\n   i\\times j\\times k &type = 1\\\\\n   \\gcd(i,j,k) &type = 2\n\\end{cases}$$  \n>$1\\le A,B,C\\le 10^5$\uff0c$10^7\\le p\\le 1.05\\times 10^9$\uff0c$p\\in \\mathbb{P}$\uff0c$T=70$\u3002  \n>2.5S\uff0c128MB\u3002\n\n## \u5206\u6790\n\n### \u539f\u5f0f\n\n\u5148\u5316\u4e0b\u539f\u5f0f\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a  \n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C}\\left(\\dfrac{i\\times j }{\\gcd(i,j)\\times \\gcd(i,k)}\\right)^{f(type)}$$ \n\n\u53d1\u73b0\u6bcf\u4e00\u9879\u4ec5\u4e0e\u4e24\u4e2a\u53d8\u91cf\u6709\u5173\uff0c\u8bbe\uff1a  \n$$\\begin{aligned}\n  f_1(a,b,c) &= \\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} i^{f(type)}\\\\\n  f_2(a,b,c) &= \\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} \\gcd(i,j)^{f(type)}\n\\end{aligned}$$\n\u53d1\u73b0 $\\prod$ \u53ef\u4ee5\u968f\u610f\u4ea4\u6362\uff0c\u5219\u539f\u5f0f\u7b49\u4ef7\u4e8e\uff1a  \n\n$$\\dfrac{f_1(a,b,c)\\times f_1(b,a,c)}{f_2(a,b,c)\\times f_2(a,c,b)}$$\n\n\u8003\u8651\u5728 $type$ \u53d6\u503c\u4e0d\u540c\u65f6\uff0c\u5982\u4f55\u5feb\u901f\u6c42\u5f97 $f_1$ \u4e0e $f_2$\u3002  \n\u4e00\u5171\u6709 $6$ \u4e2a\u9700\u8981\u63a8\u5bfc\u7684\u5f0f\u5b50\uff0c\u4e0d\u59a8\u5c31\u53eb\u5b83\u4eec $1\\sim 6$ \u9762\u4e86\uff08\n\n---\n\n### type = 0\n\n$$\\begin{aligned}\n  f_1(a,b,c) &= \\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} i\\\\\n  f_2(a,b,c) &= \\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} \\gcd(i,j)\n\\end{aligned}$$\n\n\u5bf9\u4e8e 1 \u9762\uff0c\u663e\u7136\u6709\uff1a  \n\n$$\\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} i = \\left(\\prod_{i=1}^{a}i\\right)^{b\\times c}$$  \n\n\u9884\u5904\u7406\u9636\u4e58 + \u5feb\u901f\u5e42\u5373\u53ef\uff0c\u5355\u6b21\u8ba1\u7b97\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\log n)$\u3002  \n\n---\n\n\u518d\u8003\u8651 2 \u9762\uff0c\u5957\u8def\u5730\u679a\u4e3e $\\gcd$\uff0c\u663e\u7136\u6709\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} \\gcd(i,j)\\\\\n  =&\\left(\\prod_{i=1}^{a}\\prod_{j=1}^{b}\\gcd(i,j)\\right)^c\\\\\n  =& \\left(\\prod_{d=1} d^{\\left(\\sum\\limits_{i=1}^{a}\\sum\\limits_{j=1}^{b}[\\gcd(i,j) = d]\\right)}\\right)^c\n\\end{aligned}$$\n\n\u6307\u6570\u662f\u4e2a\u5957\u8def\uff0c\u53ef\u4ee5\u770b\u8fd9\u91cc\uff1a[P3455 [POI2007]ZAP-Queries](https://www.luogu.com.cn/problem/P3455)\u3002\u4e8e\u662f\u6709\uff1a  \n\n$$\\begin{aligned}\n  &\\sum\\limits_{i=1}^{a}\\sum\\limits_{j=1}^{b}[\\gcd(i,j) = d]\\\\\n  =& \\sum\\limits_{i=1}^{\\left\\lfloor\\frac{a}{d}\\right\\rfloor}\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{b}{d}\\right\\rfloor}[\\gcd(i,j) = 1]\\\\\n  =& \\sum\\limits_{i=1}^{\\left\\lfloor\\frac{a}{d}\\right\\rfloor}\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{b}{d}\\right\\rfloor}\\sum_{k\\mid \\gcd(i,j)}\\mu (k)\\\\\n  =& \\sum_{k=1}\\mu(k)\\left\\lfloor\\dfrac{a}{kd}\\right\\rfloor\\left\\lfloor\\dfrac{b}{kd}\\right\\rfloor\n\\end{aligned}$$  \n\n\u4ee3\u56de\u539f\u5f0f\uff0c\u7565\u505a\u5904\u7406\uff0c\u5219\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\left(\\prod_{d=1} d^{\\left(\\sum\\limits_{k=1}\\mu(k)\\left\\lfloor\\frac{a}{kd}\\right\\rfloor\\left\\lfloor\\frac{b}{kd}\\right\\rfloor\\right)}\\right)^c\\\\\n  =& \\left(\\prod_{d=1} \\left(d^{\\sum\\limits_{k=1}\\mu(k)}\\right)^{\\left\\lfloor\\frac{a}{kd}\\right\\rfloor\\left\\lfloor\\frac{b}{kd}\\right\\rfloor}\\right)^c\\\\\n  =& \\prod_{d=1} \\left(\\prod_{k=1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor}d^{\\left(\\mu(k)\\left\\lfloor\\frac{a}{kd}\\right\\rfloor\\left\\lfloor\\frac{b}{kd}\\right\\rfloor\\right)}\\right)^c\n\\end{aligned}$$\n\n\u50cf[\u300cSDOI2017\u300d\u6570\u5b57\u8868\u683c](https://www.cnblogs.com/luckyblock/p/13966454.html) \u4e00\u6837\uff0c\u8003\u8651\u679a\u4e3e $t=kd$ \u548c $d$\uff0c\u5219\u539f\u5f0f\u7b49\u4e8e\uff1a\n\n$$\\large \\prod_{t=1}^{n}\\left(\\left(\\prod_{d|t} d^{\\mu{\\left(\\frac{t}{d}\\right)}}\\right)^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\left\\lfloor\\frac{b}{t}\\right\\rfloor}\\right)^c$$\n\n\u8bbe\uff1a  \n$$\\large g_0(t) = \\prod_{d|t}d^{\\mu\\left(\\frac{t}{d}\\right)}$$\n\n\u7ebf\u6027\u7b5b\u9884\u5904\u7406 $\\mu$ \u540e\uff0c$g_0(t)$ \u53ef\u4ee5\u7528\u57c3\u6c0f\u7b5b\u9884\u5904\u7406\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\u518d\u4ee3\u56de\u539f\u5f0f\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a\n\n$$\\large \\prod_{t=1}^{a}\\left(g_0(t)^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\left\\lfloor\\frac{b}{t}\\right\\rfloor}\\right)^c$$\n\n\u9884\u5904\u7406 $g_0(t)$ \u7684\u524d\u7f00\u79ef\u548c\u524d\u7f00\u79ef\u7684\u9006\u5143\uff0c\u590d\u6742\u5ea6 $O(n\\log n)$\u3002  \n\u6570\u8bba\u5206\u5757 + \u5feb\u901f\u5e42\u8ba1\u7b97\u5373\u53ef\uff0c\u5355\u6b21\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\sqrt n\\log n)$\u3002\n\n---\n\n### type = 1\n\n$$\\begin{aligned}\n  f_1(a,b,c) &= \\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} i^{i\\times j\\times k}\\\\\n  f_2(a,b,c) &= \\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} \\gcd(i,j)^{i\\times j\\times k}\n\\end{aligned}$$\n\n\u8003\u8651 3 \u9762\uff0c\u628a $\\prod k$ \u6254\u5230\u6307\u6570\u4f4d\u7f6e\uff0c\u6709\uff1a  \n\n$$\\large \\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} i^{i\\times j\\times k} = \\prod_{i=1}^{a}\\prod_{j=1}^{b}i^{\\left(i\\times j\\times \\sum\\limits_{k = 1}^{c} k\\right)}$$\n  \n\u518d\u628a $\\prod j$ \u4e5f\u6254\u5230\u6307\u6570\u4f4d\u7f6e\uff0c\u5f15\u5165 $\\operatorname{sum}(n) = \\sum_{i=1}^{n} i = \\frac{n(n+1)}{2}$\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\left(\\prod_{i=1}^{a}i^i\\right)^{\\operatorname{sum}(b)\\times \\operatorname{sum}(c)}$$\n\n\u9884\u5904\u7406 $i^i$ \u7684\u524d\u7f00\u79ef\uff0c\u590d\u6742\u5ea6 $O(n\\log n)$\u3002  \n\u6307\u6570\u53ef\u4ee5 $O(1)$ \u7b97\u51fa\uff0c\u7136\u540e\u5feb\u901f\u5e42\uff0c\u5355\u6b21\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\log n)$\u3002  \n\n\u6839\u636e\u8d39\u9a6c\u5c0f\u5b9a\u7406\uff0c\u6307\u6570\u9700\u8981\u5bf9 $p - 1$ \u53d6\u6a21\u3002\u6ce8\u610f $p-1$ \u4e0d\u662f\u8d28\u6570\uff0c\u8ba1\u7b97 $\\operatorname{sum}$ \u65f6\u4e0d\u80fd\u7528\u9006\u5143\uff0c\u4f46\u4e58\u4e0d\u7206 `LL`\uff0c\u76f4\u63a5\u7b97\u5c31\u884c\u3002\n\n---\n\n\u518d\u8003\u8651 4 \u9762\uff0c\u53d1\u73b0 $k$ \u4e0e $\\gcd$ \u65e0\u5173\uff0c\u5219\u540c\u6837\u628a $\\prod k$ \u6254\u5230\u6307\u6570\u4f4d\u7f6e\uff0c\u5219\u6709\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} \\gcd(i,j)^{i\\times j\\times k}\\\\\n  =& \\left(\\prod_{i=1}^a\\prod_{j=1}^b\\gcd(i,j)^{i\\times j}\\right)^{\\operatorname{sum}(c)}\n\\end{aligned}$$\n\n\u5957\u8def\u5730\u679a\u4e3e $\\gcd$\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\large \\left(\\prod_{d=1}d^{\\left(\\sum\\limits_{i=1}^a \\sum\\limits_{j=1}^b i\\times j[\\gcd(i,j)=d]\\right)}\\right)^{\\operatorname{sum}(c)}$$\n\n\u5927\u529b\u5316\u7b80\u6307\u6570\uff0c\u6709\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\sum\\limits_{i=1}^a \\sum\\limits_{j=1}^b i\\times j[\\gcd(i,j)=d]\\\\\n  =& d^2 \\sum\\limits_{i=1}^{\\left\\lfloor\\frac{a}{d}\\right\\rfloor} \\sum\\limits_{j=1}^{\\left\\lfloor\\frac{b}{d}\\right\\rfloor} i\\times j[\\gcd(i,j)=1\\\\\n  =& d^2 \\sum\\limits_{i=1}^{\\left\\lfloor\\frac{a}{d}\\right\\rfloor} i \\sum\\limits_{j=1}^{\\left\\lfloor\\frac{b}{d}\\right\\rfloor} j\\sum\\limits_{t|\\gcd(i,j)}\\mu(t)\\\\\n  =& d^2 \\sum\\limits_{i=1}^{\\left\\lfloor\\frac{a}{d}\\right\\rfloor} i \\sum\\limits_{j=1}^{\\left\\lfloor\\frac{b}{d}\\right\\rfloor} j\\sum\\limits_{k|\\gcd(i,j)}\\mu(k)\\\\\n  =& d^2 \\sum\\limits_{k=1}\\mu(k)\\sum\\limits_{i=1}^{\\left\\lfloor\\frac{a}{d}\\right\\rfloor} i[k|i] \\sum\\limits_{j=1}^{\\left\\lfloor\\frac{b}{d}\\right\\rfloor} j[k|j]\\\\\n  =& d^2 \\sum\\limits_{k=1}k^2\\mu(k)\\sum\\limits_{i=1}^{\\left\\lfloor\\frac{a}{kd}\\right\\rfloor} i\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{b}{kd}\\right\\rfloor} j\\\\\n  =& d^2\\sum\\limits_{k=1}k^2\\mu(k)\\operatorname{sum}{\\left(\\left\\lfloor\\frac{a}{kd}\\right\\rfloor\\right)} \\operatorname{sum}{\\left(\\left\\lfloor\\frac{b}{kd}\\right\\rfloor\\right)}\\\\\n\\end{aligned}$$\n\n\u6307\u6570\u5316\u4e0d\u52a8\u4e86\uff0c\u4ee3\u56de\u539f\u5f0f\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\large \\left(\\prod_{d=1}d^{\\left(d^2\\sum\\limits_{k=1}k^2\\mu(k)\\operatorname{sum}{\\left(\\left\\lfloor\\frac{a}{kd}\\right\\rfloor\\right)} \\operatorname{sum}{\\left(\\left\\lfloor\\frac{b}{kd}\\right\\rfloor\\right)}\\right)}\\right)^{\\operatorname{sum}(c)}$$\n\n\u540c 2 \u9762\u7684\u60c5\u51b5\uff0c\u5148\u5c55\u5f00\u4e00\u4e0b\uff0c\u518d\u679a\u4e3e $t=kd$ \u548c $d$\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\left(\\prod_{d=1}\\left(\\prod_{k=1}^{\\left\\lfloor\\frac{n}{d}\\right\\rfloor}d^{\\left(d^2 k^2\\mu(k)\\right)}\\right)^{\\left(\\operatorname{sum}{\\left(\\left\\lfloor\\frac{a}{kd}\\right\\rfloor\\right)} \\operatorname{sum}{\\left(\\left\\lfloor\\frac{b}{kd}\\right\\rfloor\\right)}\\right)}\\right)^{\\operatorname{sum}(c)}\\\\\n  =& \\prod_{t=1}\\left(\\left(\\prod_{d|t}d^{\\left(d^2\\left(\\frac{t}{d}\\right)^2\\mu\\left(\\frac{t}{d}\\right)\\right)}\\right)^{\\operatorname{sum}{\\left(\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\right)} \\operatorname{sum}{\\left(\\left\\lfloor\\frac{b}{t}\\right\\rfloor\\right)}}\\right)^{\\operatorname{sum}(c)}\\\\\n  =& \\prod_{t=1}\\left(\\left(\\prod_{d|t}d^{\\left(t^2\\mu\\left(\\frac{t}{d}\\right)\\right)}\\right)^{\\operatorname{sum}{\\left(\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\right)} \\operatorname{sum}{\\left(\\left\\lfloor\\frac{b}{t}\\right\\rfloor\\right)}}\\right)^{\\operatorname{sum}(c)}\n\\end{aligned}$$\n\n\u4e0e\u4e8c\u9762\u76f8\u540c\uff0c\u8bbe\uff1a  \n\n$$\\large g_1(t) = \\prod_{d|t}d^{\\left(t^2\\mu\\left(\\frac{t}{d}\\right)\\right)}$$\n\n$g_1(t)$ \u53ef\u4ee5\u7528\u57c3\u6c0f\u7b5b\u5957\u5feb\u901f\u5e42\u7b5b\u51fa\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2 n)$\u3002\u518d\u4ee3\u56de\u539f\u5f0f\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\prod_{t=1}\\left(g_1(t)^{\\operatorname{sum}{\\left(\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\right)} \\operatorname{sum}{\\left(\\left\\lfloor\\frac{b}{t}\\right\\rfloor\\right)}}\\right)^{\\operatorname{sum}(c)}$$\n\n\u540c\u6837\u9884\u5904\u7406 $g_1(t)$ \u7684\u524d\u7f00\u79ef\u53ca\u5176\u9006\u5143\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002  \n\u6574\u9664\u5206\u5757 + \u5feb\u901f\u5e42\u5373\u53ef\uff0c\u5355\u6b21\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\sqrt n\\log n)$\u3002  \n\n\u6ce8\u610f\u6307\u6570\u7684\u53d6\u6a21\u3002\n\n---\n\n### type = 2\n\n$$\\begin{aligned}\n  f_1(a,b,c) &= \\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} i^{\\gcd(i,j,k)}\\\\\n  f_2(a,b,c) &= \\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} \\gcd(i,j)^{\\gcd(i,j,k)}\n\\end{aligned}$$\n\n\u8003\u8651 5 \u9762\uff0c\u624b\u6bb5\u540c\u4e0a\uff0c\u5927\u529b\u53cd\u6f14\u5316\u7b80\u4e00\u6ce2\uff0c\u518d\u8c03\u6362\u679a\u4e3e\u5bf9\u8c61\uff0c\u5219\u6709\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} i^{\\gcd(i,j,k)}\\\\\n  =&\\prod_{d=1}\\prod\\limits_{i=1}^{a}i^{\\left(\\sum\\limits_{j=1}^{b}\\sum\\limits_{k=1}^{c}[\\gcd(i,j,k)=d]\\right)}\\\\\n  =& \\prod_{d=1}\\prod\\limits_{i=1}^{a}i^{\\left(\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{b}{d}\\right\\rfloor}\\sum\\limits_{k=1}^{\\left\\lfloor\\frac{c}{d}\\right\\rfloor}[\\gcd(\\frac{i}{d},j,k)=1]\\right)}\\\\\n  =& \\prod_{d=1}\\prod\\limits_{i=1}^{\\left\\lfloor\\frac{a}{d}\\right\\rfloor}(id)^{\\left(d\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{b}{d}\\right\\rfloor}\\sum\\limits_{k=1}^{\\left\\lfloor\\frac{c}{d}\\right\\rfloor}[\\gcd(i,j,k)=1]\\right)}\\\\\n  =& \\prod_{d=1}\\prod\\limits_{i=1}^{\\left\\lfloor\\frac{a}{d}\\right\\rfloor}(id)^{\\left(d\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{b}{d}\\right\\rfloor}\\sum\\limits_{k=1}^{\\left\\lfloor\\frac{c}{d}\\right\\rfloor}\\sum\\limits_{x|\\gcd(i,j,k)}{\\mu(x)}\\right)}\\\\\n  =& \\prod_{d=1}\\prod\\limits_{i=1}^{\\left\\lfloor\\frac{a}{d}\\right\\rfloor}(id)^{\\left(d\\sum\\limits_{x=1}\\mu(x)[x|i]\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{b}{d}\\right\\rfloor}[x|j]\\sum\\limits_{k=1}^{\\left\\lfloor\\frac{c}{d}\\right\\rfloor}[x|k]\\right)}\\\\\n  =& \\prod_{d=1}\\prod_{x=1}\\prod\\limits_{i=1}^{\\left\\lfloor\\frac{a}{d}\\right\\rfloor}(id)^{\\left(d\\times \\mu(x)[x|i]\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{b}{d}\\right\\rfloor}[x|j]\\sum\\limits_{k=1}^{\\left\\lfloor\\frac{c}{d}\\right\\rfloor}[x|k]\\right)}\\\\\n  =& \\prod_{d=1}\\prod_{x=1}\\prod\\limits_{i=1}^{\\left\\lfloor\\frac{a}{xd}\\right\\rfloor}(ixd)^{\\left(d\\times \\mu(x){\\left\\lfloor\\frac{b}{xd}\\right\\rfloor}{\\left\\lfloor\\frac{c}{xd}\\right\\rfloor}\\right)}\\\\\n  =& \\prod_{t = 1}\\prod_{d|T}\\prod_{i=1}^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor}(it)^{\\left(d\\times \\mu\\left(\\frac{t}{d}\\right){\\left\\lfloor\\frac{b}{t}\\right\\rfloor}{\\left\\lfloor\\frac{c}{t}\\right\\rfloor}\\right)}\\\\\n  =& \\prod_{t = 1}\\prod_{d|T}\\left(t^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor}\\prod_{i=1}^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor}i\\right)^{d\\times \\mu\\left(\\frac{t}{d}\\right){\\left\\lfloor\\frac{b}{t}\\right\\rfloor}{\\left\\lfloor\\frac{c}{t}\\right\\rfloor}}\\\\\n\\end{aligned}$$\n\n\u5f15\u5165 $\\operatorname{fac}(n) = \\prod_{i=1}^{n} i$\uff0c\u518d\u6839\u636e\u679a\u4e3e\u5bf9\u8c61\u8c03\u6574\u4e00\u4e0b\u6307\u6570\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\prod_{t = 1}\\prod_{d|t}\\left(t^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor}\\times \\operatorname{fac}\\left(\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\right)\\right)^{\\left(d\\times \\mu\\left(\\frac{t}{d}\\right){\\left\\lfloor\\frac{b}{t}\\right\\rfloor}{\\left\\lfloor\\frac{c}{t}\\right\\rfloor}\\right)}\\\\\n  =& \\prod_{t = 1}\\left(\\prod_{d|t}\\left(t^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor}\\times \\operatorname{fac}\\left(\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\right)\\right)^{d\\times \\mu\\left(\\frac{t}{d}\\right)}\\right)^{{\\left\\lfloor\\frac{b}{t}\\right\\rfloor}{\\left\\lfloor\\frac{c}{t}\\right\\rfloor}}\\\\\n  =& \\prod_{t = 1}\\left(\\left(t^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor}\\times \\operatorname{fac}\\left(\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\right)\\right)^{\\sum\\limits_{d|t}d\\times \\mu\\left(\\frac{t}{d}\\right)}\\right)^{{\\left\\lfloor\\frac{b}{t}\\right\\rfloor}{\\left\\lfloor\\frac{c}{t}\\right\\rfloor}}\n\\end{aligned}$$\n\n\u6307\u6570\u4e2d\u51fa\u73b0\u4e86\u4e00\u4e2a\u7ecf\u5178\u7684\u72c4\u5229\u514b\u96f7\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u5bf9\u5176\u8fdb\u884c\u53cd\u6f14\u3002  \n\u5c06 $(\\operatorname{Id}\\ast \\mu) (n)= \\varphi (n)$ \u4ee3\u5165\u539f\u5f0f\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\prod_{t = 1}\\left(t^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor}\\times \\operatorname{fac}\\left(\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\right)\\right)^{\\varphi(t){\\left\\lfloor\\frac{b}{t}\\right\\rfloor}{\\left\\lfloor\\frac{c}{t}\\right\\rfloor}}\\\\\n  =& \\prod_{t = 1}\\left(t^{\\varphi(t)\\left\\lfloor\\frac{a}{t}\\right\\rfloor{\\left\\lfloor\\frac{b}{t}\\right\\rfloor}{\\left\\lfloor\\frac{c}{t}\\right\\rfloor}}\\times \\operatorname{fac}\\left(\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\right)^{\\varphi(t){\\left\\lfloor\\frac{b}{t}\\right\\rfloor}{\\left\\lfloor\\frac{c}{t}\\right\\rfloor}}\\right)\n\\end{aligned}$$\n\n\u9884\u5904\u7406 $t^{\\varphi(t)}$ \u7684\u524d\u7f00\u79ef\u53ca\u9006\u5143\uff0c\u9636\u4e58\u7684\u524d\u7f00\u79ef\u53ca\u9636\u4e58\u9006\u5143\uff0c$\\pmod {p-1}$ \u4e0b\u7684 $\\varphi(t)$ \u7684\u524d\u7f00\u548c\uff08\u6307\u6570\n\uff09\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002  \n\u540c\u6837\u6574\u9664\u5206\u5757 + \u5feb\u901f\u5e42\u5373\u53ef\uff0c\u5355\u6b21\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\sqrt n\\log n)$\u3002\n\n---\n\n\u7136\u540e\u662f\u6700\u6389 sans \u7684 6 \u9762\u3002\u6709 $\\gcd(i,j,k) = \\gcd(\\gcd(i,j), k)$\uff0c\u8003\u8651\u5148\u679a\u4e3e $\\gcd(i,j)$\uff0c\u7136\u540e\u5957\u8def\u5316\u5f0f\u5b50\uff0c\u5219\u6709\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} \\gcd(i,j)^{\\gcd(i,j,k)}\\\\\n  =& \\prod_{d=1}\\prod_{i=1}^{a}\\prod_{j=1}^{b}\\prod_{k=1}^{c} [\\gcd(i,j)=d] d^{\\gcd(d,k)}\\\\\n  =& \\prod_{d=1} \\left(d^{\\left(\\sum\\limits_{i=1}^{a}\\sum\\limits_{j=1}^{b} [\\gcd(i,j)=d]\\right)}\\right)^{\\sum\\limits_{k=1}^{c}\\gcd(d,k)}\n\\end{aligned}$$\n\n\u5148\u8003\u8651\u6700\u5916\u9762\u7684\u6307\u6570\uff0c\u8fd9\u4e5f\u662f\u4e2a\u5957\u8def\uff0c\u53ef\u4ee5\u53c2\u8003 [\u4e00\u4e2a\u4f8b\u5b50](https://www.cnblogs.com/luckyblock/p/12654760.html#%E4%BE%8B-1)\u3002\u7528 $\\operatorname{Id} = \\varphi \\ast 1$ \u53cd\u6f14\uff0c\u663e\u7136\u6709\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\sum\\limits_{k=1}^{c}\\gcd(d,k)\\\\\n  =& \\sum\\limits_{k=1}^{c}\\sum_{x|\\gcd(d,k)}\\varphi(x)\\\\\n  =& \\sum_{x=1}\\varphi(x)[x|d]\\sum_{k=1}^{c}[x|k]\\\\\n  =& \\sum_{x|d}\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\n\\end{aligned}$$\n\n\u518d\u8003\u8651\u91cc\u9762\u7684\u6307\u6570\uff0c\u53d1\u73b0\u8fd9\u5f0f\u5b50\u5728 2 \u9762\u5df2\u7ecf\u63a8\u4e86\u4e00\u904d\u4e86\uff0c\u4e8e\u662f\u76f4\u63a5\u62ff\u8fc7\u6765\u7528\uff0c\u6709\uff1a  \n\n$$\\sum\\limits_{i=1}^{a}\\sum\\limits_{j=1}^{b}[\\gcd(i,j) = d]=\\sum_{y=1}\\mu(y)\\left\\lfloor\\dfrac{a}{yd}\\right\\rfloor\\left\\lfloor\\dfrac{b}{yd}\\right\\rfloor$$  \n\n\u5c06\u5316\u7b80\u540e\u7684\u4e24\u4e2a\u6307\u6570\u4ee3\u5165\u539f\u5f0f\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a\n\n$$\\large \\begin{aligned}\n  &\\prod_{d=1} \\left(d^{\\left(\\sum\\limits_{y=1}\\mu(y)\\left\\lfloor\\frac{a}{yd}\\right\\rfloor\\left\\lfloor\\frac{b}{yd}\\right\\rfloor\\right)}\\right)^{\\sum\\limits_{x|d}\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor}\\\\\n  =& \\prod_{d=1} \\left(\\prod\\limits_{y=1}d^{\\left(\\mu(y)\\left\\lfloor\\frac{a}{yd}\\right\\rfloor\\left\\lfloor\\frac{b}{yd}\\right\\rfloor\\right)}\\right)^{\\sum\\limits_{x|d}\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor}\n\\end{aligned}$$\n\n\u4e0e 2\u30014 \u9762\u540c\u6837\u5957\u8def\u5730\uff0c\u8003\u8651\u679a\u4e3e $t=yd$ \u548c $d$\uff0c\u518d\u7565\u4f5c\u8c03\u6574\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\prod_{d=1} \\left(\\prod\\limits_{y=1}d^{\\left(\\mu(y)\\left\\lfloor\\frac{a}{yd}\\right\\rfloor\\left\\lfloor\\frac{b}{yd}\\right\\rfloor\\right)}\\right)^{\\sum\\limits_{x|d}\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor}\\\\\n  =& \\prod_{t=1}\\prod_{d|t} d^{\\left(\\mu\\left(\\frac{t}{d}\\right)\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\left\\lfloor\\frac{b}{t}\\right\\rfloor\\sum\\limits_{x|d}\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\right)}\\\\\n  =& \\prod_{t=1}\\left(\\prod_{d|t} d^{\\left(\\mu\\left(\\frac{t}{d}\\right)\\sum\\limits_{x|d}\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\right)}\\right)^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\left\\lfloor\\frac{b}{t}\\right\\rfloor}\\\\\n  =& \\prod_{t=1}\\left(\\prod_{d|t} \\prod_{x|d}d^{\\left(\\mu\\left(\\frac{t}{d}\\right)\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\right)}\\right)^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\left\\lfloor\\frac{b}{t}\\right\\rfloor}\n\\end{aligned}$$\n\n\u53d1\u73b0\u8981\u540c\u65f6\u679a\u4e3e $d$ \u548c $x$\uff0c\u5316\u4e0d\u52a8\u4e86\u3002  \n\u4ece\u9898\u89e3\u91cc\u5b66\u5230\u4e00\u4e2a\u6bd4\u8f83\u795e\u7684\u6280\u5de7\uff0c\u8003\u8651\u628a $d$ \u62c6\u6210 $x$ \u548c $\\frac{d}{x}$ \u5206\u522b\u8ba1\u7b97\u8d21\u732e\u518d\u76f8\u4e58\uff0c\u5373\u5206\u522b\u8ba1\u7b97\u4e0b\u4e24\u5f0f\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\prod_{t=1}\\left(\\prod_{d|t} \\prod_{x|d}x^{\\left(\\mu\\left(\\frac{t}{d}\\right)\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\right)}\\right)^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\left\\lfloor\\frac{b}{t}\\right\\rfloor}\\\\  \n  &\\prod_{t=1}\\left(\\prod_{d|t} \\prod_{x|d}{\\left(\\frac{d}{x}\\right)}^{\\left(\\mu\\left(\\frac{t}{d}\\right)\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\right)}\\right)^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\left\\lfloor\\frac{b}{t}\\right\\rfloor}\n\\end{aligned}$$\n\n---\n\n\u5148\u8003\u8651 $x$ \u7684\u60c5\u51b5\uff0c\u9996\u5148\u628a\u679a\u4e3e $x$ \u8c03\u6574\u5230\u6700\u5916\u5c42\u3002\u8bbe $\\operatorname{lim}=\\max(a,b,c)$\uff0c\u5219\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\prod_{x=1} \\prod_{t=1}^{\\operatorname{lim}}[x|t]\\left(\\prod_{d|t} [x|d]{x}^{\\left(\\mu\\left(\\frac{t}{d}\\right)\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\right)}\\right)^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\left\\lfloor\\frac{b}{t}\\right\\rfloor}\\\\\n  =& \\prod_{x=1} \\prod_{t=1}^{\\left\\lfloor\\frac{\\operatorname{lim}}{x}\\right\\rfloor}\\left(\\prod_{d|t} {x}^{\\left(\\mu\\left(\\frac{tx}{dx}\\right)\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\right)}\\right)^{\\left\\lfloor\\frac{a}{tx}\\right\\rfloor\\left\\lfloor\\frac{b}{tx}\\right\\rfloor}\\\\\n  =& \\prod_{x=1} \\prod_{t=1}^{\\left\\lfloor\\frac{\\operatorname{lim}}{x}\\right\\rfloor}\\prod_{d|t} {x}^{\\left(\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\left\\lfloor\\frac{a}{tx}\\right\\rfloor\\left\\lfloor\\frac{b}{tx}\\right\\rfloor\\mu\\left(\\frac{t}{d}\\right)\\right)}\n\\end{aligned}$$\n\n\u628a $\\prod {t}$ \u632a\u5230\u6307\u6570\u4f4d\u7f6e\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\prod_{x=1}  {x}^{\\left(\\sum\\limits_{t=1}^{\\left\\lfloor\\frac{\\operatorname{lim}}{x}\\right\\rfloor}\\sum\\limits_{d|t}\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\left\\lfloor\\frac{a}{tx}\\right\\rfloor\\left\\lfloor\\frac{b}{tx}\\right\\rfloor\\mu\\left(\\frac{t}{d}\\right)\\right)}\\\\\n  =& \\prod_{x=1}  {x}^{\\left(\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\sum\\limits_{t=1}^{\\left\\lfloor\\frac{\\operatorname{lim}}{x}\\right\\rfloor}\\left\\lfloor\\frac{a}{tx}\\right\\rfloor\\left\\lfloor\\frac{b}{tx}\\right\\rfloor\\sum\\limits_{d|t}\\mu\\left(\\frac{t}{d}\\right)\\right)}\n\\end{aligned}$$\n\n\u6307\u6570\u4e2d\u53c8\u51fa\u73b0\u4e86\u4e00\u4e2a\u7ecf\u5178\u7684\u72c4\u5229\u514b\u96f7\u5377\u79ef\u7684\u5f62\u5f0f\uff0c\u5bf9\u5176\u8fdb\u884c\u53cd\u6f14\u3002  \n\u5c06 $(\\mu \\ast 1) (n)= \\epsilon (n)=[n=1]$ \u4ee3\u5165\u539f\u5f0f\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a \n\n$$\\large \\begin{aligned}\n  &\\prod_{x=1}  {x}^{\\left(\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\sum\\limits_{t=1}^{\\left\\lfloor\\frac{\\operatorname{lim}}{x}\\right\\rfloor}\\left\\lfloor\\frac{a}{tx}\\right\\rfloor\\left\\lfloor\\frac{b}{tx}\\right\\rfloor[t=1]\\right)}\\\\\n  =& \\prod_{x=1}  {x}^{\\left(\\varphi(x)\\left\\lfloor\\frac{a}{x}\\right\\rfloor\\left\\lfloor\\frac{b}{x}\\right\\rfloor\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\right)}\n\\end{aligned}$$\n\n\u5f97\u5230\u4e86\u4e00\u4e2a\u975e\u5e38\u4f18\u7f8e\u7684\u5f0f\u5b50\uff0c\u800c\u4e14\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u662f 5 \u9762\u6700\u7ec8\u7b54\u6848\u7684\u4e00\u90e8\u5206\u3002\u540c 5 \u9762\u7684\u505a\u6cd5\uff0c\u76f4\u63a5\u6574\u9664\u5206\u5757\u5373\u53ef\u3002\n\n---\n\n\u518d\u8003\u8651 $\\frac{d}{x}$ \u7684\u60c5\u51b5\uff0c\u540c\u4e0a\u5148\u628a\u679a\u4e3e $x$ \u653e\u5230\u6700\u5916\u5c42\uff0c\u5e76\u8c03\u6574\u4e00\u4e0b\u6307\u6570\uff0c\u5219\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\large \\begin{aligned}\n  &\\prod_{x=1} \\prod_{t=1}^{\\operatorname{lim}}[x|t]\\left(\\prod_{d|t} [x|d]{\\left(\\frac{d}{x}\\right)}^{\\left(\\mu\\left(\\frac{t}{d}\\right)\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\right)}\\right)^{\\left\\lfloor\\frac{a}{t}\\right\\rfloor\\left\\lfloor\\frac{b}{t}\\right\\rfloor}\\\\\n  =& \\prod_{x=1} \\prod_{t=1}^{\\left\\lfloor\\frac{\\operatorname{lim}}{x}\\right\\rfloor}\\left(\\prod_{d|tx} [x|d]{\\left(\\frac{d}{x}\\right)}^{\\left(\\mu\\left(\\frac{tx}{d}\\right)\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor\\right)}\\right)^{\\left\\lfloor\\frac{a}{tx}\\right\\rfloor\\left\\lfloor\\frac{b}{tx}\\right\\rfloor}\\\\\n  =& \\prod_{x=1} \\left(\\prod_{t=1}^{\\left\\lfloor\\frac{\\operatorname{lim}}{x}\\right\\rfloor}\\left(\\prod_{d|tx} [x|d]{\\left(\\frac{d}{x}\\right)}^{\\mu\\left(\\frac{tx}{d}\\right)}\\right)^{\\left\\lfloor\\frac{a}{tx}\\right\\rfloor\\left\\lfloor\\frac{b}{tx}\\right\\rfloor}\\right)^{\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor}\n\\end{aligned}$$\n\n\u8003\u8651\u679a\u4e3e $dx$\uff0c\u66ff\u6362\u539f\u6765\u7684 $d$\uff0c\u6ce8\u610f\u4e00\u4e0b\u8fd9\u91cc\u7684\u500d\u6570\u5173\u7cfb\u3002\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\large \\prod_{x=1} \\left(\\prod_{t=1}^{\\left\\lfloor\\frac{\\operatorname{lim}}{x}\\right\\rfloor}\\left(\\prod_{d|t}d^{\\mu\\left(\\frac{t}{d}\\right)}\\right)^{\\left\\lfloor\\frac{a}{tx}\\right\\rfloor\\left\\lfloor\\frac{b}{tx}\\right\\rfloor}\\right)^{\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor}$$\n\n\u53d1\u73b0\u6700\u5185\u5c42\u7684\u5f0f\u5b50 $\\prod_{d|t}d^{\\mu\\left(\\frac{t}{d}\\right)}$\uff0c\u5373\u4e3a\u4e8c\u9762\u5904\u7406\u8fc7\u7684 $g_0(t)$\u3002\u76f4\u63a5\u4ee3\u5165\uff0c\u539f\u5f0f\u7b49\u4e8e\uff1a\n\n$$\\large \\prod_{x=1} \\left(\\prod_{t=1}^{\\left\\lfloor\\frac{\\operatorname{lim}}{x}\\right\\rfloor}g_0(t)^{\\left\\lfloor\\frac{a}{tx}\\right\\rfloor\\left\\lfloor\\frac{b}{tx}\\right\\rfloor}\\right)^{\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor}$$\n\n\u4e00\u4e2a\u5c0f\u7ed3\u8bba\uff0c\u8bc1\u660e\u53ef\u4ee5\u770b [\u8fd9\u91cc](https://www.cnblogs.com/luckyblock/p/12654760.html#%E5%BC%95%E7%90%861)\uff1a  \n\n$$\\forall a,b,c\\in \\mathbb{Z},\\left\\lfloor\\dfrac{a}{bc}\\right\\rfloor = \\left\\lfloor{\\dfrac{\\left\\lfloor\\dfrac{a}{b}\\right\\rfloor}{c}}\\right\\rfloor$$\n\n\u5219\u539f\u5f0f\u7b49\u4e8e\uff1a  \n\n$$\\large \\prod_{x=1} \\left(\\prod_{t=1}^{\\left\\lfloor\\frac{\\operatorname{lim}}{x}\\right\\rfloor}g_0(t)^{\\left\\lfloor\\frac{\\left\\lfloor\\frac{a}{x}\\right\\rfloor}{t}\\right\\rfloor\\left\\lfloor\\frac{\\left\\lfloor\\frac{b}{x}\\right\\rfloor}{t}\\right\\rfloor}\\right)^{\\varphi(x)\\left\\lfloor\\frac{c}{x}\\right\\rfloor}$$\n\n\u4e8e\u662f\u53ef\u4ee5\u5148\u5bf9\u5916\u5c42\u6574\u9664\u5206\u5757\uff0c\u518d\u5bf9\u5185\u5c42\u6574\u9664\u5206\u5757\u3002\n\n\u7136\u540e\u5c31\u505a\u5b8c\u4e86\uff0c\u54c8\u54c8\u54c8\u3002\n\n## \u5b9e\u73b0\n\n\u4e00\u4e9b\u5b9e\u73b0\u4e0a\u7684\u5c0f\u6280\u5de7\uff1a\n\n- \u9006\u5143\u80fd\u9884\u5904\u7406\u5c31\u9884\u5904\u7406\u3002  \n- \u6ce8\u610f\u5bf9\u6307\u6570\u53d6\u6a21\uff0c\u6a21\u6570\u4e3a $p-1$\u3002  \n\n```cpp\n//\u77e5\u8bc6\u70b9\uff1a\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14 \n/*\nBy:Luckyblock\n\u7528\u4e86\u6bd4\u8f83\u6e05\u6670\u6613\u61c2\u7684\u53d8\u91cf\u540d\uff0c\u9605\u8bfb\u4f53\u9a8c\u5e94\u8be5\u4f1a\u6bd4\u8f83\u597d\u3002  \nvsc \u7684\u81ea\u52a8\u8865\u5168\u771f\u662f\u592a\u597d\u5566\uff01\n*/\n#include <algorithm>\n#include <cctype>\n#include <cstdio>\n#include <cstring>\nusing std::min;\nusing std::max;\n#define LL long long\nconst int Lim = 1e5;\nconst int kN = 1e5 + 10;\n//=============================================================\nLL A, B, C, mod, ans;\nint T, p_num, p[kN];\nbool vis[kN];\nLL mu[kN], phi[kN], fac[kN], g[2][kN];\nLL sumphi[kN], prodt_phi[kN], prodi_i[kN], prodg[2][kN];\nLL inv[kN], inv_fac[kN], inv_prodt_phi[kN], inv_prodg[2][kN];\n//=============================================================\ninline int read() {\n  int f = 1, w = 0;\n  char ch = getchar();\n  for (; !isdigit(ch); ch = getchar())\n    if (ch == '-') f = -1;\n  for (; isdigit(ch); ch = getchar()) {\n    w = (w << 3) + (w << 1) + (ch ^ '0');\n  }\n  return f * w;\n}\nvoid Chkmax(int &fir_, int sec_) {\n  if (sec_ > fir_) fir_ = sec_;\n}\nvoid Chkmin(int &fir_, int sec_) {\n  if (sec_ < fir_) fir_ = sec_;\n}\nLL QPow(LL x_, LL y_) {\n  x_ %= mod;\n  y_ %= mod - 1;\n  LL ret = 1;\n  for (; y_; y_ >>= 1ll) {\n    if (y_ & 1) ret = ret * x_ % mod;\n    x_ = x_ * x_ % mod;\n  }\n  return ret;\n}\nLL Inv(LL x_) {\n  return QPow(x_, mod - 2);\n}\nLL Sum(LL n_) {\n  return ((n_ * (n_ + 1ll)) / 2ll) % (mod - 1);\n}\nvoid Euler() {\n  vis[1] = true, mu[1] = phi[1] = 1; //\u521d\u503c\n  for (int i = 2; i <= Lim; ++ i) {\n    if (! vis[i]) {\n      p[++ p_num] = i;\n      mu[i] = -1;\n      phi[i] = i - 1;\n    }\n    for (int j = 1; j <= p_num && i * p[j] <= Lim; ++ j) {\n      vis[i * p[j]] = true;\n      if (i % p[j] == 0) {\n        mu[i * p[j]] = 0;\n        phi[i * p[j]] = phi[i] * p[j];\n        break;\n      }\n      mu[i * p[j]] = -mu[i];\n      phi[i * p[j]] = phi[i] * (p[j] - 1);\n    }\n  }\n}\nvoid Prepare() {\n  Euler();\n  inv[1] = fac[0] = prodt_phi[0] = prodi_i[0] = 1;\n  for (int i = 1; i <= Lim; ++ i) {\n    g[0][i] = g[1][i] = 1;\n    fac[i] = 1ll * fac[i - 1] * i % mod;\n    sumphi[i] = (sumphi[i - 1] + phi[i]) % (mod - 1);\n    prodi_i[i] = prodi_i[i - 1] * QPow(i, i) % mod;\n    if (i > 1) inv[i] = (mod - mod / i) * inv[mod % i] % mod;\n\n    prodt_phi[i] = prodt_phi[i - 1] * QPow(i, phi[i]) % mod;\n    inv_prodt_phi[i] = Inv(prodt_phi[i]);\n  }\n\n  for (int d = 1; d <= Lim; ++ d) {\n    for (int j = 1; d * j <= Lim; ++ j) {\n      int t = d * j;\n      if (mu[j] == 1) {\n        g[0][t] = g[0][t] * d % mod;\n        g[1][t] = g[1][t] * QPow(1ll * d, 1ll * t * t) % mod;\n      } else if (mu[j] == -1) {\n        g[0][t] = g[0][t] * inv[d] % mod;\n        g[1][t] = g[1][t] * Inv(QPow(1ll * d, 1ll * t * t)) % mod;\n      }\n    }\n  }\n  inv_prodg[0][0] = prodg[0][0] = 1;\n  inv_prodg[1][0] = prodg[1][0] = 1;\n  inv_prodt_phi[0] = 1;\n  for (int i = 1; i <= Lim; ++ i) {\n    for (int j = 0; j <= 1; ++ j) {\n      prodg[j][i] = prodg[j][i - 1] * g[j][i] % mod;\n      inv_prodg[j][i] = Inv(prodg[j][i]);\n    }\n  }\n}\nLL f1(LL a_, LL b_, LL c_, int type) {\n  if (! type) return QPow(fac[a_], b_ * c_);\n  if (type == 1) return QPow(prodi_i[a_], Sum(b_) * Sum(c_));\n  LL ret = 1, lim = min(min(a_, b_), c_);\n  for (LL l = 1, r = 1; l <= lim; l = r + 1) {\n    r = min(min(a_ / (a_ / l), b_ / (b_ / l)), c_ / (c_ / l));\n    ret = ret * QPow(prodt_phi[r] * inv_prodt_phi[l - 1], (a_ / l) * (b_ / l) % (mod - 1) * (c_ / l)) % mod;\n    ret = ret * QPow(fac[a_ / l], (sumphi[r] - sumphi[l - 1] + mod - 1) % (mod - 1) * (b_ / l) % (mod - 1) * (c_ / l)) % mod;\n  }\n  return ret;\n}\nLL f2_2(LL a_, LL b_) { \n  LL ret = 1;\n  for (LL l = 1, r = 1; l <= min(a_, b_); l = r + 1) {\n    r = min(a_ / (a_ / l), b_ / (b_ / l));\n    ret = ret * QPow(prodg[0][r] * inv_prodg[0][l - 1], 1ll * (a_ / l) * (b_ / l)) % mod;\n  }\n  return ret;\n}\nLL f2(LL a_, LL b_, LL c_, int type) {\n  LL ret = 1;\n  if (! type) {\n    for (LL l = 1, r = 1; l <= min(a_, b_); l = r + 1) {\n      r = min(a_ / (a_ / l), b_ / (b_ / l));\n      LL val = QPow(prodg[0][r] * inv_prodg[0][l - 1], 1ll * (a_ / l) * (b_ / l));\n      ret = (ret * QPow(val, c_)) % mod;\n    }\n  } else if (type == 1) {\n    for (LL l = 1, r = 1; l <= min(a_, b_); l = r + 1) {\n      r = min(a_ / (a_ / l), b_ / (b_ / l));\n      LL val = QPow(prodg[1][r] * inv_prodg[1][l - 1], Sum(a_ / l) * Sum(b_ / l));\n      ret = (ret * QPow(val, Sum(c_))) % mod;\n    }\n  } else {\n    LL lim = min(min(a_, b_), c_);\n    for (LL l = 1, r = 1; l <= lim; l = r + 1) {\n      r = min(min(a_ / (a_ / l), b_ / (b_ / l)), c_ / (c_ / l));\n      ret = ret * QPow(f2_2(a_ / l, b_ / l), (sumphi[r] - sumphi[l - 1] + mod - 1) % (mod - 1) * (c_ / l)) % mod;\n      ret = ret * QPow(prodt_phi[r] * inv_prodt_phi[l - 1], (a_ / l) * (b_ / l) % (mod - 1) * (c_ / l)) % mod;\n    }\n  }\n  return ret;\n}\n//=============================================================\nint main() {\n  T = read(), mod = read();\n  Prepare();\n  while (T -- ) {\n    A = read(), B = read(), C = read();\n    for (int i = 0; i <= 2; ++ i) {\n      ans = f1(A, B, C, i) * f1(B, A, C, i) % mod;\n      ans = ans * Inv(f2(A, B, C, i)) % mod * Inv(f2(A, C, B, i)) % mod;\n      printf(\"%lld \", ans);  \n    }\n    printf(\"\\n\");\n  }\n  return 0;\n}\n```",
        "postTime": 1605397542,
        "uid": 186186,
        "name": "\u7075\u4e4c\u8def\u7a7a",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5518 \u3010[MtOI2019]\u5e7d\u7075\u4e50\u56e2 / \u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u57fa\u7840\u7ec3\u4e60\u9898\u3011"
    },
    {
        "content": "\u5982\u679c $\\LaTeX$ \u5d29\u4e86\u5c31\u8bf7\u5230[\u6211\u7684\u535a\u5ba2](https://www.luogu.com.cn/blog/My-luoguBuoke-HZR/solution-p5518)\u770b\u5427QwQ\n\n\u9898\u610f\uff1a\n\n\u6c42\uff1a\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C(\\frac{\\text{lcm}(i,j)}{\\gcd(i,k)})^X$$\n\n\u4f60\u9700\u8981\u8f93\u51fa $X$ \u5206\u522b\u7b49\u4e8e $1 \\ ;\\ i\\times j\\times k\\ ;\\ \\gcd(i,j,k)$ \u7684\u503c\u5bf9\u7ed9\u5b9a\u7684\u6b63\u6574\u6570 $p$ \u53d6\u6a21\u7684\u7ed3\u679c\u3002\n\n\u6570\u636e\u7ec4\u6570 $T=70\\ \\ \\ A,B,C \\leq 10^5\\ \\ \\ 10^7 \\leq p \\leq 1.05 \\times 10^9\\ \\ \\ p\\in \\{prime\\}$\n\n---\n\n\u5410\u69fd\uff1a**\u8fd9\u4e48\u795e\u7684\u9898\u76ee\u6211\u4e0d\u914d\u505a**\uff0c\u9976\u4e86\u6211\u5427QAQ\u3002 [\u5e7d\u7075\u4e50\u56e2](https://music.163.com/#/song?id=832877)\n\n\u9996\u5148\u663e\u7136\u6709 $\\text{lcm}(a,b)=\\dfrac{a\\times b}{\\gcd(a,b)}$\n\n\u4e8e\u662f\u539f\u5f0f\u7b49\u4e8e\uff1a\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C(\\frac{i \\times j}{\\gcd( i,j) \\times \\gcd(i,k))})^X$$\n\n\u76f8\u5f53\u4e8e\u6c42 $\\prod_{i=1}^x\\prod_{j=1}^y\\prod_{k=1}^z i^X$ \u548c $\\prod_{i=1}^x\\prod_{j=1}^y\\prod_{k=1}^z \\gcd(i,j)^X$ \u3002\n\n\u8bbe $f(x,y,z)=\\prod_{i=1}^x\\prod_{j=1}^y\\prod_{k=1}^z i^X\\ ,\\ g(x,y,z)=\\prod_{i=1}^x\\prod_{j=1}^y\\prod_{k=1}^z \\gcd(i,j)^X$\n\n\u90a3\u4e48\u539f\u5f0f\u7b49\u4e8e $\\dfrac{f(A,B,C)f(B,A,C)}{g(A,B,C)g(A,C,B)}$\n\n\u5206\u7c7b\u8ba8\u8bba $X$ \u7684\u6bcf\u4e00\u79cd\u53d6\u503c\u7684\u7b54\u6848\u3002\n\n### 1. $X=1$\n\n$$f(x,y,z)=\\prod_{i=1}^x\\prod_{j=1}^y\\prod_{k=1}^z i=\\prod_{i=1}^X i^{yz}={(\\prod_{i=1}^X i)}^{yz}$$\n\n\u9884\u5904\u7406\u9636\u4e58\u540e\u76f4\u63a5\u8ba1\u7b97\u5373\u53ef\u3002\n\n$$g(x,y,z)=\\prod_{i=1}^x\\prod_{j=1}^y\\prod_{k=1}^z \\gcd(i,j)=(\\prod_{i=1}^x\\prod_{j=1}^y\\gcd(i,j))^z$$\n\n\u8003\u8651 $\\prod_{i=1}^x\\prod_{j=1}^y\\gcd(i,j)$ \u90e8\u5206\u3002\n\n\u8003\u8651\u5148\u679a\u4e3e $\\gcd$ \u7684\u503c\u3002\n\n$$\\prod_{d=1}^x d^{\\sum\\limits_{i=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{d}}\\right\\rfloor}[(i,j)=1]}$$\n\n\u8003\u8651 $\\sum\\limits_{i=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{d}}\\right\\rfloor}[(i,j)=1]$ \uff0c\u8fd9\u4e2a\u4e1c\u897f\u5f88\u83ab\u53cd\u3002\n\n\u5b83\u7b49\u4e8e\n\n$$\n\\sum_{i=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n\\sum_{j=1}^{\\left\\lfloor{\\frac{y}{d}}\\right\\rfloor}\n\\sum_{p|i,j}\n\\mu(p)\n$$\n\n$$\n\\sum_{p=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n\\mu(p)\n\\left\\lfloor{\\frac{x}{dp}}\\right\\rfloor\n\\left\\lfloor{\\frac{y}{dp}}\\right\\rfloor\n$$\n\n\u8fd9\u65f6\u5019\u6211\u4eec\u628a\u8fd9\u4e2a\u5f0f\u5b50\u548c\u524d\u9762\u7684\u90e8\u5206\u8fde\u8d77\u6765\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8bbe\u51fa $T=dp$\n\n$$\n\\prod_{d=1}^{x}d^{\n\t\\sum\\limits_{p=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n\t\\mu(p)\n\t\\left\\lfloor{\\frac{x}{dp}}\\right\\rfloor\n\t\\left\\lfloor{\\frac{y}{dp}}\\right\\rfloor\n}\n$$\n\n$$\n\\prod_{T=1}^{x}\n\\prod_{d|T}\nd^{\n\t\\mu(\\frac{T}{d})\n\t\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor\n\t\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor\n}\n$$\n\n$$\n\\prod_{T=1}^{x}\n(\n\t\\prod_{d|T}\n\td^{\n\t\t\\mu(\\frac{T}{d})\n\t}\n)^\n{\n\t\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor\n\t\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor\n}\n$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u91cc\u9762\u53ef\u4ee5 $O(n\\log n)$ \u9884\u5904\u7406\u3002\u5916\u5c42\u6570\u8bba\u5206\u5757\u5373\u53ef\u3002\n\n### 2. $X\\!=i\\! \\times\\!j\\!\\times\\!k$\n\n\u5148\u8003\u8651 $f(x,y,z)$\n\n$$f(x,y,z)=\\prod_{i=1}^x\\prod_{j=1}^y\\prod_{k=1}^z i^{\\ ijk}$$\n\n\u7136\u540e\u663e\u7136\uff1a\n\n$$=\\prod_{i=1}^x i^{\\ i\\cdot r(y)\\cdot r(z)}$$\n$$=(\\prod_{i=1}^x i^i)^{r(y)\\cdot r(z)}$$\n\n\u5176\u4e2d $r(x)=1+2+...+x=\\dfrac{1}{2}x(1+x)$\n\n\u63a5\u7740\u8003\u8651 $g(x,y,z)$\n\n$$g(x,y,z)=\\prod_{i=1}^x\\prod_{j=1}^y\\prod_{k=1}^z \\gcd(i,j)^{ijk}$$\n\n$$=\\prod_{i=1}^x\\prod_{j=1}^y\\gcd(i,j)^{ijr(z)}$$\n\n$$={(\\prod_{i=1}^x\\prod_{j=1}^y\\gcd(i,j)^{ij})}^{r(z)}$$\n\n\u4e8e\u662f\u6211\u4eec\u53ea\u8981\u8003\u8651 $\\prod_{i=1}^x\\prod_{j=1}^y\\gcd(i,j)^{ij}$ \u5c31\u597d\u4e86\u3002\n\n\u50cf\u4e4b\u524d\u4e00\u6837\uff0c\u679a\u4e3e $\\gcd$ \u7684\u53d6\u503c\uff1a\n\n$$\n\\prod_{d=1}^x\nd^\n\t{\n    \\sum\\limits_{i=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n    \\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{d}}\\right\\rfloor}\n    ijd^2[(i,j)=1]\n    }\n$$\n\n\u7136\u540e\u4e0a\u9762\u8fd9\u4e2a\u5f0f\u5b50\u5f88\u5957\u8def\uff0c\u5c31\u4e0d\u8bb2\u4e86\uff0c\u628a\u8fc7\u7a0b\u5199\u4e00\u904d\uff1a\n\n$$\n\\prod_{d=1}^x\nd^\n\t{\n    d^2\n    \\sum\\limits_{i=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n    \\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{d}}\\right\\rfloor}\n    ij\n    \\sum\\limits_{p|i,j}\n    \\mu(p)\n    }\n$$\n\n$$\n\\prod_{d=1}^x\nd^\n\t{\n    d^2\n    \\sum\\limits_{p=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n    \\mu(p)\n    \\sum\\limits_{i=1}^{\\left\\lfloor{\\frac{x}{dp}}\\right\\rfloor}\n    \\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{dp}}\\right\\rfloor}\n    ijp^2\n    }\n$$\n\n\n$$\n\\prod_{d=1}^x\nd^\n\t{\n    d^2\n    \\sum\\limits_{p=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n    \\mu(p)p^2\n    r({\\left\\lfloor{\\frac{x}{dp}}\\right\\rfloor})\n    r({\\left\\lfloor{\\frac{y}{dp}}\\right\\rfloor})\n    }\n$$\n\n\u7136\u540e\u8bbe $T=dp$ ...\n\n$$\n\\prod_{T=1}^x\n\\prod_{d|T}\nd^\n\t{\n    d^2\\mu(\\frac{T}{d}){(\\frac{T}{d})}^2\n    r({\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor})\n    r({\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor})\n    }\n$$\n\n$$\n\\prod_{T=1}^x\n\\prod_{d|T}\nd^\n\t{\n    T^2\\mu(\\frac{T}{d})\n    r({\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor})\n    r({\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor})\n    }\n$$\n\n$$\n\\prod_{T=1}^x\n{(\n\\prod_{d|T}\nd^\n\t{\n    \\mu(\\frac{T}{d})\n    })\n}^{\n\tT^2\n    r({\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor})\n    r({\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor})\n}\n$$\n\n\u4e8e\u662f\u50cf\u4e4b\u524d\u90a3\u6837\u5904\u7406\u5c31\u53ef\u4ee5\u4e86\u3002\u3002\u3002\n\n### 3. $X\\!= \\gcd(i,j,k)$\n\n\u8fd9\u9053\u9898\u6700\u795e\u7684\u4e00\u4e2a\u90e8\u5206\u5206\u6765\u4e86\u3002\n\n\u90a3\u4e48\u5148\u8003\u8651 $f(x,y,z)$\n\n$$f(x,y,z)=\\prod_{i=1}^x\\prod_{j=1}^y\\prod_{k=1}^z i^{\\gcd(i,j,k)}$$\n\n\u4e4b\u524d\u4e24\u4e2a $f$ \u53ef\u4ee5\u76f4\u63a5\u770b\u51fa\u6765\uff0c\u8fd9\u4e2a\u5c31\u8981\u9ebb\u70e6\u4e00\u70b9\u3002\n\n\u4f46\u662f\u770b\u5230\u8fd9\u4e2a\u5f62\u5f0f\u5c31\u4f1a\u60f3\u5230\u76f4\u63a5\u53cd\u6f14\u4e86\u3002\n\n\u90a3\u4e48\u4f9d\u65e7\u5148\u679a\u4e3e $\\gcd$ \u7684\u503c\u3002\n\n\u539f\u5f0f\u7b49\u4e8e\uff1a\n\n$$\n\\prod_{d=1}^x\n\\prod_{i=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n(id)^{d\n\\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{d}}\\right\\rfloor}\n\\sum\\limits_{k=1}^{\\left\\lfloor{\\frac{z}{d}}\\right\\rfloor}\n[(i,j,k)=1]}\n$$\n\n\u63d0\u51fa\u6765\u4e0a\u9762\u90a3\u4e00\u5768\uff08\uff1f\n\n$$\nd\n\\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{d}}\\right\\rfloor}\n\\sum\\limits_{k=1}^{\\left\\lfloor{\\frac{z}{d}}\\right\\rfloor}\n[(i,j,k)=1]\n$$\n\n\u4e8e\u662f\u6309\u7167\u5957\u8def\uff1a\n\n$$\nd\n\\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{d}}\\right\\rfloor}\n\\sum\\limits_{k=1}^{\\left\\lfloor{\\frac{z}{d}}\\right\\rfloor}\n\\sum\\limits_{p|i,j,k}\\mu(p)\n$$\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0\u8fd9\u91cc\u8981\u628a $p$ \u632a\u5230 $i,j,k$ \u524d\u9762\u3002\u4e8e\u662f\u628a\u524d\u9762\u4e22\u6389\u542b\u6709 $i$ \u7684\u90e8\u5206\u7684\u627e\u56de\u6765\uff08\u6211\u5728\u641e\u4ec0\u4e48\n\n$$\n\\prod_{d=1}^x\n\\prod_{i=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n(id)^{d\n\\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{d}}\\right\\rfloor}\n\\sum\\limits_{k=1}^{\\left\\lfloor{\\frac{z}{d}}\\right\\rfloor}\n\\sum\\limits_{p|i,j,k}\\mu(p)}\n$$\n\n$$\n\\prod_{d=1}^x\n\\prod_{p=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n\\prod_{i=1}^{\\left\\lfloor{\\frac{x}{dp}}\\right\\rfloor}\n(id)^{d\\cdot\\mu(p)\n\\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{dp}}\\right\\rfloor}\n\\sum\\limits_{k=1}^{\\left\\lfloor{\\frac{z}{dp}}\\right\\rfloor}\n}\n$$\n\n\n$$\n\\prod_{d=1}^x\n\\prod_{p=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n\\prod_{i=1}^{\\left\\lfloor{\\frac{x}{dp}}\\right\\rfloor}\n(idp)^{d\\cdot\\mu(p)\n{\\left\\lfloor{\\frac{y}{dp}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{z}{dp}}\\right\\rfloor}\n}\n$$\n\n\u7136\u540e\u4e5f\u662f\u76f8\u540c\u7684\u5957\u8def \u2014\u2014 \u8bbe $T=dp$\n\n$$\n\\prod_{T=1}^x\n\\prod_{d|T}\n\\prod_{i=1}^{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n(iT)^{d\\cdot\\mu(\\frac{T}{d})\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor}\n}\n$$\n\n\u7136\u540e\u5c31\u628a\u5916\u5c42\u542b $T$ \u9879\u7684\u4e2d\u95f4\u52a0\u4e2a\u62ec\u53f7~\n\n$$\n\\prod_{T=1}^x\n(\n\\prod_{d|T}\n\\prod_{i=1}^{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n(iT)^{d\\cdot\\mu(\\frac{T}{d})}\n)^\n{\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor}\n}\n$$\n\n\u8003\u8651\u4e2d\u95f4\u8fd9\u4e00\u5768\uff1a $\\prod\\limits_{d|T}\n\\prod\\limits_{i=1}^{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n(iT)^{d\\cdot\\mu(\\frac{T}{d})}$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u770b\u4e0a\u53bb\u771f\u7684\u4e0d\u592a\u597d\u641e\u3002\u3002\u4e8e\u662f\u4f60\u5c1d\u8bd5\u4e00\u5c42\u5c42\u5206\u6790\uff1a\n\n\u9996\u5148\u53ef\u4ee5\u628a\u6307\u6570\u5265\u51fa\u6765\uff1a\n\n$$\n\\prod\\limits_{d|T}(\n\\prod\\limits_{i=1}^{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n(iT))^{d\\cdot\\mu(\\frac{T}{d})}\n$$\n\n\u60f3\u4e00\u4e0b\u91cc\u9762\u8fd9\u4e00\u5768\u600e\u4e48\u641e\uff0c\u8fd9\u6837\u4e00\u4e0b\u5c31\u6e05\u723d\u591a\u4e86\n\n$$\\prod\\limits_{i=1}^{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n(iT)=T^{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}({\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}!)$$\n\u56de\u987e\u4e00\u4e0b\u4e4b\u524d\u7684\u5f0f\u5b50\uff1a\n\n$$\n\\prod_{T=1}^x\n(\n\\prod_{d|T}\n\\prod_{i=1}^{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n(iT)^{d\\cdot\\mu(\\frac{T}{d})}\n)^\n{\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor}\n}\n$$\n\n$d$ \u5176\u5b9e\u53ea\u5145\u5f53\u4e86\u6307\u6570\u9879\uff0c\u4e8e\u662f\u6211\u4eec\u53c8\u53ef\u4ee5\u641e\u6389\u4e00\u90e8\u5206\uff1a\n\n$$\n\\prod_{T=1}^x\n((\n\\prod_{i=1}^{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n(iT))^{\\sum_{d|T}d\\cdot\\mu(\\frac{T}{d})}\n)^\n{\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor}\n}\n$$\n\n**\u7136\u540e\u8fd9\u4e2a\u5f0f\u5b50\u6709\u70b9\u719f\u6089\uff0c\u6211\u4eec\u53d1\u73b0 $\\sum_{d|T}d\\cdot\\mu(\\frac{T}{d})$**\n\n**\u7b49\u4ef7\u4e8e $Id*\\mu=\\varphi$**\n\n\u4e8e\u662f\u539f\u5f0f\u5c31\u7b49\u4e8e\uff1a\n\n$$\n\\prod_{T=1}^x\n((\n\\prod_{i=1}^{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n(iT))^{\\varphi(T)}\n)^\n{\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor}\n}\n$$\n\n\u5206\u5f00\u8ba1\u7b97 $i$ \u548c $T$ \uff1a\n\n$$\n\\prod_{T=1}^x\n(\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor!)^{\n\\varphi(T)\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor}}\n\\times\n(T^{\\varphi(T)})^{\n{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor}}\n$$\n\n\u76f4\u63a5\u6570\u8bba\u5206\u5757\u5c31\u53ef\u4ee5\u89e3\u51b3\u3002\n\n\u4e8e\u662f\u6211\u4eec\u7ec8\u4e8e\u628a $f$ \u51fd\u6570\u641e\u5b8c\u4e86QAQ\n\n\u7ee7\u7eed\u8003\u8651 $g$ \u51fd\u6570\uff1a\n\n$$\\prod_{i=1}^x\\prod_{j=1}^y\\prod_{k=1}^z \\gcd(i,j)^{\\gcd(i,j,k)}$$\n\n\u6211\u4eec\u6ce8\u610f\u5230\u8fd9\u91cc\u6709\u4e24\u4e2a\u4e0d\u4e00\u6837\u7684 $\\gcd$ \u8003\u8651\u5148\u679a\u4e3e $\\gcd(i,j)$ :\n\n$$\n\\prod_{d=1}^x\nd^{\n\\sum\\limits_{i=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n\\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{d}}\\right\\rfloor}\n\\sum\\limits_{k=1}^{z}\n[\\gcd(i,j)=1]\\gcd(di,dj,k)\n}\n$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u7279\u522b\u5999 \u2014\u2014 \u540e\u9762\u7684\u5f0f\u5b50\u6709\u503c\u5f53\u4e14\u4ec5\u5f53 $\\gcd(i,j)=1$ \u56e0\u6b64 $\\gcd(di,dj)=d$ \u6240\u4ee5\u5c31\u6709 $\\gcd(di,dj,k)=\\gcd(d,k)$\uff0c\u4e8e\u662f\u53ef\u4ee5\u641e\u4e00\u6ce2\uff1a\n\n$$\n\\prod_{d=1}^x\nd^{\n\\sum\\limits_{i=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n\\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{d}}\\right\\rfloor}\n[\\gcd(i,j)=1]\n\\sum\\limits_{k=1}^{z}\n\\gcd(d,k)\n}\n$$\n\n\u8bbe $c(x,y)=\\sum\\limits_{i=1}^x\\gcd(i,y)$\n\n\u8fd9\u4e2a $c$ \u80af\u5b9a\u53ef\u4ee5\u53cd\u6f14\u8ba1\u7b97\u7684\u5566\u3002\u3002\n\n\u7b97\u51fa\u6765\u7ed3\u679c\u662f\uff1a\n\n$$c(x,y)=\\sum_{d|y}\\varphi(d)\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor$$\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5 $O(n \\log n) $\u9884\u5904\u7406\u3002\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b\u5269\u4f59\u7684\u90e8\u5206\uff1a\n\n$$\n\\prod_{d=1}^x\nd^{\n\\sum\\limits_{i=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n\\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{d}}\\right\\rfloor}\n[\\gcd(i,j)=1]\n(\\sum\\limits_{k=1}^{z}\n\\gcd(d,k))\n}\n$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u663e\u7136\u4e5f\u53ef\u4ee5\u53cd\u6f14\uff1a\n\n$$\n\\prod_{d=1}^x\nd^{\n\\sum\\limits_{i=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n\\sum\\limits_{j=1}^{\\left\\lfloor{\\frac{y}{d}}\\right\\rfloor}\n\\sum\\limits_{p|i,j}\\mu(p)\n(\\sum\\limits_{k=1}^{z}\n\\gcd(d,k))\n}\n$$\n\n$$\n\\prod_{d=1}^x\nd^{\n\\sum\\limits_{p=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n\\mu(p)\n{\\left\\lfloor{\\frac{x}{dp}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{dp}}\\right\\rfloor}\n(\\sum\\limits_{k=1}^{z}\n\\gcd(d,k))\n}\n$$\n\n\u7136\u540e\u628a $p$ \u641e\u51fa\u6765\uff1a\n\n$$\n\\prod\\limits_{p=1}^{\\left\\lfloor{\\frac{x}{d}}\\right\\rfloor}\n\\prod_{d=1}^x\nd^{\n\\mu(p)\n{\\left\\lfloor{\\frac{x}{dp}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{dp}}\\right\\rfloor}\n(\\sum\\limits_{k=1}^{z}\n\\gcd(d,k))\n}\n$$\n\n\u7136\u540e\u8bbe $T=dp$ \u6709\uff1a\n\n$$\n\\prod\\limits_{T=1}^x\n\\prod_{d|T}\nd^{\n\\mu(\\frac{T}{d})\n{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n(\\sum\\limits_{k=1}^{z}\n\\gcd(d,k))\n}\n$$\n\n\u7136\u540e\u5206\u4e00\u4e0b\u5c42\uff1a\n\n$$\n\\prod\\limits_{T=1}^x\n{(\\prod_{d|T}\nd^{\n\\mu(\\frac{T}{d})\n(\\sum\\limits_{k=1}^{z}\n\\gcd(d,k))\n})}\n^{\n{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n}\n$$\n\n\u518d\u4ee3\u5165\u4e4b\u524d\u7684 $c$ \uff1a\n\n$$\n\\prod\\limits_{T=1}^x\n{(\\prod_{d|T}\nd^{\n\\mu(\\frac{T}{d})\nc(z,d)\n})}\n^{\n{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n}\n$$\n\n$$\n\\prod\\limits_{T=1}^x\n{(\\prod_{d|T}\nd^{\n\\mu(\\frac{T}{d})\n(\\sum_{p|d}\\varphi(p)\\left\\lfloor{\\frac{z}{p}}\\right\\rfloor)\n})}\n^{\n{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n}\n$$\n\n\u7136\u540e\u628a $p$ \u62ff\u51fa\u6765\uff1a\n\n$$\n\\prod\\limits_{T=1}^x\n{(\\prod_{d|T}\n\\prod_{p|d}\nd^{\n\\mu(\\frac{T}{d})\n\\varphi(p)\\left\\lfloor{\\frac{z}{p}}\\right\\rfloor\n})}\n^{\n{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n}\n$$\n\n\u7136\u540e\u4f60\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u5f0f\u5b50\u63a8\u4e0d\u52a8\u4e86qaq\n\n\u8fd9\u91cc\u6709\u4e00\u4e2a\u6709\u70b9\u6bd2\u7624\u7684\u6280\u5de7\uff1a\u628a $d$ \u62c6\u6210 $\\frac{d}{p} $ \u548c $p$\n\n\u5148\u8ba1\u7b97 $\\frac{d}{p}$\n\n$$\n\\prod\\limits_{T=1}^x\n\\prod_{d|T}\n\\prod_{p|d}\n(\\frac{d}{p})^{\n\\mu(\\frac{T}{d})\n\\varphi(p)\\left\\lfloor{\\frac{z}{p}}\\right\\rfloor\n{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n}\n$$\n\n\u628a $T$ \u4e58\u4e0a $p$\n\n$$\n\\prod_{p=1}^x\\ \n\\prod_{T=1}^{\\left\\lfloor{\\frac{x}{p}}\\right\\rfloor}\\ \n\\prod_{p|d\\ \\&\\&\\ d|Tp}\n(\\frac{d}{p})^{\n\\mu(\\frac{Tp}{d})\n\\varphi(p)\\left\\lfloor{\\frac{z}{p}}\\right\\rfloor\n{\\left\\lfloor{\\frac{x}{Tp}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{Tp}}\\right\\rfloor}\n}\n$$\n\n\u518d\u628a $d$ \u4e58\u4e0a $p$\n\n$$\n\\prod_{p=1}^x\\ \n\\prod_{T=1}^{\\left\\lfloor{\\frac{x}{p}}\\right\\rfloor}\\ \n\\prod_{d|T}\nd^{\n\\mu(\\frac{Tp}{dp})\n\\varphi(p)\\left\\lfloor{\\frac{z}{p}}\\right\\rfloor\n{\\left\\lfloor{\\frac{x}{Tp}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{Tp}}\\right\\rfloor}\n}\n$$\n\n\u7136\u540e\u5316\u7b80\u4e00\u4e0b\uff1a\n\n$$\n\\prod_{p=1}^x\\ \n(\\prod_{T=1}^{\\left\\lfloor{\\frac{x}{p}}\\right\\rfloor}\\ \n(\\prod_{d|T}\nd^{\n\\mu(\\frac{T}{d})})^{\n{\\left\\lfloor{\\frac{x}{Tp}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{Tp}}\\right\\rfloor}\n})^{\n\\varphi(p)\\left\\lfloor{\\frac{z}{p}}\\right\\rfloor\n}\n$$\n\n\u7136\u540e\u8fd9\u4e2a\u5f0f\u5b50\u5341\u5206\u4f18\u7f8e\u3002\u3002\u53ef\u4ee5\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u4e86\u3002\n\n\u9996\u5148\u770b\u5185\u5c42\uff1a\n\n$$\\prod_{d|T}d^{\\mu(\\frac{T}{d})}$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u663e\u7136\u53ef\u4ee5\u9884\u5904\u7406\u641e\u51fa\u6765\uff0c\u590d\u6742\u5ea6 $O(n \\log n)$\n\n${\\color{black}\\colorbox{black}{\\text{\u5176\u5b9e\u5c31\u662f X=1 \u7684\u60c5\u51b5}}}$\n\n\u7136\u540e\u5916\u9762\u7684\u4e24\u5c42\u53ea\u9700\u8981\u6570\u8bba\u5206\u5757\u5c31\u53ef\u4ee5\u4e86\u5462 QwQ\n\n\u7136\u540e\u6211\u4eec\u518d\u770b $p$ \u7684\u60c5\u51b5\uff1a\n\n$$\n\\prod\\limits_{T=1}^x\n\\prod_{d|T}\n\\prod_{p|d}\np^{\n\\mu(\\frac{T}{d})\n\\varphi(p)\\left\\lfloor{\\frac{z}{p}}\\right\\rfloor\n{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}\n}\n$$\n\n\u9996\u5148\u628a $p$ \u632a\u5230\u6700\u524d\u9762\uff1a\n\n\uff08\u63d0\u793a\uff1a\u56e0\u4e3a $d|T,p|d$ \u6240\u4ee5 $p|T$ \uff0c\u628a $T$ \u548c $d$ \u90fd\u4e58\u4e0a $p$ \uff09\n\n$$\n\\prod_{p=1}^x\n\\prod_{T=1}^{\\left\\lfloor{\\frac{x}{p}}\\right\\rfloor}\n\\prod_{d|T}\np^{\n\\mu(\\frac{Tp}{dp})\n\\varphi(p)\\left\\lfloor{\\frac{z}{p}}\\right\\rfloor\n{\\left\\lfloor{\\frac{x}{Tp}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{Tp}}\\right\\rfloor}\n}\n$$\n\n\u7136\u540e\u628a\u5e95\u4e0b\u7684 $\\prod$ \u632a\u5230\u4e0a\u9762\u53bb\uff1a\n\n$$\n\\prod_{p=1}^x\np^{\n\\sum\\limits_{T=1}^{\\left\\lfloor{\\frac{x}{p}}\\right\\rfloor}\n\\sum\\limits_{d|T}\n\\mu(\\frac{T}{d})\n\\varphi(p)\\left\\lfloor{\\frac{z}{p}}\\right\\rfloor\n{\\left\\lfloor{\\frac{x}{Tp}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{Tp}}\\right\\rfloor}\n}\n$$\n\n\u8c03\u6574\u987a\u5e8f\uff1a\n\n$$\n\\prod_{p=1}^x\np^{\n\\varphi(p)\\left\\lfloor{\\frac{z}{p}}\\right\\rfloor\n\\sum\\limits_{T=1}^{\\left\\lfloor{\\frac{x}{p}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{x}{Tp}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{Tp}}\\right\\rfloor}\n\\sum\\limits_{d|T}\n\\mu(\\frac{T}{d})\n}\n$$\n\n\u89c2\u5bdf $\\sum\\limits_{d|T}\\mu(\\frac{T}{d})$ \u8fd9\u4e2a\u76f8\u5f53\u4e8e\u662f $\\mu*1=\\epsilon$\n\n\u4e8e\u662f\u8f6c\u6362\u6210\uff1a\n\n$$\n\\prod_{p=1}^x\np^{\n\\varphi(p)\\left\\lfloor{\\frac{z}{p}}\\right\\rfloor\n\\sum\\limits_{T=1}^{\\left\\lfloor{\\frac{x}{p}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{x}{Tp}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{Tp}}\\right\\rfloor}\n\\epsilon(T)\n}\n$$\n\n\u63a5\u4e0b\u6765\u56e0\u4e3a $espilon(T) \\Leftrightarrow [T=1]$ \u53ef\u4ee5\u76f4\u63a5\u628a $T$ \u5f53\u4f5c $1$ \u6765\u641e\u3002\n\n$$\n\\prod_{p=1}^x\np^{\n\\varphi(p)\n{\\left\\lfloor{\\frac{x}{p}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{y}{p}}\\right\\rfloor}\n{\\left\\lfloor{\\frac{z}{p}}\\right\\rfloor}\n}\n$$\n\n\u8fd9\u4e2a\u5f0f\u5b50\u771f\u7684\u662f\u8d85\u7ea7\u6f02\u4eae\u554a\u554a\u554a\u3002\n\n\u7b80\u5355\u6570\u8bba\u5206\u5757\u5c31 OK \u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\ninline ll read(){\n    char c=getchar();ll x=0,f=1;\n    while(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n    while(c>='0'&&c<='9'){x=x*10+c-'0';c=getchar();}\n    return x*f;\n}\nconst int N=100010;\nint i,j,k,n,m,T,A,B,C,mod;\nint prime[N],is_prime[N],mu[N],phi[N],Phi[N],Phi2[N],h[N],H[N],h2[N],H2[N],nH[N],num;\nint jc[N],Jc[N],jc2[N],njc2[N],mi[N];\ninline ll ksm(ll sum,ll num){\n    ll ans=1;\n    while(num){\n        if(num&1)ans=1ll*ans*sum%mod;\n        sum=1ll*sum*sum%mod;\n        num>>=1;\n    }return ans;\n}\ninline ll ksm2(ll sum,ll num){\n    ll ans=1;\n    while(num){\n        if(num&1)ans=1ll*ans*sum%(mod-1);\n        sum=1ll*sum*sum%(mod-1);\n        num>>=1;\n    }return ans;\n}\nvoid init(){\n    mu[1]=jc[0]=Jc[0]=jc2[0]=njc2[0]=jc[1]=Jc[1]=H[0]=nH[0]=H2[0]=Phi[0]=mi[0]=1;\n    for(int i=1;i<N;i++)jc[i]=1ll*jc[i-1]*i%mod,Jc[i]=1ll*Jc[i-1]*ksm(i,i)%mod;\n    for(int i=2;i<N;i++)is_prime[i]=1;\n    phi[1]=1;\n    for(int i=2;i<N;i++){\n        if(is_prime[i])prime[++num]=i,mu[i]=-1,phi[i]=i-1;\n        for(int j=1;j<=num && i*prime[j]<N;j++){\n            is_prime[i*prime[j]]=0;\n            phi[i*prime[j]]=phi[i]*prime[j];\n            if(i%prime[j]==0)break;\n            mu[i*prime[j]]=-mu[i];\n            phi[i*prime[j]]=phi[i]*(prime[j]-1);\n        }\n    }\n    for(int i=1;i<N;i++){\n        Phi[i]=(Phi[i-1]+phi[i]>=mod-1? Phi[i-1]+phi[i]-(mod-1) : Phi[i-1]+phi[i]);\n        h[i]=H[i]=h2[i]=H2[i]=mi[i]=1;\n        jc2[i]=1ll*jc2[i-1]*ksm(i,phi[i])%mod,njc2[i]=ksm(jc2[i],mod-2);\n    }\n    for(int i=1;i<N;i++)\n        if(mu[i])\n            for(int j=i;j<N;j+=i){\n                if(mu[i]==1)h[j]=1ll*h[j]*j/i%mod,h2[j]=1ll*h2[j]*(j/i)%mod;\n                else h[j]=1ll*h[j]*ksm(j/i,mod-2)%mod,h2[j]=1ll*h2[j]*ksm(j/i,mod-2)%mod;\n            } \n    for(int i=1;i<N;i++)H[i]=1ll*H[i-1]*h[i]%mod,nH[i]=ksm(H[i],mod-2);\n    for(int i=1;i<N;i++){\n        h2[i]=ksm(h2[i],1ll*i*i%(mod-1));\n        H2[i]=1ll*H2[i-1]*h2[i]%mod;\n    }\n}\ninline int R(int x,bool isksm=0){\n    if(isksm)return 1ll*x*(x+1)/2%(mod-1);\n    return 1ll*x*(x+1)/2%mod;\n}\ninline int get_f1(int x,int y,int z){\n    return ksm(jc[x],(ll)(1ll*y*z%(mod-1)));\n}\ninline int get_f2(int x,int y,int z){\n    int tmp=ksm(Jc[x],(ll)(1ll*R(y,true)*R(z,true)%(mod-1)));\n    return tmp;\n}\nint q[N],Q[N];\nint get_f3(int x,int y,int z){\n    register int ans1=1,ans2=1;\n    for(register int l=1,r=0;l<=min(min(x,y),z);l=r+1){\n        r=min(min(x/(x/l),y/(y/l)),z/(z/l));\n        ans1=1ll*ans1*ksm(jc[x/l],1ll*(Phi[r]-Phi[l-1]+mod-1)%(mod-1)*(1ll*(y/l)*(z/l)%(mod-1))%(mod-1))%mod;\n//      ans2=1ll*ans2*ksm(1ll*jc2[r]*ksm(jc2[l-1],mod-2)%mod,1ll*(x/l)*(y/l)*(z/l)%(mod-1))%mod;\n//      cout<<\"get_f3 ans1=\"<<ans1<<endl;\n    }\n    return (1ll*ans1*ans2%mod);\n}\nint get_g1(int x,int y,int z){\n    register int ans=1;\n    for(int l=1,r=0;l<=min(x,y);l=r+1){\n        r=min(x/(x/l),y/(y/l));\n        ans=1ll*ans*ksm(1ll*H[r]*nH[l-1]%mod,1ll*(x/l)*(y/l)%(mod-1))%mod;\n    }\n    return ksm(ans,z);\n}\nint get_g2(int x,int y,int z){\n    register int ans=1;\n    for(int l=1,r=0;l<=min(x,y);l=r+1){\n        r=min(x/(x/l),y/(y/l));\n        int Sum=1ll*H2[r]*ksm(H2[l-1],mod-2)%mod;\n        ans=1ll*ans*ksm(Sum,1ll*R(x/l,true)*R(y/l,true)%(mod-1))%mod;\n    }return ksm(ans,R(z,true));\n}\ninline int Getsum(int x,int y){\n    register int ans=1;\n    for(int l=1,r=0;l<=min(x,y);l=r+1){\n        r=min(x/(x/l),y/(y/l));\n        ans=1ll*ans*ksm(1ll*H[r]*nH[l-1]%mod,1ll*(x/l)*(y/l)%(mod-1))%mod;\n    }return ans;\n}\nint get_g3(int x,int y,int z){\n    register int ans=1;\n    for(register int l=1,r=0;l<=min(min(x,y),z);l=r+1){\n        r=min(min(x/(x/l),y/(y/l)),z/(z/l));\n        ans=1ll*ans*ksm(Getsum(x/l,y/l),1ll*(Phi[r]-Phi[l-1]+(mod-1))%(mod-1)*(z/l)%(mod-1))%mod;\n//      ans=1ll*ans*ksm(1ll*jc2[r]*njc2[l-1]%mod,1ll*(x/l)*(y/l)%(mod-1)*(z/l)%(mod-1))%mod;\n    }\n    return ans;\n}\nint get_ans1(){\n    int ans1=1ll*get_f1(A,B,C)*get_f1(B,A,C)%mod,ans2=1ll*get_g1(A,B,C)*get_g1(A,C,B)%mod;\n    return (1ll*ans1*ksm(ans2,mod-2)%mod);\n}\nint get_ans2(){\n    int ans1=1ll*get_f2(A,B,C)*get_f2(B,A,C)%mod,ans2=1ll*get_g2(A,B,C)*get_g2(A,C,B)%mod;\n    return (1ll*ans1*ksm(ans2,mod-2)%mod);\n}\nint get_ans3(){\n    int ans1=1ll*get_f3(A,B,C)*get_f3(B,A,C)%mod,ans2=1ll*get_g3(A,B,C)*get_g3(A,C,B)%mod;\n    return (1ll*ans1*ksm(ans2,mod-2)%mod);\n}\nint main(){\n    cin>>T>>mod;\n    init();\n    while(T--){\n        cin>>A>>B>>C;\n        printf(\"%d %d %d\\n\",get_ans1(),get_ans2(),get_ans3());\n    }\n    return 0;\n}\n```\n\n\u4e8e\u662f\u60a8\u7ec8\u4e8e\u5199\u5b8c\u4e86\u8fd9\u9053**\u795e\u9898**\u3002",
        "postTime": 1584859573,
        "uid": 35891,
        "name": "huangzirui",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5518"
    },
    {
        "content": "\u4f5c\u4e3a\u4e00\u4e2a\u4e1c\u65b9\u4f17\uff0c\u770b\u5230\u8fd9\u9053\u9898\u5f53\u7136\u8981\u505a\u4e00\u4e0b\uff0c\u7136\u540e\u5199\u4e2a\u9898\u89e3\u554a\n\n\u9898\u89e3\u6570\u8fd9\u4e48\u5c11\uff0c\uff08\u6709\u4e9b\u5927\u4f6c\u8fd8\u8df3\u6b65\uff0c\u5bfc\u81f4\u6211\u4e00\u5f00\u59cb\u6709\u4e9b\u6ca1\u770b\u61c2\u3002\u3002\uff09\n\n\u6211\u5c3d\u91cf\u628a\u80fd\u5199\u7684\u8fc7\u7a0b\u5168\u90fd\u5199\u4e86\uff08\u7ba1\u7406\u5458\u5927\u5927\u7ed9\u8fc7\u5427\uff09\n\n\u8fd9\u9898\u662f\u771f\u7684\u8349\u3002\u3002\u4e8e\u662f\u6211\u88ab\u9898\u89e3\u91cc\u7684\u5927\u4f6c\u7ed9\u529d\u5230\u4e86[\u8fd9\u9053\u9898](https://www.luogu.com.cn/problem/P3704)\n\n\u90a3\u9898\u6211\u4e5f\u5199\u4e86\u9898\u89e3->[here](https://www.luogu.com.cn/blog/you-xiao-mei-jiu/p3704-sdoi2017-shuo-zi-biao-ge)<-\n\n***\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ce80tzhz.png)\n\n\u539f\u9898\u53ef\u4ee5\u5316\u6210\u8fd9\u6837\u7684\u5f0f\u5b50\n\n\u7136\u540e\uff0c\u663e\u7136\u53ef\u4ee5\u5206\u4e3a\u4e24\u4e2a\u5b50\u95ee\u9898\uff1a\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i^{f(type)}$$\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} gcd(i,j)^{f(type)}$$\n\n\n\u6309type\u7684\u60c5\u51b5\u5206\u7c7b\u8ba8\u8bba\n\n\u8ba9\u6211\u4eec\u6109\u5feb\u7684 **\u63a8 \u5012** \u5f0f\u5b50\u5427\n\n## type=0\n![](https://cdn.luogu.com.cn/upload/image_hosting/rqmy9f8t.png)\n\n\n(i) \u9884\u5904\u7406\u9636\u4e58+\u5feb\u901f\u5e42 \u5373\u53ef\n\n(ii) \u9884\u5904\u7406 $\\prod_{d|T}d^{\u03bc(\\frac{T}{d})}$ \n\u7684\u524d\u7f00\u79ef + \u6574\u9664\u5206\u5757\n***\n***\n\n## type=1\n![](https://cdn.luogu.com.cn/upload/image_hosting/misxjvin.png)\n\n\n(i) \u9884\u5904\u7406 $i^i$ \u7684\u524d\u7f00\u79ef + \u5feb\u901f\u5e42\n\n***\n### \u6765\u770b\uff08ii\uff09\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ikmzyk4e.png)\n\n(ii) \u9884\u5904\u7406 $(\\prod_{d|T}d^{\u03bc(\\frac{T}{d})})^{T^2}$ \n\u7684\u524d\u7f00\u79ef + \u6574\u9664\u5206\u5757 + \u5feb\u901f\u5e42\n****\n***\n## type=2\n(i)\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ey504g6o.png)\n\n1) \u9884\u5904\u7406 $T^{\\varphi(T)}$ \u7684\u524d\u7f00\u79ef \n\n2) \u9884\u5904\u7406\u4e00\u4e2a\u6a21(mod-1)\u610f\u4e49\u4e0b\u7684 $\\varphi(T)$ \u7684\u524d\u7f00\u548c \n\n3) \u6574\u9664\u5206\u5757\n***\n![](https://cdn.luogu.com.cn/upload/image_hosting/xpjqhx1b.png)\n\n\u6211\u4eec\u53ef\u4ee5\u628a\u6307\u6570\u7684\u90a3\u5768\u5355\u72ec\u62ff\u51fa\u6765\u770b\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/89mvwm1c.png)\n\n\u9884\u5904\u7406\u51fa\u4e2d\u95f4\u90a3\u4e00\u5768$\\prod_{d|T'}d^{\\mu(\\frac{T'}{d})}$\n\u4e4b\u540e, \n\n\u4e24\u6b21\u6574\u9664\u5206\u5757\u5c31\u89e3\u51b3\u5566\uff01",
        "postTime": 1579447828,
        "uid": 23121,
        "name": "\u8bf1\u5bb5\u7f8e\u2468",
        "ccfLevel": 0,
        "title": "P5518 [MtOI2019]\u5e7d\u7075\u4e50\u56e2"
    },
    {
        "content": "\u5230\u5c0f\u849f\u84bb\u7684\u5c0f\u7a9d\u535a\u5ba2\u91cc\u770b\u770b\uff1a[$\\tt George1123$](https://www.cnblogs.com/Wendigo/p/13341419.html)\n\n---\n## \u9898\u9762\n\n> [MtOI2019 \u5e7d\u7075\u4e50\u56e2](https://www.luogu.com.cn/problem/P5518)\n\n> \u7ed9\u5b9a $p$\uff0c$Cnt$ \u7ec4\u6d4b\u8bd5\u6570\u636e\uff0c\u6bcf\u6b21\u7ed9 $a,b,c$\uff0c\u6c42\n> $$\\prod_{i=1}^a\\prod_{j=1}^b\\prod_{k=1}^c\\left(\\frac{{\\rm lcm}(i,j)}{\\gcd(i,k)}\\right)^{f(t)}\\bmod p$$\n> $t\\in\\{0,1,2\\}$\uff0c$f(0)=1,f(1)=ijk,f(2)=\\gcd(i,j,k)$\u3002\n\n> \u6570\u636e\u8303\u56f4\uff1a$1\\le a,b,c\\le 10^5$\uff0c$10^7\\le p\\le 105\\cdot 10^7$\uff0c$p\\in\\mathbb{P}$\uff0c$1\\le Cnt\\le 70$\u3002\n\n---\n## \u849f\u84bb\u8bed\n\n\u521d\u5b66\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u662f\u5f88\u4e45\u4e4b\u524d\u4e86\uff0c\u6700\u8fd1\u96c6\u8bad\u8001\u5e08\u8bb2\u4e86\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u3002\n\n\u90a3\u5929\u849f\u84bb\u6ca1\u53bb\uff0c\u795e $\\tt zhoukangyang$ \u8bf4\uff1a\n\n> \u8001\u5e08\u6293\u4e86\u9694\u58c1\u673a\u623f\u7684 $\\texttt{x\u4e49x}$\uff08$\\tt orz$\uff09\u6765\u73b0\u573a\u505a\u300cMtOI2019 \u5e7d\u7075\u4e50\u56e2\u300d\uff0c\u7ed3\u679c\u4ed6\u4e0a\u6765\u5c31\u5f00\u4e86\u9898\u89e3\u2026\u2026\n\n\u4e8e\u662f\u795e $\\tt zky$ \u548c\u795e\u3010\u6570\u636e\u5220\u9664\u3011\u5c31\u5e72\u4e86\u8fd9\u9898\u4e00\u4e2a\u665a\u4e0a\u3002\u7b2c\u4e8c\u5929\u849f\u84bb\u53bb\u63a8\u4e86\u4e00\u4e2a\u4e0b\u5348\uff0c\u7ec8\u4e8e\u63a8\u51fa\u6765\u4e86\uff0c\u63a8\u4e86\u4e00\u9762\uff0c\u7ec6\u8282\u5f88\u591a\uff0c\u4f46\u4e0d\u96be\u3002\u6700\u540e\u849f\u84bb\u6bd4\u4ed6\u4eec\u4e24\u4e2a\u5148\u505a\u51fa\u6765 $\\tt /yx$\u3002\n\n---\n## \u849f\u84bb\u89e3\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/9dh8cpb9.png)\n\n\n\u6240\u4ee5\u53ea\u9700\u7b97\u51fa:\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/8vosr400.png)\n\n\u548c\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/mxq29y20.png)\n\n\u5373\u53ef\uff0c\u5171 $2\\times 3=6$ \u79cd\u5f0f\u5b50\u3002\n\n---\n### t=0\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ytqagzv0.png)\n\n\u9884\u5904\u7406 $n!$ \u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n)$\uff0c\u8ba1\u7b97 $\\Theta(\\log n)$\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/je8b00o9.png)\n\n\n\u9884\u5904\u7406 $\\prod_{d|T}d^{\\mu(\\frac{T}{d})}$ \u524d\u7f00\u79ef\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n\\log\\log n)$\uff0c\u5206\u5757\u8ba1\u7b97 $\\Theta(\\sqrt{n}\\log n)$\u3002\n\n---\n### t=1\n\n\u4ee4 $S(n)=\\frac{n(n+1)}{2}$\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/qvapv06b.png)\n\n\u9884\u5904\u7406 $\\prod_{i=1}^a i^i$ \u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n)$\uff0c\u8ba1\u7b97 $\\Theta(\\log n)$\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/2hni8c0k.png)\n\n\u5728 $\\prod_{d|T}d^{\\mu(\\frac{T}{d})}$ \u7684\u57fa\u7840\u4e0a\u9884\u5904\u7406 $\\left(\\prod_{d|T}d^{\\mu(\\frac{T}{d})}\\right)^{T^2}$ \u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n\\log n)$\uff0c\u5206\u5757\u8ba1\u7b97 $\\Theta(\\sqrt{n}\\log n)$\u3002\n\n---\n### t=2\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/2btrvx1z.png)\n\n\n\u5de6\u8fb9\u7528\u5df2\u7ecf\u9884\u5904\u7406\u8fc7\u7684\u9636\u4e58\uff0c\u53f3\u8fb9\u9884\u5904\u7406 $T^{\\varphi(T)}$ \u524d\u7f00\u79ef\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n\\log n)$\uff0c\u5206\u5757\u8ba1\u7b97 $\\Theta(\\sqrt{n}\\log n)$\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/weo5w7dz.png)\n\n> \u6709\u70b9\u8df3\u6b65\uff0c\u4f46\u662f\u6709\u4e86\u8fd9\u70b9\u62e8\u5e76\u4e0d\u96be\u63a8\uff0c\u6bd5\u7adf\u524d\u4eba\u4e4b\u8ff0\u5907\u77e3\uff0c\u7136\u5219\u6709\u4e9b\u7ec6\u8282\uff0c\u786e\u5b9e\u8be5\u7ec6\u8bb2\u3002\n\n$T^{\\varphi(T)}$ \u548c $\\prod_{e|G}e^{\\mu(\\frac{G}{e})}$ \u5df2\u7ecf\u9884\u5904\u7406\u8fc7\u4e86\uff0c\u5206\u5757\u5957\u5206\u5757 $\\Theta(n\\log n)$\u3002\n\n---\n### \u7ec6\u8282&\u4f18\u5316\n\n\u6ce8\u610f\u8981\u6a21 $p$\uff0c\u4f46\u662f\u6839\u636e\u6b27\u62c9\u5b9a\u7406\uff0c\u6307\u6570\u8981\u6a21 $\\varphi(p)=p-1$\u3002\n\n\u770b\u5230\u4e00\u4e2a\u5f0f\u5b50\u600e\u4e48\u77e5\u9053\u8be5\u7b5b\u4ec0\u4e48\uff1f\u770b\u770b\u54ea\u4e9b\u4e1c\u897f\u4e0d\u53ef\u4ee5\u5206\u5757\u7edf\u4e00\u7b97\u3002\n\n\u600e\u4e48 $\\Theta(n\\log \\log n)$ \u9884\u5904\u7406 $\\prod_{d|T}d^{\\mu(\\frac{T}{d})}$\uff1f\n\n\u5229\u7528\u79ef\u6027\u51fd\u6570\u7684\u6027\u8d28\uff0c\u540c\u65f6\u8ba1\u7b97\u8fd9\u4e1c\u897f\u548c\u8fd9\u4e1c\u897f\u7684\u9006\u5143\uff08\u6ce8\u610f\u8fd8\u6ca1\u6709\u6c42\u524d\u7f00\u79ef\uff09\uff1a\n\n```cpp\nfor(int i=1;i<=N;i++) f[i]=i,ivf[i]=in[i];\nfor(int j=0;j<cp;j++)for(int i=N/p[j];i>=1;i--)\n\tf[i*p[j]]=(ll)f[i*p[j]]*ivf[i]%P,ivf[i*p[j]]=(ll)ivf[i*p[j]]*f[i]%P;\n```\n\n\u73b0\u5728\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\Theta(Tn\\log n)$ \u6211\u5361\u8fc7\u53bb\u4e86\uff0c\u4f46\u662f\u662f\u53ef\u4ee5\u4f18\u5316\u5230 $\\Theta(n^{\\frac{4}{3}}+Tn^{\\frac{2}{3}}\\log n)$\u3002\n\n\u6ce8\u610f\u8fd9\u4e2a\u5f0f\u5b50\u91cc\u9762\u6709\u4ec0\u4e48\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/rypwrruk.png)\n\n\n\u6240\u4ee5\u53ef\u4ee5 $\\Theta(n^{\\frac{4}{3}})$ \u7528\u7c7b\u4f3c\u8f97\u8f6c\u76f8\u9664\u7684\u65b9\u6cd5\u9884\u5904\u7406 $a,b\\le n^{\\frac{2}{3}}$ \u7684 $g(a,b)$ \u4ee5\u53ca\u524d\u7f00\u79ef\uff0c\u7136\u540e\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u5c31 $\\Theta(n^{\\frac{4}{3}}+Tn^{\\frac{2}{3}}\\log n)$ \u4e86\u3002\n\n```cpp\nfor(int i=1;i<=K;i++){\n\tfor(int j=1;j<i;j++){\n\t\tg[i][j]=g[max(j,i-j)][min(j,i-j)];\n\t\tsg[i][j]=(ll)sg[i-1][j]*sg[i][j-1]%P*isg[i-1][j-1]%P*g[i][j]%P;\n\t\tisg[i][j]=(ll)isg[i-1][j]*isg[i][j-1]%P*sg[i-1][j-1]%P*in[g[i][j]]%P;\n\t}\n\tg[i][i]=i;\n\tsg[i][i]=(ll)sg[i][i-1]*sg[i][i-1]%P*isg[i-1][i-1]%P*i%P;\n\tisg[i][i]=(ll)isg[i][i-1]*isg[i][i-1]%P*sg[i-1][i-1]%P*in[i]%P;\n}\n```\n---\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n//Start\ntypedef long long ll;\ntypedef double db;\n#define mp(a,b) make_pair(a,b)\n#define x first\n#define y second\n#define be(a) a.begin()\n#define en(a) a.end()\n#define sz(a) int((a).size())\n#define pb(a) push_back(a)\nconst int inf=0x3f3f3f3f;\nconst ll INF=0x3f3f3f3f3f3f3f3f;\n\n//Data\nconst int N=1e5;\nint P,fac[N+1],faci[N+1],in[N+1];\nint sum(int a){return (ll)a*(a+1)/2%(P-1);}\nint Pow(int a,int x){\n\tif(!a) return 0; int res=1;\n\tfor(;x;a=(ll)a*a%P,x>>=1)if(x&1) res=(ll)res*a%P;\n\treturn res;\n}\n\n//Sieve\nconst int K=2500;\nbool np[N+1];\nint mu[N+1],phi[N+1],cp,p[N];\nint f[N+1],ivf[N+1],fii[N+1],ifii[N+1],dp[N+1],idp[N+1];\nint g[K+1][K+1],sg[K+1][K+1],isg[K+1][K+1];\nvoid Sieve(){\n\tnp[1]=true,mu[1]=phi[1]=fii[0]=ifii[0]=dp[0]=idp[0]=f[0]=ivf[0]=in[1]=fac[0]=faci[0]=1;\n\tfor(int i=2;i<=N;i++) in[i]=(ll)(P-P/i)*in[P%i]%P;\n\tfor(int i=1;i<=N;i++) fac[i]=(ll)fac[i-1]*i%P,faci[i]=(ll)faci[i-1]*Pow(i,i)%P;\n\tfor(int i=2;i<=N;i++){\n\t\tif(!np[i]) mu[i]=-1,phi[i]=i-1,p[cp++]=i;\n\t\tfor(int j=0;j<cp&&i*p[j]<=N;j++){\n\t\t\tnp[i*p[j]]=1;\n\t\t\tif(i%p[j]==0){mu[i*p[j]]=0,phi[i*p[j]]=phi[i]*p[j];break;}\n\t\t\tmu[i*p[j]]=mu[i]*mu[p[j]],phi[i*p[j]]=phi[i]*phi[p[j]];\n\t\t}\n\t}\n\tfor(int i=1;i<=N;i++) f[i]=i,ivf[i]=in[i];\n\tfor(int j=0;j<cp;j++)for(int i=N/p[j];i>=1;i--)\n\t\tf[i*p[j]]=(ll)f[i*p[j]]*ivf[i]%P,ivf[i*p[j]]=(ll)ivf[i*p[j]]*f[i]%P;\n\tfor(int i=1;i<=N;i++){\n\t\tfii[i]=Pow(f[i],(ll)i*i%(P-1)),ifii[i]=Pow(ivf[i],(ll)i*i%(P-1));\n\t\tdp[i]=Pow(i,phi[i]%(P-1)),idp[i]=Pow(in[i],phi[i]%(P-1));\n\t}\n\tfor(int i=2;i<=N;i++){\n\t\tf[i]=(ll)f[i]*f[i-1]%P,ivf[i]=(ll)ivf[i]*ivf[i-1]%P;\n\t\tfii[i]=(ll)fii[i]*fii[i-1]%P,ifii[i]=(ll)ifii[i]*ifii[i-1]%P;\n\t\tdp[i]=(ll)dp[i]*dp[i-1]%P,idp[i]=(ll)idp[i]*idp[i-1]%P;\n\t\t(phi[i]+=phi[i-1])%=(P-1);\n\t}\n\tfor(int i=0;i<=K;i++) g[i][0]=g[0][i]=i,sg[i][0]=sg[0][i]=isg[i][0]=isg[0][i]=1;\n\tfor(int i=1;i<=K;i++){\n\t\tfor(int j=1;j<i;j++){\n\t\t\tg[i][j]=g[max(j,i-j)][min(j,i-j)];\n\t\t\tsg[i][j]=(ll)sg[i-1][j]*sg[i][j-1]%P*isg[i-1][j-1]%P*g[i][j]%P;\n\t\t\tisg[i][j]=(ll)isg[i-1][j]*isg[i][j-1]%P*sg[i-1][j-1]%P*in[g[i][j]]%P;\n\t\t}\n\t\tg[i][i]=i;\n\t\tsg[i][i]=(ll)sg[i][i-1]*sg[i][i-1]%P*isg[i-1][i-1]%P*i%P;\n\t\tisg[i][i]=(ll)isg[i][i-1]*isg[i][i-1]%P*sg[i-1][i-1]%P*in[i]%P;\n\t}\n}\n\n//Mobius\nint ProdGcd(int a,int b){\n\tint res=1;\n\tif(a<=K&&b<=K) res=sg[max(a,b)][min(a,b)];\n\telse {\n\t\tfor(int d=1,r;d<=min(a,b);d=r+1){\n\t\t\tr=min(a/(a/d),b/(b/d));\n\t\t\tres=(ll)res*Pow((ll)f[r]*ivf[d-1]%P,(ll)(a/d)*(b/d)%(P-1))%P;\n\t\t}\n\t}\n\t// cout<<\"ProdGcd(\"<<a<<','<<b<<\"):\"<<res<<'\\n';\n\treturn res;\n}\nint Geti0(int a,int b,int c){\n\tint res=Pow(fac[a],(ll)b*c%(P-1));\n\t// cout<<\"Geti0(\"<<a<<','<<b<<','<<c<<\"):\"<<res<<'\\n';\n\treturn res;\n}\nint Getg0(int a,int b,int c){\n\tint res=1;\n\tfor(int d=1,r;d<=min(a,b);d=r+1){\n\t\tr=min(a/(a/d),b/(b/d));\n\t\tres=(ll)res*Pow((ll)f[r]*ivf[d-1]%P,(ll)(a/d)*(b/d)%(P-1))%P;\n\t}\n\tres=Pow(res,c%(P-1));\n\t// cout<<\"Getg0(\"<<a<<','<<b<<','<<c<<\"):\"<<res<<'\\n';\n\treturn res;\n}\nint Geti1(int a,int b,int c){\n\tint res=Pow(faci[a],(ll)sum(b)*sum(c)%(P-1));\n\t// cout<<\"Geti1(\"<<a<<','<<b<<','<<c<<\"):\"<<res<<'\\n';\n\treturn res;\n}\nint Getg1(int a,int b,int c){\n\tint res=1;\n\tfor(int d=1,r;d<=min(a,b);d=r+1){\n\t\tr=min(a/(a/d),b/(b/d));\n\t\tres=(ll)res*Pow((ll)fii[r]*ifii[d-1]%P,(ll)sum(a/d)*sum(b/d)%(P-1))%P;\n\t}\n\tres=Pow(res,sum(c)%(P-1));\n\t// cout<<\"Getg1(\"<<a<<','<<b<<','<<c<<\"):\"<<res<<'\\n';\n\treturn res;\n}\nint Geti2(int a,int b,int c){\n\tint res=1;\n\tfor(int d=1,r;d<=min(a,min(b,c));d=r+1){\n\t\tr=min(a/(a/d),min(b/(b/d),c/(c/d)));\n\t\tres=(ll)res*Pow(fac[a/d],(ll)(b/d)*(c/d)%(P-1)*(phi[r]-phi[d-1]+P-1)%(P-1))%P;\n\t\tres=(ll)res*Pow((ll)dp[r]*idp[d-1]%P,(ll)(a/d)*(b/d)%(P-1)*(c/d)%(P-1))%P;\n\t}\n\t// cout<<\"Geti2(\"<<a<<','<<b<<','<<c<<\"):\"<<res<<'\\n';\n\treturn res;\n}\nint Getg2(int a,int b,int c){\n\tint res=1;\n\tfor(int d=1,r;d<=min(a,min(b,c));d=r+1){\n\t\tr=min(a/(a/d),min(b/(b/d),c/(c/d)));\n\t\tres=(ll)res*Pow(ProdGcd(a/d,b/d),(ll)(c/d)*(phi[r]-phi[d-1]+P-1)%(P-1))%P;\n\t\tres=(ll)res*Pow((ll)dp[r]*idp[d-1]%P,(ll)(a/d)*(b/d)%(P-1)*(c/d)%(P-1))%P;\n\t}\n\t// cout<<\"Getg2(\"<<a<<','<<b<<','<<c<<\"):\"<<res<<'\\n';\n\treturn res;\n}\n\n//Main\nint main(){\n\tios::sync_with_stdio(0);\n\tcin.tie(0),cout.tie(0);\n\tint cacnt; cin>>cacnt>>P;\n\t// clock_t start=clock();\n\tSieve();//\t\tcout<<f[2]<<'\\n';\n\twhile(cacnt--){\n\t\tint a,b,c,ans0,ans1,ans2;\n\t\tcin>>a>>b>>c;\n\t\tans0=(ll)Geti0(a,b,c)*Geti0(b,a,c)%P*Pow(Getg0(a,b,c),P-2)%P*Pow(Getg0(a,c,b),P-2)%P;\n\t\tans1=(ll)Geti1(a,b,c)*Geti1(b,a,c)%P*Pow(Getg1(a,b,c),P-2)%P*Pow(Getg1(a,c,b),P-2)%P;\n\t\tans2=(ll)Geti2(a,b,c)*Geti2(b,a,c)%P*Pow(Getg2(a,b,c),P-2)%P*Pow(Getg2(a,c,b),P-2)%P;\n\t\tcout<<ans0<<' '<<ans1<<' '<<ans2<<'\\n';\n\t}\n\t// clock_t end=clock();\n\t// cout<<db(end-start)/CLOCKS_PER_SEC<<'\\n';\n\treturn 0;\n}\n\n```\n---\n**\u795d\u5927\u5bb6\u5b66\u4e60\u6109\u5feb\uff01**",
        "postTime": 1595217960,
        "uid": 118365,
        "name": "George1123",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5518 \u3010[MtOI2019]\u5e7d\u7075\u4e50\u56e2\u3011"
    },
    {
        "content": "### \u5199\u5728\u524d\u9762\n\n\u4e0d\u6127\u83ab\u53cd\u795e\u4ed9\u9898\uff0c\u5fd9\u6d3b\u4e86\u52a0\u8d77\u6765\u5c06\u8fd1\u4e00\u5929\u65f6\u95f4\u603b\u7b97\u662f\u628a\u8fd9\u9053\u9898 AC \u4e86\uff0c\u771f\u662f\u5b66\u5230\u4e86\u597d\u591a\u505a\u8fd9\u7c7b\u9898\u7684\u4e00\u4e9b\u57fa\u672c\u7684\u5957\u8def\u548c\u65b9\u6cd5\uff0c~~\u4e00\u9053\u9876\u4e09\u9053~~\u3002\n\n### \u6b63\u6587\n\n\n\u6c42\uff1a\n\n$$\\Large\\prod_{i = 1}^A\\prod_{j = 1}^B\\prod_{k = 1}^C\\left(\\dfrac{\\operatorname{lcm}\\left(i, j\\right)}{\\gcd\\left(i, k\\right)}\\right)^{f\\left(type\\right)}$$\n\n\u8bb0 $f\\left(type\\right)$ \u4e3a $p$\uff0c\u7a0d\u5fae\u8f6c\u5316\u4e00\u4e0b\u5f0f\u5b50\n\n$$\\Large\\prod_{i = 1}^A\\prod_{j = 1}^B\\prod_{k = 1}^C\\left(\\dfrac{\\operatorname{lcm}\\left(i, j\\right)}{\\gcd\\left(i, k\\right)}\\right)^{f\\left(type\\right)}$$\n\n$$\\Large=\\prod_{i = 1}^A\\prod_{j = 1}^B\\prod_{k = 1}^C\\left(\\dfrac{ij}{\\gcd\\left(i, j\\right)\\gcd\\left(i, k\\right)}\\right)^{f\\left(type\\right)}$$\n\n$$\\Large = \\dfrac{\\left(\\prod_{i = 1}^A\\prod_{j = 1}^B\\prod_{k = 1}^Ci^p\\right)\\left(\\prod_{i = 1}^B\\prod_{j = 1}^A\\prod_{k = 1}^Ci^p\\right)}{\\left(\\prod_{i = 1}^A\\prod_{j = 1}^B\\prod_{k = 1}^C\\gcd\\left(i, j\\right)\\right)\\left(\\prod_{i = 1}^A\\prod_{j = 1}^C\\prod_{k = 1}^B\\gcd\\left(i, j\\right)\\right)}$$\n\n\u56e0\u6b64\u53ef\u4ee5\u8f6c\u5316\u4e3a\u6c42\u89e3\u8fd9\u4e24\u4e2a\u95ee\u9898\uff0c\u6ce8\u610f\u8fd9\u91cc\u7684 $a, b, c$ \u4e0d\u5b8c\u5168\u7b49\u540c\u4e8e\u539f\u9898\u4e2d\u7684 $A, B, C$\u3002\n\n$$\\Large\\prod_{i = 1} ^ a\\prod_{j = 1} ^ b\\prod_{k = 1} ^ c i^p$$\n$$\\Large \\prod_{i = 1} ^ a\\prod_{j = 1}^b\\prod_{k = 1}^c\\gcd\\left(i,j\\right)^p$$\n\n\n\uff08\u4e0b\u6587\u4e2d\u9ed8\u8ba4 $a < b < c$\uff0c\u5b9e\u9645\u4e0a\u5bf9\u4e09\u8005\u53d6\u4e2a\u6700\u5c0f\u503c\u505a\u6574\u9664\u5206\u5757\u7684\u4e0a\u754c\u5373\u53ef\u3002\uff09\n\n- $p = 1$\n\n\u7b2c\u4e00\u4e2a\u5f0f\u5b50\n\n\u5c06\u65e0\u5173\u7684\u63d0\u5230\u6307\u6570\u4e0a\u53bb\uff0c\u6709\u5173\u7684\u5316\u4e3a\u9636\u4e58\u5f62\u5f0f\u5373\u53ef\u3002\n\n$$\\Large\\prod_{i = 1}^ a \\prod_{j = 1} ^ b\\prod_{k = 1} ^ c i$$\n\n$$\\Large=\\left(a!\\right)^{bc}$$\n\n$$\\Large\\prod_{i = 1} ^  a\\prod_{j = 1} ^ b\\prod_{k = 1} ^ c\\gcd\\left(i, j\\right)$$\n\n\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\n\n\u540c\u6837\u662f\u628a\u65e0\u5173\u7684 $c$ \u63d0\u5230\u6307\u6570\u4e0a\u53bb\u3002\n\n\u5185\u90e8\u7684\u5f0f\u5b50\uff0c\u5219\u53c8\u662f\u4e00\u4e2a\u975e\u5e38\u7ecf\u5178\u7684\u83ab\u53cd\u6a21\u578b\uff0c\u76f8\u4fe1\u505a\u5230\u8fd9\u9053\u9898\u7684\u5404\u4f4d\u5927\u4f6c\u4eec\u90fd\u5f88\u5bb9\u6613\u5904\u7406\u3002\n\n$$=\\Large\\left(\\prod_{d = 1}^a d^{\\sum_{i = 1}^a\\sum_{j = 1}^b[\\gcd\\left(i, j\\right) = d]}\\right)^c$$\n\n$$=\\Large\\left(\\prod_{d = 1}^ad^{\\sum_{t = 1}^{a / d} \\mu\\left(t\\right)\\lfloor\\frac{a}{dt}\\rfloor\\lfloor\\frac{b}{dt}\\rfloor}\\right)^c$$\n\n$$\\Large= \\left(\\prod_{T = 1}^ a\\left(\\prod_{d|T}d^{\\mu\\left(\\frac{T}{d}\\right)}\\right)^{\\lfloor\\frac{a}{T}\\rfloor\\lfloor\\frac{b}{T}\\rfloor}\\right)^c$$\n\n\u5185\u5c42\u62ec\u53f7\u91cc\u9762\u662f\u53ef\u4ee5 $\\mathcal O\\left(n\\log n\\right)$ \u9884\u5904\u7406\u7684\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u5c31\u662f\u7c7b\u4f3c\u57c3\u6c0f\u7b5b\uff0c\u9884\u5904\u7406\u9006\u5143\u540e\u679a\u4e3e $d$ \u548c\u500d\u6570 $t$\uff0c\u7136\u540e\u628a $d^{\\mu\\left(t\\right)}$ \u4e58\u5230 $T$ \u7684\u7b54\u6848\u4e0a\u5373\u53ef\u3002\n\n- $p = ijk$\n\n\uff08\u8bbe $s\\left(n\\right) = \\sum_{i = 1}^n i =\\frac{n\\left(n + 1\\right)}{2}$\uff09\n\n\u7b2c\u4e00\u4e2a\u5f0f\u5b50\n\n$$\\Large\\prod_{i = 1}^ a \\prod_{j = 1} ^ b\\prod_{k = 1} ^ c i^{ijk}$$\n\n$$\\Large= \\left(\\prod_{i = 1}^ai^i\\right)^{s\\left(b\\right)s\\left(c\\right)}$$\n\n\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\n\n\u628a\u65e0\u5173\u7684 $c$ \u63d0\u5230\u6307\u6570\u4e0a\u53bb\uff0c\u679a\u4e3e $\\gcd\\left(i,j\\right)$ \u65f6\u8003\u8651\u5176\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u4ece\u800c\u5b9e\u73b0\u7edf\u8ba1\u6307\u6570\u3002\n\n$$\\Large\\prod_{i = 1}^ a\\prod_{j = 1}^b\\prod_{k = 1}^c\\gcd\\left(i, j\\right)^{ijk}$$\n\n$$\\Large= \\left(\\prod_{d = 1}^ad^{\\sum_{i = 1}^a\\sum_{j = 1} ^ b ij[\\gcd\\left(i, j\\right) = d]}\\right)^{s\\left(c\\right)}$$\n\n$$\\Large = \\left(\\prod_{d = 1}^a{d^{\\sum_{i = 1}^{a / d}\\sum_{j =1}^{b / d} d^2ij[\\gcd\\left(i, j\\right) = 1]}}\\right)^{s\\left(c\\right)}$$\n\n$$\\Large = \\left(\\prod_{d = 1}^a{d^{\\sum_{t = 1}^{a / d}\\mu\\left(t\\right)\\left(td\\right)^2s\\left(\\lfloor\\frac{a}{dt}\\rfloor\\right)s\\left(\\lfloor\\frac{b}{dt}\\rfloor\\right)}}\\right)^{s\\left(c\\right)}$$\n\n$$\\Large = \\left(\\prod_{T = 1}^a\\left(\\prod_{d|T}d^{\\mu\\left(\\frac{T}{d}\\right)}\\right)^{T^2s\\left(\\lfloor\\frac{a}{T}\\rfloor\\right)s\\left(\\lfloor\\frac{b}{T}\\rfloor\\right)}\\right)^{s\\left(c\\right)}$$\n\n\u540c\u6837\uff0c\u5185\u5c42\u62ec\u53f7\u91cc\u9762\u7684\u5f0f\u5b50\u53ef\u4ee5 $O\\left(n \\log n\\right)$ \u9884\u5904\u7406\uff0c\u8fd9\u4e0e\u4e0a\u4e00\u90e8\u5206\u6240\u9884\u5904\u7406\u7684\u4e0d\u540c\uff0c\u9700\u8981\u5c06\u5176\u7ed3\u679c\u4e58\u4e0a\u201c\u4e0b\u6807\u7684\u5e73\u65b9\u201d\u6b21\u5e42\u3002\n\n- $p = \\gcd\\left(i, j, k\\right)$\n\n\u7b2c\u4e00\u4e2a\u5f0f\u5b50\n\n$$\\Large \\prod_{i = 1}^a\\prod_{j = 1}^b\\prod_{k = 1}^ci^{\\gcd\\left(i, j, k\\right)}$$\n\n\u8003\u8651\u679a\u4e3e $\\gcd\\left(i, j, k\\right)$\u3002\n\n$$\\Large= \\prod_{d = 1}^a\\prod_{i = 1}^a\\prod_{j = 1}^b\\prod_{k = 1}^ci^{d[\\gcd\\left(i, j, k\\right) = d]}$$\n\n$$\\Large= \\prod_{d = 1}^a\\prod_{i = 1}^ai^{d\\sum_{j = 1}^b\\sum_{k = 1}^c[\\gcd\\left(i, j, k\\right) = d]}$$\n\n$$\\Large= \\prod_{d = 1}^a\\prod_{i = 1}^{a / d}\\left(id\\right)^{d\\sum_{j = 1}^{b / d}\\sum_{k = 1}^{c / d}[\\gcd\\left(i, j, k\\right) = 1]}$$\n\n$$\\Large = \\prod_{d = 1}^a\\prod_{i = 1}^{a / d}\\left(id\\right)^{d\\sum_{j = 1}^{b / d}\\sum_{k = 1}^{c / d}\\sum_{t|\\gcd\\left(i, j, k\\right)} \\mu\\left(t\\right)}$$\n\n$$\\Large = \\prod_{d = 1}^a\\prod_{i = 1}^{a / dt}\\left(idt\\right)^{d\\mu\\left(t\\right)\\lfloor\\frac{b}{dt}\\rfloor\\lfloor\\frac{c}{dt}\\rfloor}$$\n\n$$\\Large = \\prod_{d = 1}^a\\prod_{i = 1}^{a / dt}\\left(idt\\right)^{d\\sum_{t = 1}^{a / d}\\mu\\left(t\\right)\\lfloor\\frac{b}{dt}\\rfloor\\lfloor\\frac{c}{dt}\\rfloor}$$\n\n$$\\Large = \\prod_{d = 1}^a\\left(\\prod_{i = 1}^{a / dt}\\left(idt\\right)\\right)^{d\\sum_{t = 1}^{a / d}\\mu\\left(t\\right)\\lfloor\\frac{b}{dt}\\rfloor\\lfloor\\frac{c}{dt}\\rfloor}$$\n\n\uff08\u4ece\u8fd9\u53e5\u8bdd\u4e0a\u9762\u90a3\u4e2a\u5f0f\u5b50\u63a8\u5230\u4e0b\u9762\u90a3\u4e2a\u5f0f\u5b50\u8de8\u5ea6\u53ef\u80fd\u6bd4\u8f83\u5927\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u8fde\u4e58\u53f7\u91cc\u9762\u8ddf $i$ \u6709\u5173\u7684\u5316\u6210\u9636\u4e58\uff0c\u65e0\u5173\u7684\u63d0\u51fa\u6765\uff0c\u63d0\u51fa\u6765\u7684\u65f6\u5019\u8981\u4e58\u4e0a\u201c\u8fde\u4e58\u7684\u6b21\u6570\u201d\u6b21\u65b9\uff09\n\n$$\\Large = \\prod_{T = 1} ^ a \\left(\\prod_{d | T}\\left(\\lfloor\\frac{a}{T}\\rfloor\\right)!T^{\\lfloor\\frac{a}{T}\\rfloor}\\right)^{d\\mu\\left(\\frac{T}{d}\\right)\\lfloor\\frac{b}{T}\\rfloor\\lfloor\\frac{c}{T}\\rfloor}$$\n\n$$\\Large = \\prod_{T = 1} ^ a \\left(\\left(\\lfloor\\frac{a}{T}\\rfloor\\right)!T^{\\lfloor\\frac{a}{T}\\rfloor}\\right)^{\\left(\\sum_{d|T}d\\mu\\left(\\frac{T}{d}\\right)\\right)\\lfloor\\frac{b}{T}\\rfloor\\lfloor\\frac{c}{T}\\rfloor}$$\n\n$$\\Large = \\prod_{T = 1} ^ a \\left(\\left(\\left(\\lfloor\\frac{a}{T}\\rfloor\\right)!T^{\\lfloor\\frac{a}{T}\\rfloor}\\right)^{\\varphi\\left(T\\right)}\\right)^{\\lfloor\\frac{b}{T}\\rfloor\\lfloor\\frac{c}{T}\\rfloor}$$\n\n$$\\Large = \\prod_{T = 1} ^ a \\left(\\left(\\left(\\lfloor\\frac{a}{T}\\rfloor\\right)!\\right)^{\\varphi\\left(T\\right)}\\right)^{\\lfloor\\frac{b}{T}\\rfloor\\lfloor\\frac{c}{T}\\rfloor}\\prod_{T = 1}^aT^{\\varphi\\left(T\\right)\\lfloor\\frac{a}{T}\\rfloor\\lfloor\\frac{b}{T}\\rfloor\\lfloor\\frac{c}{T}\\rfloor}$$\n\n\n\u8fd9\u91cc\u628a\u524d\u9762\u5355\u72ec\u62ff\u51fa\u6765\u4f5c\u4e3a\u7b2c\u4e09\u90e8\u5206\u7b2c\u4e00\u4e2a\u5f0f\u5b50\u7684\u7ed3\u679c\u3002\u56e0\u4e3a\u540e\u9762\u7684\u90a3\u4e2a\u5f0f\u5b50\u5728\u63a5\u4e0b\u6765\u7684\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u7ea6\u6389\uff0c\u5177\u4f53\u8bf7\u770b\u63a5\u4e0b\u6765\u7684\u8bc1\u660e\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8981\u6c42\u7684\u662f\u8fd9\u4e2a\n\n$$\\Large  \\prod_{T = 1} ^ a \\left(\\left(\\left(\\lfloor\\frac{a}{T}\\rfloor\\right)!\\right)^{\\varphi\\left(T\\right)}\\right)^{\\lfloor\\frac{b}{T}\\rfloor\\lfloor\\frac{c}{T}\\rfloor}$$\n\n\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\n\n$$\\Large\\prod_{i = 1}^a\\prod_{j = 1}^b\\prod_{k = 1}^c\\gcd\\left(i, j\\right)^{\\gcd\\left(i, j, k\\right)}$$\n\n$$\\Large=\\prod_{d = 1}^a\\prod_{i = 1}^{a}\\prod_{j = 1}^{b}\\left(d\\gcd\\left(i, j\\right)\\right)^{d\\sum_{k = 1}^{c}[\\gcd\\left(i, j, k\\right) = d]}$$\n\n$$\\Large=\\prod_{d = 1}^a\\prod_{i = 1}^{a/d}\\prod_{j = 1}^{b/d}\\left(d\\gcd\\left(i, j\\right)\\right)^{d\\sum_{k = 1}^{c/d}\\sum_{t|\\gcd\\left(i, j, k\\right)}\\mu\\left(t\\right)}$$\n\n$$\\Large=\\prod_{d = 1}^a\\prod_{t = 1}^{a / d}\\prod_{i = 1}^{a/dt}\\prod_{j = 1}^{b/dt}\\left(dt\\gcd\\left(i, j\\right)\\right)^{d\\mu\\left(t\\right)\\lfloor\\frac{c}{dt}\\rfloor}$$\n\n$$\\Large=\\prod_{d = 1}^a\\prod_{t = 1}^{a / d}\\prod_{i = 1}^{a/dt}\\prod_{j = 1}^{b/dt}\\left(\\gcd\\left(i, j\\right)\\right)^{d\\mu\\left(t\\right)\\lfloor\\frac{c}{dt}\\rfloor}\\prod_{T = 1}^aT^{\\varphi\\left(T\\right)\\lfloor\\frac{a}{T}\\rfloor\\lfloor\\frac{b}{T}\\rfloor\\lfloor\\frac{c}{T}\\rfloor}$$\n\n\u540e\u9762\u90a3\u90e8\u5206\u53d1\u73b0\u5728\u8ba1\u7b97\u7684\u65f6\u5019\u6b63\u597d\u53ef\u4ee5\u548c\u5206\u5b50\u4e0a\u7ea6\u6389\u3002\u8003\u8651\u5355\u72ec\u8ba1\u7b97\u524d\u9762\u90a3\u90e8\u5206\n\n$$\\Large=\\prod_{d = 1}^a\\prod_{t = 1}^{a / d}\\prod_{i = 1}^{a/dt}\\prod_{j = 1}^{b/dt}\\left(\\gcd\\left(i, j\\right)\\right)^{d\\mu\\left(t\\right)\\lfloor\\frac{c}{dt}\\rfloor}$$\n\n$$\\Large = \\prod_{r = 1}^a r^{\\sum_{d = 1}^ad\\sum_{t = 1}^{a / d}\\mu\\left(t\\right)\\lfloor\\frac{c}{dt}\\rfloor\\sum_{i = 1}^{a/dt}\\sum_{j = 1}^{b/dt}[\\gcd\\left(i, j\\right) = r]}$$\n\n$$\\Large = \\prod_{r = 1}^a \\prod_{d = 1}^ar^{d\\sum_{t = 1}^{a / d}\\mu\\left(t\\right)\\sum_{t_1 = 1}^{a / r}\\mu\\left(t_1\\right)\\lfloor\\frac{a}{dtrt_1}\\rfloor\\lfloor\\frac{b}{dtrt_1}\\rfloor\\lfloor\\frac{c}{dt}\\rfloor}$$\n\n$$\\Large = \\prod_{T = 1}^a\\prod_{T_1 = 1}^a\\left(\\prod_{r | T_1}r^{\\mu\\left(\\frac{T_1}{r}\\right)}\\right)^{\\left(\\sum_{d|T}d\\mu\\left(\\frac{T}{d}\\right)\\right)\\lfloor\\frac{a}{TT_1}\\rfloor\\lfloor\\frac{b}{TT_1}\\rfloor\\lfloor\\frac{c}{T}\\rfloor}$$\n\n$$\\Large = \\prod_{T = 1}^a\\prod_{T_1 = 1}^a\\left(\\prod_{r | T_1}r^{\\mu\\left(\\frac{T_1}{r}\\right)}\\right)^{\\varphi\\left(T\\right)\\lfloor\\frac{a}{TT_1}\\rfloor\\lfloor\\frac{b}{TT_1}\\rfloor\\lfloor\\frac{c}{T}\\rfloor}$$\n\n\u597d\u4e86\uff0c\u5230\u6b64\u4e3a\u6b62\u4e86\uff0c\u603b\u7ed3\u4e00\u4e0b\u9700\u8981\u5904\u7406\u7684\u4e1c\u897f\uff0c\u4ee5\u4e3a\u6211\u4eec\u7f16\u5199\u4ee3\u7801\u63d0\u4f9b\u65b9\u4fbf\u3002\n\n- $\\varphi,\\mu$\u3002\n- \u9636\u4e58\u3002\uff08$1.1$ \u548c $3.1$\uff09\n- $\\varphi$ \u51fd\u6570\u5728\u6a21 $p - 1$ \u610f\u4e49\u4e0b\u7684\u524d\u7f00\u548c\u3002\uff08$3.1$\uff09\n- $i^i$ \u53ca\u524d\u7f00\u79ef\u3002\uff08$2.1$\uff09\n- $\\prod_{d|T}d^{\\mu\\left(\\frac{T}{d}\\right)}$ \u53ca\u5176\u4e0b\u6807\u7684\u5e73\u65b9\u6b21\u5e42\u548c\u524d\u7f00\u79ef\u3002\uff08$1.2$ \u548c $2.2$ \u548c $3.2$\uff09\n- $s\\left(n\\right) = \\dfrac{n\\left(n + 1\\right)}{2}$\u3002\uff08$2.1$ \u548c $2.2$\uff09\n- \u51e1\u662f\u9700\u8981\u8ba1\u7b97\u524d\u7f00\u79ef\u7684\uff0c\u8fd8\u9700\u8981\u5012\u63a8\u9006\u5143\u524d\u7f00\u79ef\u3002\n\n### Tips\n\n\u5728\u5927\u91cf\u8ba1\u7b97\u4ee3\u7801\u7684\u7f16\u5199\u65f6\u4e00\u5b9a\u8981\u6ce8\u610f\u968f\u65f6\u53d6\u6a21\uff0c\u5e76\u5c24\u5176\u8981\u6ce8\u610f\u51cf\u6cd5\u53d6\u6a21\u548c\u6307\u6570\u53d6\u6a21\u3002\n\n\u5728\u505a\u5de8\u5927\u7801\u91cf\u7684\u9898\u76ee\u65f6\uff0c\u5c24\u5176\u662f\u50cf\u8fd9\u79cd\u591a\u5408\u4e00\u7684\u9898\u76ee\u65f6\uff0c\u4e00\u5b9a\u8981\u7406\u6e05\u601d\u8def\uff0c\u4ee3\u7801\u8981\u5c3d\u53ef\u80fd\u6709\u6761\u7406\u3002\n\n### Code\n\n```cpp\n#include <bits/stdc++.h>\n\n#define LL long long\n\nusing namespace std;\n \nnamespace I {\n\ttemplate <typename Temp> inline void read(Temp & res) {\n\t\tTemp fh = 1; res = 0; char ch = getchar();\n\t\tfor(; !isdigit(ch); ch = getchar()) if(ch == '-') fh = -1;\n\t\tfor(; isdigit(ch); ch = getchar()) res = (res << 3) + (res << 1) + (ch ^ '0');\n\t\tres = res * fh;\n\t}\n}\n \nconst int Maxn = 1e5 + 5;\n\nint T, n, A, B, C; LL Mod = 1;\n\nnamespace M {\n\t#define N 100000\n\tinline LL qpow(LL a_qp, LL p_qp) {\n\t\tLL res = 1;\n\t\twhile(p_qp) {\n\t\t\tif(p_qp & 1) res = res * a_qp % Mod;\n\t\t\ta_qp = a_qp * a_qp % Mod;\n\t\t\tp_qp >>= 1; \n\t\t}\n\t\treturn res;\n\t}\n\t\n\tint prime[Maxn], cnt_pri; LL phi[Maxn], mu[Maxn]; bool isprime[Maxn];\n\tvoid sieve() {\n\t\tphi[1] = mu[1] = 1;\n\t\tfor(int i = 2; i <= N; ++i) {\n\t\t\tif(!isprime[i]) {\n\t\t\t\tprime[++cnt_pri] = i;\n\t\t\t\tphi[i] = i - 1; mu[i] = -1;\n\t\t\t}\n\t\t\tfor(int j = 1; j <= cnt_pri && prime[j] <= N / i; ++j) {\n\t\t\t\tint cur = i * prime[j];\n\t\t\t\tisprime[cur] = 1;\n\t\t\t\tif(i % prime[j] == 0) {\n\t\t\t\t\tphi[cur] = phi[i] * prime[j];\n\t\t\t\t\tmu[cur] = 0; break;\n\t\t\t\t} else {\n\t\t\t\t\tphi[cur] = phi[i] * (prime[j] - 1);\n\t\t\t\t\tmu[cur] = -mu[i]; \n\t\t\t\t}\n\t\t\t}\n\t\t} \n\t}\n\t\n\tLL fac[Maxn], invf[Maxn], inv[Maxn];\n\tvoid getinv() {\n\t\tfac[0] = 1; inv[0] = 1;\n\t\tfor(int i = 1; i <= N; ++i) fac[i] = 1ll * fac[i - 1] * i % Mod;\n\t\tinvf[N] = qpow(fac[N], Mod - 2);\n\t\tfor(int i = N - 1; i >= 0; --i) invf[i] = 1ll * invf[i + 1] * (i + 1) % Mod;\n\t\tfor(int i = 1; i <= N; ++i) inv[i] = invf[i] * fac[i - 1] % Mod; \n\t}\n\t\n\tLL s(int n_s) {\n\t\treturn 1ll * n_s * (n_s + 1) / 2 % (Mod - 1);\n\t}\n\t\n\tLL sphi[Maxn]/*Mod by (p - 1)*/, f[Maxn], ftp[Maxn], ip[Maxn], fip[Maxn];/*prod d^mu(T/d), i^i and its prefix*/\n\tLL ffac[Maxn], ftpfac[Maxn], finvf[Maxn], ftpinvf[Maxn], finv[Maxn], ftpinv[Maxn];\n\t//fac of f, fac of f^(T^2), fac_inv of f, fac_inv of f^(T^2), inv of f, inv of f^(T^2)\n\tvoid Init() {\n\t\tsieve(); getinv(); fip[0] = 1; finv[0] = ftpinv[0] = 1;\n\t\tfor(int i = 1; i <= N; ++i) ip[i] = qpow((LL)i, (LL)i), fip[i] = fip[i - 1] * ip[i] % Mod;\n\t\tfor(int i = 1; i <= N; ++i) sphi[i] = (sphi[i - 1] + phi[i]) % (Mod - 1);\n\t\tfor(int i = 1; i <= N; ++i) f[i] = 1;\n\t\tfor(int d = 1; d <= N; ++d) {\n\t\t\tfor(int t = 1; t <= N / d; ++t) {\n\t\t\t\tif(mu[t] == -1) f[d * t] = f[d * t] * inv[d] % Mod;\n\t\t\t\telse if(mu[t] == 1) f[d * t] = f[d * t] * d % Mod; \n\t\t\t}\n\t\t}\n\t\tfor(int i = 1; i <= N; ++i) ftp[i] = qpow(f[i], 1ll * i * i % (Mod - 1)) % Mod;\n\t\tffac[0] = ftpfac[0] = 1;\n\t\tfor(int i = 1; i <= N; ++i) ffac[i] = ffac[i - 1] * f[i] % Mod,\n\t\tftpfac[i] = ftpfac[i - 1] * ftp[i] % Mod;\n\t\tfinvf[N] = qpow(ffac[N], Mod - 2); ftpinvf[N] = qpow(ftpfac[N], Mod - 2);\n\t\tfor(int i = N - 1; i >= 0; --i) finvf[i] = finvf[i + 1] * f[i + 1] % Mod,\n\t\tftpinvf[i] = ftpinvf[i + 1] * ftp[i + 1] % Mod;\n\t\tfor(int i = 1; i <= N; ++i) finv[i] = finvf[i] * ffac[i - 1] % Mod,\n\t\tftpinv[i] = ftpinvf[i] * ftpfac[i - 1] % Mod;\n\t}\n\t#undef N\n}\n\nnamespace ANS {\n\tusing namespace M;\n\tLL A1(int a, int b, int c) {\n\t\treturn qpow(fac[a], 1ll * b * c % (Mod - 1));\n\t}\n\tLL A2(int a, int b, int c) {\n\t\tLL res = 1;\n\t\tif(a > b) swap(a, b);\n\t\tfor(int l = 1, r = 1; l <= a; l = r + 1) {\n\t\t\tr = min(a / (a / l), b / (b / l)); r = min(r, a);\n\t\t\tres = res * qpow(ffac[r] * finvf[l - 1] % Mod, 1ll * (a / l) * (b / l) % (Mod - 1)) % Mod;\n\t\t}\n\t\treturn qpow(res, (LL)c);\n\t}\n\tLL B1(int a, int b, int c) {\n\t\treturn qpow(fip[a], s(b) % (Mod - 1) * (s(c) % (Mod - 1)) % (Mod - 1));\n\t}\n\tLL B2(int a, int b, int c) {\n\t\tLL res = 1;\n\t\tif(a > b) swap(a, b);\n\t\tfor(int l = 1, r = 1; l <= a; l = r + 1) {\n\t\t\tr = min(a / (a / l), b / (b / l)); r = min(r, a);\n\t\t\tres = res * qpow(ftpfac[r] * ftpinvf[l - 1] % Mod, s(a / l) * s(b / l) % (Mod - 1)) % Mod;\n\t\t}\n\t\treturn qpow(res, s(c) % (Mod - 1));\n\t}\n\tLL C1(int a, int b, int c) {\n\t\tint m = min(a, min(b, c)); LL res = 1;\n\t\tfor(int l = 1, r = 1; l <= m; l = r + 1) {\n\t\t\tr = min(a / (a / l), min(b / (b / l), c / (c / l)));\n\t\t\tLL cur = qpow(fac[a / l], 1ll * (b / l) * (c / l) % (Mod - 1));\n\t\t\tres = res * qpow(cur, ((sphi[r] - sphi[l - 1]) % (Mod - 1) + (Mod - 1)) % (Mod - 1)) % Mod; \n\t\t}\n\t\treturn res;\n\t}\n\tLL C2_0(int a, int b) {\n\t\tLL res = 1;\n  \tfor (int l = 1, r = 1; l <= min(a, b); l = r + 1) {\n    \tr = min(a / (a / l), b / (b / l));\n    \tres = res * qpow(ffac[r] * finvf[l - 1] % Mod, 1ll * (a / l) * (b / l) % (Mod - 1)) % Mod;\n  \t}\n  \treturn res;\n\t} \n\tLL C2(int a, int b, int c) {\n\t\tint m = min(a, min(b, c)); LL res = 1;\n\t\tfor(int l = 1, r = 1; l <= m; l = r + 1) {\n\t\t\tr = min(a / (a / l), min(b / (b / l), c / (c / l)));\n\t\t\tLL cur = qpow(C2_0(a / l, b / l), 1ll * (c / l));\n\t\t\tres = res * qpow(cur, ((sphi[r] - sphi[l - 1]) % (Mod - 1) + (Mod - 1)) % (Mod - 1)) % Mod;\n\t\t}\n\t\treturn res;\n\t}\n\tLL Solve(int a, int b, int c, int type) {\n\t\tif(type == 0) {\n\t\t\treturn 1ll * A1(a, b, c) * A1(b, a, c) % Mod * qpow(A2(a, b, c) * A2(a, c, b) % Mod, Mod - 2) % Mod;\n\t\t} else if(type == 1) {\n\t\t\treturn 1ll * B1(a, b, c) * B1(b, a, c) % Mod * qpow(B2(a, b, c) * B2(a, c, b) % Mod, Mod - 2) % Mod;\n\t\t} else {\n\t\t\treturn 1ll * C1(a, b, c) * C1(b, a, c) % Mod * qpow(C2(a, b, c) * C2(a, c, b) % Mod, Mod - 2) % Mod;\n\t\t}\n\t}\n}\n\nint main() {\n\tusing namespace I;\n\tread(T); read(Mod); M::Init();\n\twhile(T--) {\n\t\tread(A); read(B); read(C);\n\t\tfor(int i = 0; i <= 2; ++i) printf(\"%lld \", ANS::Solve(A, B, C, i));\n\t\tprintf(\"\\n\");\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1616237592,
        "uid": 118196,
        "name": "zimujun",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P5518 \u3010[MtOI2019]\u5e7d\u7075\u4e50\u56e2 / \u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u57fa\u7840\u7ec3\u4e60\u9898\u3011"
    },
    {
        "content": "### \u524d\u8a00\n\u8bf7\u786e\u4fdd\u4f60\u5728\u505a\u6b64\u9898\u4e4b\u524d\u505a\u8fc7\n\n[P1390 \u516c\u7ea6\u6570\u7684\u548c](https://www.luogu.com.cn/problem/P1390)\n\n[P2303 [SDOI2012]Longge\u7684\u95ee\u9898](https://www.luogu.com.cn/problem/P2303)\n\n[P1829 [\u56fd\u5bb6\u96c6\u8bad\u961f]Crash\u7684\u6570\u5b57\u8868\u683c / JZPTAB](https://www.luogu.com.cn/problem/P1829)\n\n[P3704 [SDOI2017]\u6570\u5b57\u8868\u683c](https://www.luogu.com.cn/problem/P3704)\n\n\u5e76\u6709\u4e00\u5b9a\u7684\u53cd\u6f14\u829d\u58eb\u4ee5\u83b7\u5f97\u66f4\u597d\u7684\u505a\u9898\u4f53\u9a8c\n\n\u7531\u4e8e\u662f\u65ad\u65ad\u7eed\u7eed\u505a\u7684\u53ef\u80fd\u67ff\u5b50\u5199\u7684\u6709\u4e0d\u5bf9\u7684\u5730\u65b9\u770b\u51fa\u6765\u7684\u4eba\u53ef\u4ee5\u6307\u51fa\u6765\uff0c\u8c22\u8c22~\n\n### \u7b80\u5316\u9898\u9762\n\u6c42\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C}\\left(\\frac{\\text{lcm}(i,j)}{\\gcd(i,k)}\\right)^{f(type)}$$\n\n\u5bf9\u4e8e$f(x)$\u6709\n$$f(0)=1$$\n$$f(1)=i \\times j \\times k$$\n$$f(2)=\\gcd(i,j,k)$$\n\n\u5bf9\u4e8e$type$\u4ec5\u6709$0,1,2$\u4e09\u79cd\u53d6\u503c\n\n\u5bf9\u4e8e\u6570\u636e\n$$ 1\\leq A,B,C\\leq 10^5 \\ \\ \\ \\ 10^7 \\leq p \\leq 1.05\\times 10^9\\ \\ \\ \\ p\\in \\{ prime\\} \\ \\ \\ \\ T =70$$\n\n### \u89e3\u9898\u601d\u8def\n~~\u7b2c\u4e00\u773c\u770b\u5c31\u662f\u5927\u6bd2\u7624\u9898~~\n\n\u9996\u5148\u5bf9\u539f\u67ff\u5b50\u8fdb\u884c\u5c55\u5f00\n$$ \\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} \\left(\\frac{i\\times j}{gcd(i,j)\\times gcd(i,k)}\\right)^{f(type)}$$\n\n\u5f88\u663e\u7136\u7684\u53ef\u4ee5\u62c6\u6210\u4e24\u4e2a\u67ff\u5b50\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i^{f(type)}$$\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} gcd(i,j)^{f(type)}$$\n\n\u6240\u4ee5\u53d8\u6210\u4e86\u5bf9\u4e8e\u516d\u4e2a\u5b50\u95ee\u9898\u7684\u5316\u7b80\uff0c\u6162\u6162\u68b3\u7406\n\n#### Type=0\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i$$\n\n$$=\\prod_{i=1}^{A}\\prod_{j=1}^{B}i^C$$\n\n$$=(\\prod_{i=1}^{A}i)^{C\\times B}$$\n\u76f4\u63a5\u9884\u5904\u7406\u9636\u4e58\u5c31\u53ef\u4ee5\u6c42\u5f97\n\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} gcd(i,j)$$\n\n$$=(\\prod_{i=1}^{A}\\prod_{j=1}^{B} gcd(i,j))^C$$\n\n\u8003\u8651\u50cf\u6570\u5b57\u8868\u683c\u4e00\u6837\u8fdb\u884c\u5904\u7406\n\n$$=(\\prod_{d=1} d^{\\sum_{i=1}^{A/d}\\sum_{j=1}^{B/d} [gcd(i,j)=1]})^C$$\n\n$$=(\\prod_{d=1} d^{\\sum_{p=1}\\mu(p)\\left\\lfloor\\frac{A}{dp}\\right\\rfloor\\left\\lfloor\\frac{B}{dp}\\right\\rfloor})^C$$\n\n$$=(\\prod_{Q=1}(\\prod_{d|Q}d^{\\mu(\\frac{Q}{d})})^{\\left\\lfloor\\frac{A}{Q}\\right\\rfloor\\left\\lfloor\\frac{B}{Q}\\right\\rfloor})^{C}$$\n\n\u9884\u5904\u7406\u7136\u540e\u5206\u5757\u505a\u5373\u53ef\n\n#### Type=1\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i^{i\\times j \\times k}$$\n\n$$=\\prod_{i=1}^{A}\\prod_{j=1}^{B} i^{i \\times j \\times \\sum_{k=1}^{C}k}$$\n\n$$=\\prod_{i=1}^{A} i^{i \\times \\sum_{j=1}^{B}j \\times \\sum_{k=1}^{C}k}$$\n\n\u8d28\u6570\u90e8\u5206\u5904\u7406\u4e00\u4e2a\u7b49\u5dee\u6570\u5217\u6c42\uff0c\u5e76\u4e14\u9884\u5904\u7406$i*i$\u7684\u9636\u4e58\u76f4\u63a5\u6c42\u5c31\u53ef\u4ee5\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} gcd(i,j)^{i\\times j \\times k}$$\n\n\u7b2c\u4e00\u773c\u770b\u771f\u4e0d\u77e5\u9053\u4ece\u54ea\u91cc\u4e0b\u624b\uff0c\u601d\u8003\u4e4b\u540e\u8003\u8651\u5148\u628a\u6ca1\u7528\u7684\u4e1c\u897f\u62ff\u51fa\u6765\n\n$$=\\prod_{i=1}^{A}\\prod_{j=1}^{B} gcd(i,j)^{i\\times j \\times \\sum_{k=1}^{C}k}$$\n\n\u7136\u540e\u4f60\u4f1a\u611f\u89c9\u8fd9\u4e2a\u67ff\u5b50\u6709\u70b9\u773c\u719f\uff0c\u5f88\u50cfCrash\u7684\u6570\u5b57\u8868\u683c\uff0c\u4e8e\u662f\u6211\u4eec\u6309\u7167\u5f53\u65f6\u7684\u60f3\u6cd5\u8fdb\u884c\u8ba1\u7b97\n\n$$\\begin{aligned}=(\\prod_{d=1}d^{d^2\\sum_{i=1}^{A/d}\\sum_{j=1}^{B/d} i \\times j \\times [gcd(i, j)=1]})^{\\sum_{k=1}^{C}k}\\end{aligned}$$\n\n$$\\begin{aligned}=(\\prod_{d=1}d^{\\sum_{p=1}d^2\\mu(p)p^2sum(\\left\\lfloor\\frac{A}{dp}\\right\\rfloor)sum(\\left\\lfloor\\frac{B}{dp}\\right\\rfloor)})^{\\sum_{k=1}^{C}k}\\end{aligned}$$\n\n$$\\begin{aligned}=(\\prod_{Q=1}((\\prod_{d|Q} d^{\\mu(\\frac{Q}{d})})^{Q^2})^{sum(\\left\\lfloor\\frac{A}{Q}\\right\\rfloor)sum(\\left\\lfloor\\frac{B}{Q}\\right\\rfloor)})^{\\sum_{k=1}^{C}k}\\end{aligned}$$\n\n\u663e\u7136\u7684\u548c$type0$\u4e00\u6837\u8fdb\u884c\u9884\u5904\u7406\u7136\u540e\u5206\u5757\u505a\u5373\u53ef\n\n#### Type=2\n\n\u8fd9\u9053\u9898\u6700\u5927\u7684\u4eae\u70b9~~\u6700\u5927\u7684\u6bd2\u7624~~\u7684\u5730\u65b9\n\n\u8001\u5957\u8def\u679a\u4e3e$gcd$\n\n$$\\begin{aligned}\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i^{gcd(i,j,k)}\\end{aligned}$$\n\n$$\\begin{aligned}=\\prod_{d=1}\\prod_{i=1}^A i^{d\\times \\sum_{j=1}^B\\sum_{k=1}^C[gcd(i,j,k)=d]}\\end{aligned}$$\n\n$$\\begin{aligned}=\\prod_{d=1}\\prod_{i=1}^{(\\left\\lfloor\\frac{A}{d}\\right\\rfloor)} i\\times d ^{d\\times \\sum_{j=1}^{(\\left\\lfloor\\frac{B}{d}\\right\\rfloor)}\\sum_{k=1}^{(\\left\\lfloor\\frac{C}{d}\\right\\rfloor)}[gcd(i,j,k)=1]}\\end{aligned}$$\n\n$$=\\prod_{d=1}\\prod_{i=1}^{(\\left\\lfloor\\frac{A}{d}\\right\\rfloor)} (i\\times d) ^{d\\times \\sum_{p=1}\\mu(p)(\\left\\lfloor\\frac{B}{dp}\\right\\rfloor)(\\left\\lfloor\\frac{C}{dp}\\right\\rfloor)}$$\n\n\u8003\u8651\u628a\u6307\u6570\u4e0a\u7684$\\sum$\u62ff\u5230\u4e0b\u9762\u6765\n\n$$=\\prod_{d=1}\\prod_{p=1}\\prod_{i=1}^{(\\left\\lfloor\\frac{A}{dp}\\right\\rfloor)} (i\\times d\\times p) ^{d\\times\\mu(p)(\\left\\lfloor\\frac{B}{dp}\\right\\rfloor)(\\left\\lfloor\\frac{C}{dp}\\right\\rfloor)}$$\n\n$$=\\prod_{Q=1}(\\prod_{d|Q}(\\prod_{i=1}^{(\\left\\lfloor\\frac{A}{Q}\\right\\rfloor)}i\\times Q)^{d\\times \\mu(\\left\\lfloor\\frac{Q}{d}\\right\\rfloor)})^{(\\left\\lfloor\\frac{B}{Q}\\right\\rfloor)(\\left\\lfloor\\frac{C}{Q}\\right\\rfloor)}$$\n\n\u8003\u8651\u518d\u628a$\\prod$\u62ff\u4e0a\u53bb\n\n$$=\\prod_{Q=1}((\\prod_{i=1}^{(\\left\\lfloor\\frac{A}{Q}\\right\\rfloor)}i\\times Q)^{d\\times \\sum_{d|Q}\\mu(\\left\\lfloor\\frac{Q}{d}\\right\\rfloor)})^{(\\left\\lfloor\\frac{B}{Q}\\right\\rfloor)(\\left\\lfloor\\frac{C}{Q}\\right\\rfloor)}$$\n\n\u7136\u540e\u4f60\u4f1a\u53d1\u73b0$d\\times \\sum_{d|Q}\\mu(\\left\\lfloor\\frac{Q}{d}\\right\\rfloor)$\u975e\u5e38\u7684\u773c\u719f\uff0c$id*\\mu=\\varphi$\n\n$$=\\prod_{Q=1}((\\prod_{i=1}^{(\\left\\lfloor\\frac{A}{Q}\\right\\rfloor)}i\\times Q)^{\\varphi(Q)})^{(\\left\\lfloor\\frac{B}{Q}\\right\\rfloor)(\\left\\lfloor\\frac{C}{Q}\\right\\rfloor)}$$\n\n\u9884\u5904\u7406$\\varphi$\u7684\u524d\u7f00\u548c\uff0c\u7528\u4e4b\u524d\u6c42\u5f97\u9636\u4e58\u4e71\u641e\u5c31\u53ef\u4ee5\u4e86\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} gcd(i,j)^{gcd(i,j,k)}$$\n\n\u8fd9\u4e2a\u9898\u6700\u6076\u5fc3\u4eba\u7684\u67ff\u5b50\uff0c\u8fd8\u662f\u8003\u8651\u679a\u4e3e$gcd$\uff0c\u5148\u8003\u8651\u679a\u4e3e$gcd(i,j)$\n\n$$=\\prod_{d=1}^{A} d^{\\sum_{i=1}^A\\sum_{j=1}^B [gcd(i,j)=d]\\times (\\sum_{k=1}^{C} gcd(d,k))}$$\n\n$$=\\prod_{d=1}d^{\\sum_{i=1}^{(\\left\\lfloor\\frac{A}{d}\\right\\rfloor)}\\sum_{j=1}^{(\\left\\lfloor\\frac{B}{d}\\right\\rfloor)}[gcd(i,j)=1] \\times (\\sum_{k=1}^{C} gcd(d,k))}$$\n\n$$=\\prod_{d=1}d^{(\\sum_{p=1}\\mu(p)\\left\\lfloor\\frac{A}{dp}\\right\\rfloor\\left\\lfloor\\frac{B}{dp}\\right\\rfloor) \\times (\\sum_{k=1}^{C} gcd(d,k))}$$\n\n$$=\\prod_{Q=1}(\\prod_{d|Q}d^{\\mu(\\left\\lfloor\\frac{Q}{d}\\right\\rfloor) \\times (\\sum_{k=1}^{C} gcd(d,k))})^{\\left\\lfloor\\frac{A}{Q}\\right\\rfloor\\left\\lfloor\\frac{B}{Q}\\right\\rfloor}$$\n\n\u5bf9$\\sum_{k=1}^{C} gcd(d,k)$\u7ee7\u7eed\u8fdb\u884c\u53cd\u6f14\n\n\u4f60\u4f1a\u53d1\u73b0\u8fd9\u4e0d\u5c31\u662f$Longge$\u7684\u95ee\u9898\u91cc\u9762\u7684\u90a3\u4e2a\u67ff\u5b50\u5417\n\n$$\\sum_{d'|d}d'\\sum_{k=1}^{C/d'} [gcd(\\frac{d}{d'},k) = 1]$$\n\n$$\\sum_{d'|d}d'\\sum_{p'|d,d'}\\mu(p')\\left\\lfloor\\frac{C}{d'p'}\\right\\rfloor$$\n\n\u5316\u7b80\u540e\u53ef\u5f97\u5230\n\n$$\\sum_{T|d}\\left\\lfloor\\frac{C}{T}\\right\\rfloor\\varphi(T)$$ \n\n\u7136\u540e\u5957\u56de\u53bb\u4e4b\u540e\u53d8\u6210\u4e86\n\n$$=\\prod_{Q=1}(\\prod_{d|Q}d^{\\mu(\\left\\lfloor\\frac{Q}{d}\\right\\rfloor) \\times (\\sum_{T|d}\\left\\lfloor\\frac{C}{T}\\right\\rfloor\\varphi(T))})^{\\left\\lfloor\\frac{A}{Q}\\right\\rfloor\\left\\lfloor\\frac{B}{Q}\\right\\rfloor}$$\n\n\u5316\u7b80\u5230\u8fd9\u91cc\u590d\u6742\u5ea6\u662f$O(nlogn)$\u7684\uff0c\u8bd5\u4e86\u8bd5\u8c8c\u4f3c\u8fc7\u4e0d\u53bb\u3002\u3002\u3002\u7136\u540e\u6211\u5c31\u5446\u4f4f\u4e86\uff0c\u8fd9\u600e\u4e48\u7ee7\u7eed\u53cd\u6f14\n\n~~\u770b\u4e86\u770b\u4f60\u8c37\u7684\u9898\u89e3\u4e4b\u540e\u6211\u609f\u4e86~~\n\n\u628a$d$\u62c6\u6210$\\frac{d}{T}$\u548c$T$\u6765\u505a\n\n\u628a\u6307\u6570\u4e0a\u7684$\\sum$\u62ff\u4e0b\u6765\n\n$$=\\prod_{Q=1}(\\prod_{d|Q}\\prod_{T|d}d^{\\mu(\\left\\lfloor\\frac{Q}{d}\\right\\rfloor) \\times (\\left\\lfloor\\frac{C}{T}\\right\\rfloor\\varphi(T))})^{\\left\\lfloor\\frac{A}{Q}\\right\\rfloor\\left\\lfloor\\frac{B}{Q}\\right\\rfloor}$$\n\n\u9996\u5148\u5bf9\u4e8e$\\frac{d}{T}$\u6211\u4eec\u6709\n\n\n$$\\prod_{Q=1}(\\prod_{d|Q}\\prod_{T|d}(\\frac{d}{T})^{\\mu(\\left\\lfloor\\frac{Q}{d}\\right\\rfloor) \\times (\\left\\lfloor\\frac{C}{T}\\right\\rfloor\\varphi(T))})^{\\left\\lfloor\\frac{A}{Q}\\right\\rfloor\\left\\lfloor\\frac{B}{Q}\\right\\rfloor}$$\n\n\u5bf9\u4e8e$Q$\u548c$d$\u6211\u4eec\u540c\u65f6\u4e58\u4e0a$T$\u53ef\u4ee5\u5f97\u5230\n\n$$=\\prod_{T=1}^x\\ \\prod_{Q=1}^{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\\ \\prod_{d|Q}\nd^{\\mu(\\frac{QT}{dT})\\varphi(T)\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor{\\left\\lfloor{\\frac{x}{QT}}\\right\\rfloor}{\\left\\lfloor{\\frac{y}{QT}}\\right\\rfloor}}$$\n\n\n$$=\\prod_{T=1}^x\\ \\prod_{Q=1}^{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\\ \\prod_{d|Q}\nd^{\\mu(\\frac{Q}{d})\\varphi(T)\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor{\\left\\lfloor{\\frac{x}{QT}}\\right\\rfloor}{\\left\\lfloor{\\frac{y}{QT}}\\right\\rfloor}}$$\n\n\u7136\u540e\u91cc\u9762\u7684\u90e8\u5206\u6211\u4eec\u5728$type0$\u4e2d\u5df2\u7ecf\u9884\u5904\u7406\u8fc7\u4e86\uff0c\u76f4\u63a5\u767d\u5ad6\n\n\u5bf9\u4e8e$T$\u7684\u8bdd\n\n$$\\prod\\limits_{Q=1}^x\\prod_{d|Q}\\prod_{T|d}T^{\\mu(\\frac{Q}{d})\\varphi(p)\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor{\\left\\lfloor{\\frac{x}{Q}}\\right\\rfloor}{\\left\\lfloor{\\frac{y}{Q}}\\right\\rfloor}}$$\n\n\u679a\u4e3e$T$\n\n$$=\\prod_{T=1}^x\\prod_{Q=1}^{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\\prod_{d|Q}p^{\\mu(\\frac{QT}{dT})\\varphi(T)\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor{\\left\\lfloor{\\frac{x}{QT}}\\right\\rfloor}{\\left\\lfloor{\\frac{y}{QT}}\\right\\rfloor}}$$\n\n\u7136\u540e\u628a$\\prod$\u79fb\u52a8\u5230\u6307\u6570\u4e0a\n\n$$=\\prod_{T=1}^xT^{\\sum\\limits_{Q=1}^{\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}\\sum\\limits_{d|Q}\\mu(\\frac{Q}{d})\\varphi(T)\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor{\\left\\lfloor{\\frac{x}{QT}}\\right\\rfloor}{\\left\\lfloor{\\frac{y}{QT}}\\right\\rfloor}}$$\n\n\u7136\u540e\u6574\u7406\u4e00\u4e0b\u53ef\u4ee5\u5f97\u5230\n\n$$=\\prod_{T=1}^xT^{\\varphi(T)\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor\\sum\\limits_{Q=1}^{\\left\\lfloor{\\frac{x}{Q}}\\right\\rfloor}{\\left\\lfloor{\\frac{x}{QT}}\\right\\rfloor}{\\left\\lfloor{\\frac{y}{QT}}\\right\\rfloor}\\sum\\limits_{d|Q}\n\\mu(\\frac{Q}{d})}$$\n\n\u7136\u540e\u6700\u5999\u7684\u5730\u65b9\u662f$\\sum\\limits_{d|Q}\\mu(\\frac{Q}{d})$\u53ef\u4ee5\u66ff\u6362\u6210$e$\uff0c\u4e5f\u5c31\u662f$[Q=1]$\uff0c\u6240\u4ee5\u5f53\u4e14\u4ec5\u5f53$Q=1$\u7684\u65f6\u5019\u624d\u4f1a\u6709\u8d21\u732e\uff0c\u6240\u4ee5\u5c31\u53d8\u6210\u4e86\n\n$$=\\prod_{T=1}^xT^{\\varphi(T){\\left\\lfloor{\\frac{x}{T}}\\right\\rfloor}{\\left\\lfloor{\\frac{y}{T}}\\right\\rfloor}{\\left\\lfloor{\\frac{z}{T}}\\right\\rfloor}}$$\n\n\u7136\u540e\u8fd9\u4e00\u90e8\u5206\u5c31\u53ef\u4ee5\u7b97\u4e86\uff0c\u76f4\u63a5\u5206\u5757~~\u8fd9\u4e48\u505a\u771f\u7684\u662f\u5999~~\n\n### \u7ec6\u8282\u5904\u7406\n\u9884\u5904\u7406\u9636\u4e58\u9006\u5143\u8bb0\u5f97\u5012\u53d9\uff0c\u5176\u4ed6\u7684\u5c31\u6ca1\u4e86\n\n$Code$\n\n```.cpp\n#include<bits/stdc++.h>\n    \n#define LL long long\n    \n#define _ 0\n\n#define R register\n\n#define int long long\n\nusing namespace std;\n    \n/*Grievous Lady*/\n    \ntemplate <typename T> void read(T & t){\n    t = 0;int f = 1;char ch = getchar();\n    while(ch < '0' || ch > '9'){if(ch == '-')f =- 1;ch = getchar();}\n    do{t = (t << 1) + (t << 3) + ch - '0';ch = getchar();}while(ch >= '0' && ch <= '9');t *= f;\n}\n    \nconst int kato = 1e5 + 10;\n\nconst int atri = 1e5 + 10;\n\nint a , b , c , t , mod;\n\nint prime[kato] , cnt , phi[kato] , mu[kato] , fac[kato] , Fac[kato] , type0[kato] , type1[kato];\n\nint phi_sum[kato] , fac_0[kato] , fac_1[kato] , fac_0_inv[kato] , fac_1_inv[kato] , inv[kato];\n\nbool ispri[kato];\n\ninline LL quick_pow(LL a , LL b){\n    LL res = 1;\n    for(; b ; b >>= 1 , a = a * a % mod){\n        if(b & 1){\n            res = res * a % mod;\n        }\n    }\n    return res % mod;\n}\n\n// void put(int x){\n// \tif(x < 0) putchar('-') , x =- x;\n// \tif(x >= 10) put(x / 10);\n// \tputchar((x % 10) + 48);\n// }\n\ninline void pri(){\n    for(int i = 1;i < atri;i ++){\n        fac[i] = fac[i - 1] * i % mod;\n        Fac[i] = Fac[i - 1] * quick_pow(i , i) % mod;\n    }\n    for(int i = 2;i < atri;i ++){\n        if(!ispri[i]){\n            prime[++ cnt] = i;\n            phi[i] = i - 1;\n            mu[i] = -1;\n        }\n        for(int j = 1;j <= cnt && i * prime[j] < atri;j ++){\n            ispri[i * prime[j]] = 1;\n            if(i % prime[j] == 0){\n                phi[i * prime[j]] = phi[i] * prime[j];\n                break;\n            }\n            phi[i * prime[j]] = phi[i] * (prime[j] - 1);\n            mu[i * prime[j]] = -mu[i];\n        }\n    }\n    for(int i = 1;i < atri;i ++){\n        phi_sum[i] = (phi_sum[i - 1] + phi[i]) % (mod - 1);\n        type0[i] = fac_0[i] = fac_1[i] = fac_0_inv[i] = fac_1_inv[i] = type1[i] = 1;\n    }\n    for(int i = 1;i < atri;i ++){\n        if(mu[i] == 1){\n            for(int j = i , cnt = 1;j < atri;j += i , cnt ++){\n                type0[j] = type0[j] * cnt % mod;\n                type1[j] = type1[j] * cnt % mod;\n            }\n        }\n        if(mu[i] == -1){\n            for(int j = i , cnt = 1;j < atri;j += i , cnt ++){\n                type0[j] = type0[j] * inv[cnt] % mod;\n                type1[j] = type1[j] * inv[cnt] % mod;\n            }\n        }\n    }\n    // cout << \"cnt = \" << cnt << ' ' << \"primemax = \" << prime[cnt] <<'\\n';\n    for(int i = 1;i < atri;i ++){\n        // if(i == 46341) cout << i << '\\n';\n        fac_0[i] = fac_0[i - 1] * type0[i] % mod;\n        type1[i] = quick_pow(type1[i] , i * i % (mod - 1));\n        fac_1[i] = fac_1[i - 1] * type1[i] % mod;\n        // if(i > 46340)cout << \"i = \" << i << \" \" << \"fac_0[i] = \" << fac_0[i] << ' ' << \"fac_0_inv[i] = \" << fac_0_inv[i] << ' ' << \"fac_1[i] = \" << fac_1[i] << ' ' << \"fac_1_inv[i] = \" << fac_1_inv[i] << '\\n';\n    }\n    fac_0_inv[kato - 1] = quick_pow(fac_0[kato - 1] , mod - 2);\n    fac_1_inv[kato - 1] = quick_pow(fac_1[kato - 1] , mod - 2);\n    // cout << fac_0_inv[kato - 1] << ' ' << fac_1_inv[kato - 1];\n    for(int i = kato - 2 ; i ; i --){\n        fac_0_inv[i] = fac_0_inv[i + 1] * type0[i + 1] % mod;\n    }\n    for(int i = kato - 2 ; i ; i --){\n        fac_1_inv[i] = fac_1_inv[i + 1] * type1[i + 1] % mod;\n    }\n    // cout << \"QAQ\" << '\\n';\n}\n\ninline int get_type2_(int x , int y){\n    int ans = 1;\n    for(int l = 1 , r = 0;l <= min(x , y);l = r + 1){\n        r = min(x / (x / l) , y / (y / l));\n        ans = ans * quick_pow(1LL * fac_0[r] * fac_0_inv[l - 1] % mod , 1LL * (x / l) * (y / l) % (mod - 1)) % mod; \n    }\n    return ans % mod;\n}\n\ninline int get_sum(int a){\n    return ((a * (a + 1))>> 1) % (mod - 1);\n}\n\ninline int get_type0_f1(int x , int y , int z){\n    return quick_pow(fac[x] , y * z % (mod - 1)) % mod;\n}\n\ninline int get_type0_f2(int x , int y , int z){\n    // cout << x << ' ' << y << ' ' << z << '\\n';\n    int ans = 1;\n    for(int l = 1 , r = 0;l <= min(x , y);l = r + 1){\n        r = min(x / (x / l) , y / (y / l));\n        // cout << fac_0[r] << ' ' << fac_0_inv[l - 1] << '\\n' ;\n        ans = ans * quick_pow(fac_0[r] * fac_0_inv[l - 1] % mod , (x / l) * (y / l) % (mod - 1)) % mod; \n    }\n    // cout << ans << '\\n';\n    return quick_pow(ans , z);\n}\n\ninline int get_type1_f1(int x , int y , int z){\n    return quick_pow(Fac[x] , get_sum(y) * get_sum(z) % (mod - 1)) % mod;\n}\n\ninline int get_type1_f2(int x , int y, int z){\n    int ans = 1;\n    for(int l = 1 , r = 0;l <= min(x , y);l = r + 1){\n        r = min(x / (x / l) , y / (y / l));\n        ans = ans * quick_pow(fac_1[r] * fac_1_inv[l - 1] % mod , get_sum(x / l) * get_sum(y / l) % (mod - 1)) % mod;\n    }\n    return quick_pow(ans , get_sum(z));\n}\n\ninline int get_type2_f1(int x , int y , int z){\n    int ans = 1;\n    for(int l = 1 , r = 0;l <= min(x , min(y , z));l = r + 1){\n        r = min(x / (x / l) , min(y / (y / l) , z / (z / l)));\n        ans = ans * quick_pow(fac[x / l] % mod , (phi_sum[r] - phi_sum[l - 1] + mod - 1) % (mod - 1) * (y / l) % (mod - 1) * (z / l) % (mod - 1)) % mod;\n    }\n    return ans % mod;\n}\n\ninline int get_type2_f2(int x , int y , int z){\n    int ans = 1;\n    for(int l = 1 , r = 0;l <= min(x , min(y , z));l = r + 1){\n        r = min(x / (x / l) , min(y / (y / l) , z / (z / l)));\n        ans = ans * quick_pow(get_type2_(x / l , y / l) , (phi_sum[r] - phi_sum[l - 1] + mod - 1) * (z / l) % (mod - 1)) % mod;\n    }\n    return ans % mod;\n}\n\ninline int get_type0(){\n    int res1 = get_type0_f1(a , b , c) * get_type0_f1(b , a , c) % mod;\n    int res2 = get_type0_f2(a , b , c) * get_type0_f2(a , c , b) % mod;\n    // cout << res1 << ' ' << res2 << '\\n';\n    return (res1 * quick_pow(res2 , mod - 2)) % mod;\n}\n\ninline int get_type1(){\n    int res1 = get_type1_f1(a , b , c) * get_type1_f1(b , a , c) % mod;\n    int res2 = get_type1_f2(a , b , c) * get_type1_f2(a , c , b) % mod;\n    return (res1 * quick_pow(res2 , mod - 2)) % mod;\n}\n\ninline int get_type2(){\n    int res1 = get_type2_f1(a , b , c) * get_type2_f1(b , a , c) % mod;\n    int res2 = get_type2_f2(a , b , c) * get_type2_f2(a , c , b) % mod;\n    return (res1 * quick_pow(res2 , mod - 2)) % mod;\n}\n\ninline int Ame_(){\n    read(t) , read(mod);\n    inv[1] = 1;\n\tfor(int i = 2;i < kato;i ++){\n        inv[i] = (mod - mod / i) * inv[mod % i] % mod;\n    }\n    mu[1] = phi[1] = phi_sum[0] = fac[0] = fac[1] = Fac[0] = Fac[1] = fac_0[0] = fac_0[1] = fac_1[0] = fac_1[1] = fac_0_inv[0] = fac_1_inv[0] = 1;\n    pri();\n    // cout << \"QAQ\" << '\\n';\n    // for(int i = 1;i <= 10;i ++){\n    //     cerr << i << ' ' << mu[i] << ' ' << phi[i] << '\\n';\n    // }\n    // cout << type0[1] << ' ' << type0[2] << ' ' << type0[3] << '\\n';\n    // for(int i = 1;i <= 10;i ++){\n    //     cerr << fac_0_inv[i] << ' ' << fac_1_inv[i] << '\\n';\n    // }\n    for(; t --> 0 ;){\n        read(a) , read(b) , read(c);\n        printf(\"%lld %lld %lld\\n\" , get_type0() , get_type1() , get_type2());\n        // put(get_type0());cout << ' ';put(get_type1());cout << ' ';put(get_type2());cout << '\\n';\n    }\n    return ~~(0^_^0);\n}\n    \nint Ame__ = Ame_();\n    \nsigned main(){;}\n\n/*\n3 998244853\n1 1 1\n2 2 2\n3 3 3\n*/\n\n/*\n1 1 1\n16 4096 16\n180292630 873575259 180292630\n*/\n```",
        "postTime": 1597826472,
        "uid": 245875,
        "name": "Ame__",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5518 \u3010[MtOI2019]\u5e7d\u7075\u4e50\u56e2 / \u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u57fa\u7840\u7ec3\u4e60\u9898\u3011"
    },
    {
        "content": "**\u5b66\u4e60\u8f66\u4e07\u7684\u6700\u597d\u65b9\u6cd5\u5c31\u662f**\n\nA\u4e86\u8fd9\u9053\u9898\u3002\uff08\u5927\u96fe\uff09\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/5bp94xos.png)\n\n\u8fd9\u9898\u771f\u6bd2\u7624\uff0c\u5f0f\u5b50\u63a8\u4e86\u6211\u6574\u6574\u4e00\u4e2a\u4e0b\u5348\u3002\n\n~~\u4e0d\u6127\u662f\u51a5\u754c\u7684\u4e50\u56e2\uff0c\u505a\u5b8c\u8fd9\u9898\u6211\u4e5f\u5feb\u53bb\u51a5\u754c\u4e86~~\n\n## \u524d\u7f6e\u77e5\u8bc6\n\n\u6b27\u62c9\u53cd\u6f14\u3001\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u3002\n\n\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u8fd9\u4e24\u4e2a\u5f0f\u5b50\uff1a\n\n$$\nn=\\sum_{p|n}\\varphi(p)\n$$\n\n$$\n[n==1]=\\sum_{d|n}\\mu(p)\n$$\n\n## \u63a8\u5f0f\u5b50\u73af\u8282\n\n\u524d\u65b9\u7cbe\u795e\u6c61\u67d3\u8b66\u544a\n\n\u9996\u5148\u6211\u4eec\u5148\u5316\u7b80\u4e00\u4e0b\u8fd9\u4e2a\u5f0f\u5b50\n\n$$\n\\prod_i^A\\prod_j^B\\prod_k^C(\\frac{\\operatorname{lcm}(i,j)}{\\gcd(i,k)})^{f(tp)}\n$$\n\n$$\n\\prod_i^A\\prod_j^B\\prod_k^C(\\frac{ij}{\\gcd(i,k)\\gcd(i,j)})^{f(tp)}\n$$\n\n\u4e8e\u662f\u53ef\u4ee5\u5bf9\u5206\u5b50\u4e0e\u5206\u6bcd\u5206\u522b\u5904\u7406\u4e86\u3002\n\n## $tp=0$\n\n### $f_{01}$\n\n$$\n\\prod_i^A\\prod_j^B\\prod_k^Ci\n$$\n\n$$\n(A!)^{BC}\n$$\n\n\u9884\u5904\u7406\u9636\u4e58\uff0c\u9001\u8d70\u3002\n\n### $f_{02}$\n\n$$\n\\prod_i^A\\prod_j^B\\prod_k^C\\gcd(i,j)\n$$\n\n$$\n(\\prod_i^A\\prod_j^B\\gcd(i,j))^C\n$$\n\n\u662f\u7ecf\u5178\u6a21\u578b\uff0c\u53cd\u6f14\u5373\u53ef\u3002\n\n$$\n(\\prod_dd^{\\sum_k\\mu(k)\\frac{A}{dk}\\frac{B}{dk}})^C\n$$\n\n\u7ecf\u5178\u5957\u8def\u8bbe $T=dk$\n\n$$\n(\\prod_T(\\prod_{d|T}d^{\\mu(T/d)})^{\\frac{A}{T}\\frac{B}{T}})^C\n$$\n\n\u57c3\u5f0f\u7b5b\u9884\u5904\u91cc\u5185\u5c42\u62ec\u53f7\uff0c\u6574\u6570\u5206\u5757\u9001\u8d70\u3002\n\n## $tp=1$\n\n### $f_{11}$\n\n$$\n\\prod_i^A\\prod_j^B\\prod_k^Ci^{ijk}\n$$\n\n$$\n\\prod_i^Ai^{i\\sum_j^Bj\\sum_k^Ck}\n$$\n\n$$\n(\\prod_i^Ai^{i})^{B(B+1)C(C+1)/4}\n$$\n\n\u9884\u5904\u7406 $i^i$ \u7684\u524d\u7f00\u79ef\uff0c\u76f4\u63a5\u9001\u8d70\u3002\n\n### $f_{12}$\n\n$$\n\\prod_i^A\\prod_j^B\\prod_k^C\\gcd(i,j)^{ijk}\n$$\n\n$$\n(\\prod_i^A\\prod_j^B\\gcd(i,j)^{ij})^{C(C+1)/2}\n$$\n\n\u7136\u540e\u7ecf\u5178\u5957\u8def\n\n$$\n(\\prod_dd^{\\sum\\mu(k)d^2k^2(\\frac{A}{dk})(\\frac{A}{dk}+1)(\\frac{B}{dk})(\\frac{B}{dk}+1)/4})^{C(C+1)/2}\n$$\n\n\u7136\u540e\u63a5\u7740\u63d0\u51fa $T$\n\n$$\n(\\prod_T(\\prod_{d|T}d^{\\mu(T/d)})^{T^2(\\frac{A}{T})(\\frac{A}{T}+1)(\\frac{B}{T})/4(\\frac{B}{T}+1)})^{C(C+1)/2}\n$$\n\n\u9884\u5904\u7406 $(\\prod_{d|T}d^{\\mu(T/d)})^{T^2}$ \u7684\u524d\u7f00\u79ef\uff0c\u6574\u6570\u5206\u5757\u9001\u8d70\u3002\n\n## $tp=2$\n\n### $f_{21}$\n\n$$\n\\prod_i^A\\prod_j^B\\prod_k^Ci^{\\gcd(i,j,k)}\n$$\n\n$$\n\\prod_i^Ai^{\\sum_j^B\\sum_k^C\\gcd(i,j,k)}\n$$\n\n\u5148\u770b\u4e0a\u9762\u90a3\u4e2a\u73a9\u610f\n\n$$\n\\sum_j^B\\sum_k^C\\gcd(i,j,k)\n$$\n\n\u660e\u663e\u7684\u662f\u4e00\u4e2a\u6b27\u62c9\u53cd\u6f14\u3002\n\n$$\n\\sum_j^B\\sum_k^C\\sum_{d|\\gcd(i,j,k)}\\varphi(d)\n$$\n\n$$\n\\sum_{d|i}\\varphi(d)\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor\n$$\n\n\u56de\u4ee3\u3002\n\n$$\n\\prod_i^Ai^{\\sum_{d|i}\\varphi(d)\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor}\n$$\n\n$$\n\\prod_i^A\\prod_{d|i}i^{\\varphi(d)\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor}\n$$\n\n$$\n\\prod_d\\prod_i^{\\frac{A}{d}}i^{\\varphi(d)\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor}d^{\\varphi(d)\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor}\n$$\n\n$$\n\\prod_dd^{\\varphi(d)\\lfloor\\frac{A}{d}\\rfloor\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor}(\\prod_i^{\\frac{A}{d}}i)^{\\varphi(d)\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor}\n$$\n\n$$\n\\prod_dd^{\\varphi(d)\\lfloor\\frac{A}{d}\\rfloor\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor}((\\frac{A}{d})!)^{\\varphi(d)\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor}\n$$\n\n$$\n(\\prod_dd^{\\varphi(d)\\lfloor\\frac{A}{d}\\rfloor\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor})(\\prod_d((\\frac{A}{d})!)^{\\varphi(d)\\lfloor\\frac{B}{d}\\rfloor\\lfloor\\frac{C}{d}\\rfloor})\n$$\n\n\u524d\u534a\u90e8\u5206\u9884\u5904\u7406 $d^{\\varphi(d)}$ \u7684\u524d\u7f00\u79ef\uff0c\u540e\u534a\u90e8\u5206\u9884\u5904\u7406\u51fa $\\varphi(d)$ \u7684\u524d\u7f00\u548c\uff0c\u5206\u522b\u8fdb\u884c\u6574\u6570\u5206\u5757\uff0c\u9001\u8d70\u3002\n\n### $f_{22}$\n\n$$\n\\prod_i^A\\prod_j^B\\prod_k^C\\gcd(i,j)^{gcd(i,j,k)}\n$$\n\n\n\u770b\u5230 $\\gcd$ \u5728\u6307\u6570\u4e0a\u679c\u65ad\u6b27\u62c9\u53cd\u6f14\u3002\n\n$$\n\\prod_i^A\\prod_j^B\\prod_k^C\\gcd(i,j)^{\\sum_{p|gcd(i,j,k)}\\varphi(p)}\n$$\n\n$$\n\\prod_i^A\\prod_j^B\\prod_{p|gcd(i,j)}\\gcd(i,j)^{\\lfloor\\frac{C}{p}\\rfloor\\varphi(p)}\n$$\n\n$$\n\\prod_p\\prod_i^{\\frac{A}{p}}\\prod_j^{\\frac{B}{p}}(p\\gcd(i,j))^{\\lfloor\\frac{C}{p}\\rfloor\\varphi(p)}\n$$\n\n\u7136\u540e\u62c6\u4e86\u5b83\u3002\n\n$$\n(\\prod_p(p^{\\varphi(p)})^{\\lfloor\\frac{A}{p}\\rfloor\\lfloor\\frac{B}{p}\\rfloor\\lfloor\\frac{C}{p}\\rfloor})(\\prod_p\\prod_i^{\\frac{A}{p}}\\prod_j^{\\frac{B}{p}}\\gcd(i,j)^{\\lfloor\\frac{C}{p}\\rfloor\\varphi(p)})\n$$\n\n\u53d1\u73b0\u53f3\u8fb9\u90a3\u5768\u4e1c\u897f\u5f88\u719f\u6089\uff0c\u5de6\u8fb9\u90a3\u5768\u4e1c\u897f\u4e5f\u5f88\u719f\u6089\uff0c\u90fd\u662f\u4e4b\u524d\u6c42\u8fc7\u7684\u4e1c\u897f\u3002\n\n$$\nf_{211}(A,B,C)(\\prod_pf_{02}(\\lfloor\\frac{A}{p}\\rfloor,\\lfloor\\frac{B}{p}\\rfloor,\\lfloor\\frac{C}{p}\\rfloor)^{\\varphi(p)})\n$$\n\n\u7136\u540e\u5c31\u63a5\u7740\u6574\u6570\u5206\u5757\uff0c\u9001\u8d70\u3002\uff08\u540e\u9762\u90a3\u5768\u4e1c\u897f\u56e0\u4e3a\u6709\u5d4c\u5957\u6240\u4ee5\u590d\u6742\u5ea6\u6709\u70b9\u96be\u6c42\uff0c\u4f46\u5176\u5b9e\u662f\u53ef\u4ee5\u8fc7\u7684\uff09\n\n## \u4ee3\u7801\n\n\u4ee3\u7801\u4e2d `solvep` \u8868\u793a $f_p$, `initp` \u548c `invp` \u8868\u793a\u4e3a\u4e86\u6c42 `solvep` \u800c\u9884\u5904\u7406\u7684\u4e1c\u897f\u4ee5\u53ca\u9006\u5143\u3002\uff08\u90e8\u5206\u6709\u5b9e\u9645\u610f\u4e49\u7684\u76f4\u63a5\u7528\u82f1\u6587\u8868\u793a\uff09\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nint mod;\nint qpow(int a, int n) {\n    int res=1;\n    while (n > 0) {\n        if (n & 1){\n            res = res * a % mod;\n        }\n        n >>= 1;\n        a = (a * a) % mod;\n    }\n    return res%mod;\n}\nint fac[100003],facinv[100003],init02[100003],inv02[100003],ans;\nint init11[100003],init12[100003],inv12[100003];\nint mu[100003],phi[100003];\nbool vis[100003];\nint prime[100003],cnt;\nint sumphi[100003],init211[100003],inv211[100003];\nvoid init(int n){\n\tfac[0]=1;\n\tfacinv[0]=1;\n\tinit11[0]=1;\n\tfor(int i=1;i<=n;i++)\n\tfac[i]=fac[i-1]*i%mod,init11[i]=init11[i-1]*qpow(i,i)%mod;\n\tfacinv[n]=qpow(fac[n],mod-2);\n\tfor(int i=n-1;i;i--) facinv[i]=facinv[i+1]*(i+1)%mod;\n\tmu[1]=1;\n\tphi[1]=1;\n    for(int i=2; i<=n; ++i) {\n        if(!vis[i]) prime[++cnt]=i,phi[i]=(i-1)%mod,mu[i]=-1;\n        for(int j=1; j<=cnt&&i*prime[j]<=n; j++) {\n            vis[i*prime[j]]=1;\n            if(i%prime[j]==0){mu[i*prime[j]]=0;phi[i*prime[j]]=phi[i]*prime[j]%(mod-1);break;} \n            mu[i*prime[j]]=mu[i]*mu[prime[j]];\n            phi[i*prime[j]]=phi[i]*phi[prime[j]]%(mod-1);\n        }\n    } \n    for(int i=1;i<=n;i++) init02[i]=1;\n    for(int i=1;i<=n;i++)\n    for(int j=1;j*i<=n;j++)\n    init02[j*i]=init02[j*i]*(mu[j]==1?i:mu[j]==0?1:qpow(i,mod-2))%mod;\n    inv02[n]=1;\n    for(int i=1;i<=n;i++) inv02[n]=inv02[n]*init02[i]%mod,init12[i]=qpow(init02[i],i*i%(mod-1));\n\tinv12[0]=1;\n    init12[0]=1;\n    for(int i=1;i<=n;i++) init12[i]=init12[i]*init12[i-1]%mod,inv12[i]=qpow(init12[i],mod-2);\n    inv02[n]=qpow(inv02[n],mod-2);\n\tinit02[0]=1;\n    inv02[0]=1;\n    for(int i=n-1;i;i--) inv02[i]=inv02[i+1]*init02[i+1]%mod;\n    for(int i=1;i<=n;i++) init02[i]=init02[i-1]*init02[i]%mod;\n    for(int i=1;i<=n;i++) sumphi[i]=(sumphi[i-1]+phi[i])%(mod-1);\n    init211[0]=inv211[0]=1;\n    for(int i=1;i<=n;i++) init211[i]=init211[i-1]*qpow(i,phi[i])%mod,inv211[i]=qpow(init211[i],mod-2);\n}\nint solve01(int a,int b,int c){\n\tint ans=qpow(fac[a],b*c%(mod-1));\n\treturn ans;\n}\nint solve02(int a,int b,int c){\n\tint ans=1,r;\n\tfor(int l=1;l<=a && l<=b;l=r+1){\n\t\tr=min(a/(a/l),b/(b/l));\n\t\tans=ans*qpow(init02[r]*inv02[l-1]%mod,(a/l)*(b/l)%(mod-1))%mod;\n\t}\n\tans=qpow(ans,c);\n\treturn ans;\n}\nint solve0(int a,int b,int c){\n\treturn solve01(a,b,c)%mod*solve01(b,a,c)%mod*qpow(solve02(a,b,c),mod-2)%mod*qpow(solve02(a,c,b),mod-2)%mod;\n}\nint solve11(int a,int b,int c){\n\treturn qpow(init11[a],(b*(b+1)/2)%(mod-1)*((c*(c+1)/2)%(mod-1))%(mod-1));\n}\nint solve12(int a,int b,int c){\n\tint ans=1,r;\n\tfor(int l=1;l<=a && l<=b;l=r+1){\n\t\tr=min(a/(a/l),b/(b/l));\n\t\tans=ans*qpow(init12[r]*inv12[l-1]%mod,(a/l)*(a/l+1)/2%(mod-1)*((b/l)*(b/l+1)/2%(mod-1))%(mod-1))%mod;\n\t}\n\tans=qpow(ans,c*(c+1)/2%(mod-1));\n\treturn ans;\n}\nint solve1(int a,int b,int c){\n\treturn solve11(a,b,c)%mod*solve11(b,a,c)%mod*qpow(solve12(a,b,c),mod-2)%mod*qpow(solve12(a,c,b),mod-2)%mod;\n}\nint solve211(int a,int b,int c){\n\tint ans=1,r;\n\tfor(int l=1;l<=a && l<=b && l<=c;l=r+1){\n\t\tr=min(c/(c/l),min(a/(a/l),b/(b/l)));\n\t\tans=ans*qpow(init211[r]*inv211[l-1]%mod,(a/l)*(b/l)%(mod-1)*(c/l)%(mod-1))%mod;\n\t}\n\treturn ans;\n}\nint solve212(int a,int b,int c){\n\tint ans=1,r;\n\tfor(int l=1;l<=b && l<=c && l<=a;l=r+1){\n\t\tr=min(a/(a/l),min(c/(c/l),b/(b/l)));\n\t\tans=ans*qpow(fac[a/l],(b/l)*(c/l)%(mod-1)*(((sumphi[r]-sumphi[l-1])%(mod-1)+mod-1)%(mod-1))%(mod-1))%mod;\n\t}\n\treturn ans;\n}\nint solve21(int a,int b,int c){\n\treturn solve211(a,b,c)%mod*solve212(a,b,c)%mod;\n}\nint solve221(int a,int b,int c){\n\treturn solve211(a,b,c);\n}\nint solve222(int a,int b,int c){\n\tint ans=1,r;\n\tfor(int l=1;l<=a && l<=b && l<=c;l=r+1){\n\t\tr=min(c/(c/l),min(a/(a/l),b/(b/l)));\n\t\tans=ans*qpow(solve02(a/l,b/l,c/l)%mod,((sumphi[r]-sumphi[l-1])%(mod-1)+mod-1)%(mod-1))%mod;\n\t}\n\treturn ans%mod;\n}\nint solve22(int a,int b,int c){\n\treturn solve221(a,b,c)%mod*solve222(a,b,c)%mod;\n}\nint solve2(int a,int b,int c){\n\treturn solve21(a,b,c)%mod*solve21(b,a,c)%mod*qpow(solve22(a,b,c),mod-2)%mod*qpow(solve22(a,c,b),mod-2)%mod;\n}\nsigned main(){\n\tint T;\n\tcin>>T>>mod;\n\tinit(100000);\n\twhile(T--){\n\tint A,B,C;\n\tscanf(\"%lld%lld%lld\",&A,&B,&C);\n\tprintf(\"%lld %lld %lld\\n\",solve0(A,B,C),solve1(A,B,C),solve2(A,B,C));\n\t}\n} \n```\n",
        "postTime": 1632878558,
        "uid": 147670,
        "name": "\u91d1\u73c2\u62c9",
        "ccfLevel": 0,
        "title": "\u5e7d\u7075\u4e50\u56e2\u9898\u89e3"
    },
    {
        "content": "upd on 2021.8.7\uff1a\u4fee\u4e86\u4e2a\u516c\u5f0f\u7684\u95ee\u9898\n\n[\u6d1b\u8c37\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P5518)\n\n[\u5982\u679c Latex \u70b8\u4e86\u5c31\u5230\u8fd9\u91cc\u67e5\u770b](https://www.cnblogs.com/ET2006/p/luogu-P5518.html)\n\n\u4e00\u9053\u7a76\u6781\u6076\u5fc3\u7684\u6bd2\u7624\u516d\u5408\u4e00\u9898\uff0c\u5f0f\u5b50\u63a8\u4e86\u6211\u6ee1\u6ee1\u4e24\u9762 A4 \u7eb8\u2026\u2026\n\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u5c06\u5f0f\u5b50\u62c6\u6210\uff1a\n\n$$\nans=\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^C(\\dfrac{ij}{\\gcd(i,j)\\gcd(i,j)})^{f(type)}\n$$\n\n\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u9700\u8981\u7b97\u51fa\u4ee5\u4e0b\u56db\u9879\u5f0f\u5b50\u7684\u503c\uff1a\n\n$$\n\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^Ci^{f(type)}\n$$\n\n$$\n\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^Cj^{f(type)}\n$$\n\n$$\n\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^C(\\dfrac{1}{\\gcd(i,j)})^{f(type)}\n$$\n\n$$\n\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^C(\\dfrac{1}{\\gcd(i,k)})^{f(type)}\n$$\n\n\u663e\u7136\u524d\u4e24\u9879\u4e0e\u540e\u4e24\u9879\u662f\u7b49\u4ef7\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u7b97\u51fa\uff1a\n\n$$\nf_1(type)=\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^Ci^{f(type)}\n$$\n\n\u4e0e\n\n$$\nf_2(type)=\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^C(\\gcd(i,j))^{f(type)}\n$$\n\n\u5373\u53ef\u6c42\u51fa\u7b54\u6848\u3002\n\n---\n\n\u8003\u8651\u5bf9 $type$ \u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\uff0c\u9996\u5148\u662f $type=0$\uff0c\u90a3\u4e48\n\n$$\nf_1(0)=\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^Ci\n$$\n\n\u8003\u8651\u6bcf\u4e2a $i$ \u7684\u8d21\u732e\uff0c\u7a0d\u5fae\u60f3\u60f3\u5373\u53ef\u5f97\u5230\uff1a\n\n$$\nf_1(0)=(A!)^{BC}\n$$\n\n\u7136\u540e\u662f $f_2(0)$\uff0c\u5957\u8def\u5730\u679a\u4e3e $\\gcd(i,j)$ \u6709\n\n$$\n\\begin{aligned}\nf_2(0)&=\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^C\\gcd(i,j)\\\\\n&=(\\prod\\limits_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{i=1}^A\\sum\\limits_{j=1}^B[\\gcd(i,j)=d]})^C\\\\\n&=(\\prod\\limits_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{i=1}^{A/d}\\sum\\limits_{j=1}^{B/d}[\\gcd(i,j)=1]})^C\\\\\n&=(\\prod\\limits_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{p}\\mu(p)\\lfloor\\frac{A}{dp}\\rfloor\\lfloor\\frac{B}{dp}\\rfloor})^C\\\\\n\\end{aligned}\n$$\n\n\u6700\u53f3\u8fb9\u90a3\u4e2a $k$ \u6b21\u65b9\u663e\u7136\u53ef\u4ee5\u5ffd\u7565\u6389\u4e0d\u7ba1\u5b83\uff0c\u6700\u540e\u6c42\u4e2a\u5feb\u901f\u5e42\u5373\u53ef\u3002\u8003\u8651\u5bf9\u91cc\u9762\u7684 $dp$ \u8fdb\u884c\u4e8c\u7ef4\u7684\u6574\u9664\u5206\u5757\uff0c\u90a3\u4e48\u7b54\u6848\u7684\u5f0f\u5b50\u53ef\u4ee5\u5316\u4e3a\uff1a\n\n$$\n\\begin{aligned}\nf_2(0)=(\\prod\\limits_{dp}g_1(dp)^{\\lfloor\\frac{A}{dp}\\rfloor\\lfloor\\frac{B}{dp}\\rfloor})^C\n\\end{aligned}\n$$\n\n\u5176\u4e2d\n\n$$\ng_1(x)=\\prod\\limits_{d\u00b7p=x}d^{\\mu(p)}\n$$\n\n\u8003\u8651\u6574\u9664\u5206\u5757\uff0c\u5bf9\u4e8e\u4e00\u6bb5\u533a\u95f4 $[L,R]$\uff0c\u6ee1\u8db3 $\\forall x\\in[L,R]$ \u5747\u6709 $\\lfloor\\dfrac{A}{x}\\rfloor=\\lfloor\\dfrac{A}{L}\\rfloor,\\lfloor\\dfrac{B}{x}\\rfloor=\\lfloor\\dfrac{B}{L}\\rfloor$\uff0c\u6211\u4eec\u8fd9\u6837\u8ba1\u7b97\u5b83\u4eec\u7684\u8d21\u732e\uff1a\n\n$$\n\\prod\\limits_{i=L}^R(g_1(i)^{\\lfloor\\frac{A}{i}\\rfloor\\lfloor\\frac{B}{i}\\rfloor})^C=(\\prod\\limits_{i=L}^Rg_1(i))^{\\lfloor\\frac{A}{i}\\rfloor\\lfloor\\frac{B}{i}\\rfloor\u00b7C}\n$$\n\n\u9884\u5904\u7406\u524d\u7f00\u79ef\u5373\u53ef $\\mathcal O(1)$ \u8ba1\u7b97\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(\\log n\\sqrt{n})$\u3002\n\n---\n\n\u63a5\u4e0b\u6765\u662f $type=1$ \u7684\u60c5\u51b5\uff0c\u4e2a\u4eba\u611f\u89c9\u4e0e $type=0$ \u7684\u60c5\u51b5\u5927\u5dee\u4e0d\u5dee\uff0c\u6bd5\u7adf\u6307\u6570\u4e0a\u90fd\u53ea\u4e0e $i,j,k$ \u672c\u8eab\u800c\u4e0d\u6d89\u53ca\u5230\u5b83\u4eec\u7684 $\\gcd$ \u4e4b\u7c7b\uff0c\u53ea\u4e0d\u8fc7\u6307\u6570\u4e0a\u679a\u4e3e\u53d8\u91cf\u7684\u6b21\u6570\u7a0d\u5fae\u9ad8\u4e86\u4e00\u70b9\u70b9\uff0c\u5bfc\u81f4\u60c5\u51b5\u8f83\u4e8e $type=0$ \u7565\u6709\u4e00\u70b9\u70b9\u7e41\u7410\u3002\n\n\u9996\u5148\u662f $f_1(1)$\n\n$$\nf_1(1)=\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^Ci^{ijk}\n$$\n\n\u8fd8\u662f\u8003\u8651\u6bcf\u4e2a $i$ \u7684\u8d21\u732e\u88ab\u7d2f\u8ba1\u4e86\u591a\u5c11\u6b21\uff1a\n\n$$\n\\begin{aligned}\nf_1(0)&=(A!)^{\\sum\\limits_{j=1}^B\\sum\\limits_{k=1}^Cjk}\\\\\n&=(A!)^{\\frac{B(B+1)}{2}\u00b7\\frac{C(C+1)}{2}}\n\\end{aligned}\n$$\n\n\u4e00\u6ce2\u5feb\u901f\u5e42\u5e26\u8d70\u3002\n\n\u5176\u6b21\u662f $f_2(1)$\n\n$$\n\\begin{aligned}\nf_2(1)&=\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^C\\gcd(i,j)^{ijk}\\\\\n&=(\\prod\\limits_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{i=1}^A\\sum\\limits_{j=1}^Bij[\\gcd(i,j)=d]})^{\\sum\\limits_{k=1}^Ck}\\\\\n&=(\\prod\\limits_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{i=1}^{A/d}\\sum\\limits_{j=1}^{B/d}ijd^2[\\gcd(i,j)=1]})^{\\frac{C(C+1)}{2}}\\\\\n&=(\\prod\\limits_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{p}\\mu(p)d^2p^2\u00b7s(\\lfloor\\frac{A}{dp}\\rfloor)s(\\lfloor\\frac{B}{dp}\\rfloor)})^{\\frac{C(C+1)}{2}}\\\\\n\\end{aligned}\n$$\n\n\u5176\u4e2d $s(i)=\\dfrac{i(i+1)}{2}$\n\n\u90a3\u4e48\u6211\u4eec\u8fd8\u662f\u679a\u4e3e $dp$\uff0c\u6309\u7167 $f_2(0)$ \u7684\u5957\u8def\u8bbe\u4e00\u4e2a $g_2(x)$\uff0c\u5b9a\u4e49\u5982\u4e0b\uff1a\n\n$$\ng_2(x)=\\prod\\limits_{d\u00b7p=x}d^{d^2p^2\\mu(p)}\n$$\n\n\u90a3\u4e48\u8003\u8651\u5bf9 $dp$ \u8fdb\u884c\u6574\u9664\u5206\u5757\uff0c\u90a3\u4e48\n\n$$\nf_2(1)=(\\prod\\limits_{dp=1}^{\\min(A,B)}g_2(dp)^{s(\\lfloor\\frac{A}{dp}\\rfloor)s(\\lfloor\\frac{B}{dp}\\rfloor)})^{\\frac{C(C+1)}{2}}\n$$\n\n\u9884\u5904\u7406 $g_2(dp)$ \u7684\u524d\u7f00\u79ef\u7136\u540e\u5bf9 $dp$ \u6574\u9664\u5206\u5757\u5373\u53ef\u3002\n\n---\n\n\u6700\u540e\u662f $type=2$ \u7684\u60c5\u51b5\n\n\u5148\u8003\u8651 $f_1(2)$\n\n$$\nf_1(2)=\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^Ci^{\\gcd(i,j,k)}\n$$\n\n\u4e0a\u6765\u5148\u628a $\\gcd$ \u53cd\u6f14\u6389\uff1a\n\n$$\n\\begin{aligned}\nf_1(2)&=\\prod\\limits_{d=1}^{\\min(A,B,C)}\\prod\\limits_{i=1}^{\\lfloor\\frac{A}{d}\\rfloor}(id)^{d\u00b7\\sum\\limits_{j=1}^{\\lfloor\\frac{B}{d}\\rfloor}\\sum\\limits_{k=1}^{\\lfloor\\frac{C}{d}\\rfloor}[\\gcd(i,j,k)=1]}\\\\\n&=\\prod\\limits_{d=1}^{\\min(A,B,C)}\\prod\\limits_{i=1}^{\\lfloor\\frac{A}{d}\\rfloor}(id)^{d\u00b7\\sum\\limits_{p\\mid i}\\mu(p)\\lfloor\\frac{B}{dp}\\rfloor\\lfloor\\frac{C}{dp}\\rfloor}\n\\end{aligned}\n$$\n\n\u628a $p$ \u63d0\u5230\u5916\u9762\u6765\n\n$$\n\\begin{aligned}\nf_1(2)&=\\prod\\limits_{d=1}^{\\min(A,B,C)}\\prod\\limits_{p}(\\prod\\limits_{i\\in[1,\\lfloor\\frac{A}{d}\\rfloor]\\&p\\mid i}(id)^{d\u00b7\\mu(p)})^{\\lfloor\\frac{B}{dp}\\rfloor\\lfloor\\frac{C}{dp}\\rfloor}\n\\end{aligned}\n$$\n\n\u7136\u540e\u6309\u7167\u5957\u8def\u679a\u4e3e $\\dfrac{i}{p}$\n\n$$\n\\begin{aligned}\nf_1(2)&=\\prod\\limits_{d=1}^{\\min(A,B,C)}\\prod\\limits_{p}(\\prod\\limits_{i=1}^{\\lfloor\\frac{A}{dp}\\rfloor}(idp)^{d\u00b7\\mu(p)})^{\\lfloor\\frac{B}{dp}\\rfloor\\lfloor\\frac{C}{dp}\\rfloor}\n\\end{aligned}\n$$\n\n\u7136\u540e\u679a\u4e3e $dp$\uff0c\u6839\u636e $\\mu*i=\\varphi$ \u53ef\u77e5 $\\sum\\limits_{d\u00b7p=x}d\u00b7\\mu(p)=\\varphi(x)$\uff0c\u4e8e\u662f\n\n$$\nf_1(2)=\\prod\\limits_{x=1}^{\\min(A,B,C)}(\\prod\\limits_{i=1}^{\\lfloor\\frac{A}{x}\\rfloor}(ix)^{\\varphi(x)})^{\\lfloor\\frac{B}{x}\\rfloor\\lfloor\\frac{C}{x}\\rfloor}\n$$\n\n\u5916\u9762\u7684\u4e1c\u897f\u663e\u7136\u6574\u9664\u5206\u5757\u4e00\u4e0b\u5c31\u597d\u4e86\uff0c\u91cc\u9762\u7684\u4e1c\u897f\n\n$$\n\\prod\\limits_{i=1}^{\\lfloor\\frac{A}{x}\\rfloor}(ix)^{\\varphi(x)}\n$$\n\n\u663e\u7136\u7b49\u4e8e\n\n$$\n\\begin{aligned}\n&\\prod\\limits_{i=1}^{\\lfloor\\frac{A}{x}\\rfloor}i^{\\varphi(x)}\u00b7x^{\\varphi(x)}\\\\\n=&((\\lfloor\\dfrac{A}{x}\\rfloor)!)^{\\varphi(x)}\u00b7(x^{\\varphi(x)})^{\\lfloor\\frac{A}{x}\\rfloor}\n\\end{aligned}\n$$\n\n\u7136\u540e\u5957\u8def\u5730\u9884\u5904\u7406 $g_3=x^{\\varphi(x)}$ \u7684\u524d\u7f00\u79ef\uff0c\u4ee5\u53ca $\\varphi(x)$ \u7684\u524d\u7f00\u548c\u5373\u53ef\u5728\u6574\u9664\u5206\u5757\u7684\u8fc7\u7a0b\u4e2d $\\mathcal O(1)$ \u6c42\u51fa\u5f0f\u5b50\u7684\u503c\uff0c\u6ce8\u610f $\\varphi(x)$ \u7684\u524d\u7f00\u548c\u5e94 $\\bmod(MOD-1)$ \u800c\u4e0d\u662f $\\bmod MOD$\uff0c\u56e0\u4e3a $\\varphi(x)$ \u7684\u524d\u7f00\u548c\u4f5c\u7528\u5728\u6307\u6570\u4e0a\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\sqrt{n}\\log n$\n\n\u7136\u540e\u662f\u6700\u7cbe\u795e\u6c61\u67d3\u7684\u4e00\u4e2a\u5f0f\u5b50\uff1a\n\n$$\nf_2(2)=\\prod\\limits_{i=1}^A\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^C(\\gcd(i,j))^{\\gcd(i,j,k)}\n$$\n\n\u6309\u7167 P1587 \u7684\u5957\u8def\uff0c\u78b0\u5230\u4e24\u4e2a $\\gcd$ \u54b1\u4eec\u6700\u597d\u4e0d\u8981\u83bd\uff0c\u8981\u4e00\u4e2a\u4e2a\u53cd\u6f14\uff0c\u56e0\u6b64\u8003\u8651\u5148\u53cd\u6f14\u4e0b\u9762\u8fd9\u4e2a $\\gcd$\uff1a\n\n$$\n\\begin{aligned}\nf_2(2)&=\\prod\\limits_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{i=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{B}{d}\\rfloor}[\\gcd(i,j)=1]\\sum\\limits_{k=1}^C\\gcd(d,k)}\\\\\n&=\\prod\\limits_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{p}^{\\lfloor\\frac{\\min(A,B)}{d}\\rfloor}\\mu(p)\\lfloor\\frac{A}{dp}\\rfloor\\lfloor\\frac{B}{dp}\\rfloor\\sum\\limits_{k=1}^C\\gcd(d,k)}\n\\end{aligned}\n$$\n\n\u53d1\u73b0\u540e\u9762\u6709\u4e2a $\\sum\\limits_{k=1}^C\\gcd(d,k)$\uff0c\u8003\u8651\u5bf9\u8fd9\u4e2a\u4e1c\u897f\u5355\u72ec\u63a8\u4e2a\u5f0f\u5b50\uff1a\n\n$$\n\\begin{aligned}\ng_4(d,C)&=\\sum\\limits_{k=1}^C\\gcd(d,k)\\\\\n&=\\sum\\limits_{x\\mid d}x\u00b7\\sum\\limits_{i=1}^{\\lfloor\\frac{C}{x}\\rfloor}[i\\perp\\dfrac{d}{x}]\\\\\n&=\\sum\\limits_{x\\mid d}x\u00b7\\sum\\limits_{y\\mid\\frac{d}{x}}\\mu(y)\\lfloor\\dfrac{C}{xy}\\rfloor\n\\end{aligned}\n$$\n\n\u5957\u8def\u5730\u679a\u4e3e $xy=T$ \u53ef\u5f97\uff1a\n\n$$\ng_4(d,C)=\\sum\\limits_{T\\mid d}\\lfloor\\dfrac{C}{T}\\rfloor\\sum\\limits_{x\\mid T}x\\mu(\\dfrac{T}{x})\n$$\n\n\u8fd9\u5df2\u7ecf\u662f\u672c\u9898\u4e2d\u7b2c\u4e8c\u6b21\u770b\u5230\u8fd9\u4e2a\u5f0f\u5b50\u4e86\uff1a\n\n$$\n\\sum\\limits_{x\\mid T}x\\mu(\\dfrac{T}{x})=\\varphi(T)\n$$\n\n\u4e8e\u662f\n\n$$\ng_4(d,C)=\\sum\\limits_{T\\mid d}\\lfloor\\dfrac{C}{T}\\rfloor\\varphi(T)\n$$\n\n\u5e26\u56de\u53bb\n\n$$\nf_2(2)=\\prod\\limits_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{p}^{\\lfloor\\frac{\\min(A,B)}{d}\\rfloor}\\mu(p)\\lfloor\\frac{A}{dp}\\rfloor\\lfloor\\frac{B}{dp}\\rfloor\\sum\\limits_{T\\mid d}\\lfloor\\frac{C}{T}\\rfloor\\varphi(T)}\n$$\n\n\u6309\u7167[\u8fd9\u91cc](https://www.cnblogs.com/ET2006/p/mobius-ycx-nb.html)\u603b\u7ed3\u51fa\u6765\u7684\u5957\u8def\uff0c\u770b\u5230\u5148\u679a\u4e3e $i$ \u518d\u679a\u4e3e $j\\mid i$ \u7684\u6c42\u548c/\u79ef\u5f0f\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4ea4\u6362\u6c42\u548c/\u79ef\u7684\u987a\u5e8f\uff0c\u5148\u679a\u4e3e $j$ \u518d\u679a\u4e3e $i$\uff0c\u8fd9\u6837\u4f1a\u51fa\u73b0\u4e0b\u53d6\u6574\uff0c\u5c31\u53ef\u4ee5\u6574\u9664\u5206\u5757\u4e86\u3002\n\n\u56e0\u6b64\u8003\u8651\u5148\u679a\u4e3e $T$ \u518d\u679a\u4e3e $d$\uff0c\u6709\uff1a\n\n$$\nf_2(2)=\\prod\\limits_{T=1}^{\\min(A,B)}\\prod\\limits_{d=1}^{\\lfloor\\frac{\\min(A,B)}{T}\\rfloor}(dT)^{\\sum\\limits_{p}\\mu(p)\\lfloor\\frac{A}{dTp}\\rfloor\\lfloor\\frac{B}{dTp}\\rfloor\\lfloor\\frac{C}{T}\\rfloor\\varphi(T)}\n$$\n\n\u7136\u540e\u8003\u8651\u62c6\u5f00\u6765\uff1a\n\n$$\nf_2(2)=\\prod\\limits_{T=1}^{\\min(A,B)}(T^{\\varphi(T)\\lfloor\\frac{C}{T}\\rfloor})^{\\sum\\limits_{d}\\sum\\limits_{p}\\mu(p)\\lfloor\\frac{A}{dTp}\\rfloor\\lfloor\\frac{B}{dTp}\\rfloor}\u00b7\\prod\\limits_{d=1}^{\\lfloor\\frac{\\min(A,B)}{T}\\rfloor}(d^{\\sum\\limits_{p}\\mu(p)\\lfloor\\frac{A}{dTp}\\rfloor\\lfloor\\frac{B}{dTp}\\rfloor})^{\\varphi(T)\\lfloor\\frac{C}{T}\\rfloor}\n$$\n\n---\n\n\u5148\u8003\u8651\u524d\u9762\u7684\u5f0f\u5b50\uff1a\n\n$$\n(T^{\\varphi(T)\\lfloor\\frac{C}{T}\\rfloor})^{\\sum\\limits_{d}\\sum\\limits_{p}\\mu(p)\\lfloor\\frac{A}{dTp}\\rfloor\\lfloor\\frac{B}{dTp}\\rfloor}\n$$\n\n\u8003\u8651\u679a\u4e3e $dp=x$\uff0c\u90a3\u4e48\uff1a\n\n$$\n\\begin{aligned}\n\\text{\u539f\u5f0f}&=(T^{\\varphi(T)\\lfloor\\frac{C}{T}\\rfloor})^{\\sum\\limits_{x}\\sum\\limits_{p\\mid x}\\mu(p)\\lfloor\\frac{A}{Tx}\\rfloor\\lfloor\\frac{B}{Tx}\\rfloor}\\\\\n&=(T^{\\varphi(T)\\lfloor\\frac{C}{T}\\rfloor})^{\\epsilon(x)\\lfloor\\frac{A}{Tx}\\rfloor\\lfloor\\frac{B}{Tx}\\rfloor}\\\\\n&=(T^{\\varphi(T)\\lfloor\\frac{C}{T}\\rfloor})^{\\lfloor\\frac{A}{T}\\rfloor\\lfloor\\frac{B}{T}\\rfloor}\n\\end{aligned}\n$$\n\n\u5bf9 $T$ \u6574\u9664\u5206\u5757\u4e00\u4e0b\uff0c\u9884\u5904\u7406 $\\varphi(T)$ \u7684\u524d\u7f00\u548c\u5373\u53ef $\\mathcal O(1)$ \u7b97\u51fa\u3002\n\n---\n\n\u7136\u540e\u662f\u540e\u9762\u7684\u5f0f\u5b50\uff08\u80dc\u5229\u5c31\u5728\u773c\u524d\uff01\uff09\n\n$$\n\\prod\\limits_{T=1}^{\\min(A,B)}\\prod\\limits_{d=1}^{\\lfloor\\frac{\\min(A,B)}{T}\\rfloor}(d^{\\sum\\limits_{p}\\mu(p)\\lfloor\\frac{A}{dTp}\\rfloor\\lfloor\\frac{B}{dTp}\\rfloor})^{\\varphi(T)\\lfloor\\frac{C}{T}\\rfloor}\n$$\n\n\u8fd8\u662f\u5bf9 $T$ \u6574\u9664\u5206\u5757\uff0c\u7136\u540e\u679a\u4e3e $dp=x$\uff0c\u90a3\u4e48\u4e0a\u9762\u7684\u5f0f\u5b50\u53ef\u4ee5\u5199\u6210\uff1a\n\n$$\n\\prod\\limits_{T=1}^{\\min(A,B)}\\prod\\limits_{x=1}^{\\lfloor\\frac{\\min(A,B)}{T}\\rfloor}((\\prod\\limits_{d\\mid x}d^{\\mu(p)})^{\\lfloor\\frac{A}{Tx}\\rfloor\\lfloor\\frac{B}{Tx}\\rfloor})^{\\varphi(T)\\lfloor\\frac{C}{T}\\rfloor}\n$$\n\n\u53d1\u73b0\u6700\u91cc\u9762\u7684\u62ec\u53f7\u7684\u4e1c\u897f\u5c31\u662f\u5728\u6c42 $f_2(0)$ \u65f6\u7528\u5230\u7684 $g_1(x)$\uff0c\u90a3\u4e48\u6211\u4eec\u518d\u5957\u4e00\u4e2a\u5bf9 $x$ \u7684\u6574\u9664\u5206\u5757\u5373\u53ef\u3002\n\n\u6839\u636e\u6574\u9664\u5206\u5757\u91cc\u518d\u5957\u4e00\u4e2a\u6574\u9664\u5206\u5757\u590d\u6742\u5ea6\u662f $\\sum\\limits_{x,\\exists k,s.t.\\lfloor\\frac{n}{k}\\rfloor=x}\\sqrt{x}=n^{0.75}$ \u53ef\u77e5\u8fd9\u4e00\u90e8\u5206\u590d\u6742\u5ea6\u4e3a $n^{0.75}\\log n$\n\n\u4e8e\u662f\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $n\\log n+Tn^{0.75}\\log n$\u3002\n\n---\n\n\u5173\u4e8e\u6b64\u9898\u7684\u5e38\u6570\u95ee\u9898\uff0c\u7531\u4e8e\u53d6\u6a21\u8fd0\u7b97\u8f83\u591a\uff0c\u53ef\u4ee5\u4f7f\u7528\u5feb\u901f\u53d6\u6a21\u4f18\u5316\u5e38\u6570\uff0c\u5177\u4f53\u53ef\u89c1 chenxia25 \u795e\u4ed9\u7684[\u8fd9\u7bc7\u535a\u5ba2](https://www.cnblogs.com/ycx-akioi/p/fastmod.html)\u3002\n\n```cpp\nconst int MAXV=1e5;\nll mod;\nint pr[MAXV/5+5],prcnt=0,vis[MAXV+5],mu[MAXV+5],smu[MAXV+5],phi[MAXV+5];\nint fac[MAXV+5],prd[MAXV+5],prd_inv[MAXV+5],prd_sq[MAXV+5],prd_sq_inv[MAXV+5];\nint pre_ii[MAXV+5],inv_pre_ii[MAXV+5],pre_mul[MAXV+5],inv_pre_mul[MAXV+5];\nint inv[MAXV+5],prd_phi[MAXV+5],prd_phi_inv[MAXV+5];\nint sphi[MAXV+5];\n__int128_t _base1=1,_base2=1;\ninline int mol1(__int128_t x){return x-mod*(_base1*x>>64);}\ninline int mol2(__int128_t x){return x-(mod-1)*(_base2*x>>64);}\nint qpow(int x,int e){\n\tif(e<0) e+=mod-1;int ret=1;\n\tfor(;e;e>>=1,x=mol1(1ll*x*x)) if(e&1) ret=mol1(1ll*ret*x);\n\treturn ret;\n}\nint work(int x,int y){return (!y)?1:((~y)?x:inv[x]);}\nvoid sieve(int n){\n\tfor(int i=(inv[0]=inv[1]=1)+1;i<=n;i++) inv[i]=mol1(1ll*inv[mod%i]*(mod-mod/i));\n\tmu[1]=phi[1]=1;\n\tfor(int i=(fac[0]=1);i<=n;i++) fac[i]=mol1(1ll*fac[i-1]*i);\n\tfor(int i=2;i<=n;i++){\n\t\tif(!vis[i]) mu[i]=-1,pr[++prcnt]=i,phi[i]=i-1;\n\t\tfor(int j=1;j<=prcnt&&pr[j]*i<=n;j++){\n\t\t\tvis[pr[j]*i]=1;\n\t\t\tif(i%pr[j]==0){phi[i*pr[j]]=phi[i]*pr[j];break;}\n\t\t\tmu[i*pr[j]]=-mu[i];phi[i*pr[j]]=phi[i]*phi[pr[j]];\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++) smu[i]=smu[i-1]+mu[i];\n\tfor(int i=0;i<=n;i++) prd[i]=prd_sq[i]=1;\n\tfor(int i=1;i<=n;i++) for(int j=i;j<=n;j+=i) prd[j]=mol1(1ll*prd[j]*work(i,mu[j/i]));\n\tfor(int i=1;i<=n;i++) prd[i]=mol1(1ll*prd[i-1]*prd[i]);\n\tfor(int i=0;i<=n;i++) prd_inv[i]=qpow(prd[i],-1);\n\tfor(int i=1;i<=n;i++) for(int j=i;j<=n;j+=i)\n\t\tprd_sq[j]=mol1(1ll*prd_sq[j]*\n\t\tqpow(qpow(i,mol2(1ll*i*i)),mol2(1ll*mu[j/i]*(j/i)*(j/i))));\n\tfor(int i=1;i<=n;i++) prd_sq[i]=mol1(1ll*prd_sq[i-1]*prd_sq[i]);\n\tfor(int i=0;i<=n;i++) prd_sq_inv[i]=qpow(prd_sq[i],-1);\n\tpre_ii[0]=1;for(int i=1;i<=n;i++) pre_ii[i]=mol1(1ll*pre_ii[i-1]*qpow(i,i));\n\tfor(int i=0;i<=n;i++) inv_pre_ii[i]=qpow(pre_ii[i],-1);\n\tpre_mul[0]=1;for(int i=1;i<=n;i++) pre_mul[i]=mol1(1ll*pre_mul[i-1]*work(i,mu[i]));\n\tfor(int i=0;i<=n;i++) inv_pre_mul[i]=qpow(pre_mul[i],-1);\n\tprd_phi[0]=1;for(int i=1;i<=n;i++) prd_phi[i]=mol1(1ll*prd_phi[i-1]*qpow(i,phi[i]));\n\tfor(int i=0;i<=n;i++) prd_phi_inv[i]=qpow(prd_phi[i],-1);\n\tfor(int i=1;i<=n;i++) sphi[i]=mol2(sphi[i-1]+phi[i]);\n}\nint calc1(int x,int y){\n\tint res=1;\n\tfor(int l=1,r;l<=min(x,y);l=r+1){\n\t\tr=min(x/(x/l),y/(y/l));\n\t\tres=1ll*res*qpow(1ll*prd[r]*prd_inv[l-1]%mod,1ll*(x/l)*(y/l)%(mod-1))%mod;\n\t}\n\treturn res;\n}\nint solve1(int a,int b,int c){\n\tint res=1ll*qpow(calc1(a,b),-c)*qpow(calc1(a,c),-b)%mod;\n\tres=1ll*res*qpow(fac[a],1ll*b*c%(mod-1))%mod;\n\tres=1ll*res*qpow(fac[b],1ll*a*c%(mod-1))%mod;\n\treturn res;\n}\nll get(int x){return mol2(1ll*x*(x+1)/2);}\nint calc2(int x,int y){\n\tint res=1;\n\tfor(int l=1,r;l<=min(x,y);l=r+1){\n\t\tr=min(x/(x/l),y/(y/l));\n\t\tres=1ll*res*qpow(1ll*prd_sq[r]*prd_sq_inv[l-1]%mod,\n\t\t1ll*get(x/l)*get(y/l)%(mod-1))%mod;\n\t}\n\treturn res;\n}\nint solve2(int a,int b,int c){\n\tint res=1;\n\tres=1ll*res*qpow(pre_ii[a],(1ll*b*(b+1)>>1)%(mod-1))%mod;\n\tres=1ll*res*qpow(pre_ii[b],(1ll*a*(a+1)>>1)%(mod-1))%mod;\n\tres=1ll*res*qpow(calc2(a,b),mod-2)%mod;\n\tres=qpow(res,(1ll*c*(c+1)>>1)%(mod-1));\n\tres=1ll*res*qpow(calc2(a,c),-(1ll*b*(b+1)>>1)%(mod-1))%mod;\n\treturn res;\n}\nint calc3(int x,int y,int z){\n\tint res=1;\n\tfor(int l=1,r;l<=x;l=r+1){\n\t\tr=1e9;\n\t\tif(x/l) chkmin(r,x/(x/l));\n\t\tif(y/l) chkmin(r,y/(y/l));\n\t\tif(z/l) chkmin(r,z/(z/l));\n\t\tint mul=qpow(1ll*prd_phi[r]*prd_phi_inv[l-1]%mod,x/l);\n\t\tmul=1ll*mul*qpow(fac[x/l],sphi[r]-sphi[l-1])%mod;\n\t\tres=1ll*res*qpow(mul,1ll*(y/l)*(z/l)%(mod-1))%mod;\n\t} return res;\n}\nint calc4(int x,int y,int z){\n\tint res=1;\n\tfor(int l=1,r;l<=min(x,y);l=r+1){\n\t\tr=1e9;\n\t\tif(x/l) chkmin(r,x/(x/l));\n\t\tif(y/l) chkmin(r,y/(y/l));\n\t\tif(z/l) chkmin(r,z/(z/l));\n\t\tres=1ll*res*qpow(1ll*prd_phi[r]*prd_phi_inv[l-1]%mod,1ll*(x/l)*(y/l)*(z/l)%(mod-1))%mod;\n\t\tint X=x/l,Y=y/l,Z=z/l,sm=1ll*Z*(sphi[r]-sphi[l-1])%(mod-1);\n\t\tfor(int L=1,R;L<=min(X,Y);L=R+1){\n\t\t\tR=1e9;\n\t\t\tif(X/L) chkmin(R,X/(X/L));\n\t\t\tif(Y/L) chkmin(R,Y/(Y/L));\n\t\t\tres=1ll*res*qpow(1ll*prd[R]*prd_inv[L-1]%mod,1ll*(X/L)*(Y/L)*sm%(mod-1))%mod;\n\t\t}\n\t}\n\treturn res;\n}\nint solve3(int x,int y,int z){\n\treturn 1ll*calc3(x,y,z)*calc3(y,x,z)%mod*\n\tqpow(calc4(x,y,z),-1)%mod*qpow(calc4(x,z,y),-1)%mod;\n}\nint main(){\n\tint qu;scanf(\"%d%lld\",&qu,&mod);\n\t_base1=(_base1<<64)/mod;_base2=(_base2<<64)/(mod-1);\n\tsieve(MAXV);\n\twhile(qu--){\n\t\tint a,b,c;scanf(\"%d%d%d\",&a,&b,&c);\n\t\tprintf(\"%d %d %d\\n\",solve1(a,b,c),solve2(a,b,c),solve3(a,b,c));\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1628221003,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5518 [MtOI2019]\u5e7d\u7075\u4e50\u56e2 / \u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u57fa\u7840\u7ec3\u4e60\u9898"
    },
    {
        "content": "\u505a /tuu \u4e86\u8fd9\u9898\uff0c\u6709\u88ab\u6076\u5fc3\u5230\u2026\u2026\u771f\u5c31\u300c\u4e00\u676f\u8336\uff0c\u4e00\u5305\u70df\uff0c\u4e00\uff08\u516d\uff09\u9053\u83ab\u53cd\u505a\u4e00\u5929\u300d\u5457\u2026\u2026\u8003\u573a\u4e0a\u9047\u5230\u8fd9\u79cd\u9898\u80af\u5b9a\u679c\u65ad\u62ff\u4e2a 60pts \u8dd1\u8def\u2026\u2026\n\n\u4e00\u5f00\u59cb\u770b\u6210\u4e86 $\\sum$ \u611f\u89c9\u4e0d\u53ef\u505a\u3002$\\prod$ \u662f\u53ef\u4ee5\u62c6\u5f00\u7684\uff08\u5c31\u50cf\u52a0\u6cd5\u9047\u5230 $\\sum$ \u4e5f\u53ef\u4ee5\u62c6\u5f00\uff09\uff0c\u8bbe\n$$\na=\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^Ci^{f(type)}\\\\\nb=\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^Cj^{f(type)}\\\\\nc=\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{f(type)}\\\\\nd=\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,k)^{f(type)}\n$$\n\u90a3\u4e48 $ans=\\dfrac{ab}{cd}$\u3002\u53c8\u6ce8\u610f\u5230 $a,b$ \u548c $c,d$ \u8fd9\u4e24\u7ec4\u662f\u5bf9\u79f0\u7684\uff0c\u63a8\u67ff\u5b50\u7684\u65f6\u5019\u6bcf\u7ec4\u53ea\u9700\u8981\u7b97\u4e00\u4e2a\uff0c\u5b9e\u73b0\u7684\u65f6\u5019\u5c31\u628a\u67d0\u4e24\u4e2a\u53d8\u91cf\u8c03\u6362\u4f4d\u7f6e\u7136\u540e CV \u5373\u53ef\u3002\u4e8e\u662f\u4efb\u52a1\u5c31\u662f\u6c42 $type=0,1,2$ \u65f6\u7684 $a,c$\uff0c\u4e00\u5171\u516d\u4e2a\u4efb\u52a1\u3002$0a$ \u548c $1a$ \u662f\u5c0f\u5b66\u4e8c\u5e74\u7ea7\u90fd\u4f1a\u7684\uff0c\u4e0d\u9700\u8981\u83ab\u53cd\uff1b$0c$ \u662f\u7a76\u6781\u83ab\u53cd\u57fa\u7840\uff0c$1c$ \u662f\u83ab\u53cd\u4e2d\u7b49\u9898\uff0c\u60f3\u5fc5\u6765\u6311\u6218\u8fd9\u9898\u7684\u4eba\u90fd\u662f\u4f1a\u7684\uff1b\u8fd9\u7bc7\u9898\u89e3\u91cd\u70b9\u8bf4\u8bf4 $2a$ \u548c $2c$\uff0c\u611f\u89c9\u6709\u6709\u610f\u601d\u53c8\u4e0d\u5931\u96be\u5ea6\uff08\u540c\u65f6\u8fd8\u4f1a\u628a\u4eba\u63a8\u5410\uff09\u3002\n\n---\n\n$2a$\uff1a\u8003\u8651\u5bf9 $\\gcd(i,j,k)$ \u65bd\u52a0\u5267\u672c\u4f5c\u7528\uff1a\u9047\u5230 gcd \u76f4\u63a5\u679a\u4e3e\u3002\n$$\n\\begin{aligned}\na&=\\prod_o\\prod_{i=1}^Ai^{o\\sum\\limits_{j=1}^B\\sum\\limits_{k=1}^C[\\gcd(i,j,k)=o]}\\\\\n&=\\prod_o\\prod_{i=1}^{\\left\\lfloor\\frac Ao\\right\\rfloor}(io)^{o\\sum\\limits_{j=1}^{\\left\\lfloor\\frac Bo\\right\\rfloor}\\sum\\limits_{k=1}^{\\left\\lfloor\\frac Co\\right\\rfloor}\\sum\\limits_{p\\mid i,p\\mid j,p\\mid k}\\mu(p)}\n\\end{aligned}\n$$\n\u628a $\\prod$ \u8f6c\u5316\u6210 $\\sum$ \u653e\u5230\u6307\u6570\u4e0a\u53cd\u6f14\u4e4b\u540e\uff0c\u8be5\u653e\u4e0b\u6765\u66f4\u65b9\u4fbf\u5730\u5904\u7406\u4e86\u3002\n$$\n\\begin{aligned}\na&=\\prod_o\\prod_{i=1}^{\\left\\lfloor\\frac Ao\\right\\rfloor}\\prod_{j=1}^{\\left\\lfloor\\frac Bo\\right\\rfloor}\\prod_{k=1}^{\\left\\lfloor\\frac Co\\right\\rfloor}\\prod_{p\\mid i,p\\mid j,p\\mid k}(io)^{o\\mu(p)}\\\\\n&=\\prod_{p}\\prod_o\\prod_{i=1}^{\\left\\lfloor\\frac A{op}\\right\\rfloor}(iop)^{o\\mu(p)\\left\\lfloor\\frac B{op}\\right\\rfloor\\left\\lfloor\\frac C{op}\\right\\rfloor}\n\\end{aligned}\n$$\n\u5bf9 $op$ \u6574\u9664\u5206\u5757\u3002\n$$\n\\begin{aligned}a&=\\prod_q\\prod_{p\\mid q}\\prod_{i=1}^{\\left\\lfloor\\frac Aq\\right\\rfloor}(iq)^{\\frac qp\\mu(p)\\left\\lfloor\\frac Bq\\right\\rfloor\\left\\lfloor\\frac Cq\\right\\rfloor}\\\\\n&=\\prod_q\\prod_{p\\mid q}\\left(\\left\\lfloor\\dfrac Aq\\right\\rfloor!q^{\\left\\lfloor\\frac Aq\\right\\rfloor}\\right)^{\\frac qp\\mu(p)\\left\\lfloor\\frac Bq\\right\\rfloor\\left\\lfloor\\frac Cq\\right\\rfloor}\n\\end{aligned}\n$$\n\u5230\u8fd9\u513f\u5c31\u6709\u4e86\u4e2a\u505a\u6cd5\u7684\u96cf\u5f62\uff1a\u5bf9 $q$ \u6574\u9664\u5206\u5757\uff0c\u7136\u540e $p$ \u8fd9\u4e2a $\\prod$ \u5c31\u662f\u4e00\u4e2a\u7c7b\u4f3c\u72c4\u524d\u7684\u51fd\u6570\u5728 $q$ \u5904\u7684\u53d6\u503c\uff0c\u8fd9\u91cc\u9762\u5982\u679c\u53ea\u6709 $p,q,\\dfrac qp$ \u8fd9\u4e09\u8005\u76f8\u5173\u7684\u91cf\u7684\u8bdd\u662f\u53ef\u4ee5\u76f4\u63a5\u9884\u5904\u7406\u7684\u3002\u4f46\u662f\u8fd9\u91cc\u9762\u597d\u6b7b\u4e0d\u6b7b\u6709 $A,B,C$ \u7684\u6574\u9664\u503c\uff08\u5728\u6574\u9664\u5206\u5757\u7684\u65f6\u5019\u89c6\u4f5c\u5e38\u6570\uff0c\u4f46\u662f\u5bf9\u4e8e\u4e0d\u540c\u6d4b\u8bd5\u70b9\u5c31 GG \u4e86\uff09\uff0c\u6240\u4ee5\u8fd8\u8981\u7ee7\u7eed\u62c6\uff1a\n$$\na=\\prod_q\\left(\\left\\lfloor\\dfrac Aq\\right\\rfloor!\\right)^{\\left\\lfloor\\frac Bq\\right\\rfloor\\left\\lfloor\\frac Cq\\right\\rfloor q\\sum\\limits_{p\\mid q}\\frac{\\mu(p)}p}q^{\\left\\lfloor\\frac Aq\\right\\rfloor\\left\\lfloor\\frac Bq\\right\\rfloor\\left\\lfloor\\frac Cq\\right\\rfloor q\\sum\\limits_{p\\mid q}\\frac{\\mu(p)}p}\n$$\n\u5c45\u7136\u770b\u5230\u4e86 $\\sum\\limits_{p\\mid q}\\dfrac{\\mu(p)}p$ \u8fd9\u4e2a\u5f0f\u5b50\uff0c\u56de\u60f3\u8d77\u4e86\u4e07\u5e74\u6ca1\u7528\u8fc7\u7684\u6052\u7b49\u5f0f $\\sum\\limits_{i\\mid x}\\dfrac{\\mu(i)}i=\\dfrac{\\varphi(x)}x$\uff01\uff01\uff0111 \u4e8e\u662f $q\\sum\\limits_{p\\mid q}\\dfrac{\\mu(p)}p=\\varphi(q)$\u3002\uff08u1s1 \u4f60\u53ef\u80fd\u4f1a\u8bf4\u8fd9\u79cd\u6a21\u610f\u4e49\u4e0b\u62c6\u51fa\u5206\u6570\u6b21\u5e42\u518d\u5316\u56de\u6574\u6570\u6b21\u5e42\uff0c\u8003\u8651\u5230\u9ad8\u6b21\u5269\u4f59\u5b58\u5728\u552f\u4e00\u6027\u95ee\u9898\uff0c\u4e0d\u592a\u4e25\u8c28\u5427\uff1f\u5176\u5b9e\u5927\u53ef\u8fd9\u6837\u7406\u89e3\uff1a\u5047\u8bbe\u5168\u662f\u5728\u590d\u6570\u57df\u4e0b\u5b9a\u4e49\u7684\u4e1c\u897f\uff0c\u90a3\u4e48\u8fd9\u4e48\u63a8\u663e\u7136\u6ca1\u6bdb\u75c5\uff0c\u53ea\u662f\u9898\u76ee\u4fdd\u8bc1\u8fd9\u4e2a\u5f0f\u5b50\u7684\u503c\u662f\u6574\u6570\uff0c\u6545\u6700\u540e\u63a8\u51fa\u6765\u8ba1\u7b97\u53ef\u4ee5\u53d6\u6a21\u3002\u6240\u4ee5\u662f\u5b8c\u5168\u4e25\u8c28\u7684\uff09\n\n\u90a3\u4e48\u81ea\u884c\u66ff\u6362\u4e00\u4e0b\uff0c\u53ea\u9700\u8981\u5bf9 $q$ \u6574\u9664\u5206\u5757\uff0c\u5bf9\u4e8e\u4e00\u5757\u53ea\u8981\u6c42 $\\varphi(x)$ \u7684\u524d\u7f00\u548c\u4e0e $x^{\\varphi(x)}$ \u7684\u524d\u7f00\u79ef\u5373\u53ef\uff0c\u5355\u6b21\u8be2\u95ee\u590d\u6742\u5ea6 $\\mathrm O(\\sqrt n\\log n)$\u3002\n\n\u8fd9\u90e8\u5206\u8fd8\u662f\u4e0d\u7b97\u5f88\u96be\u7684\uff0c\u53ea\u662f\u7528\u5230\u4e86\u4e07\u5e74\u4e0d\u7528\u7684\u6052\u7b49\u5f0f\uff0c\u611f\u89c9\u5f88\u6709\u8da3\u3002\n\n---\n\n$2c$\uff1a\u8fd9\u91cc\u9762\u6709\u4e24\u4e2a gcd\uff0c\u662f\u6574\u9664\u5173\u7cfb\u3002zszz \u83ab\u53cd\u9898\u8981\u8c28\u614e\uff0c\u4e0d\u80fd\u4e00\u53e3\u6c14\u5168\u90e8\u53cd\u6f14\u6389\uff0c\u8981\u4e00\u4e2a\u4e00\u4e2a\u53cd\u6f14\u7136\u540e\u6839\u636e gcd \u4e4b\u95f4\u7684\u5173\u7cfb\u52a0\u9650\u5236\u6761\u4ef6\u3002\u8fd9\u4e2a\u5176\u5b9e\u5148\u679a\u4e3e\u54ea\u4e2a\u90fd\u662f\u80fd\u505a\u7684\uff0c\u6211\u679a\u4e3e\u7684\u662f $\\gcd(i,j)$\u3002\n$$\n\\begin{aligned}c&=\\prod_o\\prod_{p\\mid o}o^{p\\sum\\limits_{i=1}^A\\sum\\limits_{j=1}^B[\\gcd(i,j)=o]\\sum\\limits_{k=1}^C[\\gcd(k,o)=p]}\\\\\n&=\\prod_o\\prod_{p\\mid o}o^{p\\sum\\limits_{i=1}^{\\left\\lfloor\\frac Ao\\right\\rfloor}\\sum\\limits_{j=1}^{\\left\\lfloor\\frac Bo\\right\\rfloor}\\sum\\limits_{q\\mid i,q\\mid j}\\mu(q)\\sum\\limits_{k=1}^{\\left\\lfloor\\frac Cp\\right\\rfloor}\\sum\\limits_{r\\mid k,r\\mid \\frac op}\\mu(r)}\\\\\n&=\\prod_o\\prod_{p\\mid o}o^{p\\sum\\limits_q\\mu(q)\\sum\\limits_{r\\mid\\frac op}\\mu(r)\\left\\lfloor\\frac A{oq}\\right\\rfloor\\left\\lfloor\\frac B{oq}\\right\\rfloor\\left\\lfloor\\frac C{pr}\\right\\rfloor}\n\\end{aligned}\n$$\n\u5230\u76ee\u524d\u7684\u6700\u540e\u4e00\u6b65\u76f8\u6bd4\u4e8e $2a$ \u7684\u5904\u7406\u5c31\u723d\u5feb\u5f88\u591a\uff0c$2a$ \u7684 $i$ \u8fdf\u8fdf\u4e0d\u80fd\u88ab\u5316\u6389\u3002\u4e0d\u77e5\u9053\u5bfc\u81f4\u8fd9\u4e2a\u7684\u672c\u8d28\u539f\u56e0\u662f\u5565\uff08\uff08\n\n\u53cd\u6f14\u7ed3\u675f\u4e4b\u540e $\\sum$ \u6307\u6570\u62c6\u4e0b\u6765\u53d8\u6210 $\\prod$\u3002\n$$\nc=\\prod_o\\prod_{p\\mid o}\\prod_q\\prod_{r\\mid \\frac op}o^{p\\mu(q)\\mu(r)\\left\\lfloor\\frac A{oq}\\right\\rfloor\\left\\lfloor\\frac B{oq}\\right\\rfloor\\left\\lfloor\\frac C{pr}\\right\\rfloor}\n$$\n\u63a5\u4e0b\u6765\u53c8\u5230\u4e86\u559c\u95fb\u4e50\u89c1\u7684\u5c06 $x\\mid y$ \u6362\u5143\u6210 $y'=xy$ \u65f6\u95f4~\n$$\n\\begin{aligned}c&=\\prod_p\\prod_o\\prod_q\\prod_{r\\mid o}(op)^{p\\mu(q)\\mu(r)\\left\\lfloor\\frac A{opq}\\right\\rfloor\\left\\lfloor\\frac B{opq}\\right\\rfloor\\left\\lfloor\\frac C{pr}\\right\\rfloor}\\\\\n&=\\prod_p\\prod_r\\prod_q\\prod_o(rop)^{p\\mu(p)\\mu(r)\\left\\lfloor\\frac A{ropq}\\right\\rfloor\\left\\lfloor\\frac B{ropq}\\right\\rfloor\\left\\lfloor\\frac C{pr}\\right\\rfloor}\n\\end{aligned}\n$$\n\u63a5\u4e0b\u6765\u662f\u559c\u95fb\u4e50\u89c1\u7684\u6574\u9664\u5206\u5757\u2014\u2014\u679a\u4e3e\u4e24\u4e2a\u53d8\u91cf\u7684\u4e58\u79ef\u65f6\u95f4~\n$$\nc=\\prod_s\\prod_t\\prod_{p\\mid s}\\prod_{o\\mid t}(so)^{p\\mu\\left(\\frac to\\right)\\mu\\left(\\frac sp\\right)\\left\\lfloor\\frac A{st}\\right\\rfloor\\left\\lfloor\\frac B{st}\\right\\rfloor\\left\\lfloor\\frac C{s}\\right\\rfloor}\n$$\n\u5230\u8fd9\u513f\u5df2\u7ecf\u53ef\u4ee5\u505a\u4e86\uff0c\u5e76\u4e14\u65e0\u6cd5\u5f80\u4e0b\u7ee7\u7eed\u53d6\u5f97\u66f4\u4f18\u590d\u6742\u5ea6\u4e86\u2014\u2014\u56e0\u4e3a\u8fd9\u513f\u7684\u6574\u9664\u91cc\u9762\u7684\u5206\u6bcd\u6709\u4e24\u79cd\uff08\u4e0d\u53ef\u80fd\u641e\u6210\u4e00\u79cd\u7684\uff09\uff0c\u9700\u8981\u7684\u662f\u4e24\u6b21\u6574\u9664\u5206\u5757\uff0c\u800c\u4e0d\u662f\u4e8c\u7ef4\u6574\u9664\u5206\u5757\uff0c\u5373\u5148\u5bf9\u4e00\u4e2a\u53d8\u91cf\u5206\u5757\uff0c\u5bf9\u6bcf\u4e2a\u5757\u90fd\u5bf9\u53e6\u4e00\u4e2a\u53d8\u91cf\u5206\u5757\u3002\u8fd9\u6837\u4e00\u822c\u60c5\u51b5\u4e0b\u6700\u574f\u662f $\\mathrm O(\\sqrt n\\times\\sqrt n)=\\mathrm O(n)$\uff0c\u5728\u8fd9\u9898\u91cc\u9762\uff0c\u5982\u679c\u5148\u5206\u5757 $s$\uff0c\u90a3\u4e48 $t$ \u7684\u5206\u5b50\u662f $\\dfrac ns$\uff0c\u8fd9\u548c\u4e0d\u9884\u5904\u7406\u7684\u675c\u6559\u7b5b\u7684\u590d\u6742\u5ea6\u5206\u6790\u662f\u4e00\u6837\u7684\uff0c\u662f $\\mathrm O\\!\\left(n^{\\frac 34}\\right)$~~\uff08\u9884\u5904\u7406\u5b9e\u5728\u662f\u592a\u6655\u4e86\uff0c\u5c31\u4e0d\u641e\u4e86\uff09~~\u3002\u90a3\u4e48\u8003\u8651\u5bf9\u5df2\u7ecf\u5206\u597d\u7684\u6bcf\u4e2a\u5757\u5bf9\u8be5\u5982\u4f55\u7b97\u8d21\u732e\uff0c\u90a3\u4e48\u4e09\u4e2a\u6574\u9664\u90fd\u662f\u5e38\u6570\uff0c\u6211\u4eec\u8981\u6c42\u7684\u662f\n$$\n\\prod_{p\\mid s}\\prod_{o\\mid t}(so)^{p\\mu\\left(\\frac to\\right)\\mu\\left(\\frac sp\\right)}\n$$\n\u8fd9\u4e2a\u663e\u7136\u53ef\u4ee5\u7528\u7c7b\u4f3c\u72c4\u524d / \u72c4\u5377\u7684\u65b9\u5f0f\u9884\u5904\u7406\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u6837\u6269\u5c55\u5230\u4e24\u4e2a\u53d8\u91cf\u7684\u8bdd\uff0c\u9700\u8981\u5c06\u53d8\u91cf\u5206\u7c7b\u6bcf\u7c7b\u72ec\u7acb\u5f00\u6765\u7136\u540e\u5206\u522b\u9884\u5904\u7406\uff0c\u5206\u5757\u6c42\u503c\u7684\u65f6\u5019\u5c31\u5206\u522b\u8c03\u7528\u4e24\u7c7b\u7684\u524d\u7f00\u548c / \u79ef\u4f5c\u7528\u5230\u4e00\u8d77\u3002\u8fd9\u4e2a\u5f0f\u5b50\u8fd8\u662f\u4e0d\u96be\u62c6\u7684\uff1a\n$$\n\\prod_{p\\mid s}\\prod_{o\\mid t}(so)^{p\\mu\\left(\\frac to\\right)\\mu\\left(\\frac sp\\right)}=\\left(\\prod_{p\\mid s}s^{p\\mu\\left(\\frac sp\\right)}\\right)^{\\sum\\limits_{o\\mid t}\\mu\\left(\\frac to\\right)}\\left(\\prod_{o\\mid t}o^{\\mu\\left(\\frac to\\right)}\\right)^{\\sum\\limits_{p\\mid s}p\\mu\\left(\\frac sp\\right)}\n$$\n\u9884\u5904\u7406\u56db\u4e2a\u524d\u7f00\u548c / \u79ef\u5373\u53ef\u3002\u9884\u5904\u7406\u7684\u8bdd\uff0c\u56e0\u4e3a\u8ba1\u7b97\u91cf\u662f\u7ebf\u5bf9\uff0c\u518d\u52a0\u4e0a\u4e2a\u5feb\u901f\u5e42\u5c31\u662f\u7ebf\u6027\u4e8c\u6b21\u5bf9\u6570\u4e86\u3002\u5355\u6b21\u8be2\u95ee\u4e5f\u53d7\u5230\u5feb\u901f\u5e42\u7684\u5f71\u54cd\uff0c\u53d8\u6210 $\\mathrm O\\!\\left(n^{\\frac 34}\\log n\\right)$\u3002\n\n---\n\n\u603b\u590d\u6742\u5ea6\u662f $\\mathrm O\\!\\left(n\\log^2n+n^{\\frac 34}\\log n\\right)$\uff0c\u5e38\u6570\u975e\u5e38\u5927\u3002\u8fd9\u9898\u6a21\u6570\u662f\u8f93\u5165\u7684\uff0c\u7528\u4e86\u4e2a\u5feb\u6a21\uff0c\u8fd8\u903b\u8f91\u4f18\u5316\u4e86\u51e0\u4e0b\u624d\u52c9\u5f3a\u8fc7\u4e86\uff0c\u4eba\u50bb\u5e38\u6570\u5927\u554a\u3002\n\n\u8d34\u4e2a[\u4ee3\u7801](https://www.luogu.com.cn/paste/rf2tvd8a)\u611f\u53d7\u4e00\u4e0b\u58ee\u89c2\u3002\n\n\u9898\u89e3\u5199\u7684\u7d2f\u8db4\u4e86\u3002",
        "postTime": 1614526725,
        "uid": 138400,
        "name": "chenxia25",
        "ccfLevel": 9,
        "title": "P5518"
    },
    {
        "content": "\u63a8\u5f0f\u5b50\u9898\u5c31\u5e94\u8be5\u76f4\u63a5\u6765\u3002\n\n\u63a8\u8350\u5230\u535a\u5ba2\u53bb\u770b\uff0c\u56e0\u4e3a\u6211\u4e0d\u77e5\u9053\u4f1a\u4e0d\u4f1a\u6709\u6e32\u67d3 bug\uff08 [Link](https://www.luogu.com.cn/blog/blog10086001/solution-p5518)\n\n### $type=0$\n\n$$\n\\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C \\dfrac{\\operatorname{lcm}(i,j)}{\\gcd(i,k)}\\\\\n\n\\begin{aligned}\n&= \\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C \\dfrac{ij}{\\gcd(i,j)\\gcd(i,k)} \\\\\n&= \\prod_{i=1}^A i \\prod_{j=1}^B j \\prod_{k=1}^C \\dfrac{1}{\\gcd(i,j)\\gcd(i,k)} \\\\\n&= (A!)^{BC} (B!)^{AC} \\left( \\prod_{i=1}^A \\prod_{j=1}^B \\dfrac{1}{\\gcd(i,j)} \\right)^C\\cdot \\left(\\prod_{i=1}^{A} \\prod_{k=1}^C \\dfrac{1}{\\gcd(i,k)}\\right)^B \\\\\n&= (A!)^{BC} (B!)^{AC} \\left(\\dfrac{1}{G(A,B)}\\right)^C\\cdot \\left(\\dfrac{1}{G(A,C)}\\right)^B\n\\end{aligned}\n$$\n\n\u5176\u4e2d\uff1a\n$$\nG(n,m)\\\\\n\\begin{aligned}\n&= \\prod_{i=1}^n \\prod_{j=1}^m \\gcd(i,j) \\\\\n&= \\prod_{d=1}^{n}d^{\\sum_{i=1}^{\\lfloor \\frac{n}{d} \\rfloor} \\sum_{j=1}^{\\lfloor \\frac{m}{d} \\rfloor} \\sum_{D|\\gcd(i,j)} \\mu(D)} \\\\\n&= \\prod_{d=1}^n d^{\\sum_{D=1}^{\\lfloor \\frac{n}{d} \\rfloor} \\mu(D) \\lfloor \\frac{n}{dD} \\rfloor \\lfloor \\frac{m}{dD} \\rfloor} \\\\\n&= \\prod_{T=1}^n \\left(\\prod_{d|T} d^{\\mu\\left( \\frac{T}{d} \\right)}\\right)^{{ \\lfloor \\frac{n}{T} \\rfloor \\lfloor \\frac{m}{T} \\rfloor}}\n\\end{aligned}\n$$\n\u4ee4 $f(T) = \\prod_{d|T} d^{\\mu\\left(\\frac{T}{d}\\right)}$\uff0c\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u76f4\u63a5\u679a\u4e3e\u500d\u6570\u9884\u5904\u7406\uff0c\u6eda\u4e2a\u524d\u7f00\u79ef\u5c31\u53ef\u4ee5\u6574\u9664\u5206\u5757\u505a\u4e86\u3002\n\n### $type=1$\n\n$$\n\\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C \\left( \\dfrac{\\operatorname{lcm}(i,j)}{\\gcd(i,k)} \\right)^{ijk} \\\\\n\\begin{aligned}\n&= \\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C \\left( \\dfrac{ij}{\\gcd(i,j)\\gcd(i,k)} \\right)^{ijk} \\\\\n&= \\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C ij^{ijk} \\cdot \\left( \\dfrac{1}{\\gcd(i,j)} \\right)^{ijk} \\left( \\dfrac{1}{\\gcd(i,k)} \\right)^{ijk} \\\\\n\\end{aligned}\n$$\n\n\u663e\u7136\u8fd9\u4e2a\u5f0f\u5b50\u91cc\u4e09\u4e2a\u4e1c\u897f\u72ec\u7acb\u3002\u53c8\u56e0\u4e3a\u540e\u9762\u4e24\u4e2a\u4e1c\u897f\u672c\u8d28\u76f8\u540c\uff0c\u8003\u8651\u5206\u6210\u4e24\u7c7b\u8ba1\u7b97\u3002\u5b9a\u4e49 $S(x) = \\dfrac{x(x+1)}{2}$\u3002\n\n#### Sub 1\n\n$$\n\\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C ij^{ijk} \\\\\n\\begin{aligned}\n&=\\left(\\prod_{i=1}^A i^i\\right)^{S(B)S(C)} \\cdot \\left(\\prod_{j=1}^B j^j\\right)^{S(A)S(C)}\n\\end{aligned}\n$$\n\n\u5bf9\u4e8e\u8fd9\u4e2a\u4e1c\u897f\uff0c\u5904\u7406 $i^i$\uff0c\u7528\u5feb\u901f\u5e42\u9884\u5904\u7406\u6eda\u4e2a\u524d\u7f00\u79ef\u5373\u53ef\u3002\u6ce8\u610f $i,j$ \u90fd\u6709\u8d21\u732e\u3002\n\n#### Sub 2\n\n\u5206\u6790\u4e00\u4e2a\u5373\u53ef\u3002\u6839\u636e\u4e0a\u9762\u7684\u63a8\u5bfc\u53ef\u4ee5\u76f4\u63a5\u5f97\u5230\u7b80\u5355\u7ed3\u8bba\u3002\u663e\u7136 $\\dfrac{1}{\\gcd(i,j)} = \\gcd(i,j)^{-1}$\uff0c\u5230\u65f6\u5019\u6c42\u4e2a\u9006\u4e5f\u7b80\u5355\u3002\n$$\n\\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C \\gcd(i,j)^{ijk} \\\\\n\\begin{aligned}\n&= \\left(\\prod_{i=1}^A \\prod_{j=1}^B \\gcd(i,j)^{ij}\\right)^{S(C)} \\\\\n&= \\left( \\prod_{d=1}^{A} d^{d^2 \\sum_{i=1}^{\\lfloor \\frac{A}{d}\\rfloor} \\sum_{j=1}^{\\lfloor \\frac{B}{d}\\rfloor} \\sum_{D|\\gcd(i,j)} \\mu(D)}\\right)^{S(C)} \\\\\n&= \\left( \\prod_{d=1}^A d^{d^2\\sum_{D=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\mu(D) D^2 \\lfloor \\frac{A}{dD} \\rfloor\\lfloor \\frac{B}{dD} \\rfloor} \\right)^{S(C)} \\\\\n&= \\left( \\prod_{T=1}^A \\left(\\left(\\prod_{d|T} d^{\\mu(\\frac{T}{d})}\\right)^{T^2}\\right)^{S(\\lfloor \\frac{A}{T} \\rfloor)S(\\lfloor \\frac{B}{T} \\rfloor)} \\right)^{S(C)} \\\\\n&= \\left( \\prod_{T=1}^A\\left( f(T)^{T^2}\\right)^{S(\\lfloor \\frac{A}{T} \\rfloor)S(\\lfloor \\frac{B}{T} \\rfloor)} \\right)^{S(C)}\n\\end{aligned}\n$$\n\u53d1\u73b0 $f(T)$ \u65e9\u5728\u4e8c\u5341\u5e74\u4e4b\u524d\u5c31\u5df2\u7ecf\u9884\u5904\u7406\u8fc7\u4e86\uff0c\u5b9a\u4e49 $g(T) = f(T)^{T^2}$\uff0c\u663e\u7136\u8fd9\u4e2a\u4e1c\u897f\u4e5f\u53ef\u4ee5\u9884\u5904\u7406\u3002\u4e00\u6837\u7684\u5957\u8def\u6eda\u4e2a\u524d\u7f00\u79ef\u53ef\u4ee5\u5b8c\u6210\u8fd9\u4e2a\u95ee\u9898\u3002\n\n\u4e8e\u662f\u5bf9\u4e8e\u8fd9\u4e2a\u4e1c\u897f\u5b8c\u6210\u4e00\u4e2a\u51fd\u6570\uff0c\u5230\u65f6\u5019\u53ea\u9700\u8981\u6539\u53d8\u4e00\u4e0b\u4f20\u53c2\u5373\u53ef\u3002\u4e00\u5b9a\u8981\u6ce8\u610f\u53d6\u9006\u5143\u3002\n\n### $type=2$\n\n$$\n\\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C \\left( \\dfrac{\\operatorname{lcm}(i,j)}{\\gcd(i,k)} \\right)^{\\gcd(i,j,k)} \\\\\n\\begin{aligned}\n&= \\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C \\left( \\dfrac{ij}{\\gcd(i,j)\\gcd(i,k)} \\right)^{\\gcd(i,j,k)} \\\\\n&= \\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C ij^{\\gcd(i,j,k)} \\cdot \\left( \\dfrac{1}{\\gcd(i,j)}\\right)^{\\gcd(i,j,k)} \\cdot\\left( \\dfrac{1}{\\gcd(i,k)}\\right)^{\\gcd(i,j,k)}\n\\end{aligned}\n$$\n\n\u4e00\u6837\u7684\u5957\u8def\uff0c\u4e09\u8005\u4e92\u4e0d\u5e72\u6270\uff0c\u62c6\u5f00\u770b\u3002\n\n#### Sub 1\n\n$$\n\\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C i^{\\gcd(i,j,k)} \\\\\n\\begin{aligned}\n&=\\prod_{d=1}^{A} \\prod_{i=1}^{\\lfloor \\frac{A}{d} \\rfloor} (id)^{d\\sum_{j=1}^B \\sum_{k=1}^C [\\gcd(i,j,k)=1]} \\\\\n&=\\prod_{d=1}^A\\prod_{D=1}^{\\lfloor \\frac{A}{d} \\rfloor} \\prod_{i=1}^{\\lfloor \\frac{A}{dD} \\rfloor} (Did)^{\\mu(D) d \\lfloor \\frac{B}{dD} \\rfloor \\lfloor \\frac{C}{dD} \\rfloor} \\\\\n&=\\prod_{T=1}^A \\left(\\prod_{i=1}^{\\lfloor \\frac{A}{T} \\rfloor}(Ti)^{\\sum_{d|T} \\mu(d) \\frac{T}{d}}\\right)^{ \\lfloor \\frac{B}{T} \\rfloor\\lfloor \\frac{C}{T} \\rfloor} \\\\\n&=\\prod_{T=1}^A \\left(\\left( \\left\\lfloor\\dfrac{A}{T}\\right\\rfloor!T^{\\lfloor \\frac{A}{T} \\rfloor} \\right)^{\\sum_{d|T} \\mu(d) \\frac{T}{d}}\\right)^{\\lfloor \\frac{B}{T} \\rfloor \\lfloor \\frac{C}{T} \\rfloor}\n\\end{aligned}\n$$\n\n\u6ce8\u610f\u5230 $\\sum_{d|T} \\mu(d) \\frac{T}{d}$ \u5b9e\u8d28\u4e0a\u662f $\\mu * id$\uff0c\u53c8\u77e5\u9053 $\\varphi = \\mu * id$\uff0c\u6240\u4ee5\u6709\uff1a\n$$\n\\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C i^{\\gcd(i,j,k)} \\\\\n\\begin{aligned}\n&=\\prod_{T=1}^A \\left(\\left( \\left\\lfloor\\dfrac{A}{T}\\right\\rfloor! T^{\\lfloor \\frac{A}{T} \\rfloor} \\right)^{\\varphi(T)}\\right)^{\\lfloor \\frac{B}{T} \\rfloor \\lfloor \\frac{C}{T} \\rfloor} \\\\\n&= \\prod_{T=1}^A \\left( \\left(\\left\\lfloor\\dfrac{A}{T} \\right\\rfloor!\\right)^{\\varphi(T)} \\cdot \\left(T^{\\varphi(T)}\\right)^{\\lfloor \\frac{A}{T} \\rfloor} \\right)^{\\lfloor \\frac{B}{T} \\rfloor \\lfloor \\frac{C}{T} \\rfloor} \\\\\n&= \\prod_{T=1}^A \\left( \\left(\\left\\lfloor\\dfrac{A}{T} \\right\\rfloor!\\right)^{\\lfloor \\frac{B}{T} \\rfloor \\lfloor \\frac{C}{T} \\rfloor} \\right)^{\\varphi(T)}\\cdot \\left(T^{\\varphi(T)}\\right)^{\\lfloor \\frac{A}{T} \\rfloor\\lfloor \\frac{B}{T} \\rfloor\\lfloor \\frac{C}{T} \\rfloor} \n\\end{aligned}\n$$\n\u73b0\u5728\u53ef\u4ee5\u5206\u6210\u4e24\u6bb5\u8fdb\u884c\u6574\u9664\u5206\u5757\u4e86\u3002\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u9884\u5904\u7406 $\\varphi(i)$ \u7684\u524d\u7f00\u548c\u5411 $p-1$ \u53d6\u6a21\u7684\u503c\uff08\u56e0\u4e3a\u662f\u6307\u6570\uff09\uff0c\u4ee5\u53ca $h(x) = x^{\\varphi(x)}$ \u7684\u524d\u7f00\u79ef\u5373\u53ef\u3002\n\n#### Sub 2\n\n\u4e00\u6837\u5230\u65f6\u5019\u53d6\u4e2a\u9006\u5143\u5c31\u884c\u4e86\u3002\u8003\u8651\u679a\u4e3e $\\gcd(i,j)$\u3002\n$$\n\\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C \\gcd(i,j)^{\\gcd(i,j,k)} \\\\\n\\begin{aligned}\n&=\\prod_{d=1}^A \\left( d^{\\sum_{i=1}^{\\lfloor \\frac{A}{d} \\rfloor} \\sum_{j=1}^{\\lfloor \\frac{B}{d} \\rfloor} [\\gcd(i,j)=1]}\\right)^{\\sum_{k=1}^C \\gcd(d,k)} \\\\\n&=\\prod_{d=1}^A \\left( d^{\\sum_{i=1}^{\\lfloor \\frac{A}{d} \\rfloor} \\sum_{j=1}^{\\lfloor \\frac{B}{d} \\rfloor} \\sum_{D|\\gcd(i,j)} \\mu(D)}\\right)^{\\sum_{k=1}^C \\gcd(d,k)} \\\\\n&=\\prod_{d=1}^A \\left( d^{\\sum_{D=1}^{\\lfloor \\frac{A}{d} \\rfloor}\\mu(D) \\left\\lfloor \\frac{A}{dD} \\right\\rfloor \\left\\lfloor \\frac{B}{dD} \\right\\rfloor} \\right)^{\\sum_{k=1}^C \\gcd(d,k)} \\\\\n&=\\prod_{T=1}^A \\left(\\prod_{d|T}  d^{ \\mu\\left(\\frac{T}{d}\\right) \\sum_{k=1}^C \\gcd(d,k)}\\right)^{\\left\\lfloor \\frac{A}{T} \\right\\rfloor\\left\\lfloor \\frac{B}{T} \\right\\rfloor}\n\\end{aligned}\n$$\n\u663e\u7136\u8fd9\u4e2a\u6307\u6570\u662f\u4e0d\u4f18\u7f8e\u7684\u3002\u63d0\u51fa\u6765\u6162\u6162\u641e\uff1a\n$$\n\\sum_{k=1}^C \\gcd(d,k) \\\\\n\\begin{aligned}\n&= \\sum_{D|d}D \\sum_{k=1}^{\\lfloor \\frac{C}{D} \\rfloor} [\\gcd(\\tfrac{d}{D},k)=1] \\\\\n&= \\sum_{D|d}D \\sum_{k=1}^{\\lfloor \\frac{C}{D} \\rfloor} \\sum_{e|\\gcd(\\tfrac{d}{D},k)} \\mu(e) \\\\\n&= \\sum_{D|d}D \\sum_{e| \\frac{d}{D}} \\mu(e) \\left\\lfloor \\dfrac{C}{eD} \\right\\rfloor \\\\\n&= \\sum_{t|d} \\left\\lfloor \\dfrac{C}{t} \\right\\rfloor \\sum_{D|t} \\mu\\left(\\frac{t}{D}\\right) D\n\\end{aligned}\n$$\n\u53d1\u73b0 $\\sum_{D|t} \\mu\\left(\\dfrac{t}{D}\\right)D$ \u53c8\u662f $\\mu*id=\\varphi$\uff0c\u53ef\u4ee5\u5199\u6210\uff1a\n$$\n\\sum_{t|d} \\left\\lfloor \\dfrac{C}{t} \\right\\rfloor \\sum_{D|t} \\mu\\left(\\frac{t}{D}\\right) D \\\\\n\\begin{aligned}\n&=\\sum_{t|d} \\left\\lfloor \\dfrac{C}{t} \\right\\rfloor \\varphi(t)\n\\end{aligned}\n$$\n \n\n\u5c06\u5176\u5e26\u56de\uff1a\n$$\n\\prod_{T=1}^A \\prod_{d|T}\\left(  d^{ \\mu\\left(\\frac{T}{d}\\right)\\left\\lfloor \\frac{A}{T} \\right\\rfloor\\left\\lfloor \\frac{B}{T} \\right\\rfloor }\\right)^{\\sum_{k=1}^C \\gcd(d,k)} \\\\\n\\begin{aligned}\n&=\\prod_{T=1}^A \\left(\\prod_{d|T}  d^{ \\mu\\left(\\frac{T}{d}\\right) \\sum_{t|d} \\left\\lfloor \\frac{C}{t} \\right\\rfloor \\varphi(t)}\\right)^{\\left\\lfloor \\frac{A}{T} \\right\\rfloor\\left\\lfloor \\frac{B}{T} \\right\\rfloor}\n\\end{aligned}\n$$\n\u5176\u5b9e\u8fd9\u6837\u5df2\u7ecf\u53ef\u4ee5\u505a\u5230 $O(Tn \\log n)/O(T n \\ln n)$ \u4e86\u3002\u4f46\u662f\u56e0\u4e3a\u5e38\u6570\u539f\u56e0\u62bd\u4e0d\u4e86\u70df\u3002\u6709\u4eba\u53bb\u5c1d\u8bd5\u4e86\u2026\u2026\n\n\u6b63\u89e3\u662f\u679a\u4e3e $\\gcd(i,j,k)$\uff0c\u5f0f\u5b50\u53ef\u4ee5\u5199\u6210\uff1a\n$$\n\\prod_{i=1}^A \\prod_{j=1}^B \\prod_{k=1}^C \\gcd(i,j)^{\\gcd(i,j,k)} \\\\\n\\begin{aligned}\n&=\\prod_{d=1}^A \\prod_{i=1}^{\\lfloor \\frac{A}{d} \\rfloor} \\prod_{j=1}^{\\lfloor \\frac{B}{d} \\rfloor} \\left(d \\cdot \\gcd(i,j)\\right)^{d \\sum_{k=1}^{\\lfloor \\frac{C}{d} \\rfloor} [\\gcd(i,j,k)=1]} \\\\\n&=\\prod_{d=1}^A \\prod_{D=1}^{\\lfloor \\frac{A}{d} \\rfloor} \\prod_{i=1}^{\\lfloor \\frac{A}{dD} \\rfloor}\\prod_{j=1}^{\\lfloor \\frac{B}{dD} \\rfloor} \\left( dD\\cdot\\gcd(i,j) \\right)^{d \\mu(D) \\lfloor \\frac{C}{dD} \\rfloor} \\\\\n&=\\left(\\prod_{d=1}^{A} \\prod_{D=1}^{\\lfloor \\frac{A}{d} \\rfloor} d D\\right)^{d \\mu(D) \\lfloor \\frac{A}{dD} \\rfloor\\lfloor \\frac{B}{dD} \\rfloor\\lfloor \\frac{C}{dD} \\rfloor} \\cdot \\left( \\prod_{d=1}^A \\prod_{D=1}^{\\lfloor \\frac{A}{d} \\rfloor} \\prod_{i=1}^{\\lfloor \\frac{A}{dD} \\rfloor}\\prod_{j=1}^{\\lfloor \\frac{B}{dD} \\rfloor}\\gcd(i,j) \\right)^{d \\mu(D) \\lfloor \\frac{C}{dD} \\rfloor} \\\\\n&=\\left( \\prod_{T=1}^A T^{\\lfloor \\frac{A}{T} \\rfloor\\lfloor \\frac{B}{T} \\rfloor\\lfloor \\frac{C}{T} \\rfloor} \\right)^{\\sum_{d|T} \\mu(d) \\frac{T}{d}} \\cdot \\left( \\prod_{d=1}^A \\prod_{D=1}^{\\lfloor \\frac{A}{d} \\rfloor} \\prod_{i=1}^{\\lfloor \\frac{A}{dD} \\rfloor}\\prod_{j=1}^{\\lfloor \\frac{B}{dD} \\rfloor}\\gcd(i,j) \\right)^{d \\mu(D) \\lfloor \\frac{C}{dD} \\rfloor} \\\\\n&=\\left( \\prod_{T=1}^A T^{\\varphi(T)} \\right)^{\\lfloor \\frac{A}{T} \\rfloor\\lfloor \\frac{B}{T} \\rfloor\\lfloor \\frac{C}{T} \\rfloor} \\cdot \\left( \\prod_{d=1}^A \\prod_{D=1}^{\\lfloor \\frac{A}{d} \\rfloor} \\prod_{i=1}^{\\lfloor \\frac{A}{dD} \\rfloor}\\prod_{j=1}^{\\lfloor \\frac{B}{dD} \\rfloor}\\gcd(i,j) \\right)^{d \\mu(D) \\lfloor \\frac{C}{dD} \\rfloor}\n\\end{aligned}\n$$\n\u663e\u7136\u62c6\u5f00\u66f4\u597d\u7b97\u3002\u6240\u4ee5\u53c8\u8981\u5206\u5f00\u53bb\u8ba1\u7b97\u2026\u2026\n\n#### Sub 2.1\n\n\u8fd9\u4e2a\u4e0d\u662f\u5df2\u7ecf\u7b97\u8fc7\u4e86\uff1f\n$$\n\\left( \\prod_{T=1}^A T^{\\varphi(T)} \\right)^{\\lfloor \\frac{A}{T} \\rfloor\\lfloor \\frac{B}{T} \\rfloor\\lfloor \\frac{C}{T} \\rfloor}\n$$\n\u6211\u4eec\u7b5b\u8fc7 $h(x) = x^{\\varphi(x)}$\u3002\u8fd9\u4e2a\u4e1c\u897f\u6211\u4eec\u751a\u81f3\u5728 Sub 1 \u505a\u8fc7\u3002\n\n\u5f53\u7136\u6709\u4e00\u4e2a\u66f4\u5999\u7684\u505a\u6cd5\u662f\u56e0\u4e3a Sub 2.1 \u7684\u6c42\u7684\u8fd9\u4e2a\u4e1c\u897f\uff0c\u5728\u6700\u7ec8\u6211\u4eec\u4f1a\u5c06\u53bb\u53d6\u9006\u5143\u3002\u6240\u4ee5\u4e58\u8d77\u6765\u5c31\u7b49\u4e8e $1$\u3002\u4f60\u76f4\u63a5\u7b97\u4e5f\u4e0d\u4f1a T\u3002\n\n#### Sub 2.2\n\n\u4e3b\u8981\u8fd8\u662f\u770b\u8fd9\u4e2a\u4e1c\u897f\u3002\u5173\u6ce8\u5230\u73b0\u5728\u53ea\u4e0e $\\gcd(i,j)$ \u4e0e $\\gcd(i,j,k)$ \u6709\u5173\uff0c\u4e0d\u96be\u8054\u60f3\u5230\u6574\u9664\u5206\u5757\u5957\u6574\u9664\u5206\u5757\u505a\u6cd5\u3002\n$$\n\\prod_{d=1}^A \\prod_{D=1}^{\\lfloor \\frac{A}{d} \\rfloor} \\left( \\prod_{i=1}^{\\lfloor \\frac{A}{dD} \\rfloor}\\prod_{j=1}^{\\lfloor \\frac{B}{dD} \\rfloor}\\gcd(i,j) \\right)^{d \\mu(D) \\lfloor \\frac{C}{dD} \\rfloor}\\\\\n\\begin{aligned}\n&=\\prod_{T=1}^A \\left(\\prod_{i=1}^{\\lfloor \\frac{A}{T} \\rfloor}\\prod_{j=1}^{\\lfloor \\frac{B}{T} \\rfloor} \\gcd(i,j)\\right)^{\\sum_{d|T} d\\mu(\\frac{T}{d}) \\lfloor \\frac{C}{T} \\rfloor}  \\\\\n&=\\prod_{T=1}^A\\left( \\prod_{D=1}^{\\lfloor \\frac{A}{T} \\rfloor}D^{\\lfloor \\frac{A}{T} \\rfloor\\lfloor \\frac{B}{T} \\rfloor}\\right)^{\\sum_{d|T} d \\mu(\\frac{T}{d}) \\lfloor \\frac{C}{T} \\rfloor} \\\\\n&=\\prod_{T=1}^A \\left( \\prod_{t=1}^{\\lfloor \\frac{A}{T} \\rfloor} \\left( \\prod_{d|t}\td^{\\mu(\\frac{t}{d})} \\right)^{\\lfloor \\frac{A}{Tt} \\rfloor \\lfloor \\frac{B}{Tt} \\rfloor} \\right)^{\\varphi(T) \\lfloor \\frac{C}{T} \\rfloor} \\\\\n&=\\prod_{T=1}^A \\left(\\left( \\prod_{t=1}^{\\lfloor \\frac{A}{T} \\rfloor} f(t)^{\\lfloor \\frac{A}{Tt} \\rfloor \\lfloor \\frac{B}{Tt} \\rfloor} \\right)^{ \\lfloor \\frac{C}{T} \\rfloor} \\right)^{\\varphi(T)}\n\\end{aligned}\n$$\n\n\n\u5185\u5c42\u6574\u9664\u5206\u5757\u4e0e\u5916\u5c42\u6574\u9664\u5206\u5757\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log p -T n^{\\frac{3}{4}} \\log p)$\u3002\u7b54\u6848\u5f0f\u5b50\u81ea\u5df1\u7406\u5427\u2026\u2026\u5b9e\u5728\u96be\u9876\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nLL MOD;\nLL cnt,phi[100005],prime[50005],mu[100005],smmu[100005],smphi[100005],fac[100005],h[100005],invh[100005],invfac[100005],f[100005],inv[100005],invf[100005],g[100005],invg[100005],se[100005];\nbool vis[100005];\nLL QuickPow(LL x,LL p)\n{\n\tLL ans=1,base=x;\n\twhile(p)\n\t{\n\t\tif(p&1)\tans=(ans*base)%MOD;\n\t\tbase=base*base%MOD;\n\t\tp>>=1;\n\t}\n\treturn ans;\n}\nvoid shai(LL upper)\n{\n\tvis[1]=true;\n\tf[1]=mu[1]=1;\n\tphi[1]=1;\n\tse[1]=1;\n\tse[0]=1;\n\tfor(LL i=2;i<=upper;++i)\n\t{\n\t\tse[i]=QuickPow(i,i);\n\t\tf[i]=1;\n\t\tif(!vis[i])\tprime[++cnt]=i,mu[i]=-1,phi[i]=i-1;\n\t\tfor(LL j=1;j<=cnt && prime[j]*i<=upper;++j)\n\t\t{\n\t\t\tvis[prime[j]*i]=true;\n\t\t\tif(i%prime[j]==0)\n\t\t\t{\n\t\t\t\tphi[i*prime[j]]=phi[i]*prime[j];\n\t\t\t\tmu[i*prime[j]]=0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tphi[i*prime[j]]=phi[i]*phi[prime[j]];\n\t\t\tmu[i*prime[j]]=-mu[i];\n\t\t}\n\t}\n\tfor(LL i=1;i<=upper;++i)\tsmmu[i]=(smmu[i-1]+mu[i]+MOD)%MOD,se[i]=se[i-1]*se[i]%MOD;\n\tf[0]=1;\n\tg[0]=1;\n\th[0]=1;\n\tfor(LL i=1;i<=upper;++i)\n\t\tfor(LL j=i;j<=upper;j+=i)\n\t\t\tif(mu[j/i]==1)\tf[j]=f[j]*i%MOD;\n\t\t\telse if(mu[j/i]==-1)\tf[j]=f[j]*inv[i]%MOD;\n\tfor(LL i=1;i<=upper;++i)\tg[i]=QuickPow(f[i],i*i%(MOD-1));\n\tfor(LL i=1;i<=upper;++i)\tf[i]=f[i-1]*f[i]%MOD;\n\tfor(LL i=1;i<=upper;++i)\tg[i]=g[i]*g[i-1]%MOD;\n\tfor(LL i=1;i<=upper;++i)\th[i]=QuickPow(i,phi[i]);\n\tfor(LL i=1;i<=upper;++i)\th[i]=(h[i-1]*h[i])%MOD;\n\tfor(LL i=1;i<=upper;++i)\tsmphi[i]=(smphi[i-1]+phi[i])%(MOD-1);\n\tfor(LL i=0;i<=upper;++i)\tinvf[i]=QuickPow(f[i],MOD-2);\n\tfor(LL i=0;i<=upper;++i)\tinvg[i]=QuickPow(g[i],MOD-2);\n\tfor(LL i=0;i<=upper;++i)\tinvh[i]=QuickPow(h[i],MOD-2);\n}\nLL G(LL n,LL m)\n{\n\tif(n>m)\tn^=m^=n^=m;\n\tLL ans=1;\n\tfor(LL l=1,r;l<=n;l=r+1)\n\t{\n\t\tr=min(n/(n/l),m/(m/l));\n\t\tans=ans*QuickPow((f[r]*invf[l-1])%MOD,(n/l)*(m/l)%(MOD-1))%MOD;\n\t}\n\treturn ans;\n}\nLL S(LL x){return x*(x+1)/2;}\nLL Calc1(LL n,LL m,LL t)\n{\n\tif(n>m)\tn^=m^=n^=m;\n\tLL ans=1;\n\tfor(LL l=1,r;l<=n;l=r+1)\n\t{\n\t\tr=min(n/(n/l),m/(m/l));\n\t\tans=ans*QuickPow(invg[r]*g[l-1]%MOD,S(n/l)%(MOD-1)*S(m/l)%(MOD-1))%MOD;\n\t}\n\treturn QuickPow(ans,S(t)%(MOD-1));\n}\nLL Sub1_1(LL a,LL b,LL c)\n{\n\tLL ans=1;\n\tfor(LL l=1,r;l<=min({a,b,c});l=r+1)\n\t{\n\t\tr=min({a/(a/l),b/(b/l),c/(c/l)});\n\t\tans=ans*(QuickPow(QuickPow(fac[a/l],(b/l)*(c/l)%(MOD-1)),(smphi[r]-smphi[l-1]+MOD-1)%(MOD-1)))%MOD;\n\t}\n\treturn ans;\n}\nLL Sub1_2(LL a,LL b,LL c)\n{\n\tLL ans=1;\n\tfor(LL l=1,r;l<=min({a,b,c});l=r+1)\n\t{\n\t\tr=min({a/(a/l),b/(b/l),c/(c/l)});\n\t\tans=(ans*QuickPow(h[r]*invh[l-1]%MOD,(a/l)*(b/l)%(MOD-1)*(c/l)%(MOD-1)))%MOD;\n\t}\n\treturn ans;\n}\nLL Sub2_1(LL a,LL b,LL c){return QuickPow(Sub1_2(a,b,c),MOD-2);}\nLL Sub2_2In(LL a,LL b)\n{\n\tLL ans=1;\n\tfor(LL l=1,r;l<=min(a,b);l=r+1)\n\t{\n\t\tr=min(a/(a/l),b/(b/l));\n\t\tans=ans*QuickPow(f[r]*invf[l-1]%MOD,(a/l)*(b/l)%(MOD-1))%MOD;\n\t}\n\treturn ans;\n}\nLL Sub2_2(LL a,LL b,LL c)\n{\n\tLL ans=1;\n\tfor(LL l=1,r;l<=min({a,b,c});l=r+1)\n\t{\n\t\tr=min({a/(a/l),b/(b/l),c/(c/l)});\n\t\tLL st=Sub2_2In(a/l,b/l);\n\t\tans=ans*QuickPow(QuickPow(st,c/l),(smphi[r]-smphi[l-1]+MOD-1)%(MOD-1))%MOD;\n\t}\n\treturn QuickPow(ans,MOD-2);\n}\nLL Sub1(LL a,LL b,LL c){return Sub1_1(a,b,c)*Sub1_1(b,a,c)%MOD*Sub1_2(a,b,c)%MOD*Sub1_2(b,a,c)%MOD;}\nLL Sub2(LL a,LL b,LL c){return Sub2_1(a,b,c)*Sub2_1(a,c,b)%MOD*Sub2_2(a,b,c)%MOD*Sub2_2(a,c,b)%MOD;}\nint main(){\n\tLL T;\n\tscanf(\"%lld %lld\",&T,&MOD);\n\tinv[1]=1;\n\tfor(LL i=2;i<=100000;++i)\tinv[i]=MOD-(MOD/i)*inv[MOD%i]%MOD;\n\tshai(100000);\n\tfac[0]=fac[1]=1;\n\tfor(LL i=2;i<=100000;++i)\tfac[i]=(fac[i-1]*i)%MOD;\n\tinvfac[100000]=QuickPow(fac[100000],MOD-2);\n\tfor(LL i=99999;~i;--i)\tinvfac[i]=invfac[i+1]*(i+1)%MOD;\n\twhile(T-->0)\n\t{\n\t\tLL A,B,C;\n\t\tscanf(\"%lld %lld %lld\",&A,&B,&C);\n\t\tprintf(\"%lld \",QuickPow(fac[A],B*C%(MOD-1))*QuickPow(fac[B],A*C%(MOD-1))%MOD*QuickPow(QuickPow(G(A,B),MOD-2),C)%MOD*QuickPow(QuickPow(G(A,C),MOD-2),B)%MOD);\n\t\tprintf(\"%lld \",QuickPow(se[A],S(B)%(MOD-1)*S(C)%(MOD-1))*QuickPow(se[B],S(A)%(MOD-1)*S(C)%(MOD-1))%MOD*Calc1(A,B,C)%MOD*Calc1(A,C,B)%MOD);\n\t\tprintf(\"%lld\\n\",Sub1(A,B,C)*Sub2(A,B,C)%MOD);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1612362079,
        "uid": 184977,
        "name": "pomelo_nene",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5518 \u3010[MtOI2019]\u5e7d\u7075\u4e50\u56e2 / \u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u57fa\u7840\u7ec3\u4e60\u9898\u3011"
    },
    {
        "content": "[P5518 [MtOI2019]\u5e7d\u7075\u4e50\u56e2 / \u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u57fa\u7840\u7ec3\u4e60\u9898](https://www.luogu.com.cn/problem/P5518)\n\n\u57fa\u7840\u7ec3\u4e60\u9898\u90fd\u662f\u6bd2\u7624\u9634\u95f4\u9898\uff01\n\u5199\u8fd9\u9898\u4e4b\u524d\u6211\u4ece\u6765\u6ca1\u60f3\u8fc7\u83ab\u53cd\u9898\u7801\u91cf\u80fd\u6709 4k \u3002\u3002\u3002\n\n### type=0\uff1a\n\n$$\n\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^C{\\left(\\frac{ij}{\\gcd(i,j)\\gcd(i,k)}\\right)}\\\\=(A!)^{BC}(B!)^{AC}\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)^{-C}\\times\\prod_{i=1}^A\\prod_{j=1}^C\\gcd(i,k)^{-B}\n$$\n\n\u524d\u4e24\u90e8\u5206\uff08\u5206\u5b50\uff09\u76f4\u63a5\u9884\u5904\u7406\u9636\u4e58+\u5feb\u901f\u5e42\uff0c\u540e\u534a\u90e8\u5206\u4e3a\uff1a\n$$\n\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)^C\\\\(\u679a\u4e3e\\gcd)=\\prod_{d=1}^{\\min(A,B)}\\prod_{i=1}^{\\left\\lfloor\\frac{A}{d}\\right\\rfloor}\\prod_{j=1}^{\\left\\lfloor\\frac{B}{d}\\right\\rfloor}d^{C[\\gcd(i,j)=1]}\\\\(\u628ai,j\u653e\u5230\u6307\u6570\u4e0a)=\\prod_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{i=1}^{\\left\\lfloor\\frac{A}{d}\\right\\rfloor}\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{B}{d}\\right\\rfloor}C[\\gcd(i,j)=1]}\\\\(\u6309\u5957\u8def\u53cd\u6f14)=\\prod_{d=1}^{\\min(A,B)}d^{{C\\sum\\limits_{p=1}^{\\min(\\left\\lfloor\\frac{A}{d}\\right\\rfloor,\\left\\lfloor\\frac{B}{d}\\right\\rfloor)}}\\left\\lfloor\\frac{A}{pd}\\right\\rfloor\\left\\lfloor\\frac{B}{pd}\\right\\rfloor\\mu(p)}\n$$\n\n\u9884\u5904\u7406 $\\mu$ \u7684\u524d\u7f00\u548c\uff0c\u7136\u540e\u6574\u9664\u5206\u5757\u5957\u6574\u9664\u5206\u5757\u5373\u53ef\u3002\n\n\n\n\n### type=1\uff1a\n\n$$\n\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^C{\\left(\\frac{ij}{\\gcd(i,j)\\gcd(i,k)}\\right)}^{ijk}\\\\\n=\\prod_{i=1}^Ai^{i\\sum\\limits_{j=1}^Bj\\sum\\limits_{k=1}^Ck}\\prod_{j=1}^Bj^{j\\sum\\limits_{i=1}^Ai\\sum\\limits_{k=1}^Ck}\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^{C}\\gcd(i,j)^{-ijk}\\times\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^{C}\\gcd(i,k)^{-ijk}\n$$\n\n\u524d\u534a\u90e8\u5206\uff08\u5206\u5b50\uff09\u4e3a \n$$\n\\prod_{i=1}^A (i^i)^{B(B+1)C(C+1)/4}\n$$\n\u9884\u5904\u7406 $i^i$ \u7684\u524d\u7f00\u79ef\u5c31\u53ef\u4ee5\u76f4\u63a5\u7b97\u4e86\u3002\n\n\u8bbe $D=C(C+1)/2$ \uff0c\u540e\u534a\u90e8\u5206\uff08\u5206\u6bcd\uff09\u4e3a\n\n\n$$\n\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)^{ijD}\\\\(\u679a\u4e3e\\gcd)=\\prod_{d=1}^{\\min(A,B)}\\prod_{i=1}^{\\left\\lfloor\\frac{A}{d}\\right\\rfloor}\\prod_{j=1}^{\\left\\lfloor\\frac{B}{d}\\right\\rfloor}d^{d^2ijD[\\gcd(i,j)=1]} \\\\(\u628ai,j\u653e\u5230\u6307\u6570\u4e0a)=\\prod_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{i=1}^{\\left\\lfloor\\frac{A}{d}\\right\\rfloor}\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{B}{d}\\right\\rfloor}Dijd^2[\\gcd(i,j)=1]} \\\\(\u5411\u4e0a\u9762\u90a3\u6837\u6309\u5957\u8def\u53cd\u6f14)=\\prod_{d=1}^{\\min(A,B)}d^{{D\\sum\\limits_{p=1}^{\\min(\\left\\lfloor\\frac{A}{d}\\right\\rfloor,\\left\\lfloor\\frac{B}{d}\\right\\rfloor)}}\\sum\\limits_{i=1}^{\\left\\lfloor\\frac{A}{pd}\\right\\rfloor}\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{B}{pd}\\right\\rfloor}d^2p^2ij \\mu(p)}\\\\=(\\prod_{d=1}^{\\min(A,B)}d^{d^2})^{D\\sum\\limits_{p=1}^{\\min(\\left\\lfloor\\frac{A}{d}\\right\\rfloor,\\left\\lfloor\\frac{B}{d}\\right\\rfloor)}p^2\\mu(p)\\frac{\\left\\lfloor\\frac{A}{dp}\\right\\rfloor(\\left\\lfloor\\frac{A}{dp}\\right\\rfloor+1)}{2}\\frac{\\left\\lfloor\\frac{B}{dp}\\right\\rfloor(\\left\\lfloor\\frac{B}{dp}\\right\\rfloor+1)}{2}}\n$$\n\n\u9884\u5904\u7406 $d^{d^2}$ \u7684\u524d\u7f00\u79ef\uff0c\u9884\u5904\u7406 $p^2 \\mu(p)$ \u7684\u524d\u7f00\u548c\u7136\u540e\u6574\u9664\u5206\u5757\u5957\u6574\u9664\u5206\u5757\u5373\u53ef\u3002\n\n\n\n### type=2\uff08\u91cd\u5934\u620f\u6765\u4e86\uff01\uff09\n\n$$\n\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^C{\\left(\\frac{ij}{\\gcd(i,j)\\gcd(i,k)}\\right)}^{\\gcd(i,j,k)}\n\\\\=\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^Ci^{\\gcd(i,j,k)}\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^Cj^{\\gcd(i,j,k)}\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^{C}\\gcd(i,j)^{-\\gcd(i,j,k)}\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^{C}\\gcd(i,k)^{-\\gcd(i,j,k)}\n$$\n\n\u524d\u534a\u90e8\u5206\uff08\u5206\u5b50\uff09\u4e3a\n$$\t\t\t\t\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^Ci^{\\gcd(i,j,k)}\\\\(\u679a\u4e3e\\gcd)=\\prod_{d=1}^{A}\\prod_{i=1}^{\\left\\lfloor\\frac{A}{d}\\right\\rfloor}(id)^{d\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{B}{d}\\right\\rfloor}\\sum\\limits_{k=1}^{\\left\\lfloor\\frac{C}{d}\\right\\rfloor}[\\gcd(i,j,k)=1]}\\\\(\u6309\u5957\u8def\u53cd\u6f14)=\\prod_{d=1}^{A}\\prod\\limits_{t=1}^{\\left\\lfloor\\frac{A}{d}\\right\\rfloor}\\prod_{i=1}^{\\left\\lfloor\\frac{A}{td}\\right\\rfloor}(itd)^{d{\\left\\lfloor\\frac{B}{td}\\right\\rfloor}{\\left\\lfloor\\frac{C}{td}\\right\\rfloor}\\mu(t)}\\\\(\u8bbeT=td)=\\prod_{T=1}^{A}\\prod\\limits_{d|T}\\prod_{i=1}^{\\left\\lfloor\\frac{A}{T}\\right\\rfloor}(iT)^{d\\ \\mu(\\frac{T}{d}){\\left\\lfloor\\frac{B}{T}\\right\\rfloor}{\\left\\lfloor\\frac{C}{T}\\right\\rfloor}}\\\\(\\mu*id=\\phi)=\\prod_{T=1}^{A}\\prod_{i=1}^{\\left\\lfloor\\frac{A}{T}\\right\\rfloor}(iT)^{\\phi(T){\\left\\lfloor\\frac{B}{T}\\right\\rfloor}{\\left\\lfloor\\frac{C}{T}\\right\\rfloor}}\\\\(\u5316\u7b80)=\\prod_{T=1}^{A}\\left(T^{\\left\\lfloor\\frac{A}{T}\\right\\rfloor}(\\left\\lfloor\\frac{A}{T}\\right\\rfloor!)\\right)^{\\phi(T){\\left\\lfloor\\frac{B}{T}\\right\\rfloor}{\\left\\lfloor\\frac{C}{T}\\right\\rfloor}}\\\\(\u62c6\u5f00\u7b97)=\\prod_{T=1}^{A}\\left(T^{\\phi(T)}\\right)^{\\left\\lfloor\\frac{A}{T}\\right\\rfloor\\left\\lfloor\\frac{B}{T}\\right\\rfloor\\left\\lfloor\\frac{C}{T}\\right\\rfloor}(\\left\\lfloor\\frac{A}{T}\\right\\rfloor!)^{\\phi(T){\\left\\lfloor\\frac{B}{T}\\right\\rfloor}{\\left\\lfloor\\frac{C}{T}\\right\\rfloor}}\n$$\n\n\u540e\u534a\u90e8\u5206\uff1a\n$$\n\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^{C}\\gcd(i,j)^{\\gcd(i,j,k)}\\\\(\u628ai,j\u653e\u6307\u6570\u4e0a\u5e76\u679a\u4e3e\\gcd)=\\prod_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{i=1}^{\\left\\lfloor\\frac{A}{d}\\right\\rfloor}\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{B}{d}\\right\\rfloor}[\\gcd(i,j)=1]\\sum\\limits_{k=1}^C\\gcd(d,k)}\\\\(\u6309\u5957\u8def\u53cd\u6f14)=\\prod_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{i=1}^{\\left\\lfloor\\frac{A}{d}\\right\\rfloor}\\sum\\limits_{j=1}^{\\left\\lfloor\\frac{B}{d}\\right\\rfloor}\\sum\\limits_{t|i,t|j}\\mu(t)\\sum\\limits_{k=1}^C\\gcd(d,k)}\\\\(\u5316\u7b80)=\\prod_{d=1}^{\\min(A,B)}d^{\\sum\\limits_{t=1}^{\\left\\lfloor\\frac{A}{d}\\right\\rfloor}\\mu(t){\\left\\lfloor\\frac{A}{td}\\right\\rfloor}{\\left\\lfloor\\frac{B}{td}\\right\\rfloor}\\sum\\limits_{k=1}^C\\gcd(d,k)}\\\\(\u8bbeT=dt)=\\prod_{T=1}^{\\min(A,B)}\\prod_{d|T}d^{\\mu(\\frac{T}{d}){\\left\\lfloor\\frac{A}{T}\\right\\rfloor}{\\left\\lfloor\\frac{B}{T}\\right\\rfloor}\\sum\\limits_{k=1}^C\\gcd(d,k)}\\\\(\u628a\u5f0f\u5b50\u5199\u597d\u770b\u4e00\u70b9)=\\prod_{T=1}^{\\min(A,B)}{\\left(\\prod_{d|T}d^{\\mu(\\frac{T}{d})\\sum\\limits_{k=1}^C\\gcd(d,k)}\\right)^{{\\left\\lfloor\\frac{A}{T}\\right\\rfloor}{\\left\\lfloor\\frac{B}{T}\\right\\rfloor}}}\n$$\n\u628a\u4e2d\u95f4\u7684\u6307\u6570\u90e8\u5206\u63d0\u51fa\u6765\n$$\n\\sum\\limits_{k=1}^C\\gcd(d,k)\\\\\n=\\sum\\limits_{p|d}p\\sum\\limits_{k=1}^{\\left\\lfloor\\frac{C}{p}\\right\\rfloor}[\\gcd(\\frac{C}{d},k)=1]\n\\\\=\\sum\\limits_{p|d}p\\sum\\limits_{t|\\frac{d}{p}}\\mu(t){\\left\\lfloor\\frac{C}{pt}\\right\\rfloor}\\\\\n=\\sum\\limits_{s|d}{\\left\\lfloor\\frac{C}{s}\\right\\rfloor\\phi(s)}\n$$\n\u518d\u6254\u56de\u53bb\n$$\n\\prod_{T=1}^{\\min(A,B)}{\\left(\\prod_{d|T}d^{\\mu(\\frac{T}{d})\\sum\\limits_{s|d}{\\left\\lfloor\\frac{C}{s}\\right\\rfloor\\phi(s)}}\\right)^{{\\left\\lfloor\\frac{A}{T}\\right\\rfloor}{\\left\\lfloor\\frac{B}{T}\\right\\rfloor}}}\\\\(\u628a\u679a\u4e3es\u653e\u4e0b\u9762)=\\prod_{T=1}^{\\min(A,B)}{\\left(\\prod_{d|T}\\prod\\limits_{s|d}d^{\\mu(\\frac{T}{d}){\\left\\lfloor\\frac{C}{s}\\right\\rfloor\\phi(s)}}\\right)^{{\\left\\lfloor\\frac{A}{T}\\right\\rfloor}{\\left\\lfloor\\frac{B}{T}\\right\\rfloor}}}\n$$\n\u53d1\u73b0\u4ecd\u7136\u4e0d\u597d\u7b97\uff0corz\u9898\u89e3\u540e\u53d1\u73b0\u53ef\u4ee5\u628a $s$ \u548c $\\frac{d}{s}$ \u5206\u5f00\u7b97\u3002\n$$\n\\prod_{T=1}^{\\min(A,B)}{{\\prod_{d|T}\\prod\\limits_{s|d}\\frac{d}{s}^{\\mu(\\frac{T}{d})\\phi(s)\\left\\lfloor\\frac{C}{s}\\right\\rfloor\\left\\lfloor\\frac{A}{T}\\right\\rfloor\\left\\lfloor\\frac{B}{T}\\right\\rfloor}}}\\\\(\u4ea4\u6362\u679a\u4e3e\u987a\u5e8f\uff0cT\\div s,d\\div s)=\\prod_{s=1}^{\\min(A,B)}\\prod_{T=1}^{\\left\\lfloor\\frac{\\min(A,B)}{s}\\right\\rfloor}{{\\prod_{d|T}d^{\\mu(\\frac{T}{d})\\phi(s)\\left\\lfloor\\frac{C}{s}\\right\\rfloor\\left\\lfloor\\frac{A}{Ts}\\right\\rfloor\\left\\lfloor\\frac{B}{Ts}\\right\\rfloor}}}\\\\(\u6700\u540e\u6574\u7406\u4e00\u4e0b)=\\prod_{s=1}^{\\min(A,B)}\\left(\\prod_{T=1}^{\\left\\lfloor\\frac{\\min(A,B)}{s}\\right\\rfloor}{\\left({\\prod_{d|T}d^{\\mu(\\frac{T}{d})}}\\right)}^{\\left\\lfloor\\frac{\\left\\lfloor\\frac{A}{T}\\right\\rfloor}{s}\\right\\rfloor\\left\\lfloor\\frac{\\left\\lfloor\\frac{B}{T}\\right\\rfloor}{s}\\right\\rfloor}\\right)^{\\phi(s)\\left\\lfloor\\frac{C}{s}\\right\\rfloor}\n$$\n\n\u6700\u91cc\u9762\u4e00\u5c42 $O(n\\log n)$ \u9884\u5904\u7406\uff0c\u5916\u9762\u4e24\u5c42\u6574\u9664\u5206\u5757\u5373\u53ef\u3002\uff08\u548c\u4e0a\u9762\u53cd\u6f14\u7684\u65b9\u6cd5\u57fa\u672c\u4e00\u6837\uff0c\u5c31\u4e0d\u5199\u6ce8\u91ca\u4e86\uff09\n\n\n\n\n$$\n\\prod_{T=1}^{\\min(A,B)}{{\\prod_{d|T}\\prod\\limits_{s|d}s^{\\mu(\\frac{T}{d})\\phi(s)\\left\\lfloor\\frac{C}{s}\\right\\rfloor\\left\\lfloor\\frac{A}{T}\\right\\rfloor\\left\\lfloor\\frac{B}{T}\\right\\rfloor}}}\n\\\\=\\prod_{s=1}^{\\min(A,B)}\\prod_{T=1}^{\\left\\lfloor\\frac{\\min(A,B)}{s}\\right\\rfloor}\\prod\\limits_{d|T}s^{\\mu(\\frac{T}{d})\\phi(s)\\left\\lfloor\\frac{C}{s}\\right\\rfloor\\left\\lfloor\\frac{A}{Ts}\\right\\rfloor\\left\\lfloor\\frac{B}{Ts}\\right\\rfloor}\n\\\\=\\prod_{s=1}^{\\min(A,B)}s^{\\sum\\limits_{T=1}^{\\left\\lfloor\\frac{\\min(A,B)}{s}\\right\\rfloor}\\sum\\limits_{d|T}\\mu(\\frac{T}{d})\\phi(s)\\left\\lfloor\\frac{C}{s}\\right\\rfloor\\left\\lfloor\\frac{A}{Ts}\\right\\rfloor\\left\\lfloor\\frac{B}{Ts}\\right\\rfloor}\n\\\\=\\prod_{s=1}^{\\min(A,B)}s^{\\phi(s)\\left\\lfloor\\frac{C}{s}\\right\\rfloor\\sum\\limits_{T=1}^{\\left\\lfloor\\frac{\\min(A,B)}{s}\\right\\rfloor}\\left\\lfloor\\frac{A}{Ts}\\right\\rfloor\\left\\lfloor\\frac{B}{Ts}\\right\\rfloor\\sum\\limits_{d|T}\\mu(\\frac{T}{d})}\n\\\\=\\prod_{s=1}^{\\min(A,B)}s^{\\phi(s)\\left\\lfloor\\frac{C}{s}\\right\\rfloor\\sum\\limits_{T=1}^{\\left\\lfloor\\frac{\\min(A,B)}{s}\\right\\rfloor}\\left\\lfloor\\frac{A}{Ts}\\right\\rfloor\\left\\lfloor\\frac{B}{Ts}\\right\\rfloor\\epsilon(T)}\n$$\n\n\u56e0\u4e3a $\\epsilon(T)=[T=1]$ \uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u628a $T$ \u770b\u4f5c $1$\uff0c\u90a3\u4e48\n$$\n\\prod_{s=1}^{\\min(A,B)}s^{\\phi(s)\\left\\lfloor\\frac{C}{s}\\right\\rfloor\\sum\\limits_{T=1}^{\\left\\lfloor\\frac{\\min(A,B)}{s}\\right\\rfloor}\\left\\lfloor\\frac{A}{Ts}\\right\\rfloor\\left\\lfloor\\frac{B}{Ts}\\right\\rfloor\\epsilon(T)}\n\\\\=\\prod_{s=1}^{\\min(A,B)}s^{\\phi(s)\\left\\lfloor\\frac{C}{s}\\right\\rfloor\\left\\lfloor\\frac{A}{s}\\right\\rfloor\\left\\lfloor\\frac{B}{s}\\right\\rfloor}\n$$\n\u7ec8\u4e8e\u51fa\u73b0\u4e86\u4e00\u4e2a\u6f02\u4eae\u7684\u5f0f\u5b50\u554a\uff01\u7136\u540e\u6211\u9707\u60ca\u5730\u53d1\u73b0\uff0c\u8fd9\u4e2a\u90e8\u5206\u548c\u5206\u5b50\u7684 $\\prod_{T=1}^{A}\\left(T^{\\phi(T)}\\right)^{\\left\\lfloor\\frac{A}{T}\\right\\rfloor\\left\\lfloor\\frac{B}{T}\\right\\rfloor\\left\\lfloor\\frac{C}{T}\\right\\rfloor}$ \u90e8\u5206\u53ef\u4ee5\u7ea6\u6389\uff01\u6240\u4ee5\u6211\u4eec\u5b9e\u9645\u8981\u7b97\u7684\u5206\u5b50\u662f \n$$\n\\prod_{T=1}^{A}(\\left\\lfloor\\frac{A}{T}\\right\\rfloor!)^{\\phi(T){\\left\\lfloor\\frac{B}{T}\\right\\rfloor}{\\left\\lfloor\\frac{C}{T}\\right\\rfloor}}\n$$\n\u5206\u6bcd\u662f\n$$\n\\prod_{s=1}^{\\min(A,B)}\\left(\\prod_{T=1}^{\\left\\lfloor\\frac{\\min(A,B)}{s}\\right\\rfloor}\n{\\left({\\prod_{d|T}d^{\\mu(\\frac{T}{d})}}\\right)}^\n{\\left\\lfloor\\frac{\\left\\lfloor\\frac{A}{T}\\right\\rfloor}{s}\\right\\rfloor\n\\left\\lfloor\\frac{\\left\\lfloor\\frac{B}{T}\\right\\rfloor}{s}\\right\\rfloor}\n\\right)^{\\phi(s)\\left\\lfloor\\frac{C}{s}\\right\\rfloor}\n$$\n\n```cpp\n#include<bits/stdc++.h>\ntypedef long long ll;\nusing namespace std;\nnamespace FGF\n{\n\tint n,mo,phi;\n\tconst int N=1e5+5;\n\tll A,B,C,fac[N],mu[N],inv[N],dd2[N],p2[N],dd[N],sumphi[N],ph[N],h[N],ifac[N];\n\tll ih[N];\n\tint p[N],vis[N],cnt;\n\tll qpow(ll x,ll y)\n\t{\n\t\tll s=1;\n\t\twhile(y)\n\t\t{\n\t\t\tif(y&1)s=s*x%mo;\n\t\t\tx=x*x%mo,y>>=1;\n\t\t}\n\t\treturn s;\n\t}\n\tvoid init()\n\t{\n\t\tih[0]=ifac[0]=h[0]=dd[0]=dd2[0]=fac[0]=inv[0]=inv[1]=1;\n\t\tfor(int i=1;i<=1e5;i++)\n\t\t\tfac[i]=fac[i-1]*i%mo,h[i]=1;\n\t\tfor(int i=2;i<=1e5;i++)\n\t\t\tinv[i]=inv[mo%i]*(mo-mo/i)%mo;\n\t\tfor(int i=1;i<=1e5;i++)\n\t\t\tifac[i]=ifac[i-1]*inv[i]%mo;\n\t\tfor(int i=1;i<=1e5;i++)\n\t\t\tdd2[i]=dd2[i-1]*qpow(i,1LL*i*i%phi)%mo;\n\t\tfor(int i=1;i<=1e5;i++)\n\t\t\tdd[i]=dd[i-1]*qpow(i,i)%mo;\n\t\tmu[1]=1,ph[1]=1;\t\n\t\tfor(int i=2;i<=1e5;i++)\n\t\t{\n\t\t\tif(!vis[i])p[++cnt]=i,mu[i]=phi-1,ph[i]=i-1;\n\t\t\tfor(int j=1;j<=cnt&&p[j]*i<=1e5;j++)\n\t\t\t{\n\t\t\t\tvis[i*p[j]]=1;\n\t\t\t\tif(i%p[j]==0){mu[i*p[j]]=0;ph[i*p[j]]=ph[i]*p[j];break;}\n\t\t\t\tmu[i*p[j]]=phi-mu[i],ph[i*p[j]]=ph[i]*(p[j]-1);\n\t\t\t}\n\t\t}\t\n\t\tfor(int i=1;i<=1e5;i++)\n\t\t\tsumphi[i]=(sumphi[i-1]+ph[i])%phi;\n\t\tfor(int i=1;i<=1e5;i++)\n\t\t\tp2[i]=(p2[i-1]+1LL*i*i%phi*mu[i]%phi)%(mo-1);\n\t\tfor(int i=1;i<=1e5;i++)\n\t\t\tfor(int j=i;j<=1e5;j+=i)\n\t\t\t\tif(mu[j/i]==1)h[j]=h[j]*i%mo;\n\t\t\t\t\telse if(mu[j/i]==phi-1)h[j]=h[j]*inv[i]%mo;\n\t\tfor(int i=1;i<=1e5;i++)\n\t\t\th[i]=h[i-1]*h[i]%mo,ih[i]=qpow(h[i],mo-2);\n\t\tfor(int i=2;i<=1e5;i++)mu[i]=(mu[i]+mu[i-1])%phi;\n\t}\n\tll getans1(ll a,ll b,ll c)\n\t{\n\t\tll ans=1;\n\t\tfor(int l=1,r;l<=min(a,b);l=r+1)\n\t\t{\n\t\t\tll d=a/l,e=b/l;\n\t\t\tr=min(a/d,b/e);\n\t\t\tll p=fac[r]*ifac[l-1]%mo,sum=0;\n\t\t\tfor(int ql=1,qr;ql<=min(d,e);ql=qr+1)\n\t\t\t{\n\t\t\t\tqr=min(d/(d/ql),e/(e/ql));\n\t\t\t\tll k=(mu[qr]-mu[ql-1]+phi)%phi;\n\t\t\t\tsum=(sum+k*(d/ql)%phi*(e/ql)%phi)%phi;\n\t\t\t}\n\t\t\tans=ans*qpow(qpow(p,sum*c%phi),mo-2)%mo;\n\t\t}\n\t\treturn ans;\n\t}\n\tll solve1(ll a,ll b,ll c)\n\t{\n\t\tll ans=qpow(fac[a],b*c%(mo-1))*qpow(fac[b],a*c%(mo-1))%mo;\n\t\treturn ans*getans1(a,b,c)%mo*getans1(a,c,b)%mo;\n\t}\n\tll getans2(ll a,ll b,ll c)\n\t{\n\t\tll D=c*(c+1)/2%phi,ans=1;\n\t\tfor(int l=1,r;l<=min(a,b);l=r+1)\n\t\t{\n\t\t\tll d=a/l,e=b/l;\n\t\t\tr=min(a/d,b/e);\n\t\t\tll p=dd2[r]*qpow(dd2[l-1],mo-2)%mo,sum=0;\n\t\t\tfor(int ql=1,qr;ql<=min(d,e);ql=qr+1)\n\t\t\t{\n\t\t\t\tll g=d/ql,f=e/ql;\n\t\t\t\tqr=min(d/g,e/f);\n\t\t\t\tll k=(p2[qr]-p2[ql-1]+phi)%phi;\n\t\t\t\tsum=(sum+(g*(g+1)/2%phi)%phi*(f*(f+1)/2%phi)%phi*k%phi)%phi;\n\t\t\t}\n\t\t\tans=ans*qpow(qpow(p,sum*D%phi),mo-2)%mo;\n\t\t}\n\t\treturn ans;\n\t}\n\tll solve2(ll a,ll b,ll c)\n\t{\n\t\tll ans=qpow(dd[a],(b*(b+1)/2%phi)%phi*(c*(c+1)/2%phi)%phi)*qpow(dd[b],(a*(a+1)/2%phi)%phi*(c*(c+1)/2%phi)%phi)%mo;\n\t\treturn ans*getans2(a,b,c)%mo*getans2(a,c,b)%mo;\n\t}\n\tll getans31(ll a,ll b,ll c)\n\t{\n\t\tll s=1;\n\t\tfor(int l=1,r;l<=min(a,min(b,c));l=r+1)\n\t\t{\n\t\t\tr=min(a/(a/l),min(b/(b/l),c/(c/l)));\n\t\t\ts=s*qpow(fac[a/l],(sumphi[r]-sumphi[l-1]+phi)%phi*(b/l)%phi*(c/l)%phi)%mo;\n\t\t}\n\t\treturn s;\n\t}\n\tll getans32(ll a,ll b,ll c)\n\t{\n\t\tll ans=1;\n\t\tfor(int l=1,r;l<=min(a,min(b,c));l=r+1)\n\t\t{\n\t\t\tll d=a/l,e=b/l,sum=1;\n\t\t\tr=min(a/d,min(b/e,c/(c/l)));\n\t\t\tfor(int ql=1,qr;ql<=min(d,e);ql=qr+1)\n\t\t\t{\n\t\t\t\tqr=min(d/(d/ql),e/(e/ql));\n\t\t\t\tsum=sum*qpow(h[qr]*ih[ql-1]%mo,(d/ql)*(e/ql)%phi)%mo;\n\t\t\t}\n\t\t\tans=ans*qpow(sum,(sumphi[r]-sumphi[l-1]+phi)%phi*(c/l)%phi)%mo;\n\t\t}\n\t\treturn ans;\n\t}\n\tll solve3(ll a,ll b,ll c)\n\t{\n\t\treturn getans31(a,b,c)*getans31(b,a,c)%mo*qpow(getans32(a,b,c),mo-2)%mo*qpow(getans32(a,c,b),mo-2)%mo;\n\t}\n\tvoid work()\n\t{\n\t\tscanf(\"%d%d\",&n,&mo),phi=mo-1;\n\t\tinit();\n\t\twhile(n--)\n\t\t{\n\t\t\tscanf(\"%lld%lld%lld\",&A,&B,&C);\n\t\t\tprintf(\"%lld %lld %lld \\n\",solve1(A,B,C),solve2(A,B,C),solve3(A,B,C));\n\t\t}\n\t}\n}\nint main()\n{\n\tFGF::work();\n\treturn 0;\n}\n```\n\n\n\n\u987a\u4fbf\u653e\u4e00\u4e0b\uff0c\u673a\u623f\u5de8\u4f6c\u7528\u53e6\u4e00\u79cd\u505a\u6cd5\u63a8\u51fa\u6765\u7684\u5f0f\u5b50\u662f\uff0c\u6211\u4e5f\u4e0d\u77e5\u9053\u8fd9\u73a9\u610f\u80fd\u4e0d\u80fd\u7b97\u3002\n$$\n\n\\large\\prod_{t=1}^{\\min(A,B,C)}\\prod\\limits_{s=1}^{\\min(\\left\\lfloor\\frac{\\min(A,B)}{t}\\right\\rfloor,\\left\\lfloor\\frac{C}{t}\\right\\rfloor)}\\prod_{d=1}^{\\left\\lfloor\\frac{\\min(A,B)}{ts}\\right\\rfloor}(dts)^{\\left\\lfloor\\frac{C}{ts}\\right\\rfloor t\\mu(s)\\sum\\limits_{p=1}^{\\min(\\left\\lfloor\\frac{A}{dts}\\right\\rfloor,\\left\\lfloor\\frac{B}{dts}\\right\\rfloor)}\\left\\lfloor\\frac{A}{dpts}\\right\\rfloor \\left\\lfloor\\frac{B}{dpts}\\right\\rfloor \\mu(p)}\n$$\n\n",
        "postTime": 1608801174,
        "uid": 224403,
        "name": "\u6728xx\u6728\u5927",
        "ccfLevel": 9,
        "title": "P5518 [MtOI2019]\u5e7d\u7075\u4e50\u56e2 / \u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u57fa\u7840\u7ec3\u4e60\u9898"
    },
    {
        "content": "\u63d0\u4f9b\u4e00\u79cd\u8fd8\u7b97\u65b0\u7684\u6700\u540e\u4e00\u4e2a\u5b50\u95ee\u9898\u7684\u505a\u6cd5\r\n\r\n$$\\prod\\limits_{i=1}^{A}\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^C \\gcd(i,j)^{\\gcd(i,j,k)}$$\r\n\r\n$$\\prod\\limits_{i=1}^{A}\\prod\\limits_{j=1}^B \\gcd(i,j)^{\\sum_{k=1}^C\\gcd(i,j,k)}$$\r\n\r\n\u5355\u6254\u51fa\u6765\u8fd9\u6837\u7684\u4e1c\u897f $\\sum\\limits_{i=1}^m\\gcd(n,i)$\uff0c\u8fd9\u4e2a\u4e1c\u897f\u5728 $\\prod\\limits_{i=1}^{A}\\prod\\limits_{j=1}^B\\prod\\limits_{k=1}^C i^{\\gcd(i,j,k)}$ \u91cc\u5b9e\u9645\u4e0a\u662f\u505a\u8fc7\u52a0\u5f3a\u7248\u7684\uff0c\u4e0d\u591a\u8d58\u8ff0\uff0c\u76f4\u63a5\u5199\u51fa\u7ed3\u679c\u4e3a $\\sum\\limits_{d|n}\\varphi(d)\\left\\lfloor\\dfrac{m}{d}\\right\\rfloor$\u3002\r\n\r\n\u91cd\u65b0\u6254\u56de\u53bb\uff1a\r\n\r\n$$\\prod\\limits_{d=1}^Ad^{(\\sum_{t|d}\\varphi(t)\\left\\lfloor\\frac{C}{t}\\right\\rfloor)(\\sum_{i=1}^{\\left\\lfloor\\frac{A}{d}\\right\\rfloor}\\sum_{j=1}^{\\left\\lfloor\\frac{B}{d}\\right\\rfloor}[\\gcd(i,j)=1])}$$\r\n\r\n$$\\prod\\limits_{d=1}^Ad^{(\\sum_{t|d}\\varphi(t)\\left\\lfloor\\frac{C}{t}\\right\\rfloor)(\\sum_{p=1}^{\\left\\lfloor\\frac{A}{d}\\right\\rfloor}\\mu(p)\\left\\lfloor\\frac{A}{dp}\\right\\rfloor\\left\\lfloor\\frac{B}{dp}\\right\\rfloor})$$\r\n\r\n\u4ee4 $T=dp$\u3002\r\n\r\n$$\\prod\\limits_{T=1}^A\\left(\\prod\\limits_{d|T}d^{\\mu(\\frac{T}{d})\\sum_{t|d}\\varphi(t)\\left\\lfloor\\frac{C}{t}\\right\\rfloor}\\right)^{\\left\\lfloor\\frac{A}{T}\\right\\rfloor\\left\\lfloor\\frac{B}{T}\\right\\rfloor}$$\r\n\r\n\u53d1\u73b0\u672c\u6765\u5e94\u8be5\u9884\u5904\u7406\u4e2d\u95f4\u7684\u4e1c\u897f\uff0c\u4f46\u662f $C$ \u6bcf\u6b21\u5728\u53d8\uff0c\u65e0\u6cd5\u63d0\u524d\u9884\u5904\u7406\uff0c\u53ea\u80fd\u73b0\u505a\uff0c\u4f46\u662f\u666e\u901a\u7684 $O(Tn\\log n)$ \u505a\u6cd5\u5927\u6982\u4f1a\u8d85\u65f6\uff08$n$ \u4e3a $A,B,C$ \u7684\u503c\u57df\uff09\uff0c\u9996\u5148\u8fd9\u4e2a $\\sum_{t|d}\\varphi(t)\\left\\lfloor\\frac{C}{t}\\right\\rfloor$ \u53ef\u4ee5\u901a\u8fc7 Dirichlet \u524d\u7f00\u548c\u5355\u6b21 $O(n\\log\\log n)$ \u505a\uff0c\u7136\u540e\u5916\u9762\u7684\u679a\u4e3e\u56e0\u6570\u6c42\u79ef\u53ef\u4ee5\u9b54\u6539 Dirichlet \u524d\u7f00\u548c\u4e3a\u524d\u7f00\u79ef\u6765\u505a\uff08\u6ce8\u610f\u8fd9\u91cc\u7684\u524d\u7f00\u79ef\u5b9e\u9645\u4e0a\u662f\u505a\u4e00\u4e2a Dirichlet \u5377\u79ef\uff0c\u5b9e\u73b0\u7ec6\u8282\u53ef\u4ee5\u501f\u9274 Prean \u5728 P7580 \u5199\u7684\u5377\u4e00\u4e2a\u79ef\u6027\u51fd\u6570\u548c\u4e00\u4e2a\u975e\u79ef\u6027\u51fd\u6570\u7684[\u8fd9\u4e00\u4efd\u4ee3\u7801](https://www.luogu.com.cn/paste/amov5eto)\uff09\uff0c\u8fd8\u9700\u8981\u4e00\u4e2a\u7ebf\u6027\u9006\u5143\uff08\u6c42 $\\mu$ \u6b21\u5e42\uff09\uff0c\u4e3b\u8981\u96be\u70b9\u662f\u8fd9\u4e2a $d$ \u7684\u5e42\u6b21\u3002\r\n\r\n\u9996\u5148\u8003\u8651\u5149\u901f\u5e42\uff0c\u53d1\u73b0\u8fd9\u4e1c\u897f\u7a7a\u95f4\u65f6\u95f4\u90fd\u662f $O(n\\sqrt{V})$\uff0c$V$ \u662f\u6307\u6570\u7684\u503c\u57df\uff0c\u7ea6\u4e3a $10^9$\uff0c\u663e\u7136\u7684\u7206\u70b8\uff0c\u8003\u8651\u4f20\u7edf\u5149\u901f\u5e42\u662f\u4e00\u4e2a\u5206\u5757\uff0c\u53ef\u4ee5\u591a\u5206\u51e0\u5c42\uff0c\u5982\u679c\u5206 $k$ \u5c42\u7684\u8bdd\u8fd9\u4e2a\u6c42\u5e42\u65b9\u5f0f\u7684\u590d\u6742\u5ea6\u662f $O(knV^{\\frac{1}{k}})-O(k)$ \u7684\uff0c\u7531\u4e8e\u540e\u9762\u7684\u67e5\u8be2\u8981\u505a $Tn$ \u6b21\uff0c\u591a\u8bd5\u51e0\u6b21\u53ef\u4ee5\u5f97\u5230\u5927\u7ea6\u5728 $k=6$ \u7684\u65f6\u5019\u6bd4\u8f83\u4f18\u79c0\uff08\u5b9e\u9645\u4e0a\u753b\u56fe\u53ef\u77e5\u6700\u4f18\u7684\u5927\u7ea6\u5728 $6.12$\uff09\uff0c\u6700\u540e\u7684\u590d\u6742\u5ea6\u5728\u8fd9\u91cc\u7ea6\u4e3a $O(knV^{\\frac{1}{k}}+Tnk)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(knV^{\\frac{1}{k}})$\u3002\r\n\r\n\u5b9e\u6d4b\u52a0\u4e0a\u53d6\u6a21\u4f18\u5316\u4e4b\u540e\u5c31\u80fd\u8fc7\u4e86\uff0c\u8dd1\u7684\u5e76\u4e0d\u6162\u3002\r\n\r\n\u5206\u5757\u7684\u5927\u81f4\u5199\u6cd5\u89c1\u4e0b\u3002\r\n```cpp\r\nvoid pre(int x)\r\n{\r\n\tfor(int i=0;i<=5;i++)\r\n\t{\r\n\t\tblk[x][0][i]=1;\r\n\t\tif(i!=0) blk[x][1][i]=F.reduce(1ll*blk[x][1][i-1]*blk[x][31][i-1]);\r\n\t\telse blk[x][1][i]=x;\r\n        for(int j=2;j<=31;j++) blk[x][j][i]=F.reduce(1ll*blk[x][j-1][i]*blk[x][1][i]);\r\n\t}\r\n}\r\n```\r\n",
        "postTime": 1644401942,
        "uid": 191868,
        "name": "monstersqwq",
        "ccfLevel": 8,
        "title": "\u9898\u89e3"
    },
    {
        "content": "## Prologue\n\n\u5efa\u8bae\u70b9\u51fb [\u5728 Ta \u7684\u535a\u5ba2\u67e5\u770b](https://www.luogu.com.cn/blog/114514resory/solution-p5518)\uff0c\u4ee5\u514d\u9898\u89e3\u533a\u7684 $\\LaTeX$ \u7206\u6389\u3002\n\n\u7ec8\u4e8e\u8fc7\u6389\u4e86\u8fd9\u9898\uff0c\u5199\u7bc7\u9898\u89e3\uff08\n\n\u5efa\u8bae\u5728\u505a\u8fd9\u9898\u4e4b\u524d\u5148\u505a\u4e00\u904d P3704\uff0c\u5bf9\u8fd9\u9898\u7684\u63a8\u5bfc\u8fc7\u7a0b\u4f1a\u6709\u5e2e\u52a9\uff08\n\n## Description\n\n> \u4ee4\uff1a\n> $$f(\\textit{type})=\\begin{cases}1&\\textit{type}=0\\\\ijk&\\textit{type}=1\\\\\\gcd(i,j,k)&\\textit{type}=2\\end{cases}$$\n> \u7ed9\u5b9a $A,B,C$\uff0c\u6c42\uff1a\n> $$\\textit{ans}_{\\textit{type}}=\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\left(\\frac{\\operatorname{lcm}(i,j)}{\\gcd(i,k)}\\right)^{f(\\textit{type})}$$\n> \u591a\u6d4b\uff0c\u5bf9\u7ed9\u5b9a\u8d28\u6570 $p$ \u53d6\u6a21\u3002\n>\n> $1\\le A,B,C\\le 10^5$\uff0c$10^7\\le p\\le 1.05\\times10^9,p\\in\\mathbb{P}$\uff0c$T=70$\u3002\n\n## Solution\n\n[\u7eaf\u4eab\u7248](https://www.luogu.com.cn/paste/9k4dmq4d)\n\n\u9996\u5148\u5bf9\u539f\u5f0f\u5316\u7b80\u4e00\u4e0b\uff1a\n\n$$\n\\begin{aligned}\n\\textit{ans}_{\\textit{type}}=&\\ \\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\left(\\frac{\\operatorname{lcm}(i,j)}{\\gcd(i,k)}\\right)^{f(\\textit{type})}\\\\\n=&\\ \\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\left(\\frac{ij}{\\gcd(i,j)\\cdot\\gcd(i,k)}\\right)^{f(\\textit{type})}\n\\end{aligned}\n$$\n\n\u4e8e\u662f\u539f\u5f0f\u53ef\u4ee5\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a\n\n$$\n\\begin{aligned}\n& \\mathcal F(A,B,C) = \\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^Ci^{f(\\textit{type})}\\\\\n& \\mathcal G(A,B,C)=\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{f(\\textit{type})}\n\\end{aligned}\n$$\n\n\u663e\u7136\u6709\uff1a\n\n$$\n\\text{ans}=\\frac{\\mathcal F(A,B,C)\\cdot\\mathcal F(B,A,C)}{\\mathcal G(A,B,C)\\cdot\\mathcal G(A,C,B)}\n$$\n\n\u63a5\u4e0b\u6765\u5c31\u5f00\u59cb\u63a8\u67ff\u5b50\u5427\uff01\n\n----\n\n### $\\textit{type}=0$\n\n$$\n\\begin{aligned}\n\\mathcal F(A,B,C)=&\\ \\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^Ci\\\\\n=&\\ \\prod_{i=1}^A\\prod_{j=1}^Bi^C\\\\\n=&\\ \\prod_{i=1}^Ai^{B\\cdot C}\\\\\n=&\\ (A!)^{B\\cdot C}\n\\end{aligned}\n$$\n\n\u9884\u5904\u7406\u9636\u4e58\uff0c\u6bcf\u6b21\u8ba1\u7b97\u5feb\u901f\u5e42\u5373\u53ef\u3002\n\n$$\n\\begin{aligned}\n\\mathcal G(A,B,C)=&\\ \\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)\\\\\n=&\\ \\left(\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)\\right)^C\\\\\n\\end{aligned}\n$$\n\n\u7136\u540e\u5f00\u59cb\u83ab\u53cd\uff1a\n\n$$\n\\begin{aligned}\n\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)=&\\ \\prod_{d=1}\\prod_{i=1}^A\\prod_{j=1}^Bd^{[\\gcd(i,j)=d]}\\\\\n=&\\ \\prod_{d=1}\\prod_{i=1}^{\\lfloor \\frac Ad\\rfloor}\\prod_{j=1}^{\\lfloor\\frac Bd\\rfloor}d^{[gcd(i,j)=1]}\\\\\n=&\\ \\prod_{d=1}d^{\\sum_{i=1}^{A/d}\\sum_{j=1}^{B/d}[gcd(i,j)=1]}\n\\end{aligned}\n$$\n\n\u628a\u6307\u6570\u63d0\u51fa\u6765\u63a8\u4e00\u4e0b\uff1a\n\n$$\n\\begin{aligned}\n\\sum_{i=1}^{\\lfloor\\frac Ad\\rfloor}\\sum_{j=1}^{\\lfloor\\frac Bd\\rfloor}[gcd(i,j)=1]=&\\ \\sum_{e=1}\\sum_{i=1}^{\\lfloor\\frac Ad\\rfloor}\\sum_{j=1}^{\\lfloor\\frac Bd\\rfloor}[e\\mid i][e \\mid j]\\mu(e)\\\\\n=&\\ \\sum_{e=1}\\sum_{i=1}^{\\lfloor \\frac A{de}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac B{de}\\rfloor}\\mu(e)\\\\\n=&\\ \\sum_{e=1}\\lfloor \\frac A{de}\\rfloor\\lfloor\\frac B{de}\\rfloor\\mu(e)\n\\end{aligned}\n$$\n\n\u5e26\u56de\u53bb\u5c31\u6709\uff1a\n\n$$\n\\begin{aligned}\n\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)=&\\ \\prod_{d=1}d^{\\sum_{e=1}\\lfloor \\frac A{de}\\rfloor\\lfloor\\frac B{de}\\rfloor\\mu(e)}\\\\\n=&\\ \\prod_{t=1}\\prod_{d\\mid t}d^{\\lfloor\\frac At\\rfloor\\lfloor\\frac Bt\\rfloor\\mu(\\frac td)}\\\\\n=&\\ \\prod_{t=1}\\left(\\prod_{d\\mid t}d^{\\mu(\\frac td)}\\right)^{\\lfloor\\frac At\\rfloor\\lfloor\\frac Bt\\rfloor}\\\\\n\\mathcal G(A,B,C)=&\\ \\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)\\\\\n=&\\ \\left(\\prod_{t=1}\\left(\\prod_{d\\mid t}d^{\\mu(\\frac td)}\\right)^{\\lfloor\\frac At\\rfloor\\lfloor\\frac Bt\\rfloor}\\right)^C\\\\\n\\end{aligned}\n$$\n\n\u6700\u91cc\u9762\u62ec\u53f7\u5185\u7684\u4e1c\u897f\u53ef\u4ee5\u7528\u7c7b\u4f3c\u57c3\u6c0f\u7b5b\u7684\u65b9\u6cd5\u9884\u5904\u7406\u4e00\u4e0b\uff0c\u5373\u5bf9\u4e8e\u6bcf\u4e2a $d$\uff0c\u5c06\u5b83\u7684\u8d21\u732e\u7d2f\u4e58\u5230\u5b83\u7684\u6bcf\u4e2a\u500d\u6570\u4e0a\u3002\u9884\u5904\u7406\u5b8c\u6210\u540e\u5c31\u53ef\u4ee5\u5feb\u4e50\u7684\u6574\u9664\u5206\u5757\u4e86\u3002\n\n----\n\n### $\\textit{type}=1$\n\n\u5b9a\u4e49\uff1a$S(n)=\\sum_{i=1}^ni=\\frac{n(n+1)}2$\u3002\n\n\u7136\u540e\u5f00\u59cb\u63a8\u67ff\u5b50\uff1a\n\n$$\n\\begin{aligned}\n\\mathcal F(A,B,C)=&\\ \\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^Ci^{ijk}\\\\\n=&\\ \\left(\\prod_{i=1}^A\\prod_{j=1}^Bi^{ij}\\right)^{S(C)}\\\\\n=&\\ \\left(\\prod_{i=1}^Ai^i\\right)^{S(B)\\cdot S(C)}\n\\end{aligned}\n$$\n\n\u9884\u5904\u7406 $\\prod_{i=1}^Ai^i$ \u5373\u53ef\u3002\n\n$$\n\\begin{aligned}\n\\mathcal G(A,B,C)=&\\ \\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{ijk}\\\\\n=&\\ \\left(\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)^{ij}\\right)^{S(C)}\\\\\n\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)^{ij}=&\\ \\prod_{d=1}\\prod_{i=1}^A\\prod_{j=1}^Bd^{[\\gcd(i,j)=d]ij}\\\\\n=&\\ \\prod_{d=1}\\prod_{i=1}^{\\lfloor\\frac Ad\\rfloor}\\prod_{j=1}^{\\lfloor\\frac Bd\\rfloor}d^{[\\gcd(i,j)=1]ijd^2}\\\\\n=&\\ \\prod_{d=1}d^{d^2\\sum_{i=1}^{A/d}\\sum_{j=1}^{B/d}[\\gcd(i,j)=1]ij}\n\\end{aligned}\n$$\n\n\u628a\u6307\u6570\u62ce\u51fa\u6765\uff1a\n\n$$\n\\begin{aligned}\n\\sum_{i=1}^{\\lfloor\\frac Ad\\rfloor}\\sum_{j=1}^{\\lfloor\\frac Bd\\rfloor}[\\gcd(i,j)=1]ij=&\\ \\sum_{e=1}\\sum_{i=1}^{\\lfloor\\frac Ad\\rfloor}\\sum_{j=1}^{\\lfloor\\frac Bd\\rfloor}[e\\mid i][e\\mid j]\\mu(e)ij\\\\\n=&\\ \\sum_{e=1}\\sum_{i=1}^{\\lfloor\\frac A{de}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac B{de}\\rfloor}e^2\\mu(e)ij\\\\\n=&\\ \\sum_{e=1}e^2\\mu(e)\\left(\\sum_{i=1}^{\\lfloor\\frac A{de}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac B{de}\\rfloor}ij\\right)\\\\\n=&\\ \\sum_{e=1}e^2\\mu(e)S(\\lfloor\\frac A{de}\\rfloor)S(\\lfloor\\frac B{de}\\rfloor)\n\\end{aligned}\n$$\n\n\u5e26\u56de\u53bb\uff1a\n\n$$\n\\begin{aligned}\n\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)^{ij}=&\\ \\prod_{d=1}d^{d^2\\sum_{e=1}e^2\\mu(e)S(\\lfloor\\frac A{de}\\rfloor)S(\\lfloor\\frac B{de}\\rfloor)}\\\\\n=&\\ \\prod_{e=1}\\prod_{d=1}d^{(de)^2\\mu(e)S(\\lfloor\\frac A{de}\\rfloor)S(\\lfloor\\frac B{de}\\rfloor)}\\\\\n=&\\ \\prod_{t=1}\\prod_{d\\mid t}d^{t^2\\mu(\\frac td)S(\\lfloor\\frac A{t}\\rfloor)S(\\lfloor\\frac B{t}\\rfloor)}\\\\\n=&\\ \\prod_{t=1}\\left(\\prod_{d\\mid t}d^{\\mu(\\frac td)}\\right)^{t^2S(\\lfloor\\frac At\\rfloor)S(\\lfloor\\frac Bt\\rfloor)}\\\\\n\\mathcal G(A,B,C)=&\\ \\left(\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)^{ij}\\right)^{S(C)}\\\\\n=&\\ \\left(\\left(\\prod_{t=1}\\left(\\prod_{d\\mid t}d^{\\mu(\\frac td)}\\right)^{t^2}\\right)^{S(\\lfloor\\frac At\\rfloor)S(\\lfloor\\frac Bt\\rfloor)}\\right)^{S(C)}\n\\end{aligned}\n$$\n\n\u62ec\u53f7\u91cc\u7684\u4e1c\u897f\u5176\u5b9e\u5c31\u662f\u7b2c\u4e00\u95ee\u9884\u5904\u7406\u7684\u90a3\u4e2a\u4e1c\u897f\u7684 $t^2$ \u6b21\u65b9\uff0c\u9884\u5904\u7406\u4e00\u4e0b\u5373\u53ef\u6574\u9664\u5206\u5757\u3002\n\n----\n\n### $\\textit{type}=2$\n\n\u6bd2\u7624\u3002\n\n$$\n\\begin{aligned}\n\\mathcal F(A,B,C)=&\\ \\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^Ci^{\\gcd(i,j,k)}\\\\\n=&\\ \\prod_{i=1}^Ai^{\\sum_{j=1}^B\\sum_{k=1}^C\\gcd(i,j,k)}\\\\\n=&\\ \\prod_{d=1}\\prod_{i=1}^Ai^{\\sum_{j=1}^B\\sum_{k=1}^C[\\gcd(i,j,k)=d]d}\\\\\n=&\\ \\prod_{d=1}\\prod_{i=1}^{\\lfloor\\frac Ad\\rfloor}(id)^{\\sum_{j=1}^{B/d}\\sum_{k=1}^{C/d}[\\gcd(i,j,k)=1]d}\\\\\n=&\\ \\prod_{d=1}\\prod_{e=1}\\prod_{i=1}^{\\lfloor\\frac A{de}\\rfloor}(ide)^{\\lfloor{\\frac B{de}}\\rfloor\\lfloor{\\frac C{de}}\\rfloor\\mu(e)d}\\\\\n=&\\ \\prod_{t=1}\\prod_{d\\mid t}\\prod_{i=1}^{\\lfloor\\frac At\\rfloor}(it)^{\\lfloor\\frac Bt\\rfloor\\lfloor\\frac Ct\\rfloor\\mu(\\frac td)d}\\\\\n=&\\ \\prod_{t=1}\\left(\\prod_{d\\mid t}\\left(\\lfloor\\frac At\\rfloor!\\cdot t^{\\lfloor\\frac At\\rfloor}\\right)^{\\mu(\\frac td)d}\\right)^{\\lfloor\\frac Bt\\rfloor\\lfloor\\frac Ct\\rfloor}\\\\\n=&\\ \\prod_{t=1}\\left(\\left(\\lfloor\\frac At\\rfloor!\\cdot t^{\\lfloor\\frac At\\rfloor}\\right)^{\\sum_{d\\mid t}\\mu(\\frac td)d}\\right)^{\\lfloor\\frac Bt\\rfloor\\lfloor\\frac Ct\\rfloor}\\\\\n=&\\ \\prod_{t=1}\\left(\\left(\\lfloor\\frac At\\rfloor!\\cdot t^{\\lfloor\\frac At\\rfloor}\\right)^{\\varphi(t)}\\right)^{\\lfloor\\frac Bt\\rfloor\\lfloor\\frac Ct\\rfloor}\\\\\n\\end{aligned}\n$$\n\n\u8fd9\u73a9\u610f\u6709\u70b9\u590d\u6742\uff0c\u628a\u5b83\u62c6\u6210\u4e24\u4e2a\u90e8\u5206\uff1a\n\n$$\n\\begin{aligned}\n& f_0(A,B,C)=\\prod_{t=1}\\left(\\left(\\lfloor\\frac At\\rfloor!\\right)^{\\lfloor\\frac Bt\\rfloor\\lfloor\\frac Ct\\rfloor}\\right)^{\\varphi(t)}\\\\\n& f_1(A,B,C)=\\prod_{t=1}\\left(t^{\\varphi(t)}\\right)^{\\lfloor\\frac At\\rfloor\\lfloor\\frac Bt\\rfloor\\lfloor\\frac Ct\\rfloor}\n\\end{aligned}\n$$\n\n\u4e8e\u662f\u6709\uff1a\n\n$$\n\\begin{aligned}\n\\mathcal F(A,B,C)=f_0(A,B,C)\\cdot f_1(A,B,C)\n\\end{aligned}\n$$\n\n$f_1$ \u53ef\u4ee5\u6574\u9664\u5206\u5757\u4e86\uff0c\u628a $f_2$ \u5148\u653e\u7740\uff0c\u770b $\\mathcal G$\uff1a\n\n$$\n\\begin{aligned}\n\\mathcal G(A,B,C)=&\\ \\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{\\gcd(i,j,k)}\\\\\n=&\\ \\prod_{d=1}\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^Cd^{[\\gcd(i,j)=d]\\gcd(d,k)}\\\\\n=&\\ \\prod_{d=1}d^{\\sum_{i=1}^{A/d}\\sum_{j=1}^{B/d}[\\gcd(i,j)=1]\\sum_{k=1}^C\\gcd(d,k)}\\\\\n=&\\ \\prod_{d=1}d^{\\sum_{e=1}\\lfloor{\\frac A{de}\\rfloor}\\lfloor\\frac B{de}\\rfloor\\mu(e)\\cdot\\sum_{k=1}^C\\gcd(d,k)}\\\\\n=&\\ \\prod_{t=1}\\left(\\prod_{d\\mid t}d^{\\mu(\\frac td)\\cdot\\sum_{k=1}^C\\gcd(d,k)}\\right)^{\\lfloor\\frac At\\rfloor\\lfloor\\frac Bt\\rfloor}\n\\end{aligned}\n$$\n\n\u6307\u6570\u4e0a\u7684\u4e1c\u897f\uff1a\n\n$$\n\\begin{aligned}\n\\sum_{k=1}^C\\gcd(d,k)=&\\ \\sum_{f\\mid d}\\sum_{k=1}^{\\lfloor\\frac Cf\\rfloor}[\\gcd(\\frac df,k)=1]f\\\\\n=&\\ \\sum_{f\\mid d}\\sum_{g\\mid\\frac df}\\lfloor\\frac C{fg}\\rfloor\\mu(g)f\\\\\n=&\\ \\sum_{u\\mid d}\\varphi(u)\\lfloor\\frac Cu\\rfloor\n\\end{aligned}\n$$\n\n\u7136\u540e\u5e26\u56de\u53bb\uff1a\n\n$$\n\\begin{aligned}\n\\mathcal G(A,B,C)=&\\ \\prod_{t=1}\\left(\\prod_{d\\mid t}d^{\\mu(\\frac td)\\sum_{u\\mid d}\\varphi(u)\\lfloor\\frac Cu\\rfloor}\\right)^{\\lfloor\\frac At\\rfloor\\lfloor\\frac Bt\\rfloor}\\\\\n\\end{aligned}\n$$\n\n\u8fd9\u73a9\u610f\u4e0d\u600e\u4e48\u597d\u9884\u5904\u7406\u3002\u8003\u8651\u628a\u5e95\u6570\u7684 $d$ \u62c6\u6210 $u$ \u548c $\\frac du$\uff1a\n\n$$\n\\begin{aligned}\n& g_0(A,B,C)=\\prod_{t=1}\\left(\\prod_{d\\mid t}\\prod_{u\\mid d}\\left(\\frac du\\right)^{\\mu(\\frac td)\\varphi(u)\\lfloor\\frac Cu\\rfloor}\\right)^{\\lfloor\\frac At\\rfloor\\lfloor\\frac Bt\\rfloor}\\\\\n& g_1(A,B,C)=\\prod_{t=1}\\left(\\prod_{d\\mid t}\\prod_{u\\mid d}u^{\\mu(\\frac td)\\varphi(u)\\lfloor\\frac Cu\\rfloor}\\right)^{\\lfloor\\frac At\\rfloor\\lfloor\\frac Bt\\rfloor}\n\\end{aligned}\n$$\n\n\u5c31\u6709\uff1a\n\n$$\n\\mathcal G(A,B,C)=g_0(A,B,C)\\cdot g_1(A,B,C)\n$$\n\n\u5206\u522b\u63a8\u4e00\u4e0b\uff1a\n\n$$\n\\begin{aligned}\ng_0(A,B,C)=&\\ \\prod_{t=1}\\left(\\prod_{d\\mid t}\\prod_{u\\mid d}\\left(\\frac du\\right)^{\\mu(\\frac td)\\varphi(u)\\lfloor\\frac Cu\\rfloor}\\right)^{\\lfloor\\frac At\\rfloor\\lfloor\\frac Bt\\rfloor}\\\\\n=&\\ \\prod_{t=1}\\left(\\prod_{u\\mid t}\\prod_{u\\mid d\\mid t}\\left(\\frac du\\right)^{\\mu(\\frac td)\\varphi(u)\\lfloor\\frac Cu\\rfloor}\\right)^{\\lfloor\\frac At\\rfloor\\lfloor\\frac Bt\\rfloor}\\\\\n=&\\ \\prod_{t=1}\\left(\\prod_{u\\mid t}\\left(\\prod_{d\\mid \\frac tu}d^{\\mu(\\frac td)}\\right)^{\\varphi(u)\\lfloor\\frac Cu\\rfloor}\\right)^{\\lfloor\\frac At\\rfloor\\lfloor\\frac Bt\\rfloor}\\\\\n=&\\ \\prod_{u=1}\\left(\\prod_{t=1}\\left(\\prod_{d\\mid t}d^{\\mu(\\frac td)}\\right)^{\\lfloor\\frac A{tu}\\rfloor\\lfloor\\frac B{tu}\\rfloor}\\right)^{\\varphi(u)\\lfloor\\frac Cu\\rfloor}\n\\end{aligned}\n$$\n\n\u62ec\u53f7\u91cc\u7684\u4e1c\u897f\u9884\u5904\u7406\u8fc7\u4e86\uff0c\u4e24\u6b21\u6574\u9664\u5206\u5757\u53ef\u4ee5\u641e\u5b9a\u3002\n\n$$\n\\begin{aligned}\ng_1(A,B,C)=&\\ \\prod_{t=1}\\left(\\prod_{d\\mid t}\\prod_{u\\mid d}u^{\\mu(\\frac td)\\varphi(u)\\lfloor\\frac Cu\\rfloor}\\right)^{\\lfloor\\frac At\\rfloor\\lfloor\\frac Bt\\rfloor}\\\\\n=&\\ \\prod_{u=1}\\prod_{t=1}\\left(\\prod_{d\\mid t}u^{\\mu(\\frac td)\\varphi(u)\\lfloor\\frac Cu\\rfloor}\\right)^{\\lfloor\\frac A{tu}\\rfloor\\lfloor\\frac B{tu}\\rfloor}\\\\\n=&\\ \\prod_{u=1}u^{\\sum_{t=1}\\sum_{d\\mid t}\\mu(\\frac td)\\varphi(u)\\lfloor\\frac Cu\\rfloor\\lfloor\\frac A{tu}\\rfloor\\lfloor\\frac B{tu}\\rfloor}\\\\\n=&\\ \\prod_{u=1}u^{\\varphi(u)\\lfloor\\frac Cu\\rfloor\\sum_{t=1}\\lfloor\\frac A{tu}\\rfloor\\lfloor\\frac B{tu}\\rfloor\\sum_{d\\mid t}\\mu(\\frac td)}\\\\\n=&\\ \\prod_{u=1}u^{\\varphi(u)\\lfloor\\frac Cu\\rfloor\\sum_{t=1}\\lfloor\\frac A{tu}\\rfloor\\lfloor\\frac B{tu}\\rfloor[t=1]}\\\\\n=&\\ \\prod_{u=1}u^{\\varphi(u)\\lfloor\\frac Au\\rfloor\\lfloor\\frac Bu\\rfloor\\lfloor\\frac Cu\\rfloor}\\\\\n\\end{aligned}\n$$\n\n\u6ce8\u610f\u5230\uff0c$g_1$ \u548c\u4e4b\u524d\u7684 $f_1$ \u5176\u5b9e\u662f\u4e00\u6837\u7684\uff0c\u800c\u4e14\u5b83\u4eec\u7684\u503c\u4e0d\u53d7 $A,B,C$ \u987a\u5e8f\u7684\u5f71\u54cd\uff0c\u56e0\u6b64\u53ef\u4ee5\u628a\u5b83\u4eec\u7ea6\u6389\u3002\n\n-----\n\n\u5361\u5e38\u5c0f\u6280\u5de7\uff08\u4e0d\u8fc7\u5e94\u8be5\u4f17\u6240\u5468\u77e5\uff09\uff1a\u628a\u9884\u5904\u7406\u7684\u4e1c\u897f\u7684\u9006\u5143\u540c\u65f6\u9884\u5904\u7406\u51fa\u6765\u53ef\u4ee5\u5927\u5e45\u51cf\u5c0f\u5e38\u6570\n\n[code](https://www.luogu.com.cn/paste/n5q3vgbs) \uff08\u9884\u5904\u7406\u4e11\u964b\u65e0\u6bd4\uff09\n\n",
        "postTime": 1638073587,
        "uid": 114082,
        "name": "Sya_Resory",
        "ccfLevel": 5,
        "title": "P5518 \u9898\u89e3"
    },
    {
        "content": "5 \u6708\u5f00\u7684\uff0c\u73b0\u5728\u5199\u5b8c\u3002\u3002\u3002~~\u8db3\u4ee5\u663e\u793a\u6211\u6709\u591a\u5495~~\n\n[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P5518)\n\n\u63d0\u524d\u5f00\u5751\uff1f\n\n\u7ea6\u5b9a: \n\n1. \u5982\u65e0\u7279\u6b8a\u8bf4\u660e\uff0c\u672c\u6587\u7684 $n$ \u4e3a $ABC$ \u7684\u503c\u57df\u8303\u56f4\u3002\n\n1. \u5047\u5b9a $sum(x)=\\sum_{y=1}^{x} y$ \u3002\n\n1. \u7531\u4e8e\u4e0d\u60f3\u70b8\u6389 $\\LaTeX$ \uff0c\u628a\u4e00\u90e8\u5206\u6574\u9664\u7684\u76f4\u63a5\u5199\u6210\u4e86\u9664\u6cd5\u3002\n\n1. \u51fd\u6570 $\\varepsilon(x)=[x=1]$ \u76f4\u63a5\u7b80\u5199\u6210 $[x]$ \u3002 \n\n$\\operatorname{lcm}$ \u4e0d\u597d\u641e\uff0c\u5148\u628a\u67ff\u5b50\u62c6\u5f00\u3002\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} (\\frac{i \\times j}{\\gcd(i, j) \\times \\gcd(i, k)})^{f(type)}$$\n\n\u518d\u628a \u5e42 \u7ed9\u5957\u5f00\u3002\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} \\frac{(i \\times j)^{f(type)}}{[\\gcd(i, j) \\times \\gcd(i, k)]^{f(type)}} $$\n\n\u518d\u628a\u8fde\u4e58\u79ef\u653e\u8fdb\u5206\u6570\u91cc\u9762\uff08\u8fde\u4e58\u79ef\u6709\u4e2a\u597d\u5904\u5c31\u662f\u5206\u5b50\u5206\u6bcd\u53ef\u4ee5\u62c6\u5f00\u6765\u8ba1\u7b97\u8d21\u732e\uff09\u3002\n\n$$\\frac{\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C}(i \\times j)^{f(type)}}{\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C}[\\gcd(i, j) \\times \\gcd(i, k)]^{f(type)}}$$\n\n\u663e\u7136\u53ef\u4ee5\u628a\u5206\u6bcd\u770b\u6210\u4e24\u4e2a\u7c7b\u4f3c\u4e8e\u8fd9\u6837\u7684\u4e1c\u897f\u76f8\u4e58\uff1a\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} \\gcd(i, j)^{f(type)}$$\n\n\u540c\u65f6\uff0c\u5206\u5b50\u4e5f\u53ef\u4ee5\u7c7b\u4f3c\u540c\u5316\uff1a\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i ^{f(type)}$$\n\n\u90a3\u4e48\uff0c\u6211\u4eec\u53ea\u8981\u8ba1\u7b97\u51fa\u5206\u5b50\u548c\u5206\u6bcd\u7684\u503c\uff0c\u518d\u7528\u5206\u5b50\u4e58\u4e0a\u5206\u6bcd\u7684\u9006\u5143\u5373\u53ef\u3002\n\n~~\u4f46\u662f\u5e76\u6ca1\u6709\u5230\u5f88\u91cd\u8981\u7684\u73af\u8282~~\n\n\u76f4\u63a5\u5206 $type$ \u53bb\u63a8\u67ff\u5b50\uff01\uff011\n\n### Segment 1: $type=0$\n\n\u8003\u8651\u5206\u5b50\uff1a\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i^{1}$$\n\n\u663e\u7136\u6bcf\u4e2a $i$ \u90fd\u88ab\u4e58\u4e86 $B \\times C$ \u6b21\u3002\n\n\u90a3\u4e48\u5c31\u662f $\\prod_{i=1}^{A} i^{B \\times C} = (A!)^{B \\times C}$ \u3002\n\n\u9884\u5904\u7406\u9636\u4e58\u540e\u5feb\u901f\u5e42\u53ef\u505a\u5230 $\\log n$ \u3002\n\n\u518d\u770b\u5206\u6bcd\uff1a\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} \\gcd(i, j)^{1}=\\prod_{i=1}^{A}\\prod_{j=1}^{B} \\gcd(i, j)^{C}$$\n\n\u5e26\u7740\u5e42\u5e76\u4e0d\u597d\u63a8\uff0c\u628a $C$ \u63d0\u51fa\u3002\n\n$$(\\prod_{i=1}^{A}\\prod_{j=1}^{B} \\gcd(i, j))^{C}$$\n\n\u7136\u540e\u5c31\u53d8\u6210\u4e86\u83ab\u53cd\u57fa\u672c\u5957\u8def\u3002\n\n\n$$\\Large  \\left ({\\normalsize \\prod_{d=1} d }^{\\sum_{d'=1} \\mu(d') \\left \\lfloor \\frac{A}{dd'} \\right \\rfloor \\left \\lfloor \\frac{B}{dd'} \\right \\rfloor }   \\right ) ^{C}$$\n\n\u6765\u4e00\u53d1 $T=dd'$ \u3002\n\n$${\\Large \\left ( \\prod_{T=1}{\\large \\left ( {\\normalsize \\prod_{d|T} d^{\\mu(T/d)}}  \\right ) }^{\\left \\lfloor \\frac{A}{T} \\right \\rfloor \\left \\lfloor \\frac{B}{T} \\right \\rfloor }   \\right ) }^C $$\n\n\n\u6ce8\u610f\u5230\u7b2c\u4e8c\u5bf9\u62ec\u53f7\u91cc\u7684\u4e1c\u897f\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $T$ \u662f\u4e00\u5b9a\u7684\uff0c\u53ef\u4ee5 $O(n \\ln n)$ \u7b5b\u51fa\u6765\u3002\n\n\u5373\u4ee4 $f(T)=\\prod_{d|T} d^{\\mu(T/d)}$\n\n\u9884\u5904\u7406\u5b8c\u540e\u5c31\u53ef\u4ee5\u6109\u5feb\u5730\u8dd1\u6574\u9664\u5206\u5757$O(\\sqrt{n} \\log n)$\u5566~\n\n\n### Segment 2: $type=1$\n\n\u8003\u8651\u5206\u5b50\uff1a\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i^{i \\times j \\times k}$$\n\n\u663e\u7136\u8fd9\u4e2a $j,k$ \u53ef\u4ee5\u63d0\u51fa\u3002\n\n$$\\prod_{i=1}^{A} i^{i \\times sum(B) \\times sum(C) }=(\\prod_{i=1}^{A} i^{i})^{sum(B) \\times sum(C)}$$\n\n\u9884\u5904\u7406\u51fa\u62ec\u53f7\u5185\u7684\u4e1c\u897f\u540e\u5957\u4e2a\u5feb\u901f\u5e42\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\log n)$\u3002\n\n\u518d\u770b\u5206\u6bcd\uff1a\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} \\gcd(i, j)^{i \\times j \\times k}={\\Large \\left ({\\normalsize \\prod_{i=1}^{A}\\prod_{j=1}^{B} \\gcd(i, j)^{i \\times j}}   \\right ) } ^{sum(C)}$$\n\n\u6254\u6389\u5916\u9762\u7684\u5e42\uff0c\u7ee7\u7eed\u63a8\u91cc\u9762\u7684\uff0c\u90fd\u662f\u83ab\u53cd\u7684\u57fa\u672c\u5957\u8def\u4e86\u3002\n\n$$\\prod_{d=1}^{A}\\prod_{i=1}^{A/d}\\prod_{j=1}^{B/d} d^{ij \\times d^2 [gcd(i,j)]}$$\n\n\u7b2c\u4e09\u4e2a $\\prod$ \u53ef\u4ee5\u62c6\u6389\u3002\n\n$$\\prod_{d=1}^{A}\\prod_{i=1}^{A/d}d^{\\mu(i) \\times d^2 \\times i^2 \\times sum(A/di) \\times sum(B/di)}$$\n\n\u719f\u6089\u7684\u8fde\u4e58\u9879 $T=di$ \u3002\n\n$$\\prod_{T=1}^{A} {\\Large \\left ({\\large \\left ({\\normalsize \\prod_{d|T} d^{\\mu(T/d)}}   \\right )^{T^2} }  \\right ) ^{sum(A/T) \\times sum(B/T)}} $$\n\n\u770b\u5230\u4e86\u5417\uff01\u6211\u4eec\u4e4b\u524d\u51fa\u7684 $f(T)$ \u51fa\u73b0\u4e86\uff01\uff011\n\n$$\\prod_{T=1}^{A} { \\left (f(T)^{T^2}  \\right ) ^{sum(A/T) \\times sum(B/T)}} $$\n\n\n\u540c\u6837\u591a\u9884\u5904\u7406\u4e00\u4e2a\u5e73\u65b9\u5c31\u53ef\u4ee5\u505a\u5230\u5355\u6b21 $O(\\sqrt{n} \\log n)$ \u4e86\u3002\n\n**\u4e0d\u8981\u5fd8\u8bb0\u6211\u4eec\u4e4b\u524d\u4e22\u6389\u7684\u5e42\uff01\uff011**\n\n\n### Segment 3: $type=2$\n\n**\u63d0\u524d FBI WARNING\u3002**\n\n\u8003\u8651\u5206\u5b50\uff1a\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i^{\\gcd(i,j,k)}$$\n\n$$\\prod_{i=1}^{A}i^{\\sum_{j=1}^{B}\\sum_{k=1}^{C}\\gcd(i,j,k)}$$\n\n\u6eda\u8fc7\u53bb\u770b\u6307\u6570\u3002\n\n$$\\sum_{i=1}^{B}\\sum_{j=1}^{C}\\gcd(n,i,j)$$\n\n\u5927\u529b\u679a\u4e3e $\\gcd(i, j, n)$\n\n$$\\sum_{d=1}d\\sum_{i=1}^{B/d}\\sum_{j=1}^{C/d}[\\gcd(i, j, n/d][d|n]$$\n\n$[d|n]$ \u5f88\u70e6\uff0c\u6254\u5230\u5916\u9762\u3002\n\n$$\\sum_{d|n}d\\sum_{i=1}^{B/d}\\sum_{j=1}^{C/d}[\\gcd(i, j, n/d)]=\\sum_{d|n}d\\sum_{dd'|n}^{B} \\mu(d') \\left \\lfloor \\frac{B}{dd'} \\right \\rfloor \\left \\lfloor \\frac{C}{dd'} \\right \\rfloor $$\n\n\u6885\u5f00 n \u5ea6 ...\n\n$$\\sum_{T|n}\\left \\lfloor \\frac{B}{T} \\right \\rfloor \\left \\lfloor \\frac{C}{T} \\right \\rfloor \\sum_{d|T} \\mu(d) (T/d)$$\n\n\u7b2c\u4e8c\u4e2a $\\sum$ \u5176\u5b9e\u5c31\u662f\u6b27\u62c9\u53cd\u6f14 $\\varphi = \\mu * id$ \u3002\n\n$$\\sum_{T|n}\\left \\lfloor \\frac{B}{T} \\right \\rfloor \\left \\lfloor \\frac{C}{T} \\right \\rfloor \\varphi(T)$$ \n\n\u628a\u8fd9\u4e1c\u897f\u4ee3\u56de\u53bb\u3002\n\n$$\\prod_{i=1}^{A}i^{\\sum_{T|i}\\left \\lfloor \\frac{B}{T} \\right \\rfloor \\left \\lfloor \\frac{C}{T} \\right \\rfloor \\varphi(T)}$$\n\n\u628a $\\sum$ \u653e\u4e0b\u6765\u53d8\u6210 $\\prod$ \u3002\n\n$$\\prod_{i=1}^{A}\\prod_{T|i}i^{\\left \\lfloor \\frac{B}{T} \\right \\rfloor \\left \\lfloor \\frac{C}{T} \\right \\rfloor \\varphi(T)}$$\n\n$T$ \u5728\u91cc\u9762\u8ba1\u7b97\u5f88\u96be\uff0c\u4e0d\u59a8\u6539\u53d8\u679a\u4e3e\u987a\u5e8f\uff0c\u679a\u4e3e $T$ \u540e\u679a\u4e3e\u5176\u500d\u6570\uff1a\n\n$$\\prod_{T=1}^{A}(T^{\\left \\lfloor \\frac{A}{T} \\right \\rfloor } \\times \\prod_{i=1}^{\\left \\lfloor \\frac{A}{T} \\right \\rfloor } i) ^{\\left \\lfloor \\frac{B}{T} \\right \\rfloor \\left \\lfloor \\frac{C}{T} \\right \\rfloor \\varphi(T)}$$\n\n\u91cc\u9762\u7684 $\\prod$ \u53ef\u4ee5\u5316\u4e3a\u9636\u4e58\u3002\n\n$$\\prod_{T=1}^{A}(T^{\\varphi(T)} ) ^{\\left \\lfloor \\frac{A}{T} \\right \\rfloor \\left \\lfloor \\frac{B}{T} \\right \\rfloor \\left \\lfloor \\frac{C}{T} \\right \\rfloor }\\times (\\left \\lfloor \\frac{A}{T} \\right \\rfloor !)^{\\left \\lfloor \\frac{B}{T} \\right \\rfloor \\left \\lfloor \\frac{C}{T} \\right \\rfloor \\varphi(T)}$$\n\n\u9884\u5904\u7406\u4e00\u6ce2 $\\varphi$ \u7684\u524d\u7f00\u548c\u4ee5\u53ca $\\varphi$ \u7684\u6307\u6570\u5e42\u5373\u53ef $O(\\sqrt{n}\\log n)$ \u5566\u3002\n\n\u63a5\u4e0b\u6765\u662f\u6700\u6050\u6016\u7684\u67ff\u5b50\u3002\u3002\u3002\n\n$$\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} \\gcd(i, j)^{\\gcd(i,j,k)}$$\n\n\u8003\u8651\u679a\u4e3e $\\gcd(i,j,k)$ \u3002\n\n\u7531\u4e8e $\\gcd(i, j, k)=\\gcd(\\gcd(i, j), k)$\uff0c\u6240\u4ee5\u6211\u4eec\u679a\u4e3e $\\gcd(i, j)$\u3002\n\n$$=\\prod_{d=1}^{A} d^{\\sum_{i=1}^{A} \\sum_{j=1}^{B}[\\gcd(i, j)=d]\\times (\\sum_{k=1}^{C}\\gcd(d, k))}$$\n\n\u663e\u7136\u5e42\u7684\u6307\u6570\u73c2\u4ee5\u5206\u5f00\u8ba1\uff0c\u5957\u8def\u53d8\u6362\u4e0d\u591a\u8bf4\u3002\u3002\u3002\n\n$$=\\prod_{d=1}^{A} d^{(\\sum_{i=1}^{A/d} \\sum_{j=1}^{B/d}[\\gcd(i, j)]) \\times (\\sum_{k=1}^{C}\\gcd(d, k))}$$\n\n$$=\\prod_{d=1}^{A} d^{(\\sum_{d'|\\min(A/d, B/d)} \\mu(d') \\left \\lfloor \\frac{A}{dd'} \\right \\rfloor  \\left \\lfloor \\frac{B}{dd'} \\right \\rfloor ) \\times (\\sum_{k=1}^{C}\\gcd(d, k))}$$\n\n\u8fd9\u91cc\u6709\u4e2a\u5f88\u5999\u7684\u4e00\u4e2a\u70b9\uff1a\u5c06 $\\sum$ \u4e0b\u653e\uff0c\u4ecd\u7136\u662f $T=dd'$\u3002\n\n$$=\\prod_{T=1}^{A} (\\prod_{d|T} d^{\\mu(T/d) \\times \\sum_{k=1}^{C}\\gcd(d, k)})^{\\left \\lfloor \\frac{A}{T} \\right \\rfloor  \\left \\lfloor \\frac{B}{T} \\right \\rfloor }$$\n\n\u5bf9\u4e8e\u53f3\u4e0a\u89d2\u7684 $\\sum_{k=1}^{C}\\gcd(d, k)$\uff0c\u53f3\u8f6c\u53bb [\u8fd9\u91cc](https://www.luogu.com.cn/problem/P2303) $=\\sum_{d'|d} \\left \\lfloor \\frac{C}{d'} \\right \\rfloor \\varphi(d')$\uff0c\u5957\u56de\u53bb\u5e76\u540c\u6837\u5c06 $\\sum$ \u4e0b\u653e\u3002\n\n$$=\\prod_{T=1}^{A} (\\prod_{d|T} \\prod_{d'|d}d^{\\mu(T/d) \\times \\left \\lfloor \\frac{C}{d'} \\right \\rfloor \\varphi(d')})^{\\left \\lfloor \\frac{A}{T} \\right \\rfloor  \\left \\lfloor \\frac{B}{T} \\right \\rfloor }$$\n\n\u8fd9\u91cc\u6709\u4e2a\u9634\u95f4\u7684\u505a\u6cd5\uff1a\u628a $d$ \u53d8\u6210 $d' \\times \\frac{d}{d'}$\u3002\n\n\u5bf9\u4e8e $d'$\uff1a\n\n$$\\prod_{T=1}^{A} (\\prod_{d|T} \\prod_{d'|d} d'^{\\mu(T/d) \\times \\left \\lfloor \\frac{C}{d'} \\right \\rfloor \\varphi(d')})^{\\left \\lfloor \\frac{A}{T} \\right \\rfloor  \\left \\lfloor \\frac{B}{T} \\right \\rfloor }$$\n\n\u679a\u4e3e $T=d'$\n\n$$=\\prod_{T=1}^{A} T^{\\varphi(T)\\left \\lfloor \\frac{C}{T} \\right \\rfloor\\sum_{d=1}^{A/T} \\left \\lfloor \\frac{A}{Td} \\right \\rfloor \\left \\lfloor \\frac{B}{Td} \\right \\rfloor \\sum_{d'|d} \\mu(d')}$$\n\n\u6ce8\u610f\u5230\u6700\u540e\u4e00\u4e2a\u4e1c\u897f\u5b9e\u9645\u4e0a\u662f\u83ab\u53cd\u7ecf\u5178\u67ff\u5b50\uff0c\u5f53 $d=1$ \u65f6\u5019\u624d\u6709\u6548\u3002\n\n\u4e8e\u662f\u67ff\u5b50\u5c31\u53d8\u6210\u4e86\uff1a\n\n$$=\\prod_{T=1}^{A} T^{\\varphi(T)\\left \\lfloor \\frac{C}{T} \\right \\rfloor \\left \\lfloor \\frac{A}{T} \\right \\rfloor \\left \\lfloor \\frac{B}{T} \\right \\rfloor }$$\n\n\u8fd9\u73a9\u610f\u8ddf\u5206\u5b50\u7684\u7b2c\u4e00\u5757\u7ea6\u6389\u4e86\uff08\u5fd8\u8bb0\u4e86\u5c31\u56de\u53bb\u5eb7\u5eb7\uff09\u3002\n\n\u5bf9\u4e8e $\\frac{d}{d'}$\uff1a\n\n$$\\prod_{T=1}^{A} (\\prod_{d|T} \\prod_{d'|d} (\\frac{d}{d'})^{\\mu(T/d) \\times \\left \\lfloor \\frac{C}{d'} \\right \\rfloor \\varphi(d')})^{\\left \\lfloor \\frac{A}{T} \\right \\rfloor  \\left \\lfloor \\frac{B}{T} \\right \\rfloor }$$\n\n\u8fd9\u91cc\u6709\u4e2a\u66f4\u9634\u95f4\u7684\u64cd\u4f5c\uff1a\u5c06 $T$ \u548c $d$ \u540c\u65f6\u4e58\u4e0a $d'$\u3002\n\n$$=\\prod_{d'=1}^{A}\\prod_{T=1}^{A/d'}\\prod_{d|T} d^{\\mu(T/d)\\varphi(d')\\left \\lfloor \\frac{A}{T} \\right \\rfloor \\left \\lfloor \\frac{B}{T} \\right \\rfloor \\left \\lfloor \\frac{C}{d'} \\right \\rfloor }$$\n\n\u4f60\u53d1\u73b0\u5176\u4e2d\u6709\u4e2a\u4e1c\u897f\u662f\u6211\u4eec\u4e4b\u524d\u5f97\u5230\u7684 $f$\u3002\n\n$$=\\prod_{T=1}^{A}(\\prod_{d=1}^{A/T} f(d)^{\\left \\lfloor \\frac{A}{Td} \\right \\rfloor \\left \\lfloor \\frac{B}{Td} \\right \\rfloor })^{\\varphi(T)\\left \\lfloor \\frac{C}{T} \\right \\rfloor }$$\n\n\u5957\u4e24\u4e2a\u6574\u9664\u5206\u5757\uff0c$\\left \\lfloor \\frac{A}{T} \\right \\rfloor$ \u6700\u5927\u5230 $\\sqrt{n}$\uff0c\u90a3\u4e48\u91cc\u9762\u7684\u6570\u8bba\u5206\u5757\u5c31\u662f $n^{0.25}$\n\n\u8fd9\u6837\u5c31\u662f $O(n^{0.75} \\log n)$\u3002\n\n\u6574\u7406\u4e00\u4e0b\u4e4b\u524d\u7684\u4e1c\u897f\u3002\n\n\u9700\u8981\u9884\u5904\u7406\u7684\uff1a\n\n$f(T)=\\prod_{d|T} d^{\\mu(T/d)}$\n\n$f_2(T)=f(T)^{T^2}$\n\n$F(T)=\\prod_{i=1}^{T}i^i$\n\n$F_2(T)=(\\prod_{i=1}^{T}i)^{\\varphi(T)}$\n\n$sum(T)=\\sum_{i=1}^{T} i$\n\n$fac(T)=T!$\n\n---\n\u63a5\u4e0b\u6765\u4e0e\u9898\u89e3\u65e0\u5173\uff0c\u5355\u7eaf\u662f\u5c0f\u6280\u5de7\u3002\n\n\u9996\u5148\u56de\u5230\u5f00\u5934\uff0c\u6211\u4eec\u7528\u4ee5\u4e0b\u4e1c\u897f\u6765\u8868\u793a\uff1a\n\n$$G(A, B, C)=\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} \\gcd(i, j)^{f(type)}$$\n\n$$H(A,B,C)=\\prod_{i=1}^{A}\\prod_{j=1}^{B}\\prod_{k=1}^{C} i ^{f(type)}$$\n\n\u90a3\u4e48\u7b54\u6848\u5c31\u662f\uff1a\n\n$$\\frac{H(A,B,C) \\times H(B,A,C)}{G(A,B,C) \\times G(A,C,B)}$$\n\n\u5199\u4e2a\u51fd\u6570\u5c31\u53ef\u4ee5\u5927\u5927\u51cf\u5c11\u7801\u91cf\uff08\u867d\u7136\u6211\u77e5\u9053\u662f\u4e2a\u4eba\u90fd\u4f1a\uff09\u3002\n\n---\n\n\u6211\u4eec\u518d\u6765\u68b3\u7406\u4e00\u4e0b\u8981\u6c42\u7684\u4e1c\u897f\u3002\n\n$H_0(A,B,C)=fac(A)^{B \\times C}$\n\n$G_0(A,B,C)={\\large \\left ( \\prod_{T=1}{\\large \\left ( {\\normalsize f(T}  \\right ) }^{\\left \\lfloor \\frac{A}{T} \\right \\rfloor \\left \\lfloor \\frac{B}{T} \\right \\rfloor }   \\right ) }^C$\n\n$H_1(A,B,C)=F(A)^{sum(B) \\times sum(C)}$\n\n$G_1(A,B,C)=(\\prod_{T=1}^{A} f_2(T)^{sum(A/T) \\times sum(B/T)})^{sum(C)} $\n\n$H_2(A,B,C)=(\\left \\lfloor \\frac{A}{T} \\right \\rfloor !)^{\\left \\lfloor \\frac{B}{T} \\right \\rfloor \\left \\lfloor \\frac{C}{T} \\right \\rfloor \\varphi(T)}$\n\n$G_2(A,B,C)=\\prod_{T=1}^{A}(\\prod_{d=1}^{A/T} f(d)^{\\left \\lfloor \\frac{A}{Td} \\right \\rfloor \\left \\lfloor \\frac{B}{Td} \\right \\rfloor })^{\\varphi(T)\\left \\lfloor \\frac{C}{T} \\right \\rfloor }$\n\n\u653e\u4e00\u4e0b\u7a9d\u7684\u5c4e\u5c71\u4ee3\u7801\u3002\u3002\u3002\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\ntypedef long long ll;\nconst int INF=0x3f3f3f3f;\nsigned P;\ninline int read(){\n\tchar ch=getchar();int x=0, f=1;\n\twhile(!isdigit(ch)){if(ch=='-') f=-1; ch=getchar();}\n\twhile(isdigit(ch)){x=(x<<3)+(x<<1)+ch-'0';ch=getchar();}\n\treturn x*f;\n}\ninline void write(int x){\n    if(x<0) putchar('-'), x=-x;\n    if(x>9) write(x/10);\n    putchar(x%10+'0');\n}\ninline int mod(int x, int mos){\n\tx=(x%mos+mos)%mos;\n\treturn x;\n}\ninline int ksm(int a, int b, int mos){\n\tint ret=1;b=mod(b, mos-1);\n\tfor(; b; b>>=1, a=1ll*a*a%mos)\n\t\tif(b&1) ret=1ll*ret*a%mos;\n\treturn ret;\n}\nnamespace Solution{\n\tconst int N=1e5+1e3;\n\tint mu[N], phi[N], u[N], st[N], top;\n\tint fac[N], f[N], f_inv[N], F[N], f2[N], f2_inv[N];\n\tvoid pre(int n){\n\t\tfac[0]=1, mu[1]=1, phi[1]=1;\n\t\tfor(int i=1; i<=n; i++)\n\t\t\tfac[i]=1ll*fac[i-1]*i%P;\n\t\tfor(int i=2; i<=n; i++){\n\t\t\tif(!u[i]){st[++top]=i, mu[i]=-1, phi[i]=i-1;}\n\t\t\tfor(int j=1; j<=top&&1ll*i*st[j]<=n; j++){\n\t\t\t\tu[i*st[j]]=1;\n\t\t\t\tif(i%st[j]==0){mu[i*st[j]]=0, phi[i*st[j]]=phi[i]*st[j];break;} \n\t\t\t\tmu[i*st[j]]=-mu[i], phi[i*st[j]]=phi[i]*phi[st[j]];\n\t\t\t}\n\t\t}\n\t\tfor(int i=0; i<=n; i++)\n\t\t\tf[i]=f2[i]=1;\n\t\tf_inv[0]=f2_inv[0]=1;\n\t\tfor(int j=1; j<=n; j++)\n\t\t\tif(mu[j]) //\u5c0f\u526a\u679d \n\t\t\t\tfor(int i=j; i<=n; i+=j)\n\t\t\t\t\tf[i]=1ll*f[i]*ksm(i/j, mu[j], P)%P;\n\t\tfor(int i=0; i<=n; i++)\n\t\t\tF[i]=ksm(i, i, P),\n\t\t\tf2[i]=ksm(f[i], 1ll*i*i%(P-1), P);\n\t\tfor(int i=1; i<=n; i++)\n\t\t\tf[i]=1ll*f[i]*f[i-1]%P, f_inv[i]=ksm(f[i], P-2, P),\n\t\t\tf2[i]=1ll*f2[i]*f2[i-1]%P, f2_inv[i]=ksm(f2[i], P-2, P),\n\t\t\tF[i]=1ll*F[i]*F[i-1]%P, phi[i]=mod(phi[i]+phi[i-1], P-1);\n//\t\tfor(int i=99998; i<=100000; i++)\n//\t\t\tprintf(\">>>>>>f2[%lld]=%lld\\n\", i, f2[i]);\n\t\treturn ;\n\t}\n\tint sum(int S, int mos){\n\t\tif(S&1) return 1ll*(S+1)/2*S%mos;\n\t\treturn 1ll*S/2*(S+1)%mos;\n\t}\n\tinline int H0(int A, int B, int C){\n//\tprintf(\"fac[%lld]=%lld\\n\", A, fac[A]); \n\t\treturn ksm(fac[A], B*C%(P-1), P);\n\t}\n\tinline int G0(int A, int B, int C){\n\t\tint ret=1, t=min(A, B);\n\t\tfor(int l=1, r; l<=t; l=r+1){\n\t\t\tr=min(A/(A/l), B/(B/l));\n\t\t\tint tmp=1ll*f[r]*f_inv[l-1]%P;\n\t\t\ttmp=ksm(tmp, (A/l)*(B/l)%(P-1), P);\n//\t\t\tif(ret==0) printf(\"find 0 at %lld\\n\", l);\n\t\t\tret=1ll*ret*tmp%P;\n\t\t}\n\t\treturn ksm(ret, C, P);\n\t}\n\tinline int H1(int A, int B, int C){\n\t\treturn ksm(F[A], 1ll*sum(B, P-1)*sum(C, P-1)%(P-1), P);\n\t}\n\tinline int G1(int A, int B, int C){\n\t\tint ret=1, t=min(A, B);\n\t\tfor(int l=1, r; l<=t; l=r+1){\n\t\t\tr=min(A/(A/l), B/(B/l));\n\t\t\tint tmp=1ll*f2[r]*f2_inv[l-1]%P;\n\t\t\ttmp=ksm(tmp, 1ll*sum(A/l, P-1)*sum(B/l, P-1)%(P-1), P);\n//\t\t\tif(ret==0) printf(\"find 0 at %lld\\n\", l);\n\t\t\tret=1ll*ret*tmp%P;\n\t\t}\n\t\treturn ksm(ret, sum(C, P-1), P);\n\t}\n\tinline int H2(int A, int B, int C){\n\t\tint ret=1, t=min(A, min(B, C));\n\t\tfor(int l=1, r; l<=t; l=r+1){\n\t\t\tr=min(A/(A/l), min(B/(B/l), C/(C/l)));\n\t\t\tint tmp=1ll*(B/l)*(C/l)%(P-1)*mod(phi[r]-phi[l-1], P-1)%(P-1);\n\t\t\ttmp=ksm(fac[A/l], tmp, P);\n\t\t\tret=1ll*ret*tmp%P;\n\t\t}\n\t\treturn ret;\n\t}\n\tint zcfk(int A, int B){\n\t\tint ret=1, t=min(A, B);\n    \tfor(int l=1, r=0; l<=t; l=r+1){\n        \tr=min(A/(A/l), B/(B/l));\n        \tint tmp=ksm(1ll*f[r]*f_inv[l-1]%P, 1ll*(A/l)*(B/l)%(P-1), P);\n        \tret=1ll*ret*tmp%P;\n    \t}\n//\t\tprintf(\"--%lld\\n\", ret);\n\t\treturn ret;\n\t}\n\tinline int G2(int A, int B, int C){\n\t\tint ret=1, t=min(A, min(B, C));\n    \tfor(int l=1, r=0; l<=t; l=r+1){\n        \tr=min(A/(A/l), min(B/(B/l), C/(C/l)));\n        \tint tmp=ksm(zcfk(A/l, B/l), 1ll*mod(phi[r]-phi[l-1], P-1)*(C/l)%(P-1), P);\n\t\t\tret=1ll*ret*tmp%P;\n    \t}\n\t\treturn ret;\n\t}\n\tint type1(int A, int B, int C){\n\t\tint ret=1ll*H0(A, B, C)*H0(B, A, C)%P;\n\t\tint rem=1ll*G0(A, B, C)*G0(A, C, B)%P;\n\t\treturn mod(1ll*ret*ksm(rem, P-2, P)%P, P);\n\t}\n\tint type2(int A, int B, int C){\n\t\tint ret=1ll*H1(A, B, C)*H1(B, A, C)%P;\n\t\tint rem=1ll*G1(A, B, C)*G1(A, C, B)%P;//printf(\"rem:%lld\\n\", rem);\n\t\treturn mod(1ll*ret*ksm(rem, P-2, P)%P, P);\n\t}\n\tint type3(int A, int B, int C){\n\t\tint ret=1ll*H2(A, B, C)*H2(B, A, C)%P;\n\t\tint rem=1ll*G2(A, B, C)*G2(A, C, B)%P;//printf(\"rem:%lld\\n\", rem);\n\t\treturn mod(1ll*ret*ksm(rem, P-2, P)%P, P);\n\t\treturn 0;\n\t}\n\tsigned work(){\n\t\tint T=read();P=read();\n\t\tpre(100000);\n//\t\tprintf(\"--%lld %lld\\n\", fac[99999], fac[99998]);\n\t\tfor(int i=1; i<=T; i++){\n\t\t\tint A=read(), B=read(), C=read();\n\t\t\tprintf(\"%lld %lld %lld\\n\", type1(A, B, C), type2(A, B, C), type3(A, B, C));\n\t\t}\n\t\treturn 0;\n\t}\n}\n\nsigned main(){\n\tSolution :: work();\n\treturn 0;\n}\n/*\n1 998244353\n99998 99999 100000\n99998 100000 99999\n99999 99998 100000\n99999 100000 99998\n100000 99998 99999 \n100000 99999 99998  \n*/\n\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        "postTime": 1622005533,
        "uid": 341102,
        "name": "ReKoJ",
        "ccfLevel": 0,
        "title": "P5518 [MtOI2019]\u5e7d\u7075\u4e50\u56e2 / \u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u57fa\u7840\u7ec3\u4e60\u9898"
    },
    {
        "content": "# [MtOI2019]\u5e7d\u7075\u4e50\u56e2\u89e3\u9898\u62a5\u544a\n\n\u6807\u7b7e\uff1a \u89e3\u9898\u62a5\u544a\n\n---\n\n\u53d1\u73b0\u81ea\u5df1\u7684\u4e00\u7bc7\u8fdc\u53e4\u9898\u89e3\uff0c\u62ff\u51fa\u6765\u53d1\u4e00\u4e0b\uff1a\n\n[[MtOI2019]\u5e7d\u7075\u4e50\u56e2](https://www.luogu.com.cn/problem/P5518)\u89e3\u9898\u62a5\u544a\uff1a\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://zybuluo.com/xiaoziyao/note/1689732)\n\n\u9898\u610f\uff1a\u5171$T$\u7ec4\u6570\u636e\uff0c\u7ed9\u5b9a$A,B,C,p$\u6c42\u5bf9\u4e8e\u6bcf\u4e2a$type$\u7684$(\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C(\\frac{lcm(i,j)}{\\gcd(i,k)})^{f(type)})\\bmod p$\uff0c\u5176\u4e2d\uff1a$f(0)=1,f(1)=i\\cdot j\\cdot k,f(2)=\\gcd(i,j,k)$\u3002\n\n\u6570\u636e\u8303\u56f4\uff1a$A,B,C\\leqslant 10^5,10^7\\leqslant p\\leqslant 1.05\\cdot 10^9,p\\in\\mathbb{P},T\\leqslant 70$\n\n\u8fd9\u9053\u9898\u7684\u516c\u5f0f\u771f\u7684\u662f\u7cbe\u795e\u6c61\u67d3\u3002\u3002\u3002\n\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u5c06\u539f\u5f0f\u5316\u4e3a$(\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C(\\frac{i\\cdot j}{\\gcd(i,k)^2})^{f(type)})\\bmod p$\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5206\u4e3a\u4e24\u90e8\u5206\u6765\u505a\u8fd9\u9053\u9898\uff0c\u5373\u6c42$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C i^{f(type)}$\u4e0e$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{f(type)}$\n\n- $type=0$\u65f6\uff1a\n\u7b2c\u4e00\u4e2a\u5f0f\u5b50\uff1a\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C i^{f(0)}=\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C i=\\prod_{i=1}^A i^{B\\cdot C}=(\\prod_{i=1}^A i)^{B\\cdot C}$$\n\u7136\u540e\u7528\u4e00\u4e9b\u57fa\u672c\u7684\u5957\u8def\uff08\u679a\u4e3e$\\gcd$\uff0c\u5c06\u6c42\u79ef\u8f6c\u6362\u4e3a\u6307\u6570\u7684\u6c42\u548c\uff0c\u83ab\u6bd4\u4e4c\u65af\u51fd\u6570\u66ff\u6362$\\gcd$\uff0c\u7b49\u5dee\u6570\u5217\u6c42\u548c\u7b49\uff09\u5316\u7b80\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\uff1a\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{f(0)}=\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)=\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)^C=(\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j))^C=(\\prod_{d=1}^A\\prod_{i=1}^A\\prod_{j=1}^B d^{[\\gcd(i,j)==d]})^C=(\\prod_{d=1}^A d^{\\sum_{i=1}^A\\sum_{j=1}^B[\\gcd(i,j)==d]})^C=(\\prod_{d=1}^A d^{\\sum_{i=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{B}{d}\\rfloor}[\\gcd(i,j)==1]})^C=(\\prod_{d=1}^A d^{\\sum_{i=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{B}{d}\\rfloor}\\sum_{k\\mid\\gcd(i,j)}\\mu(k)})^C=(\\prod_{d=1}^A d^{\\sum_{k=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\mu(k)\\cdot (\\sum_{i=1}^{\\lfloor\\frac{A}{k\\cdot d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{B}{k\\cdot d}\\rfloor}1)})^C=(\\prod_{d=1}^A d^{\\sum_{k=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\mu(k)\\cdot\\lfloor\\frac{A}{k\\cdot d}\\rfloor\\cdot \\lfloor\\frac{B}{k\\cdot d}\\rfloor})^C$$\n\n\u8bbe$t=k\\cdot d$\uff0c\u5219\u6709\uff1a\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C i^{f(0)}=(\\prod_{t=1}^A\\prod_{d\\mid t}d^{\\mu(\\frac{t}{d})\\cdot\\lfloor\\frac{A}{t}\\rfloor\\cdot\\lfloor\\frac{B}{t}\\rfloor})^C=(\\prod_{t=1}^A(\\prod_{d\\mid t}d^{\\mu(\\frac{t}{d})})^{\\lfloor\\frac{A}{t}\\rfloor\\cdot\\lfloor\\frac{B}{t}\\rfloor})^C$$\n\n\u8bbe$f(x)=\\prod_{d\\mid x}x^{\\mu(\\frac{x}{d})}$\uff0c\u5219\u5176\u53ef\u4ee5\u5728$O(n\\log n)$\u7684\u65f6\u95f4\u7528\u6574\u9664\u5206\u5757\u9884\u5904\u7406\n\n\u6b64\u65f6\u539f\u5f0f\u4e3a$(\\prod_{t=1}^A f(x)^{\\lfloor\\frac{A}{t}\\rfloor\\cdot\\lfloor\\frac{B}{t}\\rfloor})^C$\n\n\u53ef\u4ee5\u6574\u9664\u5206\u5757\u89e3\u51b3\u8fd9\u4e00\u5f0f\u5b50\u3002\n\n\u5f97\u5206\uff1a$20pts$\n\n- $type=1$\u65f6\uff1a\n\u7b2c\u4e00\u4e2a\u5f0f\u5b50\uff1a\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C i^{f(1)}=\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C i^{i\\cdot j\\cdot k}=\\prod_{i=1}^A i^{i\\cdot j\\cdot\\sum_{k=1}^C k}=\\prod_{i=1}^A i^{i\\cdot(\\sum_{j=1}^B j)\\cdot(\\sum_{k=1}^C k)}=\\prod_{i=1}^A i^{i\\cdot\\frac{B\\cdot(B+1)}{2}\\cdot\\frac{C\\cdot(C+1)}{2}}=(\\prod_{i=1}^A i^i)^{\\frac{B\\cdot(B+1)}{2}\\cdot\\frac{C\\cdot(C+1)}{2}}$$\n\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\uff1a\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{f(1)}=\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{i\\cdot j\\cdot k}=\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)^{i\\cdot j\\cdot(\\sum_{k=1}^C k)}=\\prod_{i=1}^A\\prod_{j=1}^B\\gcd(i,j)^{i\\cdot j\\cdot\\frac{C\\cdot(C+1)}{2}}=\\prod_{d=1}^n\\prod_{i=1}^A\\prod_{j=1}^B[\\gcd(i,j)==d]d^{i\\cdot j\\cdot\\frac{C\\cdot(C+1)}{2}}=\\prod_{d=1}^A\\prod_{i=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\prod_{j=1}^{\\lfloor\\frac{B}{d}\\rfloor}[\\gcd(i,j)==1]d^{i\\cdot j\\cdot\\frac{C\\cdot(C+1)}{2}}=(\\prod_{d=1}^A\\prod_{i=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\prod_{j=1}^{\\lfloor\\frac{B}{d}\\rfloor}(\\sum_{k\\mid\\gcd(i,j)}\\mu(k))\\cdot d^{i\\cdot j\\cdot d^2})^\\frac{C\\cdot(C+1)}{2}=(\\prod_{d=1}^A d^{d^2\\cdot \\sum_{i=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{B}{d}\\rfloor}(i\\cdot j\\cdot \\sum_{k\\mid\\gcd(i,j)}\\mu(k))})^{\\frac{C\\cdot(C+1)}{2}}=(\\prod_{d=1}^A d^{d^2\\cdot \\sum_{k=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\mu(k)\\sum_{i=1}^{\\lfloor\\frac{A}{k\\cdot d}\\rfloor}i\\cdot k\\sum_{j=1}^{\\lfloor\\frac{B}{k\\cdot d}\\rfloor}j\\cdot k})^{\\frac{C\\cdot(C+1)}{2}}=(\\prod_{d=1}^A d^{\\sum_{k=1}^{\\lfloor\\frac{A}{d}\\rfloor}d^2\\cdot \\mu(k)\\cdot k^2\\cdot\\frac{\\lfloor\\frac{A}{k\\cdot d}\\rfloor\\cdot (\\lfloor\\frac{A}{k\\cdot d}\\rfloor+1)}{2}\\cdot\\frac{\\lfloor\\frac{B}{k\\cdot d}\\rfloor\\cdot (\\lfloor\\frac{B}{k\\cdot d}\\rfloor+1)}{2}})^{\\frac{C\\cdot(C+1)}{2}}=(\\prod_{t=1}^A\\prod_{d\\mid t} d^{(d^2\\cdot (\\frac{t}{d})^2)\\cdot\\mu(\\frac{t}{d})\\cdot\\frac{\\lfloor\\frac{A}{t}\\rfloor\\cdot (\\lfloor\\frac{A}{t}\\rfloor+1)}{2}\\cdot\\frac{\\lfloor\\frac{B}{t}\\rfloor\\cdot (\\lfloor\\frac{B}{t}\\rfloor+1)}{2}})^{\\frac{C\\cdot(C+1)}{2}}=(\\prod_{t=1}^A(\\prod_{d\\mid t} d^{\\mu(\\frac{t}{d})\\cdot t^2})^{\\frac{\\lfloor\\frac{A}{t}\\rfloor\\cdot (\\lfloor\\frac{A}{t}\\rfloor+1)}{2}\\cdot\\frac{\\lfloor\\frac{B}{t}\\rfloor\\cdot (\\lfloor\\frac{B}{t}\\rfloor+1)}{2}})^{\\frac{C\\cdot(C+1)}{2}}$$\n\n\u8bbe$f(x)=(\\prod_{d\\mid x}x^{\\cdot\\mu(\\frac{x}{d})})^{x^2}$\uff0c\u5219$f(x)$\u53ef\u4ee5\u9884\u5904\u7406\n\n\u539f\u5f0f\u53ef\u5316\u4e3a\uff1a\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{f(1)}=(\\prod_{t=1}^A f(t)^{\\frac{\\lfloor\\frac{A}{t}\\rfloor\\cdot (\\lfloor\\frac{A}{t}\\rfloor+1)}{2}\\cdot\\frac{\\lfloor\\frac{B}{t}\\rfloor\\cdot (\\lfloor\\frac{B}{t}\\rfloor+1)}{2}})^{\\frac{C\\cdot(C+1)}{2}}$$\n\u76f4\u63a5\u6574\u9664\u5206\u5757\u5373\u53ef\n\u5f97\u5206$60pts$\n\n- $type=2$\u65f6\n\u7b2c\u4e00\u4e2a\u5f0f\u5b50\uff1a\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C i^{f(2)}=\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C i^{\\gcd(i,j,k)}=\\prod_{i=1}^A i^{\\sum_{j=1}^B\\sum_{k=1}^C\\gcd(i,j,k)}=\\prod_{i=1}^A i^{\\sum_{d=1}^B\\sum_{j=1}^B\\sum_{k=1}^C[\\gcd(i,j,k)==d]\\cdot d}=\\prod_{i=1}^A i^{\\sum_{d=1}^B\\sum_{j=1}^{\\lfloor\\frac{B}{d}\\rfloor}\\sum_{k=1}^{\\lfloor\\frac{C}{d}\\rfloor}[d\\mid i][\\gcd(\\frac{i}{d},j,k)==1]\\cdot d}=\\prod_{i=1}^A i^{\\sum_{d\\mid i}\\sum_{j=1}^{\\lfloor\\frac{B}{d}\\rfloor}\\sum_{k=1}^{\\lfloor\\frac{C}{d}\\rfloor}d\\cdot (\\sum_{r\\mid\\gcd(\\frac{i}{d},j,k)}\\mu(r))}=\\prod_{i=1}^A i^{\\sum_{d\\mid i}\\sum_{r\\mid\\frac{i}{d}}\\sum_{j=1}^{\\lfloor\\frac{B}{r\\cdot d}\\rfloor}\\sum_{k=1}^{\\lfloor\\frac{C}{r\\cdot d}\\rfloor}d\\cdot \\mu(r))}=\\prod_{i=1}^A i^{\\sum_{d\\mid i}d\\sum_{r\\mid\\frac{i}{d}}\\mu(r)\\sum_{j=1}^{\\lfloor\\frac{B}{r\\cdot d}\\rfloor}\\sum_{k=1}^{\\lfloor\\frac{C}{r\\cdot d}\\rfloor}1}=\\prod_{i=1}^A i^{\\sum_{d\\mid i}d\\sum_{r\\mid\\frac{i}{d}}\\mu(r)\\cdot\\lfloor\\frac{B}{r\\cdot d}\\rfloor\\cdot\\lfloor\\frac{C}{r\\cdot d}\\rfloor}$$\n\n\u8bbe$t=r\\cdot d$\uff0c\u5219\u6709\uff1a\n\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C i^{f(2)}=\\prod_{i=1}^A i^{\\sum_{t\\mid n}\\lfloor\\frac{B}{t}\\rfloor\\cdot\\lfloor\\frac{C}{t}\\rfloor\\sum_{d\\mid t}(d\\cdot\\mu(\\frac{t}{d}))}$$\n\n\u7531$\\mu\\cdot I=\\epsilon$\u4e0e$\\varphi\\cdot I=id$\uff0c\u53ef\u4ee5\u7b80\u5355\u63a8\u4e00\u4e0b\uff1a\n$$\\varphi\\cdot I=id \\varphi\\cdot I\\cdot\\mu=id\\cdot\\mu \\varphi\\cdot\\epsilon=id\\cdot\\mu \\varphi=id\\cdot\\mu \\varphi(x)=\\sum_{d\\mid x} d\\cdot\\mu(\\frac{x}{d})$$\n\u56e0\u6b64\u5e26\u5165\u539f\u5f0f\u5f97\uff1a\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C i^{f(2)}=\\prod_{i=1}^A i^{\\sum_{t\\mid n}\\lfloor\\frac{B}{t}\\rfloor\\cdot\\lfloor\\frac{C}{t}\\rfloor\\varphi(t)}=\\prod_{i=1}^A\\prod_{t\\mid i} i^{\\varphi(t)\\cdot \\lfloor\\frac{B}{t}\\rfloor\\cdot\\lfloor\\frac{C}{t}\\rfloor}=\\prod_{t=1}^A\\prod_{i=1}^{\\lfloor\\frac{A}{t}\\rfloor} (i\\cdot t)^{\\varphi(t)\\cdot \\lfloor\\frac{B}{t}\\rfloor\\cdot\\lfloor\\frac{C}{t}\\rfloor}$$\n\u6ce8\u610f\u4e00\u4e0b\uff0c\u8fd9\u91cc$i$\u6269\u5927$t$\u500d\u7684\u539f\u56e0\u662f$i$\u7684\u8303\u56f4\u7f29\u5c0f\u4e86$t$\n\u7ee7\u7eed\u63a8\uff1a\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C i^{f(2)}=\\prod_{t=1}^A(t^{\\lfloor\\frac{A}{t}\\rfloor}\\cdot\\prod_{i=1}^{\\lfloor\\frac{A}{t}\\rfloor}i)^{\\varphi(t)\\cdot \\lfloor\\frac{B}{t}\\rfloor\\cdot\\lfloor\\frac{C}{t}\\rfloor}=\\prod_{t=1}^A ((t^{\\varphi(t)})^{\\lfloor\\frac{A}{t}\\rfloor\\cdot\\lfloor\\frac{B}{t}\\rfloor\\cdot\\lfloor\\frac{C}{t}\\rfloor}\\cdot(\\prod_{i=1}^{\\lfloor\\frac{A}{t}\\rfloor}i)^{\\varphi(t)\\cdot\\lfloor\\frac{B}{t}\\rfloor\\cdot\\lfloor\\frac{C}{t}\\rfloor})$$\n\u8bbe$fac(i)$\u4e3a$i$\u7684\u9636\u4e58\uff0c\u5219\u539f\u5f0f\u53ef\u5316\u4e3a\uff1a\n$$\\prod_{t=1}^A ((t^{\\varphi(t)})^{\\lfloor\\frac{A}{t}\\rfloor\\cdot\\lfloor\\frac{B}{t}\\rfloor\\cdot\\lfloor\\frac{C}{t}\\rfloor}\\cdot fac(\\lfloor\\frac{A}{t}\\rfloor)^{\\varphi(t)\\cdot\\lfloor\\frac{B}{t}\\rfloor\\cdot\\lfloor\\frac{C}{t}\\rfloor})$$\n\u7136\u540e\u9884\u5904\u7406+\u6574\u9664\u5206\u5757\u5c31\u53ef\u4ee5\u89e3\u51b3\u4e86\n\u7b2c\u4e8c\u4e2a\u5f0f\u5b50\uff1a\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{f(2)}=\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{\\gcd(i,j,k)}$$\n\u679a\u4e3e$\\gcd(i,j)$\uff1a\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{f(2)}=\\prod_{d=1}^A\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C[\\gcd(i,j)==d]\\cdot d^{\\gcd(i,j,k)}=\\prod_{d=1}^A d^{\\sum_{i=1}^A\\sum_{j=1}^B\\sum_{k=1}^C[\\gcd(i,j)==d]\\cdot\\gcd(i,j,k)}=\\prod_{d=1}^A d^{\\sum_{i=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{B}{d}\\rfloor}\\sum_{k=1}^C[\\gcd(i,j)==1]\\cdot\\gcd(d,k)}=\\prod_{d=1}^A d^{\\sum_{i=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{B}{d}\\rfloor}\\sum_{k=1}^C(\\sum_{r\\mid\\gcd(i,j)}\\mu(r))\\cdot\\gcd(d,k)}=\\prod_{d=1}^A d^{\\sum_{r=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\mu(r)\\sum_{i=1}^{\\lfloor\\frac{A}{r\\cdot d}\\rfloor}\\sum_{j=1}^{\\lfloor\\frac{B}{r\\cdot d}\\rfloor}\\sum_{k=1}^C\\gcd(d,k)}=\\prod_{d=1}^A d^{\\sum_{r=1}^{\\lfloor\\frac{A}{d}\\rfloor}\\mu(r)\\cdot\\lfloor\\frac{A}{r\\cdot d}\\rfloor\\cdot\\lfloor\\frac{B}{r\\cdot d}\\rfloor(\\sum_{k=1}^C\\gcd(d,k))}$$\n\n\u8bbe$t=r\\cdot d$\uff0c\u5219\u6709\uff1a\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{f(2)}=\\prod_{t=1}^A\\prod_{d\\mid t}d^{\\mu(\\frac{t}{d})\\cdot\\lfloor\\frac{A}{t}\\rfloor\\cdot\\lfloor\\frac{B}{t}\\rfloor(\\sum_{k=1}^C\\gcd(d,k))}$$\n\u6211\u4eec\u5c06$\\sum_{k=1}^C\\gcd(d,k)$\u5355\u72ec\u62ff\u51fa\u63a8\u4e00\u4e0b\uff1a\n$$\\sum_{k=1}^C\\gcd(d,k)=\\sum_{w\\mid d}\\sum_{k=1}^C[\\gcd(d,k)==w]\\cdot w=\\sum_{w\\mid d} w\\sum_{k=1}^{\\lfloor\\frac{C}{w}\\rfloor}[\\gcd(\\frac{d}{w},k)==1]=\\sum_{w\\mid d}w\\sum_{k=1}^{\\lfloor\\frac{C}{w}\\rfloor}\\sum_{g\\mid\\gcd(\\frac{d}{w},k)}\\mu(g)=\\sum_{w\\mid d}w\\sum_{g\\mid\\frac{d}{w}}\\mu(g)\\cdot\\lfloor\\frac{C}{w\\cdot g}\\rfloor$$\n\u8bbe$h=w\\cdot g$\uff0c\u5219\u6709\uff1a\n$$\\sum_{k=1}^C\\gcd(d,k)=\\sum_{h\\mid d}\\sum_{w\\mid h}w\\cdot\\mu(\\frac{h}{w})\\cdot\\lfloor\\frac{C}{h}\\rfloor$$\n\u7531\u4e0a\u9762\u63a8\u51fa\u7684$\\varphi(x)=\\sum_{d\\mid x} d\\cdot\\mu(\\frac{x}{d})$\u5e26\u5165\u4e0a\u5f0f\u5f97\n$$\\sum_{k=1}^C\\gcd(d,k)=\\sum_{h\\mid d}\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor$$\n\u5c06\u5176\u4ee3\u5165\u539f\u5f0f\u5f97\uff1a\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C i^{f(2)}=\\prod_{t=1}^A\\prod_{d\\mid t}d^{\\mu(\\frac{t}{d})(\\sum_{h\\mid d}\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor)\\cdot \\lfloor\\frac{A}{t}\\rfloor\\cdot\\lfloor\\frac{B}{t}\\rfloor}=\\prod_{t=1}^A\\prod_{d\\mid t}\\prod_{h\\mid d}d^{\\mu(\\frac{t}{d})\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor\\cdot \\lfloor\\frac{A}{t}\\rfloor\\cdot\\lfloor\\frac{B}{t}\\rfloor}$$\n\u8fd9\u91cc\u9700\u8981\u6bd4\u8f83\u6bd2\u7624\u5c06$d$\u62c6\u6210$\\frac{d}{h}\\cdot h$\uff0c\u6211\u4eec\u5148\u8ba1\u7b97$\\frac{d}{h}$\u7684\u60c5\u51b5\uff1a\n\u6539\u53d8\u6c42\u548c\u987a\u5e8f\u5e76\u5148\u540e\u5c06$t$\u4e0e$d$\u6269\u5927$h$\u500d\u5f97\u539f\u5f0f\u53ef\u4ee5\u5316\u4e3a\uff1a\n$$\\prod_{h=1}^A\\prod_{t=1}^{\\lfloor\\frac{A}{h}\\rfloor}\\prod_{h\\mid d,d\\mid h\\cdot t}\\frac{d}{h}^{\\mu(\\frac{h\\cdot t}{d})\\cdot\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor\\cdot\\lfloor\\frac{A}{h\\cdot t}\\rfloor\\cdot\\lfloor\\frac{B}{h\\cdot t}\\rfloor}=\\prod_{h=1}^A\\prod_{t=1}^{\\lfloor\\frac{A}{h}\\rfloor}\\prod_{d\\mid t}d^{\\mu(\\frac{h\\cdot t}{d\\cdot h})\\cdot\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor\\cdot\\lfloor\\frac{A}{h\\cdot t}\\rfloor\\cdot\\lfloor\\frac{B}{h\\cdot t}\\rfloor}=\\prod_{h=1}^A(\\prod_{t=1}^{\\lfloor\\frac{A}{h}\\rfloor}(\\prod_{d\\mid t}d^{\\mu(\\frac{t}{d})})^{\\lfloor\\frac{A}{h\\cdot t}\\rfloor\\cdot\\lfloor\\frac{B}{h\\cdot t}\\rfloor})^{\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor}$$\n\u8bbe$f(x)=\\sum_{d\\mid x}d^{\\mu(\\frac{x}{d})}$\uff0c\u5219$f(x)$\u53ef\u5728$O(n\\log n)$\u7684\u65f6\u95f4\u5185\u9884\u5904\u7406\n\u5219\u539f\u5f0f\u53ef\u5316\u4e3a\n$$\\prod_{h=1}^A(\\prod_{t=1}^{\\lfloor\\frac{A}{h}\\rfloor}f(t)^{\\lfloor\\frac{A}{h\\cdot t}\\rfloor\\cdot\\lfloor\\frac{B}{h\\cdot t}\\rfloor})^{\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor}$$\n\u7136\u540e\u6211\u4eec\u8ba1\u7b97$h$\u7684\u60c5\u51b5\uff1a\n\u540c\u6837\u6211\u4eec\u53ef\u4ee5\u6539\u53d8\u6c42\u548c\u987a\u5e8f\uff0c\u5148\u540e\u5c06$t$\u548c$d$\u6269\u5927$h$\u500d\n$$\\prod_{t=1}^A\\prod_{d\\mid t}\\prod_{h\\mid d}h^{\\mu(\\frac{t}{d})\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor\\cdot \\lfloor\\frac{A}{t}\\rfloor\\cdot\\lfloor\\frac{B}{t}\\rfloor}=\\prod_{h=1}^A\\prod_{t=1}^{\\lfloor\\frac{A}{h}\\rfloor}\\prod_{h\\mid d,d\\mid h\\cdot t}\nh^{\\mu(\\frac{h\\cdot t}{d})\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor\\cdot \\lfloor\\frac{A}{t}\\rfloor\\cdot\\lfloor\\frac{B}{t}\\rfloor}=\\prod_{h=1}^A\\prod_{t=1}^{\\lfloor\\frac{A}{h}\\rfloor}\\prod_{d\\mid t} h^{\\mu(\\frac{h\\cdot t}{d\\cdot h}\\cdot\\varphi(h))\\cdot \\lfloor\\frac{C}{h}\\rfloor\\cdot\\lfloor\\frac{A}{h\\cdot t}\\rfloor\\cdot\\lfloor\\frac{B}{h\\cdot t}\\rfloor}=\\prod_{h=1}^A\\prod_{t=1}^{\\lfloor\\frac{A}{h}\\rfloor}\\prod_{d\\mid t} h^{\\mu(\\frac{t}{d}\\cdot\\varphi(h))\\cdot \\lfloor\\frac{C}{h}\\rfloor\\cdot\\lfloor\\frac{A}{h\\cdot t}\\rfloor\\cdot\\lfloor\\frac{B}{h\\cdot t}\\rfloor}$$\n\u5c06\u6c42\u79ef\u6539\u6210\u6307\u6570\u6c42\u548c\u5f97\uff1a\n$$\\prod_{t=1}^A\\prod_{d\\mid t}\\prod_{h\\mid d}h^{\\mu(\\frac{t}{d})\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor\\cdot \\lfloor\\frac{A}{t}\\rfloor\\cdot\\lfloor\\frac{B}{t}\\rfloor}=\\prod_{h=1}^A h^{\\sum_{t=1}^{\\lfloor\\frac{A}{h}\\rfloor}\\sum_{d\\mid t}\\mu(\\frac{t}{d})\\cdot\\varphi(h)\\cdot \\lfloor\\frac{C}{h}\\rfloor\\cdot\\lfloor\\frac{A}{h\\cdot t}\\rfloor\\cdot\\lfloor\\frac{B}{h\\cdot t}\\rfloor}=\\prod_{h=1}^A h^{\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor\\cdot \\sum_{t=1}^{\\lfloor\\frac{A}{h}\\rfloor} \\lfloor\\frac{A}{h\\cdot t}\\rfloor\\cdot\\lfloor\\frac{B}{h\\cdot t}\\rfloor\\sum_{d\\mid t}\\mu(\\frac{t}{d})}$$\n\u7531\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14$\\mu\\cdot I=\\epsilon$\u5f97\uff1a\n$$\\prod_{t=1}^A\\prod_{d\\mid t}\\prod_{h\\mid d}h^{\\mu(\\frac{t}{d})\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor\\cdot \\lfloor\\frac{A}{t}\\rfloor\\cdot\\lfloor\\frac{B}{t}\\rfloor}=\\prod_{h=1}^A h^{\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor\\cdot \\sum_{t=1}^{\\lfloor\\frac{A}{h}\\rfloor} \\lfloor\\frac{A}{h\\cdot t}\\rfloor\\cdot\\lfloor\\frac{B}{h\\cdot t}\\rfloor\\epsilon(t)}=\\prod_{h=1}^A h^{\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor\\cdot \\sum_{t=1}^{\\lfloor\\frac{A}{h}\\rfloor} [t==1]\\cdot \\lfloor\\frac{A}{h\\cdot t}\\rfloor\\cdot\\lfloor\\frac{B}{h\\cdot t}\\rfloor}=\\prod_{h=1}^A h^{\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor\\cdot \\lfloor\\frac{A}{h\\cdot 1}\\rfloor\\cdot\\lfloor\\frac{B}{h\\cdot 1}\\rfloor}=\\prod_{h=1}^A h^{\\varphi(h)\\cdot\\lfloor\\lfloor\\frac{A}{h}\\rfloor\\cdot\\lfloor\\frac{B}{h}\\rfloor\\cdot\\frac{C}{h}\\rfloor}$$\n\u6545\n$$\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{f(2)}=\\prod_{i=1}^A\\prod_{j=1}^B\\prod_{k=1}^C\\gcd(i,j)^{\\gcd(i,j,k)}=(\\prod_{h=1}^A(\\prod_{t=1}^{\\lfloor\\frac{A}{h}\\rfloor}f(t)^{\\lfloor\\frac{A}{h\\cdot t}\\rfloor\\cdot\\lfloor\\frac{B}{h\\cdot t}\\rfloor})^{\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor})\\cdot (\\prod_{h=1}^A h^{\\varphi(h)\\cdot\\lfloor\\frac{A}{h}\\rfloor\\cdot\\lfloor\\frac{B}{h}\\rfloor\\cdot\\lfloor\\frac{C}{h}\\rfloor})=\\prod_{h=1}^A((\\prod_{t=1}^{\\lfloor\\frac{A}{h}\\rfloor}f(t)^{\\lfloor\\frac{A}{h\\cdot t}\\rfloor\\cdot\\lfloor\\frac{B}{h\\cdot t}\\rfloor})^{\\varphi(h)\\cdot\\lfloor\\frac{C}{h}\\rfloor}\\cdot h^{\\varphi(h)\\cdot\\lfloor\\frac{A}{h}\\rfloor\\cdot\\lfloor\\frac{B}{h}\\rfloor\\cdot\\lfloor\\frac{C}{h}\\rfloor})$$\n\uff08$f(x)=\\sum_{d\\mid x}d^{\\mu(\\frac{x}{d})}$\uff09\n```\n#include<stdio.h>\nconst int maxn=100005;\nlong long i,j,k,m,n,T,p,A,B,C,l,r,cnt;\nlong long a[maxn],c[maxn],mu[maxn],varphi[maxn],fac1[maxn],fac2[maxn],w1[maxn],f1[maxn],g1[maxn],w2[maxn],f2[maxn],g2[maxn],w3[maxn],f3[maxn],g3[maxn],sum[maxn];\n//a[i]={Prime},c[i]=[i\\in{Prime}?]\n//mu[i]=(i==1?)1:((i=\\prod_{j=1}^s p_i,(p_x!=p_y(x!=y)))? 0:(-1)^s)\n//fac1[i]=i!,fac2[i]=\\prod_{j=1}^i i^i\n//w1[i]=\\prod_{d|i}i^{\\mu(d/i)},f1[i]=\\prod_{j=1}^i w1[i],g1[i]=f1[i]^{-1}\n//w2[i]=w1[i]*(i^2),f2[i]=\\prod_{j=1}^i w2[i],g2[i]=f2[i]^{-1}\n//w3[i]=i^{\\varphi(i)},f3[i]=\\prod_{j=1]^i w3[i],g3[i]=f3[i]^{-1}\n//sum[i]=\\sum_{j=1}^i varphi[i]\ninline long long min(long long a,long long b){\n\treturn a<b? a:b;\n}\nlong long ksm(long long a,long long b,long long p){\n\tlong long res=1;\n\twhile(b>0){\n\t\tif(b&1)\n\t\t\tres=(res*a)%p;\n\t\ta=(a*a)%p,b>>=1;\n\t}\n\treturn res;\n}\nlong long inv(long long a,long long b){\n\treturn ksm(a,b-2,b);\n}\nvoid init(){\n\tc[1]=mu[1]=varphi[1]=1;\n\tfor(long long i=2;i<maxn;i++){\n\t\tif(c[i]==0)\n\t\t\ta[++cnt]=i,mu[i]=-1,varphi[i]=i-1;\n\t\tfor(long long j=1;j<=cnt;j++){\n\t\t\tif(i*a[j]>=maxn)\n\t\t\t\tbreak;\n\t\t\tc[i*a[j]]=1;\n\t\t\tif(i%a[j]==0){\n\t\t\t\tmu[i*a[j]]=0;\n\t\t\t\tvarphi[i*a[j]]=varphi[i]*a[j];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmu[i*a[j]]=-mu[i];\n\t\t\tvarphi[i*a[j]]=varphi[i]*(a[j]-1);\n\t\t}\n\t}\n\tfac1[0]=1;\n\tfor(long long i=1;i<maxn;i++)\n\t\tfac1[i]=fac1[i-1]*i%p; \n\tfac2[0]=1;\n\tfor(long long i=1;i<maxn;i++)\n\t\tfac2[i]=fac2[i-1]*ksm(i,i%(p-1),p)%p; \n\tfor(long long i=0;i<maxn;i++)\n\t\tw1[i]=w2[i]=1;\n\tfor(long long i=1;i<maxn;i++){\n\t\tif(mu[i]==0)\n\t\t\tcontinue;\n\t\tfor(long long j=i;j<maxn;j+=i){\n\t\t\tif(mu[i]==1)\n\t\t\t\tw1[j]=(w1[j]*(j/i))%p;\n\t\t\tif(mu[i]==-1)\n\t\t\t\tw1[j]=(w1[j]*inv(j/i,p))%p;\n\t\t}\n\t}\n\tf1[0]=g1[0]=1;\n\tfor(long long i=1;i<maxn;i++)\n\t\tf1[i]=f1[i-1]*w1[i]%p,g1[i]=inv(f1[i],p);\n\tfor(long long i=1;i<maxn;i++)\n\t\tw2[i]=ksm(w1[i],i*i%(p-1),p);\n\tf2[0]=g2[0]=1;\n\tfor(long long i=1;i<maxn;i++)\n\t\tf2[i]=f2[i-1]*w2[i]%p,g2[i]=inv(f2[i],p);\n\tfor(long long i=1;i<maxn;i++)\n\t\tw3[i]=ksm(i,varphi[i],p);\n\tf3[0]=g3[0]=1;\n\tfor(long long i=1;i<maxn;i++)\n\t\tf3[i]=f3[i-1]*w3[i]%p,g3[i]=inv(f3[i],p);\n\tfor(long long i=1;i<maxn;i++)\n\t\tsum[i]=sum[i-1]+varphi[i];\n}\ninline long long getsum(long long x,long long p){\n\treturn x*(x+1)/2%p;\n}\nlong long getnmt(long long A,long long B,long long C,long long t){\n\tif(t==0){\n\t\tlong long res=ksm(fac1[A],B*C%(p-1),p);\n\t\treturn res;\n\t} \n\tif(t==1){\n\t\tlong long res=ksm(fac2[A],getsum(B,p-1)*getsum(C,p-1)%(p-1),p);\n\t\treturn res;\n\t}\n\tif(t==2){\n\t\tlong long l=1,r,res=1;\n\t\twhile(l<=min(min(A,B),C)){\n\t\t\tr=min(min(A/(A/l),B/(B/l)),C/(C/l));\n\t\t\tres=res*ksm(f3[r]*g3[l-1]%p,(A/l)*(B/l)%(p-1)*(C/l)%(p-1),p)%p*ksm(fac1[A/l],(sum[r]-sum[l-1]+(p-1))%(p-1)*(B/l)%(p-1)*(C/l)%(p-1),p)%p;\n\t\t\tl=r+1;\n\t\t}\n\t\treturn res;\n\t}\n}\nlong long getres(long long A,long long B){\n\tlong long l=1,r,res=1;\n\twhile(l<=min(A,B)){\n\t\tr=min(A/(A/l),B/(B/l));\n\t\tres=res*ksm(f1[r]*g1[l-1]%p,(A/l)*(B/l)%(p-1),p)%p;\n\t\tl=r+1;\n\t}\n\treturn res;\n}\nlong long getdmt(long long A,long long B,long long C,long long t){\n\tif(t==0){ \n\t\tlong long l=1,r,res=1;\n\t\twhile(l<=min(A,B)){\n\t\t\tr=min(A/(A/l),B/(B/l));\n\t\t\tres=(res*ksm(f1[r]*g1[l-1]%p,(A/l)*(B/l)%(p-1),p))%p;\n\t\t\tl=r+1;\n\t\t}\n\t\treturn ksm(res,C,p);\n\t}\n\tif(t==1){\n\t\tlong long l=1,r,res=1;\n\t\twhile(l<=min(A,B)){\n\t\t\tr=min(A/(A/l),B/(B/l));\n\t\t\tres=(res*ksm(f2[r]*g2[l-1]%p,getsum(A/l,p-1)*getsum(B/l,p-1)%(p-1),p))%p;\n\t\t\tl=r+1;\n\t\t}\n\t\treturn ksm(res,getsum(C,p-1),p);\n\t}\n\tif(t==2){\n\t\tlong long l=1,r,res=1;\n\t\twhile(l<=min(min(A,B),C)){\n\t\t\tr=min(min(A/(A/l),B/(B/l)),C/(C/l));\n\t\t\tres=res*ksm(getres(A/l,B/l),(sum[r]-sum[l-1]+(p-1))%(p-1)*(C/l)%(p-1),p)%p*ksm(f3[r]*g3[l-1]%p,(A/l)*(B/l)%(p-1)*(C/l)%(p-1),p)%p;\n\t\t\tl=r+1;\n\t\t}\n\t\treturn res;\n\t}\n}\nlong long getans(long long A,long long B,long long C,long long t){\n\tlong long nmt=getnmt(A,B,C,t)*getnmt(B,A,C,t)%p,dmt=getdmt(A,B,C,t)*getdmt(A,C,B,t)%p;\n\treturn nmt*inv(dmt,p)%p;\n}\nint main(){\n\tscanf(\"%lld%lld\",&T,&p);\n\tinit();\n\twhile(T--){\n\t\tscanf(\"%lld%lld%lld\",&A,&B,&C);\n\t\tprintf(\"%lld %lld %lld\\n\",getans(A,B,C,0),getans(A,B,C,1),getans(A,B,C,2)); \n\t}\n\treturn 0;\n}\n```",
        "postTime": 1593948285,
        "uid": 35754,
        "name": "Verdandi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5518 \u3010[MtOI2019]\u5e7d\u7075\u4e50\u56e2\u3011"
    }
]