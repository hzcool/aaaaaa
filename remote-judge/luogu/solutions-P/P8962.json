[
    {
        "content": "$\\mathrm{Upd~2023.2.3}$\uff1a\u4f18\u5316\u4e86\u6392\u5217\u6570\u7684\u9884\u5904\u7406\uff0c\u5e76\u4e14\u5bf9 $cnt_1,cnt_2$ \u8fdb\u884c\u4e86\u9884\u5904\u7406\uff0c\u590d\u6742\u5ea6\u7531 $O(n^3\\log n)$ \u964d\u4f4e\u81f3 $O(n^3)$\uff0c\u901f\u5ea6\u5feb\u4e86\u8fd1\u4e00\u500d\u3002\u611f\u8c22\u5927\u4f6c @[0x3b800001](https://www.luogu.com.cn/user/306090) \u63d0\u51fa\u7684\u610f\u89c1~\n\n### \u9898\u610f\u7b80\u8ff0\n\n- \u5bf9\u4e8e\u957f\u5ea6\u4e3a $i\\in[1,n]$ \u7684\u4e00\u4e2a $[1,i]$ \u7684\u65e0\u5e8f\u6392\u5217\uff0c\u6c42\u80fd\u591f\u901a\u8fc7\u4e8c\u5206\u7684\u65b9\u6cd5\u67e5\u8be2\u5230\u7b2c $k\\in[1,i]$ \u5c0f\u7684\u5143\u7d20\u7684\u5e8f\u5217\u4e2a\u6570\u3002\n- $10\\le n\\le400$\uff0c\u7b54\u6848\u5bf9\u7ed9\u5b9a\u7684 $2\\le p\\le998244353$ \u53d6\u6a21\uff08$p$ \u4e0d\u4e00\u5b9a\u4e3a\u8d28\u6570\uff09\u3002\n\n### \u9898\u76ee\u5206\u6790\n\n\u9996\u5148\u6211\u4eec\u8003\u8651\uff0c\u82e5\u9700\u8981\u6b63\u786e\u5730\u627e\u5230\u7b2c $k$ \u5c0f\u7684\u5143\u7d20\uff08\u6211\u4eec\u79f0\u4e4b\u4e3a $x$\uff09\uff0c\u5219\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $Mid$\uff0c$a_{Mid}$ \u4e0e $x$ \u7684\u5927\u5c0f\u5173\u7cfb\u662f\u786e\u5b9a\u7684\u3002\n\n\u6362\u8a00\u4e4b\uff0c\u82e5 $x$ \u4f4d\u4e8e\u4f4d\u7f6e $p$\uff0c\u6211\u4eec\u53ef\u4ee5\u6a21\u62df\u4e8c\u5206\u7684\u8fc7\u7a0b\uff1a\n\n\u5bf9\u4e8e\u5f53\u524d\u7684 $Mid$\uff0c\u82e5 $p<Mid$ \u5219\u5fc5\u7136 $a_{Mid}>x$\uff0c\u82e5 $p>Mid$ \u5219\u5fc5\u7136 $a_{Mid}<x$\uff0c\u5426\u5219\u5df2\u7ecf\u627e\u5230\u4e86 $x$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u80fd\u6c42\u51fa $a$ \u6570\u5217\u4e2d\uff0c\u5fc5\u987b\u5c0f\u4e8e $x$ \u4ee5\u53ca\u5fc5\u987b\u5927\u4e8e $x$ \u7684\u6570\u7684\u4e2a\u6570\uff0c\u5206\u522b\u8bb0\u4f5c $cnt_1$ \u548c $cnt_2$\uff0c\u5219\u5927\u5c0f\u5173\u7cfb\u4e0e $x$ \u4e0d\u786e\u5b9a\u7684\u4e2a\u6570\u4e3a $n-cnt_1-cnt_2-1$\uff08\u603b\u6570\u51cf\u5c0f\u4e8e\u51cf\u5927\u4e8e\u51cf\u7b49\u4e8e\u7684\u4e2a\u6570\uff09\uff0c\u5176\u4e2d $n$ \u4e3a\u6570\u5217\u957f\u5ea6\u3002\u5219\u6ee1\u8db3\u6b64\u5927\u5c0f\u5173\u7cfb\u7684\u6570\u5217\u7684\u4e2a\u6570\u4e3a\uff1a$A_{x-1}^{cnt_1}\\times A_{n-x}^{cnt_2}\\times A_{n-cnt_1-cnt_2-1}^{n-cnt_1-cnt_2-1}\\bmod p$\u3002\n\n\u5219\u6211\u4eec\u53ef\u4ee5\u8bbe\u7acb\u4e09\u5c42\u5faa\u73af\uff1a\u7b2c\u4e00\u5c42\u5faa\u73af $i\\in[1,n]$ \u8868\u793a\u6570\u5217\u957f\u5ea6\uff0c\u7b2c\u4e8c\u5c42\u5faa\u73af $j\\in[1,i]$ \u8868\u793a\u9700\u8981\u627e\u5230\u7b2c $j$ \u5927\u7684\u5143\u7d20\uff0c\u7b2c\u4e09\u5c42\u5faa\u73af $k\\in[1,i]$ \u8868\u793a\u7b2c $j$ \u5927\u5143\u7d20\u4f4d\u4e8e\u4f4d\u7f6e $k$ \u65f6\u7684\u65b9\u6848\u6570\u3002\u82e5\u8bbe $ans_{(i,j)}$ \u4e3a\u8f93\u51fa\u4e2d\u7b2c $i$ \u884c\u7b2c $j$ \u5217\uff0c\u5219\n$$\nans_{(i,j)}=\\Big(\\sum_{k=1}^iA_{j-1}^{cnt_1}\\times A_{i-j}^{cnt_2}\\times A_{i-cnt_1-cnt_2-1}^{i-cnt_1-cnt_2-1}\\Big)\\bmod p\n$$\n\u82e5\u6211\u4eec\u66b4\u529b\u6c42$ A$\uff0c\u90a3\u4e48\u590d\u6742\u5ea6\u4f1a\u8fbe\u5230 $O(n^4\\log n)$\uff0c\u663e\u7136\u4e0d\u884c\uff1b\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5 $O(n^2)$ \u9884\u5904\u7406\u51fa $\\forall i\\in[1,n],j\\in[1,i]$\uff0c$C_i^j$ \u7684\u503c\uff0c$O(n)$ \u9884\u5904\u7406\u51fa $\\forall i\\in[1,n]$\uff0c$i!$ \u7684\u503c\uff0c\u518d\u7ed3\u5408\u6392\u5217\u6570\u548c\u9636\u4e58 $O(n^2)$ \u9884\u5904\u7406\u51fa $A_i^j=C_i^j\\times j!$ \u964d\u4f4e\u590d\u6742\u5ea6\u5373\u53ef\u3002\u5e76\u4e14\u53ef\u4ee5$O(n^2\\log n)$ \u9884\u5904\u7406\u51fa $cnt_1,cnt_2$ \uff0c\u6700\u7ec8\u590d\u6742\u5ea6\u4e3a $O(n^3)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nint p,n,C[500][500],frac[500]={1},A[500][500],cnt1[500][500],cnt2[500][500]; // cnt1\u8868\u793a<\u7684\u4e2a\u6570 cnt2\u8868\u793a>\u7684\u4e2a\u6570\nint main(){\n    scanf(\"%d%d\",&p,&n);\n    for (int i=1;i<=n;i++) frac[i]=1ll*frac[i-1]*i%p; // \u9884\u5904\u7406\u9636\u4e58 \n    for (int i=0;i<=n;i++) C[i][0]=C[i][i]=1;\n    for (int i=1;i<=n;i++) for (int j=1;j<i;j++) C[i][j]=(C[i-1][j]+C[i-1][j-1])%p; // \u9884\u5904\u7406\u7ec4\u5408\u6570 \n    for (int i=0;i<=n;i++) for (int j=0;j<=i;j++) A[i][j]=1ll*C[i][j]*frac[j]%p; // \u7ec4\u5408\u6570*\u9636\u4e58=\u6392\u5217\u6570 \n    for (int i=1;i<=n;i++) // \u9884\u5904\u7406 cnt1,cnt2\n    \tfor (int k=1;k<=i;k++){\n    \t\tint L=1,R=i;\n\t\t\twhile (L<R){\n\t\t\t\tint Mid=(L+R)>>1;\n\t\t\t\tif (k==Mid) break;\n\t\t\t\tif (k<Mid) cnt2[i][k]++,R=Mid-1;\n\t\t\t\telse cnt1[i][k]++,L=Mid+1;\n            }\n\t\t}\n    for (int i=1;i<=n;i++){\n        for (int j=1;j<=i;j++){\n            int cnt=0;\n\t\t\t// i\u4e2a\u5143\u7d20\u4e2d,j\u4f4d\u4e8ek\u65f6\u80fd\u591f\u627e\u5230j\u7684\u65b9\u6848\u6570\n            for (int k=1;k<=i;k++) cnt=(cnt+1ll*A[j-1][cnt1[i][k]]*A[i-j][cnt2[i][k]]%p*A[i-cnt1[i][k]-cnt2[i][k]-1][i-cnt1[i][k]-cnt2[i][k]-1]%p)%p;\n            printf(\"%d \",cnt);\n        }\n        puts(\"\");\n    }\n    return 0;\n}\n```",
        "postTime": 1674376206,
        "uid": 508129,
        "name": "OIer_Eternity",
        "ccfLevel": 4,
        "title": "P8962 \u300cWHOI-4\u300dC yadiw. Slua, gassp, lhtubs. \u9898\u89e3"
    },
    {
        "content": "\u591a\u89e3\u9898\n\n## Solution 1. $O(n^3)$\n\n\u8003\u8651\u8bbe $f_{n,k}$ \u4e3a $n$ \u4e2a\u5143\u7d20\u627e $k$ \u80fd\u627e\u5230\u7684\u6392\u5217\u6570\u3002\n\n\u663e\u7136\u6709 $f_{1,1}=1$\u3002\n\n\u8003\u8651\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n\u8bbe\u4e2d\u95f4\u662f $m$\uff0c\u5de6\u534a\u90e8\u5206\u957f\u5ea6\u4e3a $l$\uff0c\u53f3\u8fb9\u4e3a $r$\u3002\n\n1. $a_{m}=k$\n\n$a_{mid}$ \u56fa\u5b9a\uff0c\u5176\u4ed6\u5168\u6392\u5217 $(n-1)!$ \u79cd\u60c5\u51b5\u3002\n\n2. $a_{m}<k$\n\n$a_{mid}$ \u56fa\u5b9a\uff0c\u5176\u4ed6\u5168\u6392\u5217 $(n-1)!$ \u79cd\u60c5\u51b5\u3002\n\n\u5f80\u53f3\u8fb9\u7ee7\u7eed\u641c\uff0c\u5de6\u8fb9\u6ca1\u7528\u3002\u663e\u7136\uff0c\u53f3\u8fb9\u53ef\u4ee5\u79bb\u6563\u5316\uff0c\u8003\u8651\u600e\u4e48\u8f6c\u79fb\u3002\n\n\u663e\u7136\uff0c\u5de6\u8fb9\u79bb\u6563\u5316 $k$ \u6709\u4e00\u4e2a\u6392\u540d $i$\u3002\u6b64\u65f6\u5de6\u8fb9\u6709 $i-1$ \u4e2a $<k$ \u7684\u6570\uff0c $r-i$ \u4e2a $>k$ \u7684\u6570\u3002\u53ef\u4ee5\u901a\u8fc7 $f_{r,i}$ \u6c42\u51fa\u3002\u8f6c\u79fb\u590d\u6742\u5ea6\u663e\u7136\u4e3a $O(n)$\u3002\n\n3. $a_m>k$\n\n\u540c\u7406\u53ef\u6c42\u3002\n\n\u6240\u4ee5\u603b\u5171\u5c31\u662f\u4e00\u4e2a $O(n^3)$ \u7684 dp\u3002\u4e3a\u4e86\u89e3\u51b3\u5bf9\u975e\u8d28\u6570\u53d6\u6a21\u7684\u7ec4\u5408\u6570\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u4f7f\u7528\u6768\u8f89\u4e09\u89d2\u5f62\u3002\n\n## Code 1\n\n```cpp\n#include <iostream>\nusing ll = long long;\n\nll p, N;\nll fac[1009];\nll C[1009][1009];\nll dp[1009][1009];\nint main() {\n  std::cin >> p >> N;\n  fac[0] = 1;\n  for (int i = 1; i <= N; ++i) fac[i] = fac[i - 1] * i % p;\n  for (int i = 0; i <= N; ++i) {\n    C[i][0] = C[i][i] = 1;\n    for (int j = 1; j < i; ++j) {\n      C[i][j] = (C[i - 1][j - 1] + C[i - 1][j]) % p;\n    }\n  }\n  std::cout << (dp[1][1] = 1) << '\\n';\n  for (int n = 2; n <= N; ++n) {\n    for (int k = 1; k <= n; ++k) {\n      int l = (n + 1) / 2 - 1;\n      int r = n - 1 - l;\n      dp[n][k] = fac[n - 1];\n      for (int i = 1; i <= l; ++i) {\n        dp[n][k] += fac[r] * dp[l][i] % p * (n - k) % p * C[k - 1][i - 1] % p *\n                    C[n - k - 1][l - i] % p;\n      }\n      for (int i = 1; i <= r; ++i) {\n        dp[n][k] += fac[l] * dp[r][i] % p * (k - 1) % p * C[k - 2][i - 1] % p *\n                    C[n - k][r - i] % p;\n      }\n      std::cout << (dp[n][k] %= p) << ' ';\n    }\n    std::cout << '\\n';\n  }\n  return 0;\n}\n```\n\n## Solution 2. $O(n^3\\log n)$\n\n\u61d2\u5f97\u5361\u4e86\uff0c\u76f4\u63a5\u653e\u8fd9\u4e2a\u8fc7\u53bb\u4e86\u3002\n\n\u8003\u8651\u76f4\u63a5\u5bf9\u4e8e $n,k$ \u679a\u4e3e $k$ \u7684\u6392\u540d $i$\u3002\n\n\u90a3\u4e48\u53ef\u4ee5\u76f4\u63a5\u5bf9\u4e8e\u6392\u540d $i$ \u8fdb\u884c\u4e8c\u5206\u3002\u4f1a\u53d1\u73b0\uff0c\u8def\u4e0a\u4f1a\u7ecf\u8fc7\u4e00\u4e9b\u6570\uff0c\u8fd9\u4e9b\u6570\u4e00\u4e9b\u5fc5\u987b $>k$\uff0c\u4e00\u4e9b\u5fc5\u987b $<k$\u3002\u5bf9\u4e24\u4e2a\u90e8\u5206\u8fdb\u884c\u6392\u5217\uff0c\u6c42\u548c\u5c31\u53ef\u4ee5\u4e86\u3002\u663e\u7136\u590d\u6742\u5ea6\u4e3a $O(n^3\\log n)$\u3002\n\n## Code 2\n\n```cpp\n#include <iostream>\nusing ll = long long;\n\nll f[2009][2009];\nll C[2009][2009];\nll fac[2009];\nll A[2009][2009];\nll mod, N;\nint main() {\n  std::cin >> mod >> N;\n  fac[0] = 1;\n  C[0][0] = A[0][0] = 1;\n  for (int i = 1; i <= N; ++i) {\n    fac[i] = fac[i - 1] * i % mod;\n    C[i][0] = C[i][i] = 1;\n    for (int j = 1; j < i; ++j) {\n      C[i][j] = (C[i - 1][j - 1] + C[i - 1][j]) % mod;\n    }\n    for (int j = 0; j <= i; ++j) {\n      A[i][j] = (C[i][j] * fac[j]) % mod;\n    }\n  }\n  for (int n = 1; n <= N; ++n) {\n    for (int k = 1; k <= n; ++k) {\n      ll ans = 0;\n      for (int i = 1; i <= n; ++i) {\n        int lk = 0, gk = 0;\n        int l = 1, r = n;\n        while (l <= r) {\n          int mid = l + r >> 1;\n          if (i == mid) break;\n          if (i < mid) {\n            r = mid - 1;\n            ++gk;\n          } else {\n            l = mid + 1;\n            ++lk;\n          }\n        }\n        ans += (A[k - 1][lk] * A[n - k][gk] % mod * fac[n - 1 - lk - gk] % mod);\n        ans %= mod;\n      }\n      std::cout << ans << ' ';\n    }\n    std::cout << '\\n';\n  }\n  return 0;\n}\n```\n\n## Solution 3 $O(n^3)$\n\n\u8fd9\u9898\u597d\u591a\u89e3\u554a\uff01\n\n\u8003\u8651\u548c Solution 2 \u540c\u6837\u7684\u601d\u8def\u3002\u4f1a\u53d1\u73b0\uff0c\u5bf9\u4e8e\u540c\u6837\u7684 $n,i$\uff0c\u9700\u8981 $>k$ \u548c $<k$ \u7684\u4e2a\u6570\u5206\u522b\u662f\u4e00\u6837\u7684\u3002\u90a3\u4e48\u5c31\u5148\u679a\u4e3e $n,i$\uff0c\u5728 $\\log n$ \u7684\u65f6\u95f4\u5185\u6c42\u51fa\u4e24\u4e2a\u5206\u522b\u7684\u6570\u91cf\uff0c\u518d\u679a\u4e3e $k$ \u5728 $f_{n,k}$ \u6253\u6807\u8bb0\u5c31\u505a\u5b8c\u4e86\u3002\u56e0\u4e3a\u628a $\\log n$ \u62c9\u5230\u679a\u4e3e $k$ \u5916\u9762\u4e86\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u4e3a $O(n^2(\\log n+n))=O(n^3)$\u3002\n\n## Code 3\n\n```cpp\n#include <iostream>\nusing ll = long long;\n\nll f[2009][2009];\nll C[2009][2009];\nll fac[2009];\nll A[2009][2009];\nll mod, N;\nint main() {\n  std::cin >> mod >> N;\n  fac[0] = 1;\n  C[0][0] = A[0][0] = 1;\n  for (int i = 1; i <= N; ++i) {\n    fac[i] = fac[i - 1] * i % mod;\n    C[i][0] = C[i][i] = 1;\n    for (int j = 1; j < i; ++j) {\n      C[i][j] = (C[i - 1][j - 1] + C[i - 1][j]) % mod;\n    }\n    for (int j = 0; j <= i; ++j) {\n      A[i][j] = (C[i][j] * fac[j]) % mod;\n    }\n  }\n  for (int n = 1; n <= N; ++n) {\n    for (int i = 1; i <= n; ++i) {\n      int lk = 0, gk = 0;\n      int l = 1, r = n;\n      while (l <= r) {\n        int mid = l + r >> 1;\n        if (i == mid) break;\n        if (i < mid) {\n          r = mid - 1;\n          ++gk;\n        }\n        else {\n          l = mid + 1;\n          ++lk;\n        }\n      }\n      for (int k = 1; k <= n; ++k) {\n        f[n][k] += (A[k - 1][lk] * A[n - k][gk] % mod * fac[n - 1 - lk - gk] % mod);\n        f[n][k] %= mod;\n      }\n    }    \n  }\n  for (int n = 1; n <= N; ++n) {\n    for (int k = 1; k <= n; ++k) {\n      std::cout << f[n][k] << ' ';\n    }\n    std::cout << '\\n';\n  }\n  return 0;\n}\n```",
        "postTime": 1668856936,
        "uid": 306090,
        "name": "0x3b800001",
        "ccfLevel": 5,
        "title": "yadiw. Slua, gassp, lhtubs. \u9898\u89e3"
    }
]