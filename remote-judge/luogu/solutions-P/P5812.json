[
    {
        "content": "\u5410\u69fd\uff1a\u6211\u5728\u7f51\u4e0a\u80fd\u627e\u5230\u7684\u6240\u6709\u9898\u89e3\uff0c\u8981\u4e48\u5bf9\u5173\u952e\u6027\u8d28\u7684\u9610\u8ff0\u8fc7\u4e8e\u7b80\u6d01\uff0c\u8ba9\u6211\u8fd9\u4e2a\u4f4e\u6c34\u5e73\u9009\u624b\u770b\u5f97\u4e91\u91cc\u96fe\u91cc\uff1b\u8981\u4e48\u63a8\u5e7f\u5173\u952e\u6027\u8d28\u65f6\u7684\u8bf4\u660e\u8fc7\u5c11\uff0c\u6216\u662f\u7ed9\u51fa\u4e86\u5bf9\u60f3\u51fa\u6b63\u89e3\u6beb\u65e0\u5e2e\u52a9\u7684\u90e8\u5206\u5206\u6027\u8d28\uff0c\u8ba9\u9898\u89e3\u6709\u5931\u4e25\u8c28\u6027\u4e0e\u903b\u8f91\u6027\u3002\n\n\u9898\u76ee\u60f3\u8ba9\u6211\u4eec\u627e\u4e00\u6761\u6700\u77ed\u8def\u5f84\u3002\u867d\u7136\u8fd9\u5f20\u56fe\u662f\u5e73\u9762\u56fe\uff0c\u4f46\u6700\u77ed\u8def\u5f84\u4e0d\u514d\u9519\u7efc\u590d\u6742\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u786e\u5b9a\u57fa\u672c\u601d\u8def\uff1a\u5efa\u56fe\u8dd1 Dijkstra \u6700\u77ed\u8def\u3002\n\n\u539f\u56fe\u7684\u70b9\u6570\u53ef\u4ee5\u8fbe\u5230 $\\mathcal{O}(nm)$ \u7ea7\u522b\uff0c\u76f4\u63a5\u8dd1\u80af\u5b9a\u662f\u4e0d\u884c\u7684\uff0c\u6211\u4eec\u8003\u8651**\u7b80\u5316**\u8fd9\u5f20\u56fe\u3002\n\n\u6211\u4eec\u5148\u8003\u8651\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\uff1a\u4e0d\u5b58\u5728\u4e00\u5ea7\u5929\u6865 $[l_i,r_i]$\uff0c\u6ee1\u8db3 $l_i<s<r_i$ \u6216 $l_i<g<r_i$\uff08\u6ce8\u610f\u5168\u90e8\u662f\u4e25\u683c\u5c0f\u4e8e\uff09\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4efb\u610f\u4e00\u5ea7\u5929\u6865\u7684\u6a2a\u5750\u6807\u8303\u56f4\u65e2\u4e0d \u201c\u6a2a\u8de8\u201d \u8d77\u70b9\uff08\u7684\u6a2a\u5750\u6807\uff09\uff0c\u4e5f\u4e0d \u201c\u6a2a\u8de8\u201d \u7ec8\u70b9\uff08\u7684\u6a2a\u5750\u6807\uff09\u3002\n\n\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u6709\u4e00\u4e2a**\u5173\u952e\u6027\u8d28**\uff1a\n\n> **\u6027\u8d28**\u3000\u5b58\u5728\u4e00\u6761\u6700\u4f18\u8def\u5f84\uff0c\u6ee1\u8db3\uff1a\u82e5\u6211\u4eec\u81ea\u4e0b\u800c\u4e0a\u5730\u8fdb\u5165\u4e00\u5ea7\u5929\u6865\uff0c\u6216\u81ea\u4e0a\u800c\u4e0b\u5730\u79bb\u5f00\u4e00\u5ea7\u5929\u6865\uff0c\u90a3\u4e48\u8fdb\u5165\u70b9\uff08\u6216\u79bb\u5f00\u70b9\uff09\u4e00\u5b9a\u662f\u8fd9\u5ea7\u5929\u6865\u7684\u67d0\u4e2a\u7aef\u70b9\u3002\n\n> **\u6ce8 1**\u3000\u201c\u8fdb\u5165\u201d \u8868\u793a\u6211\u4eec\u4e4b\u524d\u4e0d\u5728\u8fd9\u5ea7\u5929\u6865\u4e0a\uff0c\u73b0\u5728\u5728\u8fd9\u5ea7\u5929\u6865\u4e0a\uff1b\u201c\u79bb\u5f00\u201d \u8868\u793a\u6211\u4eec\u4e4b\u524d\u5728\u8fd9\u5ea7\u5929\u6865\u4e0a\uff0c\u73b0\u5728\u4e0d\u5728\u8fd9\u5ea7\u5929\u6865\u4e0a\u3002\u4e0d\u5728\u8fd9\u5ea7\u5929\u6865\u4e0a\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u5728\u67d0\u680b\u5efa\u7b51\u4e0a\u4e0a\u4e0b\u79fb\u52a8\uff0c\u4e5f\u53ef\u80fd\u5728\u53e6\u4e00\u5ea7\u5929\u6865\u4e0a\u5de6\u53f3\u79fb\u52a8\u3002  \n> **\u6ce8 2**\u3000\u201c\u81ea\u4e0b\u800c\u4e0a\u5730\u8fdb\u5165\u201d \u8868\u793a\u6211\u4eec\u8fdb\u5165\u8fd9\u5ea7\u5929\u6865\u4e4b\u524d\uff0c\u6211\u4eec\u5728\u67d0\u680b\u5efa\u7b51\u4e0a\u5411\u4e0a\u79fb\u52a8\uff1b\u201c\u81ea\u4e0a\u800c\u4e0b\u5730\u79bb\u5f00\u201d \u8868\u793a\u6211\u4eec\u79bb\u5f00\u8fd9\u5ea7\u5929\u6865\u4e4b\u540e\uff0c\u6211\u4eec\u5728\u67d0\u680b\u5efa\u7b51\u4e0a\u5411\u4e0b\u79fb\u52a8\u3002  \n> **\u6ce8 3**\u3000\u8fdb\u5165\u70b9\u4e0e\u79bb\u5f00\u70b9\u90fd\u4e00\u5b9a\u5728\u67d0\u680b\u5efa\u7b51\u4e0a\u3002\n\n> **\u6ce8 4**\u3000\u5373\u4f7f\u8def\u5f84\u4e0e\u8fd9\u5ea7\u5929\u6865\u53ea\u6709\u4e00\u4e2a\u4ea4\u70b9\uff08\u516c\u5171\u70b9\uff09\uff0c\u6211\u4eec\u4e5f\u8ba4\u4e3a\u8fd9\u6761\u8def\u5f84 \u201c\u8fdb\u5165\u201d \u4e0e \u201c\u79bb\u5f00\u201d \u4e86\u8fd9\u5ea7\u5929\u6865\u5404\u4e00\u6b21\u3002\n\n\u6211\u4eec\u5148\u8bc1\u660e\u5176\u4e2d\u4e00\u79cd\u60c5\u51b5\u3002\u5047\u8bbe\u73b0\u5728\u6709\u4e00\u6761**\u6700\u4f18**\u8def\u5f84\uff0c\u5b83\u81ea\u4e0b\u800c\u4e0a\u5730\u8fdb\u5165\u4e86\u4e00\u5ea7\u5929\u6865 $[l_i,r_i]$\u3002\u5929\u6865 $i$ \u6ee1\u8db3 $s\\le l_i$\uff08\u8fd9\u91cc\u662f\u5c0f\u4e8e\u7b49\u4e8e\uff0c\u4e5f\u5c31\u662f\u5929\u6865 $i$ \u4f4d\u4e8e\u8d77\u70b9\u53f3\u65b9\uff09\uff0c\u4e14\u8fdb\u5165\u70b9\u4e0d\u662f\u5929\u6865 $i$ \u7684\u7aef\u70b9\u3002\n\n\u6709\u4e09\u79cd\u60c5\u51b5\uff1a\u8fdb\u5165\u5929\u6865 $i$ \u4e4b\u540e\uff0c\u79bb\u5f00\u5929\u6865 $i$ \u4e4b\u524d\uff0c\u6211\u4eec\n\n1. \u5411\u5de6\u79fb\u52a8\u4e86\u4e00\u6bb5\u8ddd\u79bb\uff08\u56fe $1$\uff09\uff1b\n2. \u5411\u53f3\u79fb\u52a8\u4e86\u4e00\u6bb5\u8ddd\u79bb\uff08\u56fe $2$\uff09\uff1b\n3. \u6ca1\u6709\u5de6\u53f3\u79fb\u52a8\uff08\u56fe $3$\uff09\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/bq6codcu.png)\n\n\u4ee5\u56fe $1$ \u7684\u60c5\u51b5\u4e3a\u4f8b\u3002\u5982\u56fe\uff0c$S$ \u4e3a\u8d77\u70b9\uff0c$AB$ \u4e3a\u8fdb\u5165\u5929\u6865 $i$ \u524d\u5411\u4e0a\u79fb\u52a8\u7684\u90a3\u4e00\u6bb5\uff0c$BC$ \u4e3a\u5728\u5929\u6865 $i$ \u4e0a\u7684\u79fb\u52a8\uff0c$D$ \u4e3a\u5929\u6865 $i$ \u7684\u53f3\u7aef\u70b9\u3002$B$ \u4e0d\u662f\u5929\u6865 $i$ \u7684\u7aef\u70b9\uff0c$C$ \u4e0d\u4e00\u5b9a\u662f\u5929\u6865 $i$ \u7684\u7aef\u70b9\u3002\u660e\u786e $x_S\\le x_C$\uff0c$AB>0$\uff0c$BC>0$\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/53how3i0.png)\n\n\u82e5\u8def\u5f84 $S\\rightarrow A$ \u7ecf\u8fc7\u4e86\u70b9 $C$ \u6240\u5728\u7684\u5efa\u7b51 $X$\uff0c\u4e0d\u59a8\u8bbe $S\\rightarrow A$ \u6700\u540e\u4e00\u6b21\u4f4d\u4e8e\u5efa\u7b51 $X$ \u4e0a\u65f6\u5728\u70b9 $E$ \u4e0a\uff0c\u5219 $E\\rightarrow C$ \u7684\u957f\u5ea6\u4e25\u683c\u5c0f\u4e8e $E\\rightarrow A\\rightarrow B\\rightarrow C$ \u7684\u957f\u5ea6\uff08\u56e0\u4e3a $BC>0$\uff09\uff0c\u66ff\u6362\u4e00\u4e0b\u4e00\u5b9a\u66f4\u4f18\u3002\u8fd9\u4e0e \u201c\u8fd9\u6761\u8def\u5f84\u662f\u6700\u4f18\u8def\u5f84\u201d \u77db\u76fe\u3002\n\n\u90a3\u4e48 $S\\rightarrow A$ \u6ca1\u6709\u7ecf\u8fc7\u5efa\u7b51 $X$\u3002\u8bbe $S\\rightarrow A$ **\u6700\u540e\u4e00\u6b21**\u4f4d\u4e8e\u6a2a\u5750\u6807 $x_C$ \u4e0a\u65f6\u5728\u70b9 $F$ \u4e0a\uff0c\u90a3\u4e48 $F\\rightarrow A$ \u7684\u8fc7\u7a0b\u4e2d**\u6a2a\u5750\u6807\u59cb\u7ec8 $\\ge x_C$**\u3002\n\n\u82e5 $F\\rightarrow A$ \u7ecf\u8fc7\u4e86\u7ebf\u6bb5 $CD$\uff0c\u4e0d\u59a8\u8bbe $F\\rightarrow A$ \u6700\u540e\u4e00\u6b21\u4f4d\u4e8e\u7ebf\u6bb5 $CD$ \u4e0a\u65f6\u5728\u70b9 $G$ \u4e0a\uff0c\u7531 $AB>0$ \u5f97 $G\\rightarrow B$ \u7684\u957f\u5ea6\u4e25\u683c\u5c0f\u4e8e $G\\rightarrow A\\rightarrow B$ \u7684\u957f\u5ea6\uff0c\u540c\u6837\u63a8\u51fa\u77db\u76fe\u3002\n\n\u90a3\u4e48 $F\\rightarrow A$ \u7ecf\u8fc7\u4e86\u7ebf\u6bb5 $CD$ \u7684\u5ef6\u957f\u7ebf\u3002\u8bbe\u70b9 $M$ \u4e3a\u70b9 $D$ \u6240\u5728\u7684\u5efa\u7b51\u7684\u5e95\u7aef\uff0c\u7531\u524d\u6587\u53ef\u5f97 $F\\rightarrow A$ \u7ecf\u8fc7\u4e86\u7ebf\u6bb5 $DM$\u3002\n\n\u8bbe $F\\rightarrow A$ \u6700\u540e\u4e00\u6b21\u4f4d\u4e8e\u7ebf\u6bb5 $DM$ \u4e0a\u65f6\u5728\u70b9 $H$ \u4e0a\uff0c\u90a3\u4e48 $H\\rightarrow D\\rightarrow B$ \u7684\u957f\u5ea6\u5c0f\u4e8e\u7b49\u4e8e $H\\rightarrow A\\rightarrow B$ \u7684\u957f\u5ea6\uff0c\u8981\u4e48\u63a8\u51fa\u77db\u76fe\uff0c\u8981\u4e48\u53ef\u4ee5\u628a $H\\rightarrow A\\rightarrow B$ \u8c03\u6574\u4e3a $H\\rightarrow D\\rightarrow B$ \u800c\u603b\u957f\u5ea6\u4e0d\u53d8\u3002\n\n\u6211\u4eec\u53d1\u73b0 $D$ \u662f\u5929\u6865 $i$ \u7684\u7aef\u70b9\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8def\u5f84\u8c03\u6574\u4e3a\uff1a\u81ea\u4e0b\u800c\u4e0a\u5730\u4ece\u5929\u6865 $i$ \u7684\u7aef\u70b9 $D$ \u8fdb\u5165\u5929\u6865 $i$\u3002\n\n\u5bf9\u4e8e\u56fe $2,3$ \u7684\u60c5\u51b5\uff0c\u8bc1\u660e\u4e0e\u6b64\u7c7b\u4f3c\u3002\u56fe $2$ \u53ef\u4ee5\u8c03\u6574\u4e3a\u4ece\u7aef\u70b9 $D$ \u8fdb\u5165\u5929\u6865 $i$\uff0c\u56fe $3$ \u53ef\u4ee5\u8c03\u6574\u4e3a\u4ece\u7aef\u70b9 $D$ \u6216\u7aef\u70b9 $E$ \u8fdb\u5165\u5929\u6865 $i$\u3002\n\n> **UPD**\u3000\u8fd9\u91cc\u6211\u60f3\u590d\u6742\u4e86\u3002\u8003\u8651\u5929\u6865\u4e0e\u5b83\u4e24\u7aef\u70b9\u6240\u5728\u7684\u5efa\u7b51\u6784\u6210\u4e86 \u201c\u5182\u201d \u5f62\uff0c\u800c\u8d77\u70b9\u6ca1\u6709\u88ab \u201c\u5182\u201d \u5f62\u5305\u4f4f\uff0c\u6240\u4ee5\u8def\u5f84\u5fc5\u7136\u7ecf\u8fc7\u4e86 \u201c\u5182\u201d \u5f62\uff0c\u53ea\u8981\u8ba8\u8bba\u8def\u5f84\u6700\u540e\u4e00\u6b21\u4f4d\u4e8e \u201c\u5182\u201d \u5f62\u4e0a\u65f6\u5728\u4e09\u6761\u7ebf\u6bb5\u4e2d\u7684\u54ea\u4e00\u6761\u4e0a\u5373\u53ef\u3002  \n\u4e24\u79cd\u8bc1\u6cd5\u672c\u8d28\u76f8\u540c\uff0c\u4f46\u8fd9\u79cd\u663e\u7136\u66f4\u7b80\u6d01\u3002\n\n\u540c\u7406\uff0c\u82e5\u5929\u6865 $i$ \u6ee1\u8db3 $r_i\\le s$\uff08\u5373\u5929\u6865 $i$ \u4f4d\u4e8e\u8d77\u70b9\u5de6\u65b9\uff09\uff0c\u4e5f\u53ef\u4ee5\u7c7b\u4f3c\u5730\u8c03\u6574\u3002\u5bf9\u4e8e \u201c\u81ea\u4e0a\u800c\u4e0b\u5730\u79bb\u5f00\u201d \u7684\u60c5\u51b5\uff0c\u8ba8\u8bba\u5929\u6865 $i$ \u4e0e\u7ec8\u70b9 $g$ \u7684\u4f4d\u7f6e\u5173\u7cfb\uff0c\u7528\u5bf9\u79f0\u7684\u65b9\u6cd5\u8bc1\u660e\u5373\u53ef\u3002\n\n\u5230\u8fd9\u91cc\u6211\u4eec\u5df2\u7ecf\u8bc1\u660e\u4e86\uff0c\u5bf9\u4e8e\u4e00\u5ea7**\u7279\u5b9a\u7684**\u5929\u6865 $i$\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8def\u5f84\u8c03\u6574\u4e3a\uff08\u5bf9\u5929\u6865 $i$ \u800c\u8a00\uff09\u6ee1\u8db3**\u5173\u952e\u6027\u8d28**\u7684\u72b6\u6001\u3002\u8003\u8651\u5bf9\u4e8e\u4e00\u6761\u6700\u4f18\u8def\u5f84\u4e0d\u65ad\u5730\uff08\u6bcf\u6b21\u9009\u62e9\u4e00\u5ea7\u5929\u6865\uff09\u8fdb\u884c\u8fd9\u6837\u7684\u8c03\u6574\uff0c\u82e5\u8c03\u6574\u80fd\u5728\u6709\u9650\u6b21\u5185\u7ed3\u675f\u5219\u6027\u8d28\u5f97\u8bc1\u3002\n\n\u7531\u524d\u6587\u7684\u8bc1\u660e\u53ef\u5f97\uff0c\u4e00\u6b21\u8c03\u6574\u7684\u8fc7\u7a0b\u4e00\u5b9a\u5f62\u5982\u4e0b\u56fe\uff1a\u82e5\u5bf9\u4e8e\u5929\u6865 $i$ \u8fdb\u884c\u8c03\u6574\uff0c\u6211\u4eec\u53ea\u4f1a\u6539\u53d8\u9ad8\u5ea6\u4e0d\u9ad8\u4e8e\u5929\u6865 $i$ \u7684\u4e00\u6bb5\u8def\u5f84\u3002\u6240\u4ee5\u6211\u4eec\u6bcf\u6b21\u9009\u62e9\u6700\u9ad8\u7684\u4e0d\u5408\u6cd5\u7684\u5929\u6865\u8c03\u6574\u5373\u53ef\uff0c\u8fd9\u6837\u6bcf\u5ea7\u5929\u6865\u6700\u591a\u88ab\u8c03\u6574\u4e00\u6b21\u3002\u4e8e\u662f\u6027\u8d28\u5f97\u8bc1\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/v2e5wffx.png)\n\n\u4e0a\u6587\u4e2d\u6211\u4eec\u8ba8\u8bba\u7684\u90fd\u662f \u201c\u4e0d\u5b58\u5728\u4e00\u5ea7\u5929\u6865 $[l_i,r_i]$ \u6ee1\u8db3 $l_i<s<r_i$ \u6216 $l_i<g<r_i$\u201d \u7684\u60c5\u51b5\u3002\u5bf9\u4e8e\u4e00\u822c\u60c5\u51b5\uff0c\u6211\u4eec\u5c1d\u8bd5\u8fdb\u884c\u4e00\u4e9b\u8c03\u6574\uff0c\u4f7f\u4e4b\u7b26\u5408\u6761\u4ef6\u3002\n\n\u82e5\u5929\u6865 $i$ \u6ee1\u8db3 $l_i<s<r_i$\uff0c\u6211\u4eec\u627e\u5230\u4e0e\u5929\u6865 $i$ \u6709\u4ea4\u7684\uff1a\u6a2a\u5750\u6807\u6700\u5927\u7684\u6ee1\u8db3 $X\\le s$ \u7684\u5efa\u7b51 $X$\uff0c\u548c\u6a2a\u5750\u6807\u6700\u5c0f\u7684\u6ee1\u8db3 $s\\le Y$ \u7684\u5efa\u7b51 $Y$\u3002\u6211\u4eec\u628a\u5929\u6865 $[l_i,r_i]$ \u62c6\u6210\u4e09\u6bb5\uff1a$[l_i,X]$\uff0c$[Y,r_i]$\uff0c$[X,Y]$\u3002\u524d\u4e24\u6bb5\u90fd\u6ca1\u6709 \u201c\u6a2a\u8de8\u201d \u8d77\u70b9 $s$\uff1b\u5bf9\u4e8e\u7b2c\u4e09\u6bb5\uff0c\u53ef\u4ee5\u53d1\u73b0\u5b83\u53ea\u4e0e\u5efa\u7b51 $X,Y$ \u6709\u4ea4\uff0c\u4e5f\u5c31\u662f\u53ea\u80fd\u901a\u8fc7\u4e24\u4e2a\u7aef\u70b9\u8fdb\u5165\u4e0e\u79bb\u5f00\u8fd9\u5ea7\u5929\u6865\uff0c\u6240\u4ee5\u5b83\u4e0d\u53ef\u80fd\u4ea7\u751f\u8fdd\u80cc**\u5173\u952e\u6027\u8d28**\u7684\u60c5\u51b5\u3002\n\n\u5bf9\u4e8e $l_i<g<r_i$ \u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u7c7b\u4f3c\u5730\u8fdb\u884c\u62c6\u5206\u3002\u4e0d\u65ad\u5730\u8fdb\u884c\u8fd9\u6837\u7684\u62c6\u5206\u5373\u53ef\uff0c\u5929\u6865\u7684\u603b\u6570\u4ecd\u4e3a $\\mathcal{O}(m)$ \u7ea7\u522b\u3002\n\n\u6709\u4e86\u8fd9\u4e2a**\u5173\u952e\u6027\u8d28**\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5bf9\u539f\u56fe\u8fdb\u884c\u7b80\u5316\u4e86\u3002\u5047\u8bbe\u6211\u4eec\u4ece\u5929\u6865 $i$ \u51fa\u53d1\u5411\u4e0b\u8d70\u5230\u5929\u6865 $j$\uff08\u6ca1\u6709\u62d0\u5f2f\uff0c\u4e0b\u540c\uff09\uff0c\u6216\u4ece\u5929\u6865 $j$ \u51fa\u53d1\u5411\u4e0a\u8d70\u5230\u5929\u6865 $i$\uff0c\u4e0d\u96be\u53d1\u73b0\uff0c\u8fd9\u4e00\u8fc7\u7a0b\u4e2d\u7ecf\u8fc7\u7684\u6240\u6709\u4f4d\u4e8e\u67d0\u5ea7\u5929\u6865\u4e0a\u7684\u70b9\uff0c\u9664\u5929\u6865 $j$ \u4e0a\u7684\u90a3\u4e2a\u70b9\u4ee5\u5916\uff0c\u90fd\u4e00\u5b9a\u662f\u67d0\u5ea7\u5929\u6865\u7684\u7aef\u70b9\u3002\u56e0\u6b64\u9664\u8d77\u70b9\u548c\u7ec8\u70b9\u5916\uff0c\u6211\u4eec**\u53ea\u9700\u4fdd\u7559\u6240\u6709\u5929\u6865\u7684\u7aef\u70b9\uff0c\u4ee5\u53ca\u6bcf\u4e2a\u7aef\u70b9\u4e0b\u65b9\u7b2c\u4e00\u4e2a\u4f4d\u4e8e\u67d0\u5ea7\u5929\u6865\u4e0a\u7684\u70b9\u5373\u53ef**\u3002\n\n\u8fd9\u6837\u70b9\u6570\u548c\u8fb9\u6570\u90fd\u88ab\u7f29\u51cf\u5230\u4e86 $\\mathcal{O}(m)$ \u7ea7\u522b\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e00\u4e2a $\\log$\u3002\n\n\u5982\u679c\u8981\u95ee\u8fd9\u4e2a**\u5173\u952e\u6027\u8d28**\u662f\u600e\u4e48\u60f3\u5230\u7684\uff0c\u6309\u6211\u7684\u7406\u89e3\uff0c\u5927\u6982\u662f\u5bf9\u7740 $s=0$\uff0c$g=n-1$ \u7684\u90e8\u5206\u5206\u753b\u753b\u56fe\u627e\u627e\u89c4\u5f8b\uff0c\u518d\u63a8\u5e7f\u5230\u4e00\u822c\u60c5\u51b5\u5427\u3002\n\n\u4ee3\u7801\u5199\u5f97\u5f88\u4e11\uff0c\u4ec5\u4f9b\u53c2\u8003\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define eb emplace_back\n#define ls u<<1\n#define rs u<<1|1\n#define fi first\n#define se second\nusing namespace std;\ntypedef long long ll;\ntypedef pair<int,int> pii;\ntypedef pair<ll,int> pli;\nint n,m,M,S,G,t=1,L,R,x[100005],h[100005],p[100005];\nint l[100005],r[100005],y[100005],z[100005];\nint ti[400005],a[200015],b[200015],cnt,bg,ed,tot;\nvector<pii> vec[100005],e[1200005];\nset<int> s;\nset<int>::iterator it;\nmap<int,int> mp[100005];\npriority_queue<pli,vector<pli>,greater<pli> > q;\nll dis[1200005];\ninline pii calc(int x,pii u,vector<pii> &V){\n\tit=s.lower_bound(x),R=*it;\n\tL=*(R^x?--it:it);\n\tV.eb(pii(u.fi,L)),V.eb(pii(R,u.se));\n\tu.fi=L,u.se=R;\n\treturn u;\n}\nvoid cover(int u,int l,int r,int x,int y,int z){\n\tif(x<=l && r<=y)return ti[u]=z,void();\n\tint mid=(l+r)>>1;\n\tif(x<=mid)cover(ls,l,mid,x,y,z);\n\tif(y>mid)cover(rs,mid+1,r,x,y,z);\n}\nint que(int u,int l,int r,int x){\n\tif(l==r)return ti[u];\n\tint mid=(l+r)>>1;\n\tif(x<=mid)return max(ti[u],que(ls,l,mid,x));\n\treturn max(ti[u],que(rs,mid+1,r,x));\n}\ninline int id(int x,int y){\n\tif(mp[y].count(x))return mp[y][x];\n\treturn mp[y][x]=++tot;\n}\ninline void ins(int u,int v,int w){\n\te[u].eb(pii(v,w));\n\te[v].eb(pii(u,w));\n}\ninline void work(int k){\n\tcnt=0;\n\tfor(auto u:vec[k])\n\t\ta[++cnt]=u.fi,a[++cnt]=u.se;\n\tsort(a+1,a+1+cnt);\n\tcnt=unique(a+1,a+1+cnt)-a-1;\n\tfor(int i=1,u,v;i<=cnt;++i){\n\t\tu=id(a[i],k);\n\t\tif((v=que(1,1,n,a[i]))==-1)continue;\n\t\tins(u,id(a[i],v),z[k]-z[v]);\n\t}\n\tfor(auto u:vec[k])\n\t\tcover(1,1,n,u.fi,u.se,k);\n}\ninline void work2(int k){\n\tcnt=0,t=1;\n\tfor(auto u:mp[k])\n\t\ta[++cnt]=u.fi,b[cnt]=u.se;\n\tsort(vec[k].begin(),vec[k].end());\n\tfor(auto u:vec[k]){\n\t\twhile(t<=cnt && a[t]<u.fi)++t;\n\t\twhile(t<cnt && a[t+1]<=u.se)\n\t\t\tins(b[t],b[t+1],x[a[t+1]]-x[a[t]]),++t;\n\t}\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;++i){\n\t\tscanf(\"%d%d\",x+i,h+i);\n\t\ts.insert(i),p[i]=i;\n\t}\n\tsort(p+1,p+1+n,[](int X,int Y){\n\t\treturn h[X]<h[Y];\n\t});\n\tfor(int i=1;i<=m;++i){\n\t\tscanf(\"%d%d%d\",l+i,r+i,y+i);\n\t\t++l[i],++r[i],z[i]=y[i];\n\t}\n\tsort(z+1,z+1+m);\n\tM=unique(z+1,z+1+m)-z-1;\n\tfor(int i=1;i<=m;++i){\n\t\ty[i]=lower_bound(z+1,z+1+M,y[i])-z;\n\t\tvec[y[i]].eb(l[i],r[i]);\n\t}\n\tscanf(\"%d%d\",&S,&G),++S,++G;\n\tif(S>G)swap(S,G);\n\tfor(int i=1;i<=n*4;++i)ti[i]=-1;\n\tbg=id(S,0),cover(1,1,n,S,S,0);\n\ted=id(G,0),cover(1,1,n,G,G,0);\n\tfor(int k=1;k<=M;++k){\n\t\twhile(t<=n && h[p[t]]<z[k])s.erase(p[t++]);\n\t\tfor(int i=0;i<(int)vec[k].size();++i){\n\t\t\tpii u=vec[k][i];\n\t\t\tif(u.fi<S && S<u.se)\n\t\t\t\tvec[k][i]=calc(S,u,vec[k]);\n\t\t\telse if(u.fi<G && G<u.se)\n\t\t\t\tvec[k][i]=calc(G,u,vec[k]);\n\t\t}\n\t\twork(k);\n\t}\n\tfor(int i=1;i<=M;++i)work2(i);\n\tfor(int i=1;i<=tot;++i)dis[i]=2e18;\n\tdis[bg]=0,q.push(pli(0,bg));\n\twhile(!q.empty()){\n\t\tpli t=q.top();q.pop();\n\t\tint u=t.se;\n\t\tif(dis[u]<t.fi)continue;\n\t\tdis[u]=t.fi;\n\t\tfor(auto v:e[u]){\n\t\t\tif(dis[v.fi]<=dis[u]+v.se)continue;\n\t\t\tdis[v.fi]=dis[u]+v.se;\n\t\t\tq.push(pli(dis[v.fi],v.fi));\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",dis[ed]<1e18?dis[ed]:-1);\n\treturn 0;\n}\n```\n",
        "postTime": 1661936137,
        "uid": 154520,
        "name": "chen_03",
        "ccfLevel": 9,
        "title": "P5812 [IOI2019] \u5929\u6865 \u9898\u89e3"
    },
    {
        "content": "\u90e8\u5206\u5206\u5f88\u6709\u542f\u793a\u6027\u3002\n\n\u9996\u5148\uff0c\u8fd9\u4e00\u770b\u5c31\u5e94\u8be5\u662f\u4e00\u4e2a**\u6700\u77ed\u8def**\u95ee\u9898\uff0c\u56e0\u4e3a\u6211\u4eec\u4e5f\u6ca1\u6709\u5f88\u597d\u7684\u65b9\u6cd5\u53bb\u5904\u7406\u8fd9\u79cd\u8def\u5f84\u5de6\u53f3\u5927\u5e45\u5ea6\u62bd\u6410\u7684\u4e1c\u897f\uff0c\u6700\u597d\u7684\u529e\u6cd5\u4fbf\u662f\u5efa\u51fa\u56fe\u6765\u7136\u540e\u8dd1\u6700\u77ed\u8def\u3002\n\n\u9996\u5148\u8003\u8651$n,m\\leq50$\u7684\u66b4\u529b\u5206\u3002\u5b83\u7ed9\u6211\u4eec\u7684\u542f\u793a\u4fbf\u662f\u627e\u51fa\u6240\u6709\u5929\u6865\u4e0e\u697c\u623f\u7684\u4ea4\u70b9\uff0c\u7136\u540e\u5efa\u56fe\u8dd1Dijkstra\u3002\u660e\u663e\u8fd9\u4e2a\u4ea4\u70b9\u6570\u662f$O(nm)$\u7ea7\u522b\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u6863\uff0c\u4ee5\u53ca\u4e0b\u9762\u7684\u201c\u4e0e\u5341\u680b\u5efa\u7b51\u76f8\u4ea4\u201d\u7684\u90e8\u5206\u5206\u3002\n\n\u7136\u540e\u662f$S$\u5728\u6700\u5de6\u8fb9\uff0c$T$\u5728\u6700\u53f3\u8fb9\u7684\u90e8\u5206\u5206\u3002\u663e\u7136\uff0c\u5728\u8fd9\u6863\u90e8\u5206\u5206\u4e2d\uff0c\u6700\u4f18\u8def\u5f84**\u4e0d\u4f1a\u6709\u6298\u8fd4**\u2014\u2014\n\n\u8003\u8651\u5e38\u89c1\u7684\u6298\u8fd4\u5b83\u5e94\u8be5\u957f\u8fd9\u6837\uff08\u84dd\u7ebf\uff09\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/hanmf3ng.png)\n\n\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u5411\u5411\u7ea2\u697c\u623f\u7684\u62d0\u5f2f\u5b9e\u9645\u4e0a\u662f\u53ef\u4ee5\u907f\u514d\u7684\u2014\u2014\u56e0\u4e3a\u7eff\u697c\u623f\u5b9e\u9645\u4e0a\u662f\u4e0e\u4e0b\u9762\u5929\u6865\u76f8\u4ea4\u7684\uff08\u865a\u7ebf\u90e8\u5206\uff09\uff0c\u56e0\u6b64\u76f4\u63a5\u5c31\u4ece\u7eff\u697c\u623f\u4e0a\u53bb\u4e86\u3002\n\n\u56e0\u6b64\u6211\u4eec\u5c31\u77e5\u9053\u4e86\u6700\u4f18\u8def\u5f84\u4e00\u5b9a\u662f\u4e00\u8def\u5411\u53f3\u7684\u3002\u901a\u8fc7\u8fd9\u4e2a\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u8bc1\u51fa\u4e00\u4e2a\u66f4\u5f3a\u7684\u6027\u8d28\uff1a\u4f60\u767b\u4e0a\u4e00\u5ea7\u5929\u6865\uff0c\u4ece\u5de6\u7aef\u8d77\u70b9\u4e0a\u53bb\u4e00\u5b9a\u4e0d\u4f1a\u66f4\u52a3\u3002\n\n\u6211\u4eec\u8003\u8651\u8fd9\u6837\u4e00\u4e2a\u4f8b\u5b50\uff08\u68d5\u8272\u4e3a\u8def\u5f84\uff09\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/l2bwte9m.png)\n\n\u5728\u8fd9\u5f20\u56fe\u4e2d\uff0c\u68d5\u8272\u8def\u5f84\u5e76\u6ca1\u6709\u4ece\u9ec4\u5929\u6865\u5f00\u59cb\u7684\u5730\u65b9\u5c31\u4e0a\u53bb\u2014\u2014\u4f46\u662f\u4e00\u5f00\u59cb\u5c31\u4e0a\u53bb\u660e\u663e\u662f\u53ef\u4ee5\u7684\uff0c\u5e76\u4e14\u6211\u4eec\u89c2\u5bdf\u4e00\u4e0b\u5c31\u4f1a\u53d1\u73b0\u4e00\u5f00\u59cb\u5c31\u4e0a\u53bb\u7684\u8def\u5f84\u957f\u5ea6**\u5fc5\u5b9a\u4e0d\u52a3\u4e8e**\u78e8\u8e6d\u4e00\u4f1a\u5728\u4e0a\u53bb\u7684\u8def\u5f84\u957f\u5ea6\u2014\u2014\u6bd5\u7adf\u4f60\u591a\u78e8\u8e6d\u4e00\u4f1a\uff0c\u5c31\u6709\u53ef\u80fd\u7ecf\u5386\u66f4\u591a\u7684\u4e0a\u4e0a\u4e0b\u4e0b\uff0c\u800c\u76f4\u63a5\u4e0a\u53bb\u5fc5\u7136\u4e0d\u4f1a\u7ecf\u5386\u4efb\u4f55\u4e0a\u4e0a\u4e0b\u4e0b\u3002\n\n\u56e0\u6b64\u6211\u4eec\u4fbf\u53ef\u4ee5\u53ea\u4fdd\u7559\u6240\u6709\u5929\u6865\u7684\u8d77\u70b9\u7ec8\u70b9\uff08\u6211\u4eec\u79f0\u4e4b\u4e3a**\u5173\u952e\u70b9**\uff09\uff0c\u4ee5\u53ca\u6240\u6709\u5173\u952e\u70b9\u6240\u5728\u7684\u5efa\u7b51**\u518d\u5f80\u4e0b\u7684\u4e00\u4e2a\u4ea4\u70b9**\u3002\u8fd9\u4e2a\u4ea4\u70b9\u662f\u4e3a\u4e86\u65b9\u4fbf\u4e0a\u6865\u800c\u5fc5\u987b\u8bbe\u7acb\u7684\u3002\n\n\u5177\u4f53\u505a\u6cd5\u53ef\u4ee5\u7528```set```\u6216```map```\u5565\u7684\u7ef4\u62a4\u73b0\u5728\u4ecd\u672a\u7ed3\u675f\u7684\u5929\u6865\uff0c\u6309\u7167$x$\u5750\u6807\u9012\u589e\u7684\u987a\u5e8f\u679a\u4e3e\u697c\u623f\uff0c\u8fdb\u884c\u5efa\u56fe\u3002\u5efa\u5b8c\u8dd1Dijkstra\u5373\u53ef\u3002\n\n~~\u8fd9\u4e9b\u5168\u90e8\u5199\u5b8c\uff0c\u4f60\u5c31\u53ef\u4ee5\u5728IOI2019\u4e2d\u635e\u523057\u5206\u4e86\uff0c\u60ca\u4e0d\u60ca\u559c\uff0c\u5f00\u4e0d\u5f00\u5fc3~~\n\n100\u5206\u5b9e\u9645\u4e0a\u5c31\u662f\u521a\u624d\u7684\u7279\u4f8b\u7684\u63a8\u5e7f\u2014\u2014\n\n\u6211\u4eec\u8003\u8651\u4e00\u6761\u4ece$s$\u5230$t$\u7684\u5929\u6865\uff0c\u5982\u679c\u8d77\u70b9\u662f$S$\uff0c\u7ec8\u70b9\u662f$T$\u7684\u8bdd\uff0c\u5b83\u4eec\u4f1a\u6709\u4ec0\u4e48\u4e92\u52a8\u2014\u2014\n\n1. $[s,t]\\subseteq[S,T]$\uff0c\u540c\u4e0a\u9762\u7279\u4f8b\u65e0\u533a\u522b\u3002\n\n2. $[S,T]\\subseteq[s,t]$\u3002\u663e\u7136\u8fd9\u65f6\u5019\u6709\u53ef\u80fd\u6298\u8fd4\uff0c\u4f46\u662f\u51ed\u76f4\u89c9\u53d1\u73b0\u6298\u8fd4\u4e0d\u53ef\u80fd\u6298\u7684\u592a\u8fdc\uff0c\u6700\u591a\u6298\u5230\u7b2c\u4e00\u4e2a\u53ef\u4ee5\u4e0a\u53bb\u7684\u70b9\u5c31\u4e0a\u53bb\u4e86\uff0c\u800c\u8fd9\u4e2a\u70b9\u662f\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6765\u7684\u3002\u663e\u7136$S$\u65b9\u5411\u4e0e$T$\u65b9\u5411\u5404\u6700\u591a\u53ea\u6709\u4e00\u4e2a\uff0c\u4e8e\u662f\u6211\u4eec\u628a\u5b83\u5728\u53ef\u4ee5\u4e0a\u53bb\u7684\u70b9\u6298\u4e3a\u4e09\u622a\u5373\u53ef\u3002\n\n\u8fd9\u4e2a\u53ef\u4ee5\u770b\u56fe\u7406\u89e3\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/sd4thhuf.png)\n\n\u6298\u4e3a\u4e09\u622a\u4e4b\u540e\uff0c\u5c31\u8fd8\u50cf\u4e0a\u4e00\u95ee\u4e00\u6837\u5efa\u56fe\u8dd1\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n\\log n)$\u3002\u5047\u5982\u4f60\u50cf\u6211\u4e00\u6837\u7528\u4e86\u5e03\u6ee1\u6574\u4e2a\u7a0b\u5e8f\u7684STL\uff08```set```\u3001```map```\u3001```vector```\u3001```priority_queue```\u6211\u90fd\u7528\u4e86\uff09\u7684\u8bdd\uff0c\u662f\u5f88\u5bb9\u6613TLE\u7684\u3002\u4ea4\u7684\u65f6\u5019\u968f\u624b\u5f00\u4e86O2\uff0c\u4e0d\u5f00\u4e0d\u77e5\u9053\u80fd\u4e0d\u80fd\u8fc7\uff08\u5927\u6982\u4e0d\u884c\n\n\u4ee3\u7801:\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define pii pair<int,int>\n#define DIS(x) sort(x.begin(),x.end()),x.resize(unique(x.begin(),x.end())-x.begin())\ntypedef long long ll;\nconst int N=4001000;\nint n,m,S,T,tot,ord[N];\npii p[N];//buildings\nstruct walk{\n\tint l,r,h;\n\tfriend bool operator<(const walk &x,const walk &y){\n\t\treturn x.h>y.h;\n\t}\n\twalk(){}\n\twalk(int A,int B,int C){l=A,r=B,h=C;}\n}w[N];\nbool cmp(const int&x,const int&y){\n\treturn p[x].second>p[y].second;\n}\nset<int>s;\nvector<int>st[N],ed[N],rel[N];\nint sum[N];\n//--------------Dijkstra--------------\nint head[N],cnt;\nll dis[N];\nstruct node{\n\tint to,next,val;\n}edge[N];\nvoid ae(int u,int v,int w){\n//\tprintf(\"%d %d %d\\n\",u,v,w);\n\tedge[cnt].next=head[u],edge[cnt].to=v,edge[cnt].val=w,head[u]=cnt++;\n\tedge[cnt].next=head[v],edge[cnt].to=u,edge[cnt].val=w,head[v]=cnt++;\n}\npriority_queue<pair<ll,int> >q;\nbool vis[N];\nll Dijkstra(){\n\tq.push(make_pair(0ll,S)),memset(dis,0x3f,sizeof(dis)),dis[S]=0;\n\twhile(!q.empty()){\n\t\tint x=q.top().second;q.pop();\n\t\tif(vis[x])continue;vis[x]=true;\n\t\tfor(int i=head[x];i!=-1;i=edge[i].next)if(dis[edge[i].to]>dis[x]+edge[i].val)dis[edge[i].to]=dis[x]+edge[i].val,q.push(make_pair(-dis[edge[i].to],edge[i].to));\n\t}\n\treturn dis[T]==0x3f3f3f3f3f3f3f3f?-1:dis[T];\n}\nmap<int,int>mp;\nint main(){\n\tscanf(\"%d%d\",&n,&m),tot=m,memset(head,-1,sizeof(head));\n\tfor(int i=1;i<=n;i++)scanf(\"%d%d\",&p[i].first,&p[i].second),ord[i]=i;\n\tfor(int i=1;i<=m;i++)scanf(\"%d%d%d\",&w[i].l,&w[i].r,&w[i].h),w[i].l++,w[i].r++;\n\tsort(w+1,w+m+1),sort(ord+1,ord+n+1,cmp);\n\tscanf(\"%d%d\",&S,&T),S++,T++;\n\tif(S>T)swap(S,T);\n\tfor(int i=1,j=1;i<=m;i++){\n\t\twhile(j<=n&&p[ord[j]].second>=w[i].h)s.insert(ord[j++]);\n\t\tvector<int>v={w[i].l,w[i].r};\n\t\tif(w[i].l<S&&w[i].r>S){\n\t\t\tauto it=s.lower_bound(S);\n\t\t\tint B=*it,A=*--it;\n\t\t\tif(B<=min(T,w[i].r))v.push_back(B);\n\t\t\telse if(A>=w[i].l)v.push_back(A);\n\t\t}\n\t\tif(w[i].l<T&&w[i].r>T){\n\t\t\tauto it=s.upper_bound(T);\n\t\t\tint B=*it,A=*--it;\n\t\t\tif(A>=max(S,w[i].l))v.push_back(A);\n\t\t\telse if(B<=w[i].r)v.push_back(B);\n\t\t}\n\t\tDIS(v);\n\t\tw[i]=walk(v[0],v[1],w[i].h);\n\t\tfor(int k=2;k<v.size();k++)w[++tot]=walk(v[k-1],v[k],w[i].h);\n\t}\n\ts.clear(),s.insert(0);\n\tfor(int i=1;i<=tot;i++)st[w[i].l].push_back(w[i].h),ed[w[i].r].push_back(w[i].h);\n//\tfor(int i=1;i<=tot;i++)printf(\"[%d,%d]:%d\\n\",w[i].l-1,w[i].r-1,w[i].h);\n\tfor(int i=1;i<=n;i++){\n\t\tfor(auto j:ed[i])s.erase(j);\n//\t\tprintf(\"%d:::::\\n\",i);\n//\t\tfor(auto j:s)printf(\"%d \",j);puts(\"\");\n\t\tvector<int>v;\n\t\tv.push_back(0);\n\t\tfor(auto j:st[i])v.push_back(j);\n\t\tfor(auto j:ed[i])v.push_back(j);\n\t\tDIS(v);\n\t\trel[i]=v;\n\t\tfor(int j=1;j<v.size();j++)rel[i].push_back(*--s.lower_bound(v[j]));\n\t\tDIS(rel[i]);\n//\t\tfor(auto j:rel[i])printf(\"%d \",j);puts(\"\");\n\t\tfor(int j=1;j<rel[i].size();j++)ae(sum[i]+j+1,sum[i]+j,rel[i][j]-rel[i][j-1]);\n\t\tsum[i+1]=sum[i]+rel[i].size();\n\t\tfor(int j=0;j<rel[i].size();j++){\n\t\t\tif(mp.find(rel[i][j])==mp.end())continue;\n\t\t\tint U=mp[rel[i][j]],V=i;\n\t\t\tint A=sum[U]+lower_bound(rel[U].begin(),rel[U].end(),rel[i][j])-rel[U].begin()+1;\n\t\t\tint B=sum[V]+j+1;\n\t\t\tae(A,B,p[V].first-p[U].first);\n\t\t\tmp[rel[i][j]]=i;\n\t\t}\n\t\tfor(auto j:ed[i])mp.erase(j);\n\t\tfor(auto j:st[i])s.insert(j),mp[j]=i;\n\t}\n\tS=sum[S]+1,T=sum[T]+1;\n\tprintf(\"%lld\\n\",Dijkstra());\n\treturn 0;\n}\n```\n",
        "postTime": 1596466939,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5812 \u3010[IOI2019]\u5929\u6865\u3011"
    }
]