[
    {
        "content": "\u51fa\u9898\u4eba\u9898\u89e3\u3002\n\n----\n\n\u62bd\u8c61\u84dd\u7ea2\u661f\u95f4\u5173\u7cfb\u4e3a\u4e8c\u7ef4\u504f\u5e8f\u3002\u7136\u800c\u65e0\u6cd5\u4f7f\u7528\u4e8c\u7ef4\u7ebf\u6bb5\u6811\u7ef4\u62a4\u6811\u4e0a\u5173\u7cfb\uff0c\u56e0\u6b64\u8003\u8651\u5c06\u6811\u4e0a\u7236\u5b50\u5173\u7cfb\u62bd\u8c61\u6210\u504f\u5e8f\u5173\u7cfb\u3002\n\n\u9996\u5148\u628a\u6811\u4f7f\u7528\u6b27\u62c9\u5e8f\u62cd\u6210\u5e8f\u5217\u3002\u7136\u540e\u7236\u5b50\u5173\u7cfb\u5c31\u88ab\u8f6c\u6362\u6210\u4e86\u5e8f\u5217\u5185\u90e8\u7684\u5305\u542b\u5173\u7cfb\u3002\u8bbe\u8282\u70b9\u7684\u6b27\u62c9\u5e8f\u4e3a $[p,t]$\uff0c\u503c\u4e3a $(a,b)$\u3002\u6211\u4eec\u53ef\u4ee5\u5c06\u539f\u95ee\u9898\u7684\u5173\u7cfb\u8f6c\u5316\u6210\u504f\u5e8f\u5173\u7cfb $a_i \\le a_j \\ \\land \\ b_i \\le b_j \\ \\land \\ p_j< p_i \\le t_i \\le t_j $\u3002\u4f7f\u7528 cdq \u504f\u5e8f\u6c42\u89e3\u5373\u53ef\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u4f7f\u7528\u51fa\u8282\u70b9\u4e0d `++ stp` \u7684 dfn \u5e8f\u65f6\u5e94\u4f7f\u7528\u504f\u5e8f $p_j< p_i$ \u800c\u4e0d\u662f $t_i \\le t_j$\uff0c\u4ee5\u907f\u514d\u51fa\u73b0 $t_i = t_j$ \u65f6\u65e0\u6cd5\u7b97\u5165\u8d21\u732e\u7684\u95ee\u9898\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nnamespace Fread  { const int SIZE = (1 << 18); char buf[SIZE], *p1 = buf, *p2 = buf; inline char getchar() {return (p1 == p2 && (p2 = (p1 = buf) + fread(buf, 1, SIZE, stdin), p1 == p2) ? EOF : *p1++);} }\nnamespace Fwrite { const int SIZE = (1 << 18); char buf[SIZE], *S = buf, *T = buf+SIZE; inline void flush(){ fwrite(buf, 1, S-buf, stdout), S = buf; }  struct NTR{ ~NTR() { flush(); } }ztr;inline void putchar(char c){ *S++ = c; if(S == T) flush(); } }\n#ifdef ONLINE_JUDGE\n    #define getchar Fread::getchar\n    #define putchar Fwrite::putchar\n#endif\nnamespace Fastio{\n    struct Reader{ template <typename T> Reader & operator >> (T & x) {char c = getchar(); bool f = false;while (c < '0' or c > '9') { if (c == '-') f = true;c = getchar();} x = 0;while(c >= '0' and c <= '9'){x = (x<<1)+(x<<3)+(c^48);c = getchar();} if (f) x = -x;return *this;}Reader&operator>>(char&c){ c=getchar();while(c=='\\n'||c==' '||c=='\\r')c=getchar();return *this;}Reader&operator>>(char*str){ int len=0;char c=getchar(); while(c=='\\n'||c==' '||c=='\\r')c=getchar(); while(c!='\\n'&&c!=' '&&c!='\\r')str[len++]=c,c=getchar(); str[len]='\\0'; return *this;}Reader & operator >> (float & x) {char c=getchar();short f=1,s=0;x=0;double t=0;while((c<'0'||c>'9')&&c!='.'){if(c=='-')f*=-1;c=getchar();}while(c>='0'&&c<='9'&&c!='.')x=x*10+(c^48),c=getchar();if(c=='.')c=getchar();else return x*=f,*this;while(c>='0'&&c<='9')t=t*10+(c^48),s++,c=getchar();while(s--)t/=10.0;x=(x+t)*f;return*this;}Reader & operator >> (double & x) {char c=getchar();short f=1,s=0;x=0;double t=0;while((c<'0'||c>'9')&&c!='.'){if(c=='-')f*=-1;c=getchar();}while(c>='0'&&c<='9'&&c!='.')x=x*10+(c^48),c=getchar();if(c=='.')c=getchar();else return x*=f,*this;while(c>='0'&&c<='9')t=t*10+(c^48),s++,c=getchar();while(s--)t/=10.0;x=(x+t)*f;return*this;}Reader&operator>>(long double&x){char c=getchar();short f=1,s=0;x=0;long double t=0;while((c<'0'||c>'9')&&c!='.'){if(c=='-')f*=-1;c=getchar();}while(c>='0'&&c<='9'&&c!='.')x=x*10+(c^48),c=getchar();if(c=='.')c=getchar();else return x*=f,*this;while(c>='0'&&c<='9')t=t*10+(c^48),s++,c=getchar();while(s--)t/=10.0;x=(x+t)*f;return*this;}Reader&operator>>(__float128&x){char c=getchar();short f=1,s=0;x=0;__float128 t=0;while((c<'0'||c>'9')&&c!='.'){if(c=='-')f*=-1;c=getchar();}while(c>='0'&&c<='9'&&c!='.')x=x*10+(c^48),c=getchar();if(c=='.') c = getchar();else return x*=f, *this;while(c>='0'&&c<='9')t=t*10+(c^48),s++,c=getchar();while(s--)t/=10.0;x=(x+t)*f;return *this;}Reader(){}}cin;\n    struct Writer{ template <typename T> Writer & operator << (T   x) {if(x == 0) return putchar('0'), *this;if(x < 0) putchar('-'), x = -x;static int sta[60], top = 0; while (x)  sta[++top] = x %10, x /= 10; while (top)  putchar(sta[top] + '0'), --top; return *this;} Writer&operator<<(char c){putchar(c);return*this;}Writer&operator<<(const char*str){int cur=0;while(str[cur])putchar(str[cur++]);return *this;} typedef unsigned long long mxdouble; int precision = 6; Writer set_precision(int val) { precision = val; return *this; }template <typename T> T deal_precision(T x) {__float128 tmp = x;for(int i=0;i<=precision;i++)tmp*=10;tmp+=5;for(int i=0;i<=precision;i++) tmp/=10;return (T)tmp;}Writer&operator<<(float x){if(x<0)putchar('-'),x=-x; x=deal_precision(x); mxdouble _=x;x-=(__float128)_;static int sta[60];int top=0;while(_)sta[++top]=_%10,_/=10;if(!top)putchar('0');while(top)putchar(sta[top]+'0'),--top;if(precision==0)return*this;putchar('.');for(int i=0;i<=precision;i++)x*=10;_=x;while(_)sta[++top]=_%10,_/=10;for(int i=0;i<precision-top;i++)putchar('0');while(top)putchar(sta[top]+'0'),--top;return*this;}Writer&operator<<(double x){if(x<0)putchar('-'),x=-x; x = deal_precision(x); mxdouble _=x;x-=(double)_;static int sta[60];int top=0;while(_)sta[++top]=_%10,_/=10;if(!top)putchar('0');while(top)putchar(sta[top]+'0'),--top;if(precision==0)return*this;putchar('.');for(int i=0;i<precision;i++)x*=10;_=x;while(_)sta[++top]=_%10,_/=10;for(int i=0;i<precision-top;i++)putchar('0');while(top)putchar(sta[top]+'0'),--top;return*this;}Writer&operator<<(long double x){if(x<0)putchar('-'),x=-x; x = deal_precision(x); mxdouble _=x;x-=(__float128)_;static int sta[60];int top=0;while(_)sta[++top]=_%10,_/=10;if(!top)putchar('0');while(top)putchar(sta[top]+'0'),--top;if(precision==0)return*this;putchar('.');for(int i=0;i<precision;i++)x*=10;_=x;while(_)sta[++top]=_%10,_/=10;for(int i=0;i<precision-top;i++)putchar('0');while(top)putchar(sta[top]+'0'),--top;return*this;}Writer&operator<<(__float128 x){if(x<0)putchar('-'),x=-x; x = deal_precision(x); mxdouble _=x;x-=(__float128)_;static int sta[60];int top=0;while(_)sta[++top]=_%10,_/=10;if(!top)putchar('0');while(top)putchar(sta[top]+'0'),--top;if(precision==0)return*this;putchar('.');for(int i=0;i<precision;i++)x*=10;_=x;while(_)sta[++top]=_%10,_/=10;for(int i=0;i<precision-top;i++)putchar('0');while(top)putchar(sta[top]+'0'),--top;return*this;}Writer(){}}cout; /* \u7cbe\u5ea6\u662f\u540e15\u4f4d nan\u4f1a\u4ee5\u201c9223372036854775808.9223372036854775808\u201d\u7684\u65b9\u5f0f\u8f93\u51fa */\n}   const char * enl = \"\\n\"; const char * sp = \" \";\n#define cin  Fastio :: cin\n#define cout Fastio :: cout\n#define N 400005\n#define rep(i,a,b) for ( register int (i) = (a); (i) ^ ((b)+1); ++(i) )\n#define pre(i,a,b) for ( register int (i) = (a); (i) ^ ((b)-1); --(i) )\nint n, ans[N];\n\nstruct ele {\n    int p, t, a, b, id;\n    bool operator < (const ele & k) const {\n        if (a != k.a) return a < k.a;\n        if (b != k.b) return b < k.b;\n        return p > k.p;\n    }\n} el[N], tmp[N];\n\nbool cmp(const ele & a, const ele & b) {\n    if (a.b != b.b) return a.b < b.b;\n    return a.p > b.p;\n}\n\n#define Aster(_src) for ( register int i = head[_src] ; i; i = e[i].next)\n#define v e[i].to\nint head[N], mlc;\nstruct star {\n    int next, to;\n}e[N<<1]; \ninline void adde(int f, int t) {\n    e[++mlc].to = t;\n    e[mlc].next = head[f];\n    head[f] = mlc;\n}\n\nint dfn[N], stp, end[N];\nvoid dfs(int u, int f) {\n    el[u].p = ++stp;\n    Aster(u) {\n        if (v == f) continue;\n        dfs(v, u);\n    } el[u].t = stp;\n}\n\nint Index[N];\ninline void add(int p, int val) {\n    while (p <= n) {\n        Index[p] += val;\n        p += p & -p;\n    }\n}\ninline int qry(int p) {\n    int ret = 0;\n    while (p) {\n        ret += Index[p];\n        p -= p & -p;\n    } return ret;\n}\n\n#define mid ((l + r) >> 1)\nvoid cdq(int l, int r) {\n    if(l == r) return;\n    cdq(l, mid), cdq(mid+1, r);\n    int i = l, j = mid+1;\n    while (j <= r) {\n        while (i <= mid and el[i].b <= el[j].b) {\n            add(el[i].p, 1);\n            i++;\n        } ans[el[j].id] += qry(el[j].t) - qry(el[j].p - 1);\n        j++;\n    } \n    rep(k,l,i-1) add(el[k].p, -1);\n    merge(el + l, el + mid + 1, el + mid + 1, el+r+1, tmp+l, cmp);\n    memcpy(el+l, tmp+l, sizeof(ele) * (r - l + 1));\n}\n\nint main() {\n    register int t1, t2;\n    cin >> n;\n    rep(i,2,n) cin >> t1 >> t2, adde(t1, t2), adde(t2, t1);\n    rep(i,1,n) {\n        cin >> el[i].a >> el[i].b;\n        el[i].id = i;\n    } dfs(1, 0);\n    sort(el+1, el+1+n);\n    // rep(i,1,n) cout << el[i].t << enl;\n    cdq(1, n);\n    rep(i,1,n) {\n        if (ans[i] != 0) cout << ans[i] << enl;\n    } return 0;\n}\n```",
        "postTime": 1665137243,
        "uid": 631791,
        "name": "joke3579",
        "ccfLevel": 0,
        "title": "P8575  \u661f\u4e4b\u6cb3 \u9898\u89e3"
    },
    {
        "content": "- \u6bd4\u8f83\u677f\u7684\u4e09\u7ef4\u504f\u5e8f\u3002\n\n- \u4e0d\u4f1a\u4e09\u7ef4\u504f\u5e8f\u7684\u53ef\u4ee5\u5148\u8f6c[\u8fd9\u513f](https://www.luogu.com.cn/problem/P3810)\n\n------------\n- \u9996\u5148\u62ff\u5230\u9898\uff0c\u4e0d\u96be\u53d1\u73b0\u5982\u679c\u7ed9\u5b9a\u7684\u4e0d\u662f\u4e00\u68f5\u6811\u800c\u662f\u5e8f\u5217\uff0c\u90a3\u5c31\u662f\u5b8c\u5168\u7684\u677f\u5b50\u9898\u3002\n\n- \u8003\u8651\u5982\u4f55\u5411\u539f\u95ee\u9898\u8f6c\u5316\uff1a\u5f53\u7136\u662f\u8981\u6309\u7167\u67d0\u4e2a\u201c\u5e8f\u201d\u5c06\u6811\u53d8\u6210\u5e8f\u5217\uff0c\u90a3\u600e\u4e48\u77e5\u9053\u5e94\u8be5\u6309\u7167\u4ec0\u4e48\u201c\u5e8f\u201d\u5462\uff1f\n\n- \u8ba9\u6211\u4eec\u56de\u5f52\u95ee\u9898\u672c\u8eab\uff0c\u9898\u76ee\u8981\u6c42\u7684\u662f\u6c42\u6bcf\u4e2a\u8282\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u5185\u7684\u4e8c\u7ef4\u504f\u5e8f\uff0c\u90a3\u8fd9\u4e2a\u201c\u5e8f\u201d\u5f53\u7136\u9700\u8981\u6ee1\u8db3\u540c\u4e00\u5b50\u6811\u5185\u7684\u8282\u70b9\u5728\u201c\u5e8f\u201d\u4e2d\u7f16\u53f7\u90fd\u5927\u4e8e/\u5c0f\u4e8e\u6839\u8282\u70b9\uff0c\u5bb9\u6613\u60f3\u5230 dfs \u5e8f\u5c31\u6ee1\u8db3\u6761\u4ef6\u3002\n\n- \u6309 dfs \u5e8f\u7ed9\u6bcf\u4e2a\u70b9\u7f16\u53f7\uff0c\u90a3\u9898\u76ee\u5c31\u8f6c\u5316\u4e3a\u5bf9\u6bcf\u4e2a\u70b9 $u$ \u6c42\u51fa\u6ee1\u8db3\u5982\u4e0b\u8981\u6c42\u7684\u70b9 $v$ \u7684\u4e2a\u6570\uff1a\n\n1. $red_v \\leq red_u$\n\n2. $blue_v \\leq blue_u$\n\n3. $dfn_u < dfn_v < dfn_u + sz_u$\n\n- \u8fd9\u65f6\u6216\u8bb8\u5c31\u6709\u4eba\u4f1a\u95ee\u4e86\uff0c\u8fd9\u4e0d\u662f\u56db\u7ef4\u504f\u5e8f\u5417\uff1f\n\n- \u8fd9\u8bdd\u6ca1\u6709\u9519\uff0c\u8fd9\u786e\u5b9e\u662f\u56db\u7ef4\u504f\u5e8f\uff0c\u4f46\u5374\u662f\u7279\u6b8a\u7684\u56db\u7ef4\u504f\u5e8f\uff1a\u67d0\u4e00\u4e2a\u6743\u503c\u88ab\u9650\u5236\u4e86\u4e24\u6b21\u3002\u800c\u5c31\u50cf\u7279\u6b8a\u7684\u4e09\u7ef4\u504f\u5e8f\u53ef\u4ee5\u7528\u4e8c\u7ef4\u504f\u5e8f\u89e3\u4e00\u6837\uff0c\u4f60\u4f1a\u53d1\u73b0\u8f6c\u5316\u4e4b\u540e\u7684\u95ee\u9898\u76f4\u63a5\u5957\u6a21\u677f\u6ca1\u6709\u4efb\u4f55\u95ee\u9898\uff0c\u53ea\u7528\u7a0d\u5fae\u6539\u4e00\u4e0b\u6811\u72b6\u6570\u7ec4\u7edf\u8ba1\u7b54\u6848\u7684\u90e8\u5206\u3002\n\n- \u90a3\u8fd9\u9053\u9898\u5c31\u7ed3\u675f\u4e86\uff0c\u4e0b\u9644\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define lowbit(x)\tx&-x\n#define mid ((L+R)>>1)\nconst int N=2e5+10;\nint n,now,ans[N],C[N];\nint h[N],e[N<<1],ne[N<<1],idx;\nstruct node\n{\n\tint red,blue,dfn,sz,id;\n\tbool operator<(const node other)const\n\t{\n\t\tif(red!=other.red)\treturn red<other.red;\n\t\tif(blue!=other.blue)\treturn blue<other.blue;\n\t\treturn dfn>other.dfn;\n\t}\n}p[N],tmp[N];\ninline void link(int a,int b)\n{\n\te[idx]=b,ne[idx]=h[a],h[a]=idx++;\n}\ninline void dfs(int u,int fa)\n{\n\tp[u].dfn=++now;\n\tp[u].sz=1;\n\tfor(int i=h[u];~i;i=ne[i])\n\t{\n\t\tif(e[i]==fa)\tcontinue;\n\t\tdfs(e[i],u);\n\t\tp[u].sz+=p[e[i]].sz;\n\t}\n}\ninline void add(int x,int y)\n{\n\tfor(;x<=n;x+=lowbit(x))\tC[x]+=y;\n}\ninline int query(int x)\n{\n\tint ans=0;\n\tfor(;x;x-=lowbit(x))\tans+=C[x];\n\treturn ans;\n}\ninline void mergesort(int L,int R)\n{\n\tif(L==R)\treturn void();\n\tmergesort(L,mid);\n\tmergesort(mid+1,R);\n\tint i=L,j=mid+1,t=0;\n\twhile(i<=mid&&j<=R)\n\t\tif(p[i].blue<=p[j].blue)\tadd(p[i].dfn,1),tmp[++t]=p[i],i++;\n\t\telse ans[p[j].id]+=query(min(p[j].dfn+p[j].sz-1,n))-query(p[j].dfn),tmp[++t]=p[j],j++;\n\twhile(i<=mid)\tadd(p[i].dfn,1),tmp[++t]=p[i],i++;\n\twhile(j<=R)\tans[p[j].id]+=query(min(p[j].dfn+p[j].sz-1,n))-query(p[j].dfn),tmp[++t]=p[j],j++;\n\tfor(int i=L;i<=mid;i++)\tadd(p[i].dfn,-1);\n\tfor(int i=L,j=1;i<=R;i++,j++)\tp[i]=tmp[j];\n}\nint main()\n{\n\tmemset(h,-1,sizeof h);\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++)\tp[i].id=i;\n\tfor(int i=1;i<n;i++)\n\t{\n\t\tint u,v;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tlink(u,v),link(v,u);\n\t}\n\tdfs(1,-1);\n\tfor(int i=1;i<=n;i++)\tscanf(\"%d%d\",&p[i].red,&p[i].blue);\n\tsort(p+1,p+n+1);\n\tmergesort(1,n);\n\tfor(int i=1;i<=n;i++)\tif(ans[i])\tprintf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```\n- \u5b8c\u7ed3\u6492\u82b1~",
        "postTime": 1665300235,
        "uid": 297806,
        "name": "Demeanor_Roy",
        "ccfLevel": 6,
        "title": "P8575 \u300cDTOI-2\u300d\u661f\u4e4b\u6cb3 \u9898\u89e3"
    },
    {
        "content": "## \u601d\u8def\n\n\u770b\u5230\u201c\u5b50\u6811\u201d\uff0c\u4e0d\u96be\u60f3\u5230\u4e00\u4e2a\u6027\u8d28\uff0c\u90a3\u5c31\u662f\u4e00\u4e2a\u70b9\u7684\u5b50\u6811\u5185\uff0c\u5047\u8bbe\u8fd9\u4e2a\u70b9 $dfn$ \u5e8f\u4e3a $dfn_u$\uff0c\u5b50\u6811\u5927\u5c0f\u4e3a $sze_u$\uff0c\u5219\u8fd9\u4e2a\u5b50\u6811\u5185\u6240\u6709\u7684\u70b9\u4f4d\u4e8e $[dfn_u+1,dfn_u+sze_u-1]$ \u4e4b\u95f4\u3002\n\n\u5047\u8bbe $r_i,b_i$ \u8868\u793a $\\text{Red}_i$ \u548c $\\text{Blue}_i$\u3002\n\n\u4e8e\u662f\u95ee\u9898\u8f6c\u5316\u4e3a\uff0c\u7ed9\u5b9a $n$ \u4e2a\u70b9\uff0c\u6c42\u6240\u6709\u70b9\u5bf9 $(i,j)$ \u6ee1\u8db3 $dfn_i<dfn_j<dfn_i+sze_i$ \u4e14 $r_i\\leq r_j$ \u4e14 $b_i\\leq b_j$ \u7684\u6570\u91cf\u3002\n\n\u663e\u7136\u8fd9\u662f\u4e00\u4e2a\u88f8\u7684\u4e09\u7ef4\u533a\u95f4\u504f\u5e8f\u95ee\u9898\u3002\u5efa\u8bae\u6309 $r$ \u6216\u8005 $d$ \u6392\u5e8f\uff0c\u7136\u540e cdq \u4e00\u4e0b\uff0c\u8f6c\u5316\u6210\u4e8c\u4f4d\u533a\u95f4\u504f\u5e8f\uff0c\u518d\u4e0a\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4\u6216\u8005\u7ebf\u6bb5\u6811\u7ef4\u62a4\u5c31\u884c\u4e86\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\n\n// \u6b64\u5904\u4e3a\u4e86\u7f8e\u89c2\uff0c\u7701\u7565 114514 \u884c\u7f3a\u7701\u6e90\u3002\n\nusing namespace std;\nconst int MAXN=200005;\n\nint n,tot=0;\nvector<int> E[MAXN];\n\nstruct Node{int dfn,sze,r,b,id;}a[MAXN];\ninline bool cmp1(const Node &a,const Node &b){\n\tif(a.r!=b.r) return a.r<b.r;\n\tif(a.b!=b.b) return a.b<b.b;\n\tif(a.dfn+a.sze!=b.dfn+b.sze) return a.dfn+a.sze<b.dfn+b.sze; // \u5982\u679c\u5b50\u6811\u7ed3\u5c3e\u7684\u66f4\u5927\u5219\u6392\u5728\u524d\u9762\n\treturn a.dfn>b.dfn; // \u5b9e\u5728\u4e0d\u884c\u6309\u5b50\u6811\u5927\u5c0f\u6392\n}\ninline bool cmp2(const Node &a,const Node &b){\n\tif(a.b!=b.b) return a.b<b.b;\n\treturn a.dfn+a.sze<b.dfn+b.sze;\n}\n\nvoid dfs(int u,int fa){\n\ta[u].dfn=++tot,a[u].sze=1;\n\tfor(int v:E[u])\tif(v!=fa) dfs(v,u),a[u].sze+=a[v].sze; // \u6c42 dfn \u5e8f\uff0c\u4ee5\u53ca\u7b97\u5b50\u6811\u5927\u5c0f \n}\n\nint tr[MAXN<<2]; // \u7ebf\u6bb5\u6811\u7ef4\u62a4\u5355\u70b9+1\u3001\u533a\u95f4\u6c42\u548c \nvoid upd(int p,int l,int r,int t,int k){\n\tif(l==r) return tr[p]+=k,void();\n\tint mid=(l+r)>>1;\n\tif(t<=mid) upd(p<<1,l,mid,t,k);\n\telse upd(p<<1|1,mid+1,r,t,k);\n\ttr[p]=tr[p<<1]+tr[p<<1|1];\n}\nint query(int p,int l,int r,int st,int en){\n\tif(l>en || r<st) return 0;\n\tif(st<=l && r<=en) return tr[p];\n\tint mid=(l+r)>>1;\n\treturn query(p<<1,l,mid,st,en)+query(p<<1|1,mid+1,r,st,en);\n}\n\nint ans[MAXN];\nvoid cdq(int l,int r){ // cdq \u5206\u6cbb \n\tif(l==r) return;\n\tint mid=(l+r)>>1;\n\tcdq(l,mid),cdq(mid+1,r); // \u5148\u9012\u5f52\u5de6\u53f3\u4e24\u8fb9 \n\tsort(a+l,a+mid+1,cmp2); // \u6392\u5e8f \n\tsort(a+mid+1,a+r+1,cmp2);\n\tint i=l;\n\tfor(int j=mid+1;j<=r;j++){ // \u53cc\u6307\u9488\u7b97\u8d21\u732e \n\t\twhile(i<=mid && a[i].b<=a[j].b) upd(1,1,n,a[i].dfn,1),i++; // \u63d2\u5165 dfn \u7684\u4f4d\u7f6e \n\t\tans[a[j].id]+=query(1,1,n,a[j].dfn+1,a[j].dfn+a[j].sze-1); // \u67e5\u8be2\u5b50\u6811\u5185\u6ee1\u8db3\u6761\u4ef6\u7684\u6570\u91cf \n\t}\n\tfor(int j=l;j<i;j++) upd(1,1,n,a[j].dfn,-1); // \u6e05\u7a7a\u7ebf\u6bb5\u6811 \n}\n\nsigned main(){\n\tread(n);\n\tfor(int i=1;i<n;i++){\n\t\tint u,v; read(u,v);\n\t\tE[u].push_back(v);\n\t\tE[v].push_back(u); \n\t}\n\tdfs(1,0); // \u9884\u5904\u7406 \n\tfor(int i=1;i<=n;i++) read(a[i].r,a[i].b),a[i].id=i;\n\tsort(a+1,a+1+n,cmp1); // \u6309\u7167 r,b,dfn \u6392\u5e8f\n\t\n\tcdq(1,n); // cdq \u5206\u6cbb \n\tfor(int i=1;i<=n;i++)\n\t\tif(ans[i]!=0) write(ans[i]); // \u8f93\u51fa \n\treturn flush(),0;\n}\n```\n\n\u5e38\u6570\u6709\u70b9\u5927\uff0c\u4e0d\u5f00 O2 \u4f1a T \u98de\u6389\u3002\u5efa\u8bae\u5404\u4f4d\u5199\u6811\u72b6\u6570\u7ec4\u3002qwq",
        "postTime": 1665230057,
        "uid": 195198,
        "name": "E1_de5truct0r",
        "ccfLevel": 7,
        "title": "P8575 \u9898\u89e3"
    },
    {
        "content": "## $\\mathcal{Solution}$\n\n\u901a\u8fc7 [dfs \u5e8f](https://www.baidu.com/s?wd=dfs\u5e8f)\u5c06\u6811\u4e0a\u95ee\u9898\u8f6c\u5316\u4e3a\u5e8f\u5217\u95ee\u9898\uff1a\n\n\u5bf9\u4e8e\u6bcf\u4e2a $u$ \u6c42 $v$ \u7684\u4e2a\u6570\uff0c\u4f7f\u5f97\n- $\\text{Red}_{v}\\leq\\text{Red}_{u}$\n- $\\text{Blue}_{v}\\leq\\text{Blue}_{u}$\n- $L_u\\leq L_v$\n- $R_v\\leq R_u$\n\n\u4e4d\u4e00\u770b\u597d\u50cf\u56db\u7ef4\u504f\u5e8f\uff0c\u5b9e\u9645\u4e0a dfs \u5e8f\u6709\u4e00\u4e2a\u6027\u8d28\uff0c\u4e24\u4e2a\u70b9\u7684 dfs \u5e8f\u8981\u4e48\u5305\u542b\uff0c\u8981\u4e48\u4e0d\u76f8\u4ea4\u3002\u4e5f\u5c31\u662f\u8bf4\u6700\u540e\u4e24\u7ef4\u80af\u5b9a\u540c\u65f6\u5408\u6cd5 / \u4e0d\u5408\u6cd5\u3002\n\n\u90a3\u4e48\uff0c\u663e\u7136[\u4e09\u7ef4\u504f\u5e8f](/problem/P3810)\u677f\u5b50\u3002\n\n```cpp\nstruct node {\n\tint a, b, l, r, id;\n} s[N];\n```\n\n$a,b$ \u4e3a\u5206\u522b\u4e3a\u8be5\u70b9\u7684 $\\text{Red}$ \u4e0e $\\text{Blue}$\uff0c$l,r$ \u4e3a\u8be5\u70b9\u7684 dfs \u5e8f\u7684\u5de6\u53f3\u7aef\u70b9\u3002\n\n\u90a3\u4e48\u6392\u5e8f\u65f6\uff0c\u5e94\u8be5\u5982\u4e0b\u6392\u5e8f\uff1a\n\n```cpp\nbool cmp1(const node& x, const node& y) {\n\treturn x.a == y.a ? x.b == y.b ? x.l > y.l : x.b < y.b : x.a < y.a;\n}\nbool cmp2(const node& x, const node& y) {\n\treturn x.b == y.b ? x.l > y.l : x.b < y.b;\n}\n```\n\u4e3a\u4ec0\u4e48\u5462\uff1f\u56e0\u4e3a\u6c42\u7684\u65f6 $[L_i,R_i]$ \u4e4b\u95f4\u7684\u7b54\u6848\uff0c\u663e\u7136 $L_i$ \u8f83\u5927\u7684\u624d\u4f1a\u88ab\u4e4b\u540e\u5305\u542b\u3002\n\n## $\\mathcal{Code}$\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 1e6 + 5;\nstruct node {\n\tint a, b, l, r, id;\n} s[N];\nint n, u, v, tot, in[N], out[N], ans[N];\nvector<int> G[N];\nstruct tree {\n    int c[N];\n    int lowbit(int x) { return x & (-x); }\n    void upd(int x, int val) { for (; x <= n; x += lowbit(x)) c[x] += val; }\n    int query(int x) { int res = 0; for (; x; x -= lowbit(x)) res += c[x]; return res; }\n} bit;\nbool cmp1(const node& x, const node& y) {\n\treturn x.a == y.a ? x.b == y.b ? x.l > y.l : x.b < y.b : x.a < y.a;\n}\nbool cmp2(const node& x, const node& y) {\n\treturn x.b == y.b ? x.l > y.l : x.b < y.b;\n}\nvoid cdq(int l, int r) {\n\tif (l == r) return;\n\tint mid = (l + r) >> 1;\n\tcdq(l, mid), cdq(mid + 1, r);\n\tsort(s + l, s + 1 + mid, cmp2);\n\tsort(s + mid + 1, s + 1 + r, cmp2);\n\tint p = l;\n\tfor (int i = mid + 1; i <= r; i ++) {\n\t\twhile (s[i].b >= s[p].b && p <= mid)\n\t\t\tbit.upd(s[p].l, 1), p ++;\n\t\tans[s[i].id] += bit.query(s[i].r) - bit.query(s[i].l - 1);\n\t}\n\tfor (int i = l; i < p; i ++) bit.upd(s[i].l, -1);\n}\nvoid dfs(int u, int fa) {\n\tin[u] = ++ tot;\n\tfor (int v : G[u])\n\t\tif (v != fa) dfs(v, u);\n\tout[u] = tot;\n}\nint main() {\n\tcin >> n;\n\tfor (int i = 1; i < n; i ++)\n\t\tcin >> u >> v, G[u].push_back(v), G[v].push_back(u);\n\tdfs(1, 0);\n\tfor (int i = 1; i <= n; i ++) {\n\t\tcin >> s[i].a >> s[i].b;\n\t\ts[i].l = in[i], s[i].r = out[i], s[i].id = i;\n\t}\n\tsort(s + 1, s + 1 + n, cmp1);\n\tcdq(1, n);\n\tfor (int i = 1; i <= n; i ++)\n\t\tif (ans[i]) cout << ans[i] << '\\n';\n\treturn 0;\n}\n\n```\n",
        "postTime": 1674027764,
        "uid": 858406,
        "name": "Cadmus",
        "ccfLevel": 0,
        "title": "P8575 \u300cDTOI-2\u300d\u661f\u4e4b\u6cb3 \u9898\u89e3"
    },
    {
        "content": "## \u9898\u610f\n\u7ed9\u4f60\u4e00\u4e2a\u6811\uff0c\u6bcf\u4e2a\u70b9\u4e0a\u6709\u4e24\u4e2a\u70b9\u6743 $ a_i $ \u548c $ b_i $\uff0c\u8981\u6c42\u6bcf\u4e2a\u70b9\u7684\u5b50\u6811\u5185\u6709\u591a\u5c11\u4e2a\u70b9 $ j $ \u6ee1\u8db3 $ a_i<a_j $ \u4e14 $ b_i<b_j $\u3002\n## \u9898\u89e3\n\u7b2c\u4e00\u773c\u770b\u51fa\u8fd9\u662f\u4e00\u4e2a\u504f\u5e8f\u7c7b\u95ee\u9898\uff0c\u4f46\u662f\u8fd9\u4e2a\u6811\u600e\u4e48\u5904\u7406\u8ba9\u6211\u601d\u8003\u4e86\u4e00\u4e0b\uff0c\u53d1\u73b0\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u53ea\u8981\u62cd\u6241\u6210 dfs \u5e8f\u5c31\u53ef\u4ee5\u8f6c\u6362\u6210\u5e8f\u5217\u95ee\u9898\uff0c\u7136\u540e\u6309 dfs \u5e8f\u4e3a\u7b2c\u4e09\u7ef4\uff0c\u628a\u6bcf\u4e2a\u70b9\u7684\u8be2\u95ee\u62c6\u5f00\uff0c\u7ed9\u5b9a\u6b63\u8d1f\u53f7\u5c31\u662f\u4e09\u7ef4\u504f\u5e8f\u677f\u5b50\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u8fd9\u91cc\u8981\u7279\u6b8a\u6ce8\u610f\u4e00\u4e2a\u70b9\uff0c\u4e00\u5b9a\u8981\u4fdd\u8bc1\u8be2\u95ee\u548c\u4fee\u6539\u7684\u5148\u540e\uff0c\u5728\u624b\u5199\u5f52\u5e76\u65f6\u7684\u5927\u5c0f\u6bd4\u8f83\u4e5f\u8981\u6ce8\u610f\u7279\u5224\u8fd9\u4e00\u70b9\uff0c\u4e0d\u7136\u53ef\u80fd\u4f1a\u548c\u6211\u4e00\u6837\u6837\u4f8b\u8f93\u51fa\u4e00\u76f4\u662f 5 2 2 1 \u8c03\u4e0d\u51fa\u6765\u3002\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=2e5+5;\nint n,dfn[N],tr[N],h[N],sum,cnt,ans[N],num,siz[N];\nstruct node\n{\n    int x,y,z,opt,id;\n}q[N*3],w[N*3];\nvector<int> g[N];\nvoid dfs(int x,int fa)\n{\n    dfn[x]=++num;siz[x]=1;\n    for(int y : g[x])\n    {\n        if(y==fa) continue;\n        dfs(y,x);\n        siz[x]+=siz[y];\n    }\n}\nbool cmp(node i,node j)\n{\n    if(i.z!=j.z) return i.z<j.z;\n    return abs(i.opt)<abs(j.opt);\n}\nvoid add(int x,int y)\n{\n    for(int i=x;i<=sum;i+=(i&(-i))) tr[i]+=y;\n}\nint query(int x)\n{\n    int res=0;\n    for(int i=x;i;i-=(i&(-i))) res+=tr[i];\n    return res;\n}\nvoid merge_sort(int l,int r)\n{\n    if(l==r) return;\n    int mid=(l+r)>>1;\n    merge_sort(l,mid);merge_sort(mid+1,r);\n    int i=l,j=mid+1,cnt=l-1;\n    while(i<=mid && j<=r)\n    {//\u4e00\u5b9a\u8981\u6ce8\u610f\u5148\u540e\u987a\u5e8f\n        if(q[i].x<q[j].x || (q[i].x==q[j].x && abs(q[i].opt)<abs(q[j].opt)))\n        {\n            if(q[i].opt==0) add(q[i].y,1);\n            w[++cnt]=q[i];i++;\n        }\n        else{\n            if(q[j].opt)\n            {\n                ans[q[j].id]+=q[j].opt*query(q[j].y);\n            }\n            w[++cnt]=q[j];j++;\n        }\n    }\n    while(i<=mid)\n    {\n        if(q[i].opt==0) add(q[i].y,1);\n        w[++cnt]=q[i];i++;\n    }\n    while(j<=r)\n    {\n        if(q[j].opt)\n        {\n            ans[q[j].id]+=q[j].opt*query(q[j].y);\n        }\n        w[++cnt]=q[j];j++;\n    }\n    for(int i=l;i<=mid;i++) if(q[i].opt==0) add(q[i].y,-1);\n    for(int i=l;i<=r;i++) q[i]=w[i];\n}\nint main()\n{\n    scanf(\"%d\",&n);\n    for(int i=1;i<n;i++)\n    {\n        int x,y;scanf(\"%d%d\",&x,&y);\n        g[x].push_back(y);g[y].push_back(x);\n    }\n    dfs(1,0);\n    for(int i=1;i<=n;i++)\n    {\n        int x,y;scanf(\"%d%d\",&x,&y);\n        q[++cnt]={x,y,dfn[i],-1,i};\n        q[++cnt]={x,y,dfn[i]+siz[i]-1,1,i};\n        q[++cnt]={x,y,dfn[i],0,i};\n        h[++sum]=y;\n    }\n    sort(h+1,h+sum+1);sum=unique(h+1,h+sum+1)-h-1;\n    for(int i=1;i<=cnt;i++) q[i].y=lower_bound(h+1,h+sum+1,q[i].y)-h;\n    sort(q+1,q+cnt+1,cmp);\n    merge_sort(1,cnt);\n    for(int i=1;i<=n;i++)\n        if(ans[i]) printf(\"%d\\n\",ans[i]);\n    return 0;\n}\n```\n",
        "postTime": 1675257244,
        "uid": 300710,
        "name": "xuyuansu",
        "ccfLevel": 0,
        "title": "P8575 \u300cDTOI-2\u300d\u661f\u4e4b\u6cb3"
    },
    {
        "content": "### \u9898\u76ee\u5206\u6790\n\n\u770b\u5230\u9898\u76ee\uff0c\u53d1\u73b0\u9898\u4e2d\u6709\u4e09\u4e2a\u7ea6\u675f\u6761\u4ef6\uff0c\u5206\u522b\u662f\u84dd\u8272\u7ea2\u8272\u548c\u8282\u70b9\u5fc5\u987b\u5728\u5b50\u6811\u5185\uff0c\u5bf9\u4e8e\u524d\u4e24\u79cd\u60c5\u51b5\u53ef\u4ee5\u4f7f\u7528\u4e8c\u7ef4\u504f\u5e8f\u5904\u7406\uff0c\u6211\u4eec\u5173\u6ce8\u5b50\u6811\u7684\u60c5\u51b5\u3002\n\n\u7531\u4e8e\u524d\u4e24\u4e2a\u4e0e\u504f\u5e8f\u95ee\u9898\u6709\u5173\uff0c\u6211\u4eec\u8003\u8651\u5bf9\u7b2c\u4e09\u79cd\u60c5\u51b5\u8fdb\u884c\u8f6c\u5316\uff0c\u7531\u6811\u94fe\u5256\u5206\u7684\u5b50\u6811\u5185\u8282\u70b9\u8fde\u7eed\u60f3\u5230\u53ef\u4ee5\u7528 dfs \u5e8f\u8f6c\u5316\u8282\u70b9\u7f16\u53f7\uff0c\u5e76\u4e14\u6700\u540e\u4fee\u6539\u6811\u72b6\u6570\u7ec4\u67e5\u8be2\u7684\u6b65\u9aa4\u5373\u53ef\u3002\n\n\u8f6c\u6362\u540e\u95ee\u9898\u53d8\u4e3a\u4e09\u7ef4\u504f\u5e8f\uff0c\u4fee\u6539\u4e00\u4e0b\u7d2f\u8ba1\u7b54\u6848\u7684\u90e8\u5206\u4f7f\u7528 cdq \u5206\u6cbb\u5373\u53ef\u3002\n\n~~\u603b\u4f53\u4e0a\u662f\u4e2a\u6bd4\u8f83\u677f\u7684\u4e09\u7ef4\u504f\u5e8f\uff0c\u8003\u524d\u53ef\u4ee5\u7ec3\u7ec3\u624b~~\n\n### \u4ee3\u7801\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\n#include<vector>\n#include<queue>\n#define eps 0.00001\nusing namespace std;\nstruct Node{\n\tint r,b,dfn,sz;\n}id[1000001];\nbool cmp(Node x,Node y){\n\tif(x.r!=y.r)return x.r<y.r;\n\telse if(x.b!=y.b) return x.b<y.b;\n\telse return x.dfn>y.dfn;\n}\nint ba[1000001];\nint a[1000001];\nint ans[1000001];\nint fin[1000001];\nvector<int> l[1000001];\nint tot;\nint lowbit(int x){\n\treturn x&(-x);\n}\nvoid add(int x,int val){\n\twhile(x<=tot){\n\t\ta[x]+=val;\n\t\tx+=lowbit(x);\n\t}\n}\nint query(int x){\n\tint ans=0;\n\twhile(x){\n\t\tans+=a[x];\n\t\tx-=lowbit(x);\n\t}\n\treturn ans;\n}\nvoid dfs(int x,int fa){\n\tid[x].dfn=++tot;\n\tid[x].sz=1;\n\tba[id[x].dfn]=x;\n\tfor(int i=0;i<l[x].size();i++){\n\t\tint v=l[x][i];\n\t\tif(v==fa) continue;\n\t\tdfs(v,x);\n\t\tid[x].sz+=id[v].sz;\n\t}\n}\nNode tmp[1000001];\nvoid cdq(int l,int r){\n\tif(l==r) return;\n\tint mid=(l+r)>>1;\n\tcdq(l,mid);cdq(mid+1,r);\n\tint i=l,j=mid+1,len=l-1;\n\twhile(i<=mid && j<=r){\n\t\tif(id[i].b<=id[j].b){\n\t\t\tadd(id[i].dfn,1);\n\t\t\ttmp[++len]=id[i];\n\t\t\ti++;\n\t\t}\n\t\telse{\n\t\t\tans[id[j].dfn]+=query(id[j].dfn+id[j].sz-1)-query(id[j].dfn);\n\t\t\ttmp[++len]=id[j];\n\t\t\tj++;\n\t\t}\n\t}\n\twhile(i<=mid){\n\t\tadd(id[i].dfn,1);\n\t\ttmp[++len]=id[i];\n\t\ti++;\n\t}\n\twhile(j<=r){\n\t\tans[id[j].dfn]+=query(id[j].dfn+id[j].sz-1)-query(id[j].dfn);\n\t\ttmp[++len]=id[j];\n\t\tj++;\n\t}\n\tfor(int k=l;k<=mid;k++) add(id[k].dfn,-1);\n\tfor(int k=l;k<=r;k++) id[k]=tmp[k];\n}\nint main(){\n\tint n,u,v;\n\tcin>>n;\n\tfor(int i=1;i<n;i++){\n\t\tcin>>u>>v;\n\t\tl[u].push_back(v);\n\t\tl[v].push_back(u);\n\t}\n\tdfs(1,0);\n\tfor(int i=1;i<=n;i++)cin>>id[i].r>>id[i].b;\t\n\tsort(id+1,id+n+1,cmp);\n\tcdq(1,tot);\n\tfor(int i=1;i<=n;i++)fin[ba[id[i].dfn]]=ans[id[i].dfn];\n\tfor(int i=1;i<=n;i++){\n\t\tif(fin[i])cout<<fin[i]<<endl;\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1669120658,
        "uid": 421265,
        "name": "eastcloud",
        "ccfLevel": 4,
        "title": "P8575 \u300cDTOI-2\u300d\u661f\u4e4b\u6cb3 \u9898\u89e3"
    },
    {
        "content": "# \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u6bcf\u4e2a\u70b9\u90fd\u6709\u4e00\u4e2a $Blue$ \u548c\u4e00\u4e2a $Red$ \u6743\u503c\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u95ee\u5b83\u7684\u5b50\u6811\u5185\u6ee1\u8db3 $Red_y \\leq Red_x$\uff0c$Blue_y \\leq Blue_x$\u3002\n\n# \u601d\u8def\n\n\u6211\u4eec\u53d1\u73b0 $Red_y \\leq Red_x$\uff0c$Blue_y \\leq Blue_x$ \u6ee1\u8db3\u4e8c\u7ef4\u504f\u5e8f\u5173\u7cfb\uff0c\u6613\u60f3\u5230 CDQ \u5206\u6cbb\uff0c\u6b64\u65f6\u53ea\u5269\u4e0b\u5b50\u6811\u5185\u8fd9\u4e2a\u8981\u6c42\uff0c\u7531\u4e8e\u6211\u4eec\u8981\u51d1\u51fa\u4e09\u7ef4\u504f\u5e8f\u5173\u7cfb\uff0c\u4e0d\u96be\u60f3\u5230\u628a\u6811\u62cd\u6241\u6210 DFS \u5e8f\uff0c\u8bb0\u4e0b\u6bcf\u4e2a\u70b9\u5728 DFS \u4e2d\u7b2c\u4e00\u4e8c\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c\u5219\u5b50\u6811\u5185\u8f6c\u5316\u4e3a $dfn_{x1} \\leq dfn_{y1} \\leq dfn_{x2}$\uff0c\u76f4\u63a5 CDQ \u5373\u53ef\u3002\n\n# \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define lowbit(x) x & (-x)\n\nusing namespace std;\n\nconst int N = 2e5 + 10;\n\nstruct S{\n\tint a, b, c1, c2, id;\n}s1[N], s2[N];\nint tot, n, m, ans[N], win[N];\n\nbool cmp1(S u, S v){\n\tif(u.a != v.a) return u.a < v.a;\n\tif(u.b != v.b) return u.b < v.b;\n\tif(u.c1 != v.c1) return u.c1 > v.c1;\n}\n\nint tr[N];\nvoid add(int x, int w){\n\tfor(; x <= tot; x += lowbit(x)) tr[x] += w;\n}\n\nint query(int x){\n\tint num = 0;\n\tfor(; x > 0; x -= lowbit(x)) num += tr[x];\n\treturn num;\n}\n\nvoid CDQ(int L, int R){\n\tif(L >= R) return ;\n\tint mid = L + R >> 1;\n\tCDQ(L, mid);CDQ(mid + 1, R);\n\tint l = L, r = mid + 1, len = L - 1;\n\twhile(l <= mid && r <= R){\n\t\tif(s1[r].b >= s1[l].b){\n\t\t\tadd(s1[l].c1, 1);\n\t\t\ts2[++len] = s1[l];\n\t\t\tl++;\n\t\t}\n\t\telse{\n\t\t\tans[s1[r].c1] += query(s1[r].c2) - query(s1[r].c1);\n\t\t\ts2[++len] = s1[r];\n\t\t\tr++;\n\t\t}\n\t}\n\twhile(l <= mid){add(s1[l].c1, 1);s2[++len] = s1[l];l++;}\n\twhile(r <= R){ans[s1[r].c1] += query(s1[r].c2) - query(s1[r].c1);s2[++len] = s1[r];r++;}\n\tfor(int i = L; i <= mid; i++){\n\t\tadd(s1[i].c1, -1);\n\t}\n\tfor(int i = L; i <= R; i++) s1[i] = s2[i];\n}\n\nvector<int> g[N];\nint dfn[N];\n\nvoid dfs(int x, int f){\n\ts1[x].c1 = ++tot;dfn[tot] = x;\n\tfor(auto y : g[x]){\n\t\tif(y == f) continue;\n\t\tdfs(y, x);\n//\t\ts1[x].sz += s1[y].sz;\n\t}\n\ts1[x].c2 = tot;\n}\n\nint main(){\n\tcin >> n;\n\tfor(int x, y, i = 1; i < n; i++){\n\t\tcin >> x >> y;\n\t\tg[x].push_back(y);\n\t\tg[y].push_back(x);\n\t}\n\tfor(int i = 1; i <= n; i++){\n\t\tcin >> s1[i].a >> s1[i].b;\n        s1[i].id = i;\n\t}\n\tdfs(1, 0);\n\tsort(s1 + 1, s1 + n + 1, cmp1);\n\tCDQ(1, tot);\n\tfor(int i = 1; i <= n; i++){\n\t\twin[dfn[s1[i].c1]] = ans[s1[i].c1];\n\t}\n\tfor(int i = 1; i <= n; i++) if(win[i]) cout << win[i] << '\\n';\n\treturn 0;\n}\n```",
        "postTime": 1681188484,
        "uid": 408759,
        "name": "ollo",
        "ccfLevel": 6,
        "title": "P8575 \u300cDTOI-2\u300d\u661f\u4e4b\u6cb3 \u9898\u89e3"
    },
    {
        "content": "[\u9898\u9762](https://www.luogu.com.cn/problem/P8575)\n\n\u88f8\u7684\u4e09\u7ef4\u504f\u5e8f\u3002\n\n\u9996\u5148\u770b\u5230\u9898\u76ee\u5c31\u4e00\u773c\u4e01\u771f\uff0c\u9274\u5b9a\u4e3a\u504f\u5e8f\uff0c\u8003\u8651 $\\text{CDQ}$ \u5206\u6cbb\u3002\n\n\u663e\u7136\u73b0\u5728\u6bd4\u4e8c\u4f4d\u504f\u5e8f\uff08$a_i\\leq a_j,b_i\\leq b_j$\uff09\u591a\u4e86\u4e00\u4e2a\u6761\u4ef6\uff1a$i\\in j\\ subtree,i\\neq j$\u3002\n\n\u8054\u60f3\u5230\u4e00\u4e2a\u5b50\u6811\u5185\u7684 $\\text{dfs}$ \u5e8f\u662f\u8fde\u7eed\u7684\uff0c\u5373\u4ee5 $u$ \u4e3a\u6839\u7684\u5b50\u6811\u6240\u6709\u8282\u70b9\u7684 $\\text{dfs}$ \u5e8f\u5728\u4e00\u5b9a\u662f $dfn_u\\sim dfn_{u}+siz_u-1$ \u4e4b\u4e2d\u3002\n\n\u90a3\u8981\u6761\u4ef6\u610f\u5473\u7740 $dfn_j< dfn_i\\leq dfn_j+siz_j-1$\u3002\n\n\u5408\u5e76\u65f6\u53ea\u9700\u8981\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u4e00\u4e0b\u5c31\u884c\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define N 200005\nusing namespace std;\nint n;\nstruct Edge{\n\tint nxt,to;\n\tEdge(int a=0,int b=0):nxt(a),to(b){}\n};\nstruct Edge e[N<<1];\nint head[N],tot;\ninline void AddEdge(int x,int y){\n\te[++tot]=Edge(head[x],y);head[x]=tot;\n}\nint dfn[N],cnt,siz[N];\nvoid DFS(int u,int f){\n\tdfn[u]=++cnt;siz[u]=1;\n\tfor(int i(head[u]);i;i=e[i].nxt){\n\t\tint v(e[i].to);\n\t\tif(v^f){\n\t\t\tDFS(v,u);\n\t\t\tsiz[u]+=siz[v];\n\t\t}\n\t}\n}\nint red[N],blue[N],id[N],tmp[N];\ninline bool cmp(int a,int b){\n\tif(red[a]^red[b]) return red[a]<red[b];\n\tif(blue[a]^blue[b]) return blue[a]<blue[b];\n\treturn dfn[a]>dfn[b];\n}\nint c[N];\ninline int lowbit(int x){return x&-x;}\ninline void Add(int x,int v){\n\twhile(x<=n){\n\t\tc[x]+=v;\n\t\tx+=lowbit(x);\n\t}\n}\ninline void Update(int x,int v){Add(dfn[x],v);}\ninline int Sum(int x){\n\tint res(0);\n\twhile(x){\n\t\tres+=c[x];\n\t\tx-=lowbit(x);\n\t}\n\treturn res;\n}\ninline int Query(int x){return Sum(dfn[x]+siz[x]-1)-Sum(dfn[x]);}\nint ans[N];\nvoid CDQ(int l,int r){\n\tif(l>=r) return;\n\tint mid(l+r>>1);\n\tCDQ(l,mid);CDQ(mid+1,r);\n\tint k(l),k1(l),k2(mid+1);\n\twhile(k1<=mid&&k2<=r){\n\t\tif(blue[id[k1]]<=blue[id[k2]]){\n\t\t\tUpdate(id[k1],1);\n\t\t\ttmp[k++]=id[k1++];\n\t\t}\n\t\telse{\n\t\t\tans[id[k2]]+=Query(id[k2]);\n\t\t\ttmp[k++]=id[k2++];\n\t\t}\n\t}\n\twhile(k2<=r){\n\t\tans[id[k2]]+=Query(id[k2]);\n\t\ttmp[k++]=id[k2++];\n\t}\n\tfor(int i(l);i<k1;++i) Update(id[i],-1);\n\twhile(k1<=mid) tmp[k++]=id[k1++];\n\tfor(int i(l);i<=r;++i) id[i]=tmp[i];\n}\nint main(){\n\tscanf(\"%d\",&n);\n\tfor(int i(1);i<n;++i){\n\t\tint u,v;scanf(\"%d%d\",&u,&v);\n\t\tAddEdge(u,v);AddEdge(v,u);\n\t}\n\tDFS(1,0);\n\tfor(int i(1);i<=n;++i) scanf(\"%d%d\",&red[i],&blue[i]);\n\tfor(int i(1);i<=n;++i) id[i]=i;\n\tsort(id+1,id+1+n,cmp);CDQ(1,n);\n\tfor(int i(1);i<=n;++i) if(ans[i]) printf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1678974817,
        "uid": 554574,
        "name": "gyyyyx",
        "ccfLevel": 0,
        "title": "\u300cDTOI-2\u300d\u661f\u4e4b\u6cb3"
    },
    {
        "content": "### Preface\n\n> \u661f\u7a00\u6cb3\u5f71\u8f6c\uff0c\u971c\u91cd\u6708\u534e\u5b64\u3002\n\n### Problem\n\n\u7ed9\u4e00\u68f5\u5927\u5c0f\u4e3a $n$ \u7684\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u4e24\u4e2a\u6743\u503c $r_i, b_i$\uff0c\u95ee\u5bf9\u6bcf\u4e2a\u70b9 $i$ \u6709\u591a\u5c11\u70b9 $j \\neq i$ \u6ee1\u8db3\uff1a\n\n+ $j$ \u5728 $i$ \u7684\u5b50\u6811\u5185\uff1b\n+ $r_j \\leq r_i, b_j \\leq b_i$\u3002\n\n$1 \\leq n \\leq 2\\times 10^5, \\lvert r_i \\rvert, \\lvert b_i \\rvert \\leq 10^9$\u3002\n\n### Solution\n\n\u677f\u5b50\u4e09\u7ef4\u504f\u5e8f\uff0c\u7136\u800c\u6211\u8c03\u4e86\u534a\u5929\uff0c\u592a\u62bd\u8c61\u4e86\uff01\n\n\u770b\u5230\u5b50\u6811\u5c31\u60f3\u5230 dfs \u5e8f\uff0c\u4ee4\u4e00\u4e2a\u70b9\u7b2c\u4e00\u6b21\u51fa\u73b0\u4e3a $f_i$\uff0c\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u4e3a $l_i$\uff0c\u90a3\u4e48\u62bd\u8c61\u4e3a\uff1a\n\n+ $f_i \\lt f_j \\lt l_j \\lt l_i$\n+ $r_j \\leq r_i$\n+ $b_j \\leq b_i$\n\n\u4f60\u4e4d\u4e00\u770b\u8fd9\u4e0d\u662f\u56db\u7ef4\u504f\u5e8f\u5417\uff1f~~\u6211\u8003\u573a\u4e0a\u786e\u5b9e\u662f\u8fd9\u4e48\u60f3\u7684~~\u3002\n\n\u4f60\u53bb\u8003\u8651\uff0c\u5982\u679c $f_i \\lt f_j \\lt l_i$\uff0c\u90a3\u4e48\u80af\u5b9a $l_j \\lt l_i$\uff0c\u56e0\u4e3a dfs \u5e8f\uff08\u6240\u5bf9\u5e94\u7684\u4e00\u4e2a\u70b9\u7684\u5b50\u6811\uff09**\u6ca1\u6709\u51fa\u73b0\u76f8\u4ea4\u4e0d\u5305\u542b\u5173\u7cfb**\u7684\u3002\n\n\u8fd9\u5c31\u597d\u505a\u4e86\u3002\u5bf9 $r_i$ \u6392\u5e8f\uff0c$b_i$ \u7528\u4e00\u7ef4 cdq \u89e3\u51b3\uff0c**\u76ee\u7684\u5728\u4e8e\u8ba9\u90a3\u4e2a\u5e26\u4e24\u4e2a\u504f\u5e8f\u7b26\u53f7\u7684\u6761\u4ef6\u7528\u6811\u72b6\u6570\u7ec4\u6700\u65b9\u4fbf\u5730\u89e3\u51b3**\u3002\n\n\u4f46\u662f\u8fd9\u91cc\u6709\u4e2a\u6bd4\u8f83 ex \u7684\u662f\u4f60\u672c\u53ef\u4ee5\u5bf9\u5c0f\u4e8e\u53f7\u90a3\u4e00\u7ef4\u6392\u5e8f\uff08\u4e8b\u5b9e\u4e0a\u4e0d\u80fd\u8fd9\u4e48\u5e72\uff09\uff0c\u4f46\u662f\u4f60\u5bf9\u4e86 $r$ \u6216 $b$ \u4e2d\u7684\u5176\u4e2d\u4e00\u7ef4\u6392\u5e8f\uff0c\u90a3\u4e48\u4e0d\u5f97\u4e0d\u8003\u8651\u7b49\u4e8e\u53f7\u6a2a\u8de8 $mid$ \u7684\u5904\u7406\u3002\n\n\u53ef\u4ee5\u770b\u4ee3\u7801\u6765\u66f4\u597d\u5730\u7406\u89e3\u3002\n\n### Code\n\n```cpp\n#include <bits/stdc++.h>\n\n#define MAXN 500001\nint head[MAXN], cnt = 0;\nstruct Edge {\n\tint to, nxt;\n\tEdge () {}\n\tEdge (int T, int N) : \n\t\tto(T), nxt(N) {}\n} e[MAXN << 1];\ninline void addEdge(int u, int v) {\n\te[++cnt] = Edge(v, head[u]), head[u] = cnt;\n\te[++cnt] = Edge(u, head[v]), head[v] = cnt;\n}\n\nint f[MAXN], l[MAXN], tot = 0;\nvoid getDfn(int u = 1, int fa = 0) {\n\tf[u] = ++tot;\n\tfor (int ed = head[u]; ed; ed = e[ed].nxt) \n\t\tif (e[ed].to != fa) getDfn(e[ed].to, u);\n\tl[u] = ++tot;\n}\n\nstruct Node {\n\tint id, a, b, c, d;\n\tNode () {}\n\tNode (int I, int A, int B, int C, int D) : \n\t\tid(I), a(A), b(B), c(C), d(D) {}\n} q[MAXN], tmp[MAXN];\n\nint ans[MAXN], t[MAXN], Z = 400000;\nint query(int x) { int ans = 0; while (x) ans += t[x], x -= x & (-x); return ans; }\nvoid add(int x, int v = 1) { while (x <= Z) t[x] += v, x += x & (-x); }\nvoid solve(int l, int r) {\n\tif (l == r) return;\n\t// j.c <= i.c (SORT)\n\t// j.d <= i.d (CDQ)\n\t// i.a < j.a <= i.b (BIT)\n\t// j ===> contribute ===> i\n\tint mid = l + r >> 1;\n\tsolve(l, mid), solve(mid + 1, r);\n\tint c1 = l, c2 = mid + 1, c3 = l;\n\twhile (c1 <= mid && c2 <= r) if (q[c1].d <= q[c2].d) {\n\t\tadd(q[c1].a), tmp[c3++] = q[c1++];\n\t} else {\n\t\tans[q[c2].id] += query(q[c2].b) - query(q[c2].a);\n\t\ttmp[c3++] = q[c2++];\n\t}\n\twhile (c1 <= mid) add(q[c1].a), tmp[c3++] = q[c1++];\n\twhile (c2 <= r) \n\t\tans[q[c2].id] += query(q[c2].b) - query(q[c2].a), tmp[c3++] = q[c2++];\n\tfor (c3 = l; c3 <= mid; ++c3) add(q[c3].a, -1);\n\tstd::vector<Node> L, R;\n\tfor (c1 = l; c1 <= mid; ++c1) \n\t\tif (L.empty() || L[0].c == q[c1].c) L.push_back(q[c1]);\n\telse if (L[0].c < q[c1].c) L = std::vector<Node>(1, q[c1]);\n\tfor (c2 = mid + 1; c2 <= r; ++c2) \n\t\tif (R.empty() || R[0].c == q[c2].c) R.push_back(q[c2]);\n\telse if (R[0].c > q[c2].c) R = std::vector<Node>(1, q[c2]);\n\tif (L[0].c == R[0].c) {\n\t\t// extra contribution .\n\t\tc1 = 0, c2 = 0;\n\t\twhile (c1 < L.size() && c2 < R.size()) if (R[c2].d <= L[c1].d) add(R[c2++].a);\n\t\telse ans[L[c1].id] += query(L[c1].b) - query(L[c1].a), ++c1;\n\t\twhile (c1 < L.size()) ans[L[c1].id] += query(L[c1].b) - query(L[c1].a), ++c1;\n\t\twhile (c2) add(R[--c2].a, -1);\n\t}\n\tfor (c3 = l; c3 <= r; ++c3) q[c3] = tmp[c3];\n}\nint main() {\n\tstd::ios::sync_with_stdio(false);\n\tstd::cin.tie(nullptr), std::cout.tie(nullptr);\n\tint N; std::cin >> N;\n\tfor (int i = 1, u, v; i < N; ++i) \n\t\tstd::cin >> u >> v, addEdge(u, v);\n\tgetDfn();\n\tfor (int i = 1, r, b; i <= N; ++i) \n\t\tstd::cin >> r >> b, q[i] = Node(i, f[i], l[i], r, b);\n\tstd::sort(q + 1, q + N + 1, [&](Node a, Node b) -> int { return a.c < b.c; });\n\tsolve(1, N);\n\tfor (int i = 1; i <= N; ++i) if (ans[i])\n\t\tstd::cout << ans[i] << '\\n';\n\treturn 0;\n}\n```",
        "postTime": 1673425847,
        "uid": 419487,
        "name": "irris",
        "ccfLevel": 7,
        "title": "P8575 Solution"
    }
]