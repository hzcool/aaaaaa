[
    {
        "content": "## \u9898\u610f\n\u4e00\u4e2a\u6811\u4e0a\u6bcf\u4e00\u4e2a\u70b9\u90fd\u6709\u4e00\u4e2a\u7ec4\u522b\uff0c\u6c42\u76f8\u540c\u7ec4\u522b\u7684\u70b9\u5bf9\u76f8\u5dee\u7684\u6700\u5927\u8ddd\u79bb\u3002\n## \u5206\u6790\n\u9996\u5148\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u7ec4\u522b\uff0c\u6df1\u5ea6\u6700\u5927\u7684\u70b9\u4e00\u5b9a\u5728\u7b54\u6848\u7684\u70b9\u5bf9\u91cc\u3002\n### \u8bc1\u660e\n> \u5047\u8bbe\u7b54\u6848\u7684\u70b9\u5bf9\u91cc\u6ca1\u6709\u6df1\u5ea6\u6700\u5927\u7684\u70b9,\u8bbe\u6df1\u5ea6\u6700\u5927\u7684\u70b9\u4e3a $x$,\u8bbe\u70b9\u5bf9\u4e2d\u7684\u70b9\u4e3a $y,z$\uff0c\u5047\u8bbe $d[y]\\leq d[z]\\leq d[x] $\uff0c$t$ \u4e3a $y,z$ \u7684 $lca$\u3002\n\n> 1.\u82e5 $z,y$ \u5c5e\u4e8e $t$ \u7684\u4e0d\u540c\u5b50\u6811\uff0c\u56e0\u4e3a $d[y]\\leq d[x]$\uff0c$d[z]\\leq d[x] $\uff0c\u82e5 $x$ \u4e0d\u5728 $t$ \u7684\u5b50\u6811\u5185\uff0c\u90a3\u4e48\uff0c\u628a $y$ \u6362\u4e3a $x$ \u4f1a\u66f4\u4f18\u3002\u82e5 $x$ \u5728 $t$ \u7684\u5b50\u6811\u5185\uff0c\u5982\u679c $lca(x,z)=t$\uff0c\u663e\u7136\u53ef\u4ee5\u5c06 $y$ \u6362\u6210 $x$\u3002\u5982\u679c $lca(x,z)\\ne t$\uff0c\u90a3\u4e48\u5f88\u660e\u663e\uff0c\u5c06 $z$ \u6362\u6210 $x$ \u4e00\u5b9a\u6bd4\u70b9\u5bf9   $y,z$ \u7684\u7b54\u6848\u66f4\u4f18\uff0c\u6216\u8005\u70b9\u5bf9 $x,z$ \u6bd4\u70b9\u5bf9 $x,y$ \u66f4\u4f18\uff0c\u663e\u7136\u4e0d\u8bba\u54ea\u79cd\u60c5\u51b5\uff0c$x$ \u90fd\u5728\u7b54\u6848\u91cc\u3002\n\n> 2.\u82e5 $z,y$ \u5c5e\u4e8e $t$ \u7684\u540c\u4e00\u68f5\u5b50\u6811\uff0c\u5373 $y=t$\uff0c\u56e0\u4e3a $d[y]\\leq d[x]$\uff0c$d[z]\\leq d[x] $\uff0c\u82e5 $x$ \u4e0d\u5728 $y$  \u7684\u5b50\u6811\u5185\uff0c\u90a3\u4e48\u628a $y$ \u6362\u6210 $x$ \u4f1a\u66f4\u4f18\uff0c\u82e5\u5728 $y$ \u5b50\u6811\u5185\uff0c\u90a3\u4e48\u663e\u7136\u628a $z$ \u6362\u6210 $x$ \u66f4\u4f18\u3002\n\n\u6240\u4ee5\uff0c\u5bf9\u4e8e\u4e0d\u540c\u7ec4\u522b\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u6df1\u5ea6\u6700\u5927\u7684\u70b9\u5373\u53ef\uff0c\u5728 $O(n)$ \u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\uff0c\u4e0e\u540c\u7ec4\u522b\u6df1\u5ea6\u6700\u5927\u7684\u70b9\u6c42\u4e00\u904d $lca$ \u66f4\u65b0\u7b54\u6848\u3002\n\n### $code$\n```\n#include<bits/stdc++.h>\n#define N 200005\nusing namespace std;\nint read(){\n\tint x=0,f=1;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-f;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=(x<<1)+(x<<3)+(ch^48);ch=getchar();}\n\treturn x*f;\n}\nqueue<int> q;\nint n,k,root,tot,t;\nint a[N],p[N],d[N],f[N][25],maxd[N],ans[N],pos[N];\nint Head[N],to[N<<1],Next[N<<1];\nvoid add(int u,int v){to[++tot]=v,Next[tot]=Head[u],Head[u]=tot;}\nvoid bfs(int s){\n\tq.push(s);d[s]=1,maxd[a[s]]=1;\n\twhile(!q.empty()){\n\t\tint x=q.front();q.pop();\n\t\tfor(int i=Head[x];i;i=Next[i]){\n\t\t\tint y=to[i];if(d[y]) continue;\n\t\t\td[y]=d[x]+1,f[y][0]=x;\n\t\t\tif(maxd[a[y]]<d[y]) pos[a[y]]=y;\n\t\t\tmaxd[a[y]]=max(maxd[a[y]],d[y]);\n\t\t\tfor(int j=1;j<=t;j++) f[y][j]=f[f[y][j-1]][j-1];\n\t\t\tq.push(y); \n\t\t}\n\t}\n}\nint lca(int x,int y){\n\tif(d[x]>d[y]) swap(x,y);\n\tfor(int j=t;j>=0;--j)\n\t\tif(d[f[y][j]]>=d[x]) y=f[y][j];\n\tif(x==y) return x;\n\tfor(int j=t;j>=0;--j)\n\t\tif(f[y][j]!=f[x][j]) x=f[x][j],y=f[y][j];\n\treturn f[x][0];\n}\nint DIS(int x,int y){return d[x]+d[y]-2*d[lca(x,y)];}\nsigned main(){\n\tn=read(),k=read();\n\tfor(int i=1;i<=n;++i){\n\t\ta[i]=read(),p[i]=read();\n\t\tif(p[i]==0) root=i;\n\t\telse add(i,p[i]),add(p[i],i);\n\t}\n\tt=log(n)/log(2)+1;\n\tbfs(root);\n\tfor(int i=1;i<=n;++i) ans[a[i]]=max(ans[a[i]],DIS(pos[a[i]],i));\n\tfor(int i=1;i<=k;++i) printf(\"%d\\n\",ans[i]);\n \treturn 0;\n}\n```\n",
        "postTime": 1666506446,
        "uid": 220530,
        "name": "jiangchenyangsong",
        "ccfLevel": 6,
        "title": "P2971 [USACO10HOL]Cow Politics G"
    },
    {
        "content": "\u8fd9\u9053\u9898\u4e2d\uff0c\u6211\u4eec\u9996\u5148\u53ef\u4ee5\u786e\u5b9a\u6700\u957f\u7684\u8ddd\u79bb\u7684\u4e24\u4e2a\u70b9\uff0c\u5176\u4e2d\u4e00\u5b9a\u6709\u4e00\u4e2a\u662f\u8fd9\u4e2a\u653f\u515a\u4e2d\u6df1\u5ea6\u6700\u6df1\u7684\u3002\n\n\u81f3\u4e8e\u8bc1\u660e\u9898\u89e3\u91cc\u7b2c\u4e00\u7bc7\u5c31\u7ed9\u51fa\u4e86\uff0c\u6211\u8fd9\u91cc\u5c31\u4e0d\u5570\u55e6\uff0c~~\u5176\u5b9e\u662f\u6211\u4e5f\u4e0d\u4f1a\uff0c\u6211\u5b9e\u5728\u592a\u83dc\u4e86~~\u3002\n\n\u7136\u540e\u56e0\u4e3a\u8fb9\u7684\u957f\u5ea6\u90fd\u76f8\u7b49\uff0c\u4e14\u90fd\u4e3a1\uff0c\u6240\u4ee5\u4ed6\u4eec\u7684\u8ddd\u79bb\u53ef\u4ee5\u76f4\u63a5\u7528\u4ed6\u4eec\u7684\u6df1\u5ea6\u7b97\uff0c\u5c31\u7b49\u4e8e\u4e24\u4e2a\u8282\u70b9\u7684\u6df1\u5ea6\u548c\u51cf\u53bb\u4e24\u500d\u7684\u4e24\u8282\u70b9\u7684\u6700\u8fd1\u516c\u5171\u7956\u5148\u7684\u6df1\u5ea6\u3002\u5373\n\n```cpp\nL = deep(x) + deep (y) - 2 * deep ( LCA (x,y) )\n```\n\n\u800c\u70b9\u7684\u6df1\u5ea6\u662f\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6765\u7684\uff0c\u53ea\u9700\u8981\u4ece\u6ca1\u6709\u51fa\u5ea6\u7684\u8282\u70b9\u5f80\u4e0a\u904d\u5386\u4e00\u8fb9\u5c31\u597d\uff0c\n\n\u5728\u904d\u5386\u8fc7\u7a0b\u4e2d\u8fd8\u53ef\u4ee5\u987a\u4fbf\u628a\u6bcf\u4e2a\u653f\u515a\u7684\u6700\u6df1\u7684\u8282\u70b9\u627e\u51fa\u6765\u3002\n\n```cpp\nint dfs(int k)\n{\n    if(dep[k]==-1)//\u5982\u679c\u8fd8\u6ca1\u88ab\u5904\u7406\u5c31\u4e00\u76f4\u5f80\u4e0a\u9012\u5f52\u627e\u5230\u5df2\u7ecf\u5904\u7406\u7684\u8282\u70b9\n    {\n        dep[k]=dfs(father[k]);//\u5f53\u524d\u8282\u70b9\u7684\u6df1\u5ea6\u5373\u4ed6\u7684\u7236\u4eb2\u8282\u70b9\u7684\u6df1\u5ea6+1\n        if(dep[zdmax[zd[k]]]<dep[k])\n            zdmax[zd[k]]=k;//\u66f4\u65b0\u653f\u515a\u7684\u6700\u6df1\u8282\u70b9\n    }\n    return dep[k]+1;\n}\nint main()\n{\n    for(int i=1;i<=n;i++)\n        if(out[i]==0)\n        {\n            dep[i]=dfs(father[i]);\n            if(dep[zdmax[zd[i]]]<dep[i])\n                zdmax[zd[i]]=i;\n        }\n}\n```\n\n\u627e\u51fa\u4e86\u6bcf\u4e2a\u70b9\u7684\u6df1\u5ea6\u548c\u6bcf\u4e2a\u653f\u515a\u7684\u6700\u6df1\u7684\u8282\u70b9\uff0c\u8fd9\u9053\u9898\u5c31\u57fa\u672c\u505a\u5b8c\u4e86\u3002\n\n\u63a5\u4e0b\u6765\u53ea\u9700\u8981\u679a\u4e3e\u6bcf\u4e00\u4e2a\u653f\u515a\u7684\u6700\u6df1\u7684\u8282\u70b9\uff0c\u7136\u540e\u627e\u51fa\u5230\u5176\u4ed6\u8282\u70b9\u7684\u6700\u5927\u8ddd\u79bb\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u4f46\u662f\uff0c\u5728\u627e\u6700\u8fd1\u516c\u5171\u7956\u5148\u65f6\uff0c\u7528\u6734\u7d20\u7b97\u6cd5\u4f1a\u88ab\u5361\u6389\uff0c\u6211\u4e00\u5f00\u59cb\u5c31\u88ab\u5361\u6389\u4e86\uff0c\u53ea\u670935\u5206\u3002\n\n\u5fc5\u987b\u8981\u6539\u6210\u500d\u589e\u6c42LCA\u3002\n\n```cpp\nint LCA(int u,int v)\n{\n    if(dep[u]<dep[v])swap(u,v);\n    int dist=dep[u]-dep[v];//\u6c42\u51fa\u6df1\u5ea6\u5dee\n    for(int i=0;(1<<i)<n;i++)\n        if((1<<i)&dist)u=f[u][i];//\u5c06\u4e24\u4e2a\u8282\u70b9\u8c03\u81f3\u540c\u4e00\u9ad8\u5ea6\n    if(u==v)return u;\n    for(int i=logn;i>=0;i--)\n        if(f[u][i]!=f[v][i])\n            u=f[u][i],v=f[v][i];\n    return f[u][0];\n}\nvoid init()\n{\n    for(int i=1;(1<<i)<=n;i++)\n        for(int j=1;j<=n;j++)\n            f[j][i]=f[f[j][i-1]][i-1];\n}//\u9884\u5904\u7406 f \u6570\u7ec4\n/*\n    f[i][j]\u8868\u793a\u4ece i \u5f00\u59cb\uff0c\u5f80\u4e0a\u8df3 2^j \u6b65\u6240\u5230\u7684\u8282\u70b9\n*/\n```\n\u4e0d\u61c2\u500d\u589e\u7684\u540c\u5b66\u53ef\u4ee5\u53bb\u7f51\u4e0a\u627e\u627e\u8d44\u6599\u3002\n\n\u4f46\u662f\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u6211\u5728\u6539\u6210\u500d\u589e\u6c42LCA\u7684\u7b97\u6cd5\u540e\uff0c\u8fd8\u662f\u88ab\u5361\u6389\u4e86\u4e24\u4e2a\u70b9\uff0c\u627e\u4e86\u4e00\u9635\u53d1\u73b0\u5728\u6c42\u7b54\u6848\u65f6\u66b4\u529b\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\u5230\u5f53\u524d\u653f\u515a\u7684\u6700\u6df1\u8282\u70b9\u7684\u8ddd\u79bb\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u592a\u9ad8\u4e86\uff0c\u4e3a O(NK)\u3002\n\n\n```cpp\n    for(int i=1;i<=k;i++)\n    {\n        for(int j=1;j<=n;j++)\n            if(r[j].zd==i&&zdmax[i]!=j)\n            {\n                int u=LCA(zdmax[i],j);\n                ans[i]=max(ans[i],r[zdmax[i]].dep+r[j].dep-(r[u].dep<<1));\n            }\n        printf(\"%d\\n\",ans[i]);\n    }\n```\n\n\u5c31\u50cf\u6211\u8fd9\u6837\uff0c\u80af\u5b9a\u4f1a\u8d85\u65f6\u3002\n\u6211\u4eec\u53ef\u4ee5\u50cf\u6211\u4eec\u7528\u94fe\u5f0f\u524d\u5411\u661f\u5b58\u8fb9\u90a3\u6837\uff0c\u7ef4\u62a43\u4e2a\u6570\u7ec4\uff0c\u5206\u522b\u4ee3\u8868\u7f16\u53f7\u4e3a i \u7684\u653f\u515a\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\uff0c\u7f16\u53f7\u4e3a i \u7684\u8282\u70b9\u7684\u4e0b\u4e00\u4e2a\u76f8\u540c\u653f\u515a\u7684\u7f16\u53f7\uff0c\u4ee5\u53ca\u4e0a\u4e00\u4e2a\u7684\u7f16\u53f7\u3002\n\nint zz[N],nz[N],fz[N];\n\nzz\u4e3a\u4e0a\u4e00\u4e2a\u76f8\u540c\u653f\u515a\u8282\u70b9\u7684\u7f16\u53f7\uff0cnz\u4e3a\u4e0b\u4e00\u4e2a\uff0cfz\u4e3a\u7f16\u53f7\u4e3a i \u7684\u653f\u515a\u51fa\u73b0\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\u7684\u7f16\u53f7\n```cpp\n    for(int i=1;i<=k;i++)\n    {\n        for(int j=fz[i];j<=n;j=nz[j])\n            if(zdmax[i]!=j)\n            {\n                int u=LCA(zdmax[i],j);\n                ans[i]=max(ans[i],dep[zdmax[i]]+dep[j]-(dep[u]<<1));\n            }\n        printf(\"%d\\n\",ans[i]);\n    }\n```\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u907f\u514d\u88ab\u5361\u4e86\u3002\n\n\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\uff1a\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\nusing namespace std;\n\nconst int N = 200000 + 10;\nconst int K = 100000 + 10;\n\nint f[N][20],out[N];\n\nint father[N],dep[N],zd[N];\n\nint n,k,logn;\n\nint zdmax[K],ans[K];\n\nint zz[N],nz[N],fz[N];\n\nint dfs(int k)\n{\n    if(dep[k]==-1)\n    {\n        dep[k]=dfs(father[k]);\n        if(dep[zdmax[zd[k]]]<dep[k])\n            zdmax[zd[k]]=k;\n    }\n    return dep[k]+1;\n}\n\nint LCA(int u,int v)\n{\n    if(dep[u]<dep[v])swap(u,v);\n    int dist=dep[u]-dep[v];\n    for(int i=0;(1<<i)<n;i++)\n        if((1<<i)&dist)u=f[u][i];\n    if(u==v)return u;\n    for(int i=logn;i>=0;i--)\n        if(f[u][i]!=f[v][i])\n            u=f[u][i],v=f[v][i];\n    return f[u][0];\n}\n\nvoid init()\n{\n    for(int i=1;(1<<i)<=n;i++)\n        for(int j=1;j<=n;j++)\n            f[j][i]=f[f[j][i-1]][i-1];\n}\n\nint main()\n{\n    scanf(\"%d%d\",&n,&k);\n    while((1<<logn)<n)logn++;\n    memset(nz,0x3f,sizeof(nz));\n    for(int i=1;i<=n;i++)\n    {\n        int a,p;scanf(\"%d%d\",&a,&p);\n        father[i]=p;\n        zd[i]=a;\n        dep[i]=-1;\n        if(p==0)father[i]=i,dep[i]=0;\n        f[i][0]=father[i];\n        out[p]++;\n        if(fz[a]==0)fz[a]=i;\n        if(zz[a]==0)zz[a]=i;\n        else nz[zz[a]]=i,zz[a]=i;\n    }\n    for(int i=1;i<=n;i++)\n        if(out[i]==0)\n        {\n            dep[i]=dfs(father[i]);\n            if(dep[zdmax[zd[i]]]<dep[i])\n                zdmax[zd[i]]=i;\n        }\n    init();\n    for(int i=1;i<=k;i++)\n    {\n        for(int j=fz[i];j<=n;j=nz[j])\n            if(zdmax[i]!=j)\n            {\n                int u=LCA(zdmax[i],j);\n                ans[i]=max(ans[i],dep[zdmax[i]]+dep[j]-(dep[u]<<1));\n            }\n        printf(\"%d\\n\",ans[i]);\n    }\n    return 0;\n}\n```",
        "postTime": 1568898903,
        "uid": 236021,
        "name": "C_\u65ed",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P2971 \u3010[USACO10HOL]\u725b\u7684\u653f\u6cbbCow Politics\u3011"
    },
    {
        "content": "\n[\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P2971)\n\n[\u4f60\u771f\u7684\u4e0d\u5230\u6211\u7684\u535a\u5ba2\u770b\u4e00\u773c\u5417\uff1f](https://gaisaiyuno.github.io/archives/b13f4097.html)\n\n\u626b\u4e86\u4e00\u773c\u9898\u89e3\uff0c\u53d1\u73b0\u6ca1\u6709\u4e00\u4e2a\u4e25\u8c28\u8bc1\u660e\u7684\uff0c\u90a3\u4e48\u6211\u5c31\u6765\u8bc1\u660e\u4e00\u6ce2\u5427\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u770b\u4e00\u770b\u5982\u4f55\u6c42\u6811\u7684\u76f4\u5f84\uff1a\n\n$1.$\u968f\u4fbf\u5b9a\u4e00\u4e2a\u6839\u8282\u70b9\uff0c\u7b2c\u4e00\u904d$bfs$\u6c42\u51fa\u6811\u4e2d\u6df1\u5ea6\u6700\u6df1\u7684\u8282\u70b9\uff0c\u8bb0\u4e3a$u$\u3002\n\n$2 .$\u4ee5$u$\u4e3a\u6839\u8282\u70b9\uff0c\u7b2c\u4e8c\u904d$bfs$\u6c42\u51fa\u6811\u4e2d\u6df1\u5ea6\u6700\u6df1\u7684\u70b9$v$\n\n$3.$\u6811\u7684\u76f4\u5f84\u7684\u7aef\u70b9\u5373\u4e3a$u,v$\n\n------------------\n\n\u7c7b\u6bd4\u5230\u6b64\u9898\uff1a\n\n\u6211\u4eec\u628a\u653f\u515a$p$\u4e2d\u7684\u725b\u6700\u6df1\u7684\u8bb0\u4e3a$\\max p$\n\n\u53d1\u73b0\uff1a**$p$\u653f\u515a\u6700\u957f\u7684\u94fe\u4e00\u5b9a\u662f\u67d0\u4e2a$p$\u653f\u515a\u7684\u725b\u548c$\\max p$\u6784\u6210\u7684**\uff08\u7c7b\u4f3c\u4e8e\u6811\u7684\u76f4\u5f84\uff09\n\n\u8003\u8651\u5982\u4f55\u8bc1\u660e\u8fd9\u4e2a\u7ed3\u8bba\uff0c\u91c7\u7528\u53cd\u8bc1\u6cd5\uff08\u81ea\u5df1\u753b\u4e00\u4e2a\u56fe\u6bd4\u8f83\u597d\u7406\u89e3\uff09\uff1a\n\n>  \u58f0\u660e\uff1a\u4e3a\u4e86\u7b80\u5316\u8bc1\u660e\uff0c\u6211\u4eec\u8bb0$ab$\u4e3a\u6811\u4e0a$ab$\u4e24\u70b9\u7684\u6700\u77ed\u8def\u5f84\uff0c$dep(a)$\u4e3a\u8282\u70b9$a$\u5728\u6811\u4e2d\u7684\u6df1\u5ea6\u3002\n\n\u8bbe\u67d0\u4e2a$p$\u653f\u515a\u7684\u725b$a$\u548c\u53e6\u4e00\u4e2a\u6df1\u5ea6\u5c0f\u4e8e$\\max p $\u7684\u725b$b$\u6784\u6210\u4e86\u6700\u957f\u7684\u94fe\u3002\n\n\u9996\u5148\uff0c\u6211\u4eec\u6c42\u51fa$lca (a,b)$\uff0c\u8bbe\u4e3a$c$\uff0c\u6c42\u51fa$lca(a,\\max p)$\uff0c\u8bbe\u4e3a$c'$\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c$c'$\uff0c$c$\u6709\u76f4\u63a5\u7684\u7956\u5148\u5173\u7cfb\uff0c\u4e5f\u6709\u53ef\u80fd$c=c'$\uff0c\u7b80\u5355\u6765\u8bf4\uff0c\u5c31\u662f\u5728\u540c\u4e00\u6761\u5230\u6839\u8282\u70b9\u7684\u94fe\u4e0a\u3002\uff08\u8fd9\u4e00\u70b9\u53c2\u89c1\u865a\u6811\u7684\u8bc1\u660e\uff09\n\n\u8003\u8651\u4e24\u79cd\u60c5\u51b5\uff1a\n\n$1.c'$\u7684\u7956\u5148\u4e3a$c$\uff08\u5982\u56fe\uff09\uff0c\u90a3\u6211\u4eec\u6709$c'\\max p+cc'+dep(c)=dep({\\max p})$\uff0c\u4e14$cb+dep(c)=dep(b)$\uff0c\n\n\u7531$dep(b) < dep({\\max p})$\uff0c\u4e24\u5f0f\u76f8\u51cf\uff0c\u53d1\u73b0$dep(c)$\u62b5\u6d88\uff0c\u6211\u4eec\u6709$cb<c' \\max p+cc'...x$\n\n\u53d1\u73b0$ab=ac'+c'c+cb$\uff0c\u4e14$a\\max p=ac'+c'\\max p$\uff0c\u5c06$x$\u5f0f\u4ee3\u5165\uff0c\u6211\u4eec\u6709$ab=ac'+c'c+cb<ac'+c'c+c'\\max p+c'c=a\\max p+cc' \\times 2$\n\n\u7531\u4e8e$c'$\u7684\u7956\u5148\u4e3a$c$\uff0c\u6240\u4ee5$cc'>0$\uff0c\u6240\u4ee5$ab<a\\max p$\uff0c\u5047\u8bbe\u9519\u8bef\u3002\n\n![](https://cdn.luogu.com.cn/upload/pic/65121.png)\n\n$2.c$\u7684\u7956\u5148\u4e3a$c'$\uff0c\u8bc1\u660e\u65b9\u6cd5\u5dee\u4e0d\u591a\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u6c42\u4e00\u6ce2$LCA$\uff0c\u7136\u540e\u9884\u5904\u7406\u51fa$\\max p$\uff0c\u6700\u540e\u66b4\u529b\u626b\u8fc7\u4e00\u904d\u6240\u6709\u7684\u725b\uff0c\u6c42\u51fa\u7b54\u6848\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n\\log n)$\n\n```cpp\n#include <bits/stdc++.h>\n#define MAXN 200005\n#define MAXM 25\nusing namespace std;\ninline int read(){\n    int x=0,f=1;\n    char ch=getchar();\n    while (ch<'0'||ch>'9'){\n        if (ch=='-') f=-1;\n        ch=getchar();\n    }\n    while (ch>='0'&&ch<='9'){\n        x=(x<<3)+(x<<1)+(ch^'0');\n        ch=getchar();\n    }\n    return x*f;\n}\nvector<int>G[MAXN];\ninline void AddEdge(int u,int v){\n    G[u].push_back(v);\n}\nint anc[MAXN][MAXM],dep[MAXN],n,m;\nvoid dfs(int u,int father){\n    anc[u][0]=father;\n    for (register int i=1;i<MAXM;++i){\n        anc[u][i]=anc[anc[u][i-1]][i-1];\n    }\n    for (register int i=0;i<G[u].size();++i){\n        int v=G[u][i];\n        if (v!=father){\n            dep[v]=dep[u]+1;\n            dfs(v,u);\n        }\n    }\n}\ninline int LCA(int u,int v){\n    if (dep[u]<dep[v]) swap(u,v);\n    for (register int i=MAXM-1;i>=0;--i){\n        if (dep[anc[u][i]]>=dep[v]){\n            u=anc[u][i];\n        }\n    }\n    if (u==v) return u;\n    for (register int i=MAXM-1;i>=0;--i){\n        if (anc[u][i]!=anc[v][i]){\n            u=anc[u][i];\n            v=anc[v][i];\n        }\n    }\n    return anc[u][0];\n}\ninline void Init(int root){\n    memset(dep,0,sizeof(dep));\n    dfs(root,0);\n}\nint val[MAXN],maxu[MAXN],maxdep[MAXN],ans[MAXN];\ninline int Dis(int u,int v){\n    return dep[u]+dep[v]-2*dep[LCA(u,v)];\n}\nint main(){\n    int n=read(),k=read();\n    int root;\n    for (register int i=1;i<=n;++i){\n        int a=read(),p=read();\n        val[i]=a;\n        AddEdge(i,p),AddEdge(p,i);\n        if (!p) root=i;\n    }\n    Init(root);\n    for (register int i=1;i<=n;++i){//\u9884\u5904\u7406\n        if (dep[maxu[val[i]]]<dep[i]) maxu[val[i]]=i;\n    }\n    for (register int i=1;i<=n;++i){\n        ans[val[i]]=max(ans[val[i]],Dis(maxu[val[i]],i));\n    }\n    for (register int i=1;i<=k;++i){\n        printf(\"%d\\n\",ans[i]);\n    }\n}\n```\n\n",
        "postTime": 1563791453,
        "uid": 45109,
        "name": "Steven_Meng",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2971 \u3010[USACO10HOL]\u725b\u7684\u653f\u6cbbCow Politics\u3011"
    },
    {
        "content": "**\u6ca1\u6709\u7528\u70b9\u5206\u6cbb\u7684\uff1f**\n~~\u6211\u5e76\u4e0d\u662f\u6ca1\u60f3\u5230\u7528LCA~~\n\u90a3\u4e48\u8fd9\u9053\u9898\u6211\u4eec\u53ef\u4ee5\u5f00\u4e00\u4e2a\u6876\u7ef4\u62a4\u626b\u5230\u7684\u5f53\u524d\u5b50\u6811\u4e2d\u6bcf\u4e2a\u653f\u515a\u5230\u91cd\u5fc3\u7684\u8ddd\u79bb\u6700\u5927\u503c\n\u518d\u53d6\u4e2amax\u5c31\u5b8c\u4e86\uff0c\u7136\u540e\u5c31\u662f\u70b9\u5206\u6cbb\u677f\u5b50\u5566\n\n```c\n#include<bits/stdc++.h>\n#define maxn 200010\n#define INF 0x7f7f7f7f\nusing namespace std;\nint n,k,p,t,Maxl,root,Size;\nint head[maxn],to[maxn*2],next[maxn*2];\nint vis[maxn],size[maxn],ans[maxn],pail[maxn];\n//pail\u5c31\u662f\u6bcf\u4e2a\u653f\u515a\u5230\u91cd\u5fc3\u7684\u8ddd\u79bb\u6700\u5927\u503c \nint a[maxn],dis[maxn],re[maxn];\n//dis\u662f\u6bcf\u4e2a\u70b9\u5230\u91cd\u5fc3\u7684\u8ddd\u79bb,re\u5b58\u626b\u8fc7\u7684\u70b9 \nvoid add(int u,int v)\n{\n\tto[++p]=v; next[p]=head[u];\n\thead[u]=p;\n}\nvoid Getroot(int x,int fa)\n{\n\tint Max=0;size[x]=1;\n\tfor(int i=head[x];i;i=next[i])\n\t{\n\t\tint v=to[i];\n\t\tif(v==fa||vis[v]) continue;\n\t\tGetroot(v,x);\n\t\tsize[x]+=size[v];\n\t\tMax=max(Max,size[v]);\n\t}\n\tMax=max(Max,Size-size[x]);\n\tif(Maxl>Max) Maxl=Max,root=x;\n}\nvoid find(int x,int fa,int len)\n{\n\tre[++t]=x; dis[x]=len;\n\tfor(int i=head[x];i;i=next[i])\n\t{\n\t\tint v=to[i];\n\t\tif(vis[v]||v==fa) continue;\n\t\tfind(v,x,len+1);\n\t}\n}\nvoid calc(int x)\n{\n\tt=0; \n\tfor(int i=head[x];i;i=next[i])\n\t{\n\t\tint v=to[i];\n\t\tif(vis[v]) continue;\n\t\tint now=t;\n\t\tfind(v,x,1);\n\t\tfor(int j=now+1;j<=t;j++) \n\t\t{\n\t\t\tif(pail[a[re[j]]])\n\t\t\tans[a[re[j]]]=max(ans[a[re[j]]],dis[re[j]]+pail[a[re[j]]]);\n\t\t\tif(a[re[j]]==a[x])//\u6ce8\u610f\u7279\u5224\u4e00\u4e0b\u91cd\u5fc3\u4e0e\u8fd9\u4e2a\u70b9\u662f\u5426\u653f\u515a\u76f8\u540c \n\t\t\tans[a[re[j]]]=max(ans[a[re[j]]],dis[re[j]]);\t\n\t\t}\n\t\tfor(int j=now+1;j<=t;j++) pail[a[re[j]]]=max(pail[a[re[j]]],dis[re[j]]);\n\t}\n\tfor(int i=1;i<=t;i++) pail[a[re[i]]]=0,re[i]=0;\n}\nvoid Divide(int x,int sum)//\u5206\u6cbb \n{\n\tvis[x]=1; calc(x);\n\tfor(int i=head[x];i;i=next[i])\n\t{\n\t\tint v=to[i];\n\t\tif(vis[v]) continue;\n\t\tMaxl=INF;\n\t\tSize=size[v]<size[x]?size[v]:sum-size[x];\n\t\tGetroot(v,v);\n\t\tDivide(root,Size);\n\t}\n}\nint main()\n{\n\tint x;\n\tscanf(\"%d%d\",&n,&k);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d%d\",&a[i],&x);\n\t\tif(x) add(x,i),add(i,x);\n\t}\t\n\tMaxl=INF; Size=n; Getroot(1,1);\n\tDivide(root,n);\n\tfor(int i=1;i<=k;i++) printf(\"%d\\n\",ans[i]);\n\treturn 0;\n} \n```\n",
        "postTime": 1563418594,
        "uid": 112003,
        "name": "_Chris\u00b0",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2971 \u3010[USACO10HOL]\u725b\u7684\u653f\u6cbbCow Politics\u3011"
    },
    {
        "content": "\u4f3c\u4e4e\u662f\u4e00\u4e2a\u5f88\u7b80\u6d01\u7684\u65b0\u505a\u6cd5\u3002\n\n\u663e\u7136 $k$ \u4e2a\u70b9\u96c6\u4e92\u4e0d\u5e72\u6270\uff0c\u53ef\u4ee5\u5206\u5f00\u5904\u7406\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u96c6\uff0c\u9996\u5148\u53d6\u51fa\u4e24\u4e2a\u70b9 $u,v$ \u4f5c\u4e3a\u6700\u8fdc\u7684\u4e24\u4e2a\u70b9\uff08\u4e3a\u8868\u8ff0\u65b9\u4fbf\u4e0b\u6587\u79f0\u4e3a\u76f4\u5f84\uff09\uff0c\u7136\u540e\u8003\u8651\u5411\u70b9\u96c6\u4e2d\u52a0\u5165\u70b9 $w$ \u7684\u8fc7\u7a0b\u3002\u6211\u4eec\u8ba1\u7b97\u51fa $d_1=\\operatorname{dis}(u,v),d_2=\\operatorname{dis}(u,w),d_3=\\operatorname{dis}(v,w)$\uff0c\u5219\u70b9\u96c6\u7684\u76f4\u5f84\u4e3a $\\max\\{d_1,d_2,d_3\\}$\u3002\u5224\u65ad\u51fa\u54ea\u4e24\u4e2a\u70b9\u662f\u65b0\u7684\u76f4\u5f84\uff0c\u7136\u540e\u5728\u8fd9\u4e2a\u65b0\u7684\u76f4\u5f84\u7684\u57fa\u7840\u4e0a\u7ee7\u7eed\u52a0\u70b9\u5373\u53ef\u3002\n\n\u6b63\u786e\u6027\u7684\u8bdd\uff0c\u7c7b\u4f3c\u4e8e\u6b63\u5e38\u7684\u6811\u7684\u76f4\u5f84\uff0c\u5230\u4e00\u4e2a\u70b9\u8ddd\u79bb\u6700\u8fdc\u7684\u70b9\u4e00\u5b9a\u662f\u4e00\u6761\u76f4\u5f84\u7684\u7aef\u70b9\u3002\u82e5\u65b0\u7684\u70b9\u8981\u4f5c\u4e3a\u76f4\u5f84\u7aef\u70b9\uff0c\u53ea\u80fd\u662f\u5230\u539f\u6765\u76f4\u5f84\u4e24\u7aef\u8ddd\u79bb\u6709\u4e00\u4e2a\u6bd4\u539f\u6765\u76f4\u5f84\u8981\u957f\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log n)$\u3002\n\n```cpp\n// Problem: P2971 [USACO10HOL]Cow Politics G\n// Contest: Luogu\n// URL: https://www.luogu.com.cn/problem/P2971\n// Memory Limit: 125 MB\n// Time Limit: 1000 ms\n// \n// Powered by CP Editor (https://cpeditor.org)\n\n//By: OIer rui_er\n#include <bits/stdc++.h>\n#define rep(x,y,z) for(int x=(y);x<=(z);x++)\n#define per(x,y,z) for(int x=(y);x>=(z);x--)\n#define debug(format...) fprintf(stderr, format)\n#define fileIO(s) do{freopen(s\".in\",\"r\",stdin);freopen(s\".out\",\"w\",stdout);}while(false)\nusing namespace std;\ntypedef long long ll;\nconst int N = 2e5+5;\n\nint n, k, a[N], fa[N][19], dis[N], rt;\nvector<int> d[N], e[N];\ntemplate<typename T> void chkmin(T& x, T y) {if(x > y) x = y;}\ntemplate<typename T> void chkmax(T& x, T y) {if(x < y) x = y;}\nvoid dfs(int u) {\n\tdis[u] = dis[fa[u][0]] + 1;\n\trep(i, 1, 18) fa[u][i] = fa[fa[u][i-1]][i-1];\n\tfor(int v : e[u]) dfs(v);\n}\nint LCA(int u, int v) {\n\tif(dis[u] < dis[v]) swap(u, v);\n\tper(i, 18, 0) if(dis[fa[u][i]] >= dis[v]) u = fa[u][i];\n\tif(u == v) return u;\n\tper(i, 18, 0) if(fa[u][i] != fa[v][i]) u = fa[u][i], v = fa[v][i];\n\treturn fa[u][0];\n}\nint dist(int u, int v) {\n\treturn dis[u] + dis[v] - 2 * dis[LCA(u, v)];\n}\n\nint main() {\n\tscanf(\"%d%d\", &n, &k);\n\trep(i, 1, n) {\n\t\tscanf(\"%d%d\", &a[i], &fa[i][0]);\n\t\tif(!fa[i][0]) rt = i;\n\t\td[a[i]].push_back(i);\n\t\te[fa[i][0]].push_back(i);\n\t}\n\tdfs(rt);\n\trep(i, 1, k) {\n\t\tint u = d[i][0], v = d[i][1], sz = d[i].size();\n\t\tfor(int j=2;j<sz;j++) {\n\t\t\tint w = d[i][j];\n\t\t\tint d1 = dist(u, v), d2 = dist(u, w), d3 = dist(v, w);\n\t\t\tint diameter = max(d1, max(d2, d3));\n\t\t\tint U = 0, V = 0;\n\t\t\tif(d1 == diameter) U = u, V = v;\n\t\t\telse if(d2 == diameter) U = u, V = w;\n\t\t\telse U = v, V = w;\n\t\t\tu = U; v = V;\n\t\t}\n\t\tprintf(\"%d\\n\", dist(u, v));\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1662892980,
        "uid": 122461,
        "name": "rui_er",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2971\u3010[USACO10HOL]Cow Politics G\u3011"
    },
    {
        "content": "\u8bf4\u53e5\u95f2\u8bdd\uff0c\u6211\u5728\u6d1b\u8c37\u4e0a WA \u4e86\u7b2c 13 \u4e2a\u70b9\uff0c\u4f46\u6570\u636e\u4e0b\u8f7d\u4e0b\u6765\u53d1\u73b0\u662f\u5bf9\u7684\uff0c\u6240\u4ee5\u505a\u6cd5\u6ca1\u95ee\u9898\uff0c\u53ea\u662f\u6709UB\uff0c\u7136\u540e\u61d2\u5f97\u67e5\u4e86\uff08\n\n\u53d1\u73b0\u8fd9\u4e2a\u9898\u9898\u89e3\u53ea\u6709\u4e00\u4e2a\u70b9\u5206\u6cbb\uff0c\u611f\u89c9\u9700\u8981\u7a0d\u5fae\u8be6\u7ec6\u4e00\u70b9\u7684\u8bb2\u89e3\u3002\n\n\u70b9\u5206\u6cbb\u5177\u4f53\u505a\u6cd5\u8bf7\u67e5\u9605[\u6a21\u677f](https://www.luogu.com.cn/problem/P3806)\uff0c\u8fd9\u91cc\u4ec5\u63d0\u4f9b\u601d\u8003\u8fc7\u7a0b\u3002\n\n\u9996\u5148\u5047\u8bbe\u6240\u6709\u5976\u725b\u90fd\u4e3a\u540c\u4e00\u79cd\u7c7b\uff0c\u90a3\u4e48\u95ee\u9898\u7b49\u4ef7\u4e8e\u6c42\u6811\u4e0a\u7684\u6700\u8fdc\u70b9\u5bf9\u3002\u82e5\u4f7f\u7528\u70b9\u5206\u6cbb\uff0c\u5219\u6211\u4eec\u73c2\u4ee5\u8003\u8651\u8bb0\u5f55\u6bcf\u4e2a\u8282\u70b9\u7684\u6df1\u5ea6\uff0c\u7136\u540e\u5408\u5e76\u5b50\u6811\u65f6\u5019\u53d6\u4e24\u8fb9\u7684\u53f6\u8282\u70b9\u6df1\u5ea6\u548c\u5373\u53ef\u3002\n\n\u90a3\u4e48\u73b0\u5728\u95ee\u9898\u5f3a\u5316\u4e3a\u4e0d\u540c\u79cd\u7c7b\u7684\u725b\uff0c\u53d1\u73b0\u5149\u8bb0\u5f55\u53f6\u8282\u70b9\u5e76\u6ca1\u6709\u529e\u6cd5\u4fdd\u8bc1\u8bb0\u5f55\u5230\u6240\u6709\u79cd\u7c7b\u7684\u725b\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u8282\u70b9\u7684\u6570\u91cf\u56fa\u5b9a\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684\u8def\u5f84\u662f\u6709\u9650\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u8003\u8651\u628a\u6bcf\u79cd\u5976\u725b\u90fd\u5f53\u6210\u72ec\u7acb\u7684\u4e00\u9897\u6811\uff0c\u5728\u8bb0\u5f55\u8def\u5f84\u65f6\u5206\u522b\u8bb0\u5f55\u6bcf\u4e2a\u8282\u70b9\u7684\u6df1\u5ea6\u548c\u4ed6\u7684\u79cd\u7c7b\n```cpp\ninline void getdis(int u, int fa, int dep=1){\n    cor[++cnt] = pos[u];//cor\u8bb0\u5f55\u8282\u70b9\u7684\u79cd\u7c7b,judge\u8bb0\u5f55\u6df1\u5ea6\n    judge[cnt] = dep;\n    trav(i,u){\n      int v = edge[i].v;\n      if (vis[v] || v==fa) continue;\n      getdis(v,u,dep+1);\n    }\n  }\n```\n\n\u5728\u5408\u5e76\u7684\u65f6\u5019\u6211\u4eec\u53ea\u5408\u5e76\u76f8\u540c\u79cd\u7c7b\u7684\u5976\u725b\u3002\u6ce8\u610f\u5982\u679c\u8fd9\u4e2a\u9898\u7684 $k$ \u6269\u5927\u5230 $10^9$\uff0c\u90a3\u6211\u4eec\u9700\u8981\u5c06\u5176\u79bb\u6563\u5316\uff08\u5f53\u7136\u8fd9\u9898\u6ca1\u6709\u8981\u6c42\uff09\u3002\n\n```cpp\ninline void calc(int u){\n    int ptr = 0;\n    trav(i,u){\n      int v = edge[i].v;\n      if (vis[v]) continue;\n      cnt = 0;\n      getdis(v,u);\n      For(j,1,cnt) if (all[cor[j]]) Ans[cor[j]] = chkmax(Ans[cor[j]],all[cor[j]]+judge[j]);//Ans[i]\u662f\u7b2c i \u79cd\u725b\u7684\u6700\u5927\u8ddd\u79bb\n      For(i,1,cnt) q[++ptr] = cor[j],all[cor[j]] = chkmax(all[cor[j]],judge[j]),judge[j] = cor[j] = 0;//\u70b9\u5206\u6cbb\u66f4\u65b0\u5f53\u524d\u94fe\u5b50\u6700\u5927\u503c,\u57fa\u672c\u64cd\u4f5c\n    }\n    For(i,1,ptr) all[q[i]] = 0;\n  }\n  }\n```\n\n\u6700\u540e\u76f4\u63a5\u8f93\u51fa\u6bcf\u4e2a Ans \u5373\u53ef\u3002\n\n\u4e0d\u52a0\u5934\u6587\u4ef6\u7684\u4ee3\u7801:\n\n```cpp\nconst int MAXN = 1e7+5;\nconst int MAXM = 1e7+5;\nconst int MAXK = 1e7+5;\nconst int mod = 1e9+7;\nint dx[4] = {1,0,-1,0}, dy[4] = {0,1,0,-1};\nint n,m,t,l,k,a,b,c,pos[MAXN],ans;\nnamespace AdjEdge{\n  //var\n  int head[MAXN],tot;\n  struct Edge{\n    int u,v,d,nxt;\n  }edge[MAXM<<1];\n  inline void add(int u, int v, int d=0){\n    edge[++tot].u = u;\n    edge[tot].v = v;\n    edge[tot].d = d;\n    edge[tot].nxt = head[u];\n    head[u] = tot;\n  }\n}\nusing namespace AdjEdge;\nnamespace Centroid_Decomposition{\n  int rt=0,judge[MAXK],all[MAXK],dp[MAXN],son[MAXN],sz[MAXN],cnt,Ans[MAXN],sum,Q[MAXN],dis[MAXN],cor[MAXN];\n  bool vis[MAXN];\n  inline void getroot(int u, int fa=-1){\n    dp[u] = 0, sz[u] = 1;\n    trav(i,u){\n      int v = edge[i].v;\n      if (vis[v] || v==fa) continue;\n      getroot(v,u);\n      sz[u]+=sz[v];\n      dp[u] = chkmax(dp[u],sz[v]);\n    }\n    dp[u] = chkmax(dp[u],sum-sz[u]);\n    if (dp[u]<dp[rt]) rt = u;\n  }\n  inline void getdis(int u, int fa, int dep=1){\n    cor[++cnt] = pos[u];//cor\u8bb0\u5f55\u8282\u70b9\u7684\u79cd\u7c7b,judge\u8bb0\u5f55\u6df1\u5ea6\n    judge[cnt] = dep;\n    trav(i,u){\n      int v = edge[i].v;\n      if (vis[v] || v==fa) continue;\n      getdis(v,u,dep+1);\n    }\n  }\n  int q[MAXK];\n  inline void calc(int u){\n    int ptr = 0;\n    trav(i,u){\n      int v = edge[i].v;\n      if (vis[v]) continue;\n      cnt = 0;\n      getdis(v,u);\n      For(j,1,cnt) if (all[cor[j]]) Ans[cor[j]] = chkmax(Ans[cor[j]],all[cor[j]]+judge[j]);//Ans[i]\u662f\u7b2c i \u79cd\u725b\u7684\u6700\u5927\u8ddd\u79bb\n      For(i,1,cnt) q[++ptr] = cor[j],all[cor[j]] = chkmax(all[cor[j]],judge[j]),judge[j] = cor[j] = 0;//\u70b9\u5206\u6cbb\u66f4\u65b0\u5f53\u524d\u94fe\u5b50\u6700\u5927\u503c,\u57fa\u672c\u64cd\u4f5c\n    }\n    For(i,1,ptr) all[q[i]] = 0;\n  }\n  inline void divide(int u=rt){\n    vis[u] = true;\n    calc(u);\n    trav(i,u){\n      int v = edge[i].v;\n      if (vis[v]) continue;\n      sum = sz[v]; dp[rt=0] = sz[v];\n      getroot(v,u);\n      divide(rt);\n    }\n  }\n}\nusing namespace Centroid_Decomposition;\nsigned main(){\n  n = read(); k = read();\n  For(i,1,n){\n    a = read(); b = read();\n    if (b) add(i,b),add(b,i);\n    pos[i] = a;\n  }\n  dp[rt] = sum = n;\n  getroot(1);\n  divide();\n  For(i,1,k) writeln(Ans[i]);\n}\n```",
        "postTime": 1617442103,
        "uid": 219099,
        "name": "pocafup",
        "ccfLevel": 0,
        "title": "P2971 [USACO10HOL]Cow Politics G \u9898\u89e3"
    },
    {
        "content": "\u9996\u5148\u9700\u8981\u77e5\u9053\u5728\u53ea\u6709\u4e00\u4e2a\u653f\u515a\u7684\u60c5\u51b5\u4e0b\uff0c\u9898\u76ee\u5f31\u5316\u4e3a\u6c42\u4e00\u4e2a\u6811\u4e2d\u6700\u8fdc\u7684\u4e24\u4e2a\u70b9\u7684\u8ddd\u79bb\uff0c\u8fd9\u4e2a\u662f\u53ef\u4ee5\u7528\u4e24\u904dBFS\u7684\u65b9\u6cd5\u6c42\u51fa\uff0c\u5177\u4f53\u6b65\u9aa4\u4e3a\uff1a\n\n- \u968f\u4fbf\u9009\u62e9\u4e00\u4e2a\u8282\u70b9x\uff0cBFS\u6c42\u51fa\u8ddd\u79bbx\u6700\u8fdc\u7684\u8282\u70b9y\uff08\u6709\u76f8\u540c\u7684\u968f\u4fbf\u9009\uff09\u3002\n\n- \u4ee5\u8282\u70b9y\u4e3a\u8d77\u70b9\uff0cBFS\u6c42\u51fa\u8ddd\u79bby\u6700\u8fdc\u7684\u8282\u70b9z\uff08\u6709\u76f8\u540c\u7684\u968f\u4fbf\u9009\uff09\u3002\n\n- \u8282\u70b9y\u548c\u8282\u70b9z\u4e4b\u95f4\u7684\u8ddd\u79bb\uff0c\u5c31\u662f\u8fd9\u68f5\u6811\u4e2d\u6700\u8fdc\u8ddd\u79bb\u3002\n\n\n\u6709\u4e86\u4e0a\u9762\u8fd9\u4e2a\u4e4b\u540e\uff0c\u5728\u672c\u9898\u4e2d\uff0c\u6211\u4eec\u5bf9\u6bcf\u4e2a\u653f\u515a\u90fd\u505a\u4e00\u904d\u8fd9\u4e2a\u65b9\u6cd5\u5373\u53ef\uff0c\u4f46\u662f\u6211\u4eec\u4e0d\u80fd\u8fdb\u884cBFS\u4e86\u3002\u6ce8\u610f\u5230BFS\u53ea\u662f\u4e3a\u4e86\u6c42\u8ddd\u79bb\u6700\u8fdc\u7684\u70b9\uff0c\u90a3\u4e48\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u65b9\u6cd5\u6765\u6c42\u5f97\u4efb\u610f\u4e24\u70b9\u95f4\u8ddd\u79bb\u7684\u8bdd\uff0c\u6b65\u9aa4\u5c31\u53ef\u4ee5\u8f6c\u53d8\u4e3a\uff1a\n\n- \u968f\u4fbf\u9009\u62e9\u8be5\u653f\u515a\u7684\u4e00\u4e2a\u8282\u70b9x\uff0c\u679a\u4e3e\u8be5\u653f\u515a\u7684\u5176\u4ed6\u8282\u70b9\uff0c\u6c42\u51fa\u8ddd\u79bbx\u6700\u8fdc\u7684\u8282\u70b9y\u3002\n\n- \u4ee5\u8282\u70b9y\u4e3a\u8d77\u70b9\uff0c\u679a\u4e3e\u8be5\u653f\u515a\u7684\u5176\u4ed6\u8282\u70b9\uff0c\u6c42\u51fa\u8ddd\u79bby\u6700\u8fdc\u7684\u8282\u70b9z\u3002\n\n- \u8282\u70b9y\u548c\u8282\u70b9z\u7684\u8ddd\u79bb\uff0c\u5c31\u662f\u8be5\u653f\u515a\u7684\u6700\u8fdc\u8ddd\u79bb\u3002\n\n\n\u5bf9\u4e8e\u6c42\u6811\u4e0a\u4efb\u610f\u4e24\u70b9\u95f4\u7684\u8ddd\u79bb\uff0c\u4e00\u822c\u8f6c\u5316\u4e3a\u6c42LCA\u7684\uff0c\u5373\n\n\nDist(x, y) = Depth(x) + Depth(y) - 2 \\* Depth(LCA(x, y))\n\n\u6c42LCA\u7684\u65b9\u6cd5\u6709\u5f88\u591a\uff0c\u8fd9\u91cc\u5c31\u4e0d\u518d\u63cf\u8ff0\u4e86\u3002\n",
        "postTime": 1509160216,
        "uid": 54522,
        "name": "\u51b7\u6708\u51b0\u77b3",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2971 \u3010[USACO10HOL]\u725b\u7684\u653f\u6cbbCow Politics\u3011"
    },
    {
        "content": "\u770b\u5230\u9898\u89e3\u91cc\u9762\u6ca1\u6709\u865a\u6811\u7684\u505a\u6cd5\uff0c\u6765\u53d1\u4e00\u4e0b\u3002\n\n## $Solution$\n\n\u6211\u4eec\u5148\u4ece\u7b80\u5355\u7684\u60c5\u51b5\u5165\u624b\uff0c\u8003\u8651 $k = 1$ \u7684\u60c5\u51b5\u600e\u4e48\u505a\u3002\n\n\u5f88\u663e\u7136\uff0c\u6b64\u65f6\u7684\u6700\u957f\u957f\u5ea6\u5c31\u662f\u6811\u7684\u76f4\u5f84\u3002\n\n\u90a3\u4e48\uff0c\u5982\u679c $k > 1$ \u5462\uff1f\u662f\u4e0d\u662f\u5bf9\u4e8e\u8fd9\u4e9b\u70b9\u5efa\u51fa\u7684\u6811\u6765\u8bf4\uff0c\u8ddd\u79bb\u8fd8\u662f\u6811\u7684\u76f4\u5f84\uff1f\n\n\u6240\u4ee5\uff0c\u53ef\u4ee5\u8003\u8651\u5bf9\u6bcf\u79cd\u989c\u8272\u5efa\u4e00\u68f5\u865a\u6811\uff0c\u8fb9\u6743\u4e3a\u4e24\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\uff0c\u7136\u540e\u8dd1\u6811\u7684\u76f4\u5f84\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $O(n\\ log\\ n)$\n\n## $Code:$\n\n```cpp\n#include <bits/stdc++.h>\n#include <tr1/unordered_map>\n//#include\"Bignum/bignum.h\"\n//#define big bignum\n#define lowbit(x) (x & -x)\n#define debug(x) (cout << \"#x = \" << (x) << endl)\n#define Set(x, i) memset (x, i, sizeof(x))\n#define R register\n#define For(i, j, k) for(R int i = (j), ED = (k); i <= ED; ++i)\n#define Rep(i, j, k) for(R int i = (j), ED = (k); i >= ED; --i)\n#define Cross(i, j, k) for(R int i = (j); i; i = (k))\nusing namespace std;\ntypedef long long ll;\nconst ll N = 200011;\nconst ll INF = 5e16;\n\nnamespace IO {\n\n    inline char gc() {\n        static char buf[100000], *p1 = buf, *p2 = buf;\n        return (p1 == p2) && (p2 = (p1 = buf) +\n            fread(buf, 1, 100000, stdin), p1 == p2)? EOF: *p1++;\n    }\n\n    #define dd ch = getchar()\n    inline ll read() {\n        R ll x = 0; R int f = 0; R char dd;\n        for (; !isdigit(ch); dd) f ^= (ch == '-');\n        for (; isdigit(ch); dd)  x = x * 10 + (ch ^ 48);\n        return f? -x: x;\n    }\n\n    inline void write ( ll x ) {\n        if (x < 0) x = -x, putchar('-');\n        if (x > 9) write(x / 10); putchar(x % 10 | 48);\n    }\n\n    inline void wrn ( ll x ) { write(x), putchar(' '); }\n\n    inline void wln ( ll x ) { write(x), putchar('\\n'); }\n\n    inline void wlnn ( ll x, ll y ) { wrn(x), wln(y); }\n\n}\n\nusing IO::wln;\nusing IO::read;\n\nnamespace Cesare {\n    \n    ll n, k, cc, tot, Max, pos, Len[N];\n    ll top = 0, root = 0, stk[N], dep[N];\n    ll Zr[N], ID[N], col[N], dfn[N], f[21][N];\n    \n    vector <ll> Ve[N >> 1];\n    \n    inline bool cmp ( ll a, ll b ) { return dfn[a] < dfn[b]; }\n    \n    struct edge {\n        ll To, Next;\n    } e[N << 1];\n    \n    ll cnt = 0, head[N];\n    \n    inline void add ( ll u, ll v ) {\n        e[++cnt].To = v, e[cnt].Next = head[u], head[u] = cnt;\n        e[++cnt].To = u, e[cnt].Next = head[v], head[v] = cnt;\n    }\n    \n    struct Edge {\n        ll To, Next, w;\n    } E[N << 1];\n    \n    ll Cnt = 0;\n    \n    tr1::unordered_map <ll, ll> Head;\n    \n    inline void Add ( ll u, ll v, ll w ) {\n        E[++Cnt].To = v, E[Cnt].w = w, E[Cnt].Next = Head[u], Head[u] = Cnt;\n        E[++Cnt].To = u, E[Cnt].w = w, E[Cnt].Next = Head[v], Head[v] = Cnt;\n    }\n    \n    inline void dfs ( ll u, ll fa ) {\n        dfn[u] = ++tot;\n        f[0][u] = fa, dep[u] = dep[fa] + 1;\n        For ( i, 1, 19 ) f[i][u] = f[i - 1][f[i - 1][u]];\n        Cross ( i, head[u], e[i].Next ) if (e[i].To != fa) dfs(e[i].To, u);\n    }\n    \n    inline ll LCA ( ll x, ll y ) {\n        if (dep[x] < dep[y]) swap(x, y);\n        Rep ( i, 19, 0 ) \n            if (dep[f[i][x]] >= dep[y]) x = f[i][x];\n        if (x == y) return x;\n        Rep ( i, 19, 0 ) \n            if (f[i][x] != f[i][y]) x = f[i][x], y = f[i][y];\n        return f[0][x];\n    }\n    \n    inline void Dfs ( ll u, ll fa ) {\n//\t\tif (nk == 491) debug(u);\n        for (R int i = Head[u], v; i; i = E[i].Next)\n            if (fa != (v = E[i].To)) {\n\t\t\t\tLen[v] = Len[u] + E[i].w;\n//\t\t\t\tcout << \"!\" << u << \" -> \" << v << \" Cost = \" << E[i].w << endl;\n                if (Max < Len[v]) Max = Len[v], pos = v;\n                Dfs(Zr[++cc] = v, u);\n            }\n    }\n    \n    inline void Insert ( ll u ) {\n        if (top == 1) \n            return (void) (stk[++top] = u);\n        ll lca = LCA(u, stk[top]);\n        if (lca == stk[top]) \n            return (void) (stk[++top] = u);\n        for (; top > 1 && dfn[lca] <= dfn[stk[top - 1]]; --top) {\n            ll Lca = dep[LCA(stk[top - 1], stk[top])];\n            ll dis = dep[stk[top - 1]] + dep[stk[top]];\n            if (dis - 2 * Lca != 0)\n                Add(stk[top - 1], stk[top], dis - 2 * Lca);\n        }\n        if (lca != stk[top]) {\n            ll Lca = dep[LCA(lca, stk[top])];\n            ll dis = dep[lca] + dep[stk[top]];\n            if (dis - 2 * Lca != 0) \n                Add(lca, stk[top], dis - 2 * Lca), stk[top] = lca;\n        } stk[++top] = u;\n    }\n    \n    int main() {\n        n = read(), k = read();\n        for (R int i = 1, v; i <= n; ++i) {\n            col[i] = read(), v = read();\n            if (v == 0) root = i; else add(i, v);\n        }\n        dfs(root, 0);\n        For ( i, 1, n ) Ve[col[i]].push_back(i);\n        For ( i, 1, k ) {\n            Cnt = 0;\n            Head.clear();\n            ll nk = Ve[i].size();\n            For ( j, 1, nk ) ID[j] = Ve[i][j - 1];\n            sort(ID + 1, ID + nk + 1, cmp);\n            ll Lca = ID[1];\n            For ( j, 2, nk ) Lca = LCA(Lca, ID[j]);\n            top = 0, stk[++top] = Lca;\n            For ( j, 1, nk ) Insert(ID[j]);\n            for (ll dis, lca; top > 1; --top) {\n                lca = dep[LCA(stk[top - 1], stk[top])];\n                dis = dep[stk[top]] + dep[stk[top - 1]];\n                if (dis - 2 * lca != 0) \n                    Add(stk[top - 1], stk[top], dis - 2 * lca);\n            }\n            \n            For ( j, 1, nk ) ID[j] = 0;\n            cc = Max = 0, Dfs(Lca, 0);\n            For ( j, 1, cc ) Len[Zr[j]] = 0;\n            cc = Max = 0, Dfs(pos, 0); wln(Max);\n//\t\t\tFor ( i, 1, n ) For ( j, Head[i], E[j].Next ) \n//\t\t\t\tcout << \"!\" << i << \" -> \" << E[j].To << endl;\n        } return 0;\n    }\n    \n}\n\nint main()\n{\n//\tfreopen(\"testdata (19).in\", \"r\", stdin);\n//\tfreopen(\"test.out\", \"w\", stdout);\n    return Cesare::main();\n}\n\n/*\n\n*/\n\n\n\n```",
        "postTime": 1563845982,
        "uid": 104379,
        "name": "Cesare",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2971 \u3010[USACO10HOL]\u725b\u7684\u653f\u6cbbCow Politics\u3011"
    },
    {
        "content": "\u628a\u56fe\u5efa\u51fa\u6765\uff0c\u7136\u540e\u8bb0\u5f55\u6bcf\u4e00\u79cd\u989c\u8272\u7684\u8282\u70b9\u7684\u6700\u6df1\u70b9\uff1b\n\n\u53ef\u4ee5\u8bc1\u660e\u6211\u4eec\u53d6\u76842\u4e2a\u70b9\u4e00\u5b9a\u5305\u542b\u8fd9\u4e2a\u6700\u6df1\u70b9\uff1b\n\n\u90a3\u4e48\u6211\u4eec\u518d\u679a\u4e3e\u5176\u4ed6\u7684\u70b9\uff0c\u7528lca\u7b97\u4e00\u4e0b\u8ddd\u79bb\n\n```cpp\n#include<bits/stdc++.h>\n#define Ll long long\nusing namespace std;\nconst Ll N=2e5+5;\nstruct cs{int to,nxt;}a[N*2],c[N*2];\nint head[N],ll,tim,H[N],LL,f[N][20];\nint v[N],X[N],Y[N],dep[N],md[N];\nint n,m,x,y,z,k,S,ans;\nvoid init(int x,int y){a[++ll].to=y;a[ll].nxt=head[x];head[x]=ll;}\nvoid Init(int x,int y){c[++LL].to=y;c[LL].nxt=H[x];H[x]=LL;}\nvoid dfs(int x,int y,int z){\n    dep[x]=z;X[x]=++tim;\n    if(dep[md[v[x]]]<z)md[v[x]]=x;\n    for(int k=head[x];k;k=a[k].nxt)\n        if(a[k].to!=y)dfs(a[k].to,x,z+1);\n    Y[x]=++tim;\n}\nint lca(int x,int y){\n    if(dep[x]<dep[y])swap(x,y);\n    for(int j=19;j>=0;j--)if(dep[f[x][j]]>=dep[y])x=f[x][j];\n    if(x==y)return x;\n    for(int j=19;j>=0;j--)if(f[x][j]!=f[y][j])x=f[x][j],y=f[y][j];\n    return f[x][0];\n}\nint main()\n{\n    scanf(\"%d%d\",&n,&m);\n    for(int i=1;i<=n;i++){\n        scanf(\"%d%d\",&v[i],&f[i][0]);\n        Init(v[i],i);\n        if(f[i][0]==0)S=i;else init(f[i][0],i);\n    }\n    dfs(S,-1,1);\n    for(int j=1;j<=19;j++)\n        for(int i=1;i<=n;i++)\n            f[i][j]=f[f[i][j-1]][j-1];\n    for(int i=1;i<=m;i++){\n        ans=0;x=md[i];\n        for(int k=H[i];k;k=c[k].nxt){\n            int y=lca(x,c[k].to);\n            ans=max(ans,dep[x]-dep[y]+dep[c[k].to]-dep[y]);\n        }\n        printf(\"%d\\n\",ans);\n    }\n}\n\n```",
        "postTime": 1505108327,
        "uid": 7442,
        "name": "\u5de8\u578b\u65b9\u5757",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2971 \u3010[USACO10HOL]\u725b\u7684\u653f\u6cbbCow Politics\u3011"
    },
    {
        "content": "\u6211\u627e\u4e86\u534a\u5929\u9519\uff0c\u7ed3\u679c\u53d1\u73b0LCA\u6ca1\u5904\u7406\u7236\u5b50\u5173\u7cfb\u3002\u3002\u3002\n\n\u5148\u627e\u51fa\u6839\uff0c\u4ece\u6839\u904d\u5386\uff0c\u627e\u51fa\u6bcf\u4e2a\u70b9\u7684\u6df1\u5ea6\uff08\u5c31\u662fLCA\u7248\u5b50\u3002\u3002\u3002\uff09\n\n\u627e\u51fa\u6bcf\u4e2a\u653f\u515a\u6700\u6df1\u7684\u70b9\uff0c\u679a\u4e3e\u8fd9\u4e2a\u653f\u515a\u5176\u4ed6\u70b9\uff0c\u7528LCA\u6c42\u51fa\u5b83\u4eec\u95f4\u7684\u8ddd\u79bb\uff0c\u4ece\u800c\u6c42\u51fa\u8fd9\u4e2a\u653f\u515a\u7684\u6700\u5927\u8303\u56f4\n\nc++\n```cpp\n# include<iostream>\n# include<cstdio>\n# include<cstring>\nusing namespace std;\nstruct q{\n    int x,y;\n}c[500001];\nint n,k,num,root;\nint h[200001],use[200001],maxn[100001],deep[200001],ans[100001],maxn2[100001];\nint p[500001][21];\nint max(int x,int y)\n{\n    return x>y?x:y;\n}\nvoid add(int x,int y)\n{\n    c[++num].x=h[x];\n    c[num].y=y;\n    h[x]=num;\n}\nvoid dfs(int x)//\u6c42\u6df1\u5ea6\n{\n    for(int i=h[x];i;i=c[i].x)\n      {\n          int t=c[i].y;\n          if(t==p[x][0]) continue;\n          deep[t]=deep[x]+1;\n          p[t][0]=x;\n          dfs(t);\n      }\n}\nvoid init()//\u5904\u7406\u7236\u5b50\u5173\u7cfb\n{\n    for(int j=1;(1<<j)<=n;j++)\n      for(int i=1;i<=n;i++)\n        p[i][j]=p[p[i][j-1]][j-1];\n}\nint lca(int x,int y)//LCA\n{\n    if(deep[x]>deep[y]) swap(x,y);\n    int f=deep[y]-deep[x];\n    for(int i=0;(1<<i)<=f;i++)\n      if((1<<i)&f) y=p[y][i];\n    if(x!=y)\n    {\n        for(int i=20;i>=0;i--)\n          if(p[x][i]!=p[y][i])\n          x=p[x][i],y=p[y][i];\n        x=p[x][0];\n    }\n    return x;\n}\nint main()\n{\n    cin>>n>>k;\n    for(int i=1;i<=n;i++)\n      {\n          int a1,a2;\n          cin>>a1>>a2;\n          use[i]=a1;\n          add(a2,i);\n          add(i,a2);\n        if(!a2) root=i;\n      }\n    dfs(root);\n    init();//\u5c31\u662f\u8fd9\u5fd8\u52a0\u4e86\u3002\u3002\u3002\n    for(int i=1;i<=n;i++)\n      if(maxn[use[i]]<deep[i])\n      {\n          maxn[use[i]]=deep[i];//\u6700\u6df1\u7684\u70b9\u7684\u6df1\u5ea6\n        maxn2[use[i]]=i;    //\u6700\u6df1\u7684\u70b9\n      }\n    for(int i=1;i<=n;i++)\n      {\n          int x=lca(maxn2[use[i]],i);//\u679a\u4e3e\n          ans[use[i]]=max(ans[use[i]],maxn[use[i]]-deep[x]+deep[i]-deep[x]);\n      }\n    for(int i=1;i<=k;i++)\n      cout<<ans[i]<<endl;\n    return 0;\n}\n```",
        "postTime": 1507466072,
        "uid": 49206,
        "name": "Dispwnl",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P2971 \u3010[USACO10HOL]\u725b\u7684\u653f\u6cbbCow Politics\u3011"
    },
    {
        "content": "\u7ebf\u6bb5\u6811\u5408\u5e76  \n\u7ebf\u6bb5\u6811\u7ef4\u62a4\u6bcf\u79cd\u653f\u515a\u7684\u6700\u5927\u6df1\u5ea6\u3002 \u5b50\u8282\u70b9\u5411\u7236\u8282\u70b9\u5408\u5e76\u7684\u540c\u65f6\u66f4\u65b0\u7b54\u6848\u3002  \n\u65f6\u95f4\u590d\u6742\u5ea6$O(NlogN)$, \u7a7a\u95f4$O(NlogN)$  \n\u4ee3\u7801\u5b9e\u73b0\u633a\u7b80\u5355\u7684\uff0c\u5438\u6c27\u6c14490ms\uff0c\u7b97\u662f\u633a\u4f18\u79c0\u7684\uff1f  \n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<queue>\n#define rd read()\n#define N 200005\nusing namespace std;\n\nint n, m, k, cnt;\nint head[N], tot, bl[N], dep[N], ans[N];\n\nstruct edge {\n    int nxt, to;\n}e[N << 1];\n\nqueue<int> q;\n\nint read() {\n    int X = 0, p = 1; char c = getchar();\n    for (; c > '9' || c < '0'; c = getchar())\n        if (c == '-') p = -1;\n    for (; c >= '0' && c <= '9'; c = getchar())\n        X = X * 10 + c - '0';\n    return X * p;\n}\n\nvoid add(int u, int v) {\n    e[++tot].to = v;\n    e[tot].nxt = head[u];\n    head[u] = tot;\n}\n\nvoid cmax(int &A, int B) {\n    if (A < B) A = B;\n}\n\nnamespace SegT {\n    struct node {\n        int lson, rson, Max;\n    }a[N * 50];\n    int root[N];\n#define lc(x) a[x].lson\n#define rc(x) a[x].rson\n#define Max(x) a[x].Max\n#define mid ((l + r) >> 1)\n    \n    int get() {\n        if (q.empty()) return ++cnt;\n        int res = q.front(); q.pop();\n        return res;\n    }\n\n    void del(int x) {\n        Max(x) = lc(x) = rc(x) = 0;\n        q.push(x);\n    }\n\n    void modify(int pos, int c, int l, int r, int &x) {\n        if (!x) x = get();\n        if (l == r) {\n            cmax(Max(x), c); return;\n        }\n        if (pos <= mid) \n            modify(pos, c, l, mid, lc(x));\n        else modify(pos, c, mid + 1, r, rc(x));\n    }\n    \n    int merge(int x, int y, int l, int r, int lca) {\n        if (!x || !y) return x + y;\n        int now = get();\n        if (l == r) {\n            Max(now) = max(Max(x), Max(y));\n            if (Max(x) && Max(y))\n                cmax(ans[l], Max(x) + Max(y) - 2 * dep[lca]);\n            del(x); del(y);\n            return now;\n        }\n        lc(now) = merge(lc(x), lc(y), l, mid, lca);\n        rc(now) = merge(rc(x), rc(y), mid + 1, r, lca);\n        del(x); del(y);\n        return now;\n    }\n\n    int query(int pos, int l, int r, int x) {\n        if (!x) return 0;\n        if (l == r) return Max(x);\n        if (pos <= mid) return query(pos, l, mid, lc(x));\n        else return query(pos, mid + 1, r, rc(x));\n    }\n}using namespace SegT;\n\nvoid dfs(int u, int fa) {\n    for (int i = head[u]; i; i = e[i].nxt) {\n        int nt = e[i].to;\n        if (nt == fa) continue;\n        dep[nt] = dep[u] + 1;\n        dfs(nt, u);\n        root[u] = merge(root[u], root[nt], 1, k, u);\n    }\n    int tmp = query(bl[u], 1, k, root[u]);\n    cmax(ans[bl[u]], tmp - dep[u]);\n    modify(bl[u], dep[u], 1, k, root[u]);\n}\n\nint main()\n{\n    n = rd; k = rd;\n    int fr;\n    for (int i = 1; i <= n; ++i) {\n        bl[i] = rd; int fa = rd;\n        if (fa == 0) fr = i;\n        else add(fa, i), add(i, fa);\n    }\n    dep[fr] = 1;\n    dfs(fr, 0);\n    for (int i = 1; i <= k; ++i) \n        printf(\"%d\\n\", ans[i]);\n}\n\n```\n",
        "postTime": 1540602552,
        "uid": 61953,
        "name": "Chester",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2971 \u3010[USACO10HOL]\u725b\u7684\u653f\u6cbbCow Politics\u3011"
    }
]