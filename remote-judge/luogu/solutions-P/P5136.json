[
    {
        "content": "\u9898\u76ee\u94fe\u63a5\uff1a[$\\texttt{Link}$](https://www.luogu.com.cn/problem/P5136)\n## $\\text{Update}$\n\n- 2022.10.24 \u88ab @lingfunny Hack \u4e86\u3002\n\n- 2023.3.1 \u4fee\u6539\u5e76\u91cd\u5199\u9898\u89e3 & \u4ee3\u7801\u3002\n\n## $\\text{Description}$\n\u5df2\u77e5 $1\\le n\\le 10^{18}$\uff0c\u8bd5\u6c42\u51fa\n$$\\left\\lceil{\\left(\\dfrac{\\sqrt 5 + 1}{2} \\right)}^n\\right\\rceil$$\n\n## $\\text{Solution}$\n\u663e\u7136\u8fd9\u662f\u4e00\u4e2a\u6590\u6ce2\u90a3\u5951\u6570\u5217\u3002\n\n\u8003\u8651\u5176\u5171\u8f6d\uff1a\u8bbe $ x = \\dfrac{\\sqrt 5 + 1}{2}, y = \\dfrac{1 - \\sqrt 5}{2}$\u3002\n\n\u7531\u5171\u8f6d\u7684\u6027\u8d28\uff0c$x+y=1,xy=-1$\u3002\n\n\u90a3\u4e48\u4e00\u4e2a\u601d\u8def\u662f\u6784\u9020\u6570\u5217 $F_n = x^n + y^n$\u3002 \n\n$\\begin{aligned}F_n&=(x+y)(x^{n-1}+y^{n-1})-xy(x^{n-2}+y^{n-2})\\\\&=(x+y)F_{n-1}-xy\\times F_{n-2}\\\\&=F_{n-1}+F_{n-2}.\\end{aligned}$\n\n\u4e5f\u5c31\u662f $F_n=F_{n-1}+F_{n-2}$\uff0c\u5373\u8bc1\u3002\n\n\u6211\u4eec\u9700\u8981\u901a\u8fc7 $\\begin{bmatrix}F_{n-1} & F_{n-2}\\end{bmatrix}$ \u63a8\u5f97 $\\begin{bmatrix}F_{n} & F_{n-1}\\end{bmatrix}$\u3002\n\n\u624b\u63a8\u4e00\u4e0b\u5f97\u5230 $\\begin{bmatrix}F_{n-1} & F_{n-2}\\end{bmatrix} \\times \\begin{bmatrix}1&1\\\\1&0\\end{bmatrix} = \\begin{bmatrix}F_{n} & F_{n-1}\\end{bmatrix}$\u3002\n\n$F_n$ \u7684\u95ee\u9898\u5df2\u7ecf\u89e3\u51b3\uff0c\u8003\u8651 $A_n$\u3002\n\n\u7531\u4e8e $A_n=\\lceil F_n-y^n\\rceil$\uff0c\u6211\u4eec\u9700\u8981\u8ba8\u8bba $y^n$ \u7684\u8303\u56f4\u3002\n\n\u6ce8\u610f\u5230 $y \\in (-1, 0)$\uff0c\u4e8e\u662f\uff1a\n\n- $n$ \u4e3a\u5947\u6570\u65f6\uff0c$y^n\\in(-1,0)\\Rightarrow A_n =  F_n$\uff1b\n\n- $n$ \u4e3a\u5076\u6570\u65f6\uff0c$y^n\\in(0,1)\\Rightarrow A_n =  F_n - 1$\u3002\n\n## $\\text{Extra}$\n\n- \u6ce8\u610f\u53d6\u6a21 & \u6ea2\u51fa\u95ee\u9898\uff1b\n- \u7279\u5224 $n=0$ \u548c $n=1$ \u7684\u60c5\u51b5\uff1b\n- \u6ce8\u610f $F_1=1,F_2=3$\u3002\n\n## $\\text{AC Code}$\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nconst int p = 998244353;\nint T, n;\n\nstruct Matrix {\n    int a[2][2];\n    Matrix() {memset(a, 0, sizeof(a));}\n    Matrix operator * (const Matrix &mat) {\n\t    Matrix res;\n\t    for(int i = 0; i < 2; i++) {\n\t\t    for(int k = 0; k < 2; k++) {\n\t\t\t\tfor(int j = 0; j < 2; j++) {\n\t\t\t\t    res.a[i][j] += a[i][k] * mat.a[k][j];\n\t\t\t\t    res.a[i][j] %= p;\n\t\t\t\t}\n\t\t\t}\n\t\t} return res;\n\t}\n}ans, base;\n\ninline void init() {\n\tbase.a[0][0] = 1, base.a[0][1] = 1;\n\tbase.a[1][0] = 1, base.a[1][1] = 0;\n\tans.a[0][0] = 3, ans.a[0][1] = 1;\n\tans.a[1][0] = 0, ans.a[1][1] = 0;\n}\n\ninline int solve(int b) {\n\tinit();\n\tint f = (b -= 2) & 1;\n\twhile(b) {\n\t\tif(b & 1) ans = ans * base;\n\t\tbase = base * base, b >>= 1;\n\t} return (ans.a[0][0] + f) % p;\n\t// Hack:\u6ce8\u610f\u5148\u52a0\u518d\u53d6\u6a21\n}\n\nsigned main() {\n\tstd::cin >> T;\n\twhile(T--) {\n\t\tstd::cin >> n;\n\t\tif(n == 0) {puts(\"1\"); continue;}\n\t\tif(n == 1) {puts(\"2\"); continue;}\n\t\tstd::cout << solve(n) << std::endl;\n\t}\n    return 0;\n}\n```",
        "postTime": 1647599125,
        "uid": 498779,
        "name": "Matrix_mlt",
        "ccfLevel": 4,
        "title": "P5136 sequence \u9898\u89e3"
    },
    {
        "content": "## \u9898\u76ee\u63cf\u8ff0\n\n~~\u8bd5~~\u6c42\u51fa\uff1a\n\n$$\\left \\lceil \\left ( \\frac{1+\\sqrt{5}}{2}  \\right )^{n}  \\right \\rceil \\bmod 998244353$$\n\n\u591a\u6d4b\n\n## \u9898\u89e3\u62a5\u544a\n\n\u6709\u4e00\u9053\u672c\u9898\u7684\u8fdb\u9636\u7248\uff1a[\u6d1b\u8c37 P3263 \u6709\u610f\u4e49\u7684\u5b57\u7b26\u4e32](https://www.luogu.com.cn/problem/P3263)\u3002\n\n\u770b\u697c\u4e0b\u5927\u4f6c\u4eec\u90fd\u662f\u627e\u89c4\u5f8b\u63a8\u9012\u63a8\u5f0f\uff0c\u6211\u6765\u4e00\u4e2a\u7565\u6709\u4e0d\u540c\u7684\u89e3\u6cd5\uff08\u4e0d\u4e00\u6837\u7684\u9012\u63a8\u5f0f\uff0c\u4e3b\u4f53\u90fd\u4e3a\u77e9\u4e58\uff09\u3002\n\n\u5148\u4e0d\u8003\u8651\u5411\u4e0a\u53d6\u6574\u548c\u53d6\u6a21\u8fd0\u7b97\u3002\u9996\u5148\u9700\u8981\u5c06\u6839\u53f7\u53bb\u6389\uff0c\u5426\u5219\u4f1a\u6709\u5c0f\u6570\u3002\n\n\u53ef\u4ee5\u60f3\u5230\u5728\u539f\u5f0f\u540e\u52a0\u4e0a\u4e00\u4e2a $\\left ( \\frac{1-\\sqrt{5}}{2}  \\right )^{n}$\uff0c\u4f7f\u5f0f\u5b50\u53d8\u4e3a\uff1a\n\n$$ \\left ( \\frac{1+\\sqrt{5}}{2}  \\right )^{n} + \\left ( \\frac{1-\\sqrt{5}}{2}  \\right )^{n} $$\n\n\u6b64\u65f6\u4fbf\u53ef\u4ee5\u5c06\u6839\u53f7\u6d88\u6389\u3002\uff08\u6ce8\u610f\u6700\u540e\u9700\u8981\u51cf\u53bb\u4e00\u4e2a $\\left ( \\frac{1-\\sqrt{5}}{2}  \\right )^{n}$\uff09\n\n\u6211\u4eec\u8bbe $x= \\left ( \\frac{1+\\sqrt{5}}{2}  \\right )$\uff0c$y=\\left ( \\frac{1-\\sqrt{5}}{2}  \\right )$\u3002\n\n\u518d\u8bbe $f_{n}=x^{n}+y^{n}$\u3002\n\n\u7a0d\u5fae\u8003\u8651\u4e00\u4e0b\u4fbf\u53ef\u5f97\u5230\uff1a\n\n$$x^{n}+y^{n}=\\left ( x+y \\right ) \\left ( x^{n-1}+y^{n-1} \\right ) -xy \\times \\left ( x^{n-2}+y^{n-2} \\right )$$\n\n$$f_{n}=\\left ( x+y \\right )f_{n-1}-xy \\times f_{n-2} $$\n\n\u8fd9\u4e2a\u5c31\u662f\u6211\u4eec\u7684\u9012\u63a8\u5f0f\u5566\u3002\n\n\u5176\u4e2d\u6709\u4e9b\u4e1c\u897f\u53ef\u4ee5\u76f4\u63a5\u7b97\u51fa\u6765\uff1a$x+y=1$\uff0c$xy=-1$\uff0c$f_{1}=1$\uff0c$f_{2}=3$\u3002\n\n\u4e8e\u662f\u4e4e\u6211\u4eec\u7684\u77e9\u9635\u5c31~~\u5f88\u5bb9\u6613~~\u5730\u5f97\u51fa\u6765\u4e86\uff1a\n\n\u9700\u8981\u7531 $\\begin{bmatrix} f_{n-1} &f_{n-2}\\end{bmatrix}$ \u63a8\u5f97 $\\begin{bmatrix} f_{n} &f_{n-1}\\end{bmatrix}$\u3002\n\n\u8f6c\u79fb\u77e9\u9635\u5982\u4e0b\uff1a\n\n$$\\begin{bmatrix} 1 &1 \\\\ 1 &0\\end{bmatrix}$$\n\n\u6700\u540e\u518d\u6765\u770b\u770b\u51cf\u53bb\u7684\u90a3\u4e2a\u5f0f\u5b50\u5bf9\u6700\u7ec8\u7b54\u6848\u7684\u5f71\u54cd\uff1a\n\n> \u6ce8\u610f\u6700\u540e\u9700\u8981\u51cf\u53bb\u4e00\u4e2a $\\left ( \\frac{1-\\sqrt{5}}{2}  \\right )^{n}$\n\n\u6ce8\u610f\u5230 $\\left ( \\frac{1-\\sqrt{5}}{2}  \\right )$ \u662f\u4e00\u4e2a\u5728 $\\left ( -1,0 \\right ]$ \u4e0a\u7684\u8d1f\u5c0f\u6570\u3002\n\n\u5f53 $n$ \u4e3a\u5076\u6570\u65f6\uff0c$-\\left ( \\frac{1-\\sqrt{5}}{2}  \\right )$ \u4e3a\u8d1f\uff0c\u7531\u4e8e\u662f\u5411\u4e0a\u53d6\u6574\uff0c\u6240\u4ee5\u6b64\u65f6\u8be5\u5f0f\u5bf9\u7b54\u6848\u6ca1\u6709\u5f71\u54cd\u3002\n\n\u5f53 $n$ \u4e3a\u5947\u6570\u65f6\uff0c$-\\left ( \\frac{1-\\sqrt{5}}{2}  \\right )$ \u4e3a\u6b63\uff0c\u56e0\u4e3a\u5411\u4e0a\u53d6\u6574\uff0c\u6700\u7ec8\u7b54\u6848\u9700\u8981\u52a0\u4e00\u3002\n\n\u7efc\u4e0a\uff0c\u8be5\u5f0f\u5bf9\u7b54\u6848\u6709\u5f71\u54cd\uff0c\u5f53\u4e14\u4ec5\u5f53 $n$ \u4e3a\u5947\u6570\u3002\n\n\u6700\u540e\u5230\u4e86~~\u5927\u5bb6\u6700\u7231\u7684~~\u4ee3\u7801\u65f6\u5149\u3002\n\n## \u55f2\u5417\n```cpp\n#define int long long\nconst int MOD = 998244353;\nstruct mat \n{\n\tint a[2][2];\n\tmat() { memset(a, 0, sizeof a); }\n\tmat operator *(const mat &b)const \n\t{\n\t\tmat op;\n\t\tfor (int i = 0; i < 2; i++)\n\t\t\tfor (int k = 0; k < 2; k++)\n\t\t\t\tfor (int j = 0; j < 2; j++)\n\t\t\t\t\top.a[i][j] = (op.a[i][j] + a[i][k] * b.a[k][j]) % MOD;\n\t\treturn op;\n\t}\n} ans, I;\nvoid init() \n{\n\tI.a[0][0] = I.a[0][1] = I.a[1][0] = 1;\n\tI.a[1][1] = 0;\n\tans.a[0][0] = 3, ans.a[0][1] = 1;\n\tans.a[1][0] = ans.a[1][1] = 0;\n}\nsigned main() \n{\n\tint T = read();\n\twhile (T--) \n\t{\n\t\tn = read();\n\t\tinit();\n\t\tif (n == 0) \n\t\t{\n\t\t\tprintf(\"1\\n\");\n\t\t\tcontinue;\n\t\t}else if (n == 1) \n\t\t{\n\t\t\tprintf(\"2\\n\");\n\t\t\tcontinue;\n\t\t}\n\t\tint ff = 0;\n\t\tif (n % 2 == 1)ff++;\n\t\tn -= 2;\n\t\twhile (n) \n\t\t{\n\t\t\tif (n & 1)ans = ans * I;\n\t\t\tI = I * I;\n\t\t\tn >>= 1;\n\t\t}\n\t\tans.a[0][0] += ff;  //\u8fd9\u91cc\u52a0\u4e86ff\u4ee5\u540e\u4e0d\u8981\u5fd8\u8bb0\u53d6\u6a21\n\t\tprintf(\"%lld \\n\", ans.a[0][0]%MOD);\n\t}\n\treturn 0;\n}\n```\n\n\u611f\u8c22 @lingfunny \u5927\u4f6c\u6307\u51fa\u9519\u8bef\n\n\u6709\u9519\u8bef\u8bf7 D \u6211\u3002",
        "postTime": 1630049246,
        "uid": 478449,
        "name": "Dumby_cat",
        "ccfLevel": 0,
        "title": "Luogu P5136 sequence \u9898\u89e3\u62a5\u544a"
    },
    {
        "content": "~~\u6bd2\u7624\u5361\u5e38\u9898~~\n\n\u9898\u76ee\u7ed9\u6211\u4eec $n$\uff0c\u8981\u8ba9\u6211\u4eec\u6c42 $\\lceil(\\dfrac{1+\\sqrt{5}}{2})\\rceil^n \\bmod 998244353$\u3002\n## \u65b9\u6cd5 1\n### \u8fc7\u7a0b\n\u6709\u6ca1\u6709\u89c1\u8fc7\u6590\u6ce2\u90a3\u5951\u6570\u5217\u7684\u901a\u9879\u516c\u5f0f\uff1f\u6211\u4eec\u8bbe\u4e00\u4e2a\u5e8f\u5217 $F$\uff0c\u6ee1\u8db3\uff1a\n$$\nF_n=(\\dfrac{1+\\sqrt{5}}{2})^n+(\\dfrac{1-\\sqrt{5}}{2})^{n}\n$$\n\u73b0\u5728\u6211\u4eec\u53ea\u9700\u8981\u77e5\u9053 $(\\dfrac{1-\\sqrt{5}}{2})^n$ \u7684\u8303\u56f4\u5c31\u597d\u4e86\u3002\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0 $\\dfrac{1-\\sqrt{5}}{2}\\in(-1,0)$\u3002\u4e8e\u662f\uff1a\n- \u5f53 $n\\bmod 2=1$ \u65f6\uff0c $(\\dfrac{1-\\sqrt{5}}{2})^n<0$\u3002\n- \u5426\u5219\uff0c$(\\dfrac{1-\\sqrt{5}}{2})^n>0$\u3002\n\n### \u8ba1\u7b97 $F_n$\n\n\u6211\u4eec\u8bbe $x=\\dfrac{1+\\sqrt{5}}{2},y=\\dfrac{1-\\sqrt{5}}{2}$\u3002\n\n\u590d\u4e60\u5b8c\u7acb\u65b9\u548c\u516c\u5f0f\u7684\u8bc1\u660e\u65b9\u6cd5\u4e4b\u540e\uff0c\u6211\u4eec\u8bd5\u7740\u9012\u63a8\uff1a\n$$\n\\begin{aligned}\nF_n&=x^n+y^n\\\\\n&=x^n+y^n+xy^{n-1}+yx^{n-1}-(xy^{n-1}+yx^{n-1})\\\\\n&=(x+y)(x^{n-1}+y^{n-1})-xy(x^{n-2}+y^{n-2})\\\\\n&=(x+y)F_{n-1}-xy\\times F_{n-2}\\\\\n\\end{aligned}\n$$\n\u4e8e\u662f\u8f6c\u79fb\u77e9\u9635\u4e3a\n$$\n\\left[\\begin{array}{cc}F_n&F_{n-1}\\end{array}\\right]\n\\times\n\\left[\\begin{array}{cc}F_{n-1}&F_{n-2}\\end{array}\\right]^{-1}=\n\\left[\\begin{array}{cc}\n1&1\\\\\n1&0\\\\\n\\end{array}\\right]\n$$\n\u4e8e\u662f\u5c31\u53ef\u4ee5\u9012\u63a8\u4e86\u3002\u6ce8\u610f $F_1=1,F_2=3$\u3002\n\n### \u5b9e\u73b0\n```cpp\nmat base, res;\nconstexpr mint one(1), zero(0), three(3);\nmint ans;\nunsigned long long n = 0;\nsize_t T = 0;\ninline void solve() {\n    cin >> n;\n    if (n == 0) cout << '1' << '\\n';\n    else if (n == 1) cout << '2' << '\\n';\n    else {\n        base.mat[1][1] = zero;\n        base.mat[0][0] = base.mat[0][1] = base.mat[1][0] = one;\n        ans = (n & 1);\n        n -= 2;\n        res.mat[0][0] = three;\n        res.mat[1][0] = res.mat[1][1] = zero;\n        res.mat[0][1] = one;\n        for (; n; base *= base, n >>= 1) if (n & 1) res *= base;\n        ans += res.mat[0][0];\n        cout << ans << '\\n';\n    }\n}\nint main() {\n    base.mat.resize(2);\n    base.mat[0].resize(2);\n    base.mat[1].resize(2);\n    res.mat.resize(2);\n    res.mat[0].resize(2);\n    res.mat[1].resize(2);\n    cin >> T;\n    for (size_t t = 0; t < T; t++) solve();\n}\n```\n## \u65b9\u6cd52\n\u6c42\u51fa\u7b2c $n$ \u4e2a\u6590\u6ce2\u90a3\u5951\u6570\u5e76\u4e58\u4ee5 $\\sqrt{5}$\uff0c\u5373\u5f97 $\\sqrt{5}\\times F_n$\u3002\n\n\u79fb\u9879\uff0c\u5f97\u5230 $\\sqrt{5}\\times F_n+(\\dfrac{1-\\sqrt{5}}{2})^n=(\\dfrac{1+\\sqrt{5}}{2})^n$\u3002\n\n\u6309\u7167\u4e0a\u8ff0\u65b9\u6cd5\uff0c\u6211\u4eec\u5206\u6790 $(\\dfrac{1-\\sqrt{5}}{2})^n$ \u7684\u7ed3\u675f\u4e86\u3002",
        "postTime": 1667715678,
        "uid": 589895,
        "name": "Ruiqun2009",
        "ccfLevel": 0,
        "title": "\u77e9\u9635\u8fd0\u7b973/\u9898\u89e3P5136 sequence"
    },
    {
        "content": "\n\u6c42\uff1a\n$$\n\\left\\lceil\\left(\\frac{1+\\sqrt{5}}{2}\\right)^{i}\\right\\rceil\n$$\n\n#### sol\n\n\u9996\u5148\u8003\u8651\u5c06\u539f\u5f0f\u8f6c\u6362\u4e3a\uff1a\n$$\n\\left\\lceil\\left(\\frac{1+\\sqrt{5}}{2}\\right)^{i}+\\left(\\frac{1-\\sqrt{5}}{2}\\right)^{i}-\\left(\\frac{1-\\sqrt{5}}{2}\\right)^{i}\\right\\rceil\n$$\n\u663e\u7136\u6709\uff1a\n$$\n\\left(\\frac{1+\\sqrt{5}}{2}\\right)^{i}+\\left(\\frac{1-\\sqrt{5}}{2}\\right)^{i}=f(i)\n$$\n\u5176\u4e2d $f$ \u4e3a\u6590\u6ce2\u90a3\u5951\u6570\u5217\u3002\n\n\u8003\u8651\u7528\u77e9\u9635\u5feb\u901f\u5e42\u4f18\u5316\u9012\u63a8\u8ba1\u7b97\u3002\n\n\u663e\u7136\uff0c\u8bbe\u72b6\u6001\u77e9\u9635\u4e3a\uff1a\n\n$$\n\\begin{bmatrix}f_{n}&f_{n-1}\\end{bmatrix}\n$$\n\u663e\u7136\uff0c\u8f6c\u79fb\u77e9\u9635\u4e3a\uff1a\n$$\n\\begin{bmatrix}1&1\\\\1&0\\end{bmatrix}\n$$\n\u6700\u540e\u518d\u6765\u770b\u770b\u51cf\u53bb\u7684 $\\left(\\frac{1-\\sqrt{5}}{2}\\right)^{i}$ \u5bf9\u6700\u7ec8\u7b54\u6848\u7684\u5f71\u54cd\u3002\n\n\u8003\u8651\u5206\u5947\u5076\u6027\u8ba8\u8bba\uff1a\n\n* \u5f53 $i$ \u4e3a\u5076\u6570\u65f6\uff0c$-\\left(\\frac{1-\\sqrt{5}}{2}\\right)^{i}$ \u4e3a\u8d1f\uff0c\u65e0\u5f71\u54cd\u3002\n* \u5f53 $i$ \u4e3a\u5947\u6570\u65f6\uff0c$-\\left(\\frac{1-\\sqrt{5}}{2}\\right)^{i}$ \u4e3a\u6b63\uff0c\u6700\u7ec8\u7b54\u6848\u52a0\u4e00\u3002\n\n\u90a3\u5c31\u6ca1\u4e86\u3002\u3002\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\n#define int long long\n\ninline int read()\n{\n    int x = 0, f = 1;\n    char c = getchar();\n    while (c < '0' || c > '9')\n    {\n        if (c == '-')\n            f = -1;\n        c = getchar();\n    }\n    while (c >= '0' && c <= '9')\n    {\n        x = x * 10 + c - '0';\n        c = getchar();\n    }\n    return x * f;\n}\n\nint T, n;\n\nconst int MOD = 998244353;\n\nstruct mat\n{\n    int a[2][2];\n    mat()\n    {\n        memset(a, 0, sizeof a);\n    }\n    mat operator*(const mat &b) const\n    {\n        mat op;\n        for (int i = 0; i < 2; i++)\n            for (int k = 0; k < 2; k++)\n                for (int j = 0; j < 2; j++)\n                    op.a[i][j] = (op.a[i][j] + a[i][k] * b.a[k][j]) % MOD;\n        return op;\n    }\n} ans, I;\n\nvoid init()\n{\n    I.a[0][0] = I.a[0][1] = I.a[1][0] = 1;\n    I.a[1][1] = 0;\n    ans.a[0][0] = 3, ans.a[0][1] = 1;\n    ans.a[1][0] = ans.a[1][1] = 0;\n}\n\nsigned main()\n{\n    T = read();\n    while (T--)\n    {\n        n = read();\n        init();\n        if (n == 0)\n        {\n            printf(\"1\\n\");\n            continue;\n        }\n        else if (n == 1)\n        {\n            printf(\"2\\n\");\n            continue;\n        }\n        bool flag = 0;\n        if(n % 2 == 1) flag = 1;\n        n -= 2;\n        while (n)\n        {\n            if (n & 1)\n                ans = ans * I;\n            I = I * I;\n            n >>= 1;\n        }\n        printf(\"%lld\\n\", (ans.a[0][0] + flag) % MOD);\n    }\n    return 0;\n}\n```\n\n",
        "postTime": 1640351461,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "P5136 sequence"
    },
    {
        "content": "[\u6211\u7684\u535a\u5ba2](https://www.cnblogs.com/Memory-of-winter/p/10356832.html)\n\n**\u9898\u76ee\u5927\u610f\uff1a**\u6709$T(T\\leqslant10^5)$\u7ec4\u8be2\u95ee\uff0c\u6bcf\u6b21\u6c42$A_n(n\\leqslant10^{18})$\uff1a\n$$A_n=\\left\\lceil\\left(\\dfrac{\\sqrt5+1}2\\right)^n\\right\\rceil$$\n**\u9898\u89e3\uff1a**\u901a\u8fc7\u6253\u8868~~\u770b\u9898\u89e3~~\u53d1\u73b0\uff0c\u8fd9\u4e2a\u5e8f\u5217\u662f$2,3,5,7,\\dots$\uff0c\u5373$A_n=A_{n-1}+A_{n-2}-[n\\equiv0\\pmod2]$\uff0c\u9898\u89e3\u4e2d\u8bf4\u53ef\u4ee5\u8bb0\u5f55\u4e09\u4e2a\u4fe1\u606f\u77e9\u9635\u5feb\u901f\u5e42\u4e00\u4e0b\uff0c\u7136\u540e\u6211\u5e76\u4e0d\u4f1a\u5904\u7406$[n\\equiv0\\pmod2]$\uff08\u679c\u7136\u6211\u6700\u83dc\uff09\n\n\u7ee7\u7eed\u770b\u4e0b\u53bb\uff0c\u4ed6\u8bf4\u53ef\u4ee5\u6784\u9020\u6570\u5217$F$\uff0c$F_n=F_{n-1}+F_{n-1}(F_1=1,F_2=3)$\uff0c$A_n=F_n+(n\\bmod2)$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8fc7\u53bb\u4e86\uff0c\u590d\u6742\u5ea6$O(2^3T\\log_2n)$\n\n\u4f46\u662f\u8fd9\u6837\u4f3c\u4e4e\u611f\u89c9\u4e0d\u591f\u4f18\u79c0\uff0c\u53ef\u4ee5\u628a\u8f6c\u79fb\u77e9\u9635\u5206\u5757\u9884\u5904\u7406\u51fa\u6765\uff0c$n\\leqslant10^{18}<2^{60}$\uff0c\u53ef\u4ee5$\\sqrt{\\sqrt n}$\u5373$2^{15}$\u5206\u4e00\u5757\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u5e38\u6570\u590d\u6742\u5ea6\u5185\u6c42\u51fa\u4e00\u6b21\u7684\u7b54\u6848\u4e86\uff0c\u590d\u6742\u5ea6$O(4\\times2^3T)$\n\n\u66f4\u8fdb\u4e00\u6b65\u7684\u662f\uff0c$F$\u4e3a\u6590\u6ce2\u90a3\u5951\u6570\u5217\uff0c\u5b83\u5728\u6a21\u4e00\u4e2a\u6570\u4e0b\u6709\u5faa\u73af\u8282\uff0c\u6d1b\u8c37\u4e0a\u6709\u8fd9\u4e48[\u4e00\u9053\u9898](https://www.luogu.org/problemnew/show/P4000)\uff0c\u6bd4\u5982\u5728$998244353$\u4e0b\u4e3a$1996488708$\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u53d6\u6a21\u540e\u5206\u5757\uff0c\u5c31\u53ef\u4ee5\u53ea\u5206\u6210\u4e24\u5757\uff0c\u51cf\u5c11\u5e38\u6570\uff0c\u590d\u6742\u5ea6$O(2\\times2^3T)$\uff08\u4f46\u662f\u6211\u8dd1\u7684\u6bd4\u4e0a\u4e00\u4e2a\u6162\u3002\u3002\u3002~~\u52a0\u4e86\u7f16\u8bd1\u6307\u4ee4\u624d\u6bd4\u4e0a\u4e00\u4e2a\u5feb~~\uff09\n\n\n\n**C++ Code\uff1a**\n\n```cpp\n#include <cstdio>\n#include <cctype>\n#define N 65537\nconst int mod = 998244353, cover = (1 << 16) - 1;\n\nnamespace std {\n\tstruct istream {\n#define M (1 << 23 | 3)\n\t\tchar buf[M], *ch = buf - 1;\n\t\tinline istream() { fread(buf, 1, M, stdin); }\n\t\tinline istream& operator >> (int &x) {\n\t\t\twhile (isspace(*++ch));\n\t\t\tfor (x = *ch & 15; isdigit(*++ch); ) x = x * 10 + (*ch & 15);\n\t\t\treturn *this;\n\t\t}\n\t\tinline istream& operator >> (long long &x) {\n\t\t\twhile (isspace(*++ch));\n\t\t\tfor (x = *ch & 15; isdigit(*++ch); ) x = x * 10 + (*ch & 15);\n\t\t\treturn *this;\n\t\t}\n#undef M\n\t} cin;\n\tstruct ostream {\n#define M (1 << 22 | 3)\n\t\tchar buf[M], *ch = buf - 1;\n\t\tinline ostream& operator << (int x) {\n\t\t\tif (!x) {*++ch = '0'; return *this;}\n\t\t\tstatic int S[20], *top; top = S;\n\t\t\twhile (x) {*++top = x % 10 ^ 48; x /= 10;}\n\t\t\tfor (; top != S; --top) *++ch = *top;\n\t\t\treturn *this;\n\t\t}\n\t\tinline ostream& operator << (const char x) {*++ch = x; return *this;}\n\t\tinline ~ostream() { fwrite(buf, 1, ch - buf + 1, stdout); }\n#undef M\n\t} cout;\n}\n\nstruct Matrix {\n\tint s00, s01, s10, s11;\n\tMatrix() { }\n\tMatrix(int __00, int __01, int __10, int __11) : s00(__00), s01(__01), s10(__10), s11(__11) { }\n\tinline Matrix operator * (const Matrix &rhs) {\n#define M(l, r) static_cast<long long> (s##l) * rhs.s##r\n#define C(ll, lr, rl, rr) (M(ll, lr) + M(rl, rr)) % mod\n\t\treturn Matrix(C(00, 00, 01, 10), C(00, 10, 01, 11), C(10, 00, 11, 10), C(10, 01, 11, 11));\n#undef M\n#undef calc\n\t}\n} base0[N], base1[N], ans(3, 1, 0, 0);\n\nvoid init() {\n\tconst Matrix I(1, 0, 0, 1);\n#define work(x) \\\n\t*base##x = I; \\\n\tfor (int i = 1; i < N; ++i) base##x[i] = base##x[i - 1] * __base##x;\n\tconst Matrix __base0(1, 1, 1, 0); work(0);\n\tconst Matrix __base1 = base0[N - 1]; work(1);\n#undef work\n}\n\nint Tim;\nint main() {\n\tinit();\n\tstd::cin >> Tim;\n\twhile (Tim --> 0) {\n\t\tstatic long long n;\n\t\tstatic int res;\n\t\tstd::cin >> n; --n, n %= 1996488708;\n\t\tres = (ans * base0[n & cover] * base1[n >> 16 & cover]).s01 + !(n & 1) - mod;\n\t\tstd::cout << res + (res >> 31 & mod) << '\\n';\n\t}\n\treturn 0;\n}\n\n```\n\n",
        "postTime": 1549636606,
        "uid": 22072,
        "name": "Memory_of_winter",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5136 \u3010sequence\u3011"
    },
    {
        "content": "~~\u6253\u8868\u627e\u89c4\u5f8b~~\n\n\u65e2\u7136\u90fd\u6253\u51fa\u8868\u6765\u4e86\uff0c\u89c4\u5f8b\u5c31\u4e0d\u7528\u624b\u627e\u4e86\uff0c\u76f4\u63a5\u6254OEIS\u4e0a\uff08\u9003\n\n\u6ca1\u9519\u5c31\u662f\u5b83\uff01[A169986](http://oeis.org/A169986)\n\n\u597d\u6211\u4eec\u76f4\u63a5\u62c9\u90a3\u4e2a\u9012\u63a8\u516c\u5f0f\uff1a$a_n=a_{n-1}+2a_{n-2}-a_{n-3}-a_{n-4},a_1=2,a_2=3,a_3=5,a_4=7$\u3002\n\n\u63a5\u7740\u5bf9\u5b83\u77e9\u9635\u5feb\u901f\u5e42\u3002\u65f6\u95f4\u590d\u6742\u5ea6$O(4^3T\\log n)$\u3002\u770b\u8d77\u6765\u5f88\u4e0d\u80fd\u8fc7\u7684\u6837\u5b50\u3002\n\n\u5bf9\u4e8e\u8fd9\u79cd\u5e95\u6570\u4e0d\u53d8\u7684\u6c42\u5e42\uff0c\u5206\u5757\u7136\u540e$O(1)$\u6c42\u662f\u57fa\u672c\u5957\u8def\u3002\n\n\u672c\u9898\u7684$n$\u9ad8\u8fbe$10^18$\uff0c\u6240\u4ee5\u8003\u8651\u5206\u6210$4$\u5757\uff0c\u6bcf\u5757$\\sqrt{\\sqrt{n}}$\u4e2a\u3002\u7136\u540e\u6bcf\u6b21\u6c42\u5e42\u7684\u590d\u6742\u5ea6\u964d\u4e3a$O(1)$\uff0c\u7528\u521d\u59cb\u72b6\u6001\u5de6\u4e58\uff0c\u5e38\u6570\u5927\u7ea6$4\\times 4^2=64$\u3002\n\n\u8fd9\u6837\u5c31\u780d\u6389\u4e00\u4e2a$\\log$\uff0c\u590d\u6742\u5ea6$O(64T)$\u3002\n\n\u5f53\u7136\u7528\u5176\u4ed6\u7684\u77e9\u9635\u5c0f\u7684\u8f6c\u79fb\u65b9\u6cd5\u53ef\u4ee5\u505a\u5230\u66f4\u4f18\u7684\u5e38\u6570\u3002\n\n## Code\uff1a\n```cpp\n#include<cstdio>\n#define md 998244353\n#define M 32767\ntypedef long long LL;\nstruct matrix{\n    int a[4][4];\n    int r;\n    matrix operator*(const matrix&b)const{\n        matrix c;\n        c.r=r;\n        for(int i=0;i<r;++i)\n        for(int j=0;j<4;++j){\n            LL tmp=0;\n            for(int k=0;k<4;++k)\n            tmp+=LL(a[i][k])*b.a[k][j];\n            c.a[i][j]=tmp%md;\n        }\n        return c;\n    }\n}_1[32769],_2[32769],_3[32769],_4[32769],a;\nvoid init(){\n\t_1->r=_1[1].r=4;\n\t_1[1].a[0][0]=_1[1].a[0][1]=_1[1].a[1][2]=_1[1].a[2][3]=_1[0].a[0][0]=_1[0].a[1][1]=_1[0].a[2][2]=_1[0].a[3][3]=1;\n\t_1[1].a[1][0]=2;_1[1].a[2][0]=_1[1].a[3][0]=md-1;\n\tfor(int i=2;i<=32768;++i)_1[i]=_1[i-1]*_1[1];\n\t*_2=*_1;_2[1]=_1[32768];\n\tfor(int i=2;i<=32768;++i)_2[i]=_2[i-1]*_2[1];\n\t*_3=*_1;_3[1]=_2[32768];\n\tfor(int i=2;i<=32768;++i)_3[i]=_3[i-1]*_3[1];\n\t*_4=*_1;_4[1]=_3[32768];\n\tfor(int i=2;i<=32768;++i)_4[i]=_4[i-1]*_4[1];\n}\nint main(){\n\tinit();\n\ta.r=1;\n\ta.a[0][0]=7,a.a[0][1]=5,a.a[0][2]=3,a.a[0][3]=2;\n\tint t;\n\tfor(scanf(\"%d\",&t);t--;){\n\t\tLL x;\n\t\tscanf(\"%lld\",&x);--x;\n\t\tprintf(\"%d\\n\",(a*_1[x&M]*_2[x>>15&M]*_3[x>>30&M]*_4[x>>45]).a[0][3]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1547031705,
        "uid": 6813,
        "name": "mrsrz",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P5136 \u3010sequence\u3011"
    },
    {
        "content": "## P5136 sequence \u9898\u89e3\n\n\u53d1\u73b0\u8981\u6c42\u7684\u662f\u5e26\u6839\u53f7\u7684\uff0c\u8003\u8651~~\u4e8c\u6b21\u5269\u4f59~~\u5171\u8f6d\u3002\n\n\u53c2\u8003 [[JLOI2015]\u6709\u610f\u4e49\u7684\u5b57\u7b26\u4e32](https://www.luogu.com.cn/problem/P3263)\u3002\n\n\u4ee4 $p=\\frac{1+\\sqrt{5}}{2},q=\\frac{1-\\sqrt{5}}{2}$\uff0c\u663e\u7136\u6709\uff1a\n\n1. $p+q=1$\n2. $pq=-1$\n\n\u5bf9\u4e8e\u65b9\u7a0b $x^2-x-1$\uff0c$p,q$ \u5373\u4e3a\u65b9\u7a0b\u4e24\u6839\u3002\n\n\u76f4\u63a5\u6c42 $p^n$ \u8f83\u4e3a\u56f0\u96be\uff0c\u8003\u8651\u8bb0 $f_n=p^n+q^n$\u3002\u6709\uff1a\n$$\n\\begin{array}{c}\np^n+q^n=(p^{n-1}+q^{n-1})(p+q)-(p^{n-2}+q^{n-2})pq\\\\\n\\Updownarrow\\\\\nf_n=f_{n-1}+f_{n-2}\n\\end{array}\n$$\n\u6839\u636e\u8fd9\u4e2a\u9012\u63a8\u5f0f\u548c\u4e0a\u9762\u7684\u7279\u5f81\u65b9\u7a0b\uff0c\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a\u6590\u6ce2\u90a3\u5951\u6570\u5217\uff0c\u9996\u9879\u53ef\u4ee5\u624b\u63a8\uff1a$f_0=p^0+q^0=2,f_1=p+q=1$\u3002\n\n\u6ce8\u610f\u5230\u6700\u540e\u7b54\u6848\u5e94\u8be5\u662f $f_n-q^n$\uff0c\u53d1\u73b0 $\\left|q\\right|<\\overline\\phi$\uff0c\u6839\u636e\u4e0a\u53d6\u6574\u7684\u6027\u8d28\uff0c\u6709 $\\texttt{ans}=f_n+[n\\text { is odd}]$\u3002\n\n\u81f3\u6b64\uff0c\u53ef\u4ee5\u7528\u77e9\u9635\u5feb\u901f\u5e42\u5728 $\\Theta(T\\log n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u89e3\u51b3\u672c\u9898\u3002\n\n\u4e0d\u8fc7\u6839\u636e**\u6590\u6ce2\u90a3\u5951\u5faa\u73af\u8282**\u7684\u5e38\u8bc6\uff0c\u672c\u9898\u8fd8\u80fd\u7ee7\u7eed\u4f18\u5316\u3002\n\n\u53d1\u73b0\u6a21\u6570 $998244353\\equiv3\\pmod{5}$\uff0c\u5219\u5faa\u73af\u8282\u4e3a $2\\times(998244353+1)$\uff08\u8be6\u89c1 [\u6590\u6ce2\u90a3\u5951\u5faa\u73af\u8282](https://blog.csdn.net/ding4440/article/details/101250954)\uff09\u3002\n\n\u81f3\u6b64\uff0c\u53ef\u4ee5\u901a\u8fc7 $n\\le10^{114514+1919810}$ \u7684\u6570\u636e\u4e86\uff0c\u590d\u6742\u5ea6\u4e0e $n$ \u65e0\u5173\uff08\u9664\u8bfb\u5165\uff09\u3002\n\n~~\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(T\\log 998244353)=\\Theta(T)$\uff08\u96fe~~\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(T\\log p)$\u3002\n\n\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u62d3\u5c55\u3002\u82e5 $p$ \u4e0d\u4e3a\u8d28\u6570\uff0c\u5219\u53ef\u4ee5\u7ee7\u7eed\u5206\u89e3\uff08\u8be6\u89c1 [\u6590\u6ce2\u90a3\u5951\u5faa\u73af\u8282](https://blog.csdn.net/ding4440/article/details/101250954)\uff09\u6c42\u51fa\u5faa\u73af\u8282 $G$\uff0c\u7531\u4e8e $G\\le 6p$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(\\sqrt{p}+\\log p)\\sim\\Theta(T\\log p)$\u3002\n\n\u66f4\u8fdb\u4e00\u6b65\uff0c\u53d1\u73b0\u6709\u591a\u7ec4\u8be2\u95ee\uff0c\u6211\u4eec\u8003\u8651\u964d\u4f4e\u4e00\u6b21\u67e5\u8be2\u7684\u590d\u6742\u5ea6\u3002\n\n\u7c7b\u4f3c BSGS \u7684\u601d\u60f3\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u77e9\u9635\u5e42\u5206\u5757\uff0c\u8bb0\u8f6c\u79fb\u77e9\u9635\u4e3a $P$\uff0c$S = \\sqrt{p}$\uff0c\u7528\u54c8\u5e0c\u8868\u8bb0\u5f55 $P^S,P^{2S},P^{3S},\\cdots$ \u548c $P,P^2,\\cdots,P^{S-1}$\uff0c\u6c42\u89e3\u65f6\u53ea\u9700\u5b8c\u6210\u4e09\u4e2a\u77e9\u9635\u76f8\u4e92\u4e58\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(\\sqrt{p}+\\log p)\\sim\\Theta(T)$\u3002\n\n### CODE\n\n```cpp\n// Problem: P5136 sequence\n// From: Luogu\n// URL: https://www.luogu.com.cn/problem/P5136\n// Time: 2022-03-06 15:59\n// Author: lingfunny\n\n#include <bits/stdc++.h>\n#include<ext/pb_ds/assoc_container.hpp>\n#include<ext/pb_ds/hash_policy.hpp>\nusing namespace __gnu_pbds;\n#define LL long long\nconst int mod = 998244353, loop = (mod+1)<<1, S = ceil(sqrt(loop));\nusing namespace std;\n\nint tt, n;\ninline int mul(int x, int y) { return (LL)x*y%mod; }\n\nstruct matrix {\n\tint a[2][2], n, m;\n\tinline matrix operator * (const matrix& rhs) const {\n\t\tmatrix res;\n\t\tres.n = n, res.m = rhs.m;\n\t\tfor(int i = 0; i < n; ++i)\n\t\tfor(int j = 0; j < rhs.m; ++j) {\n\t\t\tres.a[i][j] = 0;\n\t\t\tfor(int k = 0; k < m; ++k)\n\t\t\t(res.a[i][j] += mul(a[i][k], rhs.a[k][j])) %= mod;\n\t\t}\n\t\treturn res;\n\t}\n} A = { { {2, 1}, {0, 0} }, 1, 2 }, ls[S+5];\nconst matrix P = { { {0, 1}, {1, 1} }, 2, 2 };\ngp_hash_table <int, matrix> gs;\ninline void init() {\n\tmatrix x = {{{1,0},{0,1}},2,2}, y;\n\tgs[0] = x;\n\tfor(int i = 0; i < S; ++i) {\n\t\tls[i] = x;\n\t\tx = x * P;\n\t}\n\ty = x;\n\tfor(int i = 1; i <= S; ++i) {\n\t\tgs[i] = y;\n\t\ty = y * x;\n\t}\n}\n#define GC getchar()\ninline int read() {\n\tunsigned x = 0; char ch = GC;\n\twhile(ch < '0') ch = GC;\n\twhile('0' <= ch) { x = ((x<<1) + ((LL)x<<3) + (ch^48)) % loop; ch = GC; }\n\treturn x;\n}\n\nsigned main() {\n\tinit();\n\ttt = read();\n\twhile(tt--) {\n\t\tn = read();\n\t\tA.a[0][0] = 2; A.a[0][1] = 1;\n\t\tA = A * (gs[n/S] * ls[n%S]);\n\t\tprintf(\"%d\\n\", (A.a[0][0]+(n&1))%mod);\n\t}\n\treturn 0;\n}\n```\n\n",
        "postTime": 1646557400,
        "uid": 280800,
        "name": "lingfunny",
        "ccfLevel": 7,
        "title": "P5136 sequence \u9898\u89e3"
    },
    {
        "content": "# \u9898\u76ee\n\u6c42\n$$\\lceil(\\frac{\\sqrt 5+1}{2})^n\\rceil$$\n\n---\n# \u5206\u6790\n\u8fd9\u79cd\u9898\u76ee\u80af\u5b9a\u8981\u6253\u8868\u627e\u89c4\u5f8b\u4e86\u5440\uff0c\u4e8e\u662f\u5c31\u987a\u7740OEIS\uff0c\u6709\u9898\u89e3\u8bf4\u662f\n$$F_n=F_{n-1}+2*F_{n-2}-F_{n-3}-F_{n-4}$$\n\u7ed3\u679c\u5c31WA\u4e86\uff0c\u73b0\u5728\u53d1\u73b0\u7b26\u53f7\u5f04\u53cd\u4e86\uff0c\u7136\u800c\n\n[OEIS\u6765\u4e00\u6ce2](http://oeis.org/A169986)\n\u7a81\u7136\u6361\u6f0f\u53d1\u73b0\u4e86\u4e0b\u9762\u4e00\u884c\uff0c\uff1f\uff1f\uff1f\u8fd9\u4e0d\u662f\u6590\u6ce2\u90a3\u5951\u6570\u5217\u5417,\n$a(n) = 3*Fibonacci(n-1) + Fibonacci(n-2) + (n \\bmod 2), n>0.$\nso\n\n---\n# \u4ee3\u7801\n```cpp\n#include <cstdio>\n#include <cctype>\n#define rr register\nusing namespace std;\nconst int mod=998244353;\nstruct maix{int p[2][2];}A,ANS;\ninline long long iut(){\n    rr long long ans=0; rr char c=getchar();\n    while (!isdigit(c)) c=getchar();\n    while (isdigit(c)) ans=(ans<<3)+(ans<<1)+(c^48),c=getchar();\n    return ans;\n}\ninline maix mul(maix A,maix B,int k){\n    rr maix C;\n    for (rr int i=0;i<k;++i)\n    for (rr int j=0;j<2;++j) C.p[i][j]=0;\n    for (rr int i=0;i<k;++i)\n    for (rr int j=0;j<2;++j)\n    for (rr int k=0;k<2;++k)\n    C.p[i][j]=(1ll*A.p[i][k]*B.p[k][j]+C.p[i][j])%mod;\n    return C;\n}\nsigned main(){\n    for (rr int t=iut();t;--t){\n        rr long long n=iut()-1; rr int k=(n&1)^1; n=n%1996488708;\n        if (!n) {printf(\"1\\n\"); continue;}\n        A.p[0][0]=1; A.p[0][1]=1; A.p[1][0]=1; A.p[1][1]=0;\n        ANS.p[0][0]=1; ANS.p[0][1]=0; ANS.p[1][0]=0; ANS.p[1][1]=0;\n        for (;n;n>>=1,A=mul(A,A,2))\n            if (n&1) ANS=mul(ANS,A,1);\n        printf(\"%d\\n\",(ANS.p[0][0]+(ANS.p[0][1]<<1)%998244353+k)%998244353);\n    }\n    return 0;\n} \n```",
        "postTime": 1559737999,
        "uid": 37782,
        "name": "lemondinosaur",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5136 \u3010sequence\u3011"
    }
]