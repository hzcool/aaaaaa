[
    {
        "content": "# P9089\u300cSvR-2\u300dWork\n\n## \u9898\u76ee\u63cf\u8ff0\n\n\u7ed9\u5b9a $n$ \u4e2a**\u7531\u5c0f\u5199\u5b57\u6bcd\u7ec4\u6210**\u7684\u5b57\u7b26\u4e32\uff0c\u5b9a\u4e49\u7b2c $i$ \u4e2a\u5b57\u7b26\u4e32\u7684\u4ef7\u503c\u4e3a\u5176\u6709\u610f\u4e49\u7684\u5b50\u4e32\u7684\u6570\u91cf\uff08**\u5982\u679c\u6709\u591a\u4e2a\u672c\u8d28\u76f8\u540c\u7684\u5b50\u4e32\u4e5f\u7edf\u8ba1\u591a\u6b21**\uff09\uff0c\u7b2c $i$ \u4e2a\u5b57\u7b26\u4e32\u7684\u4e00\u4e2a\u5b50\u4e32\u6709\u610f\u4e49\uff0c\u5f53\u4e14\u4ec5\u5f53\u8fd9\u4e2a\u5b50\u4e32\u80fd\u88ab\u5206\u6210\u82e5\u5e72\u4e2a\u4e32\uff0c\u5176\u4e2d\u6bcf\u4e2a\u4e32\u90fd\u662f\u8fd9 $n$ \u4e2a\u5b57\u7b26\u4e32\u4e2d\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u4efb\u610f\u4e00\u4e2a\u540e\u7f00\u3002\n\n\u6c42\u8fd9 $n$ \u4e2a\u5b57\u7b26\u4e32\u4ef7\u503c\u4e4b\u548c\u3002\n\n## \u505a\u6cd5\n\n\u8fd9\u91cc\u7531\u6ca1\u6253\u6bd4\u8d5b\u4eba\u7ed9\u51fa\u5b98\u65b9\u9898\u89e3\u4e0d\u5c51\u4e8e\u7ed9\u51fa\u7684 SAM \u505a\u6cd5\uff0c\u8fd9\u91cc\u9ed8\u8ba4\u5927\u5bb6\u4f1a\u5e7f\u4e49 SAM\u3002\n\n\u6b64\u5916\u4e0b\u6587\u4e2d\u590d\u6742\u5ea6\u7684 $n$ \u5373\u8868\u793a $\\sum|s_i|$\u3002\n\n\u5148\u624b\u73a9\u4e00\u4e0b\u6837\u4f8b\uff0c\u53d1\u73b0\u7b54\u6848\u5927\u81f4\u4e0e\u6bcf\u4e00\u4e2a\u4f4d\u7f6e $i$ \u6700\u591a\u5411\u524d\u5ef6\u4f38\u7684\u5408\u6cd5\u4e32\u957f\u5ea6 $f_i$ \u6709\u5173\u3002\u8be6\u7ec6\u7814\u7a76\u4e00\u4e0b\uff0c\u53ef\u4ee5\u5229\u7528\u5355\u8c03\u6808+\u4e8c\u5206\u5b9e\u73b0\u627e\u5230\u4ee5 $i$ \u4e3a\u672b\u5c3e\u5411\u524d\u62fc\u51fa\u7684\u6700\u957f\u5408\u6cd5\u4e32\uff0c\u5e76\u4e14\u7531\u4e8e\u540e\u7f00\u7684\u8fde\u7eed\u6027\uff0c$i$ \u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f $f_i$\uff0c\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n\u8003\u8651\u5982\u4f55\u627e\u5230 $f_i$\u3002\n\n\u7b14\u8005\u672c\u6765\u60f3\u7528 hash+unordered_map \u5b9e\u73b0\uff0c\u590d\u6742\u5ea6 $O(n\\log n)$\uff0c\u4f46\u662f\u5e38\u6570\u592a\u5927\uff0c\u8dd1\u4e0d\u8fc7\u53bb\uff0c\u53ea\u597d\u4e0a\u79d1\u6280\u3002\n\n\u6211\u4eec\u77e5\u9053\uff0c\u5982\u679c\u5728\u4e00\u4e2a\u7b49\u4ef7\u7c7b\u4e3a $pos_i$ \u7684\u5b50\u4e32\u524d\u5220\u4e00\u4e2a\u5b57\u7b26\uff0c\u90a3\u4e48\u65b0\u5b50\u4e32\u7684\u7b49\u4ef7\u7c7b\u4e00\u5b9a\u662f $pos_i$ \u6216 $pos_{fa_i}$\uff0c\u90a3\u4e48\u627e\u5b57\u7b26\u4e32\u7684\u6240\u6709\u540e\u7f00\u5b50\u4e32\u7684\u7b49\u4ef7\u7c7b\u5e76\u6253\u4e0a\u6807\u8bb0\u53ef\u4ee5\u66b4\u529b\u8df3 $fa_i$ \u5b9e\u73b0\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n)$\u3002\n\n\u7531\u4e0a\u8ff0\u6027\u8d28\u4e5f\u53ef\u77e5\uff0c\u5bf9\u4e8e\u4ee5 $i$ \u4e3a\u7ed3\u5c3e\u7684\u5b50\u4e32\u7684\u7b49\u4ef7\u7c7b\u5728 SAM \u7684 parent \u6811\u4e0a\u5f62\u6210\u4e86\u4e00\u6761\u4ece $1$ \u5230 $pos_i$ \u7684\u94fe\u3002\n\n\u4e8e\u662f\u627e\u5230 $f_i$ \u5c31\u53d8\u6210\u4e86\u627e\u5230 $1$ \u5230 $pos_i$ \u8fd9\u6761\u94fe\u4e0a\u6df1\u5ea6\u6700\u5927\u7684\u6709\u6807\u8bb0\u7684\u70b9 $j$\uff0c$f_i$ \u5373\u4e3a $len_j$\uff0c\u53ef\u4ee5\u79bb\u7ebf $dfs$ \u5b9e\u73b0\uff0c\u590d\u6742\u5ea6 $O(n)$\u3002\n\n\u603b\u590d\u6742\u5ea6 $O(26n+n\\log n)$\uff0c\u4e0d\u8fc7\u56e0\u4e3a SAM \u8dd1\u5f97\u6ee1\uff08\u4ee5\u53ca\u4e2a\u4eba\u5e38\u6570\u539f\u56e0\uff09\uff0c\u53ea\u80fd\u52c9\u5f3a\u901a\u8fc7\u3002\n\n\u5c5e\u4e8e\u4e00\u9053\u7406\u89e3 SAM \u7684 parent \u6811\u7684\u6027\u8d28\u7684\u597d\u9898\u3002\n\n## \u4ee3\u7801\n\n```cpp\nconst int N=1e6+5;\nll ans;\nint n,t;\nstring s[N];\nint st[N],len[N];\nvector<int> a[N],l[N];\nstruct Trie{\n\tint cnt=1;\n\tint to[N][26],fa[N];\n\tinline void add(string s,int n){\n\t\tint u=1;\n\t\tF(i,1,n){\n\t\t\tint k=s[i]-'a';\n\t\t\tif(!to[u][k]){\n\t\t\t\tto[u][k]=++cnt;\n\t\t\t\tfa[cnt]=u;\n\t\t\t}\n\t\t\tu=to[u][k];\n\t\t}\n\t}\n}T;\nstruct SAM{\n\tint cnt=1;\n\tint tr[N<<1][26],fa[N<<1],len[N<<1],pos[N<<1];\n\tinline int add(int c,int lst){\n\t\tint p=lst,u=++cnt;\n\t\tlen[u]=len[p]+1;\n\t\tfor(;p&&!tr[p][c];p=fa[p]) tr[p][c]=u;\n\t\tif(!p) fa[u]=1;\n\t\telse{\n\t\t\tint q=tr[p][c];\n\t\t\tif(len[q]==len[p]+1) fa[u]=q;\n\t\t\telse{\n\t\t\t\tint s=++cnt;\n\t\t\t\tfa[s]=fa[q];\n\t\t\t\tfa[q]=fa[u]=s;\n\t\t\t\tlen[s]=len[p]+1;\n\t\t\t\tF(i,0,25) tr[s][i]=tr[q][i];\n\t\t\t\tfor(;p&&tr[p][c]==q;p=fa[p]) tr[p][c]=s;\n\t\t\t}\n\t\t}\n\t\treturn u;\n\t}\n\tqueue<pii> q;\n\tinline void build(){\n\t\tF(i,0,25) if(T.to[1][i]) q.push({T.to[1][i],i});\n\t\tpos[1]=1;\n\t\twhile(!q.empty()){\n\t\t\tpii tmp=q.front();q.pop();\n\t\t\tint u=tmp.fi,c=tmp.se;\n\t\t\tpos[u]=add(c,pos[T.fa[u]]);\n\t\t\tF(i,0,25) if(T.to[u][i]) q.push({T.to[u][i],i});\n\t\t}\n\t}\n}S;\nstruct parent_tree{\n\tvector<int> e[N<<1];\n\tvector<pii> q[N<<1];\n\tbool vis[N<<1];\n\tinline void build(){\n\t\tF(i,1,S.cnt) e[S.fa[i]].push_back(i);\n\t}\n\tinline void dfs(int u,int topf){\n\t\tif(vis[u]) topf=u;\n\t\tfor(pii x:q[u]) a[x.fi][x.se]=S.len[topf];\n\t\tfor(int v:e[u]) dfs(v,topf);\n\t}\n}P;\ninline int get_id(string s,int id){\n\tint p=1,n=len[id];\n\tF(i,1,n){\n\t\tint k=s[i]-'a';\n\t\tp=S.tr[p][k];\n\t\tP.q[p].emplace_back(id,i);\n\t}\n\treturn p;\n}\nint main(){\n\tn=read();\n\tF(i,1,n){\n\t\tcin>>s[i];\n\t\tlen[i]=s[i].size();\n\t\ta[i].resize(len[i]+5);\n\t\tl[i].resize(len[i]+5);\n\t\ts[i]=\" \"+s[i];\n\t\tT.add(s[i],len[i]);\n\t}\n\tS.build();\n\tP.build();\n\tF(i,1,n){\n\t\tint p=get_id(s[i],i);\n\t\twhile(p){\n\t\t\tP.vis[p]=1;\n\t\t\tp=S.fa[p];\n\t\t}\n\t}\n\tP.dfs(1,0);\n\tF(i,1,n){\n\t\tst[t=1]=0;\n\t\tl[i][0]=1;\n\t\tF(j,1,len[i]){\n//\t\t\tcout<<a[i][j]<<\" \";\n\t\t\tl[i][j]=j+1;\n\t\t\tif(a[i][j]){\n\t\t\t\tint k=lower_bound(st+1,st+t+1,j-a[i][j])-st;\n\t\t\t\tl[i][j]=l[i][st[k]];\n\t\t\t\tans+=j-l[i][j]+1;\n\t\t\t}\n\t\t\twhile(t&&l[i][st[t]]>=l[i][j]) t--;\n\t\t\tst[++t]=j;\n\t\t}\n//\t\tputs(\"\");\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n\n```\n",
        "postTime": 1676731793,
        "uid": 406832,
        "name": "Mikefeng",
        "ccfLevel": 7,
        "title": "P9089"
    },
    {
        "content": "\u6765\u4e2a\u65f6\u95f4\u590d\u6742\u5ea6\u771f\u7684\u7ebf\u6027\u7684\u505a\u6cd5\u3002\n\n\u524d\u9762\u7684\u90e8\u5206\u548c\u9898\u89e3\u533a\u90a3\u4e2a AC \u81ea\u52a8\u673a\u505a\u6cd5\u76f8\u540c\u3002\u5148\u90fd reverse \u4e00\u4e0b\uff0c\u627e\u4e0b\u5145\u5206\u6761\u4ef6\uff0c\u4e00\u4e2a\u4e32 $S$ \u5408\u6cd5\u5f53\u4e14\u4ec5\u5f53\u5b83\u7684\u6240\u6709\u524d\u7f00\u90fd\u5b58\u5728\u4e00\u4e2a\u540e\u7f00\u5728 Trie \u91cc\u9762\u51fa\u73b0\u8fc7\u3002\u5fc5\u8981\u6027\u6784\u9020\u5c31\u662f\u6bcf\u6b21\u5220\u6389\u5f53\u524d\u8fd9\u4e2a\u524d\u7f00\u7684\u6700\u77ed\u7684\u540e\u7f00\u3002\n\n\u7136\u540e\u8003\u8651\u6839\u636e\u8fd9\u4e2a\u5fc5\u8981\u6027\u7684\u6784\u9020\u5212\u5206\u7b49\u4ef7\u7c7b\u6765 dp\u3002\n\n\u9996\u5148 $g_u$ \u8868\u793a $u$ \u8282\u70b9\u4ee3\u8868\u5b57\u7b26\u4e32\u5728 Trie \u4e2d\u51fa\u73b0\u8fc7\u7684\u6700\u77ed\u540e\u7f00\uff0c\u5f53 $fail_u$ \u5b58\u5728\u65f6 $g_u\\gets g_{fail[u]}$\uff0c\u5426\u5219 $g_u$ \u6ca1\u6709\u771f\u540e\u7f00\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6700\u77ed\u540e\u7f00\u5c31\u662f\u5b83\u81ea\u5df1\u3002\n\n\u7136\u540e $f_i$ \u8868\u793a\u5f53\u524d\u8fd9\u4e2a\u4e32\u4ee5 $s_i$ \u4e3a\u7ed3\u5c3e\u7684\u540e\u7f00\u6709\u591a\u5c11\u4e2a\u662f\u5408\u6cd5\u7684\uff0c\u9996\u5148 $s[:i]$ \u662f\u5408\u6cd5\u7684\uff0c\u7136\u540e\u5220\u6389\u5b83\u770b\u5b83\u524d\u9762\u80fd\u63a5\u4e0a\u51e0\u4e2a\uff0c\u5c31\u662f $f_{i-g[u]}$\uff0c\u8fd9\u91cc $u$ \u662f $s[:i]$ \u5728 Trie \u4e2d\u4ee3\u8868\u7684\u8282\u70b9\u3002\n\n\u6ce8\u610f\u5230\u8fd9\u91cc\u5e76\u4e0d\u9700\u8981\u6c42\u51fa AC \u81ea\u52a8\u673a\u7684\u8f6c\u79fb\u8fb9\uff0c\u4ec5\u9700\u8981 Trie \u8fb9\u4ee5\u53ca fail \u6811\u3002\u6240\u4ee5\u8fd9\u6837\u6784\u5efa\uff1a\n\n> \u8003\u8651 $x$ \u662f\u7531 Trie \u4e2d\u7684\u7236\u4eb2 $fa$ \u901a\u8fc7 $c$ \u8f6c\u79fb\u8fb9\u5f97\u5230\u7684\u3002\u90a3\u4e48\u68c0\u7d22 $y=fail_{fa}$\uff0c\u82e5 $y$ \u5b58\u5728\u5b57\u7b26 $c$ \u7684\u8f6c\u79fb\u8fb9\uff0c\u5219\u4ee4 $x$ \u6307\u5411 $tr_{y,c}$\uff1b\u5426\u5219\uff0c\u4ee4 $y\\gets fail_y$ \u5373\u4e0d\u65ad\u8df3 fail \u68c0\u67e5\u662f\u5426\u6709 $c$ \u51fa\u8fb9\u3002\u82e5\u5230\u4e86\u521d\u59cb\u8282\u70b9\uff08Trie \u7684\u6839\u8282\u70b9\uff09\u4f9d\u7136\u6ca1\u6709 $c$ \u51fa\u8fb9\uff0c\u5219\u4ee4 $fail_x$ \u6307\u5411\u521d\u59cb\u8282\u70b9\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u4e32\u5728 Trie \u4e2d\u81ea\u9876\u5411\u4e0b\u8003\u8651\u5c1d\u8bd5\u5bfb\u627e fail \u7684 $y$ \u5728\u6700\u7ec8 fail \u6811\u4e2d\u7684\u6df1\u5ea6\u53d8\u5316\uff0c\u6bcf\u6b21\u5411\u4e0b\u8d70\u4e00\u4e2a\u513f\u5b50 $y$ \u6df1\u5ea6\u6700\u591a $+1$\uff0c\u6bcf\u6b21\u66b4\u529b\u8df3 fail \u6df1\u5ea6\u90fd\u4f1a $-1$\uff0c\u5747\u644a\u4e0b\u6765\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $\\mathcal{O}(\\sum |s|)$\uff0e\n\n\u6240\u4ee5\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O}(\\sum |s|)$\uff0c\u5e76\u4e0d\u4f1a\u4e58\u4e0a\u4e00\u4e2a\u5b57\u7b26\u96c6\u5927\u5c0f\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define fi first\n#define se second\n#define mp make_pair\nusing namespace std;\ntypedef pair<int,int> pii;\nconst int N=1000010;\nint n;\nint tr[N][26],fa[N],fail[N],dep[N],g[N],tot;\nint head[N],ent;\nstruct Edge{\n\tint nxt,to,col;\n}e[N];\nint f[N];\nvoid add(int x,int y,int c){\n\ttr[x][c]=y;fa[y]=x;dep[y]=dep[x]+1;\n\te[++ent]={head[x],y,c};head[x]=ent;\n}\nvoid Ins(string &s){\n\tint u=0,l=s.size();\n\tfor(int i=0;i<l;i++){\n\t\tif(!tr[u][s[i]-'a'])add(u,++tot,s[i]-'a');\n\t\tu=tr[u][s[i]-'a'];\n\t}\n}\nvoid build(){\n\tqueue<pii>q;\n\tfor(int i=0;i<26;i++)if(tr[0][i])q.push(mp(tr[0][i],i));\n\twhile(!q.empty()){\n\t\tint u=q.front().fi,c=q.front().se;q.pop();\n\t\tint x=fail[fa[u]];\n\t\twhile(x&&!tr[x][c])x=fail[x];\n\t\tif(x!=fa[u])fail[u]=tr[x][c];\n\t\tg[u]=fail[u]?g[fail[u]]:dep[u];\n\t\tfor(int i=head[u];i;i=e[i].nxt)q.push(mp(e[i].to,e[i].col));\n\t}\n}\nstring s[N];\nsigned main(){\n\tios::sync_with_stdio(0);cin.tie(0);\n\tcin >> n;\n\tfor(int i=1;i<=n;i++){\n\t\tcin >> s[i];\n\t\treverse(s[i].begin(),s[i].end());\n\t\tIns(s[i]);\n\t}\n\tbuild();\n\tlong long ans=0;\n\tfor(int o=1;o<=n;o++){\n\t\tint m=s[o].size(),u=0;f[0]=0;\n\t\tfor(int i=0;i<m;i++){\n\t\t\tu=tr[u][s[o][i]-'a'];\n\t\t\tf[i]=f[i-g[u]]+1;\n\t\t\tans+=f[i];\n\t\t}\n\t}\n\tcout << ans << '\\n';\n\treturn 0;\n}\n```",
        "postTime": 1677139533,
        "uid": 223298,
        "name": "do_while_true",
        "ccfLevel": 8,
        "title": "\u300c\u9898\u89e3\u300d\u6d1b\u8c37 P9089 \u300cSvR-2\u300dWork"
    },
    {
        "content": "\u9a8c\u9898\u4eba\u505a\u6cd5\u3002\n\n\u9996\u5148\u5bb9\u6613\u53d1\u73b0\uff0c\u4ee5\u6bcf\u4e2a\u4f4d\u7f6e\u4e3a\u7ed3\u5c3e\u7684\u6240\u6709\u6709\u610f\u4e49\u7684\u5b50\u4e32\uff0c\u5b83\u4eec\u7684\u5f00\u5934\u4e00\u5b9a\u662f\u8fde\u7eed\u7684\u4e00\u6bb5\uff0c\u8fd9\u6837\u53ea\u9700\u8981\u6c42\u51fa\u6700\u5c0f\u7684\u53ef\u884c\u5f00\u5934\u5373\u53ef\u3002\u4e4b\u540e\u8003\u8651\u8bbe $f_{i,j}$ \u8868\u793a\u6700\u5c0f\u7684 $k$\uff0c\u6ee1\u8db3 $S_{i,k}S_{i,k+1}...S_{i,j-1}S_{i,j}$ \u662f\u8fd9 $n$ \u4e2a\u5b57\u7b26\u4e32\u4e2d\u4efb\u610f\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u4efb\u610f\u4e00\u4e2a\u540e\u7f00\uff0c$g_{i,j}$ \u8868\u793a\u7b2c $i$ \u4e2a\u5b57\u7b26\u4e32\u4ee5 $j$ \u4e3a\u7ed3\u5c3e\u7684\u6700\u957f\u7684\u6709\u4ef7\u503c\u7684\u6bb5\u7684\u5f00\u5934\uff0c\u4e0d\u96be\u53d1\u73b0\uff0c$g_{i,j}=\\min(f_{i,j},\\min\\limits_{k=f_{i,j}-1}^{j-1}g_{i,k})$\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728 SAM \u4e0a\u8dd1\u5339\u914d\u6c42\u51fa $f$\uff0c\u518d\u5229\u7528\u5e76\u67e5\u96c6\u7ef4\u62a4 $g$\uff0c\u5373\u53ef\u901a\u8fc7\u672c\u9898\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nnamespace Wilson_Inversion {\nvoid main();\n}\nint main() {\n\tWilson_Inversion::main();\n\treturn 0;\n}\nnamespace Wilson_Inversion {\nconstexpr int N(1000010);\nint n, ld[N], rd[N], tot1(1), tot2(1), f[N], lp[N];\nlong long ans;\nchar s[N];\nvector<int> e[N << 1];\nstruct TrieNode {\n\tint son[26], p, ed;\n} trie[N];\nstruct SamNode {\n\tint son[26], len, ed, fa;\n} sam[N << 1];\nvoid insert(int l, int r) {\n\tint now(1);\n\tfor (int i(l); i <= r; ++i) {\n\t\tint op(s[i] - 'a');\n\t\tif (!trie[now].son[op]) trie[now].son[op] = ++tot1;\n\t\tnow = trie[now].son[op];\n\t}\n\ttrie[now].ed = max(trie[now].ed, r - l + 1);\n}\nvoid ins(int op, int &np, int p, int ed) {\n\tnp = ++tot2, sam[np].len = sam[p].len + 1, sam[np].ed = ed;\n\twhile (p && (!sam[p].son[op])) sam[p].son[op] = np, p = sam[p].fa;\n\tif (!p)\n\t\tsam[np].fa = 1;\n\telse {\n\t\tint q(sam[p].son[op]);\n\t\tif (sam[q].len == sam[p].len + 1)\n\t\t\tsam[np].fa = q;\n\t\telse {\n\t\t\tint nq(++tot2);\n\t\t\tmemcpy(sam[nq].son, sam[q].son, sizeof(sam[q].son)),\n\t\t\t\tsam[nq].fa = sam[q].fa, sam[nq].len = sam[p].len + 1,\n\t\t\t\tsam[q].fa = sam[np].fa = nq;\n\t\t\twhile (p && sam[p].son[op] == q) sam[p].son[op] = nq, p = sam[p].fa;\n\t\t}\n\t}\n}\nvoid build() {\n\tqueue<int> q;\n\tq.push(1), trie[1].p = 1;\n\twhile (!q.empty()) {\n\t\tint u(q.front());\n\t\tq.pop();\n\t\tfor (int i(0); i < 26; ++i)\n\t\t\tif (trie[u].son[i]) {\n\t\t\t\tq.push(trie[u].son[i]), ins(i, trie[trie[u].son[i]].p,\n\t\t\t\t\t\t\t\t\t\t\ttrie[u].p, trie[trie[u].son[i]].ed);\n\t\t\t}\n\t}\n\tfor (int i(2); i <= tot2; ++i) e[sam[i].fa].emplace_back(i);\n}\nvoid dfs(int x) {\n\tfor (auto i : e[x]) {\n\t\tdfs(i);\n\t\tif (sam[i].ed) sam[x].ed = sam[x].len;\n\t}\n}\nvoid dfs2(int x) {\n\tsam[x].ed = max(sam[x].ed, sam[sam[x].fa].ed);\n\tfor (auto i : e[x]) dfs2(i);\n}\nint find(int x) { return ((f[x] == x) ? x : (f[x] = find(f[x]))); }\nvoid match(int l, int r) {\n\tint now(1), len(0);\n\tfor (int i(l); i <= r; ++i) {\n\t\tint op(s[i] - 'a');\n\t\twhile (now && (!sam[now].son[op]))\n\t\t\tnow = sam[now].fa, len = sam[now].len;\n\t\tif (!now)\n\t\t\tnow = 1;\n\t\telse\n\t\t\tnow = sam[now].son[op], ++len;\n\t\tint t(min(len, sam[now].ed));\n\t\tif (!t) continue;\n\t\tint ls(i - t + 1);\n\t\tif (lp[find(ls - 1)])\n\t\t\tlp[i] = lp[find(ls - 1)];\n\t\telse\n\t\t\tlp[i] = ls;\n\t\tfor (int j(find(ls - 1)); j < i; j = find(j + 1)) f[j] = j + 1;\n\t\tans += i - lp[i] + 1;\n\t}\n}\nvoid main() {\n\tscanf(\"%d\", &n);\n\tfor (int i(1); i <= n; ++i) {\n\t\tscanf(\"%s\", s + rd[i - 1] + 1);\n\t\tint len(strlen(s + rd[i - 1] + 1));\n\t\tld[i] = rd[i - 1] + 1, rd[i] = rd[i - 1] + len;\n\t\tinsert(ld[i], rd[i]);\n\t}\n\tbuild();\n\tdfs(1);\n\tdfs2(1);\n\tfor (int i(1); i <= rd[n]; ++i) f[i] = i;\n\tf[rd[n] + 1] = rd[n] + 1;\n\tfor (int i(1); i <= n; ++i) match(ld[i], rd[i]), lp[rd[i]] = 0;\n\tprintf(\"%lld\\n\", ans);\n}\n}\n```\n",
        "postTime": 1676827226,
        "uid": 576737,
        "name": "Wilson_Inversion",
        "ccfLevel": 7,
        "title": "P9089 \u300cSvR-2\u300dWork \u9898\u89e3"
    },
    {
        "content": "\u5b98\u65b9\u9898\u89e3\u3002\r\n\r\n\r\n### subtask1\r\n\r\n\u66b4\u529b\u5373\u53ef\u3002\r\n\r\n### subtask2\r\n\r\n\u663e\u7136\u6240\u6709\u5b57\u7b26\u4e32\u90fd\u53ef\u4ee5\u8868\u793a\u51fa\u6765\u3002\r\n\r\n### subtask3\r\n\r\n$n=1$\r\n \r\n\u7559\u7ed9\u4e00\u4e9b\u8d2a\u5fc3\u3002 \r\n \r\n### subtask4\uff0c5\r\n\r\n\r\n\u4e0b\u6587\u672a\u8bf4\u660e\u5747\u662f\u5bf9\u4e8e\u6bcf\u4e2a\u4e32\u5206\u522b\u8003\u8651\u7b54\u6848\u3002\r\n\r\n\u6ce8\u610f\u5230\u5bf9\u4e8e\u6bcf\u4e2a $i$ \u53ef\u4ee5\u9884\u5904\u7406 $f_i$ \u8868\u793a $S_{f_i...i}$ \u662f\u4ee5 $i$ \u4e3a\u53f3\u7aef\u70b9\u4e2d\u6700\u957f\u7684\u4e00\u4e2a\u53ef\u4ee5\u88ab\u8868\u793a\u4e3a\u5176\u4e2d\u4e00\u4e2a\u540e\u7f00\u7684\uff0c\u5219\u5de6\u7aef\u70b9\u5728 $[f_i,i]$ \u4e4b\u95f4\u7684\u5b50\u4e32\u5747\u53ef\u4ee5\u8868\u793a\u4e3a\u5176\u4e2d\u4e00\u4e2a\u540e\u7f00\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c$f_i$ \u5177\u6709\u5355\u8c03\u6027\u3002\r\n\r\n\u56e0\u6b64\u53ef\u4ee5\u4e8c\u5206 $f_i$\uff0c\u5b58\u4e0b\u6bcf\u4e2a\u540e\u7f00\u7684\u54c8\u5e0c\u503c\uff0c\u770b\u662f\u5426\u8ddf\u6709 $[f_i,i]$ \u76f8\u540c\u54c8\u5e0c\u503c\u7684\uff0c\u6839\u636e check \u590d\u6742\u5ea6\u5728 $O(|S|^2)$ \u5230 $O(|S| \\log |S|)$ \u4e0d\u7b49\uff0c\u5982\u679c\u60f3\u8981\u901a\u8fc7\u672c\u9898\u5168\u90e8\u6d4b\u8bd5\u70b9\uff0c\u53ef\u4ee5\u4f7f\u7528 `map` \u5224\u65ad\uff0c\u590d\u6742\u5ea6 $O(|S| \\log^2 |S|)$\u3002\r\n\r\n\u8003\u8651\u5982\u4f55\u4e0d\u91cd\u7684 dp\uff0c\u4e00\u79cd\u529e\u6cd5\u662f\uff0c\u5bf9 $f_i$ \u8fdb\u884c\u4e00\u70b9\u5fae\u5999\u7684\u6539\u52a8\uff0c\u5728\u4e00\u904d\u6c42 $f_i$ \u540e\uff0c\u5982\u679c\u5b58\u5728 $j<i,f_j \\le f_i$ \u5c31\u628a $f_i$ \u6539\u53d8\u4e3a $j+1$\uff0c\u5c31\u662f\u8bf4\u518d\u5f80\u540e\u53ef\u4ee5\u62ff $j$ \u53bb\u66ff\u4ee3 $i$\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u8bb0 $ans_i$ \u8868\u793a\u4ee5 $i$ \u7ed3\u5c3e\u7684\u6709\u4ef7\u503c\u5b50\u4e32\u6570\u91cf\uff0c\u6709 $ans_i=ans_{f_i-1}+(i-f_i+1)$\u3002\r\n\r\n\u901a\u8fc7\u4e00\u4e9b\u7b80\u5355\u7684\u6570\u636e\u7ed3\u6784\u6280\u5de7\uff0c\u53ef\u4ee5\u5728\u4e00\u4e2a $\\log$ \u7684\u590d\u6742\u5ea6\u5185\u5b8c\u6210\u4e00\u4e2a $f_i$ \u7684\u66f4\u65b0\uff0c\u6240\u4ee5\u4e0d\u5f71\u54cd\u590d\u6742\u5ea6\u3002\r\n\r\n### subtask 6\r\n\r\n\u5982\u679c\u4f60\u4f1a SAM\uff0cSA \u4e4b\u7c7b\u7684\u540e\u7f00\u6570\u636e\u7ed3\u6784\uff0c\u53ef\u4ee5\u76f4\u63a5\u505a\u5230 $c \\sum |S|+\\sum |S| \\log \\sum |S|$ \uff0c$c$ \u4e3a\u5b57\u7b26\u96c6\u5927\u5c0f\u3002~~\u4f46\u662f\u8d85\u7eb2\u4e86\u3002~~\r\n\r\n\u8003\u8651 $f_i$ \u53d8\u5316\u4e4b\u540e\u7684\u6027\u8d28\uff0c\u6211\u4eec\u76f8\u5f53\u4e8e\u53bb\u9664\u4e86\u6240\u6709 $[f_i,i]$ \u76f8\u4ea4\u7684\u90e8\u5206\uff0c\u56e0\u6b64\u6709\u4efb\u610f\u4e24\u4e2a $[f_i,i]$ \u4e0d\u4ea4\u6216\u5305\u542b\u3002\u636e\u6b64\u63d0\u51fa\u4e00\u4e2a\u66f4\u5feb\u7684\u7b97\u6cd5\r\n\uff1a\r\n\r\n\u4ece\u5de6\u5f80\u53f3\u8003\u8651\uff0c\u7ef4\u62a4\u5f53\u524d\u6ca1\u6709\u88ab\u8986\u76d6\u7684 $[f_i,i]$ \uff0c\u5047\u8bbe\u5f53\u524d\u8003\u8651\u5230\u4e00\u4e2a $i$\uff0c\u5f80\u524d\u626b\u672a\u8986\u76d6\u7684\u8fde\u7eed\u6bb5\uff0c\u56e0\u4e3a\u4e0d\u5b58\u5728\u76f8\u4ea4\uff0c\u6240\u4ee5\u53ea\u6709\u76ee\u524d\u7684 $[f_i,i]$ \u8986\u76d6\u539f\u6765\u7684\u6216\u8005\u505c\u5728\u67d0\u4e2a\u5730\u65b9\u4e0d\u52a8\uff0c\u4e2d\u95f4\u672a\u88ab\u8986\u76d6\u7684\u53ef\u4ee5\u66b4\u529b\u5f80\u524d\u626b\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003\u4ee3\u7801\u5b9e\u73b0\u3002\r\n\r\n\u5206\u6790\u590d\u6742\u5ea6\uff0c\u6bcf\u4e2a\u8fde\u7eed\u6bb5\u53ea\u4f1a\u88ab\u5220\u4e00\u6b21\uff0c\u6bcf\u4e2a\u672a\u88ab\u8986\u76d6\u7684\u5730\u65b9\u4e5f\u53ea\u4f1a\u88ab\u626b\u4e00\u6b21\uff0c\u74f6\u9888\u5728\u4e8e\u67e5\u8be2\u4e00\u4e2a\u5b50\u4e32\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u4e3a $O(\\sum |S|\\log |S|)$\u3002\u5f53\u7136 std \u901a\u8fc7\u6302\u94fe\u54c8\u5e0c\u80fd\u505a\u5230\u7ebf\u6027\uff0c\u4e0d\u8fc7\u4e0d\u5728\u672c\u9898\u8003\u5bdf\u8303\u56f4\u4e4b\u5185\u3002",
        "postTime": 1676723647,
        "uid": 282751,
        "name": "cryozwq",
        "ccfLevel": 7,
        "title": "P9089"
    },
    {
        "content": "\u8fd9\u9053\u9898\u76ee\u663e\u7136\u4e0e\u5b57\u7b26\u4e32\u76f8\u5173\uff0c\u800c\u5904\u7406\u4e00\u6bb5\u5b50\u4e32\u4e0e\u6240\u6709\u7684\u540e\u7f00\u5e93\u4e2d\u662f\u5426\u6709\u5339\u914d\u7684\u6700\u7b80\u4fbf\u65b9\u5f0f\u5c31\u662f\u54c8\u5e0c\u3002\u56e0\u6b64\uff0c\u4e00\u4e2a\u505a\u6cd5\u5c31\u662f\u5148\u628a\u6240\u6709\u7684\u540e\u7f00\u7684\u54c8\u5e0c\u503c\u90fd\u4e22\u8fdb\u4e00\u4e2a\u96c6\u5408\u91cc\u9762\uff0c\u7136\u540e\u679a\u4e3e\u5b50\u4e32\u5c1d\u8bd5\u53bb\u548c\u96c6\u5408\u91cc\u9762\u7684\u54c8\u5e0c\u503c\u5339\u914d\uff0c\u4f46\u662f\uff0c\u8fd9\u6837\u505a\uff0c\u590d\u6742\u5ea6\u662f $O((\\sum |s_i|^2)\\log(\\sum|s_i|))$ \u7684\uff0c\u590d\u6742\u5ea6\u8fc7\u9ad8\u3002\n\n\u7136\u800c\uff0c\u771f\u7684\u6709\u5fc5\u8981\u679a\u4e3e\u6240\u6709\u7684\u5b50\u4e32\u5417\uff1f\u5176\u5b9e\u6ca1\u5fc5\u8981\uff0c\u539f\u56e0\u5728\u4e8e\u5047\u8bbe\u4e00\u4e2a\u975e\u7a7a\u5b57\u7b26\u4e32 $\\texttt{A}$ \u662f\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\uff0c\u90a3\u4e48\u5b57\u7b26\u4e32 $\\texttt{cA}$ \u4e5f\u662f\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\uff08$\\texttt{c}$ \u4e3a\u4efb\u610f\u5b57\u7b26\uff09\u3002\u8fd9\u5f88\u597d\u7406\u89e3\uff0c\u5047\u8bbe $\\texttt{cA}$ \u6ee1\u8db3\u6761\u4ef6\u4e86\uff0c\u90a3\u4e48\u53bb\u6389\u524d\u9762\u7684\u90a3\u4e2a\u5b57\u7b26\uff0c\u66f4\u5bb9\u6613\u5339\u914d\u4e0a\u3002\u800c\u4e14\uff0c\u8fd8\u6709\u4e00\u4e2a\u6027\u8d28\u5c31\u662f\u5bf9\u4e8e\u4e24\u4e2a\u5747\u6ee1\u8db3\u6761\u4ef6\u7684\u5b57\u7b26\u4e32 $\\texttt{A}$ \u548c $\\texttt{B}$\uff0c\u90a3\u4e48\u52a0\u4e0a\u4e00\u4e2a\u5b57\u7b26 $\\texttt{c}$ \u4ee5\u540e\uff0c\u53ea\u8981\u957f\u5ea6\u8f83\u5c0f\u7684\u5b57\u7b26\u4e32\u6ee1\u8db3\u6761\u4ef6\uff0c\u90a3\u4e48\u957f\u5ea6\u8f83\u5927\u7684\u90a3\u4e2a\u5b57\u7b26\u4e32\u4e00\u5b9a\u6ee1\u8db3\u6761\u4ef6\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u8fd9\u6837\u7684\u505a\u6cd5\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u5b57\u7b26\u4e32\uff0c\u7ef4\u62a4\u4e00\u4e2a\u6808\u8868\u793a\u53f3\u7aef\u70b9\uff0c\u4ece\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u5f00\u59cb\u679a\u4e3e\uff0c\u5982\u679c\u52a0\u4e0a\u8fd9\u4e00\u5b57\u7b26\u540e\uff0c\u6808\u9876\u7684\u5b57\u7b26\u4e32\u4e0d\u518d\u6ee1\u8db3\u6761\u4ef6\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5c06\u5176\u8e22\u51fa\uff0c\u76f4\u5230\u6808\u7a7a\u6216\u6808\u9876\u7684\u5b57\u7b26\u4e32\u6ee1\u8db3\u6761\u4ef6\u3002\u8fd9\u6837\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u53ef\u4ee5\u4f18\u5316\u81f3 $O((\\sum |s_i|)\\log(\\sum |s_i|))$\u3002\u74f6\u9888\u5728\u4e8e\u628a\u540e\u7f00\u63d2\u5165\u96c6\u5408\u3002\u82e5\u4f60\u771f\u60f3\u628a\u8fd9\u4e2a $\\log$ \u53bb\u6389\uff0c\u53ef\u4ee5\u518d\u7528\u4e00\u4e2a\u6302\u94fe\u54c8\u5e0c\u4f18\u5316\uff0c\u4ee3\u7801\u957f\u5ea6\u53ea\u6709\u5b98\u65b9\u9898\u89e3\u7684\u7ea6 $70\\%$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst ll N=5e5+7;\nconst ll B=1327;\nconst ll X=1321321327;//\u5efa\u8bae\u53cc\u54c8\u5e0c\uff0c\u5426\u5219\u5bb9\u6613\u5bc4\uff08\u5b57\u7b26\u4e32\u4e2a\u6570\u7ea6\u4e3a10^6\uff09\nconst ll Y=1431431437;//\u540c\u65f6\u5efa\u8bae\u7528\u751f\u50fb\u4e00\u70b9\u7684\u6a21\u6570\uff0c\u5426\u5219\u88ab\u9488\u5bf9\nll px[N*2],py[N*2];\nvoid init(){//\u521d\u59cb\u5316\u4e24\u79cd\u6a21\u6570\n\tpx[0]=py[0]=1;\n\tfor(ll i=1;i<=1e6;++i){\n\t\tpx[i]=px[i-1]*B%X;\n\t\tpy[i]=py[i-1]*B%Y;\n\t}\n}\nstruct H{//\u53cc\u54c8\u5e0c\n\tll l,x,y;\n\tH(ll l=0,ll x=0,ll y=0):l(l),x(x),y(y){}\n\tfriend H operator +(H a,char c){//\u63d2\u5165\u5b57\u7b26\n\t\treturn H(a.l+1,(a.x*B+c)%X,(a.y*B+c)%Y);\n\t}\n\tfriend H operator -(H a,H b){//\u533a\u95f4\u54c8\u5e0c\n\t\treturn H(a.l-b.l,(a.x-b.x*px[a.l-b.l]%X+X)%X,(a.y-b.y*py[a.l-b.l]%Y+Y)%Y);\n\t}\n\tfriend bool operator <(H a,H b){\n\t\tif(a.x^b.x)\n\t\t\treturn a.x<b.x;\n\t\treturn a.y<b.y;\n\t}\n};\nll n,tp,res;\nchar s[N*2];\nstring str[N];\nset<H>st[N*2];\nH stk[N*2];\nint main(){\n\tinit();\n\tscanf(\"%lld\",&n);\n\tfor(ll i=1;i<=n;++i){\n\t\tscanf(\"%s\",s);\n\t\tstr[i]=s;\n\t}\n\tfor(ll i=1;i<=n;++i){\n\t\tll pos=str[i].length();\n\t\tH cur;//\u521d\u59cb\u9ed8\u8ba4\u4e3a\u7a7a\u4e32\n\t\twhile(pos){//\u5012\u5e8f\u679a\u4e3e\n\t\t\t--pos;\n\t\t\tcur=cur+str[i][pos];\n\t\t\tst[cur.l].insert(cur);\n\t\t}\n\t}\n\tfor(ll i=1;i<=n;++i){\n\t\twhile(tp)\n\t\t\tstk[tp--]=H();\n\t\tll pos=str[i].length();\n\t\tH cur;\n\t\ttp=1;//\u6ce8\u610f\u521d\u59cb\u9700\u8981\u52a0\u5165\u4e00\u4e2a\u7a7a\u4e32\n\t\twhile(pos){\n\t\t\t--pos;\n\t\t\tcur=cur+str[i][pos];\n\t\t\twhile(tp&&!st[cur.l-stk[tp].l].count(cur-stk[tp]))//\u4e0d\u6ee1\u8db3\u6761\u4ef6\uff0c\u51fa\u6808\n\t\t\t\tstk[tp--]=H();\n\t\t\tres+=tp;\n\t\t\tstk[++tp]=cur;//\u65e0\u8bba\u5982\u4f55\u90fd\u8981\u5165\u6808\u4e00\u6b21\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",res);\n\treturn 0;\n}\n```",
        "postTime": 1676984763,
        "uid": 181378,
        "name": "Alarm5854",
        "ccfLevel": 7,
        "title": "P9089 \u9898\u89e3"
    },
    {
        "content": "\u5148\u628a\u6240\u6709\u4e32\u7ffb\u8f6c\u3002\u5bf9 $n$ \u4e2a\u4e32\u5efa AC \u81ea\u52a8\u673a\uff0c\u90a3\u4e48\u6bcf\u4e2a\u5b50\u4e32\u5408\u6cd5\u7684\u6761\u4ef6\u7b49\u4ef7\u4e8e\u628a\u8fd9\u4e2a\u5b50\u4e32\u62ce\u51fa\u6765\u5728 AC \u81ea\u52a8\u673a\u4e0a\u8d70\uff0c\u9664\u4e86\u8d77\u70b9\u4ee5\u5916\u6ca1\u6709\u8d70\u5230 $0$\u3002\u8bc1\u660e\u53ef\u4ee5\u8003\u8651\u8c03\u6574\uff0c\u8ba8\u8bba\u4e00\u4e0b\u6bcf\u6b65\u662f\u5426\u6cbf\u7740 Trie \u8fb9\u8d70\u3002\n\n\u7531\u4e8e\u6570\u636e\u6c34\uff0c\u8d5b\u65f6\u76f4\u63a5\u5199\u66b4\u529b\u5373\u53ef\u901a\u8fc7\uff0c\u800c\u4e14\u53ef\u4ee5\u83b7\u5f97\u6700\u4f18\u89e3\u3002\u4e8b\u5b9e\u4e0a $n=1$ \u4e00\u4e2a\u957f\u5ea6\u8f83\u5927\u7684\u5168 `a` \u7684\u4e32\u5c31\u53ef\u4ee5\u5361\u98de\u3002\n\n\u8003\u8651\u4ec0\u4e48\u65f6\u5019\u4f1a\u8d70\u5230 $0$\u3002\u5047\u8bbe\u5bf9\u4e8e\u4e00\u4e2a\u4e32\uff0c\u8d77\u70b9\u4e3a $l$\uff0c\u4f46\u5728\u8d70\u5230\u8282\u70b9 $r$ \u65f6\u8d70\u5230\u4e86 $0$\uff0c\u6211\u4eec\u5e0c\u671b\u8ba1\u7b97 $l$ \u7684\u8303\u56f4\u3002\u6211\u4eec\u5728 fail \u6811\u4e0a\u4ece $1\\to r$ \u8d70\u5230\u7684\u8282\u70b9\u5f00\u59cb\u5f80\u4e0a\u8df3\u7236\u4eb2\uff0c\u90a3\u4e48\u8df3\u5230 $0$ \u7684\u65f6\u5019\u5e94\u8be5\u662f\u6ee1\u8db3 $r-l+1<len$\uff0c\u5176\u4e2d $len$ \u8868\u793a\u6700\u4e0a\u9762\u4e00\u4e2a\u975e $0$ \u7956\u5148\u72b6\u6001\u7684\u957f\u5ea6\u3002\n\n\u4e5f\u5c31\u662f\u6bcf\u4e2a $r$ \u5bf9\u5e94\u7684\u4f1a\u5230 $0$ \u7684 $l$ \u662f\u4e00\u6bb5\u533a\u95f4\uff0c\u90a3\u4e48\u5c31\u662f\u6bcf\u6b21\u5bf9\u4e00\u6bb5\u533a\u95f4\u53d6 $\\min$\uff0c\u6700\u540e\u67e5\u8be2\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u503c\u3002\n\n\u7528\u5806\u6216 set \u6216\u5e76\u67e5\u96c6\u6216\u4f60\u559c\u6b22\u7684\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(c\\sum |S|+\\sum |S|\\log \\sum |S|)$\uff0c\u5176\u4e2d $c$ \u4e3a\u5b57\u7b26\u96c6\u5927\u5c0f\u3002",
        "postTime": 1676799659,
        "uid": 151475,
        "name": "Little09",
        "ccfLevel": 8,
        "title": "P9089 \u300cSvR-2\u300dWork"
    },
    {
        "content": "\u57fa\u4e8e AC \u81ea\u52a8\u673a\u7684\u7ebf\u6027\u89e3\u6cd5\u3002\n\n\u628a\u6240\u6709\u4e32\u90fd\u53cd\u8fc7\u6765\uff0c\u8fd9\u6837\u4e00\u4e2a\u4e32\u6709\u610f\u4e49\u5f53\u4e14\u4ec5\u5f53\u5b83\u53ef\u4ee5\u5206\u89e3\u6210\u82e5\u5e72\u4e2a\u524d\u7f00\u3002\n\n\u5b9a\u4e49\u4e00\u4e2a\u4e32\u7684\u5339\u914d\u662f\u5b83\u7684\u4e00\u4e2a\u540e\u7f00\u4e0e\u67d0\u4e2a $s_i$ \u7684\u524d\u7f00\u76f8\u540c\uff0c\u8fd9\u4e2a\u540e\u7f00\u5c31\u662f\u5b83\u7684\u4e00\u4e2a\u5339\u914d\u3002\n\n\u8003\u8651\u4e00\u4e2a\u4e32 $S$ \u6709\u610f\u4e49\u7684\u5145\u5206\u6761\u4ef6\u662f $S$ \u7684\u6bcf\u4e00\u4e2a\u524d\u7f00\u90fd\u6709\u5339\u914d\u3002\u5bb9\u6613\u53d1\u73b0\u8fd9\u4e5f\u662f\u5fc5\u8981\u6761\u4ef6\u3002\n\n\u7531\u6b64\u7ed9\u51fa\u4e00\u4e2a\u9a8c\u8bc1\u4e00\u4e2a\u4e32\u662f\u5426\u6709\u610f\u4e49\u7684\u65b9\u6cd5\uff1a\u9009\u62e9 $S$ \u7684\u4e00\u4e2a\u5339\u914d\uff0c\u5220\u6389\u5b83\uff0c\u91cd\u590d\u8fd9\u4e2a\u8fc7\u7a0b\u3002\u5982\u679c\u5220\u5149\u4e86\u5c31\u662f\u6709\u610f\u4e49\u7684\u3002\n\n\u73b0\u5728\u7ed9\u4f60\u4e00\u4e2a\u5b57\u7b26\u4e32 $S$\uff0c\u95ee\u4f60 $S$ \u6709\u51e0\u4e2a\u540e\u7f00\u6709\u610f\u4e49\u3002\u6cbf\u7528\u521a\u624d\u7684\u529e\u6cd5\uff0c\u8d2a\u5fc3\u5730\u6bcf\u6b21\u5220\u6389\u4e00\u4e2a\u6700\u77ed\u7684\u5339\u914d\uff0c\u76f4\u5230\u5220\u5149\u6216\u8005\u4e0d\u5b58\u5728\u5339\u914d\uff0c\u5bb9\u6613\u53d1\u73b0\u5220\u9664\u6b21\u6570\u5c31\u662f\u6240\u6c42\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u4e32\u7684\u6bcf\u4e00\u4e2a\u524d\u7f00\uff0c\u90fd\u8981\u6c42\u51fa\u7b54\u6848\uff0c\u8003\u8651\u7b80\u5355 DP\uff1a \n$$f_i=\\left\\{\n\\begin{matrix}\n0 & \\text{MinMatching}(i)=0\\\\\nf_{i-\\text{MinMatching}(i)}+1 & \\text{else}\n\\end{matrix}\n\\right.$$\n\n\u5176\u4e2d $\\text{MinMatching}(i)$ \u662f $S$ \u957f\u5ea6\u4e3a $i$ \u7684\u524d\u7f00\u7684\u6700\u77ed\u5339\u914d\u3002\n\n\u6700\u77ed\u5339\u914d\u53ef\u4ee5\u7528 AC \u81ea\u52a8\u673a\u6765\u6c42\u3002\u81f3\u6b64\u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a $O(|\\Sigma|\\sum |s_i|)$ \u7684\u89e3\u6cd5\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int maxn = 500000, maxs = 1000000;\nstring s[maxn + 5];\nint pcnt;\nint nxt[maxs + 5][26];\nint len[maxs + 5];\nint fail[maxs + 5], mf[maxs + 5];\nint insert(const string& str) {\n\tint n = str.size(), p = 0;\n\tfor (int i = 0; i < n; i++) {\n\t\tint c = str[i] - 'a';\n\t\tif (!nxt[p][c]) nxt[p][c] = ++pcnt;\n\t\tlen[p = nxt[p][c]] = i + 1;\n\t}\n\treturn p;\n}\nvoid build() {\n\tqueue<int> q;\n\tfor (int i = 0; i < 26; i++)\n\t\tif (nxt[0][i]) q.push(nxt[0][i]);\n\twhile (q.size()) {\n\t\tint u = q.front();\n\t\tq.pop();\n\t\tmf[u] = fail[u] ? mf[fail[u]] : len[u];\n\t\tfor (int i = 0; i < 26; i++) {\n\t\t\tif (nxt[u][i]) {\n\t\t\t\tfail[nxt[u][i]] = nxt[fail[u]][i];\n\t\t\t\tq.push(nxt[u][i]);\n\t\t\t} else nxt[u][i] = nxt[fail[u]][i];\n\t\t}\n\t}\n}\nint f[maxs + 5];\nint main() {\n\tint n;\n\tcin >> n;\n\tfor (int i = 1; i <= n; i++) {\n\t\tcin >> s[i];\n\t\treverse(s[i].begin(), s[i].end());\n\t\tinsert(s[i]);\n\t}\n\tbuild();\n\tlong long ans = 0;\n\tfor (int i = 1; i <= n; i++) {\n\t\tint m = s[i].size(), p = 0;\n\t\tfill(f, f + m + 1, 0);\n\t\tfor (int j = 0; j < m; j++) {\n\t\t\tint c = s[i][j] - 'a';\n\t\t\tp = nxt[p][c];\n\t\t\tif (mf[p]) f[j + 1] = f[j - mf[p] + 1] + 1;\n\t\t\tans += f[j + 1];\n\t\t}\n\t}\n\tprintf(\"%lld\", ans);\n}\n```",
        "postTime": 1676774042,
        "uid": 213168,
        "name": "FISHER_",
        "ccfLevel": 7,
        "title": "P9089\u300cSvR-2\u300dWork"
    },
    {
        "content": "\u9898\u5916\u8bdd\uff1a\u4e00\u5f00\u59cb\u770b\u9519\u9898\u76ee\u4e86\u7406\u89e3\u6210\u81f3\u5c11\u4e24\u4e2a\uff0c\u5728\u5751\u8001\u5e08\u7684\u5e2e\u52a9\u4e0b\u624d\u4f1a\u505a\u7684\u3002\n\n\u5728\u6b64\u819c\u62dc @tianhangj\u3002\n\n---\n\n\u8fd9\u91cc\u662f SAM \u4e25\u683c $O(n)$ \u505a\u6cd5 ~~\uff08\u867d\u7136\u88ab nlogn \u8584\u7eb1\uff09~~\u3002\n\n\u9996\u5148\u73b0\u5c06\u95ee\u9898\u5206\u6210\uff1a\n\n- \u5b50\u4e32\u4e2d\u6240\u6709\u4e0e\u540e\u7f00\u76f8\u540c\u7684\u6570\u91cf\u3002\n\n- \u8003\u8651\u5c06\u5b50\u4e32\u5408\u5e76\u3002\n\n---\n\n\u8003\u8651\u95ee\u9898\u4e00\uff0c\n\n\u770b\u5230\u540e\u7f00\uff0c\u5bb9\u6613\u8054\u60f3\u5230\u5c06\u6240\u6709\u6587\u672c\u4e32\u5efa\u4e00\u9897\u540e\u7f00\u81ea\u52a8\u673a\uff0c\n\n**\u56e0\u4e3a\u4e00\u4e2a\u5b50\u4e32\u53ef\u4ee5\u88ab\u8868\u793a\uff0c\u5b83\u7684\u540e\u7f00\u4e5f\u5fc5\u7136\u53ef\u4ee5\uff0c\u8d21\u732e\u5c31\u662f\u5b50\u4e32\u7684\u957f\u5ea6**\u3002\n\n\u6b64\u65f6\u6211\u4eec\u7edf\u8ba1\u51fa\u4ee5\u6bcf\u4e2a\u4e32\u7684\u6bcf\u4e2a\u5b57\u7b26\u4e3a\u7ed3\u675f\u7b26\u6700\u957f\u7684\u53ef\u4ee5\u88ab\u8868\u793a\u7684\u5b50\u4e32\u957f\u3002\n\n\u5148\u8fdb\u884c\u5b57\u7b26\u4e32\u5339\u914d\u5728 SAM \u4e0a\u627e\u5230\u4ee5\u5f53\u524d\u5b57\u7b26\u4e3a\u7ed3\u675f\u7684\u6700\u957f\u5b50\u4e32\uff0c\n\n\u518d\u4ece\u5f53\u524d\u8282\u70b9\u5f80\u540e\u7f00\u8fde\u4e0a\u8df3\uff0c\u76f4\u5230\u8df3\u5230\u4e00\u4e2a\u8282\u70b9\u6240\u8868\u793a\u7684\u5b50\u4e32\u662f\u4e00\u4e2a\u540e\u7f00\uff0c\u6b64\u65f6\u6700\u5927\u7684\u957f\u5ea6\u5373\u4e3a\u6240\u6c42\uff08\u9884\u5904\u7406\u6216\u8005\u8bb0\u5fc6\u5316\u53ef\u4ee5\u505a\u5230\u4e25\u683c $O(n)$ \uff0c\u4e0d\u8fc7\u66b4\u529b\u4e5f\u5dee\u4e0d\u591a\uff0c\u611f\u89c9\u5f88\u96be\u5361\uff09\u3002\n\n- \u5173\u4e8e\u5982\u4f55\u6807\u8bb0\u6240\u6709\u7684\u540e\u7f00\uff1a\u7c7b\u4f3c SAM \u7edf\u8ba1\u4e2a\u6570\u4e00\u6837\uff0c\u5c06\u6bcf\u4e2a\u4e32\u7684\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u6240\u4ee3\u8868\u7684\u8282\u70b9\u6253\u4e0a\u6807\u8bb0\uff0c\u90a3\u4e48\u5b83\u7684\u540e\u7f00\u8fde\u5f80\u4e0a\u7684\u8282\u70b9\u5747\u4e3a\u540e\u7f00\u3002\n\n---\n\n\u6b64\u65f6\u6211\u4eec\u5bf9\u6bcf\u4e2a\u5b57\u7b26\u4e32\u90fd\u5f97\u5230\u4e86\u4e00\u4e2a $pre$ \u6570\u7ec4\uff0c\u63a5\u4e0b\u6765\u8003\u8651\u95ee\u9898\u4e8c\uff0c\n\n\u57fa\u4e8e\u4e4b\u524d\u5f97\u51fa\u7684\u7ed3\u8bba\uff0c\u6211\u4eec\u73b0\u5728\u8981\u7528 $pre$ \u6570\u7ec4\u6c42\u51fa\u4ee5\u6bcf\u4e2a\u5b57\u7b26\u4e3a\u7ed3\u675f\u7b26\u7684\u7b26\u5408\u6761\u4ef6\u7684\u6700\u957f\u5b50\u4e32\uff0c\u5b83\u4eec\u7684\u957f\u5ea6\u548c\u4fbf\u662f\u7b54\u6848\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u7528\u5355\u8c03\u6808 $O(n)$ \u6c42\u89e3\uff08\u518d\u6b21%%%@tianhangj\uff09\u3002\n\n\u4ece\u5de6\u5230\u53f3\u904d\u5386 $pre$ \u6570\u7ec4\uff0c\n\n\u5982\u679c\u4ee5\u5f53\u524d\u4f4d\u7f6e\u4e3a\u7ed3\u675f\u7b26\u7684\u6700\u957f\u5b50\u4e32\u53ef\u4ee5\u8986\u76d6\u6808\u9876\u7684\u7ed3\u675f\u7b26\u4f4d\u7f6e\uff0c\n\n\u90a3\u4e48\u5b83\u53ef\u4ee5\u4e0e\u6808\u9876\u76f8\u62fc\u63a5\uff0c\u4e5f\u5c31\u662f\u5b83\u6bd4\u6808\u9876\u66f4\u4f18\uff0c\u628a\u6808\u9876\u5f39\u51fa\uff0c\u66f4\u65b0\u5f53\u524d\u70b9\u7684 $pre$ \u76f4\u5230\u4e0d\u80fd\u518d\u4e0e\u6808\u9876\u62fc\u63a5\uff0c\u5c06\u5f53\u524d\u4f4d\u7f6e\u52a0\u5165\u6808\u4e2d\uff0c\u6b64\u65f6\u6808\u4e2d\u5fc5\u7136\u6ee1\u8db3\u5355\u8c03\u6027\u3002\n\n\u6240\u6709 $pre$ \u4e4b\u548c\u4fbf\u662f\u7b54\u6848\u3002\n\n---\nCode\uff1a\n```cpp\n#include<algorithm>\n#include<math.h>\n#include<string.h>\n#include<queue>\n#include<stack>\n#include<vector>\n#include<map>\n#include<set>\n#include<iostream>\nusing namespace std;\n\n#define fi first\n#define se second\n#define pb push_back\ntypedef double db;\ntypedef long long ll;\ntypedef pair<int,int> pii;\ntypedef pair<int,ll> pil;\ntypedef pair<ll,int> pli;\ntypedef pair<ll,ll> pll;\nconst int N=1e6+86,M=5e5+86;\n\nll ans,pre[N];\n\nstruct SAM\n{\n\tstruct edge{int to,nxt;}e[N<<1];\n\tint head[N<<1],tot;\n\tvoid add(int u,int v){e[++tot]={v,head[u]},head[u]=tot;}\n\tstruct node\n\t{\n\t\tint len,link,val,ch[26];\n        bool f;\n\t\tvoid init()\n\t\t{\n\t\t\tlen=link=f=val=0;\n\t\t\tmemset(ch,0,sizeof(ch));\n\t\t}\n\t}atm[N<<1];\n\tint siz,last;\n\tvoid init()\n\t{\n\t\tmemset(head,0,sizeof(head));\n\t\ttot=siz=last=0;\n\t\tatm[0].init();\n\t\tatm[0].link=-1;\n\t}\n\tvoid insert(int x,bool f)\n\t{\n\t\tint now=++siz;\n\t\tatm[now].init();\n\t\tatm[now].len=atm[last].len+1;\n        atm[now].f=f;//\u6807\u8bb0\u6bcf\u4e2a\u4e32\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\n\t\tint p=last;\n\t\twhile(p!=-1&&!atm[p].ch[x])\n\t\t\tatm[p].ch[x]=now,p=atm[p].link;\n\t\tif(p==-1) atm[now].link=0;\n\t\telse\n\t\t{\n\t\t\tint q=atm[p].ch[x];\n\t\t\tif(atm[q].len==atm[p].len+1)\n\t\t\t\tatm[now].link=q;\n\t\t\telse\n\t\t\t{\n\t\t\t\tint tmp=++siz;\n\t\t\t\tatm[tmp].init();\n\t\t\t\tatm[tmp]=atm[q];\n\t\t\t\tatm[tmp].len=atm[p].len+1;\n\t\t\t\twhile(p!=-1&&atm[p].ch[x]==q)\n\t\t\t\t\tatm[p].ch[x]=tmp,p=atm[p].link;\n\t\t\t\tatm[q].link=atm[now].link=tmp;\n\t\t\t}\n\t\t}\n\t\tlast=now;\n\t}\n\tvoid dfs1(int u)\n\t{\n\t\tfor(int i=head[u];i;i=e[i].nxt)\n\t\t\tdfs1(e[i].to),atm[u].f|=atm[e[i].to].f;//\u5c06\u5305\u542b\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u7684\u6240\u6709\u5b50\u4e32\uff08\u5373\u540e\u7f00\uff09\u7684\u7ed3\u70b9\u8fdb\u884c\u6807\u8bb0\n\t}\n\tvoid dfs2(int u,int len)//\u5c06\u6bcf\u4e2a\u7ed3\u70b9\u5411\u4e0a\u8df3\u5230\u8fbe\u7684\u7b2c\u4e00\u4e2a\u540e\u7f00\u7684\u957f\u5ea6\u9884\u5904\u7406\n\t{\n\t\tif(atm[u].f) len=atm[u].len;\n\t\tatm[u].val=len;\n\t\tfor(int i=head[u];i;i=e[i].nxt)\n\t\t\tdfs2(e[i].to,len);\n\t}\n\tvoid calc()\n\t{\n\t\tfor(int i=1;i<=siz;i++)\n\t\t\tadd(atm[i].link,i);\n\t\tdfs1(0);\n\t\tdfs2(0,0);\n\t}\n    void solve(string s)\n\t{\n\t\tmemset(pre,0,s.size()<<2);\n\t\tint now=0;\n\t\tfor(int i=0;i<s.size();i++)\n\t\t{\n\t\t\twhile(now&&atm[now].ch[s[i]-'a']==0)//\u5148\u627e\u5230\u5f53\u524d\u5b57\u7b26\u4e3a\u7ed3\u675f\u7b26\u7684\u6700\u5927\u5b50\u4e32\u7684\u7ed3\u70b9\n\t\t\t\tnow=atm[now].link;\n\t\t\tif(atm[now].ch[s[i]-'a'])\n\t\t\t{\n\t\t\t\tnow=atm[now].ch[s[i]-'a'];\n\t\t\t\tpre[i]=atm[now].val;\n\t\t\t}\n\t\t}\n\t\tstack<int> stk;//\u5355\u8c03\u6808\n\t\tfor(int i=0;i<s.size();i++)\n\t\t{\n\t\t\twhile(!stk.empty()&&i-pre[i]<=stk.top()) \n\t\t\t\tpre[i]=max(pre[i],i-stk.top()+pre[stk.top()]),stk.pop();\n\t\t\tans+=pre[i];\n\t\t\tstk.push(i);\n\t\t}\n\t}\n}sam;\n\nstring s[M];\nint n,len;\n\nint main()\n{\n\tios::sync_with_stdio(false);\n\tcin>>n;\n    sam.init();\n    for(int i=1;i<=n;i++)\n    {\n        cin>>s[i];\n        sam.last=0;//\u4f2a\u5e7f\u4e49SAM\n        for(int j=0;j<s[i].size();j++)\n            sam.insert(s[i][j]-'a',j==(s[i].size()-1));\n    }\n    sam.calc();\n    for(int i=1;i<=n;i++)\n\t\tsam.solve(s[i]);\n    cout<<ans<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1676978606,
        "uid": 370599,
        "name": "why_cb",
        "ccfLevel": 0,
        "title": "P9089 \u300cSvR-2\u300dWork \u9898\u89e3"
    }
]