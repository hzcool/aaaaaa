[
    {
        "content": "[\u565c\u5566\u565c\u5566\u54a7\uff0c\u565c\u5566\u565c\u5566\u54a7\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/dysyn1314/p/14585866.html)\n\n\n# \u300cNOI Online 2021 #1\u300d\u5c9b\u5c7f\u63a2\u9669\n\n## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u6392 $n$ \u4e2a\u5143\u7d20\uff0c\u6bcf\u4e2a\u5143\u7d20\u6709\u4e24\u4e2a\u5c5e\u6027\uff1a$a_i, b_i$\u3002\n\n\u6709 $q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u7ed9\u51fa\u56db\u4e2a\u53c2\u6570 $l_j, r_j, c_j, d_j$\u3002\u95ee\u533a\u95f4 $[l, r]$ \u91cc\u6ee1\u8db3 $a_i\\operatorname{xor} c_j \\leq \\min\\{b_i, d_j\\}$ \u7684 $i$ \u6709\u591a\u5c11\u4e2a\u3002\n\n\u6570\u636e\u8303\u56f4\uff1a$1\\leq n,q\\leq 10^5$\uff0c$1\\leq l_j\\leq r_j\\leq n$\uff0c$0\\leq a_i, b_i, c_j, d_j\\leq 2^{24} - 1$\u3002\n\n## \u672c\u9898\u9898\u89e3\n\n**0. \u7ea6\u5b9a**\n\n\u8bbe $m = \\max\\{a_i, b_i, c_j, d_j\\}$\uff0c\u8fd9\u662f\u5206\u6790\u590d\u6742\u5ea6\u7528\u7684\u3002\n\n---\n\n**1. \u5206\u6790\u4e00\u6b21\u8be2\u95ee**\n\n\u5bf9\u4e8e\u4e00\u6b21\u8be2\u95ee $l_j, r_j, c_j, d_j$\uff0c\u8003\u8651\u628a $i$ \u5206\u4e3a $b_i > d_j$ \u548c $b_i\\leq d_j$ \u4e24\u7c7b\uff0c\u5206\u522b\u7edf\u8ba1\u7b54\u6848\u3002\n\n**1.1. b[i] > d[j] \u7684 i**\n\n\u5bf9\u4e8e $b_i > d_j$ \u7684 $i$\uff0c\u7b54\u6848\u662f $\\sum_{i} [a_i \\operatorname{xor} c_j\\leq d_j]$\u3002\u6b64\u65f6\u7684\u7279\u70b9\u662f\uff1a\u7b54\u6848\u4e0e $b_i$ \u65e0\u5173\u3002\u8003\u8651\u628a\u8fd9\u4e9b $a_i$ \u63d2\u5165\u5230\u4e00\u4e2a $\\text{01 trie}$ \u4e2d\uff1a\u4e5f\u5c31\u662f\u6309\u4e8c\u8fdb\u5236\u4ece\u9ad8\u4f4d\u5230\u4f4e\u4f4d\u7684\u987a\u5e8f\uff0c\u628a $a_i$ \u5f53\u6210\u4e00\u4e2a $01$ \u4e32\u3002\u6211\u4eec\u5728 $\\text{01 trie}$ \u4e0a\u4ece\u6839\u5f80\u4e0b\u8d70\uff08\u4e5f\u5c31\u662f\u6309\u4e8c\u8fdb\u5236\u4ece\u9ad8\u4f4d\u5411\u4f4e\u4f4d\u8d70\uff09\uff0c\u5bf9\u4e8e\u5f53\u524d\u8282\u70b9\uff0c\u5047\u8bbe\u5b83\u6df1\u5ea6\u4e3a $h$\uff0c\u90a3\u4e48\u5b83\u4ee3\u8868\u7684\u503c\u7b49\u4e8e $c_j\\operatorname{xor}d_j$ \u7684\u524d $h$ \u9ad8\u4f4d\u3002\u8003\u8651\u4e0b\u4e00\u4f4d\uff1a\n\n- \u5982\u679c $d_j$ \u7684\u4e0b\u4e00\u4f4d\u4e3a $0$\uff0c\u90a3\u4e48\u8bf4\u660e $a_i$ \u7684\u4e0b\u4e00\u4f4d\u5fc5\u987b\u548c $c_j$ \u7684\u4e0b\u4e00\u4f4d\u76f8\u7b49\uff08\u5426\u5219 $a_i \\operatorname{xor} c_j > d_j$\uff0c\u4e0d\u6ee1\u8db3\u8981\u6c42\uff09\uff0c\u6211\u4eec\u76f4\u63a5\u5411\u8fd9\u4e2a\u65b9\u5411\u8d70\u5373\u53ef\u3002\n- \u5982\u679c $d_j$ \u7684\u4e0b\u4e00\u4f4d\u4e3a $1$\uff0c\u90a3\u4e48\u6709\u4e24\u79cd\u53ef\u80fd\uff1a\n  - \u5982\u679c $a_i$ \u7684\u4e0b\u4e00\u4f4d\u548c $c_j$ \u7684\u4e0b\u4e00\u4f4d\u76f8\u7b49\uff0c\u90a3\u4e48\u65e0\u8bba $a_i$ \u540e\u9762\u66f4\u4f4e\u7684\u4f4d\u4e0a\u586b\u4ec0\u4e48\uff0c\u90fd\u4e00\u5b9a\u6ee1\u8db3\uff1a$a_i\\operatorname{xor} c_j < d_j$\u3002\u6240\u4ee5 $a_i$ \u540e\u9762\u7684\u4f4d\u53ef\u4ee5\u4efb\u610f\u586b\uff0c\u65b9\u6848\u6570\u5c31\u662f\u8fd9\u4e00\u6574\u68f5\u5b50\u6811\u91cc $a_i$ \u7684\u4e2a\u6570\u4e4b\u548c\u3002\n  - \u5982\u679c $a_i$ \u7684\u4e0b\u4e00\u4f4d\u548c $c_j$ \u7684\u4e0b\u4e00\u4f4d\u4e0d\u76f8\u7b49\uff0c\u90a3\u4e48\u6b64\u65f6 $a_i$ \u4ecd\u7136\u662f\u7b49\u4e8e $c_j \\operatorname{xor} d_j$ \u7684\u3002\u6211\u4eec\u5411\u8fd9\u4e2a\u65b9\u5411\u8d70\u8fc7\u53bb\uff0c\u7136\u540e\u8003\u8651\u66f4\u4f4e\u7684\u4f4d\u5373\u53ef\u3002\n\n**1.2. b[i] <= d[j] \u7684 i**\n\n\u5bf9\u4e8e $b_i \\leq d_j$ \u7684 $i$\uff0c\u7b54\u6848\u662f $\\sum_{i} [a_i \\operatorname{xor} c_j\\leq b_i]$\u3002\u770b\u5230\u9650\u5236\u91cc\u65e2\u6709 $a_i$\uff0c\u53c8\u6709 $b_i$\uff0c\u6211\u4eec\u96be\u4ee5\u628a\u5b83\u4eec\u653e\u5230\u540c\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u91cc\u53bb\uff0c\u6240\u4ee5\u5f88\u96be\u5b9e\u73b0\u67e5\u8be2\u3002\u6362\u4e2a\u89d2\u5ea6\u8003\u8651\uff1a\u89c2\u5bdf $a_i\\operatorname{xor} c_j \\leq \\min\\{b_i, d_j\\}$ \u8fd9\u4e2a\u5f0f\u5b50\uff0c\u4f60\u4f1a\u53d1\u73b0 $(a, b)$ \u548c $(c, d)$ \u662f**\u5bf9\u79f0**\u7684\u3002\u90a3\u4e48\uff0c\u628a\u4fee\u6539\u5f53\u6210\u8be2\u95ee\u505a\uff0c\u8be2\u95ee\u5f53\u6210\u4fee\u6539\u505a\uff0c\u662f\u4e0d\u662f\u5c31\u548c 1.1. \u7684\u60c5\u51b5\u4e00\u6837\u4e86\u5462\uff1f\n\n\u5177\u4f53\u6765\u8bf4\uff0c\u6211\u4eec\u5c06\u8be2\u95ee\u79bb\u7ebf\uff0c\u628a\u6240\u6709 $c_j$\uff0c\u6309\u4e0a\u8ff0\u65b9\u6cd5\uff08\u548c\u4e0a\u9762\u7684 $a_i$ \u4e00\u6837\uff09\u63d2\u5165\u4e00\u4e2a $\\text{01 trie}$ \u4e2d\u3002\u7136\u540e\u5bf9\u6bcf\u7ec4 $(a_i, b_i)$\uff0c\u628a\u5b83\u5f53\u6210\u4e0a\u9762\u7684 $(c_j, d_j)$\uff0c\u5728 $\\text{01 trie}$ \u4e0a\u201c\u67e5\u8be2\u201d\u3002\u5f53\u7136\uff0c\u6211\u4eec\u5176\u5b9e\u4e0d\u662f\u8981\u67e5\u8be2\u4e00\u4e2a\u7ed3\u679c\uff0c\u800c\u662f\u8981\u628a\u5b83\u201c\u8d21\u732e\u201d\u5230\u7b26\u5408\u6761\u4ef6\u7684 $c_j$ \u91cc\u3002\u5728 1.1, \u91cc\uff0c\u6211\u4eec\u9047\u5230\u4e00\u6574\u68f5\u7b26\u5408\u6761\u4ef6\u7684\u5b50\u6811\uff0c\u5c31\u628a\u8fd9\u4e2a\u5b50\u6811\u91cc $a_i$ \u7684\u6570\u91cf\u52a0\u5165\u7b54\u6848\u4e2d\uff1b\u800c\u73b0\u5728\uff0c\u6211\u4eec\u9047\u5230\u4e00\u6574\u68f5\u7b26\u5408\u6761\u4ef6\u7684\u5b50\u6811\uff0c\u5c31\u5728\u8be5\u8282\u70b9\u5904\u6253\u4e00\u4e2a\u6807\u8bb0\uff0c\u8868\u793a\u4ee4\u5b50\u6811\u91cc\u6240\u6709 $c_j$ \u7684\u7b54\u6848\u52a0\u4e0a $1$\u3002\u6700\u540e\uff0c\u6bcf\u4e2a $j$ \u7684\u7b54\u6848\uff0c\u5c31\u662f $c_j$ \u5230\u6839\u8def\u5f84\u4e0a\u7684\u6807\u8bb0\u4e4b\u548c\u3002\n\n---\n\n**2. \u591a\u6b21\u8be2\u95ee\u65f6**\n\n\u5f53\u7136\u6211\u4eec\u4e0d\u53ef\u80fd\u6bcf\u6b21\u8be2\u95ee\u90fd\u91cd\u65b0\u5efa\u4e24\u4e2a $\\text{trie}$\uff0c\u90a3\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O}(qn\\log m)$\uff0c\u8fd8\u4e0d\u5982\u66b4\u529b\u3002\n\n\u8003\u8651\u4e00\u4e2a\u7b80\u5316\u7684\u95ee\u9898\uff1a\u5982\u679c\u53ea\u6709 $b_i > d_j$ \u7684 $i$\uff08\u4e5f\u5c31\u662f\u6d4b\u8bd5\u70b9 $5\\sim 7$\uff09\uff0c\u90a3\u4e48\u53ef\u4ee5\u5728\u6240\u6709\u8be2\u95ee\u5f00\u59cb\u524d\uff0c\u5148\u5efa\u597d\u4e00\u4e2a\u53ef\u6301\u4e45\u5316 $\\text{trie}$\u3002\u5219\u67e5\u8be2\u65f6\uff0c\u5c06 $r_j$ \u548c $l_j - 1$ \u4e24\u4e2a\u65f6\u523b\u7684 $\\text{trie}$ \u4e0a\u67e5\u8be2\u7684\u7ed3\u679c\u76f8\u51cf\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(q\\log m)$\u3002\n\n\u8003\u8651\u53e6\u4e00\u4e2a\u7b80\u5316\u7684\u95ee\u9898\uff1a\u5982\u679c\u53ea\u6709 $b_i \\leq d_j$ \u7684 $i$\uff08\u4e5f\u5c31\u662f\u6d4b\u8bd5\u70b9 $8\\sim 11$\uff09\uff0c\u90a3\u4e48\u53ef\u4ee5\u5148\u5c06\u8be2\u95ee\u79bb\u7ebf\uff0c\u5efa\u51fa\u6240\u6709 $c_j$ \u7684 $\\text{trie}$\u3002\u7136\u540e\u5c06\u8be2\u95ee\u62c6\u6210\u4e24\u4e2a\uff1a$[1, r_j]$ \u548c $[1, l_j - 1]$\uff08\u76f8\u51cf\u5f97\u5230\u7b54\u6848\uff09\u3002\u73b0\u5728\u6240\u6709\u8be2\u95ee\u7684\u5de6\u7aef\u70b9\u90fd\u662f $1$\u3002\u5c06\u8be2\u95ee\u6309\u53f3\u7aef\u70b9\u6392\u5e8f\uff0c\u4ece\u5c0f\u5230\u5927\u626b\u63cf\u3002\u6bcf\u6b21\u52a0\u5165\u5f53\u524d\u7684 $i$\uff08\u5982\u524d\u6587\u6240\u8ff0\uff0c\u8fd9\u4e2a\u52a0\u5165\u64cd\u4f5c\u6709\u70b9\u50cf 1.1. \u91cc\u7684\u67e5\u8be2\u64cd\u4f5c\uff0c\u53ea\u4e0d\u8fc7\u628a\u67e5\u8be2\u53d8\u6210\u4e86\u6253\u6807\u8bb0\uff09\uff0c\u7136\u540e\u5bf9\u53f3\u7aef\u70b9\u4e3a $i$ \u7684\u8be2\u95ee\u7edf\u8ba1\u7b54\u6848\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(q\\log m)$\u3002\n\n\u4e0a\u8ff0\u4e24\u79cd\u60c5\u51b5\u6211\u4eec\u90fd\u4f1a\u505a\u4e86\uff0c\u90a3\u4e48\u73b0\u5728\u552f\u4e00\u7684\u95ee\u9898\u662f\uff0c\u600e\u4e48\u628a $b_i > d_j$ \u7684 $i$ \u548c $b_i\\leq d_j$ \u7684 $i$ **\u5206\u79bb\u51fa\u6765**\u3002\u8003\u8651\u628a\u6240\u6709 $b_i, d_j$ \u653e\u5728\u4e00\u8d77\u6392\u5e8f\uff08\u7279\u522b\u5730\uff0c$b_i, d_j$ \u60f3\u5230\u65f6\uff0c$b_i$ \u653e\u5728\u524d\uff09\u3002\u7136\u540e\u505a $\\text{cdq}$ \u5206\u6cbb\u3002\u90a3\u4e48\u6bcf\u6b21\u53ea\u9700\u8981\u8003\u8651\u53f3\u534a\u8fb9\u5bf9\u5de6\u534a\u8fb9\u7684\u8d21\u732e\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u53d6\u51fa\u53f3\u534a\u8fb9\u7684\u6240\u6709 $a_i$\uff0c\u5de6\u534a\u8fb9\u7684\u6240\u6709 $(c_j,d_j)$\uff0c\u6309\u60c5\u51b5 1.1. \u7684\u65b9\u6cd5\u505a\u4e00\u6b21\uff1b\u518d\u53d6\u51fa\u53f3\u534a\u8fb9\u7684\u6240\u6709 $c_j$\uff0c\u5de6\u534a\u8fb9\u7684\u6240\u6709 $(a_i,b_i)$\uff0c\u6309\u60c5\u51b5 1.2. \u7684\u65b9\u6cd5\u505a\u4e00\u6b21\u3002\u5c31\u6c42\u51fa\u6240\u6709\u7b54\u6848\u4e86\u3002\n\n\u6bcf\u5c42\u5206\u6cbb\u65f6\uff0c\u505a\u95ee\u9898 1.1. \u548c 1.2.\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O}(\\mathrm{len}\\log m)$\uff08$\\mathrm{len}$ \u662f\u5f53\u524d\u5206\u6cbb\u533a\u95f4\u7684\u957f\u5ea6\uff09\uff0c\u6240\u4ee5\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}((n + q)\\cdot \\log (n + q)\\cdot  \\log m)$\u3002\n\n## \u53c2\u8003\u4ee3\u7801\n\n[\u52c7\u6562\u5411\u524d\u8fdb\uff0c\u524d\u8fdb\u6709\u5956\u54c1\uff01\uff01\uff01\uff01](https://www.cnblogs.com/dysyn1314/p/14585866.html)",
        "postTime": 1616827776,
        "uid": 100674,
        "name": "duyi",
        "ccfLevel": 8,
        "title": "fuck"
    },
    {
        "content": "\u9996\u5148\u6839\u636e\u5957\u8def\uff0c\u5c06\u8be2\u95ee\u5dee\u5206\u4e3a $[1,r_i]-[1,l_i-1]$\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u5c9b\u5c7f $(a,b)$,\u6ee1\u8db3 $a\\oplus c\\leq b$ \u7684 $c$ \u5f62\u5982 $\\log$ \u4e2a\u533a\u95f4\uff0c\u6bcf\u4e2a\u533a\u95f4\u90fd\u662f\u4ece\u9ad8\u4f4d\u5230\u4f4e\u4f4d\u6709\u4e00\u4e2a\u524d\u7f00 $01$ \u53d6\u503c\u56fa\u5b9a\uff0c\u5269\u4e0b\u7684\u968f\u4fbf\u53d6\u3002\u5bb9\u6613\u53d1\u73b0\u8fd9\u4e9b\u533a\u95f4\u6bcf\u4e2a\u53ea\u5bf9\u5e94 $[0,2^{24}-1]$ \u7684\u7ebf\u6bb5\u6811\u4e0a\u7684\u4e00\u4e2a\u533a\u95f4\u3002\n\n\u5c06\u5c9b\u5c7f $(a,b)$ \u63d2\u5165\u5bf9\u5e94\u7684 $\\log$ \u4e2a\u533a\u95f4\uff0c\u8be2\u95ee $(c,d)$ \u63d2\u5165\u6240\u6709\u5305\u542b $c$ \u7684\u533a\u95f4\uff0c\u5e76\u6309\u7f16\u53f7\u6392\u5e8f\u3002\n\n\u73b0\u5728\u95ee\u9898\u8f6c\u5316\u4e3a\u6bcf\u6b21\u63d2\u5165\u4e00\u4e2a $a$\uff0c\u6216\u8005\u67e5\u8be2\u6709\u591a\u5c11\u4e2a $a$ \u6ee1\u8db3 $a\\oplus c\\leq d$\u3002\u5efa $01 trie$ \u5e76\u7ef4\u62a4\u5b50\u6811 $size$\uff0c$trie$ \u4e0a\u4e8c\u5206\u5373\u53ef\u3002\n\n\u5b9e\u73b0\u65f6\u53ef\u4ee5\u5c06\u8be2\u95ee\u79bb\u7ebf\u63d2\u5165\u5bf9\u5e94\u533a\u95f4\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5efa\u51fa\u7ebf\u6bb5\u6811\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2 w)$,\u7a7a\u95f4 $O(n\\log w)$\u3002\n\n\u6ce8\u610f $01trie$ \u7a7a\u95f4\u662f $O(n\\log w)$ \u800c\u4e0d\u662f $O(n)$\uff01\u8003\u573a\u4ee3\u7801\u6570\u7ec4\u5f00\u5c0f\u6302\u4e86\u3002\n\n\u8fd8\u6709\u8fd9\u9898\u65f6\u95f4\u548c\u7a7a\u95f4\u90fd\u5f88\u5361\uff0c\u9700\u8981\u7cbe\u7ec6\u5b9e\u73b0\uff08\u6bd4\u5982\u7528\u90bb\u63a5\u8868\u4ee3\u66ff vector\uff09\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int M=75e5+3,N=25e5+3,O=1e5+3;\nint he[33554499],ne[M],to[M],t,a[O],b[O],c[O],d[O],u,w,ans[O],ct,ch[N][2],sz[N]; \nvector<int>v[O];\nvoid add(int x,int y){ne[++t]=he[x],to[t]=y,he[x]=t;}\nvoid work(int k,int l,int r){\n\tadd(k,u);\n\tif(l==r)return;\n\tint m=l+r>>1;\n\tw>m?work(k*2+1,m+1,r):work(k*2,l,m);\n}\nint qry(int c,int d){\n\tbool o;\n\tint i=1<<23,x=1,r=0;\n\tfor(;i&&x;i>>=1){\n\t\tif(d&i){\n\t\t\to=c&i,r+=sz[ch[x][o]],x=ch[x][!o];\n\t\t}else{\n\t\t\to=c&i,x=ch[x][o];\n\t\t}\n\t}\n\treturn r+sz[x];\n}\nvoid upd(int a){\n\tbool o;\n\tint i=1<<23,x=1;\n\tfor(;i;i>>=1){\n\t\tif(o=a&i,!ch[x][o])ch[x][o]=++ct,sz[ct]=ch[ct][0]=ch[ct][1]=0;\n\t\tx=ch[x][o],++sz[x];\n\t}\n}\nint main(){\n\tint n,q,i,j,k,l;\n\tscanf(\"%d%d\",&n,&q);\n\tfor(i=1;i<=n;++i)scanf(\"%d%d\",a+i,b+i);\n\tfor(i=1;i<=q;++i){\n\t\tscanf(\"%d%d%d%d\",&j,&k,c+i,d+i);\n\t\tv[j-1].push_back(-i),v[k].push_back(i); \n\t}\n\tfor(i=n;i;--i){\n\t\tl=v[i].size();\n\t\tfor(j=0;j<l;++j){\n\t\t\tu=v[i][j],w=c[abs(u)];\n\t\t\twork(1,0,(1<<24)-1);\n\t\t}\n\t\tk=1;\n\t\tfor(j=1<<23;j;j>>=1){\n\t\t\tk*=2;\n\t\t\tif(j&a[i])k^=1;\n\t\t\tif(j&b[i]){\n\t\t\t\tadd(k,i+q);\n\t\t\t\tk^=1;\n\t\t\t}\n\t\t}\n\t\tadd(k,i+q);\n\t}\n\tfor(i=(1<<25)-1;~i;--i)if(k=he[i]){\n\t\tct=1,ch[1][0]=ch[1][1]=sz[1]=0;\n\t\tfor(;k;k=ne[k]){\n\t\t\tl=to[k];\n\t\t\tif(l<0)ans[-l]-=qry(c[-l],d[-l]);\n\t\t\telse if(l<=q){\n\t\t\t\tans[l]+=qry(c[l],d[l]);\n\t\t\t}\n\t\t\telse upd(a[l-q]);\n\t\t}\n\t}\n\tfor(i=1;i<=q;++i)printf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```\n",
        "postTime": 1616827483,
        "uid": 221955,
        "name": "panyf",
        "ccfLevel": 10,
        "title": "P7470 [NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669\uff0801trie  + \u5206\u6cbb\uff09"
    },
    {
        "content": "> \u7ed9\u4e24\u4e2a\u957f $n$ \u7684\u6570\u5217 $a,b$\uff0c$q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u7ed9\u51fa $l_i,r_i,c_i,d_i$\uff0c\u6c42\u6709\u591a\u5c11\u4e2a $j$ \u6ee1\u8db3 $l_i\\le j\\le r_i$ \u4e14 $(a_j\\oplus c_i)\\le\\min(b_j,d_i)$\u3002\n> \n> $1\\le n,q\\le10^5$\uff0c$1\\le l_i\\le r_i\\le n$\uff0c$1\\le a_i,b_i,c_i,d_i<2^{24}$\u3002\n\n**\u8fd9\u662f\u4e00\u7bc7\u6307\u4ee4\u96c6\u9898\u89e3\uff0c\u4e0d\u662f\u6b63\u89e3\u3002\u5982\u679c\u60f3\u8981\u77e5\u9053\u6b63\u89e3\u8bf7\u79fb\u6b65\u5176\u4ed6\u9898\u89e3\u3002\u53e6\u5916\uff0c\u4e0d\u8981\u5c1d\u8bd5\u5728\u6b63\u5f0f OI \u7ade\u8d5b\u4e2d\u4f7f\u7528\u6307\u4ee4\u96c6\u3002**\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a\u5e8f\u5217\u4e0a\u95ee\u9898\uff0c\u5e76\u4e14 $O\\left(nq\\right)$ \u66b4\u529b\u975e\u5e38\u597d\u5199\uff0c\u4e8e\u662f\u6211\u4eec\u8003\u8651\u6307\u4ee4\u96c6\u3002\n\n\u6211\u4eec\u9700\u8981\u80fd\u591f\u540c\u65f6\u5bf9\u591a\u4e2a\u6570\u5224\u65ad $(a\\oplus c)\\le\\min(b,d)$\uff0c\u8fd9\u7b49\u4ef7\u4e8e $(a\\oplus c)\\le b$ \u4e14  $(a\\oplus c)\\le d$\u3002\u7531\u4e8e $\\oplus$\uff0c$\\le$ \u4e0e $\\&$ \u90fd\u662f\u6307\u4ee4\u96c6\u57fa\u672c\u8fd0\u7b97\uff0c\u6240\u4ee5\u6211\u4eec\u5df2\u7ecf\u505a\u5b8c\u4e86\u3002\n\n\u987a\u4fbf\u501f\u6b64\u63a8\u5e7f\u4e00\u4e0b\u4e00\u79cd\uff08\u53ef\u80fd\uff09\u66f4\u597d\u5199\u66f4\u597d\u8bb0\u7684\u5199\u6cd5\uff0c\u5177\u4f53\u53ef\u89c1\u4ee3\u7801\u3002\u9700\u6ce8\u610f\u5e03\u5c14\u771f\u503c\u4e3a\u4e8c\u8fdb\u5236\u5168\u4e00\u3002\n\n```cpp\n#pragma GCC target(\"sse\", \"avx2\")\n\n#include <cstdio>\n#include <algorithm>\n\nchar ibuf[1 << 20], obuf[1 << 20];\nconst char *sp, *ep;\nchar *op = obuf;\n\n#define gc() (sp == ep && (ep = (sp = ibuf) + fread(ibuf, 1, sizeof ibuf, stdin)), *sp++)\n#define flush() (fwrite(obuf, 1, op - obuf, stdout), op = obuf)\n#define pc(c) (op == obuf + sizeof obuf && flush(), *op++ = (c))\n\nint read() {\n  static int c, x;\n  while ((c = gc()) < 48) {}\n  x = c & 15;\n  while ((c = gc()) >= 48) x = x * 10 + (c & 15);\n  return x;\n}\nvoid write(const int &x) {\n  if (x >= 10) write(x / 10);\n  pc((x % 10) | 48);\n}\n\ntypedef unsigned u256 __attribute((vector_size(32)));\n\nconst int N = 100000 >> 3;\n\nu256 ans, cs, ds, tp;\nu256 a[N], b[N];\n\nint main() {\n  const int n = read();\n  int q = read();\n  for (int i = 0; i < n; ++i) {\n    a[i >> 3][i & 7] = read();\n    b[i >> 3][i & 7] = read();\n  }\n  while (q--) {\n    const int l = read() - 1, r = read() - 1;\n    const unsigned c = read(), d = read();\n    cs = u256{ c, c, c, c, c, c, c, c };\n    ds = u256{ d, d, d, d, d, d, d, d };\n    ans = u256{ 0, 0, 0, 0, 0, 0, 0, 0 };\n    int res = 0;\n    if ((l >> 3) == (r >> 3)) {\n      for (int i = l & 7; i <= (r & 7); ++i) {\n        res += (a[l >> 3][i] ^ c) <= std::min(b[l >> 3][i], d);\n      }\n    } else {\n      for (int i = l & 7; i <= 7; ++i) {\n        res += (a[l >> 3][i] ^ c) <= std::min(b[l >> 3][i], d);\n      }\n      for (int i = 0; i <= (r & 7); ++i) {\n        res += (a[r >> 3][i] ^ c) <= std::min(b[r >> 3][i], d);\n      }\n      for (int i = (l >> 3) + 1; i != (r >> 3); ++i) {\n        tp = a[i] ^ cs;\n        ans += (tp <= b[i]) & (tp <= ds);\n      }\n      for (int i = 0; i <= 7; ++i) res -= ans[i];\n    }\n    write(res);\n    pc(10);\n  }\n  flush();\n  return 0;\n}\n\n```",
        "postTime": 1616824443,
        "uid": 55251,
        "name": "Daniel13265",
        "ccfLevel": 10,
        "title": "\u9898\u89e3\u3010[NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669\u3011"
    },
    {
        "content": "\u672c\u7bc7\u9898\u89e3\u6709\u4e0d\u4e00\u6837\u7684\u5206\u6cbb\u505a\u6cd5\u3002\n\n### \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a $n$ \u4e2a\u6570\u5bf9 $a_i,b_i$ \uff0c $q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u7ed9\u5b9a $l,r,c,d$ \uff0c\u8be2\u95ee\u533a\u95f4 $[l,r]$ \u5185\u6ee1\u8db3 $a_i\\oplus c\\le \\min\\{b_i,d\\}$ \u7684 $i$ \u7684\u4e2a\u6570\u3002\n\n$1\\le n,q\\le 10^5,1\\le a_i,b_i,c,d\\le 2^{24}-1$\n\n### \u89e3\u9898\u601d\u8def\n\n\u9996\u5148\u8003\u8651 $l=1,r=n$ \u65f6\u7684\u505a\u6cd5\u3002\n\n\u5c06\u6570\u5bf9\u6309 $b_i$ \u5347\u5e8f\u6392\u5e8f\uff0c\u8be2\u95ee\u6309 $d$ \u5347\u5e8f\u6392\u5e8f\u3002\u53ef\u4ee5\u5c06\u6570\u5bf9\u5212\u5206\u4e3a\u4e24\u4e2a\u96c6\u5408\uff0c\u5373 $\\min\\{b_i,d\\}=d$ \u7684\u96c6\u5408 $A$ \u548c $\\min\\{b_i,d\\}=b_i$ \u7684\u96c6\u5408 $B$ \u3002\u4f9d\u6b21\u8003\u8651\u6bcf\u4e00\u4e2a\u8be2\u95ee\uff0c\u6bcf\u6b21\u4f1a\u6709\u4e00\u4e9b\u6570\u5bf9\u4ece\u96c6\u5408 $A$ \u88ab\u5212\u5206\u5230\u96c6\u5408 $B$ \u3002\u53ea\u9700\u5bf9 $A,B$ \u5206\u522b\u8ba1\u6570\u5e76\u6c42\u548c\u5373\u53ef\u3002\n\n\u8003\u8651\u96c6\u5408 $A$ \u7684\u505a\u6cd5\u3002\u5373\u67e5\u8be2 $c,d$ \uff0c\u6c42 $a_i\\oplus c\\le d$ \u7684\u6570\u5bf9\u4e2a\u6570\u3002\u5c06 $a_i$ \u63d2\u5165 01-Trie \uff0c\u67e5\u8be2\u5f02\u6216 $c$ \u5c0f\u4e8e\u7b49\u4e8e $d$ \u7684\u5b50\u6811\u5927\u5c0f\u5373\u53ef\u3002\n\n\u8003\u8651\u96c6\u5408 $B$ \u7684\u505a\u6cd5\u3002\u5373\u67e5\u8be2 $c$ \uff0c\u6c42 $a_i\\oplus c\\le b_i$ \u7684\u6570\u5bf9\u4e2a\u6570\u3002\u5c06 $\\oplus a_i\\le b_i$ \u7684\u5b50\u6811\u5927\u5c0f $+1$ \uff0c\u67e5\u8be2\u65f6\u6c42 $c$ \u5904\u7684\u5927\u5c0f\u5373\u53ef\u3002\n\n\u73b0\u5728\u6211\u4eec\u5728 $O(n\\log a_i)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u89e3\u51b3\u4e86 $l=1,r=n$ \u65f6\u7684\u95ee\u9898\u3002\u5957\u7528\u4e00\u5c42\u5206\u6cbb\u7b97\u6cd5\uff0c\u5c31\u53ef\u4ee5\u89e3\u51b3 $l,r$ \u4efb\u610f\u65f6\u7684\u95ee\u9898\u3002\u672c\u7bc7\u9898\u89e3\u7528\u7684\u662f\u7c7b\u4f3c\u4e8e\u7ebf\u6bb5\u6811\u5206\u6cbb\u7684\u505a\u6cd5\uff0c\u8fd9\u4e5f\u662f\u672c\u7bc7\u9898\u89e3\u548c\u5176\u4ed6\u9898\u89e3\u4e0d\u540c\u4e4b\u5904\u3002\n\n\u89c2\u5bdf\u5230\u5c06\u8be2\u95ee\u533a\u95f4\u62c6\u5206\u6210\u82e5\u5e72\u533a\u95f4\u518d\u5bf9\u8be2\u95ee\u7b54\u6848\u6c42\u548c\uff0c\u7b54\u6848\u4e0d\u53d8\u3002\u5c06\u6bcf\u4e2a\u8be2\u95ee\u533a\u95f4\u90fd **\u62c6\u5206\u6210\u7ebf\u6bb5\u6811\u4e0a\u7684\u533a\u95f4** \u3002\u8fd9\u6837\u6700\u591a\u62c6\u5206\u6210 $O(n\\log n)$ \u4e2a\u533a\u95f4\uff0c\u5bf9\u6bcf\u4e2a\u7ebf\u6bb5\u6811\u4e0a\u533a\u95f4\u5206\u522b\u5411\u4e4b\u524d\u90a3\u6837\u6c42\u89e3\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n\\log a_i)$ \uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(n\\log a_i)$ \u3002\n\n### \u53c2\u8003\u4ee3\u7801\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#include<vector>\nusing namespace std;\nconst int maxn=100010;\ntypedef long long ll;\nint n,q,l,r,ans[maxn],id[maxn];\nll a[maxn],b[maxn],c[maxn],d[maxn];\n#define lc (o<<1)\n#define rc (o<<1|1)\nvector<int>g[maxn*4];\nbool cmp(int x,int y){return d[x]<d[y];}\nbool ccc(int x,int y){return b[x]<b[y];}\nvoid update(int o,int l,int r,int ql,int qr,int v)\n{\n\tif(r<ql||l>qr)return;\n\tif(ql<=l&&r<=qr){g[o].push_back(v);return;}\n\tint mid=(l+r)>>1;\n\tupdate(lc,l,mid,ql,qr,v);update(rc,mid+1,r,ql,qr,v);\n}\nstruct Trie\n{\n\tint cnt,rt,ch[maxn*40][2],siz[maxn*40];\n\tvoid clear()\n\t{\n\t\tfor(int i=1;i<=cnt;i++)ch[i][0]=ch[i][1]=siz[i]=0;\n\t\tcnt=rt=1;\n\t}\n\tvoid insert1(int x,ll v)\n\t{\n\t\tint nww=rt;siz[nww]+=v;\n\t\tfor(int i=24;i>=0;i--)\n\t\t{\n\t\t\tint c=((x>>i)&1ll);\n\t\t\tif(!ch[nww][c])ch[nww][c]=++cnt;\n\t\t\tnww=ch[nww][c];siz[nww]+=v;\n\t\t}\n\t}\n\tint query1(int x,ll d,ll c,int k)//min(b,d)=d\n\t{\n\t\tif(!x)return 0;\n\t\tif(k==-1)return siz[x];\n\t\tint dc=((d>>k)&1ll),cc=((c>>k)&1ll);\n\t\tif(dc==0)return query1(ch[x][cc],d,c,k-1);\n\t\telse return siz[ch[x][cc]]+query1(ch[x][cc^1],d,c,k-1);\n\t}\n\tvoid insert2(int x,ll a,ll b,int k)//min(b,d)=b\n\t{\n\t\tif(!x)return;\n\t\tif(k!=-1){if(!ch[x][0])ch[x][0]=++cnt;if(!ch[x][1])ch[x][1]=++cnt;}\n\t\telse {siz[x]++;return;}\n\t\tint ac=((a>>k)&1ll),bc=((b>>k)&1ll);\n\t\tif(bc==0)insert2(ch[x][ac],a,b,k-1);\n\t\telse siz[ch[x][ac]]++,insert2(ch[x][ac^1],a,b,k-1);\n\t}\n\tint query2(int x,ll d,int k)\n\t{\n\t\tif(!x)return 0;\n\t\tif(k==-1)return siz[x];\n\t\tint dc=((d>>k)&1ll);\n\t\treturn siz[x]+query2(ch[x][dc],d,k-1);\n\t}\n}A,B;//A:min(b,d)=d,B:min(b,d)=b\nvoid solve(int o,int l,int r)\n{\n\tsort(g[o].begin(),g[o].end(),cmp);\n\tfor(int i=l;i<=r;i++)id[i]=i;sort(id+l,id+r+1,ccc);\n\tA.clear();B.clear();\n\tfor(int i=l;i<=r;i++)A.insert1(a[id[i]],1);\n\tint cur=l;\n\tfor(int i=0;i<g[o].size();i++)\n\t{\n\t\tfor(;d[g[o][i]]>=b[id[cur]]&&cur<=r;cur++)A.insert1(a[id[cur]],-1),B.insert2(1,a[id[cur]],b[id[cur]],24);\n\t\tans[g[o][i]]+=A.query1(1,d[g[o][i]],c[g[o][i]],24)+B.query2(1,c[g[o][i]],24);//;,printf(\"A %d B %d\\n\",A.query1(1,d[g[o][i]],c[g[o][i]],24),B.query2(1,c[g[o][i]],24));\n\t}\n\tif(l==r)return;\n\tint mid=(l+r)>>1;\n\tsolve(lc,l,mid);solve(rc,mid+1,r);\n}\nsigned main()\n{\n\tscanf(\"%d%d\",&n,&q);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld%lld\",a+i,b+i);\n\tfor(int i=1;i<=q;i++)\n\t{\n\t\tscanf(\"%d%d%lld%lld\",&l,&r,c+i,d+i);\n\t\tupdate(1,1,n,l,r,i);\n\t}\n\tsolve(1,1,n);\n\tfor(int i=1;i<=q;i++)printf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```\n\n\u8fd0\u884c\u65f6\u95f4\u7684\u74f6\u9888\u4ecd\u7136\u5728\u6bcf\u6b21\u7684\u6392\u5e8f\u4e0a\u3002\u73b0\u5728\u6709\u4e00\u4e9b\u65b9\u6cd5\u53ef\u4ee5\u4f7f\u5bf9\u6bcf\u4e2a\u7ebf\u6bb5\u6811\u4e0a\u7ed3\u70b9\u6392\u5e8f\u7684\u603b\u590d\u6742\u5ea6\u964d\u4f4e\u4e3a $O(n\\log n)$ \u3002\u5e38\u6570\u66f4\u5c0f\u7684\u4ee3\u7801\u7a0d\u540e\u5949\u4e0a\u3002",
        "postTime": 1616891198,
        "uid": 43486,
        "name": "hsfzLZH1",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7470 \u3010[NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669\u3011"
    },
    {
        "content": "## \u9898\u610f\n\u6709\u4e24\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a,b$\uff0c\u7ed9\u51fa $q$ \u7ec4\u8be2\u95ee\uff0c\u6bcf\u7ec4\u8be2\u95ee\u6709 $l,r,c,d$\uff0c\u95ee\u5728 $i\\in[l,r]$ \u6709\u591a\u5c11\u6ee1\u8db3 $(a_i\\oplus c)\\le \\min(b_i,d)$\n## \u9898\u89e3\n\u66b4\u529b\u5f00 $\\rm O_2$ $80$ \u5206\u5c31\u5f88\u79bb\u8c31\u3002\n\n\u4e00\u4e2a\u4e00\u4e2a\u70b9\u5f80\u4e0b\u770b\u3002\n### $1\\sim 4$\n\u66b4\u529b\u968f\u4fbf\u8dd1\u597d\u5427\u3002\n\n\u5faa\u73af\u5c55\u5f00\u53c2\u89c1 `namespace solve1`\n### $5\\sim 7$ $\\max\\{d_i\\}\\leq \\min\\{b_i\\}$\n\u8fd9\u4e2a\u70b9 $(a_i\\oplus c)\\le \\min(b_i,d)$ \u4e8b\u5b9e\u4e0a\u5c31\u662f $(a_i\\oplus c)\\le d_i$\u3002\u8fd9\u4e2a $[l,r]$ \u660e\u663e\u53ef\u4ee5\u5dee\u5206\uff0c\u53d8\u6210 $[1,r]-[1,l-1]$\u3002\n\n\u4e8e\u662f\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u5bf9\u4e8e $[1,x]$ \u7684\u4e2a\u6570\uff0c\u90a3\u4e48\u5148\u5bf9 $[1,x]$ \u7684 $a_i$ \u5efa\u4e00\u68f5\u5b57\u6bcd\u6811\uff0c\u7136\u540e\u7ed9\u5b9a $c,d$ \u95ee\u6709\u591a\u5c11 $a_i$ \u53ef\u4ee5\u6ee1\u8db3\u4e0a\u5f0f\u3002\n\n\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n1. $d$ \u8fd9\u4e00\u4f4d\u4e3a $0$\uff0c\u90a3\u4e48\u53ea\u80fd\u8d70 $c$ \u8fd9\u4e00\u4f4d\u53d6\u53cd\u7684\u503c\uff0c\u8fd9\u4e00\u4f4d\u624d\u80fd\u6bd4 $d$ \u5c0f\uff1b\n1. $d$ \u8fd9\u4e00\u4f4d\u4e3a $1$\uff0c\u82e5\u8fd9\u4e00\u4f4d\u4e0e $c$ \u76f8\u540c\u5f97\u5230 $0$\uff0c\u5f80\u8fd9\u4e00\u8def\u8d70\u6240\u6709\u7684 $a$ \u90fd\u6ee1\u8db3\u6761\u4ef6\uff0c\u82e5\u4e0d\u76f8\u540c\u5219\u5f97\u5230 $1$\uff0c\u7ee7\u7eed\u5f80\u4e0b\u8d70\u3002\n\n\n\u90a3\u4e48\u5355\u6b21\u63d2\u5165\u590d\u6742\u5ea6 $O(24)$\uff0c\u5355\u6b21\u67e5\u8be2\u590d\u6742\u5ea6 $O(24)$\uff0c\u603b\u590d\u6742\u5ea6 $O(24n+24q)$\u3002\n\n$\\rm 01Tire$ \u7684\u5b9e\u73b0\u53c2\u89c1 `namespace T1`\uff0c\u5dee\u5206\u7684\u5b9e\u73b0\u53c2\u89c1 `namespace solve2`\n\n### $8\\sim 11$ $\\min\\{d_i\\}\\geq \\max\\{b_i\\}$\n\u8fd9\u4e2a\u4e5f\u633a\u5bb9\u6613\u6784\u9020\u7684\u3002\u3002\u3002\n\n\u7531\u4e8e\u7ea6\u675f\u6761\u4ef6\u53ea\u6709 $b_i$\uff0c\u8003\u8651\u5bf9 $a,b$ \u6784\u9020\u51fa\u53ef\u884c\u7684 $c$\uff0c\u6784\u9020\u65b9\u6cd5\u8fd8\u662f\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n1. $b$ \u8fd9\u4e00\u4f4d\u662f $0$\uff0c\u5219 $c$ \u8fd9\u4e00\u4f4d\u53ea\u80fd\u548c $a$ \u76f8\u53cd\u4e0d\u7136\u4e0d\u53ef\u80fd\u5c0f\u4e8e\u7b49\u4e8e $b$\uff1b\n1. $b$ \u8fd9\u4e00\u4f4d\u662f $1$\uff0c\u5219 $c$ \u8fd9\u4e00\u4f4d\u4e8e $a$ \u76f8\u7b49\u5219\u5fc5\u5c0f\u4e8e\uff0c\u6216\u8005\u4e0d\u76f8\u7b49\u5c31\u5904\u7406\u4e0b\u4e00\u4f4d\u3002\n\n\n$\\rm 01Tire$ \u7684\u5b9e\u73b0\u53c2\u89c1 `namespace T2`\uff0c\u5dee\u5206\u7684\u5b9e\u73b0\u53c2\u89c1 `namespace solve3`\n\n### $12\\sim13$ $l_i=1,r_i=n$\n\u8fd9\u4e2a\u5728\u8003\u573a\u4e0a\u4e5f\u5199\u51fa\u6765\u4e86\u3002\u5728\u8fd9\u6837\u7684\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a $(a_i,b_i)$ \u65e0\u5e8f\uff0c\u56e0\u6b64\u5bf9 $b_i$ \u6392\u5e8f\u5b8c\u5168\u6ca1\u6709\u5f71\u54cd\u3002\u90a3\u4e48\u628a\u8be2\u95ee $c,d$ \u770b\u505a\u662f\u4e24\u90e8\u5206\uff1a$b\\le d$ \u7684\u548c $b>d$ \u7684\u3002\u628a $d$ \u6392\u5e8f\uff0c\u7528 `T1` \u7684\u65b9\u6cd5\u5904\u7406 $b\\le d$\u3002\u53cd\u8fc7\u6765\u7528 `T2` \u5904\u7406 $b>d$\u3002\u5177\u4f53\u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003 `namespace solve4`\n\n\u590d\u6742\u5ea6 $O(n\\log n+24q)$\n\n### $14\\sim20$\n\u6ca1\u6709\u4efb\u4f55\u9650\u5236\uff0c\u53ef\u4ee5\u5f3a\u884c\u6539\u5230 $12\\sim13$\u3002\n\n\u5bf9\u5e8f\u5217\u5206\u5757,\u90a3\u4e48\u6574\u5757\u5c31\u662f $12\\sim13$ \u7684\u60c5\u51b5\uff0c\u96f6\u6563\u5757\u76f4\u63a5\u66b4\u529b\u5373\u53ef\u3002\u4e3a\u4e86\u901f\u5ea6\u5faa\u73af\u5c55\u5f00\u4e86\u4e00\u4e0b\u4e0b\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O\\left(q\\log q+\\dfrac nT(T\\log T+24q)\\right)$\uff0c\u5e94\u8be5\u662f $T=1800$ \u5de6\u53f3\u901f\u5ea6\u8fc7\u5f97\u53bb\u3002\n\n\u8fd9\u4efd\u83dc\u5f97\u79bb\u8c31\u4ee3\u7801\u4e0d\u5f00 $\\rm O_2$ \u4e5f\u662f\u7a33\u8fc7\u7684\u3002\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define min(a,b) (a<b?a:b)\n#define max(a,b) (a>b?a:b)\nconst int N=1e5+10;\n#define faster\nnamespace in{\n    #ifdef faster\n    char buf[1<<21],*p1=buf,*p2=buf;\n    inline int getc(){return p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++;}\n    #else\n    inline int getc(){return getchar();}\n    #endif\n    template <typename T>inline void read(T& t){\n        t=0;int f=0;char ch=getc();while (!isdigit(ch)){if(ch=='-')f = 1;ch=getc();}\n        while(isdigit(ch)){t=t*10+ch-48;ch = getc();}if(f)t=-t;\n    }\n    template <typename T,typename... Args> inline void read(T& t, Args&... args){read(t);read(args...);}\n}\nnamespace out{\n    char buffer[1<<21];int p1=-1;const int p2 = (1<<21)-1;\n    inline void flush(){fwrite(buffer,1,p1+1,stdout),p1=-1;}\n    inline void putc(const char &x) {if(p1==p2)flush();buffer[++p1]=x;}\n    template <typename T>void write(T x) {\n        static char buf[15];static int len=-1;if(x>=0){do{buf[++len]=x%10+48,x/=10;}while (x);}else{putc('-');do {buf[++len]=-(x%10)+48,x/=10;}while(x);}\n        while (len>=0)putc(buf[len]),--len;\n    }\n}\nint n,q,a[N],b[N],l[N],r[N],c[N],d[N],ans[N];\nnamespace solve1{\n\t//\u66b4\u529b+\u5faa\u73af\u5c55\u5f00\n\tvoid work(){\n\t\tfor(int kk=1;kk<=q;kk++){\n\t\t\tregister int ans1=0,ans2=0,ans3=0,ans4=0,ans5=0,ans6=0,ans7=0,ans8=0;\n\t\t\tregister int i=l[kk],R=r[kk],C=c[kk],D=d[kk];\n\t\t\tfor(;i+7<=R;i+=8)\n\t\t\t\tans1+=((a[i  ]^C)<=min(b[i  ],D)),\n\t\t\t\tans2+=((a[i+1]^C)<=min(b[i+1],D)),\n\t\t\t\tans3+=((a[i+2]^C)<=min(b[i+2],D)),\n\t\t\t\tans4+=((a[i+3]^C)<=min(b[i+3],D)),\n\t\t\t\tans5+=((a[i+4]^C)<=min(b[i+4],D)),\n\t\t\t\tans6+=((a[i+5]^C)<=min(b[i+5],D)),\n\t\t\t\tans7+=((a[i+6]^C)<=min(b[i+6],D)),\n\t\t\t\tans8+=((a[i+7]^C)<=min(b[i+7],D));\n\t\t\tfor(;i<=R;i++)\n\t\t\t\tans1+=((a[i]^C)<=min(b[i],D));  \n\t\t\tans[kk]=ans1+ans2+ans3+ans4+ans5+ans6+ans7+ans8;\n\t\t}\n\t}\n}\n\nconst int L=24;\nvoid pre(int x,int *tmp){int now=L-1;while(now>=0)tmp[now]=x&1,x>>=1,now--;}\nnamespace T1{\n\tint ch[N*24][2],sz[N*24];int tot=0;\n\tint newnode(){++tot;ch[tot][0]=ch[tot][1]=0;sz[tot]=0;return tot;}\n\tvoid insert(int*tmp){\n\t\tint now=0;\n\t\tfor(int i=0;i<L;i++){\n\t\t\tif(ch[now][tmp[i]]==0)ch[now][tmp[i]]=newnode();\n\t\t\tnow=ch[now][tmp[i]];sz[now]++;\n\t\t}\n\t}\n\tint qry(int*C,int*D){\n\t\t//\u6c42\u6709\u591a\u5c11 a^C<=D\n\t\tint now=0;int ans=0;\n\t\tfor(int i=0;i<L;i++){\n\t\t\tif(C[i]==0&&D[i]==0){\n\t\t\t\tif(!ch[now][0])return ans;\n\t\t\t\tnow=ch[now][0];\n\t\t\t}\n\t\t\tif(C[i]==1&&D[i]==0){\n\t\t\t\tif(!ch[now][1])return ans;\n\t\t\t\tnow=ch[now][1];\n\t\t\t}\n\t\t\tif(C[i]==0&&D[i]==1){\n\t\t\t\tans+=sz[ch[now][0]];\n\t\t\t\tif(!ch[now][1])return ans;\n\t\t\t\tnow=ch[now][1];\n\t\t\t}\n\t\t\tif(C[i]==1&&D[i]==1){\n\t\t\t\tans+=sz[ch[now][1]];\n\t\t\t\tif(!ch[now][0])return ans;\n\t\t\t\tnow=ch[now][0];\n\t\t\t}\n\t\t} \n\t\tans+=sz[now];\n\t\treturn ans;\n\t}\n\tvoid clear(){tot=0;ch[0][0]=ch[0][1]=sz[0]=0;}\n}\nnamespace T2{\n\tint ch[N*24][2],sz[N*24];int tot=0;\n\tint newnode(){++tot;ch[tot][0]=ch[tot][1]=0;sz[tot]=0;return tot;}\n\tvoid insert(int*A,int*B){\n\t\t//\u6784\u9020\u51fa\u4e00\u68f5C\u8981\u6ee1\u8db3\u7684\u6761\u4ef6\u7684\u6811 \n\t\tint now=0;\n\t\tfor(int i=0;i<L;i++){\n\t\t\tif(A[i]==0&&B[i]==0){\n\t\t\t\t//\u6b64\u65f6 C[i] \u53ea\u80fd\u4e3a 0\n\t\t\t\tif(!ch[now][0])ch[now][0]=newnode();\n\t\t\t\tnow=ch[now][0];\n\t\t\t} \n\t\t\tif(A[i]==1&&B[i]==0){\n\t\t\t\t//\u6b64\u65f6 C[i] \u53ea\u80fd\u4e3a 1\n\t\t\t\tif(!ch[now][1])ch[now][1]=newnode();\n\t\t\t\tnow=ch[now][1]; \n\t\t\t}\n\t\t\tif(A[i]==0&&B[i]==1){\n\t\t\t\tif(!ch[now][0])ch[now][0]=newnode();\n\t\t\t\tsz[ch[now][0]]++;\n\t\t\t\tif(!ch[now][1])ch[now][1]=newnode();\n\t\t\t\tnow=ch[now][1];\n\t\t\t}\n\t\t\tif(A[i]==1&&B[i]==1){\n\t\t\t\tif(!ch[now][1])ch[now][1]=newnode();\n\t\t\t\tsz[ch[now][1]]++;\n\t\t\t\tif(!ch[now][0])ch[now][0]=newnode();\n\t\t\t\tnow=ch[now][0];\n\t\t\t}\n\t\t}\n\t\tsz[now]++;\n\t}\n\tint qry(int*C){\n\t\tint now=0,ans=0;\n\t\tfor(int i=0;i<L;i++){\n\t\t\tif(!ch[now][C[i]])return ans;\n\t\t\tnow=ch[now][C[i]];ans+=sz[now];\n\t\t}return ans;\n\t}\n\tvoid clear(){tot=0;ch[0][0]=ch[0][1]=sz[0]=0;}\n}\nnamespace solve2{\n\t//max d<=min b \u7684\u60c5\u51b5\uff0c\u9650\u5236\u7684\u56e0\u7d20\u662fd \n\t//\u9996\u5148\u5dee\u5206\uff0c\u7136\u540e\u5efa01-tire\n\tstruct node{int c,d,op,id;node(int _,int __,int ___,int ____):c(_),d(__),op(___),id(____){}};\n\tstd::vector<node>Q[N];\n\tvoid work(){\n\t\tfor(int i=1;i<=q;i++)\n\t\t\tQ[l[i]-1].push_back(node(c[i],d[i],-1,i)),\n\t\t\tQ[r[i]].push_back(node(c[i],d[i],1,i));\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tstatic int tmp[L],C[L],D[L];\n\t\t\tpre(a[i],tmp);T1::insert(tmp);\n\t\t\tfor(int j=0;j<Q[i].size();j++){\n\t\t\t\tpre(Q[i][j].c,C);\n\t\t\t\tpre(Q[i][j].d,D);\n\t\t\t\tans[Q[i][j].id]+=Q[i][j].op*T1::qry(C,D);\n\t\t\t}\n\t\t}\n\t}\n}\nnamespace solve3{\n\t//min d>=max b \u7684\u60c5\u51b5\uff0c\u9650\u5236\u7684\u56e0\u7d20\u662fb \n\t//\u9996\u5148\u5dee\u5206\uff0c\u7136\u540e\u5efa01-tire\n\tstruct node{int c,op,id;node(int _,int __,int ___):c(_),op(__),id(___){}};\n\tstd::vector<node>Q[N];\n\tvoid work(){\n\t\tfor(int i=1;i<=q;i++)\n\t\t\tQ[l[i]-1].push_back(node(c[i],-1,i)),\n\t\t\tQ[r[i]].push_back(node(c[i],1,i));\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tstatic int A[L],B[L],C[L];\n\t\t\tpre(a[i],A);pre(b[i],B);T2::insert(A,B);\n\t\t\tfor(int j=0;j<Q[i].size();j++){\n\t\t\t\tpre(Q[i][j].c,C);\n\t\t\t\tans[Q[i][j].id]+=Q[i][j].op*T2::qry(C);\n\t\t\t}\n\t\t}\n\t}\n}\nnamespace solve4{\n\tstruct node{\n\t\tint id,c,d;\n\t\tbool operator<(const node b)const{return d<b.d;}\n\t}Q[N];\n\tstd::pair<int,int>kk[N];\n\tvoid work(){\n\t\tfor(int i=1;i<=q;i++)\n\t\t\tQ[i].id=i,Q[i].c=c[i],Q[i].d=d[i];\n\t\tfor(int i=1;i<=n;i++)kk[i].first=b[i],kk[i].second=a[i];\n\t\tstd::sort(Q+1,Q+1+q);std::sort(kk+1,kk+1+n);\n\t\tint now=0;\n\t\tstatic int A[L],B[L],C[L],D[L];\n\t\tfor(int i=1;i<=q;i++){\n\t\t\twhile(now+1<=n&&kk[now+1].first<=Q[i].d){\n\t\t\t\tnow++;\n\t\t\t\tpre(kk[now].first,B);\n\t\t\t\tpre(kk[now].second,A);\n\t\t\t\tT2::insert(A,B);\n\t\t\t}\n\t\t\tpre(Q[i].c,C);\n\t\t\tans[Q[i].id]+=T2::qry(C);\n\t\t}\n\t\tnow=n+1;\n\t\tfor(int i=q;i>=1;i--){\n\t\t\twhile(now>1&&kk[now-1].first>Q[i].d){\n\t\t\t\tnow--;\n\t\t\t\tpre(kk[now].second,A);\n\t\t\t\tT1::insert(A);\n\t\t\t}\n\t\t\tpre(Q[i].c,C);\n\t\t\tpre(Q[i].d,D);\n\t\t\tans[Q[i].id]+=T1::qry(C,D);\n\t\t}\n\t}\n}\nnamespace solve5{\n\tstruct node{\n\t\tint id,l,r,c,d;\n\t\tbool operator<(const node b)const{return d<b.d;}\n\t}Q[N];\n\tstd::pair<int,int>kk[N];\n\tvoid work(){\n\t\tfor(int i=1;i<=q;i++)\n\t\t\tQ[i].id=i,Q[i].c=c[i],Q[i].d=d[i],Q[i].l=l[i],Q[i].r=r[i];\n\t\tstd::sort(Q+1,Q+1+q);\n\t\tint sz=1800;\n\t\tstatic int A[L],B[L],C[L],D[L];\n\t\tfor(int l=1,r;l<=n;l=r+1){\n\t\t\tr=min(l+sz,n);int len=r-l+1;\n\t\t\tfor(int i=l;i<=r;i++)kk[i-l+1].first=b[i],kk[i-l+1].second=a[i];\n\t\t\tsort(kk+1,kk+1+len);\n\t\t\tint now=0;\n\t\t\tfor(int i=1;i<=q;i++){\n\t\t\t\tint ll=Q[i].l,rr=Q[i].r;\n\t\t\t\tif(ll>l||r>rr)continue;\n\t\t\t\twhile(now+1<=len&&kk[now+1].first<=Q[i].d){\n\t\t\t\t\tnow++;\n\t\t\t\t\tpre(kk[now].first,B);\n\t\t\t\t\tpre(kk[now].second,A);\n\t\t\t\t\tT2::insert(A,B);\n\t\t\t\t}\n\t\t\t\tpre(Q[i].c,C);\n\t\t\t\tans[Q[i].id]+=T2::qry(C);\n\t\t\t}\n\t\t\tnow=len+1;\n\t\t\tfor(int i=q;i>=1;i--){\n\t\t\t\tint ll=Q[i].l,rr=Q[i].r;\n\t\t\t\tif(ll>l||r>rr)continue;\n\t\t\t\twhile(now>1&&kk[now-1].first>Q[i].d){\n\t\t\t\t\tnow--;\n\t\t\t\t\tpre(kk[now].second,A);\n\t\t\t\t\tT1::insert(A);\n\t\t\t\t}\n\t\t\t\tpre(Q[i].c,C);\n\t\t\t\tpre(Q[i].d,D);\n\t\t\t\tans[Q[i].id]+=T1::qry(C,D);\n\t\t\t}\n\t\t\tfor(int i=1;i<=q;i++){\n\t\t\t\tint ll=Q[i].l,rr=Q[i].r;\n\t\t\t\tif(ll<=l&&r<=rr)continue;\n\t\t\t\tll=max(ll,l);rr=min(rr,r);\n\t\t\t\tunsigned short sum1=0,sum2=0,sum3=0,sum4=0,sum5=0,sum6=0;\n\t\t\t\tint j=ll;\n\t\t\t\tfor(;j+5<=rr;j+=6)\n\t\t\t\t\tsum1+=(a[j  ]^Q[i].c)<=min(b[j  ],Q[i].d),\n\t\t\t\t\tsum2+=(a[j+1]^Q[i].c)<=min(b[j+1],Q[i].d),\n\t\t\t\t\tsum3+=(a[j+2]^Q[i].c)<=min(b[j+2],Q[i].d),\n\t\t\t\t\tsum4+=(a[j+3]^Q[i].c)<=min(b[j+3],Q[i].d),\n\t\t\t\t\tsum5+=(a[j+4]^Q[i].c)<=min(b[j+4],Q[i].d),\n\t\t\t\t\tsum6+=(a[j+5]^Q[i].c)<=min(b[j+5],Q[i].d);\n\t\t\t\tfor(;j<=rr;j++)\n\t\t\t\t\tsum1+=(a[j  ]^Q[i].c)<=min(b[j  ],Q[i].d);\n\t\t\t\tans[Q[i].id]+=sum1+sum2+sum3+sum4+sum5+sum6;\n\t\t\t}\n\t\t\tT1::clear();\n\t\t\tT2::clear();\n\t\t}\n\t}\n}\nsigned main(){\n\t//freopen(\"island.in\",\"r\",stdin);\n\t//freopen(\"island.out\",\"w\",stdout);\n\tin::read(n,q);\n\tint mnb=0x3f3f3f3f,mxb=-0x3f3f3f3f;\n\tint mnd=0x3f3f3f3f,mxd=-0x3f3f3f3f;\n\tbool flag=true;\n\tfor(int i=1;i<=n;i++)in::read(a[i],b[i]),mnb=min(mnb,b[i]),mxb=max(mxb,b[i]);\n\tfor(int i=1;i<=q;i++)in::read(l[i],r[i],c[i],d[i]),mnd=min(mnd,d[i]),mxd=max(mxd,d[i]),flag&=(l[i]==1&&r[i]==n);\n\tif(n<=5000)solve1::work();\n\telse if(mxd<=mnb)solve2::work();\n\telse if(mnd>=mxb)solve3::work();\n\telse if(flag)solve4::work();\n\telse solve5::work();\n\tfor(int i=1;i<=q;i++)out::write(ans[i]),out::putc('\\n');\n\tout::flush();\n\treturn 0;\n}\n```\n",
        "postTime": 1616936901,
        "uid": 174304,
        "name": "jun\u5934\u5409\u5409",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P7470 \u3010[NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669\u3011"
    },
    {
        "content": "\u8fd9\u662f\u4e00\u4e2a\u82df\u8fc7\u4e86\u7a7a\u95f4\u7684\u6811\u5957\u6811\u3002\u3002\u3002\n\n\u8003\u8bd5\u7684\u65f6\u5019\u5199\u4e86\u7ebf\u6bb5\u6811\u5957trie\uff0c\u4f46\u88ab\u5361\u4e86\u7a7a\u95f4\u5c31\u975e\u5e38\u607c\u706b\uff08\u90a3\u4efd\u4ee3\u7801\u662f$65$\u5206\uff09\n\n~~\u505a\u6cd5\u5e94\u8be5\u90fd\u6e05\u695a~~\u5c31\u662f\u79bb\u7ebf\u4e0b\u6765\u5206\u522b\u6309$b_i$\u548c$d_i$\u6392\u5e8f\uff0c\u7136\u540e\u5c31\u662f\u4e00\u4e2a\u5206\u522b\u652f\u6301\u52a8\u6001\u52a0\u70b9\u7684 $\\max\\{d_i\\}\\leq \\min\\{b_i\\}$\u548c$\\min\\{d_i\\}\\ge \\max\\{b_i\\}$\u7684\u90e8\u5206\uff0c\u8fd9\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u5957trie\u6765\u505a\n\n\u597d\u4e86\u8fd9\u4e2a\u4e1c\u897f\u7684\u65f6\u7a7a\u590d\u6742\u5ea6\u90fd\u662f$O(n\\log n\\log a_i)$\u7684\uff08\u7a7a\u95f4\u8fd8\u56e0\u4e3a\u8981\u5b58trie\u7684\u5de6\u53f3\u513f\u5b50\u548c\u6743\u503c\u800c\u6709\u4e00\u4e2a$3$\u7684\u5e38\u6570\uff09\uff0c\u7a7a\u95f4\u662f\u4f1a\u8fbe\u5230$\\rm 466MB$\u7684\uff08~~\u6240\u4ee5\u4e3a\u4ec0\u4e48\u4e0d\u5f00$512$~~\uff09\n\n\u7136\u540e\u4f60\u5c31\u5f00\u59cb\u4e86\u7b2c\u4e00\u6b21\u5361\u7a7a\u95f4\uff0c\u4f60\u53d1\u73b0\u5982\u679c\u4e00\u4e2a\u7ebf\u6bb5\u6811\u4e0a\u7684\u8282\u70b9\u518d\u6240\u6709\u8be2\u95ee\u4e2d\u90fd\u6ca1\u6709\u88ab\u7ecf\u8fc7\uff0c\u90a3\u5c31\u4e0d\u9700\u8981\u518d\u8fd9\u4e2a\u70b9\u4e0a\u5efatrie\u6811\u4e86\uff0c\u611f\u6027\u601d\u8003\u4e00\u6ce2\u53d1\u73b0\u5176\u5b9e\u6ca1\u6709\u88ab\u7ecf\u8fc7\u7684\u8282\u70b9\u5e94\u8be5\u8fd8\u633a\u591a\u4e86\uff0c\u4e8e\u662f\u5c31\u5361\u5230\u4e86$90$\u5206\n\n\u7136\u540e\u4f60\u5c31\u6709\u70b9\u8ff7\u4e86\uff0c\u7ecf\u8fc7\u5206\u6790\u53d1\u73b0trie\u4e00\u6b21\u63d2\u5165\u7684$\\log a_i$\u4e2a\u8282\u70b9\u662f\u7edd\u5bf9\u7701\u4e0d\u4e0b\u6765\u7684\uff0c\u4e8e\u662f\u5c31\u53ea\u80fd\u5728\u7ebf\u6bb5\u6811\u7684\u6811\u9ad8\u4e0a\u8003\u8651\uff0c\u7136\u540e\u6211\u5c31\u628a\u7ebf\u6bb5\u6811\u6539\u6210\u4e86\u4e94\u53c9\u7684\u3002\u3002\u3002\uff08~~\u4ec0\u4e48\u4f60\u95ee\u4e3a\u4ec0\u4e48\u4e0d\u662f\u56db\u53c9\uff0c\u56db\u53c9\u5c31\u662f\u5361\u4e0d\u8fc7\u554a~~\uff09\u4e8e\u662f\u5c31\u4ee5$\\rm 245MB$\u7684\u7a7a\u95f4\u82df\u8fc7\u4e86\n\n\u5b9e\u9645\u4e0a\u4f60\u53d1\u73b0\u5de6\u53f3\u513f\u5b50\u7684\u5927\u5c0f\u662f$10^7$\u5de6\u53f3\u7684\uff0c\u6743\u503c\u662f$10^5$\u5de6\u53f3\u7684\uff0c\u5b83\u4eec\u7684\u4e58\u79ef\u662f$10^{19}$\u80fd\u7528\u4e00\u4e2along long\u5b58\uff0c\u6240\u4ee5\u5176\u5b9e\u8ba4\u771f\u5361\u7684\u8bdd\u8fd8\u53ef\u4ee5\u628a\u4e09\u4e2aint\u5361\u6210\u4e00\u4e2along long\uff0c\u518d\u8282\u7701\u4e09\u5206\u4e4b\u4e00\u7684\u7a7a\u95f4\n\n```c++\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e5+5;\nconst int Bits=23;\n#define ls now<<1\n#define rs now<<1|1\nint ch[N*200][2],cnt[N*200],rt[N<<4],ans[N],vis[N<<4];\nint n,q,treesize;\nstruct data{ int a,b,id; } a[N];\nstruct ques{ int l,r,c,d,id; } que[N];\nbool operator < (const data& a, const data& b){ return a.b<b.b; }\nbool operator < (const ques& a, const ques& b){ return a.d<b.d; }\nnamespace S1{\n\tinline void Add(int& pos){ cnt[(pos?pos:pos=++treesize)]++; }\n\tvoid Insert(int& now, int dep, int pos){\n\t\tif (!now) now=++treesize;\n\t\tif (dep==-1){ cnt[now]++; return; }\n\t\tif (a[pos].b&(1<<dep)) Add(ch[now][1-(((a[pos].a>>dep)&1)^((a[pos].b>>dep)&1))]);\n\t\tInsert(ch[now][((a[pos].a>>dep)&1)^((a[pos].b>>dep)&1)],dep-1,pos);\n\t}\n\tvoid update(int now, int l, int r, int x, int y){\n\t\tif (vis[now]) Insert(rt[now],Bits,y);\n\t\tif (l==r) return;\n\t\tint mid1=l+(r-l+1)/5-1;\n\t\tint mid3=(mid1+1+r)>>1,mid2=(mid1+1+mid3)>>1,mid4=(mid3+1+r)>>1,locx=0;\n\t\tint L[5]={l,mid1+1,mid2+1,mid3+1,mid4+1};\n\t\tint R[5]={mid1,mid2,mid3,mid4,r};\n\t\tfor (int i=0; i<5; i++)\n\t\t\tif (L[i]<=x && x<=R[i]) locx=i;\n\t\tupdate(now*5+locx,L[locx],R[locx],x,y);\n\t}\n\tint Query(int now, int dep, int v){\n\t\tif (!now) return 0;\n\t\tif (dep==-1) return cnt[now];\n\t\treturn Query(ch[now][(v>>dep)&1],dep-1,v)+cnt[now];\n\t}\n\tint query(int now, int l, int r, int x, int y, int z){\n\t\tif (l==x && r==y) return Query(rt[now],Bits,z);\n\t\tint mid1=l+(r-l+1)/5-1;\n\t\tint mid3=(mid1+1+r)>>1,mid2=(mid1+1+mid3)>>1,mid4=(mid3+1+r)>>1,locx=0,locy=0;\n\t\tint L[5]={l,mid1+1,mid2+1,mid3+1,mid4+1};\n\t\tint R[5]={mid1,mid2,mid3,mid4,r};\n\t\tfor (int i=0; i<5; i++){\n\t\t\tif (L[i]<=x && x<=R[i]) locx=i;\n\t\t\tif (L[i]<=y && y<=R[i]) locy=i;\n\t\t}\n\t\tif (locx==locy) return query(now*5+locx,L[locx],R[locx],x,y,z);\n\t\telse {\n\t\t\tint res=0;\n\t\t\tfor (int i=locx+1; i<locy; i++) res+=query(now*5+i,L[i],R[i],L[i],R[i],z);\n\t\t\tres+=query(now*5+locx,L[locx],R[locx],x,R[locx],z);\n\t\t\tres+=query(now*5+locy,L[locy],R[locy],L[locy],y,z);\n\t\t\treturn res;\n\t\t}\n\t}\n\tvoid solve(){\n\t\tint now=1;\n\t\tfor (int i=1; i<=q; i++){\n\t\t\twhile (now<=n && a[now].b<=que[i].d) update(1,1,n,a[now].id,now),now++;\n\t\t\tans[que[i].id]=query(1,1,n,que[i].l,que[i].r,que[i].c);\n\t\t}\n\t}\n}\nnamespace S2{\n\tvoid Insert(int& now, int dep, int v){\n\t\tif (!now) now=++treesize;\n\t\tcnt[now]++;\n\t\tif (dep==-1) return;\n\t\tInsert(ch[now][(v>>dep)&1],dep-1,v);\n\t}\n\tvoid update(int now, int l, int r, int x, int y){\n\t\tif (vis[now]) Insert(rt[now],Bits,y);\n\t\tif (l==r) return;\n\t\tint mid1=l+(r-l+1)/5-1;\n\t\tint mid3=(mid1+1+r)>>1,mid2=(mid1+1+mid3)>>1,mid4=(mid3+1+r)>>1,locx=0;\n\t\tint L[5]={l,mid1+1,mid2+1,mid3+1,mid4+1};\n\t\tint R[5]={mid1,mid2,mid3,mid4,r};\n\t\tfor (int i=0; i<5; i++)\n\t\t\tif (L[i]<=x && x<=R[i]) locx=i;\n\t\tupdate(now*5+locx,L[locx],R[locx],x,y);\n\t}\n\tint Query(int now, int dep, int c, int d){\n\t\tif (!now) return 0;\n\t\tif (dep==-1) return cnt[now];\n\t\tint res=Query(ch[now][((c>>dep)&1)^((d>>dep)&1)],dep-1,c,d);\n\t\tif ((d>>dep)&1) res+=cnt[ch[now][1-(((c>>dep)&1)^((d>>dep)&1))]];\n\t\treturn res;\n\t}\n\tint query(int now, int l, int r, int x, int y, int C, int D){\n\t\tif (l==x && r==y) return Query(rt[now],Bits,C,D);\n\t\tint mid1=l+(r-l+1)/5-1;\n\t\tint mid3=(mid1+1+r)>>1,mid2=(mid1+1+mid3)>>1,mid4=(mid3+1+r)>>1,locx=0,locy=0;\n\t\tint L[5]={l,mid1+1,mid2+1,mid3+1,mid4+1};\n\t\tint R[5]={mid1,mid2,mid3,mid4,r};\n\t\tfor (int i=0; i<5; i++){\n\t\t\tif (L[i]<=x && x<=R[i]) locx=i;\n\t\t\tif (L[i]<=y && y<=R[i]) locy=i;\n\t\t}\n\t\tif (locx==locy) return query(now*5+locx,L[locx],R[locx],x,y,C,D);\n\t\telse {\n\t\t\tint res=0;\n\t\t\tfor (int i=locx+1; i<locy; i++) res+=query(now*5+i,L[i],R[i],L[i],R[i],C,D);\n\t\t\tres+=query(now*5+locx,L[locx],R[locx],x,R[locx],C,D);\n\t\t\tres+=query(now*5+locy,L[locy],R[locy],L[locy],y,C,D);\n\t\t\treturn res;\n\t\t}\n\t}\n\tvoid solve(){\n\t\tmemset(ch,0,sizeof(ch));\n\t\tmemset(rt,0,sizeof(rt));\n\t\tmemset(cnt,0,sizeof(cnt)); treesize=0;\n\t\tint now=n;\n\t\tfor (int i=q; i>=1; i--){\n\t\t\twhile (now>=1 && a[now].b>que[i].d) update(1,1,n,a[now].id,a[now].a),now--;\n\t\t\tans[que[i].id]+=query(1,1,n,que[i].l,que[i].r,que[i].c,que[i].d);\n\t\t}\n\t}\n}\nvoid modify(int now, int l, int r, int x, int y){\n\tif (l==x && r==y){ vis[now]=1; return; }\n\tint mid1=l+(r-l+1)/5-1;\n\tint mid3=(mid1+1+r)>>1,mid2=(mid1+1+mid3)>>1,mid4=(mid3+1+r)>>1,locx=0,locy=0;\n\tint L[5]={l,mid1+1,mid2+1,mid3+1,mid4+1};\n\tint R[5]={mid1,mid2,mid3,mid4,r};\n\tfor (int i=0; i<5; i++){\n\t\tif (L[i]<=x && x<=R[i]) locx=i;\n\t\tif (L[i]<=y && y<=R[i]) locy=i;\n\t}\n\tif (locx==locy) modify(now*5+locx,L[locx],R[locx],x,y);\n\telse {\n\t\tfor (int i=locx+1; i<locy; i++) modify(now*5+i,L[i],R[i],L[i],R[i]);\n\t\tmodify(now*5+locx,L[locx],R[locx],x,R[locx]);\n\t\tmodify(now*5+locy,L[locy],R[locy],L[locy],y);\n\t}\n}\nint main(){\n//\tfreopen(\"island.in\",\"r\",stdin);\n//\tfreopen(\"island.out\",\"w\",stdout);\n\tscanf(\"%d%d\",&n,&q);\n\tfor (int i=1; i<=n; i++) scanf(\"%d%d\",&a[i].a,&a[i].b),a[i].id=i;\n\tfor (int i=1; i<=q; i++) scanf(\"%d%d%d%d\",&que[i].l,&que[i].r,&que[i].c,&que[i].d),que[i].id=i,modify(1,1,n,que[i].l,que[i].r);\n\tsort(a+1,a+1+n); sort(que+1,que+1+q);\n\tS1::solve(); S2::solve();\n\tfor (int i=1; i<=q; i++) printf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n/*\n4 2\n1 1\n4 2\n5 1\n2 7\n1 4 6 5\n2 4 3 3\n\n20 10\n215 144\n2 110\n174 132\n214 142\n116 108\n155 192\n236 208\n216 214\n99 220\n236 118\n190 81\n230 131\n10 238\n189 198\n183 13\n45 193\n14 234\n208 192\n126 19\n49 38\n7 14 251 184\n2 18 89 76\n11 15 49 196\n8 11 83 139\n10 15 119 239\n9 16 148 120\n11 17 225 34\n15 16 3 46\n14 15 86 227\n7 18 252 103\n*/\n```",
        "postTime": 1617012271,
        "uid": 44599,
        "name": "wishapig",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P7470\u3010[NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669\u3011"
    },
    {
        "content": "[[NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669](https://www.luogu.com.cn/problem/P7470)\n\n\u7ebf\u6bb5\u6811\u5206\u6cbb + $\\mathtt{01\\ Trie}$ \n\n\u4e0d\u96be\u53d1\u73b0\u4e00\u4e2a\u8be2\u95ee\u53ef\u4ee5\u5206\u591a\u6bb5\u5206\u522b\u8ba1\u7b97\u7136\u540e\u7d2f\u52a0\u5408\u5e76\uff0c\u6240\u4ee5\u53ef\u4ee5\u7ebf\u6bb5\u6811\u5206\u6cbb\u3002\n\n\u5f00\u59cb\u65f6\u5c06\u6bcf\u4e2a\u8be2\u95ee\u6302\u5728 $l \\sim r$ \u5728\u7ebf\u6bb5\u6811\u4e0a\u5bf9\u5e94\u7684 $\\mathcal{\\log n}$ \u4e2a\u8282\u70b9\u4e0a\uff0c\u6700\u540e\u626b\u63cf\u6574\u68f5\u7ebf\u6bb5\u6811\u7edf\u4e00\u5904\u7406\uff0c\u8fd9\u6837\u533a\u95f4\u8fd9\u4e00\u7ef4\u7684\u9650\u5236\u5c31\u88ab\u89e3\u9664\u4e86\uff0c\u6545\u4ee5\u4e0b\u7684\u8ba8\u8bba\u5747\u9650\u5236\u5728\u67d0\u4e2a\u7ebf\u6bb5\u6811\u8282\u70b9\u4e0a\u3002\n\n\u5bf9\u4e8e\u4e00\u4e2a\u8be2\u95ee\uff0c\u8be2\u95ee\u4e2d\u7684 $d_j$ \u5c06\u5c9b\u5c7f\u5212\u5206\u4e3a\u4e24\u4e2a\u96c6\u5408\uff0c\u5206\u522b\u662f $b_i \\leq d_j$ \u548c $b_i>d_j$ \uff0c\u8fdb\u884c\u5206\u7c7b\u8ba8\u8bba\u3002\n\n\n------------\n\n\n#### \u7b2c\u4e00\u79cd\u60c5\u51b5\uff1a$b_i>d_j$ \n\n\u8fd9\u4e00\u90e8\u5206\u76f8\u5f53\u4e8e\u67e5\u8be2\u6ee1\u8db3 $a_i \\oplus c_j \\leq d_j$ \u7684\u5c9b\u5c7f\u6570\uff0c\u8fd9\u662f $\\mathtt{01\\ Trie}$ \u7684\u7ecf\u5178\u5e94\u7528\uff0c\u6545\u5728\u6b64\u4e0d\u8be6\u7ec6\u5c55\u5f00\uff0c\u4e0d\u4f1a\u7684\u53ef\u4ee5\u5de6\u8f6c [CF817E Choosing The Commander](https://www.luogu.com.cn/problem/CF817E) \u3002\n\n\u5927\u81f4\u505a\u6cd5\u662f\u5728 $\\mathtt{01\\ Trie}$ \u4e0a\u8bb0\u5f55\u4e00\u4e2a\u6807\u8bb0\uff0c\u8868\u793a\u5f53\u524d\u6709\u591a\u5c11\u4e2a\u6570\u5171\u7528\u6839\u5230\u8fd9\u4e2a\u8282\u70b9\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u524d\u7f00\uff0c\u67e5\u8be2\u65f6\u5bf9 $(c_j,d_j)$ \u4ece\u4e8c\u8fdb\u5236\u9ad8\u4f4d\u5230\u4f4e\u4f4d\u8fdb\u884c\u5339\u914d\uff0c\u8ba8\u8bba\u4e25\u683c\u5c0f\u4e8e\u548c\u5c0f\u4e8e\u7b49\u4e8e\u4e24\u79cd\u60c5\u51b5\u3002\n\n\u8bbe\u5f53\u524d\u5230\u4e8c\u8fdb\u5236\u7684\u7b2c $p$ \u4f4d\uff0c\u82e5 $a_i$ \u6ee1\u8db3 $a_i \\oplus c_j < d_j$ \u4e14 $a_i \\oplus c_j$ \u4e0e $d_j$ \u7684\u524d $p-1$ \u4f4d\u4e8c\u8fdb\u5236\u90fd\u76f8\u7b49\uff0c\u5219\u5f53 $d_j$ \u7684\u7b2c $p$ \u4f4d\u4e3a $1$ \u65f6 $(a_i \\oplus c_j)_p=0 $ \u6709\u8d21\u732e\uff0c $(a_i \\oplus c_j)_p=1 $ \u53ef\u80fd\u6709\u8d21\u732e\u3002\n\n\u4e8e\u662f\u5f53 $d_j$ \u7684\u7b2c $p$ \u4f4d\u4e3a $1$ \u65f6\u7d2f\u52a0 $\\mathtt{01\\ Trie}$ \u5f53\u524d\u4f4d\u4e0a $(a_i \\oplus c_j)_p=0 $ \u7684\u8282\u70b9\u4e0a\u7684\u6807\u8bb0\uff0c\u7136\u540e\u8d70\u5411 $(a_i \\oplus c_j)_p=1 $ \u7684\u8282\u70b9\u7ee7\u7eed\u8ba8\u8bba\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u8d70\u5230\u53f6\u5b50\u8282\u70b9\u65f6\u8be5\u8282\u70b9\u4e0a\u7684\u6807\u8bb0\u5c31\u662f $a_i \\oplus c_j = d_j$ \u7684\u4e2a\u6570\u3002\n\n\n------------\n\n\n#### \u7b2c\u4e8c\u79cd\u60c5\u51b5\uff1a$b_i \\leq d_j$ \n\n\u8fd9\u4e00\u90e8\u5206\u6bd4\u8f83\u9ebb\u70e6\uff0c\u76f8\u5f53\u4e8e\u67e5\u8be2 $a_i \\oplus c_j \\leq b_i$ \u7684\u5c9b\u5c7f\u6570\uff0c\u4f46\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u7ed3\u6784\u4e0e $a_i \\oplus c_j \\leq d_j$ \u662f\u975e\u5e38\u76f8\u4f3c\u7684\u3002\n\n$a_i \\oplus c_j \\leq d_j$ \u662f\u5bf9 $a_i$ \u5efa $\\mathtt{01\\ Trie}$ \u540e\u5bf9 $(c_j,d_j)$ \u67e5\u8be2\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u53c2\u8003\u8fd9\u4e2a\u505a\u6cd5\uff0c\u5bf9 $c_j$ \u5efa $\\mathtt{01\\ Trie}$ \uff0c\u628a $(a_i,b_i)$ \u5f53\u4f5c\u8be2\u95ee\u8fdb\u884c\u67e5\u8be2\uff0c\u5728 $\\mathtt{01\\ Trie}$ \u4e0a\u67e5\u8be2\u65f6\u8bb0\u5f55 $(a_i,b_i)$ \u5bf9\u6bcf\u4e2a $c_j$ \u7684\u8d21\u732e\u3002\n\n\u66f4\u5177\u4f53\u5730\uff0c\u4eff\u7167\u7b2c\u4e00\u79cd\u60c5\u51b5\u5bf9 $(a_i,b_i)$ \u8fdb\u884c\u9010\u4f4d\u5339\u914d\u548c\u5206\u7c7b\u8ba8\u8bba\uff0c\u5728\u9700\u8981\u7d2f\u52a0\u6807\u8bb0\u7684\u5730\u65b9\u5bf9\u53e6\u4e00\u4e2a\u6807\u8bb0\uff08\u521d\u59cb\u4e3a\u7a7a\uff0c\u540e\u6587\u79f0\u4e3a\u201c\u8d21\u732e\u6807\u8bb0\u201d\uff09\u52a0\u4e00\uff0c\u8868\u793a $(a_i,b_i)$ \u5bf9\u7ecf\u8fc7\u6b64\u8282\u70b9\u7684 $c_j$ \u4ea7\u751f\u4e86\u4e00\u7684\u8d21\u732e\uff0c\u6216\u8005\u8bf4\u7ecf\u8fc7\u6b64\u8282\u70b9\u7684 $c_j$ \u6ee1\u8db3 $a_i \\oplus c_j < b_i$ \uff0c\u540c\u7406\u5728\u5339\u914d\u5230\u53f6\u5b50\u8282\u70b9\u65f6\u5728\u53f6\u5b50\u8282\u70b9\u52a0\u4e00\uff0c\u8868\u793a\n\u7ecf\u8fc7\u6b64\u8282\u70b9\u7684 $c_j$ \u6ee1\u8db3 $a_i \\oplus c_j = b_i$ \n\n\u6700\u540e\u5c06\u6bcf\u4e2a $c_j$ \u5728 $\\mathtt{01\\ Trie}$ \u4e0a\u8fdb\u884c\u5339\u914d\uff0c\u7d2f\u52a0\u4e0a\u6cbf\u9014\u7684\u8d21\u732e\u6807\u8bb0\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa $a_i \\oplus c_j \\leq b_i$ \u7684\u5c9b\u5c7f\u6570\u3002\n\n\n------------\n\n\n\u63a5\u4e0b\u6765\u8be5\u89e3\u51b3\u7684\u662f\uff0c\u5982\u4f55\u4f18\u96c5\u5730\u5904\u7406\u6bcf\u4e2a\u8be2\u95ee\u3002\n\n\u5c06 $(a_i,b_i)$ \u4e0e $(c_j,d_j)$ \u5206\u522b\u6309\u7167 $b_i$ \u548c $d_j$ \u5347\u5e8f\u6392\u5e8f\uff0c\u7528\u53cc\u6307\u9488\u626b\u63cf\uff0c\u5f00\u4e24\u4e2a $\\mathtt{01\\ Trie}$ \u5206\u522b\u7ef4\u62a4\u7b2c\u4e00\u79cd\u60c5\u51b5\u548c\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u626b\u63cf\u5230\u7b2c $j$ \u4e2a\u8be2\u95ee\u65f6\u5c06\u4e0d\u6ee1\u8db3 $b_i>d_j$ \u7684 $a_i$ \u4ece\u7ef4\u62a4\u7b2c\u4e00\u79cd\u60c5\u51b5\u7684 $\\mathtt{01\\ Trie}$ \u4e0a\u5220\u9664\uff0c\u7136\u540e\u67e5\u8be2 $(c_j,d_j)$ \u7d2f\u52a0\u8d21\u732e\u3002\u540c\u65f6\u5c06\u6ee1\u8db3 $b_i \\leq d_j$ \u7684 $(a_i,b_i)$ \u5728\u7ef4\u62a4\u7b2c\u4e8c\u79cd\u60c5\u51b5\u7684 $\\mathtt{01\\ Trie}$ \u4e0a\u8ba1\u7b97\u8d21\u732e\uff0c\u7136\u540e\u5bf9 $c_j$ \u8fdb\u884c\u5339\u914d\u7d2f\u52a0\u8d21\u732e\u3002\n\n\u7531\u4e8e $b_i$ \u548c $d_j$ \u6309\u7167\u5347\u5e8f\u6392\u5e8f\uff0c\u6240\u4ee5\u4e24\u4e2a\u6307\u9488\u5355\u8c03\u5411\u53f3\u79fb\u3002\n\n#### \u4e00\u4e9b\u7cbe\u7ec6\u5b9e\u73b0\uff1a\n\n\u5728\u7ebf\u6bb5\u6811\u5206\u6cbb\u65f6\uff0c\u8981\u5148\u8ba1\u7b97\u4f4e\u5c42\u7684\u7b54\u6848\u518d\u8ba1\u7b97\u9ad8\u5c42\u7684\u7b54\u6848\uff0c\u5426\u5219\u5728\u5bf9\u5c9b\u5c7f\u6392\u5e8f\u65f6\u4f1a\u9020\u6210\u4e00\u4e9b\u987a\u5e8f\u6df7\u4e71\u3002\n\n\u5728\u6bcf\u6b21\u8ba1\u7b97\u4e4b\u540e\u6e05\u7a7a $\\mathtt{01\\ Trie}$ \uff0c\u800c\u4e0d\u662f\u5728\u6bcf\u4e2a\u8282\u70b9\u90fd\u5f00\u4e00\u4e2a $\\mathtt{01\\ Trie}$ \uff0c\u53ef\u4ee5\u8282\u7701\u7a7a\u95f4\uff08\u5728 ```256MB``` \u7684\u7a7a\u95f4\u4e0b\u662f\u975e\u5e38\u5fc5\u8981\u7684\uff09\u3002\n\n\u5206\u6cbb\u5230 $l=r$ \u65f6\u76f4\u63a5\u5bf9\u5f53\u524d\u8282\u70b9\u7684\u8be2\u95ee\u66b4\u529b\u7edf\u8ba1\u7b54\u6848\uff0c\u6b64\u65f6\u53ea\u6709\u4e00\u4e2a\u5c9b\u5c7f\uff0c\u53ef\u4ee5\u7701\u53bb\u5c06\u5404\u79cd\u4e1c\u897f\u63d2\u5165 $\\mathtt{01\\ Trie}$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002\n\n\u7531\u4e8e\u5206\u6cbb\u7684\u7279\u6b8a\u6027\uff0c\u5bf9 $(a_i,b_i)$ \u7684\u6392\u5e8f\u53ef\u4ee5\u4f7f\u7528\u5f52\u5e76\u6392\u5e8f\u800c\u4e0d\u662f ```std::sort``` \u3002\n\n\u7ecf\u8fc7\u4e0a\u8ff0\u7ec6\u8282\u5904\u7406\u540e\u672c\u4ee3\u7801\u8dd1\u8fdb\u4e86\u6700\u4f18\u89e3\u7b2c\u4e09\u540d\uff086.08s\uff09\u3002\n\n\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O(n \\log n \\log a_i)}$ \u3002\n\n\u65e2\u7136\u4f60\u80fd\u627e\u5230\u8fd9\u9898\uff0c\u6211\u76f8\u4fe1\u4f60\u80fd\u77ac\u95f4\u505a\u51fa\u6765\u7684\u3002\n\n```Code:```\n```cpp\n#include<bits/stdc++.h>\ntypedef long long LL;\ntypedef long double LD;\nusing namespace std;\nconst int N=100010,M=1000010,INF=0x3f3f3f3f;\ninline int max(int x,int y){return x>y?x:y;}\ninline int min(int x,int y){return x<y?x:y;}\ninline void swap(int &x,int &y){x^=y^=x^=y;}\nint n,m,ans[N];\nint cnt,tr[N<<5][2],tag[N<<5],rt[2];\nstruct rec{int x,y,id;}s[N],w[N];\nvector<rec> q[N<<2];\nbool cmp(rec a,rec b){return a.y<b.y;}\nstruct SegmentTree{\n\tint l,r;\n\t#define l(x) tree[x].l\n\t#define r(x) tree[x].r\n}tree[N<<2];\nvoid clr(){\n\trt[0]=rt[1]=0;\n\tfor(int i=1;i<=cnt;i++)\n\t\ttr[i][0]=tr[i][1]=tag[i]=0;\n\tcnt=0;\n}\nvoid ins(int p,int x,int t){\n\tfor(int i=1<<23;i;i>>=1){\n\t\tbool ch=x&i;\n\t\tif(!tr[p][ch])tr[p][ch]=++cnt;\n\t\tp=tr[p][ch];tag[p]+=t;\n\t}\n}\nint ask(int p,int x,int y){//a ^ c <= d\n\tint res=0;\n\tfor(int i=1<<23;i;i>>=1){\n\t\tif(!p)break;\n\t\tbool cc=x&i,dd=y&i;\n\t\tif(dd)res+=tag[tr[p][cc]];\n\t\tp=tr[p][cc^dd];\n\t}\n\tif(p)res+=tag[p];\n\treturn res;\n}\nvoid upd(int p,int x,int y){//c ^ a <= b\n\tfor(int i=1<<23;i;i>>=1){\n\t\tif(!p)break;\n\t\tbool aa=x&i,bb=y&i;\n\t\tif(bb&&tr[p][aa])tag[tr[p][aa]]++;\n\t\tp=tr[p][aa^bb];\n\t}\n\tif(p)tag[p]++;\n}\nint qry(int p,int x){\n\tint res=0;\n\tfor(int i=1<<23;i;i>>=1){\n\t\tbool ch=x&i;\n\t\tres+=tag[tr[p][ch]];\n\t\tp=tr[p][ch];\n\t}\n\treturn res;\n}\nvoid build(int x,int l,int r){\n\tl(x)=l,r(x)=r;\n\tif(l==r)return;\n\tint mid=(l+r)>>1;\n\tbuild(x<<1,l,mid);\n\tbuild(x<<1|1,mid+1,r);\n}\nvoid insert(int x,int L,int R,rec t){\n\tint l=l(x),r=r(x);\n\tif(L<=l&&r<=R){q[x].push_back(t);return;}\n\tint mid=(l+r)>>1;\n\tif(L<=mid)insert(x<<1,L,R,t);\n\tif(R>mid)insert(x<<1|1,L,R,t);\n}\nvoid query(int x,int l,int r){\n\tif(l==r){\n\t\tfor(int i=0;i<(int)q[x].size();i++)\n\t\t\tans[q[x][i].id]+=(s[l].x^q[x][i].x)<=min(s[l].y,q[x][i].y);\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tquery(x<<1,l,mid);\n\tquery(x<<1|1,mid+1,r);\n\n\tint i=l,j=mid+1,k=l;\n\twhile(i<=mid&&j<=r)\n\t\tif(s[i].y<=s[j].y)w[k++]=s[i++];\n\t\telse w[k++]=s[j++];\n\twhile(i<=mid)w[k++]=s[i++];\n\twhile(j<=r)w[k++]=s[j++];\n\tfor(int i=l;i<=r;i++)s[i]=w[i];\n\n\tsort(q[x].begin(),q[x].end(),cmp);\n\trt[0]=++cnt;rt[1]=++cnt;\n\n\tfor(int i=0;i<(int)q[x].size();i++)\n\t\tins(rt[0],q[x][i].x,0);//c\n\n\tfor(int i=l;i<=r;i++)\n\t\tins(rt[1],s[i].x,1);//a\n\n\tfor(int i=0,j=l;i<(int)q[x].size();i++){\n\t\twhile(j<=r&&s[j].y<=q[x][i].y){\n\t\t\tins(rt[1],s[j].x,-1);\n\t\t\tupd(rt[0],s[j].x,s[j].y);\n\t\t\tj++;\n\t\t}\n\t\tans[q[x][i].id]+=qry(rt[0],q[x][i].x)+ask(rt[1],q[x][i].x,q[x][i].y);\n\t}\n\tclr();\n}\nint main(){\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%d%d\",&s[i].x,&s[i].y);\n\tbuild(1,1,n);\n\tfor(int i=1;i<=m;i++){\n\t\tint l,r,c,d;\n\t\tscanf(\"%d%d%d%d\",&l,&r,&c,&d);\n\t\tinsert(1,l,r,(rec){c,d,i});\n\t}\n\tquery(1,1,n);\n\tfor(int i=1;i<=m;i++)\n\t\tprintf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1637241204,
        "uid": 137242,
        "name": "Dia\u043esi",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7470 \u3010[NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669\u3011"
    },
    {
        "content": "\u672c\u6587\u540c\u6b65\u4e8e\u6211\u7684 [cnblog](https://www.cnblogs.com/ZigZagKmp/p/14587026.html)\u3002\n\n## \u9898\u610f\u7b80\u8ff0\n\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217\uff0c\u6bcf\u4e00\u4e2a\u4f4d\u7f6e $i$ \u6709\u4e24\u4e2a\u5c5e\u6027\u503c $a_i,b_i$ \u3002\n\n\u6709 $q$ \u6b21\u8be2\u95ee\uff0c\u5f62\u5982 $l,r,c,d$ \uff0c\u67e5\u8be2\u6709\u591a\u5c11\u4e2a $i$ \u6ee1\u8db3 $i\\in [l,r],(a_i\\oplus c)\\le \\min\\{b_i,d\\}$ \uff0c\u5176\u4e2d $\\oplus$ \u4e3a\u6309\u4f4d\u5f02\u6216\u8fd0\u7b97\u3002\n\n$1\\le n,q\\le 10^5\\ ,\\ 1\\le l\\le r\\le n\\ ,\\ 0\\le a_i,b_i,c,d<2^{24}$\u3002\n\n## \u7b97\u6cd5\u5206\u6790\n\u9996\u5148\u66b4\u529b\u7279\u522b\u597d\u5199\uff0c\u590d\u6742\u5ea6 $\\mathcal O(nq)$ ~~\uff08\u7136\u540e\u5c31\u53ef\u4ee5\u7528\u6307\u4ee4\u96c6\u4f18\u5316\u4e86\uff0c\u66b4\u529b\u78be\u6807\u7b97\uff09~~\u3002\n\n\u5148\u8003\u8651\u4e00\u4e2a\u90e8\u5206\u5206\uff0c$\\max\\{d\\}\\le \\min\\{b_i\\}$\uff0c\u5373\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651 $d$ \u7684\u9650\u5236\u3002[\u8fd9\u662f\u4e00\u9053\u539f\u9898](https://codeforces.com/problemset/problem/817/E)\u3002\n\n\u9650\u5236\u662f\u5f02\u6216\uff0c\u56e0\u6b64\u8003\u8651\u6309\u4f4d\u5206\u6790\u3002\u6211\u4eec\u4ece\u9ad8\u4f4d\u5230\u4f4e\u4f4d\u904d\u5386\uff0c\u8003\u8651\u7b2c $p$ \u4f4d\uff0c\u5206\u4e24\u79cd\u60c5\u51b5\uff1a\n1. $d_p=0$ \uff0c\u6b64\u65f6\u5982\u679c\u5728\u8003\u8651\u7684\u8303\u56f4\u5185 $(a_i\\oplus c)_p=1$\uff0c\u5219\u4e00\u5b9a\u4e0d\u5408\u6cd5\uff0c\u5373\u5fc5\u987b\u6ee1\u8db3 $(a_i\\oplus c)_p=0$ \u4f46\u4ecd\u7136\u4e0d\u786e\u5b9a\uff0c\u56e0\u6b64\u9700\u7ee7\u7eed\u904d\u5386\u4f4e\u4f4d\uff1b\n2. $d_p=1$ \uff0c\u6b64\u65f6\u5982\u679c\u5728\u8003\u8651\u7684\u8303\u56f4\u5185 $(a_i\\oplus c)_p=0$\uff0c\u5219\u4e00\u5b9a\u5408\u6cd5\uff0c\u65e0\u9700\u7ee7\u7eed\u904d\u5386\uff0c\u5426\u5219\u4e0d\u786e\u5b9a\uff0c\u9700\u7ee7\u7eed\u904d\u5386\u4f4e\u4f4d\u3002\n\n\u8fd9\u79cd\u9650\u5236\u6761\u4ef6\u5f88\u5bb9\u6613\u7528 `0-1 trie` \u8868\u793a\u51fa\uff0c\u5373\uff1a\n\n![\u56fe\u7247.png](https://i.loli.net/2021/03/27/lcr3vEAOBFfy8Wj.png)\n\n\u628a $a_i$ \u63d2\u5165 trie \u5373\u53ef\uff0c\u4e3a\u4e86\u5904\u7406 $i\\in [l,r]$ \u7684\u9650\u5236\uff0c\u8981\u4f7f\u7528\u53ef\u6301\u4e45\u5316 `trie` \uff0c\u65f6\u7a7a\u590d\u6742\u5ea6\u5747\u4e3a $\\mathcal O(n\\log n)$ \u3002\n\n\u518d\u8003\u8651\u7b2c\u4e8c\u4e2a\u90e8\u5206\u5206\uff0c$\\max\\{b_i\\}\\le \\min\\{d\\}$\uff0c\u5373\u6211\u4eec\u53ea\u9700\u8981\u8003\u8651 $b_i$ \u7684\u9650\u5236\u3002\u6b64\u65f6\u63d2\u5165\u7684\u6709\u4e24\u4e2a\u9650\u5236\uff0c\u8be2\u95ee\u53ea\u6709\u4e00\u4e2a\u9650\u5236\uff0c\u56e0\u6b64\u8003\u8651\u53cd\u8fc7\u6765\u8ba1\u7b97\u8d21\u732e\uff0c\u5982\u4e0b\u5206\u6790\uff1a\n\n\u7ee7\u7eed\u4ece\u9ad8\u4f4d\u5230\u4f4e\u4f4d\u904d\u5386\uff0c\u8003\u8651\u7b2c $p$ \u4f4d\uff0c\u5206\u4e24\u79cd\u60c5\u51b5\uff1a\n1. $b_p=0$ \uff0c\u6b64\u65f6\u5982\u679c\u5728\u8003\u8651\u7684\u8303\u56f4\u5185\u8be2\u95ee\u7684 $c$ \u4f1a\u4f7f\u5f97 $(a_i\\oplus c)_p=1$ \u6210\u7acb\uff0c\u5219\u4e00\u5b9a\u4e0d\u5408\u6cd5\uff0c\u5373\u5fc5\u987b\u6ee1\u8db3 $(a_i\\oplus c)_p=0$ \uff0c\u8fd9\u4e2a\u5143\u7d20\u624d\u6709\u53ef\u80fd\u7ed9\u8be2\u95ee $c$ \u4e00\u4e2a\u8d21\u732e\uff0c\u4f46\u4ecd\u7136\u4e0d\u786e\u5b9a\uff0c\u56e0\u6b64\u9700\u7ee7\u7eed\u904d\u5386\u4f4e\u4f4d\uff1b\n2. $b_p=1$ \uff0c\u6b64\u65f6\u5982\u679c\u5728\u8003\u8651\u7684\u8303\u56f4\u5185\u8be2\u95ee\u7684 $c$ \u4f1a\u4f7f\u5f97 $(a_i\\oplus c)_p=0$\uff0c\u5219\u4e00\u5b9a\u5408\u6cd5\uff0c\u4e00\u5b9a\u6709\u8d21\u732e\uff0c\u65e0\u9700\u7ee7\u7eed\u904d\u5386\uff0c\u5426\u5219\u4e0d\u786e\u5b9a\u662f\u5426\u4ea7\u751f\u8d21\u732e\uff0c\u9700\u7ee7\u7eed\u904d\u5386\u4f4e\u4f4d\u3002\n\n\u8fd9\u79cd\u9650\u5236\u6761\u4ef6\u662f\u7c7b\u4f3c\u7684\uff0c\u4e5f\u53ef\u4ee5\u7528 `0-1 trie` \u8868\u793a\u51fa\uff0c\u5373\uff1a\n\n![\u56fe\u7247.png](https://i.loli.net/2021/03/27/DN46JbWir5lc73z.png)\n\n\u5176\u4e2d\u9ec4\u8272\u8282\u70b9\u8868\u793a\u6b64\u5904\u6709\u8d21\u732e\uff0c\u6700\u540e\u8be2\u95ee\u7684\u65f6\u5019\u628a\u7ecf\u8fc7\u7684\u6240\u6709\u70b9\u7684\u8d21\u732e\u76f8\u52a0\u5373\u4e3a\u7b54\u6848\u3002\n\n\u540c\u6837\u4f7f\u7528\u53ef\u6301\u4e45\u5316 `trie` \u7ef4\u62a4\u4e0b\u6807\u504f\u5e8f\u5173\u7cfb\uff0c\u65f6\u7a7a\u590d\u6742\u5ea6\u5747\u4e3a $\\mathcal O(n\\log n)$ \u3002\n\n\u4e24\u8005\u7ed3\u5408\uff0c\u6211\u4eec\u5f88\u96be\u540c\u65f6\u8003\u8651\u4e24\u4e2a\u9650\u5236\u3002\u4e0d\u59a8\u627e\u5230\u4e00\u4e2a\u5206\u754c\uff0c\u524d\u9762\u7684\u6240\u6709\u5143\u7d20\u6ee1\u8db3 $b_i<d$ \uff0c\u540e\u9762\u7684\u6240\u6709\u5143\u7d20\u6ee1\u8db3 $b_i>d$ \u3002\u6211\u4eec\u6309\u7167 $b,d$ \u5347\u5e8f\u6392\u5e8f\u540e two pointers \u626b\u4e00\u904d\u5373\u53ef\u6c42\u89e3\u3002\n\n\u4f46\u662f\u7531\u4e8e\u6392\u5e8f\u7684\u5b58\u5728\uff0c\u6211\u4eec\u65e0\u6cd5\u7ee7\u7eed\u6cbf\u7528\u53ef\u6301\u4e45\u5316 `trie` \u7684\u65b9\u6cd5\u5904\u7406\u4e0b\u6807\u504f\u5e8f\u5173\u7cfb\u3002\u7531\u4e8e\u4fe1\u606f\u53ef\u52a0**\u53ef\u51cf**\uff0c\u56e0\u6b64\u6709\u5982\u4e0b\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff1a\n1. \u6811\u72b6\u6570\u7ec4\u5957 `trie` \uff0c\u65f6\u7a7a\u590d\u6742\u5ea6\u5747\u4e3a $\\mathcal O(n\\log^2 n)$\uff0c\u7a7a\u95f4\u5361\u4e0d\u8fc7\u53bb\u3002\n2. `cdq\u5206\u6cbb`\u5957 `trie`\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log^2 n)$ \uff0c\u7a7a\u95f4\u590d\u6742\u5ea6  $\\mathcal O(n\\log n)$\uff0c\u53ef\u4ee5\u5361\u8fc7\u53bb\u3002\n\n\u6811\u72b6\u6570\u7ec4\u5957 `trie` \u76f4\u63a5\u7ef4\u62a4 $n$ \u68f5 `trie`\uff0c\u5916\u5c42\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u5176\u7ef4\u62a4\u533a\u95f4\u7684\u6240\u6709\u5143\u7d20\u7684 `trie` \u7684\u6839\uff0c\u4fee\u6539\u76f4\u63a5\u66b4\u529b\u63d2\u5165\u5373\u53ef\uff0c\u6bd4\u8f83\u76f4\u89c2\uff0c\u4e5f\u6bd4\u8f83\u65e0\u8111\u3002\n\n`cdq\u5206\u6cbb` \u5957 `trie`\uff0c\u5728\u5916\u5c42\u628a\u4e0b\u6807\u9650\u5236\u62c6\u5f00\uff0c\u6309\u7167\u4e0b\u6807\u6392\u5e8f\uff0c\u5185\u5c42\u518d\u6309\u7167 $b_i/d$ \u6392\u5e8f\uff0c\u5de6\u8fb9\u4fee\u6539\u5bf9\u53f3\u8fb9\u8be2\u95ee\u4ea7\u751f\u8d21\u732e\uff0c\u5b9e\u73b0\u8d77\u6765\u6709\u4e00\u4e9b\u7ec6\u8282\u3002\n\n## \u4ee3\u7801\u5b9e\u73b0\n\u6811\u72b6\u6570\u7ec4\u5957 `trie`\uff0c\uff08luogu\u6c11\u95f4\u6570\u636e\u53ea\u670920\u5206\uff0c\u6ca6\u4e3a\u66b4\u529b\u2026\u2026\uff09\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define maxn 1000005\n#define maxm 20000005\n#define inf 0x3f3f3f3f\n#define LL long long\n#define ull unsigned long long\n#define ldb long double\n#define mod 1000000007\n#define eps 1e-9\n#define local\nvoid file(string s){freopen((s+\".in\").c_str(),\"r\",stdin);freopen((s+\".out\").c_str(),\"w\",stdout);}\ntemplate <typename Tp> void read(Tp &x){\n\tint fh=1;char c=getchar();x=0;\n\twhile(c>'9'||c<'0'){if(c=='-'){fh=-1;}c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<1)+(x<<3)+(c&15);c=getchar();}x*=fh;\n}\nint n,m;\nstruct node{\n\tint id,a,b;\n\tbool operator <(node y)const{\n\t\treturn b<y.b;\n\t}\n};\nstruct Quer{\n\tint id,l,r,c,d;\n\tbool operator <(Quer y)const{\n\t\treturn d<y.d;\n\t}\n};\nnode ai[maxn];\nQuer qi[maxn];\nint ans[maxn];\n\nnamespace Sub1{//d<b  chk d\n\tint ch[maxm][2],siz[maxm],T[maxn],tot;\n\tvoid upd(int rt,int x,int v){//\u60c5\u51b51\u7684\u63d2\u5165\n\t\tint p=rt,dir;\n\t\tfor(int i=23;~i;--i){\n\t\t\tdir=((x>>i)&1);\n\t\t\tif(!ch[p][dir])ch[p][dir]=++tot;\n\t\t\tp=ch[p][dir];\n\t\t\tsiz[p]+=v;//\u8bb0\u5f55\u4e2a\u6570\n\t\t}\n\t}\n\tint query(int rt,int c,int d){//\u60c5\u51b51\u7684\u67e5\u8be2\n\t\t++d;//\u8fd9\u91cc\u8981+1\uff0c\u56e0\u4e3a\u6211\u4eec\u4e0a\u9762\u7684\u5206\u6790\u8fc7\u7a0b\u6ca1\u6709\u8ba1\u7b97\u672c\u8eab\uff0c\u8fd9\u6837\u5199\u80fd\u51cf\u5c11\u8fb9\u754c\u7ec6\u8282\n\t\tint ret=0,p=rt,dc,dd;\n\t\tfor(int i=23;~i;--i){\n\t\t\tdc=((c>>i)&1);dd=((d>>i)&1);\n\t\t\tif(dd){\n\t\t\t\tret+=siz[ch[p][dc]];//\u7d2f\u52a0\u786e\u5b9a\u7684\u4e2a\u6570\n\t\t\t\tp=ch[p][dc^1];\n\t\t\t}\n\t\t\telse p=ch[p][dc];\n\t\t\tif(!p)break;\n\t\t}\n\t\treturn ret;\n\t}\n\tvoid add(int x,int a,int v){//\u6811\u5957\u6811\u4fee\u6539\n\t\tfor(;x<=n;x+=(x&(-x))){\n\t\t\tupd(T[x],a,v);\n\t\t}\n\t}\n\tint ask(int x,int c,int d){//\u6811\u5957\u6811\u67e5\u8be2\n\t\tint ret=0;\n\t\tfor(;x;x-=(x&(-x)))ret+=query(T[x],c,d);\n\t\treturn ret;\n\t}\n\tvoid prep(){\n\t\tfor(int i=1;i<=n;++i)T[i]=++tot;\n\t\tfor(int i=1;i<=n;++i)add(ai[i].id,ai[i].a,1);\n\t}\n}\n\nnamespace Sub2{// d>b chk b\n\tint ch[maxm][2],siz[maxm],T[maxn],tot;\n\tvoid upd(int rt,int a,int b,int v){//\u60c5\u51b52\u7684\u63d2\u5165\n\t\t++b;//\u8fd9\u4e2a\u7ec6\u8282\u4e0e\u4e0a\u9762\u7684\u540c\u7406\n\t\tint p=rt,da,db;\n\t\tfor(int i=23;~i;--i){\n\t\t\tda=((a>>i)&1);db=((b>>i)&1);\n\t\t\tif(db){\n\t\t\t\tif(!ch[p][da])ch[p][da]=++tot;\n\t\t\t\tif(!ch[p][da^1])ch[p][da^1]=++tot;\n\t\t\t\tsiz[ch[p][da]]+=v;//\u8bb0\u5f55\u8d21\u732e\n\t\t\t\tp=ch[p][da^1];\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(!ch[p][da])ch[p][da]=++tot;\n\t\t\t\tp=ch[p][da];\n\t\t\t}\n\t\t}\n\t}\n\tint query(int rt,int c){//\u60c5\u51b52\u7684\u67e5\u8be2\n\t\tint p=rt,ret=0,dir;\n\t\tfor(int i=23;~i;--i){\n\t\t\tdir=((c>>i)&1);\n\t\t\tif(!ch[p][dir])break;\n\t\t\tp=ch[p][dir];ret+=siz[p];//\u7d2f\u52a0\u8d21\u732e\n\t\t}\n\t\treturn ret;\n\t}\n\tvoid add(int x,int a,int b,int v){\n\t\tfor(;x<=n;x+=(x&(-x))){\n\t\t\tupd(T[x],a,b,v);\n\t\t}\n\t}\n\tint ask(int x,int c){\n\t\tint ret=0;\n\t\tfor(;x;x-=(x&(-x)))ret+=query(T[x],c);\n\t\treturn ret;\n\t}\n\tvoid prep(){\n\t\tfor(int i=1;i<=n;++i)T[i]=++tot;\n\t}\n}\n//\u5176\u5b9e\u4e24\u4e2a\u60c5\u51b5\u7684\u4ee3\u7801\u5341\u5206\u7c7b\u4f3c\uff0c\u7b2c\u4e00\u4e2a\u7684\u63d2\u5165\u4e0e\u7b2c\u4e8c\u4e2a\u7684\u8be2\u95ee\u51e0\u4e4e\u4e00\u6837\uff0c\u7b2c\u4e00\u4e2a\u7684\u8be2\u95ee\u4e0e\u7b2c\u4e8c\u4e2a\u7684\u63d2\u5165\u51e0\u4e4e\u4e00\u6837\uff0c\nsigned main(){\n\t#ifndef local\n\t\tfile(\"island\");\n\t#endif\n\tread(n);read(m);\n\tfor(int i=1;i<=n;++i){\n\t\tread(ai[i].a);read(ai[i].b);ai[i].id=i;\n\t}\n\tfor(int i=1;i<=m;++i){\n\t\tread(qi[i].l);read(qi[i].r);read(qi[i].c);read(qi[i].d);qi[i].id=i;\n\t}\n\tsort(ai+1,ai+n+1);\n\tsort(qi+1,qi+m+1);\n\t\n\tSub1::prep();\n\tSub2::prep();\n\tfor(int i=1,j=1;i<=m;++i){\n\t\twhile(j<=n&&ai[j].b<qi[i].d){//two pointers\u626b\u63cf\n\t\t\tSub1::add(ai[j].id,ai[j].a,-1);\n\t\t\tSub2::add(ai[j].id,ai[j].a,ai[j].b,1);\n\t\t\t++j;\n\t\t}\n\t\tint t1=Sub1::ask(qi[i].r,qi[i].c,qi[i].d);\n\t\tint t2=Sub1::ask(qi[i].l-1,qi[i].c,qi[i].d);\n\t\tint t3=Sub2::ask(qi[i].r,qi[i].c);\n\t\tint t4=Sub2::ask(qi[i].l-1,qi[i].c);\n\t\tans[qi[i].id]=(t1-t2)+(t3-t4);//\u4ee3\u4ef7\u76f8\u51cf\uff0c\u7edf\u8ba1\u603b\u548c\n\t}\n\tfor(int i=1;i<=m;++i)printf(\"%d\\n\",ans[i]);\n\t\n\tfclose(stdin);\n\tfclose(stdout);\n\treturn 0;\n}\n```\n`cdq\u5206\u6cbb` \u5957 `trie`\uff08luogu\u6c11\u95f4\u6570\u636e\u80fd AC\uff09\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define maxn 1000005\n#define maxm 10000005\n#define inf 0x3f3f3f3f\n#define LL long long\n#define ull unsigned long long\n#define ldb long double\n#define mod 1000000007\n#define eps 1e-9\n#define local\nvoid file(string s){freopen((s+\".in\").c_str(),\"r\",stdin);freopen((s+\".out\").c_str(),\"w\",stdout);}\ntemplate <typename Tp> void read(Tp &x){\n\tint fh=1;char c=getchar();x=0;\n\twhile(c>'9'||c<'0'){if(c=='-'){fh=-1;}c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<1)+(x<<3)+(c&15);c=getchar();}x*=fh;\n}\nint n,m,nm;\n\nstruct Oper{\n\tint id,ps,typ,a,b,c,d;//\u4e3a\u4e86\u80fd\u591fcdq\uff0c\u8fd9\u91cc\u505a\u4e86\u6bd4\u8f83\u5927\u7684\u6539\u7248\n\tbool operator <(Oper y)const{\n\t\tif(ps==y.ps){\n\t\t\tif(!typ||!y.typ)return !typ;\n\t\t\telse return typ<y.typ;\n\t\t}\n\t\telse return ps<y.ps;\n\t}\n};\nbool cmp1(Oper x,Oper y){\n\treturn x.b<y.b;\n}\nOper ai[maxn];\n\nint ans[maxn];\n\nnamespace Sub1{//d<b  chk d\n\tint ch[maxm][2],siz[maxm],RT,tot;\n\tvoid upd(int x,int v){\n\t\tint p=RT,dir;\n\t\tfor(int i=23;~i;--i){\n\t\t\tdir=((x>>i)&1);\n\t\t\tif(!ch[p][dir])ch[p][dir]=++tot;\n\t\t\tp=ch[p][dir];\n\t\t\tsiz[p]+=v;\n\t\t}\n\t}\n\tint query(int c,int d){\n\t\t++d;\n\t\tint ret=0,p=RT,dc,dd;\n\t\tfor(int i=23;~i;--i){\n\t\t\tdc=((c>>i)&1);dd=((d>>i)&1);\n\t\t\tif(dd){\n\t\t\t\tret+=siz[ch[p][dc]];\n\t\t\t\tp=ch[p][dc^1];\n\t\t\t}\n\t\t\telse p=ch[p][dc];\n\t\t\tif(!p)break;\n\t\t}\n\t\treturn ret;\n\t}\n\tvoid prep(){RT=tot=1;}\n}\n\nnamespace Sub2{// d>b chk b\n\tint ch[maxm][2],siz[maxm],RT,tot;\n\tvoid upd(int a,int b,int v){\n\t\t++b;\n\t\tint p=RT,da,db;\n\t\tfor(int i=23;~i;--i){\n\t\t\tda=((a>>i)&1);db=((b>>i)&1);\n\t\t\tif(db){\n\t\t\t\tif(!ch[p][da])ch[p][da]=++tot;\n\t\t\t\tif(!ch[p][da^1])ch[p][da^1]=++tot;\n\t\t\t\tsiz[ch[p][da]]+=v;\n\t\t\t\tp=ch[p][da^1];\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(!ch[p][da])ch[p][da]=++tot;\n\t\t\t\tp=ch[p][da];\n\t\t\t}\n\t\t}\n\t}\n\tint query(int c){\n\t\tint p=RT,ret=0,dir;\n\t\tfor(int i=23;~i;--i){\n\t\t\tdir=((c>>i)&1);\n\t\t\tif(!ch[p][dir])break;\n\t\t\tp=ch[p][dir];ret+=siz[p];\n\t\t}\n\t\treturn ret;\n\t}\n\tvoid prep(){RT=tot=1;}\n}\n//\u4e24\u4e2a\u60c5\u51b5\u4e0e\u6811\u5957\u6811\u505a\u6cd5\u51e0\u4e4e\u4e00\u6a21\u4e00\u6837\uff0c\u552f\u4e00\u7684\u4e0d\u540c\u662f\u53ea\u6709\u4e00\u68f5\u6811\uff0c\u6ca1\u6709\u5916\u5c42\u7684\u6811\u72b6\u6570\u7ec4\u7ed3\u6784\nvoid cdq(int l,int r){\n\tif(l==r)return;\n\tint mid=((l+r)>>1);\n\tcdq(l,mid);cdq(mid+1,r);\n\tsort(ai+l,ai+mid+1,cmp1);sort(ai+mid+1,ai+r+1,cmp1);//\u8fd9\u91cc\u53ef\u4ee5\u5199\u5f52\u5e76\u4f18\u5316\u5e38\u6570\n\tfor(int i=l;i<=mid;++i){\n\t\tif(!ai[i].typ){\n\t\t\tSub1::upd(ai[i].a,1);\n\t\t}\n\t}\n\tint j=l;\n\tfor(int i=mid+1;i<=r;++i){\n\t\twhile(j<=mid&&ai[j].b<ai[i].d){//\u540c\u6837 two pointers\u8ba1\u7b97\u8d21\u732e\n\t\t\tif(!ai[j].typ){\n\t\t\t\tSub1::upd(ai[j].a,-1);\n\t\t\t\tSub2::upd(ai[j].a,ai[j].b,1);\n\t\t\t}\n\t\t\t++j;\n\t\t}\n\t\tif(ai[i].typ){\n\t\t\tint t1=Sub1::query(ai[i].c,ai[i].d);\n\t\t\tint t2=Sub2::query(ai[i].c);\n\t\t\tans[ai[i].id]+=ai[i].typ*(t1+t2);//\u56e0\u4e3a\u8be2\u95ee\u7684[l,r]\u62c6\u89e3\uff0c\u8fd9\u91cc\u8981\u4e58\u4e0a\u7cfb\u6570\n\t\t}\n\t}\n\tfor(int i=l;i<j;++i){//\u8bb0\u5f97 \u5168 \u90e8 \u6e05 \u7a7a\n\t\tif(!ai[i].typ){\n\t\t\tSub2::upd(ai[i].c,ai[i].d,-1);\n\t\t}\n\t}\n\tfor(int i=j;i<=mid;++i){\n\t\tif(!ai[i].typ){\n\t\t\tSub1::upd(ai[i].a,-1);\n\t\t}\n\t}\n}\n\nsigned main(){\n\t#ifndef local\n\t\tfile(\"island\");\n\t#endif\n\tread(n);read(m);\n\tfor(int i=1,a,b;i<=n;++i){\n\t\tread(a);read(b);\n\t\tai[++nm]=(Oper){i,i,0,a,b,a,b};\n\t}\n\tfor(int i=1,l,r,c,d;i<=m;++i){\n\t\tread(l);read(r);read(c);read(d);\n\t\tai[++nm]=(Oper){i,r,1,c,d,c,d};\n\t\tai[++nm]=(Oper){i,l-1,-1,c,d,c,d};\n\t}\n\tsort(ai+1,ai+nm+1);\n\tSub1::prep();Sub2::prep();\n\tcdq(1,nm);\n\tfor(int i=1;i<=m;++i)printf(\"%d\\n\",ans[i]);\n\t\n\tfclose(stdin);\n\tfclose(stdout);\n\treturn 0;\n}\n\n```",
        "postTime": 1616851593,
        "uid": 35871,
        "name": "ZigZagKmp",
        "ccfLevel": 7,
        "title": "\u3010\u9898\u89e3 P7470\u3011 [NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669"
    },
    {
        "content": "\u200b\t**\u672c\u7bc7\u9898\u89e3\u7684\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u5176\u5bf9 $b_i<d_j$ \u90e8\u5206\u7684\u5904\u7406\u4e0a\u3002**\n\n#### \u9898\u610f\u7b80\u8ff0\n\n- \u4e00\u884c $n$ \u5bf9\u6570\uff0c\u7b2c $i$ \u5bf9\u6570\u4e3a\u6743\u503c\u5bf9 $<a_i,b_i>$\u3002\n- \u56de\u7b54 $q$ \u4e2a\u8be2\u95ee $<l_j,r_j,c_j,d_j>$\uff0c\u8be2\u95ee\u7684\u662f\u5728 $l_j$ \u5230 $r_j$ \u5185\u6240\u6709\u6570\u5bf9\u4e2d\u6ee1\u8db3 $a_i\\operatorname{xor} c_j\\leq\\min(b_i,d_j)$ \u7684\u6570\u5bf9\u4e2a\u6570\u3002\n- $1\\leq n,q\\leq 10^5$\uff0c$1\\leq l_j\\leq r_j\\leq n$\uff0c$0\\leq a_i, b_i, c_j$, $d_j\\leq 2^{24} - 1$\u3002\n\n#### \u89e3\u6cd5\n\n\u200b\t\u5148\u8003\u8651\u4e00\u4e2a\u8be2\u95ee\u600e\u4e48\u6c42\u3002\n\n\u200b\t\u770b\u5230\u5f02\u6216\u5c31\u77e5\u9053\u5927\u6982\u662f\u8981\u5efa 0-1 trie \u7684\u3002\u5bf9\u4e8e\u4e00\u4e2a\u8be2\u95ee\uff0c\u5206 $b_i\\geq d_j$ \u548c $b_i<d_j$ \u4e24\u79cd\u60c5\u51b5\u8003\u8651\u3002\n\n\u200b\t\u5bf9\u4e8e $b_i\\geq d_j$ \u7684\u60c5\u51b5\uff0c\u8981\u6c42\u5373\u4e3a $a_i\\operatorname{xor} c_j\\leq d_j$ \uff0c\u4ee5 $a_i$ \u4e3a\u6743\u503c\u5efa\u51fa\u5e8f\u5217\u7684 0-1 trie\u3002\n\n\u200b\t\u4ee4 $c_j$ \u4ece\u9ad8\u4f4d\u5f80\u4f4e\u4f4d\u8d70\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u8282\u70b9\uff08\u5047\u8bbe $c_j$ \u5f53\u524d\u4f4d\u4e3a $0$\uff09\u6709 $0$ \u548c $1$ \u4e24\u4e2a\u513f\u5b50\uff1a\u82e5 $d_j$ \u5f53\u524d\u4f4d\u4e3a $1$\uff0c\u5219 $0$ \u513f\u5b50\u53ca\u5176\u5b50\u6811\u4e00\u5b9a\u53ef\u884c\uff0c$1$ \u513f\u5b50\u53ef\u80fd\u53ef\u884c\uff0c\u5411 $1$ \u9012\u5f52\uff1b\u53cd\u4e4b $1$ \u513f\u5b50\u4e00\u5b9a\u4e0d\u53ef\u884c\uff0c\u5411 $0$ \u9012\u5f52\u3002\u8fd9\u4e00\u90e8\u5206\u662f 0-1 trie \u7ecf\u5178\u95ee\u9898\uff0c\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u200b\t\u5bf9\u4e8e $b_i< d_j$ \u7684\u60c5\u51b5\uff0c\u8981\u6c42\u5373\u4e3a $a_i\\operatorname{xor} c_j\\leq b_i$ \u3002\n\n\u200b\t\u5206\u6790\u4e00\u4e0b\u5404\u79cd\u60c5\u51b5\uff0c\u8fd9\u91cc\u8fd8\u662f\u5047\u8bbe $c_j$ \u5f53\u524d\u4f4d\u4e3a $0$\uff1a\n\n- $a_i$ \u5f53\u524d\u4f4d\u4e3a $0$\uff0c$b_i$ \u5f53\u524d\u4f4d\u4e3a $0$\uff1a\u53ef\u80fd\u53ef\u884c\uff0c\u9700\u5411\u4e0b\u9012\u5f52\u3002\n- $a_i$ \u5f53\u524d\u4f4d\u4e3a $0$\uff0c$b_i$ \u5f53\u524d\u4f4d\u4e3a $1$\uff1a**\u4e00\u5b9a\u53ef\u884c**\uff0c\u5b50\u6811\u5168\u90e8\u53ef\u884c\u3002\n- $a_i$ \u5f53\u524d\u4f4d\u4e3a $1$\uff0c$b_i$ \u5f53\u524d\u4f4d\u4e3a $0$\uff1a**\u4e00\u5b9a\u4e0d\u53ef\u884c**\uff0c\u5b50\u6811\u5168\u90e8\u4e0d\u53ef\u884c\u3002\n- $a_i$ \u5f53\u524d\u4f4d\u4e3a $1$\uff0c$b_i$ \u5f53\u524d\u4f4d\u4e3a $1$\uff1a\u53ef\u80fd\u53ef\u884c\uff0c\u9700\u5411\u4e0b\u9012\u5f52\u3002\n\n\u200b\t\u89c2\u5bdf\u53d1\u73b0\uff1a**\u5f53 $a_i\\operatorname{xor}b_i=0$ \u65f6\u9700\u8981\u5411\u4e0b\u9012\u5f52\uff0c\u5426\u5219\u8981\u4e48\u5168\u53ef\u884c\uff0c\u8981\u4e48\u5168\u4e0d\u53ef\u884c\u3002**\n\n\u200b\t\u5bf9 $c_j$ \u5f53\u524d\u4f4d\u4e3a $1$ \u7684\u60c5\u51b5\u5206\u6790\u7c7b\u4f3c\u3002\n\n\u200b\t**\u4ee5 $a_i\\operatorname{xor}b_i$ \u4e3a\u6743\u503c\u5efa\u51fa\u5e8f\u5217\u7684 0-1 trie**\uff0c\u518d\u5728\u6bcf\u4e2a\u8282\u70b9\u8bb0\u5f55\u5176\u5b50\u6811\u5185 $a_i=0$ \u548c $1$ \u7684\u6570\u7684\u4e2a\u6570\u3002\u67e5\u8be2\u65f6\u4ee4 $c_j$ \u4ece\u9ad8\u4f4d\u5f80\u4f4e\u4f4d\u8d70\uff0c\u6309\u4e0a\u9762\u7684\u8ba8\u8bba\u505a\u5373\u53ef\u3002\n\n\u200b\t\u518d\u8003\u8651\u539f\u95ee\u9898\u3002\u6309 $b_i,d_j$ \u6392\u5e8f\uff0c\u987a\u7740\u626b\u4e00\u904d\uff0c\u5206\u5757\u7ef4\u62a4\u4e24\u7ec4 trie \u6811\uff1a\u4e00\u7ec4\u662f\u5173\u4e8e $b_i\\geq d_j$ \u7684\uff0c\u53e6\u4e00\u7ec4\u662f\u5173\u4e8e $b_i< d_j$ \u7684\uff0c\u626b\u7684\u65f6\u5019\u5728 trie \u4e0a\u52a8\u6001\u52a0\u70b9\u5220\u70b9\u5373\u53ef\u3002\n\n\u200b\t\u8bbe\u5757\u957f\u4e3a $B$\uff0c\u503c\u57df\u4e3a $A$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log A+Q(\\frac{n}{B}\\log A+B))$\u3002$n,Q$ \u540c\u7ea7\uff0c\u7406\u8bba\u53d6 $B=\\sqrt{n\\log n}$\uff0c\u5b9e\u8df5\u4e2d\u8bbe $B=2000\\sim 3000$ \u65f6\u6700\u4f18\u3002\u7a7a\u95f4 $O(n\\log A)$\u3002\n\n\u200b\t**\u8f83\u5c0f\u7684\u5e38\u6570\u4f7f\u5f97\u5206\u5757\u505a\u6cd5\u7684\u901a\u8fc7\u6210\u4e3a\u53ef\u80fd\u3002**\n\n\u200b\t**CDQ \u5206\u6cbb\u4e4b\u7c7b\u7684\u505a\u6cd5\uff08\u4f3c\u4e4e\uff09\u4e5f\u53ef\u4ee5\u7c7b\u4f3c\u5730\u5957\u7528**\u3002\u6309 $b_i,d_j$ \u6392\u5e8f\uff0c\u5206\u6cbb\u65f6\u5de6\u533a\u95f4\u5bf9\u53f3\u533a\u95f4\u7684\u8d21\u732e\u5373\u6240\u6709 $b_i$ \u7684\u63d2\u5165\uff08$b_i< d_j$ \u90e8\u5206\u7684 trie \u6811\u4e0a\uff09\u548c\u5220\u9664\uff08 $b_i\\geq d_j$ \u7684 trie \u6811\u4e0a\uff09\u3002\u5176\u5b83\u9898\u89e3\u91cc\u6709\u8fd9\u65b9\u9762\u7684\u8be6\u7ec6\u8bb2\u89e3\u3002\n\n\u200b\t\u4e0d\u6d4e\u7684\u8bdd\u628a\u5206\u5757\uff08\u65f6\u95f4\u88ab\u5361\uff09\u548c\u6811\u5957\u6811\uff08\u7a7a\u95f4\u88ab\u5361\uff09\u7ed3\u5408\u4e00\u4e0b\u628a\u5757\u957f\u8c03\u5927\u4e00\u70b9\u4e5f\u80fd\u8fc7\u3002\n\n\u200b\t\u653e\u4e00\u4e0b\u5173\u952e\u4f4d\u7f6e\u7684\u6e90\u4ee3\u7801\uff08$b_i< d_j$ \u90e8\u5206\u7684 trie \u6811\u5efa\u7acb\u4e0e\u67e5\u8be2\uff09\uff1a\n\n```\nvoid trieadd1(int u,int aa,int bb,int np){\n\tif(!np)return;\n\tint ng=(((aa^bb)&(1<<(np-1)))>>(np-1));\n\tif(!son[u][ng])son[u][ng]=++pb;\n\tdq[son[u][ng]][(aa&(1<<np-1))>>(np-1)]++;\n\ttrieadd1(son[u][ng],aa,bb,np-1);\n}\nint triereq1(int u,int x,int np){\n\tif(!u)return 0;\n\tif(!np)return dq[u][0]+dq[u][1];\n\tint ng=((x&(1<<(np-1)))>>(np-1));\n\treturn triereq1(son[u][ng],x,np-1)+dq[son[u][ng^1]][ng];\n}\n```\n\n",
        "postTime": 1616843975,
        "uid": 259028,
        "name": "Aly_",
        "ccfLevel": 9,
        "title": "P7470 [NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669 \u9898\u89e3"
    },
    {
        "content": "~~\u6ca1\u6709\u4eba\u5728\u6811\u4e0a\u732b\u4e00\u732b\u5417~~\n\n## Part 0\n$\\max~d\\leq \\min~b$\n\n\u5373\u5bf9\u4e8e\u6240\u6709\u7684\u8be2\u95ee,\u6211\u4eec\u90fd\u6ee1\u8db3d\u53d6\u5230\u8fd9\u4e24\u8005\u4e2d\u7684\u6700\u5c0f\u503c\n\n\u53ef\u4ee5\u53d1\u73b0\u6211\u4eec\u9700\u8981\u6ee1\u8db3\u7684\u6761\u4ef6\u5c31\u662f\n\n$a\\oplus c<d$\n\n\u5176\u4e2dc,d\u5bf9\u4e8e\u4e00\u6b21\u8be2\u95ee\u6765\u8bf4\u90fd\u662f\u5df2\u77e5\u7684,\u90a3\u4e48\u6211\u4eec\u4e0d\u96be\u60f3\u5230\u7528\u4e00\u4e2a\u65b9\u6cd5\u5feb\u901f\u7ef4\u62a4a\n\n\u548c\u5f02\u6216\u6709\u5173,\u540c\u65f6\u53c8\u662f\u6bd4\u8f83\u5927\u5c0f,\u53ef\u4ee5\u8003\u865101trie\n\n\u6211\u4eec\u8fd8\u662f\u4ece\u9ad8\u5230\u5e95\u7684\u8003\u8651\u6bcf\u4e00\u4f4d,\u5148\u63d2\u5165\u533a\u95f4\u4e2d\u6bcf\u4e00\u4e2aa,\u8003\u8651c\u5bf9\u4e8e01trie\u7684\u5f71\u54cd\u5c31\u76f8\u5f53\u4e8e**\u5bf9\u4e8ec\u4e3a1\u7684\u4e3ai,\u4ea4\u6362\u6240\u6709\u7b2ci-1\u5c42\u7684\u8282\u70b9\u5de6\u53f3\u513f\u5b50**,\u8fd9\u4e2a\u4e0d\u96be\u5728trie\u9012\u5f52\u8fc7\u7a0b\u4e2d\u7b80\u5355\u5904\u7406\n\n\u518d\u8003\u8651$<d$\u7684\u6761\u4ef6,\u6240\u6709$a\\oplus c<d$\u7684\u4fe1\u606f\u4e00\u5b9a\u6ee1\u8db3\u524dk\u4f4d$a\\oplus c$\u548cd\u76f8\u540c,\u800c\u5728\u7b2ck+1\u4f4d$a\\oplus c$\u4e3a0\u800cd\u7684\u8be5\u4f4d\u4e3a1\n\n\u8fd9\u4e5f\u5c31\u544a\u8bc9\u6211\u4eec\u53ef\u4ee5\u572801trie\u4e0a\u6cbf\u7740d\u7684\u4e8c\u8fdb\u5236\u4f4d\u8d70,\u540c\u65f6\u5bf9\u4e8ed\u67d0\u4e00\u4f4d\u4e3a1\u7684,\u9009\u62e9\u54110\u7684\u4e00\u4fa7\u8d70\u7684\u6240\u6709a\u90fd\u4f1a\u88ab\u8ba1\u5165\u7b54\u6848,\u7edf\u8ba1\u5b50\u6811\u548c\u5373\u53ef\n\n## Part 1\n\n$\\max~b\\leq \\min~d$\n\n\u5373\u5bf9\u4e8e\u6240\u6709\u7684\u8be2\u95ee,\u6211\u4eec\u7684b\u603b\u6ee1\u8db3\u53d6\u5230\u4e24\u8005\u4e2d\u7684\u6700\u5c0f\u503c\n\n\u53ef\u4ee5\u53d1\u73b0\u6b64\u65f6\u6bcf\u4e2a\u5143\u7d20\u7684\u4fe1\u606f\u591a\u4e86\u4e00\u7ef4b,**\u4f46\u662f\u6211\u4eec\u67e5\u8be2\u7684\u4fe1\u606f\u53ea\u6709\u4e00\u7ef4c**,\u56e0\u6b64\u53ef\u4ee5\u8003\u8651\u5bf9\u4e8ec\u8fdb\u884c\u7ef4\u62a4\u7b54\u6848\u7684\u503c\n\n\u5177\u4f53\u7684,\u6211\u4eec\u8003\u8651\u63d2\u5165\u4e00\u4e2a\u600e\u6837\u7684c\u624d\u80fd\u6ee1\u8db3$a\\oplus c\\leq b$\u8fd9\u4e2a\u6761\u4ef6,\u4eff\u7167Part0,\u6211\u4eec\u53bb\u4ece\u9ad8\u5230\u5e95\u6bd4\u8f83a\u548cb\u7684\u6bcf\u4e00\u4f4d,\u5e76\u5047\u8bbe\u524dk\u4f4d\u90fd\u76f8\u540c\n\n1. \u5bf9\u4e8e\u7b2ck\u4f4d\u90fd\u4e3a0,\u663e\u7136c\u8fd9\u4e00\u4f4d\u53ea\u6709\u653e0\u4e00\u79cd\u53d6\u503c,\u9012\u5f52\u5de6\u5b50\u6811\u5373\u53ef\n\n2. \u5bf9\u4e8e\u7b2ck\u4f4d\u90fd\u4e3a1,c\u53ef\u4ee5\u9009\u62e9\u653e1,\u6b64\u65f6\u4e4b\u540ea\u4e00\u5b9a\u5c0f\u4e8eb,\u90a3\u4e48\u4e0d\u9700\u8981\u9012\u5f52\u53f3\u5b50\u6811,\u53ea\u9700\u8981\u8003\u8651c\u653e0\u4e4b\u540e\u9012\u5f52\u5de6\u5b50\u6811\u5373\u53ef\n\n3. \u5bf9\u4e8e\u7b2ck\u4f4da\u4e3a1b\u4e3a0,c\u53ef\u4ee5\u9009\u62e9\u653e0,\u540c\u7406\u65e0\u9700\u9012\u5f52,\u53ea\u9700\u8981\u9012\u5f52\u53f3\u5b50\u6811\n\n4. \u5bf9\u4e8e\u7b2ck\u4f4da\u4e3a1b\u4e3a0,\u663e\u7136c\u53ea\u80fd\u653e1,\u5426\u5219$b<a$\n\n\u90a3\u4e48\u6211\u4eec\u5bf9\u4e8e\u4e00\u4e2a\u5143\u7d20,\u5efa\u7acb\u4ed6\u7684\u6ee1\u8db3\u6761\u4ef6\u7684C\u7684\u8fc7\u7a0b\u663e\u7136\u662f$O(\\log W)$\n\n\u4e8e\u662f\u6211\u4eec\u6309\u4e0a\u8ff0\u8ba8\u8bba\u7684\u65b9\u6cd5\u7ef4\u62a4\u51fa\u8fd9\u6837\u4e00\u9897trie,\u8868\u793a\u67d0\u4e00\u4e2ac\u4f1a\u4ea7\u751f\u591a\u5c11\u5408\u6cd5\u7684\u5143\u7d20\u5373\u53ef\n\n## Part3\n\n\u4e0a\u8ff0\u8fc7\u7a0b\u5747\u6ca1\u6709\u8003\u8651\u533a\u95f4\u8fd9\u4e24\u7ef4\u4fe1\u606f,\u4f46\u662f\u4ed6\u4eec\u4e5f\u662f\u6700\u597d\u8003\u8651\u7684,\u56e0\u4e3a\u4fe1\u606f\u6ee1\u8db3\u53ef\u51cf\u6027,\u6240\u4ee5\u53ea\u9700\u8981\u5efa\u7acb\u53ef\u6301\u4e45\u5316trie\u7136\u540e\u5bf9\u5e94\u7684\u5728$root_r,root_{l-1}$\u67e5\u8be2\u5373\u53ef\n\n## Part4\n\n\u5168\u5c40\u600e\u4e48\u505a?\n\n\u6309\u7167b\u6392\u5e8f,\u4e8c\u5206\u67e5\u627e\u6700\u540e\u4e00\u4e2a\u5c0f\u4e8e\u7b49\u4e8ed\u7684\u4f4d\u7f6e,\u4e8e\u662f\u5b83\u524d\u9762\u7684\u524d\u7f00\u5c31\u662f\u6ee1\u8db3Part0\u89e3\u51b3\u7684\u95ee\u9898,\u800c\u5269\u4e0b\u7684\u540e\u7f00\u5c31\u662f\u6ee1\u8db3Part1\u89e3\u51b3\u7684\u95ee\u9898\n\n\u533a\u95f4\u600e\u4e48\u505a?\n\n\u96be\u70b9\u5728\u4e8e\u600e\u4e48\u533a\u5206\u8fd9\u4e24\u7c7b\u64cd\u4f5c,\u5176\u5b9e\u5c31\u662f\u600e\u4e48\u5bf9\u4e8eb\u6392\u5e8f\n\n\u6211\u4eec\u77e5\u9053\u6709\u4e00\u7c7b\u7ecf\u5178\u7684~~\u4e0d\u51fa\u540d~~\u6570\u636e\u7ed3\u6784\u53eb\u505a\u5f52\u5e76\u6811,\u6811\u4e0a\u7684\u6bcf\u4e2a\u8282\u70b9\u4fdd\u5b58\u4e86\u533a\u95f4\u6240\u6709\u7684\u6570\u6392\u597d\u5e8f\u540e\u7684\u6570\u7ec4\n\n\u76f4\u63a5\u8fd9\u6837\u7c7b\u4f3c\u7684\u505a,\u6392\u5e8f\u540e\u5efa\u7acb\u533a\u95f4\u53ef\u6301\u4e45\u5316trie\u597d\u50cf\u5c31\u597d\u4e86!\n\n\u4f46\u662f\u4ed4\u7ec6\u4e00\u60f3\u8fd9\u4e2a\u7a7a\u95f4\u662f$O(n\\log n\\log w)$,\u6b7b\u6d3b\u4e0d\u53ef\u80fd\u8fc7\u7684\u53bb\u7684\n\n\u4e00\u4e2a\u6765\u81ea\u5206\u5757\u7684\u7ecf\u5178\u7684\u5361\u7a7a\u95f4\u6280\u5de7\u662f\u6211\u4eec\u5bf9\u4e8e\u6240\u6709\u8be2\u95ee\u6302\u5230\u6bcf\u4e2a\u4e32\u4e0a,\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e00\u5757\u90fd\u8dd1\u4e00\u904d,\u7136\u540e\u56de\u7b54\u6240\u6709\u8be2\u95ee\n\n\u90a3\u4e48\u672c\u9898\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8fd9\u6837\u7684\u6280\u5de7,\u79bb\u7ebf\u6240\u6709\u8be2\u95ee,\u7136\u540e\u6302\u5230\u5bf9\u5e94\u7684\u533a\u95f4\u4e0a,\u6bcf\u6b21\u6211\u4eec\u5c06\u533a\u95f4\u6392\u5e8f\u7136\u540e\u5efa\u7acb\u53ef\u6301\u4e45\u5316trie\u56de\u7b54\u4e0a\u9762\u6240\u6709\u8be2\u95ee\u5373\u53ef\n\n\u590d\u6742\u5ea6\u7b49\u4ef7\u4e8e\u7ebf\u6bb5\u6811\u8282\u70b9\u957f\u5ea6\u4e4b\u548c$*\\log w$,\u4e5f\u5c31\u662f$O(n\\log n\\log w)$\n\n\u4e0d\u8fc7\u5176\u5b9e\u8fd9\u90e8\u5206\u5e76\u4e0d\u662f\u91cd\u70b9,\u89e3\u51b3\u524d\u4e24\u4e2aPart,\u540e\u9762\u7684\u5c31\u90fd\u662f\u7eaf\u5957\u8def\u4e86\n\n\u732b\u6811\u5c31\u662f\u7c7b\u4f3c\u7684\u5904\u7406\u6bcf\u4e2a\u533a\u95f4\u7684\u4fe1\u606f\u7136\u540e\u56de\u7b54\u8be2\u95ee,\u4e0d\u8fc7\u548c\u8fd9\u4e2a\u9898\u786e\u5b9e\u6ca1\u5173\u7cfb,~~\u6211\u53ea\u662f\u60f3\u8868\u793a\u4e00\u4e0b\u8fd9\u4e2a\u79bb\u7ebf\u7684\u601d\u60f3...~~\n\n```cpp\n#include<bits/stdc++.h>\n#define vi vector<int>\n#define pb push_back\nusing namespace std;\nconst int MAXN = 5e5 + 7;\n\nint n, m;\nstruct rec {\n\tint a, b;\n\trec(int A = 0, int B = 0): a(A), b(B) {};\n\tbool operator<(const rec &x)const {\n\t\treturn b < x.b;//\u6309\u7167b\u6392\u5e8f\n\t}\n} a[MAXN];\n\nnamespace fastIO {\n#define BUF_SIZE (1<<20)\n\tstatic char buf[BUF_SIZE], *p1 = buf, *pend = buf;\n\tinline char nc() {\n\t\tif(p1 == pend) {\n\t\t\tp1 = buf;\n\t\t\tpend = buf + fread(buf, 1, BUF_SIZE, stdin);\n\t\t}\n\t\treturn *p1++;\n\t}\n\tinline int read() {\n\t\tint x = 0;\n\t\tchar s = nc();\n\t\tfor(; !isdigit(s); s = nc());\n\t\tfor(; isdigit(s); s = nc())x = (x << 1) + (x << 3) + s - '0';\n\t\treturn x;\n\t}\n}\nusing namespace fastIO;\n\nconst int MAXT = 5e6 + 7;\nint root[MAXN], root2[MAXN];\nstruct seg {//\u53ef\u6301\u4e45\u531601trie!!\n\tint T, ls[MAXT], rs[MAXT], sum[MAXT];\n\tinline void build(int &x, int y) {\n\t\tif(!x || x == y) {\n\t\t\tx = ++T;\n\t\t\tls[x] = ls[y];\n\t\t\trs[x] = rs[y];\n\t\t\tsum[x] = sum[y];\n\t\t}\n\t}\n\tinline void mdf2(int &x, int y, int dep, int p, int q) {\n\t\tif(x == y || !x) {\n\t\t\tx = ++T;\n\t\t\tls[x] = ls[y];\n\t\t\trs[x] = rs[y];\n\t\t\tsum[x] = sum[y];\n\t\t}\n\t\tif(dep == 0) {\n\t\t\tsum[x]++;\n\t\t\treturn ;\n\t\t}//\u4f60\u8d62\u4e86\n\t\tif((p >> (dep - 1) & 1) && (q >> (dep - 1) & 1)) {\n\t\t\tbuild(rs[x], rs[y]);\n\t\t\tsum[rs[x]]++;//\u653e1\u76f4\u63a5\u5c0f\u4e8e\n\t\t\tmdf2(ls[x], ls[y], dep - 1, p, q);\n\t\t} else if((p >> (dep - 1) & 1) && !(q >> (dep - 1) & 1)) {\n\t\t\tmdf2(rs[x], rs[y], dep - 1, p, q);//\u5411\u53f3\u9012\u5f52,\u6211\u53ea\u80fd\u653e1\n\t\t} else if(!(p >> (dep - 1) & 1) && (q >> (dep - 1) & 1)) {\n\t\t\tbuild(ls[x], ls[y]);\n\t\t\tsum[ls[x]]++;//\u653e0\u76f4\u63a5\u5c0f\u4e8e\n\t\t\tmdf2(rs[x], rs[y], dep - 1, p, q);\n\t\t} else {//\u90fd\u662f0\u53ea\u80fd\u653e0\n\t\t\tmdf2(ls[x], ls[y], dep - 1, p, q);\n\t\t}\n\t}\n\tinline void mdf(int &x, int y, int dep, int p) {\n\t\tif(x == y || !x) {\n\t\t\tx = ++T;\n\t\t\tls[x] = ls[y];\n\t\t\trs[x] = rs[y];\n\t\t\tsum[x] = sum[y];\n\t\t}\n\t\tsum[x]++;\n\t\tif(dep == 0)return;//\u6700\u4f4e\u4f4d\n\t\tif(!(p >> (dep - 1) & 1))mdf(ls[x], ls[y], dep - 1, p);\n\t\telse mdf(rs[x], rs[y], dep - 1, p);\n\t}\n\n\tinline int qry2(int x, int dep, int p) {//\u7edf\u8ba1c\u4e00\u8def\u7684\u8d21\u732e\n\t\tif(!x)return 0;\n\t\tif(dep == 0)return sum[x];\n\t\tif(p >> (dep - 1) & 1) { //\u8fd9\u4e00\u4f4d\u4e3a1\n\t\t\treturn sum[x] + qry2(rs[x], dep - 1, p);\n\t\t} else {//\u4e3a0!\n\t\t\treturn sum[x] + qry2(ls[x], dep - 1, p);\n\t\t}\n\t}\n\tinline int qry(int x, int dep, int p, int c) {//\u8ba1\u7b97\u5f02\u6216c\u540e\u5c0f\u7b49\u4e8ep\u7684\n\t\tif(!x)return 0;\n\t\tif(dep == 0)return sum[x];\n\t\tif(p >> (dep - 1) & 1) { //\u8fd9\u4e00\u4f4d\u4e3a1\n\t\t\tif(c >> (dep - 1) & 1)return sum[rs[x]] + qry(ls[x], dep - 1, p, c);\n\t\t\telse return sum[ls[x]] + qry(rs[x], dep - 1, p, c);\n\t\t} else {//\u4e3a0!\n\t\t\tif(c >> (dep - 1) & 1)return qry(rs[x], dep - 1, p, c);\n\t\t\telse return qry(ls[x], dep - 1, p, c);\n\t\t}\n\t}\n\tinline void init() {\n\t\tT = 0;\n\t\tsum[0] = ls[0] = rs[0] = 0;\n\t}\n} T1, T2;\n\nint l[MAXN], r[MAXN], c[MAXN], d[MAXN], ans[MAXN];\nvi v[MAXN];\n\ninline void build(int l, int r) {\n\tsort(a + l, a + r + 1);\n\tfor(int i = l - 1; i <= r; ++i)root[i] = root2[i] = 0;\n\tT1.init();\n\tfor(int i = l; i <= r; ++i) {\n\t\tT1.mdf(root[i], root[i - 1], 24, a[i].a);\n\t}\n\tT2.init();\n\tfor(int i = l; i <= r; ++i) {\n\t\tT2.mdf2(root2[i], root2[i - 1], 24, a[i].a, a[i].b);\n\t}\n\treturn ;\n}\n\ninline void solveq(int k, int l, int r) {\n\tfor(auto p : v[k]) {\n\t\tint fz = upper_bound(a + l, a + r + 1, rec(0, d[p])) - a - 1;\n\t\tif(fz >= l) {\n\t\t\tans[p] += T2.qry2(root2[fz], 24, c[p]);\n\t\t}\n\t\tif(fz < r) {\n\t\t\tans[p] += T1.qry(root[r], 24, d[p], c[p]) - T1.qry(root[fz], 24, d[p], c[p]);\n\t\t}\n\t}\n\treturn ;\n}\n#define mid ((l+r)>>1)\n\ninline void solve(int k, int l, int r) {\n\tif(l != r) {\n\t\tsolve(k << 1, l, mid);\n\t\tsolve(k << 1 | 1, mid + 1, r);\n\t}\n\tif(!v[k].empty()) {\n\t\tbuild(l, r);\n\t\tsolveq(k, l, r);\n\t}\n\treturn;\n}\n\ninline void addqry(int k, int l, int r, int L, int R, int p) {\n\tif(L <= l && r <= R) {\n\t\tv[k].pb(p);\n\t\treturn ;\n\t}\n\tif(L <= mid)addqry(k << 1, l, mid, L, R, p);\n\tif(R > mid)addqry(k << 1 | 1, mid + 1, r, L, R, p);\n}\n\nint main() {\n\tn = read();\n\tm = read();\n\tfor(int i = 1; i <= n; ++i) {\n\t\ta[i].a = read();\n\t\ta[i].b = read();\n\t}\n\tfor(int i = 1; i <= m; ++i) {\n\t\tl[i] = read();\n\t\tr[i] = read();\n\t\tc[i] = read();\n\t\td[i] = read();\n\t\taddqry(1, 1, n, l[i], r[i], i);\n\t}\n\tsolve(1, 1, n);\n\tfor(int i = 1; i <= m; ++i)\n\t\tprintf(\"%d\\n\", ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1616858338,
        "uid": 76990,
        "name": "loveJY",
        "ccfLevel": 9,
        "title": "P7470 [NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669"
    },
    {
        "content": "~~\u6211\u771f\u7684\u4e0d\u60f3\u8c03\u683c\u5f0f\u554a\u554a~~\n\n> \u7ed9\u5b9a\u4e00\u4e2a\u4e8c\u5143\u7ec4\u5e8f\u5217$(a_i,b_i)$,\u591a\u6b21\u8be2\u95ee\u5f62\u5982$(c_i,d_i)$,\u6c42$i$\u7684\u4e2a\u6570\u4f7f\u5f97$a_i\\bigoplus c_i\\leqslant \\min\\{b_i,d_i\\}$\n\n\u8003\u573a\u4e0a\u5b8c\u5168\u4e0d\u4f1a$b$\u5c0f\u7684\u90e8\u5206\u5206~~\n\n- \u533a\u95f4\u4e3a$[1,n]$\n\n\t- \u6240\u6709\u7684$\\min$\u5747\u7531$d_i$\u53d6\u5230\n\n\t\u7528$c_i$\u5728Trie\u6811\u4e0a\u6e38\u8d70\uff0c\u5047\u8bbe\u8d70\u5230$x$,\u8fd9\u4e2a\u9ad8\u4f4d\u662f$1$\uff0c\u5fc5\u5b9a\u5b58\u5728\u4e00\u8fb9\u4f7f\u8fd9\u4e00\u4f4d\u4e3a$0$,\u7d2f\u52a0\u8fd9\u4e00\u8fb9\u904d\u5386\u6b21\u6570\uff0c\u8d70\u53e6\u4e00\u8fb9\uff0c\u5426\u5219\u9ad8\u4f4d\u4e3a$0$\uff0c\u76f4\u63a5\u8d70\u5f02\u6216\u8d77\u6765\u4e3a$0$\u7684\u90a3\u8fb9\u5373\u53ef\n\n\t- \u6240\u6709\u7684$\\min$\u5747\u7531$b_i$\u53d6\u5230\n\n\t\u8ba9$a_i$\u80fd\u53d6\u5230$\\leqslant b_i$\u7684$c_i$\u5728$\\mathrm{Trie}$\u6811\u4e0a\u662f\u4e00\u4e9b\u4e0d\u4ea4\u7684\u5b50\u6811\u5185\u7684\u6807\u8bb0\u70b9\uff0c\u5177\u4f53\u6765\u8bf4\u8ddf\u4e0a\u4e00\u4e2aSub\u4e00\u6837\u5047\u88c5\u7528$a_i$\u4f5c\u4e3a$c_i$\u6765\u6e38\u8d70\uff0c\u5176\u4e2d\u4f1a\u6d89\u53ca\u5230\u4e00\u4e9b`\u5fc5\u5b9a\u5b58\u5728\u4e00\u8fb9\u4f7f\u8fd9\u4e00\u4f4d\u4e3a 0 `\u7684\u9009\u62e9\uff0c\u628a\u8fd9\u4e9b\u5b50\u6811\u6253\u4e0a\u6807\u8bb0(\u771f\u7684\u6253\u5728\u6839\u5904)\uff0c\u4ee5\u540e\u7528$c_i$\u904d\u5386\u65f6\u7d2f\u52a0\u7ecf\u8fc7\u6807\u8bb0\u5373\u53ef\n   - \u4e00\u822c\u60c5\u51b5\n   \n   \u8003\u8651\u628a$(a,c),(b,d)$\u4e22\u5728\u4e00\u8d77\u6309$b/d$\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\uff0c\u6309\u5e8f\u5904\u7406\u5373\u53ef\n- \u533a\u95f4\u4e3a$[l,r]$\n\t\n    \u9996\u5148\u5dee\u5206\u6389\u8f6c\u4e3a\u524d\u7f00$[1,i]$\uff0c\u7136\u540e\u95ee\u9898\u53d8\u6210\u4e86\u8ba1\u7b97\u987a\u5e8f\u7684\u7ef4\u62a4\uff0c\u4e00\u4e2aNaive\u7684\u60f3\u6cd5\u662f\u4f7f\u7528\u6811\u5957\u6811\uff0c\u8003\u5bdf\u95ee\u9898\u672c\u8d28\u662f\u8981\u8ba9\u6bcf\u4e2a\u8be2\u95ee\u88ab\u51fa\u73b0\u65f6\u95f4\u66f4\u65e9\u7684\u4fee\u6539\u66f4\u65b0\u5230\uff0c\u8fd9\u662f\u4e00\u4e2a\u504f\u5e8f\u95ee\u9898\uff0c\u8003\u8651CDQ\u5206\u6cbb\uff0c\u5177\u4f53\u7684\uff0c\u5148\u6309\u7167$b/d$\u6392\u5e8f\uff0c\u5bf9\u6bcf\u4e2a\u5206\u6cbb\u533a\u95f4\u4e24\u4fa7\u6309\u7167\u4f4d\u7f6e\u6392\u5e8f\uff0c\u4e4b\u540e\u53cc\u6307\u9488\n    - \u5de6\u8fb9\u4fee\u6539\u53f3\u8fb9\u8be2\u95ee :$\\min$\u7531$b_i$\u53d6\u5230\n    - \u53f3\u8fb9\u4fee\u6539\u5de6\u8fb9\u8be2\u95ee :$\\min$\u7531$d_i$\u53d6\u5230\n    \n\t  \u6309\u7167\u6700\u521d\u7684\u624b\u6bb5\u5904\u7406\u5373\u53ef",
        "postTime": 1616836074,
        "uid": 40629,
        "name": "zzw4257",
        "ccfLevel": 0,
        "title": "[NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669\u9898\u89e3"
    },
    {
        "content": "**\u4e0d\u4e00\u5b9a\u6b63\u786e\uff01\u63d0\u4f9b\u4e00\u4e2a\u4e09\u5408\u4e00\u624d\u80fd\u8fc7\u7684\u5206\u5757**\n\n$$ a_i \\ xor\\ c_j \\le min(b_i,d_j)$$ \n\n$$ a_i \\ xor \\ c_j \\le b_i$$\n\n$$ a_i \\ xor \\ c_j \\le d_j$$\n\n$$a_i \\ xor \\ c_j \\le d_j$$ \n\n\u53ef\u4ee5\u8003\u8651 $c_j,d_j=0$ \u90a3\u4e48 $a_i=0$\u3002\n\n$c_j=1,dj=0,ai=1$\u3002\n\n$c_j=0,d_j=1,a_i=1/0$ \u5982\u679c\u9009 $1$ \u7684\u8bdd\u5c31\u63a5\u7740\u8df3\uff0c $0$ \u5c31\u52a0\u4e0a\u5de6\u5b50\u6811\u7684\u6240\u6709\u7684\u5143\u7d20\u4e2a\u6570\u3002\n\n$c_j=1,d_j=1,a_i=1/0$ $0$ \u63a5\u7740\u8df3\uff0c\u52a0\u4e0a $1$ \u90a3\u8fb9\u5b50\u6811\u7684\u5143\u7d20\u4e2a\u6570\u3002\n\n\u7136\u540e\uff0c\u533a\u95f4\u5c31\u53ef\u6301\u4e45\u5316 01-trie\u3002\n\n$$ a_i \\ xor \\ c_j \\le b_i$$\n\n$$ c_j \\ xor \\ a_i \\le b_i$$\n\n$b_i,a_i$ \u4f5c\u4e3a\u8be2\u95ee \u5c31\u4e00\u6837\u8df3 \u7136\u540e\u6574\u4e2a\u5b50\u6811\u53ef\u4ee5\u5c31\u52a0\u8ba1\u6570\u5668 \u4e00\u4e2a\u8be2\u95ee\u7b26\u5408\u7684 $c_j$ \u5c31\u662f $c_j$ \u5230\u6839\u7684\u8def\u5f84\u8ba1\u6570\u5668\u548c\u3002\n\n\u53ef\u4ee5\u53ef\u6301\u4e45\u5316\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $c_j$ \u53bb\u62c6 $[1,r]-[1,l-1]$ \u5c31\u662f\u7b54\u6848\u3002\n\n\u6211\u4eec\u9700\u8981\u4fdd\u8bc1\u67e5\u8be2\u7684\u65f6\u5019 $a_i,b_i$ \u90fd\u5df2\u7ecf\u521a\u521a\u597d\u66f4\u65b0\u5b8c\u6bd5\u4e86\uff0c\u8fd9\u4e2a\u5c06 $a_i,b_i$ \u7684\u52a0\u8ba1\u6570\u5668\u4e5f\u8ba4\u4e3a\u64cd\u4f5c\uff0c\u53f3\u7aef\u70b9\u662f $i$\uff0c\u7136\u540e\u6309\u53f3\u7aef\u70b9\u6392\u5e8f\u5c31\u53ef\u4ee5\u3002\n\n**\u5148\u4fee\u6539\u540e\u8be2\u95ee\uff01**\n\n\u90a3\u4e48\uff0c\u5982\u4f55\u5206\u79bb\u51fa $[L,x],[x+1,R]$ \u4f7f\u5f97 $[L,x]$ \u662f $min\\{b_i\\}\\ge d,i\\in[L,x]$?\n\n\u5b9e\u9645\u4e0a\u76f4\u63a5\u5206\u5757\u5c31\u597d\u4e86\uff0c\u5757\u5185\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u5e76\u4e14\u6211\u4eec\u53ef\u4ee5\u5c06\u8be2\u95ee\u79bb\u7ebf\u6309 $d$ \u6392\uff0c\u8fd9\u6837\u6bcf\u6b21\u5757\u5185 $x$ \u4e0d\u964d\uff0c\u53ef\u4ee5\u53cc\u6307\u9488\u4f18\u5316\u3002\n\n\u7b97\u4e0b\u590d\u6742\u5ea6\uff0c\u4ee4 $T$ \u4e3a\u5757\u957f\u3002\n\n$O(\\dfrac{n}{T}T\\log T+mT+\\dfrac{n}{T}m\\log(\\dfrac{n}{T}m)+\\dfrac{n}{T}m\\log w)$\n\n\u7b2c\u4e00\u4e2a\u4e3a\u9884\u5904\u7406\u5757\u7684\u590d\u6742\u5ea6\uff0c\u7b2c\u4e8c\u4e2a\u4e3a\u5728\u7ebf\u5904\u7406 $d\\le b$ \u7684\u590d\u6742\u5ea6\uff0c\u7b2c\u4e09\u4e2a\u4e3a\u79bb\u7ebf\u5b8c\u64cd\u4f5c+\u6392\u5e8f\u7684\u590d\u6742\u5ea6\uff0c\u56e0\u4e3a\u6709 $\\dfrac{n}{T}$ \u4e2a\u5757\uff0c\u5047\u5982\u6bcf\u6b21\u6bcf\u4e2a\u5757\u90fd\u88ab\u8986\u76d6\u5230\uff0c\u90a3\u4e48\u4f1a\u6709 $m$ \u6b21\u3002\u6700\u540e\u4e00\u4e2a\u662f\u5904\u7406\u8fd9\u4e9b\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u3002\n\n**\u5173\u4e8e\u5757\u957f**\uff0c\u6211\u4eec\u53d1\u73b0\u74f6\u9888\u662f $\\dfrac{n}{T}m\\log(\\dfrac{n}{T}m)$\uff0c\u6240\u4ee5\u6211\u4eec\u8ba9 $T$ \u5c3d\u53ef\u80fd\u5927\uff0c\u5b9e\u6d4b\u5728 $1750$ \u6700\u4f18\u3002\n\n[\u8bc4\u6d4b\u8bb0\u5f55](https://www.luogu.com.cn/record/54653671)\n\n$\\text{Code}$\n\n```cpp\n#include <cstdio>\n#include <algorithm>\n#include <iostream>\n#include <cstring>\n#include <vector>\n#include <cmath>\n#include <queue>\n#include <map>\n\n#define ll long long\n\nusing namespace std;\nint rd() {\n\tint f=1,sum=0; char ch=getchar();\n\twhile(!isdigit(ch)) {if(ch=='-') f=-1;ch=getchar();}\n\twhile(isdigit(ch)) {sum=(sum<<3)+(sum<<1)+ch-'0';ch=getchar();}\n\treturn sum*f;\n}\nll lrd() {\n\tll f=1,sum=0; char ch=getchar();\n\twhile(!isdigit(ch)) {if(ch=='-') f=-1;ch=getchar();}\n\twhile(isdigit(ch)) {sum=(sum<<3)+(sum<<1)+ch-'0';ch=getchar();}\n\treturn sum*f;\n}\nvoid pr(int x) {\n\tif(x<0) {putchar('-');x=-x;}\n\tif(x>9) pr(x/10);\n\tputchar(x%10+'0');\n}\nvoid lpr(ll x) {\n\tif(x<0) {putchar('-');x=-x;}\n\tif(x>9) pr(x/10);\n\tputchar(x%10+'0');\n}\n/*\n\u6709\u533a\u95f4\u4e4b\u540e\u679a\u4e3e\u5757\n\u4e4b\u524d\u5c06\u6240\u6709c\u52a0\u5165trie\n\u8003\u8651\u5757\u6392\u5e8f\u540e\u7684\u533a\u95f4\u6240\u5bf9\u5e94\u7684 \u8fd9\u4e2a\u53ef\u4ee5\u5728\u5206\u5757build\u7684\u65f6\u5019\u5904\u7406\u51fa\u6765 \n*/ \n#define N (int)(1e5+2) \n#define M 80\n#define il inline\n\nint ans[N],son[2][N*30],sum[N*30];\nint cnt[N],rid[N],a[N],b[N],C[N],L[M],R[M],id[N];\nint n,m,bl,tot=1;\n\nstruct ques {\n\tint l,r,uid,yx;\n}q[N*M]; int qtot=0;\nstruct node {\n\tint x,y;\n}tmp[1752];\nint B[M][1752],rt[N],rttot;\nbool cmp(node x,node y) {\n\treturn x.x<y.x;\n}\n\nil void ins(int x) {\n\tint pre=rt[rttot]; rt[++rttot]=++tot;\n\tfor(int i=24;i>=0;i--) {\n\t\tint c=(x>>i)&1;\n\t\tsum[tot]=sum[pre]+1;\n\t\tson[c^1][tot]=son[c^1][pre];\n\t\tson[c][tot]=tot+1; ++tot;\n\t\tpre=son[c][pre];\n\t}\n\tsum[tot]=sum[pre]+1;\n}\n\nil int query(int l,int r,int c,int d) {\n\tl=rt[l-1]; r=rt[r];\n\tint res=0;\n\tfor(int i=24;i>=0;i--) {\n\t\tint r1=(c>>i)&1,r2=(d>>i)&1;\n\t\tif(r2) res+=sum[son[r1][r]]-sum[son[r1][l]];\n\t\tif(!r1&&!r2) l=son[0][l],r=son[0][r];\n\t\tif(r1&&!r2) l=son[1][l],r=son[1][r];\n\t\tif(!r1&&r2) l=son[1][l],r=son[1][r];\n\t\tif(r1&&r2) l=son[0][l],r=son[0][r];\n\t}\n\tres+=sum[r]-sum[l];\n\treturn res;\n}\n\nil void build(int x) {\n\tfor(int i=L[x];i<=R[x];++i) {\n\t\ttmp[i-L[x]+1].x=b[i]; tmp[i-L[x]+1].y=i;\n\t}\n\tsort(tmp+1,tmp+1+R[x]-L[x]+1,cmp);\n\tfor(int i=1;i<=R[x]-L[x]+1;++i) {\n\t\tB[x][i]=tmp[i].x; rid[L[x]+i-1]=tmp[i].y;\n\t}\n\tcnt[x]=L[x];\n}\n\nil void update(int l,int r,int c,int d,int uid) {\n\tif(id[l]==id[r]) {\n\t\tfor(int i=l;i<=r;++i) ans[uid]+=((a[i]^c)<=min(b[i],d));\n\t} else {\n\t\tfor(int i=l;i<=R[id[l]];++i) ans[uid]+=((a[i]^c)<=min(b[i],d));\n\t\tfor(int i=L[id[r]];i<=r;++i) ans[uid]+=((a[i]^c)<=min(b[i],d));\n\t\tfor(int i=id[l]+1;i<id[r];++i) {\n\t\t\twhile(cnt[i]<R[i]&&B[i][cnt[i]-L[i]+1]<=d) ++cnt[i];\n\t\t\tif(B[i][cnt[i]-L[i]+1]<d) {\n\t\t\t\tq[++qtot]=ques{1,L[i]-1,uid,2}; q[++qtot]=ques{1,R[i],uid,3};\n\t\t\t} else { //L[i]~cnt[i]-1 cnt[i]-R[i]\n\t\t\t\tif(L[i]<=cnt[i]-1) q[++qtot]=ques{1,L[i]-1,uid,2},q[++qtot]=ques{1,cnt[i]-1,uid,3};\n\t\t\t\tans[uid]+=query(cnt[i],R[i],c,d);\n\t\t\t}\n\t\t}\n\t}\n}\n\nbool cmp2(ques x,ques y) {\n\treturn x.r==y.r?x.yx<y.yx:x.r<y.r;\n}\n\nil void insC(int x) {\n\tint p=1;\n\tfor(int i=24;i>=0;i--) {\n\t\tint c=(x>>i)&1;\n\t\tif(!son[c][p]) son[c][p]=++tot;\n\t\tp=son[c][p];\n\t}\n}\n\nil void solve(int x,int y) {\n\tint p=1;\n\tfor(int i=24;i>=0;i--) {\n\t\tint r1=(x>>i)&1,r2=(y>>i)&1;\n\t\tif(r2) sum[son[r1][p]]++;\n\t\tif(r1&&r2) p=son[0][p];\n\t\tif(!r1&&r2) p=son[1][p];\n\t\tif(!r1&&!r2) p=son[0][p];\n\t\tif(r1&&!r2) p=son[1][p]; \n\t}\n\t++sum[p];\n}\n\nil int query(int x) {\n\tint res=0,p=1;\n\tfor(int i=24;i>=0;i--) {\n\t\tint c=(x>>i)&1;\n\t\tres+=sum[p]; p=son[c][p];\n\t}\n\tres+=sum[p];\n\treturn res;\n}\n\nstruct ask{\n\tint l,r,c,d,id;\n}A[N];\nil bool cmp3(ask x,ask y) {\n\treturn x.d<y.d;\n}\nint st[20][N];\n\nil int st_qry(int l,int r) {\n\tint qwq=log2(r-l+1);\n\treturn max(st[qwq][l],st[qwq][r-(1<<qwq)+1]);\n}\n\nil void solve1() {\n\tfor(int i=1;i<=m;++i) {\n\t\tq[++qtot]=ques{1,A[i].l-1,i,2}; q[++qtot]=ques{1,A[i].r,i,3};\n\t}\n\tfor(int i=1;i<=n;++i) q[++qtot]=ques{0,i,i,1};\n\tsort(q+1,q+1+qtot,cmp2);\n\tfor(int i=1;i<=m;++i) insC(C[i]);\n\tfor(int i=1;i<=qtot;++i) {\n\t\tif(q[i].yx==1) {\n\t\t\tsolve(a[q[i].uid],b[q[i].uid]);\n\t\t} else if(q[i].yx==2) {\n\t\t\tans[q[i].uid]-=query(C[q[i].uid]);\n\t\t} else {\n\t\t\tans[q[i].uid]+=query(C[q[i].uid]);\n\t\t}\n\t}\n\tfor(int i=1;i<=m;++i) pr(ans[i]),puts(\"\");\n}\n\nnamespace solve2 {\n\tstruct node {\n\t\tint x,id;\n\t}T[N];\n\tbool cmp(node x,node y) {\n\t\treturn x.x<y.x;\n\t} int tmp[N];\n\tvoid sol() {\n\t\tfor(int i=1;i<=n;i++) T[i].x=b[i],T[i].id=i;\n\t\tsort(T+1,T+1+n,cmp);for(int i=1;i<=n;i++) tmp[i]=b[i]; sort(tmp+1,tmp+1+n);\n\t\tfor(int i=1;i<=n;i++) ins(a[T[i].id]);\n\t\tfor(int i=1;i<=m;i++) {\n\t\t\tint qwq=upper_bound(tmp+1,tmp+1+n,A[i].d)-tmp-1;\n\t\t\tif(qwq) q[++qtot]=ques{1,qwq,i,1}; \n\t\t\tif(qwq+1<=n) ans[A[i].id]+=query(qwq+1,n,A[i].c,A[i].d);\n\t\t}\n\t\tfor(int i=1;i<=tot;i++) sum[i]=son[0][i]=son[1][i]=0; tot=1;\n\t\tfor(int i=1;i<=m;i++) insC(C[i]);\n\t\tfor(int i=1;i<=n;i++) q[++qtot]=ques{1,i,T[i].id,0};\n\t\tsort(q+1,q+1+qtot,cmp2);\n\t\tfor(int i=1;i<=qtot;i++) {\n\t\t\tif(q[i].yx==0) solve(a[q[i].uid],b[q[i].uid]);\n\t\t\telse ans[q[i].uid]+=query(C[q[i].uid]);\n\t\t}\n\t\tfor(int i=1;i<=m;i++) pr(ans[i]),puts(\"\");\n\t}\n}\n\nint main() {\n\tn=rd(); m=rd(); bl=1750;\n\tfor(int i=1;i<=n;++i) a[i]=rd(),b[i]=rd();\n\tfor(int i=1;i<=n;++i) st[0][i]=b[i];\n\tfor(int i=1;i<=18;++i)\n\t\tfor(int j=1;j+(1<<i)-1<=n;j++)\n\t\t\tst[i][j]=max(st[i-1][j],st[i-1][j+(1<<(i-1))]);\t\n\tbool fl=1,fl2=1;\n\tfor(int i=1;i<=m;++i) {      \n\t\tA[i].l=rd(); A[i].r=rd(); A[i].c=C[i]=rd(); A[i].d=rd(); A[i].id=i;\n\t\tif(A[i].d<st_qry(A[i].l,A[i].r)) fl=0;\n\t\tif(A[i].l!=1||A[i].r!=n) fl2=0;\n\t}\n\tif(fl) {\n\t\tsolve1(); return 0;\n\t}\n\tif(fl2) {\n\t\tsolve2::sol(); return 0;\n\t}\n\tfor(int i=1;i<=n;++i) id[i]=(i-1)/bl+1;\n\tfor(int i=1;i<=id[n];++i) L[i]=(i-1)*bl+1,R[i]=i*bl; R[id[n]]=n;\n\tfor(int i=1;i<=id[n];++i) build(i);\n\tfor(int i=1;i<=n;++i) ins(a[rid[i]]);\n\tsort(A+1,A+1+m,cmp3);\n\tfor(int i=1;i<=m;++i) update(A[i].l,A[i].r,A[i].c,A[i].d,A[i].id);\n\tfor(int i=1;i<=n;++i) q[++qtot]=ques{rid[i],i,0,1};\n\tsort(q+1,q+1+qtot,cmp2);\n\tfor(int i=1;i<=tot;i++) sum[i]=0,son[0][i]=son[1][i]=0; tot=1;\n\tfor(int i=1;i<=m;++i) insC(C[i]);\n\tfor(int i=1;i<=qtot;++i) {\n\t\tif(q[i].yx==1) {\n\t\t\tsolve(a[q[i].l],b[q[i].l]);\n\t\t} else if(q[i].yx==2) {\n\t\t\tans[q[i].uid]-=query(C[q[i].uid]);\n\t\t} else {\n\t\t\tans[q[i].uid]+=query(C[q[i].uid]);\n\t\t}\n\t}\n\tfor(int i=1;i<=m;++i) pr(ans[i]),puts(\"\");\n\treturn 0;\n}\n```",
        "postTime": 1627654755,
        "uid": 125901,
        "name": "FxorG",
        "ccfLevel": 7,
        "title": "P7470 [NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669"
    },
    {
        "content": "**\u975e\u6b63\u89e3**\n\n~~\u8003\u573a\u4e0a\u6ca1\u60f3\u5230\u5206\u6cbb\uff0c\u5c31\u65e0\u8111\u5199\u5206\u5757\u4e86\uff08~~\n\n\u8fd9\u4e48\u5927\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u9898\uff0c\u76f4\u63a5\u8003\u8651\u5206\u5757\uff08\n\n\u5bf9\u4e8e\u975e\u6574\u5757\u7684\u67e5\u8be2\uff0c\u76f4\u63a5\u66b4\u529b\u641e\u5c31\u884c\u4e86\n\n\u5bf9\u4e8e\u6574\u5757\uff0c\u8003\u8651\u5c06\u5757\u5185\u6392\u5e8f\uff0c\u5206\u6210 $b_i< d$ \u548c $b_i\\ge d$ \u4e24\u7c7b\u5904\u7406\n\n1. \u5bf9\u4e8e $b_i\\ge d$ \u7684\u70b9\uff0c\u6211\u4eec\u53d1\u73b0\u5b83\u4eec\u6392\u5b8c\u5e8f\u4e4b\u540e\u90fd\u5728\u4e00\u4e2a\u8fde\u7eed\u533a\u95f4\u5185\uff0c\u4e8e\u662f\u7528\u53ef\u6301\u4e45\u5316 trie \u7c7b\u4f3c\u4e8e\u4e3b\u5e2d\u6811\u4e00\u6837\u67e5\u8be2\u5373\u53ef\n\n2. \u5bf9\u4e8e $b_i<d$ \u7684\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u628a\u8be2\u95ee\u79bb\u7ebf\u4e0b\u6765\u6309 $d$ \u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u4e8e\u662f\u53d1\u73b0\u6bcf\u6b21\u65b0\u5904\u7406\u4e00\u6b21\u8be2\u95ee\u8fd9\u4e00\u79cd\u70b9\u7684\u6570\u91cf\u53ea\u4f1a\u589e\u52a0  \n\u7136\u540e\u6bcf\u6b21\u65b0\u52a0\u5165\u4e00\u4e2a\u70b9\u7684\u65f6\u5019\u8003\u8651\u6709\u54ea\u4e9b $c$ \u6ee1\u8db3 $a_i\\oplus c\\le b_i$\uff0c\u8003\u8651\u4f9d\u6b21\u5904\u7406\u6bcf\u4e00\u4f4d\uff0c\u53d1\u73b0\u8fd9\u79cd $c$ \u662f\u4e00\u4e9b\u533a\u95f4\u7684\u4ea4  \n\u4e8e\u662f\u5c31\u53d8\u6210\u4e86\u533a\u95f4\u52a0 1\uff0c\u5355\u70b9\u67e5\u8be2\u95ee\u9898\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u5c31\u884c\u4e86\n\n\u8bbe\u5757\u957f $S$\uff0c\u5219\u5bf9\u4e8e\u975e\u6574\u5757\uff0c\u67e5\u8be2\u590d\u6742\u5ea6 $\\mathcal O(QS)$\uff0c\u5bf9\u4e8e\u6574\u5757\uff0c\u67e5\u8be2\u590d\u6742\u5ea6 $\\mathcal O(Q\\frac nS \\log a)$\uff0c\u4e8e\u662f\u5f53 $S=\\sqrt{n\\log a}$ \u7684\u65f6\u5019\u53d6\u5230\u7406\u8bba\u6700\u4f18\u590d\u6742\u5ea6 $\\mathcal O(Q\\sqrt{n\\log a})$\n\n\u5b9e\u6d4b $S=1750$ \u65f6\u6700\u4f18\uff0c\u53ef\u4ee5\u83b7\u5f97 90pts \u7684\u597d\u6210\u7ee9\uff0c\u4f1a\u88ab $l=1,r=n$ \u5361\u6389\uff08\u672c\u673a\u8dd1 6s \u5de6\u53f3\uff09~~\uff08\u539f\u6765\u8fd9\u4e0d\u662f\u90e8\u5206\u5206\u800c\u662f\u5149\u660e\u6b63\u5927\u5361 sqrt \u7b97\u6cd5\u554a~~\n\n\u4e8e\u662f\u53ea\u80fd\u52a0\u4e0a\u7279\u5224\uff0c\u5728 $l=1,r=n$ \u7684\u65f6\u5019\u628a $S$ \u8c03\u6210 $n$ \u624d\u80fd\u901a\u8fc7/dk/dk\n\n[**code**](https://www.luogu.com.cn/paste/6d9paxz0)",
        "postTime": 1616835947,
        "uid": 65681,
        "name": "UltiMadow",
        "ccfLevel": 7,
        "title": "[\u9898\u89e3] P7470 [NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669"
    },
    {
        "content": "\u53ef\u80fd\u88ab\u5361\u7684 T3 \u505a\u6cd5\n\nT3 \u7684\u65b9\u6cd5\u90fd\u5199\u5230\u90e8\u5206\u5206\u91cc\u4e86\u3002\n\n$N^2$ \u7684\u505a\u6cd5\u8df3\u8fc7\u3002\n\n\u4e0d\u8003\u8651 $b$ \u7684\u90e8\u5206\u5206\uff0c\u5c31\u662f\u53ef\u6301\u4e45\u5316 Trie \u6a21\u677f\u3002\n\n\u4e0d\u8003\u8651 $d$ \u7684\u90e8\u5206\u5206\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u6bcf\u4e2a\u4f4d\u7f6e\u4f1a\u5bf9\u54ea\u4e9b$c$\u4ea7\u751f\u8d21\u732e\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5bf9$c$\u5efa\u7acb Trie \u6811\uff0c\u7136\u540e\u5728$Trie$\u6811\u4e0a\u7684\u8def\u5f84\u6253\u8d21\u732e\u6807\u8bb0\u5373\u53ef\u3002\u5bf9\u4e8e\u4e00\u4e2a\u8be2\u95ee\uff0c\u6211\u4eec\u76f4\u63a5\u627e\u8def\u5f84\u4e0a\u7684\u8d21\u732e\u6807\u8bb0\u5728$[l,r]$\u4e4b\u95f4\u7684\u8d21\u732e\u4e2a\u6570\uff0c\u53ef\u4ee5\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\u3002\n\n$l=1,r=n$\u7684\u90e8\u5206\u5206\uff0c\u53ef\u4ee5\u4e0d\u7528\u5f00\u7ebf\u6bb5\u6811\uff0c\u76f4\u63a5\u8bb0\u5f55\u8d21\u732e\u4e2a\u6570\uff0c\u7136\u540e\u53ef\u6301\u4e45\u5316 Trie \u9700\u8981\u652f\u6301\u4fee\u6539\uff0c\u5957\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4\u5373\u53ef\u3002\n\n\u6211\u4eec\u5bf9\u6bcf\u4e2a\u4f4d\u7f6e\u6309 $b_i$ \u6392\u5e8f\uff0c\u6bcf\u4e2a\u8be2\u95ee\u6309 $d_i$ \u6392\u5e8f\uff0c\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\uff0c$b\\le d$\u7684\u4f4d\u7f6e\u548c$b>d$\u7684\u5206\u5f00\u8ba1\u7b97\u8d21\u732e\u3002\u8bf4\u767d\u4e86\u5c31\u662f\u628a\u4e0a\u9762\u51e0\u4e2a\u65b9\u6cd5\u7ed3\u5408\u8d77\u6765\u3002\n\n\u6240\u4ee5\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4\u5957\u53ef\u6301\u4e45\u5316trie\uff0c\u548c\u4e00\u4e2atrie\u5957\u52a8\u6001\u5f00\u70b9\u7ebf\u6bb5\u6811\u3002\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6$\\rm O(N\\log^2 N)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=a;i<=b;i++)\n#define pre(i,a,b) for(int i=a;i>=b;i--)\n#define N 100005\n#define M 10000000\n#define W 2500005\nusing namespace std;\nchar buf[1<<22],*p1=buf,*p2=buf;\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\ninline int read(){\n    int x=0;char ch=getchar();\n    while(!isdigit(ch))ch=getchar();\n    while(isdigit(ch))x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n    return x;\n}\nint n,q;\nstruct node{\n\tint op,a,b;\n\tbool operator<(const node o)const{return b<o.b;}\n}u[N];\nstruct query{\n\tint op,c,d,l,r;\n\tbool operator<(const query o)const{return d<o.d;}\n}b[N];\nint ch[M][2],sz[M],rt[N],idx;\nint ins(int x,int y,int op,int ps){\n\tint now=++idx;\n\tch[now][0]=ch[x][0];\n\tch[now][1]=ch[x][1];\n\tsz[now]=sz[x]+op;\n\tif(ps<0)return now;\n\tint cur=(y>>ps)&1;\n\tch[now][cur]=ins(ch[x][cur],y,op,ps-1);\n\treturn now;\n}\nint ask(int x,int u,int v,int ps){\n\tif(!x||ps<0)return 0;\n\tif((v>>ps)&1){\n\t\tint cur=(u>>ps)&1;\n\t\treturn sz[ch[x][cur]]+ask(ch[x][cur^1],u,v,ps-1);\n\t}\n\telse{\n\t\treturn ask(ch[x][(u>>ps)&1],u,v,ps-1);\n\t}\n}\nvoid add(int x,int y,int op){for(;x<=n;x+=x&-x)rt[x]=ins(rt[x],y,op,23);}\nint query(int x,int u,int v){\n\tint sum=0;\n\tfor(;x;x-=x&-x)sum+=ask(rt[x],u,v+1,23);\n\treturn sum;\n}\nstruct Node{\n\tint sum,l,r;\n\tNode(){sum=0;}\n}a[M];int tot;\n#define ls a[x].l\n#define rs a[x].r\n#define S a[x].sum\nvoid insw(int x,int l,int r,int pos){\n\tS++;\n\tif(l==r)return;\n\tint mid=(l+r)>>1;\n\tif(mid>=pos){\n\t\tif(!ls)ls=++tot;\n\t\tinsw(ls,l,mid,pos);\n\t}\n\telse {\n\t\tif(!rs)rs=++tot;\n\t\tinsw(rs,mid+1,r,pos);\n\t}\n}\nint get(int x,int l,int r,int L,int R){\n\tif(!x)return 0;\n\tif(l>=L&&r<=R)return S;\n\tint mid=(l+r)>>1,sum=0;\n\tif(mid>=L)sum+=get(ls,l,mid,L,R);\n\tif(mid<R)sum+=get(rs,mid+1,r,L,R);\n\treturn sum;\n}\nint top=1,nxt[W][2],Rt[W],mat[N],fa[W];\nvoid addw(int x,int op){\n\tint now=1;\n\tpre(i,23,0){\n\t\tint cur=(x>>i)&1;\n\t\tif(!nxt[now][cur])nxt[now][cur]=++top;\n\t\tfa[nxt[now][cur]]=now;now=nxt[now][cur];\n\t}\n\tmat[op]=now;\n}\nvoid addtag(int x,int u,int v,int val,int ps){\n\tif(!x||ps<0)return;\n\tif((v>>ps)&1){\n\t\tint cur=(u>>ps)&1;\n\t\tif(nxt[x][cur]){\n\t\t\tif(!Rt[nxt[x][cur]])Rt[nxt[x][cur]]=++tot;\n\t\t\tinsw(Rt[nxt[x][cur]],1,n,val);\n\t\t}\n\t\taddtag(nxt[x][cur^1],u,v,val,ps-1);\n\t}\n\telse{\n\t\taddtag(nxt[x][(u>>ps)&1],u,v,val,ps-1);\n\t}\n}\nint gettag(int x,int l,int r){\n\tint sum=0;\n\twhile(x)sum+=get(Rt[x],1,n,l,r),x=fa[x];\n\treturn sum;\n}\nint ans[N];\nint main(){\n\t//freopen(\"island.in\",\"r\",stdin);\n\t//freopen(\"island.out\",\"w\",stdout);\n\tn=read();q=read();\n\trep(i,1,n)u[i].op=i,u[i].a=read(),u[i].b=read();\n\trep(i,1,q)b[i].op=i,b[i].l=read(),b[i].r=read(),b[i].c=read(),b[i].d=read(),\n\t\taddw(b[i].c,i);\n\tsort(u+1,u+n+1);\n\trep(i,1,n)add(u[i].op,u[i].a,1);\n\tsort(b+1,b+q+1);\n\tint j=1;\n\trep(i,1,q){\n\t\twhile(j<=n&&u[j].b<b[i].d){\n\t\t\tadd(u[j].op,u[j].a,-1);\n\t\t\taddtag(1,u[j].a,u[j].b+1,u[j].op,23);\n\t\t\tj++;\n\t\t}\n\t\tans[b[i].op]=gettag(mat[b[i].op],b[i].l,b[i].r)+query(b[i].r,b[i].c,b[i].d)-query(b[i].l-1,b[i].c,b[i].d);\n\t}\n\trep(i,1,q)printf(\"%d\\n\",ans[i]);\n\treturn 0;\n}\n```",
        "postTime": 1616824406,
        "uid": 119261,
        "name": "7KByte",
        "ccfLevel": 0,
        "title": "P7470 [NOI Online 2021 \u63d0\u9ad8\u7ec4]\u9898\u89e3"
    },
    {
        "content": "> [P7470 [NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669](https://www.luogu.com.cn/problem/P7470)\n\n\u4e00\u9053\u76f8\u5f53\u88f8\u7684\u9898\u76ee\u3002\n\n\u8003\u8651\u4e00\u6b21\u8be2\u95ee\u7684\u672c\u8d28\uff0c\u8fd9\u4e2a $\\min(b, d)$ \u5f88\u70e6\uff0c\u5206\u7c7b\u8ba8\u8bba\u641e\u6389\uff0c\u53d1\u73b0\u662f\u5f62\u5982\u4e09\u7ef4\u504f\u5e8f\u7684\u4e1c\u897f\uff1a$l_i\\leq p \\leq r_i$\uff0c$b_p\\leq d_i$ \u6216 $b_p > d_i$\uff0c\u4e14 $a_p\\oplus c_i \\leq b_p$ \u6216 $d_i$\uff0c\u81ea\u7136\u8003\u8651 CDQ \u5206\u6cbb\u3002\n\n\u9996\u5148\u5c06\u533a\u95f4\u8be2\u95ee\u5dee\u5206\u6210 $r$ \u5904\u8d21\u732e\u7cfb\u6570\u4e3a $1$ \u548c $l - 1$ \u5904\u8d21\u732e\u7cfb\u6570\u4e3a $-1$ \u7684\u524d\u7f00\u8be2\u95ee\uff0c\u7528 $(Q, c, d, qid, coef)$ \u63cf\u8ff0\uff0c\u8868\u793a\u67e5\u8be2\u524d\u7f00\u4e0b\u6807 $Q$\uff0c\u52b3\u7d2f\u5ea6\u4e3a $c$\uff0c\u6709\u8da3\u5ea6\u4e3a $d$\uff0c\u8be2\u95ee\u5e8f\u53f7\u4e3a $qid$\uff0c\u8d21\u732e\u7cfb\u6570\u4e3a $coef$\u3002\n\n\u5bf9\u4e8e\u5c9b\u5c7f\uff0c\u540c\u6837\u7528 $(P, a, b)$ \u63cf\u8ff0\uff0c\u4e0b\u6807\u4e3a $P$\uff0c\u52b3\u7d2f\u5ea6\u4e3a $a$\uff0c\u6709\u8da3\u5ea6\u4e3a $b$\u3002\n\n\u5148\u5957\u4e00\u5c42 CDQ \u5206\u6cbb\uff0c\u5c06\u6240\u6709\u8be2\u95ee\u548c\u5c9b\u5c7f\u6309\u7167\u4e0b\u6807\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\u4ece\u5c0f\u5230\u5927\uff0c\u82e5\u4e0b\u6807\u76f8\u540c\u5219\u5c9b\u5c7f\u4f18\u5148\uff0c\u5219\u4e00\u4e2a\u8be2\u95ee\u53ea\u6709\u53ef\u80fd\u53d7\u5230\u5728\u5b83\u4e4b\u524d\u7684\u5c9b\u5c7f\u7684\u8d21\u732e\u3002\n\n\u73b0\u5728\u53ea\u9700\u8003\u8651\u5de6\u533a\u95f4 $[l, mid]$ \u5bf9\u53f3\u533a\u95f4 $[mid + 1, r]$ \u7684\u8d21\u732e\u3002\n\n\u5148\u8003\u8651 $b_p > d_i$\uff0c\u5219 $b$ \u66f4\u5927\u7684\u5c9b\u5c7f\u4f1a\u5bf9 $d$ \u66f4\u5c0f\u7684\u8be2\u95ee\u4ea7\u751f\u8d21\u732e\uff0c\u56e0\u6b64\u533a\u95f4\u5185\u90e8\u6309\u7167\u6709\u8da3\u5ea6\u4ece\u5927\u5230\u5c0f\u6392\u5e8f\u3002\u82e5\u5de6\u533a\u95f4\u5f53\u524d\u4f4d\u7f6e $pl$ \u6709\u8da3\u5ea6\u66f4\u5927\uff0c\u5219\u52a0\u5165\u5de6\u533a\u95f4\u5f53\u524d\u4f4d\u7f6e\uff0c\u5e76\u4ee4 $pl$ \u5411\u540e\u79fb\u4e00\u5355\u4f4d\uff0c\u5426\u5219\u5bf9\u4e8e $pr$ \u540c\u7406\u3002\u6ce8\u610f $b_p > d_i$\uff0c\u6240\u4ee5\u6709\u8da3\u5ea6\u76f8\u540c\u65f6\u4f18\u5148\u53f3\u533a\u95f4\u3002\n\n- \u5982\u679c\u52a0\u5165\u7684\u5de6\u533a\u95f4\u4f4d\u7f6e\u4e0a\u662f\u4e00\u4e2a\u5c9b\u5c7f\uff0c\u5219\u5c06\u5c9b\u5c7f\u52a0\u5165\u96c6\u5408 $S$\uff1b\u5426\u5219\u662f\u4e00\u6b21\u8be2\u95ee\uff0c\u5ffd\u7565\u6389\u5b83\u3002\n- \u5982\u679c\u52a0\u5165\u7684\u53f3\u533a\u95f4\u4f4d\u7f6e\u4e0a\u662f\u4e00\u4e2a\u5c9b\u5c7f\uff0c\u5219\u5ffd\u7565\u6389\u5b83\uff1b\u5426\u5219\u662f\u4e00\u6b21\u8be2\u95ee\uff0c\u5f62\u5982\u7ed9\u5b9a $c, d$\uff0c\u67e5\u8be2 $S$ \u5f53\u4e2d $a\\oplus c \\leq d$ \u7684 $a$ \u7684\u6570\u91cf\u3002\n\n\u5b66\u8fc7 01 \u5b57\u5178\u6811\u7684\u540c\u5b66\u53ef\u4ee5\u611f\u6027\u7406\u89e3\uff0c\u4f7f\u5f97\u4e0e $a$ \u5f02\u6216\u8d77\u6765\u4e0d\u5927\u4e8e $d$ \u7684\u6240\u6709 $c$ \u53ef\u4ee5\u7528 01 \u5b57\u5178\u6811\u4e0a $\\mathcal{O}(\\log V)$ \u4e2a\u5b50\u6811\u63cf\u8ff0\u3002\n\n\u8bbe $d$ \u5728\u4e8c\u8fdb\u5236\u8868\u793a\u4e0b\u7b2c $x_1 > x_2 > \\cdots > x_k$ \u4f4d\u662f $1$\uff0c\u4ee4 $s_i$ \u4e3a $2 ^ {x_i}$ \u5173\u4e8e $i$ \u7684\u524d\u7f00\u548c\uff0c\u5219\u4f7f\u5f97\u4e0e $a$ \u5f02\u6216\u8d77\u6765\u6070\u7b49\u4e8e $[s_i, s_{i + 1})$ \u7684 $c$ \u6070\u597d\u662f\u7b2c $x_i$ \u4f4d\u4ee5\u53ca\u6bd4 $x_i$ \u9ad8\u7684\u4f4d\u4e0a\u6070\u597d\u7b49\u4e8e $a\\oplus d$ \u7684\u7b2c $x_{i + 1}$ \u4f4d\u53ca\u5176\u9ad8\u4f4d\uff0c\u4e14\u4f4e $x_{i + 1} - 1$ \u4f4d\u53ef\u4ee5\u4efb\u53d6\uff0c\u56e0\u4e3a $[s_i, s_{i + 1})$ \u7684\u7b2c $x_{i + 1}$ \u4f4d\u53ca\u5176\u9ad8\u4f4d\u6070\u597d\u7b49\u4e8e $s_i$ \u7684\u7b2c $x_{i + 1}$ \u4f4d\u53ca\u5176\u9ad8\u4f4d\uff0c\u4e14\u4f4e $x_{i + 1} - 1$ \u4f4d\u53d6\u904d\u4e86 $0\\sim 2 ^ {x_{i + 1}} - 1$\u3002\n\n\u8fd9\u4e2a\u7ed3\u8bba\u6709\u70b9\u610f\u8bc6\u6d41\uff0c\u4f46\u662f\u53ea\u8981\u60f3\u901a\u4e86\u5c31\u5f88\u7b80\u5355\u3002\u4f60\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a\u7ebf\u6bb5\u6811\u4e0a\u4e00\u4e2a\u533a\u95f4\u7684\u62c6\u5206\u533a\u95f4\u53ea\u6709 $\\mathcal{O}(\\log n)$ \u4e2a\uff0c\u5c3d\u7ba1\u5b83\u4eec\u4fe9\u672c\u8d28\u4e0d\u592a\u76f8\u540c\uff0c\u4f46\u53ef\u4ee5\u7c7b\u6bd4\u4e00\u4e0b\u3002\n\n\u5982\u4e0b\u56fe\uff0c\u7eff\u8272\u70b9\u662f 01 \u5b57\u5178\u6811\u63d2\u5165 $a\\oplus d$ \u65f6\u5f62\u6210\u7684\u8def\u5f84\uff0c**\u4e0e\u8def\u5f84\u76f8\u8fde** \u7684\u9ec4\u8272\u70b9\u5b50\u6811\u88ab\u6253\u4e0a\u6807\u8bb0\uff0c\u7ea2\u8272\u70b9\u5b50\u6811\u672a\u88ab\u6253\u4e0a\u6807\u8bb0\uff0c\u6ce8\u610f\u8def\u5f84\u7ed3\u5c3e\u7684\u7eff\u70b9\u5e94\u5f53\u88ab\u6253\u4e0a\u6807\u8bb0\u3002\u6240\u6709\u9ec4\u70b9\u5b50\u6811\u5185\u6240\u6709\u8282\u70b9\u548c\u8def\u5f84\u7ed3\u5c3e\u7684\u7eff\u70b9\u5373\u4e3a\u6240\u6709\u4e0e $a$ \u5f02\u6216\u8d77\u6765 $\\leq d$ \u7684\u503c\u5bf9\u5e94\u7684\u8282\u70b9\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/gyz8933u.png)\n\n\u90a3\u6211\u4eec\u8003\u8651\u5982\u4f55\u5728 01 \u5b57\u5178\u6811\u4e0a\u5b9a\u4f4d\u8fd9\u4e9b\u533a\u95f4\u3002\u8003\u8651\u5411 01 \u5b57\u5178\u6811\u63d2\u5165 $a \\oplus d$\uff0c\u8bbe\u5f53\u524d\u4f4d\u4e3a $B$\uff0c\u5f53\u524d\u8282\u70b9\u4e3a $x$\uff0c$a \\oplus d$ \u7684\u7b2c $B$ \u4f4d\u4e3a $A$\uff1a\n\n- \u82e5 $d$ \u7684\u7b2c $B$ \u4f4d\u4e3a $1$\uff0c\u8bf4\u660e $x$ \u7236\u8282\u70b9\u7684\u53e6\u4e00\u4e2a\u513f\u5b50\u5b50\u6811\u5747\u5408\u6cd5\uff0c\u56e0\u4e3a\u5176\u5bf9\u5e94\u7684\u8282\u70b9 **\u5f02\u6216 $a$ \u4e4b\u540e** \u5728\u7b2c $x + 1$ \u4f4d\u53ca\u5176\u9ad8\u4f4d\u5747\u4e0e $d$ \u7684\u7b2c $x + 1$ \u4f4d\u53ca\u5176\u9ad8\u4f4d\u76f8\u540c\uff0c\u4f46\u7b2c $x$ \u4f4d\u4e3a $0$\uff0c\u800c $d$ \u7684\u7b2c $x$ \u4f4d\u4e3a $1$\uff0c\u6240\u4ee5\u5f02\u6216\u503c\u5fc5\u7136\u4e0d\u5927\u4e8e $d$\u3002\n- \u82e5 $d$ \u7684\u7b2c $B$ \u4f4d\u4e3a $0$\uff0c\u5565\u4e8b\u4e5f\u4e0d\u7528\u5e72\u3002\n\n\u5b50\u6811\u6253\u6807\u8bb0\u7684\u8bdd\u76f4\u63a5\u6807\u8bb0\u6c38\u4e45\u5316\uff0c\u67e5\u8be2\u65f6\u53ea\u8981\u67e5 01 \u5b57\u5178\u6811\u4e0a\u67e5\u627e $c$ \u65f6\u7ecf\u8fc7\u6240\u6709\u8282\u70b9\u7684\u6807\u8bb0\u4e4b\u548c\u5373\u53ef\u3002\u89c6 $n, q$ \u540c\u7ea7\uff0c\u56e0\u4e3a\u8fdb\u884c $\\mathcal{O}(n\\log n)$ \u6b21\u63d2\u5165\u64cd\u4f5c\uff0c\u6240\u4ee5\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal{O}(n\\log n\\log V)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log V)$\u3002\n\n\u518d\u8003\u8651 $b_p \\leq d_i$\uff0c\u53d1\u73b0\u51e0\u4e4e\u662f\u5bf9\u79f0\u7684\uff0c\u6709\u8da3\u5ea6\u4ece\u5927\u5230\u5c0f\u53d8\u6210\u4e86\u4ece\u5c0f\u5230\u5927\uff0c\u6709\u8da3\u5ea6\u76f8\u540c\u65f6\u4f18\u5148\u53f3\u533a\u95f4\u53d8\u6210\u4e86\u4f18\u5148\u5de6\u533a\u95f4\u300201 \u5b57\u5178\u6811\u63d2\u5165\u53d8\u6210\u4e86\u5355\u70b9\u63d2\u5165\uff0c\u67e5\u8be2\u53d8\u6210\u4e86\u5b50\u6811\u67e5\u8be2\uff0c\u6240\u4ee5 01 \u5b57\u5178\u6811\u4e0a\u6bcf\u4e2a\u8282\u70b9\u7ef4\u62a4\u7684\u4fe1\u606f\u4ece\u61d2\u6807\u8bb0\u503c\u53d8\u6210\u4e86\u5b50\u6811\u7684\u6570\u7684\u4e2a\u6570\u4e4b\u548c\u3002\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u5c06\u8be2\u95ee\u548c\u533a\u95f4\u53cd\u8f6c\u5f97\u5230\u540c\u6837\u6548\u679c\uff0c\u4f46\u6ce8\u610f\u7279\u5224 $b_p = d_i$\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nconst int N = 1e5 + 5;\nconst int K = N << 6;\nconst int W = 24;\nint n, q, cnt, ans[N];\nint a[N], b[N], c[N], d[N];\nvector<int> buc[N];\nstruct event {\n  int a, b, id;\n  bool operator < (const event &v) const {return b != v.b ? b < v.b : id < v.id;}\n} e[N * 3], f[N * 3]; // \u6ce8\u610f\u8fd9\u91cc\u8981 * 3 =.=\nstruct Trie {\n  int R, node, son[K][2], val[K];\n  void tag(int &x, int v) {if(!x) x = ++node; val[x] += v;}\n  void insert1(int pos, int &x, int p, int lim, int v) {\n    // \u5f53\u524d\u662f\u7b2c pos \u4f4d\uff0c\u63d2\u5165\u7684\u503c\u4e3a p\uff0c\u9700\u8981\u9650\u5236 xor <= lim\uff0cdelta val = v\u3001\n    // \u8fd9\u91cc\u7684 val \u662f\u5b50\u6811\u52a0\u7684 tag\uff0c\u6807\u8bb0\u6c38\u4e45\u5316\n    if(!x) x = ++node;\n    if(!pos) return val[x] += v, void(); // \u9012\u5f52\u5230\u53f6\u5b50\uff0c\u5408\u6cd5\uff0c\u9700\u8981\u52a0 v\n    int bit = p >> pos - 1 & 1;\n    if(lim >> pos - 1 & 1) {\n      if(!son[x][bit]) son[x][bit] = ++node;\n      val[son[x][bit]] += v;\n      insert1(pos - 1, son[x][bit ^ 1], p, lim, v);\n    }\n    else insert1(pos - 1, son[x][bit], p, lim, v);\n  }\n  int query1(int pos, int x, int p) {\n    if(!x || !pos) return val[x];\n    // cerr << \"query1 \" << x << \" \" << val[x] << \" \" << son[x][0] << endl;\n    return val[x] + query1(pos - 1, son[x][p >> pos - 1 & 1], p);\n  }\n  void insert2(int pos, int &x, int p, int v) {\n    if(!x) x = ++node;\n    val[x] += v;\n    if(!pos) return;\n    insert2(pos - 1, son[x][p >> pos - 1 & 1], p, v);\n  }\n  int query2(int pos, int x, int p, int lim) {\n    if(!x || !pos) return val[x];\n    int bit = p >> pos - 1 & 1;\n    if(lim >> pos - 1 & 1) {\n      int ans = query2(pos - 1, son[x][bit ^ 1], p, lim);\n      return ans + val[son[x][bit]];\n    }\n    return query2(pos - 1, son[x][bit], p, lim);\n  }\n  void clear() {\n    for(int i = 0; i <= node; i++) son[i][0] = son[i][1] = val[i] = 0;\n    node = R = 0; // \u6ce8\u610f R \u4e5f\u8981\u6e05\u7a7a\n  }\n} tr;\nvoid solve(int l, int r, int type) {\n  if(l == r) return f[l] = e[l], void();\n  int m = l + r >> 1;\n  solve(l, m, type), solve(m + 1, r, type);\n  int pl = l, pr = m + 1, p = l;\n  static event g[N * 3];\n  // cerr << \"solve \" << l << \" \" << r << endl;\n  auto moveL = [&]() {\n    if(f[pl].id == -N) {\n      // cerr << \"addL \" << f[pl].a << \" \" << f[pl].b << \" \" << f[pl].id << endl;\n      if(type == 1) tr.insert1(W, tr.R, f[pl].a, f[pl].b, 1);\n      else tr.insert2(W, tr.R, f[pl].a, 1);\n    }\n    g[p++] = f[pl++];\n  };\n  auto moveR = [&]() {\n    if(f[pr].id != -N) {\n      int id = abs(f[pr].id), sgn = f[pr].id / id;\n      // cerr << \"queryR \" << id << \" \" << sgn << \" \" << c[id] << endl;\n      if(type == 1) ans[id] += tr.query1(W, tr.R, c[id]) * sgn;\n      else ans[id] += tr.query2(W, tr.R, c[id], d[id]) * sgn;\n      // cerr << \"res \" << ans[id] << endl;\n    }\n    g[p++] = f[pr++];\n  };\n  while(pl <= m && pr <= r) {\n    if(type == 1 ? f[pl] < f[pr] : f[pr] < f[pl]) moveL();\n    else moveR();\n  }\n  while(pr <= r) moveR();\n  for(int i = pl; i <= m; i++) g[p++] = f[i];\n  for(int i = l; i <= r; i++) f[i] = g[i];\n  tr.clear();\n}\nint main() {\n  // freopen(\"1.in\", \"r\", stdin);\n  cin >> n >> q;\n  for(int i = 1; i <= n; i++) scanf(\"%d%d\", &a[i], &b[i]);\n  for(int i = 1; i <= q; i++) {\n    int l, r;\n    scanf(\"%d%d%d%d\", &l, &r, &c[i], &d[i]);\n    if(l > 1) buc[l - 1].push_back(-i);\n    buc[r].push_back(i);\n  }\n  for(int i = 1; i <= n; i++) {\n    e[++cnt] = {a[i], b[i], -N};\n    for(int it : buc[i]) e[++cnt] = {c[abs(it)], d[abs(it)], it}; \n  }\n  // for(int i = 1; i <= cnt; i++) cerr << \"dat \" << i << \" \" << e[i].a << \" \" << e[i].b << \" \" << e[i].id << endl;\n  solve(1, cnt, 1);\n  solve(1, cnt, 2);\n  for(int i = 1; i <= q; i++) printf(\"%d\\n\", ans[i]);\n  return cerr << \"Time: \" << clock() << endl, 0;\n}\n/*\n2022/5/21\nstart thinking at\n\u4e8c\u7ef4\u6570\u70b9\u95ee\u9898\u3002\ncdq \u5206\u6cbb\u3002\n\u5916\u5c42\u662f\u4e0b\u6807\uff0c\u5185\u5c42\u662f\u6709\u8da3\u5ea6\u3002\n\u5199\u51fa\u4e86\u597d\u591a bug\uff0c\u50cf\u4e2a\u8822\u86cb\u3002\nstart coding at 8:29\nfinish debugging at 9:40\n*/\n```",
        "postTime": 1660316872,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "P7470 [NOI Online 2021 \u63d0\u9ad8\u7ec4] \u5c9b\u5c7f\u63a2\u9669"
    },
    {
        "content": "[\u539f\u9898\u94fe\u63a5](https://www.luogu.com.cn/problem/P7470)\n\n>\u9898\u610f  \n\u7ed9\u51fa\u4e00\u4e2a\u5e8f\u5217 $a_{1\\dots n},b_{1\\dots n}$\uff0c  \n\u6bcf\u6b21\u67e5\u8be2\u7ed9\u51fa\u4e00\u6bb5\u533a\u95f4 $l,r$ \u4ee5\u53ca\u4e24\u4e2a\u6570 $c,d$\uff0c  \n\u95ee\u533a\u95f4 $[l,r]$ \u5185\u6709\u591a\u5c11\u4e2a\u6570\u6ee1\u8db3 $a_i\\operatorname{xor}c\\leq \\min(b_i,d)$\u3002\n\n\u592a\u4e45\u6ca1\u5199 $\\text{cdq}$ \u7adf\u8fd8\u80fd\u8fd9\u4e48\u5feb\u8fc7\u6389\u3002\n\n\u9996\u5148\uff0c\u7531\u4e8e\u8be2\u95ee\u53ef\u52a0\u6027\uff0c\u533a\u95f4\u7684\u9650\u5236\u53ef\u4ee5\u62c6\u4e3a\u4e24\u4e2a $[1,t]$ \u7684\u67e5\u8be2\u3002\n\n\u4e8e\u662f\u8fd9\u5c31\u53ef\u4ee5\u4ee5\u4f4d\u7f6e\u4e3a\u7b2c\u4e00\u7ef4\u8fdb\u884c $\\text{cdq}$ \u5206\u6cbb\u4e86\u3002\n\n\u7136\u540e\u4e3a\u4e86\u65b9\u4fbf\u5730\u62c6\u6389 $\\min(b_i,d)$\uff0c\u53ef\u4ee5\u5c06 $\\geq d$ \u7684 $b_i$ \u4e0e $< d$ \u7684\uff0c\u5206\u5f00\u7edf\u8ba1\u3002\n\n\u5148\u662f $b_i\\geq d$ \u7684 $i$ \uff0c\u6b64\u65f6\u6709 $a_i\\operatorname{xor}c\\leq d$\u3002\u8fd9\u662f $\\text{01trie}$ \u7684\u7ecf\u5178\u8fd0\u7528\u3002\u5c06\u6240\u6709 $a_i$ \u63d2\u5230 $\\text{01trie}$ \u4e0a\u3002\u67e5\u8be2\u65f6\u5728 $\\text{01trie}$ \u4e0a\u6309\u7740\u4e00\u6761 $c\\operatorname{xor}s=d$ \u7684\u94fe $s$ \uff0c\u8fd9\u4f7f\u5f97\u524d\u51e0\u4f4d $\\operatorname{xor}c$  \u540e\u4e0e $d$ \u76f8\u540c\u3002\u5982\u679c\u8fd9\u4e00\u4f4d\u4e0a $d$ \u4e3a $1$\uff0c\u5219\u7d2f\u52a0\u4e0a\u4f7f\u8fd9\u4e00\u4f4d $\\operatorname{xor}c=0$ \u7684\u6570\u7684\u4e2a\u6570\uff0c\u8df3\u5230\u53f6\u5b50\u8282\u70b9\u7684\u6570\u7684\u4e2a\u6570\u540c\u6837\u8981\u7b97\u4e0a\uff0c\u6b64\u65f6 $\\operatorname{xor}c=d$\u3002\n\n\u800c\u5bf9\u4e8e $b_i<d$ \u7684 $i$\uff0c\u6709 $a_i\\operatorname{xor}c\\leq b_i$\u3002\u8003\u8651\u5c06\u80fd\u4f7f $a_i\\operatorname{xor}c\\leq b_i$ \u7684 $c$ \u5904\u6253\u4e0a $+1$ \u7684\u6807\u8bb0\u3002\u7ef4\u62a4\u4e00\u6761\u4f7f $s\\operatorname{xor}a_i=b_i$ \u7684\u94fe  $s$\uff0c\u5982\u679c\u8fd9\u4e00\u4f4d\u4e0a $b_i$ \u4e3a $1$\uff0c\u5c06 $\\operatorname{xor}a_i$ \u540e\u8fd9\u4e00\u4f4d\u4e3a $0$ \u7684\u5b50\u6811\u6253\u4e0a $+1$ \u7684\u6807\u8bb0\uff0c\u8df3\u5230\u7684\u53f6\u5b50\u8282\u70b9\u540c\u6837\u8981\u6253\u4e0a $+1$ \u7684\u6807\u8bb0\u3002\u67e5\u8be2\u65f6\u6309\u7740 $c$ \u4ece\u6839\u5f00\u59cb\u4e00\u8def\u7d2f\u52a0\u88ab\u52a0\u4e0a\u7684\u6807\u8bb0\u548c\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log n\\log V)$\uff0c$\\text{cdq}$ \u4e0e $\\text{01trie}$ \u5404\u5e26\u4e00\u4e2a $\\log$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=5e5+10,K=24;\nint n,m,x,y,l,r,a,b,tot,t_tot,rt,tmp;\nint res[N];bool bx,bw;char ch;\ninline void read(int &x){\n\tx=0;ch=getchar();while(ch<48)ch=getchar();\n\twhile(ch>47)x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n}\nvoid write(int x){if(x>9)write(x/10);putchar(48+x%10);}\nstruct cdq{\n\tint i,a,b,id;char opt;cdq()=default;//opt=0:mdf otherwise:inq\n\tcdq(int _i,int _a,int _b,char _opt=0,int _id=0)\n\t\t:i(_i),a(_a),b(_b),opt(_opt),id(_id){}\n}q[N],q0[N],qq[N],qq0[N];//min=d for q ; min=b for qq\nbool cmpi(cdq x,cdq y){return x.i^y.i?x.i<y.i:!x.opt;}\nbool cmpq(cdq x,cdq y){return x.b^y.b?x.b>y.b:!x.opt;}\nbool cmpqq(cdq x,cdq y){return x.b^y.b?x.b<y.b:x.opt;}\nstruct trie01{int son[2],tag[2],sz;}t[N*(K+1)];\nvoid update(int &k,int x,int i,int v){\n\tif(!k)k=++t_tot;t[k].sz+=v;\n\tif(~i)update(t[k].son[(x>>i)&1],x,i-1,v);\n}\nvoid update(int &k,int x,int w,int i,int v){\n\tif(!k)k=++t_tot;\n\tbw=(w>>i)&1;bx=bw^((x>>i)&1);\n\tif(~i){\n\t\tif(bw)t[k].tag[!bx]+=v;\n\t\tupdate(t[k].son[bx],x,w,i-1,v);\n\t}\n\telse t[k].tag[0]+=v;\n}\nvoid inquiry(int k,int x,int w,int i){\n\tif(~i){\n\t\tbw=(w>>i)&1;bx=bw^((x>>i)&1);\n\t\tif(bw)tmp+=t[t[k].son[!bx]].sz;\n\t\tinquiry(t[k].son[bx],x,w,i-1);\n\t}\n\telse tmp+=t[k].sz;\n}\nvoid inquiry(int k,int x,int i){\n\tif(~i){\n\t\tbx=(x>>i)&1;tmp+=t[k].tag[bx];\n\t\tinquiry(t[k].son[bx],x,i-1);\n\t}\n\telse tmp+=t[k].tag[0];\t\n}\nvoid solve(int l,int r){\n\tif(l^r){\n\t\tint mid=(l+r)>>1,i;\n\t\tsolve(l,mid);solve(mid+1,r);\n\t\tmerge(q+l,q+mid+1,q+mid+1,q+r+1,q0+l,cmpq);\n\t\tmerge(qq+l,qq+mid+1,qq+mid+1,qq+r+1,qq0+l,cmpqq);\n\t\tfor(i=l;i<=r;++i)q[i]=q0[i],qq[i]=qq0[i];\n\t\tfor(i=l;i<=r;++i){\n\t\t\tif(q[i].i<=mid&&!q[i].opt)update(rt,q[i].a,K,1);\n\t\t\telse if(q[i].i>mid&&q[i].opt){\n\t\t\t\ttmp=0;inquiry(rt,q[i].a,q[i].b,K);\n\t\t\t\tres[q[i].id]+=tmp*q[i].opt;\n\t\t\t}\n\t\t}\n\t\tfor(i=l;i<=r;++i)if(q[i].i<=mid&&!q[i].opt)update(rt,q[i].a,K,-1);\n\t\tfor(i=l;i<=r;++i){\n\t\t\tif(qq[i].i<=mid&&!qq[i].opt)update(rt,qq[i].a,qq[i].b,K,1);\n\t\t\telse if(qq[i].i>mid&&qq[i].opt){\n\t\t\t\ttmp=0;inquiry(rt,qq[i].a,K);\n\t\t\t\tres[qq[i].id]+=tmp*qq[i].opt;\n\t\t\t}\n\t\t}\n\t\tfor(i=l;i<=r;++i)if(qq[i].i<=mid&&!qq[i].opt)update(rt,qq[i].a,qq[i].b,K,-1);\n\t}\n}\nmain(){\n\tread(n);read(m);register int i;\n\tfor(i=1;i<=n;++i)read(a),read(b),q[++tot]=cdq(i,a,b);\n\tfor(i=1;i<=m;++i){\n\t\tread(l),read(r),read(a),read(b);\n\t\tq[++tot]=cdq(r,a,b,1,i);\n\t\tif(l>1)q[++tot]=cdq(l-1,a,b,-1,i);\n\t}\n\tsort(q+1,q+tot+1,cmpi);\n\tfor(i=1;i<=tot;++i)q[i].i=i;\n\tfor(i=1;i<=tot;++i)qq[i]=q[i];\n\tsolve(1,tot);\n\tfor(i=1;i<=m;++i)write(res[i]),putchar('\\n');\n}\n```\n",
        "postTime": 1635645427,
        "uid": 334380,
        "name": "Y_B_X",
        "ccfLevel": 7,
        "title": "\u9898\u89e3[P7470 \u5c9b\u5c7f\u63a2\u9669]"
    }
]