[
    {
        "content": "\u8fd9\u9053\u9898\u4e00\u770b\u5c31\u662f\u5176\u5b9e\u662f\u4e00\u4e2adp,\u8f6e\u5ed3\u7ebfdp\n\n\u8bbe\u70b9i,j\u4e0a\u4e00\u4e2a\u8f6e\u5ed3\u7ebf\u4e3au\n\n\u90a3\u4e48\u5982\u679cu\u7684\u7b2cm\u4f4d\u4e0e\u7b2c0\u4f4d\uff08\u4e8c\u8fdb\u5236\u4ece\u4f4e\u5230\u9ad8\uff0c\u7b2ck\u4f4d\u4ef7\u503c2^k\uff09\n\n\u90fd\u4e0d\u4e0e\u5f53\u524d\u8981\u586b\u7684\u6570\u4e0d\u540c\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u72b6\u6001\u8f6c\u79fb\n\n\u6211\u4eec\u518d\u7528\u6eda\u52a8\u6570\u7ec4\u4f18\u5316\u7a7a\u95f4\u5373\u53ef\n\n\u9644\u4e0a\u5e26\u6709\u7b80\u5355\u4f18\u5316\u5e38\u6570\u7684~~\u6211\u4e0d\u4f18\u5316\u6709\u4e00\u4e2a\u70b9\u8fc7\u4e0d\u53bb~~\u4ee3\u7801\uff1a\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<ctime>\n#define mod 376544743\nusing namespace std;\nlong long dp[5][300000],a[15],ans,sp1[100005],sp2[100005];\nint n,m,kk,now,maxs,s1,s2,can,bo;\ninline void update(register int x1,register int x2,register int x,register int y)\n{\n    dp[now][x2]=(dp[now][x2]+dp[now^1][x1])%mod;\n}\ninline void put(register int x,register int y,register int can)\n{\n    if (y/a[m-1]!=x&&(y%kk!=x||can)) update(y,(y*kk+x)%a[m],x,y);\n} \ninline int check(int x,int y)\n{\n    while (x>0||y>0)\n    {\n        if (x%kk==y%kk) return 0;\n        x=x/kk,y=y/kk;\n    }\n    return 1;\n}\nint main()\n{\n    srand(time(NULL));\n    scanf(\"%d%d%d\",&n,&m,&kk);\n    if (kk==2)\n    {\n        //printf(\"%d\",rand()%2);\n        //return 0;\n        bo=1;\n        for (register int i=1;i<=m;++i)\n        {\n            //scanf(\"%d\",&sp1[i]);\n            char ch=getchar();\n            while (ch!='0'&&ch!='1') ch=getchar();\n            sp1[i]=ch-48;\n            if (sp1[i]==sp1[i-1]) bo=0;\n        } \n            \n        for (register int i=1;i<=m;++i)\n        {\n            //scanf(\"%d\",&sp2[i]);\n            char ch=getchar();\n            while (ch!='0'&&ch!='1') ch=getchar();\n            sp2[i]=ch-48;\n            if (sp2[i]==sp2[i-1]) bo=0;\n        }  \n        for (int i=1;i<=m;++i)\n            if ((sp1[i]+n)%2==sp2[i]) bo=0;\n        printf(\"%d\\n\",bo);\n        return 0;    \n    }\n    a[0]=1;\n    maxs=1;\n    for (int i=1;i<=m-1;++i)\n        a[i]=a[i-1]*kk;\n    a[m]=a[m-1]*kk;\n    maxs=a[m]-1;\n    for (int i=1;i<=m;++i)\n    {\n        int x,y=-1;\n        scanf(\"%d\",&x);\n        if (i!=1&&x==y)\n        {\n            printf(\"%d\\n\",0);\n            return 0;\n        }\n        s1=s1*kk+x;\n        y=x;\n    }\n    for (int i=1;i<=m;++i)\n    {\n        int x,y=-1;\n        scanf(\"%d\",&x);\n        if (i!=1&&x==y)\n        {\n            printf(\"%d\\n\",0);\n            return 0;\n        }\n        s2=s2*kk+x;\n        y=x;\n    }\n    dp[0][s1]=1;\n    now=0;\n    for (register int i=1;i<n;++i)\n        for (register int j=1;j<=m;++j)\n        {\n        \tif (i==1&&j!=m) continue;\n        \tif (i==n-1&&j==m) break;\n        \tif (j==m) can=1;\n        \telse can=0;\n            now=now^1;\n            for (register int k=0;k<=maxs;++k) dp[now][k]=0;\n        \tfor (register int k=0;k<=maxs;++k)\n        \t{\n        \t\tif (dp[now^1][k]==0) continue;//\u53bb\u6389\u5bf9\u7b54\u6848\u65e0\u8d21\u732e\u7684\u72b6\u6001\uff0c\u8282\u7ea6\u65f6\u95f4\n                for (register int p=0;p<kk;++p)\n        \t        put(p,k,can);\n            }\t   \n        }\n    for (register int i=0;i<=maxs;++i)\n        if (check(i,s2)) ans=(ans+dp[now][i])%mod;\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n```\n\u7136\u540e\u5c31accepted\u4e86\n\n\u65f6\u95f4808ms,\u5185\u5b583860KB,\u4ee3\u7801\u957f\u5ea64.08KB\n\n\u611f\u8c22\u5927\u4f6c\u4eec\u7684\u89c2\u8d4f\n",
        "postTime": 1556976887,
        "uid": 36957,
        "name": "RainFestival",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2435 \u3010\u67d3\u8272\u3011"
    },
    {
        "content": "\u63d2\u5934dp \u5165\u95e8\u4e0a\u624b\u9898\u3002\n\n---\n\n$k=2$ \u7684\u6570\u636e\u70b9\u663e\u7136\u7b54\u6848\u8981\u4e48\u662f $0$ \u8981\u4e48\u662f $1$\uff0c\u76f4\u63a5\u7279\u5224\u89e3\u51b3\u3002\n\n\u5bf9\u4e8e $k=3,4$ \u7684\u6570\u636e\u70b9\uff1a\n\n\u9996\u5148\u5f88\u5bb9\u6613\u60f3\u5230\u628a\u6bcf\u884c\u72b6\u538b\u4e00\u4e0b\u7136\u9e45\u7b97\u4e00\u4e0b\u5c31\u4f1a\u53d1\u73b0\u8fc7\u4e0d\u53bb\u3002\n\n\u770b\u4e00\u4e0b $k$ \u7684\u8303\u56f4\u548c **\u201c\u6ca1\u6709\u4e24\u4e2a\u76f8\u90bb\u70b9\u989c\u8272\u76f8\u540c\u201d** \u8fd9\u4e2a\u9650\u5236\u4e0d\u96be\u60f3\u5230\u53ef\u4ee5\u4f7f\u7528\u63d2\u5934dp \uff08\u8f6e\u5ed3\u7ebfdp\uff09\u6765\u89e3\u51b3\u3002\n\n\u8f6e\u5ed3\u7ebf\u4e0a\u7684\u63d2\u5934\u7684\u72b6\u6001\u7528 $4$ \u8fdb\u5236\u8868\u793a\uff08\u5171 $m+1$ \u4f4d\uff09\u3002\u6bcf\u4e00\u4f4d\u4ee3\u8868\u4e0e\u4e4b\u76f8\u90bb\u7684\u683c\u5b50\u7684\u989c\u8272\u3002\n\n\u4e3e\u4e2a\u4f8b\u5b50\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/yflitz64.png)\n\n\u6a59\u8272\u4e09\u89d2\u662f\u73b0\u5728\u6b63\u5728dp\u7684\u4f4d\u7f6e\uff0c\u63d2\u5934\u5df2\u7528\u7d2b\u8272\u7bad\u5934\u6807\u51fa\u3002\n\n\u8f6e\u5ed3\u7ebf\u4e0a\u7684dp\u72b6\u6001\u662f\uff1a$0\\times 4^0+1\\times 4^1+0\\times 4^3+2\\times 4^4+2\\times 4^5+3\\times 4^6+1\\times 4^7+0\\times 4^8+3\\times 4^9$\n\n\u89e3\u7801\u51fa\u4e0e\u5f53\u524ddp\u4f4d\u7f6e\u76f8\u90bb\u7684\u63d2\u5934\u5373\u7b2c $j-1$ \u4f4d\u548c\u7b2c $j$ \u4f4d\uff08\u6bd4\u5982\u4e0a\u56fe\u7684\u7b2c $5$ \u4f4d\u548c\u7b2c $6$ \u4f4d\uff09\uff0c\u90a3\u4e48\u5f53\u524d\u4f4d\u7f6e\u5c31\u4e0d\u80fd\u586b\u4e0e\u76f8\u90bb\u63d2\u5934\u76f8\u540c\u7684\u6570\u3002\n\n\u4f8b\u5982\u4e0a\u56fe\u6a59\u8272\u4f4d\u7f6e\u53ea\u80fd\u586b $0$ \u6216 $4$\uff0c\u7136\u540e\u66f4\u6539\u7b2c $4$ \u4f4d\u548c\u7b2c $5$ \u4f4d\u7684\u63d2\u5934\u5373\u53ef\u3002\n\n\u72b6\u6001\u4e0a\u754c\u867d\u7136\u662f $4^{m+1}$ \u4f46\u662f\u5927\u90e8\u5206\u72b6\u6001\u90fd\u662f\u65e0\u7528\u7684\uff0c\u6240\u4ee5\u8981\u628a\u72b6\u6001\u7528\u54c8\u5e0c\u8868\u5b58\u4e00\u4e0b\uff0c\u6bcf\u6b21\u53ea\u8f6c\u79fb\u6709\u7528\u7684\u72b6\u6001\u5373\u53ef\u3002\n\n\u53e6\u5916\u6ce8\u610f\u4e00\u4e9b\u8fb9\u754c\u60c5\u51b5\u6bd4\u5982\u5f53 $j=1$ \u7684\u65f6\u5019\u548c\u5f53 $i=n-1$ \u7684\u65f6\u5019\u9700\u8981\u52a0\u4e00\u4e9b\u7279\u5224\u3002\u5177\u4f53\u89c1\u4ee3\u7801\u3002\n\n***code\uff1a***\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<vector>\nusing namespace std;\nconst int mod=376544743;\nconst int base=40001;\ninline int read(){\n    int x=0,f=1;\n    char c=getchar();\n    while(c<'0'||c>'9'){\n        if(c=='-')f=-1;\n        c=getchar();\n    }\n    while(c>='0'&&c<='9'){\n        x=(x<<3)+(x<<1)+c-'0';\n        c=getchar();\n    }\n    return x*f;\n}\nint n,m,K,a[20],ans; \nint q[2][1<<18],now,val[2][1<<18],cnt[2],head[40005],nxt[1<<18],pw4[20];\nvoid Insert(int x,int w){         //\u63d2\u5165\u54c8\u5e0c\u8868\n\tint u=x%base;\n\tfor(int i=head[u];i;i=nxt[i]){\n\t\tif(q[now][i]==x){\n\t\t\tval[now][i]=(val[now][i]+w)%mod;\n\t\t\treturn;\n\t\t}\n\t}\n\tnxt[++cnt[now]]=head[u];\n\tq[now][cnt[now]]=x;\n\tval[now][cnt[now]]=w;\n\thead[u]=cnt[now];\n}\nint main(){\n\tn=read(),m=read(),K=read();\n\tif(K==2){\n\t\tvector<int> tmp(m,0);\n\t\tfor(int i=0;i<m;++i){\n\t\t\ttmp[i]=read();\n\t\t}\n\t\tfor(int i=0;i<m;++i){\n\t\t\tint x=read();\n\t\t\tif((n&1)^(x==tmp[i])){\n\t\t\t\tprintf(\"0\\n\");\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t\tprintf(\"1\\n\");\n\t\treturn 0;\n\t}\n\tpw4[0]=1;\n\tfor(int i=1;i<=10;++i){\n\t\tpw4[i]=pw4[i-1]<<2;\n\t}\n\tq[now=0][1]=0,cnt[now]=1,val[now][1]=1;\n\tfor(int i=1;i<=m;++i){\n\t\tint x=read();\n\t\tq[now][1]|=(x<<((i-1)*2));\n\t}\n\tfor(int i=1;i<=m;++i){\n\t\ta[i]=read();\n\t}\n\tfor(int i=2;i<n;++i){\n\t\tfor(int k=1;k<=cnt[now];++k){\n\t\t\tq[now][k]<<=2;\n\t\t}\n\t\tfor(int j=1;j<=m;++j){\n\t\t\tnow^=1;\n\t\t\tcnt[now]=0;\n\t\t\tmemset(head,0,sizeof(head));\n\t\t\tfor(int k=1;k<=cnt[now^1];++k){\n\t\t\t\tint x=q[now^1][k],w=val[now^1][k];\n\t\t\t\tint b1=(x>>((j-1)<<1))&3;  //\u5de6\u63d2\u5934\n\t\t\t\tint b2=(x>>(j<<1))&3;      //\u4e0a\u63d2\u5934\n\t\t\t\tx-=b1*pw4[j-1]+b2*pw4[j];\n\t\t\t\tif(j==1)b1=-1;             //j=1\u7684\u65f6\u5019\u5de6\u63d2\u5934\u662f\u7a7a\u7684\n\t\t\t\tfor(int c=0;c<K;++c){\n\t\t\t\t\tif(c==b1||c==b2||(i==n-1&&c==a[j]))continue; //\u4e0d\u80fd\u4e0e\u76f8\u90bb\u683c\u5b50\u989c\u8272\u76f8\u540c\u3002\n\t\t\t\t\tif(i==n-1&&j==m){                           //\u5df2\u7ecf\u5230\u6700\u540e\u4e00\u4e2a\u4e86\u76f4\u63a5\u6dfb\u52a0\u5230\u7b54\u6848\u91cc\u9762\u3002\n\t\t\t\t\t\tans=(ans+w)%mod;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tInsert(x+c*(pw4[j-1]+pw4[j]*(j<m)),w);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n\n```\n\n[*Froggy's blog*](https://www.luogu.org/blog/1445353309froggy/)\n\n#### \u5471!!\n",
        "postTime": 1588064570,
        "uid": 100285,
        "name": "Froggy",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P2435 \u3010\u67d3\u8272\u3011"
    },
    {
        "content": "\u5b66\u5230\u4e86...\u8f6e\u5ed3\u7ebf$dp$\n\n\u9996\u5148\u8003\u8651\u5e38\u89c4\u72b6\u538b\uff0c$f[i][S]$\u8868\u793a\u524d$i$\u884c \u7b2c$i$\u884c\u72b6\u6001\u4e3a$S$\u7684\u65b9\u6848\u6570\uff0c\u8f6c\u79fb\u65b9\u7a0b$f[i][S]=\\sum\\limits_{S\\cap T=\\varnothing}f[i-1][T]$.\u53ef\u4ee5\u8bc1\u660e\u6709\u7528\u7684$S$\u662f$k(k-1)^{m-1}$\u4e2a\uff0c\u603b\u590d\u6742\u5ea6$O(n(k-1)^{2m-2})$\uff0c\u8dd1\u4e0d\u8fc7\u53bb.\n\n\u8f6e\u5ed3\u7ebf$dp$\u7684\u72b6\u6001\u662f$f[i][j][S]$\uff0c\u8868\u793a\u8be5\u586b\u7b2c$i$\u884c\u7b2c$j$\u5217\uff0c\u4e0b\u56fe\u7ea2\u8272\u90e8\u5206\u7684\u72b6\u6001\u4e3a$S$\u65f6\u7684\u65b9\u6848\u6570.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/p4dtq2gc.png)\n\n(\u7eff\u8272\u90e8\u5206\u5373\u5f85\u586b\u683c\u5b50)\n\n\u7136\u540e\u6211\u4eec\u4f7f\u7528\u5237\u8868\u6cd5\u8f6c\u79fb\uff0c\u679a\u4e3e\u7eff\u8272\u683c\u5b50\u586b\u54ea\u79cd\u989c\u8272\uff0c\u5982\u679c\u8fd9\u4e2a\u989c\u8272\u65e2\u4e0d\u7b49\u4e8e\u4e0a\u9762\u90a3\u4e2a\u683c\u5b50\u7684\u989c\u8272\u53c8\u4e0d\u7b49\u4e8e\u4e0b\u9762\u90a3\u4e2a\u683c\u5b50\u7684\u989c\u8272\u5c31\u52a0\u4e0a\u5f53\u524d\u7b54\u6848\uff0c\u65b0\u7684\u72b6\u6001\u5c31\u957f\u4e0b\u9762\u8fd9\u6837.\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/trh2witp.png)\n\n\u6ce8\u610f\u7b2c\u4e00\u5217\u5de6\u8fb9\u6ca1\u6709\u683c\u5b50\uff0c\u53ea\u9700\u8981\u4e0d\u7b49\u4e8e\u4e0a\u9762\u7684\u683c\u5b50\u7684\u989c\u8272\u5373\u53ef.\n\n\u8fd9\u6837\u590d\u6742\u5ea6\u5c31\u662f$O(nmk^{m+1})$\u4e86.\u521a\u597d\u80fd\u8dd1\u8fc7\u53bb\uff0c\u4e0d\u8fc7\u5b9e\u9645\u4e0a\u8dd1\u5f97\u5f88\u5feb.\n\n\u4ee3\u7801\u8fd8\u662f\u633a\u597d\u5199\u7684.\u4ee5\u4e0b\u7684\u4ee3\u7801\u4e3a\u4e86\u6781\u81f4\u5361\u5e38\u628a\u989c\u8272\u6570\u5206\u5f00\u5e76\u4e14\u5c55\u5f00\u4e86\u679a\u4e3e\u989c\u8272\u7684\u4e00\u5c42\u5faa\u73af.\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nconst int mod=376544743;\nint n,m,k,tmp1[1200000],pw[20],f[2][200000];\nvoid print(int S)\n{\n    for(int i=0;i<m;i++)printf(\"%d\",S%k),S/=k;\n    putchar(' ');\n}\nint main()\n{\n    scanf(\"%d%d%d\",&n,&m,&k);int x;\n    if(k==2)//2\u7684\u65f6\u5019\u8981\u7279\u5224\uff0c\u8fd9\u4e2a\u753b\u753b\u56fe\u5c31\u51fa\u6765\u4e86\n    {\n        for(int i=1;i<=m;i++)scanf(\"%d\",&tmp1[i]);\n        for(int i=1;i<=m;i++)\n        {\n            scanf(\"%d\",&x);\n            if(n&1){if(x!=tmp1[i]){puts(\"0\");return 0;}}\n            else{if(x==tmp1[i])puts(\"0\");return 0;}\n        }\n        puts(\"1\");return 0;\n    }\n    if(k==3)//\u4e09\u8fdb\u5236\u72b6\u538b\u548c\u56db\u8fdb\u5236\u72b6\u538b\u4f7f\u7528\u4e0d\u540c\u65b9\u5f0f\u5904\u7406\uff0c\u56e0\u4e3a\u56db\u8fdb\u5236\u53ef\u4ee5\u4f7f\u7528\u4f4d\u8fd0\u7b97\u52a0\u901f\n    {\n        int s1=0,s2=0;\n        pw[0]=1;for(int i=1;i<=m;i++)pw[i]=pw[i-1]*3;\n        for(int i=1;i<=m;i++)scanf(\"%d\",&x),s1+=pw[i-1]*x;\n        for(int i=1;i<=m;i++)scanf(\"%d\",&x),s2+=pw[i-1]*x;\n        int nw=0;f[0][s1]=1;const int lim=pw[m];\n        for(int i=2;i<=n;i++)\n            for(int j=1;j<=m;j++)//\u679a\u4e3e\u884c\u5217\n            {\n                for(int S=0;S<lim;S++)f[nw^1][S]=0;//\u679a\u4e3e\u72b6\u6001.\u8fd9\u91cc\u4f7f\u7528\u4e86\u6eda\u52a8\u6570\u7ec4\u51cf\u5c0f\u5e38\u6570\n                if(j==1)//\u7b2c\u4e00\u5217\u7279\u5224\n                {\n                    for(int S=0;S<lim;S++)\n                    {\n                        int tmp=f[nw][S];if(!tmp)continue;//\u53bb\u6389\u65e0\u7528\u72b6\u6001\n                        int t=S%3;\n                        if(t!=0)(f[nw^1][S-t]+=tmp)%=mod;//\u4e0d\u7b49\u4e8e\u4e0a\u65b9\u683c\u5b50.\u65b0\u7684\u72b6\u6001\u5c31\u662fS\u53bb\u6389\u539f\u6765\u7684\u52a0\u4e0a\u73b0\u5728\u7684\n                        if(t!=1)(f[nw^1][S+(1-t)]+=tmp)%=mod;\n                        if(t!=2)(f[nw^1][S+(2-t)]+=tmp)%=mod;   \n                    }\n                }\n                else\n                {\n                    for(int S=0;S<lim;S++)\n                    {\n                        int tmp=f[nw][S];if(!tmp)continue;\n                        int t=S/pw[j-1]%3,t2=S/pw[j-2]%3; \n                        if(t!=0&&t2!=0)(f[nw^1][S-t*pw[j-1]]+=tmp)%=mod;     \n                        if(t!=1&&t2!=1)(f[nw^1][S+(1-t)*pw[j-1]]+=tmp)%=mod;  \n                        if(t!=2&&t2!=2)(f[nw^1][S+(2-t)*pw[j-1]]+=tmp)%=mod;  \n                    }                    \n                }\n                nw^=1;\n //               for(int S=0;S<pw[m];S++)print(S),printf(\"%d\\n\",f[nw][S]);\n   //             puts(\"\");\n            }\n        printf(\"%d\\n\",f[nw][s2]);\n    }\n    else\n    {\n        int s1=0,s2=0;\n        for(int i=1;i<=m;i++)scanf(\"%d\",&x),s1|=x<<((i-1)<<1);//\u4ee5\u4e0b\u90fd\u662f\u4f4d\u8fd0\u7b97\u52a0\u901f\n        for(int i=1;i<=m;i++)scanf(\"%d\",&x),s2|=x<<((i-1)<<1);\n        int nw=0;f[0][s1]=1;const int lim=1<<(m<<1);\n        for(int i=2;i<=n;i++)\n            for(int j=1;j<=m;j++)\n            {\n                for(int S=0;S<lim;S++)f[nw^1][S]=0;\n                if(j==1)\n                {\n                    for(int S=0;S<lim;S++)\n                    {\n                        int tmp=f[nw][S];if(!tmp)continue;\n                        int t=S&3;\n                        if(t!=0)(f[nw^1][S^t]+=tmp)%=mod;\n                        if(t!=1)(f[nw^1][S^(1^t)]+=tmp)%=mod;\n                        if(t!=2)(f[nw^1][S^(2^t)]+=tmp)%=mod;   \n                        if(t!=3)(f[nw^1][S^(3^t)]+=tmp)%=mod;                                                                                         \n                    }\n                }\n                else\n                {\n                    for(int S=0;S<lim;S++)\n                    {\n                        int tmp=f[nw][S];if(!tmp)continue;\n                        int t=S>>((j-1)<<1)&3,t2=S>>((j-2)<<1)&3; \n                        if(t!=0&&t2!=0)(f[nw^1][S^(t<<((j-1)<<1))]+=tmp)%=mod;     \n                        if(t!=1&&t2!=1)(f[nw^1][S^((1^t)<<((j-1)<<1))]+=tmp)%=mod;  \n                        if(t!=2&&t2!=2)(f[nw^1][S^((2^t)<<((j-1)<<1))]+=tmp)%=mod;  \n                        if(t!=3&&t2!=3)(f[nw^1][S^((3^t)<<((j-1)<<1))]+=tmp)%=mod;                                                                                                          \n                    }                    \n                }\n                nw^=1;\n //               for(int S=0;S<pw[m];S++)print(S),printf(\"%d\\n\",f[nw][S]);\n   //             puts(\"\");\n            }\n        printf(\"%d\\n\",f[nw][s2]);\n    }\n}\n```\n\n\u8f6e\u5ed3\u7ebfdp\u53ef\u4ee5\u7528\u5728\u5f88\u591a\u72b6\u538b\u9898\u4e0a\u5427.\u4e0d\u8fc7\u666e\u901a\u72b6\u538b\u6709\u4e2a\u4f18\u52bf\u5c31\u662f\u53ef\u4ee5\u77e9\u9635\u52a0\u901f\uff0c\u8f6e\u5ed3\u7ebf\u72b6\u538b\u4e0d\u592a\u65b9\u4fbf\u77e9\u9635\u52a0\u901f...",
        "postTime": 1569119381,
        "uid": 22136,
        "name": "qwaszx",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P2435 \u3010\u67d3\u8272\u3011"
    },
    {
        "content": "\u76ee\u524d\u9898\u89e3\u533a\u90fd\u662f\u8f6e\u5ed3\u7ebf DP \u505a\u6cd5\uff0c\u6240\u4ee5\u6211\u6765\u8865\u4e00\u7bc7\u666e\u901a\u72b6\u538b DP \u505a\u6cd5\u3002\n\n\u76f4\u63a5\u66b4\u529b\u72b6\u538b\u590d\u6742\u5ea6\u663e\u7136\u662f $O(n \\cdot k^{2m} \\cdot m)$ \u663e\u7136\u8fc7\u4e0d\u53bb\u3002\n\n\u4f46\u662f\u53ef\u4ee5\u53d1\u73b0\u5408\u6cd5\u7684\u72b6\u6001\u6570\u91cf\u5e76\u4e0d\u591a\uff0c\u6240\u4ee5\u6211\u4eec\u9884\u5904\u7406\u51fa\u6240\u6709\u5408\u6cd5\u7684\u72b6\u6001\u5c31\u80fd\u591f\u52a0\u901f\u72b6\u538b DP\u3002\n\n\u8bbe\u5355\u72ec\u4e00\u884c\u7684\u5408\u6cd5\u72b6\u6001\u6570\u91cf\u4e3a $cnt$\uff0c\u76f8\u90bb\u4e24\u884c\u7684\u5408\u6cd5\u72b6\u6001\u6570\u91cf\u4e3a $tot$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u9884\u5904\u7406\u5355\u72ec\u4e00\u884c\u7684\u5408\u6cd5\u72b6\u6001\u662f $O(k^m)$\uff0c\u9884\u5904\u7406\u76f8\u90bb\u4e24\u884c\u7684\u5408\u6cd5\u72b6\u6001\u662f $O(cnt^2)$\uff0c\u72b6\u538b DP \u7684\u590d\u6742\u5ea6\u4f18\u5316\u4e3a $O(n \\cdot tot)$\uff0c\u6240\u4ee5\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(k^m+cnt^2+n \\cdot tot)$\u3002\n\n\u6700\u574f\u60c5\u51b5 $m=8,\\ k=4$ \u65f6\uff0c\u53ef\u4ee5\u53d1\u73b0 $cnt=8748,\\ tot=9882516$\uff0c\u6240\u4ee5\u8fd9\u4e2a\u505a\u6cd5\u7684\u8fd0\u7b97\u91cf\u6700\u574f\u5927\u7ea6\u662f $10^9$ \u7ea7\u522b\u7684\uff0c\u65f6\u9650 2s \u7a0d\u5fae\u5361\u5361\u5e38\u5c31\u80fd\u5f88\u8f7b\u677e\u51b2\u8fc7\u53bb\uff0c\u5b9e\u9645\u4e0a\u6211\u7684\u4ee3\u7801\u6700\u6162\u7684\u70b9\u8dd1\u4e86\u4e0d\u5230 0.9s\u3002\n\n\u81f3\u4e8e\u4ee3\u7801\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u53ef\u4ee5\u7528\u4e24\u4e2a\u4e8c\u8fdb\u5236\u4f4d\u6765\u8868\u793a\u4e00\u4e2a\u56db\u8fdb\u5236\u4f4d\uff0c\u6ce8\u610f\u7279\u5224\u6389 $k=2$ \u7684\u60c5\u51b5\u4ee5\u53ca $k=3$ \u9884\u5904\u7406\u5355\u72ec\u4e00\u884c\u7684\u5408\u6cd5\u72b6\u6001\u65f6\u6709\u4e00\u79cd\u989c\u8272\u4e0d\u80fd\u7528\u3002\n\n```cpp\nconst int N = 105, M = 1e4;\nconst ll p = 376544743;\nint n, m, _2m, k, cnt, tot, id[1 << 16];\nunsigned int lim, chk, a[M];\nvector<int> b[M];\nll dp[N][M];\n\nint main()\n{\n\tread(n, m, k);\n\tif (k == 2)\n\t{\n\t\tunsigned int S = 0, T = 0;\n\t\tfor (int x, i = 1; i <= m; ++i) read(x), S = S << 1 | x;\n\t\tfor (int x, i = 1; i <= m; ++i) read(x), T = T << 1 | x;\n\t\tif (n & 1) puts(S ^ T ? \"0\" : \"1\");\n\t\telse puts(S ^ ~T ? \"0\" : \"1\");\n\t\treturn 0;\n\t}\n\t_2m = m << 1; lim = 1 << _2m; chk = 1;\n\tfor (int i = 2; i <= m; ++i) chk = chk << 2 | 1;\n\tfor (unsigned int S = 0; S < lim; ++S)\n\t{\n\t\tif (k == 3 && S & S >> 1 & chk) continue;\n\t\tunsigned int T = ~(S ^ S >> 2) & ~(3 << _2m - 2);\n\t\tif (T & T >> 1 & chk) continue;\n\t\ta[++cnt] = S, id[S] = cnt;\n//\t\tcerr << bitset<16>(S) << '\\n';\n\t}\n//\tcerr << cnt << '\\n';\n\tfor (int i = 1; i <= cnt; ++i)\n\t\tfor (int j = i + 1; j <= cnt; ++j)\n\t\t{\n\t\t\tunsigned int S = ~(a[i] ^ a[j]);\n\t\t\tif (S & S >> 1 & chk) continue;\n\t\t\tb[i].emplace_back(j), b[j].emplace_back(i);\n//\t\t\ttot += 2;\n\t\t}\n//\tcerr << tot << '\\n';\n\tunsigned int S = 0, T = 0;\n\tfor (int x, i = 1; i <= m; ++i) read(x), S = S << 2 | x;\n\tfor (int x, i = 1; i <= m; ++i) read(x), T = T << 2 | x;\n\tdp[1][id[S]] = 1;\n\tfor (int i = 2; i <= n; ++i)\n\t\tfor (int j = 1; j <= cnt; ++j)\n\t\t{\n\t\t\tfor (int k = 0; k < b[j].size(); ++k)\n\t\t\t\tdp[i][j] += dp[i - 1][b[j][k]];\n\t\t\tdp[i][j] %= p;\n\t\t}\n\tprint(dp[n][id[T]]);\n\tflush_pbuf(); return 0;\n}\n```",
        "postTime": 1648780046,
        "uid": 178910,
        "name": "_jhq",
        "ccfLevel": 6,
        "title": "P2435 \u67d3\u8272 \u9898\u89e3"
    },
    {
        "content": "### \u9898\u610f\n\n- \u6709 $n\\times m$ \u7684\u683c\u70b9\u56fe\uff0c\u6bcf\u4e2a\u70b9\u6709 $k$ \u79cd\u989c\u8272\uff0c\u8981\u6c42\u76f8\u90bb\u70b9\u989c\u8272\u4e0d\u540c\u3002\u7ed9\u5b9a\u7b2c $1$ \u884c\u3001\u7b2c $n$ \u884c\u7684\u989c\u8272\uff0c\u6c42\u5408\u6cd5\u67d3\u8272\u65b9\u6848\u6570\u3002\n- \u5927\u591a\u6570\u6570\u636e\uff1a$n\\leq 100$\uff0c$m\\leq 8$\uff0c$k\\leq 4$\u3002\n- \u67d0\u4e2a\u5751\u70b9\uff08\u4e13\u5751\u6211\u8fd9\u79cd\u9898\u4e0d\u8bfb\u5168\u7684\uff09\uff1a$n\\leq1e7$\uff0c$m\\leq 1e5$\uff0c$k=2$\u3002\n\n### \u5206\u6790\n\n\u5bf9\u4e8e $k=2$ \u7684\u60c5\u51b5\uff0c\u663e\u7136\u552f\u4e00\u5408\u6cd5\u7684\u67d3\u8272\u65b9\u6848\u5c31\u662f $0$\u3001$1$ \u4ea4\u66ff\u51fa\u73b0\uff0c\u5229\u7528\u5947\u5076\u6027\u7279\u5224\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u5bf9\u4e8e $k > 2$ \u7684\u60c5\u51b5\uff0c\u8003\u8651\u8f6e\u5ed3\u7ebfdp\u3002\u8bbe\u8ba1\u72b6\u6001\uff1a$dp_{i,j,S}$ \u8868\u793a\u7b2c $i$ \u884c\u7b2c $j$ \u5217\uff0c\u8f6e\u5ed3\u7ebf\u72b6\u6001\u4e3a $S$ \u7684\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u65f6\u679a\u4e3e $i$\uff0c$j$\uff0c$S$ \u4ee5\u53ca\u4e0b\u4e00\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u989c\u8272\uff0c\u5408\u6cd5\u5219\u66f4\u65b0\uff0c\u53ef\u4ee5\u628a\u524d\u4e24\u7ef4\u6eda\u52a8\u4f18\u5316\u6389\u3002\u8bb0\u7b2c $1$ \u884c\u7684\u8f6e\u5ed3\u7ebf\u72b6\u6001\u4e3a $S_1$\uff0c\u7b2c $n$ \u884c\u8f6e\u5ed3\u7ebf\u72b6\u6001\u4e3a $S_n$\uff0c\u5219\u521d\u59cb\u5316 $dp_{S_1}$ \u4e3a $1$\uff0c\u6700\u7ec8\u7b54\u6848\u5373\u4e3a $dp_{S_n}$\u3002\n\n\u5b9e\u73b0\u4e2d\u5c06\u8f6e\u5ed3\u7ebf\u538b\u7f29\u4e3a\u4e00\u4e2a $m$ \u4f4d $k$ \u8fdb\u5236\u6570\uff0c\u9047\u5230 $dp_S=0$ \u7684\u4e0d\u5408\u6cd5\u72b6\u6001\u76f4\u63a5continue\u3002\n\n\u590d\u6742\u5ea6\u5927\u7ea6 $O(nmk^m)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include <iostream>\n#include <cstdio>\n\nusing namespace std;\n\nconst int P = 376544743;\nint n, m, k;\nint dp[2][362144], s1, sn, mx, p[10];\nint a[100005], b[100005];\n\nint main() {\n\tscanf(\"%d %d %d\", &n, &m, &k);\n\tif (k == 2) {\n\t\tbool flag = 1;\n\t\tfor (int i = 1; i <= m; i++) scanf(\"%d\", a+i), flag &= (i==1||a[i]!=a[i-1]);\n\t\tfor (int i = 1; i <= m; i++) scanf(\"%d\", b+i), flag &= (i==1||b[i]!=b[i-1]);\n\t\tfor (int i = 1; i <= m; i++) flag &= (((a[i]+n)&1)!=b[i]);\n\t\tif (flag) printf(\"1\\n\");\n\t\telse printf(\"0\\n\");\n\t\treturn 0;\n\t}\n\tint tmp;\n\tp[0] = 1;\n\tfor (int i = 1; i <= m; i++) {\n\t\tscanf(\"%d\", &tmp);\n\t\ts1 += p[i-1]*tmp;\n\t\tp[i] = p[i-1]*k;\n\t}\n\tfor (int i = 1; i <= m; i++) {\n\t\tscanf(\"%d\", &tmp);\n\t\tsn += p[i-1]*tmp;\n\t}\n\tmx = p[m];\n\tdp[0][s1] = 1;\n\tint now = 1;\n\tfor (int i = 2; i <= n; i++) {\n\t\tfor (int st = 0; st < mx; st++) dp[now][st] = 0;\n\t\tfor (int st = 0; st < mx; st++) {\n\t\t\tif (dp[now^1][st]==0) continue;\n\t\t\t//printf(\"st = %d, dp = %d\\n\", st, dp[now^1][st]);\n\t\t\tint _c = st%k;\n\t\t\tfor (int col = 0; col < k; col++) if (col != _c) (dp[now][st-_c+col] += dp[now^1][st]) %= P;\n\t\t}\n\t\tnow ^= 1;\n\t\tfor (int j = 2; j <= m; j++) {\n\t\t\tfor (int st = 0; st < mx; st++) dp[now][st] = 0;\n\t\t\tfor (int st = 0; st < mx; st++) {\n\t\t\t\tif (dp[now^1][st]==0) continue;\n\t\t\t\t//printf(\"st = %d, dp = %d\\n\", st, dp[now^1][st]);\n\t\t\t\tint _c1 = (st/p[j-2])%k, _c2 = (st/p[j-1])%k;\n\t\t\t\tfor (int col = 0; col < k; col++) if (col!=_c1&&col!=_c2) (dp[now][st+p[j-1]*(col-_c2)] += dp[now^1][st]) %= P;\n\t\t\t}\n\t\t\tnow ^= 1;\n\t\t}\n\t}\n\tprintf(\"%d\\n\", dp[now^1][sn]);\n\treturn 0;\n}\n```\n",
        "postTime": 1633828420,
        "uid": 189044,
        "name": "Celebrimbor",
        "ccfLevel": 7,
        "title": "P2435 \u9898\u89e3"
    },
    {
        "content": "# \u8f6e\u5ed3\u7ebfDP\n\u8fd9\u9053\u9898\u6709\u5f88\u663e\u7136\u7684\u72b6\u538b\u505a\u6cd5\uff0c\u7136\u800c\u76f4\u63a5\u72b6\u538b\u662f\u4f1aT\u98de\u7684\uff0c\u6700\u591a\u53ea\u80fd\u62ff\u523080PTS \n\n\u6240\u4ee5\u8fd9\u65f6\u6211\u4eec\u8981\u5f15\u51fa\u4e00\u4e2a\u65b0\u7684\u72b6\u538b\u6280\u5de7---\u8f6e\u5ed3\u7ebf\u72b6\u538b  \n\n\u6240\u8c13\u8f6e\u5ed3\u7ebf\u72b6\u538b\uff0c\u987e\u540d\u601d\u4e49\u5c31\u662f\u72b6\u538b\u4e00\u6761\u7ebf  \n\n\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5047\u8bbe\u6211\u4eec\u8981\u66f4\u65b0\u7eff\u8272\u683c\u70b9\u5bf9\u7b54\u6848\u7684\u5f71\u54cd\uff0c\u6211\u4eec\u4e4b\u524d\u72b6\u538b\u7684\u5c31\u662f\u7ea2\u8272\u7684\u8fd9\u6761\u7ebf\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u6839\u636e\u9898\u76ee\u7684\u5177\u4f53\u89c4\u5219\u8fdb\u884c\u5237\u8868\u8f6c\u79fb\uff0c\u679a\u4e3e\u8fd9\u4e2a\u7eff\u8272\u683c\u70b9\u7684\u6240\u6709\u53ef\u80fd\u53d6\u503c\uff0c\u7136\u540e\u66f4\u65b0\u5230\u84dd\u8272\u683c\u70b9\u5373\u53ef\n![](https://cdn.jsdelivr.net/gh/Tian-Xing/cdn@3.0.3/picture/\u6d1b\u8c37P2435%20\u67d3\u8272%20\u8f6e\u5ed3\u7ebfDP.png)\n\u9700\u8981\u6ce8\u610f\u7684\u662f\u6bcf\u4e2a\u683c\u70b9\u53ea\u80fd\u66f4\u65b0\u5230\u4e0e\u4ed6\u76f8\u90bb\u7684\u4e0b\u4e00\u4e2a\u683c\u70b9\uff0c\u90a3\u4e48\u6211\u4eec\u6bcf\u6b21\u53ea\u80fd\u5411\u4e00\u4e2a\u72b6\u6001\u66f4\u65b0\uff0c\u518d\u7b97\u4e0a\u8fd9\u6b21\u4f7f\u7528\u7684\u72b6\u6001\u4e00\u5171\u5c31\u662f\u4e24\u4e2a\u72b6\u6001\uff0c\u6240\u4ee5\u8fd9\u91cc\u53ef\u4ee5\u7528\u6eda\u52a8\u6570\u7ec4\u4f18\u5316\u6389\u4e00\u7ef4DP\u72b6\u6001  \n\n\u5177\u4f53\u7684\u5bf9\u4e8e\u8fd9\u4e2a\u9898\u800c\u8a00\u6211\u4eec\u679a\u4e3e\u5f53\u524d\u683c\u70b9\u7684\u989c\u8272\u5982\u679c\u548c\u5b83\u76f8\u90bb\u7684\u683c\u70b9\u548c\u5b83\u989c\u8272\u4e0d\u4e00\u6837\u90a3\u4e48\u5c31\u53ef\u4ee5\u628a\u5b83\u7684\u5f71\u54cd\u52a0\u5165\u7b54\u6848\u5e76\u4e14\u66f4\u65b0\u5230\u4e0b\u4e00\u4e2a\u683c\u70b9\u7684\u72b6\u6001\n# CODE\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <cmath>\nusing namespace std;\n#define re register \n#define ll long long\nconst ll MOD=376544743;\nint n,m,k,head,tail;\nint answer,dp[2][50000050];\nint mi[15];\nint read()\n{\n    int s=0,p=1;\n    char st=getchar();\n    while(st<'0' || st>'9')\n    {\n        if(st=='-')p=-1;\n        st=getchar();\n    }\n    while(st>='0' && st<='9')\n    {\n        s=(s<<1)+(s<<3)+(st^48);\n        st=getchar();\n    }\n    return s*p;\n}\nint find(int x,int j)\n{\n\treturn (x/mi[j-1])%k;\n}\nint change(int x,int j,int y)\n{\n    return x-find(x,j)*mi[j-1]+y*mi[j-1];\n}\nvoid print(int x)\n{\n\tfor(int i=1;i<=m;i++)cout<<x%k,x/=k;\n}\nint ch(int a)\n{\n\tint last,now;\n    last=a%k;\n    a=a/k;\n    for(int i=1;i<=m-1;i++)\n    {\n        now=a%k;\n        if(last==now)return 0;\n        last=now;\n        a=a/k;\n    }\n    return 1;\n}\nint main()\n{\n    n=read();m=read();k=read();\n    int x;\n    for(int i=1;i<=m;i++)x=read(),head=(head*k)+x;\n    for(int i=1;i<=m;i++)x=read(),tail=(tail*k)+x;\n    if(k==2)\n    {\n        if(n%2==0)\n        {\n            if(head==tail)cout<<0;\n            else cout<<1;\n        }\n        else \n        {\n            if(head==tail)cout<<1;\n            else cout<<0;\n        }\n        return 0;\n    }\n    mi[0]=1;\n    for(int i=1;i<=m;i++)mi[i]=mi[i-1]*k;\n    dp[1][head]=1;\n    int r=0;\n    int all=mi[m];\n    for(int i=2;i<=n;i++)\n        for(int j=1;j<=m;j++)\n        {\n            r=r^1;\n            for(int d=0;d<all;d++)dp[r^1][d]=0;\n            for(int d=0;d<all;d++)\n            {\n            \tif(dp[r][d]==0)continue;\n                int lll;\n\t\t\t\tint rr=find(d,j);\n                lll=-1;\n                if(j-1>0)lll=find(d,j-1);\n                for(int p=0;p<=k-1;p++)if(p!=lll && p!=rr)(dp[r^1][change(d,j,p)]+=dp[r][d])%=MOD;\n            }\n        }\n    printf(\"%d\",dp[r^1][tail]%MOD);\n    return 0;\n}\n```",
        "postTime": 1576502689,
        "uid": 73983,
        "name": "Infiltrator",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P2435 \u3010\u67d3\u8272\u3011"
    }
]