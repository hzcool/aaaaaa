[
    {
        "content": "\u8fd9\u662f\u4e00\u9053DP\u9898\uff08\u4e0d\u8981\u95ee\u6211\u4e3a\u4ec0\u4e48\uff09\uff0c\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u8003\u8651\u5462\uff1f\n\n\u6839\u636e\u623f\u5b66\u957f\u7684\u539f\u8bdd\u8bb2\uff1a\n\n\u6b64\u9898\u5c5e\u4e8e\u6839\u636e\u6570\u636e\u8303\u56f4\u731c\u505a\u6cd5\u7cfb\u5217\n\n\u9996\u5148\u611f\u53d7\u4e00\u4e0b\u9898\u610f\uff0c\u50cf\u4e2aDP\n\n\u7136\u540e\u89c2\u5bdf\u6570\u636e\u8303\u56f4\uff0c\u611f\u89c9\u56e0\u8be5\u662f\u4e2a\u4e09\u6b21\u65b9\u7684DP\n\n\u7136\u540e\u53d1\u73b0n\u6bd4m\u5c0f\u4e0d\u5c11\uff0c\u5e94\u8be5\u662fO(n^2 \\* m)\u7684\u3002\u3002\u3002\n\n\uff08\u6b64\u5904\u7701\u7565\u4e00\u4e07\u53e5\u5410\u69fd\uff09\n\n\u8a00\u5f52\u6b63\u4f20\uff0c\u89c2\u5bdf\u4e00\u4e0b\u8fd9\u4e2a\u9898\u7684\u56fe\uff1a\n\n\n\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u975e\u5e38\u5947\u5999\u7684\u6027\u8d28\uff0c\n\n\n\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e2a\u56fe\u5206\u6210\u5341\u4e00\u90e8\u5206\uff0c\u6309\u5217\u679a\u4e3e\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u7b2c\u5341\u4e00\u90e8\u5206\u53ef\u4ee5\u7531\u7b2c\u5341\u90e8\u5206\u8f6c\u79fb\u800c\u6765\uff0c\u4e5f\u53ef\u4ee5\u7531\u81ea\u5df1\u8f6c\u79fb\u800c\u6765\uff08\u56e0\u4e3a\u7b2c\u5341\u4e00\u90e8\u5206\u7684\u957f\u5ea6\u4e0d\u9650\uff09\uff0c\u7b2c\u5341\u90e8\u5206\u540c\u7406\uff0c\u5176\u4ed6\u540c\u7406\uff0c\u6ce8\u610f\u7b2c\u4e03\u90e8\u5206\u53ea\u80fd\u7531\u7b2c\u516d\u90e8\u5206\u8f6c\u79fb\u800c\u6765\uff08\u7b2c\u4e03\u90e8\u5206\u53ea\u80fd\u6709\u4e00\u5217\uff09\uff0c\u7b2c\u4e94\u90e8\u5206\u53ea\u80fd\u7531\u7b2c\u56db\u90e8\u5206\u8f6c\u79fb\u800c\u6765\uff08\u540c\u7406\uff09\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u5c1d\u8bd5\u5199DP\u4e86\uff1a\n\n\u7528fi\u8868\u793a\u7b2ci\u5757\uff0c\u679a\u4e3e\u5217\u8fdb\u884c\u8f6c\u79fb\uff0c\u5927\u6982\u6709\u4ee5\u4e0b\u8f6c\u79fb\uff1a\n\nempty->1,1->1,1->2,2->2,2->3,3->3,3->4,4->4,4->5,5->6,6->6,6->7,7->8,8->8,8->9,9\n\n->9,9->10,10->10,10->11,11->11,11\n\n\u6700\u540e\u8fd8\u662f\u623f\u5b66\u957f\u7684\u8bdd\uff1a\u5927\u529bDP\u5c31\u597d\u5566\uff01\n\n\u9644\u4e0a\u4ee3\u7801\uff1a\n\n\n    \n```cpp\n#include <iostream>    \n#include <cstdio>    \n#include <cstring>    \n#define clear(x) memset(x,-63,sizeof(x))    \nusing namespace std;    \nconst int maxn=155;    \nconst int maxm=505;    \nint n,m,f4,f8,ans,INF;    \nint a[maxm][maxn],s[maxn];    \n```\nint f1[maxn][maxn],f2[maxn][maxn],f3[maxn][maxn],\nf5[maxn][maxn],f6[maxn][maxn],f7[maxn][maxn],\n\nf9[maxn][maxn],f10[maxn][maxn],f11[maxn][maxn],\n\n    \n    \n\n```cpp\n    s1[maxn][maxn],s2[maxn][maxn];    \ninline int read(void){    \n    int x=0,f=1; char ch=getchar();    \n    for(;ch<'0'||ch>'9';ch=getchar()) if(ch=='-') f=-1;    \n    for(;ch>='0'&&ch<='9';x=(x<<3)+(x<<1)+(ch^48),ch=getchar());    \n    return x*f;     \n}    \nint main(int argc, char const *argv[]){    \n    //\u521d\u59cb\u5316    \n    n=read(),m=read();    \n    for(int i=1;i<=n;i++)    \n        for(int j=1;j<=m;j++)    \n            a[j][n-i+1]=read();    \n    clear(f1); clear(f2); clear(f3); clear(f5);    \n    clear(f6); clear(f7); clear(f9); clear(f10);    \n    clear(f11); clear(s1); clear(s2);    \n    INF=-f1[0][0]; f4=f8=ans=-INF;    \n    //DP    \n    for(int j=1;j<=m;j++){    \n        //\u524d\u7f00\u548c    \n        for(int i=1;i<=n;i++) s[i]=s[i-1]+a[j][i];    \n        //\u7b2c\u5341\u4e00\u90e8\u5206    \n        for(int l=1;l<=n;l++)    \n            for(int r=l+2;r<=n;r++)    \n                ans=max(ans,f11[l][r]=max(f11[l][r],f10[l][r])+a[j][l]+a[j][r]);    \n        //\u7b2c\u5341\u90e8\u5206    \n        for(int l=1;l<=n;l++)    \n            for(int r=l+2;r<=n;r++)    \n                f10[l][r]=max(f10[l][r],f9[l][r])+s[r]-s[l-1];    \n        //\u7b2c\u4e5d\u90e8\u5206    \n        for(int l=1;l<=n;l++)    \n            for(int r=l+2;r<=n;r++)    \n                f9[l][r]=max(f9[l][r],f8)+a[j][l]+a[j][r];    \n        //\u7b2c\u516b\u90e8\u5206    \n        for(int l=1;l<=n;l++)    \n            for(int r=l+2;r<=n;r++)    \n                f8=max(f8,f7[l][r]);    \n        //\u7b2c\u4e03\u90e8\u5206    \n        for(int l=1;l<=n;l++)    \n            for(int r=l+2;r<=n;r++)    \n                f7[l][r]=f6[l][r]+s[r]-s[l-1];    \n        //\u7b2c\u516d\u90e8\u5206    \n        for(int l=1;l<=n;l++)    \n            for(int r=l+2;r<=n;r++)    \n                f6[l][r]=max(f6[l][r],f5[l][r])+a[j][l]+a[j][r];    \n        //\u7b2c\u4e94\u90e8\u5206    \n        for(int l=1;l<=n;l++)    \n            for(int r=l+2;r<=n;r++)    \n                f5[l][r]=f4+s[r]-s[l-1];    \n        //\u7b2c\u56db\u90e8\u5206    \n        for(int l=1;l<=n;l++)    \n            for(int r=l+1;r<=n;r++)    \n                f4=max(f4,f3[l][r]);    \n        //\u8fd9\u91cc\u6709\u70b9\u4e0d\u4e00\u6837\uff0c\u81ea\u884c\u4f53\u4f1a    \n        for(int l=1;l<=n;l++){    \n            int tmp=-INF;    \n            for(int r=l+1;r<=n;r++)    \n                tmp=max(tmp,f2[l][r-1]),f3[l][r]=max(f3[l][r],tmp)+s[r]-s[l-1];    \n        }    \n        //\u540c\u7406,\u4f46\u8981\u53cd\u8fc7\u6765\u5904\u7406    \n        for(int r=1;r<=n;r++){    \n            int tmp=s2[r+1][r];    \n            for(int l=r;l;l--)    \n                tmp=max(tmp,s2[l][r]),f2[l][r]=max(s1[l-1][r],tmp)+s[r]-s[l-1];    \n        }    \n        //\u7b2c\u4e00\u90e8\u5206    \n        for(int l=1;l<=n;l++)    \n            for(int r=l;r<=n;r++)    \n                f1[l][r]=max(0,f1[l][r])+s[r]-s[l-1];    \n        //\u5904\u7406\u524d\u7f00\u548c    \n        for(int l=1;l<=n;l++)    \n            for(int r=n;r;r--)    \n                s2[l][r]=max(f2[l][r],s2[l][r+1]);    \n        for(int r=1;r<=n;r++)    \n            for(int l=1;l<=n;l++)    \n                s1[l][r]=max(f1[l][r],s1[l-1][r]);    \n    }    \n    cout<<ans<<endl;    \n    return 0;    \n}    \n\n```",
        "postTime": 1509417554,
        "uid": 25264,
        "name": "SimonGreenall",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1398 \u3010\u4e66\u6cd5\u5bb6\u3011"
    },
    {
        "content": "### \u601d\u8def\n\n\u4ec0\u4e48\u6bd2\u7624\u7ec6\u8282\u9898\u3002\n\n\u8003\u8651\u5982\u4f55\u89e3\u51b3\u3002\n\n\u8003\u8651\u5bf9\u8fd9\u4e9b\u6761\u4ef6\u505a\u51fa\u8fdb\u4e00\u6b65\u7684**\u62bd\u8c61**\u3002\n\n\u4e8e\u662f\u6211\u4eec\u505a\u51fa\u7ec6\u81f4\u7684\u89c2\u5bdf\u3002\n\n\u65b9\u4fbf\u8d77\u89c1\uff0c\u6211\u4eec\u6a2a\u3001\u7eb5\u5750\u6807\u81ea\u5de6\u5f80\u53f3\u3001\u81ea\u4e0a\u5f80\u4e0b\u6807\u53f7\u3002\n\n---\n#### \u5b57\u6bcd\u4e4b\u95f4\u7684\u5173\u7cfb\n\n`O` \u7684\u6761\u4ef6 $2$ \u4e0e `I` \u7684\u6761\u4ef6 $2$ \u6307\u51fa\uff0c`N`\uff0c`O` \u4e4b\u95f4\u6709\u81f3\u5c11\u4e00\u4e2a\u7a7a\u5217\uff0c`O`\uff0c`I` \u4e4b\u95f4\u6709\u81f3\u5c11\u4e00\u4e2a\u7a7a\u5217\uff0c\u4e09\u4e2a\u5b57\u6bcd\u662f\u4f9d\u6b21\u6392\u5e03\u7684\u3002\n\n\u800c\u4e14\u8fd9\u4e9b\u9650\u5236\u5173\u7cfb\u90fd\u662f\u5728\u6a2a\u5750\u6807\u4e0a\u7684\uff0c\u7eb5\u5750\u6807\u4e0a\u4e0d\u505a\u9650\u5236\u3002\n\n\u8fd9\u542f\u793a\u6211\u4eec\u53ea\u7528\u7b97\u51fa**\u524d\u7f00\u82e5\u5e72\u5217\u7684\u6700\u4f18 `N`\u3001\u4e2d\u95f4\u82e5\u5e72\u5217\u7684\u6700\u4f18 `O`\u3001\u540e\u7f00\u82e5\u5e72\u5217\u7684\u6700\u4f18 `I`**\uff0c\u5373\u53ef\u7b97\u51fa\u7b54\u6848\u3002\n\n\u4e8e\u662f\u8003\u8651\u5bf9\u4e09\u8005\u5206\u522b\u8fdb\u884c\u52a8\u6001\u89c4\u5212\uff0c\u6700\u540e\u5408\u5e76\u7b54\u6848\u3002\n\n**\uff08\u6ce8\u610f\uff1a\u4e8b\u5b9e\u8bc1\u660e\u8fd9\u662f\u4e00\u6761\u9519\u8bef\u7684\u9053\u8def\uff0c\u4f46\u5bf9\u540e\u9762\u7684\u6b63\u89e3\u5bcc\u6709\u542f\u53d1\u610f\u4e49\uff0c\u4e14\u63a8\u5bfc\u4e5f\u662f\u7c7b\u4f3c\u7684\uff09**\n\n\u65b9\u4fbf\u8d77\u89c1\uff0c\u6211\u4eec\u8bbe $(c,r)$ \u5143\u7d20\u5e78\u8fd0\u503c\u4e3a $w(r,c)$\u3002\n\n---\n#### \u5b57\u6bcd `N` \u7684\u90e8\u5206\n\n\u5148\u4e0d\u7ba1\u7b2c\u4e00\u4e2a\u3001\u6700\u540e\u4e00\u4e2a\u77e9\u5f62\uff0c\u4e2d\u95f4\u7684\u77e9\u5f62\u5fc5\u7136\u5f62\u5982\u6ed1\u52a8\u7a97\u53e3\u7684\u5f62\u5f0f\uff0c\u5e76\u4e14\u4f9d\u6b21\u76f8\u63a5\u3002\n\n\u6ce8\u610f\u5230\u62fc\u63a5\u65f6\uff0c\u4e2d\u95f4\u7684\u77e9\u5f62\u5bbd\u5ea6\uff08\u5373\u6a2a\u5750\u6807\u8de8\u5ea6\uff09\u82e5 $>1$\uff0c\u5219\u53ef\u4ee5\u62c6\u6210\u82e5\u5e72\u4e2a\u5bbd\u5ea6 $=1$ \u7684\u77e9\u5f62\uff0c\u5219\u6761\u4ef6\u4f9d\u65e7\u6210\u7acb\u3002\u56e0\u6b64\u6211\u4eec\u53ea\u7528\u8003\u8651\u4e2d\u95f4\u77e9\u5f62\u5bbd\u5ea6\u5747\u4e3a $1$ \u7684\u60c5\u51b5\u3002\n\n\u7136\u540e\u8003\u8651\u7b2c\u4e00\u4e2a\u77e9\u5f62\u3001\u6700\u540e\u4e00\u4e2a\u77e9\u5f62\u3002\u6211\u4eec\u4e0d\u59a8\u628a\u4ed6\u4eec\u4e5f\u62c6\u6210\u4e0a\u4e0b\u7aef\u70b9\u4fdd\u6301\u4e0d\u53d8\u7684\u82e5\u5e72\u5bbd\u5ea6\u4e3a $1$ \u7684\u77e9\u5f62\u3002\n\n\u6211\u4eec\u79f0\u7b2c\u4e00\u4e2a\u77e9\u5f62\u662f\u7b2c\u4e00\u7c7b\uff0c\u4e2d\u95f4\u7684\u77e9\u5f62\u662f\u7b2c\u4e8c\u7c7b\uff0c\u6700\u540e\u7684\u77e9\u5f62\u662f\u7b2c\u4e09\u7c7b\u3002\n\n\u8bbe\u8ba1 dp \u72b6\u6001 $f(col,l,r,op)$\uff0c\u5176\u4e2d $col\\in[1,m],1\\le l\\le r\\le n,op\\in\\{1,2,3\\}$\uff0c\u8868\u793a\u5f53\u524d\u8003\u8651\u5230\u7b2c\u51e0\u5217\u3001\u76ee\u524d\u77e9\u5f62\u5728\u5f53\u524d\u5217\u4e0a\u4e0a\u4e0b\u7aef\u70b9\u3001\u5f53\u524d\u77e9\u5f62\u79cd\u7c7b\u90fd\u5df2\u786e\u5b9a\u7684\u60c5\u51b5\u4e0b\uff0c\u76ee\u524d\u524d\u7f00\u77e9\u5f62\u6700\u5927\u53ef\u884c\u6743\u3002\n\n\u8003\u8651\u8f6c\u79fb\u3002\n\n$$f(col,l,r,1)=\\max\\{f(col-1,l,r,1),0\\}+\\sum_{y=l}^rw(y,col)$$\n\n$$f(col,l,r,2)=\\max\\{\\max\\{f(col-1,l,y,1)|y>r\\},\\max\\{f(col-1,y_1,y_2,2)|y_1\\le l,l-1\\le y_2\\le r\\}\\}+\\sum_{y=l}^rw(y,col)$$\n\n$$f(col,l,r,3)=\\max\\{\\max\\{f(col-1,y,r,2)|l<y\\le r\\},f(col-1,l,r,3)\\}+\\sum_{y=l}^rw(y,col)$$\n\n\u7136\u540e\u76f4\u63a5\u505a\u5c31\u597d\u4e86\u3002\n\n\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u901a\u8fc7\u7b80\u5355\u7684\u8f6c\u79fb\u987a\u5e8f\u4e0e\u524d\u540e\u7f00\u548c\u505a\u5230\u590d\u6742\u5ea6\u4e0e\u72b6\u6001\u6570\u540c\u9636\u3002\n\n---\n#### \u5b57\u6bcd `I` \u7684\u90e8\u5206\n\n~~\u5bf9\uff0c\u5148\u8df3\u8fc7 `O`\u3002~~\n\n\u4e3b\u8981\u662f `O` \u7684\u5de6\u53f3\u7aef\u70b9\u90fd\u8981\u679a\u4e3e\uff0c\u56e0\u6b64\u6211\u4eec\u653e\u5728\u540e\u9762\u8003\u8651\u3002\n\n`I` \u662f\u4e0a\u4e0b\u5bf9\u9f50\u7684\uff0c\u8003\u8651\u600e\u4e48\u505a\u3002\n\n\u2026\u2026\n\n\u611f\u89c9\u597d\u50cf\u4e0d\u597d\u505a\u554a\u3002\n\n\u4f46\u662f\u6211\u4eec\u6709 $Q_1=H_1,Q_3=Q_3$\uff0c\u5373\u6700\u4e0a\u9762\u3001\u6700\u4e0b\u9762\u7684\u77e9\u5f62\u9ad8\u5ea6\u90fd\u4e3a $1$\u3002\n\n\u6211\u4eec\u8bd5\u56fe\u91cd\u65b0\u8003\u8651\uff0c\u628a `I` \u89c6\u4f5c**\u4e00\u4e2a\u6574\u4f53**\uff0c\u4ece\u53f3\u5f80\u5de6\u626b\u63cf\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u95ee\u9898\u88ab\u5206\u4e3a\u4e09\u4e2a\u201c\u9636\u6bb5\u201d\u3002\n\n\u9636\u6bb5 $1$\uff1a\u4ec5\u6700\u4e0a\u3001\u6700\u4e0b\u683c\u5b50\u88ab\u586b\u5145\u3002\n\n\u9636\u6bb5 $2$\uff1a\u6574\u6bb5\u533a\u95f4\u88ab\u586b\u5145\u3002\n\n\u9636\u6bb5 $3$\uff1a\u4ec5\u6700\u4e0a\u3001\u6700\u4e0b\u683c\u5b50\u88ab\u586b\u5145\u3002\n\n\u8bbe\u8ba1 dp \u72b6\u6001 $g(col,l,r,op)$\uff0c\u8868\u793a\u5f53\u524d\u8003\u8651\u5230\u7b2c\u51e0\u5217\u3001`I` \u7684\u4e0a\u4e0b\u7aef\u70b9\u3001\u5f53\u524d\u9636\u6bb5\u79cd\u7c7b\u90fd\u5df2\u786e\u5b9a\u7684\u60c5\u51b5\u4e0b\uff0c\u76ee\u524d\u540e\u7f00\u72b6\u6001\u6700\u5927\u53ef\u884c\u6743\u3002\n\n\u8003\u8651\u8f6c\u79fb\u3002\n\n$$g(col,l,r,1)=\\max\\{g(col+1,l,r,1),0\\}+w(l,col)+w(r,col)$$\n\n$$g(col,l,r,2)=\\max\\{g(col+1,l,r,1),g(col+1,l,r,2)\\}+\\sum_{y=l}^rw(y,col)$$\n\n$$g(col,l,r,3)=\\max\\{g(col+1,l,r,2),g(col+1,l,r,3)\\}+w(l,col)+w(r,col)$$\n\n\u7136\u540e\u76f4\u63a5\u505a\u5c31\u597d\u4e86\u3002\n\n---\n#### \u5b57\u6bcd `O` \u7684\u90e8\u5206\n\n\u8fd9\u4e2a\u5de6\u53f3\u7aef\u70b9\u679a\u4e3e\u4f3c\u4e4e\u65e0\u6cd5\u907f\u514d\uff0c\u8003\u8651\u600e\u4e48\u4f18\u5316\u3002\n\n\u4f3c\u4e4e\u6ca1\u6cd5\u4f18\u5316\u3002\n\n\u56e0\u4e3a\u679a\u4e3e\u7aef\u70b9\u5df2\u7ecf\u5e26\u6765\u4e86 $\\Theta(m^2)$ \u7ea7\u522b\u7684\u679a\u4e3e\u4e86\uff0c\u65e0\u6cd5\u627f\u53d7\u751a\u81f3\u518d\u6765\u4e00\u4e2a $n$\u3002\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\uff0c\u5982\u679c\u786c\u679a\u4e3e\u5de6\u53f3\u7aef\u70b9\uff0c\u7136\u540e\u6309\u7c7b\u4f3c `I` \u7684\u65b9\u5f0f\u786e\u5b9a\u4e09\u4e2a\u9636\u6bb5 dp \u7684\u8bdd\uff0c\u590d\u6742\u5ea6\u662f $O(m^2n^2)$ \u7684\u3002\n\n**\u6362\u8a00\u4e4b\uff0c\u6211\u4eec\u7684\u505a\u6cd5\uff0c\u5728\u65f6\u95f4\u590d\u6742\u5ea6\u4e0a\u5047\u4e86\uff01**\n\n---\n#### \u91cd\u65b0\u5408\u5e76\u4e09\u4e2a\u5b57\u6bcd `NOI`\n\n\u8003\u8651\u633d\u6551\u521a\u521a\u7684\u505a\u6cd5\u3002\n\n\u4e0d\u80fd\u5206\u5f00\u5904\u7406\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a `O` \u8981\u679a\u4e3e\u4e24\u4e2a\u7aef\u70b9\u554a\u3002\n\n\u90a3\u4e48\u552f\u4e00\u7684\u65b9\u6cd5\uff0c\u5c31\u662f**\u8054\u5408\u5904\u7406**\u4e86\u3002\n\n\u8bbe $f(col,l,r,op)$ \u5b9a\u4e49\u540c\u4e0a\uff0c\u6211\u4eec\u8003\u8651\u5982\u4f55\u7ee7\u7eed\u7ef4\u62a4 `O`\u3002\n\n\u8bbe $h(col,l,r,op)$ \u8868\u793a\u5df2\u7ecf\u8003\u8651\u4e86 `N`\uff0c\u5f53\u524d\u8003\u8651\u5230\u7b2c\u51e0\u5217\u3001`O` \u7684\u4e0a\u4e0b\u7aef\u70b9\u3001\u5f53\u524d\u9636\u6bb5\u79cd\u7c7b\u90fd\u5df2\u786e\u5b9a\u7684\u60c5\u51b5\u4e0b\uff0c\u76ee\u524d\u524d\u7f00\u72b6\u6001\u7684\u6700\u5927\u53ef\u884c\u6743\u3002\n\n\u91cd\u65b0\u8bbe $g(col,l,r,op)$ \u8868\u793a\u5df2\u7ecf\u8003\u8651\u4e86 `N` \u4e0e `O`\uff0c\u5f53\u524d\u8003\u8651\u5230\u7b2c\u51e0\u5217\u3001`I` \u7684\u4e0a\u4e0b\u7aef\u70b9\u3001\u5f53\u524d\u9636\u6bb5\u79cd\u7c7b\u90fd\u5df2\u786e\u5b9a\u7684\u60c5\u51b5\u4e0b\uff0c\u76ee\u524d\u524d\u7f00\u72b6\u6001\u6700\u5927\u53ef\u884c\u6743\u3002\n\n\u8003\u8651\u8f6c\u79fb\u3002\n\n\u6211\u4eec\u5217\u51fa\u5982\u4e0b $9$ \u4e2a\u8f6c\u79fb\u65b9\u7a0b\u3002\n\n$$f(col,l,r,1)=\\max\\{f(col-1,l,r,1),0\\}+\\sum_{y=l}^rw(y,col)$$\n\n$$f(col,l,r,2)=\\max\\{\\max\\{f(col-1,l,y,1)|y>r\\},\\max\\{f(col-1,y_1,y_2,2)|y_1\\le l,l-1\\le y_2\\le r\\}\\}+\\sum_{y=l}^rw(y,col)$$\n\n$$f(col,l,r,3)=\\max\\{\\max\\{f(col-1,y,r,2)|l<y\\le r\\},f(col-1,l,r,3)\\}+\\sum_{y=l}^rw(y,col)$$\n\n$$h(col,l,r,1)=\\max\\{f(c,y_1,y_2,3)|c\\le col-2,y_1<y_2\\}+\\sum_{y=l}^rw(y,col)$$\n\n$$h(col,l,r,2)=\\max\\{h(col-1,l,r,1),h(col-1,l,r,2)\\}+w(l,col)+w(r,col)$$\n\n$$h(col,l,r,3)=h(col-1,l,r,2)+\\sum_{y=l}^rw(y,col)$$\n\n$$g(col,l,r,1)=\\max\\{\\max\\{h(c,y_1,y_2,3)|c\\le col-2,y_1<y_2\\},g(col-1,l,r,1)\\}+w(l,col)+w(r,col)$$\n\n$$g(col,l,r,2)=\\max\\{g(col-1,l,r,1),g(col-1,l,r,2)\\}+\\sum_{y=l}^rw(y,col)$$\n\n$$g(col,l,r,3)=\\max\\{g(col-1,l,r,2),g(col-1,l,r,3)\\}+w(l,col)+w(r,col)$$\n\n\u7136\u540e\u6700\u5927\u7684 $g(col,l,r,3)$ \u5c31\u662f\u7b54\u6848\u3002\n\n---\n#### \u5982\u4f55 $O(1)$ \u8f6c\u79fb\n\n\u72b6\u6001\u6570\u662f $\\Theta(n^2m)$ \u7684\uff0c\u6211\u4eec\u9700\u8981\u7684\u590d\u6742\u5ea6\u4e5f\u53ea\u80fd\u662f\u8fd9\u4e2a\u7ea7\u522b\uff0c\u4f46\u5e76\u4e0d\u65b9\u4fbf\u76f4\u63a5\u89e3\u51b3\u8fd9\u4e00\u70b9\u3002\n\n\u663e\u7136\uff0c\u8fd9\u4e2a\u4e1c\u897f\u7684\u8f6c\u79fb\u5982\u4f55\u505a\u5230 $O(1)$ \u5e76\u4e0d\u662f\u663e\u7136\u7684\u3002\n\n\u6211\u4eec\u5148\u786e\u8ba4\u4ee5\u4e0b\u4e8b\u5b9e\uff1a$\\max$ \u65c1\u8fb9\u6240\u52a0\u7684\u9879\u5747\u4e3a $\\sum_{y=l}^rw(y,col)$ \u6216 $w(l,col)+w(r,col)$\u3002\n\n\u4e8e\u662f\u8bbe $A(col,l,r)=\\sum_{y=l}^rw(y,col),B(col,l,r)=w(l,col)+w(r,col)$\u3002\n\n$A,B$ \u5bb9\u6613\u5728 $\\Theta(n^2m)$ \u7684\u65f6\u95f4\u5185\u9884\u5904\u7406\u5b8c\u3002\n\n\u800c\u4e4b\u524d\u7684 dp \u72b6\u6001\uff0c\u5176\u62d3\u6251\u5e8f\u663e\u7136\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4f9d\u6b21\u5904\u7406\u6bcf\u90e8\u5206\u5982\u4f55\u505a\u5230 $O(1)$ \u8f6c\u79fb\u3002\n\n---\n$$f(col,l,r,1)=\\max\\{f(col-1,l,r,1),0\\}+A(col,l,r)$$\n\n\u76f4\u63a5\u6309 $col$ \u5347\u5e8f\u8f6c\u79fb\u5373\u53ef\u3002\n\n---\n$$f(col,l,r,2)=\\max\\{\\max\\{f(col-1,l,y,1)|y>r\\},\\max\\{f(col-1,y_1,y_2,2)|y_1\\le l,l-1\\le y_2\\le r\\}\\}+A(col,l,r)$$\n\n\u8bbe $p(col,l,r)=\\max\\{f(col,l,y,1)|y>r\\}$\uff0c\u5219 $p(col,l,r)=\\max\\{p(col,l,r+1),f(col,l,r+1,1)\\}$\uff0c\u8fb9\u754c\u7a0d\u5fae\u7279\u5224\u4e00\u4e0b\u3002\n\n\u5219\n\n$$f(col,l,r,2)=\\max\\{p(col-1,l,r),\\max\\{f(col-1,y_1,y_2,2)|y_1\\le l,l-1\\le y_2\\le r\\}\\}+A(col,l,r)$$\n\n\u8bbe $q(col,l,r)=\\max\\{f(col,y_1,y_2,2)|y_1\\le l,l-1\\le y_2\\le r\\}$\u3002\n\n\u5219 $q(col,l,r)=\\max\\{\\max\\{f(col,y,r,2)|y\\le l\\},q(col,l,r-1)\\}$\uff0c\u8fb9\u754c\u8981\u7279\u6b8a\u5904\u7406\u3002\n\n\u8bbe $d(col,l,r)=\\max\\{f(col,y,r,2)|y\\le l\\}$\u3002\n\n\u5219 $d(col,l,r)=\\max\\{f(col,l,r,2),d(col,l-1,r)\\}$\uff0c\u8fb9\u754c\u8981\u7279\u6b8a\u5904\u7406\u3002\n\n\u5219 $q(col,l,r)=\\max\\{d(col,l,r),q(col,l,r-1)\\}$\u3002\n\n\u5219\n\n$$f(col,l,r,2)=\\max\\{p(col-1,l,r),q(col-1,l,r)\\}+A(col,l,r)$$\n\n\u76f4\u63a5\u6309 $col$ \u5347\u5e8f\u8f6c\u79fb\u5373\u53ef\u3002\n\n---\n$$f(col,l,r,3)=\\max\\{\\max\\{f(col-1,y,r,2)|l<y\\le r\\},f(col-1,l,r,3)\\}+A(col,l,r)$$\n\n\u8bbe $p(col,l,r)=\\max\\{f(col,y,r,2)|l<y\\le r\\}$\u3002\n\n\u5219 $p(col,l,r)=\\max\\{f(col,l+1,r,2),p(col,l+1,r)\\}$\uff0c\u8fb9\u754c\u8981\u7279\u6b8a\u5904\u7406\u3002\n\n$$f(col,l,r,3)=\\max\\{p(col-1,l,r),f(col-1,l,r,3)\\}+A(col,l,r)$$\n\n\u76f4\u63a5\u6309 $col$ \u5347\u5e8f\u8f6c\u79fb\u5373\u53ef\u3002\n\n---\n$$h(col,l,r,1)=\\max\\{f(c,y_1,y_2,3)|c\\le col-2,y_1<y_2\\}+A(col,l,r)$$\n\n\u8bbe $p(col)=\\max\\{f(c,y_1,y_2,3)|c<col,y_1<y_2\\}$\u3002\n\n\u5219 $p(col)=\\max\\{p(col-1),\\max\\{f(col-1,y_1,y_2,3)|y_1<y_2\\}\\}$\uff0c\u8fd9\u4e2a\u76f4\u63a5\u66b4\u529b\u5408\u5e76\u5373\u53ef\u3002\n\n$$h(col,l,r,1)=p(col-1)+A(col,l,r)$$\n\n\u76f4\u63a5\u6309 $col$ \u5347\u5e8f\u8f6c\u79fb\u5373\u53ef\u3002\n\n---\n$$h(col,l,r,2)=\\max\\{h(col-1,l,r,1),h(col-1,l,r,2)\\}+B(col,l,r)$$\n\n\u76f4\u63a5\u6309 $col$ \u5347\u5e8f\u8f6c\u79fb\u5373\u53ef\u3002\n\n---\n$$h(col,l,r,3)=h(col-1,l,r,2)+A(col,l,r)$$\n\n\u76f4\u63a5\u6309 $col$ \u5347\u5e8f\u8f6c\u79fb\u5373\u53ef\u3002\n\n---\n$$g(col,l,r,1)=\\max\\{\\max\\{h(c,y_1,y_2,3)|c\\le col-2,y_1<y_2\\},g(col-1,l,r,1)\\}+B(col,l,r)$$\n\n\u8bbe $p(col)=\\max\\{h(c,y_1,y_2,3)|c<col,y_1<y_2\\}$\u3002\n\n\u5219 $p(col)=\\max\\{p(col-1),\\max\\{h(col-1,y_1,y_2,3)|y_1<y_2\\}\\}$\uff0c\u8fd9\u4e2a\u76f4\u63a5\u66b4\u529b\u5408\u5e76\u5373\u53ef\u3002\n\n$$g(col,l,r,1)=\\max\\{p(col-1),g(col-1,l,r,1)\\}+B(col,l,r)$$\n\n\u76f4\u63a5\u6309 $col$ \u5347\u5e8f\u8f6c\u79fb\u5373\u53ef\u3002\n\n---\n$$g(col,l,r,2)=\\max\\{g(col-1,l,r,1),g(col-1,l,r,2)\\}+A(col,l,r)$$\n\n\u76f4\u63a5\u6309 $col$ \u5347\u5e8f\u8f6c\u79fb\u5373\u53ef\u3002\n\n---\n$$g(col,l,r,3)=\\max\\{g(col-1,l,r,2),g(col-1,l,r,3)\\}+B(col,l,r)$$\n\n\u76f4\u63a5\u6309 $col$ \u5347\u5e8f\u8f6c\u79fb\u5373\u53ef\u3002\n\n---\n### Code\n\n\u6309\u521a\u521a\u8bf4\u7684\uff0c\u786c\u5199\uff0c\u7136\u540e\u5c31\u5b8c\u4e86\u3002\n\nNOI2013D2T2 \u679c\u7136\u662f\u7edd\u4e16\\*\\*\u9898\u3002\n\n\u7136\u540e\u8fd9\u9898\u8fd8\u5361\u7a7a\u95f4\uff0c\u8bb0\u5f97\u6eda\u52a8\u6570\u7ec4\u3002\n\n```cpp\n#include <algorithm>\n#include <stdio.h>\n#include <vector>\ntypedef long long llt;\ntypedef unsigned uint;typedef unsigned long long ullt;\ntypedef bool bol;typedef char chr;typedef void voi;\ntypedef double dbl;\ntemplate<typename T>bol _max(T&a,T b){return(a<b)?a=b,true:false;}\ntemplate<typename T>bol _min(T&a,T b){return(b<a)?a=b,true:false;}\ntemplate<typename T>T lowbit(T n){return n&-n;}\ntemplate<typename T>T gcd(T a,T b){return b?gcd(b,a%b):a;}\ntemplate<typename T>T lcm(T a,T b){return(a!=0||b!=0)?a/gcd(a,b)*b:(T)0;}\ntemplate<typename T>T exgcd(T a,T b,T&x,T&y){if(b!=0){T ans=exgcd(b,a%b,y,x);y-=a/b*x;return ans;}else return y=0,x=1,a;}\ntemplate<typename T>T power(T base,T index,T mod)\n{\n    T ans=1%mod;\n    while(index)\n    {\n        if(index&1)ans=ans*base%mod;\n        base=base*base%mod,index>>=1;\n    }\n    return ans;\n}\nconst int inf=1e8;\nint W[155][505],A[155][155],B[155][155],F[155][155][4],G[155][155][4],H[155][155][4];\nint main()\n{\n#ifdef MYEE\n    freopen(\"QAQ.in\",\"r\",stdin);\n    freopen(\"QAQ.out\",\"w\",stdout);\n#endif\n    uint n,m;scanf(\"%u%u\",&n,&m);\n    for(uint i=1;i<=n;i++)for(uint j=1;j<=m;j++)scanf(\"%d\",W[i]+j);\n    for(uint i=0;i<=n+1;i++)for(uint j=0;j<=n+1;j++)for(uint op=1;op<=3;op++)F[i][j][op]=-inf;\n    for(uint i=0;i<=n+1;i++)for(uint j=0;j<=n+1;j++)for(uint op=1;op<=3;op++)H[i][j][op]=-inf;\n    for(uint i=0;i<=n+1;i++)for(uint j=0;j<=n+1;j++)for(uint op=1;op<=3;op++)G[i][j][op]=-inf;\n    int ans=-inf;\n    for(uint col=1;col<=m;col++){\n        static int NO=-inf,OI=-inf,User[155][155];\n#define W(c,r) W[r][c]\n#define A(l,r) A[l][r]\n#define B(l,r) B[l][r]\n#define F(l,r,op) F[l][r][op]\n#define H(l,r,op) H[l][r][op]\n#define G(l,r,op) G[l][r][op]\n#define p(l,r) User[l][r]\n        for(uint l=1;l<=n;l++)for(uint r=l;r<=n;r++)A(l,r)=A(l,r-1)+W(col,r),B(l,r)=W(col,l)+W(col,r);\n        for(uint l=1;l<=n;l++)for(uint r=l+2;r<=n;r++)_max(G(l,r,3),G(l,r,2)),_max(ans,G(l,r,3)+=B(l,r));\n        for(uint l=1;l<=n;l++)for(uint r=l+2;r<=n;r++)_max(G(l,r,2),G(l,r,1)),G(l,r,2)+=A(l,r);\n        for(uint l=1;l<=n;l++)for(uint r=l+2;r<=n;r++)_max(G(l,r,1),OI),G(l,r,1)+=B(l,r);\n        for(uint l=1;l<=n;l++)for(uint r=l+2;r<=n;r++)_max(OI,H(l,r,3)),H(l,r,3)=H(l,r,2)+A(l,r);\n        for(uint l=1;l<=n;l++)for(uint r=l+2;r<=n;r++)_max(H(l,r,2),H(l,r,1)),H(l,r,2)+=B(l,r);\n        for(uint l=1;l<=n;l++)for(uint r=l+2;r<=n;r++)H(l,r,1)=NO+A(l,r);\n        for(uint l=1;l<=n;l++)for(uint r=l+1;r<=n;r++)_max(NO,F(l,r,3));\n        for(uint l=0;l<=n+1;l++)for(uint r=0;r<=n+1;r++)p(l,r)=-inf;\n        for(uint l=n;l;l--)for(uint r=l+1;r<=n;r++)p(l,r)=std::max(p(l+1,r),F(l+1,r,2));\n        for(uint l=1;l<=n;l++)for(uint r=l+1;r<=n;r++)_max(F(l,r,3),p(l,r)),F(l,r,3)+=A(l,r);\n        for(uint l=0;l<=n+1;l++)for(uint r=0;r<=n+1;r++)p(l,r)=-inf;\n        for(uint l=1;l<=n;l++)for(uint r=l-1;r<=n;r++)p(l,r)=std::max(p(l-1,r),F(l,r,2));\n        for(uint l=1;l<=n;l++)for(uint r=l;r<=n;r++)_max(p(l,r),p(l,r-1));\n        for(uint l=1;l<=n;l++)for(uint r=l;r<=n;r++)F(l,r,2)=p(l,r);\n        for(uint l=0;l<=n+1;l++)for(uint r=0;r<=n+1;r++)p(l,r)=-inf;\n        for(uint l=1;l<=n;l++)for(uint r=n;r>=l;r--)p(l,r)=std::max(p(l,r+1),F(l,r+1,1));\n        for(uint l=1;l<=n;l++)for(uint r=l;r<=n;r++)_max(F(l,r,2),p(l,r)),F(l,r,2)+=A(l,r);\n        for(uint l=1;l<=n;l++)for(uint r=l+1;r<=n;r++)_max(F(l,r,1),0),F(l,r,1)+=A(l,r);\n#undef p\n#undef G\n#undef H\n#undef F\n#undef B\n#undef A\n#undef W\n    }\n    printf(\"%d\\n\",ans);\n    return 0;\n}\n```\n",
        "postTime": 1665668041,
        "uid": 105050,
        "name": "myee",
        "ccfLevel": 7,
        "title": "1398"
    },
    {
        "content": "\u5f88\u81ea\u7136\u5730\u5206\u62109\u4e2a\u90e8\u5206\u8fdb\u884c\u52a8\u6001\u89c4\u5212\uff0c\u5373\u628aNOI3\u4e2a\u5b57\u6bcd\uff0c\u6bcf\u4e2a\u5b57\u6bcd\u5206\u522b\u4ece\u5de6\u5230\u53f3\u5206\u4e3a3\u90e8\u5206\uff0c\u7136\u540e\u9010\u5217\u8fdb\u884c\u8f6c\u79fb\u3002 \n\n\u9664\u4e86N\u7684\u7b2c\u4e8c\u90e8\u5206\u5176\u4f59\u7684\u90fd\u5f88\u597d\u8f6c\u79fb\uff0c\u5177\u4f53\u600e\u4e48\u8f6c\u79fb\u7684\u5462\uff1f\u5176\u5b9e\u4e5f\u5c31\u662f\u6309\u7167\u4ed6\u7684\u89c4\u5219\u8fdb\u884c\u6a21\u62df\uff0c\u770b\u4ee3\u7801\u5c31\u80fd\u7406\u89e3\u4e86\u3002\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<cstring>\nusing namespace std;\n#define MAXN 150\n#define MAXM 500\n#define INF 0x3fffffff\nint a[MAXN+10][MAXM+10],n,m,blk[MAXM+10][2],f[2][10][MAXN+10][MAXN+10],s[MAXN+10][MAXM+10],tmp[MAXN+10][MAXN+10],ans=-INF;\nvoid Read(int &x){\n    static char c;\n    bool f(0);\n    while(c=getchar(),c!=EOF){\n        if(c=='-')\n            f=1;\n        else if(c>='0'&&c<='9'){\n            x=c-'0';\n            while(c=getchar(),c>='0'&&c<='9')\n                x=x*10+c-'0';\n            ungetc(c,stdin);\n            if(f)\n                x=-x;\n            return;\n        }\n    }\n}\nvoid read(){\n    Read(n),Read(m);\n    int i,j;\n    for(i=1;i<=n;i++)\n        for(j=1;j<=m;j++){\n            Read(a[i][j]);\n            s[i][j]=s[i-1][j]+a[i][j];\n        }\n}\nvoid dp(){\n    int i,j,k;\n    memset(f[1],0xb0,sizeof f[1]);\n    for(i=1;i<=n;i++)\n        for(j=i;j<=n;j++)\n            f[1][1][i][j]=s[j][1]-s[i-1][1];\n    blk[1][0]=blk[1][1]=-INF;\n    for(k=2;k<=m;k++){\n        memset(f[k&1],0xb0,sizeof f[k&1]);\n        //N\u7684\u7b2c\u4e00\u90e8\u5206\n        for(i=1;i<=n;i++)\n            for(j=i;j<=n;j++)\n                f[k&1][1][i][j]=max(s[j][k]-s[i-1][k],f[(k&1)^1][1][i][j]+s[j][k]-s[i-1][k]);\n        //N\u7684\u7b2c\u4e8c\u90e8\u5206\n        for(i=1;i<=n;i++){\n            tmp[i][n+1]=-INF;\n            for(j=n;j>=i;j--)\n                tmp[i][j]=max(tmp[i][j+1],f[(k&1)^1][1][i][j]);\n            }\n        for(i=1;i<=n;i++)\n            for(j=i;j<=n;j++){\n                f[k&1][2][i][j]=max(f[k&1][2][i][j],tmp[i][j+1]+s[j][k]-s[i-1][k]);\n                tmp[i][j]=-INF;\n            }\n        for(i=1;i<=n;i++)\n            for(j=i;j<=n;j++)\n                tmp[j+1][j+1]=max(tmp[j+1][j+1],f[(k&1)^1][2][i][j]);\n        for(i=1;i<=n;i++)\n            for(j=i+1;j<=n;j++)\n                tmp[i][j]=max(tmp[i][j],tmp[i][j-1]);\n        for(i=1;i<=n;i++)\n            for(j=i;j<=n;j++)\n                f[k&1][2][i][j]=max(f[k&1][2][i][j],tmp[i][j]+s[j][k]-s[i-1][k]);\n        for(i=1;i<=n;i++)\n            for(j=i;j<=n;j++)\n                tmp[i][j]=f[(k&1)^1][2][i][j];\n        for(j=1;j<=n;j++)\n            for(i=1;i<j;i++)\n                tmp[i+1][j]=max(tmp[i+1][j],tmp[i][j]);\n        for(i=1;i<=n;i++)\n            for(j=i;j<n;j++)\n                tmp[i][j+1]=max(tmp[i][j+1],tmp[i][j]);\n        for(i=1;i<=n;i++)\n            for(j=i;j<=n;j++)\n                f[k&1][2][i][j]=max(f[k&1][2][i][j],tmp[i][j]+s[j][k]-s[i-1][k]);\n        //N\u7684\u7b2c\u4e09\u90e8\u5206\n        for(i=1;i<=n;i++)\n            for(j=i;j<=n;j++)\n                tmp[i][j]=f[(k&1)^1][2][i][j];\n        for(j=1;j<=n;j++)\n            for(i=j;i>1;i--)\n                tmp[i-1][j]=max(tmp[i-1][j],tmp[i][j]);\n        for(i=1;i<=n;i++)\n            for(j=i+1;j<=n;j++)\n                f[k&1][3][i][j]=max(f[k&1][3][i][j],max(tmp[i+1][j],f[(k&1)^1][3][i][j])+s[j][k]-s[i-1][k]);\n        //NO\u4e4b\u95f4\u7a7a\u767d\n        blk[k][0]=blk[k-1][0];\n        for(i=1;i<=n;i++)\n            for(j=i;j<=n;j++)\n                blk[k][0]=max(blk[k][0],f[(k&1)^1][3][i][j]);\n        //O\u7684\u7b2c\u4e00\u90e8\u5206\n        for(i=1;i<=n;i++)\n            for(j=i+2;j<=n;j++)\n                f[k&1][4][i][j]=blk[k-1][0]+s[j][k]-s[i-1][k];\n        //O\u7684\u7b2c\u4e8c\u90e8\u5206\n        for(i=1;i<=n;i++)\n            for(j=i+2;j<=n;j++)\n                f[k&1][5][i][j]=max(f[(k&1)^1][4][i][j],f[(k&1)^1][5][i][j])+a[i][k]+a[j][k];\n        //O\u7684\u7b2c\u4e09\u90e8\u5206\n        for(i=1;i<=n;i++)\n            for(j=i+2;j<=n;j++)\n                f[k&1][6][i][j]=f[(k&1)^1][5][i][j]+s[j][k]-s[i-1][k];\n        //OI\u4e4b\u95f4\u7a7a\u767d\n        blk[k][1]=blk[k-1][1];\n        for(i=1;i<=n;i++)\n            for(j=i;j<=n;j++)\n                blk[k][1]=max(blk[k][1],f[(k&1)^1][6][i][j]);\n        //I\u7684\u7b2c\u4e00\u90e8\u5206\n        for(i=1;i<=n;i++)\n            for(j=i+2;j<=n;j++)\n                f[k&1][7][i][j]=max(blk[k-1][1],f[(k&1)^1][7][i][j])+a[i][k]+a[j][k];\n        //I\u7684\u7b2c\u4e8c\u90e8\u5206\n        for(i=1;i<=n;i++)\n            for(j=i+2;j<=n;j++)\n                f[k&1][8][i][j]=max(f[(k&1)^1][7][i][j],f[(k&1)^1][8][i][j])+s[j][k]-s[i-1][k];\n        //I\u7684\u7b2c\u4e09\u90e8\u5206\n        for(i=1;i<=n;i++)\n            for(j=i+2;j<=n;j++){\n                f[k&1][9][i][j]=max(f[(k&1)^1][8][i][j],f[(k&1)^1][9][i][j])+a[i][k]+a[j][k];\n                ans=max(ans,f[k&1][9][i][j]);\n            }   \n    }\n}\nint main()\n{\n    read();\n    dp();\n    printf(\"%d\\n\",ans);\n}\n```",
        "postTime": 1528895614,
        "uid": 98954,
        "name": "\u4e0d\u5b58\u5728\u4e4b\u4eba",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P1398 \u3010[NOI2013]\u4e66\u6cd5\u5bb6\u3011"
    },
    {
        "content": "\u6ce8\u610f\u5230N O I\u4e09\u4e2a\u5b57\u6bcd\u90fd\u53ef\u4ee5\u4ece\u5de6\u5230\u53f3\u62c6\u6210\u4e09\u90e8\u5206,\u5373N=\u4e00\u4e2a\u77e9\u5f62+\u4e00\u5806\u77e9\u5f62+\u4e00\u4e2a\u77e9\u5f62,O=\u4e00\u6761+\u4e24\u6761\u6a2a\u7684+\u4e00\u6761,I=\u4e24\u6761\u6a2a\u7684+\u4e00\u4e2a\u77e9\u5f62+\u4e24\u6761\u6a2a\u7684,\u6240\u4ee5\u53ef\u4ee5\u62c6\u621013\u4e2a\u90e8\u5206\u8f6c\u79fb(9\u4e2a\u5b57\u6bcd\u90e8\u5206,4\u4e2a\u7a7a\u767d\u90e8\u5206).\n\n\u8bbefi,j,l,r\u8868\u793a\u7b2ci\u5217,\u653e\u7684\u662f\u5b57\u6bcd\u7684j\u90e8\u5206,\u653e\u4e86\u4ecel\u884c\u5230r\u884c\u7684\u6700\u5927\u503c,gi,j\u8868\u793a\u7b2ci\u5217,\u653e\u7684\u662f\u7684\u7a7a\u767dj\u90e8\u5206\u7684\u6700\u5927\u503c.\u8f6c\u79fb\u6839\u636e\u4e0d\u540c\u7684\u90e8\u5206,\u679a\u4e3e\u4e0b\u4e00\u5217\u600e\u4e48\u653e,\u4f46\u662f\u8fd9\u6837\u590d\u6742\u5ea6\u4e0d\u5bf9.\u53ef\u4ee5\u53d1\u73b0\u53ea\u6709\u7a7a\u767d\u90e8\u5206\u8f6c\u79fb\u5230\u5b57\u6bcd\u90e8\u5206\u548cN\u90e8\u5206\u8f6c\u79fb\u9700\u8981\u679a\u4e3e\u653e\u54ea\u91cc,\u5176\u4ed6\u7684\u53ef\u4ee5\u76f4\u63a5\u7ee7\u627f\u4e0a\u4e00\u4e2a\u72b6\u6001\u7684l,r.\n\n\u7a7a\u767d\u90e8\u5206\u8f6c\u79fb\u6bd4\u8f83\u7b80\u5355,\u8fd9\u91cc\u4e3b\u8981\u770bN.\u9996\u5148\u4ece\u7b2c\u4e00\u90e8\u5206\u8f6c\u79fb\u5230\u7b2c\u4e8c\u90e8\u5206,\u5982\u679c\u653e\u4e86l,r,\u90a3\u4e48\u524d\u4e00\u4e2a\u72b6\u6001\u7684\u540e\u9762\u4e24\u7ef4\u4e3al,r\u2032(r\u2032>r),\u6240\u4ee5\u53ef\u4ee5\u8bb0\u540e\u7f00\u6700\u5927\u503c\u76f4\u63a5\u8f6c\u79fb.\u7136\u540e\u662f\u7b2c\u4e8c\u90e8\u5206\u4e4b\u95f4\u7684\u8f6c\u79fb,\u4e0a\u4e00\u4e2a\u72b6\u6001\u540e\u4e24\u7ef4\u662fl\u2032,r\u2032(l\u2032\u2265l,l\u22121\u2264r\u2032\u2264r),\u8fd9\u4e2a\u4e5f\u53ef\u4ee5\u524d\u7f00\u6700\u503c\u4f18\u5316.\u4ece\u7b2c\u4e8c\u90e8\u5206\u8f6c\u79fb\u5230\u7b2c\u4e09\u90e8\u5206,\u524d\u4e00\u4e2a\u72b6\u6001\u7684\u540e\u9762\u4e24\u7ef4\u4e3al\u2032,r(l\u2032<l),\u53ef\u4ee5\u524d\u7f00\u6700\u503c\u4f18\u5316.\n\n```\n\n#include<bits/stdc++.h>\n#define LL long long\n#define uLL unsigned long long\n#define il inline\n \nusing namespace std;\nconst int N=150+10,M=500+10;\nil int rd()\n{\n    int x=0,w=1;char ch=0;\n    while(ch<'0'||ch>'9') {if(ch=='-') w=-1;ch=getchar();}\n    while(ch>='0'&&ch<='9') {x=(x<<3)+(x<<1)+(ch^48);ch=getchar();}\n    return x*w;\n}\nint n,m,a[N][M],s[N][M],f[2][10][N][N],g[2][4],ss[N];\n \nint main()\n{\n    n=rd(),m=rd();\n    for(int i=1;i<=n;++i)\n        for(int j=1;j<=m;++j)\n            a[i][j]=rd(),s[i][j]=s[i-1][j]+a[i][j];\n    memset(f,-0x3f,sizeof(f)),memset(g,-0x3f,sizeof(g));\n    int nw=1,la=0;\n    g[la][0]=0;\n    for(int j=1;j<=m+1;++j)\n    {\n        memcpy(g[nw],g[la],sizeof(g[la]));\n        //\n        for(int l=1;l<=n;++l)\n            for(int r=l+1;r<=n;++r)\n                f[nw][1][l][r]=max(g[la][0],f[la][1][l][r])+s[r][j]-s[l-1][j];\n        for(int l=1;l<=n;++l)\n            for(int r=n,mx=-(1<<29);r>=l;--r)\n            {\n                f[nw][2][l][r]=max(f[nw][2][l][r],mx+s[r][j]-s[l-1][j]);\n                mx=max(mx,f[la][1][l][r]);\n            }\n        memset(ss,-0x3f,sizeof(ss));\n        for(int l=1;l<=n;++l)\n            for(int r=l,mx=ss[l-1];r<=n;++r)\n            {\n                ss[r]=max(ss[r],f[la][2][l][r]);\n                mx=max(mx,ss[r]);\n                f[nw][2][l][r]=max(f[nw][2][l][r],mx+s[r][j]-s[l-1][j]);\n            }\n        for(int r=n;r;--r)\n            for(int l=r,mx=-(1<<29);l;--l)\n            {\n                f[nw][3][l][r]=max(f[nw][3][l][r],mx+s[r][j]-s[l-1][j]);\n                mx=max(mx,f[la][2][l][r]);\n            }\n        for(int l=1;l<=n;++l)\n            for(int r=l+1;r<=n;++r)\n            {\n                f[nw][3][l][r]=max(f[nw][3][l][r],f[la][3][l][r]+s[r][j]-s[l-1][j]);\n                g[nw][1]=max(g[nw][1],f[la][3][l][r]);\n            }\n        //\n        for(int l=1;l<=n;++l)\n            for(int r=l+2;r<=n;++r)\n                f[nw][4][l][r]=g[la][1]+s[r][j]-s[l-1][j];\n        for(int l=1;l<=n;++l)\n            for(int r=l+2;r<=n;++r)\n                f[nw][5][l][r]=max(f[la][4][l][r],f[la][5][l][r])+a[l][j]+a[r][j];\n        for(int l=1;l<=n;++l)\n            for(int r=l+2;r<=n;++r)\n            {\n                f[nw][6][l][r]=f[la][5][l][r]+s[r][j]-s[l-1][j];\n                g[nw][2]=max(g[nw][2],f[la][6][l][r]);\n            }\n        //\n        for(int l=1;l<=n;++l)\n            for(int r=l+2;r<=n;++r)\n                f[nw][7][l][r]=max(g[la][2],f[la][7][l][r])+a[l][j]+a[r][j];\n        for(int l=1;l<=n;++l)\n            for(int r=l+2;r<=n;++r)\n                f[nw][8][l][r]=max(f[la][7][l][r],f[la][8][l][r])+s[r][j]-s[l-1][j];\n        for(int l=1;l<=n;++l)\n            for(int r=l+2;r<=n;++r)\n            {\n                f[nw][9][l][r]=max(f[la][8][l][r],f[la][9][l][r])+a[l][j]+a[r][j];\n                g[nw][3]=max(g[nw][3],f[la][9][l][r]);\n            }\n        //\n        memset(f[la],-0x3f,sizeof(f[la])),memset(g[la],-0x3f,sizeof(g[la]));\n        nw^=1,la^=1;\n    }\n    printf(\"%d\\n\",g[la][3]);\n    return 0;\n}\n```\n",
        "postTime": 1602342950,
        "uid": 324858,
        "name": "\u26a1114514_zzm\u26a1",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P1398 \u3010[NOI2013]\u4e66\u6cd5\u5bb6\u3011"
    }
]