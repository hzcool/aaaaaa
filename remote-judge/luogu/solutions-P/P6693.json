[
    {
        "content": "Upd on 2020.11.18\uff1a\u8865\u5145\u8bf4\u660e\n\n> [\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P6693)\u3002\n\n> \u9898\u610f\u7b80\u8ff0\uff1a\u7ed9\u5b9a\u4e24\u4e2a\u5b57\u7b26\u4e32 $A,B$\uff0c\u957f\u5ea6\u5206\u522b\u4e3a $n,m$\u3002\u6784\u9020\u957f\u5ea6\u4e3a $k$ \u7684\u4e24\u4e2a\u6570\u5217 $p,q$ \u6ee1\u8db3 $p_1=q_1=0,p_k=n,q_k=m,p_i<p_{i+1},q_i<q_{i+1}$ \u4e14 $A_{p_i}=B_{q_i}$\uff08\u5b57\u7b26\u4e32\u4e0b\u6807\u4ece $1$ \u5f00\u59cb\uff09\uff0c\u5219\u5176\u6743\u503c\u4e3a $\\sum (p_i-p_{i-1}-1)^2+(q_i-q_{i-1}-1)^2$\u3002\u6c42\u6240\u6709\u8fd9\u6837\u7684\u6570\u5217 $p,q$ \u7684\u6743\u503c\u4e4b\u548c\u3002\n\n---\n\n\u663e\u7136\u6709\u4e00\u4e2a $n^4$ \u7684 DP\uff1a\n\n\u8bbe $f_{i,j}$ \u8868\u793a\u6570\u5217 $p$ \u4ee5 $i$ \u7ed3\u5c3e\uff0c\u6570\u5217 $q$ \u4ee5 $j$ \u7ed3\u5c3e\u7684\u6240\u6709\u6570\u5217 $p,q$ \u7684\u6743\u503c\u4e4b\u548c\u3002  \n\u8bbe $num_{i,j}$ \u8868\u793a\u6570\u5217 $p$ \u4ee5 $i$ \u7ed3\u5c3e\uff0c\u6570\u5217 $q$ \u4ee5 $j$ \u7ed3\u5c3e\u7684\u65b9\u6848\u6570\u3002\n\n\u90a3\u4e48\u6709\u8f6c\u79fb\u65b9\u7a0b\n\n$$f_{i,j}=\\begin{cases}\\sum_{k<i,\\ l<j} f_{k,l}+num_{k,l}\\times[(i-k-1)^2+(j-l-1)^2]\\quad&(A_i=B_j)\\\\0&(A_i\\neq B_j)\\end{cases}$$\n\n$$num_{i,j}=\\begin{cases}\\sum_{k<i,\\ l<j}num_{k,l}\\quad&(A_i=B_j)\\\\0&(A_i\\neq B_j)\\end{cases}$$\n\n\u4e0d\u96be\u53d1\u73b0\u8fd9\u6837\u8f6c\u79fb\u662f $O(n^2)$ \u7684\uff0c\u56e0\u4e3a\u6709 $O(n^2)$ \u4e2a\u72b6\u6001\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^4)$\uff0c\u65e0\u6cd5\u63a5\u53d7\u3002\n\n\u4e0d\u96be\u770b\u51fa $num$ \u7684\u8f6c\u79fb\u5c31\u662f\u4e00\u4e2a\u4e8c\u7ef4\u524d\u7f00\u548c\u5f62\u5f0f\uff0c\u7528\u4e8c\u7ef4\u524d\u7f00\u548c\u4f18\u5316 DP \u53ef\u4ee5\u5c06 $num_{i,j}$ \u7684\u8f6c\u79fb\u964d\u4e3a $O(1)$\u3002\u4f46\u662f $f$ \u4f3c\u4e4e\u4e0d\u80fd\u8fd9\u4e48\u4f18\u5316\uff1f\n\n\u5f53\u7136\u53ef\u4ee5\u3002\u663e\u7136 $\\sum f_{k,l}$ \u662f\u53ef\u4ee5\u524d\u7f00\u548c\u4f18\u5316\u7684\uff0c\u6211\u4eec\u5c06\u540e\u9762\u4e00\u90e8\u5206\u5355\u72ec\u62ce\u51fa\u6765\u770b\uff1a\n\n$$\\sum num_{k,l}\\times[(i-k-1)^2+(j-l-1)^2]$$\n\n\u8bb0 $num_{k,l}=S$\uff0c\u5e73\u65b9\u90e8\u5206\u62c6\u5f00\u6765\u5c31\u80fd\u5f97\u5230\n\n$$\\begin{aligned}&\\sum S\\times(i^2-2i+1-2ki+2k+k^2+j^2-2j+1-2lj+2l+l^2)\\\\=&\\sum S\\times[(i^2+j^2-2i-2j+2)+(k^2+l^2+2k+2l)-2ki-2lj]\\\\=&\\sum \\color{red}S\\color{black}\\times(i^2+j^2-2i-2j+2)+\\color{blue}S\\times(k^2+l^2+2k+2l)\\color{black}-\\color{orange}2Sk\\color{black}i-\\color{green}2Sl\\color{black}j\\end{aligned}$$\n\n\u5c06\u4e0a\u5f0f\u4e0e $i,j$ \u65e0\u5173\u7684\u4e8c\u7ef4\u524d\u7f00\u548c\u9884\u5904\u7406\u51fa\u6765\uff08\u5373\u7ea2\u8272\u7684 $\\sum num_{k,l}$\uff0c\u84dd\u8272\u7684 $\\sum num_{k,l}\\times(k^2+l^2+2k+2l)$\uff0c\u6a59\u8272\u7684 $2\\sum num_{k,l}\\times k$ \u548c\u7eff\u8272\u7684 $2\\sum num_{k,l}\\times l$\uff09\u5373\u53ef $O(1)$ \u8f6c\u79fb $f$\u3002\n\n\u7b54\u6848\u5373\u4e3a $\\sum f_{i,j}+num_{i,j}\\times[(n-i)^2+(m-j)^2]$\u3002\n\n- \u9700\u8981\u6ce8\u610f\u7684\u662f\u53ea\u6709\u5f53 $A_i=B_j$ \u7684\u65f6\u5019\u67ff\u5b50\u624d\u80fd\u7b97\u5165\u8d21\u732e\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define ll long long\n\nconst int N=3e3+5;\nconst int mod=1e9+7;\n\nll pw[N],f[N][N],num[N][N],sumf[N][N],sumn[N][N],cons[N][N],delk[N][N],dell[N][N],ans;\nstring s,t;\nint n,m;\n\nvoid add(ll &x,ll y){\n\tx+=y%mod;\n\tif(x>=mod)x-=mod; if(x<0)x+=mod;\n}\n\nint main() {\n\tfor(int i=1;i<N;i++)pw[i]=i*i;\n\tcin>>n>>m>>s>>t;\n\tfor(int i=0;i<=max(n,m);i++)sumn[i][0]=sumn[0][i]=1;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=m;j++){\n\t\t\tif(s[i-1]==t[j-1]){\n\t\t\t\tf[i][j]=sumf[i-1][j-1],num[i][j]=sumn[i-1][j-1];\n\t\t\t\tadd(f[i][j],(pw[i]+pw[j]-2*i-2*j+2)%mod*sumn[i-1][j-1]+cons[i-1][j-1]);\n\t\t\t\tadd(f[i][j],-delk[i-1][j-1]*i-dell[i-1][j-1]*j);\n\t\t\t\tadd(ans,f[i][j]+num[i][j]*(pw[n-i]+pw[m-j]));\n\t\t\t}\n\t\t\tsumf[i][j]=(sumf[i-1][j]+sumf[i][j-1]-sumf[i-1][j-1]+f[i][j]+mod)%mod;\n\t\t\tsumn[i][j]=(sumn[i-1][j]+sumn[i][j-1]-sumn[i-1][j-1]+num[i][j]+mod)%mod;\n\t\t\tcons[i][j]=(cons[i-1][j]+cons[i][j-1]-cons[i-1][j-1]+num[i][j]*(pw[i]+pw[j]+2*i+2*j)+mod)%mod;\n\t\t\tdelk[i][j]=(delk[i-1][j]+delk[i][j-1]-delk[i-1][j-1]+num[i][j]*2*i%mod+mod*2)%mod;\n\t\t\tdell[i][j]=(dell[i-1][j]+dell[i][j-1]-dell[i-1][j-1]+num[i][j]*2*j%mod+mod*2)%mod;\n\t\t}\n\tcout<<(ans+pw[n]+pw[m])%mod<<endl;\n\treturn 0;\n}\n```\n\n\u6c42\u8d5e qwq\u3002",
        "postTime": 1595595226,
        "uid": 123294,
        "name": "Alex_Wei",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P6693 \u3010\u8c37\u6b4c\u7ffb(sheng)\u8bd1(cao)\u673a\u3011"
    },
    {
        "content": "upd on 2021.7.12\uff1a\u91cd\u8c03\u4e86\u9898\u89e3\u6392\u7248~~\u5e76\u987a\u5e26\u4fee\u590d\u4e86\u94fe\u63a5~~\n\n------------\n\n[\u987a\u4fbf\u5ba3\u4f20\u4e00\u4e0b\u51fa\u9898\u4eba\u7684\u8c37\u6b4c\u751f\u8349\u4f5c\u54c1qwq\u3002](https://www.luogu.com.cn/blog/Ktian/ji-guai-di-fan-yi-zeng-jia-liao)\n\n------------\n\n\u4ee5\u4e0b\u590d\u6742\u5ea6\u5206\u6790\u5747\u4ee4 $n,m$ \u540c\u9636\u3002\n\n------------\n### Subtask 1\n\n\u6211\u4eec\u5728\u539f\u6765\u7684\u5b57\u7b26\u4e32\u6700\u524d\u9762\u548c\u6700\u540e\u9762\u90fd\u52a0\u4e00\u4e2a\u7279\u6b8a\u7684\u5b57\u7b26\uff08\u6bd4\u5982\u5728 $A$ \u548c $B$ \u6700\u524d\u9762\u90fd\u52a0\u4e00\u4e2a\u5b57\u7b26 `A`\uff0c\u6700\u540e\u9762\u90fd\u52a0\u4e00\u4e2a\u5b57\u7b26 `B`\uff09\u3002\n\n\u8bbe $f_{i,j}$ \u8868\u793a\u4e24\u4e2a\u5b57\u7b26\u4e32\u7684\u5206\u5272\u70b9\u5206\u522b\u4e3a $i,j$ \u65f6\u6240\u6709\u7406\u89e3\u65b9\u6848\u5230\u5f53\u524d\u4f4d\u7f6e\u65f6\u7684\u751f\u8349\u7a0b\u5ea6\u4e4b\u548c\uff0c$g_{i,j}$ \u8868\u793a\u603b\u65b9\u6848\u6570\u3002\n\n\u5bb9\u6613\u5f97\u5230\u4e0b\u9762\u4e24\u6761\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$f_{i,j}=\\begin{cases}\\sum\\limits_{k=0}^{i-1}\\sum\\limits_{l=0}^{j-1}\\left\\{f_{k,l}+g_{k,l}\\times\\left[(i-k-1)^2+(j-l-1)^2\\right]\\right\\}&A_i=B_j\\\\0&A_i\\neq B_j]\\end{cases}$\n\n$g_{i,j}=\\begin{cases}\\sum\\limits_{k=0}^{i-1}\\sum\\limits_{l=0}^{j-1}g_{k,l}&A_i=B_j\\\\0&A_i\\neq B_j\\end{cases}$\n\n\u6700\u7ec8\u7b54\u6848\u5373\u4e3a $f_{n+2,m+2}$\uff08\u56e0\u4e3a\u6211\u4eec\u5728\u5b57\u7b26\u4e32\u91cc\u52a0\u4e86\u4e24\u4e2a\u5b57\u7b26\uff09\u3002\n\n\u66b4\u529b\u8ba1\u7b97\u5373\u53ef\uff0c\u590d\u6742\u5ea6 $O(n^4)$\u3002\n\n------------\n### Subtask 2\n\n~~\u51fa\u9898\u4eba\u5e76\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u8981\u653e\u8fd9\u6863\u5206\u6570\u3002~~\n\n\u4e0d\u8fc7\u9a8c\u9898\u4eba\u5199\u4e86\u4e2a $O(n^3)$ \u505a\u6cd5\uff0c~~\u53ef\u4ee5\u53bb\u627e\u4ed6~~[\u505a\u6cd5\u5728\u52a0\u5f3a\u7248\u9898\u89e3\u91cc](https://www.luogu.com.cn/blog/Ktian/string-hard-ti-xie)\u3002\n\n------------\n### Subtask 3\n\n\u663e\u7136\u4e0a\u9762\u8ba1\u7b97 $g_{i,j}$ \u53ef\u4ee5\u5229\u7528\u524d\u7f00\u548c\u4f18\u5316\u3002\n\n\u8003\u8651\u662f\u5426\u53ef\u4ee5\u5229\u7528\u540c\u6837\u7684\u65b9\u5f0f\u6765\u8ba1\u7b97 $f_{i,j}$\u3002\n\n$\\begin{aligned}& \\sum\\limits_{k=0}^{i-1}\\sum\\limits_{l=0}^{j-1}\\left\\{f_{k,l}+g_{k,l}\\times\\left[(i-k-1)^2+(j-l-1)^2\\right]\\right\\}\\\\&=\\sum\\limits_{k=0}^{i-1}\\sum\\limits_{l=0}^{j-1}f_{k,l}+\\sum\\limits_{k=0}^{i-1}\\sum\\limits_{l=0}^{j-1}g_{k,l}\\times\\left[(i-k-1)^2+(j-l-1)^2\\right]\\end{aligned}$\n\n\u663e\u7136\u524d\u4e00\u90e8\u5206\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u6765\u8ba1\u7b97\u3002\n\n\u8bbe $h_{i,j}=\\sum\\limits_{k=0}^{i-1}\\sum\\limits_{l=0}^{j-1}g_{k,l}\\times\\left[(i-k-1)^2+(j-l-1)^2\\right]$\u3002\n\n$\\begin{aligned}h_{i,j}=&\\sum\\limits_{k=0}^{i-1}\\sum\\limits_{l=0}^{j-1}g_{k,l}\\times\\left[(i-k-1)^2+(j-l-1)^2\\right]\\\\=&{\\color{red}\\sum\\limits_{k=0}^{i-1}\\sum\\limits_{l=0}^{j-2}g_{k,l}\\times\\left[(i-k-1)^2+(j-l-2)^2\\right]}\\\\&+{\\color{blue}\\sum\\limits_{k=0}^{i-2}\\sum\\limits_{l=0}^{j-1}g_{k,l}\\times\\left[(i-k-2)^2+(j-l-1)^2\\right]}\\\\&-{\\color{green}\\sum\\limits_{k=0}^{i-2}\\sum\\limits_{l=0}^{j-2}g_{k,l}\\times\\left[(i-k-2)^2+(j-l-2)^2\\right]}\\\\&{\\color{orange}+(2i-1)\\sum\\limits_{k=0}^{i-1}g_{k,j}+(2j-1)\\sum\\limits_{l=0}^{j-1}g_{i,l}}\\\\&{\\color{purple}-2\\sum\\limits_{k=0}^{i-1}k\\times g_{k,j}-2\\sum\\limits_{l=0}^{j-1}l\\times g_{i,l}}\\\\=&{\\color{red}h_{i-1,j}}+{\\color{blue}h_{i,j-1}}-{\\color{green}h_{i-1,j-1}}\\\\&{\\color{orange}+(2i-1)\\sum\\limits_{k=0}^{i-1}g_{k,j}+(2j-1)\\sum\\limits_{l=0}^{j-1}g_{i,l}}\\\\&{\\color{purple}-2\\sum\\limits_{k=0}^{i-1}k\\times g_{k,j}-2\\sum\\limits_{l=0}^{j-1}l\\times g_{i,l}}\\end{aligned}$\n\n\uff08\u4e0a\u9762\u76f8\u540c\u989c\u8272\u5bf9\u5e94\u7684\u90e8\u5206\u5185\u5bb9\u76f8\u540c\uff09\n\n\u5bb9\u6613\u53d1\u73b0 $(2i-1)\\sum\\limits_{k=0}^{i-1}g_{k,j},(2j-1)\\sum\\limits_{l=0}^{j-1}g_{i,l},2\\sum\\limits_{k=0}^{i-1}k\\times g_{k,j},2\\sum\\limits_{l=0}^{j-1}l\\times g_{i,l}$ \u90fd\u53ef\u4ee5\u5229\u7528\u7c7b\u4f3c\u524d\u7f00\u548c\u4f18\u5316\u7684\u65b9\u6cd5\u5728 $O(n^2)$ \u5185\u63a8\u51fa\u3002\n\n\u603b\u590d\u6742\u5ea6 $O(n^2)$\u3002",
        "postTime": 1590762356,
        "uid": 104581,
        "name": "kkk\u7684\u5c0f\u8214\u72d7",
        "ccfLevel": 8,
        "title": "\u8c37\u6b4c\u7ffb(sheng)\u8bd1(cao)\u673a \u9898\u89e3"
    }
]