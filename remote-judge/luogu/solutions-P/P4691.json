[
    {
        "content": "### P.S.\n\u4eba\u751f\u7b2c\u4e00\u9053\u7531\u4e43OI\u7684\u9898\u554a\uff08\u81ea\u4e0a\u6b21\u90a3\u9053\u533a\u95f4sin\u548c\u88ab\u8e22\u51faYnoi\u540e\uff09\u3002  \n\u4e2a\u4eba\u89c9\u5f97\u7ec6\u8282\u8fd8\u662f\u86ee\u591a\u7684QAQ\uff08\u867d\u7136\u4ee3\u7801\u4e0d\u957f\uff09\u3002  \n\u5948\u8299\u83b2\u6700\u53ef\u7231\u4e86\uff0c\u6bd4\u73c2\u6735\u8389\u53ef\u7231\u591a\u4e86\u3002  \n\u642c\u8fd0`\u70b8\u8116\u9f99I`\u7684\u9898\u89e3\u7684\u3002  \n\n### Discription.\n\u7ed9\u5b9a\u4e00\u4e2a\u5e8f\u5217\uff0c\u8bbe\u51fd\u6570 $f(i,i)=a_i,f(i,j)=a^{f(i+1,j)}$\u3002  \n\u652f\u6301\u533a\u95f4\u52a0\uff0c\u67e5\u8be2 $f(l,r)\\:\\text{mod}\\:p\\quad(l\\le r)$\u3002  \n\uff08\u539f\u9898\u4e2d\u662f\u7528\u8fde\u6307\u6570\u8868\u793a\u7684\uff0c\u8fd9\u91cc\u7528\u4e86\u9012\u5f52\u5b9a\u4e49\u7684\u65b9\u6cd5\uff0c\u5e0c\u671b\u8bfb\u8005\u80fd\u770b\u5f97\u660e\u767d  \n\uff08\u7b14\u8005\u521a\u5f00\u59cb\u4e00\u76f4\u4ee5\u4e3a\u662f ${(a^b)}^c$\uff0c\u624b\u6a21\u6837\u4f8b\u6a21\u4e86\u534a\u5929\u3002  \n\n### Problem.\n\u770b\u4e0a\u53bb\u597d\u50cf\u5f88\u5c0f\u6e05\u65b0\u7684\uff0c\u5176\u5b9e\u5374\u662f\u5e26\u6bd2\u7624\u3002  \n\u8fd9\u9898\u662f\u9053\u533a\u95f4\u8be2\u95ee\uff0c\u4e00\u770b\u5c31\u5f88\u50cf\u7ebf\u6bb5\u6811\u3002  \n\u4f46\u662f\u6211\u4eec\u5374\u53d1\u73b0 $f(i,j)\\not=f(i,k)^{f(k+1,j)}$\uff08\u8fd9\u4e5f\u662f\u7b14\u8005\u521a\u5f00\u59cb\u72af\u7684\u9519\u8bef\u4e4b\u4e00\u3002  \n\u4f17\u6240\u5468\u77e5\uff0c\u7ebf\u6bb5\u6811\u7ef4\u62a4\u7684\u4e1c\u897f\u9700\u8981\u6ee1\u8db3\u533a\u95f4\u53ef\u52a0\u6027\uff0c\u6240\u4ee5\u8fd9\u9898\u65e0\u6cd5\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u3002  \n\u90a3\u4e48\u600e\u4e48\u529e\u5462\uff1f\u6211\u4eec\u8bf7\u51fa\u6700\u53ef\u7231\u7684\u5948\u8299\u83b2\u6811\uff01\uff08\u5948\u8299\u83b2\u6700\u53ef\u7231\u4e86\n#### Part. 0 ~~\u5948\u8299\u83b2\u7f8e\u56fe\u6b23\u8d4f\uff01\u611f\u89c9\u8981\u88ab\u73c2\u5b66\u5bb6D\u6ca1\uff0c\u4e0d\u8fc7\u5948\u8299\u83b2\u6700\u53ef\u7231\u4e86~~  \n![](http://tiebapic.baidu.com/forum/w%3D580/sign=9a2a0c799118367aad897fd51e728b68/d9ce46390cd79123bda65524ba345982b3b780ef.jpg)  \n#### Part. 1 \u5948\u8299\u83b2\u6811\u7b80\u4ecb\n\u7528\u4e8e\u89e3\u51b3\u7684\u95ee\u9898\uff1a\u597d\u50cf\u8303\u56f4\u5176\u5b9e\u633a\u5c0f\u7684\uff0c\u5e94\u8be5\u5c31\u53ea\u6709\u8fd9\u9898\u4e86\u5427\u3002  \n\u540d\u5b57\u7531\u6765\uff1a[Nephren Ruq Insania](https://www.luogu.com.cn/problem/P4691)  \n\u524d\u7f6e\u77e5\u8bc6\uff1a~~\u6269\u6b27~~\u597d\u5427\u662f[\u6269\u5c55\u6b27\u62c9\u5b9a\u7406](https://blog.csdn.net/can919/article/details/82318115)  \n\u524d\u7f6e\u77e5\u8bc6\uff1a[\u6811\u72b6\u6570\u7ec42](https://www.luogu.com.cn/problem/P3368)\uff0c[\u7ebf\u6027\u7b5b\u7b5bphi](https://www.baidu.com/s?ie=UTF-8&wd=%E7%BA%BF%E6%80%A7%E7%AD%9Bphi)  \n~~\u4e0d\u4f1a\u5427\u4e0d\u4f1a\u5427\uff0c\u4e0d\u4f1a\u771f\u6709\u4eba\u4e0d\u4f1a\u6811\u72b6\u6570\u7ec4\u5c31\u7206\u5207\u7531\u4e43OI\u5427~~\u3002  \n\u63a5\u4e0b\u6765\u7684\u53d9\u8ff0\u4e2d\u9ed8\u8ba4\u8bfb\u8005\u5df2\u7ecf\u638c\u63e1\u4e86\u5b83\uff08\u7b14\u8005\u592a\u83dc\uff0c\u4e0d\u4f1a\u8bc1\u660e  \n\n#### Part. 2 \u5948\u8299\u83b2\u6811\u5177\u4f53\u5b9e\u73b0\n\u9996\u5148\uff0c\u6211\u4eec\u56de\u987e\u4e00\u4e0b\u76ee\u7684\uff1a\u6211\u4eec\u9700\u8981\u6c42 $f(l,r)\\: \\text{mod}\\: p$\u3002  \n\u6211\u4eec\u5957\u4e0a\u6269\u5c55\u6b27\u62c9\u5b9a\u7406\uff1a\u5b83\u7b49\u4e8e $a_l^{f(l+1,r)\\:\\text{mod}\\:p+[f(l+1,r)\\ge \\phi(p)]\\times \\phi(p)}$  \n\uff08\u4e2d\u95f4\u90a3\u4e2a\u662f[\u827e\u5f17\u68ee\u62ec\u53f7](https://baike.baidu.com/item/%E8%89%BE%E4%BD%9B%E6%A3%AE%E6%8B%AC%E5%8F%B7/22361197?fr=aladdin)  \n\u4e8e\u662f\u6211\u4eec\u5c31\u628a $f(l,r)\\:\\text{mod}\\:p$ \u8f6c\u5316\u6210\u4e86 $f(l+1,r)\\:\\text{mod}\\: \\phi(p)$\uff08\u5f53\u7136\u4e2d\u95f4\u8fd8\u8981\u5206\u7c7b\u8ba8\u8bba  \n\u6211\u4eec\u53ef\u4ee5\u8bc1\u660e\uff1a$p\\rightarrow\\phi(p)$\u8fd9\u6837\u7684\u8fed\u4ee3\u53ea\u4f1a\u8fdb\u884c $\\log p$ \u6b21\uff0c\u8bc1\u660e\u5982\u4e0b\uff1a  \n- \u9996\u5148\uff0c\u6211\u4eec\u8bbe $p=\\prod_{i=1}^kp_i^{k_i}$\uff0c\u4e5f\u5c31\u662f\u628a $p$ \u5206\u89e3\u8d28\u56e0\u6570  \n- \u90a3\u4e48 $\\phi(p)=p\\prod_{i=1}^k\\frac{p_i-1}{p_i}$\uff0c\u6839\u636e\u5b9a\u4e49\u5f97\u6765  \n- \u5982\u679c $p\\:\\text{mod}\\:2=0$\uff0c\u90a3\u4e48\u4e0a\u9762\u7684\u8fde\u4e58\u7b26\u53f7\u4e2d\u6709\u4e00\u9879\u4e3a $\\frac12$\uff0c\u4e8e\u662f $\\phi(p)\\le\\frac12 p$\u3002  \n- \u5982\u679c $p\\:\\text{mod}\\:2=1$\uff0c\u90a3\u4e48\u8fde\u4e58\u7b26\u53f7\u4e2d\u80af\u5b9a\u5b58\u5728\u4e00\u4f4d\u7684\u5206\u5b50\u662f\u5076\u6570\uff0c\u4e8e\u662f $\\phi(p)\\:\\text{mod}\\:2=0$  \n\n\u4e8e\u662f\u5982\u679c\u6211\u4eec\u66b4\u529b\u5957\u6b27\u62c9\u5b9a\u7406\uff0c\u90a3\u4e48\u6211\u4eec\u6700\u591a\u8fdb\u884c $\\log$ \u6b21\u8fed\u4ee3\u3002  \n\u6240\u4ee5\u66b4\u529b\u7684\u590d\u6742\u5ea6\u662f\u5bf9\u7684\uff01\n\n\u63a5\u4e0b\u6765\u5c31\u662f\u4ee3\u7801\u5b9e\u73b0\u95ee\u9898\u4e86\uff0c\u56e0\u4e3a\u6269\u5c55\u6b27\u62c9\u5b9a\u7406\u4e2d\u9700\u8981\u5927\u91cf\u5206\u7c7b\u8ba8\u8bba\u3002  \n\u6211\u4eec\u4e5f\u9700\u8981\u8fdb\u884c\u4e00\u5b9a\u91cf\u7684\u5206\u7c7b\u8ba8\u8bba\u6765\u89e3\u51b3\u8fd9\u9053\u9898\u3002  \n1\u3001\u5982\u679c $\\exists i\\in[l,r],a_i=1$\uff0c\u90a3\u4e48 $f(l,r)=f(l,i)$\uff0c\u56e0\u4e3a $1^k=1,k\\in \\mathbb{N}$  \n2\u3001\u90a3\u4e48 $\\forall i\\in[l,r],a_i\\ge2$\uff0c\u6240\u4ee5 $f(l,l+5)\\le2^{2^{2^{2^{2^{}}}}}=2^{65536}\\ge 2\\times10^7\\ge p$\u3002  \n\u3000\u3000\u6240\u4ee5\u5982\u679c\u533a\u95f4\u957f\u5ea6\u5927\u4e8e $5$ \u4e14\u5176\u4e2d\u6ca1\u6709\u4e00\u4e2a $1$\uff0c\u90a3\u4e48\u8fd9\u4e2a\u533a\u95f4\u7684\u503c\u80af\u5b9a\u5927\u4e8e $p$\uff0c\u6211\u4eec\u6210\u529f\u7684\u907f\u514d\u4e86\u5206\u7c7b\u8ba8\u8bba\u3002  \n\n\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u8981\u5bf9\u4e8e\u6bcf\u4e2a\u533a\u95f4\uff0c\u66b4\u529b\u5904\u7406\u51fa\u7b2c\u4e8c\u4f4d\u5230\u7b2c\u516d\u4f4d\u3002  \n\uff08\u56e0\u4e3a\u7b2c\u4e00\u4f4d\u662f\u5e95\u6570\uff0c\u6211\u4eec\u60f3\u8981\u5224\u65ad\u7684\u662f\u6307\u6570\u548c\u6a21\u6570\u7684\u5173\u7cfb  \n\u5982\u679c\u8fd9\u4e94\u4f4d\u7684\u503c\u5927\u4e8e $P$\uff0c\u90a3\u4e48\u76f4\u63a5\u9012\u5f52\u5904\u7406\u3002  \n\u5426\u5219\u76f4\u63a5\u8ba1\u7b97\u7b54\u6848\u5c31\u597d\u4e86\u3002  \n\n\u5b8c\u7ed3\u6492\u82b1\uff0c\u6700\u540e\u6765\u4e00\u904d\uff1a\u5948\u8299\u83b2\u6700\u53ef\u7231\u4e86\uff01  \n\n### Coding.\n```cpp\n//\u4e0d\u4f1a\uff0c\u6211\u5e76\u6ca1\u6709\u505a\u4ec0\u4e48\u9700\u8981\u8ba9\u4f60\u9053\u8c22\u7684\u4e8b \u2014\u2014Nephren\n//\u5948\u8299\u83b2\u6700\u53ef\u7231\u4e86\uff01\u5948\u8299\u83b2\u6bd4\u73c2\u6735\u8389\u53ef\u7231\u591a\u4e86\u3002\n//\u4f17\u6240\u5468\u77e5\uff0c\u5a01\u83b2\u662f\u6307\u5a01\u5ec9\u548c\u83b2\uff0c\u6240\u4ee5\u5a01\u5ec9\u548c\u83b2\u662f\u5b98\u914d\uff01\n//\u4e0a\u9762\u8fd9\u4e9b\u5ffd\u7565\u5c31\u597d\u4e86\uff0c\u6015\u5f15\u6218\uff08\n#include<bits/stdc++.h>\n#define ri register\nusing namespace std;typedef long long ll;//\u8fd9\u4e9b\u5e94\u8be5\u6ca1\u4ec0\u4e48\u597d\u89e3\u91ca\u7684\nconst int N=500005,M=20000005;int Q,n,ph[M],p[M/10],id;ll t[N];char v[M];inline ll qry(int x);\nstruct node{ll v[N];int l[N];inline ll& operator[](int x) {return l[x]==id?v[x]:(l[x]=id,v[x]=qry(x));}}a;\n//\u4e0a\u9762\u662f\u6811\u72b6\u6570\u7ec4\u652f\u6301\u533a\u95f4\u4fee\u6539\u5355\u70b9\u67e5\u8be2\uff0c\u8fd9\u4e2a\u603b\u5e94\u8be5\u90fd\u4f1a\u4e86\u5427\u3002\n//\u8fd9\u91cc\u6211\u91cd\u5b9a\u4e49\u4e86[]\uff0c\u7528\u8d77\u6765\u65b9\u4fbf\u4e00\u70b9\uff0c\u800c\u4e14l\u662f\u7528\u6765\u5361\u5e38\u7684\uff0cid\u5728\u4e0b\u9762\u6811\u72b6\u6570\u7ec4\u4fee\u6539\u7528\ninline int read()\n{//\u5feb\u8bfb\uff0c\u4e0d\u89e3\u91ca\n\tri char c=getchar(),f=0;ri int t=0;\n\tfor(;c<'0'||c>'9';c=getchar()) if(!(c^45)) f=1;\n\tfor(;c>='0'&&c<='9';c=getchar()) t=(t<<1)+(t<<3)+(c^48);\n\treturn f?-t:t;\n}\ninline void write(int x)\n{//\u5feb\u8f93\uff0c\u4e0d\u89e3\u91ca\n\tstatic int t[25];ri int tp=0;\n\tif(x==0) return(void)(putchar('0'));else if(x<0) putchar('-'),x=-x;\n\twhile(x) t[tp++]=x%10,x/=10;\n\twhile(tp--) putchar(t[tp]+48);\n}\ninline void add(ri int x,ri ll y) {id++;for(;x<=n;x+=(x&(-x))) t[x]+=y;}\n//\u6811\u72b6\u6570\u7ec4\u4fee\u6539\uff0cid\u8868\u793a\u5f53\u524d\u662f\u7b2c\u51e0\u6b21\u4fee\u6539\uff0c\u547c\u5e94\u4e0a\u6587\u51cf\u5c0f\u5e38\u6570\u5904\ninline ll qry(ri int x) {ri ll r=0;for(;x;x-=(x&(-x))) r+=t[x];return r;}\n//\u6811\u72b6\u6570\u7ec4\u67e5\u8be2\uff08\u7528\u4e86\u5dee\u5206\u7684\u601d\u60f3\uff0c\u4e0d\u60f3\u89e3\u91ca\ninline int ksm(ri ll x,ri ll q,ri int P) {x%=P;int r=1;for(;q;q>>=1,x=1ll*x*x%P) if(q&1) r=1ll*r*x%P;return r%P;}\n//\u5feb\u901f\u5e42\uff0c\u6ce8\u610f\u70b9\uff1ax\u8981\u5f00ll\uff0cx\u4e00\u8fdb\u53bb\u5c31\u8981\u53d6\u6a21\uff0cq\u4e00\u5b9a\u8981\u5f00ll\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u8c03\u81ea\u95ed\u4e86\ninline void William()\n{//\u521d\u59cb\u5316\u7ebf\u6027\u7b5bphi[]\uff0c\u51fd\u6570\u540d\u5a01\u8fde\n\tri int pc=0;ph[1]=1;\n\tfor(int i=2;i<M;i++)\n\t{\n\t\tif(!v[i]) p[++pc]=i,ph[i]=i-1;\n\t\tfor(int j=1;j<=pc&&p[j]*i<M;j++) {v[p[j]*i]=1,ph[p[j]*i]=ph[i]*(i%p[j]?p[j]-1:p[j]);if(i%p[j]==0) break;}\n\t}\n}\ninline void Neph(int l,int r,int c) {add(l,c),add(r+1,-c);}\n//Nephren\u524d\u534a\u6bb5\uff0c\u533a\u95f4\u4fee\u6539\uff08\u5dee\u5206\ninline int ren(int l,int r,int P)\n{//Nephren\u540e\u534a\u6bb5\uff0c\u533a\u95f4\u67e5\u8be2\u67e5\u8be2f(l,r)%P\n\tif(a[l]%P==0) return 0;else if(P==1) return 1;else if(l==r) return a[l]%P+(a[l]>=P?P:0);\n//\u4e00\u5927\u5806\u7279\u5224\uff0c\u5e94\u8be5\u6ca1\u4ec0\u4e48\u597d\u89e3\u91ca\u7684\u4e86\u5427\uff0c\u53ea\u8981\u4ed4\u7ec6\u9605\u8bfb\u4e0a\u6587\u5e94\u8be5\u5c31\u80fd\u61c2\n\tint ls=min(l+5,r);for(int i=l+1;i<=ls;i++) if(a[i]==1) {ls=i;break;}ll g=0,la=a[ls];\n//\u66b4\u529b\u679a\u4e3e\u524d5\u4f4d\uff0c\u6ce8\u610fr\u53ef\u80fd\u5c0f\u4e8el+5\uff0c\u627e\u5230\u6700\u5de6\u8fb9\u7684a[i]=1\u7684\u4f4d\u7f6e\u3002\n\tfor(int i=ls-1;i>=l+1;i--) {g=la,la=1;while(g--) {la*=a[i];if(la>ph[P]) return ksm(a[l],ren(l+1,r,ph[P])+ph[P],P);}}\n//\u5bf9\uff0c\u4f60\u6ca1\u770b\u9519\uff0c\u8fde\u5feb\u901f\u5e42\u90fd\u4e0d\u9700\u8981\u76f4\u63a5\u66b4\u529bwhile\u5c31\u597d\u4e86\n\treturn ksm(a[l],la,P);//\u5982\u679c\u524d\u4e94\u4f4d\u5c0f\u4e8el\uff0c\u90a3\u4e48\u5c31\u76f4\u63a5return\u5feb\u901f\u5e42\n}\nsigned main()\n{\n\tn=read(),Q=read(),id=0,William();//\u8bfb\u5165\uff0c\u521d\u59cb\u5316\n\tfor(ri int i=1;i<=n;i++) scanf(\"%lld\",&a[i]),add(i,a[i]-a[i-1]);\n//\u8bfb\u5165\uff0c\u56e0\u4e3a\u4e0a\u9762\u91cd\u5b9a\u4e49[]\u65f6\u7528\u4e86\u5f15\u7528\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u8bfb\u5165\n\tfor(ri int fg,l,r,c;Q--;)\n\t{\n\t\tfg=read(),l=read(),r=read(),c=read();\n\t\tif(fg==1) Neph(l,r,c);else write(ren(l,r,c)%c),putchar('\\n');\n\t}\n\treturn 0;\n}\n```\n\u5b8c\u7ed3\u6492\u82b1",
        "postTime": 1600937742,
        "uid": 44805,
        "name": "Leap_Frog",
        "ccfLevel": 7,
        "title": "P4691 Nephren Ruq Insania\uff08\u9898\u89e3\uff09"
    }
]