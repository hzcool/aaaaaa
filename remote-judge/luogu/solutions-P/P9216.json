[
    {
        "content": "# \u3010HASH\u3011\u3010P9216\u3011\u5199\u5927\u4f5c\u4e1a\r\n\r\n> \u78d5\u5934\uff1a  \r\n> \u51fa\u9898\u65f6\u4e0d\u77e5\u9053\u65b0\u79d1\u6280\uff0c\u88ab\u968f\u673a hash \u8001\u54e5\u76f4\u63a5 $O(q)$ \u7206\u6807\u4e86\uff0c\u6210\u4e86\u5178\u9898\u3002\u8fd9\u7bc7\u9898\u89e3\u662f std \u7684\u542f\u53d1\u5f0f\u5408\u5e76\u505a\u6cd5\u3002\r\n\r\n## Analysis\r\n\r\n\u4ee5\u4e0b\u8bbe $m = \\sum_{i = 1}^n m_i$\u3002\r\n\r\n\u9996\u5148\u601d\u8003\u300e\u76f8\u4f3c\u300f\u7684\u5b9a\u4e49\uff0c\u5bb9\u6613\u53d1\u73b0\u6570\u5217 $a$ \u548c $b$ \u76f8\u4f3c\u7b49\u4ef7\u4e8e\u4efb\u610f\u6574\u6570\u5728 $a$ \u548c $b$ \u4e2d\u7684\u51fa\u73b0\u6b21\u6570\u76f8\u540c\u3002\r\n\r\n\u4e8e\u662f\u8003\u8651\u7ef4\u62a4\u6bcf\u4e2a\u6570\u5b57\u5728\u6bcf\u4e2a\u6570\u5217\u91cc\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u5bf9\u6bcf\u4e2a\u6570\u5217\u5f00\u4e00\u4e2a map \u5b58\u4e00\u4e0b\u5373\u53ef\u3002\u5982\u679c\u4e24\u4e2a\u6570\u5217\u5bf9\u5e94\u7684 map \u76f8\u540c\uff0c\u90a3\u4e48\u5b83\u4eec\u76f8\u4f3c\u3002\r\n\r\n\u8003\u8651\u5408\u5e76\u4e24\u4e2a\u6570\u5217\uff0c\u5c31\u662f\u5408\u5e76\u4e24\u4e2a map\u3002\u6ce8\u610f\u5230\u9898\u610f\u662f\u5408\u5e76\u5b8c\u4e00\u4e2a\u6570\u5217\u4ee5\u540e\u88ab\u5408\u5e76\u7684\u6570\u5217\u5c31\u88ab\u6254\u6389\u4e86\uff0c\u81ea\u7136\u8003\u8651\u542f\u53d1\u5f0f\u5408\u5e76\u3002\u5408\u5e76\u4e24\u4e2a map \u65f6\uff0c\u679a\u4e3e\u8f83\u5c0f\u7684 map \u91cc\u7684\u5143\u7d20\uff0c\u7136\u540e\u66b4\u529b\u505a\u5355\u70b9\u63d2\u5165\u5230\u53e6\u4e00\u4e2a map \u4e2d\u3002\u6ce8\u610f\u5230\u4e00\u4e2a\u6570\u5b57\u6bcf\u88ab\u679a\u4e3e\u5230\u4e00\u6b21\uff0c\u5b83\u6240\u5c5e\u7684\u96c6\u5408\u5927\u5c0f\u81f3\u5c11\u7ffb\u500d\uff0c\u6240\u4ee5\u81f3\u591a\u88ab\u679a\u4e3e $\\log m$ \u6b21\u3002\u628a\u6240\u6709\u6570\u5217\u90fd\u5408\u5e76\u8d77\u6765\u7684\u590d\u6742\u5ea6\u5c31\u662f $O(m \\log m)$\u3002\r\n\r\n\u63a5\u4e0b\u6765\u5904\u7406\u5224\u5b9a\u4e24\u4e2a map \u76f8\u540c\uff0c\u8003\u8651 hash\u3002\u4e3a\u4e86\u8fce\u5408\u542f\u53d1\u5f0f\u5408\u5e76\u7684\u5355\u70b9\u63d2\u5165\uff0c\u6211\u4eec\u7684 hash \u51fd\u6570\u5fc5\u987b\u80fd\u76f4\u63a5\u8ba1\u7b97\u5355\u4e2a\u6570\u5b57\u7684\u8d21\u732e\u3002std \u7684\u505a\u6cd5\u662f\uff1a\u5bf9\u4e00\u4e2a map \u5b9a\u4e49 hash \u51fd\u6570 $f$\uff0c\u5982\u679c\u6570\u5b57 $x$ \u5728\u6570\u5217\u91cc\u51fa\u73b0\u4e86 $y$ \u6b21\uff08\u5373 map \u91cc\u952e\u503c $x$ \u5bf9\u5e94\u7684\u6743\u503c\u662f $y$\uff09\uff0c\u90a3\u4e48\u5bf9 $f$ \u4ea7\u751f $x^{ky}$ \u7684\u8d21\u732e\u3002\u5176\u4e2d $k$ \u662f\u89c4\u5b9a\u7684\u5e38\u91cf\u3002std \u91cc\u53d6\u4e86 $k = 1,2,3,4,5$\u3002\r\n\r\n\u5728\u5408\u5e76\u4e24\u4e2a\u96c6\u5408\u65f6\uff0c\u5047\u8bbe\u628a map $a$ \u91cc\u7684\u5143\u7d20\u63d2\u5165\u5230 $b$ \u4e2d\uff0c$x$ \u5728 $a$ \u91cc\u7684\u6743\u503c\u662f $y_1$\uff0c\u5728 $b$ \u7684\u6743\u503c\u662f $y_2$\uff0c\u90a3\u4e48\u5bf9 $b$ \u7684 hash \u51fd\u6570\u7684\u5f71\u54cd\u662f\uff1a$- 2^{y_1} + 2^{y_1 + y_2}$\u3002\r\n\r\n\u6570\u636e\u4fdd\u8bc1\u4e86\u968f\u673a\uff0c\u6ca1\u6709\u5361\u81ea\u7136\u6ea2\u51fa\uff0c\u76f4\u63a5\u7528 unsigned long long \u81ea\u7136\u6ea2\u51fa hash \u503c\u5373\u53ef\u3002\r\n\r\n\u8fd9\u6837\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u505a\u542f\u53d1\u5f0f\u5408\u5e76\u7684\u540c\u65f6 $O(\\log m)$ \u5730\u7ef4\u62a4 hash \u503c\u7684\u53d8\u5316\uff0c\u6240\u4ee5\u542f\u53d1\u5f0f\u5408\u5e76\u7684\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $O(m \\log^2 m)$\u3002\u540c\u65f6\u53ef\u4ee5 $O(1)$ \u56de\u7b54\u6bcf\u6b21\u8be2\u95ee\u3002\u6240\u4ee5\u7b97\u6cd5\u7684\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(m \\log ^2 m + q)$\u3002\r\n\r\n## Code\r\n```cpp\r\n#include \"assert.h\"\r\n#include <map>\r\n#include <iostream>\r\n\r\nconst int maxn = 100005;\r\nconst int maxJ = 5;\r\n\r\ntypedef unsigned long long int ull;\r\n\r\null mpow(ull x, int y) {\r\n  ull ret = 1;\r\n  while (y) {\r\n    if (y & 1) ret *= x;\r\n    x *= x;\r\n    y >>= 1;\r\n  }\r\n  return ret;\r\n}\r\n\r\null hash[maxJ][maxn];\r\nstd::map<int, int> rec[maxn];\r\nbool oc[maxn];\r\n\r\nint main() {\r\n  std::ios::sync_with_stdio(false);\r\n  std::cin.tie(nullptr);\r\n  int n, q;\r\n  std::cin >> n >> q;\r\n  for (int i = 1, m, x; i <= n; ++i) {\r\n    for (std::cin >> m; m; --m) {\r\n      std::cin >> x;\r\n      ++rec[i][x];\r\n    }\r\n    for (int j = 0; j < maxJ; ++j) {\r\n      for (auto &[x, y] : rec[i]) {\r\n        hash[j][i] += mpow(x, j * y);\r\n      }\r\n    }\r\n  }\r\n  int ans = 0;\r\n  for (int i = 1, o, x, y; i <= q; ++i) {\r\n    std::cin >> o >> x >> y;\r\n    if (o == 2) {\r\n      bool ret = true;\r\n      for (int j = 0; j < maxJ; ++j) if (hash[j][x] != hash[j][y]) {\r\n        ret = false; break;\r\n      }\r\n      if (ret) ans ^= i;\r\n    } else {\r\n      assert(oc[x] == false);\r\n      oc[x] = true;\r\n      if (rec[x].size() > rec[y].size()) {\r\n        rec[x].swap(rec[y]);\r\n        for (int j = 0; j < maxJ; ++j) std::swap(hash[j][x], hash[j][y]);\r\n      }\r\n      for (auto &[u, v] : rec[x]) {\r\n        if (rec[y][u]) for (int j = 0; j < maxJ; ++j) hash[j][y] -= mpow(u, j * rec[y][u]);\r\n        for (int j = 0; j < maxJ; ++j) hash[j][y] += mpow(u, v * j);\r\n      }\r\n    }\r\n  }\r\n  std::cout << ans << '\\n';\r\n}\r\n```",
        "postTime": 1682305213,
        "uid": 65363,
        "name": "\u4e00\u6276\u82cf\u4e00",
        "ccfLevel": 7,
        "title": "\u3010P9216\u3011\u5199\u5927\u4f5c\u4e1a"
    },
    {
        "content": "[\u4f20\u9001\u95e8\uff01](https://www.luogu.com.cn/problem/P9216)\n\n## \u5199\u5927\u4f5c\u4e1a\n\n### Easy version\n\n**\u58f0\u660e\uff1aEasy version \u4e0e Hard version \u7684\u89e3\u6cd5\u5b8c\u5168\u4e0d\u540c\uff0c\u4e0d\u611f\u5174\u8da3\u8005\u53ef\u7565\u8fc7\u3002**\n\n#### \u9898\u610f\n\n- \u6709 $n$ \u4e2a\u5b57\u7b26\u4e32\uff0c\u603b\u957f\u5ea6\u4e0d\u8d85\u8fc7 $10^6$\uff0c\u6709 $q$ \u6b21\u8be2\u95ee\uff0c\u6709\u4ee5\u4e0b\u4e24\u79cd\uff1a\n\n\t- \u628a\u4e00\u4e2a\u4e32\u63a5\u5230\u53e6\u4e00\u4e2a\u4e32\u540e\u9762\u3002\n    \n    - \u5224\u65ad\u4e24\u4e2a\u4e32\u662f\u5426\u76f8\u4f3c\u3002\n    \n    > \u6b64\u5904\u300c\u76f8\u4f3c\u300d\u7684\u5b9a\u4e49\u4e3a\uff1a\n    \n    > \u4e00\u4e2a\u4e32\u53ef\u4ee5\u7ecf\u91cd\u6392\u5f97\u5230\u53e6\u4e00\u4e2a\u4e32\u3002\n    \n- $n,q\\le10^5$\n\n#### \u89e3\u6cd5\n\n\u4e24\u4e32\u76f8\u4f3c\u7b49\u4ef7\u4e8e\u5b57\u6bcd\u4e2a\u6570\u5206\u522b\u76f8\u7b49\u3002\n\n\u76f4\u63a5\u8bb0\u5f55\u5b57\u6bcd\u4e2a\u6570\u3002$O(Rn)$\uff0c\u5176\u4e2d $R$ \u4e3a\u5b57\u7b26\u96c6\u5927\u5c0f\u3002\n\n```cpp\nconst int N=100005;\nint n,q,op,x,y;\nstring s;\nint cnt[N][26];\nvoid Solve()\n{\n\tcin>>n>>q;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tcin>>s;\n\t\tfor(char ch:s)cnt[i][ch-'a']++;\n\t}\n\twhile(q--)\n\t{\n\t\tcin>>op>>x>>y;\n\t\tif(op==1)\n\t\t{\n\t\t\tfor(int i=0;i<26;i++)cnt[y][i]+=cnt[x][i];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tbool ok=1;\n\t\t\tfor(int i=0;i<26;i++)\n\t\t\t\tif(cnt[y][i]!=cnt[x][i]){ok=0;break;}\n\t\t\tputs(ok?\"Yes\":\"No\");\n\t\t}\n\t}\n}\n```\n\n### Hard version\n\n\u9898\u610f\u4e0e Easy version \u76f8\u540c\uff0c\u4f46\u662f\u6570\u636e\u8303\u56f4\u3001\u8f93\u51fa\u683c\u5f0f\u4e0d\u540c\u3002\n\n$n\\le10^5,q\\le5\\times10^6$\uff0c\u5b57\u7b26\u4e32\u53d8\u6210\u6570\u5217\uff0c\u503c\u57df\u4e3a $[0,10^9]$\uff0c\u603b\u957f\u5ea6 $M\\le5\\times10^5$\u3002\n\n#### \u89e3\u6cd5\n\n\u6b64 version \u4e2d $R$ \u9ad8\u8fbe $10^9$\uff0c\u5373\u4f7f\u79bb\u6563\u5316\u4e5f\u53ea\u80fd\u5c06 $R$ \u964d\u5230 $M$ \u7684\u91cf\u7ea7\uff0c\u6240\u4ee5\u521a\u624d\u7684\u505a\u6cd5\u5bc4\u4e86\u3002\n\n\u8003\u8651 hash\uff0c\u5148\u5c06\u6570\u5217\u79bb\u6563\u5316\u81f3\u6700\u591a $M$ \u4e2a\u6570\u5b57\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u628a $x$ \u66ff\u6362\u6210\u7b2c $x$ \u4e2a\u8d28\u6570\uff0c\u7136\u540e\u5c06\u4e00\u4e2a\u6570\u5217\u7684 hash \u503c\u5b9a\u4e49\u6210\u5176\u4e2d\u6240\u6709\u6570\u7684\u4e58\u79ef\u3002\n\n> \u4f8b\u5982\uff1a$114\\ 514\\ 1919\\ 114\\ 810\\ 1919\\rightarrow1\\ 2\\ 3\\ 1\\ 4\\ 3\\rightarrow2\\ 3\\ 5\\ 2\\ 7\\ 5$\n\n> $hash=2\\times3\\times5\\times2\\times7\\times5=2100$\n\n\u4e3a\u4ec0\u4e48\u8fd9\u6837\u505a\u5462\uff1f\u56e0\u4e3a\u9664\u975e\u51b2\u7a81\uff0c\u5426\u5219\u4e0d\u76f8\u4f3c\u7684\u6570\u5217 hash \u503c\u4e00\u5b9a\u4e0d\u540c\u3002\n\n\u800c\u4e14\uff0c\u7b2c $5\\times10^5$ \u4e2a\u8d28\u6570\u5c0f\u4e8e $10^7$\uff0c\u5b8c\u5168\u53ef\u4ee5\u63a5\u53d7\u3002\n\n\u8fde\u63a5\u6570\u5217\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u4ee4 $hash_y\\leftarrow hash_y\\times hash_x$ \u5c31\u53ef\u4ee5\u4e86\u3002\n\n**\u4e0d\u80fd\u7528 `unsigned long long`\uff0c\u8981\u81ea\u5df1\u6a21\u4e00\u4e2a\u5927\u8d28\u6570\u3002**\n\n```cpp\n//struct ModInt{};\nbool p[10000005];\nint PRIME_CNT,pri[500005];\nvoid Init()\n{\n\tmemset(p,1,sizeof(p));\n\tfor(int i=2;PRIME_CNT<500000;i++)\n\t\tif(p[i])\n\t\t{\n\t\t\tpri[++PRIME_CNT]=i;\n\t\t\tfor(ll j=1ll*i*i;j<=10000000;j+=i)p[j]=0;\n\t\t}\n}\nconst int N=100005;\nint n,m;\nmap<int,ModInt>lsh;int cnt;\nModInt Lsh(int x)\n{\n\tif(!lsh.count(x))lsh[x]=pri[++cnt];\n\treturn lsh[x];\n}\nint ANS;\nModInt hsh[N];\nvoid Solve()\n{\n\tcin>>n>>m;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint k;cin>>k;hsh[i]=1;\n\t\twhile(k--)\n\t\t{\n\t\t\tint x;\n\t\t\tcin>>x;\n\t\t\thsh[i]*=Lsh(x);\n\t\t}\n\t}\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint op,x,y;\n\t\tcin>>op>>x>>y;\n\t\tif(op==1)hsh[y]*=hsh[x];\n\t\telse if(hsh[x]==hsh[y])ANS^=i;\n\t}\n\tcout<<ANS;\n}\n```",
        "postTime": 1681566435,
        "uid": 549499,
        "name": "Donotplaygame",
        "ccfLevel": 5,
        "title": "P9216 \u9898\u89e3"
    },
    {
        "content": "## \u9898\u89e3\n\n\u5982\u4f55\u5224\u5b9a\u4e24\u4e2a\u5e8f\u5217\u53ef\u901a\u8fc7\u91cd\u65b0\u6392\u5217\u4f7f\u5f97\u4e24\u6570\u5217\u76f8\u7b49\uff1f\u4e0d\u59a8\u60f3\u60f3\u6709\u4ec0\u4e48\u4e1c\u897f\u662f\u548c\u5e8f\u5217\u6709\u5173\u800c\u53c8\u53ef\u4ee5\u91cd\u65b0\u6392\u5217\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u8fd9\u6837\u7684\u4e00\u4e2a\u591a\u9879\u5f0f\uff1a\n\n$$F_a(x)=(x+a_1)(x+a_2)\\cdots(x+a_{n-1})(x+a_n)$$\n\n\u90a3\u4e48\u5982\u679c $F_a(x)=F_b(x)$\uff0c\u5c31\u8bf4\u660e $a,b$ \u53ef\u4ee5\u901a\u8fc7\u91cd\u6392\u53d8\u5f97\u76f8\u540c\u3002\n\n\u4f46\u672c\u9898\u4e2d\u6211\u4eec\u663e\u7136\u4e0d\u53ef\u80fd\u8dd1\u4e2a\u5206\u6cbb FFT \u5565\u7684\uff08\u51b5\u4e14\u590d\u6742\u5ea6\u4f30\u8ba1\u8981\u70b8\uff09\u3002\u56e0\u4e3a\u6211\u4eec\u53ea\u662f\u8981\u5224\u5b9a\u4e24\u4e2a\u591a\u9879\u5f0f\u662f\u5426\u76f8\u540c\uff0c\u4e00\u79cd\u7b80\u4fbf\u53ef\u9760\u7684\u505a\u6cd5\u662f\uff0c\u9009\u53d6 $k$ \u4e2a\u4e0d\u540c\u7684 $x$ \u7684\u503c $x_1,x_2,\\cdots x_k$\uff0c\u5206\u522b\u5e26\u5165\u4e24\u4e2a\u591a\u9879\u5f0f\u8fdb\u884c\u8ba1\u7b97\u3002\u90a3\u4e48\u4e24\u4e2a\u591a\u9879\u5f0f\u76f8\u540c\u7684\u4e00\u4e2a\u5fc5\u8981\u6761\u4ef6\u663e\u7136\u662f\uff1a\n\n$$\\begin{cases}F_a(x_1)=F_b(x_1)\\cr F_a(x_2)=F_b(x_2)\\cr\\cdots \\cr F_a(x_k)=F_b(x_k)\\cr\\end{cases}$$\n\n\u7136\u540e\u8003\u8651\u5230\u5199\u9ad8\u7cbe\u5ea6\u590d\u6742\u5ea6\u8fd8\u662f\u4f1a\u7206\u70b8\u7684\uff0c\u6240\u4ee5\u5c06\u7b49\u5f0f\u4e24\u8fb9\u540c\u65f6\u5bf9\u4e00\u4e2a\u6a21\u6570 $M$ \u53d6\u6a21\uff08\u4e0d\u540c\u7684\u6a21\u6570\u4e5f\u884c\uff0c\u53cd\u6b63\u4e5f\u5361\u4e0d\u6389\uff0c\u8fd9\u91cc\u53ea\u662f\u4e3a\u4e86\u5b9e\u73b0\u65b9\u4fbf\uff09\u3002\u56e0\u6b64\u4e00\u4e2a\u5fc5\u8981\u6761\u4ef6\u662f\uff1a\n\n$$\\begin{cases}F_a(x_1)\\equiv F_b(x_1) & \\pmod M\\cr F_a(x_2)\\equiv F_b(x_2) & \\pmod M\\cr\\cdots \\cr F_a(x_k)\\equiv F_b(x_k) & \\pmod M\\end{cases}$$\n\n\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0c\u6211\u4eec\u5bf9\u4e8e\u5e8f\u5217 $a$ \u8ba1\u7b97\u51fa\u4e00\u4e2a\u5e8f\u5217 $H_a=\\{F_a(x_1)\\bmod M,F_a(x_2)\\bmod M,\\cdots,F_a(x_k)\\bmod M\\}$ \u4f5c\u4e3a\u5b83\u7684\u7279\u5f81\u503c\uff08\u76f8\u5f53\u4e8e\u54c8\u5e0c\u503c\uff09\u3002\u5224\u5b9a\u4e24\u4e2a\u5e8f\u5217 $a,b$ \u662f\u5426\u53ef\u901a\u8fc7\u91cd\u65b0\u6392\u5217\u53d8\u5f97\u76f8\u7b49\uff0c\u53ea\u8981\u5224\u65ad $H_a$ \u548c $H_b$ \u662f\u5426\u76f8\u7b49\u5c31\u884c\uff0c\u6b63\u786e\u7387\u5e94\u8be5\u5f88\u9ad8\uff08~~\u6211\u731c\u7684~~\uff09\u3002\u590d\u6742\u5ea6\u662f $\\mathcal O(k)$\u3002\n\n\u7136\u540e\u5bf9\u4e8e\u5e8f\u5217\u62fc\u63a5\u64cd\u4f5c\uff0c\u663e\u7136 $H_{a+b}=H_a\\cdot H_b$\uff0c\u8fd9\u662f\u56e0\u4e3a $F_{a+b}(x)=F_a(x)F_b(x)$\uff0c\u628a $F$ \u7684\u5b9a\u4e49\u5f0f\u5c55\u5f00\u5c31\u80fd\u5f97\u5230\u3002\u6240\u4ee5\u590d\u6742\u5ea6\u4ecd\u7136\u662f $\\mathcal O(k)$\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O(nk+qk)$\u3002\u4e0b\u9762\u4ee3\u7801\u4e2d\u53d6\u4e86 $k=30$\u3002\n\n\u7ecf\u8fc7\u5b9e\u6d4b\u5373\u4f7f $k=1$ \u4e5f\u80fd\u901a\u8fc7\u6240\u6709\u6570\u636e\u2026\u2026\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define up(l, r, i) for(int i = l, END##i = r;i <= END##i;++ i)\n#define dn(r, l, i) for(int i = r, END##i = l;i >= END##i;-- i)\nusing namespace std;\ntypedef long long i64;\nconst int INF = 2147483647;\nint qread(){\n    int w = 1, c, ret;\n    while((c = getchar()) >  '9' || c <  '0') w = (c == '-' ? -1 : 1); ret = c - '0';\n    while((c = getchar()) >= '0' && c <= '9') ret = ret * 10 + c - '0';\n    return ret * w;\n}\nconst int MAXN = 5e5 + 3;\nconst int MAXM = 5e5 + 3;\nconst int MAXK = 30 + 3;\nconst int MOD  = 1e9 + 7;\nint S[MAXN][MAXK], T[MAXK], k = 30, n, q;\nmt19937 MT;\nint main(){\n    n = qread(), q = qread();\n    uniform_int_distribution <int> U(0, MOD - 1);\n    up(1, k, i) T[i] = U(MT);\n    up(1, n, i){\n        int m = qread();\n        up(1, k, j) S[i][j] = 1;\n        up(1, m, j){\n            int a = qread();\n            up(1, k, t)\n                S[i][t] = 1ll * S[i][t] * (a + T[t]) % MOD;\n        }\n    }\n    int ans = 0;\n    up(1, q, i){\n        int o = qread();\n        if(o == 1){\n            int x = qread(), y = qread();\n            up(1, k, j)\n                S[y][j] = 1ll * S[y][j] * S[x][j] % MOD;\n        } else {\n            int x = qread(), y = qread();\n            bool flag = true;\n            up(1, k, j)\n                if(S[x][j] != S[y][j])\n                    flag = false;\n            if(flag) ans ^= i;\n        }\n    }\n    printf(\"%d\\n\", ans);\n    return 0;\n}\n```",
        "postTime": 1681488217,
        "uid": 68344,
        "name": "\u79bb\u6563\u5c0f\u6ce2\u53d8\u6362\u00b0",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P9216 \u3010[\u5165\u95e8\u8d5b #11] \u5199\u5927\u4f5c\u4e1a (Hard Version)\u3011"
    },
    {
        "content": "\u6ce8\u610f\u5230\u4e00\u4e2a\u5e8f\u5217\u88ab\u5408\u5e76\u4e4b\u540e\u4e0d\u4f1a\u518d\u6b21\u51fa\u73b0\u3002\n\n\u6240\u4ee5\uff0c\u5b9e\u9645\u4e0a\uff0c\u628a\u4e24\u4e2a\u5e8f\u5217\u5408\u5e76\u540e\u7684\u65b0\u5e8f\u5217\u770b\u6210\u8fd9\u4e24\u4e2a\u5e8f\u5217\u7684\u7236\u4eb2\uff0c\u6240\u4ee5\u8fd9\u4e9b\u5e8f\u5217\u5c31\u6784\u6210\u4e00\u4e2a **\u6811\u6027\u7ed3\u6784** \u3002\n\n\u90a3\u4e48\u5c31\u5f88\u663e\u7136\u4e86\uff0c\u91c7\u53d6 **\u542f\u53d1\u5f0f\u5408\u5e76** \u3002\n\n\u4e5f\u5c31\u662f\u628a\u5c0f\u7684\u5e8f\u5217\u66b4\u529b\u63d2\u5165\u5230\u5927\u5e8f\u5217\u4e2d\u3002\n\n\u6ce8\u610f\u5230\u5bf9\u4e8e\u6bcf\u4e2a\u5143\u7d20\uff0c\u5982\u679c\u88ab\u66b4\u529b\u63d2\u5165\uff0c\u90a3\u4e48\u5b83\u6240\u5728\u7684\u5e8f\u5217\u957f\u5ea6\u81f3\u5c11\u7ffb\u500d\uff0c\u6240\u4ee5\u6700\u591a\u88ab\u66b4\u529b\u63d2\u5165 $\\log n$ \u6b21\uff0c\u603b\u590d\u6742\u5ea6\u4e5f\u5c31\u662f $O(n \\log n)$ \u7684\u3002\n\n\u518d\u8003\u8651\u67e5\u8be2\u3002\n\n\u67e5\u8be2\u672c\u8d28\u4e0a\u662f\u95ee\u6bcf\u4e2a\u6570\u51fa\u73b0\u6b21\u6570\u662f\u5426\u76f8\u7b49\u3002\n\n\u7c7b\u4f3c\u4e8e\u661f\u6218\u7684\u505a\u6cd5\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u6570\u9644\u4e0a\u4e00\u4e2a\u968f\u673a\u6743\u503c $v_i$\u3002\n\n\u5b9a\u4e49\u4e00\u4e2a\u5e8f\u5217\u7684\u54c8\u5e0c\u503c\u4e3a $\\sum v_i^{tot_i}(tot_i \\not = 1)$\u3002\n\n\u5224\u65ad\u54c8\u5e0c\u503c\u662f\u5426\u76f8\u7b49\u5373\u53ef\u3002\n\n\u4f46\u662f\u76f4\u63a5\u505a\u4f1a\u5e26\u4e00\u4e2a $\\log V$\u3002\n\n\u6240\u4ee5\u8003\u8651\u8bb0\u5f55\u6bcf\u4e2a\u6570\u7684\u8d21\u732e\uff0c\u6bcf\u6b21\u4fee\u6539\u62ff\u51fa\u6765\u4e58\u4e0a\u4e00\u4e2a $v_i$ \u518d\u52a0\u56de\u53bb\u3002\n\n\u8fd9\u6837\u590d\u6742\u5ea6 $O(n \\log n + q)$\u3002\n\n\u7531\u4e8e\u76f4\u63a5\u7528 `unordered_map` \u5e38\u6570\u6bd4 `map` \u8fd8\u5dee\u3002\u6240\u4ee5\u4f7f\u7528\u4e86 `pbds`\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#include<bits/extc++.h>\n#define int unsigned int\nusing namespace std;\nconst int maxn = 1e5+114;\n__gnu_pbds::gp_hash_table<int,int> val;\nint anser;\nint fa[maxn];\nclass Node{\n    public:\n    vector<int> v;\n    __gnu_pbds::gp_hash_table<int,int> tot;\n    __gnu_pbds::gp_hash_table<int,int> V;\n    inline void init();\n    inline void insert(int x);\n    int Hash;\n}chifan[maxn];\ninline int found(int u){\n    return fa[u]=(fa[u]==u?u:found(fa[u]));\n}\ninline void Node::init(){\n    Hash=0;\n}\ninline void Node::insert(int x){\n    if(val[x]==0){\n        val[x]=(rand()+1)*(rand()+1);\n    }\n    v.push_back(x);\n    tot[x]++;\n    Hash-=V[x];\n    if(V[x]==0) V[x]=val[x];\n    else V[x]*=val[x];\n    Hash+=V[x];\n}\ninline void merge(int a,int b){\n    a=found(a),b=found(b);\n    if(chifan[a].v.size()>chifan[b].v.size()) swap(a,b);\n    for(int u:chifan[a].v){\n        chifan[b].insert(u);\n    }\n    fa[a]=b;\n}\ninline void query(int pos,int a,int b){\n    a=found(a),b=found(b);\n    if(chifan[a].Hash==chifan[b].Hash){\n        anser^=pos;\n    }\n}\ninline int read(){\n    int x=0,f=1;char ch=getchar();\n    while (ch<'0'||ch>'9'){if (ch=='-') f=-1;ch=getchar();}\n    while (ch>='0'&&ch<='9'){x=x*10+ch-48;ch=getchar();}\n    return x*f;\n}\n\nint n,q;\nsigned main(){\n    n=read(),q=read();\n    for(int i=1;i<=n;i++) fa[i]=i;\n    for(int i=1;i<=n;i++){\n        chifan[i].init();\n        int m;\n        m=read();\n        for(int j=1;j<=m;j++){\n            int v;\n            v=read();\n            chifan[i].insert(v);\n        }\n    }\n    for(int i=1;i<=q;i++){\n        int op,a,b;\n        op=read(),a=read(),b=read();\n        if(op==1) merge(a,b);\n        else query(i,a,b);\n    }\n    cout<<anser;\n}\n```\n\n\u6c42\u52a9\uff1a\u8c01\u77e5\u9053\u5982\u4f55\u8ba1\u7b97\u6211\u8fd9\u4e2a\u54c8\u5e0c\u7684\u51fa\u9519\u6982\u7387\uff1f",
        "postTime": 1681514761,
        "uid": 520748,
        "name": "_ChiFAN_",
        "ccfLevel": 4,
        "title": "P9216 \u9898\u89e3"
    },
    {
        "content": "# \u601d\u60f3\n\n\u867d\u7136\u6b63\u89e3\u662f\u4ec0\u4e48\u542f\u53d1\u5f0f\u5408\u5e76\n\n~~\u4f46\u662f\u6211\u4e0d\u4f1a~~\n\n\u8fd9\u4e2a\u9898\u76ee\u80fd\u7528 hash \u6765\u89e3\u3002\u8fd9\u4e1c\u897f\u652f\u6301\u5408\u5e76\uff0c\u67e5\u8be2\uff0c\u5f88\u65b9\u4fbf\uff0c\u8fd8\u80fd\u538b\u7f29\u7a7a\u95f4\u3002\n\n\u4f46\u662f hash \u6709\u91cd\u590d\u7684\u6982\u7387\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528\u591a\u7ec4 hash \u6765\u964d\u4f4e\u91cd\u590d\u6982\u7387\u3002\n\n\u7b56\u7565\u4fbf\u662f\u7528\u67d0\u4e2a\u5e38\u6570\u7684\u6b21\u65b9\u6765\u505a\u3002\n\n\u6bd4\u5982\u8bf4\u5bf9\u4e8e\u8fd9\u4e2a\u6587\u732e\uff1a\n\n $a_i={1,2,3,4,5}$ \n \n\u6709\u4e09\u6761\u4fe1\u606f\u8981\u8bb0\u5f55\uff1a\n\n\u7b2c\u4e00\u4e2a\u662f $b_i=7^1+7^2+7^3+7^4+7^5$ \u4e3a $7^{a_{i_j}}$\u3002\n\n\u7b2c\u4e8c\u4e2a\u662f $c_i=13^1+13^2+13^3+13^4+13^5$ \u4e3a $13^{a_{i_j}}$\u3002\n\n\u7b2c\u4e09\u4e2a\u662f\u5e8f\u5217\u957f\u5ea6\u3002\n\n\u5408\u5e76\u65f6\u76f8\u52a0\u5c31\u884c\u4e86\u3002\n\n# \u4ee3\u7801\n```\n#include<iostream>\n#include<bits/stdc++.h>\n#define mod 9223372036854765808//\u6a21\u6570\n#define ll long long \nusing namespace std;\nll ksm(ll a,ll b)\n{\n\tll ans=1;\n\twhile(b)\n\t{\n\t\tif(b&1)\n\t\t{\n\t\t\tans*=a;\n\t\t\tans%=mod;\n\t\t}\n\t\ta*=a;\n\t\ta%=mod;\n\t\tb>>=1;\n\t}\n\treturn ans;//\u5feb\u901f\u5e42\n}\nll n,q;\nll m[1000005];\nll a[1000005];\nll b[1000005];\nint main()\n{\n\tios::sync_with_stdio(0);\n\tcin.tie(0);\n\tcout.tie(0);\n\tcin>>n>>q;\n\tll ttttttt1111;\n\tfor(ll i=1;i<=n;i++)\n\t{\n\t\tcin>>m[i];\n\t\tfor(ll j=1;j<=m[i];j++)\n\t\t{\n\t\t\tcin>>ttttttt1111;\n\t\t\tttttttt1111%=mod;\n\t\t\ta[i]+=ksm(7,ttttttt1111);\n\t\t\ta[i]%=mod;\n\t\t\tb[i]+=ksm(13,ttttttt1111);\n\t\t\tb[i]%=mod;//\u54c8\u5e0c\n\t\t}\n\t}\n\tll ans=0;\n\tfor(ll i=1;i<=q;i++)\n\t{\n\t\tll opt;\n\t\tcin>>opt;\n\t\tif(opt==1)\n\t\t{\n\t\t\tll x,y;\n\t\t\tcin>>x>>y;\n\t\t\ta[y]+=a[x];\n\t\t\tb[y]+=b[x];\n\t\t\tm[y]+=m[x];\n\t\t\ta[x]=0;\n\t\t\tb[x]=0;\n\t\t\tm[x]=0;\n\t\t\ta[y]%=mod;\n\t\t\tb[y]%=mod;//\u5408\u5e76\n\t\t}\n\t\telse\n\t\t{\n\t\t\tll x,y;\n\t\t\tcin>>x>>y;\n\t\t\tif(m[x]==m[y]&&a[x]==a[y]&&b[x]==b[y])\n\t\t\t{\n\t\t\t\tans^=i;\n\t\t\t}//\u76f8\u4f3c\n\t\t}\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```\n",
        "postTime": 1682341926,
        "uid": 713916,
        "name": "caohan",
        "ccfLevel": 0,
        "title": "P9216 [\u5165\u95e8\u8d5b #11] \u5199\u5927\u4f5c\u4e1a (Hard Version) \u9898\u89e3"
    },
    {
        "content": "\u5efa\u8bae\u8bc4\u7eff\uff08\u4e0b\u4f4d\u84dd\u4ea6\u53ef\uff09\u3002\n\n### \u601d\u8def\n\n\u89c2\u5bdf\u5230\u6bcf\u6b21\u65e0\u975e\u7ef4\u62a4\u4e24\u4e2a\u96c6\u5408\u662f\u5426\u76f8\u540c\uff0c\u4ee5\u53ca\u96c6\u5408\u7684\u5408\u5e76\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5bf9\u6bcf\u4e2a\u96c6\u5408\u7684\u503c\u57df\u5f00\u4e00\u4e2a\u6876\uff0c\u7136\u540e\u54c8\u5e0c\u5730\u5224\u65ad\u662f\u5426\u76f8\u540c\u3002\n\n\u4f46\u662f\u8fd9\u6837\u590d\u6742\u5ea6\u4ee3\u4ef7\u592a\u9ad8\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u4f7f\u7528 set + \u542f\u53d1\u5f0f\u5408\u5e76\u3002\n\n\u54c8\u5e0c\u7684\u65b9\u6cd5\u6bd4\u8f83\u591a\u6837\uff0c\u53ea\u8981\u4fdd\u8bc1\u4e0d\u592a\u53ef\u80fd\u91cd\u590d\u5373\u53ef\u3002\u4e3a\u4e86\u4fdd\u9669\u53ef\u4ee5\u4f7f\u7528\u53cc\u54c8\u5e0c\u4e4b\u7c7b\u7684\u3002\n\n\u590d\u6742\u5ea6 $O(n \\log n)$\u3002\n\n\u4f46\u662f\u4eb2\u6d4b\u76f4\u63a5\u66b4\u529b\u5408\u5e76\u4f3c\u4e4e\u4e5f\u80fd\u8fc7\uff0c\u6240\u4ee5\u5c31\u6ca1\u6709\u5199\u542f\u53d1\u5f0f\u5408\u5e76\u4e86\u3002\uff08\n\n### \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n\n// \u7f3a\u7701\u6e90\n\nusing namespace std;\n\n#define pii pair<int,int>\n\n#define int long long\n\nconst int MAXN=100005,mod=1e18+7,MOD=1e18+9; \nint val1[MAXN],val2[MAXN],fa[MAXN];\n\nunordered_map<int,int> vis; \n\ninline int find(int k){return fa[k]==k?k:fa[k]=find(fa[k]);}\n\nset<pii> s[MAXN];\nvoid merge(int x,int y){\n\tfor(set<pii>::iterator it=s[x].begin();it!=s[x].end();it++){\n\t\tset<pii>::iterator jt=s[y].lower_bound(make_pair(it->first,0));\n\t\tint cnt;\n\t\tif(jt==s[y].end() || jt->first!=it->first) cnt=0;\n\t\telse cnt=jt->second,s[y].erase(jt);\n\t\ts[y].insert(make_pair(it->first,cnt+(it->second)));\n\t}\n\tval1[y]=val2[y]=0;\n\tfor(set<pii>::iterator it=s[y].begin();it!=s[y].end();it++){\n\t\tval1[y]=(1ll*val1[y]*114514%mod+1ll*vis[it->first]*(it->second)%mod)%mod;\n\t\tval2[y]=(1ll*val2[y]*1919810%mod+1ll*vis[it->first]*(it->second)%MOD)%MOD;\n\t}\n\ts[x].clear();\n}\n\nsigned main(){\n\tint n,m,q; read(n,q);\n\tint FUCK=1000000;\n\tfor(int i=1;i<=n;i++) fa[i]=i;\n\tfor(int i=1;i<=n;i++){\n\t\tread(m);\n\t\tfor(int x,j=1;j<=m;j++){\n\t\t\tread(x);\n\t\t\tif(!vis[x]) vis[x]=FUCK--;\n\t\t\tset<pii>::iterator it=s[i].lower_bound(make_pair(x,0));\n\t\t\tint cnt;\n\t\t\tif(it==s[i].end() || (it->first)!=x) cnt=0;\n\t\t\telse cnt=it->second,s[i].erase(it);\n\t\t\ts[i].insert(make_pair(x,cnt+1));\n\t\t}\n\t\tfor(set<pii>::iterator it=s[i].begin();it!=s[i].end();it++){\n\t\t\tval1[i]=(1ll*val1[i]*114514%mod+1ll*vis[it->first]*(it->second)%mod)%mod;\n\t\t\tval2[i]=(1ll*val2[i]*1919810%MOD+1ll*vis[it->first]*(it->second)%MOD)%MOD;\n\t\t}\n\t}\n\t\n\tint ans=0;\n\tfor(int t=1;t<=q;t++){\n\t\tint op,l,r; read(op,l,r);\n\t\tif(op==1) merge(l,r);\n\t\telse if(val1[l]==val1[r] && val2[l]==val2[r]) ans^=t;\n\t}\n\twrt(ans);\n\treturn flush(),0;\n}\n```",
        "postTime": 1681719562,
        "uid": 195198,
        "name": "E1_de5truct0r",
        "ccfLevel": 7,
        "title": "P9216 \u9898\u89e3"
    },
    {
        "content": "\u4e0d\u9700\u8981\u542f\u53d1\u5f0f\u5408\u5e76\uff0c\u76f4\u63a5\u7ed9\u6bcf\u4e2a\u6570\u503c\u968f\u673a\u4e00\u4e2a\u6743\u503c\uff0c\u4e00\u4efd\u6587\u732e\u7684\u6743\u503c\u5c31\u662f\u6570\u5217\u4e2d\u6bcf\u4e2a\u6570\u503c\u7684\u6743\u503c\u4e4b\u548c\u3002\n\n\u5bf9\u4e8e\u64cd\u4f5c\u4e00\uff0c\u76f4\u63a5\u5c06 $x$ \u7684\u6743\u503c\u52a0\u5230 $y$ \u7684\u6743\u503c\u4e0a\u3002\n\n\u5bf9\u4e8e\u64cd\u4f5c\u4e8c\uff0c\u5982\u679c $x$ \u7684\u6743\u503c\u548c $y$ \u7684\u6743\u503c\u4e00\u6837\u6211\u4eec\u5c31\u8ba4\u4e3a\u4ed6\u4eec\u76f8\u4f3c\uff0c\u5426\u5219\u4e0d\u76f8\u4f3c\u3002\n\n\u8fd9\u79cd\u601d\u60f3\u4ee5\u53ca\u9519\u8bef\u6982\u7387\u5206\u6790\u53ef\u4ee5\u89c1 [P8819 [CSP-S 2022] \u661f\u6218](https://www.luogu.com.cn/problem/P8819)\u3002\n\n\u4ee3\u7801\uff1a\n\n```\n#include<bits/stdc++.h>\n#define ull unsigned long long\nusing namespace std;\nmt19937 rnd(time(0));\nconst int N = 5e5 + 6;\nint n, q, ans;\null v[N];\nmap<int, ull> id;\nsigned main() {\n\tscanf(\"%d%d\", &n, &q);\n\tfor (int i = 1; i <= n ; i++) {\n\t\tint m; scanf(\"%d\", &m);\n\t\tfor (int j = 1; j <= m; j++) {\n\t\t\tint x; scanf(\"%d\", &x);\n\t\t\tif (!id[x]) id[x] = rnd() + 1;\n\t\t\tv[i] += id[x];\n\t\t}\n\t}\n\tfor (int i = 1; i <= q; i++) {\n\t\tint op, x, y; scanf(\"%d%d%d\", &op, &x, &y);\n\t\tif (op == 1) {\n\t\t\tv[y] += v[x];\n\t\t} else {\n\t\t\tif (v[x] == v[y]) ans ^= i;\n\t\t}\n\t}\n\tprintf(\"%d\", ans);\n}\n```",
        "postTime": 1681616633,
        "uid": 366456,
        "name": "lyc_qwq",
        "ccfLevel": 0,
        "title": "P9216 [\u5165\u95e8\u8d5b #11] \u5199\u5927\u4f5c\u4e1a (Hard Version)"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P9216)\n\n\u54c8\u5e0c\u3002\n\n\u8bfb\u5165\u65f6\u7ed9\u6bcf\u4e2a\u6570\u5206\u914d\u4e00\u4e2a\u968f\u673a\u6743\u503c\uff0c\u76f8\u540c\u7684\u6570\u6743\u503c\u4e0d\u53d8\u3002\n\n\u6bcf\u4e2a\u6570\u5217\u7edf\u8ba1\u4e00\u4e2a\u6743\u503c\u548c\u3002\u62fc\u63a5\u64cd\u4f5c\u5c31\u662f\u6743\u503c\u548c\u76f8\u52a0\uff0c\u6743\u503c\u548c\u76f8\u7b49\u65f6\u6211\u4eec\u6709\u6781\u5927\u7684\u628a\u63e1\u79f0\u8fd9\u4e24\u4e2a\u6570\u5217\u76f8\u4f3c\u3002\u5982\u679c WA \u4e86\u53ea\u80fd\u8bf4\u4f60 rp \u4f4e\u5230\u6ca1\u8fb9\u3002\n\n\u7136\u800c\u968f\u673a\u6743\u503c\u6211\u53ea\u4f1a\u7528 `rand`\uff0c\u4f46\u662f\u8fd9\u4e2a\u6570\u636e\u8303\u56f4\u76f4\u63a5\u7528 `rand()` \u51fd\u6570\u662f\u5f88\u96be\u8dd1\u8fc7\u53bb\u7684\uff08\u56e0\u4e3a\u8be5\u51fd\u6570\u53d6\u503c\u533a\u95f4\u53f3\u8fb9\u754c\u4e3a $32767$\uff09\uff0c\u5efa\u8bae\u4f7f\u7528 `rand()*rand()`\uff0c\u6b63\u597d\u5728 `int` \u8303\u56f4\u5185\u3002\n\nCode:\n\n```cpp\n#include<bits/stdc++.h>\n#define inf 2000000000\nusing namespace std;\nconst int N=1e5+10;\nint a[N],n,q,res;\nmap<int,int>val;\nsigned main(){\n\t//freopen(\".in\",\"r\",stdin);\n\t//freopen(\".out\",\"w\",stdout);\n\tscanf(\"%d%d\",&n,&q);\n\tfor(int i=1;i<=n;i++){\n\t\tint m;scanf(\"%d\",&m);\n\t\tfor(int j=1,x;j<=m;j++){\n\t\t\tscanf(\"%d\",&x);\n\t\t\tif(!val[x])val[x]=rand()*rand();\n\t\t\ta[i]+=val[x];\n\t\t}\n\t}\n\tfor(int i=1,op,x,y;i<=q;i++){\n\t\tscanf(\"%d%d%d\",&op,&x,&y);\n\t\tif(op==1)a[y]+=a[x];\n\t\telse if(op==2&&a[x]==a[y])res^=i;\n\t}\n\tprintf(\"%d\\n\",res);\n    return 0;\n}\n```\n\n[record](https://www.luogu.com.cn/record/108170899)",
        "postTime": 1681550855,
        "uid": 736801,
        "name": "ACRUSHj",
        "ccfLevel": 0,
        "title": "P9216 \u5199\u5927\u4f5c\u4e1a"
    },
    {
        "content": "# \u7b80\u8981\u9898\u610f\n\n\u8fd9\u9053\u9898\u6211\u4eec\u6839\u636e\u9898\u610f\uff0c\u5f97\u51fa\uff1a\n\n\u5b9a\u4e49\u4e00\u4e2a\u53eb\u505a\u6587\u732e\u7684\u4e1c\u897f\uff0c\u91cc\u9762\u5b58\u50a8\u4e86\u4e00\u4e9b\u53ef\u4ee5\u91cd\u590d\u7684\u6570\u5b57\u3002\n\n\u53ea\u8981\u4e24\u4e2a\u6587\u732e\u5305\u542b\u7684\u6570\u5b57\u4e00\u6837\uff0c\u90a3\u4e48\u5c31\u8ba4\u4e3a\u4e24\u4e2a\u6587\u732e\u662f\u76f8\u4f3c\u7684\u3002\n\n\u6211\u4eec\u9700\u8981\u8003\u8651\u5b9e\u73b0\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u6765\u7ef4\u62a4\u4e24\u79cd\u64cd\u4f5c\uff1a\n\n- \u5408\u5e76\u4e24\u4e2a\u6587\u732e\u3002\n- \u5224\u65ad\u4e24\u4e2a\u6587\u732e\u662f\u5426\u76f8\u4f3c\u3002\n\n# \u601d\u8def\u89e3\u6790\n\n\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u54c8\u5e0c\uff0c\u8fd9\u662f\u4e00\u4e2a\u53ef\u4ee5\u7528\u4e00\u4e2a\u6216\u51e0\u4e2a\u6570\u5b57\u6765\u63cf\u8ff0\u5f88\u591a\u4fe1\u606f\u7684\u4e1c\u897f\u3002\n\n\u6211\u4eec\u901a\u5e38\u4f7f\u7528\u54c8\u5e0c\u6765\u5224\u65ad\u4e24\u4e2a\u5305\u542b\u8bb8\u591a\u4fe1\u606f\u7684\u4e8b\u7269\u662f\u5426\u76f8\u7b49\u3002\n\n\u5bf9\u4e8e\u8fd9\u9053\u9898\u76ee\uff0c\u6211\u4eec\u8003\u8651\u8fd9\u6837\u63cf\u8ff0\u4e00\u4e2a\u6587\u732e\uff1a\n\n- \u6587\u732e\u6709\u4e00\u4e2a\u6570\u5b57 $x$\uff0c\u90a3\u4e48\u5728\u8868\u793a\u6587\u732e\u7684\u6743\u503c\u4e2d\u52a0\u4e0a\u4e00\u4e2a $2^x$\u3002\n- \u6587\u732e\u6709\u4e00\u4e2a\u6570\u5b57 $x$\uff0c\u90a3\u4e48\u5728\u8868\u793a\u6587\u732e\u7684\u53e6\u5916\u4e00\u4e2a\u6743\u503c\u4e2d\u52a0\u4e0a\u4e00\u4e2a $3^x$\u3002\n- \u4fdd\u5b58\u6587\u732e\u4e2d\u6570\u5b57\u7684\u6570\u91cf\u3002\n\n\u4e3a\u4ec0\u4e48\u8981\u591a\u770b\u51e0\u4e2a\u4fe1\u606f\u5462\uff1f\u5bf9\u4e8e\u5355\u4e2a\u4fe1\u606f\uff0c\u53ef\u80fd\u4e24\u4e2a\u4e0d\u540c\u7684\u4e1c\u897f\u7684\u6743\u503c\u76f8\u7b49\uff0c\u4f46\u662f\u6709\u591a\u4e2a\u6743\u503c\u5224\u65ad\u7684\u8bdd\uff0c\u51fa\u73b0\u6743\u503c\u76f8\u7b49\u7684\u6982\u7387\u5c31\u4f1a\u53d8\u5c0f\u3002\n\n\u6211\u4eec\u628a\u6587\u732e\u8f6c\u6362\u6210\u8fd9\u4e9b\u6570\u636e\uff0c\u63a5\u4e0b\u6765\u7ef4\u62a4\u5408\u5e76\u548c\u5224\u65ad\u662f\u5426\u76f8\u7b49\u4e5f\u5c31\u5341\u5206\u7b80\u5355\u4e86\u3002\n\n\u5bf9\u4e8e\u5408\u5e76\uff0c\u6570\u636e\u76f4\u63a5\u76f8\u52a0\u5373\u53ef\u3002\n\n# \u4ee3\u7801\u5b9e\u73b0\n\n```cpp\n#include<bits/stdc++.h>\n#define LL long long\nusing namespace std;\nconst LL N=1e6;\nconst LL mod=1e9+7;\nLL n,q,a[N],b[N],sz[N],m,op,x,y,ans;\nLL ksm(LL x,LL y)//\u7528\u6765\u8ba1\u7b97x\u7684y\u6b21\u65b9\uff0c\u6211\u7684\u5b9e\u73b0\u53eb\u505a\u5feb\u901f\u5e42\n{\n\tLL ans=1;\n\twhile(y)\n\t{\n\t\tif(y&1)ans=(ans*x)%mod;\n\t\tx=(x*x)%mod;\n\t\ty>>=1;\n\t}\n\treturn ans; \n}\nint main()\n{\n\tscanf(\"%lld%lld\",&n,&q);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%lld\",&m);\n\t\tsz[i]=m;//sz\u8868\u793a\u5305\u542b\u7684\u6570\u5b57\u7684\u6570\u91cf\n\t\tfor(int j=1;j<=m;j++)\n\t\t{\n\t\t\tscanf(\"%lld\",&x);\n\t\t\ta[i]=(a[i]+ksm(2,x))%mod;//\u7b2c\u4e00\u4e2a\u54c8\u5e0c\u6743\u503c\n\t\t\tb[i]=(b[i]+ksm(3,x))%mod;//\u7b2c\u4e8c\u4e2a\u54c8\u5e0c\u6743\u503c\n\t\t}\n\t}\n\tfor(int i=1;i<=q;i++)\n\t{\n\t\tscanf(\"%lld%lld%lld\",&op,&x,&y);\n\t\tif(op==1)\n\t\t{\n\t\t\ta[y]+=a[x],b[y]+=b[x],sz[y]+=sz[x];//\u5408\u5e76\u64cd\u4f5c\uff0c\u76f8\u52a0\u5373\u53ef\n\t\t\ta[x]=0,b[x]=0,sz[x]=0;//\u5220\u9664\u6587\u732e\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(sz[x]==sz[y]&&a[x]==a[y]&&b[x]==b[y])ans^=i;//\u5224\u65ad\uff0c\u76f8\u7b49\u7b97\u4e0a\u8d21\u732e\n\t\t}\n\t}\n\tprintf(\"%lld\",ans);\n}\n```",
        "postTime": 1681536761,
        "uid": 501947,
        "name": "DengDuck",
        "ccfLevel": 6,
        "title": "P9216 [\u5165\u95e8\u8d5b #11] \u5199\u5927\u4f5c\u4e1a (Hard Version) \u9898\u89e3"
    },
    {
        "content": "\u611f\u89c9\u8fd9\u4e2a\u9898\u601d\u8def\u8fd8\u662f\u633a\u663e\u7136\u7684\uff08\uff1f\n\n\u8003\u8651\u8f6c\u5316\u201c\u76f8\u4f3c\u201d\u7684\u6761\u4ef6\uff1a\u8bbe $S_{i,j}$ \u8868\u793a\u7b2c $i$ \u4e2a\u6570\u5217\u4e2d $j$ \u8fd9\u4e2a\u6570\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u5219 $x,y$ \u76f8\u4f3c\u5f53\u4e14\u4ec5\u5f53\uff1a$\\forall i \\in [0,+\\infty),S_{x,i}=S_{y,i}$\u3002\n\n\u8fd9\u4e2a\u4e1c\u897f\u770b\u8d77\u6765\u5c31\u5f88\u96be\u7ef4\u62a4\uff0c\u800c\u8fd9\u4e2a\u95ee\u9898\u53c8\u662f\u5224\u65ad\u662f\u5426\u540c\u4e00\uff0c\u6216\u8005\u8bf4\u662f\u5426\u201c\u540c\u6784\u201d\uff0c\u4e0d\u96be\u60f3\u5230\u7528\u54c8\u5e0c\u7ef4\u62a4\u3002\n\n\u90a3\u4e48\u6211\u4eec\u8003\u8651\u9009\u4ec0\u4e48\u54c8\u5e0c\uff1a\u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\u800c\u8a00\uff0c\u7531\u4e8e\u987a\u5e8f\u4e0d\u91cd\u8981\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u5f02\u6216\u54c8\u5e0c\u6216\u8005\u548c\u54c8\u5e0c\u3002\u56e0\u4e3a\u5f02\u6216\u4e24\u6b21\u53d8\u6210 $0$\uff0c\u6240\u4ee5\u6211\u4eec\u4f7f\u7528\u548c\u54c8\u5e0c\u3002\u5177\u4f53\u800c\u8a00\uff0c\u7ed9\u6bcf\u4e2a\u51fa\u73b0\u7684\u6570\u968f\u673a\u8d4b\u4e00\u4e2a\u6743\u503c\uff0c\u8bbe $T_x$ \u8868\u793a\u6570\u5217 $x$ \u4e2d\u6240\u6709\u6570\u6240\u5bf9\u5e94\u7684\u6743\u503c\u7684\u548c\uff0c\u5219\u6211\u4eec\u53ef\u4ee5\u7528 $T_x=T_y$ \u6765\u5224\u5b9a $x$ \u548c $y$ \u76f8\u4f3c\u3002\u5bf9\u4e8e\u64cd\u4f5c\u4e00\uff0c\u53ea\u9700\u5c06 $T_y \\gets T_y + T_x$ \u5c31\u884c\u4e86\u3002\n\n### Code\uff1a\n\n```c++\n#include <bits/stdc++.h>\nusing namespace std;\n#define int long long\nint n, q, op, x, y, ans, len, b[100010];\nmap <int, int> mp;\nconst int mo = 1e12;\nsigned main(){\n\tmt19937 rand(time(0));\n\tscanf (\"%lld%lld\", &n, &q);\n\tfor (int i=1; i<=n; i++){\n\t\tscanf (\"%lld\", &len);\n\t\tfor (int j=1; j<=len; j++){\n\t\t\tscanf (\"%lld\", &x);\n\t\t\tif (mp.find(x) == mp.end()) mp[x] = rand() % mo + 1;\n\t\t\tb[i] += mp[x];\n \t\t}\n\t}\n\tfor (int i=1; i<=q; i++){\n\t\tscanf (\"%lld%lld%lld\", &op, &x, &y);\n\t\tif (op == 1) b[y] += b[x];\n\t\telse if (b[x] == b[y]) ans ^= i;\n\t}\n\tprintf (\"%lld\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1681527995,
        "uid": 399286,
        "name": "\u82cf\u8054\u5c0f\u6e23",
        "ccfLevel": 0,
        "title": "[\u9898\u89e3] P9216 [\u5165\u95e8\u8d5b #11] \u5199\u5927\u4f5c\u4e1a (Hard Version)"
    },
    {
        "content": "## 1 description\n\n\u521d\u59cb\u7ed9\u5b9a $n$ \u4e2a\u5e8f\u5217\uff0c\u7b2c $i$ \u4e2a\u5e8f\u5217\u957f\u5ea6\u4e3a $m_i$\u3002\n\n\u6709 $q$ \u6b21\u8be2\u95ee\uff0c\u8981\u6c42\u652f\u6301\u4e24\u4e2a\u64cd\u4f5c\uff1a\n\n- \u5c06\u5e8f\u5217 $x$ \u5408\u5e76\u5230 \u5e8f\u5217 $y$ \u4e0a\n\n- \u8be2\u95ee\u662f\u5426\u53ef\u4ee5\u901a\u8fc7\u5c06 $x$ \u91cd\u6392\u5f97\u5230 $y$\n\n## 2 solution\n\u6ce8\u610f\u5230 $q\\leq 5\\times 10^6$\uff0c\u6240\u4ee5\u6211\u4eec\u7684\u5355\u6b21\u64cd\u4f5c\u9700\u8981\u505a\u5230 $O(1)$\u3002\n\n\u8003\u8651\u54c8\u5e0c\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u521d\u59cb\u5e8f\u5217\uff0c\u6211\u4eec\u7ef4\u62a4\u5b83\u7684\u6bcf\u4e2a\u6570\u7684\u5e73\u65b9\u548c\uff0c\u7acb\u65b9\u548c\uff0c\u5f02\u6216\u548c\uff0c\u5e76\u4ee5\u591a\u79cd\u6a21\u6570\u540c\u65f6\u53d6\u6a21\u3002\n\n\u5bf9\u4e8e\u64cd\u4f5c 1\uff0c\u5c06 $x$ \u7684\u54c8\u5e0c\u503c\u52a0\u5230 $y$ \u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u64cd\u4f5c 2\uff0c\u770b\u5728\u6bcf\u4e2a\u6a21\u6570\u7684\u610f\u4e49\u4e0b\u54c8\u5e0c\u503c\u662f\u5426\u76f8\u7b49\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\sum m+q)$\u3002\n\n\u6ce8\u610f\u6bcf\u4e2a\u503c\u53ef\u80fd\u4e3a $0$\uff0c\u4e3a\u4e86\u907f\u514d\u88ab\u4e0d\u540c\u957f\u5ea6\u7684\u5168 $0$ \u5e8f\u5217\u5361\u6389\uff0c\u53ef\u4ee5\u5c06\u6bcf\u4e2a\u6570\u7684\u521d\u59cb\u6743\u52a0 $1$\u3002\n\n## 3 code\n\n```\n//Man always remember love because of romance only!\n#include<bits/stdc++.h>\nusing namespace std;\n#define int long long\nint mod[4]={469762049,1004535809,1000000000+7,998244353}; //4\u4e2a\u5927\u6a21\u6570\ninline int read(){\n    int X=0,w=0; char ch=0;\n    while(!isdigit(ch)) {w|=ch=='-';ch=getchar();}\n    while(isdigit(ch)) X=(X<<3)+(X<<1)+(ch^48),ch=getchar();\n    return w?-X:X;\n}\ninline void write(int x){\n\tif(x<0) putchar('-'),x=-x;\n    if(x>9) write(x/10);\n    putchar(x%10+'0');\n}\nint hs[100001][3][4];\nsigned main(){\n\tint n=read(),q=read();\n\tfor(int i=1;i<=n;i++){\n\t\tint k=read();\n\t\tfor(int j=1;j<=k;j++){\n\t\t\tint x=read()+1;//\u5982\u679c\u4e0d\u52a01\u53ef\u80fd\u4f1a\u88ab\u4e0d\u540c\u957f\u5ea6\u7684\u51680\u5e8f\u5217\u5361\u6389\n\t\t\tfor(int l=0;l<4;l++){\n\t\t\t\ths[i][0][l]=(hs[i][0][l]+x*x%mod[l])%mod[l];//\u5e73\u65b9\u548c\n\t\t\t\ths[i][1][l]=(hs[i][1][l]+x%mod[l]*x%mod[l]*x%mod[l])%mod[l];//\u7acb\u65b9\u548c\n\t\t\t\ths[i][2][l]=(hs[i][2][l]^x)%mod[l];//\u5f02\u6216\u548c\n\t\t\t}\n\t\t}\n\t}\n\tint ans=0;\n\tfor(int i=1;i<=q;i++){\n\t\tint opt=read();\n\t\tif(opt==1){\n\t\t\tint x=read(),y=read();\n\t\t\tfor(int j=0;j<2;j++){\n\t\t\t\tfor(int k=0;k<4;k++) hs[y][j][k]=(hs[y][j][k]+hs[x][j][k])%mod[k];\n\t\t\t}\n\t\t\tfor(int k=0;k<4;k++) hs[y][2][k]=(hs[y][2][k]^hs[x][2][k]);\n\t\t}else{\n\t\t\tint x=read(),y=read();\n\t\t\tbool flag=1;\n\t\t\tfor(int j=0;j<3;j++){\n\t\t\t\tfor(int k=0;k<4;k++){\n\t\t\t\t\tif(hs[x][j][k]!=hs[y][j][k]) flag=0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(flag) ans^=i;\n\t\t}\n\t}\n\twrite(ans);\n\treturn 0;\n}\n\n```\n",
        "postTime": 1681518187,
        "uid": 343251,
        "name": "heaksicn",
        "ccfLevel": 5,
        "title": "P9216 [\u5165\u95e8\u8d5b #11] \u5199\u5927\u4f5c\u4e1a (Hard Version)"
    }
]