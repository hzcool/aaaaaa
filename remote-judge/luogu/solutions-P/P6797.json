[
    {
        "content": "\u548cstd\u4e0d\u540c\u3002\u526a\u679d\u540e\u7684\u5206\u5c42\u56fe\u6700\u77ed\u8def\u3002\n\n## \u601d\u8def\n\n\u70b9 $(o,i,j)$ \u8868\u793a\u5df2\u7ecf\u62ff\u4e86 $o$ \u4e2a\u4eba\uff0c\u73b0\u5728\u6211\u4f4d\u7f6e\u5728 $(i,j)$\uff0c\u8fd8\u6ca1\u8ba1\u7b97 $(i,j)$ \u4f4d\u7f6e\u7684\u5371\u9669\u503c\uff0c\u5df2\u7ecf\u8d70\u8fc7\u7684\u8def\u4e0a\u7684\u5371\u9669\u503c\u4e4b\u548c\u3002\n\n\u9171\u7d2b\u8f6c\u79fb\uff1a\n\n- \u4e0d\u5403 $d_{ij}$\uff0c\u627e\u4e00\u4e2a\u5305\u542b $(i,j)$ \u7684\u77e9\u5f62 $[ax,bx,ay,by]$\uff0c\u5373\u6ee1\u8db3 $ax\\leq i\\leq bx,ay\\leq j\\leq by$\uff0c\u7136\u540e\u8f6c\u79fb\u5230 $(bx+1,k) | j\\leq k\\leq by$ \u548c $(k,by+1) | i\\leq k\\leq bx$\u3002\n- \u5403\u4e86 $d_{ij}$\uff0c\u8f6c\u79fb\u5230 $(i+1,j)$ \u548c $(i,j+1)$\u3002\n\n## \u526a\u679d\n\n\u5148\u6765\u4e00\u4e2a\u5361\u5e38\u5c0f\u73a9\u610f\uff1a\u6309 $o$ \u4ece\u5c0f\u5230\u5927\u8fdb\u884c\u8f6c\u79fb\uff0c\u5f53\u524d $o$ \u7ef4\u62a4\u5806\uff0c$o+1$ \u7ef4\u62a4\u4e00\u4e2a `vector`\uff0c`++o` \u65f6\u518d\u7528 `vector` \u6784\u5efa\u5806\u3002\n\n\u6700\u5173\u952e\u7684\u526a\u679d\u6765\u55bd\uff1a\n\n\u6839\u636e dij \u7684\u7279\u6b8a\u6027\u8d28\uff0c\u540c\u4e00\u4e2a $o$ \u7684\u5371\u9669\u503c\u662f\u4e0d\u964d\u7684\u3002\u800c\u901a\u8fc7\u77e9\u5f62\u8f6c\u79fb\u7684\u65f6\u5019\u4e0d\u5403 $d$\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728 $o$ \u4f18\u7684\u5230 $o+1$ \u4e5f\u4f18\u3002\u8fd9\u662f\u526a\u679d\u53ef\u884c\u7684\u524d\u63d0\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u4e2a\u77e9\u5f62\uff0c\u8bb0\u5f55\u4e00\u4e0b\u5df2\u7ecf\u66f4\u65b0\u8fc7\u7684 $(bx+1,k)$ \u548c $(k,by+1)$\uff0c\u540e\u9762\u9047\u5230\u66f4\u52a3\u7684\u65f6\u5019\u5c31\u4e0d\u66f4\u65b0\u4e86\u3002\u6211\u7684\u505a\u6cd5\u662f\u8bb0\u4e86\u4e24\u4e2a $k$ \u66f4\u65b0\u5230\u7684\u6700\u5c0f\u4f4d\u7f6e\u503c\u3002\n\n## \u590d\u6742\u5ea6\u5206\u6790\n\n\u6709 $nm(w+1)$ \u4e2a\u70b9\u3002\n\n\u6709\u81f3\u591a $(n+m)k(w+1)$ \u6761\u8fb9\u3002\n\n\u7b97\u4e0a\u5806\uff0c\u590d\u6742\u5ea6 $\\mathcal O(nmw+(n+m)kw\\log(n+m)k)$\u3002\n\n## code\n\n```cpp\n#include<stdio.h>\n#include<queue>\n#include<string.h>\n#define N 201\n#define M 101\nusing namespace std;\ninline char nc()\n{\n\tstatic char buf[99999],*l,*r;\n\treturn l==r&&(r=(l=buf)+fread(buf,1,99999,stdin),l==r)?EOF:*l++;\n}\ninline void read(int&x)\n{\n\tchar c=nc();for(;c<'0'||'9'<c;c=nc());\n\tfor(x=0;'0'<=c&&c<='9';x=(x<<3)+(x<<1)+(c^48),c=nc());\n}\nstruct node\n{\n\tint i,j;long long ans;\n\tinline node(){}\n\tinline node(const int&a,const int&b,const long long&c)\n\t\t{i=a;j=b;ans=c;}\n\tinline bool operator<(const node&kkk)const{return ans>kkk.ans;}\n};\nint n,m,p,w,ax[N],bx[N],ay[N],by[N],ux[M][N],uy[M][N],a[N][N];\npriority_queue<node>q;vector<node>qwq[M];\nlong long minn=1ll<<60,ans[M][N][N];\nmain()\n{\n\tread(n);read(m);read(p);read(w);if(w>p)w=p;\n\tfor(int i=0;i<n;++i)for(int j=0;j<m;read(a[i][j++]));\n\tfor(int i=0;i<p;++i)\n\t{\n\t\tread(ax[i]);read(bx[i]);read(ay[i]);read(by[i]);\n\t\t--ax[i];--bx[i];--ay[i];--by[i];\n\t\tfor(int j=0;j<=w;++j)ux[j][i]=bx[i],uy[j][i]=by[i];\n\t}\n\tmemset(ans,0x3f,sizeof(ans));\n\tans[0][0][0]=0;qwq[0].emplace_back(0,0,0);\n\tfor(int o=0;o<=w;++o)\n\t{\n\t\tq=priority_queue<node>(qwq[o].begin(),qwq[o].end());\n\t\tfor(node i;q.size();)\n\t\t{\n\t\t\ti=q.top();q.pop();\n\t\t\tif(minn<=i.ans)break;\n\t\t\tif(i.i+i.j>=n+m-1){minn=i.ans;break;}\n\t\t\tif(i.i==n||i.j==m)continue;\n\t\t\tif(o<w)for(int j=0;j<p;++j)if(ax[j]<=i.i&&i.i<=bx[j])\n\t\t\t\tif(ay[j]<=i.j&&i.j<=by[j])\n\t\t\t{\n\t\t\t\tfor(int k=i.i;k<=ux[o][j];++k)\n\t\t\t\t\tif(ans[o+1][k][by[j]+1]>i.ans)\n\t\t\t\t\t\tqwq[o+1].emplace_back(k,by[j]+1,\n\t\t\t\t\t\t\tans[o+1][k][by[j]+1]=i.ans);\n\t\t\t\tif(i.i<=ux[o][j])ux[o][j]=i.i-1;\n\t\t\t\tfor(int k=i.j;k<=uy[o][j];++k)\n\t\t\t\t\tif(ans[o+1][bx[j]+1][k]>i.ans)\n\t\t\t\t\t\tqwq[o+1].emplace_back(bx[j]+1,k,\n\t\t\t\t\t\t\tans[o+1][bx[j]+1][k]=i.ans);\n\t\t\t\tif(i.j<=uy[o][j])uy[o][j]=i.j-1;\n\t\t\t}\n\t\t\ti.ans+=a[i.i][i.j];\n\t\t\tif(ans[o][i.i+1][i.j]>i.ans)\n\t\t\t\tq.emplace(i.i+1,i.j,ans[o][i.i+1][i.j]=i.ans);\n\t\t\tif(ans[o][i.i][i.j+1]>i.ans)\n\t\t\t\tq.emplace(i.i,i.j+1,ans[o][i.i][i.j+1]=i.ans);\n\t\t}\n\t}\n\tprintf(\"%lld\",minn);\n}\n```\n",
        "postTime": 1667732567,
        "uid": 90693,
        "name": "_\u2022\u0301\u3078\u2022\u0301\u256c_",
        "ccfLevel": 7,
        "title": "P6797 \u300cStOI-2\u300d\u4e0d\u673d\u7684\u9003\u4ea1\u8005"
    },
    {
        "content": "## \u5b98\u65b9\u9898\u89e3\n\n\n\u6570\u636e\u7ed3\u6784\u4f18\u5316dp\u3002\n\n\u4e2a\u4eba\u611f\u89c9\u4e0d\u96be\u3002\n\n\u8bbe $dp\u503c$ ( $f_{i,j,k}$ ) \u4e3a\u7b2c $i$ \u884c\u7b2c $j$ \u5217\uff0c\u7528\u4e86 $k$ \u4e2a\u77e9\u9635\u80fd\u8d70\u5230 $(n,m)$ \u6700\u5c0f\u7684\u548c\u3002\n\n\u6613\u5f97\uff1a\u5728\u4e00\u4e2a\u77e9\u9635\uff08\u4e0b\u56fe\u9ed1\u8272\u77e9\u9635\uff09\u4e2d\u7684\u4e00\u4e2a\u683c\u5b50\uff08\u4e0b\u56fe\u4e09\u89d2\u683c\u5b50\uff09\uff0c\u53ef\u4ee5\u8d70\u5230\u4e0e\u8be5\u77e9\u9635\u76f8\u90bb\u7684\u683c\u5b50\u4e2d\u6a2a\u5750\u6807\u4e0e\u7eb5\u5750\u6807\u90fd\u4e0d\u5c0f\u4e8e\u8be5\u683c\u5b50\u7684\u683c\u5b50\uff08\u7528\u5706\u5708\u683c\u5b50\u8868\u793a\uff09\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/cs55ez6u.png)\n\n\u5728\u4ece $(n,m)$ \u6bcf\u4e00\u884c\u4e2d\u6bcf\u4e00\u5217\uff0c\u7528\u4e86 $k$ \u4e2a\u77e9\u9635\u7684\u679a\u4e3edp\u4e2d\uff1a\n\n\u5bf9\u4e8e\u7528\u4e86 $0$ ~ $K$ \u4e2a\u77e9\u9635\uff0c\u6bcf\u884c\u6bcf\u5217\u5206\u522b\u5efa1\u4e2a\u4f18\u5148\u961f\u5217\uff0c\u8bb0 $dp\u503c$ \u4e0e\u6700\u8fdc\u77e9\u9635\u5f71\u54cd\u8303\u56f4\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u77e9\u9635\uff0c\u5efa\u4e24\u4e2a $minn$ \u6570\u7ec4\uff0c\u5206\u522b\u8bb0\u5f53\u524d\u5728\u77e9\u9635\u4e0b\u4fa7\u7684\u201c\u5706\u5708\u683c\u5b50\u201d\uff0c\u4e0e\u53f3\u4fa7\u7684\u201c\u5706\u5708\u683c\u5b50\u201d\u7684 $dp\u503c$ \u4e2d\u6700\u5c0f\u8005\uff0c\u5c06\u8fd9\u4e2a\u503c\u5728 $dp$ \u8fc7\u7a0b\u4e2d\u5206\u522b\u5728\u77e9\u9635\u4e0b\u4fa7\u65f6\u63d2\u5165\u8be5\u5217\u7684\u4f18\u5148\u961f\u5217\u4e0e\u53f3\u4fa7\u65f6\u63d2\u5165\u8be5\u884c\u7684\u4f18\u5148\u961f\u5217\uff0c\u6700\u8fdc\u5f71\u54cd\u8303\u56f4\u5373\u77e9\u9635\u4e0a\uff0c\u5de6\u8fb9\u754c(\u5982\u679c\u8d85\u51fa\u8fd9\u4e2a\u8fb9\u754c\u5c31 $pop$ \u6389)\uff0c\u7528\u6765\u8868\u793a\u7528\u4e86\u5f53\u524d\u8fd9\u4e2a\u77e9\u9635\u3002\n\n\u6bd4\u5982\u4e0a\u56fe\u77e9\u9635\u4e0b\u7aef\u7b2c\u4e00\u4e2a\u5706\u5f62\u683c\u5b50\uff0c\u5b83\u53ef\u4ee5\u5f71\u54cd\u5230\u6b64\u683c\u5b50\u4e4b\u4e0a\uff0c\u4e09\u89d2\u683c\u4e0a\u65b9\u683c\u5b50\u4e4b\u4e0b\u8be5\u5217\u7684\u6240\u6709\u683c\u5b50\uff0c\u8fd9\u4e2a\u8303\u56f4\u7684\u7528\u4e86 $k+1$ \u4e2a\u77e9\u9635\u7684 $dp\u503c$ \u5bf9\u8fd9\u4e2a\u683c\u5b50\u7528\u4e86 $k$ \u4e2a\u77e9\u9635\u7684 $dp\u503c$ \u53d6 $min$ \u3002\n\n\u8f6c\u79fb\u65b9\u7a0b\uff1a\n```\nf[i][j][k]=a[i][j]+mn(f[i+1][j][k],f[i][j+1][k]);\nf[i][j][k]=mn(f[i][j][k],mn(qx[i][k-1].top(),qy[j][k-1].top()));\n\n//f[i][j][k]:dp\u503c\n//qx[i][k]:\u7b2ci\u884c\u5df2\u7528\u4e86k\u4e2a\u77e9\u9635\u7684\u4f18\u5148\u961f\u5217\uff0cqy\u540c\u7406\n```\n\n\u7136\u540e\u5c31\u662f~~\u6bd4\u8f83\u7b80\u5355\u7684~~\u5b9e\u73b0\uff08\u8dd1\u4e0d\u6ee1 $O(n^3*log_2n)$\uff08\u8ba4\u4e3a $n,m,k$ \u540c\u9636\uff09\uff0c\u53ef\u80fd\u8981\u8f7b\u5fae\u5361\u5e38\uff09\uff1a\n\n```cpp\n#include <cstdio>\n#include <queue>\n#include <cstring>\n#include <vector>\nusing namespace std; \ntypedef long long ll;\nconst int N=205,W=105,K=205;\nconst ll oo=1ll<<60;\nint n,m,w,kk,a[N][N],ax[K],ay[K],bx[K],by[K];\nll f[N][N][W],minn[K][W][3];\nvector<ll> v1[N][N],v2[N][N];\nstruct node {\n\tint x;\n\tll s;\n\tbool operator <(const node &w) const {\n\t\tif(s==w.s) return x<w.x;\n\t\telse return s>w.s;\n\t}\n};\npriority_queue<node> qy[N][W],qx[N][W];\ninline int read() {\n\tint x=0,flag=0;char ch=getchar();\n\twhile(ch<'0'||ch>'9'){flag|=(ch=='-');ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=(x<<3)+(x<<1)+ch-'0';ch=getchar();}\n\treturn flag?-x:x;\n}\ninline ll mx(ll x,ll y) {return x>y?x:y;}\ninline ll mn(ll x,ll y) {return x<y?x:y;}\nint main() {\n//\tfreopen(\".in\",\"r\",stdin);\n//\tfreopen(\".out\",\"w\",stdout);\n\tn=read();m=read();kk=read();w=read();\n\tmemset(minn,127,sizeof minn);\n\tfor(int i=1;i<=n;++i)\n\t\tfor(int j=1;j<=m;++j) {\n\t\t\ta[i][j]=read();\n\t\t\t//for(int k=0;k<=w;++k)\n\t\t\t//\tf[i][j][k]=oo; \n\t\t}\n\tfor(int i=1;i<=kk;++i) {\n\t\tax[i]=read();bx[i]=read();ay[i]=read();by[i]=read();\n\t\tif(bx[i]==n&&by[i]==m) {\n\t\t\tfor(int j=ax[i];j<=bx[i];++j)\n\t\t\t\tfor(int k=0;k<=w;++k)\n\t\t\t\t\tqx[j][k].push((node){ay[i],0});\n\t\t\tfor(int j=ay[i];j<=by[i];++j)\n\t\t\t\tfor(int k=0;k<=w;++k)\n\t\t\t\t\tqy[j][k].push((node){ax[i],0});\n\t\t}\n\t\tfor(int j=ax[i];j<=bx[i];++j)\n\t\t\tv1[j][by[i]+1].push_back(i);\n\t\tfor(int j=ay[i];j<=by[i];++j)\n\t\t\tv2[bx[i]+1][j].push_back(i);\n\t}\n\tfor(int i=n;i>=1;--i) {\n\t\tfor(int j=m;j>=1;--j)\n\t\t\tfor(int k=w;k>=0;--k) {\n\t\t\t\tif(i<n) \n\t\t\t\t\tif(j<m) f[i][j][k]=a[i][j]+mn(f[i+1][j][k],f[i][j+1][k]);\n\t\t\t\t\telse f[i][j][k]=a[i][j]+f[i+1][j][k];\n\t\t\t\telse if(j<m) f[i][j][k]=a[i][j]+f[i][j+1][k];\n\t\t\t\telse f[i][j][k]=a[i][j];\n\t\t\t\twhile(!qy[j][k-1].empty()&&i<qy[j][k-1].top().x) qy[j][k-1].pop();\n\t\t\t\twhile(!qx[i][k-1].empty()&&j<qx[i][k-1].top().x) qx[i][k-1].pop();\n\t\t\t\tif(k) {\n\t\t\t\t\tif(!qy[j][k-1].empty()) f[i][j][k]=mn(f[i][j][k],qy[j][k-1].top().s);\n\t\t\t\t\tif(!qx[i][k-1].empty()) f[i][j][k]=mn(f[i][j][k],qx[i][k-1].top().s);\n\t\t\t\t}\n\t\t\t\tint len1=v1[i][j].size()-1;//\u6ce8\u610f\u4e00\u4e0b\u4e24\u4e2a\u5faa\u73af\u4e2d\u7684if\uff0c\u63d0\u524dpop\u51fa\u4e0d\u9700\u8981\u7684\u4f4d\u7f6e\u53ef\u4ee5\u5e2e\u52a9\u5361\u5e38\n\t\t\t\tfor(int s=0;s<=len1;++s) {\n\t\t\t\t\tminn[v1[i][j][s]][k][0]=mn(minn[v1[i][j][s]][k][0],f[i][j][k]);\n\t\t\t\t\tif(!qx[i][k].empty()&&ay[v1[i][j][s]]>=qx[i][k].top().x&&minn[v1[i][j][s]][k][0]>=qx[i][k].top().s) continue;\n\t\t\t\t\tqx[i][k].push((node){ay[v1[i][j][s]],minn[v1[i][j][s]][k][0]});\n\t\t\t\t}\n\t\t\t\tint len2=v2[i][j].size()-1;\n\t\t\t\tfor(int s=0;s<=len2;++s) {\n\t\t\t\t\tminn[v2[i][j][s]][k][1]=mn(minn[v2[i][j][s]][k][1],f[i][j][k]);\n\t\t\t\t\tif(!qy[j][k].empty()&&ax[v2[i][j][s]]>=qy[j][k].top().x&&minn[v2[i][j][s]][k][1]>=qy[j][k].top().s) continue;\n\t\t\t\t\tqy[j][k].push((node){ax[v2[i][j][s]],minn[v2[i][j][s]][k][1]});\n\t\t\t\t}\n\t\t\t\t//printf(\"%d %d %d:%d\\n\",i,j,k,f[i][j][k]);\n\t\t\t}\n\t}\n\tll ans=oo;\n\tfor(int i=0;i<=w;++i)\n\t\tans=mn(ans,f[1][1][i]);\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n\n```\n\n\n-\u5b8c-\n\nPS\uff1a\n-  \u4e00\u5f00\u59cb\u6211\u8fd9\u4e2a\u777f\u667a\u5c45\u7136\u60f3\u7528\u5355\u8c03\u961f\u5217\u3002\u3002\u3002\n\n- \u628a $k$ \u8c03\u5927\u53ef\u4ee5\u5361\u7ebf\u6bb5\u6811\u505a\u6cd5\uff0c\u4f46 $St$ $OI$ \u575a\u6301\u826f\u5fc3\u4e0d\u6bd2\u7624\u4e0d\u5361\u7b97\u6cd5\uff0c\u6240\u4ee5\u653e\u8fc7\u4e86\u7ebf\u6bb5\u6811\u505a\u6cd5 \uff08\uff08\uff08\u5b9e\u9645\u4e0a\u4e5f\u4e0d\u597d\u5361\n\n- \u672c\u6765\u7684\u9898\u76ee\u662f\u4f7f\u6700\u5927\u503c\u6700\u5c0f\uff0c\u4f46\u7531\u4e8e\u5404\u79cd\u539f\u56e0\u6539\u6389\u4e86\uff0c\u5404\u4f4d\u53ef\u4ee5\u81ea\u884c\u601d\u8003\u8f6c\u79fb\u65b9\u7a0b\uff0c\u5982\u679c\u6709\u6bd4\u8f83\u7b80\u5355\u7684\u4e8c\u5206\u505a\u6cd5\u53ef\u4ee5\u4e0e\u6211\u79c1\u4fe1\u63a2\u8ba8\uff0c\u8c22\u8c22",
        "postTime": 1601910565,
        "uid": 114830,
        "name": "Kostlin",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P6797 \u3010\u300cStOI-2\u300d\u4e0d\u673d\u7684\u9003\u4ea1\u8005\u3011"
    }
]