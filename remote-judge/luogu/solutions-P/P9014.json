[
    {
        "content": "# \u524d\u8a00\r\n\r\n\u4e00\u9053 USACO-Ag \u7684\u9898\u76ee\uff0cT2\u3002\r\n\r\n\u603b\u4f53\u96be\u5ea6\u4e0d\u5927\uff0c~~\u7801\u91cf\u60ca\u4eba~~\u3002\r\n\r\n\r\n# \u89e3\u9898\r\n\r\n\u9996\u5148\u7406\u89e3\u9898\u610f\u3002\r\n\r\n* \u521a\u5f00\u59cb\u6bcf\u4e2a\u683c\u5b50\u90fd\u6709\u4e00\u4e2a\u65b9\u5411\u6807\u3002\r\n\r\n* \u6bcf\u6b21\u64cd\u4f5c\u4fee\u6539\u4e00\u4e2a\u65b9\u5411\u6807\uff0c\u5e76\u5b9e\u65f6\u66f4\u65b0\u7b54\u6848\u3002\r\n\r\n\u6837\u4f8b\u7b54\u6848\u5982\u4e0b\u56fe\u6240\u793a\u3002\r\n\r\n![\u6837\u4f8b1](https://cdn.luogu.com.cn/upload/image_hosting/tj8eijii.png)\r\n\r\n# \u89e3\u6cd5\r\n\r\n\r\n\u53ef\u4ee5\u6ce8\u610f\u5230\uff0c\u5bf9\u4e8e\u521a\u5f00\u59cb\u7684\u56fe\uff0c\u6bcf\u4e2a\u70b9\u6240\u5bf9\u7684\u9972\u6599\u6876\u662f\u786e\u5b9a\u7684\u3002\r\n\r\n\u82e5\u5c06\u7ad6\u5217\u7684\u9972\u6599\u6876\u6807\u8bb0\u4e3a $1\\sim n$\uff0c\u6a2a\u884c\u7684\u9972\u6599\u6876\u6807\u8bb0\u4e3a $n+1\\sim 2\\times n$\uff0c\u5219\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u521a\u5f00\u59cb\u90fd\u6709\u4e00\u4e2a\u786e\u5b9a\u7684\u9972\u6599\u6876\uff0c\u53ef\u4ee5\u770b\u6210\u6839\u3002\r\n\r\n\u5982\u679c\u628a\u4e00\u5f20\u56fe\u770b\u505a\u6210\u4e00\u7247\u68ee\u6797\uff0c\u5219\u5bf9\u4e8e\u6837\u4f8b\u800c\u8a00\uff0c$(1,1), (1,2)$ \u7684\u6839\u4e3a $1$\uff0c$(2,1)$ \u7684\u6839\u4e3a $3$\uff0c$(2,2)$ \u7684\u6839\u4e3a $4$\u3002\r\n\r\n* \u521d\u59cb\u8ba1\u7b97\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u6839\u4f9d\u6b21\u904d\u5386\uff0c\u5bf9\u4e8e\u7ad6\u5217\u7684\u6839\u7b2c $n$ \u5217\u5fc5\u987b\u4e3a $R$\uff0c\u5bf9\u4e8e\u6a2a\u884c\u7684\u6839\u7b2c $n$ \u884c\u5fc5\u987b\u4e3a $D$\uff0c\u8bb0\u5f55\u6bcf\u4e2a\u70b9\u7684\u6839\uff0c\u6bcf\u4e2a\u6839\u548c\u70b9\u7684\u5b50\u6811\u5927\u5c0f\uff0c\u6bcf\u4e2a\u8282\u70b9\u6700\u591a\u904d\u5386\u4e00\u904d\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\uff1b\u8ba1\u7b97\u4e3a\u6bcf\u4e2a\u6839\u7684\u5b50\u6811\u5927\u5c0f\u4e58\u5bf9\u5e94\u9972\u6599\u6876\u7684\u503c\u3002\r\n\r\n* \u4fee\u6539\u8ba1\u7b97\uff1a\u5bf9\u4e8e\u5b9a\u70b9\uff0c\u8fd9\u4e2a\u70b9\u7684\u5b50\u6811\u4ece\u539f\u672c\u6307\u5411\u7684\u70b9\u7684\u6839\u53d8\u4e3a\u73b0\u5728\u6307\u5411\u7684\u70b9\uff0c\u82e5\u539f\u6839\u9972\u6599\u6876\u5927\u5c0f\u4e3a $i$\uff0c\u73b0\u6839\u9972\u6599\u6876\u5927\u5c0f\u4e3a $j$\uff0c\u4e0a\u4e00\u6b21\u64cd\u4f5c\u7b54\u6848\u4e3a $ans$\uff0c\u8fd9\u4e2a\u70b9\u7684\u5b50\u6811\u5927\u5c0f\u4e3a $sz$\uff0c\u5219\u64cd\u4f5c\u540e\u7b54\u6848\u4e3a $ans+(j-i)\\times sz$\uff0c\u540c\u65f6\u904d\u5386\u5b50\u6811\uff0c\u4fee\u6539\u6839\u3002\u6bcf\u6b21\u64cd\u4f5c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u68f5\u6811\u4e2d\u7684\u4e00\u68f5\u5b50\u6811\u88ab\u63a5\u5230\u4e86\u53e6\u4e00\u68f5\u6811\u91cc\u3002\r\n\r\n* \u6bcf\u6b21\u8ba1\u7b97\u5b9e\u9645\u6700\u591a\u904d\u5386 $2n-1$ \u904d\uff0c\u904d\u5386 $Q$ \u6b21\uff0c\u5171\u904d\u5386 $2nQ-Q$ \u6b21\u3002\r\n\r\n\r\n\u8ba1\u7b97\u4e0b\u6765\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u548c\u4e3a $O(n^2+nQ)$\u3002\r\n\r\n# \u4ee3\u7801\r\n\r\n\u672c\u4ee3\u7801\u5185\u4e3a\u65b9\u4fbf\u8868\u793a\u70b9\uff0c\u5c06\u70b9\u5bf9 $(i,j)$ \u8868\u793a\u4e3a\u6570 $(i-1)\\times n+j$\uff0c\u53ef\u4ee5\u5c06\u6240\u6709\u70b9\u8868\u793a\u4e3a $1-n^2$ \u5185\u7684\u6570\u3002\r\n\r\n\u53e6\u5916\uff0c\u7ed9\u51fa\u4e00\u7ec4\u8f83\u5f3a\u7684\u8c03\u8bd5\u6570\u636e\u3002\r\n\r\n```cpp\r\n3\r\nRRR 10\r\nDDR 20\r\nRRD 30\r\n40 50 60\r\n4\r\n3 3\r\n1 1\r\n3 3\r\n1 1\r\n```\r\n\u8f93\u51fa\uff1a\r\n\r\n```cpp\r\n350\r\n200\r\n220\r\n400\r\n350\r\n```\r\n-----\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\nusing namespace std;\r\ntypedef long long ll;\r\nconst ll N=1509;\r\nll n,Q,p[N*2],sz[N*N+2*N],f[N*N+2*N],ans;\r\nchar a[N][N];\r\nvector<ll> son[N*N+2*N];\r\ninline ll id(ll x,ll y){\r\n\tif(x<=n&&y<=n) return (x-1)*n+y;\r\n\tif(x==n+1) return n*n+n+y;\r\n\treturn n*n+x;\r\n}\r\ninline void dfs(ll x,ll y,ll fa){\r\n\tll ider=id(x,y),iderx=id(x-1,y),idery=id(x,y-1);\r\n\tsz[ider]=1;\r\n\tf[ider]=fa;\r\n\tif(a[x][y-1]=='R'){\r\n\t\tson[ider].push_back(idery);\r\n\t\tdfs(x,y-1,fa);\r\n\t\tsz[ider]+=sz[idery];\r\n\t}\r\n\tif(a[x-1][y]=='D'){\r\n\t\tson[ider].push_back(iderx);\r\n\t\tdfs(x-1,y,fa);\r\n\t\tsz[ider]+=sz[iderx];\r\n\t}\r\n}\r\ninline void dfs_bao(ll x,ll y,ll fa,ll cha){\r\n    ans+=cha;\r\n    f[id(x,y)]=fa;\r\n    if(a[x][y-1]=='R')\r\n\t\tdfs_bao(x,y-1,fa,cha);\r\n\tif(a[x-1][y]=='D')\r\n\t\tdfs_bao(x-1,y,fa,cha);\r\n}\r\nint main(){\r\n\tios::sync_with_stdio(false);\r\n\tcin.tie(0),cout.tie(0);\r\n\tcin>>n;\r\n\tfor(register ll i=1;i<=n;i++){\r\n\t\tfor(register ll j=1;j<=n;j++) cin>>a[i][j];\r\n\t\tcin>>p[i];\r\n\t}\r\n\tfor(register ll i=n+1;i<=2*n;i++) cin>>p[i];\r\n\tfor(register ll i=1;i<=n;i++){\r\n\t\tif(a[i][n]=='R'){\r\n\t\t    son[n*n+i].push_back(id(i,n));\r\n\t\t\tdfs(i,n,i);\r\n\t\t\tsz[n*n+i]=sz[id(i,n)];\r\n\t\t}\r\n\t}\r\n\tfor(register ll i=n+1;i<=2*n;i++){\r\n\t\tif(a[n][i-n]=='D'){\r\n\t\t\tson[n*n+i].push_back(id(n,i-n));\r\n\t\t\tdfs(n,i-n,i);\r\n\t\t\tsz[n*n+i]=sz[id(n,i-n)];\r\n\t\t}\r\n\t}\r\n\tfor(register ll i=1;i<=2*n;i++)\r\n\t\tans+=p[i]*sz[n*n+i];\r\n\tcout<<ans<<endl;\r\n\tfor(register ll i=1;i<=n;i++){\r\n\t\tf[id(n+1,i)]=i+n;\r\n\t\tf[id(i,n+1)]=i;\r\n\t}\r\n\tint q=0;\r\n\tcin>>Q; q=Q;\r\n\twhile(Q--){\r\n\t\tll opx,opy;\r\n\t\tcin>>opx>>opy;\r\n\t\tll faxyer=0;\r\n\t\tif(a[opx][opy]=='R') faxyer=f[id(opx+1,opy)],a[opx][opy]='D';\r\n\t\telse faxyer=f[id(opx,opy+1)],a[opx][opy]='R';\r\n\t\tll val=p[faxyer];\r\n\t\tll cha=val-p[f[id(opx,opy)]];\r\n\t\tdfs_bao(opx,opy,faxyer,cha);\r\n\t\tcout<<ans<<endl;\r\n\t}\r\n\treturn 0;\r\n}\r\n```",
        "postTime": 1675581527,
        "uid": 601224,
        "name": "yujinning",
        "ccfLevel": 4,
        "title": "P9014 \u9898\u89e3"
    },
    {
        "content": "### \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a $n+1$ \u884c $n+1$ \u5217\u7684\u5730\u56fe\uff0c\u524d $1 \\sim n$ \u884c $1 \\sim n$ \u5217\u6bcf\u4e2a\u70b9\u4e00\u53ea\u5976\u725b\u548c\u4e00\u4e2a\u8def\u6807\uff0c\u8def\u6807\u6307\u5411\u53f3\u8fb9\u6216\u4e0b\u8fb9\uff0c\u6700\u540e\u4e00\u884c\u548c\u6700\u540e\u4e00\u5217\u6709\u8349\u6599\uff0c\u6bcf\u4e2a\u8349\u6599\u6709\u5bf9\u5e94\u7684\u4ef7\u683c\uff0c\u6bcf\u5934\u5976\u725b\u90fd\u4f1a\u6cbf\u7740\u8def\u6807\u53bb\u5bfb\u627e\u8349\u6599\u3002\u6c42\u6bcf\u5929\u5582\u517b\u6240\u6709\u5976\u725b\u7684\u603b\u6210\u672c\u3002\u7136\u800c\uff0c\u5728\u6bcf\u5929\u665a\u996d\u524d\uff0c\u4e00\u4e9b\u5976\u725b $(i,j)$ \u4f1a\u7ffb\u8f6c\u8def\u6807\u7684\u65b9\u5411\uff08\u4ece\u53f3\u5230\u4e0b\uff0c\u53cd\u4e4b\u4ea6\u7136\uff09\u3002\u5728\u63a5\u4e0b\u6765\u7684\u51e0\u5929\u91cc\uff0c\u8def\u6807\u4e5f\u4fdd\u6301\u5728\u8fd9\u4e2a\u65b9\u5411\u4e0a\u3002\n\n### \u9898\u76ee\u5206\u6790\n\n#### \u89e3\u6cd5\u4e00\n\n\u4ece\u6bcf\u5934\u5976\u725b\u5f00\u59cb\u904d\u5386\uff0c\u6c42\u51fa\u8fd9\u5934\u5976\u725b\u7684\u5403\u996d\u4ee3\u4ef7\uff0c\u6bcf\u6b21\u66f4\u6539\u90fd\u904d\u5386\u4e00\u904d\u3002\n\n\u4f46\u662f\u6700\u574f\u60c5\u51b5\u4e0b\u65f6\u95f4\u6548\u7387\u662f $O ( n ^ 3 \\times q ) $ \u7684\u3002\n\n#### \u89e3\u6cd5\u4e8c\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u6bcf\u5934\u5976\u725b\u90fd\u53ea\u80fd\u5411\u53f3\u548c\u5411\u4e0b\u8d70\uff0c\u6240\u4ee5\u6bcf\u6b21\u66f4\u6539\u4e00\u4e2a\u8def\u6807\u90fd\u53ea\u4f1a\u5f71\u54cd\u5b83\u5de6\u4e0a\u7684\u5976\u725b\u5403\u8349\u7684\u4ee3\u4ef7\uff0c\u6bcf\u6b21\u66f4\u6539\u540e\u53ea\u9700\u904d\u5386\u5b83\u5de6\u4e0a\u7684\u70b9\u3002\n\n#### \u89e3\u6cd5\u4e09\n\n\u4e0a\u4e24\u4e2a\u89e3\u6cd5\u6bcf\u4e2a\u5976\u725b\u90fd\u9700\u8981\u82b1 $O(n)$ \u53bb\u904d\u5386\uff0c\u4e00\u5171\u5c31\u662f $O(n^3)$\uff0c\u4f1a\u91cd\u590d\u904d\u5386\u5f88\u591a\u70b9\uff0c\u592a\u6162\u4e86\u3002\u4e8e\u662f\u6211\u4eec\u60f3\u6bcf\u4e2a\u5976\u725b\u90fd\u552f\u4e00\u5bf9\u5e94\u7740\u4e00\u4e2a\u8349\u6599\uff0c\u5982\u679c\u4ece\u6bcf\u4e2a\u8349\u6599\u5f00\u59cb\u904d\u5386\u5c31\u4e0d\u4f1a\u91cd\u590d\u904d\u5386\u70b9\u4e86\uff0c\u5c31\u662f $O(n^2)$ \u7684\u65f6\u95f4\u6548\u7387\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u8003\u8651\u4ece\u6700\u540e\u4e00\u884c\u548c\u6700\u540e\u4e00\u5217\u5411\u5de6\u4e0a dfs \u4ece\u800c\u77e5\u9053\u6bcf\u4e2a\u70b9\u7684\u6700\u7ec8\u4ee3\u4ef7\u3002\u5bf9\u4e8e\u6bcf\u6b21\u4fee\u6539\uff0c\u4f9d\u7136\u5411\u5de6\u4e0a dfs \u66f4\u6539\u5b83\u6240\u6539\u53d8\u7684\u70b9\u7684\u6700\u7ec8\u4ee3\u4ef7\u3002\n\n### code\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n\nusing namespace std;\n\nconst int N = 1505;\nlong long n, ans, a[N][N], q, x, y;\nchar c[N][N];\nbool cnt[N][N];\n\nvoid dfs(long long x, long long y, long long sum)\n{\n\tif(x == 0 || y == 0)\n\t\treturn ;\n\ta[x][y] = sum;\n\tans += sum;\n\tif(c[x-1][y] == 'D')\n\t\tdfs(x-1, y, sum);\n\tif(c[x][y-1] == 'R')\n\t\tdfs(x, y-1, sum);\n\treturn ;\n}\n\nvoid dfs1(long long x, long long y, long long sum)\n{\n\tif(x == 0 || y == 0)\n\t\treturn ;\n\tans -= a[x][y];\n\ta[x][y] = sum;\n\tans += a[x][y];\n\tif(c[x-1][y] == 'D')\n\t\tdfs1(x-1, y, sum);\n\tif(c[x][y-1] == 'R')\n\t\tdfs1(x, y-1, sum);\n\treturn ;\n}\n\nint main(int argc, char** argv)\n{\n\tscanf(\"%d\", &n);\n\tfor(int i = 1;i <= n;i++)\n\t{\n\t\tfor(int j = 1;j <= n;j++)\n\t\t\tcin >> c[i][j];\n\t\tscanf(\"%d\", &a[i][n+1]);\n\t}\n\tfor(int i = 1;i <= n;i++)\n\t\tscanf(\"%d\", &a[n+1][i]);\n\tfor(int i = 1;i <= n;i++)\n\t{\n\t\tif(c[i][n] == 'R')\n\t\t\tdfs(i, n, a[i][n + 1]);\n\t\tif(c[n][i] == 'D')\n\t\t\tdfs(n, i, a[n + 1][i]);\n\t}\n\tprintf(\"%d\\n\", ans);\n\tcin >> q;\n\twhile(q--)\n\t{\n\t\tcin >> x >> y;\n\t\tif(c[x][y] == 'R')\n\t\t{\n\t\t\tc[x][y] = 'D';\n\t\t\tans -= a[x][y];\n\t\t\ta[x][y] = a[x+1][y];\n\t\t\tans += a[x][y];\n\t\t\tdfs1(x, y, a[x][y]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tc[x][y] = 'R';\n\t\t\tans -= a[x][y];\n\t\t\ta[x][y] = a[x][y+1];\n\t\t\tans += a[x][y];\n\t\t\tdfs1(x, y, a[x][y]);\n\t\t}\n\t\tcout << ans << endl;\n\t}\n\treturn 0;\n}\n\n```",
        "postTime": 1675512619,
        "uid": 551108,
        "name": "Zhang_bingjia",
        "ccfLevel": 3,
        "title": "P9014\u9898\u89e3"
    },
    {
        "content": "**\u7ec8\u4e8e\u5347\u91d1\u7ec4\u4e86\uff0c\u7279\u6b64\u7eaa\u5ff5\u3002**\n\n## \u9898\u610f\u7b80\u8ff0\n\n\u6bcf\u5934\u5976\u725b\u6bcf\u5929\u6309\u7167\u8def\u6807\u7684\u65b9\u5411\uff08\u53f3\u6216\u4e0b\uff09\u8d70\u77e5\u9053\u8d70\u5230\u8fb9\u7f18\u4e0a\uff0c\u8be5\u683c\u5bf9\u5e94\u7684\u9972\u6599\u6876\u4f1a\u88ab\u98df\u7528\uff0cFarmer John \u82b1\u8d39\u76f8\u5e94\u7684\u94b1\uff0c\u6bcf\u5929\u4e5f\u4f1a\u6709\u4e00\u5757\u65b9\u5411\u724c\u88ab\u7ffb\u8f6c\uff0c\u6c42\u6bcf\u5929\u82b1\u8d39\u7684\u94b1\u6570\u3002\n\n## \u9898\u76ee\u5206\u6790\n\n* \u9996\u5148\u8981\u5bf9\u521d\u59cb\u7b54\u6848\u8fdb\u884c\u8ba1\u7b97\u3002\n\n\u82e5\u662f\u5bf9\u6bcf\u4e2a\u5976\u725b\u5355\u72ec\u8fdb\u884c dfs\uff0c\u4f1a\u8d85\u65f6\u3002\n\n\u6ce8\u610f\u5230\u6bcf\u53ea\u5976\u725b\u548c\u8d70\u5411\u5b83\u6240\u5728\u70b9\u7684\u5976\u725b\u5fc5\u4f1a\u8d70\u5230\u540c\u4e00\u9972\u6599\u6876\uff0c\u53ef\u4ee5\u7528\u4e00\u4e2a\u6570\u7ec4 $a$ \u8bb0\u5f55\u6709\u591a\u5c11\u5976\u725b\u4f1a\u8d70\u5230\u8fd9\u4e2a\u70b9\uff08\u5305\u62ec\u81ea\u5df1\uff09\u3002\n\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n* \u63a5\u7740\u5904\u7406\u6bcf\u4e00\u4e2a\u6539\u52a8\u540e\u7684\u6570\u636e\u3002\n\n\u6bcf\u5929\u6539\u52a8\u540e\u548c\u524d\u4e00\u5929\u533a\u522b\u4e0d\u5927\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7531\u524d\u4e00\u5929\u7684\u89e3\u63a8\u51fa\u540e\u4e00\u5929\u7684\u89e3\u3002\n\n\u82e5 $(i,j)$ \u7684\u65b9\u5411\u724c\u6539\u52a8\u4e86\uff0c\u5219\u53ea\u6709\u6240\u6709\u4f1a\u7ecf\u8fc7\u6b64\u70b9\u7684\u5976\u725b\uff08\u5171 $a[i][j]$ \u4e2a\uff09\u7684\u53bb\u5411\u53ef\u80fd\u4f1a\u53d1\u751f\u6539\u53d8\u3002\n\n\u4e8e\u6b64\u540c\u65f6\u8fd8\u8981\u66f4\u65b0\u539f\u6765\u548c\u5f53\u524d\u53bb\u5411\u4e0a\u7684\u70b9\u7684 $a$ \u503c\u3002\n\n\u6bcf\u6b21\u66f4\u65b0\u540e\u7684\u7b54\u6848\u5373\u4e3a\u6240\u6709\u8fb9\u7f18\u70b9\u4e58\u4ee5\u5176\u6240\u5bf9\u5e94\u7684\u82b1\u8d39\u4e4b\u548c\uff0c\u7ecf\u8fc7\u4f18\u5316\u53ef\u4ee5\u5728 $O(1)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u5904\u7406\uff08\u5b9e\u9645\u4e0a $O(n)$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u53ef\u63a5\u53d7\uff09\u3002\n\n\u6545\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2+nm)$\u3002\n\n### AC\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1509;\nint n,q,l[N],r[N],a[N][N];\nchar c[N][N];\ninline void init(){//\u6b64\u5904\u82e5dfs\u4f1a\u8d85\u65f6\uff08\u5e38\u6570\uff09\n\tfor(int i=1;i<=n;i++)\n        for(int j=1;j<=n;j++){\n            a[i][j]++;\n            if(c[i][j]=='R')\n                a[i][j+1]+=a[i][j];\n            else if(c[i][j]=='D')\n                a[i+1][j]+=a[i][j];\n        }\n}\ninline void dfs(int x,int y,int cnt,bool ok){\n\tif(ok) a[x][y]+=cnt;\n\tif(y==n&&c[x][y]=='R')\n\t\ta[x][y+1]+=cnt;\n\telse if(x==n&&c[x][y]=='D')\n\t\ta[x+1][y]+=cnt;\n\telse if(c[x][y]=='R')\n\t\tdfs(x,y+1,cnt,1);\n\telse if(c[x][y]=='D')\n\t\tdfs(x+1,y,cnt,1);\n}\nint ans(){\n\tint sum=0;\n\tfor(int i=1;i<=n;i++)\n        sum+=a[i][n+1]*l[i]+a[n+1][i]*r[i];\n    return sum;\n}\nint main(){\n\tios::sync_with_stdio(false);\n\tcin.tie(0); cout.tie(0);\n\tcin>>n;\n\tfor(register int i=1;i<=n;i++){\n\t\tfor(register int j=1;j<=n;j++)\n\t\t\tcin>>c[i][j];\n\t\tcin>>l[i];\n\t}\n\tfor(register int i=1;i<=n;i++)\n\t\tcin>>r[i];\n\tinit();\n\tcout<<ans()<<endl;\n\tcin>>q;\n\twhile(q--){\n\t\tint i,j;\n\t\tcin>>i>>j;\n\t\tdfs(i,j,a[i][j]*(-1),0);\n\t\tif(c[i][j]=='D') c[i][j]='R';\n\t\telse c[i][j]='D';\n\t\tdfs(i,j,a[i][j],0);\n\t\tcout<<ans()<<endl;\n\t}\n\treturn 0;\n}\n```\n\nupd:2023.2.12\n\n**\u7279\u522b\u611f\u8c22\uff1a**\n\n@[syLph](https://www.luogu.com.cn/user/545026) \u63d0\u51fa\u4e86\u539f\u9898\u89e3\u7684\u95ee\u9898\uff1b\n\n@[xiaozhang2022](https://www.luogu.com.cn/user/479459) \u7ed9\u51fa\u4e86\u6b63\u786e\u7684\u4ee3\u7801\u5e76\u63d0\u51fa\u4e86\u539f\u601d\u8def\u7684\u95ee\u9898\u3002",
        "postTime": 1675565713,
        "uid": 600723,
        "name": "Yujinhe469",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 P9014 [USACO23JAN] S-T2"
    },
    {
        "content": "\u5148\u66b4\u529b\u6c42\u89e3\u7b2c\u4e00\u4e2a\u7b54\u6848\uff0c$O(n^2)$\uff0c\u8bb0\u5f55 $cow_{i, j}$ \u4e3a\u7ecf\u8fc7 $(i, j)$ \u7684\u725b\u6570\u3002\n\n\u4e4b\u540e\u5bf9\u4e8e\u4e00\u6b21\u64cd\u4f5c\uff0c\u66f4\u65b0\u4ece\u5f53\u524d\u8282\u70b9\u5f00\u59cb\u8d70\u4e24\u4e2a\u4e0d\u540c\u65b9\u5411\u662f\u7684\u4e24\u6761\u8def\u5f84\u4e0a\u7684 $cow$ \u548c\u7b54\u6848\u5373\u53ef\u3002\n\n\u66f4\u5177\u4f53\u7684\uff1a\n\n\u5047\u8bbe\u4e00\u4e2a\u8d70\u5230 $(i,j)$ \u7684\u5976\u725b\u5728\u6539\u53d8\u8def\u724c\u524d\u7ecf\u8fc7 $(bax_1, bay_1), (bax_2, bay_2), ..., (bax_{brlen}, bax_{brlen})$\uff0c\u5230\u8fbe $(bex, bey)$\u3002\n\n\u6539\u53d8\u8def\u724c\u540e\u5c31\u9700\u8981\u7ecf\u8fc7 $(aax_1, aay_1), (aax_2, aay_2), ..., (aax_{arlen}, bax_{arlen})$\uff0c\u5230\u8fbe $(aex, aey)$\u3002\n\n\u90a3\u4e48\u7ed3\u679c\u7684\u8ba1\u7b97\u4e3a\n\n$$ans = ans - cow_{i, j} \\times c_{bex, bey} + cow_{i, j} \\times c_{aex, aey}\n$$\n\n\u800c\u5bf9\u4e8e $cow_{bax_1, bay_1}, cow_{bax_2, bay_2}, ..., cow_{bax_{brlen}, bax_{brlen}}$\uff0c\u6bcf\u4e2a\u51cf\u5c11 $cow_{i, j}$\uff0c\u5bf9\u4e8e $cow_{aax_1, aay_1}, cow_{aax_2, aay_2}, ..., cow_{aax_{arlen}, aax_{arlen}}$\uff0c\u6bcf\u4e2a\u589e\u52a0 $cow_{i, j}$\u3002\n\n\u8fd9\u9898\u597d\u597d\u60f3\u60f3\u90fd\u80fd\u505a\uff0c\u6ca1\u5565\u592a\u591a\u53ef\u8bf4\u7684\uff0c\u65f6\u95f4 $O(n^2 + n \\times q)$\u3002\n\n\u81f3\u4eca\u4e0d\u660e\u767d\u4e3a\u4ec0\u4e48\u7ed9 8 \u79d2\u3002",
        "postTime": 1675919265,
        "uid": 377873,
        "name": "EricWan",
        "ccfLevel": 6,
        "title": "P9014 [USACO23JAN] Following Directions S \u9898\u89e3"
    },
    {
        "content": "## \u9898\u76ee\u5206\u6790\n\u9884\u5904\u7406\u6bcf\u4e2a\u70b9\u7ecf\u8fc7\u7684\u725b\u6570 $cnt_{i, j}$\uff0c\u6bcf\u6b21\u66f4\u6539\u4e00\u4e2a\u70b9\u7684\u6307\u5411\u65f6\uff0c\u8ba1\u7b97\u66f4\u6539\u524d\u7684\u7ec8\u70b9\u5750\u6807 `Old` \u548c\u66f4\u6539\u540e\u7684\u7ec8\u70b9\u5750\u6807 `New`\uff08\u4e0d\u8981\u5fd8\u4e86\u4fee\u6539\u662f\u4e00\u76f4\u4fdd\u7559\u7684\uff0c\u5728\u8ba1\u7b97\u7ec8\u70b9\u7684\u8fc7\u7a0b\u4e2d\u8981\u987a\u4fbf\u66f4\u6539\u9014\u7ecf\u70b9\u7684\u725b\u6570\u548c\u51fa\u53d1\u70b9\u7684\u8def\u724c\u65b9\u5411 ~~\uff0c\u67d0\u849f\u84bb\u5728\u8fd9\u4e2a\u95ee\u9898\u4e0a\u8c03\u4e86 10min~~\uff09\u3002\n\n\u65b0\u7b54\u6848\u662f\u65e7\u7b54\u6848 $ans$ \u51cf\u53bb\u51fa\u53d1\u70b9\u725b\u6570 $cnt_{x, y}$ \u4e0e \u65e7\u7ec8\u70b9\u82b1\u8d39 `a[oldx][oldy].x` \u7684\u79ef\uff0c \u52a0\u4e0a\u51fa\u53d1\u70b9\u725b\u6570 $cnt_{x, y}$ \u4e0e \u65b0\u7ec8\u70b9\u82b1\u8d39 `a[newx][newy].x` \u7684\u79ef\u3002\n\n## \u4ee3\u7801:\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst long long NR = 15 * 1e2 + 1;\nstruct Node{\n    Node(){\n        c = '@';\n    }\n    char c;\n    long long x;\n}a[NR + 10][NR + 10];   //\u7ed3\u6784\u4f53\u5b58\u50a8\u8f93\u5165\nchar s[NR + 10];\nlong long cnt[NR + 10][NR + 10];\n\nint main(){\n    long long n;\n    scanf(\"%lld\", &n);\n    //\u8bfb\u5165\n    for(long long i = 1;i <= n;i++){\n        scanf(\"%s\", s + 1);\n        for(long long j = 1;j <= n;j++){\n            a[i][j].c = s[j];\n        }\n        scanf(\"%lld\", &a[i][n + 1].x);\n    }\n    for(long long j = 1;j <= n;j++){\n        scanf(\"%lld\", &a[n + 1][j].x);\n    }\n    //\u9884\u5904\u7406\u6bcf\u4e2a\u70b9\u7ecf\u8fc7\u7684\u725b\u6570\n    for(long long i = 1;i <= n + 1;i++){\n        for(long long j = 1;j <= n + 1;j++){\n            if(i == n + 1 && j == n + 1) continue;\n            if(i <= n && j <= n){   //\u4f4f\u6240\n                if(a[i - 1][j].c == 'D'){\n                    cnt[i][j] += cnt[i - 1][j];\n                }\n                if(a[i][j - 1].c == 'R'){\n                    cnt[i][j] += cnt[i][j - 1];\n                }\n                cnt[i][j]++;\n            }\n            else{   //\u9972\u6599\u6876\n                if(i == n + 1){\n                    if(a[i - 1][j].c == 'D'){\n                        cnt[i][j] += cnt[i - 1][j];\n                    }\n                }\n                else if(j == n + 1){\n                    if(a[i][j - 1].c == 'R'){\n                        cnt[i][j] += cnt[i][j - 1];\n                    }\n                }\n            }\n        }\n    }\n    //\u8ba1\u7b97\u6700\u521d\u82b1\u8d39\n    long long sum = 0;\n    for(long long i = 1;i <= n;i++){\n        sum += 1ll * cnt[n + 1][i] * a[n + 1][i].x;\n        sum += 1ll * cnt[i][n + 1] * a[i][n + 1].x;\n    }\n    printf(\"%lld\\n\", sum);   //\u8f93\u51fa\n    //\u5904\u7406\u66f4\u6539\n    long long T;\n    scanf(\"%lld\", &T);\n    while(T--){\n        long long x, y;\n        scanf(\"%lld%lld\", &x, &y);   //\u8bfb\u5165\n        //\u8ba1\u7b97\u65e7\u8def\u5f84\n        long long posx = x, posy = y;\n        while(posx != n + 1 && posy != n + 1){\n            if(a[posx][posy].c == 'D'){\n                posx++;\n            }\n            else if(a[posx][posy].c == 'R'){\n                posy++;\n            }\n            cnt[posx][posy] -= cnt[x][y];\n        }\n        long long tmpx = posx, tmpy = posy;\n        posx = x, posy = y;\n        //\u66f4\u6539\u65b9\u5411\n        if(a[posx][posy].c == 'D'){\n            a[posx][posy].c = 'R';\n        }\n        else if(a[posx][posy].c == 'R'){\n            a[posx][posy].c = 'D';\n        }\n        //\u8ba1\u7b97\u65b0\u8def\u5f84\n        while(posx != n + 1 && posy != n + 1){\n            if(a[posx][posy].c == 'D'){\n                posx++;\n            }\n            else if(a[posx][posy].c == 'R'){\n                posy++;\n            }\n            cnt[posx][posy] += cnt[x][y];\n        }\n        //\u8ba1\u7b97\u5e76\u8f93\u51fa\n        printf(\"%lld\\n\", sum - cnt[x][y] * a[tmpx][tmpy].x\n                             + cnt[x][y] * a[posx][posy].x);\n        sum -= cnt[x][y] * a[tmpx][tmpy].x;\n        sum += cnt[x][y] * a[posx][posy].x;\n    }\n    return 0;\n}\n```\n",
        "postTime": 1675598735,
        "uid": 501333,
        "name": "Dark_Forest66",
        "ccfLevel": 0,
        "title": "USACO23JAN Following Directions S \u9898\u89e3"
    },
    {
        "content": "#### \u6838\u5fc3\uff1a\u9012\u63a8\r\n\u5982\u679c\u6211\u4eec\u53cd\u7740\u8d70\uff0c\u4f1a\u53d1\u73b0\u2014\u2014  \r\n\u5982\u679c\u90a3\u4e2a\u683c\u5b50\u662f \u201cR\u201d \u90a3\u4e48\u8fd9\u4e2a\u683c\u5b50\u7684\u5976\u725b\u548c\u4ed6\u53f3\u4fa7\u7684\u5976\u725b\u6216\u9972\u6599\u6876\u7684\u9972\u6599\u76f8\u540c\uff0c\u53cd\u4e4b\u5982\u679c\u662f \u201cD\u201d \u5c31\u548c\u4e0b\u9762\u7684\u5976\u725b\u6216\u9972\u6599\u6876\u76f8\u540c\u3002  \r\n\u7528 $f(i,j)$ \u8868\u793a\u7b2c $i$ \u884c $j$ \u5217\u7684\u5976\u725b\u5403\u7684\u9972\u6599\u7684\u4ef7\u94b1\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u2014\u2014\r\n```cpp\r\nif(c[i][j]=='R')f[i][j]=f[i][j+1];\r\nelse f[i][j]=f[i+1][j];\r\n```\r\n\u6ce8\u610f\u6211\u4eec\u662f\u53cd\u7740\u63a8\u7684\uff01\r\n\r\n\u5c06\u6240\u6709\u7684\u4ef7\u94b1\u7d2f\u52a0\u5728\u4e00\u5757\uff0c\u5c31\u662f\u7b54\u6848\u3002   \r\n\u6bcf\u6b21\u66f4\u6539\u8def\u724c\u90fd\u91cd\u65b0\u8ba1\u7b97\u4e00\u904d\uff0c\u8f93\u51fa\u7b54\u6848\u3002   \r\n~~\u606d\u559c\u4f60~~\uff0cTLE\u2026\u2026   \r\n\u4ed4\u7ec6\u7814\u7a76\u53d1\u73b0\uff0c\u6bcf\u6b21\u66f4\u6539\u8def\u724c\uff0c\u90fd\u4e0d\u4f1a\u5f71\u54cd\u5728\u4ed6\u53f3\u8fb9\u6216\u4e0b\u8fb9\u7684\u5976\u725b\u3002\r\n![pic](https://cdn.luogu.com.cn/upload/image_hosting/b2qs8adl.png)\r\n\u6240\u4ee5\u6211\u4eec\u6bcf\u6b21\u4ece\u4fee\u6539\u7684\u90a3\u4e2a\u70b9\u5f00\u59cb\u8ba1\u7b97\u5c31\u53ef\u4ee5\u4e86\uff08\u7b2c\u4e00\u6b21\u4ece\u6700\u53f3\u4e0b\u89d2\u5f00\u59cb\uff09\u3002\r\n$sum(x,y)$ \u8868\u793a\u6240\u6709 $i\\geq x$ \u6216 $j\\geq y$ \u7684\u5976\u725b\u5403\u7684\u9972\u6599\u7684\u603b\u4ef7\u683c\u3002  \r\n\u7528\u4e8c\u7ef4\u524d\u7f00\u548c\u4ee3\u66ff\u603b\u8ba1\u6570\uff0c\u4e0d\u4f1a\u4e8c\u7ef4\u524d\u7f00\u548c\u7684\u53ef\u4ee5\u770b\u770b\u8fd9\u5f20\u56fe\u3002   \r\n![pic2](https://cdn.luogu.com.cn/upload/image_hosting/u4d9ofiw.png)  \r\n\u84dd\u6846 = \u84dd\u683c\u5b50 + \u7ea2\u6846 + \u9ec4\u6846 - \u7eff\u6846 \u3002  \r\n\u4e5f\u5c31\u662f $sum_{i,j}=f_{i,j}+sum_{i,j+1}+sum_{i+1,j}-sum_{i+1,j+1}$\u3002  \r\n\u6700\u540e\u7b54\u6848\u5b58\u5728\u4e86 $sum_{1,1}$\u3002  \r\n### AC \u4ee3\u7801\r\n```cpp\r\n#include <iostream>\r\n#include <cmath>\r\n#include <string>\r\n#include <cstring>\r\n#include <iomanip>\r\n#include <cstdio>\r\n#define N 1502\r\nusing namespace std;\r\nint n,T,x,y;\r\nint f[N][N],sum[N][N];\r\nchar c[N][N];\r\nstring s;\r\nint main(){\r\n\tscanf(\"%d\",&n);\t\r\n\tfor(int i=1;i<=n;i++){\r\n\t\tcin>>s;\r\n\t\tfor(int j=1;j<=n;j++)c[i][j]=s[j-1];\r\n\t\tscanf(\"%d\",&f[i][n+1]); \r\n\t}\r\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&f[n+1][i]);\r\n\tscanf(\"%d\",&T);\t\r\n\tfor(int t=0;t<=T;t++){\r\n\t\tif(t){\r\n\t\t\tscanf(\"%d%d\",&x,&y);\r\n\t\t\tc[x][y]=c[x][y]=='R'?'D':'R';//\u4fee\u6539\u8def\u724c\u3002\r\n\t\t}\r\n\t\telse x=y=n;//\u7b2c\u4e00\u6b21\u4ece\uff08n,n\uff09\u5f00\u59cb\u3002 \r\n\t\tfor(int i=x;i>=1;i--){\r\n\t\t\tfor(int j=y;j>=1;j--){\r\n\t\t\t\t//\u9012\u63a8 \r\n\t\t\t\tif(c[i][j]=='R')f[i][j]=f[i][j+1];\r\n\t\t\t\telse f[i][j]=f[i+1][j];\r\n\t\t\t\tsum[i][j]=f[i][j]+sum[i][j+1]+sum[i+1][j]-sum[i+1][j+1]; \r\n\t\t\t}\t\r\n\t\t}\r\n\t\tprintf(\"%d\\n\",sum[1][1]);\r\n\t}\r\n\treturn 0;\r\n}\r\n\r\n```\r\n\u8fd9\u79cd\u601d\u8def\u8f83\u4e3a\u7b80\u5355\uff0c\u4f46\u5e76\u4e0d\u5b8c\u7f8e\uff0c\u9700\u8981\u5f00 O2 \u4f18\u5316\u624d\u80fd AC\uff0c\u5426\u5219\u4f1a\u8d85\u65f6\u3002",
        "postTime": 1675594149,
        "uid": 550577,
        "name": "\u5c0f\u5f20\u5f20\u4e94",
        "ccfLevel": 4,
        "title": "P9014 [USACO23JAN] Following Directions S \u9898\u89e3"
    },
    {
        "content": "\u8003\u8651\u5efa\u56fe\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u6211\u4eec\u5efa\u7acb $(N+1)(N+1)-1$ \u4e2a\u70b9\uff0c\u5206\u522b\u4ee3\u8868 $n^2$ \u5934\u5976\u725b\u548c $2N$ \u4e2a\u9972\u6599\u6876\u3002\u5982\u679c\u6709\u4e00\u4e2a\u8def\u6807\u4ece $(x_1,y_1)$ \u6307\u5411 $(x_2,y_2)$\uff0c\u5219\u6211\u4eec\u5728\u8fd9\u4e24\u4e2a\u70b9\u76f4\u63a5\u8fde\u4e00\u6761\u8fb9\u3002\n\n\u5bb9\u6613\u53d1\u73b0\uff0c\u8fde\u5b8c\u8fb9\u540e\u7684\u56fe\u662f\u4e00\u4e2a\u7531 $2N$ \u4e2a\u6811\u7ec4\u6210\u7684\u68ee\u6797\uff0c\u4e14\u6bcf\u4e00\u4e2a\u9972\u6599\u6876\u6240\u5bf9\u5e94\u7684\u70b9\u90fd\u5728\u4e0d\u540c\u7684\u6811\u5185\u3002\u6211\u4eec\u628a\u8fd9 $2N$ \u4e2a\u70b9\u89c6\u4e3a\u6839\uff0c\u5219\u4ee5\u67d0\u4e2a\u70b9\u4e3a\u6839\u7684\u6240\u6709\u6811\u5185\u7684\u975e\u6839\u8282\u70b9\u5bf9\u5e94\u7684\u5976\u725b\u90fd\u4f1a\u5403\u8fd9\u4e2a\u9972\u6599\u6876\uff0c\u5219\u8fd9\u4e2a\u9972\u6599\u6876\u6240\u8d21\u732e\u7684\u4ef7\u94b1\u82b1\u8d39\u5c31\u4e3a $(size-1) \\cdot cost$\uff08$size$ \u8868\u793a\u8fd9\u68f5\u6811\u7684\u5927\u5c0f\uff0c$cost$ \u8868\u793a\u8be5\u9972\u6599\u6876\u5582\u9971\u4e00\u53ea\u725b\u6240\u9700\u7684\u4ef7\u683c\uff09\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u8003\u8651\u4fee\u6539\u64cd\u4f5c\u3002\u53ef\u4ee5\u770b\u51fa\u6765\uff0c\u5982\u679c\u4e00\u4e2a\u8def\u6807\u6539\u53d8\u4e86\u65b9\u5411\uff0c\u5219\u4ee5\u8be5\u5904\u6240\u5bf9\u5e94\u7684\u8282\u70b9\u4e3a\u6839\u7684\u5b50\u6811\u90fd\u4f1a\u4e00\u8d77\u88ab\u4fee\u6539\u3002\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u8981\u652f\u6301\u4ee5\u4e0b\u4e24\u79cd\u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u89e3\u51b3\u8be5\u95ee\u9898\uff1a\n\n1. \u5c06\u4e00\u68f5\u6811\u7684\u67d0\u4e2a\u5b50\u6811\u63a5\u5230\u53e6\u4e00\u68f5\u6811\u7684\u67d0\u4e2a\u8282\u70b9\u4e0a\u9762\uff08\u5373\u8ba9\u8fd9\u9897\u5b50\u6811\u7684\u6839\u8282\u70b9\u6210\u4e3a\u53e6\u4e00\u4e2a\u8282\u70b9\u7684\u513f\u5b50\uff09\u3002\n\n2. \u67e5\u8be2\u67d0\u68f5\u6811\u7684\u5927\u5c0f\u3002\n\n\u56e0\u4e3a $N,Q \\le 1500$\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u5728 $O(NQ)$ \u7684\u65f6\u95f4\u5185\u89e3\u51b3\u8be5\u95ee\u9898\u5373\u53ef\u3002\u6211\u4eec\u8003\u8651\u7ef4\u62a4\u4e24\u4e2a\u4fe1\u606f\uff0c$f_i$ \u8868\u793a $i$ \u53f7\u8282\u70b9\u7684\u7236\u4eb2\uff0c$siz_i$ \u8868\u793a\u4ee5 $i$ \u4e3a\u6839\u7684\u5b50\u6811\u7684\u5927\u5c0f\uff0c\u5219\u5bf9\u4e8e\u4e00\u6b21\u67e5\u8be2\u64cd\u4f5c\uff0c\u6211\u4eec\u8f93\u51fa $siz$ \u5373\u53ef\u3002\u5bf9\u4e8e\u4e00\u6b21\u4ee4 $x$ \u6210\u4e3a $y$ \u7684\u513f\u5b50\u7684\u4fee\u6539\u64cd\u4f5c\uff0c\u6211\u4eec\u8981\u628a $x$ \u539f\u6765\u7684\u6240\u6709\u7956\u5148\u7684 $siz$ \u5168\u90e8\u51cf $siz_x$\uff0c\u7136\u540e\u5c06 $f_x$ \u4fee\u6539\u4e3a $y$\uff0c\u7136\u540e\u5c06\u65b0\u7684 $x$ \u7684\u7956\u5148\u7684 $siz$ \u5168\u90e8\u52a0 $siz_x$\uff0c\u7136\u540e\u5c31\u641e\u5b9a\u4e86\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<iostream>\n#include<cstdio>\nusing namespace std;\nint c1[1505];\nint c2[1505];\nchar s[1505][1505];\nint ans[1505][1505];\nstruct edge{\n\tint nxt;\n\tint to;\n};\nedge e[5000005];\nint h[2500005];\nint cnt;\nvoid add(int x,int y){\n\tcnt++;\n\te[cnt].nxt=h[x];\n\th[x]=cnt;\n\te[cnt].to=y;\n\treturn;\n}\nint size[2500005];\nint f[2500005];\nvoid dfs(int x,int fa){\n\tf[x]=fa;\n\tsize[x]=1;\n\tfor(int i=h[x];i;i=e[i].nxt)\n\t\tif(e[i].to!=fa){\n\t\t\tdfs(e[i].to,x);\n\t\t\tsize[x]+=size[e[i].to];\n\t\t}\n\tif(!fa) size[x]--;\n\treturn;\n}\nint main(){\n\tint n;\n\tscanf(\"%d\",&n);\n\tfor(int i=0;i<n;i++){\n\t\tcin>>s[i]+1;\n\t\tscanf(\"%d\",&c1[i+1]);\n\t}\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%d\",&c2[i]);\n\tfor(int i=0;i<n;i++)\n\t\tfor(int j=1;j<=n;j++){\n\t\t\tif(s[i][j]=='R'){\n\t\t\t\tadd(i*(n+1)+j,i*(n+1)+j+1);\n\t\t\t\tadd(i*(n+1)+j+1,i*(n+1)+j);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tadd((i+1)*(n+1)+j,i*(n+1)+j);\n\t\t\t\tadd(i*(n+1)+j,(i+1)*(n+1)+j);\n\t\t\t}\n\t\t}\n\tsize[0]=-1;\n\tfor(int i=1;i<=n;i++){\n\t\tdfs(n*(n+1)+i,0);\n\t\tdfs((i-1)*(n+1)+n+1,0);\n\t}\n\tint ans=0;\n\tfor(int i=1;i<=n;i++)\n\t\tans+=c1[i]*size[(i-1)*(n+1)+n+1]+c2[i]*size[n*(n+1)+i];\n\tprintf(\"%d\\n\",ans);\n\tint q;\n\tscanf(\"%d\",&q);\n\tfor(int k=1;k<=q;k++){\n\t\tint i,j;\n\t\tscanf(\"%d%d\",&i,&j);\n\t\ti--;\n\t\tint x=i*(n+1)+j,y=f[x];\n\t\twhile(y){\n\t\t\tsize[y]-=size[x];\n\t\t\ty=f[y];\n\t\t}\n\t\tif(s[i][j]=='R'){\n\t\t\ts[i][j]='D';\n\t\t\tf[x]=(i+1)*(n+1)+j;\n\t\t}\n\t\telse{\n\t\t\ts[i][j]='R';\n\t\t\tf[x]=i*(n+1)+j+1;\n\t\t}\n\t\ty=f[x];\n\t\twhile(y){\n\t\t\tsize[y]+=size[x];\n\t\t\ty=f[y];\n\t\t}\n\t\tans=0;\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tans+=c1[i]*size[(i-1)*(n+1)+n+1]+c2[i]*size[n*(n+1)+i];\n\t\tprintf(\"%d\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1675572821,
        "uid": 449457,
        "name": "IYSY2009I",
        "ccfLevel": 0,
        "title": "solution-p9014"
    },
    {
        "content": "- \u6458\u81ea [here](https://www.luogu.com.cn/blog/261213wrh/usaco-2023-jan-sliver-ti-xie)\u3002\n\n------------\n\n\u8003\u8651\u9884\u5904\u7406\u51fa $now_{i,j}$ \u8868\u793a\u5f53\u524d\u4f1a\u7ecf\u8fc7 $(i,j)$ \u7684\u725b\u7684\u6570\u91cf\u3002\u4e0d\u96be\u53d1\u73b0\u5982\u679c\u80fd\u65f6\u523b\u7ef4\u62a4 $now_{i,j}$ \u5373\u53ef\u505a\u5230\u5feb\u901f\u56de\u7b54\u8be2\u95ee\u3002\n\n\u601d\u8003\u4e00\u6b21\u53d8\u5316\u5bf9 $now$ \u6570\u7ec4\u5e26\u6765\u7684\u5f71\u54cd\u662f\u4ec0\u4e48\u3002\u53d1\u73b0\u5982\u679c $(i,j)$ \u8fd9\u4e2a\u4f4d\u7f6e\u65b9\u5411\u6539\u53d8\uff0c\u5f71\u54cd\u4e3a\u539f\u6765\u4ece $(i,j)$ \u51fa\u53d1\u90a3\u6761\u8def\u4e0a\u70b9 $now$ \u503c\u51cf\u5c11 $now_{i,j}$\uff0c\u73b0\u5728\n\u4ece $(i,j)$ \u51fa\u53d1\u90a3\u6761\u8def\u4e0a\u70b9 $now$ \u503c\u589e\u52a0 $now_{i,j}$\uff0c\u7531\u4e8e\u8fd9\u6837\u7684\u70b9\u53ea\u6709 $O(n)$ \u7ea7\u522b\u4e2a\uff0c\u6240\u4ee5\u66b4\u529b\u4fee\u6539\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nQ)$\u3002[\u4ee3\u7801](https://www.luogu.com.cn/paste/acnufpcl)",
        "postTime": 1675499334,
        "uid": 297806,
        "name": "Demeanor_Roy",
        "ccfLevel": 6,
        "title": "P9014 \u9898\u89e3"
    },
    {
        "content": "### \u601d\u8def\n\n\u8fd9\u9898\u5f88\u7b80\u5355\uff0c\u9884\u5904\u7406\u52a0\u66b4\u529b $O(n)$ \u4fee\u6539\u7ef4\u62a4\u548c $O(1)$ \u67e5\u8be2\uff0c\u603b\u7684 $O(n^2 + n \\times q)$\u3002\n\n\u5177\u4f53\u7684\uff0c\u6211\u4eec\u9996\u5148\u4e00\u904d\u8ba1\u7b97\u51fa\u4e00\u4e2a $f_{i,j}$ \u8868\u793a\u521d\u59cb\u6709 $f_{i,j}$ \u5934\u725b\u4f1a\u7ecf\u8fc7 $(i,j)$ \u8fd9\u4e2a\u70b9\u3002\u5e76\u8bb0\u5f55 $v_{i,j}$ \u8868\u793a $(i,j)$ \u8fd9\u4e2a\u4f4d\u7f6e\u6700\u540e\u4f1a\u8d70\u5230\u591a\u5c11\u4ef7\u683c\u7684\u9972\u6599\u6876\u3002\n\n\u7136\u540e\u6bcf\u6b21\u66b4\u529b\u5bf9 $f$ \u548c $v$ \u4e24\u4e2a\u6570\u7ec4\u4fee\u6539\u5373\u53ef\uff0c\u8bb0\u5f97\u8fd8\u8981\u66f4\u65b0\u90a3\u4e2a\u64cd\u4f5c\u4f4d\u7f6e\u7684\u65b9\u5411\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\n#define L(i, a, b) for(int i = a; i <= b; i++)\n#define R(i, a, b) for(int i = a; i >= b; i--)\nusing namespace std;\nconst int N = 1510;\nint n, q, c[N][N], v[N][N], f[N][N];\nll ans;\nint Upd(int x, int y, int v){//\u66b4\u529b\u4fee\u6539f\u6570\u7ec4\n\tif(x == n + 1 || y == n + 1) return v * c[x][y];\n\tf[x][y] += v;\n\tif(!c[x][y]) return Upd(x, y + 1, v);\n\telse return Upd(x + 1, y, v);\n}\nint main(){\n\tscanf(\"%d\", &n);\n\tL(i, 1, n){\n\t\tL(j, 1, n){\n\t\t\tchar ch; scanf(\" %c\", &ch);\n\t\t\tc[i][j] = (ch == 'D'); \n\t\t}\n\t\tscanf(\"%d\", &c[i][n + 1]);\n\t} \n\tL(i, 1, n) scanf(\"%d\", &c[n + 1][i]);\n\tL(i, 1, n){\n\t\tL(j, 1, n){\n\t\t\tf[i][j]++;\n\t\t\tif(!c[i][j]) f[i][j + 1] += f[i][j];\n\t\t\telse f[i + 1][j] += f[i][j];\n\t\t}\n\t}\n\tR(i, n, 1){\n\t\tR(j, n, 1){\n\t\t\tif(!c[i][j]) v[i][j] = (j == n? c[i][j + 1] : v[i][j + 1]);\n\t\t\telse v[i][j] = (i == n? c[i + 1][j] : v[i + 1][j]);\n\t\t\tans += v[i][j];\n\t\t}\n\t}\n\tprintf(\"%lld\\n\", ans);\n\tscanf(\"%d\", &q);\n\tL(i, 1, q){\n\t\tint x, y;\n\t\tscanf(\"%d%d\", &x, &y);\n\t\tif(!c[x][y]){\n\t\t\tc[x][y] = 1;\n\t\t\tans = ans + Upd(x + 1, y, f[x][y]) + Upd(x, y + 1, -f[x][y]);\n\t\t}\n\t\telse{\n\t\t\tc[x][y] = 0;\n\t\t\tans = ans + Upd(x, y + 1, f[x][y]) + Upd(x + 1, y, -f[x][y]);\n\t\t}\n\t\tprintf(\"%lld\\n\", ans);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1675602068,
        "uid": 341946,
        "name": "zac2010",
        "ccfLevel": 7,
        "title": "[USACO23JAN] Following Directions S \u9898\u89e3"
    },
    {
        "content": "### \u601d\u8def\n\n\u53ef\u4ee5\u5148\u9884\u5904\u7406\u5230\u6bcf\u4e2a\u9972\u6599\u7f38\u7684\u725b\u7684\u6570\u91cf\uff0c\u5b58\u5728\u6570\u7ec4 $s$ \u4e2d\uff0c\u7136\u540e\u4f9d\u6b21\u5904\u7406\u6bcf\u6b21\u7ffb\u8f6c\uff0c\u7b2c $i$ \u6b21\u7ffb\u8f6c $(i,j)$\uff0c\u53ef\u4ee5\u987a\u7740\u539f\u6765\u8d70\u7684\u8def\uff0c\u4f9d\u6b21\u51cf\u53bb $s_{i,j}$\uff0c\u7136\u540e\u987a\u7740\u7ffb\u8f6c\u540e\u7684\u8def\uff0c\u4f9d\u6b21\u52a0\u4e0a $s_{i,j}$\uff0c\u8fd9\u6837\u7684\u8bdd\u603b\u6210\u672c\u5c31\u662f $\\sum\\limits_{i=1}^{n}s_{i,n+1}\\times c_{i,n+1} + \\sum\\limits_{i=1}^{n}s_{n+1,i}\\times c_{n+1,i}$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int INF=0x3f3f3f3f;\nll q,n,s[1509][1509],cst[1509][1509];\nchar to[1509][1509];\nvoid init(){\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=n;j++){\n\t\t\ts[i][j]+=1;\n\t\t\tif(to[i][j]=='D')  s[i+1][j]+=s[i][j];\n\t\t\telse  s[i][j+1]+=s[i][j];\n\t\t}\n\t}\n\treturn ;\n}\nll count(){\n\tll res=0;\n\tfor(int i=1;i<=n;i++)  res=res+s[i][n+1]*cst[i][n+1];\n\tfor(int i=1;i<=n;i++)  res=res+s[n+1][i]*cst[n+1][i];\n\treturn res; \n}\nvoid mnus(int x,int y,int cnt){\n\tif(to[x][y]=='R'){\n\t\ts[x][y+1]-=cnt;\n\t\tmnus(x,y+1,cnt);\n\t}\n\tif(to[x][y]=='D'){\n\t\ts[x+1][y]-=cnt;\n\t\tmnus(x+1,y,cnt);\n\t}\n}\nvoid pls(int x,int y,int cnt){\n\tif(to[x][y]=='R'){\n\t\ts[x][y+1]+=cnt;\n\t\tpls(x,y+1,cnt);\n\t}\n\tif(to[x][y]=='D'){\n\t\ts[x+1][y]+=cnt;\n\t\tpls(x+1,y,cnt);\n\t}\n}\nvoid change(int sx,int sy){\n\tmnus(sx,sy,s[sx][sy]);\n\tto[sx][sy]=to[sx][sy]=='R'?'D':'R';\n\tpls(sx,sy,s[sx][sy]);\n\treturn ;\n}\nint main(){\n\tcin>>n;\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=1;j<=n;j++)  cin>>to[i][j];\n\t\tcin>>cst[i][n+1];\n\t}\n\tfor(int i=1;i<=n;i++)  cin>>cst[n+1][i];\n\tinit();\n\tcin>>q;\n\tcout<<count()<<endl;\n\tfor(int i=1;i<=q;i++){\n\t\tint x,y;\n\t\tcin>>x>>y;\n\t\tchange(x,y);\n\t\tcout<<count()<<endl;\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1675592527,
        "uid": 737038,
        "name": "__11jiang08__",
        "ccfLevel": 0,
        "title": "P9014 [USACO23JAN] Following Directions S \u9898\u89e3"
    },
    {
        "content": "\u56e0\u4e3a\u672c\u9898\u65f6\u9650\u9ad8\u8fbe $8s$\uff0c\u6211\u4eec\u5c31\u5927\u80c6\u5730\u60f3\u5982\u4f55\u8f83\u4e3a\u7b80\u5355\u5730\u7ef4\u62a4\u672c\u9898\u7684\u64cd\u4f5c\u3002\n\n\u663e\u7136\uff0c\u6bcf\u4e00\u6b21\u7ffb\u8f6c\u6807\u5fd7\u64cd\u4f5c\uff0c\u4e3a\u4e86\u51cf\u5c11\u8fd0\u7b97\u6b21\u6570\uff0c\u6211\u4eec\u53ea\u9700\u66f4\u6539\u672c\u6b21\u64cd\u4f5c\u6709\u5f71\u54cd\u5230\u7684\u5750\u6807\u5373\u53ef\u3002\n\n\u4e3a\u4e86\u4fbf\u5229\u89e3\u9898\uff0c\u6211\u4eec\u5b9a\u4e49\u51e0\u4e2a\u6570\u7ec4\uff1a\n\n- $f_{x,y}$ \u8868\u793a\u521d\u59cb\u5750\u6807\u4e3a $(x,y)$ \u7684\u5976\u725b\u80fd\u5403\u5230\u7684\u9972\u6599\u7684\u4ef7\u503c\uff1b\n\n- $r_{x,y}$ \u8868\u793a\u5403\u5230\u9972\u6599\u9700\u8981\u7ecf\u8fc7\u5750\u6807 $(x,y)$ \u7684\u5976\u725b\u5934\u6570\uff08\u5305\u62ec\u5750\u6807\u4e3a $(x,y)$ \u7684\u5976\u725b\uff09\uff1b\n\n\u540c\u65f6\uff0c\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u70b9\u7684\u201c\u524d\u9a71\u201d\u4e3a\u53ef\u4ee5\u901a\u8fc7\u4e00\u6b65\u76f4\u63a5\u8d70\u5230\u8fd9\u4e2a\u5750\u6807\u7684\u5750\u6807\uff0c\u201c\u540e\u7ee7\u201d\u4e3a\u8fd9\u4e2a\u5750\u6807\u80fd\u4e00\u6b65\u8d70\u5230\u7684\u4e0b\u4e00\u4e2a\u5750\u6807\u3002\n\n\u7b2c\u4e00\u6b21\u64cd\u4f5c\u524d\uff0c\u5148\u9884\u5904\u7406\u51fa $f,r$ \u6570\u7ec4\uff0c\u66b4\u529b\u641c\u7d22\u6c42\u51fa\u6240\u6709\u5976\u725b\u5403\u5230\u7684\u9972\u6599\u7684\u4ef7\u503c\u548c\uff08\u8bb0\u4e3a $s$\uff09\u3002\n\n\u8003\u8651\u6bcf\u6b21\u64cd\u4f5c\u540e\uff0c$f,r$ \u6570\u7ec4\u548c\u7b54\u6848 $s$ \u4f1a\u600e\u4e48\u6539\u53d8\uff1b\u4e0d\u59a8\u8bbe\u6539\u53d8\u7684\u5750\u6807\u4e3a $(x,y)$\uff0c\u4e14\u8def\u6807\u662f\u7531\u201c\u5411\u4e0b\u201d\u6539\u4e3a\u201c\u5411\u53f3\u201d\uff08\u201c\u5411\u53f3\u201d\u53d8\u201c\u5411\u4e0b\u201d\u540c\u7406\uff09\uff1a\n\n- \u5bf9\u4e8e $f$ \u6570\u7ec4\uff1a\u9996\u5148 $f_{x,y}$ \u8981\u4ece $f_{x+1,y}$ \u53d8\u4e3a $f_{x,y+1}$\u3002\u5176\u6b21\u5403\u9972\u6599\u5fc5\u987b\u7ecf\u8fc7 $(x,y)$ \u7684\u6240\u6709\u5976\u725b\u7684 $f$ \u7684\u503c\u4e5f\u9700\u8981\u76f8\u5e94\u7684\u6539\u53d8\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e00\u6b21 dfs \u5b9e\u73b0\uff1b\n\n- \u5bf9\u4e8e $c$ \u6570\u7ec4\uff1a\u53ef\u4ee5\u770b\u51fa\u5fc5\u987b\u7ecf\u8fc7 $(x+1,y)$ \u7684\u5976\u725b\u51cf\u5c11\u4e86 $c_{x,y}$ \u5934\uff0c\u5fc5\u987b\u7ecf\u8fc7 $(x,y+1)$ \u7684\u5976\u725b\u589e\u52a0\u4e86 $c_{x,y}$ \u5934\uff0c\u540c\u65f6\u5b83\u4eec\u7684\u540e\u7ee7\u3001\u540e\u7ee7\u7684\u540e\u7ee7\u2026\u2026\u7684 $c$ \u7684\u503c\u4e5f\u8981\u66f4\u65b0\uff0c\u540c\u6837\u53ef\u4ee5\u901a\u8fc7 dfs \u5b9e\u73b0\uff1b\n\n- \u5bf9\u4e8e\u7b54\u6848 $s$\uff1a\u56e0\u4e3a\u5fc5\u987b\u7ecf\u8fc7 $(x,y)$ \u7684\u5976\u725b\u6709 $c_{x,y}$ \u5934\uff0c\u800c\u8fd9\u4e9b\u5976\u725b\u5750\u6807\u7684 $f$ \u7684\u503c\u90fd\u7531 $f_{x+1,y}$ \u53d8\u4e3a\u4e86 $f_{x,y+1}$\uff0c\u6240\u4ee5 $s\\leftarrow s+c_{x,y}(f_{x,y+1}-f_{x+1,y})$\uff1b\u6bcf\u6b21\u64cd\u4f5c\u540e\u8f93\u51fa $s$ \u5373\u53ef\u3002\n\n\u653e\u4ee3\u7801\uff1a\n\n```cpp\n/*\nID: CrowMatrix\nTASK: Following Directions\nLANG: C++\n*/\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nint a[1502][1502],f[1502][1502],r[1502][1502];\nvoid dfs(int x,int y,int u){\n  f[x][y]=u; r[x][y]=1;\n  if(x&&a[x-1][y]==-1)dfs(x-1,y,u),r[x][y]+=r[x-1][y];\n  if(y&&a[x][y-1]==-2)dfs(x,y-1,u),r[x][y]+=r[x][y-1];\n}\nvoid update1(int x,int y,int u){\n  f[x][y]=u;\n  if(a[x-1][y]==-1)update1(x-1,y,u);\n  if(a[x][y-1]==-2)update1(x,y-1,u);\n}\nvoid update2(int x,int y,int u){\n  r[x][y]+=u;\n  if(a[x][y]==-1)update2(x+1,y,u);\n  if(a[x][y]==-2)update2(x,y+1,u);\n}\nmain(){\n  ios::sync_with_stdio(false);\n  int n,s=0; cin>>n;\n  for(int i=1;i<=n;i++){\n    for(int j=1;j<=n;j++){\n      char c; cin>>c;\n      if(c=='D')a[i][j]=-1;\n      else a[i][j]=-2;\n    }\n    cin>>a[i][n+1];\n  }\n  for(int i=1;i<=n;i++)cin>>a[n+1][i];\n  for(int i=1;i<=n;i++)dfs(i,n+1,a[i][n+1]),dfs(n+1,i,a[n+1][i]);\n  for(int i=1;i<=n;i++)\n    for(int j=1;j<=n;j++)s+=f[i][j];\n  cout<<s<<endl;\n  int q; cin>>q;\n  while(q--){\n    int x,y; cin>>x>>y;\n    if(a[x][y]==-1){\n      s+=(f[x][y+1]-f[x+1][y])*r[x][y];\n      a[x][y]=-2; update1(x,y,f[x][y+1]);\n      update2(x+1,y,-r[x][y]); update2(x,y+1,r[x][y]);\n    }\n    else{\n      s+=(f[x+1][y]-f[x][y+1])*r[x][y];\n      a[x][y]=-1; update1(x,y,f[x+1][y]);\n      update2(x,y+1,-r[x][y]); update2(x+1,y,r[x][y]);\n    }\n    cout<<s<<endl;\n  }\n  return 0;\n}\n```",
        "postTime": 1675165069,
        "uid": 556366,
        "name": "zyc212303",
        "ccfLevel": 5,
        "title": "[USACO23JAN] Following Directions S \u9898\u89e3"
    },
    {
        "content": "## \u601d\u8def\n\u5bf9\u4e8e\u7b2c $1$ \u81f3 $7$ \u4e2a\u6d4b\u8bd5\u70b9\uff0c$N,Q \\le 250$\uff0c\u53ef\u4ee5\u6bcf\u6b21\u8be2\u95ee\u90fd $O(N^2)$ \u5730\u8ba1\u7b97\u7b54\u6848\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(N^2Q)$\u3002\n\n\u5bf9\u4e8e\u4e0a\u9762\u7684\u7b97\u6cd5\u53ef\u4ee5\u505a\u4e00\u4e9b\u4f18\u5316\uff0c\u5bb9\u6613\u53d1\u73b0\uff0c\u6539\u53d8\u5750\u6807\u4e3a $(x,y)$ \u7684\u8def\u6807\u6700\u591a\u53ea\u4f1a\u5bf9\u5750\u6807\u4e3a $(1\\sim x,1\\sim y)$ \u7684\u5976\u725b\u8fdb\u884c\u5f71\u54cd\uff0c\u6240\u4ee5\u5728\u5faa\u73af\u65f6\u53ea\u9700\u8981\u5faa\u73af\u4e00\u90e8\u5206\u5c31\u884c\u4e86\u3002\n\n\u5bf9\u4e8e\u7b2c $1$ \u81f3 $10$ \u4e2a\u6d4b\u8bd5\u70b9\uff0c$N,Q \\le 1500$\uff0c\u4f46\u6570\u636e\u4e3a\u968f\u673a\u751f\u6210\uff0c\u5728\u7406\u60f3\u72b6\u6001\u4e0b\uff0c\u6bcf\u4e2a\u70b9\u7684\u524d\u9a71\u53ea\u6709\u4e00\u4e2a\uff0c\u5219\u53ef\u4ee5\u5bf9\u8be2\u95ee\u70b9\u8fdb\u884c\u641c\u7d22\uff0c\u7406\u60f3\u72b6\u6001\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(NQ)$\u3002\n\n\u5bf9\u4e8e\u6240\u6709\u6d4b\u8bd5\u70b9\uff0c$N,Q \\le 1500$\uff0c\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\u8003\u8651 $O(N)$ \u9884\u5904\u7406\uff0c\u6700\u540e $O(1)$ \u56de\u7b54\uff0c\u53ef\u4ee5\u7528 $f_{i,j}$ \u8868\u793a\u7ecf\u8fc7\u5750\u6807\u4e3a $(i,j)$ \u7684\u70b9\u7684\u5976\u725b\u6709\u591a\u5c11\u5934\uff0c\u8be2\u95ee\u65f6\u5c06\u539f\u5148\u5976\u725b\u5f80\u4e0b\u8d70\u7684\u8def\u90fd\u51cf\u53bb\u7ecf\u8fc7\u8be2\u95ee\u5730\u70b9\u5976\u725b\u7684\u6570\u91cf\uff0c\u5c06\u53cd\u8f6c\u540e\u7684\u5976\u725b\u5f80\u4e0b\u8d70\u7684\u8def\u90fd\u52a0\u4e0a\u7ecf\u8fc7\u8be2\u95ee\u5730\u70b9\u5976\u725b\u7684\u6570\u91cf\uff0c\u5c31\u53ef\u4ee5\u7ef4\u62a4\u8fd9\u4e2a\u6570\u7ec4\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(NQ)$\u3002\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n\nusing namespace std;\n\nint n,Q,a[1505][1505],b[1505][1505],ans;\nchar c;\nbool v[1505][1505];\nint x,y;\nint main() {\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++) {\n\t\tfor(int j=1;j<=n;j++) {\n\t\t\tscanf(\" %c\",&c);\n\t\t\tv[i][j]=(c=='R');\n\t\t}\n\t\tscanf(\"%d\",&a[i][n+1]);\n\t}\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[n+1][i]);\n\tfor(int i=n;i;i--) for(int j=n;j;j--) {\n\t\tif(v[i][j]==1) ans+=a[i][j+1],a[i][j]=a[i][j+1];\n\t\telse ans+=a[i+1][j],a[i][j]=a[i+1][j];\n\t}\n\tfor(int i=1;i<=n;i++) for(int j=1;j<=n;j++) {\n\t\tb[i][j]++;\n\t\tif(v[i][j]==1) b[i][j+1]+=b[i][j];\n\t\telse b[i+1][j]+=b[i][j];\n\t}\n\tprintf(\"%d\\n\",ans);\n\tscanf(\"%d\",&Q);\n\twhile(Q--) {\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tint tx=x,ty=y;\n\t\twhile(1) {\n\t\t\tif(v[tx][ty]==1) b[tx][ty+1]-=b[x][y],ty++;\n\t\t\telse b[tx+1][ty]-=b[x][y],tx++;\n\t\t\tif(tx>n||ty>n) break;\n\t\t}\n\t\tans-=b[x][y]*a[tx][ty];\n\t\tv[x][y]=!v[x][y];\n\t\ttx=x,ty=y;\n\t\twhile(1) {\n\t\t\tif(v[tx][ty]==1) b[tx][ty+1]+=b[x][y],ty++;\n\t\t\telse b[tx+1][ty]+=b[x][y],tx++;\n\t\t\tif(tx>n||ty>n) break;\n\t\t}\n\t\tans+=b[x][y]*a[tx][ty];\n\t\tprintf(\"%d\\n\",ans);\n\t}\n    return 0;\n}\n```",
        "postTime": 1675677357,
        "uid": 670775,
        "name": "12345678hzx",
        "ccfLevel": 4,
        "title": "P9014\u9898\u89e3"
    },
    {
        "content": "## \u601d\u8def\n\n\u6211\u4eec\u8003\u8651\u7528 $cost_{i,j}$ \u8868\u793a\u4ece\u65b9\u683c $(i,j)$ \u6700\u540e\u4f1a\u5403\u591a\u5c11\u4ef7\u503c\u7684\u9972\u6599\uff0c\u7528 $cnt_{i,j}$ \u8868\u793a\u4ece\u65b9\u683c $(i,j)$ \u6709\u591a\u5c11\u4e2a\u5976\u725b\u4f1a\u7ecf\u8fc7\uff08\u5305\u542b\u672c\u6765\u5728\u65b9\u683c\u4e2d\u7684\uff09\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u6b64\u65f6\u5976\u725b\u8d70\u7684\u8def\u7ebf\u7c7b\u4f3c\u4e8e\u6839\u636e\u6bcf\u4e00\u5757\u9972\u6599\u5f62\u6210\u7684\u8bb8\u591a\u6811\uff0c\u800c\u6bcf\u4e00\u6b21\u6539\u53d8\u8def\u6807\u76f8\u5f53\u4e8e\u662f\u201c\u5ac1\u63a5\u201d\u4e86\u4e00\u6bb5\u6811\u679d\u3002\u6240\u4ee5\u5b9e\u9645\u4e0a\u6539\u53d8\u7684\u53ea\u662f\u8fd9\u4e00\u6761\u6811\u679d\u4e0a\u5976\u725b\u5403\u7684\u9972\u6599\u4ef7\u503c\u603b\u548c\uff0c\u8bbe\u6811\u679d\u6700\u63a5\u8fd1\u6811\u6839\u7684\u5750\u6807 $(x,y)$\uff0c\u5219\u6811\u679d\u4e0a\u5976\u725b\u5403\u7684\u9972\u6599\u4ef7\u503c\u603b\u548c\u5176\u53ef\u4ee5\u88ab\u8868\u793a\u4e3a $cost_{x,y}\\times cnt_{x,y}$\uff0c\u5bb9\u6613\u53d1\u73b0\u5728\u201c\u5ac1\u63a5\u201d\u8fc7\u7a0b\u4e2d $cnt_{x,y}$ \u4e0d\u53d8\uff0c\u53ea\u6709 $cost_{x,y}$ \u6362\u4e86\uff0c\u6240\u4ee5\u603b\u548c\u5b9e\u9645\u4e0a $+(cost_{x,y}{before}-cost_{x,y}{after})\\times cnt_{x,y}$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u601d\u8def\u6e05\u6670\uff1a\u5148\u627e\u5230\u6700\u5f00\u59cb\u7684\u4ef7\u503c\u548c\uff0c\u4ee5\u540e\u6bcf\u4e00\u6b21\u4fee\u6539\u90fd\u5bf9\u5e94\u7740\u4fee\u6539 $\\{cnt_{n,n}\\},\\{cost_{n,n}\\}$\uff0c\u5e76\u5bf9\u7b54\u6848\u8fdb\u884c\u4e0a\u8ff0\u4fee\u6539\u3002\n\n## \u5b9e\u73b0\n\n- \u6211\u4eec\u5728\u8003\u8651\u8ba1\u7b97\u5f00\u59cb\u4ef7\u503c\u603b\u548c\u7684\u65f6\u5019\uff0c\u91c7\u7528\u8bb0\u5fc6\u5316\uff0c\u5bf9\u4e8e\u641c\u7d22\u8fc7\u7684\u5c31\u76f4\u63a5\u8d4b\u503c\uff0c\u5e76\u4e14\u5728\u641c\u7d22\u8fc7\u7a0b\u4e2d\u4e00\u65e6\u9047\u5230\u88ab\u8d4b\u503c\u4e86\u7684\u76f4\u63a5\u8d4b\u76f8\u540c\u7684\u503c\u5e76\u7ed3\u675f\uff0c$\\mathcal{O}(n^2)$\u3002\n- \u6211\u4eec\u5728\u8003\u8651 $\\{cnt_{n,n}\\}$ \u65f6\uff0c\u663e\u7136\u8981\u5411\u6811\u6839\u65b9\u5411\u904d\u5386\u4fee\u6539\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n)$ \u8fc7\u5f97\u53bb\u3002\n- \u6211\u4eec\u5728\u8003\u8651 $\\{cost_{n,n}\\}$ \u65f6\uff0c\u5b9e\u9645\u4e0a\u4e0d\u9700\u8981\u4fee\u6539\uff0c\u56e0\u4e3a\u5982\u679c\u4fee\u6539\u662f\u5411\u6811\u68a2\u65b9\u5411\u904d\u5386\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u6700\u5927 $\\mathcal{O}(n^2)$ \u4f1a\u70b8\uff0c\u4f46\u662f\u6bcf\u4e00\u6b21\u67e5\u627e\u53ea\u9700\u8981\u5411\u6811\u6839\u65b9\u5411\u904d\u5386 $\\mathcal{O}(n)$  \u641e\u5b9a\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define ll long long\nusing namespace std;\nll n , ans , cmp , drc[2005][2005] , q , xx , yy , cost[2005][2005] , cnt[2005][2005] , mak[2005][2005];\nchar x1;\n\nll cntfnd( int x , int y )\n{\n\tif ( mak[x][y] )\treturn cnt[x][y];\n\tif ( x == 0 || y == 0 )\treturn 0;\n\tll s = 1;\n\tif ( drc[x - 1][y] == 1 )\ts += cntfnd( x - 1 , y );\n\tif ( drc[x][y - 1] == 0 )\ts += cntfnd( x , y - 1 );\n\tcnt[x][y] = s , mak[x][y] = 1;\n\treturn s;\n}\n\nvoid cntmark( int x , int y , ll z )\n{\n\tif ( x == n + 1 || y == n + 1 )\treturn;\n\tcnt[x][y] += z;\n\tcntmark( x + drc[x][y] , y + !drc[x][y] , z );\n\treturn;\n}\n\nll fnd( int x , int y )\n{\n\tif ( cost[x][y] )\treturn cost[x][y];\n\tif ( x == n + 1 || y == n + 1 )\treturn cost[x][y];\n\tcost[x][y] = fnd( x + drc[x][y] , y + !drc[x][y] );\n\treturn cost[x][y];\n}\n\nll costfnd( int x , int y )\n{\n\tif ( x == n + 1 || y == n + 1 )\treturn cost[x][y];\n\treturn costfnd( x + drc[x][y] , y + !drc[x][y] );\n}\n\nint main()\n{\n\tios::sync_with_stdio(false);\n\tcin.tie(NULL) , cout.tie(NULL);\n\tcin >> n;\n\tfor ( int i = 1; i <= n; i++ )\n\t{\n\t\tfor ( int j = 1; j <= n; j++ )\tcin >> x1 , drc[i][j] = ( x1 == 'D' );\n\t\tcin >> cost[i][n + 1];\n\t}\n\tfor ( int i = 1; i <= n; i++ )\tcin >> cost[n + 1][i];\n\tfor ( int i = 1; i <= n; i++ )\tfor ( int j = 1; j <= n; j++ )\tcost[i][j] = fnd( i , j ) , ans += cost[i][j];\n\tcin >> q;\n\tcout << ans << endl;\n\tfor ( int i = 1; i <= q; i++ )\n\t{\n\t\tcin >> xx >> yy;\n\t\tll befx = xx + drc[xx][yy] , befy = yy + !drc[xx][yy] , aftx = xx + !drc[xx][yy] , afty = yy + drc[xx][yy] , cntxxyy = cntfnd( xx , yy );\n\t\tdrc[xx][yy] = !drc[xx][yy];\n\t\tans += ( costfnd( aftx , afty ) - costfnd( befx , befy ) ) * cntxxyy;\n\t\tcntmark( befx , befy , -cntxxyy );\n\t\tcntmark( aftx , afty , cntxxyy );\n\t\tcout << ans << endl;\n\t}\n    return 0;\n}\n```",
        "postTime": 1675611504,
        "uid": 726395,
        "name": "ztntonny",
        "ccfLevel": 4,
        "title": "P9014\u9898\u89e3"
    },
    {
        "content": "\u66b4\u529b\u9898\u3002\n\n\u9996\u5148\u9884\u5904\u7406\u51fa $sz_{i,j}$ \u8868\u793a\u7ecf\u8fc7 $(i,j)$ \u70b9\u7684\u5976\u725b\u7684\u6570\u91cf\u3002\n\n\u7136\u540e\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e00\u7ec4\u4fee\u6539\uff0c\u5bf9\u4e8e\u8fd9\u4e2a\u70b9\u539f\u6765\u9700\u8981\u7ecf\u8fc7\u7684\u6240\u6709\u7684\u70b9\u7684 $sz$ \u7684\u503c\u5168\u90e8\u51cf\u53bb\u73b0\u5728\u7684\u8981\u4fee\u6539\u7684\u90a3\u4e00\u4e2a\u70b9\u7684 $sz$ \u7684\u503c\u3002\n\n\u7136\u540e\u4fee\u6539\u8fd9\u4e2a\u70b9\u7684\u65b9\u5411\u3002\n\n\u7136\u540e\u5bf9\u4e8e $(i,j)$ \u6bcf\u4e00\u4e2a\u9700\u8981\u7ecf\u8fc7\u7684\u70b9\uff0c\u8fd9\u4e00\u4e2a\u9700\u8981\u7ecf\u8fc7\u7684\u70b9\u7684 $sz$ \u503c\u5168\u90e8\u52a0\u4e0a\u73b0\u5728\u7684\u8981\u4fee\u6539\u7684\u90a3\u4e00\u4e2a\u70b9\u7684 $sz$ \u7684\u503c\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2+nq)$\u3002\n\n~~\u4ee3\u7801\u5495\u5495\u5495\u4e86~~\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=2e3+10;\nint a[N][N];\nchar ch[N][N];\nint sz[N][N];\nsigned main(){\n  int n,q;\n  cin>>n;\n  for(int i=1;i<=n;i++){\n    for(int j=1;j<=n;j++)\n      cin>>ch[i][j];\n    cin>>a[i][n+1];\n  };\n  for(int i=1;i<=n;i++)\n    cin>>a[n+1][i];\n  for(int i=1;i<=n;i++)\n    for(int j=1;j<=n;j++)\n    {\n      sz[i][j]++;\n      if(ch[i][j]=='R')sz[i][j+1]+=sz[i][j];\n      else sz[i+1][j]+=sz[i][j];\n    }\n  int sum=0;\n  for(int i=1;i<=n;i++)\n    sum+=sz[n+1][i]*a[n+1][i]+sz[i][n+1]*a[i][n+1];\n  cout<<sum<<'\\n';\n  cin>>q;\n  while(q--){\n    int x,y;\n    cin>>x>>y;\n    int p=sz[x][y];\n    int xx=x,yy=y;\n    while(true){\n      if(ch[xx][yy]=='R')yy++;\n      else xx++;\n      sz[xx][yy]-=sz[x][y];\n      if(xx>n||yy>n)break;\n    }\n    sum-=a[xx][yy]*p;\n    if(ch[x][y]=='R')ch[x][y]='D';\n    else ch[x][y]='R';\n    xx=x,yy=y;\n    while(true){\n      if(ch[xx][yy]=='R')yy++;\n      else xx++;\n      sz[xx][yy]+=sz[x][y];\n      if(xx>n||yy>n)break;\n    }\n    sum+=a[xx][yy]*p;\n    cout<<sum<<'\\n';\n  }\n  return 0;\n}\n```\n",
        "postTime": 1675579740,
        "uid": 378467,
        "name": "willem248",
        "ccfLevel": 5,
        "title": "P9014"
    }
]