[
    {
        "content": "[$\\text{Link}$](https://www.luogu.com.cn/problem/P8527)\n## \u9898\u610f\n\u7ed9\u51fa\u957f\u4e3a $n$ \u7684\u5e8f\u5217 $a,b$\uff0c$b$ \u5e8f\u5217\u521d\u59cb\u4e3a $0$\uff0c$m$ \u6b21\u64cd\u4f5c\uff0c\u6bcf\u6b21\u7ed9\u51fa $a$ \u4e2d\u7684\u4e00\u4e2a\u533a\u95f4 $[l,r]$ \u4e0e $L$\uff0c\u6267\u884c $\\forall i\\in[l,r],b_{i+L-l}\\gets b_{i+L-l}+a_i$\u3002\n\n\u6c42\u51fa\u6240\u6709\u64cd\u4f5c\u540e\u7684 $b$ \u5e8f\u5217\u3002\n\n$n\\le 10^5$\uff0c$m\\le10^6$\u3002\n## \u601d\u8def\n~~\u4e50\u5b50\u4e00\u8840\u3002~~\n\n\u5bf9\u5e8f\u5217 $a$ \u6309\u7167\u5757\u957f\u4e3a $B$ \u5206\u5757\uff0c\u5bf9\u4e8e\u4e00\u6b21\u64cd\u4f5c\uff0c\u82e5 $l,r$ \u540c\u5757\uff0c\u5219\u76f4\u63a5\u52a0\uff0c\u5426\u5219\u5148\u5bf9\u6563\u5757\u66b4\u529b\uff0c\u6574\u5757\u5b58\u4e0b\u6765\u6682\u4e0d\u5904\u7406\u3002\n\n\u6240\u6709\u8be2\u95ee\u7684\u6563\u5757\u5904\u7406\u5b8c\u4e4b\u540e\uff0c\u5904\u7406\u6574\u5757\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u5757 $[bL,bR]$\uff0c\u6211\u4eec\u8bb0\u5f55 $c_i$ \u8868\u793a\u8fd9\u4e2a\u5757\u52a0\u5230 $b$ \u5e8f\u5217\u4e2d\u4ee5 $i$ \u5f00\u59cb\u7684\u7b49\u957f\u533a\u95f4\u7684\u6b21\u6570\uff0c$d_i=a_{bL+i}(i\\le bR-bL)$\u3002\u4ee4\u8fd9\u4e2a\u5757\u5bf9 $b_i$ \u7684\u8d21\u732e\u4e3a $res_i$\uff0c\u5219\u6709 $\\displaystyle res_i=\\sum_{j=1}^i c_jd_{i-j}$\uff0c\u53ef\u4ee5\u5377\u79ef\u3002\n\n\u590d\u6742\u5ea6\u4e3a $O(mB+\\dfrac{(n\\log n+m)n}B)$\uff0c\u53d6 $B=O(\\sqrt\\dfrac{n^2\\log n+nm}m)$ \u5f97\u5230\u6700\u4f18\u590d\u6742\u5ea6 $O(n\\sqrt{m\\log n}+m\\sqrt n)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nnamespace IO{//by cyffff\n\t\n}\nconst int N=131072,mod=998244353;\nnamespace Init{\n\tint fac[N],ifac[N],inv[N],G[17][N];\n\tinline int qpow(int x,int y){\n\t\tint res=1;\n\t\twhile(y){\n\t\t\tif(y&1) res=1ll*res*x%mod;\n\t\t\tx=1ll*x*x%mod;\n\t\t\ty>>=1;\n\t\t}\n\t\treturn res;\n\t}\n\tinline void getG(){\n\t\tfor(int i=0;i<17;i++){\n\t\t\tint *P=G[i],W=1<<i;\n\t\t\tP[0]=1;\n\t\t\tP[1]=qpow(3,(mod-1)/(1<<i+1));\n\t\t\tconst int tmp=P[1];\n\t\t\tfor(int j=2;j<W;j++)\n\t\t\t\tP[j]=1ll*P[j-1]*tmp%mod;\n\t\t}\n\t}\n\tinline void Prefix(int L){\n\t\tfac[0]=1;\n\t\tfor(int i=1;i<=L;i++)\n\t\t\tfac[i]=1ll*fac[i-1]*i%mod;\n\t\tifac[L]=qpow(fac[L],mod-2);\n\t\tfor(int i=L;i>=1;i--)\n\t\t\tifac[i-1]=1ll*ifac[i]*i%mod;\n\t\tfor(int i=1;i<=L;i++)\n\t\t\tinv[i]=1ll*fac[i]*ifac[i-1]%mod;\n\t}\n}\nusing namespace Init;\nnamespace Poly{\n    int lim,rev[N];\n    int F[N],G[N],H[N];\n    inline void init(int n,int mode=1){\n        if(mode){\n            int l=0;\n            for(lim=1;lim<=n;lim<<=1)l++;\n            for(int i=1;i<lim;i++)\n                rev[i]=(rev[i>>1]>>1)|((i&1)<<(l-1));\n        }else{\n            for(lim=1;lim<=n;lim<<=1);\n        }\n    }\n    inline void NTT(int *a,int T){\n        for(int i=0;i<lim;i++)\n            if(i<rev[i])\n                swap(a[i],a[rev[i]]);\n        for(int i=1,o=0;i<lim;i<<=1,o++){\n            const int *P=::G[o];\n            for(int j=0;j<lim;j+=(i<<1)){\n                int t1,t2;\n                for(int k=0;k<i;k++){\n                    t1=a[j+k];\n                    t2=1ll*P[k]*a[i+j+k]%mod;\n                    a[j+k]=(t1+t2)%mod;\n                    a[i+j+k]=(t1-t2+mod)%mod;\n                }\n            }\n        }\n        if(T==1) return ;\n        int Inv=qpow(lim,mod-2);\n        reverse(a+1,a+lim);\n        for(int i=0;i<lim;i++)\n            a[i]=1ll*a[i]*Inv%mod;\n    }\n    inline void Mul(int *a,int *b){\n        for(int i=0;i<lim;i++)\n            F[i]=b[i];\n        NTT(a,1),NTT(F,1);\n        for(int i=0;i<lim;i++)\n            a[i]=1ll*a[i]*F[i]%mod;\n        NTT(a,-1);\n    }\n}\nconst int T=1e5+10,Q=1e6+10,sq=sqrt(1.0*T*T*log2(T)/Q+Q)*2;\nint n,q,blk,a[T],b[T],c[N],d[N],bel[T],bl[T],br[T];\nstruct Query{\n\tint l,bL,bR,L;\n}que[Q];\ninline void solve(int bL,int bR){\n\tint D=bel[bL],len=bR-bL+1;\n\tfor(int i=0;i<=Poly::lim;i++)\n\t\tc[i]=d[i]=0;\n\tfor(int i=1;i<=q;i++)\n\t\tif(que[i].bL<=D&&D<=que[i].bR)\n\t\t\tc[que[i].L+bL-que[i].l]++;\n\tfor(int i=1;i<=len;i++)\n\t\td[i-1]=a[bL+i-1];\n\tPoly::Mul(c,d);\n\tfor(int i=1;i<=n;i++)\n\t\tb[i]+=c[i];\n}\nint main(){\n\tn=read();\n\tgetG(),Poly::init(n+2000);\n\tfor(int i=1;i<=n;i++)\n\t\ta[i]=read();\n\tfor(int i=1;i<=n;i+=sq){\n\t\tblk++;\n\t\tbl[blk]=i,br[blk]=min(i+sq-1,n);\n\t\tfor(int j=bl[blk];j<=br[blk];j++)\n\t\t\tbel[j]=blk;\n\t}\n\tq=read();\n\tfor(int i=1;i<=q;i++){\n\t\tint l=read(),r=read(),L=read();\n\t\tint bL=bel[l],bR=bel[r];\n\t\tif(bL==bR){\n\t\t\tfor(int j=l;j<=r;j++)\n\t\t\t\tb[L+j-l]+=a[j];\n\t\t}else{\n\t\t\tfor(int j=l;j<=br[bL];j++)\n\t\t\t\tb[L+j-l]+=a[j];\n\t\t\tfor(int j=bl[bR];j<=r;j++)\n\t\t\t\tb[L+j-l]+=a[j];\n\t\t\tque[i]={l,bL+1,bR-1,L};\n\t\t}\n\t}\n\tfor(int i=1;i<=blk;i++)\n\t\tsolve(bl[i],br[i]);\n\tfor(int i=1;i<=n;i++)\n\t\twrite(b[i]),putc('\\n');\n\tflush();\n}\n```\n\u518d\u89c1 qwq~",
        "postTime": 1662592591,
        "uid": 365127,
        "name": "cyffff",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P8527\u3010[Ynoi2003] \u6a0b\u53e3\u5186\u9999\u3011"
    },
    {
        "content": "\u7531\u4e8e $\\text{FFT}$ \u592a\u53ef\u7231\u4e86\uff0c\u4ea4\u4e00\u53d1\u76f4\u63a5\u6700\u4f18\u89e3 $\\text{(2022.9.30)}$\uff0c\u6bd4\u76ee\u524d\u6240\u6709 $\\text{NTT}$ \u90fd\u8981\u5feb\u3002\n\n\u5bf9\u4e8e\u6240\u6709\u6a21\u6570\u4e3a $998244353$ \u7684 $\\text{NTT}$ \u90fd\u53ef\u4ee5\u88ab\u5982\u4e0b\u6570\u636e\u5361\u6389\uff08\u4ec5\u9650\u6a21\u6570\u4e3a $998244353$\uff09\uff1a\n```\n100000\n1000 1000/*100000\u4e2a\u201c1000\u201d*/\n1000000\n1 100000 0\n1 100000 0\n/*100000\u884c\u201c1 100000 0\u201d*/\n```\n\u8fd9\u6837\u5355\u6b21 $\\text{NTT}$ \u7684\u7ed3\u679c\u4f1a\u8fbe\u5230 $10^9$\uff0c\u5f53\u7136\u4e00\u822c\u4e0d\u4f1a\u6709\u4eba\u53bb\u5361\uff0c\u8fd9\u6837\u6ca1\u610f\u4e49\u3002\n\n\u8fd9\u9898\u4e00\u770b\u5c31\u662f\u4e00\u4e2a\u52a0\u6cd5\u5377\u79ef\u5f62\u5f0f\uff0c\u65e0\u5948\u4e0d\u53ef\u80fd\u6bcf\u4e00\u6b21\u64cd\u4f5c\u90fd\u5377\u4e00\u4e0b\uff0c\u8fd9\u6837\u662f $O(nm\\log_2n)$ \u7684\u3002\n\n\u5e76\u6ca1\u6709\u4e00\u79cd\u65b9\u6cd5\u53ef\u4ee5\u5c06\u591a\u4e2a\u533a\u95f4\u5377\u5355\u70b9\u4e00\u8d77\u505a\uff0c\u4f46\u5982\u679c\u533a\u95f4\u4e00\u6837\u5c31\u4e0d\u540c\u4e86\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u5b8c\u5168\u76f8\u540c\u7684\u533a\u95f4\uff0c\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u5c06\u64cd\u4f5c\u52a0\u5230\u4e00\u4e2a\u591a\u9879\u5f0f\uff0c\u5728\u548c\u8be5\u533a\u95f4\u505a\u5377\u79ef\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u5206\u5757\uff0c\u5bf9\u4e8e\u5355\u5757\u7684\u64cd\u4f5c\u4e00\u8d77\u7b97\uff0c\u8bbe\u6709 $K$ \u4e2a\u5757\uff0c\u5219\u590d\u6742\u5ea6\u4e3a $O(K(n\\log_2n+m)+\\frac{nm}{K}$\uff0c\u4ee4\u4e24\u5f0f\u76f8\u7b49\uff0c\u89e3\u5f97 $K=\\sqrt{\\frac{nm}{n\\log_2n+m}}$\uff0c\u6b64\u65f6\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\sqrt{nm(n\\log_2n+m)}$\uff0c\u53d6 $m=n\\log_2n$\uff0c\u5219\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $n\\sqrt n\\log_2n$\uff0c\u5728 $n=10^5$ \u65f6\u6709\u70b9\u7d27\u3002\n\n\u5177\u4f53\u7684\uff0c\u5904\u7406\u533a\u95f4 $[bl,br]$ \u65f6\uff0c\u53ef\u4ee5\u5c06 $b_{L+k-l}+=a_k$ \u8f6c\u5316\u4e3a $b_{L+k-l}=a_kf_{L-l}$\uff0c\u800c $f$ \u53ef\u4ee5\u626b\u63cf\u6240\u6709\u6574\u5757\u8be2\u95ee\u7d2f\u52a0\uff0c\u8003\u8651\u5230\u53ef\u80fd\u7684 $L<l$ \u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u5c06 $k$ \u53f3\u79fb $bl$\uff0c$L-l$ \u5de6\u79fb $bl$\uff0c\u4fdd\u8bc1\u4e0b\u6807\u5747\u5728 $[1,n]$ \u4e4b\u95f4\u3002\n\n\u5341\u5206\u5f00\u5fc3\u5730\u505a\u5b8c\u4e86\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e5+5,M=1e6+6;\nconst double pai=3.1415926535897932;\nint a[N],b[N],n,q,m;\nint l_[M],L[M],R[M],tr[M];\nnamespace fast_io{\n    char bf[N+5],ob[N+38];\n    int it,ed,f,c,ot,t,stk[38],x;\n#define gc (it==ed&&(ed=(it=0)+fread(bf,1,N,stdin),it==ed)?EOF:bf[it++])\n    inline int read(){\n        for(c=gc;c<48;c=gc);\n        for(x=0;c>47;x=x*10+(48^c),c=gc);\n        return x;\n    }inline void fls(){\n        fwrite(ob,1,ot,stdout),ot=0;\n    }inline void write(int x){\n        for(t=0;x>9;stk[++t]=48^(x%10),x/=10);\n        for(ob[ot++]=48^x;t;ob[ot++]=stk[t--]);\n        ob[ot++]='\\n';if(ot>N)fls();\n    }\n}using fast_io::read;\nusing fast_io::write;\nstruct cp{\n\tdouble x,y;\n\tinline void operator*=(cp &z){\n\t\t*this={x*z.x-y*z.y,x*z.y+y*z.x};\n\t}inline cp operator*(cp &z){\n\t\treturn {x*z.x-y*z.y,x*z.y+y*z.x};\n\t}inline void operator/=(int &p){\n\t\tx/=p,y/=p;\n\t}inline cp operator+(cp &z){\n\t\treturn {x+z.x,y+z.y};\n\t}inline cp operator-(cp &z){\n\t\treturn {x-z.x,y-z.y};\n\t}inline cp operator+=(int p){\n\t\tx+=p;\n\t}\n}f[M],nw,rt,fl,fr;\ninline void fft(bool tp){\n\tif(tp)reverse(f+1,f+m);\n\tint ln,md,r,i;\n\tfor(i=0;i<m;++i)\n\t\tif(i<tr[i])swap(f[i],f[tr[i]]);\n\tfor(md=1;md<m;md<<=1){\n\t\tr=md<<1,rt={cos(pai/md),sin(pai/md)};\n\t\tfor(ln=0;ln<m;ln+=r)\n\t\t\tfor(i=0,nw={1};i<md;++i,nw*=rt){\n\t\t\t\tfl=f[ln|i],fr=nw*f[ln|md|i];\n\t\t\t\tf[ln|i]=fl+fr,f[ln|md|i]=fl-fr;\n\t\t\t}\n\t}if(tp)for(i=0;i<m;++i)f[i]/=m;\n}\nint main(){\n\tint i,l,r,_l,_r,k;n=read();\n\tfor(l=1;l<=n;++l)a[l]=read();q=read();\n\tfor(i=1;i<=q;++i)L[i]=read(),R[i]=read(),l_[i]=read();\n\tfor(m=2,k=0;m<=n;m<<=1,++k);\n\tfor(i=1;i<m;++i)tr[i]=(tr[i>>1]>>1)|((i&1)<<k);\n\tfor(l=1;l<=n;l=r+1){\n\t\tr=min(l+2048,n);\n\t\tfor(i=0;i<m;++i)f[i]={0,0};\n\t\tfor(i=1;i<=q;++i)\n\t\t\tif(L[i]<=l&&R[i]>=r)f[l_[i]+l-L[i]].y+=1;\n\t\t\telse if(L[i]<=r&&R[i]>=l){\n\t\t\t\t_l=max(l,L[i]),_r=min(r,R[i]);\n\t\t\t\tfor(k=_l;k<=_r;++k)b[l_[i]+k-L[i]]+=a[k];\n\t\t\t}\n\t\tfor(i=l;i<=r;++i)f[i-l].x+=a[i];\n\t\tfor(i=0,fft(0);i<m;++i)f[i]*=f[i];\n\t\tfor(i=1,fft(1);i<=n;++i)b[i]+=(f[i].y+1)/2;\n\t}for(i=1;i<=n;++i)write(b[i]);\n\tfast_io::fls();return 0;\n}\n    ```",
        "postTime": 1664522182,
        "uid": 502410,
        "name": "EnofTaiPeople",
        "ccfLevel": 0,
        "title": "\u53ef\u7231\u7684\u5206\u5757\u9047\u89c1\u53ef\u7231\u7684 FFT"
    }
]