[
    {
        "content": "# \u9898\u89e3\n\n\u5f53\u6211\u4eec\u6c42$sum_{k,1,r}$\u65f6\uff0c\u6211\u4eec\u8003\u8651\u6bcf\u4e00\u4e2a$a[i](i\\in[1,r])$\u7684\u8d21\u732e\n\n\u901a\u8fc7\u6211\u4eec\u5bf9\u9898\u76ee\u516c\u5f0f\u63cf\u8ff0\u7684\u7406\u89e3\uff0c\u53ef\u4ee5\u60f3\u8c61\u4e3a\u6c42$k+1$\u4e2a\u4e8c\u5143\u7ec4$(l,r)$\uff0c\u4f7f$l_i<=l_{i+1},r_i>=r_{i+1},i\\in[1,k]$\u8fd9\u662f\u4e00\u4e2a\u5f88\u663e\u7136\u7684\u7ec4\u5408\u6570\u95ee\u9898\u3002\n\n\u6240\u4ee5$sum_{k,1,r}=\\sum_{i=1}^{r}a[i] * C(i+k-2,k-1) * C(r-i+k-1,k-1)$\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u6709\u4e86\u4e00\u4e2a$O(n^2)$\u7684\u7b97\u6cd5\n\n## Code:\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define mod 998244353\n#define maxn 1005\nusing namespace std;\nll power(ll n,ll x){\n    ll sp=1LL;\n    while(x){\n        if(x&1LL) sp=(sp*n)%mod;\n        n=(n*n)%mod;\n        x>>=1LL;\n    }return sp;\n}\nll fact[maxn<<1],inv[maxn<<1];\nvoid init(){\n    fact[0]=1LL;\n    for(int i=1;i<=2000;i++)\n    fact[i]=fact[i-1]*i%mod;\n    inv[2000]=power(fact[2000],mod-2);\n    for(int i=1999;i>=0;i--)\n    inv[i]=inv[i+1]*(i+1)%mod;  \n}\nll C(ll n,ll m){\n    return fact[n]*inv[n-m]%mod*inv[m]%mod;\n}\nint n;\nll k,a[maxn];\nint main(){\n\tscanf(\"%d%lld\",&n,&k);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&a[i]);\n\tinit();\n\tfor(int i=1;i<=n;i++){\n\t\tll res=0;\n\t\tfor(int j=1;j<=i;j++)\n\t\tres=(res+C(j+k-2,k-1)*C(i-j+k-1,k-1)%mod*a[j]%mod)%mod;\n\t\tprintf(\"%lld \",res);\n\t}return 0;\n}\n```\n\u8003\u8651\u7ee7\u7eed\u4f18\u5316\u8fd9\u4e2a\u5f0f\u5b50\n\n\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5728\u4e00\u4e2a$sum_{k,1,r}$\u4e2d\uff0c$(i+k-2)+(r-i+k-1)=r+2\\times k - 3$\n\n\u800c\u8fd9\u4e2a\u662f\u4e00\u4e2a\u5e38\u91cf\uff0c\u5c31\u53ef\u4ee5\u628a\u5b83\u53d8\u6210\u4e00\u4e2a\u5377\u79ef\u7684\u5f0f\u5b50\n\n\u8bbe$A_i=C(i+k-1,k-1)\\times a_{i+1},B_i=C(i+k-1,k-1)(i\\in[0,n))$\n\n$sum_{k,1,r}=\\sum_{i=0}^{r-1}A_i * B_{r-i-1} (\\mod 998244353)$\n\n\u56e0\u4e3a\u8981\u6a21$998244353$\uff0c\u6240\u4ee5\u53ef\u4ee5NTT\u89e3\u51b3\uff0c~~\u6362\u4e2a\u6a21\u6570\u5c31\u662fMTT\u4e86~~\n\n## Code:\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define mod 998244353\n#define maxn 100005\nusing namespace std;\nll power(ll n,ll x){\n    ll sp=1LL;\n    while(x){\n        if(x&1LL) sp=(sp*n)%mod;\n        n=(n*n)%mod;\n        x>>=1LL;\n    }return sp;\n}\nconst ll g=3,gi=332748118;\nint r[maxn*3],limit,L;\ninline void NTT(ll *a,int type){\n\tfor(int i=0;i<limit;i++) if(i<r[i]) swap(a[i],a[r[i]]);\n\tfor(int mid=1;mid<limit;mid<<=1){\n\t\tll Wn=power(type==1?g:gi,(mod-1)/(mid<<1));\n\t\tfor(int j=0;j<limit;j+=(mid<<1)){\n\t\t\tll w=1;\n\t\t\tfor(int k=0;k<mid;k++,w=w*Wn%mod){\n\t\t\t\tll x=a[j+k],y=w*a[j+k+mid]%mod;\n\t\t\t\ta[j+k]=(x+y)%mod;\n\t\t\t\ta[j+k+mid]=(x-y+mod)%mod;\n\t\t\t}\n\t\t}\n\t}\n}\nint n;\nll k,a[maxn*3],b[maxn*3];\nll in[maxn];\nint main(){\n\tscanf(\"%d%lld\",&n,&k);\n\tin[0]=in[1]=1;\n\tfor(int i=2;i<n;i++) in[i]=(mod-mod/i)*in[mod%i]%mod;//\u7ebf\u6027\u6c42\u9006\u5143\n\tb[0]=1;\n\tfor(int i=1;i<n;i++) b[i]=b[i-1]*(i+k-1)%mod*in[i]%mod;//\u56e0\u4e3ak\u592a\u5927\u4e86\uff0c\u65e0\u6cd5\u9884\u5904\u7406\u9636\u4e58\uff0c\u9700\u8981\u9012\u63a8\n\tfor(int i=0;i<n;i++)\n\tscanf(\"%lld\",&a[i]),a[i]=(a[i]*b[i])%mod;//\u5904\u7406Ai\uff0cBi\n   //\u5f00\u59cbNTT\n\tlimit=1;\n\twhile(limit<=n*2) limit<<=1,L++;\n\tfor(int i=0;i<limit;i++) r[i]=(r[i>>1]>>1)|((i&1)<<(L-1));\n\tNTT(a,1);NTT(b,1);\n\tfor(int i=0;i<limit;i++) a[i]=(a[i]*b[i])%mod;\n\tNTT(a,-1);\n\tll inv=power(limit,mod-2);\n\tfor(int i=0;i<n;i++) printf(\"%lld \",a[i]*inv%mod);\n\treturn 0;\n}\n```",
        "postTime": 1573350291,
        "uid": 87691,
        "name": "Cheng_yf",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5641 \u3010\u3010CSGRound2\u3011\u5f00\u62d3\u8005\u7684\u5353\u8bc6\u3011"
    },
    {
        "content": "### \u524d\u8a00\n\nCSG R2 T4 \u5b98\u65b9\u9898\u89e3\n\n\u5728\u8fd9\u91cc\u7ed9\u5927\u5bb6\u8c22\u7f6a\u4e86qwq\n\n\u8bdd\u8bf4\u8bb2\u9898\u7684\u65f6\u5019\u7b80\u76f4\u662f\u5728~~\u81ea\u7838\u62db\u724c~~\u554aqwq\uff0c\u5e0c\u671b\u5927\u5bb6\u4e0d\u8981 d \u6211\u3002\n\nQ1\uff1a\u8bdd\u8bf4\u60a8\u548b\u8bb2\u7684\u4e00\u53e3~~\u6807\u51c6~~ HN \u53e3\u97f3 + \u6291\u626c\u987f\u632b\u7684\u7d20\u666e\u554a\n\nA1\uff1a\u6211\u662f HN \u7684\uff0c zhouwc \u662f ZJ \u7684\uff0c\u6cbf\u6d77\u5730\u533a\u7684\u53e3\u97f3\u666e\u904d\u597d\u4e00\u4e9b\u554a\uff0c\u8fd9\u662f\u4e8b\u5b9e\u554aqwq\n\nQ2\uff1a\u5916\u9762\u7684\u5587\u53ed\u58f0\u662f\u600e\u4e48\u56de\u4e8b\u554a\n\nA2\uff1a\u6211\u4f4f\u67d0\u4e00\u6761\u8def\u65c1\u8fb9\uff0c\u51b5\u4e14\u521a\u642c\u8fdb\u6765\uff0c\u566a\u58f0\u4e0d\u53ef\u907f\u514d\u3002\n\nQ3\uff1a\u7535\u97f3\u662f\u4ec0\u4e48\u56de\u4e8b\u554a\n\nA3\uff1a\u8fd9\u4e2a\u662f\u6211\u673a\u5b50\u7684\u95ee\u9898\uff0c\u8981 d \u53bb d \u6211\u7684\u673a\u5b50\uff0c\u4e0d\u8981 d \u6211\u554a\u3002\uff08\u8981\u662f\u6211\u62ff\u5230 `\"zhouwc\".toUpperCase().slice(4,6)` \u8fd9\u573a\u6bd4\u8d5b\u7684 Au \u53ef\u80fd\u4f1a\u6362\u4e00\u53f0\u673a\u5b50\u518d\u4e70\u4e2a\u9ea6\uff1f\uff09\n\nQ4\uff1a\u4f60\u600e\u4e48\u8fd9\u4e48\u65e9\u5c31\u505c\u6b62\u63a8\u6d41\u554aqwq\n\nA4\uff1a\u65f6\u95f4\u539f\u56e0\u3002\n\n### \u9898\u610f\n\n\u9898\u9762\u5199\u7684\u592a\u8fc7\u76f4\u767d\uff0c\u4e0d\u89e3\u91ca\u3002\n\n$\\texttt{Data Range:}$\n\n\n![KXHzKP.jpg](https://s2.ax1x.com/2019/11/03/KXHzKP.jpg)\n\n### \u9898\u89e3\n\n\u8bdd\u8bf4\u6211\u80fd\u8dd1\u8fc7 100ms\uff1f\n\n$\\texttt{12 pts}$\n\n\u7206\u641c+\u524d\u7f00\u548c\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n^k)$\n\n$\\texttt{36 pts}$\n\n\u6709\u4e00\u4e2a\u5f88\u5957\u8def\u7684\u591a\u70b9\u6c42\u503c\u505a\u6cd5\u548c\u4e00\u4e2a\u5f88\u5947\u5999\u7684\u7ec4\u5408\u505a\u6cd5\u3002\n\n\u591a\u70b9\u6c42\u503c\u592a\u8d85\u7eb2\uff0c\u7ec4\u5408\u505a\u6cd5\u6211\u4e0d\u4f1a\u3002\n\n\u591a\u70b9\u6c42\u503c\u7684\u505a\u6cd5\u5c31\u662f\u628a\u5bf9\u4e8e\u6bcf\u4e00\u4e2a$r$\uff0c\u628a\u8ba1\u7b97$sum_{k,1,r}$\u4e2d\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u7684\u6570\u4e00\u5171\u8ba1\u7b97\u4e86\u51e0\u6b21\u7528\u591a\u9879\u5f0f\u4f60\u548c\u51fa\u6765\u3002\n\n\u5f53\u7136\u8fd9\u4e2a\u4e1c\u897f\u4f60\u4e5f\u53ef\u4ee5\u7ec4\u5408\u7b97\uff0c\u4f46\u662f\u51fa\u9898\u4eba\u8fc7\u4e8e\u667a\u969c\uff0c\u4e0d\u4f1a\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n^2\\log^2n)$\uff08\u591a\u70b9\u6c42\u503c\uff09\u6216\u8005$O(n^2)$\uff08\u7ec4\u5408\uff09\n\n$\\texttt{68 pts}$\n\n\u6ce8\u610f\u5230\u6211\u4eec\u7684\u7b54\u6848\u53ef\u4ee5\u5199\u6210\u5982\u4e0b\u5f62\u5f0f\uff1a\n\n$$sum_{k,1,r}=C_{k-2+n-r}^{k-2}\\sum\\limits_{l=1}^{r}(pre_r-pre_{l-1})C_{k-3+l}^{k-2}$$\n\n\u8bc1\u660e\u53ef\u4ee5\u91c7\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\u3002\u628a\u67ff\u5b50\u62c6\u4e00\u4e0b\uff08\u5176\u4e2d$pre$\u662f\u524d\u7f00\u548c\uff09\n\n$$sum_{k,1,r}=C_{k-2+n-r}^{k-2}(pre_r\\sum\\limits_{l=1}^{r}C_{k-3+l}^{k-2}-\\sum\\limits_{l=1}^{r}pre_{l-1}C_{k-3+l}^{k-2})$$\n\n\u53ef\u4ee5\u7528\u524d\u7f00\u548c\u9884\u5904\u7406$\\sum\\limits_{l=1}^{r}C_{k-3+l}^{k-2}$\u548c$\\sum\\limits_{l=1}^{r}pre_{l-1}C_{k-3+l}^{k-2}$\u3002\u4f46\u662f\u5916\u9762\u7684\u7ec4\u5408\u6570\uff1f\n\n\u8fd9\u4e2a\u53ef\u4ee5\u628a\u91cc\u9762\u7684\u4e1c\u897f\u5904\u7406\u51fa\u6765\u5728\u505a$k$\u904d\u524d\u7f00\u548c\uff0c\u8bc1\u660e\u53ef\u4ee5\u5229\u7528 P5488 \u7684\u505a\u6cd5\u3002\n\n\u5982\u679c\u4f60\u7684\u524d\u7f00\u548c\u662f\u66b4\u529b\u7684\u8bdd\u53ef\u4ee5\u62ff\u5230\u8fd9\u6863\u5206\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(nk)$\u3002\n\n$\\texttt{72 pts}$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u524d\u7f00\u548c\u53ef\u4ee5$\\texttt{NTT}$\u4f18\u5316\uff0c\u4f46\u662f\u4e0d\u80fd\u9884\u5904\u7406\u9636\u4e58\uff0c\u4f1a\u5bfc\u81f4$\\color{#8e44ad}\\texttt{RE}$\u3002\n\n$\\texttt{100 pts}$\n\n\u6211\u4eec\u53ef\u4ee5\u4e0d\u9700\u8981\u9884\u5904\u7406\u7ec4\u5408\u6570\uff0c\u76f4\u63a5\u5728\u8bfb\u5165\u7684\u65f6\u5019\u4e00\u5e76\u7b97\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(n\\log n)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef int ll;\ntypedef long long int li;\nconst ll MAXN=3e5+51,MOD=998244353,G=3,INVG=332748118;\nll fd,cnt,kk,limit,p;\nll num[MAXN],prefix[MAXN],csum[MAXN],cx[MAXN],g[MAXN];\nll rev[MAXN],res[MAXN],f[MAXN];\ninline ll read()\n{\n    register ll num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n}\ninline ll qpow(ll base,ll exponent)\n{\n\tll res=1;\n\twhile(exponent)\n\t{\n\t\tif(exponent&1)\n\t\t{\n\t\t\tres=(li)res*base%MOD;\n\t\t}\n\t\tbase=(li)base*base%MOD,exponent>>=1;\n\t}\n\treturn res;\n}\ninline void NTT(ll *cp,ll cnt,ll inv)\n{\n    ll cur=0,res=0,omg=0;\n    for(register int i=0;i<cnt;i++)\n    {\n        if(i<rev[i])\n        {\n            swap(cp[i],cp[rev[i]]);\n        }\n    }\n    for(register int i=2;i<=cnt;i<<=1)\n    {\n        cur=i>>1,res=qpow(inv==1?G:INVG,(MOD-1)/i);\n        for(register ll *p=cp;p!=cp+cnt;p+=i)\n        {\n            omg=1;\n            for(register int j=0;j<cur;j++)\n            {\n                ll t=(li)omg*p[j+cur]%MOD,t2=p[j];\n                p[j+cur]=(t2-t+MOD)%MOD,p[j]=(t2+t)%MOD;\n                omg=(li)omg*res%MOD;\n            }\n        }\n    }\n    if(inv==-1)\n    {\n        ll invl=qpow(cnt,MOD-2);\n        for(register int i=0;i<=cnt;i++)\n        {\n            cp[i]=(li)cp[i]*invl%MOD;\n        }\n    }\n}\nint main()\n{\n\tfd=read(),kk=read();\n\tfor(register int i=1;i<=fd;i++)\n\t{\n\t\tp=(i==1?1:(li)p*(kk-3+i)%MOD*qpow((i-1),MOD-2)%MOD);\n\t\tprefix[i]=(prefix[i-1]+(num[i]=read()))%MOD;\n\t\tcsum[i]=(csum[i-1]+p)%MOD;\n\t\tcx[i]=(cx[i-1]+(li)prefix[i-1]*p%MOD)%MOD;\n\t}\n\tif(kk==1)\n\t{\n\t\tfor(register int i=1;i<=fd;i++)\n\t\t{\n\t\t\tprintf(\"%d \",prefix[i]);\n\t\t}\n\t\tputs(\"\");\n\t\treturn 0;\n\t}\n\tfor(register int i=1;i<=fd;i++)\n\t{\n\t\tf[i-1]=res[i]=(res[i-1]+((li)prefix[i]*csum[i]%MOD-cx[i]+MOD)%MOD)%MOD;\n\t}\n\tg[0]=1,kk-=2;\n\tfor(register int i=1;i<fd;i++)\n\t{\n\t\tg[i]=(li)g[i-1]*(i+kk-1)%MOD*qpow(i,MOD-2)%MOD;\n\t}\n\tcnt=1,limit=-1;\n\twhile(cnt<(fd<<1))\n\t{\n\t\tcnt<<=1,limit++;\n\t}\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\trev[i]=(rev[i>>1]>>1)|((i&1)<<limit);\n\t}\n\tNTT(f,cnt,1),NTT(g,cnt,1);\n\tfor(register int i=0;i<cnt;i++)\n\t{\n\t\tf[i]=(li)f[i]*g[i]%MOD;\n\t}\n\tNTT(f,cnt,-1);\n\tfor(register int i=0;i<fd;i++)\n\t{\n\t\tprintf(\"%d \",f[i]);\n\t}\n\tputs(\"\");\n}\n```\n\n### \u540e\u8bb0\n\n\u8bdd\u8bf4\u8bf7\u5927\u5bb6\u795d\u6211 CSP-S 2019 rp++ \u5e76\u4e14\u80fd\u53bb`\"zhouwc\".toUpperCase().slice(4,6)`\uff0c\u81f3\u4e8e\u80fd\u4e0d\u80fd\u62ff\u5230 Au \u8fd8\u662f bless me \u5427\u3002\n\n~~\u5982\u679c\u80fd\u62ff\u5230 Au \u6211\u5c31\u53ef\u4ee5\u6362\u7535\u8111+\u4e70\u9ea6+\u6d88\u9664\u8def\u8fb9\u8f66\u8f86\u7684\u6742\u97f3\u4e86~~",
        "postTime": 1573393986,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P5641 \u3010\u3010CSGRound2\u3011\u5f00\u62d3\u8005\u7684\u5353\u8bc6\u3011"
    },
    {
        "content": "# \u9898\u610f\uff1a\n\n\u7ed9\u5b9a\u4e00\u4e2a\u5e8f\u5217$a_n$,\u5b9a\u4e49$sum_{k,l,r}$\u4e3a:\n\n$k=1$\u65f6\uff0c$sum_{k,l,r}=\\sum\\limits_{i=l}^ra_i$\n\n$k\\geq2$\u65f6\uff0c$sum_{k,l,r}=\\sum\\limits_{l\\leq i\\leq j\\leq r}sum_{k-1,i,j}$\n\n\u7ed9\u5b9a$k$,\u6c42$sum_{k,1,i}$\uff0c\u8fd9\u91cc\u8bbe$sum_{k,1,i}=ans_i$\n\n# Solution:\n\n\u5728\u6211\u770b\u6765\u8fd9\u8c8c\u4f3c\u662f\u6708\u8d5b\u6700\u6c34\u7684\u4e00\u9053$T4$\u4e86...\n\n\u6bd4\u8f83\u5957\u8def\u7684\u7ec4\u5408\u6570\u5b66\u95ee\u9898\uff0c\u76f4\u63a5\u8003\u8651\u6bcf\u4e2a\u6570$a_j$\u5bf9\u7b54\u6848$ans_i$\u7684\u8d21\u732e.\n\n\u4e5f\u5c31\u662f\u591a\u5c11\u79cd\u533a\u95f4\u9009\u6cd5\u5305\u62ec\u4e86$a_j$\u3002\n\n\u53cd\u8fc7\u6765\u60f3\u5c31\u662f\u8bf4\u5c06\u521d\u59cb\u533a\u95f4$[j,j]$\u6269\u5c55$k$\u6b21\u7684\u65b9\u6848\u6570\u3002\n\n\u7b54\u6848\u662f$C_{j+k-2}^{j-1}C_{i-j+k-1}^{i-j}$\n\n\u5373$ans_i=\\sum\\limits_{j=1}^ia_jC_{j+k-2}^{j-1}C_{i-j+k-1}^{i-j}$\n\n### \u4e0b\u9762\u7ed9\u4e00\u4e0b\u6211\u81ea\u5df1\u7684\u63a8\u5bfc(\u8fc7\u7a0b\u592a\u8fa3\u9e21\u53ef\u4ee5\u5ffd\u7565)\uff1a\n\n\u5c06\u521d\u59cb\u533a\u95f4$[j,j]$\u6269\u5c55$k$\u6b21\u7684\u65b9\u6848\u6570\uff0c\u53ef\u4ee5\u628a\u5b83\u60f3\u6210\u8fd9\u6837\u7684\u6a21\u578b\uff1a\n\n\u6709\u4e00\u4e2a$n*m$\u7684\u7f51\u683c\uff0c\u4ece$(1,1)$\u5f00\u59cb\u8d70$k$\u6b65\uff0c\u6bcf\u6b65\u53ea\u80fd\u8d70\u5230\u6a2a\u7eb5\u5750\u6807\u90fd\u5927\n\n\u4e8e\u7b49\u4e8e\u5f53\u524d\u70b9\u7684\u4f4d\u7f6e\uff0c\u6c42\u65b9\u6848\u6570\u3002\n\n$e.g.$\n\n$n=3,m=2$\u4ece$(1,1)$\u8d70$3$\u6b65\u3002\u4ee4$f_{i,j}$\u8868\u793a\u8d70\u5230$(i,j)$\u7684\u65b9\u6848\u6570\u3002\n\n\u90a3\u4e48\uff0c\u8d70\u4e00\u6b65:\n\n$1$,$1$,$1$\n\n$1$,$1$,$1$\n\n\u8d70\u4e24\u6b65:\n\n$2$,$4$,$6$\n\n$1$,$2$,$3$\n\n\u8d70\u4e09\u6b65:\n\n$3$,$9$,$18$\n\n$1$,$3$,$6$\n\n\u53d1\u73b0\u672c\u8d28\u4e0a\u5c31\u662f\u6c42\u5176$k$\u7ef4\u7684\u4e8c\u7ef4\u524d\u7f00\u548c\uff0c\u6709\u70b9\u7c7b\u4f3c\u4e8e[P5488](https://www.luogu.org/problem/P5488)\uff0c\u7528\u7ec4\u5408\u6570\u778e\u641e\u4e00\n\n\u641e\uff0c\u65b9\u6848\u6570\u4e3a\u662f$C_{n+k-2}^{n-1}C_{m+k-2}^{m-1}$\u3002\n\n\u5c06\u521d\u59cb\u533a\u95f4$[j,j]$\u6269\u5c55$k$\u6b21\u7684\u65b9\u6848\u6570,\u5373\u4e3a$n=j,m=i-j+1$\n\n\u56e0\u6b64\u7b54\u6848\u4e3a$C_{j+k-2}^{j-1}C_{i-j+k-1}^{i-j}$\n\n### \u56de\u5f52\u6b63\u9898\n\n$ans_i=\\sum\\limits_{j=1}^ia_jC_{j+k-2}^{j-1}C_{i-j+k-1}^{i-j}$\n\n\u5f97\u5230\u8fd9\u4e2a\u5f0f\u5b50\u4e4b\u540e\u5462\uff1f$n<=1e5$\uff0c\u5377\u79ef\u554a\uff01\n\n\u4ee4$A_j=a_jC_{j+k-2}^{j-1},B_j=C_{j+k-1}^{j}$\n\n\u90a3\u4e48$ans_i=\\sum\\limits_{j=1}^iA_jB_{i-j}$\uff0c\u76f4\u63a5$NTT$\u5373\u53ef\u3002\n\n\u81f3\u4e8e\u6c42$A_j$\u548c$B_j$\uff0c$k$\u6bd4\u8f83\u5927\uff0c\u9700\u8981\u8f6c\u5316\u6210\u8fde\u4e58\u5f62\u5f0f(\u4e0a\u5347\u5e42)\uff0c\u5373\uff1a\n\n$A_j=\\frac{a_jk^{\\overline{j-1}}}{(j-1)!},B_j=\\frac{k^{\\overline{j}}}\n{j!}$\n\n\u9884\u5904\u7406$k$\u7684\u4e0a\u5347\u5e42\u5373\u53ef\u3002\n\n\u8d34\u4e0a\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define N 400010\n#define ll long long\n#define mod 998244353\nusing namespace std;\nint n,k,a[N],r[N];\nll inv[N],mi[N],A[N],B[N];\nll ksm(ll x,int y)\n{\n\tll fin = 1;\n\twhile(y)\n\t{\n\t\tif(y&1)fin = fin*x%mod;\n\t\tx = x*x%mod,y>>=1;\n\t}return fin;\n}\ninline void NTT(ll*A,int lim,int fl)\n{\n\tfor(int i = 0;i<lim;i++)if(i<r[i])swap(A[i],A[r[i]]);\n\tfor(int i = 2;i<=lim;i<<=1)\n\t{\n\t\tll wn = ksm(3,(mod-1)/i);\n\t\tif(fl==-1)wn = ksm(wn,mod-2);\n\t\tfor(int j = 0;j<lim;j+=i)\n\t\t{\n\t\t\tll w = 1;\n\t\t\tfor(int k = 0;k<i>>1;k++)\n\t\t\t{\n\t\t\t\tll x = A[j+k],y = w*A[j+k+(i>>1)]%mod;\n\t\t\t\tA[j+k] = (x+y)%mod,A[j+k+(i>>1)] = (x-y)%mod;\n\t\t\t\tw = w*wn%mod;\n\t\t\t}\n\t\t}\n\t}\n\tif(fl==-1)\n\t{\n\t\tll Inv = ksm(lim,mod-2);\n\t\tfor(int i = 0;i<lim;i++)A[i] = A[i]*Inv%mod;\n\t}\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&k);\n\tfor(int i = 1;i<=n;i++)scanf(\"%d\",&a[i]);\n\tinv[0] = inv[1] = 1;\n\tfor(int i = 2;i<=n;i++)inv[i] = (mod-mod/i)*inv[mod%i]%mod;\n\tfor(int i = 2;i<=n;i++)inv[i] = inv[i]*inv[i-1]%mod;\n\tB[0] = mi[0] = 1;\n\tfor(int i = 1;i<=n;i++)mi[i] = mi[i-1]*(i+k-1)%mod;\n\tfor(int i = 1;i<=n;i++)\n\t{\n\t\tA[i] = a[i]*mi[i-1]%mod*inv[i-1]%mod;\n\t\tB[i] = mi[i]*inv[i]%mod;\n\t}\n\tint d = 0,lim = 1;\n\twhile(lim<=n<<1)lim<<=1,d++;\n\tfor(int i = 0;i<lim;i++)r[i] = (r[i>>1]>>1)|((i&1)<<d-1);\n\tNTT(A,lim,1),NTT(B,lim,1);\n\tfor(int i = 0;i<lim;i++)B[i] = A[i]*B[i]%mod;\n\tNTT(B,lim,-1);\n\tfor(int i = 1;i<=n;i++)printf(\"%lld \",(B[i]+mod)%mod);\n\treturn 0;\n}\n```\n",
        "postTime": 1573350180,
        "uid": 85058,
        "name": "Serenata_Immortale",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5641 \u3010\u3010CSGRound2\u3011\u5f00\u62d3\u8005\u7684\u5353\u8bc6\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u7ed9\u4e00\u4e2a\u5e8f\u5217 $a$\uff0c\u5b9a\u4e49\u5b83\u7684 $1$ \u9636\u5b50\u6bb5\u548c\u4e3a\u5b83\u7684\u6240\u6709\u5143\u7d20\u4e4b\u548c\uff0c$2$ \u9636\u5b50\u6bb5\u548c\u4e3a\u6240\u6709\u5b50\u6bb5\uff08\u4e0d\u662f\u5b50\u5e8f\u5217\uff09\u7684 $1$ \u9636\u5b50\u6bb5\u548c\u4e4b\u548c\uff0c$3$ \u9636\u5b50\u6bb5\u548c\u4e3a\u6240\u6709\u5b50\u6bb5\u7684 $2$ \u9636\u5b50\u6bb5\u548c\u4e4b\u548c\uff0c$\\ldots$\u3002\n\n\u6c42\u8fd9\u4e2a\u5e8f\u5217\u7684 $k$ \u9636\u5b50\u6bb5\u548c\u3002$n\\le 10^5,k\\le998244353,\\bmod=998244353$\n\n\u9898\u610f\u5965\u5999\u91cd\u91cd\uff0c\u6a21\u6570\u5965\u5999\u91cd\u91cd\uff0c\u6211\u4eec\u8003\u8651\u6bcf\u4e2a\u6570\u7684\u8d21\u732e\u3002\n\n\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u7684\u6570\u88ab\u8ba1\u7b97\u4e86\u51e0\u6b21\u5462\uff1f\u8003\u8651\u5230\u7b2c\u4e00\u5c42\u5faa\u73af\u4ea7\u751f\u4e86\u4e00\u4e2a\u533a\u95f4 $[l_1,r_1]$\uff0c\u5fc5\u987b\u628a $i$ \u5305\u8fdb\u6765\uff0c\u7b2c $2$ \u5c42\u533a\u95f4\u662f $[l_2,r_2]$\uff0c\u5305\u542b\u5728 $[l_1,r_1]$ \u91cc\u9762\uff0c\u5df4\u62c9\u5df4\u62c9\uff0c\u7136\u540e $i$ \u5305\u542b\u5728 $[l_k,r_k]$ \u91cc\u9762\u3002\n\n\u4e8e\u662f\u5c31\u8ba1\u7b97\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $i$\uff0c\u8ba1\u7b97\u5de6\u8fb9\u5b58\u5728\u51e0\u4e2a $l_1\\le l_2\\le\\ldots l_k\\le i$\uff0c\u53f3\u8fb9\u6709\u51e0\u4e2a $i\\le r_k\\le r_{k-1}\\le\\ldots r_1$\uff0c\u4e58\u8d77\u6765\u5373\u53ef\u3002\n\n\u7136\u540e\u95ee\u9898\u5c31\u8f6c\u5316\u4e3a\u4e86\u4e00\u4e2a\u6ee1\u8db3 $1\\le l_1\\le\\ldots\\le l_k\\le n$ \u7684  $(l_1,l_2,\\ldots,l_k)$\u6709\u591a\u5c11\u4e2a\u3002\n\n\u4f60\u5bf9 $l$ \u505a\u5dee\u5206\uff0c\u8bb0 $g_i=l_i-l_{i-1},(l_0=0)$\uff0c\u7136\u540e\u5c31\u8f6c\u5316\u4e3a $\\sum_{g=1}^k\\le n$\uff0c\u5176\u4e2d $g_1\\ge1,g_{2\\ldots k}\\ge0$\uff0c\u4e24\u8fb9\u52a0 $k-1$\uff0c\u53d8\u6210 $\\sum_{g=1}^k\\le n+k-1$\uff0c\u5176\u4e2d $g_i\\ge1$\uff0c\u7136\u540e\u63d2\u677f\u6cd5\u505a\u51fa\u6765\u4e00\u5171\u6709 $\\dbinom{n+k-2}{k-1}$\u3002\n\n\u6240\u4ee5 $i$ \u4f4d\u7f6e\u7684\u8d21\u732e\u662f $\\dbinom{i+k-2}{k-1}\\dbinom{n-i+k-1}{k-1}$\u3002\n\n\u7b54\u6848\u5c31\u662f\uff1a\n\n$$\\sum_{i=1}^n\\dbinom{i+k-2}{k-1}\\dbinom{n-i+k-1}{k-1}a_i$$\n\n$$\\sum_{i=1}^n(\\dbinom{i-1+k-1}{k-1}a_i)\\dbinom{n-i+k-1}{k-1}$$\n\n\u7136\u540e\u4f60\u4e00\u5377\uff01\u5c31\u505a\u5b8c\u5566\uff01\n\n\u73b0\u5728\u662f $18:42$\uff0c\u6211\u770b\u6211\u4ec0\u4e48\u65f6\u5019\u5199\u5b8c\u3002\n\n\u73b0\u5728\u662f $19:18$\uff0c\u6211\u5199\u5b8c\u4e86\u3002\n\n```cpp\nint n,k;\npoly f,g;\nsigned main(){\n#ifndef ONLINE_JUDGE\n\tfreopen(\"testdata.in\",\"r\",stdin);\n#endif\n\tcin>>n>>k;\n\tinit(n);\n\tf.resize(n);\n\tg.resize(n);\n\tg[0]=1;\n\tfor(int i=0;i<n;i++){\n\t\tif(i>0)\n\t\tg[i]=Mul(g[i-1],Mul(i+k-1,inv[i]));\n\t\tcin>>f[i];\n\t\tmul(f[i],g[i]);\n\t}\n\tf=f*g;\n\tf.resize(n);\n\tPrint(f);\n#ifndef ONLINE_JUDGE\n\tcerr<<endl<<(double)clock()/CLOCKS_PER_SEC;\n#endif\n}\n```\n\u4e0a\u9762\u662f\u6211\u7684\u591a\u9879\u5f0f\u677f\u5b50\uff0c[\u5b89\u5229\u4e00\u6ce2](https://www.luogu.com.cn/blog/Peterprpr/mu-ban)\u3002\n\n\u88ab\u8fd9\u4e2a\u5e26 $k$ \u7684\u7ec4\u5408\u6570\u57cb\u4f0f\u5230\u4e86\uff0c\u6839\u672c\u9884\u5904\u7406\u4e0d\u4e86\uff0c\u8349\u3002",
        "postTime": 1632739346,
        "uid": 100325,
        "name": "peterwuyihong",
        "ccfLevel": 7,
        "title": "P5641 \u3010CSGRound2\u3011\u5f00\u62d3\u8005\u7684\u5353\u8bc6 \u8bb0\u5f55"
    },
    {
        "content": "[\u6211\u7684\u535a\u5ba2\u56ed](https://www.cnblogs.com/ET2006/)\n\n\u4e00\u9053\u633a\u6709\u610f\u601d\u7684\u9898\uff0c\u5e76\u4e14\u7adf\u7136\u81ea\u5df1\u641e\u51fa\u6765\u4e86\uff01\n\n\u9996\u5148\u8981\u6e05\u695a $sum_{k,l,r}$ \u7684\u542b\u4e49\u662f\u4ec0\u4e48\u3002\n\n$sum_{1,l,r}$ \u5c31\u4e0d\u7528\u591a\u8bf4\u4e86\uff0c\u5c31\u662f $a_l$ \u5230 $a_r$ \u7684\u548c\u3002\n\n$sum_{2,l,r}$ \u6839\u636e $sum_{k,l,r}$ \u7684\u516c\u5f0f\uff0c\u53ef\u4ee5\u770b\u4f5c\u662f\u9009\u62e9\u4e00\u4e2a\u533a\u95f4 $[l_1,r_1]\\subseteq [l,r]$\uff0c\u518d\u5c06 $a_{l_1}$ \u5230 $a_{r_1}$ \u7684\u548c\u7d2f\u52a0\u5165\u7b54\u6848\u4e2d\u3002\n\n$sum_{3,l,r}$ \u662f\u9009\u62e9\u4e00\u4e2a\u533a\u95f4 $[l_1,r_1]\\subseteq[l,r]$\uff0c\u518d\u5bf9 $[l_1,r_1]$ \u6c42\u4e00\u904d $sum_{2,l_1,r_1}$\uff0c\u4e5f\u5c31\u662f\u518d\u9009\u62e9\u4e00\u4e2a\u533a\u95f4 $[l_2,r_2]\\in [l_1,r_1]$ \u5c06 $a_{l_2}$ \u5230 $a_{r_2}$ \u7684\u548c\u52a0\u5165\u7b54\u6848\u4e2d\u3002\n\n\u2026\u2026\u2026\u2026\n\n$sum_{k,l,r}$ \u5c31\u662f\u9009\u62e9 $k-1$ \u4e2a\u533a\u95f4 $[l_{k-1},r_{k-1}]\\subseteq [l_{k-2},r_{k-2}]\\subseteq\\dots\\subseteq[l_1,r_1]\\subseteq [l,r]$\uff0c\u5e76\u5c06 $[l_k,r_k]$ \u7684\u548c\u52a0\u5165\u7b54\u6848\u4e2d\u3002\n\n\u8003\u8651\u8f6c\u6362\u8d21\u732e\u4f53\uff0c\u679a\u4e3e $a_i$ \u4f1a\u5bf9 $sum_{k,1,r}$ \u4ea7\u751f\u591a\u5927\u7684\u8d21\u732e\uff0c\u4e5f\u5c31\u662f\u6709\u591a\u5c11\u7ec4\u533a\u95f4 $[l_i,r_i]$ \u6ee1\u8db3 $i\\in[l_{k-1},r_{k-1}]\\subseteq [l_{k-2},r_{k-2}]\\subseteq\\dots\\subseteq[l_1,r_1]\\subseteq [1,r]$\uff0c\u7531\u4e8e\u662f\u76f8\u90bb\u533a\u95f4\u4e4b\u95f4\u662f\u5305\u542b\u5173\u7cfb\uff0c\u6545 $i\\geq l_{k-1}\\geq l_{k-2}\\geq\\dots\\geq l_1\\geq 1$\uff0c\u8bb0 $d_k=i-l_{k-1},d_{k-1}=l_{k-1}-l_{k-2},\\dots,d_2=l_2-l_1,d_1=l_1-1$\uff0c\u90a3\u4e48\u6709 $d_1+d_2+d_3+\\dots+d_k=i-1$\uff0c\u5176\u4e2d $d_i\\geq 0$\uff0c\u91c7\u7528\u9694\u677f\u6cd5\u53ef\u6c42\u5f97\u6240\u6709 $(l_1,l_2,\\dots,l_{k-1})$ \u7684\u4e2a\u6570\u4e3a $\\dbinom{i+k-2}{k-1}$\u3002\u540c\u7406\u53ef\u5f97\u6240\u6709 $(r_1,r_2,\\dots,r_{k-1})$ \u7684\u4e2a\u6570\u4e3a $\\dbinom{r-i+k-1}{k-1}$\u3002\n\n\u6545 $a_i$ \u5bf9 $r$ \u4ea7\u751f\u7684\u8d21\u732e\u4e3a $a_i\\times \\dbinom{i+k-2}{k-1}\\times \\dbinom{r-i+k-1}{k-1}$\u3002\u8bb0 $A_i=a_i\\times \\dbinom{i+k-2}{k-1},B_i=\\dbinom{i+k-2}{k-1}$\uff0c\u6c42\u4e00\u904d $A$ \u4e0e $B$ \u7684\u5377\u79ef $C$\uff0c\u90a3\u4e48 $C_{r+1}=sum_{k,1,r}$\u3002 \n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fz(i,a,b) for(int i=a;i<=b;i++)\n#define fd(i,a,b) for(int i=a;i>=b;i--)\n#define ffe(it,v) for(__typeof(v.begin()) it=v.begin();it!=v.end();it++)\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntemplate<typename T1,typename T2> void chkmin(T1 &x,T2 y){if(x>y) x=y;}\ntemplate<typename T1,typename T2> void chkmax(T1 &x,T2 y){if(x<y) x=y;}\ntypedef pair<int,int> pii;\ntypedef long long ll;\ntemplate<typename T> void read(T &x){\n\tx=0;char c=getchar();T neg=1;\n\twhile(!isdigit(c)){if(c=='-') neg=-1;c=getchar();}\n\twhile(isdigit(c)) x=x*10+c-'0',c=getchar();\n\tx*=neg;\n}\nconst int pr=3;\nconst int MOD=998244353;\nconst int MAXN=1e5;\nconst int MAXP=1<<18;\nint n,k,x[MAXN+5],t[MAXN+5];\nint qpow(int x,int e){int ret=1;for(;e;e>>=1,x=1ll*x*x%MOD) if(e&1) ret=1ll*ret*x%MOD;return ret;}\nint a[MAXP+5],b[MAXP+5],c[MAXP+5],LEN=1,LOG=0,inv[MAXP+5],rev[MAXP+5],prs[MAXP+5][2],ipr;\nvoid NTT(int *a,int len,int type){\n\tint lg=log2(len);\n\tfor(int i=0;i<len;i++) rev[i]=(rev[i>>1]>>1)|((i&1)<<(lg-1));\n\tfor(int i=0;i<len;i++) if(i<rev[i]) swap(a[i],a[rev[i]]);\n\tfor(int i=2;i<=len;i<<=1){\n\t\tint W=prs[i][type<0];\n\t\tfor(int j=0;j<len;j+=i){\n\t\t\tint w=1;\n\t\t\tfor(int k=0;k<(i>>1);k++,w=1ll*w*W%MOD){\n\t\t\t\tint X=a[j+k],Y=1ll*a[(i>>1)+j+k]*w%MOD;\n\t\t\t\ta[j+k]=(X+Y)%MOD;a[(i>>1)+j+k]=(X-Y+MOD)%MOD;\n\t\t\t}\n\t\t}\n\t}\n\tif(type==-1) for(int i=0;i<len;i++) a[i]=1ll*a[i]*inv[len]%MOD;\n}\nint main(){\n\tscanf(\"%d%d\",&n,&k);ipr=qpow(pr,MOD-2);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&x[i]);ll mul=1;\n\tfor(int i=1;i<=n;i++) t[i]=mul,mul=1ll*mul*qpow(i,MOD-2)%MOD,mul=1ll*mul*(i+k-1)%MOD;\n\tfor(int i=1;i<=n;i++) a[i]=1ll*t[i]*x[i]%MOD,b[i]=t[i];\n\twhile(LEN<=n+n) LEN<<=1,LOG++;\n\tfor(int i=1;i<=LEN;i<<=1){\n\t\tinv[i]=qpow(i,MOD-2);\n\t\tprs[i][0]=qpow(pr,(MOD-1)/i);\n\t\tprs[i][1]=qpow(ipr,(MOD-1)/i);\n\t} NTT(a,LEN,1);NTT(b,LEN,1);\n\tfor(int i=0;i<LEN;i++) c[i]=1ll*a[i]*b[i]%MOD;\n\tNTT(c,LEN,-1);for(int i=1;i<=n;i++) printf(\"%d \",c[i+1]);\n\treturn 0;\n}\n```",
        "postTime": 1609681882,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P5641 \u3010\u3010CSGRound2\u3011\u5f00\u62d3\u8005\u7684\u5353\u8bc6\u3011"
    },
    {
        "content": "\u6211\u4eec\u8003\u8651\u8ba1\u7b97\u8d21\u732e\u3002\n\n\u8003\u8651\u6700\u7ec8\u7684\u5bf9\u4e8e\u4e00\u4e2a\u6570 $a_i$\uff0c\u8bbe\u5b83\u5728 $k$ \u4e2a\u9009\u5b9a\u591a\u533a\u95f4\u5d4c\u5957\u5185\u7684\u51fa\u73b0\u6b21\u6570\u4e3a $c_i$\uff0c\u5219\u5b83\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a $a_ic_i$\u3002\n\n\u90a3\u4e48\u73b0\u5728\u6211\u4eec\u8003\u8651\u4e00\u4e2a\u533a\u95f4\u6700\u7ec8\u533a\u95f4 $[1,r]$\uff0c\u5b83\u7684\u5176\u4e2d\u7b54\u6848\u6765\u6e90 $a_i$\uff0c\u6765\u6e90\u4e8e\u82e5\u5e72 $k$ \u4e2a\u533a\u95f4 $[l_i,r_i]$ \u6ee1\u8db3 $l_k=1\\leqslant l_{k-1}\\leqslant l_{k-2}\\leqslant \\ldots\\leqslant l_1\\leqslant i\\leqslant r_1\\leqslant \\ldots\\leqslant r_{k-1}\\leqslant r_k$\u3002\n\n\u90a3\u4e48\u73b0\u5728\u8003\u8651\u6211\u4eec\u4ece\u6bcf\u4e00\u4e2a $i=1\\ldots r$ \u5f00\u59cb\u8d70\uff0c\u4e0d\u65ad\u5411\u5de6\u8fb9\u6216\u8005\u53f3\u8fb9\u8d70\u4e00\u6b65\u6216\u8005\u4e0d\u8d70\uff0c\u8fd9\u6837\u5bb9\u6613\u53d1\u73b0\u5de6\u7aef\u70b9 $l$ \u548c\u53f3\u7aef\u70b9 $r$ \u7684\u8d21\u732e\u662f\u4e92\u76f8\u72ec\u7acb\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u5206\u5f00\u8003\u8651\u3002\n\n\u6211\u4eec\u5148\u8003\u8651\u5de6\u7aef\u70b9\u3002\n\n\u5176\u5b9e\u5c31\u662f\u63d2\u677f\u6cd5\uff0c\u5de6\u8fb9\u4e00\u5171\u53ef\u4ee5\u8d70 $k-1$ \u6b21\uff0c\u7b54\u6848\u4e3a $\\binom{(i+(k-1))-1}{k-1}=\\binom{i+k-2}{k-1}$\u3002\n\n\u7136\u540e\u53f3\u8fb9\u540c\u7406\uff0c\u7b54\u6848\u4e3a $\\binom{((r-i+1)+(k-1))-1}{k-1}=\\binom{r-i+k-1}{k-1}$\u3002\n\n\u7b54\u6848\u5373\u4e3a\n$$\nsum_{k,1,r}=\\sum_{i=1}^r a_r \\binom{i+k-2}{k-1} \\binom{r-i+k-1}{k-1}\n$$\n\u6211\u4eec\u8003\u8651\u4f18\u5316\u3002\n\n\u663e\u7136\u6211\u4eec\u9700\u8981 NTT \u6765\u4f18\u5316\u3002\n\n\u4ee4 $p(x)=\\binom{x}{k-1}$\u3002\n\n\u5219\n$$\nsum_{k,1,r}=\\sum_{i=1}^r a_i p(i+k-2) p(r-i+k-1)\n$$\n\u4ee4 $f(i)=a_ip(i+k-2),g(i)=p(i+k-1)$\uff0c\u5219\n$$\nsum_{k,1,r}=\\sum_{i=1}^r f(i) g(r-i)\n$$\n\u5377\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u7ec4\u5408\u6570\u90e8\u5206\u7684\u9012\u63a8\uff1a\n$$\n\\binom{i+k-2}{k-1}=\\dfrac{(i+k-2)!}{(k-1)!(i+k-2-k+1)!}\n$$\n\n$$\n=\\dfrac{(i+k-2)!}{(k-1)!(i-1)!}\n$$\n\n$$\n=\\dfrac{k\\times (k+1)\\times \\ldots\\times (i+k-2)}{(i-1)!}\n$$\n\u4e8e\u662f\u8fd9\u90e8\u5206\u9012\u63a8\u5373\u53ef\u3002\n$$\n\\binom{i+k-1}{k-1}=\\dfrac{k\\times (k+1)\\times \\ldots \\times (i+k-1)}{i!}\n$$\n\u4e8e\u662f\u9884\u5904\u7406\u5230 $n$ \u7684\u9636\u4e58\u548c\u4ece $k$ \u5f00\u59cb\u7684\u4e58\u79ef\u5373\u53ef\uff08\u6216\u8005\u76f4\u63a5\u9012\u63a8\u4e5f\u53ef\u4ee5\uff09\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n\\log n)$\u3002\n\n$Code:$\n\n```cpp\n#include<bits/stdc++.h>\n#define rep(i,x,y) for(int i=x,i##end=y;i<=i##end;++i)\n#define _rep(i,x,y) for(int i=x,i##end=y;i>=i##end;--i)\n#define ll long long\n#define N 5000005\nconst int mod=998244353,G=3,_inv=mod+1>>1;\ninline void reduce(int&x){x-=mod,x+=x>>31&mod;}\n//inline int upd(int x){x-=mod; return x+=x>>31&mod;}\ninline int upd(int x){return x+=x>>31&mod;}\nint wn[N],rev[N];\ninline int qpow(int x,int y,int ret=1){\n\tfor(;y;y>>=1,x=1ll*x*x%mod) if(y&1)\n\t\tret=1ll*ret*x%mod; return ret;\n}\nnamespace ntt{\n\tinline void install(int n){\n\t\tfor(int mid=1;mid<n;mid<<=1){\n\t\t\tint w=qpow(G,mod/mid>>1);\n\t\t\twn[mid]=1;\n\t\t\trep(i,1,mid-1) wn[mid+i]=1ll*wn[mid+i-1]*w%mod;\n\t\t}\n\t}\n\tint lim,invlim;\n\tinline void init(int n){\n\t\tfor(lim=invlim=1;lim<n;lim<<=1)\n\t\t\tinvlim=1ll*invlim*_inv%mod;\n\t\trep(i,1,lim-1) rev[i]=rev[i>>1]>>1|(lim>>1&-(i&1));\n\t}\n\tinline void ntt(int *a,int ty){\n\t\tstatic int b[N];\n\t\trep(i,0,lim-1) b[i]=a[rev[i]];\n\t\tfor(int mid=1;mid<lim;mid<<=1){\n\t\t\tfor(int i=0;i<lim;i+=mid<<1){\n\t\t\t\trep(j,0,mid-1){\n\t\t\t\t\tconst int x=1ll*b[i+j+mid]*wn[mid+j]%mod;\n\t\t\t\t\tb[i+j+mid]=upd(b[i+j]-x);\n\t\t\t\t\treduce(b[i+j]+=x);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(!ty){\n\t\t\trep(i,0,lim-1) a[i]=1ll*b[i]*invlim%mod;\n\t\t\tstd::reverse(a+1,a+lim);\n\t\t} else {\n\t\t\tstd::memcpy(a,b,lim<<2);\n\t\t}\n\t}\n\tinline void _ntt(int *a,int *b){\n\t\tntt(a,1),ntt(b,1);\n\t\trep(i,0,lim-1) a[i]=1ll*a[i]*b[i]%mod;\n\t\tntt(a,0);\n\t}\n}\nint a[N],n,k,inv[N];\nint f[N],g[N];\nint main(){\n\tstd::ios::sync_with_stdio(0),std::cin.tie(0),std::cout.tie(0);\n\tstd::cin>>n>>k;\n\trep(i,1,n) std::cin>>a[i];\n\tinv[1]=1;\n\trep(i,2,n) inv[i]=1ll*inv[mod%i]*(mod-mod/i)%mod;\n\tg[0]=1;\n\trep(i,1,n) g[i]=1ll*g[i-1]*(i+k-1)%mod*inv[i]%mod;\n\trep(i,1,n) f[i]=1ll*g[i-1]*a[i]%mod;\n\tntt::install(n+1<<2); ntt::init(n+1<<1);\n\tntt::_ntt(f,g);\n\trep(i,1,n) std::cout<<f[i]<<\" \\n\"[i==n];\n\treturn 0;\n}\n```\n\n",
        "postTime": 1603115328,
        "uid": 101891,
        "name": "cyn2006",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5641 \u3010\u3010CSGRound2\u3011\u5f00\u62d3\u8005\u7684\u5353\u8bc6\u3011"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P5641)\n\n---\n\n**\u3010\u5206\u6790\u3011**\n--\n\n$sum_{k,l,r}=\\begin{cases}\n\\displaystyle\\sum_{i=l}^r a_i,k=1\n\\\\\n\\displaystyle\\sum_{i=l}^r\\sum_{j=i}^rsum_{k-1,i,j},k>1\n\\end{cases}$\n\n\u8003\u8651\u7b2c\u4e8c\u4e32\u5f0f\u5b50\u7684\u542b\u4e49\uff0c\u5176\u80fd\u5199\u4e3a\uff1a\n\n$\\displaystyle sum_{k,l,r}=\\sum_{l\\leq i\\leq j\\leq r}sum_{k-1,i,j}$\n\n\u8003\u8651\u7ee7\u7eed\u8fdb\u884c\u8fed\u4ee3\uff1a\n\n$\\displaystyle =\\sum_{l\\leq i_1\\leq i_2\\leq j_2\\leq j_1\\leq r}sum_{k-2,i_2,j_2}$\n\n$\\displaystyle =\\sum_{l\\leq i_1\\leq \\cdots \\leq i_{k-1}\\leq j_{k-1}\\leq \\cdots\\leq j_1\\leq r}sum_{1,i_{k-1},j_{k-1}}$\n\n\u73b0\u8003\u8651 $a_n$ \u5bf9 $sum_{k,l,r}$ \u7684\u8d21\u732e\uff1a\n\n\u663e\u7136\uff0c\u5f53 $k=1$ \u65f6\uff0c\u8d21\u732e\u4e3a $[l\\leq n\\leq r]$\n\n\u540c\u4e0a\u8003\u8651\u8fed\u4ee3\uff0c\u7edf\u8ba1\u51fa $a_n$ \u7684\u8d21\u732e\u4e3a\uff1a\n\n$\\displaystyle =\\sum_{l\\leq i_1\\leq \\cdots \\leq i_{k-1}\\leq j_{k-1}\\leq \\cdots\\leq j_1\\leq r}[i_{k-1}\\leq n\\leq j_{k-1}]$\n\n\u5373\u8d21\u732e\u4e3a\uff1a$l\\leq i_1\\leq \\cdots\\leq i_{k-1}\\leq n\\leq j_{k-1}\\leq \\cdots\\leq j_1\\leq r$ \u7684\u65b9\u6848\u6570\n\n$l\\leq i_1\\leq \\cdots\\leq i_{k-1}\\leq n$ \u7684\u65b9\u6848\u6570\uff0c\u5373\u4e3a $(k-1)$ \u4e2a\u6570\u63d2\u5165\u5230 $[l,n]$ \u76d2\u5b50\u4e2d\u7684\u65b9\u6848\u6570\uff0c\u4e3a $\\dbinom{n-l+k-1}{n-l}$\n\n$n\\leq j_{k-1}\\leq \\cdots\\leq j_1\\leq r$ \u7684\u65b9\u6848\u6570\uff0c\u540c\u7406\u4e3a $(k-1)$ \u4e2a\u6570\u63d2\u5165\u5230 $[n,r]$ \u76d2\u5b50\u4e2d\u7684\u65b9\u6848\u6570\uff0c\u4e3a $\\dbinom{r-n+k-1}{r-n}$\n\n\u56e0\u6b64\uff0c$a_n$ \u5bf9 $sum_{k,1,i}$ \u7684\u603b\u8d21\u732e\u4e3a $a_n\\cdot \\dbinom{n-1+k-1}{n-1}\\cdot \\dbinom{i-n+k-1}{i-n}$\n\n\u6545 $\\displaystyle sum_{k,1}[i]=\\sum_{x=1}^na_x\\cdot \\dbinom{x-1+k-1}{x-1}\\cdot \\dbinom{i-x+k-1}{i-x}$\n\n\u5b9a\u4e49 $a[0]=0$ \uff0c\u6839\u636e $\\dbinom n m=0(m<0)$ \u5f97\n\n$\\displaystyle sum_{k,1}[i]=\\sum_{x+y=i}a_x\\cdot \\dbinom{x-1+k-1}{x-1}\\cdot \\dbinom{y+k-1}{y}$\n\n\u8bb0 $\\displaystyle A(x)=\\sum_{n=0}^\\infty a_n\\cdot \\dbinom{n-1+k-1}{n-1}x^n,F(x)=\\sum_{n=0}^\\infty \\dbinom{n+k-1}{n}$\n\n\u5f97 $Sum_{k,1}(x)=A(x)\\cdot F(x)$\n\n\u76f4\u63a5\u591a\u9879\u5f0f\u4e58\u6cd5\u5373\u53ef\uff08\u53ef\u80fd\u8981\u7a0d\u5fae\u5361\u4e00\u4e0b\u5e38\u6570\uff09\n\n---\n\n**\u3010\u4ee3\u7801\u3011**\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int M=1<<17<<1,MOD=998244353;\nint a[M], b[M];\n\ninline int add(int a,int b) { return (a+b>=MOD)?(a+b-MOD):(a+b); }\ninline int dis(int a,int b) { return (a-b<0)?(a-b+MOD):(a-b); }\nstruct NTT{\n    static const int G = 3, P = 998244353;\n    int N, na, nb, w[2][M], rev[M];\n    inline ll kpow(ll a,int b){\n        ll c=1;\n        for(;b;b>>=1,a=a*a%P) if(b&1) c=c*a%P;\n        return c;\n    }\n\n    void FFT(int *a,int f){\n        for(int i=0;i<N;++i) if(i<rev[i]) swap(a[i],a[rev[i]]);\n        for(int i=1;i<N;i<<=1)\n            for(int j=0,t=N/(i<<1);j<N;j+=i<<1)\n                for(int k=0,l=0,x,y;k<i;++k,l+=t)\n                    x=(ll)w[f][l]*a[j+k+i]%P, y=a[j+k], a[j+k]=add(y,x), a[j+k+i]=dis(y,x);\n        if(f) for(int i=0,x=kpow(N,P-2);i<N;++i) a[i]=(ll)a[i]*x%P;\n    }\n    void work(){\n        int d=__builtin_ctz(N);\n        w[0][0]=w[1][0]=1;\n        for(int i=1,x=kpow(G,(P-1)/N),y=kpow(x,P-2);i<N;++i){\n            rev[i]=(rev[i>>1]>>1)|((i&1)<<d-1);\n            w[0][i]=(ll)x*w[0][i-1]%P, w[1][i]=(ll)y*w[1][i-1]%P;\n        }\n    }\n    void doit(int *a,int *b,int na,int nb){\n        for(N=1;N<na+nb-1;N<<=1);\n        for(int i=na;i<N;++i) a[i]=0;\n        for(int i=nb;i<N;++i) b[i]=0;\n        work(); FFT(a,0); FFT(b,0);\n        for(int i=0;i<N;++i) a[i]=(ll)a[i]*b[i]%P;\n        FFT(a,1);\n    }\n}ntt;\n\nint n,k,A[M],F[M],InV[M];\ninline void pre(){\n    InV[1]=1;\n    for(int i=2;i<=2e5;++i)\n        InV[i]=dis(MOD,(ll)(MOD/i)*InV[MOD%i]%MOD);\n\n    F[0]=1;\n    for(int i=1;i<=1e5;++i)\n        F[i]=(ll)F[i-1]*(i+k-1)%MOD*InV[i]%MOD;\n}\nint main(){\n    ios::sync_with_stdio(0);\n    cin.tie(0); cout.tie(0);\n    cin>>n>>k;\n    pre();\n    for(int i=1,t=1;i<=n;++i,t=(ll)t*(i+k-2)%MOD*InV[i-1]%MOD){\n        cin>>A[i];\n        A[i]=(ll)A[i]*t%MOD;\n    }\n    ntt.doit(F,A,n+1,n+1);\n    for(int i=1;i<=n;++i) cout<<F[i]<<\" \";\n    cout.flush();\n    return 0;\n}\n```",
        "postTime": 1615347087,
        "uid": 36031,
        "name": "JustinRochester",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 P5641 \u3010CSGRound2\u3011\u5f00\u62d3\u8005\u7684\u5353\u8bc6"
    },
    {
        "content": "# \u9898\u89e3\uff1aP5641\u5f00\u62d3\u8005\u7684\u5353\u8bc6\n\n\u6807\u7b7e\uff1a \u591a\u9879\u5f0f \u7ec4\u5408\u6570\u5b66\n\n---\n\n### \u524d\u8a00\n\n\u901a\u8fc7\u627e\u51fa\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u5728\u6bcf\u4e00\u4e2a\u8f93\u51fa\u503c\u4e2d\u7684\u8d21\u732e\u603b\u91cf\u7684\u516c\u5f0f\uff0c\u6765\u6c42\u5f97\u6240\u6709\u7b54\u6848\u3002\n\n### \u601d\u8def\n\n\u4ece\u6700\u7b80\u5355\u7684\u5f00\u59cb\u63a8\u8d77\u3002\n\n\u5f53\u524d\u8981\u6c42\u7684\u662f $sum_{k,1,r}$\uff0c\u8981\u6c42\u51fa\u6bcf\u4e00\u4e2a $a_i,(i\\in [1,r])$ \u7684\u51fa\u73b0\u6570\u91cf\u3002\n\n\u5047\u8bbe $cnt_i$ \u4e3a $a_i$ \u5728 $sum_{k,1,r}$ \u4e2d\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u90a3\u4e48\uff1a\n\n$$sum_{k,1,r}=\\sum_{i=1}^r\\ cnt_i\\times a_i$$\n\n\u73b0\u5728\u6700\u91cd\u8981\u7684\u95ee\u9898\u662f\u5982\u4f55\u6c42 $cnt_i$ \uff0c\u5b9a\u4e49\u4e00\u4e0b $cnt_i$ \u7684\u610f\u4e49\uff0c\u5373\u4e3a\u4f4d\u7f6e $i$ \u88ab $k-1$ \u4e2a\u533a\u95f4 $[l_j,r_j],(j\\in[1,k-1])$ \u90fd\u8986\u76d6\u7684\u65b9\u6848\u6570\uff0c\u5e76\u4e14\u56e0\u4e3a\u662f\u4ece\u9ad8\u9636\u5411\u4f4e\u9636\u5c55\u5f00\uff0c\u6240\u4ee5\u5e8f\u53f7\u5c0f\u7684\u533a\u95f4\uff0c\u4e00\u5b9a\u88ab\u5305\u542b\u5728\u5e8f\u53f7\u5927\u7684\u533a\u95f4\uff0c$[l_j,r_j]\\in[l_{j+1},r_{j+1}]$\u3002\n\n\u7ee7\u7eed\u5f62\u8c61\u5316\u4e00\u70b9\u5c31\u662f\u8981\u5728 $1\u2026i$ \u4e2d\u9009 $k-1$ \u4e2a\u70b9\u7684\u65b9\u6848\u6570\u4e58\u4e0a $i+1\u2026r$ \u4e2d\u9009\u51fa $k-1$ \u4e2a\u70b9\u7684\u65b9\u6848\u6570\uff08\u6839\u636e\u4e0a\u9762\u6240\u8bf4\u7684\u8303\u56f4\uff0c\u8fd9\u4e9b\u70b9\u6709\u4e9b\u53ef\u4ee5\u91cd\u590d\u3002\n\n\u90a3\u4e48\u5982\u4f55\u628a\u5b83\u7684\u8ba1\u7b97\u7528\u7ec4\u5408\u6570\u7684\u516c\u5f0f\u5efa\u7acb\u8d77\u6765\u8d77\u6700\u91cd\u8981\u7684\u95ee\u9898\u3002\n\n\u63d0\u51fa\u4e00\u4e2a\u95ee\u9898\uff0c\u95ee\u4ece $n$ \u79cd\u7c7b\u578b\u7684\u6bcf\u4e00\u79cd\u90fd\u6709\u65e0\u6570\u4e2a\u7684\u70b9\u4e2d\u9009\u53d6 $m$ \u4e2a(\u53ef\u4ee5\u7c7b\u578b\u91cd\u590d)\u7684\u65b9\u6848\u6570\u3002\n\n\u8fd9\u4e2a\u95ee\u9898\u56e0\u4e3a\u6709\u91cd\u590d\uff0c\u90a3\u4e48\u5c31\u548c\u9694\u677f\u6cd5\u6709\u8054\u7cfb\u4e86\uff0c\u628a $m$ \u5f62\u8c61\u5730\u5316\u4e3a $m$ \u4e2a\u5c0f\u7403\uff0c\u90a3\u4e48\u5c31\u662f\u8981\u628a\u8fd9 $m$ \u4e2a\u5c0f\u7403\u7528 $n-1$ \u4e2a\u6321\u677f\u9694\u5f00 \u5176\u4e2d\u7b2c $i$ \u4e2a\u6321\u677f\u548c\u7b2c $i+1$ \u4e2a\u6321\u677f\u4e4b\u95f4\u7684\u7403\u6570\u5c31\u662f\u7b2c $i+1$ \u4e2a\u6570\u9009\u7684\u4e2a\u6570\u3002\n\n\u90a3\u4e48\u65b9\u6848\u5c31\u662f $\\dbinom{n+m-1}{m}$\u3002\n\n\u4e5f\u5c31\u662f $n+m-1$ \u4e2a\u4f4d\u7f6e\uff0c\u627e $m$ \u4e2a\u4f4d\u7f6e\u653e\u7403\u3002\n\n\u6240\u4ee5\uff1a \n\n$$sum_{k,1,r}=\\sum_{i=1}^{r} a_i \\binom{i+k-1-1}{k-1}\\binom{r-i+k-1-1}{k-1}$$\n\n$$sum_{k,1,r}=\\sum_{i=1}^{r} a_i \\binom{i+k-2}{k-1}\\binom{r-i+k-1}{k-1}$$\n\n\u8003\u8651\u7528\u591a\u9879\u5f0f\u6765\u4f18\u5316\u5b83\uff0c\u5176\u5b9e\u8fd9\u4e2a\u5f0f\u5b50\u4e00\u770b\u6709\u4e00\u4e2a $r-i$ \u5176\u5b9e\u5c31\u7279\u522b\u7279\u522b\u7b26\u5408\u5377\u79ef\u4e86\n\n\u8bbe $F_{i}=a_i\\times \\dbinom{i+k-2}{k-1}$,$G_i=\\binom{i+k-1}{k-1}$\n\n$$sum_{k,l,r}=\\sum_{i=1}^r F_i\\times G_{r-i}$$\n\n~~\u975e\u5e38\u7f8e\u4e3d\u7684\u5377\u79ef\u5f62\u5f0f\uff0c\u5377\u5377\u5377\u3002~~\n\n### \u5b9e\u73b0\u7ec6\u8282\n\n\u80af\u5b9a\u662f\u9009\u62e9\u9012\u63a8\u6c42\u89e3\u4e86\u3002\n\n $k$ \u7684\u8303\u56f4\u5f88\u5927\u662f\u4e00\u4e2a\u5934\u75bc\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u5148\u9012\u63a8\u51fa $G_i$ \u6765\uff0c\u7136\u540e\u770b\u4e00\u770b $F_i $\u4e0e $G$ \u7684\u5173\u7cfb,\u7528 $F_i=a_i\\times G_{i-1}$ \u6c42\u89e3\u5373\u53ef\u3002\n \n\u6254\u4e00\u4e2a\u63a8 $G(i)$ \u7684\u5f0f\u5b50\uff1a\n\n$$G(0)=1$$\n\n$$G(1)=\\binom{k}{k-1}=\\frac{k!}{(k-1)!\\times1}=k$$\n\n$$G(2)=\\binom{k+1}{k-1}\\frac{(k+1)!}{(k-1)!\\times 2!}=\\frac{k\\times (k+1)}{2}$$\n\n$$G(3)=\\binom{k+2}{k-1}=\\frac{k\\times (k+1)\\times (k+2)}{2\\times 3}$$\n\n\u53ef\u4ee5\u53d1\u73b0\n\n$$G(i)=\\frac{G(i-1)\\times (k+i-1)}{i}$$\n\n### \u4ee3\u7801\u5b9e\u73b0\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<cmath>\n#include<iostream>\n#include<queue>\n#include<stack>\n#include<map>\n#define int long long \nusing namespace std;\nconst int N=3e6+9;\nconst int mod=998244353;\nconst int G[]={3,332748118};\nint n,k;\nint r[N];\nint term=1,l;\nint inv[N];\nint g[N];\nint f[N];\nint a[N];\nint read()\n{\n\tint f=1,x=0;\n\tchar s=getchar();\n\twhile(s<'0'||s>'9'){if(s=='-')f=-1;s=getchar();}\n\twhile(s>='0'&&s<='9'){x=(x<<1)+(x<<3)+(s^'0');s=getchar();}\n\treturn f*x;\n}\nint quick(int x,int p)\n{\n\tint ret=1;\n\twhile(p)\n\t{\n\t\tif(p&1) ret=x*ret%mod;\n\t\tx=x*x%mod;\n\t\tp>>=1; \n\t}\n\treturn ret%mod;\n}\nvoid NTT(int *A,int type)\n{\n\tfor(int i=0;i<term;i++)\n\t\tif(i<r[i])\n\t\t\tswap(A[i],A[r[i]]);\n\tfor(int mid=1;mid<term;mid<<=1)\n\t{\n\t\tint R=mid<<1;\n\t\tint Wn=quick(G[type],(mod-1)/R);\n\t\tfor(int j=0;j<term;j+=R)\n\t\t{\n\t\t\tint w=1;\n\t\t\tfor(int k=0;k<mid;k++,w=w*Wn%mod)\n\t\t\t{\n\t\t\t\tint x=A[j+k]%mod;\n\t\t\t\tint y=(w*A[j+k+mid])%mod;\n\t\t\t\tA[j+k]=(x+y)%mod;\n\t\t\t\tA[j+k+mid]=(x-y+mod)%mod; \n\t\t\t}\n\t\t}\n\t}\n\tif(type==1)\n\t{\n\t\tint inv=quick(term,mod-2);\n\t\tfor(int i=0;i<term;i++)\n\t\t{\n\t\t\tA[i]=A[i]*inv%mod;\n\t\t}\n\t}\n}\nvoid prepare()\n{\n\tinv[1]=1;\n\tg[0]=1;\n\tg[1]=k%mod;\n\tfor(int i=2;i<=n;i++)\n\t{\n\t\tinv[i]=(mod-mod/i)*inv[mod%i]%mod;\n\t\t//printf(\"%lld\\n\",i);\n\t}\n\tfor(int i=1;i<=n;i++)\n\t\tg[i]=g[i-1]*inv[i]%mod*(k+i-1)%mod;\n\tfor(int i=1;i<=n;i++)\n\t\tf[i]=a[i]*g[i-1]%mod;\n\treturn; \n}\nsigned main()\n{\n\tn=read();\n\tk=read();\n\tfor(int i=1;i<=n;i++)\n\t\ta[i]=read();\n\tprepare();\n\twhile(term<=n+n)\n\t{\n\t\tterm<<=1;\n\t\tl++;\n\t}\n\tfor(int i=0;i<term;i++)\n\t\tr[i]=(r[i>>1]>>1)|((i&1)<<(l-1));\n\tNTT(f,0);\n\tNTT(g,0);\n\tfor(int i=0;i<term;i++)\n\t\tf[i]=f[i]*g[i];\n\tNTT(f,1);\n\tfor(int i=1;i<=n;i++)\n\t\tprintf(\"%lld \",f[i]%mod);\n\treturn 0;\n}\n```",
        "postTime": 1615103461,
        "uid": 230804,
        "name": "Durancer",
        "ccfLevel": 4,
        "title": "\u9898\u89e3\uff1aP5641\u5f00\u62d3\u8005\u7684\u5353\u8bc6"
    },
    {
        "content": "# P5641 \u3010CSGRound2\u3011\u5f00\u62d3\u8005\u7684\u5353\u8bc6\n\n\u8003\u8651\u4e00\u4e2a\u6570 $a_i$\uff0c\u5bf9\u4e00\u6bb5\u533a\u95f4 $l,r$ \u7684\u8d21\u732e\u3002\n\n- $k = 1$ \u65f6\uff0c\u53ea\u8981 $l\\leq i\\leq r$ \u5c31\u80fd\u8d21\u732e $1$\uff0c\u5426\u5219\u662f $0$\u3002\n- $k = 2$ \u65f6\uff0c\u76f8\u5f53\u4e8e\u5728 $[l,r]$ \u91cc\u9009\u4e00\u4e2a\u5b50\u533a\u95f4 $l',r'$\uff0c\u4f7f\u5f97 $l\\leq l'\\leq i\\leq r'\\leq r$\u3002\n- $k = 3$ \u65f6\uff0c\u76f8\u5f53\u4e8e\u8981\u5728 $[l,r]$ \u91cc\u9009\u4e24\u5c42\u3002\u4e5f\u5c31\u662f $l\\leq l'\\leq l''\\leq i\\leq r''\\leq r'\\leq r$\u3002\n- ......\n\n\u8003\u8651\u679a\u4e3e $r$\u3002\u6c42 $r$ \u7684\u7b54\u6848\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a $i\\leq r$\uff0c\u5b83\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u7cfb\u6570\u662f\uff0c\u5728 $[1, i]$ \u9009 $k - 1$ \u4e2a\u7aef\u70b9\uff0c\u548c\u5728 $[i, r]$ \u9009 $k - 1$ \u4e2a\u7aef\u70b9\u7684\u65b9\u6848\u6570\u4e4b\u79ef\u3002\u7aef\u70b9\u53ef\u4ee5\u91cd\u590d\u3002\n\n\u8bbe\u5728\u4e00\u6bb5\u957f\u5ea6\u4e3a $x$ \u7684\u533a\u95f4\u91cc\uff0c\u9009 $k - 1$ \u4e2a\u53ef\u4ee5\u91cd\u590d\u7684\u70b9\u7684\u65b9\u6848\u6570\u4e3a $f(x)$\u3002\u8003\u8651\u6c42 $f(x)$\u3002\u53ef\u4ee5\u679a\u4e3e\u8fd9\u4e9b\u70b9\u5b9e\u9645\u5360\u7528\u4e86\u591a\u5c11\u4f4d\u7f6e\uff0c\u518d\u7528\u63d2\u677f\u6cd5\u3002\u4e0d\u96be\u5199\u51fa\uff1a$f(x) = \\sum_{i = 1}^{x} {x\\choose i}{k - 1\\choose i - 1}$\u3002\n\n$r$ \u7684\u7b54\u6848\uff0c\u53ef\u4ee5\u7528 $f$ \u8868\u793a\u4e3a\uff1a$\\text{ans}(r) = \\sum_{i = 1}^{r}a_i\\times f(i)\\times f(r - i + 1)$\u3002\n\n\u628a $f$ \u91cc\u7684\u7ec4\u5408\u6570 ${x\\choose i}$ \u62c6\u6210 $\\frac{x!}{i!(x - i)!}$\u3002\u5bb9\u6613\u53d1\u73b0\uff0c$f(x)$ \u548c $\\text{ans}(r)$ \u90fd\u662f\u5377\u79ef\u7684\u5f62\u5f0f\u3002\u53ef\u4ee5\u7528 NTT \u8ba1\u7b97\u3002\n\n\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u4e3a $k$ \u5f88\u5927\uff0c$f(x)$ \u5f0f\u5b50\u91cc\u7684 ${k - 1\\choose i - 1}$ \u5982\u679c\u62c6\u6210\u9636\u4e58\uff0c\u5219\u5904\u7406\u8d77\u6765\u8f83\u4e3a\u9ebb\u70e6\uff08\u9700\u8981\u6253\u8868\uff0c\u6216\u4f7f\u7528\u5feb\u901f\u9636\u4e58\u7b97\u6cd5\uff09\uff0c\u4e0d\u62c6\u5f00\u5219\u53ef\u4ee5\u76f4\u63a5\u9012\u63a8\u6c42\u51fa\uff0c\u8981\u7b80\u5355\u7684\u591a\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n\\log n)$\u3002\n\n\u53c2\u8003\u4ee3\u7801\uff1a\n\n```cpp\n// problem: P5641\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define mk make_pair\n#define fi first\n#define se second\n#define SZ(x) ((int)(x).size())\n\ntypedef unsigned int uint;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int, int> pii;\n\ntemplate<typename T> inline void ckmax(T& x, T y) { x = (y > x ? y : x); }\ntemplate<typename T> inline void ckmin(T& x, T y) { x = (y < x ? y : x); }\n\nconst int MAXN = 1e5;\nconst int MOD = 998244353;\n\ninline int mod1(int x) { return x < MOD ? x : x - MOD; }\ninline int mod2(int x) { return x < 0 ? x + MOD : x; }\ninline void add(int &x, int y) { x = mod1(x + y); }\ninline void sub(int &x, int y) { x = mod2(x - y); }\ninline int pow_mod(int x, int i) {\n\tint y = 1;\n\twhile (i) {\n\t\tif (i & 1) y = (ll)y * x % MOD;\n\t\tx = (ll)x * x % MOD;\n\t\ti >>= 1;\n\t}\n\treturn y;\n}\n\nint fac[MAXN + 5], ifac[MAXN + 5];\ninline int comb(int n, int k) {\n\tif (n < k) return 0;\n\treturn (ll)fac[n] * ifac[k] % MOD * ifac[n - k] % MOD;\n}\nvoid facinit(int lim = MAXN) {\n\tfac[0] = 1;\n\tfor (int i = 1; i <= lim; ++i) fac[i] = (ll)fac[i - 1] * i % MOD;\n\tifac[lim] = pow_mod(fac[lim], MOD - 2);\n\tfor (int i = lim - 1; i >= 0; --i) ifac[i] = (ll)ifac[i + 1] * (i + 1) % MOD;\n}\n\nnamespace NTT {\n\nint rev[MAXN * 4 + 5];\nint a[MAXN * 4 + 5], b[MAXN * 4 + 5];\nvoid NTT(int a[], int n, int flag) {\n\tfor (int i = 0; i < n; ++i) {\n\t\tif (i < rev[i]) {\n\t\t\tswap(a[i], a[rev[i]]);\n\t\t}\n\t}\n\tfor (int i = 1; i < n; i <<= 1) {\n\t\tint T = pow_mod(3, (MOD - 1) / (i << 1));\n\t\tif (flag == -1) T = pow_mod(T, MOD - 2);\n\t\tfor (int j = 0; j < n; j += (i << 1)) {\n\t\t\tfor (int k = 0, t = 1; k < i; ++k, t = (ll)t * T % MOD) {\n\t\t\t\tint Nx = a[j + k], Ny = (ll)a[i + j + k] * t % MOD;\n\t\t\t\ta[j + k] = (Nx + Ny) % MOD;\n\t\t\t\ta[i + j + k] = (Nx - Ny + MOD) % MOD;\n\t\t\t}\n\t\t}\n\t}\n\tif (flag == -1) {\n\t\tint inv_n = pow_mod(n, MOD - 2);\n\t\tfor (int i = 0; i < n; ++i) {\n\t\t\ta[i] = (ll)a[i] * inv_n % MOD;\n\t\t}\n\t}\n}\nvoid work(int _a[], int _b[], int _res[], int n, int m, int reslen) {\n\tint lim = 1, ct = 0;\n\twhile (lim <= n + m) {\n\t\tlim <<= 1, ct++;\n\t}\n\tfor (int i = 1; i < lim; ++i) {\n\t\trev[i] = (rev[i >> 1] >> 1) | ((i & 1) << (ct - 1));\n\t}\n\tfor (int i = 0; i < n; ++i) a[i] = _a[i];\n\tfor (int i = n; i < lim; ++i) a[i] = 0;\n\tfor (int i = 0; i < m; ++i) b[i] = _b[i];\n\tfor (int i = m; i < lim; ++i) b[i] = 0;\n\tNTT(a, lim, 1);\n\tNTT(b, lim, 1);\n\tfor (int i = 0; i < lim; ++i) a[i] = (ll)a[i] * b[i] % MOD;\n\tNTT(a, lim, -1);\n\tfor (int i = 0; i < reslen; ++i) _res[i] = a[i];\n}\n} // namespace NTT\n\n\nint n, K, a[MAXN + 5];\nint f[MAXN + 5], g[MAXN + 5];\n\nint main() {\n\tfacinit();\n\tcin >> n >> K;\n\tfor (int i = 1; i <= n; ++i) {\n\t\tcin >> a[i];\n\t\ta[i] = mod1(a[i]);\n\t}\n\tif (K == 1) {\n\t\tint sum = 0;\n\t\tfor (int i = 1; i <= n; ++i) {\n\t\t\tadd(sum, a[i]);\n\t\t\tcout << sum << \" \\n\"[i == n];\n\t\t}\n\t\treturn 0;\n\t}\n\t\n\t/*\n\tfor (int i = 1; i <= n; ++i) {\n\t\tfor (int j = 1; j <= i && j <= K - 1; ++j) {\n\t\t\tadd(f[i], (ll)comb(i, j) * comb(K - 2, j - 1) % MOD);\n\t\t}\n\t}\n\t*/\n\t\n\tf[1] = 1;\n\tfor (int i = 2; i <= n && i <= K - 1; ++i) {\n\t\tf[i] = (ll)f[i - 1] * (K - i) % MOD * ifac[i - 1] % MOD * fac[i - 2] % MOD;\n\t\t//f[i] = comb(K - 2, i - 1);\n\t}\n\tfor (int i = 1; i <= n && i <= K - 1; ++i) {\n\t\tf[i] = (ll)f[i] * ifac[i] % MOD;\n\t}\n\tfor (int i = 0; i <= n; ++i) {\n\t\tg[i] = ifac[i];\n\t}\n\tNTT :: work(f, g, f, n + 1, n + 1, n + 1);\n\tfor (int i = 1; i <= n; ++i) {\n\t\tf[i] = (ll)f[i] * fac[i] % MOD;\n\t}\n\t/*\n\tfor (int i = 1; i <= n; ++i) {\n\t\tint ans = 0;\n\t\tfor (int j = 1; j <= i; ++j) {\n\t\t\tadd(ans, (ll)a[j] * f[j] % MOD * f[i - j + 1] % MOD);\n\t\t}\n\t\tcout << ans << \" \\n\"[i == n];\n\t}\n\t*/\n\tfor (int i = 0; i < n; ++i) g[i] = f[i + 1];\n\tfor (int i = 1; i <= n; ++i) f[i] = (ll)f[i] * a[i] % MOD;\n\tNTT :: work(f, g, f, n + 1, n, n + 1);\n\tfor (int i = 1; i <= n; ++i)\n\t\tcout << f[i] << \" \\n\"[i == n];\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1609842201,
        "uid": 100674,
        "name": "duyi",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 P5641 \u3010\u3010CSGRound2\u3011\u5f00\u62d3\u8005\u7684\u5353\u8bc6\u3011"
    },
    {
        "content": "> \u5b9a\u4e49\n> $$\n> s_{l,r,k}=\\begin{cases}\\sum\\limits_{i=l}^ra_i&k=1\\\\\\sum\\limits_{i=l}^r\\sum\\limits_{j=l}^rs_{i,j,k-1}&\\mathtt{otherwise.}\\end{cases}\n> $$\n> \u6c42$s_{1,i,k}(i\\in[1,n])$\n\n\u8003\u8651\u8d21\u732e\u6cd5\n\n\u5bf9$a_i$,\u8bbe\u5728$k$\u91cd\u533a\u95f4\u5d4c\u5957\u4e2d\u4f1a\u88ab\u5305\u542b$w_i$\u6b21,\u5219\u7b54\u6848\u4e3a$\\sum\\limits_{i=1}^na_iw_i$\n\n\u6c42$w_i$,\u8f6c\u6362\u95ee\u9898\u4e3a\u627e\u5230$k$\u4e2a\u533a\u95f4$\\{(l_j,r_j)\\}(l_j\\leqslant l_{j+1}\\&r_j\\geqslant r_{j+1},(l_{j+1},r_{j+1})=(i,i))$\n\n\u53d1\u73b0\u4e24\u4e2a\u6761\u4ef6\u662f\u72ec\u7acb\u7684\uff0c\u6240\u4ee5\u5206\u522b\u8003\u8651\u5de6\u53f3\u8fb9\u754c\n\n\u5bf9\u5de6\u8fb9\u95ee\u9898\u62bd\u8c61\u4e3a\u4ece$i$\u5411\u5de6\u8d70$k$\u6b21\u6bcf\u6b21\u53ef\u4e0d\u8d70\u5171\u8981\u8d70$i-1$\u6b65\u7684\u65b9\u6848\u6570\n\n\u53d8\u6210$i-1$\u4e2a**\u76f8\u540c**\u5c0f\u7403\u653e\u5728$k$\u4e2a**\u4e0d\u540c**\u76d2\u5b50\uff0c\u8981\u6c42**\u53ef\u7a7a**\u7684\u65b9\u6848\u6570\n\n\u6240\u4ee5\u9694\u677f\u6cd5$\\binom{i+k-2}{k-1}$\u540c\u7406\u53f3\u8fb9$\\binom{r-i+k-1}{k-1}$\n\n\u53d1\u73b0$(i+k-2)+(r-i+k-1)$\u4e3a\u5b9a\u503c\u76f4\u63a5\u4ee5\u5f62\u4f3c\u7ec4\u5408\u6570\u4e3a\u7cfb\u6570\u7528\u4e24\u4e2a\u51fd\u6570\u5377\u79ef\u5373\u53ef",
        "postTime": 1596164590,
        "uid": 40629,
        "name": "zzw4257",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P5641 \u3010\u3010CSGRound2\u3011\u5f00\u62d3\u8005\u7684\u5353\u8bc6\u3011"
    },
    {
        "content": "\u8003\u8651\u4e00\u4e2a $a_i$ \u5bf9 $sum_{k,1,r}$ \u7684\u8d21\u732e\u3002\n\n\u53d1\u73b0\u6bcf\u4f5c\u4e00\u6b21\u8d21\u732e\uff0c\u5c31\u6709\u4e00\u4e2a\u5982\u4e0b\u8fc7\u7a0b\uff1a\u9009\u53d6\u4e00\u4e2a\u5305\u542b $i$ \u7684\u533a\u95f4\uff0c\u7136\u540e\u9009\u53d6\u4e00\u4e2a\u5305\u542b\u4e0a\u4e00\u4e2a\u9009\u5230\u7684\u533a\u95f4\uff0c\u4e00\u5171\u9009 $k$ \u4e2a\u533a\u95f4\uff0c\u6700\u540e\u4e00\u4e2a\u5c31\u662f $[1,r]$\u3002\n\n\u4e3a\u4ec0\u4e48\u662f $k$ \u6b21\u800c\u4e0d\u662f $k-1$\uff1f~~\u6050\u6015\u53ea\u6709\u6211\u624d\u4f1a\u60f3\u8fd9\u79cd\u95ee\u9898~~\u56e0\u4e3a\u5e76\u975e\u7b2c\u4e00\u4e2a\u4e00\u5b9a\u8981\u9009 $[i,i]$\uff0c\u6839\u636e $sum$ \u7684\u5b9a\u4e49\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u9009\u53d6\u533a\u95f4\u5de6\u7aef\u70b9\u7684\u65b9\u6848\u4e0e\u53f3\u7aef\u70b9\u7684\u662f\u72ec\u7acb\u7684\uff0c\u4e8e\u662f\u5206\u5f00\u6c42\u89e3\u6700\u540e\u76f8\u4e58\u3002\u8003\u8651\u5de6\u8fb9 $[1,i]$ \u4e2d\u7684\u65b9\u6848\u3002\u8bb0\u5de6\u7aef\u70b9\u4e3a $l$\u3002\n\n\u56e0\u4e3a $l$ \u59cb\u7ec8 $\\leq i$\uff0c\u6240\u4ee5\u628a $l$ \u7684\u4e0d\u65ad\u9009\u53d6\u770b\u4f5c\u4ece $i$ \u5411\u5de6\u79fb\u52a8\u7684\u8fc7\u7a0b\u3002**\u4efb\u4f55\u4e00\u6b21\u90fd\u53ef\u4ee5\u79fb\u52a8 $0$ \u6b65**\u3002\u6700\u540e\u603b\u662f\u5230\u8fbe $1$ \u7684\u3002\u95ee\u9898\u5c31\u6210\u4e86\uff1a\n\n\u9700\u8981\u4f5c\u51fa $i-1$ \u4e2a\u4f4d\u79fb\uff0c$k$ \u6b21\u884c\u52a8\uff0c\u95ee\u64cd\u4f5c\u5e8f\u5217\u6570\u3002\n\n\u8fd9\u5c31\u662f\u9694\u677f\u7684\u95ee\u9898\u4e86\u3002\u5177\u4f53\u7684\u53ef\u4ee5\u770b\u770b\u5176\u4ed6\u9898\u76ee\uff0c\u4e0d\u7ec6\u8bf4\u3002\n\n\u5982\u679c\u6709 $n$ \u4e2a\u4f4d\u79fb\uff0c$m$ \u6b21\u884c\u52a8\uff0c\u5219\u65b9\u6848\u6570\u4e3a\n\n$$\\binom{n+m-1}{m-1}$$\n\n\u672c\u9898\u5373\u4e3a\n\n$$\\binom{i+k-2}{k-1}$$\n\n\u53f3\u7aef\u70b9\u7684\u65b9\u6848\u7c7b\u4f3c\uff0c\u662f\n\n$$\\binom{r-i+k-1}{k-1}$$\n\n\u6211\u4eec\u5f97\u5230\n\n$$sum_{k,1,r}=\\sum_{i=1}^ra_i\\binom{i+k-2}{k-1}\\binom{r-i+k-1}{k-1}$$\n\n\u8fd9\u4e2a\u4e1c\u897f\u770b\u4e0a\u53bb\u5f88\u53cb\u597d\u3002\n\n\u8bbe\n\n$$f_i=\\binom{i+k-1}{k-1}$$\n\n$$g_i=a_if_{i-1}$$\n\n\u6709\n\n$$sum_{k,l,r}=\\sum_{i=1}^rg_if_{r-i}$$\n\n\u5f97\u5230\u5377\u79ef\uff0cNTT\u76f4\u63a5\u7b97\u5373\u53ef\u3002\n\n\u4f46\u662f\u672c\u9898\u4e2d\u7ec4\u5408\u6570\u7684\u8303\u56f4\u8f83\u5927\uff0c\u53ef\u4ee5\u7531 $\\binom{n-1}m$\u76f4\u63a5\u63a8\u5230 $\\binom n m$\uff0c\u5269\u4e0b\u53ea\u8981\u628a\u9006\u5143\u63a8\u5230 $n$ \u5373\u53ef\u3002\n\n\u6ce8\u610f $f_0,g_0$ \u7684\u95ee\u9898\uff1a$f_0$ \u6839\u636e\u5b9a\u4e49\u662f $1$,\u800c $g_0$ \u9700\u53bb\u9664\u5f0f\u5b50\u4e2d $i=0$ \u9879\u7684\u8d21\u732e\u800c\u8bbe\u6210 $0$\u3002\n\n```cpp\n#include <cstdio>\n#include <iostream>\n#include <cstring>\n#include <algorithm>\n\ntypedef long long ll;\nconst int p = 998244353;\nconst int MAXN = 400001;\n\ninline ll read() {\n    ll x = 0,f = 1; char ch = getchar();\n    while(ch > '9' || ch < '0') { if(ch == '-') f = -1; ch = getchar(); }\n    do x = (x * 10 + ch - 48) % p, ch = getchar(); while(ch >= '0' && ch <= '9');\n    return (x * f % p + p) % p;\n}\n\nint n,k,r[MAXN];\nll a[MAXN],f[MAXN],g[MAXN];\nll inv[MAXN];\n\nll fastpow(ll a,int b) {\n    ll res = 1; a %= p;\n    while(b) {\n        if(b & 1) res = res * a % p;\n        a = a * a % p;\n        b >>= 1;\n    }\n    return res;\n}\n\nvoid NTT(ll *a,int N) {\n    for(int i = 0;i < N;i++) if(i < r[i]) std::swap(a[i],a[r[i]]);\n    for(int n = 2,m = 1;n <= N;m = n, n <<= 1) {\n        ll g1 = fastpow(3,(p - 1) / n);\n        for(int l = 0;l < N;l += n) {\n            ll g = 1,t1,t2;\n            for(int i = l;i < l + m;i++) {\n                t1 = a[i], t2 = g * a[i + m] % p;\n                a[i] = (t1 + t2) % p;\n                a[i + m] = (t1 - t2 + p) % p;\n                g = g * g1 % p;\n            }\n        }\n    }\n    return;\n}\n\nvoid INTT(ll *a,int N) {\n    NTT(a,N);\n    std::reverse(a + 1,a + N);\n    int invN = fastpow(N,p - 2);\n    for(int i = 0;i < N;i++) a[i] = a[i] * invN % p;\n}\n\nint main() {\n    n = read(), k = read();\n    for(int i = 1;i <= n;i++) a[i] = read();\n    int N = 1, l = -1; while(N <= n << 1) N <<= 1, l++;\n    for(int i = 1;i < N;i++) r[i] = (r[i >> 1] >> 1) | ((i & 1) << l);\n    inv[1] = 1;\n    for(int i = 2;i < n;i++) inv[i] = inv[p % i] * (p - p / i) % p;\n    f[0] = 1;\n    for(int i = 1;i <= n;i++) f[i] = f[i - 1] * (i + k - 1) % p * inv[i] % p;\n    for(int i = 1;i <= n;i++) g[i] = a[i] * f[i - 1] % p;\n    NTT(f,N); NTT(g,N);\n    for(int i = 0;i < N;i++) f[i] = f[i] * g[i] % p;\n    INTT(f,N);\n    for(int i = 1;i <= n;i++) std::printf(\"%lld \",f[i]);\n    return 0;\n}\n\n```",
        "postTime": 1593876886,
        "uid": 219595,
        "name": "Vocalise",
        "ccfLevel": 9,
        "title": "\u8ba1\u6570+NTT--\u9898\u89e3 P5641 \u3010\u3010CSGRound2\u3011\u5f00\u62d3\u8005\u7684\u5353\u8bc6\u3011"
    },
    {
        "content": "# LG 11 \u6708 \u6708\u8d5b II T4\n\n\u770b\u5230\u819c\u6570\u548c $ 10^5 $ \u4ee5\u53ca $ n^2 $ \u7684\u90e8\u5206\u5206\u60f3\u5230\u5f88\u53ef\u80fd\u662f NTT \u4e8e\u662f\u5f00\u59cb\u63a8\u5f0f\u5b50\n\n\u9996\u5148\u770b\u5230\u5f0f\u5b50\u53ef\u4ee5\u5316\u4f5c\uff0c\n\n- \u5982\u679c $k = 0$ , $ f(l , r , k) $ \u4e3a $ [l = r]a[l] $\n- \u5426\u5219\uff0c$ f(l , r , k) $ \u4e3a $ \\displaystyle \\sum_{\\forall [a,b] \\subset [l,r]} f(a,b,k-1) $ \u6bd4\u8f83\u901a\u4fd7\u7684\u8bed\u8a00\u5c31\u662f\u5bf9\u4e8e $ [l,r] $ \u7684\u6240\u6709\u5b50\u533a\u95f4\u6c42 $ f(a,b,k-1) $ \u7684\u548c\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $ a[i] $ \u7684\u8d21\u732e\uff0c\u5176\u5b9e\u5c31\u662f\u5de6\u7aef\u70b9\u5230 $ i $ \u4ee5\u53ca\u53f3\u7aef\u70b9\u5230 $ i $ \u5206\u522b\u9009\u62e9 $ k $ \u4e2a\u4f4d\u7f6e\uff0c\u8fd9\u4e2a\u5c31\u662f\u7ecf\u5178\u7684\u9694\u677f\u6cd5\u4e86\u3002\u6700\u540e\u7684\u5f0f\u5b50\uff1a\n\n$ sum_{1, r, k}=\\sum_{i=1}^{r} a_{i}\\left(\\begin{array}{c}{i+k-2} \\\\ {k-1}\\end{array}\\right)\\left(\\begin{array}{c}{r-i+k-1} \\\\ {k-1}\\end{array}\\right) $\n\n\u7136\u800c\u51fa\u9898\u4eba\u628a $ k $ \u653e\u5230\u4e86 $ 998244353 $ \u7ea7\u522b\uff0c\u4e8e\u662f\u53ea\u6709\u5206\u5757\u6253\u4e2a\u8868\u8fc7\u53bb\u4e86\uff0c\u4e0d\u77e5\u9053\u6709\u6ca1\u6709\u4ec0\u4e48\u66f4\u4f18\u79c0\u7684\u5904\u7406\u65b9\u6cd5\u4e86\uff08\n\n(\u4ee3\u7801\u4e2d\u7701\u7565\u4e86\u8868\u3002\u3002\u6bd5\u7adf\u592a\u957f\u4e86)\n\n```cpp\n#include<iostream>\n#include<algorithm>\n#include<cstring>\n#include<cstdio>\nusing namespace std;\n//#define int long long\n#define MAXN 1000006\n#define P 998244353\ntypedef long long ll;\nint n , k;\nint power( int a , int x ) {\n    int ans = 1 , cur = a % P;\n    while( x ) {\n        if( x & 1 ) ans = 1ll * ans * cur % P;\n        cur = 1ll * cur * cur % P , x >>= 1;\n    }\n    return ans;\n}\nint A[MAXN] , B[MAXN] , r[MAXN];\ninline void NTT(int* a, int len, int type) {\n    for (int i = 0; i < len; i++) if (i < r[i]) swap(a[i], a[r[i]]);\n    for (int mid = 2; mid <= len; mid <<= 1) {\n        int Wn = power(3, type ? (P - 1) / mid : P - 1 - (P - 1) / mid);\n        for (int i = 0; i < len; i += mid)\n            for (int j = i, w = 1, t; j < i + (mid >> 1); j++, w = (ll)w * Wn % P)\n                t = (ll)w * a[j + (mid >> 1)] % P, a[j + (mid >> 1)] = (a[j] - t + P) % P, a[j] = (a[j] + t) % P;\n    }\n    if (!type) for (int inv = power(len, P - 2), i = 0; i < len; i++) a[i] = (ll)a[i] * inv % P;\n}\nint J[MAXN];\nconst int jj[] = {/* ... */};\nint jk = 0;\nint getJ( int x ) {\n    int cur = k , res = jk;\n    while( cur + 1 <= x ) ++ cur , res = 1ll * res * cur % P;\n    while( cur - 1 >= x ) res = 1ll * res * power( cur , P - 2 ) % P , -- cur;\n    return res;\n}\nsigned main() {\n//    freopen(\"input\",\"r\",stdin);\n\n    cin >> n >> k;\n    if( k == 1 ) {\n        for( int i = 1 ; i <= n ; ++ i ) scanf(\"%d\",&A[i]) , A[i] = ( A[i] + A[i - 1] ) % P , printf(\"%d \",A[i]);\n        return 0;\n    }\n    J[0] = 1; for( int i = 1 ; i < MAXN ; ++ i ) J[i] = 1ll * J[i - 1] * i % P;\n    jk = jj[k / 1000000];\n    for( int r = k / 1000000 * 1000000 + 1 ; r <= k ; ++ r )\n        jk = 1ll * jk * r % P;\n    int re = getJ( k - 2 ) , re1 = getJ( k - 1 );\n//    cout << getJ( 10000000 ) << endl;\n    int tm = re1;\n    B[0] = re1;\n    for( int i = 1 ; i <= n ; ++ i )\n        scanf(\"%d\",&A[i]) , re = 1ll * re * ( i + k - 2 ) % P , re1 = 1ll * re1 * ( i + k - 1 ) % P ,\n                A[i] = 1ll * A[i] * re % P * power( J[i - 1] , P - 2 ) % P ,\n                B[i] = 1ll * re1 * power( J[i] , P - 2 ) % P;\n    int len = 1, l = 0;\n    while (len <= n * 2) len <<= 1, l++;\n    for (int i = 0; i < len; i++) r[i] = (r[i >> 1] >> 1) | ((i & 1) << l - 1);\n    NTT( A , len , 1 ) , NTT( B , len , 1 );\n    for( int i = 0 ; i < len ; ++ i ) A[i] = 1ll * A[i] * B[i] % P;\n    NTT( A , len , 0 );\n    int x = power( 1ll * tm * tm % P , P - 2 );\n    for( int i = 1 ; i <= n ; ++ i ) printf(\"%d \", (int) (1ll * x * A[i] % P) );\n}\n\n\n```\n",
        "postTime": 1573346970,
        "uid": 63398,
        "name": "yijan",
        "ccfLevel": 8,
        "title": "P5641 \u9898\u89e3"
    }
]