[
    {
        "content": "### \u9898\u89e3\r\n\r\n\u524d\u7f00\u548c\u9898\u3002\r\n\r\n\u6ce8\u610f\u5230 $M$ \u77e9\u9635\u53ef\u4ee5\u770b\u4f5c $B$ \u77e9\u9635\u5728\u884c\u4e0a\u957f\u5ea6\u4e3a $r$ \u7684\u5faa\u73af\uff0c\u5728\u5217\u4e0a\u957f\u5ea6\u4e3a $c$ \u7684\u5faa\u73af\uff0c\u5bb9\u6613\u60f3\u5230\u5c06\u539f\u6765\u7684 $A$ \u77e9\u9635\u4e5f\u6309\u7167\u8fd9\u4e24\u4e2a\u65b9\u5411\u4e0a\u7684\u5faa\u73af\u8fdb\u884c\u67d3\u8272\u3002\u4f7f\u7528 $r\\times c$ \u79cd\u989c\u8272\u67d3\u8272\u3002\r\n\r\n![](https://cdn.luogu.com.cn/upload/image_hosting/wpccpxoy.png)\r\n\r\n\u8fd9\u6837\u5b50\u6709\u4ec0\u4e48\u597d\u5904\u5462\uff1f\u6211\u4eec\u8fdb\u884c\u4e00\u4e2a\u7279\u6b8a\u7684\u4e8c\u7ef4\u524d\u7f00\u548c\u3002\r\n\r\n$$S_{i,j}=A_{i,j}+S_{i-r,j}+S_{i,j-c}-S_{i-r,j-c}$$\r\n\r\n\u90a3\u6bd4\u5982\u8bf4 $(4,7)$ \u4f4d\u7f6e\u3002$S_{4,7}$ \u7684\u503c\u5c31\u662f $a_{2,1}+a_{2,4}+a_{2,7}+a_{4,1}+a_{4,4}+a_{4,7}$\u3002\u6362\u8a00\u4e4b\uff0c**\u6211\u4eec\u5bf9\u6bcf\u79cd\u989c\u8272\u90fd\u505a\u4e86\u4e00\u6b21\u4e8c\u7ef4\u524d\u7f00\u548c**\u3002\r\n\r\n\u6bd4\u5982\uff0c\u73b0\u5728\u9700\u8981\u8ba1\u7b97\u5de6\u4e0a\u89d2\u3001\u53f3\u4e0b\u89d2\u5206\u522b\u4e3a $(3,4),(5,7)$ \u7684\u5b50\u77e9\u9635\u91cc\uff0c\u6240\u6709**\u7eff\u8272**\u5143\u7d20\u7684\u548c\u3002\u90a3\u4e48\u7b54\u6848\u5c31\u662f\uff0c\r\n\r\n$$S_{5,7}-S_{1,7}-S_{5,1}+S_{1,1}$$\r\n\r\n\u66f4\u4e00\u822c\u5730\uff0c\u5982\u679c\u6211\u4eec\u5e0c\u671b\u8ba1\u7b97\u5de6\u4e0a\u89d2\u3001\u53f3\u4e0b\u89d2\u5206\u522b\u4e3a $(x_1,y_1),(x_2,y_2)$ \u7684\u5b50\u77e9\u9635\uff08$(x_1,y_1)$\uff0c$(x_2,y_2)$ \u4e24\u4e2a\u4f4d\u7f6e\u7684\u989c\u8272\u76f8\u540c\uff0c\u8bbe\u4e3a $t$\uff09\u91cc\uff0c\u6240\u6709\u989c\u8272\u4e3a $t$ \u7684\u5143\u7d20\u4e4b\u548c\uff0c\u7b54\u6848\u5c31\u662f\uff1a\r\n\r\n$$S_{x_2,y_2}-S_{x_2,y_1-c}-S_{x_1-r,y_2}+S_{x_1-r,y_1-c}$$\r\n\r\n\u73b0\u5728\u8003\u5bdf\u4e00\u6b21\u8be2\u95ee\u3002\r\n\r\n![](https://cdn.luogu.com.cn/upload/image_hosting/5gwrso3i.png)\r\n\r\n\u5bb9\u6613\u53d1\u73b0\uff0c\u6211\u4eec\u9009\u53d6\u8be2\u95ee\u77e9\u9635\u5de6\u4e0a\u89d2\u8fd9\u4e2a $r\\times c$ \u7684\u5c0f\u77e9\u9635\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5c0f\u77e9\u9635\u91cc\u9762\u5e94\u8be5\u6bcf\u79cd\u989c\u8272\u90fd\u6070\u597d\u51fa\u73b0\u4e86\u4e00\u6b21\u3002\u5f53\u7136\u8fd9\u4e0d\u662f\u91cd\u70b9\uff0c\u91cd\u70b9\u662f\u77e9\u9635\u91cc\u6240\u6709\u989c\u8272\u90fd\u4f1a\u5728\u8fd9\u4e2a\u5c0f\u77e9\u9635\u51fa\u73b0\u4e00\u6b21\u3002\u5e76\u4e14\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e $B$ \u77e9\u9635\u7b97\u51fa\uff0c\u54ea\u4e9b\u989c\u8272\u5bf9\u5e94\u7684 $A_{i,j}$ \u503c\u662f\u9700\u8981\u88ab\u8ba1\u7b97\u7684\u3002\r\n\r\n\u5bb9\u6613\u8ba1\u7b97\u51fa\u5c0f\u77e9\u9635\u91cc\u7684\u6bcf\u79cd\u989c\u8272\uff0c\u5728\u5927\u77e9\u9635\uff08\u8be2\u95ee\u7684\u90a3\u4e2a\u77e9\u9635\uff09\u91cc\u5bf9\u5e94\u7684\u77e9\u9635\u7684\u5de6\u4e0a\u89d2\u3001\u53f3\u4e0b\u89d2\u5750\u6807\u3002\u5bf9\u4e8e\u6bcf\u79cd\u989c\u8272\uff0c\u90fd\u505a\u4e00\u6b21\u4e8c\u7ef4\u524d\u7f00\u548c\u5373\u53ef\u3002\r\n\r\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O(nm+qrc)$\u3002\r\n\r\n### \u53c2\u8003\u4ee3\u7801\r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\n#define up(l, r, i) for(int i = l, END##i = r;i <= END##i;++ i)\r\n#define dn(r, l, i) for(int i = r, END##i = l;i >= END##i;-- i)\r\nusing namespace std;\r\ntypedef long long i64;\r\nconst int INF = 2147483647;\r\nint n, m, r, c, q;\r\nint qread(){\r\n    int w=1,c,ret;\r\n    while((c = getchar()) >  '9' || c <  '0') w = (c == '-' ? -1 : 1); ret = c - '0';\r\n    while((c = getchar()) >= '0' && c <= '9') ret = ret * 10 + c - '0';\r\n    return ret * w;\r\n}\r\nconst int MAXN = 2e3 + 3;\r\nconst int MAXM =  50 + 3;\r\nconst int MOD  = 998244353;\r\nint A[MAXN][MAXN], S[MAXN][MAXN]; bool B[MAXN][MAXN];\r\nint calc(int a1, int b1, int a2, int b2){\r\n    int ret = S[a2][b2];\r\n    if(a1 > r) ret = (ret - S[a1 - r][b2] + MOD) % MOD;\r\n    if(b1 > c) ret = (ret - S[a2][b1 - c] + MOD) % MOD;\r\n    if(a1 > r && b1 > c) ret = (ret + S[a1 - r][b1 - c]) % MOD;\r\n    return ret;\r\n}\r\nint main(){\r\n    n = qread(), m = qread();\r\n    up(1, n, i) up(1, m, j) A[i][j] = qread();\r\n    r = qread(), c = qread();\r\n    up(1, r, i) up(1, c, j) B[i][j] = qread();\r\n    up(1, n, i) up(1, m, j){\r\n        S[i][j] = A[i][j];\r\n        if(i > r) S[i][j] = (S[i][j] + S[i - r][j]) % MOD;\r\n        if(j > c) S[i][j] = (S[i][j] + S[i][j - c]) % MOD;\r\n        if(i > r && j > c)\r\n            S[i][j] = (S[i][j] - S[i - r][j - c] + MOD) % MOD;\r\n    }\r\n    q = qread();\r\n    up(1, q, i){\r\n        int _x1 = qread(), _y1 = qread();\r\n        int _x2 = qread(), _y2 = qread();\r\n        int ans = 0;\r\n        up(1, min(r, _x2 - _x1 + 1), a)\r\n            up(1, min(c, _y2 - _y1 + 1), b) if(B[a][b] == 0){\r\n                int a1 = _x1 + a - 1, a2 = a1 + (_x2 - a1) / r * r;\r\n                int b1 = _y1 + b - 1, b2 = b1 + (_y2 - b1) / c * c;\r\n                ans = (ans + calc(a1, b1, a2, b2)) % MOD;\r\n        }\r\n        printf(\"%d\\n\", ans);\r\n    }\r\n    \r\n    return 0;\r\n}\r\n\r\n```",
        "postTime": 1669510792,
        "uid": 68344,
        "name": "\u79bb\u6563\u5c0f\u6ce2\u53d8\u6362\u00b0",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P8875 \u3010[\u4f20\u667a\u676f #5 \u521d\u8d5b] G-\u4e8c\u4eba\u7684\u82b1\u7eb9\u7eb8\u6e38\u620f\u3011"
    }
]