[
    {
        "content": "\u8fd9\u662f\u300cDaniel13265 \u7684\u516c\u5f00\u8d5b\u300d\u7684\u5b98\u65b9\u9898\u89e3\u3002\n\n---\n\n### \u6d4b\u8bd5\u70b9 $1,2,3$\n\n\u7559\u7ed9\u6240\u6709\u666e\u901a\u6743\u503c\u7ebf\u6bb5\u6811\u4ee5\u53ca\u5e38\u6570\u6b63\u5e38\u7684\u5e73\u8861\u6811\u3002\n\n---\n\n### \u6d4b\u8bd5\u70b9 $4,5$\n\n\u7559\u7ed9\u5e38\u6570\u4f18\u79c0\u7684\u5e73\u8861\u6811\u3002\n\n---\n\n### \u6d4b\u8bd5\u70b9 $6,7$\n\n\u7559\u7ed9\u5e38\u6570\u6781\u5176\u4f18\u79c0\u7684\u5e73\u8861\u6811\uff08\u6000\u7591\uff1f\uff09\u4e0e\u5404\u79cd\u4e71\u641e\u3002\n\n---\n\n\u6807\u7a0b\u662f\u57fa\u4e8e\u6743\u503c\u7ebf\u6bb5\u6811\u7684\u4e71\u641e\u3002\n\n\u9996\u5148\u7528\u6743\u503c\u6570\u7ec4\u5b58\u50a8\u4e00\u4e2a\u6570\u662f\u5426\u5728\u96c6\u5408\u4e2d\uff0c\u7136\u540e\u5c06\u5b83\u7684\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u770b\u4f5c\u4e00\u4e2a\u53f6\u5b50\u7ed3\u70b9\u5efa\u7acb\u4e00\u68f5\u5b8c\u5168 $\\omega$ \u53c9\u6811\uff0c\u6bcf\u4e00\u4e2a\u975e\u53f6\u5b50\u7ed3\u70b9\u538b\u4f4d\u5b58\u50a8\u5b83\u7684\u54ea\u4e9b\u5b50\u7ed3\u70b9\u6240\u4ee3\u8868\u7684\u503c\u57df\u533a\u95f4\u6709\u975e\u96f6\u503c\u3002\u90a3\u4e48\u64cd\u4f5c $1,2$ \u4e0e\u8be2\u95ee $3,4,5,6$ \u90fd\u662f\u5f88\u7b80\u5355\u7684\u4e86\uff0c\u63a5\u4e0b\u6765\u8003\u8651\u8be2\u95ee $7,8$\u3002\n\n\u8fd9\u91cc\u53ea\u8ba8\u8bba\u8be2\u95ee $7$\uff0c\u56e0\u4e3a\u8be2\u95ee $8$ \u540c\u7406\u3002\u9996\u5148\u5982\u679c $x=0$ \u5219\u8fd4\u56de `-1`\uff1b\u5426\u5219\u8003\u8651\u4ece\u6811\u7684\u5e95\u7aef\u4ee3\u8868 $x$ \u7684\u7ed3\u70b9\u5411\u4e0a\u67e5\u8be2\u3002\u5047\u8bbe\u67e5\u8be2\u5230\u4e86\u5f53\u524d\u7684\u975e\u6839\u7ed3\u70b9\uff0c\u5982\u679c\u8be5\u7ed3\u70b9\u7236\u7ed3\u70b9\u5728\u5f53\u524d\u7ed3\u70b9\u6216\u8005\u5de6\u4fa7\u7684\u513f\u5b50\u7ed3\u70b9\u6709\u975e\u96f6\u503c\uff0c\u8bf4\u660e\u627e\u5230\u4e86\u6240\u9700\u7684\u5c0f\u4e8e $x$ \u7684\u503c\uff0c\u4e8e\u662f\u5411\u4e0b\u4e0d\u65ad\u9760\u53f3\u6c42\u51fa\u5177\u4f53\u4f4d\u7f6e\uff1b\u5982\u679c\u6ca1\u6709\uff0c\u8bf4\u660e\u8be5\u7ed3\u70b9\u7684\u7236\u7ed3\u70b9\u6240\u4ee3\u8868\u7684\u503c\u57df\u533a\u95f4\u8fd8\u6ca1\u6709\u627e\u5230\uff0c\u4e8e\u662f\u7ee7\u7eed\u5411\u4e0a\u67e5\u627e\u5373\u53ef\u3002\u5230\u8fbe\u4e86\u6839\u7ed3\u70b9\u8fd8\u6ca1\u6709\u627e\u5230\u5c31\u8bf4\u660e\u96c6\u5408\u4e2d\u6ca1\u6709\u5c0f\u4e8e $x$ \u7684\u6570\uff0c\u8fd4\u56de `-1` \u5373\u53ef\u3002\n\n\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u7684\u603b\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a\n\n$$\\sum_{k=1}^{\\log_\\omega n}\\mathcal O\\left(\\frac n{\\omega^k}\\right)=\\mathcal O\\left(\\frac n\\omega\\right)$$\n\n\n\u660e\u663e\uff0c\u5355\u6b21 $1,2$ \u64cd\u4f5c\u4e0e\u8be2\u95ee $3,4,7,8$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662f $\\mathcal O\\left(\\log_\\omega n\\right)$\uff0c\u800c\u8be2\u95ee $5,6$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal O(1)$ \u7684\u3002\n\n\u5b9e\u9645\u4e0a\uff0c\u5982\u679c\u53d6 $\\omega=2^6,n=2^{30}$\uff0c\u90a3\u4e48\u65f6\u95f4\u590d\u6742\u5ea6\u4e2d\n\n$$\\log_\\omega n=\\log_{2^6}2^{30}=5$$\n\n\u751a\u81f3\u53ef\u4ee5\u770b\u4f5c\u4e3a\u5e38\u6570\u3002\u5e38\u6570\u6700\u5927\u7684\u4e3a\u8be2\u95ee $7,8$\uff0c\u7ea6\u4e3a\u64cd\u4f5c $1,2$ \u4e0e\u8be2\u95ee $3,4$ \u7684\u5e38\u6570\u7684 $2$ \u500d\u3002\u6807\u79f0\u5728\u6d4b\u8bd5\u70b9 $4,5$ \u4e0e\u6d4b\u8bd5\u70b9 $6,7$ \u4e4b\u95f4\u4f53\u73b0\u51fa\u6765\u7684\u63a5\u8fd1\u4e00\u534a\u7684\u65f6\u95f4\u5dee\u5c31\u5728\u4e8e\u6570\u636e\u4e2d\u8be2\u95ee $7,8$ \u7684\u4e2a\u6570\u5dee\u3002\n\n\n\u5f53\u6570\u7684\u503c\u57df $n$ \u4e0e\u64cd\u4f5c\u4e2a\u6570 $m$ \u6ee1\u8db3 $n\\le m\\cdot\\omega$ \u65f6\uff0c\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u53ef\u4ee5\u4ee3\u66ff `std::set<unsigned int, std::less<unsigned int>, std::allocator<unsigned int>>`\uff08C++17 \u524d\uff09`std::pmr::set<unsigned int, std::less<unsigned int>, std::pmr::polymorphic_allocator<unsigned int>>`\uff08C++17 \u8d77\uff09\uff0c\u56e0\u4e3a\u524d\u8005\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u548c\u7a7a\u95f4\u590d\u6742\u5ea6\u90fd\u4f18\u79c0\u4e8e\u540e\u8005\u3002",
        "postTime": 1584887467,
        "uid": 55251,
        "name": "Daniel13265",
        "ccfLevel": 10,
        "title": "\u300cDaniel13265 \u7684\u516c\u5f00\u8d5b\u300d\u9898\u89e3\u3010\u96c6\u5408\u3011"
    },
    {
        "content": "\u8fd9\u4e2a\u9898\u5927\u4f53\u601d\u8def\u51fa\u9898\u4eba\u8bf4\u4e86\uff0c\u5c31\u662f\u516d\u5341\u56db\u53c9\u6743\u503c\u7ebf\u6bb5\u6811\u3002\u6bcf\u4e2a\u8282\u70b9\u72b6\u538b\u4e00\u4e0b\u5f53\u524d\u8282\u70b9\u54ea\u4e9b\u513f\u5b50\u5b58\u5728\u3002   \n\n- `update` \u51fd\u6570\u5c31\u57fa\u672c\u4e0e\u6b63\u5e38\u6743\u503c\u7ebf\u6bb5\u6811\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\u6362\u6210 `rt<<6` \u3002    \n\n- \u7531\u4e8e\u6211\u6ca1\u6709\u7ef4\u62a4\u6bcf\u4e2a\u8282\u70b9\u7684 $siz$ \uff0c\u6240\u4ee5 `getmin` \u548c `getmax` \u88ab\u5206\u6210\u4e24\u4e2a\u51fd\u6570\u5199\u3002   \n\n- \u81f3\u4e8e\u67e5\u8be2\u533a\u95f4\u6700\u503c\u7684\uff0c\u5c31\u5982\u51fa\u9898\u4eba\u6240\u8bf4\uff0c\u5148\u7528 `getpos` \u627e\u5230\u8fd9\u4e2a\u5206\u5272\u70b9\uff0c\u518d\u8fde\u7eed\u5411\u4e0a\u8df3\u3002   \n\n\u6ce8\u610f\uff0c\u7531\u4e8e\u672c\u4eba\u672a\u77e5\u7684\u539f\u56e0\uff0c\u5728 `unsigned long long` \u4e0b `~0ull` \u4e0e `(1ull<<64)-1` \u76f8\u7b49\uff0c\u5374\u4e0e `x=64,(1ull<<x)-1` \u4e0d\u7b49\u3002\u5bfc\u81f4\u591a\u6b21 WA\u3002\u6240\u4ee5\u6211\u4ee3\u7801\u91cc\u6240\u6709\u4f4d\u79fb\u64cd\u4f5c\u90fd\u662f\u7528\u7684 `__int128` \u3002   \n\n\u4ee5\u4e0b\u662f\u4ee3\u7801\uff08\u9644\u5e26\u7b80\u8981\u8bf4\u660e\uff09\uff1a  \n```cpp\n#include<cstdio>\nconst int N=(1<<26);//\u6811\u7684\u8282\u70b9\u4e0d\u5305\u542b\u6700\u540e\u4e00\u5c42\u54e6\nint n,m,siz;\nunsigned long long t[N],sum;\nint lowp[(1<<16)+10],uppb[(1<<16)+10];//\u5b58(1<<16)\u4ee5\u5185\u7684\u6700\u4f4e\u4f4d\u3001\u6700\u9ad8\u4f4d\nint lowbit(unsigned long long x)\n{\n\tif(x&0xffffull)return lowp[x&0xffffull];x>>=16;\n\tif(x&0xffffull)return lowp[x&0xffffull]+16;x>>=16;\n\tif(x&0xffffull)return lowp[x&0xffffull]+32;x>>=16;\n\tif(x&0xffffull)return lowp[x&0xffffull]+48;\n\treturn -1;//\u5206\u56db\u6bb5\u627e\u6700\u4f4e\u4f4d\uff08\u6ce8:0xffff=(1<<16)-1\uff09\n}\nint uppbit(unsigned long long x)\n{\n\tif(x>>48)return uppb[x>>48]+48;\n\tif(x>>32)return uppb[x>>32]+32;\n\tif(x>>16)return uppb[x>>16]+16;\n\tif(x)return uppb[x];\n\treturn -1;//\u5206\u56db\u6bb5\u627e\u6700\u9ad8\u4f4d\n}\nvoid update(int rt,int l,int r,int p)\n{\n\tif(r-l+1<=64){t[rt]^=(((__int128)(1))<<(p-l));return;}\n\tint len=(r-l+1)>>6,q=(p-l)/len;\n    //\u5b50\u8282\u70b9\u533a\u95f4\u957f\u5ea6\u4e3alen\uff0c\u6240\u627e\u8282\u70b9\u4e3a\u7b2cq\u4e2a\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u5b50\u8282\u70b9\u7f16\u53f7\u4e3art<<6|q\uff0c\u533a\u95f4\u4e3a[l+q*len,l+(q+1)*len-1]\n\tupdate(rt<<6|q,l+q*len,l+(q+1)*len-1,p);\n\tt[rt]|=(((__int128)(1))<<q);\n\tif(!t[rt<<6|q])t[rt]^=(((__int128)(1))<<q);\n}\nbool check(int rt,int l,int r,int p)\n{\n\tif(r-l+1<=64)return (t[rt]&(((__int128)(1))<<(p-l)));\n\tint len=(r-l+1)>>6,q=(p-l)/len;//\u540c\u4e0a\n\treturn check(rt<<6|q,l+q*len,l+(q+1)*len-1,p);\n}\nint getmin(int rt,int l,int r)\n{\n\tif(l==r)return l;\n\tint len=(r-l+1)>>6,q=lowbit(t[rt]);//\u4e0d\u65ad\u627e\u6700\u4f4e\u4f4d\u5373\u662f\u6700\u5c0f\u503c\n\treturn getmin(rt<<6|q,l+q*len,l+(q+1)*len-1);\n}\nint getmax(int rt,int l,int r)\n{\n\tif(l==r)return l;\n\tint len=(r-l+1)>>6,q=uppbit(t[rt]);//\u4e0d\u65ad\u627e\u6700\u9ad8\u4f4d\u5373\u662f\u6700\u5927\u503c\n\treturn getmax(rt<<6|q,l+q*len,l+(q+1)*len-1);\n}\nint stk[30][5],top;\nvoid getpos(int rt,int l,int r,int p)\n{\n\tif(l==r)return;\n\tstk[++top][0]=rt;\n\tint len=(r-l+1)>>6,q=(p-l)/len;\n\tstk[top][1]=q;stk[top][2]=l;stk[top][3]=len;//\u8bb0\u5f55\u8def\u5f84\n\tgetpos(rt<<6|q,l+q*len,l+(q+1)*len-1,p);\n}\nint findmax(int x)\n{\n\tif(!x||!siz)return -1;\n\ttop=0;getpos(1,0,n-1,x);\n\tint i,q;\n\tfor(i=top;i;i--)\n\tif(t[stk[i][0]]&((((__int128)(1))<<stk[i][1])-1))\n\treturn q=uppbit(t[stk[i][0]]&((((__int128)(1))<<(stk[i][1]))-1)),\n\tgetmax(stk[i][0]<<6|q,stk[i][2]+q*stk[i][3],stk[i][2]+(q+1)*stk[i][3]-1);\n    //\u56e0\u4e3a\u662f\u5c0f\u4e8ex\uff0c\u6240\u4ee5\u8981\u627e\u6240\u6709\u6bd4q\u4f4e\u7684\u4f4d\u4e2d\u7684\u6700\u9ad8\u4f4d\uff0c\u90a3\u4e48\u5e94 &((1<<q)-1)\n\treturn -1;\n}\nint findmin(int x)\n{\n    if(!siz)return -1;\n\ttop=0;getpos(1,0,n-1,x);\n\tint i,q;\n\tif(t[stk[top][0]]&(((__int128)(1))<<(stk[top][1])))return x;\n\tfor(i=top;i;i--)\n\tif(t[stk[i][0]]&((~0ull)^((((__int128)(1))<<(stk[i][1]+1))-1)))\n\treturn q=lowbit(t[stk[i][0]]&((~0ull)^((((__int128)(1))<<(stk[i][1]+1))-1))),\n\tgetmin(stk[i][0]<<6|q,stk[i][2]+q*stk[i][3],stk[i][2]+(q+1)*stk[i][3]-1);\n    //\u540c\u7406\u5927\u4e8ex\u5219\u4e3a &((~0ull)^((1<<(q+1))-1))\n\treturn -1;\n}\nint main()\n{\n\tint i,opt,x,last=0;\n\tlowp[0]=uppb[0]=-1;//\u9884\u5904\u7406\n\tfor(i=1;i<(1<<16);i++)\n\t{\n\t\tlowp[i]=lowp[i>>1]+1;\n\t\tif(i&1)lowp[i]=0;\n\t\tuppb[i]=uppb[i>>1]+1;\n\t}\n\tscanf(\"%d%d\",&n,&m);n=(1<<30);//\u5fc5\u987b\u662f64\u76842^k\u500d\n\twhile(m--)\n\t{\n\t\tscanf(\"%d\",&opt);\n\t\tswitch(opt)\n\t\t{\n\t\t\tcase 1:scanf(\"%d\",&x);x+=last;if(!check(1,0,n-1,x))++siz,update(1,0,n-1,x);break;\n\t\t\tcase 2:scanf(\"%d\",&x);x+=last;if(check(1,0,n-1,x))--siz,update(1,0,n-1,x);break;\n\t\t\tcase 3:sum+=(last=siz?getmin(1,0,n-1):-1);break;\n\t\t\tcase 4:sum+=(last=siz?getmax(1,0,n-1):-1);break;\n\t\t\tcase 5:sum+=(last=siz);break;\n\t\t\tcase 6:scanf(\"%d\",&x);x+=last;sum+=(last=check(1,0,n-1,x));break;\n\t\t\tcase 7:scanf(\"%d\",&x);x+=last;sum+=(last=findmax(x));break;\n\t\t\tcase 8:scanf(\"%d\",&x);x+=last;sum+=(last=findmin(x));break;\n\t\t}\n\t}\n\tprintf(\"%llu\\n\",sum);\n\treturn 0;\n}\n```   \n\n\u7801\u91cf\u5176\u5b9e\u8fd8\u884c\uff0c\u5c31\u662f\u6ce8\u610f\u590d\u5236\u7c98\u8d34\u7684\u65f6\u5019\u522b\u6ca1\u6539\u5b8c\uff0c\u4ee5\u53ca `x=64,(~0ull)^((1<<x)-1)` \u7684\u503c\u7b49\u4e8e `~0ull` \u7684\u5947\u602a\u9519\u8bef\u3002",
        "postTime": 1604284449,
        "uid": 35137,
        "name": "a___",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6301 \u3010\u96c6\u5408\u3011"
    }
]