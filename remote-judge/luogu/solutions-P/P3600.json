[
    {
        "content": "\u8bb2\u4e00\u79cd\u4e0d\u7528\u671f\u671b DP \u7684\u505a\u6cd5\u3002\n\n\u53ef\u4ee5\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a $i$ \uff0c\u6c42\u51fa\u6700\u540e\u7684\u6700\u5927\u503c\u4e3a $i$ \u7684\u6982\u7387 $p_i$ \uff0c\u7136\u540e\u7b54\u6848\u5c31\u662f\uff1a\n\n$$\\sum_{i=1}^x i\\times p_i$$\n\n\u4f17\u6240\u5468\u77e5\uff0c\u300c\u6700\u5927\u503c\u6070\u597d\u4e3a $i$ \u300d\u5f80\u5f80\u662f\u4e0d\u597d\u5904\u7406\u7684\u3002\n\n\u6240\u4ee5\u8003\u8651\u5dee\u5206\uff1a\u8bbe $P_i$ \u8868\u793a\u6700\u540e\u7684\u6700\u5927\u503c $\\le i$ \u7684\u6982\u7387\uff0c\u8fd9\u6837\u7b54\u6848\u5c31\u662f\uff1a\n\n$$\\sum_{i=1}^xi\\times(P_i-P_{i-1})$$\n\n\u73b0\u5728\u7684\u95ee\u9898\u5c31\u662f\u5982\u4f55\u6c42 $P_i$ \u3002\n\n\u9996\u5148\u6211\u4eec\u77e5\u9053\uff0c\u5982\u679c\u4e00\u4e2a\u533a\u95f4\u5305\u542b\u4e86\u5176\u4ed6\u7684\u533a\u95f4\uff0c\u90a3\u4e48\u8fd9\u4e2a\u533a\u95f4\u5bf9\u6700\u540e\u7684\u6700\u5927\u503c\u662f\u6ca1\u6709\u5f71\u54cd\u7684\u3002\u53ef\u4ee5\u5220\u6389\u3002\n\n\u8fd9\u6837\u5982\u679c\u628a\u6240\u6709\u7684\u533a\u95f4\u6309\u7167\u5de6\u7aef\u70b9\u6392\u5e8f\uff0c\u90a3\u4e48\u53f3\u7aef\u70b9\u662f\u4e25\u683c\u5355\u8c03\u9012\u589e\u7684\u3002\n\n\u53d1\u73b0\u8fd9\u4e2a $P_i$ \u5176\u5b9e\u662f\u4e00\u4e2a\u8ba1\u6570\u95ee\u9898\uff08\u56e0\u4e3a\u65b9\u6848\u6570\u9664\u4ee5 $x^n$ \u5c31\u662f\u6982\u7387\uff09\uff0c\u8bbe $h[i]$ \u8868\u793a\u6700\u540e\u7684\u6700\u5927\u503c $\\le i$ \u7684**\u65b9\u6848\u6570**\u3002\n\n\u8fd9\u7b49\u4ef7\u4e8e\u6bcf\u4e2a\u533a\u95f4\u7684\u6700\u5c0f\u503c\u90fd $\\le i$ \uff0c\u4e5f\u5c31\u76f8\u5f53\u4e8e\u6bcf\u4e2a\u533a\u95f4\u5185\u90fd\u5b58\u5728\u4e00\u4e2a $\\le i$ \u7684\u6570\u3002\n\n\u6211\u4eec\u4e0d\u59a8\u679a\u4e3e $j$ \u8868\u793a\u6709\u591a\u5c11\u4e2a\u6570 $\\le i$ \uff0c\u90a3\u4e48 $h[i]$ \u5c31\u7b49\u4e8e\uff1a\n\n$$g[j]\\times i^j\\times (x-i)^{n-j}$$\n\n\u5176\u4e2d $g[j]$ \u8868\u793a\u5728 $[1,n]$ \u5185\u9009\u51fa $j$ \u4e2a\u70b9\uff0c\u4f7f\u5f97\u6bcf\u4e2a\u533a\u95f4\u81f3\u5c11\u5305\u542b\u4e00\u4e2a\u70b9\u7684\u65b9\u6848\u6570\u3002\n\n\u73b0\u5728\u53ef\u4ee5\u5f00\u59cb DP \u8fa3\uff01\n\n\u5b9a\u4e49\u72b6\u6001\uff1a $f[i][j]$ \u8868\u793a\u524d $i$ \u4e2a\u4f4d\u7f6e\u653e\u4e86 $j$ \u4e2a\u70b9\u4e14\u7b2c $i$ \u4e2a\u4f4d\u7f6e\u5fc5\u987b\u653e\u70b9\uff0c\u8986\u76d6\u6240\u6709\u5de6\u7aef\u70b9 $\\le i$ \u7684\u533a\u95f4\u7684\u65b9\u6848\u6570\u3002\n\n\u9884\u5904\u7406 $fl[i]$ \u548c $fr[i]$ \u8868\u793a\u8986\u76d6\u4f4d\u7f6e $i$ \u7684\u6700\u5de6\u533a\u95f4\u7f16\u53f7\u548c\u6700\u53f3\u533a\u95f4\u7f16\u53f7\u3002\u7279\u6b8a\u5730\uff0c\u5982\u679c $i$ \u4e0d\u88ab\u4efb\u4f55\u533a\u95f4\u5305\u542b\uff0c\u5219 $fr[i]$ \u4e3a\u53f3\u7aef\u70b9\u4e25\u683c\u5c0f\u4e8e $i$ \u7684\u6700\u540e\u4e00\u4e2a\u533a\u95f4\uff0c $fl[i]=fr[i]+1$ \u3002\n\n\u8f6c\u79fb\uff1a\n\n$$f[i][j]=\\sum_{fr[k]+1\\ge fl[i]}f[k][j-1]$$\n\n\u53d1\u73b0\u53ef\u4ee5\u53c2\u4e0e\u8f6c\u79fb\u7684 $k$ \u662f\u4e00\u4e2a\u533a\u95f4\u3002\u524d\u7f00\u548c\u4f18\u5316\uff0c $O(n^2)$ \u3002\n\n$g[j]$ \u5c31\u5f88\u5bb9\u6613\u7b97\u51fa\uff1a\n\n$$g[j]=\\sum_{fr[i]=q}f[i][j]$$\n\n\u590d\u6742\u5ea6 $O(n^2)$ \u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <cmath>\n#include <cstdio>\n#include <cstring>\n#include <iostream>\n#include <algorithm>\n#define For(i, a, b) for (i = a; i <= b; i++)\n#define Rof(i, a, b) for (i = a; i >= b; i--)\nusing namespace std;\n\ninline int read()\n{\n\tint res = 0; bool bo = 0; char c;\n\twhile (((c = getchar()) < '0' || c > '9') && c != '-');\n\tif (c == '-') bo = 1; else res = c - 48;\n\twhile ((c = getchar()) >= '0' && c <= '9')\n\t\tres = (res << 3) + (res << 1) + (c - 48);\n\treturn bo ? ~res + 1 : res;\n}\n\ntemplate <class T>\nT Min(T a, T b) {return a < b ? a : b;}\n\ntemplate <class T>\nT Max(T a, T b) {return a > b ? a : b;}\n\nconst int N = 2005, ZZQ = 666623333, INF = 0x3f3f3f3f;\nint n, m, X, q, fl[N], fr[N], f[N][N], sum[N][N], g[N], h[N], divis, ans;\n\nstruct node\n{\n\tint l, r;\n} a[N], b[N];\n\nbool comp(node a, node b)\n{\n\treturn a.l < b.l || (a.l == b.l && a.r < b.r);\n}\n\nint qpow(int a, int b)\n{\n\tint res = 1;\n\twhile (b)\n\t{\n\t\tif (b & 1) res = 1ll * res * a % ZZQ;\n\t\ta = 1ll * a * a % ZZQ;\n\t\tb >>= 1;\n\t}\n\treturn res;\n}\n\nint main()\n{\n\tint i, j, top = 0;\n\tn = read(); X = read(); q = read();\n\tFor (i, 1, n) fl[i] = INF, fr[i] = -INF;\n\tFor (i, 1, q) b[i].l = read(), b[i].r = read();\n\tsort(b + 1, b + q + 1, comp);\n\tFor (i, 1, q)\n\t{\n\t\tif (i > 1 && b[i].l == b[i - 1].l) continue;\n\t\twhile (top && a[top].r >= b[i].r) top--;\n\t\ta[++top] = b[i];\n\t}\n\tq = top;\n\tFor (i, 1, q) For (j, a[i].l, a[i].r)\n\t\tfl[j] = Min(fl[j], i), fr[j] = Max(fr[j], i);\n\ttop = 0;\n\tFor (i, 1, n)\n\t\tif (fl[i] == INF) fl[i] = top + 1, fr[i] = top;\n\t\telse top = Max(top, fr[i]);\n\tf[0][0] = sum[0][0] = 1;\n\ttop = 0;\n\tFor (i, 1, n)\n\t{\n\t\twhile (top < i - 1 && fr[top] + 1 < fl[i]) top++;\n\t\tFor (j, 1, i) f[i][j] = (sum[i - 1][j - 1] - (top ?\n\t\t\tsum[top - 1][j - 1] : 0) + ZZQ) % ZZQ;\n\t\tFor (j, 0, i) sum[i][j] = (sum[i - 1][j] + f[i][j]) % ZZQ;\n\t}\n\tFor (i, 1, n) if (fr[i] == q) For (j, 1, n)\n\t\tg[j] = (g[j] + f[i][j]) % ZZQ;\n\tFor (i, 1, X) For (j, 1, n)\n\t\th[i] = (h[i] + 1ll * qpow(i, j) * qpow(X - i, n - j) % ZZQ\n\t\t\t* g[j] % ZZQ) % ZZQ;\n\tRof (i, X, 1) h[i] = (h[i] - h[i - 1] + ZZQ) % ZZQ;\n\tdivis = qpow(qpow(X, n), ZZQ - 2);\n\tFor (i, 1, X) ans = (ans + 1ll * i * h[i] % ZZQ * divis % ZZQ) % ZZQ;\n\tcout << ans << endl;\n\treturn 0;\n}\n```",
        "postTime": 1540288611,
        "uid": 29936,
        "name": "xyz32768",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3600 \u3010\u968f\u673a\u6570\u751f\u6210\u5668\u3011"
    },
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.org/problemnew/show/P3600)\n\n\u5168\u4e16\u754c\u7684\u9898\u89e3\u90fd\u770b\u4e0d\u61c2.jpg\n\n\u9898\u89e3\u5199\u5230\u4e00\u534a\u83ab\u540d\u5237\u65b0\u7ed3\u679c\u5168\u90fd\u767d\u5199\u4e86.jpg\n\n\u9996\u5148\u8981\u77e5\u9053\u5168\u6982\u7387\u516c\u5f0f$E(x)=\\sum_{i=0}^\\infty P(x\\geq i)$\uff0c\u8bc1\u660e\u5982\u4e0b\n![](https://i.loli.net/2018/11/15/5bed623410b71.png)\n\u4e8e\u662f\u5bf9\u4e8e\u6bcf\u4e00\u4e2a$i$\uff0c\u6211\u4eec\u53ea\u8981\u8ba1\u7b97\u51fa$P(ans\\geq i)$\u5373\u53ef\n\n\u7136\u800c\u56e0\u4e3a\u8fd9\u91cc\u8981\u8ba1\u7b97\u7684\u662f\u6700\u5c0f\u503c\uff0c\u5982\u679c\u662f\u5927\u4e8e\u7b49\u4e8e\u5f88\u4e0d\u65b9\u4fbf\uff0c\u4e8e\u662f\u6211\u4eec\u8003\u8651\u8f6c\u5316\u4e3a$P(ans\\geq i)=1-P(ans<i)$\uff0c\u4e5f\u5c31\u662f\u610f\u5473\u7740\u6bcf\u4e00\u4e2a\u533a\u95f4\u4e2d\u90fd\u81f3\u5c11\u6709\u4e00\u4e2a\u6570\u5c0f\u4e8e\u7b49\u4e8e$i-1$\n\n\u6709\u4e00\u4e2a\u6027\u8d28\uff0c\u5982\u679c\u533a\u95f4$a=[l1,r1]$\u5b8c\u5168\u5305\u542b\u4e86\u533a\u95f4$b=[l2,r2]$\uff0c\u90a3\u4e48$a$\u662f\u6ca1\u6709\u7528\u7684\uff0c\u56e0\u4e3a$a$\u7684\u6700\u5c0f\u503c\u80af\u5b9a\u5c0f\u4e8e\u7b49\u4e8e$b$\u7684\u6700\u5c0f\u503c\uff0c\u5bf9\u7b54\u6848\u4e0d\u53ef\u80fd\u6709\u8d21\u732e\u3002\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5148\u628a\u6240\u6709\u5305\u542b\u4e86\u5176\u5b83\u533a\u95f4\u7684\u533a\u95f4\u5148\u53bb\u6389\uff0c\u518d\u6309\u5de6\u7aef\u70b9\u6392\u4e00\u4e2a\u5e8f\uff0c\u90a3\u4e48\u53f3\u7aef\u70b9\u80af\u5b9a\u4e5f\u662f\u9012\u589e\u7684\n\n\u8003\u8651\u4e00\u4e2a\u6570\uff0c\u5982\u679c\u5b83\u5c0f\u4e8e\u7b49\u4e8e$i-1$\u90a3\u4e48\u5b83\u4f1a\u5bf9\u4e00\u4e9b\u533a\u95f4\u4ea7\u751f\u8d21\u732e\uff0c\u4e14\u8fd9\u4e9b\u533a\u95f4\u7684\u7f16\u53f7\u80af\u5b9a\u662f\u8fde\u7eed\u7684\u3002\u6211\u4eec\u628a\u70b9\u548c\u533a\u95f4\u7ffb\u8f6c\uff0c\u8003\u8651\u7528\u70b9\u53bb\u8986\u76d6\u533a\u95f4\uff0c\u90a3\u4e48\u73b0\u5728\u7684\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u6bcf\u4e2a\u70b9\u80fd\u8986\u76d6\u4e00\u4e9b\u533a\u95f4\uff0c\u4e14\u8986\u76d6\u7684\u6982\u7387\u4e3a$p=\\frac{i-1}{x}$\uff0c\u95ee\u6240\u6709\u533a\u95f4\u90fd\u88ab\u8986\u76d6\u7684\u6982\u7387\n\n\u8bbe$l[i]$\u4e3a$i$\u80fd\u8986\u76d6\u5230\u7684\u6700\u5de6\u8fb9\u7684\u533a\u95f4\uff0c$r[i]$\u4e3a\u6700\u53f3\u8fb9\u7684\u533a\u95f4\uff0c$f[i]$\u4e3a\u5fc5\u9009\u7b2c$i$\u4e2a\u70b9\uff0c\u4e14$r[i]$\u53ca\u5176\u4e4b\u524d\u7684\u533a\u95f4\u90fd\u88ab\u8986\u76d6\u7684\u6982\u7387\uff0c\u90a3\u4e48\u6709$$f[i]=p*(\\sum_{r[j]\\geq l[i]-1} f[j]*(1-p)^{i-j-1}+[l[i]=1]*(1-p)^{i-1})$$\n\n\u5c31\u662f\u8bf4\u6211\u4eec\u679a\u4e3e\u4e0a\u4e00\u4e2a\u9009\u7684\u70b9$j$\uff0c\u90a3\u4e48\u5fc5\u987b\u6709$r[j]\\geq l[i]-1$\u624d\u80fd\u4fdd\u8bc1$r[i]$\u53ca\u5176\u4e4b\u524d\u7684\u533a\u95f4\u90fd\u88ab\u8986\u76d6\uff0c\u53c8\u56e0\u4e3a$j$\u662f\u4e0a\u4e00\u4e2a\u88ab\u9009\u7684\uff0c\u6240\u4ee5$[j+1,i-1]$\u90fd\u6ca1\u6709\u88ab\u8986\u76d6\u3002\n\n\u90a3\u4e48\u6700\u540e\u7684\u7b54\u6848\u5c31\u662f$\\sum_{r[i]=m} f[i]*(1-p)^{n-i}$\uff0c\u5c31\u662f\u679a\u4e3e\u6700\u540e\u4e00\u4e2a\u88ab\u9009\u7684\u70b9\uff0c\u7136\u540e\u56e0\u4e3a\u5b83\u662f\u6700\u540e\u4e00\u4e2a\uff0c\u6240\u4ee5$[i+1,n]$\u90fd\u6ca1\u88ab\u8986\u76d6\n\n\u8fd9\u4e2a\u4e1c\u897f\u7528\u53cc\u6307\u9488\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f18\u5316\u5230$O(n)$\n```\n//minamoto\n#include<bits/stdc++.h>\nusing namespace std;\n#define getc() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++)\nchar buf[1<<21],*p1=buf,*p2=buf;\ntemplate<class T>inline bool cmax(T&a,const T&b){return a<b?a=b,1:0;}\nint read(){\n    int res,f=1;char ch;\n    while((ch=getc())>'9'||ch<'0')(ch=='-')&&(f=-1);\n    for(res=ch-'0';(ch=getc())>='0'&&ch<='9';res=res*10+ch-'0');\n    return res*f;\n}\nconst int N=2005,mod=666623333;\ninline int add(int x,int y){return x+y>=mod?x+y-mod:x+y;}\ninline int dec(int x,int y){return x-y<0?x-y+mod:x-y;}\ninline int mul(int x,int y){return 1ll*x*y%mod;}\nint ksm(int a,int b){\n    int res=1;\n    for(;b;b>>=1,a=mul(a,a))if(b&1)res=mul(res,a);\n    return res;\n}\nstruct node{\n    int l,r;\n    inline bool operator <(const node &b)const\n    {return l==b.l?r>b.r:l<b.l;}\n}a[N];\nint n,k,m,st[N],top,L[N],R[N],f[N],ans,invp[N];\nint main(){\n//\tfreopen(\"testdata.in\",\"r\",stdin);\n    n=read(),k=read(),m=read();for(int i=1;i<=m;++i)a[i].l=read(),a[i].r=read();\n    sort(a+1,a+1+m);\n    for(int i=1;i<=m;++i){\n        while(top&&a[i].r<=a[st[top]].r)--top;\n        st[++top]=i;\n    }\n    m=top;for(int i=1;i<=m;++i)a[i]=a[st[i]];\n    int h=1,t=0;\n    for(int i=1;i<=n;++i){\n        while(t<m&&a[t+1].l<=i)++t;\n        while(h<=t&&a[h].r<i)++h;\n        L[i]=h,R[i]=t;\n    }\n    for(int x=1;x<=k;++x){\n        int sum,p,np,fp,leip,tot;\n        sum=1,p=mul(dec(x,1),ksm(k,mod-2));\n        np=dec(1,p),fp=ksm(np,mod-2);\n        invp[0]=1,f[0]=1,leip=1;\n        for(int i=1;i<=n;++i)invp[i]=mul(invp[i-1],fp);\n        for(int i=1,j=0;i<=n;++i){\n            while(j<i&&R[j]<L[i]-1)sum=dec(sum,mul(f[j],invp[j])),++j;\n            f[i]=mul(sum,mul(leip,p)),leip=mul(leip,np);\n            sum=add(sum,mul(f[i],invp[i]));\n        }\n        tot=0,leip=1;\n        for(int i=n;i&&R[i]==m;--i,leip=mul(leip,np))tot=add(tot,mul(f[i],leip));\n        ans=add(ans,dec(1,tot));\n    }\n    printf(\"%d\\n\",ans);return 0;\n}\n```",
        "postTime": 1542285360,
        "uid": 41781,
        "name": "bztMinamoto",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3600 \u3010\u968f\u673a\u6570\u751f\u6210\u5668\u3011"
    },
    {
        "content": "~~\u849f\u84bb\u53c8\u6765\u809d\u671f\u671b\u9898\u5566\u3002~~\n\n\u6ce8\u610f\u5230\u8fd9\u9898$n,x$(\u7531\u4e8e\u672c\u4eba\u4e60\u60ef,\u4e0b\u6587\u5747\u6539\u4e3ac)$,q$**\u540c\u9636**\u3002\n\n\u975e\u5e38\u7f55\u89c1,\u4e00\u9053\u671f\u671b\u9898\u503c\u57df\u5c45\u7136\u53ea\u67092000?\n\n\u6211\u4eec\u8003\u8651**\u5728\u503c\u57df\u4e0a\u505a\u624b\u811a**\u3002\n\n```cpp\n\u4e0d\u786e\u5b9a\u7684\u4e1c\u897f\u8d8a\u591a,\u9898\u76ee\u5c31\u8d8a\u590d\u6742\u3002\n\u590d\u6742\u7684\u6570\u5b66\u9898\u53ef\u4ee5\u5229\u7528\u679a\u4e3e\u964d\u4f4e\u601d\u8003\u590d\u6742\u5ea6\u3002\n\u2014\u2014\u67d0\u6570\u5b66dalao\n\n\u79bb\u6563\u7edf\u8ba1\u6570\u5b66\u4e09\u5144\u5f1f:\u65b9\u6848\u6570,\u6982\u7387,\u671f\u671b\n\u2014\u2014\u672c\u849f\u84bb\n```\n\n\u559c\u95fb\u4e50\u89c1\u5f97,\u8fd9\u9053\u9898\u6709\u819c,\u6240\u4ee5\u4e0d\u7528\u5355\u884c\u6389\u7cbe\u5ea6,\u65b9\u6848\u6570,\u6982\u7387,\u671f\u671b\u53ef\u4ee5\u968f\u610f\u8f6c\u5316\u3002\n\n\u8fd9\u9053\u9898\u6c42\u7684\u662f\u4e00\u756a\u64cd\u4f5c\u540e,\u7b54\u6848\u7684\u671f\u671b,\u5f88\u660e\u663e,\u7b54\u6848\u4e00\u5b9a\u662f$[1,c]$\u5185\u7684\u4e00\u4e2a\u6574\u6570(\u4e5f\u5c31\u662f\u53ea\u6709c\u79cd\u53ef\u80fd),\u6240\u4ee5\u7b54\u6848\u662f\u79bb\u6563\u671f\u671b\u53d8\u91cf\u3002\n\n\u79bb\u6563\u53d8\u91cf\u671f\u671b\u516c\u5f0f:$E(x)=\\sum{P(?)*W(?)}$,\u5176\u4e2d$P$\u662f\u6982\u7387,$W$\u662f\u6743\u503c\n\n\u6216\u8005\u4f60\u53ef\u4ee5\u770b\u770b[\u67d0\u5ea6\u767e\u79d1](https://baike.baidu.com/item/%E6%95%B0%E5%AD%A6%E6%9C%9F%E6%9C%9B/5362790?fr=aladdin)\n\n\u6bd4\u5982\u8bf4\u5982\u679c\u4f60\u629b\u74f6\u76d6,\u74f6\u76d6\u6b63\u9762\u671d\u4e0a\u7684\u6982\u73870.4,\u53cd\u97620.6;\u629b\u5230\u6b63\u9762\u5f972\u5206,\u53cd\u9762\u5f971\u5206\u3002\n\n\u90a3\u4e48\u629b\u4e00\u6b21,\u5f97\u5206\u671f\u671b\u4e3a $0.4*2+0.6*1=1.4$\u3002\n\n\u603b\u7684\u6765\u8bf4,\u6982\u7387\u4e58\u6743\u503c(\u5206\u6570)\u7684\u548c\u5c31\u5f97\u5230\u671f\u671b \u3002 \n\n- **\u8bbe**\u7b54\u6848\u6709$p[x]$\u7684\u6982\u7387\u7b49\u4e8e$x$ \u3002\n\n\u90a3\u4e48\u7b54\u6848\u7684\u671f\u671b$\\large{E(ans)=\\sum\\limits_{1<=i<=x}{i*p[i]}}$ \n\n\u4e0a\u9762\u7684\u7684\u5f0f\u5b50\u53ea\u6709$p[]$\u662f\u672a\u77e5\u7684,\u4e8e\u662f\u4e4e,\u6211\u4eec**\u628a\u671f\u671b\u95ee\u9898\u8f6c\u5316\u4e3a\u4e86\u6982\u7387\u95ee\u9898**\u3002 \n\n\u6211\u4eec\u5206\u522b\u6c42\u51fa$p[1...c]$,\u518d\u6309\u7167\u4e0a\u9762\u7684\u5f0f\u5b50\u7b97\u5c31\u53ef\u4ee5\u4e86\u3002 \n\n\u96be\u70b9\u5728$p$\u6570\u7ec4\u7684\u6c42\u89e3\u4e0a\u3002\n\n-------\n\n\u8fd9\u9053\u9898\u6709\u4e00\u7cfb\u5217$min/max$\u64cd\u4f5c,\u90fd\u662f**\u57fa\u4e8e\u4e0d\u7b49\u5f0f**\u7684,\u6211\u4eec\u8bbe\u7684\u72b6\u6001\u5f88\u4e4f\u529b(**\u7b49\u4e8e**$x$),\u8003\u8651\u8f6c\u5316\u4e00\u4e0b\u3002\n\n\u6982\u7387\u662f\u53ef\u4ee5\u5bb9\u65a5\u7684(\u5e9f\u8bdd),\u6bd4\u5982\u8fd9\u9053\u9898\u91cc,\u6211\u4eec\u5c31\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u57fa\u4e8e\u4e0d\u7b49\u5f0f\u7684\u72b6\u6001$g[x]$\u3002\n\n- \u8bbe$g[x]$\u8868\u793a\u7b54\u6848\u6709$g[x]$\u7684\u6982\u7387\u5c0f\u4e8e\u7b49\u4e8ex\u3002\n\n\u8fd9\u6837\u7684\u8bdd,$\\large{p[x]=g[x]-g[x-1]}$\u3002\n\n$g[x]$\u76f8\u5bf9\u597d\u6c42\u4e00\u4e9b(~~\u771f\u9999~~)\u3002\n\n\u6211\u4eec\u628a\u6570\u5217**\u5927\u4e8e$x$\u7684\u6570\u90fd\u8f6c\u5316\u4e3a1,\u5c0f\u4e8e\u7b49\u4e8e$x$\u7684\u90fd\u8f6c\u5316\u4e3a0**,\u5f88\u660e\u663e,\u6bcf\u4e2a\u4f4d\u7f6e\u6709$(c-x)/c$\u7684\u53ef\u80fd\u4e3a$1,x/c$\u7684\u53ef\u80fd\u4e3a$0$\u3002\n\n\u7531\u4e8e\u53d6$min$\u64cd\u4f5c,\u6bcf\u4e2a\u533a\u95f4\u4f1a\u5f97\u5230\u4e00\u4e2a0\u6216\u80051,\u5982\u679c\u4e00\u4e2a\u533a\u95f4\u5185\u67090\u5219\u5fc5\u7136\u5f97\u52300,**\u5982\u679c\u8fd9\u4e2a\u533a\u95f4\u5168\u662f1,\u5219\u5f97\u52301**\u3002\n\n\u540e\u9762\u518d\u5bf9\u6240\u6709\u7684\u533a\u95f4\u53d6$max$,**\u5982\u679c\u533a\u95f4\u7b54\u6848\u6709\u4efb\u610f\u4e00\u4e2a1,\u5219$ans>x$**(~~\u574f\u4e86\u4e00\u9505\u7ca5?~~)\u3002 \n\n\u6240\u4ee5$ans<=x$\u7684\u6982\u7387\u7b49\u4e8e\u6709**\u6ca1\u6709\u4e00\u4e2a\u533a\u95f4\u5185\u5168\u662f1**\u7684\u6982\u7387\u3002\n\n\u597d\u50cf\u8fd9\u4e2a\u6982\u7387\u4e5f\u4e0d\u597d\u6c42,**\u8f6c\u5316\u6210\u65b9\u6848\u6570**\u5427(zz\u6c14\u606f)\u3002\n\n\u4f17\u6240\u5468\u77e5:\u4e8b\u4ef6\u7684\u6982\u7387=**\u4e8b\u4ef6\u53d1\u751f\u65b9\u6848\u6570/\u603b\u65b9\u6848\u6570**(\u8fd9\u8981\u5efa\u7acb\u5728\u6240\u6709\u60c5\u51b5\u6982\u7387(\u6743\u91cd)\u76f8\u7b49\u7684\u60c5\u51b5\u4e0b)\u3002\n\n-------\n\n- **\u8bbe**$r[x]$\u8868\u793a\u7b54\u6848\u6709$r[x]$\u79cd\u65b9\u6848\u5c0f\u4e8e\u7b49\u4e8e$x$\u3002 \n\n\u6211\u4eec\u628a\u6570\u5217\u5927\u4e8e$x$\u7684\u6570\u90fd\u8f6c\u5316\u4e3a1,\u5c0f\u4e8e\u7b49\u4e8e$x$\u7684\u90fd\u8f6c\u5316\u4e3a0,\u5f88\u660e\u663e,\u6bcf\u4e2a\u4f4d\u7f6e\u6709$(c-x)$\u79cd\u65b9\u6848\u4e3a1,$x$\u79cd\u65b9\u6848\u4e3a0\u3002\n\n\u660e\u663e\u770b\u5230,\u603b\u65b9\u6848\u6570\u4e3a$c^n$(\u6bcf\u4e2a\u6570\u5b57\u90fd\u6709c\u79cd\u53d6\u503c,\u5171n\u4e2a)\n\n\u6240\u4ee5$\\large{g[x]=r[x]/(c^n)}$\u3002\n\n\u6240\u4ee5$ans<=x$\u7684\u65b9\u6848\u6570\u7b49\u4e8e\u6ca1\u6709\u4e00\u4e2a\u533a\u95f4\u5185\u5168\u662f1\u7684\u65b9\u6848\u6570\u3002\n\n\u6211\u4eec\u8981\u4fdd\u8bc1\u6ca1\u6709\u4e00\u4e2a\u533a\u95f4\u5185\u5168\u662f1,\u5373\u6bcf\u4e2a\u533a\u95f4\u5185\u81f3\u5c11\u67091\u4e2a0\u3002\n\n\u73b0\u5728\u95ee\u9898\u6765\u4e86:\u6211\u4eec\u6709\u51e0\u79cd\u65b9\u6cd5\u586b\u519901\u4e32,\u4f7f\u5f97\u6bcf\u4e2a\u533a\u95f4\u5185\u81f3\u5c11\u67091\u4e2a0?\n\n```cpp\n\u4e0d\u4f1a\u5c31\u591a\u8bbe\u51e0\u4e2a\u6570\u3002\n\u2014\u2014\u6570\u5b66\u8001\u5e08 forest\u00b7true\u00b7stop\n```\n\n- **\u8bbe**$s[i]$\u4e3a\u586b\u4e86$i$\u4e2a0,$(n-i)$\u4e2a1,\u4f7f\u5f97\u6bcf\u4e2a\u533a\u95f4\u5185\u81f3\u5c11\u67091\u4e2a0\u7684\u65b9\u6848\u6570\u3002\n\n\u4e00\u4e2a1\u53ef\u4ee5\u5bf9\u5e94\u539f\u503c\u57df\u4e2d\u7684$(c-x)$\u4e2a\u6570,\u4e00\u4e2a0\u53ef\u4ee5\u5bf9\u5e94$x$\u4e2a\u6570\u3002\n\n\u5219$\\large{r[x]=\\sum\\limits_{0<=i<=n}{s[i]*(x^i*(c-i)^{(n-i)})}}$\n\n~~\u5bf9\u4e8e$s$,\u4e0a$O(2^n)$\u679a\u4e3e01\u4e32\u6c42\u3002~~(\u5e94\u8be5\u6709\u8fd9\u4e2a\u90e8\u5206\u5206\u624d\u5bf9)\n\n\u5bf9\u4e8e$s$,\u4e0d\u5c31\u662f\u4e2a\u586b\u519901\u4e32\u7684\u65b9\u6848\u6570\u95ee\u9898\u5417?\u7ec8\u4e8e\u53ef\u4ee5**dp\u6c42\u89e3\u4e86**!\n\n\n\n------\n\n- \u8bbe$f[i][j]$\u4e3a\u5728\u524di\u4f4d\u7f6e\u5185\u586b\u4e86j\u4e2a0(\u5fc5\u586b\u7b2ci\u4f4d),\u4e14\u5df2\u7ecf\u8986\u76d6\u4e86\u5de6\u7aef\u70b9\u5c0f\u4e8e\u7b49\u4e8ei\u7684\u6240\u6709\u533a\u95f4\u7684\u65b9\u6848\u6570\u3002\n\n\u8f6c\u79fb:\u5f88\u660e\u663e$f[i][j]$\u8981\u4ece$f[?][j-1]$\u8f6c\u79fb\u8fc7\u6765\u3002\n\n\u5177\u4f53\u662f\u90a3\u4e9b\"?\"\u5462?\n\n\u5982\u679c\u7b2ci\u4f4d\u4e00\u4e2a0\u53ef\u4ee5\u628a\u5de6\u7aef\u70b9$posl$\u6ee1\u8db3$?<pos<=i$\u7684\u6240\u6709\u533a\u95f4\u90fd\u5e72\u6389,\u8fd9\u4e2a?\u5c31\u662f\u6ee1\u8db3\u6761\u4ef6\u7684\u3002\n\n\u628a?\u4ece$i-1$(\u4e24\u4e2a0\u4e0d\u80fd\u653e\u5728\u4e00\u8d77)\u5411\u524d\u679a\u4e3e\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u5224\u65ad\u4e0d\u5408\u6cd5:\n\n\u5982\u679c\u6709\u5de6\u7aef\u70b9posl\u6ee1\u8db3$?<pos<=i$\u7684\u533a\u95f4,\u53f3\u7aef\u70b9\u7aef\u70b9$posr<i$,\u5219?\u4e0d\u5728\u8fd9\u4e2a\u533a\u95f4\u5185,\u4e0d\u5408\u6cd5\u3002\n\n\u56e0\u4e3a\u4e0a\u4e00\u4e2a0\u6ca1\u6709\u5e72\u6389\u8fd9\u4e2a\u533a\u95f4,\u8fd9\u4e2a0\u4e5f\u6ca1\u6709,\u6240\u4ee5\u8fd9\u4e2a\u533a\u95f4\u53ef\u4ee5~~\u82df\u4e14\u5077\u751f~~,\u6240\u4ee5\u5e03\u661f\u3002\n\n\u90a3\u4e48,\u6c42\u51fa\u6765?\u4e4b\u540e ,\u5f97\u5230$\\large{f[i][j]=\\sum\\limits_{?<=j<i}f[j][j-1]}$\n\n\u6b63\u786e\u6027\u6ee1\u8db3\u4e86,\u63a5\u4e0b\u6765**\u4e0a\u4f18\u5316**\u3002\n\n-------\n\n\u6211\u4eec\u6765\u634b\u4e00\u634b\u7a0b\u5e8f\u8fc7\u7a0b\u4e0e\u590d\u6742\u5ea6($n,c,q$\u540c\u9636)\u3002\n\n\u5148$dp$\u51fa$f$\u6570\u7ec4,\u4e00\u5171\u72b6\u6001$O(n^2)$,\u4e58\u4e0a\u8f6c\u79fb$O(n)$\u3002 O(n^3)\n\n$s[k]=\\sum\\limits_{1<=i<=n}{f[i][k]}\\text{(i\u9700\u8981\u6ee1\u8db3\u6761\u4ef6\u54e6)}$ O(n^2)\n\n$r[x]=\\sum\\limits_{0<=i<=n}{s[i]*(i^k*(x-i)^{(n-k)})}$ O(n^2*logn)(\u5feb\u901f\u5e42)\n\n$g[x]=r[x]/(c^n)$ O(n)\n\n$p[x]=g[x]-g[x-1]$ O(n)\n\n$E(ans)=\\sum\\limits_{1<=i<=x}{i*p[i]}$ O(n)\n\n\u7a7a\u95f4\u65e0\u7591$O(n^2)$\u65f6\u95f4\u590d\u6742\u5ea6$O(n^3)$\n\n**\u74f6\u9888\u5728dp**,\u60f3\u529e\u6cd5\u52a0\u901f\u8f6c\u79fb\u3002 \n\n\u56de\u987e:\u5982\u679c\u6709\u5de6\u7aef\u70b9posl\u6ee1\u8db3$?<pos<=i$\u7684\u533a\u95f4,\u53f3\u7aef\u70b9\u7aef\u70b9$posr<i$,\u5219?\u4e0d\u5728\u8fd9\u4e2a\u533a\u95f4\u5185,\u4e0d\u5408\u6cd5\u3002\n\n\u5f88\u660e\u663e\u5177\u6709\u5355\u8c03\u6027\u561b\u3002\n\n\u53f3\u7aef\u70b9\u505a\u4e00\u4e2aST\u8868,\u67e5\u5904\u6700\u5c0f\u503c,\u5982\u679c\u6700\u5c0f\u503c$<i$,\u5219$?$\u4e0d\u5408\u6cd5(\u65f6\u95f4\u590d\u6742\u5ea6$O(1)$)\u3002\n\n\u4e8c\u5206+ST\u8868\u5c31\u53ef\u4ee5\u89e3\u51b3\u3002\n\n$?$\u7684\u6c42\u89e3\u964d\u5230$O(logn)$\u5269\u4e0b\u7684\u52a0\u4e0a\u524d\u7f00\u548c\u5c31\u53ef\u4ee5\u5566\u3002\n\n\u590d\u6742\u5ea6\u4f18\u5316\u4e3a$O(n^2logn)$,\u89e3\u51b3\u672c\u9898\u3002\n\n~~\u4ee3\u7801\u6709\u70b9\u6076\u5fc3\u4eba~~\n\n------------\n\n\n\u5176\u5b9e\u4e0d\u7528\u4e8c\u5206\u4f18\u5316,\u5927\u529b\u679a\u4e3er\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u7531\u4e8e\u6570\u636e\u968f\u673a,r\u671f\u671b\u53ea\u7528\u679a\u4e3e$log(n)$\u6b21\n\n\u4e0a\u66b4\u529b\u7248\u7684\u4ee3\u7801\u5427,\u53cd\u6b63\u4e5fAC\u4e86\u3002\n\n~~\u6b63\u5e38\u7248\u7684\u592a\u4e11,\u4e0d\u653e\u4e86\u3002~~\n\n**Code: **\n\n```cpp\n#include<algorithm>\n#include<cstdio>\n#define mod 666623333\nusing namespace std;\nint n,c,q,h[2050];\nlong long f[2050][2050]\n          ,s[2050],r[2050],g[2050],p[2050],ans;\nstruct Line\n{int l,r;}\nb[2050];\nlong long pow(long long a,long long t)\n{\n  long long ans=1,buff=a;\n  while(t){\n    if (t&1) ans=(ans*buff)%mod;\n    buff=(buff*buff)%mod;\n    t>>=1;\n  }return ans;\n} \nlong long inv(long long num)\n{return pow(num,mod-2);}\nint main()\n{\n  scanf(\"%d%d%d\",&n,&c,&q);\n  for (int i=1;i<=n;i++)h[i]=1<<30;\n  for (int i=1;i<=q;i++){\n    scanf(\"%d%d\",&b[i].l,&b[i].r);\n    h[b[i].l]=min(h[b[i].l],b[i].r);//\u8fd9\u53e5\u8bdd\u662f\u5173\u952e \n  }f[0][0]=1;\n  for (int j=1;j<=n;j++){\n    for (int i=j;i<=n;i++){\n   \t  int r=i-1;\n      while(h[r]>=i&&r){\n      \tf[i][j]=(f[i][j]+f[r][j-1])%mod;\n\t    r--;//\u4e00\u5f00\u59cb\u6ca1\u6709\u819c\u8fd8\u5f97\u4e8680\n\t  }f[i][j]=(f[i][j]+f[r][j-1])%mod;\n\t  //\u8ffd\u6c42\u7406\u8bba\u590d\u6742\u5ea6\u7684\u8bdd,\u53ef\u4ee5\u628a\u8f6c\u79fb\u6539\u6210ST\u8868+\u4e8c\u5206+\u524d\u7f00\u548c\u4f18\u5316(\u6c57) \n    }\n  }for (int k=0;k<=n;k++)\n    for (int i=n;i>-1;i--){\n      s[k]=(s[k]+f[i][k])%mod;\n      if (h[i]<(1<<25))break;\n      //\u5982\u679c\u8fd9\u91cc\u653e\u6700\u540e\u4e00\u4e2a0\u6ee1\u8db3\u4e0d\u4e86\u6700\u540e\u4e00\u4e2a\u533a\u95f4,\u5728\u524d\u9762\u653e0\u90fd\u4e0d\u5408\u6cd5\u3002 \n    }\n  for (int x=1;x<=c;x++)\n   for (int i=1;i<=n;i++)\n     r[x]=(r[x]+s[i]*pow(x,i)%mod*pow(c-x,n-i))%mod;\n  for (int x=1;x<=c;x++)g[x]=r[x]*inv(pow(c,n))%mod;\n  for (int x=1;x<=c;x++)p[x]=(g[x]-g[x-1]+mod)%mod;\n  for (int x=1;x<=c;x++)ans=(ans+x*p[x])%mod;\n  //\u8ddf\u4e0a\u9762\u7684\u5f0f\u5b50\u4e00\u6837\u7684\u3002 \n  printf(\"%lld\",ans);\n  return 0;\n}\n```\n\n\n[$AC$\u8bb0\u5f55](https://www.luogu.org/recordnew/show/15145944)\n\n\n\n\n\n\n\n\n",
        "postTime": 1546342393,
        "uid": 58705,
        "name": "command_block",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3600 \u3010\u968f\u673a\u6570\u751f\u6210\u5668\u3011"
    },
    {
        "content": "\u9898\u610f\uff1a\u968f\u673a\u751f\u6210\u4e00\u4e2a\u957f\u5ea6\u4e3a$n$\uff0c\u503c\u57df\u4e3a$[1,x]$\u7684\u6570\u5217\uff0c\u6bcf\u6b21\u8be2\u95ee\u4e00\u4e2a\u533a\u95f4$[l,r]$\u7684\u6700\u5c0f\u503c\uff0c\u6700\u7ec8\u7b54\u6848\u4e3a\u6240\u6709\u8be2\u95ee\u7684\u6700\u5927\u503c\uff0c\u6c42\u7b54\u6848\u7684\u671f\u671b\n\n\n\n------------\n\n\u53ef\u4ee5\u53d1\u73b0\u5305\u542b\u5176\u4ed6\u533a\u95f4\u7684\u533a\u95f4\u5bf9\u7b54\u6848\u662f\u6ca1\u6709\u5f71\u54cd\u7684\uff0c\u9996\u5148\u628a\u5b83\u4eec\u53bb\u6389\n\n\u8003\u8651\u679a\u4e3e\u6700\u5927\u503c$k$\n\n\u8bbe\u6240\u6709\u533a\u95f4\u90fd\u6ee1\u8db3$min_{l,r}<=k$\u7684\u6982\u7387\u4e3a$P(k)$\n\n\u90a3\u4e48$k$\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5c31\u662f$k*[P(k)-P(k-1)]$\n\n\u8bbe$f[i]$\u8868\u793a\u53f3\u7aef\u70b9$<=i$\u7684\u533a\u95f4\u90fd\u6ee1\u8db3$min_{l,r}<=k$\u7684\u6982\u7387\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a$k$\u8ba1\u7b97\uff0c$f[n]$\u5373\u4e3a$P(k)$\n\n\u6709\u8f6c\u79fb\u65b9\u7a0b\uff1a$f[i]=\\sum_{p=j}^if[p-1]*(k/x)*(1-k/x)^{i-p}$\n\n\u76f4\u63a5\u505a\u662f$n^3$\u7684\n\n\u53d1\u73b0\u53ef\u4ee5\u62c6\u9879\uff0c\u8ba1\u7b97$f[p-1]*(1-k/x)^{-p}$\u7684\u524d\u7f00\u548c\u5373\u53ef\n\n\u603b\u590d\u6742\u5ea6$O(xn^2logn)$\n\n```\n#include<cstdio>\n#include<cstring>\n#include<cctype>\n#include<algorithm>\n#define reg register\nusing namespace std;\ntypedef long long ll;\nconst int N=2005,mod=666623333;\nstruct node\n{\n\tint l,r;\n\tinline friend bool operator < (node a,node b)\n\t{\n\t\treturn a.l==b.l?a.r<b.r:a.l<b.l;\n\t}\n}q[N],t[N];\nint n,T,x,m,fi[N],nxt[N];\nll ans,invx,f[N],sum[N];\ninline int read()\n{\n\tint x=0,w=1;\n\tchar c=getchar();\n\twhile (!isdigit(c)&&c!='-') c=getchar();\n\tif (c=='-') c=getchar(),w=-1;\n\twhile (isdigit(c))\n\t{\n\t\tx=(x<<1)+(x<<3)+c-'0';\n\t\tc=getchar();\n\t}\n\treturn x*w;\n}\nll quickpow(ll n,ll k)\n{\n\tll s=1;\n\twhile (k)\n\t{\n\t\tif (k&1) s=s*n%mod;\n\t\tn=n*n%mod; k>>=1;\n\t}\n\treturn s;\n}\ninline ll Sum(int l,int r){return (sum[r]-(l<1?0:sum[l-1])+mod)%mod;}\ninline ll calc(int k)\n{\n\tll p1=1ll*k*invx%mod,p2=(1-p1+mod)%mod,p3=quickpow(p2,mod-2);\n\tmemset(f,0,sizeof(f)); f[0]=1;\n\tmemset(sum,0,sizeof(sum)); sum[0]=p3;\n\tfor (reg int i=1;i<=n;i++)\n\t{\n\t\tfor (reg int j=fi[i];j;j=nxt[j])\n\t\t{\n\t\t\tif (i>q[j].l) f[i]=(f[i]+Sum(q[j].l-1,i-2)*p1%mod*quickpow(p2,i)%mod)%mod;\n\t\t\tf[i]=(f[i]+f[i-1]*p1%mod)%mod;\n\t\t}\n\t\tif (!fi[i]) f[i]=f[i-1];\n\t\tsum[i]=(sum[i-1]+f[i]*quickpow(p3,i+1)%mod)%mod;\n\t}\n\treturn f[n];\n}\nint main()\n{\n\tn=read(),x=read(),T=read();\n\tfor (reg int i=1;i<=T;i++) t[i].l=read(),t[i].r=read();\n\tsort(t+1,t+T+1);\n\tfor (reg int i=1;i<=T;i++)\n\t{\n\t\twhile (q[m].r>=t[i].r) --m;\n\t\tif (q[m].l<t[i].l) q[++m]=t[i];\n\t}\n\tinvx=quickpow(x,mod-2); ll pre=0;\n\tfor (reg int i=1;i<=m;i++) nxt[i]=fi[q[i].r],fi[q[i].r]=i;\n\tfor (reg int i=1;i<=x;i++)\n\t{\n\t\tll now=calc(i);\n\t\tans=(ans+1ll*i*((now-pre+mod)%mod)%mod)%mod;\n\t\tpre=now;\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1538179879,
        "uid": 43471,
        "name": "Captain_Paul",
        "ccfLevel": 0,
        "title": "P3600  \u968f\u673a\u6570\u751f\u6210\u5668"
    },
    {
        "content": "\u770b\u5230\u6ca1\u6709 Min-Max \u5bb9\u65a5\u7684\u9898\u89e3\uff0c\u6240\u4ee5\u6765\u4ea4\u4e00\u53d1\uff08\n\n\u9996\u5148\u5217\u51fa\u9898\u76ee\u8981\u6c42\u7684\u4e1c\u897f\uff1a\n$$\nans=\\max\\{\\min \\{a_{l_i},a_{l_i+1}\\dots a_{r_i}\\}\\}~(i\\in[1,n])\n$$\n\n\u5bf9\u8fd9\u4e2a\u5f0f\u5b50\u505a Min-Max \u5bb9\u65a5\uff1a\n$$\nans=\\sum_{S}(-1)^{|S|-1}\\min_{i\\in S}\\{\\min \\{a_{l_i},a_{l_i+1}\\dots a_{r_i}\\}\\}\n$$\n\n\u8003\u8651\u8fd9\u4e2a\u5f0f\u5b50\u7684\u610f\u4e49\uff1a\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8be2\u95ee\u7684\u5b50\u96c6 $S$ \uff0c\u5b83\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u662f $(-1)^{|S|-1}$ \u4e58\u5b50\u96c6\u4e2d\u7684\u6240\u6709\u8be2\u95ee\u7684\u533a\u95f4\u7684\u5e76\u7684\u671f\u671b\u6700\u5c0f\u503c\u3002\n\n\u5bf9\u4e8e $len$ \u4e2a\u6570\u7684\u671f\u671b\u6700\u5c0f\u503c $f_{len}$\uff0c\u76f4\u63a5 $dp$ \u9884\u5904\u7406\uff0c\u590d\u6742\u5ea6 $O(n^2)$ \u3002\n\n\u7136\u540e\u8bbe $g_{i,0/1,k}$ \u8868\u793a\u9009\u5230\u7b2c $i$ \u4e2a\u8be2\u95ee\u533a\u95f4\uff08\u5fc5\u987b\u9009\u7b2c $i$ \u4e2a\uff09\uff0c\u9009\u4e86\u5947\u6570/\u5076\u6570\u4e2a\u533a\u95f4\uff0c\u533a\u95f4\u5e76\u957f\u5ea6\u4e3a $k$ \u7684\u65b9\u6848\u6570\uff0c\u5219\u7b54\u6848\u4e3a $\\sum_{i,j,k}(-1)^{j+1}g_{i,j,k}f_k$ \u3002\n\n\u53bb\u9664\u6240\u6709\u5305\u542b\u4e86\u67d0\u4e2a\u533a\u95f4\u7684\u533a\u95f4\u5e76\u6309\u53f3\u7aef\u70b9\u6392\u5e8f\u540e\uff08\u663e\u7136\u8fd9\u79cd\u533a\u95f4\u5bf9\u7b54\u6848\u6ca1\u6709\u8d21\u732e\uff09\uff0c\u76f4\u63a5 $dp$ $g$ \u6570\u7ec4\u590d\u6742\u5ea6\u662f $n^3$ \u7684\u3002\n\n\u8bbe\u7b2c $i$ \u4e2a\u8be2\u95ee\u7684\u5de6\u53f3\u7aef\u70b9\u5206\u522b\u4e3a $l_i,r_i$ \uff0c\u5217\u51fa $g$ \u7684\u8f6c\u79fb\u5f0f\uff1a\n$$\ng_{i,j,k}=\\sum_{r_p\\ge l_i} g_{p,j\\oplus 1,k-r_i+r_p}+\\sum_{r_p<l_i}\ng_{p,j\\oplus 1,k-r_i+l_i}\n$$\n\n\u4e3a\u4e86\u5feb\u901f\u5904\u7406\u8fd9\u4e24\u79cd\u8f6c\u79fb\uff0c\u6211\u4eec\u5efa\u7acb\u4e24\u4e2a\u8f85\u52a9\u6570\u7ec4 $h_{i,j}$ \u548c $t_{i,j}$\n\n\u7531\u4e8e $l_i$ \u5355\u8c03\u9012\u589e\uff0c\u6240\u4ee5\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a\u5355\u8c03\u6307\u9488\uff0c\u5728\u6c42\u51fa\u6bcf\u4e00\u4e2a $g_{i,j,k}$ \u540e\uff0c\u5148\u628a\u5b83\u52a0\u5165 $h_{j,r_i-k}$ \u4e2d\uff0c\u5728\u88ab\u5355\u8c03\u6307\u9488\u626b\u8fc7\uff08\u5373\u4ece\u7b2c\u4e00\u79cd\u8f6c\u79fb\u53d8\u6210\u7b2c\u4e8c\u79cd\u8f6c\u79fb\uff09\u540e\uff0c\u5c06\u5b83\u4ece $h_{j,r_i-k}$ \u4e2d\u5220\u53bb\uff0c\u5e76\u52a0\u5165\u5230 $t_{j,k}$ \u4e2d\uff0c\u5219 $g$ \u7684\u8f6c\u79fb\u53ef\u4ee5\u5199\u6210\uff1a\n$$\ng_{i,j,k}=h_{j\\oplus 1,r_i-k}+t_{j\\oplus1,k-r_i+l_i}\n$$\n\n\u590d\u6742\u5ea6 $O(n^2)$ \uff0c\u8dd1\u7684\u98de\u5feb\uff08\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define getchar() (p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)? EOF:*p1++)\n#define P pair<ll,ll>\n#define A first\n#define B second\nusing namespace std;\ntypedef long long ll;\nconst int N=2005,mod=666623333;\nchar buf[1<<23],*p1=buf,*p2=buf;\nll n,x,q,f[N][N],F[N],jc[N],jv[N],inv[N];\nll g[2][N][N],h[2][N],H[2][N],ans,now;\nP sq[N];\nint read()\n{\n\tint res=0,fl=0; char a=getchar();\n\twhile(a<'0'||a>'9') fl|=a=='-',a=getchar();\n\twhile(a>='0'&&a<='9') res=res*10+a-'0',a=getchar();\n\treturn fl? -res:res;\n}\nll ksm(ll di,ll mi) {ll res=1; for(;mi;mi>>=1,di=di*di%mod) if(mi&1) res=res*di%mod; return res;}\nint main()\n{\n\tll i,j,li,lj,ps;\n\tn=read(),x=read(),q=read();\n\tfor(jc[0]=i=1;i<N;i++) jc[i]=jc[i-1]*i%mod;\n\tfor(jv[N-1]=ksm(jc[N-1],mod-2),i=N-2;~i;i--) jv[i]=jv[i+1]*(i+1)%mod,i&&(inv[i]=jv[i]*jc[i-1]%mod);\n\tf[0][x]=1;\n\tfor(i=0;i<n;i++)\n\t\tfor(j=x,li=f[i][j];j;j--,li=(li+f[i][j])%mod)\n\t\t\tf[i+1][j]=(f[i+1][j]+f[i][j]*(x-j+1)%mod*inv[x])%mod,j>1&&(f[i+1][j-1]=(f[i+1][j-1]+li*inv[x])%mod);\n\tfor(i=1;i<=n;i++)\n\t\tfor(j=1;j<=x;j++) F[i]=(F[i]+f[i][j]*j)%mod;\n\tfor(i=1;i<=q;i++) sq[i].A=read(),sq[i].B=read();\n\tfor(i=1;i<=q;i++)\n\t{\n\t\tint fl=0;\n\t\tfor(j=1;j<i;j++) if(sq[i].A<=sq[j].A&&sq[i].B>=sq[j].B) fl=1;\n\t\tfor(j=i+1;j<=q;j++) if(!(sq[i].A==sq[j].A&&sq[i].B==sq[j].B)&&sq[i].A<=sq[j].A&&sq[i].B>=sq[j].B) fl=1;\n\t\tif(fl) for(j=i,q--,i--;j<=q;j++) sq[j]=sq[j+1];\n\t}\n\tsort(sq+1,sq+q+1);\n\tg[0][0][0]=1,h[0][0]=1;\n\tfor(i=1,ps=1;i<=q;i++)\n\t{\n\t\twhile(ps<i&&sq[ps].B<sq[i].A)\n\t\t{\n\t\t\tfor(j=0;j<2;j++)\n\t\t\t\tfor(li=sq[ps].B-sq[ps].A+1;li<=sq[ps].B;li++)\n\t\t\t\t\t(h[j][li]+=g[j][ps][li])%=mod,(H[j][sq[ps].B-li]+=mod-g[j][ps][li])%=mod;\n\t\t\tps++;\n\t\t}\n\t\tfor(j=0;j<2;j++)\n\t\t\tfor(li=sq[i].B-sq[i].A+1;li<=sq[i].B;li++)\n\t\t\t\tg[j][i][li]=(H[j^1][sq[i].B-li]+h[j^1][li-sq[i].B+sq[i].A-1])%mod;\n\t\tfor(j=1;j<=sq[i].B;j++) ans=(ans+(g[1][i][j]-g[0][i][j]+mod)*F[j])%mod;\n\t\tfor(j=0;j<2;j++)\n\t\t\tfor(li=sq[i].B-sq[i].A+1;li<=sq[i].B;li++) (H[j][sq[i].B-li]+=g[j][i][li])%=mod;\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```\n",
        "postTime": 1615102574,
        "uid": 223768,
        "name": "Yukikaze_",
        "ccfLevel": 9,
        "title": "P3600\u968f\u673a\u6570\u751f\u6210\u5668 \u9898\u89e3"
    },
    {
        "content": "## Solution\n\n### \u533a\u95f4\u6392\u5e8f\n\n\u5c06\u6240\u6709\u5e8f\u5217\u6309\u7167\u5de6\u7aef\u70b9\u6392\u5e8f\u3002\n\n### \u8f6c\u5316\n\n\u8fd9\u9053\u9898\u8981\u6211\u4eec\u6c42\u4e00\u4e2a\u6700\u5927\u503c\u7684\u671f\u671b\uff0c\u6211\u4eec\u8ba4\u8bc6\u7684\u671f\u671b\u662f\u8fd9\u4e48\u7b97\u7684\uff1a\n\n$E(x)=\\sum_{i=0} i\\times P(i)$\n\n\u4f46\u6211\u4eec\u53ef\u4ee5\u8f6c\u5316\u4e00\u4e0b\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u53d8\u6210\u4e0b\u9762\u8fd9\u6837\uff1a\n\n$\\because P(x)=P(i<=x)-P(i<=x-1)$\n\n$E(x)=\\sum_{i=0}^\\infin i\\times [P(i<=x)-P(i<=x-1)]$\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa$P(i<=x)$\u7684\u503c\u5373\u53ef\u3002\n\n### \u8ba1\u7b97\n\n\u5b9a\u4e49$f[i]  $\u4e3a\u524di\u4f4d\u6ee1\u8db3\u6240\u6709\u7684\u533a\u95f4\u7684min\u503c\u90fd\u5c0f\u4e8ek\u7684\u6982\u7387\uff0c\u6240\u4ee5\u7b54\u6848\u5c31\u662f$f[n]$\u3002\n\n\u6211\u4eec\u6309\u987a\u5e8f\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u533a\u95f4\u8fdb\u884c\u8ba1\u7b97\uff1a\n\n$f[r]=\\sum_{i=l}^r f[i-1]\\times (\\frac{k}{n})\\times(1-\\frac{k}{n})^{r-i}$\n\n\u56e0\u4e3a\u533a\u95f4\u662f\u6309\u7167\u5de6\u7aef\u70b9\u6392\u5e8f\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u6700\u540e\u4e00\u6b21\u51fa\u73b0\u5c0f\u4e8e\u7b49\u4e8ek\u7684\u6570\u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u662f\u4e0d\u4f1a\u6709\u91cd\u590d\u8ba1\u7b97\u7684\uff0c\u540c\u65f6\u8fd8\u9700\u8981\u4fdd\u8bc1\u524d\u9762\u80fd\u6ee1\u8db3\u6761\u4ef6\uff0c\u4e5f\u5c31\u662f$f[i-1]$\u3002\n\n### \u4f18\u5316\n\n\u518d\u89c2\u5bdf\u4e0a\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff1a\n\n$f[r]=(1-\\frac{k}{n})\\times  \\sum_{i=l}^r f[i-1]\\times (\\frac{k}{n})\\times(1-\\frac{k}{n})^{-i}$\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u524d\u7f00\u548c\uff1a\n\n$sum[i]=\\sum_{i=1}^i f[i]\\times (1-\\frac{k}{n})^{-i-1}$\n\n$f[r]=(1-\\frac{k}{n})\\times \\frac{k}{n} \\times (sum[r-1]-sum[l-1])$\n\n## Code\n\n```c++\n#include <cstdio>\n#include <cstdlib>\n#include <cstring>\n#include <algorithm>\n#include <cmath>\n#define int long long \n#define MAXN 2005 \n#define MOD 666623333\nusing namespace std;\n\nstruct line{\n    int l,r;\n    bool operator<(const line a)const\n    {\n        if(l==a.l)return r<a.r;\n        return l<a.l;\n    }\n}p[MAXN],b[MAXN];\n\nint qpow(int x,int k)\n{\n    int res=1;\n    while(k>0)\n    {\n        if(k&1)\n            res=res*x%MOD;\n        x=x*x%MOD;\n        k>>=1;\n    }\n    return res;\n}\n\nint n,x,q;\nint sum[MAXN];\nint head[MAXN],nxt[MAXN];\n\nint getsum(int l,int r){\n    return (sum[r]-(l<1?0:sum[l-1])+MOD)%MOD;\n}\n\nint inv(int x)\n{\n    return qpow(x,MOD-2);\n}\n\nint calc(int k)\n{\n    int f[MAXN],p1=k*inv(x)%MOD,p2=(1-p1+MOD)%MOD,p3=inv(p2);\n    memset(f,0,sizeof(f));\n    memset(sum,0,sizeof(sum));\n    f[0]=1,sum[0]=p3;\n    for(int i=1;i<=n;i++)\n    {\n        for(int j=head[i];j;j=nxt[j])\n        {\n            if(i>p[j].l)f[i]=(f[i]+getsum(p[j].l-1,i-2)*p1%MOD*qpow(p2,i)%MOD)%MOD;\n            f[i]=(f[i]+f[i-1]*p1%MOD)%MOD;\n        }\n        if(!head[i])f[i]=f[i-1];\n        sum[i]=(sum[i-1]+f[i]*qpow(p3,i+1)%MOD)%MOD;\n    }\n    return f[n];\n}\n\nsigned main()\n{\n    scanf(\"%lld%lld%lld\",&n,&x,&q);\n    for(int i=1;i<=q;i++)\n    {\n        scanf(\"%lld%lld\",&b[i].l,&b[i].r);\n\n    }\n    sort(b+1,b+q+1);\n    int m=0;\n    for(int i=1;i<=q;i++)\n    {\n        while(p[m].r>=b[i].r)m--;\n        if(p[m].l<b[i].l)p[++m]=b[i];\n    }\n    //printf(\"%lld\\n\",inv(2));\n    for(int i=1;i<=m;i++)\n    {\n        //printf(\"%lld %lld\\n\",p[i].l,p[i].r);\n        nxt[i]=head[p[i].r];\n        head[p[i].r]=i;\n    }\n    int pre=0;\n    int ans=0;\n    for(int i=1;i<=x;i++)\n    {\n        int now=calc(i);\n        ans=(ans+i*((now-pre+MOD)%MOD)%MOD)%MOD;\n        pre=now;\n    }\n    printf(\"%lld\",ans);\n    return 0;\n}\n\n```\n\n",
        "postTime": 1552238306,
        "uid": 63925,
        "name": "joe19025",
        "ccfLevel": 0,
        "title": "\u671f\u671bDP\u2014\u2014P3600 \u968f\u673a\u6570\u751f\u6210\u5668"
    },
    {
        "content": "## \u9898\u610f\n\n~~\u592a\u957f\u4e86\u81ea\u5df1\u770b\u9898~~\n\n## Solution\n\n\u8fd9\u9053\u9898\u6c42\u7ed3\u679c\u7684\u671f\u671b\u5927\u5c0f\u3002\n\n\u8bbe $ P(i)=(Ans<=i)$ \u7684\u6982\u7387\n\uff0c\u5219\u3000$ Ans=\\sum\\limits_{i=1}^x(P(i)-P(i-1))\\times i $ \n\n\u8fd9\u9053\u9898\u4e2d\uff0c\u751f\u6210\u6bcf\u4e00\u79cd\u60c5\u51b5\u7684\u6982\u7387\u662f\u76f8\u7b49\u7684\uff0c\u56e0\u6b64\u53ef\u5c06\u6982\u7387\u8f6c\u5316\u4e3a\u65b9\u6848\u6570\u4e4b\u6bd4\uff1a\n\n\u8bbe $ h(i)=(Ans<=i) $ \u7684\u65b9\u6848\u6570,\u5219\n$ P(i)= \\dfrac{h(i)}{i^n} $\n\n\u800c \u7ed3\u679c $ \\le i \\Leftrightarrow $ \u5bf9\u4e8e\u7ed9\u5b9a\u7684\u6bcf\u4e2a\u533a\u95f4\u5185\u90fd\u5b58\u5728\u81f3\u5c11\u4e00\u4e2a $ \\le i $ \u7684\u6570\n\n\u6240\u4ee5\u8bbe $ g(i)= $ \u63d2\u5165\u7b26\u5408\u8981\u6c42\u7684 $ i $ \u4e2a\u6570\uff0c\u6ee1\u8db3\u6240\u6709\u7ed9\u5b9a\u533a\u95f4\u90fd\u5b58\u5728\u81f3\u5c11\u8fd9\u6837\u4e00\u4e2a\u7b26\u5408\u8981\u6c42\u7684\u6570\u7684\u65b9\u6848\u6570\n\n\u90a3\u4e48 $ h(i)=\\sum\\limits_{j=1}^ng(j)\\times i^j\\times (x-i)^{n-j} $ (\u5373\u679a\u4e3e\u751f\u6210\u4e86 $ j $ \u4e2a $ \\le i $ \u7684\u6570)\n\n\u63a5\u4e0b\u6765\u8003\u8651\u5982\u4f55\u6c42 $ g(i) $ \uff0c\u6211\u4eec\u53d1\u73b0\u8fd9\u5df2\u7ecf\u8ddf\u503c\u57df\u6ca1\u6709\u5173\u7cfb\u4e86\uff0c\u53ef\u4ee5\u76f4\u63a5 $ DP $ \u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5bf9\u4e8e\u4e24\u4e2a\u533a\u95f4\uff0c\u5982\u679c\u5b83\u4eec\u662f\u5305\u542b\u4e0e\u88ab\u5305\u542b\u7684\u5173\u7cfb\uff0c\u90a3\u4e48\u53ea\u9700\u6ee1\u8db3\u90a3\u4e2a\u5c0f\u533a\u95f4\u7684\u9650\u5236\uff0c\u5927\u533a\u95f4\u7684\u9650\u5236\u5c31\u4e00\u5b9a\u53ef\u4ee5\u88ab\u6ee1\u8db3\u3002\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5220\u53bb\u6240\u6709\u7684\u8fd9\u79cd\u5927\u533a\u95f4\u3002\u5269\u4e0b\u7684\u533a\u95f4\u6392\u5e8f\u540e\u5c31\u662f\u5de6\u754c\u53f3\u754c\u90fd\u4e0d\u51cf\u7684\u4e86\u3002\n\n\u5982\u4f55 $ DP $ \u5462\uff1f\u6211\u4eec\u8bbe $ dp[i][j] $ \u8868\u793a\u5728 $ i $ \u4f4d\u7f6e\u63d2\u5165\u4e86\u8fd9\u6837\u7684\u6570\uff0c\u603b\u5171\u5df2\u63d2\u5165\u4e86 $ j $ \u4e2a\u8fd9\u6837\u7684\u6570\u7684\u65b9\u6848\u6570\uff0c\n\n\u5219 $ dp[i][j]= \\sum\\limits_{k=1}^ndp[k][j-1] $ \uff0c\u7136\u800c\u9700\u8981\u8fd9\u4e2a $ k $ \u548c $ i $ \u4e2d\u95f4\u6ca1\u6709\u4e00\u4e2a\u65e2\u4e0d\u542b $ k $\uff0c\u4e5f\u4e0d\u542b $ i $ \u7684\u533a\u95f4\uff0c\u56e0\u4e3a\u5426\u5219\u8fd9\u4e2a\u533a\u95f4\u91cc\u5c31\u5c06\u6ca1\u6709\u7b26\u5408\u8981\u6c42\u7684\u6570\u3002\n\n\u968f\u7740 $ i $ \u7684\u589e\u957f\uff0c $ k $ \u663e\u7136\u4e5f\u662f\u5355\u8c03\u4e0d\u964d\u7684\u3002\u56e0\u6b64\u5957\u4e0a\u4e00\u4e2a\u524d\u7f00\u548c\uff0c\u8fd9\u4e2a $ DP $ \u5c31\u53ef\u4ee5\u88ab\u4f18\u5316\u5230 $ O(n^2) $ \u3002\n\n\u628a\u4e0a\u8ff0\u601d\u8def\u9006\u8fc7\u6765\u5b9e\u73b0\uff0c\u8fd9\u9053\u9898\u5c31\u88ab\u89e3\u51b3\u4e86\u3002\n\n\u5728 $ DP $ \u524d\u7684\u9884\u5904\u7406\u6709\u4e9b\u5c0f\u7ec6\u8282\uff0c\u8bf7\u53c2\u8003\u4ee3\u7801\u7406\u89e3\u3002\n\n```cpp\n\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=2010,Mod=666623333;\nstruct node{int l,r;}a[N],b[N];\nint dp[N][N],g[N],h[N],p[N];\nint fl[N],fr[N],sum[N];\nbool cmp(node q,node p){\n\tif(q.l!=p.l)return q.l<p.l;\n\treturn q.r>p.r;\n}\nint qp(int x,int y){\n\tif(!y)return 1;\n\tint t=qp(x,y>>1);\n\tif(y&1)return t*t%Mod*x%Mod;\n\treturn t*t%Mod;\n}\nsigned main(){\n\tint n,x,q,m=0;\n\tcin>>n>>x>>q;\n\tfor(int i=1;i<=q;i++)\n\t\tcin>>a[i].l>>a[i].r;\n\tsort(a+1,a+1+q,cmp);\n\tfor(int i=1;i<=q;i++){\n\t\twhile(a[i].r<=b[m].r)--m;\n\t\tb[++m]=a[i];\n\t}\n\tfor(int i=1;i<=n;i++)fl[i]=m+1;\n\tfor(int i=1;i<=m;i++)\n\t\tfor(int j=b[i].l;j<=b[i].r;j++)\n\t\t\tfl[j]=min(fl[j],i),fr[j]=max(fr[j],i);\n\tfor(int i=1;i<=n;i++){\n\t\tif(fr[i])continue;\n\t\tfor(int j=1;j<=m;j++)\n\t\t\tif(b[j].r<i)fr[i]=j;\n\t\t\telse break;\n\t\tfor(int j=m;j>=1;j--)\n\t\t\tif(b[j].l>i)fl[i]=j;\n\t\t\telse break;\n\t}\n\tdp[0][0]=1;\n\tfor(int i=0;i<=n;i++)sum[i]=1;\n\tfor(int j=1;j<=n;j++){\n\t\tfor(int i=1,k=0;i<=n;i++){\n\t\t\twhile(fr[k]+1<fl[i]&&k<i)k++;\n\t\t\tif(k>=i)continue;\n\t\t\tdp[i][j]=(sum[i-1]-(k==0?0:sum[k-1]))%Mod;\n\t\t}\n\t\tsum[0]=dp[0][j];\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tsum[i]=sum[i-1]+dp[i][j];\n\t}\n\tfor(int i=n;i;i--){\n\t\tif(fr[i]!=m)break;\n\t\tfor(int j=1;j<=n;j++)\n\t\t\t(g[j]+=dp[i][j])%=Mod;\n\t}\n\tfor(int i=1;i<=x;i++){\n\t\tfor(int j=1;j<=n;j++)\n\t\t\t(h[i]+=qp(i,j)*qp(x-i,n-j)%Mod*g[j]%Mod)%=Mod;\n\t\tp[i]=h[i]*qp(qp(x,n),Mod-2)%Mod;\n\t}\n\tint ans=0;\n\tfor(int i=1;i<=x;i++)\n\t\t(ans+=(p[i]-p[i-1]+Mod)%Mod*i%Mod)%=Mod;\n\tcout<<ans<<endl;\n\treturn 0;\n}",
        "postTime": 1597235804,
        "uid": 35117,
        "name": "Mentos_Cola",
        "ccfLevel": 7,
        "title": "P3600 \u968f\u673a\u6570\u751f\u6210\u5668"
    },
    {
        "content": "\u5b98\u65b9\u9898\u89e3\uff1a https://www.luogu.org/discuss/show?postid=7867\n",
        "postTime": 1486036514,
        "uid": 141,
        "name": "w",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3600 \u3010\u968f\u673a\u6570\u751f\u6210\u5668\u3011"
    },
    {
        "content": "[\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P3600)\n\n~~\u6211\u7adf\u7136\u72ec\u7acb\u641e\u51fa\u4e86\u8fd9\u9053\u9ed1\u9898\uff01incredible\uff01~~\n\nu1s1 \u8fd9\u9898\u662f\u6211\u505a\u9898\u65f6\u95f4\u8de8\u5ea6\u6700\u5927\u7684\u9898\u4e4b\u4e00\u2026\u2026\n\n\u9996\u5148\u8bb2\u4e0b\u6211\u56db\u4e2a\u6708\u524d\u60f3\u51fa\u6765\u7684 $n^2\\log n$ \u7684\u505a\u6cd5\u5427\u3002\n\n\u8bb0 $f(a)=\\max\\limits_{i=1}^q\\min\\limits_{j=l_i}^{r_i}a_j=x$\n\n\u9996\u5148\u671f\u671b\u8f6c\u6982\u7387\uff0c\u8bbe $p_i$ \u8868\u793a $f(a)=x$ \u7684\u6982\u7387\uff0c\u7b54\u6848\u5373\u4e3a $\\sum p_i\\times i$\u3002\n\n\u6ce8\u610f\u5230\u8fd9\u9898\u76f4\u63a5\u6c42 $f(a)=x$ \u7684\u6982\u7387\u4e0d\u662f\u7279\u522b\u5bb9\u6613\uff0c\u6545\u8003\u8651\u6362\u4e2a\u601d\u8def\uff0c\u6c42\u51fa $f(a)\\geq x$ \u7684\u6982\u7387 $t_x$ \u7136\u540e\u6c42\u4e2a\u5dee\u5206\u5373\u53ef\u3002\u662f\u6211\u4eec\u7684\u4efb\u52a1\u8f6c\u5316\u4e3a\u6c42 $t_x$ \u7684\u503c\u3002\n\n\u8bb0\u5e8f\u5217\u4e2d $<x$ \u7684\u6570\u4e3a $0$\uff0c$\\ge x$ \u7684\u6570\u4e3a $1$\uff0c\u90a3\u4e48\u539f\u9898\u7b49\u4ef7\u4e8e\u8fd9\u6837\u4e00\u4e2a\u95ee\u9898\uff0c\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u968f\u673a $01$ \u5e8f\u5217\uff0c\u6bcf\u4e00\u4f4d\u751f\u6210 $0$ \u7684\u6982\u7387\u4e3a $p_0=\\dfrac{x-1}{m}$\uff0c\u751f\u6210 $1$ \u7684\u6982\u7387\u4e3a $p_1=\\dfrac{m-x+1}{m}$\uff0c\u7ed9\u5b9a $q$ \u4e2a\u533a\u95f4 $[l_i,r_i]$\uff0c\u95ee\u6709\u591a\u5927\u6982\u7387\u6ee1\u8db3\u8fd9 $q$ \u4e2a\u533a\u95f4\u4e2d**\u81f3\u5c11\u5b58\u5728\u4e00\u4e2a\u533a\u95f4\u4e2d\u5168\u662f $1$**\u3002\n\n\u8fd9\u4e2a\u95ee\u9898\u53ef\u4ee5\u7528 $dp$ \u6c42\u89e3\uff0c\u8bbe $dp_{i,j}$ \u8868\u793a\u5f53\u524d\u586b\u597d\u4e86\u524d $i$ \u4f4d\uff0c\u4e0a\u4e00\u4e2a $0$ \u7684\u4f4d\u7f6e\u4e3a $j$\uff0c\u5e76\u4e14\u5230\u73b0\u5728\u4e3a\u6b62\u4e0d\u5b58\u5728\u5168\u4e3a $1$ \u7684\u533a\u95f4\u7684\u6982\u7387\u3002\n\n\u8003\u8651\u8f6c\u79fb\uff0c\u8bb0 $mx_R$ \u8868\u793a $\\max\\limits_{i=1}^ql_i(r_i=R)$\uff0c\u5206\u4e09\u79cd\u60c5\u51b5\u8f6c\u79fb\uff1a\n\n- $j<mx_i$\uff0c\u90a3\u4e48\u663e\u7136\u5df2\u7ecf\u5b58\u5728\u5168 $1$ \u7684\u533a\u95f4\u4e86\uff08$[mx_i,j]$\uff09\uff0c\u6545 $dp_{i,j}=0$ \u5e76\u8ba9 $t_x$ \u52a0\u4e0a $dp_{i-1,j}\\times p_1$\u3002\n- $mx_i\\le j<i$\uff0c\u663e\u7136 $dp_{i,j}=dp_{i-1,j}\\times p_1$\u3002\n- $j=i$\uff0c\u8003\u8651\u679a\u4e3e\u5728 $i$ \u524d\u9762\u4e0a\u4e00\u4e2a\u4e3a $0$ \u7684\u4f4d\u7f6e $k$\uff0c\u90a3\u4e48\u6709 $dp_{i,j}=\\sum\\limits_{k=0}^{i-1}dp_{i-1,k}\\times p_0$\u3002\n\n\u8fd9\u6837\u66b4\u529b\u8f6c\u79fb\u590d\u6742\u5ea6\u662f $n^2$ \u7684\uff0c\u4e0d\u8fc7\u8003\u8651\u501f\u9274 CF115E \u7684\u5957\u8def\uff0c\u53ef\u4ee5\u5efa\u4e00\u68f5**\u7ebf\u6bb5\u6811**\u5728\u679a\u4e3e $i$ \u7684\u8fc7\u7a0b\u4e2d\u5b9e\u65f6\u7ef4\u62a4 $dp_{i,j}$ \u7684\u503c\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5bf9\u4e8e $j<mx_i$ \u7684\u90e8\u5206\u5c31\u67e5\u8be2 $[0,mx_i-1]$ \u7684\u548c $sum$\uff0c\u5c06 $sum\\times p_1$ \u7d2f\u52a0\u5165\u7b54\u6848\u4e2d\u5e76\u5c06 $[0,mx_i-1]$ \u5168\u90e8\u8d4b\u4e0a $0$\uff1b\u5bf9\u4e8e $mx_i\\le j<i$ \u7684\u90e8\u5206\u4ee4\u7ebf\u6bb5\u6811\u4e0a $[mx_i,j)$ \u4f4d\u7f6e\u4e0a\u7684\u503c\u4e58\u4e0a $p_1$\uff1b\u5bf9\u4e8e $j=i$ \u7684\u90e8\u5206\u5c31\u67e5\u8be2\u4e00\u904d $[0,i-1]$ \u7684\u548c $sum$ \u5e76\u5728\u7ebf\u6bb5\u6811\u4e0a $i$ \u4f4d\u7f6e\u7684\u503c\u8d4b\u4e0a $sum\\times p_1$\uff0c\u8fd9\u6837\u5373\u53ef\u5b9e\u73b0 $\\mathcal O(\\log n)$ \u8f6c\u79fb\uff0cDP \u7684\u590d\u6742\u5ea6\u4e5f\u5c31\u964d\u5230\u4e86 $n\\log n$\uff0c\u518d\u52a0\u4e0a\u5916\u5c42\u6c42\u89e3 $t_x$ \u6240\u679a\u4e3e\u7684 $x$ \u53ef\u77e5\u603b\u590d\u6742\u5ea6\u4e3a $n^2\\log n$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fz(i,a,b) for(int i=a;i<=b;i++)\n#define fd(i,a,b) for(int i=a;i>=b;i--)\n#define ffe(it,v) for(__typeof(v.begin()) it=v.begin();it!=v.end();it++)\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntypedef pair<int,int> pii;\ntypedef long long ll;\nconst int MAXN=2e3+5;\nconst int MOD=666623333;\nint n,m,q,l[MAXN+5],r[MAXN+5],inv,p[MAXN+5],ans[MAXN+5];\nint qpow(int x,int e){\n\tint ret=1;\n\tfor(;e;e>>=1,x=1ll*x*x%MOD) if(e&1) ret=1ll*ret*x%MOD;\n\treturn ret;\n}\nint add(int x,int y){return ((x+=y)>=MOD)?(x-MOD):x;}\nstruct node{int l,r,val,lz;} s[MAXN*4+5];\nvoid build(int k,int l,int r){\n\ts[k].l=l;s[k].r=r;s[k].val=0;s[k].lz=1;if(l==r) return;\n\tint mid=(l+r)>>1;build(k<<1,l,mid);build(k<<1|1,mid+1,r);\n}\nvoid pushdown(int k){\n\tif(!s[k].lz){\n\t\ts[k<<1].lz=0;s[k<<1|1].lz=0;\n\t\ts[k<<1].val=0;s[k<<1|1].val=0;\n\t\ts[k].lz=1;return;\n\t}\n\tif(s[k].lz^1){\n\t\ts[k<<1].lz=1ll*s[k<<1].lz*s[k].lz%MOD;\n\t\ts[k<<1].val=1ll*s[k<<1].val*s[k].lz%MOD;\n\t\ts[k<<1|1].lz=1ll*s[k<<1|1].lz*s[k].lz%MOD;\n\t\ts[k<<1|1].val=1ll*s[k<<1|1].val*s[k].lz%MOD;\n\t\ts[k].lz=1;\n\t}\n}\nvoid modify(int k,int l,int r,int x){\n\tif(l>r) return;\n\tif(l<=s[k].l&&s[k].r<=r){\n\t\ts[k].lz=1ll*s[k].lz*x%MOD;\n\t\ts[k].val=1ll*s[k].val*x%MOD;return;\n\t} pushdown(k);int mid=(s[k].l+s[k].r)>>1;\n\tif(r<=mid) modify(k<<1,l,r,x);\n\telse if(l>mid) modify(k<<1|1,l,r,x);\n\telse modify(k<<1,l,mid,x),modify(k<<1|1,mid+1,r,x);\n\ts[k].val=add(s[k<<1].val,s[k<<1|1].val);\n}\nvoid update(int k,int ind,int x){\n\tif(s[k].l==s[k].r){s[k].val=x;return;}\n\tpushdown(k);int mid=(s[k].l+s[k].r)>>1;\n\tif(ind<=mid) update(k<<1,ind,x);\n\telse update(k<<1|1,ind,x);\n\ts[k].val=add(s[k<<1].val,s[k<<1|1].val);\n}\nint query(int k,int l,int r){\n\tif(l>r) return 0;\n\tif(l<=s[k].l&&s[k].r<=r) return s[k].val;\n\tpushdown(k);int mid=(s[k].l+s[k].r)>>1;\n\tif(r<=mid) return query(k<<1,l,r);\n\telse if(l>mid) return query(k<<1|1,l,r);\n\telse return add(query(k<<1,l,mid),query(k<<1|1,mid+1,r));\n}\nvoid solve(int x){\n\tint p1=1ll*(m-x+1)*inv%MOD,p0=1ll*(x-1)*inv%MOD;\n\tmodify(1,0,n,0);update(1,0,1);\n\tfor(int i=0;i<=n;i++){\n\t\tans[x]=(ans[x]+query(1,0,p[i]-1))%MOD;modify(1,0,p[i]-1,0);\n\t\tupdate(1,i+1,1ll*query(1,p[i],i)*p0%MOD);modify(1,p[i],i,p1);\n\t}\n}\nint main(){\n\tscanf(\"%d%d%d\",&n,&m,&q);inv=qpow(m,MOD-2);\n\tfor(int i=1;i<=q;i++) scanf(\"%d%d\",&l[i],&r[i]),p[r[i]]=max(p[r[i]],l[i]);\n\tbuild(1,0,n);for(int i=m;i;i--) solve(i);int ret=0;\n\tfor(int i=1;i<=m;i++) ret=(ret+1ll*(ans[i]-ans[i+1]+MOD)*i%MOD)%MOD;\n\tprintf(\"%d\\n\",ret);\n\treturn 0;\n}\n/*\n4 3 2\n1 3\n2 4\n*/\n```\n\n\u7136\u9e45\u5f53\u6211\u5199\u597d\u4e86\u4ee3\u7801\uff0c\u6709\u5341\u8db3\u7684\u4fe1\u5fc3\u5207\u6389\u8fd9\u9053\u9898\u7684\u65f6\u5019\u2026\u2026\n\n\u2026\u2026\u2026\u2026TLE 70\uff1f\n\n\u5f53\u65f6\u8fd8\u4ee5\u4e3a\u662f\u81ea\u5df1\u5e38\u6570\u5199\u5927\u4e86\uff0c\u82b1\u4e86\u4e5d\u725b\u4e8c\u864e\u4e4b\u529b\u5361\u5e38\u5374\u65e0\u679c\uff0cxtbz\n\n\u4e8e\u662f\u8fd9\u9053\u9898\u5c31\u5149\u8363\u5730\u5728\u6211\u3010\u5c1d\u8bd5\u8fc7\u7684\u9898\u3011\u4e2d\u8eba\u4e86\u56db\u4e2a\u6708\u3002\n\n---\n\n\u8fd9\u5468\u4e09\u7684\u65f6\u5019\u53c8\u91cd\u65b0\u7ffb\u5230\u4e86\u8fd9\u4e2a\u9898\uff0c\u987a\u5e26\u7740\u628a $n^2$ \u7684\u7b97\u6cd5\u60f3\u51fa\u6765\u4e86\u3002\n\n~~\u4e8e\u662f\u73b0\u5728\u6211\u624d\u77e5\u9053\u5f53\u65f6\u5e73\u65b9\u5bf9\u6570\u7684\u7b97\u6cd5\u8fc7\u4e0d\u4e86\u662f\u51fa\u9898\u4eba\u6545\u610f\u5361\u7684~~\n\n\u6ce8\u610f\u5230\u5728\u4e4b\u524d\u5e73\u65b9\u5bf9\u6570\u7684\u7b97\u6cd5\u4e2d\uff0c\u6211\u4eec\u5bf9 $t_x$ \u7684\u5b9a\u4e49\u4e3a $f(a)\\geq x$ \u7684\u6982\u7387\uff0c\u5982\u679c\u6362\u6210 $f(a)\\le x$ \u7684\u6982\u7387\u4f1a\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f\n\n\u8fd9\u6b21\uff0c\u6211\u4eec\u8bb0\u5e8f\u5217\u4e2d $\\le x$ \u7684\u6570\u4e3a $1$\uff0c$>x$ \u7684\u6570\u4e3a $0$\uff0c\u90a3\u4e48\u6c42\u89e3 $f(a)\\le x$ \u7684\u90e8\u5206\u7b49\u4ef7\u4e8e\u5982\u4e0b\u7684\u95ee\u9898\uff1a\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u968f\u673a $01$ \u5e8f\u5217\uff0c\u6bcf\u4e00\u4f4d\u751f\u6210 $0$ \u7684\u6982\u7387\u4e3a $p_0=1-\\dfrac{x}{m}$\uff0c\u751f\u6210 $1$ \u7684\u6982\u7387\u4e3a $p_1=\\dfrac{x}{m}$\uff0c\u7ed9\u5b9a $q$ \u4e2a\u533a\u95f4 $[l_i,r_i]$\uff0c\u95ee\u6709\u591a\u5927\u6982\u7387\u6ee1\u8db3\u8fd9 $q$ \u4e2a\u533a\u95f4\u4e2d**\u6bcf\u4e00\u4e2a\u533a\u95f4\u4e2d\u90fd\u5b58\u5728\u81f3\u5c11\u4e00\u4e2a $1$**\n\n\u8fd8\u662f\u8003\u8651 $dp$\uff0c\u8bb0 $dp_i$ \u4e3a\u5f53\u524d\u8003\u8651\u5230\u7b2c $i$ \u4f4d\uff0c\u4e14\u7b2c $i$ \u4f4d\u662f $1$ \u7684\u6982\u7387\u3002\n\n\u8003\u8651\u8f6c\u79fb\uff0c\u6211\u4eec\u679a\u4e3e\u4e0a\u4e00\u4e2a $1$ \u7684\u4f4d\u7f6e $j$\uff0c\u5c31\u6709 $dp_i=\\sum\\limits_{j=0}^{i-1}dp_j\\times p_0^{i-j-1}\\times p_1$\u3002\n\n\u4f46\u4e8b\u5b9e\u4e0a\u8fd9\u4e2a\u8f6c\u79fb\u65b9\u7a0b\u662f\u9519\u8bef\u7684\uff0c\u56e0\u4e3a\u5e76\u4e0d\u662f\u6240\u6709\u7684 $j$ \u90fd\u53ef\u4ee5\u8f6c\u79fb\uff0c\u6bd4\u65b9\u8bf4 $i=4,j=1,l_1=2,r_1=3$\uff0c\u90a3\u4e48 $[l_1,r_1]$ \u4e2d\u6240\u6709\u6570\u90fd\u662f $0$\uff0c\u4e0d\u7b26\u5408\u8981\u6c42\u3002\n\n\u90a3\u4e48\u95ee\u9898\u5c31\u6765\u4e86\uff0c\u7a76\u7adf\u4ec0\u4e48\u6837\u7684 $j$ \u624d\u80fd\u8f6c\u79fb\u5230 $i$ \u5462\uff1f\n\n\u663e\u7136 $j$ \u53ef\u4ee5\u8f6c\u79fb\u5230 $i$ \u5f53\u4e14\u4ec5\u5f53\u4e0d\u5b58\u5728 $i\\in[1,q]$ \u4f7f\u5f97 $[l_i,r_i]\\subseteq(j,i)$\uff0c\u5e76\u4e14\u6211\u4eec\u8fd8\u53ef\u4ee5\u53d1\u73b0\u4e00\u4ef6\u4e8b\uff0c\u90a3\u5c31\u662f\u5982\u679c $j$ \u53ef\u4ee5\u8f6c\u79fb\u5230 $i$\uff0c\u5e76\u4e14 $j<i-1$\uff0c\u90a3\u4e48 $j+1$ \u4e5f\u4e00\u5b9a\u53ef\u4ee5\uff0c\u6545\u5408\u6cd5\u7684\u51b3\u7b56\u70b9\u662f\u4e00\u4e2a\u53f3\u7aef\u70b9\u4e3a $i-1$ \u7684\u533a\u95f4\uff0c\u8bb0 $i$ \u5bf9\u5e94\u51b3\u7b56\u70b9\u533a\u95f4\u7684\u5de6\u7aef\u70b9\u4e3a $L_i$\uff0c\u90a3\u4e48\u4e0a\u8ff0\u65b9\u7a0b\u5f0f\u53ef\u6539\u5199\u4e3a $dp_i=\\sum\\limits_{j=L_i}^{i-1}dp_j\\times p_0^{i-j-1}\\times p_1$\u3002\n\n\u90a3\u4e48\u600e\u4e48\u6c42\u51fa $L_i$ \u5462\uff1f\u8bb0 $mx_R$ \u8868\u793a $\\max\\limits_{i=1}^ql_i(r_i=R)$\u3002\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u68c0\u9a8c\u662f\u5426\u5b58\u5728\u67d0\u4e2a $k\\in(j,i)$ \u4f7f\u5f97 $mx_k>j$ \u5373\u53ef\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u6ce8\u610f\u5230 $L_i>L_{i-1}$\uff0c\u4e5f\u5c31\u662f $L_i$ \u5355\u8c03\u9012\u589e\u3002\u6545\u53ef\u7528 two pointers+ST \u8868\u5728 $n\\log n$ \u9884\u5904\u7406\u3001$\\mathcal O(n)$ \u6c42\u89e3\u7684\u65f6\u95f4\u5185\u6c42\u51fa $L_i$\uff0c\u5177\u4f53\u6765\u8bf4\uff0cST \u8868\u7ef4\u62a4 $\\max\\limits_{i=l}^rmx_i$\uff0c\u7136\u540e\u68c0\u9a8c $\\max\\limits_{k=j+1}^{i-1}mx_k>j$ \u5373\u53ef\u3002\n\n\u6c42\u51fa $L_i$ \u4e4b\u540e\u8f6c\u79fb\u5c31\u53d8\u5f97\u5f02\u5e38\u5bb9\u6613\u4e86\u3002\u6211\u4eec\u53ef\u5c06\u8f6c\u79fb\u65b9\u7a0b\u5f0f\u8fdb\u4e00\u6b65\u6539\u5199\u4e3a $dp_i=\\sum\\limits_{j=L_i}^{i-1}\\dfrac{dp_j}{p_0^j}\\times p_0^{i-1}\\times p_1$\uff0c\u6ce8\u610f\u5230\u524d\u9762 $\\dfrac{dp_j}{p_0^j}$ \u53ea\u4e0e $j$ \u6709\u5173\uff0c\u540e\u9762 $p_0^{i-1}\\times p_1$ \u53ea\u4e0e $i$ \u6709\u5173\uff0c\u6545\u53ef\u4ee5\u7ef4\u62a4 $\\dfrac{dp_j}{p_0^j}$ \u7684\u524d\u7f00\u548c\uff0c\u8fd9\u6837\u5373\u53ef\u5b9e\u73b0 $\\mathcal O(1)$ \u8f6c\u79fb\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $n^2$\u3002\n\n~~\u7ec8\u4e8e\u628a\u81ea\u7206\u7684\u5fc3\u5934\u4e4b\u6068\u5316\u89e3\u6389\u4e86\uff0c\u723d~~\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define fi first\n#define se second\n#define fill0(a) memset(a,0,sizeof(a))\n#define fill1(a) memset(a,-1,sizeof(a))\n#define fillbig(a) memset(a,63,sizeof(a))\n#define pb push_back\n#define ppb pop_back\n#define mp make_pair\ntemplate<typename T1,typename T2> void chkmin(T1 &x,T2 y){if(x>y) x=y;}\ntemplate<typename T1,typename T2> void chkmax(T1 &x,T2 y){if(x<y) x=y;}\ntypedef pair<int,int> pii;\ntypedef long long ll;\ntypedef unsigned int u32;\ntypedef unsigned long long u64;\nnamespace fastio{\n\t#define FILE_SIZE 1<<23\n\tchar rbuf[FILE_SIZE],*p1=rbuf,*p2=rbuf,wbuf[FILE_SIZE],*p3=wbuf;\n\tinline char getc(){return p1==p2&&(p2=(p1=rbuf)+fread(rbuf,1,FILE_SIZE,stdin),p1==p2)?-1:*p1++;}\n\tinline void putc(char x){(*p3++=x);}\n\ttemplate<typename T> void read(T &x){\n\t\tx=0;char c=getchar();T neg=0;\n\t\twhile(!isdigit(c)) neg|=!(c^'-'),c=getchar();\n\t\twhile(isdigit(c)) x=(x<<3)+(x<<1)+(c^48),c=getchar();\n\t\tif(neg) x=(~x)+1;\n\t}\n\ttemplate<typename T> void recursive_print(T x){if(!x) return;recursive_print(x/10);putc(x%10^48);}\n\ttemplate<typename T> void print(T x){if(!x) putc('0');if(x<0) putc('-'),x=~x+1;recursive_print(x);}\n\tvoid print_final(){fwrite(wbuf,1,p3-wbuf,stdout);}\n}\nconst int MAXN=2e3;\nconst int LOG_N=11;\nconst int MOD=666623333;\nint n,m,q,inv,mx[MAXN+5],st[MAXN+5][LOG_N+2],pre[MAXN+5];\nint pw[MAXN+5],ipw[MAXN+5],dp[MAXN+5],sum[MAXN+5],ans[MAXN+5];\nint qpow(int x,int e){\n\tint ret=1;\n\tfor(;e;e>>=1,x=1ll*x*x%MOD) if(e&1) ret=1ll*ret*x%MOD;\n\treturn ret;\n}\nint query_mx(int l,int r){\n\tif(l>r) return 0;int k=31-__builtin_clz(r-l+1);\n\treturn max(st[l][k],st[r-(1<<k)+1][k]);\n}\nint solve(int x){\n\tint p0=1ll*(m-x)*inv%MOD,p1=1ll*x*inv%MOD,ip0=qpow(p0,MOD-2);\n\tpw[0]=1;for(int i=1;i<=n;i++) pw[i]=1ll*pw[i-1]*p0%MOD;\n\tipw[0]=1;for(int i=1;i<=n;i++) ipw[i]=1ll*ipw[i-1]*ip0%MOD;\n\tmemset(dp,0,sizeof(dp));memset(sum,0,sizeof(sum));\n\tdp[0]=sum[0]=1;\n\tfor(int i=1;i<=n;i++){\n\t\tdp[i]=1ll*(sum[i-1]-sum[pre[i]-1]+MOD)*pw[i-1]%MOD*p1%MOD;\n\t\tsum[i]=(sum[i-1]+1ll*dp[i]*ipw[i])%MOD;\n\t} int ret=0,mn=query_mx(1,n);\n\tfor(int i=mn;i<=n;i++) ret=(ret+1ll*dp[i]*pw[n-i])%MOD;\n\treturn ret;\n}\nint main(){\n\tscanf(\"%d%d%d\",&n,&m,&q);inv=qpow(m,MOD-2);\n\tfor(int i=1,l,r;i<=q;i++) scanf(\"%d%d\",&l,&r),chkmax(mx[r],l);\n\tfor(int i=1;i<=n;i++) st[i][0]=mx[i];\n\tfor(int i=1;i<=LOG_N;i++) for(int j=1;j+(1<<i)-1<=n;j++)\n\t\tst[j][i]=max(st[j][i-1],st[j+(1<<i-1)][i-1]);\n\tfor(int i=1,j=0;i<=n;i++){\n\t\twhile(j<i&&query_mx(j+1,i-1)>j) ++j;\n\t\tpre[i]=j;\n\t} int res=0;\n\tfor(int i=1;i<m;i++) ans[i]=solve(i);ans[m]=1;\n\tfor(int i=1;i<=m;i++) res=(res+1ll*(ans[i]-ans[i-1]+MOD)*i)%MOD;\n\tprintf(\"%d\\n\",res);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1615639988,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P3600\u3010\u968f\u673a\u6570\u751f\u6210\u5668\u3011"
    },
    {
        "content": "## $\\mathcal{Desciption}$\n\n[Link](https://www.luogu.com.cn/problem/P3600).\n\n\u7ed9\u5b9a\u4e00\u4e2a\u503c\u57df\u5728 $[1,x]$ \u7684\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217\uff08\u7531\u968f\u673a\u6570\u6784\u6210\uff09\uff0c\u6c42\u7ed9\u5b9a\u4e00\u7ec4\u533a\u95f4\u4e2d\u7684\u6700\u5c0f\u503c\u7684\u6700\u5927\u503c\u7684\u671f\u671b\u3002\n\n## $\\mathcal{Solution}$\n\n\u8bb0\uff1a\n$$\nw=\\max\\{\\min\\{a_{l_{j}},a_{l_{j}+1},\\cdots,a_{r_{j}}\\}|j\\in[1,q]\\}\n$$\n\u56e0\u4e3a\u6211\u4eec\u6700\u540e\u53d6\u7684\u662f $\\max$\uff0c\u4e0d\u80fd\u76f4\u63a5\u7528\u5168\u6982\u7387\u516c\u5f0f\uff0c\u8f6c\u5316\u4e00\u4e0b\uff1a\n$$\nE(w)=\\sum_{i=0}^{\\infty}P(w\\ge i)=\\sum_{i=0}^{\\infty}1-P(w<i)\n$$\n\u8fd9\u610f\u5473\u7740\u6bcf\u4e00\u4e2a\u88ab\u8be2\u95ee\u533a\u95f4\u4e2d\u7684\u6700\u5c0f\u503c\u90fd\u9700 $<i$\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u4e00\u4e2a\u533a\u95f4\u81f3\u5c11\u9700\u8981\u4e00\u4e2a $<i$ \u7684\u6570\u3002\n\n\u8fd9\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u533a\u95f4\u6765\u8bf4\u6982\u7387\u4e3a $\\frac{i-1}{x}$\u3002\u53c8\u56e0\u4e3a\u533a\u95f4\u53ef\u80fd\u51fa\u73b0\u76f8\u4ea4\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u7528\u70b9\u53bb\u88ab\u5305\u542b\u4e8e\u533a\u95f4\u3002\n\n\u5f53\u7136\uff0c\u4e00\u4e2a\u533a\u95f4\u5305\u542b\u53e6\u4e00\u4e2a\u533a\u95f4\uff0c\u8fd9\u4e2a\u533a\u95f4\u80af\u5b9a\u662f\u6ca1\u6709\u7528\u7684\u3002\u7136\u540e\u628a\u533a\u95f4\u6309\u5de6\u53f3\u7aef\u70b9\u5206\u522b\u4e3a\u7b2c\u4e00\u3001\u7b2c\u4e8c\u5173\u952e\u5b57\u6392\u5e8f\u3002\n\n\u679a\u4e3e $w$\uff0c\u8bbe $f_{i}$ \u8868\u793a\u533a\u95f4\u53f3\u7aef\u70b9\u5728 $i$ \u4e4b\u524d\u7684\u6240\u6709\u533a\u95f4\u6ee1\u8db3\u6761\u4ef6\u7684\u6982\u7387\u3002\n$$\nf_{i}=\\frac{w-1}{x}\\times\\sum_{j=0}^{i}f_{j}\\times(1-\\frac{w-1}{x})^{i-j-1}\n$$\n\n## $\\mathcal{Code}$\n\n```cpp\n#include <cstdio>\n\nusing i64 = long long;\n\nconst int MOD = 666623333;\nconst int MAXN = 2e3 + 5;\n\nint n, x, q, ar[MAXN];\ni64 f[MAXN][2], ff[MAXN][2];\n\nvoid imax ( int& a, const int b ) { a = a < b ? b : a; }\nint add ( const int a, const int b, const int p = MOD ) { return a + b < p ? a + b : ( a + b ) % p; }\nint sub ( const int a, const int b, const int p = MOD ) { return a - b < 0 ? a - b + p : a - b; }\nint mul ( const i64 a, const i64 b, const int p = MOD ) { return a * b % p; }\nint cpow ( int bas, int idx = MOD - 2 ) {\n\tint res = 1;\n\twhile ( idx ) {\n\t\tif ( idx & 1 )\tres = mul ( res, bas );\n\t\tbas = mul ( bas, bas ), idx >>= 1;\n\t}\n\treturn res % MOD;\n}\n\nint main () {\n\tscanf ( \"%d%d%d\", &n, &x, &q );\n\tfor ( int i = 1, tmpl, tmpr; i <= q; ++ i )\tscanf ( \"%d%d\", &tmpl, &tmpr ), imax ( ar[tmpr + 1], tmpl );\n\tfor ( int i = 1; i <= n + 1; ++ i )\timax ( ar[i], ar[i - 1] );\n\ti64 ix = cpow ( x ), ans = 0;\n\tfor ( int i = 1; i <= x; ++ i ) {\n\t\ti64 p = mul ( i - 1, ix ) % MOD, ip = cpow ( 1 - p ), s;\n\t\tff[0][0] = ff[0][1] = 1;\n\t\tfor ( int j = 1; j <= n; ++ j )\tff[j][0] = mul ( ff[j - 1][0], 1 - p ) % MOD, ff[j][1] = mul ( ff[j - 1][1], ip ) % MOD;\n\t\tf[0][0] = 0, f[0][1] = 1;\n\t\tfor ( int j = 1; j <= n; ++ j ) {\n\t\t\tf[j][0] = mul ( mul ( p, sub ( f[j - 1][1], ar[j] ? f[ar[j] - 1][1] : 0 ) ) % MOD, ff[j - 1][0] ) % MOD;\n\t\t\tf[j][1] = add ( mul ( f[j][0], ff[j][1] ) % MOD, f[j - 1][1] ) % MOD;\n\t\t}\n\t\ts = 0;\n\t\tfor ( int j = ar[n + 1]; j <= n; ++ j )\ts = add ( s, mul ( f[j][0], ff[n - j][0] ) % MOD ) % MOD;\n\t\tans = sub ( add ( ans, 1 ) % MOD, s );\n\t}\n\tprintf ( \"%lld\\n\", ans % MOD );\n\treturn 0;\n}\n```",
        "postTime": 1609502735,
        "uid": 161849,
        "name": "cirnovsky",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3600 \u3010\u968f\u673a\u6570\u751f\u6210\u5668\u3011"
    },
    {
        "content": "\u8bf4\u4e00\u4e0b\u6211\u9a9730\u5206\u7684\u65b9\u6cd5\u5427\u3002\n\n10\u5206\uff1ax^n\u679a\u4e3e\u6240\u6709\u72b6\u6001\uff0c\u4e4b\u540eO(q)\u68c0\u9a8c\u3002\u3002\n\n20\u5206\uff1a\u679a\u4e3e\u7b54\u6848\uff0c\u4e4b\u540e\u8ba1\u7b97\u65b9\u6848\u6570\u3002\u679a\u4e3e\u8fbe\u5230\u8be5\u7b54\u6848\u7684\u6570\u7684\u4e2a\u6570i\uff0c\u90a3\u4e48\u65b9\u6848\u6570=C(n,i)\\*x^(n-i)\u3002\n\nsigma(\u7b54\u6848\\*\u5bf9\u5e94\u65b9\u6848\u6570)\u9664\u4ee5\u603b\u65b9\u6848\u6570\u5c31\u662f\u671f\u671b\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define ll long long\n#define D 666623333\n#define N 2010\n\nint n,u,m;\nll mi(ll x,ll y)\n{\n    ll ans=1;\n    while (y)\n    {\n        if (y&1) (ans*=x)%=D;\n        y>>=1;(x*=x)%=D;\n    }\n    return ans;\n}\n\nll niv(ll x)\n{\n    return mi(x,D-2);\n}\n\nll i;\n\nint q[10],l[10],r[10];\nll ans;\nint get(int l,int r)\n{\n    int ans=q[l];\n    while ((++l)<=r) ans=min(ans,q[l]);\n    return ans;\n}\nvoid solve()\n{\n    int now=0;\n    for (i=1;i<=m;++i) now=max(now,get(l[i],r[i]));\n    ans+=now;\n}\nint tot;\nvoid dfs(int x)\n{\n    if (x>n) \n    {\n        ++tot;\n        solve();\n        return ;\n    }\n    int &i=q[x];\n    for (i=1;i<=u;++i)\n        dfs(x+1);\n}\n\nll jie[N],njie[N];\nvoid init_jie()\n{\n    jie[0]=1;\n    for (i=1;i<=2000;++i) jie[i]=jie[i-1]*i%D;\n    for (i=0;i<=2000;++i) njie[i]=niv(jie[i]);\n}\n\nll c(int y,int x)\n{\n    return jie[y]*njie[x]%D*njie[y-x]%D;\n}\n\nint main()\n{ //freopen(\"1.in\",\"r\",stdin);\n    scanf(\"%d%d%d\",&n,&u,&m);\n    init_jie();\n    if (m==1)\n    {\n        ll l,r;\n        scanf(\"%lld%lld\",&l,&r);n=r-l+1;\n        ll ans=0,low,i;\n        for (low=1;low<=u;++low)\n        for (i=1;i<=n;++i)  \n         (ans+= low*c(n,i)%D*mi(u-low,n-i)%D )%=D;\n        ans=ans*niv(mi(u,n))%D;\n        printf(\"%lld\",ans);    \n    }\n    else\n    { \n      for (i=1;i<=m;++i) scanf(\"%d%d\",l+i,r+i);\n      dfs(1);\n      printf(\"%lld\",ans*niv(tot)%D);\n    }\n}\n```",
        "postTime": 1485820595,
        "uid": 9168,
        "name": "kczno1",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3600 \u3010\u968f\u673a\u6570\u751f\u6210\u5668\u3011"
    }
]