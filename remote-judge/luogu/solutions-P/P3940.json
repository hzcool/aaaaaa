[
    {
        "content": "## Solution\n\u5bf9\u4e8e\u5b57\u5178\u5e8f\u6700\u5c0f , \u4ece\u540e\u5f80\u524d\u626b\u5373\u53ef\u6ee1\u8db3 .  \n\u5bf9\u4e8e\u67e5\u8be2\u51b2\u7a81 , \u901a\u8fc7\u679a\u4e3e\u5b8c\u5168\u5e73\u65b9\u6570\u89e3\u51b3 .  \n$K=1$ \u65f6 , \u51fa\u73b0\u51b2\u7a81\u65f6\u65b0\u5206\u4e00\u7ec4\u5373\u53ef .  \n$K=2$ \u65f6 , \u901a\u8fc7\u62d3\u5c55\u57df\u5e76\u67e5\u96c6\u6765\u5224\u65ad .  \n\u6211\u4eec\u628a\u4e00\u4e2a\u6570\u62c6\u6210\u4e24\u4e2a\u70b9 , \u5206\u522b\u4e3a\u9ed1\u70b9\u548c\u767d\u70b9 , \u5bf9\u4e8e\u51b2\u7a81\u7684\u70b9 , \u5c06\u5b83\u4eec\u7684\u9ed1\u767d\u70b9\u4e24\u4e24\u76f8\u8fde , \u6ce8\u610f\u7279\u5224 $2a_ i=x^2$ \u7684\u60c5\u51b5  \n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt a)$  \n## Code\n```cpp\n\n\n#include<iostream>\n#include<cstdio>\n#include<cmath>\n#include<unordered_map>\nusing namespace std;\nint read()\n{\n\tint ret=0;char c=getchar();\n\twhile(c>'9'||c<'0')c=getchar();\n\twhile(c>='0'&&c<='9')ret=(ret<<3)+(ret<<1)+(c^48),c=getchar();\n\treturn ret;\n}\nconst int maxn=131073; \nint n,k;\nint a[maxn],maxa;\nint pown[550],exi[maxn];\nbool s[maxn];int use=1;\nbool judge(int x){int rt=sqrt(x);return (rt*rt)==x;}\nstruct dsu\n{\n    int fa[maxn<<1];\n    void prework(){for(int i=1;i<2*maxn;i++)fa[i]=i;}\n    int get(int x)\n    {\n        if(x==fa[x])return fa[x];\n        return fa[x]=get(fa[x]);\n    }\n    void merge(int x,int y){fa[get(x)]=get(y);}\n}d;\nvoid end(int x)\n{\n    use++;s[x]=1;\n    int now=x+1;\n    while(!s[now]&&now<=n)\n    {\n        d.fa[a[now]]=a[now];\n        d.fa[a[now]+maxn]=a[now]+maxn;\n        exi[a[now++]]=0;\n    }\n    d.fa[a[now]]=a[now];\n    d.fa[a[now]+maxn]=a[now]+maxn;\n    exi[a[now]]=0;\n    d.fa[a[x]]=a[x];\n    d.fa[a[x]+maxn]=a[x]+maxn;\n    exi[a[x]]=1;\n}\nunordered_map<int,int>exi1;\nint main()\n{\n    n=read();k=read();\n    for(int i=1;i<=n;i++)maxa=max(maxa,a[i]=read());\n    d.prework();\n    maxa=ceil(sqrt(2*maxa));\n    for(int i=1;i<=maxa;i++)pown[i]=i*i;\n    if(k==1)\n    {\n        for(int i=n;i>=1;i--)\n        {\n            bool flag=0;\n            for(int j=1;j<=maxa;j++)\n            {\n                if(exi1.find(pown[j]-a[i])!=exi1.end()){flag=1;break;}\n            }\n            if(flag){use++;s[i]=1;exi1.clear();}        \n            exi1[a[i]]++;\n        }\n    }\n    else if(k==2)\n    {\n        for(int i=n;i>=1;i--)\n        {\n            if(judge(2*a[i])&&exi[a[i]])\n            {\n                if(exi[a[i]]==2)end(i);\n                else if(exi[a[i]]==1)\n                {                \n                    bool flag=0;\n                    for(int j=maxa;j>=1;j--)\n                    {\n                        if(pown[j]-a[i]==a[i])continue;\n                        if(pown[j]-a[i]<=0)break;\n                        if(pown[j]-a[i]>=maxn)continue;\n                        if(exi[pown[j]-a[i]]){flag=1;break;}\n                    }\n                    if(!flag)exi[a[i]]++;\n                    else end(i);\n                }\n               continue;\n            }\n            if(exi[a[i]]){exi[a[i]]++;continue;}\n            for(int j=maxa;j>=1;j--)\n            {\n                if(pown[j]-a[i]<=0)break;\n                if(pown[j]-a[i]>=maxn)continue;\n                if(exi[pown[j]-a[i]])\n                {\n                    d.merge(a[i],pown[j]-a[i]+maxn);\n                    d.merge(a[i]+maxn,pown[j]-a[i]);\n                    if(d.get(a[i])==d.get(a[i]+maxn))break;\n                }\n                if(exi[pown[j]-a[i]]==2&&judge(2*(pown[j]-a[i]))){d.merge(a[i],a[i]+maxn);break;}\n            }\n            if(d.get(a[i])==d.get(a[i]+maxn))end(i);\n            else exi[a[i]]++;\n        }\n    }\n    printf(\"%d\\n\",use);\n    for(int i=1;i<n;i++){if(s[i])printf(\"%d \",i);}\n    printf(\"\\n\");\n    return 0;\n}\n\n```\n",
        "postTime": 1624186727,
        "uid": 174469,
        "name": "zero4338",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3940 \u5206\u7ec4"
    },
    {
        "content": "> [\u63a8\u9500](https://www.cnblogs.com/Varuxn/p/14919311.html)\n\n# \u89e3\u9898\u601d\u8def\n\u53c2\u8003\u4e86\u9898\u89e3\u533a\u4e00\u7bc7\u601d\u8def\u975e\u5e38\u597d\u7684[\u9898\u89e3](https://www.luogu.com.cn/blog/_post/311461)\uff0c\u5728\u8fd9\u91cc\u8bb2\u4e00\u4e0b\u81ea\u5df1\u7684\u89c1\u89e3\u3002\n\n\u9996\u5148\u660e\u786e\u4e00\u4e0b K \u7684\u53d6\u503c\u53ea\u6709 1 \u6216\u8005 2 \u8fd9\u91cc\u770b**\u6570\u636e\u8303\u56f4**\u975e\u5e38\u91cd\u8981\uff01\uff0c\u5bf9\u4e8e $K=1$\uff0c$K=2$ \u7684\u60c5\u51b5\u8981\u5206\u5f00\u6765\u505a\u3002\n## K=1\n\u5bf9\u4e8e $K=1$ \u7684\u60c5\u51b5\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5b57\u5178\u5e8f\u6700\u5c0f\uff0c\u6211\u4eec\u9700\u8981\u5012\u7740\u679a\u4e3e\u5e8f\u5217\u4e86\u3002\n\n\u7136\u540e\u518d\u6b21\u89c2\u5bdf**\u6570\u636e\u8303\u56f4**\uff0c\u53d1\u73b0$131072 \\times2=512^2$\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e $1 \\sim 512$ \uff0c\u4ee4 vis[i] \u8868\u793a\u5728\u5f53\u524d\u626b\u5230\u7684\u7ec4\u91cc\u989c\u8272\u4e3a i \u7684\u662f\u5426\u5b58\u5728\uff0c\u67e5\u770b\u662f\u5426\u8bbf\u95ee\u8fc7 $x^2-s_i$ \u3002\n\n* \u5982\u679c\u8bbf\u95ee\u8fc7\uff0c\u8868\u793a\u548c\u7b2c i \u53ea\u5154\u5b50\u53d1\u751f\u77db\u76fe\u7684\u5df2\u7ecf\u5728\u8fd9\u4e2a\u7ec4\u91cc\u4e86\uff0c\u56e0\u6b64\u9700\u8981\u518d\u6b21\u5206\u4e00\u4e2a\u7ec4\uff0c\u5e76\u4e14\u8bb0\u5f55\u4e0b\u5206\u7ec4\u7684\u8fb9\u754c\uff0c\u6e05\u7a7a vis \u6570\u7ec4\u3002\n\n* \u5982\u679c\u6ca1\u6709\u8bbf\u95ee\u8fc7\uff0c\u628a\u8be5\u79cd\u989c\u8272\u7684\u6807\u8bb0\u6210 true \u8bb0\u5f55\u5c31\u597d\u4e86\u3002\n\n## K=2\n\u51e0\u4e4e\u540c\u6837\u7684\u601d\u8def\uff0c\u6211\u4eec\u4ecd\u7136\u9700\u8981\u5012\u7740\u679a\u4e3e\u5e8f\u5217\u3002\n\n\u5bf9\u4e8e\u540c\u4e00\u7ec4\u7684\u5154\u5b50\uff0c\u72b6\u6001\u4e4b\u53ef\u80fd\u6709\u4e24\u79cd\uff1a\u540c\u4e00\u5c0f\u56e2\u4f53\u6216\u8005\u5728\u654c\u5bf9\u5c0f\u56e2\u4f53\uff0c\u56e0\u6b64\u6211\u4eec\u7528**\u5e76\u67e5\u96c6**\u7ef4\u62a4\u3002\n\n* $\\operatorname{find}(1 \\sim n)$ \u8868\u793a $1\\sim n$\u7684\u5154\u5b50\u6240\u5728\u7684\u5c0f\u56e2\u4f53\u3002\n\n* $\\operatorname{find}(n+1 \\sim 2 \\times n)$ \u8868\u793a $1\\sim n$\u7684\u5154\u5b50\u6240\u5728\u7684\u5c0f\u56e2\u4f53\u7684\u654c\u5bf9\u5c0f\u56e2\u4f53\u3002\n\n\u7136\u540e\u5f00\u4e00\u4e2a vector \u6570\u7ec4\u8bb0\u5f55\u540c\u4e00\u989c\u8272\u7684\u5e8f\u53f7\uff0c\u7136\u540e\u5206\u522b\u5bf9\u4e8e\u53d1\u751f\u77db\u76fe\u7684\u5154\u5b50\u8fdb\u884c\u5224\u65ad\uff0c\u540c\u65f6\u66f4\u65b0\u8be5\u5154\u5b50\u6240\u5728\u7ec4\u4ee5\u53ca\u5c0f\u56e2\u4f53\u548c\u654c\u5bf9\u5c0f\u56e2\u4f53\u3002\n\n\u540c\u6837\u7684\uff0c\u5982\u679c\u77db\u76fe\u65e0\u6cd5\u907f\u514d\uff0c\u90a3\u5c31\u91cd\u65b0\u5f00\u4e00\u4e2a\u7ec4\uff0c\u5e76\u6e05\u7a7a\u6807\u8bb0\uff0c\u8bb0\u5f55\u5206\u5272\u70b9\u5c31\u597d\u4e86\u3002\n\n* \u6ce8\u610f\uff1a\u5e76\u67e5\u96c6\u5408\u5e76\u65f6\u8981\u5728 **find** \u7684\u57fa\u7840\u4e0a\u66f4\u65b0\n\n# code\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int M=131080;\nint n,m,K,las,s[M],fa[M<<1];\nvector<int> ans,v[M<<1];\nbool vis[M];\nint find(int x)\n{\n\tif(fa[x]==x)\n\t\treturn x;\n\treturn fa[x]=find(fa[x]);\n}\nvoid work_1()\n{\n\tfor(int i=n;i>=1;i--)\n\t{\n\t\tbool flag=true;\n\t\tfor(int j=1;j<=512;j++)\n\t\t\tif(j*j>=s[i])\n\t\t\t\tif(vis[j*j-s[i]])\n\t\t\t\t{\n\t\t\t\t\tflag=false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\tif(!flag)\n\t\t{\n\t\t\tfor(int j=i+1;j<las;j++)\n\t\t\t\tvis[s[j]]=false;\n\t\t\tans.push_back(i);\n\t\t\tlas=i+1;\n\t\t}\n\t\tvis[s[i]]=true;\n\t}\n\tprintf(\"%d\\n\",ans.size()+1);\n\tfor(int i=ans.size()-1;i>=0;i--)\n\t\tprintf(\"%d \",ans[i]);\n}\nint update(int l,int r)\n{\n\tfor(int i=l+1;i<r;i++)\n\t\tvector <int>().swap(v[s[i]]);\n\tans.push_back(l);\n\treturn l+1;\n}\nvoid work_2()\n{\n\tfor(int i=1;i<=(n<<1);i++)\n\t\tfa[i]=i;\n\tfor(int i=n;i>=1;i--)\n\t{\n\t\tfor(int j=1;j<=512;j++)\n\t\t\tif(j*j>=s[i])\n\t\t\t\tif(v[j*j-s[i]].size())\n\t\t\t\t\tfor(int k=0;k<v[j*j-s[i]].size();k++)\n\t\t\t\t\t{\n\t\t\t\t\t\tint temp=v[j*j-s[i]][k];\n\t\t\t\t\t\tif(find(temp)==find(i))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlas=update(i,las);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfa[find(i+n)]=find(temp);\n\t\t\t\t\t\t\tfa[find(temp+n)]=find(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\tv[s[i]].push_back(i);\n\t}\n\tprintf(\"%d\\n\",ans.size()+1);\n\tfor(int i=ans.size()-1;i>=0;i--)\n\t\tprintf(\"%d \",ans[i]);\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&K);\n\tlas=n+1;\n\tfor(int i=1;i<=n;i++)\n\t\tscanf(\"%d\",&s[i]);\n\tif(K==1)\n\t\twork_1();\n\telse\n\t\twork_2();\n\treturn 0;\n}\n```",
        "postTime": 1624352210,
        "uid": 190322,
        "name": "Varuxn",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3940 \u5206\u7ec4"
    },
    {
        "content": "\uff08\u8003\u8bd5\u7684\u65f6\u5019\u52e4\u52e4\u6073\u6073\u3010\u4e00\u8fb9\u6478\u9c7c\u4e00\u8fb9\u3011\u9a97\u5206\u3002\u9996\u5148\u662f\u5bf9\u4e8e\u76f4\u63a5\u8f93\u51fa1\u7684\u90a3\u4e00\u4e2a\u70b9\u4e0d\u52a0\u8d58\u8ff0\uff0c\u7136\u540e\u8003\u8651k=1\u5e76\u4e14\u7b54\u6848\u552f\u4e00\u7684\u70b9\u597d\u50cf\u626b\u4e00\u4e0b\u5c31\u80fd\u5f97\u5230\u7b54\u6848\u3002\u5bf9\u4e8ek=1\u6216k=2\uff0c\u5e76\u4e14ai<=2\u7684\u60c5\u51b5\u597d\u50cf\u8bb0\u5f55\u4e00\u4e0b2\u7684\u4e2a\u6570\u4e5f\u80fd\u9a97\u5230\u5206\u3002\n\n\u4e8e\u662f\u7801\u4e86\u4e00\u4e0b\uff0c\u6700\u540e\u9a97\u523024\u5206\u3002\uff09\n\n\u9898\u89e3\uff1a\n\n\u57fa\u672c\u4e0a\u662fstd\u7684\u601d\u8def\uff0c\u7ec6\u8282\u5904\u7406\u7a0d\u5fae\u6709\u70b9\u4e0d\u4e00\u6837\uff0c\u7136\u540e\u518d\u8be6\u7ec6\u8bf4\u4e00\u4e0b\u6b63\u89e3\u3002\n\n\u6b63\u89e3\u5206\u6210k=1\u548ck=2\u6765\u5206\u522b\u8003\u8651\u3002\u663e\u7136\u5bf9\u4e8e\u8fd9\u4e24\u79cd\u60c5\u51b5\uff0c\u6240\u7528\u7684\u505a\u6cd5\u662f\u4e0d\u4e00\u6837\u7684\u3002\n\n\u5bf9\u4e8ek=1\uff0c\u5206\u7ec4\u6240\u8981\u6ee1\u8db3\u7684\u6761\u4ef6\u662f\u4efb\u610f\u4e00\u7ec4\u4e2d\u5143\u7d20\u4e4b\u95f4\u6ca1\u6709\u4e92\u76f8\u51b2\u7a81\uff0c\u5373\u76f8\u52a0\u4e3a\u5e73\u65b9\u6570\u7684\u3002\u90a3\u4e48\u6bcf\u4e00\u6b21\u5206\u7ec4\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5f53\u524d\u5143\u7d20\u548c\u4e0a\u4e00\u4e2a\u5206\u7ec4\u70b9\u4e4b\u540e\u7684\u6240\u6709\u5143\u7d20\u662f\u5426\u4ea7\u751f\u51b2\u7a81\uff0c\u5982\u679c\u51b2\u7a81\u5c31\u8003\u8651\u8fdb\u884c\u5206\u7ec4\u3002\u90a3\u4e48\u663e\u7136\u626b\u4e00\u904d\u4e4b\u524d\u7684\u5143\u7d20\u5c31\u80fd\u5224\u65ad\u662f\u5426\u51b2\u7a81\u3002\n\n\u4f46\u662fn\u67091e5+\u7684\u7ea7\u522b\u2026\u6700\u574f\u7684\u53ef\u80fd\u6027\u8fd9\u4e00\u626b\u5c31\u8981\u7206\u70b8\u3002\u90a3\u4e48\u6709\u4ec0\u4e48\u5feb\u901f\u5224\u65ad\u5f53\u524d\u5143\u7d20\u662f\u5426\u5408\u6cd5\u7684\u65b9\u5f0f\u5417\uff1f\u53d1\u73b0\u5982\u679c\u6211\u4eec\u53ea\u7528\u8003\u8651\u5f53\u524d\u5143\u7d20\u662f\u5426\u5408\u6cd5\uff0c\u90a3\u4e48\u524d\u9762\u7684\u5143\u7d20\u5b8c\u5168\u53ef\u4ee5\u53ea\u8bb0\u5f55\u503c\u800c\u4e0d\u8bb0\u5f55\u4f4d\u7f6e\u3002\u5224\u65ad\u4e24\u4e2a\u6570\u76f8\u52a0\u662f\u5426\u4e3a\u4e00\u4e2a\u5e73\u65b9\u6570\uff0c\u53ef\u4ee5\u5faa\u73af\u6bcf\u4e2a\u6570\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u53ea\u8bb0\u5f55\u503c\u800c\u5faa\u73af\u5e73\u65b9\u6570\u3002\n\nai\u7684\u4e0a\u9650\u5176\u5b9e\u662f\u4e00\u4e2a\u63d0\u793a\u3002131072*2=262144=512\u00b2\u3002\u6211\u4eec\u53ea\u9700\u8981\u679a\u4e3e1-512\uff0c\u5224\u65ad\u679a\u4e3e\u5230\u7684\u6570\u7684\u5e73\u65b9\u51cf\u53bb\u5f53\u524d\u5143\u7d20\uff0c\u6240\u5f97\u5230\u7684\u503c\u662f\u5426\u51fa\u73b0\u8fc7\uff0c\u5c31\u53ef\u4ee5\u5224\u65ad\u662f\u5426\u5408\u6cd5\u3002\n\n\u4f46\u662f\u4e0a\u9762\u8fd9\u51e0\u53e5\u90fd\u5efa\u7acb\u5728\u6211\u4eec\u53ea\u7528\u8003\u8651\u5f53\u524d\u5143\u7d20\u662f\u5426\u5408\u6cd5\u8fd9\u4e00\u524d\u63d0\u4e0b\u3002\u5b9e\u9645\u4e0a\uff0c\u8fd8\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u9650\u5236\u2014\u2014\u5b57\u5178\u5e8f\u3002\u5982\u679c\u4ece\u524d\u5f80\u540e\u679a\u4e3e\uff0c\u6211\u4eec\u9700\u8981\u8bb0\u5f55\u4e0e\u5f53\u524d\u5143\u7d20\u51b2\u7a81\u7684\u503c\u7684\u4f4d\u7f6e\uff0c\u56e0\u4e3a\u628a\u8fd9\u4e2a\u4f4d\u7f6e\u4f5c\u4e3a\u5206\u7ec4\u70b9\u663e\u7136\u6bd4\u628a\u5f53\u524d\u5143\u7d20\u7684\u524d\u4e00\u4f4d\u4f5c\u4e3a\u5206\u7ec4\u70b9\u8981\u4f18\u3002\u4e3e\u4e2a\u6817\u5b50\uff0c\u5bf9\u4e8e\u5e8f\u52171,2,3\uff0c\u57281\u548c2\u4e4b\u95f4\u5206\u7ec4\u663e\u7136\u6bd4\u57282\u548c3\u4e4b\u95f4\u5206\u7ec4\u8981\u4f18\uff0c\u4f46\u662f\u8fd9\u4e24\u79cd\u5206\u7ec4\u90fd\u5408\u6cd5\u3002\n\n\u90a3\u4e48\u6211\u4eec\u80fd\u4e0d\u80fd\u8ba9\u5224\u65ad\u4ea7\u751f\u4e86\u51b2\u7a81\u7684\u4f4d\u7f6e\u6210\u4e3a\u7b54\u6848\u5462\u2014\u2014\u628a\u5e8f\u5217\u5012\u8fc7\u6765\u679a\u4e3e\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u5b98\u65b9\u9898\u89e3\u4e5f\u7ed9\u51fa\u4e86\u8bf4\u6cd5\uff0c\u5012\u8fc7\u6765\u679a\u4e3e\u7684\u51b2\u7a81\u70b9\uff0c\u4e5f\u5c31\u662f\u6b63\u5e8f\u4e2d\u53ef\u80fd\u7684\u6700\u9760\u524d\u7684\u5206\u754c\u70b9\u4f4d\u7f6e\uff0c\u4e00\u5b9a\u66f4\u4f18\u3002\u56e0\u4e3a\u5206\u754c\u70b9\u5982\u679c\u9760\u540e\uff0c\u4e0d\u4ec5\u5bf9\u4e8e\u8fd9\u4e2a\u5206\u7ec4\u64cd\u4f5c\u6765\u8bf4\u4e0d\u4f18\uff0c\u5e76\u4e14\u5bf9\u4e8e\u4e0a\u4e00\u4e2a\u7ec4\uff0c\u5b83\u7684\u6bb5\u957f\u53d8\u5927\uff0c\u6bb5\u5185\u4ea7\u751f\u51b2\u7a81\u7684\u53ef\u80fd\u6027\u53d8\u5927\uff0c\u5206\u7ec4\u53d8\u591a\u7684\u53ef\u80fd\u6027\u4e5f\u968f\u4e4b\u4e0a\u5347\u3002\n\n\u4e8e\u662f\u6700\u540ek=1\u7684\u505a\u6cd5\u5c31\u662f\uff0c\u5012\u8fc7\u6765\u679a\u4e3e\u5e8f\u5217\u5e76\u5224\u65ad\u5f53\u524d\u5143\u7d20\u662f\u5426\u4e0e\u4e4b\u524d\u4ea7\u751f\u51b2\u7a81\uff0c\u8bb0\u5f55\u51b2\u7a81\u70b9\u3002\u6ce8\u610f\u4e00\u4e2a\u4e00\u4e2a\u6e05\u7a7a\u8bb0\u5f55\u5b58\u5728\u8fc7\u7684\u503c\u7684vis\u6570\u7ec4\uff0c\u5982\u679c\u76f4\u63a5memset\u4f1a\u589e\u52a0\u4e0d\u5fc5\u8981\u7684\u590d\u6742\u5ea6\u3002\n\n\u5bf9\u4e8ek=2\u7684\u60c5\u51b5\uff0c\u601d\u8def\u5c31\u8981\u66f4\u4e3a\u590d\u6742\u4e00\u70b9\u3002\u9996\u5148\u7ee7\u627fk=1\u7684\u601d\u8def\u4e2d\u603b\u4f53\u4e0a\u7684\u5012\u53d9\u679a\u4e3e\u4ee5\u53ca\u679a\u4e3e\u5e73\u65b9\u6570\u7684\u601d\u8def\u3002\n\n\u5f88\u663e\u7136\u7684\u662f\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5206\u7ec4\u4e2d\u7684\u5143\u7d20\uff0c\u5982\u679c\u6839\u636e\u51b2\u7a81\u5173\u7cfb\u628a\u5b83\u4eec\u9ed1\u767d\u67d3\u8272\uff0c\u90a3\u4e48\u53ea\u8981\u5206\u7ec4\u4e2d\u7684\u5143\u7d20\u80fd\u7ec4\u6210\u4e00\u5f20\u4e8c\u5206\u56fe\uff0c\u8fd9\u4e2a\u5206\u7ec4\u5c31\u662f\u5408\u6cd5\u7684\u3002\u6839\u636e\u8fd9\u4e00\u70b9\uff0c\u679a\u4e3e\u5e8f\u5217\u7684\u65f6\u5019\u6bcf\u6b21\u66b4\u529b\u5224\u65ad\u4e8c\u5206\u56fe\u5176\u5b9e\u5c31\u662f\u4e00\u79cd\u9ad8\u5206\u505a\u6cd5\uff0c\u5e76\u4e14\u4f3c\u4e4e\u662f\u53ef\u4ee5\u901a\u8fc7\u5168\u90e8\u6570\u636e\u7684\u2026\n\n\u800c\u6b63\u5e38\u53bb\u8003\u8651\uff0c\u6bcf\u6b21\u90fd\u8dd1\u4e00\u6b21\u4e8c\u5206\u56fe\u7684\u590d\u6742\u5ea6\u663e\u7136\u8fc7\u9ad8\u3002\u6211\u4eec\u4f9d\u65e7\u9700\u8981\u80fd\u5feb\u901f\u5224\u65ad\u5f53\u524d\u5143\u7d20\u662f\u5426\u5408\u6cd5\u7684\u65b9\u6cd5\u3002\u53d1\u73b0\u5bf9\u4e8e\u4ea4\u9519\u590d\u6742\u7684\u654c\u5bf9\u5173\u7cfb\uff0c\u5373\u51b2\u7a81\uff0c\u6211\u4eec\u4f3c\u4e4e\u5728\u54ea\u91cc\u89c1\u5230\u8fc7\u3002\n\nP1525\u5173\u62bc\u7f6a\u72af\u3002\u8fd9\u9053\u9898\u91cc\u6211\u4eec\u7528\u5e76\u67e5\u96c6\u7684\u6269\u5c55\u57df\u6216\u8005\u5e26\u6743\u5e76\u67e5\u96c6\u7ef4\u62a4\u4e86\u4ea4\u7ec7\u7684\u654c\u5bf9\u5173\u7cfb\uff0c\u5e76\u6700\u540e\u5224\u65ad\u54ea\u4e00\u7ec4\u4e0d\u5f97\u4e0d\u4ea7\u751f\u51b2\u7a81\u3002\u8fd9\u4e0e\u8fd9\u9053\u9898\u73b0\u5728\u8003\u8651\u5230\u7684\u8fd9\u4e00\u90e8\u5206\u5f88\u76f8\u4f3c\u3002\n\n\u5176\u5b9e\u6ca1\u6709\u505a\u8fc7\u8fd9\u9053\u9898\u4e5f\u80fd\u8003\u8651\u5230\u5e76\u67e5\u96c6\uff0c\u6bd5\u7adf\u6211\u4eec\u8981\u7ef4\u62a4\u4e00\u5806\u51b2\u7a81\u5173\u7cfb\uff0c\u5e76\u4e14\u5224\u65ad\u4ec0\u4e48\u65f6\u5019\u4e0d\u80fd\u518d\u628a\u51b2\u7a81\u7684\u4e24\u4e2a\u6570\u5b57\u5206\u522b\u653e\u5728\u4e24\u7ec4\u4e2d\uff0c\u800c\u662f\u65e0\u8bba\u600e\u4e48\u653e\u90fd\u4f1a\u4ea7\u751f\u51b2\u7a81\u3002\n\n\u60f3\u5230\u8fd9\u91cc\uff0c\u5c1d\u8bd5\u7528\u5e76\u67e5\u96c6\u6765\u5904\u7406\u8fd9\u9053\u9898\u3002\u548c\u5173\u62bc\u7f6a\u72af\u4e00\u6837\u5f00\u4e00\u4e2a\u6269\u5c55\u57df\uff0c\u5e76\u67e5\u96c6\u4e2d1-maxx\u3010\u6700\u5927\u6570\u503c\u3011\u4e3a1-maxx\u672c\u8eab\u7684\u96c6\u5408\uff0c\u800cmaxx+1-maxx*2\u662f1-maxx\u7684\u654c\u4eba\u96c6\u5408\u3002\u626b\u5230\u4e00\u4e2a\u5143\u7d20\uff0c\u5e76\u5224\u65ad\u4e4b\u524d\u6709\u51b2\u7a81\u7684\u6570\u503c\u51fa\u73b0\u7684\u65f6\u5019\uff0c\u5c31\u67e5\u770b\u4e24\u8005\u5e76\u67e5\u96c6\u7ef4\u62a4\u7684\u4fe1\u606f\u3002\u5982\u679c\u4e24\u4e2a\u6570\u503c\u672c\u8eab\u4e0d\u5728\u4e00\u4e2a\u96c6\u5408\u91cc\uff0c\u90a3\u4e48\u5b83\u4eec\u5c31\u80fd\u88ab\u5206\u522b\u653e\u5728\u4e24\u7ec4\u4e2d\u3002\u7136\u540e\u7ef4\u62a4\u654c\u5bf9\u5173\u7cfb\uff0c\u8ba9\u4e24\u8005\u7684\u654c\u4eba\u57df\u5206\u522b\u548c\u5bf9\u65b9\u7684\u672c\u57df\u5408\u5e76\u5728\u4e00\u8d77\u3002\n\n\u4f46\u662f\u8fd8\u6709\u9700\u8981\u7279\u6b8a\u8003\u8651\u7684\u60c5\u51b5\uff01\u6211\u4eec\u5e76\u67e5\u96c6\u7ef4\u62a4\u7684\u662f\u6bcf\u4e00\u4e2a\u6570\u503c\u7684\u4fe1\u606f\uff0c\u800c\u5e8f\u5217\u4e2d\u5982\u679c\u51fa\u73b0\u4e86\u540c\u6837\u7684\u6570\u503c\uff0c\u4e0d\u53ef\u80fd\u518d\u628a\u4e00\u4e2a\u5e76\u67e5\u96c6\u5206\u88c2\u51fa\u53bb\u4e5f\u6ca1\u6cd5\u7ef4\u62a4\u4fe1\u606f\u3002\u4ed4\u7ec6\u60f3\u60f3\uff0c\u4e24\u4e2a\u76f8\u7b49\u7684\u6570\u503c\u53ea\u8981\u4e0d\u4f1a\u76f8\u52a0\u4ea7\u751f\u4e00\u4e2a\u5e73\u65b9\u6570\uff0c\u90a3\u4e48\u5b83\u4eec\u5c31\u53ef\u4ee5\u5206\u5728\u540c\u4e00\u7ec4\u4e2d\uff0c\u6beb\u65e0\u5f71\u54cd\u3002\u4e8e\u662f\u5bf9\u4e8e\u6709\u76f8\u540c\u5143\u7d20\u51fa\u73b0\u7684\u65f6\u5019\uff0c\u5224\u65ad\u5b83\u7684\u4e8c\u500d\u662f\u4e0d\u662f\u5e73\u65b9\u6570\uff0c\u5982\u679c\u662f\u7684\u8bdd\uff0c\u518d\u8003\u8651\u80fd\u4e0d\u80fd\u5206\u5728\u540c\u4e00\u7ec4\u3002\u4e24\u4e2a\u8fd9\u6837\u7684\u76f8\u540c\u5143\u7d20\u80fd\u5206\u5728\u540c\u4e00\u7ec4\u7684\u6761\u4ef6\u662f\uff0c\u5b83\u4eec\u51fa\u73b0\u4e14\u4ec5\u51fa\u73b0\u4e24\u6b21\uff0c\u6ca1\u6709\u5176\u5b83\u654c\u5bf9\u5143\u7d20\u3002\u5982\u679c\u6709\u5176\u5b83\u654c\u5bf9\u5143\u7d20\uff0c\u90a3\u4e48\u8fd9\u4e09\u4e2a\u5143\u7d20\u4e00\u5b9a\u4e0d\u80fd\u5b89\u5b9a\u5730\u5206\u6210\u4e24\u7ec4\u3002\u4e8e\u662f\u5bf9\u76f8\u540c\u5143\u7d20\u8fdb\u884c\u7279\u5224\u5904\u7406\u3002\n\n\u6700\u540e\u6e05\u7a7a\u7b49\u64cd\u4f5c\u548ck=1\u65f6\u662f\u5dee\u4e0d\u591a\u7684\u3002\n\n```cpp\n#include<iostream>\n#include<cstdio>\nusing namespace std;\nint n,k,maxx;\nint a[150010],vis[150010],flag,lst,tag[300010],fa[300010];\nint ans[150010],sum;\nint get(int x){\n\tif(fa[x]==x)return x;\n\telse return fa[x]=get(fa[x]);\n}\nvoid solve1(){\n\tfor(int i=n;i>=1;i--){\n\t\tflag=0;\n\t\tfor(int j=1;j<=512;j++){\n\t\t\tif(j*j<=a[i])continue;\n\t\t\tif(j*j-a[i]>maxx)break;\n\t\t\tif(vis[j*j-a[i]]){\n\t\t\t\tflag=1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif(flag){\n\t\t\tans[++sum]=i;\n\t\t\tfor(int j=i+1;j<=lst;j++){\n\t\t\t\tvis[a[j]]=0;\n\t\t\t}\n\t\t\tlst=i;\t\n\t\t}\n\t\tvis[a[i]]=1;\n\t}\n}\nvoid solve2(){\n\tfor(int i=1;i<=maxx;i++)fa[i]=i,fa[i+maxx]=i+maxx;\n\tfor(int i=1;i*i<=maxx*2;i++)tag[i*i]=1;\n\tfor(int i=n;i>=1;i--){\n\t\tflag=0;\n\t\tif(vis[a[i]]){\n\t\t\tif(tag[a[i]*2]){//\u540c\u6837\u7684\u6570\u5b57\u51fa\u73b0\u4e86\u4e24\u6b21\uff0c\u5e76\u4e14\u5b83\u7684\u4e8c\u500d\u662f\u5e73\u65b9\u6570 \n\t\t\t\tfor(int j=1;j<=512;j++){\n\t\t\t\t\tif(vis[a[i]]==2||fa[a[i]+maxx]!=a[i]+maxx){flag=1;break;}\n\t\t\t\t\t//\u8fd9\u91cc\u53ef\u4ee5\u7528\u5224\u65ad\u654c\u4eba\u57df\u7684\u4ee3\u8868\u5143\u7d20\u662f\u4e0d\u662f\u5b83\u672c\u8eab\u7684\u65b9\u6cd5\u6765\u5f97\u77e5\u6709\u6ca1\u6709\u654c\u5bf9\u5143\u7d20\uff0c\u662f\u56e0\u4e3a\u6211\u6bcf\u6b21\u5e76\u67e5\u96c6\u5408\u5e76\u90fd\u662f\u8ba9\u654c\u4eba\u57df\u5408\u5411\u672c\u57df \n\t\t\t\t\tif(j*j<a[i])continue;\n\t\t\t\t\tif(j*j-a[i]>maxx)break;\n\t\t\t\t\tif(vis[j*j-a[i]]&&j*j-a[i]!=a[i]){flag=1;break;}\n\t\t\t\t}\n\t\t\t\tif(flag){\n\t\t\t\t\tans[++sum]=i;\n\t\t\t\t\tfor(int j=i;j<=lst;j++){\n\t\t\t\t\t\tfa[a[j]]=a[j],fa[a[j]+maxx]=a[j]+maxx;\n\t\t\t\t\t\tvis[a[j]]=0;\n\t\t\t\t\t}\n\t\t\t\t\tlst=i;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tfor(int j=1;j<=512;j++){\n\t\t\t\tif(j*j<a[i])continue;\n\t\t\t\tif(j*j-a[i]>maxx)break;\n\t\t\t\tif(vis[j*j-a[i]]){\n\t\t\t\t\tif(tag[2*(j*j-a[i])]&&vis[j*j-a[i]]==2){\n\t\t\t\t\t\tflag=1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tint x1=get(a[i]),x2=get(a[i]+maxx),y1=get(j*j-a[i]),y2=get(j*j-a[i]+maxx);\n\t\t\t\t\tif(x1==y1){\n\t\t\t\t\t\tflag=1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\tfa[y2]=x1;\n\t\t\t\t\t\tfa[x2]=y1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(flag){\n\t\t\t\tans[++sum]=i;\n\t\t\t\tfor(int j=i;j<=lst;j++){\n\t\t\t\t\tfa[a[j]]=a[j],fa[a[j]+maxx]=a[j]+maxx;\n\t\t\t\t\tvis[a[j]]=0;\n\t\t\t\t}\n\t\t\t\tlst=i;\t\n\t\t\t}\n\t\t}\n\t\tvis[a[i]]++;\n\t}\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&k);\n\tlst=n;\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]),maxx=max(maxx,a[i]);\n\tif(k==1)solve1();\n\telse solve2();\n\tprintf(\"%d\\n\",sum+1);\n\tfor(int i=sum;i>=1;i--){\n\t\tprintf(\"%d \",ans[i]);\n\t}\n\treturn 0;\n}\n```\n\u8981\u6ce8\u610f\u7684\u5224\u65ad\u7ec6\u8282\u6709\u70b9\u591a\uff0c\u5728\u5404\u79cd\u7ec6\u8282\u4e0aWA\u4e86\u597d\u51e0\u6b21\uff0c\u5305\u62ec\u56e0\u4e3a\u6e05\u7a7a\u4e0d\u6b63\u786e\uff0c\u81ea\u4fe1\u5730\u8ba4\u4e3a\u62ff\u5230\u4e86\u524d\u56db\u5341\u5206\uff0c\u5176\u5b9e\u53ea\u62ff\u5230\u4e00\u534a\u2026\n\n\u601d\u8def\u4e0d\u662f\u5f88\u597d\u60f3\uff0c\u8fd9\u9898\u4e00\u4e0a\u6765\u7ed9\u7684\u4e1c\u897f\u5f88\u591a\uff0c\u5bf9\u4e8e\u6211\u8fd9\u79cd\u601d\u8def\u6df7\u4e71\u7684\u5bb9\u6613\u641e\u6210\u4e00\u56e2\u4e71\u9ebb\u3002\u5e94\u8be5\u6761\u7406\u5730\u89c2\u5bdf\u603b\u7ed3\u6027\u8d28\uff0c\u9010\u4e00\u601d\u8003\u83b7\u53d6\u6700\u540e\u7684\u601d\u8def\u3002\n\n\u6700\u540e\u5b89\u5229\u4e00\u4e0b\u81ea\u5df1\u7684\u535a\u5ba2\uff0c\u8fd9\u573a\u8003\u8bd5\u7684\u4e09\u9053\u9898\u3010\u6590\u6ce2\u90a3\u5951\uff0c\u6570\u989c\u8272\uff0c\u5206\u7ec4\u3011\u90fd\u53ef\u4ee5\u5728\u540c\u4e00\u7bc7\u627e\u5230\uff1ahttps://www.cnblogs.com/chloris/",
        "postTime": 1564838027,
        "uid": 114222,
        "name": "\u72db\u679d\u51ea\u6597",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3940 \u3010\u5206\u7ec4\u3011"
    },
    {
        "content": "\u524d\u8a00\uff1a\u770b\u4e86\u5404\u4f4d\u5de8\u4f6c\u7684\u9898\u89e3\uff0c\u601d\u8def\u5176\u5b9e\u90fd\u4e00\u6837\uff0c\u4f46\u662f\u5728\u4e0b\u89c9\u5f97\u81ea\u5df1\u7684\u5199\u6cd5\u66f4\u9002\u5408\u50cf\u6211\u4e00\u6837\u7684\u849f\u84bb\u4eec\u7406\u89e3\u548c\u5b9e\u73b0\u4e00\u4e9b\uff0c\u6ca1\u6709\u9700\u8981\u7279\u5224\u7684\u60c5\u51b5\uff0c\u53ef\u5199\u6027\u8f83\u5f3a\u3002\n\n\n------------\n\n### \u9898\u76ee\u5206\u6790\n\n\u672c\u9898\u660e\u663e\u8981\u5206 K=1 \u548c K=2 \u4e24\u79cd\u60c5\u51b5\u8ba8\u8bba\u3002\u6574\u4f53\u7b97\u6cd5\u601d\u60f3\u662f\u8d2a\u5fc3\uff1a\u5c3d\u53ef\u80fd\u4f7f\u5f97\u80fd\u653e\u5728\u540c\u4e00\u7ec4\u7684\u4e24\u53ea\u5154\u5b50\u5206\u5728\u540c\u4e00\u7ec4\uff0c\u4fbf\u5c06\u4f7f\u5f97\u603b\u5206\u7ec4\u6700\u5c11\u3002\u8fd9\u4e2a\u7ed3\u8bba\u662f\u663e\u7136\u7684\uff0c\u8bc1\u660e\u7565\u3002\n\n\u5bf9\u4e8e K=1 \u7684\u60c5\u51b5\uff0c\u5916\u5faa\u73af\u679a\u4e3e\u6bcf\u4e00\u53ea\u5154\u5b50\u7684\u989c\u8272\u503c $a_i$\uff0c\u5185\u5faa\u73af\u8bbe x \u4ece1\u679a\u4e3e\u5230512\uff08=$\\sqrt{131072\u00d72}$\uff09\uff0c\u770b\u770b\u6709\u6ca1\u6709\u8bbf\u95ee\u8fc7 $(x^2-a_i)$ \u8fd9\u4e2a\u503c\u3002\u5982\u679c\u8bbf\u95ee\u8fc7\uff0c\u5219\u7b2ci\u53ea\u5154\u5b50\u4e0e\u5f53\u524d\u7ec4\u5185\u5176\u5b83\u5154\u5b50\u6709\u51b2\u7a81\uff0c\u9700\u8981\u6e05\u7a7a\u8bbf\u95ee\u6807\u8bb0\u5e76\u4e14\u5355\u72ec\u65b0\u5efa\u4e00\u4e2a\u5206\u7ec4\uff1b\u5982\u679c\u6ca1\u8bbf\u95ee\u8fc7\uff0c\u5219\u4ee4\u7b2ci\u53ea\u5154\u5b50\u52a0\u5165\u5f53\u524d\u5206\u7ec4\u3002\u6700\u540e\u518d\u6253\u4e0a\u8bbf\u95ee\u6807\u8bb0\u5373\u53ef\u3002\n\n\u5bf9\u4e8e K=2 \u7684\u60c5\u51b5\uff0c\u6574\u4f53\u601d\u8def\u548cK=1\u5dee\u4e0d\u591a\uff0c\u4f46\u662f\u6b64\u65f6\u9700\u8981\u4f7f\u7528\u5230\u5e76\u67e5\u96c6\u3002\u4e0eK=1\u7684\u60c5\u51b5\u7684\u4e0d\u540c\u70b9\u5728\u4e8e\uff0c\u5982\u679c\u8bbf\u95ee\u8fc7 $(x^2-a_i)$ \uff0c\u6211\u4eec\u4ecd\u7136\u53ef\u4ee5\u8bd5\u56fe\u5c06$a_i$\u52a0\u5165\u5f53\u524d\u5206\u7ec4\uff0c\u56e0\u4e3a\u6b64\u65f6\u6211\u4eec\u7684\u5206\u7ec4\u91cc\u5141\u8bb8\u6709\u4e24\u4e2a\u5c0f\u56e2\u4f53\u3002\u6211\u4eec\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528\u5e76\u67e5\u96c6\u6765\u7ef4\u62a4\u654c\u5bf9\u5173\u7cfb\uff1a**fa[] \u6570\u7ec4\u5f002\u500d\u7a7a\u95f4\uff0c find(1~n) \u4ee3\u8868\u6bcf\u53ea\u5154\u5b50\u6240\u5728\u5c0f\u56e2\u4f53\uff0c find(n+1~2n) \u4ee3\u8868\u6bcf\u53ea\u7684\u5154\u5b50\u6240\u5728\u5c0f\u56e2\u4f53\u7684\u654c\u5bf9\u5c0f\u56e2\u4f53\u3002**\n\n\u5728\u4e0a\u8ff0\u60c5\u51b5\u4e0b\u5f53\u8bbf\u95ee\u8fc7 $(x^2-a_i)$ \u65f6\uff0c\u6211\u4eec\u5148\u5224\u65ad\u4e0b\u989c\u8272\u503c\u4e3a $(x^2-a_i)$ \u7684\u5154\u5b50\uff08\u4eec\uff09**\uff08\u6ce8\u610f\uff01\u6b64\u65f6\u53ef\u80fd\u4e0d\u6b62\u4e00\u53ea\uff01\u4ee5\u4e0a\u51e0\u7bc7\u9898\u89e3\u90fd\u662f\u7528\u7279\u5224\u7684\u65b9\u6cd5\u5904\u7406\u7684\u91cd\u590d\u95ee\u9898\uff0c\u672c\u849f\u84bb\u4e0d\u4f1a\uff0c\u6240\u4ee5\u63a8\u8350\u5f00\u52a8\u6001\u6570\u7ec4 vector \u5b58\u4e0b\u6bcf\u4e00\u53ea\u5f53\u524d\u5206\u7ec4\u5185\u76f8\u540c\u989c\u8272\u7684\u5154\u5b50\u7f16\u53f7\u3002\uff09** \u548c\u7b2c i \u53ea\u5154\u5b50\u662f\u5426\u5df2\u7ecf\u88ab\u89c4\u5212\u8fdb\u5165\u540c\u4e00\u5c0f\u56e2\u4f53\u4e2d\u3002\u5982\u679c\u5df2\u7ecf\u88ab\u89c4\u5212\u5165\u540c\u4e00\u5c0f\u56e2\u4f53\uff0c\u90a3\u4e48\u4fbf\u4e0d\u5f97\u4e0d\u6e05\u7a7a\u8bbf\u95ee\u5e76\u65b0\u5efa\u5206\u7ec4\u3002\u5426\u5219\uff0c\u5c06\u7b2c i \u53ea\u5154\u5b50\u4e0e\u989c\u8272\u503c\u4e3a $(x^2-a_i)$ \u7684\u5154\u5b50\uff08\u4eec\uff09\u5206\u522b\u4e92\u76f8\u52a0\u5165\u5bf9\u65b9\u7684\u654c\u5bf9\u96c6\u5408\u5373\u53ef\u3002\n\nPS\uff1a\u7531\u4e8e\u9700\u8981\u5b57\u5178\u5e8f\u6700\u5c0f\uff0c\u6211\u4eec\u9700\u8981\u5012\u5e8f\u626b\u63cf a \u6570\u7ec4\u3002\n\n\n------------\n\n### \u4ee3\u7801\n\n```\n#include<cstdio>\n#include<cctype>\n#include<stack>\n#include<vector>\nusing namespace std;\ninline long long input(){\n    long long a=0,f=1;\n    char tmp=getchar();\n    while(!isdigit(tmp)){if(tmp=='-')f=-1;tmp=getchar();}\n    while(isdigit(tmp)){a=(a<<3)+(a<<1)+(tmp^48);tmp=getchar();}\n    return a*f;\n}\nint n,K,a[131073],fa[300001],times[300001],last;\nstd::vector<int>vis[300001];\nstd::stack<int>ans;\nint find(int x){\n\tif(fa[x]&&fa[x]^x)return fa[x]=find(fa[x]);\n\treturn fa[x]=x;\n}\nvoid read(){\n\tn=input(),K=input();\n\tfor(int i=1;i<=n;i++)\n\t\ta[i]=input();\n}\nvoid clear(int &last,int i){//\u4e00\u5b9a\u4e0d\u8981\u76f4\u63a5\u628avis[1~300000]\u5168\u90e8\u6e05\u7a7a\uff0c\u8fd9\u6837\u4f1a\u5927\u5927\u589e\u52a0\u65f6\u95f4\u590d\u6742\u5ea6\u5bfc\u81f4TLE\u3002\n\tfor(int j=last-1;j>i;j--)\n\t\tvis[a[j]].clear();\n\tlast=i+1;\n\tans.push(last-1);\n}\nvoid solve1(){\n\tfor(int i=n;i;i--){\n\t\tbool ok=1;\n\t\tfor(int x=1;x<=512;x++)\n\t\t\tif(x*x-a[i]>=0&&vis[x*x-a[i]].size()){\n\t\t\t\tok=0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\tif(!ok)clear(last,i);\n\t\tvis[a[i]].push_back(1);\n\t}\n}\nvoid solve2(){\n\tfor(int i=n;i;i--){\n\t\tfor(int x=1;x<=512;x++)\n\t\t\tif(x*x-a[i]>=0&&vis[x*x-a[i]].size())\n\t\t\t\tfor(int j=0;j<vis[x*x-a[i]].size();j++){\n\t\t\t\t\tint f=vis[x*x-a[i]][j];\n\t\t\t\t\tif(find(i)==find(f))clear(last,i);\n\t\t\t\t\telse{\n\t\t\t\t\t\tfa[find(i+n)]=find(f);\n\t\t\t\t\t\tfa[find(f+n)]=find(i);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\tvis[a[i]].push_back(i);\n\t}\n}\nvoid print(){\n\tprintf(\"%d\\n\",ans.size()+1);\n\twhile(ans.size())printf(\"%d \",ans.top()),ans.pop();\n\tputchar('\\n');\n}\nint main(){\n\tread();\n\tlast=n+1;\n\tif(K==1)solve1();\n\telse solve2();\n\tprint();\n\treturn 0;\n}\n```",
        "postTime": 1612771627,
        "uid": 103333,
        "name": "Undefined_R",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3940 \u3010\u5206\u7ec4\u3011"
    },
    {
        "content": "\u8fd9\u91cc\u63d0\u4f9b\u7684\u662f std\u3002\n\n\n\u5982\u679c\u9700\u8981\u9898\u89e3\uff0c\u8bf7\u53c2\u8003 [ppt](https://www.luogu.org/discuss/show?postid=26414)\uff0c\u6216\u8005\u5176\u4ed6\u540c\u5b66\u7684\u9898\u89e3\u3002\n\n\nstd \u5df2\u7ecf\u5728\u7b2c 73 \u884c\u7ffb\u4e86\u4e24\u6b21\u8f66\u4e86 QAQ \u5927\u5bb6\u4e00\u5b9a\u8981\u5c0f\u5fc3\u4ed4\u7ec6\u5440\u3002\n\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef long long LL;\n\n#define N 131073\n\nint n, m = 0, K;\nint a[N], b[N];\nbool vis[N], dvis[N], issqr[N * 2];\nint f[N * 2];\n\nint getf(int x) {return f[x] > 0 ? (f[x] = getf(f[x])) : x;}\n\nvoid merge(int u, int v) {\n    u = getf(u), v = getf(v);\n    if (u != v) {\n        if (f[u] > f[v]) swap(u, v);\n\n        f[u] += f[v];\n        f[v] = u;\n\n    }\n}\n\nbool check(int u, int v) {\n    int s1 = getf(u), s2 = getf(u + N);\n    int t1 = getf(v), t2 = getf(v + N);\n    if (s1 == t1) return 1;\n    if (s2 == t2) return 1;\n    merge(s1, t2); merge(s2, t1);\n    return 0;\n}\n\nvoid solve_1() {\n    for (int i = n, j = n; i;) {\n        for (bool flag = 1; j; j--) {\n            for (int k = 1; k * k - a[j] < N; k++) {\n                if (k * k - a[j] <= 0) continue;\n                if (vis[k * k - a[j]]) {flag = 0; break;} \n            }\n            if (!flag) break;\n            vis[a[j]] = 1;\n        }\n        if (!j) break;\n        b[++m] = j;\n        for ( ; i > j; i--) vis[a[i]] = 0;\n    }\n}\n\nvoid solve_2() {\n    memset(f, -1, sizeof f);\n    for (int i = 1; i * i < 2 * N; i++) issqr[i * i] = 1;\n    for (int i = n, j = n; i;) {\n        for (bool flag = 1; j; j--) {\n            if (vis[a[j]]) {\n                if (issqr[a[j] + a[j]]) {\n                    if (dvis[a[j]]) break;\n                    for (int k = 1;k * k - a[j] < N; k++) {\n                        if (k * k - a[j]<0) continue;\n                        if (vis[k * k - a[j]] && k * k != a[j] * 2) {\n                            flag = 0; break;\n                        } \n                    }\n                    if (!flag) break;\n                    dvis[a[j]] = 1;\n                }\n            }\n            else {\n                for (int k = 1; k * k - a[j] < N; k++) {\n                    if (k * k - a[j] <= 0) continue;\n                    if (vis[k * k - a[j]]) {\n                        if (check(k * k - a[j], a[j]) || dvis[a[j]] || dvis[k * k - a[j]]) {flag = 0; f[a[j]] = f[a[j] + N] = -1; break;}\n                    } \n                }\n                if (!flag) break;\n                vis[a[j]] = 1;\n            }\n        }\n        if (!j) break;\n        b[++m] = j;\n        for ( ; i > j; i--) f[a[i]] = f[a[i] + N] = -1, vis[a[i]] = 0, dvis[a[i]] = 0;\n    }\n}\n\nint main() {\n    scanf(\"%d%d\", &n, &K);\n    for (int i = 1; i <= n; i++) scanf(\"%d\", a + i);\n    if (K == 1) solve_1();\n    else solve_2();\n    printf(\"%d\\n\", m + 1);\n    for (int i = m; i; i--) printf(\"%d \", b[i]);\n    putchar('\\n');\n    return 0;\n}\n```",
        "postTime": 1510056729,
        "uid": 12621,
        "name": "fstqwq",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 P3940 \u3010\u5206\u7ec4\u3011"
    },
    {
        "content": "\u770b\u5230\u53ea\u6709\u7ba1\u7406\u5458\u6709\u9898\u89e3\uff0c\u4e0d\u723d\n\n\u4eca\u5929\u5728\u535a\u5ba2\u56ed\u91cc\u6253\u4e86\u4e00\u5929\uff0c\u57fa\u672c\u4e0a\u628a\u6240\u6709\u90e8\u5206\u5206\u7684\u89e3\u6cd5\u90fd\u5199\u4e86\u4e00\u904d\uff0c\u63a8\u4e00\u4e0b\u535a\u5ba2\uff1ahttps://www.cnblogs.com/wzc521/p/11297146.html\n\n\u5728\u8fd9\u91cc\u6211\u5c31\u53ea\u8d34\u4e00\u4e2aAC\u4ee3\u7801\u5427\uff5e\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nint n,K;\nint a[150000],maxn;\nbool vis[150000],sit[150000];\nint que[150000],sum;\nint fa[300000];\nvoid solve1()\n{\n    for(int i=n,j=n;i;)\n    {\n        for(;j;j--)\n        {\n            for(int k=1;k*k-a[j]<=maxn;k++)\n            {\n                if(k*k-a[j]<=0)continue;\n                if(vis[k*k-a[j]])goto nxt;\n            }\n            vis[a[j]]=1;\n        }\n        nxt:\n        if(!j)break;\n        que[++sum]=j;\n        for(;i>j;i--)vis[a[i]]=0;\n    }  \n}\nint find(int x){return fa[x]<=0?x:fa[x]=find(fa[x]);}\nvoid connect(int x,int y)\n{\n    x=find(x);\n    y=find(y);\n    if(x!=y)\n    {\n        if(fa[x]>fa[y]){fa[y]+=fa[x];fa[x]=y;}\n        else {fa[x]+=fa[y];fa[y]=x;}\n    }\n}\nbool judge(int x, int y)\n{\n    int flag1=find(x),flag2=find(x+140000),flag3=find(y),flag4=find(y+140000);\n    if(flag1==flag3)return 1;\n    if(flag2==flag4)return 1;\n    connect(flag1,flag4);\n    connect(flag2,flag3);\n    return 0;\n}\nvoid solve2()\n{\n    for(int i=n,j=n;i;)\n    {\n        for(;j;j--)\n        {\n            if(vis[a[j]])\n            {\n                if((int)sqrt(a[j]<<1)*(int)sqrt(a[j]<<1)==a[j]<<1)\n                {\n                    if(sit[a[j]])break;\n                    for(int k=1;k*k-a[j]<=maxn;k++)\n                    {\n                        if(k*k-a[j]<0)continue;\n                        if(vis[k*k-a[j]]&&k*k!=a[j]<<1)goto nxt;\n                    }\n                    sit[a[j]]=1;\n                }\n            }\n            else\n            {\n                for(int k=1;k*k-a[j]<=maxn;k++)\n                {\n                    if(k*k-a[j]<=0)continue;\n                    if(vis[k*k-a[j]]&&(judge(k*k-a[j],a[j])||sit[a[j]]||sit[k*k-a[j]])){fa[a[j]]=fa[a[j]+140000]=0;goto nxt;}\n                }\n                vis[a[j]]=1;\n            }\n        }\n        nxt:\n        if(!j)break;\n        que[++sum]=j;\n        for(;i>j;i--)fa[a[i]]=fa[a[i]+140000]=vis[a[i]]=sit[a[i]]=0;\n    }\n}      \nint main()\n{\n    scanf(\"%d%d\",&n,&K);\n    for(int i=1;i<=n;i++){scanf(\"%d\",&a[i]);maxn=max(maxn,a[i]);}\n    if(K==1)solve1();\n    else solve2();\n    printf(\"%d\\n\",sum+1);\n    for(int i=sum;i;i--)printf(\"%d \",que[i]);\n    return 0;\n}\n```\nrp++",
        "postTime": 1564917793,
        "uid": 93488,
        "name": "Porsche",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P3940 \u3010\u5206\u7ec4\u3011"
    },
    {
        "content": "## \u5206\u6790\n\u4e3a\u4e86\u4fdd\u8bc1\u5b57\u5178\u5e8f\u6700\u5c0f\uff0c\u6211\u4eec\u9700\u8981\u5012\u5e8f\u679a\u4e3e\n\n\u5bf9\u4e8e $K=1$ \u7684\u60c5\u51b5\uff0c\u5982\u679c\u6211\u4eec\u5f53\u524d\u626b\u5230\u7684\u503c\u4e0e\u4e4b\u524d\u7684\u67d0\u4e2a\u503c\u4e4b\u548c\u6070\u597d\u662f\u5e73\u65b9\u6570\uff0c\u90a3\u4e48\u5c31\u8981\u518d\u5f00\u4e00\u4e2a\u7ec4\n\n\u5bf9\u4e8e $k=2$ \u7684\u60c5\u51b5\uff0c\u6211\u4eec\u628a\u4e0d\u5408\u6cd5\u7684\u6743\u503c\u4e24\u4e24\u8fde\u8fb9\n\n\u90a3\u4e48\u51fa\u73b0\u51b2\u7a81\u7684\u60c5\u51b5\u5c31\u662f\u6574\u5f20\u56fe\u4e0d\u662f\u4e8c\u5206\u56fe\uff0c\u4e5f\u5c31\u662f\u8bf4\u51fa\u73b0\u4e86\u5947\u73af\n\n\u8fd9\u4e2a\u6211\u4eec\u7528\u5e26\u6743\u5e76\u67e5\u96c6\u968f\u4fbf\u5224\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\n\n\u56e0\u4e3a\u6211\u4eec\u8981\u5bf9\u4e8e\u6743\u503c\u5f00\u5e76\u67e5\u96c6\uff0c\u6240\u4ee5\u8981\u6ce8\u610f\u51e0\u79cd\u4e0d\u5408\u6cd5\u60c5\u51b5\u7684\u7279\u5224\n\n1\u3001\u5f53\u524d\u7684\u503c\u51fa\u73b0\u7684\u6b21\u6570\u5927\u4e8e\u7b49\u4e8e $3$\uff0c\u5e76\u4e14\u5f53\u524d\u503c\u4e58 $2$ \u540e\u4e3a\u5e73\u65b9\u6570\n\n2\u3001\u5f53\u524d\u503c\u4e0e\u4e4b\u524d\u67d0\u4e2a\u503c\u51b2\u7a81\uff0c\u5e76\u4e14\u8fd9\u4e24\u4e2a\u503c\u4e2d\u6709\u4e00\u4e2a\u51fa\u73b0\u6b21\u6570\u5927\u4e8e\u7b49\u4e8e $2$\n\n## \u4ee3\u7801\n``` cpp\n#include<cstdio>\n#include<cmath>\n#include<iostream>\n#include<algorithm>\n#include<map>\n#include<vector>\n#define rg register\ninline int read(){\n\trg int x=0,fh=1;\n\trg char ch=getchar();\n\twhile(ch<'0' || ch>'9'){\n\t\tif(ch=='-') fh=-1;\n\t\tch=getchar();\n\t}\n\twhile(ch>='0' && ch<='9'){\n\t\tx=(x<<1)+(x<<3)+(ch^48);\n\t\tch=getchar();\n\t}\n\treturn x*fh;\n}\nconst int maxn=4e6+5,maxk=513;\nint n,k,a[maxn],sta[maxn],tp,fa[maxn],dis[maxn],mmax;\nint mp[maxn];\nint zhao(int xx){\n\tif(xx==fa[xx]) return xx;\n\trg int now=fa[xx];\n\tfa[xx]=zhao(fa[xx]);\n\tdis[xx]+=dis[now];\n\treturn fa[xx];\n}\nvoid bing(int xx,int yy){\n\trg int aa=zhao(xx),bb=zhao(yy);\n\tfa[bb]=aa;\n\tdis[bb]=dis[xx]-dis[yy]-1;\n}\nint main(){\n\tn=read(),k=read();\n\tif(k==1){\n\t\tfor(rg int i=1;i<=n;i++){\n\t\t\ta[i]=read();\n\t\t}\n\t\trg int now;\n\t\trg bool jud=0;\n\t\tfor(rg int i=n;i>=1;i--){\n\t\t\tnow=std::sqrt(a[i]);\n\t\t\tfor(int j=now;j<=maxk;j++){\n\t\t\t\tif(j*j<a[i]) continue;\n\t\t\t\tif(mp[j*j-a[i]]){\n\t\t\t\t\tjud=1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(jud){\n\t\t\t\tsta[++tp]=i;\n\t\t\t\tif(tp==1){\n\t\t\t\t\tfor(rg int j=i+1;j<=n;j++){\n\t\t\t\t\t\tmp[a[j]]=0;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor(rg int j=i+1;j<=sta[tp-1];j++){\n\t\t\t\t\t\tmp[a[j]]=0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tjud=0;\n\t\t\t}\n\t\t\tmp[a[i]]++;\n\t\t}\n\t\tprintf(\"%d\\n\",tp+1);\n\t\tfor(rg int i=tp;i>=1;i--){\n\t\t\tprintf(\"%d \",sta[i]);\n\t\t}\n\t\tprintf(\"\\n\");\n\t} else {\n\t\tfor(rg int i=1;i<=n;i++){\n\t\t\ta[i]=read();\n\t\t\tmmax=std::max(mmax,a[i]);\n\t\t}\n\t\tfor(rg int i=1;i<=mmax;i++){\n\t\t\tfa[i]=i;\n\t\t}\n\t\trg int now;\n\t\trg bool jud=0;\n\t\tfor(rg int i=n;i>=1;i--){\n\t\t\tnow=std::sqrt(a[i]);\n\t\t\tif(mp[a[i]]>=2 && a[i]+a[i]==(int)sqrt(a[i]+a[i])*(int)sqrt(a[i]+a[i])){\n\t\t\t\tjud=1;\n\t\t\t}\n\t\t\tfor(rg int j=now;j<=maxk;j++){\n\t\t\t\tif(jud) break;\n\t\t\t\tif(j*j==a[i]+a[i] || j*j<a[i] || j*j-a[i]>mmax) continue;\n\t\t\t\tif(mp[j*j-a[i]] && mp[a[i]] && a[i]+a[i]==(int)sqrt(a[i]+a[i])*(int)sqrt(a[i]+a[i])){\n\t\t\t\t\tjud=1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif(mp[j*j-a[i]]>=2 && j*j-a[i]+j*j-a[i]==(int)sqrt(j*j-a[i]+j*j-a[i])*(int)sqrt(j*j-a[i]+j*j-a[i])){\n\t\t\t\t\tjud=1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif(mp[j*j-a[i]]){\n\t\t\t\t\tif(zhao(a[i])==zhao(j*j-a[i]) && (dis[a[i]]+dis[j*j-a[i]])%2==0){\n\t\t\t\t\t\tjud=1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbing(a[i],j*j-a[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(jud){\n\t\t\t\tsta[++tp]=i;\n\t\t\t\tif(tp==1){\n\t\t\t\t\tfor(rg int j=i+1;j<=n;j++){\n\t\t\t\t\t\tmp[a[j]]=0;\n\t\t\t\t\t\tfa[a[j]]=a[j];\n\t\t\t\t\t\tdis[a[j]]=0;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor(rg int j=i+1;j<=sta[tp-1];j++){\n\t\t\t\t\t\tmp[a[j]]=0;\n\t\t\t\t\t\tfa[a[j]]=a[j];\n\t\t\t\t\t\tdis[a[j]]=0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tjud=0;\n\t\t\t}\n\t\t\tmp[a[i]]++;\n\t\t}\n\t\tprintf(\"%d\\n\",tp+1);\n\t\tfor(rg int i=tp;i>=1;i--){\n\t\t\tprintf(\"%d \",sta[i]);\n\t\t}\n\t\tprintf(\"\\n\");\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1603105688,
        "uid": 316322,
        "name": "hzoi_liuchang",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P3940 \u3010\u5206\u7ec4\u3011"
    },
    {
        "content": "\u9996\u5148\u8fd9\u4e2a\u9898\u6709\u82e5\u5e72\u79cd\u9a97\u5206\u6280\u5de7\u3002  \n\u89e3\u51b3\u5b57\u5178\u5e8f\u6700\u5c0f\u7684\u65b9\u6cd5\u5c31\u662f\u4ece\u540e\u5f80\u524d\u679a\u4e3e\u3002\n\u90a3\u4e48 $K=1$ \u5c31\u5f88\u7b80\u5355\u4e86\uff0c\u4ece\u540e\u5f80\u524d\u626b\u4e00\u904d\u5c31\u884c\uff0c\u6bcf\u6b21\u5224\u65ad\u662f\u5426\u6709\u51b2\u7a81\uff0c\u6709\u4e86\u5c31\u7d2f\u8ba1\u7b54\u6848\u6e05\u7a7a\u6570\u7ec4\u3002  \n\u5224\u65ad\u7684\u65f6\u5019\u76f4\u63a5\u679a\u4e3e\u5b9a\u8d85\u65f6\uff0c\u6ce8\u610f\u5230 $131072=512^2 /2$\uff0c\u6240\u4ee5\u6bcf\u6b21\u53ea\u8981\u679a\u4e3e $x<=512$,\u5224\u65ad $x^2-a_i$ \u662f\u5426\u51fa\u73b0\u5373\u53ef\u3002  \n\u5bf9\u4e8e $K=2$\uff0c\u8fd8\u662f\u4ece\u540e\u5f80\u524d\u5206\u7ec4\uff0c\u5224\u5b9a\u7684\u65f6\u5019\u76f8\u5f53\u4e8e\u5224\u5b9a\u4e8c\u5206\u56fe\uff0c \u66b4\u529b\u53ef\u523080\u3002\n\u6b63\u89e3\u5176\u5b9e\u662f\u5e76\u67e5\u96c6\uff0c\u7c7b\u6bd4\u5173\u62bc\u7f6a\u72af\uff0c\u4f7f\u7528\u6269\u5c55\u57df\u7684\u5e76\u67e5\u96c6\u5224\u65ad\uff0c\u6bcf\u6b21\u5224\u65ad\uff0c\u5904\u7406\uff0c\u5408\u5e76 \u3002 \n\u4e00\u65e6\u78b0\u5230\u51b2\u7a81\u7684\u5c31\u5408\u5e76\uff0c\u7136\u540e\u5224\u65ad\u662f\u4e0d\u662f\u5df2\u7ecf\u5728\u4e00\u4e2a\u96c6\u5408\u5185\uff0c\u5982\u679c\u5df2\u7ecf\u91cd\u4e86\uff0c\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\u5982\u679c\u8fd9\u4e2a\u6570 $2$ \u500d\u662f\u5b8c\u5168\u5e73\u65b9\u6570\u5e76\u4e14\u51fa\u73b0\u6070\u597d $2$ \u6b21\uff0c\u524d\u9762\u7684\u6570\u6ca1\u6709\u548c\u4ed6\u51b2\u7a81\u7684\uff0c\u90a3\u4e48\u6ca1\u4e8b\uff1b\u5426\u5219\u5c31\u8981\u91cd\u65b0\u5206\u6bb5\u3002  \n\u8fd9\u4e2a\u7279\u5224\u7684\u672c\u8d28\u5c31\u662f\u5728\u4e00\u5806\u4e0d\u5408\u6cd5\u60c5\u51b5\u91cc\u9762\u628a\u5408\u6cd5\u7684\u6392\u51fa\u6765\uff0c\u7ec6\u8282\u6709\u70b9\u591a   \n```cpp  \n#include <bits/stdc++.h>\nusing namespace std;\nint a[300005];int mem[300005];\nstack <int> s;\nint ans[300005],num;\ninline void add(int x){ans[++num]=x;}\nint f[300005];int n,k;\ninline int find(int x)\n{\n\tif(f[x]!=x)f[x]=find(f[x]);\n\treturn f[x];\n}\ninline void tu(int x,int y)//y\u5408\u5e76\u5230x\u4e0a \n{\n\tx=find(x);y=find(y);\n\tf[y]=x; \n}\ninline void clear()\n{\n\twhile(!s.empty())\n\t{\n\t\tif(k==2)f[s.top()]=s.top();\n\t\tif(k==2)f[s.top()+131072]=s.top()+131072; \n\t    mem[s.top()]=0;\n\t\ts.pop();\n\t}\n}\nbool gan(int x)\n{\n\tfor(int j=ceil(sqrt(x));j<=512;j++)\n\t{\n\t\tif(mem[j*j-x]&&((j*j-x)!=x))return 0;\n\t}\n\treturn 1;\n}\nsigned main()\n{\n//\tfreopen(\"sb.txt\",\"r\",stdin);\n\tcin>>n>>k;\n\tfor(int i=1;i<=n;i++)scanf(\"%d\",&a[i]);\n\tint an=1;\n\tif(k==1)\n\t{\n\t\tfor(int i=n;i>=1;i--)\n\t    {\n\t\t   for(int j=ceil(sqrt(a[i]));j<=512;j++)//\u6ce8\u610f\u5408\u6cd5\uff0cj*j>=a[i] \n\t\t   if(mem[j*j-a[i]])\n\t\t   {\n\t\t \t an++;add(i);clear();\n\t\t \t break;\n\t\t   }\n\t\t   mem[a[i]]++;s.push(a[i]); \n\t    }\n\t}\n\tif(k==2)\n\t{\n\t\tfor(int i=1;i<=300000;i++)f[i]=i;\n\t\tfor(int i=n;i>=1;i--)\n\t\t{\n\t\t   s.push(a[i]);\n\t\t   for(int j=ceil(sqrt(a[i]));j<=512;j++)\n\t\t   {\n\t\t   \tint p=j*j-a[i];\n\t\t   \tif(!mem[p])continue;\n            tu(p+131072,a[i]),tu(p,a[i]+131072);\n\t\t   \tif(find(a[i])==find(a[i]+131072)) \n\t\t   \t{\n\t\t\t\tif(a[i]==p&&gan(a[i])&&mem[p]==1)continue;\n\t\t\t\tan++;add(i);clear();break;\t\n\t\t    }\n\t\t   }\n\t       mem[a[i]]++;s.push(a[i]);\n\t\t} \n\t} \n\tprintf(\"%d\\n\",an);\n    for(int i=num;i>=1;i--)printf(\"%d \",ans[i]);\n\treturn 0; \n}\n```  \n\u6e05\u7a7a\u6570\u7ec4\u6211\u7528\u7684\u6808\uff0c\u53ef\u4ee5\u7701\u65f6\u95f4\uff0c\u4f46\u4e00\u5b9a\u8981\u6e05\u5e72\u51c0\uff0c\u4e5f\u53ef\u4ee5\u7528```memset```\uff0c\u5c31\u662f\u6162\u70b9\uff0c\u53ef\u80fd\u4f1aT1\u4e2a\u70b9\u3002",
        "postTime": 1624365311,
        "uid": 472963,
        "name": "PMZG",
        "ccfLevel": 0,
        "title": "P3940 \u5206\u7ec4"
    },
    {
        "content": "## \u9898\u89e3\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/nanfeng-blog/p/14919163.html)\n\n\u8fd9\u9053\u9898\u6211\u4eec\u53d1\u73b0\u53ef\u4ee5\u6839\u636e $k=1$ \u548c $k=2$ \u7684\u60c5\u51b5\u5206\u522b\u8ba8\u8bba\n\n$k=1$ \u65f6\uff0c\u6211\u4eec\u53d1\u73b0\u8981\u4fdd\u8bc1\u5b57\u5178\u5e8f\uff0c\u90a3\u4e48\u6211\u4eec\u4ece\u540e\u5f80\u524d\u626b\uff0c\u626b\u7684\u65f6\u5019\u5224\u65ad\u4e00\u4e0b\u5f53\u524d\u6570\u662f\u5426\u4f1a\u548c\u4e0a\u4e00\u6bb5\u7684\u51b2\u7a81\u3002\n\n\u590d\u6742\u5ea6\u74f6\u9888\u5c31\u5728\u4e8e\u5982\u4f55\u5224\u65ad\u3002\u6211\u4eec\u53d1\u73b0 $a_i\\leq 2^{17}$ \u6240\u4ee5 $j*j=a_i+a_k$ \u4e2d $j$ \u6700\u5927\u4e3a $2^9$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e $j$\uff0c\u8bb0\u5f55\u4e00\u4e2a\u6570\u7ec4\uff0c\u5224\u65ad\u4e00\u4e0b $j*j-a_i$ \u662f\u5426\u51fa\u73b0\u8fc7\n\n\u6700\u540e\u82e5\u5206\u51fa\u65b0\u7684\u4e00\u6bb5\uff0c\u8bb0\u5f97\u8981\u628a\u524d\u4e00\u6bb5\u7684\u6e05\u7a7a\u3002\n\n$k=2$ \u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u4e2a\u6570\u62c6\u6210\u4e24\u4e2a\u70b9\uff0c\u5206\u522b\u4e3a $x_1$\uff0c$x_2$\uff0c$y_1$\uff0c$y_2$\uff0c\u8ba9\u540e\u5c06\u51b2\u7a81\u7684\u6570\u8fde\u8d77\u6765\uff0c\u53d1\u73b0\u5982\u679c\u5176\u7b26\u5408\u4e8c\u5206\u56fe\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5206\u4e3a\u4e00\u7ec4\u3002\n\n\u5bf9\u4e8e\u5224\u65ad\u4e8c\u5206\u56fe\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u5e76\u67e5\u96c6\u66ff\u4ee3\u3002\uff08[\u601d\u60f3](https://www.luogu.com.cn/problem/P1525)\uff09\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u6570\uff0c\u6211\u4eec\u7ed9\u4ed6\u5f00\u4e00\u4e2a\u654c\u4eba\u57df\uff0c\u6bcf\u6b21\u82e5\u53d1\u73b0\u51b2\u7a81\uff0c\u4f46\u53ef\u4ee5\u5206\u6210\u4e24\u4e2a\u56e2\u4f53\u89e3\u51b3\uff0c\u90a3\u4e48\u6211\u4eec\u5c06\u4e24\u4e2a\u6811\u7684\u654c\u4eba\u57df\u5411\u4e0e\u5176\u53d1\u751f\u51b2\u7a81\u7684\u6570\u5408\u5e76\n\n\u5224\u65ad\u65f6\u5c31\u662f\u5224\u65ad $x_1$ \u662f\u5426\u548c $y_1$ \u5728\u4e00\u4e2a\u96c6\u5408\u91cc\u3002\n\n(\u5e76\u67e5\u96c6\u7684\u590d\u6742\u5ea6\u53ef\u4ee5\u8fd1\u4f3c\u4e3a\u5e38\u6570)\n\n```cpp\n#include<bits/stdc++.h>\n#define ri register signed\n#define p(i) ++i\nusing namespace std;\nnamespace IO{\n    char buf[1<<21],*p1=buf,*p2=buf;\n    #define gc() p1==p2&&(p2=(p1=buf)+fread(buf,1,1<<21,stdin),p1==p2)?EOF:*p1++\n    inline int read() {\n        ri x=0,f=1;char ch=gc();\n        while(ch<'0'||ch>'9') {if (ch=='-') f=-1;ch=gc();}\n        while(ch>='0'&&ch<='9') {x=(x<<1)+(x<<3)+(ch^48);ch=gc();}\n        return x*f;\n    }\n}\nusing IO::read;\nnamespace nanfeng{\n    #define cmax(x,y) ((x)>(y)?(x):(y))\n    #define cmin(x,y) ((x)>(y)?(y):(x))\n    #define FI FILE *IN\n    #define FO FILE *OUT\n    static const int N=(1<<17)+7;\n    int a[N],vis[N],st[N],fa[N<<1],fg[N<<1],n,k,tot=1,mx;\n    int find(int x) {return x==fa[x]?x:fa[x]=find(fa[x]);}\n    inline int main() {\n        // FI=freopen(\"nanfeng.in\",\"r\",stdin);\n        // FO=freopen(\"nanfeng.out\",\"w\",stdout);\n        n=read(),k=read();\n        for (ri i(1);i<=n;p(i)) a[i]=read(),mx=cmax(mx,a[i]);\n        vis[a[n]]=1;st[1]=n;\n        if (k==1) {\n            for (ri i(n-1);i;--i) {\n                for (ri j(ceil(sqrt(a[i])));j*j-a[i]<=mx;p(j)) {\n                    if (j*j>=a[i]&&vis[j*j-a[i]]) {\n                        st[p(tot)]=i;\n                        for (ri k(i+1);k<=st[tot-1];p(k)) vis[a[k]]=0;\n                        break;\n                    }\n                }\n                vis[a[i]]=1;\n            }\n        } else {\n            for (ri i(1);i<=mx;p(i)) fa[i]=i,fa[i+mx]=i+mx;\n            for (ri i(1);i*i<=(mx<<1);p(i)) fg[i*i]=1;\n            for (ri i(n-1);i;--i) {\n                ri fl=0;\n                if (vis[a[i]]) {\n                    if (fg[a[i]<<1]) {\n                        if (vis[a[i]]==2||fa[a[i]+mx]!=a[i]+mx) fl=1;\n                    }\n                } else {\n                    for (ri j(ceil(sqrt(a[i])));j*j-a[i]<=mx;p(j)) {\n                        if (vis[j*j-a[i]]) {\n                            if (fg[(j*j-a[i])<<1]&&vis[j*j-a[i]]==2) {fl=1;break;}\n                            int x1=find(a[i]),x2=find(a[i]+mx),y1=find(j*j-a[i]),y2=find(j*j-a[i]+mx);\n                            if (x1==y1) {fl=1;break;}\n                            fa[y2]=x1;fa[x2]=y1;\n                        }\n                    }\n                }\n                if (fl) {\n                    for (ri j(i);j<=st[tot];p(j)) fa[a[j]]=a[j],fa[a[j]+mx]=a[j]+mx,vis[a[j]]=0;\n                    st[p(tot)]=i;\n                }\n                p(vis[a[i]]);\n            }\n        }\n        printf(\"%d\\n\",tot);\n        for (ri i(tot);i>1;--i) printf(\"%d \",st[i]);\n        puts(\"\");\n        return 0;\n    }\n}\nint main() {return nanfeng::main();}\n```",
        "postTime": 1624351022,
        "uid": 141958,
        "name": "\u6960\u67ab",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P3940 \u5206\u7ec4"
    }
]