[
    {
        "content": "## \u519c\u573a \u9898\u89e3\u62a5\u544a\n\n### \u9898\u610f\u7b80\u8ff0\n$n \\times m$ \u7684\u7f51\u683c\u578b\u77e9\u9635\uff0c\u6bcf\u683c\u6709\u521d\u59cb\u6743 $a_{i,j}$ \u3002\n\n\u7ed9\u5b9a $Q$ \u4e2a\u5b50\u77e9\u9635\uff0c\u5b9a\u4e49\u4e00\u4e2a\u5b50\u77e9\u9635 \u201c\u76c8\u5229\u201d \u5f53\u4e14\u4ec5\u5f53\u5b50\u77e9\u9635\u5185\u683c\u5b50\u7684\u6743\u4e4b\u548c\u4e0d\u5c0f\u4e8e\u7ed9\u5b9a\u503c $b_i$\u3002\n\n\u7ed9\u51fa $T$ \u5929\uff0c\u6bcf\u5929\u53d1\u751f\u82e5\u5e72\u4e8b\u4ef6\u5f62\u5982\uff1a\n\n-  $a_{x,y} \\leftarrow a_{x,y}-z$\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u5b50\u77e9\u9635\uff0c\u6c42\u51fa\u4e00\u4e2a\u65f6\u95f4 $t$ \uff0c\u6ee1\u8db3\uff1a\n\n- \u7b2c $t$ \u5929**\u7ed3\u675f**\u65f6\u8be5\u5b50\u77e9\u9635\u4ecd\u7136 \u201c\u76c8\u5229\u201d\u3002\n\n- \u7b2c $t+1$ \u5929**\u7ed3\u675f**\u65f6\u8be5\u5b50\u77e9\u9635\u4e0d \u201c\u76c8\u5229\u201d\u3002\n\n- \u82e5\u7b2c $T$ \u5929**\u7ed3\u675f**\u65f6\u4ecd\u7136\u76c8\u5229\uff0c\u5219\u8f93\u51fa $-1$\u3002\n\n### \u9898\u76ee\u5206\u6790\n\n\u5148\u8bc4\u4ef7\u4e00\u4e0b\u8fd9\u9053\u9898\u5427\u3002\n\n\u8fd9\u9053\u9898\u662f\u4e00\u9053\u53ef\u4ee5\u4f5c\u4e3a**\u6574\u4f53\u4e8c\u5206**\u6a21\u677f\u9898\u7684\u597d\u9898\u3002\n\n\u4e2a\u4eba\u8ba4\u4e3a\u8fd9\u9898\u6574\u4f53\u4e8c\u5206\u6bd4\u8f83\u76f4\u63a5\u597d\u60f3\uff0c\u4e0d\u50cf\u6709\u4e9b\u9898\u4f1a\u6d89\u53ca\u5230\u503c\u57df\u7b49\u7565\u5fae\u590d\u6742\u7684\u4e1c\u897f\u3002\n\n\u5148\u6765\u8bb2\u4e00\u4e0b\u6574\u4f53\u4e8c\u5206\u662f\u4ec0\u4e48\u3002\n\n\u987e\u540d\u601d\u4e49\uff0c\u4f60\u53ef\u4ee5\u628a\u5b83\u7406\u89e3\u6210\u82e5\u5e72\u6b21\u4e8c\u5206\u4e00\u8d77\u505a\u3002\n\n\u6211\u4eec\u5148\u6765\u60f3\u4e00\u4e2a\u5b50\u95ee\u9898\uff1a\n\n- $Q=1$\n\n\u90a3\u8fd9\u9053\u9898\u5c31\u6709\u4e00\u4e2a\u5f88\u7b80\u5355\u7684\u505a\u6cd5\uff1a\n\n- \u4e8c\u5206\u7b2c\u51e0\u6b21**\u4e8b\u4ef6**\u540e\u5f00\u59cb\u4e0d \u201c\u76c8\u5229\u201d \uff0c\u5229\u7528\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\u52a8\u6001\u7ef4\u62a4\u5355\u70b9\u4fee\u6539\u4e0e\u5b50\u77e9\u9635\u67e5\u8be2\u3002\n\n\u5f53\u7136\uff0c\u8fd9\u91cc\u8981\u65f6\u523b\u6ce8\u610f\u54ea\u4e9b\u4e8b\u4ef6\u505a\u4e86\u54ea\u4e9b\u4e8b\u4ef6\u6ca1\u505a\u3002\n\n\u5f53\u7136\u4e0d\u96be\u8bc1\u660e\u8fd9\u91cc\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(\\sum p \\log n \\log m)$ \u7684\u3002\n\n\u90a3\u4e48\uff0c\u5f53 $Q$ \u5927\u8d77\u6765\u65f6\uff0c\u6709\u4e00\u79cd\u76f4\u63a5\u7684\u60f3\u6cd5\u662f\u8dd1 $Q$ \u6b21\u4e0a\u8ff0\u64cd\u4f5c\u3002\n\n\u5f53\u7136\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(Q \\sum p \\log n \\log m)$ \u7684\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u4e00\u822c\u800c\u8a00\uff0c\u4f18\u5316\u4e00\u822c\u4f1a\u5f80\u51e0\u4e2a\u65b9\u5411\uff1a\n\n- \u51cf\u5c11\u91cd\u590d/\u65e0\u7528\u64cd\u4f5c\u3002\uff08\u5982\u672c\u9898\uff09\n\n- \u63d0\u9ad8\u4fe1\u606f\u5229\u7528\u7387\uff08\u5982 KMP\uff09\u3002\n\n\u800c\u672c\u9898\u4e3b\u8981\u65e8\u5728\u51cf\u5c11\u91cd\u590d\u64cd\u4f5c\u3002\n\n\u6211\u4eec\u8003\u8651\u5355\u6b21\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u74f6\u9888\u5728\u54ea\u3002\n\n\u5bf9\u4e8e\u6bcf\u6b21\u4e8c\u5206\u5224\u5b9a\uff0c\u6211\u4eec\u90fd\u9700\u8981\u6765\u56de\u6539\u53d8\u5f53\u524d\u5f53\u524d\u505a\u5230\u54ea\u4e2a\u201c\u4e8b\u4ef6\u201d\uff0c\u4ee5\u786e\u4fdd\u80fd\u591f\u6b63\u786e\u5224\u5b9a\u3002\n\n\u4f46\u6d88\u8017\u5982\u6b64\u591a\u7684\u65f6\u95f4\u53ea\u5224\u5b9a\u4e00\u4e2a\u663e\u5f97\u592a\u4e8f\u4e86\u3002\n\n\u56e0\u6b64\u6211\u4eec\u8003\u8651\u6bcf\u6b21\u4e8c\u5206\u90fd\u4e00\u6b21\u6027\u628a\u6240\u6709\u5b50\u77e9\u9635\u5206\u6210\u201c\u4ecd\u7136\u76c8\u5229\u201d\u4e0e\u201c\u4e0d\u76c8\u5229\u4e86\u201d\u4e24\u7c7b\uff0c\u7136\u540e\u518d\u5206\u6cbb\u4e24\u8fb9\u3002\n\n\u8fd9\uff0c\u5c31\u662f**\u6574\u4f53\u4e8c\u5206**\u3002\n\n\u672c\u8d28\u4e0a\u6765\u8bf4\uff0c\u6574\u4f53\u4e8c\u5206\u7684\u672c\u8d28\u5c31\u662f\uff1a**\u4e00\u6b21\u4fee\u6539\uff0c\u591a\u6b21\u5224\u5b9a\u3002**\n\n\u4e5f\u56e0\u6b64\uff0c\u4f7f\u7528\u6574\u4f53\u4e8c\u5206\u6709\u4ee5\u4e0b\u51e0\u4e2a\u8981\u6c42\uff1a\n\n- \u5355\u8bcd\u8be2\u95ee\u4e8c\u5206\u53ef\u89e3\u3002\n\n- \u652f\u6301\u79bb\u7ebf\n\n- \u4fee\u6539\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u9ad8\uff0c\u800c\u5224\u5b9a\u7684\u590d\u6742\u5ea6\u4f4e\u3002\n\n\u5173\u4e8e\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u4f60\u53ef\u4ee5\u628a\u5b83\u8fd1\u4f3c\u7406\u89e3\u6210 $Q=1$ \u7684\u65f6\u95f4 \u590d\u6742\u5ea6\u3002\n\n\u5177\u4f53\u4e00\u70b9\u662f $O(( \\sum p+Q) \\log n \\log m)$\uff0c\u8db3\u77e3\u901a\u8fc7\u672c\u9898\u3002\n\n\u4e0a\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define lb(x) (x&-x)\n#define mid (l+r>>1)\nusing namespace std;\nconst int N=510;\nconst int SUMQ=1e5+10;\nconst int MAXQ=5e4+10;\nconst ll INF=1e18;\ninline ll read(){\n\tll x=0,f=1,c=getchar();\n\twhile(c<'0'||c>'9')f=(c=='-'?-1:1),c=getchar();\n\twhile(c>='0'&&c<='9')x=(x<<1)+(x<<3)+(c^48),c=getchar();\n\treturn x*f;\n}\nint n,m,Q,T,tot,ans[MAXQ];\nstruct Field{\n\tint x1,y1,x2,y2,id;\n\tll k;\n}q[MAXQ],q1[MAXQ],q2[MAXQ];\nstruct Rain{\n\tint x,y,t;\n\tll k;\n}rain[SUMQ+N*N];\nll t[N][N];\ninline void Insert(int x,int y,ll k){\n\tfor(int i=x+1;i<=n+1;i+=lb(i))\n\t\tfor(int j=y+1;j<=m+1;j+=lb(j))\n\t\t\tt[i][j]+=k;\n}\ninline ll query(int x,int y,ll A=0){\n\tfor(int i=x+1;i;i-=lb(i))\n\t\tfor(int j=y+1;j;j-=lb(j))\n\t\t\tA+=t[i][j];\n\treturn A;\n}//\u8fd9\u91ccx,y\u52a0\u4e00\u662f\u4e3a\u4e86\u9632\u6b62x=0\u6216y=0\u7684\u6b7b\u5faa\u73af\ninline void solve(int L,int R,int l,int r){\n\tif(L>R){\n\t\tfor(int i=l;i<=r;i++)Insert(rain[i].x,rain[i].y,rain[i].k);\n\t\treturn ;\n\t}\n\tif(l==r){\n\t\tfor(int i=L;i<=R;i++)ans[q[i].id]=rain[l].t;\n\t\tInsert(rain[l].x,rain[l].y,rain[l].k);\n\t\treturn;\n\t}\n\tfor(int i=l;i<=mid;i++)Insert(rain[i].x,rain[i].y,rain[i].k);\n\tint top1=0,top2=0;\n\tfor(int i=L;i<=R;i++){\n\t\tll res=query(q[i].x2,q[i].y2)-query(q[i].x2,q[i].y1-1)-query(q[i].x1-1,q[i].y2)+query(q[i].x1-1,q[i].y1-1);\n\t\tif(res>=q[i].k)q2[++top2]=q[i];\n\t\telse q1[++top1]=q[i];\n\t}\n\tfor(int i=1;i<=top1;i++)q[L+i-1]=q1[i];\n\tfor(int i=1;i<=top2;i++)q[L+top1+i-1]=q2[i];\n\tfor(int i=l;i<=mid;i++)Insert(rain[i].x,rain[i].y,-rain[i].k);\n\tsolve(L,L+top1-1,l,mid);\n\tsolve(L+top1,R,mid+1,r);\n}//\u6574\u4e2a\u51fd\u6570\u8fd8\u662f\u633a\u597d\u7406\u89e3\u7684\uff0c\u4e00\u5b9a\u8981\u6ce8\u610f\u6bcf\u4e2a\u201c\u4e8b\u4ef6\u201d\u662f\u5426\u5df2\u7ecf\u88ab\u8ba1\u7b97\u4e86\u3002\nint main(){\t\n\tn=read(),m=read();\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=m;j++)\n\t\t\tInsert(i,j,read());\n\tQ=read();\n\tfor(int i=1;i<=Q;i++)q[i]={read(),read(),read(),read(),i,read()};\n\tT=read();\n\tfor(int i=1;i<=T;i++){\n\t\tint q=read();\n\t\tfor(int j=1;j<=q;j++)\n\t\t\train[++tot]={read(),read(),i-1,-read()};//\u8fd9\u91cci-1\u662f\u56e0\u4e3a\u5f53\u5929\u7ed3\u675f\u8fd8\u80fd\u76c8\u5229\u624d\u4f1a\u7edf\u8ba1\u54ea\u4e00\u5929\uff0c\u800cans\u51fa\u6765\u7684\u662f\u54ea\u6b21\u4e8b\u4ef6\u7ed3\u675f\u540e\u5c31\u201c\u4e0d\u76c8\u5229\u201d\u4e86\u3002\n\t}\n\train[++tot].t=-1;\n\tsolve(1,Q,0,tot);\n\tfor(int i=1;i<=Q;i++)\n\t\tprintf(\"%d \",ans[i]);\n\treturn 0;\n}\n```\n### \u540e\u8bb0\uff1a\n \n\u6709\u4e0d\u5c11\u9898\u89e3\u4e60\u60ef\u628a\u201c\u4fee\u6539\u201d\u548c\u201c\u8be2\u95ee\u201d\u653e\u5728\u4e00\u8d77\u8fdb\u884c\u4e8c\u5206\uff0c\u6211\u89c9\u5f97\u90a3\u4e48\u5199\u6709\u4e9b\u96be\u4ee5\u7406\u89e3\uff0c\u4e14\u6211\u8fd9\u79cd\u5199\u6cd5\u4e0e\u4ed6\u4eec\u7684\u5199\u6cd5\u6548\u7387\u76f8\u5dee\u4e5f\u5c0f\uff0c\u56e0\u6b64\u7528\u4e86\u8fd9\u79cd\u76f4\u767d\u4e00\u70b9\u7684\u5199\u6cd5\u3002\n\n\u603b\u800c\u8a00\u4e4b\uff0c\u505a\u6574\u4f53\u4e8c\u5206\u7684\u9898\u76ee\u8fd8\u662f\u8981\u591a\u60f3\u60f3\u6211\u8981\u4e8c\u5206\u90a3\u4e9b\u4e1c\u897f\uff0c$L\\sim R$ \u4e0e $ l\\sim r$ \u5230\u5e95\u8868\u8fbe\u7684\u662f\u4ec0\u4e48\uff0c\u5207\u5fcc\u4e00\u5473\u7684\u5bf9\u7740\u9898\u89e3\u7801\u3002\n\n\u672c\u4eba\u4e5f\u7b97\u662f\u6574\u4f53\u4e8c\u5206\u7684\u521d\u5b66\u8005\uff0c\u5982\u6709\u9519\u8bef\u6b22\u8fce\u6307\u51fa\u3002\n\n**That's all.Thanks.**",
        "postTime": 1658992869,
        "uid": 390742,
        "name": "qwqUwU",
        "ccfLevel": 7,
        "title": "[AGM 2022 \u8d44\u683c\u8d5b] \u519c\u573a"
    },
    {
        "content": "DS \u597d\u9898\uff0c\u5c31\u662f\u6709\u70b9\u5361\u5e38\uff08\n\n## \u9898\u76ee\u5927\u610f\n\n\u7ef4\u62a4\u4e00\u4e2a $n\\times m$ \u5927\u5c0f\u7684\u4e8c\u7ef4\u77e9\u9635 $a$\u3002\u7b2c $i$ \u5929\u4f1a\u5728\u77e9\u9635\u4e0a\u8fdb\u884c $p_i$ \u6b21\u64cd\u4f5c\uff1a\u6bcf\u6b21\u64cd\u4f5c\u7ed9\u5b9a $x,y$\uff0c\u4ee4 $a_{x,y} \\gets a_{x,y} - z_i$\u3002\u540c\u65f6\u7ed9\u51fa $Q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u8be2\u95ee\u7ed9\u5b9a\u4e00\u4e2a\u5b50\u77e9\u5f62\u548c\u4e00\u4e2a\u6574\u6570 $b$\uff0c\u8be2\u95ee\u5728\u6700\u5927\u7684\u6574\u6570 $d$\uff0c\u6ee1\u8db3\u5728\u7b2c $d$ \u5929\u65f6\u5b50\u77e9\u5f62\u5143\u7d20\u4e4b\u548c $\\ge b$\u3002\n\n## \u6ce8\u91ca\n\n\u4e0b\u9762\u5206\u6790\u590d\u6742\u5ea6\u7684\u65f6\u5019\uff0c\u4ee4 $N=n \\cdot m$\uff0c\u5e76\u8ba4\u4e3a $Q,T,\\sum p$ \u5747\u540c\u9636\u3002\n\n## \u505a\u6cd5 0\n\n\u6211\u4e0d\u4f1a\u6570\u636e\u7ed3\u6784\uff01\n\n\u671f\u671b\u5f97\u5206\uff1a$0$\u3002\n\n## \u505a\u6cd5 1\n\n\u6211\u4f1a\u4e8c\u5206\u548c\u53ef\u6301\u4e45\u5316\u6570\u636e\u7ed3\u6784\uff01\n\n\u7531\u4e8e\u8fd9\u4e2a\u4e8c\u7ef4\u77e9\u9635\u53ea\u4f1a\u52a0\u4e0d\u4f1a\u51cf\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\uff0c\u4e8c\u5206\u51fa\u5b83\u6700\u540e\u4e00\u4e2a\u6ee1\u8db3\u6267\u884c\u5b8c\u4e4b\u540e\u5b50\u77e9\u5f62\u4e4b\u548c $\\ge b$ \u7684\u64cd\u4f5c\u7f16\u53f7\uff0c\u8f93\u51fa\u8fd9\u4e2a\u64cd\u4f5c\u7f16\u53f7\u5bf9\u5e94\u7684\u65f6\u95f4 $-1$ \u5373\u4e3a\u7b54\u6848\u3002\n\n\u4e8c\u5206\u7684\u65f6\u5019\u9700\u8981\u4e00\u4e2a\u56de\u9000\u5230\u5bf9\u5e94\u7248\u672c\u3001\u5355\u70b9\u52a0\u3001\u77e9\u5f62\u67e5\u7684\u6570\u636e\u7ed3\u6784\u6765\u7ef4\u62a4\u67e5\u8be2\u3002\n\n- \u5982\u679c\u6211\u4eec\u4f7f\u7528\u53ef\u6301\u4e45\u5316\u6811\u5957\u6811\u6765\u7ef4\u62a4\uff0c\u5219\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(N+ Q\\log Q \\log n \\log m)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(N+Q\\log n \\log m)$\u3002\u7531\u4e8e\u8fd9\u9898\u7684\u7a7a\u95f4\u9650\u5236\u53ea\u6709 64MB\uff0c\u8be5\u505a\u6cd5\u663e\u7136\u65e0\u6cd5\u901a\u8fc7\u6b64\u9898\u3002\n- \u7531\u4e8e\u6211\u4eec\u8981\u7ef4\u62a4\u7684\u662f\u6ee1\u70b9\u96c6\uff0c\u8003\u8651\u4f7f\u7528\u53ef\u6301\u4e45\u5316\u56db\u5206\u6811\u7ef4\u62a4\u3002\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(N+Q \\sqrt N + Q\\log Q\\max(n,m))$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u4e3a $O(N+Q\\log N)$\uff0c\u7ecf\u6d4b\u8bd5\u53ef\u4ee5\u5361\u8fdb\u672c\u9898\u7684\u7a7a\u95f4\u9650\u5236\u3002\u4f46\u7531\u4e8e\u65f6\u95f4\u590d\u6742\u5ea6\u4e58\u4e86\u4e00\u4e2a $\\max(n,m)$\uff0c\u672c\u5730\u968f\u673a\u6570\u636e\u9700\u8981\u8dd1\u63a5\u8fd1 4s\uff0c\u65e0\u6cd5\u901a\u8fc7\u672c\u9898\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$0$\u3002\n\n## \u505a\u6cd5 2\n\n\u6211\u4f1a\u79bb\u7ebf\u540e\u5bf9\u65f6\u95f4\u7ef4\u5206\u5757\uff01\n\n\u6211\u4eec\u53d1\u73b0\u4e0a\u9762\u7684\u505a\u6cd5 $1$ \u662f\u5728\u7ebf\u7684\uff0c\u800c\u9898\u76ee\u5141\u8bb8\u6211\u4eec\u5bf9\u8be2\u95ee\u79bb\u7ebf\u540e\u4e00\u8d77\u505a\u3002\n\n\u8003\u8651\u5bf9\u4fee\u6539\u64cd\u4f5c\u5206\u5757\uff0c$\\sqrt T$ \u4e2a\u64cd\u4f5c\u5206\u6210\u4e00\u5757\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\uff0c\u5148\u8ba1\u7b97\u51fa\u5b83\u6700\u5148\u4e0d\u6ee1\u8db3\u7684\u662f\u5728\u54ea\u4e00\u5757\u8be2\u95ee\u3002\u7136\u540e\u5bf9\u4e8e\u6bcf\u5757\u8be2\u95ee\u5355\u72ec\u5904\u7406\uff0c\u67e5\u8be2\u51fa\u6240\u6709\u300c\u6700\u5148\u5728\u8fd9\u4e00\u5757\u4e0d\u6ee1\u8db3\u7684\u8be2\u95ee\u300d\u4e2d\u5177\u4f53\u662f\u5728\u5757\u4e2d\u7684\u54ea\u4e2a\u8be2\u95ee\u4e0d\u6ee1\u8db3\u7684\u3002\u7531\u4e8e\u6bcf\u4e2a\u8be2\u95ee\u53ea\u4f1a\u5bf9\u4e00\u4e2a\u4fee\u6539\u64cd\u4f5c\u5757\u4ea7\u751f\u8d21\u732e\uff0c\u6240\u4ee5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(Q \\cdot \\texttt{Add()}+ Q\\sqrt Q\\cdot\\texttt{Query()}))$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6\u53d6\u51b3\u4e8e\u4f7f\u7528\u7684\u6570\u636e\u7ed3\u6784\u3002\u7531\u4e8e\u6211\u4eec\u5df2\u7ecf\u628a\u64cd\u4f5c\u79bb\u7ebf\u4e86\uff0c\u6240\u4ee5\u4e5f\u5c31\u4e0d\u9700\u8981\u53ef\u6301\u4e45\u5316\u4e86\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u7528\u666e\u901a\u7684\u6811\u5957\u6811\u7ef4\u62a4\u77e9\u5f62\u64cd\u4f5c\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(N+Q\\sqrt Q\\log n\\log m)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(N)$\u3002\u8fd9\u65f6\u5019\u7a7a\u95f4\u5c31\u4e0d\u6210\u95ee\u9898\u4e86\uff0c\u9057\u61be\u7684\u662f\uff0c\u8fd9\u4e2a\u505a\u6cd5\u7531\u4e8e\u5e38\u6570\u592a\u5927\uff0c\u4ecd\u7136\u65e0\u6cd5\u901a\u8fc7\u6b64\u9898\u3002\n\n\u671f\u671b\u5f97\u5206\uff1a$0$\u3002\n\n## \u505a\u6cd5 3\n\n\u6211\u4f1a\u5206\u5757\u5957\u5206\u5757\u5957\u5206\u5757\uff01\n\n\u6211\u4eec\u53d1\u73b0\u4e0a\u9762\u7684\u505a\u6cd5 $2$\u00a0\u590d\u6742\u5ea6\u74f6\u9888\u51fa\u73b0\u5728\u6570\u636e\u7ed3\u6784\u7684\u77e9\u5f62\u67e5\u8be2\u64cd\u4f5c\u3002\n\n\u8003\u8651\u5b9e\u73b0\u4e00\u4e2a\u4fee\u6539 $O(\\sqrt N)$\uff0c\u67e5\u8be2 $O(1)$ \u7684\u6570\u636e\u7ed3\u6784\u6765\u5e73\u8861\u590d\u6742\u5ea6\u3002\u53d1\u73b0\u53ef\u4ee5\u5bf9 $n$ \u548c $m$ \u8fd9\u4e24\u7ef4\u6309\u7167 $\\sqrt n \\times \\sqrt m$\u00a0\u5927\u5c0f\u5206\u5757\u3002\u5bf9\u4e8e\u4e00\u4e2a\u77e9\u5f62\u67e5\u8be2\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u62c6\u5206\u4e3a\u56db\u4e2a\u90e8\u5206\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ge86z8y3.png)\n\n\u56fe\u7247\u4e2d\uff0c\u8bbe\u6211\u4eec\u8981\u67e5\u8be2\u7684\u662f $(1,1)$ \u5230\u6807\u6ce8 $\\texttt{X}$ \u7684\u77e9\u5f62\u7684\u548c\uff0c\u5219\u5c06\u5176\u62c6\u5206\u4e3a\uff1a\n\n- \u5927\u5757\u5230\u5927\u5757\u4e4b\u95f4\u7684\u4e8c\u7ef4\u524d\u7f00\u548c\uff08\u7ea2\u8272\u90e8\u5206\uff09\u3002\n- \u5927\u5757\u5185\u90e8\u7684\u4e8c\u7ef4\u524d\u7f00\u548c\uff08\u9ec4\u8272\u90e8\u5206\uff09\u3002\n- \u82e5\u5e72\u4e2a $1 \\times \\sqrt m$ \u7684\u77e9\u5f62\u7684\u4e8c\u7ef4\u524d\u7f00\u548c\uff08\u5de6\u4fa7\u7eff\u8272\u90e8\u5206\uff09\u3002\n- \u82e5\u5e72\u4e2a $\\sqrt n \\times 1$\u00a0\u77e9\u5f62\u7684\u4e8c\u7ef4\u524d\u7f00\u548c\uff08\u4e0a\u4fa7\u7eff\u8272\u90e8\u5206\uff09\u3002\n\n\u4f1a\u53d1\u73b0\u8fd9\u56db\u4e2a\u90e8\u5206\u90fd\u53ef\u4ee5\u5728\u5355\u70b9\u4fee\u6539\u65f6 $O(\\sqrt N)$\u00a0\u66b4\u529b\u4fee\u6539\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e0b\u964d\u4e3a $O(N+Q\\sqrt N+Q\\sqrt Q)$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $O(N)$\u3002\u7a0d\u5fae\u5361\u5e38\u540e\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\n\u5199\u5f97\u597d\u7684\u8bdd\u671f\u671b\u5f97\u5206 $100$\u3002\n\n```cpp\nstruct Q {\n  P l, r;\n  ull x;\n  bool sol;\n} q[N];\n\nstruct C {\n  int x, y, v;\n} c[N];\n\ninline void UpSm(int x, int y) {\n  rep (i, lblx[x], rblx[x]) {\n    rep (j, lbly[y], rbly[y]) {\n      sq[i][j] = a[i][j];\n      if (j != lbly[y]) sq[i][j] += sq[i][j - 1];\n    }\n    if (i != lblx[x]) rep (j, lbly[y], rbly[y])\n        sq[i][j] += sq[i - 1][j];\n  }\n}\n\ninline void UpBg() {\n  ste (x, 1, n, szx)\n    ste (y, 1, m, szy) {\n      int bx = blx[x], by = bly[y];\n      bq[bx][by] = bq[bx][by] = bq[bx][by - 1] + sq[rblx[x]][rbly[y]];\n    }\n  rep (bx, 2, blx[n])\n    re (by, bly[m])\n      bq[bx][by] += bq[bx - 1][by];\n}\n\ninline void UpX(int x) {\n  rep (i, lblx[x], rblx[x])\n    ste (j, 1, m, szy)\n      xq[i][bly[j]] = xq[i][bly[j] - 1] + sq[i][rbly[j]];\n}\n\ninline void UpY(int y) {\n  ste (i, 1, n, szx)\n    rep (j, lbly[y], rbly[y])\n      yq[blx[i]][j] = yq[blx[i] - 1][j] + sq[rblx[i]][j];\n}\n\ninline void Init() {\n  re (i, n)\n    blx[i] = (i - 1) / szx + 1, lblx[i] = (blx[i] - 1) * szx + 1, rblx[i] = min(blx[i] * szx, n);\n  re (i, m)\n    bly[i] = (i - 1) / szy + 1, lbly[i] = (bly[i] - 1) * szy + 1, rbly[i] = min(bly[i] * szy, m);\n  ste (i, 1, n, szx)\n    ste (j, 1, m, szy)\n      UpSm(i, j);\n  ste (i, 1, n, szx)\n    UpX(i);\n  ste (i, 1, m, szy)\n    UpY(i);\n  UpBg();\n}\n\ninline ull Ask(int x, int y) {\n  if (x <= 0 || y <= 0) return 0;\n  ull ans = bq[blx[x] - 1][bly[y] - 1];\n  ans += xq[x][bly[y] - 1];\n  ans += yq[blx[x] - 1][y];\n  ans += sq[x][y];\n  return ans;\n}\n\ninline ull Ask(P l, P r) {\n  return Ask(r.x, r.y) - Ask(r.x, l.y - 1) - Ask(l.x - 1, r.y) + Ask(l.x - 1, l.y - 1);\n}\n\ninline void Add(int x, int y, int v) { a[x][y] += v, UpSm(x, y), UpX(x), UpY(y), UpBg(); }\n\nsigned main() {\n  in(n)(m);\n  re (i, n)\n    in(a[i], m);\n  Init();\n  in(qcnt);\n  re (i, qcnt)\n    in(q[i].l.x)(q[i].l.y)(q[i].r.x)(q[i].r.y)(q[i].x);\n  re (i, in()) {\n    re (_, in()) {\n      ++T;\n      in(c[T].x)(c[T].y)(c[T].v);\n      ed[T] = i;\n    }\n  }\n  szT = sqrt(T);\n  re (i, T)\n    blT[i] = (i - 1) / szT + 1, lblT[i] = (blT[i] - 1) * szT + 1, rblT[i] = min(blT[i] * szT, T);\n  vector<int> vec;\n  re (i, T) {\n    Add(c[i].x, c[i].y, -c[i].v);\n    if (i != rblT[i]) continue;\n    vec.clear();\n    re (j, qcnt) {\n      if (q[j].sol) continue;\n      if (Ask(q[j].l, q[j].r) < q[j].x) vec.push_back(j), q[j].sol = 1;\n    }\n    per (j, rblT[i], lblT[i]) {\n      each (x, vec)\n        if (Ask(q[x].l, q[x].r) < q[x].x) Ans[x] = j;\n      Add(c[j].x, c[j].y, c[j].v);\n    }\n    rep (j, lblT[i], rblT[i])\n      Add(c[j].x, c[j].y, -c[j].v);\n  }\n  re (i, qcnt) \n    out(q[i].sol ? ed[Ans[i]] - 1 : -1)(' ');\n  out('\\n');\n  return 0;\n}\n```",
        "postTime": 1647995189,
        "uid": 207996,
        "name": "yzy1",
        "ccfLevel": 9,
        "title": "P8231 \u9898\u89e3"
    },
    {
        "content": "\u7b80\u5355\u6574\u4f53\u4e8c\u5206\u7ec3\u4e60\u9898\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\uff0c\u6700\u66b4\u529b\u7684\u60f3\u6cd5\u80af\u5b9a\u662f\u6bcf\u5929\u7684\u51cf\u5c11\u91cf\u5168\u90e8\u8dd1\u4e00\u904d\uff0c\u8dd1\u5230\u4e0d\u6ee1\u8db3\u8981\u6c42\u4e86\u5c31\u505c\u6b62\uff0c\u663e\u7136\u6ca1\u6709\u524d\u9014\u3002\n\n\u90a3\u8003\u8651\u4e8c\u5206\u7b54\u6848\uff0c\u8f6c\u6362\u6210\u5224\u5b9a\u4e0b\u5b8c\u524d\u51e0\u5929\u7684\u96e8\u540e\uff0c\u8fd8\u80fd\u4e0d\u80fd\u6ee1\u8db3\u8981\u6c42\uff0c\u8fd9\u663e\u7136\u662f\u597d\u505a\u7684\uff0c\u91c7\u7528\u4e00\u4e2a\u652f\u6301\u5355\u70b9\u52a0\u77e9\u5f62\u67e5\u7684\u6811\u72b6\u6570\u7ec4\u5373\u53ef\u3002\n\n\u90a3\u6211\u4eec\u76f4\u63a5\u5957\u6574\u4f53\u4e8c\u5206\u677f\u5b50\uff0c\u5b9e\u73b0\u7ec6\u8282\u4e0a\u53ef\u4ee5\u8003\u8651\u5148\u505a\u5b8c\u524d\u534a\u90e8\u5206\u7684\u64cd\u4f5c\uff0c\u4e24\u8fb9\u5206\u79bb\u4e4b\u540e\u5148\u5904\u7406\u540e\u534a\u90e8\u5206\u7684\u64cd\u4f5c\u548c\u8be2\u95ee\uff0c\u7136\u540e\u64a4\u9500\u524d\u534a\u90e8\u5206\u7684\u64cd\u4f5c\uff0c\u518d\u5904\u7406\u524d\u534a\u90e8\u5206\u7684\u3002\n\n\u4f46\u662f\u8fd9\u6837\u4e0d\u51fa\u610f\u5916\u7684\u8bdd\uff08\u6ca1\u8bd5\u8fc7\uff09\u53ef\u80fd\u4f1a T \u98de\uff0c\u53d1\u73b0\u6bcf\u5929\u7684\u64cd\u4f5c\u6570\u662f\u4e0d\u5747\u5300\u7684\uff0c\u8fd9\u65f6\u5982\u679c\u7b2c\u4e00\u5929\u6709\u5c06\u8fd1 $10^5$ \u6b21\u64cd\u4f5c\uff0c\u4e8c\u5206\u7684\u65f6\u5019\u5c31\u590d\u6742\u5ea6\u8d77\u98de\u4e86\uff08\u60f3\u4e00\u60f3\u597d\u50cf\u4e5f\u6ca1\u6709\u8d77\u98de\uff1f\u597d\u50cf\u8fd8\u662f\u5bf9\u7684\uff0c\u4f46\u662f\u5e94\u8be5\u4f1a\u8dd1\u7684\u5f88\u6162\uff09\uff0c\u518d\u4e00\u770b\u53d1\u73b0\u8fd9\u4e2a\u5929\u6570\u4e0d\u662f\u5c41\u7528\u6ca1\u6709\u561b\uff0c\u76f4\u63a5\u7b97\u5728\u7b2c\u51e0\u6b21\u64cd\u4f5c\u540e\u4e0d\u6ee1\u8db3\u8981\u6c42\u4e86\u4e0d\u5c31\u597d\u4e86\u3002\n\n\u7136\u540e\u5e94\u8be5\u5c31\u505a\u5b8c\u4e86\uff0c\u590d\u6742\u5ea6\u5927\u7ea6\u662f $O((Q+\\sum p)\\log(Q+\\sum p)\\log n\\log m)$\uff0c\u663e\u7136\u968f\u4fbf\u8fc7\u3002\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<iostream>\n#include<cmath>\n#define y1 fjodifjsdidi\ntypedef long long ll;\nusing namespace std;\nconst int maxn=505,maxq=50005;\nint n,m,Q,T,P,mans;\nll a[maxn][maxn];\nint ans[maxq],mp[100005];\nstruct opt\n{\n\tint id,op;\n\tint l,r,L,R;\n\tll x;\n}t[maxq],q[150005],q1[150005],q2[150005];\nll c[maxn][maxn];\ninline int lowbit(int x){return x&-x;}\nvoid upd(int x,int y,ll k)\n{\n\tfor(int i=x;i<=n;i+=lowbit(i))\n\t\tfor(int j=y;j<=m;j+=lowbit(j)) c[i][j]+=k;\n}\nll query(int x,int y)\n{\n\tll res=0;\n\tfor(int i=x;i>=1;i-=lowbit(i))\n\t\tfor(int j=y;j>=1;j-=lowbit(j)) res+=c[i][j];\n    return res;\n}\nvoid solve(int l,int r,int ql,int qr)\n{\n    //cout<<l<<\" \"<<r<<\" \"<<ql<<\" \"<<qr<<endl;\n\tif(l==r)\n\t{\n        //cout<<ql<<\" \"<<qr<<\" \"<<l<<\" \"<<r<<\" qwq\"<<endl;\n\t\tfor(int i=ql;i<=qr;i++) if(q[i].op==2) ans[q[i].id]=l;\n\t\treturn;\n\t}\n\n\tint mid=(l+r)>>1;\n\tint len1=0,len2=0;\n\tfor(int i=ql;i<=qr;i++)\n\t{\n\t\tif(q[i].op==1)\n\t\t{\n\t\t\tif(q[i].id<=mid)\n\t\t\t{\n\t\t\t\tq1[++len1]=q[i];\n                //cout<<q[i].l<<\" \"<<q[i].r<<\" \"<<q[i].x<<endl;\n\t\t\t\tupd(q[i].l,q[i].r,q[i].x);\n\t\t\t}\n\t\t\telse q2[++len2]=q[i];\n\t\t}\n\t\telse if(q[i].op==2)\n\t\t{\n\t\t\tll qwq=query(q[i].L,q[i].R)-query(q[i].L,q[i].r-1)-query(q[i].l-1,q[i].R)+query(q[i].l-1,q[i].r-1);\n            //cout<<q[i].id<<\" \"<<q[i].l<<\" \"<<q[i].r<<\" \"<<q[i].x<<\" \"<<qwq<<endl;\n\t\t\tif(qwq<q[i].x)\n\t\t\t{\n\t\t\t\tq1[++len1]=q[i];\n\t\t\t}\n\t\t\telse q2[++len2]=q[i];\n\t\t}\n\t}\n\tfor(int i=ql;i<=ql+len1-1;i++) q[i]=q1[i-ql+1];\n\tfor(int i=ql+len1;i<=qr;i++) q[i]=q2[i-ql-len1+1];\n\tsolve(mid+1,r,ql+len1,qr);\n\tfor(int i=ql;i<=ql+len1-1;i++)\n\t{\n\t\tif(q[i].op==1) upd(q[i].l,q[i].r,-q[i].x);\n\t}\n\tsolve(l,mid,ql,ql+len1-1);\n}\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tfor(int i=1;i<=n;i++) for(int j=1;j<=m;j++) scanf(\"%lld\",&a[i][j]),upd(i,j,a[i][j]);\n\tscanf(\"%d\",&Q);\n\tfor(int i=1;i<=Q;i++)\n\t{\n\t\tscanf(\"%d%d%d%d%lld\",&t[i].l,&t[i].r,&t[i].L,&t[i].R,&t[i].x);\n\t\tt[i].id=i;t[i].op=2;\n\t}\n\tscanf(\"%d\",&T);\n\tfor(int i=1;i<=T;i++)\n\t{\n\t\tint p;\n\t\tscanf(\"%d\",&p);\n\t\tfor(int j=1;j<=p;j++)\n\t\t{\n\t\t\tP++;q[P].id=P,q[P].op=1;scanf(\"%d%d%lld\",&q[P].l,&q[P].r,&q[P].x);\n\t\t\tq[P].x=-q[P].x;mp[P]=i;if(j!=p) mp[P]--;\n\t\t}\n\t}\n\tmans=P;\n\tfor(int i=1;i<=Q;i++) q[++P]=t[i];\n\tsolve(1,mans+1,1,P);\n\tfor(int i=1;i<=Q;i++)\n\t{\n        //if(i==3) cout<<ans[i]<<\" \"<<mans<<\" qwq\"<<endl;\n\t\tif(ans[i]==mans+1) printf(\"-1 \");\n\t\telse printf(\"%d \",mp[ans[i]-1]);\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1647873672,
        "uid": 191868,
        "name": "monstersqwq",
        "ccfLevel": 8,
        "title": "P8231\u9898\u89e3"
    },
    {
        "content": "\u7ed9\u70b9\u9633\u95f4\u505a\u6cd5\u3002\n\n\u9996\u5148\u4e00\u4e2a\u663e\u7136\u7684\u505a\u6cd5\u662f\u5bf9\u6bcf\u4e2a\u519c\u573a\u4e8c\u5206\u540e check\uff0c\u4f46\u662f\u5728\u7ebf\u4e0d\u592a\u597d\u505a\uff0c\u800c\u4e14\u6574\u4f53\u4e8c\u5206\u7684\u505a\u6cd5\u786e\u5b9e\u4e00\u773c\uff0c\u6240\u4ee5\u8003\u8651\u6574\u4f53\u4e8c\u5206\u3002\n\n\u5355\u70b9\u4fee\u6539\u77e9\u5f62\u6c42\u548c\u663e\u7136\u4e8c\u7ef4\u6811\u72b6\u6570\u7ec4\uff0c\u7136\u540e\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(nm+(\\sum p+Q)\\log T\\log n\\log m)$\n\n\u7a7a\u95f4\u590d\u6742\u5ea6\uff1a$O(nm+\\sum p+Q)$\n\n\u6811\u72b6\u6570\u7ec4\u5e38\u6570\u7279\u522b\u5c0f\uff0c\u5b8c\u5168\u4e0d\u5361\u65f6\u95f4\u548c\u7a7a\u95f4\uff0c\u7ed9\u4e2a\u597d\u8bc4\u3002\n\n```cpp\nint n,m,ans[50005];\nstruct node{int x,y,z;};\nll c[505][505],sum[505][505];\nvector<node> v[50005];\nstruct ask{int l1,r1,l2,r2,id;ll b;}q[50005],Q[50005];\ninline void change(int x,int y,int v){int tmp=y;while(x<=n){y=tmp;while(y<=m) c[x][y]+=v,y+=y&-y;x+=x&-x;}}\ninline ll query(int x,int y){int tmp=y;ll res=0;while(x){y=tmp;while(y) res+=c[x][y],y&=y-1;x&=x-1;}return res;}\nvoid solve(int ql,int qr,int vl,int vr){\n\tint i;\n\tif(vl==vr){for(i=ql;i<=qr;i++) ans[q[i].id]=vl;return ;}\n\tint mid=vl+vr>>1,now1=ql,now2=0;\n\tfor(i=vl;i<=mid;i++) for(auto val:v[i]) change(val.x,val.y,-val.z);\n\tfor(i=ql;i<=qr;i++) if(query(q[i].l2,q[i].r2)-query(q[i].l2,q[i].r1-1)-query(q[i].l1-1,q[i].r2)+query(q[i].l1-1,q[i].r1-1)<q[i].b) q[now1++]=q[i];else Q[now2++]=q[i];\n\tfor(i=0;i<now2;i++) q[i+now1]=Q[i];\n\tsolve(now1,qr,mid+1,vr);\n\tfor(i=vl;i<=mid;i++) for(auto val:v[i]) change(val.x,val.y,val.z);\n\tsolve(ql,now1-1,vl,mid);\n}\nint main(){\n\tread(n),read(m);int i,j;\n\tfor(i=1;i<=n;i++) for(j=1;j<=m;j++) read(sum[i][j])+=sum[i-1][j]+sum[i][j-1]-sum[i-1][j-1];\n\tfor(i=1;i<=n;i++) for(j=1;j<=m;j++) c[i][j]=sum[i][j]-sum[i-(i&-i)][j]-sum[i][j-(j&-j)]+sum[i-(i&-i)][j-(j&-j)];\n\tint qq=read(qq);for(i=1;i<=qq;i++) read(q[i].l1),read(q[i].r1),read(q[i].l2),read(q[i].r2),read(q[i].b),q[i].id=i;\n\tint t=read(t);for(i=1;i<=t;i++){int p=read(p);while(p--){node now;read(now.x),read(now.y),read(now.z),v[i].eb(now);}}\n\tsolve(1,qq,1,t+1);for(i=1;i<=qq;i++){if(ans[i]>t) print(-1);else print(ans[i]-1);space;};\n\treturn 0;\n}\n```\n",
        "postTime": 1648125768,
        "uid": 80614,
        "name": "ZCPB",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8231"
    }
]