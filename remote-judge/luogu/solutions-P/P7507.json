[
    {
        "content": "\u8fd9\u9898\u4f7f\u7528\u4e86\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684 $\\text{trick}$ \uff0c\u4f46\u6211\u76f8\u4fe1\u5927\u90e8\u5206\u4eba\u90fd\u80fd\u60f3\u5f97\u5230\u7684\uff08\uff09\r\n\r\n## \u9898\u89e3\r\n\r\n\u4e00\u773c\u626b\u8fc7\u8be5\u9898\uff0c\u4f60\u4f1a\u53d1\u73b0\u5b83\u662f\u4e2a\u80cc\u5305\u677f\u5b50\u3002\u5148\u4e0d\u8003\u8651\u5176\u4ed6\u95ee\u9898\uff0c\u8ba9\u6211\u4eec\u60f3\u60f3\u6734\u7d20\u7684\u80cc\u5305\u505a\u6cd5\u600e\u4e48\u505a\u3002\r\n\r\n\u5982\u679c\u4f60\u63a5\u89e6\u8fc7\u5bf9\u9876\u5806\u4e00\u7c7b\u7684\u7b80\u5355\u79d1\u6280\uff0c\u4f60\u4f1a\u53d1\u73b0\u8fd9\u9898\u76f8\u5f53\u4e8e\u5c06\u4e24\u4e2a\u80cc\u5305\u95ee\u9898\u62fc\u63a5\u5728\u4e86\u4e00\u8d77\u3002\u4f60\u901a\u8fc7\u806a\u660e\u624d\u667a\u5b9e\u73b0\u4e86\u4e00\u4e2a\u80cc\u5305\u7c7b\uff0c\u7ed3\u6784\u5c31\u50cf\u662f\u4e00\u4e2a\u5806\u6808\u3002\u5b83\u652f\u6301\u5728\u9876\u90e8\u63d2\u5165\u4e00\u79cd\u7269\u54c1\uff0c\u5f39\u51fa\u9876\u90e8\u7684\u90a3\u79cd\u7269\u54c1\uff0c\u4ee5\u53ca\u5feb\u901f\u67e5\u8be2\uff0c\u4e00\u4e2a\u7a7a\u95f4\u4e3a $v_0$ \u7684\u80cc\u5305\u80fd\u88c5\u4e0b\u7684\u6700\u5927\u4ef7\u503c\u662f\u591a\u5c11\u3002\u7b80\u8981\u7684\u5b9e\u73b0\u529e\u6cd5\u5982\u4e0b\uff1a \r\n\r\n- \u7528 $dp_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u7269\u54c1\uff0c\u4f7f\u7528\u4e0d\u8d85\u8fc7 $j$ \u7684\u7a7a\u95f4\u53ef\u4ee5\u83b7\u5f97\u7684\u6700\u5927\u4ef7\u503c\u3002\r\n\r\n- \u73b0\u5728\u52a0\u5165\u4e86\u4e00\u4e2a\u7269\u54c1 $(v_i,w_i,t_i)$ ,\u8868\u793a\u5b83\u7684\u4f53\u79ef\u4e3a $v_i$ \uff0c\u4ef7\u503c\u4e3a $w_i$ \uff0c\u7c7b\u578b\u4e3a $t_i$ \uff08\u53ea\u6709\u4e00\u4e2a\uff0c\u8fd8\u662f\u6709\u65e0\u7a77\u4e2a\uff09\u3002\u90a3\u4e48\u8f6c\u79fb\u65b9\u7a0b\u5982\u4e0b\uff1a  \r\n$$dp_{u,i}=\\max\\{dp_{u-1,i},dp_{u,i},dp_{u,i-v_i}+w_i\\}$$  \r\n\u5b83\u7684\u679a\u4e3e\u987a\u5e8f\u4e0e $t_i$ \u76f8\u5173\u3002\u5176\u4e2d\uff0c $u$ \u8868\u793a\u5f53\u524d\u8fd9\u4e2a\u7269\u54c1\u5e8f\u5217\u4e2d\u6709\u591a\u5c11\u4e2a\u7269\u54c1\u3002\r\n\r\n- \u5220\u9664\u4e00\u4e2a\u7269\u54c1\u5c31\u66f4\u7b80\u5355\u4e86\uff0c\u4f60\u53ea\u9700\u8981 $u\\gets u-1$ \u5c31\u884c\u4e86\u3002\r\n\r\n\u56de\u5230\u6b63\u9898\uff0c\u4f60\u73b0\u5728\u5b9e\u73b0\u4e86\u8fd9\u6837\u7684\u80cc\u5305\u7c7b\uff0c\u7136\u540e\u5b9e\u4f8b\u5316\u4e86\u4e24\u4e2a\uff0c\u4e0d\u59a8\u79f0\u4e3a $Bag_1,Bag_2$ \u3002\u8003\u8651\u5982\u4f55\u5b8c\u6210\u9898\u76ee\u4e2d\u8981\u6c42\u7684\u4e94\u79cd\u64cd\u4f5c\u3002\u4f7f\u7528\u7c7b\u4f3c\u5bf9\u9876\u5806\u7684\u7ed3\u6784\uff0c\u4e24\u4e2a\u80cc\u5305\u7684\u9876\u7aef\u76f8\u5bf9\u3002\r\n\r\n- \u673a\u68b0\u81c2\u5411\u53f3\u79fb\u52a8\u3002\u4f60\u53ea\u8981\u5f39\u51fa $Bag_2$ \u9876\u7aef\u7684\u7269\u54c1\uff0c\u7136\u540e\u63d2\u5165\u5230 $Bag_1$ \u9876\u7aef\u5c31\u884c\u4e86\u3002\r\n\r\n- \u673a\u68b0\u81c2\u5411\u5de6\u79fb\u52a8\u3002\u4f60\u53ea\u8981\u5f39\u51fa $Bag_1$ \u9876\u7aef\u7684\u7269\u54c1\uff0c\u7136\u540e\u63d2\u5165\u5230 $Bag_2$ \u9876\u7aef\u5c31\u884c\u4e86\u3002\r\n\r\n- \u63d2\u5165\u4e00\u4e2a\u7269\u54c1\u3002\u8fd9\u4e00\u90e8\u5206\u4e5f\u5f88\u7b80\u5355\uff0c\u4f60\u76f4\u63a5\u5411 $Bag_2$ \u9876\u90e8\u63d2\u5165\u4e00\u4e2a\u7269\u54c1\u5c31\u884c\u4e86\u3002\r\n\r\n- \u5220\u9664\u4e00\u4e2a\u7269\u54c1\u3002\u4e0e\u63d2\u5165\u7269\u54c1\u7c7b\u4f3c\uff0c\u6539\u4e3a\u79fb\u9664 $Bag_2$ \u9876\u90e8\u7684\u7269\u54c1\u3002\r\n\r\n- \u4fee\u6539\u4e00\u4e2a\u7269\u54c1\u3002\u6bd4\u8f83\u7b80\u5355\u7684\u505a\u6cd5\u5c31\u662f\u76f4\u63a5\u5f39\u51fa $Bag_2$ \u9876\u90e8\uff0c\u7136\u540e\u518d\u63d2\u5165\u4e00\u4e2a\u7269\u54c1\u3002\r\n\r\n\u4f60\u5174\u81f4\u52c3\u52c3\u5730\u5b9e\u73b0\u4e86\u6240\u6709\u64cd\u4f5c\uff0c\u7136\u540e\u4f60\u53d1\u73b0\u7a7a\u95f4\u662f $\\mathcal O(vq)$ \u7684\u3002\u4e8e\u662f\u5f88\u5e78\u8fd0\u5730\uff0c\u4f60 $\\text{MLE}$ \u4e86\u3002\u4e0b\u9762\u8003\u8651\u5982\u4f55\u4f18\u5316\u8fd9\u4e2a $Bag$ \u7c7b\u3002\r\n\r\n---\r\n\r\n\u5982\u679c\u4f60\u63a5\u89e6\u8fc7\u7b80\u5355\u80cc\u5305\u95ee\u9898\uff0c\u90a3\u4e48\u4f60\u5e94\u8be5\u77e5\u9053\u6eda\u52a8\u6570\u7ec4\u4f18\u5316\u3002\u53ef\u60dc\u7684\u662f\uff0c\u8fd9\u9898\u56e0\u4e3a\u9700\u8981\u652f\u6301\u5f39\u51fa\u64cd\u4f5c\uff0c\u800c\u6eda\u52a8\u6570\u7ec4\u4f1a\u4e22\u5931\u6389\u5f88\u591a\u4fe1\u606f\uff0c\u6240\u4ee5\u6734\u7d20\u7684\u6eda\u52a8\u6570\u7ec4\u662f\u4f1a\u51fa\u9505\u7684\u3002\u4f46\u8fd9\u4e0d\u59a8\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u542f\u53d1\u3002\r\n\r\n\u6839\u636e\u67d0\u4e9b\u5947\u5999\u7684\u77e5\u8bc6\uff08~~\u6bd4\u5982\u5b66\u8fc7~~$\\sout\\text{ Splay}$\uff09\uff0c\u4f60\u5c31\u80fd\u81ea\u7136\u60f3\u5230\u628a\u53ef\u80fd\u8bbf\u95ee\u5230\u7684\u4e1c\u897f\u653e\u5728\u65c1\u8fb9\uff0c\u7528\u6765\u52a0\u901f\u5b83\u7684\u8bbf\u95ee\u901f\u5ea6\u3002\u8fd9\u9898\u4e5f\u662f\u5982\u6b64\u3002\r\n\r\n\u7531\u4e8e\u64cd\u4f5c $1,2$ \u7684\u5b58\u5728\uff0c\u4e8e\u662f\u6bcf\u6b21\u64cd\u4f5c\u7684\u4f4d\u7f6e\u90fd\u662f\u76f8\u90bb\u7684\u3002\u8003\u8651\u8bb0\u5f55 $u\\in[l,r]$ \u65f6\u7684\u6240\u6709 $dp$ \u4fe1\u606f\uff0c\u90a3\u4e48\u5f53 $u$ \u5728\u8fd9\u4e2a\u8303\u56f4\u5185\u6e38\u8d70\u65f6\u5c31\u53ef\u4ee5\u76f4\u63a5\u53d6\u51fa\u5bf9\u5e94\u7684 $dp$ \u6570\u7ec4\u4e86\u3002\u6211\u4eec\u4e0d\u80fd\u65e0\u9650\u5236\u5f00\u5927 $r-l$ \u7684\u5927\u5c0f\uff0c\u4e8e\u662f\u4e0d\u59a8\u8bbe $s=r-l$ \uff0c\u5176\u4e2d $s$ \u662f\u5e38\u6570\u3002\u8fd9\u90e8\u5206\u7a7a\u95f4\u590d\u6742\u5ea6\u662f  $\\mathcal O(vs)$ \u7684\u3002\u4e0b\u9762\u8003\u8651 $u$ \u8dc3\u51fa\u8fd9\u4e2a\u8303\u56f4\u5e94\u8be5\u5982\u4f55\u5904\u7406\u3002\r\n\r\n\u80cc\u5305\u95ee\u9898\u6709\u4e2a\u975e\u5e38\u597d\u7684\u6027\u8d28\uff0c\u5f53\u4f60\u77e5\u9053\u4e86 $dp_{u,x}(x\\in[0,v])$ \uff0c\u4ee5\u53ca\u5b83\u540e\u9762\u4e00\u4e9b\u7269\u54c1\u7684\u5c5e\u6027\uff08\u5927\u5c0f\u3001\u4ef7\u503c\uff09\uff0c\u4f60\u5c31\u80fd\u5feb\u901f\u751f\u6210 $dp_{u+1,x},dp_{u+2,x}\\cdots$ \u3002\u4e0d\u59a8\u8bb0\u5f55 $u\\equiv 0\\pmod{s'}$ \u65f6\u7684 $dp_{u,x}$ \u4f5c\u4e3a\u5173\u952e\u70b9\uff0c\u5176\u4e2d $s'$ \u662f\u5e38\u6570\u3002\u5f53 $u$ \u8de8\u51fa $[l,r]$ \u65f6\u5c31\u5bf9\u5b83\u8fdb\u884c\u8c03\u6574\uff08\u6bd4\u5982\uff0c $u<l$ \u65f6\u5c31 $l\\gets l-s',r\\gets r-s'$ \uff09\uff0c\u7136\u540e\u82b1\u8d39 $\\mathcal O(vs)$ \u7684\u65f6\u95f4\u91cd\u65b0\u751f\u6210\u8fd9\u4e00\u90e8\u5206\u7684 $dp$ \u6570\u7ec4\u3002\u4e0b\u9762\u8003\u8651\u786e\u5b9a\u8fd9\u4e9b\u5e38\u6570\u5177\u4f53\u7684\u503c\u3002\r\n\r\n\u521d\u59cb\u65f6\uff0c\u663e\u7136 $l=0,r=s$ \u3002\u6211\u4eec\u5e0c\u671b\u6bcf\u6b21\u66f4\u65b0 $l,r$ \uff0c\u90fd\u4f7f\u5f97 $u$ \u5728 $l,r$ \u7684\u4e2d\u70b9\uff0c\u8fd9\u6837\u5b50\u5230\u4e0b\u4e00\u6b21\u66f4\u65b0\u9700\u8981\u66f4\u65b0 $u$ \u7684\u6b21\u6570\u6700\u5c11\u3002\u4e8e\u662f\u4ee4 $s'=\\frac{1}{2}s$ \u3002\u6bcf\u6b21\u66f4\u65b0 $l,r$ \uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal O(vs)$ \u3002\u6700\u574f\u60c5\u51b5\u4e0b\u8981\u66f4\u65b0 $\\frac{q}{s'}$ \u6b21\uff0c\u4e8e\u662f\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal O(vq)$ \uff0c\u8fd9\u662f\u6ca1\u6709\u95ee\u9898\u7684\u3002\u5173\u952e\u70b9\u7684\u6570\u76ee\u662f $\\frac{q}{s'}$ \uff0c\u6bcf\u4e2a\u5173\u952e\u70b9\u90fd\u8981\u7ef4\u62a4 $\\mathcal O(v)$ \u7684\u7a7a\u95f4\uff0c\u8fd9\u90e8\u5206\u7a7a\u95f4\u662f $\\mathcal O(v\\cdot \\frac{q}{s'})$ \u3002\u540c\u65f6\u7ef4\u62a4 $[l,r]$ \u4e5f\u8981\u82b1\u8d39 $ \\mathcal O(vs)$ \uff0c\u6240\u4ee5\u603b\u5171\u82b1\u8d39\u7684\u7a7a\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal O(v\\cdot(\\frac{q}{s'}+s))$ \uff0c\u53d6 $s=\\sqrt{\\frac{q}{2}}$ \u53ef\u4ee5\u5f97\u5230\u6700\u5c0f\u7684\u7a7a\u95f4\u590d\u6742\u5ea6\u3002\r\n\r\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(vq)$ \uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $\\mathcal O(v\\sqrt q)$ \uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\r\n\r\n## \u53c2\u8003\u4ee3\u7801 \r\n\r\n```cpp\r\n#include<bits/stdc++.h>\r\n#define up(l,r,i) for(int i=l,END##i=r;i<=END##i;++i)\r\n#define dn(r,l,i) for(int i=r,END##i=l;i>=END##i;--i)\r\nusing namespace std;\r\ntypedef long long i64;\r\nint qread(){\r\n    int w=1,c,ret;\r\n    while((c=getchar())> '9'||c< '0') w=(c=='-'?-1:1); ret=c-'0';\r\n    while((c=getchar())>='0'&&c<='9') ret=ret*10+c-'0';\r\n    return ret*w;\r\n}\r\nconst int MAXN =2e4+3,MAXM=175+3,MAXQ=3e4+3,SI=4;\r\nint q,v,s,o;\r\nstruct Node{int x,y; bool t; Node(int _x,int _y,bool _t):x(_x),y(_y),t(_t){}};\r\nclass Bag{\r\n\tpublic:\r\n\tint t,l,r,X[MAXQ],Y[MAXQ]; bool F[MAXQ];\r\n\tint W[MAXM][MAXN],M[MAXM][MAXN];\r\n\tvoid iit(bool f){l=0,r=2*s-1;}\r\n\tvoid add(Node e){\r\n\t\t++t; int x=X[t]=e.x,y=Y[t]=e.y; bool f=F[t]=e.t;\r\n        if(t-1==r){\t//t==r+1 -> t=r-s+1\r\n            up(0,s-1,j) up(0,v,k) W[j][k]=W[j+s][k]; l+=s,r+=s;\r\n        }\r\n        up(0,v,j) W[t-l][j]=W[t-l-1][j];\r\n        if(f) up(x,v,j) W[t-l][j]=max(W[t-l][j],W[t-l][j-x]+y);\r\n        else  dn(v,x,j) W[t-l][j]=max(W[t-l][j],W[t-l][j-x]+y);\r\n\t\tif(t%s==0) up(0,v,j) M[t/s][j]=W[t-l][j];\r\n\t}\r\n\tvoid ers(){\r\n\t\t--t; if(t+1==l){\r\n        \tl-=s,r-=s; up(0,v,j) W[0][j]=M[l/s][j];\r\n        \tup(1,s-1,j){\r\n            \tint x=X[l+j],y=Y[l+j]; bool f=F[l+j];\r\n            \tup(0,v,k) W[j][k]=W[j-1][k];\r\n            \tif(f) up(x,v,k) W[j][k]=max(W[j][k],W[j][k-x]+y);\r\n        \t\telse  dn(v,x,k) W[j][k]=max(W[j][k],W[j][k-x]+y);\r\n\t\t\t}\r\n    \t}\r\n\t}\r\n\tNode bnk(){return Node(X[t],Y[t],F[t]);}\r\n\tint  val(int x){return W[t-l][x];}\r\n}B1,B2;\r\nint slv(int x){\r\n\tint r=0; up(0,x,i) r=max(r,B1.val(i)+B2.val(x-i)); return r;\r\n}\r\nint main(){\r\n\tq=qread(),v=qread(),s=1+sqrt(q+1)/2,B1.iit(1),B2.iit(0);\r\n\tup(1,q,i){\r\n    \ti64 opt=qread()^o,ti=qread()^o,vi=qread()^o,wi=qread()^o,xi=qread()^o,yi=qread()^o;\r\n    \tswitch(opt){\r\n    \t\tcase 1: B1.add(B2.bnk()),B2.ers(); break;\r\n    \t\tcase 2: B2.add(B1.bnk()),B1.ers(); break;\r\n    \t\tcase 3: B2.add(Node(vi,wi,ti)); break; case 4: B2.ers(); break;\r\n    \t\tcase 5: B2.ers(),B2.add(Node(vi,wi,ti));\r\n\t\t}\r\n\t\tprintf(\"%d\\n\",o=xi+slv(yi));\r\n\t}\r\n    return 0;\r\n}\r\n```\r\n\r\n",
        "postTime": 1616504265,
        "uid": 330759,
        "name": "\u56e7\u4ed9",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 \u3010SR2.5-T3\u3011\u3010\u672a\u6765\u6c34\u5996\u96c6\u5e02\u3011"
    }
]