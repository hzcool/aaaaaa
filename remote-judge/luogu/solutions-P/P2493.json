[
    {
        "content": "# [SDOI2011]\u8d2a\u98df\u86c7\n\n\u9053\u7406\u54b1\u90fd\u61c2\u561b\uff0c\u8fd9\u9053\u9898\u663e\u7136\u5c31\u662f\u641c\u7d22\u3002~~\u4e8e\u662f\u5c31\u6709\u52c7\u58eb\u76f4\u63a5\u4ea4\u4e86DFS\u5927\u6a21\u62df~~\u3002\n\n------------\n\u5728\u8fd9\u91cc\u5c31\u91cd\u70b9\u8bb2\u4e00\u4e0b\u72b6\u6001\u538b\u7f29\u3002\n1. \u9996\u5148\u662f\u86c7\u5f62\u6001\u7684\u9884\u5904\u7406\u3002\n\t- \u9996\u5148\u662f\u86c7\u7684\u95ee\u9898\uff0c\u786e\u5b9a\u4e00\u6761\u86c7\uff0c\u5c31\u9700\u8981\u5934\uff0c\u548c\u4e0a\u4e00\u4e2a\u8eab\u4f53\u76f8\u5bf9\u4e8e\u8fd9\u4e2a\u8eab\u4f53\u7684\u65b9\u4f4d\u3002\u663e\u7136\u53ea\u67094\u4e2a\u65b9\u5411\uff0c\u6211\u4eec\u5c31\u62ff\u4e8c\u8fdb\u5236\u72b6\u6001\u4e0b\u4e24\u4e2a\u4f4d\u6765\u8bb0\u5f55\u4e00\u4e2a\u65b9\u5411\u3002\n\t- \u53c8\u56e0\u4e3a\uff0c\u5934\u90e8\u662f\u6ca1\u6709\u201c\u4e0a\u4e00\u4e2a\u8eab\u4f53\u201d\u8fd9\u4e2a\u6982\u5ff5\u7684\uff0c\u6240\u4ee5\u4ed6\u5c31\u8bb0\u5f55\u8eab\u4f53\u7684\u957f\u5ea6\u3002\n\t- \u6211\u4eec\u53d1\u73b0\uff0c\u8eab\u957f\u662f4~7\u7684\uff0c\u6070\u597d\u56db\u4e2a\u6570\uff0c\u6211\u4eec\u5c31\u628a\u8eab\u957f\u51cf4\uff0c\u5e76\u538b\u5982\u201c\u86c7\u201d\u7684\u72b6\u6001\u4e2d\u3002\n    - \u5177\u4f53\u5148\u7b97\u51fa\u9898\u76ee\u7ed9\u51fa\u7684\u86c7\u7684\u521d\u59cb\u72b6\u6001\n    ```\n\tfor(int i=3; i>0; i--) {\n\t\t\tint k=0;\n\t\t\tif(snake[i-1][0]+dx[0]==snake[i][0]&&snake[i-1][1]+dy[0]==snake[i][1])k=0;\n\t\t\tif(snake[i-1][0]+dx[1]==snake[i][0]&&snake[i-1][1]+dy[1]==snake[i][1])k=1;\n\t\t\tif(snake[i-1][0]+dx[2]==snake[i][0]&&snake[i-1][1]+dy[2]==snake[i][1])k=2;\n\t\t\tif(snake[i-1][0]+dx[3]==snake[i][0]&&snake[i-1][1]+dy[3]==snake[i][1])k=3;\n\t\t\tq[1]=q[1]<<2|k;\n\t}\n\tq[1]<<=2;\n\t```\n    - \u5bf9\u4e8e\u6bcf\u4e00\u6b21\u86c7\u7684\u79fb\u52a8\uff0c\u6211\u4eec\u8981\u5224\u65ad\u5b83\u662f\u5426\u54ac\u5230\u81ea\u5df1\u7684\u8eab\u5b50\u3002\n    ```\n    int snake_move(int stat,int len,int k) {//\u86c7\u7684\u72b6\u6001\uff0c\u957f\u5ea6\uff0c\u79fb\u52a8\u65b9\u5411\u3002\n\t\t\tint tmp=stat;\n\t\t\tlen+=4;\n\t\t\tk^=1;//\u79fb\u52a8\u65b9\u5411\uff0c\u548c\u4e0a\u4e00\u4e2a\u8eab\u5b50\u76f8\u5bf9\u4e8e\u5934\u7684\u65b9\u5411\u76f8\u53cd\u3002\n\t\t\tint x=dx[k],y=dy[k];\n\t\t\tfor(int i=2; i<len; i++) {\n\t\t\t\tx+=dx[tmp&3];\n\t\t\t\ty+=dy[tmp&3];\n\t\t\t\ttmp>>=2;\n\t\t\t\tif(!x&&!y)return -1;\n\t\t\t}//\u5224\u65ad\u54ac\u5230\u81ea\u5df1\u3002\n\t\t\treturn (stat<<2&((1<<(len+len-2))-1))|k;\n        //stat<<2|k\u8868\u793a\u79fb\u52a8\u540e\uff0c\u5934\u76f4\u63a5\u589e\u957f\u7684\u72b6\u6001\uff0c\u56e0\u4e3a\u5982\u679c\u6ca1\u6709\u5403\u5230\u679c\u5b50\uff0c\u8eab\u4f53\u4e0d\u4f1a\u53d8\u957f\u3002\u6240\u4ee5\u8981\u52a0len\u9650\u5236\u3002\n\t}\n    ```\n    - \u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u9700\u8981\u79bb\u6563\u5316\u72b6\u6001\uff0c\u5e76\u8bb0\u5f55\u4e0b\u6765\u3002\u5e76\u5206\u51fa11\u4f4d\u4e8c\u8fdb\u5236\u4f4d\u4fdd\u5b58\u72b6\u6001\u3002\n    - \u5bf9\u4e8e\u666e\u901a\u7684\u79fb\u52a8\u3002\n    ```\n\tfor(int k=0; k<4; k++) {\n\t\t\tint stat1=snake_move(stat0,len0,k);\n\t\t\tif(stat1>=0) {\n\t\t\t\tint s1=stat1<<2|len0;\n\t\t\t\tif(!number[s1])q[++r]=s1,number[s1]=r;//\u79bb\u6563\u5316\u8bb0\u5f55\u3002\n\t\t\t\ts[l][k]=number[s1];//\u79bb\u6563\u5316\u540e\u7684\u72b6\u6001l\u5411k\u722c\uff0c\u5f97\u5230\u7684\u79bb\u6563\u5316\u540e\u7684\u72b6\u6001\u3002\n\t\t\t}\n\t}\n    ```\n    - \u5403\u5230\u679c\u5b50\u7684\u540c\u7406\u3002\n    ```\n    for(int k=0; k<4; k++) {\n\t\t\tint stat1=snake_move(stat0,len0+1,k);\n\t\t\tif(stat1>=0) {\n\t\t\t\tif(len0<3) {\n\t\t\t\t\tint s1=stat1<<2|(len0+1);\n\t\t\t\t\tif(!number[s1])q[++r]=s1,number[s1]=r;\n\t\t\t\t\tfs[l][k]=number[s1];\n\t\t\t\t} else fs[l][k]=0;\n\t\t\t}\n\t}\n    ```\n1. \u5904\u7406\u5b8c\u86c7\u7684\u5f62\u6001\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u8981\u5f00\u59cb\u771f\u6b63\u7684\u641c\u7d22\u4e86\u3002\n\t- \u5148\u8bf4\u4e00\u4e0b\u9700\u8981\u8bb0\u5f55\u7684\u72b6\u6001\u3002\n\t\t- \u5934\u7684\u5750\u6807\uff1a\u6a2a\u7eb5\u51718\u4f4d\n\t\t- \u86c7\u7684\u5f62\u6001\uff1a11\u4f4d\n\t\t- \u98df\u7269\u72b6\u6001\uff1a4\u4f4d\n\t\t- \u8017\u8d39\u7684\u65f6\u95f4\uff1a3\u4f4d\n    ```\n    int make_stat(int x,int y,int ss,int fs,int wt) {\n\t\t\t\treturn (x<<22)|(y<<18)|(ss<<7)|(fs<<3)|wt;\n\t}\n\tvoid get_stat(int &x,int &y,int &ss,int &fs,int &wt,int val) {\n\t\t\t\tx=val>>22&0xf;\n\t\t\t\ty=val>>18&0xf;\n\t\t\t\tss=val>>7&0x7ff;\n\t\t\t\tfs=val>>3&0xf;\n\t\t\t\twt=val&7;\n\t}\n    ```\n    - \u90a3\u4e48\uff0c\u5728BFS\u904d\u5386\u961f\u5217\u7684\u65f6\u5019\u3002\n        - \u4e00\u822c\u7684\u8f6c\u79fb\uff1a\n        ```\n        for(int k=0; k<4; k++) {\n\t\t\t\tint x1=x0+dx[k],y1=y0+dy[k],stat1=s[stat0][k],fstat1=fstat0,wt1=abs(mp[x1][y1]-mp[x0][y0]);\n\t\t\t\tif(!mp[x1][y1])continue;\n\t\t\t\tif(fmp[x1][y1]&&(fstat1&1<<(fmp[x1][y1]-1))) {\n\t\t\t\t\tfstat1^=1<<(fmp[x1][y1]-1);\n\t\t\t\t\tstat1=fs[stat0][k];\n\t\t\t\t} else stat1=s[stat0][k];\n\t\t\t\tif(stat1>=0) {\n\t\t\t\t\tint s1=make_stat(x1,y1,stat1,fstat1,wt1);\n\t\t\t\t\tif(!(vst[s1>>3]&1<<wt1)) {\n\t\t\t\t\t\tvst[s1>>3]|=1<<wt1;\n\t\t\t\t\t\tq[++r]=s1;\n\t\t\t\t\t\tp[r]=l;//\u8bb0\u5f55\u7531\u8c01\u8f6c\u79fb\uff0c\u540e\u8981\u7edf\u8ba1\u7b54\u6848\u3002\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n        ```\n        - \u7279\u522b\u7684\uff0c\u56e0\u4e3a\u662fBFS\uff0c\u4e3a\u4fdd\u8bc1\u8bb0\u5fc6\u5316\u590d\u6742\u5ea6\u6240\u4ee5\u65f6\u95f4\u5fc5\u987b\u4e25\u683c\u975e\u51cf\uff0c\u5bf9\u4e8e\u4efb\u610f\u4e24\u683c\u4e4b\u95f4\u7684\u8f6c\u79fb\u65f6\u95f4\uff0c\u6211\u4eec\u5f97\u4e00\u4e2a\u4e00\u4e2a\u5355\u4f4d\u7684\u7b49\u3002\n        ```\n        if(wt0) {\n\t\t\t\tint s1=make_stat(x0,y0,stat0,fstat0,wt0-1);\n\t\t\t\tif(!(vst[s1>>3]&1<<(wt0-1))) {\n\t\t\t\t\tvst[s1>>3]|=1<<(wt0-1);\n\t\t\t\t\tq[++r]=s1;\n\t\t\t\t\tp[r]=l;\n\t\t\t\t}\n\t\t}\n        ```\n    \t- \u8fb9\u754c\u6761\u4ef6:\u98df\u7269\u5403\u5b8c\u4e86\uff0c\u800c\u4e14\u5230\u8fbe\u4e86\u7ec8\u70b9\u3002\n    \t```\n        if(!fstat0&&!wt0) {\n\t\t\t\tansl=l;//\u8bb0\u5f55\u6700\u7ec8\u7b54\u6848\u3002\n\t\t\t\tbreak;\n\t\t}\n    \t```\n\u6709\u4e86\u6700\u7ec8\u7b54\u6848\u548c\u6bcf\u4e00\u6b21\u64cd\u4f5c\u662f\u7531\u8c01\u8f6c\u79fb\u7684\u8bb0\u5f55\uff0c\u5c31\u5012\u7740\u626b\u4e00\u904d\u7edf\u8ba1\u5c31\u884c\u4e86\u3002",
        "postTime": 1589875730,
        "uid": 27338,
        "name": "jerry3128",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P2493 \u3010[SDOI2011]\u8d2a\u98df\u86c7\u3011"
    }
]