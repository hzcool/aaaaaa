[
    {
        "content": "### \u9898\u610f\n\n\u9898\u9762\u5199\u7684\u975e\u5e38\u6e05\u6670\uff0c\u4e0d\u89e3\u91ca\uff0c\u6446\u6570\u636e\u8303\u56f4\u592a\u9ebb\u70e6\n\n### \u9898\u89e3\n\n\u6c38\u8fdc\u6ef4\u795e EA \u7684\u9898\u89e3\u53ef\u80fd\u542b\u6709\u4e00\u70b9\u9519\u8bef\uff0c\u5199\u4e00\u4e2a\u81f3\u5c11\u770b\u4e0a\u53bb\u6bd4\u8f83\u5bf9\u7684\u5b98\u65b9\u9898\u89e3\u3002\n\n\u65e5\u5e38\u7ed9\u5927\u5bb6\u63a8\u8350 M2U \u7684\u6b4c\u5462/cy\n\n\u9996\u5148\u76f4\u63a5\u8bc1\u660e\u7ed3\u8bba\uff0c\u6d88\u5143\u540e\u7684 $A_{i,j}$ \u53ef\u4ee5\u8868\u793a\u6210\n\n$$\nA^\\prime_{i,j}=\n\\begin{cases}\nij\\varphi(i),&i\\mid j\n\\\\\n0,&i\\nmid j\n\\end{cases}\n$$\n\n\u8003\u8651\u5229\u7528\u4e00\u4e0b\u9ad8\u65af\u6d88\u5143\u7684\u6027\u8d28\uff08~~\u7ebf\u6027\u4ee3\u6570\u5e38\u8bc6~~\uff09\u63d0\u51fa\u6bcf\u884c\u6bcf\u5217\u7684 $i$ \u548c $j$\uff0c\u6784\u9020\u65b0\u7684\u77e9\u9635 $B_{i,j}=\\gcd(i,j)$\uff0c\u90a3\u4e48\u6d88\u5143\u540e\u7684 $B_{i,j}$ \u4e3a\n\n$$\nB^\\prime_{i,j}=\n\\begin{cases}\n\\varphi(i),&i\\mid j\n\\\\\n0,&i\\nmid j\n\\end{cases}\n$$\n\n\u8fd9\u4e2a\u662f $200$ \u5e74\u524d\u67d0\u7bc7\u8bba\u6587\u7684\u7814\u7a76\u6210\u679c\uff0c\u8fd9\u91cc\u7b80\u8981\u7684\u7ed9\u5927\u5bb6\u8bc1\u660e\u4e00\u4e0b\u3002\n\n\u8003\u8651\u6570\u5b66\u5f52\u7eb3\u6cd5\u3002\n\n\u7531\u4e8e\u4e0a\u8ff0\u7ed3\u8bba\u5728 $1$ \u5230 $n-1$ \u884c\u6210\u7acb\uff0c\u8003\u8651\u7b2c $n$ \u884c\uff0c\u6ce8\u610f\u5230\u53ea\u6709 $n$ \u7684\u7ea6\u6570\u884c\u624d\u4f1a\u7ed9 $n$ \u5e26\u6765\u8d21\u732e\uff0c\u4e8e\u662f\u6211\u4eec\u5f97\u5230\n\n$$B^\\prime_{n,k}=B_{n,k}-\\sum\\limits_{d\\mid n,d<n}\\varphi(d)$$\n\n\u8ba8\u8bba\u4e00\u4e0b\uff0c\u5f53 $n\\nmid k$ \u7684\u65f6\u5019\uff0c$B_{n,k}=\\gcd(n,k)$\n\n\u6b64\u65f6\u6ce8\u610f\u5230 $\\gcd(n,k)\\mid n$\uff0c\u6240\u4ee5 $B_{\\gcd(n,k),k}$ \u4e00\u5b9a\u4f1a\u7ed9 $B_{n,k}$ \u5e26\u6765\u7684\u8d21\u732e\uff0c\u5e76\u4e14\u7cfb\u6570\u4e3a $1$\u3002\n\n\u5bf9\u4e8e $\\gcd(n,k)$ \u524d\u9762\u7684\u4e00\u4e9b\u884c\u6570\u7ed9 $B^\\prime_{n,k}$ \u548c $B^\\prime_{\\gcd(n,k),k}$ \u5e26\u6765\u76f8\u540c\u7684\u8d21\u732e\uff0c\u6240\u4ee5\u6d88\u5143\u5230\u7b2c $\\gcd(n,k)-1$ \u884c\u7684\u65f6\u5019\u6709 $B^\\prime_{n,k}=B^\\prime_{\\gcd(n,k),k}$\u3002\n\n\u4e8e\u662f\u7b2c $\\gcd(n,k)$ \u884c\u5411\u7b2c $n$ \u884c\u8d21\u732e\u5b8c\u4e4b\u540e $B^\\prime_{n,k}$ \u5c31\u4e3a $0$\u3002\n\n\u5426\u5219\u8003\u8651\u8fd9\u6837\u4e00\u4e2a\u4e8b\u5b9e\uff0c\u6bcf\u4e00\u884c\u6d88\u5143\u7ed3\u675f\u7684\u65f6\u5019\u90fd\u6709 $B^\\prime_{n,k}=B^\\prime_{n,n}$\n\n\u6240\u4ee5\u6839\u636e\u4e0a\u5f0f\uff0c\u5f97\u5230\n\n$$B^\\prime_{n,k}=B^\\prime_{n,n}=n-\\sum\\limits_{d\\mid n,d<n}\\varphi(d)=n+\\varphi(n)-\\sum\\limits_{d\\mid n}\\varphi(d)$$\n\n\u4e8e\u662f\u6839\u636e\u72c4\u5229\u514b\u96f7\u5377\u79ef\u7684\u57fa\u672c\u516c\u5f0f\u5f97\u5230\n\n$$B^\\prime_{n,k}=\\varphi(n)$$\n\n\u540c\u65f6\u8be5\u7ed3\u8bba\u5728\u7b2c\u4e00\u884c\u4e5f\u6210\u7acb\uff0c\u4e8e\u662f\u7ed3\u8bba\u5c31\u5bf9\u4efb\u4f55\u60c5\u51b5\u4e0b\u90fd\u6210\u7acb\u4e86\u3002\n\n\u7136\u540e\u6211\u4eec\u6765\u8003\u8651\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u3002\n\n$1$ \u64cd\u4f5c\u524d\u7684 $2$ \u64cd\u4f5c\u7b54\u6848\u4e3a $ij\\gcd(i,j)$\uff0c$1$ \u64cd\u4f5c\u540e\u7684 $2$ \u64cd\u4f5c\u6839\u636e\u8fd9\u4e2a\u7ed3\u8bba\u6765\u5c31\u597d\u4e86\u3002\n\n$1$ \u64cd\u4f5c\u524d\u7684 $3$ \u64cd\u4f5c\u662f P3768\uff0c\u4e5f\u5c31\u662f\u8ba9\u6211\u4eec\u6c42\u8fd9\u4e2a\u4e1c\u897f\uff08\u4e3a\u4e86\u590d\u4e60\u83ab\u6bd4\u4e4c\u65af\u53cd\u6f14\u5c31\u628a\u8fc7\u7a0b\u5199\u5728\u8fd9\u91cc\uff09\n\n$$\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}ij\\gcd(i,j)$$\n\n\u679a\u4e3e $\\gcd$ \u5e76\u4e14\u63d0\u51fa\u6765\u5f97\u5230\n\n$$\\sum\\limits_{d=1}^{n}d^3\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}ij[\\gcd(i,j)=1]$$\n\n\u540e\u9762\u662f\u5957\u8def\u53cd\u6f14\n\n$$\\sum\\limits_{d=1}^{n}d^3\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}ij\\sum\\limits_{x\\mid\\gcd(i,j)}\\mu(x)$$\n\n\u63d0\u51fa\u6765\u4e00\u4e0b\u4ec0\u4e48\u7684\n\n$$\\sum\\limits_{d=1}^{n}d^3\\sum\\limits_{x=1}^{\\lfloor\\frac{n}{d}\\rfloor}x^2\\mu(x)\\left(\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{xd}\\rfloor}i\\right)^2$$\n\n\u6211\u4eec\u8bbe $f(n)=\\left(\\sum\\limits_{i=1}^{n}i\\right)^2$\uff0c\u5219\u6709\n\n$$\\sum\\limits_{d=1}^{n}d\\sum\\limits_{x=1}^{\\lfloor\\frac{n}{d}\\rfloor}(xd)^2\\mu(x)f(\\lfloor\\frac{n}{xd}\\rfloor)$$\n\n\u63a5\u4e0b\u6765\u8bb0 $T=xd$\uff0c\u5f97\u5230\n\n$$\\sum\\limits_{T}^{n}T^2f(\\lfloor\\frac{n}{T}\\rfloor)\\sum\\limits_{d\\mid T}d\\mu(\\frac{T}{d})$$\n\n\u53f3\u8fb9\u662f $id$ \u4e0e $\\mu$ \u7684\u72c4\u5229\u514b\u96f7\u5377\u79ef\uff0c\u6240\u4ee5\u7b54\u6848\u4e3a\n\n$$\\sum\\limits_{T}^{n}T^2f(\\lfloor\\frac{n}{T}\\rfloor)\\varphi(T)$$\n\n\u8fd9\u4e2a\u53ef\u4ee5\u6574\u9664\u5206\u5757\u548c\u675c\u6559\u7b5b\u641e\u5b9a\u3002\n\n\u7136\u540e $1$ \u64cd\u4f5c\u540e\u7684 $3$ \u64cd\u4f5c\uff0c\u8003\u8651\u4e00\u5217\u4e00\u5217\u7684\u641e\uff0c\u8bbe $g(n)$ \u4e3a\u7b2c $n$ \u5217\u7684\u7b54\u6848\uff0c\u5f97\u5230\n\n$$g(n)=n\\sum\\limits_{d\\mid n}d\\varphi(d)$$\n\n\u8bbe $h(n)=\\sum\\limits_{d\\mid n}d\\varphi(d)$\uff0c\u5bf9\u4e8e\u8d28\u6570 $p$ \u548c\u6b63\u6574\u6570 $k$ \u6211\u4eec\u6709\n\n$$h(p^k)=\\sum\\limits_{i=0}^{k}p^i\\varphi(p^i)=\\frac{p^{2k+1}+1}{p+1}$$\n\n\u7136\u540e\u901a\u8fc7\u5bf9 $n$ \u8d28\u56e0\u6570\u5206\u89e3\u53ef\u4ee5\u8bc1\u660e $h(n)$ \u662f\u79ef\u6027\u51fd\u6570\uff0c\u4e8e\u662f\u7ebf\u6027\u7b5b\u5373\u53ef\u3002\n\n\u884c\u5217\u5f0f\u7684\u8bdd\u7b54\u6848\u4e3a $(n!)^2\\prod\\limits_{i=1}^{n}\\varphi(i)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef int ll;\ntypedef long long int li;\nconst ll MAXN=5e6+51,MOD=998244353,INV6=166374059,INV4=748683265;\nunordered_map<ll,ll>resP;\nll n,op,gauss,ptot;\nli x,y;\nll prime[348521],phi[MAXN],np[MAXN],p[MAXN],low[MAXN],f[MAXN];\nll invPr[348521],prefixF[MAXN],prod[MAXN];\ninline li read()\n{\n    register li num=0,neg=1;\n    register char ch=getchar();\n    while(!isdigit(ch)&&ch!='-')\n    {\n        ch=getchar();\n    }\n    if(ch=='-')\n    {\n        neg=-1;\n        ch=getchar();\n    }\n    while(isdigit(ch))\n    {\n        num=(num<<3)+(num<<1)+(ch-'0');\n        ch=getchar();\n    }\n    return num*neg;\n} \ninline ll qpow(ll base,ll exponent)\n{\n    ll res=1;\n    while(exponent)\n    {\n        if(exponent&1)\n        {\n            res=(li)res*base%MOD;\n        }\n        base=(li)base*base%MOD,exponent>>=1;\n    }\n    return res;\n}\ninline void sieve(ll limit)\n{\n\tll pp;\n\tphi[1]=f[1]=prod[0]=1;\n\tfor(register int i=2;i<=limit;i++)\n\t{\n\t\tif(!np[i])\n\t\t{\n\t\t\tlow[i]=prime[++ptot]=i,phi[i]=i-1,f[i]=((li)i*i%MOD-i+1+MOD)%MOD;\n\t\t\tinvPr[ptot]=qpow(prime[ptot]+1,MOD-2);\n\t\t}\n\t\tfor(register int j=1;j<=ptot&&prime[j]*i<=limit;j++)\n\t\t{\n\t\t\tnp[prime[j]*i]=1;\n\t\t\tif(!(i%prime[j]))\n\t\t\t{\n\t\t\t\tlow[i*prime[j]]=low[i]*prime[j];\n\t\t\t\tphi[i*prime[j]]=phi[i]*prime[j];\n\t\t\t\tif(low[i]==i)\n\t\t\t\t{\n\t\t\t\t\tpp=i*prime[j];\n\t\t\t\t\tf[pp]=(li)((li)pp*pp%MOD*prime[j]%MOD+1)*invPr[j]%MOD;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tf[i*prime[j]]=(li)f[i/low[i]]*f[low[i]*prime[j]]%MOD;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tlow[i*prime[j]]=prime[j],f[i*prime[j]]=(li)f[i]*f[prime[j]]%MOD;\n\t\t\tphi[i*prime[j]]=phi[i]*phi[prime[j]];\n\t\t}\n\t}\n\tfor(register int i=1;i<=limit;i++)\n\t{\n\t\tp[i]=(p[i-1]+(li)i*i%MOD*phi[i]%MOD)%MOD;\n\t\tprefixF[i]=(prefixF[i-1]+(li)i*f[i]%MOD)%MOD;\n\t\tprod[i]=(li)prod[i-1]*i%MOD*i%MOD*phi[i]%MOD;\n\t}\n}\ninline ll calc2(ll x)\n{\n\treturn (li)x*(x+1)%MOD*(2*x+1)%MOD*INV6%MOD;\n}\ninline ll calc3(ll x)\n{\n\treturn (li)x*(x+1)%MOD*x%MOD*(x+1)%MOD*INV4%MOD;\n}\ninline ll prefixP(ll num)\n{\n\tif(num<=5e6)\n\t{\n\t\treturn p[num];\n\t}\n\tif(resP[num])\n\t{\n\t\treturn resP[num];\n\t}\n\tll res=calc3(num);\n\tfor(register int l=2,r;l<=num;l=r+1)\n\t{\n\t\tr=num/(num/l);\n\t\tres=(res-(li)prefixP(num/l)*(calc2(r)-calc2(l-1)+MOD)%MOD+MOD)%MOD;\n\t}\n\treturn resP[num]=res;\n}\ninline ll calc(ll num)\n{\n\tll res=0;\n\tfor(register int l=1,r;l<=num;l=r+1)\n\t{\n\t\tr=num/(num/l);\n\t\tres=(res+(li)calc3(num/l)*(prefixP(r)-prefixP(l-1)+MOD)%MOD)%MOD;\n\t}\n\treturn res;\n}\ninline ll getPhi(ll x)\n{\n\tll res=x;\n\tfor(register int i=2;i<=sqrt(x);i++)\n\t{\n\t\tif(x%i==0)\n\t\t{\n\t\t\tres=res/i*(i-1);\n\t\t\twhile(x%i==0)\n\t\t\t{\n\t\t\t\tx/=i;\n\t\t\t}\n\t\t}\n\t}\n\tif(x!=1)\n\t{\n\t\tres=res/x*(x-1);\n\t}\n\treturn res;\n}\nint main()\n{\n\tsieve(5000010),n=read();\n\tfor(register int i=0;i<n;i++)\n\t{\n\t\top=read();\n\t\tif(op==1)\n\t\t{\n\t\t\tgauss=1;\n\t\t}\n\t\tif(op==2)\n\t\t{\n\t\t\tx=read(),y=read();\n\t\t\tif(gauss)\n\t\t\t{\n\t\t\t\tprintf(\"%lld\\n\",y%x?0:(li)x*y%MOD*getPhi(x)%MOD);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tprintf(\"%lld\\n\",(li)(x%MOD)*(y%MOD)%MOD*(__gcd(x,y)%MOD)%MOD);\n\t\t\t}\n\t\t}\n\t\tif(op==3)\n\t\t{\n\t\t\tx=read();\n\t\t\tif(gauss)\n\t\t\t{\n\t\t\t\tprintf(\"%d\\n\",prefixF[x]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tprintf(\"%d\\n\",calc(x));\n\t\t\t}\n\t\t}\n\t\tif(op==4)\n\t\t{\n\t\t\tx=read();\n\t\t\tprintf(\"%d\\n\",prod[x]);\n\t\t}\n\t}\n}\n```",
        "postTime": 1586957545,
        "uid": 60990,
        "name": "Karry5307",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P6384 \u3010\u300eMdOI R2\u300fQuo Vadis\u3011"
    },
    {
        "content": "\n### \u9898\u89e3\u533a\u7684\u591a\u884c\u516c\u5f0f\u6302\u4e86\uff0c\u8bf7\u70b9\u535a\u5ba2\u67e5\u770b\n\n\u5361\u591a\u9879\u7684\u5b98\u65b9\u9898\u89e3\u7b80\u76f4\u4e0d\u662f\u4eba\u770b\u7684\uff0c\u5199\u4e2a\u4eba\u80fd\u770b\u7684\u9898\u89e3\u3002\n\n## \u7ed3\u8bba\n\n\u9996\u5148\u4f60\u8981\u77e5\u9053 $\\sum_{d \\mid i} \\varphi(d) = i$\u3002\n\n\u6211\u4eec\u9996\u5148\u65ad\u8a00\uff0c\u5bf9\u4e8e\u77e9\u9635 $A$ \u6ee1\u8db3 $A_{i,j}=\\gcd(i,j)$\uff0c\u5728\u8fdb\u884c\u6d88\u5143\u4e4b\u540e\uff0c\u6709\n\n $A'_{i,j} = \\left\\{\n\t\t\t\\begin{aligned}\n\t\t\t \\varphi(i), i \\mid j\\\\\n\t\t\t0, i \\nmid j\\\\\n\t\t\t\\end{aligned}\n\t\t\t\\right.$\n\n\u8003\u8651\u8fd9\u6837\u8fdb\u884c\u6d88\u5143\uff1a\u5728\u7b2c $i$ \u6b21\u53d8\u6362\u4e2d\uff0c\u5c06\u7b2c $2i, 3i \\ldots ki$ \u884c\u51cf\u53bb\u7b2c $i$ \u884c\u3002\n\n\u6211\u4eec\u4f7f\u7528\u6570\u5b66\u5f52\u7eb3\u6cd5\uff0c\u8bc1\u660e\u8fd9\u4e00\u7ed3\u8bba\u5bf9\u524d $n$ \u884c\u6210\u7acb\u3002\n\n\u5047\u8bbe\u5bf9\u4e8e\u524d $i-1$ \u884c\uff0c\u8fd9\u4e00\u7ed3\u8bba\u6210\u7acb\u3002\n\n\u6211\u4eec\u8003\u8651\u524d $i-1$ \u884c\u5bf9 $A_{i,j}$ \u7684\u8d21\u732e\uff0c\u7b2c $i$ \u884c\u51cf\u53bb\u8fc7 $k$ \u884c\uff0c\u5f53\u4e14\u4ec5\u5f53 $k \\mid i$\u3002\u540c\u65f6\uff0c$A'_{k,j} \\neq 0$ \u5f53\u4e14\u4ec5\u5f53 $k \\mid j$\u3002\u7efc\u4e0a\u53ef\u5f97\uff0c$A'_{i,j} = \\gcd(i,j) - \\sum_{d \\mid \\gcd(i,j), d < i} \\varphi(d)$\n\n\u5f53 $\\gcd(i,j) \\neq i$ \u65f6\uff0c$\\sum_{d \\mid \\gcd(i,j), d < i} \\varphi(d) = \\sum_{d \\mid \\gcd(i,j)} \\varphi(d) = \\gcd(i,j)$\uff0c\u5373 $A'_{i,j} = 0$\u3002\n\n\u5426\u5219\uff0c$\\sum_{d \\mid \\gcd(i,j), d < i} \\varphi(d) = \\sum_{d \\mid \\gcd(i,j)} \\varphi(d) - \\varphi(i) = \\gcd(i,j)-\\varphi(i)$\uff0c\u5373 $A'_{i,j} = \\varphi(i)$\u3002\n\n\u6613\u77e5\uff0c$\\gcd(i,j) = i$ \u5f53\u4e14\u4ec5\u5f53 $i \\mid j$\u3002\u540c\u65f6\uff0c\u8fd9\u4e5f\u8bc1\u660e\u4e86\u6d88\u5143\u540e\u7684 $A'$ \u662f\u4e00\u4e2a\u4e0a\u4e09\u89d2\u77e9\u9635\u3002\n\n\u7efc\u4e0a\uff0c\u8be5\u7ed3\u8bba\u5bf9\u7b2c $i$ \u884c\u6210\u7acb\u3002\n\t\n\u82e5\u8981\u53d8\u6362\u4e3a\u672c\u9898\u4e2d\u7684\u60c5\u51b5\uff0c\u4f7f\u7528\u500d\u6cd5\u53d8\u6362\uff0c\u5c06\u7b2c $i$ \u884c\u7684\u6240\u6709\u5143\u7d20\u9664\u4ee5 $i$\uff0c\u7b2c $j$ \u5217\u7684\u6240\u6709\u5143\u7d20\u9664\u4ee5 $j$\uff0c\u5373\u5f97\u5230\u524d\u9762\u6240\u8bf4\u7684\u60c5\u51b5\u3002\u5728\u6309\u4e0a\u4e00\u90e8\u5206\u7684\u505a\u6cd5\u6d88\u5143\u4e4b\u540e\uff0c\u518d\u9006\u53d8\u6362\u56de\u6765\u5373\u53ef\u3002\u5373\uff0c\u5bf9\u4e8e\u77e9\u9635 $A$ \u6ee1\u8db3 $A_{i,j}=ij\\gcd(i,j)$\uff0c\u5728\u8fdb\u884c\u6d88\u5143\u4e4b\u540e\uff0c\u6709\n\n$A'_{i,j} = \\left\\{\n\t\t\t\\begin{aligned}\n\t\t\tij\\varphi(i), i \\mid j\\\\\n\t\t\t0, i \\nmid j\\\\\n\t\t\t\\end{aligned}\n\t\t\t\\right.$\n\n## \u505a\u6cd5\n\n### \u6d88\u5143\u524d\n\n\u5bf9\u4e8e $2$ \u64cd\u4f5c\uff0c\u8f93\u51fa $\\gcd(i,j)$\u3002\n\n\u5bf9\u4e8e $3$ \u64cd\u4f5c\uff0c\u5373\u6c42 $\\sum_{i=1}^n \\sum_{j=1}^n ij\\gcd(i,j)$\u3002\u4f7f\u7528 $\\varphi$ \u53cd\u6f14\n\n$\\sum_{i=1}^n \\sum_{j=1}^n ij\\gcd(i,j) $\n\n$= \\sum_{i=1}^n \\sum_{j=1}^n \\sum_{d \\mid \\gcd(i,j)} \\varphi(d) $\n    \n$= \\sum_{d=1}^n \\varphi(i) \\sum_{d \\mid i} \\sum_{d \\mid j} ij $\n\n$= \\sum_{d=1}^n \\varphi(i) \\cdot d^2 \\cdot  (\\sum_{i=1}^{\\lfloor \\frac{n}{d} \\rfloor})^2$\n    \n\u6574\u9664\u5206\u5757\uff0c\u4f7f\u7528\u4e9a\u7ebf\u6027\u7b5b\u6cd5\uff08\u4f8b\u5982\u675c\u6559\u7b5b\uff09\u7b5b\u51fa $i^2 \\varphi(i)$ \u7684\u524d\u7f00\u548c\u5373\u53ef\u3002\n\n\u5bf9\u4e8e $4$ \u64cd\u4f5c\uff0c\u884c\u5217\u5f0f\u5373\u6d88\u5143\u540e\u4e3b\u5bf9\u89d2\u7ebf\u4e0a\u5143\u7d20\u4e58\u79ef\uff0c\u5373 $\\prod_{i=1}^n i^2 \\varphi(i)$\n\n### \u6d88\u5143\u540e\n\n\u64cd\u4f5c $2$ \u5373\u6309\u7ed9\u51fa\u7ed3\u8bba\u8f93\u51fa\u5373\u53ef\u3002\n\n\u5bf9\u4e8e\u64cd\u4f5c $3$\uff0c\u8bbe $f(i) = \\sum_{d \\mid i} d \\varphi(d)$\uff0c\u6240\u6c42\u5373 $\\sum_{i=1}^n i \\cdot f(i)$\u3002\n\n\u4e0d\u96be\u53d1\u73b0 $f$ \u4e3a\u79ef\u6027\u51fd\u6570\uff0c\u8003\u8651\u5982\u4f55\u5728 $p^k$ \u5904\u5feb\u901f\u8ba1\u7b97\u3002\u6709 $f(p^k) = \\sum_{i=1}^k p^i \\varphi(p^i) + 1$\n\n\u5316\u7b80\u4e00\u4e0b\uff0c\u5f97\u5230 $\\sum_{i=1}^k p^{2i-1}(p-1)+1$\uff0c\u4e0d\u96be\u5c06\u6b64\u5199\u4e3a\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u7684\u5f62\u5f0f\uff0c\u6700\u540e\u7684\u7ed3\u679c\u662f $\\frac{p^{2k+1}+1}{p+1}$\u3002\u4f7f\u7528\u7ebf\u6027\u7b5b\u6c42\u89e3 $f$ \u5373\u53ef\uff0c\u5bf9\u4e8e\u66f4\u5927\u7684\u6570\u636e\u8303\u56f4\uff0c\u53ef\u4ee5\u4f7f\u7528 min25 \u7b5b\u8fdb\u884c\u8ba1\u7b97\uff0c\u4e0d\u8fc7\u8fd9\u4e0d\u5728\u672c\u9898\u8003\u5bdf\u8303\u56f4\u5185\u3002\n",
        "postTime": 1586951552,
        "uid": 48355,
        "name": "EternalAlexander",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P6384 \u3010\u300eMdOI R2\u300fQuo Vadis\u3011"
    },
    {
        "content": "[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://blog.csdn.net/qq_46258139/article/details/122084436)\n\n\n## \u9898\u76ee\u5927\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a **\u65e0\u9650\u5927** \u7684\u77e9\u9635 $A$\uff0c\u5176\u4e2d $A_{i,j}=ij\\gcd(i,j)$\u3002\n\n\u63a5\u4e0b\u6765\u6709 $m$ \u4e2a\u64cd\u4f5c\uff0c\u6bcf\u884c $1$ \u81f3 $3$ \u4e2a\u6574\u6570\uff0c\u610f\u4e49\u5982\u4e0b\uff1a\n\n* $1$\uff1a\u5bf9\u77e9\u9635 $A$ \u8fdb\u884c\u9ad8\u65af\u6d88\u5143\uff0c\u4f7f\u4e4b\u6210\u4e3a\u4e00\u4e2a\u4e0a\u4e09\u89d2\u77e9\u9635\u3002\uff08**\u6ce8\u610f**\uff1a\u8fd9\u91cc\uff0c\u9ad8\u65af\u6d88\u5143\u4e2d\u53ea\u5141\u8bb8\u5c06\u4e00\u884c\u7684\u67d0\u4e00\u4e2a\u500d\u6570\u52a0\u5230\u53e6\u4e00\u884c\u4e0a\uff0c\u4e0d\u5141\u8bb8\u4ea4\u6362\u4efb\u610f\u4e24\u884c\uff0c\u4e0d\u5141\u8bb8\u5c06\u67d0\u884c\u4e58\u4e0a\u4e00\u4e2a\u500d\u6570\uff0c\u4fdd\u8bc1\u8fd9\u6837\u4e4b\u540e\u4ecd\u7136\u53ef\u4ee5\u5f97\u5230\u4e0a\u4e09\u89d2\u77e9\u9635\uff0c\u5e76\u4e14\u4fdd\u8bc1\u6d88\u5143\u4e4b\u540e\u7684\u77e9\u9635\u7684\u6bcf\u4e2a\u5143\u7d20\u5747\u4e3a\u975e\u8d1f\u6574\u6570\u3002\uff09\n* $2\\ x\\ y$\uff1a\u6c42\u51fa\u5f53\u524d\u77e9\u9635\u7684 $A_{x,y}$\u3002\n* $3\\ x$\uff1a\u6c42\u51fa $\\sum\\limits_{i=1}^{x}\\sum\\limits_{j=1}^{x}A_{i,j}$\u3002\n* $4\\ x$\uff1a\u8bbe $B$ \u662f\u4e00\u4e2a $x$ \u9636\u77e9\u9635\uff0c\u5176\u4e2d $B_{i,j}=A_{i,j}$\uff0c\u4f60\u9700\u8981\u6c42\u51fa $\\det B$\u3002\n\n**\u4e0a\u8ff0\u6240\u6709\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21**\u3002\n\n## \u89e3\u9898\u601d\u8def\n\n\u9996\u5148\uff0c\u5bf9\u4e8e\u77e9\u9635 $A$ \u6ee1\u8db3 $A_{i,j}=i j \\gcd(i,j)$\uff0c\u5728\u8fdb\u884c\u9ad8\u65af\u6d88\u5143\u540e\uff0c\u6709\uff1a\n$$\nA'_{i,j}=\\begin{cases}i j \\varphi(i) && i \\mid j \\\\0 && i \\nmid j\\end{cases}\n$$\n\u5bf9\u4e8e\u77e9\u9635 $B$\uff0c\u6ee1\u8db3 $B_{i,j}=\\gcd(i,j)$\uff0c\u5728\u8fdb\u884c\u9ad8\u65af\u6d88\u5143\u540e\uff0c\u6709\uff1a\n$$\nB'_{i,j}=\\begin{cases}\\varphi(i) && i \\mid j\\\\0 && i \\nmid j\\end{cases}\n$$\n\u90a3\u4e48\uff0c\u5bf9\u4e8e $1$ \u64cd\u4f5c\u524d\u7684 $2$ \u64cd\u4f5c\u7b54\u6848\u4e3a $i j \\gcd(i,j)$\uff0c\u5bf9\u4e8e $1$ \u64cd\u4f5c\u540e\u7684 $2$ \u64cd\u4f5c\u7b54\u6848\u4e3a $i j \\varphi(i)$\u3002\n\n\u518d\u770b $1$ \u64cd\u4f5c\u524d\u7684 $3$ \u64cd\u4f5c\uff0c\u7b54\u6848\u4e3a\uff1a\n$$\n\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}i j \\gcd(i,j)\\\\\n=\\sum\\limits_{d=1}^{n}d\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}i j [\\gcd(i,j=1)]\\\\\n=\\sum\\limits_{d=1}^{n}d^3\\sum\\limits_{i=1}^{\\lfloor \\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor \\frac{n}{d} \\rfloor}i j [\\gcd(i,j)=1]\\\\\n=\\sum\\limits_{d=1}^{n}d^3 \\sum\\limits_{i=1}^{\\lfloor \\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor \\frac{n}{d}\\rfloor}i j \\sum\\limits_{p|\\gcd(i,j)}\\mu(p)\\\\\n=\\sum\\limits_{d=1}^{n}d^3\\sum\\limits_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor} \\mu(p)\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}i j\\\\\n=\\sum\\limits_{d=1}^{n}d^3\\sum\\limits_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}p^2 \\mu(p)\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{pd}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{pd}\\rfloor}i j\\\\\n=\\sum\\limits_{d=1}^{n}d^3\\sum\\limits_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}p^2 \\mu(p)\\left(\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{pd}\\rfloor}i\\right)^2\\\\\n\\sum\\limits_{d=1}^{n}d\\sum\\limits_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}(pd)^2 \\mu(p)\\left(\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{pd}\\rfloor}i\\right)^2\n$$\n\u8bbe $f(n)=\\left(\\sum\\limits_{i=1}^{n}i\\right)^2$\uff0c\u5219\u6709\uff1a\n$$\n\\sum\\limits_{d=1}^{n}d\\sum\\limits_{p=1}^{\\lfloor\\frac{n}{d}\\rfloor}(pd)^2 \\mu(p)f(\\lfloor\\frac{n}{pd}\\rfloor)\n$$\n\u8bbe $T=pd$\uff0c\u6709\uff1a\n$$\n\\sum\\limits_{T}^{n}T^2f(\\lfloor\\frac{n}{T}\\rfloor)\\sum\\limits_{d|T}d \\mu(\\frac{T}{d})\n$$\n\u6839\u636e\u72c4\u5229\u514b\u96f7\u5377\u79ef\uff0c\u6709\uff1a\n$$\n\\sum\\limits_{T}^{n}T^2f(\\lfloor\\frac{n}{T}\\rfloor)\\varphi(T)\n$$\n\u6570\u8bba\u5206\u5757\u5957\u675c\u6559\u7b5b\u5373\u53ef\u3002\n\n\u5bf9\u4e8e $1$ \u64cd\u4f5c\u540e\u7684 $3$ \u64cd\u4f5c\uff0c\u8bbe $g(n)$ \u4e3a\u7b2c $n$ \u5217\u7684\u548c\uff0c\u90a3\u4e48\u6709\uff1a\n$$\ng(n)=n\\sum\\limits_{d|n}d\\varphi(d)\n$$\n\u8bbe $h(n)=\\sum\\limits_{d|n}d \\varphi(d)$\uff0c\u663e\u7136\uff0c $h(n)$ \u662f\u4e2a\u79ef\u6027\u51fd\u6570\uff0c\u7ebf\u6027\u7b5b\u5373\u53ef\u3002\n\n\u7b54\u6848\u5373\u4e3a\uff1a\n$$\n\\sum\\limits_{i=1}^{n}g(i)\\\\\n=\\sum\\limits_{i=1}^{n}\\left(i \\times h(i)\\right)\n$$\n\u5bf9\u4e8e\u64cd\u4f5c $4$\uff0c\u884c\u5217\u5f0f\u5373\u6d88\u5143\u540e\u4e3b\u5bf9\u89d2\u7ebf\u4e0a\u5143\u7d20\u4e58\u79ef\uff0c\u6240\u4ee5\u7b54\u6848\u5373\u4e3a\uff1a\n$$\n\\prod\\limits_{i=1}^{n}i^2\\varphi(i)\n$$\n\n\n## CODE\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\n#define int long long\n\ninline int read()\n{\n    int x = 0, f = 1;\n    char c = getchar();\n    while (c < '0' || c > '9')\n    {\n        if (c == '-')\n            f = -1;\n        c = getchar();\n    }\n    while (c >= '0' && c <= '9')\n    {\n        x = x * 10 + c - '0';\n        c = getchar();\n    }\n    return x * f;\n}\n\nconst int MOD = 998244353, _ = 5e6 + 51, INV6 = 166374059, INV4 = 748683265, MAXM = 4e5 + 7;\n\nunordered_map<int, int> resP;\n\nint n, op, flag, tot;\n\nint x, y;\n\nint prime[MAXM], phi[_], vis[_], p[_], low[_], g[_];\n\nint invPr[MAXM], prefix[_], prod[_];\n\ninline int qpow(int x, int y)\n{\n    int res = 1;\n    while (y)\n    {\n        if (y & 1)\n            res = res * x % MOD;\n        x = x * x % MOD;\n        y >>= 1;\n    }\n    return res;\n}\n\ninline void solve(int n)\n{\n    int pp;\n    phi[1] = g[1] = prod[0] = 1;\n    for (int i = 2; i <= n; i++)\n    {\n        if (!vis[i])\n        {\n            low[i] = prime[++tot] = i, phi[i] = i - 1, g[i] = (i * i % MOD - i + 1 + MOD) % MOD;\n            invPr[tot] = qpow(prime[tot] + 1, MOD - 2);\n        }\n        for (int j = 1; j <= tot && i * prime[j] <= n; j++)\n        {\n            vis[i * prime[j]] = 1;\n            if (i % prime[j] == 0)\n            {\n                low[i * prime[j]] = low[i] * prime[j];\n                phi[i * prime[j]] = phi[i] * prime[j];\n                if (low[i] == i)\n                {\n                    pp = i * prime[j];\n                    g[pp] = (pp * pp % MOD * prime[j] % MOD + 1) * qpow(prime[j] + 1, MOD - 2) % MOD;\n                }\n                else\n                {\n                    g[i * prime[j]] = g[i / low[i]] * g[low[i] * prime[j]] % MOD;\n                }\n                break;\n            }\n            low[i * prime[j]] = prime[j], g[i * prime[j]] = g[i] * g[prime[j]] % MOD;\n            phi[i * prime[j]] = phi[i] * phi[prime[j]];\n        }\n    }\n    for (int i = 1; i <= n; i++)\n    {\n        p[i] = (p[i - 1] + i * i % MOD * phi[i] % MOD) % MOD;\n        prefix[i] = (prefix[i - 1] + i * g[i] % MOD) % MOD;\n        prod[i] = prod[i - 1] * i % MOD * i % MOD * phi[i] % MOD;\n    }\n}\n\n\ninline int get_phi(int x)\n{\n    int res = x;\n    for (int i = 2; i * i <= x; i++)\n        if (x % i == 0)\n        {\n            res = res / i * (i - 1);\n            while (x % i == 0)\n                x /= i;\n        }\n    if (x != 1)\n        res = res / x * (x - 1);\n    return res;\n}\n\ninline int calc2(int x)\n{\n    return x * (x + 1) % MOD * (2 * x + 1) % MOD * INV6 % MOD;\n}\n\ninline int calc3(int x)\n{\n    return x * (x + 1) % MOD * x % MOD * (x + 1) % MOD * INV4 % MOD;\n}\n\ninline int prefixP(int num)\n{\n    if (num <= 5e6)\n        return p[num];\n    if (resP[num])\n        return resP[num];\n    int res = calc3(num);\n    for (int l = 2, r; l <= num; l = r + 1)\n    {\n        r = num / (num / l);\n        res = (res - prefixP(num / l) * (calc2(r) - calc2(l - 1) + MOD) % MOD + MOD) % MOD;\n    }\n    return resP[num] = res;\n}\n\ninline int calc(int num)\n{\n    int res = 0;\n    for (int l = 1, r; l <= num; l = r + 1)\n    {\n        r = num / (num / l);\n        res = (res + calc3(num / l) * (prefixP(r) - prefixP(l - 1) + MOD) % MOD) % MOD;\n    }\n    return res;\n}\n\nsigned main()\n{\n    solve(5000010);\n    n = read();\n    while(n--)\n    {\n        op = read();\n        if (op == 1)\n            flag = 1;\n        if (op == 2)\n        {\n            x = read(), y = read();\n            if (flag)\n                printf(\"%lld\\n\", y % x ? 0 : x * y % MOD * get_phi(x) % MOD);\n            else\n                printf(\"%lld\\n\", (x % MOD) * (y % MOD) % MOD * (__gcd(x, y) % MOD) % MOD);\n        }\n        if (op == 3)\n        {\n            x = read();\n            if (flag)\n                printf(\"%lld\\n\", prefix[x]);\n            else\n                printf(\"%lld\\n\", calc(x));\n        }\n        if (op == 4)\n        {\n            x = read();\n            printf(\"%lld\\n\", prod[x]);\n        }\n    }\n    return 0;\n}\n```\n\n ",
        "postTime": 1640152848,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "P6384 \u300eMdOI R2\u300fQuo Vadis"
    }
]