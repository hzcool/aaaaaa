[
    {
        "content": "\u600e\u4e48\u9898\u89e3\u533a\u5168\u662f\u83ab\u961f\uff0c\u6765\u53d1 2log \u7684\u6b63\u89e3\u3002\n\n\u8003\u8651\u5206\u6cbb\uff0c\u6bcf\u6b21\u5904\u7406\u8de8\u8fc7\u4e2d\u95f4\u70b9\u7684\u8be2\u95ee\u3002\u628a\u4e24\u8fb9\u7684\u90e8\u5206\u62c9\u51fa\u6765\u6392\u5e8f\uff0c\u8003\u8651\u82e5\u53f3\u8fb9\u6709\u4e24\u4e2a\u4f4d\u7f6e $i$ \u548c $j$\uff08$a_i<a_j$\uff09\u5728\u6392\u5e8f\u540e\u662f\u76f8\u90bb\u7684\uff0c\u5b83\u4eec\u4f1a\u4ea7\u751f\u600e\u6837\u7684\u8d21\u732e\u3002\n- \u82e5\u5de6\u8fb9\u6709 $a_i$ \u548c $a_j$ \u4e4b\u95f4\u7684\u6570\uff0c\u90a3\u4e48\u4e00\u5b9a\u662f\u4ece $i$ \u8d70\u5230\u5de6\u8fb9\uff0c\u8d70\u8d70\u8d70\u518d\u8d70\u56de $j$\uff0c\u8fd9\u6837\u8d21\u732e\u662f $i+j$\uff1b\n- \u5426\u5219\uff0c\u5c31\u662f\u4ece $i$ \u76f4\u63a5\u8d70\u5230 $j$\uff0c\u8fd9\u6837\u8d21\u732e\u662f $|i-j|$\u3002\n\n\u5bf9\u4e8e\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\u4e5f\u662f\u7c7b\u4f3c\uff0c\u8003\u8651\u5de6\u8fb9\u6709\u6ca1\u6709\u6bd4\u5b83\u5927\u6216\u8005\u5c0f\u7684\u3002\n\n\u8003\u8651\u6539\u5199\u7b2c\u4e00\u79cd\u8d21\u732e\u6210\u7acb\u7684\u6761\u4ef6\u3002\u627e\u5230\u5206\u6cbb\u4e2d\u70b9\u5de6\u8fb9\u6700\u9760\u53f3\u7684 $a_i$ \u548c $a_j$ \u4e4b\u95f4\u7684\u6570\uff0c\u90a3\u4e48\u7b2c\u4e00\u79cd\u8d21\u732e\u7684\u6761\u4ef6\u5c31\u662f\u8be2\u95ee\u5de6\u7aef\u70b9\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u5de6\u8fb9\uff0c\u8fd9\u662f\u4e00\u4e2a\u4e00\u7ef4\u6570\u70b9\u3002\n\n\u5bf9\u8be2\u95ee\u7684\u53f3\u7aef\u70b9\u505a\u626b\u63cf\u7ebf\uff0c\u6bcf\u6b21\u63d2\u5165\u6216\u5220\u9664\u4e00\u4e2a\u6570\u4f1a\u63d2\u5165\u548c\u5220\u9664 $O(1)$ \u5bf9\u8fd9\u6837\u7684 $(i,j)$\uff0c\u76f8\u5f53\u4e8e\u6211\u4eec\u505a\u52a8\u6001\u4e00\u7ef4\u6570\u70b9\uff0c\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u3002\u5bf9\u4e8e\u5de6\u8fb9\u7684\u5bf9\u7684\u8d21\u732e\u4e5f\u7c7b\u4f3c\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u66f4\u65b0\u8fd9\u6837\u7684 $(i,j)$ \u9700\u8981\u652f\u6301\u627e\u5230\u5f53\u524d\u63d2\u5165\u6216\u5220\u9664\u7684\u6570\u7684\u524d\u9a71\u548c\u540e\u7ee7\uff0c\u5e76\u652f\u6301\u5728\u53e6\u4e00\u8fb9\u627e\u5230\u7b2c\u4e00\u4e2a\u5728\u67d0\u4e2a\u533a\u95f4\u5185\u7684\u6570\u3002\u524d\u8005\u53ef\u4ee5 `set` \u7ef4\u62a4\uff0c\u540e\u8005\u53ef\u4ee5\u7ebf\u6bb5\u6811\u3002\n\n\u4f46\u662f\u8fd9\u6837\u5e38\u6570\u5f88\u5927\uff0c\u4e5f\u53ef\u4ee5\u53f3\u7aef\u70b9\u4ece\u53f3\u5f80\u5de6\uff0c\u5de6\u7aef\u70b9\u4ece\u5de6\u5f80\u53f3\uff0c\u8fd9\u6837\u53ea\u9700\u8981\u5220\u6570\uff0c\u53ef\u4ee5\u5f52\u5e76\u6392\u5e8f\u548c\u94fe\u8868\u7ef4\u62a4\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2n+m\\log n)$\uff0c\u5982\u679c\u4f60\u7528\u94fe\u8868\u7684\u8bdd\u74f6\u9888\u5c31\u662f\u52a8\u6001\u4e00\u7ef4\u6570\u70b9\uff0c$n$ \u548c $m$ \u540c\u9636\u65f6\u53ef\u4ee5\u5e73\u8861\u5230 $O\\left(\\dfrac{n\\log^2n}{\\log\\log n}\\right)$\u3002\n\n\u4e0b\u9762\u7684\u4ee3\u7801\u662f 2log\uff0c\u63d0\u4ea4\u65f6\u548c\u9898\u89e3\u63d0\u4ea4\u65f6\u53ef\u4ee5\u6392\u5230\u6700\u4f18\u89e3\u7b2c\u4e00\u5e76\u4e14\u78be\u538b\u5927\u90e8\u5206\u83ab\u961f\u505a\u6cd5\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nusing ll=long long;\ninline ll read(){\n\tll x=0;\n\tbool f=0;\n\tchar c=getchar();\n\twhile(!isdigit(c)){\n\t\tif(c=='-') f=1;\n\t\tc=getchar();\n\t}\n\twhile(isdigit(c)){\n\t\tx=x*10+c-'0';\n\t\tc=getchar();\n\t}\n\treturn f?-x:x;\n}\nconst int maxn=5e5+5;\nint n,m,a[maxn],p[maxn],ql[maxn],qr[maxn];\nll c[maxn];\nvoid modify(int x,ll k){\n\twhile(x){\n\t\tc[x]+=k;\n\t\tx-=x&-x;\n\t}\n}\nll query(int x){\n\tll s=0;\n\twhile(x<=n){\n\t\ts+=c[x];\n\t\tx+=x&-x;\n\t}\n\treturn s;\n}\nll ans[maxn];\nvector<int> q[maxn];\nint ord[maxn],pre[maxn],suc[maxn],mx[maxn];\nvoid solve(int l,int r,vector<int> vec){\n\tif(l==r){\n\t\tord[r]=a[r];\n\t\treturn;\n\t}\n\tint mid=l+(r-l)/2;\n\tvector<int> vec1,vec2,vec3;\n\tfor(int i:vec)\n\t\tif(qr[i]<=mid) vec1.push_back(i);\n\t\telse if(ql[i]>mid) vec2.push_back(i);\n\t\telse vec3.push_back(i);\n\tsolve(l,mid,vec1);\n\tsolve(mid+1,r,vec2);\n\tint c=l;\n\tsuc[0]=ord[mid+1];\n\tmx[0]=0;\n\twhile(c<=mid&&ord[c]<ord[mid+1])\n\t\tmx[0]=max(mx[0],p[ord[c++]]);\n\tfor(int i=mid+1;i<=r;i++){\n\t\tpre[ord[i]]=i==mid+1?0:ord[i-1];\n\t\tsuc[ord[i]]=i==r?n+1:ord[i+1];\n\t\tmx[ord[i]]=0;\n\t\twhile(c<=mid&&ord[c]<suc[ord[i]])\n\t\t\tmx[ord[i]]=max(mx[ord[i]],p[ord[c++]]);\n\t}\n\tpre[n+1]=ord[r];\n\tfor(int i:vec3) q[qr[i]].push_back(i);\n\tll res=0;\n\tauto upd1=[&res](int x,int f){\n\t\tint y=suc[x];\n\t\tif(x&&y<=n){\n\t\t\tres+=abs(p[x]-p[y])*f;\n\t\t\tmodify(mx[x],(p[x]+p[y]-abs(p[x]-p[y]))*f);\n\t\t}\n\t\telse modify(mx[x],(x?p[x]:p[y])*f);\n\t};\n\tupd1(0,1);\n\tfor(int i=mid+1;i<=r;i++) upd1(ord[i],1);\n\tfor(int i=r;i>mid;i--){\n\t\tfor(int j:q[i]) ans[j]=res+query(ql[j]);\n\t\tupd1(pre[a[i]],-1);\n\t\tupd1(a[i],-1);\n\t\tpre[suc[a[i]]]=pre[a[i]];\n\t\tsuc[pre[a[i]]]=suc[a[i]];\n\t\tmx[pre[a[i]]]=max(mx[pre[a[i]]],mx[a[i]]);\n\t\tif(i>mid+1) upd1(pre[a[i]],1);\n\t}\n\tfor(int i=mid+1;i<=r;i++) vector<int>().swap(q[i]);\n\tc=mid+1;\n\tsuc[0]=ord[l];\n\tmx[0]=0;\n\twhile(c<=r&&ord[c]<ord[l]) mx[0]=max(mx[0],n+1-p[ord[c++]]);\n\tfor(int i=l;i<=mid;i++){\n\t\tpre[ord[i]]=i==l?0:ord[i-1];\n\t\tsuc[ord[i]]=i==mid?n+1:ord[i+1];\n\t\tmx[ord[i]]=0;\n\t\twhile(c<=r&&ord[c]<suc[ord[i]])\n\t\t\tmx[ord[i]]=max(mx[ord[i]],n+1-p[ord[c++]]);\n\t}\n\tpre[n+1]=ord[mid];\n\tfor(int i:vec3) q[ql[i]].push_back(i);\n\tauto upd2=[&res](int x,int f){\n\t\tint y=suc[x];\n\t\tif(x&&y<=n){\n\t\t\tres+=abs(p[x]-p[y])*f;\n\t\t\tmodify(mx[x],(-p[x]-p[y]-abs(p[x]-p[y]))*f);\n\t\t}\n\t\telse modify(mx[x],(x?-p[x]:-p[y])*f);\n\t};\n\tupd2(0,1);\n\tfor(int i=l;i<=mid;i++) upd2(ord[i],1);\n\tfor(int i=l;i<=mid;i++){\n\t\tfor(int j:q[i]) ans[j]+=res+query(n+1-qr[j]);\n\t\tupd2(pre[a[i]],-1);\n\t\tupd2(a[i],-1);\n\t\tpre[suc[a[i]]]=pre[a[i]];\n\t\tsuc[pre[a[i]]]=suc[a[i]];\n\t\tmx[pre[a[i]]]=max(mx[pre[a[i]]],mx[a[i]]);\n\t\tif(i<mid) upd2(pre[a[i]],1);\n\t}\n\tfor(int i=l;i<=mid;i++) vector<int>().swap(q[i]);\n\tvector<int> tmp;\n\tc=l;\n\tfor(int i=mid+1;i<=r;i++){\n\t\twhile(c<=mid&&ord[c]<ord[i]) tmp.push_back(ord[c++]);\n\t\ttmp.push_back(ord[i]);\n\t}\n\twhile(c<=mid) tmp.push_back(ord[c++]);\n\tfor(int i=l;i<=r;i++) ord[i]=tmp[i-l];\n}\nint main(){\n#ifdef LOCAL\n\tfreopen(\"in.txt\",\"r\",stdin);\n\tfreopen(\"out.txt\",\"w\",stdout);\n#endif\n\tn=read();\n\tm=read();\n\tfor(int i=1;i<=n;i++) p[a[i]=read()]=i;\n\tfor(int i=1;i<=m;i++){\n\t\tql[i]=read();\n\t\tqr[i]=read();\n\t}\n\tvector<int> vec;\n\tfor(int i=1;i<=m;i++) vec.push_back(i);\n\tsolve(1,n,vec);\n\tfor(int i=1;i<=m;i++) printf(\"%lld\\n\",ans[i]);\n#ifdef LOCAL\n\tfprintf(stderr,\"%f\\n\",1.0*clock()/CLOCKS_PER_SEC);\n#endif\n\treturn 0;\n}\n```\n~~\u4e0d\u8fc7\u6211\u4e0d\u4f1a\u544a\u8bc9\u4f60\u6211\u6700\u5f00\u59cb\u5199\u4e86\u4e2a `set` \u548c\u7ebf\u6bb5\u6811\u7684\u5361\u4e86\u4e00\u4e07\u5e74\u5e38\u8fd8 90\u3002~~",
        "postTime": 1647955170,
        "uid": 174045,
        "name": "FZzzz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8078 [WC2022] \u79c3\u5b50\u914b\u957f"
    },
    {
        "content": "\u826f\u5fc3\u51fa\u9898\u4eba lxl\u3002\n\n\u9996\u5148\u4e0d\u96be\u60f3\u5230 $\\Theta(n \\sqrt{n \\log n})$ \u505a\u6cd5\uff08\u83ab\u961f\uff0c\u7528 `set` \u7ef4\u62a4\u524d\u9a71\u540e\u7ee7\uff09\u3002\n\n\u89c2\u5bdf\u5230\u539f\u6392\u5217\u7684\u4e00\u6bb5\u533a\u95f4\u6392\u5e8f\u540e\u76f8\u90bb\u7684\u6570\u5728\u539f\u5e8f\u5217\u4e2d\u7684\u4f4d\u7f6e\u5c31\u662f\u9006\u6392\u5217\u5bf9\u5e94\u4f4d\u7f6e\u7684\u503c\u3002\u94fe\u8868\u7684\u5220\u9664\u64cd\u4f5c\u80fd\u505a\u5230 $\\Theta(1)$\uff0c\u4e8e\u662f\u8003\u8651\u4f7f\u7528\u4e0d\u63d2\u5165\u7684\u56de\u6eda\u83ab\u961f\u3002\n\n\u4e0d\u63d2\u5165\u83ab\u961f\u6d41\u7a0b\uff08\u56e0\u4e3a\u6ca1\u627e\u5230\u4f8b\u9898\u6240\u4ee5\u5728\u8fd9\u9898\u8d34\u51fa\u6765\u4e86\uff0c\u4f1a\u7684\u53ef\u4ee5\u8df3\u8fc7\uff09\uff1a\n\n0. \u5c06\u83ab\u961f\u5de6\u7aef\u70b9 $l$ \u521d\u59cb\u5316\u4e3a $1$\uff0c\u53f3\u7aef\u70b9 $r$ \u521d\u59cb\u5316\u4e3a $n$\uff0c\u5e76\u7ef4\u62a4\u5168\u5c40\u7b54\u6848\uff1b\n1. \u5bf9\u539f\u5e8f\u5217\u5206\u5757\uff0c\u7136\u540e\u5bf9\u8be2\u95ee\u6309\u7167\u5982\u4e0b\u65b9\u5f0f\u6392\u5e8f\uff1a\u4ee5\u5de6\u7aef\u70b9\u6240\u5728\u5757\u5347\u5e8f\uff0c\u5de6\u7aef\u70b9\u540c\u4e2a\u5757\u7684\u4ee5\u53f3\u7aef\u70b9**\u964d\u5e8f**\uff1b\n2. \u5bf9\u4e8e\u6240\u6709\u5de6\u7aef\u70b9\u5728\u7b2c $b$ \u5757\u5185\u7684\u8be2\u95ee\uff0c$l$ \u521d\u59cb\u5316\u4e3a $L_b$\uff08\u5757\u7684\u5de6\u7aef\u70b9\uff09\uff0c$r$ \u521d\u59cb\u5316\u4e3a $n$\uff1b\n3. \u5bf9\u4e8e\u540c\u4e2a\u5757\u5185\u7684\u6240\u6709\u8be2\u95ee\uff0c\u6bcf\u6b21\u5148\u79fb\u52a8\u53f3\u7aef\u70b9\uff08\u81f3\u591a\u79fb\u52a8 $\\Theta(n)$ \u6b21\uff09\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8be2\u95ee\uff0c\u4f7f\u5de6\u7aef\u70b9\u4ece $L_b$ \u51fa\u53d1\u5230\u6307\u5b9a\u4f4d\u7f6e\uff0c\u5b58\u5b8c\u7b54\u6848\u540e**\u64a4\u9500\u79fb\u52a8\u7aef\u70b9\u7684\u6539\u52a8**\uff0c\u4f7f\u5de6\u7aef\u70b9\u56de\u5230 $L_b$\uff1b\n4. \u6309\u7167\u76f8\u540c\u7684\u65b9\u5f0f\u5904\u7406\u4e0b\u4e00\u5757\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n \\sqrt n)$\u3002\n\nCode:\n\n```cpp\nint n,m,p[500005],v[500005],bl[500005],lb[500005],rb[500005],lxl;ll ans[500005];\nstruct query{int l,r,id;il bool opr<(cst query&_)cst{ret (bl[l]^bl[_.l])?bl[l]<bl[_.l]:r>_.r;}}q[500005];\ncst int siz=800;\nstruct chain\n{\n\tint pre[500005],nxt[500005],s[500005],t;\n\til int del(int p)\n\t{\n\t\tint p1=pre[p],p2=nxt[p],res=0;s[++t]=p;\n\t\tif(p1&&p2)res+=uabs(v[p1]-v[p2]);\n\t\tif(p1)res-=uabs(v[p1]-v[p]);\n\t\tif(p2)res-=uabs(v[p2]-v[p]);\n\t\tnxt[p1]=p2;pre[p2]=p1;ret res;\n\t}\n\til void init(int n)\n\t{\n\t\tfor(int i=1;i<=n;++i)nxt[i]=i+1,pre[i]=i-1;\n\t\tnxt[n]=0;\n\t}\n\til void copy(int n,chain&a){cpy(pre,a.pre,n+1);cpy(nxt,a.nxt,n+1);}\n\til int undo(){int p=s[t--];nxt[pre[p]]=pre[nxt[p]]=p;ret p;}\n}a;\nint main()\n{\n\tfile(rrads);\n\tn=rd();m=rd();a.init(n);\n\tfor(int i=1;i<=n;++i)v[p[i]=rd()]=i,bl[i]=(i-1)/siz+1,(!lb[bl[i]])&&(lb[bl[i]]=i),rb[bl[i]]=i;\n\tfor(int i=1;i<=m;++i)q[i].l=rd(),q[i].r=rd(),q[i].id=i;\n\tsort(q+1,q+1+m);\n\tint l=1,r=n,lst=1;ll cur=0,curr;\n\tfor(int i=2;i<=n;++i)cur+=uabs(v[i]-v[i-1]);\n\tcurr=cur;\n\tfor(int i=1;i<=m;++i)\n\t{\n\t\tint lq=q[i].l,rq=q[i].r;\n\t\tif(bl[lq]^lst)\n\t\t{\n\t\t\twhile(a.t)a.undo();\n\t\t\twhile(l<lb[bl[lq]])curr+=a.del(p[l++]);\n\t\t\tcur=curr;r=n;lst=bl[lq];a.t=0;\n\t\t}\n\t\twhile(r>rq)cur+=a.del(p[r--]);\n\t\tll tmp=cur,tl=l;\n\t\twhile(tl<lq)tmp+=a.del(p[tl++]);\n\t\twhile(tl>l)a.undo(),--tl;\n\t\tans[q[i].id]=tmp;\n\t}\n\tfor(int i=1;i<=m;++i)prt(ans[i]);\n\tret 0;\n}\n```",
        "postTime": 1643680098,
        "uid": 224991,
        "name": "Presentation_Emitter",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P8078 \u3010[WC2022] \u79c3\u5b50\u914b\u957f\uff08\u6682\u65e0\u6570\u636e\uff09\u3011"
    },
    {
        "content": "[\u53ef\u80fd\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c](https://www.cnblogs.com/mfeitveer/p/16055590.html)\n\n\u8003\u573a\u4e0a\u53ea\u5199\u4e86\u4e00\u4e2a $O(n\\sqrt n \\log n)$ \u7684\u66b4\u529b\u3002\n\n\u7136\u540e\u4ee5\u4e3a\u662f\u4ec0\u4e48\u4e8c\u6b21\u79bb\u7ebf\u4e4b\u7c7b\u7684\u9ed1\u79d1\u6280\uff0c\u538b\u6839\u6ca1\u5f80\u56de\u6eda\u60f3\u3002\n\n\u8d5b\u540e\u4e00\u63d0\u9192\u7acb\u9a6c\u60f3\u5230\u4e86\u3002\n\n\u4e2a\u4eba\u89c9\u5f97\u60f3\u5230\u4e86\u8fd8\u662f\u6bd4\u8f83\u597d\u5199\u7684\u3002\n\n### \u601d\u8def\n\n\u8003\u8651\u79bb\u7ebf\u83ab\u961f\u3002\n\n\u66b4\u529b\u505a\u6cd5\u662f\u7528\u83ab\u961f\u7ef4\u62a4\u5de6\u53f3\u7aef\u70b9\uff0c\u52a0\u5165\u548c\u5220\u9664\u90fd\u7528\u4e00\u4e2a $\\text{set}$ \u6216\u8005\u5e73\u8861\u6811\u53bb\u7ef4\u62a4\uff0c\u5bf9\u4e8e\u7b54\u6848\u7684\u4fee\u6539\u76f4\u63a5\u5728\u5e73\u8861\u6811\u4e2d\u67e5\u8be2\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n\\sqrt n \\log n)$\n\n\u671f\u671b\uff1a$\\text{40pts}$\n\n\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u7528\u56de\u6eda\u6765\u4f18\u5316\u3002\n\n\u7531\u4e8e\u5728\u66b4\u529b\u505a\u6cd5\u4e2d\u5e73\u8861\u6811\u7684\u4f5c\u7528\u4ec5\u4ec5\u53ea\u662f\u67e5\u8be2\u524d\u9a71\u548c\u540e\u7ee7\uff0c\u6211\u4eec\u77e5\u9053\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u6709\u5e8f\u7684\u94fe\u8868\uff0c\u5b83\u53ef\u4ee5 $O(1)$ \u5b9e\u73b0\u8fd9\u4e2a\u64cd\u4f5c\u3002\n\n\u6240\u4ee5\u8003\u8651\u4e0d\u589e\u52a0\u83ab\u961f\u3002\n\n\u7ef4\u62a4\u4e00\u4e2a\u94fe\u8868\uff0c\u4e00\u4e2a\u94fe\u5934\uff0c\u4e00\u4e2a\u94fe\u5c3e\u3002\n\n\u9996\u5148\u9884\u5904\u7406\u51fa\u5de6\u53f3\u7aef\u70b9\u4e3a $\\text{1}$ \u548c $\\text{n}$ \u7684\u6709\u5e8f\u94fe\u8868\uff0c\u5e76\u4e14\u8ba1\u7b97\u7b54\u6848\u3002\n\n\u63a5\u7740\u5c06\u8be2\u95ee\u6309\u5de6\u7aef\u70b9\u6240\u5728\u7684\u5757\u4e3a\u7b2c\u4e00\u5173\u952e\u5b57\u6392\u5e8f\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u5757\u4e2d\u7684\u8be2\u95ee\u3002\n\n1. \u5c06\u5de6\u7aef\u70b9\u5220\u9664\u81f3\u6b64\u65f6\u5757\u7684\u5de6\u7aef\u70b9\uff0c\u4fdd\u5b58\u6b64\u65f6\u7684\u94fe\u8868\u3002\n\n2. \u5c06\u7531\u4e8e\u5728\u540c\u4e00\u5757\u5185\u7684\u8be2\u95ee\uff0c\u53f3\u7aef\u70b9\u662f\u9012\u51cf\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u5220\u9664\u3002\n\n3. \u5c06\u6b64\u65f6\u7684\u94fe\u5934\uff0c\u94fe\u5c3e\uff0c\u7b54\u6848\u4fdd\u5b58\uff0c\u65b9\u4fbf\u7b49\u4e00\u4e0b\u6062\u590d\u5de6\u7aef\u70b9\u3002\n\n4. \u5c06\u5de6\u7aef\u70b9\u5220\u9664\u81f3\u8be2\u95ee\u7684\u5de6\u7aef\u70b9\uff0c\u7edf\u8ba1\u7b54\u6848\u3002\n\n5. \u7531\u4e8e\u5728\u632a\u52a8\u5b8c\u5de6\u7aef\u70b9\u540e\u6ca1\u6709\u8fdb\u884c\u5176\u4ed6\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u6062\u590d\uff0c\u5e76\u7528\u4e4b\u524d\u4fdd\u5b58\u7684\u94fe\u5934\uff0c\u94fe\u5c3e\uff0c\u7b54\u6848\u66f4\u65b0\u3002\n\n6. \u5faa\u73af\u5904\u7406\u8be2\u95ee\uff0c\u5f53\u6b64\u65f6\u7684\u5757\u5185\u8be2\u95ee\u5904\u7406\u5b8c\u4e4b\u540e\uff0c\u5c06\u4fdd\u5b58\u7684\u94fe\u8868\u590d\u5236\u5230\u6b64\u65f6\u7684\u94fe\u8868\u4e0a\uff0c\u5de6\u7aef\u70b9\u518d\u6b21\u56de\u5230\u6b64\u65f6\u5757\u5185\u7684\u5de6\u7aef\u70b9\uff0c\u53f3\u7aef\u70b9\u53d8\u4e3a $\\text{n}$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\sqrt n)$\u3002\n\n\u671f\u671b\uff1a$\\text{100pts}$\n\n\u8fd9\u4e2a\u505a\u6cd5\u867d\u7136\u8dd1\u7684\u4e0d\u600e\u4e48\u5feb\uff0c\u4f46\u597d\u50cf\u4e0d\u600e\u4e48\u5361\u5e38\u3002\n\n\u6211\u53ea\u662f $\\text{cout}$ \u88ab\u5361 $\\text{TLE}$ \u4e86\u4e2a\u70b9\uff0c\u6362\u6210 $\\text{printf}$ \u5c31\u53ef\u4ee5\u4e86\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\n\nconst int N = 500010;\n\nint n , m , t1 , w1 , ans , num , len , tou , wei , pos[N] , sum[N];\npair<int , int> a[N];\n\nstruct List\n{\n    int hou , qian , val;\n}q[N] , h[N];\n\nstruct Modui\n{\n    int l , r , id;\n    inline bool operator<(const Modui &tmp) const\n    {\n        return pos[l] == pos[tmp.l] ? r > tmp.r : pos[l] < pos[tmp.l];\n    }\n}que[N];\n\n#define l(x) (x - 1) * len + 1\n#define r(x) min(x * len , n)\n\ninline int read()\n{\n    int asd = 0 , qwe = 1; char zxc;\n    while(!isdigit(zxc = getchar())) if(zxc == '-') qwe = -1;\n    while(isdigit(zxc)) asd = asd * 10 + zxc - '0' , zxc = getchar();\n    return asd * qwe;\n}\n\ninline void del(int x)\n{\n    if(x != tou) ans -= abs(x - q[x].qian);\n    if(x != wei) ans -= abs(x - q[x].hou);\n    if(x != tou && x != wei) ans += abs(q[x].qian - q[x].hou);\n    if(x == tou) tou = q[x].hou;\n    if(x == wei) wei = q[x].qian;\n    q[q[x].qian].hou = q[x].hou;\n    q[q[x].hou].qian = q[x].qian;\n}\n\ninline void add(int x)\n{\n    q[q[x].qian].hou = x;\n    q[q[x].hou].qian = x;\n}\n\ninline void cp(List *x , List *y)\n{\n    for(int i = 1;i <= n;i++)\n        x[i] = y[i];\n}\n\nsigned main()\n{\n    n = read() , m = read() , len = sqrt(n);\n    for(int i = 1;i <= n;i++)\n        a[i].first = read() , a[i].second = i;\n    sort(a + 1 , a + n + 1) , tou = a[1].second , wei = a[n].second;\n    for(int i = 1;i <= n;i++)\n        q[a[i].second].qian = a[i - 1].second,\n        q[a[i].second].hou = a[i + 1].second;\n    for(int i = 1;i <= n;i++) \n        pos[i] = (i - 1) / len + 1;\n    for(int i = 1;i <= n;i++)\n        if(i != tou) ans += abs(i - q[i].qian);\n    for(int i = 1;i <= m;i++)\n        que[i].l = read() , que[i].r = read() , que[i].id = i;\n    sort(que + 1 , que + m + 1);\n    for(int j = 1 , k = 1 , l = 1 , r = n;j <= pos[n] && k <= m;j++)\n    {\n        if(pos[que[k].l] == j)\n        {\n            while(l < l(j)) del(l++); \n            cp(h , q) , num = ans;\n            t1 = tou , w1 = wei;\n            while(pos[que[k].l] == j)\n            {\n                while(r > que[k].r) del(r--);\n                int su = ans , tt = tou , ww = wei;\n                while(l < que[k].l) del(l++);\n                sum[que[k].id] = ans;\n                while(l > l(j)) add(--l);\n                k++ , ans = su , tou = tt , wei = ww;\n            }\n            cp(q , h) , ans = num;\n            tou = t1 , wei = w1 , r = n;\n        }\n    }\n    for(int i = 1;i <= m;i++) printf(\"%lld\\n\" , sum[i]);\n    return 0;\n}\n\n```",
        "postTime": 1648198736,
        "uid": 320933,
        "name": "Mfeitveer",
        "ccfLevel": 0,
        "title": "P8078 [WC2022] \u79c3\u5b50\u914b\u957f \u9898\u89e3"
    },
    {
        "content": "### \u524d\u8a00\n\n\u5feb\u5199\u5bb3\u6b7b\u4eba\uff01\uff08\u573a\u4e0a\u6211\u5feb\u5199\u5199\u6302\uff0c\u75db\u5931 $100pts$\uff09\n\n\u6ca1\u60f3\u5230\u56de\u6eda\u83ab\u961f + \u94fe\u8868\u7b49\u795e\u4ed9\u505a\u6cd5\uff0c\u4e8e\u662f\u61a8\u61a8\u5730\u6253\u4e86\u4e00\u4e2a\u538b\u4f4d Trie+ \u666e\u901a\u83ab\u961f\u3002\n\n### \u524d\u7f6e\u829d\u58eb\n* \u666e\u901a\u83ab\u961f\u7b97\u6cd5\n* [\u538b\u4f4d Trie](https://www.luogu.com.cn/blog/DPair2005/ya-wei-trie-xue-xi-bi-ji)\n\n### \u89e3\u6cd5\n\n\u4f60\u53d1\u73b0\u66b4\u529b\u83ab\u961f $O(n\\sqrt n\\log n)$ \u5f88\u60ac\u3002\n\n\u4f60\u8003\u8651\u4f18\u5316\u5b83\u3002\n\n\u4f60\u53d1\u73b0\u5b83\u8981\u652f\u6301\u63d2\u5165\u3001\u5220\u9664\u3001\u524d\u9a71\u3001\u540e\u7ee7\u64cd\u4f5c\uff0c\u5373 [Dynamic Predecessor Problem](https://www.luogu.com.cn/problem/U156719)\u3002\n\n\u5e73\u8861\u6811\u4e8e\u662f\u53ef\u4ee5\u6362\u6210\u538b\u4f4d Trie\u3002\n\n\u7136\u540e\u8dd1\u5f97\u8fd8\u86ee\u5feb\uff1f\n\n\u590d\u6742\u5ea6 $O(n\\sqrt n\\log_wn)$\uff0c\u5b9e\u6d4b\u53ef\u4ee5\u901a\u8fc7\u3002\n\n### Code\n\n\u5b9e\u73b0\u4e86\u4e00\u4e2a\u538b\u4f4d Trie\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define ONLINE_JUDGE\n/* --------------- fast io --------------- */ // begin\nnamespace Fread{\nconst int SIZE= 1 << 16;\n\tchar buf[SIZE],*S,*T;\n\tinline char getchar(){if(S==T){T=(S=buf)+\n\tfread(buf,1,SIZE,stdin);if(S==T)return'\\n';}return *S++;}\n} // namespace Fread\nnamespace Fwrite {\nconst int SIZE= 1 << 16;\n\tchar buf[SIZE],*S=buf,*T=buf+SIZE;\n\tinline void flush(){fwrite(buf,1,S-buf,stdout);S=buf;}\n\tinline void putchar(char c){*S++=c;if(S==T)flush();}\n\tstruct NTR{~NTR(){flush();}}ztr;\n} // namespace Fwrite\n#ifdef ONLINE_JUDGE\n\t#define getchar Fread::getchar\n\t#define putchar Fwrite::putchar\n#endif\n#include <algorithm>\n#include <math.h>\n#include <stdio.h>\n#include <vector>\ntypedef long long llt;\ntypedef unsigned uint;typedef unsigned long long ullt;\ntypedef bool bol;typedef char chr;typedef void voi;\ntypedef double dbl;\ntemplate<typename T>bol _max(T&a,T b){return(a<b)?a=b,true:false;}\ntemplate<typename T>bol _min(T&a,T b){return(b<a)?a=b,true:false;}\ntemplate<typename T>T power(T base,T index,T mod){return((index<=1)?(index?base:1):(power(base*base%mod,index>>1,mod)*power(base,index&1,mod)))%mod;}\ntemplate<typename T>T lowbit(T n){return n&-n;}\ntemplate<typename T>T gcd(T a,T b){return b?gcd(b,a%b):a;}\ntemplate<typename T>T lcm(T a,T b){return(a!=0||b!=0)?a/gcd(a,b)*b:(T)0;}\ntemplate<typename T>T exgcd(T a,T b,T&x,T&y){if(!b)return y=0,x=1,a;T ans=exgcd(b,a%b,y,x);y-=a/b*x;return ans;}\nconst uint Dep=5,W=64,LogW=6,And=W-1,Val=16777216;\nullt BUFF[Val>>LogW<<1|1];\nullt*BT=BUFF+sizeof(BUFF)/sizeof(ullt);\nullt*NewMemory(uint siz){return BT-=siz;}\ninline uint hp(ullt v){return W-__builtin_clzll(v)-1;}\ninline uint lp(ullt v){return __builtin_ctzll(v);}\nstruct Trie // \u538b\u4f4d Trie\n{\n\tullt*Node[Dep-1];\n\tTrie(){for(uint i=0;i+1<Dep;i++)Node[i]=NewMemory(1llu<<(LogW*i));}\n\tinline voi insert(uint v)\n\t{\n\t\tfor(uint i=Dep-2;~i;i--)\n\t\t{\n\t\t\tif(Node[i][v>>LogW]>>(v&And)&1)return;\n\t\t\tNode[i][v>>LogW]|=1llu<<(v&And),v>>=LogW;\n\t\t}\n\t}\n\tinline voi erase(uint v)\n\t{\n\t\tif(!(Node[Dep-2][v>>LogW]>>(v&And)&1))return;\n\t\tfor(uint i=Dep-2;~i;i--)\n\t\t{\n\t\t\tNode[i][v>>LogW]&=~(1llu<<(v&And)),v>>=LogW;\n\t\t\tif(Node[i][v])return;\n\t\t}\n\t}\n\tinline uint pre(uint v)\n\t{\n\t\tfor(uint i=Dep-2;~i;i--,v>>=LogW)\n\t\t\tif(Node[i][v>>LogW]&~((-1llu)<<(v&And)))\n\t\t\t{\n\t\t\t\tuint p=hp(Node[i][v>>LogW]&~((-1llu)<<(v&And)))|(v>>LogW<<LogW);\n\t\t\t\twhile(++i<=Dep-2)p=(p<<LogW)|hp(Node[i][p]);\n\t\t\t\treturn p;\n\t\t\t}\n        return 0;\n\n\t}\n\tinline uint suf(uint v)\n\t{\n\t\tfor(uint i=Dep-2;~i;i--,v>>=LogW)\n\t\t\tif(Node[i][v>>LogW]&((-1llu)<<(v&And)<<1))\n\t\t\t{\n\t\t\t\tuint p=lp(Node[i][v>>LogW]&((-1llu)<<(v&And)<<1))|(v>>LogW<<LogW);\n\t\t\t\twhile(++i<=Dep-2)p=(p<<LogW)|lp(Node[i][p]);\n\t\t\t\treturn p;\n\t\t\t}\n        return 0;\n\t}\n}T;\nstruct ques{uint l,r,t;}Q[500005];\nuint A[500005],Back[500005];\nullt Ans[500005];\nullt ans=0;\n#define dist(a,b) Back[a]>Back[b]?Back[a]-Back[b]:Back[b]-Back[a]\ninline voi insert(uint v)\n{\n\tuint p=T.pre(v),s=T.suf(v);\n\tT.insert(v);\n\tif(p)ans+=dist(p,v);\n\tif(s)ans+=dist(v,s);\n\tif(p&&s)ans-=dist(p,s);\n}\ninline voi erase(uint v)\n{\n\tT.erase(v);\n\tuint p=T.pre(v),s=T.suf(v);\n\tif(p)ans-=dist(p,v);\n\tif(s)ans-=dist(v,s);\n\tif(p&&s)ans+=dist(p,s);\n}\ninline uint read()\n{\n\tuint ans=0;chr c;do c=getchar();while(c>'9'||c<'0');\n\tdo ans=ans*10+(c^'0'),c=getchar();while(c<='9'&&c>='0');return ans;\n}\ninline voi write(ullt v)\n{\n\tstatic chr c[18];uint cnt=0;do c[cnt++]=v%10+'0',v/=10;while(v);\n\twhile(cnt--)putchar(c[cnt]);\n\tputchar('\\n');\n}\nint main()\n{\n\t // freopen(\"rrad_s_500000.in\",\"r\",stdin);\n\t // freopen(\"rrads.out\",\"w\",stdout);\n\tuint n,m;n=read(),m=read();\n\tuint Siz=n/(sqrt(m)+1.2)*sqrt(1.5)+5;\n\t// \u83ab\u961f O(n\\sqrt m\\log_w n)\n\tfor(uint i=0;i<n;i++)Back[A[i]=read()]=i;\n\tfor(uint i=0;i<m;i++)Q[i].l=read()-1,Q[i].r=read(),Q[i].t=i;\n\tstd::sort(Q,Q+m,[Siz](const ques&a,const ques&b){return a.l/Siz==b.l/Siz?((a.l/Siz)&1)?a.r>b.r:a.r<b.r:a.l<b.l;});\n\tuint l=0,r=0;\n\tfor(uint i=0;i<m;i++)\n\t{\n\t\tques&qs=Q[i];\n\t\twhile(l>qs.l)insert(A[--l]);\n\t\twhile(r<qs.r)insert(A[r++]);\n\t\twhile(r>qs.r)erase(A[--r]);\n\t\twhile(l<qs.l)erase(A[l++]);\n\t\tAns[qs.t]=ans;\n\t}\n\tfor(uint i=0;i<m;i++)write(Ans[i]);\n    return 0;\n}\n```\n\n",
        "postTime": 1643279396,
        "uid": 105050,
        "name": "myee",
        "ccfLevel": 7,
        "title": "8078"
    },
    {
        "content": "- \u4ee5\u524d\u4f5c\u8005\u7684\u63aa\u8f9e\u53ef\u80fd\u4e0d\u592a\u6070\u5f53\uff0c\u4f46\u662f\u6211\u89c9\u5f97\u8fd9\u662f\u80fd\u591f\u7406\u89e3\u7684\uff0c\u6bd5\u7adf\u4f60\u5982\u679c\u751f\u75c5\u4e86\u5c31\u5e0c\u671b\u4e16\u95f4\u65e0\u75c5\uff0c\u4f60\u9000\u5f79\u4e86\u5c31\u5e0c\u671b\u5927\u5bb6\u80fd\u591f\u5b9e\u73b0\u81ea\u5df1\u7684\u68a6\u60f3\uff0c\u4f46\u662f\u8fd9\u7ec8\u7a76\u53ea\u662f\u613f\u671b\u800c\u5df2\u3002\n- \u4f5c\u8005\u65e9\u5df2\u9000\u5f79\uff0c\u4f46\u662f\uff0c\u5982\u679c\u5404\u4f4d\u4e0d\u5acc\u5f03\u6211\u7684\u795d\u798f\u7684\u8bdd\uff0c\u6211\u5e0c\u671b\u5927\u5bb6\u4e0d\u8981\u7559\u4e0b\u9057\u61be\u3002\n\n**\u9898\u610f**\n- [\u94fe\u63a5](https://www.luogu.com.cn/problem/P8078)\u3002\n- \u7ed9\u5b9a\u4e00\u4e2a $1$ \u5230 $n$ \u7684\u6392\u5217\uff0c$m$ \u6b21\u67e5\u8be2\u4e00\u4e2a\u533a\u95f4\u5185\u7684\u6240\u6709\uff08\u533a\u95f4\u5185\uff09\u6392\u540d\u76f8\u90bb\u7684\u6570\uff08\u5bf9\uff09\u4f4d\u7f6e\u7684\u5dee\uff08\u7684\u7edd\u5bf9\u503c\uff09\u4e4b\u548c\u3002\n- $n,m\\le 5\\times 10^5$\u3002\n\n**\u5206\u6790**\n- \u5bb9\u6613\u5f97\u5230 $O(mn\\log n)$ \u7684\u505a\u6cd5\uff0c\u5373\u5bf9\u4e8e\u6bcf\u4e2a\u8be2\u95ee\u66b4\u529b\u6392\u5e8f\u3002\n- \u5bf9\u4e8e $m=O(n^2)$ \u7684\u90e8\u5206\u6211\u4eec\u53ef\u4ee5\u60f3\u5230 $O(n^2\\log n)$ \u7684\u505a\u6cd5\uff1a\u5373\u7528 $\\text{set}$ \u52a8\u6001\u66f4\u65b0\u3002\n- \u5982\u679c\u4f60\u5b66\u8fc7\u83ab\u961f\uff0c\u53ea\u8981\u4f60\u5b66\u8fc7\u83ab\u961f\uff0c\u4f60\u5c31\u53ef\u4ee5\u60f3\u5230 $O(n\\sqrt m\\log n)$ \u7684\u505a\u6cd5\uff0c\u540e\u9762\u7684\u57fa\u4e8e\u5220\u9664\u64cd\u4f5c\u53ef\u4ee5\u7528\u94fe\u8868 $O(1)$ \u7ef4\u62a4\u7684\u56de\u6eda\u83ab\u961f\u4f18\u5316\u6211\u90fd\u4e0d\u8bb2\uff0c~~\u56e0\u4e3a\u6211\u4e5f\u4e0d\u4f1a~~\u56e0\u4e3a\u8fd9\u4e0d\u662f\u672c\u6587\u7684\u91cd\u70b9\u3002\n- \u8fd8\u6709\u4e00\u79cd\u503c\u57df\u5206\u5757\u7684\u505a\u6cd5\uff0c\u57fa\u4e8e\u533a\u95f4\u8be2\u95ee\u5bfc\u81f4\u7684\u5757\u5185\u672c\u8d28\u4e0d\u540c\u7684\u65b9\u6848\u6570\u5728\u5e73\u65b9\u7ea7\u522b\uff0c\u597d\u5904\u662f\u5bb9\u6613\u6d88\u8017\u7a7a\u95f4\u505a\u5230\u5728\u7ebf\uff0c\u8fd9\u91cc\u4e5f\u7565\u53bb~~\u56e0\u4e3a\u6211\u8fd8\u662f\u4e0d\u4f1a~~\u3002\n- \u67d0\u4f4d\u5927\u4f6c\u66fe\u7ecf\u8bf4\u8fc7\uff1a\u201c\u6240\u4ee5\u5982\u679c\u5728\u5206\u6cbb\u7ed3\u6784\u4e0a\u5f88\u96be\u5feb\u901f\u5408\u5e76\u67d0\u4e9b\u4fe1\u606f\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5229\u7528\u5206\u5757\u6765\u505a\u3002\u201d\n- \u53cd\u8fc7\u6765\uff0c\u6211\u4eec\u5982\u679c\u60f3\u8981\u7528\u4efb\u4f55\u7684\u5206\u6cbb\u7ed3\u6784\u505a\u8fd9\u9053\u9898\uff0c\u6211\u4eec\u90fd\u9700\u8981\u53d1\u73b0\u4e00\u4e2a\u6027\u8d28\uff0c\u652f\u6301\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u6bd4\u66b4\u529b\u66f4\u5feb\u5730\u5408\u5e76\u533a\u95f4\u4fe1\u606f\u7684\u6027\u8d28\u3002\n- \u5982\u4f55\u627e\u5230\u652f\u6301\u5408\u5e76\u7684\u6027\u8d28\u5462\uff1f\u5728\u8fd9\u4e4b\u524d\u6211\u4eec\u5148\u4ecb\u7ecd\u4e00\u4e2a\u7b80\u5355\u7684\u7b97\u6cd5\u3002\n\n**\u732b\u6811\u5206\u6cbb**\n- [\u6709\u5173\u535a\u5ba2](https://www.luogu.com.cn/blog/command-block/yi-suo-chang-yong-di-shuo-ju-jie-gou-wei-hu-shou-fa)\u3002\n\n```cpp\n- \u9009\u53d6\u6240\u6709\u8be2\u95ee\u90fd\u5305\u542b\u7684\u67d0\u4e2a\u4f4d\u7f6e,\u5206\u522b\u5411\u5de6\u5411\u53f3\u9884\u5904\u7406\u67d0\u4e9b\u4e1c\u897f\u3002\n- \u5bf9\u4e8e\u8be2\u95ee\u7684\u56de\u7b54,\u53ea\u9700\u8981\u5728\u5de6\u7aef\u70b9\u53d6\u4fe1\u606f,\u5728\u53f3\u7aef\u70b9\u53d6\u4fe1\u606f,\u518d\u7ec4\u5408\u5373\u53ef\u3002\u8fd9\u8981\u6c42(\u7b54\u6848/\u72b6\u6001)\u80fd\u591f\u5408\u5e76\u3002\n- \u7136\u540e\u6211\u4eec\u5957\u7528\u732b\u6811\u5206\u6cbb,\u5c31\u80fd\u591f\u5904\u7406\u66f4\u4e00\u822c\u7684\u60c5\u51b5\u4e86\u3002\n```\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/4n1p4sv5.png)\n- \u4e0a\u56fe\u6587\u6765\u81ea\u5927\u4f6c\u7684\u535a\u5ba2\uff0c\u5927\u4f6c\u9ad8\u4ea7\u4f3c\u90a3\u5565\u3002\n- \u8fd9\u662f\u6211\u5728\u5237\u5927\u4f6c\u7684\u535a\u5ba2\u4e2d\u770b\u5230\u7684\u6700\u6709\u5e0c\u671b\u7684\u7bc7\u76ee\uff08\u8fd9\u662f\u56e0\u4e3a\u5b83\u53ea\u9700\u8981**\u4e00\u6b21**\u5408\u5e76\uff09\uff0c\u4f46\u662f\u5b83\u6709\u4e00\u4e2a\u8981\u6c42\uff1a\u90a3\u5c31\u662f\u4fe1\u606f\u80fd\u591f\u652f\u6301\u67d0\u79cd\u610f\u4e49\u4e0a\u7684\u5feb\u901f\u5408\u5e76\uff08\u5373\u4f7f\u53ea\u9700\u8981\u4e00\u6b21\uff0c\u5373\u4f7f\u53ea\u9700\u8981\u524d\u7f00\u4e0a\u5747\u503c\u80fd\u8fc7\uff09\uff0c\u90a3\u8fd9\u9053\u9898\u76ee\u662f\u5426\u6ee1\u8db3\u8fd9\u6837\u7684\u8981\u6c42\uff1f\n\n**\u6027\u8d28**\n- \u6211\u4eec\u540c\u6837\u901a\u8fc7 $O(n^2\\log n)$ \u7684\u505a\u6cd5\uff08\u6216\u83ab\u961f\u505a\u6cd5\uff09\uff0c\u4ece\u5355\u70b9\u4fe1\u606f\u7684\u66f4\u65b0\u63a8\u51fa\u533a\u95f4\u4fe1\u606f\u7684\u5408\u5e76\u3002\n- \u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u628a\u7b54\u6848\u8868\u793a\u6210\u4e00\u4e2a\u94fe\u8868\u7684\u5f62\u5f0f\uff0c\u6a2a\u5750\u6807\uff08\u76f8\u5bf9\u4f4d\u7f6e\uff09\u4ee3\u8868\u5176\u4f4d\u7f6e\uff0c\u7eb5\u5750\u6807\uff08\u76f8\u5bf9\u4f4d\u7f6e\uff09\u4ee3\u8868\u5176\u5927\u5c0f\uff0c\u8fde\u7ebf\u4ee3\u8868\u6709\u8d21\u732e\u7684\u76f8\u90bb\u5b57\u7b26\uff0c\u7b54\u6848\u5c31\u662f\u6bcf\u6761\u8fde\u7ebf\u5728\u6a2a\u5750\u6807\u4e0a\u7684\u6295\u5f71\u7684\u548c\u3002\n- \u66b4\u529b\uff08\u6216\u83ab\u961f\uff09\u7684\u589e\u5220\u64cd\u4f5c\u7684\u5f62\u5f0f\u662f\u8fd9\u6837\u7684\uff0c\u627e\u5230\u524d\u9a71\u548c\u540e\u7ee7\uff0c\u7136\u540e\u66f4\u65b0\u8ddd\u79bb\u7684\u5dee\u503c\u3002\n![](https://cdn.luogu.com.cn/upload/image_hosting/2ngp4o85.png)\n- \u8ba9\u6211\u4eec\u770b\u770b\u5b83\u5bf9\u4e24\u4e2a\u533a\u95f4\u7684\u60c5\u51b5\u5427\u3002\n![](https://cdn.luogu.com.cn/upload/image_hosting/cagvb83v.png)\n- \u6240\u4ee5\u6211\u4eec\u81f3\u5c11\u53ef\u4ee5\u770b\u5230\uff1a\u5982\u679c\u8981\u5feb\u901f\u5408\u5e76\u4e24\u4e2a\u533a\u95f4\u7684\u8bdd\uff0c\u9996\u5148\u6211\u4eec\u5173\u5fc3\u7684\u662f\u8fd9\u6837\u7684\u4e00\u4e9b\u6570\u5bf9\uff0c\u5b83\u8de8\u8fc7\u4e86\u5de6\u53f3\u4e24\u4e2a\u533a\u95f4\uff0c\u5982\u679c\u5f97\u5230\u4e86\u8fd9\u6837\u7684\u6570\u5bf9\uff0c\u6211\u4eec\u5373\u53ef\u652f\u6301\u5408\u5e76\u3002\n- \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53d1\u73b0\uff1a\u5176\u5b9e\u751a\u81f3\u6570\u5bf9\u6211\u4eec\u90fd\u4e0d\u9700\u8981\uff0c\u6211\u4eec\u5bf9\u539f\u56fe\u5288\u4e00\u5200\uff0c\u6211\u4eec\u5f88\u5feb\u53d1\u73b0\u6211\u4eec\u53ea\u9700\u8981\u5224\u65ad\u67d0\u4e2a\u70b9**\u662f\u5426\u5b58\u5728**\u6bd4\u539f\u5e8f\u5217\u66f4\u524d\u7684\u524d\u9a71\u548c\u540e\u7ee7\u3002\n![](https://cdn.luogu.com.cn/upload/image_hosting/z849km1e.png)\n- \u7b49\u7b49\uff0c\u56de\u5fc6\u732b\u6811\u7684\u8fc7\u7a0b\uff08\u4ece\u5206\u6cbb\u4e2d\u5fc3\u5411\u5de6\u5411\u53f3\u9884\u5904\u7406\u67d0\u4e9b\u4fe1\u606f\uff09\uff0c\u800c\u8fd9\u4e2a\u5224\u65ad\u662f\u6ee1\u8db3\u5355\u8c03\u6027\u7684\uff0c\u6240\u4ee5\u6211\u5b9e\u9645\u4e0a\u53ea\u9700\u8981\u5728\u5f53\u524d\u5904\u7406\u51fa\u8ba9\u5de6/\u53f3\u7aef\u70b9\u5b58\u5728\u66f4\u524d\u7684\u524d\u9a71/\u540e\u7ee7\u6240\u9700\u8981\u7684\u5de6/\u53f3\u533a\u95f4\u6240\u9700\u8981\u5ef6\u957f\u7684\u957f\u5ea6\uff0c\u4f7f\u7528 $\\text{set}$ \u5904\u7406\u8fd9\u4e2a\u95ee\u9898\u7684\u590d\u6742\u5ea6\u662f $O(n\\log n)$ \u7684\uff0c\u540e\u9762\u7684\u64cd\u4f5c\u76f8\u5bf9\u5e38\u89c4~~\u5bf9\u4e8e\u4f5c\u8005\u9664\u5916~~\uff1a\n- \u5bf9\u4e8e\u5177\u4f53\u7684\u732b\u6811\u5206\u6cbb\uff08\u5b9e\u73b0\u7ec6\u8282\uff09\uff0c\u5148\u8ba1\u7b97\u76ee\u6807\u533a\u95f4\u5de6\u8fb9\u90e8\u5206\u7684\u8d21\u732e\u548c\u53f3\u8fb9\u90e8\u5206\u7684\u8d21\u732e\uff0c\u8fd9\u91cc\u53ea\u8003\u8651\u5de6\u8fb9\u7684\u8d21\u732e\uff1a\n- \u9996\u5148\u5bf9\u76ee\u6807\u8be2\u95ee\u6392\u5e8f\u3002\u6211\u4eec\u4ece\u5206\u6cbb\u4e2d\u5fc3\u66b4\u529b\u5411\u5de6\u626b\uff0c\u7528 $\\text{set}$ \u7ef4\u62a4\u524d\u9a71\u540e\u7ee7\u5f62\u6210\u7684\u4e00\u4e2a\u6709\u5e8f\u94fe\u8868\uff0c\u7136\u540e\u6211\u4eec\u8003\u8651\u94fe\u8868\u4e4b\u95f4\u76f8\u90bb\u5143\u7d20\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff1a\n- \u4e5f\u5c31\u662f\u8003\u8651\u4e00\u6761\u8fb9\u7684\u8d21\u732e\uff0c\u5bb9\u6613\u53d1\u73b0\u5b83\u5206\u6210\u4e24\u4e2a\u90e8\u5206\uff1a\u5728\u8fd9\u4e24\u4e2a\u4e4b\u95f4\u6ca1\u6709\u4e00\u4e2a\u5143\u7d20\u65f6\u5019\u7684\u8d21\u732e\uff0c\u5728\u8fd9\u4e24\u4e2a\u4e4b\u95f4\u81f3\u5c11\u6709\u4e00\u4e2a\u5143\u7d20\u65f6\u5019\u7684\u8d21\u732e\uff0c\u6d89\u53ca\u7684\u533a\u95f4\u52a0\u6211\u4eec\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\uff0c\u800c\u67e5\u8be2\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u533a\u95f4\u67e5\u8be2\u64cd\u4f5c\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u7ebf\u6bb5\u6811\u3002\n- \u63a5\u4e0b\u6765\u7684\u64cd\u4f5c\u5c31\u663e\u5f97\u76f8\u5f53\u65e0\u8111\uff0c\u5220\u8fb9\u76f8\u5f53\u4e8e\u5220\u8d21\u732e\uff0c\u52a0\u8fb9\u76f8\u5f53\u4e8e\u52a0\u8d21\u732e\uff0c\u8fd8\u6709\u5565\u80fd\u6bd4\u8fd9\u4e2a\u66f4\u7b80\u5355\u5462\uff1f\n![](https://cdn.luogu.com.cn/upload/image_hosting/vnjnk5ab.png)\n- \u4ee5\u4e0a\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n\\log n)$\uff0c\u8fd9\u610f\u5473\u7740\u8fd9\u4e2a\u505a\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $O(n\\log^2n+m\\log n)$\u3002\n- \u82e5\u4f7f\u7528\u4e3b\u5e2d\u6811\u4ee3\u66ff\u90a3\u4e2a\u7ef4\u62a4\u533a\u95f4\u52a0\u7684\u6811\u72b6\u6570\u7ec4\u5219\u5bb9\u6613\u505a\u5230\u5728\u7ebf\uff0c\u53ea\u4e0d\u8fc7\u7a7a\u95f4\u9700\u6c42\u7565\u5927\u3002\n\n**\u4ee3\u7801\u5b9e\u73b0**\n- \u4e3a\u4e86\u8868\u8fbe\u4f5c\u8005\u5bf9\u81ea\u5df1\u601d\u7ef4\u5b9e\u73b0\u548c\u4ee3\u7801\u80fd\u529b\u7684\u6df1\u523b\u53cd\u7701~~\u540c\u65f6\u7167\u987e\u4f5c\u8005\u7684\u7801\u529b~~\uff0c\u4f5c\u8005\u51b3\u5b9a\u5199\u591a\u79cd\u590d\u6742\u5ea6\u7684\u505a\u6cd5\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/1nym1h20.png)\n- \u5404\u4f4d\u540c\u5fd7\u53ef\u4ee5\u60f3\u8c61\u4e00\u4e0b\u5f53\u65f6\u6211\u770b\u5230\u8fd9\u6bb5\u6587\u5b57\u7684\u5fc3\u60c5\uff0c\u6765\u81ea[\u8fd9\u7bc7](https://www.cnblogs.com/rainybunny/p/15851882.html)\uff0c\u90a3\u65f6\u6211\u5b8c\u5168\u770b\u4e0d\u61c2\u5927\u4f6c\u5728\u5199\u5565\u3002\n- $O(nm\\log n)$ \u66b4\u529b\u505a\u6cd5\uff1a[\u4ee3\u7801\u5b9e\u73b0](https://www.luogu.com.cn/paste/ja9updwx)\u3002\n- $O(n\\sqrt m\\log n)$ \u666e\u901a\u83ab\u961f\u505a\u6cd5\uff1a[\u4ee3\u7801\u5b9e\u73b0](https://www.luogu.com.cn/paste/rl59v6pi)\u3002\n- $O(n\\sqrt m\\log n/\\log w)$ \u538b $w=64$ \u4f4d $\\text{Trie}$ \u7ef4\u62a4\u666e\u901a\u83ab\u961f\u505a\u6cd5\uff1a[\u4ee3\u7801\u5b9e\u73b0](https://www.luogu.com.cn/paste/1869nobo)\u3002\n- ~~\u6570\u636e\u662f\u5426\u592a\u6c34~~\uff0c\u6211\u89c9\u5f97\u51fa\u9898\u7684\u65f6\u5019\u628a $m$ \u5f00\u5927\u4e00\u70b9\u53ef\u4ee5\u5361\u554a\uff0c\u4e0d\u5361\u83ab\u961f\u5b83\u548c\u83ab\u961f\u6a21\u677f\u6709\u5565\u533a\u522b\u3002\n- $O(n\\sqrt m)$ \u56de\u6eda\u83ab\u961f\u505a\u6cd5\uff08_\u4e0d\u52a0\u83ab\u961f_\uff09\uff1a[\u4ee3\u7801\u5b9e\u73b0](https://www.luogu.com.cn/paste/q333yn25)\u3002\n- $O(n\\sqrt m)$ \u503c\u57df\u5206\u5757\u505a\u6cd5\uff08_Ynoi \u98ce\u683c\u7684\u7eaf\u7eaf\u5206\u5757\u9884\u5904\u7406_\uff09\uff1a[\u4ee3\u7801\u5b9e\u73b0](https://www.luogu.com.cn/paste/bdztwffm)\uff08\u88ab\u5361\u5e38\uff09\u3002\n- $O(n\\log^2n+m\\log n)$ \u732b\u6811\u5206\u6cbb\uff08_polylog \u7684\u6b63\u89e3_\uff09\u505a\u6cd5\uff1a[\u4ee3\u7801\u5b9e\u73b0](https://www.luogu.com.cn/paste/amrdsmkz)\uff08\u88ab\u5361\u5e38\uff09\u3002\n- \u7efc\u4e0a\uff0c\u6211\u8ba4\u4e3a\u56de\u6eda\u83ab\u961f\u624d\u662f\u6b64\u9898\u6b63\u89e3\uff0c\u56e0\u4e3a\u56de\u6eda\u83ab\u961f\u4ee3\u7801\u6781\u77ed\uff0c\u800c\u4e14\u8fc7\u8fd9\u9898\u6839\u672c\u4e0d\u9700\u8981\u5361\u5e38\uff08\u6216\u8bb8\u662f\u6211\u7684\u5b9e\u73b0\u592a\u83dc\u4e86\uff09\u3002",
        "postTime": 1647511772,
        "uid": 260884,
        "name": "WeLikeStudying",
        "ccfLevel": 0,
        "title": "\u3010\u65e7\u4e8b\u91cd\u63d0\u3011\u79c3\u5b50\u914b\u957f"
    },
    {
        "content": "\u56de\u987e\u4e00\u4e0b\u8fd9\u9053\u6211\u7ffb\u8f66\u7684 DS... \u8d8a\u6765\u8d8a\u83dc\u4e86\n\n### \u5176\u4ed6\u505a\u6cd5\n\n\u4e24\u79cd\u6839\u53f7\u505a\u6cd5\u5927\u5bb6\u5e94\u8be5\u90fd\u4f1a\uff0c\u5c31\u4e0d\u8bb2\u4e86\u3002\n\n\u7b97\u4e86\u8fd8\u662f\u63d0\u4e00\u4e0b\uff1a\u5206\u5757\u5c31\u662f\u8003\u8651\u503c\u57df\u5757\u77e5\u9053\u524d\u9a71\u540e\u7ee7\u662f\u53ef\u4ee5\u5408\u5e76\u7684\uff0c\u53d8\u6210\u4e86 Set Merging\uff1b\u83ab\u961f\u5c31\u662f\u9700\u8981\u7ef4\u62a4\u524d\u9a71\u540e\u7ee7\uff0c\u5e26\u5220\u9664\u5bb9\u6613\u7528\u94fe\u8868\u7ef4\u62a4\u5c31\u56de\u6eda\u4e00\u4e0b\u3002\n\n### \u6b63\u89e3\n\n\u8bf4\u70b9\u524d\u7f6e\u8f6c\u5316\uff0c\u628a\u8fd9\u4e2a\u8fc7\u7a0b\u60f3\u8c61\u4e3a\uff1a\u6211\u4e00\u5f00\u59cb\u8eab\u5904 $[l,r]$ \u4e2d\u6700\u5c0f\u503c\u7684\u4f4d\u7f6e\uff0c\u9700\u8981\u5728\u5e8f\u5217\u4e0a\u8d70\u8def\u53bb\u6309\u6743\u503c\u987a\u5e8f\u904d\u5386 $[l,r]$ \u8fd9\u4e2a\u533a\u95f4\uff0c\u7b54\u6848\u662f\u6211\u8d70\u7684\u6b65\u6570\u3002\n\n\u79bb\u7ebf\u5206\u6cbb\uff0c$\\operatorname{Solve}(l,r)$ \u65f6\u89e3\u51b3\u8de8\u8d8a $mid = \\dfrac{l+r}{2}$ \u7684\u8be2\u95ee\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u8fd9\u4e2a\u8be2\u95ee\u662f $[L,R]$ \u7684\u8bdd\u6211\u628a\u5b83\u5288\u4e24\u534a\uff0c\u5206\u522b\u8ba1\u7b97\u51fa\u5728 $[L,mid]$ \u4e0e $[mid+1,R]$ \u4e2d\u8d70\u7684\u6b65\u6570\u3002\n\n\u4ee5 $[L,mid]$ \u4e3a\u4f8b\u6765\u8bf4\u660e\uff0c\u4ee4 $N$ \u4e3a\u533a\u95f4\u957f\u5ea6\u3002\u5047\u8bbe\u6211\u5df2\u7ecf\u77e5\u9053\u4e86\u533a\u95f4\u4e2d\u6743\u503c\u7684\u5927\u5c0f\u987a\u5e8f $p_1,p_2, \\ldots, p_{N}$ ($a_{p_1}<a_{p_2}<\\ldots<a_{p_{N}}$)\uff0c\u90a3\u4e48\u6211\u8003\u8651\u76f8\u90bb\u4e24\u4e2a\u6570 $p_i$ \u4e0e $p_{i+1}$ \u7684\u8d21\u732e $f(p_i,p_{i+1})$\uff1a\n\n- \u82e5 $a_{p_i}$ \u4e0e $a_{p_{i+1}}$ \u5728\u8be2\u95ee\u533a\u95f4 $[L,R]$ \u4e2d\u662f\u76f8\u90bb\u7684\u4e24\u4e2a\u6743\uff0c\u5219\u8d21\u732e\u4e3a $|p_i - p_{i+1}|$\uff1b\n- \u5426\u5219\u8d21\u732e\u4e3a $(mid-p_i)+(mid-p_{i+1})$\u3002\n\n\u6211\u4eec\u628a $i$ \u4ece $mid \\to l$ \u626b\uff0c\u6bcf\u6b21\u89e3\u51b3\u5de6\u7aef\u70b9\u4e3a $i$ \u7684\u8be2\u95ee\u3002\u6b64\u65f6\u76f8\u5f53\u4e8e\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20 $a_i$ \u540c\u65f6\u7ef4\u62a4\u8d21\u732e\u7684\u589e\u91cf\uff0c\u4e5f\u5c31\u662f $f(P,S)-f(P,a_i)-f(S,a_i)$\uff0c\u5176\u4e2d $P,S$ \u5206\u522b\u8868\u793a $a_i$ \u5728 $(i,mid]$ \u4e2d\u7684\u524d\u9a71\u540e\u7ee7\u3002\n\n\u6dfb\u6570\u67e5\u524d\u9a71\u540e\u7ee7\u53ef\u4ee5\u65f6\u95f4\u5012\u6d41 $O(N)$ \u7ef4\u62a4\u3002\u90a3\u4e48\u6211\u73b0\u5728\u624b\u4e0a\u6709 $O(N)$ \u7ec4 $f(x,y)$\uff0c\u9700\u8981\u5bf9\u4e8e\u5de6\u7aef\u70b9\u5728 $i$ \u7684\u6bcf\u4e2a\u53f3\u7aef\u70b9 $R$ \u6c42\u51fa\u8fd9\u4e9b $f$ \u7684\u548c\u3002\n\n\u73b0\u5728\u9700\u8981\u627e\u51fa\u5408\u7406\u7684\u65b9\u5f0f\u523b\u753b\u300c\u5728 $[L,R]$ \u4e2d\u76f8\u90bb\u300d\u8fd9\u4e2a\u6761\u4ef6\uff0c\u4e0d\u96be\u53d1\u73b0\u53ef\u4ee5\u4f7f\u7528\u300c\u4ece\u5de6\u5f80\u53f3\u7b2c\u4e00\u4e2a\u503c\u57df\u5728 $[p_i,p_{i+1}]$ \u7684\u4f4d\u7f6e $>R$\u300d\u6765\u505a\uff0c\u628a\u5b83\u8bb0\u4e3a $\\operatorname{find}(p_i,p_{i+1})$\u3002\u56de\u5230\u539f\u95ee\u9898\uff0c\u6211\u4eec\u5f97\u5230\u4e86 $f(x,y)$ \u7684\u53d6\u503c\uff1a\n\n$$\nf(x,y)=\\begin{cases}\n2mid-x-y &\\operatorname{find}(x,y)\\leq R\\\\\n|x-y| &\\rm{otherwise}\n\\end{cases}\n$$\n\n\u7edf\u8ba1\u5728\u626b\u5230 $L$ \u4e4b\u524d\u52a0\u5165\u3001\u4e14 $\\operatorname{find}(x,y)\\leq R$ ($>R$) \u7684 $\\sum f(x,y)$\uff0c\u660e\u793a\u79bb\u7ebf\u4e8c\u7ef4\u6570\u70b9\u3002\n\n\u53ef\u4ee5\u4f7f\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log^2 n+m \\log n)$\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u591a\u53c9\u7ebf\u6bb5\u6811\u5e73\u8861\u590d\u6742\u5ea6\u81f3 $O\\left(\\dfrac{(n+m) \\log^2 n}{\\log\\log n}\\right)$\u3002\n",
        "postTime": 1647611517,
        "uid": 78372,
        "name": "M4_SOPMODII_JR",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P8078 [WC2022] \u79c3\u5b50\u914b\u957f"
    },
    {
        "content": "## $\\mathcal{Question}$\n\n[P8078 [WC2022] \u79c3\u5b50\u914b\u957f](https://www.luogu.com.cn/problem/P8078)\n\n\u9898\u76ee\u610f\u601d\u6bd4\u8f83\u6e05\u6670\uff0c\u8fd9\u91cc\u5c31\u4e0d\u89e3\u91ca\u4e86\u3002\n\n## $\\mathcal{Solution}$\n\n\u6211\u4eec\u8003\u8651\u83ab\u961f\u3002\n\n\u9996\u5148 $\\Theta (n\\sqrt{n}\\ log\\ n)$ \u7684\u83ab\u961f\u662f\u633a\u597d\u60f3\u7684\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u6765\u7ef4\u62a4\u6bcf\u6b21\u6211\u4eec\u4e24\u4e2a\u6307\u9488\u679a\u4e3e\u5230\u7684\u5e8f\u5217\uff0c\u7b54\u6848\u66b4\u529b\u4fee\u6539\u5373\u53ef\u3002\n\n\u5982\u679c\u662f\u5e73\u8861\u6811\u4e4b\u7c7b\u7684\uff0c\u90a3\u4e48\u63d2\u5165\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(log\\ n)$\uff0c\u5982\u679c\u662f vector\uff0c\u90a3\u4e48\u63d2\u5165\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(\\text{\u7384\u5b66})$\uff0c\u4e8c\u5206\u67e5\u627e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(log\\ n)$\u3002\n\n\u65e0\u8bba\u600e\u4e48\u6837\uff0c\u8fd9\u4e2a\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u4e0d\u80fd\u901a\u8fc7\u6b64\u9898\u7684\u3002\n\n\u7531\u4e8e\u52a0\u5165\u7684\u65f6\u5019\u65f6\u95f4\u590d\u6742\u5ea6\u603b\u662f $\\Theta(log\\ n)$\u3002~~\uff08\u4e5f\u8bb8\u662f\u6211\u592a\u83dc\u4e86\u60f3\u4e0d\u51fa\u6765\uff09~~\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u53ea\u5220\u4e0d\u52a0\u56de\u6eda\u83ab\u961f\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u6570\u7684\u5220\u9664\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u7528\u94fe\u8868\u3002\n\n\u4f46\u662f C++ \u81ea\u5e26\u7684\u94fe\u8868\u65e0\u6cd5\u5feb\u901f\u7684\u627e\u5230\u4e00\u4e2a\u6570\u7684\u4f4d\u7f6e\u3002~~\uff08\u4e5f\u8bb8\u53c8\u662f\u6211\u900a\u4e86\uff09~~\n\n\u6211\u4eec\u5c31\u8003\u8651\u53cc\u5411\u94fe\u8868\u3002\n\n\u53cc\u5411\u94fe\u8868\u5c31\u662f\u5c06\u94fe\u8868\u7528\u6570\u7ec4\u7684\u5f62\u5f0f\u50a8\u5b58\u4e0b\u6765\u3002\n\n\u6211\u4eec\u5b9a\u4e49\u4e24\u4e2a\u6570\u7ec4 $L$ \u548c $R$\u3002\n\n$L_i$ \u8868\u793a $i$ \u8282\u70b9\u5de6\u8fb9\u7684\u8282\u70b9\u7f16\u53f7\u3002\n\n$R_i$ \u8868\u793a $i$ \u8282\u70b9\u53f3\u8fb9\u7684\u8282\u70b9\u7f16\u53f7\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u4ee5\u6743\u503c\u4f5c\u4e3a\u5173\u952e\u5b57\u6765\u5efa\u7acb\u53cc\u5411\u94fe\u8868\u3002\n\n\u610f\u601d\u5c31\u662f $L_{a_i}$ \u8868\u793a $i$ \u8282\u70b9\u5de6\u8fb9\u7684\u8282\u70b9\u7684\u6743\u503c\uff0c$R_{a_i}$ \u8868\u793a $i$ \u8282\u70b9\u53f3\u8fb9\u7684\u8282\u70b9\u7684\u6743\u503c\u3002\n\n\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u5feb\u901f\u7684\u627e\u5230\u4e00\u4e2a\u6570\u7684\u4f4d\u7f6e\u3002\uff08\u4e5f\u5c31\u662f\u5b83\u5de6\u53f3\u4e24\u8fb9\u7684\u6570\uff09\n\n\u53cc\u5411\u94fe\u8868\u7684\u63d2\u5165\u548c\u5220\u9664\u4e5f\u90fd\u662f $\\Theta(1)$ \u7684\u3002\n\n\u5728 $a$ \u548c $b$ \u8282\u70b9\u4e4b\u95f4\u63d2\u5165 $x$ \u8282\u70b9\u3002\n\n```cpp\nL[x] = a; R[x] = b;\nR[a] = x; L[b] = x;\n```\n\n\u628a $a$ \u548c $b$ \u8282\u70b9\u4e4b\u95f4\u7684 $x$ \u8282\u70b9\u5220\u9664\u3002\n\n```cpp\nL[a] = b;\nR[b] = a;\n```\n\u7136\u540e\u6211\u4eec\u66b4\u529b\u66f4\u65b0\u7b54\u6848\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n\\sqrt{n})$\u3002\n\n\u4f46\u662f\u8fd9\u9053\u9898\u7684\u7b2c $17$ \u4e2a\u6d4b\u8bd5\u70b9\u5e76\u4e0d\u662f\u5f88\u53cb\u597d\u3002\n\n\u6211\u4eec\u52a0\u4e0a\u5feb\u8bfb\uff0c\u5e76\u4e14\u5c06\u5757\u957f\u8bbe\u6210 $1000$ \u5c31\u80fd\u5361\u8fc7\u53bb\u4e86\u3002\n\n## $\\mathcal{Code}$\n\n\u5341\u5e74 OI \u4e00\u573a\u7a7a\uff0c\u4e0d\u5f00 long long \u89c1\u7956\u5b97\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long LL;\nstatic char buf[100010], *p1 = buf, *p2 = buf;\n#define gc p1 == p2 && (p2 = (p1 = buf) + fread(buf, 1, 100010, stdin), p1 == p2)? EOF: *p1++\ninline int read() {\n\tint res = 0, w = 0;\n\tchar c = gc;\n\twhile (!isdigit(c))\n\t\tw ^= c == '-', c = gc;\n\twhile (isdigit(c))\n\t\tres = (res << 1) + (res << 3) + (c ^ 48), c = gc;\n\treturn (w? -res: res);\n}\ninline void write(LL x) {\n\tstatic int sta[50], top = 0;\n\tif (x < 0) putchar('-'), x = -x;\n\tdo {\n\t\tsta[ top++ ] = x % 10;\n\t\tx /= 10;\n\t} while (x);\n\twhile (top) putchar(sta[ --top ] + 48);\n\tputchar('\\n');\n}\nconst int MAXN = 5e5 + 10;\nint n, m, a[MAXN], siz, bnum, belong[MAXN];\nLL ans[MAXN];\nstruct query {\n\tint l, r, id;\n}q[MAXN];\nint L[MAXN], R[MAXN], cnt[MAXN];\ninline bool cmp(query a, query b) {\n\tif (belong[ a.l ] ^ belong[ b.l ]) return belong[ a.l ] < belong[ b.l ];\n\treturn a.r > b.r;\n}\ninline int doit(int Qnum, int x) {\n\tmemset(L, 0, sizeof(L));\n\tmemset(R, 0, sizeof(R));\n\tmemset(cnt, 0, sizeof(cnt));\n\tint left = (x - 1) * siz + 1;\n\tint l = left, r = q[Qnum].r, i = Qnum, last = 0;\n\tLL now = 0;\n\tfor (int i = l; i <= r; i++)\n\t\tcnt[ a[i] ] = i;\n\tfor (int i = 1; i <= n; i++)\n\t\tif (cnt[i]) {\n\t\t\tif (last) now += 1ll * abs(cnt[i] - cnt[last]);\n\t\t\tR[last] = i;\n\t\t\tL[i] = last;\n\t\t\tlast = i;\n\t\t}\n\tfor (; belong[ q[i].l ] == x; i++) {\n\t\twhile (r > q[i].r) {\n\t\t\tint Left = L[ a[r] ], Right = R[ a[r] ];\n\t\t\tif (Left) now -= 1ll * abs(cnt[ a[r] ] - cnt[Left]);\n\t\t\tif (Right) now -= 1ll * abs(cnt[Right] - cnt[ a[r] ]);\n\t\t\tif (Left && Right) now += 1ll * abs(cnt[Right] - cnt[Left]);\n\t\t\tR[Left] = Right;\n\t\t\tL[Right] = Left;\n\t\t\tcnt[ a[r] ] = 0;\n\t\t\tr--;\n\t\t}\n\t\tLL temp = now;\n\t\twhile (l < q[i].l) {\n\t\t\tint Left = L[ a[l] ], Right = R[ a[l] ];\n\t\t\tif (Left) now -= 1ll * abs(cnt[ a[l] ] - cnt[Left]);\n\t\t\tif (Right) now -= 1ll * abs(cnt[Right] - cnt[ a[l] ]);\n\t\t\tif (Left && Right) now += 1ll * abs(cnt[Right] - cnt[Left]);\n\t\t\tR[Left] = Right;\n\t\t\tL[Right] = Left;\n\t\t\tcnt[ a[l] ] = 0;\n\t\t\tl++;\n\t\t}\n\t\tans[ q[i].id ] = now;\n\t\tnow = temp;\n\t\tfor (int j = left; j < l; j++) {\n\t\t\tint Left = L[ a[j] ], Right = R[ a[j] ];\n\t\t\tR[Left] = a[j];\n\t\t\tL[Right] = a[j];\n\t\t\tcnt[ a[j] ] = j;\n\t\t}\n\t\tl = left;\n\t}\n\treturn i;\n}\nint main() {\n\tn = read(); m = read(); siz = 1000; bnum = (n - 1) / siz + 1;\n\tfor (int i = 1; i <= bnum; i++)\n\t\tfor (int j = (i - 1) * siz + 1; j <= min(n, i * siz); j++)\n\t\t\tbelong[j] = i;\n\tfor (int i = 1; i <= n; i++) a[i] = read();\n\tfor (int i = 1; i <= m; i++) {\n\t\tq[i].l = read(); q[i].r = read();\n\t\tq[i].id = i;\n\t}\n\tsort(q + 1, q + m + 1, cmp);\n\tint Qnum = 1;\n\tfor (int i = 1; i <= bnum; i++) {\n\t\tQnum = doit(Qnum, i);\n\t}\n\tfor (int i = 1; i <= m; i++)\n\t\twrite(ans[i]);\n\treturn 0;\n}\n```\n\u5b8c\u7ed3\u6492\u82b1 ^_\u306e",
        "postTime": 1647661052,
        "uid": 355448,
        "name": "Fido_Puppy",
        "ccfLevel": 0,
        "title": "P8078 [WC2022] \u79c3\u5b50\u914b\u957f"
    },
    {
        "content": "## \u505a\u6cd5\n\n\u83ab\u961f\u3002\n\n\u8fd9\u9053\u9898\u663e\u7136\u8981\u7ef4\u62a4\u4e00\u4e2a\u6709\u5e8f\u7684\u5e8f\u5217\uff0c\u652f\u6301\u63d2\u5165\u3001\u5220\u9664\u548c\u6c42\u524d\u9a71\u540e\u7ee7\u3002\n\n\u53d1\u73b0\u53ef\u4ee5\u79bb\u7ebf\uff0c\u6570\u636e\u8303\u56f4\u4e5f\u5141\u8bb8\u6839\u53f7\u7b97\u6cd5\uff0c\u6240\u4ee5\u8003\u8651\u83ab\u961f\u3002\n\n\u5bb9\u6613\u53d1\u73b0\uff0c\u5982\u679c**\u6ca1\u6709\u63d2\u5165\u64cd\u4f5c\u7684\u8bdd\uff0c\u524d\u9a71\u540e\u7ee7\u53ea\u8981\u4eff\u7167\u53cc\u5411\u94fe\u8868\u5220\u9664\u7684\u65b9\u6cd5\u6765\u7ef4\u62a4\u5c31\u884c\u4e86**\u3002\u6240\u4ee5\u8003\u8651\u4e0d\u63d2\u5165\u7684\u56de\u6eda\u83ab\u961f\u3002\n\n\u4eff\u7167\u4e0d\u5220\u9664\u7684\u56de\u6eda\u83ab\u961f\uff1a\n\n\u9996\u5148**\u628a\u83ab\u961f\u533a\u95f4\u8bbe\u7f6e\u4e3a $[1,n]$**\u3002\n\n\u6392\u5e8f\u65f6\u5148\u6309\u5de6\u7aef\u70b9\u5757\u7f16\u53f7\u5347\u5e8f\u6392\u5e8f\uff0c\u5bf9\u4e8e\u5757\u7f16\u53f7\u4e00\u6837\u7684\u60c5\u51b5\uff0c\u6309\u53f3\u7aef\u70b9**\u964d\u5e8f**\u6392\u5e8f\u3002\u8fd9\u6837\u5c31\u80fd\u4fdd\u8bc1\u5de6\u7aef\u70b9\u5757\u7f16\u53f7\u76f8\u540c\u7684\u8be2\u95ee\u53f3\u7aef\u70b9**\u53ea\u9700\u8981\u6536\u7f29\u800c\u4e0d\u9700\u8981\u6269\u5c55\u4e86**\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c**\u5bf9\u4e8e\u5de6\u7aef\u70b9\u548c\u53f3\u7aef\u70b9\u5728\u540c\u4e00\u5757\u5185\u7684\u60c5\u51b5\uff0c\u4e0d\u9700\u8981\u66b4\u529b\u5904\u7406**\u3002\n\n\u8003\u8651\u5904\u7406\u8fde\u7eed\u7684\u4e00\u6bb5\u5de6\u7aef\u70b9\u5757\u7f16\u53f7\u76f8\u540c\u7684\u8be2\u95ee\u3002\u53ef\u4ee5**\u5148\u628a\u83ab\u961f\u533a\u95f4\u53f3\u7aef\u70b9\u79fb\u5230 $n$\uff0c\u5de6\u7aef\u70b9\u4e3a\u5f53\u524d\u5757\u7684\u5de6\u7aef\u70b9**\uff0c\u6bcf\u6b21\u7f29\u533a\u95f4\u7684\u65f6\u5019\u53f3\u7aef\u70b9\u5c31\u53ef\u4ee5\u4fdd\u6301\u53ea\u5f80\u5de6\u7f29\u4e86\u3002\u7531\u4e8e\u5de6\u7aef\u70b9\u4e0d\u4e00\u5b9a\u53ea\u5f80\u53f3\u8fb9\u7f29\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981**\u5148\u628a\u53f3\u7aef\u70b9\u7f29\u5b8c\uff0c\u518d\u628a\u5de6\u7aef\u70b9\u7f29\u5230\u9002\u5f53\u7684\u4f4d\u7f6e\uff0c\u6c42\u51fa\u5f53\u524d\u7684\u7b54\u6848**\u3002\n\n\u548c\u4e0d\u5220\u9664\u7684\u56de\u6eda\u83ab\u961f\u4e0d\u4e00\u6837\u7684\u662f\uff0c**\u7f29\u5de6\u7aef\u70b9\u548c\u53f3\u7aef\u70b9\u65f6\u8981\u628a\u4e00\u8def\u4e0a\u66f4\u6539\u7684\u524d\u9a71\u540e\u7ee7\u7528\u6808\u8bb0\u5f55\u4e0b\u6765\uff0c\u8fd9\u6837\u6267\u884c\u201c\u56de\u6eda\u201d\u64cd\u4f5c\u65f6\u5c31\u80fd\u6210\u529f\u6062\u590d\u4e86\uff0c\u5904\u7406\u4e0b\u4e00\u4e2a\u5757\u65f6\u53f3\u7aef\u70b9\u4e5f\u80fd\u987a\u5229\u6062\u590d\u5230 $n$**\u3002\n\n\u6c42\u51fa\u5f53\u524d\u7b54\u6848\u540e\u5c31\u9700\u8981\u8fdb\u884c\u201c\u56de\u6eda\u201d\u64cd\u4f5c\u4e86\uff0c\u5177\u4f53\u5c31\u662f**\u6309\u7167\u6808\u4e2d\u7684\u503c\u6765\u66f4\u65b0\u7b54\u6848\u5e76\u4e14\u6269\u5c55\u5de6\u7aef\u70b9**\u3002\n\n\u6ce8\u610f**\u8981\u7279\u5224\u6ca1\u6709\u524d\u9a71\u6216\u8005\u540e\u7ee7\u7684\u8282\u70b9**\uff0c\u7136\u540e\u5c31\u662f**\u8981\u5f00 `long long`**\u3002\n\n## AC \u4ee3\u7801\n\n```cpp\n#include <iostream>\n#include <algorithm>\n#include <cstdio>\n#include <cmath>\n\nusing namespace std;\n\nconst long long MS=500005;\n\nstruct pr\n{\n\tint x,y;\n}b[MS];\n\nstruct tr\n{\n\tint x,y,z;\n}sta[MS];\n\nstruct node\n{\n\tint l,r,id;\n}que[MS];\n\nint n,m,blo;\nint L[MS],a[MS];\nint fir[MS],nxt[MS];\nlong long preans,ans[MS];\nint top;\n\ninline bool cmp(node x,node y)\n{\n\tint xid=(x.l-1)/blo+1,yid=(y.l-1)/blo+1;\n\treturn xid!=yid?x.l<y.l:x.r>y.r;\n}\n\ninline bool cmp2(pr x,pr y)\n{\n\treturn x.x<y.x;\n}\n\ninline void del(int x)\n{\n\tint lb=fir[x],rb=nxt[x];\n\tsta[++top]=(tr){lb,x,rb};\n\tnxt[lb]=rb;\n\tif(rb==x)\n\t{\n\t\tnxt[lb]=lb;\n\t}\n\tfir[rb]=lb;\n\tif(lb==x)\n\t{\n\t\tfir[rb]=rb;\n\t}\n\tpreans-=abs(x-lb)+abs(x-rb);\n\tif(lb!=x&&rb!=x)\n\t{\n\t\tpreans+=abs(lb-rb);\n\t}\n}\n\ninline void bak()\n{\n\tint lb=sta[top].x,x=sta[top].y,rb=sta[top].z;\n\ttop--;\n\tfir[x]=lb;\n\tif(lb!=x)\n\t{\n\t\tnxt[lb]=x;\n\t}\n\tnxt[x]=rb;\n\tif(rb!=x)\n\t{\n\t\tfir[rb]=x;\n\t}\n\tif(lb!=x&&rb!=x)\n\t{\n\t\tpreans-=abs(lb-rb);\n\t}\n\tpreans+=abs(x-lb)+abs(x-rb);\n}\n\nint main()\n{\n\tscanf(\"%d%d\",&n,&m);\n\tblo=sqrt(n);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d\",&a[i]);\n\t\tb[i].x=a[i];\n\t\tb[i].y=i;\n\t\tL[i]=(i-1)/blo!=(i-2)/blo||i==1?i:L[i-1];\n\t}\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tscanf(\"%d%d\",&que[i].l,&que[i].r);\n\t\tque[i].id=i;\n\t}\n\tsort(que+1,que+m+1,cmp);\n\tint lpos=1,rpos=n;\n\tsort(b+1,b+n+1,cmp2);\n\tfir[b[1].y]=b[1].y;\n\tnxt[b[n].y]=b[n].y;\n\tfor(int i=2;i<=n-1;i++)\n\t{\n\t\tfir[b[i].y]=b[i-1].y;\n\t\tnxt[b[i-1].y]=b[i].y;\n\t\tnxt[b[i].y]=b[i+1].y;\n\t\tfir[b[i+1].y]=b[i].y;\n\t\tpreans+=abs(b[i].y-b[i-1].y);\n\t}\n\tpreans+=abs(b[n].y-b[n-1].y);\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tint l=que[i].l,r=que[i].r,id=que[i].id;\n\t\tint LL=L[l],lstL=L[que[i-1].l];\n\t\tif(LL!=lstL)\n\t\t{\n\t\t\twhile(top>0) bak();\n\t\t\tlpos=max(1,lstL);\n\t\t\trpos=n;\n\t\t\twhile(lpos<LL) del(lpos++);\n\t\t\ttop=0;\n\t\t}\n\t\twhile(rpos>r) del(rpos--);\n\t\twhile(lpos<l) del(lpos++);\n\t\tans[id]=preans;\n\t\twhile(lpos>LL) bak(),lpos--;\n\t}\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tprintf(\"%lld\\n\",ans[i]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1647256839,
        "uid": 251130,
        "name": "lovely_ckj",
        "ccfLevel": 0,
        "title": "P8078 [WC2022] \u79c3\u5b50\u914b\u957f \u9898\u89e3"
    },
    {
        "content": "\u6cea\u6d12\u8003\u573a\u7684\u4e00\u9053\u9898...\n\n\u9996\u5148\u662f\u83ab\u961f\u7684 $O(n \\sqrt n logn)$ \u505a\u6cd5\u3002\u5177\u4f53\u5b9e\u73b0\u5c31\u662f\u5728\u505a\u666e\u901a\u83ab\u961f\u7684\u8fc7\u7a0b\u4e2d\u7528\u4e00\u4e2aset\u6765\u5b9e\u65f6\u7ef4\u62a4\u6392\u5e8f\u540e\u7684\u5e8f\u5217\u3002\u5728\u63d2\u5165\u4e00\u4e2a\u6570\u65f6\u52a0\u4e0a\u5b83\u4e0e\u5176\u524d\u9a71\u548c\u540e\u7ee7\u7684\u8d21\u732e\uff0c\u5728\u5220\u9664\u4e00\u4e2a\u6570\u65f6\u53bb\u6389\u5b83\u7684\u8d21\u732e\u5e76\u628a\u539f\u524d\u9a71\u540e\u7f00\u7684\u8d21\u732e\u8865\u4e0a\u3002\u901a\u8fc7\u6b64\u6cd5\u53ef\u4ee5\u62ff\u5230 $50pt$ \uff08\u6211\u8003\u573a\u4e0a\u4ee5\u4e3a\u80fd\u62ff60\uff09\u3002\n\n\u7136\u540e\u6211\u5728\u8003\u573a\u4e0a\u4e5f\u60f3\u8fc7\u4f18\u5316\uff0c\u6211\u60f3\u5230\u4e86\u53ea\u52a0\u7248\u672c\u7684\u56de\u6eda\u83ab\u961f\uff0c\u4f46\u662f\u89c9\u5f97\u53ea\u52a0\u7684\u590d\u6742\u5ea6\u4e0e\u666e\u901a\u83ab\u961f\u5dee\u4e0d\u591a\uff0c\u5c31\u628a\u56de\u6eda\u83ab\u961fpass\u4e86\u3002\u7ed3\u679c\u8003\u540e\u542c\u540c\u5b66\u8bf4\u53ef\u4ee5\u7528\u53ea\u5220\u56de\u6eda\u83ab\u961f![/dk](https://cdn.luogu.com.cn/upload/pic/62228.png)\uff0c\u5c31\u53ef\u4ee5\u628a $log$ \u53bb\u6389\u3002\n\n\u8003\u8651\u4e00\u4e0b\u53ea\u52a0[\u56de\u6eda\u83ab\u961f](https://lookcatbox.blog.luogu.org/hui-gun-mu-dui-chu-bu-zong-jie)\u548c\u666e\u901a\u83ab\u961f\u7684\u590d\u6742\u5ea6\u74f6\u9888\u3002\u6ca1\u9519\uff0c\u5c31\u662f\u67e5\u627e\u524d\u9a71\u540e\u7ee7\u3002\u5728\u4e00\u822c\u7684\u60c5\u51b5\u4e0b\uff0c\u67e5\u627e\u524d\u9a71\u540e\u7ee7\u7684\u590d\u6742\u5ea6\u662f\u4e00\u4e2a\u4e0d\u53ef\u7701\u7565\u7684 $log$ \u3002\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u9884\u5148\u628a\u524d\u9a71\u540e\u7ee7\u7ef4\u62a4\u597d\u3002\u5177\u4f53\u800c\u8a00\uff0c\u6211\u4eec\u5c06\u53ea\u52a0\u56de\u6eda\u83ab\u961f\u7684 $l$ \u6307\u9488\u4ece\u5f53\u524d\u5757\u53f3\u7aef\u70b9\u5411\u5de6\u626b\u5230\u5f53\u524d\u8be2\u95ee\u5de6\u7aef\u70b9\uff0c\u6539\u4e3a\u4ece\u5f53\u524d\u5757\u5de6\u7aef\u70b9\u5411\u53f3\u626b\u5230\u5f53\u524d\u8be2\u95ee\u5de6\u7aef\u70b9\u3002\u5728\u5c06\u6307\u9488\u590d\u4f4d\u5230\u5f53\u524d\u5757\u5de6\u7aef\u70b9\u65f6\u76f4\u63a5\u5c06\u6574\u4e2a\u5757\u7684\u5143\u7d20\u52a0\u5165\u94fe\u8868\uff0c\u5e76\u5728\u626b\u5230\u5f53\u524d\u8be2\u95ee\u5de6\u7aef\u70b9\u7684\u8fc7\u7a0b\u4e2d\u5c06\u5143\u7d20\u4ece\u94fe\u8868\u4e2d\u4e00\u4e00\u5220\u9664\u3002\u5bf9\u4e8e\u53f3\u7aef\u70b9\u540c\u7406\uff0c\u6392\u5e8f\u8be2\u95ee\u65f6\u6211\u4eec\u5c06\u5de6\u7aef\u70b9\u5728\u540c\u4e00\u4e2a\u5757\u5185\u7684\u8be2\u95ee\u6309\u53f3\u7aef\u70b9\u964d\u5e8f\u6392\u5e8f\uff0c\u5c06\u5f53\u524d\u5757\u53f3\u7aef\u70b9\u5230 $n$ \u7684\u5143\u7d20\u52a0\u5165\u94fe\u8868\uff0c\u4e4b\u540e $r$ \u6307\u9488\u4ece $n$ \u5f80\u5f53\u524d\u8be2\u95ee\u53f3\u7aef\u70b9\u626b\uff0c\u5e76\u6267\u884c\u5220\u9664\u64cd\u4f5c\u3002\u7531\u4e8e\u6211\u4eec\u4e00\u5f00\u59cb\u5c31\u5c06\u6240\u6709\u5143\u7d20\u52a0\u5165\u4e86\u94fe\u8868\uff0c\u56e0\u6b64\u5728\u5220\u9664\u4e00\u4e2a\u5143\u7d20\u65f6\u67e5\u8be2\u5143\u7d20\u7684\u524d\u9a71\u540e\u7ee7\u7684\u590d\u6742\u5ea6\u662f $O(1)$ \u7684\u3002\u603b\u590d\u6742\u5ea6 $O(n \\sqrt n)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/ccfkmcd3.png)\n\n\u603b\u7ed3\u4e00\u4e0b\u6d41\u7a0b\uff1a\n\n- \u5c06 $1 \\sim n$ \u7684\u5143\u7d20\u52a0\u5165\u94fe\u8868\n\n- \u5904\u7406\u5f53\u524d\u5757\u7684\u8be2\u95ee\n\n----\n\n**\u5bf9\u4e00\u4e2a\u5757\u5185\u7684\u6240\u6709\u8be2\u95ee\u800c\u8a00**\n\n- \u5c06 $l$ \u6307\u9488\u6062\u590d\u5230\u5f53\u524d\u5757\u5de6\u7aef\u70b9\uff0c\u5e76\u6d88\u9664\u4e0a\u4e00\u4e2a\u8be2\u95ee $l$ \u6307\u9488\u9020\u6210\u7684\u8d21\u732e\u3002\n\n- $l$ \u6307\u9488\u4ece\u5f53\u524d\u5757\u5de6\u7aef\u70b9\u626b\u5230\u5f53\u524d\u8be2\u95ee\u5de6\u7aef\u70b9\uff0c$r$ \u6307\u9488\u4ece\u4e0a\u4e00\u4e2a\u8be2\u95ee\u53f3\u7aef\u70b9\u626b\u5230\u8fd9\u4e00\u4e2a\u8be2\u95ee\u53f3\u7aef\u70b9\uff0c\u5e76\u628a\u4e24\u4e2a\u6307\u9488\u626b\u5230\u7684\u533a\u57df\u5220\u9664\u3002\n\n----\n\n- \u5c06\u5f53\u524d\u5757\u7684\u8d21\u732e\u6d88\u9664\uff0c\u5904\u7406\u4e0b\u4e00\u4e2a\u5757\u7684\u8d21\u732e\u3002\n\n\u672c\u9898\u5230\u6b64\u5b8c\u5168\u89e3\u51b3~~\u5176\u5b9e\u8fd9\u4e2a\u505a\u6cd5\u4e0d\u662flxl\u7684\u6b63\u89e3~~\u4ee3\u7801\u5495\u5495\u4e86\u3002\n",
        "postTime": 1647662197,
        "uid": 124918,
        "name": "LinkyChristian",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011P8078 [WC2022] \u79c3\u5b50\u914b\u957f"
    },
    {
        "content": "\u8003\u573a\u4e0a\u5199\u7684\u4ee3\u7801\u6302\u4e86 $30$ \u5206\uff08\n\n\u9996\u5148\u8003\u8651\u7eaf\u66b4\u529b\uff0c\u6bcf\u4e00\u6b21\u904d\u5386 $[l,r]$ \u5c06\u503c\u63d2\u5165 `set` \u4e2d\uff0c\u540c\u65f6\u6839\u636e\u524d\u9a71\u540e\u7ee7\u66f4\u65b0\u7b54\u6848\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(nm\\log n)$\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u53ef\u4ee5\u57fa\u4e8e\u521a\u624d\u7684\u66b4\u529b\u5199\u83ab\u961f\uff0c\u5c06\u65f6\u95f4\u590d\u6742\u5ea6\u4f18\u5316\u81f3 $O(n\\sqrt m \\log n)$\uff0c\u80fd\u8fc7 $40$ \u5206\u3002\n\n\u8003\u8651\u600e\u4e48\u7529\u6389 $\\log$\u3002\u56e0\u4e3a\u83ab\u961f\u662f\u201c\u4f18\u96c5\u7684\u66b4\u529b\u201d\uff0c\u66b4\u529b\u80fd\u4f18\u5316\u7684\uff0c\u83ab\u961f\u57fa\u672c\u5c31\u80fd\u4f18\u5316\uff0c\u56e0\u6b64\u4e0d\u59a8\u4ece\u6700\u521d\u7684\u66b4\u529b\u7740\u624b\u3002\u4e0d\u96be\u53d1\u73b0\u7528 `set` \u7ef4\u62a4\u524d\u9a71\u540e\u7ee7\u5bfc\u81f4\u6211\u4eec\u989d\u5916\u201c\u6392\u5e8f\u201d\u4e86\u5f88\u591a\u6b21\uff0c\u800c\u5b9e\u9645\u4e0a\u6211\u4eec\u53ea\u8981\u6392\u5e8f\u4e00\u6b21\u5176\u5b9e\u5c31\u591f\u4e86\uff1a\u9884\u5904\u7406\u65f6\u5c06 $a$ \u6392\u5e8f\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u8be2\u95ee\uff0c\u6211\u4eec\u626b\u4e00\u904d\u6392\u5e8f\u540e\u7684 $a$\uff08\u8fd9\u65f6\u6211\u4eec\u77e5\u9053\u6bcf\u4e2a\u6570\u5728\u539f\u5e8f\u5217\u4e2d\u5bf9\u5e94\u7684\u4f4d\u7f6e\uff09\uff0c\u4e8e\u662f\u5c31\u80fd $O(n)$ \u5904\u7406\u51fa $[l,r]$ \u6392\u5e8f\u540e\u7684\u5e8f\u5217\u6c42\u5f97\u7b54\u6848\u3002\n\n\u8003\u8651\u4f7f\u7528\u83ab\u961f\u8fdb\u884c\u8fd9\u4e00\u8fc7\u7a0b\uff0c\u7528\u94fe\u8868\u7ef4\u62a4\u5728\u5f53\u524d\u533a\u95f4\u5185\u7684\u6570\u6392\u5e8f\u540e\u7684\u5e8f\u5217\uff0c\u5219\u53ef\u4ee5 $O(1)$ \u67e5\u8be2\u67d0\u6570\u7684\u524d\u9a71\u540e\u7ee7\u3001\u5220\u9664\u67d0\u5143\u7d20\uff0c\u4f46\u63d2\u5165\u9700\u8981 $O(n)$ \u7684\u65f6\u95f4\u3002\u4e8e\u662f\u4f7f\u7528\u4e0d\u63d2\u5165\u83ab\u961f\uff08\u6bcf\u4e00\u5757\u5185\u6309 `R` \u964d\u5e8f\u6392\u5217\uff0c\u6bcf\u6b21\u5148\u5c06 `L` \u62c9\u56de\u5757\u7684\u5de6\u7aef\u70b9\uff0c\u4e4b\u540e\u79fb\u52a8 `R`\uff0c\u518d\u79fb\u52a8 `L`\uff0c\u5b8c\u6210\u540e\u56de\u9000 `L` \u8fdb\u884c\u7684\u6240\u6709\u64cd\u4f5c\uff09\u5373\u53ef $O(n\\sqrt m)$\u3002\n\n\u4ee3\u7801\u4e2d\u4f7f\u7528\u4e86\u81ea\u5df1\u7684\u5feb\u8bfb\u5e93\u3002**\u4e00\u5b9a\u8981\u81ea\u5df1\u5199\u7edd\u5bf9\u503c\u51fd\u6570\u3002**\n\n```cpp\n#include <algorithm>\n#include <cmath>\n#define ll long long\n\nconst int maxn = 5e5+9;\n\nstruct Query {\n    int l,r,ind,bid;\n    inline bool operator < (const Query& o) const {\n        if(bid == o.bid) return r > o.r;\n        return l < o.l;\n    }\n}qs[maxn];\nstruct pr {\n    int *p,v;\n};\n\nint a[maxn],bid[maxn],bl[maxn],br[maxn],pre[maxn],nxt[maxn],pos[maxn],top,n,q,head,tail,L,R;\npr sta[maxn];\nll ans[maxn],curans;\ndouble lxl;\n\ninline int Abs(int x) noexcept { return x>0?x:-x; }\n\nvoid Init(){\n    read(n,q);\n    lxl = (double)n/sqrt(q);\n    for(int i=1; i<=n; ++i) {\n        read(a[i]);\n        pos[a[i]]=i;\n        bid[i] = round(i/lxl);\n        if(!bl[bid[i]]) bl[bid[i]] = i;\n        br[bid[i]] = i;\n    }\n    for(int i=1; i<=q; ++i){\n        read(qs[i].l,qs[i].r);\n        qs[i].ind=i;\n        qs[i].bid=bid[qs[i].l];\n    }\n    std::sort(qs+1,qs+q+1);\n}\n\ninline void InitBid(int p) noexcept {\n    curans=0; head=tail=0;\n    for(int i=1; i<=n; ++i){\n        if(pos[i] >= bl[p]) {\n            if(tail) {\n                nxt[tail] = i;\n                pre[i] = tail;\n                curans += Abs(pos[i]-pos[tail]);\n            } else head=i;\n            tail=i;\n        }\n    }\n    nxt[tail]=pre[head]=0;\n}\n\ninline void ShrinkR() noexcept {\n    int now = a[R--];\n    if(nxt[now]){\n        pre[nxt[now]] = pre[now];\n        curans -= Abs(pos[now]-pos[nxt[now]]);\n    }\n    if(pre[now]) {\n        nxt[pre[now]]=nxt[now];\n        curans -= Abs(pos[now]-pos[pre[now]]);\n    }\n    if(nxt[now] && pre[now]) curans += Abs(pos[pre[now]]-pos[nxt[now]]);\n}\ninline void ShrinkL() noexcept {\n    int now = a[L++];\n    if(nxt[now]){\n        sta[++top] = {&pre[nxt[now]],pre[nxt[now]]};\n        pre[nxt[now]] = pre[now];\n        curans -= Abs(pos[now]-pos[nxt[now]]);\n    }\n    if(pre[now]) {\n        sta[++top] = {&nxt[pre[now]],nxt[pre[now]]};\n        nxt[pre[now]] = nxt[now];\n        curans -= Abs(pos[now]-pos[pre[now]]);\n        if(nxt[now]) curans += Abs(pos[pre[now]]-pos[nxt[now]]);\n    }\n}\n\nvoid Solve() noexcept {\n    ll tmpans;\n    for(int i=1,p=-1; i<=q; ++i){\n        Query &now = qs[i];\n        if(now.bid != p){\n            InitBid(p = now.bid);\n            L=bl[p];\n            R=n;\n        }\n        while(R > now.r) ShrinkR();\n        top=0; tmpans = curans;\n        while(L < now.l) ShrinkL();\n        ans[now.ind] = curans;\n        curans = tmpans;\n        while(top){\n            *sta[top].p = sta[top].v;\n            --top;\n        }\n        L = bl[p];\n    }\n}\n\nint main(){\n    Init();\n    Solve();\n    for(int i=1; i<=q; i++) writeln(ans[i]);\n    fastio_flush();\n    return 0;\n}\n```\n",
        "postTime": 1647511498,
        "uid": 130256,
        "name": "jia_shengyuan",
        "ccfLevel": 9,
        "title": "P8078 [WC2022] \u79c3\u5b50\u914b\u957f \u9898\u89e3"
    }
]