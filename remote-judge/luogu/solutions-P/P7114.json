[
    {
        "content": "\u6211\u6709\u4e2a\u68a6\u60f3\uff0c\u6211\u60f3\u5199\u4e00\u7bc7\u591a\u56fe\u7684\uff0c\u8bb2\u89e3\u7ec6\u7684\uff0c\u6ce8\u91ca\u591a\u7684\uff0c$O(nlog26)$\u590d\u6742\u5ea6\u7684\u9898\u89e3\u3002\n\n# \u524d\u7f6e\u77e5\u8bc6\n1. \u6811\u72b6\u6570\u7ec4 \u8fd9\u4e2a\u76f8\u4fe1\u80fd\u53c2\u52a0NOIP\u7684\u540c\u5b66\u90fd\u4f1a\u3002\n2. \u6269\u5c55KMP\u7b97\u6cd5 \u6a21\u677f\u9898\uff1a[P5410 \u3010\u6a21\u677f\u3011\u6269\u5c55 KMP\uff08Z \u51fd\u6570\uff09](https://www.luogu.com.cn/problem/P5410) \u8fd9\u9053\u9898\u6211\u4e5f\u5199\u4e86[\u9898\u89e3](https://www.luogu.com.cn/blog/nitubenben/solution-p5410)\uff0c\u6b22\u8fce\u8bc4\u8bba\u70b9\u8d5e\u56f4\u89c2\u3002\u8fd9\u9053\u6a21\u677f\u9898\u662f\u7d2b\u8272\u7684\uff0c\u5176\u5b9e\u4e00\u70b9\u4e5f\u4e0d\u96be\uff0c\u6211\u89c9\u5f97\u96be\u5ea6\u6709\u70b9\u865a\u6807\u4e86\uff0c\u76f8\u4fe1\u4f60\u770b\u4e86\u6211\u7684\u9898\u89e3\u5f88\u5feb\u5c31\u53ef\u4ee5\u5b66\u4f1a\u7684\u3002\n\n\u5982\u679c\u4f60\u4e0d\u4f1a\u6269\u5c55KMP\u7b97\u6cd5\uff0c\u5176\u5b9e\u4e5f\u4e0d\u5f71\u54cd\u4f60\u9605\u8bfb\u672c\u6587\uff0c\u53ea\u9700\u77e5\u9053\u8fd9\u4e2a\u7b97\u6cd5\u63d0\u4f9b\u4e86\u4e00\u4e2az\u51fd\u6570\u7684\u8ba1\u7b97\u65b9\u5f0f\u3002\n\n\u4e0d\u59a8\u8bbe\u8f93\u5165\u7684\u5b57\u7b26\u4e32\u662f$s$\uff0c\u4e0b\u6807\u4ece$0$\u5f00\u59cb\uff0c\u957f\u5ea6\u662f$n$\u3002\u7528$s[i,j]$\u8868\u793a$s$\u4e2d\u4ece\u4e0b\u6807$i$\u4f4d\u7f6e\u5230\u4e0b\u6807$j$\u4f4d\u7f6e\u7684\u5b50\u4e32\uff0c\u5305\u62ec$i$\u548c$j$\u3002\u90a3\u4e48$z[i]$\u8868\u793a$s[i,n-1]$\u4e0e$s$\u672c\u8eab\u7684\u6700\u957f\u516c\u5171\u524d\u7f00\u7684\u957f\u5ea6\u3002\n\n\u6bd4\u5982$z[0]$\u8868\u793a$s$\u4e0e$s$\u7684\u516c\u5171\u5b50\u4e32\u7684\u957f\u5ea6\uff0c\u90a3\u4e48$z[0]=n$\n\n$z[1]$\u8868\u793a$s$\u53bb\u6389\u5f00\u5934\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4ee5\u540e\uff0c\u548c\u81ea\u5df1\u7684\u6700\u957f\u516c\u5171\u524d\u7f00\u7684\u957f\u5ea6\uff0c\u4f9d\u6b21\u7c7b\u63a8\u3002\u6269\u5c55KMP\u7b97\u6cd5\u53ef\u4ee5\u5728$O(n)$\u65f6\u95f4\u5185\u6c42\u51fa$z$\u6570\u7ec4\u7684\u6240\u6709\u4f4d\u7f6e\u3002\n\n# \u679a\u4e3e\u5faa\u73af\u8282\u957f\u5ea6\n\n\u5148\u4e0d\u8003\u8651\u9898\u4e2d\u7684\u51fa\u73b0\u5947\u6570\u6b21\u8fd9\u4e2a\u6761\u4ef6\u3002\u5148\u8003\u8651\u628a$s$\u62c6\u6210$(AB)^kC$\u7684\u65b9\u6848\u6570\uff0c\u5176\u4e2d$AB$\u5408\u8d77\u6765\u662f\u4e00\u4e2a\u5faa\u73af\u8282\uff0c\u6211\u4eec\u5148\u8003\u8651\u4e00\u4e2a\u5faa\u73af\u8282\u6709\u591a\u957f\u3002\n\n\u4e0d\u59a8\u8bbe\u5faa\u73af\u8282\u957f\u5ea6\u4e3a$i$\uff0c\u7b2c\u4e00\u4e2a\u53d1\u73b0\u662f\uff0c\u53ea\u8981\u6ee1\u8db3$2 \\leq i \\leq n-1$\u90fd\u53ef\u4ee5\u3002\u56e0\u4e3a$A$\u548c$B$\u90fd\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u6240\u4ee5\u5faa\u73af\u8282\u957f\u5ea6\u81f3\u5c11\u662f$2$\u3002\u5faa\u73af\u8282\u957f\u5ea6\u6700\u591a\u662f$n-1$\uff0c\u56e0\u4e3a$C$\u4e5f\u4e0d\u80fd\u4e3a\u7a7a\u3002\n\n\u5f53\u5faa\u73af\u8282\u957f\u5ea6\u662f$i$\u7684\u65f6\u5019\uff0c\u81f3\u5c11$k$\u53ef\u4ee5\u53d6\u5230$1$\uff0c\u5c31\u662f\u53ea\u5faa\u73af\u4e00\u6b21\uff0c\u540e\u9762\u5269\u4e0b\u7684\u90fd\u7ed9$C$\u3002\u9664\u6b64\u4e4b\u5916\uff0ck\u8fd8\u53ef\u4ee5\u53d6\u591a\u5c11\u5462\uff1f\u4e0d\u59a8\u4ee5$i=3$\u4e3a\u4f8b\uff0c\u753b\u4e00\u4e2a\u56fe\u770b\u770b\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/16k5feoc.png)\n\n\u5047\u8bbe$z[3]=7$\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b57\u7b26\u4e32\u4ece$3$\u4f4d\u7f6e\u5f00\u59cb\uff0c\u8fde\u7eed$7$\u4e2a\u957f\u5ea6\u7684\u5b50\u4e32\uff0c\u548c\u5b57\u7b26\u4e32\u521a\u5f00\u5934\u7684$7$\u4e2a\u5b57\u7b26\u76f8\u7b49\u3002\u90a3\u4e48\u6211\u4eec\u628a$s$\u518d\u753b\u4e00\u904d\uff0c\u53bb\u6389\u524d$3$\u4e2a\u4f4d\u7f6e\uff0c\u6284\u5728\u4e0b\u9762\uff0c\u5982\u56fe\u6240\u793a\uff0c\u90a3\u4e48\u753b\u84dd\u7ebf\u7684\u90e8\u5206\u662f\u76f8\u7b49\u7684\u3002\n\n\u73b0\u5728\u8003\u8651\u957f\u5ea6\u4e3a$3$\u7684\u5faa\u73af\u8282\uff0c\u9996\u5148\u7ea2\u8272\u7684$3$\u4e2a\u4f4d\u7f6e\uff0c\u548c\u4e0b\u9762\u6a59\u8272\u7684\u4e09\u4e2a\u4f4d\u7f6e\u80af\u5b9a\u662f\u76f8\u7b49\u7684\uff0c\u56e0\u4e3a\u5b83\u4eec\u90fd\u662f\u84dd\u7ebf\u90e8\u5206\u5f00\u5934\u7684$3$\u4e2a\u3002\u800c\u6a59\u8272\u7684\u90e8\u5206\u4e0a\u4e0b\u662f\u5bf9\u5e94\u76f8\u7b49\u7684\uff0c\u4e8e\u662f\u7ea2\u8272\u548c\u6a59\u8272\u76f8\u7b49\u3002\n\n\u540c\u7406\uff0c\u7531\u4e8e\u6a59\u8272\u548c\u7eff\u8272\u76f8\u7b49\uff0c\u90a3\u4e48\u7ea2\uff0c\u6a59\uff0c\u7eff\u90fd\u76f8\u7b49\uff0c\u4e5f\u5c31\u662f\u8bf4\u957f\u5ea6\u4e3a3\u7684\u5faa\u73af\u8282\uff0c\u81f3\u5c11\u53ef\u4ee5\u5faa\u73af3\u6b21\u3002\u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\uff0c\u84dd\u7ebf\u7684\u957f\u5ea6\uff0c\u9664\u4ee5\u5faa\u73af\u8282\u7684\u957f\u5ea6\u518d\u52a01\uff0c\u5c31\u53ef\u4ee5\u7b97\u51fa\u6765\u6700\u591a\u53ef\u4ee5\u5faa\u73af\u51e0\u6b21\uff0c\u5982\u679c\u4e0d\u80fd\u6574\u9664\uff0c\u5411\u4e0b\u53d6\u6574\u3002\u8fd9\u4e2a\u4f8b\u5b50\u91cc\u9762\u5c31\u662f$\\lfloor 7/3 \\rfloor +1$\uff0c\u90a3\u4e48$k$\u53ef\u4ee5\u53d6$3$\u79cd\u3002\n\n\u90a3\u4e48\u7b2c\u4e00\u4e2a\u7ed3\u8bba\u5c31\u51fa\u6765\u4e86\uff0c\u679a\u4e3e\u4e00\u4e0b\u5faa\u73af\u8282\u7684\u957f\u5ea6i\uff0c\u603b\u7684\u65b9\u6848\u6570\u5c31\u662f\n\n$$\\lfloor \\frac{z[i]}{i} \\rfloor +1$$\n\n\u4e4b\u548c\u3002\n\n# \u8003\u8651\u5b57\u7b26\u51fa\u73b0\u7684\u6b21\u6570\n\n\u9898\u76ee\u4e2d\u8fd8\u6709\u4e00\u4e2a\u6761\u4ef6\u6211\u4eec\u6ca1\u6709\u8003\u8651\uff0c\u4e3a\u4e86\u8bf4\u8bdd\u65b9\u4fbf\uff0c\u6211\u4eec\u5b9a\u4e49$f(i,j)$\u8868\u793a$s[i,j]$\u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u4e2a\u6570\u3002\n\n\u5047\u8bbe\u73b0\u5728\u679a\u4e3e\u5230\u5faa\u73af\u8282\u957f\u5ea6\u4e3a$i$\uff0c\u6b64\u65f6\u6839\u636e\u524d\u9762\u7684\u7ed3\u8bba\uff0c\u6211\u4eec\u7b97\u51fa\u6765$k$\u7684\u65b9\u6848\u6570\u6709$t$\u79cd\u3002\u5176\u4e2d\u4e00\u534a$k$\u662f\u5947\u6570\uff0c\u4e00\u534a$k$\u662f\u5076\u6570\u3002\u5f53\u7136\u5947\u6570\u53ef\u80fd\u6bd4\u5076\u6570\u591a\u4e00\u4e2a\u3002\u4e0d\u59a8\u8bbe$k$\u662f\u5947\u6570\u7684\u53d6\u503c\u65b9\u6848\u6570\u662f$tj$\uff0c\u90a3\u4e48\u6709$tj = t-t/2$\uff0c\u540c\u7406\u8bbe\u5076\u6570\u7684$k$\u7684\u4e2a\u6570\u662f$to$\uff0c\u6709$to = t/2$\n\n\u8003\u8651$k$\u7684\u53d6\u503c\u3002\u5982\u679c$k$\u7684\u503c\u662f\u5947\u6570:\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/iv72qpb3.png)\n\n\u5982\u56fe\u6240\u793a\uff0c$k=1$\u65f6\u5019\uff0c$C$\u7684\u957f\u5ea6\u662f\u4ece$i$\u5f00\u5934\u7684\u540e\u7f00\u7684\u957f\u5ea6\u3002$k=3$\u7684\u65f6\u5019\uff0c$C$\u662f\u66f4\u77ed\u7684\u7ea2\u7ebf\u8868\u793a\u7684\u8303\u56f4\u3002\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0c$C$\u5f53\u4e2d\u51fa\u73b0\u6b21\u6570\u4e3a\u5947\u6570\u7684\u5b57\u7b26\u7684\u4e2a\u6570\u662f\u4e00\u6837\u591a\u7684\uff0c\u56e0\u4e3a\u5982\u679c\u5faa\u73af\u8282\u591a\u51fa\u73b0\u4e86\u4e24\u6b21\uff0c\u76f8\u5f53\u4e8e\u5faa\u73af\u8282\u91cc\u9762\u7684\u6bcf\u4e2a\u5b57\u7b26\u90fd\u51fa\u73b0\u4e86\u5076\u6570\u6b21\uff0c\u4e0d\u5f71\u54cd$C$\u5f53\u4e2d\u51fa\u73b0\u6b21\u6570\u4e3a\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u4e2a\u6570\u3002\n\n\u6240\u4ee5\uff0c\u5f53$k$\u662f\u5947\u6570\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ea\u9700\u8ba1\u7b97\u51fa\u6765\uff0c\u4ee5$i$\u4e3a\u5f00\u5934\u7684\u540e\u7f00\u5f53\u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u4e2a\u6570\u5c31\u884c\u4e86\u3002\u7136\u540e\u5728\u957f\u5ea6\u4e3ai\u7684\u5b50\u4e32\u7684\u524d\u7f00$s[0,j]$\u5f53\u4e2d\uff0c\u627e\u51fa\u6765\u6ee1\u8db3\uff1a\n\n$$f(0,j) \\leq f(i,n-1)$$\n\n\u7684$j$\u7684\u4e2a\u6570\uff0c\u8bb0\u4e3a$t1$\u3002\u800c\u5bf9\u4e8e\u6bcf\u4e2a\u5408\u6cd5\u7684$j$\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u53ea\u8981\u662f\u5947\u6570\u7684$k$\uff0c\u90fd\u53ef\u4ee5\u662f\u4e00\u79cd\u5408\u6cd5\u65b9\u6848\uff0c\u6240\u4ee5\u8fd9\u91cc\u8981\u4e58\u6cd5\u539f\u7406\u4e00\u4e0b\uff0c\u628a$t1$\u548c$tj$\u7684\u4e2a\u6570\u76f8\u4e58\u3002\n\n\u518d\u6765\u8003\u8651k\u662f\u5076\u6570\u7684\u60c5\u51b5\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/6pxq01fv.png)\n\n\u8ddf\u524d\u9762\u60c5\u51b5\u7c7b\u4f3c\uff0c\u5f53k\u662f\u5076\u6570\u7684\u65f6\u5019\uff0c\u540e\u7f00C\u91cc\u9762\u7684\u53ea\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u4e2a\u6570\uff0c\u548c\u6574\u4e2a\u4e32\u91cc\u9762\u53ea\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u4e2a\u6570\u662f\u76f8\u7b49\u7684\u3002\u5728\u957f\u5ea6\u4e3ai\u7684\u5b50\u4e32\u7684\u524d\u7f00$s[0,j]$\u5f53\u4e2d\uff0c\u627e\u51fa\u6765\u6ee1\u8db3\uff1a\n\n$$f(0,j) \\leq f(0,n-1)$$\n\n\u7684$j$\u7684\u4e2a\u6570\uff0c\u8bb0\u4e3a$t2$\u3002\u90a3\u4e48\u8fd9\u79cd\u60c5\u51b5\u4e0b\u7684\u65b9\u6848\u6570\uff0c\u5c31\u662f$t2$\u548c$to$\u76f8\u4e58\u3002\n\n# \u5177\u4f53\u5b9e\u73b0\n\n\u9996\u5148\u524d\u9762\u7684\u7b97\u6cd5\u4e2d\u7528\u5230\u4e86$f(0,n-1)$\uff0c\u8fd9\u4e2a\u597d\u529e\uff0c\u76f4\u63a5\u9884\u5904\u7406\u7b97\u51fa\u6765\u5c31\u884c\u4e86\u3002\n\n\u5728\u4ece\u5de6\u5f80\u53f3\u626b\u5b57\u7b26\u4e32$s$\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5047\u8bbe\u6211\u4eec\u76ee\u524d\u679a\u4e3e\u5230\u4f4d\u7f6e$i$\uff0c\u6b64\u65f6\u6211\u4eec\u8ba1\u7b97\u5faa\u73af\u8282\u957f\u5ea6\u4e3a$i+1$\u7684\u60c5\u51b5\uff0c\u6b64\u65f6$A$\u6700\u8fdc\u53ef\u4ee5\u53d6\u5230$i-1$\u4f4d\u7f6e\uff0c\u628a$i$\u4f4d\u7f6e\u7559\u7740\u7ed9$B$\uff0c\u4fdd\u8bc1$B$\u4e0d\u4e3a\u7a7a\u3002\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a\u6876\uff0c\u7ef4\u62a4$i+1$\u5f00\u5934\u7684\u540e\u7f00\u91cc\u9762\u6bcf\u4e2a\u5b57\u6bcd\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u5f53$i$\u5411\u53f3\u5faa\u73af\u7684\u65f6\u5019\uff0c\u6bcf\u6b21\u53ea\u6539\u4e00\u4e2a\u5b57\u7b26\uff0c\u6240\u4ee5\u5728\u6876\u7684\u5bf9\u5e94\u4f4d\u7f6e\u51cf$1$\uff0c\u7136\u540e\u770b\u770b\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6570\u91cf\u5982\u4f55\u53d8\u5316\u5c31\u884c\u4e86\u3002\n\n\u4e0d\u59a8\u8bbe\u8fd9\u4e2a\u6876\u53eb$after$\uff0c\u4e00\u5171\u6709$26$\u4e2a\u683c\uff0c\u5206\u522b\u8868\u793a\u6bcf\u4e2a\u5b57\u7b26\u51fa\u73b0\u7684\u6b21\u6570\u3002\u8d77\u59cb\u7684\u65f6\u5019\uff0c\u5148\u626b\u4e00\u904ds\uff0c\u628a\u6574\u4e2a\u5b57\u7b26\u4e32\u90fd\u7edf\u8ba1\u4e00\u904d\uff0c\u8fd9\u65f6\u5019\u53ef\u4ee5\u987a\u624b\u6c42\u51fa\u6574\u4e2a\u4e32\u91cc\u9762\u53ea\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u4e2a\u6570\uff0c\u8bb0\u5230$all$\u53d8\u91cf\u91cc\u9762\u3002\u7136\u540e\u5f53\u540e\u9762\u5faa\u73af\u7684\u65f6\u5019\uff0c\u5faa\u73af\u5230$i$\u4f4d\u7f6e\uff0c\u5c31\u628a$after[s[i]-'a']$\u4f4d\u7f6e\u51cf$1$\u3002\u8bbe\u53d8\u91cf$suf$\u8868\u793a$f[i+1,n-1]$\uff0c\u5982\u679c\u5728$after[s[i]-'a']$\u51cf1\u4e4b\u524d\uff0c$suf$\u662f\u5947\u6570\uff0c\u90a3\u4e48\u51cf\u5b8c\u4ee5\u540e\uff0c\u540e\u7f00\u91cc\u9762\u7684\u5947\u6570\u5c31\u4f1a\u5c11\u4e00\u4e2a\uff0c\u90a3\u4e48$suf$\u51cf$1$\uff0c\u5426\u5219$suf$\u52a0\u4e00\u3002\u8fd9\u6837\u6bcf\u6b21$i$\u79fb\u52a8\uff0c$suf$\u90fd\u53ef\u4ee5$O(1)$\u7ef4\u62a4\u3002\n\n\u90a3\u4e48\u5faa\u73af\u8282\u91cc\u9762\u7684\u6bcf\u4e2a\u524d\u7f00\u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u4e2a\u6570\uff0c\u53ef\u4ee5\u653e\u5230\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4\u91cc\u9762\uff0c\u8fd9\u6837\u8fd9\u4e2a\u6811\u72b6\u6570\u7ec4\u4e00\u5171\u6709$26$\u4e2a\u4f4d\u7f6e\uff0c\u6bcf\u4e2a\u4f4d\u7f6e$p$\u4fdd\u5b58\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6709$p$\u4e2a\u7684\u524d\u7f00\u6709\u591a\u5c11\u4e2a\u3002$i$\u6bcf\u5411\u53f3\u5faa\u73af$1$\u4f4d\uff0c\u5c31\u5728\u8ba1\u7b97\u5b8c\u7ed3\u679c\u4ee5\u540e\uff0c\u628a\u5f53\u524d\u524d\u7f00\u6254\u5230\u6811\u72b6\u6570\u7ec4\u91cc\u9762\u3002\n\n\u5176\u4ed6\u7ec6\u8282\u53ef\u4ee5\u53c2\u8003\u4ee3\u7801\n\n# \u4ee3\u7801\u65f6\u95f4\n\n```cpp\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n\nusing namespace std;\nconst int MAXN = (1 << 20) + 5;\nchar s[MAXN];//\u8f93\u5165\u7684\u5b57\u7b26\u4e32\nint n, z[MAXN];//\u5b57\u7b26\u4e32\u957f\u5ea6\uff0c\u4ee5\u53caz\u51fd\u6570\u7684\u503c\nint before[30], after[30];//\u4e24\u4e2a\u6876\uff0c\u5206\u522b\u7edf\u8ba1\u5f53\u524d\u679a\u4e3e\u5230\u7684\u4f4d\u7f6e\u5de6\u4fa7\u548c\u53f3\u4fa7\u6bcf\u4e2a\u5b57\u7b26\u51fa\u73b0\u7684\u9891\u6b21\nint pre, suf, all;//\u5f53\u524d\u679a\u4e3e\u5230\u7684\u4f4d\u7f6e\u7684\u524d\u7f00\u3001\u540e\u7f00\u3001\u6574\u4e2a\u4e32\u91cc\u9762\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u4e2a\u6570\n\n//\u6811\u72b6\u6570\u7ec4\uff0c\u5bf9\u4e8es\u7684\u67d0\u4e2a\u524d\u7f00si\uff0c\u5982\u679c\u5b83\u91cc\u9762\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6709m\u4e2a\uff0c\u5219\u5728\u6811\u72b6\u6570\u7ec4m+1\u4f4d\u7f6e+1\nint c[30];\n\ninline int lbt(int x) {\n    return x & -x;\n}\n\nvoid update(int x) {\n    while (x <= 27) {\n        c[x]++;\n        x += lbt(x);\n    }\n}\n\nint sum(int x) {\n    int r = 0;\n    while (x > 0) {\n        r += c[x];\n        x -= lbt(x);\n    }\n    return r;\n}\n\n//\u6269\u5c55KMP\u7b97\u6cd5\uff0c\u8ba1\u7b97z\u51fd\u6570\u7684\u503c\n//\u53ef\u4ee5\u53c2\u8003\u826f\u5fc3\u535a\u5ba2 https://www.luogu.com.cn/blog/nitubenben/solution-p5410\nvoid Z() {\n    z[0] = n;\n    int now = 0;\n    while (now + 1 < n && s[now] == s[now + 1]) {\n        now++;\n    }\n    z[1] = now;\n    int p0 = 1;\n    for (int i = 2; i < n; ++i) {\n        if (i + z[i - p0] < p0 + z[p0]) {\n            z[i] = z[i - p0];\n        } else {\n            now = p0 + z[p0] - i;\n            now = max(now, 0);\n            while (now + i < n && s[now] == s[now + i]) {\n                now++;\n            }\n            z[i] = now;\n            p0 = i;\n        }\n    }\n}\n\nint main() {\n    int T;\n    cin >> T;\n    while (T--) {\n        cin >> s;\n        n = strlen(s);\n        memset(before, 0, sizeof(before));\n        memset(after, 0, sizeof(after));\n        memset(c, 0, sizeof(c));\n        all = pre = suf = 0;\n        Z();\n        //\u5982\u679c\u53d1\u73b0\u5faa\u73af\u8282\u53ef\u4ee5\u5230\u7ed3\u5c3e\uff0c\u51cf1\uff0c\u7a7a\u81f3\u5c11\u4e00\u4e2a\u4f4d\u7f6e\u7ed9C\n        for (int i = 0; i < n; ++i) {\n            if (i + z[i] == n) z[i]--;\n        }\n        //\u5148\u628a\u5b57\u7b26\u4e32\u8fc7\u4e00\u904d\uff0c\u9891\u6b21\u7edf\u8ba1\u5230after\u6570\u7ec4\u91cc\u9762\n        for (int i = 0; i < n; ++i) {\n            after[s[i] - 'a']++;\n        }\n        //\u626b\u4e00\u4e0b\u6bcf\u4e2a\u5b57\u6bcd\uff0c\u8ba1\u7b97\u6574\u4e2a\u4e32\u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u4e2a\u6570\n        for (int i = 0; i < 26; ++i) {\n            if (after[i] & 1) {\n                all++;\n            }\n        }\n        suf = all;//\u540e\u7f00\u4e2d\u7684\u503c\u6682\u65f6\u548c\u6574\u4e2a\u4e32\u4e00\u81f4\n        long long ans = 0;\n        for (int i = 0; i < n; ++i) {\n            //\u518d\u626b\u4e00\u6b21\u5b57\u7b26\u4e32\uff0c\u5f53\u5faa\u73af\u5230i\u4f4d\u7f6e\u7684\u65f6\u5019\uff0c\u5faa\u73af\u8282\u957f\u5ea6\u662fi+1\n            //s[i]\u8981\u4ece\u53f3\u8fb9\u53bb\u6389\uff0c\u7ef4\u62a4after\u6570\u7ec4\u548csuf\u53d8\u91cf\n            if (after[s[i] - 'a'] & 1) {\n                //\u4e4b\u524d\u662f\u5947\u6570\uff0c\u73b0\u5728\u53d8\u6210\u5076\u6570\u4e86\n                suf--;\n            } else {\n                suf++;\n            }\n            after[s[i] - 'a']--;\n            //s[i]\u52a0\u5230\u5de6\u8fb9\uff0c\u7ef4\u62a4before\u548cpre\u53d8\u91cf\n            if (before[s[i] - 'a'] & 1) {\n                pre--;\n            } else {\n                pre++;\n            }\n            before[s[i] - 'a']++;\n            if (i != 0 && i != n - 1) {\n                //\u5faa\u73af\u8282\u5927\u4e8e1,\u624d\u80fd\u5bf9\u7b54\u6848\u6709\u8d21\u732e\uff0c\u56e0\u4e3a\u9898\u4e2d\u8bf4ABC\u90fd\u4e0d\u4e3a\u7a7a\n                int t = z[i + 1] / (i + 1) + 1;\n                ans += 1LL * (t / 2) * sum(all + 1) + 1LL * (t - t / 2) * sum(suf + 1);\n            }\n            update(pre + 1);\n        }\n        cout << ans << endl;\n    }\n    return 0;\n}\n```\n",
        "postTime": 1613460909,
        "uid": 43206,
        "name": "\u6ce5\u571f\u7b28\u7b28",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7114 \u3010[NOIP2020] \u5b57\u7b26\u4e32\u5339\u914d\u3011"
    },
    {
        "content": "\uff08\u7eaa\u5ff5\u6211\u5728NOIp2020\u8003\u573a\u4e0a\u552f\u4e00\u8fc7\u6389\u7684\u9898\uff09\n\n### \u9898\u9762\u4e0e\u601d\u8def\n\n\u5148\u8bfb\u9898\uff1a\u672c\u9898\u8981\u6c42 $S=(AB)^iC$ \u4f7f\u5f97 $A$ \u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6570\u91cf \u2264 $C$ \u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6570\u91cf\u3002\n\n\u5f88\u5bb9\u6613\u60f3\u5230\u4e00\u79cd\u505a\u6cd5\uff1a\u628a $(AB)$ \u7ed3\u5408\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5224\u65ad $(AB)^i$ \u662f\u5426\u662f $S$ \u7684\u524d\u7f00\uff0c\u5e76\u7528\u501f\u52a9\u9884\u5904\u7406\u7edf\u8ba1\u7b54\u6848\u3002\n\n### \u5177\u4f53\u5b9e\u73b0\n\n#### $(AB)^i$ \u5224\u65ad\n\n\u8fd9\u91cc\u6709\u4e00\u4e9b\u5173\u4e8e\u5468\u671f\u7684\u4e8b\uff0c\u60f3\u5230 KMP\u7b97\u6cd5 \u4e2d\u7684 fail \u6570\u7ec4\uff08\u6216\u8005\u53eb next \u6570\u7ec4\uff09\u3002\n\n\u6b64\u65f6\u6211\u4eec\u60f3\u5230\u4e00\u4e2a\u7ed3\u8bba\uff1a\n\n> \u5b57\u7b26\u4e32A\u7684\u6700\u77ed\u5468\u671f $=|A|-fail[A]$\n\n\u4e8e\u662f\u6211\u4eec\u4ece\u4e8c\u5f00\u59cb\u679a\u4e3e $i$ \uff0c\u53ea\u8981 $S_{|(AB)^i|}$ \u7684\u6700\u77ed\u5468\u671f\u662f $|AB|$ \u7684\u7ea6\u6570\uff0c\u5219 $(AB)^i$ \u4e00\u5b9a\u662f $S$ \u7684\u524d\u7f00\u3002\n\n\u9884\u5904\u7406\u51fa fail \u6570\u7ec4\u5373\u53ef\n\n#### \u7b54\u6848\u7edf\u8ba1\n\n\u9700\u8981\u9884\u5904\u7406\u51fa $S$ \u6bcf\u4e2a\u540e\u7f00\u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u5b57\u7b26\u6570\u91cf\u5373\u53ef\u786e\u5b9a $C$ \u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6570\u91cf\u3002\n\n\u7edf\u8ba1\u7b54\u6848\u540c\u65f6\u66f4\u65b0\u5230\u6bcf\u4e00\u4f4d\u65f6\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6570\u91cf \u2264 $x(x\\in [0,26])$ \u7684 $A$ \u7684\u6570\u91cf\u3002\n\n#### \u590d\u6742\u5ea6\u5206\u6790\n\n\u9996\u5148\uff0c\u5bf9\u4e8e\u968f\u673a\u751f\u6210\u7684\u5b57\u7b26\u4e32\uff0c\u8fd9\u79cd\u7b97\u6cd5\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n)$\n\n\u5bf9\u4e8e\u5f62\u5982 $a^nC$ \u6216 $a^n$ \uff08 $a$ \u662f\u5355\u4e2a\u5b57\u7b26\uff09\u7684\u5b57\u7b26\u4e32\uff0c\u7b97\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6 $O( n *  \\sum\\limits_{i=1}^n\\frac{1}{i}) = O(n\\log n)$\n\n\u590d\u6742\u5ea6\u80af\u5b9a\u4e0d\u5982\u9898\u89e3\u533a\u91cc\u7684\u5176\u4ed6\u5927\u4f6c\u7684\uff0c\u4f46\u80fd\u8fc7CCF\n\n\u6d1b\u8c37\u8bc4\u6d4b\u673a\u72b6\u6001\u597d\u7684\u65f6\u5019\u4e0d\u5f00O2\u4e5f\u80fd\u5361\u8fc7\u53bb\uff0c\u4f46\u72b6\u6001\u4e0d\u597d\u65f6\u4f1a92~96\u3002\u5f00\u4e86O2\u80af\u5b9a\u662f\u53ef\u4ee5\u8fc7\u7684\u3002\n\n### \u4ee3\u7801\n\n\uff08\u8bf7\u539f\u8c05\u6211\u4e11\u964b\u7684\u7801\u98ce\uff09\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<iostream>\nusing namespace std;\ntypedef long long ll;\nchar str[(1<<20)+2]; \nint n,kmp[(1<<20)+2],cir[(1<<20)+2],tms[30],suf[(1<<20)+2],pre[(1<<21)+2],per[27];ll ans;\nvoid deal(){\n\tchar c=getchar();ans=0ll;\n\tmemset(kmp,0,sizeof(kmp));\t\t\t\t\t\t\t\t\t//<\u521d\u59cb\u5316>\n\tmemset(cir,0,sizeof(cir));\n\tmemset(tms,0,sizeof(tms));\n\tmemset(suf,0,sizeof(suf));\n\tmemset(pre,0,sizeof(pre));\n\tmemset(per,0,sizeof(per));\t\t\t\t\t\t\t\t\t//</\u521d\u59cb\u5316>\n\twhile(c>'z'||c<'a')\tc=getchar();n=0;int last;\t\t\t\t//<\u8bfb\u5165> \n\twhile(c<='z'&&c>='a'){str[++n]=c;c=getchar();}\t\t\t\t//</\u8bfb\u5165> \n\tfor(int i=2;i<=n;i++){last=kmp[i-1];\t\t\t\t\t\t//<\u9884\u5904\u7406fail\u6570\u7ec4>\uff08kmp\u6570\u7ec4\u5373\u4e3a fail\u6570\u7ec4\uff09 \n\t\twhile(str[i]!=str[last+1]&&last!=0)last=kmp[last];\n\t\tif(str[i]==str[last+1])kmp[i]=last+1;else kmp[i]=0;\t\t//</\u9884\u5904\u7406fail\u6570\u7ec4>\n\t}int cnt=0;for(int i=1;i<=26;i++)tms[i]=0;\t\t\t\t\t//<\u9884\u5904\u7406\u540e\u7f00>\n\tfor(int i=n;i>=1;i--){\n\t\ttms[str[i]-'a'+1]++;\n\t\tif(tms[str[i]-'a'+1]&1)\n\t\t\tsuf[i]=suf[i+1]+1;\n\t\telse\tsuf[i]=suf[i+1]-1;\t\t\t\t\t\t\t\t//</\u9884\u5904\u7406\u540e\u7f00>\n\t}for(int i=1;i<=26;i++)tms[i]=0;\t\t\t\t\t\t\t//<\u9884\u5904\u7406\u524d\u7f00>\uff08\u5176\u5b9e\u8fd9\u4e00\u6bb5\u53ef\u4ee5\u753b\u5230\u540e\u9762\u4e00\u6bb5\u91cc\uff0c\u6570\u7ec4\u5c31\u53ef\u4ee5\u5f00\u7684\u5c0f\u4e00\u4e9b\uff09 \n\tfor(int i=1;i<=n;i++){\n\t\ttms[str[i]-'a'+1]++;\n\t\tif(tms[str[i]-'a'+1]&1)\n\t\t\tpre[i]=pre[i-1]+1;\n\t\telse\tpre[i]=pre[i-1]-1;\n\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//</\u9884\u5904\u7406\u524d\u7f00>\n\tfor(int i=1;i<n;i++){\t\t\t\t\t\t\t\t\t\t//\u5904\u7406 \n\t\tif(i>=2){\t\t\t\t\t\t\t\t\t\t\t\t//|AB|>=2 \u6b64\u65f6\u6709\u89e3 \n\t\t\tans+=per[suf[i+1]];\t\t\t\t\t\t\t\t\t//\u66f4\u65b0\u7b54\u6848 \n\t\t\tfor(int j=i+i;j<n;j+=i){ \n\t\t\t\tif(((i%(j-kmp[j]))==0)&&((j/(j-kmp[j]))>1)){\n\t\t\t\t\tans+=ll(per[suf[j+1]]);\t\t\t\t\t\t//\u66f4\u65b0\u5468\u671f\u4e32\u7b54\u6848 \n\t\t\t\t}else break;\n\t\t\t}\n\t\t}\n//\t\tprintf(\"*>. seq on %d , cur ans is %lld\\n\",i,ans);\n\t\tfor(int j=1;j<pre[i];j++)per[j]=per[j];\t\t\t\t\t//<\u66f4\u65b0A\u4e2d\u51fa\u73b0j\u4e2a\u5947\u6570\u6b21\u6570\u5b57\u7b26\u65f6\u53ef\u884c\u7684A\u7684\u6570\u91cf> \n\t\tfor(int j=pre[i];j<=26;j++){\n\t\t\tper[j]=per[j]+1;\n\t\t}\t\t\t\t\t\t\t\t\t\t\t\t\t\t//</\u66f4\u65b0A\u4e2d\u51fa\u73b0j\u4e2a\u5947\u6570\u6b21\u6570\u5b57\u7b26\u65f6\u53ef\u884c\u7684A\u7684\u6570\u91cf>\n\t}\n//\tfor(int i=1;i<=n;i++)printf(\"%d \",pre[i]);printf(\"\\n\");//\n\tprintf(\"%lld\\n\",ans);\n}\nint main(){\n\nfreopen(\"string.in\",\"r\",stdin);\t\t\t\t\t\t\t\t\t//\u6587\u4ef6\u8f93\u5165\u8f93\u51fa \nfreopen(\"string.out\",\"w\",stdout);\t\t\t\t\t\t\t\t//\u6587\u4ef6\u8f93\u5165\u8f93\u51fa\n\nint T;scanf(\"%d\\n\",&T);for(;T>0;T--){deal();}return 0;}\t\t\t//\u591a\u7ec4\u6570\u636e \n```\n----------\n\n\u5927\u6982\u2026\u2026\u2026\u2026\u90a3\u5c31\u8fd9\u6837\uff1f",
        "postTime": 1607436718,
        "uid": 65581,
        "name": "zjcOvO",
        "ccfLevel": 7,
        "title": "P7114 \u5b57\u7b26\u4e32\u5339\u914d - \u9898\u89e3"
    },
    {
        "content": "\u4e25\u683c $O(n)$ \u7684\u89e3\u6cd5\u51fa\u6765\u4e86\u3002\n\n------------\n\n\u9996\u5148\uff0c\u6211\u4eec\u5fc5\u987b\u77e5\u9053\u4e00\u4e2a\u4e8b\u5b9e\uff1a\n\n\u5982\u679c\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5b57\u7b26\u4e32\u6709\u957f\u5ea6\u4e3a $m$ \u7684\u5faa\u73af\u8282\uff0c\u90a3\u4e48\uff0c\u5176\u524d $n-m$ \u4f4d\u4e0e\u540e $n-m$ \u4f4d\u76f8\u540c\u662f\u5145\u5206\u5fc5\u8981\u6761\u4ef6\u3002\n\n\u5177\u4f53\u53ef\u4ee5\u901a\u8fc7\u770b\u4e00\u5f20\u56fe\u76f4\u89c2\u7406\u89e3\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/h3b0egnj.png)\n\n\u7136\u540e\uff0c\u6211\u4eec\u8003\u8651Z\u7b97\u6cd5\uff08\u5373[\u3010\u6a21\u677f\u3011\u6269\u5c55 KMP\uff08Z \u51fd\u6570\uff09](https://www.luogu.com.cn/problem/P5410)\uff09\u3002\n\n\u5bf9\u4e8e\u4f4d\u7f6e $i$\uff0c\u5176 $Z$ \u6570\u7ec4 $Z_i$ \u7684\u5b9a\u4e49\u662f\u4ece\u4f4d\u7f6e $i$ \u8d77\u59cb\u7684\u540e\u7f00\u4e0e\u6574\u4e2a\u4e32\u7684LCP\u957f\u5ea6\u3002\u5177\u4f53\u5e94\u8be5\u600e\u6837\u6c42\u51fa\u53ef\u4ee5\u53c2\u7167\u8be5\u9898\u9898\u89e3\uff0c\u6b64\u5904\u4e0d\u8bb2\u8ff0\u3002\n\n\u56de\u5230\u672c\u9898\u3002\u6211\u4eec\u8003\u8651\u679a\u4e3e $AB$ \u4e32\u7684\u957f\u5ea6 $i$\uff0c\u5e76\u8ba1\u7b97\u6709\u591a\u5c11\u524d\u7f00\u53ef\u4ee5\u88ab\u8868\u793a\u6210 $(AB)^k$ \u7684\u5f62\u5f0f\u3002\u660e\u663e\u6b64\u524d\u7f00\u7684\u957f\u5ea6\u5fc5\u7136\u4e3a $ik$ \u3002\n\n\u5219\u4f9d\u636e\u6211\u4eec\u521a\u624d\u7684\u5faa\u73af\u8282\u7406\u8bba\uff0c\u5047\u5982\u5176\u53ef\u4ee5\u88ab\u8868\u793a\u6210 $(AB)^k$ \u5f62\u5f0f\uff0c\u5fc5\u6709 $s_{[i,ik-1]}=s_{[0,i(k-1)-1]}$\uff0c\u5176\u4e2d $s_{[a,b]}$ \u8868\u793a\u539f\u4e32\u4ece $a$ \u5230 $b$ \u7684\u5b50\u4e32\uff0c\u4e0b\u6807\u81ea $0$ \u5f00\u59cb\u3002\u5373\uff0c\u4ece $i$ \u5f00\u59cb\u957f\u5ea6\u4e3a $i(k-1)$ \u7684\u5b50\u4e32\uff0c\u5fc5\u5b9a\u7b49\u4e8e\u957f\u5ea6\u4e3a $i(k-1)$ \u7684\u524d\u7f00\u3002\n\n\u8003\u8651 $s_{[i,ik-1]}$ \u5373\u4e3a\u539f\u4e32\u4e2d\u81ea\u7b2c $i$ \u4f4d\u8d77\u59cb\u7684\u540e\u7f00\u7684\u524d\u7f00\uff1b\u5219\u5982\u679c\u6709 $ik-i\\leq Z_i$\uff0c\u5373\u8be5\u524d\u7f00\u7684\u957f\u5ea6\u4e0d\u5927\u4e8e $Z_i$ \u7684\u5927\u5c0f\uff0c\u5219\u4f9d\u636e $Z$ \u6570\u7ec4\u7684\u610f\u4e49\uff0c\u6709 $s_{[i,ik-1]}=s_{[0,i(k-1)-1]}$\uff08\u56e0\u4e3a $Z$ \u8868\u793a\u7684\u662f\u516c\u5171\u524d\u7f00\u7684\u957f\u5ea6\uff09\u3002\n\n\u4e8e\u662f\uff0c\u53ea\u6709 $ik-i\\leq Z_i$ \u7684\u957f\u5ea6\u4e3a $ik$ \u7684\u524d\u7f00 $(AB)^k$\uff0c\u624d\u6709\u957f\u5ea6\u4e3a $i$ \u7684\u5faa\u73af\u8282 $AB$\u3002\u4e0a\u5f0f\u53ef\u4ee5\u88ab\u7b49\u4ef7\u8868\u8ff0\u4e3a $k\\leq\\dfrac{Z_i}{i}+1$\uff0c\u5373\u5bf9\u4e8e\u4e00\u4e2a\u4f4d\u7f6e $i$\uff0c\u5171\u6709 $\\dfrac{Z_i}{i}+1$ \u4e2a\u5408\u6cd5\u7684 $k$\u3002\u5f53\u7136\uff0c\u5408\u6cd5\u7684 $k$\uff0c\u5176\u540e\u7f00\u5fc5\u7136\u4e0d\u4e3a\u7a7a\uff0c\u8fd9\u610f\u5473\u7740 $Z_i$ \u5e94\u4e0e $n-i-1$ \u53d6 $\\min$\u3002\n\n\u5728\u4e0b\u6587\u4e2d\uff0c\u5b9a\u4e49\u201c\u5947\u5076\u6027\u201d\u4e3a\u67d0\u4e2a\u4e32\u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6570\u91cf\u3002\n\n\u8003\u8651\u622a\u53bb\u957f\u5ea6\u4e3a $ik$ \u7684\u524d\u7f00\u540e\u5269\u4e0b\u7684\u540e\u7f00\uff0c\u5219\u8be5\u540e\u7f00\u5219\u4e3a $C$\u3002\u660e\u663e\uff0c\u5f53 $k$ \u662f\u5947\u6570\u548c $k$ \u662f\u5076\u6570\u65f6\uff0c$C$ \u7684\u5947\u5076\u6027\u53ea\u6709\u4e24\u79cd\u53ef\u80fd\u3002\n\n\u66f4\u51c6\u786e\u5730\u8bf4\uff0c$k$ \u662f\u5947\u6570\u65f6\uff0c\u6709\u5176\u5947\u5076\u6027\u5168\u90e8\u7b49\u4ef7\u4e8e\u8d77\u59cb\u4e8e $i$ \u7684\u540e\u7f00\u7684\u5947\u5076\u6027\uff1b$k$ \u662f\u5076\u6570\u65f6\uff0c\u5176\u5947\u5076\u6027\u5168\u90e8\u7b49\u4ef7\u4e8e\u8d77\u59cb\u4e8e $2i$ \u7684\u540e\u7f00\u7684\u5947\u5076\u6027\uff1b\u4f46\u662f\u56e0\u4e3a $2i$ \u672c\u8eab\u76f8\u5f53\u4e8e $i$ \u51fa\u73b0\u4e24\u6b21\uff0c\u51fa\u73b0\u4e24\u6b21\u7684\u4e32\u7684\u5947\u5076\u6027\u5fc5\u4e3a $0$\uff0c\u6545\u5176\u5b9e\u9645\u4e0a\u5c31\u76f8\u5f53\u4e8e\u6574\u4e2a\u4e32\u7684\u5947\u5076\u6027\u3002\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u5171\u6709 $\\left\\lceil\\dfrac{\\dfrac{Z_i}{i}+1}{2}\\right\\rceil$ \u4e2a\u540e\u7f00\u662f\u548c $i$ \u5f00\u5934\u7684\u540e\u7f00\u540c\u5947\u5076\u7684\uff0c\u5171\u6709 $\\left\\lfloor\\dfrac{\\dfrac{Z_i}{i}+1}{2}\\right\\rfloor$ \u4e2a\u540e\u7f00\u662f\u548c\u6574\u4e2a\u4e32\u540c\u5947\u5076\u7684\uff08\u5206\u522b\u5bf9\u5e94\u7740 $k$ \u4e3a\u5947\u548c $k$ \u4e3a\u5076\u4e24\u79cd\u60c5\u5f62\uff09\u3002\n\n\u6211\u4eec\u4e0b\u9762\u8003\u8651\u6709\u591a\u5c11\u4e2a\u5408\u6cd5\u7684 $A$ \u4e32\u3002\u660e\u663e\u5b83\u5fc5\u987b\u662f $AB$ \u4e32\u7684\u67d0\u4e2a\u524d\u7f00\uff0c\u4e5f\u5373\u6574\u4e2a\u4e32\u7684\u524d\u7f00\u3002\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u8981\u8003\u8651\u7684\uff0c\u5c31\u662f $i$ \u4e4b\u524d\u7684\u524d\u7f00\u4e2d\uff0c\u5171\u6709\u591a\u5c11\u4e2a\u7684\u5947\u5076\u6027\u4e0d\u5927\u4e8e $i$ \u5f00\u5934\u7684\u540e\u7f00\u7684\u5947\u5076\u6027\uff0c\u5373 $k$ \u4e3a\u5947\u6570\u65f6\u5408\u6cd5 $A$ \u7684\u6570\u91cf\uff1b\u5171\u6709\u591a\u5c11\u4e2a\u7684\u5947\u5076\u6027\u4e0d\u5927\u4e8e\u6574\u4e2a\u4e32\u7684\u5947\u5076\u6027\uff0c\u5373 $k$ \u4e3a\u5076\u6570\u65f6\u5408\u6cd5 $A$ \u7684\u6570\u91cf\uff1b\u7136\u540e\u6b64\u4e3a\u5947\u4e3a\u5076\u65f6\u7684 $A$ \u7684\u6570\u91cf\uff0c\u518d\u5206\u522b\u4e58\u4e0a\u6211\u4eec\u521a\u624d\u6c42\u51fa\u7684\u4e3a\u5947\u4e3a\u5076\u65f6\u7684 $C$ \u7684\u6570\u91cf\uff0c\u5c31\u662f $AB$ \u957f\u5ea6\u4e3a $i$ \u7684\u5408\u6cd5\u62c6\u5206\u7684\u6570\u91cf\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u5148\u8003\u8651\u4f7f\u7528\u6876\u8fdb\u884c\u7ef4\u62a4\u6240\u6709\u524d\u7f00\u4e2d\u5404\u5947\u5076\u6027\u7684\u51fa\u73b0\u6b21\u6570\uff0c\u6bcf\u6b21\u66b4\u529b\u626b\u8fc7\u6876\u5904\u7406\u3002\u5219\u76ee\u524d\u7684\u590d\u6742\u5ea6\u662f $O(26n)$ \u7684\u3002 \n\n\u5148\u8d34\u51fa\u8003\u573a\u4ee3\u7801\uff08\u4f1aTLE\uff09\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nint T,n,Z[2001000],mas[2001000],sum[30],CN,BN;\nll res;\nchar s[2001000];\nint COUNT(int ip){\n\tint ret=0;\n\twhile(ip)ret+=ip&1,ip>>=1;\n\treturn ret;\n}\nint main(){\n\tfreopen(\"string.in\",\"r\",stdin);\n\tfreopen(\"string.out\",\"w\",stdout);\n\tscanf(\"%d\",&T);\n\twhile(T--){\n\t\tscanf(\"%s\",s),n=strlen(s),memset(sum,0,sizeof(sum)),res=CN=BN=0;\n\t\tmas[0]=1<<(s[0]-'a');\n\t\tfor(int i=1;i<n;i++)mas[i]=mas[i-1]^(1<<(s[i]-'a'));\n\t\tCN=COUNT(mas[n-1]);\n\t\tint Centre=-1,Rpos=-1;\n\t\tfor(int i=1;i<n;i++){\n\t\t\tif(i<=Rpos)Z[i]=min(Z[i-Centre],Rpos-i+1);\n\t\t\telse Z[i]=0;\n\t\t\twhile(i+Z[i]<n&&s[Z[i]]==s[i+Z[i]])Z[i]++;\n\t\t\tif(i+Z[i]>Rpos)Centre=i,Rpos=i+Z[i]-1;\n\t\t}\n//\t\tfor(int i=1;i<n;i++)printf(\"%d \",Z[i]);puts(\"\");\n\t\tfor(int i=1;i<n;i++){\n\t\t\tint C1=mas[n-1]^mas[i-1];\n\t\t\tC1=COUNT(C1);\n\t\t\tint tot=min(Z[i],n-i-1)/i+1;\n\t\t\tint N1=(tot+1)>>1,N2=(tot)>>1;\n//\t\t\tprintf(\"%d:%d %d\\n\",tot,N1,N2);\n\t\t\tfor(int j=0;j<=C1;j++)res+=1ll*sum[j]*N1;\n\t\t\tsum[COUNT(mas[i-1])]++;\n\t\t\tres+=1ll*BN*N2;\n\t\t\tif(COUNT(mas[i-1])<=CN)BN++;\n\t\t}\n\t\tprintf(\"%lld\\n\",res);\n\t}\n\treturn 0;\n}\n```\n\n\u4e0b\u9762\u8003\u8651\u4f18\u5316\u3002\n\n\u9996\u5148\uff0c\u4e0a\u8ff0\u7a0b\u5e8f\u7edf\u8ba1\u5947\u5076\u6027\u65f6\uff0c\u662f\u4f7f\u7528\u4e86\u4e00\u4e2a\u72b6\u538b\u6765\u7edf\u8ba1\u2014\u2014\u4f46\u8fd9\u672c\u8eab\u5c31\u6709\u4e00\u4e2a $26$ \u7684\u5e38\u6570\u3002\u6362\u6210\u6876\u6765\u7edf\u8ba1\uff0c\u5373\u53ef\u505a\u5230 $O(n)$ \u6765\u5904\u7406\u3002\n\n\u7136\u540e\uff0c\u89c2\u5bdf\u5230\u968f\u7740 $i$ \u6bcf\u6b21\u589e\u52a0 $1$\uff0c\u957f\u5ea6\u4e3a $i$ \u7684\u540e\u7f00\u7684\u5947\u5076\u6027\u6700\u591a\u53ea\u4f1a\u53d8\u5316 $1$\u3002\u8fd9\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728\u524d\u4e00\u4f4d\u7edf\u8ba1\u7684\u57fa\u7840\u4e0a\uff0c\u76f4\u63a5\u52a0\u4e0a\u6216\u51cf\u53bb\u6709\u6240\u53d8\u52a8\u7684\u90a3\u4e00\u4e2a\u6876\u91cc\u7684\u503c\u5373\u53ef\u3002\n\n\u8fd9\u4e24\u4e2a\u4f18\u5316\u52a0\u4e0a\uff0c\u5373\u53ef\u628a\u590d\u6742\u5ea6\u4f18\u5316\u5230\u4e25\u683c $O(n)$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nint T,n,Z[2001000],cnt1[30],cnt2[30],sum[30],CN,BN,nown,sumn,nown2;\nll res;\nchar s[2001000];\nint main(){\n//\tfreopen(\"string.in\",\"r\",stdin);\n//\tfreopen(\"string.out\",\"w\",stdout);\n\tscanf(\"%d\",&T);\n\twhile(T--){\n\t\tscanf(\"%s\",s),n=strlen(s),memset(sum,0,sizeof(sum)),memset(cnt1,0,sizeof(cnt1)),memset(cnt2,0,sizeof(cnt2)),res=CN=BN=0;\n\t\tfor(int i=0;i<n;i++)cnt1[s[i]-'a']^=1;\n\t\tfor(int i=0;i<26;i++)CN+=cnt1[i];\n\t\tint Centre=-1,Rpos=-1;\n\t\tfor(int i=1;i<n;i++){\n\t\t\tif(i<=Rpos)Z[i]=min(Z[i-Centre],Rpos-i+1);\n\t\t\telse Z[i]=0;\n\t\t\twhile(i+Z[i]<n&&s[Z[i]]==s[i+Z[i]])Z[i]++;\n\t\t\tif(i+Z[i]>Rpos)Centre=i,Rpos=i+Z[i]-1;\n\t\t}\n//\t\tfor(int i=1;i<n;i++)printf(\"%d \",Z[i]);puts(\"\");\n\t\tnown=CN,nown2=sumn=0;\n\t\tfor(int i=1;i<n;i++){\n\t\t\tif(cnt1[s[i-1]-'a'])sumn-=sum[nown--];\n\t\t\telse sumn+=sum[++nown];\n\t\t\tcnt1[s[i-1]-'a']^=1;\n\t\t\tint tot=min(Z[i],n-i-1)/i+1;\n\t\t\tint N1=(tot+1)>>1,N2=(tot)>>1;\n//\t\t\tprintf(\"%d:%d %d\\n\",tot,N1,N2);\n\t\t\tres+=1ll*sumn*N1;\n\t\t\tif(cnt2[s[i-1]-'a'])nown2--;\n\t\t\telse nown2++;\n\t\t\tcnt2[s[i-1]-'a']^=1;\n\t\t\tsum[nown2]++;\n\t\t\tif(nown2<=nown)sumn++;\n\t\t\tres+=1ll*BN*N2;\n\t\t\tif(nown2<=CN)BN++;\n\t\t}\n\t\tprintf(\"%lld\\n\",res);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1607179591,
        "uid": 123369,
        "name": "xtx1092515503",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7114 \u3010\u5b57\u7b26\u4e32\u5339\u914d\uff08\u6d1b\u8c37\u6c11\u95f4\u6570\u636e\uff09\u3011"
    },
    {
        "content": "\u95f2\u8bdd\uff1aNOIp \u524d\u4e00\u5929\uff0c\u6211\u521a\u521a\u5976\u4e86\u4e00\u53e3\uff1a\u201c\u5f80\u5e74 NOIp \u6ca1\u8003\u8fc7 KMP\uff0c\u4e0d \u7528 \u590d \u4e60 \u4e86\u3002\u201d\n\n\u7136\u540e\u3002T2 \u5f00\u5e55\u96f7\u51fb ~~\u867d\u7136\u662f\u6269\u5c55 KMP \u6211\u4e5f\u4e0d\u4f1a\u3002~~\n\n\u56de\u5230\u6b63\u8f68\u3002\n\n### \u505a\u6cd5\u4e00\n\n\u6309\u7167\u9898\u610f\u679a\u4e3e $A,\\,B,\\,C$\uff0c\u518d\u5224\u65ad\u662f\u5426\u7b26\u5408\u6761\u4ef6\u3002\u5176\u4e2d\uff0c$A$ \u4e00\u5b9a\u662f $S$ \u7684\u4e00\u4e2a\u524d\u7f00\uff0c$C$ \u4e00\u5b9a\u662f $S$ \u7684\u4e00\u4e2a\u540e\u7f00\uff0c$B$ \u662f\u4e2d\u95f4\u7684\u4e00\u4e2a\u5b50\u4e32\u3002\u679a\u4e3e\u590d\u6742\u5ea6 $O(n^3)$\uff0c\u5224\u65ad\u590d\u6742\u5ea6 $O(n)$\uff0c\u6574\u4f53\u590d\u6742\u5ea6 $O(n^4)$\uff0c\u9884\u8ba1\u5f97\u5206 $16pts$\u3002\n\n\u5b9e\u9645\u4e0a\u7a0d\u52a0\u4f18\u5316\u5c31\u80fd\u8fbe\u5230 $O(n^3)$ \u590d\u6742\u5ea6\uff0c\u65b9\u6cd5\u4e0d\u5c11\uff0c\u9884\u8ba1\u5f97\u5206 $32pts$\u3002\n\n### \u505a\u6cd5\u4e8c\n\n\u9884\u5904\u7406 $S$ \u4e2d\u6240\u6709\u524d\u7f00\u5b57\u7b26\u4e32\u548c\u540e\u7f00\u5b57\u7b26\u4e32\u51fa\u73b0\u5947\u6570\u4e2a\u5b57\u7b26\u7684\u4e2a\u6570\u3002\n\n\u679a\u4e3e $(AB)$ \u7684\u603b\u957f\u5ea6\uff0c\u7136\u540e\u679a\u4e3e $(AB)$ \u91cd\u590d\u7684\u6b21\u6570 $i$\uff0c\u76f4\u5230 $AB$ \u4e0d\u518d\u91cd\u590d\u6216\u8005\u5df2\u7ecf\u8fbe\u5230 $S$ \u7684\u603b\u957f\u5ea6\u3002\u7531\u4e8e $S=(AB)^iC$\uff0c\u6240\u6709\u5269\u4e0b\u7684\u90e8\u5206\u5c31\u662f $C$\u3002\n\n\u8ba8\u8bba\u6ee1\u8db3\u6761\u4ef6\u7684 $A$ \u7684\u4e2a\u6570\uff0c\u7531\u4e8e\u9884\u5904\u7406\u8fc7\uff0c\u6bcf\u6b21\u5224\u65ad\u590d\u6742\u5ea6\u4e3a $O(1)$\u3002\n\n\u603b\u590d\u6742\u5ea6 $O(n^2+|S|)$\uff0c\u9884\u8ba1\u5f97\u5206 $48pts$\u3002\n\n#### \u7279\u6b8a\u6027\u8d28\u4e00\n\n$S$ \u4e2d\u53ea\u5305\u542b\u4e00\u79cd\u5b57\u7b26\u3002\n\n\u679a\u4e3e $C$ \u7684\u957f\u5ea6\uff0c\u5047\u8bbe\u5269\u4e0b\u7684\u957f\u5ea6\u4e3a $l$\uff0c\u5219 $(AB)$ \u7684\u957f\u5ea6\u4e00\u5b9a\u662f $l$ \u7684\u4e00\u4e2a\u975e $1$ \u56e0\u6570\u3002\n\n- \u5982\u679c $C$ \u7684\u957f\u5ea6\u4e3a\u5947\u6570\uff0c\u90a3\u4e48 $A$ \u7684\u957f\u5ea6\u968f\u610f\u3002\n- \u5982\u679c $C$ \u7684\u957f\u5ea6\u4e3a\u5076\u6570\uff0c\u90a3\u4e48 $A$ \u7684\u957f\u5ea6\u4e5f\u4e3a\u5076\u6570\u3002\n\n\u6bcf\u6b21 $O(1)$ \u8ba1\u7b97\uff0c\u603b\u590d\u6742\u5ea6 $O(n)$\u3002\u7ed3\u5408 $O(n^2)$ \u505a\u6cd5\uff0c\u671f\u671b\u5f97\u5206 $56pts$\u3002\n\n#### \u7279\u6b8a\u6027\u8d28\u4e8c\n\n$S$ \u4e2d\u53ea\u5305\u542b\u4e24\u79cd\u5b57\u7b26\u3002\n\n\u7ed3\u5408\u7279\u6b8a\u6027\u8d28\uff0c\u51fa\u73b0\u5947\u6570\u6b21\u5b57\u7b26\u7684\u4e2a\u6570\u53ea\u53ef\u80fd\u662f $0,\\,1$ \u6216 $2$\u3002\u679a\u4e3e $(AB)$ \u7684\u603b\u957f\u5ea6\uff0c\u53ef\u4ee5\u7528\u5b57\u7b26\u4e32\u54c8\u5e0c\u5feb\u901f\u6c42\u51fa $(AB)$ \u6700\u591a\u91cd\u590d\u591a\u5c11\u6b21\u3002\n\n\u679a\u4e3e $(AB)$ \u91cd\u590d\u7684\u6b21\u6570 $i$ \u76f8\u5f53\u4e8e\u8c03\u548c\u7ea7\u6570\u6c42\u548c\uff0c\u6700\u7ec8\u590d\u6742\u5ea6 $O(n \\log n)$\u3002\u7ed3\u5408\u505a\u6cd5\u4e8c\u548c\u7279\u6b8a\u6027\u8d28\u4e00\uff0c\u671f\u671b\u5f97\u5206 $68pts$\u3002\n\n### \u505a\u6cd5\u4e09\n\n\u7279\u6b8a\u6027\u8d28\u4e8c\u7edf\u8ba1\u6709\u591a\u5c11 $A$ \u7b26\u5408\u6761\u4ef6\u53ea\u9700\u8003\u8651 $0,\\,1$ \u548c $2$ \u4e09\u79cd\u5947\u6570\u4e2a\u5b57\u7b26\u4e2a\u6570\u7684\u60c5\u51b5\u3002\u6211\u4eec\u53d1\u73b0\uff0c\u9700\u8981\u8003\u8651\u7684\u6700\u591a\u5947\u6570\u4e2a\u5b57\u7b26\u7684\u4e2a\u6570\u662f $26$ \u4e2a\u3002\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log n \\log 26)$\uff0c\u671f\u671b\u5f97\u5206 $84pts$\u3002\n\n### \u6b63\u89e3\n\n\u7ee7\u7eed\u5206\u6790\u53d1\u73b0\uff0c\u5bf9\u4e8e\u56fa\u5b9a\u7684 $(AB)$\uff0c\u6839\u636e\u91cd\u590d\u6b21\u6570\u7684\u5947\u5076\u6027\uff0c\u5176\u5bf9\u5e94\u7684 $C$ \u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u4e2a\u6570\u53ea\u6709\u4e24\u79cd\u53ef\u80fd\u3002\n\n\u76f4\u63a5\u7edf\u8ba1\u6bcf\u79cd\u53ef\u80fd\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5373\u53ef\u3002\u590d\u6742\u5ea6 $O(n \\log 26)$\uff0c\u671f\u671b\u5f97\u5206 $100pts$\u3002",
        "postTime": 1607239432,
        "uid": 242543,
        "name": "BreezeEnder",
        "ccfLevel": 7,
        "title": "NOIp 2020 T2 \u5b57\u7b26\u4e32\u5339\u914d \u9898\u89e3"
    },
    {
        "content": "[\u9898\u9762](https://www.luogu.com.cn/problem/P7114)\n\n\u524d\u8a00\uff1a\n\n\u5f53\u65f6\u5728\u8003\u573a\u4e0a\u6211\u60f3\u5230\u8fd9\u4e2a\u505a\u6cd5\u7684\u65f6\u5019\u5185\u5fc3\u662f\u5341\u5206\u6fc0\u52a8\u7684\uff0c\u6bd5\u7adf\u4f1a\u4e24\u4e2a\u9898\u4e86\u3002\u4f46\u662f\u7531\u4e8e\u5e38\u6570\u8fc7\u5927\uff0c\u88ab\u5361\u5230\u548c$O(tn\\sqrt n)$\u751a\u81f3$O(tn\\sqrt nlogn)$\u540c\u5206\u3002\n\n\u601d\u8def\uff1a\n\n\u4e00\u79cd\u66b4\u529b\u662f\u76f4\u63a5\u679a\u4e3e$AB$\u548c$C$\uff0c\u8003\u8651\u5982\u4f55\u4f18\u5316\u8fd9\u4e2a\u66b4\u529b\u3002\n\n\u53d1\u73b0\u5982\u679c\u6211\u4eec\u77e5\u9053\u4e86$(AB)^i$\uff0c\u90a3\u4e48$C$\u5df2\u7ecf\u786e\u5b9a\u4e86\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u679a\u4e3e$|AB|$\u4ee5\u53ca$i$\u4e86\u3002\n\n\u5982\u4f55\u5224\u65ad\u957f\u4e3a$|AB|^i$\u7684\u524d\u7f00\u662f\u4e0d\u662f$(AB)^i$\uff1f\u7528\u54c8\u5e0c\u3002\n\n\u5f00\u4e00\u4e2a\u6876\u8bb0\u5f55\u6bcf\u79cd\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u6bcd\u51fa\u73b0\u6b21\u6570\u6709\u51e0\u4e2a\u524d\u7f00\uff0c\u679a\u4e3e$i$\u7684\u65f6\u5019\u628a\u6876\u7684\u524d\u7f00\u548c\u7d2f\u52a0\u5230\u5bf9\u5e94\u4f4d\u7f6e\uff0c\u524d\u7f00\u548c\u66b4\u529b\u7ef4\u62a4\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(t(nlogn+26n))$\u3002\n\n\u5148\u8d34\u4e00\u4e0b\u8003\u573a\u4ee3\u7801\uff08\u9664\u4e86\u6ca1\u6709$freopen$\u5176\u4f59\u771f\u5b8c\u5168\u4e00\u81f4\uff09\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int mod=1e9+7;\nconst int base=131;\nint t,n,sum[1050005][30],a[1050005],b[1050005],v[1050005],ans=0,vis[30],l[1050005],r[30],tot=0;\nchar s[1050005];\nsigned main(){\n\tcin>>t;\n\twhile(t--){\n\t\tscanf(\"%s\",s+1);\n\t\tn=strlen(s+1);\n\t\tmemset(a,0,sizeof(a));\n\t\tmemset(b,0,sizeof(b));\n\t\tmemset(v,0,sizeof(v));\n\t\tmemset(l,0,sizeof(l));\n\t\tmemset(vis,0,sizeof(vis));\n\t\tmemset(r,0,sizeof(r));\n\t\tans=0;tot=0;\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tif(!r[s[i]-'a'+1]){\n\t\t\t\ttot++;\n\t\t\t\tr[s[i]-'a'+1]=1;\n\t\t\t}\n\t\t\tfor(int j=1;j<=26;j++){\n\t\t\t\tsum[i][j]=sum[i-1][j]+(j==(s[i]-'a'+1));\n\t\t\t\tif(sum[i][j]%2==1) a[i]++;\n\t\t\t}\n\t\t}\n\t\tfor(int i=n;i>=1;i--){\n\t\t\tfor(int j=1;j<=26;j++){\n\t\t\t\tif((sum[n][j]-sum[i-1][j])%2==1) b[i]++;\n\t\t\t}\n\t\t}\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tv[i]=(base*v[i-1]%mod+(s[i]-'a'+1))%mod;\n\t\t}\n\t\tl[0]=1;\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tl[i]=l[i-1]*base%mod;\n\t\t}\n\t\tfor(int i=2;i<=n;i++){\n\t\t\tfor(int j=a[i-1];j<=26;j++){\n\t\t\t\tvis[j]++;\n\t\t\t}\n\t\t\tfor(int j=i;j<=n;j+=i){\n\t\t\t\tif(v[i]==(((v[j]-(v[j-i]*l[i]%mod))%mod)+mod)%mod){\n\t\t\t\t\tif(j<n) ans+=vis[b[j+1]];\n\t\t\t\t}\n\t\t\t\telse break;\n\t\t\t}\n\t\t}\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tfor(int j=0;j<=26;j++){\n\t\t\t\tsum[i][j]=0;\n\t\t\t}\n\t\t}\n\t\tcout<<ans<<endl;\n\t}\n\treturn 0;\n}\n```\n\n\u5982\u4f55\u4f18\u5316\u8fd9\u4e2a\u88ab\u5361\u621084\u7684\u4ee3\u7801\uff1f\u6211\u5728\u8fd9\u91cc\u5206\u4eab\u4e00\u4e0b\u8003\u540e\u4e3a\u4e86\u901a\u8fc7\u8fd9\u4e2a\u9898\u6211\u7528\u5230\u7684\u4e00\u4e9b\u5361\u5e38\u6280\u5de7\uff1a\n\n1.\u5bf9\u4e8e\u53ef\u4ee5\u7528$short$\u7684\u6570\u7ec4\u7528$short$\u3002\n\n2.\u5c3d\u91cf\u5c11$memset$\u3002\n\n3.\u54c8\u5e0c\u7528\u81ea\u7136\u6ea2\u51fa\uff0c\u5b9e\u6d4b\u6bd4\u819c$10^9+7$\u5feb\u4e0d\u5c11\u3002\n\n4.\u4e0a\u9762\u7684\u4ee3\u7801\u662f\u8bb0$sum(i,j)$\u4e3a$[1,i]$\u4e2d$j$\u51fa\u73b0\u6b21\u6570\uff0c\u7ef4\u62a4\u8fd9\u4e2a\u662f\u4e3a\u4e86\u6c42\u524d\u7f00\u6709\u51e0\u4e2a\u6570\u51fa\u73b0\u4e86\u5947\u6570\u6b21\u3002\u6211\u4eec\u53ef\u4ee5\u53bb\u6389\u7b2c\u4e8c\u7ef4\uff0c\u7528\u6876\u8bb0\u5f55\u6bcf\u4e2a\u5b57\u6bcd\u51fa\u73b0\u6b21\u6570\u7684\u5947\u5076\u6027\u7136\u540e\u7ef4\u62a4\u3002\n\n\u4f18\u5316\u540e\u7684\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define ull unsigned long long\nusing namespace std;\nconst ull base=131;\nint t,n,ans=0,vis[30],r[30],tot=0;\nshort a[1050005],b[1050005],c[1050005],sum[1050005],sum1[1050005];\null v[1050005],l[1050005];\nchar s[1050005];\nsigned main(){\n\tscanf(\"%lld\",&t);\n\tl[0]=1;\n\tfor(int i=1;i<=1050000;i++) l[i]=l[i-1]*base;\n\twhile(t--){\n\t\tscanf(\"%s\",s+1);\n\t\tn=strlen(s+1);\n\t\tmemset(a,0,sizeof(a));\n\t\tmemset(b,0,sizeof(b));\n\t\tmemset(r,0,sizeof(r));\n\t\tmemset(vis,0,sizeof(vis));\n\t\tmemset(sum1,0,sizeof(sum1));\n\t\tans=0;tot=0;\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tc[i]=s[i]-'a'+1;\n\t\t\tr[c[i]]^=1;\n\t\t\tif(r[c[i]]) sum[i]=sum[i-1]+1;\n\t\t\telse sum[i]=sum[i-1]-1;\n\t\t\ta[i]=sum[i];\n\t\t}\n\t\tmemset(r,0,sizeof(r));\n\t\tfor(int i=n;i>=1;i--){\n\t\t\tr[c[i]]^=1;\n\t\t\tif(r[c[i]]) sum1[i]=sum1[i+1]+1;\n\t\t\telse sum1[i]=sum1[i+1]-1;\n\t\t\tb[i]=sum1[i];\n\t\t}\n\t\tfor(int i=1;i<=n;i++) v[i]=base*v[i-1]+1ull*c[i];\n\t\tfor(int i=2;i<=n;i++){\n\t\t\tfor(int j=a[i-1];j<=26;j++) vis[j]++;\n\t\t\tfor(int j=i;j<n&&v[i]==v[j]-v[j-i]*l[i];j+=i) ans+=vis[b[j+1]];\n\t\t}\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1607776665,
        "uid": 247540,
        "name": "tongyf",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P7114 \u3010\u5b57\u7b26\u4e32\u5339\u914d\u3011"
    },
    {
        "content": "\u66f4\u900a\u7684\u4f53\u9a8c $\\to $ [`George1123`](https://www.cnblogs.com/George1123/p/14092005.html)\n\n---\n\n## \u9898\u9762\n\n> [\u6d1b\u8c37P7114 \u5b57\u7b26\u4e32\u5339\u914d](https://www.luogu.com.cn/problem/P7114)\n\n> $T$ \u7ec4\u6d4b\u8bd5\u6570\u636e\u3002\u7ed9\u5b9a\u5b57\u7b26\u4e32 $S$\uff0c\u95ee\u6709\u591a\u5c11\u4e0d\u540c\u7684\u975e\u7a7a\u5b57\u7b26\u4e32 $A$\uff0c$B$\uff0c$C$ \u6ee1\u8db3 $S=ABABAB...ABC$ \u4e14 $A$ \u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6570\u4e0d\u591a\u4e8e $C$\u3002\n\n> \u6570\u636e\u8303\u56f4\uff1a$1\\le T\\le 5$\uff0c$1\\le |S|\\le 2^{20}$\u3002\n\n---\n\n\u8fd9\u4f30\u8ba1\u662f\u6211\u573a\u4e0a\u552f\u4e00\u505a\u51fa\u6765\u7684\u9898\u76ee\u4e86\uff0c[NOIP2020 \u6e38\u8bb0](https://www.cnblogs.com/George1123/p/14091922.html) \u4e5f\u4e0d\u653e\u6d1b\u8c37\u535a\u5ba2\u91cc\u4e86\u3002\n\n---\n\n\u63d0\u4f9b\u4e00\u4e2a $\\Theta(n)$ \u7684\u505a\u6cd5\uff0c\u4e0b\u6807\u4ece $0$ \u5f00\u59cb\u3002\n\n\u6c42\u51fa $S$ \u7684 `Z` \u6570\u7ec4\uff0c$ze_i$ \u8868\u793a\u6ee1\u8db3 $s[0,ze_i)=s[i,i+ze_i)$ \u7684\u6700\u5927\u503c\u3002\n\n\u6839\u636e $s[0,ze_i)=s[i,i+ze_i)$ \u53ef\u4ee5\u63a8\u51fa $s[i,ze_i)=s[2i,i+ze_i)$\u3002\n\n\u6240\u4ee5\u53ef\u4ee5\u679a\u4e3e $AB$ \u7684\u957f\u5ea6 $i$\uff0c\u6613\u5f97\u8fd9\u4e2a\u4e32\u5728\u524d\u7f00\u91cd\u590d\u4e86 $\\lfloor\\frac{ze_i}{i}\\rfloor+1$ \u6b21\u3002\n\n\u7136\u540e\u89e3\u51b3\u5173\u4e8e\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u9650\u5236\u3002\n\n\u7ef4\u62a4\u4e00\u4e2a\u6811\u72b6\u6570\u7ec4\uff0c\u8868\u793a\u6bcf\u4e2a $j<i$ \u7684\u524d\u7f00\u51fa\u73b0\u5947\u6570\u6b21\u5b57\u7b26\u6570\u7684\u96c6\u5408\u3002\n\n\u8ba1\u7b97\u524d\u7f00\u51fa\u73b0\u5947\u6570\u6b21\u5b57\u7b26\u6570\u53ef\u4ee5 $\\Theta(1)$\uff0c\u503c\u57df\u4e3a\u5b57\u7b26\u96c6\u7684\u6811\u72b6\u6570\u7ec4\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u662f $\\Theta(1)$ \u7684\u3002\n\n\u8003\u8651\u5bf9\u4e8e\u5f53\u524d\u7684\u6240\u6709 $ABAB...AB$ \u5bf9\u5e94\u7684 $C$ \u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u5b57\u7b26\u6570\uff1a\u53ea\u6709\u4e24\u79cd\u53ef\u80fd\u3002\n\n\u4e00\u79cd\u662f\u5f53\u524d\u540e\u7f00\u51fa\u73b0\u5947\u6570\u6b21\u5b57\u7b26\u6570\uff0c\u4e00\u79cd\u662f\u5168\u5c40\u51fa\u73b0\u5947\u6570\u6b21\u5b57\u7b26\u6570\u3002\u5148\u9884\u5904\u7406\u540e\u8005\uff0c\u524d\u8005\u53ef\u4ee5 $\\Theta(1)$ \u7ef4\u62a4\u3002\n\n\u56e0\u4e3a $ABAB$ \u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u5b57\u7b26\u6570\u80af\u5b9a\u4e3a $0$\uff0c\u6240\u4ee5\u5bf9\u4e8e $\\lfloor\\frac {\\lfloor\\frac{ze_i}{i}\\rfloor+1}{2}\\rfloor$ \u7684\u80af\u5b9a\u662f\u5168\u5c40\u6b21\u6570\uff0c$\\lceil\\frac {\\lfloor\\frac{ze_i}{i}\\rfloor+1}{2}\\rceil$ \u7684\u80af\u5b9a\u662f\u540e\u7f00\u6b21\u6570\u3002\n\n\u7136\u540e\u5bf9\u4e8e\u4e24\u79cd\u60c5\u51b5\uff0c\u7b54\u6848\u52a0\u4e0a\u6811\u72b6\u6570\u7ec4\u67e5\u8be2\u524d\u7f00\u6ee1\u8db3\u6761\u4ef6\u7684 $A$ \u7684\u6570\u91cf\u4e58\u4ee5\u51fa\u73b0\u6b21\u6570\u5373\u53ef\u3002\n\n\u6240\u4ee5\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n)$\u3002\n\n---\n\n## \u4ee3\u7801\n\n\u56de\u5bb6\u624b\u6572\u7684\u3002\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef double db;\n#define x first\n#define y second\n#define bg begin()\n#define ed end()\n#define pb push_back\n#define mp make_pair\n#define sz(a) int((a).size())\n#define R(i,n) for(int i(0);i<(n);++i)\n#define L(i,n) for(int i((n)-1);i>=0;--i)\nconst int iinf=0x3f3f3f3f;\nconst ll linf=0x3f3f3f3f3f3f3f3f;\n\n//Data\nconst int N=1<<20,C=26;\nint n,all,last,now,tot[C],cnt[C];\nstring str;\n\n//FenwickTree\nint fen[C|1];\nvoid add(int i,int v){for(;i<C+1;i|=i+1) fen[i]+=v;}\nint sum(int i,int v=0){for(;i>=0;(i&=i+1)--) v+=fen[i]; return v;}\n\n//Zebra\nint ze[N];\nvoid zebra(){\n    int l=0;\n    R(i,n) ze[i]=0;\n    R(i,n)if(i){\n        if(l+ze[l]>i) ze[i]=min(l+ze[l]-i,ze[i-l]);\n        while(i+ze[i]<n&&str[ze[i]]==str[i+ze[i]]) ze[i]++;\n        if(i+ze[i]>l+ze[l]) l=i;\n    }\n}\n\n//Main\nvoid Main(){\n    cin>>str,n=sz(str),zebra();\n    R(i,n)if(i+ze[i]==n) ze[i]--;\n    ll ns=all=last=now=fen[C]=0;\n    R(c,C) tot[c]=cnt[c]=fen[c]=0;\n    R(i,n) tot[str[i]-'a']++;\n    R(c,C) all+=(tot[c]&1); last=all;\n    R(i,n){\n        if(tot[str[i]-'a']&1) last--; else last++;\n        if(cnt[str[i]-'a']&1) now--; else now++;\n        tot[str[i]-'a']--,cnt[str[i]-'a']++;\n        if(i&&i<n-1){\n            int t=ze[i+1]/(i+1)+1;\n            // cout<<\"i=\"<<i<<\" t=\"<<t<<'\\n';\n            ns+=1ll*(t/2)*sum(all)+1ll*(t-t/2)*sum(last);\n        }\n        // cout<<\"now=\"<<now<<\" last=\"<<last<<\" all=\"<<all<<'\\n';\n        add(now,1);\n    }\n    cout<<ns<<'\\n';\n}\nint main(){\n    //freopen(\"string.in\",\"r\",stdin);\n    //freopen(\"string.out\",\"w\",stdout);\n    ios::sync_with_stdio(0);\n    cin.tie(0),cout.tie(0);\n    int T; cin>>T;\n    while(T--) Main();\n    return 0;\n}\n```\n\n---\n\n**\u795d\u5927\u5bb6\u5b66\u4e60\u6109\u5feb\uff01**",
        "postTime": 1607220173,
        "uid": 118365,
        "name": "George1123",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P7114 \u3010\u5b57\u7b26\u4e32\u5339\u914d\u3011"
    },
    {
        "content": "## \u4e00\u79cd\u4e0d\u7528\u6269\u5c55KMP\u7684\u65b9\u6cd5\n\n~~\u5f53\u7136KMP\u8fd8\u662f\u4e00\u5b9a\u8981\u7528\u5230\u7684~~\n\n### \u9884\u5904\u7406\n\n\u6839\u636e\u9898\u610f\uff0c\u6211\u4eec\u5148\u505a\u4e24\u4e2a\u9884\u5904\u7406\uff1a\n\n\u8bbe\u5b57\u7b26\u4e32\u957f\u5ea6\u4e3an\n\n`pre[i][j]` \u8868\u793ai\u4f4d\u7f6e\u53ca\u4ee5\u524d\u201d\u6709\u5c0f\u4e8e\u7b49\u4e8ej\u4e2a\u5b57\u7b26\u51fa\u73b0\u6b21\u6570\u4e3a\u5947\u6570\u7684\u4f4d\u7f6e\u201d\u7684\u6570\u91cf\n\n`sub[i]` \u8868\u793a\u4ecei\u4f4d\u7f6e\u5230n\u4f4d\u7f6e\u6709\u591a\u5c11\u4e2a\u5b57\u7b26\u51fa\u73b0\u6b21\u6570\u4e3a\u5947\u6570\uff08\u5373\u9898\u4e2d\u51fd\u6570F\uff09\n\n\u4e3a\u4ec0\u4e48\u8981\u6c42\u8fd9\u4e24\u4e2a\u6570\u7ec4\uff1f\u56e0\u4e3a\u6211\u4eec\u53d1\u73b0AB\u53ef\u4ee5\u770b\u505a\u4e00\u4e2a\u6574\u4f53\uff0c\u5982\u679c\u786e\u5b9a\u4e86AB\u548c\u91cd\u590d\u6b21\u6570\uff0c\u90a3\u4e48C\u4e5f\u5c31\u786e\u5b9a\u4e86\n\n\u76f8\u5f53\u4e8e\u6211\u4eec\u679a\u4e3e\u5982\u4f55\u628a\u5b57\u7b26\u4e32\u5206\u5272\u4e3a $(AB)^i$ \u548c $C$ \u4e24\u90e8\u5206\uff0c\u5982\u679c\u786e\u5b9a\u4e86C\u90e8\u5206\u548cAB\u90e8\u5206\u7684\u53f3\u7aef\u70b9\uff0c\u90a3\u4e48A\u7684\u53f3\u7aef\u70b9\u5c31\u53ef\u4ee5\u7528 `pre` \u6570\u7ec4\u5f97\u5230\n\n\u4f8b\u5982\u6211\u94a6\u5b9aB\u90e8\u5206\u7684\u53f3\u7aef\u70b9\u4e3a `i`\uff0cC\u90e8\u5206\u7684\u5de6\u7aef\u70b9\u4e3a `j`\uff0c\u90a3\u4e48\u6700\u7ec8A\u53ef\u9009\u62e9\u7684\u4f4d\u7f6e\u6570\u5c31\u662f `pre[i-1][sub[j]]`\uff08\u6ce8\u610f\u8fd8\u5f97\u7ed9B\u81f3\u5c11\u7559\u4e00\u4e2a\u4f4d\u7f6e\uff09\n\npre\u548csub\u6570\u7ec4\u7684\u521d\u59cb\u5316\u65b9\u6cd5\u5982\u4e0b\uff1a\n\n```cpp\nint odd=0,cnt=0;//odd\u72b6\u538b\u8bb0\u5f55\uff0c0\u4e3a\u5076\uff0c1\u4e3a\u5947\uff0ccnt\u8bb0\u5f55\u6570\u91cf\nfor(int i=1;i<=n;i++){\n\tif(odd&(1<<a[i]))cnt--;\n\telse cnt++;\n\todd^=(1<<a[i]);\n\tfor(int j=0;j<=26;j++)pre[i][j]=pre[i-1][j]+(j>=cnt);//\u6bcf\u6b21\u7684cnt\u90fd\u4f1a\u5bf9\u5927\u4e8e\u7b49\u4e8e\u5b83\u7684j\u6709\u5f71\u54cd\uff0c\u89c1pre\u7684\u5b9a\u4e49\n}odd=cnt=0;\nfor(int i=n;i>=1;i--){\n\tif(odd&(1<<a[i]))cnt--;\n\telse cnt++;\n\tsub[i]=cnt;//\u540e\u7f00\u8bb0\u5f55\n\todd^=(1<<a[i]);\n}\n```\n\n### \u8ba1\u7b97\u6bcf\u4e2a\u5faa\u73af\u8282\u7684\u8d21\u732e\n\n\u73b0\u5728\u6211\u4eec\u8003\u8651\u4e00\u4e0b\u5982\u4f55\u8ba1\u7b97\u8d21\u732e\n\n\u4e00\u4e2a\u76f4\u89c2\u7684\u60f3\u6cd5\u662f\uff1a\u6211\u4eec\u53ef\u4ee5\u628a\u5b57\u7b26\u4e32\u6bcf\u4e00\u4e2a\u524d\u7f00\u5c1d\u8bd5\u5f53\u4e00\u6b21 $AB$\uff0c\u8ba1\u7b97\u8fd9\u4e2a\u524d\u7f00\u7684Hash\u503c\uff0c\u7136\u540e\u7528\u500d\u589e\u627e\u8fd9\u6bb5\u6700\u591a\u80fd\u5f80\u540e\u6269\u5c55\u591a\u5c11\u4e2a\u5faa\u73af\u8282\n\n\u5f85\u4f1a\u518d\u8003\u8651KMP\u4f18\u5316\uff0c\u4e0d\u59a8\u5148\u770b\u770b\u5982\u679c\u627e\u5230\u4e86\u5faa\u73af\u8282\u6570\u91cf\u4ee5\u540e\u8be5\u600e\u4e48\u505a\uff1a\n\n\u5047\u8bbe\u6211\u4eec\u679a\u4e3e\u4f5c\u4e3a $AB$ \u7684\u524d\u7f00\u4e3a $P=S_{1,i}$\uff08\u53731\u5230i\u7684\u524d\u7f00\uff09\uff0c\u800c\u4e14\u5f80\u540e\u4e00\u5171\u53ef\u4ee5\u6269\u5c55 $sz$ \u4e2a\u5faa\u73af\u8282\uff08\u5305\u62ecP\u672c\u8eab\uff09\uff0c\u5982\u4f55\u8ba1\u7b97\u8d21\u732e\uff1f\n\n\u9996\u5148\u5bf9\u4e8eP\u81ea\u8eab\uff0c\u5982\u679c $sz=1$\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u76f4\u63a5\u5411\u7b54\u6848\u4e2d\u7d2f\u52a0 `ans+=pre[i-1][sub[i+1]]`\uff08\u7ed9B\u7559\u81f3\u5c11\u4e00\u4e2a\u4f4d\u7f6e\u6240\u4ee5\u51cf\u4e00\uff0cC\u4ece\u4e0b\u4e00\u4e2a\u4f4d\u7f6e\u5f00\u59cb\u770b\u6240\u4ee5\u52a0\u4e00\uff09\n\n\u800c\u5982\u679c $sz=2$ \uff0c\u90a3\u4e48\u663e\u7136\u6211\u4eec\u4e0d\u4ec5\u8981\u7b97 $(AB)^1$ \u7684\u8d21\u732e `pre[i-1][sub[i+1]]`\uff0c\u8fd8\u8981\u52a0\u4e0a $(AB)^2$ \u7684\u8d21\u732e `pre[i-1][sub[i*2+1]]` (AB\u7684\u957f\u5ea6\u6ca1\u53d8\uff0cA\u80fd\u9009\u7684\u4f4d\u7f6e\u4e5f\u6ca1\u53d8\uff0c\u4f46C\u5f80\u540e\u51cf\u5c11\u4e86\u4e00\u4e2aAB\u5faa\u73af\u8282)\n\n\u56e0\u6b64\u6211\u4eec\u76f8\u5f53\u4e8e\u9700\u8981\u8ba1\u7b97\uff1a\n\n`for(int k=1;k<=sz;k++)ans+=pre[i-1][sub[i*k+1]]`\n\n\u4f46\u662f\u5728\u51fa\u73b0\u5f88\u591a\u76f8\u540c\u7684\u6570\u7684\u6570\u636e\u91cc\u9762\uff0c $sz$ \u7684\u503c\u663e\u7136\u5f88\u5927\uff0c\u6211\u4eec\u80fd\u4e0d\u80fd\u8003\u8651\u53e6\u5916\u7684\u65b9\u6cd5\u5462\uff1f\n\n\u6ce8\u610f\u5230\u5728P\u56fa\u5b9a\u800ck\u589e\u5927\u7684\u8fc7\u7a0b\u4e2d\uff0cA\u53ef\u9009\u7684\u8303\u56f4\u4e00\u76f4\u662f $[1,i-1]$\uff0c\u4f46C\u4f1a\u4e0d\u65ad\u51cf\u53bb $P$\uff0c\u8003\u8651\u4e00\u4e0bC\u7684sub\u503c\u7684\u53d8\u5316\uff1a\n\n\u9996\u5148\uff0c\u6709\u4ee5\u4e0b\u4e24\u4e2a\u7ed3\u8bba\uff1a(F\u4e3a\u9898\u4e2d\u51fd\u6570)\n\n- $F(P^2)=0$ \n\n- $F(AP^2)=F(A)$\n\n1\u6210\u7acb\u662f\u56e0\u4e3a\u4e24\u4e2a\u76f8\u540c\u5b57\u7b26\u4e32\u76f8\u63a5\u6bcf\u4e2a\u5b57\u7b26\u7684\u51fa\u73b0\u6b21\u6570\u4e00\u5b9a\u90fd\u662f\u5076\u6570\uff08*2\u4e86\uff09\uff0c2\u6210\u7acb\u662f\u56e0\u4e3a\u5947\u6570+\u5076\u6570=\u5947\u6570\uff0c\u5076\u6570+\u5076\u6570=\u5076\u6570\uff0c\u4e0d\u4f1a\u6539\u53d8\u5947\u5076\u6027\n\n\u63a8\u7406\u5230\u672c\u9898\u4e0a\u5c31\u662f\uff1a\n\n$F(P^{sz}C)=F(P^{sz-2}C)$\n\n\u6240\u4ee5\u4e0d\u96be\u53d1\u73b0\uff1a\n\n\u5f53\u4e0a\u9762\u90a3\u4e2afor\u5faa\u73af\u4e2dk\u4e3a\u5947\u6570\u65f6\uff0c\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u76f8\u540c\uff0c\u90fd\u7b49\u4e8e `pre[i-1][sub[i+1]]`\u3002\n\nk\u4e3a\u5076\u6570\u65f6\uff0c\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u76f8\u540c\uff0c\u90fd\u7b49\u4e8e `pre[i-1][sub[2*i+1]]`\n\n\n\u7ecf\u8fc7\u8bd5\u9a8c\uff0c\u53d1\u73b0 $[1,sz]$ \u4e2d\u4e3a\u5076\u6570\u7684\u6570\u7684\u4e2a\u6570\u4e3a $\\lfloor \\frac{sz}{2}\\rfloor$ \uff0c\u4e3a\u5947\u6570\u7684\u6570\u7684\u4e2a\u6570\u4e3a $\\lceil \\frac{sz}{2}\\rceil$\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u7528\u4ee5\u4e0b\u5f0f\u5b50\u76f4\u63a5\u8ba1\u7b97\u5f53\u524d\u524d\u7f00P\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff1a\n\n```cpp\nint valodd=pre[i-1][sub[i+1]];\nint valeven=sz>1?pre[i-1][sub[i*2+1]]:0;//\u7279\u5224\u4e00\u4e0b\u9632\u6b62\u4e0b\u6807\u8d8a\u754c\nans+=(ll)(((sz-1)>>1)+1)*valodd;//\u5947\u6570\u60c5\u51b5\uff08\u4e0a\u53d6\u6574\uff09\nans+=(ll)(sz>>1)*valeven;//\u5076\u6570\u60c5\u51b5\uff08\u4e0b\u53d6\u6574\uff09\n```\n\n\u597d\u4e86\uff0c\u73b0\u5728\u5982\u679c\u914d\u5957hash+\u500d\u589e\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a $O(n\\log n)$ \u7684\u7b97\u6cd5\uff0c\u53ef\u662f\u8fd8\u662f\u8fc7\u4e0d\u53bbqwq\n\n\u56e0\u6b64\u6211\u4eec\u6709\u5fc5\u8981\u8bf7\u51fa\u4e3b\u89d2\u2014\u2014KMP\u7b97\u6cd5\u4e86\uff1a\n\n### KMP \u6c42\u5faa\u73af\u8282\n\nKMP\u6c42\u5faa\u73af\u8282\u672c\u8eab\u6bd4\u8f83\u7b80\u5355\uff08\u8bf7\u5148\u638c\u63e1KMP\u7b97\u6cd5\u7684\u6a21\u677f\u518d\u770b\u63a5\u4e0b\u6765\u7684\u5185\u5bb9\uff09\uff1a\n\n\u7531\u4e8eKMP\u4e2d\u7684 `next[i]` \u8868\u793a\uff1a$S_{1,next_i}=S_{i-next_i+1,i}$\n\n\u56e0\u6b64\u5982\u679c $i-next_i$ \u80fd\u6574\u9664 $i$ \uff0c\u90a3\u4e48\u76f8\u5f53\u4e8e\u6709\u5982\u4e0b\u7684\u4e00\u4e2a\u56fe\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/vqxb82fm.png)\n\n\u8fd9\u91cc\u9762 $i=12,next_i=9$\uff0c\u90a3\u4e48\u524d\u4e09\u4e2a\u6570\u4e0d\u5c5e\u4e8e\u76f8\u540c\u7684\u90a3\u6bb5\u540e\u7f00\uff0c\u4f46\u5c5e\u4e8e\u524d\u7f00\u7684\u524d\u4e09\u4e2a\uff0c\u90a3\u4e48\u76f8\u540c\u7684\u90a3\u6bb5\u957f\u5ea6\u4e3a9\u7684\u540e\u7f00\u7684\u524d\u4e09\u4e2a\u4e5f\u548c\u524d\u7f00\u7684\u524d\u4e09\u4e2a\u76f8\u540c\uff0c\u8fd9\u6837\u4e00\u6b65\u4e00\u6b65\u5f80\u540e\u63a8\uff0c\u5982\u679c\u6b63\u597d\u6574\u9664\uff0c\u8bf4\u660e\u5b58\u5728\u4e00\u4e2a\u5faa\u73af\u8282\u4e3a3\uff0c\u91cd\u590d\u4e86 $\\frac{i}{i-next_i}=4$ \u6b21\n\n\u5b9e\u9645\u4e0a\u7531\u4e8e $next_i$ \u4fdd\u8bc1\u662f\u5c0f\u4e8ei\u7684\u6700\u5927\u7684\uff0c\u56e0\u6b64\u627e\u5230\u7684\u5c31\u662f\u6700\u5c0f\u5faa\u73af\u8282\u3002\n\n\u4ee3\u7801\uff1aKMP\u627e\u6700\u5c0f\u5faa\u73af\u8282\uff1a\n\n```cpp\nfor(int i=2,j=0;i<n;i++){\n\twhile(j&&a[j+1]!=a[i])j=nxt[j];\n\tif(a[j+1]==a[i])nxt[i]=++j;\n\tif(nxt[i]&&i%(i-nxt[i])==0)//\u627e\u5230\u4e86\u4e00\u4e2a\u5faa\u73af\u8282\uff0cdo sth.\n}\n```\n\n\u4f46\u662f\u8fd9\u9053\u9898\u8fd8\u4e0d\u592a\u4e00\u6837\uff0c\u8fd9\u9053\u9898\u4e2d\u6211\u4eec\u9700\u8981\u627e\u5230\u6bcf\u4e00\u4e2a\u524d\u7f00\u662f\u5426\u80fd\u5f80\u540e\u6784\u6210\u5faa\u73af\u8282\uff0c\u5982\u4f55\u8f6c\u5316\u5462\uff1f\n\n\u6211\u4eec\u4e0d\u59a8\u8bb0\u5f55\u4e00\u4e0b\u6bcf\u4e2a\u6700\u5c0f\u5faa\u73af\u8282\u6700\u591a\u80fd\u591f\u5f80\u540e\u63a8\u591a\u5c11\u6b21\uff0c\u5373\u7528\u4e00\u4e2a\u6570\u7ec4 `ma[i]`\uff0c\u8868\u793a\u957f\u5ea6\u4e3ai\u7684\u524d\u7f00\u4f5c\u4e3a\u6700\u5c0f\u5faa\u73af\u8282\uff0c\u6700\u591a\u53ef\u4ee5\u5f80\u540e\u63a8\u5230\u4ec0\u4e48\u4f4d\u7f6e\n\n\u90a3\u4e48\u6211\u4eec\u7528\u4e0a\u9762\u7684\u4ee3\u7801\uff0c\u5728do sth\u7684\u4f4d\u7f6e\u52a0\u4e0a\u4e00\u53e5 `ma[i-nxt[i]]=i` \u5373\u53ef\u6c42\u51fa\uff08i\u662f\u9012\u589e\u7684\uff0c\u4e0d\u7528\u5199max\uff09\n\n\u7136\u540e\u8003\u8651\u67d0\u4e00\u4e2a\u6700\u5c0f\u5faa\u73af\u8282\u4e3a\u524d\u7f00 $P_{1,i}$ \u65f6\uff1a\uff08sz\u51fd\u6570\u4ee3\u8868\u5b83\u53ef\u4ee5\u5f80\u540e\u590d\u5236\u591a\u5c11\u6b21\uff08\u6700\u9ad8\u5e42\u6b21\uff09\uff09\n\n$sz(P^k)=\\frac{ma_i}{i\\cdot k}$\n\n\u610f\u601d\u5c31\u662f\u8bf4\uff0c\u65e2\u7136P\u662f\u6700\u5c0f\u5faa\u73af\u8282\uff0c\u90a3\u4e48\u6240\u6709\u80fd\u88ab\u8fd9\u4e2a\u6700\u5c0f\u5faa\u73af\u8282\u8868\u793a\u7684\u524d\u7f00\uff08P\u7684k\u6b21\u65b9\uff09\u4e5f\u4e00\u5b9a\u53ef\u4ee5\u5f80\u540e\u9762\u63a8\u51e0\u4e2a\uff08P\u7684k\u6b21\u65b9\u7684\uff09\u5faa\u73af\u8282\uff08\u5f53\u7136\u4e5f\u6709\u53ef\u80fd\u53ea\u80fd\u63a81\u6b21\uff09\n\n\u6240\u4ee5\u5c31\u53ef\u4ee5\u76f4\u63a5\u8003\u8651\u65b0\u7684 $sz$\uff0c\u7136\u540e\u5957\u7528\u4e0a\u9762\u7b2c\u4e8c\u6b65\u7684\u516c\u5f0f\u5373\u53ef\uff1a\n\n```cpp\nfor(int i=2,j=0;i<n;i++){//n\u4f4d\u7f6e\u8981\u7559\u7ed9C\uff0c\u4e0d\u80fd\u7b97\n\twhile(j&&a[j+1]!=a[i])j=nxt[j];\n\tif(a[j+1]==a[i])nxt[i]=++j;\n\tif(nxt[i]&&i%(i-nxt[i])==0)ma[i-nxt[i]]=i;//\u8bb0\u5f55ma\u6570\u7ec4\n}for(int i=2;i<n;i++){\n\tif(ma[i]/*\u81ea\u8eab\u5c31\u662f\u6700\u5c0f\u5faa\u73af\u8282*/||(nxt[i]&&i%(i-nxt[i])==0&&ma[i-nxt[i]])/*\u80fd\u88ab\u67d0\u4e2a\u6700\u5c0f\u5faa\u73af\u8282\u8868\u793a*/){\n\t\tint sz=(ma[i]?ma[i]:ma[i-nxt[i]])/i,valodd=pre[i-1][sub[i+1]];//\u8fd9\u91cc\u7684sz\u8868\u793a\u5f53\u524d\u524d\u7f00\u8fd8\u80fd\u5f80\u540e\u62d3\u5c55\u591a\u5c11\u6b21,valodd\u548cvaleven\u610f\u4e49\u540c\u7b2c\u4e8c\u6b65\n\t\tint valeven=sz>1?pre[i-1][sub[i*2+1]]:0;\n        //\u7b2c\u4e8c\u6b65\u7684\u516c\u5f0f\n\t\tans+=(ll)(((sz-1)>>1)+1)*valodd;\n\t\tans+=(ll)(sz>>1)*valeven;\n\t}else ans+=pre[i-1][sub[i+1]];//\u5982\u679c\u4e0d\u80fd\u88ab\u67d0\u4e2a\u6700\u5c0f\u5faa\u73af\u8282\u8868\u793a\uff0c\u90a3\u4e48\u5c31\u6309\u7167sz=1\u7684\u60c5\u51b5\u6765\u7b97\u8d21\u732e\u3002\n}\n```\n\u6700\u7ec8\u7684ans\u5c31\u662f\u7b54\u6848\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a\u9884\u5904\u7406 $O(NC)$\uff0cKMP\u548c\u7b97\u8d21\u732e $O(N)$\uff0c\u603b\u7684\u65f6\u95f4\u590d\u6742\u5ea6 $O(NC)$ \uff08C\u4e3a\u5b57\u7b26\u96c6\u5927\u5c0f\uff09\n",
        "postTime": 1617806835,
        "uid": 65743,
        "name": "\u6ed1\u7a3d\u7684\u5c0f\u5bab",
        "ccfLevel": 7,
        "title": "P7114 \u5b57\u7b26\u4e32\u5339\u914d"
    },
    {
        "content": "\u9996\u5148\u8003\u8651\u66b4\u529b\uff1a\u4ee4 $T=AB$\uff0c\u4ece\u5c0f\u5230\u5927\u679a\u4e3e $T$ \u7684\u957f\u5ea6\uff0c\u627e\u5230**\u6700\u77ed\u7684** $C_1$\uff0c\u679a\u4e3e\u6709\u591a\u5c11\u4e2a $T$ \u7684\u771f\u524d\u7f00 $A$ \u6ee1\u8db3 $F(A) \\leqslant F(C_1)$\uff0c\u4e4b\u540e\u4ee4 $C_2=ABC$\uff0c\u518d\u4ee4 $C_3=ABABC$\u2026\u2026\u4ee5\u6b64\u7c7b\u63a8\n\n\u7136\u540e\u6211\u4eec\u53d1\u73b0 $F(S)$ \u6bd4\u8f83~~\u8be1\u5f02~~\u7279\u6b8a\uff0c\u8003\u8651\u4ece\u5b83\u6765\u4f18\u5316\u3002\u7ed3\u5408\u4e0a\u9762\u7684\u66b4\u529b\u5206\u6790\uff0c\u5bb9\u6613\u60f3\u5230 $F(C_k)$ \u7684\u524d\u9762\u7684\u6240\u6709 $ABAB$ \u5747\u4e0d\u4f1a\u5bf9\u5176\u4ea7\u751f\u8d21\u732e\uff0c\u6545\u6709 $F(C_{2n-1})=F(C_1)$\uff0c$F(C_{2n})=F(C_2)$\n\n\u6240\u4ee5\uff0c$A,B,C$ \u662f\u4e00\u7ec4\u89e3\u5c31\u610f\u5473\u7740 $A,B,ABABC$ \u4e5f\u662f\u4e00\u7ec4\u89e3\uff08\u5982\u679c $AB$ \u7684\u91cd\u590d\u6b21\u6570 $\\geqslant 3$\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u65e0\u9700\u679a\u4e3e\u6240\u6709\u7684 $C_k$\uff0c\u800c\u53ea\u9700\u8ba1\u7b97 $C_1$ \u4e0e $C_2$ \u89e3\u7684\u6570\u91cf\uff0c\u518d\u5206\u522b\u4e58\u4e0a\u6709\u591a\u5c11 $C_k$ \u4e0e\u5176\u76f8\u540c\u5373\u53ef\n\n\u6700\u540e\u6211\u4eec\u53d1\u73b0\u65f6\u95f4\u590d\u6742\u5ea6\u7684\u74f6\u9888\u5728\u4e8e\u627e\u5230\u6700\u77ed\u7684 $C$\uff0c\u770b\u51fa\u8fd9\u4e2a\u95ee\u9898\u672c\u8d28\u662f\u6c42 $T$ \u7684\u6700\u5927\u91cd\u590d\u6b21\u6570\uff0c\u4f7f\u7528\u5b57\u7b26\u4e32 Hash \u5373\u53ef\n\n\u6b64\u7b97\u6cd5\u662f $n (\\ln n+\\log_2 26)$ \u7684\n\n\u5177\u4f53\u5b9e\u73b0\u8fd8\u6709\u4e00\uff08\u5f88\uff09\u4e9b\uff08\u591a\uff09\u7ec6\u8282\uff0c\u53c2\u89c1\u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <cctype>\ntypedef unsigned long long ULL;\nconst ULL MAXN = (1 << 20) + 5, BASE = 2017;\nchar s[MAXN]; // \u8bfb\u5165\u7684\u5b57\u7b26\u4e32 \nint t, len; // t\u4e3a\u6570\u636e\u7ec4\u6570\uff0clen\u4e3a\u5b57\u7b26\u4e32\u957f\u5ea6 \nULL h[MAXN]; // h[i]\u8868\u793a   \u957f\u5ea6\u4e3ai\u7684\u524d\u7f00 \u7684Hash\u503c \nint jcnt, djcnt[MAXN]; // jcnt\u8868\u793aF(T)\uff0cdjcnt[i]\u8868\u793a F(S_i\u81f3S_n\u7ec4\u6210\u7684\u5b57\u7b26\u4e32) \nbool isj[30], disj[30]; // \uff08i\u4ece0\u5f00\u59cb\uff09isj[i]\u8868\u793a\u7b2ci\u4e2a\u5b57\u6bcd\u51fa\u73b0\u5947\u6570\u6b21\u662ftrue/false\uff0cdisj[i]\u610f\u4e49\u4e0eisj[i]\u76f8\u540c\uff0c\u4f46\u4e3a\u5012\u5e8f\u66f4\u65b0 \nULL ans; // \u7b54\u6848 \n//int cnt[30]; // cnt[i]\u8868\u793a\u6709i\u4e2a\u5b57\u6bcd\u51fa\u73b0\u5947\u6570\u6b21\u7684T\u7684\u771f\u524d\u7f00\u7684\u6570\u91cf \nint bit[30]; // \u8868\u793a\u7531cnt[i]\u6784\u6210\u7684\u6811\u72b6\u6570\u7ec4 \n\ninline int lowbit(int x)\n{ return x & (-x); }\n\nvoid update(int x) {\n\t++x; //\u6811\u72b6\u6570\u7ec4\u4e0d\u80fd\u5904\u7406\u4e0b\u6807\u4e3a0\u7684\u60c5\u51b5\uff0c\u6545\u201c\u5e73\u79fb\u201d\u4e00\u4f4d \n\twhile(x <= 27) {\n\t\t++bit[x];\n\t\tx += lowbit(x);\n\t}\n}\n\nint sum(int x) {\n\t++x;\n\tint s = 0;\n\twhile(x >= 1) {\n\t\ts += bit[x];\n\t\tx -= lowbit(x);\n\t}\n\treturn s;\n}\n// \u624b\u5199\u8bfb\u5165\uff0c\u8fd4\u56de\u8bfb\u5165\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\n// \uff08\u4f46\u597d\u50cf\u5e76\u6ca1\u6709\u4ec0\u4e48\u5375\u7528 \nint input(char* s) {\n\tchar c = getchar();\n\tint i = 0;\n\twhile(!islower(c))\n\t\tc = getchar();\n\twhile(islower(c)) {\n\t\ts[++i] = c;\n\t\tc = getchar();\n\t}\n\treturn i;\n}\n\nint main() {\n//\tfreopen(\"string.in\", \"r\", stdin);\n//\tfreopen(\"string.out\", \"w\", stdout);\n\tscanf(\"%d\", &t);\n\twhile(t--) {\n\t\tlen = input(s);\n\t\tdjcnt[len] = 1; // \u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u91cd\u590d\u4e86\u4e00\u6b21\uff08\u5947\u6570\u6b21\uff09 \n\t\tdisj[s[len] - 'a'] = 1; // \u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u51fa\u73b0\u5947\u6570\u6b21=true \n\t\tfor(int i = len - 1; i >= 1; --i) //\u9884\u5904\u7406djcnt[i]\u4ee5\u5feb\u901f\u8ba1\u7b97C \n\t\t\tdjcnt[i] = djcnt[i + 1] + ((disj[s[i] - 'a'] = !disj[s[i] - 'a']) == 1 ? 1 : -1);\n\t\th[1] = s[1] - 'a'; // \u7b2c1\u4e2a\u5b57\u7b26\u7684Hash\u503c \n\t\tfor(int i = 2; i <= len; ++i) // \u9012\u63a8\u8ba1\u7b97Hash\u503c \n\t\t\th[i] = h[i - 1]*BASE + s[i] - 'a';\n\t\tULL a = BASE*BASE;\n\t\tupdate(1); // \u7b2c\u4e00\u4e2a\u5b57\u7b26\u91cd\u590d\u4e86\u4e00\u6b21\uff08\u5947\u6570\u6b21\uff09 \n\t\tisj[s[1] - 'a'] = 1; // \u7b2c\u4e00\u4e2a\u5b57\u7b26\u51fa\u73b0\u5947\u6570\u6b21=true \n\t\tjcnt = 1; // \u6709\u4e00\u4e2a\u5b57\u7b26\u51fa\u73b0\u5947\u6570\u6b21 \n\t\tfor(int i = 2; i < len; ++i) { // \u5faa\u73af\u4ece2\u5f00\u59cb\uff08\u5426\u5219A,B\u4e2d\u5fc5\u6709\u4e00\u7a7a\u4e32\uff09\u5230len-1\u7ed3\u675f\uff08\u5426\u5219C\u4e3a\u7a7a\u4e32\uff09 \n\t\t\tint x = 1; // T\u7684\u5faa\u73af\u6b21\u6570 \n\t\t\tfor(int j = (i << 1); j <= len; j += i) {\n\t\t\t\t/* e.g.\n\t\t\t\t * h[i]: abc\n\t\t\t\t * h[j - i]:          abcabc\n\t\t\t\t * h[j]:              abcabc???\n\t\t\t\t * h[j - i]*a:        ---abcabc\n\t\t\t\t * h[j] - h[j - i]*a: abc\n\t\t\t\t * \u5bb9\u6613\u53d1\u73b0\u53ea\u6709???=abc\u624d\u6709h[j] - h[j - i]*a == h[i] \n\t\t\t\t */\n\t\t\t\tif(h[j] - h[j - i]*a == h[i])\n\t\t\t\t\t++x;\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t// \u540e\u9762\u56db\u884c\u662f\u8ba1\u7b97A,B,C\u7684\u60c5\u51b5 \n\t\t\tif(x*i == len) //\u6b64\u65f6x*i+1=len+1\uff0c\u7531\u4e8e\u6211\u6ca1\u6709\u6e05\u7a7adjcnt\u6240\u4ee5\u4e0d\u80fd\u628adjcnt[len+1]\u89c6\u4e3a0\uff0c\u6545\u4e0d\u80fd\u6cbf\u7528else\u60c5\u51b5\u7684\u4ee3\u7801 \n\t\t\t\tans += 1ULL*bit[1]*((x - 1) >> 1); // C\u4e0d\u80fd\u662f\u7a7a\u4e32\uff0c\u6545\u6bd4else\u7684\u60c5\u51b5\u5c11\u4e00\u4e2aC \n\t\t\telse\n\t\t\t\tans += 1ULL*sum(djcnt[x*i + 1])*((x + 1) >> 1); // C_1,C_3,...,C_k\uff08k\u4e3a\u5947\u6570\u4e14<=x\uff09\u90fd\u53ef\u4ee5 \n\t\t\t// \u540e\u9762\u4e00\u884c\u662f\u8ba1\u7b97A,B,ABC\u7684\u60c5\u51b5 \n\t\t\tans += 1ULL*sum(djcnt[(x - 1)*i + 1])*(x >> 1); // C_2,C_4,...,C_k\uff08k\u4e3a\u5947\u6570\u4e14<=x\uff09\u90fd\u53ef\u4ee5 \n\t\t\tupdate((isj[s[i] - 'a'] = !isj[s[i] - 'a']) ? ++jcnt : --jcnt); // \u6ce8\u610f\u8fd9\u91cc\u8981\u5728\u8ba1\u7b97\u540e\u66f4\u65b0\uff0c\u5426\u5219B\u53ef\u80fd\u4f1a\u4e3a\u7a7a\u4e32 \n\t\t\ta *= BASE; //T\u7684\u957f\u5ea6\u589e\u52a0\uff0ca\u4e5f\u8981\u968f\u4e4b\u589e\u52a0 \n\t\t}\n\t\tprintf(\"%llu\\n\", ans);\n\t\tmemset(disj, 0, sizeof(disj));\n\t\tmemset(isj, 0, sizeof(isj));\n\t\tmemset(bit, 0, sizeof(bit));\n\t\tans = 0;\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1607442845,
        "uid": 225734,
        "name": "derta",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011\u3010NOIp2020 T2 P7114 \u5b57\u7b26\u4e32\u5339\u914d\u3011"
    },
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/P7114)\n# \u5206\u6790\n\u9898\u76ee\u8981\u6c42\u539f\u5b57\u7b26\u4e32\u53ef\u4ee5\u5206\u89e3\u6210\u591a\u5c11\u79cd$(AB)^iC$\u7684\u5f62\u5f0f\uff0c\u8be5\u5f0f\u5b50\u7684\u610f\u4e49\u89c1\u9898\u9762\u3002\n\n\u5982\u679c\u4e0d\u8003\u8651\u90a3\u4e2a\u5947\u602a\u7684\u5947\u5076\u9650\u5236\uff0c\u90a3\u4e48\u5e94\u8be5\u600e\u4e48\u505a?\n\n\u9996\u5148\u6709\u4e24\u79cd\u60f3\u6cd5\uff0c\u80af\u5b9a\u662f\u5148\u679a\u4e3e\u4e00\u90e8\u5206\uff0c\u7136\u540e\u901a\u8fc7\u4e00\u4e9b~~\u5947\u602a\u7684~~\u4f18\u5316\u6765\u89e3\u51b3\u3002\n\u6bd4\u8f83\u65b9\u4fbf\u7684\u505a\u6cd5\uff0c\u5c31\u662f\u679a\u4e3e$AB$\uff0c\u8fd9\u6837\u53ef\u4ee5\u5728\u4e4b\u540e\u627e\u5faa\u73af\u8282\u6765\u89e3\u51b3\uff0c\u7136\u540e\u786e\u5b9a$C$\uff0c\u800c\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u5c31\u662f\u6211\u9700\u8981\u77e5\u9053\u5faa\u73af\u8282\u3002\n\u4e8e\u662f\u6b63\u89e3\u7528$exKMP$\uff0c\u4e8e\u662f\u2026\u2026\n>\u5927\u70ae\u6253\u868a\u5b50---by xinjun\n\n\u4e8e\u662f\u53c2\u7167\u4e86\u5b57\u7b26\u4e32\u7684\u9898\u76ee\uff0c\u60f3\u5230\u54c8\u5e0c\u3002\n\u6211\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u5230\u6bcf\u4e2a\u4f4d\u7f6e\u7684\u54c8\u5e0c\u503c\uff0c\u7136\u540e\u7528\u524d\u7f00\u548c\u7684\u65b9\u5f0f\u5c06\u5b83\u6c42\u51fa\u6bcf\u4e00\u6bb5\u7684\u54c8\u5e0c\u503c\uff0c\u53ef\u4ee5$O(1)$\u6bd4\u8f83\u4e24\u6bb5\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u7b49\u3002\u53ef\u4ee5\u5feb\u901f\u5730\u627e\u5faa\u73af\u8282\u3002\n\u6bd4\u5982\u6211\u5f53\u524d\u679a\u4e3e\u7684$AB$\uff0c\u90a3\u4e48\u5728$AB$\u540e\u9762\u7684\u7b49\u957f\u7684\u54c8\u5e0c\u503c\u5224\u4e00\u5224\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u540e\uff0c\u53ef\u4ee5\u6765\u770b\u5947\u5076\u7684\u9650\u5236\u4e86\u3002\n\n\u9996\u5148\u5f88\u7b80\u5355\u53ef\u4ee5\u5f97\u51fa\uff1a$A$\u662f\u6574\u4e2a\u4e32\u7684\u524d\u7f00\uff0c$C$\u662f\u6574\u4e2a\u4e32\u7684\u540e\u7f00\uff0c\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u4f4d\u7f6e\u524d\u540e\u7f00\u7684\u5947\u5076\uff0c\u7136\u540e\u8fdb\u884c\u5224\u65ad\u3002\n\u770b\u4f3c\u597d\u50cf\u89e3\u51b3\u4e86\u543c\uff0c\u4f46\u662f\uff01\u4f1a\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\uff1a\u6709\u591a\u4e2a\u5faa\u73af\u8282\uff0c\u4f46\u662f\u6211\u53ef\u4ee5\u628a\u6700\u540e\u4e00\u4e2a\u5faa\u73af\u8282\u7b97\u6210$C$\uff0c\u8fd9\u4f3c\u4e4e\u4e5f\u662f\u53ef\u4ee5\u7684\u3002\u5982\u679c\u4e0d\u8003\u8651\u5947\u5076\uff0c\u5c31\u662f\u5faa\u73af\u8282\u7684\u4e2a\u6570\uff0c\u4f46\u662f\u8003\u8651\u4e86\u5947\u5076\u4e4b\u540e\u5c31\u663e\u5f97\u9ebb\u70e6\u4e86\u3002\uff08\u8fd9\u91cc\u6dfb\u4e00\u5634\uff0c\u6211\u4e00\u5f00\u59cb\u60f3\u8fc7\u4e3a\u4ec0\u4e48\u4e0d\u8981\u8003\u8651\u628a\u5faa\u73af\u8282\u5408\u5e76\u540e\u53c8\u662f\u51e0\u4e2a\u5faa\u73af\u8282\u7684\u60c5\u51b5\uff0c\u4f46\u662f\u6211\u679a\u4e3e\u7684\u662f\u5faa\u73af\u8282\u7684\u957f\u5ea6\uff0c\u4e24\u4e2a\u6216\u8005\u51e0\u4e2a\u5408\u5e76\u5c31\u4e0d\u5728\u5f53\u524d\u7684\u679a\u4e3e\u8303\u56f4\u5185\uff0c\u4e4b\u540e\u4f1a\u7b97\u8fdb\u53bb\u7684\uff09\n\n\u90a3\u4e48\u6211\u4eec\u4e0d\u59a8\u5c06\u4e4b\u60c5\u5f62\u5c55\u793a\u4e00\u4e0b\uff0c\u6bd4\u5982\uff0c\u6211\u5f53\u524d\u5224\u65ad$(AB)^iC$\u5408\u6cd5\uff0c\u5947\u5076\u4e5f\u5408\u6cd5\uff0c\u90a3\u4e48$(AB)^{i-1}ABC$\u662f\u5426\u5408\u6cd5\u5462\uff1f\u4e0d\u77e5\u9053\uff0c\u56e0\u4e3a$B$\u7684\u5947\u5076\u6027\u6211\u4e0d\u77e5\u9053\uff0c\u4e4b\u524d\u7684\u5224\u5b9a\u662f\u4f9d\u9760\u524d\u7f00\u7684\u5947\u5076\u6765\u89e3\u51b3$A$\u7684\u5947\u5076\uff0c\u5982\u679c\u518d\u5224$B$\u7684\u663e\u7136\u4f1a\u8d85\u65f6\uff0c\u90a3\u600e\u4e48\u529e\uff1f(\u4f60\u53ef\u80fd\u4f1a\u8bf4\u53ef\u4ee5\u7528\u4ece\u6700\u540e\u4e00\u4e2a$A$\u7684\u540e\u7f00\u60c5\u51b5\u89e3\u51b3\uff0c\u4f46\u662f\u53ef\u4ee5\u8bd5\u8bd5\uff0c\u8fd9\u4e5f\u662f\u9700\u8981\u679a\u4e3e\u7684\uff0c\u5728\u6ca1\u6709\u4e0b\u9762\u7684\u7ed3\u8bba\u4e4b\u524d\uff0c\u662f\u65e0\u6cd5\u5f88\u597d\u5730\u89e3\u51b3\u7684\u3002)\n\n\u522b\u6025\uff0c\u7ee7\u7eed\u62c6\u4e00\u4e2a\uff0c$(AB)^{i-2}ABABC$\u662f\u5426\u5408\u6cd5\uff1f\u5408\u6cd5\uff0c\u5e76\u4e14\u4e00\u5b9a\u5408\u6cd5(\u8fd9\u662f\u5efa\u7acb\u5728$(AB)^iC$\u5df2\u7ecf\u5408\u6cd5\u7684\u57fa\u7840\u4e0a\u7684\u3002)\u3002\u4e3a\u4ec0\u4e48\uff1f\u56e0\u4e3a$ABAB$\u4e00\u5b9a\u6bcf\u4e2a\u5b57\u6bcd\u90fd\u51fa\u73b0\u5076\u6570\u6b21\uff0c\u5bf9\u540e\u7f00\u7684\u5947\u5076\u4e0d\u4ea7\u751f\u5f71\u54cd\u3002\n\n\u6240\u4ee5\u5b9a\u4e49\u51fd\u6570$odl(S)$\u8868\u793a$S$\u7684\u5947\u5076\u6027\uff0c\u5219$odl(S)=odl(AAS)$\u3002\n\u6240\u4ee5\u53ea\u8981\u5224\u65ad\u540e\u7f00\u5c31\u53ef\u4ee5\u63a8\u5e7f\u81f3\u5168\u90e8\u4e86\u3002\n\n\u6700\u540e\u4e00\u4e2a\u95ee\u9898\uff0c\u679a\u4e3e\u4e86$AB$\u540e\uff0c\u65e0\u6cd5\u786e\u5b9a$A,B$\u7684\u5206\u5272\u70b9\u3002\u786e\u5207\u5730\u8bf4\uff0c\u679a\u4e3e\u4e86\u4e00\u4e2a\u4e32$S$\uff0c\u4f46\u662f\u8fd9\u4e2a$S$\u53ef\u4ee5\u6709\u5f88\u591a\u79cd\u65b9\u5f0f\u62c6\u6210$A$\u548c$B$\u7684\u5f62\u5f0f\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u679a\u4e3e$A$\uff0c\u7136\u540e\u5224\u65ad\u662f\u5426\u5408\u6cd5\u3002\n\u7ed3\u679c\u8d85\u65f6\u4e86\u3002\u90a3\u4e48\u7ed3\u679c\u600e\u4e48\u529e\uff1f\u8bf6\u53d1\u73b0\u5b57\u6bcd\u662f\u53ea\u670926\u4e2a\u7684\uff0c\u6211\u53ef\u4ee5\u5b58\u4e00\u4e0b\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u6bcf\u4e2a\u51fa\u73b0\u5947\u6570\u6b21\u5b57\u6bcd\u4e2a\u6570\u76f8\u7b49\u7684\u524d\u7f00\u4e2a\u6570\uff0c\u5373\u7528$t[i]$\u8868\u793a\u524d\u51e0\u4e2a\u524d\u7f00\u4e2d\u6709\u591a\u5c11\u4e2a\u51fa\u73b0\u5947\u6570\u6b21\u5b57\u6bcd\u4e2a\u6570\u662f$i$\u4e2a\u7684\u3002\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u540e\u7f00\uff0c\u90fd\u679a\u4e3e\u4e00\u904d\u6bd4\u5b83\u5c0f\u7684\u4e2a\u6570\uff0c\u76f4\u63a5\u52a0\u5728$ans$\u4e2d\u5373\u53ef\u3002\n\n# \u4ee3\u7801\n$\\color{Red}{PS}$:\u672c\u4ee3\u7801\u53ef\u80fd\u5b58\u5728\u59ff\u52bf\u4e0d\u597d\u7b49\u95ee\u9898\uff0cOJ\u4e0d\u7a33\u5b9a\u7684\u65f6\u5019\u53ef\u80fd\u4f1a$\\color{Red}{TLE}$\uff0c\u5e0c\u671b\u5404\u4f4d\u81ea\u5df1\u5199\uff0c\u4ec5\u4ec5\u63d0\u4f9b\u53c2\u8003\u3002\n\n~~\u6216\u8005\u8d81OJ\u4e0d\u6ce8\u610f\uff0c\u5361\u8fc7\u53bb\uff0c\u6211\u5c31\u662f\u8fd9\u4e48\u5728luogu\u4e0a\u8fc7\u7684233\uff0c\u4ee5\u540e\u53d1\u8a93\u518d(yi)\u4e5f(ding)\u4e0d(yao)\u5361\u8bc4\u6d4b\u3002~~\n\n```cpp\n#include<bits/stdc++.h>\n#define ull unsigned long long\n#define ll long long\nusing namespace std;\nconst int MAXN=(1<<20)+100;\nconst int B=499;\nchar s[MAXN];\n\null h[MAXN],base[MAXN];//ull\u81ea\u52a8\u6ea2\u51fa\null geth(int l,int r){return h[r]-h[l-1];}\n\nint odp[MAXN],odl[MAXN],cnt[30],t[30];\n//odp\u662f\u524d\u7f00\u5947\u6570\u4e2a\u6570odd_pre\n//\u540c\u7406odd_last\nint main()\n{\n//\tfreopen(\"string.in\",\"r\",stdin);\n//\tfreopen(\"string.out\",\"w\",stdout);\n\tint T,len;\n\tscanf(\"%d\",&T);\n\twhile(T--){\n\t\tscanf(\"%s\",s+1);\n\t\tlen=strlen(s+1);\n\t\t\n\t\tbase[1]=1;h[0]=0;\n\t\tfor(int i=1;i<=len;i++){\n\t\t\th[i]=base[i]*s[i]+h[i-1];\n\t\t\tbase[i+1]=base[i]*B;\n\t\t}\n\t\t\n\t\tmemset(cnt,0,sizeof(cnt));\n\t\todp[0]=0;\n\t\tfor(int i=1;i<=len;i++){\n\t\t\todp[i]=odp[i-1];\n\t\t\tif(cnt[s[i]-'a']&1) odp[i]--;\n\t\t\telse odp[i]++;\n\t\t\tcnt[s[i]-'a']++;\n\t\t}\n\t\tmemset(cnt,0,sizeof(cnt));\n\t\todl[len+1]=0;\n\t\tfor(int i=len;i>=1;i--){\n\t\t\todl[i]=odl[i+1];\n\t\t\tif(cnt[s[i]-'a']&1) odl[i]--;\n\t\t\telse odl[i]++;\n\t\t\tcnt[s[i]-'a']++;\n\t\t}\n\t\t\n\t\tmemset(t,0,sizeof(t));\n\t\tll ans=0;t[1]=1;\n\t\tfor(int x=2;x<len;x++){\n\t\t\tint tm=0,st=0;\n\t\t\tull cur=geth(1,x);\n\t\t\twhile(geth(st+1,st+x)==cur*base[st+1]&&st+x<len) tm++,st+=x;//\u4e0d\u65ad\u5411\u540e\u627e\n\t\t\tst-=x;\n\t\t\tfor(int i=odl[st+x+1];i>=0;i--) ans+=((tm+1)/2)*t[i];\n\t\t\tfor(int i=odl[st+1];i>=0;i--) ans+=(tm/2)*t[i];\n\t\t\tt[odp[x]]++;\n\t\t}printf(\"%lld\\n\",ans);\n\t}\n}\n```\n# END\n\u5927\u5bb6\u53ef\u4ee5\u53bb\u4f60\u8c37\u4e0a\u770b\u770b\u5361\u5e38\u6280\u5de7\uff0c\u6bd5\u7adf\u4e0d\u662f\u6b63\u89e3\u3002\n\u4e0d\u8fc7\u8fd9\u9898\u8fd9\u6837\u7684\u601d\u7ef4\u662f\u771f\u5fc3\u4e0d\u9519\uff01\uff01",
        "postTime": 1608033592,
        "uid": 292315,
        "name": "ZCETHAN",
        "ccfLevel": 7,
        "title": "2020NOIP-B-\u5b57\u7b26\u4e32\u5339\u914d"
    },
    {
        "content": "~~2020 \u5e74 12 \u6708 5 \u65e5\u2026\u2026\u5b66\u4e60\u5b57\u7b26\u4e32\u2026\u202630min\u2026\u2026\u6298\u621f\u6c89\u6c99\u2026\u2026\u4ee5\u524d\u7684\u6211\uff01\uff08\u5927\u96fe\uff09~~\r\n\r\n\u6628\u5929\u8eba\u5e8a\u4e0a\u65e0\u804a\u60f3\u51fa\u6765\u8fd9\u9898\u7684\u4e00\u4e2a\u5de8\u5927\u626d\u66f2\u505a\u6cd5\uff0c\u4e22\u4e0a\u6765\u5206\u4eab\u4e00\u4e0b\u3002\r\n\r\n------------\r\n\u9996\u5148\u5982\u679c\u4f60\u8003\u8651\u679a\u4e3e $C$ \u90a3\u4f60\u4e00\u5f00\u59cb\u5c31\u8d70\u504f\u4e86\uff0c\u6211\u4eec\u679a\u4e3e $AB$\u2026\u2026\u8bf6\u6211\u504f\u4e0d\uff0c\u54b1\u5c31\u679a\u4e3e $C$ \u8bd5\u4e00\u4e0b\uff1f\r\n\r\n\u679a\u4e3e $C$ \u5c31\u76f8\u5f53\u4e8e\u679a\u4e3e\u4e86 $(AB)^k$\uff0c\u53ef\u80fd\u7684 $AB$ \u90fd\u662f\u8fd9\u4e2a\u4e32\u7684\u6574\u5faa\u73af\u8282\u3002\u6839\u636e border \u7406\u8bba\u90a3\u4e00\u5957\uff08\u8fd9\u91cc\u5c31\u4e0d\u7ed9\u8bc1\u660e\u4e86\uff09\uff0c$m$ \u662f border \u4ee3\u8868 $n-m$ \u662f\u5468\u671f\uff0c\u800c\u4e00\u4e2a\u6574\u5faa\u73af\u4e32\u7684\u6700\u5c0f\u5468\u671f\u5fc5\u7136\u662f\u6700\u5c0f\u6574\u5468\u671f\u3002\u90a3\u4e48\u53ef\u4ee5 kmp \u6c42\u51fa\u6bcf\u4e2a\u524d\u7f00\u7684\u6700\u5c0f\u6574\u5468\u671f\u3002\u53c8\u6709\u5f31\u5468\u671f\u5b9a\u7406\uff08WPL\uff09\uff0c\u82e5 $a$ \u548c $b$ \u90fd\u662f\u5468\u671f\u4e14 $a+b\\le n$ \u5219 $\\gcd(a,b)$ \u662f\u5468\u671f\u3002\u90a3\u4e48\u53ef\u4ee5\u63a8\u77e5\u6240\u6709\u5468\u671f\u90fd\u662f\u8fd9\u4e2a\u6700\u5c0f\u5468\u671f\u7684\u500d\u6570\uff0c\u5426\u5219\u5bfc\u51fa\u66f4\u5c0f\u7684\u5468\u671f\u3002\r\n\r\n\u90a3\u4e48\u8bbe\u6700\u5c0f\u5faa\u73af\u8282\u957f\u5ea6\u4e3a $x$\uff0c\u8003\u8651\u82e5\u6709\u4e00\u4e2a\u5408\u6cd5\u7684 $A$\uff0c$x(i-1)\\le|A|<xi$\uff0c\u90a3\u4e48\u5408\u6cd5\u7684 $AB$ \u4e2a\u6570\u5373\u4e3a $k$ \u7684\u500d\u6570\u4e2d\u4e0d\u5c0f\u4e8e $i$ \u7684\u4e2a\u6570\u3002\u800c\u53d1\u73b0\u5bf9\u4e8e\u4e00\u4e2a $i$\uff0c\u8fd9\u6837\u5408\u6cd5\u7684 $A$ \u7684\u4e2a\u6570\u53ea\u4e0e $i$ \u7684\u5947\u5076\u6027\u6709\u5173\uff0c\u90a3\u4e48\u53ef\u4ee5\u5bf9 $i$ \u7684\u4e24\u79cd\u5947\u5076\u6027\u5206\u522b\u6811\u72b6\u6570\u7ec4 $O(n\\log|\\Sigma|)$ \u7b97\u51fa\u8fd9\u6837\u5408\u6cd5\u7684 $A$ \u7684\u4e2a\u6570\uff0c\u4e25\u683c $O(n)$ \u4e5f\u662f\u53ef\u4ee5\u7684\u5176\u4ed6\u9898\u89e3\u8bf4\u8fc7\u8fd9\u4e2a\u4e8b\u60c5\u6211\u5c31\u4e0d\u8ba8\u8bba\u4e86\u3002\r\n\r\n\u90a3\u4e48\u8003\u8651\u5bf9\u4e24\u79cd $i$ \u7684\u5947\u5076\u6027\u5206\u522b\u8ba1\u7b97\u6240\u6709 $A$ \u5bf9\u5e94\u7684\u5408\u6cd5 $AB$ \u7684\u603b\u4e2a\u6570\u3002\u8003\u8651 $k$ \u7684\u6bcf\u4e2a\u56e0\u6570 $d$\uff0c\u82e5 $d$ \u662f\u5076\u6570\u5219 $d$ \u88ab\u8ba1\u7b97\u4e86 $\\dfrac12d$ \u6b21\uff0c\u5426\u5219\u82e5 $i$ \u662f\u5947\u6570\u5219\u662f $\\dfrac12d+\\dfrac12$\uff0c\u82e5 $i$ \u662f\u5076\u6570\u5219\u662f $\\dfrac12d-\\dfrac12$ \u6b21\u3002\u90a3\u4e48\u53d1\u73b0\u6211\u4eec\u53ea\u9700\u8981\u8ba1\u7b97\u6bcf\u4e2a\u6570\u7684\u7ea6\u6570\u4e2a\u6570\uff0c\u7ea6\u6570\u548c\uff0c\u5947\u7ea6\u6570\u4e2a\u6570\u3002\u524d\u4e24\u8005\u5bb9\u6613\u7ebf\u6027\u7b5b\uff0c\u540e\u8005\u5176\u5b9e\u5c31\u662f $d(n)-[2|n]d(\\dfrac12n)$\uff0c$d$ \u8fd9\u91cc\u4ee3\u8868\u7ea6\u6570\u4e2a\u6570\u51fd\u6570\u3002\r\n\r\n\u6700\u540e\u5728 $1$ \u662f\u5947\u6570\u4e14 $|A|=x(i-1)$ \u65f6 $A$ \u662f\u7a7a\u4e32\u9700\u8981\u7279\u5224\u4e00\u4e0b\uff0c\u7279\u5224\u7684\u5f0f\u5b50\u8ddf\u4e0a\u9762\u5dee\u4e0d\u591a\u4e0d\u5199\u51fa\u6765\u4e86\u3002\u7136\u540e\u4f60\u53d1\u73b0\u8fd9\u9898\u5c31\u505a\u5b8c\u4e86\uff0c\u590d\u6742\u5ea6\u8fd8\u662f $O(n\\log|\\Sigma|)$ \u6216\u8005 $O(n)$\u3002\r\n\r\n\u7ebf\u6027\u7b5b\u592a\u6298\u78e8\u4e86\u5199\u4e86\u4e2a\u8c03\u548c\u7ea7\u6570\u7b5b\u65e5\u8fc7\u53bb\u4e86\u2026\u2026\r\n```cpp\r\n#include<bits/stdc++.h>\r\nusing namespace std;\r\ntypedef long long ll;\r\ninline ll readint(){\r\n\tll x=0;\r\n\tbool f=0;\r\n\tchar c=getchar();\r\n\twhile(!isdigit(c)&&c!='-') c=getchar();\r\n\tif(c=='-'){\r\n\t\tf=1;\r\n\t\tc=getchar();\r\n\t}\r\n\twhile(isdigit(c)){\r\n\t\tx=x*10+c-'0';\r\n\t\tc=getchar();\r\n\t}\r\n\treturn f?-x:x;\r\n}\r\nconst int maxn=(1<<20)+5;\r\nint d0[maxn],dd[maxn];\r\nll d1[maxn];\r\nint n;\r\nchar s[maxn];\r\nint nxt[maxn];\r\nint cnt[26];\r\nstruct qr{\r\n\tint x;\r\n\tll k;\r\n};\r\nvector<qr> q[maxn];\r\ninline int lowbit(int x){\r\n\treturn x&-x;\r\n}\r\nint c[27];\r\nvoid modify(int x,int k){\r\n\twhile(x<=26){\r\n\t\tc[x]+=k;\r\n\t\tx+=lowbit(x);\r\n\t}\r\n}\r\nint query(int x){\r\n\tint s=0;\r\n\twhile(x){\r\n\t\ts+=c[x];\r\n\t\tx-=lowbit(x);\r\n\t}\r\n\treturn s;\r\n}\r\nint main(){\r\n\t#ifdef LOCAL\r\n\tfreopen(\"in.txt\",\"r\",stdin);\r\n\tfreopen(\"out.txt\",\"w\",stdout);\r\n\t#endif\r\n\tfor(int i=1;i<maxn;i++) for(int j=1;i*j<maxn;j++){\r\n\t\td0[i*j]++;\r\n\t\td1[i*j]+=i;\r\n\t}\r\n\tfor(int i=1;i<maxn;i++) dd[i]=d0[i]-(i%2==0?d0[i/2]:0);\r\n\tint T=readint();\r\n\twhile(T--){\r\n\t\tscanf(\"%s\",s+1);\r\n\t\tn=strlen(s+1);\r\n\t\tint u=0;\r\n\t\tfor(int i=2;i<=n;i++){\r\n\t\t\twhile(u&&s[u+1]!=s[i]) u=nxt[u];\r\n\t\t\tif(s[u+1]==s[i]) u++;\r\n\t\t\tnxt[i]=u;\r\n\t\t}\r\n\t\tint cnt2=0;\r\n\t\tfor(int i=1;i<=n;i++) vector<qr>().swap(q[i]);\r\n\t\tll ans=0;\r\n\t\tmemset(cnt,0,sizeof(cnt));\r\n\t\tfor(int i=n-1;i>0;i--){\r\n\t\t\tcnt[s[i+1]-'a']++;\r\n\t\t\tcnt2+=cnt[s[i+1]-'a']%2==1?1:-1;\r\n\t\t\tint x=i%(i-nxt[i])==0?i-nxt[i]:i;\r\n\t\t\tq[x-1].push_back({cnt2,(d1[i/x]+dd[i/x])/2});\r\n\t\t\tif(x!=i){\r\n\t\t\t\tq[x-1].push_back({cnt2,(dd[i/x]-d1[i/x])/2});\r\n\t\t\t\tq[x*2-1].push_back({cnt2,(d1[i/x]-dd[i/x])/2});\r\n\t\t\t\tans+=(d1[i/x]-dd[i/x])/2-d0[i/x]+dd[i/x];\r\n\t\t\t}\r\n\t\t}\r\n\t\tmemset(cnt,0,sizeof(cnt));\r\n\t\tmemset(c,0,sizeof(c));\r\n\t\tcnt2=0;\r\n\t\tfor(int i=1;i<n;i++){\r\n\t\t\tcnt[s[i]-'a']++;\r\n\t\t\tcnt2+=cnt[s[i]-'a']%2==1?1:-1;\r\n\t\t\tmodify(cnt2+1,1);\r\n\t\t\tfor(qr x:q[i]) ans+=1ll*query(x.x+1)*x.k;\r\n\t\t}\r\n\t\tprintf(\"%lld\\n\",ans);\r\n\t}\r\n\t#ifdef LOCAL\r\n\tfprintf(stderr,\"%d\\n\",(int)clock());\r\n\t#endif\r\n\treturn 0;\r\n}\r\n```\r\n\u6211\u611f\u89c9\u8fd9\u4e2a\u505a\u6cd5\u5de8\u5927\u626d\u66f2\uff0c\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u6df7\u8fdb\u6765\u4e00\u70b9\u6570\u8bba\u5185\u5bb9\u3002\u76f4\u89c9\u4e0a\u6574\u5faa\u73af\u6b21\u6570\u7684\u7ea6\u6570\u5e94\u8be5\u6709\u66f4\u4f18\u7f8e\u7684\u6027\u8d28\uff0c\u6709\u6ca1\u6709\u597d\u4e00\u70b9\u7684\u505a\u6cd5\u628a\u8fd9\u73a9\u610f\u53bb\u6389\u554a\u3002\r\n\r\n~~\u6709 \u6ca1 \u6709 \u8001 \u54e5 \u6559 \u6559 \u6211 \u554a~~\r\n\r\n~~\u611f\u89c9\u662f\u7b2c\u4e00\u4e07\u6b21\u8bf4\u8fd9\u53e5\u8bdd\u4e86\uff0c\u848b\u961f\u8fd9\u6837\u771f\u6b63\u7684\u5f3a\u8005\u90fd\u662f\u81ea\u5df1\u641e\u6e05\u695a\u4e24\u4e2a\u725b\u903c\u505a\u6cd5\u7684\u8054\u7cfb\u7684\u3002~~",
        "postTime": 1632405144,
        "uid": 174045,
        "name": "FZzzz",
        "ccfLevel": 0,
        "title": "LG7114 \u626d\u66f2\u505a\u6cd5"
    },
    {
        "content": "UPD : \u8865\u5145\u4e00\u4efd\u8003\u573a\u4ee3\u7801\n### Description.\n\u7ed9\u5b9a $S$ \u6c42 $S=(A+B)^i+C$ \u4e14 $F(A)\\le F(C)$ \u7684\u65b9\u6848\u6570\u3002  \n$F(s)$ \u8868\u793a $s$ \u4e2d\u51fa\u73b0\u6b21\u6570\u4e3a\u5947\u6570\u7684\u5b57\u7b26\u6570\u91cf\u3002  \n\n### Solution1\uff0884pts\uff1f\n\u66b4\u529b\u679a\u4e3e $C$ \u7684\u957f\u5ea6\uff0c\u7136\u540e\u6211\u4eec\u8bbe $X=A+B$\uff0c\u6211\u4eec\u9700\u8981\u6c42\u51fa $X^i+C=S$ \u7684\u65b9\u6848\u6570\u3002  \n\u4e5f\u5c31\u662f\u627e\u51fa\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u6700\u5c0f\u5faa\u73af\u8282\u3002  \n\u8fd9\u662f\u7ecf\u5178\u95ee\u9898\uff0c\u76f4\u63a5 Hash + \u679a\u4e3e\u56e0\u6570\u5c31\u597d\u4e86\uff0c\u5177\u4f53\u53ef\u4ee5\u770b[\u8fd9\u91cc](https://www.luogu.com.cn/blog/daniu/solution-p3538)  \n\u7136\u540e\u6211\u4eec\u9700\u8981\u6c42\u51fa\u628a $X$ \u62c6\u5206\u6210\u4e00\u4e2a $A+B$ \u3002  \n\u56e0\u4e3a $A$ \u80af\u5b9a\u662f\u4e00\u4e2a $S$ \u7684\u524d\u7f00\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u9884\u5904\u7406\u51fa $F_{i,j}$  \n\uff08\u8bbe $F_{i,j}$ \u8868\u793a $1$ \u5230 $i$ \u4e2d\u7684\u6240\u6709\u524d\u7f00\u51fa\u73b0\u6b21\u6570\u4e3a\u5947\u6570\u7684\u5b57\u7b26\u6570\u91cf\uff0c\u8fd9\u4e2a\u4e1c\u897f\u663e\u7136\u53ef\u4ee5\u4e8c\u7ef4\u524d\u7f00\u548c\uff0c\u590d\u6742\u5ea6 $O(26\\times N)$  \n\u4e0a\u9762\u7684\u6700\u5c0f\u5faa\u73af\u8282\u662f $O(N\\log N)$ \u7684\uff0c\u800c\u6211\u4eec\u53c8\u9700\u8981\u5bf9\u4e8e\u6bcf\u4e2a $C$ \u679a\u4e3e $i$\u3002  \n\u800c\u6b64\u65f6 $i$ \u5fc5\u987b\u6ee1\u8db3 $mxlen_X\\ |\\ i\\ |\\ len_X$ \uff08 $mxlen_X$ \u8868\u793a\u5b57\u7b26\u4e32 $X$ \u7684\u6700\u5c0f\u5faa\u73af\u8282\u3002  \n\u6240\u4ee5\u6211\u4eec\u6700\u7ec8\u590d\u6742\u5ea6\u662f $\\sum_{i=1}^{N}\\sum_{j|i}1$ \u7684\u3002  \n\u8fd9\u4e2a\u4e1c\u897f\u5e94\u8be5\u662f $O(N\\log N)$ \u7684\u3002  \n\u603b\u590d\u6742\u5ea6 $O(N\\times (\\log N+26))$ \u7684\u3002  \n\u5982\u679c\u5199\u68f5\u6811\u72b6\u6570\u7ec4\u7684\u8bdd\u5e94\u8be5\u53ef\u4ee5 $O(N\\log N\\log 26)$  \n~~\u8bdd\u8bf4\u6211\u5728\u8003\u573a\u4e0a\u751a\u81f3\u5fd8\u4e86\u8fd9\u4e2a\u600e\u4e48\u7b97\uff0c\u76f4\u63a5\u6253\u4e86\u4e2a\u5927\u7206\u641c\u53d1\u73b0\u662f 1e7 \u5de6\u53f3~~  \n\u8d34\u4e00\u4e2a\u8003\u573a 84 \u5206\u4ee3\u7801\u3002  \n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntemplate<typename T>inline void read(T &x)\n{\n\tx=0;char c=getchar(),f=0;\n\tfor(;c<48||c>57;c=getchar()) if(!(c^45)) f=1;\n\tfor(;c>=48&&c<=57;c=getchar()) x=(x<<1)+(x<<3)+(c^48);\n\tf?x=-x:0;\n}\nconst int N=1048585;\nstruct Hash\n{\n\ttypedef unsigned long long ull;ull has1,has2;\n\tinline bool operator==(Hash b) const {return has1==b.has1&&has2==b.has2;}\n\tinline Hash operator+(Hash b) const {return(Hash){has1+b.has1,has2+b.has2};}\n\tinline Hash operator-(Hash b) const {return(Hash){has1-b.has1,has2-b.has2};}\n\tinline Hash operator*(Hash b) const {return(Hash){has1*b.has1,has2*b.has2};}\n\tinline Hash operator*(ull x) const {return(Hash){has1*x,has2*x};}\n\tinline Hash operator+(ull x) const {return(Hash){has1+x,has2+x};}\n}B={149ull,1145141ull},has[N],bas[N];int qwq[1005],qaq[1005],qwqt=0;\nint Q,n,pc,p[N],ls[N],st[N],tp,f[N][26];char v[N],a[N];\ninline void AllInit()\n{\n\tv[0]=v[1]=1,ls[1]=1;\n\tfor(int i=2;i<N;i++)\n\t{\n\t\tif(!v[i]) p[++pc]=i,ls[i]=i;\n\t\tfor(int j=1;j<=pc&&p[j]*i<N;j++) {v[i*p[j]]=1,ls[i*p[j]]=p[j];if(i%p[j]==0) break;}\n\t}\n}\ninline Hash geths(int l,int r) {return has[r]-bas[r-l+1]*has[l-1];}\ninline int getmn(int l,int r)//\u6700\u5c0f\u5faa\u73af\u8282\n{\n\tint len=r-l+1;tp=0;\n\twhile(len!=1) st[++tp]=ls[len],len/=ls[len];\n\tlen=r-l+1;for(int i=1;i<=tp;i++)\n\t{\n\t\tint nxt=len/st[i];\n\t\tif(geths(l,r-nxt)==geths(l+nxt,r)) len=nxt;\n\t}\n\treturn len;\n}\ninline void InitHash()\n{\n\tbas[0]=(Hash){1ull,1ull},has[0]=(Hash){0ull,0ull};\n\tfor(int i=1;i<=n;i++) bas[i]=bas[i-1]*B,has[i]=has[i-1]*B+a[i];\n}\ninline void InitF()\n{\n\tint now=0,bit=0;memset(f,0,sizeof(f));\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tif(bit&(1<<(a[i]-'a'))) now--;else now++;\n\t\tbit^=(1<<(a[i]-'a')),f[i][now]=1;\n\t}\n\tfor(int i=1,j=0;i<=n;i++) f[i][j]+=f[i-1][j];\n\tfor(int i=1;i<=n;i++) for(int j=1;j<26;j++) f[i][j]+=f[i-1][j]+f[i][j-1]-f[i-1][j-1];\n}\ninline void ChaiFen(int now,int ggg,long long &x,int hzlim,int tims)\n{\n\tif(now==qwqt+1) return(void)(x+=f[tims*ggg-1][hzlim]);//,printf(\"F %d %d\\n\",tims*ggg-1,hzlim)\n\tfor(int i=0;i<=qaq[now];i++) ChaiFen(now+1,ggg,x,hzlim,tims),ggg*=qwq[now];\n}\ninline void solve()\n{\n\tscanf(\"%s\",a+1),n=strlen(a+1),InitHash(),InitF();\n\tint bit=0,now=0;long long res=0;\n\tfor(int i=n;i>2;i--)\n\t{\n\t\tif(bit&(1<<(a[i]-'a'))) now--;else now++;\n\t\tbit^=(1<<(a[i]-'a'));int nown=i-1,nowlen=getmn(1,nown);\n\t\ttp=0;int bf=nown/nowlen;\n\t\twhile(bf!=1) st[++tp]=ls[bf],bf/=ls[bf];\n\t\tsort(st+1,st+tp+1),qwqt=0;\n\t\tfor(int j=1;j<=tp;j++) if(st[j]!=st[j-1]) qwq[++qwqt]=st[j],qaq[qwqt]=1;else qaq[qwqt]++;\n//\t\tfor(int j=1;j<=qwqt;j++) printf(\"<%d,%d>%c\",qwq[j],qaq[j],j==qwqt?'\\n':' ');\n\t\tChaiFen(1,1,res,now,nowlen);\n//\t\tprintf(\"%d : %lld\\n\",i,res);\n\t}\n\tprintf(\"%lld\\n\",res);\n}\nint main()\n{\n\tfreopen(\"string.in\",\"r\",stdin);\n\tfreopen(\"string.out\",\"w\",stdout);\n\tAllInit();\n\tfor(read(Q);Q--;) solve();\n\tfclose(stdin);\n\tfclose(stdout);\n\treturn 0;\n}\n```\n### Solution2\uff0884pts\uff1f\n\u9996\u5148\uff0c\u8fd9\u4e2a\u51fa\u73b0\u6b21\u6570\u4e3a\u5947\u6570\u8fd9\u4e2a\u6761\u4ef6\u5f88\u70e6\u4eba\uff0c\u6240\u4ee5\u6211\u4eec\u89c2\u5bdf\u4e00\u4e0b\u5b83\u6709\u6ca1\u6709\u7279\u6b8a\u6027\u8d28\u3002  \n\u9996\u5148\uff0c\u6211\u4eec\u601d\u8003\u4e00\u4e0b\uff0c\u4e00\u4e2a\u4e32 $XX$ \u5b83\u4e0d\u4f1a\u5f71\u54cd\u51fa\u73b0\u6b21\u6570\u4e3a\u5947\u6570\u7684\u4e2a\u6570\u3002  \n\u6240\u4ee5\uff0c\u6211\u4eec\u53d1\u73b0 $XXXC=S$ \u548c $XC=S$ \u7684\u628a $X$ \u62c6\u5206\u6210 $A+B$ \u7684\u65b9\u6848\u6570\u662f\u4e00\u6837\u5462\u7684\u3002  \n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5947\u5076\u5206\u5f00\u8ba8\u8bba\uff0c\u628a\u4e0a\u9762\u7684\u90a3\u4e2a $\\times log26$ \u6216 $+26$ \u53bb\u6389\u4e86\u3002  \n\u590d\u6742\u5ea6 $O(N\\ln N)$\n### Solution3\uff08100pts\uff1f\n\u9e23\u8c22\u795e\u4ed9 $\\color{black}\\text{h}\\color{red}\\text{ehezhou}$\u3002  \n\u9996\u5148\u6211\u4eec\u66b4\u529b\u679a\u4e3e $X$ \u7684\u957f\u5ea6 \uff08$X=A+B$  \n\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u957f\u5ea6\uff0c\u6211\u4eec\u4e8c\u5206\u5b83 $i$ \u80fd\u53d6\u5230\u7684\u6700\u5927\u503c\u3002  \n\u56e0\u4e3a\u957f\u5ea6\u8d8a\u957f\u8fd9\u4e2a\u5b57\u7b26\u4e32\u8d8a\u4e0d\u53ef\u80fd\u5faa\u73af\uff0c\u6240\u4ee5\u5177\u6709\u5355\u8c03\u6027\u3002  \n\u4e0a\u9762\u7684\u4e1c\u897f\u662f $\\sum_{i=1}^{N}\\log\\left(\\frac{N}{i}\\right)$ \u7684\u3002  \n\u636e\u795e\u4ed9 $\\color{black}\\text{h}\\color{red}\\text{ehezhou}$ \u8bf4\u662f $O(N)$ \u7684\u3002  \n\u6211\u4eec\u83b7\u5f97\u4e86\u6bcf\u4e2a $X$ \u6240\u80fd\u53d6\u5230\u7684\u6700\u5927 $i$ \u7684\u957f\u5ea6\u3002  \n\u540c\u65f6\uff0c\u5f53 $X$ \u56fa\u5b9a\u65f6\uff0c\u5f53 $i\\in\\{1,3,5...\\}$ \u6216 $i\\in\\{2,4,6...\\}$ \u65f6\uff0c\u628a $X$ \u62c6\u6210 $A$ \u548c $B$ \u7684\u65b9\u6848\u6570\u662f\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5 $O(1)$ \u7edf\u8ba1\u8d21\u732e\u3002  \n\u7136\u540e\u679a\u4e3e $X$\uff0c\u5728 $X$ \u6539\u53d8\u65f6\u53ea\u9700\u8981\u8ba1\u7b97\u589e\u52a0\u7684\u90a3\u4e2a $X$ \u7684\u8d21\u732e\u5c31\u597d\u4e86\u3002  \n\u590d\u6742\u5ea6\u5747\u644a $O(N\\log 26)$\u3002  \n***\n**upd:**\n\u611f\u8c22 \u795e\u4ed9 $\\color{black}\\text{h}\\color{red}\\text{ehezhou}$ \u6307\u51fa\uff0c\u5728\u7edf\u8ba1 $X$ \u65f6\u5fc5\u987b\u8981 $\\log26$\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u8fd8\u662f $O(N\\log 26)$ \u7684\uff0c\u5df2\u6539\u6b63\u3002  \n**upd:**\n\u8279\uff0c\u795e\u4ed9 $\\color{black}\\text{h}\\color{red}\\text{ehezhou}$ \u8981\u52a0\u5f3a T2 \u548c T4\uff0c\u628a T2 \u5b57\u7b26\u96c6\u5f00\u6210 $O(n)$\uff0cT4 \u7528\u590d\u6742\u5ea6\u4e3a $nk\\log^2$ \u7684\u591a\u9879\u5f0f\u3002  \n\n\n\u5b8c\u7ed3\u6492\u82b1\uff0c\u53cd\u6b63\u7b14\u8005\u53ea\u4f1a solution1\uff0c\u8fd8\u4e0d\u77e5\u9053\u6709\u6ca1\u6709\u6253\u6302",
        "postTime": 1607175965,
        "uid": 44805,
        "name": "Leap_Frog",
        "ccfLevel": 7,
        "title": "P7114 \u5b57\u7b26\u4e32\u5339\u914d\uff08\u9898\u89e3\uff09"
    },
    {
        "content": "### \u8865\u5145\u4e00\u7bc7\u975e\u5e38\u83dc\u7684\u66b4\u529b\uff0c~~\u4ee5\u81f3\u4e8e\u5f00$O_{2}$\u624d\u80fd\u8fc7~~\u3002\n\n### \u9996\u5148\u8003\u8651$O$($n^{3}$)\u7684\u66b4\u529b\u600e\u4e48\u5199\u3002\n\n~~\u663e\u7136~~\uff0c\u53ef\u4ee5\u679a\u4e3e\u5b57\u7b26\u4e32$A$+$B$\u7684\u53f3\u7aef\u70b9\uff0c~~\u5de6\u7aef\u70b9\u663e\u7136\u662f1~~\uff0c\u66b4\u529b\u5224\u65ad\u662f\u5426\u80fd\u4e0e\u540e\u9762\u7684\u5b57\u7b26\u6784\u6210\u5faa\u73af\u8282\uff0c\u5bf9\u4e8e\u6ee1\u8db3\n\n$k*(A+B)+C=$ \u6574\u4e2a\u5b57\u7b26\u4e32$(k \\in Z)$\n\n\u7684\u60c5\u51b5\u66b4\u529b\u679a\u4e3e$A$,$B$\u5206\u754c\u70b9\uff0c\u5bf9\u4e8e$L(x)\\le R(x)$\u7684\u60c5\u51b5\u7edf\u8ba1\u7b54\u6848\u5373\u53ef\uff0c$L(x)$\u4e3a$1$\u5230$n$\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6570\u91cf\uff0c$R(x)$\u4e3a$x$\u5230$n$\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6570\u91cf\u3002\n\n\u5176\u5b9e\u8fd9\u6837\u7531\u4e8e$A+B$\u5f88\u96be\u627e\u5230\u5faa\u73af\u8282\uff0c\u5747\u644a\u4e0b\u6765\u65f6\u95f4\u590d\u6742\u5ea6\u5728\u968f\u673a\u6570\u636e\u4e0b\u8fdc\u5c0f\u4e8e$O(n^{3})$,\u53ef\u4ee5\u62ff\u5230$48pts$\u4e86\uff0c~~\u7f8e\u6ecb\u6ecb~~\u3002\n\n### \u628a\u66b4\u529b\u8d34\u4e0a\u6765\u5427\uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define LL long long \n#define N (1<<20)+50\nusing namespace std;\n\nLL ans;\nint t,len;\nchar a[N];\nint toa[30],toc[30],jia[N],jic[N];\n\ninline int qr()\n{\n\tchar a=0;int x=0,w=1;\n\twhile(a<'0'||a>'9'){if(a=='-')w=-1;a=getchar();}\n\twhile(a<='9'&&a>='0'){x=(x<<3)+(x<<1)+(a^48);a=getchar();}\n\treturn x*w;\n}\n\nint main()\n{\n\tt=qr();\n\twhile(t--)\n\t{\n\t\tscanf(\"%s\",(a+1));\n\t\tlen=strlen(a+1);\n\t\tmemset(toa,0,sizeof(toa));\n\t\tmemset(toc,0,sizeof(toc));\n\t\tmemset(jic,0,sizeof(jic));\n\t\tmemset(jia,0,sizeof(jia));\n\t\tans=0;\n\t\tfor(register int i=1;i<=len;i++)//\u8ba1\u7b97L(i)\n\t\t{\n\t\t\ttoa[a[i]-'a']++;\n\t\t\ttoa[a[i]-'a']&1 ? jia[i]=jia[i-1]+1 :jia[i]=jia[i-1]-1;\n\t\t}\n\t\tfor(register int i=len;i>=1;i--)//\u8ba1\u7b97R(i)\n\t\t{\n\t\t\ttoc[a[i]-'a']++;\n\t\t\ttoc[a[i]-'a']&1 ? jic[i]=jic[i+1]+1 :jic[i]=jic[i+1]-1;\n\t\t}\n\t\tfor(register int i=2;i<len;i++)\n\t\t{\n\t\t\tint flag=1;\n\t\t\tfor(register int k=1;k<i;k++)//\u7279\u5224k=1\u7684\u60c5\u51b5\n\t\t\t\tif(jia[k]<=jic[i+1])\n\t\t\t\t\tans++;\n\t\t\tfor(register int j=2;j*i<len;j++)//\u679a\u4e3e\u5faa\u73af\u6b21\u6570\n\t\t\t{\n\t\t\t\tint le=(j-1)*i+1;\n\t\t\t\tint re=j*i;\n\t\t\t\tfor(register int k=le;k<=re;k++)//\u5224\u65ad\u5faa\u73af\u8282\n\t\t\t\t\tif(a[k]!=a[k-i])\n\t\t\t\t\t{\n\t\t\t\t\t\tflag=0;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\tif(flag)//\u5faa\u73af\u6210\u7acb\u679a\u4e3eA,B\u5206\u754c\u70b9\u7edf\u8ba1\u6b21\u6570\n\t\t\t\t{\n\t\t\t\t\tfor(register int k=1;k<i;k++)\n\t\t\t\t\t\tif(jia[k]<=jic[re+1])\n\t\t\t\t\t\t\tans++;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;//\u5faa\u73af\u4e0d\u6210\u7acb\u9000\u51fa\n\t\t\t}\n\t\t}\n\t\tprintf(\"%lld\\n\",ans);\n\t\tcontinue;\n\t}\n\treturn 0;\n}\n```\n\n\n\u4e0b\u9762\u8003\u8651\u4f18\u5316\u65f6\u95f4\u590d\u6742\u5ea6\u3002\n\n### \u524d\u7f6e\u77e5\u8bc6\n\n- \u5b57\u7b26\u4e32hash\n\n~~\u6ca1\u4e86~~\n\n#### \u6211\u4eec\u53ef\u4ee5\u60f3\u5230\uff0c\u65f6\u95f4\u4e3b\u8981\u6d6a\u8d39\u5728\u4ee5\u4e0b\u4e24\u70b9\uff1a\n\n- \u5728\u67e5\u627e\u5faa\u73af\u8282\u65f6\u66b4\u529b\u5339\u914d\u663e\u7136\u4e0d\u662f\u4e00\u4e2a\u660e\u667a\u4e4b\u4e3e\n- \u67e5\u627e$A$,$B$\u5206\u754c\u65f6\u5355\u4e00\u64cd\u4f5c\u91cd\u590d\u591a\u6b21\u3002\n\n### \u90a3\u4e48\u8003\u8651\u4f18\u5316\uff1a\n\n~~\u663e\u7136~~,\u4e00\u4e2a\u5b57\u7b26\u4e32\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u6570\u91cf$\\le$ $26$ ~~\u5e9f\u8bdd~~\uff0c\u90a3\u4e48\u53ef\u4ee5\n\u7ef4\u62a4\u4e00\u4e2a\u7c7b\u4f3c\u524d\u7f00\u548c\u7684\u4e1c\u897f$R$($i$,$j$)\u8868\u793a\u4ece$1-i$\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u6570\u91cf\u6ee1\u8db3$\\le$ $j$\u7684\u4f4d\u7f6e\uff0c\u7528$L$($i$)\u8868\u793a\u4ece$i-n$\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u6570\u91cf\u3002\n\n\u4e8e\u662f\uff0c\u5bf9\u53ef\u6210\u7acb\u7684A+B\u5b57\u7b26\u4e32\u5224\u65ad\u590d\u6742\u5ea6\u53d8\u6210\u4e86\u9884\u5904\u7406$O$($27n$),\u67e5\u8be2$O$($1$)\u3002\n\n\u5176\u6b21\uff0c\u53ef\u4ee5\u7528\u5b57\u7b26\u4e32\u54c8\u5e0c\u6216KMP\u5224\u5faa\u73af\u8282\uff0c\u5c06\u5224\u5faa\u73af\u8282\u590d\u6742\u5ea6\u4f18\u5316\u4e3a\u8c03\u548c\u7ea7\u6570\u7ea7\u5373$O$($n$ $\\ln$ $n$)\u3002\n\u52a0\u4e0a\u8fd9\u4e24\u4e2a\u4f18\u5316\u540e\u590d\u6742\u5ea6\u5927\u6982\u5728$O( T(27n+n \\ln n) )$\u3002\n\n\n### ~~\u559c\u95fb\u4e50\u89c1\u7684~~ $Code$ \uff1a\n\n```cpp\n#include<bits/stdc++.h>\n#define LL long long \n#define ULL unsigned long long\n#define N (1<<20)+50\nusing namespace std;\n\nLL ans;\nint t,len;\nchar a[N];\nint sm[27],sum[N];//\u5206\u522b\u5bf9\u5e94\u9898\u89e3\u4e2d\u7684L(i,j),R(i)\nULL Hash[N],jc[N],p=13331;//hash\u91c7\u53d6p\u8fdb\u5236\uff0c\u4e0d\u8fc7\u6700\u597d\u7528\u53cc\u6a21\u6570\n//\u56e0\u4e3a\u6211\u592a\u61d2\u4e86\uff0c\u7528\u4e86\u5355\u6a21\u6570\u54c8\u5e0cQAQ\ninline int qr()//\u5e73\u5e73\u65e0\u5947\u7684\u5feb\u8bfb\n{\n\tchar a=0;int x=0,w=1;\n\twhile(a<'0'||a>'9'){if(a=='-')w=-1;a=getchar();}\n\twhile(a<='9'&&a>='0'){x=(x<<3)+(x<<1)+(a^48);a=getchar();}\n\treturn x*w;\n}\n\ninline bool check(int l,int r,int L,int R)//\u5b57\u7b26\u4e32\u54c8\u5e0c\u5224\u65ad\u76f8\u7b49\n{\n\tULL hash1=(Hash[r]-Hash[l-1]*jc[r-l+1]);\n\tULL hash2=(Hash[R]-Hash[L-1]*jc[R-L+1]);\n\tif(hash1==hash2)\n\t\treturn 1;\n\treturn 0;\n}\n\nint main()\n{\n\tt=qr();\n\tjc[0]=1;\n\tfor(register int i=1;i<=(1<<20)+5;i++)\n\t\tjc[i]=jc[i-1]*p;//\u5904\u7406p^i\n\twhile(t--)\n\t{\n\t\tscanf(\"%s\",(a+1));\n\t\tlen=strlen(a+1);\n\t\tans=0;\n\t\tint opk[27]={},val=0;\n\t\tfor(register int i=1;i<=len;i++)\n\t\t\tHash[i]=(Hash[i-1]*p+a[i]);//\u8ba1\u7b97hash\u503c\n\t\tval=0;\n\t\tfor(register int i=len;i>=1;i--)//\u9884\u5904\u7406L(i,j)\n\t\t{\n\t\t\topk[(int)(a[i]-'a')+1]++;\n\t\t\topk[(int)(a[i]-'a')+1]&1?val++:val--;\n\t\t\tsum[i]=val;\n\t\t}//\u6ca1\u5565\u53ef\u8bf4\u7684\n\t\tval=0;\n\t\tmemset(sm,0,sizeof(sm));\n\t\tmemset(opk,0,sizeof(opk));\n\t\tfor(register int i=2;i<len;i++)\n\t\t{\n\t\t\topk[(int)(a[i-1]-'a')+1]++;\n\t\t\topk[(int)(a[i-1]-'a')+1]&1?val++:val--;\n\t\t\tfor(register int j=val;j<=26;j++)\n\t\t\t\tsm[j]++;//\u6c42R(i,j)\n\t\t\tfor(register int j=1;j*i<len;j++)//\u5f00\u59cb\u5224\u5faa\u73af\u8282\n\t\t\t{\n\t\t\t\tint re=j*i+1;\n\t\t\t\tif(check(1,i,i*(j-1)+1,j*i))//\u5982\u679c\u5faa\u73af\u8282\u6210\u7acb\n\t\t\t\t\tans+=sm[sum[re]];//\u7edf\u8ba1\u7b54\u6848\n\t\t\t\telse\n\t\t\t\t\tbreak;//\u4e0d\u6210\u7acb\u76f4\u63a5\u9000\u51fa\u5373\u53ef\n\t\t\t}\n\t\t}\n\t\t\t\n\t\tprintf(\"%lld\\n\",ans);\n\t\tcontinue;\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1608796577,
        "uid": 242234,
        "name": "\u4e58\u6e58\u53bb",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 P7114 \u3010\u5b57\u7b26\u4e32\u5339\u914d\u3011"
    },
    {
        "content": "\u95f2\u8bdd\uff1a\u8003\u573a\u4e0a\u60f3\u5230\u4e86 $\\texttt{100pts}$ \u7684\u601d\u8def\uff0c\u7136\u540e\u81ea\u5df1\u60f3\u591a\u4e86\u52a0\u4e86\u4e2a\u4e0d\u5fc5\u8981\u7684\u4f18\u5316\u7136\u540e WA \u5230\u6837\u4f8b\u8fc7\u4e0d\u4e86\u65e0\u5948\u6539\u66b4\u529b\u3002\uff08\u5728T2\u4e0a\u7528\u4e86\u6b63\u89e3\u7684\u65f6\u95f4\uff0c\u5f97\u5230\u4e86\u66b4\u529b<\u53ef\u80fd\u90fd\u6ca1\u6709>\u7684\u5206\u6570\uff09 \n\n---\n\n#### \u9898\u610f\n\n$~~~~$ ~~\u6211\u89c9\u5f97\u5df2\u7ecf\u5f88\u6e05\u6670\u4e86\uff0c\u800c\u4e14\u81ea\u5df1\u6982\u62ec\u4e0d\u51fa\u6765~~\n\n---\n\n#### \u9898\u89e3\n\n$~~~~$\u9996\u5148\uff0c\u6211\u4eec\u679a\u4e3e $AB$ \u7684\u957f\u5ea6\uff0c\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 $\\texttt{Hash}$ \u5728 $\\Theta(\\sum_{i=2}^{len-1} \\dfrac{len}{i})$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5185\u7b97\u51fa\u6bcf\u6b21\u91cd\u590d\u4e86\u591a\u5c11\u6b21\u3002\u800c\u4e14\u8fd9\u4e2a\u4e1c\u897f\u975e\u5e38\u5927\u6982\u7387\u8dd1\u4e0d\u6ee1\u3002\n\n$~~~~$ \u7136\u540e\u6211\u4eec\u5047\u8bbe $AB$ \u91cd\u590d\u4e86 $k$ \u6b21\uff0c\u90a3\u4e48\u53ef\u4ee5\u6709 $0\\backsim(k-1)$ \u6b21 $AB$ \u7684\u91cd\u590d\u653e\u5728\u540e\u9762\u7684 $C$ \u5b57\u7b26\u4e32\u91cc\uff0c\u800c\u4e14\u6211\u4eec\u53d1\u73b0 $AB$ \u91cd\u590d\u5947\u6570\u6b21\u548c\u5076\u6570\u6b21\u5bf9\u4e8e $C$ \u7684\u5947\u6570\u6b21\u51fa\u73b0\u7684\u5b57\u7b26\u6570\u7684\u8d21\u732e\u662f\u76f8\u540c\u7684\uff0c\u800c\u8fd9\u4e2a\u6b21\u6570\u6211\u4eec\u53ef\u4ee5 $\\mathcal{O(n)}$ \u9884\u5904\u7406\u540e\u6bcf\u6b21 $\\mathcal{O(1)}$ \u5f97\u5230\u3002\n\n$~~~~$ \u6700\u540e\u6211\u4eec\u5bf9\u4e8e\u67d0\u4e00\u4e2a\u91cd\u590d\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6570\u91cf\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u7ef4\u62a4 $\\leq$ \u67d0\u4e2a\u51fa\u73b0\u6b21\u6570\u7684 $AB$ \u5212\u5206\u65b9\u6848\uff0c\u90a3\u4e48\u8fd9\u663e\u7136\u662f\u4e00\u4e2a\u52a8\u6001\u524d\u7f00\u548c\uff0c\u7528\u6811\u72b6\u6570\u7ec4\uff0c\u90a3\u4e48\u8fd9\u90e8\u5206\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal{O(\\log 26)}$ \uff0c\u6bcf\u6b21\u52a8\u6001\u66f4\u65b0\u65f6\u7531\u4e8e\u53ea\u591a\u4e86\u4e00\u4e2a\u5b57\u7b26\uff0c\u6240\u4ee5\u4e5f\u53ea\u7528\u66f4\u65b0\u4e00\u4e2a $\\mathcal{O(\\log 26)}$ \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002\n\n$~~~~$ \u4ee5\u4e0b\u662f\u7b14\u8005\u7684\u5e9f\u8bdd\u3002\n\n$~~~~$ \u5230\u8fd9\u91cc\u8fd9\u9053\u9898\u5df2\u7ecf\u505a\u5b8c\u4e86\uff0c\u7136\u540e\u6211\u8003\u573a\u4e0a\u8ba4\u4e3a\u4e0a\u9762\u4e00\u4e2a\u4e00\u4e2a\u8df3\u592a\u4f4e\u6548\u4e86\uff0c\u800c\u4e14\u6570\u636e\u8303\u56f4\u7ed9\u51fa\u7684\u662f $|S|$ \u5728\u67d0\u4e2a $2$ \u7684\u5e42\u4ee5\u5185\uff0c\u4f46\u5374\u6ca1\u6709\u7528\u5230 $\\mathcal{O(\\log n)}$ \uff08~~\u66f4\u4e3b\u8981\u7684\u539f\u56e0\u662f\u6211\u4e0d\u4f1a\u7b97\u7b2c\u4e00\u4e2a\u5f0f\u5b50~~\uff09\u6240\u4ee5\u6211\u60f3\u5230 \u500d\u589e/\u4e8c\u5206\u51fa\u91cd\u590d\u6b21\u6570\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e00\u4e2a\u67d0\u4e2a\u5b57\u7b26\u4e32 $S$ \uff0c\u8bbe\u5176 $\\texttt{HASH}$ \u503c\u4e3a $h$ \uff0c$base^{|S|}=p$ \uff0c\u5219\u5176\u91cd\u590d $k$ \u6b21\u7684 $\\texttt{HASH}$ \u503c\u5e94\u4e3a $\\sum_{i=0}^{k-1} h\\times p^i$ \u7136\u540e\u4e00\u6ce2\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u53ef\u4ee5\u7b97\u51fa\u6765\u3002\u4e8b\u5b9e\u4e0a\u8fd9\u662f\u6ca1\u6709\u95ee\u9898\u7684\uff0c\u4f46\u6211\u4eec\u8981\u8003\u8651\u5230 $\\texttt{Hash}$ \u662f\u7531\u81ea\u7136\u6ea2\u51fa/\u53d6\u6a21\u7684\uff0c\u53ea\u662f\u5e73\u65f6\u90fd\u4e0d\u592a\u5bb9\u6613\u6ea2\u51fa/\u53d6\u6a21\u6b21\u6570\u4e0d\u540c\u6b65\uff0c\u4f46\u6211\u4eec\u5bf9\u5927\u6570\u4f5c\u4e58\u65b9\u8fd0\u7b97\u540e\uff0c\u5b83\u5bb9\u6613\u6ea2\u51fa\u4e0d\u540c\u6b65\uff0c\u7136\u540e\u56e0\u4e3a\u7cbe\u5ea6\u539f\u56e0 WA \u6389\u3002\n\n$~~~~$ ~~\u7136\u540e\u6211\u5c31\u6539\u6210 $len^2$ \u66b4\u529b\u4eb2\u624b\u9001\u63891= QAQ~~\n\n#### \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#include <vector>\n#include <cstring>\n#include <algorithm>\n#define ll long long\n#define ull unsigned long long\nusing namespace std;\nconst ull base=13331;\nint cnt[1500000],t[30];\nchar s[1500000];\null Hash[1500000],p[1500000]; \nll len;\nll tr[30];\null Get_Hash(ll l,ll r)\n{\n\treturn Hash[r]-Hash[l-1]*p[r-l+1];\n}\ninline ll lowbit(ll x){return x&(-x);}\nvoid clearTr(){memset(tr,0,sizeof(tr));}\nvoid add(ll x,ll val){for(;x<=26;x+=lowbit(x))tr[x]+=val;}\nll query(ll x){ll ret=0;for(;x;x-=lowbit(x)) ret+=tr[x];return ret;}\nint main() {\n//\tfreopen(\"data25.in\",\"r\",stdin);\n//\tfreopen(\"data25.out\",\"w\",stdout);\n\tll T;\n\tscanf(\"%lld\",&T);\n\twhile(T--)\n\t{\n\t\tmemset(Hash,0,sizeof(Hash));\n\t\tmemset(cnt,0,sizeof(cnt));\n\t\tclearTr();\n\t\tfor(ll i=0;i<=26;i++) t[i]=0;\n\t\tscanf(\"%s\",s+1);\n\t\tlen=strlen(s+1);\n\t\tp[0]=1;\n\t\tfor(ll i=1;i<=len;i++)\n\t\t{\n\t\t\tHash[i]=Hash[i-1]*base+s[i]-'a'+1;\n\t\t\tp[i]=p[i-1]*base;\n\t\t}\n\t\tfor(ll i=0;i<=26;i++) t[i]=0;\n\t\tfor(ll i=len;i>=1;i--)\n\t\t{\n\t\t\tt[s[i]-'a']++;\n\t\t\tif(t[s[i]-'a']&1) cnt[i]=cnt[i+1]+1;\n\t\t\telse cnt[i]=cnt[i+1]-1;\n\t\t}\n\t\tfor(ll i=0;i<=26;i++) t[i]=0;\n\t\tt[s[1]-'a']++;\n\t\tadd(2ll,1ll);//The position that can let the odd number of letters <= a number \n\t\tll ans=0,last=1;\n\t\tfor(ll i=2;i<len;i++)//The length of AB \n\t\t{\n\t\t\tll now=1;\n\t\t\tull tmp=Get_Hash(1,i);\n\t\t\tll Sta=i+1,End=2*i;\n\t\t\twhile(1)\n\t\t\t{\n\t\t\t\tif(Get_Hash(Sta,End)!=tmp||End>=len) break;\n\t\t\t\telse Sta+=i,End+=i,now++;\n\t\t\t}\n//\t\t\tif(End>len) now--;\n//\t\t\tif(now==0) now=1;\n\t\t\tll K=now-1;\n\t\t\tif(K&1)\n\t\t\t{\n\t\t\t\tans+=(1+(K-1)/2)*query(cnt[i*now+1]+1);\n\t\t\t\tans+=(K+1)/2*query(cnt[i*(now-1)+1]+1);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tans+=(K/2+1)*query(cnt[i*now+1]+1);\n\t\t\t\tans+=K/2*query(cnt[i*(now-1)+1]+1);\n\t\t\t}\n\t\t\tt[s[i]-'a']++;\n\t\t\tif(t[s[i]-'a']&1) last++;\n\t\t\telse last--;\n\t\t\tadd(last+1,1);\n\t\t}\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```\n\n\n\n ",
        "postTime": 1607324005,
        "uid": 160701,
        "name": "Azaz\u0435l",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7114 \u3010\u5b57\u7b26\u4e32\u5339\u914d\uff08\u6d1b\u8c37\u6c11\u95f4\u6570\u636e\uff09\u3011"
    },
    {
        "content": "## \u9898\u76ee\u5927\u610f\n\n- $T$ \u7ec4\u6570\u636e\u3002\u6bcf\u7ec4\u6570\u636e\u7ed9\u51fa\u4e00\u4e2a\u5b57\u7b26\u4e32 $S$ \uff0c\u8be2\u95ee\u5b83\u53ef\u4ee5\u8868\u793a\u6210\u591a\u5c11\u79cd\u5f62\u5982 $(AB)^kC$ \u7684\u5f62\u5f0f\uff0c\u6ee1\u8db3 $A$ \u4e2d\u51fa\u73b0**\u5947\u6570\u6b21**\u7684\u5b57\u7b26\u4e2a\u6570\u5c0f\u4e8e $C$ \u4e2d\u51fa\u73b0**\u5947\u6570\u6b21**\u7684\u5b57\u7b26\u4e2a\u6570\u3002\n\n- \u5176\u4e2d $(AB)^k=\\underbrace{AB\\cdots AB}_{k \\text{\u4e2a}}$ \u3002\u8981\u6c42 $k\\ge 1$ \uff0c\u4e14 $A,B,C$ **\u975e\u7a7a**\u3002\n\n## \u9898\u89e3\n\n> $\\rm upd.2020.12.6$ \u65b0\u589e\u4e86\u4e00\u4e2a\u4e9a $\\log$ \u505a\u6cd5\uff0c\u6700\u5927\u7684\u70b9\u53ea\u9700\u8981 $270\\text{ms}$ \u4e86\u3002\n\n\u5148\u60f3\u4e00\u4e2a $\\mathcal O(tnH(n)+tn|\\Sigma|)$ \u7684\u505a\u6cd5\uff08\u5176\u4e2d $H(n)$ \u4e3a\u8c03\u548c\u7ea7\u6570\uff0c $H(n)=\\sum_{i=1}^n \\frac{1}{i}$ \u3002\uff09\n\n\u7531\u4e8e\u9898\u9762\u4e0a\u7ed9\u51fa\u7684\u5f62\u5f0f\u53ef\u4ee5\u7b80\u8981\u62c6\u6210\u4e24\u5757 $AB,C$ \uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u5176\u4e2d\u4e00\u90e8\u5206\u3002\n\n- \u89c2\u5bdf\u5230\uff0c $AB$ \u5fc5\u7136\u662f $S$ \u7684\u524d\u7f00\u3002\u6211\u4eec\u8003\u8651\u5c06 $AB$ \u4f5c\u4e3a\u6574\u4f53\u679a\u4e3e\u5b83\u7684\u957f\u5ea6 $i$ \uff0c\u5e76\u679a\u4e3e\u5b83\u7684\u5faa\u73af\u8282\u6570 $k$ \u3002\n\n- \u663e\u7136\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u5b57\u7b26\u4e32\u54c8\u5e0c\u5224\u65ad\u540c\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684\u4e24\u4e2a\u5b57\u4e32\u662f\u5426\u76f8\u7b49\u3002\u5177\u4f53\u800c\u8a00\uff0c\u6211\u4eec\u8bbe $T_i=T_{i-1}\\times P+S_i$ \uff0c\u90a3\u4e48\u6ee1\u8db3\u5982\u4e0b\u6761\u4ef6\u65f6\uff0c\u6211\u4eec\u8ba4\u4e3a\u4e24\u4e2a\u5b50\u4e32 $S_{a..b},S_{s..t}$ \u76f8\u7b49\uff1a\n\n$$\\frac{T_b-T_{a-1}}{P^{a-1}}=\\frac{T_t-T_{s-1}}{P^{s-1}}\\Leftrightarrow (T_b-T_{a-1})\\times P^{s}=(T_t-T_{s-1})\\times P^a$$\n\n\u679a\u4e3e\u5b8c\u4e86\u6240\u6709\u7684 $AB$ \u4ee5\u53ca $k$ \uff0c\u6211\u4eec\u80fd\u591f\u8ba1\u7b97\u51fa\u76f8\u5bf9\u5e94\u7684 $C$ \u3002\u73b0\u5728\u8003\u8651\u5904\u7406 $AB$ \u4e2d\u7684 $A$ \u3002\n\n- \u663e\u7136\uff0c\u6211\u4eec\u53ea\u5173\u5fc3 $A$ \u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u4e2a\u6570\uff0c\u800c\u4e0d\u9700\u8981\u8003\u8651\u5b83\u91cc\u9762\u6709\u54ea\u4e9b\u5b57\u7b26\u3002\u6240\u4ee5\u6211\u4eec\u80fd\u7528\u6570\u7ec4 $N_x$ \u5b58\u50a8\u51fa\u73b0 $x$ \u6b21\u5947\u6570\u5b57\u7b26\u7684 $A$ \u7684\u4e2a\u6570\u3002\u7531\u4e8e\u6211\u4eec\u4ece\u5c0f\u5230\u5927\u679a\u4e3e $AB$ \u7684\u957f\u5ea6 $i$ \uff0c\u56e0\u6b64\u7b2c $i$ \u4e2a $N_x$ \u5c31\u662f\u5728 $i-1$ \u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86 $S_{1..i-1}$ \u8fd9\u6837\u4e00\u79cd\u53ef\u80fd\u7684 $A$ \u3002\n\n- \u6211\u4eec\u521a\u521a\u5df2\u7ecf\u679a\u4e3e\u51fa\u4e86\u6240\u6709\u7684 $C$ \u3002\u8fd9\u65f6\u7edf\u8ba1\u4e00\u4e0b $C$ \u4e2d\u5947\u6570\u5b57\u7b26\u7684\u4e2a\u6570 $t$ \uff0c\u7b54\u6848\u52a0\u4e0a $\\sum_{j=1}^k N_j$ \u5c31\u884c\u4e86\u3002\n\n\u5982\u4f55\u7edf\u8ba1\u4e00\u4e2a\u5b57\u7b26\u4e32\u4e2d\u7684\u5947\u6570\u6b21\u5b57\u7b26\u7684\u6570\u91cf\uff1f\n\n- \u4e8b\u5b9e\u4e0a\uff0c\u7531\u4e8e\u5b57\u7b26\u96c6 $|\\Sigma|=26$ \uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528**\u4e8c\u8fdb\u5236\u538b\u7f29**\u7684\u65b9\u6cd5\uff0c\u5c06\u6bcf\u4e2a\u5b57\u7b26\u770b\u4f5c\u4e00\u4f4d\u3002\u8fd9\u6837\u5b50\u65b0\u589e\u52a0\u5b57\u7b26\uff0c\u5c31\u76f8\u5f53\u4e8e**\u5f02\u6216**\u4e0a\u4e86\u5b83\u6240\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u4f4d\uff08\u56e0\u4e3a\u5076\u6570\u6b21\u7684 $1$ \u5f02\u6216\u540e\u4e3a $0$ \uff0c\u5947\u6570\u6b21\u4e3a $1$ \uff09\u3002\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u4e2a\u6570\u5c31\u662f\u4e3a $1$ \u7684\u4e8c\u8fdb\u5236\u4f4d\u7684\u4e2a\u6570\u3002\n\n- \u6b64\u5916\uff0c\u7531\u4e8e $\\text{CCF}$ \u4e0d\u80fd\u7528 $\\text{C++11}$ \u65b0\u589e\u7684 $\\verb!<bit>!  $ \uff0c\u6240\u4ee5\u6211\u4eec\u8981\u624b\u5199 $\\verb!pop_count!$ \u51fd\u6570\uff08\u7528\u4e8e\u7edf\u8ba1\u4e8c\u8fdb\u5236\u4f4d\u4e2d $1$ \u7684\u4e2a\u6570\uff09\u3002\u4e00\u79cd\u7b80\u4fbf\u7684\u505a\u6cd5\u5982\u4e0b\uff1a\n\n  - \u5148\u8ba1\u7b97\u51fa $0\\sim 255$ \u7684\u6bcf\u4e2a\u6570\u5b57\u7684 $1$ \u7684\u4e2a\u6570 $T_i$ \u3002\uff08\u663e\u7136\uff0c\u6709\u9012\u63a8\u5f0f $T_i=T_{\\lfloor i\\div 2\\rfloor}+(i \\operatorname{and} 1)$ \uff09\u3002\n  \n  - \u6bcf\u4e2a $32$ \u4f4d\u6574\u6570\u53ef\u4ee5\u7528\u4f4d\u8fd0\u7b97\u62c6\u6210 $4$ \u6bb5\uff08\u5177\u4f53\u53ef\u4ee5\u770b\u4ee3\u7801\uff09\uff0c\u5206\u522b\u7edf\u8ba1\u518d\u6c42\u548c\u5373\u53ef\u3002\u590d\u6742\u5ea6\u7ea6\u4e3a $\\mathcal O(4)$ \u3002\n\n\u5f53\u7136\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u7528\u4e00\u4e9b\u4f18\u5316\u3002\n\n- \u663e\u7136\uff0c\u679a\u4e3e\u7684 $C$ \u7684\u6570\u91cf\u53ef\u80fd\u6bd4\u8f83\u591a\uff08\u6700\u591a $\\left\\lfloor\\dfrac{n}{i}\\right\\rfloor$ \u4e2a\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u7528 $N_x$ \u7684\u524d\u7f00\u548c $M_x$ \u8fdb\u884c\u4f18\u5316\u3002\u590d\u6742\u5ea6\u964d\u81f3 $\\mathcal O(tnH(n)+tn|\\Sigma|)$ \u3002\n\n- \u8f93\u5165\u91cf\u8f83\u5927\uff0c\u5efa\u8bae\u7528 $\\verb!getchar!$ \u4e4b\u7c7b\u3002\n  \n\u8981\u8bb0\u5f97\u6700\u5927\u6570\u636e $|S|\\le 2^{20}$ \u800c\u4e0d\u662f $10^6$ \uff0c\u4e0d\u8981\u5f00\u5c0f\u7a7a\u95f4\u3002\u53ef\u80fd\u8fd9\u4e2a\u505a\u6cd5\u6709\u70b9\u5361\u5e38\uff08\u5728\u673a\u5668\u4e0a\u6781\u9650\u6570\u636e\u8981 $1.5s$ \uff0c\u6d1b\u8c37\u8981 $0.7\\sim 0.9s$ \u5de6\u53f3\uff09\uff0c\u6ce8\u610f\u5e38\u6570\u5927\u5c0f\u3002\n  \n---\n  \n\u4ec0\u4e48\uff1f\u4f60\u62c5\u5fc3 $\\mathcal O(tnH(n))$ \u505a\u6cd5\u4e0d\u591f\u5757\uff0c\u4f1a\u88ab\u5361\u5e38\uff1f\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4e2a\u66f4\u5757\u7684\u505a\u6cd5\u3002\n  \n\u89c2\u5bdf\u5230\uff0c\u4e0a\u8ff0\u505a\u6cd5\u7684\u74f6\u9888\u5c31\u5728\u4e8e\u5faa\u73af\u8282\u7684\u67e5\u8be2\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u80fd\u591f**\u500d\u589e\u4f18\u5316**\u3002\n  \n- \u5047\u5982\u6211\u4eec\u5df2\u7ecf\u53d1\u73b0\u4e86\u5faa\u73af\u6b21\u6570\u81f3\u5c11\u4e3a $k$ \u3002\u90a3\u4e48\u6211\u4eec\u53ea\u8981\u6bd4\u8f83 $S_{1..i\\times k}$ \u4e0e $S_{i\\times k+1..i\\times 2\\times k}$ \u5c31\u80fd\u5224\u65ad\u5faa\u73af\u6b21\u6570\u80fd\u5426\u8fbe\u5230 $2\\times k$ \u3002\n  \n- \u5bf9\u4e8e\u4e0d\u662f $2$ \u7684\u6b21\u5e42\u7684\u5faa\u73af\u6b21\u6570\uff0c\u6211\u4eec\u4e5f\u80fd\u5982\u6cd5\u70ae\u5236\u3002\u5148\u627e\u5230\u6700\u5927\u7684 $k_m=2^s$ \u4f7f\u5f97\u5faa\u73af\u8282\u957f\u5ea6\u4e0d\u5c0f\u4e8e $k_m$ \u3002\u4ece $k_m$ \u679a\u4e3e\uff0c\u6bcf\u6b21\u6298\u534a\uff0c\u5224\u65ad\u63a5\u4e0b\u6765 $i\\times k$ \u4e2a\u5b57\u7b26\u4e0e\u5b57\u7b26\u4e32\u5f00\u5934\u7684 $i\\times k$ \u7684\u5b57\u7b26\u76f8\u540c\uff08\u4f7f\u7528\u5b57\u7b26\u4e32\u54c8\u5e0c\uff09\u3002\u8fd9\u6837\u590d\u6742\u5ea6\u5c31\u66f4\u4f4e\u4e86\u3002\n  \n- \u641c\u5bfb\u957f\u5ea6\u4e3a $i$ \u7684 $AB$ \u51fa\u73b0\u4e86\u591a\u5c11\u6b21\uff0c\u4ece $\\mathcal O(\\frac{n}{i})$ \u4f18\u5316\u5230\u4e86 $\\mathcal O(\\log\\frac{n}{i})$ \u3002\n\n\u6b64\u5916\uff0c\u524d\u7f00\u548c\u90e8\u5206\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u4f18\u5316\u3002\u4ece\u5355\u6b21 $\\mathcal O(|\\Sigma|)$ \u4f18\u5316\u5230 $\\mathcal O(\\log |\\Sigma|)$ \u3002\n\n\u590d\u6742\u5ea6\u6bd4\u8f83\u7384\u5b66\uff0c\u5927\u6982\u957f\u8fd9\u6837\uff1a\n  \n$$t\\times \\left(\\sum_{i=1}^n \\log\\left\\lfloor\\frac{n}{i}\\right\\rfloor+n\\log|\\Sigma|\\right)$$\n  \n\u663e\u7136\uff0c\u5b83\u662f\u53ef\u4ee5\u901a\u8fc7\u6781\u9650\u6570\u636e\u7684\u3002\n  \n## \u53c2\u8003\u4ee3\u7801\n  \n```cpp\n//\u7b2c\u4e00\u7248\n#include<bits/stdc++.h>\n#define up(l,r,i) for(int i=l,END##i=r;i<=END##i;++i)\n#define dn(r,l,i) for(int i=r,END##i=l;i>=END##i;--i)\nusing namespace std;\ntypedef unsigned int u32;\ntypedef long long    i64;\ntypedef unsigned long long u64;\ni64 qread(){\n\ti64 r=0,w=1; char c;\n\twhile(!isdigit(c=getchar())) w=(c=='-'?-1:1); r=c-'0';\n\twhile( isdigit(c=getchar())) r=r*10+c-'0';\n\treturn r*w;\n}\nconst int MAXN =(1<<20)+3,P=13331;\nu64 H[MAXN],T[MAXN],N[30],ans; int C[256+3],W[MAXN],n,m=MAXN-1,t,c; char S[MAXN];\nint ppc(int x){\t//pop_count\n\treturn C[(x>>24)&255]+C[(x>>16)&255]+C[(x>>8)&255]+C[x&255];\n}\nint main(){\n\tup(0,255,i) C[i]=C[i>>1]+(i&1); T[0]=1; up(1,m,i) T[i]=T[i-1]*P;\n\tdn(qread(),1,TTT){\n\t\twhile(!isalpha(c=getchar())); S[++n]=c;\n\t\twhile( isalpha(c=getchar()))  S[++n]=c;\n\t\tup(1,n,i) W[i]=W[i-1]^(1<<(S[i]-'a')),H[i]=H[i-1]*P+S[i];\n\t\tt=ppc(W[n]);\n\t\tup(1,n-1,i){\n\t\t\tint w=W[i],_w=W[n]^W[i],a=ppc(_w),b=t;\n\t\t\tif(i>1) for(int j=1;i*j<n;++j){\n\t\t\t\tif(H[i*j]-H[i*j-i]==H[i]*T[i*j-i]) ans=ans+N[(j&1)?a:b];\n\t\t\t\telse break;\n\t\t\t}\n\t\t\tup(ppc(w),26,j) ++N[j];\n\t\t}\n\t\tprintf(\"%llu\\n\",ans),ans=n=0;\n\t\tmemset(N,0,sizeof(N));\n\t}\n\treturn 0;\n}\n//\u4f18\u5316\u7248\n#include<bits/stdc++.h>\n#define up(l,r,i) for(int i=l,END##i=r;i<=END##i;++i)\n#define dn(r,l,i) for(int i=r,END##i=l;i>=END##i;--i)\nusing namespace std;\ntypedef unsigned int u32;\ntypedef long long    i64;\ntypedef unsigned long long u64;\ni64 qread(){\n    i64 r=0,w=1; char c;\n    while(!isdigit(c=getchar())) w=(c=='-'?-1:1); r=c-'0';\n    while( isdigit(c=getchar())) r=r*10+c-'0';\n    return r*w;\n}\nconst int MAXN =(1<<20)+3,P=13331,MAXM=26+3;\nu64 H[MAXN],T[MAXN],ans; int C[256+3],W[MAXN],n,m=MAXN-1,t,c; char S[MAXN];\nint ppc(int x){ //pop_count\n    return C[(x>>24)&255]+C[(x>>16)&255]+C[(x>>8)&255]+C[x&255];\n}\nu64 O[MAXM];\nvoid add(int x){++x; while(x<MAXM) ++O[x],x+=x&-x;}\nint  qry(int x){++x; int r=0; while(x) r+=O[x],x-=x&-x; return r;}\nint main(){\n    up(0,255,i) C[i]=C[i>>1]+(i&1); T[0]=1; up(1,m,i) T[i]=T[i-1]*P;\n    dn(qread(),1,TTT){\n        while(!isalpha(c=getchar())); S[++n]=c;\n        while( isalpha(c=getchar()))  S[++n]=c;\n        up(1,n,i) W[i]=W[i-1]^(1<<(S[i]-'a')),H[i]=H[i-1]*P+S[i];\n        t=ppc(W[n]);\n        up(1,n-1,i){\n            int w=W[i],_w=W[n]^W[i],a=ppc(_w),b=t,k,p;\n            for(k=1; ;k<<=1) if(i*k*2>=n||H[i*2*k]-H[i*k]!=H[i*k]*T[i*k])  break;\n            for(p=k;k;k>>=1) if(i*(p+k)<n&&H[i*(p+k)]-H[i*p]==H[i*k]*T[i*p]) p+=k;\n            ans=ans+(p+1)/2*qry(a)+p/2*qry(b),add(ppc(w));\n        }\n        printf(\"%llu\\n\",ans),ans=n=0;\n        memset(O,0,sizeof(O));\n    }\n    return 0;\n}\n```",
        "postTime": 1607181871,
        "uid": 330759,
        "name": "\u56e7\u4ed9",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7114 \u3010\u5b57\u7b26\u4e32\u5339\u914d\u3011"
    },
    {
        "content": "## \u9898\u76ee\u63cf\u8ff0\n\n\u7ed9\u5b9a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u6c42\u6ee1\u8db3 $S=(AB)^iC$\uff0c\u8981\u6c42 $A,B,C$ \u5747\u4e0d\u4e3a\u7a7a\u4e32\uff0c\u4e14 $F(A)\\le F(C)$\uff0c\u5176\u4e2d $F(A)$ \u8868\u793a $A$ \u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u6570\u91cf\u3002\n\n**\u6570\u636e\u8303\u56f4\uff1a**$\\vert S\\vert\\le2^{20}$\u3002\n\n**\u65f6\u95f4\u8303\u56f4\uff1a**$1000\\operatorname{ms}$\u3002\n\n## Solution\n > stO[HXP](https://www.luogu.com.cn/user/56701)Orz\n \n > $\\Theta(\\infty)\\sim\\Theta(n\\sqrt n)$ \u7684\u5c31\u4e0d\u8bf4\u4e86\u3002\n \n > \u4e3b\u8981\u662f\u8865\u5145\u4e00\u4e0b[\u8fd9\u7bc7\u9898\u89e3](https://www.luogu.com.cn/blog/BreezeEnderqwq/NOIp2020-T2)\u3002\n \n > \u592a\u83dc\u4e86\u6ca1\u60f3\u5230/kk\n \n\n\u628a[\u8fd9\u7bc7\u9898\u89e3](https://www.luogu.com.cn/blog/BreezeEnderqwq/NOIp2020-T2)\u6982\u62ec\u4e00\u904d\uff1a\n\n - \u7531\u4e8e\u7528\u5230\u5b50\u4e32\u5339\u914d\uff0c\u8003\u8651\u5b57\u7b26\u4e32\u54c8\u5e0c\u3002\uff08\u540e\u7f00\u6570\u7ec4\u4e5f\u4e0d\u662f\u4e0d\u53ef\u4ee5\uff09\n\n\n - \u8003\u8651\u5982\u4f55\u6ee1\u8db3 $F(A)\\le F(C)$\u3002\n \u53ef\u4ee5\u53d1\u73b0\uff0c\u5f53 $AB$ \u7684\u957f\u5ea6\u56fa\u5b9a\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u679a\u4e3e\u500d\u6570\u6765\u8fbe\u5230\u679a\u4e3e $F(C)$ \u7684\u76ee\u7684\uff0c\u53ef\u4ee5\u5f00\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4 $F(A)$\uff08\u60f3\u5199\u503c\u57df\u5206\u5757\u3001$01\\operatorname{Trie}$ \u6216\u8005\u5e73\u8861\u6811\u4e5f\u4e0d\u62e6\u4f60\uff09\u3002\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(n\\ln n\\log 26)$\uff0c\u671f\u671b\u5f97\u5206 $84\\operatorname{pts}$\u3002\n\n\n - \u518d\u89c2\u5bdf\u4ebf\u4e0b\uff0c\u53ef\u4ee5\u53d1\u73b0\u5bf9\u4e8e\u540c\u4e00\u4e2a $AB$ \u5faa\u73af\u7684\u82e5\u5e72\u500d\uff0c$F(C)$ \u53ea\u6709\u4e24\u4e2a\u53d6\u503c\uff0c\u53ef\u4ee5\u5feb\u901f\u6c42\u51fa\u5faa\u73af\u6b21\u6570\uff0c\u7136\u540e\u5206\u7c7b\u8ba8\u8bba\u3002\n\n\n\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff1a**\u600e\u4e48\u5feb\u901f\u6c42\u51fa\u5faa\u73af\u6b21\u6570\uff1f**\n\n\u4ece\u9ad8\u5230\u4f4e\u679a\u4e3e\uff0c\u5904\u7406 $i$ \u7684\u5faa\u73af\u6b21\u6570\u65f6\u53ef\u4ee5\u7528 $2i$ \u7684\u5faa\u73af\u6b21\u6570\u6765\u5904\u7406\uff0c\u7136\u540e\u5224\u65ad\u4e0b\u4e00\u4e2a\u5faa\u73af\u8282\u662f\u5426\u76f8\u540c\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\Theta(n\\log 26)$\uff0c\u671f\u671b\u5f97\u5206 $100\\operatorname{pts}$\u3002\n## Code\n```cpp\n#include<cstdio>\n#include<cstring>\nusing namespace std;\nconst int maxn=1200000;\nconst unsigned MLY=133;\ntemplate<class T>inline T Max(const T &a,const T &b){return a>b?a:b;}\nchar s[maxn];\nint n;\nstruct TreeArray{\n\tint tr[28];\n\t#define lowbit(x) (x&-x)\n\tinline void add(int x,int d){\n\t\t++x;while(x<=27)tr[x]+=d,x+=lowbit(x);\n\t}\n\tinline int ask(int x){\n\t\t++x;\n\t\tint ans=0;\n\t\twhile(x)ans+=tr[x],x-=lowbit(x);\n\t\treturn ans;\n\t}\n\tinline void clear(){\n\t\tmemset(tr,0,sizeof(tr));\n\t}\n}BIT;\nstruct StringHash{\n\tunsigned long long hash[maxn],base[maxn];\n\tinline StringHash(){\n\t\tbase[0]=1;for(int i=1;i<maxn;++i)base[i]=base[i-1]*MLY;\n\t}\n\tinline void Init(){\n\t\tfor(int i=1;i<=n;++i)hash[i]=hash[i-1]*MLY+s[i];\n\t}\n\tinline unsigned long long ask(int l,int r){\n\t\treturn hash[r]-hash[l-1]*base[r-l+1];\n\t}\n}Hash;\nint pre[maxn],suf[maxn],cnt[300],rep[maxn];\nbool vis[27];\nint stk[27],top;\nint main(){\n\tFILE *fin=stdin;\n\tFILE *fout=stdout;\n\tint T;\n\tfscanf(fin,\"%d\",&T);\n\twhile(T--){\n\t\tmemset(pre,0,sizeof(pre));\n\t\tmemset(suf,0,sizeof(suf));\n\t\tfscanf(fin,\"%s\",s+1);\n\t\tn=strlen(s+1);\n\t\tHash.Init();BIT.clear();\n\t\tmemset(cnt,0,sizeof(cnt));\n\t\tfor(int i=1;i<=n;++i)pre[i]=pre[i-1]+(((++cnt[s[i]])&1)?1:-1);\n\t\tmemset(cnt,0,sizeof(cnt));\n\t\tfor(int i=n;i;--i)suf[i]=suf[i+1]+(((++cnt[s[i]])&1)?1:-1);\n\t\tlong long ans=0;\n\t\tfor(int i=n-1;i;--i){\n\t\t\tif(i*2>=n)rep[i]=1;\n\t\t\telse if(Hash.ask(1,i)!=Hash.ask(i+1,i*2))rep[i]=1;\n\t\t\telse{\n\t\t\t\trep[i]=rep[i*2]*2;\n\t\t\t\tif(i*(rep[i]+1)<n&&Hash.ask(1,i)==Hash.ask(i*rep[i]+1,i*(rep[i]+1)))++rep[i];\n\t\t\t}\n\t\t}\n\t\tfor(int i=1;i<n;++i){\n\t\t\tif(rep[i]==1){\n\t\t\t\tans+=BIT.ask(suf[i+1]);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tans+=(rep[i]+1)/2ll*BIT.ask(suf[i+1]);\n\t\t\t\tans+=rep[i]/2ll*BIT.ask(suf[i*2+1]);\n\t\t\t}\n\t\t\tBIT.add(pre[i],1);\n\t\t}\n\t\tfprintf(fout,\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1621508702,
        "uid": 375785,
        "name": "x7103",
        "ccfLevel": 9,
        "title": "NOIP2020 \u5b57\u7b26\u4e32\u5339\u914d"
    },
    {
        "content": "## \u7b97\u6cd5\u4e00\n\n> \u7279\u6b8a\u6027\u8d28\uff1a$n \\leq 2^{17}$\u3002\n\n\u4e00\u4e2a\u8f83\u4e3a\u7b80\u5355\u7684\u505a\u6cd5\uff0c\u57fa\u672c\u4e0d\u7528\u600e\u4e48\u601d\u8003\u3002\n\n\u6ce8\u610f\u5230\u7b54\u6848\u662f\u8981\u6c42\u5c06\u5b57\u7b26\u4e32\u5212\u5206\u6210 $S = (AB)^iC$ \u7684\u5f62\u5f0f\u3002\n\n\u8bb0 $F(S)$ \u7684\u8868\u793a\u5b57\u7b26\u4e32 $S$ \u4e2d\u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u6570\u91cf\u3002   \n\u9700\u8981\u5148\u9884\u5904\u7406\u51fa\uff1a\n\n- \u6bcf\u4e00\u4e2a\u524d\u7f00 $S_{1 .. i}$ \u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u6570\u91cf\uff0c\u5373 $F(S_{1..i})$\u3002\n- \u6bcf\u4e00\u4e2a\u540e\u7f00 $S_{i .. n}$ \u51fa\u73b0\u5947\u6570\u6b21\u7684\u5b57\u7b26\u7684\u6570\u91cf\uff0c\u5373 $F(S_{i .. n})$\u3002\n\n\u8003\u8651\u679a\u4e3e $T = (AB)$\uff0c\u90a3\u76f8\u5f53\u4e8e\u662f\u679a\u4e3e\u4e00\u4e2a\u524d\u7f00\u3002  \n\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u518d\u4ece\u5c0f\u5230\u5927\u679a\u4e3e\u4e00\u4e2a $i$\uff0c\u4f7f\u7528 hash \u5224\u65ad\u5b50\u4e32\u662f\u5426\u5b8c\u5168\u76f8\u7b49\u3002\n\n\u6b64\u65f6\u6574\u4e2a\u5b57\u7b26\u4e32\u7684\u5212\u5206\u7ed3\u6784\u5c31\u5df2\u7ecf\u662f\u786e\u5b9a\u7684\u4e86\u3002  \n$F(C)$ \u5df2\u7ecf\u9884\u5904\u7406\u597d\u4e86\uff0c\u90a3\u8fd9\u79cd\u60c5\u51b5\u5bf9\u7b54\u6848\u7684\u8d21\u732e\uff0c\u76f8\u5f53\u4e8e\u8981\u5728 $T$ \u91cc\u6570\u51fa\u6709\u591a\u5c11\u4e2a $A$ \u6ee1\u8db3 $F(A) \\leq F(C)$\u3002\n\n\u6ce8\u610f\u5230\u6bcf\u4e00\u4e2a $A$ \u5728 $T$ \u4e2d\u662f**\u771f\u524d\u7f00**\uff0c\u90a3\u76f4\u63a5\u7528\u6811\u72b6\u6570\u7ec4\u52a8\u6001\u7ef4\u62a4\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n \\ln n + n \\log |\\sum|)$\u3002  \n\u5176\u4e2d $\\sum$ \u8868\u793a\u5b57\u7b26\u96c6\u3002\n\n\u671f\u671b\u5f97\u5206 $84 \\sim 100$\u3002\n\n```c++\n#include <iostream>\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n\nusing namespace std;\n\nconst int N = 2000000;\nconst unsigned long long P = 13331;\n\nint n;\nchar S[N];\n\n// suf & pre\n\nbool exist[30];\nint num;\n\nint suf[N];\nint pre[N];\nint c[N][30];\n\n// hash\n\nunsigned long long power[N];\nunsigned long long hash[N];\n\nunsigned long long H(int l, int r) {\n\treturn hash[r] - hash[l - 1] * power[r - l + 1];\n}\n\nvoid work() {\n\tscanf(\"%s\", S + 1);\n\tn = strlen(S + 1);\n\n// suf\n\n\tfor (int i = 0; i < 26; i ++)\n\t\texist[i] = 0;\n\n\tnum = 0;\n\tfor (int i = n; i >= 1; i --) {\n\t\tint ch = S[i] - 'a';\n\n\t\texist[ch] ^= 1;\n\n\t\tif (exist[ch]) num ++;\n\t\telse num --;\n\n\t\tsuf[i] = num;\n\t}\n\n// pre\n\n\tfor (int i = 0; i < 26; i ++)\n\t\texist[i] = 0;\n\n\tnum = 0;\n\tfor (int i = 1; i <= n; i ++) {\n\t\tint ch = S[i] - 'a';\n\n\t\texist[ch] ^= 1;\n\n\t\tif (exist[ch]) num ++;\n\t\telse num --;\n\n\t\tpre[i] = num;\n\t}\n\n\tfor (int i = 1; i <= n; i ++) {\n\t\tfor (int j = 0; j <= 26; j ++)\n\t\t\tc[i][j] = c[i - 1][j];\n\t\tfor (int j = pre[i]; j <= 26; j ++)\n\t\t\tc[i][j] ++;\n\t}\n\n// hash\n\n\tfor (int i = 1; i <= n; i ++)\n\t\thash[i] = hash[i - 1] * P + (S[i] - 'a');\n\n// work\n\n\tlong long ans = 0;\n\n\tfor (int i = 1; i <= n; i ++) {\n\t\tfor (int j = 1; j <= n / i; j ++) {\n\t\t\tint l = (j - 1) * i + 1, r = j * i;\n\n\t\t\tif (H(1, i) != H(l, r)) break;\n\t\t\tif (r + 1 > n) break;\n\n\t\t\tans += c[i - 1][suf[r + 1]];\n\t\t}\n\t}\n\n\tprintf(\"%lld\\n\", ans);\n}\n\nint main() {\n\tpower[0] = 1;\n\tfor (int i = 1; i <= 1500000; i ++) power[i] = power[i - 1] * P;\n\n\tint T; scanf(\"%d\", &T);\n\n\twhile (T --)    work();\n\n\treturn 0;\n}\n\n// I hope changle_cyx can pray for me.\n```\n\n## \u7b97\u6cd5\u4e8c\n\n> \u7279\u6b8a\u6027\u8d28\uff1a$n \\leq 2^{20}$\u3002\n\n\u300c\u7b97\u6cd5\u4e00\u300d\u6ca1\u6709\u600e\u4e48\u7528\u5230\u9898\u76ee\u4e2d\u7684\u4e00\u4e9b\u6027\u8d28\u3002\n\n\u8fd8\u662f\u8003\u8651\u679a\u4e3e $T = (AB) = S_{1 .. x}$\u3002\n\n\u5bf9\u4e8e\u5f53\u524d\u679a\u4e3e\u5230\u7684\u4e00\u4e2a $x$\u3002  \n\u8003\u8651\u8ba1\u7b97\u51fa\u4e00\u4e2a\u6700\u5927\u7684 $i$\uff0c\u4f7f\u5f97 $S$ \u53ef\u4ee5\u88ab\u5212\u5206\u6210 $(AB)^iC$ \u7684\u5f62\u5f0f\uff0c\u8bb0\u8fd9\u4e2a\u91cf\u4e3a $k$\u3002\n\n\u9996\u5148\u6709\u4e00\u4e2a\u7ed3\u8bba\u662f\uff1a\u82e5\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5b57\u7b26\u4e32 $S$ \u7684\u524d $n - m$ \u4f4d\u548c\u540e $n - m$ \u662f\u76f8\u7b49\u7684\u4e14 $m \\mid n$\uff0c\u5219 $S$ \u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a $m$ \u7684\u6574\u9664\u5faa\u73af\u8282\u3002\n\n\u6839\u636e\u8be5\u7ed3\u8bba\uff0c\u8003\u8651\u6c42\u51fa\u5b57\u7b26\u4e32 $S$ \u7684 $Z$ \u51fd\u6570\uff0c\u5176\u4e2d $Z_i$ \u8868\u793a\uff1a\u540e\u7f00 $S_{i .. n}$ \u4e0e $S$ \u7684\u6700\u957f\u516c\u5171\u524d\u7f00\uff08LCP\uff09\u7684\u957f\u5ea6\u3002  \n~~\u81f3\u4e8e Z \u7b97\u6cd5\u5927\u5bb6\u61c2\u5f97\u90fd\u61c2\u3002~~\n\n\u6ce8\u610f\u5230\u82e5 $S$ \u53ef\u4ee5\u88ab\u5212\u5206\u6210 $(AB)^iC$ \u7684\u5f62\u5f0f\uff0c\u5219\u5fc5\u6ee1\u8db3 $x(i - 1) \\leq Z_{x + 1}$ \u4e14 $xi < n$\u3002\n\n\u89e3\u5f97 $i \\leq \\frac{Z_{x + 1}}{x}+ 1$ \u4e14 $i < \\frac{n}{x}$\uff0c\u5219 $k = \\min \\left\\{ \\left\\lfloor \\frac{Z_{x + 1}}{x}  \\right\\rfloor + 1, \\left\\lceil \\frac{n}{x} \\right\\rceil - 1 \\right\\}$\u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651 $F\\left((AB)^i\\right)$ \u7684\u4e00\u4e9b\u6027\u8d28\uff08\u91cd\u590d\u6027\uff09\uff0c\u6ce8\u610f\u5230\uff1a\n\n- \u5f53 $i$ \u4e3a\u5947\u6570\u65f6\uff0c\u6709 $F\\left( (AB)^i \\right)$ \u5747\u76f8\u7b49\uff0c\u5373 $F\\left(AB\\right) = F\\left( (AB)^3 \\right) = F\\left( (AB)^5 \\right) = \\cdots$\u3002  \n  \u90a3\u4e48\u53ef\u4ee5\u63a8\u51fa\uff0c\u5f53 $i$ \u4e3a\u5947\u6570\u65f6\uff0c\u5bf9\u4e8e\u6bcf\u4e2a $(AB)^i$ \u5212\u5206\u51fa\u6765\u7684 $C$\uff0c\u90fd\u6709 $F(C) = F(S_{x + 1 .. n})$\u3002\n\n- \u5f53 $i$ \u4e3a\u5076\u6570\u65f6\uff0c\u6709 $F\\left( (AB)^i \\right) = 0$\u3002  \n  \u90a3\u4e48\u53ef\u4ee5\u63a8\u51fa\uff0c\u5f53 $i$ \u4e3a\u5076\u6570\u65f6\uff0c\u5bf9\u4e8e\u6bcf\u4e2a $(AB)^i$ \u5212\u5206\u51fa\u6765\u7684 $C$\uff0c\u90fd\u6709 $F(C) = F(S)$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u5212\u5206\u51fa\u6765\u7684 $F(C)$ \u7684\u4e5f\u5c31\u53ea\u6709\u4e24\u79cd\u60c5\u51b5\uff0c\u8981\u4e48\u662f $F(S_{x + 1 .. n})$ \u8981\u4e48\u662f $F(S)$\u3002   \n\u5e76\u4e14\uff0c\u6709 $\\left\\lceil \\frac{k}{2} \\right\\rceil$ \u4e2a $i$ \u4e3a\u5947\u6570\uff0c\u6709 $\\left\\lfloor \\frac{k}{2} \\right\\rfloor$ \u4e2a $i$ \u4e3a\u5076\u6570\u3002\n\n$F(S_{x + 1 .. n})$ \u5728\u679a\u4e3e $x$ \u7684\u65f6\u5019\u987a\u4fbf\u5904\u7406\u4e00\u4e0b\u5373\u53ef\uff0c$F(S)$ \u76f4\u63a5\u5904\u7406\u5373\u53ef\u3002\n\n\u90a3\u4e48\u73b0\u5728\u5c31\u662f\u8981\u5206\u522b\u6570\u51fa $T$ \u4e2d\u6709\u591a\u5c11\u4e2a\u771f\u524d\u7f00 $A$ \u6ee1\u8db3 $F(A) \\leq F(S_{x + 1 .. n})$\uff0c$F(A) \\leq F(S)$\u3002\n\n\u53ef\u4ee5\u7528\u6811\u72b6\u6570\u7ec4\u505a\u5230 $\\mathcal{O}(n \\log |\\sum|)$\u3002\n\n\u6ce8\u610f\u5230 $F(S)$ \u662f\u4e0d\u53d8\u7684\uff0c\u90a3\u4e48\u5728\u679a\u4e3e\u7684\u65f6\u5019\u76f4\u63a5\u5224\u65ad\u4e00\u4e0b\u5373\u53ef\u3002  \n\u81f3\u4e8e $F(S_{x + 1 .. n})$\uff0c\u5f53 $x$ \u52a0 $1$ \u7684\u65f6\u5019\u4e5f\u53ea\u4f1a\u5bfc\u81f4 $F(S_{x + 1 .. n})$ \u53d8\u5316 $1$\uff0c\u7a0d\u5fae\u5224\u65ad\u4e00\u4e0b\u8865\u8865\u8d21\u732e\u5373\u53ef\u3002 \n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n)$\u3002\n\n```c++\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n\nusing namespace std;\n\nconst int N = (1 << 20) + 1000;\n\nint T;\n\nint n;\nchar s[N];\n\nint Z[N];\n\nvoid Z_algorithm() {\n\tfor (int i = 1; i <= n; i ++) Z[i] = 0;\n\tfor (int i = 2, l = 0, r = 0; i <= n; i ++) {\n\t\tif (i <= r) Z[i] = min(Z[i - l + 1], r - i + 1);\n\t\twhile (i + Z[i] <= n && s[1 + Z[i]] == s[i + Z[i]])\n\t\t\tZ[i] ++;\n\t\tif (i + Z[i] - 1 > r)\n\t\t\tl = i, r = i + Z[i] - 1;\n\t}\n}\n\nint pre, suf, Fs;\nint cnt[26];\nbool flag1[26], flag2[26];\n\nint cur1, cur2;\nlong long ans;\n\nvoid work() {\n\tscanf(\"%s\", s + 1);\n\tn = strlen(s + 1);\n\n\tZ_algorithm();\n\n\tmemset(flag1, 0, sizeof(flag1));\n\tmemset(flag2, 0, sizeof(flag2));\n\tfor (int i = 1; i <= n; i ++) {\n\t\tint ch = s[i] - 'a';\n\t\tflag2[ch] ^= 1;\n\t}\n\n\tFs = 0;\n\tfor (int i = 0; i < 26; i ++)\n\t\tif (flag2[i]) Fs ++;\n\n\tpre = 0, suf = Fs;\n\tans = 0, cur1 = cur2 = 0;\n\tmemset(cnt, 0, sizeof(cnt));\n\n\tfor (int i = 1; i < n; i ++) {\n\t\tint ch = s[i] - 'a';\n\n\t\tflag1[ch] ^= 1, flag2[ch] ^= 1;\n\n\t\tif (flag1[ch]) pre ++;\n\t\telse pre --;\n\n\t\tif (flag2[ch]) suf ++, cur1 += cnt[suf];\n\t\telse cur1 -= cnt[suf], suf --;\n\n\t\tint k = min((Z[i + 1] / i) + 1, (n - 1) / i);\n\t\tint odd = (k + 1) / 2, even = k / 2;\n\n\t\tans += 1ll * odd * cur1;\n\t\tans += 1ll * even * cur2;\n\n\t\tcnt[pre] ++;\n\t\tif (pre <= suf) cur1 ++;\n\t\tif (pre <= Fs) cur2 ++;\n\t}\n\n\tprintf(\"%lld\\n\", ans);\n}\n\nint main() {\n\tscanf(\"%d\", &T);\n\n\twhile (T --)    work();\n\n\treturn 0;\n}\n\n// I hope changle_cyx can pray for me.\n```",
        "postTime": 1613783366,
        "uid": 129578,
        "name": "Calculatelove",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7114 \u3010[NOIP2020] \u5b57\u7b26\u4e32\u5339\u914d\u3011"
    },
    {
        "content": "\u9898\u5916\u8bdd\uff1a\u5728\u8003\u573a\u4e0a\u5199\u4e86$O(n \\ln n\\log26) $ \u7684\u8822\u505a\u6cd5\uff0c\u636e\u8bf4\u7528\u66b4\u529b$O(n*26+n\\ln n)$\u66ff\u4ee3\u6811\u72b6\u6570\u7ec4\u53ef\u4ee5\u62ff92\u5206\u7684\u597d\u6210\u7ee9\n\n\u8fd9\u91cc\u4ecb\u7ecd\u4e24\u79cd$O(n\\log 26)$\u7684\u505a\u6cd5\n\n\u9996\u5148\u7ecf\u601d\u8003\u5bb9\u6613\u60f3\u5230\u5148\u9884\u5904\u7406\u51fa\u540e\u7f00$C$\u7684\u5947\u6570\u6b21\u5b57\u7b26\u6570\u91cf\uff0c\u7136\u540e\u679a\u4e3e$AB$\u7684\u5927\u5c0f\uff08\u7528\u54c8\u5e0c\u5224\u65ad\u4e00\u4e0b\u5c31\u884c\uff09\u3002\n\n\u56e0\u4e3a$B$\u53ea\u8981\u81f3\u5c11\u6709\u4e00\u4e2a\u5b57\u7b26\u5c31\u6ee1\u8db3\u6761\u4ef6\uff0c\u800c$A$\u53c8\u662f\u524d\u7f00\uff0c\u6240\u4ee5\u5c31\u76f4\u63a5\u7ef4\u62a4$A$\u4e2d\u7684\u5947\u6570\u6b21\u5b57\u7b26\u6570\u91cf\uff0c\u6700\u591a\u670926\u4e2a\uff0c\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u5c31\u884c\uff0c\u590d\u6742\u5ea6\uff1a$O(n \\ln n\\log26)$\n\uff08\u7531\u4e8e\u67e5\u8be2\u662f\u4e00\u4e2a\u524d\u7f00\uff0c\u6240\u4ee5\u5728\u66f4\u65b0$A$\u65f6\u76f4\u63a5\u66b4\u529b\u4fee\u6539\u524d\u7f00\u6570\u7ec4\u5c31\u53ef\u4ee5\u53bb\u6389$\\log 26$\uff09\u3002~~\u8bb2\u9053\u7406\u6570\u636e\u7a0d\u5fae\u968f\u673a\u4e00\u70b9\u90fd\u80fd\u8dd1\u8fc7\u53bb~~\n\n```cpp\n#include<iostream>\n#include<ctime>\n#include<climits>\n#include<cmath>\n#include<cstring>\n#include<algorithm>\n#include<cstdio>\n#define ll long long\n#define ull unsigned long long\nusing namespace std;\nconst ll N=1100000,base1=1021831,base2=96269; \null hash1[N],hash2[N],pow1[N],pow2[N];\null ff1(ll l,ll r) {return hash1[r]-hash1[l-1]*pow1[r-l+1];}\null ff2(ll l,ll r) {return hash2[r]-hash2[l-1]*pow2[r-l+1];}\npair<ull,ull> ff(ll l,ll r) {return make_pair(ff1(l,r),ff2(l,r));}\nstruct BIT\n{\n    ll sum[30],n;\n    void clear() {memset(sum,0,sizeof(sum));}\n    inline ll lowbit(ll x) {return x&(-x);}\n    void add(ll x,ll v) {while(x<=n) sum[x]+=v,x+=lowbit(x);}\n    ll find(ll x){ll ans=0;while(x) ans+=sum[x],x-=lowbit(x);return ans;}\n}T;\nll n,ans,tot[30],cnt,_tot[N];\nchar ch[N];\nint main()\n{\n    ll Q,i,j;\n    pair<ull,ull> tmp;\n    scanf(\"%lld\",&Q);\n    T.n=26;\n    while(Q--)\n    {\n        T.clear();\n        memset(tot,0,sizeof(tot));\n        memset(_tot,0,sizeof(_tot));\n        cnt=ans=0;\n        scanf(\"%s\",ch+1);\n        n=strlen(ch+1);\n        hash1[0]=hash2[0]=0,pow1[0]=pow2[0]=1;\n        for(i=1;i<=n;i++) \n        {\n            hash1[i]=hash1[i-1]*base1+ch[i],hash2[i]=hash2[i-1]*base2+ch[i];\n            pow1[i]=pow1[i-1]*base1,pow2[i]=pow2[i-1]*base2;\n        }\n        for(i=n;i>=3;i--) \n        {\n            tot[ch[i]-'a']^=1;\n            if(tot[ch[i]-'a']==0) cnt--;\n            else cnt++;\n            _tot[i]=cnt;\n        }\n        memset(tot,0,sizeof(tot));\n        cnt=0;\n        for(i=2;i<n;i++)\n        {\n            tot[ch[i-1]-'a']^=1;\n            if(tot[ch[i-1]-'a']==0) cnt--;\n            else cnt++;\n            T.add(cnt+1,1);\n            tmp=ff(1,i);\n            for(j=1;i*j<n;j++)\n            {   \n                if(ff(i*j-i+1,i*j)!=tmp) break;\n                ans+=T.find(_tot[i*j+1]+1);\n            } \n        }\n        printf(\"%lld\\n\",ans);\n    }\n    return 0;\n}\n```\n\n\n\u521a\u624d\u7684\u505a\u6cd5\u74f6\u9888\u5728\u4e8e\u8981\u679a\u4e3e$AB$\u7684\u5faa\u73af\u6b21\u6570\n\n\u4ece\u6570\u636e\u8303\u56f4\u91cc\u8fd8\u6ca1\u6709\u7528\u5230\u7684\u7279\u6b8a\u6027\u8d28\u5206\u6790\u4e00\u4e0b\uff0c\u53d1\u73b0\u8fd8\u6709\u4e00\u79cd\u5b57\u7b26\u548c\u53ea\u6709\u4e24\u79cd\u7684\u5728$AB$\u5927\u5c0f\u786e\u5b9a\u540e$(AB)^i$\u7684\u5947\u6570\u6b21\u5b57\u7b26\u6570\u91cf\u662f\u5faa\u73af\u7684\u3002\n\n**\u56e0\u4e3a$S_1=AB$\u4e0e$S_2=ABABAB$\u7684\u5947\u6570\u6b21\u5b57\u7b26\u6570\u91cf\u662f\u4e00\u6837\u7684\uff01\u800c\u4e14\u8fd9\u6837\u7684\u8bdd$S_1$\u4e0e$S_2$\u5bf9\u5e94\u7684$C$\u7684\u5947\u6570\u6b21\u5b57\u7b26\u6570\u91cf\u4e5f\u662f\u4e00\u6837\u7684\uff01\u6362\u8a00\u4e4b\u6211\u4eec\u77e5\u9053$AB$\u7684\u6700\u5927\u5faa\u73af\u6b21\u6570\u5c31\u53ef\u4ee5\u6bcf\u6b21$O(\\log26)$\u6c42\u51fa\u7b54\u6848\u3002\u603b\u590d\u6742\u5ea6\uff1a$O(n\\log 26)$**\n\n\uff08$AB$\u5faa\u73af\u6700\u591a\u7684\u90a3\u79cd\u5e76\u4e0d\u9700\u8981\u5355\u72ec\u8ba1\u7b97\uff0c\u56e0\u4e3a$AB$\u4e2d\u51fa\u73b0\u5076\u6570\u6b21\u7684\u6ca1\u6709\u5f71\u54cd\uff0c\u800c\u5947\u6570\u6b21\u7684\u5b57\u7b26\u53d8\u62100\u53ef\u4ee5\u5f53\u5076\u6570\u6765\u770b\uff09\n\n\u4e0b\u9762\u4ecb\u7ecd\u4e24\u79cd$O(n)$\u9884\u5904\u7406$AB$\u6700\u5927\u5faa\u73af\u6b21\u6570\u6b21\u6570\u7684\u65b9\u6cd5\n\n#### \u6cd5\u4e00\uff1a\n\n\u4ee4$num[x]$\u4e3a$[1,x]$\u4e3a$AB$\u65f6\u7684\u6700\u591a\u91cd\u590d\u6b21\u6570\n\n\u82e5$[1,x],[x+1,2x]$\u76f8\u540c\u65f6\uff0c$num[x]$\u81f3\u5c11\u4e3a$num[2x]*2$\uff0c\u4e0d\u8d85\u8fc7\u8fd9\u4e2a\u6570+1\u3002\u53ea\u9700\u518d\u5224\u65ad\u4e00\u4e0b$[1,x],[num[2x]*2x+1,num[2x]*2x+x]$\u5c31\u884c\n\n```cpp\n#include<iostream>\n#include<ctime>\n#include<climits>\n#include<cmath>\n#include<cstring>\n#include<algorithm>\n#include<cstdio>\n#define ll long long\n#define ull unsigned long long\nusing namespace std;\nconst ll N=1100000,base1=1021831,base2=96269; \null hash1[N],hash2[N],pow1[N],pow2[N];\null ff1(ll l,ll r) {return hash1[r]-hash1[l-1]*pow1[r-l+1];}\null ff2(ll l,ll r) {return hash2[r]-hash2[l-1]*pow2[r-l+1];}\npair<ull,ull> ff(ll l,ll r) {return make_pair(ff1(l,r),ff2(l,r));}\nstruct BIT\n{\n    ll sum[30],n;\n    void clear() {memset(sum,0,sizeof(sum));}\n    inline ll lowbit(ll x) {return x&(-x);}\n    void add(ll x,ll v) {while(x<=n) sum[x]+=v,x+=lowbit(x);}\n    ll find(ll x){ll ans=0;while(x) ans+=sum[x],x-=lowbit(x);return ans;}\n}T;\nll n,ans,book[30],cnt,tot[N],num[N];\nchar ch[N];\nint main()\n{\n    ll Q,i;\n    scanf(\"%lld\",&Q);\n    T.n=26;\n    while(Q--)\n    {\n        T.clear();\n        memset(book,0,sizeof(book));\n        memset(tot,0,sizeof(tot));\n        memset(num,0,sizeof(num));\n        cnt=ans=0;\n        scanf(\"%s\",ch+1);\n        n=strlen(ch+1);\n        hash1[0]=hash2[0]=0,pow1[0]=pow2[0]=1;\n        for(i=1;i<=n;i++) \n        {\n            hash1[i]=hash1[i-1]*base1+ch[i],hash2[i]=hash2[i-1]*base2+ch[i];\n            pow1[i]=pow1[i-1]*base1,pow2[i]=pow2[i-1]*base2;\n        }\n        for(i=n;i>=3;i--) \n        {\n            book[ch[i]-'a']^=1;\n            if(book[ch[i]-'a']==0) cnt--;\n            else cnt++;\n            tot[i]=cnt;\n        }\n        num[n-1]=1;\n        for(i=n-2;i>=2;i--)\n        {\n        \tif(i*2>n-1 || ff(1,i)!=ff(i+1,i*2)) {num[i]=1;continue;}\n        \tnum[i]=num[i<<1]<<1;\n        \tif(num[i]*i+i<=n-1 && ff(1,i)==ff(num[i]*i+1,num[i]*i+i)) num[i]++;\n\t\t}\n\t\tcnt=0;\n\t\tmemset(book,0,sizeof(book));\n        for(i=2;i<n;i++)\n        {\n            book[ch[i-1]-'a']^=1;\n            if(book[ch[i-1]-'a']==0) cnt--;\n            else cnt++;\n            T.add(cnt+1,1);\n            ans+=T.find(tot[i+1]+1)*((num[i]>>1)+(num[i]&1));\n            ans+=T.find(tot[i*2+1]+1)*(num[i]>>1);\n        }\n        printf(\"%lld\\n\",ans);\n    }\n    return 0;\n}\n```\n\n#### \u6cd5\u4e8c\uff1a\n\n\u4f17\u6240\u5468\u77e5\uff0c\u7528kmp\u7b97\u6cd5\u53ef\u4ee5$O(1)$\u6c42\u51fa  $\u5b57\u7b26\u4e32\u7684\u6700\u5c0f\u5faa\u73af\u5468\u671f= len-kmp[len] (\u5931\u914d\u4f4d\u7f6e)$ \u3002\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u7528\u4e8c\u5206\u7b97\u51fa$AB$\u7684\u6700\u5927\u5faa\u73af\u6b21\u6570\uff0c\u4e8c\u5206\u7684\u590d\u6742\u5ea6\u4e3a\n\n$\\sum_{i=1}^{n}log(\\frac{n}{i})=n\\log n-\\sum_{i=1}^{n}\\log i$\n\n\u4e4d\u4e00\u773c\u611f\u89c9\u8fd9\u4e2a\u4e1c\u897f\u4e0d\u592a\u884c\uff0c\u4f46\u662f\u7a0d\u5fae\u62c6\u4e00\u4e0b\n\n$\\sum_{i=1}^{n}\\log i\\thickapprox n+(n-2^0)+(n-2^1)+\u00b7\u00b7\u00b7+(n-2^{log_{2}{n}})\\thickapprox n*\\log n-n$\n\n\u6240\u4ee5\u4e8c\u5206\u5b9e\u9645\u4e0a\u590d\u6742\u5ea6\u53ea\u6709$O(n)$ \n\n```cpp\n#include<iostream>\n#include<ctime>\n#include<climits>\n#include<cmath>\n#include<cstring>\n#include<algorithm>\n#include<cstdio>\n#define ll long long\n#define ull unsigned long long\nusing namespace std;\nconst ll N=1100000;\nstruct BIT\n{\n    ll sum[30],n;\n    void clear() {memset(sum,0,sizeof(sum));}\n    inline ll lowbit(ll x) {return x&(-x);}\n    void add(ll x,ll v) {while(x<=n) sum[x]+=v,x+=lowbit(x);}\n    ll find(ll x){ll ans=0;while(x) ans+=sum[x],x-=lowbit(x);return ans;}\n}T;\nll n,ans,book[30],cnt,tot[N],num[N],kmp[N],k;\nchar ch[N];\nint main()\n{\n    ll Q,i,l,r,mid,res,len;\n    scanf(\"%lld\",&Q);\n    T.n=26;\n    while(Q--)\n    {\n        T.clear();\n        memset(book,0,sizeof(book));\n        memset(tot,0,sizeof(tot));\n        memset(num,0,sizeof(num));\n        memset(kmp,0,sizeof(kmp));\n        cnt=ans=0;\n        scanf(\"%s\",ch);\n        n=strlen(ch);\n        for(i=n-1;i>=2;i--) \n        {\n            book[ch[i]-'a']^=1;\n            if(book[ch[i]-'a']==0) cnt--;\n            else cnt++;\n            tot[i]=cnt;\n        }\n        kmp[0]=kmp[1]=0;k=0;\n        for(i=1;i<n;i++)\n        {\n        \twhile(k && ch[i]!=ch[k]) k=kmp[k];\n        \tif(ch[i]==ch[k]) k++;\n        \tkmp[i+1]=k;\n\t\t}\n\t\tfor(i=1;i<n;i++)\n\t\t{\n\t\t\tl=2,r=(n-1)/(i+1),res=1;\n\t\t\twhile(l<=r)\n\t\t\t{\n\t\t\t\tmid=l+r>>1;\n\t\t\t\tlen=(i+1)*mid;\n\t\t\t\tif((len-1-kmp[len-1])!=0 && (i+1)%(len-kmp[len])==0) res=mid,l=mid+1;\n\t\t\t\telse r=mid-1;\n\t\t\t}\n\t\t\tnum[i]=res;\n\t\t}\n\t\tcnt=0;\n\t\tmemset(book,0,sizeof(book));\n        for(i=1;i<n-1;i++)\n        {\n            book[ch[i-1]-'a']^=1;\n            if(book[ch[i-1]-'a']==0) cnt--;\n            else cnt++;\n            T.add(cnt+1,1);\n            len=i+1;\n            ans+=T.find(tot[len]+1)*((num[i]>>1)+(num[i]&1));\n            ans+=T.find(tot[len*2]+1)*(num[i]>>1);\n        }\n        printf(\"%lld\\n\",ans);\n    }\n    return 0;\n}\n```\n\n##### \u540e\u8bb0\uff1a\n\n\u6709\u4e2a\u61a8\u61a8\u8dd1\u5230\u6211\u8ddf\u524d\u8bf4\u8fd9\u9898\u53ef\u4ee5\u505a\u5230$O(n)$\uff0c\u6211\u6123\u4e86\u4e00\u4e0b\uff0c\u5bfb\u601d\u7740\u8fd9$\\log 26$\u8c8c\u4f3c\u4e5f\u4e0d\u5927\u554a\uff0c\u662f\u4e0d\u662f\u6211\u542c\u9519\u4e86\uff1f\u201c\u56e0\u4e3a\u4f60\u53d1\u73b0\u8fd9\u6b21\u4e0e\u4e0a\u6b21\u7684$C$\u7684\u5947\u6570\u6b21\u5b57\u7b26\u6570\u91cf\u4ec5\u4ec5\u5dee1\uff0c\u6240\u4ee5\u00b7\u00b7\u00b7\u201d\uff0c\u6211\u65e0\u8bed\u3002~~\u51fa\u9898\u4eba\u5361\u8fd9\u4e2a\u4ed6\u4eba\u5c31\u6ca1\u4e86~~\n\n##### $O(n):$\n\n```cpp\n#include<iostream>\n#include<ctime>\n#include<climits>\n#include<cmath>\n#include<cstring>\n#include<algorithm>\n#include<cstdio>\n#define ll long long\n#define ull unsigned long long\nusing namespace std;\nconst ll N=1100000,base1=1021831,base2=96269; \null hash1[N],hash2[N],pow1[N],pow2[N];\null ff1(ll l,ll r) {return hash1[r]-hash1[l-1]*pow1[r-l+1];}\null ff2(ll l,ll r) {return hash2[r]-hash2[l-1]*pow2[r-l+1];}\npair<ull,ull> ff(ll l,ll r) {return make_pair(ff1(l,r),ff2(l,r));}\nll n,ans,book[30],cnt,tot[N*2],num[N],sum[30];\nchar ch[N];\nint main()\n{\n    ll Q,i,last1,last2;\n    scanf(\"%lld\",&Q);\n    while(Q--)\n    {\n        memset(book,0,sizeof(book));\n        memset(tot,0,sizeof(tot));\n        memset(num,0,sizeof(num));\n        memset(sum,0,sizeof(sum));\n        cnt=ans=last1=last2=0;\n        scanf(\"%s\",ch+1);\n        n=strlen(ch+1);\n        hash1[0]=hash2[0]=0,pow1[0]=pow2[0]=1;\n        for(i=1;i<=n;i++) \n        {\n            hash1[i]=hash1[i-1]*base1+ch[i],hash2[i]=hash2[i-1]*base2+ch[i];\n            pow1[i]=pow1[i-1]*base1,pow2[i]=pow2[i-1]*base2;\n        }\n        for(i=n;i>=2;i--) \n        {\n            book[ch[i]-'a']^=1;\n            if(book[ch[i]-'a']==0) cnt--;\n            else cnt++;\n            tot[i]=cnt;\n        }\n        num[n-1]=1;\n        for(i=n-2;i>=2;i--)\n        {\n        \tif(i*2>n-1 || ff(1,i)!=ff(i+1,i*2)) {num[i]=1;continue;}\n        \tnum[i]=num[i<<1]<<1;\n        \tif(num[i]*i+i<=n-1 && ff(1,i)==ff(num[i]*i+1,num[i]*i+i)) num[i]++;\n\t\t}\n\t\tcnt=0;\n\t\tmemset(book,0,sizeof(book));\n        for(i=2;i<n;i++)\n        {\n            book[ch[i-1]-'a']^=1;\n            if(book[ch[i-1]-'a']==0) cnt--;\n            else cnt++;\n            ++sum[cnt];\n            if(cnt<=tot[i]) last1++;\n            if(cnt<=tot[(i-1)*2+1]) last2++;\n            if(tot[i]<tot[i+1]) last1+=sum[tot[i+1]];\n            else last1-=sum[tot[i]];\n            ans+=last1*((num[i]>>1)+(num[i]&1));\n            if(tot[(i-1)*2+1]<tot[i*2+1]) last2+=sum[tot[i*2+1]]+sum[tot[i*2+1]-1];\n            else if(tot[(i-1)*2+1]>tot[i*2+1]) last2-=sum[tot[i*2+1]+1]+sum[tot[i*2+1]+2];\n            ans+=last2*(num[i]>>1);\n        }\n        printf(\"%lld\\n\",ans);\n    }\n    return 0;\n}\n```\n\n\n\u8dea\u6c42\u5404\u4f4d\u8001\u7237\u4e00\u952e\u4e09\u8fde~~\u70b9\u8d5e\u4e5f\u884c~~",
        "postTime": 1608563169,
        "uid": 67839,
        "name": "\u6b22\u8bed_\u6697\u5f71",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 P7114 \u3010\u5b57\u7b26\u4e32\u5339\u914d\u3011"
    },
    {
        "content": "\u4e00\u4e2a\u7406\u8bba\u590d\u6742\u5ea6\u6bd4 $\\mathcal{O}(n(26+\\ln n))$ \u5feb\uff0c\u4f46\u662f\u5b9e\u9645\u4e0d\u5f00 O2 \u53d8\u6162\u7684\u505a\u6cd5\uff08\n\n\u9996\u5148\u4f60\u7b2c\u4e00\u773c\u80af\u5b9a\u662f\u679a\u4e3e $AB$ \u548c\u5faa\u73af\u51e0\u6b21\u662f\u5427\u3002\n\n\u7136\u540e\u8fd9\u4e2a\u53ef\u4ee5\u54c8\u5e0c + \u8c03\u548c $n \\ln n$ \u5feb\u901f\u7ef4\u62a4 \u3002\n\n\u679a\u4e3e\u5b8c\u5c31\u6709\u4e86 $C$ , \u7136\u540e\u5176\u5b9e\u662f\u6c42 $F(B $\u7684\u524d\u7f00$)<F(C)$ \u7684\u65b9\u6848\u6570\u3002\n\n\u7136\u540e\u5c31\u53d8\u6210\u4e00\u4e2a $n \\ln n$ \u6b21\u67e5\u8be2\u524d\u7f00\u548c\uff0c$n$ \u6b21\u4fee\u6539\u4e00\u4e2a\u957f\u5ea6\u4e3a $26$ \u7684\u6570\u7ec4\u3002\n\n\u666e\u901a\u524d\u7f00\u548c\u4fee\u6539\u5176\u5b9e\u5c31\u662f $\\mathcal{O}(n(26+\\ln n))$ \uff0c\u7136\u540e\u6211\u4eec\u53d1\u73b0\u4e1c\u897f\u80af\u5b9a\u4e0d\u80fd\u4e58\u5728 $\\ln n$ \u4e0a\uff0c\u5426\u5219\u65f6\u95f4\u5c31\u53d8\u5927\u4e86\u3002\u3002\u3002\n\n\u7136\u540e\u6211\u4eec\u601d\u8003\u5230\u6709\u4e2a\u4e1c\u897f\u53eb\u503c\u57df\u5206\u5757\u662f\u5427\uff0c\u5c06\u8fd9\u4e2a\u4e1c\u897f\u52a0\u4e0a\u53bb\u5c31\u53ef\u4e86\u3002\n\n\u5177\u4f53\u5c31\u662f\u6bcf\u6b21\u4fee\u6539\u5c06\u8fd9\u5757\u8fd9\u4e2a\u70b9\u540e\u9762\u7684 $+1$\uff0c\u7136\u540e\u8fd9\u4e2a\u5757\u540e\u9762\u7684\u7ed9\u5757\u7684\u6807\u8bb0 $+1$.\n\n\u67e5\u8be2\u5c31\u628a\u4e24\u4e2a\u52a0\u4e00\u4e0b\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u7136\u540e\u5c31\u662f $\\mathcal{O}(n(\\sqrt{26}+\\ln n))$\n\n\u54e6\uff0c\u8fd8\u6709\u5982\u679c\u4e0d\u5f00 O2 \u60f3\u8fc7\u7684\u8bdd\u8bb0\u5f97\u52a0 register\uff0c\u5e76\u4e14\u5c06 $AB$ \u7684\u54c8\u5e0c\u9884\u5904\u7406\u51fa\u6765\u3002\n\n```cpp\n#include<cmath>\n#include<cstdio>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#define ll int\nusing namespace std;\n#define seed 20090119\n#define F(i,j,n)for(register int i=j;i<=n;i++)\n#define D(i,j,n)for(register int i=j;i>=n;i--)\n#define mem(x,val)memset(x,val,sizeof x)\nll read(){\n\tll ans=0,f=1;\n\tchar c=getchar();\n\twhile(c<'0'||c>'9'){\n\t\tif(c=='-')f=-1;\n\t\tc=getchar();\n\t}\n\twhile(c>='0'&&c<='9')ans=ans*10+c-'0',c=getchar();\n\treturn ans*f;\n}\nconst int maxn = 2e6+5;\nchar s[maxn];\nll T,pre[maxn],suf[maxn],sumk[8],sumt[30],w[30],B,l[8],r[8],siz,t[30],n,x,ww;\nlong long ans;unsigned int hsh[maxn],po10[maxn],xx;\ninline unsigned int fashu(ll x,ll y){return hsh[y]-hsh[x-1]*po10[y-x+1];}\nint main(){\n\tT=read();siz=6;B=ceil(1.0*26/siz);F(i,1,26)w[i]=(i-1)/siz+1;\n\tF(i,1,B)l[i]=r[i-1]+1,r[i]=i*siz;r[B]=n;\n\twhile(T--){\n\t\tscanf(\"%s\",s+1);n=strlen(s+1);ans=0;suf[n+1]=0;\n\t\tmem(sumk,0);mem(sumt,0);\n\t\tmem(t,0);F(i,1,n)pre[i]=pre[i-1]+(++t[s[i]-'a']%2)*2-1;\n\t\tmem(t,0);D(i,n,1)suf[i]=suf[i+1]+(++t[s[i]-'a']%2)*2-1;\n\t\tF(i,1,n)hsh[i]=hsh[i-1]*seed+s[i]-'a'+1;\n\t\tpo10[0]=1;F(i,1,n)po10[i]=po10[i-1]*seed;\n\t\tmem(t,0);\n\t\tF(i,1,n){\n\t\t\txx=fashu(1,i);\n\t\t\tF(j,1,(n-1)/i){\n\t\t\t\tif(xx!=fashu((j-1)*i+1,i*j))break;\n\t\t\t\tans+=t[suf[i*j+1]];\n\t\t\t}\n\t\t\tF(j,pre[i],26)t[j]++;\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1624338269,
        "uid": 359952,
        "name": "_lbw_",
        "ccfLevel": 6,
        "title": "P7114\u9898\u89e3"
    },
    {
        "content": "## \u89e3\u6790\n\n\u5c06 $AB$ \u89c6\u4e3a\u4e00\u4e2a\u4e32 $T$\u3002\u8003\u8651\u4e00\u79cd\u6700\u66b4\u529b\u7684\u505a\u6cd5\uff0c\u679a\u4e3e $T$\uff0c\u518d\u679a\u4e3e $T$ \u91cd\u590d\u7684\u6b21\u6570 $i$\uff0c\u518d\u679a\u4e3e $A$ \u4e32\n\n\u89c4\u5b9a\u4e32 $s$ \u5947\u6570\u6b21\u51fa\u73b0\u7684\u5b57\u7b26\u6570\u4e3a $cnt(s)$\uff08\u5373\u9898\u9762\u4e2d\u7684 $F(s)$\uff09\n\n\u89c2\u5bdf\u53ef\u4ee5\u53d1\u73b0\uff0c\u5947\u6570 $i$ \u548c\u5076\u6570 $i$ \u5404\u81ea\u5bf9\u5e94\u7684 $C$ \u4e32\u7684 $cnt(C)$ \u90fd\u662f\u4e00\u6837\u7684\uff0c\u540e\u8005\u5176\u5b9e\u8fd8\u662f\u6574\u4e2a\u4e32\u7684 $cnt(.)$\u3002\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u8ba1\u7b97 $T$ \u91cd\u590d\u4e00\u6b21\u548c\u4e24\u6b21\uff08\u5982\u679c\u5b58\u5728\uff09\u65f6\u7684\u8d21\u732e\uff0c\u518d\u6839\u636e $T$ \u6700\u591a\u80fd\u91cd\u590d\u7684\u6b21\u6570\uff0c\u5c31\u80fd\u7acb\u5373\u5f97\u5230 $T$ \u7684\u8d21\u732e\n\n\u8fd9\u6837\u5173\u4e8e $T$\uff08\u6216\u8005\u8ba4\u4e3a\u662f $C$\uff09\u7684\u679a\u4e3e\u6b21\u6570\u5c31\u4e3a $\\Theta(n)$ \u7684\u4e86\uff0c\u6211\u4eec\u8fd8\u9700\u8003\u8651\u4f18\u5316\u679a\u4e3e $i$ \u548c\u679a\u4e3e $A$ \u90e8\u5206\u7684\u590d\u6742\u5ea6\n\n\u8003\u8651\u8ba1\u7b97\u51fa $S$ \u7684 `z[.]`\uff0c\u5177\u4f53\u5373 `z[i]` \u8868\u793a\u6700\u5927\u7684 $l$ \u6ee1\u8db3 $S[0..(l-1)]=S[i..(i+l-1)]$\u3002\u5bf9\u4e8e\u524d\u7f00 $T_i=S[0..i]$\uff0c\u5bb9\u6613\u8bc1\u660e $S[0..(i+\\texttt{z[}i+1\\texttt{]})]$ \u662f $(T_i)^k$ \u7684\u524d\u7f00\uff08\u7531\u9519\u4f4d\u76f8\u7b49\uff09\uff0c\u5176\u4e2d $k$ \u662f\u4efb\u610f\u5927\u7684\u6b63\u6574\u6570\uff1b\u8fd9\u5373\u4ee3\u8868 $T_i$ \u6700\u5927\u7684\u91cd\u590d\u6b21\u6570\u4e3a $\\lfloor\\frac {(i+\\texttt{z[}i+1\\texttt{]})+1} {|T_i|}\\rfloor$\uff08\u53e6\u5916\u4e3a\u4e86\u907f\u514d $C$ \u4e32\u4e3a\u7a7a\uff0c\u5206\u6bcd\u8fd8\u8981\u548c $(n-1)$ \u53d6\u4e2a $\\min$\uff09\u3002\u8fd9\u6837\u679a\u4e3e $i$ \u90e8\u5206\u7684\u590d\u6742\u5ea6\u4f18\u5316\u5230\u4e86 $\\Theta(n)$\n\n\u5bf9\u4e8e\u6bcf\u79cd $C_i=S[(i+1)..(n-1)]$ \u7684\u67e5\u8be2\uff0c\u76f8\u5f53\u4e8e\u8be2\u95ee $A_i=S[0..i], i\\in [0, i-1]$ \u4e2d\u6709\u591a\u5c11\u4e2a $A_i$ \u6ee1\u8db3 $cnt(A_i)\\leq cnt(C_i)$\u3002\u8fd9\u663e\u7136\u53ef\u4ee5\u7528\u6570\u636e\u7ed3\u6784\u6216\u76f4\u63a5\u5f00\u6876\u7ef4\u62a4\uff0c\u5355\u6b21\u8be2\u95ee\u590d\u6742\u5ea6\u5206\u522b\u4e3a $\\Theta(\\log |\\Sigma|)$ \u548c $\\Theta(|\\Sigma|)$\u3002\u8fd9\u6837\u679a\u4e3e $A$ \u90e8\u5206\u7684\u590d\u6742\u5ea6\u4f18\u5316\u5230\u4e86 $O(n\\log |\\Sigma|)$ \u6216 $\\Theta(n|\\Sigma|)$\uff0c\u524d\u8005\u5176\u5b9e\u5df2\u7ecf\u8db3\u591f\u901a\u8fc7\u6b64\u9898\n\n\u4f46\u6211\u4eec\u8fd8\u53ef\u4ee5\u53d1\u73b0\u679a\u4e3e $i$ \u65f6\uff0c$cnt(C_i)$ \u7684\u53d8\u5316\u4e0d\u4f1a\u8d85\u8fc7 $1$\uff0c\u5373\u8be2\u95ee\u7684\u503c\u7684\u53d8\u5316\u4e0d\u4f1a\u8d85\u8fc7 $1$\u3002\u4e8e\u662f\u53ef\u4ee5\u8003\u8651\u76f4\u63a5\u7c7b\u4f3c\u6876\u4e0a\u6307\u9488\u7684\u65b9\u6cd5\u7ef4\u62a4\u5373\u53ef\u3002\u8fd9\u6837\u679a\u4e3e $A$ \u90e8\u5206\u7684\u590d\u6742\u5ea6\u5c31\u4f18\u5316\u5230\u4e86 $\\Theta(n)$\uff0c\u603b\u590d\u6742\u5ea6\u4e5f\u505a\u5230\u4e86 $\\Theta(n)$\n\n## CODE\n\n```cpp\n#include <cstdio>\n#include <vector>\nusing std::vector;\nusing std::min;\n\nconst int MAXN =(1<<20)+20, MAXV ='z'-'a'+1;\n\n/*------------------------------IO------------------------------*/\n\nint read(){\n\tint x =0; char c =getchar(); bool f =0;\n\twhile(c < '0' || c > '9') (c == '-') ? f =1, c =getchar() : c =getchar();\n\twhile(c >= '0' && c <= '9') x =(x<<1)+(x<<3)+(48^c), c =getchar();\n\treturn (f) ? -x : x;\n}\n\nstruct string{\n\tchar data[MAXN];\n\tint len;\n\t\n\tint size() const{\n\t\treturn len;\n\t}\n\t\n\tchar & operator [] (const int &index){\n\t\treturn data[index];\n\t}\n\tchar operator [] (const int &index) const{\n\t\treturn data[index];\n\t}\n};\n\nvoid read_string(string &s){\n\t#define CHECK (\\\n\t\t(ch >= 'a' && ch <= 'z')\\\n\t)\n\tchar ch =getchar();\n\twhile(!CHECK)\n\t\tch =getchar();\n\ts.len =0;\n\twhile(CHECK)\n\t\ts[s.len++] =ch, ch =getchar();\n\t#undef CHECK\n}\n\n/*------------------------------Z-Algorithm------------------------------*/\n\nvector<int> z_algorithm(const string &s1, const string &s2, const vector<int> &z_s2_init =vector<int>(1, -1)){\n\tconst int n1 =s1.size(), n2 =s2.size();\n\tvector<int> z(n1, 0);\n\tconst vector<int> &z_s2 =(z_s2_init[0] != -1) ? z_s2_init : z;\n\twhile(z[0] < n2 && s1[z[0]] == s2[z[0]])\n\t\t++z[0];\n\tfor(int i =1, l =0, r =0; i < n1; ++i){\n\t\tif(i < r)\n\t\t\tz[i] =min(r-i, z_s2[i-l]);\n\t\twhile(z[i] < n2 && i+z[i] < n1 && s1[i+z[i]] == s2[z[i]])\n\t\t\t++z[i];\n\t\tif(r < i+z[i])\n\t\t\tl =i, r =i+z[i];\n\t}\n\treturn z;\n}\n\n/*------------------------------Main------------------------------*/\n\nint main(){\n\tstring s;\n\tfor(int tt =0, T =read(); tt < T; ++tt){\n\t\tread_string(s);\n\t\tvector<int> z =z_algorithm(s, s);\n\t\tconst int n =s.size();\n\t\t\n\t\tint cnt_all =0;\n\t\tvector<int> ch_pre(MAXV, 0), ch_suf(MAXV, 0);\n\t\tvector<int> sum_cnt_pre(MAXV+1, 0);\n\t\tint cnt_pre =0, cnt_suf =cnt_all;\n\t\tint ctrb_suf_0 =0, ctrb_suf_1 =0;\n\t\t/**\n\t\t *  cnt_all: \u6574\u4e2a\u4e32\u7684\u5947\u6570\u6b21\u51fa\u73b0\u7684\u5b57\u7b26\u6570 //\n\t\t *  ch_pre: \u5f53\u524d\u7684\u524d\u7f00\u7684\u5404\u5b57\u7b26\u51fa\u73b0\u6b21\u6570\u7684\u5947\u5076\u6027 //\n\t\t *  ch_suf: \u5f53\u524d\u7684\u540e\u7f00\u7684\u5404\u5b57\u7b26\u51fa\u73b0\u6b21\u6570\u7684\u5947\u5076\u6027 //\n\t\t *  sum_cnt_pre: \u8bbe\u5947\u6570\u6b21\u51fa\u73b0\u7684\u5b57\u7b26\u6570\u4e3a x \u7684\u4e32\u7684\u7c7b\u578b\u4e3a x //\n\t\t *\t\t\t\t \u50a8\u5b58\u7edf\u8ba1\u8fc7\u7684\u6bcf\u79cd\u7c7b\u578b\u7684\u524d\u7f00\u7684\u51fa\u73b0\u6b21\u6570 //\n\t\t *  cnt_pre: \u5f53\u524d\u524d\u7f00\u7684\u5947\u6570\u6b21\u51fa\u73b0\u7684\u5b57\u7b26\u6570 //\n\t\t *  cnt_suf: \u5f53\u524d\u540e\u7f00\u7684\u5947\u6570\u6b21\u51fa\u73b0\u7684\u5b57\u7b26\u6570 //\n\t\t *  ctrb_suf_0: \u5f53\u524d\u540e\u7f00 (C) \u548c S \u7ec4\u6210\u65b9\u6848\uff0cS \u51fa\u73b0\u5947\u6570\u6b21\uff0c\u6bcf\u79cd C \u7684\u65b9\u6848\u6570 //\n\t\t *  ctrb_suf_1: \u5f53\u524d\u540e\u7f00 (C) \u548c S \u7ec4\u6210\u65b9\u6848\uff0cS \u51fa\u73b0\u5076\u6570\u6b21\uff0c\u6bcf\u79cd C \u7684\u65b9\u6848\u6570 //\n\t\t**/\n\t\tfor(int i =0; i < n; ++i)\n\t\t\tcnt_all +=((ch_suf[s[i]-'a'] ^=1) ? 1 : -1);\n\t\tcnt_suf =cnt_all;\n\t\tauto mov =[&](const char &ch, const char &typ){\n\t\t\tint &cnt_ =(typ == 'p') ? cnt_pre : cnt_suf;\n\t\t\tvector<int> &ch_ =(typ == 'p') ? ch_pre : ch_suf;\n\t\t\t\n\t\t\tconst bool Flg =(ch_[ch-'a'] ^=1);\n\t\t\tcnt_ +=(Flg ? 1 : -1);\n\t\t\t\n\t\t\tif(typ == 'p'){\n\t\t\t\t++sum_cnt_pre[cnt_];\n\t\t\t\tif(cnt_ <= cnt_suf)\n\t\t\t\t\t++ctrb_suf_0;\n\t\t\t\tif(cnt_ <= cnt_all)\n\t\t\t\t\t++ctrb_suf_1;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(Flg)\n\t\t\t\t\tctrb_suf_0 +=sum_cnt_pre[cnt_];\n\t\t\t\telse\n\t\t\t\t\tctrb_suf_0 -=sum_cnt_pre[cnt_+1];\n\t\t\t}\n\t\t};\n\t\t\n\t\tlong long ans =0;\n\t\tauto div_floor =[&](const int &a, const int &b){\n\t\t\treturn a/b;\n\t\t};\n\t\tauto div_ceil =[&](const int &a, const int &b){\n\t\t\treturn a/b+(a%b);\n\t\t};\n\t\tfor(int i =0; i < n-1; ++i){\n\t\t\tmov(s[i], 's');\n\t\t\tconst int rep =min(n-1, (i+1)+z[i+1])/(i+1);\n\t\t\tans +=1ll*div_ceil(rep, 2)*ctrb_suf_0+1ll*div_floor(rep, 2)*ctrb_suf_1;\n\t\t\tmov(s[i], 'p');\n\t\t\t/* ^- \u5411\u524d\u7f00\u6dfb\u52a0\u5b57\u7b26\u653e\u5728\u8ba1\u7b97\u8d21\u732e\u7684\u540e\u9762\u662f\u56e0\u4e3a B \u4e0d\u80fd\u4e3a\u7a7a */\n\t\t}\n\t\tprintf(\"%lld\\n\", ans);\n\t}\n}\n```",
        "postTime": 1611476929,
        "uid": 105254,
        "name": "Piwry",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 P7114 \u3010[NOIP2020] \u5b57\u7b26\u4e32\u5339\u914d\u3011"
    },
    {
        "content": "\u9996\u5148\u60f3\u8981\u628a\u8fd9\u9898 A \u6389\u662f\u5f88\u5bb9\u6613\u7684\uff0c\u6211\u4eec\u73b0\u5728\u8ffd\u6c42\u7ebf\u6027\u505a\u6cd5\u3002\n\n\u4e00\u4e2a\u5f88\u81ea\u7136\u7684\u60f3\u6cd5\u662f\u679a\u4e3e $AB$ \u4ee5\u53ca\u5f53\u524d $AB$ \u6240\u5bf9\u5e94\u7684 $i$\u3002\u8fd9\u663e\u7136\u662f\u4e00\u4e2a\u8c03\u548c\u7ea7\u6570\u590d\u6742\u5ea6\uff0c\u81f3\u4e8e\u5982\u4f55\u5224\u65ad\u5bf9\u4e8e\u67d0\u4e2a\u524d\u7f00\uff0c\u5b83\u662f\u5426\u53ef\u4ee5\u5206\u6210 $i$ \u4e2a\u76f8\u7b49\u7684\u6bb5\u5373 $AB$\uff0c\u8fd9\u4e2a\u54c8\u5e0c / Z / KMP \u90fd\u53ef\u4ee5\uff0cZ \u6211\u6700\u719f\u6089\u5c31\u5199\u5b83\u4e86\u3002\u8fd9\u91cc\u8bf4\u4e00\u4e0b KMP\uff0c\u82e5 $kmp_i\\mid i$ \u5219 $i-kmp_i$ \u662f\u6700\u5c0f\u5faa\u73af\u8282\uff0c\u5224\u4e00\u4e0b\u6574\u9664\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u7136\u540e\u95ee\u9898\u662f\u5bf9\u4e8e\u4e00\u4e2a $AB$ \u548c $C$ \u5982\u4f55\u6c42\u51fa\u6ee1\u8db3 $F(A)\\leq F(C)$ \u7684\u5c06 $AB$ \u4e00\u5200\u4e24\u65ad\u7684\u65b9\u6848\u6570\uff1f\u6211\u4eec\u8003\u8651\u9884\u5904\u7406\u51fa\u524d\u540e\u7f00 $F$ \u503c\uff0c\u5bb9\u6613\u7ebf\u6027\u3002\u7136\u540e\u5728 $AB$ \u957f\u5ea6\u9012\u589e\u7684\u540c\u65f6\uff0c\u4e00\u8fb9\u63a8\u4e00\u8fb9\u628a\u65b0\u7684 $A$ \u7684 $F$ \u503c\u6254\u5230\u524d\u7f00\u548c\u6876\u91cc\uff08\u5927\u5c0f\u4e3a $26$\uff09\uff0c\u7136\u540e\u5bf9 $F(C)$ \u67e5\u503c\u5373\u53ef\u3002[\u8fd9](https://www.luogu.com.cn/paste/kyxx80uo)\u662f\u6211\u7684\u8003\u573a\u4ee3\u7801\u3002\n\n\u90a3\u4e48\u8fd9\u6837\u662f $\\mathrm O\\!\\left(Tn(26+\\log n)\\right)$\uff0c\u7a0d\u5361\u5e38\u53ef\u4ee5\u8fc7\u3002\u79bb\u7ebf\u6027\u7684\u8ddd\u79bb\u5728\u4e8e $26$ \u548c $\\log$\uff0c\u6211\u4eec\u8981\u628a\u5b83\u4eec\u90fd\u53bb\u6389\u3002\u63a5\u4e0b\u6765\u6765\u627e\u6027\u8d28\u3002\n\n\u6ce8\u610f\u5230\uff0c$(AB)^x$ \u548c $(AB)^{x+2}$ \u7684 $F$ \u503c\u662f\u4e00\u6837\u7684\uff0c\u90a3\u4e48\u5b83\u4eec\u5bf9\u5e94\u7684 $C$ \u7684 $F$ \u503c\u663e\u7136\u4e5f\u662f\u4e00\u6837\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\u5bf9\u4e8e\u6bcf\u8f6e\u679a\u4e3e\u7684 $AB$\uff0c$i$ \u7684\u8d21\u732e\u4ec5\u5206\u4e3a\u4e24\u79cd\uff0c\u7b97\u4e00\u4e0b\u8ba1\u91cf\u6570\u7136\u540e\u5bf9\u4e8e\u6bcf\u79cd\u5355\u72ec\u7b97\u5373\u53ef\uff0c\u81f3\u6b64\u53bb\u6389\u4e86\u8c03\u548c\u7ea7\u6570\u7684 $\\log$\u3002\n\n\u63a5\u4e0b\u6765\u53d1\u73b0\uff0c\u76f8\u90bb\u4e24\u6b21\u679a\u4e3e\u7684\u957f\u5ea6\u76f8\u5dee $1$ \u7684 $AB$\uff0c\u5b83\u4eec\u7684 $F$ \u503c\u7684\u5dee\u662f\u5e38\u6570\u7ea7\u522b\u3002\u7136\u540e $(AB)^2$ \u4e5f\u540c\u7406\u3002\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u653e\u5f03\u7ef4\u62a4\u524d\u7f00\u548c\u6876\uff0c\u76f4\u63a5\u7ef4\u62a4\u6876\uff0c\u7136\u540e\u653e\u4e2a\u6307\u9488\u5728\u91cc\u9762\u6e38\u8d70\uff0c\u8fd9\u6837\u6bcf\u6b21 $AB$ \u66f4\u65b0\u7684\u590d\u6742\u5ea6\u662f\u5e38\u6570\u3002\u4e5f\u5c31\u6210\u529f\u7ebf\u6027\u4e86\u3002\n\n**_[code](https://www.luogu.com.cn/paste/yscef5tx)_**\uff08\u5728\u539f\u6765\u4ee3\u7801\u4e0a\u9b54\u6539\u7684\uff09",
        "postTime": 1608204617,
        "uid": 138400,
        "name": "chenxia25",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 P7114 \u3010\u5b57\u7b26\u4e32\u5339\u914d\u3011"
    }
]