[
    {
        "content": "\u7ea6\u5b9a\uff1a\u4e3a\u65b9\u4fbf\u63cf\u8ff0\uff0c\u5c06 \u201c\u548c\u4e3a $2$ \u7684\u884c\u201d\u7b80\u79f0\u4e3a $2$ \u7c7b\u884c\uff0c\u201c\u548c\u4e3a $1$ \u7684\u884c\u201d\u7b80\u79f0\u4e3a $1$ \u7c7b\u884c\uff0c\u5217\u540c\u7406\u3002\n\n\u8bbe\u6709 $c_1$ \u4e2a $1$ \u7c7b\u884c\uff0c$c_2$ \u4e2a $2$ \u7c7b\u884c\uff0c$c_3$ \u4e2a $1$ \u7c7b\u5217\uff0c $c_4$ \u4e2a $2$ \u7c7b\u5217\u3002\n\n# \u57fa\u672c\u5206\u6790\n\n\u6211\u4eec\u53ef\u4ee5\u56fa\u5b9a\u6bcf\u884c\u7684\u548c\u4e3a $R_i$\uff0c\u5c06 $R_i$ \u62c6\u5f00\u653e\u5728\u884c\u4e2d\u7684\u4e0d\u540c\u4f4d\u7f6e\uff0c\u6765\u6ee1\u8db3\u6bcf\u5217\u7684\u548c\u4e3a $C_i$ \u7684\u8981\u6c42\u3002\n\n\u56e0\u4e3a $0\\leq R_i,C_i \\leq 2$\uff0c\u5bb9\u6613\u60f3\u5230\u4f7f\u7528\u52a8\u6001\u89c4\u5212\u3002\n\n# \u5177\u4f53\u5b9e\u73b0\n\n#### \u72b6\u6001\n\n\u8bbe $f_{i,j,k,l}$ \u8868\u793a\u8fd8\u5269\u4e0b $i$ \u4e2a $1$ \u7c7b\u884c\u548c $j$ \u4e2a $2$ \u7c7b\u884c\uff0c\u6765\u6ee1\u8db3 $k$ \u4e2a $1$ \u7c7b\u5217\u548c $l$ \u4e2a $2$ \u7c7b\u5217\u7684\u65b9\u6848\u6570\u3002\n\n\u663e\u7136\uff0c\u82e5 $i+2\\times j \\ne k+2\\times l$\uff0c\u80af\u5b9a\u65e0\u89e3\uff0c\u6240\u4ee5\u6240\u6709\u7684 $(i,j,k,l)$ \u4e00\u5b9a\u6ee1\u8db3 $i+2\\times j = k+2\\times l$\u3002\n\n#### \u8f6c\u79fb\n\n\u5bf9\u4e8e\u6240\u6709\u7684 $1$ \u7c7b\u884c\uff0c\u6211\u4eec\u653e\u5230\u6700\u540e\u6765\u8003\u8651\u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $2$ \u7c7b\u884c\uff0c\u5b83\u6709\u8fd9\u56db\u79cd\u8f6c\u79fb\uff1a\n\n- \u62c6\u6210 $1+1$ \u6765\u6ee1\u8db3\u4e24\u4e2a $1$ \u7c7b\u5217\uff0c\u65b9\u6848\u6570\u4e3a $f_{i,j-1,k-2,l}\\times \\binom{k}{2}$\u3002\n\n- \u62c6\u6210 $1+1$ \u6765\u6ee1\u8db3\u4e00\u4e2a $1$ \u7c7b\u5217\uff0c\u5e76\u5c06\u4e00\u4e2a $2$ \u7c7b\u5217\u53d8\u6210 $1$ \u7c7b\u5217\uff0c\u65b9\u6848\u6570\u4e3a $f_{i,j-1,k,l-1}\\times k\\times l$\u3002\n\n- \u62c6\u6210 $1+1$ \u5c06\u4e24\u4e2a $2$ \u7c7b\u5217\u53d8\u6210 $1$ \u7c7b\u5217\uff0c\u65b9\u6848\u6570\u4e3a $f_{i,j-1,k,l-2}\\times \\binom{l}{2}$\u3002\n\n- \u6ee1\u8db3\u4e00\u4e2a $2$ \u7c7b\u5217\uff0c\u65b9\u6848\u6570\u4e3a $f_{i,j-1,k,l-1}\\times l$\u3002\n\n#### \u8fb9\u754c\u6761\u4ef6\n\n$j=0$ \u65f6\uff0c\u5269\u4e0b $i$ \u4e2a $1$ \u7c7b\u884c\uff0c\u6ee1\u8db3 $k$ \u4e2a $1$ \u7c7b\u5217\u548c $l$ \u4e2a $2$ \u7c7b\u5217\u3002\n\n\u5373 $f_{i,0,k,l}=\\binom{k}{1}\\binom{k-1}{1}\\dots\\binom{2\\times l+1}{1}\\binom{2\\times l}{2}\\binom{2\\times l-2}{2}\\dots\\binom{2}{2}=\\frac{k!}{2^l}$\u3002\n\n#### \u65f6\u95f4\u590d\u6742\u5ea6\n\n\u72b6\u6001\u6570\u4e3a $O(n^4)$\uff0c\u8f6c\u79fb $O(1)$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^4)$\uff0c\u65e0\u6cd5\u901a\u8fc7\u3002\n\n## \u4f18\u5316\u72b6\u6001\u6570\n\n\u6240\u6709\u72b6\u6001\u7684\u7b2c\u4e00\u7ef4 $i$ \u5747\u662f\u4e0d\u53d8\u7684\uff0c\u53ef\u4ee5\u7701\u6389\u8fd9\u4e00\u7ef4\u3002\n\n\u4e8e\u662f\u73b0\u5728\u7684\u72b6\u6001 $f_{j,k,l}$ \u8868\u793a\u8fd8\u5269\u4e0b $c_1$ \u4e2a $1$ \u7c7b\u884c\u548c $j$ \u4e2a $2$ \u7c7b\u884c\uff0c\u6765\u6ee1\u8db3 $k$ \u4e2a $1$ \u7c7b\u5217\u548c $l$ \u4e2a $2$ \u7c7b\u5217\u7684\u65b9\u6848\u6570\u3002\n\n\u8fd8\u8bb0\u5f97\u5728\u8fd9\u7bc7\u9898\u89e3\u6700\u5f00\u59cb\u63d0\u5230\u7684\u90a3\u4e2a\u7b49\u5f0f\u5417\uff1a $i+2\\times j = k+2\\times l$\u3002\n\n\u6240\u4ee5 $k$ \u53ef\u4ee5\u8868\u793a\u4e3a $i+2\\times j -2\\times l$\u3002\n\n\u90a3\u4e48\u73b0\u5728\u7684\u72b6\u6001\u5373 $f_{j,l}$ \u8868\u793a\u8fd8\u5269\u4e0b $c_1$ \u4e2a $1$ \u7c7b\u884c\u548c $j$ \u4e2a $2$ \u7c7b\u884c\uff0c\u6765\u6ee1\u8db3 $c_1+2\\times j -2\\times l$ \u4e2a $1$ \u7c7b\u5217\u548c $l$ \u4e2a $2$ \u7c7b\u5217\u7684\u65b9\u6848\u6570\u3002\n\n#### \u8f6c\u79fb\n\n\u8bbe $k=i+2\\times j -2\\times l$\u3002\n\n\u4e8e\u662f $f_{j,l}=f_{j-1,l}\\times \\binom{k}{2} + f_{j-1,l-1}\\times k\\times l+ f_{j-1,l-2}\\times \\binom{l}{2} + f_{j-1,l-1}\\times l $\u3002\n\n#### \u8fb9\u754c\u6761\u4ef6\n\n$f_{0,l}=\\frac{c_1!}{2^l}$\u3002\n\n#### \u65f6\u95f4\u590d\u6742\u5ea6\n\n\u72b6\u6001\u6570\u4e3a $O(n^2)$\uff0c\u8f6c\u79fb $O(1)$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n^2)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n# \u4ee3\u7801\uff08\u8bf7\u52ff\u6284\u88ad\uff09\n\n```cpp\n#include<bits/stdc++.h>\n#define mod 998244353\n#define int long long\nusing namespace std;\nnamespace Binom//\u7ec4\u5408\u6570\u677f\u5b50 \n{\n\t#define N 50005//\u6ce8\u610f\u9884\u5904\u7406\u9700\u8981\u5904\u74062\u500dn\u957f\u5ea6 \n\tint st[N],qp[N];\n\tint qpow(int x,int n)\n\t{\n\t\tif(x<0) return 0;\n\t\tif(!n) return 1;\n\t\tint t=qpow(x,n/2);\n\t\tif(n&1) return t*t%mod*x%mod;\n\t\treturn t*t%mod;\n\t}\n\tvoid C_init()\n\t{\n\t\tst[0]=1;\n\t\tfor(int i=1;i<N;i++) st[i]=st[i-1]*i%mod;\n\t\tqp[N-1]=qpow(st[N-1],mod-2);\n\t\tfor(int i=N-2;i>=0;i--) qp[i]=qp[i+1]*(i+1)%mod;\n\t}\n\tint C(int n,int m)\n\t{\n\t\tif(n<0||m<0||m>n) return 0;\n\t\treturn st[n]*qp[n-m]%mod*qp[m]%mod;\n\t}\n\tint A(int n,int m)\n\t{\n\t\tif(n<0||m<0||m>n) return 0;\n\t\treturn st[n]*qp[n-m]%mod;\n\t}\n\t#undef N \n}\nusing namespace Binom;\n#define N 5005\nint n,r[N],c[N],f[N][N];\nvoid add(int &x,int y){x=(x+y)%mod;}\nsigned main()\n{\n\tC_init();\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&r[i]);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&c[i]);\n\tint c1=0,c2=0,c3=0,c4=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tif(r[i]==1) c1++;\n\t\tif(r[i]==2) c2++;\n\t\tif(c[i]==1) c3++;\n\t\tif(c[i]==2) c4++;\n\t}\n\tif(c1+c2*2!=c3+c4*2) return puts(\"0\"),0;\n\tfor(int i=0;i<=c4;i++) f[0][i]=st[c1]*qpow(qpow(2,i),mod-2)%mod;//\u8fb9\u754c\u6761\u4ef6 \n\tfor(int j=1;j<=c2;j++)\n\t\tfor(int l=0;l<=c4;l++)//\u8f6c\u79fb \n\t\t{\n\t\t\tint k=c1+2*j-2*l;\n\t\t\tif(k>=2) add(f[j][l],f[j-1][l]*C(k,2)%mod);//\u62c61+1\u7ed91+1\n\t\t\tif(l&&k) add(f[j][l],f[j-1][l-1]*k%mod*l%mod);//\u62c61+1\u7ed91+2 \n\t\t\tif(l>=2) add(f[j][l],f[j-1][l-2]*C(l,2)%mod);//\u62c61+1\u7ed92+2 \n\t\t\tif(l) add(f[j][l],f[j-1][l-1]*l%mod);//\u7ed92 \n\t\t}\n\tprintf(\"%lld\",f[c2][c4]);\n\treturn 0;\n}\n```\n",
        "postTime": 1675945753,
        "uid": 447493,
        "name": "bugmaker3243",
        "ccfLevel": 5,
        "title": "[ABC273G] Row Column Sums 2 \u9898\u89e3"
    },
    {
        "content": "## \u601d\u8def\n\n\u6570\u4e00\u4e0b\u8bfb\u5165\u7684\u91cc\u9762\uff0c\u884c\u4e0a\u6709 $cnt_1$ \u4e2a $1$\uff0c\u884c\u4e0a\u6709 $cnt_2$ \u4e2a $2$\uff0c\u5217\u4e0a\u6709 $cnt_3$ \u4e2a $1$\uff0c\u5217\u4e0a\u6709 $cnt_4$ \u4e2a $2$ \u7684\u7b54\u6848\u3002\n\n\u5f53\u4e14\u4ec5\u5f53 \n\n$$\ncnt_1+2\\times cnt_2\\neq cnt_3+2\\times cnt_4\n$$\n\n\u65e0\u89e3\u3002\n\n-----------------\n\n\u8bbe $f(i,j,k,l)$ \u4e3a\u884c\u4e0a\u6709 $i$ \u4e2a $1$\uff0c\u884c\u4e0a\u6709 $j$ \u4e2a $2$\uff0c\u5217\u4e0a\u6709 $k$ \u4e2a $1$\uff0c\u5217\u4e0a\u6709 $l$ \u4e2a $2$ \u7684\u7b54\u6848\u3002\n\n\u8003\u8651\u8f6c\u79fb\u3002\n\n- \u5f53 $l>0$ \u65f6\uff1a\u6ce8\u610f\u6709 $i+2\\times j=k+l\\times 2$ \u6210\u7acb\uff01\n\n\u8003\u8651\u5206\u914d\u4e00\u4e2a \u5217\u4e0a\u4e3a $2$ \u7684\u4e1c\u897f\uff1a\n\n- \u7ed9\u884c\u4e0a\u7684\u4e00\u4e2a $1$ \u548c\u4e00\u4e2a $2$\uff1a$f(i-1+1,j-1,k,l-1)\\times i\\times j$\u3002\uff08\u5c31\u662f\u90a3\u4e2a $1$ \u6ca1\u4e86\uff0c$2$ \u53d8\u6210 $1$ \u4e86\uff09\n- \u7ed9\u884c\u4e0a\u7684\u4e24\u4e2a $1$\uff1a$f(i-2,j,k,l-1)\\times C_i^2$\u3002\n- \u7ed9\u884c\u4e0a\u7684\u4e24\u4e2a $2$\uff1a$f(i+2,j-2,k,l-1)\\times C_j^2$\u3002\n- \u7ed9\u884c\u4e0a\u7684\u4e00\u4e2a $2$\uff1a$f(i,j-1,k,l-1)\\times j$\u3002\n\n\u5f53 $l=0$ \u65f6\uff1a\u6ce8\u610f\u6709 $i+2\\times j=k$ \u6210\u7acb\uff01\uff08\u8fd9\u70b9\u5bf9\u4e8e\u7406\u89e3\u4e0b\u9762\u7684\u5f0f\u5b50\u5f88\u91cd\u8981\uff09\n\n\u7b54\u6848\u5c31\u662f\n$$\nC_k^1\\times C_{k-1}^1\\times \\cdots\\times C_{2\\times j+1}^1\\times C_{2\\times j}^2\\times C_{2\\times(j-1)}^2\\times\\cdots\\times C_2^2\n$$\n\n$$\n=\\frac{k!}{2^j}\n$$\n\n---------------\n\n\u6ce8\u610f\u5230\u5728\u8f6c\u79fb\u7684\u8fc7\u7a0b\u4e2d $k$ \u59cb\u7ec8\u4e0d\u53d8\uff0c\u5c31\u662f $cnt_3$\u3002\n\n\u53e6\u5916\u56e0\u4e3a\u59cb\u7ec8\u6709\u90a3\u4e2a\u7b49\u5f0f\u6210\u7acb\uff08\u4e0d\u6210\u7acb\u5c31\u65e0\u89e3\u4e86\uff09\uff0c\u6240\u4ee5\u5f97\u5230 $i,j,l$ \u4e2d\u7684\u4e24\u4e2a\u5c31\u80fd\u7b97\u51fa\u53e6\u4e00\u4e2a\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u5427\u5176\u4e2d\u7684\u4e24\u4e2a\u4f5c\u4e3a\u6570\u7ec4\u4e0b\u6807\u5b58\u7740\u3002\n\n\u590d\u6742\u5ea6 $\\mathcal{O}(n^2)$\u3002\n\n## code\n\n```cpp\n#include<stdio.h>\n#include<string.h>\n#define mod 998244353\ninline char nc()\n{\n \tstatic char buf[99999],*l,*r;\n\treturn l==r&&(r=(l=buf)+fread(buf,1,99999,stdin),l==r)?EOF:*l++;\n}\ninline void read(int&x)\n{\n\tchar c=nc();for(;c<'0'||'9'<c;c=nc());\n\tfor(x=0;'0'<=c&&c<='9';x=(x<<3)+(x<<1)+(c^48),c=nc());\n}\nint n,a,cnt1,cnt2,cnt3,cnt4,ans[5001][5001],fac[5001];\ninline long long ksm(long long a,int b)\n{\n\tlong long ans=1;\n\tfor(;b;b>>=1,a*=a,a%=mod)if(b&1)ans*=a,ans%=mod;\n\treturn ans;\n}\ninline long long dfs(const int&i,const int&j,const int&k,const int&l)\n{\n\tif(!l)return fac[k]*ksm(ksm(2,j),mod-2)%mod;\n\tif(~ans[i][l])return ans[i][l];\n\tans[i][l]=0;\n\tif(i&&j)ans[i][l]=(ans[i][l]+dfs(i,j-1,k,l-1)*i%mod*j)%mod;\n\tif(i>1)ans[i][l]=(ans[i][l]+dfs(i-2,j,k,l-1)*(i*(i-1ll)>>1))%mod;\n\tif(j>1)ans[i][l]=(ans[i][l]+dfs(i+2,j-2,k,l-1)*(j*(j-1ll)>>1))%mod;\n\tif(j)ans[i][l]=(ans[i][l]+dfs(i,j-1,k,l-1)*j)%mod;\n\treturn ans[i][l];\n}\nmain()\n{\n\tfac[0]=1;for(int i=1;i<5001;fac[i]=(long long)(fac[i-1])*i%mod,++i);\n\tmemset(ans,-1,sizeof(ans));read(n);\n\tfor(int i=n;i--;read(a),a==1&&++cnt1,a==2&&++cnt2);\n\tfor(int i=n;i--;read(a),a==1&&++cnt3,a==2&&++cnt4);\n\tif(cnt1+cnt2+cnt2^cnt3+cnt4+cnt4){putchar('0');return 0;}\n\tprintf(\"%lld\",dfs(cnt1,cnt2,cnt3,cnt4));\n}\n```",
        "postTime": 1666358983,
        "uid": 90693,
        "name": "_\u2022\u0301\u3078\u2022\u0301\u256c_",
        "ccfLevel": 7,
        "title": "AT_abc273_g [ABC273G] Row Column Sums 2"
    },
    {
        "content": "Luogu \u722c Atcoder \u540e\u6211\u7684\u7b2c\u4e00\u7bc7 Atcoder \u9898\u89e3\uff01\n\n\u9996\u5148\u65e2\u7136\u6ca1\u6709\u8bc4\u96be\u5ea6\u5efa\u8bae\u7ba1\u7406\u5458\u5ba1\u6838\u672c\u9898\u89e3\u65f6\u5148\u52a0\u4e0a\u96be\u5ea6\u7d2b\uff0c\u7b97\u6cd5\u201c\u52a8\u6001\u89c4\u5212\u201d\uff0c\u201c\u7ec4\u5408\u6570\u5b66\u201d\u3002\n\n## \u601d\u8def\n\n\u6bd4\u8f83\u7ecf\u5178\u7684 dp \u95ee\u9898\uff0c\u8003\u8651\u770b\u5230 $R_i,C_i\\leq 2$\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u8ba1 $dp_{i,j,k}$ \u8868\u793a\u76ee\u524d\u770b\u5230 $R_i$\uff0c\u7ec4\u5408\u51fa\u6765\u4e86 $j,k$ \u4e2a\u5217\u4e0a\u653e\u7f6e\u4e86\u5206\u522b $1,2$ \u4e2a\u68cb\u5b50\u7684\u5217\u7684\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u7684\u65f6\u5019\u6839\u636e $R_i=0,R_i=1,R_i=2$ \u5206\u522b\u8003\u8651\u5373\u53ef\u3002\n\n* $R_i=0:dp_{i-1,j,k}\\to dp_{i,j,k}$\uff1b\n* $R_i=1:dp_{i-1,j,k}\\times (n-j-k)\\to dp_{i,j+1,k},dp_{i-1,j,k}\\times j\\to dp_{i,j-1,k+1}$\uff1b\n* $R_i=2:dp_{i-1,j,k}\\times\\binom{n-j-k}{2}\\to dp_{i,j+2,k},dp_{i-1,j,k}\\times\\binom{j}{2}\\to dp_{i,j-2,k+2},dp_{i-1,j,k}\\times(n-j-k)\\times(j+1)\\to dp_{i,j,k+1}$\uff1b\n\n\u8003\u8651\u5230\u540e\u9762\u4e24\u7ef4\u5176\u5b9e\u679a\u4e3e\u4e00\u7ef4\u53e6\u4e00\u4f4d\u5373\u53ef\u8ba1\u7b97\uff0c\u53ef\u4ee5\u6eda\u52a8\u5176\u4e2d\u4e4b\u4e00\uff0c\u4e5f\u53ef\u4ee5\u6eda\u52a8\u6700\u524d\u9762\u7684\u7b2c\u4e00\u7ef4\uff0c\u603b\u4e4b\u590d\u6742\u5ea6 $O(n^2)$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\n#define double long double\n#define mid ((l+r)>>1)\nusing namespace std;\nint mod=998244353;\nint qp(int a,int b){\n\tint ans=1;\n\twhile(b){\n\t\tif(b&1) ans=(ans*a)%mod;\n\t\ta=(a*a)%mod;\n\t\tb>>=1;\n\t}\n\treturn ans;\n}\nint fac[10000005],inv[10000005];\nvoid init(){\n\tfac[0]=1;\n\tfor(int i=1;i<=10000000;i++) fac[i]=fac[i-1]*i%mod;\n\tinv[10000000]=qp(fac[10000000],mod-2);\n\tfor(int i=9999999;i>=0;i--) inv[i]=inv[i+1]*(i+1)%mod;\n}\nint C(int i,int j){\n\tif(i<0||j<0||i<j) return 0;\n\treturn fac[i]*inv[i-j]%mod*inv[j]%mod;\n}\nint read(){\n\tchar c; int ans=0; int z=1;\n\twhile(!isdigit(c=getchar()))z-=2*(c=='-');\n\tdo{ans=(ans*10+c-'0');}while(isdigit(c=getchar()));\n\treturn ans*z;\n}\nvoid print(int x){\n\tif(x<0) putchar('-');\n\tif(llabs(x)>=10) print(llabs(x)/10);\n\tputchar((llabs(x)%10)+'0');\n}\nvoid endl(){\n\tputchar(10);\n}\nint dp[5005][5005];\nint cnt[5005];\nsigned main(){\n\t//freopen(\"\",\"r\",stdin);\n\t//freopen(\"\",\"w\",stdout);\n\tinit();\n\tint n;\n\tcin>>n;\n\tint r[n+1],c[n+1],tot1=0,tot2=0;\n\tfor(int i=1;i<=n;i++) tot1+=(r[i]=read());\n\tfor(int i=1;i<=n;i++) cnt[c[i]=read()]++,tot2+=c[i];\n\tif(tot1!=tot2){\n\t\tcout<<0;\n\t\treturn 0;\n\t}\n\tint sum=0;\n\tdp[0][0]=1;\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=0;j<=n;j++){\n\t\t\tif(sum-j*2<0||n-sum+j*2-j<0){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tint num1=sum-j*2,num2=j;\n\t\t\tif(r[i]==1&&n-num1-num2>0) dp[num1+1][num2]=(dp[num1+1][num2]+dp[num1][num2]*(n-num1-num2))%mod;\n\t\t\tif(r[i]==1&&num1>=1) dp[num1-1][num2+1]=(dp[num1-1][num2+1]+dp[num1][num2]*num1)%mod;\n\t\t\tif(r[i]==2&&n-num1-num2>1) dp[num1+2][num2]=(dp[num1+2][num2]+dp[num1][num2]*(((n-num1-num2)*(n-num1-num2-1)/2)%mod))%mod;\n\t\t\tif(r[i]==2&&n-num1-num2>0&&num1>=1) dp[num1][num2+1]=(dp[num1][num2+1]+dp[num1][num2]*(n-num1-num2)%mod*num1)%mod;\n\t\t\tif(r[i]==2&&num1>=2) dp[num1-2][num2+2]=(dp[num1-2][num2+2]+dp[num1][num2]*((num1*(num1-1)/2)%mod))%mod;\n\t\t\tif(r[i]==2&&n-num1-num2>0) dp[num1][num2+1]=(dp[num1][num2+1]+dp[num1][num2]*(n-num1-num2))%mod;\n\t\t}\n\t\tsum+=r[i];\n\t}\n\tcout<<dp[cnt[1]][cnt[2]]*fac[cnt[0]]%mod*fac[cnt[1]]%mod*fac[cnt[2]]%mod*inv[n]%mod;\n\treturn 0;\n}\n```",
        "postTime": 1660752255,
        "uid": 116664,
        "name": "Daniel_lele",
        "ccfLevel": 8,
        "title": "ABC273G \u9898\u89e3"
    },
    {
        "content": "#  [[ABC273G] Row Column Sums 2](https://www.luogu.com.cn/problem/AT_abc273_g) Solution\n\n[TOC]\n\n## [\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\u6233\u6b64\u8fdb\u5165](http://blog.tsawke.com?t=ABC273G)\n\n## \u9898\u9762\n\n\u7ed9\u5b9a $ n $\uff0c\u7ed9\u5b9a\u5e8f\u5217 $ R_n, C_n $\uff0c\u6c42\u6709\u591a\u5c11\u4e2a $ n \\times n $ \u7684\u77e9\u9635\u6ee1\u8db3\u7b2c $ i $ \u884c\u7684\u6570\u4e4b\u548c\u4e3a $ R_i $\uff0c\u7b2c $ i $ \u5217\u7684\u6570\u4e4b\u548c\u4e3a $ C_i $\uff0c\u4fdd\u8bc1 $ 0 \\le R_i, C_i, \\le 2 $\uff0c\u7b54\u6848\u5bf9 $ 998244353 $ \u53d6\u6a21\u3002\n\n## Solution\n\n\u63d0\u4f9b\u4e00\u79cd\u8f83\u4e3a\u597d\u7406\u89e3\u4e14\u8f6c\u79fb\u8f83\u4e3a\u597d\u5b9e\u73b0\u7684\u505a\u6cd5\uff0c\u6838\u5fc3\u601d\u8def\u6765\u81ea @sssmzy\u3002\n\n\u8bbe\u8ba1\u72b6\u6001 $ dp(i, j, k) $ \u8868\u793a\u8003\u8651\u524d $ i $ \u884c\u5269\u4f59 $ j $ \u5217\u9700\u8981\u518d\u6dfb $ 1 $\uff0c$ k $ \u5217\u9700\u8981\u518d\u6dfb $ 2 $ \u7684\u65b9\u6848\u6570\uff0c\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e00\u884c\u53ef\u4ee5\u53bb\u6d88\u9664\u4e00\u4e9b $ j $ \u6216 $ k $\uff0c\u8003\u8651\u8f6c\u79fb\uff1a\n\n\u5bf9\u4e8e $ R_i = 0 $\uff0c\u663e\u7136\u65e0\u6cd5\u4ea7\u751f\u8d21\u732e\u3002\n$$\nR_i = 0 : dp(i, j, k) \\leftarrow dp(i - 1, j, k)\n$$\n\u5bf9\u4e8e $ R_i = 1 $\uff0c\u8003\u8651\u8981\u4e48\u5c06\u5176\u8865\u5168\u4e00\u4e2a $ j $\uff0c\u8981\u4e48\u5c06\u5176\u53bb\u8865\u5230 $ k $ \u4f7f\u5f97\u51cf\u5c11\u4e00\u4e2a $ k $ \u5e76\u591a\u4e00\u4e2a $ j $\u3002\n$$\nR_i = 1 : dp(i, j, k) \\leftarrow dp(i - 1, j + 1, k) \\times (j + 1) + dp(i - 1, j - 1, k + 1) \\times (k + 1)\n$$\n\u5bf9\u4e8e $ R_i = 2 $\uff0c\u8003\u8651\u53ef\u4ee5\u8865\u5168\u4e24\u4e2a $ j $\uff0c\u6216\u8865\u5168\u4e00\u4e2a $ k $\uff0c\u6216\u5c06\u4e24\u4e2a $ k $ \u8f6c\u5316\u4e3a\u4e24\u4e2a $ j $\uff0c\u6216\u8865\u5168\u4e00\u4e2a $ j $ \u5e76\u5c06\u4e00\u4e2a $ k $ \u8f6c\u6362\u4e3a $ j $\u3002\n$$\nR_i = 2 : dp(i, j, k) \\leftarrow dp(i - 1, j + 2, k) \\times {j + 2 \\choose 2} + dp(i - 1, j, k + 1) \\times (k + 1) + dp(i - 1, j - 2, k + 2) \\times {k + 2 \\choose 2} + dp(i - 1, j, k + 1) \\times (k + 1) \\times j\n$$\n\u6b64\u4e3a $ \\texttt{3D0D} $\uff0c\u8003\u8651\u5728\u6bcf\u4e00\u5c42\u8f6c\u79fb\u4e2d\uff0c$ j + k $ \u7684\u503c\u5e94\u4e3a\u56fa\u5b9a\u7684\uff0c\u4e8e\u662f\u5f53\u6211\u4eec\u5df2\u77e5 $ j $ \u65f6 $ k $ \u5c31\u662f\u56fa\u5b9a\u7684\uff0c\u5177\u4f53\u6765\u8bf4\u7ef4\u62a4\u4e00\u4e2a $ \\sum C_i $\uff0c\u7136\u540e\u6bcf\u6b21\u8f6c\u79fb\u65f6\u5220\u53bb\u5f53\u524d\u6b21\u8d21\u732e\u7684 $ R_i $ \u5373\u53ef\u3002\u4e8e\u662f\u4ee5\u6b64\u53ef\u4ee5\u65e0\u9700\u679a\u4e3e\u6700\u540e\u4e00\u7ef4\uff08\u540c\u7406\u4e5f\u53ef\u4ee5\u9009\u62e9\u5220\u53bb $ i $ \u6216 $ j $\uff09\uff0c\u4f18\u5316\u4e3a $ \\texttt{2D0D} $\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\nTips\uff1a\u6ce8\u610f\u9700\u8981\u7279\u5224 $ \\sum R_i \\neq \\sum C_i $ \u65f6\u65e0\u89e3\uff0c\u7b54\u6848\u4e3a $ 0 $\u3002\n\n## Code\n\n```cpp\n#define _USE_MATH_DEFINES\n#include <bits/stdc++.h>\n\n#define PI M_PI\n#define E M_E\n#define npt nullptr\n#define SON i->to\n#define OPNEW void* operator new(size_t)\n#define ROPNEW void* Edge::operator new(size_t){static Edge* P = ed; return P++;}\n#define ROPNEW_NODE void* Node::operator new(size_t){static Node* P = nd; return P++;}\n\nusing namespace std;\n\nmt19937 rnd(random_device{}());\nint rndd(int l, int r){return rnd() % (r - l + 1) + l;}\nbool rnddd(int x){return rndd(1, 100) <= x;}\n\ntypedef unsigned int uint;\ntypedef unsigned long long unll;\ntypedef long long ll;\ntypedef long double ld;\n\n#define MOD (998244353ll)\n\ntemplate < typename T = int >\ninline T read(void);\n\nint N;\nll sumC(0);\nll dp[5100][5100];\nint R[5100], C[5100];\nint cnt1(0);\n\nint main(){\n    // freopen(\"in.txt\", \"r\", stdin);\n    N = read();\n    for(int i = 1; i <= N; ++i)R[i] = read();\n    for(int i = 1; i <= N; ++i)sumC += (C[i] = read());\n    for(int i = 1; i <= N; ++i)if(C[i] == 1)++cnt1;\n    dp[0][cnt1] = 1;\n    for(int i = 1; i <= N; ++i){\n        sumC -= R[i];\n        for(int j = 0; j <= N; ++j){\n            if((sumC - j) & 1)continue;\n            int k = (sumC - j) >> 1;\n            switch(R[i]){\n                case 0:{\n                    dp[i][j] = dp[i - 1][j];\n                    break;\n                }\n                case 1:{\n                    (dp[i][j] += dp[i - 1][j + 1] * (j + 1) % MOD) %= MOD;\n                    if(j - 1 >= 0)(dp[i][j] += dp[i - 1][j - 1] * (k + 1) % MOD) %= MOD;\n                    break;\n                }\n                case 2:{\n                    (dp[i][j] += dp[i - 1][j + 2] * ((j + 2) * (j + 1) / 2 % MOD) % MOD) %= MOD;\n                    (dp[i][j] += dp[i - 1][j] * (k + 1) % MOD) %= MOD;\n                    if(j - 2 >= 0)(dp[i][j] += dp[i - 1][j - 2] * ((k + 2) * (k + 1) / 2 % MOD) % MOD) %= MOD;\n                    (dp[i][j] += dp[i - 1][j] * (k + 1) % MOD * j % MOD) %= MOD;\n                    break;\n                }\n            }\n        }\n    }\n    printf(\"%lld\\n\", sumC ? 0 : dp[N][0]);\n    fprintf(stderr, \"Time: %.6lf\\n\", (double)clock() / CLOCKS_PER_SEC);\n    return 0;\n}\n\ntemplate < typename T >\ninline T read(void){\n    T ret(0);\n    int flag(1);\n    char c = getchar();\n    while(c != '-' && !isdigit(c))c = getchar();\n    if(c == '-')flag = -1, c = getchar();\n    while(isdigit(c)){\n        ret *= 10;\n        ret += int(c - '0');\n        c = getchar();\n    }\n    ret *= flag;\n    return ret;\n}\n```\n\n## UPD\n\nupdate-2023_02_20 \u521d\u7a3f",
        "postTime": 1676888957,
        "uid": 362938,
        "name": "Tsawke",
        "ccfLevel": 6,
        "title": "[ABC273G] Row Column Sums 2 \u9898\u89e3"
    }
]