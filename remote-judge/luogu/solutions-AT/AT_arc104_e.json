[
    {
        "content": "\u9996\u5148\u671f\u671b\u8f6c\u5316\u6210 $\\text{LIS}$ \u603b\u548c\u9664\u4ee5\u65b9\u6848\u603b\u6570\uff08\u5373 $a_i$ \u4e58\u79ef\uff09\u4e0d\u5fc5\u591a\u8bf4\u4e86\u3002\u89c2\u5bdf\u53ef\u53d1\u73b0\u9898\u76ee $n$ \u7279\u522b\u5c0f\uff0c\u8003\u8651 $O(n^n)$ \u679a\u4e3e $x_i$ \u7684\u76f8\u5bf9\u5927\u5c0f\u5173\u7cfb\uff08\u6392\u540d\uff09\uff0c\u56fa\u5b9a\u6392\u540d\u540e\u7b97\u51fa $\\text{LIS}$\uff0c\u518d\u8ba1\u7b97\u8fd9\u79cd\u6392\u540d\u5bf9\u5e94\u7684\u65b9\u6848\u6570\u3002\n\n\u4e8e\u662f\u73b0\u5728\u95ee\u9898\u53d8\u6210\u4e86\u6709 $m$ \u4e2a\u6570\uff0c\u6bcf\u4e2a\u6570\u7684\u4e0a\u754c\u4e3a $b_i$\uff0c\u8981\u6c42\u5e8f\u5217\u5355\u8c03\u9012\u589e\u7684\u65b9\u6848\u6570\u3002\u8003\u8651\u76f4\u63a5\u5957 [CF1295F Good Contest](https://codeforces.com/problemset/problem/1295/F) \u7684\u505a\u6cd5\uff0c$b_i$ \u79bb\u6563\u5316\u540e\u8bbe $f_{i,j}$ \u4e3a\u7b2c $i$ \u4e2a\u6570\u4f4d\u4e8e\u503c\u57df\u7b2c $j$ \u6bb5\u7684\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u679a\u4e3e\u4ee5 $i$ \u4e3a\u53f3\u7aef\u70b9\u7684\u6781\u957f\u503c\u57df\u4f4d\u4e8e\u540c\u4e00\u6bb5\u7684\u533a\u95f4\u5de6\u7aef\u70b9 $k$\uff0c\u4ee5\u53ca $k-1$ \u4f4d\u4e8e\u54ea\u4e2a\u6bb5\u3002\u7cfb\u6570\u662f\u5728 $[1,len_j]$ \u4e2d\u9009 $i-k+1$ \u4e2a\u4e92\u4e0d\u76f8\u540c\u7684\u6570\u7684\u65b9\u6848\u6570\uff08\u4e3a $\\binom{len_j}{i-k+1}$\uff09\u3002\u53ef\u5f97\uff1a\n\n$$f_{i,j} \\gets \\sum\\limits_{k=1}^{i-1} \\sum\\limits_{x=1}^{j-1} \\binom{len_j}{i-k+1} f_{k-1,x}$$\n\n\u66b4\u529b\u8ba1\u7b97\u5373\u53ef\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u5927\u6982\u662f $O(n^{n+5})$\uff08\u6ca1\u4ed4\u7ec6\u7b97\uff0c\u5b9e\u9645\u8fdc\u8fdc\u8fbe\u4e0d\u5230\uff09\u3002\n\n[code](https://atcoder.jp/contests/arc104/submissions/40678861)",
        "postTime": 1681568747,
        "uid": 275273,
        "name": "zltqwq",
        "ccfLevel": 0,
        "title": "ARC104E \u9898\u89e3"
    },
    {
        "content": "\u770b\u5230\u5de8\u5927\u7684 $a_i$ \u548c\u5de8\u5c0f\u7684 $n$\uff0c\u8003\u8651\u79bb\u6563\u5316\u3002\n\n\u7531\u4e8e LIS \u53ea\u8ddf\u504f\u5e8f\u5173\u7cfb\u6709\u5173\uff0c\u8003\u8651\u679a\u4e3e\u504f\u5e8f\u5173\u7cfb\uff0c\u590d\u6742\u5ea6 $\\mathcal O(n^n)$\u3002\n\n\u5728\u786e\u5b9a\u4e86\u504f\u5e8f\u5173\u7cfb\u4e4b\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u66b4\u529b\u6c42 LIS \u4e86\u3002\n\n\u90a3\u4e48\u5982\u4f55\u8ba1\u7b97\u7b54\u6848\u5462\uff1f\n\n\u6839\u636e\u7ed9\u5b9a\u7684\u8303\u56f4\uff0c\u6211\u4eec\u5f88\u5bb9\u6613\u5f97\u5230\u6bcf\u4e00\u4e2a\u503c\u7684\u53d6\u503c\u8303\u56f4\u3002\n\n\u7531\u4e8e\u5e8f\u5217\u79bb\u6563\u5316\u3001\u53bb\u91cd\u540e\u5355\u8c03\u9012\u589e\uff0c\u6211\u4eec\u53d1\u73b0\u6bcf\u6b21\u7684\u589e\u52a0\u503c $>0$\u3002\n\n\u90a3\u4e48\u53ea\u8981\u679a\u4e3e\u589e\u52a0\u503c\u5c31\u884c\u3002\n\n\u5982\u679c\u76f8\u90bb\u7684\u4e24\u4e2a\u503c\u5728\u540c\u4e00\u4e2a\u503c\u57df\u5185\uff0c\u7528\u7ec4\u5408\u6570\u7206\u7b97\u5373\u53ef\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\n\nconst int N = 7, Mod = 1e9 + 7;\nint n, all = 1, res, a[N], p[N], lim[N], tmp[N];\n\ninline int qpow(int bas, int pw, int mul = 1) {\n    for (; pw; pw >>= 1, (bas *= bas) %= Mod)\n        if (pw & 1) (mul *= bas) %= Mod; return mul;\n}\n\ninline int C(int u, int v) {\n    if (v == 0) return 1; if (v == 1) return u;\n    if (v == 2) return u * (u - 1) % Mod * 500000004ll % Mod;\n    if (v == 3) return u * (u - 1) % Mod * (u - 2) % Mod * 166666668ll % Mod;\n    if (v == 4) return u * (u - 1) % Mod * (u - 2) % Mod * (u - 3) % Mod * 41666667ll % Mod;\n    if (v == 5) return u * (u - 1) % Mod * (u - 2) % Mod * (u - 3) % Mod * (u - 4) % Mod * 808333339ll % Mod;\n    if (v == 6) return u * (u - 1) % Mod * (u - 2) % Mod * (u - 3) % Mod * (u - 4) % Mod * (u - 5) % Mod * 301388891ll % Mod;\n}\n\ninline int _dfs(int len, int Max) {\n    if (len == Max + 1) {\n        int cur = 1; vector <int> ct; ct.resize(Max + 1);\n        for (int i = 1; i <= Max; ++i) ++ct[tmp[i]];\n        for (int i = 1; i <= Max; ++i) (cur *= C(lim[i], ct[i])) %= Mod;\n        return tmp[0] = 0, cur;\n    }\n    int ret = 0;\n    for (tmp[len] = tmp[len - 1]; tmp[len] <= len; ++tmp[len])\n        (ret += _dfs(len + 1, Max)) %= Mod; return ret;\n}\n\ninline void dfs(int len) {\n    if (len == n + 1) {\n        for (int i = 1; i <= n; ++i) tmp[i] = p[i];\n        sort(tmp + 1, tmp + 1 + n); bool f = true;\n        for (int i = 1; i <= n; ++i) f &= (tmp[i] - tmp[i - 1] <= 1);\n        if (!f) return ; vector <int> dp; dp.resize(n + 1);\n        for (int i = 1; i <= n; ++i) dp[i] = 1;\n        for (int i = 1; i <= n; ++i) for (int j = 1; j < i; ++j)\n            if (p[j] < p[i]) dp[i] = max(dp[i], dp[j] + 1);\n        int ls = 0; for (int i = 1; i <= n; ++i) ls = max(ls, dp[i]);\n        int Max = tmp[n]; for (int i = 1; i <= Max; ++i) lim[i] = 1e18;\n        for (int i = 1; i <= n; ++i) lim[p[i]] = min(lim[p[i]], a[i]);\n        for (int i = Max - 1; i; --i) lim[i] = min(lim[i], lim[i + 1]), lim[i + 1] -= lim[i];\n        tmp[0] = 1; return (res += _dfs(1, Max) * ls % Mod) %= Mod, void();\n    }\n    for (int i = 1; i <= n; ++i) p[len] = i, dfs(len + 1); return ;\n}\n\nsigned main() {\n    cin >> n; for (int i = 1; i <= n; ++i)\n        cin >> a[i], (all *= a[i]) %= Mod;\n    all = qpow(all, Mod - 2); dfs(1);\n    return cout << res * all % Mod << endl, 0;\n}\n```",
        "postTime": 1676107725,
        "uid": 487752,
        "name": "MistZero",
        "ccfLevel": 0,
        "title": "\u79bb\u6563\u5316\u66b4\u529b DFS\u3002"
    },
    {
        "content": "\u5982\u679c\u66b4\u529b\u679a\u4e3e\u94a6\u5b9a LIS \u662f\u8c01\u7684\u8bdd\uff0c\u770b\u4f3c\u53ef\u4ee5\u5bb9\u65a5\uff0c\u4f46\u662f\u4f1a\u6570\u91cd\u3002\n\n\u6b63\u786e\u7684\u505a\u6cd5\u662f\u53d1\u73b0 $n$ \u5b9e\u5728\u662f\u5f88\u5c0f\uff0c\u56e0\u6b64\u751a\u81f3\u53ef\u4ee5\u628a\u6574\u4e2a\u5e8f\u5217\u7684\u5e8f\u90fd\u94a6\u5b9a\u51fa\u6765\uff0c\u8fd9\u6837\u662f $O(n^n)$ \u7684\u3002\n\n\u7136\u540e\u94a6\u5b9a\u51fa\u5e8f\u6765\u4e86\u4e4b\u540e\u7edf\u8ba1\u8fd9\u4e2a\u5e8f\u7684\u65b9\u6848\u6570\uff0c\u53ef\u4ee5\u518d `dfs` \u4e00\u6b21\u679a\u4e3e\u6bcf\u4e2a\u4f5c\u4e3a\u5e8f\u7684\u6570\u5728\u54ea\u4e2a\u503c\u57df\u533a\u95f4\u5185\uff0c\u8fd9\u6837\u5c31\u5f88\u597d\u7edf\u8ba1\u7b54\u6848\u3002\u5982\u679c\u662f\u591a\u4e2a\u6570\u5728\u540c\u4e00\u4e2a\u533a\u95f4\u5185\uff0c\u7528\u7ec4\u5408\u6570\u5373\u53ef\u3002\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\n#define rep(i, a, b) for (int i = (a); i <= (b); ++i)\n#define per(i, a, b) for (int i = (a); i >= (b); --i)\nusing namespace std;\nconst int N = 7;\nconst int mod = 1e9 + 7;\nint n, a[N], b[N], nn;\nint ds[N], p[N], now[N];\nint res = 0;\nint f[N], ned[N];\nint fac[N], ifac[N];\ninline int qpow(int a, int b) {\n    int res = 1;\n    while (b) {\n        if (b & 1) res = res * a % mod;\n        a = a * a % mod;\n        b >>= 1;\n    }\n    return res;\n}\ninline int C(int n, int m) {\n    int res = ifac[m];\n    per(i, n, n - m + 1) res = res * i % mod;\n    return res;\n}\nvoid dfs2(int dep, int gx) {\n    if (dep > n) {\n        rep(i, 1, nn) ned[i] = 0;\n        int lst = 0;\n        int tmpp = 1;\n        rep(i, 1, n) {\n            int tmp = 0;\n            bool flg = 0;\n            rep(j, 1, n) if (p[j] == i) {\n                flg = 1;\n                if (tmp && tmp != now[j]) goto fail;\n                tmp = now[j];\n            }\n            if (!flg) break;\n            if (tmp < lst) goto fail;\n            ++ned[tmp];\n            lst = tmp;\n        }\n        rep(i, 1, nn) {\n            tmpp = tmpp * C(ds[i], ned[i]) % mod;\n        }\n        res = (res + tmpp * gx % mod) % mod;\n        fail:\n        return;\n    }\n    rep(i, 1, a[dep]) now[dep] = i, dfs2(dep + 1, gx);\n}\nvoid dfs(int dep) {\n    if (dep > n) {\n        rep(i, 1, n) b[i] = p[i];\n        sort(b + 1, b + n + 1);\n        int lis = 0;\n        if (b[1] != 1) goto fail;\n        rep(i, 1, n - 1) if (b[i + 1] - b[i] > 1) goto fail;\n        rep(i, 1, n) {\n            f[i] = 1;\n            rep(j, 1, i - 1) if (p[j] < p[i]) f[i] = max(f[i], f[j] + 1);\n            lis = max(lis, f[i]);\n        }\n        dfs2(1, lis);\n        fail:\n        return;\n    }\n    rep(i, 1, n) {\n        p[dep] = i;\n        dfs(dep + 1);\n    }\n}\nsigned main() {\n    scanf(\"%lld\", &n);\n    fac[0] = 1;\n    rep(i, 1, n) fac[i] = fac[i - 1] * i % mod;\n    ifac[n] = qpow(fac[n], mod - 2);\n    per(i, n - 1, 0) ifac[i] = ifac[i + 1] * (i + 1) % mod;\n    int inv = 1;\n    rep(i, 1, n) scanf(\"%lld\", &a[i]), inv = inv * a[i] % mod;\n    rep(i, 1, n) b[i] = a[i];\n    sort(b + 1, b + n + 1);\n    nn = unique(b + 1, b + n + 1) - b - 1;\n    rep(i, 1, nn) {\n        ds[i] = b[i] - b[i - 1];\n    }\n    rep(i, 1, n) {\n        a[i] = lower_bound(b + 1, b + nn + 1, a[i]) - b;\n    }\n    dfs(1);\n    printf(\"%lld\\n\", res * qpow(inv, mod - 2) % mod);\n    return 0;\n}\n```",
        "postTime": 1677036420,
        "uid": 76156,
        "name": "henrytb",
        "ccfLevel": 8,
        "title": "ARC104E \u9898\u89e3"
    }
]