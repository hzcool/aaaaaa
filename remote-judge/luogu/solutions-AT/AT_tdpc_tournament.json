[
    {
        "content": "under \u9898\u89e3 [AT682](https://www.luogu.com.cn/problem/AT682)\n\n\u540c\u6b65\u53d1\u5e03\u4e8e[\u4e2a\u4eba\u535a\u5ba2](https://fa555.github.io/2020/\u67d0At\u7684dp\u573a/#C-\u30c8\u30fc\u30ca\u30e1\u30f3\u30c8)\n\n### problem\n\n~~\u7ffb\u8bd1\u662f\u6211\u4ea4\u7684~~\n\n\u6709 $2^K \\ (1 \\le K \\le 10)$ \u4eba\u53c2\u52a0\u4e00\u573a\u9526\u6807\u8d5b\uff0c\u8fd9\u573a\u9526\u6807\u8d5b\u6309\u4ee5\u4e0b\u7684\u5f62\u5f0f\u8fdb\u884c\u3002\n\n*\u8bd1\u8005\u6ce8\uff1a\u6211\u77e5\u9053\u53ef\u8bfb\u6027\u5f88\u5dee\uff0c\u4f46\u662f\u5f88\u597d\u7406\u89e3\uff0c\u65e5\u8bed\u539f\u9898\u9762\u5c31\u662f\u8fd9\u6837\u7684*\n\n- \u7b2c 1 \u8f6e\uff0c1 \u548c 2\uff0c3 \u548c 4\uff0c\u2026 \u8fdb\u884c\u6bd4\u8d5b\u3002\n- \u7b2c 2 \u8f6e\uff0c(1 \u548c 2 \u7684\u80dc\u8005)\u548c(3 \u548c 4 \u7684\u80dc\u8005)\uff0c(5 \u548c 6 \u7684\u80dc\u8005)\u548c(7 \u548c 8 \u7684\u80dc\u8005)\uff0c\u2026 \u8fdb\u884c\u6bd4\u8d5b\u3002\n- \u7b2c 3 \u8f6e\uff0c((1 \u548c 2 \u7684\u80dc\u8005)\u548c(3 \u548c 4 \u7684\u80dc\u8005)\u7684\u80dc\u8005)\u548c((5 \u548c 6 \u7684\u80dc\u8005)\u548c(7 \u548c 8 \u7684\u80dc\u8005)\u7684\u80dc\u8005)\uff0c((9 \u548c 10 \u7684\u80dc\u8005)\u548c(11 \u548c 12 \u7684\u80dc\u8005)\u7684\u80dc\u8005)\u548c((13 \u548c 14 \u7684\u80dc\u8005)\u548c(15 \u548c 16 \u7684\u80dc\u8005)\u7684\u80dc\u8005)\uff0c\u2026 \u8fdb\u884c\u6bd4\u8d5b\u3002\n- \u91cd\u590d\u76f8\u540c\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u7b2c $K$ \u8f6e\u3002\n\n\u7b2c $K$ \u8f6e\u7ed3\u675f\u540e\u5c06\u4f1a\u51b3\u51fa\u4f18\u80dc\u8005\u3002\u5982\u679c\u7b2c $i$ \u4e2a\u4eba\u7684 Elo Rating \u4e3a $R_i \\ (1 \\le R_i \\le 4000)$\uff0c\u6c42\u51fa\u6bcf\u4e2a\u4eba\u6210\u4e3a\u4f18\u80dc\u8005\u7684\u6982\u7387\u3002\n\n\u89c4\u5b9a\uff1a\u5982\u679c Elo Rating \u4e3a $R_P$ \u7684\u4eba $P$ \u548c Elo Rating \u4e3a $R_Q$ \u7684\u4eba $Q$ \u5bf9\u6218\uff0c\u4eba $P$ \u7684\u83b7\u80dc\u6982\u7387\u4e3a $1 / (1 + 10^{(R_Q - R_P) / 400})$\u3002\u5047\u8bbe\u4e0d\u540c\u7684\u6bd4\u8d5b\u7684\u80dc\u8d1f\u662f\u4e92\u76f8\u72ec\u7acb\u7684\u3002\n\n### solution\n\n\u663e\u7136\u662f\u9053\u6982\u7387 dp\uff08\n\n\u8bbe $f_{k, i}$ \u8868\u793a\u7b2c $k$ \u8f6e\u6bd4\u8d5b\u4e2d\u7b2c $i$ \u4e2a\u4eba\u83b7\u80dc\u7684\u6982\u7387\u3002\u4e0d\u96be\u5f97\u5230\u8fd9\u6837\u7684\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$\nf_{k, i} = f_{k - 1, i} \\times \\sum_{j \\in S}{(f_{k - 1, j} \\times P)}\n$$\n\n\u5176\u4e2d $S$ \u8868\u793a\u7b2c $k$ \u8f6e\u4e2d\u53ef\u80fd\u4e0e $i$ \u6bd4\u8d5b\u7684\u4eba\uff1b$P$ \u8868\u793a\u7b2c $j$ \u4e2a\u4eba\u6b64\u65f6\u83b7\u80dc\u7684\u6982\u7387\u3002\n\n\u8fb9\u754c\u6761\u4ef6 $f_{i, 0} = 1$\u3002\n\n\u7b54\u6848\u5373\u4e3a $f_{K, i} \\ (1 \\le i \\le 2^K)$\u3002\u603b\u590d\u6742\u5ea6 $O(K \\times 2^K)$\u3002\n\n### code\n\n``` cpp\nusing db = double;\n\nint R[1<<10|1];\ndb f[11][1<<10|1];\n\ninline db calc(int p, int q) {\n  return 1 / (1 + pow(10., (R[q] - R[p]) / 400.));\n}\n\nint main() {\n  int K, N;\n  \n  cin >> K;\n  N = 1 << K;\n  for (int i = 1; i <= N; ++i)\n    cin >> R[i];\n  for (int i = 1; i <= N; ++i)\n    f[0][i] = 1;\n  for (int k = 1, len; k <= K; ++k) {\n    len = 1 << k;\n    for (int i = 1, mn, mx, mid, l, r; i <= N; ++i) {\n      db now = 0;\n      mx = (i - 1) / len * len + len, mn = mx - len + 1;\n      mid = ((mn + mx) >> 1) + 1;\n\n      if (i < mid) l = mid, r = mx;\n      else l = mn, r = mid - 1;\n      // \u6b64\u5904\u7684 l ~ r \u4e3a\u53ef\u80fd\u6b64\u65f6\u548c\u7b2c j \u4e2a\u4eba\u6bd4\u8d5b\u7684\u7f16\u53f7\u533a\u95f4\n\n      for (int j = l; j <= r; ++j)\n        now += f[k - 1][j] * calc(i, j);\n      f[k][i] = now * f[k - 1][i];\n    }\n  }\n  for (int i = 1; i <= N; ++i)\n    printf(\"%.9lf\\n\", f[K][i]);\n  return 0;\n}\n\n```",
        "postTime": 1584932091,
        "uid": 111890,
        "name": "fa_555",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 AT682 \u3010\u30c8\u30fc\u30ca\u30e1\u30f3\u30c8\u3011"
    }
]