[
    {
        "content": "[ABC243F](https://atcoder.jp/contests/abc243/tasks/abc243_f)\n$\\text{Difficulty : 2125}$ \uff1a\u6bcf\u6b21\u62bd\u5956\u6709 $p_i$ \u7684\u6982\u7387\u83b7\u5f97\u7269\u54c1 $i$\uff0c\u6c42\u62bd $k$ \u6b21\u6070\u597d\u83b7\u5f97 $m$ \u4e2a\u4e0d\u540c\u7684\u7269\u54c1\u7684\u6982\u7387\u3002\u5bf9\u5927\u8d28\u6570\u53d6\u6a21\u3002\n\n\u9996\u5148\u5982\u679c $k$ \u6b21\u4e2d\u6bcf\u4e2a\u6570\u62bd\u5230 $c_i$ \u6b21\u7684\u6982\u7387\u4e3a $\\dfrac{k!}{\\prod\\limits_{i=1}^nc_i!}\\prod\\limits_{i=1}^np_i^{c_i}$\u3002\n\n\u8003\u8651\u8fd9\u4e9b\u6570\u7ec4\u6210\u4e0d\u540c\u7684\u6392\u5217\u5171\u6709 $\\dfrac{k!}{\\prod\\limits_{i=1}^nc_i!}$ \u79cd\u5373\u53ef\u3002\n\n\u8bb0 $f_{i,j,k}$ \u8868\u793a\u524d $i$ \u4e2a\u7269\u54c1\uff0c\u9009\u4e86 $k$ \u6b21\uff0c\u9009\u51fa $j$ \u4e2a\u7684\u6982\u7387\uff0c\u4e5f\u5c31\u662f\u4e0a\u5f0f\u53bb\u6389 $k!$ \u7684\u90e8\u5206\u3002\u5219\u6709\uff1a\n\n- \u4e0d\u9009 $i$\uff0c$f_{i,j,k} = f_{i-1,j,k}$\u3002\n- \u9009 $i$\uff0c\u53c2\u89c1\u4e0a\u5f0f\u53ef\u4ee5\u5f97\u5230\uff0c $f_{i,j,k}=\\sum\\limits_{x=1}^k \\dfrac{p_i^t}{x!} f_{i-1,j-1,k-x}$\u3002\n\n$$ans = f_{n,m,k} \\times k!$$\n\n\u5927\u529b dp \u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^4)$\u3002\n\n## code:\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn = 55;\nconst int mod = 998244353;\nlong long n,m,K,f[maxn][maxn][maxn],w[maxn],fac[maxn],inv[maxn],b[maxn][maxn],p[maxn];\ninline int read()\n{\n\tint x = 0,f = 1;\n\tchar ch = getchar();\n\twhile(ch < '0'||ch > '9'){if(ch == '-'){f = -1;}ch = getchar();}\n\twhile(ch <= '9'&&ch >= '0'){x = (x << 1) + (x << 3) + ch - '0',ch = getchar();}\n\treturn f * x;\n}\nlong long qpow(long long a,long long b)\n{\n\tlong long res = 1;\n\twhile(b)\n\t{\n\t\tif(b & 1)\n\t\t\tres = res * a % mod;\n\t\ta = a * a % mod;\n\t\tb >>= 1; \n\t}\n\treturn res % mod;\n}\nvoid prefix()\n{\n\tlong long sum = 0;\n\tfor(int i = 1;i <= n;i++)\n\t\tsum += w[i];\n\tsum = qpow(sum,mod - 2);\n\tfor(int i = 1;i <= n;i++)\n\t\tp[i] = w[i] * sum % mod;\n\tfor(int i = 1;i <= n;i++)\n\t\tfor(int j = 0;j <= K;j++)\n\t\t\tb[i][j] = qpow(p[i],j);\n\tfac[0] = 1;\n\tfor(int i = 1;i <= K;i++)\n\t\tfac[i] = fac[i - 1] * i % mod;\n\tinv[K] = qpow(fac[K],mod - 2);\n\tfor(int i = K - 1;i >= 0;i--)\n\t\tinv[i] = inv[i + 1] * (i + 1) % mod;\n}\n\nint main()\n{\n\tn = read(),m = read(),K = read();\n\tfor(int i = 1;i <= n;i++)\n\t\tw[i] = read();\n\tprefix();\n\tfor(int i = 0;i <= n;i++)\n\t\tf[i][0][0] = 1;\n\tfor(int i = 1;i <= n;i++)\n\t\tfor(int k = 1;k <= K;k++)\n\t\t\tfor(int j = 1;j <= k;j++)\n\t\t\t{\n\t\t\t\tf[i][j][k] = f[i - 1][j][k];\n\t\t\t\tfor(int t = 1;k - t >= j - 1;t++)\n\t\t\t\t\tf[i][j][k] = (f[i][j][k] + f[i - 1][j - 1][k - t] * b[i][t] % mod * inv[t]) % mod;\n\t\t\t}\n\tprintf(\"%lld\",f[n][m][K] * fac[K] % mod);\n\treturn 0 ;\n}\n```",
        "postTime": 1666692758,
        "uid": 302636,
        "name": "zhaoyp",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 AT_abc243_f\u3010[ABC243F] Lottery\u3011"
    },
    {
        "content": "\u4e0d\u9519\u7684\u5bb9\u65a5+dp+\u7cfb\u6570\u8ba1\u7b97+\u6982\u7387\u8bba\u7ecf\u5178\u9898\u3002\n\n## \u601d\u8def\n\n\u9996\u5148\u770b\u5230\u6070\u597d\u76f4\u63a5\u4e0a\u5bb9\u65a5\uff0c\u6362\u6210\u94a6\u5b9a\u5728 $x$ \u4e2a\u5f69\u7968\u4e2d\u9009\u3002\n\n\u5f88\u5bb9\u6613\u8ba1\u7b97\u51fa\u5bf9\u4e8e\u6240\u6709\u5927\u5c0f\u4e3a $0\\sim m$ \u7684\u96c6\u5408\uff0c\u5176\u6982\u7387\u7684 $k$ \u6b21\u65b9\u5927\u5c0f\u4e4b\u548c\u3002\u8ba1\u4e4b\u4e3a $f_i$\u3002\uff08#1\uff09\n\n\u7136\u540e\u8fdb\u884c\u5bb9\u65a5\uff0c\u5bb9\u6613\u53d1\u73b0\u5bb9\u65a5\u7cfb\u6570\u4e3a $(-1)^{m-i}\\times \\binom{n-i}{n-m}$\u3002\u590d\u6742\u5ea6 $O(nmk^2)$\u3002\uff08#2\uff09\n\n~~\u8fd9\u80fd\u8fc7\uff1f\u8fd9\u80fd\u8fc7\uff1f\u8fd9\u80fd\u8fc7\uff1f~~\n\n\u8003\u8651 $dp_{i,j,k}$\uff0c\u8868\u793a\u770b\u5230 $i$ \u53f7\u5f69\u7968\uff0c\u9009\u51fa $j$ \u5f20\uff0c$k$ \u6b21\u65b9\u548c\u5927\u5c0f\u3002\u8f6c\u79fb\u7684\u65f6\u5019\u53ef\u4ee5\u7531 $dp_{i-1,j,k}$ \u8f6c\u79fb\u5230 $dp_{i,j+1,l}$\uff0c\u5176\u4e2d $l\\geq k$\u3002\u6839\u636e\u4e8c\u9879\u5f0f\u5b9a\u7406\uff0c\u7cfb\u6570\u5e94\u8be5\u662f $\\binom{l}{k}\\times a_i^{l-k}$\u3002\uff08#1 \u89e3\u6cd5\u53ca\u7ec6\u8282\uff09\n\n\u8003\u8651\u8ba1 $f_i$ \u7684\u7cfb\u6570\u4e3a $g_i$\u3002\u5bb9\u6613\u53d1\u73b0 $f_i$ \u88ab\u603b\u8ba1 $\\binom{j}{i}$ \u4e2a $f_j$ \u5404\u8ba1\u7b97\u4e86 $g_j$ \u6b21\u3002\u901a\u8fc7\u5f52\u7eb3\u53ca\u63a8\u5f0f\u5b50\u53ef\u4ee5\u53d1\u73b0\u5bb9\u65a5\u7cfb\u6570\u5982\u4e0a\u3002\u672c\u4eba\u5199\u4ee3\u7801\u65f6 $xs$ \u6570\u7ec4\u8868\u793a\u7684\u662f\u8fd9\u91cc\u7684 $g$\uff0c\u4e5f\u7528\u7684 $O(m^2)$ \u8ba1\u7b97\u7cfb\u6570\uff0c\u53ef\u4ee5\u66f4\u4f18\u3002\u6574\u9053\u9898\u590d\u6742\u5ea6\u74f6\u9888\u5728\u4e8e\u524d\u534a\u6bb5\u7684 dp\u3002\uff08#2 \u89e3\u6cd5\u53ca\u8bc1\u660e\uff09\n\n## \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n#pragma GCC optimize(2)\n#define int long long\nusing namespace std;\nconst int mod=998244353;\nint qp(int a,int b){\n\tint ans=1;\n\twhile(b){\n\t\tif(b&1) ans=(ans*a)%mod;\n\t\ta=(a*a)%mod;\n\t\tb>>=1;\n\t}\n\treturn ans;\n}\nint dp[55][55][55];\nint C[55][55]; \nsigned main(){\n\t//freopen(\"\",\"r\",stdin);\n\t//freopen(\"\",\"w\",stdout);\n\tfor(int i=0;i<=50;i++) C[i][0]=1;\n\tfor(int i=1;i<=50;i++) for(int j=1;j<=i;j++) C[i][j]=(C[i-1][j]+C[i-1][j-1])%mod;\n\tint n,m,k,sum=0;\n\tcin>>n>>m>>k;\n\tdp[0][0][0]=1;\n\tfor(int i=1;i<=n;i++){\n\t\tint a; cin>>a;\n\t\tint pw[k+1]; pw[0]=1;\n\t\tfor(int j=1;j<=k;j++) pw[j]=pw[j-1]*a%mod;\n//\t\tcout<<\"OK\";\n\t\tfor(int j=0;j<=n;j++){\n//\t\t\tcout<<\"OK\"<<j; \n\t\t\tfor(int k1=0;k1<=k;k1++){\n\t\t\t\t(dp[i][j][k1]+=dp[i-1][j][k1])%=mod;\n\t\t\t\tfor(int k2=k1;k2<=k;k2++){\n\t\t\t\t\t(dp[i][j+1][k2]+=dp[i-1][j][k1]*C[k2][k1]%mod*pw[k2-k1])%=mod;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsum+=a;\n//\t\tfor(int j=0;j<=n;j++){\n//\t\t\tfor(int k1=0;k1<=k;k1++){\n//\t\t\t\tcout<<dp[i][j][k1]<<\" \";\n//\t\t\t}\n//\t\t\tcout<<endl;\n//\t\t}\n//\t\tcout<<endl;\n\t}\n\tint xs[m+1];\n\tint ans=dp[n][m][k]; xs[m]=1;\n\tfor(int i=m-1;i>=1;i--){\n\t\txs[i]=0;\n\t\tfor(int j=i+1;j<=m;j++){\n\t\t\t(xs[i]+=mod-xs[j]*C[n-i][j-i]%mod)%=mod;\n\t\t}\n//\t\tcout<<xs[i]<<\" \";\n\t\t(ans+=xs[i]*dp[n][i][k])%=mod;\n\t}\n\tcout<<ans*qp(sum,(mod-2)*k)%mod;\n\treturn 0;\n}\n/*\n5 3 5 4 3 4\nthings to check\n1.  int overflow or long long memory need\n2.  recursion/array/binary search/dp/loop bounds\n3.  precision\n4.  special cases(n=,bounds)\n5.  delete debug statements\n6.  initialize(especially multi-tests)\n7.  = or == , n or m ,++ or -- , i or j , > or >= , < or <= , - or =\n8.  keep it simple and stupid\n9.  do not delete, use // instead\n10. operator priority\n11. is there anything extra to output?\n12. if you don't know where the bug is , try to clear some parts of the code\n and check each part seperately.\n*/\n\n\n```",
        "postTime": 1671887219,
        "uid": 116664,
        "name": "Daniel_lele",
        "ccfLevel": 8,
        "title": "ABC243F \u9898\u89e3"
    }
]