[
    {
        "content": "\u725b\u903c\u903c\u9898\u3002\n\n\n\u9996\u5148\u53d1\u73b0\u5e8f\u5217\u7684\u603b\u957f\u662f\u975e\u5e38\u5927\u7684\uff0c\u548c\u77e9\u9635\u5feb\u901f\u5e42\u4e4b\u7c7b\u7684\u4e1c\u897f\u4e5f\u6ca1\u5565\u51e0\u628a\u5173\u7cfb\uff0c\u80af\u5b9a\u5c31\u4e0d\u80fd\u4ece\u5e8f\u5217\u7684\u89d2\u5ea6\u8fdb\u884c dp \u4e86\uff0c\u4e8e\u662f\u4ece\u503c\u57df\u89d2\u5ea6\u8fdb\u884c dp \u3002 \n\n\u4ece\u5c0f\u5230\u5927\u628a\u6bcf\u79cd\u6570\u653e\u8fdb\u53bb\u3002\n\n\u81ea\u5df1\u60f3\u5230\u4e86\u7c7b\u4f3c\u8fde\u7eed\u6bb5 dp \u7684\u505a\u6cd5 \uff0c \u4f46\u662f\u4e0d\u592a\u4f1a\u5904\u7406\u5feb\u901f\u8f6c\u79fb \uff0c \u60f3\u5230\u4e86\u679a\u4e3e\u65b0\u5efa\u7684\u8fde\u7eed\u6bb5\u7684\u6570\u91cf\u548c\u5408\u5e76\u7684\u8fde\u7eed\u6bb5\u7684\u6570\u91cf\uff0c\u4e5f\u53d1\u73b0\u4e86\u4e24\u8005\u7684\u5dee\u662f\u5b9a\u503c\uff0c\u4f46\u662f\u5b8c\u5168\u6ca1\u6709\u60f3\u8fc7\u4e0d\u8003\u8651\u5408\u5e76\u8fd9\u4e9b\u64cd\u4f5c\uff0c\u53ea\u662f\u8003\u8651\u63d2\u677f\u7684\u76f8\u5bf9\u4f4d\u7f6e  \u3002\n\n$f_{i}$ \u8868\u793a\u4e24\u4e2a\u7aef\u70b9\u90fd\u6ca1\u6709\u88ab\u94a6\u5b9a\uff0c\u6709\u6070\u597d $i$  \u4e2a\u8fde\u7eed\u6bb5\u7684\u65b9\u6848\u6570\u3002\n\n$g_i$ \u8868\u793a\u7aef\u70b9\u88ab\u94a6\u5b9a\u4e00\u4e2a\uff0c \u6709\u6070\u597d  $i$ \u4e2a\u8fde\u7eed\u6bb5\u7684\u65b9\u6848\u6570\u3002\n\n$h_i$ \u8868\u793a\u7aef\u70b9\u90fd\u88ab\u94a6\u5b9a\u4e86\uff0c \u6709\u6070\u597d  $i$ \u4e2a\u8fde\u7eed\u6bb5\u7684\u65b9\u6848\u6570\u3002\n\n\u6709\u8f6c\u79fb\n\n$f' , g' , h'$ \u8868\u793a\u65b0\u7684 $f , g,h$\n\n$f'_{A-i} = f_i \\times \\binom {A-1} j  $\n\n$g'_{A - i + 1} = f_i \\times \\binom {A-1} {j-1}\\times 2 + g_i \\times \\binom{A-1}{j-1}  $\n\n$h'_{A_i+2}  = f_i \\times \\binom {A-1} {j-2}+ g_i \\times \\binom{A-1}{j-2} + h_i \\times \\binom {A-1}{j-2}  $\n\n\n\n\u6ce2\u7279\u4eec\u90fd\u8bf4\u8fd9\u9898\u795e\u4ed9\u5728\u72b6\u6001\u6570\u662f $O(n)$ \u7684\uff0c\u8f6c\u79fb\u5f88\u7b80\u5355\u3002\n\n\u6211\u53cd\u800c\u89c9\u5f97\u72b6\u6001\u6570 $O(n)$ \u633a\u663e\u7136\u7684 \uff0c \u8f6c\u79fb\u624d\u662f\u5999\u70b9\u3002\n\n\u5c31\u62ff $ f \\to f'$ \u6765\u4e3e\u4f8b\u5b50\u3002\n\n\u8f6c\u79fb\u5230\u7684\u76ee\u6807\u662f $A - i$ \u5f88\u597d\u7406\u89e3\u3002\n\n\u5c31\u662f\u4f60\u5f97\u5728\u6bcf\u4e2a\u539f\u6765\u7684\u6bb5\u4e24\u8fb9\u90fd\u5f97\u6709\u4e24\u4e2a\u76ee\u524d\u7684\u6570\u624d\u884c\uff0c\u8fd9\u6837\u4f60\u5c31\u6709\u4e86 $j$ \u6bb5 \uff0c \u518d\u628a\u5176\u5b83 $n - 2j$ \u4e2a\u52a0\u8fdb\u53bb\u5c31\u662f $n - j$ \u6bb5 \uff0c\u8fd9\u65f6\u5019\u5408\u5e76\u4e24\u4e2a\u6bb5\u5c31\u662f\u62ff\u4e00\u4e2a\u4e2d\u95f4\u7684\u8d70 \uff0c\u7531\u4e8e\u8981\u628a\u76ee\u524d\u7684\u6570\u5168\u90e8\u653e\u5b8c\uff0c\u5c31\u5f97\u65b0\u5efa\u4e00\u4e2a\u6bb5\uff0c\u6240\u4ee5\u603b\u6bb5\u6570\u4ecd\u7136\u662f $n - j$ \u3002\n\n\u8fd9\u4e2a\u7cfb\u6570\u7684\u6765\u6e90\u662f\u8fd9\u6837\u7684\u3002\n\n\u8003\u8651\u5148\u653e\u4e86 $j + 1$ \u6570\u8fdb\u6bcf\u4e2a\u6bb5\u7684\u53f3\u8fb9\u4ee5\u53ca\u6700\u5de6\u8fb9\u6bb5\u7684\u5de6\u8fb9 \uff0c \u73b0\u5728\u8fd8\u5269  $A - j - 1$ \u4e2a\u6570  \uff0c \u8981\u628a\u8fd9\u4e9b\u6570\u63d2\u5230 $j$ \u6bb5\u5f62\u6210\u7684 $n + 1$ \u4e2a\u96c6\u5408\uff0c\u6240\u4ee5\u65b9\u6848\u6570\u662f $\\binom {A-1} j  $ \u3002\n\nQ\uff1a\u4e3a\u4ec0\u4e48\u63d2\u677f\u7684\u7ec4\u5408\u610f\u4e49\u548c\u8fde\u7eed\u6bb5\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\uff1f\n\nA\uff1a\u73b0\u5728\u7684\u5047\u8bbe\u4e0b\uff0c\u6240\u6709\u6bb5\u90fd\u88ab\u5408\u5e76\u6210\u4e86\u4e00\u6bb5\uff0c\u5728\u6700\u5de6\u3001\u6700\u53f3\u63d2\u6570\uff0c\u5b9e\u9645\u610f\u4e49\u662f\u5728\u6700\u8fd9\u91cc\u65b0\u5efa\uff0c\u5728\u5176\u5b83\u4f4d\u7f6e\u63d2\u677f\u7b2c\u4e00\u6b21\u662f\u5c06\u8fd9\u91cc\u201c\u65ad\u5f00\u201d\u6210\u4e24\u4e2a\u8fde\u7eed\u6bb5 \uff0c \u5373\u9009\u62e9\u4e0d\u5408\u5e76\uff0c\u540e\u9762\u518d\u63d2\u677f\u5373\u662f\u65b0\u5efa\u3002\n\n\u5176\u5b83\u5f0f\u5b50\u7684\u7ec4\u5408\u610f\u4e49\u7c7b\u4f3c\u3002\n\nQ\uff1a\u4e3a\u5565\u663e\u7136 dp \u7684\u72b6\u6001\u662f $O(n)$ \u7684\u3002\n\nA\uff1a\n\n\u8003\u8651\u5f52\u7eb3\n\n\u4ee4 $S_i = A_i - S_{i-1}$ \uff0c  \n\n\u5bf9\u4e8e\u6bcf\u4e2a\u65f6\u523b\u3002\n\n\u663e\u7136 $f$ \u7684\u53d6\u503c\u53ea\u6709\u4e00\u79cd $S_i$ \uff0c $g$ \u4ece $f$ \u8f6c\u79fb\u8fc7\u6765\u7684\u503c\u53ea\u6709$S_i  + 1$ \u3002 \n\n\u5047\u8bbe\u4ee5\u53ca\u8bc1\u660e\u4e86\u4e4b\u524d\u7684\u53d6\u503c\u53ea\u6709 $S_i ,S_i + 1$ \n\n\u90a3\u4e48\u8fd9\u4e00\u6b65\u4e5f\u53ea\u4f1a\u4ea7\u751f $S_i , S_i + 1$ \uff0c\n\u6700\u5f00\u59cb\u53c8\u53ea\u6709 $S_i + 1$\u3002\n\n\u5bf9 $h$  \u7684\u8bc1\u660e\u540c\u7406\u3002\n\n\n",
        "postTime": 1668667770,
        "uid": 161697,
        "name": "\u10e6\ua9bf\u0fd0",
        "ccfLevel": 7,
        "title": "\u3010\u9898\u89e3\u3011 ARC146E Simple Speed"
    },
    {
        "content": "\u795e\u4ed9\u9898\u3002\n\n\u7531\u4e8e $\\sum A_i$ \u7279\u522b\u5927\uff0c\u6240\u4ee5\u4ece\u5e8f\u5217\u957f\u5ea6\u89d2\u5ea6 dp \u662f\u4f1a\u5bc4\u7684\u3002\u4e8e\u662f\u8003\u8651\u4ece\u503c\u57df\u89d2\u5ea6 dp\u3002\n\n\u8bbe $f_{i,j}$ \u8868\u793a\u73b0\u5728\u586b\u5b8c\u4e86 $[1,i]$ \u7684\u6240\u6709\u6570\uff0c\u4e00\u5171\u4ea7\u751f\u4e86 $j$ \u6bb5\u7684\u65b9\u6848\u6570\u3002\u6ce8\u610f\u6b64\u72b6\u6001\u8bbe\u8ba1\u53ea\u5728\u4e4e\u4ea7\u751f\u4e86\u591a\u5c11\u6bb5\uff0c\u4e0d\u5728\u4e4e\u6bcf\u6bb5\u7684\u5177\u4f53\u4f4d\u7f6e\u3002\n\n\u663e\u7136\u6bcf\u4e00\u6bb5\u7684\u5de6\u7aef\u548c\u53f3\u7aef\u5fc5\u987b\u662f $i$\uff0c\u5e76\u4e14\u5fc5\u987b\u8981\u63a5\u4e00\u4e2a $i+1$\u3002\n\n\u4f46\u662f\u4f60\u4f1a\u53d1\u73b0\u8fd9\u6837\u5b50\u505a\u4e0d\u4e86\uff0c\u539f\u56e0\u662f\u6700\u5de6\u7aef\u548c\u6700\u53f3\u7aef\u4e0d\u4e00\u5b9a\u8981\u63a5\u4e00\u4e2a $i+1$\u3002\u6240\u4ee5\u518d\u52a0\u4e00\u7ef4 $k=0/1/2$\uff0c\u8868\u793a\u5de6\u7aef\u548c\u53f3\u7aef\u4e0d\u80fd\u52a0\u6570\u7684\u4f4d\u7f6e\u4e2a\u6570\u3002\n\n\u8003\u8651\u5982\u4f55\u8f6c\u79fb\uff1a\n\n\u5bf9\u4e8e `... i i+1 i ...` \u8fd9\u79cd\u60c5\u51b5\uff0c\u4e2d\u95f4\u7684 `i+1` \u76f8\u5f53\u4e8e\u628a\u5de6\u53f3\u4e24\u6bb5\u8fde\u4e86\u8d77\u6765\u3002\n\n\u800c\u5bf9\u4e8e `... i i+1 i+2 i+1 i ...` \u8fd9\u79cd\u60c5\u51b5\uff0c\u5de6\u8fb9\u7684 `i+1` \u53ef\u4ee5\u770b\u4f5c\u628a\u5de6\u53f3\u4e24\u6bb5\u8fde\u4e86\u8d77\u6765\uff0c\u800c\u53f3\u8fb9\u7684 `i+1` \u53ef\u4ee5\u770b\u6210\u65b0\u52a0\u4e86\u4e00\u6bb5\uff0c\u8fd9\u6837\u5b50\u662f\u53ef\u4ee5\u7684\u3002\n\n\u7531\u4e8e\u6211\u4eec\u4e0d\u5728\u4e4e\u4f4d\u7f6e\u5173\u7cfb\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5728\u76f8\u90bb\u4e24\u6bb5\u4e4b\u95f4\u5f3a\u5236\u585e\u4e00\u4e2a $i+1$\uff0c\u800c\u6700\u5de6\u7aef\u548c\u6700\u53f3\u7aef\u53ef\u80fd\u4e5f\u8981\u585e\u4e00\u4e2a\u6570\u3002\u4e8e\u662f\u4e0d\u59a8\u8bbe\u6700\u5de6\u7aef\u548c\u6700\u53f3\u7aef\u90fd\u4e0d\u585e\uff0c\u90a3\u4e48\u65b9\u6848\u6570\u76f8\u5f53\u4e8e\u628a\u5269\u4e0b $A_{i+1}-(j-1)$ \u4e2a\u6570\u585e\u5230 $j-1$ \u4e2a\u7f1d\u91cc\u9762\uff0c\u8fd9\u662f\u4e00\u4e2a\u7ecf\u5178\u7ec4\u5408\u6570\u5b66\u95ee\u9898\uff0c\u65b9\u6848\u6570\u4e3a $A_{i+1}-1\\choose j-2$\u3002\u800c\u5bf9\u4e8e\u5269\u4e0b $A_{i+1}-(j-1)$ \u4e2a\u6570\uff0c\u6bcf\u585e\u4e00\u4e2a\u6570\u5c31\u4f1a\u591a\u4e00\u4e2a\u6bb5\uff0c\u6240\u4ee5\u6700\u7ec8\u6709\u591a\u5c11\u6bb5\u662f\u80fd\u7b97\u51fa\u6765\u7684\u3002\u5176\u4ed6\u60c5\u51b5\u540c\u7406\u3002\u90a3\u4e48\u6211\u4eec\u5c31\u89e3\u51b3\u4e86\u8f6c\u79fb\u7684\u95ee\u9898\u3002\n\n\u7ec6\u8282\uff1a\u5f53\u8f6c\u79fb\u540e\u5de6\u53f3\u4e24\u7aef\u53ea\u6709\u4e00\u7aef\u80fd\u7ee7\u7eed\u63a5\uff0c\u4f46\u662f\u4e4b\u524d\u4e24\u7aef\u90fd\u53ef\u4ee5\u63a5\uff0c\u65b9\u6848\u6570\u9700\u8981 $\\times 2$\u3002\n\n\u4e8b\u5b9e\u4e0a\uff0c\u5982\u679c\u4ed4\u7ec6\u89c2\u5bdf\u4e00\u4e0b\u5f0f\u5b50\uff0c\u4f60\u4f1a\u53d1\u73b0 $j$ \u7684\u6570\u91cf\u548c $k$ \u7684\u6570\u91cf\u662f\u4e00\u4e2a\u91cf\u7ea7\u7684\uff0c\u6240\u4ee5 $f$ \u7684\u53ef\u884c\u72b6\u6001\u6570\u91cf\u4e5f\u662f $O(n)$ \u7684\uff0c\u76f4\u63a5 dp \u5373\u53ef\uff0c\u5177\u4f53\u5b9e\u73b0\u53ef\u4ee5\u4f7f\u7528 `map` \u6216 `unordered_map`\u3002\n\n```cpp\n#include <iostream>\n#include <map>\n\nusing namespace std;\nusing LL = long long;\nusing Pll = pair<LL, LL>;\n\nconst int kN = 2e5 + 1;\nconst LL kM = 998244353;\n\nint n, a[kN], v;\nLL l, fc[kN], iv[kN];\nmap<LL, LL> f[kN][3];\n\nLL P(LL b, int e) {\n  LL s = 1;\n  for (; e; e >>= 1, b = b * b % kM) {\n    (e & 1) && (s = s * b % kM);\n  }\n  return s;\n}\nLL C(int n, int m) { return fc[n - 1] * iv[m - 1] % kM * iv[n - m] % kM; }\nvoid T(int i, LL j, int k, int nk, LL v) {\n  int nj = j - nk + 1;\n  if (a[i + 1] >= nj) {\n    LL c = C(a[i + 1], nj) * (1 + (nk == 1 && k != 1));\n    LL &_f = f[i + 1][nk][1 + a[i + 1] - nj];\n    _f = (_f + c * v % kM) % kM;\n  }\n}\n\nint main() {\n  ios_base::sync_with_stdio(0), cin.tie(0), cout.tie(0);\n  for (int i = fc[0] = 1; i < kN; ++i) {\n    fc[i] = fc[i - 1] * i % kM;\n  }\n  iv[kN - 1] = P(fc[kN - 1], kM - 2);\n  for (int i = kN - 1; i; --i) {\n    iv[i - 1] = iv[i] * i % kM;\n  }\n  cin >> n;\n  for (int i = 1; i <= n; ++i) {\n    cin >> a[i];\n    l += a[i];\n  }\n  T(0, 0, 0, 0, 1);\n  for (int i = 1; i < n; ++i) {\n    for (int k = 0; k < 3; ++k) {\n      for (Pll j : f[i][k]) {\n        for (int nk = k; nk < 3; ++nk) {\n          T(i, j.first, k, nk, j.second);\n        }\n      }\n    }\n  }\n  cout << (f[n][0][1] + f[n][1][1] + f[n][2][1]) % kM;\n  return 0;\n}\n```",
        "postTime": 1671083506,
        "uid": 376161,
        "name": "wsfxk",
        "ccfLevel": 6,
        "title": "[ARC146E] Simple Speed \u9898\u89e3"
    },
    {
        "content": "\u65e0\u975e\u6709\u4e24\u79cd dp \u65b9\u5f0f\uff0c\u4e00\u79cd\u4ee5\u5e8f\u5217\u4e3a\u9636\u6bb5\uff0c\u4ece\u5de6\u5230\u53f3 dp\uff1b\u4e00\u79cd\u4ee5\u503c\u4e3a\u9636\u6bb5\uff0c\u4ece\u5c0f\u5230\u5927\u586b\u503c\u3002\u524d\u8005\u590d\u6742\u5ea6\u663e\u7136\u7206\u70b8\uff0c\u6545\u8003\u8651\u540e\u8005\u3002\n\n\u53d1\u73b0\u82e5\u586b\u5b8c\u503c $i$ \u540e\u8981\u586b $i+1$\uff0c\u6211\u4eec\u4f1a\u600e\u4e48\u586b\u5462\uff1f\u9996\u5148\u80af\u5b9a\u4f1a\u5728\u6240\u6709\u76f8\u90bb\u4f4d\u7f6e\u503c $i$ \u4e4b\u95f4\u653e\u4e0a $i+1$ \u5c06\u5176\u9694\u5f00\uff0c\u7136\u540e\u82e5\u4e0d\u8003\u8651\u4e24\u4fa7\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u5269\u4e0b\u7684 $i+1$ \u653e\u5728\u5df2\u7ecf\u586b\u5165\u7684 $i+1$ \u65c1\u8fb9\u2014\u2014\u503c $i+1$ \u5728 $i+2$ \u586b\u5165\u4e4b\u524d\uff0c\u4e00\u5b9a\u53ea\u4f1a\u4e0e $i$ \u6216 $i+1$ \u76f8\u90bb\u3002\n\n\u90a3\u4e48\u8bbe\u4e4b\u524d\u6709 $j$ \u5bf9\u76f8\u90bb\u7684\u503c $i$\uff0c\u73b0\u5728\u8981\u586b\u5165 $a_{i+1}$ \u4e2a $i+1$\uff0c\u6839\u636e\u9694\u677f\u6cd5\uff0c\u5219\u65b9\u6848\u6570\u4e3a $C^{j-1}_{a_{i+1}-1}$\u3002 \n\n\u73b0\u5728\u8003\u8651\u4e24\u4fa7\uff0c\u4e0d\u96be\u60f3\u5230\u53ea\u6709\u5f53\u6700\u5de6/\u53f3\u7aef\u4e3a $i$ \u65f6\uff0c\u624d\u53ef\u80fd\u5728\u8be5\u7aef\u586b\u5165 $i+1$\uff1b\u4e14\u82e5\u4e0d\u586b\u5165\uff0c\u586b $i+2$ \u65f6\u4e00\u5b9a\u4e0d\u80fd\u518d\u586b\u5230\u4e24\u4fa7\u3002\n\n\u6b64\u65f6\u72b6\u6001\u5df2\u7ecf\u5f88\u660e\u6670\u4e86\uff01\u4e0d\u59a8\u8bbe $dp_{i,j,0/1/2}$ \u8868\u793a\u586b\u5b8c\u503c $1\\sim i$\uff0c\u5f53\u524d\u6709 $j$ \u5bf9 $i$ \u76f8\u90bb\uff0c\u4e14\u4e24\u7aef\u90fd\u4e3a $i$ / \u4e00\u7aef\u4e3a $i$ / \u4e24\u7aef\u90fd\u4e0d\u4e3a $i$ \u65f6\u7684\u65b9\u6848\u6570\u3002\u5bf9\u4e8e\u591a\u586b\u4e00\u4fa7\u6216\u4e24\u4fa7\u7684\u60c5\u51b5\uff0c\u9694\u677f\u6cd5\u7b97\u7ec4\u5408\u6570\u65f6\u591a\u5206\u4e00\u4e2a\u6bb5\u5373\u53ef\u3002\n\n\u4e0d\u8fc7\u5230\u76ee\u524d\u4e3a\u6b62\u6211\u4eec\u8868\u9762\u4e0a\u7684\u590d\u6742\u5ea6\u4f9d\u7136\u4e3a $O(n|a|)$\u3002\n\n\u4f46\u662f\u6ce8\u610f\u5230\u4e0a\u4e00\u9636\u6bb5\u4f5c\u4e3a\u72b6\u6001\u7684 $j'$ \u5728\u8f6c\u79fb\u5230\u5f53\u524d\u9636\u6bb5\u65f6\uff0c\u90fd\u4f1a\u88ab\u5f53\u524d\u9636\u6bb5\u7684 $j$ \u51cf\u53bb\uff0c\u6545\u6839\u636e\u52bf\u80fd\u5206\u6790\uff0c\u82e5\u4e0d\u7b97\u6700\u540e\u4e00\u7ef4\uff0c\u603b\u72b6\u6001\u6570\u81f3\u591a\u4e3a $|a|$\u3002\u52a0\u4e0a\u6700\u540e\u4e00\u7ef4\u540e\u72b6\u6001\u6570\u53ea\u4f1a\u6709\u5e38\u6570\u4e0a\u7684\u53d8\u52a8\uff0c\u603b\u590d\u6742\u5ea6\u4f9d\u65e7\u4e3a $O(n)$\u3002\n\n\u6545\u8f6c\u79fb\u65f6\u7528\u4e2a map \u4e4b\u7c7b\u7684\u4e1c\u897f\u8f85\u52a9\u8f6c\u79fb\u5373\u53ef\uff0c\u53ef\u4ee5\u518d\u5f00\u4e2a vector \u8bb0\u5f55\u5f53\u524d\u90fd\u6709\u54ea\u4e9b\u72b6\u6001\uff0c\u4e0d\u8fc7\u9700\u8981\u53bb\u91cd\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=2e5+5;\nconst int V=2e5+2;\nconst int mod=998244353;\nint n,a[N];\nll jc[N],inv[N];\nmap<int,ll> dp[N][3];\nvector<int> ve[N][3];\nbool vis[N][3];\nint read(){\n\tint w=0,fh=1;\n\tchar c=getchar();\n\twhile (c>'9'||c<'0'){\n\t\tif (c=='-') fh=-1;\n\t\tc=getchar();\n\t}\n\twhile (c>='0'&&c<='9'){\n\t\tw=(w<<3)+(w<<1)+(c^48);\n\t\tc=getchar();\n\t}\n\treturn w*fh;\n}\nll ksm(ll x,ll y){\n\tll ans=1;\n\twhile (y){\n\t\tif (y&1) ans=ans*x%mod;\n\t\tx=x*x%mod;\n\t\ty>>=1;\n\t}\n\treturn ans;\n}\nvoid init(){\n\tjc[0]=inv[0]=1;\n\tfor (int i=1;i<=V;i++) jc[i]=jc[i-1]*i%mod;\n\tinv[V]=ksm(jc[V],mod-2);\n\tfor (int i=V-1;i>=1;i--) inv[i]=inv[i+1]*(i+1)%mod;\n}\nll C(int x,int y){\n\tif (x<y) return 0;\n\treturn jc[x]*inv[y]%mod*inv[x-y]%mod;\n}\nint main(){\n#ifndef ONLINE_JUDGE\n\tfreopen(\"in.in\",\"r\",stdin);\n\t// freopen(\"out.out\",\"w\",stdout);\n#endif\n\tinit();\n\tn=read();\n\tfor (int i=1;i<=n;i++) a[i]=read();\n\tdp[1][0][a[1]-1]=1;\n\tve[1][0].push_back(a[1]-1);\n\tfor (int i=1;i<n;i++){\n\t\tint len=ve[i][0].size();\n\t\tfor (int x=0;x<len;x++){\n\t\t\tint j=ve[i][0][x];\n\t\t\tif (a[i+1]<j) continue;\n\t\t\tif (j>=1){\n\t\t\t\tdp[i+1][2][a[i+1]-j]=(dp[i+1][2][a[i+1]-j]+dp[i][0][j]*C(a[i+1]-1,j-1)%mod)%mod;\n\t\t\t\tif (!vis[a[i+1]-j][2]) ve[i+1][2].push_back(a[i+1]-j),vis[a[i+1]-j][2]=1;\n\t\t\t}\n\t\t\tif (a[i+1]<j+1) continue;\n\t\t\tdp[i+1][1][a[i+1]-j-1]=(dp[i+1][1][a[i+1]-j-1]+dp[i][0][j]*C(a[i+1]-1,j)*2ll%mod)%mod;\n\t\t\tif (!vis[a[i+1]-j-1][1]) ve[i+1][1].push_back(a[i+1]-j-1),vis[a[i+1]-j-1][1]=1;\n\t\t\tif (a[i+1]<j+2) continue;\n\t\t\tdp[i+1][0][a[i+1]-j-2]=(dp[i+1][0][a[i+1]-j-2]+dp[i][0][j]*C(a[i+1]-1,j+1)%mod)%mod;\n\t\t\tif (!vis[a[i+1]-j-2][0]) ve[i+1][0].push_back(a[i+1]-j-2),vis[a[i+1]-j-2][0]=1;\n\t\t}\n\t\tlen=ve[i][1].size();\n\t\tfor (int x=0;x<len;x++){\n\t\t\tint j=ve[i][1][x];\n\t\t\tif (a[i+1]<j) continue;\n\t\t\tif (j>=1){\n\t\t\t\tdp[i+1][2][a[i+1]-j]=(dp[i+1][2][a[i+1]-j]+dp[i][1][j]*C(a[i+1]-1,j-1)%mod)%mod;\n\t\t\t\tif (!vis[a[i+1]-j][2]) ve[i+1][2].push_back(a[i+1]-j),vis[a[i+1]-j][2]=1;\n\t\t\t}\n\t\t\tif (a[i+1]<j+1) continue;\n\t\t\tdp[i+1][1][a[i+1]-j-1]=(dp[i+1][1][a[i+1]-j-1]+dp[i][1][j]*C(a[i+1]-1,j)%mod)%mod;\n\t\t\tif (!vis[a[i+1]-j-1][1]) ve[i+1][1].push_back(a[i+1]-j-1),vis[a[i+1]-j-1][1]=1;\n\t\t}\n\t\tlen=ve[i][2].size();\n\t\tfor (int x=0;x<len;x++){\n\t\t\tint j=ve[i][2][x];\n\t\t\tif (a[i+1]<j) continue;\n\t\t\tif (j>=1){\n\t\t\t\tdp[i+1][2][a[i+1]-j]=(dp[i+1][2][a[i+1]-j]+dp[i][2][j]*C(a[i+1]-1,j-1)%mod)%mod;\n\t\t\t\tif (!vis[a[i+1]-j][2]) ve[i+1][2].push_back(a[i+1]-j),vis[a[i+1]-j][2]=1;\n\t\t\t}\n\t\t}\n\t\tlen=ve[i+1][0].size();\n\t\tfor (int x=0;x<len;x++){\n\t\t\tint j=ve[i+1][0][x];\n\t\t\tvis[j][0]=0;\n\t\t}\n\t\tlen=ve[i+1][1].size();\n\t\tfor (int x=0;x<len;x++){\n\t\t\tint j=ve[i+1][1][x];\n\t\t\tvis[j][1]=0;\n\t\t}\n\t\tlen=ve[i+1][2].size();\n\t\tfor (int x=0;x<len;x++){\n\t\t\tint j=ve[i+1][2][x];\n\t\t\tvis[j][2]=0;\n\t\t}\n\t}\n\tcout<<(dp[n][0][0]+dp[n][1][0]+dp[n][2][0])%mod<<'\\n';\n\treturn 0;\n}\n```",
        "postTime": 1681436018,
        "uid": 257621,
        "name": "\u7ffc\u5fb7\u5929\u5c0a",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 [ARC146E] Simple Speed"
    },
    {
        "content": "**ARC146E**\n\n\u6a21\u62df\u8d5b\u7684 $\\text{T3}$\uff0c\u56e0\u4e3a\u88ab\u5de8\u5927\u591a\u90aa\u6076\u6df7\u4e71 $\\text{T1}$ \u7ed9\u9634\u95f4\u5230\u4e86\u6240\u4ee5\u8fd9\u9053\u9898\u4e5f\u88ab\u65e5\u6389\u4e86\u3002\u9752\u86d9\u3002\n\n---------------------------------------------------\n\n\u8003\u8651\u66b4\u529b\uff0c\u51ed\u611f\u89c9\u5f88[\u5730\u7cbe\u90e8\u843d](https://www.luogu.com.cn/problem/P2467)\u3002\n\n\u7ecf\u8fc7\u5927\u91cf\u7684\u624b\u73a9\uff0c\u6211\u4eec\u8003\u8651\u6211\u4eec\u7b54\u6848\u5e8f\u5217\u7684\u6027\u8d28\uff1a\u7531\u82e5\u5e72\u4e2a\u5355\u5cf0\u62fc\u5728\u4e00\u8d77\u7684\u5e8f\u5217\u3002\n\n\u90a3\u4e48\u4efb\u610f\u4e00\u4e2a\u6570 $\\text x$ \u9664\u4e86\u5728\u9996\u5c3e\uff0c\u4e24\u8fb9\u4e00\u5b9a\u662f $\\text x - \\text 1$\uff0c\u90a3\u4e48\u72b6\u6001\u5176\u5b9e\u662f\u5f88\u597d\u8bbe\u8ba1\u7684\uff1a\n\n\u4ee4 $\\text m$ \u4e3a\u5f53\u524d\u7684\u5e8f\u5217\u957f\u3002\u8bbe $\\text{dp}_{\\text i,\\text j,\\text 0/\\text 1,\\text 0/\\text 1}$ \u8868\u793a\u524d $\\text i$ \u79cd\u6570\u91cc\u9762\u6709 $\\text j$ \u4e2a\u4f4d\u7f6e $\\text p \\in [\\text 1,\\text m]$ \u6ee1\u8db3 $\\text a_{\\text p} = \\text a_{\\text p + \\text 1}$ \u4e14 $\\text a_{\\text p} = \\text i$\uff0c\u4ee5\u53ca $\\text a_{\\text 1}$ \u548c $\\text a_{\\text m}$ \u662f\u5426\u4e3a $\\text i$\u3002\n\n\u8fd9\u4e48\u8f6c\u79fb\u7684\u6b63\u786e\u6027\u663e\u7136\uff0c\u56e0\u4e3a $\\text i$ \u7684\u4f4d\u7f6e\u672c\u8d28\u4e0a\u662f\u4f9d\u8d56\u4e86\u6240\u6709 $\\text i - \\text 1$ \u548c $\\text i + \\text 1$ \u7684\u4f4d\u7f6e\uff0c\u6240\u4ee5\u5728\u786e\u5b9a\u4e86 $\\text i$ \u7684\u4f4d\u7f6e\u548c $\\text i - \\text 1$ \u7684\u4f4d\u7f6e\u662f\u5fc5\u987b\u786e\u5b9a\u7684\uff08\u76f8\u90bb\uff09\uff0c\u5e76\u4e14\u6211\u4eec\u4fdd\u7559\u4efb\u610f\u7b54\u6848\u7684\u5927\u5c0f\u5728 $\\leq \\text i$ \u4ee5\u5185\u7684\u6570\u540e\u53ef\u4ee5\u53d1\u73b0\u9664\u4e86\u5927\u5c0f\u4e3a $\\text i$ \u7684\u6570\u4ee5\u5916\u5176\u5b83\u4f4d\u7f6e\u90fd\u662f\u5408\u6cd5\u7684\uff0c\u5e76\u4e14\u503c\u4e3a $\\text i$ \u7684\u4f4d\u7f6e\u90fd\u662f\u8fde\u7eed\u7684\u3002\n\n\u5237\u4e2a\u8868\u3002\u663e\u7136 $\\text{dp}_{\\text 0,\\text 0} \\rightarrow \\text{dp}_{\\text 0,\\text 0},\\text {dp}_{0,1} \\rightarrow \\{\\text{dp}_{\\text 0,\\text 0},\\text {dp}_{0,1}\\},\\text {dp}_{1,0} \\rightarrow \\{\\text{dp}_{\\text 0,\\text 0},\\text {dp}_{1,0}\\},\\text {dp}_{1,1} \\rightarrow \\{\\text{dp}_{\\text 0,\\text 0},\\text {dp}_{1,0},\\text{dp}_{\\text 1,\\text 0},\\text {dp}_{1,1}\\}$\uff0c\u8f6c\u79fb\u7684\u65f6\u5019\u7528\u63d2\u677f\u6cd5\u7b97\u4e00\u4e0b\u5c31\u884c\u4e86\uff0c\u8fd9\u4e2a\u4e0d\u5177\u4f53\u5c55\u5f00\u4e86\u3002\n\n\u7136\u540e\u5173\u952e\u70b9\u662f\u8fd9\u4e2a\u72b6\u6001\u5f88\u5c11\u8be5\u600e\u4e48\u7406\u89e3\u3002\u4f60\u968f\u51e0\u4e2a\u5e8f\u5217\u6765\u6253\u8868\u662f\u53ef\u4ee5\u5c1d\u8bd5\u89c2\u5bdf\u7684\uff0c\u4f60\u76f4\u89c2\u611f\u53d7\u4f1a\u53d1\u73b0\u5f53 $\\text n$ \u5927\u4e86\u540e\u5bf9\u4e8e $\\text A_{\\text i}$ \u7684\u9650\u5236\u8d8a\u6765\u8d8a\u4e25\u683c\uff0c\u5426\u5219\u7b54\u6848\u5f88\u6709\u53ef\u80fd\u4e3a $\\text 0$\u3002\n\n\u4e00\u4e2a\u6bd4\u8f83\u7b80\u5355\u7684\u7406\u89e3\uff1a\u6211\u4eec\u8003\u8651\u8f6c\u79fb\u65f6\uff0c\u4f8b\u5982\u5f53\u524d\u4e3a $\\text j$\uff0c\u90a3\u4e48\u53ef\u80fd\u50cf $\\text c_{i + 1} - \\text j - \\text o$\uff0c\u5176\u4e2d $\\text o \\in \\{0,1,2\\}$\u3002\u89c2\u5bdf\u8fde\u7eed\u7684\u4e09\u8f6e\uff0c\u53d1\u73b0\u5982\u679c\u7b2c\u4e00\u8f6e\uff0c\u7b2c\u4e8c\u8f6e\u9009\u62e9\u4e86\u5728\u4e24\u8fb9\u653e\u7b49\u4ef7\u4e8e\u7b2c\u4e00\u8f6e\u7b2c\u4e8c\u8f6e\u4e0d\u5728\u4e24\u8fb9\u653e\u5f97\u5230\u7684 $\\text j$ \u7684\u72b6\u6001\uff0c\u6784\u9020\u6781\u5dee\u5927\u81f4\u662f\u7b2c\u4e00\u8f6e\u4e24\u8fb9\u90fd\u4e0d\u653e\u7136\u540e\u7b2c\u4e8c\u8f6e\u90fd\u4e0d\u653e\uff0c\u53ef\u4ee5\u5f97\u5230\u6240\u6709\u72b6\u6001 $\\text j$ \u7684\u6781\u5dee\u662f $\\text 5$\uff0c\u5f00\u4e2a $\\text{map}$ \u76f4\u63a5\u8f6c\u79fb\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\text O(\\text n \\log \\text n)$\u3002\n\n```cpp\n#include \"bits/stdc++.h\"\nusing namespace std;\nconst int Len = 5e5 + 5 , mod = 998244353 , M = 5e5;\nint n,m,c[Len],fac[Len],invf[Len];\ninline void Mod(int &x){if(x < 0) x += mod;if(x >= mod) x -= mod;}\nmap<int,int> dp[Len][2][2];\ninline int qpow(int a,int b)\n{\n\tint res = 1;\n\twhile(b)\n\t{\n\t\tif(b & 1) res = 1ll * res * a % mod;\n\t\ta = 1ll * a * a % mod;\n\t\tb = b >> 1;\n\t}\n\treturn res;\n}\ninline int C(int N,int M){return 1ll * fac[N] * invf[N - M] % mod * invf[M] % mod;}\nmap<int,int>::iterator it;\nint main()\n{\n\tscanf(\"%d\",&n);fac[0] = 1;for(int i = 1 ; i <= M ; i ++) fac[i] = 1ll * fac[i - 1] * i % mod;\n\tinvf[M] = qpow(fac[M] , mod - 2);invf[0] = 1;\n\tfor(int i = M - 1 ; i >= 1 ; i --) invf[i] = 1ll * invf[i + 1] * (i + 1) % mod; \n\tfor(int i = 1 ; i <= n ; i ++) scanf(\"%d\",&c[i]);\n\tdp[1][1][1][c[1] - 1] = 1;\n\tfor(int i = 1 ; i < n ; i ++)\n\t{\n\t\t//\u5fc5\u987b\u4fdd\u8bc1 i \u76f8\u90bb\u95f4\u9699\u7684\u60c5\u51b5\u90fd\u88ab\u586b\u6ee1 \n\t\t//0,0\n\t\tint j,w,to;\n\t\tfor(it = dp[i][0][0].begin() ; it != dp[i][0][0].end() ; it ++) \n\t\t{\n\t\t\tj = it -> first , w = it -> second;\n\t\t\tif(c[i + 1] >= j) \n\t\t\t{\n\t\t\t\tto = c[i + 1] - j;\n\t\t\t\tdp[i + 1][0][0][to] += 1ll * w * C(c[i + 1] - 1 , j - 1) % mod , Mod(dp[i + 1][0][0][to]);\n\t\t\t}\n\t\t}\n\t\t//0,1\n\t\tfor(it = dp[i][0][1].begin() ; it != dp[i][0][1].end() ; it ++)\n\t\t{\n\t\t\tj = it -> first , w = it -> second;\n\t\t\tif(c[i + 1] >= j)\n\t\t\t{\n\t\t\t\tto = c[i + 1] - j;\n\t\t\t\tdp[i + 1][0][0][to] += 1ll * w * C(c[i + 1] - 1 , j - 1) % mod , Mod(dp[i + 1][0][0][to]);\t\t\t\n\t\t\t}\n\t\t\tif(c[i + 1] >= j + 1)\n\t\t\t{\n\t\t\t\tto = c[i + 1] - j - 1;\n\t\t\t\tdp[i + 1][0][1][to] += 1ll * w * C(c[i + 1] - 1 , j) % mod , Mod(dp[i + 1][0][1][to]);\n\t\t\t}\n\t\t}\n\t\t//1,0\n\t\tfor(it = dp[i][1][0].begin() ; it != dp[i][1][0].end() ; it ++)\n\t\t{\n\t\t\tj = it -> first , w = it -> second;\n\t\t\tif(c[i + 1] >= j)\n\t\t\t{\n\t\t\t\tto = c[i + 1] - j;\n\t\t\t\tdp[i + 1][0][0][to] += 1ll * w * C(c[i + 1] - 1 , j - 1) % mod , Mod(dp[i + 1][0][0][to]);\t\t\t\n\t\t\t}\n\t\t\tif(c[i + 1] >= j + 1)\n\t\t\t{\n\t\t\t\tto = c[i + 1] - j - 1;\n\t\t\t\tdp[i + 1][1][0][to] += 1ll * w * C(c[i + 1] - 1 , j) % mod , Mod(dp[i + 1][1][0][to]);\n\t\t\t}\n\t\t}\n\t\t//1,1\n\t\tfor(it = dp[i][1][1].begin() ; it != dp[i][1][1].end() ; it ++)\n\t\t{\n\t\t\tj = it -> first , w = it -> second;\n\t\t\tif(c[i + 1] >= j)\n\t\t\t{\n\t\t\t\tto = c[i + 1] - j;\n\t\t\t\tdp[i + 1][0][0][to] += 1ll * w * C(c[i + 1] - 1 , j - 1) % mod , Mod(dp[i + 1][0][0][to]);\t\t\t\n\t\t\t}\n\t\t\tif(c[i + 1] >= j + 1)\n\t\t\t{\n\t\t\t\tto = c[i + 1] - j - 1;\n\t\t\t\tdp[i + 1][1][0][to] += 1ll * w * C(c[i + 1] - 1 , j) % mod , Mod(dp[i + 1][1][0][to]);\n\t\t\t\tdp[i + 1][0][1][to] += 1ll * w * C(c[i + 1] - 1 , j) % mod , Mod(dp[i + 1][0][1][to]);\n\t\t\t}\n\t\t\tif(c[i + 1] >= j + 2)\n\t\t\t{\n\t\t\t\tto = c[i + 1] - j - 2;\n\t\t\t\tdp[i + 1][1][1][to] += 1ll * w * C(c[i + 1] - 1 , j + 1) % mod , Mod(dp[i + 1][1][1][to]);\n\t\t\t}\n\t\t}\n\t}\n\tint as = 0;\n\tas += dp[n][0][0][0] , Mod(as);\n\tas += dp[n][0][1][0] , Mod(as);\n\tas += dp[n][1][0][0] , Mod(as);\n\tas += dp[n][1][1][0] , Mod(as);\n\tprintf(\"%d\\n\",as);\n\treturn 0;\n}\n/*\n2\n2 1\n*/\n```",
        "postTime": 1677311933,
        "uid": 132533,
        "name": "Hakuoro",
        "ccfLevel": 0,
        "title": "T1 \u523a\u5ba2\u3002\u5bb3\u4eba\u4e0d\u6d45\u3002"
    },
    {
        "content": "\u7b97\u662f\u81ea\u5df1\u60f3\u51fa\u6765\u7684\uff08\uff1f\uff09\n\n\u8003\u8651\u6309 $1,2,3,\\cdots,n$ \u7684\u987a\u5e8f\u5c06\u8fd9\u4e9b\u6570\u52a0\u5165\u5e8f\u5217\uff0c\u663e\u7136\uff0c\u6211\u4eec\u53ea\u5173\u5fc3\u52a0\u5b8c\u6240\u6709\u503c $\\le i$ \u7684\u6570\u4e4b\u540e\uff0c\u6709\u591a\u5c11\u4e2a\u76f8\u90bb\u7684\u6570\u5927\u5c0f\u90fd\u4e3a $i$\uff0c\u56e0\u4e3a\u5982\u679c\u5b58\u5728\u4e24\u4e2a\u76f8\u90bb\u76f8\u540c\u7684 $<i$ \u7684\u6570\u90a3\u4e48\u5728\u540e\u9762\u7684\u6b65\u9aa4\u4e2d\u6211\u4eec\u80af\u5b9a\u65e0\u6cd5\u5c06\u8fd9\u4e00\u5bf9\u6570\u6d88\u6389\u3002\u56e0\u6b64\u8fd9\u4e2a\u5e8f\u5217\u5fc5\u7136\u6ca1\u6cd5\u53d8\u6210\u5408\u6cd5\u7684\u5e8f\u5217\u3002\n\n\u601d\u8003\u4e00\u4e0b\u6211\u4eec\u6bcf\u6b21\u52a0\u5165\u6240\u6709\u503c $=i$ \u7684\u6570\u4f1a\u53d1\u751f\u4ec0\u4e48\u3002\u663e\u7136\u6211\u4eec\u9700\u8981\u7528 $i$ \u6765\u586b\u8865\u4e0a\u4e00\u8f6e\u76f8\u90bb\u7684 $i-1$ \u4e4b\u95f4\u7684\u7a7a\u9699\uff0c\u5269\u4e0b\u7684 $i$ \u6709\u4e24\u79cd\u9009\u62e9\uff1a\u8981\u4e48\u4e0e\u5df2\u6709\u7684 $i$ \u76f8\u90bb\u5f62\u6210\u8fde\u7eed\u6bb5\uff0c\u5982\u679c\u5e8f\u5217\u7684\u67d0\u4e00\u4fa7\u662f $i-1$\uff0c\u90a3\u4e48\u6211\u4eec\u8fd9\u4e2a $i$ \u8fd8\u53ef\u4ee5\u586b\u5728 $i-1$ \u7684\u8fb9\u4e0a\u3002\u6bd4\u65b9\u8bf4\u5982\u679c\u4e0a\u4e00\u8f6e\u662f $3,2,3,3,2,1,2,3,3$\uff0c\u90a3\u4e48\u4e0b\u4e00\u8f6e\u53ef\u4ee5\u53d8\u6210 $4,3,2,4,3,2,1,2,4,4,4,3,4,4$\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u540e\u4e00\u79cd\u8f6c\u79fb\u4e0e\u5f00\u5934\u548c\u7ed3\u5c3e\u4e2d\u6709\u591a\u5c11\u4e2a\u662f $i-1$ \u6709\u5173\uff08$0/1/2$\uff09\uff0c\u56e0\u6b64\u6211\u4eec\u989d\u5916\u8bb0\u5f55\u4e0b\u8fd9\u4e2a\u53d8\u91cf\u5373\u53ef\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u8bb0 $dp_{i,j,k}$ \u8868\u793a\u586b\u5165\u4e86\u524d $i$ \u4e2a\u6570\uff0c\u76ee\u524d\u6709 $j$ \u5bf9 $i$ \u76f8\u90bb\uff0c\u5f00\u5934\u548c\u7ed3\u5c3e\u6709 $k$ \u4e2a\u6570\u662f $i$ \u7684\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u63d2\u677f\u6cd5\u7b97\u4e00\u4e0b\u5373\u53ef\u3002\u6734\u7d20 DP \u662f $n^2$ \u7684\uff0c\u4e0d\u8fc7\u6ce8\u610f\u5230\u4e00\u4e2a\u6027\u8d28\uff1a\u8bb0 $c_i$ \u8868\u793a\u63d2\u5165\u503c $\\le i$ \u7684\u6570\u7684\u65f6\u5019\uff0c\u6bcf\u4e00\u6b65\u90fd\u4e0d\u5728\u8fb9\u4e0a\u653e $i$\uff0c\u8fd9\u6837\u4f1a\u6709\u591a\u5c11\u5bf9 $i$ \u76f8\u90bb\u2014\u2014\u663e\u7136\u8fd9\u662f\u4e00\u4e2a\u5b9a\u503c\uff0c\u90a3\u4e48\u6240\u6709\u53ef\u80fd\u7684 $j$ \u90fd\u5728 $c_i$ \u9644\u8fd1\uff0c\u5927\u6982\u679a\u4e3e $[c_i-7,c_i+7]$ \u5c31\u53ef\u4ee5\u8fc7\u4e86\u3002",
        "postTime": 1671607062,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "arc146E"
    },
    {
        "content": "\u4e0d\u662f\u5f88\u56f0\u96be\u7684\u4e00\u9053\u9898\uff08\u81f3\u5c11\u6211\u81ea\u5df1\u505a\u51fa\u6765\u4e86\u800c\u4e14\u8ba4\u4e3a\u6bd4\u8f83\u7b80\u5355\uff09\u3002\n\n\u8003\u8651\u4ece\u5c0f\u5f80\u5927\u653e\uff0c\u4e00\u4e9b $i+1$ \u53ea\u80fd\u653e\u5728\u76f8\u90bb\u4e24\u4e2a $i$ \u4e2d\u6216\u8005\u653e\u5728\u9760\u8fb9\u4e14\u6709\u4e00\u4e2a\u76f8\u90bb\u7684 $i$\u3002\u8bbe $dp_{i,j,u,v}$ \u8868\u793a\u586b\u5230\u4e86 $i$\uff0c\u6709 $j$ \u5bf9\u76f8\u90bb\u7684 $i$\uff0c\u5de6\u8fb9\u662f\u4e0d\u662f $i$\uff0c\u53f3\u8fb9\u662f\u4e0d\u662f $i$\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u6709\u4e86\u4e00\u4e2a $O(nV)$ \u7684\u505a\u6cd5\u3002\n\n\u5957\u8def\u5730\u60f3\u5230 $j$ \u8fd9\u4e00\u7ef4\u5e94\u8be5\u5f88\u5c11\u3002\u8003\u8651\u5982\u679c\u6211\u4e00\u76f4\u4e0d\u653e\u4e24\u8fb9\uff0c\u5219\u6bcf\u6b21\u7684 $j$ \u90fd\u662f\u786e\u5b9a\u7684\uff0c\u800c\u653e\u4e00\u4e2a\u653e\u4e24\u8fb9\u4f1a\u5bfc\u81f4 $1$ \u7684\u53d8\u5316\uff0c\u800c\u5982\u679c\u4e0a\u4e00\u4e2a\u548c\u8fd9\u4e00\u4e2a\u90fd\u653e\u4e86\u67d0\u4e00\u8fb9\uff0c\u5219\u8fd9\u4e00\u4e2a\u4e0d\u4f1a\u4ea7\u751f\u53d8\u5316\u3002\u6545 $j$ \u7684\u53d6\u503c\u4e0d\u8d85\u8fc7 $5$ \u4e2a\u3002\n\n\u76f4\u63a5 $dp$ \u5373\u53ef\uff0c\u590d\u6742\u5ea6 $O(n)$\u3002\n\n```\n#include<bits/stdc++.h>\nusing namespace std;\nconst int maxn=2e5+10;\nconst int mod=998244353;\n#define inf 1e9\ninline int read(){\n\tint x=0,f=1;char c=getchar();\n\twhile(c<'0'||c>'9'){if(c=='-')f=-1;c=getchar();}\n\twhile(c>='0'&&c<='9'){x=(x<<1)+(x<<3)+c-'0';c=getchar();}\n\treturn x*f;\n}\nconst int N=5e5+5;\nint fac[N+5],ifc[N+5],inv[N+5],n,m,a[maxn];\ninline int com(int x,int y){\n\tif(x<0||y<0||x<y)return 0;\n\treturn 1ll*fac[x]*ifc[y]%mod*ifc[x-y]%mod;\n}\n#define fr(i,lim) for(int i=0;i<=lim;i++)\nint dp[maxn][5][2][2],cur[maxn],ans;\ninline void add(int &x,int y){x=(x+y>=mod?x+y-mod:x+y);}\nint main(){\n\tn=read();fac[0]=ifc[0]=inv[1]=1;\n\tfor(int i=2;i<=N;i++)inv[i]=1ll*(mod-mod/i)*inv[mod%i]%mod;\n\tfor(int i=1;i<=N;i++)fac[i]=1ll*fac[i-1]*i%mod;\n\tfor(int i=1;i<=N;i++)ifc[i]=1ll*ifc[i-1]*inv[i]%mod;\n\tfor(int i=1;i<=n;i++)a[i]=read();\n\tdp[1][2][1][1]=1;cur[1]=a[1]-1;\n\tfor(int i=2;i<=n;i++){\n\t\tcur[i]=a[i]-cur[i-1];\n\t\tfr(j,4)fr(u,1)fr(v,1)if(dp[i-1][j][u][v]){\n\t\t\tint val=dp[i-1][j][u][v],c=cur[i-1]+j-2;\n\t\t\tfr(p,u)fr(q,v){\n\t\t\t\tif(!p&&!q)add(dp[i][4-j][p][q],1ll*val*com(a[i]-1,c-1)%mod);\n\t\t\t\telse if(p&&q)add(dp[i][2-j][p][q],1ll*val*com(a[i]-1,c+1)%mod);\n\t\t\t\telse if(p)add(dp[i][3-j][p][q],1ll*val*com(a[i]-1,c)%mod);\n\t\t\t\telse add(dp[i][3-j][p][q],1ll*val*com(a[i]-1,c)%mod);\n\t\t\t}\n\t\t}\n\t}\n\tfr(i,4)if(cur[n]+i-2==0)\n\t\tfr(u,1)fr(v,1)add(ans,dp[n][i][u][v]);\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n\n\u6df1\u6df1\u5730\u611f\u5230\u81ea\u5df1\u7684\u6e3a\u5c0f\u3002",
        "postTime": 1671514743,
        "uid": 140876,
        "name": "syzf2222",
        "ccfLevel": 9,
        "title": "ARC146E Simple Speed"
    }
]