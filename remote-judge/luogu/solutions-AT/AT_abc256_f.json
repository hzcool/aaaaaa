[
    {
        "content": "## \u524d\u8a00\n\n[\u9898\u76ee\u4f20\u9001\u95e8\uff01](https://www.luogu.com.cn/problem/AT_abc256_f)\n\n[\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\uff1f](https://www.cnblogs.com/liangbowen/p/17392003.html)\n\ntrick\uff1a\u5c06 $D_x$ \u7528 $A_x$ \u6765\u8868\u793a\u3002\n\n## \u601d\u8def\n\n\u9996\u5148 $B_x = \\sum\\limits_{i=1}^x A_i$\u3002\u63a5\u7740\u7b97 $C_x$\uff0c\u8fd9\u4e2a\u5e76\u4e0d\u56f0\u96be\uff1a\n\n$$\nC_x = \\sum\\limits_{i=1}^xB_i = \\sum\\limits_{i=1}^x\\sum\\limits_{j=1}^i A_j\n$$\n\n\u638f\u4e00\u4e2a\u8868\u683c\u8bb0\u5f55\u5b83\u3002\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/o5gzjvqo.png)\n\n\u5373 $C_x = \\sum\\limits_{i=1}^x (x-i+1)A_x$\u3002\n\n\u7c7b\u4f3c\u5730\uff0c\u5bf9\u4e8e $D_x$\uff0c\u5c06\u5f0f\u5b50\u62c6\u5f00\u518d\u7ec4\u5408\u56de\u6765\uff0c\u5316\u7b80\uff1a\n\n$$\n\\begin{aligned}\nD_x\n& = \\sum\\limits_{i=1}^x C_i \\\\\n& = \\sum\\limits_{i=1}^x \\sum\\limits_{j=1}^x (x-j+1)A_j \\\\\n& = \\sum\\limits_{i=1}^x\\cdot A_1 + \\sum\\limits_{i=1}^{x-1} A_2 + \\sum\\limits_{i=1}^{x-2} A_3 + \\cdots + A_x \\\\\n& = \\dfrac{x(x+1)}2 \\cdot A_1 + \\dfrac{(x-1)x}2 \\cdot A_2 + \\dfrac{(x-2)(x-1)}2 \\cdot A_3 + \\cdots + A_x \\\\\n& = \\sum\\limits_{i=1}^x A_i \\cdot \\dfrac{(x-i+1)(x-i+2)}2 \\\\\n& = \\sum\\limits_{i=1}^x A_i \\cdot \\dfrac{x^2 - 2xi + i^2 - 3i + 3x + 2}2 \\\\\n& = \\sum\\limits_{i=1}^x \\dfrac{\\color{red}(i^2 - 3i) A_i\\color{black} - 2x \\cdot \\color{red}i\\cdot A_i \\color{black} + (x^2 + 3x + 2) \\cdot \\color{red} A_i}2 \n\\end{aligned}\n$$\n\n\u6807\u9ed1\u7684\u5f88\u5bb9\u6613 $O(1)$ \u8ba1\u7b97\uff0c\u4e5f\u5c31\u662f\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u7ea2\u8272\u90e8\u5206\u5373\u53ef\uff08\u8fd9\u4e9b\u90e8\u5206\u542b\u6709 $i$ \u6216\u8005 $A_i$\uff09\u3002\n\n\u7ef4\u62a4\u4e09\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u5206\u522b\u7ef4\u62a4 $\\sum (i^2 - 3i) A_i$\u3001$\\sum i\\cdot A_i$\u3001$\\sum A_i$\u3002\u540c\u65f6\u8fd8\u652f\u6301\u5355\u70b9\u66f4\u65b0\u3002\n\n\u663e\u7136\u7528\u4e09\u4e2a\u6811\u72b6\u6570\u7ec4\u5373\u53ef\u62ff\u4e0b\u3002\u6284\u4e00\u4e0b\u516c\u5f0f\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u6ce8\u610f $\\dfrac 12$ \u7528\u9006\u5143\u5b9e\u73b0\uff0c\u4ee5\u53ca\u53d6\u6a21\u6bd4\u8f83\u6076\u5fc3\uff0c\u63a8\u8350\u5728\u53ef\u80fd\u6ea2\u51fa\u7684\u5730\u65b9\u90fd\u65e0\u8111 `long long`\u3002\n\n## \u4ee3\u7801\n\n\u81ea\u8ba4\u4e3a\u6253\u5f97\u5f88\u597d\u770b qwq\u3002\n\n```cpp\n#include <iostream>\n#include <cstdio>\nusing namespace std;\nconst int N = 2e5 + 5, mod = 998244353, inv2 = 499122177; //inv2 \u5373\uff1a\u9664\u4ee52\nint n, q, a[N];\nstruct BIT { //\u6811\u72b6\u6570\u7ec4\u677f\u5b50\n\tint idx[N];\n\tint lowbit(int x) {return x & -x;}\n\tvoid update(int i, int k) {for (; i <= n; i += lowbit(i)) (idx[i] += k) %= mod;}\n\tint query(int i) {int ans = 0; for (; i; i -= lowbit(i)) (ans += idx[i]) %= mod; return ans;}\n} bit0, bit1, bit2;\n\ntypedef long long ll;\nvoid upd0(ll i, ll val) {bit0.update(i, ((i * i - 3 * i + mod) % mod) * val % mod);} //(i^2 - 3i) * Ai\nvoid upd1(ll i, ll val) {bit1.update(i, i * val % mod);} //i * Ai\nvoid upd2(ll i, ll val) {bit2.update(i, val);} //Ai\nvoid upds(ll i, ll val) {upd0(i, val), upd1(i, val), upd2(i, val);}\nint main()\n{\n\tscanf(\"%d%d\", &n, &q);\n\tfor (int i = 1; i <= n; i++) scanf(\"%d\", &a[i]), upds(i, a[i]);\n\twhile (q--)\n\t{\n\t\tint op; ll x, val;\n\t\tscanf(\"%d\", &op);\n\t\tif (op == 1)\n\t\t\tscanf(\"%lld%lld\", &x, &val),\n\t\t\tupds(x, (-a[x] + val + mod) % mod), a[x] = val; //a[x]=val \u5c31\u662f a[x]+=(-a[x]+val)\uff0c\u8fd8\u662f\u5f88\u663e\u7136\u7684\u5427\n\t\telse\n\t\t\tscanf(\"%lld\", &x), //\u6284\u516c\u5f0f\u5373\u53ef\u3002\u6ce8\u610f\u7b97\u5b8c\u53ef\u80fd\u53d8\u6210\u8d1f\u6570\uff0c\u52a0\u4e00\u4e0b mod \u6765\u4fdd\u8bc1\u7b54\u6848\u662f\u6b63\u6570\n\t\t\tprintf(\"%lld\\n\", (( \n\t\t\t\t+ bit0.query(x)\n\t\t\t\t- (2 * x) % mod * bit1.query(x) % mod\n\t\t\t\t+ (x * x + 3 * x + 2) % mod * bit2.query(x) % mod\n\t\t\t) + mod) % mod * inv2 % mod);\n\t}\n\treturn 0;\n}\n```\n\n\u5e0c\u671b\u80fd\u5e2e\u52a9\u5230\u5927\u5bb6\uff01",
        "postTime": 1683804625,
        "uid": 367488,
        "name": "liangbowen",
        "ccfLevel": 0,
        "title": "ABC256F \u9898\u89e3"
    },
    {
        "content": "\u8fd9\u4e2a\u9898\u5176\u5b9e\u662f [LG4868](https://www.luogu.com.cn/problem/P4868) \u7684\u52a0\u5f3a\u7248\uff0c\u4e3b\u8981\u7684\u89e3\u51b3\u601d\u60f3\u6709\u4e24\u79cd\uff0c\u4e00\u79cd\u662f\u76f4\u63a5\u63a8\u5f0f\u5b50\u63a8\u51fa $D_i$ \u53ea\u5173\u4e8e $A_i$ \u7684\u5f0f\u5b50\u7136\u540e\u5bf9\u4e8e\u6bcf\u4e2a\u90e8\u5206\u5206\u522b\u7ef4\u62a4\uff0c\u53e6\u4e00\u79cd\u662f\u540c\u65f6\u7ef4\u62a4\u8fd9\u51e0\u79cd\u524d\u7f00\u548c\u8f6c\u5316\u6c42\u503c\u3002\n\n$$B_i=\\sum_{j=1}^{i}A_j,C_i=\\sum_{j=1}^{i}B_j,D_i=\\sum_{j=1}^{i}C_j$$\n\n\u4ece $C_i$ \u5165\u624b\n\n$$C_i=\\sum_{j=1}^{i}B_j=\\sum_{j=1}^{i}\\sum_{k=1}^{j}A_k$$\n\n\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\n\n$$C_i=\\sum_{k=1}^{i}\\sum_{j=k}^{i}A_k=\\sum_{k=1}^{i}A_k\\sum_{j=k}^{i}1=\\sum_{k=1}^{i}(i-k+1)A_k$$\n\n$$D_i=\\sum_{j=1}^{i}C_j=\\sum_{j=1}^{i}\\sum_{k=1}^{j}(j-k+1)A_k$$\n\n\u91cd\u590d\u4e0a\u9762\u5904\u7406 $C_i$ \u7684\u64cd\u4f5c\uff0c\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\n\n$$D_i=\\sum_{k=1}^{i}A_k\\sum_{j=k}^{i}(j-k+1)=\\sum_{k=1}^{i}\\dfrac{(i-k+1)(i-k+2)}{2}A_k$$\n\n\u73b0\u5728 $D_i$ \u5c31\u53ea\u4e0e $A_i$ \u6709\u5173\u4e86\uff0c\u76f4\u63a5\u5c55\u5f00\u8868\u8fbe\u5f0f\n\n$D_i=\\sum_{k=1}^{i}\\dfrac{(i-k+1)(i-k+2)}{2}A_k=\\dfrac{1}{2}k^2A_k-\\dfrac{3+2i}{2}kA_k+\\frac{(i+1)(i+2)}{2}A_k$\n\n\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4 $k^2A_k,kA_k,A_k$ \u7684\u533a\u95f4\u548c\u5373\u53ef\u3002",
        "postTime": 1675042802,
        "uid": 335615,
        "name": "0xFF",
        "ccfLevel": 0,
        "title": "ABC256F"
    },
    {
        "content": "# [[ABC256F] Cumulative Cumulative Cumulative Sum](https://www.luogu.com.cn/problem/AT_abc256_f) Solution\n\n[TOC]\n\n## [\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\u6233\u6b64\u8fdb\u5165](http://blog.tsawke.com?t=ABC256F)\n\n## \u9898\u9762\n\n\u7ed9\u5b9a\u5e8f\u5217 $ A_n $\uff0c\u5b9a\u4e49 $ B_i = \\sum_{j = 1}^j A_j, C_i = \\sum_{j = 1}^i B_j, D_i = \\sum_{j = 1}^i C_j $\u3002\u5b58\u5728\u4e24\u79cd\u64cd\u4f5c\uff1a\n\n`1 x v`\uff1a$ A_x \\leftarrow v $\u3002\n\n`2 x`\uff1a\u67e5\u8be2 $ D_x \\bmod{998244353} $\u3002\n\n## Solution\n\n\u5c31\u662f\u7ef4\u62a4\u4e00\u4e2a\u9ad8\u7ef4\u524d\u7f00\u548c\uff0c\u4e5f\u662f\u7ecf\u5178\u5957\u8def\uff0c\u65e0\u8111\u63a8\u5f0f\u5b50\uff1a\n\n| $ \\textbf{A} $ | $ a_1 $ |    $ a_2 $     |        $ a_3 $        | $ \\cdots $ |                           $ a_i $                            |\n| :------------: | :-----: | :------------: | :-------------------: | :--------: | :----------------------------------------------------------: |\n| $ \\textbf{B} $ | $ a_1 $ | $ a_1 + a_2 $  |  $ a_1 + a_2 + a_3 $  | $ \\cdots $ |                 $ a_1 + a_2 + \\cdots + a_i $                 |\n| $ \\textbf{C} $ | $ a_1 $ | $ 2a_1 + a_2 $ | $ 3a_1 + 2a_2 + a_3 $ | $ \\cdots $ |             $ ia_1 + (i - 1)a_2 + \\cdots + a_i $             |\n| $ \\textbf{D} $ | $ a_1 $ | $ 3a_1 + a_2 $ | $ 6a_1 + 3a_2 + a_3 $ | $ \\cdots $ | $ (1 + 2 + \\cdots + i)a_1 + (1 + 2 + \\cdots + (i - 1))a_2 + \\cdots + a_i $ |\n\n\u4e8e\u662f\u53ef\u4ee5\u5c06 $ D_x $ \u901a\u8fc7\u7b49\u5dee\u6570\u5217\u6c42\u548c\u8868\u793a\u4e3a\uff1a\n$$\nD_x= \\sum_{i = 1}^x \\dfrac{1}{2}(1 + x - (i - 1)) \\times (x - (i - 1))a_i\n$$\n\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5c06 $ (1 + x - (i - 1)) \\times (x - (i - 1))a_i $ \u5316\u7b80\uff0c\u4f3c\u4e4e\u5c31\u662f\u5c3d\u91cf\u5c06\u4e0e\u8be2\u95ee\u6709\u5173\u7684 $ x $ \u548c\u524d\u7f00\u548c\u62bd\u79bb\u5f00\uff0c\u8fd9\u6837\u624d\u53ef\u4ee5\u4fbf\u4e8e\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u3002\u5373\uff1a\n$$\n\\begin{aligned}\n\t& (1 + x - (i - 1)) \\times (x - (i - 1))a_i \\\\\n\t=& (x - i + 2) \\times (x - i + 1)a_i \\\\\n\t=& (x^2 -ix +2x - ix + i^2 -2i + x - i + 2)a_i \\\\\n\t=& (x^2 -2ix + 3x + i^2 - 3i + 2)a_i \\\\\n\t=& (x^2 + 3x + 2)a_i - 2x(ia_i) + (i^2 - 3i)a_i\n\\end{aligned}\n$$\n\u6b64\u65f6\u6211\u4eec\u53d1\u73b0\uff0c\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee $ x $ \u5df2\u77e5\uff0c\u53ea\u9700\u8981\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4 $ a_i $\uff0c$ ia_i $\uff0c$ (i^2 - 3i)a_i $ \u7684\u524d\u7f00\u548c\u5373\u53ef $ O(\\log n) $ \u67e5\u8be2\uff0c\u5e76\u4e14\u652f\u6301\u5355\u70b9\u4fee\u6539\u3002\u8bb0\u5f97\u67e5\u8be2\u4e4b\u540e\u4e58\u4e2a $ 2 $ \u7684\u9006\u5143\u3002\u6700\u7ec8\u590d\u6742\u5ea6 $ O((n + q) \\log n) $\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n## Code\n\n```cpp\n#define _USE_MATH_DEFINES\n#include <bits/stdc++.h>\n\n#define PI M_PI\n#define E M_E\n#define npt nullptr\n#define SON i->to\n#define OPNEW void* operator new(size_t)\n#define ROPNEW(arr) void* Edge::operator new(size_t){static Edge* P = arr; return P++;}\n\nusing namespace std;\n\nmt19937 rnd(random_device{}());\nint rndd(int l, int r){return rnd() % (r - l + 1) + l;}\nbool rnddd(int x){return rndd(1, 100) <= x;}\n\ntypedef unsigned int uint;\ntypedef unsigned long long unll;\ntypedef long long ll;\ntypedef long double ld;\n\n#define MOD (998244353ll)\n\ntemplate < typename T = int >\ninline T read(void);\n\nint N, Q;\nll A[210000];\n\nll qpow(ll a, ll b){\n    ll ret(1), mul(a);\n    while(b){\n        if(b & 1)ret = ret * mul % MOD;\n        b >>= 1;\n        mul = mul * mul % MOD;\n    }return ret;\n}\n\nclass BIT{\nprivate:\n    ll tr[210000];\npublic:\n    int lowbit(int x){return x & -x;}\n    void Modify(int x, ll v){while(x <= N)(tr[x] += v + MOD) %= MOD, x += lowbit(x);}\n    ll Query(int x){ll ret(0); while(x)(ret += tr[x]) %= MOD, x -= lowbit(x); return ret;}\n}bit1, bit2, bit3;\n\nint main(){\n    const ll inv2 = qpow(2, MOD - 2);\n    N = read(), Q = read();\n    for(int i = 1; i <= N; ++i)\n        A[i] = read(),\n        bit1.Modify(i, A[i]),\n        bit2.Modify(i, i * A[i] % MOD),\n        bit3.Modify(i, ((ll)i * i % MOD - 3ll * i % MOD + MOD) % MOD * A[i] % MOD);\n    while(Q--){\n        int opt = read();\n        if(opt == 1){\n            int x = read(); ll v = read();\n            bit1.Modify(x, (v - A[x] + MOD) % MOD),\n            bit2.Modify(x, x * ((v - A[x] + MOD) % MOD) % MOD),\n            bit3.Modify(x, ((ll)x * x % MOD - 3ll * x % MOD + MOD) % MOD * ((v - A[x] + MOD) % MOD) % MOD);\n            A[x] = v;\n        }else{\n            ll x = read();\n            ll ret = (x * x % MOD + 3ll * x % MOD + 2) % MOD * bit1.Query(x) % MOD;\n            (ret += (-2ll * x + MOD) % MOD * bit2.Query(x) % MOD) %= MOD;\n            (ret += bit3.Query(x)) %= MOD;\n            printf(\"%lld\\n\", ret * inv2 % MOD);\n        }\n    }\n    fprintf(stderr, \"Time: %.6lf\\n\", (double)clock() / CLOCKS_PER_SEC);\n    return 0;\n}\n\ntemplate < typename T >\ninline T read(void){\n    T ret(0);\n    int flag(1);\n    char c = getchar();\n    while(c != '-' && !isdigit(c))c = getchar();\n    if(c == '-')flag = -1, c = getchar();\n    while(isdigit(c)){\n        ret *= 10;\n        ret += int(c - '0');\n        c = getchar();\n    }\n    ret *= flag;\n    return ret;\n}\n```\n\n## UPD\n\nupdate-2022_12_08 \u521d\u7a3f",
        "postTime": 1670481368,
        "uid": 362938,
        "name": "Tsawke",
        "ccfLevel": 6,
        "title": "[ABC256F] Cumulative Cumulative Cumulative Sum \u9898\u89e3"
    }
]