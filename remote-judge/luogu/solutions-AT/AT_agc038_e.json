[
    {
        "content": "$\\min-\\max$ \u5bb9\u65a5\u7684\u9898\u597d\u5c11\u554a?...\u597d\u96be\u627e...\u5982\u679c\u6709\u770b\u5230\u8fd9\u7bc7\u9898\u89e3\u7684\u5584\u826f\u4eba\u9ebb\u70e6\u53d1\u4e00\u4e0b CF \u4e0a\u6709\u6ca1\u6709\u5bf9\u5e94\u7684\u9898\u5427/kel\n\n\u9898\u76ee\u662f\u7ecf\u5178\u6a21\u578b(\u6c42\u6bcf\u4e2a\u6570\u90fd\u81f3\u5c11\u51fa\u73b0...), \u4f46\u662f\u6bcf\u4e2a\u6570\u662f\u6709\u4e00\u4e2a\u51fa\u73b0\u6b21\u6570\u7684\u8981\u6c42 $B_i$\n\n~~\u597d\u4e45\u6ca1\u5199\u9898\u89e3\u4e86\uff0c\u8fc7\u6765\u6c34\u4e00\u53d1~~\n\n----\n\n\u5bb9\u6613\u53d1\u73b0\u8981\u6c42\u7684\u503c\u5176\u5b9e\u5c31\u662f\u96c6\u5408\u5185\u6700\u665a\u6210\u4e3a\u5408\u6cd5\u7684\u5143\u7d20\u7684\u503c, \u8003\u8651 $\\min-\\max$ \u5bb9\u65a5, \u6709:\n\n$$E(\\max(S))=\\sum_{T\\subseteq S, T\\ne \\varnothing}E(\\min(T))\\times (-1)^{|T|+1}$$\n\n\u73b0\u5728\u8003\u8651\u5bf9\u4e8e\u7ed9\u5b9a\u7684\u4e00\u7ec4 $T$ \u96c6, \u6211\u4eec\u5982\u4f55\u8ba1\u7b97\u5176\u76f8\u5e94\u7684\u671f\u671b.\n\n\u6211\u4eec\u9700\u8981\u8ba1\u7b97\u7684\u5b9e\u9645\u4e0a\u662f\u5b58\u5728\u4e00\u4e2a\u5143\u7d20\u5c5e\u4e8e $T$ \u96c6\u88ab\u9009\u81f3\u4e0a\u754c\u7684\u671f\u671b.\n\n\u5b9e\u9645\u4e0a\u96c6\u5408\u4e4b\u5916\u7684\u5143\u7d20\u5bf9\u4e8e\u7b54\u6848\u90fd\u6ca1\u6709\u8d21\u732e, \u6211\u4eec\u8003\u8651\u53bb\u9664\u8fd9\u4e9b\u5143\u7d20\u7684\u8d21\u732e, \u53ea\u9700\u8981\u8003\u8651\u671f\u671b\u591a\u5c11\u6b21\u64cd\u4f5c\u4f1a\u9009\u5230\u96c6\u5408\u5185\u7684\u5143\u7d20\u5373\u53ef, \u4e0d\u59a8\u4ee4 $W=\\sum A_i$, \u5219\u9009\u5230\u96c6\u5408\u5185\u7684\u5143\u7d20\u7684\u671f\u671b\u9700\u8981\u7684\u6b21\u6570\u4e3a $\\frac{W}{\\sum_{i\\in T}A_i}$ \u4ee4\u5176\u4e3a $P$\n\n\u73b0\u5728\u6211\u4eec\u53ea\u9700\u8981\u5173\u6ce8\u96c6\u5408\u5185\u90e8\u7684\u5143\u7d20\u4e86, \u5bf9\u4e8e\u8fd9\u7c7b\u95ee\u9898(\u591a\u5c11\u6b21\u624d\u9009\u4e2d\u5143\u7d20)\u7684\u671f\u671b\u7684\u64cd\u4f5c\u6b21\u6570, \u6709\u4e00\u4e2a\u5341\u5206\u5e38\u89c1\u7684\u8f6c\u6362\u662f\u6211\u4eec\u53ef\u4ee5\u628a\u4ed6\u89c6\u4e3a**\u6bcf\u4e00\u8f6e\u5747\u6ca1\u6709\u4e00\u4e2a\u5143\u7d20\u88ab\u9009\u4e2d(\u8fd9\u91cc\u662f\u88ab\u9009\u4e2d $B_i$ \u6b21)\u7684\u6982\u7387\u4e4b\u548c**. ( \u8fd9\u91cc\u9700\u8981\u5305\u62ec $0$ \u8f6e\u64cd\u4f5c, \u6216\u8005\u76f4\u63a5\u8bf4\u7b54\u6848\u9700\u8981 $+1$ )\n\n\u4e8e\u662f\u4e0d\u59a8\u5047\u8bbe\u9009\u5230\u96c6\u5408\u5185\u6709 $k$ \u8f6e, \u90a3\u4e48\u5bf9\u5e94\u7684\u64cd\u4f5c\u6b21\u6570\u5e94\u8be5\u4e3a $k\\times P$, \u6240\u4ee5\u5355\u72ec\u4e00\u8f6e\u7684\u8d21\u732e\u4e3a $P$, \u6240\u4ee5\u5176\u8d21\u732e\u4e3a $P\\times E(\\textbf{\u5408\u6cd5})$, \u8fd9\u91cc\u7684\u5408\u6cd5\u5373\u6ca1\u4e00\u4e2a\u5143\u7d20\u88ab\u9009\u4e2d\u7684\u6982\u7387( emm \u7b80\u5355\u8bf4\u5c31\u662f\u7531\u4e8e\u7cfb\u6570\u4e4b\u524d\u6709\u4e00\u4e2a $k\\times P$ \u7684\u8d21\u732e, \u6240\u4ee5\u5355\u72ec\u62c6\u8f6e\u6b21\u6765\u8003\u8651\u8d21\u732e\u7684\u65f6\u5019\u5e94\u8be5\u4e3a $P\\times$ \u672c\u8f6e\u6ca1\u88ab\u9009\u7684\u6982\u7387).\n\n\u7b49\u4ef7\u4e8e\u6211\u4eec\u9700\u8981\u5206\u914d\u4e00\u7ec4 $c_{1},c_{2}\\sim c_{|T|}$, \u4e14\u6709 $c_i<B_i$, \u4e14 $\\sum c = k$, \u8003\u8651\u5176\u5bf9\u5e94\u7684\u6982\u7387, \u663e\u7136\u53ef\u4ee5\u89c6\u4e3a\u6df7\u5408\u7ec4\u5408\u6570\u4e58\u4ee5\u5bf9\u5e94\u6982\u7387, \u6240\u4ee5\u53ef\u4ee5\u5f97\u5230\u4e3a:\n\n$$\\prod_{i\\in T} (\\frac{A_i}{\\sum_{i\\in T} A_i})^{c_i} \\times \\frac{k!}{c_1!c_2!...c_{|T|}!}$$\n\n\u5bb9\u6613\u53d1\u73b0\u53ef\u4ee5\u628a\u6bcf\u4e00\u4f4d\u7684\u8d21\u732e\u63d0\u53d6\u51fa\u6765, \u4e8e\u662f\u6211\u4eec\u6240\u6c42\u7b49\u4ef7\u4e8e(\u65b9\u4fbf\u671f\u95f4\u4ee4 $w(T)=\\sum_{i\\in T} A_i$):\n\n$$k!\\prod_{i\\in T}\\frac{A_i^{c_i}}{w(T)^{c_i} c_i!}$$\n\n\u73b0\u5728\u5c06\u671f\u671b\u9009\u5165\u96c6\u5408\u5185\u7684\u9700\u8981\u6b21\u6570\u4e5f\u5199\u5165\u7b54\u6848, \u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u628a\u4e00\u4e2a\u65b9\u6848 $T$ \u7684\u7b54\u6848\u5199\u4e3a $(r=\\sum_{i\\in T} (B_i-1)~)$:\n\n$$\\sum_{k=0}^{r} P\\times k!\\prod_{i\\in T,c_1+...c_{|T|=k}} \\frac{A_i^{c_i}}{w(T)^{c_i}c_i!}$$\n\n\u6240\u4ee5\u603b\u7b54\u6848\u5373:\n\n\n$$\\sum_{T\\subseteq S, T\\ne \\varnothing } (-1)^{|T|+1}\\bigg(\\sum_{k=0}^{r} P\\times k!\\times w(T)^{-k}\\prod_{i\\in T,c_1+...c_{|T|=k}} \\frac{A_i^{c_i}}{c_i!}\\bigg)$$\n\n\u8003\u8651\u5982\u4f55\u8bbe\u8ba1\u4e00\u4e2a dp \u6765\u7edf\u8ba1\u7b54\u6848, \u4e8b\u5b9e\u4e0a, \u6211\u4eec\u53ea\u9700\u8981\u5173\u6ce8 $w(T)$ \u4ee5\u53ca $k$ \u5c31\u80fd\u591f\u77e5\u9053\u7b54\u6848\u4e86, \u6216\u8005\u8bf4\u5728\u8003\u8651\u901a\u8fc7 dp \u8f6c\u79fb\u7ef4\u62a4\u7cfb\u6570\u8d21\u732e\u548c\u7684\u65f6\u5019, \u53ea\u6709\u67d0\u4e2a\u6570\u7684 $-k$ \u6b21\u5e42\u8fd9\u79cd\u5f62\u5f0f\u7684\u4e1c\u897f\u975e\u5e38\u96be\u7ef4\u62a4, \u6240\u4ee5\u5c06\u5176\u653e\u5165\u72b6\u6001\u5373\u53ef. \n\n\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u8981\u4ee4 $f_{i,j,k}$ \u8868\u793a\u8003\u8651\u5230\u4e86\u524d $i$ \u4e2a\u6570, \u6240\u9009\u7684 $c_i$ \u4e4b\u548c\u4e3a $k$, \u9009\u62e9\u7684 $\\sum_{i\\in T} A_i=j$ \u7684\u8d21\u732e\u548c\u5373\u53ef. \u8f6c\u79fb\u7684\u65f6\u5019\u6ce8\u610f\u5982\u679c\u5c06\u4e00\u4e2a\u6570\u9009\u5165\u96c6\u5408\u90a3\u4e48\u5bb9\u65a5\u7cfb\u6570\uff0c \u90a3\u4e48\u4e00\u5b9a\u4f1a\u5f3a\u5236\u589e\u5927 $(-1)$ \u500d\uff0c \u5982\u679c\u6ca1\u6709\u5c06\u5f53\u524d\u6570\u9009\u5165\u96c6\u5408\uff0c \u90a3\u4e48\u7b54\u6848\u4e0d\u53d8\u3002\n\n\u4e8e\u662f\u8f6c\u79fb\u76f4\u63a5\uff1a\n\n$$f_{i,j,k}=f_{i-1,j,k}-\\sum_{l=0}^{\\min(B_i-1,l)}f_{i-1,j-l,k-A_i}\\times \\frac{A_i^l}{l!}$$\n\n\u7136\u540e\u5c31\u559c\u63d0\u4e00\u4e2a $O(n^4)$ \u7684\u505a\u6cd5\uff08\u65b9\u4fbf\u8d77\u89c1\u8ba4\u4e3a $n$\uff0c$\\sum A$\uff0c$\\sum B$ \u5e73\u7ea7\uff09\n\n\u771f\u7684\u5417\uff1f\n\n\u6211\u4eec\u53d1\u73b0\u4e8b\u5b9e\u4e0a\u6211\u4eec\u7684 $l$ \u7684\u679a\u4e3e\u603b\u91cf\u5176\u5b9e\u662f $O(\\sum B)$ \u7684\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a\u590d\u6742\u5ea6\u662f $O(n^3)$ \u7684\uff0c\u7136\u540e\u672c\u9898\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u901a\u8fc7\u60f9\u3002\n\n\u503c\u5f97\u4e00\u63d0\u7684\u5c31\u662f\u521d\u59cb\u5316\u662f $dp_{0,0,0}=-1$ \u8fd9\u662f\u56e0\u4e3a\u7a7a\u96c6\u5bf9\u5e94\u7684\u5bb9\u65a5\u7cfb\u6570\u662f $(-1)^1=-1$ /lb\n\n$Code:$\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std ;\n#define rep( i, s, t ) for( register int i = (s); i <= (t); ++ i )\n#define drep( i, s, t ) for( register int i = (t); i >= (s); -- i )\n#define re register\n#define int long long\nint gi() {\n\tchar cc = getchar() ; int cn = 0, flus = 1 ;\n\twhile( cc < '0' || cc > '9' ) {  if( cc == '-' ) flus = - flus ; cc = getchar() ; }\n\twhile( cc >= '0' && cc <= '9' )  cn = cn * 10 + cc - '0', cc = getchar() ;\n\treturn cn * flus ;\n}\nconst int P = 998244353 ; \nconst int N = 400 + 5 ; \nint n, A[N], a[N][N], B[N], SA, SB, inv[N], fac[N], dp[N][N][N] ;\nint fpow( int x, int k ) {\n    int ans = 1, base = x ; \n    while( k ) {\n        if( k & 1 ) ans = 1ll * ans * base % P ; \n        base = 1ll * base * base % P, k >>= 1 ; \n    } return ans % P ; \n}\nint Dec( int x, int y ) {\n    return ( x - y + P ) % P ; \n} \nsigned main() \n{\n    n = gi() ; \n    rep( i, 1, n ) A[i] = gi(), B[i] = gi() ; \n    rep( i, 1, n ) SA += A[i], SB += B[i] ; \n    fac[0] = inv[0] = 1 ; \n    rep( i, 1, SB ) fac[i] = fac[i - 1] * i % P, inv[i] = fpow( fac[i], P - 2 ) ;\n    rep( i, 1, n ) rep( j, 0, SB ) a[i][j] = ( j == 0 ) ? 1 : a[i][j - 1] * A[i] % P ;\n    dp[0][0][0] = -1 ; \n    rep( i, 1, n ) rep( j, 0, SA ) rep( k, 0, SB ) {\n        dp[i][j][k] = dp[i - 1][j][k] ; \n        for( re int l = 0; l < B[i]; ++ l ) if( A[i] <= j && l <= k ) \n        dp[i][j][k] = Dec( dp[i][j][k], 1ll * dp[i - 1][j - A[i]][k - l] * a[i][l] % P * inv[l] % P ) ;\n    }\n    int Ans = 0 ;\n    rep( j, 0, SA ) rep( k, 0, SB ) \n    Ans = ( Ans + SA * fpow( fpow( j, P - 2 ), k + 1 ) % P * dp[n][j][k] % P * fac[k] % P ) % P ;\n    cout << Ans << endl ; \n\treturn 0 ; \n}\n```",
        "postTime": 1587391893,
        "uid": 30036,
        "name": "Soulist",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 AT5202 \u3010[AGC038E] Gachapon\u3011"
    },
    {
        "content": "[\u9898\u76ee\u94fe\u63a5](https://atcoder.jp/contests/agc038/tasks/agc038_e)\uff0c[\u9898\u76ee\u7ffb\u8bd1](https://www.luogu.com.cn/problem/AT5202)\n\n\u8fd9\u9898\u4e0d\u4ec5\u4e0d\u9700\u8981 min-max \u5bb9\u65a5\uff0c\u800c\u4e14\u4e5f\u4e0d\u9700\u8981\u963f\u8d1d\u5c14\u53d8\u6362\u548c\u6d1b\u5fc5\u8fbe\u6cd5\u5219\u2026\u2026\n\n\u8003\u8651\n\n$$\\begin{aligned}P(X\\le n)&=n![x^n]\\prod_{i=0}^{N-1}\\sum_{j=B_i}\\dfrac{(\\dfrac{A_i}{S}x)^j}{j!}\\\\&=n![x^n]\\prod_{i}\\left(e^{\\frac{A_i}{S}x}-\\sum_{j=0}^{B_i-1}\\dfrac{(\\dfrac{A_i}{S}x)^j}{j!}\\right)\\end{aligned}$$\n\n\u53ef\u4ee5\u89c2\u5bdf\u5230\u5b83\u5e94\u8be5\u6709\u8fd9\u6837\u7684\u5f62\u5f0f\n\n$$n![x^n]\\sum_{i=0}^SP_i(x)e^{\\frac{i}{S}x}$$\n\n\u663e\u7136 $P$ \u662f\u53ef\u4ee5\u5927\u529b DP \u5f97\u51fa\u7684\u3002\n\n\u7b54\u6848\u5e94\u8be5\u662f\n\n$$\\begin{aligned}\\sum_{n=0}^{\\infty}P(X>n)&=\\sum_{n=0}^{\\infty}1-n![x^n]\\sum_{i=0}^SP_i(x)e^{\\frac{i}{S}x}\\\\&=-\\sum_{n=0}^{\\infty}n![x^n]\\sum_{i=0}^{S-1}P_i(x)e^{\\frac{i}{S}x}\\end{aligned}$$\n\n\u662f\u65f6\u5019\u62c6\u6389 $[x^n]$ \u4e86\u3002\u8bbe $P_{i,j}=[x^j]P_i(x),T=\\sum B$\u3002\n\n$$-\\sum_{n=0}^{\\infty}n!\\sum_{i=0}^{S-1}\\sum_{j=0}^TP_{i,j}\\dfrac{i^{n-j}}{S^{n-j}(n-j)!}$$\n\n$$\\boxed{-\\sum_{i=0}^{S-1}\\sum_{j=0}^TP_{i,j}\\left(\\dfrac{i}{S}\\right)^{-j}\\sum_{n=0}^{\\infty}\\left(\\dfrac{i}{S}\\right)^n\\dfrac{n!}{(n-j)!}}$$\n\n\u8bbe\u540e\u9762\u90a3\u4e2a\u4e1c\u897f\u662f $j!F_j(\\dfrac{i}{S})$\uff0c\u4e5f\u5c31\u662f\u8bf4\n\n$$\\begin{aligned}F_j(x)&=\\sum_{i=0}^{\\infty}{i\\choose j}x^i\\\\&={0\\choose j}+\\sum_{i=1}^{\\infty}\\left({i-1\\choose j}+{i-1\\choose j-1}\\right)x^i\\\\&=xF_j(x)+xF_{j-1}(x)\\end{aligned}$$\n\n$$\\boxed{F_j(x)=\\dfrac{x}{1-x}F_{j-1}(x)}$$\n\n\u663e\u7136\u6709 $F_0(x)=\\dfrac{1}{1-x}$\uff0c\u9012\u63a8\u5373\u53ef\u3002\n\n\u6ce8\u610f\u7279\u5224 $x=0$\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\nconst int p=998244353;\nint qpow(int a,int k){\n\tint ans=1;\n\twhile(k){\n\t\tif(k&1) ans=1LL*ans*a%p;\n\t\ta=1LL*a*a%p;\n\t\tk>>=1;\n\t}\n\treturn ans;\n}\n\nint N;\nint fac[405],ifac[405],inv[405];\nint A[405],S,iS,B[405],T; \n\nint P[405][405];int G[405];\n\nint main(){\n\tfac[0]=fac[1]=ifac[0]=ifac[1]=inv[1]=1;\n\tfor(int i=2;i<=400;i++)\n\t\tinv[i]=1LL*(p-p/i)*inv[p%i]%p,\n\t\tfac[i]=1LL*fac[i-1]*i%p,\n\t\tifac[i]=1LL*ifac[i-1]*inv[i]%p;\n\tscanf(\"%d\",&N);\n\tfor(int i=0;i<N;i++) scanf(\"%d%d\",&A[i],&B[i]),S+=A[i],T+=B[i]-1;\n\tiS=qpow(S,p-2);\n\t\n\tP[0][0]=1;int tS=0,tT=0;\n\tfor(int i=0;i<N;i++){\n\t\tfor(int j=0,mul=1;j<=B[i]-1;j++) G[j]=1LL*mul*ifac[j]%p,mul=1LL*mul*A[i]%p*iS%p;\n\t\ttS+=A[i];tT+=B[i]-1;\n\t\tfor(int j=tS;j>=0;j--){\n\t\t\tfor(int k=tT;k>=0;k--){\n\t\t\t\tint tmp=0;\n\t\t\t\tfor(int kk=0;kk<=B[i]-1&&kk<=k;kk++)\n\t\t\t\t\ttmp=(tmp+1LL*G[kk]*P[j][k-kk]%p)%p;\n\t\t\t\tP[j][k]=(p-tmp)%p;\n\t\t\t}\n\t\t\tif(j>=A[i]) for(int k=0;k<=tT;k++) P[j][k]=(P[j][k]+P[j-A[i]][k])%p;\n\t\t}\n\t}\n\tint ans=0;\n\tfor(int i=0;i<S;i++){\n\t\tint x=1LL*i*iS%p,ix=qpow(x,p-2);\n\t\tint F=qpow(1-x+p,p-2),FF=F;\n\t\tfor(int j=0;j<=T;j++){\n\t\t\tans=(ans+1LL*P[i][j]*fac[j]%p*F%p)%p;\n\t\t\tF=1LL*F*FF%p;\n\t\t}\n\t}\n\tprintf(\"%d\\n\",(p-ans)%p);\n}\n```",
        "postTime": 1599218669,
        "uid": 58567,
        "name": "x\u4e49x",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 AT5202 \u3010[AGC038E] Gachapon\u3011"
    },
    {
        "content": "\u6709\u4e00\u4e2a\u968f\u673a\u6570\u751f\u6210\u5668\uff0c\u751f\u6210 $[0,n-1]$ \u4e4b\u95f4\u7684\u6574\u6570\uff0c\u5176\u4e2d\u751f\u6210 $i$ \u7684\u6982\u7387\u4e3a $\\frac{A_i}{S}$\uff0c\u5176\u4e2d\uff0c$S=\\sum A_i$\u3002\n\n\u8fd9\u4e2a\u968f\u673a\u6570\u751f\u6210\u5668\u4e0d\u65ad\u751f\u6210\u968f\u673a\u6570\uff0c\u5f53 $\\forall i\\in[0,n-1]$\uff0c$i$ \u81f3\u5c11\u51fa\u73b0\u4e86 $B_i$ \u6b21\u65f6\uff0c\u505c\u6b62\u751f\u6210\uff0c\u5426\u5219\u7ee7\u7eed\u751f\u6210\u3002\n\n\u6c42\u671f\u671b\u751f\u6210\u968f\u673a\u6570\u7684\u6b21\u6570\uff0c\u8f93\u51fa\u7b54\u6848\u5bf9 $998244353$ \u53d6\u6a21\u7684\u7ed3\u679c\u3002\n\n$A_i,B_i\\geq 1$\uff0c$\\sum A_i,\\sum B_i,n\\leq 400$\u3002\n\n\u6765\u4e00\u7bc7\u4e0d\u9700\u8981\u5bb9\u65a5\u7684\u76f4\u63a5\u63a8\u5f0f\u5b50\u505a\u6cd5\u3002\n\n\u8bbe $F_u(x)$ \u8868\u793a $u$ \u751f\u6210\u4e86\u4e0d\u5c11\u4e8e $B_u$ \u6b21\u7684\u6982\u7387\u578b\u6307\u6570\u751f\u6210\u51fd\u6570\u3002\u5373\n\n$$F_u(x)=\\sum_{i=B_u}^{+\\infty} (\\frac{A_u}S)^i\\frac{x^i}{i!}=e^{\\frac{A_i}Sx}-\\sum_{i=0}^{B_i-1}\\frac{(\\frac{A_i}Sx)^i}{i!}$$\n\n\u5219\u751f\u6210 $i$ \u6b21\u5df2\u7ecf\u7ed3\u675f\uff08\u53ef\u80fd\u5728\u66f4\u65e9\u7684\u65f6\u95f4\u7ed3\u675f\uff09\u7684\u6982\u7387\u4e3a\n\n$$[x^i]\\prod F_u(x)$$\n\n\u6240\u4ee5\u7b54\u6848\u4e3a\n\n$$\\sum_{i=0}^{+\\infty}1-i![x^i]\\prod F_u(x)$$\n\n\u8bbe\n\n$$\\prod F_u(x)=\\sum_{i=0}^Se^{\\frac iSx}g_i(x)$$\n\n\u5176\u4e2d $g_i(x)$ \u662f\u4e0d\u8d85\u8fc7 $\\sum B_i$ \u6b21\u591a\u9879\u5f0f\u3002\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u7c7b\u4f3c\u4e8e\u80cc\u5305\u7684\u7b97\u6cd5\u8003\u8651 $F_u(x)$ \u662f\u9009\u62e9 $e^{\\frac{A_i}Sx}$ \u8fd8\u662f $\\sum_{i=0}^{B_i-1}\\frac{(\\frac{A_i}Sx)^i}{i!}$\uff0c\u66b4\u529b\u591a\u9879\u5f0f\u8fd0\u7b97\u5373\u53ef\u3002\n\n\u7b97\u51fa\u6240\u6709 $g_i(x)$ \u540e\uff0c\u53ef\u5f97\u7b54\u6848\u4e3a\n\n$$\\sum_{i=0}^{+\\infty}1-i![x^i]\\sum_de^{\\frac dSx}g_d(x)$$\n\n\u4ea4\u6362\u6c42\u548c\u987a\u5e8f\u5f97\n\n$$\\sum_{i=0}^{+\\infty}1-\\sum_{d=0}^Si![x^i](e^{\\frac dSx}g_d(x))=-\\sum_{i=0}^{+\\infty}\\sum_{d=0}^{S-1}i![x^i](e^{\\frac dSx}g_d(x))$$\n\n\u56e0\u4e3a $g_S(x)=1$\u3002\n\n\u591a\u4e00\u7ef4\u679a\u4e3e\n\n$$-\\sum_{i=0}^{+\\infty}\\sum_{d=0}^{S-1}i![x^i](e^{\\frac dSx}g_d(x))=-\\sum_{i=0}^{+\\infty}\\sum_{d=0}^{S-1}i!\\sum_{k=0}^S\\left([x^k]g_d(x)\\times[x^{i-k}]e^{\\frac dSx}\\right)$$\n\n\u5c06 $e^x$ \u6cf0\u52d2\u5c55\u5f00\u5f97\n\n$$-\\sum_{i=0}^{+\\infty}\\sum_{d=0}^{S-1}i!\\sum_{k=0}^S\\left([x^k]g_d(x)\\frac{(\\frac dS)^{i-k}}{(i-k)!}\\right)=-\\sum_{i=0}^{+\\infty}\\sum_{d=0}^{S-1}\\sum_{k=0}^S\\left([x^k]g_d(x)(\\frac dS)^{i-k}i^{\\underline k}\\right)$$\n\n\u8bbe $c=\\frac dS$\uff0c\u66f4\u6362\u6c42\u548c\u987a\u5e8f\u5f97\n\n$$-\\sum_{d=0}^{S-1}\\sum_{k=0}^S\\left([x^k]g_d(x)c^{-k}\\sum_{i=0}^{+\\infty}c^ii^{\\underline k}\\right)$$\n\n\u5982\u679c\u6211\u4eec\u80fd\u591f\u5bf9\u4e8e\u6bcf\u4e2a $k$ \u6c42\u51fa $\\sum_{i=0}^{+\\infty} c^ii^{\\underline k}$\uff0c\u95ee\u9898\u4e5f\u5c31\u89e3\u51b3\u4e86\u3002\n\n#### \u5206\u90e8\u6c42\u548c\u6cd5\uff08\u963f\u8d1d\u5c14\u53d8\u6362\uff09\n\n$$\\sum_{k=m}^nf_k(g_{k+1}-g_{k})=f_{n+1}g_{n+1}-f_mg_m-\\sum_{k=m}^ng_{k+1}(f_{k+1}-f_{k})$$\n\n\u6216\u662f\u66f4\u4e3a\u89c4\u6574\u7684\u5f62\u5f0f\uff1a\n\n$$\\sum_{i=m+1}^n(b_i-b_{i-1})a_i+(a_i-a_{i-1})b_{i-1}=a_nb_n-a_mb_m$$\n\n\u6b63\u786e\u6027\u663e\u7136\u3002\n\n\u8bbe $L_t(n)=\\sum_{i=0}^nc^ii^{\\underline t}$\uff0c$L_t=\\lim_{n\\to+\\infty}L_t(n)$\u3002\n\n\u5dee\u5206\u4e00\u4e0b\u5f97\n\n$L_t(n)=\\frac{1-c^{n+1}}{1-c}(n+1)^{\\underline t}-\\sum_{i=0}^n\\frac{1-c^{i+1}}{1-c}((i+1)^{\\underline t}-i^{\\underline t})$\n\n\u4f7f\u7528\u5206\u90e8\u6c42\u548c\u6cd5\n\n$$L_t(n)=\\frac{1-c^{n+1}}{1-c}(n+1)^{\\underline t}-\\frac{(n+1)^{\\underline t}}{1-c}+\\frac c{1-c}\\sum_{i=0}^nc^iti^{\\underline {t-1}}$$\n\n\u6b64\u65f6\u5f00\u59cb\u6c42\u6781\u9650\uff0c\u6839\u636e\u7b80\u5355\u7684\u63a8\u5bfc\uff08\u6bd4\u5982\u6d1b\u5fc5\u8fbe\u6cd5\u5219\uff09\uff0c\u524d\u4e24\u9879\u6781\u9650\u4e3a $0$\u3002\n\n$$L_t=\\frac c{1-c}t\\sum_{i=0}^{+\\infty}c^ii^{\\underline {t-1}}=\\frac c{1-c}tL_{t-1}$$\n\n\u76f4\u63a5\u9012\u63a8\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\nconst int Maxn = 405, p = 998244353;\nint S;\nlong long fac[Maxn], finv[Maxn];\nlong long fast_pow(long long x, long long y)\n{\n\tlong long ans = 1, now = x;\n\twhile (y)\n\t{\n\t\tif (y & 1) ans = ans * now % p;\n\t\tnow = now * now % p;\n\t\ty >>= 1;\n\t}\n\treturn ans;\n}\nvoid init(void)\n{\n\tfac[0] = 1;\n\tfor (int i = 1; i <= 400; i++)\n\t\tfac[i] = fac[i - 1] * i % p;\n\tfinv[400] = fast_pow(fac[400], p - 2);\n\tfor (int i = 399; i >= 0; i--)\n\t\tfinv[i] = finv[i + 1] * (i + 1) % p;\n}\nvoid multi(long long x[], long long y[], long long ans[], int len)\n{\n\tfor (int i = 0; i <= S; i++)\n\t\tfor (int j = 0; i + j <= S && j < len; j++)\n\t\t\t(ans[i + j] += p - x[i] * y[j] % p) %= p;\n}\nvoid add(long long x[], long long ans[])\n{\n\tfor (int i = 0; i <= S; i++)\n\t\t(ans[i] += x[i]) %= p;\n}\nint n, a[Maxn], b[Maxn];\nlong long ans, invS, f[Maxn][Maxn], g[Maxn][Maxn], tmp[Maxn];\nint main()\n{\n\tscanf(\"%d\", &n);\n\tfor (int i = 1; i <= n; i++)\n\t\tscanf(\"%d%d\", &a[i], &b[i]), S += a[i];\n\tinit();\n\tinvS = fast_pow(S, p - 2);\n\tf[0][0] = 1;\n\tfor (int i = 1; i <= n; i++)\n\t{\n\t\tmemcpy(g, f, sizeof(g));\n\t\tmemset(f, 0, sizeof(f));\n\t\ttmp[0] = 1;\n\t\tfor (int j = 1; j < b[i]; j++)\n\t\t\ttmp[j] = tmp[j - 1] * a[i] % p * invS % p;\n\t\tfor (int j = 1; j < b[i]; j++)\n\t\t\ttmp[j] = tmp[j] * finv[j] % p;\n\t\tfor (int j = 0; j <= S - a[i]; j++)\n\t\t{\n\t\t\tmulti(g[j], tmp, f[j], b[i]);\n\t\t\tadd(g[j], f[j + a[i]]);\n\t\t}\n\t}\n\tfor (int d = 0; d < S; d++)\n\t{\n\t\tlong long c = d * invS % p, L = 1 * fast_pow(1 - c + p, p - 2);\n\t\t(ans += L * f[d][0]) %= p;\n\t\tfor (int i = 1; i <= S; i++)\n\t\t{\n\t\t\tL = fast_pow(1 - c + p, p - 2) % p * i % p * L % p;\n\t\t\t(ans += L * f[d][i]) %= p;\n\t\t}\n\t}\n\tprintf(\"%lld\", (p - ans) % p);\n\treturn 0;\n}\n```\n",
        "postTime": 1591863609,
        "uid": 49093,
        "name": "_sys",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 AT5202 \u3010[AGC038E] Gachapon\u3011"
    },
    {
        "content": "[Atcoder \u9898\u9762\u4f20\u9001\u95e8](https://atcoder.jp/contests/agc038/tasks/agc038_e) & [\u6d1b\u8c37\u9898\u9762\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/AT5202)\n\n\u6211\u7adf\u7136\u80fd\u72ec\u7acb\u505a\u51fa Ag \u7684 AGC E\uff0cincredible\uff01\u66f4\u65b0\u4e86 Atcoder \u505a\u9898\u96be\u5ea6\u4e0a\u9650\uff08\n\n\u9996\u5148\u6309\u7167\u5957\u8def Min-Max \u5bb9\u65a5\uff0c$ans=\\sum\\limits_{\\varnothing\\ne T\\subseteq S}(-1)^{|T|-1}\\times E(\\min(T))$\uff0c\u8003\u8651\u600e\u6837\u6c42\u8fd9\u4e2a\u5f0f\u5b50\u7684\u503c\u3002\u9996\u5148\u6211\u4eec\u9700\u8981\u641e\u6e05\u695a $E(\\min(T))$\uff0c\u5047\u8bbe $T$ \u4e2d\u5305\u542b\u4e0b\u6807\u4e3a $x_1,x_2,\\cdots,x_m$ \u8fd9 $m$ \u4e2a\u5143\u7d20\uff0c\u90a3\u4e48 $E(\\min(T))$ \u7684\u5b9e\u9645\u610f\u4e49\u5c31\u662f\u671f\u671b\u6700\u5c11\u9009\u591a\u5c11\u4e2a\u6570\u5c31\u80fd\u627e\u5230\u4e00\u4e2a $x_i$ \u7684\u51fa\u73b0\u6b21\u6570\u8fbe\u5230\u4e86\u5176\u4e0a\u754c $b_{x_i}$\uff0c\u9996\u5148\u6709\u53ef\u80fd\u6211\u4eec\u62bd\u5230\u7684\u6570\u4e0d\u5728 $T$ \u5f53\u4e2d\uff0c\u8fd9\u91cc\u6709\u4e00\u4e2a\u5c0f\u5957\u8def\uff0c\u6211\u4eec\u8bb0 $e$ \u4e3a\u671f\u671b\u591a\u5c11\u6b21\u624d\u80fd\u62bd\u5230\u4e00\u4e2a $T$ \u4e2d\u7684\u6570\uff0c\u90a3\u4e48\u663e\u7136 $e=\\dfrac{\\sum a_i}{\\sum\\limits_{x\\in T}a_x}$\uff0c\u8fd9\u6837\u76f8\u5f53\u4e8e\u6211\u4eec\u5c06\u539f\u6765\u6bcf\u4e00\u6b65\u7684\u8d21\u732e $1$ \u53d8\u6210\u4e86 $e$\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u5c06\u7b54\u6848\u4e58\u4e2a $e$ \u5c31\u53ef\u4ee5\u5f97\u5230\u6700\u7ec8\u7684 $E(\\min(T))$\u3002\u8fd9\u6837\u4e00\u6765\u6211\u4eec\u5c31\u4e0d\u7528\u8003\u8651\u4e0d\u5728 $T$ \u4e2d\u7684\u6570\u7684\u5f71\u54cd\u4e86\uff0c\u4e0d\u8fc7\u6211\u4eec\u53d1\u73b0\u8fd9\u4e1c\u897f\u662f\u4e0d\u592a\u597d\u76f4\u63a5\u6c42\u7684\uff0c\u6545\u6211\u4eec\u4e0d\u59a8\u6362\u4e2a\u89d2\u5ea6\uff0c\u6211\u4eec\u5047\u8bbe\u5230\u8fbe\u6700\u7ec8\u72b6\u6001\u65f6\u5143\u7d20 $x_i$ \u88ab\u9009\u62e9\u7684 $c_i$ \u6b21\uff0c\u90a3\u4e48\u4e0d\u96be\u53d1\u73b0\u5bf9\u4e8e\u4efb\u610f\u4e00\u4e2a\u7531\u521d\u59cb\u72b6\u6001 $0,0,\\cdots,0$ \u5230\u8fbe\u6700\u7ec8\u72b6\u6001\u7684\u53d6\u6570\u65b9\u5f0f\uff0c\u5b83\u4e2d\u95f4\u603b\u8981\u7ecf\u8fc7 $\\sum c_i$ \u4e2a\u6ee1\u8db3 $c_i<b_{x_i}$ \u7684\u72b6\u6001\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5728\u6bcf\u4e2a\u4e2d\u95f4\u72b6\u6001\u4e2d\u7d2f\u52a0\u4e00\u6b21\u8d21\u732e\uff0c\u800c\u5bf9\u4e8e\u4e00\u4e2a\u6ee1\u8db3 $\\forall i,c_i<b_{x_i}$ \u7684 $c_1,c_2,\\cdots,c_m$\uff0c\u53ea\u8981\u5b83\u5230\u8fbe\u4e86\u8fd9\u4e2a\u72b6\u6001\uff0c\u5b83\u5c31\u80af\u5b9a\u4f1a\u88ab\u7edf\u8ba1\u5165\u7b54\u6848\u4e2d\uff0c\u56e0\u6b64\u6211\u4eec\u8981\u6c42\u7684\u5b9e\u9645\u4e0a\u662f\u6240\u6709\u6ee1\u8db3\u6ee1\u8db3 $\\forall i,c_i<b_{x_i}$ \u7684 $c_1,c_2,\\cdots,c_m$\uff0c\u5230\u8fbe $c_1,c_2,\\cdots,c_m$ \u7684\u6982\u7387\u3002\u800c\u663e\u7136\u5bf9\u4e8e\u56fa\u5b9a\u7684 $c_1,c_2,\\cdots,c_m$\uff0c\u5230\u8fbe $c_1,c_2,\\cdots,c_m$ \u7684\u6982\u7387\u53ef\u7528\u603b\u65b9\u6848\u6570\u9664\u4ee5\u5230\u8fbe $c_1,c_2,\\cdots,c_m$ \u7684\u65b9\u6848\u6570\u8ba1\u7b97\uff0c\u5373 $\\dfrac{(\\sum c_i)!}{\\prod c_i!}\\times\\prod(\\dfrac{a_i}{\\sum\\limits_{x\\in S}a_x})^{c_i}$\uff0c\u7b2c\u4e00\u9879\u4e3a\u591a\u91cd\u7ec4\u5408\u6570\uff0c\u5373\u5c06 $i$ \u4e2a $c_i$ \u586b\u5165\u4e00\u6392 $c_1+c_2+\\cdots+c_m$ \u4e2a\u6570\u7684\u65b9\u6848\u6570\uff0c\u7b2c\u4e8c\u9879\u8868\u793a\u751f\u6210 $c_i$ \u4e2a $i$ \u7684\u65b9\u6848\u6570\uff0c\u751f\u6210\u4e00\u4e2a $i$ \u7684\u6982\u7387\u4e3a $\\dfrac{a_i}{\\sum\\limits_{x\\in S}a_x}$\uff0c\u751f\u6210 $c_i$ \u4e2a $i$ \u7684\u6982\u7387\u5c31\u662f $(\\dfrac{a_i}{\\sum\\limits_{x\\in S}a_x})^{c_i}$\uff0c\u5f88\u597d\u7406\u89e3\u3002\n\n\u56e0\u6b64\u6211\u4eec\u6709\uff1a\n\n$$E(\\min(T))=\\dfrac{\\sum a_i}{\\sum\\limits_{x\\in T}a_x}\\sum\\limits_{c_i\\lt b_{x_i}}\\dfrac{(\\sum c_i)!}{\\prod c_i!}\\times\\prod(\\dfrac{a_i}{\\sum\\limits_{x\\in S}a_x})^{c_i}$$\n\n\u5c06\u5176\u5e26\u5165\u7b54\u6848\u8ba1\u7b97\u5f0f\u53ef\u5f97\n\n$$\\begin{aligned}ans&=\\sum\\limits_{\\varnothing\\ne T\\subseteq S}(-1)^{|T|-1}\\times\\dfrac{\\sum a_i}{\\sum\\limits_{x\\in T}a_x}\\sum\\limits_{c_i\\lt b_{x_i}}\\dfrac{(\\sum c_i)!}{\\prod c_i!}\\times\\prod(\\dfrac{a_i}{\\sum\\limits_{x\\in S}a_x})^{c_i}\\\\&=\\sum\\limits_{\\varnothing\\ne T\\subseteq S}(-1)^{|T|-1}\\times\\dfrac{\\sum a_i}{\\sum\\limits_{x\\in T}a_x}\\sum\\limits_{c_i\\lt b_{x_i}}\\dfrac{(\\sum c_i)!}{\\prod c_i!}\\times\\prod a_i^{c_i}\\times(\\dfrac{1}{\\sum\\limits_{x\\in T}a_x})^{\\sum c_i}\\end{aligned}$$\n\n\u6ce8\u610f\u5230 $\\sum a_i$ \u662f\u5b9a\u503c\uff0c$\\sum\\limits_{x\\in T}a_x,\\sum c_i$ \u90fd\u4e0d\u4f1a\u8d85\u8fc7 $400$\uff0c\u56e0\u6b64\u8003\u8651 $dp$\uff0c\u53ef\u4ee5\u5c06\u5176\u653e\u5165\u80cc\u5305\u7684\u72b6\u6001\u4e2d\uff0c\u8bbe $dp_{i,j,k}$ \u8868\u793a\u6240\u6709 $T\\subseteq\\{1,2,3,\\cdots,i\\}$\uff0c$\\sum\\limits_{x\\in T}a_x=j$\uff0c$\\sum c_i=k$ \u7684 $(-1)^{|T|-1}\\prod\\dfrac{1}{c_i!}a_i^{c_i}$ \u7684\u548c\uff0c\u8f6c\u79fb\u5c31\u5206 $i\\in T$ \u548c $i\\notin T$ \u8f6c\u79fb\u5373\u53ef\uff0c\u82e5 $i\\notin T$ \u5219 $dp_{i,j,k}\\leftarrow dp_{i-1,j,k}$\uff0c\u5426\u5219\u6211\u4eec\u679a\u4e3e $c_i<b_i$\uff0c\u90a3\u4e48 $dp_{i,j,k}\\leftarrow -dp_{i-1,j,k}\\times\\dfrac{1}{c_i!}a_i^{c_i}$\uff0c\u4e8c\u8005\u76f8\u52a0\u5373\u53ef\uff0c\u521d\u59cb\u503c $dp_{0,0,0}=-1$\uff08\u56e0\u4e3a\u7a7a\u96c6\u7684 $(-1)^{|T|+1}=-1$\uff09\uff0c\u6c42\u7b54\u6848\u5c31\u679a\u4e3e $\\sum\\limits_{x\\in T}a_x=j,\\sum c_i=k$\uff0c\u7136\u540e\u7528 $dp_{n,j,k}\\times(\\sum a_i)\\times\\dfrac{1}{j^{k+1}}\\times k!$ \u66f4\u65b0\u7b54\u6848\u5373\u53ef\uff0c\u7b2c\u4e00\u7ef4\u53ef\u4ee5\u4f18\u5316\u5230\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\sum a_i(\\sum b_i)^2$\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6 $\\sum a_i\\sum b_i$\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\n```cpp\nconst int MAXN=400;\nconst int MOD=998244353;\nint n,a[MAXN+5],b[MAXN+5],sa,sb,dp[MAXN+5][MAXN+5];\nint inv[MAXN+5],ifac[MAXN+5],fac[MAXN+5];\nvoid init_fac(int n){\n\tfor(int i=(inv[0]=inv[1]=ifac[0]=fac[0]=1)+1;i<=n;i++) inv[i]=1ll*inv[MOD%i]*(MOD-MOD/i)%MOD;\n\tfor(int i=1;i<=n;i++) ifac[i]=1ll*ifac[i-1]*inv[i]%MOD,fac[i]=1ll*fac[i-1]*i%MOD;\n}\nint main(){\n\tscanf(\"%d\",&n);init_fac(MAXN);dp[0][0]=MOD-1;\n\tfor(int i=1;i<=n;i++) scanf(\"%d%d\",&a[i],&b[i]),sa+=a[i],sb+=b[i];\n\tfor(int i=1;i<=n;i++){\n\t\tfor(int j=sa;j>=a[i];j--) for(int k=sb;~k;k--)\n\t\t\tfor(int l=0,pw=1;l<=min(k,b[i]-1);l++,pw=1ll*pw*a[i]%MOD){\n\t\t\t\tdp[j][k]=(dp[j][k]-1ll*dp[j-a[i]][k-l]*pw%MOD*ifac[l]%MOD+MOD)%MOD;\n\t\t\t}\n\t} int ans=0;\n\tfor(int i=1;i<=sa;i++) for(int j=0,pw=1;j<=sb;j++,pw=1ll*pw*inv[i]%MOD){\n\t\tans=(ans+1ll*dp[i][j]*pw%MOD*inv[i]%MOD*sa%MOD*fac[j]%MOD)%MOD;\n\t} printf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1618326999,
        "uid": 115194,
        "name": "lTgMFePRoeZ",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 AT5202 [AGC038E] Gachapon"
    },
    {
        "content": "\u5728\u535a\u5ba2\u56ed\u98df\u7528\u66f4\u4f73\uff1a[https://www.cnblogs.com/PinkRabbit/p/AGC038E.html](https://www.cnblogs.com/PinkRabbit/p/AGC038E.html)\u3002\n\n### \u9898\u610f\u7b80\u8ff0\n\n\u6709 $N$ \u4e2a\u7269\u54c1\uff0c\u7ed9\u5b9a $A_0 \\sim A_{N - 1}$ \u548c $B_0 \\sim B_{N - 1}$\u3002\n\n\u6bcf\u4e00\u4e2a\u5355\u4f4d\u65f6\u95f4\u4f60\u4f1a\u83b7\u5f97\u4e00\u4e2a\u7269\u54c1\uff0c\u7b2c $i$ \u4e2a\u7269\u54c1\u6709 $\\dfrac{A_i}{\\sum_{j = 0}^{N - 1} A_j}$ \u7684\u6982\u7387\u83b7\u5f97\u3002\n\n\u8ba1\u7b97\u7b2c\u4e00\u6b21\u5bf9\u4e8e\u6bcf\u4e2a $i$ \u90fd\u6709\u7b2c $i$ \u4e2a\u7269\u54c1\u83b7\u5f97\u81f3\u5c11 $B_i$ \u4e2a\u7684\u671f\u671b\u65f6\u95f4\u3002\n\n- $\\displaystyle \\sum_{i = 0}^{N - 1} A_i \\le 400$\n- $\\displaystyle \\sum_{i = 0}^{N - 1} B_i \\le 400$\u3002\n\n### \u9898\u89e3\n\n\u4ee4 $\\displaystyle \\Sigma A = \\sum_{i = 0}^{N - 1} A_i$ \u4ee5\u53ca $\\displaystyle \\Sigma B = \\sum_{i = 0}^{N - 1} (B_i - 1)$\u3002\n\n\u4f7f\u7528 Min-Max \u5bb9\u65a5\uff0c\u8f6c\u5316\u4e3a\u5bf9\u4e8e\u6bcf\u4e2a $\\{0, 1, \\ldots , N - 1\\}$ \u7684\u975e\u7a7a\u5b50\u96c6\u8ba1\u7b97\u7b2c\u4e00\u6b21\u5b50\u96c6\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u7269\u54c1\u83b7\u5f97\u81f3\u5c11 $B_i$ \u4e2a\u7684\u671f\u671b\u65f6\u95f4\uff0c\u5982\u679c\u96c6\u5408\u5927\u5c0f\u4e3a\u5947\u6570\uff0c\u5219\u5bf9\u7b54\u6848\u8d21\u732e $1$ \u500d\uff0c\u5426\u5219\u8d21\u732e $-1$ \u500d\u3002\n\n\u4e5f\u5c31\u662f\u6ee1\u8db3\u5b50\u96c6\u4e2d\u7684\u6240\u6709\u7269\u54c1\u83b7\u5f97\u7684\u6570\u91cf\u90fd\u5c11\u4e8e $B_i$ \u4e2a\u7684\u65f6\u95f4\uff0c\u52a0\u4e0a $1$\u3002\n\n\u5982\u679c\u6211\u4eec\u628a\u5f00\u59cb\u7684\u6ca1\u6709\u4efb\u4f55\u7269\u54c1\u7684\u72b6\u6001\u4e5f\u7b97\u4f5c\u4e00\u4e2a\u65f6\u523b\uff0c\u90a3\u4e48 $+1$ \u5c31\u7701\u4e86\u3002\n\n\u73b0\u5728\u8003\u8651\u5bf9\u4e8e\u4e00\u4e2a\u975e\u7a7a\u5b50\u96c6 $S \\subseteq \\{0, 1, \\ldots , N - 1\\}$ \u8ba1\u7b97\u5b50\u96c6\u4e2d\u7684\u6240\u6709\u7269\u54c1\u83b7\u5f97\u7684\u6570\u91cf\u90fd\u5c11\u4e8e $B_i$ \u4e2a\u7684\u65f6\u95f4\uff08\u5305\u62ec\u521d\u59cb\u65f6\u523b\uff09\u3002\n\n\u8fd9\u4e5f\u5c31\u662f\u5bf9\u4e8e\u6bcf\u4e00\u79cd\u7269\u54c1\u83b7\u5f97\u7684\u72b6\u6001\uff0c\u8ba1\u7b97\u8fd9\u79cd\u72b6\u6001\u5728\u6240\u6709\u53ef\u80fd\u60c5\u51b5\u4e0b\u51fa\u73b0\u7684\u671f\u671b\u6b21\u6570\uff08\u5305\u62ec\u521d\u59cb\u65f6\u523b\uff09\uff0c\u518d\u6c42\u548c\u3002\n\n\u6211\u4eec\u679a\u4e3e\u6bcf\u4e00\u79cd\u72b6\u6001\uff0c\u7528 $x$ \u8868\u793a\uff0c\u5176\u4e2d $x_i$ \u8868\u793a $i$ \u83b7\u5f97\u7684\u4e2a\u6570\uff08$i \\in S$\uff09\uff0c\u5fc5\u987b\u4fdd\u8bc1 $0 \\le x_i < B_i$\u3002\n\n\u63a5\u4e0b\u6765\u9700\u8981\u8ba1\u7b97\u8fd9\u79cd\u72b6\u6001\u5728\u6240\u6709\u53ef\u80fd\u60c5\u51b5\u4e0b\u51fa\u73b0\u7684\u671f\u671b\u6b21\u6570\u3002\n\n\u6ce8\u610f\u5230\u4e00\u65e6\u7b2c\u4e00\u6b21\u53d8\u6210\u4e86\u8fd9\u79cd\u72b6\u6001\uff0c\u53ea\u8981\u518d\u6b21\u83b7\u5f97 $S$ \u4e2d\u7684\u7269\u54c1\uff0c\u72b6\u6001\u5c31\u4f1a\u6539\u53d8\u3002\n\n\u4ee4 $P$ \u4e3a\u4e00\u6b21\u83b7\u5f97 $S$ \u4e2d\u7684\u7269\u54c1\u7684\u6982\u7387\uff0c\u4e5f\u5c31\u662f $\\dfrac{\\sum_{i \\in S} A_i}{\\Sigma A}$\u3002\u53ef\u4ee5\u53d1\u73b0\u4e00\u65e6\u7b2c\u4e00\u6b21\u53d8\u6210\u8fd9\u79cd\u72b6\u6001\u4e4b\u540e\uff0c\u72b6\u6001\u4f1a\u671f\u671b\u6301\u7eed $1 / P$ \u4e2a\u65f6\u523b\uff08\u5305\u62ec\u7b2c\u4e00\u6b21\u7684\u65f6\u523b\uff09\u3002\u5bf9\u4e8e\u56fa\u5b9a\u7684 $S$\uff0c$P$ \u90fd\u662f\u4e0d\u53d8\u7684\uff0c\u6240\u4ee5\u53ea\u8981\u6c42\u51fa\u6bcf\u4e00\u79cd\u72b6\u6001\u51fa\u73b0\u7684\u6982\u7387\u518d\u6700\u540e\u4e58\u4ee5 $1 / P$ \u5c31\u884c\u4e86\u3002\n\n\u8003\u8651\u8ba1\u7b97\u6bcf\u4e00\u79cd\u72b6\u6001\u51fa\u73b0\u7684\u6982\u7387\uff0c\u8fd9\u65f6\u5c31\u4e0d\u9700\u8981\u8003\u8651 $S$ \u4ee5\u5916\u7684\u7269\u54c1\u7684\u5f71\u54cd\u4e86\uff0c\u5b83\u4eec\u4e0d\u4f1a\u5f71\u54cd\u51fa\u73b0\u6982\u7387\u3002\n\n\u90a3\u4e48\u4e00\u79cd\u72b6\u6001\u7684\u6982\u7387\u5c31\u662f\u5b58\u5728\u4e00\u4e2a\u83b7\u5f97 $S$ \u4e2d\u7269\u54c1\u7684\u524d\u7f00\u6ee1\u8db3 $i$ \u6070\u597d\u51fa\u73b0\u4e86 $x_i$ \u6b21\u3002\n\n\u4ee4 $\\displaystyle X = \\sum_{i \\in S} x_i$ \u4ee5\u53ca $\\displaystyle C = \\sum_{i \\in S} A_i$\uff0c\u5219\u6982\u7387\u5c31\u662f $\\displaystyle X! \\prod_{i \\in S} {\\left( \\frac{A_i}{C} \\right)}^{x_i} \\frac{1}{(x_i)!}$\uff0c\u8fd9\u4e9b\u9636\u4e58\u6765\u81ea\u4e8e\u591a\u91cd\u7ec4\u5408\u6570\u3002\n\n\u5229\u7528\u4e58\u6cd5\u5206\u914d\u5f8b\uff0c\u4ee5 $X$ \u4e3a DP \u7684\u72b6\u6001\u8fdb\u884c\u8f6c\u79fb\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5bf9\u4e8e\u6240\u6709\u53ef\u80fd\u7684\u72b6\u6001\u6c42\u51fa\u8fd9\u4e2a\u6982\u7387\u7684\u548c\uff0c\u8f6c\u79fb\u5176\u5b9e\u7c7b\u4f3c\u4e8e\u6307\u6570\u578b\u751f\u6210\u51fd\u6570\u7684\u5377\u79ef\u3002\n\n\u800c\u5982\u679c\u9700\u8981\u5bf9\u6240\u6709\u7684 $S$ \u6c42\u548c\uff0c\u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u9700\u8981\u6ce8\u610f\u5904\u7406\u4e00\u4e0b\u5bb9\u65a5\u7cfb\u6570\u3002\u7136\u800c\u5bf9\u4e8e\u4e0d\u540c\u7684 $S$\uff0c$C$ \u662f\u4e0d\u56fa\u5b9a\u7684\uff0c\u4e0d\u8fc7\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u628a $C$ \u63d0\u51fa\u6765\uff0c\u4e5f\u5c31\u662f $\\displaystyle \\frac{X!}{C^X} \\prod_{i \\in S} \\frac{A_i^{x_i}}{(x_i)!}$\uff0c\u7136\u540e DP \u7684\u65f6\u5019\u8bb0\u5f55 $X, C$ \u4e24\u7ef4\u72b6\u6001\u5373\u53ef\u3002\n\n\u8fd9\u6837\u4f9d\u6b21\u52a0\u5165 $N$ \u4e2a\u7269\u54c1\uff0c\u6bcf\u6b21\u52a0\u5165\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O (B_i X C)$ \u8fdb\u884c\u66b4\u529b\u8f6c\u79fb\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O({(\\Sigma B)}^2 \\Sigma A)$\uff0c[\u8bc4\u6d4b\u94fe\u63a5](https://atcoder.jp/contests/agc038/submissions/12873708)\u3002",
        "postTime": 1588711358,
        "uid": 10703,
        "name": "\u5c0f\u7c89\u5154",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 AT5202 \u3010[AGC038E] Gachapon\u3011"
    },
    {
        "content": "\u5bb9\u6613\u60f3\u5230 $\\min-\\max$ \u5bb9\u65a5\uff1a\u8ba1\u7b97\u5bf9\u4e8e\u6bcf\u4e2a $\\{1,2,\\cdots,n\\}$ \u7684\u5b50\u96c6 $S$\uff0c$S$ \u4e2d\u7b2c\u4e00\u6b21\u5b58\u5728\u8fbe\u5230\u9650\u5b9a\u6b21\u6570\u7684\u6570\u7684\u671f\u671b\u8f6e\u6570\u3002\n\n\u4ee4 $P(S)=\\sum\\limits_{x\\in S}A_x$\u3002\u5bf9\u4e8e\u4e00\u4e2a\u56fa\u5b9a\u7684 $S$\uff0c\u5bb9\u6613\u8ba1\u7b97\u5b83\u7684\u7b54\u6848\u4e3a $(-1)^{|S|}\\frac{P(\\{1,2,\\cdots,n\\})}{P(S)}\\sum\\limits_{\\{a_i\\},0\\leq a_i<B_i}(\\sum a_i)!\\prod\\limits_{x\\in S}(\\frac{A_x}{P(S)})^{a_x}\\frac{1}{a_x!}$\u3002\n\n\u8fd9\u4e2a\u5f0f\u5b50\u663e\u7136\u53ef\u4ee5\u4f7f\u7528\u52a8\u6001\u89c4\u5212\u89e3\u51b3\uff0c\u72b6\u6001\u4e2d\u9700\u8981\u8bb0\u5f55\u5f53\u524d\u8003\u8651\u5230\u524d $i$ \u4e2a\u6570\uff0c$P(S)=j$\uff0c\u6240\u6709 $a_x$ \u7684\u548c\u4e3a $k$ \u7684\u8d21\u732e\u603b\u548c\u3002\u8f6c\u79fb\u65f6\u66b4\u529b\u679a\u4e3e $a_i$ \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((\\sum A_i)(\\sum B_i)^2)$\u3002",
        "postTime": 1682862903,
        "uid": 172020,
        "name": "Kevin090228",
        "ccfLevel": 8,
        "title": "Gachapon"
    },
    {
        "content": "### \u524d\u8a00\n\n\u8fd9\u91cc\u6709\u4e2a\u4e0d\u7528 min-max \u53cd\u6f14\u7684**\u7206\u6807**\u505a\u6cd5\u3002\n\n\u5176\u590d\u6742\u5ea6\u53ef\u4ee5\u505a\u5230 $O(n^2\\log n)$\u3002\uff08\u8ba4\u4e3a $n\\sim\\sum A\\sim\\sum B$\uff09\n\n\u53ef\u4ee5\u5148\u53bb\u4e86\u89e3\u4e00\u4e0b [\u3010ZJOI2019\u3011\u5f00\u5173](https://uoj.ac/problem/469) \u7684 GF \u505a\u6cd5\u518d\u6765\u9605\u8bfb\u6b64\u9898\u89e3\u3002\n\n---\n### \u4e00\u4e2a\u8bb0\u53f7\n\n\u4e3a\u4e86\u907f\u514d\u6b67\u4e49\uff0c\u5148\u58f0\u660e\u4e00\u4e0b\u4e00\u4e2a\u770b\u4e0a\u53bb\u6709\u70b9\u53e4\u602a\u7684\u8bb0\u53f7\u3002\n\n\u8bbe\n\n$$f=\\sum_kf_kz^k$$\n\n\u5219\u5b9a\u4e49\n\n$$\\Xi f=\\sum_kk!f_kz^k$$\n\n\u76f4\u89c2\u770b\u6765\u5c31\u662f\u7ed9\u6bcf\u4e2a\u7cfb\u6570\u4e58\u4e0a\u4e86\u4e00\u4e2a\u9636\u4e58\u3002\n\n\u56e0\u6b64\uff0c\u8fd9\u5c31\u662f\u4e00\u4e2a**\u4ece EGF \u8f6c\u4e3a OGF \u7684\u8bb0\u53f7**\u3002\n\n\u4e0d\u96be\u9a8c\u8bc1\u5176\u5bf9\u52a0\u6cd5\u3001\u6570\u4e58\u6709\u7ebf\u6027\u3002\n\n---\n### \u521d\u6b65\u601d\u8def\n\n\u8bbe $P_i=\\dfrac{A_i}S$\u3002\n\n\u8003\u8651\u66b4\u529b\u679a\u4e3e\u6700\u540e\u4e00\u6b65\u662f\u4ec0\u4e48\u6570\u3002\n\n\u90a3\u4e48\uff0c\u9664\u4e86\u5f53\u524d\u6570 $i$ \u5916\uff0c\u522b\u7684\u6570 $j$ \u90fd\u5df2\u7ecf\u51fa\u73b0\u4e86\u81f3\u5c11 $B_j$ \u6b21\uff0c\u800c\u81ea\u5df1\u5148\u524d\u5df2\u7ecf\u51fa\u73b0\u4e86\u6070 $B_i-1$ \u6b21\u3002\n\n\u56e0\u6b64\uff0c\u8003\u8651 EGF \u7ec4\u5408\u610f\u4e49\uff0c\u8bbe\uff1a\n\n$$f_i=\\sum_{k\\ge B_i}{P_i^kz^k\\over k!}=e^{P_iz}-\\sum_{k<B_i}{P_i^kz^k\\over k!}$$\n\n$$g_i={P_i^{B_i}z^{B_i-1}\\over(B_i-1)!}$$\n\n$$h=\\sum_ig_i\\sum_{j\\neq i}f_j$$\n\n\u5219\u7b54\u6848\u5373\n\n$$\\sum_kk[{z^k\\over k!}]h$$\n\n\u6216\u8005\u6539\u5199\u6210\n\n$$(\\Xi h)'(1)$$\n\n\uff08\u5176\u5b9e $\\Xi h$ \u6b64\u5904\u53ef\u4ee5\u8ba4\u4e3a\u662f\u8f6c\u6210\u4e86 PGF\uff0c\u7136\u540e\u8fd9\u4e2a\u67ff\u5b50\u7684\u6b63\u786e\u6027\u5c31\u4e0d\u8a00\u800c\u55bb\u4e86\uff09\n\n---\n\u5bb9\u6613\u53d1\u73b0 $h$ \u5373\u5206\u5f0f $\\sum\\dfrac gf$ \u7684\u5206\u5b50\u3002\n\n\u5bb9\u6613\u53d1\u73b0 $h$ \u628a\u4e58\u6cd5\u5c55\u5f00\u540e\u6bcf\u9879\u5747\u5f62\u5982\n\n$$C_{ab}z^ae^{\\frac{bz}S}$$\n\n**\u5347\u4e00\u7ef4\uff01**\n\n\u6362\u5143\uff0c\u8bbe $u=e^{\\frac zS}$\uff0c\u5219\u5373\n\n$$C_{ab}z^au^b$$\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u66b4\u529b\u6a21\u62df\u52a0\u5165\u4e00\u4e2a\u5206\u5f0f\u901a\u5206\u7684\u8fc7\u7a0b\uff0c\u628a $h$ \u7684\u8ba1\u7b97\u4f7f\u7528\u4e00\u4e2a**\u4e8c\u7ef4\u80cc\u5305**\u7684 dp \u5728 $O(n^3)$\uff08\u5e94\u8be5\uff1f\uff09\u7684\u65f6\u95f4\u5185\u5b8c\u6210\u3002\n\n\n---\n### \u9020\u798f\u8c03\u8bd5\n\n\u4ee5\u4e0b\u662f\u6837\u4f8b\u4e8c\u7684 $h$\uff0c\u53ef\u4f9b\u8c03\u8bd5\u4f7f\u7528\u3002\n\n$$-{{\\left(u^3-2\\right)\\,z^3+\\left(-u^5+9\\,u^3+4\\,u^2-24\\right)\\,z^2+ \\left(-48\\,u^4+48\\,u^3+36\\,u^2+120\\,u-156\\right)\\,z-216\\,u^3+216\\,u^ 2+216\\,u-216}\\over{432}}$$\n\n---\n### \u8fdb\u4e00\u6b65\u63a8\u5bfc\n\n\u8003\u8651\u600e\u4e48\u8ba1\u7b97\n\n$$(\\Xi z^ae^{\\frac{bz}S})'(1)$$\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u4ee5\u4e0b\u89e3\u51fa\n\n$$(\\Xi z^ae^{bz})'(1)$$\n\n\u7684\u67ff\u5b50\uff0c\u7136\u540e\u6700\u540e\u518d\u628a $b$ \u4ee3\u4e3a $\\frac bS$ \u5373\u53ef\u3002\n\n\u5148\u6446\u7ed3\u8bba\uff1a\n\n$$\\Xi z^ae^{bz}={a!z^a\\over(1-bz)^{a+1}}$$\n\n\u8bc1\u660e\uff1f\n\n\u53ef\u4ee5\u76f4\u63a5\u628a\u7cfb\u6570\u5c55\u5f00\uff1b\u5f53\u7136\uff0c\u4e5f\u6709\u66f4\u7b80\u6d01\uff08\uff1f\uff09\u7684\u63a8\u5bfc\uff0c\u89c1\u6587\u672b\u3002\n\n\u7136\u540e\u5c31\u5f88\u7b80\u5355\u4e86\u3002\n\n$$(\\Xi z^ae^{bz})'=\\bigg({a!z^a\\over(1-bz)^{a+1}}\\bigg)'={a!z^{a-1}(a+bz)\\over(1-bz)^{a+2}}$$\n\n$$(\\Xi z^ae^{bz})'(1)={a!(a+b)\\over(1-b)^{a+2}}$$\n\n---\n### \u597d\u4e86\uff1f\n\n\u597d\uff0c\u6211\u4eec\u73b0\u5728\u5df2\u7ecf\u5f97\u5230\u4e86\u4e00\u4e2a $O(n^3)$\uff08\u5e94\u8be5\uff1f\uff09\u7684\u505a\u6cd5\u4e86\u3002\n\n\u4f46\u662f\u8fd9\u6837\u8fd8\u4e0d\u591f\uff0c\u6211\u4eec\u53ef\u4ee5\u6765\u7684**\u66f4\u7ed9\u529b**\u4e00\u70b9\u554a\uff01\n\n\u8003\u8651\u74f6\u9888\u5728\u5206\u5f0f\u57fa\u6c42\u548c\u4e0a\u3002\n\n\u56de\u60f3\u662f\u4e00\u7ef4\u591a\u9879\u5f0f\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 $O(n\\log^2n)$ \u7684\u65f6\u95f4\u5185\u7528\u5206\u6cbb\u5377\u79ef\u89e3\u51b3\u3002\n\n\u73b0\u5728\u662f\u4e8c\u7ef4\u591a\u9879\u5f0f\u7684\u5206\u5f0f\u57fa\uff0c\u6211\u4eec\u4f9d\u65e7\u8003\u8651\u5206\u6cbb\u5377\u79ef\uff0c\u53ea\u662f\u5355\u6b21\u4e58\u6cd5\u6539\u7528**\u4e8c\u7ef4 FFT**\u3002\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u505a\u5230\u4e86 $O(n^2\\log n)$ \u7684\u4f18\u79c0\u590d\u6742\u5ea6\uff01\n\n\u4e8e\u662f\uff0c\u6211\u4eec\u5c31**\u7206\u6807**\u4e86\u3002\n\n---\n### Laplace \u53d8\u6362\n\n\u6587\u672b\uff0c\u6211\u4eec\u7ed9\u51fa $\\Xi z^ae^{bz}$ \u7684\u53e6\u4e00\u79cd\u63a8\u5bfc\u65b9\u6cd5\u3002\n\n\u5927\u5bb6\u90fd\u77e5\u9053\n\n$$a!=\\int_0^{+\\infty}t^ae^{-t}\\operatorname dt$$\n\n\u5427\uff1f\n\n~~\u4e0d\u77e5\u9053\u4e5f\u6ca1\u6709\u5173\u7cfb\uff0c\u73b0\u5728\u4e0d\u5c31\u77e5\u9053\u4e86\u3002~~\n\n\u5b9a\u4e49 Laplace \u53d8\u6362\n\n$${\\mathcal L}f(z)=\\int_0^{+\\infty}f(zt)e^{-t}\\operatorname dt$$\n\n\u5bb9\u6613\u9a8c\u8bc1\u6709 $\\Xi f={\\mathcal L}f$\u3002\n\n\u4e8e\u662f $f=z^ae^{bz}$ \u65f6\uff0c\n\n$${\\mathcal L}f(z)=\\int_0^{+\\infty}f(zt)e^{-t}\\operatorname dt\\\\=\\int_0^{+\\infty}(zt)^ae^{bzt}e^{-t}\\operatorname dt\\\\=z^a\\int_0^{+\\infty}t^ae^{-t(1-bz)}\\operatorname dt\\\\={z^a\\over(1-bz)^{a+1}}\\int_0^{+\\infty}(t(1-bz))^ae^{-t(1-bz)}\\operatorname d(t(1-bz))\\\\={a!z^a\\over(1-bz)^{a+1}}$$\n\n\u4e8e\u662f\u5c31\u5f97\u5230\n\n$$\\Xi z^ae^{bz}={a!z^a\\over(1-bz)^{a+1}}$$\n\n\u8fd9\u662f\u4e00\u4e2a\u4ee4\u4eba\u6ee1\u610f\u7684\u6536\u5c3e\u3002\n",
        "postTime": 1661149705,
        "uid": 105050,
        "name": "myee",
        "ccfLevel": 7,
        "title": "5202"
    },
    {
        "content": "\u53ef\u4ee5\u53d1\u73b0\uff0c\u9898\u76ee\u8981\u6c42\u7684\u5b9e\u9645\u4e0a\u5c31\u662f\u6700\u5927\u7684\u53d6\u5230$B_i$\u4e2a\u6570\u7684\u671f\u671b\u65f6\u95f4\uff0c\u8003\u8651min_max\u5bb9\u65a5\uff1a\n$$E(max(S))=\\sum_{T\\in S}(-1)^{|T|+1}E(min(T))$$\n\u90a3\u4e48\u95ee\u9898\u5c31\u8f6c\u5316\u4e3a\u4e86\u6c42\u6bcf\u4e2a\u96c6\u5408\u4e2d\u53d6\u5230$B_i$\u4e2a\u6570\u7684\u6700\u5c0f\u671f\u671b\u65f6\u95f4\u3002\n\n\u5148\u8003\u8651\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u4e86\u8fd9\u4e2a\u96c6\u5408\uff0c\u5e94\u8be5\u600e\u4e48\u6c42\u3002\n\n\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u7684\u96c6\u5408\u662f$T=\\{x_1,x_2,\\dots x_m\\}$\u3002\n\n\u8003\u8651\u66b4\u529b\u679a\u4e3e\uff1a\n$$E=(-1)^{m+1}\\times \\frac{S}{\\sum A[x_i]}\\times\\sum_{c_i=0}^{B[x_i]-1}\\frac{(\\sum c_i)!}{\\prod c_i!}\\times\\prod(\\frac{A[x_i]}{\\sum A[x_i]})^{c_i}$$\n\u5176\u4e2d$(-1)^{m+1}$\u662f\u5bb9\u65a5\u7cfb\u6570\uff0c\u800c$\\frac{S}{\\sum A[x_i]}$\u662f\u671f\u671b\u9009\u591a\u5c11\u4e2a\u6570\u624d\u4f1a\u9009\u5230\u8fd9\u4e2a\u96c6\u5408\u91cc\u4e00\u6b21\u3002\n\n\u90a3\u4e48\u8fd9\u6837\u5c31\u53ef\u4ee5\u7b97\u51fa\u6765\u4e86\u3002\n\n\u4f46\u662f\u6211\u4eec\u4e0d\u53ef\u80fd\u679a\u4e3e\u6240\u6709\u7684\u96c6\u5408\uff0c\u4e8e\u662f\u8003\u8651\u5728\u8f6c\u79fb\u7684\u8fc7\u7a0b\u4e2d\uff08\u52a0\u5165\u4e00\u4e2a\u6570\uff09\uff0c\u54ea\u4e9b\u91cf\u4f1a\u6539\u53d8\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u4f1a\u6539\u53d8\u7684\u91cf\u662f$\\sum A[x_i]$\u4e0e$\\sum c_i$\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u8003\u8651\u8bbe$f[i][j][k]$\u8868\u793a\u524d$i$\u4e2a\u6570\uff0c$\\sum A[x_i]=j,\\sum c_i=k$\u7684\u65f6\u5019\uff0c\u5f0f\u5b50\u91cc\u4e0e\u8fd9\u4e24\u4e2a\u91cf\u65e0\u5173\u7684\u503c\u7684\u548c\u3002\n\n\u518d\u8f6c\u5316\u4e00\u4e0b\u5f0f\u5b50\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e2a\u503c\u5b9e\u9645\u4e0a\u5c31\u662f\uff1a\n$$(-1)^{m+1}\\sum_{c_i=0}^{B[x_i]-1}\\frac{A[x_i]^{c_i}}{\\prod c_i!}$$\n\u8f6c\u79fb\u7684\u65f6\u5019\u679a\u4e3e\u4e00\u4e0b\u5f53\u524d\u8fd9\u4e2a\u6570\u9009\u591a\u5c11\u4e2a\u5373\u53ef\u3002\n\ndp\u5b8c\u4e86\u4e4b\u540e\uff0c\u7b54\u6848\u5c31\u53ef\u4ee5\u76f4\u63a5\u5e26\u8fdb\u53bb\u6c42\u4e86\uff1a\n$$ans=\\sum_{i=1}^{S}\\sum_{j=0}^{sum_B}f[n][i][j]\\times\\frac{S}{i}\\times \\frac{j!}{i^j}=\\sum_{i=1}^{S}\\sum_{j=0}^{sum_B}f[n][i][j]\\times \\frac{S\\times j!}{i^{j+1}}$$\n\u8fd9\u6837\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u590d\u6742\u5ea6$O((\\sum B_i)^2\\times S)$\u3002\n\ncode:\n```cpp\n#include<bits/stdc++.h>\n#define maxn 405\n#define mod 998244353\nusing namespace std;\ntypedef long long ll;\nint read()\n{\n    int x=0,f=1;\n    char ch=getchar();\n    while(ch-'0'<0||ch-'0'>9){if(ch=='-') f=-1;ch=getchar();}\n    while(ch-'0'>=0&&ch-'0'<=9){x=x*10+ch-'0';ch=getchar();}\n    return x*f;\n}\nint n,sa,sb;\nint a[maxn],b[maxn];\nint f[maxn][maxn][maxn];\nint fac[maxn],inv[maxn];\nint quick_pow(int x,int p)\n{\n    int an=1,po=x;\n    while(p)\n    {\n        if(p&1)  an=1ll*an*po%mod;\n        po=1ll*po*po%mod;\n        p>>=1;\n    }\n    return an;\n}\nvoid add(int &x,int y)\n{\n    x=(x+y>=mod)?(x+y-mod):x+y;\n}\nint main()\n{\n    n=read();\n    for(int i=1;i<=n;i++)  a[i]=read(),b[i]=read(),sa+=a[i],sb+=b[i];\n    fac[0]=1;for(int i=1;i<=400;i++)  fac[i]=1ll*fac[i-1]*i%mod;\n    inv[400]=quick_pow(fac[400],mod-2);\n    for(int i=399;i>=0;i--)  inv[i]=1ll*inv[i+1]*(i+1)%mod;\n    f[0][0][0]=mod-1;\n    for(int i=1;i<=n;i++)\n    {\n        for(int j=0;j<=sa;j++)\n        {\n            for(int k=0;k<=sb;k++)\n            {\n                if(!f[i-1][j][k])  continue;\n                add(f[i][j][k],f[i-1][j][k]);\n                int x=1;\n                for(int l=0;l<b[i];l++,x=1ll*x*a[i]%mod) add(f[i][j+a[i]][k+l],mod-1ll*x*inv[l]%mod*f[i-1][j][k]%mod);\n            }\n        }\n    }\n    int ans=0;\n    for(int i=1;i<=sa;i++)\n    {\n        int y=quick_pow(i,mod-2);\n        int x=1ll*sa*y%mod;\n        for(int j=0;j<=sb;j++,x=1ll*x*y%mod)  add(ans,1ll*x*fac[j]%mod*f[n][i][j]%mod);\n    }\n    cout<<ans<<endl;\n    return 0;\n}\n```",
        "postTime": 1583117734,
        "uid": 46396,
        "name": "justin_cao",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 AT5202 \u3010[AGC038E] Gachapon\u3011"
    },
    {
        "content": "\u53d1\u73b0\u9898\u76ee\u6240\u6c42\u5373\u4e3a\u6700\u665a\u8fbe\u5230\u51fa\u73b0\u6b21\u6570\u7684\u6574\u6570\u7684\u671f\u671b\u6b21\u6570\uff0c\u8003\u8651 $\\text{min-max}$ \u5bb9\u65a5\uff0c\u5c06\u5176\u8f6c\u5316\u4e3a\u6700\u65e9\u8fbe\u5230\u51fa\u73b0\u6b21\u6570\u7684\u6574\u6570\u7684\u671f\u671b\u6b21\u6570\uff1a\n$$\n\\large E(\\max(S) )=\\sum_{T\\subseteq S}(-1)^{|T|+1}E(\\min(T))\n$$\n\u8bbe\u96c6\u5408 $T=\\{ x_1,x_2,\\dots,x_m \\}$\uff0c\u8003\u8651\u5982\u4f55\u8ba1\u7b97\u8be5\u96c6\u5408\u7684\u8d21\u732e\uff0c\u56e0\u4e3a\u671f\u671b\u7684\u7ebf\u6027\u6027\uff0c\u6240\u4ee5\u76f4\u63a5\u6c42\u548c\u6240\u6709\u672a\u8fbe\u5230\u51fa\u73b0\u6b21\u6570\u7684\u72b6\u6001\u7684\u671f\u671b\u6b21\u6570\u5373\u53ef\uff0c\u5f97\uff1a\n$$\n\\large\\begin{aligned}\n\n&(-1)^{|T|+1}E(\\min(T)) \\\\\n\n=&(-1)^{m+1}\\sum_{i \\geqslant 0} \\left( \\frac{s-\\sum a_{x_i}}{s} \\right)^i\\sum_{0 \\leqslant c_i < b_{x_i}} \\frac{(\\sum c_i)!}{\\prod(c_i!)}\\prod\\left( \\frac{a_{x_i}}{\\sum a_{x_i}} \\right)^{c_i} \\\\\n\n=&(-1)^{m+1}\\frac{s}{\\sum a_{x_i}}\\sum_{0 \\leqslant c_i < b_{x_i}} \\frac{(\\sum c_i)!}{\\prod(c_i!)}\\prod\\left( \\frac{a_{x_i}}{\\sum a_{x_i}} \\right)^{c_i} \\\\\n\n\\end{aligned}\n$$\n\u7b2c\u4e00\u9879\u4e3a\u5bb9\u65a5\u7cfb\u6570\uff0c\u7b2c\u4e8c\u9879\u4e3a\u968f\u673a\u5230\u8be5\u96c6\u5408\u5143\u7d20\u7684\u671f\u671b\u6b21\u6570\uff0c\u7b2c\u4e09\u9879\u662f\u53ef\u91cd\u96c6\u6392\u5217\uff0c\u56e0\u4e3a\u6574\u6570\u7684\u51fa\u73b0\u987a\u5e8f\u9700\u8981\u8003\u8651\uff0c\u7b2c\u56db\u9879\u4e3a\u96c6\u5408\u5185\u6bcf\u4e2a\u6574\u6570\u968f\u673a\u5230\u7684\u6982\u7387\u3002\n\n\u53d1\u73b0\u5f0f\u5b50\u4e3b\u8981\u548c $\\sum a_{x_i},\\sum c_i$ \u6709\u5173\uff0c\u53ef\u4ee5\u8003\u8651 $DP$ \u6765\u8fdb\u884c\u8ba1\u7b97\u3002\u8bbe $f_{i,j,k}$ \u4e3a\u8003\u8651\u4e86\u524d $i$ \u4e2a\u6570\uff0c$\\sum a_{x_i}$ \u4e3a $j$\uff0c$\\sum c_i$ \u4e3a $k$ \u7684\u6240\u6709\u96c6\u5408\u6309\u4e0a\u9762\u5f0f\u5b50\u53bb\u6389\u4e0e $\\sum a_{x_i},\\sum c_i$ \u6709\u5173\u7684\u9879\u7684\u4e58\u79ef\u4e4b\u548c\u3002\n\n\u8f6c\u79fb\u4e3a\u8003\u8651\u662f\u5426\u52a0\u5165\u7b2c $i$ \u4e2a\u6570\uff0c\u52a0\u5165\u5c31\u8003\u8651\u7b2c $i$ \u4e2a\u6570\u548c\u5176\u51fa\u73b0\u6b21\u6570\u5bf9\u5f0f\u5b50\u7684\u8d21\u732e\u3002\u6700\u540e\u679a\u4e3e $\\sum a_{x_i},\\sum c_i$ \u5373\u53ef\u8ba1\u7b97\u7b54\u6848\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define maxn 410\n#define all 400\n#define p 998244353\nusing namespace std;\ntypedef long long ll;\ntemplate<typename T> inline void read(T &x)\n{\n    x=0;char c=getchar();bool flag=false;\n    while(!isdigit(c)){if(c=='-')flag=true;c=getchar();}\n    while(isdigit(c)){x=(x<<1)+(x<<3)+(c^48);c=getchar();}\n    if(flag)x=-x;\n}\nint n,s1,s2;\nll ans;\nint a[maxn],b[maxn];\nll f[maxn][maxn][maxn],inv[maxn];\nvoid init()\n{\n    inv[0]=inv[1]=1;\n    for(int i=2;i<=all;++i) inv[i]=(p-p/i)*inv[p%i]%p;\n}\nint main()\n{\n    init(),read(n);\n    for(int i=1;i<=n;++i)\n        read(a[i]),read(b[i]),s1+=a[i],s2+=b[i];\n    f[0][0][0]=p-1;\n    for(int i=1;i<=n;++i)\n    {\n        ll v=1;\n        for(int j=0;j<=s1;++j)\n            for(int k=0;k<=s2;++k)\n                f[i][j][k]=f[i-1][j][k];\n        for(int t=0;t<b[i];++t,v=v*a[i]%p*inv[t]%p)\n            for(int j=a[i];j<=s1;++j)\n                for(int k=t;k<=s2;++k)\n                    f[i][j][k]=(f[i][j][k]-f[i-1][j-a[i]][k-t]*v%p+p)%p;\n    }\n    for(int j=1;j<=s1;++j)\n    {\n        ll v=1;\n        for(int k=0;k<=s2;++k,v=v*k%p*inv[j]%p)\n            ans=(ans+f[n][j][k]*s1%p*inv[j]%p*v%p)%p;\n    }\n    printf(\"%lld\",ans);\n    return 0;\n}\n```",
        "postTime": 1601212627,
        "uid": 172489,
        "name": "lhm_",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 AT5202 \u3010[AGC038E] Gachapon\u3011"
    }
]