[
    {
        "content": "[\u539f\u9898\u94fe\u63a5](https://atcoder.jp/contests/arc017/tasks/arc017_4)\n\u56e0\u4e3a\u6d1b\u8c37\u4e0a\u4e0d\u80fd\u63d0\u4ea4\uff0c\u6240\u4ee5\u6211\u662f\u5728\u539fOJ\u4e0a\u63d0\u4ea4\u7684\uff0c[\u63d0\u4ea4\u8bb0\u5f55](https://atcoder.jp/contests/arc017/submissions/16192347)\n\n\n------------\n\n\u5bf9\u4e8e\u8fd9\u9053\u9898\u4e2d\u7684\u533a\u95f4\u4fee\u6539\uff0c\u533a\u95f4\u67e5\u8be2\u64cd\u4f5c\uff0c\u6211\u4eec\u81ea\u7136\u5c31\u4f1a\u60f3\u5230\u7528\u7ebf\u6bb5\u6811\u7ef4\u62a4\u3002\u4f46\u662f\u6211\u4eec\u9700\u8981\u7ef4\u62a4\u4ec0\u4e48\u5462\uff1f\u662f\u539f\u6570\u7ec4\u5417\uff1f\u80af\u5b9a\u4e0d\u662f\uff0c\u56e0\u4e3a\u533a\u95f4\u4fee\u6539\u6ca1\u6cd5\u9ad8\u6548\u5730\u7ef4\u62a4gcd\u3002\n\n\u6c42gcd\u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a\u8f97\u8f6c\u76f8\u9664\u6cd5 $\\gcd(a,b)=\\gcd(b,a\\mod b)$\uff0c\u66f4\u76f8\u51cf\u635f\u6cd5 $\\gcd (a,b)=\\gcd(a,\\lvert a-b\\rvert)$\uff0c\u53d7\u5230\u66f4\u76f8\u51cf\u635f\u6cd5\u7684\u542f\u53d1\uff0c\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u5dee\u5206\u6570\u7ec4$t_i=a_i-a_{i-1}$\uff0c\u5176\u4e2d $a$ \u662f\u539f\u6570\u7ec4\uff0c\u4e0d\u96be\u53d1\u73b0\uff0c$a_i=\\sum\\limits_{i=1}^n t_i$\u3002\n\n\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u533a\u95f4 $[l,r]$ \uff0c\u600e\u6837\u6c42\u51fa\u8fd9\u4e2a\u533a\u95f4\u7684gcd\u503c\u5462\uff1f\n\n$$ \\gcd(a_l,a_{l+1},...,a_{r-1},a_r)=\\gcd(a_l,...,\\gcd(a_{r-1},\\lvert a_r-a_{r-1}\\rvert)) $$\n\n\u56e0\u4e3a $\\gcd(a,\\gcd(b,c))=\\gcd(a,b,c)$\uff0c\u7136\u540e\u6211\u4eec\u518d\u628a $a_r-a_{r-1}$ \u66ff\u6362\u6210 $t_i$\uff0c\u5f97\u5230\uff1a\n\n$$\\gcd(a_l,...,a_{r-1},\\lvert t_i\\rvert)$$\n\n\u4e00\u76f4\u505a\u4e0b\u53bb,\u518d\u628a $a_l$ \u66ff\u6362\u6210 $\\sum\\limits_{i=1}^n t_i$\uff0c\u5f97\u5230\uff1a\n\n$$\\gcd(\\sum\\limits_{i=1}^n t_i,\\lvert t_{l+1}\\rvert,...,\\lvert t_{r-1}\\rvert,\\lvert t_r\\rvert)$$\n\n\u6211\u4eec\u6ce8\u610f\u5230\uff0c\u8fd9\u4e2a\u5f0f\u5b50\u4e2d $\\sum\\limits_{i=1}^n t_i$ \u548c $\\gcd(\\lvert t_{l+1}\\rvert,...,\\lvert t_{r-1}\\rvert,\\lvert t_r\\rvert)$ \u90fd\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u7684 $O(\\log n)$\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u6c42\u51fa\u6765\u3002\n\n\u81f3\u4e8e\u4fee\u6539\u64cd\u4f5c\uff0c\u7531\u4e8e\u662f\u5dee\u5206\u6570\u7ec4\uff0c\u76f4\u63a5\u518d $l$ \u4f4d\u7f6e\u52a0\u4e0a\uff0c$r+1$ \u4f4d\u7f6e\u51cf\u53bb\u5c31\u884c\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long \nusing namespace std;\nint n,m,a[105000],t[105000];\nstruct tree{\n\tint sum,gcd;//\u7ebf\u6bb5\u6811\u7ef4\u62a4\u533a\u95f4\u548c\u4e0e\u533a\u95f4gcd\n}tr[405000];\nvoid build(int rt,int l,int r){\n\tif(l==r){\n\t\ttr[rt].sum=t[l];\n\t\ttr[rt].gcd=abs(t[l]);//\u5dee\u5206\u6570\u7ec4\u53ef\u80fd\u4e3a\u8d1f\u6570\uff0c\u522b\u5fd8\u4e86\u53d6\u7edd\u5bf9\u503c\n\t\treturn;\n\t}\n\tint mid=(l+r)/2;\n\tbuild(rt*2,l,mid);\n\tbuild(rt*2+1,mid+1,r);\n\ttr[rt].sum=tr[rt*2].sum+tr[rt*2+1].sum;\n\ttr[rt].gcd=__gcd(tr[rt*2].gcd,tr[rt*2+1].gcd);\n}//\u7ebf\u6bb5\u6811\u5e38\u89c4\u64cd\u4f5c\uff1a\u5efa\u6811\u3002\nvoid update(int rt,int l,int r,int x,int k){//\u4fee\u6539\u64cd\u4f5c\n\tif(l==r){\n\t\ttr[rt].sum+=k;\n\t\ttr[rt].gcd=abs(tr[rt].sum);\n\t\treturn;\n\t}\n\tint mid=(l+r)/2;\n\tif(mid>=x)update(rt*2,l,mid,x,k);\n\telse update(rt*2+1,mid+1,r,x,k);\n\ttr[rt].sum=tr[rt*2].sum+tr[rt*2+1].sum;\n\ttr[rt].gcd=__gcd(tr[rt*2].gcd,tr[rt*2+1].gcd);\n}\nint query_sum(int rt,int l,int r,int ll,int rr){//\u533a\u95f4\u548c\n\tif(l>=ll&&r<=rr)return tr[rt].sum;\n\tint mid=(l+r)/2,sum=0;\n\tif(mid>=ll)sum+=query_sum(rt*2,l,mid,ll,rr);\n\tif(mid<rr)sum+=query_sum(rt*2+1,mid+1,r,ll,rr);\n\treturn sum;\n}\nint query_gcd(int rt,int l,int r,int ll,int rr){//\u533a\u95f4gcd\n\tif(l>=ll&&r<=rr)return tr[rt].gcd;\n\tint mid=(l+r)/2,gcd=0;\n\tif(mid>=ll)gcd=__gcd(gcd,query_gcd(rt*2,l,mid,ll,rr));\n\tif(mid<rr)gcd=__gcd(gcd,query_gcd(rt*2+1,mid+1,r,ll,rr));\n\treturn gcd;\n}\nsigned main(){\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<=n;++i){\n\t\tscanf(\"%lld\",&a[i]);\n\t\tt[i]=a[i]-a[i-1];\n\t}\n\tbuild(1,1,n);\n\tscanf(\"%lld\",&m);\n\twhile(m--){\n\t\tint opt,l,r;\n\t\tscanf(\"%lld%lld%lld\",&opt,&l,&r);\n\t\tif(opt==0)printf(\"%lld\\n\",__gcd(query_sum(1,1,n,1,l),query_gcd(1,1,n,l+1,r)));\n\t\telse{\n\t\t\tupdate(1,1,n,l,opt);\n\t\t\tif(r<n)update(1,1,n,r+1,-opt);\n\t\t}\n\t}\n\treturn 0;\n}\n```\n",
        "postTime": 1598236656,
        "uid": 151924,
        "name": "YueYang1235",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 AT810 \u3010ARC\u305f\u3093\u30af\u30c3\u30ad\u30fc\u3011"
    }
]