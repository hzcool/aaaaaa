[
    {
        "content": "\u672c\u9898\u540c\u6b65\u6536\u5f55\u5728 [Atcoder \u9898\u76ee\u8865\u5168\u8ba1\u5212](https://www.luogu.com.cn/training/256520) \u4e2d\uff0c\u6b22\u8fce\u652f\u6301\u3002\n\n### \u9898\u76ee\u5206\u6790\uff1a\n\n\u6ca1\u770b\u61c2\u4e3a\u4ec0\u4e48\u4eba\u5bb6\u8dd1\u7684\u8fd9\u4e48\u5feb\uff0c\u6240\u4ee5\u6839\u53f7\u5206\u6cbb\u5566\u3002\n\n\u4e00\u4e2a\u5f88\u5173\u952e\u7684\u6027\u8d28\uff0c\u6bcf\u6b21\u67e5\u8be2\u8303\u56f4\u7684\u503c\u57df\u5728 $[0,10^5]$ \u4e4b\u95f4\uff0c\u6211\u4eec\u53ef\u4ee5\u94a6\u5b9a\u4e00\u4e2a\u9608\u503c $\\lim = \\sqrt {10^5}$\uff0c\u5982\u679c\u5c0f\u4e8e $\\lim$\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 $O(n \\sqrt n)$ \u7684\u590d\u6742\u5ea6\u9884\u5904\u7406\u51fa\u5c0f\u4e8e\u7b49\u4e8e $\\lim$ \u65f6\u523b\u7684\u6240\u6709\u60c5\u51b5\uff0c\u53ef\u4ee5\u5dee\u5206\u6216\u8005\u6811\u72b6\u6570\u7ec4\uff1b\u5982\u679c\u5927\u4e8e $\\lim$\uff0c\u5219\u6709\u6548\u8d21\u732e\u7684\u901f\u5ea6\u533a\u95f4\u5728 $[- \\lim,\\lim]$ \u4e2d\uff0c\u5f00\u4e2a `vector` \u4ee5\u901f\u5ea6\u4e3a\u4e0b\u6807\u5c06 $x_i$ \u76f4\u63a5\u63d2\u5165\uff0c\u6392\u5e8f\uff0c\u67e5\u8be2\u7684\u65f6\u5019\u76f4\u63a5\u5faa\u73af\u6240\u6709\u6709\u6548\u901f\u5ea6\uff0c\u4e8c\u5206\u67e5\u627e\u533a\u95f4\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n \\sqrt n \\log n)$\u3002\n\n### Code.\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\nusing namespace std;\nconst int N=1e5+10,lim=350; vector<int> a[1010];\nint lowbit(int x) {return x&-x;}\nstruct node\n{\n\tint tr[N]; void modify(int x) {for(int i=x;i<=1e5;i+=lowbit(i)) tr[i]++;}\n\tint query(int x) {int sum=0; for(int i=x;i;i-=lowbit(i)) sum+=tr[i]; return sum;}\n} pos[400];\nint n,q,x[N],v[N]; \nint main()\n{\n    scanf(\"%d\",&n); for(int i=1;i<=n;i++) scanf(\"%d%d\",x+i,v+i);\n    for(int t=0;t<=lim;t++)\n        for(int i=1;i<=n;i++)\n\t\t{\n            ll tmp=(ll)x[i]+v[i]*t; if(tmp < 0 || tmp > 1e5) continue;\n            pos[t].modify(tmp+1);\n        }\n    for(int i=1;i<=n;i++) {if(v[i] < -lim || v[i] > lim) continue; a[v[i]+lim].emplace_back(x[i]);}\n    for(auto &it : a) sort(it.begin(),it.end());\n    scanf(\"%d\",&q);\n    while(q -- )\n    {\n    \tint t,l,r; scanf(\"%d%d%d\",&t,&l,&r);\n        if(t <= lim) printf(\"%d\\n\",pos[t].query(r+1)-pos[t].query(l));\n        else\n\t\t{\n\t\t\tint sum=0;\n            for(int pl=-lim;pl<=lim;pl++)\n                sum+=upper_bound(a[pl+lim].begin(),a[pl+lim].end(),r-pl*t)-lower_bound(a[pl+lim].begin(),a[pl+lim].end(),l-pl*t);\n        \tprintf(\"%d\\n\",sum);\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1669633527,
        "uid": 897035,
        "name": "Shiina_Mahiru",
        "ccfLevel": 0,
        "title": "[2nd TKPPC E] Walking NPCs \u9898\u89e3"
    }
]