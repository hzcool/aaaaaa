[
    {
        "content": "**\u4f20\u9001\u95e8\uff1a** [ABC275Ex](https://atcoder.jp/contests/abc275/tasks/abc275_h)\n\n---------------------\n\n**\u9898\u76ee\u5927\u610f\uff1a**\n\n\u7ed9\u5b9a $n$ \u4ee5\u53ca\u4e24\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6b63\u6574\u6570\u5e8f\u5217 $A_i,B_i$\uff0c\u4f60\u53ef\u4ee5\u6267\u884c\u4e0b\u8ff0\u64cd\u4f5c\u4efb\u610f\u6b21\uff1a\n\n- \u9009\u5b9a\u4efb\u610f\u6574\u6570 $l,r$\uff0c\u6ee1\u8db3 $1 \\le l \\le r \\le n$\u3002\n- \u82b1\u8d39 $max_{i=l}^{r} \\{B_i\\}$ \u7684\u4ee3\u4ef7\uff0c\u5c06 $A_l,A_{l+1}, \\dots A_r$ \u4e2d\u6bcf\u4e2a\u90fd\u51cf\u53bb $1$\u3002\n\n\u8bf7\u6c42\u51fa\u4f7f\u5f97 $A_i$ \u4e2d\u5143\u7d20\u5168\u90e8 $\\le 0$ \u6240\u9700\u7684\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n$1 \\le n \\le 10^5, 1 \\le A_i,B_i \\le 10^9$\u3002\n\n--------------------\n\n\u770b\u5230\u8fd9\u9898\u7b2c\u4e00\u53cd\u5e94\u662f\uff1a\u8fd9\u4e0d [[APIO2016] \u70df\u706b\u8868\u6f14](https://www.luogu.com.cn/problem/P3642) \u5417\uff1f\u5b9e\u9645\u4e24\u9898\u5728\u601d\u8def\u548c\u505a\u6cd5\u4e0a\u786e\u5b9e\u975e\u5e38\u76f8\u4f3c\u3002\n\n\u9996\u5148\u6ce8\u610f\u5230\u4ee3\u4ef7\u662f\u4e00\u4e2a\u533a\u95f4\u6781\u503c\u7684\u5f62\u5f0f\uff0c\u800c\u4e14\u5728\u4ee3\u4ef7\u4e0d\u53d8\u7684\u65f6\u5019\uff0c\u4fee\u6539\u533a\u95f4\u80af\u5b9a\u662f\u8d8a\u5927\u8d8a\u597d\u3002\u4e0d\u96be\u60f3\u5230\u6839\u636e $B$ \u5efa\u7acb\u7b1b\u5361\u5c14\u6811\uff0c\u4e00\u6b21\u64cd\u4f5c\u5c31\u662f\u9009\u62e9\u4e00\u4e2a\u8282\u70b9 $i$\uff0c\u82b1\u8d39 $B_i$ \u7684\u4ee3\u4ef7\u4f7f\u5f97 $x$ \u5b50\u6811\u5185\u6240\u6709\u70b9\u5bf9\u5e94\u7684 $A$ \u51cf $1$\u3002\n\n\u5176\u6b21\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5173\u5fc3\u5b50\u6811\u5185\u5f53\u524d $A$ \u7684\u6700\u5927\u503c\uff0c\u53ef\u4ee5\u8bbe\u8ba1 dp \u72b6\u6001 $f_{i,j}$ \u8868\u793a\u5f53\u524d\u5b50\u6811 $i$ \u5185 $A$ \u7684\u6700\u5927\u503c $\\le j$ \u65f6\u6240\u9700\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u8bbe\u70b9 $i$ \u7684\u5de6\u53f3\u513f\u5b50\u5206\u522b\u4e3a $x,y$\uff0c\u4e0d\u96be\u5f97\u5230\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$\n\\begin{aligned}\nf_{i,j} &= \\min_{k = \\max(j,A_i)}^{+\\infty} \\{f_{x,k}+f_{y,k}+(k-j)B_i \\}\\\\\n&= -B_ij + \\min_{k = \\max(j,A_i)}^{+\\infty} \\{f_{x,k}+f_{y,k}+B_ik \\}\n\\end{aligned}\n$$\n\n\u8fd9\u6837\u505a\u662f $O(nV)$ \u7684\uff0c\u663e\u7136\u8981\u4ece\u503c\u57df\u5165\u624b\u4f18\u5316\u3002\u5c06 $f_{i,j}$ \u770b\u4f5c\u5173\u4e8e $j$ \u7684\u51fd\u6570\uff0c\u5bf9\u4e8e\u8fd9\u79cd\u6ca1\u6709\u660e\u663e\u7279\u5f81\u7684\u8f6c\u79fb\u65b9\u7a0b\uff0c\u53ef\u4ee5\u624b\u73a9\u4e00\u4e0b\u5c0f\u4e00\u70b9\u7684\u6570\u636e\uff0c\u89c2\u5bdf $f_{i,j}$ \u7684\u56fe\u50cf\uff0c\u53ef\u4ee5\u770b\u51fa $f_{i,j}$ \u662f**\u4e00\u6b21\u5206\u6bb5\u4e0b\u51f8\u51fd\u6570**\uff08\u5176\u5b9e\u9898\u505a\u591a\u4e86\u4ee5\u540e\uff0c\u770b\u5230\u8fd9\u4e2a\u5f0f\u5b50\u7684\u7b2c\u4e00\u53cd\u5e94\u5c31\u662f\u51f8\u6027\u4f18\u5316\uff09\u3002   \n\n\u8bc1\u660e\u53ef\u4ee5\u8003\u8651\u5f52\u7eb3\u6cd5\uff0c\u9996\u5148\u7a7a\u8282\u70b9\u7684 $f$ \u56fe\u50cf\u5c31\u662f\u4e0e\u6a2a\u8f74\u91cd\u5408\u7684\u76f4\u7ebf\uff0c\u6ee1\u8db3\u5f52\u7eb3\u5047\u8bbe\uff0c\u63a5\u4e0b\u6765\u5148\u8003\u8651 $f_{x,k}+f_{y,k}+B_ik$\uff0c\u663e\u7136\u8fd9\u662f\u4e09\u4e2a\u4e00\u6b21\u5206\u6bb5\u51f8\u51fd\u6570\u76f8\u52a0\uff08$B_ik$ \u5c31\u662f\u4e00\u6761\u659c\u7387\u4e3a $B_i$ \u7684\u76f4\u7ebf\uff09\uff0c\u7ed3\u679c\u4ecd\u7136\u662f\u4e00\u6b21\u5206\u6bb5\u51f8\u51fd\u6570\uff0c\u56fe\u50cf\u5927\u81f4\u957f\u8fd9\u6837\uff1a\n\n![](https://pic1.imgdb.cn/item/6363822316f2c2beb19835bf.png)\n\n\u89c2\u5bdf $\\min_{k= \\max(j,A_i)}^{+\\infty}$ \u5bf9\u8fd9\u4e2a\u51fd\u6570\u56fe\u50cf\u7684\u53d8\u6362\u6548\u679c\uff0c\u9996\u5148\u627e\u5230\u76f4\u7ebf $x=A_i$ \u53f3\u4fa7\u7684\u6700\u4f4e\u70b9\uff08\u56fe\u4e2d\u4e3a\u70b9C\uff09\uff0c\u5bf9\u4e8e\u6700\u4f4e\u70b9\u5de6\u4fa7\u7684\u90e8\u5206\uff0c\u5176\u51fd\u6570\u503c\u7b49\u4e8e\u6700\u4f4e\u70b9\u5bf9\u5e94\u7684\u51fd\u6570\u503c\uff0c\u53f3\u4fa7\u4fdd\u6301\u4e0d\u53d8\uff0c\u4e5f\u5c31\u662f\u957f\u8fd9\u6837\uff08\u7ea2\u8272\u90e8\u5206\uff09\uff1a\n\n![](https://pic1.imgdb.cn/item/636384c516f2c2beb1a4b3fb.png)\n\n\u5f53\u7136\u4e5f\u53ef\u80fd\u957f\u8fd9\u6837\uff1a\n\n![](https://pic1.imgdb.cn/item/6363875e16f2c2beb1ae6c67.png)\n\n\u53ef\u4ee5\u770b\u4f5c\u662f\u5c06\u659c\u7387\u5c0f\u4e8e $0$ \u4ee5\u53ca $\\le A_i$ \u7684\u90e8\u5206\u5168\u90e8\u5220\u6389\uff0c\u5e76\u5728\u4e00\u5f00\u59cb\u52a0\u5165\u4e00\u6bb5\u659c\u7387\u4e3a $0$ \u7684\u7ebf\u6bb5\uff0c\u53d8\u6362\u540e\u518d\u52a0\u4e0a $-B_ij$\uff08\u4e00\u6761\u76f4\u7ebf\uff09\uff0c\u5f88\u660e\u663e**\u4f9d\u7136\u662f\u4e00\u4e2a\u4e00\u6b21\u5206\u6bb5\u4e0b\u51f8\u51fd\u6570**\u3002\n\n\u5f88\u660e\u663e\u4e00\u6b21\u8f6c\u79fb\u6700\u591a\u65b0\u52a0\u5165 $O(1)$ \u6761\u7ebf\u6bb5\uff0c\u6240\u4ee5\u603b\u6bb5\u6570\u662f $O(n)$ \u7684\uff0c\u8003\u8651\u7528\u6570\u636e\u7ed3\u6784\u52a0\u901f\u7ef4\u62a4\u8fc7\u7a0b\uff0c\u5b98\u65b9\u9898\u89e3\u4f7f\u7528\u7684\u662f set+\u542f\u53d1\u5f0f\u5408\u5e76\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log^2n)$\u3002\u4e0d\u8fc7\u8fd9\u4e2a\u4e1c\u897f\u7528\u53ef\u5e76\u5806\u4e5f\u975e\u5e38\u5bb9\u6613\u7ef4\u62a4\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u53ef\u4ee5\u7ef4\u62a4\u56fe\u50cf\u4e0a\u62d0\u70b9\u7684\u6a2a\u5750\u6807\u4ee5\u53ca\u62d0\u70b9\u53f3\u4fa7\u7ebf\u6bb5\u4e0e\u5de6\u4fa7\u7ebf\u6bb5**\u659c\u7387\u4e4b\u5dee**\uff0c\u6309\u7167\u6a2a\u5750\u6807\u5927\u5c0f\u7ef4\u62a4\u5c0f\u6839\u5806\uff0c\u4e24\u4e2a\u51fd\u6570\u76f8\u52a0\u5c31\u76f4\u63a5\u628a\u4e24\u4e2a\u5806\u5408\u5e76\u8d77\u6765\uff0c\u8fdb\u884c $\\min_{k= \\max(j,A_i)}^{+\\infty}$ \u8fd9\u4e2a\u53d8\u6362\u7684\u65f6\u5019\u5c31\u76f4\u63a5\u66b4\u529b\u5220\u70b9\uff0c\u603b\u5171\u53ea\u4f1a\u5220 $O(n)$ \u6b21\uff0c\u603b\u590d\u6742\u5ea6 $O(n \\log n)$\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include <bits/stdc++.h>\n#define lowbit(x) (x & -x)\n#define pb push_back\n#define mp make_pair\nusing namespace std;\n\ntypedef long long ll;\nconst int MAXN = 1e5+5;\nconst int Mod = 998244353;\n\nint n, A[MAXN], B[MAXN];\nint l[MAXN], r[MAXN], stk[MAXN], top;\nint rt[MAXN], tot;\nll cur[MAXN];\n\nstruct node {\n    int ls, rs, dis;\n    ll x, k;\n} H[MAXN * 4];\n\nint merge(int a, int b) {\n    if (!a || !b) return a | b;\n    if (H[a].x > H[b].x) swap(a, b);\n    H[a].rs = merge(H[a].rs, b);\n    if (H[H[a].rs].dis > H[H[a].ls].dis) swap(H[a].ls, H[a].rs);\n    H[a].dis = H[H[a].rs].dis + 1;\n    return a;\n}\n\ninline void push(int num, ll x, ll k) {\n    H[++tot].x = x;\n    H[tot].k = k;\n    rt[num] = merge(tot, rt[num]);\n}\n\ninline void pop(int num) {\n    rt[num] = merge(H[rt[num]].ls, H[rt[num]].rs);\n}\n\nvoid dfs(int x) {\n    if (!x) return;\n    dfs(l[x]), dfs(r[x]);\n    cur[x] = cur[l[x]] + cur[r[x]];\n    rt[x] = merge(rt[l[x]], rt[r[x]]);\n    push(x, 0, B[x]);\n    ll curx = 0, curk = 0;//\u5f53\u524d\u659c\u7387\n    while (1) {\n        curx = H[rt[x]].x;\n        curk += H[rt[x]].k;\n        if (curk >= 0 && curx >= A[x]) {\n            H[rt[x]].k = curk;\n            push(x, 0, 0);\n            break;\n        }\n        pop(x);\n        if (curk >= 0 && (!rt[x] || H[rt[x]].x >= A[x])) {\n            cur[x] += curk * (A[x] - curx);\n            push(x, A[x], curk);\n            push(x, 0, 0);\n            break;\n        }\n        cur[x] += curk * (H[rt[x]].x - curx);\n    }\n    push(x, 0, -B[x]);\n}\n\nint main() {\n    scanf(\"%d\", &n);\n    for (int i = 1; i <= n; i++) scanf(\"%d\", &A[i]);\n    for (int i = 1; i <= n; i++) scanf(\"%d\", &B[i]);\n\n    for (int i = 1; i <= n; i++) {\n        int lst = 0;\n        while (top && B[stk[top]] <= B[i]) {\n            r[stk[top]] = lst;\n            lst = stk[top--];\n        }\n        l[i] = lst;\n        stk[++top] = i;\n    }\n    for (int i = 2; i <= top; i++) r[stk[i - 1]] = stk[i];\n\n    dfs(stk[1]);\n\n    printf(\"%lld\", cur[stk[1]]);\n    return 0;\n}\n```",
        "postTime": 1667468454,
        "uid": 261935,
        "name": "Unique_Hanpi",
        "ccfLevel": 0,
        "title": "ABC275Ex Monster \u9898\u89e3"
    },
    {
        "content": "\u6ce8\u610f\u5230\u82e5\u5bf9\u533a\u95f4 $(l,r)$ \u64cd\u4f5c\u4e14 $\\min(B_{l-1},B_{r+1}) \\leq \\max\\{B_l,B_{l+1},\\cdots,B_r\\}$\uff0c\u90a3\u4e48\u5c06\u533a\u95f4\u6269\u5927\u4e00\u5b9a\u4e0d\u52a3\u3002\n\n\u6545\u5bf9 $\\{B_i\\}$ \u5e8f\u5217\u5efa\u51fa\u5927\u6839\u5806\u7b1b\u5361\u5c14\u6811\uff0c\u90a3\u4e48\u5b58\u5728\u6700\u4f18\u89e3\u4f7f\u5f97\u6bcf\u4e00\u6b21\u64cd\u4f5c\u90fd\u5bf9\u7b1b\u5361\u5c14\u6811\u4e0a\u7684\u4e00\u4e2a\u533a\u95f4\u64cd\u4f5c\uff0c\n\n\u9650\u5236\u5373\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u7b1b\u5361\u5c14\u6811\u4e0a\u7684\u533a\u95f4 $(l,r,x)$\uff08$x$ \u4e3a\u533a\u95f4\u5185\u6700\u5927\u503c\u4e0b\u6807\uff09\uff0c\u5b83\u7684\u7956\u5148\u7684\u64cd\u4f5c\u6b21\u6570\u4e0d\u5c11\u4e8e $A_x$\u3002\n\n\u76f4\u63a5\u8d2a\u5fc3\u4ece\u4e0a\u5f80\u4e0b\u5c3d\u53ef\u80fd\u5c11\u7684\u64cd\u4f5c\u663e\u7136\u662f\u9519\u7684\uff0c\u56e0\u4e3a\u7956\u5148\u8282\u70b9\u989d\u5916\u7684\u64cd\u4f5c\u6709\u53ef\u80fd\u80fd\u51cf\u5c11\u66f4\u591a\u5b50\u5b59\u8282\u70b9\u7684\u64cd\u4f5c\u3002\n\n\u8003\u8651 DP\uff0c\u8bbe $f_{u,x}$ \u8868\u793a\u5bf9\u4e8e\u8282\u70b9 $u$ \u7684\u7956\u5148\u5df2\u7ecf\u64cd\u4f5c\u4e86 $x$ \u6b21\uff0c\u5176\u5b50\u6811\u4e2d\u6700\u5c11\u7684\u64cd\u4f5c\u6b21\u6570\u3002\u8f6c\u79fb\u5373\uff1a\n\n$$\nf_{u,x}=\n\\begin{cases}\n\\max\\{0,A_u(B_u-x)\\} & \\text{u is leaf}\\\\\n\\min\\limits_{t \\geq A_u} \\{B_u(t-x)+\\sum\\limits_v f_{v,t}\\} & \\text{otherwise}\n\\end{cases}\n$$\n\n\u8bbe $F_u(x)=f_{u,x}$\uff0c\u90a3\u4e48\u6bcf\u4e2a $F_u(x)$ \u5747\u4e3a\u5206\u6bb5\u4e00\u6b21\u51fd\u6570\u3002\u8003\u8651\u7ef4\u62a4\u8be5\u5206\u6bb5\u51fd\u6570\u7684\u65ad\u70b9\u53ca\u659c\u7387\u53d8\u5316\u91cf\u4ee5\u53ca $F_u(0)$\uff0c\u8f6c\u79fb\u5206\u4e09\u6b65\uff1a\n\n+ $F_u(x)=B_u x+\\sum\\limits_v F_v(x)$\u3002\n+ $F_u(x) \\leftarrow \\min\\limits_{t \\geq A_u} \\{F_u(t)\\}$\u3002\n+ $F_u(x) \\leftarrow F_u(x)-B_u x$\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u53f6\u5b50\u5904\u7684\u51fd\u6570\u662f\u4e0b\u51f8\u7684\uff08\u659c\u7387\u5355\u8c03\u4e0d\u964d\uff09\uff0c\u800c\u6bcf\u6b65\u8f6c\u79fb\u90fd\u4e0d\u6539\u53d8\u51fd\u6570\u7684\u51f8\u6027\u3002\u6545\u7b2c\u4e8c\u6b65\u8f6c\u79fb\u76f8\u5f53\u4e8e\u5c06 $A_u$ \u524d\u7684\u90e8\u5206\u4ee5\u53ca\u659c\u7387\u5c0f\u4e8e $0$ \u7684\u90e8\u5206\u62ac\u9ad8\u524a\u5e73\uff0c\u5373\u5220\u53bb\u65ad\u70b9\u7684\u4e00\u6bb5\u524d\u7f00\u3002\n\n\u7528\u5de6\u504f\u6811\u7ef4\u62a4\u4e0a\u8ff0\u4fe1\u606f\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log n)$\u3002\n\n#### Code\n\n```cpp\n#define ls(o) tr[o].ls\n#define rs(o) tr[o].rs\nconst int N=1e5+5,INF=1e9;\n\nstruct lefttree{\n\tint ls,rs,dis,val;\n\tlong long w;\n}tr[N*10];\nint rt[N],cnt;\n\nint merge(int x,int y){\n\tif(!x) return y;\n\tif(!y) return x;\n\tif(tr[x].val>tr[y].val || (tr[x].val==tr[y].val && tr[x].w>tr[y].w)) swap(x,y);\n\trs(x)=merge(rs(x),y);\n\tif(tr[ls(x)].dis<tr[rs(x)].dis) swap(ls(x),rs(x));\n\ttr[x].dis=tr[rs(x)].dis+1;\n\treturn x;\n}\nint push(int x,int k,long long w){\n\tcnt++;\n\ttr[cnt].val=k,tr[cnt].w=w;\n\treturn merge(x,cnt);\n}\nint pop(int x){\n\ttr[x].val=INF;\n\treturn merge(ls(x),rs(x));\n}\n\nint n,A[N],B[N];\n\nint L[N],R[N];\nint sta[N],cur;\n\nvoid ins(int x){\n\tint sav=cur;\n\twhile(cur && B[x]>B[sta[cur]]) cur--;\n\tif(cur) R[sta[cur]]=x;\n\tif(cur<sav) L[x]=sta[cur+1];\n\tsta[++cur]=x;\n}\n\nlong long f[N];\nvoid dfs(int u){\n\tint ls=L[u],rs=R[u];\n\t\n\tif(!ls && !rs){\n\t\trt[u]=push(rt[u],0,-B[u]);\n\t\trt[u]=push(rt[u],A[u],B[u]);\n\t\tf[u]=1ll*A[u]*B[u];\n\t\treturn ;\n\t}\n\tif(ls){\n\t\tdfs(ls);\n\t\trt[u]=merge(rt[u],rt[ls]);\n\t\tf[u]+=f[ls];\n\t}\n\tif(rs){\n\t\tdfs(rs);\n\t\trt[u]=merge(rt[u],rt[rs]);\n\t\tf[u]+=f[rs];\n\t}\n\trt[u]=push(rt[u],0,B[u]);\n\trt[u]=push(rt[u],A[u],0);\n\tlong long s=0;\n\twhile(tr[rt[u]].val<A[u] || s+tr[rt[u]].w<0){\n\t\ts+=tr[rt[u]].w;\n\t\tint pos=tr[rt[u]].val;\n\t\trt[u]=pop(rt[u]);\n\t\tf[u]+=s*(tr[rt[u]].val-pos);\n\t}\n\trt[u]=push(rt[u],tr[rt[u]].val,s);\n\trt[u]=push(rt[u],0,-B[u]);\n}\n\nint main(){\n\tcin>>n;\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&A[i]);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&B[i]);\n\tfor(int i=1;i<=n;i++) ins(i);\n\t\n\tfor(int i=1;i<=n;i++) rt[i]=++cnt,tr[rt[i]].val=INF;\n\t\n\tdfs(sta[1]);\n\tcout<<f[sta[1]];\n}\n```",
        "postTime": 1668955870,
        "uid": 225645,
        "name": "\u82f9\u679c\u84dd17",
        "ccfLevel": 8,
        "title": "AT_abc275_h [ABC275Ex] Monster  \u9898\u89e3"
    }
]