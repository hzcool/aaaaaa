[
    {
        "content": "\u56e0\u4e3a\u6bcf\u4e00\u8f6e\u64cd\u4f5c\u90fd\u4f1a\u628a\u77f3\u5b50\u6df1\u5ea6\u51cf $1$\uff0c\u6240\u4ee5\u4e0d\u540c\u6df1\u5ea6\u4e4b\u95f4\u7684\u77f3\u5b50\u4e4b\u95f4\u662f\u72ec\u7acb\u7684\u3002\u6211\u4eec\u8003\u8651\u5bf9\u4e8e\u540c\u4e00\u4e2a\u6df1\u5ea6\u7684\u77f3\u5b50\uff0c\u6211\u4eec\u5efa\u51fa\u5176\u865a\u6811\uff0c\u56e0\u4e3a\u53ea\u6709\u5728\u865a\u6811\u8282\u70b9\u4e0a\u77f3\u5b50\u624d\u53ef\u80fd\u53d1\u751f\u5408\u5e76\u3002\u8003\u8651\u8fdb\u884c dp\uff0c\u8bbe $f_{u,0/1}$ \u4e3a\u5728\u865a\u6811\u4e0a $u$ \u8282\u70b9\uff0c\u5728\u8fd9\u91cc\u7ecf\u8fc7\u79fb\u9664\u64cd\u4f5c\u540e\u5269\u4f59 $0/1$ \u4e2a\u77f3\u5b50\u7684\u65b9\u6848\u6570\uff08\u53ea\u8003\u8651\u672c\u6df1\u5ea6\u8282\u70b9\u653e\u4e0e\u4e0d\u653e\uff09\u3002\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u5373\u4e3a $f_{rt,1}\\times2^{n-c}$\uff0c\u5176\u4e2d $rt$ \u4e3a\u865a\u6811\u7684\u6839\uff0c$c$ \u4e3a\u672c\u6df1\u5ea6\u8282\u70b9\u4e2a\u6570\u3002\u6211\u4eec\u8003\u8651\u8f6c\u79fb\u3002  \n\u5bf9\u4e8e $u$\uff0c\u6211\u4eec\u8bb0\u5f55\u4e00\u4e2a\u4e34\u65f6\u53d8\u91cf $f2$\uff0c\u4ee3\u8868\u8fd9\u91cc\u6700\u540e\u6709 $\\ge 2$ \u4e2a\u77f3\u5b50\u7684\u65b9\u6848\u6570\u3002\u8f6c\u79fb\u5f0f\u4e3a $f_{u,0}=f_{u,0}\\times f_{v,0},f_{u,1}=f_{u,0}\\times f_{v,1}+f_{u,0}\\times f_{v,1},f2=f2\\times(f_{v,0}+f_{v,1})+f_{u,1}\\times f_{v,1}$\u3002\uff08\u7c7b\u4f3c\u6811\u4e0a\u80cc\u5305\u7406\u89e3\u5373\u53ef\uff09\u6700\u540e\u5c06 $f_{u,0}=f_{u,0}+f2$\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002  \n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\ntypedef vector<int>::iterator iter;\nconst int maxn=2e5+5,mod=1e9+7;\nstruct edge {\n\tint next,to;\n} e[maxn*2];\nint h[maxn],cnt,d[maxn],f[maxn][18],lg2[maxn],n,m,p[maxn],pos,st[maxn],top,mxd;\nbool bj[maxn];\nll ans,f0[maxn],f1[maxn];\nvector<int> b[maxn],v[maxn];\nvoid addedge(int x,int y) {\n\te[++cnt].next=h[x],e[cnt].to=y,h[x]=cnt;\n}\nll qpow(ll x,int y) {\n\tll w=1;\n\twhile(y) {\n\t\tif(y&1)w=w*x%mod;\n\t\tx=x*x%mod,y>>=1;\n\t}\n\treturn w;\n}\nvoid dfs(int u,int fa) {\n\tmxd=max(mxd,d[u]=d[fa]+1),b[d[u]].push_back(u),f[u][0]=fa,p[u]=++pos;\n\tfor(int i=1; i<=lg2[d[u]]; i++)f[u][i]=f[f[u][i-1]][i-1];\n\tfor(int i=h[u]; i; i=e[i].next)dfs(e[i].to,u);\n}\nint lca(int x,int y) {\n\tif(d[x]<d[y])swap(x,y);\n\twhile(d[x]>d[y])x=f[x][lg2[d[x]-d[y]]-1];\n\tif(x==y)return x;\n\tfor(register int i=lg2[d[x]]-1; i>=0; i--)\n\t\tif(f[x][i]!=f[y][i])x=f[x][i],y=f[y][i];\n\treturn f[x][0];\n}\nvoid dp(int u) {\n\tll f2=0;\n\tf0[u]=1,f1[u]=bj[u];\n\tfor(iter it=v[u].begin(); it!=v[u].end(); it++) {\n\t\tdp(*it),f2=(f2*(f0[*it]+f1[*it])+f1[u]*f1[*it])%mod;\n\t\tf1[u]=(f0[u]*f1[*it]+f1[u]*f0[*it])%mod,f0[u]=f0[u]*f0[*it]%mod;\n\t}\n\tf0[u]=(f0[u]+f2)%mod,v[u].clear();\n}\nbool cmp(int x,int y) {\n\treturn p[x]<p[y];\n}\nint main() {\n\tint x;\n\tscanf(\"%d\",&n),n++;\n\tfor(int i=2; i<=n; i++)scanf(\"%d\",&x),addedge(x+1,i);\n\tdfs(1,0);\n\tfor(int i=1; i<=mxd; i++) {\n\t\tsort(b[i].begin(),b[i].end(),cmp);\n\t\titer it=b[i].begin();\n\t\tbj[*it]=1,st[top=1]=*(it++);\n\t\tfor(; it!=b[i].end(); it++) {\n\t\t\tint la=lca(st[top],*it);\n\t\t\twhile(top) {\n\t\t\t\tif(d[la]>=d[st[top-1]]) {\n\t\t\t\t\tif(la!=st[top])v[la].push_back(st[top]),la!=st[top-1]?st[top]=la:top--;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tv[st[top-1]].push_back(st[top]),top--;\n\t\t\t}\n\t\t\tst[++top]=*it,bj[*it]=1;\n\t\t}\n\t\twhile(--top)v[st[top]].push_back(st[top+1]);\n\t\tdp(st[1]),ans=(ans+f1[st[1]]*qpow(2,n-b[i].size()))%mod;\n\t\tit=b[i].begin();\n\t\tfor(; it!=b[i].end(); it++)bj[*it]=0;\n\t}\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1660911969,
        "uid": 104324,
        "name": "abruce",
        "ccfLevel": 7,
        "title": "\u9898\u89e3--AT3721 [ARC086C] Smuggling Marbles"
    },
    {
        "content": "# ARC086E - Smuggling Marbles\n[\u5b89\u5229\u535a\u5ba2](https://blog.csdn.net/xmr_pursue_dreams/article/details/111997371)\n## Solution\n\u611f\u89c9\u8fd9\u9898\u548c[LG P3233 [HNOI2014]\u4e16\u754c\u6811](https://blog.csdn.net/xmr_pursue_dreams/article/details/111971930)\u51e0\u4e4e\u4e00\u6a21\u4e00\u6837\u554a\uff1f\uff01\n\n\u5927\u6982\u5c31\u662f\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u6df1\u5ea6\u5206\u522b\u8ba1\u7b97\u8d21\u732e\uff0c\u5bf9\u8be5\u6df1\u5ea6\u7684\u70b9\u5efa\u51fa\u865a\u6811\uff0c\u7136\u540e\u6811\u5f62$dp$\u3002\n\n\u4ee4$f_x$\u8868\u793a$x$\u5b50\u6811\u4e2d$2^{sz_x}$\u79cd\u65b9\u6848\u4e2d\u6709\u591a\u5c11\u53ef\u4ee5\u8ba9$x$\u662f$1$\uff0c\u7531\u6b64\u53ef\u77e5\u6709$2^{sz_x}-f_x$\u79cd\u65b9\u6848$x$\u4e3a$0$\uff0c\u8f6c\u79fb\u65f6\u76f8\u5f53\u4e8e\u679a\u4e3e\u5176\u4e2d\u4e00\u4e2a\u5b50\u6811\u4e3a$1$\uff0c\u5269\u4e0b\u7684\u5b50\u6811\u4e3a$0$\uff0c\u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1$x$\u4e3a$1$\u3002\n\n\u8bbe$x$\u7684\u865a\u6811\u4e0a\u7684\u513f\u5b50\u5206\u522b\u4e3a$v_1,v_2...v_k$\uff0c$f_x=2^t\\sum_{i=1}^k(\\prod_{j=1}^{i-1}f'_{v_j} *f_{v_i}*\\prod_{j=k+1}^n f'_{v_j})$\n\n\u5176\u4e2d$f'_v$\u8868\u793a$2^{sz_v}-f_v$\uff0c$t$\u8868\u793a\u5728$x$\u539f\u6811\u7684\u5b50\u6811\u4e2d\u4f46\u4e0d\u5728\u865a\u6811\u4e0a\u7684\u70b9\u7684\u4e2a\u6570\u3002\n\n\u8fd9\u4e00\u90e8\u5206\u6c42\u4e00\u4e2a$f'_v$\u7684\u524d\u7f00\u540e\u7f00\u79ef\u5c31\u80fd\u8f7b\u677e\u7ebf\u6027\u65f6\u95f4\u5185\u89e3\u51b3\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$O(nlgn)$\u3002\n\n\u5b9e\u73b0\u65f6\u4f9d\u7136\u5efa\u8bae\u628a$1$\u653e\u5165\u865a\u6811\uff0c\u4e0d\u7136\u6700\u540e\u8fd8\u8981\u4e58\u4e00\u4e2a$2^{sz}$\u7684\u8d21\u732e\u3002\n## Code\n\n```cpp\n\nvector<int> e[MAXN],V[MAXN],E[MAXN];\nint f[MAXN],g[MAXN],_g[MAXN],L[MAXN],R[MAXN],pw[MAXN],sz[MAXN],dep[MAXN],Log[MAXN],dfn[MAXN],stk[MAXN],fa[MAXN][20],DFN=0,top,n,mxd=0;\nint upd(int x,int y) { return x+y>=mods?x+y-mods:x+y; }\nint quick_pow(int x,int y)\n{\n\tint ret=1;\n\tfor (;y;y>>=1)\n\t{\n\t\tif (y&1) ret=1ll*ret*x%mods;\n\t\tx=1ll*x*x%mods;\n\t}\n\treturn ret;\n}\nint getlca(int x,int y)\n{\n\tif (dep[x]<dep[y]) swap(x,y);\n\tfor (int i=Log[dep[x]];i>=0;i--) \n\t\tif (dep[fa[x][i]]>=dep[y]) x=fa[x][i];\n\tif (x==y) return x;\n\tfor (int i=Log[dep[x]];i>=0;i--)\n\t\tif (fa[x][i]!=fa[y][i]) x=fa[x][i],y=fa[y][i];\n\treturn fa[x][0];\n}\nint jump(int x,int d)\n{\n\tfor (int i=Log[dep[x]];i>=0;i--)\n\t\tif (dep[fa[x][i]]>=d) x=fa[x][i];\n\treturn x;\n}\nvoid dfs1(int x)\n{\n\tsz[x]=1,dfn[x]=++DFN,V[dep[x]].PB(x),upmax(mxd,dep[x]);\n\tfor (int i=1;i<=Log[dep[x]];i++) fa[x][i]=fa[fa[x][i-1]][i-1];\n\tfor (auto v:e[x]) dep[v]=dep[x]+1,fa[v][0]=x,dfs1(v),sz[x]+=sz[v];\n}\nvoid add(int u,int v) { E[u].PB(v); }\nvoid build(vector<int> V)\n{\n\tstk[top=1]=1;\n\tfor (auto v:V)\n\t{\n\t\tif (v==1) continue;\n\t\tint lca=getlca(stk[top],v);\n\t\twhile (top>1&&dep[stk[top-1]]>dep[lca]) add(stk[top-1],stk[top]),top--;\n\t\tif (dep[stk[top]]>dep[lca]) add(lca,stk[top--]);\n\t\tif (stk[top]!=lca) stk[++top]=lca;\n\t\tstk[++top]=v; \n\t}\n\twhile (top>1) add(stk[top-1],stk[top]),top--;\n}\nvoid solve(int x)\n{\n\tif (!E[x].size()) { f[x]=pw[sz[x]-1]; return; }\n\tfor (auto v:E[x]) solve(v);\n\tint num=E[x].size(),cnt=sz[x];\n\tfor (int i=0;i<num;i++)\n\t{\n\t\tint v=E[x][i],p=jump(v,dep[x]+1);\n\t\tcnt-=sz[v],g[i+1]=f[v],_g[i+1]=upd(pw[sz[v]],mods-g[i+1]);\n\t}\n\tL[0]=R[num+1]=1,f[x]=0;\n\tfor (int i=1;i<=num;i++) L[i]=1ll*L[i-1]*_g[i]%mods;\n\tfor (int i=num;i>=1;i--) R[i]=1ll*R[i+1]*_g[i]%mods;\n\tfor (int i=1;i<=num;i++) f[x]=upd(f[x],1ll*L[i-1]*R[i+1]%mods*g[i]%mods);\n\tf[x]=1ll*f[x]*pw[cnt]%mods;\n}\nvoid clear(int x)\n{\n\tfor (auto v:E[x]) clear(v);\n\tf[x]=0,E[x].clear();\n}\nsigned main()\n{\n\tn=read()+1,Log[1]=0,pw[0]=1;\n\tfor (int i=2;i<=n;i++) e[read()+1].PB(i),Log[i]=Log[i>>1]+1;\n\tfor (int i=1;i<=n;i++) pw[i]=upd(pw[i-1],pw[i-1]);\n\tdep[0]=-1,dfs1(1);\n\tint ans=0;\n\tfor (int i=0;i<=mxd;i++) build(V[i]),solve(1),ans=upd(ans,f[1]),clear(1);\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1609330779,
        "uid": 32063,
        "name": "fade_away",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 AT3721 \u3010[ARC086C] Smuggling Marbles\u3011"
    },
    {
        "content": "\n# \u9898\u610f\n\u6709\u68f5N\u4e2a\u70b9\u7684\u6709\u6839\u6811 , \u521d\u59cb\u65f6\u5176\u4e2d\u4e00\u4e9b\u70b9\u4e0a\u6709\u4e00\u4e2a\u77f3\u5b50,\u6bcf\u6b21\u540c\u65f6\u5c06\u6240\u6709\u77f3\u5b50\u4ece\u6240\u5728\u7684\u70b9\u79fb\u52a8\u5230\u7236\u4eb2\u4e0a,\u6839\u8282\u70b9\u4e0a\u7684\u77f3\u5b50\u79fb\u52a8\u5230\u7bee\u5b50\u91cc.\u5982\u679c\u6709\u4e00\u4e2a\u70b9\u4e0a\u7684\u77f3\u5b50\u6570\u5927\u4e8e1\u5219\u79fb\u9664\u6240\u6709\u77f3\u5b50,\u6811\u4e0a\u6ca1\u6709\u77f3\u5b50\u65f6\u7ed3\u675f .\u6c42\u6240\u67092N\u79cd\u521d\u59cb\u5c40\u9762\u7ecf\u8fc7\u64cd\u4f5c\u540e\u7bee\u5b50\u91cc\u77f3\u5b50\u7684\u603b\u6570\u91cf\u3002\n\n## \u56fe\u8bba\u597d\u9898\n\n# \u5206\u6790\n\n\u6211\u4eec\u53d1\u73b0:\u6bcf\u4e00\u5c42\u7684\u70b9\u90fd\u662f\u72ec\u7acb\u7684\n\n### ---->\u8003\u8651**\u5206\u5f00\u5904\u7406**\n\n# \u5b9e\u73b0\n\u5206\u522b\u5c06\u6bcf\u4e00\u5c42\u7684\u70b9\u5efa\u6210\u865a\u6811\u540e**\u6811\u5f62DP**\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6$O(n*log(n))$\u3002 \n\n\u53ef\u4ee5\u7528**\u957f\u94fe\u5256\u5206**\u505a\u5230O(n)\u3002\n\n# code\n```\n#include<bits/stdc++.h>\n#define fi first\n#define se second\nusing namespace std;\ntypedef long long LL;\ntypedef pair<int, int> P;\n\nconst int mod = 1e9 + 7;\nconst int maxn = 2e5 + 5;\n\nint add(int x, int y) {\n    x += y;\n    if(x >= mod) x -= mod;\n    return x;\n}\n\nint mul(int x, int y) {\n    LL z = 1LL * x * y;\n    return z - z / mod * mod;\n}\n\nint p[maxn];\nvector<int> g[maxn], g2[maxn];\nvector<int> fu[maxn];\nint depth = 0, bn = 0, b[maxn << 1];\nint f[maxn << 1], dfn[maxn], dis[maxn], fs[maxn];\nLL ans[maxn];\n\nvoid dfs(int u, int fa) {\n    int tmp = ++depth;\n    b[++bn] = tmp;\n    f[tmp] = u;\n    dfn[u] = bn;\n    for (auto v : g[u]) {\n        if (v == fa) continue;\n        dis[v] = dis[u] + 1;\n        dfs(v, u);\n        b[++bn] = tmp;\n    }\n}\n\nint st[maxn << 1][20];\nint lg[maxn << 1];\nvoid st_init() {\n    for (int i = 2; i < maxn * 2; ++i) lg[i] = lg[i >> 1] + 1;\n    for (int i = bn; i >= 1; --i) {\n        st[i][0] = b[i];\n        for (int j = 1; i + (1 << j) - 1 <= bn; ++j)\n            st[i][j] = min(st[i][j - 1], st[i + (1 << (j - 1))][j - 1]);\n    }\n}\nint rmq(int l, int r) {\n    int k = lg[r - l + 1];\n    return min(st[l][k], st[r - (1 << k) + 1][k]);\n}\n\nint lca(int a, int b) {\n    if(a == b) return a;\n    if (dfn[a] > dfn[b]) swap(a, b);\n    int k = rmq(dfn[a], dfn[b]);\n    return f[k];\n}\n\nbool cmp(const int &i, const int &j) {\n    return dfn[i] < dfn[j];\n}\n\nvoid build_tree(vector<int> &vec) {\n    int sz = 0, k = vec.size();\n    sort(vec.begin(), vec.end(), cmp);\n    fs[sz] = 0;\n    g2[0].clear();\n    for (int i = 0; i < k; ++i) {\n        int u = vec[i], ll = lca(u, fs[sz]);\n        g2[u].clear();\n        if (ll == fs[sz]) fs[++sz] = u;\n        else {\n            while (sz >= 1 && dis[fs[sz - 1]] >= dis[ll]) {\n                g2[fs[sz - 1]].push_back(fs[sz]);\n                sz--;\n            }\n            if (fs[sz] != ll) {\n                g2[ll].clear();\n                g2[ll].push_back(fs[sz--]);\n                fs[++sz] = ll;\n            }\n            fs[++sz] = u;\n        }\n    }\n    for (int i = 0; i < sz; ++i) g2[fs[i]].push_back(fs[i + 1]);\n}\n\nint dp[maxn][2];\n\nvoid dfs2(int u) {\n    int a,b,c;\n    a = 1;\n    b = c = 0;\n    for(auto v:g2[u]) {\n        dfs2(v);\n        c = add(mul(c,add(dp[v][1],dp[v][0])),mul(b,dp[v][1]));\n        b = add(mul(b,dp[v][0]),mul(a,dp[v][1]));\n        a = mul(a,dp[v][0]);\n    }\n    if(g2[u].size() == 0) dp[u][0] = dp[u][1] = 1;\n    else {\n        dp[u][0] = add(a,c);\n        dp[u][1] = b;\n    }\n}\n\nint main() {\n    int n, i, x, ans = 0;\n    scanf(\"%d\", &n);\n    for(i = p[0] = 1; i < maxn; i++) p[i] = mul(p[i - 1], 2);\n    for(i = 1; i <= n; i++) {\n        scanf(\"%d\", &x);\n        g[x + 1].push_back(i + 1);\n    }\n    dis[1] = 1;\n    dfs(1,0);\n    st_init();\n    for(i = 1;i <= n + 1; i++) fu[dis[i]].push_back(i);\n    for(i = 1;i <= n + 1; i++) {\n        if(fu[i].size()) {\n            //cout<<i<<\" = \"<<fu[i].size()<<endl;\n            build_tree(fu[i]);\n            dfs2(0);\n        //cout<<dp[0][1]<<endl;\n            ans = add(ans,mul(dp[0][1],p[n + 1 - fu[i].size()]));\n        }\n    }\n    printf(\"%d\\n\", ans);\n    return 0;;\n}\n\n```\n\u5176\u5b9e\u5927\u65b9\u5411\u662f\u5f88\u5bb9\u6613\u627e\u5230\u7684\uff0c\u4ee3\u7801\u5b9e\u73b0\u53ef\u80fd\u6709\u4e9b\u95ee\u9898\u3002\n\n\u8c03\u4e86\u8001\u4e45\u4e86\u3002",
        "postTime": 1548920270,
        "uid": 100151,
        "name": "yazzkl",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 AT3721 \u3010Smuggling Marbles\u3011"
    },
    {
        "content": "# Description\n\n\u7ed9\u5b9a\u4e00\u68f5 $n+1$ \u4e2a\u70b9\u7684\u6811\uff0c\u5176\u4e2d $0$ \u4e3a\u6839\uff0c\u6bcf\u4e2a\u70b9\u4e0a\u6709 $0$ \u6216 $1$ \u4e2a\u77f3\u5b50\uff0c\u8fdb\u884c\u82e5\u5e72\u6b21\u5982\u4e0b\u64cd\u4f5c\u76f4\u81f3\u6574\u68f5\u6811\u6ca1\u6709\u77f3\u5b50\uff1a\n\n- \u628a $0$ \u4e0a\u9762\u7684\u77f3\u5b50\u4ece\u6811\u4e0a\u62ff\u8d70\u653e\u5165\u53e3\u888b\n\n- \u628a\u6bcf\u4e2a\u70b9\u4e0a\u7684\u77f3\u5b50\u79fb\u5230\u5176\u7236\u4eb2\u4e0a\n\n- \u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u82e5\u5176\u77f3\u5b50\u6570 $\\ge 2$\uff0c\u5219\u79fb\u9664\u8be5\u70b9\u6240\u6709\u77f3\u5b50\uff08\u4e0d\u653e\u5165\u53e3\u888b\uff09\n\n\u5bf9\u4e8e\u6240\u6709 $2^{n+1}$ \u79cd\u653e\u7f6e\u77f3\u5b50\u7684\u65b9\u6848\uff0c\u6c42\u6700\u7ec8\u53e3\u888b\u4e2d\u77f3\u5b50\u6570\u7684\u548c\u4e3a\u591a\u5c11\u3002\n\n$n \\le 2 \\times 10^5$\uff0c\u65f6\u9650 3s\u3002\n\n# Solution\n\n\u9898\u89e3\u533a\u505a\u6cd5\u600e\u4e48\u90fd\u662f $\\mathcal O(n \\log n)$ \u7684\uff0c\u8fd9\u91cc\u63d0\u4f9b\u4e00\u4e2a\u4e25\u683c\u7ebf\u6027\u7684\u505a\u6cd5\u3002\n\n------------\n\n\u5bb9\u6613\u53d1\u73b0\u82e5\u5df2\u7ecf\u786e\u5b9a\u77f3\u5b50\u653e\u7f6e\u65b9\u5f0f\uff0c\u5219\u53ea\u6709\u540c\u6df1\u5ea6\u7684\u77f3\u5b50\u4f1a\u649e\u5230\u540c\u4e00\u4e2a\u70b9\u4e0a\u3002\u56e0\u6b64\u540c\u6df1\u5ea6\u7684\u77f3\u5b50\u6700\u591a\u53ea\u80fd\u6536\u5230\u4e00\u4e2a\u3002\n\n\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u8bb0 $f_{u,d}$ \u8868\u793a\u5728 $u$ \u5b50\u6811\u4e2d\u6df1\u5ea6\u4e3a $d$ \u7684\u70b9\u79fb\u5230\u70b9 $u$ \u540e\uff0c\u4f7f $u$ \u70b9\u77f3\u5b50\u6570\u4e3a $1$ \u7684\u6982\u7387\u3002\uff08\u5982\u679c\u8fd9\u91cc\u8bb0\u65b9\u6848\u6570\u800c\u4e0d\u662f\u6982\u7387\u7684\u8bdd\uff0c\u4e0b\u9762\u7684\u5f0f\u5b50\u4e2d\u7684 $1$ \u8981\u53d8\u6210\u5b50\u6811\u603b\u65b9\u6848\u6570\uff0c\u6211\u4eec\u5c31\u8981\u7ef4\u62a4\u66f4\u9ebb\u70e6\u7684\u4e58\u6cd5\u6807\u8bb0\uff09\n\n\u6709\u8f6c\u79fb\n\n$$f_{u,d}=\\sum_{v_1 \\in {\\rm son}_u} f_{v_1,d} \\prod_{v_1 \\neq v_2} (1-f_{v_2,d})$$\n\n\u7136\u540e\u8fb9\u754c\u663e\u7136\u662f $f_{u,d_u}=\\frac{1}{2}$\uff08\u8fd9\u91cc\u7684 $d_u$ \u4e3a $u$ \u70b9\u6df1\u5ea6\uff09\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u8fd9\u4e2a DP \u548c\u5b50\u6811\u6700\u5927\u6df1\u5ea6\u6709\u5173\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528\u957f\u94fe\u5256\u5206\u4f18\u5316 DP\uff0c\u6bcf\u6761\u957f\u94fe\u53ea\u4f1a\u88ab\u5408\u5e76\u4e00\u6b21\uff0c\u65f6\u7a7a\u590d\u6742\u5ea6 $\\mathcal O(n)$\u3002\n\n\u56e0\u4e3a\u5e38\u6570\u5f88\u5c0f\uff0c\u8dd1\u5230\u4e86\u76ee\u524d\u7684\u6700\u4f18\u89e3\u3002\n\n# Code\n\n```cpp\nconst int N=2e5+5,mo=1e9+7,iv2=(mo+1)/2;\nint n,ans,le[N],d[N],s[N],ls[N],o[N],*f[N],*pf=o,sm[N];\nvector<int> g[N];\nvoid dfs1(int u) {\n\ts[u]=1;\n\tfor (int v:g[u]) {\n\t\td[v]=d[u]+1;\n\t\tdfs1(v);\n\t\ts[u]+=s[v];\n\t\tle[u]=max(le[u],le[v]+1);\n\t\tif (le[v]>le[ls[u]]) ls[u]=v;\n\t}\n}\nvoid dfs2(int u) {\n\tf[u][d[u]]=iv2;\n\tif (!ls[u]) return;\n\tf[ls[u]]=f[u];\n\tdfs2(ls[u]);\n\tint mxd=0;\n\tfor (int v:g[u])\n\t\tif (v!=ls[u]) {\n\t\t\tf[v]=pf-d[v],pf+=le[v]+1,dfs2(v);\n\t\t\tmxd=max(mxd,le[v]);\n\t\t}\n\tfor (int i=d[u]+1;i<=d[u]+mxd+1;i++) sm[i]=(1+(mo-f[u][i]))%mo;\n\tfor (int v:g[u])\n\t\tif (v!=ls[u]) {\n\t\t\tfor (int k=d[v];k<=d[v]+le[v];k++) {\n\t\t\t\tf[u][k]=(1ll*sm[k]*f[v][k]%mo+1ll*f[u][k]*(1+(mo-f[v][k]))%mo)%mo;\n\t\t\t\tsm[k]=1ll*sm[k]*(1+(mo-f[v][k]))%mo;\n\t\t\t}\n\t\t}\n}\nint main() {\n\tscanf(\"%d\",&n);\n\tfor (int i=2;i<=n+1;i++) {\n\t\tint x;\n\t\tscanf(\"%d\",&x),x++;\n\t\tg[x].pb(i);\n\t}\n\tle[0]=-1;\n\tdfs1(1);\n\tf[1]=pf,pf+=le[1]+1,dfs2(1);\n\tfor (int i=0;i<=le[1];i++) ans=(ans+f[1][i])%mo;\n\tfor (int i=1;i<=n+1;i++) ans=1ll*ans*2%mo;\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1666662936,
        "uid": 283913,
        "name": "ZillionX",
        "ccfLevel": 6,
        "title": "\u3010\u957f\u94fe\u5256\u5206\u4f18\u5316 DP\uff0c\u6280\u5de7\u3011[ARC086E] Smuggling Marbles"
    }
]