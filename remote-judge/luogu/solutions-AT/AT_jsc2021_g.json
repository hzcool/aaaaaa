[
    {
        "content": "[\u9898\u76ee\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/AT_jsc2021_g)\n\n## \u601d\u8def\n\n\u672c\u9898\u5176\u5b9e\u4e3a\uff1a\u3010\u6a21\u677f\u3011\u77e9\u9635\u6811\u5b9a\u7406\u3002\n\n\u8003\u8651\u5bf9\u4e8e $a_{i,j}=1$ \u7684 $i,j$\uff0c\u6211\u4eec\u76f4\u63a5\u5728\u5e76\u67e5\u96c6\u4e2d\u628a\u5b83\u4eec $\\rm merge$ \u8d77\u6765\uff0c\u5982\u679c\u8bf4\u672c\u6765\u5c31\u5728\u4e00\u4e2a\u8fde\u901a\u5757\u5185\u4e86\uff0c\u663e\u7136\u65e0\u89e3\u3002\n\n\u6211\u4eec\u628a\u4e00\u4e2a\u8fde\u901a\u5757\u89c6\u4e3a\u4e00\u4e2a\u70b9\uff0c\u63a5\u4e0b\u6765\u5c31\u7b49\u4e8e\u6211\u4eec\u5c31\u7b49\u4e8e\u5728\u8fd9\u4e9b\u70b9\u4e2d\u53ef\u4ee5\u4e71\u8fde\u4e00\u4e9b\u8fb9\uff0c\u4e0d\u80fd\u8fde\u4e00\u4e9b\u8fb9\uff0c\u6c42\u751f\u6210\u6811\u4e2a\u6570\u3002\n\n\u7ecf\u5178\u7684\u77e9\u9635\u6811\u5b9a\u7406\uff0c\u77e9\u9635\u6811\u5b9a\u7406\u539f\u672c\u662f\u6c42 $\\sum_T \\prod_{(u,v) \u2208 T} w_{u,v}$ \u7684\uff0c\u6211\u4eec\u628a\u6240\u6709\u8fb9\u7684\u8fb9\u6743\u7f6e\u4e3a $1$\uff0c\u5c31\u53d8\u6210\u751f\u6210\u6811\u4e2a\u6570\u4e86\u3002\n\n\u6211\u4eec\u628a\u7b2c\u4e00\u884c\u7b2c\u4e00\u5217\u5220\u6389\uff0c\u7136\u540e\u6c42\u4e00\u4e2a Kirchhoff \u77e9\u9635\uff0c\u6700\u540e\u6c42\u4e2a\u884c\u5217\u5f0f\u5c31\u884c\u4e86\u3002\n\n## \u4ee3\u7801\n\n```cpp\n//A tree without skin will surely die.\n//A man without face is invincible.\n#include<bits/stdc++.h>\nusing namespace std;\nint const N=3e2+10;\nint fa[N],a[N][N];\nvector<int>b[N];\ninline int find(int x){return (x==fa[x])?x:fa[x]=find(fa[x]);}\nmint d[N][N],s[N][N],k[N][N];\ninline mint hls(int n){\n    mint res=1;\n    for (int i=1;i<=n;++i)\n        for (int j=i+1;j<=n;++j){\n            while (k[i][i].d){\n                mint div=k[j][i]/k[i][i];\n                for (int K=i;K<=n;++K) k[j][K]-=k[i][K]*div;\n                swap(k[i],k[j]),res=-res;\n            }\n            swap(k[i],k[j]),res=-res;\n        }\n    for (int i=1;i<=n;++i) res*=k[i][i];\n    return res;\n}\nsigned main(){\n    ios::sync_with_stdio(false);\n    cin.tie(0),cout.tie(0);\n    int n;cin>>n;\n    for (int i=1;i<=n;++i) fa[i]=i;\n    for (int i=1;i<=n;++i)\n        for (int j=1;j<=n;++j) cin>>a[i][j];\n    for (int i=1;i<=n;++i)\n        for (int j=i+1;j<=n;++j)\n            if (a[i][j]==1){\n                if (find(i)==find(j)) return cout<<\"0\\n\",0;\n                fa[find(i)]=find(j);\n            }\n    map<int,int>mp;int cnt=0;\n    for (int i=1;i<=n;++i)\n        if (find(i)==i) mp[i]=++cnt;\n    for (int i=1;i<=n;++i)\n        for (int j=i+1;j<=n;++j)\n            if (a[i][j]==-1){\n                if (find(i)==find(j)) continue;\n                int lai=i,laj=j;\n                i=mp[find(i)],j=mp[find(j)];\n                --i,--j;\n                d[i][i]+=1,d[j][j]+=1;\n                s[i][j]+=1,s[j][i]+=1;\n                i=lai,j=laj;\n            }\n    n=cnt;\n    for (int i=1;i<n;++i)\n        for (int j=1;j<n;++j)\n            k[i][j]=d[i][j]-s[i][j];\n    cout<<hls(n-1)<<'\\n';\n    return 0;\n}\n```",
        "postTime": 1677761030,
        "uid": 253608,
        "name": "Tx_Lcy",
        "ccfLevel": 7,
        "title": "Spanning Tree"
    }
]