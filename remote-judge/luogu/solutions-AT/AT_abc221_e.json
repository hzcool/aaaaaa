[
    {
        "content": "## \u601d\u8def\n\n\u8003\u8651\u4efb\u610f\u4e00\u5bf9 $(i,j)$ \u6ee1\u8db3 $a_i\\leqslant a_j$\uff0c\u660e\u663e\u7684\uff0c\u4e0b\u6807\u5728 $[i+1,j-1]$ \u4e2d\u7684\u5143\u7d20\u53ef\u4ee5\u968f\u4fbf\u9009\uff0c\u53cd\u6b63\u6700\u7ec8\u90fd\u4f1a\u4e3a\u7b54\u6848\u505a\u51fa\u8d21\u732e\u3002\u56e0\u6b64\uff0c\u5bf9\u4e8e\u8fd9\u6837\u4e00\u5bf9 $(i,j)$\uff0c\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a $2^{j-i-1}$\u3002\n\n\u8003\u8651\u679a\u4e3e $j$\uff0c\u5219\u524d\u9762\u6709\u8bb8\u591a\u4e2a\u4e0b\u6807 $i$ \u53ef\u4ee5\u6ee1\u8db3 $a_i\\leqslant a_j$\u3002\u4e0d\u59a8\u4ee4\u6240\u6709\u6ee1\u8db3\u6761\u4ef6\u7684\u4e0b\u6807 $i$ \u6784\u6210\u7684\u96c6\u5408\u4e3a $S$\uff0c\u5219\u5bf9\u4e8e\u8fd9\u4e2a $j$\uff0c\u7b54\u6848\u53ef\u4ee5\u8f6c\u5316\uff1a\n\n$$\n\\begin{aligned}\n\\sum\\limits_{i\\in S} 2^{j-i-1}&=2^j\\times \\sum\\limits_{i\\in S} 2^{-i-1}\\\\\n&=2^j\\times\\sum\\limits_{i\\in S} (\\frac{1}{2})^{i+1}\\\\\n&=2^j\\times\\sum\\limits_{i\\in S} \\frac{1}{2^{i+1}}\n\\end{aligned}\n$$\n\n\u5728 $\\bmod M$ \u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528\u4e58\u6cd5\u9006\u5143\uff0c\u56e0\u6b64\u539f\u6765\u7684\u7b54\u6848\u7ee7\u7eed\u53d8\u4e3a\uff1a\n\n$$\n\\begin{aligned}\n2^j\\times\\sum\\limits_{i\\in S} \\frac{1}{2^{i+1}}=2^j\\times\\sum\\limits_{i\\in S} \\text{inv}(2^{i+1})\n\\end{aligned}\n$$\n\n\u6ce8\u610f\u5230\u53f3\u8fb9\u7684\u548c\u5f0f\u9700\u8981\u6211\u4eec\u5bf9\u6240\u6709\u6ee1\u8db3 $a_i\\leqslant a_j$ \u7684 $i$ \u7684 $\\text{inv}(2^{i+1})$ \u53d6\u548c\u3002\u4e0d\u59a8\u79bb\u6563\u5316\u540e\u6743\u503c\u7ebf\u6bb5\u6811\uff0c\u5e76\u4e14\u52a8\u6001\u52a0\u5165\u9006\u5143\u3002\u6ce8\u610f\u52a0\u5165\u5fc5\u987b\u662f\u5355\u70b9\u52a0\u7684\u5f62\u5f0f\u800c\u4e0d\u662f\u8986\u76d6\u539f\u4f4d\u7f6e\u4e0a\u7684\u6570\uff0c\u56e0\u4e3a\u53ef\u80fd\u6709\u591a\u4e2a $a_i$ \u76f8\u7b49\u3002\n\n## \u4ee3\u7801\n\n```\nint n;\nint a[N],tot;\nconst int V=3e5;\nmap <int,int> p;\nset <int> s;\nint ans;\n#define mid (l+r>>1)\nstruct Segment_Tree{\n\tint sum[N<<2];\n\tvoid pushup(int p){\n\t\tsum[p]=sum[p<<1]+sum[p<<1|1];\n\t\tsum[p]%=M;\n\t}\n\tvoid insert(int p,int l,int r,int d,int x){\n\t\tif(l==r){\n\t\t\tsum[p]+=x%M;\n\t\t\tsum[p]%=M;\n\t\t\treturn;\n\t\t}\n\t\tif(d<=mid){\n\t\t\tinsert(p<<1,l,mid,d,x);\n\t\t}\n\t\telse{\n\t\t\tinsert(p<<1|1,mid+1,r,d,x);\n\t\t}\n\t\tpushup(p);\n\t}\n\tint query(int p,int l,int r,int ml,int mr){\n\t\tif(ml>mr){\n\t\t\treturn 0;\n\t\t}\n\t\tif(ml<=l&&r<=mr){\n\t\t\treturn sum[p];\n\t\t}\n\t\tint ans=0;\n\t\tif(ml<=mid){\n\t\t\tans+=query(p<<1,l,mid,ml,mr);\n\t\t}\n\t\tif(mid<mr){\n\t\t\tans+=query(p<<1|1,mid+1,r,ml,mr);\n\t\t}\n\t\treturn ans%M;\n\t}\n} T;//\u666e\u901a\u7ebf\u6bb5\u6811\uff0c\u5305\u62ec\u5355\u70b9\u52a0\u548c\u533a\u95f4\u67e5\u8be2\n#undef mid\nll qpow(ll b,ll p,ll k){\n\tif(!p){\n\t\treturn 1;\n\t}\n\tll d=qpow(b,p>>1,k);\n\tif(p&1){\n\t\treturn d*d%k*b%k;\n\t}\n\telse{\n\t\treturn d*d%k;\n\t}\n}\nll inv(ll x){\n\treturn qpow(x,M-2,M);//\u8d39\u9a6c\u5c0f\u5b9a\u7406\n}\nsigned main(){\n#ifdef Griffin\n\tfreopen(\"hack.txt\",\"r\",stdin);\n\tfreopen(\"out.txt\",\"w\",stdout);\n#endif\n\tcin>>n;\n\tfr1(i,1,n){\n\t\tcin>>a[i];\n\t\ts.insert(a[i]);\n\t}\n\tfor(auto d:s){\n\t\tif(!p.count(d)){\n\t\t\ttot++;\n\t\t\tp[d]=tot;\n\t\t}\n\t}\n\tfr1(i,1,n){\n\t\ta[i]=p[a[i]];\n\t}//\u79bb\u6563\u5316\n\tfr1(i,1,n){\n\t\tll d=qpow(2,i,M);\n\t\tll g=T.query(1,1,V,1,a[i]);//\u9006\u5143\u548c\n\t\tans+=d*g%M;//\u52a0\u4e0a\u6b64\u4f4d\u7f6e\u8d21\u732e\u7684\u7b54\u6848\n\t\tans%=M;\n\t\tT.insert(1,1,V,a[i],qpow(inv(2),i+1,M));//\u52a8\u6001\u52a0\u5165\n\t}\n\tcout<<ans<<endl;\n\treturn 0;\n}\n```\n\n[AC \u8bb0\u5f55](https://www.luogu.com.cn/record/108351120)",
        "postTime": 1681802979,
        "uid": 399150,
        "name": "Shunpower",
        "ccfLevel": 7,
        "title": "[ABC221E] LEQ \u9898\u89e3"
    },
    {
        "content": "\u9996\u5148\uff0c\u5f53\u9009\u5b9a $A_i,A_j$ \u4e3a $A_1',A_k'$ \u540e\uff0c\u4e2d\u95f4\u7684\u6570\u5c31\u53ef\u4ee5\u4e0d\u7528\u7ba1\u4e86\uff0c\u9009\u6216\u4e0d\u9009\u90fd\u53ef\u4ee5\u3002\u6240\u4ee5\uff0c\u679a\u4e3e\u6240\u6709\u6ee1\u8db3 $A_i\\leA_j$ \u7684\u70b9\u5bf9 $(i,j)$\uff0c\u7d2f\u52a0\u8d21\u732e $2^{j-i-1}$ \u5373\u53ef\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a $O(n^2\\log n)$ \u7684\u7b97\u6cd5\u3002  \n\u7136\u800c\u590d\u6742\u5ea6\u4f18\u79c0\u5230\u7206\u70b8\uff0c\u800c\u539f\u95ee\u9898\u53c8\u7c7b\u4f3c\u4e8e\u4e8c\u7ef4\u6570\u70b9\uff0c\u5bb9\u6613\u60f3\u5230\u79bb\u6563\u5316\u6811\u72b6\u6570\u7ec4\u3002\u5bf9\u4e8e\u4e8c\u6b21\u5e42\u7684\u7d2f\u52a0\uff0c\u8bbe $ans_j$ \u4e3a $A'_k=A_j$ \u65f6\u7684\u7b54\u6848\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u7edf\u8ba1\uff1a\n$$\n\\begin{aligned}\nans_j&=\\sum_{A_i\\le A_j}2^{j-i-1}\\\\\n&=\\sum_{A_i\\le A_j}2^{j-1}\\times2^{-i}\\\\\n&=2^{j-1}\\sum_{A_i\\le A_j}\\times\\left(\\dfrac 12\\right)^i\\\\\n\\end{aligned}\n$$\n\u8fd9\u6837\u5c31\u5c06\u6c42\u548c\u5206\u6210\u4e86\u5206\u522b\u53ea\u5173\u4e8e $i,j$ \u7684\u9879\u7684\u6210\u7ee9\uff0c\u6bcf\u6b21\u5728\u6811\u72b6\u6570\u7ec4\u4e0a\u6dfb\u52a0 $\\left(\\dfrac 12\\right)^i$ \u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n# AC \u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\n\nconst int MAXN = 3e5 + 10;\nconst int mod = 998244353;\nconst int inv2 = mod + 1 >> 1;\n\ninline \nll qpow(ll b, ll p) {\n\tll res = 1;\n\twhile (p) {\n\t\tif (p & 1) res = res * b % mod;\n\t\tb = b * b % mod, p >>= 1;\n\t}\n\treturn res;\n}\n\nint n, tot;\n\nll a[MAXN], b[MAXN], c[MAXN];\n\ninline \nint lowbit(int k) {\n\treturn k & -k;\n}\n\ninline \nvoid add(int k, ll x) {\n\tfor (int i = k; i <= n; i += lowbit(i)) c[i] = (c[i] + x) % mod;\n}\n\ninline \nll query(int k) {\n\tll res = 0;\n\tfor (int i = k; i; i -= lowbit(i)) res = (res + c[i]) % mod;\n\treturn res;\n}\n\nll ans;\n\nint main() {\n\tscanf(\"%d\", &n);\n\tfor (int i = 1; i <= n; i++) scanf(\"%lld\", &a[i]), b[i] = a[i];\n\tsort(b + 1, b + n + 1), tot = unique(b + 1, b + n + 1) - b - 1;\n\tfor (int i = 1; i <= n; i++) a[i] = lower_bound(b + 1, b + tot + 1, a[i]) - b;\n\tfor (int i = 1; i <= n; i++) ans = (ans + qpow(2, i - 1) * query(a[i]) % mod) % mod, add(a[i], qpow(inv2, i));\n\tprintf(\"%lld\", ans);\n}\n```",
        "postTime": 1670082367,
        "uid": 406941,
        "name": "Register_int",
        "ccfLevel": 6,
        "title": "ABC221E \u9898\u89e3"
    }
]