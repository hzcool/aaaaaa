[
    {
        "content": "[Blog\u98df\u7528\u6548\u679c\u66f4\u4f73](https://autumnkite.github.io/atcoder-xmas15D-sol/)\n\n[\u9898\u76ee\u4f20\u9001\u95e8](https://atcoder.jp/contests/xmascontest2015noon/tasks/xmascontest2015_d)\n\n## \u9898\u610f\n\n\u6709 $n+1$ \u4e2a\u5b57\u7b26\u4e32 $S_0,S_1,S_2,\\cdots,S_n$\u3002$S_0$ \u662f\u7a7a\u4e32\uff0c$S_i$ \u662f $S_{a_i}$ \u540e\u52a0\u4e0a\u5b57\u7b26 $c_i$ \u7684\u5b57\u7b26\u4e32\u3002$a_i,c_i$ \u90fd\u662f\u7ed9\u5b9a\u7684\u4e14 $0\\le a_i< i$\uff0c$c_i$ \u662f\u5c0f\u5199\u5b57\u6bcd\u3002\n\n\u5b9a\u4e49\u5b57\u7b26\u4e32 $T$ \u7684\u5468\u671f\u662f\u6240\u6709\u6ee1\u8db3 $T$ \u662f $X$ \u91cd\u590d\u65e0\u7a77\u591a\u6b21\u540e\u7684\u5b57\u7b26\u4e32\u7684\u524d\u7f00\u7684\u5b57\u7b26\u4e32 $X$ \u4e2d\u6700\u77ed\u7684\u3002\u4f8b\u5982 `abcabca` \u7684\u5468\u671f\u662f `abc`\u3002\n\n\u6c42 $S_1,S_2,S_3,\\cdots,S_n$ \u7684\u5468\u671f\u7684\u957f\u5ea6\u3002\n\n$n\\le 500\\,000$\n\n## \u9898\u89e3\n\n\u7531\u9898\u76ee\u7ed9\u5b9a\u7684\u5b57\u7b26\u4e32\u751f\u6210\u65b9\u5f0f\uff0c\u53ef\u4ee5\u60f3\u5230\u5b57\u5178\u6811\u3002\u6240\u6709\u5b57\u7b26\u4e32\u5bf9\u5e94\u5b57\u5178\u6811\u4e0a\u6839\u5230\u67d0\u4e2a\u70b9\u7684\u8def\u5f84\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5b57\u7b26\u4e32\u7684\u5468\u671f\u4e00\u5b9a\u662f\u5b57\u7b26\u4e32\u7684\u67d0\u4e2a\u524d\u7f00\u3002\u4e14\u8fd9\u4e2a\u524d\u7f00\u7684\u957f\u5ea6\u4e00\u5b9a\u662f $T[1,m-x]=T[m-x+1,m]$ \u7684 $x$ \u4e2d\u7684\u6700\u5c0f\u503c\uff08$T[l..r]$ \u8868\u793a $T$ \u4e2d $l$ \u5230 $r$ \u7684\u5b50\u4e32\uff0c$m$ \u8868\u793a $T$ \u7684\u957f\u5ea6\uff09\u3002$x$ \u6700\u5c0f\uff0c\u90a3\u4e48 $m-x$ \u662f\u6700\u5927\u7684\uff0c\u6240\u4ee5\u8fd9\u662f\u4e00\u4e2a\u6c42\u6240\u6709\u524d\u7f00=\u540e\u7f00\u4e2d\u6700\u957f\u7684\u524d\u7f00\u7684\u5f62\u5f0f\uff0c\u90a3\u4e48\u5f88\u81ea\u7136\u5730\u80fd\u60f3\u5230 KMP\u3002\n\n\u5728 trie \u4e0a\u505a KMP\uff0c\u4e0d\u80fd\u76f4\u63a5\u8df3 fail\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u7684\u60c5\u51b5\u5c31\u53ef\u4ee5\u5361\u6210 $O(n^2)$ \u7684\u590d\u6742\u5ea6\uff1a\n\n![](https://autumnkite.github.io/files/at-xmas15d-pic.png)\n\n\u56e0\u4e3a\u90fd\u662f\u5c0f\u5199\u5b57\u6bcd\uff0c\u6240\u4ee5\u7528 $go_{i,c}$\uff08\u5728\u8282\u70b9 $i$ \u8868\u793a\u7684\u5b57\u7b26\u4e32\u540e\u52a0\u5165\u5b57\u7b26 $c$ \u540e\u6700\u957f\u7684\u524d\u7f00=\u540e\u7f00\u6240\u5728\u7684\u8282\u70b9\uff09 \u8bb0\u4e0b\u8fd9\u4e2a\u8df3 fail \u7684\u8fc7\u7a0b\u5373\u53ef\uff08\u6709\u70b9\u50cf AC \u81ea\u52a8\u673a\uff0c\u4f46\u4e0d\u5b8c\u5168\u4e00\u6837\uff09\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(nk)$\uff0c$k$ \u662f\u5b57\u7b26\u96c6\u5927\u5c0f\uff0c\u8fd9\u91cc\u4e3a $26$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#define N 500005\nint n, dep[N], fail[N], go[N][26];\nchar a[N];\nint edge, hd[N], to[N], pr[N];\nvoid addedge(int u, int v){\n\tto[++edge] = v, pr[edge] = hd[u], hd[u] = edge;\n}\nvoid dfs(int u, int fa = -1){\n\tint tmp;\n\tif (~fa){\n\t\tdep[u] = dep[fa] + 1, fail[u] = go[fa][a[u]];\n\t\tfor (register int i = 0; i < 26; ++i) go[u][i] = go[fail[u]][i];\n\t\tif (fail[u] == fa) go[u][a[u]] = u;\n\t\ttmp = go[fa][a[u]], go[fa][a[u]] = u;\n\t}\n\tfor (register int i = hd[u]; i; i = pr[i]) dfs(to[i], u);\n\tif (~fa) go[fa][a[u]] = tmp;\n}\nint main(){\n\tscanf(\"%d\", &n);\n\tfor (register int i = 1, fa; i <= n; ++i) scanf(\"%d\", &fa), addedge(fa, i); // \u5efa\u6811\n\tscanf(\"%s\", a + 1);\n\tfor (register int i = 1; i <= n; ++i) a[i] -= 'a';\n\tdep[0] = 0, dfs(0);\n\tfor (register int i = 1; i <= n; ++i) printf(\"%d\\n\", dep[i] - dep[fail[i]]);\n}\n\n```\n",
        "postTime": 1558357482,
        "uid": 20561,
        "name": "AutumnKite",
        "ccfLevel": 10,
        "title": "\u300cAT1736\u300d\u300cXmas Contest 2015\u300dDestroy the Duplicated Poem"
    }
]