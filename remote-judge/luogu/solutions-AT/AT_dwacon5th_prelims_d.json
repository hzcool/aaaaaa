[
    {
        "content": "[$\\mathfrak{View\\space it\\space on\\space my\\space Blog}$](https://blog.seniorious.cc/2020/AT-4497/)\n\n## \u5206\u6790\n\n\u9996\u5148\u4e0d\u96be\u53d1\u73b0\uff0c\u6309\u6a2a\u7eb5\u5750\u6807 $\\bmod D$ \u7684\u503c\u53ef\u5206\u4e3a $D^2$ \u4e2a\u540c\u4f59\u7c7b\uff0c\u540c\u4f59\u7c7b\u4e2d\u7684\u6570\u4e24\u4e24\u53ef\u8fbe\uff0c\u8bbe $A_{i,j}$ \u4e3a $x\\bmod D=i,y\\bmod D=j$ \u7684\u9ed1\u70b9\u4e2a\u6570\n\n\u4e0d\u96be\u53d1\u73b0\u6700\u7ec8\u4f1a\u628a\u6240\u6709\u9ed1\u70b9\u653e\u5728\u4e00\u8d77\u7136\u540e\u7528\u4e00\u4e2a\u6b63\u65b9\u5f62\u5305\u62ec\u6240\u6709\u7684\u9ed1\u70b9\uff0c\u5e76\u5c3d\u91cf\u4f7f\u6b63\u65b9\u5f62\u8fb9\u957f\u6700\u5c0f\n\n\u4e0d\u59a8\u8bbe\u6b63\u65b9\u5f62\u8fb9\u957f\u4e3a $aD+b$ \u5176\u4e2d $1\\le b\\le D$\uff0c\u4e0d\u96be\u53d1\u73b0 $a=\\left(\\max\\limits_{0\\le i,j\\lt D}\\lceil\\sqrt{A_{i,j}}\\rceil\\right)-1$ \uff08\u8003\u8651\u4e00\u4e2a\u8fb9\u957f\u4e3a $aD$ \u7684\u6b63\u65b9\u5f62\u80fd\u5305\u62ec\u6bcf\u4e2a\u540c\u4f59\u7c7b\u6070\u597d $a^2$ \u6b21\uff09\n\n\u4e0d\u96be\u53d1\u73b0\u82e5\u6b63\u65b9\u5f62\u5de6\u4e0b\u89d2\u5728 $(0,0)$ \u5904\uff0c\u5219 $(0\\sim b,0\\sim b)$ \u88ab\u8986\u76d6 $(a+1)^2$ \u6b21\uff1b$(0\\sim b,b+1\\sim D-1)$ \u548c $(b+1\\sim D-1,0\\sim b)$ \u88ab\u8986\u76d6 $a(a+1)$ \u6b21\uff1b$(b+1\\sim D-1,b+1\\sim D-1)$ \u88ab\u8986\u76d6 $a^2$ \u6b21\n\n\u53ef\u4ee5\u4e00\u5f00\u59cb\u5c31\u5c06 $b$ \u8bbe\u4e3a $D$ \u7136\u540e\u679a\u4e3e\u6bcf\u4e00\u4e2a\u70b9\u4f5c\u4e3a\u5de6\u4e0b\u89d2\uff0c\u82e5\u6b64\u65f6 $b$ \u5408\u6cd5\uff0c\u5219\u8ba1\u5165\u7b54\u6848\u5e76\u4ee4 $b\\leftarrow b-1$\uff0c\u5426\u5219\u5c31\u679a\u4e3e\u4e0b\u4e00\u4e2a\u5de6\u4e0b\u89d2\uff0c\u4e8e\u662f\u95ee\u9898\u8f6c\u53d8\u4e3a\u5224\u65ad\u5bf9\u4e8e\u4e00\u4e2a\u5de6\u4e0b\u89d2 $b$ \u662f\u5426\u5408\u6cd5\n\n\u8fd9\u4e2a\u95ee\u9898\u53ef\u4ee5\u7528\u4e8c\u7ef4\u524d\u7f00\u548c\u89e3\u51b3\uff1a\u5206\u522b\u8bb0\u5f55 $a^2\\lt A_{i,j}\\le a(a+1)$ \u7684\u4e2a\u6570\u548c $a(a+1)\\lt A_{i,j}$ \u7684\u4e2a\u6570\uff0c\u6bcf\u6b21\u8be2\u95ee\u5373\u67e5\u8be2 $a^2$ \u7684\u533a\u57df\u662f\u5426\u6709 $\\gt a^2$ \u7684\u548c $a(a+1)$ \u7684\u533a\u57df\u662f\u5426\u6709 $\\gt a(a+1)$ \u7684\uff0c\u5e76\u6ce8\u610f\u5904\u7406 $+b$ \u540e\u8d85\u8fc7 $D-1$ \u7684\u60c5\u51b5\uff0c\u5177\u4f53\u89c1\u4ee3\u7801\n\n## \u4ee3\u7801\n\n```cpp\nconstexpr int N = 1005;\n\nint sum2(int x1, int y1, int x2, int y2);\nint sum3(int x1, int y1, int x2, int y2);\nbool check2(int x, int y, int b);\nbool check3(int x, int y, int b);\n\nint cnt2[N][N], cnt3[N][N];\nint cnt[N][N];\nint n, d;\n\nint main() {\n  read(n), read(d);\n  for (int i = 1; i <= n; ++i) {\n    int x, y;\n    read(x), read(y);\n    ++cnt[x % d][y % d];\n  }\n  int a = 0;\n  for (int i = 0; i < d; ++i) {\n    for (int j = 0; j < d; ++j) {\n      if (cnt[i][j]) {\n        int tmp = std::sqrt(cnt[i][j]);\n        if (tmp * tmp < cnt[i][j]) {\n          ++tmp;\n        }\n        a = max(a, tmp - 1);\n      }\n    }\n  }\n  for (int i = 0; i < d; ++i) {\n    for (int j = 0; j < d; ++j) {\n      if (cnt[i][j] > a * a) {\n        if (cnt[i][j] > a * (a + 1)) {\n          ++cnt3[i + 1][j + 1];\n        } else {\n          ++cnt2[i + 1][j + 1];\n        }\n      }\n    }\n  }\n  for (int i = 1; i <= d; ++i) {\n    for (int j = 1; j <= d; ++j) {\n      cnt2[i][j] += cnt2[i - 1][j] + cnt2[i][j - 1] - cnt2[i - 1][j - 1];\n      cnt3[i][j] += cnt3[i - 1][j] + cnt3[i][j - 1] - cnt3[i - 1][j - 1];\n    }\n  }\n  int b = 0;\n  for (; b < d; ++b) {\n    if (check2(0, 0, b) && check3(0, 0, b)) {\n      break;\n    }\n  }\n  for (int i = 0; i < d; ++i) {\n    for (int j = 0; j < d; ++j) {\n      if (!(i + j)) {\n        continue;\n      }\n      while (b) {\n        if (check2(i, j, b - 1) && check3(i, j, b - 1)) {\n          --b;\n        } else {\n          break;\n        }\n      }\n    }\n  }\n  write(a * d + b), EL;\n  return 0;\n}\n\nint sum2(int x1, int y1, int x2, int y2) {\n  if (x1 > x2 || y1 > y2) {\n    return 0;\n  }\n  ++x1, ++y1, ++x2, ++y2;\n  return cnt2[x2][y2] - cnt2[x2][y1 - 1] - cnt2[x1 - 1][y2] + cnt2[x1 - 1][y1 - 1];\n}\nint sum3(int x1, int y1, int x2, int y2) {\n  if (x1 > x2 || y1 > y2) {\n    return 0;\n  }\n  ++x1, ++y1, ++x2, ++y2;\n  return cnt3[x2][y2] - cnt3[x2][y1 - 1] - cnt3[x1 - 1][y2] + cnt3[x1 - 1][y1 - 1];\n}\nbool check2(int x, int y, int b) {\n  int t1 = sum2(x + b + 1, y + b + 1, d - 1, d - 1);\n  int t2 = sum2(max(0, x + b + 1 - d), max(0, y + b + 1 - d), x - 1, y - 1);\n  int t3 = sum2(x + b + 1, max(0, y + b + 1 - d), d - 1, y - 1);\n  int t4 = sum2(max(0, x + b + 1 - d), y + b + 1, x - 1, d - 1);\n  return !t1 && !t2 && !t3 && !t4;\n}\nbool check3(int x, int y, int b) {\n  int t1 = sum3(x + b + 1, 0, d - 1, d - 1);\n  int t2 = sum3(0, y + b + 1, d - 1, d - 1);\n  int t3 = sum3(max(0, x + b + 1 - d), 0, x - 1, d - 1);\n  int t4 = sum3(0, max(0, y + b + 1 - d), d - 1, y - 1);\n  return !t1 && !t2 && !t3 && !t4;\n}\n```\n",
        "postTime": 1606924078,
        "uid": 25251,
        "name": "moongazer",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 AT4497 \u3010Square Rotation\u3011"
    }
]