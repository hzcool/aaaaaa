[
    {
        "content": "\u559c\u6b22\u51fa NTT \u662f\u5427\uff0c\u4e00\u9898\u8fd8\u4e24\u4e2a\u72ec\u7acb\u7684 NTT \u95ee\u9898\u662f\u5427\uff0c\u51fa\u9898\u4eba\u731c\u731c\u6211\u8981\u8bf4\u4ec0\u4e48\uff1f\n\n\u9996\u5148\u8fd9\u4e2a\u95ee\u9898\u53ef\u4ee5\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a\n\n- \u5bf9\u6bcf\u4e2a $i\\in [0,n-1]$\uff0c\u6c42\u51fa\u5f02\u8272\u7403\u5bf9**\u6070\u597d**\u4e3a $i$ \u7684\u65b9\u6848\u6570 $p_i$\u3002\n- \u5bf9\u6bcf\u4e2a $k\\in [1,m]$\uff0c\u6c42 $\\sum_{i=0}^{n-1} p_i\\times i^k$\u3002\n\n\u9996\u5148\u7b2c\u4e8c\u90e8\u5206\u770b\u7740\u6bd4\u8f83\u597d\u505a\uff0c\n\n\u8003\u8651 $f_i(x)=p_i(1+ix+(ix)^2+\\dots)=\\dfrac{p_i}{1-ix}$\uff0c\u53ea\u8981\u6c42 $\\sum f_i(x)$\uff0c\u663e\u7136\u53ef\u4ee5\u5206\u6cbb\u901a\u5206\u89e3\u51b3\u3002\u8fd9\u4e2a\u90e8\u5206\u65f6\u95f4\u590d\u6742\u5ea6\u662f $\\mathcal O(n\\log ^2 n)$\u3002\n\n\u7b2c\u4e00\u90e8\u5206\u770b\u5230\u4e86\u6070\u597d\uff0c\u611f\u89c9\u5c31\u662f\u4e8c\u9879\u5f0f\u5b9a\u7406\u3002\n\n\u5f02\u8272\u7403\u5bf9\u4e0d\u592a\u597d\u5904\u7406\uff0c\u6211\u4eec\u5904\u7406\u4e0b\u540c\u8272\u7403\u5bf9\u3002**\u6211\u4eec\u4e0b\u9762\u5148\u4e0d\u8003\u8651\u540c\u8272\u7403\u4e4b\u95f4\u7684\u987a\u5e8f**\u3002\u6211\u4eec\u53ea\u8981**\u94a6\u5b9a** $i$ \u4e2a\u7403\u5bf9\u76f8\u90bb\u5373\u53ef\u3002\n\n\u6211\u4eec\u8003\u8651\u679a\u4e3e\u6bcf\u4e00\u79cd\u989c\u8272\u7684\u5206\u914d\u60c5\u51b5\uff0c\u5047\u8bbe\u989c\u8272 $j$ \u6709 $c_j$ \u7684\u7403\uff0c\u6211\u4eec\u94a6\u5b9a\u5b83\u5f53\u4e2d\u6709 $k_j$ \u4e2a\u76f8\u90bb\u5bf9\u3002\u90a3\u4e48\u76f8\u5f53\u4e8e\u5728 $c_j-1$ \u4e2a\u76f8\u90bb\u5bf9\u5f53\u4e2d\u94a6\u5b9a $k_j$ \u4e2a\u76f8\u90bb\uff0c\u65b9\u6848\u6570\u662f $\\dbinom {c_j-1}{k_j}$\u3002\u90a3\u4e48\u8fd9\u4e2a\u989c\u8272 $j$ \u5c31\u4f1a\u5206\u6210 $c_j-k_j$ \u4e2a $j-$\u540c\u8272\u6bb5\u3002\u603b\u5171\u6709 $n-i$ \u4e2a\u540c\u8272\u6bb5\uff0c\u6211\u4eec\u9700\u8981\u5206\u914d\u8fd9\u4e9b\u989c\u8272\u6bb5\uff0c\u989c\u8272\u6bb5\u4e4b\u95f4\u8fd8\u65e0\u5148\u540e\u987a\u5e8f\uff0c\u90a3\u4e48\u8fd9\u91cc\u7684\u65b9\u6848\u6570\u5c31\u662f\uff1a$\\dbinom{n-i}{c_1-k_1,\\dots,c_n-k_n}$\u3002\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u6211\u4eec\u53d1\u73b0**\u94a6\u5b9a** $i$ \u4e2a\u76f8\u90bb\u5bf9\u7684\u65b9\u6848\u6570\u5c31\u662f\uff1a\n$$\nq_i=\\sum_{\\sum k_j=i}\\dbinom{n-i}{c_j-k_j}\\times \\prod \\dbinom{c_j-1}{k_j}\n$$\n\u4e0d\u96be\u53d1\u73b0\u8fd9\u73a9\u610f\u53ef\u4ee5\u5377\u79ef\u4f18\u5316\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u8fd8\u662f $\\mathcal O(n\\log^2 n)$ \u7684\u3002\n\n\u7136\u540e\u4e8c\u9879\u5f0f\u53cd\u6f14\u56de\u53bb\u5c31\u884c\u3002\n\n\u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u4ee3\u7801\u8fd9\u4e48\u6162\u554a/yiw\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\n#define LL __int128\n#define MP make_pair\n#define vll vector<long long>\nconst int MAXN=1e6+5;\nint MOD=998244353;\nconst ll inv2=(MOD+1)/2;\nnamespace polynomial{// yjl poly plank 4.0 ver\nint bfly[MAXN];ll inver[MAXN];\nLL p[]={998244353,1004535809,469762049};LL Pr=p[0]*p[1]*p[2];\nLL pl[]={471892799929712641ll,468937312667959297ll,1002772198720536577ll};\nLL lv[]={850356001,395249030,354521948}; \nint clogg(int x){return (int)ceil(log2(x));} \nll ksm(ll a,int b){ll res=1;while(b){if(b&1)res=res*a%MOD;a=a*a%MOD,b>>=1;}return res;}\nvoid butterfly(int l){\n\tstatic int las;\n\tif(las!=l){\n\t\tlas=l; \n\t\tfor(int i=1;i<(1<<l);i++)\n\t\t\tbfly[i]=(bfly[i>>1]>>1)|((i&1)<<l-1);\n\t} \n}\nvoid NTT(vll &f,int l,int typ){\n\tbutterfly(l);f.resize(1<<l);\n\tfor(int i=0;i<(1<<l);i++)\n\t\tif(bfly[i]<i) swap(f[i],f[bfly[i]]);\n\tfor(int i=0;i<l;i++){\n\t\tll step=ksm(3,MOD-1+(MOD-1>>i+1)*typ);\n\t\tfor(int j=0;j<(1<<l);j+=(1<<i+1)){\n\t\t\tll cur=1,l=j+(1<<i);\n\t\t\tfor(int k=j;k<l;k++){\n\t\t\t\tll u=f[k],v=f[k|(1<<i)]*cur%MOD;\n\t\t\t\tf[k]=(u+v>MOD?u+v-MOD:u+v);\n\t\t\t\tf[k|(1<<i)]=(u>=v?u-v:u-v+MOD);\n\t\t\t\tcur=cur*step%MOD;\n\t\t\t}\n\t\t}\n\t}\n\tif(typ==-1){\n\t\tll val=ksm(1<<l,MOD-2);\n\t\tfor(int i=0;i<(1<<l);i++)\n\t\t\tf[i]=val*f[i]%MOD;\n\t}\n\treturn;\n}\nvll operator *(vll f,vll g){\n//\tcerr<<\"TIME: \"<<f.size()<<\" \"<<g.size()<<endl;\n\tif(f.size()+g.size()<=128){\n\t\tvll h(f.size()+g.size()-1);\n\t\tfor(int i=0;i<f.size();i++)\n\t\t\tfor(int j=0;j<g.size();j++){\n\t\t\t\th[i+j]+=f[i]*g[j]%MOD;\n\t\t\t\tif(h[i+j]>=MOD) h[i+j]-=MOD;\n\t\t\t}\n\t\treturn h;\n\t}\n\tint n=f.size()+g.size(),l=clogg(f.size()+g.size());\n\tNTT(f,l,1);NTT(g,l,1);\n\tfor(int i=0;i<(1<<l);i++)\n\t\tf[i]=f[i]*g[i]%MOD;\n\tNTT(f,l,-1);f.resize(n-1);\n\treturn f;\n}\nvll operator +(vll f,vll g){\n\tint n=max(f.size(),g.size());\n\tf.resize(n);g.resize(n);\n\tfor(int i=0;i<n;i++)\n\t\tf[i]=(f[i]+g[i]>=MOD?f[i]+g[i]-MOD:f[i]+g[i]);\n\treturn f;\n}\nvll inv(vll f,int st=1){\n\tint n=f.size(),l=clogg(n);\n\tf.resize(1<<l);\n\tvll g{ksm(f[0],MOD-2)},_f;\n\tfor(int i=st;i<=l;i++){\n\t\t_f=vll(begin(f),begin(f)+(1<<i));\n\t\tNTT(g,i+1,1);NTT(_f,i+1,1);\n\t\tfor(int j=0;j<(1<<i+1);j++)\n\t\t\tg[j]=(2*g[j]-g[j]*g[j]%MOD*_f[j]%MOD+MOD)%MOD;\n\t\tNTT(g,i+1,-1);\n\t\tfill(begin(g)+(1<<i),end(g),0);\n\t}\n\tg.resize(n);\n\treturn g;\n}\nvll integ(vll f){\n\tint n=f.size();f.resize(n+1);\n\tif(!inver[1]){\n\t\tfor(int i=1;i<MAXN;i++) inver[i]=ksm(i,MOD-2);\n\t}\n\tfor(int i=n;i>=1;i--) f[i]=f[i-1]*inver[i]%MOD;\n\tf[0]=0;\n\treturn f;\n}\nvll diff(vll f){\n\tint n=f.size();\n\tfor(int i=0;i<n-1;i++)\n\t\tf[i]=f[i+1]*(i+1)%MOD;\n\tf.pop_back();\n\treturn f;\n} \nvll ln(vll f){\n\tvll f_=diff(f),_f=inv(f);\n\tint n=f_.size(),m=_f.size();\n\tint l=clogg(n+m);\n\tNTT(f_,l,1);NTT(_f,l,1);\n\tfor(int i=0;i<(1<<l);i++)\n\t\tf_[i]=f_[i]*_f[i]%MOD;\n\tNTT(f_,l,-1);\n\tf_=integ(f_);\n\tf_.resize(f.size());\n\treturn f_;\n}\nvll exp(vll f){\n\tvll g{1},_f,_g;\n\tint n=f.size(),l=clogg(n);\n\tf.resize(1<<l);\n\tfor(int i=1;i<=l;i++){\n\t\t_f=vll(begin(f),begin(f)+(1<<i));\n\t\t_g=ln(g);\n\t\tNTT(g,i+1,1);NTT(_f,i+1,1);NTT(_g,i+1,1);\n\t\tfor(int j=0;j<(1<<i+1);j++)\n\t\t\tg[j]=g[j]*(1-_g[j]+_f[j]+MOD)%MOD;\n\t\tNTT(g,i+1,-1);\n\t\tfill(begin(g)+(1<<i),end(g),0);\n\t}\n\tg.resize(n);\n\treturn g;\n}\nvll sqrt(vll f){\n\tvll g{1},_f,_g;\n\tint n=f.size(),l=clogg(n);\n\tf.resize(1<<l);\n\tfor(int i=1;i<=l;i++){\n\t\t_f=vll(begin(f),begin(f)+(1<<i));\n\t\t_g=inv(g);\n\t\tNTT(_f,i+1,1);NTT(_g,i+1,1);NTT(g,i+1,1);\n\t\tfor(int j=0;j<(1<<i+1);j++)\n\t\t\tg[j]=(_f[j]+g[j]*g[j]%MOD)*inv2%MOD*_g[j]%MOD;\n\t\tNTT(g,i+1,-1);\n\t\tfill(begin(g)+(1<<i),end(g),0);\n\t}\n\tg.resize(n);\n\treturn g;\n} \nvll MTT(vll f,vll g,ll P){\n\tll t=clock();\n\tint n=f.size()-1,m=g.size()-1;\n\tvll _f,_g,ans[3];\n\tfor(int i=0;i<3;i++){\n\t\tMOD=p[i];\n\t\t_f=f,_g=g;\n\t\tint k=clogg(f.size()+g.size());\n\t\tNTT(_f,k,1);NTT(_g,k,1);\n\t\tfor(int j=0;j<(1<<k);j++) _f[j]=_f[j]*_g[j]%MOD;\n\t\tNTT(_f,k,-1);\n\t\tans[i]=_f;\n\t}\n\tvll as(n+m+1);\n\tfor(int i=0;i<=n+m;i++){\n\t\tLL res=0;\n\t\tfor(int j=0;j<3;j++)\n\t\t\tres+=pl[j]*lv[j]%Pr*ans[j][i]%Pr;\n\t\tres%=Pr;as[i]=res%P;\n\t}\n\treturn as;\n}\n}using namespace polynomial;\nll fac[MAXN],inf[MAXN];\nint n,m;\nint cnt[MAXN];\nvll solve(int l,int r){\n\tif(l==r){\n\t\tif(cnt[l]==0) return {1};\n\t\tvll f(cnt[l]+1);\n\t\tfor(int i=0;i<cnt[l];i++)\n\t\t\tf[i]=fac[cnt[l]]*inf[cnt[l]-i]%MOD*fac[cnt[l]-1]%MOD*inf[i]%MOD*inf[cnt[l]-1-i]%MOD;\n\t\treturn f;\n\t}\n\tint mid=l+r>>1;\n\treturn solve(l,mid)*solve(mid+1,r);\n}\npair<vll,vll> solve1(vll &f,int l,int r){\n\tif(l==r){return MP((vll){f[l]},(vll){1,MOD-l});}\n\tint mid=l+r>>1;\n\tauto le=solve1(f,l,mid),ri=solve1(f,mid+1,r);\n\treturn MP(le.first*ri.second+le.second*ri.first,le.second*ri.second);\n}\nint main(){\n\tfac[0]=inf[0]=1;\n\tfor(int i=1;i<MAXN;i++) inf[i]=ksm(fac[i]=fac[i-1]*i%MOD,MOD-2);\n\tcin>>n>>m;\n\tfor(int i=1;i<=n;i++){int a;cin>>a;cnt[a]++;}\n\tint t=clock();\n\tvll f=solve(1,n);\n\tfor(int i=0;i<=n;i++) f[i]=f[i]*fac[n-i]%MOD*(i&1?MOD-1:1)%MOD*fac[i]%MOD;\n\tvll g(n+1);\n\tfor(int i=0;i<=n;i++) g[i]=inf[i];\n\treverse(g.begin(),g.end());\n\tg=f*g;\n\tfor(int i=0;i<=n;i++) f[i]=g[i+n]*inf[i]%MOD*(i&1?MOD-1:1)%MOD;\n\treverse(f.begin(),f.begin()+n);\n\tauto ans=solve1(f,0,n);\n\tans.second.resize(m+1);\n\tf=ans.first*inv(ans.second);\n\tfor(int i=1;i<=m;i++) cout<<f[i]<<\" \";\n\tcerr<<clock()-t<<endl;\n\treturn 0;\n}\n```",
        "postTime": 1685120340,
        "uid": 248400,
        "name": "Inaba_Meguru",
        "ccfLevel": 7,
        "title": "\u559c\u6b22 NTT \u662f\u5427"
    },
    {
        "content": "\u6211\u4eec\u4e0d\u59a8\u5148\u8ba1\u7b97\n\n$$f(x) = \\sum_{P\\in S_N} [C(P) = x]$$\n\n\u8003\u8651\u8bbe $p[x]$ \u4e3a\u6070\u597d\u6709 $x$ \u5bf9\u76f8\u540c\u989c\u8272\u5c0f\u7403\u76f8\u90bb\u7684\u65b9\u6848\u6570\uff0c$q[x]$ \u662f\u81f3\u5c11\u6709 $x$ \u5bf9\u76f8\u540c\u989c\u8272\u5c0f\u7403\u76f8\u90bb\u7684\u65b9\u6848\u6570\u3002\u53ef\u4ee5\u53d1\u73b0 $f(x) = p[n - 1 - x]$\u3002\u6839\u636e\u4e8c\u9879\u5f0f\u53cd\u6f14\uff0c\n\n$$q[x] = \\sum_{k \\ge x} \\binom{k}{x} p[k]\\quad \\Rightarrow\\quad p[x] = \\sum_{k \\ge x} (-1)^{k - x} \\binom{k}{x} q[k]$$\n\n\u5982\u679c\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u6c42\u5f97 $q$\uff0c\u90a3\u6211\u4eec\u5c31\u53ef\u4ee5\u5728 $O(n\\log n)$ \u7684\u590d\u6742\u5ea6\u5185\u7b97\u5f97 $p$\u3002\u63a5\u4e0b\u6765\u7b97 $q$\u3002\n\n\u8003\u8651\u7b2c $c$ \u79cd\u989c\u8272\u7684\u7403\u6570\u91cf\u662f $m_c$ \u79cd\uff0c\u6700\u591a\u6709 $m_c - 1$ \u5bf9\u989c\u8272\u4e3a $c$ \u7684\u540c\u8272\u76f8\u90bb\u7403\u3002\u6211\u4eec\u679a\u4e3e\u4e00\u7cfb\u5217\u65b9\u6848\uff0c\u7528\u5e8f\u5217 $a$ \u6807\u660e\u3002\u5047\u8bbe\u5bf9\u989c\u8272 $c$ \u6709 $a_c$ \u5bf9\u540c\u8272\u76f8\u90bb\u7403\uff0c\u5219\u5171\u6709 $\\dbinom{m_c - 1}{a_c}$ \u79cd\u65b9\u5f0f\u6765\u6392\u5217\u4ed6\u4eec\u3002\u56e0\u6b64\u8bbe $a$ \u679a\u4e3e $\\sum a_i = m$ \u7684\u5e8f\u5217\uff0c\u53ef\u4ee5\u77e5\u9053\n\n$$q[m] = \\sum_a \\left( \\binom{n - m}{m_1 - k_1, m_2 - k_2 ,\\dots, m_n - k_n} \\prod_{c\\ge 0} \\binom{m_c - 1}{a_c} \\right)$$\n\n\u8003\u8651\u8bbe $r[x] = q[n - x]$\uff0c\u5e76 $r[0] = 0$\uff0c\u6211\u4eec\u80fd\u5f97\u5230\n\n$$r[m] = \\sum_a \\left( \\binom{m}{k_1, k_2 ,\\dots, k_n} \\prod_{c\\ge 0} \\binom{m_c - 1}{a_c} \\right)$$\n\n\u8fd9\u79cd\u5f62\u5f0f\u53ef\u4ee5\u76f4\u63a5\u6784\u9020\u6bcf\u4e2a\u5143\u7d20\u7684 gf \u7136\u540e\u5377\u8d77\u6765\u3002\u6784\u9020\n\n$$G_c(x) = \\sum_{k\\ge 0} \\binom{m_c - 1}{k} \\frac{x^k}{k!}$$\n\n\u53ef\u4ee5\u77e5\u9053\n\n$$r[n] = \\left[\\frac{x^n}{n!}\\right] \\prod_{c} G_c(x)$$\n\n$r$ \u53ef\u4ee5\u76f4\u63a5\u4f5c\u5206\u6cbb\u4e58\u6cd5 $O(n\\log^2 n)$ \u5730\u5f97\u5230\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u7b97\u51fa\u4e86\u6bcf\u4e2a $f(x)$\u3002\n\n\u4e0b\u9762\u8003\u8651\u5982\u4f55\u7b97 $F(k)$\u3002\u5148\u5199\u51fa\u5f62\u5f0f\uff1a\n\n$$F(k) = \\sum_{x \\ge 0} f(x) x^k$$\n\n\u8fd9\u4e2a\u5f62\u5f0f\u542f\u53d1\u6211\u4eec\u6784\u9020 $F$ \u7684\u751f\u6210\u51fd\u6570\u3002\u5047\u8bbe\u662f $H(z)$\uff0c\u6211\u4eec\u6709\n\n$$H(z) = \\sum_{k\\ge 0} \\sum_{x \\ge 0} f(x) x^k z^k = \\sum_{x \\ge 0} f(x) \\left(\\sum_{k\\ge 0} (xz)^k\\right) = \\sum_{x\\ge 0} \\frac{f(x)}{1 - xz}$$\n\n$H$ \u53ef\u4ee5\u76f4\u63a5\u4f5c\u5206\u6cbb\u4e58\u6cd5 $O(n\\log^2 n)$ \u5730\u5f97\u5230\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u7b97\u51fa\u4e86\u6bcf\u4e2a $F(k)$\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2 n + m\\log m)$\u3002\n\n[Submission](https://atcoder.jp/contests/abc260/submissions/39692220).",
        "postTime": 1678925637,
        "uid": 631791,
        "name": "joke3579",
        "ccfLevel": 0,
        "title": "ABC260Ex \u9898\u89e3"
    }
]