[
    {
        "content": "\u5bb9\u65a5\u795e\u4ed9\u9898 qwq\u3002\n\n## \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u5e8f\u5217 $a_1,a_2,\\cdots ,a_n$\uff0c\u8f93\u51fa\u6ee1\u8db3\u5982\u4e0b\u6761\u4ef6\u7684\u5e8f\u5217 $x$ \u7684\u65b9\u6848\u6570\uff1a\n\n1. $1\\leq x_i\\leq a_i$\n2. $x_i\\neq x_{i+1}(1\\leq i\\leq n-1)$\n\n- $2\\le n\\le 5\\times 10^5,1\\le a_i\\le 10^9$\n\n## Solution\n\n\u9996\u5148\u6211\u4eec\u89c4\u5b9a\u5f62\u5982 $x_{i} = x_{i + 1}$ \u7684\u70b9\u4e3a\u574f\u70b9\u3002\n\n\u4ee4 $f_{i}$ \u8868\u793a\u81f3\u5c11\u6709 $i$ \u4e2a\u574f\u70b9\u7684\u65b9\u6848\u6570\uff0c\u90a3\u4e48\u5957\u4e0a\u5bb9\u65a5\u7684\u5f0f\u5b50\uff1a\n\n$$ ans = \\sum_{i=0}^{n-1} (-1) ^ i\\times f_i $$\n\n\u90a3\u4e48\u6211\u4eec\u4ee4\u6240\u6709\u7684\u574f\u70b9\u5411\u5de6\u5408\u5e76\uff0c\u5373 $x_i \\gets x_i,x_{i + 1} $ \u5176\u4e2d $x_i = x_{i + 1}$\uff0c\u5047\u8bbe\u6709 $k$ \u4e2a\u574f\u70b9\uff0c\u90a3\u4e48\u6070\u597d\u51cf\u5c11 $k$ \u4e2a\u6570\uff0c\u800c\u8fd9\u7b49\u4ef7\u4e8e\u5c06\u5e8f\u5217\u5212\u5206\u6210 $n - k$ \u6bb5\uff0c\u6bcf\u6bb5\u5185\u90fd\u662f\u76f8\u540c\u7684\u6570\u3002\n\n\u6ce8\u610f\u8fd9\u91cc\u53ea\u662f\u5f3a\u5236\u9650\u5b9a\u4e86\u6bcf\u4e00\u6bb5\u5185\u76f8\u540c\uff0c\u4e0d\u4ee3\u8868\u76f8\u90bb\u6bb5\u4e4b\u95f4\u5fc5\u987b\u4e0d\u540c\uff0c\u56e0\u4e3a\u6211\u4eec\u662f**\u81f3\u5c11**\u3002\n\n\u6240\u4ee5\u6211\u4eec\u8003\u8651\u7528 dp \u6c42\u51fa\u8fd9\u6837\u5212\u5206\u7684\u65b9\u6848\u6570\uff0c\u4ee4 $dp[i][j]$ \u8868\u793a\u586b\u4e86 $i$ \u4e2a\u6570\uff0c\u5212\u5206\u51fa $j$ \u6bb5\u7684\u65b9\u6848\u6570\u3002\n\n\u90a3\u4e48\u5bf9\u7b54\u6848\u8fdb\u884c\u6539\u5199\uff1a\n\n$$ ans = \\sum_{i = 0}^{n - 1} (-1)^i \\times dp[n][n - i] $$\n\n\u5148\u8003\u8651\u6734\u7d20\u8f6c\u79fb\uff1a\n\n$$ dp[i][j] = \\sum_{k = 0}^{i - 1} dp[k][j - 1] \\times \\min_{o = k + 1}^{i}a_o $$\n\n\u4ee3\u8868\u6dfb\u52a0\u4e00\u6bb5 $(k + 1,i)$ \u7684\u7ebf\u6bb5\uff0c\u6709 $\\min_{o = k + 1}^{i}a_o$ \u79cd\u586b\u6cd5\u3002\n\n\u590d\u6742\u5ea6\u8fd8\u4e0d\u591f\u4f18\u79c0\u3002\n\n\u6211\u4eec\u53d1\u73b0\u6700\u540e\u53ea\u5173\u5fc3\u5212\u5206\u51fa\u7684\u6bb5\u6570\u7684**\u5947\u5076**\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u6539\u5199\u6210 $dp[i][0/1]$ \u4ee3\u8868\u5212\u5206\u6210 ``\u5076\u6570/\u5947\u6570`` \u6bb5\u7684\u65b9\u6848\u6570\u3002\n\n\u65b9\u7a0b\u53c8\u53d8\u6210\u4e86\uff1a\n\n$$ dp[i][op] = \\sum_{k = 0}^{i - 1} dp[k][op\\text{ xor }1] \\times \\min_{o = k + 1}^{i}a_o $$\n\n\u90a3\u4e48\u524d\u9762\u90a3\u4e2a\u4e1c\u897f\u53ef\u4ee5\u524d\u7f00\u548c\u4f18\u5316\u3002\n\n\u540e\u9762\u90a3\u4e00\u5768\uff0c\u6211\u4eec\u7ef4\u62a4\u5355\u8c03\u6808\uff0c\u627e\u5230\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u5c0f\u4e8e $a[i]$ \u7684\u3002\n\n- \u5982\u679c\u4e0d\u5b58\u5728\u8fd9\u6837\u7684\uff0c\u90a3\u4e48 $a[i]$ \u5c31\u662f\u6700\u5c0f\u503c\uff0c\u76f4\u63a5\u524d\u7f00\u548c\u4e58\u4e0a\u5373\u53ef\u3002\n- \u5426\u5219\u8003\u8651\u4ee4\u524d\u9762\u7684\u4f4d\u7f6e\u4e3a $p$ \uff0c\u5219 $[p + 1...i,i]$ \u8fd9\u4e9b\u533a\u95f4\u90fd\u662f\u4ee5 $a[i]$ \u4e3a\u6700\u5c0f\u503c\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\u4f60\u53ef\u4ee5\u4ece $dp[p...i - 1]$ \u8f6c\u79fb\u8fc7\u6765\uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u8f6c\u79fb\u76f8\u5f53\u4e8e\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u540e\u9762\u63d2\u5165\u4e00\u6bb5\u3002\u5728\u8fd9\u4e4b\u524d\u7684\u6700\u5c0f\u503c\u90fd\u548c $a[i]$ \u6ca1\u5173\u7cfb\uff01\uff01\u6240\u4ee5\u76f4\u63a5\u7ee7\u627f $dp[p][op]$ \u5c31\u662f\u8d21\u732e\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u73a9\u610f\u5c31\u7b49\u4ef7\u4e8e\u524d\u9762\u7684 $\\sum dp[k][op \\text{ xor } 1] \\times \\min $\u3002\n\n\u6700\u540e\u6839\u636e $n$ \u7684\u5947\u5076\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa $dp[n][0/1]$ \u5bf9\u5e94\u7684\u5947\u5076\u6027\uff0c\u4e5f\u5c31\u662f $n - 2\\times k$ \u548c $n - (2\\times k + 1)$ \u7684\u5947\u5076\u6027\uff0c\u7528\u5076\u7684\u51cf\u53bb\u5947\u7684\u5373\u53ef\u3002\n\n\n``` cpp\n#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=(a);i<=(b);++i)\n#define Rep(i,a,b) for(int i=(a);i<(b);++i)\n#define rrep(i,a,b) for(int i=(a);i>=(b);--i)\nusing namespace std;\ntemplate <typename T>\ninline void read(T &x){\n    x=0;char ch=getchar();bool f=0;\n    while(ch<'0'||ch>'9'){if(ch=='-')f=1;ch=getchar();}\n    while(ch>='0'&&ch<='9')x=(x<<1)+(x<<3)+(ch^48),ch=getchar();\n    if(f)x=-x;\n}\ntemplate <typename T,typename ...Args>\ninline void read(T &tmp,Args &...tmps){read(tmp);read(tmps...);}\nconst int N = 5e5 + 5;\nconst int mod = 998244353;\ninline void add(int &x,int y){\n    if((x += y) >= mod)x -= mod;\n}\nvector<int>S;\nint dp[N][2],s[N][2];\nint a[N],n;\nsigned main(){\n    read(n);\n    rep(i,1,n)read(a[i]);\n    dp[0][0] = s[0][0] = 1;\n    rep(i,1,n){\n        while(!S.empty() && a[S.back()] >= a[i])S.pop_back();\n        if(S.empty()){\n            for(int x : {0,1})dp[i][x] = 1ll * s[i - 1][x ^ 1] * a[i] % mod;\n        }\n        else{\n            for(int x : {0,1})dp[i][x] = (dp[S.back()][x] + 1ll * (s[i - 1][x ^ 1] - s[S.back() - 1][x ^ 1] + mod) * a[i] % mod) % mod;\n        }\n        S.push_back(i);\n        s[i][0] = (s[i - 1][0] + dp[i][0]) % mod;\n        s[i][1] = (s[i - 1][1] + dp[i][1]) % mod;\n    }\n    int ans = (dp[n][0] - dp[n][1] + mod) % mod;\n    if(n & 1)ans = 1ll * ans * (mod - 1) % mod;\n    printf(\"%d\",ans);\n}\n```",
        "postTime": 1669282277,
        "uid": 141058,
        "name": "Xu_brezza",
        "ccfLevel": 0,
        "title": "AT_arc115_e [ARC115E] LEQ and NEQ \u9898\u89e3"
    },
    {
        "content": "\u4e00\u773c $\\tt dp$\uff0c\u8003\u8651 $dp_{i,j}$ \u4e3a\u5df2\u7ecf $\\tt dp$ \u5230\u7b2c $i$ \u4f4d\uff0c\u4e0a\u4e00\u4f4d\u662f $j$ \u7684\u65b9\u6848\u6570\u3002\n\n\u8003\u8651\u8f6c\u79fb\uff1a\n\n$$\n\\begin{aligned}\ndp_{i,j}&=\\displaystyle\\sum_{k=1}^{A_{i-1}}[k\\ne j]dp_{i-1,k}\\\\\n&=\\displaystyle\\sum_{k=1}^{A_{i-1}}dp_{i-1,k}-dp_{i-1,j}\n\\end{aligned}\n$$\n\n\u8fd9\u662f\u65f6\u7a7a $\\mathcal O(nv)$ \u7684\uff0c\u7a7a\u95f4\u53ef\u4ee5\u901a\u8fc7\u6eda\u52a8\u6570\u7ec4\u4f18\u5316\u81f3 $O(v)$\u3002\n\n\u6211\u4eec\u5e76\u4e0d\u6ee1\u8db3\u4e8e\u6b64\uff0c\u8003\u8651\u7528\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u5f53\u524d\u7684 $dp$\u3002\uff08\u6ce8\u610f\u5230\u56e0\u4e3a\u6eda\u52a8\u6570\u7ec4\uff0c\u6240\u4ee5\u5b83\u662f\u4e00\u7ef4\uff09\n\n\u8003\u8651\u5177\u4f53\u7684 $\\tt dp$ \u5b9e\u73b0\u3002\n\n+ \u521d\u59cb\u5316\uff1a$dp_i=[i\\le A_1]$\u3002\n+ \u8f6c\u79fb\uff1a\u679a\u4e3e $i\\in[2,n]$\u3002\n+ \u8bb0\u5f55 $S=\\displaystyle\\sum_{i=1}^{A_{i-1}}dp_i$\u3002\n+ $\\forall i\\in[1,A_{i-1}],dp_i\\gets-dp_i$\u3002\n+ $\\forall i\\in[1,A_i],dp_i\\gets dp_i+S$\u3002\uff08\u6267\u884c\u540e\u5df2\u7ecf\u5b8c\u6210\u8f6c\u79fb\u67ff\u5b50\uff09\n+ $\\forall i\\in(A_i,\\infty),dp_i=0$\u3002\uff08\u6e05\u7a7a\u4fbf\u4e8e\u4e0b\u6b21\u8f6c\u79fb\uff09\n+ \u8f6c\u79fb\u5df2\u7ecf\u5b8c\u6210\u3002\n\n\u533a\u95f4\u53d6\u8d1f\uff0c\u533a\u95f4\u6e05\u96f6\uff0c\u533a\u95f4\u52a0\u2026\u8fd9\u542f\u793a\u6211\u4eec\u4f7f\u7528\u7ebf\u6bb5\u6811\u3002\u7ebf\u6bb5\u6811\u9700\u8981\u652f\u6301\u52a0\u6cd5\uff08\u533a\u95f4\u52a0\uff09\u548c\u4e58\u6cd5\uff08\u533a\u95f4\u4e58 $-1$\uff0c\u533a\u95f4\u4e58 $0$\uff09\u3002\n\n\u4f60\u8fd8\u8981\u79bb\u6563\u5316\uff1f\uff1f\u6211\u4eec\u9996\u5148\u6b63\u5e38\u7684\u79bb\u6563\u5316\uff0c\u7136\u540e\u8003\u8651\u79bb\u6563\u5316\u540e\u8d21\u732e\u53d1\u751f\u7684\u53d8\u5316\u3002\u5bf9\u4e8e\u65b0\u7684 $a_{1\\cdot\\cdot n}$\uff0c$a_i$ \u7684\u521d\u59cb\u8d21\u732e\u8981\u4e58\u4e0a $A_i-A_{i-1}$\u3002\u7136\u540e\u5bf9\u4e8e\u539f\u6765 $i$ \u4f4d\u7f6e\u7684\u503c\u662f $val$\uff0c$i$ \u4f4d\u7f6e\u7684\u5b9e\u9645\u503c\u5c31\u662f $val\\times(A_i-A_{i-1})$\u3002\u8fd9\u4e2a\u6539\u6539\u7ebf\u6bb5\u6811\u5373\u53ef\u3002\n\n\u4ee3\u7801\u5176\u5b9e\u633a\u597d\u5199\u7684\uff0c\u56e0\u4e3a\u8d5b\u65f6\u5199\u4e86\u4e00\u4e2a\u628a\u4e09\u4e2a\u539f\u59cb\u64cd\u4f5c\u878d\u5408\u8d77\u6765\u7684\u7ebf\u6bb5\u6811\uff0c\u4e09\u4e2a $\\tt tag$ \u51fa\u4e86\u7ec6\u8282\u95ee\u9898\u6ca1\u8c03\u51fa\u6765/kk\n\n```cpp\n#define rep(i,a,b) for(int i = (a);i <= (b);++i)\n#define Rep(i,a,b) for(int i = (a);i >= (b);--i)\n\nconst ll mod = 998244353;\nconst int N = 1e6 + 5;\n\nint n,k; ll a[N],b[N],val[N];\n\nnamespace ST{\n\tconst int S = N << 2;\n\t\n\tll sum[S],cnt[S],ta[S]; char tm[S];\n\t\n\t#define lc (i << 1)\n\t#define rc (i << 1 | 1)\n\t#define mid ((L + R) >> 1)\n\t#define now i,L,R\n\t#define ls lc,L,mid\n\t#define rs rc,mid + 1,R\n\t#define id int i = 1,int L = 1,int R = k + 1\n\t#define psu sum[i] = (sum[lc] + sum[rc]) % mod\n\t\n\tvoid Add(int i,ll x){\n\t\t(ta[i] += x) %= mod;\n\t\t(sum[i] += cnt[i] * x % mod) %= mod;\n\t}\n\t\n\tvoid Mul(int i,ll x){\n\t\t(tm[i] *= x) %= mod;\n\t\t(ta[i] *= x) %= mod;\n\t\t(sum[i] *= x) %= mod;\n\t\tif(sum[i] < 0) sum[i] += mod;\n\t}\n\t\n\tvoid psd(int i){\n\t\tif(!i) return;\n\t\tMul(lc,tm[i]); Mul(rc,tm[i]);\n\t\tAdd(lc,ta[i]); Add(rc,ta[i]);\n\t\ttm[i] = 1; ta[i] = 0;\n\t}\n\t\n\tvoid build(id){\n\t\ttm[i] = 1; ta[i] = 0;\n\t\tif(L == R){\n\t\t\tcnt[i] = val[L];\n\t\t\tif(L <= a[1]) sum[i] = val[L];\n\t\t\treturn;\n\t\t}\n\t\tbuild(ls); build(rs); psu; cnt[i] = (cnt[lc] + cnt[rc]) % mod;\n\t}\n\t\n\tvoid add(int l,int r,ll x,id){\n\t\tif(l <= L && R <= r) return Add(i,x); psd(i);\n\t\tif(l <= mid) add(l,r,x,ls);\n\t\tif(r > mid) add(l,r,x,rs); psu;\n\t}\n\t\n\tvoid mul(int l,int r,ll x,id){\n\t\tif(l <= L && R <= r) return Mul(i,x); psd(i);\n\t\tif(l <= mid) mul(l,r,x,ls);\n\t\tif(r > mid) mul(l,r,x,rs); psu;\n\t}\n\t\n\tll qry(int l,int r,id){\n\t\tif(l <= L && R <= r) return sum[i]; psd(i);\n\t\tll res = 0;\n\t\tif(l <= mid) res = qry(l,r,ls);\n\t\tif(r > mid) (res += qry(l,r,rs)) %= mod;\n\t\treturn res;\n\t}\n}\n\nint main(){\n\tscanf(\"%d\",&n);\n\trep(i,1,n) scanf(\"%lld\",a + i),b[i] = a[i];\n\tsort(b + 1,b + n + 1);\n\tk = unique(b + 1,b + n + 1) - b - 1;\n\trep(i,1,n) a[i] = lower_bound(b + 1,b + k + 1,a[i]) - b;\n\trep(i,1,k) val[i] = b[i] - b[i - 1];\n\tST::build();\n\trep(i,2,n){\n\t\tll sum = ST::qry(1,a[i - 1]);\n\t\tST::mul(1,a[i - 1],-1);\n\t\tST::add(1,a[i],sum);\n\t\tST::mul(a[i] + 1,k + 1,0);\n\t}\n\tprintf(\"%lld\\n\",ST::qry(1,n));\n\treturn 0;\n}\n```",
        "postTime": 1658232779,
        "uid": 368107,
        "name": "xfrvq",
        "ccfLevel": 7,
        "title": "ARC115E LEQ and NEQ"
    }
]