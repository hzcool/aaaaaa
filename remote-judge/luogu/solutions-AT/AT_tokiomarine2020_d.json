[
    {
        "content": "\u4e00\u773c\u80cc\u5305\u3002\u4f46\u662f\u8c01\u544a\u8bc9\u4f60\u80cc\u5305\u53ea\u80fd DP \u505a\u7684\u3002\n\n\u8003\u8651\u5bf9\u6bcf\u4e2a\u70b9\u4ece\u4e0b\u5230\u4e0a\u505a\u80cc\u5305\u3002\u8bbe\u6811\u9ad8\u4e3a $h$\uff0c\u5219\u590d\u6742\u5ea6\u4e3a $O(q\\times h\\times m)$\uff0c$m$ \u4e3a\u80cc\u5305\u5927\u5c0f\u3002\n\n\u53d1\u73b0\u5982\u679c\u7528 DP \u65b9\u5f0f\u6c42\uff0c\u5219\u4e00\u5b9a\u81f3\u5c11\u6709 $O(q\\times m)$ \u7684\u590d\u6742\u5ea6\u3002\u800c\u53c8\u53d1\u73b0\u7269\u54c1\u6570\u5f88\u5c11\u3002\u76f4\u63a5\u7206\u641c $O(q\\times 2^h)$\u3002\n\n$h$ \u592a\u5927\u4e86\u3002\u8003\u8651\u4e00\u79cd\u7c7b\u4f3c\u53cc\u5411\u641c\u7d22\u7684\u65b9\u6cd5\u3002\n\n\u8fdb\u884c\u6839\u53f7\u5206\u6cbb\uff1a\u5bf9\u4e8e\u6df1\u5ea6 $<10$ \u7684\u70b9\uff0c\u76f4\u63a5 $O(2^h)$ \u66b4\u529b\uff0c\u5426\u5219\u5148\u9884\u5904\u7406\u51fa\u6df1\u5ea6\u4e3a $10$ \u7684\u60c5\u51b5\uff0c\u7136\u540e\u67e5\u8be2\u65f6\u7206\u641c\u76f4\u5230\u6df1\u5ea6\u4e3a $10$ \u7684\u70b9\u3002\u7ed3\u5408\u4e00\u4e0b\u5904\u7406\u51fa\u7b54\u6848\u3002\n\n\u8fd9\u91cc\u6709\u4e24\u79cd\u5b9e\u73b0\u65b9\u5f0f\u3002\u4e00\u662f DP\uff0c\u65f6\u7a7a\u590d\u6742\u5ea6 $O((m+q)\\times\\sqrt n)$\u3002\u697c\u4e0a\u5927\u4f6c\u5df2\u7ecf\u8bb2\u8fc7\u4e86\u3002\u4e8c\u662f\u641c\u7d22\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n+q\\times\\sqrt n\\times\\log n)$\uff0c\u7a7a\u95f4 $O(n)$\u3002\u591a\u51fa\u6765\u7684\u5728\u4e8e\u4e8c\u5206\uff0c\u5e38\u6570\u5f88\u5c0f\uff0c\u5177\u4f53\u53ef\u4ee5\u770b\u4ee3\u7801\u5b9e\u73b0\u3002\n\ncode\uff1a\n\n```cpp\nint n,m,dep[N],w[N],c[N];\nvector<pii> pre[1027];\nvector<int> g[1027],h[1027];\nvoid init(int u,int sw,int sc){\n\tif(dep[u]==10){\n\t\tfor(int i=0;i<=1;i++){\n\t\t\tif(sw+i*w[u]>1e5){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tpre[u].push_back(make_pair(sw+i*w[u],sc+i*c[u]));//\u5904\u7406\u51fa\u6bcf\u79cd\u60c5\u51b5\u4e0b\u6743\u91cd\u548c\u4ef7\u503c\n\t\t}\n\t\treturn;\n\t}\n\tfor(int i=0;i<=1;i++){\n\t\tfor(int j=0;j<=1;j++){\n\t\t\tif(sw+j*w[u]>1e5||(u<<1|i)>n){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tinit(u<<1|i,sw+j*w[u],sc+j*c[u]);\n\t\t}\n\t}\n}\nint dfs1(int u,int sw,int sc){\n\tif(!u){\n\t\treturn sc;\n\t}\n\tint ans=0;\n\tfor(int i=0;i<=1;i++){\n\t\tif(i*w[u]>sw){\n\t\t\tcontinue;\n\t\t}\n\t\tans=max(ans,dfs1(u>>1,sw-i*w[u],sc+i*c[u]));\n\t}\n\treturn ans;\n}\nint dfs2(int u,int sw,int sc){\n\tif(dep[u]==10){\n\t\tint x=upper_bound(g[u].begin(),g[u].end(),sw)-g[u].begin()-1;//\u627e\u5230\u6700\u5927\u7684\u80fd\u4ea7\u751f\u8d21\u732e\u7684\u4f4d\u7f6e\n\t\treturn sc+h[u][x];\n\t}\n\tint ans=0;\n\tfor(int i=0;i<=1;i++){\n\t\tif(i*w[u]>sw){\n\t\t\tcontinue;\n\t\t}\n\t\tans=max(ans,dfs2(u>>1,sw-i*w[u],sc+i*c[u]));\n\t}\n\treturn ans;\n}\nvoid solve(){\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%d%d\",&c[i],&w[i]);\n\t\tdep[i]=dep[i>>1]+1;\n\t}\n\tinit(1,0,0);\n\tfor(int i=1<<9;i<=min(n,(1<<10)-1);i++){\n\t\tsort(pre[i].begin(),pre[i].end());//\u6309\u6743\u91cd\u6392\u5e8f\n\t\tg[i].push_back(0);\n\t\th[i].push_back(0);\n\t\tfor(pii j:pre[i]){//\u5904\u7406\u51fa\u53ef\u80fd\u4ea7\u751f\u8d21\u732e\u7684\u503c\uff0c\u7528\u4e86\u7c7b\u4f3c\u5355\u8c03\u961f\u5217\u7684\u601d\u8def\n\t\t\tif(j.second<h[i].back()){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(j.first==g[i].back()){\n\t\t\t\tg[i].pop_back();\n\t\t\t\th[i].pop_back();\n\t\t\t}\n\t\t\tg[i].push_back(j.first);\n\t\t\th[i].push_back(j.second);\n\t\t}\n\t}\n\tscanf(\"%d\",&m);\n\tfor(int i=1,x,y;i<=m;i++){\n\t\tscanf(\"%d%d\",&x,&y);\n\t\tif(dep[x]<10){\n\t\t\tprintf(\"%d\\n\",dfs1(x,y,0));\n\t\t}else{\n\t\t\tprintf(\"%d\\n\",dfs2(x,y,0));\n\t\t}\n\t}\n}\nsigned main(){\n\tint t=1;\n\t//\tscanf(\"%d\",&t);\n\twhile(t--)solve();\n}\n```",
        "postTime": 1680703088,
        "uid": 740322,
        "name": "_Ritsu_",
        "ccfLevel": 0,
        "title": "AT_tokiomarine2020_d"
    },
    {
        "content": "\u5e38\u89c1\u6c42\u89e3\u80cc\u5305\u6709 $O(p\\times L)$ \u7684 dp \u505a\u6cd5\u548c $O(2^p)$ \u7684\u72b6\u538b\u505a\u6cd5\uff08$p$ \u4e3a\u7269\u54c1\u4ef6\u6570\uff09\uff0c\u76f4\u63a5\u505a\u90fd\u8fc7\u4e0d\u4e86\uff0c\u9700\u8981\u8003\u8651\u4f18\u5316\u3002\n\n\u51cf\u5c0f\u503c\u57df\u662f\u4e0d\u592a\u53ef\u884c\u7684\uff0c\u6211\u4eec\u8003\u8651\u51cf\u5c11\u6bcf\u6b21\u8be2\u95ee\u5173\u8054\u7684\u70b9\u6570\u3002\u7531\u4e8e\u4e00\u6b21\u8be2\u95ee\u7684\u8fc7\u7a0b\u662f\u5728\u4e0d\u65ad\u5f80\u4e0a\u8df3\u7956\u5148\u8282\u70b9\uff0c\u90a3\u4e48\u95ee\u9898\u8f6c\u6362\u6210\u8ba9\u6700\u591a\u8981\u8df3\u7684\u5c42\u6570\u5c3d\u91cf\u5c0f\u3002\n\n\u56e0\u4e3a\u4e00\u68f5 $n$ \u4e2a\u70b9\uff0c$k$ \u5c42\u7684\u5b8c\u5168\u4e8c\u53c9\u6811\u7684\u524d $\\frac k2$ \u5c42\u53ea\u6709 $\\sqrt n$ \u4e2a\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 $O(\\sqrt n\\times L)$ \u7684\u65f6\u95f4\u628a\u8fd9\u4e9b\u70b9\u6709 $L$ \u7684\u5bb9\u79ef\u65f6\u7684\u7b54\u6848 $f_{x,L}$ \u9884\u5904\u7406\u51fa\u6765\u3002\u5bf9\u4e8e\u5269\u4e0b\u7684 $n-\\sqrt n$ \u4e2a\u6df1\u5ea6\u5927\u4e8e $\\frac k2$ \u7684\u70b9\uff0c\u76f4\u63a5\u5728\u7ebf\u505a\uff0c\u53ef\u4ee5\u7528 $O(2^{\\frac k2})=O(\\sqrt n)$ \u7684\u65f6\u95f4\u7b97\u51fa\u7b54\u6848\u3002\n\n\u603b\u590d\u6742\u5ea6 $O(\\sqrt n \\times L+\\sqrt n\\times q)$\u3002\n\n```cpp\n#include<math.h>\n#include<stdio.h>\n#include<string.h>\n#include<algorithm>\n\ninline int read()\n{\n\tint v=0,flag=0;char ch=getchar();\n\twhile('0'>ch||ch>'9') flag|=ch=='-',ch=getchar();\n\twhile('0'<=ch&&ch<='9') v=v*10+(ch&15),ch=getchar();\n\treturn flag? -v:v;\n}\n\nint n,m,v[1<<18],w[1<<18];\nint f[1000][100005];\n\ninline void dfs(int x,int dep)\n{\n\tif(x>n||dep>9) return;\n\n\tfor(int i=0;i<=1e5;i++) f[x][i]=f[x>>1][i];\n\tfor(int i=1e5;i>=w[x];i--)\n\t\tf[x][i]=std::max(f[x][i],f[x][i-w[x]]+v[x]);\n\n\tdfs(x<<1,dep+1),dfs(x<<1|1,dep+1);\n}\n\ninline int brute(int x,int remain)\n{\t\n\tif(x<512) return f[x][remain];\n\n\tint ret=0;\n\tif(remain>=w[x])\n\t\tret=std::max(ret,v[x]+brute(x>>1,remain-w[x]));\n\tret=std::max(ret,brute(x>>1,remain));\n\treturn ret;\n}\n\nint main()\n{\n\t#ifndef ONLINE_JUDGE\n\tfreopen(\"input.in\",\"r\",stdin);\n\tfreopen(\"output.out\",\"w\",stdout);\n\t#endif\n\n\tn=read();\n\tfor(int i=1;i<=n;i++) v[i]=read(),w[i]=read();\n\n\tdfs(1,1);\n\n\tm=read();\n\twhile(m--)\n\t{\n\t\tint v=read(),L=read();\n\t\tprintf(\"%d\\n\",brute(v,L));\n\t}\n}\n```\n",
        "postTime": 1678847035,
        "uid": 363730,
        "name": "Mr_Avalon",
        "ccfLevel": 6,
        "title": "\u9898\u89e3 tokiomarine2020d \u3010Knapsack Queries on a tree\u3011"
    }
]