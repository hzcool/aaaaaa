[
    {
        "content": "\u597d\u50cf\u4e5f\u662f\u4e2a\u5e38\u89c1\u5957\u8def\u3002\n\n\u6ce8\u610f\u5230 $nm\\leq 10^6$\uff0c\u53ef\u4ee5\u7528 $m+2$ \u4e2a\u5e03\u5c14\u53d8\u91cf\u6765\u523b\u753b\u4e00\u4e2a\u53d8\u91cf\uff1a$v_{i,j}=[a_i\\geq j]$\u3002\n\n\u7136\u540e\u8003\u8651\u9650\u5236\uff1a\n\n\u5f53 $v_{i,j}=1$ \u65f6\uff0c\n\n- $v_{i,j-1}=1$\uff1b\n- \u9650\u5236\uff0c\u5bf9\u4e8e\u9650\u5236 $(i,x,L,R)$\uff0c$v_{x,L-j+1}=0$\uff1b\n\n\u5f53 $v_{i,j}=0$ \u65f6\uff0c\n\n- $v_{i,j+1}=0$\uff1b\n- \u5bf9\u4e8e\u9650\u5236 $(i,x,L,R)$\uff0c$v_{x,R-j+1}=1$\uff1b\n\n\u540c\u65f6\u9700\u8981\u5f3a\u5236 $v_{i,0}=1$\uff0c$v_{i,m+1}=0$\u3002\u5747\u4e3a $\\leq 2$ \u4e2a\u53d8\u91cf\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u4ece\u800c\u5efa 2-SAT \u89e3\u51b3\u5373\u53ef\u3002\n\n```cpp\nconst int V = 0xAA5100, E = 0xAE3803;\nstruct Edge {\n    int to, nxt;\n    Edge() {\n        nxt = -1;\n    }\n};\nint n, hd[V], pnt, m, q, dfn[V], low[V], stk[V], stktop, _time, sccid[V], scccnt, ans[V];\nEdge e[E];\n\ninline void AddEdge(int u, int v) {\n    e[++pnt].to = v;\n    e[pnt].nxt = hd[u];\n    hd[u] = pnt;\n}\n\ninline void Read() {\n    n = qread(); m = qread(); q = qread(); m++;\n    for (int i = 1;i <= n;i++) {\n        for (int j = 1;j <= m;j++) {\n            AddEdge((i - 1) * (m + 1) + j + 1, (i - 1) * (m + 1) + j);\n            AddEdge((i - 1) * (m + 1) + j + n * (m + 1), (i - 1) * (m + 1) + j + 1 + n * (m + 1));\n        }\n        AddEdge((i - 1) * (m + 1) + 1 + n * (m + 1), (i - 1) * (m + 1) + 1);\n        AddEdge(i * (m + 1), i * (m + 1) + n * (m + 1));\n    }\n    for (int i = 1;i <= q;i++) {\n        int x = qread(), y = qread(), l = qread(), r = qread();\n        l += 2; r += 2;\n        for (int j = 1;j <= m + 1;j++) {\n            if (l - j + 1 > m + 1) {\n                AddEdge((x - 1) * (m + 1) + j + n * (m + 1), (x - 1) * (m + 1) + j);\n                AddEdge((y - 1) * (m + 1) + j + n * (m + 1), (y - 1) * (m + 1) + j);\n            } else if (l - j + 1 > 0) {\n                AddEdge((x - 1) * (m + 1) + j + n * (m + 1), (y - 1) * (m + 1) + l - j + 1);\n                AddEdge((y - 1) * (m + 1) + j + n * (m + 1), (x - 1) * (m + 1) + l - j + 1);\n            }\n            if (r - j + 1 <= 0) {\n                AddEdge((x - 1) * (m + 1) + j, (x - 1) * (m + 1) + j + n * (m + 1));\n                AddEdge((y - 1) * (m + 1) + j, (y - 1) * (m + 1) + j + n * (m + 1));\n            } else if (r - j + 1 <= m + 1) {\n                AddEdge((x - 1) * (m + 1) + j, (y - 1) * (m + 1) + r - j + 1 + n * (m + 1));\n                AddEdge((y - 1) * (m + 1) + j, (x - 1) * (m + 1) + r - j + 1 + n * (m + 1));\n            }\n        }\n    }\n}\n\ninline void Tarjan(int u) {\n    dfn[u] = low[u] = ++_time;\n    stk[++stktop] = u;\n    for (int i = hd[u];~i;i = e[i].nxt) {\n        if (!dfn[e[i].to]) {\n            Tarjan(e[i].to);\n            low[u] = min(low[u], low[e[i].to]);\n        } else if (!sccid[e[i].to]) low[u] = min(low[u], dfn[e[i].to]);\n    }\n    if (low[u] >= dfn[u]) {\n        scccnt++;\n        for (;;) {\n            int x = stk[stktop]; stktop--;\n            sccid[x] = scccnt;\n            if (x == u) break;\n        }\n    }\n}\n\ninline void Solve() {\n    for (int i = 1;i <= n;i++) {\n        for (int j = 1;j <= m + 1;j++) {\n            if (sccid[(i - 1) * (m + 1) + j] == sccid[(i - 1) * (m + 1) + j + n * (m + 1)]) {\n                cout << -1 << endl;\n                return;\n            }\n            if (sccid[(i - 1) * (m + 1) + j] > sccid[(i - 1) * (m + 1) + j + n * (m + 1)]) {\n                ans[i] = j - 1;\n                break;\n            }\n        }\n    }\n    for (int i = 1;i <= n;i++) cout << ans[i] - 1 << \" \";\n    cout << endl;\n}\n\nint main() {\n    memset(hd, -1, sizeof(hd));\n    Read();\n    for (int i = 1;i <= 2 * n * (m + 1);i++) {\n        if (!dfn[i]) Tarjan(i);\n    }\n    Solve();\n    return 0;\n}\n```",
        "postTime": 1669126440,
        "uid": 61088,
        "name": "Solystic",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 [ABC277Ex] Constrained Sums"
    },
    {
        "content": "[link](https://www.luogu.com.cn/problem/AT_abc277_h)\n\n# \u601d\u8def\n\n## $\\text{Step 1}$\n\n\u7ed3\u8bba\uff1a\n\n$L\\le x_i+x_j\\iff \\forall t\\in\\mathbb{Z},t\\le x_i\\lor L-t+1\\le x_j$\u3002\n\n$x_i+x_j\\le R\\iff \\forall t\\in\\mathbb{Z},t>x_i\\lor R-t+1>x_j$\u3002\n\n---\n\n\u8bc1\u660e\uff1a\n\n\u82e5 $\\exists t\\in\\mathbb{Z},t>x_i\\land L-t+1>x_j$\uff0c\n\n\u5219\u6709 $\\exists t\\in\\mathbb{Z},t\\ge x_i+1\\land L-t+1\\ge x_j+1$\uff0c\n\n\u4e24\u5f0f\u76f8\u52a0\uff0c\u5f97 $L-1\\ge x_i+x_j$ \u5373 $L> x_i+x_j$\u3002\n\n\u6545 $\\exists t\\in\\mathbb{Z},t>x_i\\land L-t+1>x_j\\Longrightarrow L>x_i+x_j$\n\n---\n\n\u82e5 $L>x_i+x_j$\uff0c\n\n\u5f53 $t=x_i+1$ \u65f6\uff0c\u6ee1\u8db3 $t>x_i\\land L-t+1>x_j$\u3002\n\n\u6545 $L>x_i+x_j\\Longrightarrow\\exists t\\in\\mathbb{Z},t>x_i\\land L-t+1>x_j$\u3002\n\n---\n\n\u7efc\u4e0a $L>x_i+x_j\\iff\\exists t\\in\\mathbb{Z},t>x_i\\land L-t+1>x_j$\u3002\n\n\u4e8e\u662f $L\\le x_i+x_j\\iff\\forall t\\in\\mathbb{Z},t\\le x_i\\lor L-t+1\\le x_j$\u3002\n\n---\n\n\u540c\u7406\u53ef\u8bc1\uff1a$x_i+x_j\\le R\\iff \\forall t\\in\\mathbb{Z},t>x_i\\lor R-t+1>x_j$\u3002\n\n## $\\text{Step 2}$\n\n\u8fd9\u6837\u201c\u6216\u201d\u7684\u547d\u9898\u8003\u8651 $\\text{2-sat}$\u3002\n\n\u5efa\u7acb $bool$ \u53d8\u91cf\uff1a\u53d8\u91cf $(i,j)$ \u8868\u793a $j\\le x_i$ \u662f\u5426\u4e3a\u771f\u3002\n\n\u56e0\u4e3a $\\forall j\\in(-\\inf,0],j\\le x_i$ \u90fd\u4e00\u5b9a\u4e3a\u771f\uff0c\u6240\u4ee5\u53ef\u4ee5\u538b\u7f29\u4e3a\u4e00\u4e2a\u94a6\u5b9a\u4e3a\u771f\u7684\u70b9\uff08\u7528\u8be5\u53d8\u91cf\u4e3a\u5047\u6307\u5411\u4e3a\u771f\uff09\u3002\n\n\u540c\u7406\uff0c$\\forall j\\in[m+1,\\inf),j\\le x_i$ \u90fd\u4e00\u5b9a\u4e3a\u5047\uff0c\u4e5f\u53ef\u4ee5\u538b\u7f29\u4e3a\u4e00\u4e2a\u70b9\u3002\n\n\u56e0\u6b64\uff0c\u53ea\u7528\u8ba8\u8bba $j\\in[1,m]$\uff0c\u603b\u53d8\u91cf\u6570\u4e3a $O(nm)$\u3002\n\n\u5efa\u8fb9\u65f6\u9996\u5148\u8981\u6839\u636e\u5b9a\u4e49\u5efa $(i,j,1)\\rightarrow(i,j-1,1)$ \u4ee5\u53ca $(i,j,0)\\rightarrow(i,j+1,0)$\u3002\u6bcf\u6b21\u6dfb\u52a0\u9650\u5236\u904d\u5386 $t\\in[1,m]$ \u8fde\u8fb9\u3002\u603b\u8fb9\u6570 $O((n+q)m)$\u3002\n\n\u7136\u540e\u8dd1 $\\text{2-sat}$ \u6a21\u677f\u5c31\u597d\u4e86\u3002\n\n# \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e4+7,M=2e6+7;\nint n,m,q,dfn_cnt,scc_cnt,top,dfn[M],low[M],stk[M],scc[M],maxx[N];\nbool vis[M];\nvector<int> G[M];\ninline int id(int x,int y,int z){return z*(m+2)*n+(y-1)*(m+2)+x+1;}\nvoid tarjan(int u)\n{\n\tdfn[u]=low[u]=++dfn_cnt;\n\tstk[++top]=u,vis[u]=1;\n\tfor(int v:G[u])\n\t{\n\t\tif(!dfn[v])\n\t\t{\n\t\t\ttarjan(v);\n\t\t\tlow[u]=min(low[u],low[v]);\n\t\t}\n\t\telse if(vis[v])\n\t\t\tlow[u]=min(low[u],dfn[v]);\n\t}\n\tif(dfn[u]==low[u])\n\t{\n\t\t++scc_cnt;\n\t\tfor(int t=-1;t!=u;)\n\t\t{\n\t\t\tt=stk[top--];\n\t\t\tvis[t]=0;\n\t\t\tscc[t]=scc_cnt;\n\t\t}\n\t}\n}\nint main()\n{\n\tios::sync_with_stdio(0),cin.tie(0);\n\tint i,j,L,R,x,y,tot;\n\tcin>>n>>m>>q;\n\tfor(i=1;i<=n;++i)\n\t{\n\t\tG[id(0,i,0)].push_back(id(0,i,1));\n\t\tG[id(m+1,i,1)].push_back(id(m+1,i,0));\n\t\tfor(j=1;j<=m+1;++j)\n\t\t{\n\t\t\tG[id(j,i,1)].push_back(id(j-1,i,1));\n\t\t\tG[id(j-1,i,0)].push_back(id(j,i,0));\n\t\t}\n\t}\n\twhile(q--)\n\t{\n\t\tcin>>i>>j>>L>>R;\n\t\tfor(x=1;x<=m;++x)\n\t\t{\n\t\t\ty=min(m+1,max(0,L+1-x));\n\t\t\tG[id(x,i,0)].push_back(id(y,j,1));\n\t\t\tG[id(y,j,0)].push_back(id(x,i,1));\n\t\t\tG[id(x,j,0)].push_back(id(y,i,1));\n\t\t\tG[id(y,i,0)].push_back(id(x,j,1));\n\t\t}\n\t\tfor(x=1;x<=m;++x)\n\t\t{\n\t\t\ty=min(m+1,max(0,R+1-x));\n\t\t\tG[id(x,i,1)].push_back(id(y,j,0));\n\t\t\tG[id(y,j,1)].push_back(id(x,i,0));\n\t\t\tG[id(x,j,1)].push_back(id(y,i,0));\n\t\t\tG[id(y,i,1)].push_back(id(x,j,0));\n\t\t}\n\t}\n\ttot=(m+2)*n*2;\n\tfor(i=1;i<=tot;++i)\n\t\tif(!dfn[i]) tarjan(i);\n\tfor(i=1;i<=n;++i)\n\t{\n\t\tfor(j=0;j<=m+1;++j)\n\t\t{\n\t\t\tif(scc[id(j,i,0)]==scc[id(j,i,1)])\n\t\t\t\tgoto gg;\n\t\t\tif(scc[id(j,i,1)]<scc[id(j,i,0)])\n\t\t\t\tmaxx[i]=j;\n\t\t}\n\t}\n\tfor(i=1;i<=n;++i)\n\t\tcout<<maxx[i]<<' ';\n\treturn 0;\n\tgg:return cout<<\"-1\\n\",0;\n}\n\n```\n",
        "postTime": 1668413068,
        "uid": 372162,
        "name": "jrxxx",
        "ccfLevel": 7,
        "title": "ABC277Ex 2-SAT"
    }
]