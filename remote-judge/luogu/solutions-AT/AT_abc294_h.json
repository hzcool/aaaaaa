[
    {
        "content": "\u6709\u65f6\u5019\u6211\u4eec\u5e94\u5f53\u5bf9\u81ea\u5df1\u6709\u4fe1\u5fc3\uff0c$10^9$ \u4e5f\u53ef\u80fd\u53ef\u4ee5\u8fc7\u3002\n\n\u8003\u8651\u4e00\u4e2a\u663e\u800c\u6613\u89c1\u7684\u5bb9\u65a5\uff1a\u679a\u4e3e\u8fb9\u96c6\u7684\u4e00\u4e2a\u5927\u5c0f\u4e3a $m(0 \\leq m \\leq M)$ \u7684\u5b50\u96c6\uff0c\u539f\u56fe\u4e2d\u53ea\u4fdd\u7559\u8be5\u5b50\u96c6\u5185\u7684\u8fb9\uff0c\u82e5\u6709 $c$ \u4e2a\u8fde\u901a\u5757\uff0c\u90a3\u4e48\u5bf9\u7b54\u6848\u7684\u8d21\u732e\u4e3a $K^c\\times(-1)^m$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(2^M(N+M))$\uff0c\u65e0\u6cd5\u901a\u8fc7\u6b64\u9898\u3002\n\n\u8003\u8651\u4f7f\u7528 dfs\uff0c\u82e5\u524d $i-1$ \u6761\u8fb9\u7684\u5b58\u5728\u4e0e\u5426\u5df2\u7ecf\u786e\u5b9a\uff0c\u90a3\u4e48\u76f4\u63a5\u679a\u4e3e\u7b2c $i$ \u6761\u8fb9\u5b58\u5728\u4e0e\u5426\uff0c\u518d\u5206\u522b\u641c\u7d22\u3002\u4e0d\u4f7f\u7528\u8def\u5f84\u538b\u7f29\uff0c\u65b9\u4fbf\u5220\u8fb9\u3002\n\n\u8003\u8651\u4e00\u4e2a\u526a\u679d\uff1a\u5982\u679c\u4e00\u6761\u8fb9\u52a0\u5165\u4ee5\u540e\u8fde\u901a\u6027\u5b8c\u5168\u6ca1\u6709\u6539\u53d8\uff0c\u90a3\u4e48\u76f4\u63a5\u8fd4\u56de $0$\u3002\u56e0\u4e3a\u5982\u679c\u7ee7\u7eed\u641c\u7d22\u4e0b\u53bb\u7684\u8bdd\uff0c\u5bf9\u5e94\u9879\u4e00\u5b9a\u6070\u597d\u62b5\u6d88\u3002\n\n\u7406\u8bba\u65f6\u95f4\u590d\u6742\u5ea6 $O(2^M\\log N)$\uff0c\u5b9e\u9645\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\frac{2^M}{\\texttt{\u7384\u5b66}}-\\texttt{\u7384\u5b66})$\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b64\u9898\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\nint n, m, k, p[40], u[40], v[40], f[40];\nint find(int x) {\n\tif (x == f[x]) return x;\n\treturn find(f[x]);\n}\nint dfs(int i, int c) {\n\tif (i == m+1) return p[c];\n\tint x = find(u[i]);\n\tint y = find(v[i]);\n\tif (x == y) return 0;\n\tint f1 = dfs(i+1, c);\n\tf[y] = x;\n\tint f2 = dfs(i+1, c-1);\n\tf[y] = y;\n\treturn (f1 - f2 + 998244353) % 998244353;\n}\nint main() {\n\tios::sync_with_stdio(false);\n\tcin.tie(nullptr);\n\tmt19937 rng;\n\tuniform_int_distribution<int> randombool(0, 1);\n\tcin >> n >> m >> k;\n\tp[0] = 1;\n\tfor (int i = 1; i <= n; i++) {\n\t\tp[i] = (long long) p[i-1] * k % 998244353;\n\t}\n\tfor (int i = 1; i <= m; i++) {\n\t\tcin >> u[i] >> v[i];\n\t\tif (randombool(rng) & 1) swap(u[i], v[i]);\n\t}\n\tfor (int i = 1; i <= n; i++) {\n\t\tf[i] = i;\n\t}\n\tcout << dfs(1, n) << endl;\n\treturn 0;\n}\n```\n\n\u540e\u8bb0\uff1a\u8d5b\u65f6\u6700\u5927\u8fd0\u884c\u65f6\u95f4\u5927\u7ea6\u662f `7.7s`\u3002\n\n\u8fd9\u6b21 $\\texttt{rank}=8$\uff0c\u662f\u5386\u53f2\u6700\u9ad8\u3002\n",
        "postTime": 1679671895,
        "uid": 153422,
        "name": "0x3F",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 ABC294Ex\u3010K-Coloring\u3011"
    },
    {
        "content": "\u60f3\u4e86 60min\uff0c\u5199\u4e86 40min\uff08\n\n\u8003\u8651\u4e00\u4e2a\u6734\u7d20\u7684 dp\uff1a$f_{i,s}$ \u8868\u793a\u4ec5\u8003\u8651\u524d $i$ \u4e2a\u70b9\u7684\u989c\u8272\uff0c\u5176\u6784\u6210\u7684\u540c\u8272\u96c6\u5408\u7684\u72b6\u6001\u4e3a $s$ \u7684\u65b9\u6848\u6570\u3002\n\n\u8f6c\u79fb\u663e\u7136\u53ef\u4ee5 $\\mathcal O(n)$ \u505a\uff0c\u4f46\u662f\u72b6\u6001\u6570\u662f $\\mathcal O(nB_n)$ \u7ea7\u522b\u7684\uff0c\u9700\u8981\u4f18\u5316\u3002\n\n\u8003\u8651\u4e00\u4e2a\u526a\u679d\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u70b9 $i$\uff0c\u82e5\u4e0e $i$ \u76f8\u90bb\u7684\u70b9\u5168\u90e8\u5b8c\u6210\u8f6c\u79fb\u4e86\uff0c\u90a3\u4e48 $i$ \u662f\u4ec0\u4e48\u989c\u8272\u5c31\u5bf9\u540e\u9762\u7684\u8f6c\u79fb\u6ca1\u6709\u5f71\u54cd\u4e86\uff0c\u4e8e\u662f\u53ef\u4ee5\u4e0d\u518d\u8bb0\u5f55 $i$ \u7684\u72b6\u6001\u3002\n\n\u5bb9\u6613\u60f3\u5230\u94a6\u5b9a\u4e00\u4e2a\u8f6c\u79fb\u987a\u5e8f\uff0c\u4f7f\u5f97\u6bcf\u4e00\u65f6\u523b\u9700\u8981\u8bb0\u5f55\u72b6\u6001\u7684\u70b9\u6570\u5c3d\u53ef\u80fd\u5c11\u3002\n\n\u8003\u8651\u8fdb\u884c\u968f\u673a\u5316\uff0c\u968f\u673a\u6253\u4e71\u8f6c\u79fb\u987a\u5e8f\uff0c\u82e5\u6bcf\u4e00\u65f6\u523b\u9700\u8981\u8bb0\u5f55\u72b6\u6001\u7684\u70b9\u6570\u7684\u6700\u5927\u503c\u4e0d\u8d85\u8fc7\u4e00\u4e2a\u9608\u503c $S$ \u5c31\u4f7f\u7528\u8fd9\u79cd\u8f6c\u79fb\u987a\u5e8f\u8fdb\u884c dp\uff0c\u6b64\u65f6\u72b6\u6001\u6570\u662f $\\mathcal O(nB_S)$ \u7ea7\u522b\u7684\u3002\n\n\u4e0d\u6e05\u695a\u8fd9\u79cd\u505a\u6cd5\u80fd\u4e0d\u80fd\u88ab\u5361\u6389\uff0c\u4f46\u662f\u5bf9\u4e8e\u539f\u9898\u53d6 $S=9$ \u5373\u53ef\u5728 80ms \u5185\u901a\u8fc7\uff08\n\ncode:\n```cpp\n#include<bits/stdc++.h>\n#define p 998244353\n#define int long long\n#define pb push_back\n#define fi first\n#define se second\nusing namespace std;\nint add(int x,int y){return x+y<p?x+y:x+y-p;}\nint n,m,K;\nint in[35];vector<int>G[35];\nint tmp[35],vis[35],id[35],del[35];\nunordered_map<int,int>f[2];\nint col[35],bel[35];\nint encode(int pos){\n\tmemset(bel,0,sizeof(bel));int cnt=0,ret=0;\n\tfor(int i=1;i<=pos;i++){\n\t\tif((del[pos]>>(id[i]-1))&1)continue;\n\t\tif(!bel[col[id[i]]])bel[col[id[i]]]=++cnt;\n\t\tret=ret*17+bel[col[id[i]]];\n\t}\n\treturn ret;\n}\nint decode(int pos,int st){\n\tint ret=0;\n\tfor(int i=pos;i;i--)\n\t\tif(!((del[pos]>>(id[i]-1))&1))col[id[i]]=st%17,st/=17,ret=max(ret,col[id[i]]);\n\treturn ret;\n}\nsigned main(){\n\tscanf(\"%lld%lld%lld\",&n,&m,&K);\n\tfor(int i=1;i<=m;i++){\n\t\tint u,v;scanf(\"%lld%lld\",&u,&v);\n\t\tG[u].pb(v);G[v].pb(u);\n\t\tin[u]++;in[v]++;\n\t}\n\tfor(int i=1;i<=n;i++)id[i]=i;mt19937 rnd(time(0));\n\twhile(true){\n\t\tshuffle(id+1,id+n+1,rnd);\n\t\tmemcpy(tmp,in,sizeof(tmp));memset(vis,0,sizeof(vis));\n\t\tint mx=0,cnt=0;\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tvis[id[i]]=1;cnt+=(tmp[id[i]]>0);\n\t\t\tfor(auto j:G[id[i]]){\n\t\t\t\ttmp[j]--;\n\t\t\t\tif(vis[j]&&!tmp[j])cnt--;\n\t\t\t}\n\t\t\tmx=max(mx,cnt);\n\t\t}\n\t\tif(mx<=9)break;\n\t}\n\tmemcpy(tmp,in,sizeof(tmp));memset(vis,0,sizeof(vis));\n\tfor(int i=1;i<=n;i++){\n\t\tvis[id[i]]=1;del[i]|=((!tmp[id[i]])<<(id[i]-1));\n\t\tfor(auto j:G[id[i]])del[i]|=((!(--tmp[j]))<<(j-1));\n\t\tdel[i]|=del[i-1];\n\t}\n\tint now=0,pre=1;f[0][0]=1;\n\tfor(int i=1;i<=n;i++){\n\t\tnow^=1;pre^=1;f[now].clear();\n\t\tfor(auto s:f[pre]){\n\t\t\tint cnt=decode(i-1,s.fi),val=s.se;\n\t\t\tint ban=0;\n\t\t\tfor(auto j:G[id[i]])ban|=(1ll<<col[j]);\n\t\t\tfor(int j=1;j<=cnt;j++){\n\t\t\t\tif((ban>>j)&1)continue;\n\t\t\t\tcol[id[i]]=j;int t=encode(i);\n\t\t\t\tf[now][t]=(f[now][t]+val)%p;col[id[i]]=0;\n\t\t\t}\n\t\t\tif(cnt>=K)continue;\n\t\t\tcol[id[i]]=cnt+1;int t=encode(i);\n\t\t\tf[now][t]=(f[now][t]+val*(K-cnt))%p;\n\t\t}\n\t}\n\tprintf(\"%lld\\n\",f[now][0]);\n\treturn 0;\n}\n```",
        "postTime": 1679292932,
        "uid": 65681,
        "name": "UltiMadow",
        "ccfLevel": 7,
        "title": "[\u9898\u89e3] ABC294Ex"
    },
    {
        "content": "### \u7b80\u5316\u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a $n$ \u4e2a\u70b9 $m$ \u6761\u8fb9\u7684\u65e0\u5411\u56fe\uff0c\u6c42\u5c06\u5176 $k-$\u67d3\u8272\u7684\u65b9\u6848\u6570\u3002\n\n$n\\le30$\uff0c$m\\le30$\uff0c$k\\le10^9$\u3002\n\n### \u9898\u89e3\n\n\u5148\u8003\u8651 $n$ \u8f83\u5c0f\u7684\u65f6\u5019\u600e\u4e48\u505a\u3002\n\n\u8bb0 $f(S)$ \u8868\u793a\u70b9\u96c6 $S$ \u662f\u5426\u662f\u4e00\u4e2a\u975e\u7a7a\u72ec\u7acb\u96c6\uff0c\u8bbe $F$ \u4e3a $f$ \u7684\u96c6\u5408\u5e42\u7ea7\u6570\uff0c$V$ \u4e3a\u539f\u56fe\u70b9\u96c6\uff0c\u5219\u7b54\u6848\u4e3a\uff1a\n$$\n[x^V]\\sum_{i>0}\\binom{k}{i}F^i=[x^V](F+1)^k\n$$\n\u548c\u591a\u9879\u5f0f\u5feb\u901f\u5e42\u4e00\u6837\uff0c\u5148 $\\ln$ \u4e58\u4e0a $k$ \u518d $\\exp$ \u56de\u53bb\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O}(n^22^n)$\u3002\n\n\u6ce8\u610f\u5230\u672c\u9898 $n$ \u8f83\u5927\u4f46 $m$ \u8f83\u5c0f\uff0c\u56fe\u5f88\u7a00\u758f\uff0c\u8fd9\u610f\u5473\u7740\u4e00\u4e9b\u70b9\u7684\u9650\u5236\u662f\u5bb9\u6613\u5904\u7406\u7684\u3002\n\n\u8bb0 $s(G)$ \u8868\u793a\u5c06\u56fe $G$ $k-$\u67d3\u8272\u7684\u65b9\u6848\u6570\uff0c\u5bf9 $G$ \u4e2d\u7684\u4e00\u6761\u8fb9 $e$\uff0c\u6709\n$$\ns(G)=s(G-e)-s(G\\setminus e)\n$$\n\u5176\u4e2d $-$ \u8868\u793a\u5220\u8fb9\uff0c$\\setminus$ \u8868\u793a\u7f29\u8fb9\uff0c\u8fd9\u76f8\u5f53\u4e8e\u7528\u4e0d\u8003\u8651\u8fb9 $e$ \u9650\u5236\u7684\u65b9\u6848\u6570\u51cf\u53bb\u8fb9 $e$ \u4e24\u7aef\u8282\u70b9\u989c\u8272\u76f8\u540c\u7684\u65b9\u6848\u6570\u3002\n\n\u5bf9\u4e8e $G$ \u4e2d\u7684\u4e00\u4e2a\u70b9 $v$\uff0c\u82e5 $v$ \u5ea6\u6570\u4e3a $0$\uff0c\u5219\u6709\n$$\ns(G)=ks(G-v)\n$$\n\u82e5 $v$ \u5ea6\u6570\u4e3a $1$\uff0c\u8bbe\u4e0e $v$ \u76f8\u8fde\u7684\u8fb9\u4e3a $e$\uff0c\u5219\u6709\n$$\ns(G)=(k-1)s((G-e)-v)\n$$\n\u82e5 $v$ \u5ea6\u6570\u4e3a $2$\uff0c\u8bbe\u4e0e $v$ \u76f8\u8fde\u7684\u8fb9\u5206\u522b\u4e3a $e_1,e_2$\uff0c\u5219\u6709\n$$\ns(G)=s((G-e_1)-e_2)-s((G-e_1)\\setminus e_2)-s((G\\setminus e_1)-e_2)+s((G\\setminus e_1)\\setminus e_2)\n$$\n\u5176\u4e2d $(G-e_1)\\setminus e_2$ \u4e0e $(G\\setminus e_1)-e_2$ \u540c\u6784\uff0c\u8bb0\u5176\u4e3a $G_1$\uff0c\u8bb0 $(G\\setminus e_1)\\setminus e_2$ \u4e3a $G_2$\uff0c\u800c $(G-e_1)-e_2$ \u5220\u53bb\u5b64\u7acb\u70b9 $v$ \u5373\u4e3a $G_1$\uff0c\u6545\u6709\n$$\ns(G)=(k-2)s(G_1)+s(G_2)\n$$\n\u56e0\u6b64\u6211\u4eec\u9012\u5f52\u6c42\u89e3\uff0c\u53ea\u9700\u5bf9\u6240\u6709\u70b9\u5ea6\u6570\u5747\u5927\u4e8e $2$ \u7684\u7684\u56fe\u8ba1\u7b97\u7b54\u6848\uff0c\u6b64\u65f6\u70b9\u6570\u4e0d\u8d85\u8fc7 $\\lfloor\\frac{2m}{3}\\rfloor$\uff0c\u5728\u672c\u9898\u6570\u636e\u8303\u56f4\u5185\u70b9\u6570\u4e0d\u8d85\u8fc7 $20$\uff0c\u76f4\u63a5\u7528\u524d\u8ff0\u65b9\u6cd5\u8ba1\u7b97\u5373\u53ef\u3002\u5bf9\u4e8e\u7f29 $2$ \u5ea6\u70b9\u7684\u64cd\u4f5c\uff0c\u5373\u53d8\u4e3a\u8ba1\u7b97\u4e24\u4e2a\u8fb9\u6570\u51cf\u5c11 $2$ \u7684\u56fe\uff0c\u4e0d\u5f71\u54cd\u65f6\u95f4\u590d\u6742\u5ea6\u4e0a\u754c\u3002\u5177\u4f53\u65f6\u95f4\u590d\u6742\u5ea6\u5206\u6790\u53ef\u4ee5\u770b[\u8fd9\u91cc](https://atcoder.jp/contests/abc294/editorial/6022)\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define popc __builtin_popcount\nconst int N=21,P=998244353;\nint n,m,K,f[1<<20][N],inv[N],id[31];\nstd::vector<int> cur[31],p;\nstd::vector<std::pair<int,int>> e;\nvoid fwt(int f[][N],int n,int s){\n\tfor(int k=1;k<(1<<n);k<<=1)for(int i=0;i<(1<<n);i+=(k<<1))for(int j=0;j<k;++j)\n\t\tfor(int d=0;d<=n;++d)f[i+j+k][d]=(f[i+j+k][d]+1ll*(P+s)*f[i+j][d])%P;\n}\nvoid Ln(int *f,int n){\n    static int g[N];std::fill(g,g+n+1,0);\n    for(int i=1;i<=n;++i){\n        g[i]=(1ll*i*f[i]+g[i])%P;\n        for(int j=1;i+j<=n;++j)g[i+j]=(g[i+j]+1ll*(P-f[j])*g[i])%P;\n    }\n    for(int i=1;i<=n;++i)f[i]=1ll*g[i]*inv[i]%P;\n}\nvoid Exp(int *f,int n){\n    static int g[N];std::fill(g,g+n+1,0);\n    for(int i=0;i<=n;++i)f[i]=1ll*i*f[i]%P;\n    for(int i=0;i<=n;++i){\n        g[i]=i?1ll*g[i]*inv[i]%P:1;\n        for(int j=1;i+j<=n;++j)g[i+j]=(g[i+j]+1ll*f[j]*g[i])%P;\n    }\n    for(int i=0;i<=n;++i)f[i]=g[i];\n}\nvoid pow(int *f,int n,int k){\n\tauto power=[&](int x,int y){int s=1;for(;y;y>>=1,x=1ll*x*x%P)if(y&1)s=1ll*s*x%P;return s;};\n\tint p=0,v=f[0];while(p<=n&&!v)v=f[++p];\n\tfor(int i=0,j=power(v,P-2);i<=n;++i)f[i]=i<=n-p?1ll*f[i+p]*j%P:0;\n\tLn(f,n-p);for(int i=0;i<=n-p;++i)f[i]=1ll*f[i]*k%P;Exp(f,n-p),v=power(v,k);\n\tfor(int i=n;~i;--i)f[i]=i>=k*p?1ll*f[i-k*p]*v%P:0;\n}\nint calc(std::vector<int> p,std::vector<std::pair<int,int>> e){\n\tfor(int i:p)cur[i].clear();\n\tfor(auto [x,y]:e){\n\t\tif(x==y)return 0;\n\t\tcur[x].push_back(y),cur[y].push_back(x);\n\t}\n\tstd::vector<int> p1,p2;std::vector<std::pair<int,int>> e1,e2;\n\tfor(int i:p){\n\t\tif(cur[i].empty()){\n\t\t\tfor(int j:p)if(j!=i)p1.push_back(j);\n\t\t\tfor(auto j:e)e1.push_back(j);\n\t\t\treturn 1ll*K*calc(p1,e1)%P;\n\t\t}\n\t\tif(cur[i].size()==1){\n\t\t\tfor(int j:p)if(j!=i)p1.push_back(j);\n\t\t\tfor(auto [x,y]:e)if(x!=i&&y!=i)e1.emplace_back(x,y);\n\t\t\treturn 1ll*(K-1+P)*calc(p1,e1)%P;\n\t\t}\n\t}\n\tfor(int i:p)if(cur[i].size()==2){\n\t\tfor(int j:p)if(j!=i)p1.push_back(j);\n\t\tfor(auto [x,y]:e)if(x!=i&&y!=i)e1.emplace_back(x,y);\n\t\tfor(int j:p)if(j!=cur[i][0]&&j!=cur[i][1])p2.push_back(j);\n\t\tfor(auto [x,y]:e)if(x!=cur[i][0]&&y!=cur[i][0]&&x!=cur[i][1]&&y!=cur[i][1])e2.emplace_back(x,y);\n\t\tfor(int j:cur[cur[i][0]])if(j!=i)j==cur[i][1]&&(j=i),e2.emplace_back(i,j);\n\t\tfor(int j:cur[cur[i][1]])if(j!=i)j==cur[i][0]&&(j=i),e2.emplace_back(i,j);\n\t\treturn (1ll*(K-2+P)*calc(p1,e1)+calc(p2,e2))%P;\n\t}\n\tfor(int i=0;i<p.size();++i)id[p[i]]=i;\n\tauto check=[&](int x){\n\t\tfor(int i=0;i<p.size();++i)if(x>>i&1)for(int j:cur[p[i]])if(x>>id[j]&1)return 0;\n\t\treturn 1;\n\t};\n\tfor(int i=0;i<(1<<p.size());++i)f[i][popc(i)]=check(i);\n\tfwt(f,p.size(),1);\n\tfor(int i=0;i<(1<<p.size());++i)pow(f[i],p.size(),K);\n\tfwt(f,p.size(),-1);\n\treturn f[(1<<p.size())-1][p.size()];\n}\nint main(){\n\tscanf(\"%d%d%d\",&n,&m,&K),p.resize(n),std::iota(p.begin(),p.end(),1);\n\tfor(int i=1;i<N;++i)inv[i]=i>1?1ll*inv[P%i]*(P-P/i)%P:1;\n\tfor(int x,y;m--;)scanf(\"%d%d\",&x,&y),e.emplace_back(x,y);\n\treturn !printf(\"%d\\n\",calc(p,e));\n}\n```\n\n",
        "postTime": 1679528990,
        "uid": 735000,
        "name": "_www_",
        "ccfLevel": 0,
        "title": "[ABC294Ex] K-Coloring"
    },
    {
        "content": "\u4e00\u4e2a\u66b4\u529b\u505a\u6cd5\u3002\n\n\u9996\u5148\u628a\u6761\u4ef6\u52a0\u5f3a\u4e00\u4e0b\uff0c\u5bf9\u6bcf\u6761\u8fb9 $u_i,v_i$ \u52a0\u4e0a\u8fb9\u6743 $(a_i,b_i)$\uff0c\u8868\u793a\u5982\u679c $u_i,v_i$ \u989c\u8272\u76f8\u540c\uff0c\u5219\u4f1a\u5bf9\u7b54\u6848\u4ea7\u751f $a_i$ \u7684\u8d21\u732e\uff0c\u5426\u5219\u5bf9\u7b54\u6848\u4ea7\u751f $b_i$ \u7684\u8d21\u732e\u3002\u5bf9\u4e8e\u6b64\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fb9\u6743\u8bbe\u4e3a $(0,1)$\u3002\n\n\u5bb9\u6613\u60f3\u5230\u5bf9\u6bcf\u4e2a\u8fde\u901a\u5757\u6c42\u89e3\uff0c\u7b54\u6848\u5373\u4e3a\u6240\u6709\u8fde\u901a\u5757\u7b54\u6848\u4e4b\u79ef\u3002\n\n\u5982\u679c\u7ed9\u5b9a\u7684\u662f\u4e00\u68f5\u6811\uff0c\u90a3\u4e48\u8fd9\u4e2a\u95ee\u9898\u53ef\u4ee5\u901a\u8fc7 `dp` \u6765 $O(nk)$ \u89e3\u51b3\u3002\u6211\u4eec\u8bbe $f_{u,j}$ \u8868\u793a\u70b9 $u$ \u7684\u989c\u8272\u662f $j$\uff0c\u5b50\u6811 $u$ \u7684\u65b9\u6848\u3002\u5bf9\u4e8e\u4e0d\u662f\u6811\u7684\u60c5\u51b5\uff0c\u8003\u8651\u5efa\u51fa `dfs` \u6811\uff0c\u90a3\u4e48\u975e\u6811\u8fb9\u4e00\u5b9a\u662f\u8fd4\u7956\u8fb9\uff08\u5373\u8fde\u63a5\u7956\u5b59\uff09\uff0c\u6211\u4eec\u628a\u6240\u6709\u8fd9\u6837\u7684\u8fb9\u4e2d\u7684\u7956\u5148\u62c9\u51fa\u6765\uff0c\u53bb\u91cd\u540e\u66b4\u529b\u679a\u4e3e\u8fd9\u4e9b\u70b9\u7684\u989c\u8272\uff0c\u5269\u4e0b\u7684\u70b9\u5373\u53ef\u901a\u8fc7\u4e0a\u9762\u7684 `dp` \u89e3\u51b3\u3002\n\n\u56e0\u4e3a $k$ \u8f83\u5927\uff0c\u6240\u4ee5\u6211\u4eec\u679a\u4e3e\u989c\u8272\u5212\u5206\uff0c\u590d\u6742\u5ea6 $O(\\operatorname{Bell}(\\min(n-1,m-n+1))n^2)$\uff0c\u5176\u4e2d $\\min(n-1,m-n+1)$ \u662f\u8fd4\u7956\u8fb9\u8fde\u63a5\u7684\u4e0d\u540c\u7956\u5148\u7684\u4e2a\u6570\u7684\u6700\u5927\u503c\uff0c\u5f53 $n=16,m=30$\uff0c`dfs` \u6811\u662f\u4e00\u6761\u94fe\u7684\u60c5\u51b5\u53ef\u4ee5\u5361\u5230 $15$\uff0c\u800c $\\operatorname{Bell}(15)$ \u662f $3\\times 10^8$ \u7ea7\u522b\uff0c\u4e0d\u592a\u80fd\u8dd1\uff0c\u5e94\u8be5\u53ef\u4ee5\u5361\u6389\u3002\u4f46\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0\u4e00\u4e9b\u526a\u679d\u8ba9\u5176\u5361\u4e0d\u6389\uff0c\u6bd4\u5982\u5982\u679c\u679a\u4e3e\u7684\u70b9\u4e2d\u95f4\u6709\u76f4\u63a5\u8fde\u8fb9\u53ef\u4ee5\u5148\u5224\u6389\uff0c\u5bf9\u4e8e\u5ea6\u6570\u4e3a $1$ \u6216\u8005\u5ea6\u6570\u4e3a $2$ \u7684\u70b9\u53ef\u4ee5\u5220\u6389\uff0c\u5ea6\u6570\u4e3a $1$ \u7684\u70b9\u76f8\u5f53\u4e8e\u7b54\u6848\u4e58\u4e0a $k-1$\uff0c\u5ea6\u6570\u4e3a $2$ \u7684\u70b9\u53ef\u4ee5\u628a\u5176\u76f8\u90bb\u4e24\u4e2a\u70b9\u7528\u8fb9\u6743\u4e3a $(k-1,k-2)$ \u8fde\u63a5\u3002\u52a0\u4e0a\u8fd9\u4e9b\u526a\u679d\u5c31\u5361\u4e0d\u6389\u4e86\u3002~~\u4f46\u5b9e\u9645\u4e0a\u6ca1\u52a0\u4efb\u4f55\u526a\u679d\u5c31\u8fc7\u4e86\u8fd8\u8dd1\u5f97\u98de\u5feb~~",
        "postTime": 1679274729,
        "uid": 310802,
        "name": "_Diu_",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 [ABC294Ex] K-Coloring"
    },
    {
        "content": "## [ABC294Ex] K-Coloring\n~~\u975e\u6b63\u89e3\uff0c\u4f46\u662f\u6709AC\u6027~~\n\u8fd9\u662f\u4e00\u4e2a\u7ecf\u5178\u7684**\u56fe\u67d3\u8272\u95ee\u9898** \u3002\u4e5f\u662f\u7ecf\u5178\u7684 k - sat \u95ee\u9898\u3002\n\n\u9996\u5148\u6839\u636e Atcoder \u7684\u7279\u6027 \u2014\u2014 \u4ece\u4e0d\u5361\u5e38\uff0c\u65f6\u9650\u653e\u5bbd\u7b49\u7279\u70b9\u3002\n\n\u770b\u5230\u8fd9\u9053\u9898\u7684\u65f6\u95f4\u9650\u5236\u662f $8$ s\u3002\n\n\u6211\u4eec\u4e0d\u96be\u60f3\u5230\u4e00\u79cd\u5341\u5206\u66b4\u529b\u7684\u505a\u6cd5 \u2014\u2014 \u679a\u4e3e (dfs)\u3002\n\n\u8003\u8651\u5982\u4f55\u7edf\u8ba1\u7b54\u6848? \u7ecf\u5178\u7684\u5bb9\u65a5\u95ee\u9898\u3002\n\n\u65b9\u6848\u6570 $=$ \u4efb\u610f\u586b\u56fe\u65b9\u6848\u6570 $-$ \u4e00\u5bf9\u70b9\u91cd\u8272 $+$ \u4e24\u5bf9\u70b9\u91cd\u8272 $-$ \u4e09\u5bf9\u70b9\u91cd\u8272 $\\dots$ \u4ee5\u6b64\u7c7b\u63a8\u3002\n\n\u4e8e\u662f\u66b4\u529b\u7684 dfs \u5b9a\u4e49\u53ef\u4ee5\u662f dfs(x , k) \u8868\u793a\u8003\u8651\u5230\u7b2c $i$ \u6761\u8fb9\u65f6\uff0c\u5269\u4f59\u7684\u72ec\u7acb\u7684\u989c\u8272\u5757\u6570 \u3002\n\n\u8fd9\u91cc\u7ef4\u62a4\u662f\u5426\u72ec\u7acb\uff0c\u53ef\u4ee5\u8003\u8651\u7528**\u5e76\u67e5\u96c6**\u3002\n\n\u8fd9\u65f6\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(2^m)$ \u3002\u660e\u663e\u7684\uff0c\u8fd9\u4f1a TLE\u3002\n\n\u4e8e\u662f\u4e00\u79cd\u65b0\u7684\u601d\u60f3 \u2014\u2014 \u8fd0\u7528\u4e0a\u5e76\u67e5\u96c6\u7684\u6027\u8d28\u3002\n\n\u4efb\u610f\u4e24\u70b9\u5df2\u7ecf\u5c5e\u4e8e\u540c\u4e00\u96c6\u5408\u65f6\uff0c\u8fd9\u79cd\u65b9\u6848\u4e00\u5b9a\u4e0d\u5408\u6cd5\u3002\n\n\u8fd9\u91cc\u53ef\u4ee5\u4f18\u5316\u526a\u679d\u3002\u51fa\u9898\u4eba\u53c8\u4e0d\u53ef\u80fd\u653e\u6c34\u6570\u636e\uff0c\u4e00\u5b9a\u4f1a\u5361\u4f60\u3002\n\n\u4e8e\u662f\u968f\u673a\u5316\u4e00\u4e0b\u4f7f\u6570\u636e\u66f4\u597d\u770b\u3002(doge\n\n\u6ce8\u610f\uff1a\u4e3a\u4fdd\u6301\u539f\u56fe\u6784\u9020\u4e0d\u53ef\u4ee5\u8def\u5f84\u538b\u7f29!\n\n## Solution\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define open(x) freopen(x \".in\", \"r\", stdin);freopen(x \".out\", \"w\", stdout);\n#define int long long \n\nconst int p = 998244353;\nconst int MAXN = 105;\nint n,m,k;\nint a[MAXN];\nint b[MAXN];\nint f[MAXN];\nint pw[MAXN];\n\nmt19937 M(10007);\ninline int find(int x){\n\tif(x == f[x]) return x;\n\treturn find(f[x]);\n}\n\ninline int dfs(int x,int c){\n\tif(x == m + 1){\n\t\treturn pw[c];\n\t}\n\tint r1 = find(a[x]);\n\tint r2 = find(b[x]);\n\tif(r1 == r2) return 0;\n\tint A = dfs(x + 1 , c);\n\tf[r2] = r1;\n\tint B = dfs(x + 1 , c - 1);\n\tf[r2] = r2;\n\treturn (A - B + p) % p;\n}\n\nsigned main(){\n\tsrand((unsigned)time(NULL));\n\tios::sync_with_stdio(false);\n\tcin.tie(0);\n\tcin >> n >> m >> k; \n\tpw[0] = 1;\n\tfor(int i = 1 ; i <= n;++i){\n\t\tpw[i] = pw[i - 1] * k % p;\n\t\tf[i] = i;\n\t}\n\tif(m == 0){\n\t\tcout << pw[n];\n\t\treturn 0;\n\t}\n\tfor(int i = 1 ; i <= m ; ++i){\n\t\tcin >> a[i] >> b[i];\n\t}\n\tfor(int i = 1 ; i <= m;++i){\n\t\tif(M()&1) swap(a[i],b[i]);\n\t}\n\tfor(int i = 1 ;i <= 9999 ;++i){\n\t\tint x = M() % m + 1;\n\t\tswap(a[x],b[x]);\n\t}\n\tcout << dfs(1,n);\n\treturn 0;\n} \n```\n",
        "postTime": 1679828851,
        "uid": 147761,
        "name": "qmh20061363",
        "ccfLevel": 0,
        "title": "[ABC294Ex] K-Coloring"
    },
    {
        "content": "\u611f\u8c22 ZCPB \u7684\u6307\u5bfc\uff01\n\n\u53ef\u4ee5\u4e0d\u65ad\u5220\u4e00\u5ea6\u70b9\u548c\u4e8c\u5ea6\u70b9\uff0c\u6765\u5bf9\u56fe\u8fdb\u884c\u7b80\u5316\u3002\u5220\u5b8c\u4e4b\u540e\u4e00\u6761\u8fb9\u6709\u4e24\u4e2a\u6743\u503c\uff0c\u5206\u522b\u4ee3\u8868\u4e24\u7aef\u989c\u8272\u76f8\u540c/\u4e0d\u540c\u65f6\u8fd9\u6761\u8fb9\u5bf9\u7b54\u6848\u4e58\u4e0a\u7684\u7cfb\u6570\u3002\uff08\u5176\u5b9e\u8fd9\u4e2a\u5e76\u4e0d\u5fc5\u8981\uff09\n\n\u5bf9\u4e8e\u6bcf\u4e2a\u8fde\u901a\u5757\u5355\u72ec\u8003\u8651\u3002\u5982\u679c\u70b9\u6570\u5f88\u5c0f\uff0c\u53ef\u4ee5\u76f4\u63a5\u679a\u4e3e\u989c\u8272\u7684\u6700\u5c0f\u8868\u793a\uff0c\u4e5f\u5c31\u662f\u7206\u641c\u4e00\u4e0b\u96c6\u5408\u5212\u5206\u3002\u70b9\u6570\u5f88\u591a\u7684\u8bdd\uff0c\u975e\u6811\u8fb9\u4f1a\u6bd4\u8f83\u5c11\uff0c\u6240\u4ee5\u5c31\u5bf9\u4e8e\u6bcf\u4e2a\u8fd4\u7956\u8fb9\u7684 dep \u8f83\u5c0f\u7684\u70b9\u7ec4\u6210\u7684\u96c6\u5408\uff0c\u641c\u8fd9\u4e2a\u96c6\u5408\u91cc\u9762\u7684\u70b9\u7684\u989c\u8272\u7684\u6700\u5c0f\u8868\u793a\uff0c\u7136\u540e\u4e0a\u4e2a\u66b4\u529b\u6811\u5f62 dp \u7b97\u65b9\u6848\u6570\u5c31\u884c\u3002\n\n\u590d\u6742\u5ea6\u4e0d\u662f\u5f88\u4f1a\u7b97\uff0c\u4f46\u8dd1\u5f97\u560e\u560e\u5feb\uff01\n\n```cpp\n#include<cstdio>\n#include<vector>\n#include<queue>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#include<ctime>\n#include<random>\n#include<assert.h>\n//#define int long long\n#define pb emplace_back\n#define mp make_pair\n#define fi first\n#define se second\n#define dbg(x) cerr<<\"In Line \"<< __LINE__<<\" the \"<<#x<<\" = \"<<x<<'\\n';\n#define dpi(x,y) cerr<<\"In Line \"<<__LINE__<<\" the \"<<#x<<\" = \"<<x<<\" ; \"<<\"the \"<<#y<<\" = \"<<y<<'\\n';\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int>pii;\ntypedef pair<ll,int>pli;\ntypedef pair<ll,ll>pll;\ntypedef pair<int,ll>pil;\ntypedef vector<int>vi;\ntypedef vector<ll>vll;\ntypedef vector<pii>vpii;\ntypedef vector<pil>vpil;\ntemplate<typename T>T cmax(T &x, T y){return x=x>y?x:y;}\ntemplate<typename T>T cmin(T &x, T y){return x=x<y?x:y;}\ntemplate<typename T>\nT &read(T &r){\n\tr=0;bool w=0;char ch=getchar();\n\twhile(ch<'0'||ch>'9')w=ch=='-'?1:0,ch=getchar();\n\twhile(ch>='0'&&ch<='9')r=r*10+(ch^48),ch=getchar();\n\treturn r=w?-r:r;\n}\ntemplate<typename T1,typename... T2>\nvoid read(T1 &x,T2& ...y){read(x);read(y...);}\nconst int mod=998244353;\ninline void cadd(int &x,int y){x=(x+y>=mod)?(x+y-mod):(x+y);}\ninline void cdel(int &x,int y){x=(x-y<0)?(x-y+mod):(x-y);}\ninline int add(int x,int y){return (x+y>=mod)?(x+y-mod):(x+y);}\ninline int del(int x,int y){return (x-y<0)?(x-y+mod):(x-y);}\nconst int N=31;\nint n,m,k;\nint f[N][N],g[N][N],e[N][N];\nint ban[N];\n//f: diff\n//g: same\nint d[N];\nint coef=1;\nint p[N],tot;\nint getdeg(){\n\tfor(int i=1;i<=n;i++)d[i]=0;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=i+1;j<=n;j++)\n\t\t\tif(e[i][j])\n\t\t\t\t++d[i],++d[j];\n\tfor(int i=1;i<=n;i++)\n\t\tif(!ban[i] && d[i]<=2)\n\t\t\treturn 1;\n\treturn 0;\n}\nvoid cle(int i,int j){\n\te[i][j]=e[j][i]=f[i][j]=f[j][i]=g[i][j]=g[j][i]=0;\n\t--d[i];--d[j];\n}\nvoid kill0(){\n\tfor(int i=1;i<=n;i++)\n\t\tif(!ban[i] && d[i]==0){\n\t\t\tcoef=1ll*coef*k%mod;\n\t\t\tban[i]=1;\n\t\t}\n}\nvoid kill1(){\n\tfor(int i=1;i<=n;i++)\n\t\tif(d[i]==1){\n\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\tif(e[i][j]){\n\t\t\t\t\tcoef=1ll*coef*add(g[i][j],1ll*(k-1)*f[i][j]%mod)%mod;\n\t\t\t\t\tcle(i,j);\n\t\t\t\t\tban[i]=1;\n\t\t\t\t}\n\t\t}\n}\nvoid kill2(){\n\tfor(int i=1;i<=n;i++)\n\t\tif(d[i]==2){\n\t\t\tint x=0,y=0;\n\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\tif(e[i][j]){\n\t\t\t\t\tif(!x)x=j;\n\t\t\t\t\telse y=j;\n\t\t\t\t}\n\t\t\tint G=add(1ll*g[i][x]*g[i][y]%mod,1ll*(k-1)*f[i][x]%mod*f[i][y]%mod);\n\t\t\tint F=add(1ll*g[i][x]*f[i][y]%mod,1ll*g[i][y]*f[i][x]%mod);\n\t\t\tcadd(F,1ll*(k-2)*f[i][x]%mod*f[i][y]%mod);\n\t\t\tif(!e[x][y])\n\t\t\t\te[x][y]=e[y][x]=f[x][y]=f[y][x]=g[x][y]=g[y][x]=1,++d[x],++d[y];\n\t\t\tf[x][y]=f[y][x]=1ll*f[x][y]*F%mod;\n\t\t\tg[x][y]=g[y][x]=1ll*g[x][y]*G%mod;\n\t\t\tcle(i,x);cle(i,y);\n\t\t\tban[i]=1;\n\t\t}\n}\nvoid remake(){\n\tfor(int i=1;i<=n;i++)\n\t\tif(!ban[i])\n\t\t\tp[i]=++tot;\n\tstatic int tmp[N][N];\n\tauto rem=[&](int a[N][N]){\n\t\tmemcpy(tmp,a,sizeof(f));\n\t\tmemset(a,0,sizeof(f));\n\t\tfor(int i=1;i<=n;i++)\n\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\tif(tmp[i][j])\n\t\t\t\t\ta[p[i]][p[j]]=tmp[i][j];\n\t};\n\trem(f);rem(g);rem(e);\n\tn=tot;\n}\n//\nint a[N],ans=1,sum,down[N];\nvi eg[N],vec;\nvoid bell_dfs(int o,int ct,int h){\n\tif(o==(int)vec.size()){\n\t\tcadd(sum,1ll*h*down[ct]%mod);\n\t\treturn ;\n\t}\n\tint x=vec[o];\n\tfor(int i=1;i<=ct+1;i++){\n\t\ta[x]=i;\n\t\tint t=h;\n\t\tfor(auto j:eg[x]){\n\t\t\tif(a[x]!=a[j])\n\t\t\t\tt=1ll*t*f[j][x]%mod;\n\t\t\telse\n\t\t\t\tt=1ll*t*g[j][x]%mod;\n\t\t}\n\t\tbell_dfs(o+1,max(i,ct),t);\n\t\ta[x]=0;\n\t}\n}\nint F[N][N],G[N][N],E[N][N];\nint pa[N],alr[N],dep[N],ok[N];\nvoid dfs1(int x){\n\talr[x]=1;\n\tfor(int i=1;i<=n;i++)\n\t\tif(E[x][i] && !alr[i]){\n\t\t\tpa[i]=x;dep[i]=dep[x]+1;\n\t\t\tdfs1(i);\n\t\t}\n}\nint C;\nint dp[N][N];\nvoid Dp(int x){\n\tfor(int i=0;i<=C;i++)dp[x][i]=0;\n\tif(ok[x])dp[x][a[x]]=1;\n\telse{\n\t\tfor(int i=0;i<=C;i++)dp[x][i]=1;\n\t}\n\tfor(int v=1;v<=n;v++)\n\t\tif(E[x][v] && v!=pa[x]){\n\t\t\tif(dep[v]<dep[x]){\n\t\t\t\tfor(int i=0;i<=C;i++)\n\t\t\t\t\tif(i==a[v])dp[x][i]=1ll*dp[x][i]*G[x][v]%mod;\n\t\t\t\t\telse dp[x][i]=1ll*dp[x][i]*F[x][v]%mod;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(pa[v]!=x)continue;\n\t\t\t\tDp(v);\n\t\t\t\tfor(int i=0;i<=C;i++){\n\t\t\t\t\tint s=0;\n\t\t\t\t\tif(i)s=1ll*dp[v][0]*(k-C)%mod*F[x][v]%mod;\n\t\t\t\t\telse s=add(1ll*dp[v][0]*(k-C-1)%mod*F[x][v]%mod,1ll*dp[v][0]*G[x][v]%mod);\n        \t\t\tfor(int j=1;j<=C;j++)\n\t\t\t\t\t\tif(i==j)cadd(s,1ll*dp[v][j]*G[x][v]%mod);\n\t\t\t\t\t\telse cadd(s,1ll*dp[v][j]*F[x][v]%mod);\n\t\t\t\t\tdp[x][i]=1ll*dp[x][i]*s%mod;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n}\nvi pac;\nvoid dfs2(int o,int ct){\n\tif(ct>k)return ;\n\tif(o==(int)pac.size()){\n\t\tC=ct;\n\t\tDp(1);\n\t\tint s=1ll*dp[1][0]*(k-C)%mod;\n\t\tfor(int i=1;i<=C;i++)cadd(s,dp[1][i]);\n\t\tcadd(sum,1ll*s*down[ct]%mod);\n\t\treturn ;\n\t}\n\tint x=pac[o];\n\tfor(int i=1;i<=ct+1;i++){\n\t\ta[x]=i;\n\t\tdfs2(o+1,max(i,ct));\n\t\ta[x]=0;\n\t}\n}\nvoid solve(){\n\tint tot=vec.size();\n\tfor(int i=1;i<=tot;i++){\n\t\talr[i]=ok[i]=0;\n\t\tfor(int j=1;j<=tot;j++){\n\t\t\tE[i][j]=e[vec[i-1]][vec[j-1]];\n\t\t\tF[i][j]=f[vec[i-1]][vec[j-1]];\n\t\t\tG[i][j]=g[vec[i-1]][vec[j-1]];\n\t\t}\n\t}\n\tdfs1(1);\n\tfor(int i=1;i<=tot;i++)\n\t\tfor(int j=1;j<=tot;j++)\n\t\t\tif(E[i][j]){\n\t\t\t\tif(i==pa[j]||j==pa[i])continue;\n\t\t\t\tif(dep[i]<dep[j])\n\t\t\t\t\tok[i]=1;\n\t\t\t}\n\tvi().swap(pac);\n\tfor(int i=1;i<=tot;i++)\n\t\tif(ok[i])\n\t\t\tpac.pb(i);\n\tdfs2(0,0);\n}\nint fa[N],siz[N];\nint getfa(int x){return fa[x]==x?x:fa[x]=getfa(fa[x]);}\nsigned main(){\n\t#ifdef do_while_true\n//\t\tassert(freopen(\"data.in\",\"r\",stdin));\n//\t\tassert(freopen(\"data.out\",\"w\",stdout));\n\t#endif\n\tread(n);read(m);read(k);\n\tif(k==1){\n\t\tif(m)puts(\"0\");\n\t\telse puts(\"1\");\n\t\treturn 0;\n\t}\n\tfor(int i=1;i<=m;i++){\n\t\tint u,v;read(u);read(v);\n\t\te[u][v]=e[v][u]=1;\n\t\tf[u][v]=f[v][u]=1;\n\t}\n\twhile(getdeg()){\n\t\tkill0();\n\t\tkill1();\n\t\tkill2();\n\t}\n\tremake();\n\tif(!n){\n\t\tcout << coef << '\\n';\n\t\treturn 0;\n\t}\n\tdown[0]=1;\n\tfor(int i=1;i<=n;i++)down[i]=1ll*down[i-1]*(k-i+1)%mod;\n\t//n<=m*7/12\n\t//n<=17\t\n\tfor(int i=1;i<=n;i++)fa[i]=i;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<i;j++)\n\t\t\tif(e[i][j]){\n\t\t\t\teg[i].pb(j);\n\t\t\t\tfa[getfa(i)]=getfa(j);\n\t\t\t}\n\tfor(int i=1;i<=n;i++)siz[getfa(i)]++;\n\tfor(int i=1;i<=n;i++)\n\t\tif(getfa(i)==i){\n\t\t\tvi().swap(vec);\n\t\t\tfor(int j=1;j<=n;j++)\n\t\t\t\tif(getfa(j)==i)\n\t\t\t\t\tvec.pb(j);\n\t\t\tsum=0;\n\t\t\tif(vec.size()<=12)bell_dfs(0,0,1);\n\t\t\telse solve();\n\t\t\tans=1ll*ans*sum%mod;\n\t\t}\n\tcout << 1ll*coef*ans%mod << '\\n';\n    #ifdef do_while_true\n//\t\tcerr<<'\\n'<<\"Time:\"<<1.0*clock()/CLOCKS_PER_SEC*1000<<\" ms\"<<'\\n';\n\t#endif\n\treturn 0;\n}\n```",
        "postTime": 1679442696,
        "uid": 223298,
        "name": "do_while_true",
        "ccfLevel": 8,
        "title": "\u300c\u9898\u89e3\u300dABC294Ex K-Coloring"
    },
    {
        "content": "\n\n## \u9898\u610f\u63cf\u8ff0\n\n\u7ed9\u5b9a\u4e00\u5f20\u56fe\uff0c\u8981\u6c42\u7ed9\u70b9\u5206\u914d\u503c\u57df\u4e3a $[1,k]$ \u7684\u70b9\u6743\uff0c\u95ee\u6709\u591a\u5c11\u79cd\u65b9\u6848\u6570\uff0c\u4f7f\u5f97\u6bcf\u6761\u8fb9\u7684\u4e24\u4e2a\u9876\u70b9\u7684\u70b9\u6743\u90fd\u4e0d\u540c\u3002\n\n## \u7b80\u8981\u5206\u6790\n\n\u8003\u8651\u5bb9\u65a5\u3002\n\n\u4e0d\u96be\u53d1\u73b0\uff0c\u7b54\u6848\u7b49\u4e8e\u65e0\u9650\u5236\u67d3\u8272\u65b9\u6848\u6570\uff0c\u51cf\u53bb\u6709\u4e00\u5bf9\u76f8\u90bb\u7684\u70b9\u989c\u8272\u76f8\u540c\u7684\u65b9\u6848\u6570\u52a0\u4e0a\u6709\u4e24\u5bf9\u70b9\u989c\u8272\u76f8\u540c\u7684\u65b9\u6848\u6570\u51cf\u53bb\u6709\u4e09\u5bf9\u70b9\u989c\u8272\u76f8\u540c\u7684\u65b9\u6848\u6570\u4ee5\u6b64\u7c7b\u63a8\u3002\n\n\u5728 $n$ \u4e2a\u70b9\u4e2d\u6709\u82e5\u5e72\u5bf9\u70b9\u989c\u8272\u76f8\u540c\u7684\u65b9\u6848\u6570\u7b49\u4ef7\u4e8e\u4ece $m$ \u6761\u8fb9\u4e2d\u9009\u51fa\u82e5\u5e72\u6761\u8fb9\u7684\u65b9\u6848\u6570\u3002\n\n\u4e8e\u662f\u5c31\u6709\uff1a\n$$\nans = k^n +  \\sum_{i= 1}^{m}{(-1)^i{m \\choose i} 2^{V}}\n$$\n\n\n\u8fd9\u91cc $V$ \u6307\u70b9\u7684\u6570\u76ee\u3002\n\n\u63a5\u4e0b\u6765\u53ef\u4ee5\u76f4\u63a5\u679a\u4e3e $\\sum_{i=1}^{m}{m \\choose i} = 2^m - 1$ \u79cd\u65b9\u6848\uff08\u56e0\u4e3a\u76f8\u540c\u7684 $i$ \u4f1a\u5bf9\u5e94\u7740\u4e0d\u540c\u7684 $V$\uff09\u3002\n\n\u4f46\u662f\uff0c\u4ece\u610f\u4e49\u4e0a\u8003\u8651 ${m \\choose i } 2^V = k^{n-i}$\uff0c\u56e0\u4e3a\u6211\u4eec\u53ef\u4ee5\u628a\u989c\u8272\u76f8\u540c\u7684\u4e24\u4e2a\u70b9\u6525\u6210\u4e00\u4e2a\u5927\u70b9\u3002\n\n\u4e3a\u4e86\u907f\u514d\u6525\u70b9\u7684\u91cd\u590d\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528\u5e76\u67e5\u96c6\u5224\u91cd\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(2^m)$\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u6211\u4eec\u53ef\u4ee5\u968f\u673a\u4ea4\u6362\u8fb9\u7684\u987a\u5e8f\uff0c\u968f\u673a\u4ea4\u6362 $u,v$ \u7684\u987a\u5e8f\u5373 $u \\rightarrow v$ \u4ea4\u6362\u6210 $u \\leftarrow v$\u3002\n\n\u5e76\u67e5\u96c6\u5224\u91cd\u4e0e\u968f\u673a\u4ea4\u6362\u8fb9\u7684\u987a\u5e8f\u5341\u5206\u6709\u6548\uff0c\u53ef\u901a\u8fc7\u672c\u9898\u3002\n\n## \u4ee3\u7801\u5b9e\u73b0\n\n```cpp\nll find(ll x) {\n    if (x == f[x]) return x;\n    return find(f[x]);\n}\n\nll dfs(ll i, ll c) {\n    if (i == m + 1)\n        return p[c];\n    ll x = find(u[i]);\n    ll y = find(v[i]);\n    if (x == y) return 0;\n    ll f1 = dfs(i + 1, c);\n    f[y] = x;\n    ll f2 = dfs(i + 1, c - 1);\n    f[y] = y;\n    return (f1 - f2 + MOD) % MOD;\n}\n\nsigned main() {\n    cin >> n >> m >> k;\n    p[0] = 1;\n    for (ll i = 1; i <= n; i++)\n        p[i] = (long long) p[i - 1] * k % MOD, f[i] = i;\n    for (ll i = 1; i <= m; i++) {\n        cin >> u[i] >> v[i];\n        if (rand() & 1) swap(u[i], v[i]);\n    }\n    if (m > 0)\n        for (ll i = 1; i <= 1e3; i++) {\n            ll x = rand() % m + 1, y;\n            do\n                y = rand() % m + 1;\n            while (y == x);\n            swap(u[x], u[y]);\n            swap(v[x], v[y]);\n        }\n    cout << dfs(1, n) << endl;\n    return 0;\n}\n```\n\n",
        "postTime": 1679370710,
        "uid": 378222,
        "name": "fakestd",
        "ccfLevel": 0,
        "title": "[ABC294H] K-Coloring \u9898\u89e3"
    }
]