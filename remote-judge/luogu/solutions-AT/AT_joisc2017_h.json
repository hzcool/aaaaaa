[
    {
        "content": "\u8003\u8651\u66b4\u529b\u6269\u5c55\u7684\u505a\u6cd5\uff0c\u628a\u5f53\u524d\u62e5\u6709\u7684\u94a5\u5319\u7528\u67d0\u79cd\u4e1c\u897f\u7ef4\u62a4\u8d77\u6765\u663e\u7136\u662f\u52a3\u7684\uff0c\u8003\u8651\u4f18\u5316\u6211\u4eec\u5224\u65ad\u80fd\u4e0d\u80fd\u5f00\u4e00\u4e2a\u95e8\u7684\u65b9\u6cd5\u3002  \n\n\u5047\u8bbe\u6211\u4ece $x$ \u70b9\u5f00\u59cb\u6269\u5c55\uff0c\u5f53\u524d\u5df2\u7ecf\u6269\u5c55\u5230\u7684\u533a\u95f4\u4e3a $[l,r]$\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u6269\u5c55\u5230 $r+1$\uff0c\u90a3\u4e48 $[l,r]$ \u5185\u81f3\u5c11\u6709\u4e00\u4e2a\u5c4b\u5b50\u91cc\u6709 $c_{r+1}$\uff0c\u56e0\u4e3a\u6211\u4ece\u5de6\u5411\u53f3\u8d70\uff0c\u53ea\u8981\u79bb $r+1$ \u6700\u8fd1\u7684\u51fa\u73b0\u4e86 $c_{r+1}$ \u7684\u4f4d\u7f6e\u5df2\u7ecf\u88ab\u6269\u5c55\u5230\u5373\u53ef\uff0c\u4e8e\u662f\u6211\u4eec\u53ea\u9700\u8981\u7ef4\u62a4\u4e00\u4e2a $L_i$ \u8868\u793a $c_i$ \u5728\u4e4b\u524d\u7684\u6700\u8fd1\u4e00\u6b21\u51fa\u73b0\u7684\u4f4d\u7f6e\u3002\u5411 $l-1$ \u6269\u5c55\u540c\u7406\u3002\n\n\u66b4\u529b\u6269\u5c55\u6bcf\u4e00\u4e2a\u70b9\u662f $n^2$ \u7684\uff0c\u8003\u8651\u4f18\u5316\u5b83\u3002\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u5df2\u7ecf\u6269\u5c55\u5b8c\u4e86\u4e00\u4e2a\u70b9\uff0c\u6b63\u5728\u6269\u5c55\u7684\u53e6\u4e00\u4e2a\u70b9\u6b64\u65f6\u6269\u5c55\u5230\u4e86\u5b83\uff0c\u90a3\u4e48\u8fd9\u4e2a\u70b9\u6240\u6709\u80fd\u5230\u7684\u4f4d\u7f6e\u6b63\u5728\u6269\u5c55\u7684\u70b9\u4e00\u5b9a\u90fd\u80fd\u5230\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5bf9\u4e24\u8005\u7684\u7b54\u6848\u53d6\u5e76\u96c6\u7ed9\u5f53\u524d\u6269\u5c55\u7684\u70b9\u3002\u8fd9\u6837\u8fdb\u884c\u7c7b\u4f3c\u8bb0\u5fc6\u5316\u641c\u7d22\uff0c\u6bcf\u6b21\u6211\u8981\u6269\u5c55\u4e00\u4fa7\u8fb9\u754c\u65f6\uff0c\u5c31\u4ece\u90a3\u4e2a\u8fb9\u754c\u5f00\u59cb\u505a\u4e00\u6b21\u6269\u5c55\uff0c\u7136\u540e\u53d6\u5e76\u96c6\u5373\u53ef\uff0c\u5982\u679c\u5df2\u7ecf\u6269\u5c55\u8fc7\u4e86\u5c31\u76f4\u63a5\u8fd4\u56de\u8dd1\u8def\u3002\n\n\u5b9e\u6d4b\u6bd4\u968f\u673a\u5316\u5feb\u4e00\u70b9\n\n\n```cpp\n#include <bits/stdc++.h>\ntypedef long long ll;typedef unsigned long long ull; typedef double db;typedef long double ldb;\n#define fre(x) freopen(#x \".in\",\"r\",stdin),freopen(#x \".out\",\"w\",stdout)\n#define Rep(i,a,b) for(int i=a;i<=b;++i) \n#define Dwn(i,a,b) for(int i=a;i>=b;--i)\n#define pii pair<int,int>\n#define mair make_pair\n#define fir first\n#define sec second\nusing namespace std;\n\nconst int maxn=5e5+10;\n\nint n,q;\nint c[maxn];\nvector<int>vec[maxn];\nint last[maxn];\nint L[maxn],R[maxn],p[maxn];\nbool vis[maxn];\npii rg[maxn];\n\nvoid Sol(int x){\n\tbool flag=false;\n\tif(vis[x])return void();\n\tif(rg[x].fir>0)return;\n\tvis[x]=true;\n\tint &l =rg[x].fir,&r=rg[x].sec;\n\tl=x,r=x;flag=true;\n\twhile(flag){\n\t\tflag=false;\n\t\tif(l>1 && R[l-1]>=l && R[l-1]<=r)\n\t\t{ Sol(l-1);flag=true; l=min(l,rg[l-1].fir),r=max(r,rg[l-1].sec); }\n\t\tif(r<n && L[r]<=r && L[r]>=l)\n\t\t{ Sol(r+1);flag=true; l=min(l,rg[r+1].fir),r=max(r,rg[r+1].sec); }\n\t}\n}\n\nvoid solve(){\n\tcin>>n;int x,y;\n\tfor(int i=1;i<n;++i)cin>>c[i];\n\tRep(i,1,n){\n\t\tcin>>y; Rep(j,1,y){ cin>>x;vec[i].push_back(x);last[x]=i; }\n\t\tif(i!=n)L[i]=last[c[i]];\n\t}\n\tRep(i,1,n)last[i]=n+1;\n\tDwn(i,n,1){ for(auto it : vec[i])last[it]=i; R[i-1]=last[c[i-1]]; }\n\tRep(i,1,n)Sol(i);\n\tcin>>q;\n\twhile(q--){\n\t\tcin>>x>>y;\n\t\tif(rg[x].fir<=y && rg[x].sec>=y)cout<<\"YES\\n\";\n\t\telse cout<<\"NO\\n\";\n\t}\n}\n\nint main (){ ios::sync_with_stdio(false),cin.tie(0),cout.tie(0);return solve(),0; }\n```",
        "postTime": 1663764760,
        "uid": 277792,
        "name": "Delov",
        "ccfLevel": 7,
        "title": "AT2540\u9898\u89e3"
    },
    {
        "content": "\u5728\u7ebf\u5904\u7406\u7684\u590d\u6742\u5ea6\u5f88\u9ad8\uff0c\u8003\u8651\u79bb\u7ebf\u5904\u7406\u540e $O(1)$ \u67e5\u8be2\u3002\n\n\u6211\u4eec\u8bbe\u70b9 $i$ \u80fd\u591f\u5230\u8fbe\u7684\u533a\u95f4\u4e3a $[l_i, r_i]$\uff0c\u5219 $x$ \u70b9\u53ef\u4ee5\u5230\u8fbe $y$ \u5f53\u4e14\u4ec5\u5f53 $l_i \\le y \\le r_i$\u3002\u4e8e\u662f\u95ee\u9898\u5373\u4e3a\u5982\u4f55\u5feb\u901f\u6c42\u89e3\u53ef\u53ca\u533a\u95f4\u3002\n\n\u8003\u8651\u5728\u5df2\u7ecf\u786e\u5b9a $i$ \u8282\u70b9\u5bf9\u5e94\u533a\u95f4\u4e3a $[l_i,r_i]$ \u7684\u60c5\u51b5\u4e0b\u68c0\u67e5 $l_i-1$ \u548c $r_i+1$ \u7684\u53ef\u53ca\u6027\u5e76\u62d3\u5c55\u3002\u8fd9\u91cc\u53ea\u8ba8\u8bba\u53f3\u4fa7\u7684\u62d3\u5c55\u65b9\u5f0f\uff0c\u5de6\u4fa7\u540c\u7406\u3002\n\n\u7531\u4e8e\u4e00\u6247\u95e8\u53ea\u9700\u8981\u4e00\u628a\u94a5\u5319\u6765\u6253\u5f00\uff0c\u4e0d\u96be\u60f3\u5230\u5bf9\u6bcf\u6247\u95e8 $i$ \u7ef4\u62a4\u5176\u524d\u540e\u7b2c\u4e00\u6b21\u51fa\u73b0 $C_i$ \u8fd9\u628a\u94a5\u5319\u7684\u4f4d\u7f6e\uff0c\u5e76\u5728\u5224\u65ad\u662f\u5426\u80fd\u5f00\u95e8\u65f6\u4f7f\u7528\u3002\u6709\u5c11\u8bb8\u7ec6\u8282\u3002\n\n\u9700\u8981\u6ce8\u610f\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u62d3\u5c55\u67d0\u4e00\u4fa7\u65f6\u6682\u65f6\u65e0\u6cd5\u8fdb\u884c\uff0c\u800c\u62d3\u5c55\u5b8c\u53e6\u4e00\u4fa7\u540e\u4fbf\u53ef\u8fdb\u884c\u7684\u60c5\u51b5\u3002\u56e0\u6b64\u9700\u8981\u5728\u4e24\u8fb9\u5747\u65e0\u6cd5\u62d3\u5c55\u540e\u624d\u53ef\u7ed3\u675f\u62d3\u5c55\u3002\n\n\u5177\u4f53\u5b9e\u73b0\u65b9\u9762\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u62d3\u5c55 $r+1$ \u89c6\u4e3a $[l,r]$ \u7684\u4e00\u4e2a\u5b50\u95ee\u9898\uff0c\u9012\u5f52\u6c42\u89e3\u3002\u51fd\u6570\u8fd4\u56de\u4ece $r+1$ \u5904\u80fd\u62d3\u5c55\u5230\u7684\u6700\u5927\u8303\u56f4\uff0c\u6211\u4eec\u4fbf\u53ef\u4ee5\u5c06\u8be5\u8303\u56f4\u4e0e\u5f53\u524d\u8303\u56f4\u53d6 $\\max$ \u6765\u66f4\u65b0\u7b54\u6848\u3002\n\n\u901a\u8fc7\u8bb0\u5fc6\u5316\u624b\u6bb5\uff0c\u4e0d\u96be\u8bc1\u660e\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u603b\u5171\u53ea\u4f1a\u62d3\u5c55\u4e00\u6b21\u533a\u95f4\u3002   \n\u7531\u4e8e\u8bb0\u5fc6\u5316\uff0c\u4e00\u6247\u95e8\u53ea\u4f1a\u88ab\u67e5\u8be2 $O(1)$ \u6b21\u53ef\u53ca\u6027\uff0c\u800c\u5355\u6b21\u67e5\u8be2\u53ef\u53ca\u6027\u7684\u590d\u6742\u5ea6\u662f $O(1)$ \u7684\u3002\u56e0\u6b64\u5747\u644a\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n)$\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <bits/stdc++.h>\n#define rep(i,a,b) for (register int (i) = (a); (i) <= (b); ++(i))\n#define pre(i,a,b) for (register int (i) = (a); (i) >= (b); --(i))\nusing namespace std;\nconst int N = 5e5 + 10, mod = 1e9 + 7;\nint n, q, c[N], t1, t2, pref[N], aft[N], tmp[N];\nvector<int> keys[N];\npair<int, int> mem[N];\n\n#ifdef ONLINE_JUDGE\n    char buf[1<<21], *p1 = buf, *p2 = buf;  inline char getc() { return (p1 == p2 and (p2 = (p1 = buf) + fread(buf, 1, 1<<21, stdin), p1 == p2) ? EOF : *p1++); }\n    #define getchar getc\n#endif\ntemplate <typename T> inline void get(T & x){\n    x = 0; char ch = getchar(); bool f = 0; while (ch < '0' or ch > '9') f = f or ch == '-',  ch = getchar();\n    while (ch >= '0' and ch <= '9') x = (x<<1) + (x<<3) + (ch^48), ch = getchar(); f and (x = -x);\n} template <typename T, typename ... Args> inline void get(T & x, Args & ... _Args) { get(x); get(_Args...); }\n\nvoid dfs(int p) {\n    if (mem[p].first >= 0) return;\n\n    int & l = mem[p].first, & r = mem[p].second;\n    l = p, r = p, t2 = 1;\n    while (t2) {\n        t2 = 0;\n        if (l > 1 and aft[l - 1] <= r) {\n            dfs(l - 1); \n            l = min(l, mem[l - 1].first);\n            r = max(r, mem[l - 1].second);\n            t2 = 1;\n        }\n        if (r < n and pref[r] >= l) { \n            dfs(r + 1);\n            l = min(l, mem[r + 1].first);\n            r = max(r, mem[r + 1].second);\n            t2 = 1;\n        }\n    } \n\n    return ;\n} \n\nint main() {\n    get(n);\n    rep(i,1,n-1) get(c[i]);\n    rep(i,1,n) {\n        get(t1);\n        keys[i].resize(t1);\n        for (int j = 0; j < t1; ++j) get(keys[i][j]);\n    } \n\n    rep(i,1,n) {\n        for (auto x : keys[i]) tmp[x] = i;\n        pref[i] = tmp[c[i]];\n    } \n    rep(i,1,n) tmp[i] = n + 1;\n    pre(i,n,1) {\n        aft[i] = tmp[c[i]];\n        for (auto x : keys[i]) tmp[x] = i;\n    } \n\n    rep(i,1,n) mem[i] = {-1, -1};\n    rep(i,1,n) dfs(i);\n\n    get(q);\n    while (q--) {\n        get(t1, t2); \n        if (mem[t1].first <= t2 and t2 <= mem[t1].second) puts(\"YES\");\n        else puts(\"NO\");\n    }\n\n    return 0;\n}\n```",
        "postTime": 1663758263,
        "uid": 631791,
        "name": "joke3579",
        "ccfLevel": 0,
        "title": "AT2540 \u5e7d\u6df1\u5e9c\u90b8 \u9898\u89e3"
    },
    {
        "content": "\u4e00\u9053\u597d\u9898\u3002\n\n\n------------\n\n\n\u8003\u8651\u5728\u7ebf\u56de\u7b54\u8be2\u95ee\u4e0d\u597d\u5904\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u63d0\u524d\u9884\u5904\u7406\u51fa\u6bcf\u4e2a\u70b9\u623f\u95f4\u80fd\u8d70\u5230\u7684\u4f4d\u7f6e\uff0c\u663e\u7136\uff0c\u6bcf\u4e2a\u623f\u95f4\u80fd\u5230\u8fbe\u7684\u70b9\u96c6\u662f\u4e00\u6bb5\u8fde\u7eed\u7684\u533a\u95f4\u3002\n\n\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u66b4\u529b\u5904\u7406\u7684\u8bdd\uff0c\u8981 $n^2$ \u590d\u6742\u5ea6\u3002\n\n\n------------\n\n\n\u8003\u8651\u4f18\u5316\u3002\n\n\u6211\u4eec\u53d1\u73b0\u5982\u679c\u4ece $x$ \uff0c\u80fd\u8d70\u5230 $y$ \uff0c\u90a3\u4e48 $x$ \u4e00\u5b9a\u80fd\u8d70\u5230 $y$ \u80fd\u8d70\u5230\u7684\u6240\u6709\u5730\u65b9\uff0c\u8fd9\u6837\u53ef\u4ee5\u628a\u7b54\u6848\u8fdb\u884c\u8f83\u5feb\u901f\u7684\u66f4\u65b0\u3002\n\n\u5177\u4f53\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u9884\u5904\u7406\u51fa\u6bcf\u4e00\u95f4\u623f\u95f4\u5de6\u8fb9\u7b2c\u4e00\u628a\u80fd\u6253\u5f00\u4ed6\u7684\u94a5\u5319\uff0c\u548c\u53f3\u8fb9\u7b2c\u4e00\u628a\u80fd\u6253\u5f00\u4ed6\u7684\u94a5\u5319\u3002\u5176\u4ed6\u94a5\u5319\u5bf9\u4ed6\u5176\u5b9e\u90fd\u6ca1\u6709\u8d21\u732e\uff0c\u56e0\u4e3a\u5982\u679c\u80fd\u7528\u5176\u4ed6\u94a5\u5319\u5fc5\u7136\u80fd\u7528\u8fd9\u4e24\u628a\u3002\u7136\u540e\u5224\u65ad\u80fd\u4e0d\u80fd\u6253\u5f00\u4e00\u4e2a\u95e8\uff0c\u5c31\u5224\u65ad\u5df2\u7ecf\u6709\u7684\u533a\u95f4\u662f\u5426\u5305\u542b\u94a5\u5319\u3002\n\n\u7136\u800c\u8fd8\u662f\u6709\u7279\u6b8a\u6784\u9020\u6570\u636e\uff0c\u53ef\u4ee5\u5361\u6389\u5b83\u3002\n\n\n------------\n\n\n\u8003\u8651\u968f\u673a\u5316\uff0c\u6211\u4eec\u968f\u673a\u9009\u62e9\u66f4\u65b0 i \u53ef\u4ee5\u5230\u8fbe\u7684\u533a\u95f4\u987a\u5e8f\u3002\n\n\u5177\u4f53\u7684\u53ef\u4ee5\u7528 shuffle \u51fd\u6570\u5b9e\u73b0\u3002\n\n\u8fd9\u6837\u6bcf\u6b21\u66f4\u65b0\u671f\u671b\u53ea\u8981\u66f4\u65b0 $\\log n$ \u6b21\u3002\n\n\n------------\n\n\n\u8fd9\u6837\u5c31\u80fd\u987a\u5229\u7684\u901a\u8fc7\uff0c~~\u8dd1\u7684\u98de\u5feb\uff0c\u611f\u89c9\u8dd1\u51fa O(n)\u7684\u6548\u679c~~\u3002\n\n\n------------\n\n\n\u4ee3\u7801\u5982\u4e0b\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n//static char buf[1000000],*p1=buf,*p2=buf;\n//#define getchar() p1==p2&&(p2=(p1=buf)+fread(buf,1,1000000,stdin),p1==p2)?EOF:*p1++\n#define pi pair<int,int>\n#define mp make_pair\n#define fi first\n#define se second\n#define pb push_back\n#define mid (l+r>>1)\n#define lowbit (x&-x)\nconst int maxn=5e5+5,M=34005;\ninline int read()\n{\n\tchar ch=getchar();bool f=0;int x=0;\n\tfor(;!isdigit(ch);ch=getchar())if(ch=='-')f=1;\n\tfor(;isdigit(ch);ch=getchar())x=(x<<1)+(x<<3)+(ch^48);\n\tif(f==1)x=-x;return x;\n}\ninline void print(int x)\n{\n    static int a[55];int top=0;\n    if(x<0) putchar('-'),x=-x;\n    do{a[top++]=x%10,x/=10;}while(x);\n    while(top) putchar(a[--top]+48);\n}\nmt19937 rnd(time(0));\nint L[maxn],R[maxn],n,m,ly[maxn],ry[maxn],s[maxn],g,c[maxn],x,y,q,vis[maxn],p[maxn];\nvector<int>b[maxn];\nvoid add(int i)\n{\n\tint l=i,r=i;int F=1;vis[i]=1;\n\twhile(F)\n\t{\n\t\tF=0;\n\t\twhile(l>1&&ry[l-1]>=l&&ry[l-1]<=r)\n\t\t{\n\t\t\tl--;F=1;\n\t\t\tif(vis[l])l=min(l,L[l]),r=max(r,R[l]);\n\t\t}\n\t\twhile(r<n&&ly[r]<=r&&ly[r]>=l)\n\t\t{\n\t\t\tr++;F=1;\n\t\t\tif(vis[r])l=min(l,L[r]),r=max(r,R[r]);\n\t\t}\n\t}L[i]=l,R[i]=r;\n}\nsigned main()\n{\n\tn=read();\n\tfor(int i=1;i<n;i++)c[i]=read();\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tx=read();\n\t\tfor(int j=1;j<=x;j++)\n\t\t\tg=read(),b[i].push_back(g),s[g]=i;\n\t\tif(i!=n)ly[i]=s[c[i]];\n\t}\n\tfor(int i=1;i<=n;i++)s[i]=n+1;\n\tfor(int i=n;i>=1;i--)\n\t{\n\t\tfor(auto j:b[i])s[j]=i;\n\t\try[i-1]=s[c[i-1]];\n\t}\n\tfor(int i=1;i<=n;i++)p[i]=i;\n\tshuffle(p+1,p+1+n,rnd);\n\tfor(int i=1;i<=n;i++)add(p[i]);\n\tq=read();\n\tfor(int i=1;i<=q;i++)\n\t{\n\t\tx=read(),y=read();\n\t\tif(L[x]<=y&&R[x]>=y)puts(\"YES\");\n\t\telse puts(\"NO\");\n\t}\n \treturn 0;\n}\n\n\n/*********************************************************************\n    \u4f5c\u8005:louhao088\n    \u65e5\u671f: 2021-11-11 11:11\n*********************************************************************/\n\n```\n\n",
        "postTime": 1636618702,
        "uid": 343748,
        "name": "louhao088",
        "ccfLevel": 9,
        "title": "\u9898\u89e3AT2540 \u7d30\u9577\u3044\u5c4b\u6577 (Long Mansion)"
    },
    {
        "content": " \u8fd9\u4e2a\u9898\u5176\u5b9e\u633a\u7b80\u5355\u7684...\u5c31\u662f\u601d\u8def\u6ca1\u5f00\u5316\n \n- \u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u6bcf\u4e00\u4e2a\u70b9\u5411\u5de6\u5411\u53f3\u53ef\u4ee5\u6269\u5c55\u5230\u7684\u8ddd\u79bb\uff0c\u76f4\u63a5 $O(1)$ \u67e5\u5c31\u884c\u3002\n\n- \u8003\u8651\u5982\u4f55\u6269\u5c55\uff1a\n\n    - \u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u95e8\uff0c\u5176\u5b9e\u5bf9\u4ed6\u6709\u7528\u7684\u53ea\u6709\u80fd\u6253\u5f00\u5b83\u7684\u7b2c\u4e00\u628a\u94a5\u5319\uff0c\u6240\u4ee5\u6211\u4eec\u7ef4\u62a4\u51fa\u6bcf\u4e00\u4e2a\u95e8\u5de6\u8fb9\u6700\u9760\u8fd1\u5b83\u548c\u53f3\u8fb9\u6700\u9760\u8fd1\u5b83\u7684\u94a5\u5319\u5728\u54ea\u91cc\uff0c\u8fd9\u4e2a\u4e1c\u897f\u53ef\u4ee5\u5728\u8bfb\u5165\u65f6\u5904\u7406\uff0c\u56e0\u4e3a\u6211\u662f\u4ece\u5de6\u5230\u53f3\u8bfb\u5165\u7684\uff0c\u6709\u5355\u8c03\u6027\u987a\u5e8f\u7684\uff0c\u53f3\u8fb9\u5c31\u5012\u8fc7\u6765\u5904\u7406\u5c31\u884c\u3002\u5373\u662f\u6211\u5bf9\u4e8e\u5de6\u8fb9\u6700\u9760\u8fd1\u6211\u7684\u94a5\u5319\u53ea\u9700\u8981\u4e00\u76f4\u5b58\uff0c\u5f53\u626b\u5230\u6211\u65f6\u4e0a\u4e00\u6b21\u5b58\u7684\u5c31\u662f\u6211\u5bf9\u5e94\u7684\u6700\u8fd1\u7684\u94a5\u5319\uff0c\u5bf9\u4e8e\u53f3\u8fb9\u6211\u5c06\u539f\u5e8f\u5217\u5b58\u4e0b\u6765\u518d\u6b21\u5012\u8fc7\u6765\u904d\u5386\uff0c\u7136\u540e\u5b58\u5c31\u884c\u3002\u8fd9\u663e\u7136\u662f $O(n)$\u3002\n    \n    - \u7ef4\u62a4\u597d\u4e86\u4e4b\u540e\u5c31\u53ef\u4ee5\u76f4\u63a5\u6269\u5c55\u4e86\uff0c\u4f8b\u5982\u5411\u5de6\u6269\u5c55\uff0c\u5982\u679c\u6211\u5f53\u524d\u80fd\u5230\u8fbe\u7684\u533a\u95f4\u4e2d\u5305\u542b\u4e86\u6211\u73b0\u5728\u8981\u6269\u5c55\u7684\u95e8\u6240\u9700\u8981\u7684\u53f3\u8fb9\u6700\u9760\u8fd1\u5b83\u7684\u94a5\u5319\uff0c\u6211\u5c31\u53ef\u4ee5\u66f4\u65b0\uff0c\u53cd\u4e4b\u5219\u4e0d\u884c\uff0c\u53f3\u8fb9\u540c\u7406\uff0c\u5305\u542b\u6700\u9760\u5de6\u7684\u5c31\u884c\u3002\u5c31\u662f\u6ce8\u610f\u5411\u5de6\u548c\u5411\u53f3\u6269\u5c55\u7684\u65f6\u5019\u67e5\u7684\u94a5\u5319\u4e0d\u4e00\u6837\uff0c\u56e0\u4e3a\u5411\u53f3\u8fb9\u7684\u65f6\u4f60\u53ea\u9700\u8981 $i - 1$ \u7684\u94a5\u5319\uff0c \u800c\u5411\u5de6\u6269\u5c55\u7684\u65f6\u5019\u786e\u786e\u5b9e\u5b9e\u9700\u8981\u7684\u662f $i$ \u7684\u94a5\u5319\uff0c\u8fd9\u91cc\u8981\u6ce8\u610f\u3002\u56e0\u4e3a\u662f\u66b4\u529b\u6269\u5c55\u7684\uff0c\u671f\u671b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5927\u6982\u662f $O(n \\log n)$ \u7684\uff0c\u5177\u4f53\u4e0d\u592a\u4f1a\u8bc1\uff0c\u8fd9\u91cc\u53ea\u63d0\u4f9b\u601d\u8def\u3002\n\n- \u5bf9\u4e8e\u968f\u673a\u5316\u8fd9\u4e2a\u95ee\u9898\uff0c\u5728\u8fd9\u4e2a\u9898\u4e0d\u968f\u673a\u5316\u8dd1\u5f97\u6bd4\u968f\u673a\u5316\u5feb\uff0c\u6240\u4ee5\u5982\u679c\u4e0d\u662f\u9047\u5230\u4e86\u7279\u522b\u6076\u5fc3\u7684\u6784\u9020\u6570\u636e\uff0c\u4e0d\u968f\u673a\u5316\u8fd8\u662f\u8dd1\u5f97\u8d77\u6765\u7684\u3002\n    \n\n\n\n\n[\u6bcf\u65e5\u4e00\u56fe](https://www.cnblogs.com/kiritokazuto/p/16719796.html#5104700)\n```cpp\n\n\n#include <bits/stdc++.h>\n#define LL long long\n#define Re register int\n#define LD double\n#define mes(x, y) memset(x, y, sizeof(x))\n#define cpt(x, y) memcpy(x, y, sizeof(x))\n#define fuc(x, y) inline x y\n#define fr(x, y, z)for(Re x = y; x <= z; x ++)\n#define fp(x, y, z)for(Re x = y; x >= z; x --)\n#define frein(x) freopen(#x \".in\", \"r\", stdin)\n#define freout(x) freopen(#x \".out\", \"w\", stdout)\n#define ki putchar('\\n')\n#define fk putchar(' ')\n#define WMX aiaiaiai~~\n#define pr(x, y) pair<x, y>\n#define mk(x, y) make_pair(x, y)\n#define pb(x) push_back(x)\n#define sec second\n#define fst first\n\nusing namespace std;\nnamespace kiritokazuto{\n    auto read = [](){\n        LL x = 0;\n        int f = 1;\n        char c;\n        while (!isdigit(c = getchar())){ if (c == '-')f = -1; }\n        do{ x = (x << 1) + (x << 3) + (c ^ 48); } while (isdigit(c = getchar()));\n        return x * f;\n    };\n    template <typename T> fuc(void, write)(T x){\n        if (x < 0)putchar('-'), x = -x;\n        if (x > 9)write(x / 10); putchar(x % 10 | '0');\n    }\n}\n\nusing namespace kiritokazuto;\n\nconst int maxn = 6e5 + 100, Mod = 1e9 + 7;\nconst LL Inf = 2147483647, ord = 1e10;\nint n;\nint l[maxn], r[maxn];\nint lk[maxn], rk[maxn];\nint L, R;\nfuc(void, updata)(int x) {\n    L = min(l[x], L);\n    R = max(r[x], R);\n}\nint c[maxn];\nint tmp[maxn];\n\nint pos[maxn];\nint q;\n\nvector <int> Key[maxn];\nfuc(bool, lwork)() {\n    if(L == 1)return 0;\n    if(L <= rk[L - 1] && rk[L - 1] <= R) {\n        if(l[--L]) {\n            updata(L);\n        }\n        return 1;\n    }\n    return 0;\n}\nfuc(bool, rwork)() {\n    if(R == n)return 0;\n    if(L <= lk[R] && lk[R] <= R) {\n        if(r[++R]) {\n            updata(R);\n        }\n        return 1;\n    }\n    return 0;\n} \nfuc(void, work)(int x){\n    L = R = x;\n    while(1) {if(!lwork() && !rwork())break;}\n    l[x] = L;\n    r[x] = R;\n}\nsigned main() { \n    n = read();\n    fr(i, 1, n - 1)c[i] = read();\n    fr(i, 1, n) {\n        pos[i] = i;\n        int x = read();\n        fr(j, 1, x) {\n            int tp = read();\n            Key[i].pb(tp);\n            tmp[tp] = i;\n        }   \n        if(i != n)lk[i] = tmp[c[i]];\n    }\n    fr(i, 1, n)tmp[i] = n + 1;\n    fp(i, n, 1) {\n        for(auto j : Key[i]) {\n            tmp[j] = i;\n        }\n        rk[i - 1] = tmp[c[i - 1]];\n    }\n    fr(i, 1, n) {\n        work(pos[i]);\n    }\n    q = read();\n    fr(i, 1, q) {\n        int x = read(),y = read();\n        if(l[x] <= y && y <= r[x]) {\n            puts(\"YES\");\n            continue;\n        }else {\n            puts(\"NO\");\n        }\n    }\n  \n    return 0;\n}  \n\n\n```\n\n",
        "postTime": 1663918941,
        "uid": 277777,
        "name": "kiritokazuto",
        "ccfLevel": 0,
        "title": "\u7d30\u9577\u3044\u5c4b\u6577"
    },
    {
        "content": "\u7c7b\u4f3c\u7684\u9898\uff1aP4436\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u4ece\u6bcf\u4e2a\u8282\u70b9\u5f00\u59cb\u8d70\uff0c\u80fd\u8d70\u5230\u7684\u662f\u4e00\u6bb5\u533a\u95f4\uff0c\u8bb0\u4f5c $S_x=[L_x,R_x]$\u3002\n\n\u5982\u679c\u5df2\u7ecf\u6709\u4e00\u4e2a\u533a\u95f4\uff0c\u8981\u5224\u65ad\u80fd\u4e0d\u80fd\u5411\u5de6 / \u53f3\u8d70\u4e00\u6b65\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e8c\u5206 $O(\\log n)$ \u6216\u9884\u5904\u7406\u540e $O(1)$\uff08\u867d\u7136\u4e8c\u5206\u7684\u5b9e\u9645\u6548\u7387\u4e0e $O(1)$ \u975e\u5e38\u63a5\u8fd1\uff09\u3002\n\n\u8003\u8651\u7528\u8bb0\u5fc6\u5316\u641c\u7d22\u7684\u65b9\u6cd5\u6c42\u51fa $S_x$\u3002\u5177\u4f53\u5730\uff0c\u5982\u679c\u4ece\u533a\u95f4 $[L_x,R_x]$ \u53ef\u4ee5\u8d70\u5230 $[L_x-1,R_x]$\uff0c\u90a3\u4e48\u5148\u5bf9 $L_x-1$ \u8fd9\u4e2a\u70b9\u6c42\u89e3\uff08\u6c42\u51fa $S_{L_x-1}$\uff09\uff0c\u7136\u540e\u66f4\u65b0 $S_x\\leftarrow S_x\\cup S_{L_x-1}$\uff0c\u7136\u540e\u7ee7\u7eed\u8d70\u3002$R_x+1$ \u540c\u7406\u3002\n\n\u5206\u6790\u590d\u6742\u5ea6\uff1a\u5982\u679c\u4e00\u4e2a $[L_x,R_x]$ \u53ef\u4ee5\u5411\u5de6\u8d70\u4e00\u6b65\uff0c\u90a3\u4e48\u4e00\u5b9a\u6709 $S_{L_x-1}\\subseteq S_x$\uff08\u53f3\u540c\u7406\uff09\u3002$x$ \u53ea\u9700\u8981\u5728\u6b64\u57fa\u7840\u4e0a\u7ee7\u7eed\u5411\u4e24\u8fb9\u8d70\u3002\u6240\u4ee5\u4e00\u5171\u9700\u8981\u8d70 $O(n)$ \u6b65\u3002\n\n\u603b\u590d\u6742\u5ea6 $O(n+m)$\uff0c\u4ee3\u7801\u4f7f\u7528\u4e8c\u5206\uff0c\u6700\u591a\u53ea\u6162\u4e86 30ms\u3002\n\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <algorithm>\n#include <vector>\n\n#define N 500010\nint n, m;\nint col[N];\nstd::vector <int> v[N];\nint len[N];\n\ninline bool query(int k, int ql, int qr)\n{\n\tint sz = len[k];\n\tint l = 0, r = sz - 1, res = n + 1;\n\twhile(l <= r && res > qr)\n\t{\n\t\tint mid = (l + r) >> 1;\n\t\tif(v[k][mid] >= ql)\n\t\t\tr = mid - 1, res = v[k][mid];\n\t\telse\n\t\t\tl = mid + 1;\n\t}\n\treturn res <= qr;\n}\nint L[N], R[N];\nvoid dfs(int k)\n{\n\tif(L[k])\n\t\treturn;\n\tL[k] = R[k] = k;\n\twhile(1)\n\t{\n\t\tbool flag = 0;\n\t\twhile(L[k] > 1 && query(col[L[k] - 1], L[k], R[k]))\n\t\t{\n\t\t\tL[k]--;\n\t\t\tif(!L[L[k]])\n\t\t\t\tdfs(L[k]);\n\t\t\tR[k] = std::max(R[k], R[L[k]]);\n\t\t\tL[k] = L[L[k]];\n\t\t\tflag = 1;\n\t\t}\n\t\twhile(R[k] < n && query(col[R[k]], L[k], R[k]))\n\t\t{\n\t\t\tR[k]++;\n\t\t\tif(!R[R[k]])\n\t\t\t\tdfs(R[k]);\n\t\t\tL[k] = std::min(L[k], L[R[k]]);\n\t\t\tR[k] = R[R[k]];\n\t\t\tflag = 1;\n\t\t}\n\t\tif(!flag)\n\t\t\tbreak;\n\t}\n}\n\nint read()\n{\n\tint x = 0;\n\tchar c = getchar();\n\twhile(c < '0' || '9' < c)\n\t\tc = getchar();\n\twhile('0' <= c && c <= '9')\n\t{\n\t\tx = (x << 3) + (x << 1) + (c ^ 48);\n\t\tc = getchar();\n\t}\n\treturn x;\n}\n\nint main()\n{\n\tn = read();\n\tfor(int i = 1; i < n; i++)\n\t\tcol[i] = read();\n\tfor(int i = 1, x, b; i <= n; i++)\n\t{\n\t\tb = read();\n\t\twhile(b--)\n\t\t{\n\t\t\tx = read();\n\t\t\tv[x].push_back(i);\n\t\t}\n\t}\n\tfor(int i = 1; i <= n; i++)\n\t\tlen[i] = v[i].size();\n\tfor(int i = 1; i <= n; i++)\n\t\tdfs(i);\n\tm = read();\n\tfor(int i = 1, x, y; i <= m; i++)\n\t{\n\t\tx = read(), y = read();\n\t\tif(L[x] <= y && y <= R[x])\n\t\t\tputchar('Y'), putchar('E'), putchar('S'), putchar('\\n');\n\t\telse\n\t\t\tputchar('N'), putchar('O'), putchar('\\n');\n\t}\n\treturn 0;\n}\n\n```",
        "postTime": 1682171768,
        "uid": 371968,
        "name": "ningago",
        "ccfLevel": 4,
        "title": "AT_joisc2017_h"
    }
]