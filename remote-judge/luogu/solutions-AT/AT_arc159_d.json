[
    {
        "content": "## \u524d\u8a00\n\n\u5783\u573e D \u9898\uff0c\u73b0\u5728 AtCoder \u7684\u67d0\u4e9b\u9898\u76ee\u8d8a\u6765\u8d8a\u70c2\u4e86\u3002\u4e0d\u8fc7\u4e0d\u592a\u7406\u89e3\u4e3a\u4ec0\u4e48\u8d5b\u65f6\u6ca1\u51e0\u4e2a\u4eba\u8fc7\u3002\n\n## \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u7528\u4e00\u5806 $l_i,l_i+,...,r_i$ \u62fc\u8d77\u6765\u7684\u5e8f\u5217\uff0c\u6c42\u6700\u957f\u4e0a\u5347\u5b50\u5e8f\u5217\u957f\u5ea6\u3002\n\n## \u601d\u8def\n\n\u4ee4 $f_i$ \u8868\u793a\u4ee5 $r_i$ \u7ed3\u5c3e\u7684\u6700\u957f\u4e0a\u5347\u5b50\u5e8f\u5217\u957f\u5ea6\u3002\u5219 $f_i=\\max(\\max\\{r_i+f_j-r_j|r_j\\ge l_i\\},\\max\\{r_i-l_i+1+f_j|r_j<l_i\\})$\u3002\n\n\u7136\u540e\u8fd9\u4e2a\u663e\u7136\u53ef\u4ee5\u79bb\u6563\u5316 $l_i$ \u548c $r_i$ \u540e\u7528\u4e24\u68f5\u6743\u503c\u7ebf\u6bb5\u6811\u5206\u522b\u7ef4\u62a4 $f_i$ \u548c $f_i-r_i$ \u7684\u6700\u5927\u503c\u3002\u5c31\u7ed3\u675f\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log_2n)$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int NN=2e5+4;\nint f[NN],l[NN],r[NN];\nstruct node\n{\n\tstruct segment_tree\n\t{\n\t\tint l,r,v;\n\t}tr[NN<<3];\n\tvoid pushup(int u)\n\t{\n\t\ttr[u].v=max(tr[u<<1].v,tr[u<<1|1].v);\n\t}\n\tvoid build(int u,int l,int r)\n\t{\n\t\ttr[u]={l,r,0};\n\t\tif(l==r)\n\t\t{\n\t\t\ttr[u].v=-1e9;\n\t\t\treturn;\n\t\t}\n\t\tint mid=l+(r-l)/2;\n\t\tbuild(u<<1,l,mid);\n\t\tbuild(u<<1|1,mid+1,r);\n\t\tpushup(u);\n\t}\n\tvoid modify(int u,int p,int v)\n\t{\n\t\tif(tr[u].l==tr[u].r)\n\t\t{\n\t\t\ttr[u].v=max(tr[u].v,v);\n\t\t\treturn;\n\t\t}\n\t\tint mid=tr[u].l+(tr[u].r-tr[u].l)/2;\n\t\tif(p<=mid)\n\t\t\tmodify(u<<1,p,v);\n\t\telse\n\t\t\tmodify(u<<1|1,p,v);\n\t\tpushup(u);\n\t}\n\tint query(int u,int l,int r)\n\t{\n\t\tif(tr[u].l>=l&&tr[u].r<=r)\n\t\t\treturn tr[u].v;\n\t\tint mid=tr[u].l+(tr[u].r-tr[u].l)/2,res=-1e9;\n\t\tif(l<=mid)\n\t\t\tres=max(res,query(u<<1,l,r));\n\t\tif(r>mid)\n\t\t\tres=max(res,query(u<<1|1,l,r));\n\t\treturn res;\n\t}\n}A,B;\nsigned main()\n{\n\tint n;\n\tscanf(\"%lld\",&n);\n\tvector<int>nums;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%lld%lld\",&l[i],&r[i]);\n\t\tnums.push_back(l[i]);\n\t\tnums.push_back(r[i]);\n\t}\n\tnums.push_back(0);\n\tsort(nums.begin(),nums.end());\n\tnums.erase(unique(nums.begin(),nums.end()),nums.end());\n\tA.build(1,1,nums.size());\n\tB.build(1,1,nums.size());\n\tA.modify(1,1,0);\n\tB.modify(1,1,0);\n\tint ans=0;\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tint pl=lower_bound(nums.begin(),nums.end(),l[i])-nums.begin()+1,pr=lower_bound(nums.begin(),nums.end(),r[i])-nums.begin()+1;\n\t\tf[i]=max(f[i]+r[i]-l[i]+1+A.query(1,1,pl-1),f[i]+r[i]+B.query(1,pl,pr));\n\t\tans=max(ans,f[i]);\n\t\tA.modify(1,pr,f[i]);\n\t\tB.modify(1,pr,f[i]-r[i]);\n\t}\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1681008579,
        "uid": 132424,
        "name": "\u826f\u5fc3WA\u9898\u4eba",
        "ccfLevel": 7,
        "title": "ARC159-problem D"
    },
    {
        "content": "\u5783\u573e\u9898\u3002\n\n#### \u9898\u610f\n\n\u521d\u59cb\u65f6\u6709\u4e00\u4e2a\u7a7a\u5e8f\u5217 $A$\uff0c\u63a5\u4e0b\u6765 $n$ \u6b21\u64cd\u4f5c\uff0c\u6bcf\u6b21\u7ed9\u5b9a $l_i, r_i$\uff0c\u7136\u540e\u628a $l_i, l_i + 1, l_i + 2, \\dots, r_i$ \u4f9d\u6b21\u63d2\u5165 $A$ \u7684\u672b\u5c3e\uff0c\u6c42\u6700\u7ec8 $A$ \u7684\u4e25\u683c\u6700\u957f\u4e0a\u5347\u5b50\u5e8f\u5217\u3002\n\n$1 \\leq n \\leq 2 \\cdot 10^5, 1 \\leq l_i \\leq r_i \\leq 10^9$\u3002\n\n#### \u9898\u89e3\n\n\u8003\u8651\u7528\u4e8c\u5206 + \u6808\u7684\u505a\u6cd5\u53bb\u6c42 LIS\u3002\u5982\u679c\u5f53\u524d\u7684\u6808\u662f $s$\uff0c\u63d2\u5165\u4e00\u6574\u4e2a\u533a\u95f4 $[l_i, r_i]$ \u65f6\uff0c\u5047\u8bbe\u63d2\u5165 $l_i$ \u65f6\u628a $s_p$ \u66ff\u6362\u6210 $l_i$\uff0c\u90a3\u4e48\u63d2\u5165 $l_i + 1$ \u65f6\u5c31\u4f1a\u628a $s_{p + 1}$ \u66ff\u6362\u6210 $l_i + 1$\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u6700\u540e\u63d2\u5165 $r_i$ \u7684\u65f6\u5019\u4f1a\u628a $s_{p + r_i - l_i}$ \u66ff\u6362\u6210 $r_i$\uff08\u5982\u679c\u5f53\u524d\u6808\u7684\u5927\u5c0f\u4e3a $k$\uff0c\u90a3\u4e48 \u201c\u628a $s_{k + 1}$ \u66ff\u6362\u6210 $x$\u201d \u5c31\u8868\u793a\u5f80 $s$ \u540e\u9762\u538b\u5165\u4e00\u4e2a\u6570 $x$\uff09\u3002\n\n\u4e8e\u662f\u53ef\u4ee5\u53d1\u73b0\u8fd9\u4e2a\u6808\u4e00\u5b9a\u662f\u7531\u82e5\u5e72\u6bb5\u533a\u95f4\u62fc\u8d77\u6765\u7684\uff0c\u6bcf\u6b21\u63d2\u5165\u4e00\u4e2a\u65b0\u533a\u95f4\u7684\u65f6\u5019\uff0c\u4f1a\u5220\u9664\u4e00\u4e9b\u533a\u95f4\uff0c\u4fee\u6539 $O(1)$ \u4e2a\u533a\u95f4\uff0c\u518d\u63d2\u5165 $1$ \u4e2a\u65b0\u533a\u95f4\uff0c\u8fd9\u662f\u5bb9\u6613\u7528 `set` \u7ef4\u62a4\u7684\u3002\u7531\u4e8e\u6bcf\u4e2a\u533a\u95f4\u53ea\u4f1a\u88ab\u63d2\u5165\u4e00\u6b21\uff0c\u5220\u9664\u4e00\u6b21\uff0c\u603b\u590d\u6742\u5ea6\u662f $O(n \\log n)$ \u7684\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#include <set>\nint n;\nstd::set<std::pair<int, int>> st; \nint main(void)\n{\n\tscanf(\"%d\", &n);\n\tfor(int i = 1, l, r;i <= n;++i)\n\t{\n\t\tscanf(\"%d%d\", &l, &r);\n\t\tauto it = st.lower_bound({l + 1, 0});\n\t\tif(it != st.begin())\n\t\t\tl = std::max(std::prev(it)->second + 1, l);\n\t\tif(l > r)\n\t\t\tcontinue;\n\t\tint rem = r - l + 1;\n\t\twhile(rem && it != st.end())\n\t\t\tif(it->second - it->first + 1 <= rem)\n\t\t\t\trem -= (it->second - it->first + 1), st.erase(it++);\n\t\t\telse\n\t\t\t\tst.insert({it->first + rem, it->second}), rem = 0, st.erase(it); \n\t\tst.insert({l, r});\n\t}\n\tint ans = 0;\n\tfor(auto pr : st)\n\t\tans += pr.second - pr.first + 1;\n\tprintf(\"%d\\n\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1681459163,
        "uid": 244204,
        "name": "namelessgugugu",
        "ccfLevel": 9,
        "title": "ARC159D \u9898\u89e3"
    },
    {
        "content": "~~\u9996\u5148\u9898\u76ee\u90fd\u53eb LIS \u4e86\uff0c\u663e\u7136\u53ef\u4ee5\u8bd5\u8bd5 dp\u3002~~\n\n\u8fd9\u9898\u653e\u5728 D \u662f\u79bb\u8c31\u7684\uff0c\u8d5b\u65f6\u591a\u4e8f\u7b2c\u4e00\u773c\u4e0d\u4f1a C \u624d\u5f00\u4e86\u8fd9\u9898\uff08bushi\n\n\u9996\u5148\u53d1\u73b0\u5018\u82e5\u4e00\u6bb5\u4e4b\u540e\u80fd\u63a5\u4e0a\u4e0b\u4e00\u6bb5\uff0c\u5219\u63a5\u4e0a\u4e00\u5b9a\u4f18\uff0c\u4e0d\u59a8\u8bbe\u8ba1 $ f_i $ \u8868\u793a\u4ee5 $ r_i $ \u7ed3\u5c3e\u7684 LIS \u7684\u957f\u5ea6\u3002\n\n\u8f6c\u79fb\u5219\u5341\u5206\u597d\u529e\uff1a\n\n\u82e5 $ r_j<l_i $\uff0c$ f_i=f_j+r_i-l_i+1 $\u3002\n\n\u82e5 $ r_j>l_i $\uff0c$ f_i=f_j+r_i-r_j $\u3002\n\n\u7136\u540e\u5c31\u53d1\u73b0\u53ef\u4ee5\u7ebf\u6bb5\u6811\u4f18\u5316 dp\u3002\n\n\u4ee3\u7801\u5982\u4e0b\uff1a\n\n```cpp\n#include<iostream>\n#include<iomanip>\n#include<cmath>\n#include<cstring>\n#include<cstdio>\n#include<algorithm>\n#include<queue>\nusing namespace std;\n#define int long long\n#define md(a) a=(a%mod+mod)%mod\n#define file(a) freopen(#a\".in\",\"r\",stdin);freopen(#a\".out\",\"w\",stdout)\nconst int N=400005,inf=1e16;\nint n,m,l[N],r[N],rl[N],rr[N],f[N],cnt,b[N];\nstruct S\n{\n\tstruct Seg{int l,r,dat;}tree[N*4];\n\tvoid pushup(int v){tree[v].dat=max(tree[v*2].dat,tree[v*2+1].dat);}\n\tvoid build(int v,int l,int r)\n\t{\n\t\ttree[v]={l,r,-inf};if(l==r)return ;\n\t\tint mid=l+r>>1;build(v*2,l,mid),build(v*2+1,mid+1,r);\n\t}\n\tvoid add(int v,int x,int d)\n\t{\n\t\tif(tree[v].l>x||tree[v].r<x)return ;\n\t\tif(tree[v].l==tree[v].r)return void(tree[v].dat=max(tree[v].dat,d));\n\t\tadd(v*2,x,d),add(v*2+1,x,d),pushup(v);\n\t}\n\tint ask(int v,int l,int r)\n\t{\n\t\tif(tree[v].l>r||tree[v].r<l)return -inf;\n\t\tif(l<=tree[v].l&&tree[v].r<=r)return tree[v].dat;\n\t\treturn max(ask(v*2,l,r),ask(v*2+1,l,r));\n\t}\n}A,B;\nsigned main()\n{\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld%lld\",&l[i],&r[i]),b[++cnt]=l[i],b[++cnt]=r[i];\n\tsort(b+1,b+cnt+1),m=unique(b+1,b+cnt+1)-b-1;\n\tfor(int i=1;i<=n;i++)rl[i]=lower_bound(b+1,b+m+1,l[i])-b;\n\tfor(int i=1;i<=n;i++)rr[i]=lower_bound(b+1,b+m+1,r[i])-b;\n\tA.build(1,1,m),B.build(1,1,m);\n\tfor(int i=1;i<=n;i++)\n\t{\n\t\tf[i]=r[i]-l[i]+1,f[i]=max(f[i],A.ask(1,1,rl[i]-1)+r[i]-l[i]+1);\n\t\tf[i]=max(f[i],B.ask(1,rl[i]+1,rr[i]-1)+r[i]),A.add(1,rr[i],f[i]),B.add(1,rr[i],f[i]-r[i]);\n\t}\n\tint ans=0;for(int i=1;i<=n;i++)ans=max(ans,f[i]);cout<<ans;\n\treturn 0;\n}\n```",
        "postTime": 1682943393,
        "uid": 556042,
        "name": "Iratis",
        "ccfLevel": 7,
        "title": "ARC159D-LIS 2"
    },
    {
        "content": "### PART 0\n\nwtcl\u3002\n\n## PART 1\n\n\u7ed9\u51fa $n$ \u7ec4\u6570 $l_i,r_i$\uff0c\u6c42\u4f9d\u6b21\u628a $\\forall j\\in[l_i,r_i]$ \u62fc\u8d77\u6765\u7684\u5e8f\u5217\u7684 LIS\u3002\n\n## PART 2\n\n\u9996\u5148\uff0c\u8fd9\u662f\u4e00\u9053\u7ebf\u6bb5\u6811\u4f18\u5316 dp\u3002\n\n\u6ca1\u9519\uff0c\u5c31\u662f dp\u3002\n\n\u6211\u4eec\u9996\u5148\u60f3\u6734\u7d20\u7684 dp \u65b9\u7a0b\u3002\n\n\u8003\u8651\u8bbe $dp_i$ \u8868\u793a\u4ee5 $r_i$ \u4e3a\u7ed3\u5c3e\u7684 LIS\u3002\n\n\u80af\u5b9a\u662f\u8981\u679a\u4e3e\u4e4b\u524d\u7684 $j$ \u5e76\u5c1d\u8bd5\u5c06\u5f53\u524d\u8fd9\u6bb5\u533a\u95f4\u52a0\u5230\u533a\u95f4 $j$ \u540e\u9762\u53bb\u3002\n\n\u90a3\u4e48\u5c31\u6709\u4e24\u79cd\u60c5\u51b5\uff1a\n\n1. $r_j<l_i$\uff1a\n\n\u8fd9\u79cd\u60c5\u51b5\u5c31\u8bf4\u660e $r_j$ \u7684\u540e\u4e00\u4e2a\u6570\u5c31\u662f $l_i$\uff0c\u6240\u4ee5\u6574\u4e2a\u533a\u95f4 $i$ \u90fd\u53ef\u4ee5\u63a5\u4e0a\u53bb\u3002\n\n\u90a3\u4e48\u65b0\u52a0\u7684\u957f\u5ea6\u5c31\u662f\u533a\u95f4 $i$ \u7684\u957f\u5ea6\u3002\n\n$dp_i=dp_j+(r_i-l_i+1)$\n\n2. $r_j\\ge l_i$\u3002\n\n\u8fd9\u79cd\u60c5\u51b5\u5c31\u8bf4\u660e\u65b0\u52a0\u7684\u662f $r_j,r_j+1,....,r_i$\uff0c\u533a\u95f4 $i$ \u53ea\u6709\u90e8\u5206\u53ef\u4ee5\u52a0\u4e0a\u53bb\u3002\n\n\u90a3\u4e48\u65b0\u52a0\u7684\u957f\u5ea6\u5c31\u662f $r_j+1,....,r_i$\uff0c\u5373 $r_i-r_j$\u3002\n\n$dp_i=dp_j+(r_i-r_j)$\n\n\u7efc\u4e0a\uff0c$dp_i=\\max _{j=1}^{i-1}\\begin{cases} dp_j+r_i-l_i+1(r_j<l_i)\\\\ dp_j-r_j+r_i(r_j\\ge l_i)\\end{cases}$\n\n\u4f46\u662f\u8fd9\u6837\u505a\u662f $O(n^2)$ \u7684\u3002\n\n## PART 3\n\n\u6211\u4eec\u8003\u8651\u7ebf\u6bb5\u6811\u4f18\u5316\u3002\n\n\u6839\u636e\u4e0a\u4e2a\u5f0f\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u4e0e $j$ \u76f8\u5173\u7684\u6709 $dp_j,dp_j-r_j$ \u4e24\u9879\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528\u4e24\u68f5\u4e0b\u6807\u4e3a $r_j$ \u7684\u6743\u503c\u7ebf\u6bb5\u6811\u7ef4\u62a4 $dp_j$ \u4e0e $dp_j-r_j$\u3002\n\n\u8fd9\u6837\u6211\u4eec\u6bcf\u6b21\u53ea\u9700\u8981\u53d6\u51fa $1\\to l_i-1$ \u8303\u56f4\u5185\u6700\u5927\u7684 $dp_j$ \u4e0e $l_i\\to r_i$ \u8303\u56f4\u5185\u6700\u5927\u7684 $dp_j-r_j$\uff0c\u52a0\u4e0a\u540e\u9762\u90a3\u5806\u4e4b\u540e\u53d6\u4e2a $\\max$ \u5373\u53ef\u3002\n\n## PART 4\n\n\u9700\u8981\u79bb\u6563\u5316\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define N 200001\nint z[N<<3][3],l[N],r[N];//val:\u79bb\u6563\u5316\u4e4b\u540e\u7684r[i]\nint n,m,i,j,k,s,now,ans,cnt;\nvector<int> val;\n//z[p][1]\u7ef4\u62a4dp[j]\n//z[p][2]\u7ef4\u62a4dp[j]-r[j]\nvoid make_tree(int p,int l,int r,int now)\n{\n\tz[p][now]=-1e9;\n\tif(l==r)return;\n\tz[p][now]=0;\n\tint mid=(l+r)>>1;\n\tmake_tree(p<<1,l,mid,now);\n\tmake_tree(p<<1|1,mid+1,r,now);\n\tz[p][now]=max(z[p<<1][now],z[p<<1|1][now]);\n}\nvoid add(int p,int l,int r,int d,int to,int now)\n{\n\tif(l==r)\n\t{\n\t\tz[p][now]=max(z[p][now],d);\n\t\treturn;\n\t}\n\tint mid=(l+r)>>1;\n\tif(to>mid)add(p<<1|1,mid+1,r,d,to,now);\n\telse add(p<<1,l,mid,d,to,now);\n\tz[p][now]=max(z[p<<1][now],z[p<<1|1][now]);\n}\nint query(int p,int l,int r,int k,int s,int now)\n{\n\tif(k<=l&&r<=s)return z[p][now];\n\tint mid=(l+r)>>1,ans=-1e9;\n\tif(k<=mid)ans=max(ans,query(p<<1,l,mid,k,s,now));\n\tif(s>mid)ans=max(ans,query(p<<1|1,mid+1,r,k,s,now));\n\treturn ans;\n}\nint main()\n{\n\tscanf(\"%d\",&n);\n\tfor(i=1;i<=n;i++)\n\t{\n\t\tscanf(\"%d%d\",&l[i],&r[i]);\n\t\tval.push_back(l[i]);\n\t\tval.push_back(r[i]);//l[i],r[i]\u90fd\u9700\u8981\u79bb\u6563\u5316\n\t}\n\tval.push_back(0);\n\tsort(val.begin(),val.end());\n\tval.erase(unique(val.begin(),val.end()),val.end());\n\tm=val.size();//\u79bb\u6563\u5316\u7528\u4e86vector,\u5176\u5b9e\u53ef\u4ee5\u7528\u6570\u7ec4\n\tmake_tree(1,1,m,1);\n\tmake_tree(1,1,m,2);\n\tadd(1,1,m,0,1,1);\n\tadd(1,1,m,0,1,2);\n\tfor(i=1;i<=n;i++)\n\t{\n\t\tk=lower_bound(val.begin(),val.end(),l[i])-val.begin()+1;\n\t\ts=lower_bound(val.begin(),val.end(),r[i])-val.begin()+1;//\u67e5\u8be2\u79bb\u6563\u5316\u4e4b\u540e\u7684l[i],r[i]\n\t\tnow=max(query(1,1,m,1,k-1,1)+r[i]-l[i]+1,query(1,1,m,k,s,2)+r[i]);\n\t\tans=max(ans,now);//now\u5373\u4e3a\u5f53\u524d\u7684dp[i],\u53ea\u4e0d\u8fc7\u7701\u7565\u4e86dp\u6570\u7ec4\n\t\tadd(1,1,m,now,s,1);\n\t\tadd(1,1,m,now-r[i],s,2);\n\t}\n\tprintf(\"%d\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1682933783,
        "uid": 643735,
        "name": "RNTBW",
        "ccfLevel": 0,
        "title": "ARC159D-solution"
    }
]