[
    {
        "content": "## Description\n\n[link](https://atcoder.jp/contests/arc133/tasks/arc133_d)\n\n## Solution\n\n\u5f88\u660e\u663e\u8981\u8f6c\u6362\u6210\u524d\u7f00\u5f02\u6216\u548c\u6765\u8003\u8651\u3002\n\n\u8bbe $S_i=0\\oplus1\\oplus2\\oplus\\dots\\oplus i$\uff0c\u90a3\u4e48 $l\\oplus l+1\\oplus \\dots\\oplus r=S_r\\oplus S_{l-1}$\u3002\n\n\u6240\u4ee5\u9898\u76ee\u5c31\u8f6c\u5316\u4e3a\u6c42\uff1a$[L-1,R]$ \u4e2d\u5b58\u5728\u591a\u5c11\u4e2a $(l,r)$ \u6ee1\u8db3 $l< r$ \u4e14 $S_r\\oplus S_{l}=V$\u3002\n\n\u8fd9\u4e2a\u4e1c\u897f\u663e\u7136\u53ef\u4ee5\u8f6c\u5316\u4e3a $[R,R]-[L-2,R]-[R,L-2]+[L-2,L-2]$.\n\n\u4f46\u662f\u8fd9\u6837\u8fd8\u662f\u6709\u5f88\u591a\u9650\u5236\uff0c\u4e0d\u662f\u5f88\u597d\u505a\u3002\u6240\u4ee5\u53ef\u4ee5\u5148\u6c42\u4e0d\u8003\u8651 $l<r$ \u7684\u7b54\u6848\uff0c\u6700\u540e\u9664\u4ee5 $2$ \u5373\u53ef\u3002\n\n\u5982\u679c $S$ \u6ca1\u6709\u4efb\u4f55\u89c4\u5f8b\u662f\u4e0d\u53ef\u505a\u7684\uff0c\u4f46\u662f\u8fd9\u91cc\u7684 $S$ \u6ee1\u8db3\uff1a\n$$\nS_i=\n\\begin{cases}\ni\\space\\space\\space\\space\\space\\space&(i\\bmod 4=0)\\\\\n1\\space\\space\\space\\space\\space\\space&(i\\bmod 4=1)\\\\\ni+1\\space\\space\\space\\space\\space\\space&(i\\bmod 4=2)\\\\\n0\\space\\space\\space\\space\\space\\space&(i\\bmod 4=3)\n\\end{cases}\n$$\n\u5f88\u660e\u663e $i\\bmod 4$ \u662f $1$ \u6216 $3$ \u5c31\u53ef\u4ee5\u76f4\u63a5\u7279\u5224\uff0c\u662f $0$ \u6216 $2$ \u7684\u53ef\u4ee5\u6570\u4f4d dp \u6216\u8005\u8bb0\u5fc6\u5316\u641c\u7d22\u3002\n\n\u7531\u4e8e\u8fd9\u91cc\u72b6\u6001\u5f88\u5c11\uff0c\u6240\u4ee5\u8bb0\u5fc6\u5316\u641c\u7d22\u4f1a\u5f88\u5feb\u3002\n\n\u6ce8\uff1a\u7b54\u6848\u8981\u5bf9 $998244353$ \u53d6\u6a21\uff0c\u7ffb\u8bd1\u91cc\u9762\u6ca1\u5199\uff01\n\n## Code\n\n```cpp\n#include <bits/stdc++.h>\n\n#define int __int128\n\nusing namespace std;\n\nconst int kInf = 1e18, kR[] = {0, 1, 3, 0}, kLim[] = {kInf, 0, kInf, 0};\n\nlong long l, r, v;\nmap<tuple<int, int, int>, int> mp;\n\nint solve(int a, int b, int v) {\n  if (mp.count(make_tuple(a, b, v))) return mp[{a, b, v}];\n  if (a < 0 || b < 0) return 0;\n  if (!v) return min(a, b) + 1;\n  int ret = 0;\n  for (int i = 0; i <= 1; ++i) {\n    int j = (v & 1) ^ i;\n    if (a < i || b < j) continue;\n    ret += solve((a - i) >> 1, (b - j) >> 1, v >> 1);\n  }\n  return mp[{a, b, v}] = ret;\n}\n\nint get(int a, int b, int v) {\n  if (a < 0 || b < 0) return 0;\n  int ret = 0;\n  for (int r1 = 0; r1 < 4; ++r1) {\n    for (int r2 = 0; r2 < 4; ++r2) {\n      int vv = (v ^ kR[r1] ^ kR[r2]);\n      if ((vv & 3) || a < r1 || b < r2) continue;\n      int tmp = solve(min((a - r1) / 4, kLim[r1]), min((b - r2) / 4, kLim[r2]), vv >> 2), cnt = 1;\n      if (r1 == 1) cnt *= (a - 1) / 4 + 1;\n      else if (r1 == 3) cnt *= (a - 3) / 4 + 1;\n      if (r2 == 1) cnt *= (b - 1) / 4 + 1;\n      else if (r2 == 3) cnt *= (b - 3) / 4 + 1;\n      ret += tmp * cnt;\n      // cerr << r1 << ' ' << r2 << ' ' << tmp * cnt << ' ' << tmp << ' ' << cnt << '\\n';\n\n      // ret += solve(min(a / 4, kLim[r1]), min(b / 4, kLim[r2]), vv >> 2);\n      // cerr << \"***\" << min((a - kR[r1]) / 4, kLim[r1]) << ' ' << min((b - kR[r2]) / 4, kLim[r2]) << '\\n';\n      // cerr << r1 << ' ' << r2 << ' ' << solve(min((a - kR[r1]) / 4, kLim[r1]), min((b - kR[r2]) / 4, kLim[r2]), vv >> 2) << '\\n';\n    }\n  }\n  return ret;\n}\n\nvoid print(int x) {\n  if (x < 10) {\n    cout << (long long)x;\n    return;\n  }\n  print(x / 10);\n  cout << (long long)(x % 10);\n}\n\nvoid dickdreamer() {\n  long long ll, rr, vv;\n  cin >> ll >> rr >> vv;\n  int l, r, v;\n  l = ll, r = rr, v = vv;\n  --l;\n  int ans = get(r, r, v) - get(l - 1, r, v) - get(r, l - 1, v) + get(l - 1, l - 1, v);\n  // cerr << ans << '\\n';\n  if (!v) ans -= r - l + 1;\n  assert(ans % 2 == 0);\n  ans /= 2;\n  print(ans % 998244353);\n}\n\nint32_t main() {\n#ifdef ORZXKR\n  freopen(\"in.txt\", \"r\", stdin);\n  freopen(\"out.txt\", \"w\", stdout);\n#endif\n  ios::sync_with_stdio(0), cin.tie(0), cout.tie(0);\n  int T = 1;\n  // cin >> T;\n  while (T--) dickdreamer();\n  // cerr << 1.0 * clock() / CLOCKS_PER_SEC << 's';\n  return 0;\n}\n```\n\n",
        "postTime": 1679182876,
        "uid": 176843,
        "name": "Scarab",
        "ccfLevel": 0,
        "title": "[ARC133D] Range XOR \u9898\u89e3"
    },
    {
        "content": "\u725b\u903c\u903c\u9898\u3002\n\n\u6211\u4eec\u5148\u8003\u8651\u6ca1\u6709 $l\\le r$ \u7684\u9650\u5236\u7684\u60c5\u51b5\uff0c\u5148\u505a\u4e2a\u524d\u7f00\u548c\uff0c\u5373 $s_i=\\displaystyle\\oplus_{i=0}^ni$\uff0c\u90a3\u4e48\u8981\u7edf\u8ba1\u7684\u4e1c\u897f\u5c31\u53d8\u6210\u4e86\uff1a\n\n$$\n\\sum_{l=L-1}^{R-1}\\sum_{r=L}^R[s_l\\oplus s_r=v]\n$$\n\n\u4f46\u6211\u4eec\u4f1a\u53d1\u73b0\u8fd9\u73a9\u610f\u6ca1\u6709\u5bf9\u79f0\u6027\uff0c\u5f88\u86cb\u75bc\uff0c\u4e8e\u662f\u8003\u8651\u5f3a\u884c\u628a\u533a\u95f4\u62c9\u5e73\u5f97\u5230\n\n$$\n\\sum_{l=L-1}^{R}\\sum_{r=L-1}^R[s_l\\oplus s_r=v]\n$$\n\n\u8003\u8651\u8fd9\u73a9\u610f\u591a\u7b97\u4e86\u54ea\u4e9b\u4e1c\u897f\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u6211\u4eec\u591a\u7b97\u7684\u90e8\u5206\u662f $l=r$ \u7684\u90e8\u5206\uff08\u5bf9\u5e94\u5230\u4e00\u5f00\u59cb\u7684\u5f0f\u5b50\u4e0d\u662f\u5408\u6cd5\u60c5\u51b5\uff09\uff0c\u53bb\u6389\u8fd9\u4e00\u90e8\u5206\u540e\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u6211\u4eec\u4f1a\u540c\u65f6\u7edf\u8ba1 $(l,r)$ \u4e0e $(r,l)$\uff0c\u56e0\u6b64\u518d\u9664\u4ee5 $2$ \u5c31\u5f97\u5230\u4e86\u6211\u4eec\u8981\u7684\u4e1c\u897f\u3002\n\n\u8003\u8651\u505a\u4e2a\u524d\u7f00\u548c\uff0c\u8bbe\n\n$$\nS(n,m)=\\sum_{l=0}^n\\sum_{r=0}^m[s_l\\oplus s_r=v]\n$$\n\n\u90a3\u4e48\u6211\u4eec\u8981\u6c42\u7684\u4e1c\u897f\u5c31\u53d8\u6210\u4e86 $S(R,R)-2S(L-2,R)+S(L-2,L-2)$\uff0c\u8003\u8651\u5982\u4f55\u6c42 $S(n,m)$ \u5373\u53ef\u3002\n\n\u8003\u8651 $s_i$ \u7684\u8ba1\u7b97\uff0c\u53ef\u4ee5\u53d1\u73b0\u5982\u4e0b\u4e8b\u5b9e\uff1a\n\n```\ns[------00] =        0^------00 = ------00\ns[------01] = ------00^------01 = 1\ns[------10] =        1^------10 = ------11\ns[------11] = ------11^------11 = 0\n```\n\n\u56e0\u6b64\uff0c\u6211\u4eec\u6709\uff1a\n\n$$\ns_i=\\begin{cases}\n  i & i\\equiv0\\pmod 4\\\\\n  1 & i\\equiv1\\pmod 4\\\\\n  i+1 & i\\equiv2\\pmod 4\\\\\n  0 & i\\equiv3\\pmod 4\n\\end{cases}\n$$\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5bf9\u4e8e $l\\equiv 1,3\\pmod 4$ \u6216 $r\\equiv 1,3\\pmod 4$ \u7684\u60c5\u51b5\uff0c\u7531\u4e8e $s_{l/r}$ \u4e3a\u5e38\u91cf\uff0c\u6545\u53ef\u4ee5\u76f4\u63a5\u8ba1\u7b97\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\u5f53\u786e\u5b9a\u672b\u4e24\u4f4d\u540e\u53ef\u4ee5\u76f4\u63a5\u5220\u6389\u540e\u4e24\u4f4d\uff0c\u90a3\u4e48\u5c31\u6ca1\u6709\u6a21 $4$ \u7684\u9650\u5236\u4e86\u3002\n\n\u5bf9\u4e8e\u5269\u4e0b\u7684\u5185\u5bb9\uff0c\u7b49\u4ef7\u4e8e\u6c42\n\n$$\n\\sum_{l=0}^{\\lfloor n/4\\rfloor}\\sum_{r=0}^{\\lfloor m/4\\rfloor}[l\\oplus r=\\lfloor v/4\\rfloor]\n$$\n\n\u800c\u8fd9\u662f\u4e00\u4e2a trivial \u7684\u6570\u4f4d dp\uff0c\u786c\u51b2\u5c31\u5b8c\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(\\log n)$\n\n```cpp\n#include <iostream>\n\nusing namespace std;\nusing LL = long long;\n\nconst int kL = 60, kB[4] = {0, 1, 3, 0};\nconst LL kM = 998244353;\n\nLL L, R, v, f[kL][2][2];\n\nLL _S(int i, LL n, bool ln, LL m, bool lm, LL v) {\n  if (i == -1) {\n    return 1;\n  }\n  LL &fs = f[i][ln][lm];\n  if (~fs) {\n    return fs;\n  }\n  fs = 0;\n  for (int kn = 0, vn = (ln ? (n >> i & 1) : 1); kn <= vn; ++kn) {\n    for (int km = 0, vm = (lm ? (m >> i & 1) : 1); km <= vm; ++km) {\n      if ((kn ^ km) == (v >> i & 1)) {\n        fs = (fs + _S(i - 1, n, ln && kn == vn, m, lm && km == vm, v)) % kM;\n      }\n    }\n  }\n  return fs;\n}\nLL bS(LL n, LL m, LL v) {\n  for (int i = 0; i < kL; ++i) {\n    for (int j = 0; j <= 1; ++j) {\n      for (int k = 0; k <= 1; ++k) {\n        f[i][j][k] = -1;\n      }\n    }\n  }\n  return _S(kL - 1, n, 1, m, 1, v);\n}\nLL S1(LL n, LL m) {\n  if (n < 0 || m < 0) {\n    return 0;\n  }\n  LL s = 0;\n  for (int i = 0; i < 4; ++i) {\n    for (int j = 0; j < 4; ++j) {\n      LL w = (v ^ kB[i] ^ kB[j]);\n      if (w & 3) {\n        continue;\n      }\n      w >>= 2;\n      LL ci = (n >> 2) - ((n & 3) < i);\n      LL cj = (m >> 2) - ((m & 3) < j);\n      s = (s + bS((i & 1) ? 0 : ci, (j & 1) ? 0 : cj, w) * ((i & 1) ? (ci + 1) % kM : 1) % kM * ((j & 1) ? (cj + 1) % kM : 1) % kM) % kM;\n    }\n  }\n  return s;\n}\nLL S2(LL l, LL r) { return (S1(r, r) - 2 * S1(l - 1, r) + S1(l - 1, l - 1) + 2 * kM) % kM; }\n\nint main() {\n  ios_base::sync_with_stdio(0), cin.tie(0);\n  cin >> L >> R >> v;\n  cout << (S2(L - 1, R) - (v == 0) * (R - L + 2) % kM + kM) * (kM + 1) / 2 % kM;\n  return 0;\n}\n```\n",
        "postTime": 1679311313,
        "uid": 376161,
        "name": "wsfxk",
        "ccfLevel": 6,
        "title": "[ARC133D] Range XOR \u9898\u89e3"
    }
]