[
    {
        "content": "\u8bbe\u8ba1 $f_i$ \u8868\u793a\u4ee5\u7b2c $i$ \u4e2a\u6570\u7ed3\u5c3e\u7684\u9009\u62e9\u7684\u6700\u5927\u503c\u3002\n\n\u6709 $f_i = f_j + a_i$\uff08$type_i \\not = type_j$\uff09\u3002\n\n\u53d1\u73b0\u53ef\u4ee5\u9009\u62e9\u7684\u79cd\u7c7b\u5176\u5b9e\u6784\u6210\u4e24\u6bb5\u8fde\u7eed\u533a\u95f4\u3002\n\n\u6240\u4ee5\u7ef4\u62a4\u4f7f\u5f97 $type_x = i$ \u7684\u6240\u6709 $x$ \u7684 $f_x$ \u6700\u5927\u503c\u3002\n\n\u8fd9\u4e2a\u7528\u7ebf\u6bb5\u6811\u53ef\u4ee5\u5f88\u7b80\u6d01\u7684\u7ef4\u62a4\u3002\n\n\u4e8e\u662f\u5c31 $O(n \\log n)$ \u5730\u505a\u5b8c\u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int inf = 1e18+7;\nconst int maxn=150010;\nint dp[maxn];\nint type[maxn],a[maxn],n,m,ans;\nint tree[maxn*4];\nvoid pushup(int x)\n{\n  tree[x]=max(tree[x*2],tree[x*2+1]);\n}\nvoid add(int now,int val,int l,int r,int x)\n{\n  if(l==r)\n  {\n    tree[x]+=val;\n    return ;\n  }\n  int mid=(l+r)/2;\n  if(now<=mid)\n    add(now,val,l,mid,x*2);\n  else\n    add(now,val,mid+1,r,x*2+1);\n  pushup(x);\n  return ;\n}\nint question(int L,int R,int l,int r,int x)\n{\n  if(R>n||L<1||R<L)\n    return 0;\n  if(L<=l&&R>=r)\n  {\n    return tree[x];\n  }\n  int mid=(l+r)/2,res=-inf;\n  if(L<=mid)\n    res=max(res,question(L,R,l,mid,x*2));\n  if(R>mid)\n    res=max(res,question(L,R,mid+1,r,x*2+1));\n  return res;\n}\nsigned main()\n{\n  ios::sync_with_stdio(0);\n  cin.tie(0);\n  cout.tie(0);\n  for(int i=0;i<maxn*4;i++) tree[i]=-inf; \n  cin>>n>>m;\n  for(int i=1;i<=n;i++)\n    cin>>type[i]>>a[i];\n  dp[1]=a[1];\n  ans=max(ans,dp[1]);\n  add(type[1],inf,1,m,1);\n  add(type[1],a[1],1,m,1);\n  for(int i=2;i<=n;i++)\n  {\n      dp[i]=max(question(1,type[i]-1,1,m,1),max(question(type[i]+1,m,1,m,1),0*1ll))+a[i];\n      if(dp[i]>question(type[i],type[i],1,m,1))\n      {\n        int u=question(type[i],type[i],1,m,1);\n        add(type[i],-u,1,m,1);\n        add(type[i],dp[i],1,m,1);\n      }\n      ans=max(ans,dp[i]);\n  }\n  cout<<ans;\n}\n```\n",
        "postTime": 1683556325,
        "uid": 520748,
        "name": "_ChiFAN_",
        "ccfLevel": 4,
        "title": "joig2022_e \u9898\u89e3"
    }
]