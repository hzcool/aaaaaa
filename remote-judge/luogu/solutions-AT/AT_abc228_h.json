[
    {
        "content": "$$\\texttt{Description}$$\n\n[[ABC228H] Histogram](https://www.luogu.com.cn/problem/AT_abc228_h)\n\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $N$ \u7684\u6570\u7ec4 $A_1, A_2, \\cdots, A_N$ \u548c\u4e00\u4e2a\u957f\u5ea6\u4e3a $N$ \u7684\u6570\u7ec4 $C_1, C_2, \\cdots, C_N$\u3002\n\n\u53ef\u4ee5\u8fdb\u884c\u4efb\u610f\u6b21\u5982\u4e0b\u64cd\u4f5c\uff1a\n\n\u9009\u62e9\u4e00\u4e2a\u4e0b\u6807 $i$\uff0c\u5c06 $A_i$ \u52a0 $1$\uff0c\u6b64\u6b21\u64cd\u4f5c\u82b1\u8d39\u4ee3\u4ef7 $C_i$\u3002\n\n\u5728\u64cd\u4f5c\u5b8c\u4e4b\u540e\uff0c\u4f60\u9700\u8981\u989d\u5916\u82b1\u8d39 $K \\times X$ \u7684\u4ee3\u4ef7\uff0c\u5176\u4e2d $K$ \u8868\u793a\u64cd\u4f5c\u5b8c\u540e $A$ \u6570\u7ec4\u4e2d\u4e0d\u540c\u6570\u5b57\u7684\u4e2a\u6570\uff0c$X$ \u4e3a\u4e00\u4e2a\u7ed9\u5b9a\u7684\u6570\u3002\n\n$$\\texttt{Solution}$$\n\n\u6211\u4eec\u5148\u6309 $A$ \u6570\u7ec4\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\uff0c\u7136\u540e\u53ef\u4ee5\u8003\u8651 $\\text{DP}$\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u6700\u4f18\u65b9\u6848\u4e00\u5b9a\u662f\u628a $A$ \u6570\u7ec4\u6392\u5e8f\u540e\u5206\u6210\u82e5\u5e72\u6bb5\uff0c\u6bcf\u4e00\u6bb5\u90fd\u628a\u6bb5\u5185\u7684\u6570\u52a0\u5230\u6bb5\u5185\u6700\u5927\u503c\u3002\n\n\u7531\u4e8e\u6309 $A$ \u6570\u7ec4\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u4e86\uff0c\u6240\u4ee5\u533a\u95f4 $[L, R]$ \u7684\u6700\u5927\u503c\u4e3a $A_R$\u3002\n\n\u8bbe $f_i$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u5206\u6bb5\u540e\u4ea7\u751f\u7684\u6700\u5c0f\u4ee3\u4ef7\uff0c\u5219\u53ef\u4ee5\u5217\u51fa\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$f_i = \\min_{j = 0}^{j < i} \\{ f_j + \\left(\\sum_{k = j + 1}^i C_k \\times (A_i - A_k)\\right) + x \\}$$\n\n\u628a\u8f6c\u79fb\u65b9\u7a0b\u4e2d\u95f4\u90e8\u5206\u63d0\u51fa\u6765\uff1a\n\n$$\\sum_{k = j + 1}^{i} C_k \\times (A_i - A_k) = A_i \\times \\sum_{k = j + 1}^{i} C_k - \\sum_{k = j + 1}^{i} C_k \\times A_k$$\n\n\u53ef\u4ee5\u9884\u5904\u7406\u51fa\u524d\u7f00\u548c\u6570\u7ec4 $sum, sumC$\uff0c\u5176\u4e2d\uff1a\n\n$$sum_i = \\sum_{j = 1}^i C_j \\times A_j$$\n\n$$sumC_i = \\sum_{j = 1}^i C_j$$\n\n\u8f6c\u79fb\u65b9\u7a0b\u5c31\u53d8\u6210\u4e86\u5982\u4e0b\u5f62\u5f0f\uff1a\n\n$$f_i = \\min_{j = 0}^i \\{ f_j + A_i \\times (sumC_i - sumC_j) - sum_i + sum_j + x \\}$$\n\n\u663e\u7136\u53ef\u4ee5\u659c\u7387\u4f18\u5316\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003 [P3195 [HNOI2008]\u73a9\u5177\u88c5\u7bb1](https://www.luogu.com.cn/problem/P3195)\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nint main() {\n    std :: ios_base :: sync_with_stdio(false);\n    std :: cin.tie(nullptr);\n\n    std :: istream &fin = std :: cin;\n    std :: ostream &fout = std :: cout;\n\n    int n, x;\n    fin >> n >> x;\n\n    std :: vector < std :: pair <int, int> > a(n + 1);\n    for (int i = 1; i <= n; ++i) {\n        fin >> a[i].first >> a[i].second;\n    }\n\n    using ll = long long;\n\n    std :: sort(a.begin() + 1, a.begin() + n + 1);\n    std :: vector <ll> f(n + 1), sum(n + 1), sc(n + 1);\n\n    for (int i = 1; i <= n; ++i) {\n        sum[i] = sum[ i - 1 ] + 1ll * a[i].first * a[i].second;\n        sc[i] = sc[ i - 1 ] + a[i].second;\n    }\n\n    std :: vector <int> q(n + 1);\n    int head = 1, tail = 1; q[1] = 0;\n\n    auto slope = [&] (int i, int j) {\n        return 1.0 * (f[j] + sum[j] - f[i] - sum[i]) / (sc[j] - sc[i]);\n    };\n\n    for (int i = 1; i <= n; ++i) {\n        while (head < tail && slope(q[head], q[ head + 1 ]) < a[i].first) ++head;\n        f[i] = f[ q[head] ] + x + (sc[i] - sc[ q[head] ]) * a[i].first - sum[i] + sum[ q[head] ];\n        while (head < tail && slope(q[ tail - 1 ], q[tail]) >= slope(q[tail], i)) --tail;\n        q[ ++tail ] = i;\n    }\n\n    fout << f[n] << '\\n';\n\n    return 0;\n}\n```\n\n$$\\texttt{Thanks for watching!}$$",
        "postTime": 1668037196,
        "uid": 355448,
        "name": "Fido_Puppy",
        "ccfLevel": 0,
        "title": "[ABC228H] Histogram"
    },
    {
        "content": "\u539f\u95ee\u9898\u7b49\u4ef7\u4e8e\u5c06\u8fd9\u4e2a\u5e8f\u5217\u5206\u5272\u6210\u82e5\u4e2a\u5b50\u5e8f\u5217\uff0c\u6bcf\u4e00\u6bb5\u90fd\u5c06\u5b50\u5e8f\u5217\u4e2d\u6240\u6709\u6570\u52a0\u5230\u5b50\u5e8f\u5217\u4e2d\u6700\u5927\u503c\uff0c\u95ee\u6700\u5c0f\u4ee3\u4ef7\u3002\n\n\u9996\u5148\u6211\u4eec\u53ef\u4ee5\u5c06\u539f\u5e8f\u5217\u6309\u7167 $A$ \u5347\u5e8f\u6392\u5e8f\uff0c\u8fd9\u4e48\u505a\u6211\u4eec\u5206\u5272\u51fa\u6765\u7684\u4e00\u5b9a\u662f\u82e5\u5e72\u4e2a\u8fde\u7eed\u7684\u5b50\u6bb5\u4e86\uff0c\u6bd4\u8f83\u5bb9\u6613\u8fdb\u884c $\\text{dp}$\u3002\n\n\u8bb0 $f_{i}$ \u8868\u793a\u5f53 $i$ \u4f5c\u4e3a\u67d0\u4e00\u6bb5\u7ed3\u5c3e\u65f6\u7684\u6700\u5c0f\u82b1\u8d39\u3002\n\n\u4e0d\u96be\u5f97\u5230 $f_{i} = \\min\\limits_{j=1}^{i-1} \\{f_j + \\sum\\limits_{k=j+1}^i (a_i - a_k) \\times c_k + x\\}$\u3002\n\n\u8bb0 $s_i = \\sum\\limits_{j=1}^i  c_j,t_i = \\sum\\limits_{j=1}^i a_j \\times c_j$\u3002\n\n\u90a3\u4e48\u539f\u8f6c\u79fb\u5f0f\u53ef\u4ee5\u5199\u6210 $f_i = \\min\\limits_{j=1}^{i-1} \\{f_j + a_i (s_i-s_j) - (t_i-t_j) +x \\}$\u3002\n\n\u6211\u4eec\u5c06\u6240\u6709\u548c $j$ \u6709\u5173\u7684\u9879\u62ff\u51fa\u6765\uff0c\u5bf9\u4e8e\u8fd9\u4e00\u90e8\u5206\u7684\u8f6c\u79fb\uff0c\u53ef\u4ee5\u770b\u4f5c\u662f\u5728\u4e00\u4e2a\u7531 $(s_j,f_j+t_j)$ \u6784\u6210\u7684\u51f8\u5305\u4e0a\u9762\u7528\u659c\u7387\u4e3a $a_i$ \u7684\u76f4\u7ebf\u5207\u6700\u4f4e\u70b9\uff0c\u7b54\u6848\u5c31\u662f\u8be5\u76f4\u7ebf\u4e0e $y$ \u8f74\u7684\u4ea4\u70b9\u7684\u7eb5\u5750\u6807\uff0c\u5373\u8fd9\u6761\u76f4\u7ebf\u7684\u622a\u8ddd\uff0c\u8fd9\u4e2a\u4e1c\u897f\u4e8c\u5206\u4e00\u4e0b\u5373\u53ef\u6c42\u51fa\u6765\u3002\n\n\u7136\u540e $\\text{cdq}$ \u5206\u6cbb\u4e00\u4e0b\u5c31\u505a\u5b8c\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal{O} (n \\log^2 n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define int long long\n#define vi vector<int>\n#define pb(x) push_back(x)\n#define pii pair<int,int>\n#define lowbit(x) x&-x\nusing namespace std;\nconst int N=2e5+10;\nstruct point{\n\tint x,y;\n}a[N],b[N];\nstruct node{\n\tint x,c;\n}q[N];\nll ans;\nint n,m,T,f[N],s[N],t[N],st;\ninline int read(){\n\tint s=0,f=0;\n\tchar ch=getchar();\n\twhile(ch>'9'||ch<'0') f|=(ch=='-'),ch=getchar();\n\twhile(ch<='9'&&ch>='0') s=(s<<3)+(s<<1)+(ch^48),ch=getchar();\n\treturn f?-s:s;\n}\ninline bool cmp(point a,point b){return a.x==b.x?a.y>b.y:a.x<b.x;}\ninline bool check(point a,point b,point c){\n\treturn (b.y-a.y)*(c.x-a.x)<(c.y-a.y)*(b.x-a.x);\n}\ninline int calc(int x){\n\tint l=1,r=st,mid;\n\twhile(l<r){\n\t\tmid=(l+r+1)>>1;\n\t\tif((b[mid].y-b[mid-1].y)<=x*(b[mid].x-b[mid-1].x)) l=mid;\n\t\telse r=mid-1;\n\t}\n\treturn b[l].y-x*b[l].x;\n}\ninline void solve(int l,int r){\n\tif(l==r) return ;\n\tint mid=(l+r)>>1;\n\tsolve(l,mid);\n\tfor(register int i=l;i<=mid;++i) a[i].x=s[i],a[i].y=f[i]+t[i];\n\tsort(a+l,a+mid+1,cmp);\n\tst=0;\n\tfor(register int i=l;i<=mid;++i){\n\t\twhile(st>=1&&b[st].x==a[i].x) --st;\n\t\twhile(st> 1&&check(b[st],b[st-1],a[i])) --st;\n\t\tb[++st]=a[i];\n\t}\n\tfor(register int i=mid+1;i<=r;++i) f[i]=min(f[i],calc(q[i].x)+q[i].x*s[i]-t[i]+m);\n\tsolve(mid+1,r);\n}\nsigned main(){\n\tn=read(),m=read();\n\tmemset(f,0x3f,sizeof(f));\n\tfor(register int i=1;i<=n;++i) q[i]={read(),read()};\n\tsort(q+1,q+n+1,[](node a,node b){return a.x<b.x;});\n\tfor(register int i=1;i<=n;++i) s[i]=s[i-1]+q[i].c;\n\tfor(register int i=1;i<=n;++i) t[i]=t[i-1]+q[i].c*q[i].x;\n\tf[0]=0;\n\tsolve(0,n);\n\tprintf(\"%lld\",f[n]);\n\treturn 0;\n}\n```",
        "postTime": 1682244274,
        "uid": 428089,
        "name": "HMZHMZHMZ",
        "ccfLevel": 7,
        "title": "ABC228H"
    }
]