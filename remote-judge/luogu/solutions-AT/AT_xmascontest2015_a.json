[
    {
        "content": "# AT1733Accumulation\n\n[\u63a8\u9500\u535a\u5ba2](https://www.cnblogs.com/Shiina-Rikka/p/11586572.html)\n\n[\u6d1b\u8c37\u94fe\u63a5](https://www.luogu.org/problem/AT1733)\n\n[ATcoder](https://xmascontest2015noon.contest.atcoder.jp/tasks/xmascontest2015_a)\n\n## \u554f\u984c\u6587\n\u3046\u306a\u304e\u306f\u30af\u30ea\u30b9\u30de\u30b9\u306b\u30b5\u30f3\u30bf\u3046\u3055\u304e\u304b\u3089\u6570\u5217 S={S1,S2,\u2026,SN} \u3092\u3082\u3089\u3044\u307e\u3057\u305f\u3002\n\n\u3046\u306a\u304e\u306f\u6570\u5217\u306b\u542b\u307e\u308c\u308b\u6570\u306e\u7dcf\u548c\u3092\u6c42\u3081\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n\n\u6570\u5217 S \u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u7591\u4f3c\u30b3\u30fc\u30c9\u3067\u751f\u6210\u3055\u308c\u308b\u3082\u306e\u3067\u3059\u3002\n\n```cpp\ninput N\ninput X,T,A,B,C\nfor i = 1\u2026N:\n  Si = X\n  for j = 1\u2026T:\n    X=(A*X+B) mod C\n``` \n\n### \u7ffb\u8bd1\n\u5bf9\u5e8f\u5217S\u6c42\u548c\u3002\n\n\u5e8f\u5217S\u7531\u4ee5\u4e0b\u4f2a\u4ee3\u7801\u7ed9\u51fa\uff1a\n```c#\ninput n;\ninput x,T,A,B,C;\nfor(i~n)\n{\n    s[i] = x;\n    for(j~t)  \n        x = (A * x + B) % C;\n}\n```\n\u8f93\u51fa\u5e8f\u5217S\u7684\u5404\u9879\u4e4b\u548c\u3002\n\n## \u548b\u505a\uff1f\n##### \u8fd9\u53ef\u4ee5\u7528\u77e9\u9635\u4e58\u6cd5\n\u63d0\u524d\u901a\u8fc7\u77e9\u9635\u4e58\u6cd5\u628aA\uff0cB\u7b97\u4e00\u4e0b\uff0c\u8fd9\u6837x\u4e4b\u4e58\u7b97\u540e\u7684A\uff0cB\uff0c$O(n)$\u8ba1\u7b97\u5373\u53ef\u3002\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define int long long\nint n, x, t, a, b, p;\nstruct node\n{\n    int a[2][2];\n    node() {}\n    node(bool t)\n    {\n        memset(a, 0, sizeof a);\n        if (t)\n            a[1][1] = a[0][0] = 1;\n    }\n    friend node operator*(const node &a, const node &b)\n    {\n        node res(0);\n        for (register int i = 0; i <= 1; ++i)\n            for (register int j = 0; j <= 1; ++j)\n                for (register int k = 0; k <= 1; ++k)\n                    (res.a[i][j] += (a.a[i][k] * b.a[k][j]) % p) %= p;\n        return res;\n    }\n    inline void out()\n    {\n        for (register int i = 0; i <= 1; ++i)\n        {\n            for (register int j = 0; j <= 1; ++j)\n                cerr << a[i][j] << \" \";\n            cerr << endl;\n        }\n    }\n} A, B;\ntemplate <typename T>\ninline T pow(T a, int b)\n{\n    node res(1);\n    for (; b; b >>= 1)\n    {\n        if (b & 1)\n            res = res * a;\n        a = a * a;\n    }\n    return res;\n}\nsigned main()\n{\n    cin >> n >> x >> t >> a >> b >> p;\n    A.a[0][0] = a;\n    A.a[1][0] = b;\n    A.a[1][1] = 1;\n    A = pow(A, t);\n    // A.out();\n    a = A.a[0][0];\n    b = A.a[1][0];\n    int ans = 0;\n    for (register int i = 1; i <= n; ++i)\n    {\n        ans += x;\n        x = (a * x + b) % p;\n    }\n    cout << ans << endl;\n}\n```\n\n---\n[siilhouette](https://www.siilhouette.wtf/)\u5927\u4f6c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4f18\u79c0\u7684\u60f3\u6cd5\uff0c\u901a\u8fc7\u5f0f\u5b50\u63a8\u5bfc\u53ef\u4ee5\u5f97\u5230$x = A^T + B * \\displaystyle \\sum _{i = 0} ^{i \\leq T}A^i$\u3002\u7136\u540e\u7b49\u5dee\u6570\u5217\u6c42\u548c\u3002\u55ef\u5c31\u8fd9\u6837 \u5495\u5495\u5495\n\n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002",
        "postTime": 1569407602,
        "uid": 143186,
        "name": "lky1433223",
        "ccfLevel": 4,
        "title": "\u9898\u89e3 AT1733 \u3010Accumulation\u3011"
    },
    {
        "content": "[\u7ed9\u6211\u7684 Blog \u6253\u4e2a\u5e7f\u544a](https://autumnkite.github.io/atcoder-xmas15A-sol)\n\n[\u9898\u76ee\u4f20\u9001\u95e8](https://atcoder.jp/contests/xmascontest2015noon/tasks/xmascontest2015_a)\n\n## \u9898\u610f\n```\ninput n\ninput x, t, a, b, c\nfor i = 1 .. n :\n\ts_i = x\n\tfor j = 1 .. t :\n\t\tx = (a * x + b) mod c\n```\n\n\u6c42 $\\sum\\limits_{i=1}^{n} s_i$ \u7684\u503c\uff08\u4e0d\u9700\u8981\u5bf9 $c$ \u53d6\u6a21\uff09\u3002\n\n$n\\le 10^6, t\\le 10^9,0\\le x,a,b< c\\le 10^9$\n\n## \u9898\u89e3\n\n\u8003\u8651\u5feb\u901f\u8fdb\u884c `\tfor j = 1 .. t : x = (a * x + b) mod c` \u8fd9\u6bb5\u64cd\u4f5c\u3002\n\n$$\\begin{aligned} j=1: &\\quad ax+b \\\\ j=2: &\\quad a(ax+b)+b=a^2x+ab+b \\\\ j=3: & \\quad a(a^2x+ab+b)+b=a^3x+a^2b+ab+b  \\\\ j=4: & \\quad a^4x+a^3b+a^2b+ab+b\\\\ \\vdots& \\\\ j=t:&\\quad a^tx+\\sum_{k=0}^{t-1} a^kb=a^tx+b\\sum_{k=0}^{t-1}a^k\\end{aligned}$$\n\n\u5982\u679c $c$ \u4e3a\u8d28\u6570\uff0c\u5219\u8fd9\u4e2a\u5f0f\u5b50\u53ef\u4ee5\u76f4\u63a5\u7528\u5feb\u901f\u5e42\u548c\u7b49\u6bd4\u6570\u5217\u6c42\u548c\u516c\u5f0f\u8fdb\u884c\u8ba1\u7b97\u3002\u7136\u800c\u5e76\u6ca1\u6709\u4fdd\u8bc1 $c$ \u662f\u8d28\u6570\uff0c\u600e\u4e48\u529e\u5462\uff1f\u53ef\u4ee5\u53d1\u73b0\uff0c$x$ \u548c $b$ \u5728\u8fd9\u4e2a\u5f0f\u5b50\u4e2d\u662f\u5e38\u6570\uff0c\u800c $a^t$ \u548c $\\sum\\limits_{k=0}^{t-1}a^k$ \u6709\u67d0\u79cd\u8054\u7cfb\u2026\u2026\n\n\u8003\u8651\u7528\u77e9\u9635\u8868\u793a\uff08\u8bb0 $f(t)=\\sum\\limits_{k=0}^{t-1}a^k$\uff09 $$A=\\begin{bmatrix} a^t & f(t) \\end{bmatrix},B=\\begin{bmatrix} a^{t+1} & f(t+1) \\end{bmatrix}$$\n\n$A$ \u5982\u4f55\u624d\u80fd\u8f6c\u5316\u4e3a $B$\uff0c\u901a\u8fc7\u8ba1\u7b97\u53d1\u73b0\uff1a$a^{t+1}=a\\cdot a^t,f(t+1)=a^t+f(t)$\uff0c\u90a3\u4e48\u5f88\u663e\u7136\u8f6c\u79fb\u77e9\u9635\u4e3a $$C=\\begin{bmatrix} a & 1\\\\ 0 & 1\\end{bmatrix}$$\n\n\u53ef\u4ee5\u518d\u9a8c\u8bc1\u4e00\u4e0b $A\\times C=B$\u3002\u4e8e\u662f\u76f4\u63a5\u7528\u77e9\u9635\u5feb\u901f\u5e42\u8fdb\u884c\u4f18\u5316\u5373\u53ef\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u6700\u540e $x$ \u7684\u8f6c\u79fb\u4e00\u5b9a\u53ef\u4ee5\u8868\u793a\u4e3a $px+q$ \u7684\u5f62\u5f0f\uff0c\u6240\u4ee5\u53ea\u8981\u4e00\u5f00\u59cb\u9884\u5904\u7406 $p,q$\uff0c\u4e0d\u9700\u8981\u6bcf\u6b21\u8fdb\u884c\u77e9\u9635\u5feb\u901f\u5e42\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n+\\log t)$\u3002\n\n## \u4ee3\u7801\n\n```cpp\n#include <cstdio>\n#include <cstring>\nint n, x, m, a, b, P;\nlong long ans;\nstruct Matrix{\n\tint a[2][2];\n\tMatrix operator * (const Matrix &res) const {\n\t\tMatrix ret;\n\t\tmemset(ret.a, 0, sizeof ret.a);\n\t\tfor (register int i = 0; i < 2; ++i)\n\t\t\tfor (register int k = 0; k < 2; ++k)\n\t\t\t\tfor (register int j = 0; j < 2; ++j)\n\t\t\t\t\tret.a[i][j] = (ret.a[i][j] + 1ll * a[i][k] * res.a[k][j]) % P;\n\t\treturn ret;\n\t}\n}A, B;\nMatrix qpow(Matrix a, int b){ // \u77e9\u9635\u5feb\u901f\u5e42\n\tMatrix s = a;\n\tfor (--b; b; b >>= 1, a = a * a) if (b & 1) s = s * a;\n\treturn s;\n}\nint main(){\n\tscanf(\"%d%d%d%d%d%d\", &n, &x, &m, &a, &b, &P);\n\tA.a[0][0] = a, A.a[0][1] = 1; // \u521d\u59cb\u77e9\u9635\n\tB.a[0][0] = a, B.a[0][1] = 1, B.a[1][0] = 0, B.a[1][1] = 1; // \u8f6c\u79fb\u77e9\u9635\n\tif (m > 1) A = A * qpow(B, m - 1);\n\ta = A.a[0][0], b = 1ll * b * A.a[0][1] % P;\n\tfor (register int i = 1; i <= n; ++i) ans += x, x = (1ll * a * x + b) % P;\n\tprintf(\"%lld\\n\", ans);\n}\n```\n\nupd: \u4fee\u590d\u4e86\u4ee3\u7801\u4e2d\u7684\u4e00\u4e2a\u9519\u8bef\n",
        "postTime": 1556352365,
        "uid": 20561,
        "name": "AutumnKite",
        "ccfLevel": 10,
        "title": "\u300cAT1733\u300d\u300cXmas Contest 2015\u300dAccumulation"
    }
]