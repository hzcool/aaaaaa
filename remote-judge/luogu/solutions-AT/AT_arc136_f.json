[
    {
        "content": "\u9996\u5148\u5047\u8bbe\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u65e0\u9650\u7684\u3002\n\n\u5148\u6765\u4e09\u4e2a\u751f\u6210\u51fd\u6570 $F$\uff0c$G$\uff0c$E$\uff1a$[x^i]F(x)$ \u8868\u793a\u4ece\u7ed9\u5b9a\u7684\u72b6\u6001\u7ecf\u8fc7 $i$ \u6b65\u5f97\u5230\u4e00\u4e2a\u7ec8\u6001\u7684\u6982\u7387\uff1b$[x^i]G(x)$ \u8868\u793a\u4ece\u67d0\u4e2a\u7ec8\u6001\u7ecf\u8fc7 $i$ \u6b65\u5f97\u5230\u4e00\u4e2a\u7ec8\u6001\u7684\u6982\u7387\uff0c\u6ce8\u610f\u5bf9\u4e8e\u6bcf\u4e2a\u521d\u59cb\u7684\u7ec8\u6001\u6765\u8bb2\u8fd9\u4e2a\u503c\u662f\u76f8\u540c\u7684\uff1b$[x^i]E(x)$ \u8868\u793a\u4ece\u521d\u59cb\u72b6\u6001\u7ecf\u8fc7 $i$ \u6b65\u7b2c\u4e00\u6b21\u5f97\u5230\u4e00\u4e2a\u7ec8\u6001\u7684\u6982\u7387\u3002\n\n\u5bb9\u6613\u53d1\u73b0 $E(x)=\\dfrac{F(x)}{G(x)}$\uff0c\u6211\u4eec\u8981\u6c42\u7684\u5373\u4e3a $E'(1)$\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u8981\u6c42 $F(1)$\uff0c$F'(1)$\uff0c$G(1)$ \u548c $G'(1)$\u3002\u5f53\u7136\u8fd9\u56db\u4e2a\u503c\u53ef\u80fd\u6709\u4e00\u4e9b\u662f\u65e0\u610f\u4e49\u7684\uff08\u5b9e\u9645\u4e0a\u90fd\u662f\u65e0\u610f\u4e49\u7684\uff09\uff0c\u6211\u4eec\u5148\u4e0d\u7ba1\u5b83\u3002\u53ea\u8003\u8651\u524d\u4e24\u8005\u7684\u6c42\u6cd5\uff0c\u540e\u4e24\u8005\u53ef\u4ee5\u7528\u540c\u6837\u7684\u65b9\u6cd5\u6c42\u51fa\u3002\n\n\u8003\u8651\u67d0\u4e2a\u7ec8\u6001\u5bf9 $F$ \u9020\u6210\u7684\u8d21\u732e\uff0c\u5373\u82e5\u5e72\u6b65\u540e\u5f97\u5230\u8fd9\u4e2a\u7ec8\u6001\u7684\u6982\u7387\u7684\u751f\u6210\u51fd\u6570\uff0c$F$ \u5373\u4e3a\u5bf9\u6240\u6709\u7ec8\u6001\u800c\u8a00\uff0c\u8fd9\u4e2a\u751f\u6210\u51fd\u6570\u7684\u548c\u3002\u53d1\u73b0\u6bcf\u4e00\u6b65\u7ffb\u8f6c\u4e4b\u95f4\u662f\u6709\u987a\u5e8f\u7684\uff0c\u5373\u8fd9\u662f\u4e00\u4e2a\u6709\u6807\u53f7\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u5148\u8003\u8651\u4f7f\u7528 EGF\u3002\n\n\u786e\u5b9a\u4e86\u4e00\u4e2a\u7ec8\u6001\u76f8\u5f53\u4e8e\u786e\u5b9a\u4e86\u6bcf\u4e2a\u683c\u5b50\u88ab\u7ffb\u8f6c\u7684\u6b21\u6570\u7684\u5947\u5076\u6027\u3002\u7531\u4e8e\u4f7f\u7528\u7684\u662f EGF\uff0c\u53ea\u9700\u8981\u8003\u8651\u6bcf\u4e2a\u683c\u5b50\u7684\u751f\u6210\u51fd\u6570\u7136\u540e\u4e58\u8d77\u6765\u5373\u53ef\u3002\u6211\u4eec\u6709\uff1a$[x^i]\\dfrac12e^{\\frac x{nm}}+\\dfrac12e^{-\\frac x{nm}}$ \u8868\u793a $i$ \u662f\u5076\u6570\u4e14\u67d0\u4e2a\u683c\u5b50\u88ab\u8fde\u7eed\u7ffb\u8f6c $i$ \u6b21\u7684\u6982\u7387\u3002\u5947\u6570\u7684\u7248\u672c\u540c\u7406\u3002\u90a3\u4e48\u6240\u6c42\u7684\u751f\u6210\u51fd\u6570\u5373\u662f\u524d\u8005\u7684\u82e5\u5e72\u6b21\u65b9\u4e58\u4ee5\u540e\u8005\u7684\u82e5\u5e72\u6b21\u65b9\u3002\n\n\u73b0\u5728\u6211\u4eec\u9700\u8981\u5bf9\u6bcf\u4e2a $i$ \u77e5\u9053\u4e0e\u521d\u59cb\u72b6\u6001\u6709 $i$ \u4e2a\u5bf9\u5e94\u683c\u5b50\u4e0d\u540c\u7684\u65b9\u6848\u6570\uff0c\u8fd9\u53ef\u4ee5\u4f7f\u7528 dp \u6c42\u51fa\u3002\u5177\u4f53\u6765\u8bb2\uff0c\u6309\u4f4d\u786e\u5b9a\u8fd9\u4e2a\u7ec8\u6001\uff0cdp \u72b6\u6001\u9700\u8981\u8bb0\u5f55\u586b\u5230\u4e86\u54ea\u4e00\u884c\uff0c\u4ee5\u53ca\u524d\u9762\u6709\u591a\u5c11\u4e2a\u4e0d\u540c\u7684\u683c\u5b50\uff0c\u679a\u4e3e\u5f53\u524d\u884c\u540c\u4e3a `1` \u7684\u683c\u5b50\u6570\u8fdb\u884c\u8f6c\u79fb\u3002\n\n\u6211\u4eec\u77e5\u9053\u4e86 $F$ \u7684 EGF \u7684\u5c01\u95ed\u5f62\u5f0f\u7684\u6c42\u6cd5\uff0c\u5982\u4f55\u8bb0\u5f55\u5b83\u5e76\u8f6c\u6210 OGF \u5462\uff1f\u53d1\u73b0\u8fd9\u4e2a EGF \u53ef\u4ee5\u5199\u6210 $e^{\\frac{ax}{nm}}$ \u7684\u7ebf\u6027\u7ec4\u5408\uff0c\u5176\u4e2d $a$ \u4ece $-nm$ \u5230 $nm$\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5bf9\u6bcf\u4e2a $a$ \u8bb0\u5f55\u8fd9\u4e2a\u4e1c\u897f\u7684\u7cfb\u6570\u3002\u8f6c OGF \u53ea\u9700\u8981\u628a $e^{\\frac{ax}{nm}}$ \u6539\u6210 $\\dfrac1{1-\\frac{ax}{nm}}$ \u5373\u53ef\u3002\n\n\u4f46\u662f\u7531\u4e8e $F$ \u7684\u5c01\u95ed\u5f62\u5f0f\u91cc\u6709 $\\dfrac1{1-x}$\uff0c\u5bfc\u81f4 $F(1)$ \u662f\u6ca1\u6709\u610f\u4e49\u7684\uff0c\u8fd9\u4e5f\u53ef\u4ee5\u901a\u8fc7 $F(1)$ \u7684\u7ec4\u5408\u610f\u4e49\u76f4\u63a5\u770b\u51fa\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u8f6c\u800c\u8ba1\u7b97 $(1-x)F(x)|_{x=1}$ \u548c $((1-x)F(x))'|_{x=1}$\u3002\u5bb9\u6613\u8bc1\u660e\uff0c\u8fd9\u4e24\u4e2a\u503c\u90fd\u662f\u6709\u610f\u4e49\u7684\u4e14\u4e0d\u4e3a $0$\u3002\u90a3\u4e48\u6211\u4eec\u5df2\u7ecf\u5b8c\u6574\u89e3\u51b3\u4e86\u539f\u95ee\u9898\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2m^2)$\u3002\n\n\u53e6\u5916\u6211\u4eec\u5b9e\u9645\u4e0a\u6709 $E(1)=\\lim\\limits_{x\\to1}\\dfrac{F(x)}{G(x)}=1$ \u90a3\u4e48 $(1-x)F(x)|_{x=1}=(1-x)G(x)|_{x=1}$\uff0c\u6216\u8005\u7531\u6211\u4eec\u8ba1\u7b97 $(1-x)F(x)|_{x=1}$ \u7684\u8fc7\u7a0b\u6211\u4eec\u5bb9\u6613\u77e5\u9053\u5b83\u5c31\u662f\u597d\u72b6\u6001\u7684\u4e2a\u6570\u3002\u4f46\u662f\u8fd9\u65e0\u5173\u7d27\u8981\u3002\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nusing ll=long long;\ninline ll read(){\n\tll x=0;\n\tbool f=0;\n\tchar c=getchar();\n\twhile(!isdigit(c)){\n\t\tif(c=='-') f=1;\n\t\tc=getchar();\n\t}\n\twhile(isdigit(c)){\n\t\tx=x*10+c-'0';\n\t\tc=getchar();\n\t}\n\treturn f?-x:x;\n}\nconst int maxn=50+5;\nint n,m,a[maxn],b[maxn];\nchar s[maxn];\nconst ll mod=998244353,inv2=499122177;\ninline void add(ll& x,ll y){\n\tx=(x+y)%mod;\n}\nll ksm(ll a,ll b){\n\tll ans=1;\n\twhile(b){\n\t\tif(b%2==1) ans=ans*a%mod;\n\t\ta=a*a%mod;\n\t\tb/=2;\n\t}\n\treturn ans;\n}\nll fac[maxn],ifac[maxn];\nll C(int n,int m){\n\treturn n<m?0:fac[n]*ifac[m]%mod*ifac[n-m]%mod;\n}\nll f[2][maxn*maxn],F[maxn*maxn*2],G[maxn*maxn*2],H[maxn*maxn*2];\nvoid solve(ll& f0,ll& f1){\n\tmemset(f[0],0,sizeof(f[0]));\n\tf[0][0]=1;\n\tfor(int i=1;i<=n;i++){\n\t\tmemset(f[i%2],0,sizeof(f[0]));\n\t\tfor(int j=0;j<=(i-1)*m;j++) for(int k=0;k<=min(a[i],b[i]);k++)\n\t\t\tadd(f[i%2][j+a[i]+b[i]-k*2],f[(i-1)%2][j]*C(b[i],k)%mod*C(m-b[i],a[i]-k)%mod);\n\t}\n\tmemset(G,0,sizeof(G));\n\tG[n*m+1]=1;\n\tfor(int i=1;i<=n*m;i++){\n\t\tfor(int j=1;j<=n*m*2+1;j++) H[j]=(G[j-1]+G[j+1])%mod*inv2%mod;\n\t\tmemcpy(G,H,sizeof(G));\n\t}\n\tfor(int i=1;i<=n*m*2+1;i++) F[i]=G[i]*f[n%2][0]%mod;\n\tfor(int i=1;i<=n*m;i++){\n\t\tfor(int j=1;j<=n*m*2+1;j++){\n\t\t\tH[j]=G[j-1]*2%mod;\n\t\t\tG[j+1]=(G[j+1]-G[j-1]+mod)%mod;\n\t\t}\n\t\tfor(int j=1;j<=n*m*2+1;j++) G[j]=(H[j-1]-H[j+1]+mod)%mod*inv2%mod;\n\t\tfor(int j=1;j<=n*m*2+1;j++) F[j]=(F[j]+G[j]*f[n%2][i]%mod)%mod;\n\t}\n\tf0=F[n*m*2+1];\n\tf1=0;\n\tll inv=ksm(n*m,mod-2);\n\tfor(int i=-n*m;i<n*m;i++){\n\t\tll a=(i+mod)%mod*inv%mod;\n\t\tf1=(f1+(a-1+mod)%mod*ksm(ksm((1-a+mod)%mod,2),mod-2)%mod*F[n*m+1+i]%mod)%mod;\n\t}\n}\nint main(){\n#ifdef LOCAL\n\tfreopen(\"in.txt\",\"r\",stdin);\n\tfreopen(\"out.txt\",\"w\",stdout);\n#endif\n\tn=read();\n\tm=read();\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%s\",s+1);\n\t\tfor(int j=1;j<=m;j++) b[i]+=s[j]=='1';\n\t}\n\tfor(int i=1;i<=n;i++) a[i]=read();\n\tfac[0]=1;\n\tfor(int i=1;i<=m;i++) fac[i]=fac[i-1]*i%mod;\n\tifac[m]=ksm(fac[m],mod-2);\n\tfor(int i=m-1;i>=0;i--) ifac[i]=ifac[i+1]*(i+1)%mod;\n\tll f0,f1,g0,g1;\n\tsolve(f0,f1);\n\tfor(int i=1;i<=n;i++) b[i]=a[i];\n\tsolve(g0,g1);\n\tprintf(\"%lld\\n\",(f1*g0%mod-f0*g1%mod+mod)%mod*ksm(g0*g0%mod,mod-2)%mod);\n#ifdef LOCAL\n\tfprintf(stderr,\"%f\\n\",1.0*clock()/CLOCKS_PER_SEC);\n#endif\n\treturn 0;\n}\n```",
        "postTime": 1646559083,
        "uid": 174045,
        "name": "FZzzz",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 ARC136F Flip Cells"
    }
]