[
    {
        "content": "\u5c06\u95ee\u9898\u8f6c\u5316\u4e3a\u5bf9 $i<j$\uff0c\u6c42 $a_i-a_j$\uff0c\u505a\u4e24\u904d\u5373\u53ef\u3002\n\n\u5c06 $i$ \u6253\u5230 $[i+l_i,i+r_i]$ \u4e0a\uff0c\u5bf9 $j$ \u505a\u626b\u63cf\u7ebf\uff0c\u5bf9\u4e8e $j$ \u5c31\u4f1a\u6709\u4e00\u4e2a\u53ef\u80fd $i$ \u7684\u96c6\u5408\uff0c$j$ \u4f1a\u66f4\u65b0\u8fd9\u4e2a\u96c6\u5408\u4e2d\u5728 $[j-r_j,j-l_j]$ \u4e2d\u7684\u5143\u7d20\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5c31\u8981\u7ef4\u62a4\u4e00\u4e2a\u7b54\u6848\u6570\u7ec4 $ans_i$\uff0c\u652f\u6301\u5355\u70b9\u8d4b\u503c $a_i$\uff08\u4e0d\u5728\u53ef\u80fd $i$ \u96c6\u5408\u91cc\u7684\u89c6\u4e3a $-\\infty$\uff09\u3001\u533a\u95f4\u6c42 $ans_i$ \u7684 $\\max$\u3001\u533a\u95f4 $ans_i$ \u548c $a_i-a_j$ \u53d6 $\\max$\u3002\n\n\u7531\u4e8e\u6211\u4eec\u53ea\u9700\u8981\u6c42 $\\max$\uff0c\u7ed9\u6bcf\u4e2a\u7ebf\u6bb5\u6811\u4e0a\u8282\u70b9\u6253 $a_j$ \u7684 tag\uff0c\u6253 tag \u65f6\u66f4\u65b0\u7b54\u6848\uff0c\u591a\u4e2a tag \u53d6\u6700\u5c0f\u7684\u5373\u53ef\u3002\n\n\u590d\u6742\u5ea6 $O((n+q)\\log n)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\n#define fi first\n#define se second\n#define mp make_pair\n#define pb push_back\n#define pf push_front\n#define rep(i, s, t) for (int i = s; i <= t; ++i)\n#define per(i, s, t) for (int i = t; i >= s; --i)\n\nconst int N = 2e5 + 5;\nconst int inf = 0x3f3f3f3f;\n\nint n, q;\nint a[N], l[N], r[N];\nint ans[N];\nvector<pair<int, int>> adj[N];\nvector<int> bdj[N<<1];\nint lazymx[N<<2], lazymi[N<<2], mx[N<<2], mi[N<<2], mxans[N<<2];\n\ninline void setlazy(int o, int x) {\n\tlazymx[o] = max(lazymx[o], x);\n\tlazymi[o] = min(lazymi[o], x);\n\tmxans[o] = max(mxans[o], max(mx[o] - x, x - mi[o]));\n}\n\ninline void pushdown(int o) {\n\tif(lazymx[o] != -1) {\n\t\tsetlazy(o << 1, lazymx[o]);\n\t\tsetlazy(o << 1 | 1, lazymx[o]);\n\t\tlazymx[o] = -1;\n\t}\n\tif(lazymi[o] != inf) {\n\t\tsetlazy(o << 1, lazymi[o]);\n\t\tsetlazy(o << 1 | 1, lazymi[o]);\n\t\tlazymi[o] = inf;\n\t}\n}\n\ninline void pushup(int o) {\n\tmx[o] = max(mx[o << 1], mx[o << 1 | 1]);\n\tmi[o] = min(mi[o << 1], mi[o << 1 | 1]);\n\tmxans[o] = max(mxans[o << 1], mxans[o << 1 | 1]);\n}\n\ninline void modify(int o, int ql, int qr, int x, int l, int r) {\n\tif(ql <= l && r <= qr) return setlazy(o, x), void();\n\tpushdown(o);\n\tint mid = l + r >> 1;\n\tif(ql <= mid) modify(o << 1, ql, qr, x, l, mid);\n\tif(mid < qr) modify(o << 1 | 1, ql, qr, x, mid + 1, r);\n\tpushup(o);\n}\n\ninline void modify(int o, int p, int op, int l, int r) {\n\tif(l == r) {\n\t\tif(op == -1) mi[o] = inf, mx[o] = 0;\n\t\telse mi[o] = mx[o] = a[l];\n\t\treturn;\n\t}\n\tpushdown(o);\n\tint mid = l + r >> 1;\n\tif(p <= mid) modify(o << 1, p, op, l, mid);\n\telse modify(o << 1 | 1, p, op, mid + 1, r);\n\tpushup(o);\n}\n\ninline void build(int o, int l, int r) {\n\tmi[o] = inf, mx[o] = 0, mxans[o] = -1;\n\tlazymx[o] = -1;\n\tlazymi[o] = inf;\n\tif(l == r) return;\n\tint mid = l + r >> 1;\n\tbuild(o << 1, l, mid);\n\tbuild(o << 1 | 1, mid + 1, r);\n}\n\ninline int query(int o, int ql, int qr, int l, int r) {\n\tif(ql <= l && r <= qr) return mxans[o];\n\tpushdown(o);\n\tint mid = l + r >> 1;\n\tint res = -1;\n\tif(ql <= mid) res = max(res, query(o << 1, ql, qr, l, mid));\n\tif(mid < qr) res = max(res, query(o << 1 | 1, ql, qr, mid + 1, r));\n\treturn res;\n}\n\nint main() {\n\tios::sync_with_stdio(false);\n\tcin.tie(nullptr), cout.tie(nullptr);\n\tcout << fixed << setprecision(15); \n\tcerr << fixed << setprecision(15);\n\n\tcin >> n;\n\trep(i, 1, n) cin >> a[i] >> l[i] >> r[i], bdj[i+l[i]].pb(i), bdj[i+r[i]+1].pb(-i);\n\tcin >> q;\n\trep(i, 1, q) {\n\t\tint l, r; cin >> l >> r;\n\t\tadj[r].emplace_back(l, i);\n\t}\n\t\n\tbuild(1, 1, n);\n\n\trep(i, 1, n) {\n\t\tfor(int j : bdj[i]) {\n\t\t\tif(j > 0) modify(1, j, 1, 1, n);\n\t\t\telse modify(1, -j, -1, 1, n);\n\t\t}\n\t\tif(i-l[i] >= 1) modify(1, i-r[i], i-l[i], a[i], 1, n);\n\t\tfor(auto [j, id] : adj[i]) ans[id] = query(1, j, i, 1, n);\n\t}\n\n\trep(i, 1, q) cout << ans[i] << \"\\n\";\n\t\n\treturn 0;\n}\n\n```",
        "postTime": 1684638192,
        "uid": 95103,
        "name": "KellyFrog",
        "ccfLevel": 9,
        "title": "\u9898\u89e3\u3010JOISC D2T1 Two Antennas\u3011"
    }
]