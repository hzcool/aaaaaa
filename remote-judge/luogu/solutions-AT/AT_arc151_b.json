[
    {
        "content": "## Problem\n\n\u7ed9\u51fa\u4e00\u4e2a\u6392\u5217 $P$ \uff0c\u6c42\u6709\u591a\u5c11\u4e2a\u6570\u7ec4 $A$ \u6ee1\u8db3\uff1a\n\n+ $\\forall i\\in[1,n],1\\le A_i\\le m$\n+ $A$ \u6570\u7ec4\u7684\u5b57\u5178\u5e8f\u5c0f\u4e8e $(A_{P_1},A_{P_2},...,A_{P_n})$ \u7684\u5b57\u5178\u5e8f\n\n## Solution\n\n\u5148\u8003\u8651 $A_1<A_{P_1}$ \u7684\u60c5\u51b5\uff0c\u518d\u8003\u8651 $A_1=A_{P_i},A_2<A_{P_2}$ \u7684\u60c5\u51b5\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002\n\n\u5c31\u53ef\u4ee5\u51c6\u786e\u7684\u6c42\u51fa\u7b54\u6848\uff0c\u8bbe $f(i)$ \u8868\u793a $\\forall j\\in[1,i) A_j=A_{P_j}\\land A_i<A_{P_i}$ \u7684\u4e2a\u6570\uff0c\u7b54\u6848\u5373\u4e3a $\\sum f(i)$\u3002\n\n\u8003\u8651\u5982\u4f55\u6c42\u51fa $f(i)$ \uff0c\u5bb9\u6613\u53d1\u73b0\u5bf9\u4e8e $A_j=A_{P_j}$ \u53ea\u8981\u786e\u5b9a\u4e86 $j$ \u6216 $P_j$ \u7684\u4f4d\u7f6e\u586b\u4ec0\u4e48\u6570\uff0c\u53e6\u4e00\u4e2a\u4f4d\u7f6e\u7684\u6570\u4e5f\u786e\u5b9a\u4e86\uff0c\u662f\u4e00\u4e2a\u4f9d\u8d56\u5173\u7cfb\u3002\n\n\u628a $j$ \u548c $P_j$ \u8f6c\u5316\u5230\u56fe\u4e0a\u662f\u4e00\u4e2a\u7ecf\u5178\u7ef4\u62a4\u601d\u8def\uff0c\u5c06 $j$ \u548c $P_j$ \u8fde\u8fb9\uff0c\u5f53\u524d\u6709\u591a\u5c11\u8fde\u901a\u5757\u5c31\u4ee3\u8868\u6709\u51e0\u4e2a\u53ef\u4ee5\u81ea\u7531\u586b\u6570\u7684\u4f4d\u7f6e\uff0c\u6839\u636e\u4e58\u6cd5\u539f\u7406\uff0c\u65b9\u6848\u6570\u4e3a $m^p$\uff0c\u5176\u4e2d $p$ \u4e3a\u5f53\u524d\u8fde\u901a\u5757\u4e2a\u6570\u51cf\u4e00\uff08\u56e0\u4e3a\u6ca1\u7b97 $A_i<A_{P_i}$ \u7684\u60c5\u51b5\uff09\uff0c\u5feb\u901f\u5e42\u5373\u53ef\u3002\n\n\u5bf9\u4e8e $A_i<A_{P_i}$ \uff0c\u8003\u8651 $A_{P_i}=k$ \u65f6 $A_i$ \u6709 $k-1$ \u79cd\u9009\u62e9\uff0c\u6240\u4ee5\u7b54\u6848\u4e3a $1+2+...+m-1=\\frac {m\\times(m-1)} 2$\u3002\n\n\u7efc\u4e0a $f(i)=\\frac {m\\times(m-1)} 2+m^p$ \uff0c\u8fde\u901a\u5757\u4e2a\u6570\u7528\u5e76\u67e5\u96c6\u7ef4\u62a4\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n\\log n)$\u3002\n\n## Code\n\n```cpp\nint fa[N],p[N];\nint find(int x)\n{\n    if(x==fa[x])return x;\n    return fa[x]=find(fa[x]);\n}\nsigned main()\n{\n    int n,m,sum,ans=0;\n    read(n),read(m);sum=n;\n    FOR(i,1,n)read(p[i]);\n    FOR(i,1,n)fa[i]=i;\n    FOR(i,1,n)\n    {\n        int tx=find(i);\n        int ty=find(p[i]);\n        if(tx==ty)continue;\n        /*\u6ce8\u610f\u6b64\u5904\u4ee3\u8868 i=P[i] \u6216\u4e4b\u524d\u7684\u6761\u4ef6\u8981\u6c42 A[i]=A[P[i]] \u80af\u5b9a\u65e0\u89e3*/\n        fa[tx]=ty,sum--;\n        ans+=Pow(m,sum-1)*((m*(m-1)/2)%mod)%mod;\n        ans%=mod;\n    }\n    write(ans);\n    return 0;\n}\n```\n\n",
        "postTime": 1666578186,
        "uid": 207412,
        "name": "xiaoPanda",
        "ccfLevel": 0,
        "title": "ARC151B"
    },
    {
        "content": "[\u535a\u5ba2\u56ed](https://www.cnblogs.com/lnwhl/p/16800943.html)\n\n## Description\n\u7ed9\u5b9a\u4e00\u4e2a $1\\sim N$ \u7684\u6392\u5217 $P$\uff0c\u627e\u5230\u7b26\u5408\u4ee5\u4e0b\u6761\u4ef6\u7684 $A$ \u6570\u7ec4\u7684\u6570\u91cf $\\bmod 998244353$\u3002\n- \u5bf9\u4e8e $1\\sim N$ \u7684\u6bcf\u4e00\u4e2a $i$\uff0c$1\\le A_i\\le M$\u3002\n- $A$ \u6570\u7ec4\u5b57\u5178\u5e8f\u5c0f\u4e8e $(A_{P_1},A_{P_2},\\cdots,A_{P_n})$ \u6570\u7ec4\u3002\n\n## Solution\n\u8003\u8651\u5230\u4e00\u5171\u6709 $M^N$ \u4e2a $A$ \u5e8f\u5217\uff0c\u76f4\u63a5\u8ba1\u7b97\u5408\u6cd5\u65b9\u6848\u6570\u6bd4\u8f83\u590d\u6742\uff0c\u6211\u4eec\u9700\u8981\u8fdb\u884c\u4e00\u4e0b\u8f6c\u5316\u3002\n\n\u4e0d\u96be\u53d1\u73b0**\u6709\u4e00\u4e2a $A<AP$ \u7684\u65b9\u6848\u5c31\u4e00\u5b9a\u5bf9\u5e94\u4e00\u4e2a $A>AP$ \u7684\u65b9\u6848**\uff08\u5bf9\u79f0\u6027\uff09\uff0c\u6240\u4ee5\u95ee\u9898\u53ef\u4ee5\u8f6c\u5316\u4e3a\u6c42 $A=AP$ \u7684\u65b9\u6848\u6570 $X$\uff0c\u7b54\u6848\u5373\u4e3a $\\dfrac{M^N-X}{2}$\u3002\n\n\u90a3\u4e48\u5982\u4f55\u8ba1\u7b97 $A=AP$ \u7684\u65b9\u6848\u6570 $X$ \u5462\uff1f\n\n\u8003\u8651\u5230\u5982\u679c $A=AP$\uff0c\u90a3\u4e48 $A_i$ \u548c $A_{P_i}$ \u4e00\u5b9a\u76f8\u7b49\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728 $i$ \u548c $P_i$ \u4e4b\u95f4\u8fde\u4e00\u6761\u8fb9\uff0c\u95ee\u9898\u5c31\u8f6c\u5316\u6210\u4e86\u6c42\u56fe\u4e2d\u8fde\u901a\u5757\u7684\u4e2a\u6570\u3002\u82e5\u8fde\u901a\u5757\u7684\u4e2a\u6570\u4e3a $C$\uff0c\u90a3\u4e48 $X=M^C$\uff0c\u95ee\u9898\u7684\u7b54\u6848\u5c31\u53d8\u4e3a\u4e86 $\\dfrac{M^N-M^C}{2}$\u3002\n\n**Tips**:\n- $\\bmod$ \u610f\u4e49\u4e0b\u4e0d\u80fd\u76f4\u63a5\u9664 $2$\uff0c\u9700\u8981\u4e58 $2$ \u7684\u9006\u5143\u3002\n\n## Code\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int N=2e5+5;\nconst int mod=998244353;\nint n,m,p[N],vis[N],inv2=499122177;//2\u7684\u9006\u5143 \nvector<int>g[N];\nint Qpow(int x,int power)//\u5feb\u901f\u5e42 \n{\n\tint res=1;\n\tfor(;power;power>>=1,x=x*x%mod)\n\t\tif(power&1)res=res*x%mod;\n\treturn res;\n}\nvoid dfs(int u)//\u6c42\u8fde\u901a\u5757\u6570\u91cf \n{\n\tif(vis[u])return;vis[u]=1;\n\tfor(int i=0;i<g[u].size();++i)\n\t\tdfs(g[u][i]);\n}\nsigned main()\n{\n\tcin>>n>>m;\n\tfor(int i=1;i<=n;++i)\n\t{\n\t\tcin>>p[i];\n\t\tg[i].push_back(p[i]);//\u5efa\u8fb9 \n\t}\n\tint c=0;\n\tfor(int i=1;i<=n;++i)\n\t\tif(!vis[i])dfs(i),c++;\n\tcout<<(Qpow(m,n)-Qpow(m,c)+mod)*inv2%mod;\n\treturn 0;\n}\n```",
        "postTime": 1666424106,
        "uid": 451328,
        "name": "lnwhl",
        "ccfLevel": 6,
        "title": "\u3010\u9898\u89e3\u3011[ARC151B] A < AP"
    },
    {
        "content": "\n [\u3010ARC151B\u3011A < AP](https://atcoder.jp/contests/arc151/tasks/arc151_b)\n\n\u601d\u7ef4 + \u5e76\u67e5\u96c6\u7ef4\u62a4\u3002\n\n## Solution\n\n~~\u9898\u89e3\u8bf4\u8fd9\u662f\u4e00\u9053\u7ed3\u8bba\u9898~~\u3002\n\n\u6211\u81ea\u5df1\u7684\u505a\u6cd5\u662f\uff0c\u4ece $1$ \u5230 $n$ \u904d\u5386\u6bcf\u4e2a\u4f4d\u7f6e $i$\uff0c\u6bcf\u6b21\u6709\uff1a$a_j=a_{p_j}\\ (j\\in [1,i)),\\ a_i<a_{p_i}$\uff0c\u800c\u5bf9\u4e8e $j\\in(i,n]$\uff0c$a_j$ \u6ca1\u9650\u5236\u3002\n\n\u8fd9\u4e2a\u6839\u636e\u9898\u76ee\u8981\u6c42\u201c\u5b57\u5178\u5e8f\u6700\u5c0f\u201d\u7684\u6027\u8d28\u53ef\u4ee5\u63a8\u5f97\u3002\n\n\u6211\u4eec\u4f7f\u7528\u5e76\u67e5\u96c6\u53bb\u7ef4\u62a4\u8fd9\u4e9b\u6570\u4e4b\u95f4\u7684\u7b49\u91cf\u5173\u7cfb\uff0c\u7edf\u8ba1\u7b54\u6848\u65f6\uff0c\u9664\u4e86 $p_i$ \u548c $i$ \u4ee5\u5916\uff0c\u5176\u4ed6\u7684\u4e92\u4e0d\u76f8\u5e72\u7684\u6bcf\u5806\u6570\u90fd\u6709 $M$ \u79cd\u53d6\u503c\uff0c\u5bf9\u4e8e $a_i$ \u548c $a_{p_i}$ \u7684\u53d6\u503c\uff0c\u6613\u77e5\u662f $C_M^2$\u3002\n\n\u8fd9\u6837\u7edf\u8ba1\u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u91cd\u590d\u5462\uff1f\u56e0\u4e3a\u5f53\u4e14\u4ec5\u5f53\u5728\u7b2c $i$ \u6b21\u7edf\u8ba1\u65f6\uff0c\u6ee1\u8db3 $a_j=a_{p_j}\\ (j\\in [1,i)),\\ a_i<a_{p_i}$\uff0c\u6545\u4e0d\u91cd\u4e0d\u6f0f\u3002\n\n\uff08\u8fd9\u4e2a\u505a\u6cd5\u5e94\u8be5\u53ef\u4ee5\u901a\u8fc7\u624b\u73a9\u5c0f\u6837\u4f8b\u5341\u5206\u663e\u7136\u5730\u5f97\u5230\u2026\u2026\uff1f\uff09\n\n## Code\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n \n#define int long long\n#define ll long long\n#define rep(i, a, b) for(int i = a; i <= b; ++i)\n#define per(i, a, b) for(int i = a; i >= b; --i)\nconst int maxn = 2e5 + 5, mod = 998244353;\nint n, m, a[maxn];\nint f[maxn], ans, tot;\ninline int rd(){\n\tint x = 1, s = 0; char ch = getchar();\n\twhile(ch < '0' or ch > '9'){if(ch == '-') x = -1; ch = getchar();}\n\twhile(ch >= '0' and ch <= '9') s = s * 10 + ch - '0', ch = getchar();\n\treturn x * s;\n}\ninline void wr(int x){\n\tif(x < 0) putchar('-'), x *= -1;\n\tif(x > 9) wr(x / 10); \n\tputchar(x % 10 + '0');\t\n}\n\ninline int pw(int x, int p){\n\tint res = 1ll;\n\twhile(p){\n\t\tif(p & 1) res = res * x % mod;\n\t\tp /= 2, x = x * x % mod;\n\t} return res;\n}\ninline int fnd(int x){\n\treturn x == f[x] ? x : f[x] = fnd(f[x]);\n}\n\nsigned main(){ \n\tn = tot = rd(), m = rd(); tot -= 1;\n\tconst int C = m * (m - 1) % mod * pw(2, mod - 2) % mod;\n\trep(i, 1, n) f[i] = i, a[i] = rd();\n\trep(i, 1, n){\n\t\tif(fnd(i) == fnd(a[i])) continue;\n\t\tans = (ans + pw(m, tot - 1) * C % mod) % mod;\n//\t\tcout << i << \" \" << ans << endl;\n\t\ttot -= 1, f[fnd(i)] = fnd(a[i]);\n\t} printf(\"%lld\\n\", ans);\n\treturn 0;\n} \n```\n\n\n------------\n",
        "postTime": 1674785011,
        "uid": 469672,
        "name": "\u4f0d\u53c1\u58f9",
        "ccfLevel": 7,
        "title": "\u3010ARC151B\u3011A < AP \u9898\u89e3"
    },
    {
        "content": "### \u9898\u610f\u63cf\u8ff0\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $n$ \u7684\u6392\u5217 $p$\uff0c\u95ee\u6709\u591a\u5c11\u79cd\u957f\u5ea6\u4e3a $n$\uff0c\u5e8f\u5217\u4e2d\u503c\u7684\u53d6\u503c\u8303\u56f4\u5728 $1\\sim m$ \u7684\u5e8f\u5217\u4f7f\u5f97 $a$ \u6bd4\u6392\u5217\u540e\u7684\u6570\u7ec4 $a'$ \u5b57\u5178\u5e8f\u5c0f\uff0c\u7ed3\u679c\u5bf9 $998244353$ \u53d6\u6a21\u3002  \n[\u5b57\u5178\u5e8f\u7684\u5b9a\u4e49](https://baike.baidu.com/item/%E5%AD%97%E5%85%B8%E5%BA%8F/7786229?fr=aladdin)\n### \u9898\u76ee\u5206\u6790\n\u5bf9\u4e8e $i$\uff0c\u5982\u679c $i,p_i$ \u5df2\u7ecf\u5728\u4e00\u4e2a\u8fde\u901a\u5757\u4e2d,\u90a3\u4e48\u8bf4\u660e\u8fd9\u5df2\u7ecf\u5f62\u6210\u4e86\u4e00\u4e2a\u95ed\u5408\u73af\uff0c\u82e5\u5b58\u5728\u4e24\u4e2a\u4e4b\u95f4\u7684\u5927\u5c0f\u6bd4\u8f83\uff0c\u4f1a\u4ea7\u751f\u77db\u76fe\u6761\u4ef6\u3002\u56e0\u6b64\uff0c\u53ea\u80fd\u8fd9\u4e24\u4e2a\u6570\u76f8\u540c\uff0c\u6ca1\u6709\u4efb\u4f55\u8d21\u732e\u3002\u82e5 $i,p_i$ \u4e0d\u5728\u4e00\u4e2a\u8fde\u901a\u5757\u4e2d\uff0c\u90a3\u4e48\u9664\u53bb $i$ \u548c $p_i$ \u6240\u5728\u8fde\u901a\u5757\uff0c\u5176\u5b83\u8fde\u901a\u5757\u7684\u53d6\u503c\u90fd\u6709 $m$ \u79cd\u53d6\u503c\u65b9\u6848\uff0c\u53ef\u4ee5\u7528\u5feb\u901f\u5e42\u5904\u7406\u3002\u56e0\u4e3a $a$ \u5b57\u5178\u5c0f\u4e8e $a'$\uff0c\u6240\u4ee5 $a_i<a_{p_i}$\uff0c\u56e0\u6b64 $(a_i,a_{p_i})$ \u5171\u6709 $\\frac{m\\times (m-1)}{2}$ \u79cd\u4e0d\u540c\u7684\u53d6\u503c\u65b9\u6848\u3002\u5bf9\u4e8e $i,p_i$ \u6240\u5904\u8fde\u901a\u5757\u53ef\u4ee5\u7528\u5e76\u67e5\u96c6\u7ef4\u62a4\u3002\n### Code\n```cpp\nconst int mod=998244353,N=2e5+10;\nint n,m,p[N],fa[N],ans;\nint getfa(int x){//\u5e76\u67e5\u96c6\uff08\u8def\u5f84\u538b\u7f29\uff09\n    if(fa[x]!=x){\n        fa[x]=getfa(fa[x]);\n    }\n    return fa[x];\n}\nint qpow(int a,int b){//\u5feb\u901f\u5e42\n    int res=1;\n    while(b){\n        if(b&1){\n            res=res*a%mod;\n        }\n        a=a*a%mod;\n        b>>=1;\n    }\n    return res;\n}\nsigned main(){\n    read(n),read(m);\n    for(int i=1;i<=n;i++){\n        read(p[i]);\n        fa[i]=i;\n    }\n    int tot=n;//\u521d\u59cb\u8fde\u901a\u5757\u6709n\u4e2a\n    for(int i=1;i<=n;i++){\n        int u=getfa(i),v=getfa(p[i]);\n        if(u==v)continue;//\u5bf9\u7b54\u6848\u65e0\u8d21\u732e\uff0c\u4e5f\u4e0d\u51cf\u5c11\u8fde\u901a\u5757\u4e2a\u6570\n        ans=(ans+qpow(m,tot-2)*(m*(m-1)/2%mod)%mod)%mod;//\u7edf\u8ba1\u7b54\u6848\n        tot--;\n        fa[u]=v;//\u5408\u5e76\u8fde\u901a\u5757\n    }\n    write_endl(ans);\n    return 0;\n}\n```\n### \u9898\u5916\u8bdd\n\u8fd9\u573a\u6211\u4e8c\u5341\u5206\u949f\u6572\u51fab\uff0c\u60f3\u4e86\u4e00\u4e2a\u534a\u5c0f\u65f6\u8fd8\u6ca1\u60f3\u51fac\uff0c\u771f\u4e0d\u9519\u3002",
        "postTime": 1666449261,
        "uid": 131610,
        "name": "luo_shen",
        "ccfLevel": 7,
        "title": "arc151b\u9898\u89e3"
    }
]