[
    {
        "content": "\u8003\u8651\u6734\u7d20\u7684 dp\uff1a$f_{i,j}$ \u8868\u793a $A$ \u8fdb\u884c\u5b8c\u4e86 $i$ \u6b65\u9aa4\uff0c$B$ \u8fdb\u884c\u5b8c\u4e86 $j$ \u6b65\u9aa4\u7684\u6700\u5927\u5206\u6570\u548c\u3002\n\n\u8bb0 $pa_i,pb_i$ \u8868\u793a A/B \u7684\u7b2c $i$ \u4e2a\u6b65\u9aa4\u83b7\u5f97\u5206\u6570\u81f3\u5c11\u8981\u5728\u53e6\u4e00\u4e2a\u5e8f\u5217\u4e2d\u7684\u4f4d\u7f6e\u3002\n\n\u663e\u7136 $f_{i,j}=\\max\\{f_{i-1,j},f_{i,j-1}+[i\\le pb_j]cb_j\\}+[j\\le pa_i]ca_i$\u3002\n\n\u8003\u8651\u8fd9\u4e2a\u6b65\u9aa4 $i$ \u589e\u5927 $1$ \u7684\u8fc7\u7a0b\uff0c\u5373\u5148\u5c06\u4e00\u4e2a\u524d\u7f00\u52a0\u4e0a\u4e00\u4e2a\u503c\uff0c\u7136\u540e\u8fdb\u884c\u4e00\u4e2a $f_{i,j}\\leftarrow\\max(f_{i,j},f_{i,j-1}+[i\\le pos_j]cb_j)$ \u7684\u8fc7\u7a0b\u3002\n\n\u663e\u7136\u8fd9\u63d0\u793a\u6211\u4eec\u7ef4\u62a4\u5dee\u5206\uff0c\u5177\u4f53\u5730\uff0c\u6211\u4eec\u7ef4\u62a4 $d_j=f_{i,j}-(f_{i,j-1}+[i\\le pb_j]cb_j)$\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u90e8\u5206\u524d\u7f00 $+c_i$\uff0c\u663e\u7136\u662f\u6574\u4f53\u62ac\u5347/\u4e0b\u964d\uff0c\u4e2d\u95f4\u4e0d\u53d8\uff0c\u53ea\u9700\u8981\u5904\u7406\u6700\u540e\u4e00\u4e2a\u70b9\u5bf9\u540e\u8fb9\u7684\u8d21\u732e\u5373\u53ef\u3002\n\n\u5047\u8bbe\u6700\u540e\u7684\u8fd9\u4e2a\u70b9\u6539\u53d8\u4e86 $x$\u3002\n\n\u5982\u679c $x<0$\uff0c\u90a3\u4e48\u663e\u7136\u540e\u8fb9\u90fd\u4e0d\u53d8\uff0c\u4fee\u6539\u4e0b\u4e00\u9879\u7684\u5dee\u5206 $-x$ \u5373\u53ef\u3002\n\n\u5982\u679c $x\\ge 0$\uff0c\u53ef\u4ee5\u53d1\u73b0\u6bcf\u6b21\u4f1a\u201c\u5438\u6536\u201d\u4e00\u90e8\u5206 $x$\uff0c\u540e\u8fb9\u4f1a\u6709\u4e00\u4e2a $\\sum d_j\\le x$ \u7684\u524d\u7f00\u88ab\u63a8\u6210 $0$\u3002\n\n\u8fd8\u6709\u5c31\u662f\u53ef\u80fd\u6709 $[i\\le pb_j]$ \u53d8\u4e3a $0$\uff0c\u8ddf\u4e0a\u8fb9\u662f\u4e00\u6837\u7684\u3002\n\n\u76f4\u63a5\u7528 `set` \u7ef4\u62a4\u4e0d\u4e3a $0$ \u7684\u5dee\u5206\u4f4d\u7f6e\u5373\u53ef\uff0c\u9700\u8981\u6ce8\u610f\u66f4\u65b0\u987a\u5e8f\u3002\n\n\u603b\u590d\u6742\u5ea6 $O((n+m)\\log m)$\u3002\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\n#define fi first\n#define se second\n#define mp make_pair\n#define pb push_back\n#define pf push_front\n#define rep(i, s, t) for (int i = s; i <= t; ++i)\n#define per(i, s, t) for (int i = t; i >= s; --i)\n\nconst int N = 1e6 + 5;\n\nint n, m;\nll a[N], b[N], c[N], sa[N];\nll d[N], e[N], f[N], sb[N];\nll dt[N];\nint p1[N], p2[N];\nvector<int> adj[N];\nset<int> st;\n\nint main() {\n\tios::sync_with_stdio(false);\n\tcin.tie(nullptr), cout.tie(nullptr);\n\tcout << fixed << setprecision(15); \n\tcerr << fixed << setprecision(15);\n\n\tcin >> n >> m;\n\trep(i, 1, n) cin >> a[i] >> b[i] >> c[i];\n\trep(i, 1, m) cin >> d[i] >> e[i] >> f[i];\n\trep(i, 1, n) sa[i] = sa[i-1] + a[i];\n\trep(i, 1, m) sb[i] = sb[i-1] + d[i];\n\trep(i, 1, n) p1[i] = upper_bound(sb, sb + m + 1, b[i]-sa[i]) - sb - 1;\n\trep(i, 1, m) p2[i] = upper_bound(sa, sa + n + 1, e[i]-sb[i]) - sa - 1;\n\trep(i, 1, m) if(p2[i] >= 0) {\n\t   \tadj[p2[i]].pb(i);\n\t}\n\trep(i, 1, n) {\n\t\tfor(int j : adj[i-1]) {\n\t\t\tif(f[j] >= 0) dt[j] += f[j], st.emplace(j);\n\t\t}\n\t\tif(p1[i] >= 0) {\n\t\t\tif(c[i] <= 0) {\n\t\t\t\tdt[0] += c[i];\n\t\t\t\tdt[p1[i]+1] -= c[i];\n\t\t\t\tst.emplace(0), st.emplace(p1[i]+1);\n\t\t\t} else {\n\t\t\t\tdt[0] += c[i];\n\t\t\t\tst.emplace(0);\n\t\t\t\tll df = c[i];\n\t\t\t\tauto it = st.lower_bound(p1[i]+1);\n\t\t\t\twhile(df && it != st.end()) {\n\t\t\t\t\tint j = *it;\n\t\t\t\t\tll t = min(df, dt[j]);\n\t\t\t\t\tdt[j] -= t, df -= t;\n\t\t\t\t\tif(df) it = st.erase(it);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfor(int j : adj[i-1]) {\n\t\t\tif(f[j] < 0) {\n\t\t\t\tll tt = min(dt[j], -f[j]);\n\t\t\t\tll df = -f[j] - tt;\n\t\t\t\tdt[j] -= tt;\n\t\t\t\tauto it = st.lower_bound(j);\n\t\t\t\twhile(df && it != st.end()) {\n\t\t\t\t\tint k = *it;\n\t\t\t\t\tll t = min(df, dt[k]);\n\t\t\t\t\tdf -= t, dt[k] -= t;\n\t\t\t\t\tif(df) it = st.erase(it);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tll ans = 0;\n\trep(i, 0, m) {\n\t\tans += dt[i] + (p2[i] == n) * f[i];\n\t}\n\tcout << ans << \"\\n\";\n\n\treturn 0;\n}\n\n```",
        "postTime": 1685091272,
        "uid": 95103,
        "name": "KellyFrog",
        "ccfLevel": 9,
        "title": "\u9898\u89e3\u3010JOISC D2T2 Two Dishes\u3011"
    },
    {
        "content": "### \u9898\u76ee\u5927\u610f\n\n> \u4e24\u9053\u6599\u7406\u5206\u522b\u8981 $n,m$ \u4e2a\u64cd\u4f5c\u3002\u505a\u83dc\u9700\u8981\u6309\u987a\u5e8f\u3002\u7b2c\u4e00\u9053\u83dc\u7b2c $i$ \u4e2a\u6b65\u9aa4\u7528\u65f6 $a_i$\uff0c\u5982\u679c\u5728\u7b2c $s_i$ \u524d\u5b8c\u6210\u5f97\u5206 $p_i$\uff1b\u7b2c\u4e8c\u9053\u83dc\u7b2c $i$ \u4e2a\u6b65\u9aa4\u7528\u65f6 $b_i$\uff0c\u5982\u679c\u5728\u7b2c $t_i$ \u524d\u5b8c\u6210\u5f97\u5206 $q_i$\u3002\n>\n> \u6700\u5927\u5316\u8bc4\u5206\u3002\n>\n> \u4fdd\u8bc1 $1 \\le n,m, \\le 10^6,1\\le a_i,b_j \\le 10^9,1 \\le s_i,t_i \\le 10^{15},|p_i|,|q_i| \\le 10^9$\u3002\n\n### \u9898\u89e3\n\n\u4e0d\u59a8\u8bbe $f(x,y)$ \u8868\u793a\u7b2c\u4e00\u9053\u83dc\u5230\u6b65\u9aa4 $x$\uff0c\u7b2c\u4e8c\u9053\u83dc\u5230\u6b65\u9aa4 $y$ \u7684\u6700\u5927\u8bc4\u5206\u3002\u8f6c\u79fb\u90fd\u662f\u679a\u4e3e\u4e0a\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u7c7b\u4f3c\u8d70\u653e\u65b9\u683c\u3002\u76f8\u5f53\u4e8e\u5c31\u662f\u4ece $(0,0)$ \u8d70\u5230 $(n,m)$ \u7684\u6700\u5927\u8bc4\u5206\u3002\n\n\u4e8e\u662f\u8003\u8651\u628a\u8bc4\u5206\u770b\u6210\u70b9\uff0c\u70b9 $(i,s_i)$ \u6709\u6536\u76ca\u5f53\u4e14\u4ec5\u5f53\u4ed6\u5728\u8def\u5f84\u4e0a\u65b9\uff0c$(j,t_j)$ \u5728\u8def\u5f84\u4e0b\u65b9\u3002\u56e0\u4e3a\u4e0d\u5728\u4e00\u4e2a\u8fb9\u5f88\u70e6\uff0c\u6240\u4ee5\u5c06\u7b54\u6848\u5148\u52a0\u4e0a $\\sum p_i$\uff0c\u7136\u540e\u5c06\u70b9 $(i,s_i)$ \u7684\u6743\u503c $a_{i,s_i}$ \u8bbe\u4e3a $-p_i$\u3002\n\n\u9884\u5904\u7406\u4e2a\u524d\u7f00\u548c\uff0c\u8bbe $s_{i,j} = \\sum\\limits_{x=0}^y a_{i,x}$\u3002\u6240\u4ee5\u6709\u8f6c\u79fb\uff1a\n$$\nf(i,j) = \\max\\{ f(i,j-1) , f(i-1,j) + s_{i-1,j} \\}\n$$\n\u5bf9\u4e00\u884c\u8f6c\u79fb\u5206\u6790\u3002\u8003\u8651\u4e0b $f(x)$ \u7684\u6027\u8d28\uff0c\u663e\u7136 $f(x)$ \u662f\u5355\u8c03\u7684\uff0c\u5b83\u76f8\u5f53\u4e8e\u5c06 $f(x-1)$ \u503c\u52a0\u4e0a $s(x-1)$ \u7136\u540e\u53d6\u524d\u7f00\u6700\u5927\u503c\u3002\n\n\u6240\u4ee5\u6211\u4eec\u5dee\u5206\u4e00\u4e0b $f(x)$\uff0c\u5f97\u5230\u7684\u5dee\u5206\u6570\u7ec4 $d(i)$ \u4e00\u5b9a\u975e\u8d1f\u3002\n\n\u5982\u679c\u6211\u4eec\u5bf9 $d(i)$ \u52a0\u4e0a\u4e00\u4e2a\u6b63\u6570\uff0c\u90a3\u4e48\u6709\u5f71\u54cd\u53ea\u6709\u4f4d\u7f6e $i$\u3002\n\n\u5982\u679c\u52a0\u4e0a\u4e00\u4e2a\u8d1f\u6570 $x$\uff0c\u82e5 $d(i)$ \u53d8\u6210 $<0$\uff0c\u5219\u4f1a\u53d8\u6210 $0$\u3002\u63a5\u7740\u4f1a\u5f71\u54cd\u540e\u9762\u503c\u3002\u53ef\u4ee5\u53d1\u73b0\uff0c\u4ed6\u4f1a\u662f\u540e\u9762\u8fde\u7eed\u4e00\u6bb5\u603b\u548c\u6700\u591a\u4e3a $-x$ \u7684\u6570\u90fd\u53d8\u6210 $0$\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528\u7ebf\u6bb5\u6811\u4e8c\u5206\u7ef4\u62a4\u3002\n\n\u590d\u6742\u5ea6\u662f $\\mathcal{O}((n+m) \\log m)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstring>\n#include<cmath>\n#include<vector>\n#include<algorithm>\nusing namespace std;\ntypedef long long ll;\nconst ll N=1e6+5;\nconst ll inf=1e18;\nstruct node{\n\tll x,y;\n\tfriend bool operator < (node u,node v){\n\t\treturn (u.x==v.x)?(u.y<v.y):(u.x>v.x);\n\t}\n};\nll n,m,ans,a[N],s[N],p[N],b[N],r[N],q[N];\nvector<node> vc[N];\nstruct tree{\n\tll sum[N<<2],tag[N<<2];\n\tvoid pushup(ll k){\n\t\tsum[k]=sum[k<<1]+sum[k<<1|1];\n\t}\n\tvoid pushdown(ll k)\n\t{\tif(!tag[k])return;\n\t\tsum[k<<1]=sum[k<<1|1]=0,tag[k<<1]=tag[k<<1|1]=1;\n\t\ttag[k]=0;\n\t}\n\tvoid modify(ll k,ll l,ll r,ll x,ll y)\n\t{\tif(l==r){sum[k]+=y;return;}\n\t\tpushdown(k);\n\t\tll mid=(l+r)>>1;\n\t\tif(x<=mid)modify(k<<1,l,mid,x,y);\n\t\telse modify(k<<1|1,mid+1,r,x,y);\n\t\tpushup(k);\n\t}\n\tvoid reset(ll k,ll l,ll r,ll x,ll y)\n\t{\tif(x>y||l>y||r<x)return;\n\t\tif(x<=l&&r<=y){sum[k]=0,tag[k]=1;return;}\n\t\tpushdown(k);\n\t\tll mid=(l+r)>>1;\n\t\tif(x<=mid)reset(k<<1,l,mid,x,y);\n\t\tif(y>mid)reset(k<<1|1,mid+1,r,x,y);\n\t\tpushup(k);\n\t}\n\tll query(ll k,ll l,ll r,ll x,ll y)\n\t{\tif(x>y||l>y||r<x)return 0;\n\t\tif(x<=l&&r<=y)return sum[k];\n\t\tpushdown(k);\n\t\tll mid=(l+r)>>1;\n\t\tif(y<=mid)return query(k<<1,l,mid,x,y);\n\t\tif(x>mid)return query(k<<1|1,mid+1,r,x,y);\n\t\treturn query(k<<1,l,mid,x,y)+query(k<<1|1,mid+1,r,x,y);\n\t}\n\tll solve(ll k,ll l,ll r,ll x,ll y,ll pr,ll v)\n\t{\tll mid=(l+r)>>1,res=inf;\n\t\tif(x<=l&&r<=y)\n\t\t{\tif(l==r)\n\t\t\t{\tif(pr+sum[k]>=v)return l;\n\t\t\t\treturn inf;\n\t\t\t}\n\t\t\tpushdown(k);\n\t\t\tif(sum[k<<1]+pr>=v)return solve(k<<1,l,mid,x,y,pr,v);\n\t\t\telse return solve(k<<1|1,mid+1,r,x,y,pr+sum[k<<1],v);\n\t\t}\n\t\tpushdown(k);\n\t\tif(x<=mid)res=min(res,solve(k<<1,l,mid,x,y,pr,v));\n\t\tif(y>mid)res=min(res,solve(k<<1|1,mid+1,r,x,y,pr+query(k<<1,l,mid,x,y),v));\n\t\treturn res;\n\t}\n}T;\nint main()\n{\t//freopen(\"data.in\", \"r\", stdin);\n\tscanf(\"%lld%lld\",&n,&m);\n\tfor(ll i=1;i<=n;i++)\n\t{\tscanf(\"%lld%lld%lld\",&a[i],&s[i],&p[i]);\n\t\ta[i]+=a[i-1],s[i]=s[i]-a[i];\n\t}\n\tfor(ll i=1;i<=m;i++)\n\t{\tscanf(\"%lld%lld%lld\",&b[i],&r[i],&q[i]);\n\t\tb[i]+=b[i-1],r[i]=r[i]-b[i];\n\t}\n\tfor(ll i=1;i<=n;i++)\n\t{\tif(s[i]<0)continue;\n\t\tll pos=upper_bound(b+1,b+1+m,s[i])-b;\n\t\tif(pos<=m)vc[i-1].push_back((node){-p[i],pos});\n\t\tans+=p[i];\n\t}\n\tfor(ll i=1;i<=m;i++)\n\t{\tif(r[i]<0)continue;\n\t\tll pos=upper_bound(a+1,a+1+n,r[i])-a;\n\t\tvc[pos-1].push_back((node){q[i],i});\n\t}\n\tfor(ll i=0;i<n;i++)\n\t{\tsort(vc[i].begin(),vc[i].end());\n\t\tfor(ll j=0;j<(int)vc[i].size();j++)\n\t\t{\tnode v=vc[i][j];\n\t\t\tif(v.x>=0)T.modify(1,0,m,v.y,v.x);\n\t\t\telse{\n\t\t\t\tll x=T.solve(1,0,m,v.y,m,0,-v.x);\n\t\t\t\tif(x==inf)T.reset(1,0,m,v.y,m);\n\t\t\t\telse T.modify(1,0,m,x,v.x+T.query(1,0,m,v.y,x-1)),T.reset(1,0,m,v.y,x-1);\n\t\t\t}\n\t\t}\n\t}\n\tans+=T.sum[1];\n\tfor(ll i=0;i<(int)vc[n].size();i++)ans+=vc[n][i].x;\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n",
        "postTime": 1668073573,
        "uid": 39408,
        "name": "Rainy7",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 \u300cJOISC 2019 Day2\u300d\u4e24\u9053\u6599\u7406"
    }
]