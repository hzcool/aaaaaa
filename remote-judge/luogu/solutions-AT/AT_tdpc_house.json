[
    {
        "content": "under \u9898\u89e3 [AT694](https://www.luogu.com.cn/problem/AT694)\n\n\u540c\u6b65\u53d1\u5e03\u4e8e[\u4e2a\u4eba\u535a\u5ba2](https://fa555.github.io/2020/\u67d0At\u7684dp\u573a/#M-\u5bb6)\n\n### problem\n\n\u4e00\u680b\u623f\u5b50\u6709 $H \\ (2 \\le H \\le 10^9)$ \u5c42\uff0c\u6bcf\u5c42\u7684\u7ed3\u6784\u76f8\u540c\uff0c\u90fd\u6709 $R \\ (1 \\le R \\le 16)$ \u4e2a\u623f\u95f4\u3002\u6bcf\u5c42\u7684\u6784\u9020\u7528\u77e9\u9635 $g$ \u8868\u793a\u3002\u5982\u679c $g_{i, j} = 1$\uff0c\u5219\u623f\u95f4 $i$ \u548c\u623f\u95f4 $j$ \u4e4b\u95f4\u6709\u4e00\u6761\u53cc\u5411\u901a\u8def\u3002\u5bf9\u4e8e\u4efb\u610f\u7684 $h \\ (1 < h \\le H)$ \u548c $r \\ (1 \\le r \\le R)$\uff0c\u53ef\u4ee5\u901a\u8fc7 $h$ \u5c42\u623f\u95f4 $r$ \u4e0b\u697c\u5230 $h - 1$ \u5c42\u623f\u95f4 $r$\uff0c\u4e0d\u80fd\u4e0a\u697c\u3002\u6c42\u4ece $H$ \u5c42\u623f\u95f4 $1$ \u5230 $1$ \u5c42\u623f\u95f4 $1$ \u7684\u4e0d\u81ea\u4ea4\u7684\u8def\u5f84\u6761\u6570\u3002\n\n\u4fdd\u8bc1 $g_{i, j} \\in \\{0, 1\\}, g_{i, i} = 0, g_{i, j} = g_{j, i}$\u3002\u7b54\u6848\u5bf9 $10^9 + 7$ \u53d6\u6a21\u3002\n\n### solution\n\n~~\u770b\u5230\u5927\u5f97\u79bb\u8c31\u7684 $H$ \u76f4\u63a5\u63a8\u6d4b\u77e9\u9635+\u5feb\u901f\u5e42\u76f8\u5173\uff0c\u770b\u5230\u5c0f\u5f97\u79bb\u8c31\u7684 $R$ \u76f4\u63a5\u63a8\u6d4b\u72b6\u538b\u76f8\u5173~~\n\n\u8bbe\u77e9\u9635 $M_{i, j}$ \u8868\u793a\u5728\u540c\u4e00\u5c42\u4e2d\u623f\u95f4 $i$ \u5230\u623f\u95f4 $j$ \u7684\u4e0d\u81ea\u4ea4\u7684\u8def\u5f84\u6570\u3002\n\n\u8fd9\u4e2a\u53ef\u4ee5\u72b6\u538b\u6c42\uff0c\u8bbe $f_{s, i, S}$ \u4e3a\u4ece\u623f\u95f4 $s$ \u51fa\u53d1\uff0c\u7ecf\u8fc7\u603b\u70b9\u96c6\u4e3a $S$ \u5230\u8fbe $i$ \u7684\u4e0d\u81ea\u4ea4\u7684\u8def\u5f84\u6570\u3002\u76f4\u63a5\u679a\u4e3e\u8f6c\u79fb\u6ca1\u5565\u95ee\u9898\u3002\u90a3\u4e48 $M_{s, i} = \\sum{f_{s, i, T}}$\u3002\n\n\u521d\u59cb\u72b6\u6001 $f_{i, s, 2^s} = 1$\u3002\n\n\u7b54\u6848\u5373\u4e3a $(M^H)_{0, 0}$\u3002\u603b\u590d\u6742\u5ea6 $O((2^R + \\log H)R^3)$\uff0c\u65f6\u9650 8s \u8db3\u591f\u4e86\u3002\n\n### code\n\n\u5bf9\u4e8e\u6bcf\u4e2a $s$\uff0c$f$ \u540e\u4e24\u7ef4\u7684\u503c\u4e92\u76f8\u72ec\u7acb\uff0c\u53ef\u4ee5\u76f4\u63a5\u53bb\u6389\u7b2c\u4e00\u7ef4\u3002\n\n``` cpp\nconstexpr int mod = 1000000007;\n\ninline int _Add(int m, int n) {\n  return (m + n) % mod;\n}\n\ninline void Add(int &m, int n) {\n  m = _Add(m, n);\n}\n\nstruct Matrix {\n  int S, z[17][17];\n\n  Matrix(int _S, bool e=0); // e=1 \u65f6\u6784\u9020\u5355\u4f4d\u77e9\u9635\n  Matrix operator*(Matrix rhs);\n  friend Matrix operator^(Matrix b, int p);\n};\n\nint H, R, z[17][17], f[16][1<<16|1];\n\nint main() {\n  std::cin >> H >> R;\n  Matrix M(R);\n  for (int i = 0; i < R; ++i)\n    for (int j = 0; j < R; ++j)\n      std::cin >> z[i][j];\n\n  for (int s = 0; s < R; ++s) {\n    memset(f, 0, sizeof f);\n    f[s][1 << s] = 1;\n    for (int S = 0; S < 1 << R; ++S)\n      for (int i = 0; i < R; ++i)\n        if (f[i][S]) for (int j = 0; j < R; ++j)\n          if (!((S >> j) & 1) && z[i][j])\n            Add(f[j][S | (1 << j)], f[i][S]);\n    for (int i = 0; i < R; ++i)\n      M.z[s][i] = std::accumulate(f[i], f[i] + (1 << R), 0, _Add);\n  }\n  std::cout << (M ^ H).z[0][0];\n  return 0;\n}\n\n```",
        "postTime": 1585311294,
        "uid": 111890,
        "name": "fa_555",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 AT694 \u3010\u5bb6\u3011"
    }
]