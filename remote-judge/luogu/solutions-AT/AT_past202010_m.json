[
    {
        "content": "\u9898\u610f\uff1a\u7ed9\u5b9a\u4e00\u68f5\u6811\uff0c\u6709 $q$ \u6b21\u64cd\u4f5c\uff0c\u6bcf\u6b21\u5c06 $u$ \u5230 $v$ \u7684\u7b80\u5355\u8def\u5f84\u4e0a\u7684\u8fb9\u67d3\u6210\u989c\u8272 $c$\uff0c\u95ee\u6700\u540e\u6240\u6709\u8fb9\u7684\u989c\u8272\u3002\n\n\u9759\u6001\u533a\u95f4\u67d3\u8272\u662f\u7b80\u5355\u7684\uff0c\u642c\u5230\u6811\u4e0a\u53ea\u9700\u8981\u6811\u5256\u5373\u53ef\uff0c\u7531\u4e8e\u64cd\u4f5c\u53ea\u6709\u67d3\u8272\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u5199\u7ebf\u6bb5\u6811\u800c\u53bb\u5199 ODT\uff0c\u6bcf\u6b21\u94fe\u4e0a\u67d3\u8272\u662f $O(\\log n)$ \u6b21\u5e8f\u5217\u4e0a\u7684\u67d3\u8272\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u662f $O(q\\log^2 n)$\u3002\u6ce8\u610f\u5c06\u8fb9\u6620\u5c04\u5230 dfs \u5e8f $[2,n]$ \u7684\u70b9\u540e\uff0c\u8f93\u51fa\u65f6\u9700\u8981\u8f6c\u56de\u6765\u3002\n\n```cpp\n#include <bits/stdc++.h>\ntypedef long long ll;\ntypedef unsigned long long ull;\nusing namespace std;\ntemplate<typename T> inline void chkmin(T &x, const T &y) {\n\t(x > y) && (x = y);\n}\ntemplate<typename T> inline void chkmax(T &x, const T &y) {\n\t(x < y) && (x = y);\n}\nconst int N = 1e5 + 5;\nint dfn[N], idx, siz[N], son[N], fa[N], dep[N], top[N], rev[N], n, q, ans[N], _u[N], _v[N];\nvector<int> g[N];\nstruct node {\n\tint l, r;\n\tmutable int c;\n\tnode(int _l = -1, int _r = -1, int _c = 0) {\n\t\tl = _l, r = _r, c = _c;\n\t}\n\tbool operator < (const node &o) const {\n\t\treturn l < o.l;\n\t}\n};\nset<node> s;\ntypedef set<node>::iterator iter;\ninline void dfs1(int u, int rt) {\n\tfa[u] = rt, siz[u] = 1, dep[u] = dep[rt] + 1;\n\tfor (int v : g[u]) {\n\t\tif (v != rt) {\n\t\t\tdfs1(v, u);\n\t\t\tsiz[u] += siz[v];\n\t\t\tif (siz[v] > siz[son[u]])\n\t\t\t\tson[u] = v;\n\t\t}\n\t}\n}\ninline void dfs2(int u, int rt) {\n\ttop[u] = rt, dfn[u] = ++idx, rev[idx] = u;\n\tif (!son[u])\n\t\treturn;\n\tdfs2(son[u], rt);\n\tfor (int v : g[u]) \n\t\tif (v != fa[u] && v != son[u])\n\t\t\tdfs2(v, v);\n}\ninline iter split(int pos) {\n\titer it = s.lower_bound(node(pos));\n\tif (it != s.end() && it->l == pos)\n\t\treturn it;\n\tnode t(*--it);\n\ts.erase(it);\n\treturn (s.insert(node(t.l, pos - 1, t.c)), s.insert(node(pos, t.r, t.c)).first);\n}\ninline void assign(int l, int r, int c) {\n\titer itr = split(r + 1), itl = split(l);\n\ts.erase(itl, itr);\n\ts.insert(node(l, r, c));\n}\ninline void modify(int u, int v, int c) {\n\twhile (top[u] != top[v]) {\n//\t\tcerr << u <\n\t\tif (dep[top[u]] < dep[top[v]])\n\t\t\tswap(u, v);\n\t\tassign(dfn[top[u]], dfn[u], c);\n\t\tu = fa[top[u]];\n\t}\n\tif (dep[u] > dep[v])\n\t\tswap(u, v);\n\tassign(dfn[u] + 1, dfn[v], c);\n}\nsigned main() {\n\tcin.tie(nullptr)->sync_with_stdio(false);\n\tcin >> n >> q;\n\tfor (int i = 1; i < n; i++) {\n\t\tint u, v;\n\t\tcin >> u >> v;\n\t\tg[u].emplace_back(v), g[v].emplace_back(u);\n\t\t_u[i] = u, _v[i] = v;\n\t}\n\tdfs1(1, 0);\n\tdfs2(1, 1);\n//\treturn 0;\n\ts.insert(node(1, n, 0));\n\twhile (q--) {\n\t\tint u, v, c;\n\t\tcin >> u >> v >> c;\n\t\tmodify(u, v, c);\n\t}\n\tfor (auto [l, r, c] : s) {\n\t\tfor (int i = l; i <= r; i++)\n\t\t\tans[rev[i]] = c;\n\t}\n\tfor (int i = 1; i < n; i++) {\n\t\tif (dep[_u[i]] > dep[_v[i]])\n\t\t\tcout << ans[_u[i]] << '\\n';\n\t\telse\n\t\t\tcout << ans[_v[i]] << '\\n';\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1681800756,
        "uid": 434929,
        "name": "Usada_Pekora",
        "ccfLevel": 7,
        "title": "\u6c34\u9898\u3002"
    }
]