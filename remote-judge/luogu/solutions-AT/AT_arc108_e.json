[
    {
        "content": "\u5bf9\u4e8e\u4e00\u6bb5\u533a\u95f4\uff0c\u5982\u679c\u4e24\u4e2a\u7aef\u70b9\u90fd\u9009\u4e2d\u4e86\uff0c\u5219\u4e2d\u95f4\u7684\u671f\u671b\u548c\u5916\u9762\u5c31\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\u4e86\u3002\u8bbe $f(i,j)$ \u4e3a\u9009\u4e2d $i$ \u548c $j$ \u7684\u65f6\u5019\uff0c$(i,j)$ \u7684\u7b54\u6848\u3002\u4e3a\u4e86\u65b9\u4fbf\uff0c\u5728\u6574\u4e2a\u5e8f\u5217\u524d\u52a0\u4e0a $-\\infty$\uff0c\u5728\u672b\u5c3e\u52a0\u4e0a $\\infty$\u3002\n\n\u8bbe $cnt=\\sum_{i<k<j}[a_i<a_k<a_j]$\uff0c\u5219\uff1a\n\n$$f(i,j)=1+\\frac{1}{cnt}\\sum_{i<k<j\\land a_i<a_k<a_j}f(i,k)+f(k,j)$$\n\n\u76f4\u63a5\u505a\u7684\u590d\u6742\u5ea6\u662f $\\mathcal{O}(n^3)$ \u7684\uff0c\u8003\u8651\u4f18\u5316\u3002\u679a\u4e3e\u65f6\u56fa\u5b9a $i$ \u5411\u53f3\u679a\u4e3e $j$\u3002\u9700\u8981\u7ef4\u62a4\uff1a\n\n- \u5f53\u524d\u533a\u95f4\u5185\u6ee1\u8db3 $a_i<a_k<a_j$ \u7684 $k$ \u4e2a\u6570\uff1b\n- \u5f53\u524d\u533a\u95f4\u5185\u6ee1\u8db3 $a_i<a_k<a_j$ \u7684 $k$ \u7684 $\\sum f(i,k)$\uff1b\n- \u5f53\u524d\u533a\u95f4\u5185\u6ee1\u8db3 $a_i<a_k<a_j$ \u7684 $k$ \u7684 $\\sum f(k,j)$\u3002\n\n\u7528\u6743\u503c\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\uff0c\u6bcf\u6b21 $j$ \u53f3\u79fb\u65f6\u63d2\u5165 $f(k,j)$ \u548c $f(i,j)$\uff0c\u590d\u6742\u5ea6 $\\mathcal{O}(n^2\\log n)$\u3002\n\n```cpp\nconst int max_n = 2000, mod = int(1e9) + 7;\n\n// mod_int \u662f\u81ea\u52a8\u53d6\u6a21\u7684\u6574\u6570\u7c7b\u578b\nusing mint = mod_int<mod>;\n\ninline int lowbit(int x) { return x & -x; }\nstruct fwt\n{\n\tmint tr[max_n + 3];\n\tint n;\n\t\n\tvoid init(int _n)\n\t{\n\t\tn = _n;\n\t\tfill(tr, tr + n + 1, 0);\n\t}\n\tvoid add(int x, int v)\n\t{\n\t\tfor (x++; x <= n; x += lowbit(x))\n\t\t\ttr[x] += v;\n\t}\n\tmint get(int x)\n\t{\n\t\tmint ret = 0;\n\t\tfor (x++; x; x -= lowbit(x))\n\t\t\tret += tr[x];\n\t\treturn ret;\n\t}\n\tmint get(int x, int y)\n\t{\n\t\tif (x > y)\n\t\t\treturn 0;\n\t\treturn get(y) - get(x - 1);\n\t}\n} tr[max_n + 2], gcnt, kv;\n\nmint dp[max_n + 2][max_n + 2];\nint a[max_n + 2];\n\nvoid Init()\n{\n\tios_base::sync_with_stdio(false);\n\tcin.tie(nullptr);\n}\n\nsigned main()\n{\n\tInit();\n\t\n\tint n;\n\t\n\tcin >> n;\n\tfor (int i = 1; i <= n; i++)\n\t\tcin >> a[i];\n\ta[0] = 0, a[n + 1] = n + 1;\n\tfor (int i = 0; i <= n + 1; i++)\n\t\ttr[i].init(n + 2);\n\tfor (int i = n; i >= 0; i--)\n\t{\n\t\tgcnt.init(n + 2);\n\t\tkv.init(n + 2);\n\t\tfor (int j = i + 1; j < n + 2; j++)\n\t\t{\n\t\t\tint cnt = gcnt.get(a[i], a[j]).val();\n\t\t\tgcnt.add(a[j], 1);\n\t\t\tif (!cnt)\n\t\t\t\tcontinue;\n\t\t\tdp[i][j] = (kv.get(a[i], a[j]) + tr[j].get(a[i], a[j])) / cnt + 1;\n\t\t\tkv.add(a[j], dp[i][j].val());\n\t\t\ttr[j].add(a[i], dp[i][j].val());\n\t\t}\n\t}\n\t\n\tcout << dp[0][n + 1] << endl;\n\t\n\treturn 0;\n}\n```",
        "postTime": 1667272159,
        "uid": 119491,
        "name": "5ab_juruo",
        "ccfLevel": 0,
        "title": "\u3010\u9898\u89e3\u3011[ARC108E] Random IS"
    },
    {
        "content": "\u5982\u679c\u8003\u8651\u4ee5\u65f6\u95f4\u8f74 $\\text{DP}$\uff0c\u4f1a\u53d1\u73b0\u5373\u4f7f\u662f\u6700\u7ec8\u65b9\u6848\u76f8\u540c\uff0c\u6807\u8bb0\u987a\u5e8f\u4e0d\u540c\u4f1a\u5bfc\u81f4\u6982\u7387\u4e0d\u540c\u3002\u6240\u4ee5\u9700\u8981\u6362\u4e00\u79cd\u65b9\u5f0f $\\text{DP}$\u3002\n\n\u6ce8\u610f\u5230\u82e5 $a_l,a_r$ \u90fd\u88ab\u9009\u5b9a\uff0c\u90a3\u4e48\u5bf9\u4e8e $l\\le i \\le r,a_l\\le a_i\\le a_r$ \u7684 $a_i$ \u6765\u8bb2\uff0c\u5355\u72ec\u8003\u8651 $[l,r]$ \u5185\u548c\u6574\u4f53\u8003\u8651\u4e24\u79cd\u65b9\u5f0f\u4e0b\uff0c$a_i$ \u6210\u4e3a $[l,r]$ \u5185\u4e0b\u4e00\u4e2a\u88ab\u9009\u4e2d\u7684\u6982\u7387\u662f\u4e00\u6837\u7684\u3002\n\n\u57fa\u4e8e\u4e0a\u8ff0\u7ed3\u8bba\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u533a\u95f4 $\\text{DP}$\u3002\u4ee4 $f_{l,r}(l<r)$ \u8868\u793a\u5f53\u524d\u5df2\u7ecf\u9009\u5b9a $a_l,a_r$ \u540e\uff0c\u5728 $[l,r]$ \u4e2d\u671f\u671b\u8fd8\u80fd\u9009\u51fa\u6570\u7684\u4e2a\u6570\u3002\u540c\u65f6\uff0c\u6211\u4eec\u8bb0 $g_{l,r}$ \u8868\u793a $l\\le i \\le r , a_l\\le a_i \\le a_r$ \u7684 $i$ \u7684\u4e2a\u6570\u3002\n\n\u76f4\u63a5\u679a\u4e3e\u4e2d\u95f4\u70b9 $x$ \u5373\u53ef\u8f7b\u677e\u8f6c\u79fb\uff1a$f_{l,r}=\\frac{\\sum_{l\\le x\\le r,a_l\\le a_x\\le a_r}f_{l,x}+f_{x,r}}{g_{l,r}}+1$\u3002\n\n\u4ee5\u4e0a\u505a\u6cd5\u590d\u6742\u5ea6\u663e\u7136\u4e3a $O(n^3)$\uff0c\u8003\u8651\u4f18\u5316\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u8f6c\u79fb\u7684\u6c42\u548c\u5f0f\u4e3a\u4e00\u4e2a\u503c\u57df\u8303\u56f4\u5185\u7684\u6c42\u548c\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a $\\sum f_{l,x}$ \u548c $\\sum f_{x,r}$ \u5206\u522b\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u3002\u540c\u65f6\uff0c$g_{l,r}$ \u4e5f\u53ef\u4ee5\u5728\u533a\u95f4 $\\text{DP}$ \u7684\u8fc7\u7a0b\u4e2d\u7528\u6811\u72b6\u6570\u7ec4\u7ef4\u62a4\u3002\n\n\u5355\u6b21\u8f6c\u79fb\u590d\u6742\u5ea6 $O(\\log n)$\uff0c\u603b\u590d\u6742\u5ea6 $O(n^2 \\log n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int NR=2e3+10;\nconst int MOD=1e9+7;\n#define int long long\nint n,a[NR],f[NR][NR];\nvoid add(int &x,int y){x=(x+y)%MOD;} \n\nint quickpow(int x,int y){\n\tint res=1;\n\twhile(y){\n\t\tif(y&1)res=(res*x)%MOD;\n\t\tx=(x*x)%MOD;y>>=1;\n\t}\n\treturn res;\n}\nint Inv(int x){return quickpow(x,MOD-2);}\n\nstruct BIT{\n\tint c[NR];\n\tint lowbit(int x){\n\t\treturn x&(-x);\n\t}\n\tvoid modify(int x,int y){\n\t\twhile(x<=n){\n\t\t\tadd(c[x],y);\n\t\t\tx+=lowbit(x); \n\t\t}\n\t}\n\tint ask(int x){\n\t\tint res=0;\n\t\twhile(x){\n\t\t\tadd(res,c[x]);\n\t\t\tx-=lowbit(x);\n\t\t}\n\t\treturn res; \n\t}\n\tint calc(int l,int r){\n\t\tif(l>r)return 0;\n\t\treturn ask(r)-ask(l-1);\n\t}\n}T[NR],t1[NR],t2[NR];\n\nsigned main(){\n\tcin>>n;\n\tfor(int i=2;i<=n+1;i++)cin>>a[i],a[i]++;\n\ta[1]=1;a[n+2]=n+2;n+=2;\n\tfor(int i=1;i<n;i++)T[i].modify(a[i+1],1);\n\tfor(int len=2;len<n;len++)\n\t\tfor(int l=1,r;l<=n-len;l++){\n\t\t\tr=l+len;\n\t\t\tint sum=T[l].calc(a[l]+1,a[r]-1);\n\t\t\tif(sum>0)\n\t\t\t\tf[l][r]=(t1[l].calc(a[l]+1,a[r]-1)+t2[r].calc(a[l]+1,a[r]-1))*Inv(sum)%MOD+1;\n\t\t\tT[l].modify(a[r],1);\n\t\t\tt1[l].modify(a[r],f[l][r]);t2[r].modify(a[l],f[l][r]);\n\t\t}\n\tcout<<(f[1][n]+MOD)%MOD<<endl;\n\treturn 0;\n} \n```",
        "postTime": 1682001908,
        "uid": 117771,
        "name": "intel_core",
        "ccfLevel": 7,
        "title": "ARC108E"
    },
    {
        "content": "~~\u8003\u8651\u6700\u7ec8\u6807\u8bb0\u65b9\u6848\u4e00\u5b9a\u662f\u539f\u5e8f\u5217\u4e2d\u4e00\u4e2a\u6781\u5927\u7684\u4e0a\u5347\u5b50\u5e8f\u5217\uff0c\u8bbe\u957f\u5ea6\u4e3a $x$\uff0c\u5219\u663e\u7136\u6211\u4eec\u4e00\u5171\u6709 $x!$ \u79cd\u987a\u5e8f\u5c06\u5176\u6807\u8bb0\u3002~~\n\n~~\u6545\u4e0d\u59a8\u8bbe $dp_{i,j}$ \u8868\u793a\u524d $i$ \u4e2a\u6570\u4e2d\uff0c\u6781\u5927\u4e0a\u5347\u5b50\u5e8f\u5217\u957f\u5ea6\u4e3a $j$\uff0c\u4e14\u5f3a\u5236\u9009\u62e9\u7b2c $i$ \u4e2a\u6570\u7684\u65b9\u6848\u6570\uff0c$g_{i,j}$ \u8868\u793a\u8be5\u60c5\u51b5\u4e0b\u7684\u603b\u8d21\u732e\uff0c\u6700\u540e\u9664\u4e00\u4e0b\u5373\u53ef\u3002~~\n\n~~\u8f6c\u79fb\u65f6\u679a\u4e3e $i$ \u524d\u7684\u51b3\u7b56 $k$\uff0c\u5224\u65ad $a_i$ \u662f\u5426\u4e3a $[k+1,i]$ \u4e2d\u7684\u6700\u5c0f\u503c\uff0c\u82e5\u662f\u5219\u53ef\u4ee5\u8fdb\u884c\u8f6c\u79fb\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^3)$\u3002~~\n\n~~\u8003\u8651\u4f18\u5316\u8f6c\u79fb\uff0c\u5229\u7528\u503c\u57df\u6811\u72b6\u6570\u7ec4\u8f85\u52a9\u8f6c\u79fb\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2\\log n)$\u3002~~\n\n> \u6bcf\u6b21\u5747\u5300\u9009\u53d6\u6807\u8bb0\u3002\n\n\u5047\u4e86\uff0c\u56e0\u4e3a\u6bcf\u79cd\u65b9\u6848\u7684\u6982\u7387\u4e0d\u540c\u3002\n\n\u597d\u5427\uff0c\u770b\u6765\u4ece\u9009\u53d6\u7ed3\u679c\u6765\u63a8\u671f\u671b\u8fd9\u6761\u8def\u662f\u884c\u4e0d\u901a\u4e86\uff0c\u90a3\u6211\u4eec\u5c31\u8003\u8651\u5bf9\u9009\u53d6\u8fc7\u7a0b\u8fdb\u884c dp\u3002\n\n\u53d1\u73b0\u8be5\u9009\u53d6\u8fc7\u7a0b\u662f\u6ee1\u8db3\u533a\u95f4\u53ef\u5212\u5206\u6027\u7684\uff0c\u5373\u5982\u679c\u6211\u4eec\u5df2\u7ecf\u9009\u53d6\u4e86 $a_l,a_r$\uff0c\u8981\u5728\u533a\u95f4 $[l+1,r-1]$ \u4e2d\u5747\u5300\u9009\u62e9\u4e00\u4e2a\u6ee1\u8db3 $a_l<a_i<a_r$ \u7684 $a_i$\uff0c\u5219\u9009\u53d6\u8fc7\u540e\uff0c\u6574\u4e2a\u533a\u95f4\u5c31\u88ab\u6211\u4eec\u5206\u6210\u4e86\u4e24\u6bb5\uff0c\u4e5f\u5c31\u662f\u88ab\u6211\u4eec\u53d8\u6210\u4e86\u4e24\u4e2a\u5b50\u95ee\u9898\u3002\u4e8e\u662f\u5c31\u4f1a\u60f3\u5230\u533a\u95f4 dp \u4e86\uff01\n\n\u8bbe $dp_{i,j}$ \u8868\u793a\u5f3a\u5236\u9009\u62e9 $a_i,a_j$ \u65f6\u533a\u95f4 $[i+1,j-1]$ \u7684\u7b54\u6848\uff0c$g_{i,j}$ \u8868\u793a $[l,r]$ \u5185\u6ee1\u8db3 $a_l<a_s<a_r$ \u7684 $s$ \u7684\u4e2a\u6570\uff0c\u5219\u6709\u8f6c\u79fb\u65b9\u7a0b\uff1a\n$$\ndp_{i,j}=\\frac{\\sum_{s=l+1}^{r-1}[a_i<a_s<a_r]dp_{i,s}+dp_{s,j}}{g_{i,j}}+1\n$$\n\u6ce8\u610f\u5f53 $g_{i,j}=0$ \u65f6\u9700\u8981\u7279\u5224 $dp_{i,j}=0$\u3002\u6b64\u65f6\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^3)$\u3002\u8003\u8651\u4f18\u5316\u3002\n\n\u89c2\u5bdf\u5230\u5f0f\u5b50\u7684\u4e3b\u8981\u90e8\u5206\u662f\u6c42\u548c\u5f0f\uff0c\u8003\u8651\u5c06\u5176\u62c6\u5f00\uff0c\u770b\u770b\u80fd\u4e0d\u80fd\u5feb\u901f\u7ef4\u62a4\uff1a\n\n- $\\sum_{s=l}^r[a_l<a_s<a_r]dp_{l,s}$\n- $\\sum_{s=l}^r[a_l<a_s<a_r]dp_{s,r}$\n- $g_{l,r}$\n\n\u5148\u8003\u8651\u7b2c\u4e00\u4e2a\u5f0f\u5b50\u3002\u53d1\u73b0\u8fd9\u5176\u5b9e\u662f\u4e00\u4e2a\u4e8c\u7ef4\u504f\u5e8f\u95ee\u9898\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5f00 $n$ \u4e2a\u6811\u72b6\u6570\u7ec4\uff0c\u6bcf\u6b21\u5904\u7406\u5b8c $[l,r]$ \u65f6\u52a8\u6001\u5730\u5c06 $dp_{l,r}$ \u52a0\u5165\u7b2c $l$ \u4e2a\u6811\u72b6\u6570\u7ec4\u7684\u7b2c $a_r$ \u9879\uff0c\u4ee5\u6b64\u6d88\u6389\u4e00\u7ef4\uff0c\u8f6c\u79fb\u65f6\u5728\u5de6\u7aef\u70b9\u6811\u72b6\u6570\u7ec4\u4e2d\u533a\u95f4\u67e5\u8be2\u7b2c\u4e8c\u7ef4\u5373\u53ef\u3002\u7b2c\u4e8c\u3001\u4e09\u4e2a\u5f0f\u5b50\u540c\u7406\u3002\n\n\u4e8e\u662f\u590d\u6742\u5ea6\u5c31\u53d8\u6210 $O(n^2\\log n)$ \u4e86\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nconst int N=2005;\nconst int mod=1e9+7;\nint n,a[N];\nll dp[N][N];\nstruct BIT{\n    ll c[N][N];\n    int lowbit(int x){\n        return x&(-x);\n    }\n    void add(int o,int x,ll k){\n        for (int i=x;i<=n+2;i+=lowbit(i))\n            c[o][i]=(c[o][i]+k)%mod;\n    }\n    ll Query(int o,int x){\n        ll ans=0;\n        for (int i=x;i;i-=lowbit(i))\n            ans=(ans+c[o][i])%mod;\n        return ans;\n    }\n    ll query(int o,int l,int r){\n        return (Query(o,r)-Query(o,l-1)+mod)%mod;\n    }\n}A,B,C;\nint read(){\n\tint w=0,fh=1;\n\tchar c=getchar();\n\twhile (c>'9'||c<'0'){\n\t\tif (c=='-') fh=-1;\n\t\tc=getchar();\n\t}\n\twhile (c>='0'&&c<='9'){\n\t\tw=(w<<3)+(w<<1)+(c^48);\n\t\tc=getchar();\n\t}\n\treturn w*fh;\n}\nll ksm(ll x,ll y){\n    ll ans=1;\n    while (y){\n        if (y&1) ans=ans*x%mod;\n        x=x*x%mod;\n        y>>=1;\n    }\n    return ans;\n}\nint main(){\n#ifndef ONLINE_JUDGE\n\tfreopen(\"in.in\",\"r\",stdin);\n\tfreopen(\"out.out\",\"w\",stdout);\n#endif\n\tn=read();\n    for (int i=1;i<=n;i++) a[i]=read()+1;\n    a[0]=1,a[n+1]=n+2;\n    for (int i=0;i<=n;i++) \n        C.add(i,a[i+1],1);\n    for (int len=3;len<=n+2;len++){\n        for (int l=0;l<=n+2-len;l++){\n            int r=l+len-1;\n            if (a[l]>a[r]) continue;\n            // cout<<l<<\" \"<<r<<\"\\n\";\n            ll x=C.query(l,a[l],a[r]);\n            if (x>0) dp[l][r]=((A.query(l,a[l],a[r])+B.query(r,a[l],a[r]))*ksm(x,mod-2)%mod+1)%mod;\n            // cout<<A.query(l,a[l],a[r])<<\"\\n\";\n            // cout<<B.query(r,a[l],a[r])<<\" \"<<C.query(l,a[l],a[r])<<\"\\n\";\n            A.add(l,a[r],dp[l][r]),B.add(r,a[l],dp[l][r]),C.add(l,a[r],1);\n            // cout<<l<<\" \"<<r<<\" \"<<dp[l][r]<<\"\\n\";\n        }\n    }\n    cout<<dp[0][n+1]<<\"\\n\";\n\treturn 0;\n}\n```",
        "postTime": 1681962419,
        "uid": 257621,
        "name": "\u7ffc\u5fb7\u5929\u5c0a",
        "ccfLevel": 5,
        "title": "\u9898\u89e3 [ARC108E] Random IS"
    }
]