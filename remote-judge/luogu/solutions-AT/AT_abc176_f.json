[
    {
        "content": "[\u66f4\u597d\u7684\u89c2\u770b\u4f53\u9a8c](https://cxm1024.github.io/2023/01/19/abc176f-brave-chain-ti-jie/)\n\n> \u9898\u610f\uff1a\u6709 $3n$ \u5f20\u5361\u7247\uff0c\u6bcf\u5f20\u6709\u4e00\u4e2a $1\\sim n$ \u7684\u6570\u5b57\u3002\u6bcf\u6b21\u53ef\u4ee5\u5c06\u6700\u5de6\u8fb9\u7684 $5$ \u5f20\u5361\u7247\u4efb\u610f\u6392\u5217\uff0c\u5220\u6389\u524d $3$ \u5f20\uff0c\u5982\u679c\u8fd9\u4e09\u5f20\u6570\u5b57\u76f8\u7b49\u5219\u5f97\u4e00\u5206\uff1b\u6700\u540e\u5269\u4e0b\u7684\u4e09\u5f20\u5982\u679c\u76f8\u7b49\u4e5f\u7684\u4e00\u5206\u3002\u6c42\u6700\u5927\u603b\u5f97\u5206\u3002\n\n\u6a21\u62df\u4e00\u4e0b\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u53d1\u73b0\uff0c\u76f8\u5f53\u4e8e\u4f60\u6709\u4e24\u5f20\u201c\u624b\u724c\u201d\uff0c\u6bcf\u6b21\u65b0\u52a0\u5165\u4e09\u5f20\uff0c\u4f60\u4ece\u4e94\u5f20\u4e2d\u6254\u6389\u4e09\u5f20\uff0c\u8fd8\u662f\u5269\u4e0b\u4e24\u5f20\u3002\u4e8e\u662f\u53ef\u4ee5\u8003\u8651\u4e00\u4e2a DP \u72b6\u6001\uff1a$f[i][x][y]$ \u8868\u793a\u8fdb\u884c $i$ \u6b21\u64cd\u4f5c\uff0c\u64cd\u4f5c\u540e\u624b\u4e0a\u5269\u4e0b\u7684\u724c\u4e3a $x,y$ \u7684\u6700\u5927\u5f97\u5206\u3002\u8f6c\u79fb\u4e5f\u4e0d\u96be\uff0c\u679a\u4e3e\u4e0b\u4e00\u6b21\u65b0\u52a0\u8fdb\u6765\u4e09\u5f20\u540e\u5982\u4f55\u9009\u5373\u53ef\u3002\u65f6\u7a7a\u590d\u6742\u5ea6 $O(n^3)$\u3002\n\n\u4ed4\u7ec6\u60f3\u4e00\u4e0b\uff0c\u4f1a\u53d1\u73b0\u5bf9\u4e8e\u76f8\u540c\u7684 $x,y$\uff0c$f[i][x][y]$ \u968f\u7740 $i$ \u7684\u589e\u52a0\u6c38\u8fdc\u4e0d\u4f1a\u51cf\u5c11\uff0c\u56e0\u4e3a\u6700\u5dee\u7684\u60c5\u51b5\u65e0\u975e\u662f\uff1a\u6bcf\u65b0\u52a0\u4e09\u5f20\u5c31\u628a\u90a3\u4e09\u5f20\u6254\u6389\uff0c\u6c38\u8fdc\u8ba9 $x,y$ \u4e3a\u624b\u724c\uff0c\u5f97\u5206\u6c38\u8fdc\u4e0d\u4f1a\u51cf\u5c11\u3002\u8fd9\u542f\u53d1\u6211\u4eec\u8003\u8651 $f[i]\\to f[i+1]$ \u7684\u53d8\u5316\u3002\n\n\u9996\u5148\uff0c\u65b0\u52a0\u5165\u7684\u4e09\u5f20\u724c $a,b,c$ \u4e0e $x,y$ \u662f\u591a\u5c11\u65e0\u5173\uff0c\u53ea\u4e0e\u5f53\u524d\u8003\u8651\u5230\u54ea\u5f20\u724c\u6709\u5173\u3002\u5982\u679c $a=b=c$\uff0c\u4e0d\u7ba1 $x,y$ \u662f\u591a\u5c11\uff0c\u4e00\u5b9a\u76f4\u63a5\u628a\u5b83\u6254\u6389\uff0c\u8d2a\u5fc3\u5730\u7acb\u523b\u5f97\u5206\u3002\u6b63\u786e\u6027\u5bb9\u6613\u8bc1\u660e\uff0c\u8fd9\u91cc\u4e0d\u8d58\u8ff0\u3002\u63a5\u4e0b\u6765\u8003\u8651\u4e0d\u5168\u76f8\u7b49\u7684\u60c5\u51b5\u3002\n\n\u5982\u679c\u7528\u4e0a\u9762\u8bf4\u7684\u90a3\u6837\u201c\u6d88\u6781\u201d\u505a\u6cd5\uff0c\u65b0\u52a0\u5165\u4e09\u5f20\u724c\u5c31\u6254\u6389\uff0c$f[i+1][x][y]=f[i][x][y]$\uff0c\u8fd9\u662f\u4e0b\u9650\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece\u4e0a\u4e00\u7ef4\u8fc7\u6765\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u8003\u8651\u54ea\u4e9b $x,y$ \u4f1a\u53d1\u751f\u6539\u53d8\u5373\u53ef\u3002\u4e0e\u6d88\u6781\u505a\u6cd5\u76f8\u53cd\uff0c\u8981\u60f3\u6539\u53d8\u4e00\u5b9a\u8981\u8ba9\u64cd\u4f5c\u540e\u624b\u724c\u4e2d\u6709\u65b0\u724c\u3002\u6211\u4eec\u5148\u8003\u8651\u5982\u4f55\u6254\u724c\u80fd\u9020\u6210\u8d21\u732e\uff0c\u518d\u8003\u8651\u4e0d\u80fd\u9020\u6210\u8d21\u732e\u7684\u60c5\u51b5\u3002\n\n\u5047\u5982\u4e09\u5f20\u724c\u4e2d\u6709\u4e24\u5f20\u76f8\u7b49\uff08\u8fd9\u91cc\u5047\u8bbe\u662f $a=b$\uff09\uff0c\u90a3\u4e48\u53ea\u8981 $x,y$ \u4e2d\u6709\u4e00\u4e2a\u4e0e $a,b$ \u76f8\u7b49\u7684\u724c\u5373\u53ef\u51d1\u8d77\u6765\u6254\u6389\uff0c\u800c\u624b\u724c\u4e2d\u7684\u53e6\u4e00\u5f20\u724c\u4e0e $c$ \u7ec4\u6210\u65b0\u7684\u624b\u724c\u3002\u6b64\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u90a3\u4e2a\u201c\u53e6\u4e00\u5f20\u724c\u201d\uff0c\u5047\u8bbe\u4e3a $j$\uff0c\u90a3\u4e48\u6709 $f[i][a][j]+1\\to f[i+1][j][c]$\uff08\u8fd9\u91cc\u6682\u65f6\u4e0d\u8003\u8651\u4e24\u7ef4\u7684\u624b\u724c\u7684\u987a\u5e8f\uff0c\u5b9e\u73b0\u7684\u65f6\u5019\u5c06 $j,c$ \u548c $c,j$ \u90fd\u66f4\u6539\u5373\u53ef\uff09\u3002\u63a5\u4e0b\u6765\uff0c\u8003\u8651\u4e24\u5f20\u624b\u724c\u76f8\u7b49\uff0c\u4e0e\u53e6\u4e00\u5f20\u76f8\u7b49\u7684\u65b0\u724c\u914d\u5bf9\uff0c\u53ef\u4ee5\u76f4\u63a5\u679a\u4e3e\u4e0e\u54ea\u5f20\u65b0\u724c\u76f8\u7b49\uff0c\u5047\u8bbe\u4e3a $a$\uff0c\u5219\u6709 $f[i][a][a]+1\\to f[i+1][b][c]$\u3002\u4e8e\u662f\uff0c\u9020\u6210\u65b0\u8d21\u732e\u7684\u8003\u8651\u5b8c\u6210\u3002\n\n\u63a5\u7740\u8003\u8651\u4e0d\u9020\u6210\u65b0\u8d21\u732e\u7684\u8f6c\u79fb\uff1a\u7531\u4e8e\u524d\u9762\u8bf4\u8fc7\uff0c\u65b0\u7684\u624b\u724c\u4e2d\u5fc5\u987b\u7559\u65b0\u724c\uff0c\u6211\u4eec\u53ef\u4ee5\u679a\u4e3e\u7559\u54ea\u5f20\u65b0\u724c\uff0c\u518d\u679a\u4e3e\u53e6\u4e00\u5f20\u724c\u662f\u4ec0\u4e48\u3002\u5047\u8bbe\u7559\u7684\u65b0\u724c\u662f $a$\uff0c\u53e6\u4e00\u5f20\u724c\u662f $j$\uff0c\u90a3\u4e48\u5982\u679c $j=b$ \u6216 $j=c$\uff0c\u5373\u65b0\u7684\u624b\u724c\u7eaf\u7528\u65b0\u724c\u7ec4\u6210\uff0c\u6b64\u65f6\u65e7\u624b\u724c $x,y$ \u65e0\u8bba\u662f\u4ec0\u4e48\u90fd\u53ef\u884c\u3002\u53ef\u4ee5\u7ef4\u62a4\u6240\u6709 DP \u503c\u7684 $\\max$\u3002\u5982\u679c $j$ \u4e0d\u548c $b,c$ \u76f8\u7b49\uff0c\u5219\u65e7\u624b\u724c\u5fc5\u987b\u6709 $j$\uff0c\u6211\u4eec\u7ef4\u62a4\u4e00\u4e2a\u6570\u7ec4 $g[j]$ \u8868\u793a\u624b\u724c\u5305\u542b $j$ \u7684\u6240\u6709 DP \u503c\u7684 $\\max$ \u5373\u53ef\u3002\n\n\u4ee5\u4e0a\u4e24\u79cd\u8f6c\u79fb\u7684\u6b21\u6570\u90fd\u662f $O(n)$ \u7684\uff0c\u63a5\u4e0b\u6765\u8bf4\u56de\u201c\u7ee7\u627f\u201d\uff1a\u52a0\u5165\u4e09\u5f20\u724c\u76f4\u63a5\u6254\u6389\uff0c\u624b\u724c\u4e0d\u53d8\u3002\u5982\u679c\u76f4\u63a5\u679a\u4e3e $x,y$\uff0c\u66f4\u65b0 $f[i+1][x][y]=f[i][x][y]$ \u7684\u8bdd\uff0c\u590d\u6742\u5ea6\u4e3a $n^2$\uff0c\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u5077\u4e2a\u61d2\uff0c\u7701\u6389\u7b2c\u4e00\u7ef4 $i$\uff0c\u76f4\u63a5\u5728\u65e7\u7684 $f$ \u6570\u7ec4\u4e0a\u505a\u4fee\u6539\u5373\u53ef\u3002\u6ce8\u610f\u4fee\u6539\u5fc5\u987b\u8003\u8651\u5b8c\u6240\u6709\u8f6c\u79fb\u540e\u6574\u4f53\u4fee\u6539\uff0c\u56e0\u4e3a\u539f\u6765\u7684\u8f6c\u79fb\u662f $f[i][x][y]\\to f[i+1][x'][y']$\uff0c\u800c\u4e0d\u80fd $f[i+1][x][y]\\to f[i+1][x'][y']$\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7 vector \u5b58\u50a8 DP \u8f6c\u79fb\u5b9e\u73b0\u3002\u5177\u4f53\u53ef\u4ee5\u770b\u4ee3\u7801\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n//#define int long long\nvoid chkmax(int &a,int b) {a=a>b?a:b;}\nvoid chkmin(int &a,int b) {a=a<b?a:b;}\nint read() {\n\tint x=0,f=1;char ch=getchar();\n\twhile(!isdigit(ch)) f=(ch=='-'?-1:f),ch=getchar();\n\twhile(isdigit(ch)) x=x*10+ch-'0',ch=getchar();\n\treturn x*f;\n}\nint a[6010],f[2010][2010],g[2010],mx;\nsigned main() {\n\tint n=read(),m=n*3,cnt=0;\n\tfor(int i=1;i<=m;i++)\n\t\ta[i]=read();\n\tmemset(f,-0x3f,sizeof(f));\n\tmemset(g,-0x3f,sizeof(g));\n\tf[a[1]][a[2]]=f[a[2]][a[1]]=0;\n\tg[a[1]]=g[a[2]]=0,mx=0;\n\tfor(int i=3;i<m;i+=3) {\n\t\tarray<int,3> p={a[i],a[i+1],a[i+2]};\n\t\tsort(p.begin(),p.end());\n\t\tif(p[0]==p[2]) {cnt++;continue;}\n\t\tvector<pair<pair<int,int>,int> > ch;\n\t\tauto add=[&](int x,int y,int val) {\n\t\t\tch.push_back({{x,y},val});\n\t\t\tch.push_back({{y,x},val});\n\t\t};\n\t\tif(p[1]==p[2]) swap(p[0],p[2]);\n\t\tif(p[0]==p[1]) {\n\t\t\tfor(int i=1;i<=n;i++)\n\t\t\t\tadd(i,p[2],f[i][p[0]]+1);\n\t\t}\n\t\tfor(int i=0;i<3;i++) {\n\t\t\tvector<int> q;\n\t\t\tfor(int j=0;j<3;j++)\n\t\t\t\tif(i!=j) q.push_back(p[j]);\n\t\t\tadd(q[0],q[1],f[p[i]][p[i]]+1);\n\t\t}\n\t\tfor(int i=0;i<3;i++) {\n\t\t\tfor(int j=1;j<=n;j++) {\n\t\t\t\tbool flag=0;\n\t\t\t\tfor(int k=0;k<3;k++)\n\t\t\t\t\tif(i!=k&&j==p[k]) flag=1;\n\t\t\t\tif(flag) add(p[i],j,mx);\n\t\t\t\telse add(p[i],j,g[j]);\n\t\t\t}\n\t\t}\n\t\tfor(auto [x,val]:ch) {\n\t\t\tchkmax(f[x.first][x.second],val);\n\t\t\tchkmax(g[x.first],val),chkmax(g[x.second],val);\n\t\t\tchkmax(mx,val);\n\t\t}\n\t}\n\tint ans=0;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=i;j<=n;j++)\n\t\t\tchkmax(ans,f[i][j]+(i==a[m]&&j==a[m]));\n\tprintf(\"%d\\n\",ans+cnt);\n\treturn 0;\n}\n```",
        "postTime": 1674139675,
        "uid": 148812,
        "name": "cxm1024",
        "ccfLevel": 6,
        "title": "ABC176F Brave CHAIN\u9898\u89e3"
    },
    {
        "content": "\u9898\u610f\u5f88\u7b80\u5355\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8be6\u7ec6\u53d9\u8ff0\u4e86\u3002\n\n\u6211\u4eec\u53d1\u73b0\u7531\u4e8e\u6bcf\u6b21\u53ea\u62ff\u4e94\u4e2a \uff0c \u6d88\u6389\u4e09\u4e2a \uff0c \u5c31\u76f8\u5f53\u4e8e\u6bcf\u6b21\u624b\u724c\u53ea\u6709\u4e24\u4e2a \uff0c \u6bcf\u4e00\u8f6e\u7ed9\u4e09\u5f20\u724c\u8ba9\u4f60\u6d88 \uff0c \u5982\u679c\u4f60\u624b\u724c\u91cc\u6709\u548c\u8fd9\u4e09\u4e2a\u7ec4\u6210\u7684\u724c\u4e2d\u6709\u4e09\u5f20\u4e00\u6837\u989c\u8272\u5c31\u53ef\u4ee5\u6d88\u6389 \u3002\n\n\u5f88\u663e\u7136\u7684\u662f\u7531\u4e8e\u6bcf\u4e00\u8f6e\u7ed9\u7684\u4e09\u4e2a\u6570\u56fa\u5b9a \uff0c \u6211\u53ea\u9700\u8981\u7528\u4e24\u7ef4\u5206\u522b\u8868\u793a $x$ \u548c $y$ \u5c31\u53ef\u4ee5\u4e86 \uff0c \u90a3\u4e48\u663e\u7136\u6709 $dp_{i,j,k}$ \u4ee3\u8868\u7b2c $i$ \u8f6e \uff0c \u624b\u724c\u6709\u4e24\u79cd\u989c\u8272\u4e00\u79cd\u662f $j$ \uff0c \u4e00\u79cd\u662f $k$ \uff0c \u76f4\u63a5\u679a\u4e3e $j,k$ \u5bf9\u4e8e\u5f53\u524d\u4e09\u5f20\u724c $A,B,C$ , \u76f4\u63a5\u66f4\u65b0 \uff0c\u8fd9\u6837\u7684\u505a\u6cd5\u662f $O(n^3)$ \u7684 \u3002\n\n\u8003\u8651\u5230\u6211\u4eec\u6bcf\u6b21\u66f4\u6539\u7684\u4e1c\u897f\u5176\u5b9e\u5f88\u5c11 \uff0c \u53ea\u6709\u5c11\u90e8\u5206\u7684 $j,k$ \u5bf9\u4e8e\u5f53\u524d $A,B,C$ \u4f1a\u8fdb\u884c\u66f4\u65b0 , \u5927\u591a\u6570\u90fd\u662f\u7ee7\u627f\u3002\n\n\u5177\u4f53\u800c\u8a00\u5c31\u662f\u8003\u8651\u5982\u679c\u6d88\u6389\u7684\u662f $A,B,C$ \uff0c \u9996\u5148\u5982\u679c\u8bf4\u5b58\u5728 $A=B=C$ \u90a3\u4e48\u663e\u7136\u76f4\u63a5\u6d88\u6389\u80af\u5b9a\u4e0d\u52a3 \uff0c \u53ef\u4ee5\u76f4\u63a5\u7edf\u8ba1 \u3002\n\n\u5982\u679c\u6709\u4e24\u4e2a\u76f8\u7b49\u7684\u60c5\u51b5 \uff0c \u5c31\u6bd4\u5982\u8bf4 $A=B$ \u7684\u60c5\u51b5 , \u9700\u8981\u679a\u4e3e\u4e00\u4e2a $x$ \u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\u662f :\n\n$$dp[x][C]=max_{x=1}^n dp'[x][A]+1$$\n\n\u5982\u679c\u628a $x,y$ \u4e2d\u7684\u4e00\u4e2a\u6d88\u6389\u548c $A,B,C$ \u4e2d\u7684\u4e24\u4e2a\u6d88\u6389(\u5047\u8bbe\u6d88\u6389 $A,B$ , \u90a3\u4e48\u5c31\u662f :\n\n$$dp[x][C]=max_{x=1}^n dp[x][y]$$\n\n\u7edf\u8ba1\u4e00\u4e0b $s[x]=max_{x=1}^n dp[x][y]$ \u5c31\u53ef\u4ee5\u4e86 \u3002\n\n\u5269\u4e0b\u7684\u5c31\u662f\u5c06 $x,y$ \u548c $A,B,C$ \u4e2d\u7684\u4e00\u4e2a\u6d88\u6389 , \u5982\u679c\u662f\u5f53\u524d\u624b\u4e0a\u6709 $x,y=A$ \u90a3\u4e48\u662f\u53ef\u4ee5\u6d88\u6389\u7684 \uff0c \u5176\u4ed6\u7684\u90fd\u4e0d\u4f1a\u6d88\u6389 \uff0c \u76f4\u63a5\u7ee7\u627f\u4e0a\u4e00\u8f6e\u7684\u7b54\u6848 \u3002\n\n\u8fd9\u6837\u6bcf\u6b21\u66f4\u65b0\u7684\u70b9\u7684\u4e2a\u6570\u662f $O(n)$ \u7684 , \u65f6\u95f4\u590d\u6742\u5ea6 $O(n^2)$\n\n\u53ef\u80fd\u4ee3\u7801\u66f4\u597d\u7406\u89e3\u4e00\u70b9 :\n\n```cpp\n#include<bits/stdc++.h>\n#define For(i,a,b) for(int i=a;i<=b;i++)\n#define Rep(i,a,b) for(int i=a;i>=b;i--)\nusing namespace std;\nconst int maxn=2010,inf=2e9;\ninline int read()\n{\n\tint x=0,f=1;char c;\n\tfor(;!isdigit(c);c=getchar()) if(c=='-') f=-f;\n\tfor(;isdigit(c);c=getchar()) x=(x<<1)+(x<<3)+(c^48);\n\treturn x*f;\n}\nint n,buc[maxn*3],cnt;\nbool eq[maxn];int b[4],Max;\nint f[2][maxn][maxn],s[maxn];\n#define fir first\n#define sec second\ninline int chkmx(int &a,int b){if(a<b) a=b;return a;}\ninline int chkmn(int &a,int b){if(a>b) a=b;return a;}\nsigned main()\n{\n\tn=read();\n\tFor(i,1,n*3)\n\t\tbuc[i]=read();\n\tFor(i,1,n-1)\n\t{\n\t\tint p=3+(i-1)*3;\n\t\tif(buc[p]==buc[p+1]&&buc[p+1]==buc[p+2])\n\t\t\tcnt++,eq[i]=true;\n\t}\n\tint now=1,lst=0;\n\tFor(x,1,n) For(y,1,n)\n\t\tf[now][x][y]=s[x]=-inf;\n\tf[now][buc[1]][buc[2]]=s[buc[1]]=\n\tf[now][buc[2]][buc[1]]=s[buc[2]]=0;\n\tmemcpy(f[lst],f[now],sizeof f[lst]);\n\tFor(i,1,n-1) if(!eq[i])\n\t{\n\t\tnow^=1,lst^=1;\n\t\tint p=3+(i-1)*3;vector<pair<int,int> > vec;\n//\t\tprintf(\"%d\\n\",p);\n\t\tfunction<void(int,int,int)> push=[&](int x,int y,int v)\n\t\t\t{f[now][x][y]=chkmx(f[now][y][x],v),vec.push_back({x,y});}; \n\t\tb[1]=buc[p],b[2]=buc[p+1],b[3]=buc[p+2];\n\t\tpush(b[1],b[2],max(Max,f[lst][b[3]][b[3]]+1));\n\t\tpush(b[2],b[3],max(Max,f[lst][b[1]][b[1]]+1));\n\t\tpush(b[1],b[3],max(Max,f[lst][b[2]][b[2]]+1));\n\t\tsort(b+1,b+1+3);\n\t\tint A=b[1],B=b[2],C=b[3];\n\t\tif(B==C) swap(A,C);\n//\t\tprintf(\"A: %d B: %d C: %d\\n\",A,B,C);\n\t\tFor(x,1,n) if(~s[x])\n\t\t\tpush(x,A,s[x]),\n\t\t\tpush(x,B,s[x]),\n\t\t\tpush(x,C,s[x]);\n\t\tif(A==B) For(x,1,n) if(~f[lst][A][x])\n\t\t\tpush(x,C,f[lst][A][x]+1);\n\t\tfor(auto E:vec)\n\t\t{\n\t\t\tint x,y;tie(x,y)=E;\n\t\t\tMax=max(Max,f[now][x][y]);\n\t\t\tf[lst][x][y]=f[lst][y][x]=f[now][x][y];\n\t\t\tchkmx(s[x],f[now][x][y]),\n\t\t\tchkmx(s[y],f[now][x][y]);\n\t\t}\n\t}\n//\tprintf(\"Max: %d cnt: %d\\n\",Max,cnt);\n\tprintf(\"%d\\n\",max(Max,f[now][buc[3*n]][buc[3*n]]+1)+cnt);\n\treturn 0;\n}\n```\n",
        "postTime": 1669987109,
        "uid": 235855,
        "name": "shenxinge",
        "ccfLevel": 6,
        "title": "[\u9898\u89e3] [ABC176F] Brave CHAIN"
    }
]