[
    {
        "content": "## $\\text{statement}$\n\n\u6709\u4e00\u4e2a\u7531\u623f\u95f4\u7ec4\u6210\u7684\u5e8f\u5217\uff0c\u5176\u5411\u5de6\u53f3\u4e24\u7aef\u65e0\u9650\u5ef6\u4f38\u3002\u4f60\u548c Snuke \u5728\u73a9\u4e0b\u9762\u7684\u6e38\u620f\uff1a\n- \u88c1\u5224\u7ed9\u51fa\u4e00\u4e2a\u7531 `B` \u548c `S` \u7ec4\u6210\u7684\u5b57\u7b26\u4e32 $t$\uff0c\u540d\u4e3a\u56de\u5408\u51b3\u5b9a\u4e32\uff0c\u5e76\u5c06\u5b83\u5c55\u793a\u7ed9\u4e24\u540d\u73a9\u5bb6\u3002\n- \u9996\u5148\uff0cSnuke \u7ad9\u5728\u5176\u4e2d\u4e00\u4e2a\u623f\u95f4\u91cc\u3002\n- \u968f\u540e\uff0c\u5bf9\u4e8e\u6bcf\u4e2a $i = 1,2,\\dots,|t|$\uff0c\u53d1\u751f\u5982\u4e0b\u7684\u4e8b\u4ef6\uff1a\n  - \u5982\u679c $t$ \u4e2d\u7b2c $i$ \u4e2a\u5b57\u6bcd\u4e3a `B`\uff0c\u5219\u8fd9\u662f\u4f60\u7684\u56de\u5408\u3002\u4f60\u4f1a\u9009\u62e9\u4e00\u4e2a\u5176\u4e2d\u6ca1\u6709\u969c\u788d\u6216 Snuke \u7684\u623f\u95f4\uff0c\u5728\u5176\u4e2d\u653e\u7f6e\u4e00\u4e2a\u969c\u788d\u3002\u8fd9\u4e4b\u540e\uff0c\u5982\u679c Snuke \u6240\u5728\u623f\u95f4\u5de6\u53f3\u4e24\u4fa7\u7684\u623f\u95f4\u5747\u653e\u7f6e\u6709\u969c\u788d\uff0c\u5219\u4f60\u80dc\u5229\uff0c\u6e38\u620f\u7ed3\u675f\u3002\n  - \u5982\u679c $t$ \u4e2d\u7b2c $i$ \u4e2a\u5b57\u6bcd\u4e3a `S`\uff0c\u5219\u8fd9\u662f Snuke \u7684\u56de\u5408\u3002\u4ed6\u53ef\u4ee5\u79fb\u52a8\u5230\u4e0e\u5f53\u524d\u6240\u5728\u623f\u95f4\u76f8\u90bb\u4e14\u65e0\u969c\u788d\u7684\u623f\u95f4\uff0c\u6216\u4ec0\u4e48\u90fd\u4e0d\u505a\u3002\n- \u5982\u679c $|t|$ \u8f6e\u540e\u6e38\u620f\u4ecd\u672a\u7ed3\u675f\uff0c\u5219 Snuke \u80dc\u5229\uff0c\u6e38\u620f\u7ed3\u675f\u3002\n\n\u7ed9\u5b9a\u5b57\u7b26\u4e32 $s$\uff0c\u5176\u4e2d\u4ec5\u542b\u6709 `B`\u3001`S` \u4e0e `?` \u4e09\u79cd\u5b57\u7b26\u3002\u8bbe $s$ \u4e2d\u542b\u6709 $q$ \u4e2a `?`\uff0c\u6709 $2^q$ \u79cd\u586b\u6cd5\u5c06 $s$ \u4e2d\u7684 `?` \u66ff\u6362\u4e3a `B` \u6216 `S`\uff0c\u5f97\u5230\u4e00\u4e2a\u56de\u5408\u51b3\u5b9a\u4e32\u3002\u5047\u8bbe\u4e24\u540d\u73a9\u5bb6\u90fd\u6309\u6700\u4f18\u7b56\u7565\u64cd\u4f5c\uff0c\u5728\u8fd9 $2^q$ \u4e2a\u4e32\u4e2d\uff0c\u6709\u591a\u5c11\u79cd\u586b\u6cd5\u4f7f\u5f97\u4f60\u80fd\u80dc\u5229\u5462\uff1f\n\n\u8bf7\u8f93\u51fa\u7b54\u6848\u6a21 $998244353$ \u7684\u503c\u3002\n\n$1\\le |s|\\le 10^6$\u3002\n\n## $\\text{solution}$\n\n\u8bb0 $(L,R)$ \u4e3a Snuke \u53ef\u80fd\u9762\u5bf9\u7684\u4e00\u4e2a\u5c40\u9762\uff0c\u5176\u4e2d $L$ \u4e3a Snuke \u5411\u5de6\u53ef\u4ee5\u8d70\u5165\u7684\u623f\u95f4\u6570\uff0c$R$ \u4e3a Snuke \u5411\u53f3\u53ef\u4ee5\u8d70\u5165\u7684\u623f\u95f4\u6570\u3002\u6709 $(L,R)$ \u7b49\u4ef7\u4e8e $(R,L)$\u3002\n\n\u5bb9\u6613\u53d1\u73b0\u4f60\u64cd\u4f5c\u7684\u6700\u4f18\u7b56\u7565\u662f\u5c06 Snuke \u7684\u4e00\u4fa7\u5835\u6b7b\uff0c\u4ee4\u5176\u5728\u8fd9\u4e00\u4fa7\u53ef\u4ee5\u8d70\u5165\u7684\u623f\u95f4\u6570\u4e3a $0$\u3002\u91cd\u65b0\u9648\u8ff0\u6e38\u620f\uff1a   \nSnuke \u7684\u521d\u59cb\u5c40\u9762\u4e3a $(\\infty, \\infty)$\u3002\u5728 Snuke \u7684\u56de\u5408\uff0c\u4ed6\u53ef\u4ee5\u5c06 $(L,R)$ \u7684\u5c40\u9762\u8f6c\u79fb\u4e3a $(L\\pm 1, R\\mp 1)$ \u6216\u4e0d\u53d8\u3002\u5728\u4f60\u7684\u56de\u5408\uff0c\u4f60\u4f1a\u5c06 $(L,R)$ \u7684\u5c40\u9762\u8f6c\u79fb\u4e3a $(\\min\\{L,R\\},0)$\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u4f60\u8fdb\u884c\u7684\u6bcf\u6b21\u64cd\u4f5c\u90fd\u4f1a\u81f3\u5c11\u5c06 Snuke \u7684\u53ef\u8fbe\u8303\u56f4\u7f29\u5c0f\u81f3\u539f\u6765\u7684\u4e8c\u5206\u4e4b\u4e00\u3002\u56e0\u6b64\u4f60\u53ea\u9700\u8981\u64cd\u4f5c $O(\\log |s|)$ \u6b21\u5c31\u53ef\u4ee5\u80dc\u5229\u3002   \n\u8fd9\u4e2a\u6761\u4ef6\u4e0d\u597d\u8ba1\u6570\u4f60\u80dc\u5229\u7684\u4e32\uff0c\u4f46\u4fbf\u4e8e\u8ba1\u6570 Snuke \u80dc\u5229\u7684\u4e32\u3002\u8003\u8651\u9996\u5148\u6c42\u5f97\u5728\u8fd9 $2^q$ \u4e2a\u4e32\u4e2d Snuke \u80dc\u5229\u7684\u4e32\u7684\u6570\u91cf\uff0c\u518d\u7528 $2^q$ \u51cf\u53bb\u5176\u5c31\u662f\u7b54\u6848\u3002\n\n\u8003\u8651\u5012\u5e8f\u679a\u4e3e\u3002\u6211\u4eec\u53d1\u73b0\uff0c\u5f53\u4f4d\u7f6e $i$ \u7684\u5b57\u7b26\u4e3a `B` \u4e14\u5176\u4e3a\u5012\u6570\u7b2c $k$ \u4e2a\u65f6\uff0c\u5fc5\u987b\u4fdd\u8bc1 $i$ \u5230\u4e0b\u4e00\u4e2a `B` \u4e4b\u95f4\u5b58\u5728\u81f3\u5c11 $2^{k-1}$ \u4e2a `S`\u3002\u53ea\u6709\u8fd9\u6837\u624d\u80fd\u4f7f\u5f97 Snuke \u5728\u5f53\u524d\u60c5\u51b5\u4e0b\u4e0d\u8d25\u3002   \n\u8fd9\u5f15\u51fa\u4e86 dp \u7684\u89e3\u6cd5\u3002\n\n\u7531\u4e8e dp \u65b9\u7a0b\u7684\u7b2c\u4e8c\u7ef4\u53d6\u503c\u8303\u56f4\u4e3a $O(\\log n)$\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log n)$\u3002\n\n$\\text{code : }$\n\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n#define rep(i,s,t) for (register int i = (s), i##_ = (t) + 1; i < i##_; ++ i)\nconst int N = 1e6 + 10, mod = 998244353;\nint add(int a, int b) { return (a += b) >= mod ? a - mod : a; }\nint n, ans = 1, lgv, f[N][24], cnt[N], len;\nchar s[N];\n\nsigned main() {\n\tios::sync_with_stdio(false); cin.tie(0), cout.tie(0);\n\tcin >> s + 1; n = strlen(s + 1), lgv = __lg(n) + 1;\n\treverse(s + 1, s + 1 + n);\n\trep(i,1,n) {\n\t\tif (s[i] == 'B') cnt[i + 1] = cnt[i] + 1;\n\t\telse cnt[i + 1] = cnt[i];\n\t\tif (s[i] == '?') ans = add(ans, ans);\n\t} f[0][0] = 1;\n\trep(i,1,n) {\n\t\tif (s[i] == 'S' or s[i] == '?') {\n\t\t\tmemcpy(f[i], f[i - 1], sizeof f[i]);\n\t\t}\n\t\tif (s[i] == 'B' or s[i] == '?') {\n\t\t\trep(j,1,lgv) {\n\t\t\t\tlen = 0; if (j > 1) len = 1 << j - 2;\n\t\t\t\tint from = max(0, i - len - 1); len = min(len, i);\n\t\t\t\tif (len == 0 or cnt[i] == cnt[i - len]) \n\t\t\t\t\tf[i][j] = add(f[i][j], f[from][j - 1]);\n\t\t\t}\n\t\t} \n\t} \n  \trep(i,0,lgv) ans = add(ans, mod - f[n][i]);\n\tcout << ans << '\\n';\n}\n```\n",
        "postTime": 1668678722,
        "uid": 631791,
        "name": "joke3579",
        "ccfLevel": 0,
        "title": "AGC050C \u9898\u89e3"
    }
]