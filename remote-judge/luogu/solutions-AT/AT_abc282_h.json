[
    {
        "content": "\u8003\u8651\u76f4\u63a5 CDQ \u5206\u6cbb\u3002\u5bf9\u4e8e\u4e00\u4e2a\u533a\u95f4 $[l,r]$\uff0c\u4ece\u4e2d\u70b9 $m$ \u5411\u4e24\u8fb9\u6c42\u51fa $al_i=\\min_{j=i}^ma_j$\uff0c$bl_i=\\sum_{j=i}^mb_j$\uff0c$ar_i=\\min_{j=m+1}^ia_j$\uff0c$br_i=\\sum_{j=m+1}^ib_j$\u3002\n\n\u5bf9\u8de8\u8d8a\u4e86\u4e2d\u70b9\u7684\u70b9\u5bf9 $i,j$\uff0c\u7ea6\u675f\u6761\u4ef6\u53d8\u6210 $\\min(al_i,ar_j)+bl_i+br_j\\le S$\u3002\n\n\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n1. $al_i\\ge ar_j$\uff1a$ar_j+bl_i+br_j\\le S$\uff0c\u5373 $ar_j+br_j\\le S-bl_i$\uff0c\u53ef\u4ee5\u4f7f\u7528\u6811\u72b6\u6570\u7ec4\u7b80\u5355\u7ef4\u62a4\u3002\n2. $al_i< ar_j$\uff1a$al_i+bl_i+br_j\\le S$\uff0c\u5373 $br_j\\le S-al_i-bl_i$\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6811\u72b6\u6570\u7ec4\u7b80\u5355\u7ef4\u62a4\u3002\n\n\u7efc\u4e0a\uff0c\u76f4\u63a5\u7528\u6811\u72b6\u6570\u7ec4\u8ba1\u7b97\u8de8\u8d8a\u4e2d\u70b9\u7684\u70b9\u5bf9\u6570\u91cf\uff0c\u5c31\u53d8\u6210\u4e86\u7ecf\u5178 CDQ \u4e86\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2n)$\u3002\n\n```cpp\n#include <algorithm>\n#include <iostream>\n#include <numeric>\n#include <vector>\n\nusing namespace std;\nusing LL = long long;\n\nconst int kN = 2e5 + 1;\n\nint n;\nLL s, a[kN], b[kN], ans, al[kN], bl[kN], ar[kN], br[kN], dl[kN], dr[kN];\nvector<LL> p[2];\nLL bc[2][kN];\n\nvoid Ad(int o, int x, LL v) {\n  for (; x <= p[o].size(); x += x & -x) {\n    bc[o][x] += v;\n  }\n}\nLL Sm(int o, int x) {\n  LL s = 0;\n  for (; x; x -= x & -x) {\n    s += bc[o][x];\n  }\n  return s;\n}\nvoid Z(int o, int x) {\n  for (; x <= p[o].size(); x += x & -x) {\n    bc[o][x] = 0;\n  }\n}\nint G(int o, LL x) {\n  return lower_bound(p[o].begin(), p[o].end(), x) - p[o].begin() + 1;\n}\nvoid S(int l, int r) {\n  if (l == r) {\n    ans += a[l] + b[l] <= s;\n    return;\n  }\n  int m = l + r >> 1;\n  S(l, m), S(m + 1, r);\n  // ===== \u8ba1\u7b97 al,bl \u5e76\u6392\u5e8f =====\n  al[m] = a[m], bl[m] = b[m];\n  for (int i = m - 1; i >= l; --i) {\n    al[i] = min(al[i + 1], a[i]), bl[i] = bl[i + 1] + b[i];\n  }\n  iota(dl + l, dl + m + 1, l);\n  sort(dl + l, dl + m + 1, [](int i, int j) { return al[i] < al[j]; });\n  // ===== \u8ba1\u7b97 ar,br \u5e76\u6392\u5e8f =====\n  ar[m + 1] = a[m + 1], br[m + 1] = b[m + 1];\n  for (int i = m + 2; i <= r; ++i) {\n    ar[i] = min(ar[i - 1], a[i]), br[i] = br[i - 1] + b[i];\n  }\n  iota(dr + m + 1, dr + r + 1, m + 1);\n  sort(dr + m + 1, dr + r + 1, [](int i, int j) { return ar[i] < ar[j]; });\n  // ===== \u79bb\u6563\u5316 =====\n  p[0].clear(), p[1].clear();\n  for (int i = l; i <= m; ++i) {\n    p[0].push_back(s - bl[i]);\n    p[1].push_back(s - al[i] - bl[i]);\n  }\n  for (int i = m + 1; i <= r; ++i) {\n    p[0].push_back(ar[i] + br[i]);\n    p[1].push_back(br[i]);\n  }\n  sort(p[0].begin(), p[0].end());\n  int l0 = unique(p[0].begin(), p[0].end()) - p[0].begin();\n  p[0].resize(l0);\n  sort(p[1].begin(), p[1].end());\n  int l1 = unique(p[1].begin(), p[1].end()) - p[1].begin();\n  p[1].resize(l1);\n  // ===== \u7edf\u8ba1\u70b9\u5bf9\u6570\u91cf =====\n  for (int i = m + 1; i <= r; ++i) {\n    Ad(1, G(1, br[i]), 1);\n  }\n  int j = m + 1;\n  for (int i = l; i <= m; ++i) {\n    for (; j <= r && ar[dr[j]] <= al[dl[i]]; ++j) {\n      Ad(0, G(0, ar[dr[j]] + br[dr[j]]), 1);\n      Ad(1, G(1, br[dr[j]]), -1);\n    }\n    ans += Sm(0, G(0, s - bl[dl[i]])) + Sm(1, G(1, s - al[dl[i]] - bl[dl[i]]));\n  }\n  // ===== \u6e05\u96f6 =====\n  for (int k = m + 1; k <= r; ++k) {\n    Z(0, G(0, ar[k] + br[k]));\n    Z(1, G(1, br[k])); \n  }\n}\n\nint main() {\n  ios_base::sync_with_stdio(0), cin.tie(0), cout.tie(0);\n  cin >> n >> s;\n  for (int i = 1; i <= n; ++i) {\n    cin >> a[i];\n  }\n  for (int i = 1; i <= n; ++i) {\n    cin >> b[i];\n  }\n  S(1, n);\n  cout << ans;\n  return 0;\n}\n```",
        "postTime": 1671932395,
        "uid": 376161,
        "name": "wsfxk",
        "ccfLevel": 6,
        "title": "[ABC282Ex] Min + Sum \u9898\u89e3"
    },
    {
        "content": "\u4e00\u79cd\u5f88\u65b0\u7684\u5957\u8def\uff0c\u81f3\u5c11\u6211\u4ece\u6765\u6ca1\u89c1\u8fc7\u3002\n\n\u6839\u636e\u6700\u5c0f\u503c\u5206\u6cbb\u3002\n\n### \u5177\u4f53\u8fc7\u7a0b\n\n\u5f53\u6211\u4eec\u6c42\u89e3\u533a\u95f4 $[L,R]$ \u7684\u7b54\u6848\u65f6\uff0c\u53ef\u4ee5\u5148\u627e\u5230\u533a\u95f4\u4e2d\u6700\u5c0f\u503c\u6240\u5728\u7684\u4f4d\u7f6e $M$\uff0c\u7136\u540e\u6c42\u5bf9\u4e8e\u6240\u6709 $L \\le l \\le M \\le r \\le R$ \u7684\u5408\u6cd5\u533a\u95f4\u6570\u91cf\uff0c\u6700\u540e\u9012\u5f52\u5230 $[L,M-1]$ \u548c $[M+1,R]$\u3002\n\n#### \u627e\u533a\u95f4\u4e2d\u6700\u5c0f\u503c\u6240\u5728\u7684\u4f4d\u7f6e\n\n\u65b9\u6cd5\u5f88\u591a\uff0c\u8fd9\u91cc\u6211\u7528\u7684\u662f st \u8868\u3002\n\n#### \u6c42\u5bf9\u4e8e\u6240\u6709 $L \\le l \\le M \\le r \\le R$ \u7684\u5408\u6cd5\u533a\u95f4\u6570\u91cf\n\n\u5f53\u6211\u4eec\u786e\u5b9a\u4e86 $l$ \u548c $r$ \u7684\u5176\u4e2d\u4e00\u4e2a\u65f6\uff0c\u53e6\u4e00\u4e2a\u53ef\u4ee5\u901a\u8fc7\u4e8c\u5206\u76f4\u63a5\u5f97\u5230\uff0c\u6240\u4ee5\u6211\u4eec\u679a\u4e3e\u503c\u57df\u66f4\u5c0f\u7684\u90a3\u4e2a\u3002\u5373\uff1a\u82e5 $M-L<R-M$\uff0c\u679a\u4e3e $l$\uff0c\u5426\u5219\uff0c\u679a\u4e3e $r$\u3002\n\n#### \u590d\u6742\u5ea6\n\n\u6bcf\u6b21\u679a\u4e3e\u7684\u533a\u95f4\u5bf9\u4e8e\u4e0a\u6b21\u679a\u4e3e\u7684\u6765\u8bf4\u81f3\u5c11\u662f\u51cf\u534a\u7684\uff0c\u6240\u4ee5\uff0c\u6bcf\u4e2a\u4f4d\u7f6e\u9876\u591a\u88ab\u679a\u4e3e $\\log n$ \u6b21\uff0c\u603b\u590d\u6742\u5ea6\u662f $O(n \\log^2 n)$\u3002\n\n### \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n#define int long long\nusing namespace std;\n \nint read() {\n\tint s = 0, f = 1;\n\tchar ch = getchar();\n\twhile (ch < '0' || ch > '9')\n\t\tf = (ch == '-' ? -1 : 1), ch = getchar();\n\twhile (ch >= '0' && ch <= '9')\n\t\ts = (s << 1) + (s << 3) + (ch ^ 48), ch = getchar();\n\treturn s * f;\n}\n \nint n, S;\nint a[200005], b[200005], s[200005];\nint pos[200005][20];\n \n#define pw(x) (1 << (x))\n#define merge(x, y, i) (a[pos[x][i]] < a[pos[y][i]] ? pos[x][i] : pos[y][i])\n \nvoid build() {\n\tfor (int i = 1; i <= n; i++)\n\t\tpos[i][0] = i;\n\tfor (int j = 1; pw(j) <= n; j++)\n\t\tfor (int i = 1; i + pw(j) - 1 <= n; i++)\n\t\t\tpos[i][j] = merge(i, i + pw(j - 1), j - 1);\n}\n \nint qry(int l, int r) {\n\tint i = log(r - l + 1) / log(2);\n\treturn merge(l, r - pw(i) + 1, i);\n}\n \nint ans = 0;\n \nint calcl(int x, int L, int R, int S) {\n\tint l = L - 1, r = R + 1;\n\twhile (r - l > 1) {\n\t\tint mid = (l + r) >> 1;\n\t\tif (s[mid] - s[x - 1] <= S)\n\t\t\tl = mid;\n\t\telse\n\t\t\tr = mid;\n\t}\n\treturn l;\n}\n \nint calcr(int x, int L, int R, int S) {\n\tint l = L - 1, r = R + 1;\n\twhile (r - l > 1) {\n\t\tint mid = (l + r) >> 1;\n\t\tif (s[x] - s[mid - 1] <= S)\n\t\t\tr = mid;\n\t\telse\n\t\t\tl = mid;\n\t}\n\treturn r;\n}\n \nvoid Solve(int l, int r) {\n\tif (l > r)\n\t\treturn ;\n\tint mid = qry(l, r);\n\tif (mid - l < r - mid)\n\t\tfor (int i = l; i <= mid; i++)\n\t\t\tans += calcl(i, mid, r, S - a[mid]) - mid + 1;\n\telse\n\t\tfor (int i = mid; i <= r; i++)\n\t\t\tans += mid + 1 - calcr(i, l, mid, S - a[mid]);\n\tSolve(l, mid - 1), Solve(mid + 1, r);\n}\n \nsigned main() {\n\tn = read(), S = read();\n\tfor (int i = 1; i <= n; i++)\n\t\ta[i] = read();\n\tfor (int i = 1; i <= n; i++)\n\t\tb[i] = read(), s[i] = s[i - 1] + b[i];\n\tbuild();\n\tSolve(1, n);\n\tprintf(\"%lld\", ans);\n\treturn 0;\n}\n```",
        "postTime": 1671935445,
        "uid": 483037,
        "name": "Galex",
        "ccfLevel": 6,
        "title": "ABC282Ex \u9898\u89e3"
    },
    {
        "content": "\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $A_i$\uff0c\u627e\u5230\u5de6\u8fb9\u7b2c\u4e00\u4e2a\u5c0f\u4e8e\u548c\u53f3\u8fb9\u7b2c\u4e00\u4e2a\u4e0d\u5927\u4e8e\u8be5\u503c\u7684\u6570\u7684\u4e0b\u6807 $L_i,R_i$\uff0c\u90a3\u4e48 $A_i$ \u5c31\u662f\u6240\u6709\u6ee1\u8db3 $L_i<l\\le i\\le r<R_i$ \u7684\u533a\u95f4 $[l,r]$ \u7684\u6700\u5c0f\u503c\u3002\n\n\u5982\u679c $i-L_i<R_i-i$ \u5219\u679a\u4e3e $l$\uff0c\u5426\u5219\u679a\u4e3e $r$\uff0c\u518d\u4e8c\u5206\u627e\u5230\u6ee1\u8db3\u8981\u6c42\u7684\u53e6\u4e00\u4e2a\u7aef\u70b9\u7684\u533a\u95f4\u5373\u53ef\u3002\n\n\u4ee3\u7801\uff1a\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define mxn 200003\n#define rep(i,a,b) for(int i=a;i<=b;++i)\n#define rept(i,a,b) for(int i=a;i<b;++i)\n#define drep(i,a,b) for(int i=a;i>=b;--i)\nusing namespace std;\nint n,tot,q[mxn],l[mxn],r[mxn],rt[mxn];\nll s,mx,ans,a[mxn],b[mxn];\nsigned main(){\n\tscanf(\"%d%lld\",&n,&s);\n\trep(i,1,n)scanf(\"%lld\",&a[i]);\n\trep(i,1,n)scanf(\"%lld\",&b[i]),b[i]+=b[i-1],mx=max(mx,b[i]);\n\trep(i,1,n){\n\t\twhile(tot&&a[i]<a[q[tot]])tot--;\n\t\tl[i]=q[tot];\n\t\tq[++tot]=i;\n\t}\n\ttot=0,q[0]=n+1;\n\tdrep(i,n,1){\n\t\twhile(tot&&a[i]<=a[q[tot]])tot--;\n\t\tr[i]=q[tot];\n\t\tq[++tot]=i;\n\t}\n\trep(i,1,n){\n\t\tl[i]++,r[i]--;\n\t\tif(i-l[i]<r[i]-i){\n\t\t\trep(j,l[i],i)if(b[i]<=s-a[i]+b[j-1]){\n\t\t\t\tans+=upper_bound(b+i,b+r[i]+1,s-a[i]+b[j-1])-b-i;\n\t\t\t}\n\t\t}else{\n\t\t\trep(j,i,r[i])if(a[i]+b[j]-s<=b[i-1]){\n\t\t\t\tans+=i-(lower_bound(b+l[i]-1,b+i,a[i]+b[j]-s)-b);\n\t\t\t}\n\t\t}\n\t}\n\tcout<<ans;\n\treturn 0;\n}\n```",
        "postTime": 1682130798,
        "uid": 329857,
        "name": "zifanwang",
        "ccfLevel": 7,
        "title": "[ABC282Ex] Min + Sum \u9898\u89e3"
    },
    {
        "content": "## \u9898\u610f\n\u7ed9\u51fa\u5e8f\u5217 $a,b$\uff0c\u6c42\u51fa\u6ee1\u8db3\uff1a\n$$\n\\sum_{i=l}^rb_i+\\min_{i=l}^r a_i\\le s\n$$\n\u7684 $(l,r)$ \u6570\u91cf\uff0c\u5176\u4e2d $1\\le l\\le r\\le n$\u3002\n## \u601d\u8def\n\n\u7b97\u662f\u6bd4\u8f83\u5957\u8def\u7684\u9898\u4e86\uff0c\u533a\u95f4\u95ee\u9898\u60f3\u4e00\u4e0b\u5206\u6cbb\u603b\u4e4b\u6ca1\u6709\u9519\u3002\n\n\u6211\u4eec\u5bf9\u5e8f\u5217\u5206\u6cbb\uff0c\u7136\u540e\u5904\u7406\u51fa\u6765\u5206\u6cbb\u4e2d\u70b9\u5230\u5de6\u53f3\u7aef\u70b9\u7684 $a$ \u7684\u524d\u7f00\u6700\u5c0f\u503c\uff0c$b$ \u7684\u524d\u7f00\u548c\u3002\n\n\u7136\u540e\u5f53\u524d\u5206\u6cbb\u533a\u95f4\u5185\u7684\u95ee\u9898\u5c31\u53d8\u6210\u4e86\uff1a\n$$\n\\min(mmin_i,mmin_j)+sum_i+sum_j\\le s,i\\in[l,mid],j\\in[mid+1,r]\n$$\n\n\u7684 $(i,j)$ \u4e2a\u6570\u3002\n\n\u5176\u4e2d $mmin$ \u548c $sum$ \u5c31\u8868\u793a\u4ece\u5206\u6cbb\u4e2d\u70b9\u5230\u4f4d\u7f6e $i$ \u7684\u524d\u7f00\u6700\u5c0f\u503c\u548c\u524d\u7f00\u548c\uff08\u5f53\u7136\uff0c\u5bf9\u4e8e\u5de6\u534a\u533a\u95f4\u5176\u5b9e\u662f\u540e\u7f00\uff09\u3002\n\n\u6211\u4eec\u76ef\u4e00\u4e0b\u4e0a\u9762\u7684\u67ff\u5b50\uff0c\u53d1\u73b0\u53ea\u9700\u8981\u53bb\u6389 $\\min$ \u5c31\u4f1a\u975e\u5e38\u597d\u505a\u3002\n\n\u7531\u4e8e $b_i\\ge0$ \u6240\u4ee5 $sum$ \u5176\u5b9e\u662f\u5355\u8c03\u7684\uff0c\u800c $mmin$ \u80af\u5b9a\u662f\u5355\u8c03\u7684\uff0c\u6211\u4eec\u679a\u4e3e $i$ \uff0c\u4e8c\u5206\u51fa\u6765 $mmin_j\\ge mmin_i$ \u7684 $j$ \u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u5bf9\u4e8e\u5c0f\u4e8e\u5f53\u524d\u4f4d\u7f6e\u7684 $j$ \uff0c$mmin_j\\ge mmin_i $ \u4e00\u5b9a\u6210\u7acb\u3002\u6240\u4ee5\u67ff\u5b50\u5c31\u662f\uff1a\n$$\nmmin_i+sum_i+sum_j\\le s,j\\in[mid+1,p]\n$$\n$p$ \u662f\u6ee1\u8db3 $mmin_j\\ge mmin_i$ \u7684\u6700\u9760\u540e\u7684\u4f4d\u7f6e\u3002\n\n$i$ \u6b64\u65f6\u5df2\u7ecf\u786e\u5b9a\u4e86\uff0c\u4e8c\u5206\u4e00\u4e0b $j$ \u5c31\u884c\u4e86\u3002\n\n\u8fd9\u91cc\u8ffd\u6c42\u6548\u7387\u53ef\u4ee5\u5c06\u7b2c\u4e00\u6b21\u4e8c\u5206\u6539\u4e3a\u53cc\u6307\u9488\u626b\u63cf\u3002\n## code\n```cpp\ntypedef long long ll;\ntypedef pair<int,int> pii;\ntypedef vector<int> vi;\ntypedef vector<vector<int> > vii; \n#define X first\n#define Y second\nint mod;\nconst int MAXN=2e5+10;\nint n;ll s;\nll a[MAXN];\nint b[MAXN];\nll mmin[MAXN],sum[MAXN];\nll ans=0;\nvoid solve(int l,int r)\n{\n\tif(l==r)return ans+=a[l]+b[r]<=s,void();\n\tint mid=(l+r)>>1;\n\tsolve(l,mid),solve(mid+1,r);\n\tmmin[mid+1]=a[mid+1],sum[mid+1]=b[mid+1];\n\tfor(int i=mid+2;i<=r;i++)mmin[i]=min(mmin[i-1],a[i]);\n\tfor(int i=mid+2;i<=r;i++)sum[i]=sum[i-1]+b[i];\n\tmmin[mid]=a[mid],sum[mid]=b[mid];\n\tfor(int i=mid-1;i>=l;i--)mmin[i]=min(mmin[i+1],a[i]);\n\tfor(int i=mid-1;i>=l;i--)sum[i]=sum[i+1]+b[i];\n\tvector<ll>L,R;\n\tfor(int i=mid+1;i<=r;i++) R.push_back(sum[i]);\n\tfor(int i=mid;i>=l;i--) L.push_back(sum[i]);\n\tint i=l,j=r;\n\twhile(i<=mid||j>mid)\n\t{\n\t\tif(j<=mid||mmin[i]<=mmin[j]&&i<=mid)\n\t\t{\n\t\t\tint p=upper_bound(R.begin(),R.begin()+j-mid,s-mmin[i]-sum[i])-R.begin();\n\t\t\tans+=p;\n\t\t\ti++;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tint p=upper_bound(L.begin(),L.begin()+mid-i+1,s-mmin[j]-sum[j])-L.begin();\n\t\t\tans+=p;\n\t\t\tj--;\n\t\t}\n\t}\n}\nsigned main()\n{\t\n\tios::sync_with_stdio(0),cin.tie(0),cout.tie(0);\n\tcin>>n>>s;\n\tfor(int i=1;i<=n;i++)cin>>a[i];\n\tfor(int i=1;i<=n;i++)cin>>b[i];\n\tsolve(1,n);cout<<ans<<'\\n';\n\treturn 0;\n} \n```\n\n",
        "postTime": 1672559309,
        "uid": 571229,
        "name": "__stick",
        "ccfLevel": 7,
        "title": "[ABC282Ex] Min + Sum"
    },
    {
        "content": "\u8003\u8651\u56fa\u5b9a\u4e00\u4e2a\u53f3\u7aef\u70b9\u53bb\u7edf\u8ba1\u5de6\u7aef\u70b9\u3002\n\n\u628a\u4e24\u4e2a\u8d21\u732e\u5206\u5f00\u7edf\u8ba1\uff0c\u540e\u7f00\u6700\u5c0f\u503c\u76f4\u63a5\u5355\u8c03\u6808\uff0c\u6808\u91cc\u9762\u7ef4\u62a4\u6bcf\u4e00\u6bb5\u540e\u7f00\u6700\u5c0f\u503c\u76f8\u7b49\u7684\u533a\u95f4\uff0c\u5219\u6bcf\u6b21\u5f39\u6808\u90fd\u76f8\u5f53\u4e8e\u4e00\u6bb5\u533a\u95f4\u52a0\uff0c\u8003\u8651\u64cd\u4f5c\u6b21\u6570\u3002\n\n\u79f0\u6bcf\u6b21\u63d2\u5165\u7684\u65f6\u5019\u5bf9\u5e94\u7684\u90a3\u4e00\u6bb5\u4e3a\u672c\u6bb5\uff0c\u5219\u4e0d\u96be\u53d1\u73b0\u6bcf\u4e00\u6bb5\u4f5c\u4e3a\u975e\u672c\u6bb5\u53ea\u4f1a\u88ab\u5728\u5f39\u6808\u65f6\u533a\u95f4\u52a0\u4e00\u6b21\uff0c\u6240\u4ee5\u64cd\u4f5c\u6b21\u6570\u4ecd\u4e3a\u7ebf\u6027\u3002\n\n\u533a\u95f4\u548c\u663e\u7136\u4e5f\u662f\u533a\u95f4\u52a0\u3002\n\n\u7136\u540e\u5c31\u662f\u5206\u5757\u7ecf\u5178\u95ee\u9898\uff1a\u533a\u95f4\u52a0\uff0c\u533a\u95f4\u67e5\u8be2\u5c0f\u4e8e\u7b49\u4e8e $S$ \u7684\u4e2a\u6570\u3002\n\n\u8bbe\u5757\u957f\u4e3a $B$ \u3002\n\n\u5bf9\u4e8e\u6bcf\u4e00\u5757\u7ef4\u62a4\u4e00\u4e2a\u6392\u5e8f\u540e\u7684\u5e8f\u5217\u3002\n\n\u67e5\u8be2\u6574\u5757\u66b4\u529b\u4e8c\u5206\u6563\u5757\u76f4\u63a5\u66b4\u529b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\frac n B \\log B + B)$ \u3002\n\n\u4fee\u6539\u6574\u5757\u6253\u6807\u8bb0\uff0c\u6563\u5757\u65f6\u5148\u5728\u6392\u5b8c\u5e8f\u7684\u5e8f\u5217\u4e2d\u63d0\u53d6\u51fa\u533a\u95f4\u52a0\u6240\u6d89\u53ca\u7684\u6570\uff0c\u4ee5\u53ca\u4e0d\u6d89\u53ca\u7684\u6570\uff0c\u4e4b\u540e\u7b49\u4ef7\u4e8e\u5c06\u4e24\u4e2a\u6709\u5e8f\u6570\u5217\u5f52\u5e76\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(\\frac n B + B)$ \u3002\n\n\u4ee4\uff1a$B=\\sqrt {n \\log n}$ \uff0c\u5219\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(n \\sqrt {n \\log n})$ \uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n\u6ce8\u610f\u533a\u95f4\u52a0\u7684\u6b21\u6570\u524d\u9762\u6709\u4e00\u4e2a\u5e38\u6570\uff0c\u800c\u533a\u95f4\u52a0\u65f6\u6563\u5757\u91cd\u6784\u8f83\u6162\uff0c\u6240\u4ee5\u53ef\u4ee5\u8c03\u5c0f $B$ \u6765\u4f18\u5316\u5e38\u6570\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=2e5+5;\ntypedef long long ll;\nint B,n;ll a[N],c[N],S;\nint b[N];\n#define mp(x) ((x-1)/B)\n#define bg(x) ((x)*B+1)\n#define ed(x) (min(((x)+1)*B,n))\nint aa[N],bb[N];\nvoid rebuild(int x,int y,ll v,int z){\n\tfor(int i=bg(z);i<=ed(z);++i)\n\t\ta[i]+=c[z];\n\tint sz1=0,sz2=0;\n\tfor(int i=bg(z);i<=ed(z);++i){\n\t\tif(b[i]>=x&&b[i]<=y)\n\t\t\tbb[sz2++]=b[i];\n\t\telse aa[sz1++]=b[i];\n\t}\n\tfor(int i=x;i<=y;++i)a[i]+=v;\n\tint tp1=0,tp2=0;\n\tfor(int i=bg(z);i<=ed(z);++i){\n\t\tif(tp2==sz2||(tp1!=sz1&&a[aa[tp1]]<=a[bb[tp2]]))\n\t\t\tb[i]=aa[tp1],tp1++;\n\t\telse b[i]=bb[tp2],tp2++;\n\t}\n\tc[z]=0;\n}\nvoid add(int x,int y,ll v){\n\tif(mp(x)==mp(y))\n\t\trebuild(x,y,v,mp(x));\n\telse{\n\t\trebuild(x,ed(mp(x)),v,mp(x));\n\t\trebuild(bg(mp(y)),y,v,mp(y));\n\t\tfor(int i=mp(x)+1;i<mp(y);++i)\n\t\t\tc[i]+=v;\n\t}\n}//\u533a\u95f4\u52a0\nint qry(int x,int y){\n\tif(mp(x)==mp(y)){\n\t\tint ans=0;\n\t\tfor(int i=x;i<=y;++i)\n\t\t\tif(a[i]+c[mp(x)]<=S)ans++;\n\t\treturn ans;\n\t}\n\telse{\n\t\tint ans=0;\n\t\tfor(int i=x;i<=ed(mp(x));++i)\n\t\t\tif(a[i]+c[mp(x)]<=S)ans++;\n\t\tfor(int i=bg(mp(y));i<=y;++i)\n\t\t\tif(a[i]+c[mp(y)]<=S)ans++;\n\t\tfor(int i=mp(x)+1;i<mp(y);++i){\n\t\t\tint l=bg(i),r=ed(i),mid=(l+r)>>1,k=bg(i)-1;\n\t\t\twhile(l<=r){\n\t\t\t\tif(a[b[mid]]+c[i]<=S)\n\t\t\t\t\tk=mid,l=mid+1;\n\t\t\t\telse r=mid-1;\n\t\t\t\tmid=(l+r)>>1;\n\t\t\t}\n\t\t\tans+=k-bg(i)+1;\n\t\t}\n\t\treturn ans;\n\t}\n}\nint ql[N],qr[N],tot;\nll qv[N];\nll Av[N],Bv[N];\nvoid ins(int x){\n\tadd(x,x,Av[x]);\n\twhile(tot&&qv[tot]>=Av[x]){\n\t\tadd(ql[tot],qr[tot],Av[x]-qv[tot]);\n\t\ttot--;\n\t}\n\tql[tot+1]=qr[tot]+1,qr[tot+1]=x,qv[tot+1]=Av[x],tot++;\n\tadd(1,x,Bv[x]);\n}\nint main(){\n\tcin>>n>>S;\n\tB=sqrt(n*log2(n))/4+1;\n\tfor(int i=1;i<=n;++i)\n\t\tscanf(\"%lld\",&Av[i]);\n\tfor(int i=1;i<=n;++i)\n\t\tscanf(\"%lld\",&Bv[i]);\n\tfor(int i=1;i<=n;++i)\n\t\tb[i]=i;\n\tll ans=0;\n\tfor(int i=1;i<=n;++i){\n\t\tins(i);\n\t\tans+=qry(1,i);\n\t}\n\tcout<<ans;\n}\n```\n\n\u559c\u63d0\u6700\u52a3\u89e3\uff08\u4e0d\u8fc7\u597d\u50cf\u8fd8\u53ef\u4ee5\u5361\u5361\u7684\u8bf4",
        "postTime": 1681269430,
        "uid": 163337,
        "name": "Zpair",
        "ccfLevel": 7,
        "title": "[ABC282Ex] Min + Sum"
    },
    {
        "content": "### \u7b97\u6cd5\n#### (\u7b1b\u5361\u5c14\u6811\u3001\u542f\u53d1\u5f0f\u5206\u6cbb)  \n\n\u5bf9\u4e8e\u6574\u6570  $L$\uff0c$R$\uff0c\u8003\u8651\u7528\u5206\u6cbb\u6cd5\u6765\u89e3\u51b3\u533a\u95f4  $[L, R]$  \u4e0a\u7684\u95ee\u9898 (\u5373\u7edf\u8ba1\u533a\u95f4  $[L, R]$  \u4e2d\u6240\u5305 \u542b\u7684\u597d\u6570\u5bf9  ($l, r)$  \u7684\u4e2a\u6570  )  \u3002\u5177\u4f53\u800c\u8a00\uff0c\u6211\u4eec\u53ef\u4ee5\u53d6\u4e00\u4e2a\u6ee1\u8db3  $L \\leqslant M \\leqslant R$  \u7684\u6574\u6570  $M$  \uff0c \u53ea\u7edf\u8ba1\u90a3\u4e9b\u6ee1\u8db3  $l \\leqslant M \\leqslant r$  \u7684\u597d\u5bf9  $(l, r)$  \u7684\u4e2a\u6570\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u9012\u5f52\u5730\u6c42\u89e3\u533a\u95f4  $[L, M-1]$  \u548c\u533a\u95f4  $[M, R]$  \u4e0a\u7684\u95ee\u9898\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u7edf\u8ba1\u533a\u95f4  $[L, R]$  \u4e2d\u6ee1\u8db3  $l \\leqslant M \\leqslant r$  \u7684\u597d\u5bf9  $(l, r)$  \u7684\u4e2a\u6570\u5462?\n\n\u6211\u4eec\u53ef\u4ee5\u53d6  $M $ \u4f7f\u5f97  $A_{M}=\\min \\left(A_{L}, A_{L+1}, \\cdots, A_{R}\\right)$  \uff0c\u5e76\u7edf\u8ba1\u533a\u95f4  $[L, R]$  \u4e2d\u6ee1\u8db3  $l \\leqslant M \\leqslant r  \u7684\u597d\u5bf9  (l, r)$  \u7684\u4e2a\u6570\u3002\n\u6839\u636e  $M $ \u7684\u9009\u62e9\u6765\u770b\uff0c\u5bf9\u4e8e\u533a\u95f4\u4e2d\u6240\u6709\u6ee1\u8db3  $l \\leqslant M \\leqslant r$  \u7684\u6574\u6570\u5bf9  $(l, r)$  \u800c\u8a00\uff0c$\\min \\left(A_{l}, A_{l+1}, \\cdots, A_{r}\\right)$  \u6052\u7b49\u4e8e  $A_{M}$  \u3002\u6240\u4ee5\uff0c\u5f53\u56fa\u5b9a  $l$  \u6216  $r$  \u65f6\uff0c\u53e6\u4e00\u4e2a\u4f7f\u5f97  $(l, r)$  \u662f\u597d\u5bf9 \u7684\u53d8\u91cf\u503c\u57df\u53ef\u4ee5\u901a\u8fc7\u5bf9  $B$  \u4e0a\u7684\u533a\u95f4\u7d2f\u52a0\u548c\u4e8c\u5206\u627e\u5230\u3002\n\u6240\u4ee5\uff0c\u5982\u679c  $[L, M]$  \u7684\u957f\u5ea6\u66f4\u77ed\uff0c\u5219\u56fa\u5b9a  $l$  \u6765\u7edf\u8ba1\u597d\u5bf9\u7684\u4e2a\u6570\uff1b\u5982\u679c  $[M, R]$  \u957f\u5ea6\u66f4\u77ed\uff0c\u5219 \u56fa\u5b9a $ r$  \u6765\u7edf\u8ba1\u597d\u5bf9\u7684\u4e2a\u6570\u3002\n\n\u7136\u540e\u5728\u5e8f\u5217 $A$ \u4e0a\u5efa\u7b1b\u5361\u5c14\u6811\uff0c\u5de6\u952e\u8bb0\u5f55\u5f53\u524d\u70b9\u7684\u6700\u5de6\u8fb9\u5927\u4e8e\u5f53\u524d\u70b9\u6743\u503c\u7684\u4e0b\u6807\uff0c\u53f3\u952e\u8bb0\u5f55\u5f53\u524d\u70b9\u7684\u6700\u53f3\u8fb9\u5927\u4e8e\u5f53\u524d\u70b9\u7684\u6743\u503c\u7684\u4e0b\u6807\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O\\left(N \\log ^{2} N\\right) $\u3002\n\n### \u4ee3\u7801\n```\n#include <bits/stdc++.h>\n#define rep(i, n) for (int i = 0; i < (n); ++i)\n\nusing namespace std;\nusing ll = long long;\nusing P = pair<int, int>;\n\nint main() {\n    int n; ll s;\n    cin >> n >> s;\n\n    vector<ll> a(n), b(n), c(n+1);\n    rep(i, n) cin >> a[i];\n    rep(i, n) cin >> b[i];\n    rep(i, n) c[i+1] = c[i]+b[i];\n\n    a.push_back(-1);\n    vector<P> to(n+1, P(-1, -1));\n    {\n        stack<int> st;\n        rep(i, n+1) {\n            int l = -1;\n            while (st.size() and a[st.top()] > a[i]) {\n                int j = st.top(); st.pop();\n                to[j].second = l;\n                l = j;\n            } \n            to[i].first = l;\n            st.push(i);\n        }\n    }\n\n    ll ans = 0;\n    auto f = [&](auto f, int v, int l, int r) {\n        if (v == -1) return;\n        if (v-l < r-v) {\n            for (int i = l; i <= v; ++i) {\n                ans += upper_bound(c.begin()+v+1, c.begin()+r+1, s-a[v]+c[i]) - (c.begin()+v+1);\n            }\n        }\n        else {\n            for (int i = v+1; i <= r; ++i) {\n                ans += v+1-(lower_bound(c.begin()+l, c.begin()+v+1, -s+a[v]+c[i]) - c.begin());\n            }\n        }\n        f(f, to[v].first, l, v);\n        f(f, to[v].second, v+1, r);\n    };\n    f(f, to[n].first, 0, n);\n\n    cout << ans << '\\n';\n\n    return 0;\n}\n```",
        "postTime": 1672658113,
        "uid": 893703,
        "name": "yscQwQ_",
        "ccfLevel": 0,
        "title": "[ABC282Ex] Min + Sum \u9898\u89e3"
    },
    {
        "content": "\u770b\u5230\u9898\u76ee\u6709\u4e2a $\\min$ \u5c31\u5f88\u96be\u53d7\u554a\uff01\u600e\u4e48\u529e\u5462\uff1f\n\n\u5047\u8bbe\u6211\u4eec\u8981\u6c42\u89e3\u533a\u95f4 $[l,r]$ \u7684\u7b54\u6848\uff0c\u8003\u8651\u76f4\u63a5\u627e\u5230\u6700\u5c0f\u503c\u7684\u4f4d\u7f6e $k$\uff0c\u8fd9\u6837\u53ea\u8981\u94a6\u5b9a\u5de6\u7aef\u70b9 $\\in[l,k]$ \u4e14\u53f3\u7aef\u70b9 $\\in[k,r]$ \u5c31\u53ef\u4ee5\u4e0d\u7528\u7ba1\u6700\u5c0f\u503c\u7684\u9650\u5236\u4e86\u3002\u4e4b\u540e\u518d\u8ba1\u7b97\u4e24\u4e2a\u7aef\u70b9\u5728\u540c\u4e00\u4fa7\u7684\u60c5\u51b5\uff0c\u5373 $[l,k-1]$ \u4e0e $[k+1,r]$ \u7684\u7b54\u6848\uff0c\u7d2f\u52a0\u5373\u53ef\u3002\n\n\u5bf9 $b_i$ \u505a\u524d\u7f00\u548c\u5f97\u5230 $s_i=\\sum^i_jb_j$\uff0c\u518d\u679a\u4e3e\u4efb\u610f\u4e00\u4fa7\u7684\u7aef\u70b9\uff0c\u627e\u5230\u53e6\u4e00\u4fa7\u7684\u6700\u8fdc\u7aef\u70b9\uff0c\u4fbf\u53ef\u4ee5\u8ba1\u7b97\u5bf9\u5e94\u7684\u65b9\u6848\u6570\u3002\u5177\u4f53\u53ef\u4ee5\u7528\u4e8c\u5206\u5b9e\u73b0\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002\n\n\u7136\u800c\uff0c\u6700\u5c0f\u503c\u5e76\u6ca1\u6709\u50cf\u4e2d\u70b9\u90a3\u6837\u4f18\u79c0\u7684\u6027\u8d28\uff0c\u53ef\u4ee5\u4f7f\u5f97\u6bcf\u6b21\u533a\u95f4\u5927\u5c0f\u51cf\u534a\uff0c\u590d\u6742\u5ea6\u4ecd\u4e3a $O(n^2)$\u3002\u4f46\u662f\u522b\u5fd8\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5**\u4efb\u9009\u4e00\u8fb9**\u6c42\u89e3\u65b9\u6848\u6570\u3002\u90a3\u4e48\u6bcf\u6b21\u53ea\u8981\u5904\u7406\u8f83\u77ed\u7684\u533a\u95f4\uff0c\u6bcf\u6b21\u5904\u7406\u7684\u957f\u5ea6\u4ecd\u5728\u533a\u95f4\u957f\u5ea6\u7684\u4e00\u534a\u4ee5\u4e0b\uff0c\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u590d\u6742\u5ea6\u4e3a $O(n\\log^2 n)$\u3002\n\n# AC \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\n\nconst int MAXN = 2e5 + 10; \n\nint n; ll a[MAXN], b[MAXN], s;\n\nint f[MAXN][19], lg[MAXN];\n\ninline \nvoid init(int n) {\n\tfor (int i = 2; i <= n; i++) lg[i] = lg[i >> 1] + 1;\n\tfor (int i = 1; i <= n; i++) f[i][0] = i;\n\tfor (int j = 1; j <= lg[n]; j++) {\n\t\tfor (int i = 1; i + (1 << j) - 1 <= n; i++) {\n\t\t\tif (a[f[i][j - 1]] <= a[f[i + (1 << j - 1)][j - 1]]) f[i][j] = f[i][j - 1];\n\t\t\telse f[i][j] = f[i + (1 << j - 1)][j - 1];\n\t\t}\n\t}\n}\n\ninline \nint qmax(int l, int r) {\n\tint k = lg[r - l + 1];\n\treturn a[f[l][k]] <= a[f[r - (1 << k) + 1][k]] ? f[l][k] : f[r - (1 << k) + 1][k];\n}\n\n// b[x] <= s - a[mid] + b[i - 1]\n// b[i] + a[mid] - s <= b[x - 1]\n\ninline \nll solve(int l, int r) {\n\tif (l >= r) return l == r && a[l] + b[l] - b[l - 1] <= s;\n\tint mid = qmax(l, r), k; ll ans = 0;\n\tif (mid - l < r - mid) {\n\t\tfor (int i = l; i <= mid; i++) {\n\t\t\tk = upper_bound(b + mid, b + r + 1, s - a[mid] + b[i - 1]) - b - 1;\n\t\t\tans += k - mid + 1;\n\t\t}\n\t} else {\n\t\tfor (int i = mid; i <= r; i++) {\n\t\t\tk = lower_bound(b + l - 1, b + mid, b[i] + a[mid] - s) - b + 1;\n\t\t\tans += mid - k + 1;\n\t\t}\n\t}\n\treturn ans + solve(l, mid - 1) + solve(mid + 1, r);\n}\n\nint main() {\n\tscanf(\"%d%lld\", &n, &s);\n\tfor (int i = 2; i <= n; i++) lg[i] = lg[i >> 1] + 1;\n\tfor (int i = 1; i <= n; i++) scanf(\"%lld\", &a[i]); init(n);\n    for (int i = 1; i <= n; i++) scanf(\"%lld\", &b[i]), b[i] += b[i - 1];\n    printf(\"%lld\", solve(1, n));\n}\n```",
        "postTime": 1681995329,
        "uid": 406941,
        "name": "Register_int",
        "ccfLevel": 6,
        "title": "ABC282Ex \u9898\u89e3"
    }
]