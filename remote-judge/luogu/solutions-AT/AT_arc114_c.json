[
    {
        "content": "## \u9898\u610f\u7b80\u8ff0\n\n\u4e00\u4e2a\u957f\u5ea6\u4e3a $N$ \u7684\u5e8f\u5217 $A$\uff0c$\\forall i\\in [1,n], A_i\\in [1, M]$ \u3002\n\n\u5b9a\u4e49 $f(A)$ \u4e3a\uff1a\u5c06\u4e00\u4e2a\u521d\u59cb\u5168\u90e8\u4e3a $0$ \u7684\u5e8f\u5217 $X$ \u53d8\u4e3a $A$ \u7684\u6700\u5c11\u64cd\u4f5c\u6570\u3002\n\n\u4e00\u6b21\u64cd\u4f5c\u662f\u6307\uff1a\u9009\u62e9\u4e00\u4e2a\u533a\u95f4 $[l,r], 1\\le l\\le r\\le N$ \u548c\u4e00\u4e2a\u503c $v,v\\in [1,M]$ \uff0c\u7136\u540e\u7528 $\\max(X_i, v)$ \u66ff\u4ee3\u6bcf\u4e2a $X_i, i\\in [l,r]$ \u3002\n\n\u5bf9\u4e8e\u6240\u6709 $M^N$ \u79cd\u5e8f\u5217 $A$\uff0c\u6c42 $f(A)$ \u7684\u548c\u3002\n\n## \u601d\u8def\n\n\u7edf\u8ba1\u8d21\u732e\u3002\u8bbe $R(i,v)$ \u8868\u793a\u5728\u4f4d\u7f6e $i$\uff0c\u503c\u4e3a $v$ \u4e14\u8be5\u4f4d\u7f6e\u4e3a\u67d0\u4e2a\u64cd\u4f5c\u7684\u5de6\u7aef\u70b9\u6240\u4ea7\u751f\u7684\u8d21\u732e\u3002\n\n\u6b63\u96be\u5219\u53cd\uff0c\u8003\u8651\u8ba1\u7b97\u4e0d\u5408\u6cd5\u7684\u65b9\u6848\u6570\uff08\u5373 $i$ \u4e0d\u53ef\u80fd\u4e3a\u67d0\u4e2a\u64cd\u4f5c\u7684\u5de6\u7aef\u70b9\uff09\u3002\u53ef\u4ee5\u53d1\u73b0 $i$ \u4e0d\u5b58\u5728\u7684\u5145\u8981\u6761\u4ef6\u4e3a\uff1a\u5b58\u5728 $j\\le i, A_j=A_i$ \u4e14 $j\\sim i$ \u4e4b\u95f4\u6ca1\u6709\u6bd4 $v$ \u7684\u5c0f\u7684\u6570\u3002 \n\n$R(i,v)=M^{N-1}-\\sum\\limits_{1\\le j\\le i-1}{M^{N-i}M^{j-1}(M-v)^{i-j-1}}$\n\n\u5982\u4e0a\u7b49\u5f0f\u4e2d\uff0c\n\n$M^{N-1}$ \u662f\u53ef\u80fd\u7684\u5e8f\u5217\u603b\u6570\uff1b\n\n$M^{N-i}, M^{j-1}$ \u662f\u540e $N-i$\u3001\u524d $j-1$ \u4e2a\u6570\u7684\u503c\u4efb\u53d6\uff1b\n\n$(M-v)^{i-j-1}$ \u662f\u9650\u5236 $j\\sim i$ \u4e4b\u95f4\u7684\u6570\u5927\u4e8e\u7b49\u4e8e $v$ \u3002\n\n\u6bcf\u6b21\u4ece $R(i-1,v)$ \u9012\u63a8\u6c42 $R(i,v)$ \u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(NM)$\n\n```cpp\n#include <bits/stdc++.h>\nusing LL = long long;\nconst int Maxn = 5010, mod = 998244353;\nint n, m;\nLL powm[Maxn], R[Maxn][Maxn];\nint main()\n{\n    scanf(\"%d %d\", &n, &m);\n    powm[0] = 1;\n    for (int i = 1; i <= n; i++)\n        powm[i] = powm[i - 1] * m % mod;\n    for (int i = 2; i <= n; i++)\n        for (int j = 1; j <= m; j++)\n            R[i][j] = (R[i - 1][j] * (m - j) + powm[i - 2]) % mod;\n    LL ans = 0, sav = powm[n - 1];\n    for (int i = 1; i <= n; i++)\n        for (int j = 1; j <= m; j++)\n            ans = (ans + sav - R[i][j] * powm[n - i]) % mod;\n    printf(\"%lld\\n\", (ans % mod + mod) % mod);\n    return 0;\n}\n```",
        "postTime": 1667663717,
        "uid": 735756,
        "name": "mklzc",
        "ccfLevel": 0,
        "title": "ARC114_C"
    },
    {
        "content": "# \u7b80\u8ff0\u9898\u610f\n- \u7ed9\u4f60\u4e24\u4e2a\u957f\u4e3a $n$ \u7684\u53ef\u91cd\u6570\u5217\uff0c\u4e00\u4e2a\u53eb $A$\uff0c\u53e6\u4e00\u4e2a\u53eb $X$\uff0c$A$ \u4e2d\u7684\u5143\u7d20\u53d6\u503c\u8303\u56f4\u4e3a $1 \\sim m$\uff0c$X$\u4e2d\u7684\u5143\u7d20\u521d\u59cb\u503c\u90fd\u662f $0$\u3002\n- \u6bcf\u6b21\u4f60\u53ef\u4ee5\u9009\u62e9 $X$ \u4e2d\u7684 $[l, r]$ \u533a\u95f4\uff0c\u8ba9\u4ed6\u548c $v$ \u53d6 $max$\uff0c\u5c06\u8fd9\u6bb5\u533a\u95f4\u91cc\u7684\u6570\u90fd\u53d8\u6210\u8fd9\u4e2a\u6700\u5927\u503c\u3002\n- \u8bbe $X$ \u6700\u5c11\u7ecf\u8fc7 $f(A)$ \u6b21\u64cd\u4f5c\u53ef\u4ee5\u53d8\u6210 $A$\uff0c\u95ee\u5bf9\u4e8e\u6240\u6709\u7684 $m ^ n$ \u79cd $A$ \u7684 $f(A)$ \u4e4b\u548c\u3002\n\n# \u601d\u8def\n- \u5c06\u95ee\u9898\u8f6c\u5316\u6210\u7ed9 $A$ \u91cc\u586b\u6570\u3002\n- \u8003\u8651\u6bcf\u65b0\u6765\u4e00\u4e2a\u6570 $p$ \u5bf9\u6211 $f(A)$ \u7684\u5f71\u54cd\u3002\n\t- $p$ \u6ca1\u6709\u51fa\u73b0\u8fc7\uff0c\u90a3\u4e48\u6211\u7684 $f(A)$ \u5e94\u52a0\u4e00\u3002\n\t- $p$ \u51fa\u73b0\u8fc7\uff0c\u8bb0\u5f55\u4e4b\u524d\u51fa\u73b0\u7684\u4f4d\u7f6e\u4e3a $lst$\uff0c\u90a3\u4e48\u5982\u679c\u5bf9\u4e8e $\\forall k \\in [lst, i], val_k \\ge p$\uff0c\u663e\u7136\u6211\u53ef\u4ee5\u901a\u8fc7\u5bf9 $lst$ \u64cd\u4f5c\u6765\u8fbe\u5230\u8ba9\u8fd9\u91cc\u53d8\u6210 $p$ \u7684\u76ee\u7684(\u56e0\u4e3a\u4e2d\u95f4\u7684\u6570\u4e0d\u4f1a\u88ab\u5f71\u54cd\uff0c\u533a\u95f4\u53d6 $max$)\uff0c\u64cd\u4f5c\u6570\u4e0d\u7528\u52a0\uff0c\u53cd\u4e4b\u5219\u9700\u8981\u52a0\u4e00\u3002\n    \n# \u63a8\u5f0f\u5b50\n\n- \u8003\u8651\u5982\u4f55\u6c42\u51fa\u6bcf\u4e00\u4e2a $f(A)$\uff0c\u56e0\u4e3a\u6211\u4eec\u77e5\u9053\u4ec0\u4e48\u60c5\u51b5\u4e0b\u662f\u4e0d\u9700\u8981\u52a0\u4e00\u7684\uff0c\u6240\u4ee5\u76f4\u63a5\u7528\u603b\u60c5\u51b5\u6570\u51cf\u53bb\u4e0d\u9700\u8981\u52a0\u4e00\u7684\u60c5\u51b5\u5c31\u884c\u4e86\u3002\u8bb0 $g(i, x)$ \u8868\u793a\u5728 $i$ \u7684\u4f4d\u7f6e\u589e\u52a0\u4e00\u4e2a\u6570 $x$ \u7684\u64cd\u4f5c\u6570\u3002\n$$ g(i, x) = m ^ {i - 1} - \\sum\\limits_{k = 1}^{i - 1} (m - x) ^ {i - k - 1} \\cdot m ^ {k - 1}$$\n- \u5176\u4e2d $k$ \u679a\u4e3e\u7684\u662f\u4e0a\u4e00\u4e2a $x$ \u51fa\u73b0\u7684\u4f4d\u7f6e\uff0c$(m - x)$ \u8868\u793a\u6240\u6709\u6bd4 $x$ \u5927\u7684\u6570\uff0c\u4ed6\u4eec\u53ef\u4ee5\u5728 $[k + 1, i - 1]$ \u4efb\u610f\u5206\u5e03\uff0c\u5bf9\u4e8e\u5176\u4ed6\u7684 $k - 1$ \u4e2a\u4f4d\u7f6e\u968f\u4fbf\u653e\u5c31\u884c\u4e86\u3002\n\n- \u8fd9\u91cc\u6709\u4e00\u4e2a\u7ec6\u8282\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a $x$ \u8fd9\u4e2a\u5f0f\u5b50\u662f\u53ef\u4ee5\u9012\u63a8\u7684\uff0c\u9996\u5148\u5bf9\u4e8e $i$ \u6bcf\u589e\u5927 $1$ \u6211 $(m - x)$ \u7684\u6b21\u65b9\u5c31\u591a\u4e00\uff0c\u6240\u4ee5\u5e94\u8be5\u5148\u4e58\u4e0a $(m - x)$ \u5176\u6b21\u6211\u4eec\u53ef\u4ee5\u628a\u4e58 $m ^ {k - 1}$ \u5355\u72ec\u62ff\u51fa\u6765\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u589e\u5927\u7684 $i$ \u4e0a\u4e00\u4e2a\u548c\u5f0f\u548c\u73b0\u5728\u7684\u548c\u5f0f\u4e4b\u95f4\u53ea\u5dee\u4e00\u4e2a $m ^ {k - 1}$ (\u629b\u53bb\u6b21\u65b9\u7684\u53d8\u5316\u6765\u770b)\u3002\n\n- \u6700\u540e\u7edf\u8ba1\u7b54\u6848\u5c31\u53ea\u9700\u8981\uff1a\n$$ans_i = \\sum\\limits_{x = 1} ^ {m} ans_{i - 1} + g(i, x)$$\n\n# Code\n\n\n```cpp\n#include <bits/stdc++.h>\n#define Re register int\n#define LL long long\n#define fr(x, y, z) for(Re x = y; x <= z; x ++)\n#define fp(x, y, z) for(Re x = y; x >= z; x --)\n#define fuc(x, y) inline x y\n#define WMX aiaiaiai~~\nusing namespace std;\nnamespace kiritokazuto {\n\tfuc(char, getc)(){\n\t\tstatic char buf[1 << 18], *p1, *p2;\n\t\tif(p1 == p2){\n\t\t\tp1 = buf, p2 = buf + fread(buf, 1, 1 << 18, stdin);\n\t\t\tif(p1 == p2)return EOF;\n\t\t}\n\t\treturn *p1++;\n\t}\n\tfuc(LL, read)() {\n\t\tLL x = 0, f = 1;char c = getc();\n\t\twhile(!isdigit(c)){if(c == '-')f = -1; c = getc();}\n\t\twhile(isdigit(c)){x = (x << 1) + (x << 3) + (c ^ 48); c = getc();}\n\t\treturn x * f;\n\t}\n\ttemplate <typename T> fuc(void, write)(T x){\n\t\tif(x < 0)putchar('-'), x = -x;\n\t\tif(x > 9)write(x / 10);putchar(x % 10 | '0');\n\t}\n} \nusing namespace kiritokazuto;\nconst int maxn = 1e5 + 1000, Inf = 2147483647, Mod = 998244353, lim = 2e5 ;\nLL sum[5010];\nLL lst, ans;\nLL pows[5010];\nint n, m;\nsigned main() {\t\n\tn = read(), m = read();\n\tpows[0]  = 1;\n\tint lim = max(n, m);\n\tfr(i, 1, lim)pows[i] = pows[i - 1] * m % Mod, sum[i] = 1;\n\tlst = m;\n\tans = 0;\n\tfr(j, 1, m)ans = (ans + (lst + (pows[1] - sum[j] + Mod) % Mod) % Mod) % Mod;\n\tfr(i, 3, n) {\n\t\tlst = ans, ans = 0;\n\t\tfr(j, 1, m)sum[j] = (sum[j] * (m - j) % Mod + pows[i - 2]) % Mod;\n\t\tfr(j, 1, m)ans = (ans + (lst + (pows[i - 1] - sum[j] + Mod) % Mod) % Mod) % Mod;\n\t}\n\twrite(ans);\n\treturn 0;\n}\n\n```",
        "postTime": 1667706366,
        "uid": 277777,
        "name": "kiritokazuto",
        "ccfLevel": 0,
        "title": "ARC114C\u9898\u89e3"
    },
    {
        "content": "\u6211\u662f\u66b4\u529b\u8001\u54e5\uff0c\u4e0d\u4f1a\u9ad8\u5999\u7b80\u6d01\u63a8\u6cd5 /ll\n\n\u5148\u8003\u8651\u4e00\u4e0b\u6211\u4eec\u7684\u64cd\u4f5c\u8fc7\u7a0b\u5e94\u8be5\u957f\u4ec0\u4e48\u6837\u3002\n\n\u663e\u7136\u6211\u4eec\u4f1a\u6309 $v$ \u4ece\u5c0f\u5230\u5927\u64cd\u4f5c\uff0c\u8fd9\u6837\u4e00\u5b9a\u662f\u4e0d\u52a3\u7684\u3002\n\n\u8fdb\u4e00\u6b65\u7684\uff0c\u6211\u4eec\u5bf9\u4e8e $x$ \u7684\u76f8\u90bb\u51fa\u73b0\u4f4d\u7f6e\uff0c\u5373 $a_i=a_j=x(i<j)$ \u4e14 $\\forall k \\in [i+1,j-1] \\space a_k \\neq x$\uff0c\u5982\u679c $\\min\\{a_i,\\cdots,a_j\\}<x$\uff0c\u5219 $a_i,a_j$ \u5fc5\u987b\u5206\u4e24\u6b21\u64cd\u4f5c\u8d4b\u503c\uff0c\u5bf9\u7b54\u6848\u6709 $1$ \u7684\u8d21\u732e\u3002\n\n\u8bb0\u4e00\u4e2a\u5e8f\u5217\u6240\u6709\u76f8\u90bb\u51fa\u73b0\u4f4d\u7f6e\u7edf\u8ba1\u5f97\u5230\u7684\u8d21\u732e\u4e3a $cnt_A$\uff0c\u6240\u6709\u6570\u5b57\u7684\u79cd\u7c7b\u6570\u4e3a $cnt_B$\uff0c\u90a3\u4e48\u7b54\u6848\u5373\u4e3a $cnt_A+cnt_B$\u3002\n\n$cnt_B$ \u4e0d\u96be\u7b97\uff0c\u76f4\u63a5 dp\uff08\u8bbe $f_{i,j}$ \u8868\u793a\u5e8f\u5217\u957f\u5ea6\u4e3a $i$\uff0c\u6709 $j$ \u79cd\u4e0d\u540c\u6570\u5b57\u7684\u65b9\u6848\u6570\uff09 \u6216\u8005\u5bb9\u65a5\u90fd\u4e0d\u96be\u505a\u5230 $O(nm)$\u3002\u63a5\u4e0b\u6765\u8003\u8651\u8ba1\u6570 $cnt_A$\u3002\n\n\u7136\u540e\u6765\u8bbe\u8ba1\u4e00\u4e2a\u66b4\u529b\u8ba1\u6570\u7684\u65b9\u6cd5\uff1a\u679a\u4e3e\u5de6\u53f3\u7aef\u70b9 $L,R$ \u4ee5\u53ca\u503c $a_L=a_R=x$\uff0c\u6211\u9700\u8981\u5728\u4e2d\u95f4\u653e\u81f3\u5c11\u4e00\u4e2a $<x$ \u7684\u6570\u4ee5\u53ca\u82e5\u5e72 $>x$ \u7684\u6570\uff08\u6ce8\u610f\u4e0d\u80fd $=x$\uff0c\u56e0\u4e3a\u6211\u9700\u8981\u4fdd\u8bc1 $\\forall k \\in [L+1,R-1] \\space a_k \\neq x$\uff09\uff0c\u5176\u4ed6\u4f4d\u7f6e\u6211\u4eec\u5e76\u4e0d\u5173\u5fc3\u3002\u5bb9\u65a5\u5373\u53ef\u505a\u5230 $O(n^3m)$\uff0c\u63a8\u51fa\u6765\u5f0f\u5b50\u5373\uff1a\n\n$cnt_A=\\sum_{L=1}^n \\sum_{R=L+1}^n \\sum_{x=1}^m \\sum_{i=1}^{R-L-1} (-1)^{i-1} \\times {R-L-1 \\choose i} \\times (x-1)^i \\times (m-1)^{R-L-1-i} \\times m^{n-(R-L+1)}$\n\n\u5176\u4e2d $i$ \u4e3a\u94a6\u5b9a $<x$ \u7684\u6570\u4e2a\u6570\u3002\n\n\u8003\u8651\u4f18\u5316\u8fd9\u4e2a\u5f0f\u5b50\uff0c\u9996\u5148\u6211\u4eec\u53d1\u73b0\u679a\u4e3e $L,R$ \u7684\u5177\u4f53\u4f4d\u7f6e\u610f\u4e49\u662f\u4e0d\u5927\u7684\uff0c\u5728\u8ba1\u7b97\u540e\u9762\u7684\u5f0f\u5b50\u65f6\u6211\u4eec\u53ea\u5173\u5fc3 $R-L-1$ \u7684\u503c\u3002\u8fd9\u6837\u524d\u9762\u6539\u6210\u679a\u4e3e $len=R-L-1$\uff0c\u7b97\u51fa\u6765\u7684\u8d21\u732e\u518d\u4e58\u4e0a $n-len-1$\uff08\u5373\u5bf9\u5e94\u5de6\u7aef\u70b9 $L$ \u7684\u53d6\u503c\u4e2a\u6570\uff09\uff0c\u8fd9\u6837\u5c31\u662f $O(n^2m)$ \u7684\u4e86\u3002\n\n$\\sum_{len=1}^{n-2} \\sum_{i=1}^{len} \\sum_{x=1}^m (-1)^{i-1} \\times {len \\choose i} \\times (x-1)^i \\times (m-1)^{len-i} \\times m^{n-len-2}$\n\n\u7136\u540e\u6211\u4eec\u53c8\u53d1\u73b0\u5f0f\u5b50\u91cc\u4e0e $x$ \u552f\u4e00\u76f8\u5173\u7684\u9879\u5373\u4e3a $(x-1)^i$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u76f8\u540c\u7684 $i$ \u8fd9\u4e2a\u5f0f\u5b50\u7684\u603b\u7cfb\u6570\u5c31\u662f $\\sum_{x=1}^{m-1} x^i$\uff0c\u9884\u5904\u7406\u4e00\u4e0b\u5373\u53ef\u53bb\u6389\u679a\u4e3e $x$ \u7684\u8fc7\u7a0b\uff0c\u603b\u590d\u6742\u5ea6\u964d\u81f3 $O(nm+n^2)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u672c\u9898\u3002\n\n\u6211\u5077\u61d2\u76f4\u63a5\u7528\u4e86\u5feb\u901f\u5e42\u8ba1\u7b97\uff0c\u590d\u6742\u5ea6\u4e3a $O(n^2 \\log n)$\uff0c1995ms \u6781\u9650\u901a\u8fc7\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=5005;\nconst int mod=998244353;\ninline int read(){\n\tint x=0,f=1; char c=getchar();\n\twhile(c<'0'||c>'9'){ if(c=='-') f=-1; c=getchar(); }\n\twhile(c>='0'&&c<='9') x=x*10+c-'0',c=getchar();\n\treturn x*f;\n}\nint n,m,f[N][N],fac[N],ifac[N],sumpw[N],ans;\ninline int qpow(int x,int y){\n\tint r=1;\n\twhile(y){\n\t\tif(y&1) r=1ll*r*x%mod;\n\t\tx=1ll*x*x%mod;\n\t\ty>>=1;\n\t}\n\treturn r;\n}\ninline int C(int n,int m){\n\tif(n<m || n<0) return 0;\n\treturn 1ll*fac[n]*ifac[m]%mod*ifac[n-m]%mod;\n}\ninline void Init(int n){\n\tfac[0]=1;\n\tfor(int i=1;i<=n;i++) fac[i]=1ll*fac[i-1]*i%mod;\n\tifac[n]=qpow(fac[n],mod-2);\n\tfor(int i=n-1;~i;i--) ifac[i]=1ll*ifac[i+1]*(i+1)%mod;\n}\nint main(){\n\tn=read(),m=read(); Init(max(n,m)); f[0][0]=1;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int j=1;j<=min(i,m);j++)\n\t\t\tf[i][j]=(1ll*f[i-1][j]*j+f[i-1][j-1])%mod;\n\tfor(int i=1;i<=min(n,m);i++) (ans+=1ll*C(m,i)%mod*fac[i]%mod*f[n][i]%mod*i%mod)%=mod;\n\tfor(int i=1;i<=n;i++)\n\t\tfor(int val=2;val<=m;val++)\n\t\t\t(sumpw[i]+=qpow(val-1,i))%=mod;\n\tfor(int len=1;len<=n-2;len++){\n\t\tint ff=0;\n\t\tfor(int i=1;i<=len;i++){\n\t\t\tint rr=1ll*C(len,i)*sumpw[i]%mod*qpow(m-1,len-i)%mod*qpow(m,n-2-len)%mod;\n\t\t\tif(i&1) (ff+=rr)%=mod;\n\t\t\telse (ff+=mod-rr)%=mod;\n\t\t}\n\t\t(ans+=1ll*(n-len-1)*ff%mod)%=mod;\n\t}\n\tprintf(\"%d\\n\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1676504590,
        "uid": 236862,
        "name": "DitaMirika",
        "ccfLevel": 7,
        "title": "ARC114C"
    }
]