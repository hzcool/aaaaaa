[
    {
        "content": "\u672c\u9898\u540c\u6b65\u6536\u5f55\u5728 [Atcoder \u9898\u76ee\u8865\u5168\u8ba1\u5212](https://www.luogu.com.cn/training/256520) \u4e2d\uff0c\u6b22\u8fce\u652f\u6301\u3002\n\n### \u9898\u76ee\u5206\u6790\uff1a\n\n\u663e\u7136\u8981\u4ece $m \\le n+10$ \u8fd9\u4e2a\u6027\u8d28\u4e0b\u624b\uff0c\u6211\u4eec\u5c06\u539f\u56fe\u7684\u8fb9\u5212\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u4e00\u90e8\u5206\u5728\u539f\u56fe\u7684\u4e00\u9897\u751f\u6210\u6811\u4e0a\uff0c\u53e6\u4e00\u90e8\u5206\u5c31\u662f\u975e\u6811\u8fb9\u3002\u539f\u56fe\u4e24\u70b9\u4e4b\u95f4\u7684\u6700\u77ed\u8def\u53ef\u4ee5\u5206\u7c7b\u8ba8\u8bba\u6210\u4e0d\u7ecf\u8fc7\u975e\u6811\u8fb9\u548c\u7ecf\u8fc7\u975e\u6811\u8fb9\u3002\n\n\u5bf9\u4e8e\u539f\u56fe\u7684\u751f\u6210\u6811\u6765\u8bf4\uff0c\u4efb\u610f\u4e24\u70b9\u4e4b\u95f4\u7684\u6700\u77ed\u8def\u5f84\u53ea\u6709\u4e00\u6761\uff0c\u53ef\u4ee5 `dep[u]+dep[v]-2*dep[lca(u,v)]` \u8fd9\u6837 $O(\\log n)$ \u7684\u5feb\u901f\u6c42\u51fa\uff1b\u5bf9\u4e8e\u975e\u6811\u8fb9\uff0c\u8fb9\u6570\u4e0d\u4f1a\u8d85\u8fc7 $11$ \u6761\uff0c\u8fb9\u8fde\u63a5\u7684\u70b9\u7684\u4e2a\u6570\u4e0d\u4f1a\u8d85\u8fc7 $22$ \u4e2a\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u6bcf\u4e2a\u88ab\u975e\u6811\u8fb9\u8fde\u63a5\u7684\u70b9 $O(n)$ \u7684 bfs \u9884\u5904\u7406\uff0c\u8868\u793a\u7ecf\u8fc7\u8fd9\u4e2a\u70b9\uff0c\u4e24\u70b9\u95f4\u7684\u6700\u77ed\u8ddd\u79bb\u662f\u591a\u5c11\uff0c\u53ef\u4ee5 $O(1)$ \u7684\u67e5\u8be2\uff0c\u8868\u793a\u51fa\u6765\u5c31\u662f `d[i][u]+d[i][v]`\u3002\n\n\u7b54\u6848\u5c31\u662f\u5bf9\u4e0a\u8ff0\u6240\u6709\u8ba8\u8bba\u53d6 $\\min$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6\uff1a$O(n(m-n+1)+ q \\log n)$\u3002\n\n\u8bf4\u4e00\u4e2a\u4e0d\u662f\u5f88\u91cd\u8981\u4f46\u662f\u5f88\u5751\u7684\u4e1c\u897f\uff0c\u4e09\u76ee\u8fd0\u7b97\u7b26\u95ee\u53f7\u540e\u9762\u4e24\u4e2a\u64cd\u4f5c\u7684\u8fd4\u56de\u503c\u7c7b\u578b\u8981\u6c42\u76f8\u540c\uff0c`emplace_back` \u7b49\u64cd\u4f5c\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u5982\u679c\u524d\u540e\u4e24\u4e2a\u64cd\u4f5c\u7684\u8fd4\u56de\u7c7b\u578b\u4e0d\u540c\uff0c\u672c\u5730\u7f16\u8bd1\u662f\u6ca1\u6709\u95ee\u9898\u7684\uff0c\u4f46\u4ea4\u4e0a\u53bb\u4f1a CE\uff0c\u53ef\u4ee5\u989d\u5916\u52a0\u4e2a `void()` \u4fdd\u8bc1\u524d\u540e\u76f8\u540c\u3002\n\n### Code.\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e5+50;\nvector<int> G[N],kl; bitset<N> st;\nint n,m,h[N],ne[N<<1],e[N<<1],top[N],sz[N],son[N],fa[N],dep[N],idx,d[30][N],f[N],Q,mn;\nint find(int x) {if(f[x] != x) f[x]=find(f[x]); return f[x];}\nvoid add(int u,int v) {ne[++idx]=h[u],e[idx]=v,h[u]=idx;}\nvoid dfs(int u,int father,int depth)\n{\n\tdep[u]=depth; fa[u]=father; sz[u]=1;\n\tfor(int i=h[u];~i;i=ne[i])\n\t{\n\t\tint j=e[i]; if(j == father) continue ;\n\t\tdfs(j,u,depth+1); sz[u]+=sz[j];\n\t\tif(sz[son[u]] < sz[j]) son[u]=j;\n\t}\n}\nvoid dfs2(int u,int t)\n{\n\ttop[u]=t; if(! son[u]) return ; dfs2(son[u],t);\n\tfor(int i=h[u];~i;i=ne[i])\n\t{\n\t\tint j=e[i]; if(j == fa[u] || j == son[u]) continue ;\n\t\tdfs2(j,j);\n\t}\n}\nint lca(int u,int v)\n{\n\twhile(top[u] != top[v])\n\t{\n\t\tif(dep[top[u]] < dep[top[v]]) swap(u,v);\n\t\tu=fa[top[u]];\n\t}\n\treturn dep[u] < dep[v] ? u : v;\n}\ninline void bfs(int id)\n{\n\tst.reset(); queue<int> q; q.emplace(kl[id]);\n\twhile(! q.empty())\n\t{\n\t\tint u=q.front(); q.pop(); if(st[u]) continue ; st[u]=1;\n\t\tfor(int j : G[u])\n\t\t\tif(! d[id][j] && j != kl[id]) d[id][j]=d[id][u]+1,q.emplace(j);\n\t}\n}\nint main()\n{\n\tmemset(h,-1,sizeof h); scanf(\"%d%d\",&n,&m); iota(f+1,f+1+n,1);\n\tfor(int i=1,u,v;i<=m;i++) \n\t{\n\t\tscanf(\"%d%d\",&u,&v); G[u].emplace_back(v); G[v].emplace_back(u);\n\t\tint pu=find(u),pv=find(v);\n\t\t(pu != pv) ? (f[pu]=pv,add(u,v),add(v,u)) : (kl.emplace_back(u),kl.emplace_back(v),void());\n\t}\n\tdfs(1,0,1); dfs2(1,1);\n\tfor(int i=0;i<(int)kl.size();i++) bfs(i);\n\tscanf(\"%d\",&Q);\n\twhile(Q -- )\n\t{\n\t\tint u,v; scanf(\"%d%d\",&u,&v); mn=dep[u]+dep[v]-2*dep[lca(u,v)];\n\t\tfor(int i=0;i<(int)kl.size();i++) mn=min(mn,d[i][u]+d[i][v]);\n\t\tprintf(\"%d\\n\",mn);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1669952970,
        "uid": 897035,
        "name": "Shiina_Mahiru",
        "ccfLevel": 0,
        "title": "[6th PAST O] Shortest Distance Query \u9898\u89e3"
    }
]