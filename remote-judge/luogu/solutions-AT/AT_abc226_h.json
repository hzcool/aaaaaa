[
    {
        "content": "\u63d0\u4f9b\u4e00\u4e2a\u7b80\u5355\u7684 $O(N^3)$ \u505a\u6cd5\uff0c\u5bf9\u5176\u7a0d\u52a0\u4f18\u5316\u53ef\u4ee5\u5f97\u5230 $O(N^2\\log^2N)$ \u7684\u7b97\u6cd5\u3002\n\n\u7531\u4e8e\n$$\n\\mathbb E[X]=\\int_0^{\\infty}\\text{Pr}[X=i]\\times i\\text{ d}i=\\int_0^{\\infty}\\text{Pr}[X>i]\\text{ d}i\n$$\n\u8003\u8651\u4f7f\u7528 minmax \u5bb9\u65a5\uff0c\u6709\n$$\n\\begin{aligned}\n\\mathbb E[\\max\\nolimits_K\\{X_i|i=1,2,\\cdots,N\\}]&=\\sum_{T}\\binom{|T|-1}{|T|-K}(-1)^{|T|+K}\\mathbb E\\left[\\min\\nolimits_{i\\in T}X_i\\right]\\\\&=\\sum_{T}\\binom{|T|-1}{|T|-K}(-1)^{|T|+K}\\int_{0}^{100}\\text{Pr}[\\min\\nolimits_{i\\in T}X_i> v]\\text{ d}v\\\\\n&=\\int_{0}^{100}\\sum_{T}\\binom{|T|-1}{|T|-K}(-1)^{|T|+K}\\prod_{i\\in T}\\dfrac{R_i-v}{R_i-L_i}\\text{ d}v\n\\end{aligned}\n$$\n\u6211\u4eec\u53ef\u4ee5\u7b97\u51fa\n$$\nf(v)=\\sum_{T}\\binom{|T|-1}{|T|-K}(-1)^{|T|+K}\\prod_{i\\in T}\\text{Pr}[X_i>v]\n$$\n\u8003\u8651 $\\text{Pr}[X_i>v]$\uff0c\u53d1\u73b0\u4ed6\u662f\u4e00\u4e2a\u5206\u6bb5\u51fd\u6570\uff1a\n$$\n\\text{Pr}[X_i>v]=\\begin{cases}0&,v\\ge R_i\\\\\\dfrac{R_i-v}{R_i-L_i}&,L_i\\le v<R_i\\\\1&,v<L_i\\end{cases}\n$$\n\u56e0\u6b64\uff0c\u6700\u7ec8\u7684 $f(v)$ \u5c06\u662f\u4e00\u4e2a\u4e0d\u8d85\u8fc7 $2N$ \u6bb5\u7684\u5206\u6bb5\u51fd\u6570\uff0c\u5bf9\u6bcf\u6bb5\u5206\u522b\u8ba1\u7b97\u5e76\u79ef\u5206\u5373\u53ef\u3002\n\n\u5177\u4f53\u6765\u8bf4\uff0c$f(v)$ \u7684\u6bcf\u4e00\u6bb5\u90fd\u53ef\u4ee5\u8868\u8ff0\u4e3a\n$$\n\\begin{aligned}\n&\\int_{a}^b\\sum_{i=K}^N\\binom{i-1}{i-K}(-1)^{i+K}[x^i]\\prod_{i=1}^N\\left(1+(k_iv+b_i)x\\right)\\text{ d}v\\\\\n=&\\int_a^b\\sum_{i=K}^N\\binom{i-1}{i-K}(-1)^{i+K}g_i(v)\\text{ d}v\\\\\n=&\\sum_{i=K}^N\\binom{i-1}{i-K}(-1)^{i+K}\\int_{a}^bg_i(v)\\text{ d}v\n\\end{aligned}\n$$\n\u5176\u4e2d\uff0c$g_i(v)=[x^i]\\prod_{i=1}^N(1+(k_iv+b_i)x)$\uff0c\u8fd9\u662f\u4e00\u4e2a\u4e0d\u8d85\u8fc7 $i$ \u6b21\u7684\u591a\u9879\u5f0f\u3002\n\n\u5982\u679c\u6bcf\u6b21\u6734\u7d20\u8ba1\u7b97 $g_{0\\cdots N}$\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $O(N^4)$\u3002\n\n\u8003\u8651\u5230\u6bcf\u6b21\u79fb\u52a8\u4e00\u6b21\u533a\u95f4\uff0c\u53ea\u6709 $O(1)$ \u4e2a $k_iv+b_i$ \u4f1a\u53d1\u751f\u6539\u53d8\uff0c\u56e0\u6b64\u6211\u4eec\u53ea\u9700\u8981\u505a\u4e00\u6b21\u80cc\u5305\u5220\u9664\u548c\u80cc\u5305\u63d2\u5165\u3002\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u662f $O(N^3)$ \u4e86\u3002\n\n<https://atcoder.jp/contests/abc226/submissions/41340096>",
        "postTime": 1683967145,
        "uid": 307453,
        "name": "\u4e91\u6d45\u77e5\u5904",
        "ccfLevel": 6,
        "title": "Random Kth Max"
    },
    {
        "content": "vp \u60f3\u5230\u7684\u505a\u6cd5,\u8c8c\u4f3c\u548c\u9898\u89e3\u4e0d\u4e00\u6837\uff1f\u8d5b\u540e 3min \u8fc7/kk\uff0c\u539f\u56e0\u7adf\u662f\u56e0\u4e3adp\u4e0b\u6807\u5199\u53cd\u3002\n\n\u770b\u5230\u7b2c $k$ \u5927\u671f\u671b\uff0c\u679c\u65ad\u4e0a $\\text{min-max}$ \u5bb9\u65a5\uff0c\u5373\uff1a\n\n$E(\\text{kmax}_{i \\in S}\\{a_i \\})=\\sum\\limits_{T \\subseteq S,T \\not= \\varnothing}(-1)^{|T|-1} C_{|T|-1}^{k-1} E(\\min\\limits_{i \\in T}\\{a_i \\})$\n\n\u8003\u8651\u63a8\u4e16\u5b50\uff0c\u600e\u4e48\u5c55\u5f00\u540e\u9762\u7684  $E(\\min\\limits_{i \\in T}\\{a_i \\})$\u3002\n\n$$E(\\min\\limits_{i \\in T}\\{a_i \\})=\\int_{0}^{+\\infty} P(\\min\\limits_{i \\in T}\\{a_i \\}>x) dx$$\n\n\u8fd9\u4e2a $P(X>x)$ \u8003\u8651\u7528\u6734\u7d20\u7684\u4e16\u5b50\u8868\u793a\u51fa\u6765\uff1a\n\n$$P(\\min\\limits_{i \\in T}\\{a_i \\}>x) = \\prod\\limits_{i \\in T} [r_i > x] \\left( \\dfrac{r_i-x}{r_i-l_i} \\right)^{[l_i>x]}$$\n\n$$\\therefore E(\\min\\limits_{i \\in T}\\{a_i \\})=\\int_{0}^{+\\infty} \\prod\\limits_{i \\in T} [r_i > x] \\left( \\dfrac{r_i-x}{r_i-l_i} \\right)^{[l_i>x]} dx$$\n\n$$\\therefore E(\\min\\limits_{i \\in T}\\{a_i \\})=\\sum\\limits_{x=0}^{+\\infty}\\int_{x}^{x+1} \\prod\\limits_{i \\in T} [r_i > y] \\left( \\dfrac{r_i-y}{r_i-l_i} \\right)^{[l_i>y]} dy$$\n\n\u7531\u4e8e $l_i,r_i$ \u90fd\u662f\u6574\u6570\uff1a\n\n$$\\therefore E(\\min\\limits_{i \\in T}\\{a_i \\})=\\sum\\limits_{x=0}^{+\\infty}\\int_{x}^{x+1} \\prod\\limits_{i \\in T,l_i \\leq x} \\left([r_i > x] \\dfrac{r_i-y}{r_i-l_i}\\right) dy$$\n\n\u4e0d\u96be\u53d1\u73b0\u540e\u9762\u662f\u5173\u4e8e $y$ \u7684\u591a\u9879\u5f0f\uff0c\u7531\u4e8e\u6211\u4eec\u6700\u5f00\u59cb\u679a\u4e3e\u4e86 $T$\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5206\u5f00\u7b97\u8d21\u732e\uff0c\u5206\u4e3a $l_i \\leq x$ \u548c $l_i>x$ \u4e24\u90e8\u5206\u3002\n\n\u8003\u8651\u6240\u6709 $l_i \\leq x$ \u7684\u8d21\u732e\uff0c\u8bbe\u6709\u603b\u5171\u6709 $S$ \u8fd9\u6837\u7684\u6570\uff0c\u5148\u679a\u4e3e\u4e00\u4e2a $s$ \u8868\u793a\u9009\u62e9\u4e86  $s$ \u4e2a $l_i \\leq x$ \u4e2d\u7684\u6570\u5728 $T$ \u4e2d\u3002\n\n\u7136\u540e\u4e0d\u96be\u53d1\u73b0\u6211\u9009\u62e9\u7684\u6570\u662f\u4ec0\u4e48\u65e0\u5173\u7d27\u8981\uff0c\u4e8e\u662f\u53ef\u4ee5\u7b97\u51fa\u6240\u6709\u60c5\u51b5\u7684\u603b\u548c\u3002\n\n\u5c06\u603b\u548c\u62c6\u6210\u591a\u9879\u5f0f\u5f62\u5f0f\uff0c\u8bbe\u4e3a $f_s(x)$\u3002\n\n\u6709\uff1a\n\n$$E(\\min\\limits_{i \\in T}\\{a_i \\})=\\sum\\limits_{x=0}^{+\\infty} \\sum\\limits_{s=0}^{S} \\left (\\int f_s(x+1)-\\int f_s(x) \\right)$$\n\n\u90a3\u4e48\u7b54\u6848\u5c31\u662f\uff1a\n\n$$\\sum\\limits_{x=0}^{+\\infty} \\sum\\limits_{s=0}^{S} \\left (\\int f_s(x+1)-\\int f_s(x) \\right) \\sum_{i=0}^{n-S} C_{n-S}^{i} (-1)^{i+s-1} C_{i+s-1}^{k-1}$$\n\n\u590d\u6742\u5ea6 $O(n^3 V)$\u3002\n\n```cpp\nint f[N][N],g[N][N],h[N][N],n,k,l[N],r[N],a[N],b[N],fac[N],ifac[N],ans;\ninline int C(int n,int m){\n\treturn (n<0||m<0||n<m)?0:fac[n]*ifac[m]%mod*ifac[n-m]%mod;\n}\ninline int iep(int x){return (x&1)?mod-1:1;}\nsigned main(){\n\tfac[0]=1;for(int i=1;i<N;i++) fac[i]=fac[i-1]*i%mod;\n\tifac[N-1]=qpow(fac[N-1],mod-2);for(int i=N-1;i;i--) ifac[i-1]=i*ifac[i]%mod;\n\tn=read();k=read();\n\tfor(int i=1;i<=n;i++) l[i]=read(),r[i]=read();\n\tfor(int i=1;i<=n;i++){\n\t\ta[i]=r[i]*qpow(r[i]-l[i],mod-2)%mod;\n\t\tb[i]=mod-qpow(r[i]-l[i],mod-2);\n\t}\n\tfor(int x=0;x<=100;x++){\n\t\tint S=0;\n\t\tfor(int i=1;i<=n;i++) S+=(l[i]<=x);\n\t\tfor(int i=0;i<=S;i++) for(int j=0;j<=S;j++) f[i][j]=g[i][j]=0;f[0][0]=1;g[0][0]=1;\n\t\tfor(int i=1;i<=n;i++){\n\t\t\tif(l[i]>x) continue;\n\t\t\tif(r[i]<=x) continue;\n\t\t\tfor(int j=S;j;j--){\n\t\t\t\tfor(int p=j;p;p--){\n\t\t\t\t\tf[p][j]+=(f[p-1][j-1]*b[i]+f[p][j-1]*(a[i]+b[i]))%mod;\n\t\t\t\t\tg[p][j]+=(g[p-1][j-1]*b[i]+g[p][j-1]*a[i])%mod;\n\t\t\t\t\tf[p][j]%=mod;g[p][j]%=mod;\n\t\t\t\t}\n\t\t\t\tf[0][j]+=f[0][j-1]*(a[i]+b[i])%mod;g[0][j]+=g[0][j-1]*a[i]%mod;\n\t\t\t\tf[0][j]%=mod;g[0][j]%=mod;\n\t\t\t}\n\t\t}\n\t\tfor(int j=S;j>=0;j--) for(int i=0;i<=j;i++) h[j][i]=(f[i][j]-g[i][j]+mod)%mod;\n\t\tfor(int s=0;s<=S;s++){\n\t\t\tint res=0;\n\t\t\tfor(int i=0;i<=s;i++)\n\t\t\t\tres=(res+(qpow(x+1,i+1)-qpow(x,i+1)+mod)%mod*f[s][i]%mod*qpow(i+1,mod-2)%mod);\n\t\t\tfor(int i=0;i<=n-S;i++){\n\t\t\t\tint rs=C(n-S,i)*iep(i+s-k)%mod*C(i+s-1,k-1)%mod;\n\t\t\t\tans=(ans+res*rs%mod)%mod;\n\t\t\t}\n\t\t}\n\t} \n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n```\n\n\n\n",
        "postTime": 1683081800,
        "uid": 436389,
        "name": "Vidoliga",
        "ccfLevel": 6,
        "title": "[ABC226H] Random Kth Max \u9898\u89e3"
    },
    {
        "content": "\u6ca1\u6709\u9898\u89e3\uff0c\u6765\u8d21\u732e\u4e00\u7bc7\u3002\n\n\u8003\u8651\u4e00\u4e2a\u5f31\u5316\u7248\uff1a$l_i=0,r_i=1$\u3002\u90a3\u4e48\u7b54\u6848\u5c31\u662f $1-\\dfrac k{n+1}$\u3002\u770b\u5230\u7f51\u4e0a\u6709\u9898\u89e3\u662f\u7ec4\u5408\u610f\u4e49\u8bc1\u660e\uff1a\u7b54\u6848\u76f8\u5f53\u4e8e\u65b0\u63d2\u5165\u4e00\u4e2a\u6570 $n+1$ \u7684\u6392\u540d $\\le k$ \u7684\u6982\u7387\uff0c\u5373 $\\dfrac{kn!}{(n+1)!}=\\dfrac k{n+1}$\u3002\u7136\u800c\u6211\u4e0d\u4f1a\u7ec4\u5408\u610f\u4e49\uff0c\u6240\u4ee5\u6765\u70b9\u4ee3\u6570\u7684\u4e1c\u897f\u3002\n\n\u8bbe $k$ \u5927\u503c\u7684\u7d2f\u79ef\u5206\u5e03\u51fd\u6570 $F(x)=P(X\\le x)$\u3002\u90a3\u4e48\u6211\u4eec\u6709\u7ed3\u8bba\n$$E(X)=b-\\int_0^1F(x)\\text dx=a+\\int_0^1(1-F(x))\\text dx$$\n\u5206\u522b\u8003\u8651\u6bcf\u4e2a\u968f\u673a\u53d8\u91cf $X_i$ \u5bf9\u7d2f\u79ef\u5206\u5e03\u51fd\u6570\u7684\u8d21\u732e\u3002\u6bcf\u4e2a\u968f\u673a\u53d8\u91cf $\\le x$ \u7684\u6982\u7387\u662f $x$\uff0c$>x$ \u7684\u6982\u7387\u662f $1-x$\u3002\u90a3\u4e48 $k$ \u5927\u503c $\\le x$ \u5c31\u76f8\u5f53\u4e8e\u4e0d\u8db3 $k$ \u4e2a\u6570\u5927\u4e8e $x$\u3002\u679a\u4e3e\u51e0\u4e2a\u6570\u5927\u4e8e $x$\uff0c\u6709\uff1a\n$$F(x)=\\sum_{i=0}^{k-1}\\binom ni(1-x)^ix^{n-i}$$\n\u4ee3\u5165\u539f\u5f0f\uff1a\n$$\n\\begin{aligned}\nE(X)=&1-\\int_0^1\\sum_{i=0}^{k-1}\\binom ni(1-x)^ix^{n-i}\\text dx\\\\\n=&1-\\sum_{i=0}^{k-1}\\binom ni\\int_0^1(1-x)^ix^{n-i}\\text dx\\\\\n=&1-\\sum_{i=0}^{k-1}\\binom ni\\frac{i!(n-i)!}{(n+1)!}\\\\\n=&1-\\frac k{n+1}\n\\end{aligned}\n$$\n\u5176\u4e2d\u7b2c\u4e09\u6b65\u4f7f\u7528\u4e86 Beta \u79ef\u5206\n$$\\int_0^1x^a(1-x)^b=\\frac{a!b!}{(a+b+1)!}$$\n\u56de\u5230\u672c\u9898\u3002\n\n\u8003\u8651\u4e00\u4e2a dp\u3002\u6211\u4eec\u679a\u4e3e\u6700\u7ec8\u7684\u7b54\u6848\u5728\u67d0\u4e2a\u6bb5 $[a-1,a]$ \u4e2d\u3002\u90a3\u4e48\u4e3a\u4e86\u786e\u5b9a\u8fd9\u4e00\u6bb5\u7684\u7b54\u6848\uff0c\u6211\u4eec\u8bbe\u8ba1 dp\uff1a$dp_{i,j,k}$ \u4e3a\u8003\u8651\u524d $i$ \u4e2a\u968f\u673a\u53d8\u91cf\uff0c\u5927\u4e8e $a$ \u7684\u6709 $j$ \u4e2a\uff0c\u5728 $[a-1,a]$ \u4e2d\u7684\u6709 $k$ \u4e2a\u7684\u6982\u7387\u3002\u8f6c\u79fb\u5341\u5206\u663e\u7136\uff0c\u8003\u8651\u7b2c $i$ \u4e2a\u843d\u5728\u54ea\u4e00\u90e8\u5206\u5373\u53ef\u3002\u6700\u540e\u7edf\u8ba1\u7b54\u6848\u7684\u65f6\u5019\u5957\u7528\u4e0a\u8fb9\u7684\u516c\u5f0f\uff1a\u5bf9\u4e8e $dp_{n,i,j}$\uff0c\u5373 $j$ \u4e2a\u5728 $[a-1,a]$ \u4e2d\u7684\u6570\u7684 $k-i$ \u5927\u503c\u7684\u671f\u671b\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(n^4)$\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n```cpp\n#include <iostream>\n#include <algorithm>\n#include <cstdio>\n#include <cmath>\n#include <cstring>\nusing namespace std;\nconst int mod=998244353;\nint n,K,ans,l[60],r[60],dp[60][60][60],inv[110];\nvoid Dp(int a){\n    memset(dp,0,sizeof(dp));dp[0][0][0]=1;\n    for(int i=1;i<=n;i++){\n        for(int j=0;j<=i;j++){\n            for(int k=0;j+k<=i;k++){\n                if(j&&r[i]>=a)dp[i][j][k]=(dp[i][j][k]+1ll*dp[i-1][j-1][k]*(r[i]-max(a,l[i]))%mod*inv[r[i]-l[i]])%mod;\n                if(k&&l[i]<a&&r[i]>=a)dp[i][j][k]=(dp[i][j][k]+1ll*dp[i-1][j][k-1]*inv[r[i]-l[i]])%mod;\n                if(l[i]<a)dp[i][j][k]=(dp[i][j][k]+1ll*dp[i-1][j][k]*(min(r[i],a-1)-l[i])%mod*inv[r[i]-l[i]])%mod;\n            }\n        }\n    }\n    for(int j=0;j<K;j++){\n        for(int l=K-j;l<=n-j;l++){\n            ans=(ans+1ll*dp[n][j][l]*(a-1ll*(K-j)*inv[l+1]%mod+mod))%mod;\n        }\n    }\n}\nint main(){\n    scanf(\"%d%d\",&n,&K);int mx=0;\n    for(int i=1;i<=n;i++)scanf(\"%d%d\",&l[i],&r[i]),mx=max(mx,r[i]);\n    inv[1]=1;\n    for(int i=2;i<=100;i++)inv[i]=1ll*(mod-mod/i)*inv[mod%i]%mod;\n    for(int i=1;i<=mx;i++)Dp(i);\n    printf(\"%d\\n\",ans);\n    return 0;\n}\n```\nTips\uff1a\u6839\u636e\u5b98\u65b9\u9898\u89e3\uff0c\u672c\u9898\u6709 $O(n^3)$ \u4e0e $O(n^2\\log^2n)$ \u7684\u505a\u6cd5\u3002",
        "postTime": 1677408561,
        "uid": 663705,
        "name": "worldvanquisher",
        "ccfLevel": 0,
        "title": "ABC226H \u9898\u89e3"
    }
]