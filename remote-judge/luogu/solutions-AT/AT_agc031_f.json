[
    {
        "content": "- \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u5f20 $n$ \u4e2a\u70b9 $m$ \u6761\u8fb9\u7684\u65e0\u5411\u8fde\u901a\u56fe\uff0c\u6bcf\u6761\u8fb9\u5b58\u5728\u8fb9\u6743 $w_i$\u3002\n\n\u5b58\u5728 $q$ \u7ec4\u8be2\u95ee\uff0c\u6bcf\u7ec4\u8be2\u95ee\u7ed9\u5b9a $s, t, r$\uff0c\u8be2\u95ee\u56fe\u4e2d\u662f\u5426\u5b58\u5728\u4e00\u6761\u4ece $s$ \u5230 $t$ \u7684\u6743\u503c\u4e3a $r$ \u7684\u8def\u5f84\uff08\u53ef\u4ee5\u4e0d\u662f\u7b80\u5355\u8def\u5f84\uff0c\u5373\u70b9\u548c\u8fb9\u90fd\u53ef\u4ee5\u88ab\u7ecf\u8fc7\u4efb\u610f\u591a\u6b21\uff09\u3002\n\n\u8def\u5f84\u7684\u6743\u503c\u5b9a\u4e49\u4e3a\uff1a\u8bbe\u8def\u5f84\u4e0a\u4f9d\u6b21\u7ecf\u8fc7\u8fb9\u7684\u8fb9\u6743\u4e3a $w_0, w_1, w_2 \\cdots w_{k - 1}$\uff0c\u90a3\u4e48\u8be5\u8def\u5f84\u7684\u6743\u503c\u4e3a $\\displaystyle (\\sum_{i = 0}^{k - 1} w_i \\cdot 2^i) \\bmod p$\u3002$p$ \u7ed9\u5b9a\u3002\n\n$\\mathcal{Data~Range}$\uff1a$1 \\le n, m, q \\le 5 \\times 10^4, 1 \\le p \\le 10^6, p \\equiv 1 \\pmod{2}$\u3002\n\n------\n\n- \u9898\u89e3\n\n\u9996\u5148\u8003\u8651\u5982\u4e0b\u95ee\u9898\uff1a\u7ed9\u5b9a\u4e00\u6761\u8def\u5f84 $s \\to t$\uff0c\u8981\u6c42\u8ba1\u7b97\u8def\u5f84\u7684\u6743\u503c\u3002\n\n\u8fd9\u4e2a\u95ee\u9898\u6734\u7d20\u7684\u7b97\u6cd5\u662f\u4ece $s$ \u5f00\u59cb\u6cbf\u7740\u8def\u5f84\u4e00\u76f4\u8d70\uff0c\u8fd9\u6837\u6211\u4eec\u4e0d\u5f97\u4e0d\u65f6\u523b\u7ef4\u62a4\u8d70\u8fc7\u8def\u5f84\u7684\u957f\u5ea6\uff0c\u8fd9\u5e76\u4e0d\u662f\u597d\u7684\u3002\n\n\u7531\u4e8e\u8def\u5f84\u662f\u53cc\u5411\u7684\uff0c\u6211\u4eec\u4e0d\u59a8\u4ece $t$ \u5f00\u59cb\u53cd\u7740\u8d70\uff0c\u8fd9\u6837\u6bcf\u8d70\u4e00\u6761\u8fb9 $w_i$\uff0c\u6743\u503c\u5c31\u4f1a\u7531 $x$ \u53d8\u4e3a $x \\cdot 2 + w_i$\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u4e0d\u9700\u8981\u7ef4\u62a4\u957f\u5ea6\u8fd9\u4e00\u7ef4\u4fe1\u606f\u4e86\uff0c\u8fd9\u662f\u6781\u597d\u7684\u3002\n\n------\n\n\u56de\u5230\u539f\u95ee\u9898\u3002\n\n\u6211\u4eec\u4e0d\u59a8\u8bbe\u4e00\u4e2a\u4e8c\u7ef4\u72b6\u6001 $(u, x)$ \u8868\u793a\u8d70\u5230 $u$ \u4e14\u5f53\u524d\u6743\u503c\u4e3a $x$\uff0c\u90a3\u4e48\u8be2\u95ee\u76f8\u5f53\u4e8e\u6c42\u89e3 $(s, 0)$ \u662f\u5426\u80fd\u591f\u5230\u8fbe $(t, r)$\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u6df1\u5165\u5206\u6790\u6b64\u9898\u7684\u6027\u8d28\u3002\n\n1. \u5047\u8bbe $(u, x)$ \u80fd\u591f\u5230\u8fbe $(v, y)$\uff0c\u90a3\u4e48 $(v, y)$ \u4e5f\u80fd\u591f\u5230\u8fbe $(u, x)$\u3002\u6362\u8a00\u4e4b\uff0c\u72b6\u6001\u4e4b\u95f4\u5f62\u6210\u7684\u662f\u4e00\u4e2a\u65e0\u5411\u56fe\u3002\n\n\u8bc1\u660e\uff1a\n\n\u4efb\u610f\u627e\u5230\u4e00\u6761 $u \\to v$ \u7684\u8def\u5f84\uff0c\u8bbe\u8def\u5f84\u957f\u5ea6\u4e3a $l$\uff0c\u6743\u503c\u4e3a $w_i$\u3002\n\n\u82e5\u521d\u59cb\u72b6\u6001\u4e3a $(u, x)$\uff0c\u90a3\u4e48\u8d70\u4e00\u6b21\u8be5\u8def\u5f84\u540e\u5230\u8fbe\u7684\u72b6\u6001\u5373\u4e3a $(v, x \\cdot 2^{l} + w_i)$\u3002\n\n\u8d70\u4e86 $t$ \u6b21\u8be5\u6761\u8def\u5f84\u4e4b\u540e\uff0c\u8def\u5f84\u7684\u6743\u503c\u5373\u4e3a $x \\cdot 2^{t\\cdot l} + w_i \\cdot 2^l\\cdot (2^{t} - 1)$\u3002\n\n\u7531\u4e8e $p$ \u4e3a\u5947\u6570\uff0c\u90a3\u4e48 $2^{\\varphi(p)} \\equiv 1 \\pmod{p}$\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53 $t = \\varphi(p) \\cdot 2$ \u65f6\uff0c\u6211\u4eec\u4ecd\u7136\u53ef\u4ee5\u8d70\u56de\u72b6\u6001 $(u, x)$\u3002\n\n\u800c $\\varphi(p) \\cdot 2 > 1$\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u53ef\u4ee5\u4ece\u72b6\u6001 $(u, x)$ \u8d70\u5230 $(v, x \\cdot 2^{l} + w_i)$\uff0c\u518d\u4ece $(v, x \\cdot 2^{l} + w_i)$ \u8d70\u56de $(u, x)$\u3002\n\n\u5f97\u8bc1\u3002 \n\n\u4e0b\u6587\u7528 $\\Leftrightarrow$ \u8868\u793a\u8fd9\u79cd\u5173\u7cfb\u3002\n\n2. \u5047\u8bbe\u56fe\u4e2d\u5b58\u5728\u4e24\u6761\u8fb9\uff0c\u8fb9\u6743\u5206\u522b\u4e3a $a, b$\uff0c\u90a3\u4e48 $(u, x) \\Leftrightarrow (u, x + (a - b) \\cdot 3)$\u3002\n\n\u8bc1\u660e\uff1a\n\n\u9996\u5148\uff0c\u82e5\u5b58\u5728\u4e24\u6761\u8fb9\uff0c\u8fb9\u6743\u4e3a $a, b$ \u5e76\u4e0e\u70b9 $u$ \u76f8\u8fde\uff0c\u90a3\u4e48 $(u, x \\cdot 4 + b \\cdot 3) \\Leftrightarrow (u, x) \\Leftrightarrow(u , x \\cdot 4 + a \\cdot 3)$\u3002\n\n\u7531\u4e8e $4$ \u5b58\u5728\u4e58\u6cd5\u9006\u5143\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u6362\u5143\uff0c\u5373\u7528 $x$ \u4ee3\u66ff $x \\cdot 4 + b \\cdot 3$\uff0c\u90a3\u4e48\u53ef\u5f97 $(u, x) \\Leftrightarrow (u, x + (a - b) \\cdot 3)$\u3002\n\n\u8003\u8651\u6269\u5c55\u8fd9\u4e2a\u6027\u8d28\u3002\n\n\u5047\u8bbe\u5b58\u5728\u4e24\u6761\u8fb9\uff0c\u8fb9\u6743\u4e3a $a, b$ \u5e76\u4e0e\u70b9 $v$ \u76f8\u8fde\uff0c\u90a3\u4e48\u4e0a\u8ff0\u6027\u8d28\u540c\u6837\u6ee1\u8db3\u3002\n\n\u7c7b\u4f3c\u4e0a\u6587\uff0c\u6211\u4eec\u8003\u8651\u627e\u51fa\u4e00\u6761 $u \\to v$ \u7684\u8def\u5f84\uff0c\u957f\u5ea6\u4e3a $l$\uff0c \u6743\u503c\u4e3a $w_i$\uff0c\u90a3\u4e48\u8d70 $t$ \u6b21\u8be5\u8def\u5f84\u540e\u6743\u503c\u7531 $x$ \u53d8\u4e3a $x \\cdot 2^{t \\cdot l} + w_i \\cdot (2^{t\\cdot l} - 1)$\u3002\n\n\u6211\u4eec\u63a5\u7740\u5728 $v$ \u4e0a\u8d70\uff0c\u4ee4\u6743\u503c\u53d8\u4e3a $x \\cdot 2^{t \\cdot l} + w \\cdot 2^l \\cdot (2^{t } - 1) + (a - b) \\cdot 3 \\cdot 2^t$\u3002\u90a3\u4e48\u5f53 $t = \\varphi(p) \\cdot 2$ \u65f6\uff0c\u6211\u4eec\u4fbf\u8d70\u5230\u4e86\u72b6\u6001 $(u, x + (a - b) \\cdot 3)$\u3002\n\n \u63a5\u7740\u6269\u5c55\uff0c\u6211\u4eec\u5047\u8bbe\u70b9 $u$ \u4e0e\u70b9 $v$ \u4e4b\u95f4\u5b58\u5728\u4e00\u6761\u6743\u503c\u4e3a $b$ \u7684\u8fb9\uff0c\u8fd8\u5206\u522b\u5b58\u5728\u4e00\u6761\u6743\u503c\u4e3a $a, c$ \u7684\u8fb9\u4e0e\u70b9 $u, v$ \u5bf9\u5e94\u76f8\u8fde\u3002\n\n\u90a3\u4e48 $(u, x) \\Leftrightarrow (u, x + (b - a) \\cdot 3 + (c - b) \\cdot 3)$\uff0c\u4e5f\u5373 $(u, x + (c - a) \\cdot 3)$ \u3002\n\n\u6211\u4eec\u628a\u4e24\u6b21\u6269\u5c55\u5f97\u51fa\u7684\u7ed3\u8bba\u76f8\u7ed3\u5408\uff0c\u7a0d\u52a0\u63a8\u5bfc\u4fbf\u80fd\u5f97\u51fa\u7ed3\u8bba\u3002\n\n\u5f97\u8bc1\u3002\n\n------\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8bbe $\\displaystyle g' = \\gcd_{a, b~\\in~\\text{E}} (a - b), g = \\gcd(g', p)$\uff0c\u90a3\u4e48\u7531\u88f4\u8700\u5b9a\u7406\u53ef\u4ee5\u5f97\u51fa\uff1a$(u, x) \\Leftrightarrow (u, x + g \\cdot 3)$\uff0c\u4e5f\u5373\u5f53 $x \\equiv y \\pmod{g \\cdot 3}$ \u65f6\u6709 $(u, x) \\Leftrightarrow (u, y)$\u3002\n\n\u7ed3\u5408\u6027\u8d28 \u201c$x \\equiv y \\pmod{p}$ \u65f6\u6709 $(u, x) \\Leftrightarrow (u, y)$\u201d\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\uff1a$x \\equiv y\\pmod{\\gcd(g \\cdot 3, p)}$ \u65f6\u6709 $(u, x) \\Leftrightarrow (u, y)$\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u7528 $\\gcd(g\\cdot 3, p)$ \u4ee3\u66ff $p$\uff0c\u90a3\u4e48\u4e0b\u6587\u7684 $p$ \u7686\u4ee3\u8868\u6b64\u3002\n\n\u8fd9\u91cc\u6709\u4e00\u4e2a\u7ec6\u8282\u95ee\u9898\uff1a$g'$ \u8981\u600e\u4e48\u8ba1\u7b97\uff1f\u5b9e\u9645\u4e0a\uff0c$g'$ \u5c31\u7b49\u4e8e $\\displaystyle \\gcd_{i = 1}^m (w_i - w_1)$\uff0c\u8bc1\u660e\u53ef\u4ee5\u8003\u8651\u66f4\u76f8\u51cf\u635f\u6cd5\uff0c\u5373 $\\gcd(a, b) = \\gcd(b, a - b)$\u3002\n\n------\n\n\u8003\u8651\u5230\u6709 $\\forall a, b \\in \\text{E}, g \\mid (a - b)$\uff0c\u90a3\u4e48 $a \\equiv b \\pmod{g}$\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6bcf\u6761\u8fb9\u7684\u8fb9\u6743\u90fd\u53ef\u4ee5\u8868\u793a\u4e3a $g \\cdot k + z$ \u5f62\u5f0f\u3002\n\n\u6211\u4eec\u4e0d\u59a8\u628a\u6240\u6709\u8fb9\u51cf\u53bb $z$\uff0c\u7136\u540e\u628a\u6240\u6709\u72b6\u6001\u7684\u7b2c\u4e8c\u7ef4\u9ed8\u8ba4\u52a0\u4e0a $z$\u3002\u4e5f\u5373\uff1a\n$$\n(u, x)' = (u, x + z) \\Leftrightarrow (v, (x + z) \\cdot 2 + w_i - z)  = (v, x \\cdot 2 + w_i + z) = (v, x \\cdot 2 + w_i)'\n$$\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u6211\u4eec\u53ea\u9700\u8981\u628a\u8fb9\u6743\u8fdb\u884c\u5904\u7406\uff0c\u7136\u540e\u6309\u7167\u5176\u539f\u672c\u7684\u65b9\u5f0f\u64cd\u4f5c\uff0c\u662f\u4e0d\u4f1a\u9020\u6210\u4efb\u4f55\u5f71\u54cd\u7684\u3002\n\n------\n\n\u73b0\u5728\uff0c\u6bcf\u4e00\u6761\u8fb9\u7684\u8fb9\u6743\u90fd\u662f $g$ \u7684\u500d\u6570\u4e86\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e\u72b6\u6001 $(u, x)'$\uff0c\u5b83\u80fd\u5230\u8fbe\u7684\u72b6\u6001\u5747\u53ef\u4ee5\u8868\u793a\u4e3a $(v, x \\cdot 2^p + g \\cdot q)'$\u3002\n\n\u663e\u7136\u6709 $q \\in \\{0, 1, 2\\}$\u3002 \n\n\u53c8\u7531\u4e8e $(u, x)' \\Leftrightarrow (u, x \\cdot 4 + w_i \\cdot 3)'\\Leftrightarrow (u, x \\cdot 4)' = (u, x\\cdot 2^2)'$\uff0c\u90a3\u4e48\u72b6\u6001\u5c31\u53ea\u548c $p$ \u7684\u5947\u5076\u6027\u6709\u5173\u4e86\uff0c\u4e5f\u5373 $p \\in \\{0, 1\\}$\u3002\n\n\u8fd9\u6837\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\u800c\u8a00\uff0c\u672c\u8d28\u4e0d\u540c\u7684\u72b6\u6001\u53ea\u5269\u4e0b $6$ \u79cd\uff0c\u8fd9\u662f\u5341\u5206\u597d\u7684\u4f18\u5316\u3002\n\n\u6211\u4eec\u5982\u4f55\u7ef4\u62a4\u8fd9\u4e9b\u72b6\u6001\u7684\u8fde\u901a\u6027\u5462\uff1f\u679a\u4e3e\u6bcf\u4e00\u6761\u8fb9\uff0c\u628a\u4e24\u4e2a\u7aef\u70b9\u5bf9\u5e94\u7684\u72b6\u6001\u7528\u5e76\u67e5\u96c6\u5408\u5e76\u5373\u53ef\u3002\n\n------\n\n\u56de\u5230\u95ee\u9898\u4e0a\u6765\uff0c\u73b0\u5728\u6211\u4eec\u9700\u8981\u5224\u65ad $(s, z)$ \u662f\u5426\u80fd\u591f\u5230\u8fbe $(t, r + z)$\u3002\n\n\u90a3\u4e48\u6211\u4eec\u9700\u8981\u627e\u5230 $p, q$ \u6ee1\u8db3\uff1a\n\n1. $(s, 0)'$ \u9700\u8981\u80fd\u591f\u5230\u8fbe $(t, 2^p + g \\cdot q)'$\u3002\n\n2. \u5b58\u5728 $k_1, k_2$\uff0c\u6ee1\u8db3 $z \\cdot 2^{k_1 \\cdot 2 + p} + g \\cdot (q + k_2 \\cdot 3) \\equiv r + z \\pmod{p}$\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u6761\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u5e76\u67e5\u96c6\u5224\u65ad\u3002\n\n\u5bf9\u4e8e\u7b2c\u4e8c\u4e2a\u6761\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5f0f\u5b50\u8f6c\u5316\u4e3a $r + z - g \\cdot q \\equiv z \\cdot 2^{k_1 \\cdot 2 + p}\\pmod{p}$\uff0c\u7136\u540e\u63d0\u524d\u9884\u5904\u7406\u540e\u9762\u4e00\u90e8\u5206\u5373\u53ef\u3002\n\n------\n\n\u4ee3\u7801\u5b9e\u73b0\uff1a\n\n```cpp\n#include<iostream>\n#include<cstdio>\n#include<cstdlib>\n#include<cctype>\n#include<cstring>\n#include<algorithm>\n\nusing namespace std;\n\nnamespace IO\n{\n    int f, c;\n\n    template<typename T> inline void _Read(T &k)\n    {\n        k = 0, f = 1, c = getchar();\n        while(!isdigit(c))\n        {\n            if(c == '-') f = -1;\n            c = getchar();\n        }\n        while(isdigit(c))\n        {\n            k = (k << 3) + (k << 1) + c - '0';\n            c = getchar();\n        }\n        return k *= f, void();\n    }\n\n    template<typename T> inline void _Write(T k)\n    {\n        if(k < 0) putchar('-'), k = -k;\n        if(k > 9) _Write(k / 10);\n        return putchar(k % 10 + '0'), void();\n    }\n\n    inline int Read32() { int k; _Read(k); return k; }\n    inline void Write32(int k, char ed = '\\n') { return _Write(k), putchar(ed), void(); }\n}\n\nusing IO :: Read32;\nusing IO :: Write32;\n\nnamespace Program\n{\n    const int MAXN = 2000005;\n\n    int n, m, q, mod, g, z, ed[MAXN][3];\n    bool f[2][MAXN];\n\n    inline int gcd(int a, int b) { return b ? gcd(b, a % b) : a; }\n\n    namespace Disjoint_Set\n    {\n        int fa[MAXN], si[MAXN];\n\n        inline void Init()\n        {\n            for(register int i = 1; i <= n * 6; i++) fa[i] = i, si[i] = 1;\n            return;\n        }\n\n        inline int Id(int u, int p, int q) { return (u - 1) * 6 + p * 3 + q + 1; }\n\n        inline int Find(int u) { return fa[u] = (u == fa[u] ? u : Find(fa[u])); }\n\n        inline void Merge(int u, int v)\n        {\n            int fu = Find(u), fv = Find(v);\n            if(fu == fv) return;\n            if(si[fu] < si[fv]) swap(fu, fv);\n            return fa[fv] = fu, si[fu] += si[fv], void();\n        }\n    }\n\n    using namespace Disjoint_Set;\n\n    inline bool Check(int s, int t, int r)\n    {\n        for(register int p = 0; p < 2; p++) for(register int q = 0; q < 3; q++) if(Find(Id(t, 0, 0)) == Find(Id(s, p, q)) && f[p][(r + z + g * (3 - q)) % mod]) return true;\n        return false;\n    }\n\n    inline int Run()\n    {\n        n = Read32(), m = Read32(), q = Read32(), g = mod = Read32(); \n        for(register int i = 1; i <= m; i++)\n        {\n            ed[i][0] = Read32(), ed[i][1] = Read32(), ed[i][2] = Read32();\n            g = gcd(g, abs(ed[i][2] - ed[1][2]));\n        }\n        mod = gcd(g * 3, mod), z = ed[1][2] % g, Init();\n        for(register int i = 1; i <= m; i++)\n        {\n            int u = ed[i][0], v = ed[i][1], w = (ed[i][2] - z) / g; \n            for(register int p = 0; p < 2; p++) for(register int q = 0; q < 3; q++)\n            {\n                Merge(Id(u, p, q), Id(v, p ^ 1, ((q << 1) + w) % 3));\n                Merge(Id(v, p, q), Id(u, p ^ 1, ((q << 1) + w) % 3));\n            }\n        }\n        for(register int i = 0, now = z; i < (mod << 1); i++)\n        {\n            f[i & 1][now] = true;\n            now = (now << 1) % mod;\n        }\n        while(q--)\n        {\n            int s = Read32(), t = Read32(), r = Read32();\n            if(Check(s, t, r)) puts(\"YES\"); else puts(\"NO\");\n        }\n        return 0;\n    }\n}\n\nint main() { return Program :: Run(); }\n```\n\n------\n\n**\u5b8c\u7ed3\u6492\u82b1\uff01**",
        "postTime": 1663806240,
        "uid": 183562,
        "name": "_ReClouds_",
        "ccfLevel": 7,
        "title": "AT4696 [AGC031F] Walk on Graph \u9898\u89e3"
    },
    {
        "content": "\u9996\u5148\u8f6c\u5316\u4e00\u4e0b\u95ee\u9898\uff0c\u5012\u7740\u6765\u505a\uff0c\u4e00\u5f00\u59cb\u6709\u4e00\u4e2a\u6570 $0$ , \u6bcf\u6b21\u8d70\u8fc7\u4e00\u6761\u8fb9\u8be5\u6570\u53d8\u4e3a\u4e58\u4ee5 $2$ \u518d\u52a0\u4e0a\u8fd9\u6761\u8fb9\u7684\u8fb9\u6743\u3002\u7528 $(u,x)$ \u4ee3\u8868\u4e00\u4e2a\u72b6\u6001\uff0c\u8868\u793a\u5f53\u524d\u5728\u70b9 $u$ \uff0c\u6743\u503c\u5728\u6a21 $p$ \u4e0b\u4e3a $x$ \u3002\n\n\u6709\u4e00\u6761\u8fb9 $(u,v,c)$ \uff0c\u90a3\u4e48\u53ef\u4ee5\u8d70\u5230\u7684\u72b6\u6001\u662f\n$$\n(u,x)\\to (v,4x+3c)\\to (u,8x+7c)\\cdots\n$$\n\u7531\u4e8e $p$ \u662f\u5947\u6570\uff0c\u6240\u4ee5\u5b58\u5728 $k>1$ \u4f7f\u5f97 $2^k\\equiv 1 \\mod p$\uff0c\u6240\u4ee5\u72b6\u6001\u662f\u5faa\u73af\u7684\uff0c\u7531 $(u,x)$ \u51fa\u53d1\u6700\u7ec8\u8fd8\u4f1a\u8d70\u56de $(u,x)$ \uff0c\u6240\u4ee5\u53ef\u4ee5\u8ba4\u4e3a\u9012\u63a8\u5173\u7cfb\u662f\u53cc\u5411\u7684\uff0c\u5373 $(u,x)\\Leftrightarrow (v,2x+c)$ \u3002\n\n\u63a5\u4e0b\u6765\u8003\u8651\u5982\u679c\u8fde\u63a5\u70b9$u$\u7684\u4e24\u6761\u8fb9\u8fb9\u6743\u5206\u522b\u4e3a $a,b$ \uff0c\u5219\n$$\n(u,v)\\Leftrightarrow (u,4x+3a)\n$$\n$$\n(u,v)\\Leftrightarrow (u,4x+3b)\n$$\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u8fd9\u6837\u4e00\u6761\u8def\n$$\n(u,4x+3a)\\Leftrightarrow (u,x)\\Leftrightarrow (v,4x+3b)\n$$\n\u4e8b\u5b9e\u4e0a\uff0c\u56e0\u4e3a\u5b58\u5728 $4$ \u7684\u9006\u5143\uff0c\u90a3\u4e48 $4x$ \u53ef\u4ee5\u8868\u793a\u4efb\u4f55\u6570\uff0c\u90a3\u4e48\u5c31\u76f8\u5f53\u4e8e\n$$\n(u,v)\\Leftrightarrow (u,x+3k(a-b)),k\\in \\mathbb{Z}\n$$\n\u63a5\u7740\u8003\u8651\u4e0d\u540c\u7684\u70b9\uff0c$(u,x)\\Leftrightarrow(v,2x+w)$ , \u8bbe  $u$ \u5faa\u73af\u8282\u957f\u5ea6\u4e3a $t_u $\uff0c\u90a3\u4e48 $v$ \u7684\u5faa\u73af\u8282\u957f\u5ea6\u4e3a $2t_u$ \uff0c\u548c\u5176\u672c\u8eab\u7684\u53d6 $\\gcd$ \u5f97$\\gcd(t_u,2t_v)=\\gcd(t_u,t_v)$ ( $2$ \u53ef\u4ee5\u53bb\u6389\u662f\u56e0\u4e3a $2$ \u4e0e $3g_u$ \u4e92\u8d28\u56e0\u800c\u4e0e $t_u$ \u4e92\u8d28)\u3002\u7531\u4e8e\u6574\u4e2a\u56fe\u662f\u8054\u901a\u7684\uff0c\u8fd9\u53ef\u4ee5\u6269\u5c55\u5230\u6240\u6709\u70b9\uff0c\u4e5f\u5c31\u662f\u5bf9\u4e8e\u6240\u6709 $(u,x)$ \u6709  $(u,x)\\Leftrightarrow(u,x+T)$ \uff0c\u4ee4\n\n$$\nt=\\gcd_{u=1}^nt_u=\\gcd(3\\gcd_{i=1}^m(w_i-w_1),p)\n$$\n$$\ng=\\gcd_{i=1}^m(w_1-w_1)\n$$\n\u663e\u7136\u6709 $t=g$ \u6216 $t=3g$ \u3002\u6574\u7406\u4e00\u4e0b\uff0c\u540c\u4e00\u70b9\u6240\u6709\u6a21 $t$ \u540c\u4f59\u7684\u72b6\u6001\u662f\u4e00\u6837\u7684\uff0c\u800c\u6240\u6709\u8fb9\u6743\u662f\u6a21 $g$ \u540c\u4f59\u7684\uff0c\u4e14 $t=g$ \u6216 $t=3g$ \u3002\n\n\u8fd9\u6837\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u9898\u76ee\u4e2d\u7684 $p$ \u76f4\u63a5\u6539\u6210 $t$ , \u4e0d\u4f1a\u5bf9\u7b54\u6848\u6709\u4efb\u4f55\u5f71\u54cd\uff0c\u90a3\u4e48\u73b0\u5728\u6240\u6709\u8fb9\u6743\u5728\u6a21$g$\u610f\u4e49\u4e0b\u90fd\u76f8\u7b49\uff0c\u8bbe\u4e3a $z$ \uff0c\u4e8e\u662f\u53ef\u4ee5\u5427\u6240\u6709\u72b6\u6001\u7684 $x$ \u52a0 $z$ \uff0c\u6240\u6709\u8fb9\u6743\u51cf $z$ \uff0c\u5219\u4e4b\u524d\u6240\u6709\u6027\u8d28\u4ecd\u6210\u7acb\uff0c\u56e0\u4e3a\n$$\n(u,x)\\Leftrightarrow (v,2(x-z)+(c+z)+z)=(v,2x+c)\n$$\n\u8fd9\u6837\u7684\u8bdd\u8fb9\u6743\u90fd\u662f $g$ \u7684\u500d\u6570\u4e86\uff0c\u800c\u56e0\u4e3a $(u,x)\\Leftrightarrow(u,4x+3c)$ \uff0c\u800c $c$ \u53c8\u662f $g$ \u7684\u500d\u6570\uff0c\u90a3\u4e48\u53ef\u4ee5\u8ba4\u4e3a $(u,x)\\Leftrightarrow(u,4x)$ \uff0c\u4e8e\u662f\u6709\n$$\n(u,x)\\Leftrightarrow (u,x2^p+qg),\\ (0\\leq p\\leq 1,0\\leq q\\leq 2)\n$$\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u6211\u4eec\u53ea\u6709 $6$ \u79cd\u72b6\u6001\u6709\u7528\u3002\u53ef\u4ee5\u7528\u5e76\u67e5\u96c6\u628a\u6240\u6709\u5728\u540c\u4e00\u4e2a\u8fde\u901a\u5757\u91cc\u7684\u70b9\u7f29\u8d77\u6765\uff0c\u5bf9\u4e8e\u8be2\u95ee\uff0c\u53ea\u9700\u8981\u5224\u65ad $(t,z)$ \u548c $(s,z+r)$ \u662f\u5426\u8fde\u901a\uff0c\u53ef\u4ee5\u5f97\u5230\n$$\nz2^p+qg=r+z\n$$\n\u5bf9\u4e8e\u6bcf\u4e2a $p$ \u9884\u5904\u7406\u4e00\u4e0b $z2^p$ \u7684\u5947\u5076\u6027\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((n+m+q)\\alpha (n)+p)$ \u3002\n#### Code\n```cpp\nint n,m,Q,MOD,g,z;\nint u[MAXN],v[MAXN],f[MAXN],c[MAXN];\nbool flag[2][MAXM];\n\nint GetId(int u,int p,int q){\n    return (u - 1) * 6 + p * 3 + q + 1;\n}\n\nint gcd(int a,int b){\n    if(b == 0) return a;\n    return gcd(b,a % b);\n}\n\nint Find(int x){\n    if(x == f[x]) return x;\n    return f[x] = Find(f[x]);\n}\n\nvoid Merge(int u,int v){\n    u = Find(u); v = Find(v);\n    if(u != v) f[u] = v;\n}\n\nint main(){\n    scanf(\"%d%d%d%d\",&n,&m,&Q,&MOD);\n    g = MOD;\n    for(int i = 1;i <= m;i++){\n        scanf(\"%d%d%d\",&u[i],&v[i],&c[i]);\n        g = gcd(g,abs(c[i] - c[1]));\n    }\n    MOD = gcd(3 * g,MOD);\n    z = c[1] % g;\n    for(int i = 1;i <= n * 6;i++) f[i] = i;\n    for(int i = 1;i <= m;i++){\n        int w = (c[i] / g) % 3;\n        for(int p = 0;p < 2;p++){\n            for(int q = 0;q < 3;q++){\n                Merge(GetId(u[i],p,q),GetId(v[i],p ^ 1,(q * 2 + w) % 3));\n                Merge(GetId(v[i],p,q),GetId(u[i],p ^ 1,(q * 2 + w) % 3));\n            }\n        }\n    }\n    for(int i = 0,t = z;i < MOD;i++){\n        flag[i & 1][t] = 1;\n        t = t * 2 % MOD;\n    }\n    while(Q--){\n        int s,t,r;\n        scanf(\"%d%d%d\",&s,&t,&r);\n        for(int p = 0;p < 2;p++){\n            for(int q = 0;q < 3;q++){\n                if(Find(GetId(t,0,0)) == Find(GetId(s,p,q)) && flag[p][(r + z + (3 - q)* g) % MOD]){\n                    puts(\"YES\");\n                    goto NEXT;\n                }\n            }\n        }\n        puts(\"NO\");\n        NEXT: continue;\n    }\n    return 0;\n}\n```",
        "postTime": 1608173134,
        "uid": 108894,
        "name": "\u5173\u6000\u4ed6\u4eba",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 AT4696 \u3010[AGC031F] Walk on Graph\u3011"
    },
    {
        "content": "\u795e\u4ed9\u6570\u8bba\u9898\u3002\n\n\u9996\u5148\uff0c\u5982\u679c\u6b63\u7740\u505a\uff0c\u6211\u4eec\u9700\u8981\u8bb0\u5f55**\u8d70\u8fc7\u4e86\u51e0\u6761\u8fb9**\u4ee5\u53ca**\u5f53\u524d\u8def\u5f84\u7684\u957f\u5ea6**\uff0c\u8fd9\u4e0d\u65b9\u4fbf\u6211\u4eec\u6316\u6398\u6027\u8d28\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u5012\u7740\u505a\uff0c\u6bcf\u6b21\u628a\u5f53\u524d\u8def\u5f84\u7684\u957f\u5ea6\u4e58\u4e8c\u518d\u52a0\u4e0a\u5f53\u524d\u8fb9\u6743\u3002\n\n\u6211\u4eec\u628a\u72b6\u6001\u5b9a\u4e49\u4e3a $(u, x)$ \u5176\u4e2d $u$ \u662f\u5f53\u524d\u8282\u70b9\uff0c$x$ \u662f\u5f53\u524d\u8def\u5f84\u957f\u5ea6\uff08\u8fd9\u91cc\u7684 $x$ \u662f\u5728\u6a21 $Mod$ \u610f\u4e49\u4e0b\u7684\uff09\u3002\n\n\u5047\u8bbe\u6211\u4eec\u7ecf\u8fc7\u4e00\u6761\u8fb9 $(u, v, w)$ \u53ef\u4ee5\u628a\u72b6\u6001 $(u, x)$ \u8f6c\u79fb\u6210 $(v, 2x +w)$ \uff0c\u6211\u4eec\u4e0d\u59a8\u628a\u8fd9\u4e24\u4e2a\u72b6\u6001\u8fde\u6709\u5411\u8fb9\u3002\n\n\u90a3\u4e48\u6211\u4eec\u603b\u5171\u6709 $nMod$ \u4e2a\u72b6\u6001\uff0c\u6211\u4eec\u9700\u8981\u627e\u5230\u72b6\u6001 $(T, 0)$ \u662f\u5426\u80fd\u5230\u8fbe $(S, R)$ \u3002\n\n### \u6027\u8d28\u4e00\n\n\u6211\u4eec\u53d1\u73b0\u9898\u76ee\u63d0\u5230\u4e86 $Mod$ \u4e3a\u5947\u6570\uff0c\u90a3\u4e48 $\\gcd(2, Mod) = 1$ \uff0c\u6240\u4ee5\u7531\u6b27\u62c9\u5b9a\u7406\uff0c\u5b58\u5728 $x = \\varphi(Mod)$ \u4f7f\u5f97 $2^x \\equiv 1 \\pmod {Mod}$ \u3002\n\n\u8003\u8651\u72b6\u6001 $(u, x)$ \u53cd\u590d\u8d70 $(u, v, w)$ \u8fd9\u6761\u8fb9\uff0c\u5373\uff1a\n\n$(u, x) \\rightarrow (v, 2x + w) \\rightarrow (u, 4x + 3w) \\rightarrow \\cdots$\n\n\u8d70\u5230\u7b2c $i$ \u6b21\u7684\u6743\u503c\u4e3a $2^ix+(2^i - 1)w$ \uff0c\u5f53 $i = \\varphi(Mod)$ \u65f6\uff0c\u6743\u503c\u5c31\u6070\u597d\u7b49\u4e8e $x$ \uff0c\u5982\u679c\u5f53\u524d\u5728\u8282\u70b9 $u$\uff0c \u6211\u4eec\u5c31\u56de\u5230\u4e86 $(u, x)$ \uff0c\u5982\u679c\u5f53\u524d\u5728\u8282\u70b9 $v$ \uff0c \u6211\u4eec\u518d\u8d70 $i$ \u6b65\u5c31\u80fd\u56de\u5230 $(u, x)$ \u3002\n\n\u7efc\u4e0a\uff0c\u6211\u4eec\u53cd\u590d\u8d70 $(u, v, w)$ \u6240\u8fbe\u5230\u7684\u72b6\u6001\u5f62\u6210\u4e86\u4e00\u4e2a\u73af\uff0c\u6240\u4ee5\u6211\u4eec**\u72b6\u6001\u4e4b\u95f4\u53ef\u4ee5\u8fde\u65e0\u5411\u8fb9**\u3002\n\n\u90a3\u4e48\u6211\u4eec\u5982\u679c\u6839\u636e\u8fd9\u4e2a\u6027\u8d28\u679a\u4e3e $nMod$ \u4e2a\u72b6\u6001\u7136\u540e\u7528\u5e76\u67e5\u96c6\u5efa\u8fb9\uff0c\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a $O(nMod^2\\alpha(nMod))$ \u7684\u7b97\u6cd5\u3002\n\n---\n\n### \u6027\u8d28\u4e8c\n\n\u6211\u4eec\u8003\u8651\u4e00\u4e2a\u8282\u70b9 $u$ \u5982\u679c\u8fde\u4e86\u4e24\u6761\u6743\u503c\u5206\u522b\u4e3a $a, b$ \u7684\u8fb9\uff0c\u90a3\u4e48 $(u, x)$ \u53ef\u4ee5\u5230\u8fbe $(u, 4x+3a)$ \u4e0e $(u, 4x+3b)$ \u6240\u4ee5 $(u, x)$ \u53ef\u4ee5\u5230\u8fbe $(u, x + 3(a-b))$ \uff0c\u540c\u6837\u5730\uff0c$(u, x + 3(a-b))$ \u4e5f\u80fd\u5230\u8fbe $(u, x)$\u3002\n\n\u5373\uff1a$(u, x) \\Leftrightarrow (u, x + 3(a-b))$\n\n\u6839\u636e\u8fd9\u4e2a\u6027\u8d28\uff0c\u6211\u4eec\u8003\u8651\u628a\u4e0e\u8282\u70b9 $u$ \u76f8\u8fde\u7684\u6240\u6709\u8fb9\u7684\u8fb9\u6743\u6c42 $\\gcd$ \uff0c\u7531\u4e8e\u56fe\u662f\u8054\u901a\u7684\uff0c\u6240\u4ee5\u8fd9\u4e2a $\\gcd$ \u4e5f\u5c31\u662f\u4efb\u610f\u4e24\u6761\u8fb9\u7684 $\\gcd$ \u3002\n\n\u8bbe\u8fd9\u4e2a $\\gcd = g'$ \uff0c\n\n\u4ee4$g=\\gcd(g',Mod)$\n\n\u6839\u636e\u5269\u4f59\u7cfb\u7684\u77e5\u8bc6\uff0c\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$\\forall u \\in V, (u, x) \\Leftrightarrow (u, x+3g)$\n\n\u4e5f\u5c31\u662f\u8bf4\u5f53 $x \\equiv y \\pmod{3g}$ \u65f6 $(u,x) \\Leftrightarrow (u,y)$\n\n---\n\n### \u6027\u8d28\u4e09\n\n$\\because x \\equiv y \\pmod{Mod}$ \u65f6 $(u,x) \\Leftrightarrow (u,y)$\n\n$\\therefore$ \u5f53 $x \\equiv y \\pmod{\\gcd(3g,Mod)}$ \u65f6\uff0c $(u,x) \\Leftrightarrow (u,y)$\n\n\u6240\u4ee5\u6211\u4eec\u53d1\u73b0\u4ee4 $Mod = \\gcd (3g,Mod)$ \u80fd\u66ff\u4ee3\u539f\u95ee\u9898\u3002\n\n\uff08\u4e0b\u9762\u7684 $Mod$ \u5747\u4ee3\u8868 $\\gcd (3g,Mod)$\uff09\n\n$\\because \\forall a,b \\in E,g | (a-b)$\n\n$\\therefore a \\equiv b \\pmod g$\n\n$\\therefore \\forall a \\in E,a = kg + z$ \uff0c\u5176\u4e2d $z$ \u662f\u5e38\u6570\u3002\n\n\u8fb9\u6743\u5982\u679c\u7528 $kg + z$ \u8868\u793a\u4f1a\u6bd4\u8f83\u590d\u6742\uff0c\u6240\u4ee5\u6211\u4eec\u8003\u8651\u628a\u6240\u6709\u8fb9\u6743\u51cf\u53bb $z$ \u3002\n\n\u4e3a\u4e86\u4e0e\u539f\u6765\u7684\u8f6c\u6362\u4fdd\u6301\u4e0d\u53d8\uff0c\u6211\u4eec\u8981\u628a\u6240\u6709\u72b6\u6001\u4e2d\u7684\u8def\u5f84\u957f\u5ea6\u52a0\u4e0a $z$ \uff1a\n\n$(u,x)' = (u,x+z) \\Leftrightarrow (v,2(x+z)+w-z) \\Leftrightarrow (v,2x+w+z) =(v,2x+w)'$\n\n$\\therefore \\forall u \\in V, (u, x)$ \u80fd\u5230\u8fbe\u7684\u72b6\u6001\u5747\u53ef\u4ee5\u8868\u793a\u6210 $(v, 2^px+qg)$\n\n\u7531\u6027\u8d28\u4e8c\uff0c$q \\equiv q' \\pmod 3$ \u65f6\uff0c$(v, 2^px+q'g)  \\Leftrightarrow (v, 2^px+qg)$\n\n\u6240\u4ee5\u53ea\u9700\u53d6 $q = \\{0, 1, 2\\}$ \u5373\u53ef\u3002\n\n$\\because (u,2^{p}x) \\Leftrightarrow (v,2^px + qg) \\Leftrightarrow (u,2^{p+1}x+3qg) \\Leftrightarrow (u,2^{p+2}x)$\n\n\u6240\u4ee5\u53ea\u9700\u53d6 $p = \\{0,1\\}$ \u5373\u53ef\u3002\n\n\u6240\u4ee5\u72b6\u6001\u53ea\u6709 $6n$ \u79cd\u4e86\uff0c\u7528\u5e76\u67e5\u96c6\u7ef4\u62a4\u8fd9 $6n$ \u4e2a\u72b6\u6001\u7684\u8054\u901a\u60c5\u51b5\u3002\n\n---\n\n\u8003\u8651\u628a $(T,z)$ \u80fd\u5426\u5230\u8fbe $(S,R+z)$ \u8f6c\u6362\u6210\u8868\u8fbe\u5f0f\n\n$(T,z)$ \u80fd\u5230\u8fbe $(S,R+z)$ \n\n$\\Leftrightarrow \\exists p, q$ \u540c\u65f6\u6ee1\u8db3\n\n1. $(T,z)$ \u4e0e $(S,2^p+qg)$ \u8054\u901a\n2. $\\exists k_1, k_2 \\in \\mathbb{Z}$ \u4f7f\u5f97 $2^{2k_1+p}z+(q+3k_2)g \\equiv R+z\\pmod{Mod}$\n\n\u4f46\u56e0\u4e3a $Mod | 3k_2g$\n\n\u6240\u4ee5\u53ea\u9700\u6ee1\u8db3 $\\exists k \\in \\mathbb{Z}$ \u4f7f\u5f97 $R+z-qg \\equiv 2^{2k+p}z\\pmod{Mod}$\n\n\u6211\u4eec\u53ef\u4ee5\u9884\u5904\u7406\u51fa $[0,Mod)$ \u4e2d\u6240\u6709\u53ef\u4ee5\u8868\u793a\u4e3a $2^{2k+p}z$ \u7684\u503c\uff0c\u7136\u540e\u5c31\u80fd $O(\\alpha(m))$ \u5904\u7406\u8be2\u95ee\u4e86\u3002\n\n\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(Mod + n + m\\alpha(m))$ \u9884\u5904\u7406 $O(\\alpha(m))$ \u67e5\u8be2\u3002\n\n\u4ee3\u7801\uff1a\n\n```cpp\n#include <cstdio>\n#include <cmath>\n#include <algorithm>\nusing namespace std;\nconst int N = 5e4 + 5, maxn = 1e6 + 5;\nint n, m, Q, mod, u[N], v[N], w[N];\nbool pre[5][maxn];\nint gcd (int a, int b) {\n\tif (b == 0) {\n\t\treturn a;\n\t}\n\treturn gcd (b, a % b);\n}\nint S[N << 3];\nint getf (int x) {\n\tif (x == S[x]) {\n\t\treturn x;\n\t}\n\treturn S[x] = getf(S[x]);\n}\nvoid merge (int x, int y) {\n\tint u = getf(x), v = getf(y);\n\tif (u != v) {\n\t\tS[u] = v;\n\t}\n}\ninline int get_id (int u, int p, int q) {\n\treturn (u - 1) * 6 + p * 3 + q + 1;\n}\nint main() {\n\tscanf (\"%d%d%d%d\", &n, &m, &Q, &mod);\n\tfor (int i = 1; i <= m; i++) {\n\t\tscanf (\"%d%d%d\", &u[i], &v[i], &w[i]);\n\t}\n\tint g = mod;\n\tfor (int i = 2; i <= m; i++) {\n\t\tg = gcd (g, abs(w[i] - w[1]));\n\t}\n\tmod = gcd (mod, 3 * g);\n\tint z = w[1] % g;\n\tfor (int i = 1; i <= n * 6; i++) {\n\t\tS[i] = i;\n\t}\n\tfor (int i = 1; i <= m; i++) {\n\t\tw[i] = (w[i] - z) / g;\n\t\tfor (int p = 0; p <= 1; p++) {\n\t\t\tfor (int q = 0; q <= 2; q++) {\n\t\t\t\tmerge (get_id (u[i], p, q), get_id (v[i], p ^ 1, (q * 2 + w[i]) % 3));\n\t\t\t\tmerge (get_id (v[i], p, q), get_id (u[i], p ^ 1, (q * 2 + w[i]) % 3));\n\t\t\t}\n\t\t}\n\t}\n\tfor (int i = 0, x = z; i < (mod << 1); i++) {//phi(mod) < mod\n\t\tpre[i & 1][x] = 1;\n\t\tx = (x << 1) % mod; \n\t}\n\tfor (int i = 1, s, t, r; i <= Q; i++) {\n\t\tbool ans = 0;\n\t\tscanf (\"%d%d%d\", &s, &t, &r);\n\t\tfor (int p = 0; p <= 1; p++) {\t\n\t\t\tfor (int q = 0; q <= 2; q++) {\n\t\t\t\tif (getf(get_id(t, 0, 0)) == getf(get_id(s, p, q))) {\n\t\t\t\t\tans |= pre[p][(r + z + (3 - q) * g) % mod];\t//\u4fdd\u8bc1\u4e3a\u6b63\u6570 \n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (ans) {\n\t\t\tprintf (\"YES\\n\");\n\t\t} else {\n\t\t\tprintf (\"NO\\n\");\n\t\t}\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1613813725,
        "uid": 145118,
        "name": "laihaochen",
        "ccfLevel": 8,
        "title": "AT4696 [AGC031F] Walk on Graph \u9898\u89e3"
    },
    {
        "content": "[\u6211\u7684cnblogs\u535a\u5ba2](https://www.cnblogs.com/Dark-Romance/p/16811247.html)\n\n[link](https://www.luogu.com.cn/problem/AT_agc031_f)\n# Solution\n\u975e\u5e38\u5389\u5bb3\u7684\u9898\u634f\uff0c\u53ef\u60dc\u6211\u4ec0\u4e48\u90fd\u60f3\u4e0d\u5230/kk\n\n\u6211\u4eec\u9996\u5148\u8f6c\u5316\u4e00\u4e0b\uff0c\u6211\u4eec\u5bf9\u4e8e $s\\to t$ \u8ba1\u7b97\u8fd9\u4e2a\u957f\u5ea6\u53d8\u4e3a $t\\to s$ \u6bcf\u6b21\u52a0\u5165\u4e00\u4e2a $w$\uff0c\u5f53\u524d\u6743\u503c $x$ \u5c31\u53d8\u4e3a $2x+w$\u3002\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u5728\u4e4e\u957f\u5ea6\u4e86\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u66b4\u529b\u8bbe\u8ba1\u72b6\u6001 $(u,x)$ \u8868\u793a\u5230\u4e86\u70b9 $u$ \u5f53\u524d\u957f\u5ea6\u4e3a $x$\uff0c\u90a3\u4e48\u6211\u4eec\u7684\u66b4\u529b\u7684\u505a\u6cd5\u5c31\u662f\u5bf9\u4e8e\u8fd9\u4e2a\u72b6\u6001\u66b4\u529b\u5e76\u67e5\u96c6\uff0c\u6700\u540e\u5bf9\u4e8e $s\\to t$ \u8981\u6c42\u957f\u5ea6\u4e3a $r$ \u7684\u5224\u65ad\u5224\u65ad\u5c31\u662f\u662f\u5426 $(t,0)$ \u4e0e $(s,r)$ \u8fde\u901a\u5373\u53ef\u3002\u663e\u7136\u65e0\u6cd5\u901a\u8fc7\uff0c\u6211\u4eec\u8003\u8651\u4ed4\u7ec6\u89c2\u5bdf\u6027\u8d28\u3002\n\n---\n\n\n1.\u5982\u679c $(u,x)\\to (v,y)$\uff0c\u90a3\u4e48\u6211\u4eec\u540c\u6837\u5b58\u5728 $(v,y)\\to (u,x)$\u3002\n\n\u5047\u8bbe\u6211\u4eec\u662f $u\\to v$ \u95f4\u5b58\u5728\u4e00\u4e2a\u771f\u5b9e\u957f\u5ea6\u4e3a $l$\uff0c\u503c\u4e3a $w$ \u7684\u8fb9\uff0c\u90a3\u4e48\u6211\u4eec\u5b58\u5728 $y=x2^l+w$\uff0c\u90a3\u4e48\u6211\u4eec\u8003\u8651\u6765\u56de\u8d70\u8fd9\u6761\u8def\u5f84 $t$ \u6b21\uff0c\u90a3\u4e48\u503c\u5373\u662f $x2^{tl}+w(\\frac{2^{tl}-1}{2^l-1})$\uff0c\u8fd9\u6837\u7684\u8bdd\u56e0\u4e3a\u6a21\u6570\u4e0d\u662f\u8d28\u6570\u4f3c\u4e4e\u6ca1\u6cd5\u8003\u8651\uff0c\u4f46\u662f\u8003\u8651\u5230\u6211\u4eec\u7684\u8def\u5f84\u90fd\u662f\u957f\u5ea6\u4e3a $1$ \u7684\u8fb9\u6784\u6210\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u59a8\u8003\u8651 $l=1$\uff0c\u53ef\u4ee5\u53d1\u73b0 $t=2\\varphi(p)$ \u7684\u65f6\u5019\u6211\u4eec\u662f\u6ee1\u8db3\u6761\u4ef6\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8bc1\u660e\u8be5\u6027\u8d28\u3002\n\n\u4e3a\u4e86\u65b9\u4fbf\uff0c\u6211\u4eec\u4e0b\u9762\u7528 $(u,x)\\leftrightarrow (v,y)$ \u6765\u8868\u793a\u8fd9\u79cd\u5173\u7cfb\u3002\n\n---\n\n2.\u5982\u679c\u56fe\u4e2d\u5b58\u5728\u4e24\u6761\u8fb9\u6743\u503c\u5206\u522b\u4e3a $a,b$\uff0c\u90a3\u4e48\u5b58\u5728 $(u,x)\\leftrightarrow (u,x+(a-b)\\times 3)$\u3002\n\n\u9996\u5148\u6211\u4eec\u5148\u8003\u8651 $u$ \u8fde\u51fa\u4e24\u6761\u6743\u503c\u4e3a $a,b$ \u7684\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u5982\u4e0b\u5173\u7cfb\u5f0f\uff1a\n\n$$(u,4x+3a)\\leftrightarrow (u,x)\\leftrightarrow (u,4x+3b)$$\n\n\u56e0\u4e3a $4$ \u5728 $\\mod p$ \u7684\u60c5\u51b5\u4e0b\u662f\u5b58\u5728\u9006\u5143\u7684\uff0c\u6240\u4ee5 $4x$ \u5176\u5b9e\u5728\u6a21 $p$ \u6761\u4ef6\u4e0b\u53ef\u4ee5\u8868\u8fbe\u4efb\u610f\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u63a8\u51fa\uff1a$(u,x)\\leftrightarrow (u,(a-b)\\times 3)$\u3002\n\n\u6211\u4eec\u8003\u8651 $u$ \u4e0e $v$ \u5b58\u5728\u8fde\u8fb9\u7684\u60c5\u51b5\uff0c\u5047\u8bbe $u,v$ \u8fde\u8fb9\u6743\u503c\u4e3a $w$\uff0c\u90a3\u4e48\u6211\u4eec\u8d70 $t$ \u6b21\u7684\u8bdd\u5c31\u5b58\u5728\uff1a$(u,x)\\leftrightarrow (v,x2^t+w(2^t-1))$ \uff0c\u53d6 $t=\\varphi(p)$\uff0c\u53ef\u4ee5\u53d1\u73b0 $(u,x)\\leftrightarrow (v,x)$\u3002\n\n\u6709\u4e86\u4ee5\u4e0a\u4e24\u4e2a\u6761\u4ef6\uff0c\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u4e0d\u65ad\u62d3\u5c55\u5c31\u53ef\u4ee5\u5f97\u5230\u8be5\u6027\u8d28\u3002\n\n---\n\n\u6709\u4e86\u4e0a\u9762\u7684\u4e24\u4e2a\u6027\u8d28\u4ee5\u53ca\u88f4\u8700\u5b9a\u7406\uff0c\u6211\u4eec\u5176\u5b9e\u53ef\u4ee5\u53d1\u73b0\uff08$w_i$ \u662f\u7b2c $i$ \u6761\u8fb9\u7684\u8fb9\u6743\uff08\u957f\u5ea6\uff09\uff09\uff0c\u5982\u679c\u8bbe $g=\\gcd(w_i-w_j),i\\not= j$\uff0c\u90a3\u4e48 $(u,x) \\leftrightarrow (u,y)$ \u5f53\u4e14\u4ec5\u5f53 $x\\equiv y\\pmod {\\gcd(3g,p)}$\uff0c\u6240\u4ee5\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u628a $p\\to \\gcd(3g,p)$\u3002\u90a3\u4e48\u53ef\u4ee5\u53d1\u73b0\u6bcf\u4e00\u4e2a $w_i$ \u90fd\u53ef\u4ee5\u8868\u793a\u4e3a $tg+z,t\\in \\mathbb{Z}$ \u7684\u5f62\u5f0f\u3002\n\n\u6211\u4eec\u53d1\u73b0\uff0c\u5982\u679c\u628a $w_i$ \u90fd\u51cf\u53bb $z$\uff0c\u90a3\u4e48\u53ef\u4ee5\u6ee1\u8db3\u90fd\u662f $g$ \u7684\u500d\u6570\uff0c\u540c\u65f6\u5982\u679c\u6211\u4eec\u8bbe $(u,x+z)^{'}=(u,x)$\uff0c\u90a3\u4e48\u5bf9\u4e8e\u4e00\u6761\u8fb9 $w$\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff1a$(u,x+z)^{'}\\leftrightarrow (v,2(x+z)+w-z)^{'}=(v,2x+w+z)^{'}$\uff0c\u6240\u4ee5\u5c31\u8ddf\u539f\u6765\u7684\u8f6c\u79fb\u76f8\u540c\u4e86\u3002\n\n\u540c\u65f6\u6211\u4eec\u89c2\u5bdf\u6700\u540e\u7684\u67e5\u8be2\u5f62\u5f0f\uff0c\u53d1\u73b0\u73b0\u5728\u5c31\u662f\u67e5\u8be2 $(t,z)^{'}$ \u4e0e $(s,r+z)^{'}$ \u662f\u5426\u8fde\u901a\u4e86\u3002\u6211\u4eec\u89c2\u5bdf\u6211\u4eec\u7684\u8f6c\u79fb\uff0c\u53d1\u73b0\u662f $x\\to 2x+w$ \u7684\u5f62\u5f0f\uff0c\u800c\u6211\u4eec\u73b0\u5728 $w$ \u90fd\u662f $g$ \u7684\u500d\u6570\uff0c\u800c\u6211\u4eec\u7684 $p$ \u81f3\u591a\u662f $3g$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u6211\u4eec\u6240\u6709\u9700\u8981\u7684 $x$ \u90fd\u53ef\u4ee5\u8868\u793a\u4e3a $z2^{2r+i}+jg,i\\in \\mathbb{Z},j\\in \\{0,1,2\\}$\u3002\u800c\u6211\u4eec\u5bf9\u4e8e $u\\to v$ \u7684\u6743\u503c\u4e3a $w$ \u7684\u8fb9\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff1a$(u,x)\\leftrightarrow (u,4x+3w)\\leftrightarrow (u,4x)$\uff0c\u4e5f\u5c31\u662f $2$ \u7684\u6307\u6570\u5947\u5076\u6027\u76f8\u540c\u65f6\u662f\u53ef\u8fbe\u7684\u3002\u6240\u4ee5\u5176\u5b9e\u6211\u4eec\u53ea\u9700\u8981\u8bb0\u5f55 $z2^i+jg$ \u8fd9\u79cd\u5f62\u5f0f\u3002\u6240\u4ee5\u53ea\u6709 $\\Theta(6n)$ \u4e2a\u72b6\u6001\u3002\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u53ef\u4ee5\u66b4\u529b\u8dd1\u5e76\u67e5\u96c6\u4e86\uff0c\u7136\u540e\u5224\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n---\n\n\u590d\u6742\u5ea6 $\\Theta(n\\log n)$\uff0c\u74f6\u9888\u5728\u4e8e\u5e76\u67e5\u96c6\u3002\n# Code\n```cpp\n#include <bits/stdc++.h>\nusing namespace std;\n\n#define Int register int\n#define MAXN 1000005\n\ntemplate <typename T> inline void read (T &t){t = 0;char c = getchar();int f = 1;while (c < '0' || c > '9'){if (c == '-') f = -f;c = getchar();}while (c >= '0' && c <= '9'){t = (t << 3) + (t << 1) + c - '0';c = getchar();} t *= f;}\ntemplate <typename T,typename ... Args> inline void read (T &t,Args&... args){read (t);read (args...);}\ntemplate <typename T> inline void write (T x){if (x < 0){x = -x;putchar ('-');}if (x > 9) write (x / 10);putchar (x % 10 + '0');}\ntemplate <typename T> inline void chkmax (T &a,T b){a = max (a,b);}\ntemplate <typename T> inline void chkmin (T &a,T b){a = min (a,b);}\n\nint n,m,T,mod,tot,fa[MAXN * 6],ind[MAXN][2][3],vis[2][MAXN];//ind[u][0/1][0/1/2]\u8868\u793au\u70b92^{0/1}*x+g*(0/1/2)\nint findSet (int x){return fa[x] == x ? x : fa[x] = findSet (fa[x]);}\nvoid unionSet (int u,int v){fa[findSet (u)] = findSet (v);}\nbool checkit (int u,int v){return findSet (u) == findSet (v);}\n\nstruct edge{\n\tint u,v,w;\n\tbool operator < (const edge &p)const{return w < p.w;}\n}seq[MAXN];\n\nsigned main(){\n\tread (n,m,T,mod);\n\tfor (Int u = 1;u <= n;++ u)\n\t\tfor (Int p = 0;p < 2;++ p)\n\t\t\tfor (Int q = 0;q < 3;++ q) ind[u][p][q] = ++ tot;\n\tfor (Int u = 1;u <= tot;++ u) fa[u] = u;\n\tfor (Int i = 1;i <= m;++ i) read (seq[i].u,seq[i].v,seq[i].w);\n\tsort (seq + 1,seq + m + 1);int g = mod,z;\n\tfor (Int i = 2;i <= m;++ i) g = __gcd (g,seq[i].w - seq[i - 1].w);\n\tz = seq[1].w % g;for (Int i = 1;i <= m;++ i) seq[i].w = (seq[i].w - z) / g,seq[i].w %= 3;\n\tmod = __gcd (3 * g,mod);\n\tfor (Int i = 1;i <= m;++ i){\n\t\tint u = seq[i].u,v = seq[i].v,w = seq[i].w;\n\t\tfor (Int p = 0;p < 2;++ p)\n\t\t\tfor (Int q = 0;q < 3;++ q){\n\t\t\t\tunionSet (ind[u][p][q],ind[v][p ^ 1][(q * 2 + w) % 3]);\n\t\t\t\tunionSet (ind[v][p][q],ind[u][p ^ 1][(q * 2 + w) % 3]);\n\t\t\t}\n\t}\n\tfor (Int i = 0,now = z;i < mod;++ i,now = now * 2 % mod) vis[i & 1][now] = 1;\n\tfor (Int i = 1;i <= T;++ i){\n\t\tint u,v,r;read (u,v,r);swap (u,v);\n\t\tfor (Int p = 0;p < 2;++ p)\n\t\t\tfor (Int q = 0;q < 3;++ q) if (checkit (ind[u][0][0],ind[v][p][q]) && vis[p][(r + z - g * q % mod + mod) % mod]){\n\t\t\t\tputs (\"YES\");\n\t\t\t\tgoto there;\n\t\t\t}\n\t\tputs (\"NO\");\n\t\tthere:;\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1666270376,
        "uid": 124781,
        "name": "Walking_Dead",
        "ccfLevel": 0,
        "title": "1\uff015\uff01"
    }
]