[
    {
        "content": "%\u4f60\u8d5b\u9047\u5230\u7684\u9898\uff0c\u5f88\u6709\u610f\u601d\u3002\n\n![](https://i.loli.net/2021/11/22/6B5fwnq3iAkahJC.png)\n\n\u8fd9\u5f20\u56fe\u5c31\u662f\u5206\u7c7b\u8ba8\u8bba\u5168\u90e8\u7684\u60c5\u51b5\u4e2d\uff0c\u53d1\u73b0\u8def\u7ebf\u6700\u591a\u53ea\u53ef\u80fd\u62d0\u4e2a\u5f2f\u3002\n\n\u4e5f\u5c31\u662f\u6700\u4f18\u8def\u5f84\u53ea\u548c\u8ddd\u79bb\u8d77\u70b9\u7ec8\u70b9\u56db\u4e2a\u65b9\u5411\u6700\u8fd1\u7684\u4e24\u6761\u8fb9\u6709\u5173\u7cfb\uff08\u4e00\u5171 $16$ \u6761\u8fb9\uff09\uff0c\u5bf9\u4e8e\u6bcf\u6b21 $q$ \u67e5\u8be2\uff0c\u628a\u4ea4\u70b9\u62a0\u51fa\u6765\uff0c\u8dd1\u6700\u77ed\u8def\u5373\u53ef\u3002\n\n\u7a0b\u5e8f\u5982\u4e0b\uff1a\n\n\n```cpp\n#include<iostream>\n#include<algorithm>\n#include<queue>\n#include<set>\nusing namespace std;\nconst int N=2e5+10,mod=1e9+7;\nint n,m,q,Ans,HH[N],ZZ[N],dis[N],vis[N];\nchar s[N],t[N];\nset<int> H[2],Z[2];\nqueue<int> Q;\nstruct Node{int x,y;}P[N];\nvoid GetAns(int x1,int y1,int x2,int y2)\n{\n\tint ch=0,cz=0,c=0;\n\tset<int>::iterator it;\n\tfor(int i=0;i<2;i++)\n\t{\n\t\tit=H[i].lower_bound(x1);\n\t\tif(it!=H[i].end()) HH[++ch]=*it;\n\t\tif(it!=H[i].begin()) HH[++ch]=*(--it);\n\t\tit=H[i].lower_bound(x2);\n\t\tif(it!=H[i].end()) HH[++ch]=*it;\n\t\tif(it!=H[i].begin()) HH[++ch]=*(--it);\n\n\t\tit=Z[i].lower_bound(y1);\n\t\tif(it!=Z[i].end()) ZZ[++cz]=*it;\n\t\tif(it!=Z[i].begin()) ZZ[++cz]=*(--it);\n\t\tit=Z[i].lower_bound(y2);\n\t\tif(it!=Z[i].end()) ZZ[++cz]=*it;\n\t\tif(it!=Z[i].begin()) ZZ[++cz]=*(--it);\n\t}\n\tsort(HH+1,HH+ch+1);\n\tch=unique(HH+1,HH+ch+1)-HH-1;\n\tsort(ZZ+1,ZZ+cz+1);\n\tcz=unique(ZZ+1,ZZ+cz+1)-ZZ-1;\n\t\n\tfor(int i=1;i<=ch;i++)\n\t\tfor(int j=1;j<=cz;j++)\n\t\t\tP[++c]=(Node){HH[i],ZZ[j]};\n\tfor(int i=1;i<=c;i++)\n\t\tif(P[i].x==x1&&P[i].y==y1)\n\t\t\tdis[i]=0,Q.push(i),vis[i]=1;\n\t\telse dis[i]=1e9;\n\twhile(!Q.empty())\n\t{\n\t\tint x=Q.front();\n\t\tfor(int i=1;i<=c;i++)\n\t\t{\n\t\t\tif(P[i].x!=P[x].x&&P[i].y!=P[x].y) continue;\n\t\t\tif(P[i].x==P[x].x)\n\t\t\t{\n\t\t\t\tif(P[i].y>P[x].y&&s[P[i].x]=='W') continue;\n\t\t\t\tif(P[i].y<P[x].y&&s[P[i].x]=='E') continue;\n\t\t\t}\n\t\t\tif(P[i].y==P[x].y)\n\t\t\t{\n\t\t\t\tif(P[i].x>P[x].x&&t[P[i].y]=='N') continue;\n\t\t\t\tif(P[i].x<P[x].x&&t[P[i].y]=='S') continue;\n\t\t\t}\n\t\t\tint val=dis[x]+abs(P[i].x-P[x].x)+abs(P[i].y-P[x].y);\n\t\t\tif(dis[i]<=val) continue;\n\t\t\tdis[i]=val;\n\t\t\tif(!vis[i]) Q.push(i),vis[i]=1;\n\t\t}\n\t\tQ.pop(),vis[x]=0;\n\t}\n\tfor(int i=1;i<=c;i++)\n\t\tif(P[i].x==x2&&P[i].y==y2)\n\t\t\tAns=dis[i];\n}\nint main()\n{\n\tscanf(\"%d%d%d%s%s\",&n,&m,&q,s+1,t+1);\n\tfor(int i=1;i<=n;i++)\n\t\tif(s[i]=='E') H[1].insert(i);\n\t\telse H[0].insert(i);\n\tfor(int i=1;i<=m;i++)\n\t\tif(t[i]=='N') Z[1].insert(i);\n\t\telse Z[0].insert(i);\n\tfor(int i=1,x1,y1,x2,y2;i<=q;i++)\n\t{\n\t\tcin>>x1>>y1>>x2>>y2;\n\t\tGetAns(x1,y1,x2,y2);\n\t\tif(Ans==1e9) puts(\"-1\");\n\t\telse printf(\"%d\\n\",Ans);\n\t}\n\treturn 0;\n}\n```\n\n\u6216\u8005\u8fd9\u4e2a\u751f\u8349\u4e8c\u5206\uff1a\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\nvector<int> N, W, E, S;\nint get(vector<int> &A, int x, int ps)\n{\n\tif(!A.size())\n\t\treturn 1;\n\tint l = 0, r = A.size() - 1, ret = 0;\n\tif(ps == 1)\n\t{\n\t\tret = r;\n\t\twhile(l <= r)\n\t\t{\n\t\t\tint mid = (l + r) / 2;\n\t\t\tif(A[mid] >= x)\n\t\t\t{\n\t\t\t\tret = mid, r = mid - 1;\n\t\t\t}\n\t\t\telse \n\t\t\t\tl = mid + 1;\n\t\t}\n\t}\n\telse\n\t{\n\t\twhile(l <= r)\n\t\t{\n\t\t\tint mid = (l + r) / 2;\n\t\t\tif(A[mid] <= x)\n\t\t\t{\n\t\t\t\tret = mid;\n\t\t\t\tl = mid + 1;\t\n\t\t\t}\n\t\t\telse \n\t\t\t\tr = mid - 1;\n\t\t}\t\n\t}\n\treturn A[ret];\n}//\u4e8c\u5206\nint n, m, q, bh[20][20], tot, cnt, h[100], dis[200];\nchar dS[100100], dT[100100];\nstruct Line\n{\n\tint v, next, w;\n}e[1000];\n\nbool vis[200];\ninline void addedge(int u, int v, int w)\n{\n\te[cnt] = (Line){v, h[u], w};\n\th[u] = cnt++;\n}\n\nint spfa(int s, int t)\n{\n\tfor(int i = 1; i <= tot; i++)\n\t{\n\t\tdis[i] = 1e9;\n\t\tvis[i] = 0;\n\t}\n\tqueue<int> q;\n\tq.push(s);\n\tdis[s] = 0;\n\tvis[s] = 1;\n\twhile(!q.empty())\n\t{\n\t\tint u = q.front();\n\t\tq.pop();\n\t\tfor(int i = h[u]; i; i = e[i].next)\n\t\t\tif(dis[e[i].v] > dis[u] + e[i].w)\n\t\t\t{\n\t\t\t\tdis[e[i].v] = dis[u] + e[i].w;\n\t\t\t\tif(!vis[e[i].v])\n\t\t\t\t{\n\t\t\t\t\tvis[e[i].v] = 1;\n\t\t\t\t\tq.push(e[i].v);\n\t\t\t\t}\n\t\t\t}\n\t\tvis[u] = 0;\n\t}\n\treturn dis[t];\n}\nint main()\n{\n\tcin >> n >> m >> q;\n\tscanf(\"%s\", dS + 1);\n\tscanf(\"%s\", dT + 1);\n\tfor(int i = 1; i <= n; i++)\n\t\tif(dS[i] == 'E')\n\t\t\tE.push_back(i);\n\t\telse \n\t\t\tW.push_back(i);\n\tfor(int i = 1; i <= m; i++)\n\t\tif(dT[i] == 'N')\n\t\t\tN.push_back(i);\n\t\telse \n\t\t\tS.push_back(i);\n\twhile(q--)\n\t{\n\t\tint a, b, c, d;\n\t\tcin >> a >> b >> c >> d;\n\t\tvector<int> x, y;\n\t\tx.push_back(get(E, a, 0));\n\t\tx.push_back(get(W, a, 0));\n\t\tx.push_back(get(E, a, 1));\n\t\tx.push_back(get(W, a, 1));\n\t\tx.push_back(get(E, c, 0));\n\t\tx.push_back(get(W, c, 0));\n\t\tx.push_back(get(E, c, 1));\n\t\tx.push_back(get(W, c, 1));\n\t\ty.push_back(get(N, b, 0));\n\t\ty.push_back(get(S, b, 0));\n\t\ty.push_back(get(N, b, 1));\n\t\ty.push_back(get(S, b, 1));\n\t\ty.push_back(get(N, d, 0));\n\t\ty.push_back(get(S, d, 0));\n\t\ty.push_back(get(N, d, 1));\n\t\ty.push_back(get(S, d, 1));\n\t\tsort(x.begin(), x.end());\n\t\tx.resize(unique(x.begin(), x.end()) - x.begin());\n\t\tsort(y.begin(), y.end());\n\t\ty.resize(unique(y.begin(), y.end()) - y.begin());\n\t\tint lx = x.size(), ly = y.size();\n\t\tint s, t; \n\t\ttot = 0;\n\t\tfor(int i = 0; i < lx; i++)\n\t\t\tfor(int j = 0; j < ly; j++)\n\t\t\t{\n\t\t\t\tbh[i][j] = ++tot;\n\t\t\t\tif(x[i] == a && y[j] == b)\n\t\t\t\t\ts = tot;\n\t\t\t\tif(x[i] == c && y[j] == d)\n\t\t\t\t\tt = tot;\n\t\t\t}\n\t\tfor(int i = 1; i <= tot; i++)\n\t\t{\n\t\t\th[i] = 0;\n\t\t\tcnt = 2;\t\n\t\t}\n\t\tfor(int i = 0; i < lx; i++)\n\t\t\tif(dS[x[i]] == 'E')\n\t\t\t\tfor(int j = 0; j < ly - 1; j++)\n\t\t\t\t\taddedge(bh[i][j], bh[i][j + 1], y[j + 1] - y[j]);\n\t\t\telse \n\t\t\t\tfor(int j = 1; j < ly; j++)\n\t\t\t\t\taddedge(bh[i][j], bh[i][j - 1], y[j] - y[j - 1]);\n\t\tfor(int i = 0; i < ly; i++)\n\t\t\tif(dT[y[i]] == 'N')\n\t\t\t\tfor(int j = 1; j < lx; j++)\n\t\t\t\t\taddedge(bh[j][i], bh[j - 1][i], x[j] - x[j - 1]);\n\t\t\telse \n\t\t\t\tfor(int j = 0; j < lx - 1; j++)\n\t\t\t\t\taddedge(bh[j][i], bh[j + 1][i], x[j + 1] - x[j]);\n      \t\tif(spfa(s, t) == 1e9)\n      \t\t\tcout << -1 << endl;\n      \t\telse\n\t\t\tprintf(\"%d\\n\", spfa(s, t));\n\t}\n}\n```",
        "postTime": 1649588469,
        "uid": 388834,
        "name": "Rhapsodia",
        "ccfLevel": 0,
        "title": "\u9898\u89e3"
    }
]