[
    {
        "content": "## AT3972 [AGC026C] String Coloring\n\n[[Statement]](https://www.luogu.com.cn/problem/AT3972)\n\nDate: Apr. 14th\n\n---\n#### \u9898\u610f\uff1a\n\u7ed9\u5b9a\u4e00\u4e2a\u957f\u5ea6\u4e3a $2n$ \u7684\u5b57\u7b26\u4e32 $S$\uff0c\u5bf9\u6bcf\u4e00\u4e2a\u5b57\u7b26\u7ea2\u84dd\u67d3\u8272\uff0c\u5c06\u540c\u8272\u7684\u5b57\u7b26\u8fde\u63a5\u6210\u65b0\u7684\u5b57\u7b26\u4e32\uff0c\u6c42\u6700\u540e\u4f7f\u5f97 \u7ea2\u4e32 \u548c \u7ffb\u8f6c\u540e\u7684\u84dd\u4e32 \u76f8\u540c\u7684\u67d3\u8272\u65b9\u6848\u6570\u3002\n\n\u9650\u5236\uff1a$n \\le 18$\n    \n---\n#### \u5206\u6790\uff1a\n\u6bd4\u8f83\u660e\u663e\u7684\u6298\u534a\u641c\u7d22\u3002\n\n\u8bb0\u524d\u534a\u6bb5\u4e3a $A$\uff0c \u540e\u534a\u6bb5\u4e3a $B$\uff0c\u7ea2\u8272\u7528 $S_r$\u3001\u84dd\u8272\u7528 $S_b$ \u8868\u793a\uff0c**$S'$  \u8868\u793a $S$ \u7ffb\u8f6c\u540e\u7684\u5b57\u7b26\u4e32**\u3002\n\n\u6839\u636e\u9898\u610f\u6709\u5982\u4e0b\u5173\u7cfb\uff1a\n$$\n\\begin{aligned}\n& |A| =  |B| = n\\\\\n& |A|=|A_r| + |A_b|\\\\\n& |B|=|B_r| + |B_b|\n\\end{aligned}\n$$\n\u800c\u7ea2\u4e32\u548c\u84dd\u4e32\u6700\u7ec8\u7ffb\u8f6c\u540e\u76f8\u540c\uff0c\u6240\u4ee5\u6709 $|A_r| + |B_r| = |A_b| + |B_b|$ \u4e14 $A_r + B_r = (A_b + B_b)'$\u3002\n\n\u7a0d\u5fae\u6539\u5199\u4e00\u4e0b\uff1a\n$$\n\\begin{aligned}\n& |A_r| + |B| - |B_b|  =  |A| - |A_r| + |B_b|\\\\\n& \\Rightarrow |A_r| - |B_b| = |B_b| - |A_r|\\\\\n& \\Rightarrow |A_r| = |B_b|\n\\end{aligned}\n$$\n\u540c\u7406\uff0c$|A_b| = |B_r|$\u3002\n\n\u4e8e\u662f\u6709\uff1a\n\n$\\because A_r + B_r = (A_b + B_b)'\uff0c|A_r| = |B_b|, |A_b| = |B_b|$\n\n$\\therefore A_r = B_b', A_b = B_r' $ \n\n\u5373 **$A$ \u4e2d\u7684\u7ea2\u4e32 = $B$ \u4e2d\u7684\u84dd\u4e32\u7684\u53cd\u4e32** \u4e14 **$A$ \u4e2d\u7684\u84dd\u4e32 = $B$ \u4e2d\u7684\u7ea2\u4e32\u7684\u53cd\u4e32\u3002**\n\n(\u8fd9\u4e2a\u7ed3\u8bba\u975e\u5e38\u7b26\u5408\u76f4\u89c9\uff0c\u53ef\u80fd\u4e00\u773c\u5c31\u80fd\u731c\u5230\uff0c\u8fd9\u91cc\u4e25\u8c28\u8bc1\u660e\u4e00\u4e0b\u3002)\n\n\n---\n\u6613\u5f97\u6298\u534a\u641c\u7d22\u7684\u65b9\u6cd5\uff1a\n\n- \u6211\u4eec\u5bf9 A \u4e32\u6b63\u7740\u641c\uff0c\u8bb0\u5f55 $A_r, A_b$ \u7684 Hash\uff1b$B$ \u4e32\u53cd\u7740\u641c\uff0c\u8bb0\u5f55 $B_r', B_b'$ \u7684 Hash\u3002\n\n- \u82e5 $A_r = B_b'\\ \\text{and}\\ A_b = B_r'$ \uff0c\u5c31\u53ef\u4ee5\u5c06 $A_r, A_b$ \u7684\u8d21\u732e\u52a0\u5165\u7b54\u6848\u4e00\u6b21\u3002\n\n---\n#### Code\uff1a\n\u5b9e\u9645\u5199\u6298\u534a\u641c\u7d22\u7684\u65f6\u5019\uff0c\u4e0d\u7528\u6839\u636e\u65b9\u5411\u5206\u7c7b\u8ba8\u8bba\u989c\u8272\u5173\u7cfb\u3002\n\n\u56e0\u4e3a\u4e00\u79cd\u5408\u6cd5\u7684\u67d3\u8272\u65b9\u6848\u4e2d\uff0c\u5c06\u7ea2\u84dd\u5bf9\u8c03\uff0c\u4e5f\u662f\u4e00\u79cd\u5408\u6cd5\u7684\u65b9\u6848\u3002\u6240\u6709\u7ea2\u84dd\u67d3\u8272\u7684\u65b9\u6848\u4e00\u5b9a\u662f\"\u5bf9\u79f0\"\u7684\u3002\n\n\u633a\u5c0f\u6e05\u65b0\u7684 AT \u9898\u3002\n```cpp\n#include <bits/stdc++.h>\n\ntemplate<class _Tp = int> _Tp read() {\n  _Tp w = 0;\n  bool f = 0;\n  char ch = getchar();\n  while (!isdigit(ch)) f |= ch == '-', ch = getchar();\n  while (isdigit(ch)) w = (w << 3) + (w << 1) + (ch ^ 48), ch = getchar();\n  return f ? -w : w;\n}\ntypedef long long ll;\nconst int kMaxN = 18 + 1;\nstd::map<std::pair<ll, ll>, int> map;\n\nint n;\nll ans;\nchar s[kMaxN << 1];\n\nll shift(ll hs, char c) {\n  static int base = 29, mod = 1019260817;\n  return (hs * base + c - 'a' + 1) % mod;\n}\nvoid dfs(int x, ll hs1, ll hs2, int d) {\n  if (d == 1 && x > n) {\n    map[std::make_pair(hs1, hs2)]++;\n    return;\n  } \n  if (d == -1 && x <= n) {\n    ans += map[std::make_pair(hs1, hs2)];\n    return;\n  }\n  dfs(x + d, shift(hs1, s[x]), hs2, d);\n  dfs(x + d, hs1, shift(hs2, s[x]), d);\n}\n\nint main() {\n  n = read();\n  scanf(\"%s\", s + 1);\n  dfs(1, 0, 0, 1);\n  dfs(n << 1, 0, 0, -1);\n  std::cout << ans << std::endl;\n  return 0;\n}\n```\n\n---\n**END.**",
        "postTime": 1618371270,
        "uid": 87329,
        "name": "Ezio__Auditore",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 AT3972 [AGC026C] String Coloring"
    },
    {
        "content": "\u5b89\u5229\u4e2a\u4eba[blog](https://www.cnblogs.com/Guts/p/14655127.html)\n\n\n------------\n\n~~\u8fd9\u9898\u633a\u7b80\u5355\u7684\uff0c\u5c31\u662f\u6709\u70b9\u96be~~  \n\u8fd9\u9898\u90fd\u5feb\u628a\u6298\u534a\u641c\u7d22\u5199\u5728\u9898\u9762\u91cc\u4e86\uff0c\u8003\u8651\u5982\u4f55\u6298\u534a\u3002  \n\n\u5982\u679c\u524d\u534a\u90e8\u5206\u641c\u51fa\u6765\u7684\u4e24\u79cd\u989c\u8272\u5b57\u7b26\u4e32\u54c8\u5e0c\u503c\u662f $(x_l,y_l)$ \uff0c\u540e\u534a\u90e8\u5206\u641c\u51fa\u6765\u662f $(x_r,y_r)$\uff0c\u54c8\u5e0c\u7684\u5e95\u662f $D$ \uff0c\u90a3\u4e48\u8fd9\u4e24\u4e2a\u80fd\u5339\u914d\u8d77\u6765\u7684\u6761\u4ef6\u662f\uff1a  \n$\n\\begin{aligned}\nx_l+D^n x_r&=y_r+D^n y_l\\\\\nx_l+D^n y_l&=y_r -D^n x_r\\\\\n\\end{aligned}\n$\n\n\u5230\u8fd9\u4e00\u6b65\u5c31\u4e0d\u7528\u591a\u89e3\u91ca\u4e86\uff0c\u76f4\u63a5\u4e0amap\u3002  \n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n2^n)$\u3002    \n\n\n_Code_\n------------\n```cpp\n\n#include<bits/stdc++.h>\nusing namespace std;\n#define il inline\n#define ri register int\n#define ll long long\n#define ui unsigned int\nil ll read(){\n    bool f=true;ll x=0;\n    register char ch=getchar();\n    while(ch<'0'||ch>'9') {if(ch=='-') f=false;ch=getchar();}\n    while(ch>='0'&&ch<='9') x=(x<<3)+(x<<1)+(ch^48),ch=getchar();\n    if(f) return x;\n    return ~(--x);\n}\nil void write(const ll &x){if(x>9) write(x/10);putchar(x%10+'0');}\nil void print(const ll &x) {x<0?putchar('-'),write(~(x-1)):write(x);putchar('\\n');}\nil ll max(const ll &a,const ll &b){return a>b?a:b;}\nil ll min(const ll &a,const ll &b){return a<b?a:b;}\nchar s[40];\nint n;\nconst ll mod1=998244353,mod2=1e9+7,d=131;  \nstruct node\n{\n    ll x,y;\n    bool operator==(const node &p)const{\n        return x==p.x&&y==p.y;\n    }\n    ll operator %(const ll &p)const{\n        return x*y%p;\n    }\n    node operator *(const node &p)const{\n        return (node){x*p.x%mod1,y*p.y%mod2};\n    }\n    node operator +(const node &p)const{\n        return (node){(x+p.x)%mod1,(y+p.y)%mod2};\n    }\n    node operator -(const node &p)const{\n        return (node){(x-p.x+mod1)%mod1,(y-p.y+mod2)%mod2};\n    }\n}B,D;\nstruct hmap{\n    static const int P=2e6+3,M=3e7+10;\n    int hed[M],nxt[M],cnt;node val[M];ll as[M];\n    bool count(node x){\n        int c=hed[x%P];\n        while(c){\n            if(val[c]==x) return 1;\n            c=nxt[c];\n        }return 0;\n    }\n    ll& operator [](node x){\n        int c=hed[x%P];\n        while(c){\n            if(val[c]==x) return as[c];\n            c=nxt[c];\n        }\n        ++cnt;val[cnt]=x;nxt[cnt]=hed[x%P];hed[x%P]=cnt;\n        return as[cnt];\n    }\n    int size(){return cnt;}\n}f;\n#define T pair<node,node> \nll base[42],ans;\nT solve(ll x){\n    node l=(node){0,0},r=(node){0,0};\n    for(ri i=0;i<n;++i){\n        if(base[i]&x){\n            l=l*D;\n            l=l+(node){s[i],s[i]};\n        }\n    }\n    for(ri i=n-1;~i;--i){\n        if(!(base[i]&x)){\n            r=r*D;\n            r=r+(node){s[i],s[i]};\n        }\n    }\n    return (T){l,r};\n}\nint main(){\n    n=read();\n    scanf(\"%s\",s);\n    D=B=(node){d,d};\n    base[0]=1;\n    for(ri i=1;i<=n;++i) B=B*D,base[i]=base[i-1]<<1;   \n    for(ri i=0;i<base[n];++i){\n        T now=solve(i);\n        f[now.first*B-now.second]++;\n    }\n    for(ri i=0;i<n;++i)s[i]=s[n+i];\n    for(ri i=0;i<base[n];++i){\n        T now=solve(i);\n        if(f.count(now.second*B-now.first))ans+=f[now.second*B-now.first];\n    }\n    print(ans);\n    return 0;\n}\n```",
        "postTime": 1618321493,
        "uid": 206998,
        "name": "Krimson",
        "ccfLevel": 0,
        "title": "AT3972 [AGC026C] String Coloring"
    }
]