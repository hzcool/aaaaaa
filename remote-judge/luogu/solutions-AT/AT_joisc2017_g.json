[
    {
        "content": "[\u957f\u9014\u5df4\u58eb](https://www.luogu.com.cn/problem/AT2539)\n\n> \u4ece\u65f6\u95f4 $0$ \u5f00\u59cb\uff0c\u5728\u65f6\u95f4 $X$ \u7ed3\u675f\uff0c\u4e00\u4e2a\u53f8\u673a\u548c $n$ \u4e2a\u4eba\u5728\u8fdb\u884c\u957f\u9014\u65c5\u884c\u3002\u4ed6\u4eec\u6709\u4e00\u4e2a\u5171\u540c\u7684\u5faa\u73af\u5468\u671f $T$\u3002\n>\n> \u6bcf\u4e2a\u4eba\u6709\u53c2\u6570 $D_i$\uff0c\u8868\u793a\u6bcf\u5230\u65f6\u95f4 $kT+D_i(k\\geq 0)$ \u4ed6\u5c31\u9700\u8981\u559d $1$ \u5355\u4f4d\u7684\u6c34\u3002\u5bf9\u4e8e\u53f8\u673a\uff0c\u4ed6\u7684 $D_i=0$\u3002\n>\n> \u4e2d\u9014\u6709 $m$ \u4e2a\u4f11\u606f\u7ad9\uff0c\u7b2c $i$ \u4e2a\u4f11\u606f\u7ad9\u5728\u65f6\u95f4 $s_i$ \u5230\u8fbe\u3002\n>\n> \u5728\u6bcf\u4e2a\u4f11\u606f\u7ad9\u90fd\u53ef\u4ee5\u8d2d\u4e70\u6c34\uff0c\u4e00\u5f00\u59cb\u7684\u6c34\u7bb1\u662f\u7a7a\u7684\uff0c\u8d77\u70b9\u4e5f\u53ef\u4ee5\u8d2d\u4e70\u6c34\u3002\u6240\u6709\u6c34\u7684\u4ef7\u683c\u90fd\u662f $W$ \u5143\u6bcf\u5355\u4f4d\u3002\n>\n> \u5982\u679c\u4e00\u4e2a\u4eba\u9700\u8981\u996e\u6c34\u65f6\u6c34\u7bb1\u662f\u7a7a\u7684\uff0c\u90a3\u4e48\u4ed6\u5c31\u4f1a\u4e0b\u8f66\uff0c\u53f8\u673a\u9700\u8981\u4ed8\u51fa $C_i$ \u7684\u4ee3\u4ef7\u9000\u94b1\u3002\n>\n> \u53f8\u673a\u4e00\u5b9a\u4e0d\u80fd\u4e0b\u8f66\u3002\n>\n> \u6c42\u6700\u4f18\u60c5\u51b5\u4e0b\uff0c\u5b8c\u6210\u8fd9\u8d9f\u65c5\u9014\u7684\u4fee\u5c0f\u4ee3\u4ef7\u3002\uff08\u5373 \u4e70\u6c34\u7684\u94b1 + \u9000\u4e0b\u8f66\u4eba\u7684\u94b1\uff09\n>\n> \u9898\u76ee\u826f\u5fc3\u7684\u4fdd\u8bc1\u4e86 $s,D$ \u5728$\\bmod T$ \u610f\u4e49\u4e0b\u5747\u4e0d\u91cd\u5408\u3002\n\n\u770b\u4e0a\u53bb\u975e\u5e38\u68d8\u624b\u7684\u95ee\u9898\uff0c\u5982\u679c\u6ca1\u6709\u57fa\u672c\u6027\u8d28\u7684\u53d1\u73b0\uff0c\u8fde\u591a\u9879\u5f0f\u65f6\u95f4\u7684\u89e3\u90fd\u6ca1\u6709\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5982\u679c\u8981\u8d76\u4eba\u4e0b\u8f66\uff0c\u90a3\u5c31\u5c3d\u65e9\u8d76\u8d70\u6bd4\u8f83\u597d\u3002\n\n\u6838\u5fc3\u6027\u8d28\uff1a**\u5982\u679c\u5c06\u4eba\u6309\u7167 $D_i$ \u5347\u5e8f\u6392\u5e8f\uff0c\u8d76\u8d70\u7684\u4eba\u4e00\u5b9a\u662f\u4e00\u6bb5\u8fde\u7eed\u7684\u533a\u95f4**\u3002\n\n\u5982\u679c\u6700\u540e\u8d76\u8d70\u7684\u662f\u7b2c $i$ \u4e2a\u4eba\uff0c\u90a3\u4e48\u4e00\u5b9a\u662f\u67d0\u4e24\u4e2a\u76f8\u90bb\u4f11\u606f\u7ad9 $a,b$ \u4e4b\u95f4\uff0c\u7b2c $i$ \u4e2a\u4eba\u662f\u6700\u540e\u4e00\u4e2a\u5728\u5230 $b$ \u4e4b\u524d\u8981\u6c34\u559d\u7684\u4eba\u3002\n\n\u7136\u540e\u4ed6\u4e4b\u524d\u7684\u90fd\u53ef\u4ee5\u9009\u62e9\u8d76\u4e0b\u8f66\u3002\n\n\u800c\u53f8\u673a\u7684 $D=T$ \u7684\u4f5c\u7528\uff0c\u5c31\u662f\u4fdd\u8bc1\u4e0d\u5b58\u5728 $[i,n]+[1,j]$ \u4e00\u6bb5\u7684\u4eba\u88ab\u8d76\u8d70\uff0c\u5373\u4fdd\u8bc1\u8f6c\u79fb\u4e0d\u6210\u73af\u3002\n\n\u65e2\u7136\u9898\u76ee\u6761\u4ef6\u8fd9\u4e48\u523b\u610f\uff0c\u90a3\u5927\u6982\u7387\u8fd9\u4e2a\u601d\u8def\u5c31\u662f\u5bf9\u7684\u4e86\uff0c\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u6765\u505a DP\u3002\n\n\u8bbe $f(i)$ \u8868\u793a\u8003\u8651\u4e86\u524d $i$ \u4e2a\u4eba\u7684\u6700\u5c0f\u8d39\u7528\uff0c\u6bcf\u6b21\u8f6c\u79fb\u6709\u4e24\u79cd\uff1a\n\n- $f(i)=f(i-1)+W(\\lfloor X/T \\rfloor+X\\bmod T\\geq D_i)$\u3002\u5373\u4fdd\u7559\u8fd9\u4e2a\u4eba\u5230\u6700\u540e\u3002\n\n- $\\displaystyle f(i)=\\min_{0\\leq j<i} f(j)+\\text{Sum}_i-\\text{Sum}_j+W(i-j)\\times \\text{Mn}_i$\u3002\n\n  \u5373\u628a $j$ **\u5f53\u4f5c**\u4e00\u4e2a\u4fdd\u7559\u7684\u4eba\u5212\u5206\uff08\u663e\u7136\u5982\u679c\u4ed6\u5728\u51b3\u7b56\u7684\u65f6\u5019\u88ab\u8d76\u4e0b\u8f66\u4e86\uff0c\u679a\u4e3e\u524d\u9762\u7684\u65f6\u5019\u4f1a\u679a\u4e3e\u5230\uff09\n\n  \u7136\u540e\u8003\u8651 $[j+1,i]$ \u5168\u5220\u7684\u4ee3\u4ef7\uff0c$\\text{Sum}$ \u662f $C$ \u7684\u524d\u7f00\u548c\uff0c\u5173\u952e\u662f $\\text{Mn}_i$ \u8868\u793a\u7684\u662f\u6700\u5c0f\u6ee1\u8db3\u5b83\u80fd\u88ab\u5220\u7684\u65f6\u95f4\u3002\n\n  \u5373 $\\displaystyle \\text{Mn}_i=\\min_{D_i< s_j\\bmod T<D_{i+1}} \\lfloor \\frac{s_j}{T}\\rfloor$\uff0c\u6700\u540e\u4e00\u6b21\u662f\u76f4\u63a5\u88ab\u8d76\u4e0b\u8f66\u7684\u4e0d\u7b97\u8d21\u732e\uff0c\u6240\u4ee5\u662f\u4e0b\u53d6\u6574\u3002\n\n\u7b2c\u4e00\u79cd\u76f4\u63a5\u8f6c\u79fb\uff0c\u7b2c\u4e8c\u79cd\u7ecf\u5178\u659c\u7387\u4f18\u5316\uff0c$\\text{Mn}_i$ \u53ea\u9700\u8981\u5c06 $s_i$ \u6309\u7167$\\bmod T$ \u5347\u5e8f\u6392\u5e8f\u5373\u53ef\u4e00\u4e2a\u6307\u9488\u626b\u4e00\u904d\u6c42\u51fa\u3002\n\n```cpp\ntypedef pair<LL, LL> PLL;\n#define fi first\n#define se second\n#define MP make_pair\n\nconst int N = 2e5 + 10;\nconst LL INF = 1e18;\nint n, m;\nLL T, X, W, sum[N], f[N];\nPLL a[N], s[N];\n\nint stk[N], top;\nLL idx[N], idy[N];\n\nvoid Insert(int i) {\n\twhile(top > 1 &&  (idy[i] - idy[stk[top]]) * (idx[stk[top]] - idx[stk[top - 1]])\n\t\t\t\t   <= (idy[stk[top]] - idy[stk[top - 1]]) * (idx[i] - idx[stk[top]]) ) top --;\n\tstk[++ top] = i;\n}\n\nint Query(LL k) {\n\tint l = 1, r = top;\n\twhile(l < r) {\n\t\tint mid = (l + r) >> 1;\n\t\tif(k * (idx[stk[mid + 1]] - idx[stk[mid]]) <= (idy[stk[mid + 1]] - idy[stk[mid]]))\n\t\t\tr = mid; else l = mid + 1;\n\t}\n\treturn stk[l];\n}\n\nint main() {\n\tX = read(), n = read(), m = read();\n\tW = read(), T = read();\n\trep(i, 1, n) s[i].se = read(), s[i].fi = s[i].se % T;\n\ts[++ n] = MP(X % T, X); \n\trep(i, 1, m) a[i].fi = read(), a[i].se = read();\n\n\tsort(s + 1, s + n + 1);\n\tsort(a + 1, a + m + 1);\n\trep(i, 1, m) sum[i] = sum[i - 1] + a[i].se;\n\ta[m + 1].fi = INF;\n\t\n\tint p = 1; Insert(0);\n\trep(i, 1, m) {\n\t\tf[i] = f[i - 1] + W * ((X / T) + ((X % T) >= a[i].fi));\n\t\tLL minn = INF;\n\t\twhile(p <= n && s[p].fi < a[i].fi) p ++;\n\t\twhile(p <= n && s[p].fi < a[i + 1].fi) minn = min(minn, s[p ++].se / T);\n\t\tif(minn < INF) {\n\t\t\tint j = Query(W * minn);\n\t\t\tf[i] = min(f[i], f[j] + sum[i] - sum[j] + W * minn * (i - j));\n\t\t}\n\t\tidx[i] = i;\n\t\tidy[i] = f[i] - sum[i];\n\t\tInsert(i);\n\t}\n\t\n\tprintf(\"%lld\\n\", f[m] + W * (X / T + 1));\n\treturn 0;\n}\n```",
        "postTime": 1648639910,
        "uid": 117941,
        "name": "_LPF_",
        "ccfLevel": 9,
        "title": "AT2539 \u9577\u8ddd\u96e2\u30d0\u30b9 (Long Distance Coach)"
    },
    {
        "content": "## \u9898\u610f\n\u5df4\u58eb\u53d1\u8f66\u65f6\u523b\u4e3a $0$\uff0c\u5230\u8fbe\u7ec8\u70b9\u7684\u65f6\u523b\u4e3a $X$\u3002\n\n\u9014\u4e2d\u6709 $N$ \u4e2a\u670d\u52a1\u7ad9\uff0c\u4f9d\u6b21\u7f16\u53f7\u4e3a $1\\ldots N$\u3002\u5df4\u58eb\u5230\u8fbe\u670d\u52a1\u7ad9 $i(1\\le i\\le N)$ \u7684\u65f6\u95f4\u662f $S_i$\u3002\n\n\u53d1\u8f66\u524d\uff0c\u6c34\u7bb1\u662f\u7a7a\u7684\u3002\u5728\u53d1\u8f66\u524d\u4f60\u53ef\u4ee5\u7ed9\u996e\u6c34\u673a\u52a0\u6c34\uff0c\u5728\u670d\u52a1\u7ad9\u65f6\u4e5f\u53ef\u4ee5\u7ed9\u996e\u6c34\u673a\u52a0\u6c34\uff0c\u6c34\u4ef7\u4e3a\u6bcf\u5347 $W$ \u5186\u3002\u6c34\u7bb1\u5bb9\u91cf\u65e0\u9650\u3002 \n\n\u6709 $M$ \u540d\u4e58\u5ba2\uff0c\u4e58\u5ba2\u5747\u5728\u8d77\u70b9\u4e0a\u8f66\u3002\u4e58\u5ba2 $j(1\\le j\\le M)$ \u5728\u65f6\u523b $kT+D_j(k=0,1,2,\\ldots)$ \u9700\u8981\u88c5 $1$ \u5347\u6c34\uff0c\u5728\u5176\u4ed6\u65f6\u523b\u4e0d\u88c5\u6c34\u3002\u4fdd\u8bc1 $1\\le D_j < T$\u3002\n\n\u53f8\u673a\u5728\u65f6\u523b $kT(k=0,1,2,\\ldots)$ \u9700\u8981\u88c5 $1$ \u5347\u6c34\uff0c\u5728\u5176\u4ed6\u65f6\u523b\u4e0d\u88c5\u6c34\u3002\u5982\u679c\u5230\u7ec8\u70b9\u4e4b\u524d\uff0c\u67d0\u4e00\u540d\u4e58\u5ba2\u60f3\u88c5\u6c34\u65f6\u996e\u6c34\u673a\u6ca1\u6c34\u4e86\uff0c\u8fd9\u540d\u4e58\u5ba2\u4f1a\u6012\u800c\u4e0b\u8f66\uff0c\u6b64\u65f6\u9700\u8981\u5411\u8fd9\u540d\u4e58\u5ba2\u9000 $C_j$ \u5186\u3002\n\n\u4fdd\u8bc1\u4e0d\u4f1a\u51fa\u73b0\u4e24\u4eba\u5728\u540c\u4e00\u65f6\u523b\u9700\u8981\u88c5\u6c34\u7684\u60c5\u51b5\u3002\u4fdd\u8bc1\u5728\u670d\u52a1\u7ad9\u6216\u662f\u5230\u8fbe\u7ec8\u70b9\u65f6\uff0c\u4e0d\u5b58\u5728\u53f8\u673a\u6216\u4e58\u5ba2\u9700\u8981\u559d\u6c34\u3002\n\n\u6700\u5c0f\u5316\u4e70\u6c34\u7684\u603b\u8d39\u7528\u4e0e\u9000\u7684\u6240\u6709\u8f66\u8d39\u4e4b\u548c\u3002\u5e76\u4fdd\u8bc1\u53f8\u673a\u6bcf\u6b21\u90fd\u80fd\u80fd\u559d\u5230\u6c34\u3002\n\n**\u4e0d\u4fdd\u8bc1 $S_i$ \u9012\u589e\u3002**\n## \u9898\u89e3\n\u6bd4\u8f83\u5de7\u5999\u7684\u9898\uff0c\u4e00\u6b65\u4e00\u6b65\u63a8\u4e5f\u80fd\u63a8\u51fa\u6765\u3002\n\n\u4ee5\u4e0b\u8ba8\u8bba\u9ed8\u8ba4 $S_i,D_i$ \u90fd\u5347\u5e8f\uff0c$S_{n+1}=X$\uff0c$n,m$ \u540c\u9636\u3002\n\n> \u89c2\u5bdf $\\mathbf I.$ \u5230\u7b2c $i$ \u4e2a\u8f66\u7ad9\u6216\u7ec8\u70b9\u65f6\u6c34\u7bb1\u4e00\u5b9a\u662f\u7a7a\u7684\n\n> \u89c2\u5bdf $\\mathbf {II}.$ \u4ece\u7b2c $i$ \u4e2a\u4e2a\u8f66\u7ad9\u5230\u7b2c $i+1$ \u4e2a\u8f66\u7ad9\uff0c\u8d76\u4e0b\u8f66\u7684\u4eba\u7684\u7f16\u53f7\u4e00\u5b9a\u662f\u4e00\u4e2a\u533a\u95f4\u7684\u4e00\u6bb5\u540e\u7f00\u3002\n>\n> ![1.png](https://cdn.luogu.com.cn/upload/image_hosting/3ar2rlu8.png)\n>\n> \u9996\u5148\u7f16\u53f7\u80af\u5b9a\u662f\u8fde\u7eed\u7684\u3002\u5bf9\u4e8e\u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u6ca1\u6709\u53f8\u673a\uff0c\u6211\u4eec\u53ef\u4ee5\u628a $[x,R]$ \u7684\u4eba\u8d76\u4e0b\u8f66\uff0c\u5176\u4e2d $x\\in [L,R]$\u3002\u5982\u679c\u662f\u7b2c\u4e8c\u79cd\u60c5\u51b5\u5728\u53f8\u673a\u6700\u540e\u4e00\u6b21\u559d\u6c34\u524d\u6211\u4eec\u8981\u4e00\u76f4\u4fdd\u8bc1\u6709\u8c01\uff0c\u53ef\u4ee5\u628a $[x,R]$ \u8d76\u4e0b\u8f66\uff0c\u5176\u4e2d $x\\in [1,R]$\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u4e0d\u8d76\u3002\n\n> \u89c2\u5bdf $\\mathbf {III}.$ \u5f53\u88ab\u8d76\u4e0b\u8f66\u7684\u4eba\u94a6\u5b9a\u65f6\uff0c\u80af\u5b9a\u662f\u8d8a\u65e9\u8d76\u4e0b\u8f66\u8d8a\u597d\u3002\n\n> \u89c2\u5bdf $\\mathbf{IV}.$ \u5f53\u8d76\u4e0b\u8f66\u7684\u4eba\u88ab\u94a6\u5b9a\u65f6\uff0c\u5982\u679c\u6709\u4e24\u4e2a\u6781\u957f\u8fde\u7eed\u6bb5\u88ab\u8d76\u4e0b\u8f66\uff0c\u4e24\u4e2a\u6781\u957f\u8fde\u7eed\u6bb5\u4e92\u4e0d\u5f71\u54cd\u3002\n>\n> \u56e0\u4e3a\u8d76\u4eba\u7684\u65f6\u5019\u662f\u8fde\u7eed\u7684\uff0c\u6240\u4ee5\u4e24\u4e2a\u62fc\u4e0d\u8d77\u6765\u7684\u6bb5\u662f\u6ca1\u6709\u5f71\u54cd\u7684\u3002\n\n\u4e0a\u9762\u89c2\u5bdf\u51fa\u4e86\u4e00\u5927\u5806\u7ed3\u8bba\uff0c\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u5f88\u663e\u7136\u7684 $\\mathcal O(n^2)$ \u505a\u6cd5\uff0c\u4e5f\u5c31\u662f\u76f4\u63a5 dp\u3002\u8bbe $f_{i}$ \u8868\u793a\u8003\u8651\u4e86 $[1,i]$ \u65f6\u7684\u6700\u4f18\u7b54\u6848\uff0c\u6211\u4eec\u53ef\u4ee5\u5904\u7406\u51fa\u6240\u6709\u533a\u95f4 $[l,r]$ \u8868\u793a\u53ef\u4ee5\u8d76\u8d70\u4e00\u4e2a\u540e\u7f00\uff0c\u8d76\u8d70\u4e4b\u524d\u9700\u8981\u559d $c$ \u53e3\u6c34\u3002\u679a\u4e3e\u6700\u540e\u7684\u70b9 $i$\uff0c\u90a3\u4e48\u53ea\u6709 $r\\le i$ \u7684\u533a\u95f4\u662f\u80fd\u7528\u7684\uff0c\u7528\u4e00\u4e2a\u6570\u7ec4 $val_i$ \u8868\u793a\u5f53\u524d\u80fd\u7528\u7684\u533a\u95f4\u4e2d\u5305\u542b $i$ \u7684\u559d\u6c34\u7684\u6b21\u6570\u7684\u6700\u5c0f\u503c\uff0c\u8f6c\u79fb\u6709\u4e24\u79cd\uff0c\u679a\u4e3e $i$ \u662f\u5426\u88ab\u8d76\u8d70\uff0c\u4e0d\u88ab\u8d76\u8d70\u7edf\u8ba1\u4e0a\u559d\u6c34\u7684\u6b21\u6570\uff0c\u5426\u5219\u88ab\u8d76\u8d70\uff0c\u679a\u4e3e\u8fd9\u4e2a\u8fde\u7eed\u6bb5\u7684\u7b2c\u4e00\u4e2a\u70b9 $j$\u3002\n$$\nf_i=\\min\\left(f_{i-1}+W\\times\\left(\\frac{X-D_i}{T}+1\\right),\\min_{j=1}^if_{j-1}+\\sum_{k=j}^iw\\times val_k+C_k\\right)\n$$\n\u8fd9\u91cc\u6709\u4e00\u4e2a\u95ee\u9898\u662f $j-1$ \u53ef\u80fd\u4e5f\u8981\u8d76\u4e0b\u8f66\uff0c\u4e5f\u5c31\u662f $[j,i]$ \u53ef\u80fd\u4e0d\u662f\u6781\u957f\u7684\u3002\u4f46\u662f\u5206\u6790\u4e00\u4e0b\u53d1\u73b0\u628a\u4e00\u4e2a\u6781\u957f\u7684\u533a\u95f4\u62c6\u6210\u4e24\u4e2a\u533a\u95f4\u80af\u5b9a\u662f\u4e8f\u7684\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u8003\u8651\u8fd9\u79cd\u60c5\u51b5\u3002\n\n\u6211\u4eec\u8fd9\u91cc\u6ca1\u6709\u7edf\u8ba1\u53f8\u673a\u559d\u6c34\u7684\u8d21\u732e\u6700\u540e\u52a0\u4e0a\u5373\u53ef\u3002\u7136\u540e\u5c31\u5f97\u5230\u4e86 [71\u5206\u4ee3\u7801](https://loj.ac/s/1473409)\n\n\u7136\u540e\u8fd9\u4e2a\u53ef\u4ee5\u7528\u5206\u5757\u4f18\u5316\u5230 $\\mathcal O(n\\sqrt n)$ \u4f46\u662f\u975e\u5e38\u96be\u5199\u3002\u6211\u4eec\u53d1\u73b0\u96be\u5ea6\u4e3b\u8981\u5728 $val_i$ \u7684\u5904\u7406\u3002\u7ee7\u7eed\u89c2\u5bdf\u7ed3\u8bba\u3002\n\n> \u89c2\u5bdf $\\mathbf V.$ \u6240\u6709\u4e3a\u6b21\u6570 $c$ \u7684\u533a\u95f4\u4e24\u4e24\u6ca1\u6709\u4ea4\uff0c\u5e76\u4e14\u5e76\u8d77\u6765\u662f $[1,R]$\u3002\n>\n> \u8fd9\u4e2a\u7ed3\u8bba\u4e5f\u5f88\u663e\u7136\uff0c\u56e0\u4e3a\u5982\u679c\u8fd9\u4e2a\u533a\u95f4\u6ca1\u6709\u53f8\u673a\uff0c\u80af\u5b9a\u662f\u548c\u4e0a\u4e00\u4e2a\u533a\u95f4\u63a5\u8d77\u6765\u7684\uff0c\u7136\u540e\u6709\u53f8\u673a\u559d\u6c34\u7684\u60c5\u51b5\u80af\u5b9a\u662f\u4ece $1$ \u5f00\u59cb\u7684\uff0c\u6240\u4ee5\u5e76\u8d77\u6765\u4e00\u5b9a\u662f\u4e00\u6bb5\u524d\u7f00\u3002\n\n\u8fd9\u4e2a\u7ed3\u8bba\u6709\u4ec0\u4e48\u7528\u5462\uff1f\u6700\u5927\u7684\u597d\u5904\u5c31\u662f\u56e0\u4e3a\u662f\u4e00\u6bb5\u524d\u7f00\u6240\u4ee5 $val$ \u80af\u5b9a\u662f\u4e0d\u964d\u7684\u3002\u7136\u540e\u6211\u4eec\u7b2c\u4e8c\u79cd\u8f6c\u79fb\u679a\u4e3e\u7684\u65f6\u5019\u4e0d\u9700\u8981\u679a\u4e3e\u533a\u95f4\u5de6\u7aef\u70b9\uff0c\u800c\u662f\u53bb\u679a\u4e3e $val_i$ \u7684\u957f\u5ea6\uff0c\u8bb0 $sum_i$ \u4e3a $C_i$ \u7684\u524d\u7f00\u548c\uff0c\u7136\u540e\u7b2c\u4e8c\u79cd\u8f6c\u79fb\u5c31\u53d8\u6210\u4e86\u8fd9\u6837\uff1a\n$$\nf_i\\leftarrow\\min_{j=0}^{i-1}f_{j}+sum_i-sum_j+w\\times val_i\\times (i-j)\n$$\n\u7136\u540e\u8fd9\u4e2a\u659c\u7387\u4f18\u5316\u968f\u4fbf\u505a\u4e86\u5427\u3002\u590d\u6742\u5ea6 $\\mathcal O(n\\log n)$\u3002\n## \u4ee3\u7801\n```cpp\n#include<bits/stdc++.h>\n#define mp make_pair\n#define mt make_tuple\n#define eb emplace_back\n#define pb push_back\n#define pc putchar\n#define chkmx(a,b) (a)=max((a),(b))\n#define chkmn(a,b) (a)=min((a),(b))\n#define fi first\n#define se second\nusing namespace std;\ntemplate<class T>\nvoid read(T&x){x=0;char c=getchar();bool f=0;for(;!isdigit(c);c=getchar())f^=c=='-';for(;isdigit(c);c=getchar())x=x*10+c-'0';if(f)x=-x;}\ntemplate<class T,class ...ARK>void read(T&x,ARK&...ark){read(x);read(ark...);}\ntemplate<class T>void write(T x){if(x<0)pc('-'),x=-x;if(x>=10)write(x/10);pc(x%10+'0');}\ntemplate<class T,class ...ARK>void write(T x,ARK...ark){write(x);pc(' ');write(ark...);}\ntemplate<class ...ARK>void writeln(ARK...ark){write(ark...);pc('\\n');}\ntypedef long long ll;\ntypedef __int128 lll;\nconst int mod=998244353;\nstruct mint{\n\tint x;mint(int o=0){x=o;}mint&operator+=(mint a){return(x+=a.x)%=mod,*this;}mint&operator-=(mint a){return(x+=mod-a.x)%=mod,*this;}\n\tmint&operator*=(mint a){return(x=1ll*x*a.x%mod),*this;}mint&operator^=( int b){mint a=*this;x=1;while(b)(b&1)&&(*this*=a,1),a*=a,b>>=1;return*this;}\n\tmint&operator/=(mint a){return*this*=(a^=mod-2);}friend mint operator+(mint a,mint b){return a+=b;}friend mint operator-(mint a,mint b){return a-=b;}\n\tfriend mint operator*(mint a,mint b){return a*=b;}friend mint operator/(mint a,mint b){return a/=b;}friend mint operator^(mint a, int b){return a^=b;}\n};\n#define lowbit(x) ((x)&-(x))\n#define mid ((l+r)>>1)\n#define lc (x<<1)\n#define rc (x<<1|1)\nconst int N=2e5+10;\nconst ll inf=2e12;\nint n,m,w;ll x,t,s[N];\nstruct passenger{passenger(ll d=0,int c=0):d(d),c(c){}ll d;int c;bool operator<(const passenger rhs)const{return d<rhs.d;}}p[N];\nstruct point{\n\tll x,y;\n\tpoint(ll x=0,ll y=0):x(x),y(y){}\n\tpoint operator+(point rhs){return point(x+rhs.x,y+rhs.y);}\n\tpoint operator-(point rhs){return point(x-rhs.x,y-rhs.y);}\n\tlll operator*(point rhs){return (lll)x*rhs.y-(lll)y*rhs.x;}\n}st[N];int top;\nll dp[N],sum[N],val[N];\nsigned main(){\n\t//freopen(\"1.in\",\"r\",stdin);\n\tread(x,n,m,w,t);s[n+1]=x;\n\tfor(int i=1;i<=n;i++)read(s[i]);\n\tfor(int i=1;i<=m;i++)read(p[i].d,p[i].c);\n\tsort(p+1,p+1+m);sort(s+1,s+1+n);\n\tfor(int i=1;i<=m;i++)val[i]=inf;\n\tfor(int i=0;i<=n;i++){\n\t\t//from s[i] to s[i+1]\n\t\tll lst=s[i+1]/t*t;\n\t\tint j=upper_bound(p+1,p+1+m,passenger(s[i+1]-lst,0))-p-1;\n\t\tchkmn(val[j],s[i+1]/t);\n\t}\n\tst[++top]=point(0,0);\n\tfor(int i=1;i<=m;i++){\n\t\tsum[i]=sum[i-1]+p[i].c;\n\t\tdp[i]=dp[i-1]+w*((x-p[i].d)/t+1);\n\t\tif(val[i]!=inf){\n\t\t\tint l=1,r=top,ans=1;//\u627e\u5230\u7b2c\u4e00\u4e2a\u6ee1\u8db3 ans -> ans+1 \u662f\u53d8\u5927\u7684\n\t\t\twhile(l<=r){\n\t\t\t\tif(mid==top||-(lll)st[mid].x*w*val[i]+st[mid].y<-(lll)st[mid+1].x*w*val[i]+st[mid+1].y)\n\t\t\t\t\tans=mid,r=mid-1;\n\t\t\t\telse l=mid+1;\n\t\t\t}\n\t\t\tchkmn(dp[i],(ll)(sum[i]+(lll)i*w*val[i]-(lll)st[ans].x*w*val[i]+st[ans].y));\n\t\t}\n\t\tpoint kk(i,dp[i]-sum[i]);\n\t\twhile(top>1&&(st[top]-st[top-1])*(kk-st[top-1])<=0)top--;\n\t\tst[++top]=kk;\n\t}\n\twriteln(dp[m]+w*(x/t+1));\n}\n```",
        "postTime": 1654051943,
        "uid": 174304,
        "name": "jun\u5934\u5409\u5409",
        "ccfLevel": 10,
        "title": "\u9898\u89e3 AT2539 \u3010\u9577\u8ddd\u96e2\u30d0\u30b9 (Long Distance Coach)\u3011"
    },
    {
        "content": "\u53d1\u73b0\u51e0\u4e2a\u6027\u8d28\n- \u6bcf\u6b21\u4e0b\u8f66\u7684\u90fd\u662f\u4e00\u6bb5\u540e\u7f00\n- \u5982\u679c\u67d0\u4e2a\u4eba\u4f1a\u4e0b\u8f66\uff0c\u90a3\u4e48\u4e00\u5b9a\u5c3d\u65e9\u4e0b\n- \u6c34\u7684\u4ef7\u683c\u662f\u76f8\u540c\u7684\uff0c\u4e8e\u662f\u53ef\u4ee5\u6bcf\u6b21\u5230\u670d\u52a1\u7ad9\u65f6\u6c34\u7bb1\u90fd\u662f\u7a7a\u7684\uff0c\u6309\u9700\u8865\u7ed9\n- \u5982\u679c\u4e00\u4e2a\u4eba\u4f5c\u4e3a\u88ab\u5220\u7684\u540e\u7f00\u7684\u672b\u5c3e\uff0c\u90a3\u4e48\u5b83\u67d0\u6b21\u559d\u6c34\u7684\u65f6\u95f4\u4e00\u5b9a\u4e0e\u4e0b\u4e00\u4e2a\u670d\u52a1\u7ad9\u5230\u8fbe\u7684\u65f6\u95f4\u76f8\u90bb(\u4e2d\u95f4\u6ca1\u6709\u5176\u4ed6\u4eba\u8981\u559d\u6c34)\n\n\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u4e00\u4e2a $T$ \u5185\u559d\u6c34\u7684\u65f6\u95f4\u5bf9\u4e58\u5ba2\u6392\u5e8f\uff0c\u9010\u4e2a\u8003\u8651\u5176\u662f\u5426\u4e0b\u8f66\u3002\u8bbe $f_i$ \u8868\u793a\u524d $i$ \u4e2a\u4eba\u7684\u6700\u5c0f\u8d39\u7528\n\n\u5982\u679c\u4e0d\u4e0b\u8f66\n$$\nf_i=f_{i-1}+W \\times (\\lfloor \\frac{X}{T} \\rfloor+ D_i \\leq X \\bmod T)\n$$\n\n\u5982\u679c\u4e0b\u8f66\n$$\nf_i=\\min_{1\\leq j < i} f_j+pre_i-pre_j+W \\times mt_i \\times (i-j)\n$$\n$pre_i$ \u4e3a\u524d $i$ \u4e2a\u4eba\u9000\u8d39\u7684\u548c\uff0c$mt_i$ \u4e3a\u7b2c $i$ \u4e2a\u4eba\u6700\u5c11\u5728\u559d\u51e0\u6b21\u6c34\u540e\u4e0b\u8f66\u3002$mt$ \u53ef\u4ee5\u628a\u6240\u6709\u670d\u52a1\u7ad9\u51fa\u73b0\u7684\u65f6\u95f4\u5bf9\u5468\u671f\u53d6\u6a21\u540e\u6392\u5e8f\uff0c\u5355\u6307\u9488\u626b\u4e00\u904d\u5904\u7406\u3002\n\n\u7531\u4e8e\u53f8\u673a\u4e00\u5b9a\u4e0d\u80fd\u4e0b\u8f66\uff0c\u6bcf\u4e2a\u70b9\u53ea\u80fd\u4ece\u6bd4\u9760\u524d\u7684\u8f6c\u79fb\uff0c\u8f6c\u79fb\u4e0d\u4f1a\u6210\u73af\u3002\u4e0b\u8f66\u7684\u8f6c\u79fb\u662f\u5957\u8def\u7684\u659c\u7387\u4f18\u5316\u3002\n\n\n\n```cpp\n#include <bits/stdc++.h>\ntypedef long long ll;typedef unsigned long long ull; typedef double db;typedef long double ldb;\n#define fre(x) freopen(#x \".in\",\"r\",stdin),freopen(#x \".out\",\"w\",stdout)\n#define Rep(i,a,b) for(int i=a;i<=b;++i) \n#define Dwn(i,a,b) for(int i=a;i>=b;--i)\n#define pii pair<int,int>\n#define mair make_pair\n#define fir first\n#define sec second\n#define int ll\nusing namespace std;\n\nconst int maxn=2e5+10,INF=1e18;\n\nint X,n,m,W,T;\n\nint s[maxn];\nstruct Per{\n\tint D,C,mini;\n\tbool operator<(const Per &rhs)const{ return D<rhs.D; }\n}E[maxn];\n\nint f[maxn];\nint pre[maxn];\npii t[maxn];\n\nint q[maxn],top;\n\n#define S(x) (f[x]-pre[x]) \n\nint Query(int x){\n\tint l=1,r=top+1;\n\twhile(r-l>1){\n\t\tint mid=(l+r)>>1;\n\t\tif(x*(q[mid]-q[mid-1])>(S(q[mid])-S(q[mid-1])))l=mid;\n\t\telse r=mid;\n\t}\n\treturn q[l];\n}\n\nvoid solve(){\n\tcin>>X>>n>>m>>W>>T;\n\tRep(i,1,n)cin>>s[i],t[i]=mair(s[i]%T,s[i]);\n\tt[++n]=mair(X%T,X);\n\tRep(i,1,m)cin>>E[i].D>>E[i].C,E[i].mini=INF;\n\tsort(E+1,E+m+1);sort(t+1,t+n+1);\n\tE[m+1].D=T;\n\tint p=1;\n\tRep(i,1,m){\n\t\twhile(p<=n && t[p].fir<E[i].D)++p;\n\t\twhile(p<=n && t[p].fir<E[i+1].D)E[i].mini=min(E[i].mini,t[p++].sec/T);\n\t\tpre[i]=pre[i-1]+E[i].C;\n\t}\n\t++top;\n\tRep(i,1,m){\n\t\tf[i]=f[i-1]+W*((X/T)+(X%T>=E[i].D ? 1 : 0));\n\t\tif(E[i].mini<INF){ int j=Query(W*E[i].mini); f[i]=min(f[i],f[j]+pre[i]-pre[j]+W*E[i].mini*(i-j)); }\n\t\twhile(top>1 && (S(i)-S(q[top]))*(q[top]-q[top-1])<=(S(q[top])-S(q[top-1]))*(i-q[top]))--top;\n\t\tq[++top]=i;\n\t}\n\tcout<<f[m]+(X/T+1)*W<<\"\\n\";\n}\n\n#undef int \nint main (){ ios::sync_with_stdio(false),cin.tie(0),cout.tie(0);return solve(),0; }\n\n```",
        "postTime": 1663766016,
        "uid": 277792,
        "name": "Delov",
        "ccfLevel": 7,
        "title": "AT2539\u9898\u89e3"
    }
]