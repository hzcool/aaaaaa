[
    {
        "content": "\u8003\u8651\u6784\u9020\u4e00\u6ce2\u7c7b\u4f3c\u751f\u6210\u51fd\u6570\u7684\u4e1c\u897f $f(x)=\\sum_{i=-\\infty}^{+\\infty}A_ix^i$\uff0c\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a\u6307\u9488 $g$\uff0c\u5f00\u59cb\u662f $g$ \u6307\u5411 $0$ \u4f4d\u7f6e\uff0c\u663e\u7136\u521d\u59cb\u65f6 $f(x)=0$\u3002\n\n\u6211\u4eec\u4ee4 $f_i(x)$ \u8868\u793a $1\\sim i$ \u8fd9\u4e00\u6bb5\u5b50\u4e32\u64cd\u4f5c\u6240\u5f97\u5230\u7684 $f$ \u503c\uff0c$g_i$ \u8868\u793a $1\\sim i$ \u64cd\u4f5c\u540e\u7684\u6307\u9488\u4f4d\u7f6e\u3002\u8003\u8651\u5728\u672b\u5c3e\u52a0\u5165\u4e00\u4e2a\u5b57\u7b26 $c$\uff0c\u5982\u679c $c$ \u662f `'+'` \u6216 `'-'`\uff0c\u90a3\u663e\u7136 $\\begin{cases}f_i(x)=f_{i-1}(x)\\pm x^{g_i}\\\\g_i=g_{i-1}\\end{cases}$\uff0c\u540c\u7406\u5982\u679c $c$ \u662f `'<'` \u6216 `'>'`\uff0c\u90a3\u663e\u7136 $\\begin{cases}f_i(x)=f_{i-1}(x)\\\\g_i=g_{i-1}\\mp 1\\end{cases}$\u3002\n\n\u5982\u679c\u8981\u8ba1\u7b97 $[l,r]$ \u7684 $f$ \u503c\uff0c\u4e0d\u96be\u53d1\u73b0\u5c31\u662f $\\frac{f_r(x)-f_{l-1}(x)}{x^{g_{l-1}}}$\u3002\n\n\u4e8e\u662f\u6211\u4eec\u8981\u7b97\u7684\u5c31\u662f $f_n(x)=\\frac{f_r(x)-f_{l-1}(x)}{x^{g_{l-1}}}$\uff0c\u8003\u8651\u968f\u4fbf\u9009\u4e00\u4e2a $x$\uff0c\u7b97\u51fa\u8fd9\u4e2a\u591a\u9879\u5f0f\u7684\u503c\u7136\u540e\u54c8\u5e0c\u4e00\u4e0b\u5373\u53ef\u3002",
        "postTime": 1583119693,
        "uid": 84088,
        "name": "pufanyi",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 AT4163 \u3010[ARC099D] Eating Symbols Hard\u3011"
    },
    {
        "content": "\uff08\u5982\u679c\u9898\u89e3\u9875\u9762\u516c\u5f0f\u9505\u4e86\u53ef\u4ee5\u9009\u62e9\u53bbblog\u5185\u770b\r\n\r\n\r\n\u8fd9\u9898\u6570\u636e\u5947\u6c34\uff0c\u6c34\u5230\u6211\u89c9\u5f97\u8fd9 $83$ \u7ec4\u6570\u636e\u5c31\u662f\u5728\u95f9\u7740\u73a9\u7684\u3002\u8c37\u8fd9\u9898\u552f\u4e00\u6709\u4ee3\u7801\u7684\u90a3\u7bc7\u9898\u89e3\uff0c\u53ea\u8981\u628a\u7b2c\u4e8c\u7ec4\u6837\u4f8b `reverse` \u4e00\u4e0b\u5c31\u53ef\u4ee5 `hack` \u6389\uff1b\u6211\u53cc\u54c8\u5e0c\u628a\u4fe9\u6a21\u6570\u5199\u6df7\u4e86\u90fd\u80fd\u5bf9 $71/83$\u3002\r\n_____\r\n\r\n> \u7ed9\u5b9a\u4e00\u4e2a\u4e0b\u6807\u8303\u56f4\u5728 $[-\\infty,\\infty]$ \u7684\u6570\u7ec4\u3002\u4e00\u5f00\u59cb\u6307\u9488\u5728 $0$ \u5904\u3002\u7ed9\u5b9a\u4e00\u6bb5\u64cd\u4f5c\u5e8f\u5217\u3002\u6c42\u6709\u591a\u5c11\u4e2a\u5b50\u5e8f\u5217\u7684\u64cd\u4f5c\u7ed3\u679c\u7b49\u4ef7\u4e8e\u6574\u4e2a\u5e8f\u5217\u7684\u64cd\u4f5c\u7ed3\u679c\u3002\u64cd\u4f5c\u6709\u56db\u79cd\uff0c\u5de6\u79fb/\u53f3\u79fb/\u67d0\u4e2a\u4f4d\u7f6e$+1$/\u67d0\u4e2a\u4f4d\u7f6e$-1$ \u3002\r\n>\r\n> $1\\leq n\\leq 250,000$\r\n\r\n\u4e00\u62ff\u5230\u9898\u9996\u5148\u8003\u8651 $dp$ \uff0c\u53d1\u73b0 $dp$ \u4e0d\u662f\u5f88\u53ef\u505a\u2026\r\n\r\n\u4e8e\u662f\u5c31\u53d1\u73b0\uff0c\u7c7b\u4f3c\u8fd9\u79cd\u9898\u76ee\u53ef\u4ee5\u4f7f\u7528\u54c8\u5e0c\u3002\u56db\u79cd\u64cd\u4f5c\u5206\u522b\u5bf9\u5e94 $\\times base^{-1}$\u3001$\\times base$\u3001$+base$\u3001$-base$ \u3002\r\n\r\n\u8003\u8651\u8fd9\u6837\u505a\u5982\u4f55\u53bb\u6c42\u67d0\u4e00\u6bb5\u7684\u54c8\u5e0c\u503c\u3002\u666e\u901a\u7684\u6c42\u6cd5\u539f\u7406\u5982\u4e0b\uff1a\r\n\r\n\u5bf9\u4e8e\u6bcf\u4e2a $p$ \uff0c\u622a\u6b62\u5230 $p$ \u7684\u54c8\u5e0c\u503c\uff0c\u5982\u679c\u5c06 $x$ \u770b\u505a $base$ \u7684\u4e00\u4e2a\u7b49\u4ef7\uff0c\u90a3\u4e48\u5c31\u662f\u662f\r\n\r\n$$\r\n\\sum_{i=1}^ps_ix^{p-i}\r\n$$\r\n\r\n\u8003\u8651\u5c06\u4e0a\u5f0f\u8bb0\u4f5c $o(p)$ \u3002\u5219\u7247\u6bb5 $[l,r]$ \u7684\u54c8\u5e0c\u503c\u53ef\u4ee5\u5982\u6b64\u5f97\u5230\uff1a\r\n\r\n![](https://cdn.luogu.com.cn/upload/image_hosting/2qkkg86r.png)\r\n\r\n\u8003\u8651\u5982\u679c\u6574\u4e2a\u4e32\u7684\u54c8\u5e0c\u503c\u4e3a $q$\uff0c\u90a3\u4e48\u9700\u8981\u7edf\u8ba1\u7684\u662f $o(r)-o(l-1)\\cdot x^{r-l+1}=q$ \u3002\u8003\u8651\u4ece\u524d\u81f3\u540e\u7528 $map$ \u5b8c\u6210\u8fd9\u4e2a\u8fc7\u7a0b\u3002\u7531\u4e8e\u4e0d\u77e5\u9053\u53f3\u7aef\u70b9\u7684\u4fe1\u606f\uff0c\u9700\u8981\u5bf9\u539f\u5f0f\u8fdb\u884c\u53d8\u5f62\uff0c\u5373\uff1a\r\n\r\n$$\\frac{q-o(r)}{x^r}=\\frac{o(l-1)}{x^{l-1}}$$\r\n\r\n\u8fd9\u6837\u5c31\u53ef\u4ee5\u505a\u5230 $l,r$ \u65e0\u5173\u4e86\u3002\u968f\u4fbf\u9009\u524d\u7f00\u6216\u8005\u540e\u7f00\u7edf\u8ba1\u5c31\u597d\u4e86\u3002\r\n\r\n\u4f46\u662f\u6ce8\u610f\u5230\u672c\u9898\u6709\u4e2a\u989d\u5916\u9650\u5236\uff0c\u6700\u540e\u53ea\u9700\u8981\u7ed3\u679c\u76f8\u540c\u800c\u4e0d\u9700\u8981\u6307\u9488\u4f4d\u7f6e\u76f8\u540c\u3002\u6240\u4ee5\u9700\u8981\u5728\u4e00\u5f00\u59cb\u54c8\u5e0c\u65f6\u7a0d\u5fae\u5904\u7406\u4e00\u4e0b\u5373\u53ef\uff08\u8fd9\u4e5f\u662f\u90a3\u7bc7\u6302\u4e86\u7684\u9898\u89e3\u7684\u6302\u70b9\uff09\u3002\r\n\r\n```cpp\r\n#define mkp make_pair\r\n#define pll pair<LL, LL>\r\n\r\nconst LL B1 = 237ll ;\r\nconst LL B2 = 637ll ;\r\nconst int N = 300010 ;\r\nconst LL P1 = 998244353 ;\r\nconst LL P2 = 1004535809 ;\r\n\r\nint n ;\r\nLL ans ;\r\nchar s[N] ;\r\nLL I1, I2 ;\r\nLL g[N][2] ;\r\nLL S[N], T[N] ;\r\nmap <pll, LL> buc ;\r\n\r\nLL expow(LL a, LL b, LL p){\r\n    LL ret = 1 ;\r\n    while (b){\r\n        if (b & 1)\r\n            (ret *= a) %= p ;\r\n        (a *= a) %= p ; b >>= 1 ;\r\n    }\r\n    return ret ;\r\n}\r\nint main(){\r\n    cin >> n >> (s + 1) ;\r\n    g[0][0] = g[0][1] = 1ll ;\r\n    I1 = expow(B1, P1 - 2, P1) ;\r\n    I2 = expow(B2, P2 - 2, P2) ;\r\n    for (int i = 1 ; i <= n ; ++ i){\r\n        if (s[i] == '-'){\r\n            g[i][0] = g[i - 1][0] ;\r\n            g[i][1] = g[i - 1][1] ;\r\n            S[i] = (S[i - 1] - g[i][0] + P1) % P1 ;\r\n            T[i] = (T[i - 1] - g[i][1] + P2) % P2 ;\r\n        }\r\n        if (s[i] == '+'){\r\n            g[i][0] = g[i - 1][0] ;\r\n            g[i][1] = g[i - 1][1] ;\r\n            S[i] = (S[i - 1] + g[i][0]) % P1 ;\r\n            T[i] = (T[i - 1] + g[i][1]) % P2 ;\r\n        }\r\n        if (s[i] == '<'){\r\n            g[i][0] = g[i - 1][0] * I1 % P1 ;\r\n            g[i][1] = g[i - 1][1] * I2 % P2 ;\r\n            S[i] = S[i - 1] ; T[i] = T[i - 1] ;\r\n        }\r\n        if (s[i] == '>'){\r\n            g[i][0] = g[i - 1][0] * B1 % P1 ;\r\n            g[i][1] = g[i - 1][1] * B2 % P2 ;\r\n            S[i] = S[i - 1] ; T[i] = T[i - 1] ;\r\n        }\r\n        ++ buc[mkp(S[i], T[i])] ;\r\n    }\r\n    ++ buc[mkp(0, 0)] ; LL x, y ;\r\n    for (int i = 0 ; i < n ; ++ i){\r\n        buc[mkp(S[i] , T[i])] -- ;\r\n        x = (S[i] + S[n] * g[i][0] % P1) % P1 ;\r\n        y = (T[i] + T[n] * g[i][1] % P2) % P2 ;\r\n        ans += buc[mkp(x, y)] ;\r\n    }\r\n    cout << ans << endl ; return 0 ;\r\n}\r\n\r\n```\r\n\r\n\r\n",
        "postTime": 1583415556,
        "uid": 28313,
        "name": "\u768e\u6708\u534a\u6d12\u82b1",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 AT4163 \u3010[ARC099D] Eating Symbols Hard\u3011"
    },
    {
        "content": "[AtC \u4f20\u9001\u95e8\uff1aF - Eating Symbols Hard ](https://atcoder.jp/contests/arc099/tasks/arc099_d)\n\n\u53cc\u54c8\u5e0c + \u5dee\u5206\n\n## Solution\n\n### 1\n\n\u53d1\u73b0\u8981\u60f3\u786e\u5b9a $[l,r]$ \u5bf9\u5e8f\u5217 $A$ \u7684\u5f71\u54cd\uff0c\u5fc5\u987b\u5f97\u8bb0\u5f55\u4e0b $S$ \u4e2d\u7684\u6240\u6709\u5b50\u4e32\u5bf9 $A$ \u64cd\u4f5c\u540e\u7684\u72b6\u6001\u3002\u8fdb\u4e00\u6b65\u5730\uff0c\u4e3a\u4e86\u66f4\u597d\u5904\u7406\u6bcf\u4e00\u4e2a $[l,r]$\uff0c\u81ea\u7136\u4f1a\u60f3\u5230\u4f7f\u7528\u5dee\u5206\u7684\u65b9\u6cd5\u2014\u2014\u8bb0\u5f55\u4e0b $[1,i]\\ (i \\in [1,\\left\\vert S \\right\\vert])$\u3002\n\n\u4f46\u662f\u4e0a\u8ff0\u60f3\u6cd5\u6682\u65f6\u770b\u8d77\u6765\u4ecd\u6709\u8bb8\u591a\u7f3a\u9677\u3002\u6ce8\u610f\u5230\uff0c\u6211\u4eec\u7684\u76ee\u7684\u662f**\u786e\u5b9a $A$ \u5e8f\u5217\u5728\u4e0d\u540c\u60c5\u51b5\u4e0b\u7684\u72b6\u6001**\uff0c\u6240\u4ee5\u8fd9\u5c31\u5f15\u5bfc\u6211\u4eec\u8981\u53bb\u4f7f\u7528\u54c8\u5e0c\u751a\u81f3\u53cc\u54c8\u5e0c\u8fdb\u884c\u7ef4\u62a4\u6216\u8bb0\u5f55\u3002\n\n\u4e3a\u4ec0\u4e48\u54c8\u5e0c\u80fd\u5b9e\u73b0\u4e0a\u8ff0\u7684\u5dee\u5206\u5462\uff1f\u5176\u5b9e\uff0c\u7a0d\u52a0\u601d\u8003\u5373\u53ef\u53d1\u73b0\uff0c\u5373 $h(i)$ \u8868\u793a\u6309\u7167 $S$  \u7684\u5b50\u5e8f\u5217 $[1,i]$ \u5bf9\u521d\u59cb\u4e3a $0$ \u7684\u5e8f\u5217 $A$ \u8fdb\u884c\u64cd\u4f5c\u540e $A$ \u5e8f\u5217\u7684\u54c8\u5e0c\u503c\u3002\u90a3\u4e48 $h(r)-h(l-1)$ \u5b9e\u9645\u4e0a\u5c31\u662f\u5c06\u524d $i-1$ \u4e2a\u64cd\u4f5c\u9020\u6210\u7684\u5f71\u54cd\u62b5\u6d88\u6389\u3002**\u56e0\u4e3a\u771f\u6b63\u5bf9\u5e8f\u5217 $A$ \u9020\u6210\u5f71\u54cd\u7684\u64cd\u4f5c\u5c31\u662f\u5bf9\u5b83\u5143\u7d20\u8fdb\u884c\u52a0\u51cf\uff0c\u800c\u5bf9\u5143\u7d20\u7684\u52a0\u51cf\u64cd\u4f5c\u663e\u7136\u662f\u53ef\u4ee5\u901a\u8fc7\u76f8\u51cf\u62b5\u6d88\u7684**\u3002\u6240\u4ee5\u6700\u7ec8\u53ea\u7559\u4e0b\u7b2c $l$ \u5230 $r$ \u4e2a\u64cd\u4f5c\u5bf9\u5e8f\u5217\u7684\u5f71\u54cd\u3002\n\n### 2\n\n\u56de\u8fc7\u5934\u6765\uff0c\u9898\u76ee\u8981\u6c42\u7edf\u8ba1\u7684\u5408\u6cd5\u533a\u95f4 $[l,r]$ \u8c8c\u4f3c\u5c31\u662f\u6ee1\u8db3 $h(r)-h(l-1)=h(n)$ \u7684\u533a\u95f4\u3002\u4f46\u662f\uff0c\u8fd9\u91cc\u5ffd\u7565\u6389\u4e86\u4e00\u70b9\uff0c\u5c31\u662f\u5728 $h(r)-h(l-1)$ \u540e\uff0c\u8fd9\u4e2a\u5dee\u503c\u76f8\u6bd4 $h(n)$ \u5b9e\u8d28\u4e0a\u4f1a\u53d1\u751f\u4e00\u4e2a**\u5728 $base$ \u8fdb\u5236\u4e0a\u7684\u4f4d\u79fb**\u3002\u7b80\u5355\u89e3\u91ca\u4e00\u4e0b\uff0c\u7edf\u8ba1 $[1,n]$ \u533a\u95f4\u7684\u54c8\u5e0c\u503c\u65f6\uff0c\u4e0b\u6807 $p$ \u662f\u4ece $0$ \u5f00\u59cb\u7684\uff0c\u7b2c\u4e00\u4e2a\u64cd\u4f5c\u4e58\u4e0a\u7684\u8fdb\u5236\u662f $base^0$\uff0c\u7136\u800c\uff0c\u7edf\u8ba1 $[l,r]$ \u533a\u95f4\u7684\u54c8\u5e0c\u503c\u65f6\uff0c\u4e0b\u6807 $p$ \u7ecf\u8fc7\u4e86\u524d $l-1$ \u6b21\u64cd\u4f5c\uff0c\u4e0d\u59a8\u8bb0 $P_i$ \u8868\u793a\u7b2c $i$ \u6b21\u64cd\u4f5c\u65f6 $p$ \u7684\u4e0b\u6807\uff0c\u90a3\u4e48\u7edf\u8ba1\u533a\u95f4 $[l,r]$ \u65f6\u7b2c\u4e00\u6b21\u4e58\u4e0a\u8fdb\u5236\u7684\u5c31\u662f $base^{P_{l}}$\u3002\n\n\u6240\u4ee5\uff0c\u4e3a\u4e86\u6d88\u9664\u540e\u8005\u6bd4\u524d\u8005\u591a\u51fa\u7684\u4ece\u7b2c $0$ \u4f4d\u5230\u7b2c $l - 1$ \u4f4d\u7684\u4f4d\u79fb\uff0c\u6b63\u786e\u7684\u67ff\u5b50\u662f $\\dfrac{h(r)-h(l-1)}{base^{P_{l-1}}} = h(n)$\u3002\n\n### 3\n\n\u77e5\u9053\u4e86\u5982\u4f55\u5224\u65ad\u67d0\u4e00\u5b50\u533a\u95f4\u662f\u5426\u5408\u6cd5\u4e4b\u540e\uff0c\u518d\u8003\u8651\u5982\u4f55\u5c06\u5b83\u653e\u8fdb\u4ee3\u7801\u91cc\u5b9e\u73b0\u3002\n\n\u770b\u5230\u65f6\u95f4\u9650\u5236\u548c $\\left\\vert S \\right\\vert$ \u7684\u5927\u5c0f\u9650\u5236\uff0c\u53d1\u73b0\u7edf\u8ba1\u65f6\u4f3c\u4e4e\u53ea\u5141\u8bb8 $\\mathcal{\\text{O}}(n)$ \u7684\u590d\u6742\u5ea6\u3002\u8fd9\u5c31\u5f15\u5bfc\u6211\u4eec\u60f3\u5230\u4e00\u4e2a\u5927\u6982\u7684\u7edf\u8ba1\u65b9\u6cd5\uff1a\u679a\u4e3e $l$ \u904d\u5386 $1$ \u5230 $\\left\\vert S \\right\\vert$\uff0c\u7136\u540e\u7edf\u8ba1\u5408\u6cd5\u7684\u533a\u95f4\u53f3\u7aef\u70b9 $r$ \u7684\u6570\u91cf\u3002\u8fdb\u4e00\u6b65\u5730\uff0c\u8fd9\u6837\u4e00\u6765 $h(n)$ \u548c $h(l-1)$ \u5df2\u77e5\uff0c\u6839\u636e\u63a8\u51fa\u7684\u67ff\u5b50\u5c31\u53d1\u73b0 $h(r)$ \u5df2\u7ecf\u88ab\u552f\u4e00\u786e\u5b9a\u4e86\uff0c\u5373 $h(r)=h(n)\\times base^{P_{l-1}} + h(l-1)$\uff0c\u6240\u4ee5\u4e00\u5f00\u59cb\u8ba1\u7b97 $h(i)$ \u7684\u65f6\u5019\u5f00\u4e00\u4e2a `map` \u628a\u5b83\u4eec\u6309\u7167\u54c8\u5e0c\u503c\u7edf\u8ba1\u6570\u91cf\u5373\u53ef\u3002\n\n\u81f3\u6b64\uff0c\u6b64\u9898\u88ab\u5b8c\u7f8e\u89e3\u51b3\uff0c \u590d\u6742\u5ea6\u53ef\u8fc7\u3002\n\n### 4\n\n\u8fd8\u8981\u518d\u63d0\u4e00\u4e2a\u4ee3\u7801\u5b9e\u73b0\u7684\u65f6\u5019\u9700\u8981\u6ce8\u610f\u7684\u70b9\u3002\u9898\u76ee\u4e2d\u5df2\u8ff0\uff0c$p$ \u6709\u53ef\u80fd\u4e3a\u8d1f\u6570\u3002\u90a3\u4e48\u6b64\u65f6\u4e58\u4e0a\u7684\u8fdb\u5236\u5c31\u6210\u4e86 $base^{-\\left\\vert p \\right\\vert}$\uff0c\u7136\u540e\u7b80\u5355\u63a8\u4e00\u6ce2\u67ff\u5b50\uff1a$base^{-\\left\\vert p \\right\\vert}=(base^{-1})^{\\left\\vert p\\right\\vert}$\u3002\u800c $base^{-1}$ \u662f\u4ec0\u4e48\uff1f$base$ \u5728\u53d6\u6a21\u67d0\u4e2a\u6a21\u6570\u610f\u4e49\u4e0b\u7684\u9006\u5143\u3002\u56e0\u4e3a\u6a21\u6570\u6211\u4eec\u4e00\u5b9a\u4f1a\u8bbe\u4e3a\u4e00\u4e2a\u7d20\u6570\uff0c\u6545\u76f4\u63a5\u7528\u5feb\u901f\u5e42\u7b97\u51fa\u5176\u9006\u5143\u5373\u53ef\u3002\n\n\u9700\u8981\u53cc\u54c8\u5e0c\u3002\n\n\n## Code\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n\n#define rep(i, a, b) for(register int i = a; i <= b; ++i)\ntypedef long long ll;\nconst int maxn = 250005;\nconst int mod1 = 1e9 + 7, mod2 = 998244353;\nint n, p[maxn], bs = 121;\nchar c[maxn];\nmap<pair<int, int>, int> mp;\npair<int, int> hsh[maxn];\nll ans;\n\ninline int pw(int x, int p, int mod){\n\tint res = 1;\n\twhile(p){\n\t\tif(p & 1) \n\t\t\tres = 1ll * res * x % mod;\n\t\tp /= 2, x = 1ll * x * x % mod;\n\t} return res;\n}\ninline pair<int, int> gh(int x, int y){\n\tint a, b; a = b = x;\n\tif(y < 0) \n\t\ta = pw(a, mod1 - 2, mod1), b = pw(b, mod2 - 2, mod2), y *= -1; \n\treturn make_pair(pw(a, y, mod1), pw(b, y, mod2));\n}\n\ninline pair<int, int> add(pair<int, int> a, pair<int, int> b){\n\treturn make_pair((a.first + b.first) % mod1, (a.second + b.second) % mod2);\n}\ninline pair<int, int> mns(pair<int, int> a, pair<int, int> b){\n\treturn make_pair((a.first + mod1 - b.first) % mod1, (a.second + mod2 - b.second) % mod2);\n}\ninline pair<int, int> tim(pair<int, int> a, pair<int, int> b){\n\treturn make_pair((1ll * a.first * b.first) % mod1, (1ll * a.second * b.second) % mod2);\n}\n\nint main(){\n\tscanf(\"%d\", &n); \n\trep(i, 1, n){ \n\t\tchar c; cin >> c; \n\t\tp[i] = p[i - 1];\n\t\tif(c == '+') hsh[i] = add(hsh[i - 1], gh(bs, p[i]));\n\t\tif(c == '-') hsh[i] = mns(hsh[i - 1], gh(bs, p[i]));\n\t\tif(c == '<') hsh[i] = hsh[i - 1], p[i] -= 1;\n\t\tif(c == '>') hsh[i] = hsh[i - 1], p[i] += 1;\n\t\tmp[hsh[i]] += 1;\n\t}\n\trep(i, 1, n)\n\t\tans += mp[add(hsh[i - 1], tim(hsh[n], gh(bs, p[i - 1])))], \n\t\tmp[hsh[i]] -= 1;\n\tprintf(\"%lld\\n\", ans);\n\treturn 0;\n}\n```\n\n\n------------\n\u611f\u8c22\u9605\u8bfb\u3002",
        "postTime": 1657944600,
        "uid": 469672,
        "name": "\u4f0d\u53c1\u58f9",
        "ccfLevel": 7,
        "title": "\u3010ARC099D\u3011 Eating Symbols Hard \u9898\u89e3"
    },
    {
        "content": "\u7533\u8bf7\u6dfb\u52a0\u7b80\u8981\u9898\u610f(\u88ab\u7981\u8a00\u4e86)\n\n\u5e76\u4e14\u9898\u9762\u4e0a\u7684\u6837\u4f8b\u662f\u9519\u8bef\u7684,markdown\u672a\u663e\u793a\n\n### \u7b80\u8981\u9898\u610f\n\u4f60\u6709\u4e00\u4e2a\u521d\u59cb\u4e3a0\u7684\u6570\u7ec4\u548c\u4e00\u4e2a\u521d\u59cb\u57280\u7684\u6307\u9488,\u8303\u56f4\u53ef\u4ee5\u770b\u505a\u65e0\u9650\n\n\u7ed9\u51fa\u4e00\u4e2a\u64cd\u4f5c\u4e32,\u7531 $<,>,+,-$ \u7ec4\u6210,\u5176\u4e2d\u6bcf\u4e2a\u5b57\u7b26\u610f\u4e49\u5982\u4e0b\n\n* < \u5c06\u6307\u9488\u5de6\u79fb\u4e00\u4f4d\n\n* \\> \u5c06\u6307\u9488\u53f3\u79fb\u4e00\u4f4d\n\n* \\+ \u5c06\u6307\u9488\u5bf9\u5e94\u4f4d\u7f6e+1\n\n* \\- \u5c06\u6307\u9488\u5bf9\u5e94\u4f4d\u7f6e-1\n\n\u6c42\u6709\u591a\u5c11\u4e2a\u5b50\u4e32,\u4f7f\u5f97\u6267\u884c\u5b8c\u5b50\u4e32\u7684\u64cd\u4f5c\u540e,\u6570\u7ec4\u548c\u6267\u884c\u5b8c\u6574\u4e2a\u4e32\u662f\u4e00\u6837\u7684\n\n### sol\n\u8003\u8651\u7528hash\u6765\u89e3\u51b3\u95ee\u9898,\u4ece\u540e\u5f80\u524d\u626b\u8fc7\u6765,\u6bcf\u4e2a\u7b26\u53f7\u5bf9\u5e94hash\u503c\u5f97\u53d8\u5316\u5982\u4e0b\n\n* \\< \u4e58\u4ee5 $base^{-1}$\n* \\> \u4e58\u4ee5 $base$\n* \\+ \u52a0\u4e0a $base$\n* \\- \u51cf\u53bb $base$\n\n\u4f7f\u7528\u53cchash,\u7528map\u7ef4\u62a4\u5373\u53ef\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int N=1e6+5;\nconst int mod1=1e9+7;\nconst int P1=19260817;\nconst int P2=998244353;\nconst int mod2=1004535809;\n#define ll long long\ntypedef pair<ll,ll>Pi;\nll fsp(ll x,int y){\n\tll ans=1;\n\twhile(y){\n\t\tif(y&1)\tans=ans*x%mod1;\n\t\tx=x*x%mod1,y>>=1;\n\t}\n\treturn ans;\n}\nll ksm(ll x,int y){\n\tll ans=1;\n\twhile(y){\n\t\tif(y&1)\tans=ans*x%mod2;\n\t\tx=x*x%mod2,y>>=1;\n\t}\n\treturn ans;\n}\nchar s[N];\nmap<Pi,int>ma;\nll n,l1,l2=1,r1,r2=1,ans,res1,res2,add1,add2,inv1,inv2;\nint main(){\n\tscanf(\"%lld%s\",&n,s+1);\n\tadd1=fsp(P1,n);add2=ksm(P2,n);\n\tinv1=fsp(P1,mod1-2),inv2=ksm(P2,mod2-2);\n\tfor(int i=n;i;i--){\n\t\tif(s[i]=='-'){\n\t\t\tres1=(res1-add1+mod1)%mod1;\n\t\t\tres2=(res2-add2+mod2)%mod2;\n\t\t}\n\t\tif(s[i]=='+'){\n\t\t\tres1=(res1+add1)%mod1;\n\t\t\tres2=(res2+add2)%mod2;\n\t\t}\n\t\tif(s[i]=='<'){\n\t\t\tres1=res1*inv1%mod1;\n\t\t\tres2=res2*inv2%mod2;\n\t\t}\n\t\tif(s[i]=='>'){\n\t\t\tres1=res1*P1%mod1;\n\t\t\tres2=res2*P2%mod2;\n\t\t}\n\t}\n\tfor(int i=n;i;i--){\n\t\tll k1=0,k2=0;\n\t\tif(s[i]=='-'){\n\t\t\tl1=(l1-add1+mod1)%mod1,k1=mod1-add1;\n\t\t\tr1=(r1-add2+mod2)%mod2,k2=mod2-add2;\n\t\t}\n\t\tif(s[i]=='<'){\n\t\t\tl1=l1*inv1%mod1,l2=l2*inv1%mod1;\n\t\t\tr1=r1*inv2%mod2,r2=r2*inv2%mod2;\n\t\t}\n\t\tif(s[i]=='>'){\n\t\t\tl1=l1*P1%mod1,l2=l2*P1%mod1;\n\t\t\tr1=r1*P2%mod2,r2=r2*P2%mod2;\n\t\t}\n\t\tif(s[i]=='+'){\n\t\t\tl1=(l1+add1)%mod1,k1=add1;\n\t\t\tr1=(r1+add2)%mod2,k2=add2;\n\t\t}\n\t\t++ma[Pi((k1-l1+mod1)*fsp(l2,mod1-2)%mod1,(k2-r1+mod2)*ksm(r2,mod2-2)%mod2)];\n\t\tans+=ma[Pi((res1-l1+mod1)*fsp(l2,mod1-2)%mod1,(res2-r1+mod2)*ksm(r2,mod2-2)%mod2)];\n\t}\n\tprintf(\"%lld\\n\",ans);\n\treturn 0;\n}\n\n```\n",
        "postTime": 1582706265,
        "uid": 88567,
        "name": "lzk5627",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 AT4163 \u3010[ARC099D] Eating Symbols Hard\u3011"
    },
    {
        "content": "[$\\tt Link$](/problem/AT4163)\n\n\u628a\u4e00\u4e2a\u7b26\u5408\u8981\u6c42\u7684\u533a\u95f4 $[l,r]$ \u62c6\u6210 $[1,r]-[1,l-1]$\u3002\u4e8e\u662f\u95ee\u9898\u53d8\u6210\u4e86\u627e\u5230\u4e00\u4e9b\u7ed3\u679c\u76f8\u540c\u7684\u64cd\u4f5c\u5e8f\u5217\u524d\u7f00\u3002\n\n$p$ \u7684\u79fb\u52a8\uff0c\u6570\u7ec4\u7684\u4fee\u6539\u2026\u2026\u8981\u7ef4\u62a4\u7684\u4e1c\u897f\u592a\u591a\uff0c\u6211\u4eec\u96be\u4ee5\u76f4\u63a5\u5bf9\u6bcf\u4e2a\u64cd\u4f5c\u5224\u65ad\uff0c\u552f\u4e00\u7684\u53ef\u80fd\u7684\u662f**\u505a\u5b8c\u64cd\u4f5c\u540e\u5224\u65ad\u7ed3\u679c**\u3002\n\n\u4e8e\u662f\u4e0d\u59a8\u628a\u64cd\u4f5c\u5b8c\u540e\u7684\u5e8f\u5217\u54c8\u5e0c\u3002\u8bb0 $B,M$ \u662f\u9009\u53d6\u7684\u54c8\u5e0c\u5e95\u6570\uff0c\u6a21\u6570\uff0c$a$ \u662f\u64cd\u4f5c\u5b8c\u540e\u7684\u6570\u7ec4\uff0c\u90a3\u4e48\u5176\u54c8\u5e0c\u503c\u4e3a\n\n$$\\sum_{i\\in[-n,n]} a_iB^{i+n}\\bmod M$$\n\n\u5bf9\u4e8e\u6837\u4f8b $1$\uff0c\u6240\u6709\u64cd\u4f5c\u7684\u7ed3\u679c\u4e3a $\\{0,1,0,0,0\\}$\u3002\u753b\u51fa\u5b83\u6bcf\u6b21\u64cd\u4f5c\u540e\u7684\u7ed3\u679c\n\n$$\\begin{cases}\n1,0,0,0,0&p=0&\\texttt{case 1}\\\\\n1,0,0,0,0&p=1&\\texttt{case 2}\\\\\n1,1,0,0,0&p=1&\\texttt{case 3}\\\\\n1,1,0,0,0&p=0&\\texttt{case 4}\\\\\n0,1,0,0,0&p=0&\\texttt{case 5}\n\\end{cases}$$\n\n\u6ce8\u610f\u5230\uff1a\n\n+ $\\texttt{case 1-5}$ \u7b26\u5408\u6761\u4ef6\uff0c\u8bf4\u660e $[1,5]$ \u662f\u4e00\u7ec4\u7b54\u6848\n+ $\\texttt{case 2-4}$ \u7b26\u5408\u6761\u4ef6\uff0c\u8bf4\u660e $[2,4]$ \u662f\u4e00\u7ec4\u7b54\u6848\n+ $\\texttt{case 2-3}$ \u7b26\u5408\u6761\u4ef6\uff0c\u8bf4\u660e $[2,3]$ \u662f\u4e00\u7ec4\u7b54\u6848\n+ $\\texttt{case 3-4}$ \u4e5f\u7b26\u5408\u6761\u4ef6\uff0c\u4f46\u5b83\u4e0d\u662f\u7b54\u6848\n+ $\\texttt{case 3-3}$ \u4e5f\u7b26\u5408\u6761\u4ef6\uff0c\u4f46\u5b83\u4e0d\u662f\u7b54\u6848\n\n\u731c\u60f3\u4e00\u4e2a\u533a\u95f4\u662f\u5426\u6ee1\u8db3\u8981\u6c42\uff0c\u4e0d\u4ec5\u8ddf\u54c8\u5e0c\u503c\u76f8\u7b49\u6709\u5173\u7cfb\uff0c\u8fd8\u548c $p$ \u6307\u9488\u7684\u4f4d\u7f6e\u6709\u5173\u7cfb\u3002\u6bd4\u5982 $\\texttt{case 3-3}$\uff0c\u5b83\u7684 $p$ \u6307\u9488\u662f\u4ece $\\tt 1$ \u5f00\u59cb\u7684\u624d\u80fd\u6ee1\u8db3\u6761\u4ef6\uff0c\u5982\u679c\u4ece $0$ \u5f00\u59cb\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u4f1a\u6574\u4f53\u5de6\u79fb\uff0c\u4ece\u800c\u4e0d\u6ee1\u8db3\u6761\u4ef6\u3002\n\n\u56e0\u6b64\u4e00\u4e2a\u533a\u95f4\u7684\u8fd0\u7b97\u7ed3\u679c\uff0c\u5e94\u8be5\u662f $[1,r]$ \u7684\u54c8\u5e0c\u503c\uff0c\u51cf\u53bb **\u79fb\u4f4d** \u540e\u7684 $[1,l]$ \u7684\u54c8\u5e0c\u503c\u3002\n\n\u96be\u70b9\u5df2\u7ecf\u89e3\u51b3\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u7528 `map` \u4f5c\u6876\u6765\u7edf\u8ba1\u7b54\u6848\u4e86\u3002\n\n\u5bf9\u4e86\uff0c\u5355\u54c8\u5e0c\u51b2\u7a81\u6982\u7387\u5f88\u5927\uff0c\u5efa\u8bae\u53cc\u54c8\u5e0c\u3002\u4f46\u662f $3817$ \u8fd9\u4e2a\u6570\u505a\u54c8\u5e0c\u6211\u8ba4\u4e3a\u662f\u975e\u5e38\u597d\u7684\u3002\n\n```cpp\nusing hsh = unsigned long long;\n\nconst int N = 2.5e5,M = N * 2 + 5;\nconst hsh base1 = 3817,BASE1 = 544144620;\nconst hsh base2 = 1738,BASE2 = 608251306;\nconst hsh mod1 = 1e9 + 7,mod2 = 998244353;\n\nint n,m;\nchar s[N];\n\nint pos[N];\nhsh h1[N],h2[N],p1[M],P1[M],p2[M],P2[M],res1,res2;\nmap<pair<int,int>,int> H;\n\nint main(){\n\tscanf(\"%d%s\",&n,s + 1); m = n * 2;\n\tp1[0] = 1; rep(i,1,m) p1[i] = (p1[i - 1] * base1) % mod1;\n\tP1[0] = 1; rep(i,1,m) P1[i] = (P1[i - 1] * BASE1) % mod1;\n\tp2[0] = 1; rep(i,1,m) p2[i] = (p2[i - 1] * base2) % mod2;\n\tP2[0] = 1; rep(i,1,m) P2[i] = (P2[i - 1] * BASE2) % mod2;\n\tpos[0] = n;\n\trep(i,1,n){\n\t\tpos[i] = pos[i - 1];\n\t\tif(s[i] == '>') pos[i] = pos[i - 1] + 1;\n\t\tif(s[i] == '<') pos[i] = pos[i - 1] - 1;\n\t\tif(s[i] == '+') (res1 += p1[pos[i]]) %= mod1;\n\t\tif(s[i] == '-') (res1 += mod1 - p1[pos[i]]) %= mod1;\n\t\tif(s[i] == '+') (res2 += p2[pos[i]]) %= mod2;\n\t\tif(s[i] == '-') (res2 += mod2 - p2[pos[i]]) %= mod2;\n\t\th1[i] = res1; h2[i] = res2;\n\t}\n\tlong long sum = 0;\n\tRep(i,n - 1,0){\n\t\t++H[mp(h1[i + 1],h2[i + 1])];\n\t\thsh v1 = pos[i] <= n ? P1[n - pos[i]] : p1[pos[i] - n];\n\t\thsh v2 = pos[i] <= n ? P2[n - pos[i]] : p2[pos[i] - n];\n\t\thsh u1 = (h1[i] + (res1 * v1 % mod1)) % mod1;\n\t\thsh u2 = (h2[i] + (res2 * v2 % mod2)) % mod2;\n\t\tsum += H[mp(u1,u2)];\n\t}\n\tprintf(\"%lld\\n\",sum);\n\treturn 0;\n}",
        "postTime": 1657786226,
        "uid": 368107,
        "name": "xfrvq",
        "ccfLevel": 7,
        "title": "AT4163 [ARC099D] Eating Symbols Hard"
    },
    {
        "content": "### AT4163 [ARC099D] Eating Symbols Hard\n\n\u624b\u73a9\u6570\u636e\uff0c\u4e0d\u96be\u53d1\u73b0\uff0c\u8fd9\u51e0\u79cd\u64cd\u4f5c\u7c7b\u4f3c\u4e8e\u5b50\u4e32\u54c8\u5e0c\u7684\u8fc7\u7a0b\u3002\n\n\u533a\u95f4\u64cd\u4f5c\u5e8f\u5217\u5224\u65ad\u76f8\u540c\u66f4\u575a\u5b9a\u4e86\u6211\u4eec\u7684\u60f3\u6cd5\uff0c\u54c8\u5e0c\u89e3\u51b3\u95ee\u9898\u3002\n\n\u8003\u8651\u7ef4\u62a4\u524d\u7f00\u54c8\u5e0c\uff0c\u4e00\u4e2a\u533a\u95f4 $[l,r]$ \u7684\u54c8\u5e0c\u503c\uff0c\u5e94\u8be5\u662f $[1,r]$ \u7684\u54c8\u5e0c\u503c\uff0c\u51cf\u53bb $[1,l-1]$ \u79fb\u4f4d\u540e\u7684\u54c8\u5e0c\u503c\uff0c\u79fb\u4f4d\u987a\u4fbf\u7ef4\u62a4\u4e00\u4e0b\u5373\u53ef\u3002\n\n\u6700\u540e\u53cc\u6216\u4e09\u54c8\u5e0c\u5224\u65ad\uff0c\u5f00\u6876\u8bb0\u5f55\u4e2a\u6570\u5373\u53ef\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n)$\u3002\n\n```cpp\n#include<bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\ntypedef unsigned long long ull;\n\n#define ha putchar(' ')\n#define he putchar('\\n')\n\ninline int read()\n{\n\tint x = 0, f = 1;\n\tchar c = getchar();\n\twhile (c < '0' || c > '9')\n\t{\n\t\tif (c == '-')\n\t\t\tf = -1;\n\t\tc = getchar();\n\t}\n\twhile (c >= '0' && c <= '9')\n\t\tx = x * 10 + c - '0', c = getchar();\n\treturn x * f;\n}\n\ninline void write(ll x)\n{\n\tif(x < 0)\n\t{\n\t\tputchar('-');\n\t\tx = -x;\n\t}\n\tif(x > 9)\n\t\twrite(x / 10);\n\tputchar(x % 10 + '0');\n}\n\nconst int _ = 250010 * 2;\n\nconst ll bs1 = 819, Bs1 = 783725420, md1 = 998244353, bs2 = 1989, Bs2 = 227249785, md2 = 999999607, bs3 = 1998, Bs3 = 582062931, md3 = 999967099;\n\nll n, As, pos[_];\n\null r1, r2, r3, p1[_], P1[_], p2[_], P2[_], p3[_], P3[_], hs1[_], hs2[_], hs3[_];\n\nchar s[_];\n\nmap<tuple<int, int, int>, int> mp;\n\nsigned main()\n{\n\tn = read();\n\tscanf(\"%s\", s + 1);\n\tp1[0] = P1[0] = p2[0] = P2[0] = p3[0] = P3[0] = 1;\n\tfor(int i = 1; i <= n * 2; ++i)\n\t{\n\t\tp1[i] = p1[i - 1] * bs1 % md1;\n\t\tP1[i] = P1[i - 1] * Bs1 % md1;\n\t\tp2[i] = p2[i - 1] * bs2 % md2;\n\t\tP2[i] = P2[i - 1] * Bs2 % md2;\n\t\tp3[i] = p3[i - 1] * bs3 % md3;\n\t\tP3[i] = P3[i - 1] * Bs3 % md3;\n\t}\n\tpos[0] = n;\n\tfor(int i = 1; i <= n; ++i)\n\t{\n\t\tpos[i] = pos[i - 1];\n\t\tif(s[i] == '>') pos[i] = pos[i - 1] + 1;\n\t\tif(s[i] == '<') pos[i] = pos[i - 1] - 1;\n\t\tif(s[i] == '+')\n\t\t{\n\t\t\tr1 = (r1 + p1[pos[i]]) % md1;\n\t\t\tr2 = (r2 + p2[pos[i]]) % md2;\n\t\t\tr3 = (r3 + p3[pos[i]]) % md3;\n\t\t}\n\t\tif(s[i] == '-')\n\t\t{\n\t\t\tr1 = (r1 + md1 - p1[pos[i]]) % md1;\n\t\t\tr2 = (r2 + md2 - p2[pos[i]]) % md2;\n\t\t\tr3 = (r3 + md3 - p3[pos[i]]) % md3;\n\t\t}\n\t\ths1[i] = r1, hs2[i] = r2, hs3[i] = r3;\n\t}\n\tfor(int i = n - 1; i >= 0; --i)\n\t{\n\t\tmp[{hs1[i + 1], hs2[i + 1], hs3[i + 1]}]++;\n\t\tull k1 = (hs1[i] + (r1 * ((pos[i] <= n) ? P1[n - pos[i]] : p1[pos[i] - n]) % md1)) % md1;\n\t\tull k2 = (hs2[i] + (r2 * ((pos[i] <= n) ? P2[n - pos[i]] : p2[pos[i] - n]) % md2)) % md2;\n\t\tull k3 = (hs3[i] + (r3 * ((pos[i] <= n) ? P3[n - pos[i]] : p3[pos[i] - n]) % md3)) % md3;\n//\t\tcout << k1 << \" \" << k2 << \"\\n\";\n\t\tAs += mp[{k1, k2, k3}];\n\t}\n\twrite(As);\n\treturn 0;\n}\n```\n\n",
        "postTime": 1657796336,
        "uid": 257146,
        "name": "orz_z",
        "ccfLevel": 0,
        "title": "AT4163 [ARC099D] Eating Symbols Hard"
    },
    {
        "content": "\u5de6\u79fb\uff0c\u53f3\u79fb\uff0c\u4e00\u4e9b\u4f4d\u7f6e\u4e0a\u589e\u91cf\uff0c\u8fd9\u4e9b\u4fe1\u606f\u96be\u4ee5\u76f4\u63a5\u7ef4\u62a4\uff0c\u8fd9\u542f\u53d1\u6211\u4eec\u628a\u64cd\u4f5c\u5e8f\u5217\u66f4\u52a0\u5f62\u5f0f\u5316\uff0c\u4e5f\u5c31\u662f\u628a\u8fd9\u4e9b\u64cd\u4f5c\u9644\u52a0\u5728\u4e00\u4e2a\u66f4\u5bb9\u6613\u7ef4\u62a4\u7684\u5bf9\u8c61\u4e0a\uff0c\u5f62\u5f0f\u5e42\u7ea7\u6570 / hash \u5728\u672c\u9898\u4e2d\u662f\u5f88\u597d\u7684\u9009\u62e9\u3002\n\n\u4ee4 $F = \\sum_i A_i x^i$\uff0c$F_i$ \u4e3a\u6267\u884c\u64cd\u4f5c $1\u223ci$ \u540e $F$ \u7684\u503c\u3002\n\n\u73b0\u5728\u8003\u8651\u6c42\u6267\u884c\u64cd\u4f5c $l\u223cr$ \u540e\u7684 $F$\uff0c\u8fd9\u9700\u8981 $p_i$ \u8868\u793a\u6267\u884c\u64cd\u4f5c $1\u223ci$ \u540e\u6307\u9488\u7684\u4f4d\u7f6e\u3002\n\n\u6b64\u65f6 $F$ \u7684\u503c\u7b49\u4e8e$\\frac{F_R - F_{l-1}}{x^{p_{l-1}}}$\uff0c\u7ed9 $x$ \u8d4b\u4e00\u4e2a\u4efb\u610f\u503c\uff0c\u679a\u4e3e $l$\uff0c\u5229\u7528 $\\text{map}$ \u6c42\u51fa\u6ee1\u8db3\u6761\u4ef6\u7684 $r$ \u5373\u53ef\u3002",
        "postTime": 1651132041,
        "uid": 476082,
        "name": "ZhiYao",
        "ccfLevel": 0,
        "title": "[ARC099D] Eating Symbols Hard Sol"
    },
    {
        "content": "\u770b\u5230\u5927\u4f6c\u4eec\u90fd\u662f\u7528\u7684\u751f\u6210\u51fd\u6570\u4ec0\u4e48\u7684\uff0c\u90a3\u672c\u849f\u84bb\u5c31\u8bb2\u4e00\u4e2a\u7b80\u5355\u6613\u61c2\u7684\u505a\u6cd5\u5427\uff01\n\n#### \u601d\u8def\n\n\n\n\u5b9a\u4e49 $ h[i] $ \u4e3a\u7ecf\u8fc7 $ i $ \u6b21\u64cd\u4f5c\u540e\u7684\u6570\u7ec4\u7684\u54c8\u5e0c\u503c , $ pos[i] $ \u4e3a\u7ecf\u8fc7 $ i $ \u6b21\u64cd\u4f5c\u7684\u4f4d\u7f6e\u3002\n\n\u8bbe $ pos[0] = n$ \uff0c \u8fd9\u6837\u4fbf\u4e0d\u4f1a\u8d8a\u754c\u3002\n\n\u90a3\u4e48\u5bf9\u4e8e\u6bcf\u6b21\u64cd\u4f5c \uff1a\n\n\u5de6\u79fb \uff1a  $ pos[i] = pos[i - 1] - 1 $ \uff0c $ h[i] = h[i - 1] $\n\n\u5de6\u79fb \uff1a $ pos[i] = pos[i - 1] + 1 $ \uff0c $ h[i] = h[i - 1] $\n\n\u52a0 \uff1a $ pos[i] = pos[i - 1] $ \uff0c $ h[i] = h[i - 1] + m ^ { pos[i] } $ \n\n\u51cf \uff1a $ pos[i] = pos[i - 1] $ \uff0c $ h[i] = h[i - 1] - m ^ { pos[i] } $ \n\n\u5bf9\u4e8e\u67e5\u8be2\u79fb\u4e2a\u533a\u95f4\u7684h\u503c \uff0c \u4e0d\u8003\u8651\u5de6\u79fb\u53f3\u79fb\uff1a\n\n$ l $ \u5230 $ r $ \u7684\u54c8\u5e0c\u503c = $ h[r] - h[l - 1]$\n\n\u8003\u8651\u5de6\u79fb\u53f3\u79fb \uff0c \u82e5\u5148\u4e0d\u8003\u8651 \uff0c \u5219\u5f97\u51fa\u7684\u503c\u4e00\u5b9a\u4e3a\u79fb\u52a8\u4e86\u4e00\u6bb5\u518d\u505a\u7684 \uff0c \u53ea\u9700\u8003\u8651\u591a\u51fa\u7684\u6570\u91cf\u6216\u5c11\u7684\u6570\u91cf \uff1a\n\n\u82e5 $ pos[l - 1] > n $ \u5219\u4e3a\u591a\u7b97\u4e86 $ pos[l - 1] - n $ \n\n$ l $ \u5230 $ r $ \u7684\u54c8\u5e0c\u503c = $ ( h[r] - h[l - 1] ) / m ^ { pos[l - 1] - n }$\n\n\u82e5 $ pos[l - 1] < n $ \u5219\u4e3a\u5c11\u7b97\u4e86 $ n - pos[l - 1] $ \n\n$ l $ \u5230 $ r $ \u7684\u54c8\u5e0c\u503c = $ ( h[r] - h[l - 1] ) * m ^ { pos[l - 1] - n }$\n\n\u7ecf\u8fc7\u4e0a\u9762\u7684\u4e00\u987f\u64cd\u4f5c\u4e4b\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u5df2\u7ecf\u53ef\u4ee5\u6c42\u4efb\u610f\u4e00\u6bb5 $ l $ \u5230 $ r $ \u7684\u54c8\u5e0c\u503c\uff0c\u6b64\u65f6\u53ea\u9700\u6c42 \uff1a \n\u6709\u591a\u5c11 $ l $ \u548c $ r $ \u53ef\u4ee5\u4f7f\u5f97 $ HASH[1,n] $ = $ HASH[l,r] $\n\n\u53ef\u4ee5\u679a\u4e3e\u5de6\u7aef\u70b9 \uff0c \u6b64\u65f6\u77e5\u9053\u4e86 $ pos[l - 1] $ \u548c $ h[l - 1] $ \uff0c \u53ea\u9700\u89e3\u65b9\u7a0b\u5373\u53ef \u3002\n\n\u6ce8\u610f \uff0c \u56e0\u4e3a\u6709\u4e58\u53f7 \uff0c \u79fb\u9879\u540e\u4f1a\u53d8\u4e3a\u9664\u53f7 \uff0c \u6240\u4ee5\u8fd8\u9700\u8981\u9006\u5143 \u3002\n\n#### \u4ee3\u7801\n\n\u5fc5\u987b\u8981\u7528\u53cc\u54c8\u5e0c\u624d\u80fd\u8fc7 qwq\u3002\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\n#define mp make_pair\n#define m 131\n#define p 19260817\n#define sed 137\n#define mod 998244353\n#define pii pair<int,int>\nconst int N=500000+5;\nint n,pos[N];\nll h1[N],pw1[N],h2[N],pw2[N],ans;\nchar s[N];\nmap<pii,int>vis;\nll qpow1(ll a,int b){\n\tll sum=1;\n\twhile(b){\n\t\tif(b&1)sum=sum*a%p;\n\t\ta=a*a%p;\n\t\tb>>=1;\n\t}\n\treturn sum;\n}\nll qpow2(ll a,int b){\n\tll sum=1;\n\twhile(b){\n\t\tif(b&1)sum=sum*a%mod;\n\t\ta=a*a%mod;\n\t\tb>>=1;\n\t}\n\treturn sum;\n}\nll inv1(ll a){\n\treturn qpow1(a,p-2);\t\n}\nll inv2(ll a){\n\treturn qpow2(a,mod-2);\t\n}\nint main(){\n\tcin>>n;\n\tcin>>(s+1);\n\th1[0]=0;\n\th2[0]=0;\n\tpos[0]=n;\n\tpw1[0]=1;\n\tpw2[0]=1;\n\tfor(int i=1;i<N;++i)pw1[i]=pw1[i-1]*m%p,pw2[i]=pw2[i-1]*sed%mod;\n\tfor(int i=1;i<=n;++i){\n\t\tif(s[i]=='<')pos[i]=pos[i-1]-1,h1[i]=h1[i-1],h2[i]=h2[i-1];\n\t\telse if(s[i]=='>')pos[i]=pos[i-1]+1,h1[i]=h1[i-1],h2[i]=h2[i-1];\t\n\t\telse if(s[i]=='+')pos[i]=pos[i-1],h1[i]=(h1[i-1]+pw1[pos[i]])%p,h1[i]=(h1[i-1]+pw1[pos[i]])%p,h2[i]=(h2[i-1]+pw2[pos[i]])%mod;\n\t\telse pos[i]=pos[i-1],h1[i]=(h1[i-1]-pw1[pos[i]]+p)%p,h2[i]=(h2[i-1]-pw2[pos[i]]+mod)%mod;\n\t}\n\tpii r=mp(h1[n],h2[n]);\n\tfor(int i=n;i>=1;--i){\n\t\t++vis[mp(h1[i],h2[i])];\n\t\tif(pos[i-1]>n){\n\t\t\tll v1=(pw1[pos[i-1]-n]*r.first%p+h1[i-1])%p;\n\t\t\tll v2=(pw2[pos[i-1]-n]*r.second%mod+h2[i-1])%mod;\n\t\t\tans+=vis[mp(v1,v2)];\n\t\t}\n\t\telse{\n\t\t\tll v1=(inv1(pw1[n-pos[i-1]])*r.first%p+h1[i-1])%p;\n\t\t\tll v2=(inv2(pw2[n-pos[i-1]])*r.second%mod+h2[i-1])%mod;\n\t\t\tans+=vis[mp(v1,v2)];\n\t\t}\n\t}\n\tcout<<ans;\n\treturn 0;\n}",
        "postTime": 1647265122,
        "uid": 594904,
        "name": "TNTtramcar",
        "ccfLevel": 0,
        "title": "AT4163"
    },
    {
        "content": "\u8bbe\u64cd\u4f5c\u4e32\u4e3a$S$, $a$\u4e3a\u64cd\u4f5c\u540e\u7684\u5e8f\u5217, \u7ed9\u64cd\u4f5c\u4e32\u4e00\u4e2a\u54c8\u5e0c\u503c: \n\n$$\nHash(S)=(\\sum_{i=-\\infty}^{\\infty}a[i]*X^i)\\%mod\n$$\n\n\u5176\u4e2d$X$\u4e3a\u968f\u673a\u6570.\n\n\u5b9a\u4e49$g1(x)$\u4e3a\u5728\u54c8\u5e0c\u503c\u4e3a$x$\u7684\u64cd\u4f5c\u4e32\u524d\u52a0\u4e0a\u4e00\u4e2a\u5b57\u7b26'+'\u540e\u7684\u54c8\u5e0c\u503c, \u6613\u5f97$g1(x)=x+1$. \u7c7b\u4f3c\u7684, \u5b9a\u4e49$g2(x)$\u4e3a\u524d\u9762\u52a0\u4e0a\u5b57\u7b26'-'\u540e\u7684\u54c8\u5e0c\u503c, $g3(x)$\u4e3a\u524d\u9762\u52a0\u4e0a\u5b57\u7b26'>'\u540e\u7684\u54c8\u5e0c\u503c, $g4(x)$\u4e3a\u524d\u9762\u52a0\u4e0a\u5b57\u7b26'<'\u540e\u7684\u54c8\u5e0c\u503c, \u5219\u6709:\n$$\ng2(x)=x-1\n$$\n\n$$\ng3(x)=x*(X^{-1})\n$$\n\n$$\ng4(x)=x*X\n$$\n\n\u8bbe$f_{a,b}(x)$\u4e3a\u4ece\u54c8\u5e0c\u503c$x$\u5f00\u59cb, \u4f9d\u6b21\u6267\u884c\u4ece$S$\u7684\u7b2c$a$\u4e2a\u4f4d\u7f6e\u5230$S$\u7684\u7b2c$b$\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u5b57\u7b26\u5bf9\u5e94\u7684$g$\u51fd\u6570. \u76f8\u5e94\u7684, \u8bbe$g1^{-1}$, $g2^{-1}$, $g3^{-1}$, $g4^{-1}$ \u4e3a\u6bcf\u4e2a$g$\u51fd\u6570\u7684\u9006\u64cd\u4f5c, $f_{a,b}^{-1}(x)$\u4e3a\u4ece\u54c8\u5e0c\u503c$x$\u5f00\u59cb, \u4f9d\u6b21\u6267\u884c\u4ece$S$\u7684\u7b2c$a$\u4e2a\u4f4d\u7f6e\u5230$S$\u7684\u7b2c$b$\u4e2a\u4f4d\u7f6e\u4e0a\u7684\u5b57\u7b26\u5bf9\u5e94\u7684$g$\u51fd\u6570\u7684\u9006\u51fd\u6570.\n\n\u9898\u76ee\u8981\u6c42$f_{n,1}(0)=f_{j,i}(0)\\ \\ (j\\geq i)$\u7684$(i,j)$\u5bf9\u7684\u6570\u91cf. \u8fdb\u884c\u53d8\u6362:\n$$\nf_{n,1}(0)=f_{j,i}(0)\n$$\n\n$$\nf_{i,n}^{-1}(f_{n,1}(0))=f_{i,n}^{-1}(f_{j,i}(0))\n$$\n\n$$\nf_{i,n}^{-1}(f_{n,1}(0))=f_{j+1,n}^{-1}(0)\n$$\n\n$f_{n,1}(0)$\u53ef\u4ee5\u9884\u5148\u6c42\u51fa, \u90a3\u4e48\u6211\u4eec\u7ef4\u62a4$v1(i)=f_{i,n}^{-1}(f_{n,1}(0))$, $v2(i)=f_{i+1,n}^{-1}(0)$, \u7528map\u67e5\u8be2$v1[i]==v2[j]$\u7684$(i,j)$\u5bf9\u7684\u6570\u91cf\u5373\u53ef.\n\n\u5173\u4e8e$f_{i,n}^{-1}$\u600e\u4e48\u7ef4\u62a4. \u6ce8\u610f\u5230\u6bcf\u4e2a$g$\u51fd\u6570\u90fd\u662f\u5f62\u5982$x=kx+b$\u7684\u4e00\u6b21\u51fd\u6570, \u90a3\u4e48\u53ef\u4ee5\u7ef4\u62a4\u5d4c\u5957\u8d77\u6765\u7684\u603b\u51fd\u6570\u7684$k$\u548c$b$\u4e24\u4e2a\u503c, \u6bcf\u52a0\u5165\u4e00\u4e2a\u51fd\u6570\u8ba1\u7b97\u51fa\u65b0\u7684$k$\u548c$b$\u5373\u53ef.\n\n\u591a\u53d6\u51e0\u4e2a$X$\u907f\u514d\u51b2\u7a81.\n\nCode:\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int mod=1e9+7;\nint qpow(int x,int k)\n{\n    int r=1;\n    while(k)\n    {\n        if(k&1)r=1ll*r*x%mod;\n        k>>=1;x=1ll*x*x%mod;\n    }\n    return r;\n}\nint add(int x,int y){return x+y<mod?x+y:x+y-mod;}\nint n;\nchar s[300300];\n\nint X[6]={233,1919,114514,817,1001,9527};\nint inv[6];\nstruct Node {\n    int v[6];\n    bool operator < (const Node &o)const{\n        for(int i=0;i<6;++i)\n            if(v[i]!=o.v[i])return v[i]<o.v[i];\n        return 0;\n    }\n    void clear(){memset(v,0,sizeof(v));}\n    void f(char c)\n    {\n        if(c=='+') for(int i=0;i<6;++i)v[i]=add(v[i],1);\n        else if(c=='-') for(int i=0;i<6;++i)v[i]=add(v[i],mod-1);\n        else if(c=='>') for(int i=0;i<6;++i)v[i]=1ll*v[i]*X[i]%mod;\n        else if(c=='<') for(int i=0;i<6;++i)v[i]=1ll*v[i]*inv[i]%mod;\n    }\n};\nmap<Node,int>mp;\nstruct PNN{\n    Node k,b;\n    void clear() { for(int i=0;i<6;++i)k.v[i]=1,b.v[i]=0; }\n    void f(char c)\n    {\n        if(c=='+')for(int i=0;i<6;++i)b.v[i]=add(b.v[i],mod-k.v[i]);\n        else if(c=='-')for(int i=0;i<6;++i)b.v[i]=add(b.v[i],k.v[i]);\n        else if(c=='>')for(int i=0;i<6;++i)k.v[i]=1ll*k.v[i]*inv[i]%mod;\n        else if(c=='<')for(int i=0;i<6;++i)k.v[i]=1ll*k.v[i]*X[i]%mod;\n    }\n    Node calc(Node x)\n    {\n        Node res;\n        for(int i=0;i<6;++i)\n            res.v[i]=add(1ll*k.v[i]*x.v[i]%mod,b.v[i])%mod;\n        return res;\n    }\n};\nint main()\n{\n    for(int i=0;i<6;++i)inv[i]=qpow(X[i],mod-2);\n    scanf(\"%d\",&n);\n    scanf(\"%s\",s+1);\n    Node C;C.clear();\n    for(int i=n;i;--i)C.f(s[i]);\n    Node o;o.clear();\n    mp[o]++;\n    PNN cur;cur.clear();\n    long long ans=0;\n    for(int i=n;i;--i)\n    {\n        cur.f(s[i]);\n        Node tt=cur.calc(C);\n        ans+=mp[cur.calc(C)];\n        mp[cur.calc(o)]++;\n    }\n    printf(\"%lld\\n\",ans);\n    return 0;\n}\n\n```\n\n\n\n",
        "postTime": 1583488254,
        "uid": 52285,
        "name": "\u9017\u903c\u9886\u4e3b",
        "ccfLevel": 9,
        "title": "\u9898\u89e3 AT4163 \u3010[ARC099D] Eating Symbols Hard\u3011"
    }
]