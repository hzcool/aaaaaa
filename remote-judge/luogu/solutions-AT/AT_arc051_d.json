[
    {
        "content": "# [ARC051D]\u9577\u65b9\u5f62\n## \u9898\u76ee\u5927\u610f\uff1a\n\u7ed9\u5b9a$A_{1\\sim n}$\u548c$B_{1\\sim m}(n,m\\le2000,|A_i|,|B_i|\\le10^5)$\uff0c\u77e9\u9635$C_{i,j}=A_i+B_j$\u3002$q(q\\le2000)$\u6b21\u8be2\u95ee\uff0c\u6c42\u5750\u6807\u4e0d\u8d85\u8fc7$(x,y)$\u7684\u6700\u5927\u6743\u503c\u5b50\u77e9\u9635\u7684\u6743\u503c\u3002\n\n## \u601d\u8def\uff1a\n\u7528$maxa[i][j]$\u8868\u793a$A_{1\\sim i}$\u4e2d\u957f\u5ea6\u4e3a$j$\u7684\u6700\u5927\u8fde\u7eed\u5b50\u6bb5\u548c\uff0c$maxb$\u540c\u7406\u3002\n\n\u5bf9\u4e8e\u8be2\u95ee$(x,y)$\uff0c\u7b54\u6848\u5373\u4e3a$\\max\\{maxa[x][i]\\times j+maxb[y][j]\\times i\\mid i\\le x,j\\le y\\}$\u3002\n\n$\\max$\u5185\u53d8\u5f62\u540e\u5373\u4e3a$j\\times(maxa[x][i]+\\frac{maxb[y][j]\\times i}j)$\u3002\u62ec\u53f7\u5185\u7684\u4e1c\u897f\u53ef\u4ee5\u770b\u4f5c\u662f\u5173\u4e8e$\\frac{maxb[y][j]}j$\u7684\u4e00\u6b21\u51fd\u6570\uff0c\u4f7f\u7528\u674e\u8d85\u6811\u7ef4\u62a4\u51f8\u58f3\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6$\\mathcal O(qn\\log n)$\u3002\n\n## \u6e90\u4ee3\u7801\uff1a\n```cpp\n#include<cmath>\n#include<cstdio>\n#include<cctype>\n#include<climits>\n#include<algorithm>\ninline int getint() {\n\tregister char ch;\n\tregister bool neg=false;\n\twhile(!isdigit(ch=getchar())) neg|=ch=='-';\n\tregister int x=ch^'0';\n\twhile(isdigit(ch=getchar())) x=(((x<<2)+x)<<1)+(ch^'0');\n\treturn neg?-x:x;\n}\ntypedef long long int64;\nconst int N=2001,LIM=1e5,SIZE=(LIM<<1|1)<<2;\nint a[N],b[N],maxa[N][N],maxb[N][N];\nclass SegmentTree {\n\t#define _left <<1\n\t#define _right <<1|1\n\t#define mid ((b+e)>>1)\n\tprivate:\n\t\tstruct Node {\n\t\t\tint a,b,tim;\n\t\t};\n\t\tNode node[SIZE];\n\tpublic:\n\t\tvoid insert(const int &p,const int &b,const int &e,int i,int j,const int &t) {\n\t\t\tif(node[p].tim<t) {\n\t\t\t\tnode[p].a=i;\n\t\t\t\tnode[p].b=j;\n\t\t\t\tnode[p].tim=t;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tint64 lval1=1ll*node[p].a*b+node[p].b;\n\t\t\tint64 rval1=1ll*node[p].a*e+node[p].b;\n\t\t\tint64 lval2=1ll*i*b+j,rval2=1ll*i*e+j;\n\t\t\tif(lval1<lval2) {\n\t\t\t\tstd::swap(lval1,lval2);\n\t\t\t\tstd::swap(rval1,rval2);\n\t\t\t\tstd::swap(node[p].a,i);\n\t\t\t\tstd::swap(node[p].b,j);\n\t\t\t}\n\t\t\tif(rval1>=rval2||b==e) return;\n\t\t\tconst double c=1.*(j-node[p].b)/(node[p].a-i);\n\t\t\tif(c<=mid) {\n\t\t\t\tinsert(p _left,b,mid,node[p].a,node[p].b,t);\n\t\t\t\tnode[p].a=i;\n\t\t\t\tnode[p].b=j;\n\t\t\t} else {\n\t\t\t\tinsert(p _right,mid+1,e,i,j,t);\n\t\t\t}\n\t\t}\n\t\tdouble query(const int &p,const int &b,const int &e,const double &x,const int &t) const {\n\t\t\tif(node[p].tim<t) return -1e15;\n\t\t\tdouble ret=node[p].a*x+node[p].b;\n\t\t\tif(b==e) return ret;\n\t\t\tif(x<=mid) ret=std::max(ret,query(p _left,b,mid,x,t));\n\t\t\tif(x>mid) ret=std::max(ret,query(p _right,mid+1,e,x,t));\n\t\t\treturn ret;\n\t\t}\n\t#undef _left\n\t#undef _right\n\t#undef mid\n};\nSegmentTree t;\nint main() {\n\tconst int n=getint(),m=getint();\n\tfor(register int i=1;i<=n;i++) {\n\t\tmaxa[i][i]=a[i]=a[i-1]+getint();\n\t\tfor(register int j=1;j<i;j++) {\n\t\t\tmaxa[i][j]=std::max(maxa[i-1][j],a[i]-a[i-j]);\n\t\t}\n\t}\n\tfor(register int i=1;i<=m;i++) {\n\t\tmaxb[i][i]=b[i]=b[i-1]+getint();\n\t\tfor(register int j=1;j<i;j++) {\n\t\t\tmaxb[i][j]=std::max(maxb[i-1][j],b[i]-b[i-j]);\n\t\t}\n\t}\n\tconst int q=getint();\n\tfor(register int p=1;p<=q;p++) {\n\t\tconst int x=getint(),y=getint();\n\t\tfor(register int i=1;i<=x;i++) {\n\t\t\tt.insert(1,-LIM,LIM,i,maxa[x][i],p);\n\t\t}\n\t\tint64 ans=LLONG_MIN;\n\t\tfor(register int i=1;i<=y;i++) {\n\t\t\tans=std::max(ans,llround(t.query(1,-LIM,LIM,1.*maxb[y][i]/i,p)*i));\n\t\t}\n\t\tprintf(\"%lld\\n\",ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1532331123,
        "uid": 10086,
        "name": "skylee",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 AT1870 \u3010\u9577\u65b9\u5f62\u3011"
    }
]