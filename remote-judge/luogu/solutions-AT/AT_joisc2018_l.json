[
    {
        "content": "\u5389\u5bb3\u7684\u3002\n\n[\u300cJOISC 2018 Day 4\u300d\u91ce\u732a](https://www.luogu.com.cn/problem/AT_joisc2018_l)\n\n- \u7ed9\u5b9a\u8fde\u901a\u65e0\u5411\u56fe\uff0c\u4ee5\u53ca\u4e00\u4e2a\u8be2\u95ee\u5e8f\u5217 $A$\uff0c\u6c42\u4ece $A_1\\to A_2\\to \\cdots\\to A_L$ \u6700\u77ed\u8def\u5f84\u3002\n- \u8def\u5f84\u53ef\u4ee5\u662f\u4e0d\u7b80\u5355\u7684\uff0c\u4f46\u662f\u5982\u679c\u8def\u5f84\u7528\u4e00\u7ec4\u8fb9\u8868\u793a\uff0c\u5219 $(u,v)$ \u548c $(v,u)$ \u4e0d\u80fd\u4f5c\u4e3a\u76f8\u90bb\u5143\u7d20\u5b58\u5728\u3002\n- $q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u4f1a\u66f4\u6539\u4e00\u4e2a $A_i$\u3002\u4e0d\u5b58\u5728\u8fd9\u6837\u7684\u8def\u5f84\u8f93\u51fa `-1`\u3002\n- $n,m\\leq 2000,q,L\\leq 10^5$\u3002\n\n\u8003\u8651\u5bf9\u4e8e\u4efb\u610f\u4e24\u4e2a\u70b9\uff0c\u53ea\u627e\u6700\u77ed\u8def $(s,t)$ \u548c\u521d\u8fb9\u4e0e\u7ec8\u8fb9\u5747\u4e0e\u4e4b\u4e0d\u540c\u7684\u6b21\u77ed\u8def $(s',t')$\u3002\n\n\u53ef\u60dc\u662f\u5047\u7684\uff0c\u56e0\u4e3a\u6709\u53ef\u80fd\u53ea\u9700\u8981\u6ee1\u8db3\u4e00\u4e2a\u7aef\u70b9\u7684\u9650\u5236\uff0c\u6b64\u65f6\u6700\u77ed\u8def\u4e0d\u80fd\u7528\uff0c\u8fd9\u4e2a\u4e24\u4e2a\u9650\u5236\u7684\u6b21\u77ed\u8def\u53c8\u4e0d\u591f\u4f18\u79c0\u3002\n\n\u4f46\u8fd9\u662f\u53ef\u4ee5\u5f25\u8865\u7684\uff0c\u53ea\u9700\u8981\u627e\u51fa $4$ \u6761\u8def\u5f84\uff0c\u5206\u522b\u4e3a\uff1a\uff08\u8fd9\u91cc\u7684 $s,t$ \u8868\u521d\u8fb9\u4e0e\u7ec8\u8fb9\uff09\n\n- $(s_1,t_1)$\uff1a\u6700\u77ed\u8def\u3002\n- $(s_2,t_2)$\uff1a\u6b21\u77ed\u8def\uff0c$s_2\\neq s_1,t_2\\neq t_1$\u3002\n- $(s_3,t_3)$\uff1a\u6b21\u77ed\u8def\uff0c$s_3\\neq s_1,t_3\\neq t_2$\u3002\n- $(s_4,t_4)$\uff1a\u6b21\u77ed\u8def\uff0c$s_4\\neq s_2,t_4\\neq t_1$\u3002\n\n\u770b\u770b\u6570\u636e\u8303\u56f4\u548c\u523b\u610f\u7684\u4fee\u6539\u65b9\u5f0f\uff0c\u80af\u5b9a\u662f\u8981 DDP \u7684\u3002\n\n\u5047\u5982\u5df2\u7ecf\u5bf9\u4e8e\u6bcf\u5bf9\u70b9\u5904\u7406\u51fa\u4e86\u8fd9\u56db\u6761\u8def\u5f84\uff0c\u90a3\u4e48\u628a\u76f8\u90bb $3$ \u4e2a $(A_i,A_{i+1},A_{i+2})$ \u540c\u65f6\u8003\u8651\uff0c\u5c31\u77e5\u9053\u54ea\u4e9b\u8def\u5f84\u80fd\u591f\u540c\u65f6\u4f7f\u7528\u3002\n\n\u5f97\u5230\u4e00\u4e2a $4\\times 4$ \u7684\u77e9\u9635\uff0c\u8f6c\u79fb\u662f $(\\min,+)$ \u5f62\u5f0f\u7684\u77e9\u9635\u4e58\u6cd5\u3002\n\n\u503c\u5f97\u6ce8\u610f\u8981\u4ee4\u6700\u540e\u4e00\u4e2a\u4e3a $(A_{n-1},A_n,A_{n+1})$\uff0c\u8fd9\u6837\u7edf\u8ba1\u7b54\u6848\u6bd4\u8f83\u65b9\u4fbf\uff0c\u5f53\u7136\u8fd9\u662f\u5f88\u5e73\u51e1\u7684\u8ba8\u8bba\u3002\n\n\u53ea\u5269\u4e0b\u6c42\u90a3 $4$ \u6761\u8def\u5f84\u3002\n\n\u53d1\u73b0\u53ef\u4ee5\u5c06\u65e0\u5411\u8fb9\u62c6\u6210\u4e24\u6761\u6709\u5411\u8fb9\uff0c\u6c42\u4efb\u610f**\u4e24\u8fb9**\u95f4\u7684\u6700\u77ed\u8def\u7136\u540e\u76f4\u63a5\u679a\u4e3e\u66f4\u65b0\u7b54\u6848\u3002\n\n\u4ee5\u8fb9\u4e3a\u72b6\u6001\uff0c\u56e0\u4e3a\u8fd9\u6837\u53ef\u4ee5\u5f88\u597d\u7684\u5904\u7406\u9996\u5c3e\uff0c\u4ee5\u53ca\u4e0d\u80fd\u76f4\u63a5\u53cd\u5411\uff0c\u540c\u65f6\u70b9\u7684\u4fe1\u606f\u4e5f\u6ca1\u4e22\u3002\n\n\u4e0d\u80fd\u76f4\u63a5\u53cd\u5411\uff0c\u5c31\u662f\u5f53 $(u,v)$ \u8981\u6269\u5c55\u65f6\uff0c\u5728\u679a\u4e3e\u4ee5 $v$ \u4e3a\u7aef\u70b9\u7684\u51fa\u8fb9\u65f6\uff0c\u9664\u4e86 $(v,u)$ \u4e4b\u5916\u7684\u8fb9\u90fd\u8fdb\u884c\u6269\u5c55\uff0c\u7136\u540e\u7b2c\u4e8c\u6b21\u5230\u8fbe $v$ \u70b9\u65f6\uff0c\u518d\u5355\u72ec\u6269\u5c55 $(v,u)$\uff0c\u5176\u4f59\u4e0d\u7528\u6269\u5c55\u3002\n\n\u590d\u6742\u5ea6 $O(m^2\\log m+n^2+m^2+4^3n\\log n)$\uff0c\u95ee\u9898\u4e0d\u5927\u3002\n\n```cpp\n#include<bits/stdc++.h>\ntypedef long long LL;\n#define rep(i, a, b) for(int i = (a); i <= (b); i ++)\n#define per(i, a, b) for(int i = (a); i >= (b); i --)\n#define Ede(i, u) for(int i = head[u]; i; i = e[i].nxt)\nusing namespace std;\n\nint read() {\n\tint x = 0, f = 1; char c = getchar();\n\twhile(c < '0' || c > '9') f = (c == '-') ? - 1 : 1, c = getchar();\n\twhile(c >= '0' && c <= '9') x = x * 10 + c - 48, c = getchar();\n\treturn x * f;\n}\n\nconst int N = 2010;\nconst int M = N << 1;\nint n, m, Q, len;\nint cnt, A[M], B[M], C[M], op[M];\nvector<int> Gh[N], Gt[N];\n\nvoid Add(int u, int v, int w) {\n\tA[++ cnt] = u, B[cnt] = v, C[cnt] = w;\n\tGh[u].push_back(cnt);\n\tGt[v].push_back(cnt);\n}\n\nconst LL INF = 1e18;\nint las[N];\nLL dis[M][M];\nbool vis[M];\n\n#define MP make_pair\n#define se second\n\nvoid Dij(int s, LL dis[]) {\n\trep(i, 1, cnt) dis[i] = INF, vis[i] = false;\n\trep(i, 1, n) las[i] = 0;\n\tdis[s] = C[s];\n\tpriority_queue<pair<LL, int> > q;\n\tq.push(MP(- C[s], s));\n\twhile(! q.empty()) {\n\t\tint u = q.top().se; q.pop();\n\t\tif(vis[u]) continue;\n\t\tvis[u] = true;\n\n\t\tint c = B[u];\n\t\tif(! las[c]) {\n\t\t\tlas[c] = op[u];\n\t\t\tfor(int v : Gh[c]) {\n\t\t\t\tif(v == op[u]) continue;\n\t\t\t\tif(dis[v] > dis[u] + C[v])\n\t\t\t\t\tdis[v] = dis[u] + C[v], q.push(MP(- dis[v], v));\n\t\t\t}\n\t\t}\n\t\telse if(las[c] != - 1) {\n\t\t\tif(dis[las[c]] > dis[u] + C[las[c]])\n\t\t\t\tdis[las[c]] = dis[u] + C[las[c]], q.push(MP(- dis[las[c]], las[c]));\n\t\t\tlas[c] = - 1;\n\t\t}\n\t}\n}\n\nLL d[N][N][4];\nint L[N][N][4], R[N][N][4];\n// shortest (s1, t1)\n// completely different (s2, t2)\n// (s3 != s1, t3 != t2)\n// (s4 != s2, t4 != t1)\n\nvoid calc(int i, int j, int o, int u, int v) {\n\tif(d[i][j][o] > dis[u][v])\n\t\td[i][j][o] = dis[u][v], L[i][j][o] = u, R[i][j][o] = v;\n}\n\nconst int T = 1e5 + 10;\nint pos[T];\n\nstruct Matrix {\n\tLL mat[4][4];\n\tMatrix() {rep(i, 0, 3) rep(j, 0, 3) mat[i][j] = INF;}\n\tMatrix operator * (const Matrix &a) const {\n\t\tMatrix c;\n\t\trep(i, 0, 3) rep(j, 0, 3) rep(k, 0, 3)\n\t\t\tc.mat[i][j] = min(c.mat[i][j], mat[i][k] + a.mat[k][j]);\n\t\treturn c;\n\t}\n} sta[T], dat[T << 2];\n\nMatrix work(int x, int y, int z) {\n\tMatrix cur;\n\trep(i, 0, 3) rep(j, 0, 3)\n\t\tif(! z || R[x][y][i] != op[L[y][z][j]])\n\t\t\tcur.mat[i][j] = d[x][y][i];\n\treturn cur;\n}\n\nvoid Bui(int p, int l, int r) {\n\tif(l == r) {dat[p] = sta[l]; return;}\n\tint mid = (l + r) >> 1;\n\tBui(p << 1, l, mid), Bui(p << 1 | 1, mid + 1, r);\n\tdat[p] = dat[p << 1] * dat[p << 1 | 1];\n}\n\nvoid Moi(int p, int l, int r, int k, Matrix v) {\n\tif(l == r) {dat[p] = v; return;}\n\tint mid = (l + r) >> 1;\n\tif(k <= mid) Moi(p << 1, l, mid, k, v);\n\telse Moi(p << 1 | 1, mid + 1, r, k, v);\n\tdat[p] = dat[p << 1] * dat[p << 1 | 1];\n}\n\nint main() {\n\tn = read(), m = read(), Q = read(), len = read();\n\trep(i, 1, m) {\n\t\tint u = read(), v = read(), w = read();\n\t\tAdd(u, v, w);\n\t\tAdd(v, u, w);\n\t\top[op[cnt - 1] = cnt] = cnt - 1;\n\t}\n\trep(s, 1, cnt) Dij(s, dis[s]);\n\trep(i, 1, n) rep(j, 1, n) if(i != j) {\n\t\trep(k, 0, 3) d[i][j][k] = INF;\n\t\tfor(int u : Gh[i]) for(int v : Gt[j])\n\t\t\tcalc(i, j, 0, u, v);\n\t\tfor(int u : Gh[i]) for(int v : Gt[j])\n\t\t\tif(u != L[i][j][0] && v != R[i][j][0])\n\t\t\t\tcalc(i, j, 1, u, v);\n\t\tfor(int u : Gh[i]) for(int v : Gt[j])\n\t\t\tif(u != L[i][j][0] && v != R[i][j][1])\n\t\t\t\tcalc(i, j, 2, u, v);\n\t\tfor(int u : Gh[i]) for(int v : Gt[j])\n\t\t\tif(u != L[i][j][1] && v != R[i][j][0])\n\t\t\t\tcalc(i, j, 3, u, v);\n\t}\n\trep(i, 1, len) pos[i] = read();\n\trep(i, 1, len - 1)\n\t\tsta[i] = work(pos[i], pos[i + 1], pos[i + 2]);\n\tBui(1, 1, len - 1);\n\twhile(Q --) {\n\t\tint k = read(), v = read();\n\t\tpos[k] = v;\n\t\tif(k > 1) Moi(1, 1, len - 1, k - 1, work(pos[k - 1], pos[k], pos[k + 1]));\n\t\tif(k > 2) Moi(1, 1, len - 1, k - 2, work(pos[k - 2], pos[k - 1], pos[k]));\n\t\tif(k < len) Moi(1, 1, len - 1, k, work(pos[k], pos[k + 1], pos[k + 2]));\n\t\tLL ans = INF;\n\t\trep(i, 0, 3) ans = min(ans, dat[1].mat[i][0]);\n\t\tif(ans == INF) puts(\"-1\"); else printf(\"%lld\\n\", ans);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1668601112,
        "uid": 117941,
        "name": "_LPF_",
        "ccfLevel": 9,
        "title": "AT_joisc2018_l \u30a4\u30ce\u30b7\u30b7 (Wild Boar)"
    }
]