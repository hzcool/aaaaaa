[
    {
        "content": "~~\u6a21\u62df\u8d5b\u524d\u5077\u8fc7\u8fd8\u4e0d\u4f1a\u505a\u7684\u5c51~~\u3002\n\n\u8f7b\u8f7b\u8f7b\u5de5\u4e1a\u8fd8\u975e\u5e38\u597d\u7406\u89e3\uff0c\u611f\u8c22 @houzhiyuan \u5de8\u4f6c\u3002\n\n## Problem\n\n$n$ \u5bb6\u5e97\uff0c$m$ \u4e2a\u56e2\u961f\uff0c$q$ \u6b21\u64cd\u4f5c\uff0c\u6709\u4e09\u79cd\u64cd\u4f5c\uff1a\n\n`1 l r c k` \u8868\u793a $[l,r]$ \u5e97\u6765\u4e86 $k$ \u4e2a\u6765\u81ea $c$ \u56e2\u961f\u7684\u4eba\u6392\u961f\u3002\n\n`2 l r k` \u8868\u793a $[l,r]$ \u6709 $k$ \u4e2a\u4eba\u4ece\u524d\u9762\u6392\u5b8c\u79bb\u5f00\u3002\n\n`3 a b` \u8868\u793a\u8be2\u95ee\u7b2c $a$ \u5bb6\u5e97\u5f53\u524d\u961f\u4f0d\u7b2c $b$ \u4e2a\u4eba\u5c5e\u4e8e\u7684\u56e2\u961f\u3002\n\n$n,q\\le 2.5\\times10^5\\ ,k\\le 10^9\\ ,b\\le 10^{15}$\n### Algorithm 1\n$\\mathcal O(n^2)\\ $ \n\n\u76f4\u63a5\u5f00 $n$ \u4e2a `deque<pair<int,int>>` \u5bf9\u6bcf\u6b21\u8be2\u95ee\u76f4\u63a5\u505a\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u671f\u671b\u5f97\u5206 14pts\u3002\n### Algorithm 2\n\n$m=1$ \u76f8\u5f53\u4e8e\u8be2\u95ee\u5f53\u524d\u961f\u4f0d\u6709\u6ca1\u6709\u4eba\uff0cBIT \u7ef4\u62a4\u5373\u53ef\u3002\n\n\u671f\u671b\u5f97\u5206 21pts\u3002\n\n### Algorithm 3\n\u6ca1\u6709\u5220\u9664\u64cd\u4f5c\uff0c\u53ef\u4ee5\u8003\u8651\u6574\u4f53\u4e8c\u5206\uff1a\n\n\u73b0\u5728\u6211\u4eec\u628a\u95ee\u9898\u8f6c\u5316\u4e3a\u5bf9\u6bcf\u4e2a\u8be2\u95ee\u6c42\u5176\u5bf9\u5e94\u7684\u7b54\u6848\u5728\u54ea\u6b21\u64cd\u4f5c $1$\u3002\n\n\u5df2\u77e5\u96c6\u5408 $S$ \u7684\u7b54\u6848\u5168\u90e8\u4f4d\u4e8e\u533a\u95f4 $[l,r]$\uff0c\u8003\u8651\u6c42\u51fa $mid =\\dfrac{l+r}{2}$ \u65f6\u6bcf\u4e2a\u961f\u5217\u7684\u957f\u5ea6\uff0c\u7136\u540e\n\u5c06\u80fd\u786e\u5b9a\u7b54\u6848 $\\le mid$ \u7684\u8be2\u95ee\u548c $\\gt mid$ \u7684\u5206\u6210\u4e24\u534a\uff0c\u7136\u540e\u7ee7\u7eed\u9012\u5f52\u3002\n\n\u671f\u671b\u5f97\u5206 13pts\u3002\n\n\u8fd9\u65f6\u5019\u95ee\u9898\u663e\u73b0\u51fa\u6765\u4e86\uff0c\u5220\u9664\u64cd\u4f5c\u5bf9 $0$ \u53d6 $\\max$ \u5f88\u96be\u5904\u7406\u3002\n\n**Trick:** \u8f6c\u6362\u4e00\u4e0b\uff0c\u5047\u8bbe\u5220\u9664\u64cd\u4f5c\u7684\u6570\u6ca1\u6709\u5220\u9664\uff0c\u800c\u662f\u5728\u8be2\u95ee\u7684\u65f6\u5019\u52a0\u4e0a\u5220\u9664\u7684\u4eba\u3002\n\n$\\mathcal O(n\\log^2n)$\n\n\u73b0\u5728\u5c31\u53ef\u4ee5\u7528\u6574\u4f53\u4e8c\u5206\u6c42\u7b54\u6848\u4e86\u3002\n\n\u7ebf\u6bb5\u6811\u7ef4\u62a4\u4e00\u4e0b `max(x+a,b)` \u5c31\u80fd\u6c42\u51fa\u5b9e\u9645\u8be2\u95ee\u7684\u70b9\u4e86\u3002\n\n$\\mathcal O(n\\log n)$\n\n\u628a\u6574\u4f53\u4e8c\u5206\u6362\u6210\u7ebf\u6bb5\u6811\u5206\u6cbb\u5c31\u80fd\u505a\u5230\u3002\n\n\u671f\u671b\u5f97\u5206 100pts\u3002\n### Algorithm 4\n**\u8f7b\u5de5\u4e1a\uff1a** \u628a\u65f6\u95f4\u8f74\u548c\u5e97\u53cd\u4e00\u4e0b\uff0c\u4ece\u7b2c $1$ \u5bb6\u5e97\u5230\u7b2c $n$ \u5bb6\u5e97\u505a\u4e00\u904d\u626b\u63cf\u7ebf\u3002\n\n\u53ef\u4ee5\u53d1\u73b0\uff0c\u5b9e\u9645\u4e0a\u6bcf\u6b21\u5220\u9664\u64cd\u4f5c\u662f\u5bf9\u4e00\u6bb5\u540e\u7f00\u4ea7\u751f\u8d21\u732e\uff0c\u8fd9\u6837\u76f4\u63a5\u7528\u4e00\u9897\u7ebf\u6bb5\u6811\u7ef4\u62a4\u6700\u5c0f\u503c\uff0c\u7136\u540e\u6bcf\u6b21\u8be2\u95ee\u6700\u5c0f\u503c\u5c31\u662f\u4e0a\u9762 Trick \u91cc\u5220\u9664\u7684\u4eba\u6570\u4e86\u3002\n\n\u7136\u540e\u76f4\u63a5\u5728\u53e6\u4e00\u9897\u8bb0\u5f55\u7ebf\u6bb5\u6811\u4e0a\u4e8c\u5206\u51fa\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e \u5220\u9664\u4eba\u6570+\u5f53\u70b9\u4eba\u6570 \u7684\u4eba\u7fa4\u7f16\u53f7\u5373\u53ef\u3002\n\n\u4e24\u9897\u7ebf\u6bb5\u6811\u90fd\u53ea\u8981\u7ef4\u62a4 $\\max$ \u6216 $\\min$\uff0c\u76f4\u63a5\u7528\u4e00\u4e2a\u7ed3\u6784\u4f53\u5c31\u884c\u4e86\u3002\n\n## Code\n```cpp\n#include<bits/stdc++.h>\n#define ll long long\n#define ri register\n#define all(x) (x).begin(),(x).end()\n#define fi first\n#define se second\nusing namespace std;\ntemplate<typename T_>void operator+=(vector<T_>&x,const T_&y){x.push_back(y);}\nconst int N=2.5e5+7;\nconst ll inf=1e18;\nint n,m,q,id[N],ans[N];\nll B;\nstruct SegmentTree{\n\tll t[N<<2],mi[N<<2],mx[N<<2],lzy[N<<2];\n\tvoid push_up(int rt){\n\t\tmx[rt]=max(mx[rt<<1],mx[rt<<1|1]);\n\t\tmi[rt]=min(mi[rt<<1],mi[rt<<1|1]); \n\t}\n\tvoid f(int rt,ll k){mi[rt]+=k,t[rt]+=k,mx[rt]+=k,lzy[rt]+=k;}\n\tvoid push_down(int rt){\n\t\tif(!lzy[rt])return;\n\t\tf(rt<<1,lzy[rt]),f(rt<<1|1,lzy[rt]);\n\t\tlzy[rt]=0; \n\t}\n\tll query(int x,int l,int r,int rt){\n\t\tif(l==r)return t[rt];\n\t\tpush_down(rt);int mid=(l+r)>>1;\n\t\tif(x<=mid)return query(x,l,mid,rt<<1);\n\t\tif(x>mid) return query(x,mid+1,r,rt<<1|1);\n\t\treturn-1;\n\t}\n\tll qmi(int L,int R,int l,int r,int rt){\n\t\tif(L<=l&&r<=R)return mi[rt];\n\t\tpush_down(rt);int mid=(l+r)>>1;ll res=inf;\n\t\tif(L<=mid)res=min(res,qmi(L,R,l,mid,rt<<1));\n\t\tif(R>mid) res=min(res,qmi(L,R,mid+1,r,rt<<1|1));\n\t\treturn res;\n\t}\n\tint find(int L,int R,ll x,int l,int r,int rt){\n\t\tif(mx[rt]<x)return 0;\n\t\tif(l==r)return id[l];\n\t\tpush_down(rt);int mid=(l+r)>>1;\n\t\tif(L<=l&&r<=R){\n\t\t\tif(mx[rt<<1|1]>=x)return find(L,R,x,mid+1,r,rt<<1|1);\n\t\t\treturn find(L,R,x,l,mid,rt<<1);\n\t\t}else if(R>mid){\n\t\t\tint k=find(L,R,x,mid+1,r,rt<<1|1);\n\t\t\tif(k)return k;\n\t\t}\n\t\treturn find(L,R,x,l,mid,rt<<1);\n\t}\n\tvoid update(int L,int R,int k,int l,int r,int rt){\n\t\tif(L<=l&&r<=R)return f(rt,k);\n\t\tpush_down(rt);int mid=(l+r)>>1;\n\t\tif(L<=mid)update(L,R,k,l,mid,rt<<1);\n\t\tif(R>mid) update(L,R,k,mid+1,r,rt<<1|1);\n\t\tpush_up(rt);\n\t}\n}T1,T2;\nvector<pair<int,int>>ad[N],del[N];\nvector<pair<int,ll>>Q[N];\nint main(){\n\tios::sync_with_stdio(0),cin.tie(0),cout.tie(0);\n\tcin>>n>>m>>q;\n\tfor(int i=1,op,l,r,c,k;i<=q;i++){\n\t\tcin>>op;\n\t\tswitch(op){\n\t\t\tcase 1:\n\t\t\t\tcin>>l>>r>>c>>k,id[i]=c;\n\t\t\t\tad[l]+={i,k},ad[r+1]+={i,-k};\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tcin>>l>>r>>k;\n\t\t\t\tdel[l]+={i,-k},del[r+1]+={i,k};\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tcin>>l>>B,Q[l]+={i,B};\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tmemset(ans,-1,sizeof(ans));\n\tfor(int i=1;i<=n;i++){\n\t\tfor(auto j:ad[i])\n\t\t\tT1.update(j.fi,q,j.se,1,q,1),T2.update(1,j.fi,j.se,1,q,1);\n\t\tfor(auto j:del[i])T1.update(j.fi,q,j.se,1,q,1);\n\t\tfor(auto j:Q[i]){\n\t\t\tll x=T1.query(j.fi,1,q,1)-min(T1.qmi(1,j.fi,1,q,1),0ll),y=j.se;\n\t\t\tif(y>x)ans[j.fi]=0;\n\t\t\telse{\n\t\t\t\tx=x-y+1;\n\t\t\t\tans[j.fi]=T2.find(1,j.fi,x+T2.query(j.fi,1,q,1),1,q,1);\n\t\t\t}\n\t\t}\n\t}\n\tfor(int i=1;i<=q;i++)\n\t\tif(~ans[i])cout<<ans[i]<<'\\n';\n\treturn 0;\n}\n```",
        "postTime": 1667280322,
        "uid": 262322,
        "name": "panyanppyy",
        "ccfLevel": 5,
        "title": "AT_joisc2021_c"
    }
]