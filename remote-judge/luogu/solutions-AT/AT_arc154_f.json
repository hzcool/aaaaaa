[
    {
        "content": "\u53e3\u80e1\u9898\u89e3\uff0c\u6709\u9519\u8bef\u6b22\u8fce\u6307\u51fa\u3002\n\n\u8bbe $F(x)$ \u4e3a\u6070\u597d $i$ \u8f6e\u6ee1\u8db3\u6761\u4ef6\u7684\u6982\u7387\u751f\u6210\u51fd\u6570\u3002\u53ef\u4ee5\u53d1\u73b0\u6211\u4eec\u9700\u8981\u6c42\u7684\u662f $F(e^x)$ \u7684\u524d $m$ \u6b21\u9879\u7cfb\u6570\u3002\n\n\u90a3\u4e48\u53ef\u4ee5\u5f97\u5230\uff1a\n\n$$\\operatorname{EGF}(F(x))=x(e^{\\frac{x}{n}}-1)^{n-1}$$\n\n\u5176\u610f\u4e49\u662f\u6700\u540e\u4e00\u4e2a\u6570\u4e00\u5b9a\u662f\u7b2c\u4e00\u6b21\u88ab\u968f\u673a\u5230\uff0c\u7edf\u8ba1\u5269\u4e0b\u7684 $n-1$ \u79cd\u6570\u7684\u65b9\u6848\u6570\u3002\n\n$$\\operatorname{EGF}(F(x))=x(e^{\\frac{x}{n}}-1)^{n-1}$$\n\n$$\\sum\\limits_{i=0}^{n-1}(-1)^{n-i-1}\\dbinom{n-1}{i}xe^{\\frac{ix}{n}}$$\n\n\u6211\u4eec\u8003\u8651\u901a\u8fc7 $\\operatorname{EGF}(F(x))$ \u63a8\u51fa $F(x)$\uff1a\n\n\u5173\u6ce8\u5176\u4e2d\u4e00\u90e8\u5206\u7684 $\\operatorname{EGF}$ \u4e3a\uff1a\n\n$$xe^{\\frac{ix}{n}}=\\sum\\limits_{j=0}^{\\infty}\\dfrac{\\left(\\dfrac{i}{n}\\right)^jx^{j+1}}{j!}$$\n\n\u90a3\u4e48\u5b83\u7684 $\\operatorname{OGF}$ \u4e3a\uff1a\n\n$$\\sum\\limits_{j=0}^{\\infty}\\left(\\dfrac{i}{n}\\right)^j(j+1)x^{j+1}$$\n\n$$=\\dfrac{n}{i}\\sum\\limits_{j=0}^{\\infty}j\\left(\\dfrac{ix}{n}\\right)^j$$\n\n$$=\\dfrac{x}{(1-\\dfrac{ix}{n})^2}$$\n\n\u56e0\u6b64\u53ef\u4ee5\u63a8\u51fa $F(x)$ \u7684\u8868\u8fbe\u5f0f\uff1a\n\n$$\\sum\\limits_{i=0}^{n-1}(-1)^{n-i-1}\\dbinom{n-1}{i}\\dfrac{x}{(1-\\dfrac{ix}{n})^2}$$\n\n\u56e0\u4e3a $e^x$ \u7684\u5e38\u6570\u9879\u4e3a $1$\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u53ea\u4fdd\u7559 $F(x+1)$ \u7684\u524d $m$ \u6b21\u9879\u7cfb\u6570\u3002\n\n\u800c $F(x+1)$ \u662f $O(n)$ \u4e2a\u5206\u5b50\u5206\u6bcd\u7684\u6b21\u6570\u4e0d\u8d85\u8fc7 $2$ \u7684\u6709\u7406\u5206\u5f0f\u7684\u7ebf\u6027\u7ec4\u5408\uff0c\u6240\u4ee5\u5b83\u7684\u5206\u5b50\u5206\u6bcd\u7684\u6b21\u6570\u662f $O(n)$ \u7684\u3002\u53ef\u4ee5\u901a\u8fc7\u5206\u6cbb FFT \u8ba1\u7b97\u5f97\u5230\u5206\u5b50\u5206\u6bcd\uff0c\u8fdb\u800c\u901a\u8fc7\u591a\u9879\u5f0f\u6c42\u9006\u5f97\u5230\u5b83\u7684\u524d $m$ \u6b21\u9879\u7cfb\u6570\u3002\u8bbe\u4e3a $\\mathcal{F}(x+1)$\u3002\n\n\u6709\u4e86 $\\mathcal{F}(x+1)$\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e00\u6b21\u5377\u79ef\u5f97\u5230 $\\mathcal{F}(x)$\u3002\u53ea\u9700\u8981\u6c42\u51fa $\\mathcal{F}(e^x)$ \u5373\u53ef\u3002\n\n\u663e\u7136 $\\mathcal{F}(x)$ \u7684\u6b21\u6570\u4e0d\u8d85\u8fc7 $m$\u3002\u8bbe $\\mathcal{F}(x)=\\sum\\limits_{i=0}^{\\infty}a_ix^i$\u3002\n\n\u6211\u4eec\u76f8\u5f53\u4e8e\u8981\u6c42\u51fa\uff1a\n\n$$\\sum\\limits_{i=0}^m\\dfrac{a_i}{1-ix}$$\n\n\u800c\u8fd9\u4e0e\u4e0a\u9762\u4e00\u90e8\u5206\u7c7b\u4f3c\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5206\u6cbb FFT \u89e3\u51b3\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2 n)$\u3002",
        "postTime": 1674824456,
        "uid": 119621,
        "name": "Kubic",
        "ccfLevel": 10,
        "title": "[ARC154F] Dice Game"
    },
    {
        "content": "\u8003\u8651\u8ba1\u7b97\u4e22\u7b2c $t$ \u6b21\u65f6\u521a\u597d\u5408\u6cd5\u7684\u6982\u7387\uff1a$[x^{t-1}](t-1)!\\frac{n}{n}(e^{\\frac{x}{n}}-1)^{n-1}=[x^t]t!x\\frac{(e^{\\frac{x}{n}}-1)^{n-1}}{t}$ \u3002\n\n\u5982\u679c\u4ee4 $h_t=[x^t]t!x(e^{\\frac{x}{n}}-1)^{n-1}$ \uff0c\u5219\u7b49\u540c\u4e8e\u8981\u6c42 $\\sum h_tt^{k-1}$ \u3002\n\n\u8003\u8651\u8ba1\u7b97\u51fa $F(x)$ \u4e3a $x(e^{\\frac{x}{n}}-1)^{n-1}$ \u8f6c OGF \u7684\u7ed3\u679c\uff0c\u5219 $k+1$ \u7684\u7b54\u6848\u662f $[x^k]k!F(e^x)$ \u3002\n\n\u8003\u8651 $x(e^{\\frac{x}{n}}-1)^{n-1}$ \u8f6c OGF \u4e3a $\\sum\\tbinom{n-1}{i}(-1)^{n-1-i}\\sum\\limits_{o=0}^{+\\infty}x^{o+1}(\\frac{i}{n})^o\\frac{(o+1)!}{o!}=\\sum\\tbinom{n-1}{i}(-1)^{n-1-i}\\frac{x}{(1-\\frac{i}{n}x)^2}$ \u3002\n\n\u5219\u901a\u8fc7\u5206\u6cbb NTT \uff0c\u53ef\u4ee5\u628a $F(x)$ \u7b97\u6210\u4e00\u4e2a $\\frac{H(x)}{G(x)}$ \u7684\u5f62\u5f0f\u3002\n\n\u63a5\u4e0b\u6765\u6211\u4eec\u60f3\u6c42 $F(e^x)$ \u7684\u524d $m$ \u9879\uff0c\u76f4\u63a5\u5148\u7b97 $F(x)$ \uff0c$x^m$ \u5904\u622a\u65ad\uff0c\u518d\u7b97 $F(e^x)$ \u662f\u9519\u7684\uff0c\u56e0\u4e3a $F$ \u6709\u65e0\u9650\u9879\u3002\n\n\u5148\u7b97 $H(e^x)$ \u548c $G(e^x)$ \uff0c\u4ece $m$ \u5904\u622a\u65ad\uff0c\u518d\u7b97 $F(e^x)=\\frac{H(e^x)}{G(e^x)}$ \uff0c\u53ef\u4ee5\u53d1\u73b0\u5c31\u5bf9\u4e86\u3002\n\n\u8ba1\u7b97\u4e00\u4e2a $F(e^x)$ \u7684\u65b9\u5f0f\u662f\u7b97 $\\sum \\frac{f_i}{1-ix}$ \uff0c\u8fd9\u4e5f\u80fd\u5206\u6cbb NTT\u3002",
        "postTime": 1679366381,
        "uid": 319444,
        "name": "Coward2008",
        "ccfLevel": 0,
        "title": "ARC154F Dice Game"
    },
    {
        "content": "## \u9898\u89e3\n\u548c\u5b98\u65b9\u9898\u89e3\u597d\u50cf\u4e0d\u4e00\u6837\uff0c\u545c\u545c\u545c\u3002\n\n\u8003\u8651\u5927\u529b DP\uff0c\u8bb0 $F_d(x)$ \u4e3a $d$ \u5230 $n$ \u6b65\u6570\u671f\u671b\u7684 EGF\uff0c$[x^m]F_d(x)$ \u4e3a $d$ \u5230 $n$ \u6b65\u6570 $m$ \u6b21\u65b9\u7684\u671f\u671b\u3002\n\n\u6211\u4eec\u53d1\u73b0 $F_d(x)=F_{d+1}(x)\\dfrac{e^x}{1-\\frac{d}{n-d}(e^x-1)}$\uff0c\u4ee4 $y=e^x$\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 $F_1(e^x)$\uff0c\u8fb9\u754c\u6761\u4ef6\u4e3a $F_n(x)=1$\u3002\n\n\u8003\u8651\u5c06 $F_1(e^x)$ \u8f6c\u56de $F_1(x)$\uff0c\u6211\u4e0d\u4f1a\u3002\n\n\u795e Alpha \u544a\u8bc9\u6211 $n![x^n]e^{ix}=[x^n]\\frac{1}{1-ix}$\uff0c\u56e0\u6b64\u6211\u4eec\u73b0\u5728\u53ea\u9700\u8981\u6c42 $\\sum\\frac{F[i]}{1-ix}$ \u5c31\u53ef\u4ee5\u4e86\u3002\u4f46\u662f\u6ce8\u610f\u5230\u5206\u5f0f\u5c55\u5f00\u4e4b\u540e\u6709\u65e0\u7a77\u9879\u800c\u6bcf\u4e00\u9879\u90fd\u6709\u8d21\u732e\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u8f6c\u3002\n\n\u795e JV \u544a\u8bc9\u6211\u6211\u4eec\u53ef\u4ee5\u6c42 $F(e^x-1)$\uff0c\u8fd9\u6837\u5c31\u53ea\u7528\u6c42\u524d $m$ \u9879\u4e86\uff0c\u7136\u540e\u5c55\u5f00\u5230 $F(e^x)$\uff0c\u6b64\u65f6\u8fd8\u662f\u53ea\u6709 $m$ \u9879\uff0c\u518d\u7528\u4e0a\u9762\u7684\u65b9\u6cd5\u5373\u53ef\u3002\n\n\u8fd9\u4e2a\u53ef\u4ee5\u5206\u6cbb NTT \u505a\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(n\\log^2n+m\\log^2m)$\u3002\n## \u4ee3\u7801\n\u5728\u9ad8\u901f\u516c\u8def\u4e0a\u5199\u7684\uff0c\u6211\u8ba4\u4e3a\u8fd9\u662f\u6211\u5199\u8fc7\u6700\u4e11\u7684\u4ee3\u7801\u4e4b\u4e00\uff0c\u80fd\u4e0d\u53c2\u8003\u5c31\u4e0d\u53c2\u8003\u3002\n\n```cpp\n//\u4e0d\u56de\u5bb6\u4e86\uff0c\u6211\u4eec\u53bb\u9e1f\u5de2\uff01\n#include<bits/stdc++.h>\n#pragma GCC optimize(\"Ofast\")\n#pragma GCC optimize(\"unroll-loops\")\nusing namespace std;\ninline int read(){\n   int s=0;\n   char ch=getchar();\n   while(ch<'0') ch=getchar();\n   while(ch>='0') s=s*10+(ch&15),ch=getchar();\n   return s;\n}\n#define ll long long\n#define ull unsigned long long\ninline ull calc(const ull&x){return x-(__uint128_t(x)*9920937979283557439ull>>93)*998244353;}\nconst ll p=998244353;\ninline ll qp(ll x,int y)\n{\n    ll res=1;\n    for(ll t=x; y; t=calc(t*t),y>>=1) \n    \tif(y&1) res=calc(res*t);\n    return res;\n}\nll A[1<<20],B[1<<20],tmp[1<<20];\nint rev[1<<20],N=1;\ninline void init()\n{\n    rev[0]=0,rev[1]=N>>1;\n    for(int i=2,d=N>>2; i<N; i<<=1,d>>=1)\n        for(int j=0; j<i; ++j) rev[i+j]=rev[j]+d;\n    return ;\n}\ninline void NTT(ll* F,int op)\n{\n    for(int i=0; i<N; ++i) if(rev[i]>i) F[i]^=F[rev[i]]^=F[i]^=F[rev[i]];\n    for(int len=2,M=1; len<=N; len<<=1,M<<=1)\n    {\n        ll w=qp(op?3:332748118,998244352/len);\n        for(int l=0; l<N; l+=len)\n        {\n            ll w0=1;\n            for(int i=l; i<l+M; ++i)\n            {\n                ll x=F[i],y=calc(w0*F[i+M]);\n                ((F[i]=x+y)>=p)&&(F[i]-=p),((F[i+M]=x-y)<0)&&(F[i+M]+=p),w0=calc(w0*w);\n            }\n        }\n    }\n}\nll *f[1<<21],*g[1<<21];\nint len[1<<21];\nint n=read(),m=read();\nvoid solve(int l,int r,int x)\n{\n\tif(l==r)\n\t{\n\t\tf[x]=new ll[2],f[x][0]=1,\n\t\tf[x][1]=(p-1ll*(l-1)*qp(n-l+1,p-2)%p)%p,len[x]=1;\n\t\treturn ;\n\t}\n\tint mid=(l+r)>>1;\n\tsolve(l,mid,x<<1),solve(mid+1,r,(x<<1)+1);\n\tlen[x]=len[x<<1]+len[(x<<1)+1],f[x]=new ll[len[x]+1];\n\tfor(N=1;N<=len[x];N<<=1);\n\tinit();\n\tfor(int i=0; i<=len[x<<1]; ++i) A[i]=f[x<<1][i];\n\tfor(int i=0; i<=len[(x<<1)+1]; ++i) B[i]=f[(x<<1)+1][i];\n\tNTT(A,1),NTT(B,1);\n\tfor(int i=0; i<N; ++i) A[i]=calc(A[i]*B[i]);\n\tNTT(A,0);\n\tint inv=qp(N,p-2);\n\tfor(int i=0; i<=len[x]; ++i) f[x][i]=calc(A[i]*inv);\n\tmemset(A,0,N<<3),memset(B,0,N<<3);\n\tdelete f[x<<1],delete f[(x<<1)+1];\n\treturn ;\n}\nll x[1<<20],y[1<<20];\nvoid getinv(ll const *f,ll *g,int n)\n{\n    g[0]=y[0]=qp(f[0],p-2);\n    ll inv;\n    for(int lim=1; lim<n; lim<<=1)\n    {\n        memcpy(x,f,lim<<4);\n        memset(y+(lim<<1),0,lim<<4);\n        N=lim<<1,init(),inv=qp(N,p-2);\n        NTT(x,1),NTT(y,1);\n        for(int i=0; i<N; ++i) x[i]=calc(x[i]*y[i]);\n        NTT(x,0);\n        for(int i=0; i<N; ++i) x[i]=calc(x[i]*inv);\n        memset(x,0,lim<<3);\n        NTT(x,1);\n        for(int i=0; i<N; ++i) x[i]=calc(x[i]*y[i]);\n        NTT(x,0);\n        for(int i=0; i<N; ++i) x[i]=calc(x[i]*inv);\n        for(int i=lim; i<N; ++i) g[i]=(p-x[i])%p;\n        if(N<n) memcpy(y,g,lim<<4);\n    }\n}\nint fac[500003],ifac[500003],ans[500003];\ninline int C(int n,int m)\n{return 1ll*fac[n]*ifac[m]%p*ifac[n-m]%p;}\nvoid calc(int l,int r,int x)\n{\n\tif(l==r)\n\t{\n\t\tf[x]=new ll[2],f[x][0]=tmp[l],f[x][1]=0,len[x]=1,\n\t\tg[x]=new ll[2],g[x][0]=1,g[x][1]=(p-l-n)%p;\n\t\treturn ;\n\t}\n\tint mid=(l+r)>>1;\n\tcalc(l,mid,x<<1),calc(mid+1,r,(x<<1)+1);\n\tlen[x]=len[x<<1]+len[(x<<1)+1],\n\tf[x]=new ll[len[x]+1],\n\tg[x]=new ll[len[x]+1];\n\tfor(N=1;N<=len[x];N<<=1);\n\tint inv=qp(N,p-2);\n\tmemset(A,0,N<<3),memset(B,0,N<<3);\n\t\n\tinit();\n\tfor(int i=0; i<=len[x<<1]; ++i) A[i]=g[x<<1][i];\n\tfor(int i=0; i<=len[(x<<1)+1]; ++i) B[i]=g[(x<<1)+1][i];\n\tNTT(A,1),NTT(B,1);\n\tfor(int i=0; i<N; ++i) A[i]=calc(A[i]*B[i]);\n\tNTT(A,0);\n\tfor(int i=0; i<=len[x]; ++i) g[x][i]=calc(A[i]*inv);\n\tmemset(A,0,N<<3),memset(B,0,N<<3);\n\t\n\tfor(int i=0; i<=len[x<<1]; ++i) A[i]=f[x<<1][i];\n\tfor(int i=0; i<=len[(x<<1)+1]; ++i) B[i]=g[(x<<1)+1][i];\n\tNTT(A,1),NTT(B,1);\n\tfor(int i=0; i<N; ++i) A[i]=calc(A[i]*B[i]);\n\tNTT(A,0);\n\tfor(int i=0; i<=len[x]; ++i) f[x][i]=calc(A[i]*inv);\n\tmemset(A,0,N<<3),memset(B,0,N<<3);\n\t\n\tfor(int i=0; i<=len[x<<1]; ++i) A[i]=g[x<<1][i];\n\tfor(int i=0; i<=len[(x<<1)+1]; ++i) B[i]=f[(x<<1)+1][i];\n\tNTT(A,1),NTT(B,1);\n\tfor(int i=0; i<N; ++i) A[i]=calc(A[i]*B[i]);\n\tNTT(A,0);\n\tfor(int i=0; i<=len[x]; ++i)\n\t\tf[x][i]=(calc(A[i]*inv)+f[x][i])%p;\n\tmemset(A,0,N<<3),memset(B,0,N<<3);\n\t\n\tdelete f[x<<1],delete f[(x<<1)+1],\n\tdelete g[x<<1],delete g[(x<<1)+1];\n\treturn ;\n}\nsigned main()\n{\n\tconst int M=2e5;\n\tfac[0]=ifac[0]=1;\n\tfor(int i=1; i<=M; ++i)\n\t\tfac[i]=1ll*fac[i-1]*i%p;\n\tifac[M]=qp(fac[M],p-2);\n\tfor(int i=M-1; i>=1; --i)\n\t\tifac[i]=1ll*ifac[i+1]*(i+1)%p;\n\tsolve(1,n,1),\n\tmemcpy(A,f[1],(n+1)<<3),\n\tdelete f[1],\n\tgetinv(A,B,m+1),\n\tmemset(A,0,sizeof(A));\n\t\n\tfor(int i=1; i<=m; i+=2) B[i]=(p-B[i])%p;\n\tfor(int i=1; i<=m; ++i) B[i]=1ll*B[i]*fac[i]%p;\n\tfor(int i=0; i<=m; ++i) tmp[i]=ifac[i];\n\treverse(B,B+m+1);\n\tfor(N=1;N<=(m<<1);N<<=1);\n\tinit(),NTT(B,1),NTT(tmp,1);\n\tfor(int i=0; i<N; ++i)\n\t\tA[i]=1ll*B[i]*tmp[i]%p;\n\tNTT(A,0);\n\tint qwq=qp(N,p-2);\n\tfor(int i=0; i<N; ++i) A[i]=1ll*A[i]*qwq%p;\n\treverse(A,A+m+1);\n\tfor(int i=1; i<=m; i+=2) A[i]=(p-A[i])%p;\n\tfor(int i=1; i<=m; ++i) A[i]=1ll*A[i]*ifac[i]%p;\n\t\n\t\n\tmemset(tmp,0,sizeof(tmp)),\n\tswap(A,tmp),\n\tcalc(0,m,1),\n\tmemset(A,0,sizeof(A)),\n\tmemset(B,0,sizeof(B)),\n\tmemcpy(A,g[1],(m+2)<<3),\n\tmemset(x,0,sizeof(x)),\n\tmemset(y,0,sizeof(y)),\n\tgetinv(A,B,m+2),\n\tmemset(A,0,sizeof(A)),\n\tmemcpy(A,f[1],(m+2)<<3);\n\tfor(N=1; N<=(m<<1)+2; N<<=1);\n\tinit(),NTT(A,1),NTT(B,1);\n\tfor(int i=0; i<N; ++i) A[i]=1ll*A[i]*B[i]%p;\n\tNTT(A,0);\n\tint inv=qp(N,p-2);\n\tfor(int i=1; i<=m; ++i)\n\t\tprintf(\"%lld\\n\",1ll*A[i]*inv%p);\n\treturn 0;\n}\n```",
        "postTime": 1674575192,
        "uid": 111055,
        "name": "dead_X",
        "ccfLevel": 8,
        "title": "\u9898\u89e3 ARC154F"
    },
    {
        "content": "\n\u63d0\u4f9b\u4e00\u79cd\u4e0d\u4f7f\u7528\u751f\u6210\u51fd\u6570\u7684\u66b4\u529b\u505a\u6cd5\u3002\n\n\u8003\u8651\u6254 $i$ \u6b21\u5df2\u7ecf\u6254\u51fa\u6240\u6709\u9762\u7684\u6982\u7387\u4e3a $n! \\dfrac{S2(i,n)}{n^i}$\uff0c\u4e8e\u662f\u671f\u671b\u65f6\u95f4\u7684 $k$ \u6b21\u65b9\u4e3a\uff1a\n\n$$s_k =n!\\sum\\limits_{i \\geq 0} (\\dfrac{S2(i,n)}{n^i}-\\dfrac{S2(i-1,n)}{n^{i-1}}) i^k$$\n\n\u4e3a\u4e86\u65b9\u4fbf\u8ba1\u7b97\uff0c\u53d6\u4e00\u4e2a\u8d8b\u8fd1\u4e8e\u65e0\u7a77\u5927\u7684\u6574\u6570 $m$\uff0c\u53ea\u8ba1\u7b97\u548c\u5f0f\u4e2d $i \\leq m$ \u7684\u90e8\u5206\u3002\n\n\u4e0b\u9762\u7528 $\\epsilon(m)$ \u8868\u793a\u5f53 $m$ \u8d8b\u8fd1\u4e8e\u65e0\u7a77\u5927\u65f6\u503c\u8d8b\u8fd1\u4e8e $0$ \u7684\u90e8\u5206\uff08\u4e8e\u662f\u5728\u6700\u7ec8\u7b54\u6848\u7684\u8ba1\u7b97\u4e2d\u53ef\u4ee5\u5ffd\u7565\uff09\u3002\u7ed3\u8bba\uff1a\u5bf9\u4e8e\u975e\u8d1f\u6574\u6570 $k$ \u4e0e\u5b9e\u6570 $a \\in (0,1)$\uff0c$\\lim\\limits_{x \\rightarrow \\infty} x^k a^x=0$\u3002\n\n$$\n\\begin{aligned}\ns_k(m) &=n!\\sum\\limits_{i=0}^m (\\dfrac{S2(i,n)}{n^i}-\\dfrac{S2(i-1,n)}{n^{i-1}}) i^k\\\\\n&=n! m^k \\dfrac{S2(m,n)}{n^m}-n! \\sum\\limits_{i=0}^{m-1} \\dfrac{S2(i,n)}{n^{i}} [(i+1)^k-i^k]\\\\\n\\end{aligned}\n$$\n\n\u8bbe $k-1$ \u6b21\u4e0b\u964d\u5e42\u591a\u9879\u5f0f $\\sum\\limits_{p=0}^{k-1} c_p x^{\\underline{p}}=(x+1)^k-x^k$\u3002\u7cfb\u6570 $c_p$ \u7a0d\u540e\u518d\u8fdb\u884c\u63a8\u5bfc\uff0c\u4e0b\u9762\u7ee7\u7eed\u8ba1\u7b97\u4e0a\u5f0f\uff1a\n\n$$\n\\begin{aligned}\ns_k(m) &=n! m^k \\dfrac{S2(m,n)}{n^m}-n! \\sum\\limits_{p=0}^{k-1} c_p \\sum\\limits_{i=0}^{m-1} \\dfrac{S2(i,n)}{n^{i}} i^{\\underline{p}}\\\\\n&=\\dfrac{m^k}{n^m} \\sum\\limits_{t=0}^n (-1)^t \\dbinom{n}{t} (n-t)^m -\\sum\\limits_{p=0}^{k-1} c_p \\sum\\limits_{i=0}^{m-1} i^{\\underline{p}} \\sum\\limits_{t=0}^n (-1)^t \\dbinom{n}{t}  \\dfrac{(n-t)^i}{n^{i}}\\\\\n\n&=m^k \\sum\\limits_{t=0}^n (-1)^t \\dbinom{n}{t} (\\dfrac{n-t}{n})^m -\\sum\\limits_{p=0}^{k-1} c_p \\sum\\limits_{t=0}^n (-1)^t \\dbinom{n}{t} \\sum\\limits_{i=0}^{m-1} (\\dfrac{n-t}{n})^i i^{\\underline{p}}\\\\\n\n\\end{aligned}\n$$\n\n\u7b2c\u4e00\u4e2a\u548c\u5f0f\u4e2d\uff0c\u5f53 $t \\neq 0$ \u65f6\u5747\u8d8b\u8fd1\u4e8e $0$\uff0c\u6545\u5176\u7b49\u4e8e $m^k+\\epsilon(m)$\u3002\n\n\u7b2c\u4e8c\u4e2a\u548c\u5f0f\u4e2d\uff0c\u8003\u8651\u6c42 $\\sum\\limits_{i=0}^{m-1} (\\dfrac{n-t}{n})^i i^{\\underline{p}}$\uff1a\n\n- \u5f53 $t=0$ \u65f6\uff0c\u5176\u7b49\u4e8e $\\sum\\limits_{i=0}^{m-1} i^{\\underline{p}}=\\dfrac{1}{p+1} m^{\\underline{p+1}}$\u3002\n\n- \u5f53 $t \\neq 0$ \u65f6\uff0c\u8bb0 $a=\\dfrac{n-t}{n}$\uff0c$f(x)=\\sum\\limits_{i=0}^{m-1} a^i x^i=\\dfrac{1-(ax)^m}{1-ax}$\uff0c\u6240\u6c42\u5373\uff1a\n\n$$f^{(p)}(1)=p!\\dfrac{a^p}{(1-ax)^{p+1}}+\\epsilon(m)=p! \\dfrac{n}{t} (\\dfrac{n-t}{t})^p+\\epsilon(m)$$\n\n\u4e8e\u662f\u5e26\u5165\u5f97\uff1a\n\n$$\ns_k(m) =m^k+\\epsilon(m) -\\sum\\limits_{p=0}^{k-1} c_p \\dfrac{1}{p+1} m^{\\underline{p+1}} - \\sum\\limits_{p=0}^{k-1} c_p \\sum\\limits_{t=1}^n (-1)^t \\dbinom{n}{t} [p! \\dfrac{n}{t} (\\dfrac{n-t}{t})^p+\\epsilon(m)]\n$$\n\n\u63a5\u4e0b\u6765\u5148\u63a8\u5bfc $c_t$\uff1a\n\n$$\n\\begin{aligned}\n\\sum\\limits_{p=0}^{k-1} \\dbinom{k}{p} x^p &= \\sum\\limits_{p=0}^{k-1} \\dbinom{k}{p} \\sum\\limits_{t=0}^p S2(p,t) x^{\\underline{t}}\\\\\n&= \\sum\\limits_{t=0}^{k-1} x^{\\underline{t}} \\sum\\limits_{p=t}^{k-1} \\dbinom{k}{p} S2(p,t) \\\\\n\\end{aligned}\n$$\n\n$$\n\\begin{aligned}\nc_p &=\\sum\\limits_{t=p}^{k-1} \\dbinom{k}{t} S2(t,p)\\\\\n&=\\sum\\limits_{t=p}^{k} \\dbinom{k}{t} S2(t,p) -S2(k,t)\\\\\n&=S2(k+1,t+1)-S2(k,t)\\\\\n&=(t+1) S2(k,t+1)\\\\\n\\end{aligned}\n$$\n\n$$\ns_k(m) =m^k+\\epsilon(m) -\\sum\\limits_{p=0}^{k-1} S2(k,p+1) m^{\\underline{p+1}} - \\sum\\limits_{p=0}^{k-1} (p+1) S2(k,p+1) \\sum\\limits_{t=1}^n (-1)^t \\dbinom{n}{t} [p! \\dfrac{n}{t} (\\dfrac{n-t}{t})^p+\\epsilon(m)]\n$$\n\n\u53ef\u4ee5\u53d1\u73b0\u5173\u4e8e $m$ \u7684\u90e8\u5206\u5168\u90e8\u6d88\u6389\u4e86\u3002\n\n$$\ns_k=- \\sum\\limits_{p=0}^{k-1} (p+1)! S2(k,p+1) \\sum\\limits_{t=1}^n (-1)^t \\dbinom{n}{t} \\dfrac{n}{t} (\\dfrac{n-t}{t})^p\n$$\n\n$$\ns_k=\\sum\\limits_{p=1}^{k} p! S2(k,p) \\sum\\limits_{t=1}^n (-1)^{t+1} \\dbinom{n}{t} \\dfrac{n}{t} (\\dfrac{n-t}{t})^{p-1}\n$$\n\n\u53ef\u4ee5\u5206\u4e24\u6b65\u8ba1\u7b97\uff1a\n\n- $$f_p=\\sum\\limits_{t=1}^n (-1)^{t+1} \\dbinom{n}{t} \\dfrac{n}{t} (\\dfrac{n-t}{t})^{p-1}$$\n\n- $$s_k=\\sum\\limits_{p=1}^{k} p! S2(k,p) f_p$$\n\n\u7b2c\u4e00\u6b65\u5373\u8ba1\u7b97\u6570\u5217 $k$ \u6b21\u5e42\u548c\uff0c\u4f7f\u7528\u5206\u6cbb\u4e58\u505a\u5230 $O(n \\log^2 n+m \\log m)$\u3002\u5177\u4f53\u505a\u6cd5\u53ef\u89c1 [P4705 \u73a9\u6e38\u620f](https://www.luogu.com.cn/problem/P4705).\n\n\u7b2c\u4e8c\u6b65\uff0c\u5c06\u7b2c\u4e8c\u7c7b\u65af\u7279\u6797\u6570\u62c6\u5f00\uff1a\n\n$$\n\\begin{aligned}\ns_k &= \\sum\\limits_{p=1}^{k} f_p \\sum\\limits_{t=0}^p (-1)^t \\dbinom{p}{t} (p-t)^k\\\\\n&= \\sum\\limits_{p=1}^{k} f_p \\sum\\limits_{t=0}^p (-1)^{p-t} \\dbinom{p}{t} t^k\\\\\n&= \\sum\\limits_{p=1}^{m} (-1)^p f_p \\sum\\limits_{t=0}^m (-1)^t \\dbinom{p}{t} t^k\\\\\n&= \\sum\\limits_{t=0}^m (-1)^t t^k \\sum\\limits_{p=1}^{m} (-1)^p \\dbinom{p}{t} f_p \\\\\n\\end{aligned}\n$$\n\n\u540c\u6837\u5206\u4e24\u6b65\u8ba1\u7b97\uff1a\n\n- $$g_t=\\sum\\limits_{p=1}^{m} (-1)^p \\dbinom{p}{t} f_p$$\n\n- $$s_k=\\sum\\limits_{t=0}^m (-1)^t t^k g_t$$\n\n\u7b2c\u4e00\u6b65\u53ef\u4ee5\u76f4\u63a5 NTT \u8ba1\u7b97\uff0c\u590d\u6742\u5ea6 $O(m \\log m)$\u3002\n\n\u7b2c\u4e8c\u6b65\u540c\u6837\u662f\u8ba1\u7b97\u6570\u5217 $k$ \u6b21\u5e42\u548c\uff0c\u590d\u6742\u5ea6 $O(m \\log^2 m)$\u3002\n\n\u7efc\u4e0a\uff0c\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(n \\log^2 n+m \\log^2 m)$\u3002\n\n#### Code\n\n```cpp\n...\nnamespace task{\n\tint A[N],B[N],tmp[N];\n\tvector <int> P[N],Q[N];\n\n\tvoid solve(int o,int l,int r,int *a,int *b){\n\t\tint len=r-l+1;\n\t\tP[o].clear(); Q[o].clear();\n\t\tP[o].resize(len+2);\n\t\tQ[o].resize(len+2);\n\t\t\n\t\tif(l==r){\n\t\t\tP[o]={b[l]};\n\t\t\tQ[o]={1,mod-a[l]};\n\t\t\treturn ;\n\t\t}\n\t\tint mid=(l+r)>>1;\n\t\tsolve(o<<1,l,mid,a,b);\n\t\tsolve(o<<1|1,mid+1,r,a,b);\n\t\t\n\t\tNTT::solve(P[o].data(),P[o<<1].data(),Q[o<<1|1].data(),mid-l+1,r-mid);\n\t\tNTT::solve(tmp,Q[o<<1].data(),P[o<<1|1].data(),mid-l+1,r-mid);\n\t\tfor(int i=0;i<=len;i++) gmod(P[o][i]+=tmp[i]);\n\t\t\n\t\tNTT::solve(Q[o].data(),Q[o<<1].data(),Q[o<<1|1].data(),mid-l+1,r-mid);\n\t}\n\tvoid sol(int *s,int *a,int *b,int n,int m){\n\t\tsolve(1,1,n,a,b);\n\t\tfor(int i=0;i<=m;i++) A[i]=B[i]=0;\n\t\tfor(long long i=0;i<=n;i++) A[i]=P[1][i],B[i]=Q[1][i];\n\t\tINV::solve(B,B,m);\n\t\tNTT::solve(s,A,B,m,m);\n\t}\n}\n\nint n,m;\nint a[N],b[N];\nint F[N],G[N],H[N],s[N];\n\nint main(){\n\tinit(N-5);\n\tcin>>n>>m;\n\tif(n==1){\n\t\tfor(int i=1;i<=m;i++) cout<<1<<'\\n';\n\t\treturn 0;\n\t}\n\t\n\tfor(int i=1;i<n;i++) a[i]=1ll*(n-i)*invv[i]%mod,b[i]=1ll*ID(i)*C(n,i)%mod*invv[n-i]%mod;\n\ttask::sol(F,a,b,n-1,m);\n\tgmod(F[1]+=1ll*ID(n)*invv[n]%mod);\n\t\n\tfor(int i=0;i<=m;i++) F[i]=1ll*F[i]*mul[i]%mod;\n\tfor(int i=0;i<=m;i++) H[m-i]=1ll*ID(i)*inv[i]%mod;\n\tNTT::solve(H,F,H,m,m);\n\tfor(int i=0;i<=m;i++) G[i]=1ll*H[i+m]*inv[i]%mod;\n\t\n\tfor(int i=1;i<=m;i++) a[i]=i,b[i]=G[i];\n\ttask::sol(s,a,b,m,m);\n\t\n\tfor(int k=1;k<=m;k++) cout<<1ll*(mod-s[k])*n%mod<<'\\n';\n}\n```",
        "postTime": 1680220148,
        "uid": 225645,
        "name": "\u82f9\u679c\u84dd17",
        "ccfLevel": 8,
        "title": "ARC154F Dice Game \u9898\u89e3"
    }
]