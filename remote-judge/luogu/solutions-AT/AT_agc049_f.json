[
    {
        "content": "\u8bb0 $L=2\\times 10^5$ \u4e3a\u503c\u57df\uff0c\u663e\u7136\u6240\u6709 $a_i$ \u7684\u53d6\u503c\u90fd\u5728 $[0,L]$ \u4e4b\u95f4\n\n\u9996\u5148\u4ee4\u6240\u6709 $p_i=0$\uff0c\u7136\u540e\u901a\u8fc7\u64cd\u4f5c\u8c03\u6574 $p$ \u4f7f\u5f97 $p$ \u4f5c\u4e3a\u7b54\u6848\u5e8f\u5217\u5408\u6cd5\u4e14\u4ee3\u4ef7\u6700\u5c0f\n\n\u82e5 $p_i=k$\uff0c\u4f7f $p_i$ \u53d8\u4e3a $k+1$ \u7684\u4ee3\u4ef7\u4e3a $c_i(-2(a_i-k)+1)$\uff0c\u6211\u4eec\u7528\u4e8c\u5143\u7ec4 $(i,k)$ \u4ee3\u8868\u8fdb\u884c\u6b64\u64cd\u4f5c\uff0c\u663e\u7136\u8fdb\u884c\u5b8c $(i,k)$ \u64cd\u4f5c\u4e4b\u540e\u624d\u80fd\u8fdb\u884c $(i,k+1)$ \u64cd\u4f5c\n\n\u8bb0 $g(x)=\\sum|b_i-x|-\\sum|p_i-x|$\uff0c\u5219\u9898\u76ee\u6761\u4ef6\u7b49\u4ef7\u4e8e\u5bf9\u4e8e\u4efb\u610f $x\\in[0,L]$ \u6709 $g(x)\\ge 0$\n\n\u5c06 $p_i$ \u4ece $k$ \u53d8\u4e3a $k+1$ \u7684\u6548\u679c\u4e3a\u4f7f\u6240\u6709 $x\\in [0,k]$ \u7684 $g(x)$ \u51cf\u53bb $1$\uff0c\u6240\u6709 $x\\in (k,L]$ \u7684 $g(x)$ \u52a0\u4e0a $1$\uff0c\u90a3\u4e48\u663e\u7136 $k$ \u8d8a\u5927\u5bf9\u4e8e $g$ \u7684\u6b63\u8d21\u732e\u8d8a\u5c0f\uff0c\u8d1f\u8d21\u732e\u8d8a\u5927\uff1b\u53c8 $k$ \u8d8a\u5927 $(i,k)$ \u64cd\u4f5c\u7684\u4ee3\u4ef7\u8d8a\u5927\uff0c\u6240\u4ee5 $(i,k+1)$ \u6bd4 $(i,k)$ \u5148\u64cd\u4f5c\u4e00\u5b9a\u4e0d\u4f18\uff0c\u6240\u4ee5\u4e0d\u7528\u7279\u522b\u9650\u5236 $(i,k)$ \u8981\u5728 $(i,k+1)$ \u524d\u9762\u64cd\u4f5c\n\n\u90a3\u4e48\u95ee\u9898\u5c31\u53d8\u6210\u4e86\u6709\u82e5\u5e72\u5f62\u5982 $(i,k)$ \u7684\u64cd\u4f5c\uff0c\u6bcf\u4e2a\u64cd\u4f5c\u6709\u4e00\u4e2a\u4ee3\u4ef7\uff0c\u4f5c\u7528\u662f\u4f7f $[0,k]$ \u4e2d\u7684 $g(x)$ \u51cf\u53bb $1$\uff0c$(k,L]$ \u4e2d\u7684 $g(x)$ \u52a0\u4e0a $1$\uff0c\u6240\u6709\u8981\u6c42\u5728\u6240\u6709 $g(x)\\ge 0$ \u7684\u60c5\u51b5\u4e0b\u4ee3\u4ef7\u6700\u5c0f\n\n\u4e0d\u59a8\u5bf9\u4e8e\u6bcf\u4e2a $x\\in[0,L]$ \u8003\u8651\u64cd\u4f5c\u5e94\u8be5\u6ee1\u8db3\u4ec0\u4e48\u6761\u4ef6\u624d\u80fd\u4f7f $g(x)\\ge 0$\n\n\u8bb0 $g_0(x)=\\sum|b_i-x|-\\sum|0-x|$\uff0c\u5373\u521d\u59cb\u72b6\u6001\u4e0b $g(x)$ \u7684\u53d6\u503c\n\n\u8bb0 $f_k$ \u4e3a\u5f62\u5982 $(i,k)$ \u7684\u64cd\u4f5c\u8fdb\u884c\u7684\u6b21\u6570\uff0c\u5219 $g(x)=g_0(x)+\\sum\\limits_{i=0}^{x-1}f_i-\\sum\\limits_{i=x}^Lf_i\\ge0$\n\n\u8bb0 $sum=\\sum f_i$\uff0c\u5219 $g_0(x)+sum-2\\sum\\limits_{i=x}^Lf_i\\ge 0\\Leftrightarrow \\sum\\limits_{i=x}^Lf_i\\le\\lfloor\\frac{g_0(x)+sum}{2}\\rfloor$\n\n\u5e26\u5165 $x=0$\uff0c\u53ef\u5f97 $sum\\le g_0(0)$\uff0c\u5e26\u5165 $x=L+1$ \u53ef\u5f97 $sum\\ge g_0(L+1)=g_0(0)$\n\n\u6240\u4ee5 $sum=g_0(0)=\\sum b_i$\uff0c\u90a3\u4e48 $\\sum\\limits_{i=x}^Lf_i$ \u7684\u4e0a\u754c\u5c31\u786e\u5b9a\u4e86\uff0c\u8bb0\u5176\u4e3a $lmt_x$\n\n\u90a3\u4e48\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u6734\u7d20\u7684\u505a\u6cd5\uff1a\n\n\u7ef4\u62a4\u4e00\u4e2a\u5806\uff0c\u4ece\u540e\u5f80\u524d\u679a\u4e3e $x$\uff0c\u628a\u6240\u6709\u5f62\u5982 $(i,x)$ \u7684\u64cd\u4f5c\u52a0\u5165\u5806\u4e2d\uff0c\u4e0d\u65ad\u5220\u9664\u5806\u4e2d\u4ee3\u4ef7\u6700\u5927\u7684\u64cd\u4f5c\u4f7f\u5f97\u5806\u4e2d\u5143\u7d20\u4e2a\u6570 $\\le lmt_x$\n\n\u8fd9\u6837\u505a\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a $\\mathcal O(nL\\log nL)$\uff0c\u9700\u8981\u4f18\u5316\n\n\u8bb0 $c_i$ \u503c\u57df\u4e3a $m=5$\n\n\u8bb0\u5f53\u524d\u5806\u4e2d\u6700\u5927\u64cd\u4f5c\u4ee3\u4ef7\u4e3a $mx$\uff0c\u5806\u5927\u5c0f\u4e3a $sz$\n\n\u5bf9\u4e8e\u6240\u6709 $i\\le mx$\uff0c\u8bb0 $del_i$ \u4e3a\u4ee3\u4ef7\u4e3a $i$ \u7684\u64cd\u4f5c\u88ab\u5220\u9664\u7684\u6b21\u6570\n\n\u8bb0 $C_{i,k}$ \u4e3a $(i,k)$ \u64cd\u4f5c\u7684\u4ee3\u4ef7\uff0c$f(k,v)=\\sum [C_{i,k}=v]$\n\n\u679a\u4e3e\u5230 $x$ \u65f6\uff0c\u5148\u52a0\u5165\u6240\u6709\u4ee3\u4ef7 $\\le mx$ \u7684 $(i,x)$ \u64cd\u4f5c\uff0c\u5373\u628a $sz$ \u52a0\u4e0a $\\sum\\limits_{i\\le v}f(x,v)$\uff0c\u7136\u540e\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n1. \u82e5 $sz>lmt_x$\uff0c\u5219\u8003\u8651\u8ba1\u7b97\u5806\u4e2d\u4ee3\u4ef7\u4e3a $mx$ \u7684\u64cd\u4f5c\u4e2a\u6570\uff0c\u5373 $\\sum\\limits_{i\\ge x}f(i,mx)-del_{mx}$\uff0c\u82e5\u5176 $> sz-lmt_x$\uff0c\u5219\u5220\u9664 $sz-lmt_x$ \u4e2a $mx$\uff0c\u5426\u5219\u628a $mx$ \u5168\u90e8\u5220\u5b8c\uff0c\u5e76\u628a $mx$ \u51cf\u53bb $1$\n\n2. \u82e5 $sz<lmt_x$\uff0c\u5219\u628a $mx$ \u52a0\u4e0a $1$\uff0c\u52a0\u5165\u7684\u64cd\u4f5c\u4e2a\u6570\u4e3a $f(x,mx)$\uff0c\u5e76\u628a $del_{mx}$ \u8bbe\u7f6e\u4e3a $\\sum\\limits_{i>x}f(i,mx)$\uff0c\u82e5 $f(x,mx)>lmt_x-sz$\uff0c\u5219\u5220\u9664\u4e00\u4e9b\u503c\u4e3a $mx$ \u7684\u64cd\u4f5c\u4f7f\u5f97\u6700\u540e $sz=lmt_x$\n\n\u5728\u9884\u5904\u7406 $sum_{i,j}$ \u8868\u793a $c_k=i$\uff0c$a_k\\le j$ \u7684 $k$ \u7684\u4e2a\u6570\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5728 $\\mathcal O(m)$ \u7684\u65f6\u95f4\u5185\u6c42\u51fa $f(x,v)$ \u5173\u4e8e $v$ \u7684\u524d\u7f00\u548c\u548c\u5173\u4e8e $x$ \u7684\u540e\u7f00\u548c\n\n\u8bb0 $mx$ \u7684\u53d8\u5316\u6b21\u6570\u4e3a $T$\uff0c\u5219\u603b\u590d\u6742\u5ea6\u4e3a $\\mathcal O(mT)$\n\n\u4e0b\u8bc1 $T$ \u4e3a $\\mathcal O(mL)$ \u7ea7\u522b\n\n\u8bb0 $mx_k$ \u4e3a $x=k$ \u65f6\u7684 $mx$\uff0c$\\Delta_k=lmt_k-lmt_{k+1}$\n\n\u8bb0 $f_k$ \u4e3a $(i,k)$ \u64cd\u4f5c\u4e2d\u4ee3\u4ef7\u7b2c $\\Delta_k$ \u5c0f\u7684\uff0c$g_{k}$ \u4e3a $(i,k)$ \u64cd\u4f5c\u4e2d\u4ee3\u4ef7\u7b2c $\\Delta_{k+1}$ \u5c0f\u7684\n\n\u4e0d\u96be\u53d1\u73b0 $|mx_k-mx_{k+1}|\\le |f_k-f_{k+1}|$ \u5bf9\u4e8e\u4efb\u610f $k$ \u6210\u7acb\n\n\u6240\u4ee5\u53ea\u9700\u8bc1 $\\sum |f_k-f_{k+1}|$ \u4e3a $\\mathcal O(mL)$ \u7ea7\u522b\u5373\u53ef\n\n\u7531\u4e8e $\\Delta_k$ \u5927\u7ea6\u548c $\\frac{g_0(k)-g_0(k+1)}2$ \u76f8\u7b49\uff0c\u6240\u4ee5\u6709 $\\Delta_k\\ge \\Delta_{k+1}$\uff0c\u4e14 $0\\le \\Delta_k\\le n$\n\n\u8003\u8651 $(i,k-1)$ \u548c $(i,k)$ \u4e24\u7ec4\u64cd\u4f5c\uff0c\u5219\u6709\u540e\u9762\u90a3\u7ec4\u64cd\u4f5c\u7684\u4ee3\u4ef7\u4e3a\u524d\u9762\u90a3\u7ec4\u64cd\u4f5c\u7684\u4ee3\u4ef7\u52a0\u4e0a $2c_i$\n\n\u4e0d\u96be\u53d1\u73b0 $f_k-2m\\le g_{k-1}$\uff0c\u53c8 $\\Delta_{k-1}\\ge \\Delta_k$\uff0c\u5219 $g_{k-1}\\le f_{k-1}$\uff0c\u5219\u6709 $f_{k}-f_{k-1}\\le 2m$\n\n\u53c8\u5bf9\u4e8e\u4efb\u610f $k$ \u6709 $|f_k|\\le mL$ \u6210\u7acb\uff0c\u53ef\u63a8\u5f97 $\\sum|f_{k}-f_{k-1}|$ \u4e3a $\\mathcal O(mL)$ \u7ea7\u522b\n\n\u6240\u4ee5\u603b\u590d\u6742\u5ea6 $\\mathcal O(m^2L)$\n\ncode:\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define MAXN 200010\nusing namespace std;\nconst int z=2000005;\nconst int L=200000;\nint n,sum,ans,a[MAXN],b[MAXN],c[MAXN];\nint del[MAXN*20],sa[6][MAXN],sb[MAXN];\nint g0[MAXN],lmt[MAXN];\nint getx(int x,int v){//C_{k,i}=v(i>=x)\n\tint ret=0;\n\tfor(int i=1;i<=5;i++){\n\t\tif(v%i||!(v%(2*i)))continue;\n\t\tint now=(v/i-1)/2;\n\t\tret+=sa[i][min(L-now,L)]-(x-now<=0?0:sa[i][min(x-now-1,L)]);\n\t}return ret;\n}\nint divdn(int x,int y){return (int)floor(1.0*x/y);}\nint getv(int x,int v){//C_{k,x}=i(i<=v)\n\tint ret=0;\n\tfor(int i=1;i<=5;i++){\n\t\tint now=x-divdn((divdn(v,i)-1),2);\n\t\tret+=sa[i][L]-(now<=0?0:sa[i][min(L,now-1)]);\n\t}return ret;\n}\nsigned main(){\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&a[i]);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&b[i]),sum+=b[i];\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&c[i]);\n\tfor(int i=1;i<=n;i++)sa[c[i]][a[i]]++,sb[b[i]]++;\n\tfor(int i=1;i<=5;i++)\n\t\tfor(int j=1;j<=L;j++)sa[i][j]+=sa[i][j-1];\n\tfor(int i=1;i<=L;i++)sb[i]+=sb[i-1];\n\tg0[0]=sum;for(int i=1;i<=L;i++)g0[i]=g0[i-1]+2*sb[i-1]-n;\n\tfor(int i=1;i<=L;i++)g0[i]-=i*n;\n\tfor(int i=0;i<=L;i++)lmt[i]=(sum+g0[i])/2;\n\tint mx=0,sz=0;\n\tfor(int i=L;i>=0;i--){\n\t\tsz+=getv(i,mx);\n\t\twhile(sz>lmt[i]){\n\t\t\tint now=getx(i,mx)-del[mx+z];\n\t\t\tif(now>sz-lmt[i]){\n\t\t\t\tdel[mx+z]+=sz-lmt[i];\n\t\t\t\tsz=lmt[i];break;\n\t\t\t}mx--;sz-=now;\n\t\t}\n\t\twhile(sz<lmt[i]){\n\t\t\tmx++;del[mx+z]=getx(i+1,mx);\n\t\t\tint now=getx(i,mx)-del[mx+z];\n\t\t\tif(now>lmt[i]-sz){\n\t\t\t\tdel[mx+z]+=now-(lmt[i]-sz);\n\t\t\t\tsz=lmt[i];break;\n\t\t\t}sz+=now;\n\t\t}\n\t}\n\tfor(int i=1;i<=n;i++)ans+=c[i]*a[i]*a[i];\n\tfor(int i=-z;i<=mx;i++)ans+=(getx(0,i)-del[i+z])*i;\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1666800761,
        "uid": 65681,
        "name": "UltiMadow",
        "ccfLevel": 7,
        "title": "[\u9898\u89e3] AGC049F"
    }
]