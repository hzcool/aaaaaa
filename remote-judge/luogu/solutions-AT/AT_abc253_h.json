[
    {
        "content": "\u9996\u5148\u9009 $i$ \u6b65\u7684\u603b\u65b9\u6848\u6570\u662f $m^i$\uff0c\u6240\u4ee5\u76f4\u63a5\u628a\u65b9\u6848\u6570\u7b97\u51fa\u6765\uff0c\u518d\u4e00\u9664\u5c31\u662f\u6982\u7387\u4e86\u3002\n\n\u770b\u5230 $n\\le14$ \u5c31\u77e5\u9053\u590d\u6742\u5ea6\u7edd\u5bf9\u5e26\u4e00\u4e2a $3^n$\uff0c\u76f4\u63a5\u5b50\u96c6 dp\u3002\u8bbe $dp_{i,S}$ \u8868\u793a $i$ \u6b65\u540e\u70b9\u96c6 $S$ \u4e3a\u68ee\u6797\u7684\u65b9\u6848\u6570\u3002\u663e\u7136\u53ef\u4ee5\u8ba9\u4e00\u4e2a\u5b50\u96c6\u88c2\u5f00\uff0c\u81ea\u5df1\u53d8\u6210\u4e00\u68f5\u6811\u3002\u518d\u7528\u4e0a\u56fa\u5b9a\u57fa\u51c6\u70b9\u7684\u7ecf\u5178\u5957\u8def\uff0c\u5f97\u5230\u8f6c\u79fb\u65b9\u7a0b\uff1a\n\n$$dp_{i,S}=\\sum_{S_1\\in T\\subseteq S}dp_{i-|T|+1,S/T}\\times f_T$$\n\n\u5176\u4e2d\uff0c$f_T$ \u8868\u793a\u8ba9\u70b9\u96c6 $T$ \u6210\u4e3a\u4e00\u9897\u6811\u7684\u65b9\u6848\u6570\u3002\u663e\u7136\u53ef\u4ee5\u5f97\u77e5\uff0c\u5f53 $|S|=1$ \u65f6\uff0c$f_S=1$\u3002\u7136\u800c\u8fd8\u4e0d\u662f\u5f88\u597d\u5904\u7406\uff0c\u6b64\u65f6\u8fd0\u7528\u6811\u7684\u4e00\u4e2a\u6027\u8d28\uff1a\u65ad\u5f00\u4efb\u610f\u4e00\u6761\u8fb9\u540e\u6811\u4f1a\u88c2\u5f00\u6210\u4e24\u68f5\u6811\u3002\u90a3\u4e48\u7ee7\u7eed\u679a\u4e3e\u5b50\u96c6\u88c2\u5f00\uff0c\u5f97\u5230\uff1a\n\n$$f_S=\\sum_{T\\subset S}f_{S/T}\\times f_T\\times edge_{S/T,T}$$\n\n\u7136\u800c\u8fd9\u6837\u662f\u4e0d\u884c\u7684\uff0c\u4f1a\u6709\u5f88\u591a\u91cd\u590d\u7684\u60c5\u51b5\u3002\u5bf9\u4e8e\u6bcf\u4e00\u79cd\u65b9\u6848\uff0c\u8003\u8651\u5176\u4e2d\u7684\u4e00\u6761\u8fb9\uff0c\u8bbe\u65ad\u5f00\u8be5\u8fb9\u540e\u7ec4\u6210\u7684\u6811\u4e3a $T$ \u548c $S/T$\u3002\u663e\u7136\uff0c\u8be5\u65b9\u6848\u4f1a\u88ab $T,S/T$ \u4e0e $S/T,S/(S/T)=T$ \u8ba1\u7b97\u4e24\u904d\uff0c\u6811\u4e2d\u603b\u8ba1 $|S|-1$ \u6761\u8fb9\uff0c\u8ba1\u7b97\u6b21\u6570\u5c31\u662f $2(|S|-1)$\uff0c\u9664\u6389\u5373\u53ef\u3002\n\n\u6700\u540e\u5904\u7406\u8fb9\u6570\u3002\u66b4\u529b\u4e0e\u5904\u7406\u7edd\u5bf9\u4e0d\u884c\uff0c\u8003\u8651\u7ee7\u7eed\u5bb9\u65a5\uff08~~\u5957\u4e86\u4e09\u5c42\u4e86\u5df2\u7ecf~~\uff09\uff0c\u8fb9\u6570\u4e3a\u4e24\u4e2a\u5b50\u96c6\u5e76\u7684\u5185\u90e8\u8fde\u8fb9\u6570\u51cf\u53bb\u4e24\u4e2a\u5b50\u96c6\u5185\u90e8\u7684\u8fb9\u6570\uff0c\u5373\uff1a\n\n$$edge_{S,T}=edge_{S\\cup T}-edge_S-edge_T$$\n\n\u66b4\u529b\u9884\u5904\u7406\u6bcf\u4e2a\u5b50\u96c6\u7684\u7b54\u6848\u5373\u53ef\u3002\u6700\u540e\uff0c\u8bbe $V$ \u4e3a\u6240\u6709\u70b9\u7ec4\u6210\u7684\u70b9\u96c6\uff0c\u7531\u4e8e\u6ca1\u6709\u6307\u5b9a\u52a0\u5165 $i$ \u6761\u8fb9\u7684\u987a\u5e8f\uff0c\u6240\u4ee5\u65b9\u6848\u6570\u4e3a\uff1a\n\n$$dp_{i,V}\\times i!$$\n\n\u6982\u7387\u4e3a\uff1a\n\n$$\\dfrac{dp_{i,V}\\times i!}{m^i}$$\n\n\u5b8c\u7ed3\u6492\u82b1\uff01\n\n# AC \u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\n\nconst int MAXN = 3e3 + 10;\nconst int mod = 998244353;\n\ninline \nll inv(ll b, ll p = mod - 2) {\n\tll res = 1;\n\twhile (p) {\n\t\tif (p & 1) res = res * b % mod;\n\t\tb = b * b % mod, p >>= 1;\n\t}\n\treturn res;\n}\n\nint n, m; ll p = 1;\n\nint u[510], v[510], cnt[1 << 14];\n\nll num[1 << 14], f[1 << 14], dp[14][1 << 14], fac[14];\n\ninline \nll calc(int s, int t) {\n\treturn num[s | t] - num[s] - num[t];\n}\n\nint main() {\n\tscanf(\"%d%d\", &n, &m), *f = *fac = 1;\n\tfor (int i = 1; i <= m; i++) scanf(\"%d%d\", &u[i], &v[i]), u[i]--, v[i]--;\n\tfor (int i = 1; i < n; i++) fac[i] = fac[i - 1] * i % mod;\n\tfor (int s = 0; s < 1 << n; s++) {\n\t\tfor (int i = 1; i <= m; i++) if (s >> u[i] & 1 && s >> v[i] & 1) num[s]++;\n\t\tif (s) cnt[s] = cnt[s ^ s & -s] + 1;\n\t}\n\tfor (int s = 1; s < 1 << n; s++) {\n\t\tif (s == (s & -s)) { f[s] = 1; continue; }\n\t\tfor (int t = s - 1 & s; t; t = t - 1 & s) {\n\t\t\tf[s] = (f[s] + f[s ^ t] * f[t] % mod * calc(s ^ t, t) % mod) % mod;\n\t\t}\n\t\tf[s] = f[s] * inv(cnt[s] - 1 << 1) % mod;\n\t}\n\tfor (int i = 0; i < n; i++) {\n\t\tfor (int s = 0, k, x; s < 1 << n; s++) {\n\t\t\tif (cnt[s] - 1 == i) dp[i][s] = f[s];\n\t\t\tif (!s) continue;\n\t\t\tx = s & -s, k = s ^ x;\n\t\t\tfor (int t = k - 1 & k; t != k; t = t - 1 & k) {\n\t\t\t\tif (cnt[t] <= i) dp[i][s] = (dp[i][s] + dp[i - cnt[t]][s ^ t ^ x] * f[t ^ x] % mod) % mod;\n\t\t\t}\n\t\t}\n\t}\n\tfor (int i = 1; i < n; i++) p = p * m % mod, printf(\"%lld\\n\", dp[i][(1 << n) - 1] * fac[i] % mod * inv(p) % mod);\n}\n```",
        "postTime": 1673165588,
        "uid": 406941,
        "name": "Register_int",
        "ccfLevel": 6,
        "title": "ABC253Ex \u9898\u89e3"
    },
    {
        "content": "\u6211\u4eec\u5148\u6765\u8ba1\u7b97\u5404\u4e2a\u70b9\u96c6\u7684\u5bfc\u51fa\u5b50\u56fe\u7684\u751f\u6210\u6811\u4e2a\u6570\u3002\n\n\u8003\u8651\u679a\u4e3e $k=1,\\dots,n$\uff0c\u4f9d\u6b21\u8ba1\u7b97\u6240\u6709 $S \\subseteq \\{1,\\dots,k\\}$ \u7684\u7b54\u6848\u3002  \n\u8003\u8651\u6bcf\u6b21\u52a0\u5165\u4e00\u4e2a\u70b9 $k+1$\uff0c\u5bf9\u4e8e $S \\subseteq \\{1,\\dots,k\\}$\uff0c\u6211\u4eec\u8003\u8651\u5982\u4f55\u5728\u5176\u4e2d\u52a0\u5165 $k+1$\u3002  \n\u81ea\u7136\u53ea\u9700\u679a\u4e3e\u65ad\u5f00 $k+1$ \u540e\u4f1a\u6784\u6210\u54ea\u4e9b\u8fde\u901a\u5757\uff0c\u4e0d\u96be\u53d1\u73b0\u8fd9\u5c31\u662f\u4e00\u4e2a\u96c6\u5408\u5e42\u7ea7\u6570\u7684 exp \u64cd\u4f5c\u3002\n\n\u6838\u5fc3\u4ee3\u7801\uff08\u6267\u884c\u5b8c\u540e $f_S$ \u4e3a $S$ \u5bfc\u51fa\u5b50\u56fe\u7684\u751f\u6210\u6811\u4e2a\u6570\uff0c$e_u$ \u4e3a\u90bb\u63a5\u77e9\u9635\uff0c$\\exp$ \u8868\u793a\u5c06 $f_{2^k,\\dots,2^{k+1}-1}$ \u539f\u5730 $\\exp$\uff09\uff1a\n```cpp\nf[0] = 1;\nfor (int k = 0; k < lg; ++k) {\n  for (int i = 0; i < (1 << k); ++i) f[i + (1 << k)] = (ll)f[i] * popcnt(e[k] & i) % mod;\n  Set::exp(f + (1 << k), f + (1 << k), k);\n}\n```\n\n\u65f6\u95f4\u590d\u6742\u5ea6\u7531 $T(n) = T(n-1) + O(n^2 2^n)$ \u5f97\u5230\uff0c\u4e3a $O(n^2 2^n)$\u3002  \n\u4ece\u800c\u8fd9\u4e5f\u53eb\u505a**\u9010\u70b9\u725b\u987f\u8fed\u4ee3\u6cd5**\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u95ee\u9898\u4e3a\u7ed9\u5b9a\u96c6\u5408\u5e42\u7ea7\u6570 $F(x)$\uff0c\u5bf9\u4e8e $k=0,\\dots,n$ \u8ba1\u7b97 $[x^U] F^k(x)$\u3002  \n\u6211\u4eec\u4e0d\u59a8\u6cdb\u5316\u4e3a\u7ed9\u5b9a\u7cfb\u6570\u5e8f\u5217 $b_S$\uff0c\u8ba1\u7b97\u5e8f\u5217\n$$\na_k = \\sum_{S\\subseteq U} b_S [x^S] F^k(x)\n$$\n\n\u5c06\u5176**\u8f6c\u7f6e**\uff0c\u5373\u5f97\n$$\nb_S = [x^S] \\sum_{k=0}^n a_k F^k(x)\n$$\n\n\u8fd9\u5c31\u662f\u4e00\u822c\u7684\u591a\u9879\u5f0f\u590d\u5408\u96c6\u5408\u5e42\u7ea7\u6570\u95ee\u9898\uff0c\u5e94\u7528**\u9010\u70b9\u725b\u987f\u8fed\u4ee3\u6cd5**\u4e5f\u53ef\u4ee5\u505a\u5230 $O(n^2 2^n)$\u3002  \n\u5177\u4f53\u5730\uff0c\u5bf9\u4e8e $f, G$\uff0c\u4ee4 $F = f(G)$\u3002\u5728\u4e24\u8fb9\u4f5c\u7528 $\\frac{\\partial}{\\partial x_n}$\uff08\u76f8\u5f53\u4e8e\u53d6 $[x_n^1]$\uff09\uff0c\u53ef\u5f97\n$$\n\\frac{\\partial}{\\partial x_n} F = f'(G) \\cdot \\frac{\\partial}{\\partial x_n} G\n$$\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u82e5\u4ee4 $G_k(x) = G(x) | _{x_n=x_{n-1}=\\dots=x_{n-k+1}=0}$\uff0c\u5219\u5bf9\u4e8e $G_{n-k}$ \u6211\u4eec\u9700\u8981\u8ba1\u7b97 $f,f',\\dots,f^{(k)}$ \u590d\u5408 $G_{n-k}$ \u7684\u7ed3\u679c\u3002  \n\u5982\u6b64\u9012\u5f52\uff0c\u590d\u6742\u5ea6\u4e3a $\\sum_{k\\ge 0} (n-k) \\cdot k^2 2^k = O(n^2 2^n)$\u3002  \n\u5982\u9884\u5904\u7406 $G_{0,\\dots,n}$ \u7684 FMT \u6570\u7ec4\uff0c\u5e38\u6570\u4f1a\u66f4\u5c0f\u3002",
        "postTime": 1666923655,
        "uid": 75840,
        "name": "deserter",
        "ccfLevel": 0,
        "title": "\u96c6\u5408\u5e42\u7ea7\u6570\u79d1\u6280\u6a21\u677f\u9898"
    },
    {
        "content": "[ABC253Ex](https://atcoder.jp/contests/abc253/tasks/abc253_h)\n$\\text{Difficulty : 2758}$ \uff1a\u7ed9\u5b9a $n$ \u4e2a\u70b9\uff0c$m$ \u6761\u8fb9\u7684\u65e0\u5411\u56fe\u3002\u6bcf\u6b21\u7b49\u6982\u7387\u968f\u673a\u4e00\u6761\u8fb9\u52a0\u5165\u521d\u59cb\u4e3a\u7a7a\u7684\u65b0\u56fe\u4e2d\u3002\u8981\u6c42\u65b0\u56fe\u6ca1\u6709\u73af\uff0c\u95ee\u9009\u62e9\u4e86 $k$ \u6761\u8fb9\u7684\u6982\u7387\uff1f\n\n\u5bf9 $k = 1,2,\\cdots,n - 1$ \u8f93\u51fa\u7b54\u6848\uff0c\u5bf9\u5927\u8d28\u6570\u53d6\u6a21\u3002\n\n\u8bbe $f_{s,k}$ \u8868\u793a\u9009\u51fa\u7684\u70b9\u96c6\u4e3a $s$\uff0c\u5f62\u6210\u4e86 $k$ \u4e2a\u8fde\u901a\u5757\u7684\u65b9\u6848\u6570\uff08\u987a\u5e8f\u4e0d\u540c\u770b\u505a\u4e0d\u540c\u7684\u65b9\u6848\uff09\u3002\n\n\u8bb0\u96c6\u5408 $s$ \u7684\u5927\u5c0f\u4e3a $sz_s$\u3002\n\n\u5148\u5355\u72ec\u8003\u8651 $f_{s,1}$ \u7684\u8f6c\u79fb\uff1a\n\n$$f_{S,1} = \\dfrac{\\sum\\limits_{}f_{T,-1}\\times f_{S-T,1}\\times \\dbinom{sz_S-2}{sz_T-1}\\times edgenum(T,S-T)}{2}$$\n\n\u5176\u4e2d $S-T$ \u8868\u793a $S$ \u96c6\u5408\u4e2d\u51cf\u53bb $T$ \u7684\u90e8\u5206\uff0c$edgenum(T,S-T)$ \u8868\u793a $T$ \u4e0e $S-T$ \u4e24\u4e2a\u7535\u96c6\u4e4b\u95f4\u7684\u8fb9\u6570\uff0c\u53ef\u4ee5 $O(2^nn^2)$ \u9884\u5904\u7406\u6bcf\u4e2a\u70b9\u5230\u6240\u6709\u70b9\u96c6\u7684\u8fb9\u6570\uff0c\u7136\u540e\u6bcf\u6b21 $O(n)$ \u6c42\u5f97\u3002\u5bf9\u4e8e\u5408\u5e76\u7684\u70b9\u96c6\u5185\u90e8\u5171\u6709 $sz_S-2$ \u6761\u8fb9\uff0c\u4e24\u8fb9\u5404\u81ea\u7684\u987a\u5e8f\u5df2\u7ecf\u786e\u5b9a\uff0c\u6240\u4ee5\u8981\u4e58\u4e0a $\\dbinom{sz_S-2}{sz_T-1}$\u3002\u53c8\u56e0\u4e3a\u8fd9\u4e00\u6b65\u7684 $S-T$ \u4f1a\u88ab\u4e4b\u540e\u5f53\u6210 $T$ \u91cd\u590d\u8ba1\u7b97\u4e86 $2$ \u904d\uff0c\u6240\u4ee5\u8981\u9664 $2$\u3002\n\n\u91c7\u7528\u679a\u4e3e\u5b50\u96c6\u7684\u65b9\u5f0f\u8f6c\u79fb\uff0c\u65f6\u95f4\u590d\u6742\u5ea6 $O(3^nn)$\u3002\n\n\u7136\u540e\u8003\u8651\u5408\u5e76\u82e5\u5e72\u4e2a\u8fde\u901a\u5757\uff1a\n\n$$f_{s,k} = \\dfrac{\\sum\\limits_{}f_{T,1}\\times f_{S-T,k-1}\\times \\dbinom{sz_S - k}{sz_T - 1}}{k}$$\n\n\u8f6c\u79fb\u540c\u7406\uff0c\u8bfb\u8005\u4e0d\u59a8\u81ea\u884c\u63a8\u5bfc\u3002\n\n\u6700\u540e\u7edf\u8ba1\u7b54\u6848\u8ba1\u7b97\u5373\u53ef\u3002\u65f6\u95f4\u590d\u6742\u5ea6 $O(3^nn)$\u3002\n\n### code:\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define lowbit(x)\t(x & -x)\nconst int maxn = 20;\nconst int maxs = (1 << 14) + 5;\nconst int mod = 998244353;\nconst int inv2 = 998244354 / 2;\nlong long n,m,u,v,e[maxn][maxn],ans[maxn],f[maxs][maxn],t[maxs],vis[maxn][maxs],fac[maxn],inv[maxn];\ninline int read()\n{\n\tint x = 0,f = 1;char ch = getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch<='9'&&ch>='0'){x=(x<<1)+(x<<3)+ch-'0';ch=getchar();}\n\treturn f * x;\n}\nlong long qpow(long long a,long long b){long long ans=1;while(b){if(b&1)ans=ans*a%mod;a=a*a%mod;b>>=1;}return ans;}\ninline long long calc(int n,int m){return (m > n) ? 0 : fac[n] * inv[m] % mod * inv[n - m] % mod;}\ninline int numedge(int s,int t)\n{\n\tint res = 0;\n\tfor(int i = 1;i <= n;++i)\n\t\tif(s & (1 << (i - 1)))\n\t\t\tres += vis[i][t];\n\treturn res;\n}\nvoid input()\n{\n\tn = read(),m = read();\n\tfor(int i = 1;i <= m;i++)\n\t{\n\t\tu = read(),v = read();\n\t\tif(u == v)\n\t\t\tcontinue;\n\t\te[u][v]++,e[v][u]++;\n\t}\n}\nvoid prefix()\n{\n\tfor(int i = 1;i <= n;++i)\n\t\tfor(int s = 1;s < (1 << n);++s)\n\t\t\tfor(int j = 1;j <= n;++j)\n\t\t\t\tif(s & (1 << (j - 1)))\n\t\t\t\t\tvis[i][s] += e[i][j];\n\tfor(int i = 1;i < (1 << n);++i)\n\t\tt[i] = t[i >> 1] + (i & 1);\n\tfac[0] = 1;\n\tfor(int i = 1;i <= n;i++)\n\t\tfac[i] = fac[i - 1] * i % mod;\n\tinv[n] = qpow(fac[n],mod - 2);\n\tfor(int i = n - 1;i >= 0;--i)\n\t\tinv[i] = inv[i + 1] * (i + 1) % mod;\n}\nvoid dp()\n{\n\tfor(int i = 1;i <= n;++i)\n\t\tf[(1 << (i - 1))][1] = 1;\n\tfor(int s = 1;s < (1 << n);++s)\n\t{\n\t\tfor(int T = s & (s - 1);T;T = s & (T - 1))\n\t\t\tif(f[T][1]&&f[s ^ T][1])\n\t\t\t\tf[s][1] += f[T][1] * f[s ^ T][1] % mod * calc(t[s] - 1 - 1,t[T] - 1) % mod * numedge(T,s ^ T) % mod,f[s][1] %= mod;\n\t\tif(s != lowbit(s))\n\t\t\tf[s][1] = f[s][1] * inv2 % mod;\n\t}\n\tfor(int i = 1;i <= n;++i)\n\t\tf[(1 << (i - 1))][1] = 0;\n\tfor(int k = 2;k <= n;++k)\n\t\tfor(int s = 1;s < (1 << n);++s)\n\t\t{\n\t\t\tfor(int T = s;T;T = s & (T - 1))\n\t\t\t\tif(f[T][1]&&f[s ^ T][k - 1])\n\t\t\t\tf[s][k] += f[T][1] * f[s ^ T][k - 1] % mod * calc(t[s] - k,t[T] - 1) % mod;\n\t\t\tf[s][k] = f[s][k] % mod * qpow(k,mod - 2) % mod;\n\t\t}\n}\nvoid solve()\n{\n\tfor(int s = 1;s < (1 << n);s++)\n\t\tfor(int k = 1;k < t[s];k++)\n\t\t\tif(t[s] >= k)\n\t\t\t\tans[t[s] - k] += f[s][k];\n\tfor(int i = 1;i < n;i++)\n\t\tans[i] %= mod;\n}\nvoid output()\n{\n\tfor(int i = 1;i <= n - 1;i++)\n\t\tprintf(\"%lld\\n\",ans[i] * qpow(qpow(m,i),mod - 2) % mod);\n}\nint main()\n{\n\tinput();\n\tprefix();\n\tdp();\n\tsolve();\n\toutput();\n\treturn 0 ;\n}\n/*\nNOIP 2022 RP++\n*/\n```",
        "postTime": 1668681426,
        "uid": 302636,
        "name": "zhaoyp",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 AT_abc253_h\u3010[ABC253Ex] We Love Forest\u3011"
    },
    {
        "content": "# [[ABC253Ex] We Love Forest](https://www.luogu.com.cn/problem/AT_abc253_h) Solution\n\n[TOC]\n\n## [\u66f4\u597d\u7684\u9605\u8bfb\u4f53\u9a8c\u6233\u6b64\u8fdb\u5165](http://blog.tsawke.com?t=ABC253Ex)\n\n## \u9898\u9762\n\n\u7ed9\u5b9a $ n $ \u4e2a\u70b9\u65e0\u8fb9\u7684\u56fe\uff0c\u7ed9\u5b9a $ m $ \u6761\u5f85\u9009\u7684\u65e0\u5411\u8fb9\u3002\u6bcf\u6b21\u7b49\u6982\u7387\u5730\u4ece $ m $ \u6761\u8fb9\u4e2d\u62bd\u53d6\u4e00\u6761\u8fb9\u52a0\u5165\u56fe\u4e2d\u3002 $ n - 1 $ \u6b21\u8be2\u95ee\u6c42\u52a0 $ 1, 2, \\cdots, n - 1 $ \u6b21\u8fb9\u540e\u539f\u56fe\u5f62\u6210\u4e00\u4e2a\u68ee\u6797\uff08\u4e00\u68f5\u6811\u4ea6\u4e3a\u68ee\u6797\uff09\u7684\u6982\u7387\u4e3a\u591a\u5c11\u3002\u5bf9 $ 998244353 $ \u53d6\u6a21\u3002\n\n## Solution\n\n\u8003\u8651 FZT\uff0c\u5373\u5b50\u96c6\u8ba1\u6570\uff0c\u5177\u4f53\u53ef\u53c2\u8003 [FZT - \u5b50\u96c6\u8ba1\u6570\u5b66\u4e60\u7b14\u8bb0](http://blog.tsawke.com/?t=FZT) \u6216 [[ABC213G] Connectivity 2 Solution](http://blog.tsawke.com?t=ABC213G)\uff0c\u53d1\u73b0\u672c\u9898\u4e0e ABC213G \u76f8\u4f3c\u3002\n\n\u56e0\u4e3a\u672c\u9898\u5b58\u5728\u9009\u7684\u8fb9\u6570\u7684\u9650\u5236\uff0c\u6240\u4ee5\u4e0d\u96be\u60f3\u5230\u9700\u8981\u5728\u4e00\u822c FZT \u7684\u72b6\u6001\u4e2d\u989d\u5916\u6dfb\u52a0\u4e00\u7ef4\u8bb0\u5f55\u3002\n\n\u72b6\u6001\u7c7b\u6bd4 ABC213G\uff0c\u8f83\u4e3a\u663e\u7136\uff0c\u4ee4 $ F(i, S) $ \u8868\u793a\u9009\u4e86 $ i $ \u6761\u8fb9\uff0c\u70b9\u96c6\u72b6\u6001\u4e3a $ S $ \u5f62\u6210\u7684\u68ee\u6797\u6570\u3002\u4ee4 $ G(S) $ \u8868\u793a\u70b9\u96c6\u72b6\u6001\u4e3a $ S $ \u751f\u6210\u6811\u7684\u603b\u65b9\u6848\u6570\u3002\n\n\u9996\u5148\u8003\u8651\u5982\u4f55\u5904\u7406 $ G(S) $\uff0c\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u5c31\u662f\u4e2a\u88f8\u7684\u77e9\u9635\u6811\u5b9a\u7406\u3002\u4e0d\u8fc7\u4e5f\u53ef\u4ee5\u901a\u8fc7\u679a\u4e3e\u5b50\u96c6\u8bbe\u8ba1\u8f6c\u79fb\u6765\u5b9e\u73b0\uff0c\u4ee4 $ cnt(S, T) $ \u8868\u793a\u70b9\u96c6 $ S $ \u548c\u70b9\u96c6 $ T $ \u4e4b\u95f4\u7684\u8fb9\u6570\uff0c\u65b9\u7a0b\u4e0d\u96be\u60f3\u5230\u4e3a\uff1a\n$$\nG(S) = \\sum_{T \\subsetneq S}G(T) \\times G(S \\oplus T) \\times cnt(T, S \\oplus T)\n$$\n\u7136\u540e\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u6709\u91cd\u590d\uff0c\u4e0d\u96be\u60f3\u5230\u91cd\u590d\u5206\u4e3a\u4e24\u79cd\uff0c\u4e00\u79cd\u662f\u56e0\u4e3a $ T $ \u548c $ S \\oplus T $ \u5bf9\u8c03\u4e4b\u540e\u5c5e\u4e8e\u76f8\u540c\u65b9\u6848\u800c\u88ab\u91cd\u590d\u7edf\u8ba1\u4e86\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7\u94a6\u5b9a\u4e00\u4e2a\u70b9\u89e3\u51b3\uff0c\u6216\u8005\u5728\u6700\u7ec8\u7b54\u6848\u4e58\u4e00\u4e2a $ \\dfrac{1}{2} $ \u89e3\u51b3\u3002\u53e6\u4e00\u79cd\u662f\u56e0\u4e3a\u6211\u4eec\u7684\u8f6c\u79fb\uff0c\u662f\u901a\u8fc7\u5c06\u4e24\u4e2a\u6811\u5f62\u7ed3\u6784\u901a\u8fc7\u4e4b\u95f4\u7684\u8fb9\u62fc\u63a5\u5728\u4e00\u8d77\u6765\u5b9e\u73b0\u7684\uff0c\u800c\u8fd9\u79cd\u60c5\u51b5\u4e5f\u53ef\u4ee5\u8ba4\u4e3a\u662f\u5c06\u4e00\u68f5\u5b8c\u6574\u7684\u6811\u901a\u8fc7\u65ad\u5f00\u67d0\u4e00\u6761\u8fb9\u7136\u540e\u5206\u522b\u8ba1\u7b97\u5b50\u6811\uff0c\u8fd9\u6837\u7684\u8bdd\u5bf9\u4e8e\u4e00\u68f5\u786e\u5b9a\u7684\u6811\u65ad\u5f00\u6bcf\u6761\u8fb9\u90fd\u662f\u7b49\u4ef7\u7684\uff0c\u6240\u4ee5\u4f1a\u91cd\u590d\u8fb9\u6570\u6b21\uff0c\u4e5f\u5c31\u662f\u7b54\u6848\u9700\u8981\u4e58\u4e00\u4e2a $ \\dfrac{1}{\\lvert S \\rvert - 1} $\uff0c\u6545\u53ef\u4ee5\u8003\u8651\u5c06\u8f6c\u79fb\u6539\u4e3a\uff1a\n$$\nG(S) = \\dfrac{1}{2(\\lvert S \\rvert - 1)} \\sum_{T \\subsetneq S}G(T) \\times G(S \\oplus T) \\times cnt(T, S \\oplus T)\n$$\n\u6216\uff1a\n$$\nG(S) = \\dfrac{1}{\\lvert S \\rvert - 1} \\sum_{\\operatorname{lowbit}(S) \\in T \\subsetneq S}G(T) \\times G(S \\oplus T) \\times cnt(T, S \\oplus T)\n$$\n\u7136\u540e\u521d\u59cb\u503c\u5927\u6982\u662f $ G(2^k) = 1 $\u3002\n\n\u4e0d\u96be\u53d1\u73b0\u5982\u679c\u65e0\u8111\u5904\u7406 $ cnt $ \u7684\u8bdd\u590d\u6742\u5ea6\u662f $ O(2^{2n}m) $\uff0c\u663e\u7136\u5bc4\uff0c\u4e8e\u662f\u8003\u8651\u4f18\u5316\uff0c\u4ee4 $ cnte(S) $ \u8868\u793a\u70b9\u96c6 $ S $ \u4e2d\u7684\u8fb9\u6570\uff0c\u4e0d\u96be\u60f3\u5230\u5bf9\u4e8e $ cnt $ \u53ef\u4ee5\u5982\u4e0b\u5bb9\u65a5\uff1a\n$$\ncnt(S, T) = cnte(S \\vee T) - cnte(S) - cnte(T)\n$$\n\u5219\u9884\u5904\u7406 $ cnte $ \u7684\u590d\u6742\u5ea6\u4e3a $ O(m2^n) $\uff0c$ cnt $ \u53ef\u4ee5 $ O(1) $ \u6c42\u89e3\uff0c$ G $ \u7684\u5904\u7406\u5219\u662f $ O(3^n) $ \u7684\u3002\n\n\u7136\u540e\u77e9\u9635\u6811\u5b9a\u7406\u7684\u7ed3\u8bba\u5927\u6982\u5c31\u662f\u9996\u5148\u5bf9\u8fd9\u4e2a\u56fe\u5efa\u51fa\u62c9\u666e\u62c9\u65af\u77e9\u9635 $ L $\uff0c\u7136\u540e\u7b54\u6848\u5c31\u662f $ \\det(L_0) $\uff0c\u5176\u4e2d $ L_0 $ \u8868\u793a $ L $ \u53bb\u6389\u7b2c $ i $ \u884c\u7b2c $ i $ \u5217\u7684\u5b50\u77e9\u9635\uff0c\u5176\u4e2d $ i $ \u4efb\u610f\u3002\u5177\u4f53\u8bc1\u660e\u53c2\u8003 [\u77e9\u9635\u6811\u5b9a\u7406\uff08Matrix-tree Theorem\uff09\u7b14\u8bb0](https://zhuanlan.zhihu.com/p/108209378)\u3002\u6240\u4ee5\u53ea\u9700\u8981\u77e9\u9635\u5efa\u51fa\u6765\u65e0\u8111\u6c42\u4e00\u4e0b\u884c\u5217\u5f0f\u5373\u53ef\u3002\n\n\u4e8e\u662f\u8003\u8651\u5982\u4f55\u8f6c\u79fb $ F $\uff0c\u4f9d\u7136\u7c7b\u6bd4 ABC213G\uff0c\u6211\u4eec\u4ee4 $ \\lvert S \\rvert $ \u8868\u793a\u70b9\u96c6 $ S $ \u4e2d\u70b9\u7684\u6570\u91cf\uff0c\u4e5f\u5c31\u662f `__builtin_popcount(S)`\uff0c\u4e0d\u96be\u53d1\u73b0\u8f6c\u79fb\uff1a\n$$\nF(i, S) = \\sum_{1 \\in      T \\subsetneq S} G(T) \\times F(i - (\\lvert T \\rvert - 1), S \\oplus T)\n$$\n\u4e5f\u5c31\u662f\u94a6\u5b9a\u4e00\u4e2a\u5b50\u96c6\u4e3a\u4e00\u68f5\u6811\uff0c\u7136\u540e\u5269\u4e0b\u7684\u4f5c\u4e3a\u68ee\u6797\uff0c\u94a6\u5b9a $ 1 $ \u8282\u70b9\u5728\u6811\u4e2d\u53ef\u4ee5\u53bb\u91cd\uff0c\u5177\u4f53\u5728 ABC213G \u4e5f\u6709\u8bf4\u660e\u3002\n\n\u4e0d\u8fc7\u5f88\u9057\u61be\u8fd9\u4e2a\u53c8\u662f\u9519\u7684\u3002\u6211\u4eec\u5728 ABC213G \u4e2d\u94a6\u5b9a $ 1 $ \u662f\u56e0\u4e3a $ 1 $ \u4e00\u5b9a\u88ab\u9009\uff0c\u4f46\u662f\u5728\u672c\u9898\u91cc\u5e76\u6ca1\u6709\u8fd9\u4e2a\u9650\u5236\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u6362\u4e00\u79cd\u5199\u6cd5\uff0c\u4e0d\u96be\u60f3\u5230\u4f7f\u7528 $ S $ \u4e2d\u7684\u6700\u540e\u4e00\u4e2a $ 1 $ \u662f\u6613\u4e8e\u5b9e\u73b0\u4e14\u6b63\u786e\u7684\uff0c\u5373 $ \\operatorname{lowbit}(S) $\uff0c\u6216\u8005\u8bf4 $ S \\land -S $\u3002\u4e8e\u662f\u8f6c\u79fb\u6539\u4e3a\uff1a\n$$\nF(i, S) = \\sum_{\\operatorname{lowbit}(S) \\in T \\subsetneq S} G(T) \\times F(i - (\\lvert T \\rvert - 1), S \\oplus T)\n$$\n\u8fb9\u754c\u6761\u4ef6\u7684\u8bdd\u5c31\u662f\u5982\u679c $ S $ \u7684\u70b9\u6570\u6070\u597d\u4e3a $ i + 1 $\uff0c\u90a3\u4e48\u663e\u7136\u5c31\u662f\u4e00\u68f5\u6811\uff0c\u5373 $ F(i, S) = G(S) $\u3002\n\n\u7136\u540e\u8003\u8651\u7b54\u6848\uff0c\u4ee4 $ Smx = 2^n - 1 $\uff0c\u5373\u5168\u96c6\uff0c\u4e0d\u96be\u60f3\u5230\u5bf9\u4e8e\u9009 $ i $ \u6761\u8fb9\u7684\u7b54\u6848 $ ans_i $ \u6709\uff1a\n$$\nans_i = \\dfrac{F(i, Smx) \\times i!}{m^i} \\bmod{998244353}\n$$\n\u4e5f\u4e0d\u96be\u7406\u89e3\uff0c\u6982\u7387\u8f6c\u8ba1\u6570\uff0c\u603b\u65b9\u6848\u6570\u4e3a $ m_i $\uff0c\u7136\u540e\u8981\u8ba9\u6240\u6709\u70b9\u5f62\u6210\u68ee\u6797\uff0c\u65b9\u6848\u4e2d\u9009\u62e9\u7684 $ i $ \u6761\u8fb9\u4efb\u610f\u6392\u5217\u5747\u4e0d\u540c\uff0c\u6240\u4ee5\u9700\u8981\u5728\u4e58\u4e00\u4e2a $ i! $\u3002\n\n\n\n\u5927\u6982\u5c31\u8fd9\u6837\u4e86\uff0c\u5904\u7406 $ G $ \u7684\u590d\u6742\u5ea6\u4e3a $ O(n^3 2^n) $\uff0c\u5904\u7406 $ F $ \u7684\u590d\u6742\u5ea6\u4e3a $ O(n 3^n) $\uff0c\u5904\u7406\u7b54\u6848\u590d\u6742\u5ea6\u4f5c\u4e3a\u5e38\u6570\uff0c\u6700\u7ec8\u590d\u6742\u5ea6 $ O((m + n^3) 2^n + 3^n) $\uff0c\u53ef\u4ee5\u901a\u8fc7\u3002\n\n## Code\n\n```cpp\n#define _USE_MATH_DEFINES\n#include <bits/stdc++.h>\n\n#define PI M_PI\n#define E M_E\n#define npt nullptr\n#define SON i->to\n#define OPNEW void* operator new(size_t)\n#define ROPNEW(arr) void* Edge::operator new(size_t){static Edge* P = arr; return P++;}\n\nusing namespace std;\n\nmt19937 rnd(random_device{}());\nint rndd(int l, int r){return rnd() % (r - l + 1) + l;}\nbool rnddd(int x){return rndd(1, 100) <= x;}\n\ntypedef unsigned int uint;\ntypedef unsigned long long unll;\ntypedef long long ll;\ntypedef long double ld;\n\n#define MAX_STATUS (20000)\n#define MOD (ll)(998244353)\n#define EXIST(x) (S & (1 << ((x) - 1)))\n\ntemplate < typename T = int >\ninline T read(void);\n\nstruct Edge{\n    Edge* nxt;\n    int to;\n    OPNEW;\n}ed[1100];\nROPNEW(ed);\nEdge* head[20];\n\nint N, M;\nint deg[20];\nll G[MAX_STATUS], F[20][MAX_STATUS];\nint cnte[MAX_STATUS];\nll fact[30];\n\nint lowbit(int x){return x & -x;}\nint CalCnt(int S, int T){return cnte[S | T] - cnte[S] - cnte[T];}\nll qpow(ll a, ll b){\n    ll ret(1), mul(a);\n    while(b){\n        if(b & 1)ret = ret * mul % MOD;\n        b >>= 1;\n        mul = mul * mul % MOD;\n    }return ret;\n}\n\nint main(){fact[0] = 1;\n    for(int i = 1; i <= 20; ++i)fact[i] = fact[i - 1] * i % MOD;\n    N = read(), M = read();\n    const int Smx = (1 << N) - 1;\n    for(int i = 1; i <= M; ++i){\n        int s = read(), t = read();\n        head[s] = new Edge{head[s], t};\n        head[t] = new Edge{head[t], s};\n    }\n    for(int S = Smx; S; S = (S - 1) & Smx){\n        int cnt(0);\n        for(int p = 1; p <= N; ++p)\n            for(auto i = head[p]; i; i = i->nxt)\n                if(EXIST(p) && EXIST(SON))++cnt;\n        cnt >>= 1;\n        cnte[S] = cnt;\n    }\n    for(int S = 1; S <= Smx; ++S){\n        if(__builtin_popcount(S) == 1){G[S] = 1; continue;}\n        for(int T = (S - 1) & S; T; T = (T - 1) & S)\n            if(T & lowbit(S))\n                (G[S] += G[T] * G[S ^ T] % MOD * CalCnt(T, S ^ T) % MOD) %= MOD;\n        (G[S] *= qpow(__builtin_popcount(S) - 1, MOD - 2)) %= MOD;\n    }\n    for(int i = 0; i <= N - 1; ++i)\n        for(int S = 0; S <= Smx; ++S){\n            if(__builtin_popcount(S) == i + 1){F[i][S] = G[S]; continue;}\n            for(int T = (S - 1) & S; T; T = (T - 1) & S)\n                if(T & lowbit(S) && i - (__builtin_popcount(T) - 1) >= 0)\n                    (F[i][S] += G[T] * F[i - (__builtin_popcount(T) - 1)][S ^ T]) %= MOD;\n        }\n    for(int i = 1; i <= N - 1; ++i)\n        printf(\"%lld\\n\", F[i][Smx] * fact[i] % MOD * qpow(qpow(M, i), MOD - 2) % MOD);\n    fprintf(stderr, \"Time: %.6lf\\n\", (double)clock() / CLOCKS_PER_SEC);\n    return 0;\n}\n\ntemplate < typename T >\ninline T read(void){\n    T ret(0);\n    int flag(1);\n    char c = getchar();\n    while(c != '-' && !isdigit(c))c = getchar();\n    if(c == '-')flag = -1, c = getchar();\n    while(isdigit(c)){\n        ret *= 10;\n        ret += int(c - '0');\n        c = getchar();\n    }\n    ret *= flag;\n    return ret;\n}\n```\n\n## UPD\n\nupdate-2022_12_07 \u521d\u7a3f",
        "postTime": 1670465929,
        "uid": 362938,
        "name": "Tsawke",
        "ccfLevel": 6,
        "title": "[ABC253Ex] We Love Forest"
    }
]