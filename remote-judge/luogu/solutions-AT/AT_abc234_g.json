[
    {
        "content": "## problem\n\u957f\u4e3a $n$ \u7684\u5e8f\u5217 $a$\uff0c\u5c06\u5176\u5212\u5206\u6210\u82e5\u5e72\u4e2a\u8fde\u7eed\u7684\u5b50\u4e32 $B=\\{b_1,b_2,\\cdots,b_k\\}$\n\n\u4ee4 $f(B)=\\prod_i(\\max b_i-\\min b_i)$\uff0c\u6c42 $\\sum_B f(B)$\uff0c$n\\leq 10^5$\u3002\n\n## solution\n\u8003\u8651 DP\u3002\u4ee4 $f_i$ \u8868\u793a $[1,i]$ \u4e2d\u6240\u6709 $B$ \u7684\u4ef7\u503c\u4e4b\u548c\u3002\n\n\u8f6c\u79fb\u679a\u4e3e $j$ \u8868\u793a\u4e0a\u4e00\u6b21\u4ece\u54ea\u91cc\u6765\uff0c\u4e58\u6cd5\u5206\u914d\u5f8b\uff1a\n\n$$f_i=\\sum_j f_j\\left(\\max([j+1,i])-\\min([j+1,i])\\right).$$\n\n\u4f18\u5316\u8fd9\u4e2a\u8f6c\u79fb\uff0c\u4ee5 $\\max$ \u4e3a\u4f8b\uff0c\u8fd9\u7c7b\u4f3c\u4e8e\u662f\u540e\u7f00\u6700\u5927\u503c\u548c $f$ \u7684\u76f8\u5e94\u4f4d\u76f8\u4e58\u4e4b\u548c\u3002\u4e8e\u662f\u7528\u5355\u8c03\u6808\u7ef4\u62a4\u540e\u7f00\u6700\u5927\u503c\uff0c\u76f8\u540c\u7684\u540e\u7f00\u6700\u5927\u503c\u538b\u6210\u4e00\u4e2a\u533a\u95f4\uff0c\u7528\u4e58\u6cd5\u5206\u914d\u5f8b\uff0c\u52a8\u6001\u7ef4\u62a4\u4e0b\u4e00\u4e2a $f$ \u503c\u3002\n\n## code\n```cpp\n#include <cstdio>\n#include <cstring>\n#include <utility>\n#include <algorithm>\nusing namespace std;\n#define l first\n#define r second\ntypedef long long LL;\nconst int P=998244353;\nint n,a[300010];\nLL f[300010],sum[300010];\ntemplate<int N,int D> struct crxakioi{\n\tint top;LL ans;\n\tpair<int,int> stk[N+10];\n\tcrxakioi():top(0),ans(0){stk[0]={0,0};}\n\tvoid insert(int x){\n\t\twhile(top&&a[stk[top].r]*D<=a[x]*D){\n\t\t\tans-=(sum[stk[top].r-1]-sum[stk[top].l-2]+P)*a[stk[top].r]%P*(D+P)%P;\n\t\t\tans=(ans%P+P)%P;\n\t\t\ttop--;\n\t\t}\n\t\ttop++,stk[top]={stk[top-1].r+1,x};\n\t\tans+=(sum[stk[top].r-1]-sum[stk[top].l-2]+P)*a[stk[top].r]%P*(D+P)%P;\n        //\u51cf\u4e00\u662f\u56e0\u4e3a\u539f\u5f0f j+1\n\t\tans%=P;\n\t}\n};\ncrxakioi<300010,1> crx1;\ncrxakioi<300010,-1> crx2;\nint main(){\n//\t#ifdef LOCAL\n//\t \tfreopen(\"input.in\",\"r\",stdin);\n//\t#endif\n\ta[0]=1e9+7;\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<=n;i++) scanf(\"%d\",&a[i]);\n\tf[0]=sum[0]=1;\n\tfor(int i=1;i<=n;i++){\n//\t\tfor(int j=0;j<i;j++){\n//\t\t\tf[i]=(f[i]+f[j]*(t1.query(j+1,i)+t2.query(j+1,i))%P);\n//\t\t}\n\t\tcrx1.insert(i),crx2.insert(i);\n\t\tsum[i]=(sum[i-1]+(f[i]=(crx1.ans+crx2.ans)%P))%P;\n\t}\n\tprintf(\"%lld\\n\",f[n]);\n\treturn 0;\n}\n\n```\n",
        "postTime": 1665744892,
        "uid": 509229,
        "name": "yukimianyan",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 ABC234G\u3010Divide a Sequence\u3011"
    }
]