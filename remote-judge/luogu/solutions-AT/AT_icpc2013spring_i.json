[
    {
        "content": "[\u4f20\u9001\u95e8](https://www.luogu.com.cn/problem/AT641)\n\n#### \u524d\u7f6e\u77e5\u8bc6\uff1a\n\n\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811\u3002\n\n#### \u9898\u610f\uff1a\n\n- \u7ed9\u51fa $n$ \u4e2a\u521d\u59cb\u4e3a\u7a7a\u7684\u53ef\u91cd\u96c6\uff0c\u8bb0\u4e3a $t_{1\\dots n}$\u3002\n\n- \u6267\u884c $m$ \u6b21\u64cd\u4f5c\uff0c\u7b2c $i$ \u6b21\u5f80\u6240\u6709 $k\\in[a_i,b_i]$ \u7684 $t_k$ \u4e2d\u653e\u5165\u4e00\u4e2a\u6570 $v_i$\u3002\n\n- \u5904\u7406 $q$ \u6b21\u67e5\u8be2\uff0c\u7b2c $i$ \u6b21\u8be2\u95ee\u6240\u6709 $k\\in[x_i,y_i]$ \u7684 $t_k$ \u4e2d\u7b2c $j_i$ \u5c0f\u7684\u6570\u3002\n\n- $1\\le n\\le10^9$\uff0c$1\\le m,q\\le10^5$\n\n\u5982\u679c\u4f60\u521a\u521a\u624d\u77e5\u9053\u8fd9\u9898\u53ef\u4ee5\u7528\u53ef\u6301\u4e45\u5316\u7ebf\u6bb5\u6811\u5199\uff0c\u90a3\u4e48\u8bf7\u518d\u81ea\u5df1\u601d\u8003\u4e00\u4f1a\u3002~~\u56e0\u4e3a\u505a\u6cd5\u8fd8\u662f\u6bd4\u8f83\u597d\u60f3\u7684\u2026~~\n\n#### \u5206\u6790\uff1a\n\n\u56e0\u4e3a $n\\le10^9$ \u8fd8\u662f\u533a\u95f4\u4fee\u6539\uff0c\u6240\u4ee5\u4e0d\u80fd\u5bf9\u6bcf\u4e00\u4e2a\u4e0b\u6807\u90fd\u5efa\u4e00\u68f5\u7ebf\u6bb5\u6811\u3002\u8003\u8651\u628a\u6bcf\u4e2a\u503c\u79bb\u6563\u5316\u540e\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u503c $v$ \u5efa\u4e00\u68f5\u7ebf\u6bb5\u6811\uff0c\u5b58\u50a8\u6bcf\u4e2a\u53ef\u91cd\u96c6\u4e2d\u8be5\u503c\u7684\u6570\u91cf\n\n\u8003\u8651\u5230\u8fd9\u4e00\u6570\u636e\u7684\u53ef\u51cf\u6027\uff0c\u53ef\u4ee5\u7ef4\u62a4\u5176\u524d\u7f00\u548c\uff0c\u5373\u7ef4\u62a4\u6bcf\u4e2a\u53ef\u91cd\u96c6\u4e2d\u4e0d\u5927\u4e8e $v$ \u7684\u6570\u7684\u6570\u91cf\uff0c\u518d\u4f7f\u7528\u4e3b\u5e2d\u6811\u7ef4\u62a4\u65b0\u7ebf\u6bb5\u6811\u3002\n\n\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u65b9\u4fbf\u5730\u6c42\u51fa $[x,y]$ \u4e2d\u6240\u6709\u4e0d\u5927\u4e8e $v$ \u7684\u6570\u7684\u6570\u91cf $num_v$\u3002\u8fd9\u4e2a\u7ed3\u679c\u968f\u7740 $v$ \u589e\u5927\u663e\u7136\u662f\u5355\u589e\u7684\uff0c\u800c\u6700\u5c0f\u7684\u6ee1\u8db3 $num_v\\ge v$ \u7684 $v$ \u5c31\u662f\u7b2c $j$ \u5c0f\u6570\u3002\u6545\u8003\u8651\u4e8c\u5206\u7b54\u6848\u3002\n\n\u4e8c\u5206 $O(\\log m)$\uff0c\u4fee\u6539\u3001\u67e5\u8be2 $O(\\log n)$\uff0c\u6545\u603b\u65f6\u95f4\u590d\u6742\u5ea6 $O(m\\log n+q\\log m \\log n)$\uff1b\u7a7a\u95f4 $O(m\\log n)$\u3002\n\n#### \u601d\u8def\uff1a\n\n1. \u79bb\u6563\u5316\uff0c\u5bf9\u6bcf\u4e2a\u503c\u5efa\u4e00\u68f5\u7ebf\u6bb5\u6811\uff0c\u7528\u4e3b\u5e2d\u6811\u7ef4\u62a4\u3002\n\n2. \u5bf9\u6bcf\u4e2a\u67e5\u8be2\u4e8c\u5206\u6c42\u7b54\u6848\u3002\n\n---\n\n#### \u4e3b\u5e2d\u6811\uff1a\n\n~~\u56e0\u4e3a\u524d\u9762\u592a\u6c34\u4e86\uff0c\u53ea\u597d\u8bb2\u4e00\u4e0b\u5177\u4f53\u5199\u6cd5\u3002~~\n\n\u7531\u4e8e\u533a\u95f4\u4fee\u6539\u7684\u4e3b\u5e2d\u6811\u6bd4\u8f83\u96be\u5199\uff0c\u6240\u4ee5\u91c7\u7528\u5dee\u5206\u5199\u6cd5\u3002\n\n\u8bb0\u5dee\u5206\u6570\u7ec4\u4e3a $b_i$\uff0c\u6ce8\u610f\u5230\u6211\u4eec\u662f\u8981\u6c42\u533a\u95f4\u548c\u7684\uff0c\u6240\u4ee5\u7c7b\u4f3c\u4e8e\u6811\u72b6\u6570\u7ec4\u7684\u533a\u95f4\u4fee\u6539\u533a\u95f4\u67e5\u8be2\uff0c\u6211\u4eec\u8fd8\u8981\u8bb0\u5f55\u4e00\u4e2a $c_i$ \u8868\u793a $ib_i$\u3002\n\n\u5177\u4f53\u5730\uff0c\u8bbe\u539f\u6570\u7ec4\u4e3a $a_i$\uff0c\u5e76\u5047\u8bbe\u8981\u6c42\u51fa $\\sum\\limits_{i=1}^xa_i$\u3002\u7531\u4e8e $a_i=\\sum\\limits_{j=1}^ib_j$\uff0c\u6545\u539f\u5f0f\u5316\u4e3a $\\sum\\limits_{i=1}^x\\sum\\limits_{j=1}^ib_j$\u3002\n\n\u8003\u8651\u6bcf\u4e2a $b_j$ \u5bf9\u8be5\u5f0f\u7684\u8d21\u732e\uff0c\u5f97\u5230 $\\sum\\limits_{j=1}^x(x-j+1)b_j=(x+1)\\sum\\limits_{j=1}^xb_j-\\sum\\limits_{j=1}^xjb_j$\u3002\n\n\u4ee3\u7801\u5b9e\u73b0\u5728\u5b8c\u6574\u4ee3\u7801\u4e2d\u7ed9\u51fa\u3002\n\n---\n\n```cpp\n#include <bits/stdc++.h>\n#define rep(i, l, r) for(register int i=l; i<=r; ++i)\n#define rrep(i, r, l) for(register int i=r; i>=l; --i)\n#define ll long long\nusing namespace std;\ninline ll read() {\n\tll ret=0, k=1; char c; do if((c=getchar())=='-') k=-1; while(c<'0' || c>'9');\n\twhile(c>='0' && c<='9') ret=(ret<<1)+(ret<<3)+(c^48), c=getchar(); return k*ret;\n}\nconst int mM=1e5+100, mS=180*mM;\nint n, m, q, a[mM], b[mM], v[mM];\nint ork, rk[mM];\nint oe, head[mM], ver[mM], nxt[mM];\ninline void add(int x, int y) {nxt[++oe]=head[x], ver[oe]=y, head[x]=oe;}\n\nnamespace Segment_Tree {\n#define lc tree[p].son[0]\n#define rc tree[p].son[1]\n\tint on, rt[mM];\n\tstruct node {\n\t\tint son[2]; ll sum0, sum1;\t//sum0 sum1 \u5bf9\u5e94\u9898\u89e3\u4e2d\u7684 b c \u6570\u7ec4\u5728\u5bf9\u5e94\u533a\u95f4\u7684\u603b\u548c \n\t\tnode(): sum0(0), sum1(0) {}\n\t} tree[mS];\n\tvoid modify(int lp, int &p, int l, int r, int x, int z) {\t//\u4fee\u6539\uff0c\u7ed9\u4f4d\u7f6e x \u589e\u52a0 z \n\t\tif(p==lp || !p) p=++on, tree[p]=tree[lp];\n\t\tif(l==r) {tree[p].sum0+=z, tree[p].sum1+=(ll) x*z; return;}\n\t\tif(x<=(l+r>>1)) modify(tree[lp].son[0], lc, l, l+r>>1, x, z);\n\t\telse modify(tree[lp].son[1], rc, (l+r>>1)+1, r, x, z);\n\t\ttree[p].sum0=tree[lc].sum0+tree[rc].sum0, tree[p].sum1=tree[lc].sum1+tree[rc].sum1; \n\t}\n\tll query(int p, int l, int r, int x) {\n\t\tif(r<=x) return (x+1)*tree[p].sum0-tree[p].sum1;\t//(x+1)sigma(b)-sigma(c)\n\t\treturn (lc?query(lc, l, l+r>>1, x):0)+(rc&&(l+r>>1)<x?query(rc, (l+r>>1)+1, r, x):0);\n\t}\n#undef lc\n#undef rc\n}\nusing namespace Segment_Tree;\n\npair <int, int> tmp[mM];\nvoid getrk() {\t//\u79bb\u6563\u5316\uff0c\u5199\u5f97\u6bd4\u8f83\u4e11\uff08 \n\trep(i, 1, m) tmp[i]=make_pair(v[i], i);\n\tsort(tmp+1, tmp+m+1);\n\trep(i, 1, m) {\n\t\tif(tmp[i].first!=tmp[i-1].first) ++ork;\n\t\trk[ork]=tmp[i].first, add(ork, tmp[i].second);\t//\u7b2c ork \u68f5\u7ebf\u6bb5\u6811\u9700\u8981\u5904\u7406\u7b2c tmp[i].second \u6b21\u7684\u4fee\u6539 \n\t}\n}\nint main() {\n\tn=read(), m=read(), q=read();\n\trep(i, 1, m) a[i]=read(), b[i]=read(), v[i]=read();\n\tgetrk();\n\trep(i, 1, ork) for(int t=head[i]; t; t=nxt[t]) {\t//\u5dee\u5206\uff0cm(a, b, 1)=m(a, n, 1), m(b+1, n, -1)\n\t\tmodify(rt[i-1], rt[i], 1, n, a[ver[t]], 1);\n\t\tmodify(rt[i-1], rt[i], 1, n, b[ver[t]]+1, -1);\n\t}\n\tint x, y, L, R, mid;\n\tll j;\n\twhile(q--) {\n\t\tx=read(), y=read(), j=read(), L=1, R=ork, mid=L+R>>1;\n\t\twhile(L<=R) {\n\t\t\tif(query(rt[mid], 1, n, y)-(x>1?query(rt[mid], 1, n, x-1):0ll)>=j) R=mid-1;\t//\u5dee\u5206\uff0cq[x,y]=q[1,x]-q[1,y-1] \n\t\t\telse L=mid+1;\n\t\t}\n\t\t//\u6ee1\u8db3\u6761\u4ef6\u65f6 R=mid-1\uff0c\u4e0d\u6ee1\u8db3\u65f6 L=mid+1\uff0c\u6240\u4ee5 L \u843d\u5728\u6ee1\u8db3\u6761\u4ef6\u7684\u8303\u56f4\u4e2d \n\t\tprintf(\"%d\\n\", rk[L]);\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1624599107,
        "uid": 364963,
        "name": "\u963f\u4e11",
        "ccfLevel": 0,
        "title": "\u9898\u89e3 AT641 The J-th Number"
    }
]