[
    {
        "content": "\u8003\u8651\u72b6\u538b dp\u3002\n\n\u8bbe $f_{i,j,s}$ \u8868\u793a\u5f53\u524d\u6b63\u5728\u51b3\u7b56\u5750\u6807\u4e3a $(i,j)$ \u7684\u683c\u5b50\uff0c\u4e14\u5217\u72b6\u6001\u4e3a $s$\u3002\u5176\u4e2d\u5217\u72b6\u6001\u7ef4\u62a4\u4e86\u5f53\u524d\u8f6e\u5ed3\u7ebf\u4e0a\u7684\u8fde\u901a\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u6700\u5c0f\u8868\u793a\u6cd5\u6765\u7b80\u5355\u7ef4\u62a4\u3002\n\n\uff08\u4e3a\u4ec0\u4e48\u4e0d\u7528\u5e7f\u4e49\u62ec\u53f7\u5e8f\u5217\uff1f\u56e0\u4e3a\u5176\u6d89\u53ca\u5230 $5$ \u4e2a\u53ef\u9009\u503c\uff0c\u7531\u4e8e $m\\le 7$\uff0c\u6240\u4ee5\u8fd9\u4e24\u4e2a\u90fd\u9700\u8981\u7528\u5230\u516b\u8fdb\u5236\uff0c\u800c\u6700\u5c0f\u8868\u793a\u6cd5\u663e\u7136\u8981\u597d\u5199\u5f88\u591a\u3002\uff09\n\n\u5982\u679c\u6211\u4eec\u9009\u62e9\u5c06\u5f53\u524d\u683c\u5b50\u53d8\u6210\u9ed1\u8272\uff0c\u90a3\u4e48\u76f8\u5f53\u4e8e\u5408\u5e76\u4e86\u5f53\u524d\u683c\u4e0a\u9762\u548c\u5de6\u8fb9\u7684\u4e24\u4e2a\u8fde\u901a\u5757\u3002\n\n\u5982\u679c\u6211\u4eec\u4fdd\u6301\u5f53\u524d\u683c\u5b50\u4e3a\u767d\u8272\uff0c\u90a3\u4e48\u5565\u90fd\u4e0d\u53d8\uff0c\u4f46\u8981\u6ce8\u610f\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u67d0\u4e2a\u8fde\u901a\u5757\u88ab\u5b64\u7acb\u5bfc\u81f4\u9519\u89e3\u3002\n\n\u76f4\u63a5\u7edf\u8ba1\u7b54\u6848\u5373\u53ef\u3002\n\n```cpp\n#include <iostream>\n#include <map>\n\nusing namespace std;\n\nconst int kN = 101, kM = 7;\nconst int kL = 1 << 3 * kM;\n\nint n, m, o, l, li, ans = 1e9, gc[kL], gt[kL][kM], ct[kL][8];\nchar a[kN][kM];\nmap<int, int> f[2];\n\nint G(int s, int i) { return i < 0 ? 0 : (s >> i * 3 & 7); }\nint S(int s, int i, int v) { return s ^ (G(s, i) << i * 3) ^ (v << i * 3); }\nvoid U(int i, int v) {\n  auto p = f[o].find(i);\n  if (p != f[o].end()) {\n    p->second = min(p->second, v);\n  } else {\n    f[o][i] = v;\n  }\n}\n\nint main() {\n  ios_base::sync_with_stdio(0), cin.tie(0);\n  cin >> n >> m;\n  l = 1 << 3 * m;\n  for (int i = 0; i < l; ++i) {\n    for (int j = 0; j < m; ++j) {\n      ++ct[i][G(i, j)];\n    }\n    for (int j = 1; j <= m; ++j) {\n      if (!ct[i][j]) {\n        gc[i] = j;\n        break;\n      }\n    }\n    for (int j = 1; j < m; ++j) {\n      int vl = G(i, j - 1), vu = G(i, j);\n      gt[i][j] = i;\n      for (int k = 0; k < m; ++k) {\n        if (G(gt[i][j], k) == vu) {\n          gt[i][j] = S(gt[i][j], k, vl);\n        }\n      }\n    }\n  }\n  for (int i = 1; i <= n; ++i) {\n    for (int j = 0; j < m; ++j) {\n      cin >> a[i][j];\n    }\n  }\n  for (int i = n; i >= 1; --i) {\n    for (int j = m - 1; j >= 0; --j) {\n      if (a[i][j] == '#') {\n        li = i;\n        break;\n      }\n    }\n    if (li) {\n      break;\n    }\n  }\n  f[o][0] = 0;\n  for (int i = 1; i <= li; ++i) {\n    for (int j = 0; j < m; ++j) {\n      o ^= 1;\n      f[o].clear();\n      for (auto k : f[!o]) {\n        int s = k.first, fv = k.second;\n        int vl = G(s, j - 1), vu = G(s, j), v = (a[i][j] == '.');\n        if (!vl && !vu) {  // \u65b0\u5f00\u4e00\u4e2a\u8fde\u901a\u5757\n          U(S(s, j, gc[s]), fv + v);\n        } else if (vl && !vu) {  // \u63a5\u4e0a\u5de6\u8fb9\u7684\u8fde\u901a\u5757\n          U(S(s, j, vl), fv + v);\n        } else if (!vl && vu) {  // \u63a5\u4e0a\u4e0a\u9762\u7684\u8fde\u901a\u5757\n          U(s, fv + v);\n        } else {  // \u5c06\u5de6\u8fb9\u548c\u4e0a\u9762\u7684\u8fde\u901a\u5757\u63a5\u8d77\u6765\n          U(gt[s][j], fv + v);\n        }\n        if (a[i][j] == '.') {  // \u4e0d\u6d82\u9ed1\n          int vu = G(s, j);\n          if (!vu || ct[s][vu] > 1) {  // \u4e0d\u80fd\u5b64\u7acb\u67d0\u4e2a\u8fde\u901a\u5757\n            U(S(s, j, 0), fv);\n          }\n        }\n      }\n    }\n  }\n  for (auto p : f[o]) {\n    int i = p.first, fv = p.second;\n    int g = 0;\n    for (int j = 0; j < m; ++j) {\n      int v = G(i, j);\n      if (!g) {\n        g = v;\n      } else if (v && v != g) {\n        g = -1;\n        break;\n      }\n    }\n    if (~g) {\n      ans = min(ans, fv);\n    }\n  }\n  cout << ans;\n  return 0;\n}\n```\n",
        "postTime": 1681525964,
        "uid": 376161,
        "name": "wsfxk",
        "ccfLevel": 6,
        "title": "[ABC296Ex] Unite \u9898\u89e3"
    },
    {
        "content": "\u8003\u8651\u4e00\u884c\u4e00\u884c\u5f80\u4e0b dp\uff0c\u4e00\u4e2a\u72b6\u6001\u9700\u8981\u8bb0\u5f55\u6bcf\u4e2a\u683c\u5b50\u662f\u5426\u662f\u9ed1\u8272\uff0c\u5bf9\u4e8e\u9ed1\u8272\u8fd8\u6709\u8bb0\u5f55\u5176\u5e76\u67e5\u96c6\u3002\u7206\u641c\u8dd1\u4e00\u4e0b\u672c\u8d28\u4e0d\u540c\u72b6\u6001\u6570\u4e0d\u662f\u5f88\u591a\uff0cdp \u5c31\u884c\u4e86\u3002\n\n\u8fd9\u91cc\u7206\u641c\u5e76\u67e5\u96c6\u7684\u65b9\u6cd5\u662f\uff0c\u8ba9\u4e00\u4e2a\u8fde\u901a\u5757\u6839\u662f\u6700\u5c0f\u7684\u90a3\u4e2a\u70b9\uff0c\u7136\u540e\u628a\u6bcf\u4e2a\u70b9\u6240\u5728\u8fde\u901a\u5757\u4e2d\u7684\u6839\u5b57\u7b26\u4e32\u54c8\u5e0c\u8d77\u6765\u3002\n\n$m=7$ \u7684\u65f6\u5019\u72b6\u6001\u6570\u53ea\u6709 $324$\uff0e\n\n```cpp\n#include<cstdio>\n#include<vector>\n#include<queue>\n#include<cstring>\n#include<iostream>\n#include<algorithm>\n#include<ctime>\n#include<random>\n#include<assert.h>\n#include<map>\n#define pb emplace_back\n#define mp make_pair\n#define fi first\n#define se second\n#define dbg(x) cerr<<\"In Line \"<< __LINE__<<\" the \"<<#x<<\" = \"<<x<<'\\n';\n#define dpi(x,y) cerr<<\"In Line \"<<__LINE__<<\" the \"<<#x<<\" = \"<<x<<\" ; \"<<\"the \"<<#y<<\" = \"<<y<<'\\n';\nusing namespace std;\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int>pii;\ntypedef pair<ll,int>pli;\ntypedef pair<ll,ll>pll;\ntypedef pair<int,ll>pil;\ntypedef vector<int>vi;\ntypedef vector<ll>vll;\ntypedef vector<pii>vpii;\ntypedef vector<pil>vpil;\ntemplate<typename T>T cmax(T &x, T y){return x=x>y?x:y;}\ntemplate<typename T>T cmin(T &x, T y){return x=x<y?x:y;}\ntemplate<typename T>\nT &read(T &r){\n\tr=0;bool w=0;char ch=getchar();\n\twhile(ch<'0'||ch>'9')w=ch=='-'?1:0,ch=getchar();\n\twhile(ch>='0'&&ch<='9')r=r*10+(ch^48),ch=getchar();\n\treturn r=w?-r:r;\n}\ntemplate<typename T1,typename... T2>\nvoid read(T1 &x,T2& ...y){read(x);read(y...);}\nconst int mod=998244353;\ninline void cadd(int &x,int y){x=(x+y>=mod)?(x+y-mod):(x+y);}\ninline void cdel(int &x,int y){x=(x-y<0)?(x-y+mod):(x-y);}\ninline int add(int x,int y){return (x+y>=mod)?(x+y-mod):(x+y);}\ninline int del(int x,int y){return (x-y<0)?(x-y+mod):(x-y);}\nint qpow(int x,int y){\n\tint s=1;\n\twhile(y){\n\t\tif(y&1)s=1ll*s*x%mod;\n\t\tx=1ll*x*x%mod;\n\t\ty>>=1;\n\t}\n\treturn s;\n}\nconst int N=110;\nconst int inf=0x3f3f3f3f;\nint n,m;\nchar ch[N][11];\nint s[N][11];\nstruct ST{\n\tint ok[8],p[8];\n\tull has;\n\tvoid rhas(){\n\t\thas=0;\n\t\tfor(int i=0;i<m;i++)has=has*233+ok[i]+1;\n\t\tfor(int i=0;i<m;i++)has=has*233+p[i]+1;\n\t}\n\tvoid mem(){\n\t\tfor(int i=0;i<8;i++)ok[i]=0;\n\t\tfor(int i=0;i<8;i++)p[i]=i;\n\t}\n\tint getfa(int x){return p[x]==x?x:p[x]=getfa(p[x]);}\n\tvoid merge(int x,int y){\n\t\tint fx=getfa(x),fy=getfa(y);\n\t\tif(fx>fy)\n\t\t\tswap(fx,fy);\n\t\tp[fy]=fx;\n\t\tfor(int i=0;i<m;i++)getfa(i);\n\t}\n\tvoid init(){\n\t\tfor(int i=1;i<m;i++)\n\t\t\tif(ok[i]&&ok[i-1])\n\t\t\t\tmerge(i-1,i);\n\t}\n\tbool check(){\n\t\tint c=0;\n\t\tfor(int i=0;i<m;i++)\n\t\t\tif(ok[i])\n\t\t\t\tc+=p[i]==i;\n\t\treturn c<=1;\n\t}\n};\nint tot;\nmap<ull,int>vis;\nST st[510];\nint dfs(ST a){\n\ta.rhas();\n\tif(vis[a.has])return vis[a.has];\n\tint ed=vis[a.has]=++tot;\n\tst[tot]=a;\n\tfor(int i=0;i<m;i++)\n\t\tfor(int j=i+1;j<m;j++)\n\t\t\tif(a.ok[i] && a.ok[j] && a.p[i]!=a.p[j]){\n\t\t\t\tST b=a;\n\t\t\t\tb.merge(i,j);\n\t\t\t\tdfs(b);\n\t\t\t}\n\treturn ed;\n}\nint dp[110][510];\nint pos[220];\nsigned main(){\n\t#ifdef do_while_true\n//\t\tassert(freopen(\"data.in\",\"r\",stdin));\n//\t\tassert(freopen(\"data.out\",\"w\",stdout));\n\t#endif\n\tread(n);read(m);\n\tfor(int i=1;i<=n;i++){\n\t\tscanf(\"%s\",ch[i]);\n\t\tfor(int j=0;j<m;j++)\n\t\t\ts[i][j]=ch[i][j]=='#'?1:0;\n\t}\n\tfor(int i=0;i<(1<<m);i++){\n\t\tST a;a.mem();\n\t\tfor(int j=0;j<m;j++)\n\t\t\tif((1<<j)&i)\n\t\t\t\ta.ok[j]=1;\n\t\ta.init();\n\t\tpos[i]=dfs(a);\n\t}\n\tint l=1,r=n;\n\tfor(int i=1;i<=n;i++){\n\t\tbool fl=0;\n\t\tfor(int j=0;j<m;j++)\n\t\t\tif(s[i][j])\n\t\t\t\tfl=1;\n\t\tif(fl){\n\t\t\tl=i;\n\t\t\tbreak;\n\t\t}\n\t}\n\tfor(int i=n;i>=1;i--){\n\t\tbool fl=0;\n\t\tfor(int j=0;j<m;j++)\n\t\t\tif(s[i][j])\n\t\t\t\tfl=1;\n\t\tif(fl){\n\t\t\tr=i;\n\t\t\tbreak;\n\t\t}\n\t}\n\tmemset(dp,0x3f,sizeof(dp));\n\t{\n\t\tint S=0;\n\t\tfor(int j=0;j<m;j++)\n\t\t\tS|=s[l][j]<<j;\n\t\tfor(int i=0;i<(1<<m);i++)\n\t\t\tif((i&S)==S)\n\t\t\t\tdp[l][pos[i]]=__builtin_popcount(i^S);\n\t}\n\tfor(int i=l;i<r;i++){\n\t\tint S=0;\n\t\tfor(int j=0;j<m;j++)\n\t\t\tS|=s[i+1][j]<<j;\n\t\tfor(int c=1;c<=tot;c++)\n\t\t\tif(dp[i][c]!=inf){\n\t\t\t\tST a=st[c];\n\t\t\t\tint T=((1<<m)-1)^S;\n\t\t\t\tfor(int O=T;;O=(O-1)&T){\n\t\t\t\t\tint tS=((1<<m)-1)^O;\n\t\t\t\t\tST b=a;\n\t\t\t\t\tST d=st[pos[tS]];\n\t\t\t\t\tvi hav(m);\n\t\t\t\t\tfor(int j=0;j<m;j++)\n\t\t\t\t\t\tif(((1<<j)&tS) && b.ok[j])\n\t\t\t\t\t\t\thav[b.p[j]]=1;\n\t\t\t\t\tbool fl=0;\n\t\t\t\t\tfor(int j=0;j<m;j++)\n\t\t\t\t\t\tif(b.ok[j] && b.p[j]==j)\n\t\t\t\t\t\t\tif(!hav[j])\n\t\t\t\t\t\t\t\tfl=1;\n\t\t\t\t\tif(fl)continue;\n\t\t\t\t\tfor(int j=0;j<m;j++)\n\t\t\t\t\t\tfor(int k=j+1;k<m;k++)\n\t\t\t\t\t\t\tif(b.p[j]==b.p[k] && d.ok[j] && d.ok[k] && b.ok[j] && b.ok[k])\n\t\t\t\t\t\t\t\td.merge(j,k);\n\t\t\t\t\td.rhas();\n\t\t\t\t\tcmin(dp[i+1][vis[d.has]],dp[i][c]+__builtin_popcount(tS^S));\n\t\t\t\t\tif(O==0)break;\n\t\t\t\t}\n\t\t\t}\n\t}\n\tint ans=inf;\n\tfor(int i=1;i<=tot;i++)\n\t\tif(st[i].check())\n\t\t\tcmin(ans,dp[r][i]);\n\tcout << ans << '\\n';\n    #ifdef do_while_true\n\t\tcerr<<'\\n'<<\"Time:\"<<1.0*clock()/CLOCKS_PER_SEC*1000<<\" ms\"<<'\\n';\n\t#endif\n\treturn 0;\n}\n```",
        "postTime": 1681207596,
        "uid": 223298,
        "name": "do_while_true",
        "ccfLevel": 8,
        "title": "\u300c\u9898\u89e3\u300dABC296Ex Unite"
    }
]