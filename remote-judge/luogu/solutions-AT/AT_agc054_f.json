[
    {
        "content": "\u8bb0 $a_i$ \u4e3a $A_i$ \u6700\u7ec8\u5220\u9664\u4e86\u591a\u5c11\uff0c$b_i$ \u4e3a $B_i$ \u6700\u7ec8\u5220\u9664\u4e86\u591a\u5c11\uff0c\u4e0d\u59a8\u8bbe $a_0=b_0=a_{n+1}=b_n=0$\n\n\u7ed3\u8bba\uff1a\u6570\u5217 $a,b$ \u5408\u6cd5\u5f53\u4e14\u4ec5\u5f53\u5bf9\u4e8e\u4efb\u610f $i$ \u6709 $2| a_i+b_i+b_{i-1}$ \u4e14 $\\max\\{a_i,b_i,b_{i-1}\\}\\le \\frac{a_i+b_i+b_{i-1}}{2}$\n\n\u8bc1\u660e\uff1a\u5148\u8bc1\u5fc5\u8981\u6027\uff0c\u663e\u7136\u4e00\u6b21\u64cd\u4f5c $[l,r]$ \u4f1a\u628a $a_l,b_l$ \u51cf\u53bb $1$\uff0c$a_r,b_{r-1}$ \u51cf\u53bb $1$\uff0c$b_i,b_{i-1}(i\\in(l,r))$ \u51cf\u53bb $1$\uff0c\u5373\u4e00\u6b21\u64cd\u4f5c\u4f1a\u5bf9 $[l,r]$ \u4e2d\u6240\u6709\u4f4d\u7f6e\u7684 $a_i,b_i,b_{i-1}$ \u4e2d\u7684\u4e24\u4e2a\u51cf\u53bb $1$\uff0c\u663e\u7136\u9700\u8981\u6ee1\u8db3\u4e0a\u8ff0\u6761\u4ef6\n\n\u4e0b\u8bc1\u5145\u5206\u6027\uff0c\u8003\u8651\u6784\u9020\u51fa\u4e00\u7ec4\u5408\u6cd5\u7684\u64cd\u4f5c\uff0c\u6bcf\u6b21\u9009\u51fa\u4e00\u5bf9\u76f8\u90bb\u7684\u6ee1\u8db3 $a_i=b_i+b_{i-1}$ \u7684\u4f4d\u7f6e\u64cd\u4f5c\uff0c\u663e\u7136\u64cd\u4f5c\u4e4b\u540e\u4ecd\u7136\u5408\u6cd5\uff0c\u7531\u4e8e\u5e8f\u5217\u4e24\u7aef\u4e00\u5b9a\u6ee1\u8db3\u6761\u4ef6\uff0c\u6240\u4ee5\u4e00\u5b9a\u53ef\u4ee5\u9009\u51fa\u8fd9\u6837\u7684\u4e00\u5bf9\u4f4d\u7f6e\n\n\u56de\u5230\u539f\u9898\uff0c\u8003\u8651\u5148\u8c03\u6574\u4e00\u4e0b $A_i$ \u548c $B_i$\n\n\u82e5 $B_i>A_i+B_{i-1}$ \u5219\u53ef\u4ee5\u4ee4 $B_i=A_{i}+B_{i-1}$\uff0c\u663e\u7136\u8fd9\u4e0d\u4f1a\u5f71\u54cd\u7b54\u6848\uff0c\u5bf9 $B_{i-1}$ \u540c\u7406\n\n\u8fd9\u4e00\u6b65\u53ef\u4ee5\u7528\u6700\u77ed\u8def\u5728 $\\mathcal O(n\\log n)$ \u7684\u65f6\u95f4\u5185\u89e3\u51b3\n\n\u82e5 $A_i\\ge B_i+B_{i-1}$\uff0c\u5219\u53ef\u4ee5\u628a\u539f\u95ee\u9898\u5206\u6210 $[1,i]$ \u548c $[i,n]$ \u4e24\u4e2a\u5b50\u95ee\u9898\uff0c\u524d\u4e00\u4e2a\u5b50\u95ee\u9898\u4e2d\u4ee4 $A_i=B_{i-1}$\uff0c\u540e\u4e00\u4e2a\u5b50\u95ee\u9898\u4e2d\u4ee4 $A_i=B_i$\uff0c\u8fd9\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u7b54\u6848\n\n\u6b64\u65f6\u53ea\u9700\u8981\u8003\u8651 $|B_{i}-B_{i-1}|\\le A_i<B_i+B_{i-1}$ \u7684\u60c5\u51b5\uff0c\u6211\u4eec\u60f3\u8981\u6700\u5927\u5316 $\\sum a_i$\n\n\u8bb0 $f_i$ \u4e3a $a_1,\\dots,a_i$ \u5168\u90e8\u53d6 $A_1,\\dots,A_i$ \u65f6 $b_i$ \u7684\u53d6\u503c\u8303\u56f4\uff0c\u5047\u8bbe\u6211\u4eec\u786e\u5b9a\u4e86 $b_{i-1}$\uff0c\u5219\u6b64\u65f6 $f_{i}=\\{x|x\\in[|A_i-b_{i-1}|,\\min\\{A_i+b_{i-1},B_i\\}],x\\equiv A_i+b_{i-1}\\pmod 2\\}$\n\n\u4e0d\u96be\u53d1\u73b0 $f_i$ \u4e00\u5b9a\u662f\u4e00\u4e2a\u533a\u95f4\u9650\u5236\u548c\u4e00\u4e2a\u5947\u5076\u6027\u9650\u5236\u7684\u5f62\u5f0f\uff0c\u4e14\u533a\u95f4\u53f3\u7aef\u70b9\u4e3a $B_i$\uff0c\u90a3\u4e48\u5f88\u5bb9\u6613\u53ef\u4ee5\u901a\u8fc7 $f_{i-1}$ \u63a8\u5230 $f_i$\n\n\u7531\u4e8e\u5728\u5e8f\u5217\u53f3\u7aef\u70b9\u6709 $B_i=0,A_i=B_{i-1}$\uff0c\u6240\u4ee5 $f_n$ \u7684\u533a\u95f4\u9650\u5236\u4e3a $[0,0]$\uff0c\u6b64\u65f6\u82e5 $2|\\sum A_i$ \u5219\u6709 $f_n$ \u7684\u5947\u5076\u6027\u9650\u5236\u4e5f\u4e3a $0$\uff0c\u5373 $a_1,\\dots,a_n$ \u53d6 $A_1,\\dots,A_n$ \u662f\u5408\u6cd5\u7684\uff1b\u5426\u5219 $a_1,\\dots,a_n$ \u53d6 $A_1,\\dots,A_{n-1},A_n-1$ \u4e5f\u662f\u5408\u6cd5\u7684\n\n\u7efc\u4e0a\uff0c$2|\\sum A_i$ \u65f6 $\\sum a_i$ \u6700\u5927\u53d6\u5230 $\\sum A_i$\uff0c\u65b9\u6848\u6570\u4e3a $1$\uff1b$2\\not|\\sum A_i$ \u65f6 $\\sum a_i$ \u6700\u5927\u53d6\u5230 $(\\sum A_i)-1$\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6c42\u51fa\u6b64\u65f6\u6709\u591a\u5c11\u4e2a\u4f4d\u7f6e $i$ \u53d6 $A_i-1$ \u65f6\u5408\u6cd5\n\n\u8bb0 $g_i$ \u4e3a $a_i,\\dots,a_n$ \u5168\u90e8\u53d6 $A_i,\\dots,A_n$ \u65f6 $b_{i-1}$ \u7684\u53d6\u503c\u8303\u56f4\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u548c $f$ \u4e00\u6837\u7684\u65b9\u5f0f\u4ece $g_{i+1}$ \u63a8\u5230 $g_i$\n\n\u6b64\u65f6\u5bf9\u4e8e\u4e00\u4e2a\u4f4d\u7f6e $i$\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u540c\u6837\u7684\u8f6c\u79fb\u65b9\u6cd5\u5408\u5e76 $f_{i-1}$ \u548c $g_{i+1}$ \u5f97\u5230 $a_1,\\dots,a_{i-1},a_{i+1},\\dots,a_{n}$ \u5168\u90e8\u53d6 $A_1,\\dots,A_{i-1},A_{i+1},\\dots,A_n$ \u65f6 $a_i$ \u7684\u53d6\u503c\u8303\u56f4\uff0c\u73b0\u5728\u53ea\u9700\u8981\u5224\u65ad $A_i-1$ \u662f\u5426\u5728\u8fd9\u4e2a\u53d6\u503c\u8303\u56f4\u5185\u5373\u53ef\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\mathcal O(n\\log n)$\n\ncode:\n```cpp\n#include<bits/stdc++.h>\n#define int long long\n#define MAXN 200010\n#define p 998244353\n#define pii pair<int,int>\n#define mp make_pair\n#define fi first\n#define se second\nusing namespace std;\nint n,a[MAXN],b[MAXN];\npriority_queue<pii>Q;\nint vis[MAXN];\nvoid dijkstra(){\n\tfor(int i=0;i<=n;i++)Q.push(mp(-b[i],i));\n\twhile(!Q.empty()){\n\t\tint u=Q.top().se;Q.pop();\n\t\tif(vis[u])continue;vis[u]=1;\n\t\tif(b[u-1]>a[u]+b[u])b[u-1]=a[u]+b[u],Q.push(mp(-b[u-1],u-1));\n\t\tif(b[u+1]>a[u+1]+b[u])b[u+1]=a[u+1]+b[u],Q.push(mp(-b[u+1],u+1));\n\t}\n}\nstruct qnode{\n\tint l,r,par;\n\tqnode(int ql=0,int qr=0,int x=0){l=ql;r=qr;par=x;}\n\tvoid check(){if((l&1)^par)l++;if((r&1)^par)r--;}\n}f[MAXN],g[MAXN];\nqnode operator+(qnode a,qnode b){\n\tqnode ret;ret.r=a.r+b.r;ret.par=a.par^b.par;\n\tif(max(a.l,b.l)<=min(a.r,b.r))ret.l=ret.par;\n\telse ret.l=min(abs(a.l-b.r),abs(a.r-b.l));\n\treturn ret;\n}\nint solve(int l,int r){\n\tint sum=0;\n\tfor(int i=l;i<=r;i++)sum^=(a[i]&1);\n\tif(!sum)return 1;\n\tf[l-1]=qnode(0,0,0);\n\tfor(int i=l;i<=r;i++){\n\t\tf[i]=f[i-1]+qnode(a[i],a[i],a[i]&1);\n\t\tf[i].r=min(f[i].r,b[i]);f[i].check();\n\t}\n\tg[r+1]=qnode(0,0,0);\n\tfor(int i=r;i>=l;i--){\n\t\tg[i]=g[i+1]+qnode(a[i],a[i],a[i]&1);\n\t\tg[i].r=min(g[i].r,b[i-1]);g[i].check();\n\t}int ret=0;\n\tfor(int i=l;i<=r;i++){\n\t\tauto now=f[i-1]+g[i+1];\n\t\tif(((a[i]&1)^now.par)&&now.l<=a[i]-1&&a[i]-1<=now.r)ret++;\n\t}return ret;\n}\nsigned main(){\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<=n;i++)scanf(\"%lld\",&a[i]);\n\tfor(int i=1;i<n;i++)scanf(\"%lld\",&b[i]);\n\tdijkstra();int ans=1;\n\tfor(int i=1,pre=1;i<=n;i++){\n\t\tif(a[i]<b[i-1]+b[i])continue;\n\t\ta[i]=b[i-1];ans=ans*solve(pre,i)%p;\n\t\ta[i]=b[i];pre=i;\n\t}\n\tprintf(\"%lld\",ans);\n\treturn 0;\n}\n```",
        "postTime": 1668049346,
        "uid": 65681,
        "name": "UltiMadow",
        "ccfLevel": 7,
        "title": "[\u9898\u89e3] AGC054F"
    }
]