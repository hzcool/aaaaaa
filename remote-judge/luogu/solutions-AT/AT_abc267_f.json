[
    {
        "content": "# ABC267F \u9898\u89e3\n\n## \u601d\u8def\u5206\u6790\n\n\u8003\u8651\u5bf9\u4e8e\u6bcf\u4e2a\u70b9 $u$ \u9009\u62e9\u4e00\u4e2a\u8ddd\u79bb $u$ \u6700\u8fdc\u7684\u8282\u70b9 $p$\uff0c\u7136\u540e\u5c06 $p$ \u4f5c\u4e3a\u6839\u8282\u70b9\uff0c\u6c42\u51fa $u$ \u7684 $k$ \u7ea7\u7956\u5148\u5373\u53ef\u3002\n\n\u6ce8\u610f\u5230\u5bf9\u4e8e $1\\sim n$ \u7684\u6bcf\u4e2a\u8282\u70b9\uff0c\u8fd9\u6837\u7684 $p$ \u53ea\u53ef\u80fd\u662f\u67d0\u4e2a\u76f4\u5f84\u7684\u4e24\u4e2a\u7aef\u70b9\uff0c\u56e0\u6b64\u6c42\u51fa\u76f4\u5f84\u7aef\u70b9 dfs \u5373\u53ef\u3002\n\n\u6c42 $k$ \u7ea7\u7956\u5148\u7684\u65f6\u5019\u4e0d\u7528\u500d\u589e\uff0c\u76f4\u63a5\u5728\u6811\u4e0a\u8bb0\u5f55\u4e0a\u4e00\u4e2a\u6df1\u5ea6\u4e3a $x$ \u7684\u70b9 $d_x$\uff0c\u7531\u4e8e dfs \u5e8f\u7684\u7279\u5f81\uff0c\u5bf9\u4e8e\u67d0\u4e2a\u70b9 $u$ \u5176 $k$ \u7ea7\u7956\u5148\u5c31\u662f $d_{dep_u-k}$\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n+q)$\u3002\n\n## \u4ee3\u7801\u5448\u73b0\n\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\nconst int MAXN=2e5+1;\nvector <int> edge[MAXN],query[MAXN];\nint ans[MAXN],node[MAXN],dis[MAXN],len;\ninline void dfs(int p,int f,int dep) {\n\tnode[dep]=p;\n\tfor(int q:query[p]) if(dep>=dis[q]) ans[q]=node[dep-dis[q]];\n\tlen=max(len,dep);\n\tfor(int v:edge[p]) if(v!=f) dfs(v,p,dep+1);\n}\nsigned main() {\n\tint n,q;\n\tscanf(\"%d\",&n);\n\tfor(int i=1;i<n;++i) {\n\t\tint u,v;\n\t\tscanf(\"%d%d\",&u,&v);\n\t\tedge[u].push_back(v);\n\t\tedge[v].push_back(u);\n\t}\n\tscanf(\"%d\",&q);\n\tfor(int i=1;i<=q;++i) {\n\t\tint u;\n\t\tscanf(\"%d%d\",&u,&dis[i]);\n\t\tquery[u].push_back(i);\n\t}\n\tfor(int turn:{0,1,2}) {\n\t\tint pos=node[len]; len=0;\n\t\tif(!turn) pos=1;\n\t\tdfs(pos,0,0);\n\t}\n\tfor(int i=1;i<=q;++i) printf(\"%d\\n\",ans[i]?ans[i]:-1);\n\treturn 0;\n}\n```",
        "postTime": 1669282522,
        "uid": 539618,
        "name": "DaiRuiChen007",
        "ccfLevel": 6,
        "title": "ABC267F \u9898\u89e3"
    },
    {
        "content": "[$\\text{Link}$](https://www.luogu.com.cn/problem/T238762)\n## \u9898\u610f\n\u7ed9\u4f60\u4e00\u9897 $n$ \u4e2a\u7ed3\u70b9\u7684\u6811\uff0c\u6709 $q$ \u6b21\u8be2\u95ee\uff0c\u6bcf\u6b21\u7ed9\u51fa $x,k$\uff0c\u6c42\u4efb\u610f\u4e00\u4e2a\u4e0e $x$ \u8ddd\u79bb\u4e3a $k$ \u7684\u70b9\uff0c\u6216\u8005\u8fd4\u56de\u65e0\u89e3\u3002\n\n$1\\le n,q\\le2\\times 10^6$\u3002\n## \u601d\u8def\n\u771f\u7684\u60f3\u4e0d\u5230\u649e\u4e86\u9898\u3002[$\\text{Link}$](https://www.luogu.com.cn/problem/AT_abc267_f)\u3002\n\n\u5148\u5b9a $1$ \u4e3a\u6839\uff0c\u6c42\u51fa\u6bcf\u4e2a\u7ed3\u70b9\u6df1\u5ea6 $d_i$\uff0c\u5b50\u6811\u91cc\u6df1\u5ea6\u7684\u6700\u5927\u503c $f_i$ \u548c\u53d6\u5230\u6700\u5927\u503c\u7684\u7ed3\u70b9 $g_i$\u3002\n\n\u5bf9\u4e8e\u4e00\u6b21\u8be2\u95ee\u5206\u4e00\u4e0b\u7c7b\uff1a\n1. $d_x\\ge k$\uff0c\u76f4\u63a5\u8f93\u51fa $k$ \u7ea7\u7956\u5148\u5373\u53ef\u3002\n2. $f_x-d_x\\ge k$\uff0c\u6b64\u65f6\u8981\u8f93\u51fa\u4e00\u4e2a $x$ \u7ed3\u70b9\u7684 $k$ \u7ea7\u513f\u5b50\u3002\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u6700\u6df1\u7684\u94fe\u4e0a\u4e00\u5b9a\u6709\u8fd9\u79cd\u7ed3\u70b9\uff0c\u4e8e\u662f\u8f6c\u5316\u4e3a $g_x$ \u7684 $f_x-d_x-k$ \u7ea7\u7956\u5148\u3002\n3. \u5176\u4ed6\u60c5\u51b5\u3002\n\n\u8003\u8651\u8fd9\u4e00\u7c7b\uff0c$x$ \u4e0e\u7b54\u6848 $y$ \u7684\u8def\u5f84\u5fc5\u5b9a\u7531 $x$ \u5230 $x$ \u7684\u4e00\u4e2a\u7956\u5148 $z$\uff0c\u518d\u5230 $z$ \u7684\u5176\u5b83\u5b50\u6811\u4e2d\u7684 $y$\u3002\n\n\u6211\u4eec\u8003\u8651\u627e\u5230\u6700\u53ef\u80fd\u6210\u4e3a\u7b54\u6848\u8f6c\u6298\u70b9\u7684 $z$ \u7ed3\u70b9\uff0c\u6b64\u65f6\u9700\u8981 $x$ \u5230 $z$ \u5176\u5b83\u5b50\u6811\u4e2d\u7684\u6df1\u5ea6\u6700\u5927\u7684\u7ed3\u70b9\u7684\u8ddd\u79bb\u6700\u5927\u3002\n\n\u7ed9\u6bcf\u4e2a\u7ed3\u70b9\u7684\u5b50\u6811\u6807\u53f7\uff0c\u8bbe\u4e3a $1,\\dots,k$\uff0c\u5219\u4ee4 $\\displaystyle f'_{i,j}$ \u4e3a\u9664\u4e86 $i$ \u7ed3\u70b9\u7684\u7b2c $j$ \u4e2a\u5b50\u6811\uff0c\u5b50\u6811\u4e2d\u5176\u5b83\u90e8\u5206\u7684\u6df1\u5ea6\u6700\u5927\u503c\uff0c$g'_{i,j}$ \u4e3a\u5bf9\u5e94\u7684\u7ed3\u70b9\u3002\u9884\u5904\u7406\u6bcf\u4e2a\u7ed3\u70b9\u7684\u524d\u540e\u7f00\u7b97\u51fa\u3002\n\n\u4ee4 $x$ \u4e3a $z$ \u7684\u7b2c $j$ \u4e2a\u5b50\u6811\uff0c\u5219 $x$ \u5230 $z$ \u5176\u5b83\u5b50\u6811\u4e2d\u7684\u6df1\u5ea6\u6700\u5927\u7684\u7ed3\u70b9\u7684\u8ddd\u79bb\u4e3a $d_x+f'_{z,j}-2d_z$\u3002\u8003\u8651\u5bf9\u6bcf\u4e2a $x$ \u9884\u5904\u7406\u51fa\u6700\u4f18\u7684 $z_x$\u3002\u8fd9\u4e2a\u53ef\u4ee5\u5f00\u59cb\u7684\u65f6\u5019 $\\text{dfs}$ \u4e00\u904d\u6c42\u51fa\u3002\n\n\u627e\u5230 $z$ \u4e4b\u540e\uff0c\u6211\u4eec\u8fd8\u8981\u6c42\u51fa\u5b83\u9664\u4e86\u5b50\u6811 $j$ \u4ee5\u5916\u7684\u4e00\u4e2a $k-d_x+d_z$ \u7ea7\u513f\u5b50\uff0c\u4e5f\u8f6c\u5316\u4e3a $g'_{z,j}$ \u7684 $f'_{z,j}-k+d_x-2d_z$ \u7ea7\u7956\u5148\u3002\u6ce8\u610f\u5224\u65ad\u65e0\u89e3\u3002\n\n\u5173\u4e8e\u7ebf\u6027\u6c42\u51fa $k$ \u7ea7\u7956\u5148\uff1a\u8003\u8651 $\\text{dfs}$ \u8fc7\u7a0b\u4e2d\u7528\u6808\u8bb0\u5f55\u6240\u6709\u7684\u7956\u5148\uff0c\u5728\u627e\u5230\u8be2\u95ee\u65f6\u6807\u7b54\u6848\u4e3a\u5012\u6570\u7b2c $k$ \u4f4d\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n+q)$\u3002\n\n\u5e26\u4e0a\u5c0f\u5e38\u6570\u7684 $\\log$ \u5e94\u8be5\u90fd\u653e\u8fc7\u4e86\u5427\uff1f\n\nstd\uff1a\n```cpp\n#include<bits/stdc++.h>\nusing namespace std;\n#define ll long long\nnamespace IO{//by cyffff\n\t\n}\nconst int N=2e6+10;\nstruct Edge{\n\tint to,nxt;\n}a[N<<1];\nint n,q,cnt,head[N];\ninline void add(int u,int v){\n\tcnt++;\n\ta[cnt]={v,head[u]};\n\thead[u]=cnt; \n}\nint d[N],f[N],g[N],*fp[N],*gp[N],son[N],pool[N<<2],*now=pool;\nint pf[N],pg[N],sf[N],sg[N],stc[N];\ninline void dfs1(int x,int fa){\n\td[x]=d[fa]+1,f[x]=d[x],g[x]=x;\n\tfor(int i=head[x];i;i=a[i].nxt){\n\t\tint t=a[i].to;\n\t\tif(t==fa) continue;\n\t\tdfs1(t,x);\n\t\tson[x]++;\n\t\tif(f[t]>f[x]) f[x]=f[t],g[x]=g[t];\n\t}\n}\nint y[N],z[N];\ninline void dfs2(int x,int fa,int py,int pz,int mx){\n\tint sz=son[x],cnt=0;\n\tfp[x]=now,now+=sz+1;\n\tgp[x]=now,now+=sz+1;\n\tfor(int i=head[x];i;i=a[i].nxt){\n\t\tint t=a[i].to;\n\t\tif(t==fa) continue;\n\t\tstc[++cnt]=t;\n\t}\n\tassert(cnt==sz);\n\tpf[0]=sf[sz+1]=0;\n\tfor(int i=1;i<=sz;i++)\n\t\tpf[i]=sf[i]=f[stc[i]];\n\tfor(int i=1;i<=sz;i++){\n\t\tif(pf[i]<=pf[i-1])\n\t\t\tpf[i]=pf[i-1],pg[i]=pg[i-1];\n\t\telse\n\t\t\tpg[i]=g[stc[i]];\n\t}\n\tfor(int i=sz;i>=1;i--){\n\t\tif(sf[i]<=sf[i+1])\n\t\t\tsf[i]=sf[i+1],sg[i]=sg[i+1];\n\t\telse\n\t\t\tsg[i]=g[stc[i]];\n\t}\n\tfor(int i=1;i<=sz;i++){\n\t\tif(pf[i-1]<=sf[i+1])\n\t\t\tfp[x][i]=sf[i+1],gp[x][i]=sg[i+1];\n\t\telse\n\t\t\tfp[x][i]=pf[i-1],gp[x][i]=pg[i-1];\n\t}\n\tif(sz==1){\n\t\tfp[x][1]=d[x],gp[x][1]=x;\n\t}\n\ty[x]=py,z[x]=pz,cnt=0;\n\tfor(int i=head[x];i;i=a[i].nxt){\n\t\tint t=a[i].to;\n\t\tif(t==fa) continue;\n\t\tcnt++;\n\t\tif(fp[x][cnt]-2*d[x]>mx)\n\t\t\tdfs2(t,x,gp[x][cnt],x,fp[x][cnt]-2*d[x]);\n\t\telse\n\t\t\tdfs2(t,x,py,pz,mx);\n\t}\n}\nint ans[N],stk[N],top,cnt2,head2[N],nxt[N],ed[N];\nstruct Query{\n\tint k,id;\n}w[N];\ninline void add2(int x,Query t){\n\tcnt2++;\n\tif(!head2[x]) head2[x]=cnt2;\n\tnxt[ed[x]]=cnt2;\n\ted[x]=cnt2,w[cnt2]=t;\n}\ninline void dfs3(int x,int fa){\n\tstk[++top]=x;\n\tfor(int i=head2[x];i;i=nxt[i]){\n\t\tQuery tmp=w[i];\n\t\tif(top<=tmp.k) ans[tmp.id]=-1;\n\t\telse ans[tmp.id]=stk[top-tmp.k];\n\t}\n\tfor(int i=head[x];i;i=a[i].nxt){\n\t\tint t=a[i].to;\n\t\tif(t==fa) continue;\n\t\tdfs3(t,x);\n\t}\n\ttop--;\n}\nint main(){\n\tn=read(),q=read();\n\tfor(int i=1;i<n;i++){\n\t\tint u=read(),v=read();\n\t\tadd(u,v),add(v,u);\n\t}\n\tdfs1(1,0);\n\tdfs2(1,0,1,1,-1e9);\n\tfor(int i=1;i<=q;i++){\n\t\tint x=read(),k=read();\n\t\tif(d[x]>k) add2(x,{k,i});\n\t\telse if(f[x]-d[x]>=k) add2(g[x],{f[x]-d[x]-k,i});\n\t\telse{\n\t\t\tint py=y[x],pz=z[x];\n\t\t\tif(d[x]+d[py]-2*d[pz]<k) ans[i]=-1;\n\t\t\telse add2(py,{d[py]-k+d[x]-2*d[pz],i});\n\t\t}\n\t} \n\tdfs3(1,0);\n\tfor(int i=1;i<=q;i++)\n\t\twrite(ans[i]),putc('\\n');\n\tflush();\n}\n```\n****\n\u597d\u7684\uff0c\u88ab\u9a8c\u9898\u4eba\u8584\u7eb1\u4e86\u3002\n\n\u6709\u4e00\u4e2a\u7ed3\u8bba\uff1a\u6811\u4e0a\u8ddd\u79bb\u70b9 $x$ \u6700\u8fdc\u7684\u70b9\u4e00\u5b9a\u662f\u76f4\u5f84\u4e24\u7aef\u70b9\u4e4b\u4e00\uff0c\u6240\u4ee5\u628a\u76f4\u5f84\u63d0\u51fa\u6765\u8ba8\u8bba\u4e00\u4e0b\u5c31\u597d\u4e86\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $\\Theta(n+q)$\u3002\n\n\u518d\u89c1 qwq~",
        "postTime": 1651726596,
        "uid": 365127,
        "name": "cyffff",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 \u3010[JRKSJ R6] INFiNiTE ENERZY -Overdoze-\u3011"
    },
    {
        "content": "# abc 267 f\n\n## \u9898\u610f\n\n\u7ed9\u5b9a\u4e00\u4e2a\u6709 $N$ \u4e2a\u7ed3\u70b9\u7684\u6811\uff0c\u7ed3\u70b9\u5206\u522b\u7f16\u53f7\u4e3a $1, 2, \\dots, N$\uff0c\u7b2c $i$ \u6761\u8fb9 $(1 \\le i \\le N - 1)$ \u8fde\u63a5\u70b9 $A_i, B_i$\u3002\n\n\u6811\u4e0a\u7684\u4e24\u4e2a\u7ed3\u70b9 $u, v$ \u4e4b\u95f4\u7684\u8ddd\u79bb\u5b9a\u4e49\u4e3a\u4ece $u$ \u5230 $v$ \u7684\u6700\u77ed\u8def\u5f84\u6240\u7ecf\u8fc7\u7684\u8fb9\u7684\u6570\u91cf\u3002\n\n\u7ed9\u5b9a $Q$ \u6b21\u8be2\u95ee\uff0c\u7b2c $i$ \u6b21\u8be2\u95ee\u7ed9\u51fa $U_i, K_i$\uff0c\u8bf7\u4f60\u8f93\u51fa\u4efb\u610f\u4e00\u4e2a\u4e0e $U_i$ \u8ddd\u79bb\u4e3a $K_i$ \u7684\u70b9\u7684\u7f16\u53f7\u3002\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u8f93\u51fa `-1`\u3002\n\n## \u601d\u8def\n\n### \u5728\u7ebf\n\n\u9996\u5148\uff0c\u6211\u4eec\u5148\u601d\u8003\u8fd9\u6837\u4e00\u4e2a\u95ee\u9898\uff0c\u5728\u4ec0\u4e48\u60c5\u51b5\u4e0b\uff0c\u4e0d\u5b58\u5728\u4e0e\u70b9 $u$ \u8ddd\u79bb\u4e3a $k$ \u7684\u70b9\uff1f\n\n\u5f53\u4ece $u$ \u51fa\u53d1\u7684\u6700\u957f\u8def\u5c0f\u4e8e $k$ \u65f6\uff0c\u5c31\u8bf4\u660e\u4e0d\u5b58\u5728\u8fd9\u6837\u7684\u70b9\u3002\n\n\u800c\u6211\u4eec\u53ef\u4ee5\u60f3\u5230\u6700\u957f\u8def\u8fd9\u4ef6\u4e8b\uff0c\u5c31\u53ef\u4ee5\u8054\u60f3\u5230\u6811\u7684\u76f4\u5f84\u3002\n\n\u4ee4\u4ece $u$ \u51fa\u53d1\u7684\u6700\u957f\u8def\u6240\u5230\u8fbe\u7684\u70b9\u4e3a $v$\u3002\n\n\u53ef\u4ee5\u8bc1\u660e\uff0c$v$ \u80af\u5b9a\u662f\u67d0\u4e00\u6761\u6811\u7684\u76f4\u5f84\u7684\u67d0\u4e00\u4e2a\u7aef\u70b9\uff0c\u56e0\u4e3a\u6709\u4e00\u6761\u76f4\u5f84\u7684\u67d0\u4e2a\u7aef\u70b9\u672c\u8eab\u5c31\u662f\u4ece\u70b9 $u$ \u5f00\u59cb\u7684\u80fd\u8d70\u5230\u7684\u6700\u8fdc\u7684\u70b9\uff0c\u6240\u4ee5 $v$ \u4e00\u5b9a\u662f\u8fd9\u4e2a\u641c\u5230\u7684\u70b9\u3002\u6211\u4eec\u8bbe\u8fd9\u6761\u76f4\u5f84\u7684\u4e24\u4e2a\u7aef\u70b9\u4e3a $s, t$\u3002\n\n\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u753b\u4e00\u4e2a\u8fd9\u6837\u7684\u56fe\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/j93zvuoc.png)\n\n\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u8981\u6c42\u4e0e $u$ \u8ddd\u79bb\u4e3a $k$ \u7684\u70b9\uff0c\u5c31\u76f8\u5f53\u4e8e\u5728\u4ee5 $s$ \u4e3a\u6839\u7684\u6811\u548c\u4ee5 $t$ \u4e3a\u6839\u7684\u6811\u4e0a\u627e $u$ \u7684 $k$ \u7ea7\u7956\u5148\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\nconst int N = 2e5 + 10;\n\nint n, q, d, id[2], fa[2][20][N];\nvector<int> g[N];\n\nvoid dfs(int t, int f, int dis, int p) {\n  if (dis > d) {\n    d = dis, id[p] = t;\n  }\n  if (p >= 2) {\n    fa[p % 2][0][t] = f;\n  }\n  for (int i : g[t]) {\n    if (i != f) {\n      dfs(i, t, dis + 1, p);\n    }\n  }\n}\n\nvoid get_fa() {\n  for (int i = 0; i < 2; i++) {\n    for (int j = 1; j < 20; j++) {\n      for (int k = 1; k <= n; k++) {\n        fa[i][j][k] = fa[i][j - 1][fa[i][j - 1][k]];\n      }\n    }\n  }\n}\n\nint Find(int u, int k, bool p) {\n  for (int i = 0; i < 20; i++, k >>= 1) {\n    if (k & 1) {\n      u = fa[p][i][u];\n    }\n  }\n  return u;\n}\n\nint main() {\n  ios::sync_with_stdio(0), cin.tie(0);\n  cin >> n;\n  for (int i = 1, a, b; i < n; i++) {\n    cin >> a >> b;\n    g[a].push_back(b), g[b].push_back(a);\n  }\n  dfs(1, 0, 0, 0), d = 0, dfs(id[0], 0, 0, 1);\n  dfs(id[0], 0, 0, 2), dfs(id[1], 0, 0, 3), get_fa();\n  cin >> q;\n  while (q--) {\n    int u, k;\n    cin >> u >> k;\n    int s = max(Find(u, k, 0), Find(u, k, 1));\n    cout << (!s ? -1 : s) << '\\n';\n  }\n  return 0;\n}\n```\n\n-------------\n\n### \u79bb\u7ebf\n\n\u6211\u4eec\u53ef\u4ee5\u628a\u6bcf\u4e2a\u70b9 $u$ \u9700\u8981\u67e5\u8be2\u7684\u6bcf\u4e2a $k$ \u90fd\u8bb0\u5f55\u4e0b\u6765\uff0c\u7136\u540e\u5bf9\u6811\u505a\u4e00\u904d\u6df1\u641c\uff0c\u7528\u6808\u6765\u7ef4\u62a4\u6bcf\u4e00\u6761\u6811\u94fe\u7684\u5143\u7d20\uff0c\u8bb0\u5f55\u6bcf\u6b21\u8be2\u95ee\u7684\u7b54\u6848\u3002\n\n#### \u4ee3\u7801\n\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\nusing pii = pair<int, int>;\n\nconst int N = 2e5 + 10;\n\nint n, q, d, id[2], ans[N];\nvector<int> g[N];\nvector<pii> pos[N];\nint top, stk[N];\n\nvoid dfs(int t, int f, int dis, int p) {\n  if (dis > d) {\n    d = dis, id[p] = t;\n  }\n  for (int i : g[t]) {\n    if (i != f) {\n      dfs(i, t, dis + 1, p);\n    }\n  }\n}\n\nvoid _dfs(int t, int fa) {\n  stk[++top] = t;\n  for (int i : g[t]) {\n    if (i != fa) {\n      _dfs(i, t);\n    }\n  }\n  for (auto [i, j] : pos[t]) {\n    if (top > i) {\n      ans[j] = stk[top - i];\n    }\n  }\n  top--;\n}\n\nint main() {\n  ios::sync_with_stdio(0), cin.tie(0);\n  cin >> n;\n  for (int i = 1, a, b; i < n; i++) {\n    cin >> a >> b;\n    g[a].push_back(b), g[b].push_back(a);\n  }\n  dfs(1, 0, 0, 0), d = 0, dfs(id[0], 0, 0, 1);\n  cin >> q;\n  for (int i = 1, u, k; i <= q; i++) {\n    cin >> u >> k, ans[i] = -1;\n    pos[u].push_back({k, i});\n  }\n  _dfs(id[0], 0), _dfs(id[1], 1);\n  for (int i = 1; i <= q; i++) {\n    cout << ans[i] << '\\n';\n  }\n  return 0;\n}\n```",
        "postTime": 1685086073,
        "uid": 658291,
        "name": "chengning0909",
        "ccfLevel": 4,
        "title": "abc 267 f \u9898\u89e3"
    },
    {
        "content": "### [ABC267F] Exactly K Steps\n### \u9898\u610f\n\u6709\u4e00\u9897 $n$ \u4e2a\u70b9\uff0c$n - 1$ \u6761\u8fb9\u7684\u6811\uff0c\u627e\u5230\u4efb\u610f\u4e00\u4e2a\u79bb\u7ed3\u70b9 $u$ \u7684\u8ddd\u79bb\u6070\u597d\u4e3a $k$ \u7684\u70b9\uff0c\u6216\u62a5\u544a\u65e0\u89e3\u3002\n\n\u5b9a\u4e49\u4e24\u70b9 $u, v$ \u95f4\u7684\u8ddd\u79bb\u4e3a\u8fd9\u4e24\u4e2a\u70b9\u4e4b\u95f4\u7684\u6700\u77ed\u8def\u5f84\u6240\u5305\u542b\u7684\u8fb9\u6570\u3002\n### \u601d\u8def\n\u8003\u8651\u65e0\u89e3\uff0c\u663e\u7136\u5982\u679c\u4ece $u$ \u8d70\u51fa\u6765\u7684\u6700\u957f\u7b80\u5355\u8def\u5f84\u7684\u957f\u5ea6\u90fd\u6ca1\u6709 $k$ \u5927\uff0c\u90a3\u4e48\u80af\u5b9a\u65e0\u89e3\uff0c\u6211\u4eec\u8fd8\u77e5\u9053\u6811\u4e2d\u4efb\u610f\u4e00\u4e2a\u70b9\u7684\u6700\u957f\u8def\u5f84\u7684\u7ec8\u70b9\u80af\u5b9a\u662f\u8fd9\u68f5\u6811\u7684\u76f4\u5f84\u7684\u7aef\u70b9\u4e2d\u7684\u4e00\u4e2a\uff0c\u90a3\u4e48\u53ef\u4ee5\u63a8\u51fa\u6765\u8fd9\u4e48\u4e00\u4e2a\u56fe\uff0c\u8868\u793a\u4efb\u610f\u4e00\u4e2a\u70b9\u7684\u7b54\u6848\u53ef\u80fd\u51fa\u73b0\u7684\u5730\u65b9\uff08\u7528\u7ea2\u8272\u5708\u8d77\u6765\uff09\uff1a\n\n![](https://cdn.luogu.com.cn/upload/image_hosting/nose581w.png)\n\n\u4e8e\u662f\u53ef\u4ee5\u79bb\u7ebf\u5904\u7406\uff0c\u8bb0\u5f55\u4ece\u70b9 $u$ \u641c\u5230\u76f4\u5f84\u4e24\u7aef\u7684\u8def\u5f84\uff0c\u518d\u8bb0\u5f55\u7b54\u6848\uff0c\u4e00\u4e2a\u4e00\u4e2a\u7684\u641c\u80af\u5b9a\u4f1a TLE\uff0c\u6240\u4ee5\u53ef\u4ee5\u4ece\u76f4\u5f84\u4e24\u7aef\u5f00\u59cb\u641c\u3002\n#### \u4ee3\u7801\n```cpp\n#include <iostream>\n#include <vector>\n\nusing namespace std;\n\nconst int MaxN = 2e5 + 10;\n\nstruct S {\n  int x, y;\n\n  bool operator<(const S &j) const {\n    return y < j.y;\n  }\n};\n\nint u[MaxN], k[MaxN], ans[MaxN], n, q;\nvector<int> g[MaxN], c;\nvector<S> l[MaxN];\n\nS dfs(int x, int fa) {\n  S res = {x, 0};\n  for (int i : g[x]) {\n    if (i == fa) {\n      continue;\n    }\n    res = max(res, dfs(i, x));\n  }\n  return {res.x, res.y + 1};\n}\n\nvoid DFS(int x, int fa) {\n  c.push_back(x);\n  for (int i : g[x]) {\n    if (i == fa) {\n      continue;\n    }\n    DFS(i, x);\n  }\n  int len = c.size();\n  for (S i : l[x]) {\n    (len > i.x) && (ans[i.y] = c[len - i.x - 1]);\n  }\n  c.pop_back();\n}\n\nint main() {\n  ios::sync_with_stdio(0), cin.tie(0);\n  cin >> n;\n  for (int i = 1, u, v; i < n; i++) {\n    cin >> u >> v;\n    g[u].push_back(v);\n    g[v].push_back(u);\n  }\n  cin >> q;\n  for (int i = 1; i <= q; i++) {\n    cin >> u[i] >> k[i];\n    l[u[i]].push_back({k[i], i}), ans[i] = -1;\n  }\n  int lres = dfs(1, -1).x, rres = dfs(lres, -1).x;\n  DFS(lres, -1), DFS(rres, -1);\n  for (int i = 1; i <= q; i++) {\n    cout << ans[i] << '\\n';\n  }\n  return 0;\n}\n```\n",
        "postTime": 1684249471,
        "uid": 755408,
        "name": "yabnto",
        "ccfLevel": 4,
        "title": "[ABC267F] Exactly K Steps\u9898\u89e3"
    },
    {
        "content": "### Part 1 \u7b97\u6cd5\u5206\u6790\n\n\u9898\u76ee\u7684\u610f\u601d\u5c31\u662f\u8bf4\uff0c\u7ed9\u4f60\u4e00\u68f5 $n$ \u4e2a\u70b9\u7684\u6811\uff0c\u6709 $Q$ \u6b21\u8be2\u95ee\uff0c\u79f0\u6bcf\u6b21\u8be2\u95ee\u7ed9\u51fa $u,k$\uff0c\u6c42\u4efb\u610f\u4e00\u4e2a\u4e0e $u$ \u8ddd\u79bb\u4e3a $k$ \u7684\u70b9\uff0c\u5982\u679c\u65e0\u89e3\u5219\u8f93\u51fa ```-1```\u3002\n\n**\u7ed3\u8bba**\uff1a\u5f88\u663e\u7136\uff0c\u4e3a\u4e86\u4f7f\u4e00\u4e2a\u70b9\u8d70\u5230\u79bb\u5b83\u66f4\u8fdc\u7684\u70b9\uff0c\u4ed6\u603b\u4f1a\u7ecf\u8fc7\u8fd9\u4e00\u68f5\u6811\u7684\u76f4\u5f84\u7684\u70b9\uff1b\n\n\u8bc1\u660e\u4e0e $dfs$ \u6c42\u6811\u7684\u76f4\u5f84\u7684\u8bc1\u660e\u7c7b\u4f3c\uff0c\u4fbf\u4e0d\u8fc7\u591a\u8d58\u8ff0\u3002\n\n\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u68f5\u6811\u7684\u76f4\u5f84\u62ff\u51fa\u6765\uff0c\u5c06\u4ed6\u4eec\u5f53\u4f5c\u6839\uff0c\u5177\u4f53\u610f\u601d\u5c31\u662f\u5c06\u76f4\u5f84\u4e4b\u95f4\u7684\u8fb9\u65ad\u5f00\uff0c\u4f7f\u4e4b\u6210\u4e3a\u4e00\u4e2a\u68ee\u6797\uff0c\u68ee\u6797\u4e2d\u6bcf\u4e00\u68f5\u6811\u7684\u6839\u5373\u4e3a\u76f4\u5f84\u4e0a\u7684\u70b9\uff08\u4efb\u610f\u4e00\u4e2a\u76f4\u5f84\u90fd\u53ef\u4ee5\uff09\uff0c\u4fbf\u4e8e\u533a\u5206\uff0c\u6211\u4eec\u79f0\u68ee\u6797\u4e2d\u7684\u6811\u4e3a\u76f4\u5f84\u5b50\u6811\u3002\n\n\u90a3\u4e48\uff0c\u4e00\u4e2a\u70b9\u8d70\u5230\u8ddd\u79bb\u5b83\u4e3a $k$ \u7684\u70b9\uff0c\u5c31\u53ea\u80fd\u5148\u8d70\u5411\u5b83\u6240\u5728\u76f4\u5f84\u5b50\u6811\u7684\u7956\u5148\uff0c\u7136\u540e\u518d\u5411\u76f4\u5f84\u7684\u5de6\u6216\u53f3\u8d70\uff08\u54ea\u8fb9\u8282\u70b9\u591a\u8d70\u54ea\u8fb9\uff09\u3002\n\n### Part 2 \u4ee3\u7801\u5b9e\u73b0\uff1a\n\n- \u627e\u51fa\u539f\u6811\u7684\u76f4\u5f84\u3002\n- \u627e\u51fa\u6bcf\u4e00\u68f5\u76f4\u5f84\u5b50\u6811\u7684\u76f4\u5f84\u3002\n- \u500d\u589e\u9884\u5904\u7406\u6811\u4e0a $k$ \u7ea7\u7956\u5148\u3002\n- \u67e5\u8be2\u5219\u5206\u7c7b\u8ba8\u8bba\uff1a\n\n1. \u82e5\u5b83\u662f\u76f4\u5f84\u4e0a\u7684\u70b9\uff0c\u5219\u5f80\u76f4\u5f84\u7684\u5de6\uff0c\u6216\u53f3\u8d70 $k$ \u6b65\uff1b\n2. \u5426\u5219\uff0c\u5148\u5f80\u7956\u5148\u8d70\uff0c\u7136\u540e\u6216\u4f5c\u7b2c\u4e00\u79cd\u60c5\u51b5\u3002\n\n\u82e5\u8d70\u4e0d\u4e86\u4e86\uff0c\u5c31\u662f\u65e0\u89e3\u3002\n\n### Part 3 CODE\n\n```cpp\n//#pragma GCC optimize(3)\n#include<iostream>\n#include<climits>\n#include<cstdio>\n#include<cstring>\n#include<cmath>\n#include<ctime>\n#include<algorithm>\n#include<queue>\n#include<map>\n#include<set>\n#include<vector>\n//#include<random>\n//#include<chrono>\n#define int long long\n#define double long double\nusing namespace std;\nconst int INF=LLONG_MAX/2;\nconst long long mod=1000000007;\nconst double Pai=acos(-1);\nvector<int> v[1000005],v2;\nint n,ans=0,Q;\nint d[1000005],prt[1000005],vst[1000005],pos[1000005],be[1000005];\nvoid dfs(int s,int fa,int dep) {\n\td[s]=dep;\n\tfor(int i=0;i<v[s].size();i++) {\n\t\tint y=v[s][i];\n\t\tif(y==fa) continue;\n\t\tprt[y]=s;\n\t\tdfs(y,s,dep+1);\n\t}\n}\npair<int,int> find(int x) {\n\tdfs(x,0,0);\n\tint maxx=0,s=0;\n\tfor(int i=1;i<=n;i++) {\n\t\tif(d[i]>maxx) maxx=d[i],s=i;\n\t}\n\tdfs(s,0,0);\n\tmaxx=0;int t=0;\n\tfor(int i=1;i<=n;i++) {\n\t\tif(d[i]>maxx) maxx=d[i],t=i;\n\t}\n\treturn make_pair(s,t);\n}\nint f[1000005][22];\nvoid dfs2(int u,int father,int dep,int fg) {\n    d[u]=dep;be[u]=fg;\n    f[u][0]=father;\n    for(int i=1;i<=20;i++) f[u][i]=f[f[u][i-1]][i-1];\n    for(int i=0;i<v[u].size();i++) {\n        int y=v[u][i];\n        if(y!=father&&vst[y]!=1) dfs2(y,u,dep+1,fg);\n    }\n}\nint get_fa(int x,int k) {\n    int t=d[x]-k;\n    for(int i=20;i>=0;i--) if(d[f[x][i]]>t)x=f[x][i];\n    return f[x][0];\n}\nsigned main() {\n\tscanf(\"%lld\",&n);\n\tfor(int i=1;i<n;i++) {\n\t\tint x,y;\n\t\tscanf(\"%lld%lld\",&x,&y);\n\t\tv[x].push_back(y);v[y].push_back(x);\n\t}\n\tpair<int,int> p=find(1);\n\tfor(int i=1;i<=n;i++) prt[i]=0;\n\tdfs(p.first,0,0);\n\tint g=p.second;\n\twhile(g!=0) {\n\t\tv2.push_back(g);\n\t\tg=prt[g];\n\t}\n\tfor(int i=0;i<v2.size();i++) vst[v2[i]]=1,pos[v2[i]]=i;\n\tfor(int i=1;i<=n;i++) prt[i]=d[i]=0;\n\tfor(int i=0;i<v2.size();i++) {\n\t\tdfs2(v2[i],0,0,i);\n\t}\n\tscanf(\"%lld\",&Q);\n\twhile(Q--) {\n\t\tint x,y;\n\t\tscanf(\"%lld%lld\",&x,&y);\n\t\tif(vst[x]==1) {\n\t\t\tint ps=pos[x];\n\t\t\tint ans=-1;\n\t\t\tif(ps-y>=0) ans=v2[ps-y];\n\t\t\telse if(ps+y<v2.size()) ans=v2[ps+y];\n\t\t\tprintf(\"%lld\\n\",ans);\n\t\t}\n\t\telse {\n\t\t\tif(d[x]==y) {\n\t\t\t\tprintf(\"%lld\\n\",v2[be[x]]);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif(d[x]<y) {\n\t\t\t\ty-=d[x];\n\t\t\t\tint ps=be[x];\n\t\t\t\tint ans=-1;\n\t\t\t\tif(ps-y>=0) ans=v2[ps-y];\n\t\t\t\telse if(ps+y<v2.size()) ans=v2[ps+y];\n\t\t\t\tprintf(\"%lld\\n\",ans);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tprintf(\"%lld\\n\",get_fa(x,y));\n\t\t}\n\t}\n \treturn 0;\n}\n```\n",
        "postTime": 1667558466,
        "uid": 539041,
        "name": "Augen_stern",
        "ccfLevel": 7,
        "title": "[ABC267F] Exactly K Steps"
    },
    {
        "content": "\u8fd9\u91cc\u63d0\u4f9b\u4e00\u79cd\u590d\u6742\u5ea6\u4e3a $\\mathcal O((n+q)\\log n)$ \u7684\u505a\u6cd5\u3002\n\n\u5bf9\u4e8e\u88ab\u8be2\u95ee\u7684\u70b9 $u$ \u4e0e\u8ddd\u79bb $k$\uff0c\u5982\u679c $\\exists v\\text{ s.t. }dis(u,v)=k$\uff08\u5176\u4e2d $dis(u,v)$ \u8868\u793a $u,v$ \u95f4\u7684\u8ddd\u79bb\uff09\uff0c\u90a3\u4e48\u4e00\u5b9a\u5b58\u5728\u8fd9\u6837\u7684 $v$\uff0c\u4f7f\u5f97 $v$ \u5728 $u$ \u5230\u79bb\u5176\u6700\u8fdc\u7684\u70b9\u7684\u8def\u5f84\u4e0a\u3002\n\n\u800c\u79bb $u$ \u6700\u8fdc\u7684\u70b9\u4e00\u5b9a\u662f\u76f4\u5f84\u7684\u4e00\u7aef\u3002\u4e8e\u662f\u6211\u4eec\u9996\u5148\u6c42\u51fa\u4e00\u6761\u76f4\u5f84\uff0c\u8bb0\u5f55\u5176\u7aef\u70b9\u3002\n\n\u5173\u4e8e\u76f4\u5f84\u7684\u77e5\u8bc6\uff0c\u53ef\u53c2\u89c1 [OI-wiki-\u6811\u7684\u76f4\u5f84](http://oi-wiki.com/graph/tree-diameter/)\u3002\n \n\u8bbe\u76f4\u5f84\u4e24\u7aef\u7aef\u70b9\u4e3a $a,b$\uff0c\u8003\u8651\u5206\u522b\u4ee5 $a,b$ \u4f5c\u6839\uff0c\u500d\u589e\u6c42\u6bcf\u4e2a\u70b9\u7684 $2^k(k=0,1,2,\\cdots)$ \u7ea7\u7956\u5148\u3002\u8fd9\u4e48\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u5f97\u5230\u4e86\u6bcf\u4e00\u4e2a\u70b9\u5206\u522b\u5f80 $a,b$ \u8d70 $k(1\\leq k\\leq n)$ \u6b65\u6240\u80fd\u5230\u8fbe\u7684\u70b9\uff0c\u6216\u8005\u5f97\u77e5 $k>dis(u,a)$\u3002\u5229\u7528\u8fd9\u4e2a\u4fe1\u606f\u5c31\u53ef\u4ee5\u56de\u7b54\u8be2\u95ee\u4e86\u3002\n\n\u9884\u5904\u7406\u590d\u6742\u5ea6 $\\mathcal O(n\\log n)$\uff0c\u5728\u7ebf\u8be2\u95ee\u590d\u6742\u5ea6 $\\mathcal O(q\\log n)$\uff0c\u603b\u590d\u6742\u5ea6 $\\mathcal O((n+q)\\log n)$\u3002\n\nCode:\n\n```cpp\n#include <cstdio>\n#include <cmath>\n#include <algorithm>\nconst int N = 20;\nint n, q, h[200007], tmp, rt[2], nxt[2][200007][N + 3];\nstruct edge{int v, ne;}l[400007];\ninline void add(int u, int v){l[++tmp].v = v, l[tmp].ne = h[u], h[u] = tmp;}\nbool vis[200007];\nvoid find_root(int u, int num, int &mx, int &res) { // \u627e\u6839\uff0c\u4e5f\u5c31\u662f\u627e\u76f4\u5f84\u7684\u7aef\u70b9\n\tvis[u] = 1;\n\tif(num > mx)\n\t\tmx = num, res = u;\n\tfor(int i = h[u]; i; i = l[i].ne)\n\t\tif(!vis[l[i].v])\n\t\t\tfind_root(l[i].v, num + 1, mx, res);\n\tvis[u] = 0;\n}\nvoid dfs1(int u, int opt) { // \u8bb0\u5f55\u4ee5\u76f4\u5f84\u7aef\u70b9\u4e3a\u6839\u65f6\u7684\u7236\u4eb2\n\tvis[u] = 1;\n\tfor(int i = h[u]; i; i = l[i].ne) {\n\t\tconst int v = l[i].v;\n\t\tif(!vis[v]) {\n\t\t\tnxt[opt][v][0] = u, dfs1(v, opt);\n\t\t}\n\t}\n\tvis[u] = 0;\n}\nvoid dfs2(int u, int opt) { // \u500d\u589e\u9884\u5904\u7406 2^k \u7ea7\u7956\u5148\n\tvis[u] = 1;\n\tfor(int i = 1, j = nxt[opt][u][0]; i <= N; j = nxt[opt][u][i], i++)\n\t\tnxt[opt][u][i] = nxt[opt][j][i - 1];\n\tfor(int i = h[u]; i; i = l[i].ne) {\n\t\tconst int v = l[i].v;\n\t\tif(!vis[v]) dfs2(v, opt);\n\t}\n\tvis[u] = 0;\n}\nint cal(int u, int k, int opt) { // \u5728\u7ebf\u56de\u7b54\u5230\u76f4\u5f84\u7aef\u70b9\u8def\u5f84\u4e0a\uff0c\u8ddd\u79bb\u4e3a k \u7684\u70b9\u7684\u7f16\u53f7\n\tfor(int i = 0; k; k >>= 1, i++) {\n\t\tif(k & 1)\n\t\t\tu = nxt[opt][u][i];\n\t}\n\treturn u;\n}\nint main() {\n\tscanf(\"%d\", &n);\n\tfor(int i = 1; i < n; i++) {\n\t\tint u, v;\n\t\tscanf(\"%d %d\", &u, &v);\n\t\tadd(u, v), add(v, u);\n\t}\n\tfind_root(1, 0, tmp = 0, rt[0]);\n\tfind_root(rt[0], 0, tmp = 0, rt[1]);\n\tdfs1(rt[0], 0), dfs1(rt[1], 1);\n\tdfs2(rt[0], 0), dfs2(rt[1], 1);\n\tscanf(\"%d\", &q);\n\twhile(q--) {\n\t\tint u, k;\n\t\tscanf(\"%d %d\", &u, &k);\n\t\tint res0 = cal(u, k, 0), res1 = cal(u, k, 1);\n\t\tif(res0) printf(\"%d\\n\", res0); // \u8bb0\u5f97\u5224\u65ad\u54ea\u6761\u8def\u53ef\u884c\n\t\telse if(res1) printf(\"%d\\n\", res1);\n\t\telse puts(\"-1\");\n\t}\n\treturn 0;\n}\n```",
        "postTime": 1666360351,
        "uid": 411560,
        "name": "NobodyThere",
        "ccfLevel": 0,
        "title": "ABC267F \u9898\u89e3"
    },
    {
        "content": "\u5982\u679c\u8ddd\u79bb\u70b9 $u$ \u8ddd\u79bb\u6700\u8fdc\u7684\u70b9\uff0c\u4e0e $U$ \u7684\u8ddd\u79bb\u4e3a $d_{\\max}$\uff0c\u5219\u4e0e $u$ \u7684\u8ddd\u79bb\u4e3a $0 \\ldots d_{\\max}$ \u7684\u70b9\u663e\u7136\u90fd\u662f\u5b58\u5728\u7684\u3002\u56e0\u6b64\u5148\u601d\u8003\u7ed9\u5b9a\u70b9 $u$ \u7684\u60c5\u51b5\u4e0b\uff0c\u6c42\u51fa\u8ddd\u79bb $u$ \u6700\u8fdc\u7684\u70b9 $v$\uff0c\u7136\u540e\u5c1d\u8bd5\u5728 $u \\to v$ \u7684\u8fd9\u6761\u8def\u5f84\u4e0a\u627e\u6211\u4eec\u6240\u6c42\u7684\u70b9\u3002\n\n\u5bb9\u6613\u60f3\u5230\u5f80\u6811\u7684\u76f4\u5f84\u65b9\u5411\u4e0a\u9760\uff1a\u5bf9\u4e8e\u6bcf\u4e2a\u70b9\uff0c\u8ddd\u79bb\u8fd9\u4e2a\u70b9\u6700\u8fdc\u7684\u70b9\u4e00\u5b9a\u5728\u76f4\u5f84\u7684\u4e24\u4e2a\u7aef\u70b9\u4e4b\u4e00\u53d6\u5f97\uff0c\u8bbe\u8fd9\u4e2a\u70b9\u4e3a $v$\u3002\n\n\u5982\u679c $d(u, v) > k$\uff0c\u5219\u6240\u6c42\u70b9\u4e0d\u5b58\u5728\u3002\u5426\u5219\uff0c\u8003\u8651 $u \\to v$ \u8fd9\u6761\u8def\u5f84\u4e0a\u7684\u7b2c $k$ \u4e2a\u70b9\uff0c\u5373\u4e3a\u6240\u6c42\u70b9\u3002\u6211\u4eec\u5148\u6c42\u51fa\u76f4\u5f84\u8fd9\u6761\u94fe\uff0c\u7136\u540e\u500d\u589e\uff1a\u6211\u4eec\u4ece\u76f4\u5f84\u4e0a\u7684\u6bcf\u4e2a\u70b9\u51fa\u53d1\uff0c\u9884\u5904\u7406\u51fa\u6240\u6709\u975e\u76f4\u5f84\u4e0a\u70b9\u7684 $2^k$ \u7ea7\u7956\u5148\u3002\n\n\u8bbe $u$ \u5230\u76f4\u5f84\u4e0a\u7684\u70b9\u7684\u6700\u5c0f\u8ddd\u79bb\u4e3a $d_u$\u3002\n\n1. $k \\leq d_u$\uff0c\u76f4\u63a5\u500d\u589e\u5373\u53ef\u3002\n2. $k > d_u$\uff0c\u5148\u500d\u589e\u8df3\u5230\u76f4\u5f84\u4e0a\u7684\u70b9\uff0c\u7136\u540e\u76f4\u63a5\u627e\u5230 $v$ \u65b9\u5411\u7684\u540e $k - d_u$ \u4e2a\u70b9\u5373\u53ef\u3002\n\n\u65f6\u95f4\u590d\u6742\u5ea6 $O((n + m) \\log n)$\u3002\n\n```cpp\n// Problem: F - Exactly K Steps\n// Contest: AtCoder - NEC Programming Contest 2022 (AtCoder Beginner Contest\n// 267)\n// URL: https://atcoder.jp/contests/abc267/tasks/abc267_f\n// Author : StudyingFather\n// Site : https://studyingfather.com\n// Memory Limit: 1024 MB\n// Time Limit: 2000 ms\n//\n// Powered by CP Editor (https://cpeditor.org)\n\n#include <algorithm>\n#include <cstring>\n#include <iostream>\n#include <vector>\nusing namespace std;\nvector<int> e[200005], dia;\nint dep[200005], fa[200005][25], s;\nint ind[200005];\nvoid dfs(int u, int f) {\n  fa[u][0] = f;\n  dep[u] = dep[f] + 1;\n  if (dep[u] > dep[s]) s = u;\n  for (auto v : e[u]) {\n    if (v == f) continue;\n    dfs(v, u);\n  }\n}\nvoid calcfa(int u, int f) {\n  for (int i = 1; i <= 20; i++) fa[u][i] = fa[fa[u][i - 1]][i - 1];\n  for (auto v : e[u]) {\n    if (v == f) continue;\n    calcfa(v, u);\n  }\n}\nint solve(int u, int k) {\n  for (int i = 20; i >= 0; i--) {\n    if (k < (1 << i) || fa[u][i] == 0 || ind[fa[u][i]] != -1) continue;\n    k -= 1 << i;\n    u = fa[u][i];\n  }\n  if (k == 0) return u;\n  if (ind[u] == -1) u = fa[u][0], k--;\n  int siz = dia.size();\n  if (ind[u] >= k)\n    return dia[ind[u] - k];\n  else if (ind[u] + k < siz)\n    return dia[ind[u] + k];\n  else\n    return -1;\n}\nint main() {\n  ios::sync_with_stdio(false);\n  memset(ind, -1, sizeof(ind));\n  int n;\n  cin >> n;\n  for (int i = 1; i < n; i++) {\n    int u, v;\n    cin >> u >> v;\n    e[u].push_back(v);\n    e[v].push_back(u);\n  }\n  dfs(1, 0);\n  dfs(s, 0);\n  for (int i = 1, u = s; u; i++, u = fa[u][0]) dia.push_back(u);\n  reverse(dia.begin(), dia.end());\n  int siz = dia.size();\n  for (int i = 0; i < siz; i++) ind[dia[i]] = i;\n  calcfa(dia[0], 0);\n  int q;\n  cin >> q;\n  while (q--) {\n    int u, k;\n    cin >> u >> k;\n    cout << solve(u, k) << endl;\n  }\n  return 0;\n}\n```",
        "postTime": 1667045717,
        "uid": 22030,
        "name": "StudyingFather",
        "ccfLevel": 7,
        "title": "\u9898\u89e3 ABC267F \u3010Counting Shortcuts\u3011"
    },
    {
        "content": "\u9996\u5148\uff0c\u79bb\u6811\u4e0a\u4efb\u610f\u70b9\u6700\u8fdc\u7684\u70b9\u4e00\u5b9a\u4e3a\u76f4\u5f84\u7aef\u70b9\u7684\u5176\u4e2d\u4e00\u6761\u3002\u56e0\u4e3a\u5982\u679c\u4e0d\u662f\uff0c\u90a3\u4e48\u8fd9\u4e2a\u70b9\u624d\u5e94\u8be5\u6210\u4e3a\u76f4\u5f84\u7684\u7aef\u70b9\u3002\u90a3\u4e48\u6c42\u51fa\u6811\u7684\u4efb\u610f\u4e00\u6761\u76f4\u5f84\uff0c\u5bf9\u4e8e\u6bcf\u6b21\u8be2\u95ee\uff0c\u6c42\u51fa $u$ \u4e0e\u76f4\u5f84\u7aef\u70b9 $x,y$ \u7684\u8ddd\u79bb\u3002\u5982\u679c\u90fd\u5c0f\u4e8e $k$\uff0c\u90a3\u4e48\u5c31~~\u4e0d\u53ef\u4ee5\uff0c\u603b\u53f8\u4ee4~~\u3002\u5426\u5219\uff0c\u8bbe\u8ddd\u79bb $u$ \u8ddd\u79bb\u8f83\u8fdc\u7684\u7684\u7aef\u70b9\u4e3a $x$\uff0c\u90a3\u4e48\u4e00\u5b9a\u5b58\u5728\u4e00\u4e2a\u70b9\u4f4d\u4e8e $u\\rightarrow x$ \u7684\u8def\u5f84\u4e0a\u3002\u5bf9\u4e8e $\\operatorname{lca}(u,x)$ \u7684\u4e24\u8fb9\u5206\u7c7b\u8ba8\u8bba\u5373\u53ef\u3002\n# AC \u4ee3\u7801\n```cpp\n#include <bits/stdc++.h>\n\nusing namespace std;\n\ntypedef long long ll;\n\nconst int MAXN = 2e5 + 10;\n\nstruct edge {\n\tint v, nxt;\n} e[MAXN << 1];\n\nint head[MAXN], tot;\n\ninline \nvoid add(int u, int v) {\n\te[++tot] = { v, head[u] }, head[u] = tot;\n}\n\nint maxd;\n\nvoid find(int u, int d, int fa, int &p) {\n\tif (d >= maxd) p = u, maxd = d;\n\tfor (int i = head[u]; i; i = e[i].nxt) {\n\t\tif (e[i].v != fa) find(e[i].v, d + 1, u, p);\n\t}\n}\n\nint fa[MAXN][20], dep[MAXN], lg[MAXN];\n\nvoid init(int u, int f) {\n\tfa[u][0] = f, dep[u] = dep[f] + 1;\n\tfor (int i = 1; i <= lg[dep[u]]; i++) fa[u][i] = fa[fa[u][i - 1]][i - 1];\n\tfor (int i = head[u]; i; i = e[i].nxt) {\n\t\tif (e[i].v != f) init(e[i].v, u);\n\t}\n}\n\ninline \nint lca(int u, int v) {\n\tif (dep[u] < dep[v]) swap(u, v);\n\twhile (dep[u] > dep[v]) u = fa[u][lg[dep[u] - dep[v]]];\n\tif (u == v) return u;\n\tfor (int i = lg[dep[u]]; ~i; i--) {\n\t\tif (fa[u][i] != fa[v][i]) u = fa[u][i], v = fa[v][i];\n\t}\n\treturn fa[u][0];\n}\n\ninline \nint jump(int u, int k) {\n\tfor (int i = lg[k]; ~i; i--) {\n\t\tif (k >> i & 1) u = fa[u][i];\n\t}\n\treturn u;\n}\n\ninline \nint dis(int u, int v) {\n\treturn dep[u] + dep[v] - 2 * dep[lca(u, v)];\n}\n\nint n, q;\n\nint x, y, u, k, d;\n\nint main() {\n    scanf(\"%d\", &n);\n    for (int i = 2; i <= n; i++) lg[i] = lg[i >> 1] + 1;\n    for (int i = 1; i < n; i++) scanf(\"%d%d\", &x, &y), add(x, y), add(y, x);\n    find(1, 0, 0, x), find(x, 0, 0, y), init(1, 0);\n    for (scanf(\"%d\", &q); q--;) {\n    \tscanf(\"%d%d\", &u, &k);\n    \tif (dis(x, u) < dis(y, u)) swap(x, y);\n    \td = dis(x, u);\n    \tif (d < k) puts(\"-1\");\n    \telse printf(\"%d\\n\", k <= dep[u] - dep[lca(u, x)] ? jump(u, k) : jump(x, d - k));\n\t}\n}\n```",
        "postTime": 1670148471,
        "uid": 406941,
        "name": "Register_int",
        "ccfLevel": 6,
        "title": "ABC267F \u9898\u89e3"
    }
]