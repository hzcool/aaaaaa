<% this.adminPage = 'rating'; %>
<% include admin_header %>
<form action="<%= syzoj.utils.makeUrl(['admin', 'rating', 'add']) %>" method="post" class="ui form">
  <div class="field">
    <label>比赛</label>
    <div class="ui fluid search selection dropdown">
      <input type="hidden" name="contest">
      <i class="dropdown icon"></i>
      <div class="default text">选择比赛</div>
      <div class="menu">
        <% for (const contest of contests) { %>
          <div class="item" data-value="<%= contest.id %>"><%= contest.title %></div>
        <% } %>
      </div>
    </div>
  </div>
  <button class="ui blue labeled icon button" name="type" value="doit" type="submit"><i class="ui calculator icon"></i>计算此比赛的积分</button>
</form>

注意：如果删除一个比赛的积分，则该比赛之上的所有比赛也将被删除，积分将还原至该比赛之前的状态！
<form action="<%= syzoj.utils.makeUrl(['admin', 'rating', 'delete']) %>" method="POST">
  <div class="ui relaxed divided list">
    <% for (const calc of calcs) { %>
      <div class="item">
        <%= calc.contest.title %>
        <button name="calc_id" value="<%= calc.id %>" type="submit" style="color: #000; padding: 0; border: none; background: none;"><i class="remove icon"></i></button>
      </div>
    <% } %>
  </div>
</form>

<div class="field">
  <form class="ui form">
    <label>计算虚拟rating/label>
    <div class="two fields">
      <div class="field">
        <label>比赛名称</label>
        <input type="text" name="prefix" id="contest_name_prefix">
      </div>
      <div class="field">
        <label>场次</label>
        <input type="text" name="number" id="contest_number">
      </div>
    </div>
    <el-button text class="ui labeled green button" @click="getVirtualRating(this.prefix, this.number)">计算</el-button>
  </form>
  <el-dialog v-model="showRank" title="排行榜">
    <el-table :data="ratingRank">
      <el-table-column property="name" label="用户名" />
      <el-table-column property="rating" label="rating" />
    </el-table>
  </el-dialog>
</div>



<% include admin_footer %>
<script>
  const { ref } = Vue;
  $('.selection.dropdown').dropdown();

  const showRank = ref(false);
  const ratingRank = [];
  function getVirtualRating(prifix, number) {
    ratingRank.length = 0;
    $.ajax({
      url: '/admin/rating/virtual',
      type: 'POST',
      async: true,
      data: {
        "prefix": prefix,
        "number": number
      },
      dataType: "json",
      success: function(data) {
        for (let item of data.data) {
          ratingRank.append({name: item[0], rating: item[1]});
        }
      }
    });
    showRank = true;
  }
</script>
